# StackOverflow 问答 000075000-000075999

# ruby-on-rails - 为什么 Apache 还没有一个可行的 mod_ruby？

> ID：75001
> 
> 赞同：12
> 
> 时间：2008-09-16T17:47:41.000
> 
> 标签：ruby-on-rails, ruby, apache

与 Ruby 和 Rails 一样流行，似乎这个问题已经得到解决。JRuby 和 mod_rails 都很好而且花花公子，但是为什么没有一个 Apache mod 只适用于纯 Ruby 呢？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-16T18:07:25.087

[Phusion Passenger](http://www.modrails.com/)是一个强大的 Apache 模块，可以以最少的配置运行[Rack应用程序。](http://rack.rubyforge.org/)它对共享主机越来越有吸引力，将任何程序变成 Rack 应用程序都非常容易：

> Rack 应用程序是**一个** 响应`call`. 它只接受*一个参数，即环境并返回一个恰好包含**三个值*的数组：状态、标题和正文。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-20T21:42:21.830

基本问题是：长期以来，MRI 是唯一可行的 Ruby 实现。MRI 存在许多问题，难以将其嵌入到另一个应用程序中（这基本上是[mod_ruby](http://ModRuby.Net/)所做的：它将 MRI 嵌入到 Apache 中），尤其是多线程应用程序（Apache 就是这样）。它不是特别线程安全的，它有相当多的全局状态。

这种全局状态意味着，例如，如果一个 Rails 应用程序修改了某个类，那么在同一 Apache 服务器上运行的*所有其他Rails 应用程序**也*将看到这个修改后的类。

另一个问题是 MRI 源代码不容易被破解。MRI 现在已有 15 多年的历史，并且开始显现。

由于这些问题，mod_ruby 从未*真正*正常工作，并且在某些时候维护人员干脆放弃了。

另一方面，基于 C 的 PHP 解释器从一开始就被设计为在 Apache 中作为 mod_php 运行。事实上，对于前几个版本，甚至没有解释器的命令行版本，mod_php 是运行 PHP的*唯一方法。*

[Phusion Passenger（又名 mod_rack aka mod_rails）](http://ModRails.Com/)通过基本上放弃和回避这个问题来解决这个问题：他们只是在每个应用程序的单独进程中运行单独的 MRI 副本。它工作得很好，而且不仅适用于 Ruby。它支持[WSGI](http://WSGI.Org/)（Python Web 框架的标准接口）、[Rack](http://Rack.RubyForge.Org/)（Ruby Web 框架的标准接口）并直接支持 Ruby on Rails。

我的希望是[mod_rubinius](https://GitHub.Com/rue/mod_rubinius/)，不幸的是它还不存在。[Rubinius](http://Rubini.us/)从一开始就被设计为线程安全、可嵌入、无全局状态、不使用 C 堆栈等。它旨在能够在一个 Rubinius 进程中运行多个 Rubinius 虚拟机。这使得 mod_rubinius 比 mod_ruby 更容易实现和维护。不幸的是，当然，Rubinius 还没有发布，而 mod_rubinius 的真正工作在 Rubinius 发布之前甚至无法开始。好消息是 mod_rubinius 已经拥有比 mod_ruby 更多的人力，因为它已经向一家*迫切*希望自己使用它的 Rails 托管公司支付开发人员的费用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T18:46:08.100

或许值得再次澄清 mislav 的观点，即 mod_rails 实际上根本不限于 Rails 代码。新名称 mod_rack 更好。微不足道的小应用程序可以机架化——他们的例子是：

```
class HelloWorld
  def call(env)
    [200, {"Content-Type" => "text/plain"}, ["Hello world!"]]
  end
end 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-16T17:56:27.093

有一个： [mod_ruby](http://www.modruby.net/en/)，但大约 2 年没有维护了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T19:37:53.060

有[mod_rails](http://www.modrails.com/)并且它可以运行[Rack](http://rack.rubyforge.org/)应用程序，你还需要什么？

# vb6 - Scripting.Dictionary 的 RemoveAll() 方法是否首先释放其所有元素？

> ID：75011
> 
> 赞同：2
> 
> 时间：2008-09-16T17:49:05.707
> 
> 标签：vb6, memory-management, dictionary

在 VB6 应用程序中，我有一个`Dictionary`其键是`String`s 和值是自定义类的实例。如果我调用`RemoveAll()`，`Dictionary`它会首先释放自定义对象吗？还是我明确需要自己这样做？

```
Dim d as Scripting.Dictionary

d("a") = New clsCustom
d("b") = New clsCustom

' Are these two lines necessary?
Set d("a") = Nothing
Set d("b") = Nothing

d.RemoveAll 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T17:54:06.490

是的，在`Dictionary`调用`RemoveAll()`. 从性能（如速度）的角度来看，我会说那些将变量设置为的行`Nothing`是不必要的，因为代码必须首先根据键名查找它们，而`RemoveAll()`将枚举并在一个循环中释放所有内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T17:54:35.523

`RemoveAll`将从`Dictionary`: 键和值中删除所有关联。保留`Dictionary`对`Dictionary`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T17:58:02.800

如果没有其他变量引用集合中的项目，则应将这些对象交给垃圾收集器，以便在下次运行 GC 时进行清理。

例如，如果您在某处 sObj 是静态变量的情况下执行此操作，那么当系统下一次调用 GC 时，第一个对象将被清理，但仍被 sObj 引用的第二个对象不会。

```
d("a") = New clsCustom
d("b") = New clsCustom code.
sObj = d("b")

d.RemoveAll() 
```

# java - 检测并发修改？

> ID：75014
> 
> 赞同：10
> 
> 时间：2008-09-16T17:49:22.370
> 
> 标签：java, collections

在我正在处理的多线程应用程序中，我们偶尔会`ConcurrentModificationExceptions`在列表中看到（主要是`ArrayList`，有时是向量）。但在其他时候，我认为正在发生并发修改，因为迭代集合似乎缺少项目，但没有抛出异常。我知道文档`ConcurrentModificationException`说您不能依赖它，但是我将如何确保我不会同时修改列表？并且将每个对集合的访问包装在同步块中是防止它的唯一方法吗？

**更新：**是的，我知道`Collections.synchronizedCollection`，但它不能防止有人在您迭代集合时修改集合。我认为至少我的一些问题正在发生，当有人在我迭代它时向集合中添加了一些东西。

**第二次更新** 如果有人想把提到的 synchronizedCollection 和像 Jason 那样的克隆与提到的 java.util.concurrent 和 jacekfoo 和 Javamann 这样的 apache 集合框架结合起来，我可以接受一个答案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T18:05:56.417

根据您的更新频率，我最喜欢的一种是 CopyOnWriteArrayList 或 CopyOnWriteArraySet。他们在更新时创建一个新列表/集，以避免并发修改异常。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T11:04:26.763

您最初的问题似乎是要求一个迭代器，它可以看到对底层集合的实时更新，同时保持线程安全。在一般情况下，这是一个非常昂贵的问题，这就是为什么标准集合类都没有这样做的原因。

有很多方法可以实现问题的部分解决方案，在您的应用程序中，其中一种可能就足够了。

Jason 给出[了一种实现线程安全的特定方法，并避免抛出 ConcurrentModificationException](https://stackoverflow.com/questions/75014/detecting-concurrent-modifications#75048)，但只是以牺牲活性为代价。

Javamann 提到了包中的[两个特定类](https://stackoverflow.com/questions/75014/detecting-concurrent-modifications#75196)`java.util.concurrent`，它们以无锁方式解决相同的问题，其中可伸缩性至关重要。这些仅随 Java 5 一起提供，但是已经有各种项目将包的功能反向移植到早期的 Java 版本中，包括[这个](http://backport-jsr166.sourceforge.net/)，尽管它们在早期的 JRE 中不会有这么好的性能。

如果您已经在使用一些 Apache Commons 库，那么正如 jacekfoo[指出](https://stackoverflow.com/questions/75014/detecting-concurrent-modifications#75205)的那样，[apache 集合框架](http://commons.apache.org/collections/)包含一些有用的类。

您还可以考虑查看[Google 集合框架](http://www.devx.com/Java/Article/36183)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T17:51:57.260

查看[java.util.concurrent](http://www.javadoconline.com/search.jsp?from=main&class=java.util.concurrent&action=search)以了解旨在更好地处理并发的标准 Collections 类的版本。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T17:52:40.787

是的，您必须同步对集合对象的访问。

或者，您可以在任何现有对象周围使用同步包装器。请参阅[Collections.synchronizedCollection()](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#synchronizedList(java.util.List))。例如：

```
List<String> safeList = Collections.synchronizedList( originalList ); 
```

但是所有代码都需要使用安全版本，即使在另一个线程修改时进行迭代也会导致问题。

要解决迭代问题，首先复制列表。例子：

```
for ( String el : safeList.clone() )
{ ... } 
```

对于更优化、线程安全的集合，还可以查看[java.util.concurrent](http://www.javadoconline.com/search.jsp?from=main&class=java.util.concurrent&action=search)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T17:54:17.677

通常，如果您在迭代列表时尝试从列表中删除元素，则会收到 ConcurrentModificationException。

最简单的测试方法是：

```
List<Blah> list = new ArrayList<Blah>();
for (Blah blah : list) {
     list.remove(blah); // will throw the exception
} 
```

我不确定你会如何解决它。您可能必须实现自己的线程安全列表，或者您可以创建原始列表的副本以进行写入，并拥有一个写入列表的同步类。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T17:52:09.397

您可以尝试使用防御性复制，以便对其中的修改`List`不会影响其他人。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T17:55:49.840

在同步块中包装对集合的访问是正确的方法。标准编程实践要求在处理跨多个线程共享的状态时使用某种锁定机制（信号量、互斥锁等）。

但是，根据您的用例，您通常可以进行一些优化以仅在某些情况下锁定。例如，如果您有一个经常读取但很少写入的集合，那么您可以允许并发读取，但在写入进行时强制执行锁定。仅当集合处于修改过程中时，并发读取才会导致冲突。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T17:56:21.573

ConcurrentModificationException 是尽力而为，因为您要问的是一个难题。除了证明您的访问模式不会同时修改列表之外，没有什么好的方法可以在不牺牲性能的情况下可靠地做到这一点。

同步可能会阻止并发修改，这可能是您最终采用的方法，但最终可能会很昂贵。最好的办法可能是坐下来思考一下你的算法。如果你不能想出一个无锁的解决方案，那就求助于同步。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T18:06:33.217

请参阅实施。它基本上存储一个int：

```
transient volatile int modCount; 
```

并且当存在“结构修改”（如删除）时会增加。如果迭代器检测到 modCount 发生了变化，它会抛出并发修改异常。

同步（通过 Collections.synchronizedXXX）不会有好处，因为它不能保证迭代器的安全性，它只会通过 put、get、set ... 同步写入和读取。

请参阅 java.util.concurennt 和 apache 集合框架（当读取（非同步）多于写入时，它有一些经过优化的类在并发环境中可以正常工作 - 请参阅 FastHashMap。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-28T06:41:48.207

您还可以在列表上的迭代上进行同步。

```
List<String> safeList = Collections.synchronizedList( originalList );

public void doSomething() {
   synchronized(safeList){
     for(String s : safeList){
           System.out.println(s);

     }
   }

} 
```

这将在同步时锁定列表，并在您编辑或迭代列表时阻止所有尝试访问列表的线程。缺点是你会造成瓶颈。

这比 .clone() 方法节省了一些内存，并且可能会更快，具体取决于您在迭代中所做的事情......

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-16T17:52:57.883

[Collections.synchronizedList()](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#synchronizedList(java.util.List))将呈现一个名义上线程安全的列表，而 java.util.concurrent 具有更强大的功能。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-09-16T20:58:17.453

这将摆脱您的并发修改异常。但是，我不会谈论效率；）

```
List<Blah> list = fillMyList();
List<Blah> temp = new ArrayList<Blah>();
for (Blah blah : list) {
     //list.remove(blah);  would throw the exception
     temp.add(blah);
}
list.removeAll(temp); 
```

# flash - 如何在流模式下阻止 mp3 文件被 Flash 下载

> ID：75052
> 
> 赞同：1
> 
> 时间：2008-09-16T17:52:56.167
> 
> 标签：flash, streaming

我有一个 Flash 播放器，其中包含一组通过 xml 文件加载的歌曲。

在您选择一个文件之前，这些文件不会开始流式传输。

如果我快速循环浏览这 8 个文件中的每一个，那么 flash 将开始尝试同时下载这 8 个文件中的每一个。

我想知道是否有办法清除正在下载的文件。因此，如果有人决定单击大量曲目名称，则不会耗尽带宽。

像 mySound.clear 这样的东西会很棒，或者 mySound.stopStreaming..

以前有人遇到过这个问题吗？

问候，

克里斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-03T20:44:26.123

查看[Sound.Close()](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/media/Sound.html#close())。

来自文档：“*关闭流，导致任何数据下载停止。调用 close() 方法后，不能从流中读取任何数据。* ”

这是来自链接文档的[源代码示例：](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/media/Sound.html#close())

```
package {
    import flash.display.Sprite;
    import flash.net.URLRequest;
    import flash.media.Sound;    
    import flash.text.TextField;
    import flash.text.TextFieldAutoSize;
    import flash.events.MouseEvent;
    import flash.errors.IOError;
    import flash.events.IOErrorEvent;

    public class Sound_closeExample extends Sprite {
        private var snd:Sound = new Sound();
        private var button:TextField = new TextField();
        private var req:URLRequest = new URLRequest("http://av.adobe.com/podcast/csbu_dev_podcast_epi_2.mp3");

        public function Sound_closeExample() {
            button.x = 10;
            button.y = 10;
            button.text = "START";
            button.border = true;
            button.background = true;
            button.selectable = false;
            button.autoSize = TextFieldAutoSize.LEFT;

            button.addEventListener(MouseEvent.CLICK, clickHandler);

            this.addChild(button);
        }

        private function clickHandler(e:MouseEvent):void {

            if(button.text == "START") {

                snd.load(req);
                snd.play();        

                snd.addEventListener(IOErrorEvent.IO_ERROR, errorHandler);

                button.text = "STOP";
            }
            else if(button.text == "STOP") {

                try {
                    snd.close();
                    button.text = "Wait for loaded stream to finish.";
                }
                catch (error:IOError) {
                    button.text = "Couldn't close stream " + error.message;    
                }
            }
        }

        private function errorHandler(event:IOErrorEvent):void {
                button.text = "Couldn't load the file " + event.text;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T18:16:20.790

如果您执行以下操作：

MySoundObject = 未定义；

那应该这样做。

# algorithm - 检查密码强度的最佳方法是什么？

> ID：75057
> 
> 赞同：44
> 
> 时间：2008-09-16T17:53:22.030
> 
> 标签：algorithm, security, passwords

确保用户提供的密码是注册或更改密码表单中的强密码的最佳方法是什么？

我有一个想法（在python中）

```
def validate_password(passwd):
    conditions_met = 0
    conditions_total = 3
    if len(passwd) >= 6: 
        if passwd.lower() != passwd: conditions_met += 1
        if len([x for x in passwd if x.isdigit()]) > 0: conditions_met += 1
        if len([x for x in passwd if not x.isalnum()]) > 0: conditions_met += 1
    result = False
    print conditions_met
    if conditions_met >= 2: result = True
    return result 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-16T18:02:24.570

根据语言的不同，我通常使用正则表达式来检查它是否具有：

*   至少一个大写字母和一个小写字母
*   至少一个数字
*   至少一个特殊字符
*   长度至少为六个字符

您可以要求以上所有内容，或使用强度计类型的脚本。对于我的强度计，如果密码长度合适，则评估如下：

*   满足一个条件：弱密码
*   满足两个条件：中等密码
*   满足所有条件：强密码

您可以调整以上内容以满足您的需求。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-16T18:32:22.453

面向对象的方法将是一组规则。为每个规则分配一个权重并遍历它们。在伪代码中：

```
abstract class Rule {

    float weight;

    float calculateScore( string password );

} 
```

计算总分：

```
float getPasswordStrength( string password ) {     

    float totalWeight = 0.0f;
    float totalScore  = 0.0f;

    foreach ( rule in rules ) {

       totalWeight += weight;
       totalScore  += rule.calculateScore( password ) * rule.weight;

    }

    return (totalScore / totalWeight) / rules.count;

} 
```

基于存在的字符类数量的示例规则算法：

```
float calculateScore( string password ) {

    float score = 0.0f;

    // NUMBER_CLASS is a constant char array { '0', '1', '2', ... }
    if ( password.contains( NUMBER_CLASS ) )
        score += 1.0f;

    if ( password.contains( UPPERCASE_CLASS ) )
        score += 1.0f;

    if ( password.contains( LOWERCASE_CLASS ) )
        score += 1.0f;

    // Sub rule as private method
    if ( containsPunctuation( password ) )
        score += 1.0f;

    return score / 4.0f;

} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2018-05-23T13:42:23.527

**1：消除常用密码**
根据常用密码列表检查输入的密码（参见泄露的 LinkedIn 密码列表中的前 100.000 个密码：http: [//www.adeptus-mechanicus.com/codex/linkhap/combo_not.zip](http://www.adeptus-mechanicus.com/codex/linkhap/combo_not.zip) )，请确保包含[leetspeek 替换](http://www.gamehouse.com/blog/leet-speak-cheat-sheet/)：A@、E3、B8、S5 等。
在进入下面的第 2 部分之前，从输入的短语中删除与此列表匹配的部分密码。

**2：不要对用户强加任何规则**

密码的黄金法则是越长越好。
忘记强制使用大写字母、数字和符号，因为（绝大多数）用户会： - 将第一个字母设为大写；- 把数字`1`放在最后；-`!`如果需要符号，请在其后添加。

**而是检查密码强度**

对于一个体面的起点，请参阅： http: [//www.passwordmeter.com/](http://www.passwordmeter.com/)

我建议至少遵循以下规则：

```
Additions (better passwords)
-----------------------------
- Number of Characters              Flat       +(n*4)   
- Uppercase Letters                 Cond/Incr  +((len-n)*2)     
- Lowercase Letters                 Cond/Incr  +((len-n)*2)     
- Numbers                           Cond       +(n*4)   
- Symbols                           Flat       +(n*6)
- Middle Numbers or Symbols         Flat       +(n*2)   
- Shannon Entropy                   Complex    *EntropyScore

Deductions (worse passwords)
----------------------------- 
- Letters Only                      Flat       -n   
- Numbers Only                      Flat       -(n*16)  
- Repeat Chars (Case Insensitive)   Complex    -    
- Consecutive Uppercase Letters     Flat       -(n*2)   
- Consecutive Lowercase Letters     Flat       -(n*2)   
- Consecutive Numbers               Flat       -(n*2)   
- Sequential Letters (3+)           Flat       -(n*3)   
- Sequential Numbers (3+)           Flat       -(n*3)   
- Sequential Symbols (3+)           Flat       -(n*3)
- Repeated words                    Complex    -       
- Only 1st char is uppercase        Flat       -n
- Last (non symbol) char is number  Flat       -n
- Only last char is symbol          Flat       -n 
```

仅仅跟随[passwordmeter](http://www.passwordmeter.com/)是不够的，因为它的幼稚算法确实看起来`Password1!`不错，但它却异常弱。确保在评分时忽略首字母大写以及尾随数字和符号（根据最后 3 条规则）。

**计算香农熵**
请参阅：[在 Python 中计算熵的最快方法](https://stackoverflow.com/questions/15450192/fastest-way-to-compute-entropy-in-python)

**3：不允许任何太弱**
的密码与其强迫用户屈从于弄巧成拙的规则，不如允许任何能给出足够高分数的密码。多高取决于您的用例。

**最重要**
的是 ，当您接受密码并将其存储在数据库中时，[请确保对其进行加盐和哈希处理！](https://stackoverflow.com/questions/4578431/how-to-hash-and-salt-passwords).

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T18:04:19.760

要检查的两个最简单的指标是：

1.  长度。我会说至少8个字符。
2.  密码包含的不同字符类别的数量。这些通常是小写字母、大写字母、数字和标点符号等符号。强密码将包含至少三个这些类别的字符；如果您强制使用数字或其他非字母字符，则会显着降低字典攻击的有效性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-16T04:05:10.447

Cracklib 很棒，在较新的包中，有一个 Python 模块可供使用。然而，在还没有它的系统上，比如 CentOS 5，我已经为系统 cryptlib 编写了一个 ctypes 包装器。这也适用于无法安装 python-libcrypt 的系统。它*确实*需要具有可用 ctypes 的 python，因此对于 CentOS 5，您必须安装和使用 python26 软件包。

它还有一个优点，它可以获取用户名并检查包含它或基本相似的密码，例如 libcrypt “FascistGecos” 功能，但不需要用户存在于 /etc/passwd 中。

我的[ctypescracklib 库在 github 上可用](http://github.com/linsomniac/python-ctypescracklib)

一些示例用途：

```
>>> FascistCheck('jafo1234', 'jafo')
'it is based on your username'
>>> FascistCheck('myofaj123', 'jafo')
'it is based on your username'
>>> FascistCheck('jxayfoxo', 'jafo')
'it is too similar to your username'
>>> FascistCheck('cretse')
'it is based on a dictionary word' 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-11-28T19:55:31.107

在阅读了其他有用的答案后，这就是我要做的：

-1 与用户名相同
+0 包含用户名
+1 超过 7 个字符
+1 超过 11 个字符
+1 包含数字
+1 大小写混合
+1 包含标点符号
+1 不可打印字符

pwcore.py：

```
import re
import string
max_score = 6
def score(username,passwd):
    if passwd == username:
        return -1
    if username in passwd:
        return 0
    score = 0
    if len(passwd) > 7:
        score+=1
    if len(passwd) > 11:
        score+=1
    if re.search('\d+',passwd):
        score+=1
    if re.search('[a-z]',passwd) and re.search('[A-Z]',passwd):
        score+=1
    if len([x for x in passwd if x in string.punctuation]) > 0:
        score+=1
    if len([x for x in passwd if x not in string.printable]) > 0:
        score+=1
    return score 
```

示例用法：

```
import pwscore
    score = pwscore(username,passwd)
    if score < 3:
        return "weak password (score=" 
             + str(score) + "/"
             + str(pwscore.max_score)
             + "), try again." 
```

可能不是最有效的，但似乎是合理的。不确定 FascistCheck => '与用户名太相似' 是否值得。

'abc123ABC!@£' = 如果不是用户名的超集，则得分 6/6

也许那应该得分更低。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-02T15:02:49.987

好吧，这就是我使用的：

```
 var getStrength = function (passwd) {
    intScore = 0;
    intScore = (intScore + passwd.length);
    if (passwd.match(/[a-z]/)) {
        intScore = (intScore + 1);
    }
    if (passwd.match(/[A-Z]/)) {
        intScore = (intScore + 5);
    }
    if (passwd.match(/\d+/)) {
        intScore = (intScore + 5);
    }
    if (passwd.match(/(\d.*\d)/)) {
        intScore = (intScore + 5);
    }
    if (passwd.match(/[!,@#$%^&*?_~]/)) {
        intScore = (intScore + 5);
    }
    if (passwd.match(/([!,@#$%^&*?_~].*[!,@#$%^&*?_~])/)) {
        intScore = (intScore + 5);
    }
    if (passwd.match(/[a-z]/) && passwd.match(/[A-Z]/)) {
        intScore = (intScore + 2);
    }
    if (passwd.match(/\d/) && passwd.match(/\D/)) {
        intScore = (intScore + 2);
    }
    if (passwd.match(/[a-z]/) && passwd.match(/[A-Z]/) && passwd.match(/\d/) && passwd.match(/[!,@#$%^&*?_~]/)) {
        intScore = (intScore + 2);
    }
    return intScore;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-09T09:00:01.137

我不知道是否有人会觉得这很有用，但我真的很喜欢 phear 建议的规则集的想法，所以我编写了一个规则 Python 2.6 类（尽管它可能与 2.5 兼容）：

```
import re

class SecurityException(Exception):
    pass

class Rule:
    """Creates a rule to evaluate against a string.
    Rules can be regex patterns or a boolean returning function.
    Whether a rule is inclusive or exclusive is decided by the sign
    of the weight. Positive weights are inclusive, negative weights are
    exclusive. 

    Call score() to return either 0 or the weight if the rule 
    is fufilled. 

    Raises a SecurityException if a required rule is violated.
    """

    def __init__(self,rule,weight=1,required=False,name=u"The Unnamed Rule"):
        try:
            getattr(rule,"__call__")
        except AttributeError:
            self.rule = re.compile(rule) # If a regex, compile
        else:
            self.rule = rule  # Otherwise it's a function and it should be scored using it

        if weight == 0:
            return ValueError(u"Weights can not be 0")

        self.weight = weight
        self.required = required
        self.name = name

    def exclusive(self):
        return self.weight < 0
    def inclusive(self):
        return self.weight >= 0
    exclusive = property(exclusive)
    inclusive = property(inclusive)

    def _score_regex(self,password):
        match = self.rule.search(password)
        if match is None:
            if self.exclusive: # didn't match an exclusive rule
                return self.weight
            elif self.inclusive and self.required: # didn't match on a required inclusive rule
                raise SecurityException(u"Violation of Rule: %s by input \"%s\"" % (self.name.title(), password))
            elif self.inclusive and not self.required:
                return 0
        else:
            if self.inclusive:
                return self.weight
            elif self.exclusive and self.required:
                raise SecurityException(u"Violation of Rule: %s by input \"%s\"" % (self.name,password))
            elif self.exclusive and not self.required:
                return 0

        return 0

    def score(self,password):
        try:
            getattr(self.rule,"__call__")
        except AttributeError:
            return self._score_regex(password)
        else:
            return self.rule(password) * self.weight

    def __unicode__(self):
        return u"%s (%i)" % (self.name.title(), self.weight)

    def __str__(self):
        return self.__unicode__() 
```

我希望有人觉得这很有用！

示例用法：

```
rules = [ Rule("^foobar",weight=20,required=True,name=u"The Fubared Rule"), ]
try:
    score = 0
    for rule in rules:
        score += rule.score()
except SecurityException e:
    print e 
else:
    print score 
```

免责声明：未经单元测试

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-16T17:58:12.800

密码强度检查器，如果您有时间+资源（仅当您检查多个密码时才合理），请使用 Rainbow Tables。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-16T17:58:28.370

通过一系列检查以确保其符合最低标准：

*   至少 8 个字符长
*   包含至少一个非字母数字符号
*   不匹配或不包含用户名/电子邮件/等。
*   ETC

这是一个报告密码强度的 jQuery 插件（我自己没有尝试过）： http: [//phiras.wordpress.com/2007/04/08/password-strength-meter-a-jquery-plugin/](http://phiras.wordpress.com/2007/04/08/password-strength-meter-a-jquery-plugin/)

同样的东西移植到 PHP： [http ://www.alixaxel.com/wordpress/2007/06/09/php-password-strength-algorithm/](http://www.alixaxel.com/wordpress/2007/06/09/php-password-strength-algorithm/)

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2019-01-05T20:29:24.817

> 确保用户提供的密码是注册或更改密码表单中的强密码的最佳方法是什么？

不要评估复杂性和/或强度，用户会找到一种方法来欺骗您的系统或感到沮丧以至于他们会离开。那只会让你遇到[这样](https://xkcd.com/936/)的情况。只需要一定的长度并且不使用泄露的密码。加分项：确保您实施的任何内容都允许使用密码管理器和/或 2FA。

# jakarta-ee - 开始 Java EE

> ID：75064
> 
> 赞同：7
> 
> 时间：2008-09-16T17:54:02.187
> 
> 标签：jakarta-ee

我对 Java 有所了解，但对 Enterprise Java 完全陌生。我正在尝试使用 NetBeans 6.1 和 GlassFish Application Server。请指导我一些资源，这些资源实际上告诉我什么是 Java 企业应用程序，它们与普通 Java 类有何不同等。

还有哪个是最好的应用服务器（在 Linux 上）？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-18T18:07:17.003

“什么是 Java 企业应用程序，它们与普通 Java 类有何不同等”

好吧，他们是正常的班级。它们由应用程序服务器运行。“应用服务器”通常*只是一个 JVM*，但有时由供应商增强、修改或扩展。但这不应该是你的任何关注。应用程序服务器（即：JVM）使用类加载器（可能由供应商定制）来加载您的 servlet（任何实现 HttpServlet 接口的类）。任何其他类（不仅仅是 J2EE 类，而是所有类）都将由类加载器加载。从那里开始就是你相同的java代码。我希望这能给你想要的答案。阅读 J2EE 文档（甚至针对开发人员）通常需要无意义的流行语。

我建议您查看 Sun 的 J2EE 教程。它是免费的，并且会复习在进入框架（例如 Struts）之前您应该了解的基础知识。当然，您必须知道您是否打算直接使用 J2EE。

您可能希望熟悉其中的一些内容：

*   [http://java.sun.com/j2ee/1.4/docs/api/](http://java.sun.com/j2ee/1.4/docs/api/)
*   如果您不了解独立网络服务器如何处理 http 请求和响应，您可能还希望查看 HTTP 规范（RFC 或其他地方）。
*   [http://java.sun.com/j2ee/1.4/docs/tutorial/doc/Overview3.html](http://java.sun.com/j2ee/1.4/docs/tutorial/doc/Overview3.html)（特别是网络容器）

几个有用的事实：

*   一个 JSP 被编译成一个 servlet。创建这些是为了不必使用输出编写器来开发您的 Servlet 来处理对页面内容的每次写入（JSP 将为您编译成该内容）。即：out.println("<html>etcetc...")
*   请求（HttpServletRequest）对象代表请求。
*   响应 (HttpServletRespone) 对象将构建响应。（http 标头和内容）。
*   Session 和 Context 对象也很重要。前者用于携带会话范围的对象（由应用服务器管理）并映射到客户端的 jsessionid cookie（因此它知道哪些客户端（即：请求）在服务器端有哪些对象）。上下文对象用于初始设置。
*   您将需要浏览 Web 容器以将它们组合在一起。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-16T18:00:24.853

[Java EE 5 教程](http://java.sun.com/javaee/5/docs/tutorial/doc/)- 在线阅读或以 pdf 格式阅读

[EJB 3 in Action](http://www.manning.com/panda/) - 很棒的书，涵盖了你需要知道的一切

我最近也开始使用 Java EE，到目前为止我只使用过 Glassfish/Sun Application Server，但从我在工作中的同事那里了解到的情况以及我目前所看到的情况来看，Glassfish 似乎是目前最好的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T18:07:46.910

Linux 上的 Glassfish 是一个很好的选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-16T00:29:16.850

我总是喜欢从维基百科开始：[http ://en.wikipedia.org/wiki/Java_Platform,_Enterprise_Edition](http://en.wikipedia.org/wiki/Java_Platform,_Enterprise_Edition)

掌握像 Eclipse 这样的优秀 IDE 是值得的。

最后但并非最不重要的一点是，YouTube 有很好的操作视频：

[http://www.youtube.com/watch?v=_-IDpzC0n9Y](http://www.youtube.com/watch?v=_-IDpzC0n9Y)

# c# - 从.NET 中的堆栈帧获取参数值？

> ID：75076
> 
> 赞同：20
> 
> 时间：2008-09-16T17:54:56.380
> 
> 标签：c#, .net, reflection

我希望能够从 .NET 中的堆栈帧中获取所有参数值。有点像在 Visual Studio 调试器中查看调用堆栈中的值的方式。我的方法集中在使用[StackFrame 类](http://msdn.microsoft.com/en-us/library/system.diagnostics.stackframe%28v=vs.71%29.aspx)，然后反映在[ParameterInfo](http://msdn.microsoft.com/en-us/library/system.reflection.parameterinfo%28v=vs.71%29.aspx)数组上。我在反射和属性方面取得了成功，但这证明有点棘手。

有没有办法实现这一目标？

到目前为止的代码如下所示：

```
class Program
{
    static void Main(string[] args)
    {
        A a = new A();
        a.Go(1);
    }
}

public class A
{
    internal void Go(int x)
    {
        B b = new B();
        b.Go(4);
    }
}

public class B
{
    internal void Go(int y)
    {
        Console.WriteLine(GetStackTrace());

    }
    public static string GetStackTrace()
    {
        StringBuilder sb = new StringBuilder();
        StackTrace st = new StackTrace(true);
        StackFrame[] frames = st.GetFrames();

        foreach (StackFrame frame in frames)
        {
            MethodBase method = frame.GetMethod();

            sb.AppendFormat("{0} - {1}",method.DeclaringType, method.Name);
            ParameterInfo[] paramaters = method.GetParameters();
            foreach (ParameterInfo paramater in paramaters)
            {
                sb.AppendFormat("{0}: {1}", paramater.Name, paramater.ToString());
            }
            sb.AppendLine();
        }
        return sb.ToString();
    }
} 
```

## 输出如下所示：

```
SfApp.B - GetStackTrace
SfApp.B - Go
y: Int32 y
SfApp.A - Go
x: Int32 x
SfApp.Program - Main
args: System.String[] args 
```

## 我希望它看起来更像这样：

```
SfApp.B - GetStackTrace
SfApp.B - Go
y: 4
SfApp.A - Go
x: 1
SfApp.Program - Main 
```

* * *

只是为了一点背景，我的计划是在我抛出自己的异常时尝试使用它。我会更详细地查看您的建议，看看是否合适。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-16T18:13:42.390

好像不能那样做。它只会提供有关方法及其参数的元信息。不是调用堆栈时的实际值。

[有些人建议从ContextBoundObject](http://msdn.microsoft.com/en-us/library/system.contextboundobject.aspx)派生您的类，并使用[IMessageSink](http://msdn.microsoft.com/en-us/library/system.runtime.remoting.messaging.imessagesink.aspx)来通知所有方法调用和参数值。这通常用于[.NET Remoting](http://en.wikipedia.org/wiki/.NET_Remoting)。

另一个建议可能是编写一个调试器。这就是 IDE 获取信息的方式。Microsoft 有[Mdbg](http://blogs.msdn.com/jmstall/archive/2004/09/30/236281.aspx)，您可以从中获取源代码。或者编写一个[CLR 分析器](http://msdn.microsoft.com/en-us/magazine/cc300553.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2022-01-02T01:27:11.253

我很确定这是可能的，但我没有足够的能力给你你想要的答案。我建议一种不同的方法，虽然不太灵活，但如果您事先有堆栈跟踪并且您希望查看传递给每个帧的参数，那么它仍然有用。

通常，您会在堆栈跟踪中存在的每个方法的开头分散日志消息，但这非常麻烦并且并不总是可能的：如果您调用外部库中定义的方法怎么办？

* * *

当我在寻找如何解决这个问题的灵感时，我发现了一个名为[Harmony](https://github.com/pardeike/Harmony)的库，它允许您在运行时修补方法。基本上，方法可以用前缀、后缀和/或终结器装饰。文档中对此进行了很好的解释，但是您可以用来在堆栈跟踪中提供有关方法的详细信息的想法是创建一个打印每个帧的参数的[前缀](https://harmony.pardeike.net/articles/patching-prefix.html)。

不幸的是，仅使用 Harmony，我认为`StackTrace`即使使用后缀/终结器，也无法像您想要的那样对 current 中的方法执行此操作。尽管如此，它可以在调用目标方法之前完成。

* * *

我创建了一个非常简单的库，称为`DebugLogger`内部使用 Harmony 并简化了过程。[这](https://github.com/marco-luzzara/DebugLogger)是存储库，但您也可以在 Nuget 上找到它：

```
dotnet add package DebugLogger --version 1.0.0 
```

它仍然有很多限制，部分是因为 Harmony，只有一堆测试，还没有准备好被视为一个库，但在我看来这是一个很好的起点。我准备了一个[小提琴](https://dotnetfiddle.net/79dHkJ)，展示了初始化`DebugLogger`和几个虚拟类，以使演示“有意义”。

# sql-server - 在 SQL Server 2005 中应该使用什么数据类型来存储电话号码？

> ID：75105
> 
> 赞同：92
> 
> 时间：2008-09-16T17:57:31.257
> 
> 标签：sql-server, indexing

我需要将电话号码存储在表格中。请建议我应该使用哪种数据类型？ **等待。请在点击回复之前阅读..**

此字段需要大量索引，因为销售代表可以使用此字段进行搜索（包括通配符搜索）。

截至目前，我们预计电话号码将采用多种格式（来自 XML 文件）。我是否必须编写解析器才能转换为统一格式？可能有数百万个数据（有重复），我不想每次通过一些源数据时都占用服务器资源（在预处理等活动中）。

欢迎任何建议..

更新：**我无法控制源数据。只是xml文件的结构是标准的。希望将 xml 解析保持在最低限度。一旦它在数据库中，检索应该很快。这里出现的一个疯狂建议是，它甚至应该与 Ajax 自动完成功能一起使用（这样销售代表可以立即看到匹配的）。我的天啊！！**

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-09-16T18:02:48.187

这是否包括：

*   国际号码？
*   扩展？
*   除了实际号码之外的其他信息（如“询问鲍比”）？

如果所有这些都不是，我将使用 10 字符字段并删除所有非数字数据。如果第一个是“是”而另外两个不是，我将使用两个 varchar(50) 字段，一个用于原始输入，一个将所有非数字数据条带化并用于索引。如果 2 或 3 是肯定的，我想我会做两个字段和某种疯狂的解析器来确定什么是扩展或其他数据并适当地处理它。当然，您可以通过对索引执行某些操作来避免第二列，在创建索引时它会去除多余的字符，但我只会创建第二列，并且可能会使用触发器来去除字符。

更新：为了解决 AJAX 问题，它可能没有你想象的那么糟糕。如果这实际上是对表执行任何操作的主要方式，则如我所说，仅将数字存储在辅助列中，然后将该列的索引设为聚集索引。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-09-16T18:03:29.683

我们使用 varchar(15) 并在该字段上建立索引。

原因是国际标准最多可以支持 15 位数字

[维基百科 - 电话号码格式](http://en.wikipedia.org/wiki/Phone_number)

如果您确实支持国际号码，我建议单独存储世界区代码或国家代码，以便更好地过滤查询，这样您就不会发现自己解析和检查电话号码字段的长度来限制返回到美国的电话例子

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T18:00:49.503

如果您只存储美国电话号码，请使用 CHAR(10)。删除除数字以外的所有内容。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T18:00:02.420

我可能在这里遗漏了明显的东西，但是对于您最长的预期电话号码来说，varchar 的长度是否不够好？

如果我*遗漏*了一些明显的东西，如果有人能指出它，我会很高兴......

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-16T18:00:33.170

我会使用 varchar(22)。大到足以容纳一个带分机的北美电话号码。你会想要去掉所有讨厌的 '(', ')', '-' 字符，或者只是将它们全部解析成一种统一的格式。

亚历克斯

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T17:59:02.970

带有预处理的 nvarchar 以尽可能地标准化它们。您可能想要提取扩展并将它们存储在另一个字段中。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-16T18:02:01.543

SQL Server 2005 针对索引 varchar 字段中的文本的子字符串查询进行了很好的优化。2005 年，他们为索引字段的字符串摘要引入了新的统计数据。这对全文搜索有很大帮助。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-05-03T16:12:23.670

使用 varchar 效率很低。使用货币类型并从中创建一个用户声明的类型“电话号码”，并创建一个只允许正数的规则。

如果您将其声明为 (19,4)，您甚至可以存储一个 4 位数的扩展名，并且对于国际号码来说足够大，并且只需要 9 个字节的存储空间。此外，索引速度很快。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T17:59:44.480

规范化数据，然后存储为 varchar。规范化可能很棘手。

这应该是一次性的。然后随着新记录的出现，您将其与标准化数据进行比较。应该非常快。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T18:00:16.977

使用有`varchar`长度限制的字段。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-16T18:05:57.180

由于您需要适应许多不同的电话号码格式（并且可能包括扩展等），因此将其视为任何其他 varchar 可能是最有意义的。如果您可以控制输入，则可以采取多种方法使数据更有用，但听起来并非如此。

一旦您决定将其简单地视为任何其他字符串，您就可以专注于克服有关不良数据、神秘电话号码格式以及其他任何会弹出的不可避免的问题。在我看来，挑战在于为数据建立一个好的搜索策略，而不是如何存储它。处理大量您无法控制收集的数据始终是一项艰巨的任务。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-16T18:09:01.510

使用 SSIS 提取和处理信息。这样，您将处理与 SQL Server 分离的 XML 文件。如果需要，您还可以在单​​独的服务器上执行 SSIS 转换。使用 VARCHAR 以标准格式存储电话号码。NVARCHAR 是不必要的，因为我们谈论的是数字，也许还有其他几个字符，比如'+'、''、'('、')' 和'-'。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-07-22T09:34:23.890

使用“x”或“ext”表示扩展名是相当普遍的，因此允许 15 个字符（用于完全国际支持）加上 3 个（用于“ext”）加上 4 个（用于扩展名本身），总共 22 个字符. 那应该保证你的安全。

或者，对输入进行规范化，以便将任何“ext”转换为“x”，最多为 20。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-03-23T01:14:18.883

我意识到这个线程很旧，但值得一提的是存储为用于格式化目的的数字类型的优势，特别是在 .NET 框架中。

IE

```
.DefaultCellStyle.Format = "(###)###-####" // Will not work on a string 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2017-08-12T14:36:15.013

**最好为电话号码等多值属性设置单独的表格。**

由于您无法控制源数据，因此您可以解析 XML 文件中的数据并将其转换为适当的格式，这样特定国家/地区的格式就不会出现任何问题，并将其存储在单独的表中，以便**索引和检索都将是有效**的。

谢谢你。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-04-02T20:31:58.887

请改用 long 数据类型。不要使用 int，因为它只允许介于 -32,768 和 32,767 之间的整数，但如果使用 long 数据类型，则可以插入介于 -2,147,483,648 和 2,147,483,647 之间的数字。

# c# - 从 C# 中的 DataTable 中删除列

> ID：75123
> 
> 赞同：137
> 
> 时间：2008-09-16T18:00:05.183
> 
> 标签：c#, asp.net

我有一个 DataSet，我从中得到一个 DataTable，我是从函数调用传回的。它有 15-20 列，但我只想要 10 列数据。

有没有办法删除那些我不想要的列，将 DataTable 复制到另一个只定义了我想要的列的列，或者迭代集合并只使用我需要的列更好。

我需要将值写入固定长度的数据文件。

* * *

## 回答 #1

> 赞同：344
> 
> 时间：2008-09-16T18:04:39.803

除了限制选择的列以减少带宽和内存：

```
DataTable t;
t.Columns.Remove("columnName");
t.Columns.RemoveAt(columnIndex); 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-16T18:38:58.350

要删除所需列之后的所有列，下面的代码应该可以工作。它将在索引 10 处删除（记住 Columns 是基于 0 的），直到 Column 计数为 10 或更少。

```
DataTable dt;
int desiredSize = 10;

while (dt.Columns.Count > desiredSize)
{
   dt.Columns.RemoveAt(desiredSize);
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2019-09-26T11:16:45.457

该问题已被标记为已回答，但我猜该问题表明该人想要从 a 中删除多个列`DataTable`。

因此，当我遇到同样的问题时，这就是我所做的。

```
string[] ColumnsToBeDeleted = { "col1", "col2", "col3", "col4" };

foreach (string ColName in ColumnsToBeDeleted)
{
    if (dt.Columns.Contains(ColName))
        dt.Columns.Remove(ColName);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-10-04T04:54:16.337

您只需像这样选择所需的列怎么样：

```
Dim Subjects As String = "Math, English"
Dim SubjectData As DataTable = Table.AsDataView.ToTable(True, Subjects.Split(",")) 
```

# .htaccess - How to make a web app appear at the root of the site?

> ID：75127
> 
> 赞同：0
> 
> 时间：2008-09-16T18:00:26.773
> 
> 标签：.htaccess, mod-rewrite, punbb

I have a bulletin board (punBB based) that I was running out of the root directory for a couple of years. I foolishly decided to do a little gardening and in the process moved the punbb code into it's own subdirectory. The code works great; as long as you point the browser at the new subdirectory. The issue is that the users expect to see it at the root...

I tried an index file in the root that had the following:

```
<?php chdir('punbb');
include('index.php'); 
```

But that didn't seem to do the trick. So, I tried using the "damn cool voodoo" of mod_rewrite in .htaccess but I can't seem to figure out the right combination of rules to make it work.

Here is what I would like to make happen:

User enters:

```
 http://guardthe.net 
```

Browser displays:

```
 http://guardthe.net/punbb/ 
```

or

```
 http://punbb.guardthe.net/ 
```

Is this possible, or should I just move the code base back into the root?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T18:06:53.153

.htacces 中的类似内容应该这样做：

```
 RewriteEngine On
    RewriteRule ^/?$ /punbb/ [R=301,L] 
```

301 返回码将移动标记为永久，使浏览器可以更新书签。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T18:02:02.027

a PHP file with a 301 HTTP permenant redirect.

Put the following into index.php in the root directory of guardthe.net

```
<?php
Header( "HTTP/1.1 301 Moved Permanently" );
Header( "Location: http://guardthe.net/punbb/" );
?> 
```

browser will re-direct with search engine friendliness.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T18:02:17.453

Your example code is missing but here's one way to do it using mod_rewrite:

```
RewriteEngine on
RewriteRule ^$ http://guardthe.net/punbb/ [L,R=301] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T18:04:56.637

您可以编写一个小的重定向脚本来简单快速地处理这个问题。

```
<?php 
header( 'Location: http://guardthe.net/punbb/' ); 
?> 
```

在根目录中的 index.php 中输入该内容作为唯一内容，然后发送到该文件夹​​的任何请求都会将用户重定向到论坛。

# javascript - 如何让 jQuery 效果按顺序运行，而不是同时运行？

> ID：75134
> 
> 赞同：16
> 
> 时间：2008-09-16T18:00:40.687
> 
> 标签：javascript, jquery

我如何在 jQuery run in 中有两个效果`sequence`，而不是同时？以这段代码为例：

```
$("#show-projects").click(function() {
    $(".page:visible").fadeOut("normal");
    $("#projects").fadeIn("normal");
}); 
```

和`fadeOut`同时`fadeIn`运行，如何让它们一个接一个地运行？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-16T18:10:27.403

您可以为效果完成后运行的效果函数提供回调。

```
$("#show-projects").click(function() {
    $(".page:visible").fadeOut("normal", function() {
        $("#projects").fadeIn("normal");
    });
}); 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-16T18:05:45.747

你想要的是一个队列。

查看参考页面[http://api.jquery.com/queue/](http://api.jquery.com/queue/)以获取一些工作示例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-11-18T05:22:32.913

```
$( "#foo" ).fadeOut( 300 ).delay( 800 ).fadeIn( 400 ); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-15T07:56:43.270

一定要有目标吗？当然，只要目标是恒定的，您当然可以使用随机目标对事件进行顺序排队……下面我使用动画目标的父级来存储队列。

```
//example of adding sequential effects through
//event handlers and a jquery event trigger
jQuery( document ).unbind( "bk_prompt_collapse.slide_up" );
jQuery( document ).bind( "bk_prompt_collapse.slide_up" , function( e, j_obj ) {
    jQuery(j_obj).queue(function() {
        //running our timed effect
        jQuery(this).find('div').slideUp(400);
        //adding a fill delay to the parent
        jQuery(this).delay(400).dequeue();
    });
});                     
//the last action removes the content from the dom
//if its in the queue then it will fire sequentially
jQuery( document ).unbind( "bk_prompt_collapse.last_action" );
jQuery( document ).bind( "bk_prompt_collapse.last_action" , function( e, j_obj ) {
    jQuery(j_obj).queue(function() {
        //Hot dog!!
        jQuery(this).remove().dequeue();
    });
});
jQuery("tr.bk_removing_cart_row").trigger( 
    "bk_prompt_collapse" , 
    jQuery("tr.bk_removing_cart_row") 
); 
```

不确定它是否可能，但似乎您可以绑定 .dequeue() 以在另一个 jquery 事件触发时触发，而不是在我上面的示例中触发内联？有效地停止动画队列？

# asp.net - Best way to implement Google Custom Search on an aspx page

> ID：75139
> 
> 赞同：2
> 
> 时间：2008-09-16T18:01:43.383
> 
> 标签：asp.net, forms, google-search, google-custom-search

Google custom search code is provided as a form tag. However, Asp.net only allows a single form tag on a page. What is the best way to implement their code so you can include it on an aspx page (say as part of a Masterpage or navigation element).

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-16T18:08:36.270

一个 ASP.NET 页面上可以有多个表单标记。限制在于服务器端 (runat="server") 表单标签。

只要只有一个具有 runat="server" 属性并且一个不包含在另一个中，您就可以实现两个（或多个）表单标签。例子：

```
<body>
<form action="http://www.google.com/cse" id="cse-search-box"> ... </form>
<form runat="server" id="aspNetform"> ... </form>
<body> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T18:13:08.943

您可以有多个表单标签，但请注意它们不能嵌套。在那种情况下，您会遇到各种奇怪的情况（例如，我见过嵌套表单的开始标记显然被忽略，然后它的结束标记最终关闭“父”表单的情况）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T08:05:04.233

您需要删除表单标签并使用 javascript 发送查询。看看 [http://my6solutions.com/post/2009/04/19/Fixing-Google-Custom-Search-nested-form-tags-in-asp-net-pages.aspx](http://my6solutions.com/post/2009/04/19/Fixing-Google-Custom-Search-nested-form-tags-in-asp-net-pages.aspx)

我也包含了之前和之后的代码。因此，您可以看到我为将它与 blogengine .net 集成所做的工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T18:21:21.760

您可以使用 Javascript：

```
<input name="Query" type="text" class="searchField" id="Query" value="Search" size="15" onfocus="if(this.value == 'Search') { this.value = ''; }" onblur="if(this.value == '') { this.value = 'Search'; }" onkeydown="var event = event || window.event; var key = event.which || event.keyCode; if(key==13) window.open('http://www.google.com/search?q=' + getElementById('Query').value ); " /><input name="" type="button" class="searchButton" value="go" onclick="window.open('http://www.google.com/search?q=' + getElementById('Query').value );" /> 
```

# .net - 如何在 MSDN 上快速找到 .NET 框架方法的 URL？

> ID：75145
> 
> 赞同：1
> 
> 时间：2008-09-16T18:02:03.727
> 
> 标签：.net, msdn

如何在 MSDN 网站上找到代表 .NET 框架方法文档的 URL？

例如，我想将 .NET 框架方法的 URL 嵌入到某些代码中的某些注释中。搜索 MSDN 的正常“损坏” URL 看起来不是很友好：http: [//msdn.microsoft.com/library/xd12z8ts.aspx](http://msdn.microsoft.com/library/xd12z8ts.aspx)。使用 Google 搜索 URL 也不是很漂亮。

我真正想要的 URL 可以嵌入在简单易读的评论中。例如，

// 等等等等等等。有关详细信息，请参阅 http://<....>/System.Byte.ToString

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T18:03:42.460

很多时候，您只需将小写命名空间引用附加到域：

```
http://msdn.microsoft.com/en-us/library/system.windows.application_events.aspx 
```

此外，对于 .Net 2.0 版本（或任何特定版本），您可以添加“（VS.80）”：

```
http://msdn.microsoft.com/en-us/library/system.windows.forms.button(VS.80).aspx 
```

其他版本：

*   .Net 1.1 -> (VS.71)
*   .Net 2.0 -> (VS.80)
*   .Net 3.0 -> (VS.85)
*   .Net 3.5 -> (VS.90)

试试这样的方法（Control.IsInputChar）：http: [//msdn.microsoft.com/en-us/library/system.windows.forms.control.isinputchar.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.isinputchar.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T18:06:44.557

根据我的经验，将其输入 Google 可能是最快的。

编辑：

既然您已经编辑了您的帖子以澄清您的实际意思，我会说在您的评论中嵌入 URL 很好，但您确实不能保证将来会存在损坏的 URL 或漂亮的 URL。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T18:04:38.790

这很简单——只需将方法的名称添加到[http://msdn.microsoft.com//library/](http://msdn.microsoft.com//library/)的末尾即可。

例如，要查找 System.Byte.ToString 方法的 URL，请访问[http://msdn.microsoft.com//library/System.Byte.ToString](http://msdn.microsoft.com//library/System.Byte.ToString)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T18:38:42.000

在我的经验中，谷歌搜索比 msdn 搜索更快。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T22:36:04.410

我发现谷歌搜索“msdn”可以做到。

即 - msdn System.Web.UI.WebControls.Repeater.ItemDataBound

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T18:37:09.960

[在 Firefox 中为 MSDN 库创建搜索引擎](http://labnol.blogspot.com/2006/09/learn-to-create-firefox-search-plugin.html) 也许像这样？

# code-snippets - 一般开发说明

> ID：75153
> 
> 赞同：4
> 
> 时间：2008-09-16T18:02:37.953
> 
> 标签：code-snippets, knowledge-management

在典型的日常编程中，我以一种我想记住的方式实现功能。例如，假设我调整了一个 DB 插入函数，当我再次遇到这种情况时，我想找到我所做的重用。我需要一个地方来保存解决方案（我所做的），并且我需要以某种方式找到它，这可能是几个月或一年后。使用思维导图之类的想法，我正在考虑一个个人 wiki，但后来我听到 stackoverflow 播客提到使用这个网站是出于这样的原因。是否有其他人跟踪他们所做的巧妙的事情，以便他们将来某个时候可以找到它。如果是这样，您使用了什么，一般来说，您如何使用它？

* * *

我喜欢个人博客的想法并为此使用堆栈。我会尝试在堆栈上发布然后自己回答的想法，其他人可能会给出他们的意见。只要堆栈会存在一段时间:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T18:14:33.587

Jeff Atwood 建议对这类事情使用 Stack Overflow。发布一个问题（您的问题），然后发布一个答案（您找到的解决方案）。这使您可以与世界共享信息，并可能获得一些有价值的反馈或更好的解决方案。

（哇，我因为重复杰夫阿特伍德所说的话而被否决了。我不会再这样做了，我保证。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T18:05:10.757

我一直在使用[neomem](http://www.neomem.org/)。我给自己写笔记。然后我可以稍后搜索它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T18:38:19.897

您可能会发现这些问题很有用

*   [您将代码片段存储在哪里？](https://stackoverflow.com/questions/4101/where-do-you-store-your-code-snippets#4137)
*   [跟踪有用信息](https://stackoverflow.com/questions/17770/tracking-useful-information)
*   [您首选的代码片段网站是什么？](https://stackoverflow.com/questions/53881/what-is-your-preferred-site-for-code-snippets)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T18:04:32.830

为此，我使用个人 Wiki、我的 del.icio.us 书签和我自己的博客。通常我的博客：当我学到一些我知道我可能会再次偶然发现的东西时，我会在我的博客中写一篇简短的文章。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T18:09:12.790

我使用 WikiDPad 或 Wiki-On-A-Stick。它不仅适用于代码片段，还可以做笔记，记录你遇到的典型问题以及如何解决它们和文档。相信我的话，如果你有适当的笔记，它会让你的工作变得更容易......并增加互连的力量，你就有了一个杀手级资源。我的记忆力很差，做笔记使我的表现提高了一个数量级。它还使您不必向某人提出两次或三次相同的问题。此外，如果有人问同样的问题，您可以帮助他们指向 wiki，他们可以阅读并在需要时添加。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T18:04:15.843

您正在考虑的技术术语是“代码片段”，并且通过谷歌搜索会发现许多旨在为各种平台存储它们的程序，包括完全基于 Web 的平台，例如[这个](http://snippets.dzone.com/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T18:04:49.117

我在工作中的服务器上设置了 dekiwiki，我和我的同事将其用于公司特定的东西，也用于出现的一般编程技巧。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T18:04:52.300

一个简单的wiki，可能有用。见[提基维基](http://info.tikiwiki.org/tiki-index.php)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T18:06:59.910

我总是把它放在我的[博客上](http://blog.gadodia.net)。我不仅可以稍后再使用它，而且它也有可能帮助其他人。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T18:09:23.820

这是老派，但我在笔记本上记笔记。使记住解决方案（或导致它们的问题）更容易一些。通常我每天做 1-2 页笔记。

与此类似的数字化方式是保留私人博客或日记。很容易添加搜索程序来帮助您查找内容。

我的老板可能感兴趣的有价值的事情，比如错误和用户调用，都被输入到错误跟踪软件中，在那里进行了更正式的处理。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-16T18:19:41.390

我将优秀的[Trac 项目管理系统](http://trac.edgewall.org/)用于我的个人项目，并将它的 wiki 用作头脑风暴和笔记工具。而且，因为它还与 Subversion 存储库和错误跟踪系统挂钩，所以我可以从我的笔记直接链接到特定的代码部分或错误报告。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-16T18:22:51.243

我将我的个人项目保存在 assembla 上。Wiki、问题跟踪、源代码管理……非常有用。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-16T18:53:01.967

Check to see if your editor has some kind of annotations feature. Ideally you could link a particular location in code with a small note, and store it in a centralized place. If it doesn't, that kind of plugin wouldn't be too hard to build, your biggest hurdle is going to be how to link the piece of code to a file (due to the volatile nature of code) and even that one isn't insurmountable.

# perl - How can I limit execution time for a Perl script in IIS?

> ID：75156
> 
> 赞同：3
> 
> 时间：2008-09-16T18:02:51.277
> 
> 标签：perl, iis, iis-6, hosting, cgi

This is a shared hosting environment. I control the server, but not necessarily the content. I've got a client with a Perl script that seems to run out of control every now and then and suck down 50% of the processor until the process is killed.

With ASP scripts, I'm able to restrict the amount of time the script can run, and IIS will simply shut it down after, say, 90 seconds. This doesn't work for Perl scripts, since it's running as a cgi process (and actually launches an external process to execute the script).

Similarly, techniques that look for excess resource consumption in a worker process will likely not see this, since the resource that's being consumed (the processor) is being chewed up by a child process rather than the WP itself.

Is there a way to make IIS abort a Perl script (or other cgi-type process) that's running too long? How??

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T19:12:47.630

在 UNIX 风格的系统上，我会使用捕获 ALRM 事件的信号处理程序，然后使用警报函数启动计时器，然后再启动我预计可能会超时的操作。如果操作完成，我将使用 alarm(0) 关闭警报并正常退出，否则信号处理程序应将其拾取以优雅地关闭所有内容。

我有一段时间没有在 Windows 上使用 perl 了，虽然 Windows 有点 POSIXy，但我不能保证这会奏效；您必须查看 perl 文档以查看您的平台是否支持信号或在何种程度上支持信号。

可以在 Perl Cookbook 中找到有关信号处理和这种使用 alarm() 进行自毁编程的更多详细信息。这是从另一篇文章中摘录并稍作修改的简短示例：

```
eval {
    # Create signal handler and make it local so it falls out of scope
    # outside the eval block
    local $SIG{ALRM} = sub {
        print "Print this if we time out, then die.\n";
        die "alarm\n";
    };

    # Set the alarm, take your chance running the routine, and turn off
    # the alarm if it completes.
    alarm(90);
    routine_that_might_take_a_while();
    alarm(0);
}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T02:30:30.967

关于这个的更新...

事实证明，这个特定的脚本显然有一点问题，而且 Googlebot 具有“按下它的按钮”并让它发疯的不可思议的能力。该脚本是一个较旧的商业应用程序，它执行日历。显然，它显示了“下个月”和“上个月”的链接，如果你跟随“下个月”太多次，你会掉下悬崖。但是，生成的页面仍然包含“下个月”链接。Googlebot 会不断地将脚本打死并吞噬处理器。

奇怪的是，添加带有 Disallow: / 的 robots.txt 并没有解决问题。要么 Googlebot 已经掌握了脚本并且不会放手，要么它只是无视 robots.txt。

无论如何，Microsoft 的 Process Explorer ( [http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx) ) 提供了巨大的帮助，因为它让我可以更详细地查看 perl.exe 进程的环境，并且我能够从中确定是 Googlebot 导致了我的问题。

一旦我知道这一点（并确定 robots.txt 不能解决问题），我就可以直接使用 IIS 来阻止从 *.googlebot.com 到该站点的所有流量，在这种情况下效果很好，因为我们没有不关心谷歌是否索引此内容。

非常感谢大家发布的其他想法！

埃里克朗曼

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T20:35:35.230

ASP 脚本超时适用于所有脚本语言。如果脚本在 ASP 页面中运行，则脚本超时将关闭有问题的页面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T20:30:20.063

谷歌搜索“iis cpu limit”给出了这些命中：

[http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/38fb0130-b14b-48d5-a0a2-05ca131cf4f2.mspx?mfr=true](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/38fb0130-b14b-48d5-a0a2-05ca131cf4f2.mspx?mfr=true)

“CPU 监控功能监控并自动关闭消耗大量 CPU 时间的工作进程。为单个应用程序池启用 CPU 监控。”

[http://technet.microsoft.com/en-us/library/cc728189.aspx](http://technet.microsoft.com/en-us/library/cc728189.aspx)

“通过使用 CPU 监控，您可以监控工作进程的 CPU 使用情况，并可选择关闭消耗大量 CPU 时间的工作进程。CPU 监控仅在工作进程隔离模式下可用。”

# sql-server - 在 SQL Server 中获取代码行总数 (LOC) 的最简单方法是什么？

> ID：75159
> 
> 赞同：2
> 
> 时间：2008-09-16T18:03:17.420
> 
> 标签：sql-server, database, tsql, statistics

我需要提供`(LOC)`与系统相关联的代码行数的统计信息。应用程序部分很简单，但我还需要包含驻留在 SQL Server 数据库中的任何代码。这将适用于存储过程、函数、触发器等。

我怎样才能轻松获得该信息？可以通过查询系统等使用**TSQL （准确地）完成吗？**`tables\sprocs`

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T14:13:26.467

在 Management Studio 中，右键单击要为其计算行数的数据库...选择任务 -> 生成脚本，您可以在脚本向导中选择脚本选项以包含或排除对象，当您将其设置为您喜欢的方式时生成到新的查询窗口

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T18:25:05.573

只需从 syscomments 中选择所有文本并计算您有多少行。文本列是文本，您在 Management Studio 中看不到，所以我会编写这样的程序或 power shell 脚本：

```
$conn = new-object System.Data.SqlClient.SqlConnection("Server=server;Database=database;Integrated Security=SSPI")
$cmd = new-object System.Data.SqlClient.SqlCommand("select text from syscomments", $conn)
$conn.Open()
$reader = $cmd.ExecuteReader()

$reader.Read() | out-null
$reader.GetString(0) | clip
$reader.Close()
$conn.Close() 
```

粘贴到具有行数的编辑器中，您就完成了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T18:05:18.320

就个人而言，您可能只是使用 SQL Server 管理工具将对象编写到文件中，它会在其中获得一些额外的内容，以便在对象存在的情况下首先进行检查。

# java - NetBeans 6.5 中是否有运行中的编译，它的性能如何？

> ID：75168
> 
> 赞同：0
> 
> 时间：2008-09-16T18:03:54.173
> 
> 标签：java, netbeans, compilation

我今天了解到 NetBeans 6.5 应该具有（单个）Java 文件的动态编译。这个特性在 Eclipse 中是众所周知的：只需存储文件，编译的类也会被存储。NetBeans 的工作方式是否相同？如果没有，它是如何滴答作响的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T10:32:56.403

是的，我相信是一样的……

[这是一个展示它的视频](http://www.netbeans.org/kb/docs/java/compile-on-save-screencast.html)

# java - 在Java中创建泛型类型的实例？

> ID：75175
> 
> 赞同：626
> 
> 时间：2008-09-16T18:04:28.603
> 
> 标签：java, generics

是否可以在 Java 中创建泛型类型的实例？根据我所看到的，我认为答案是`no`（*由于类型擦除*），但如果有人能看到我遗漏的东西，我会很感兴趣：

```
class SomeContainer<E>
{
    E createContents()
    {
        return what???
    }
} 
```

编辑：事实证明，[超级类型令牌](http://www.artima.com/weblogs/viewpost.jsp?thread=208860)可以用来解决我的问题，但它需要大量基于反射的代码，正如下面的一些答案所示。

我将把这个开放一段时间，看看是否有人提出与 Ian Robertson 的[Artima 文章](http://www.artima.com/weblogs/viewpost.jsp?thread=208860)截然不同的东西。

* * *

## 回答 #1

> 赞同：361
> 
> 时间：2008-09-16T18:10:01.820

你是对的。你不能这样做`new E()`。但是您可以将其更改为

```
private static class SomeContainer<E> {
    E createContents(Class<E> clazz) {
        return clazz.newInstance();
    }
} 
```

这是一种痛苦。但它有效。将其包装在工厂模式中使其更容易忍受。

* * *

## 回答 #2

> 赞同：140
> 
> 时间：2016-03-30T16:51:40.597

在 Java 8 中，您可以使用[`Supplier`](https://docs.oracle.com/javase/8/docs/api/java/util/function/Supplier.html)函数式接口很容易地实现这一点：

```
class SomeContainer<E> {
  private Supplier<E> supplier;

  SomeContainer(Supplier<E> supplier) {
    this.supplier = supplier;
  }

  E createContents() {
    return supplier.get();
  }
} 
```

你会像这样构造这个类：

```
SomeContainer<String> stringContainer = new SomeContainer<>(String::new); 
```

该行的语法`String::new`是[构造函数引用](https://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html)。

如果您的构造函数接受参数，则可以使用 lambda 表达式：

```
SomeContainer<BigInteger> bigIntegerContainer
    = new SomeContainer<>(() -> new BigInteger(1)); 
```

* * *

## 回答 #3

> 赞同：139
> 
> 时间：2008-09-16T18:18:29.880

我不知道这是否有帮助，但是当您子类化（包括匿名）泛型类型时，类型信息可通过反射获得。例如，

```
public abstract class Foo<E> {

  public E instance;  

  public Foo() throws Exception {
    instance = ((Class)((ParameterizedType)this.getClass().
       getGenericSuperclass()).getActualTypeArguments()[0]).newInstance();
    ...
  }

} 
```

所以，当你继承 Foo 时，你会得到一个 Bar 的实例，例如，

```
// notice that this in anonymous subclass of Foo
assert( new Foo<Bar>() {}.instance instanceof Bar ); 
```

但这是很多工作，并且只适用于子类。不过可以很方便。

* * *

## 回答 #4

> 赞同：89
> 
> 时间：2008-09-16T18:36:12.570

您将需要某种抽象工厂来将责任转嫁给：

```
interface Factory<E> {
    E create();
}

class SomeContainer<E> {
    private final Factory<E> factory;
    SomeContainer(Factory<E> factory) {
        this.factory = factory;
    }
    E createContents() {
        return factory.create();
    }
} 
```

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2010-09-03T12:41:57.437

```
package org.foo.com;

import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;

/**
 * Basically the same answer as noah's.
 */
public class Home<E>
{

    @SuppressWarnings ("unchecked")
    public Class<E> getTypeParameterClass()
    {
        Type type = getClass().getGenericSuperclass();
        ParameterizedType paramType = (ParameterizedType) type;
        return (Class<E>) paramType.getActualTypeArguments()[0];
    }

    private static class StringHome extends Home<String>
    {
    }

    private static class StringBuilderHome extends Home<StringBuilder>
    {
    }

    private static class StringBufferHome extends Home<StringBuffer>
    {
    }   

    /**
     * This prints "String", "StringBuilder" and "StringBuffer"
     */
    public static void main(String[] args) throws InstantiationException, IllegalAccessException
    {
        Object object0 = new StringHome().getTypeParameterClass().newInstance();
        Object object1 = new StringBuilderHome().getTypeParameterClass().newInstance();
        Object object2 = new StringBufferHome().getTypeParameterClass().newInstance();
        System.out.println(object0.getClass().getSimpleName());
        System.out.println(object1.getClass().getSimpleName());
        System.out.println(object2.getClass().getSimpleName());
    }

} 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2013-01-07T07:11:23.823

如果你需要一个泛型类中类型参数的新实例，那么让你的构造函数要求它的类......

```
public final class Foo<T> {

    private Class<T> typeArgumentClass;

    public Foo(Class<T> typeArgumentClass) {

        this.typeArgumentClass = typeArgumentClass;
    }

    public void doSomethingThatRequiresNewT() throws Exception {

        T myNewT = typeArgumentClass.newInstance();
        ...
    }
} 
```

用法：

```
Foo<Bar> barFoo = new Foo<Bar>(Bar.class);
Foo<Etc> etcFoo = new Foo<Etc>(Etc.class); 
```

优点：

*   比罗伯逊的超级类型令牌 (STT) 方法简单得多（而且问题更少）。
*   比 STT 方法（早餐会吃掉你的手机）效率更高。

缺点：

*   无法将 Class 传递给默认构造函数（这就是为什么 Foo 是最终的）。如果你真的需要一个默认构造函数，你总是可以添加一个 setter 方法，但你必须记得稍后再给她一个电话。
*   罗伯逊的反对意见... 比害群之马更多的酒吧（尽管再次指定类型参数类不会完全杀死你）。与罗伯逊的说法相反，这并不违反 DRY 原则，因为编译器将确保类型正确性。
*   不完全`Foo<L>`证明。对于初学者...`newInstance()`如果类型参数类没有默认构造函数，将抛出一个摆动器。无论如何，这确实适用于所有已知的解决方案。
*   缺乏对 STT 方法的完全封装。不过没什么大不了的（考虑到 STT 的惊人性能开销）。

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2014-08-08T02:03:27.300

您现在可以执行此操作，并且不需要一堆反射代码。

```
import com.google.common.reflect.TypeToken;

public class Q26289147
{
    public static void main(final String[] args) throws IllegalAccessException, InstantiationException
    {
        final StrawManParameterizedClass<String> smpc = new StrawManParameterizedClass<String>() {};
        final String string = (String) smpc.type.getRawType().newInstance();
        System.out.format("string = \"%s\"",string);
    }

    static abstract class StrawManParameterizedClass<T>
    {
        final TypeToken<T> type = new TypeToken<T>(getClass()) {};
    }
} 
```

当然，如果您需要调用需要一些反射的构造函数，但这是有据可查的，这个技巧不是！

这是[TypeToken 的 JavaDoc](https://google.github.io/guava/releases/19.0/api/docs/com/google/common/reflect/TypeToken.html)。

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2012-09-13T13:12:51.680

来自[Java 教程 - 泛型限制](http://docs.oracle.com/javase/tutorial/java/generics/restrictions.html)：

**[无法创建类型参数的实例](http://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#createObjects)**

您不能创建类型参数的实例。例如，以下代码会导致编译时错误：

```
public static <E> void append(List<E> list) {
    E elem = new E();  // compile-time error
    list.add(elem);
} 
```

作为一种解决方法，您可以通过反射创建类型参数的对象：

```
public static <E> void append(List<E> list, Class<E> cls) throws Exception {
    E elem = cls.getDeclaredConstructor().newInstance();   // OK
    list.add(elem);
} 
```

您可以按如下方式调用 append 方法：

```
List<String> ls = new ArrayList<>();
append(ls, String.class); 
```

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2015-04-16T16:20:44.810

考虑一种更实用的方法：不要从无到有地创建一些 E（这显然是代码味道），而是传递一个知道如何创建 E 的函数，即

```
E createContents(Callable<E> makeone) {
     return makeone.call(); // most simple case clearly not that useful
} 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2014-02-12T01:31:56.797

当您在编译时使用 E 时，您并不真正关心实际的泛型类型“E”（您使用反射或使用泛型类型的基类），因此让子类提供 E 的实例。

```
abstract class SomeContainer<E>
{
    abstract protected E createContents();
    public void doWork(){
        E obj = createContents();
        // Do the work with E 
     }
}

class BlackContainer extends SomeContainer<Black>{
    protected Black createContents() {
        return new Black();
    }
} 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-09-16T18:14:49.030

这是我想出的一个选项，它可能会有所帮助：

```
public static class Container<E> {
    private Class<E> clazz;

    public Container(Class<E> clazz) {
        this.clazz = clazz;
    }

    public E createContents() throws Exception {
        return clazz.newInstance();
    }
} 
```

编辑：或者，您可以使用此构造函数（但它需要 E 的实例）：

```
@SuppressWarnings("unchecked")
public Container(E instance) {
    this.clazz = (Class<E>) instance.getClass();
} 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2008-09-17T20:19:51.860

如果您不想在实例化过程中键入两次类名，例如：

```
new SomeContainer<SomeType>(SomeType.class); 
```

您可以使用工厂方法：

```
<E> SomeContainer<E> createContainer(Class<E> class); 
```

像：

```
public class Container<E> {

    public static <E> Container<E> create(Class<E> c) {
        return new Container<E>(c);
    }

    Class<E> c;

    public Container(Class<E> c) {
        super();
        this.c = c;
    }

    public E createInstance()
            throws InstantiationException,
            IllegalAccessException {
        return c.newInstance();
    }

} 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2016-02-10T12:32:49.873

不幸的是，Java 不允许您做您想做的事情。查看[官方解决方法](http://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#createObjects)：

> 您不能创建类型参数的实例。例如，以下代码会导致编译时错误：

```
public static <E> void append(List<E> list) {
    E elem = new E();  // compile-time error
    list.add(elem);
} 
```

> 作为一种解决方法，您可以通过反射创建类型参数的对象：

```
public static <E> void append(List<E> list, Class<E> cls) throws Exception {
    E elem = cls.newInstance();   // OK
    list.add(elem);
} 
```

> 您可以按如下方式调用 append 方法：

```
List<String> ls = new ArrayList<>();
append(ls, String.class); 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2008-12-17T22:09:03.157

您可以使用：

```
Class.forName(String).getConstructor(arguments types).newInstance(arguments) 
```

但是您需要提供确切的类名，包括包，例如。`java.io.FileInputStream`. 我用它来创建一个数学表达式解析器。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2019-01-16T09:07:24.467

希望这还为时不晚！！！

Java 是类型安全的，这意味着只有对象才能创建实例。

就我而言，我无法将参数传递给该`createContents`方法。我的解决方案是使用与下面的答案不同的扩展。

```
private static class SomeContainer<E extends Object> {
    E e;
    E createContents() throws Exception{
        return (E) e.getClass().getDeclaredConstructor().newInstance();
    }
} 
```

这是我无法传递参数的示例。

```
public class SomeContainer<E extends Object> {
    E object;

    void resetObject throws Exception{
        object = (E) object.getClass().getDeclaredConstructor().newInstance();
    }
} 
```

如果您使用无对象类型扩展泛型类，则使用反射会创建运行时错误。要将您的泛型类型扩展为对象，请将此错误转换为编译时错误。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2019-07-20T14:03:07.733

使用[`TypeToken<T>`](https://static.javadoc.io/com.google.code.gson/gson/2.6.2/com/google/gson/reflect/TypeToken.html)类：

```
public class MyClass<T> {
    public T doSomething() {
        return (T) new TypeToken<T>(){}.getRawType().newInstance();
    }
} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2013-01-03T20:13:41.280

我以为我可以做到，但很失望：它不起作用，但我认为它仍然值得分享。

也许有人可以纠正：

```
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

interface SomeContainer<E> {
    E createContents();
}

public class Main {

    @SuppressWarnings("unchecked")
    public static <E> SomeContainer<E> createSomeContainer() {
        return (SomeContainer<E>) Proxy.newProxyInstance(Main.class.getClassLoader(),
                new Class[]{ SomeContainer.class }, new InvocationHandler() {
            @Override
            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
                Class<?> returnType = method.getReturnType();
                return returnType.newInstance();
            }
        });
    }

    public static void main(String[] args) {
        SomeContainer<String> container = createSomeContainer();

    [*] System.out.println("String created: [" +container.createContents()+"]");

    }
} 
```

它产生：

```
Exception in thread "main" java.lang.ClassCastException: java.lang.Object cannot be cast to java.lang.String
    at Main.main(Main.java:26)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:601)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:120) 
```

第 26 行是带有`[*]`.

唯一可行的解​​决方案是@JustinRudd 的解决方案

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2014-11-07T08:13:49.170

@Noah 回答的改进。

**变化的原因**

**a]**如果您更改订单时使用超过 1 种泛型类型，则更安全。

**b]**类泛型类型签名会不时更改，因此您不会对运行时中无法解释的异常感到惊讶。

**健壮的代码**

```
public abstract class Clazz<P extends Params, M extends Model> {

    protected M model;

    protected void createModel() {
    Type[] typeArguments = ((ParameterizedType) this.getClass().getGenericSuperclass()).getActualTypeArguments();
    for (Type type : typeArguments) {
        if ((type instanceof Class) && (Model.class.isAssignableFrom((Class) type))) {
            try {
                model = ((Class<M>) type).newInstance();
            } catch (InstantiationException | IllegalAccessException e) {
                throw new RuntimeException(e);
            }
        }
    }
} 
```

或使用一个衬垫

**一行代码**

```
model = ((Class<M>) ((ParameterizedType) this.getClass().getGenericSuperclass()).getActualTypeArguments()[1]).newInstance(); 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2019-07-19T12:11:23.903

你能做的是——

1.  首先声明该泛型类的变量

    2.然后创建它的构造函数并实例化该对象

2.  然后在任何你想使用的地方使用它

例子-

1

> `private Class<E> entity;`

2

```
public xyzservice(Class<E> entity) {
        this.entity = entity;
    }

public E getEntity(Class<E> entity) throws InstantiationException, IllegalAccessException {
        return entity.newInstance();
    } 
```

3.

> E e = getEntity(实体);

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2014-12-04T20:09:34.057

这是一个`createContents`使用[TypeTools](https://github.com/jhalterman/typetools)来解析由 表示的原始类的实现`E`：

```
E createContents() throws Exception {
  return TypeTools.resolveRawArgument(SomeContainer.class, getClass()).newInstance();
} 
```

此方法仅在子类化时才有效，因此在类型定义中捕获了`SomeContainer`的实际值：`E`

```
class SomeStringContainer extends SomeContainer<String> 
```

否则 E 的值在运行时被擦除并且不可恢复。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2012-04-06T11:26:04.183

您可以使用以下代码段实现此目的：

```
import java.lang.reflect.ParameterizedType;

public class SomeContainer<E> {
   E createContents() throws InstantiationException, IllegalAccessException {
      ParameterizedType genericSuperclass = (ParameterizedType)
         getClass().getGenericSuperclass();
      @SuppressWarnings("unchecked")
      Class<E> clazz = (Class<E>)
         genericSuperclass.getActualTypeArguments()[0];
      return clazz.newInstance();
   }
   public static void main( String[] args ) throws Throwable {
      SomeContainer< Long > scl = new SomeContainer<>();
      Long l = scl.createContents();
      System.out.println( l );
   }
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-16T18:42:58.653

如果你的意思是 `new E()` 那是不可能的。我还要补充一点，它并不总是正确的——你怎么知道 E 是否有公共的无参数构造函数？但是您始终可以将创建委托给其他知道如何创建实例的类 - 它可以是这样的，也可以是`Class<E>`您的自定义代码

```
interface Factory<E>{
    E create();
}    

class IntegerFactory implements Factory<Integer>{    
  private static int i = 0; 
  Integer create() {        
    return i++;    
  }
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-16T18:06:22.733

正如您所说，由于类型擦除，您无法真正做到这一点。您可以使用反射来完成它，但它需要大量代码和大量错误处理。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2011-03-22T09:59:50.937

```
return   (E)((Class)((ParameterizedType)this.getClass().getGenericSuperclass()).getActualTypeArguments()[0]).newInstance(); 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2014-06-11T23:42:38.887

有各种库可以`E`使用类似于 Robertson 文章讨论的技术为您解决问题。这是一个`createContents`使用[TypeTools](https://github.com/jhalterman/typetools)来解析由 E 表示的原始类的实现：

```
E createContents() throws Exception {
  return TypeTools.resolveRawArgument(SomeContainer.class, getClass()).newInstance();
} 
```

这假设 getClass() 解析为 SomeContainer 的子类，否则将失败，因为如果 E 的实际参数化值未在子类中捕获，它将在运行时被擦除。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-05-03T05:23:42.350

请注意，kotlin 中的泛型类型可能没有默认构造函数。

```
 implementation("org.objenesis","objenesis", "3.2") 
```

* * *

```
 val fooType = Foo::class.java
    var instance: T = try {
        fooType.newInstance()
    } catch (e: InstantiationException) {
//            Use Objenesis because the fooType class has not a default constructor
        val objenesis: Objenesis = ObjenesisStd()
        objenesis.newInstance(fooType)
    } 
```

*   [没有默认构造函数](https://stackoverflow.com/q/4133709/5279996)
*   [对象](http://objenesis.org/tutorial.html)

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2018-12-28T07:53:39.290

这是一个改进的解决方案，基于`ParameterizedType.getActualTypeArguments`@noah、@Lars Bohl 和其他一些人已经提到的。

实施的第一个小改进。工厂不应该返回实例，而是一个类型。一旦您使用您返回实例，`Class.newInstance()`您就会减少使用范围。因为只有无参数的构造函数可以像这样被调用。更好的方法是返回一个类型，并允许客户端选择他想要调用的构造函数：

```
public class TypeReference<T> {
  public Class<T> type(){
    try {
      ParameterizedType pt = (ParameterizedType) this.getClass().getGenericSuperclass();
      if (pt.getActualTypeArguments() == null || pt.getActualTypeArguments().length == 0){
        throw new IllegalStateException("Could not define type");
      }
      if (pt.getActualTypeArguments().length != 1){
        throw new IllegalStateException("More than one type has been found");
      }
      Type type = pt.getActualTypeArguments()[0];
      String typeAsString = type.getTypeName();
      return (Class<T>) Class.forName(typeAsString);

    } catch (Exception e){
      throw new IllegalStateException("Could not identify type", e);
    }

  }
} 
```

这是一个用法示例。@Lars Bohl 仅展示了一种通过扩展获得具体化的通用方法。@noah 仅通过使用`{}`. 以下是演示这两种情况的测试：

```
import java.lang.reflect.Constructor;

public class TypeReferenceTest {

  private static final String NAME = "Peter";

  private static class Person{
    final String name;

    Person(String name) {
      this.name = name;
    }
  }

  @Test
  public void erased() {
    TypeReference<Person> p = new TypeReference<>();
    Assert.assertNotNull(p);
    try {
      p.type();
      Assert.fail();
    } catch (Exception e){
      Assert.assertEquals("Could not identify type", e.getMessage());
    }
  }

  @Test
  public void reified() throws Exception {
    TypeReference<Person> p = new TypeReference<Person>(){};
    Assert.assertNotNull(p);
    Assert.assertEquals(Person.class.getName(), p.type().getName());
    Constructor ctor = p.type().getDeclaredConstructor(NAME.getClass());
    Assert.assertNotNull(ctor);
    Person person = (Person) ctor.newInstance(NAME);
    Assert.assertEquals(NAME, person.name);
  }

  static class TypeReferencePerson extends TypeReference<Person>{}

  @Test
  public void reifiedExtenension() throws Exception {
    TypeReference<Person> p = new TypeReferencePerson();
    Assert.assertNotNull(p);
    Assert.assertEquals(Person.class.getName(), p.type().getName());
    Constructor ctor = p.type().getDeclaredConstructor(NAME.getClass());
    Assert.assertNotNull(ctor);
    Person person = (Person) ctor.newInstance(NAME);
    Assert.assertEquals(NAME, person.name);
  }
} 
```

**注意：**您可以通过使此类抽象来强制创建实例时`TypeReference`始终使用的客户端： 。我没有这样做，只是为了显示已擦除的测试用例。`{}``public abstract class TypeReference<T>`

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-06-16T11:05:19.993

我受到了 Ira 的解决方案的启发，并对其稍作修改。

```
abstract class SomeContainer<E>
{
    protected E createContents() {
        throw new NotImplementedException();
    }

    public void doWork(){
        E obj = createContents();
        // Do the work with E 
     }
}

class BlackContainer extends SomeContainer<Black>{
    // this method is optional to implement in case you need it
    protected Black createContents() {
        return new Black();
    }
} 
```

如果您需要`E`实例，您可以`createContents`在派生类中实现方法（或者不实现它以防您不需要它。

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2014-02-04T13:00:48.447

你可以用一个类加载器和类名，最后加上一些参数。

```
final ClassLoader classLoader = ...
final Class<?> aClass = classLoader.loadClass("java.lang.Integer");
final Constructor<?> constructor = aClass.getConstructor(int.class);
final Object o = constructor.newInstance(123);
System.out.println("o = " + o); 
```

# c++ - 如何在 Visual Studio 调试器中显示动态分配的数组？

> ID：75180
> 
> 赞同：152
> 
> 时间：2008-09-16T18:04:40.257
> 
> 标签：c++, c, visual-studio, debugging

如果您有一个静态分配的数组，Visual Studio 调试器可以轻松显示所有数组元素。但是，如果您有一个动态分配的数组并由指针指向，则当您单击 + 展开它时，它将仅显示数组的第一个元素。有没有一种简单的方法可以告诉调试器，将这些数据显示为 Foo 类型和大小 X 的数组？

* * *

## 回答 #1

> 赞同：210
> 
> 时间：2008-09-16T18:06:26.743

是的，很简单。说你有

```
char *a = new char[10]; 
```

在调试器中编写：

```
a,10 
```

将向您显示内容，就好像它是一个数组一样。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2014-09-05T16:25:10.973

查看数组 m4x4 中的数据有两种方法：

```
float m4x4[16]={
    1.f,0.f,0.f,0.f,
    0.f,2.f,0.f,0.f,
    0.f,0.f,3.f,0.f,
    0.f,0.f,0.f,4.f
}; 
```

一种方法是使用 Watch 窗口（Debug/Windows/Watch）。添加手表 =

```
m4x4,16 
```

这将在列表中显示数据：

![在此处输入图像描述](https://i.stack.imgur.com/K54SJ.png)

另一种方法是使用内存窗口 (Debug/Windows/Memory)。指定内存起始地址 =

```
m4x4 
```

这会在表格中显示数据，这对于二维和三维矩阵来说更好：

![在此处输入图像描述](https://i.stack.imgur.com/kBbEI.png)

右键单击内存窗口以确定二进制数据的可视化方式。选择仅限于整数、浮点数和一些文本编码。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-09-16T18:06:29.817

在监视窗口中，在数组名称后添加逗号，以及要显示的项目数量。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-03-07T01:29:11.763

重访：

假设您有一个以下指针：

```
double ** a; // assume 5*10 
```

然后您可以在 Visual Studio 调试手表中编写以下内容：

```
(double(*)[10]) a[0],5 
```

这会将其转换为如下所示的数组，您可以一次查看所有内容。

```
double[5][10] a; 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-08-09T04:28:36.017

为了，

```
int **a; //row x col 
```

添加此观看

```
(int(**)[col])a,row 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-03-10T20:12:17.810

[在MSDN](https://msdn.microsoft.com/en-us/library/75w45ekt.aspx)中指定了另一种方法来执行此操作。

简而言之，您可以将字符数组显示为多种类型的字符串。如果你有一个数组声明为：

```
char *a = new char[10]; 
```

您可以使用以下内容在监视窗口中将其打印为 unicode 字符串：

```
a,su 
```

请参阅 MSDN 页面上的表格，了解所有可能的不同转换，因为有很多。许多不同的字符串变体，用于打印数组中单个项目的变体等。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-08-07T07:44:30.130

您可以在文档中的此 gem 的监视窗口中找到可以对变量执行的许多操作的列表： [https ://msdn.microsoft.com/en-us/library/75w45ekt.aspx](https://msdn.microsoft.com/en-us/library/75w45ekt.aspx)

对于变量a，其他答案中已经提到了一些东西，例如

```
a,10 
a,su 
```

但是还有很多其他的格式和大小说明符，比如：

```
a,en (shows an enum value by name instead of the number)
a,mb (to show 1 line of 'memory' view right there in the watch window) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-01-08T15:38:08.137

对于 MFC 数组（CArray、CStringArray、...），请按照提示 #4 中的下一个链接

[http://www.codeproject.com/Articles/469416/10-More-Visual-Studio-Debugging-Tips-for-Native-De](http://www.codeproject.com/Articles/469416/10-More-Visual-Studio-Debugging-Tips-for-Native-De)

例如对于“CArray pArray”，在 Watch 窗口中添加

```
 pArray.m_pData,5 
```

看前5个元素。

如果 pArray 是一个二维 CArray，您可以使用以下语法查看第二维的任何元素：

```
 pArray.m_pData[x].m_pData,y 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-09-18T12:45:20.787

我还没有找到将它与多维数组一起使用的方法。但是您至少可以（如果您知道所需条目的索引）将手表添加到特定值。只需使用索引运算符。

对于一个名为 current 的数组，其中有一个名为 Attribs 的数组，其中有一个名为 Attrib 的数组，如果您希望必须定位到 26，它应该如下所示：

```
((*((*current).Attribs)).Attrib)[26] 
```

您也可以使用偏移量

```
((*((*current).Attribs)).Attrib)+25 
```

将显示 ne “下一个” 25 个元素。（我使用的是 VS2008，这最多只显示 25 个元素）。

# javascript - 当内容来自 Ajax 调用时，访问 div 的内容时出现问题

> ID：75181
> 
> 赞同：0
> 
> 时间：2008-09-16T18:04:42.427
> 
> 标签：javascript, dom, prototypejs

这是一个非常简单的原型示例。

它所做的只是在窗口加载时，将一些 html 粘贴到 div 中的 ajax 调用。

```
<html>
    <head>
        <script type="text/javascript" src="scriptaculous/lib/prototype.js"></script>
        <script type="text/javascript">
            Event.observe(window, 'load', function(){
                new Ajax.Request('get-table.php', {
                    method:  'get',
                    onSuccess:  function(response){
                        $('content').innerHTML = response.responseText;
                        //At this call, the div has HTML in it
                        click1();
                    },
                    onFailure:  function(){
                        alert('Fail!');
                    }
                });
                //At this call, the div is empty
                click1();
            });

            function click1(){if($('content').innerHTML){alert('Found content');}else{alert('Empty div');}}
        </script>
    </head>
    <body><div id="content"></div></body>
</html> 
```

令人困惑的是 Prototype 理解 div 实际上包含内容的上下文。

如果您查看 ajax 调用的 onSuccess 部分，您会发现此时 $('content').innerHTML 中有内容。

但是，当我在 ajax 调用之后立即检查 $('content').innerHTML 时，它似乎是空的。

这一定是我的一些基本误解。有人愿意向我解释吗？

* * *

**编辑**
我只是想澄清一些事情。我意识到 Ajax 调用是异步的。

这是执行事物的实际顺序以及为什么它让我感到困惑：

1.  页面加载。
2.  向 get-table.php 发出 Ajax 请求。
3.  发生在 onSuccess 内部对 click1() 的调用。我看到 div 有内容的警报。
4.  在 Ajax 调用发生之后对 click1() 的调用。我看到 div 为空的警报。

所以这就像代码是按照它编写的顺序执行的，但是 DOM 并没有按照相同的顺序更新。

* * *

**编辑 2** 所以简短的回答是把代码放在 onSuccess 是正确的地方。

另一种需要考虑的情况是您进行 Ajax 调用，然后从第一个调用的 onSuccess 进行另一个 Ajax 调用，如下所示：

```
new Ajax.Request('foo.php',{
  method:  'get',
  onSuccess:  function(response){
    doAnotherAjaxCall();
  }
});

function doAnotherAjaxCall(){
  new Ajax.Request('foo.php',{
    method:  'get',
    onSuccess:  function(response){
      //Anything that needs to happen AFTER the call to doAnotherAjaxCall() above
      //needs to happen here!
    }
  });
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T18:08:21.963

AJAX 的第一个字母代表“异步”。这意味着AJAX调用是在后台执行的，即AJAX请求调用*立即返回*。这意味着通常在调用 onSuccess 处理程序之前（甚至在 AJAX 请求完成之前）实际执行*之后的代码。*

考虑到您编辑的问题：在某些浏览器（例如 Firefox）中，警报框并不像您想象的那样模态。即使另一个已经打开，异步代码也可能会弹出一个警告框。在这种情况下，较新的警报框（来自异步代码的警报框）会显示在旧警报框的顶部。这会产生异步代码首先执行的错觉。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T18:09:03.757

没有尝试过您的代码：AJAX 调用是异步执行的。这意味着您的 Ajax.Request 触发，然后继续 click1() 调用，告诉您 div 为空。在此之后的某个时间点，Ajax 请求完成并且内容实际上被放入了 div。此时 onSuccess 函数被执行，你得到了你期望的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T18:11:16.153

它是异步的 Ajax 调用。这意味着在请求调用之后，响应还没有回来，这就是 $('content') 仍然为空的原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T18:31:19.803

您为处理 AJAX 调用而进行的函数调用的 onSuccess 元素在您收到来自 get-table.php 的响应时执行。这是一个单独的 Javascript 函数，当您从 get-table.php 获得答案时，您会告诉浏览器调用该函数。AJAX.Request 调用下方的代码会在 AJAX.Request 调用后立即访问，但不一定在 get-table.php 调用之前。所以是的，我认为对 AJAX 的工作方式存在一些根本性的误解，可能是由于使用库来隐藏细节。

# linux - 从内部检测 chroot 监狱

> ID：75182
> 
> 赞同：20
> 
> 时间：2008-09-16T18:04:42.457
> 
> 标签：linux, unix, posix, bsd, chroot

在没有 root 权限的情况下如何检测到处于 chroot 监狱中？假设一个标准的 BSD 或 Linux 系统。我想出的最好办法是查看“/”的 inode 值并考虑它是否合理地低，但我想要一种更准确的检测方法。

`[edit 20080916 142430 EST]`仅仅查看文件系统是不够的，因为复制 /boot 和 /dev 之类的东西来欺骗被监禁的用户并不难。

`[edit 20080916 142950 EST]`对于 Linux 系统，检查 /proc 中的意外值是合理的，但对于不支持 /proc 的系统呢？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-17T23:36:39.733

如果 / 是文件系统的根目录，则 / 的 inode 将始终为 2，但您可能会在完整的文件系统中被 chroot。如果它只是 chroot（而不是其他一些虚拟化），您可以运行 mount 并将已安装的文件系统与您所看到的进行比较。验证每个挂载点都有 inode 2。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2014-06-16T14:23:24.387

如果您不在 chroot 中，则 / 的 inode 将始终为 2。您可以使用

```
stat -c %i / 
```

或者

```
ls -id / 
```

有趣，但让我们尝试找到 chroot 目录的路径。询问`stat`/位于哪个设备上：

```
stat -c %04D / 
```

第一个字节是设备的主要字节，最小字节是次要字节。例如，0802，表示major 8，minor 1。如果你签入/dev，你会看到这个设备是/dev/sda2。如果你是 root，你可以直接在你的 chroot 中创建对应的设备：

```
mknode /tmp/root_dev b 8 1 
```

现在，让我们找到与我们的 chroot 关联的 inode。debugfs 允许使用 inode 编号列出文件的内容。例如，`ls -id /`返回 923960：

```
sudo debugfs /tmp/root_dev -R 'ls <923960>'
 923960  (12) .       915821  (32) ..     5636100  (12) var   
5636319  (12) lib    5636322  (12) usr    5636345  (12) tmp   
5636346  (12) sys    5636347  (12) sbin   5636348  (12) run   
5636349  (12) root   5636350  (12) proc   5636351  (12) mnt   
5636352  (12) home   5636353  (12) dev    5636354  (12) boot   
5636355  (12) bin    5636356  (12) etc    5638152  (16) selinux   
5769366  (12) srv    5769367  (12) opt    5769375  (3832) media 
```

有趣的信息是`..`入口的inode：915821。我可以问它的内容：

```
sudo debugfs /tmp/root_dev -R 'ls <915821>'
915821  (12) .              2  (12) ..    923960  (20) debian-jail   
923961  (4052) other-jail 
```

调用的目录`debian-jail`有 inode 923960。所以我的 chroot 目录的最后一个组件是`debian-jail`. 现在让我们看看父目录（inode 2）：

```
sudo debugfs /tmp/root_dev -R 'ls <2>'
      2  (12) .           2  (12) ..          11  (20) lost+found    1046529  (12) home   
 130817  (12) etc    784897  (16) media     3603  (20) initrd.img   
 261633  (12) var    654081  (12) usr     392449  (12) sys            392450  (12) lib   
 784898  (12) root   915715  (12) sbin   1046530  (12) tmp   
1046531  (12) bin    784899  (12) dev     392451  (12) mnt   
 915716  (12) run        12  (12) proc   1046532  (12) boot               13  (16) lib64   
 784945  (12) srv    915821  (12) opt       3604  (3796) vmlinuz 
```

被调用的目录`opt`有 inode 915821，inode 2 是文件系统的根目录。所以我的 chroot 目录是`/opt/debian-jail`. 当然，`/dev/sda1` 可以安装在另一个文件系统上。您需要检查（使用 lsof 或直接选择信息`/proc`）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-11-09T19:13:57.267

在具有 root 权限的 Linux 上，测试 init 进程的根目录是否是您的根目录。虽然`/proc/1/root`始终是指向 的符号链接`/`，但跟随它会导致“主”根目录（假设 init 进程未经过 chroot，但这几乎从未完成）。如果`/proc`没有挂载，你可以打赌你在 chroot 中。

```
[ "$(stat -c %d:%i /)" != "$(stat -c %d:%i /proc/1/root/.)" ]
# With ash/bash/ksh/zsh
! [ -x /proc/1/root/. ] || [ /proc/1/root/. -ef / ] 
```

这比[查看更精确，`/proc/1/exe`](https://stackoverflow.com/questions/75182/detecting-a-chroot-jail-from-within/215381#215381)`init`因为如果自上次引导以来已升级，或者 chroot 位于主根文件系统上并且`init`在其中硬链接，则在 chroot之外可能会有所不同。

如果您没有 root 权限，您可以查看`/proc/1/mountinfo`和`/proc/$$/mountinfo`（简要记录在[`filesystems/proc.txt`Linux 内核文档中](http://www.kernel.org/doc/Documentation/filesystems/proc.txt)）。该文件是世界可读的，并且包含有关文件系统进程视图中每个挂载点的大量信息。该文件中的路径受到影响读取器进程的 chroot 的限制（如果有）。如果进程读取`/proc/1/mountinfo`被 chroot 到一个不同于全局根的文件系统中（假设 pid 1 的根是全局根），`/`那么`/proc/1/mountinfo`. 如果进程读取`/proc/1/mountinfo`被 chroot 到全局根文件系统上的一个目录，那么一个条目`/`出现在 中`/proc/1/mountinfo`，但具有不同的挂载 ID。顺便说一句，根字段（`$4`) 指示 chroot 在其主文件系统中的位置。同样，这是特定于 Linux 的。

```
[ "$(awk '$5=="/" {print $1}' </proc/1/mountinfo)" != "$(awk '$5=="/" {print $1}' </proc/$$/mountinfo)" ] 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-16T18:14:46.193

防止这样的事情是重点。如果您的代码应该在 chroot 中运行，请让它在启动时设置一个标志。如果你在黑客，黑客：检查已知位置的几个常见的东西，计算 /etc 中的文件，/dev 中的一些东西。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-18T18:25:29.027

在 BSD 系统上（使用 uname -a 检查），proc 应该始终存在。检查 /proc/1/exe 的 dev/inode 对（在该路径上使用 stat，它不会通过文本跟随符号链接，而是通过底层钩子）匹配 /sbin/init。

检查 inode #2 的根目录也是一个好方法。

在大多数其他系统上，root 用户可以通过尝试 fchdir root-break 技巧更快地找到。如果它去任何地方，你就在 chroot 监狱里。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T18:22:21.417

我想这取决于你为什么会在 chroot 中，以及是否有任何努力来掩饰它。

我会检查/proc，这些文件是自动生成的系统信息文件。内核会将这些填充到根文件系统中，但它们可能不存在于 chroot 文件系统中。

如果根文件系统的 /proc 已经绑定到 chroot 中的 /proc，那么很可能该信息与 chroot 环境之间存在一些差异。例如，检查 /proc/mounts。

同样，检查 /sys。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-02-17T18:49:01.540

我想为在 FreeBSD 上运行的监狱提供相同的信息（因为 Ansible 似乎没有检测到这种情况）。

在 FreeBSD 11 的 FreeNAS 发行版上，`/proc`它不是安装在主机上，而是在监狱内。我不确定在常规 FreeBSD 上是否也是如此，但[procfs: Gone But Not Forgotten](https://www.freebsd.org/doc/en/articles/linux-users/procfs.html)似乎暗示它是。无论哪种方式，您可能都不想尝试安装它只是为了检测监狱状态，因此我不确定它是否可以用作监狱中的可靠预测器。

我还排除了`/`在 FreeNAS 上使用 stat on 的可能性，因为所有监狱都有自己的文件系统（即[ZFS 数据集](https://www.freebsd.org/doc/handbook/zfs-term.html)），因此`/`主机上的节点和监狱中的节点都有 inode 4。我希望这在 FreeBSD 11 中很常见一般的。

所以我选择的方法是在 pid 0上使用[procstat 。](https://www.freebsd.org/cgi/man.cgi?procstat)

```
[root@host ~]# procstat 0
  PID  PPID  PGID   SID  TSID THR LOGIN    WCHAN     EMUL          COMM        
    0     0     0     0     0 1234 -        swapin    -             kernel      
[root@host ~]# echo $?
0
[root@host ~]# jexec guest tcsh
root@guest:/ # procstat 0
procstat: sysctl(kern.proc): No such process
procstat: procstat_getprocs()
root@guest:/ # echo $?
1 
```

我在这里假设 pid 0 将始终是主机上的内核，并且监狱内不会有 pid 0。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-07-25T07:22:59.750

如果您使用 schroot 输入 chroot，那么您可以检查 $debian_chroot 的值。

# c++ - 什么是无符号字符？

> ID：75191
> 
> 赞同：513
> 
> 时间：2008-09-16T18:05:18.557
> 
> 标签：c++, c, char

在 C/C++ 中，an`unsigned char`用于什么？和普通的有什么区别`char`？

* * *

## 回答 #1

> 赞同：590
> 
> 时间：2008-09-17T21:04:17.353

在 C++ 中，存在三种*不同的*字符类型：

*   `char`
*   `signed char`
*   `unsigned char`

如果您对*text*使用字符类型，请使用不合格的`char`：

*   它是字符文字的类型，例如`'a'`or `'0'`（仅在 C++ 中，在 C 中它们的类型是`int`）
*   它是构成 C 字符串的类型，例如`"abcde"`

它也可以作为一个数字值，但未指定该值是被视为有符号还是无符号。当心通过不等式进行字符比较 - 尽管如果您将自己限制在 ASCII (0-127) 范围内，那么您几乎是安全的。

如果您将字符类型用作*数字*，请使用：

*   `signed char`，这*至少*为您提供了 -127 到 127 的范围。（-128 到 127 很常见）
*   `unsigned char`，它*至少*为您提供了 0 到 255 的范围。

“至少”，因为 C++ 标准只给出了每种数字类型需要覆盖的最小值范围。`sizeof (char)`要求为 1（即一个字节），但理论上一个字节可以是例如 32 位。**`sizeof`仍会将其大小报告为`1`**- 意味着您*可以*拥有`sizeof (char) == sizeof (long) == 1`.

* * *

## 回答 #2

> 赞同：102
> 
> 时间：2008-09-16T18:08:55.987

这取决于实现，因为 C 标准没有定义`char`. 根据平台， char 可能是`signed`or `unsigned`，因此您需要明确询问您的实现`signed char`是否`unsigned char`依赖于它。如果您打算从字符串中表示字符，只需使用`char`它，因为这将匹配您的平台在字符串中放置的内容。

`signed char`和之间的区别`unsigned char`正如您所料。在大多数平台上，它将是一个范围为to`signed char`的 8 位二进制补码数，并且是一个 8 位无符号整数 ( to )。请注意，该标准不要求类型具有 8 位，只要求return 。您可以使用in获取 char 中的位数。但是，今天很少有平台会出现除.`-128``127``unsigned char``0``255``char``sizeof(char)``1``CHAR_BIT``limits.h``8`

[这里有一个很好的关于这个问题的](http://www.arm.linux.org.uk/docs/faqs/signedchar.php)总结。

正如其他人在我发布此内容后所提到的那样`int8_t`，`uint8_t`如果你真的想表示小整数，你最好使用它。

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2009-01-14T11:30:11.800

因为我觉得真的很需要，所以我只想说一下C和C++的一些规则（在这方面是一样的）。首先，如果有任何 unsigned char 对象，*所有位*都`unsigned char`参与确定值。其次，`unsigned char`明确表示无符号。

现在，我与某人讨论了将`-1`int 类型的值转换为`unsigned char`. 他拒绝将结果`unsigned char`的所有位都设置为 1 的想法，因为他担心符号表示。但他不必如此。转换会立即遵循此规则：

> 如果新类型是无符号的，则在新类型可以表示的最大值的基础上反复加减一，直到该值在新类型的范围内。（`6.3.1.3p2`在 C99 草案中）

这是一个数学描述。C++ 用模演算来描述它，这产生了相同的规则。无论如何，*不*​​能保证整数中的所有位在`-1`转换之前都是一。那么，我们有什么可以声称结果的`unsigned char`所有`CHAR_BIT`位都变为 1？

1.  所有位都参与确定其值 - 也就是说，对象中不会出现填充位。
2.  只添加一次`UCHAR_MAX+1`将`-1`产生一个范围内的值，即`UCHAR_MAX`

够了，真的！因此，每当您想拥有`unsigned char`所有的东西时，您都可以

```
unsigned char c = (unsigned char)-1; 
```

还可以看出，转换*不仅仅是*截断高阶位。*二进制补码*的幸运之处在于它只是一个截断，但对于其他符号表示不一定如此。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-09-17T02:44:42.207

例如*unsigned char*的用法：

`unsigned char`经常用在计算机图形学中，它经常（尽管不总是）为每个颜色分量分配一个字节。通常看到 RGB（或 RGBA）颜色表示为 24（或 32）位，每个位是`unsigned char`. 由于`unsigned char`值在 [0,255] 范围内，因此这些值通常被解释为：

*   0 表示完全没有给定的颜色分量。
*   255 表示给定颜色颜料的 100%。

所以你最终会得到 RGB 红色为 (255,0,0) -> (100% red, 0% green, 0% blue)。

为什么不使用`signed char`? 算术和位移成为问题。如前所述， a`signed char`的范围基本上移动了 -128。将 RGB 转换为灰度的一种非常简单且幼稚（大部分未使用）的方法是对所有三个颜色分量进行平均，但是当颜色分量的值为负时，这会遇到问题。`unsigned char`使用算术时，红色 (255, 0, 0) 平均为 (85, 85, 85) 。但是，如果值为`signed char`s (127,-128,-128)，我们最终会得到 (-99, -99, -99)，在我们的`unsigned char`空间中将是 (29, 29, 29)，这是不正确的.

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-16T18:12:16.260

`signed char`范围为 -128 到 127；`unsigned char`范围为 0 到 255。

`char`取决于编译器，将等同于有符号字符或无符号字符，但它是一种不同的类型。

如果您使用 C 风格的字符串，只需使用`char`. 如果您需要将字符用于算术（非常罕见），请显式指定有符号或无符号以实现可移植性。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2013-01-22T10:41:46.227

`unsigned char`只取正值....比如**0**到**255**

然而

`signed char`取正值和负值....比如**-128**到**+127**

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-09-17T05:49:54.070

`char`并且`unsigned char`不保证在所有平台上都是 8 位类型——它们保证是 8 位或更大。某些平台具有[9 位、32 位或 64 位字节](https://isocpp.org/wiki/faq/intrinsic-types#bits-per-byte)。但是，当今最常见的平台（Windows、Mac、Linux x86 等）具有 8 位字节。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-16T18:16:34.283

An`unsigned char`是一个无符号字节值（0 到 255）。您可能会认为`char`是“字符”，但它实际上是一个数值。正则`char`有符号，因此您有 128 个值，这些值使用 ASCII 编码映射到字符。但无论哪种情况，您在内存中存储的是一个字节值。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-09-16T19:14:19.717

`unsigned char`是所有点诡计的心脏。在几乎*所有*平台的所有编译器中，an*只是*一个字节**和**一个（通常）8 位的无符号整数，可以被视为一个小整数或一组位。*`unsigned char`*

 ***此外，正如其他人所说，该标准没有定义字符的符号。所以你有 3 种不同的`char`类型：`char`, `signed char`, `unsigned char`.

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-16T18:17:44.767

就直接值而言，当已知值介于两者之间时使用常规字符，`CHAR_MIN`而无`CHAR_MAX`符号字符在正端提供两倍的范围。例如，如果`CHAR_BIT`为 8，则正`char`则的范围仅保证为 [0, 127]（因为它可以有符号或无符号），而`unsigned char`将是 [0, 255] 并且`signed char`将是 [-127, 127]。

就其用途而言，标准允许将 POD 对象（普通旧数据）直接转换为无符号字符数组。这允许您检查对象的表示和位模式。char 或signed char 不存在相同的安全类型双关语保证。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-09-16T18:18:46.340

如果您喜欢使用各种类型的特定长度和符号，那么使用`uint8_t`, `int8_t`,`uint16_t`等可能会更好，因为它们完全按照他们所说的去做。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2017-11-24T22:40:44.073

`unsigned char`只取正值：0 到 255，而 `signed char`取正值和负值：-128 到 +127。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-16T18:16:27.110

一些谷歌搜索发现[了这个](http://bytes.com/forum/thread61480.html)，人们对此进行了讨论。

无符号字符基本上是一个字节。因此，如果您需要一个字节的数据（例如，您可能想使用它来设置标志打开和关闭以传递给函数，就像在 Windows API 中经常做的那样），您会使用它。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-09-16T18:20:27.693

unsigned char 使用为常规 char 的符号保留的位作为另一个数字。这会将范围更改为 [0 - 255]，而不是 [-128 - 127]。

当您不想要符号时，通常使用无符号字符。在将 char 作为字节处理而不是将其用作数字时，这将在执行诸如移位（移位扩展符号）之类的事情和其他事情时产生影响。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2017-07-21T03:20:34.360

引用自“c 编程语言”一书：

限定符`signed`or`unsigned`可以应用于 char 或任何整数。无符号数始终为正数或零，并遵守算术模 2^n 的定律，其中 n 是类型中的位数。因此，例如，如果 char 是 8 位，则 unsigned char 变量的值介于 0 和 255 之间，而有符号 char 的值介于 -128 和 127 之间（在二进制补码机器中）。普通字符是有符号还是无符号是机器- 依赖，但可打印的字符始终为正数。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2020-01-04T04:30:29.323

`signed char`并且`unsigned char`都代表1字节，但它们有不同的范围。

```
 Type        |      range
-------------------------------
signed char    |  -128 to +127
unsigned char  |     0 to 255 
```

如果`signed char`我们考虑`char letter = 'A'`，'A'代表65的二进制`ASCII/Unicode`，如果可以存储65，也可以存储-65。那里没有负二进制值，`ASCII/Unicode`无需担心负值。

**例子**

```
#include <stdio.h>

int main()
{
    signed char char1 = 255;
    signed char char2 = -128;
    unsigned char char3 = 255;
    unsigned char char4 = -128;

    printf("Signed char(255) : %d\n",char1);
    printf("Unsigned char(255) : %d\n",char3);

    printf("\nSigned char(-128) : %d\n",char2);
    printf("Unsigned char(-128) : %d\n",char4);

    return 0;
} 
```

**输出 -：**

```
Signed char(255) : -1
Unsigned char(255) : 255

Signed char(-128) : -128
Unsigned char(-128) : 128 
```

# c++ - 没有范围的范围解析运算符

> ID：75213
> 
> 赞同：66
> 
> 时间：2008-09-16T18:06:50.643
> 
> 标签：c++

在 C++ 中，在没有作用域的情况下使用作用域解析运算符的目的是什么？例如：

```
::foo(); 
```

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-09-16T18:10:38.807

这意味着全局范围。当您在同一范围内有冲突的函数或变量并且您需要使用全局运算符时，您可能需要使用此运算符。你可能有类似的东西：

```
void bar();    // this is a global function

class foo {
    void some_func() { ::bar(); }    // this function is calling the global bar() and not the class version
    void bar();                      // this is a class member
}; 
```

如果你需要从类成员函数中调用全局 bar() 函数，你应该使用 ::bar() 来获得函数的全局版本。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2014-02-28T03:47:15.140

在全局命名空间中查找以[范围解析运算符](http://en.wikipedia.org/wiki/Scope_resolution_operator)( )开头的名称。`::`我们可以通过查看[草案 C++ 标准](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3485.pdf)部分`3.4.3` *Qualified name lookup*第*4*段来看到这一点，其中说（*强调我的*）：

> 以一元作用域运算符 :: (5.1)**为前缀的名称在全局作用域中查找**，在使用它的翻译单元中。该名称应在全局命名空间范围内声明，或者应是由于使用指令（3.4.3.2）而在全局范围内可见的名称。:: 的使用**允许引用全局名称，即使它的标识符已被隐藏**（3.3.10）。

正如标准所述，这允许我们使用来自全局命名空间的名称[，否则这些名称将被隐藏](http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=%2Fcom.ibm.xlcpp8l.doc%2Flanguage%2Fref%2Fcplr175.htm)，链接文档中的示例如下：

```
int count = 0;

int main(void) {
  int count = 0;
  ::count = 1;  // set global count to 1
  count = 2;    // set local count to 2
  return 0;
} 
```

措辞与 N1804 非常相似，[N1804](http://www.open-std.org/Jtc1/sc22/wg21/docs/papers/2005/n1804.pdf)是可用的最早的草案标准。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-16T18:14:45.757

您还应该注意，名称解析发生在重载解析之前。因此，如果在您当前的范围内有同名的东西，那么它将停止寻找其他名称并尝试使用它们。

```
void bar() {};
class foo {
    void bar(int) {};
    void foobar() { bar(); } // won't compile needs ::bar()
    void foobar(int i) { bar(i); } // ok
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T18:09:27.423

当您在本地范围内已经有一个名为 foo() 的函数但您需要在全局范围内访问该函数时。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T18:09:50.447

我的 c++ 生锈了，但我相信如果您在本地范围内声明了一个函数，例如 foo() 和一个在全局范围内的函数，则 foo() 指的是本地函数。::foo() 将指的是全局的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T18:07:54.773

指全局范围

# java - 如何检测何时在 Java 中全局抛出异常？

> ID：75218
> 
> 赞同：27
> 
> 时间：2008-09-16T18:07:34.837
> 
> 标签：java, exception

如何检测应用程序中何时抛出异常？

每当在我的 Java 桌面应用程序中的任何地方引发异常时，我都会尝试自动向自己发送一封电子邮件。我认为这样我可以更积极主动。

我知道我可以在发生异常时明确记录并通知自己，但我必须在任何地方都这样做，我可能（更有可能）会错过一些。

有什么建议么？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-16T18:26:45.837

您可能不想邮寄任何例外情况。JDK中有很多代码实际上依赖异常才能正常工作。我认为您更感兴趣的是未捕获的异常。如果您正在捕获异常，您应该在那里处理通知。

在桌面应用程序中，有两个地方需要担心这一点，即[事件调度线程](/questions/tagged/event-dispatch-thread "显示标记为“事件调度线程”的问题")(EDT) 和 EDT 之外。Globaly，您可以注册一个实现`java.util.Thread.UncaughtExceptionHandler`并通过`java.util.Thread.setDefaultUncaughtExceptionHandler`. 如果异常结束到堆栈底部并且线程没有在线程或 ThreadGroup 上的当前线程实例上设置处理程序，则会调用此方法。

EDT 有一个不同的钩子来处理异常。系统属性`'sun.awt.exception.handler'`需要使用具有零参数构造函数的类的完全限定类名称进行注册。这个类需要一个实例方法handle( `Throwable`)来完成你的工作。返回类型无关紧要，因为每次都会创建一个新实例，所以不要指望保持状态。

因此，如果您不关心样本中发生异常的线程可能如下所示：

```
class ExceptionHandler implements Thread.UncaughtExceptionHandler {
  public void uncaughtException(Thread t, Throwable e) {
    handle(e);
  }

  public void handle(Throwable throwable) {
    try {
      // insert your e-mail code here
    } catch (Throwable t) {
      // don't let the exception get thrown out, will cause infinite looping!
    }
  }

  public static void registerExceptionHandler() {
    Thread.setDefaultUncaughtExceptionHandler(new ExceptionHandler());
    System.setProperty("sun.awt.exception.handler", ExceptionHandler.class.getName());
  }
} 
```

将这个类添加到一些随机包中，然后调用该`registerExceptionHandler`方法，您应该准备好了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-16T18:12:14.250

Java 1.5 中的新调试钩子让您可以做到这一点。它可以在调试器中启用例如“中断任何异常”。

这是您需要[的特定 Javadoc 。](http://java.sun.com/j2se/1.5.0/docs/guide/jpda/jdi/com/sun/jdi/event/ExceptionEvent.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-16T18:12:45.697

查看[Thread.UncaughtExceptionHandler](http://java.sun.com/javase/6/docs/api/java/lang/Thread.UncaughtExceptionHandler.html)。您可以为每个线程设置它，也可以为整个 VM 设置一个默认值。

这至少会帮助你抓住你错过的那些。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T18:13:46.180

如果您使用的是[Spring](http://www.springframework.org)等 Web 框架，则可以将 web.xml 委托给页面，然后使用控制器发送电子邮件。例如：

在 web.xml 中：

```
<error-page>
  <error-code>500</error-code>
  <location>/error/500.htm</location>
</error-page> 
```

然后将 /error/500.htm 定义为控制器。您可以从参数 javax.servlet.error.exception 访问异常：

```
Exception exception = (Exception) request.getAttribute("javax.servlet.error.exception"); 
```

如果你只是在运行一个普通的 Java 程序，那么我想你会被 public static void main(String[] args) { try { ... } catch (Exception e) {} }

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T20:27:51.677

如果您使用的是 java 1.3/1.4，则 Thread.UncaughtExceptionHandler 不可用。在这种情况下，您可以使用基于 AOP 的解决方案在抛出异常时触发一些代码。Spring 和/或 aspectJ 可能会有所帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-11-16T13:34:08.857

在我当前的项目中，我面临着关于错误检测的类似要求。为此，我应用了以下方法：我使用 log4j 在我的应用程序和任何地方进行日志记录，在捕获异常的地方我做标准的事情： `log.error("Error's description goes here", e);`，其中 e 是抛出的异常（有关初始化的详细信息，请参阅 log4j 文档的“日志”）。为了检测错误，我使用了自己的 Appender，它扩展了 log4j AppenderSkeleton 类：

```
import org.apache.log4j.AppenderSkeleton;
import org.apache.log4j.spi.LoggingEvent;

public class ErrorsDetectingAppender extends AppenderSkeleton {

    private static boolean errorsOccured = false;

    public static boolean errorsOccured() {
        return errorsOccured;
    }

    public ErrorsDetectingAppender() {
        super();
    }

    @Override
    public void close() {
        // TODO Auto-generated method stub
    }

    @Override
    public boolean requiresLayout() {
        return false;
    }

    @Override
    protected void append(LoggingEvent event) {
        if (event.getLevel().toString().toLowerCase().equals("error")) {
            System.out.println("-----------------Errors detected");
            this.errorsOccured = true;
        }
    }
} 
```

log4j 配置文件必须只包含新附加程序的定义及其对选定记录器的附件（在我的情况下为根）：

```
log4j.rootLogger = OTHER_APPENDERS, ED
log4j.appender.ED=com.your.package.ErrorsDetectingAppender 
```

您可以在程序执行流程中的某个重要点调用 ErrorsDetectingAppender 的 errorsOccured() 方法，也可以通过在 append() 方法中的 if 块中添加功能来立即做出反应。这种方法与语义一致：检测到您认为错误并记录它们的事物。如果您稍后认为选定的错误不那么重要，您只需将日志记录级别更改为 log.warn() 并且不会发送报告。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T18:11:58.070

在这种情况下，我认为您最好的选择可能是编写一个自定义类加载器来处理应用程序中的所有类加载，并且每当请求异常类时，您都会返回一个包装所请求的异常类的类。这个包装器调用被包装的异常，但也记录异常事件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T18:13:56.770

我假设您的意思不是*任何*异常，而是任何*未捕获*的异常。

如果是这种情况[，Sun 网站上的这篇文章](http://java.sun.com/developer/JDCTechTips/2001/tt0109.html#handling)有一些想法。您需要将顶级方法包装在一个`try-catch`块中，并且还需要做一些额外的工作来处理其他线程。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T18:27:23.620

如果遇到 OutOfMemoryError 或 StackOverflow 等运行时异常，则可能无法发送电子邮件。很可能您将不得不生成另一个进程并捕获它引发的任何异常（使用上面提到的各种技术）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-09-16T16:11:30.767

根本没有充分的理由被告知每个抛出的异常。我猜您假设抛出的异常表明您“需要”知道的“问题”。但这是错误的。如果抛出、捕获和处理异常，一切都很好。您唯一*需要*担心的是抛出但未处理（未捕获）的异常。但是您可以自己在`try`...`catch`子句中执行此操作。

# windows - 如何在 MSDN 上快速找到 Win32 API 的 URL？

> ID：75230
> 
> 赞同：1
> 
> 时间：2008-09-16T18:08:22.447
> 
> 标签：windows, winapi

如何在 MSDN 上快速找到 Win32 API 的 URL？.NET 方法很容易——只需将方法名称（例如 System.Byte.ToString）添加到[http://msdn.microsoft.com/library/](http://msdn.microsoft.com/library/)即可。

但是，对于 Win32 API（比如 GetLongPathName），这不起作用：http: [//msdn.microsoft.com/en-us/library/GetLongPathName](http://msdn.microsoft.com/en-us/library/GetLongPathName)。

我希望能够在代码注释或文档中使用 URL。因此，通过 MSDN 或 Google 搜索获得的 URL（例如， http: [//msdn.microsoft.com/library/aa364980.aspx](http://msdn.microsoft.com/library/aa364980.aspx)）并不是我真正想要的。我真的希望我的代码注释看起来像：

// 等等等等等等。有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/GetLongPathName](http://msdn.microsoft.com/en-us/library/GetLongPathName)。

Win32 API 的神奇精灵是什么？还是仅适用于 .NET 方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T18:16:09.543

谷歌可能是你最好的选择。我知道 msdn 站点搜索一次又一次地将我指向错误的方向，但快速切换到 Google（“GetLongPathName 站点：msdn.microsoft.com”）永远不会让我出错。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-16T16:39:44.217

我通过*咳嗽*我使用[Linkify](http://www.codeproject.com/KB/macros/Linkify.aspx)，它可以让你链接

 *```
// see msdn:GetLongPathName 
```

到谷歌搜索japolllock 提到。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-16T16:44:20.773

您可以使用 MSDN 搜索。

[http://social.msdn.microsoft.com/Search/en-US/?Refinement=86&Query=GetLongPathName](http://social.msdn.microsoft.com/Search/en-US/?Refinement=86&Query=) **_**

`Refinement=86`代表 Win32 搜索。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T01:31:55.520

FWIW 如果您的机器上本地安装了**MSDN ，** [Zeus](http://www.zeusedit.com/forum/viewtopic.php?p=3758)编辑器具有搜索**MSDN**本地副本的功能。

例如，将光标放在文本文档中的**GetLongPathName**单词上并使用[Zeus](http://www.zeusedit.com/forum/viewtopic.php?p=3758)帮助、**快速帮助、当前单词**菜单，将加载以下**MSDN**页面：

*ms-help://MS.VSCC.v80/MS.MSDN.vAug06.en/fileio/fs/getlongpathname.htm*

# java - HQL 查询集合中的列

> ID：75245
> 
> 赞同：2
> 
> 时间：2008-09-16T18:09:17.733
> 
> 标签：java, hibernate, hql

是否可以使用具有这样的配置的 HQL 访问 table2 的各个列？

```
<hibernate-mapping>
  <class table="table1">
    <set name="table2" table="table2" lazy="true" cascade="all">
      <key column="result_id"/>
      <many-to-many column="group_id"/>
    </set>
  </class>
</hibernate-mapping> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T18:23:48.620

您可以查询它们，但不能使其成为 where 子句的一部分。例如，

```
select t1.table2.x from table1 as t1 
```

会工作，但是

```
select t1 from table1 as t1 where t1.table2.x = foo 
```

不会。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T18:11:34.173

它们只是 table1 的 table2 属性的属性。

```
select t1.table2.property1, t1.table2.property2, ... from table1 as t1 
```

你可能必须加入，像这样

```
select t2.property1, t2.property2, ... 
    from table1 as t1
    inner join t1.table2 as t2 
```

[这是休眠文档](http://www.hibernate.org/hib_docs/reference/en/html/queryhql.html#queryhql-select)的相关部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T19:47:47.873

假设 table2 有一个列“ `color varchar(128)`”，并且该列正确映射到 Hibernate。

你应该能够做这样的事情：

```
from table1 where table2.color = 'red' 
```

这将返回`table1`链接到列为“红色”的`table2`行的所有行。`color`请注意，在您的 Hibernate 映射中，您`set`的名称与其引用的表相同。上面的查询使用*集合*的名称，**而不是**表的名称。

# ms-access - 在 2003 年和 2007 年运行 Microsoft 访问数据库有什么影响？

> ID：75246
> 
> 赞同：1
> 
> 时间：2008-09-16T18:09:19.810
> 
> 标签：ms-access, vba

在 2003 年和 2007 年运行 Microsoft Access 数据库有什么影响？

有什么课我忘了上吗？

该程序最初是在 Office 2003 中构建的，然后在 2007 年运行。当运行它的机器上同时具有 2003 和 2007 时，似乎会发生问题。该问题似乎也源于对“Microsoft Access 12.0 Object Library”（或 2003 年的“Microsoft Access 11.0 Object Library”）的引用。要看到这一点，只需查看 VBA 屏幕上的工具：参考菜单。

该错误的症状基本上是无法识别代码（几乎就像它无法识别我正在使用的编程语言一样）。它通常在此之后带有一个框，上面写着“您作为事件属性设置输入的加载时表达式产生了以下错误：对象或类不支持事件集”。您还可以将“On Load”替换为按钮的“On Click”或文本框的“On Change”。

我个人怀疑计算机正在使用 Microsoft Access 11.0/12.0 对象库的一部分，然后将两者混合成一个无用的 VBA 引用。进一步证实了我的怀疑是在两者之间弹出的框，上面写着“配置 Microsoft Access” 另一个进一步证实我怀疑的问题是它将在首先打开的任何一个（例如 2007 年）上运行，然后不在另一个上运行（2003 继续示例）

唯一的另一个问题是我必须解决的问题是更改 DoCmd.OpenForm 的最后一部分 ,,,,, acFormReadOnly （或 acReadOnly，取决于机器在那一天的感觉 - 是的，它可以与一个一起工作，有一天，然后要我再切换一次）以简单地锁定单个文本框

也许它不是完全编码，但我认为它可能可以通过编码来修复。

希望这足以让某人想出一些东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T19:01:59.090

微软的官方立场是不支持也不推荐在同一台电脑上安装多个office版本，而Access 2007似乎就是为了向我们证明这一点！

也就是说，您可以通过执行以下操作来避免大多数问题：

1 - 将数据库拆分为后端和前端。将后端（表和关系）放在网络文件夹中，并将前端（所有其他对象）的副本放在每个用户的桌面上。

2 - 最好将前端设置为 mde，以避免每次在其他版本的 Access 中打开数据库时引用洗牌。

3 - 创建一个快捷方式以使用所需的 Access 版本打开前端，以便*始终*使用该版本打开前端。（记得使用快捷方式！）在快捷方式的目标中：

“Access 12 msaccess.exe 的路径”“db.mdb 的路径”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T18:26:28.427

我们有一个 MS-Acces 应用程序，使用 Access 2003 开发，可用于 Access 2003 和 Access 2007 的完整版或运行时版本（Access 2007 Runtime 是免费的，我们正在充分利用它！）。除了参考文献管理之外，没有什么特别的问题。我们的代码分析了电脑上安装的Office版本，并自动更新了对应的引用（不仅是Access，还有Excel、Outlook、Word等：代码很棘手但很有趣！）

据我所知，Office 2007 中没有弃用 Office 2003/VBA 中可用的主要对象、属性或方法。一旦这些引用问题得到解决，Office 2003 代码将与 Access 2007 一起运行。Office 2007 中引入了一些新对象，因此我不建议任何开发人员使用它来开发代码以进一步与 Access 2003 一起使用。

但是您问题的主要和真正问题是：为什么要在同一台计算机上运行两个 Access 版本？如果我想确保我的应用程序崩溃，我会这样做。我认为，如果您的目标是开发软件，那么您绝对应该为您的机器找到更好的配置！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T18:26:50.797

通常，不支持在一台计算机上安装多个版本的 Access，这将导致您在对象引用中看到的问题。

如果数据库是在 Access 2003 中创作的，编译为 .MDE，然后部署到运行 Access 2007 的单独 Windows 实例上，则应该不会有任何重大问题（除了 UI 更改，例如自定义工具栏被扔进加载项丝带）。

为了测试多个版本的 Access，您需要在每个版本之间进行某种形式的隔离。我使用多个虚拟机来完成此操作。我的主要 Windows VM 运行 Office 2007 和 IE7，我有第二个 VM，它具有 Office 2003 和 IE6 用于测试。

请注意，如果您只想将 Word、Excel 和 Outlook 2007 与 Access 2003 一起使用，您可以先自行安装 Access 2003，然后自定义安装 Office 2007 并取消选择 Access 2007。

# embedded - 您如何使用“目标远程”在 gdb 中重新开始运行程序？

> ID：75255
> 
> 赞同：34
> 
> 时间：2008-09-16T18:10:03.910
> 
> 标签：embedded, gdb, debugging

当您在同一台计算机上对可执行文件执行常规 gdb 会话时，您可以发出 run 命令，它将重新启动程序。

当您在嵌入式系统上运行 gdb 时，与 command 一样`target localhost:3210`，如何在不退出并重新启动 gdb 会话的情况下重新启动程序？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-03-05T00:09:54.203

您正在寻找[gdbserver 的多进程模式](http://sourceware.org/gdb/onlinedocs/gdb/Server.html)和[`set remote exec-file filename`](http://sourceware.org/gdb/onlinedocs/gdb/Remote-Configuration.html)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-16T20:35:47.367

不幸的是，我不知道如何重新启动应用程序并仍然保持您的会话。一种解决方法是将 PC 设置回程序的入口点。您可以通过以下任一方式调用：

`jump *function*`

或者

`set $pc=*address*`.

如果您将论点转换为`main`您可能需要再次设置它们。

编辑：

上述方法有几个注意事项可能会导致问题。

*   如果您在一个多线程程序中跳转到 main 将当前线程跳转到 main，所有其他线程仍然存在。如果当前线程持有锁......那么你有一些问题。
*   内存泄漏，如果您的程序流在初始化期间分配了一些东西，那么您只是在跳转时泄漏了一堆内存。
*   打开的文件仍将保持打开状态。如果你映射一些文件或地址，调用很可能会失败。

因此，使用跳转与重新启动程序不同。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-06T06:43:15.913

大概您正在嵌入式系统上运行 gdbserver。

您可以要求它重新启动程序，而不是使用[目标扩展远程退出](http://web.archive.org/web/20090605020212/http://sourceware.org/gdb/current/onlinedocs/gdb_19.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-10-28T21:05:29.933

“跳转_start”是通常的方式。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-05-24T14:35:42.490

**分步程序**

偏僻的：

```
# pwd contains cross-compiled ./myexec
gdbserver --multi :1234 
```

当地的：

```
# pwd also contains the same cross-compiled ./myexec
gdb -ex 'target extended-remote 192.168.0.1:1234' \
    -ex 'set remote exec-file ./myexec' \
    --args ./myexec arg1 arg2
(gdb) r
[Inferior 1 (process 1234) exited normally]
(gdb) r
[Inferior 1 (process 1235) exited normally]
(gdb) monitor exit 
```

在 Ubuntu 14.04 中测试。

也可以将 CLI 参数传递给程序：

```
gdbserver --multi :1234 ./myexec arg1 arg2 
```

并且该`./myexec`部分消除了对 的需要`set remote exec-file ./myexec`，但这有以下烦恼：

*   无证：[https ://sourceware.org/bugzilla/show_bug.cgi?id=21981](https://sourceware.org/bugzilla/show_bug.cgi?id=21981)
*   不显示`show args`并且不会在重新启动后持续存在：[https ://sourceware.org/bugzilla/show_bug.cgi?id=21980](https://sourceware.org/bugzilla/show_bug.cgi?id=21980)

传递环境变量和更改工作目录而不重新启动：[如何在不重新启动的情况下修改 gdbserver --multi 的环境变量和工作目录？](https://stackoverflow.com/questions/45149858/how-to-modify-the-environment-variables-of-gdbserver-without-restarting-it)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-03-13T03:31:48.890

如果您正在运行常规 gdb，您可以键入“run”快捷方式“r”，gdb 会询问您是否要重新启动程序

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-03-15T15:08:16.177

对我来说，[21.2 示例 GDB 会话启动](http://openocd.org/doc/html/GDB-and-OpenOCD.html#Sample-GDB-session-startup)中描述的方法效果很好。当我稍后在“（gdb）”提示符处输入时，目标硬件已重置，我可以使用（=继续）`monitor reset halt`重新启动应用程序。`c`

在运行之间可以省略该`load`命令，因为不需要一次又一次地刷新程序。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-06-10T16:13:18.847

您可以使用`jump`gdb 命令。为此，您可以检查您的`startup`脚本。我`startup script`有一个符号。

```
 .section  .text.Reset_Handler
  .weak  Reset_Handler
  .type  Reset_Handler, %function
Reset_Handler:  
   ldr   r0, =_estack
   mov   sp, r0          /* set stack pointer */ 
```

我想跳起来开始。这就是我使用的原因：

```
jump Reset_Handler 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-06-27T17:10:50.063

在 EFM32 Happy Gecko 上，没有任何建议对我有用，所以这是我从有关将 GDB 集成到 Eclipse 环境的文档中学到的内容。

```
(gdb) mon reset 0
(gdb) continue
(gdb) continue 
```

这使我处于从 IDE 重置时所期望的状态。

# .net - 如何为 .NET 制作并行编译器

> ID：75258
> 
> 赞同：7
> 
> 时间：2008-09-16T18:10:18.760
> 
> 标签：.net, language-design, compiler-theory

Nikhil Kothari 的[Script#](http://projects.nikhilk.net/ScriptSharp/)很可能是很长一段时间以来我在 JavaScript 领域看到的最令人惊叹的概念之一。这个问题不是关于 JavaScript，而是关于 .NET 运行时中的语言编译。

我一直对如何使用 .NET 平台为已经具有编译器（如 C#）的语言编写编译器非常感兴趣，该编译器将从原始编译器生成单独的输出，同时允许原始编译器生成输出在相同的构建操作期间使用相同的源，同时也引用/使用其他编译器的输出。

我不完全确定我是否足够了解这个过程，可以用正确的细节提出问题，但这是我目前看到这个过程的方式，根据 Script# docs 中的图表。我考虑过许多​​涉及复杂语言设计和编译的事情，这些事情可能能够利用这样的概念，我对其他人对这些概念的看法很感兴趣。

--

编辑：到目前为止，感谢您的评论；您的信息本身就很有趣，我想对其进行更多研究，但我的问题实际上是关于如何编写可以同时在同一源上运行的自己的编译器使用 CLR 产生多种不同类型的（可能）相互依赖的输出。Script# 用作示例，因为它使用相同的 C# 源代码生成 JavaScript 和程序集，同时使编译的程序集与 JavaScript 协作。我很好奇在设计这种性质的东西时各种方法和理论概念是什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T22:47:14.340

重要的是要意识到编译器所做的只是获取源语言（在本例中为 C#），对其进行解析，以便编译器具有对它而非人类有意义的表示（这是抽象语法树），然后执行对目标语言的简单代码生成（msil 是在 .NET 运行时上运行的语言的目标）。

现在，如果将 script# 代码转换为程序集并与其他 .NET 代码交互，则意味着此编译器必须生成 msil。script# 为此使用 csc.exe，这只是标准的 c# 编译器。现在要生成 javascript，它必须采用 c# 或 msil，对其进行解析，并生成 javascript 以发送到浏览器。文档说它有一个名为 ssc.exe 的自定义 c# -> js 编译器。

为了使客户端和服务器端的交互保持一致，它具有一组用 .NET 编写但也编译为 javascript 的参考程序集。不过，这不是编译器特定的问题，这些参考程序集是 script# 运行时。运行时可能负责您所感知的许多脚本# 魔法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T18:23:00.183

因此，假设您要将 C# 编译为 Javascript。您在问是否可以利用现有的 C# 编译器，所以不是直接将 C# 编译为 Javascript，而是实际上将 C# 编译器生成的 MSIL 转换为 Javascript？

当然，你可以这样做。一旦你有了 MSIL 二进制文件，你就可以对它做任何你想做的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T18:41:49.967

微软有一个名为[Volta](http://labs.live.com/volta/)的研究项目，其中包括将 msil 编译为 JavaScript。

> 一个开发人员工具集，用于使用现有和熟悉的工具、技术和模式构建多层 Web 应用程序。Volta 的声明式分层使开发人员能够将有关分发的架构决策推迟到最后可能的负责时刻。此外，由于跨多个层的共享编程模型，Volta 支持新的端到端分析和测试，以实现更高级别的应用程序性能、稳健性和可靠性。使用声明性层拆分，开发人员可以根据此分析数据细化架构决策。这节省了与手动重构相关的时间和成本。实际上，Volta 扩展了 .NET 平台，以进一步支持使用现有和熟悉的工具和技术开发软件+服务应用程序。
> 
> 您将应用程序架构和构建为 .NET 客户端应用程序，在开发过程的后期分配在服务器层和客户端层上运行的应用程序部分。您可以将 Web 浏览器或 CLR 作为客户端，而 Volta 可以处理层拆分的复杂性。编译器为客户端层创建跨浏览器 JavaScript，为服务器层创建 Web 服务，以及所有通信、序列化、同步、安全和其他样板代码，以将这些层联系在一起。实际上，Volta 可以在多种环境中提供最佳体验，而无需定制应用程序。

# perl - 为什么 Scalar::Util::Numeric 安装不正确？

> ID：75261
> 
> 赞同：2
> 
> 时间：2008-09-16T18:10:36.437
> 
> 标签：perl, installation, cpan

对不起，如果这一切一起运行；看起来换行符没有显示在预览窗口中。我在运行时得到了这个输出`sudo cpan Scalar::Util::Numeric`；谢谢，乔希。

```
jmm@freekbox:~/bfwsandbox/sa/angel/astroportal/dtu8e/resources$ sudo cpan Scalar::Util::Numeric
[sudo] jmm 的密码：
CPAN：可存储加载正常
去阅读/home/jmm/.cpan/Metadata
  数据库于格林威治标准时间 2008 年 9 月 9 日星期二 16:02:51 生成
CPAN：LWP::UserAgent 加载正常
使用 LWP 获取：
  ftp://ftp.perl.org/pub/CPAN/authors/01mailrc.txt.gz
去阅读/home/jmm/.cpan/sources/authors/01mailrc.txt.gz
使用 LWP 获取：
  ftp://ftp.perl.org/pub/CPAN/modules/02packages.details.txt.gz
去阅读/home/jmm/.cpan/sources/modules/02packages.details.txt.gz
  数据库于格林威治标准时间 2008 年 9 月 16 日星期二 16:02:50 生成

  有一个新的 CPAN.pm 版本 (v1.9205) 可用！
  [当前版本为v1.7602]
  你可能想试试
    安装包::CPAN
    重新加载cpan
  不退出当前会话。应该是无缝升级
  在我们跑步的时候...

使用 LWP 获取：
  ftp://ftp.perl.org/pub/CPAN/modules/03modlist.data.gz
去阅读/home/jmm/.cpan/sources/modules/03modlist.data.gz
要去写/home/jmm/.cpan/Metadata
为模块 Scalar::Util::Numeric 运行安装
为 C/CH/CHOCOLATE/Scalar-Util-Numeric-0.02.tar.gz 运行 make
CPAN: Digest::MD5 加载正常
/home/jmm/.cpan/sources/authors/id/C/CH/CHOCOLATE/Scalar-Util-Numeric-0.02.tar.gz 的校验和
扫描缓存 /home/jmm/.cpan/build 的大小
Scalar-Util-Numeric-0.02/
Scalar-Util-Numeric-0.02/更改
Scalar-Util-Numeric-0.02/lib/
Scalar-Util-Numeric-0.02/lib/Scalar/
Scalar-Util-Numeric-0.02/lib/Scalar/Util/
Scalar-Util-Numeric-0.02/lib/Scalar/Util/Numeric.pm
Scalar-Util-Numeric-0.02/Makefile.PL
Scalar-Util-Numeric-0.02/MANIFEST
Scalar-Util-Numeric-0.02/META.yml
Scalar-Util-Numeric-0.02/Numeric.xs
Scalar-Util-Numeric-0.02/ppport.h
Scalar-Util-Numeric-0.02/README
Scalar-Util-Numeric-0.02/t/
Scalar-Util-Numeric-0.02/t/pod.t
Scalar-Util-Numeric-0.02/t/Scalar-Util-Numeric.t
删除以前使用的 /home/jmm/.cpan/build/Scalar-Util-Numeric-0.02

  CPAN.pm：将构建 C/CH/CHOCOLATE/Scalar-Util-Numeric-0.02.tar.gz

检查您的套件是否完整...
看起来挺好的
为 Scalar::Util::Numeric 编写 Makefile
cp lib/Scalar/Util/Numeric.pm blib/lib/Scalar/Util/Numeric.pm
自动拆分 blib/lib/Scalar/Util/Numeric.pm (blib/lib/auto/Scalar/Util/Numeric)
/usr/bin/perl /usr/share/perl/5.8/ExtUtils/xsubpp -typemap /usr/share/perl/5.8/ExtUtils/typemap Numeric.xs > Numeric.xsc && mv Numeric.xsc Numeric.c
cc -c -D_REENTRANT -D_GNU_SOURCE -DTHREADS_HAVE_PIDS -DDEBIAN -fno-strict-aliasing -pipe -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -O3 -DVERSION=\"0.02\" -DXS_VERSION=\"0.02\ " -fPIC "-I/usr/lib/perl/5.8/CORE" Numeric.c
在 Numeric.xs:2 包含的文件中：
/usr/lib/perl/5.8/CORE/perl.h:420:24：错误：sys/types.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:451:19：错误：ctype.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:463:23：错误：locale.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:480:20：错误：setjmp.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:486:26：错误：sys/param.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:491:23：错误：stdlib.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:496:23：错误：unistd.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:776:23：错误：string.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:925:27：错误：netinet/in.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:929:26：错误：arpa/inet.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:939:25：错误：sys/stat.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:961:21：错误：time.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:968:25：错误：sys/time.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:975:27：错误：sys/times.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:982:19：错误：errno.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:997:25：错误：sys/socket.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:1024:21：错误：netdb.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:1127:24：错误：sys/ioctl.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:1156:23：错误：dirent.h：没有这样的文件或目录
在 /usr/lib/gcc/i486-linux-gnu/4.2.3/include/syslimits.h:7 包含的文件中，
                 来自 /usr/lib/gcc/i486-linux-gnu/4.2.3/include/limits.h:11，
                 来自 /usr/lib/perl/5.8/CORE/perl.h:1510，
                 来自 Numeric.xs:2:
/usr/lib/gcc/i486-linux-gnu/4.2.3/include/limits.h:122:61：错误：limits.h：没有这样的文件或目录
在 /usr/lib/perl/5.8/CORE/perl.h:2120 包含的文件中，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/handy.h:136:25：错误：inttypes.h：没有这样的文件或目录
在 /usr/lib/perl/5.8/CORE/perl.h:2284 包含的文件中，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/unixish.h:106:21：错误：signal.h：没有这样的文件或目录
在 Numeric.xs:2 包含的文件中：
/usr/lib/perl/5.8/CORE/perl.h:2421:33：错误：pthread.h：没有这样的文件或目录
在 Numeric.xs:2 包含的文件中：
/usr/lib/perl/5.8/CORE/perl.h:2423：错误：在“perl_os_thread”之前需要“=”、“,”、“;”、“asm”或“__attribute__”
/usr/lib/perl/5.8/CORE/perl.h:2424: 错误：在 'perl_mutex' 之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perl.h:2425：错误：在“perl_cond”之前需要“=”、“,”、“;”、“asm”或“__attribute__”
/usr/lib/perl/5.8/CORE/perl.h:2426: 错误：在 'perl_key' 之前需要 '='、','、';'、'asm' 或 '__attribute__'
在 /usr/lib/perl/5.8/CORE/iperlsys.h:51 包含的文件中，
                 来自 /usr/lib/perl/5.8/CORE/perl.h:2733，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/perlio.h:65:19：错误：stdio.h：没有这样的文件或目录
在 /usr/lib/perl/5.8/CORE/iperlsys.h:51 包含的文件中，
                 来自 /usr/lib/perl/5.8/CORE/perl.h:2733，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/perlio.h:259: 错误: '*' 标记之前的预期')'
/usr/lib/perl/5.8/CORE/perlio.h:262: 错误：在 '*' 标记之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perlio.h:265: 错误：在 '*' 标记之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perlio.h:268：错误：预期的声明说明符或“文件”之前的“...”
在 /usr/lib/perl/5.8/CORE/perl.h:2747 包含的文件中，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/sv.h:389：错误：“DIR”之前的预期说明符限定符列表
在 /usr/lib/perl/5.8/CORE/op.h:497 包含的文件中，
                 来自 /usr/lib/perl/5.8/CORE/perl.h:2754，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/reentr.h:72:20：错误：pwd.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/reentr.h:75:20：错误：grp.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/reentr.h:85:26：错误：crypt.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/reentr.h:90:27：错误：shadow.h：没有这样的文件或目录
在 /usr/lib/perl/5.8/CORE/op.h:497 包含的文件中，
                 来自 /usr/lib/perl/5.8/CORE/perl.h:2754，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/reentr.h:612：错误：字段“_crypt_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:620：错误：字段“_drand48_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:624：错误：字段“_grent_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:635：错误：字段“_hostent_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:654：错误：字段“_netent_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:669：错误：字段“_protoent_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:684：错误：字段“_pwent_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:695：错误：字段“_servent_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:710：错误：字段“_spent_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:721：错误：字段“_gmtime_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:724：错误：字段“_localtime_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:771：错误：字段“_random_struct”的类型不完整
/usr/lib/perl/5.8/CORE/reentr.h:772：错误：“int32_t”之前的预期说明符限定符列表
在 /usr/lib/perl/5.8/CORE/perl.h:2756 包含的文件中，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/av.h:13：错误：“ssize_t”之前的预期说明符限定符列表
在 /usr/lib/perl/5.8/CORE/perl.h:2759 包含的文件中，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/scope.h:232：错误：“sigjmp_buf”之前的预期说明符限定符列表
在 Numeric.xs:2 包含的文件中：
/usr/lib/perl/5.8/CORE/perl.h:2931: 错误：在 'getuid' 之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perl.h:2932：错误：在 'geteuid' 之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perl.h:2933：错误：在 'getgid' 之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perl.h:2934: 错误：在 'getegid' 之前需要 '='、','、';'、'asm' 或 '__attribute__'
在 Numeric.xs:2 包含的文件中：
/usr/lib/perl/5.8/CORE/perl.h:3238:22：错误：math.h：没有这样的文件或目录
在 /usr/lib/perl/5.8/CORE/perl.h:3881 包含的文件中，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/thrdvar.h:85：错误：字段“Tstatbuf”的类型不完整
/usr/lib/perl/5.8/CORE/thrdvar.h:86：错误：字段“Tstatcache”的类型不完整
/usr/lib/perl/5.8/CORE/thrdvar.h:91：错误：字段“Ttimesbuf”的类型不完整
在 /usr/lib/perl/5.8/CORE/perl.h:3883 包含的文件中，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/intrpvar.h:66：错误：“time_t”之前的预期说明符限定符列表
在 /usr/lib/perl/5.8/CORE/perl.h:3950 包含的文件中，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/proto.h:128：错误：预期的声明说明符或“...”在“mode_t”之前
/usr/lib/perl/5.8/CORE/proto.h:128：错误：预期的声明说明符或“...”在“uid_t”之前
/usr/lib/perl/5.8/CORE/proto.h:297：错误：预期的声明说明符或“...”在“off64_t”之前
/usr/lib/perl/5.8/CORE/proto.h:299：错误：在“Perl_do_sysseek”之前需要“=”、“,”、“;”、“asm”或“__attribute__”
/usr/lib/perl/5.8/CORE/proto.h:300: 错误：在 'Perl_do_tell' 之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/proto.h:411：错误：预期的声明说明符或“...”在“gid_t”之前
/usr/lib/perl/5.8/CORE/proto.h:411：错误：预期的声明说明符或“...”在“uid_t”之前
/usr/lib/perl/5.8/CORE/proto.h:736：错误：在“Perl_my_fork”之前需要“=”、“,”、“;”、“asm”或“__attribute__”
/usr/lib/perl/5.8/CORE/proto.h:1020：错误：预期的声明说明符或“...”在“pid_t”之前
/usr/lib/perl/5.8/CORE/proto.h:1300：错误：预期的声明说明符或“...”在“pid_t”之前
/usr/lib/perl/5.8/CORE/proto.h:1456: 错误：在 '*' 标记之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/proto.h:2001：错误：在“Perl_PerlIO_read”之前需要“=”、“,”、“;”、“asm”或“__attribute__”
/usr/lib/perl/5.8/CORE/proto.h:2002：错误：在“Perl_PerlIO_write”之前需要“=”、“,”、“;”、“asm”或“__attribute__”
/usr/lib/perl/5.8/CORE/proto.h:2003：错误：在“Perl_PerlIO_unread”之前需要“=”、“,”、“;”、“asm”或“__attribute__”
/usr/lib/perl/5.8/CORE/proto.h:2004：错误：在“Perl_PerlIO_tell”之前需要“=”、“,”、“;”、“asm”或“__attribute__”
/usr/lib/perl/5.8/CORE/proto.h:2005：错误：预期的声明说明符或“...”在“off64_t”之前
在 /usr/lib/perl/5.8/CORE/perl.h:3988 包含的文件中，
                 来自 Numeric.xs:2:
/usr/lib/perl/5.8/CORE/perlvars.h:31: 错误：在 'PL_thr_key' 之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perlvars.h:48: 错误：在 'PL_op_mutex' 之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perlvars.h:52: 错误：在 'PL_dollarzero_mutex' 之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perl.h:4485:24：错误：sys/ipc.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:4486:24：错误：sys/sem.h：没有这样的文件或目录
/usr/lib/perl/5.8/CORE/perl.h:4611:24：错误：sys/file.h：没有这样的文件或目录
在 /usr/lib/perl/5.8/CORE/perlapi.h:38 包含的文件中，
                 来自 /usr/lib/perl/5.8/CORE/XSUB.h:349，
                 来自 Numeric.xs:3:
/usr/lib/perl/5.8/CORE/intrpvar.h:66: 错误：在 '*' 标记之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/intrpvar.h:237: 错误：在 '*' 标记之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/intrpvar.h:238: 错误：在 '*' 标记之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/intrpvar.h:239: 错误：在 '*' 标记之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/intrpvar.h:240: 错误：在 '*' 标记之前需要 '='、','、';'、'asm' 或 '__attribute__'
在 /usr/lib/perl/5.8/CORE/perlapi.h:39 包含的文件中，
                 来自 /usr/lib/perl/5.8/CORE/XSUB.h:349，
                 来自 Numeric.xs:3:
/usr/lib/perl/5.8/CORE/perlvars.h:31: 错误：在 '*' 标记之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perlvars.h:48: 错误：在 '*' 标记之前需要 '='、','、';'、'asm' 或 '__attribute__'
/usr/lib/perl/5.8/CORE/perlvars.h:52：错误：在 '*' 标记之前应有 '='、','、';'、'asm' 或 '__attribute__'
在来自 Numeric.xs:4 的文件中：
ppport.h:3042:1：警告：“PERL_UNUSED_DECL”重新定义
在 Numeric.xs:2 包含的文件中：
/usr/lib/perl/5.8/CORE/perl.h:163:1: 警告：这是之前定义的位置
Numeric.c：在函数“XS_Scalar__Util__Numeric_is_num”中：
Numeric.c:20：错误：“一元 *”的类型参数无效
Numeric.c:20：错误：“一元 *”的类型参数无效
Numeric.c:20：错误：“一元 *”的类型参数无效
Numeric.c:22：错误：“一元 *”的类型参数无效
Numeric.c:24：错误：“一元 *”的类型参数无效
Numeric.xs:16：错误：“一元 *”的类型参数无效
Numeric.xs:17：错误：“一元 *”的类型参数无效
Numeric.xs:20：错误：“一元 *”的类型参数无效
Numeric.xs:20：错误：“一元 *”的类型参数无效
Numeric.xs:20：错误：“一元 *”的类型参数无效
Numeric.xs:20：错误：“一元 *”的类型参数无效
Numeric.xs:20：错误：“一元 *”的类型参数无效
Numeric.c:36：错误：“一元 *”的类型参数无效
Numeric.c:36：错误：“一元 *”的类型参数无效
Numeric.c：在函数“XS_Scalar__Util__Numeric_uvmax”中：
Numeric.c:43：错误：“一元 *”的类型参数无效
Numeric.c:43：错误：“一元 *”的类型参数无效
Numeric.c:43：错误：“一元 *”的类型参数无效
Numeric.c:45：错误：“一元 *”的类型参数无效
Numeric.xs:26：错误：“一元 *”的类型参数无效
Numeric.xs:26：错误：“一元 *”的类型参数无效
Numeric.xs:26：错误：“一元 *”的类型参数无效
Numeric.xs:26：错误：“一元 *”的类型参数无效
Numeric.xs:26：错误：“一元 *”的类型参数无效
Numeric.c:51：错误：“一元 *”的类型参数无效
Numeric.c:51：错误：“一元 *”的类型参数无效
Numeric.c：在函数“boot_Scalar__Util__Numeric”中：
Numeric.c:60：错误：“一元 *”的类型参数无效
Numeric.c:60：错误：“一元 *”的类型参数无效
Numeric.c:60：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:63：错误：“一元 *”的类型参数无效
Numeric.c:65：错误：“一元 *”的类型参数无效
Numeric.c:65：错误：“一元 *”的类型参数无效
Numeric.c:66：错误：“一元 *”的类型参数无效
Numeric.c:66：错误：“一元 *”的类型参数无效
Numeric.c:67：错误：“一元 *”的类型参数无效
Numeric.c:67：错误：“一元 *”的类型参数无效
Numeric.c:67：错误：“一元 *”的类型参数无效
Numeric.c:67：错误：“一元 *”的类型参数无效
make: *** [Numeric.o] 错误 1
  /usr/bin/make -- 不行
运行 make 测试
  没有成功就无法测试
运行 make install
  make 已返回错误状态，安装似乎不可能
jmm@freekbox:~/bfwsandbox/sa/angel/astroportal/dtu8e/resources$

```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-16T18:22:50.870

您缺少 C 库开发头文件。您应该安装一个包含它们的软件包。这些是安装此模块所必需的，因为它必须编译一些非 perl C 代码并且需要更多地了解您的系统。

我不知道您使用的是哪种操作系统，但它看起来像 linux。如果是 debian，你应该可以使用 apt-get 来安装 'libc6-dev' 包。这将包含编译此模块所需的头文件。在其他类型的 linux 上会有一个类似命名的包。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T18:16:00.743

它找不到基本的系统头文件。您的包含路径严重混乱，或者未安装标头。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T18:23:17.793

没有换行符很难阅读，但看起来你`sys/types.h`的系统上缺少你。您是否安装了完整的构建环境（gcc、make 等）？您使用的是什么操作系统和发行版？

将来，您应该像这样引用输出（选择文本并单击引用按钮）。

# sql - 在多少种语言中，Null 不等于任何不等于 Null 的东西？

> ID：75267
> 
> 赞同：7
> 
> 时间：2008-09-16T18:10:55.750
> 
> 标签：sql, ruby, oracle, language-agnostic, vb6

在多少种语言中，Null 不等于任何不等于 Null 的东西？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-16T18:15:01.713

在 SQL（作为一种逻辑语言）中就是这种方式，因为 null 表示未知/未定义。

但是，在编程语言（例如 C++ 或 C#）中，空指针/引用是具有特定含义的特定值 - 没有。

两个虚无是等价的，但两个未知数不是。混淆来自于两个概念使用相同的名称（null）这一事实。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-26T05:54:17.703

在 VB6 中，表达式`Null = Null`将产生`Null`而不是`True`您所期望的。如果您尝试将其分配给布尔值，这将导致运行时错误，但是如果您将其用作 " `If ... Then`" 的条件，它将表现得像`False`. 而且`Null <> Null`还会**产生** ，`Null`所以：

**在 VB6 中，您可以说它`Null`既不等于自身（或其他任何东西），也不等于！**

您应该使用该`IsNull()`功能对其进行测试。

VB6 还有其他特殊值：

*   `Nothing`用于对象引用。`Nothing = Nothing`是编译错误。（您应该使用“ `is`”进行比较）
*   `Missing`对于尚未给出的可选参数。它没有文字表示，所以你甚至不能写`Missing = Missing`. （测试是`IsMissing(foo)`）
*   `Empty`对于未初始化的变量。尽管还有一个 function ，但这个确实 test equal to **its** own `IsEmpty()`。
*   ...如果我忘记了，请告诉我

我记得我对VB有点反感。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T18:12:15.950

甲骨文就是这样。

```
SELECT * FROM dual WHERE NULL=null;  --no rows returned 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T18:20:30.797

MySQL 有一个 null 安全的相等运算符 <=>，如果两边相等或两边都为 null，则返回 true。请参阅[MySQL 文档](http://dev.mysql.com/doc/refman/5.0/en/comparison-operators.html#operator_equal-to)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T18:29:41.243

你可以让红宝石​​这样工作：

```
class Null
 def self.==(other);false;end
end
n=Null
print "Null equals nothing" if n!=Null 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-26T06:36:00.787

在 C# 中，Nullable<bool> 具有关于逻辑运算符的有趣属性，但相等运算符与该语言中的其他类型相同（即 ((bool?)null == (bool?)null) == true） .

为了保持短路逻辑运算符[的短路](http://en.wikipedia.org/wiki/Short-circuit_evaluation)行为，并保持与非短路逻辑运算符的一致性，可为空的布尔值具有一些有趣的属性。例如：真 || 空==真。false && null == false 等。这与其他三值逻辑语言如[ANSI SQL](http://en.wikipedia.org/wiki/SQL#Standardization)直接矛盾。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-26T19:02:31.313

在 SQL 中，您必须执行以下操作：

```
WHERE column is NULL 
```

而不是

```
WHERE column = NULL 
```

# database - Eclipse 的开源数据库插件？

> ID：75270
> 
> 赞同：6
> 
> 时间：2008-09-16T18:11:15.420
> 
> 标签：database, eclipse, ide

有谁知道在 Eclipse 中用于数据库查询和探索的优秀开源插件？

Eclipse 中的活动 Database Exploring 插件实际上是针对与 Java 项目相关联的。虽然我只是想运行临时查询并探索架构。我正在有效地寻找一个通用的、快速的查询工具，而无需创建代码项目的开销。我为 Eclipse 找到了几个开源数据库插件，但这些插件在一年多的时间里都没有得到积极的开发。

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T18:13:11.407

我使用 SQL 资源管理器。

它以 Eclipse 插件或独立的形式提供。

[http://eclipsesql.sourceforge.net/](http://eclipsesql.sourceforge.net/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T19:42:44.733

我使用 Quantum DB，它似乎工作得很好。

[http://quantum.sourceforge.net/](http://quantum.sourceforge.net/)

# asp.net - ASP.NET、VS2008 中的“无法重新格式化文档”

> ID：75273
> 
> 赞同：10
> 
> 时间：2008-09-16T18:11:47.307
> 
> 标签：asp.net, visual-studio, visual-studio-2008, user-controls

我在**ASP.NET UserControl**中。当我键入 Control-K、Control-D 重新格式化所有标记时，我从 VS 2008 收到一系列消息：

“无法重新格式化文档。原始格式​​已恢复。”

“无法完成动作。”

“操作无法完成，参数不正确。”

有人知道这是什么原因吗？

**编辑**：好的，这只是......奇怪。

问题在这里：

```
<asp:TableCell>
  <asp:Button Text="Cancel" runat="server" ID="lnkCancel" CssClass="CellSingleItem" />
</asp:TableCell> 
```

不知何故， asp:Button 行导致了问题。但是，如果我删除任何单个属性，格式就会起作用。或者，如果我添加一个新属性，格式就有效。或者，如果我将标签更改为非自动关闭，它会起作用。但是，如果我撤消并保持原样，它就不起作用。

我所能想到的是，这是某种非常晦涩、奇怪的错误。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-16T18:12:40.050

您的文档中的某处可能存在一些格式错误的标记。您是否在新文档上尝试过？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-09-07T09:53:04.200

今天确实遇到了问题。

我的解决方案：重新启动 Visual Studio

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T18:14:40.593

通常这种行为是由无效代码引起的。它可能只是导致它仍然允许编译程序的无效 HTML。

例如，如果标签像这样不匹配，IDE 无法重新格式化它。

```
<div><h1>My Title</div></h1 
```

检查您的警告以查看是否有任何条目指向不匹配或未关闭的标签。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-08T08:39:03.460

选择整个可疑代码段并使用 Ctrl+k,Ctrl+F 仅格式化所选段而不是整个文档。

这样，您可以找到问题的确切位置，特别是未关闭或不适当的关闭标签并修复它们。

完成所有逐段扫描后，您可以确定整个文档的格式

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-08-23T16:43:21.700

对我来说，这通常是空格的问题。要修复它，我打开查找和替换 (CTRL+H)，将**查找范围**设置为“当前文档”，选中**使用**并选择“正则表达式”。对于**查找**我输入的内容 ":b|\n"（减引号），对于**替换为**我输入一个空格。然后我单击**全部替换**。

上述步骤将用一个空格替换所有空格（包括换行符），并且下次格式化文档时，您应该不会收到任何错误。这是假设您没有格式错误的 HTML。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-02-02T23:24:45.697

我的问题是额外的`"`. 仔细看html。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T18:14:14.820

几周前我第一次遇到这种情况。我发现它归结为无效的 HTML。我不得不剪下部分内容并一次一点地将其粘贴回去以找出问题所在。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-12-04T20:56:22.673

对我来说，我的标记代码中有一些虚假字符。我只是通过将所有文本复制并粘贴到记事本中才发现这一点的。在那之后，我看到了假字符（显示为小方块）。我刚刚删除了这些行并重新输入了它们，现在一切正常。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-02-09T10:10:06.027

我有一个不需要的分号。但您可能有引号 (')、双引号 (")、分号 (;) 或任何特殊字符。

因此，使用更多详细信息和屏幕截图编辑我的答案，因为它仍然非常活跃。

[![在此处输入图像描述](https://i.stack.imgur.com/7jn4Z.png)](https://i.stack.imgur.com/7jn4Z.png)

通过双击错误转到该行并搜索多余的（不需要的）引号 (')、双引号 (")、分号 (;) 或任何特殊字符。删除它，因为它会导致错误。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-12-27T12:32:51.420

只是为了添加更多信息。此问题是由于`html`. 运行应用程序时不会导致任何阻塞。

不幸的是，这里提到的解决方案对我不起作用。1.重新启动visual studio 2.使用正则表达式替换空格等

解决此问题的最佳解决方案是转到导致问题的特定行并检查该行是否有任何无效符号，例如`,`或`"`。只需将其删除，它就会正常工作。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-11-14T06:32:30.553

我的问题是 html 属性值中的“额外”，删除它后它对我来说工作正常。

# c# - SelectedIndexChanged 事件处理程序获取旧索引

> ID：75282
> 
> 赞同：9
> 
> 时间：2008-09-16T18:12:33.937
> 
> 标签：c#, asp.net, webforms

我正在处理`onSelectIndexChanged`事件。当 DropDownList 选择更改时引发事件。问题是 DropDownList 仍然返回`SelectedValue`and的旧值`SelectedIndex`。我究竟做错了什么？

这是 aspx 文件中的 DropDownList 定义：

```
<div style="margin: 0px; padding: 0px 1em 0px 0px;">
    <span style="margin: 0px; padding: 0px; vertical-align: top;">Route:</span>
    <asp:DropDownList id="Select1" runat="server" onselectedindexchanged="index_changed" AutoPostBack="true">
    </asp:DropDownList>
    <asp:Literal ID="Literal1" runat="server"></asp:Literal>
</div> 
```

这是 DropDownList`OnSelectedIndexChanged`事件处理程序：

```
protected void index_changed(object sender, EventArgs e)
{
    decimal d = Convert.ToDecimal( Select1.SelectedValue );
    Literal1.Text = d.ToString();
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-16T18:14:21.577

您在页面加载中是否有任何代码偶然将值重新默认为第一个值？

当页面重新加载时，您是否看到新值？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T19:08:19.497

如果您使用的是 AJAX，您可能还会进行回调，而不是完整的回发。在这种情况下，您可能希望在页面加载方法中使用它：

```
 if (!IsCallback && !IsPostBack)
        {
            // Do your page setup here
        } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T18:22:11.417

添加这个：如果 page.isnotpostback {

} 围绕您的代码绑定下拉列表。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T18:26:39.503

这似乎很明显，但无论如何。您是否在其他事件处理程序（如 OnLoad）中使用初始值初始化此下拉列表？如果是这样，您应该检查该事件是由回发还是由第一次加载引起的。所以你应该有类似的东西

```
if(!IsPostback) d.SelectedValue = "Default" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T18:21:31.933

您是否可以在整个数据源中为下拉列表复制项目？

# haskell - 哪些语言实现了函数式编程的特性？

> ID：75303
> 
> 赞同：1
> 
> 时间：2008-09-16T18:14:00.720
> 
> 标签：haskell, functional-programming, lisp, enterprise, ml

Lisp 很早就在学术界开发了一组有趣的语言特性，但其中大多数从未在生产环境中流行起来。

一些语言，比如 JavaScript，适应了垃圾收集和词法闭包等基本特性，但所有可能真正改变大规模编写程序方式的东西，比如强大的宏、代码即数据和自定义控制结构，只是似乎在其他函数式语言中传播，这些语言都不适用于非平凡的项目。

函数式编程社区还提出了许多其他有趣的想法（除了函数式编程本身），例如引用透明性、通用大小写表达式（即模式匹配，不像 C/C# 开关那样残缺不全）和柯里化函数，这似乎在常规编程中显然很有用，并且应该很容易与现有的编程实践集成，但由于某种原因似乎永远停留在学术界。

为什么这些功能很难被采用？是否有任何现代实用的语言实际上从 Lisp 中学习，而不是半途而废地复制“一流的功能”，或者是否存在使这不可能的内在冲突？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-16T19:00:49.997

> *是否有任何现代实用的语言实际上从 Lisp 中学习，而不是半途而废地复制“一流的功能”，或者是否存在使这不可能的内在冲突？*

为什么 lisp、haskell、ocaml 或 f# 不是现代的？

您可能只需要自己承担并查看它们并意识到它们更健壮，使用像 java 这样的库，然后您会想。

许多功能已从功能语言应用到其他语言。但反之亦然——例如，（某些）函数式语言具有对象。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T18:18:50.927

[Scala](http://www.scala-lang.org)是一种很酷的函数式/OO 语言，具有模式匹配、一等函数等。它具有编译成 Java 字节码的优点，并且与 Java 代码的互操作性很好。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-16T22:52:48.740

我建议你试试[Clojure](http://clojure.org)。语法优美的方言、功能性（在 ML 意义上）和*快速*。您将获得不变性、软件事务内存、多版本并发控制、REPL、SLIME 支持和取之不尽的 FFI。它是商业程序员的 Lisp (& Haskell)。在我的实际工作中，我每天都在使用它，度过了愉快的时光。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-17T01:40:53.453

语言“流行”与是否具有强大的、经过充分研究的、精心设计的特性之间没有已知的相关性。

关于这个问题已经说了很多。它存在于技术和艺术中的所有地方。我们知道艺术家 A 比艺术家 B 受过更多培训，创作的作品更广、更深入，但艺术家 B 在市场上更成功。是因为有时代精神吗？是因为艺人B有更好的营销吗？是因为大多数人不会花时间去了解艺术家A吗？也许艺术家B暗地里很糟糕，我们应该不相信对艺术家做出判断的专家？可能以上所有，在某种程度上。

这让学习艺术的人和学习编程语言的人疯狂。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-16T19:55:41.643

Common Lisp，在现实世界中使用，虽然不是很疯狂，我猜。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-16T18:34:52.727

蟒蛇或红宝石。请参阅 Paul Graham在“我喜欢 Lisp 但我的公司不让我使用它。我应该怎么做？”的问题[中对此的看法。](http://www.paulgraham.com/lispfaq1.html)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-16T19:59:55.113

Scala 是采用重要学术特征的语言的绝对王者。高级种类、自类型、多态模式匹配等。所有这些都是前沿（或接近它）的学术研究主题，已作为基本特性纳入 Scala。可以说，这有损于语言的简单性，但它确实导致了一些非常有趣的模式。

C# 比 Scala 更主流，但它也很少采用这些“外在”的功能特性。LINQ 是 Wadler 的广义列表推导的有限实现，每个人都知道 lambda。但尽管如此，C#（理所当然地）在采用学术界的研究特征方面仍然有点保守。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-09-16T20:07:42.817

Erlang 最近获得了新的曝光，不仅通过 Twitter 使用，还通过 XMPP 驱动的消息传递和 ejabberd 等实现的兴起。它体现了许多来自函数式编程的想法，这是一种在设计时考虑到这一点的语言。最初用于运行电话交换机，并由爱立信构思运行第一个 GSM 网络。它仍然存在，功能齐全（作为一种语言）并在许多生产环境中使用。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-16T18:47:21.950

卢阿。

它被用作许多游戏（如魔兽世界）和应用程序（Snort、NMAP、Wireshark 等）的脚本/扩展语言。事实上，根据 Adob​​e 开发人员的说法，Adobe 的 Lightroom 超过 40% 是 Lua。

Lua 背后的家伙多次将 Scheme 和 Lisp 列为对 Lua 的主要影响，Lua 甚至被描述为没有括号的 Scheme。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-16T18:19:14.777

你检查过[F#](http://research.microsoft.com/fsharp/fsharp.aspx)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-16T18:23:53.643

许多动态编程语言实现了函数式编程的想法。较新的 .Net 语言（C# 和 VB）具有他们所谓的 lambda，但它们并非没有副作用。

例如，将函数式编程和面向对象编程的概念结合起来并不难，但它并不总是很有意义。面向对象的语言（尝试）将状态封装在对象内，而函数式语言将状态封装在函数内。如果你用一种语言结合对象和函数，就很难理解这一切。

已经有很多语言通过将这些范式组合在一起（F#）来组合这些范式，这可能很有用，但我认为我们仍然需要几十年的时间来使用这样的语言，直到我们可以创建一个成功的新范式将结合 oo 和函数式编程的思想。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-16T18:27:16.083

C# 3.0 肯定可以。

C# 现在有

1.  Lambda 表达式
2.  高阶函数
3.  映射/减少 + 过滤器（折叠？）到列表和所有实现 IEnumerable 的类型。
4.  LINQ
5.  对象 + 集合初始化器。

最后两个列表项可能不属于正确的函数式编程，无论如何答案是 C# 已经实现了许多来自 Lisp 等的有用概念。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-16T20:11:45.693

除了上面所说的，很多 LISP 的优点是基于保证没有副作用和使用内置的数据结构。两者都很少在现实世界中成立。ML 可能是更好的功能基础。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-19T11:00:18.190

> Lisp 很早就在学术界开发了一组有趣的语言特性，但其中大多数从未在生产环境中流行起来。

因为管理软件开发人员的那种人不是那种你可以与之进行有趣聊天比较不同语言功能的人。大约在 2000 年，我想使用 LISP 在我们的公司网站上实现 XML 到 HTML 的转换（这大约是亚马逊在 LISP 中实现后端的时候）。我没来得及。看到我工作的公司制造和销售[Common LISP 环境](http://en.wikipedia.org/wiki/LispWorks)，这有点讽刺。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-09T16:38:46.077

另一种实现函数式编程特性的“现实世界”语言是 Javascript。既然绝对一切都有价值，那么高阶函数很容易实现。您还拥有函数式编程的其他租户，例如 lambda 函数、闭包和柯里化。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-19T09:58:18.877

您所指的功能（“强大的”宏、代码即数据和自定义控制结构）尚未在其他功能语言中传播。在 Lisp 告诉我们它们是个坏主意后，它们就死了。

现代函数式语言（OCaml、Haskell、Erlang、Scala、F#、C# 3.0、JavaScript）没有这些特性。

干杯，乔恩·哈罗普。

# x11 - X 中的多色光标

> ID：75312
> 
> 赞同：1
> 
> 时间：2008-09-16T18:14:48.283
> 
> 标签：x11, mouse-cursor

X 具有 XCreatePixmapCursor 方法从颜色深度为 1 的像素图创建光标。前景色和背景色可以不是黑色和白色，但只有两种颜色。

有没有办法在 X 中创建一个多色光标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T18:19:07.790

您可能需要使用 X Cursor Extensions。请参阅[XCURSOR(3)](http://www.xfree86.org/4.3.0/Xcursor.3.html)联机帮助页和 X11/Xcursor/Xcursor.h 头文件。

# asp.net - 系统未定义

> ID：75322
> 
> 赞同：64
> 
> 时间：2008-09-16T18:16:11.773
> 
> 标签：asp.net, javascript, asp.net-ajax

我有一个正在处理的 ASP.Net/AJAX 控制工具包项目。80%的时间没有问题。页面按应有的方式运行。如果您刷新页面，它有时会显示 javascript 错误“系统未定义”。

它不会一直发生，但它是可重现的。发生这种情况时，用户必须关闭浏览器并重新打开页面。

这让我相信它可能是一个 IIS 设置。

另一个注意事项。当我收到错误时，我查看了页面源代码，什么时候没有。当页面抛出错误时，缺少以下代码：

```
<script src="/ScriptResource.axd?d=EAvfjPfYejDh0Z2Zq5zTR_TXqL0DgVcj_h1wz8cst6uXazNiprV1LnAGq3uL8N2vRbpXu46VsAMFGSgpfovx9_cO8tpy2so6Qm_0HXVGg_Y1&amp;t=baeb8cc" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
if (typeof(Sys) === 'undefined') throw new Error('ASP.NET Ajax client-side framework failed to load.');
//]]>
</script> 
```

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-11-11T22:27:24.900

我通过在页面的 HTML 中将`<script type="text/javascript"></script>`包含 Sys.* 调用的块向下移动（到正文部分关闭之前的最后一项）来解决我的问题。`<asp:Content/>`我最初在`<asp:Content/>`页面的 HEAD 部分中有我的脚本块。我在一个有 MasterPageFile 的页面内工作。希望这可以帮助某人。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-04-01T21:44:07.670

当我遇到错误时

*   系统未定义
*   ASP.NET Ajax 客户端框架加载失败

在 IE 中使用 .NET 2.0 中的 ASP.NET Ajax 控件时，我需要将以下内容添加到`<system.web>`标签内的 web.config 文件中：

```
<httpHandlers>
  <remove verb="*" path="*.asmx"/>
  <add verb="*" path="*.asmx" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
  <add verb="GET" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler" validate="false"/>
</httpHandlers> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-16T18:28:19.310

尝试将您的 ScriptManager 设置为此。

```
<asp:ScriptManager ID="ScriptManager1" runat="server" EnablePartialRendering="true" /> 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-06-23T01:39:41.623

Dean L 的回答[https://stackoverflow.com/a/1718513/292060](https://stackoverflow.com/a/1718513/292060)对我有用，因为我打电话给 Sys 也为时过早。由于我使用的是 jQuery，而不是向下移动它，我将脚本放在 document.ready 调用中：

```
$(document).ready(function () {
  Sys. calls here
}); 
```

这似乎为时已晚，Sys 可用。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-02-19T14:57:23.437

我正在使用telerik并且遇到了完全相同的问题。

将此添加到 web.config 解决了我的问题:)

```
<location path="Telerik.Web.UI.WebResource.axd">   
   <system.web>  
     <authorization>  
       <allow users="*"/>  
     </authorization>  
   </system.web>  
</location> 
```

也许它也会帮助你。这是身份验证问题。

[资源](http://blogs.telerik.com/blogs/posts/10-03-16/common-reasons-for-the-lsquo-sys-is-undefined-rsquo-error-in-asp-net-ajax-applications.aspx)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-08-17T18:52:33.657

尝试以下解决方案之一：

**1、浏览器加载压缩脚本失败**

如果您在 IE6 上收到错误，通常是这种情况，但在其他浏览器上则没有。

脚本资源处理程序 – ScriptResource.axd 在将脚本返回到浏览器之前对其进行压缩。在 RTM 之前的版本中，处理程序一直为所有浏览器执行此操作，并且不可配置。IE6 的其中一个组件存在问题，阻止它正确加载压缩脚本。[请参阅此处](http://support.microsoft.com/default.aspx?scid=kb;en-us;Q312496)的知识库文章。在 RTM 版本中，我们对此进行了两个修复。一、如果IE6是浏览器客户端我们不压缩。第二，我们现在已经使压缩可配置。这是切换 web.config 的方法。

你如何解决它？首先，确保您使用的是 AJAX Extensions 1.0 RTM 版本。仅此一项就足够了。您还可以尝试通过编辑 web.config 来关闭压缩以具有以下内容：

```
<system.web.extensions>
<scripting>
<scriptResourceHandler enableCompression="false" enableCaching="true" />
</scripting>
</system.web.extensions> 
```

**2\. 您的应用程序的 web.config 中不存在 ScriptResourceHandler 所需的配置**

确保您的 web.config 包含随扩展安装提供的默认 web.config 文件中的条目。（默认位置：C:\Program Files\Microsoft ASP.NET\ASP.NET 2.0 AJAX Extensions\v1.0.61025）

**3\. 您用于 Web 的虚拟目录未正确标记为应用程序（因此未加载配置）- IIS Web 会发生这种情况。**

确保您使用的是 Web 应用程序，而不仅仅是虚拟目录

**4.ScriptResource.axd请求返回404**

这通常表明整个 ASP.NET 配置错误。在 ASP.NET 的默认安装中，对以 .axd 结尾的资源的任何 Web 请求都通过 isapi 映射从 IIS 传递到 ASP.NET。此外，映射配置为不检查文件是否存在。如果该映射不存在，或者检查文件是否存在未被禁用，则 IIS 将尝试查找物理文件 ScriptResource.axd，但找不到，并返回 404。

您可以通过从此处复制/粘贴完整 url 到 ScriptResource.axd 并查看它返回的内容来检查这是否是问题所在

```
<script src="/MyWebApp/ScriptResource.axd?[snip - long query string]" type="text/javascript"></script> 
```

你如何解决这个问题？如果 ASP.NET 根本没有正确安装，您可以运行“aspnet_regiis.exe”命令行工具来修复它。它位于 C:\WINDOWS\Microsoft.Net\Framework\v2.0.50727。您可以运行“aspnet_regiis -i -enable”，它会在 IIS 上完成 ASP.NET 的完整注册，并确保在 IIS6 中启用 ISAPI。您还可以运行“aspnet_regiis -s w3svc/1/root/MyWebApp”来仅修复您的 Web 应用程序的注册。

**5.解决IIS 7下ASP.NET AJAX RTM中“Sys is undefined”的错误**

将此条目放在`<system.webServer/><handlers/>`：

```
<add name="ScriptResource" preCondition="integratedMode" verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" /> 
```

并删除`<system.web/><httpHandlers/>`.

参考资料： [http ://weblogs.asp.net/chrisri/demystifying-sys-is-undefined](http://weblogs.asp.net/chrisri/demystifying-sys-is-undefined) [http://geekswithblogs.net/lorint/archive/2007/03/28/110161.aspx](http://geekswithblogs.net/lorint/archive/2007/03/28/110161.aspx)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-11-23T20:27:55.060

您必须在 web.config 中添加这些行

```
<httpHandlers>
  <remove verb="*" path="*.asmx"/>
  <add verb="*" path="*.asmx" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
  <add verb="*" path="*_AppService.axd" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
  <add verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" validate="false"/>
</httpHandlers>
<httpModules>
  <add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
</httpModules>
</system.web> 
```

希望这可以帮助。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-18T23:00:36.410

除了确保您的页面上有 ScriptManager 之外，您还需要确保您的 web.config 已正确配置。

当 ASP.NET AJAX 1.0 发布时（对于 .NET 2.0），有很多自定义 web.config 设置添加了处理程序、控件等。

您可以在此处找到配置信息：[http ://www.asp.net/AJAX/documentation/live/ConfiguringASPNETAJAX.aspx](http://www.asp.net/AJAX/documentation/live/ConfiguringASPNETAJAX.aspx)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-10-19T00:18:41.540

我讨厌添加如此庞大的主题以及以后添加，但我认为我至少有一个可以在 VS2015 中使用的解决方案。

我正在寻找导致系统错误的原因，唯一对我有用的解决方案是添加这样`EnableCdn="true"`的：`ScriptManager`

```
<asp:ScriptManager ID="ScriptManager1" runat="server" EnableCdn="true" /> 
```

有关详细信息，请参阅 MSDN。

**为什么我们需要这样做？**

在使用 asp.net Web 应用程序时，您必须启用 CDN 以便 Microsoft 可以下载该`Sys.`库。

您的页面中可能有一个脚本正在使用该`Sys`函数。设置`EnableCdn="true"`将确保在使用`Sys`库之前下载库。

**什么是 CDN？**

来自[https://www.sitepoint.com/7-reasons-to-use-a-cdn/的引用](https://www.sitepoint.com/7-reasons-to-use-a-cdn/)

> 大多数 CDN 用于托管静态资源，例如图像、视频、音频剪辑、CSS 文件和 JavaScript。您会在各种公共和私有 CDN 系统上找到常见的 JavaScript 库、HTML5 垫片、CSS 重置、字体和其他资产。

谷歌和微软都有 CDN。您所要做的就是添加参考。通常 CDN 是通过脚本资源添加的：

```
<script src="https://ajax.aspnetcdn.com/ajax/4.5.1/1/MicrosoftAjax.js" type="text/javascript"></script> 
```

一旦你设置了，微软就会在下载库`EnableCdn="true"`的页面中添加它的小 CDN 参考（如上面的参考） 。`Sys`

我希望这可以帮助遇到同样问题的任何人。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-14T07:58:46.173

确保您拥有的与 .NET AJAX 交互的任何客户端脚本末尾都有以下行：

```
if (typeof(Sys) !== 'undefined')  Sys.Application.notifyScriptLoaded(); 
```

这告诉脚本管理器整个脚本文件已经加载并且可以开始调用客户端方法

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-11T18:44:35.247

我遇到了同样的问题，经过多次争论后，我决定尝试隔离问题并简单地将脚本管理器加载到一个空白页面中，但仍然导致同样的错误。通过将我的站点的 web.config 与一个全新的（工作的）测试站点进行比较，隔离了我发现的问题，该站点在我的 web.config 的 system.web 部分中 更改`<compilation debug="true">`为解决了问题。`<compilation debug="false">`

我还必须`<xhtmlConformance mode="Legacy"/>`从 system.web 中删除该条目以使更新面板正常工作。 [单击此处](http://weblogs.asp.net/scottgu/archive/2006/12/10/gotcha-don-t-use-xhtmlconformance-mode-legacy-with-asp-net-ajax.aspx)了解此问题的说明。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-06-09T11:07:13.673

我通过创建单独的 asp.net ajax 解决方案并将所有 ajax 配置从 web.config 复制并粘贴到工作项目来解决了这个问题。

这是您应该在 web.config 中设置的必须配置

```
 <configuration>
<configSections>
    <sectionGroup name="system.web.extensions" type="System.Web.Configuration.SystemWebExtensionsSectionGroup, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35">
        <sectionGroup name="scripting" type="System.Web.Configuration.ScriptingSectionGroup, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35">
            <section name="scriptResourceHandler" type="System.Web.Configuration.ScriptingScriptResourceHandlerSection, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" requirePermission="false" allowDefinition="MachineToApplication"/>
</sectionGroup>

    </sectionGroup>
</configSections> 
```

```
 <assemblies>

            <add assembly="System.Web.Extensions,     Version=1.0.61025.0,       Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>

        </assemblies>
           </compilation>
        <httpHandlers>
        <remove verb="*" path="*.asmx"/>
        <add verb="*" path="*.asmx" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
        <add verb="*" path="*_AppService.axd" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
        <add verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" validate="false"/>
    </httpHandlers>
    <httpModules>
        <add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
    </httpModules>
</system.web>
    <system.webServer>
    <validation validateIntegratedModeConfiguration="false"/>
    <modules>
        <add name="ScriptModule" preCondition="integratedMode" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
    </modules>
    <handlers>
        <remove name="WebServiceHandlerFactory-Integrated"/>
        <add name="ScriptHandlerFactory" verb="*" path="*.asmx" preCondition="integratedMode" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
        <add name="ScriptHandlerFactoryAppServices" verb="*" path="*_AppService.axd" preCondition="integratedMode" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
        <add name="ScriptResource" preCondition="integratedMode" verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
    </handlers>
</system.webServer> 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-08-18T16:05:12.550

将我的 AjaxControlToolkit.dll 从 4.1.60623.0 更新到最新版本 4.1.7.725 后，我遇到了同样的问题。我已经搜索并来到了这个页面，但没有一个答案对我有帮助。在查看 CodePlex zip 文件中的 Ajax Control Toolkit 的示例网站后，我意识到`<asp:ScriptManager>`被新的`<ajaxtoolkit:ToolkitScriptManager>`. 我这样做了，并且不再*有未定义的 Sys.Extended*。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-05-29T19:23:16.293

如果上述方法都不适合您，并且您碰巧覆盖了 OnPreRenderComplete，请确保调用 base.OnPreRenderComplete。我的治疗师会很高兴看到我回来

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-09-21T14:16:29.160

就我而言，问题是我在部分回发后放置了以下代码以保留 gridview 表头：

```
 protected override void OnPreRenderComplete(EventArgs e)
    {
        if (grv.Rows.Count > 0)
        {
            grv.HeaderRow.TableSection = TableRowSection.TableHeader;
        }
    } 
```

删除此代码停止了该问题。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-05-16T16:23:21.933

我在使用 Ajax Control Toolkit ToolkitScriptManager 和 URL Write 2.0 的组合时发现了错误。

在我的`<rewrite> <outboundRules>`我有一个先决条件：

```
<preConditions>
    <preCondition name="IsHTML">
        <add input="{RESPONSE_CONTENT_TYPE}" pattern="^text/html"/>
    </preCondition>
</preConditions> 
```

但显然我的一些出站规则没有设置为使用前提条件。

一旦我在所有出站规则上设置了该前置条件：

```
<rule preCondition="IsHTML" name="MyOutboundRule"> 
```

没有更多的问题。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-11-29T17:58:28.267

开发环境：

*   开发环境：VS 2012
*   外汇：4.0/4.5
*   实现：Master(ScriptManager + UpdatePanel/Timer) + Content (UpdatePanel)
*   模式：PageRouting。

## 免责声明：

如果所有`web.config`解决方案都不适合您并且您已经实现了 PageRouting (IIS 7+)，那么下面的代码片段将解决您的问题。

## 背景：

不要想劫持这个问题，但和其他人有同样的问题，并在这里实施了 100% 的建议，对 .Net 4.0/4.5 进行了少量修改，但没有一个对我有用。

在我的情况下，我已经实施了[页面路由](http://msdn.microsoft.com/en-us/library/cc668201.aspx)，这让我的问题陷入了困境。基本上它可以工作大约 20 次，调试运行，然后 BAM 会因错误而`Sys is undefined`出错。

在查看了其他几篇关于 Clean-URL 逻辑的帖子后，我记得我已经完成了 PageRouting 设置。

这是我用来构建我的模式的资源：[页面路由](http://msdn.microsoft.com/en-us/library/cc668201.aspx)

我的单行代码修复了我的 VS2012 调试问题：

```
rts.Ignore("{resource}.axd/{*pathInfo}")    'Ignores any Resource cache references, used heavily in AJAX interactions. 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-24T16:44:05.600

遇到了类似的问题，除了我的页面一直在生成 Sys is undefined 错误。

对我来说，问题源于我刚刚为 .NET 2.0 安装了 AJAX 1.0 扩展，但已经在 Visual Studio 中创建了我的 Web 项目。

当尝试创建 AJAX 控件时，我一直遇到这个错误，我在这里发现了 Slace 和 MadMax1138s 的帖子。并认为这是我的 web.config，我使用新的“启用 AJAX 的网站”项目类型创建了一个新项目，果然，web.config 具有使用 AJAX 控件所需的大量自定义项。

我刚刚使用我自己制作的 web.config 更新更新了该 web.config，并将其放入我现有的项目中，一切正常。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-08-18T10:41:20.223

我今天看到了完全相同的错误，但这不是配置或直接的 JavaScript 问题。

一个外部 .net 项目已更新，但未在网站编译中正确获取更改。我的假设是 ASP.NET ajax 无法正确构造 .NET 对象的客户端表示，因此无法正确加载。

为了解决这个问题，我重建了外部项目，并重建了我遇到问题的解决方案。问题消失了。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2012-02-25T09:06:10.803

我遇到了类似的问题，令我惊讶的是，我发现我的一位开发人员将 web.config 保存在与**web123.config**相同的文件夹/解决方案中，并且错误地上传了这两个文件。

一旦我删除了**web123.config**文件，这个错误就消失了，并且 ajax 框架正在正确加载。即使我有

```
<compilation debug="true"> 
```

就我而言，我也有以下部分。我的项目正在使用框架 3.5

```
 <httpHandlers>
  <remove verb="*" path="*.asmx"/>
  <add verb="*" path="*.asmx" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
  <add verb="*" path="*_AppService.axd" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
  <add verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" validate="false"/>
</httpHandlers>
<httpModules>
  <add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
</httpModules>
</system.web> 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2011-07-29T07:47:17.990

确保您没有任何更改您的网址的重写规则。

在我的情况下，应用程序认为它只比 url 更深。

示例： http: [//mysite.com/app/page.aspx](http://mysite.com/app/page.aspx)是真正的 url。但是我切断了 /app/ 这对 ASP.net 和 WCF 来说效果很好，但显然不适用于 Ajax。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2012-06-14T10:41:21.097

这听起来很愚蠢，但我在 VS2010 中开发并托管在 VS 开发服务器中的网站遇到了类似的问题。有问题的页面有一个脚本管理器来创建到 wcf 服务的连接。我向服务添加了一个额外的方法，这个错误开始出现。

为我解决的问题是在 oroject Web 设置中使用不同的端口号从“自动分配端口”更改为“特定端口”。

我希望我知道为什么...

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-02-13T23:48:29.557

即使在为 web config 添加了正确的条目后仍然出现此错误？此错误的最常见原因是 JavaScript 过早地引用了 Sys 命名空间。然后最明显的解决方法是将 java 脚本块移动到 ScriptManager 控件下方：

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-03-10T13:49:45.727

我有同样的问题，但我通过以下方式解决了它：

将脚本文件放入页面时，请确保它是

```
<script></script> and not <script />. 
```

我遵循了这个： [http ://forums.asp.net/t/1742435.aspx?An+element+with+id+form1+could+not+be+found+Script+error+on+page+load](http://forums.asp.net/t/1742435.aspx?An+element+with+id+form1+could+not+be+found+Script+error+on+page+load)

希望这会有所帮助

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2013-04-19T16:55:19.397

我不认为这一点已经被添加，因为我只是花了一些时间来寻找它，我希望它可以提供帮助。

我正在使用 IIS 7 并使用 ASP.NET v4 框架。
在我的情况下，**将一个条目添加到 web.config 文件中条目的 和 部分是很重要的。**

我的 web.config 文件有很多处理程序，在我的情况下，将 ScriptResources 条目添加到处理程序部分的顶部是最简单的。 **最重要的是，它需要放在任何将充当通配符并捕获请求的条目之前。** 在通配符条目之后添加它会导致它被忽略并且仍然会出现错误。

该模块可以添加到该部分的顶部或底部。

Web.config 示例：

```
<system.webServer>
    <handlers>
      <clear />
      <add name="ScriptResource" preCondition="integratedMode" verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
      <!-- Make sure wildcard rules are below the ScriptResource tag -->
    </handlers>
    <modules>
      <add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
      <!-- Other modules are added here -->
    </modules>
  </system.webServer> 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-05-07T06:53:35.917

添加

```
if (typeof(Sys) !== 'undefined') Sys.Application.notifyScriptLoaded(); 
```

请检查 [在此处输入链接描述](https://msdn.microsoft.com/en-us/library/vstudio/bb310952(v=vs.100).aspx)

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2016-05-27T02:20:40.513

就我而言，我找到了一个非常隐蔽的原因...... **Global.ascx.cs**中有这个页面路由，它没有出现在我的子文件夹中的测试中，但一直返回问题错误.. 另一个一天有奇怪的问题。

```
routes.MapPageRoute("siteDefault", "{culture}/", "~/default.aspx", false, new RouteValueDictionary(new { culture = "(\\w{2})|(\\w{2}-\\w{2})" })); 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-09-30T17:24:28.027

我知道这是一个旧线程，但我找到了一个有点独特的解决方案。就我而言，我遇到了错误，因为我在同一个 ASP.NET Web 应用程序中同时使用了 Webforms 和 MVC。映射路线后，问题出现了。我通过添加以下代码来修复它以忽略“{resource}.aspx/{*pathInfo}”和“{resource}.axd/{*pathInfo}”的路由

```
 private void RegisterRoutes(RouteCollection routes)
    {
        routes.IgnoreRoute("{resource}.aspx/{*pathInfo}");
        routes.IgnoreRoute("{resource}.axd/{*pathInfo}");

        routes.MapRoute(
           "Default", 
           "{controller}/{action}/{id}", 
           new { controller = "Test", action = "Index", id = UrlParameter.Optional }
       );
    } 
```

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2010-05-07T15:54:26.497

请检查服务器是否设置了正确的时间和日期...

在浪费了大约 6 个小时之后，我在某个地方读到了它......

必须更新服务器的日期和时间才能正常工作...

否则你会得到 'Sys' is undefined 错误。

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2010-09-21T06:19:54.117

嗨thanx很多它解决了我的问题，

默认情况下 vs 2008 会添加

```
 <!--<add verb="*" path="*.asmx" validate="false" type="Microsoft.Web.Script.Services.ScriptHandlerFactory, Microsoft.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
      <add verb="GET" path="ScriptResource.axd" type="Microsoft.Web.Handlers.ScriptResourceHandler" validate="false" />--> 
```

需要将默认配置（上）更正为以下代码 **FIX**

```
 <add verb="*" path="*.asmx" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
  <add verb="GET" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler" validate="false"/> 
```

* * *

## 回答 #31

> 赞同：-2
> 
> 时间：2010-05-18T10:30:31.190

只需在您的解决方案根目录中创建空白 .axd 文件，问题就会得到解决。（2 文件：scriptresouce.asx、webresource.asxd）

# xml - ruby 中/从 ruby 中的 XSLT 处理

> ID：75340
> 
> 赞同：2
> 
> 时间：2008-09-16T18:18:03.563
> 
> 标签：xml, ruby, linux, xslt

谁能推荐一种在 Ruby 应用程序中执行 XML 数据的 XSLT 转换的有效方法？XSL gem (REXSL) 尚不可用，虽然我已经看到一两个实现它的项目，但我对这么早就使用它们持谨慎态度。一位朋友向 Perl 推荐了一个 shell out call，但我担心资源问题。

这是针对linux环境的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T18:33:47.347

试试“libxslt-ruby”gem。它依赖于 libxml 库的“libxmlr-ruby”绑定，如果你在 Linux 上开发，你可能已经安装了它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T08:14:47.047

我会建议调用“xsltproc”，它与 linux 中的 libxslt 库一起提供并完成工作。

或者，如果您有任何机会使用 JRuby，那么您有几个用于 java 的 xslt 解析器，您可以在您的 ruby​​ 程序中非常轻松地使用它们。

# sql - 执行一次插入，然后登录一条 SQL 命令

> ID：75347
> 
> 赞同：0
> 
> 时间：2008-09-16T18:18:37.430
> 
> 标签：sql, sql-server

我被要求实现一些代码，这些代码将更新 MS SQL Server 数据库中的一行，然后使用存储过程将更新插入历史表中。我们无法添加存储过程来执行此操作，因为我们不控制数据库。我知道在存储过程中您可以进行更新，然后在另一个存储过程上调用执行。我可以使用一个 SQL 命令将其设置为在代码中执行此操作吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T18:28:46.330

要么在同一个语句中运行它们（用分号分隔单独的命令），要么使用事务，以便在第二个语句失败时回滚第一个语句。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T18:29:11.290

你真的不需要为此存储过程。问题实际上归结为您是否可以控制所有插入。如果实际上您可以访问所有插入，您可以简单地将插入包装到数据表中，并在单个事务中将插入插入到历史表中。这将确保两者都完成以实现“成功”。但是，在事务中按顺序访问表时，您需要确保先不锁定历史表，然后再锁定数据表，否则可能会出现死锁情况。

但是，如果您无法控制插入，您可以向某些数据库系统添加触发器，以便您可以访问已修改、插入或删除的数据。它可能会或可能不会为您提供所需的所有数据，例如谁进行了插入、更新或删除，但它会告诉您发生了什么变化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T18:25:49.020

您还可以创建 sql 触发器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T18:26:09.160

根据您的库，您通常可以将两个查询放在一个命令字符串中，用分号分隔。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T18:26:11.237

信息不足——什么SQL服务器？为什么要有历史表？

触发器会做这种事情。MySQL 的 binlog 可能对您更有用。

你说你不控制数据库。你控制访问它的代码吗？在此处添加日志记录并将其完全排除在 SQL 服务器之外。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T19:10:17.917

谢谢大家的回复，下面是我最后做的一个概要。现在来测试一下，如果发生故障，trans 是否真的回滚。

```
sSQL = "BEGIN TRANSACTION;" & _
           " Update table set col1 = @col1, col2 = @col2" & _
           " where col3 = @col3 and " & _
           " EXECUTE addcontacthistoryentry @parm1, @parm2, @parm3, @parm4, @parm5, @parm6; " & _
           "COMMIT TRANSACTION;" 
```

# sql - 在 SQL Server 2005 varchar 列上强制数字顺序，包含字母和数字？

> ID：75361
> 
> 赞同：0
> 
> 时间：2008-09-16T18:19:24.620
> 
> 标签：sql, sql-server, sql-order-by

我有一列包含字符串 'Operator (1)' 等等，直到 'Operator (600)' 为止。

我想让它们按数字排序，我想出了

```
select colname from table order by 
cast(replace(replace(colname,'Operator (',''),')','') as int) 
```

这是非常非常丑陋的。

更好的建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T18:23:16.063

就是这样，InStr()/SubString()，将 Operator(1) 更改为 Operator(001)，将 n 单独存储在 Operator(n) 中，或者创建一个计算列来隐藏丑陋的字符串操作。你所拥有的似乎很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:28:12.113

如果您确实*必须*以您拥有的格式保留数据 - 并且添加数字排序顺序列是更好的解决方案 - 然后考虑将文本操作包装在用户定义的函数中。

通过 dbo.udfSortOperator(colname) 从表顺序中选择 colname

它不那么难看，给你一些抽象。函数调用会产生额外的开销，但对于在不太严重的数据库服务器中包含数千行的表来说，这不是主要问题。在功能中做笔记，以便以后根据需要进行优化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T18:29:45.547

我的答案是改变问题。如果可能的话，我会在表中添加一个 operatorNumber 字段。更改更新/插入例程以提取数字并存储它。这样，每条记录的字符串转换命中只有一次。

每次运行查询时，排序逻辑都需要进行字符串转换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T20:17:13.170

好吧，首先定义该列的含义。运算符是一个名称，因此您可以使用字符来证明其合理性吗？或者它是一个数字？

如果该字段是名称，那么您将使用字符，然后您需要确定固定长度。在左侧用零填充所有运算符名称。定义运算符的命名规则（即没有字母。或者您将在“A001”之类的系列中使用的代码）

索引将对服务器中的物理数据进行排序。正确定义的文本命名将在查询中对它们进行排序。你会想要两者。

如果运算符是一个数字，那么你得到了该列的数据类型错误，需要更改。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T18:52:11.823

**索引计算列**

如果您发现自己`operator`经常对列进行排序或以其他方式查询，请考虑为其数值创建计算列并为其添加索引。这将为您提供一个计算/持久列（这听起来像矛盾，但不是）。

# java - 如何让嵌入式 servlet 引擎急切地实例化 servlet？

> ID：75379
> 
> 赞同：1
> 
> 时间：2008-09-16T18:21:08.110
> 
> 标签：java, servlets, jetty

问题很简单，但我已经有点挣扎了。

```
Server server = new Server(8080);  
Context context = new Context(server, "/", Context.NO_SESSIONS);
context.addServlet(MainPageView.class, "/");
context.addServlet(UserView.class, "/signup");
server.start(); 
```

这是一段非常标准的代码，您可以在 Jetty 世界的任何地方找到它。我有一个将 Jetty 嵌入为 servlet 引擎并具有一些 servlet 的应用程序。

其中一些 servlet 的实例化需要在启动时进行大量工作。比如说——读取额外的配置文件、连接到数据库等。我怎样才能让 servlet 引擎急切地实例化所有的 servlet，这样我就可以预先完成所有艰苦的工作，而不是在第一个用户请求时完成？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T19:02:25.343

我不确定为什么使用 Guice make 的 Justin's 选项不适合你。到底注入了什么？我不确定这是否会对您有所帮助，因为它与 Justin 上面写的非常相似，但是如果您这样做，Jetty 将进行实际的实例化。

```
Context context = new Context(server, "/", Context.NO_SESSIONS);
ServletHolder mainPageViewHolder = new ServletHolder(MainPageView.class);
// Do this to force Jetty to instantiate the servlet
mainPageViewHolder.getServlet();  
context.addServlet(mainPageViewHolder, "/"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T18:25:54.887

使用`Context.addServlet`需要 a 的重载`ServletHolder`。 `ServletHolder`是一个接受 Class 或 Servlet 实例的类。

```
Servlet myServlet = new MyServlet();
ServletHolder holder = new ServletHolder(myServlet);
context.addServlet(holder, "/"); 
```

这假设 Jetty 6。我认为它也适用于 Jetty 7。

# c++ - 让 VS 编译器捕获有符号/无符号的赋值？

> ID：75385
> 
> 赞同：4
> 
> 时间：2008-09-16T18:21:47.360
> 
> 标签：c++, c, visual-studio

Visual Studio 编译器似乎不会对有符号/无符号的赋值发出警告，只会在比较时发出警告。例如，下面的代码将在 if 语句上生成警告，但不会在初始分配上生成警告。

有没有办法让它抓住这些？我已经在 W4 了，但我想（希望）在某个地方可能有另一个设置。

谢谢，

```
int foo(void)
{
    unsigned int fooUnsigned = 0xffffffff;
    int fooSigned = fooUnsigned; // no warning

    if (fooSigned < fooUnsigned) // warning
    {
        return 0;
    }

    return fooSigned;
} 
```

更新：

Quamrana 是对的，这是由警告 4365 控制的，默认情况下它似乎是关闭的，即使在 W4 也是如此。但是，您可以像这样为给定的警告级别显式启用它；

```
#pragma warning (4 : 4365) 
```

结果是；

```
warning C4365: 'initializing' : conversion from 'unsigned int' to 'int', signed/unsigned mismatch 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T18:43:13.037

您需要启用警告 4365 才能捕获分配。

这可能很棘手 - 您需要启用所有警告 - 使用 /Wall 启用大量警告，因此您可能无法看到警告发生，但确实如此。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-03T07:09:37.070

您可以使用 /W[level][code] 更改任何特定警告的级别。因此在这种情况下，/W34365 会将警告 4365 变为 3 级警告。如果您经常这样做，您可能会发现将这些选项放在文本文件中并使用 @[file] 选项来简化命令行很有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T18:57:40.787

@quamrana：

必须有超出 /Wall 选项的东西才能启用警告 4365：

```
C:\Temp>cl /Wall /c foo.c
Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 15.00.21022.08 for 80x86
Copyright (C) Microsoft Corporation.  All rights reserved.

foo.c
foo.c(6) : warning C4018: '<' : signed/unsigned mismatch 
```

我看到安德鲁让它工作了，但有谁知道为什么它在这里不起作用？

Visual Studio 文档表明它应该，但我什至无法让文档中的示例程序给出 C4365 警告（尽管它确实给出了相关的 C4245 警告 - 但无论如何只有 /W4 选项会发生这种情况）。

# .net - NHibernate 不缓存属性

> ID：75400
> 
> 赞同：2
> 
> 时间：2008-09-16T18:23:28.263
> 
> 标签：.net, nhibernate, caching

如何配置 NHibernate 不缓存文件？
我知道我可以创建一个执行 HSQL 的方法，但是我可以通过 <class>.xml 文件或休眠 xml 文件本身中的配置设置来不缓存属性吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T23:32:38.783

您不能在属性级别设置辅助缓存设置（据我所知），但您可以直接在其 XML 文件中单独调整每个实体的缓存设置。

例如：

```
<?xml version="1.0" encoding="utf-8" ?>

<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2">  

<class name="ClassName" table="Table">
   <cache usage="nonstrict-read-write" />

    <id name="Id" type="Int64" ... 
```

缓存“使用”属性可以是以下任何值：

*   **读写**：确保读提交隔离，确保数据一致但不会像其他模式那样减少数据库访问，
*   **nonstrict-read-write** : 很少写入的对象，DB 和缓存之间有轻微不一致的可能性，
*   **只读**：对于永远不会改变的数据对象，没有不一致的机会。

# c# - C#中“使用”的用途是什么？

> ID：75401
> 
> 赞同：339
> 
> 时间：2008-09-16T18:23:45.937
> 
> 标签：c#, using, using-statement

用户[kokos](https://stackoverflow.com/users/1065/kokos)通过提及关键字回答了精彩*[的 C# 隐藏功能问题。](https://stackoverflow.com/questions/9033/hidden-features-of-c)*`using`你能详细说明一下吗？有什么用途`using`？

* * *

## 回答 #1

> 赞同：513
> 
> 时间：2008-09-16T18:30:43.673

该`using`语句的原因是确保对象一旦超出范围就被释放，并且不需要显式代码来确保发生这种情况。

与*[了解 C# (codeproject) 中的 'using' 语句](https://www.codeproject.com/Articles/6564/Understanding-the-using-statement-in-C)*和*[使用实现 IDisposable (microsoft)](https://docs.microsoft.com/en-us/dotnet/standard/garbage-collection/using-objects)*的对象一样，C# 编译器将

```
using (MyResource myRes = new MyResource())
{
    myRes.DoSomething();
} 
```

到

```
{ // Limits scope of myRes
    MyResource myRes= new MyResource();
    try
    {
        myRes.DoSomething();
    }
    finally
    {
        // Check for a null resource.
        if (myRes != null)
            // Call the object's Dispose method.
            ((IDisposable)myRes).Dispose();
    }
} 
```

C# 8 引入了一种新语法，名为“ [using declarations](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-8#using-declarations) ”：

> using 声明是一个以 using 关键字开头的变量声明。它告诉编译器被声明的变量应该放在封闭范围的末尾。

所以上面的等效代码是：

```
using var myRes = new MyResource();
myRes.DoSomething(); 
```

并且当控件离开包含范围（通常是方法，但也可以是代码块）时，`myRes`将被释放。

* * *

## 回答 #2

> 赞同：132
> 
> 时间：2008-09-16T19:11:57.927

由于很多人仍然这样做：

```
using (System.IO.StreamReader r = new System.IO.StreamReader(""))
using (System.IO.StreamReader r2 = new System.IO.StreamReader("")) {
   //code
} 
```

我想很多人仍然不知道你可以这样做：

```
using (System.IO.StreamReader r = new System.IO.StreamReader(""), r2 = new System.IO.StreamReader("")) {
   //code
} 
```

* * *

## 回答 #3

> 赞同：98
> 
> 时间：2008-09-16T18:26:00.860

像这样的事情：

```
using (var conn = new SqlConnection("connection string"))
{
   conn.Open();

    // Execute SQL statement here on the connection you created
} 
```

这`SqlConnection`将在不需要显式调用函数的情况下关闭，*即使抛出异常*`.Close()`也会发生这种情况，不需要// 。*`try``catch``finally`*

 ** * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-09-16T18:26:59.797

*using*可用于调用 IDisposable。它也可以用于给类型起别名。

```
using (SqlConnection cnn = new SqlConnection()) { /* Code */}
using f1 = System.Windows.Forms.Form; 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2008-10-15T14:35:07.530

*使用*_

```
using (var foo = new Bar())
{
  Baz();
} 
```

实际上是 try/finally 块的简写。相当于代码：

```
var foo = new Bar();
try
{
  Baz();
}
finally
{
  foo.Dispose();
} 
```

当然，您会注意到，第一个代码段比第二个代码段简洁得多，而且即使抛出异常，您也可能需要做很多事情作为清理。因此，我们提出了一个我们称之为*Scope*的类，它允许您在 Dispose 方法中执行任意代码。因此，例如，如果您有一个名为 IsWorking 的属性，在尝试执行操作后您总是想将其设置为 false，您可以这样做：

```
using (new Scope(() => IsWorking = false))
{
  IsWorking = true;
  MundaneYetDangerousWork();
} 
```

[您可以在此处](https://faithlife.codes/blog/2008/08/leverage_using_blocks_with_scope/)阅读更多关于我们的解决方案以及我们如何获得它的信息。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2015-12-25T18:30:24.297

Microsoft 文档指出**using**具有双重功能 ( [https://msdn.microsoft.com/en-us/library/zhdeatwt.aspx](https://msdn.microsoft.com/en-us/library/zhdeatwt.aspx) )，既可以作为*指令*，也可以作为*语句*。作为一个*声明*，正如在其他答案中指出的那样，关键字基本上是语法糖，用于确定处置**IDisposable**对象的范围。作为*指令*，它通常用于导入命名空间和类型。此外，作为指令，您可以为命名空间和类型创建*别名*，正如“C# 5.0 In a Nutshell: The Definitive Guide”一书中所指出的那样（[http://www.amazon.com/5-0-Nutshell-The- Definitive-Reference-ebook/dp/B008E6I1K8](https://rads.stackoverflow.com/amzn/click/com/B008E6I1K8)），约瑟夫和本阿尔巴哈里。一个例子：

```
namespace HelloWorld
{
    using AppFunc = Func<IDictionary<DateTime, string>, List<string>>;
    public class Startup
    {
        public static AppFunc OrderEvents() 
        {
            AppFunc appFunc = (IDictionary<DateTime, string> events) =>
            {
                if ((events != null) && (events.Count > 0))
                {
                    List<string> result = events.OrderBy(ev => ev.Key)
                        .Select(ev => ev.Value)
                        .ToList();
                    return result;
                }
                throw new ArgumentException("Event dictionary is null or empty.");
            };
            return appFunc;
        }
    }
} 
```

这是明智地采用的事情，因为滥用这种做法会损害代码的清晰度。[在 DotNetPearls ( http://www.dotnetperls.com/using-alias](http://www.dotnetperls.com/using-alias) )中有一个关于 C# 别名的很好的解释，也提到了优缺点。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-09-16T18:34:56.130

我过去经常使用它来处理输入和输出流。您可以很好地嵌套它们，它消除了您通常遇到的许多潜在问题（通过自动调用 dispose）。例如：

```
 using (FileStream fs = new FileStream("c:\file.txt", FileMode.Open))
        {
            using (BufferedStream bs = new BufferedStream(fs))
            {
                using (System.IO.StreamReader sr = new StreamReader(bs))
                {
                    string output = sr.ReadToEnd();
                }
            }
        } 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2015-04-27T13:46:03.617

只是添加了一些令我惊讶的东西并没有出现。*using*最有趣的特性（在我看来）是，无论你如何退出*using*块，它总是会释放对象。这包括退货和例外。

```
using (var db = new DbContext())
{
    if(db.State == State.Closed)
        throw new Exception("Database connection is closed.");
    return db.Something.ToList();
} 
```

抛出异常或返回列表都没有关系。DbContext 对象将始终被释放。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-16T19:58:22.963

*using*的另一个重要用途是在实例化模态对话框时。

```
Using frm as new Form1

    Form1.ShowDialog

    ' Do stuff here

End Using 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2014-04-10T17:27:09.330

您可以通过以下示例使用别名命名空间：

```
using LegacyEntities = CompanyFoo.CoreLib.x86.VBComponents.CompanyObjects; 
```

如您所见，这称为*using alias 指令*，如果您想在代码中明确指出您所指的内容，它可用于隐藏冗长的引用，例如

```
LegacyEntities.Account 
```

代替

```
CompanyFoo.CoreLib.x86.VBComponents.CompanyObjects.Account 
```

或者干脆

```
Account   // It is not obvious this is a legacy entity 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-16T18:32:18.803

有趣的是，您还可以将 using/IDisposable 模式用于其他有趣的事情（例如 Rhino Mocks 使用它的另一点）。基本上，您可以利用编译器**总是**在“使用”对象上调用 .Dispose 的事实。如果您在某个操作之后需要发生某些事情......有明确的开始和结束......那么您可以简单地创建一个 IDisposable 类，该类在构造函数中开始操作，然后在 Dispose 方法中完成。

这允许您使用非常好的 using 语法来表示所述操作的显式开始和结束。这也是 System.Transactions 的工作方式。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-16T19:48:32.583

总之，当您使用实现 的类型的局部变量时`IDisposable`，*总是*无一例外地使用`using`¹。

如果您使用非局部`IDisposable`变量，则*始终*实现该[`IDisposable`模式](http://www.codeproject.com/KB/cs/idisposable.aspx)。

两个简单的规则，没有例外¹。否则，防止资源泄漏是 *ss 的真正痛苦。

* * *

^(1))：唯一的例外是 – 当您处理异常时。然后在块`Dispose`中显式调用的代码可能会更少。`finally`

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-09-16T18:25:33.017

使用 ADO.NET 时，您可以将密钥用于连接对象或读取器对象等内容。这样，当代码块完成时，它将自动处理您的连接。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-16T18:27:30.593

"using" 也可用于解决命名空间冲突。

请参阅*[http://www.davidarno.org/c-howtos/aliases-overcoming-name-conflicts/](http://www.davidarno.org/c-howtos/aliases-overcoming-name-conflicts/)*了解我写的关于该主题的简短教程。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2012-11-01T10:54:37.540

```
public class ClassA:IDisposable
{
    #region IDisposable Members
    public void Dispose()
    {
        GC.SuppressFinalize(this);
    }
    #endregion
} 
```

* * *

```
public void fn_Data()
{
    using (ClassA ObjectName = new ClassA())
    {
        // Use objectName
    }
} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2018-07-30T08:49:03.190

C#中关键字的两种用法`using`如下。

1.  作为指令

    通常我们使用`using`关键字在代码隐藏和类文件中添加命名空间。然后它使当前页面中的所有类、接口和抽象类及其方法和属性可用。

    例子：

    ```
    using System.IO; 
    ```

2.  作为声明

    `using`这是在 C# 中使用关键字的另一种方式。它在提高垃圾收集性能方面起着至关重要的作用。

    该`using`语句确保即使在创建对象和调用方法、属性等时发生异常，也会调用 Dispose()。Dispose() 是 IDisposable 接口中存在的一种方法，可帮助实现自定义垃圾回收。换句话说，如果我正在执行一些数据库操作（插入、更新、删除）但不知何故发生了异常，那么这里 using 语句会自动关闭连接。无需显式调用连接 Close() 方法。

    另一个重要因素是它有助于连接池。.NET 中的连接池有助于消除多次关闭数据库连接。它将连接对象发送到池以供将来使用（下一次数据库调用）。下次从您的应用程序调用数据库连接时，连接池会获取池中可用的对象。因此，它有助于提高应用程序的性能。因此，当我们使用 using 语句时，控制器会自动将对象发送到连接池，无需显式调用 Close() 和 Dispose() 方法。

    您可以通过使用 try-catch 块并显式调用 finally 块内的 Dispose() 来执行与 using 语句相同的操作。但是 using 语句会自动执行调用以使代码更简洁、更优雅。在 using 块中，对象是只读的，不能修改或重新分配。

    例子：

    ```
    string connString = "Data Source=localhost;Integrated Security=SSPI;Initial Catalog=Northwind;";

    using (SqlConnection conn = new SqlConnection(connString))
    {
          SqlCommand cmd = conn.CreateCommand();
          cmd.CommandText = "SELECT CustomerId, CompanyName FROM Customers";
          conn.Open();
          using (SqlDataReader dr = cmd.ExecuteReader())
          {
             while (dr.Read())
             Console.WriteLine("{0}\t{1}", dr.GetString(0), dr.GetString(1));
          }
    } 
    ```

在前面的代码中，我没有关闭任何连接；它会自动关闭。由于语句 ( )，该`using`语句将自动调用 conn.Close() ，对于 SqlDataReader 对象也是如此。如果发生任何异常，它也会自动关闭连接。`using``using (SqlConnection conn = new SqlConnection(connString)`

有关详细信息，请参阅*[在 C# 中使用的用法和重要性](https://www.c-sharpcorner.com/UploadFile/manas1/usage-and-importance-of-using-in-C-Sharp472/)*。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-16T18:30:26.077

**using**用于当你有一个资源在使用后你想要处理它。

例如，如果您分配了一个 File 资源，并且只需要在一段代码中使用它来进行少量读取或写入，那么 using 有助于在您完成后立即处理 File 资源。

正在使用的资源需要实现 IDisposable 才能正常工作。

例子：

```
using (File file = new File (parameters))
{
    // Code to do stuff with the file
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-16T18:26:56.210

当你使用*using*时，它会在 using 作用域的末尾调用对象的 Dispose() 方法。所以你可以在你的 Dispose() 方法中有很多很棒的清理代码。

一个要点：

如果您实现 IDisposable，请确保在您的 Dispose() 实现中调用 GC.SuppressFinalize()，否则自动垃圾收集将尝试出现并在某个时候完成它，如果您这样做至少会浪费资源'已经 Dispose()d 了。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-16T18:28:20.280

*using*关键字定义对象的范围，然后在范围完成时释放对象。例如。

```
using (Font font2 = new Font("Arial", 10.0f))
{
    // Use font2
} 
```

*有关 C# using*关键字的 MSDN 文章，请参见[此处。](http://msdn.microsoft.com/en-us/library/yh598w02(VS.80).aspx)

 ** * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-16T18:47:25.070

并不是说它非常重要，但*using*也可用于动态更改资源。

是的，如前所述是一次性的，但也许特别是您不希望在其余执行期间它们与其他资源不匹配的资源。所以你想处理它，这样它就不会干扰其他地方。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-16T19:52:49.077

立即处置对象的另一个合理使用示例：

```
using (IDataReader myReader = DataFunctions.ExecuteReader(CommandType.Text, sql.ToString(), dp.Parameters, myConnectionString)) 
{
    while (myReader.Read()) 
    {
        MyObject theObject = new MyObject();
        theObject.PublicProperty = myReader.GetString(0);
        myCollection.Add(theObject);
    }
} 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-10-15T14:43:26.340

大括号之外的所有东西都被处理掉了，所以如果你不使用它们，最好处理掉你的对象。之所以如此，是因为如果您有一个 SqlDataAdapter 对象并且您在应用程序生命周期中只使用它一次，并且您只填充一个数据集并且您不再需要它，您可以使用以下代码：

```
using(SqlDataAdapter adapter_object = new SqlDataAdapter(sql_command_parameter))
{
   // do stuff
} // here adapter_object is disposed automatically 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-04-02T07:15:57.473

*using*语句提供了一种方便的机制来正确使用 IDisposable 对象。通常，当您使用 IDisposable 对象时，您应该在 using 语句中声明和实例化它。

*using*语句以正确的方式调用对象的Dispose 方法，并且（当您如前所示使用它时）它还会导致对象本身在调用 Dispose 时立即超出范围。在*using*块中，对象是只读的，不能修改或重新分配。

这来自[这里](https://social.msdn.microsoft.com/Search/en-US?query=using&emptyWatermark=true&ac=4)。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2015-04-27T13:33:47.803

对我来说，“使用”这个名称有点令人困惑，因为它可以是导入命名空间的指令或用于错误处理的语句（如这里讨论的语句）。

错误处理的不同名称会很好，而且可能更明显。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2017-01-04T11:51:52.250

它还可以用于创建范围，例如：

```
class LoggerScope:IDisposable {
   static ThreadLocal<LoggerScope> threadScope = 
        new ThreadLocal<LoggerScope>();
   private LoggerScope previous;

   public static LoggerScope Current=> threadScope.Value;

   public bool WithTime{get;}

   public LoggerScope(bool withTime){
       previous = threadScope.Value;
       threadScope.Value = this;
       WithTime=withTime;
   }

   public void Dispose(){
       threadScope.Value = previous;
   }
}

class Program {
   public static void Main(params string[] args){
       new Program().Run();
   }

   public void Run(){
      log("something happend!");
      using(new LoggerScope(false)){
          log("the quick brown fox jumps over the lazy dog!");
          using(new LoggerScope(true)){
              log("nested scope!");
          }
      }
   }

   void log(string message){
      if(LoggerScope.Current!=null){
          Console.WriteLine(message);
          if(LoggerScope.Current.WithTime){
             Console.WriteLine(DateTime.Now);
          }
      }
   }

} 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2018-03-08T06:16:54.400

*using*语句告诉 .NET 在不再需要时释放 using 块中指定的对象*。*

因此，您应该将“使用”块用于需要在它们之后清理的类，例如*System.IO*类型。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-09-16T18:26:38.630

Rhino Mocks [Record-playback Syntax](http://web.archive.org/web/20080809044303/http://www.ayende.com:80/Wiki/Rhino%20Mocks%20Record-playback%20Syntax.ashx)对`using`.

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2018-05-11T13:16:04.917

> using as 语句会自动调用指定对象的 dispose。该对象必须实现 IDisposable 接口。只要它们属于同一类型，就可以在一个语句中使用多个对象。

[CLR](https://en.wikipedia.org/wiki/Common_Language_Runtime)将您的代码转换为[CIL](https://en.wikipedia.org/wiki/Common_Intermediate_Language)。并且*using*语句被转换为 try 和 finally 块。这就是*using*语句在 CIL 中的表示方式。*using*语句被翻译成三个部分：获取、使用和处置。首先获取资源，然后将使用情况包含在带有*finally*子句的*try语句中。*然后对象在*finally*子句中被释放。

 *** * *

## 回答 #29

> 赞同：-3
> 
> 时间：2013-11-28T17:04:58.353

*using*子句用于定义特定变量的范围。

例如：

```
Using(SqlConnection conn = new SqlConnection(ConnectionString)
{
    Conn.Open()

    // Execute SQL statements here.
    // You do not have to close the connection explicitly
    // here as "USING" will close the connection once the
    // object Conn goes out of the defined scope.
} 
```

# eclipse - 在eclipse中运行外部工具时删除某些类？

> ID：75411
> 
> 赞同：0
> 
> 时间：2008-09-16T18:24:45.683
> 
> 标签：eclipse, sablecc

我在eclipse（3.4）中设置了一个外部工具（sablecc），它在当前项目中生成一堆类。我需要相当频繁地运行这个工具并重新生成这些类。这意味着每次我想运行 sablecc 时，我都必须手动删除 sablecc 创建的包/类，以确保我不会在新旧生成的类之间发生冲突。是否有一些简单的方法可以从 Eclipse 或其他方式中自动执行此操作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T19:54:15.580

不确定我是否理解您的观点，我想您需要在运行 sablecc 之前删除旧类，因为其中一些最终不会在新运行中创建。

最好用目标编写简短的[Ant](http://ant.apache.org/) build.xml，它首先删除类（Ant 删除任务），然后运行 ​​sablecc（Ant 执行任务）。也可以预设 eclipse 以便在 Ant 完成后刷新工作空间。

将 build.xml 放在项目的任何位置，右键单击，Run As/Ant Build。

只是为了简洁的风格，您可以使用它的 Ant 任务（由 org.sablecc.ant.taskdef 实现）调用 sablecc，而不是在新进程中在外部运行它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T18:29:09.277

您可以告诉 Eclipse 在运行外部工具后刷新工作区（或其中的一部分）。这应该强制 Eclipse 检测任何新的/删除的类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T19:53:48.123

JesperE 指的是用于运行 sablecc 的外部工具配置中的选项*Refresh->Refresh resources on completion*。

# iis - 启动 Internet 信息服务时，mmc 无法创建快照

> ID：75428
> 
> 赞同：7
> 
> 时间：2008-09-16T18:26:05.760
> 
> 标签：iis, iis-5

尝试在运行 Windows XP 的虚拟机上运行 Internet 信息服务时出现此错误。有人知道吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-16T20:10:32.373

我能够从其他地方获得解决方案，这里是：

```
regsvr32 %windir%\system32\inetsrv\inetmgr.dll 
```

# c++ - 如何防止 URLDownloadToFile 从缓存中检索？

> ID：75432
> 
> 赞同：4
> 
> 时间：2008-09-16T18:26:15.197
> 
> 标签：c++, winapi, wininet

我正在使用 URLDownloadToFile 从网站检索文件。后续调用返回原始文件而不是更新版本。我假设它正在检索缓存版本。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-16T18:27:40.203

在调用 URLDownloadToFile 之前使用相同的 URL 调用 DeleteUrlCacheEntry。您将需要链接到 Wininet.lib

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-09-03T18:53:30.113

是的，默认情况下它正在提取文件的缓存版本。要完全避免缓存文件，请在 URLDownloadToFile() 的 lpfnCB 参数中传递一个 IBindStatusCallback 对象。在您实现的 IBindStatusCallback::GetBindInfo() 方法中，在您通过 grfBINDF 参数返回的值中包含 BINDF_GETNEWESTVERSION 标志和可选的 BINDF_NOWRITECACHE 标志。如果要更新缓存文件（如果存在）而不是 skippe，请指定 BINDF_RESYNCHRONIZE 标志。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T18:35:16.783

您可以在 URL 的末尾添加一个无害的查询参数吗？

[https://stackoverflow.com/?CacheBuster=1020am](https://stackoverflow.com/?CacheBuster=1020am)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-12-20T10:39:31.367

清理缓存

```
// Limpa cache do Internet Explorer
procedure DeletaIECache;
var
     lpEntryInfo: PInternetCacheEntryInfo;
     hCacheDir: LongWord;
     dwEntrySize: LongWord;
begin
     dwEntrySize := 0;
     FindFirstUrlCacheEntry(nil, TInternetCacheEntryInfo(nil^), dwEntrySize) ;
     GetMem(lpEntryInfo, dwEntrySize) ;
     if dwEntrySize > 0 then lpEntryInfo^.dwStructSize := dwEntrySize;
     hCacheDir := FindFirstUrlCacheEntry(nil, lpEntryInfo^, dwEntrySize) ;
     if hCacheDir <> 0 then
     begin
         repeat
         DeleteUrlCacheEntry(lpEntryInfo^.lpszSourceUrlName) ;
         FreeMem(lpEntryInfo, dwEntrySize) ;
         dwEntrySize := 0;
         FindNextUrlCacheEntry(hCacheDir, TInternetCacheEntryInfo(nil^), dwEntrySize) ;
         GetMem(lpEntryInfo, dwEntrySize) ;
         if dwEntrySize > 0 then lpEntryInfo^.dwStructSize := dwEntrySize;
         until not FindNextUrlCacheEntry(hCacheDir, lpEntryInfo^, dwEntrySize) ;
     end;
     FreeMem(lpEntryInfo, dwEntrySize) ;
     FindCloseUrlCache(hCacheDir) ;
end; 
```

# python - 如何获取带有类名的字符串？

> ID：75440
> 
> 赞同：49
> 
> 时间：2008-09-16T18:26:47.427
> 
> 标签：python

我调用什么方法来获取类的名称？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-16T18:28:51.977

```
In [1]: class test(object):
   ...:     pass
   ...: 

In [2]: test.__name__
Out[2]: 'test' 
```

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-09-16T18:27:58.267

这不是一种方法，它是一个领域。该字段称为`__name__`。 `class.__name__`将类的名称作为字符串给出。 `object.__class__.__name__`将给出对象类的名称。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-17T13:26:31.977

我同意鲨鱼先生的观点，但如果你有一个类的实例，你需要使用它的`__class__`成员：

```
>>> class test():
...     pass
...
>>> a_test = test()
>>>
>>> a_test.__name__
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: test instance has no attribute '__name__'
>>>
>>> a_test.__class__
<class __main__.test at 0x009EEDE0> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-12-06T14:30:27.610

从[*Python 3.3*](https://docs.python.org/whatsnew/3.3.html#pep-3155-qualified-name-for-classes-and-functions)起，我们可以将[`__qualname__`字段](https://docs.python.org/library/stdtypes.html#definition.__qualname__)用于类和函数。

它不同于嵌套对象的[`__name__`字段](https://docs.python.org/library/stdtypes.html#definition.__name__)，例如在其他类中定义的类

```
>>> class A:
        class B:
            pass
>>> A.B.__name__
'B'
>>> A.B.__qualname__
'A.B' 
```

这可能非常有用。

# 进一步阅读

*   [PEP 3155 - 类和函数的限定名称](https://www.python.org/dev/peps/pep-3155/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T21:16:24.353

输入[8]：`str('2'.__class__)`
输出[8]：`"<type 'str'>"`

输入 [9]：`str(len.__class__)`
输出[9]：`"<type 'builtin_function_or_method'>"`

输入[10]：`str(4.6.__class__)`
输出[10]：`"<type 'float'>"`

或者，如前所述，

输入 [11]：`4.6.__class__.__name__`
输出 [11]：`'float'`

# nant - Nant 和更改文件属性（只读到可写）

> ID：75441
> 
> 赞同：8
> 
> 时间：2008-09-16T18:26:50.750
> 
> 标签：nant

作为 Nant 复制任务的一部分，我想更改目标位置中文件的属性。例如，使文件从“只读”变为“读写”。我该怎么做？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-16T18:30:39.010

使用 < [attrib](http://nant.sourceforge.net/release/0.85-rc1/help/tasks/attrib.html) > 任务。例如，要使文件“test.txt”读/写，您可以使用

```
<attrib file="test.txt" readonly="false"/> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-16T20:47:03.953

此外，对于文件列表，命令是：

```
<attrib readonly="false">
  <fileset basedir="mydirectory">
    <include name="**"/>
  </fileset>
</attrib> 
```

# domain-driven-design - 值与实体对象（领域驱动设计）

> ID：75446
> 
> 赞同：114
> 
> 时间：2008-09-16T18:27:06.850
> 
> 标签：domain-driven-design, value-objects, entityobject

我刚刚开始阅读DDD。我无法完全掌握实体与值对象的概念。有人可以解释当值对象被设计为实体对象时系统可能面临的问题（可维护性、性能等）吗？例子会很棒...

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2008-09-16T19:03:01.023

简化为本质区别，身份对实体很重要，但对值对象无关紧要。例如，某人的姓名是一个值对象。客户实体可能由客户名称（值对象）、List<Order> OrderHistory（实体列表）和可能的默认地址（通常是值对象）组成。客户实体有一个 ID，每个订单都有一个 ID，但名称不应该；一般来说，无论如何，在对象模型中，地址的身份可能并不重要。

值对象通常可以表示为不可变对象；更改值对象的一个​​属性本质上会破坏旧对象并创建一个新对象，因为您并不像关心内容那样关心身份。正确地，只要对象的属性与另一个实例的属性相同，Name 上的 Equals 实例方法就会返回“true”。

但是，更改像客户这样的实体的某些属性并不会破坏客户；客户实体通常是可变的。身份保持不变（至少在对象被持久化后）。

您可能在没有意识到的情况下创建了值对象；每当您通过创建细粒度类来表示实体的某些方面时，您都会得到一个值对象。例如，对有效值有一些限制但由更简单的数据类型组成的类 IPAddress 将是一个值对象。EmailAddress 可以是字符串，也可以是具有自己的一组行为的值对象。

很有可能即使在您的数据库中具有标识的项目在您的对象模型中也没有标识。但最简单的情况是一些有意义的属性组合在一起。当您可以将它们组合为 Customer.Name 时，您可能不希望拥有 Customer.FirstName、Customer.LastName、Customer.MiddleInitial 和 Customer.Title；当您考虑持久性时，它们可能会成为数据库中的多个字段，但您的对象模型并不关心。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-10-21T12:19:43.290

由其所有属性共同定义的任何对象都是值对象。如果任何属性发生更改，您将拥有一个值对象的新实例。这就是为什么值对象被定义为不可变的原因。

如果对象没有完全由其所有属性定义，则存在组成对象身份的属性子集。其余属性可以更改而无需重新定义对象。这种对象不能被定义为不可变的。

一种更简单的区分方法是将值对象视为永远不会更改的静态数据，将实体视为在应用程序中发展的数据。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2018-01-28T04:24:49.070

**值类型：**

*   值类型本身不存在，依赖于实体类型。
*   值类型对象属于一个实体类型对象。
*   值类型实例的生命周期受拥有实体实例的生命周期的限制。
*   三种值类型：Basic（原始数据类型）、Composite（地址）和 Collection（Map、List、Arrays）

**实体：**

*   实体类型可以单独存在（Identity）
*   实体有自己的生命周期。它可以独立于任何其他实体而存在。
*   例如：Person、Organization、College、Mobile、Home 等。每个对象都有自己的身份

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-18T10:07:13.650

我不知道以下内容是否正确，但我会说，在地址对象的情况下，我们希望将其用作值对象而不是实体，因为对实体的更改将反映在所有链接对象上（例如一个人）。

举个例子：你和其他人住在你的房子里。如果我们使用 Entity 作为地址，我会争辩说所有 Person 对象都链接到一个唯一的地址。如果有人搬出，您想更新他的地址。如果您要更新地址实体的属性，所有人都会有不同的地址。在值对象的情况下，我们将无法编辑地址（因为它是不可变的），我们将被迫为该人提供一个新地址。

这听起来对吗？我必须说，在阅读了 DDD 书之后，我仍然/现在对这种差异感到困惑。

更进一步，这将如何在数据库中建模？您是否会将 Address 对象的所有属性作为 Person 表中的列，或者您是否会创建一个单独的 Address 表，该表也将具有唯一标识符？在后一种情况下，住在同一所房子里的每个人都有不同的 Address 对象实例，但除了 ID 属性之外，这些对象都是相同的。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-03-18T12:59:05.320

地址可以是依赖于业务进程的实体或值对象。地址对象可以是快递服务应用程序中的实体，但地址可以是其他应用程序中的值对象。在快递申请中，地址对象的身份问题

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-11-21T20:40:58.070

`Entities`3和的区别`Value Objects`

*   标识符与结构相等：实体具有标识符，如果它们具有相同的标识符，则实体是相同的。手外的值对象具有结构相等性，当所有字段相同时，我们认为两个值对象相等。值对象不能有标识符。

*   可变性与不变性：值对象是不可变的数据结构，而实体在其生命周期中会发生变化。

*   寿命：值对象应该属于实体

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-21T13:41:56.207

我在另一个帖子中问过这个问题，我想我仍然很困惑。我可能会将性能考虑与数据建模混淆。在我们的编目应用程序中，客户在需要时不会更改。这听起来很愚蠢 - 但是客户数据的“读取”远远超过“写入”，并且由于许多 Web 请求都针对对象的“活动集”，我不想一次又一次地加载客户。因此，我为 Customer 对象走上了一条不可变的道路——加载它、缓存它，并为 99% 的（多线程）想要查看 Customer 的请求提供相同的服务。然后，当客户更改某些内容时，请让“编辑器”创建新客户并使旧客户无效。

我担心的是，如果许多线程看到相同的客户对象并且它是可变的，那么当一个线程开始更改时，其他线程就会出现混乱。

我现在的问题是，1）这是否合理，以及 2）如何最好地做到这一点而不复制大量关于属性的代码。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-04-06T15:35:37.943

我可以用一个非常简单的句子说，我们有三种类型的相等：

*   **标识符相等性**：一个类具有 id 字段，并且将两个对象与其 id 字段值进行比较。
*   **引用相等**：如果对两个对象的引用在内存中具有相同的地址。
*   **结构相等**：如果两个对象的所有成员都匹配，则两个对象相等。

标识符相等**仅指**实体，结构相等仅指值对象。事实上，值对象没有 id，我们可以互换使用它们。值对象也必须是不可变的，实体可以是可变的，值对象在数据库中不会有任何表。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-03-01T11:33:56.883

**一个实体：**

*   有身份

*   包含值对象

*   可能包含其他实体

*   可以是可变的

**一个值对象：**

*   没有身份

*   必须是不可变的

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-07-02T16:17:03.353

考虑以下来自***Wikipedia***的示例，以便更好地理解值对象和实体之间的区别：

**价值对象：**人们在兑换美元钞票时，一般不区分每张唯一的钞票；他们只关心美元钞票的面值。在这种情况下，美元钞票是价值对象。但是，美联储可能会关注每张独特的票据；在这种情况下，每个法案都是一个实体。

**实体：**大多数航空公司在每个航班上唯一区分每个座位。在这种情况下，每个席位都是一个实体。然而，西南航空、易捷航空和瑞安航空并不区分每个座位；所有座位都一样。在这种情况下，座位实际上是一个值对象。

# permissions - 分层组权限理论/资源？

> ID：75463
> 
> 赞同：2
> 
> 时间：2008-09-16T18:28:31.120
> 
> 标签：permissions, theory, usergroups

有谁知道一些与建立分层用户帐户系统相关的好资源？我目前正在设置一个，并且正在努力处理一些更复杂的逻辑（尤其是在确定权限方面）。我希望我能找到一些资源来帮助我。

**一些背景：** 我正在为允许嵌套组层次结构的 Web CMS 构建用户帐户系统。可以允许/拒绝每个组对读取、写入、添加和删除的访问（明确地针对该组，或者由其父组之一隐式地）。好像这还不够复杂，该系统还允许用户成为多个组的成员。——这就是我卡住的地方。我已经完成了所有设置，但我正在为确定给定用户的权限的实际逻辑而苦苦挣扎。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T18:34:27.487

CakePHP 的手册很好地描述了访问控制列表是如何工作的。

[http://book.cakephp.org/2.0/en/core-libraries/components/access-control-lists.html](http://book.cakephp.org/2.0/en/core-libraries/components/access-control-lists.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-19T15:48:23.043

将给定组的权限集表示为位掩码。或将位掩码组合在一起将为您提供最终的权限集。

@Alex 更新：

我在 3 年前写了这个答案，但我相信我是在暗指以下内容......

从问题

> 嵌套组层次结构。可以允许/拒绝每个组对读取、写入、添加和删除的访问（明确地针对该组，或者由其父组之一隐式地）。好像这还不够复杂，该系统还允许用户成为多个组的成员。——这就是我卡住的地方。我已经完成了所有设置，但我正在为确定给定用户的权限的实际逻辑而苦苦挣扎。

分配与系统中组（或角色）的总权限集匹配的位掩码：

例如`00`（在这里使用两位保持简单！）

第一位授予`Permission A`和第二位`Permission B`。

现在说 A 组授予以下权限集：`01`.

...并说 B 组授予以下权限集：`10`.

要获得任意组中用户的最终权限集，您可以`OR`对权限集位掩码执行逻辑操作：

```
Permission set for Group A   01
Permission set for Group B   10 OR 
                             ----
Resultant permission set     11 (i.e. both permission A and B are conferred) 
```

我不知道提问者系统的细节，但可以扩充这里概述的系统，以使用不同的逻辑运算符实现不同的组组合行为。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T18:31:43.280

查看[Andrew File System](http://en.wikipedia.org/wiki/Andrew_File_System)中的权限。它允许用户创建和管理他们自己的组，同时有选择地分配管理员权限和 ACL。您可能会发现他们的模型中已经为您解决了许多令人讨厌的细节。

**编辑：**这是 AFS 文档的更好链接：

[http://www.cs.cmu.edu/~help/afs/index.html](http://www.cs.cmu.edu/~help/afs/index.html)

这是关于组的部分：

[http://www.cs.cmu.edu/~help/afs/afs_groups.html](http://www.cs.cmu.edu/~help/afs/afs_groups.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T18:39:53.497

我以前就做过这个，而且它的实现并不简单。您将要查看 SecurityPermission 类。

[ [http://msdn.microsoft.com/en-us/library/system.security.permissions.securitypermission.aspx][1]](http://msdn.microsoft.com/en-us/library/system.security.permissions.securitypermission.aspx][1])

我之前通过使用 XML（我不确定我是否会再次这样做）并通过 CLR 存储过程将该 XML 作为权限列表存储在 SQL 服务器内的 XML 列中来完成此操作。XML 将有一个称为“权限”的元素，然后权限实际上是代码中的 ENUM。每个权限都是 SecurityPermission 类的一个新实现（上面链接） 用户被绑定到 SQL 服务器中定义的组，然后当用户被添加/删除到组时，XML 文档将被更新以反映他们分开的组的。

用户登录后，用户凭据将被加载到应用程序商店（会话）中，然后将被相应地访问。当需要进行授权时，应用商店中的 XMl 将通过“FromXML”方法被下拉加载到 SecurityPermission 中。那时我会使用以下方法来确定用户是否有权限：

*   要求
*   相交
*   联盟
*   不受限制
*   是子集

等等等等等等。

在执行需求之后，我能够根据我在 SecurityPermissions 中实现安全例程的方式来确定调用者是否具有访问权限。

同样，这遗漏了很多细节，但这应该会让你走上正确的道路。

看看这个名称空间：[2]：http: [//msdn.microsoft.com/en-us/library/system.security.permissions.aspx](http://msdn.microsoft.com/en-us/library/system.security.permissions.aspx) "System.Security.Permissions"

# java - Eclipse RCP 应用程序无法启动

> ID：75479
> 
> 赞同：1
> 
> 时间：2008-09-16T18:30:24.703
> 
> 标签：java, eclipse, rcp

我有一个在 Java 6 上运行的 Eclipse RCP 应用程序。当我尝试从 Eclipse 中运行产品配置时，它几乎立即静默终止。控制台没有报错。我已经尝试在 IApplication 和 Activator 中设置断点，但都没有到达。

我知道我在这里没有太多具体信息，但是任何人都可以给我任何关于我可能开始寻找诊断问题的指示吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T18:56:20.163

我无法找到 runtime/.metadata 文件夹，但[这篇非常有用的帖子](http://www.eclipsezone.com/eclipse/forums/t99010.rhtml)指示我将 -consoleLog 和 -noExit 添加到我的运行时参数中，从而将错误转储到控制台。配置问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T18:33:42.107

您是否检查了 runtime/.metadata 文件夹中的日志？，

还要确保验证运行时中的所有插件。将它们作为依赖项并不一定意味着它们被添加到运行时。这可能是启动 rcp 应用程序时最大的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-31T16:29:28.930

在将我的 RCP 应用程序从 3.7 迁移到 4.2 后，我遇到了这个问题。我的解决方案是删除到 runtime-product.product 目录并重新运行。

# apache - 如何在 Apache 2.x 中使用 mod_deflate 预压缩文件？

> ID：75482
> 
> 赞同：34
> 
> 时间：2008-09-16T18:30:41.380
> 
> 标签：apache, http, gzip, mod-deflate, content-encoding

我通过 apache 提供所有内容，`Content-Encoding: zip`但它会即时压缩。我的大量内容是磁盘上的静态文件。我想事先压缩文件，而不是每次请求时都压缩它们。

我相信，这是`mod_gzip`在 Apache 1.x 中自动完成的，但只是将文件与 .gz 放在旁边。情况不再如此`mod_deflate`。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-16T18:53:16.897

无论如何，此功能在 mod_gzip 中放错了位置。在 Apache 2.x 中，[您可以使用内容协商来做到这一点](http://httpd.apache.org/docs/2.2/content-negotiation.html)。具体来说，您需要`MultiViews`使用[`Options`指令启用，并且需要使用](http://httpd.apache.org/docs/2.2/mod/core.html#options)[`AddEncoding`指令](http://httpd.apache.org/docs/2.2/mod/mod_mime.html#addencoding)指定编码类型。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-18T21:25:54.033

用我在配置中遗漏的非常简单的一行来回答我自己的问题：

```
Options FollowSymLinks MultiViews 
```

我错过了 MultiViews 选项。它在 Ubuntu 默认的 Web 服务器配置中，所以不要像我一样放弃它。

我还写了一个快速的 Rake 任务来压缩所有文件。

```
namespace :static do
    desc "Gzip compress the static content so Apache doesn't need to do it on-the-fly."
    task :compress do
        puts "Gzipping js, html and css files."
        Dir.glob("#{RAILS_ROOT}/public/**/*.{js,html,css}") do |file|
            system "gzip -c -9 #{file} > #{file}.gz"
        end
    end
end 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-02-07T00:15:21.383

恐怕 MultiViews 不会按预期工作：文档说 Multiviews 工作“如果服务器收到对 /some/dir/foo 的请求，如果 /some/dir 启用了 MultiViews，并且 /some/dir/foo 不存在。 .."，也就是说：如果你有一个文件 foo.js 和 foo.js.gz 在同一个目录下，即使是通过 AcceptEncoding gzip 头传输，仅仅激活 MultiViews 也不会导致发送 .gz 文件。浏览器（您可以通过暂时禁用 mod_deflate 并使用例如 HTTPFox 监视响应来验证此行为）。

我不确定 MultiViews 是否有办法解决这个问题（也许你可以重命名原始文件，然后添加一个特殊的 AddEncoding 指令），但我相信你可以构造一个 mod_rewrite 规则来处理这个问题。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-01-21T18:54:21.213

`mod_negotiation`虽然有点挑剔，但可以使用预压缩文件提供服务。主要困难是**[只协商对不存在的文件的请求](https://httpd.apache.org/docs/2.4/mod/mod_negotiation.html#multiviews)**。因此，如果`foo.js`两者`foo.js.gz`都存在，则对的响应`/foo.js`将始终未压缩（尽管对的响应`/foo`将正常工作）。

我发现的最简单的解决方案（[来自 François Marier](https://feeding.cloud.geek.nz/posts/serving-pre-compressed-files-using/)）是使用双文件扩展名重命名未压缩文件，因此`foo.js`部署为在（无编码）和（gzip 编码）之间进行协商的`foo.js.js`请求。`/foo.js``foo.js.js``foo.js.gz`

我将该技巧与以下配置相结合：

```
Options +MultiViews
RemoveType .gz
AddEncoding gzip .gz

# Send .tar.gz without Content-Encoding: gzip
<FilesMatch ".+\.tar\.gz$">
    RemoveEncoding .gz
    # Note:  Can use application/x-gzip for backwards-compatibility
    AddType application/gzip .gz
</FilesMatch> 
```

我[写了一篇文章](https://kevinlocke.name/bits/2016/01/20/serving-pre-compressed-files-with-apache-multiviews/)，详细讨论了这种配置的原因和一些替代方案。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-04T02:30:42.403

我有一个从源代码构建的 Apache 2，我发现我必须在我的**httpd.conf**文件中修改以下内容：

将多视图添加到选项：

> ```
> Options Indexes FollowSymLinks MultiViews 
> ```

取消注释 AddEncoding：

> ```
> AddEncoding x-compress .Z
> AddEncoding x-gzip .gz .tgz 
> ```

评论添加类型：

> ```
> #AddType application/x-compress .Z
> #AddType application/x-gzip .gz .tgz 
> ```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T18:59:48.253

mod_gzip 也可以即时压缩内容。您可以通过实际登录到您的服务器并从 shell 执行此操作来预压缩文件。

```
cd /var/www/.../data/
for file in *; do
    gzip -c $file > $file.gz;
done; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T18:55:52.147

您可以使用[`mod_cache`](http://httpd.apache.org/docs/2.2/mod/mod_cache.html)代理内存或磁盘中的本地内容。我不知道这是否会按预期工作`mod_deflate`。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-08-28T19:30:59.050

我有很多大的 .json 文件。大多数读者都处于这种情况。预览答案没有谈论返回的“内容类型”。

我希望以下请求透明地返回带有“Content-Type：application/json”的预压缩文件，请使用 Multiview 和 ForceType

```
http://www.domain.com/(...)/bigfile.json
-> Content-Encoding:gzip, Content-Type: Content-Encoding:gzip 
```

1）文件必须重命名：“file.ext.ext”

2) 多视图与 ForceType 配合得很好

在文件系统中：

```
// Note there is no bigfile.json
(...)/bigfile.json.gz
(...)/bigfile.json.json 
```

在您的 apache 配置中：

```
<Directory (...)>
    AddEncoding gzip .gz
    Options +Multiviews
    <Files *.json.gz>
        ForceType application/json
    </Files>
</Directory> 
```

简短而简单:)

# sql-server - MS SQL Server 2008 的主要新“核心”特性是什么？

> ID：75487
> 
> 赞同：2
> 
> 时间：2008-09-16T18:31:22.610
> 
> 标签：sql-server

我主要关注新的 SQL 语法、新类型的锁定、新功能等。在数据仓库和报告等周边服务中并没有那么多......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T18:35:52.193

这里有一篇关于新 T-SQL 功能的精彩文章[（](http://msdn.microsoft.com/en-us/library/cc721270.aspx) SQL 大师 Itzik Ben-Gan 撰写）。它涵盖

*   声明和初始化变量
*   复合赋值运算符
*   通过 VALUES 子句支持表值构造函数
*   CONVERT 功能的增强
*   新的日期和时间数据类型和函数
*   大型 UDT（几何和地理）
*   HIERARCHYID 数据类型
*   表类型和表值参数
*   MERGE 语句、分组集增强功能
*   DDL 触发器增强功能
*   稀疏列
*   过滤索引
*   大型 CLR 用户定义聚合
*   多输入 CLR 用户定义聚合
*   CLR 表值函数的 ORDER 选项
*   对象依赖
*   变更数据捕获
*   与 Microsoft® Windows® 的排序规则对齐
*   弃用

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T18:58:27.100

Filestream blob 存储对我来说是最大的好处

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T18:34:54.973

*   日期和时间的新单独类型，而不仅仅是日期时间
*   纬度/经度的新地理类型
*   如果您正在做任何需要审计的事情，那么变更数据捕获非常简洁
*   配置服务器，用于维护多个数据库。

这就是在四月份的《英雄发生在这里》发布会上引起我注意的地方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T18:35:34.927

热添加 CPU。[http://msdn.microsoft.com/en-us/library/bb964703.aspx](http://msdn.microsoft.com/en-us/library/bb964703.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T18:36:30.010

您是否查看了网站上的白皮书？ [SQL Server 2008 概述。](http://www.microsoft.com/sqlserver/2008/en/us/overview.aspx)

我无法回忆起我的脑海，但它至少有一个很好的数据库到对象链接功能。如果您需要使用它们，它们也有地理空间类型。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T18:38:25.510

[SQL Server 2008 白皮书](http://download.microsoft.com/download/6/9/d/69d1fea7-5b42-437a-b3ba-a4ad13e34ef6/SQL2008_ProductOverview.docx)

这应该涵盖大部分新功能。我注意到新的日期时间数据类型和新的安全功能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T19:36:58.820

页面压缩对我来说听起来真的很好。不过还没用过。

[http://sqlblog.com/blogs/linchi_shea/archive/2008/05/11/sql-server-2008-page-compression-compression-ratios-from-real-world-databases.aspx](http://sqlblog.com/blogs/linchi_shea/archive/2008/05/11/sql-server-2008-page-compression-compression-ratios-from-real-world-databases.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T20:40:20.257

对那些有很多 NULL 的稀疏索引。还有很多人一直在等待的 DATETIME2 数据类型，从 0001-01-01 到 9999-12-31。

# java - 使用 JSTL 将长时间戳格式化为日期

> ID：75489
> 
> 赞同：18
> 
> 时间：2008-09-16T18:31:42.843
> 
> 标签：java, jsp, jstl

我正在从数据库中提取一个长时间戳，但希望仅使用标签将其呈现为日期，而 JSP 中没有嵌入的 java。

我创建了自己的标签来执行此操作，因为我无法让 parseDate 和 formatDate 标签工作，但这并不是说它们不起作用。

有什么建议吗？

谢谢。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2010-04-13T10:08:07.710

您可以避免对 Servlet 进行任何更改，方法是在 JSP 中创建一个日期对象，使用`jsp:useBean`and`jsp:setProperty`标记将新创建的日期对象的时间设置为时间戳的时间。例如：

```
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<jsp:useBean id="dateValue" class="java.util.Date"/>
<jsp:setProperty name="dateValue" property="time" value="${timestampValue}"/>
<fmt:formatDate value="${dateValue}" pattern="MM/dd/yyyy HH:mm"/> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T18:52:40.297

parseDate 和 formatDate 标签有效，但它们与 Date 对象一起工作。您可以调用 new java.util.Date(longvalue) 来获取日期对象，然后将其传递给标准标签。

在 jsp 以外的地方创建您的日期对象。

```
long longvalue = ...;//from database.
java.util.Date dateValue = new java.util.Date(longvalue);
request.setAttribute("dateValue", dateValue); 
```

把它放在请求上，然后你可以像这样在你的标签中访问它。

```
<fmt:formatDate value="${dateValue}" pattern="MM/dd/yyyy HH:mm"/> 
```

# wpf - WPF 用户控件设计时间大小

> ID：75495
> 
> 赞同：52
> 
> 时间：2008-09-16T18:32:10.097
> 
> 标签：wpf, user-controls, autosize

在 WPF 中创建 UserControl 时，我发现给它一些任意的高度和宽度值很方便，这样我就可以在 Visual Studio 设计器中查看我的更改。但是，当我运行控件时，我希望未定义高度和宽度，以便控件将扩展以填充我放置它的任何容器。如何在无需删除之前删除高度和宽度值的情况下实现相同的功能建立我的控制权？（或者在父容器中不使用 DockPanel。）

下面的代码演示了这个问题：

```
<Window x:Class="ExampleApplication3.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:loc="clr-namespace:ExampleApplication3"
    Title="Example" Height="600" Width="600">
    <Grid Background="LightGray">
        <loc:UserControl1 />
    </Grid>
</Window> 
```

以下定义`UserControl1`在设计时显示合理，但在运行时显示为固定大小：

```
<UserControl x:Class="ExampleApplication3.UserControl1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Height="300" Width="300">
    <Grid Background="LightCyan" />
</UserControl> 
```

以下定义`UserControl1`在设计时显示为点，但`Window1`在运行时扩展以填充父项：

```
<UserControl x:Class="ExampleApplication3.UserControl1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid Background="LightCyan" />
</UserControl> 
```

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-09-16T18:36:06.220

对于 Blend，一个鲜为人知的技巧是将这些属性添加到您的用户控件或窗口中：

```
 xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
mc:Ignorable="d"
       d:DesignHeight="500" d:DesignWidth="600" 
```

这会将设计高度和宽度分别设置为 500 和 600。然而，这只适用于混合设计师。不是 Visual Studio 设计器。

就 Visual Studio 设计器而言，您的技术就是一切。这就是我不使用 Visual Studio 设计器的原因。;)

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-09-16T18:44:07.230

在 Visual Studio 中，将 Width 和 Height 属性添加到 UserControl XAML，但在代码隐藏中插入此

```
public UserControl1()
{
    InitializeComponent();
    if (LicenseManager.UsageMode != LicenseUsageMode.Designtime)
    {
        this.Width = double.NaN; ;
        this.Height = double.NaN; ;
    }
} 
```

这将检查控件是否在设计模式下运行。如果不是（即运行时），它会将 Width 和 Height 设置为 NaN（不是数字），如果您在 XAML 中删除 Width 和 Height 属性，您将其设置为该值。

因此，在设计时，您将拥有预设的宽度和高度（包括如果您将用户控件放在表单中），并且在运行时它将根据其父容器停靠。

希望有帮助。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-04-03T00:26:31.547

以下是[Silverlight Designer 中的设计时属性](http://msdn.microsoft.com/en-us/library/ff602277%28v=vs.95%29.aspx)列表。对于 WPF 设计器，它们是相同的。

它列出了 Designer 中可用的所有值，`d:`例如`d:DesignHeight`、`d:DesignWidth`、和其他几个值。`d:IsDesignTimeCreatable``d:CreateList`

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-17T01:57:35.177

我一直这样做。只需在实例化控件的位置将宽度和高度值设置为“自动”，这将覆盖该 UserControl 的设计时值。

IE：`<loc:UserControl1 Width="auto" Height="auto" />`

另一种选择是将 MinWidth 和 MinHeight 的组合设置为允许设计时工作的大小，而 Width 和 Height 保持“自动”。显然，这仅在您不需要 UserControl 的大小小于运行时的最小值时才有效。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-05-06T09:18:51.433

我一直在寻找类似于 Blend 中使用的解决方案，并且根据您的提及，我创建了带有两个附加属性 Width 和 Height 的简单行为类，这些属性仅在 DesinTime 中应用

```
公共静态类 DesignBehavior
{
    私有静态只读类型 OwnerType = typeof (DesignBehavior);

    #区域宽度

    公共静态只读 DependencyProperty WidthProperty =
        DependencyProperty.RegisterAttached(
            “宽度”，
            类型（双），
            所有者类型，
            new FrameworkPropertyMetadata(double.NaN, new PropertyChangedCallback(WidthChangedCallback)));

    公共静态双GetWidth（DependencyObject depObj）
    {
        返回（双）depObj.GetValue（宽度属性）；
    }

    公共静态无效SetWidth（DependencyObject depObj，双值）
    {
        depObj.SetValue（宽度属性，值）；
    }

    私有静态 void WidthChangedCallback（DependencyObject depObj，DependencyPropertyChangedEventArgs e）
    {
        如果（DesignerProperties.GetIsInDesignMode（depObj））{
            depObj.SetValue(FrameworkElement.WidthProperty, e.NewValue);
        }
    }

    #endregion

    #region 高度

    公共静态只读 DependencyProperty HeightProperty =
        DependencyProperty.RegisterAttached(
            “高度”，
            类型（双），
            所有者类型，
            new FrameworkPropertyMetadata(double.NaN, new PropertyChangedCallback(HeightChangedCallback)));

    公共静态双GetHeight（DependencyObject depObj）
    {
        返回（双）depObj.GetValue（高度属性）；
    }

    公共静态无效SetHeight（DependencyObject depObj，双值）
    {
        depObj.SetValue（高度属性，值）；
    }

    私有静态无效HeightChangedCallback（DependencyObject depObj，DependencyPropertyChangedEventArgs e）
    {
        如果（DesignerProperties.GetIsInDesignMode（depObj））{
            depObj.SetValue(FrameworkElement.HeightProperty, e.NewValue);
        }
    }

    #endregion

}

```

然后在您的 UserControl 中，您只需在 Xaml 中设置这些属性

```
<UserControl x:Class="ExtendedDataGrid.Views.PersonOverviewView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:tool="http://schemas.microsoft.com/wpf/2008/toolkit"
    xmlns:b="clr-命名空间:ExtendedDataGrid.Behaviors"
    b:DesignBehavior.Width="600" b:DesignBehavior.Height="200">
    <网格>
         ...
    </网格>
</用户控制>

```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-08-29T01:56:16.243

在控件上使用 MinWidth 和 MinHeight。这样，您将在设计器中看到它，并且在运行时它将按照您想要的方式调整大小。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-22T23:21:38.227

我这样做类似，但我的解决方案确保如果您在设计模式下将控件添加到容器中，它将合理地显示。

```
protected override void OnVisualParentChanged(DependencyObject oldParent)
{
    if (this.Parent != null)
    {
       this.Width = double.NaN;
       this.Height = double.NaN;
    }
} 
```

你怎么看？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-07T19:58:31.470

感谢此解决方案的原始回答者！对于那些感兴趣的人，这里是VB：

```
If LicenseManager.UsageMode <> LicenseUsageMode.Designtime Then
    Me.Width = Double.NaN
    Me.Height = Double.NaN
End If 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-30T17:30:21.047

有些人建议使用我以前从未见过的 LicenseManager.UsageMode 属性，但我使用了以下代码。

```
if(!DesignerProperties.GetIsInDesignMode(this))
{
    this.Width = double.NaN;
    this.Height = double.NaN;
} 
```

埃斯卡，

我只想补充一点，在覆盖“On”方法时，您通常应该始终调用基类的方法。

```
protected override void OnVisualParentChanged(DependencyObject oldParent)
{
    base.OnVisualParentChanged(oldParent);

    ...
} 
```

顺便说一句，很好的解决方法，我现在自己也在使用它。

# pdf - 将pdf文件转换为tiff文件的最佳方法

> ID：75500
> 
> 赞同：79
> 
> 时间：2008-09-16T18:32:44.293
> 
> 标签：pdf, image, tiff

我有大约 1000 个 pdf 文件，我需要将它们转换为 300 dpi 的 tiff 文件。做这个的最好方式是什么？如果有可以编写脚本的 SDK 或其他东西或工具，那将是理想的。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-09-16T18:39:45.493

使用 Imagemagick，或者更好的是 Ghostscript。

[http://www.ibm.com/developerworks/library/l-graf2/#N101C2](http://www.ibm.com/developerworks/library/l-graf2/#N101C2)有一个 imagemagick 的例子：

```
convert foo.pdf pages-%03d.tiff 
```

[http://www.asmail.be/msg0055376363.html](http://www.asmail.be/msg0055376363.html)有一个 ghostscript 的例子：

```
gs -q -dNOPAUSE -sDEVICE=tiffg4 -sOutputFile=a.tif foo.pdf -c quit 
```

我会安装 ghostscript 并阅读 gs 的手册页以查看需要哪些确切选项并进行实验。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2008-09-22T05:14:10.487

从命令行使用 GhostScript，我过去使用过以下内容：

在 Windows 上：

`gswin32c -dNOPAUSE -q -g300x300 -sDEVICE=tiffg4 -dBATCH -sOutputFile=output_file_name.tif input_file_name.pdf`

在 *nix 上：

`gs -dNOPAUSE -q -g300x300 -sDEVICE=tiffg4 -dBATCH -sOutputFile=output_file_name.tif input_file_name.pdf`

对于大量文件，可以使用简单的批处理/shell 脚本来转换任意数量的文件...

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-09-23T10:55:41.937

我编写了一个小 powershell 脚本来遍历目录结构并使用 ghostscript 将所有 pdf 文件转换为 tiff 文件。这是我的脚本：

```
$tool = 'C:\Program Files\gs\gs8.63\bin\gswin32c.exe'
$pdfs = get-childitem . -recurse | where {$_.Extension -match "pdf"}

foreach($pdf in $pdfs)
{

    $tiff = $pdf.FullName.split('.')[0] + '.tiff'
    if(test-path $tiff)
    {
        "tiff file already exists " + $tiff
    }
    else        
    {   
        'Processing ' + $pdf.Name        
        $param = "-sOutputFile=$tiff"
        & $tool -q -dNOPAUSE -sDEVICE=tiffg4 $param -r300 $pdf.FullName -c quit
    }
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-09-24T19:01:21.583

1) 安装 GhostScript

2) 安装 ImageMagick

3) 创建“Convert-to-TIFF.bat”（Windows XP、Vista、7）并使用以下行：

```
for %%f in (%*) DO "C:\Program Files\ImageMagick-6.6.4-Q16\convert.exe" -density 300 -compress lzw %%f %%f.tiff 
```

将任意数量的单页 PDF 文件拖到此文件上，会将它们转换为 300 DPI 的压缩 TIFF。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-21T09:56:15.013

使用python这就是我最终得到的

```
import os
os.popen(' '.join([
                   self._ghostscriptPath + 'gswin32c.exe', 
                   '-q',
                   '-dNOPAUSE',
                   '-dBATCH',
                   '-r300',
                   '-sDEVICE=tiff12nc',
                   '-sPAPERSIZE=a4',
                   '-sOutputFile=%s %s' % (tifDest, pdfSource),
                   ])) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-12-02T08:12:32.570

PDF Focus .Net 可以这样做：

**1.PDF** ***转TIFF***

```
SautinSoft.PdfFocus f = new SautinSoft.PdfFocus();    

string pdfPath = @"c:\My.pdf";

string imageFolder = @"c:\images\";

f.OpenPdf(pdfPath);

if (f.PageCount > 0)
{
    //Save all PDF pages to image folder as tiff images, 200 dpi
    int result = f.ToImage(imageFolder, "page",System.Drawing.Imaging.ImageFormat.Tiff, 200);
} 
```

**2\.** ***PDF to Multipage-TIFF***

```
//Convert PDF file to Multipage TIFF file

SautinSoft.PdfFocus f = new SautinSoft.PdfFocus();

string pdfPath = @"c:\Document.pdf";
string tiffPath = @"c:\Result.tiff";

f.OpenPdf(pdfPath);

if (f.PageCount > 0)
{
    f.ToMultipageTiff(tiffPath, 120) == 0)
    {
        System.Diagnostics.Process.Start(tiffPath);
    }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-16T18:35:53.600

pdf2tiff怎么样？[http://python.net/~gherman/pdf2tiff.html](http://python.net/~gherman/pdf2tiff.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-16T18:42:53.240

ABCPDF 也可以这样做——查看[http://www.websupergoo.com/helppdf6net/default.html](http://www.websupergoo.com/helppdf6net/default.html)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-09-22T07:57:24.213

在 Ubuntu 中测试所需的 ghostscript 和 tiffcp

```
import os

def pdf2tiff(source, destination):
    idx = destination.rindex('.')
    destination = destination[:idx]
    args = [
    '-q', '-dNOPAUSE', '-dBATCH',
    '-sDEVICE=tiffg4',
    '-r600', '-sPAPERSIZE=a4',
    '-sOutputFile=' + destination + '__%03d.tiff'
    ]
    gs_cmd = 'gs ' + ' '.join(args) +' '+ source
    os.system(gs_cmd)
    args = [destination + '__*.tiff', destination + '.tiff' ]
    tiffcp_cmd = 'tiffcp  ' + ' '.join(args)
    os.system(tiffcp_cmd)
    args = [destination + '__*.tiff']
    rm_cmd = 'rm  ' + ' '.join(args)
    os.system(rm_cmd)    
pdf2tiff('abc.pdf', 'abc.tiff') 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-16T18:42:26.453

[https://pypi.org/project/pdf2tiff/](https://pypi.org/project/pdf2tiff/)

您还可以使用 pdf2ps、ps2image，然后使用其他实用程序将生成的图像转换为 tiff（我记得 'paul' [paul - 另一个图像查看器（显示 PNG、TIFF、GIF、JPG 等]）

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-19T00:03:27.117

免责声明：为我推荐的产品工作

Atalasoft 有一个可以[将 PDF 转换为 TIFF](http://www.atalasoft.com/products/dotimage/net-tiff-pdf-sdk.aspx)的 .NET 库——我们是 FOXIT 的合作伙伴，因此 PDF 渲染非常好。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-11-09T12:52:24.567

也许也试试这个？[PDF焦点](http://www.sautinsoft.com/products/pdf-focus/index.php)

这个 .Net 库可以让您解决问题 :)

此代码将有所帮助（在 C# 中将 1000 个 PDF 文件转换为 300-dpi TIFF 文件）：

```
 SautinSoft.PdfFocus f = new SautinSoft.PdfFocus();

    string[] pdfFiles = Directory.GetFiles(@"d:\Folder with 1000 pdfs\", "*.pdf");
    string folderWithTiffs = @"d:\Folder with TIFFs\";

    foreach (string pdffile in pdfFiles)
    {
        f.OpenPdf(pdffile);

        if (f.PageCount > 0)
        {
            //save all pages to tiff files with 300 dpi
            f.ToImage(folderWithTiffs, Path.GetFileNameWithoutExtension(pdffile), System.Drawing.Imaging.ImageFormat.Tiff, 300);
        }
        f.ClosePdf();
    } 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-03-11T20:34:10.880

我喜欢 PDFTIFF.com[将 PDF 转换为 TIFF](http://www.pdftiff.com)，它可以处理无限的页面

# video - 试图将一堆 jpeg 转换成电影

> ID：75508
> 
> 赞同：3
> 
> 时间：2008-09-16T18:34:08.907
> 
> 标签：video, encoding

我有 28,000 张图像需要转换成电影。我试过

```
mencoder mf://*.jpg -mf w=640:h=480:fps=30:type=jpg -ovc lavc -lavcopts vcodec=msmpeg4v2 -nosound -o ../output-msmpeg4v2.avi 
```

但它似乎在 7500 帧时出现了问题。

这些文件被命名为 webcam_2007-04-16_070804.jpg webcam_2007-04-16_071004.jpg webcam_2007-04-16_071204.jpg webcam_2007-04-16_071404.jpg 直到 2008 年 3 月左右。

有没有另一种方法可以将文件名传递给mencoder，这样它就不会中途停止？

```
MEncoder 2:1.0~rc2-0ubuntu13 (C) 2000-2007 MPlayer Team
CPU: Intel(R) Pentium(R) 4 CPU 2.40GHz (Family: 15, Model: 2, Stepping: 7)
CPUflags: Type: 15 MMX: 1 MMX2: 1 3DNow: 0 3DNow2: 0 SSE: 1 SSE2: 1
Compiled with runtime CPU detection.
success: format: 16  data: 0x0 - 0x0
MF file format detected.
[mf] search expr: *.jpg
[mf] number of files: 28617 (114468)
VIDEO:  [IJPG]  640x480  24bpp  30.000 fps    0.0 kbps ( 0.0 kbyte/s)
[V] filefmt:16  fourcc:0x47504A49  size:640x480  fps:30.00  ftime:=0.0333
Opening video filter: [expand osd=1]
Expand: -1 x -1, -1 ; -1, osd: 1, aspect: 0.000000, round: 1
==========================================================================
Opening video decoder: [ffmpeg] FFmpeg's libavcodec codec family
Selected video codec: [ffmjpeg] vfm: ffmpeg (FFmpeg MJPEG decoder)
==========================================================================
VDec: vo config request - 640 x 480 (preferred colorspace: Planar YV12)
VDec: using Planar YV12 as output csp (no 3)
Movie-Aspect is 1.33:1 - prescaling to correct movie aspect.
videocodec: libavcodec (640x480 fourcc=3234504d [MP42])
Writing header...
ODML: Aspect information not (yet?) available or unspecified, not writing vprp header.
Writing header...
ODML: Aspect information not (yet?) available or unspecified, not writing vprp header.
Pos: 251.3s   7539f ( 0%) 47.56fps Trem:   0min   0mb  A-V:0.000 [1202:0]
Flushing video frames.
Writing index...
Writing header...
ODML: Aspect information not (yet?) available or unspecified, not writing vprp header.

Video stream: 1202.480 kbit/s  (150310 B/s)  size: 37772908 bytes  251.300 secs  7539     frames 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T18:51:43.513

将图像列表推送到文件中，每行一个。然后使用`mf://@filename`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T18:45:01.597

你最好去 Freenode IRC 上的 #mplayer 或 #ffmpeg 以获得这些程序的具体帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T14:12:10.167

您可以使用 LiVES 从一系列图像创建视频：http: [//lives.sourceforge.net](http://lives.sourceforge.net)

只需将所有图像放在一个目录中，并确保它们按字母数字顺序排列。然后在 LiVES 中，只需转到文件/打开文件或目录，然后双击图像目录。

加载图像后，您可以编辑剪辑并将其保存为各种格式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T18:39:44.760

另一种选择是绕过mencoder并直接使用ffmpeg

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T18:47:07.910

有点奇怪的答案......但我认为 Blender 可以从图像序列中构建视频。只是一个想法。

# accessibility - Web 可访问性的关键组成部分是什么？

> ID：75526
> 
> 赞同：1
> 
> 时间：2008-09-16T18:36:01.320
> 
> 标签：accessibility

我了解某些国家/地区有关于网站可访问性的法律。一般来说，网站必须满足哪些最低要求才能访问，无论国家/地区如何？或者，代替最低要求，网站应该具备哪些特定的东西才能使其易于访问？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T18:50:40.817

W3C 发布 Web 内容可访问性指南：

[http://www.w3.org/TR/WAI-WEBCONTENT/](http://www.w3.org/TR/WAI-WEBCONTENT/)

如果您想要一个快速的摘要列表，请在该文档中查找黄色突出显示的行。每条指南还细分为三个优先级之一中的特定要求（“检查点”） - 要在此方案下声明任何类型的可访问性，您必须满足所有优先级 1 检查点，但它们是“必要的”而不是“充分的”条件.

在 lynx 中查看您的页面也是一个很好的衡量标准 - 如果它不会以文本形式呈现，那么屏幕阅读器也很可能会遇到困难。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T18:44:40.223

我推荐使用[A-prompt](http://aprompt.snow.utoronto.ca/)来测试可访问性。它是免费的，而且真的很有帮助。

我还推荐 Mark Pilgrim 的在线文本 - [Dive into Accessibility](http://diveintoaccessibility.org/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T18:42:05.317

这不是一个二元问题，也没有灵丹妙药。确保您至少遵循 WCAG 的基础知识并在几个屏幕阅读器中进行测试并且不使用鼠标可能是最有效地利用您的时间。如果可能的话，用真正的残疾人进行测试，他们有一个完全有能力的人很难获得的观点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T18:44:49.320

好吧，显然不同国家的法律差异很大。例如，在英国，我们没有任何具体的 Web 可访问性法律，但任何服务都不允许歧视有视力或听力障碍的人，只要它与功能有关。

有鉴于此，一种简单的设计方法是确保您的网站可以被屏幕阅读器阅读，可以成功地按逻辑顺序通过标签，并允许正确缩放屏幕元素（包括图像和字体大小）对于那些需要放大网页的人。

此外，您的网站应该为任何 JavaScript 和 Flash 提供功能后备，这样如果它们被关闭（例如许多屏幕阅读器中的情况），所有功能仍然可用。不要依赖 WAI-ARIA 来实现 JavaScript 可访问性，因为它没有标准化，也没有得到广泛支持。

当然，这不一定涵盖所有可能的法律，但这是一个很好的起点。如果您的网站符合上述“标准”，则您可能具有良好的可访问性。在 WCAG 之后，有[一个可访问性测试](http://checker.atrc.utoronto.ca/index.html)，但对于每个国家/地区可接受的可访问性水平，这绝不是“决定性的”。

# macos - Mac OS X 中更好的终端——反转控制和命令键映射

> ID：75533
> 
> 赞同：12
> 
> 时间：2008-09-16T18:36:41.757
> 
> 标签：macos, terminal

我正在尝试在 Mac OS X 中获得相同的 KDE Konsole 体验。

这是我的（过于复杂？）设置：

*   我在系统偏好设置级别交换了控制和命令。（没有这个就活不下去）
*   Parallels 还允许您在 Parallels 应用程序级别反转控制和命令。所以我可以撤消系统偏好设置（并在虚拟 Linux 中获得我想要的设置）

我希望 Mac OS X 终端应用程序具有相同的每个应用程序选择退出功能。可能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-11-30T20:12:25.413

您正在寻找的解决方案是**[KeyRemap4MacBook](http://pqrs.org/macosx/keyremap4macbook/index.html)**。有虎版、豹版、雪豹版和狮子版。

安装后，转到**System Preferences** -> **KeyRemap4MacBook**

然后选择以下选项：

*   更改 Command_L 键（左命令）
*   ---> Command_L 到 Control_L（终端、虚拟机、RDC 除外）
*   更改 Control_L 键（左控制）
*   ---> Control_L 到 Command_L（终端、虚拟机、RDC 除外）

如果您愿意，您也可以对 Command_R（右命令）和 Control_R（右控制）重复此操作。在我的 Macbook 上测试和工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-11T18:41:49.310

您可以**简单地通过 ssh 进入 Linux/Unix 系统**并直接在您的 Mac 屏幕上运行 X11 程序：`ssh -X user@host_or_ipaddress`登录，然后运行您想要的 X11 程序（例如`emacs&`），X11 应用程序将出现在 Mac 显示屏上。

优点：

*   X11 窗口就像任何其他窗口一样工作，包括 Exposé goodness 等......
*   无需仅在 Parallels 控制台窗口内工作
*   相同的解决方案适用于任何 Linux/Unix 系统，远程或虚拟
*   即使通过互联网，ssh 连接也是安全的

技术资料：

*   "ssh -X" 开启 ssh 连接的 X11 转发，即 X11 显示连接安全地通过 ssh 隧道
*   “ssh -X”还处理 X11 身份验证隧道
*   `X11.app``launchd`在需要时在 OSX 上自动启动
*   X11 可以通过网络连接到显示器，这是它为数不多的酷炫功能之一；-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-03-19T16:56:55.197

有一个非常好的和键映射灵活的终端： [iTerm2](http://www.iterm2.com)

我最喜欢的套装：iTerm + zsh + [oh-my-zsh](https://github.com/robbyrussell/oh-my-zsh)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-01-16T21:52:57.037

2016 年的解决方案是使用[Karabiner](https://github.com/tekezo/Karabiner)开源程序，它允许您以**非常精细的粒度**重新映射修饰符和其他键，例如

*   仅重新映射**左键** `⌘ Cmd`或`Option`键。
*   仅为特定应用程序重新映射键，例如仅在终端、Emacs 或虚拟机内部。

例如，这里是如何将左键重新映射`⌘ Cmd`为`Ctrl` **仅在终端内部**起作用（并使右键不受影响，以便您仍然可以使用例如`⌘ Cmd + Tab`在应用程序之间切换）：

[![登山扣截图](https://i.stack.imgur.com/GnqQ7.png)](https://i.stack.imgur.com/GnqQ7.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-10T18:00:27.270

您可以在系统偏好设置 > 键盘和鼠标 > 键盘快捷键中自定义用于单个应用程序的命令键。我认为（如果我正确理解您要做什么）这可能会让您实现目标。您可以重新映射终端的所有命令键以使用控制而不是命令，以使它们不碍事......但是您可能需要在您 ssh 进入的机器上进行大量自定义，以便它们使用命令而不是控制

看来您将不得不做大量的工作才能让您使用小指而不是拇指作为修饰键。

另一种可能性：用户偏好可以通过“defaults”命令进行操作。我还没有找到一种方法来使用它来控制它们的修饰键映射，但它在逻辑上应该是可能的（如果你愿意做很多挖掘的话）。如果是这样，那么您可以编写简短的脚本来在 Mac 默认和交换模式之间来回切换。使用 Quicksilver 触发脚本，每当您使用终端时，您都可以调用一个脚本，而无论何时离开它，您都可以调用另一个脚本。再一次，实现你想要的东西是一个很大的痛苦，但它*可能*是可能的。

我不认为有一个干净和简单的解决方案。

如果您愿意安装它们（可能是内核扩展），我已经看到第三方程序可以更好地控制修改键的操作。他们*也许*可以做你想做的事，但我不记得名字了。如果你用谷歌搜索修复 emacs 和 vi 键的程序，你可能会找到它们。

祝你好运。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-06T20:43:06.653

我和你有完全一样的问题。我已将 Command 重新映射为 CAPS Lock，并将 Control 重新映射为 Command，但作为 Linux 的频繁用户，我希望这两种设置尽可能相似。这就是我解决它的方法：

*   安装[Keyboard Maestro](http://www.keyboardmaestro.com/main/)（不是免费的，但完全值得），并将其设置为在登录时运行。
*   在 KM 中，定义宏以将*CMD+{key}*发送到**Terminal**中的*CTRL+{key}*。

 **如果你想重新映射很多键，这是**很多**工作。但是我自己已经做过了，你可以下载这个文件[kmmacros](http://dl.dropbox.com/u/3093385/terminal.kmmacros)。双击即可安装。几个警告：

*   您需要将**终端**设置为使用选项作为元键（终端 > 首选项 > 键盘）。
*   绑定仅适用于 emacs 模式。[这份](http://www.scribd.com/doc/985254/Bash-Emacs-Editing-Mode-readline-Cheat-Sheet)备忘单应该会有所帮助。
*   大多数默认快捷方式不再起作用（*CMD-N*，*CMD-C*，...），并且**终端**中的菜单没有反映这一点。对于某些冲突（新窗口、关闭窗口），我从 Gnome 中获取了这些冲突。

# c++ - C++的隐藏特性？

> ID：75538
> 
> 赞同：114
> 
> 时间：2008-09-16T18:37:05.560
> 
> 标签：c++, hidden-features

当涉及到“隐藏的特征”这一行问题时，没有 C++ 的爱吗？我想我会把它扔在那里。C++有哪些隐藏的特性？

* * *

## 回答 #1

> 赞同：308
> 
> 时间：2008-11-19T16:49:56.757

大多数 C++ 程序员都熟悉三元运算符：

```
x = (y < 0) ? 10 : 20; 
```

但是，他们没有意识到它可以用作左值：

```
(a == 0 ? a : b) = 1; 
```

这是简写

```
if (a == 0)
    a = 1;
else
    b = 1; 
```

谨慎使用:-)

* * *

## 回答 #2

> 赞同：238
> 
> 时间：2008-09-17T01:09:32.153

您可以将 URI 放入 C++ 源代码中而不会出错。例如：

```
void foo() {
    http://stackoverflow.com/
    int bar = 4;

    ...
} 
```

* * *

## 回答 #3

> 赞同：140
> 
> 时间：2008-11-23T11:55:05.383

> 指针算术。

由于可能引入的错误，C++ 程序员更喜欢避免使用指针。

不过，我见过的最酷的 C++ 是什么？[模拟文字。](http://web.archive.org/web/20120110153227/http://weegen.home.xs4all.nl/eelis/analogliterals.xhtml "模拟文字。")

* * *

## 回答 #4

> 赞同：119
> 
> 时间：2008-09-16T22:50:52.520

我同意那里的大多数帖子：C++ 是一种多范式语言，因此您会发现的“隐藏”功能（除了您应该不惜一切代价避免的“未定义行为”）是对设施的巧妙使用。

这些工具中的大多数不是该语言的内置功能，而是基于库的功能。

最重要的是**RAII**，多年来经常被来自 C 世界的 C++ 开发人员忽略。**运算符重载**通常是一个被误解的特性，它同时启用了类似数组的行为（下标运算符）、类似指针的操作（智能指针）和类似内置的操作（乘法矩阵。

**异常**的使用通常很困难，但是通过一些工作，可以通过**异常安全**规范生成真正健壮的代码（包括不会失败的代码，或者具有类似于提交的特性的代码，即成功或恢复到其原始状态）。

C++ 最著名的“隐藏”特性是**模板元编程**，因为它使您能够在编译时而不是运行时部分（或全部）执行您的程序。但是，这很困难，您必须在尝试之前对模板有扎实的了解。

其他人利用多重范式在 C++ 的祖先（即 C）之外产生“编程方式”。

通过使用**仿**函数，您可以模拟具有额外类型安全性和有状态的函数。使用**命令**模式，您可以延迟代码执行。大多数其他**设计模式**可以在 C++ 中轻松有效地实现，以产生不应该在“官方 C++ 范例”列表中的替代编码风格。

通过使用**模板**，您可以生成适用于大多数类型的代码，包括您最初想的那些类型。您也可以提高类型安全性（例如自动类型安全的 malloc/realloc/free）。C++ 对象特性确实很强大（因此，如果不小心使用会很危险），但即使是**动态多态性**在 C++ 中也有其静态版本：**CRTP**。

我发现大多数来自 Scott Meyers 的“ *Effective C++ ”类书籍或来自 Herb Sutter 的“* *Exceptional C++* ”类书籍都易于阅读，并且是关于 C++ 已知和鲜为人知特性的信息的宝藏。

其中我最喜欢的是一个应该让任何 Java 程序员惊恐万分的方法：在 C++ 中，**向对象添加特性的最面向对象的方法是通过非成员非友元函数，而不是通过成员-函数**（即类方法），因为：

*   在 C++ 中，一个类的接口既是它的成员函数，又是同一个命名空间中的非成员函数

*   非朋友非成员函数对内部类没有特权访问。因此，对非成员非朋友使用成员函数会削弱类的封装。

即使是经验丰富的开发人员，这也永远不会令您感到惊讶。

（来源：除其他外，Herb Sutter 的本周在线大师#84：[http](http://www.gotw.ca/gotw/084.htm) ://www.gotw.ca/gotw/084.htm ）

* * *

## 回答 #5

> 赞同：118
> 
> 时间：2008-09-16T23:57:50.517

我认为有些隐藏的语言特性是命名空间别名，因为我在学校的整个过程中从未听说过它。直到我在 boost 文档中遇到它的示例时才引起我的注意。当然，现在我知道了，您可以在任何标准 C++ 参考资料中找到它。

```
namespace fs = boost::filesystem;

fs::path myPath( strPath, fs::native ); 
```

* * *

## 回答 #6

> 赞同：102
> 
> 时间：2009-05-20T16:36:38.480

不仅可以在`for`循环的 init 部分声明变量，还可以在类和函数中声明。

```
for(struct { int a; float b; } loop = { 1, 2 }; ...; ...) {
    ...
} 
```

这允许不同类型的多个变量。

* * *

## 回答 #7

> 赞同：77
> 
> 时间：2008-09-16T20:41:23.843

数组运算符是关联的。

A[8] 是 *(A + 8) 的同义词。由于加法是关联的，因此可以重写为 *(8 + A)，它是..... 8[A] 的同义词

你没有说有用... :-)

* * *

## 回答 #8

> 赞同：73
> 
> 时间：2009-01-11T04:02:24.903

鲜为人知的一件事是联合也可以是模板：

```
template<typename From, typename To>
union union_cast {
    From from;
    To   to;

    union_cast(From from)
        :from(from) { }

    To getTo() const { return to; }
}; 
```

他们也可以有构造函数和成员函数。与继承无关（包括虚函数）。

* * *

## 回答 #9

> 赞同：72
> 
> 时间：2008-09-16T18:46:07.833

> C++ 是一个标准，不应该有任何隐藏的功能......

C++ 是一种多范式语言，你可以把最后的钱押在隐藏的特性上。众多示例中的一个：[模板元编程](http://en.wikipedia.org/wiki/Template_metaprogramming)。标准委员会中没有人打算在编译时执行图灵完备的子语言。

* * *

## 回答 #10

> 赞同：65
> 
> 时间：2010-07-05T22:53:52.480

另一个在 C 中不起作用的隐藏特性是一元运算符的功能`+`。你可以用它来促进和衰减各种事物

### 将枚举转换为整数

```
+AnEnumeratorValue 
```

并且您以前具有枚举类型的枚举器值现在具有可以适合其值的完美整数类型。手动，你几乎不会知道那种类型！例如，当您要为枚举实现重载运算符时，这是必需的。

### 从变量中获取值

您必须使用一个使用类内静态初始化程序而没有类外定义的类，但有时它无法链接？操作员可以帮助创建一个临时的，而不对其类型进行假设或依赖

```
struct Foo {
  static int const value = 42;
};

// This does something interesting...
template<typename T>
void f(T const&);

int main() {
  // fails to link - tries to get the address of "Foo::value"!
  f(Foo::value);

  // works - pass a temporary value
  f(+Foo::value);
} 
```

### 将数组衰减为指针

您是否想将两个指针传递给一个函数，但它不起作用？运营商可能会提供帮助

```
// This does something interesting...
template<typename T>
void f(T const& a, T const& b);

int main() {
  int a[2];
  int b[3];
  f(a, b); // won't work! different values for "T"!
  f(+a, +b); // works! T is "int*" both time
} 
```

* * *

## 回答 #11

> 赞同：61
> 
> 时间：2008-09-16T20:27:20.960

绑定到 const 引用的临时对象的生命周期是很少有人知道的。或者至少这是我最喜欢的大部分人不知道的 C++ 知识。

```
const MyClass& x = MyClass(); // temporary exists as long as x is in scope 
```

* * *

## 回答 #12

> 赞同：52
> 
> 时间：2008-09-30T11:36:44.437

一个不经常使用的好特性是函数范围的 try-catch 块：

```
int Function()
try
{
   // do something here
   return 42;
}
catch(...)
{
   return -1;
} 
```

主要用途是将异常转换为其他异常类并重新抛出，或在异常和基于返回的错误代码处理之间进行转换。

* * *

## 回答 #13

> 赞同：44
> 
> 时间：2009-09-12T11:06:19.560

许多人都知道`identity`/`id`元函数，但是对于非模板情况，它有一个很好的用例：轻松编写声明：

```
// void (*f)(); // same
id<void()>::type *f;

// void (*f(void(*p)()))(int); // same
id<void(int)>::type *f(id<void()>::type *p);

// int (*p)[2] = new int[10][2]; // same
id<int[2]>::type *p = new int[10][2];

// void (C::*p)(int) = 0; // same
id<void(int)>::type C::*p = 0; 
```

它对解密 C++ 声明有很大帮助！

```
// boost::identity is pretty much the same
template<typename T> 
struct id { typedef T type; }; 
```

* * *

## 回答 #14

> 赞同：42
> 
> 时间：2008-11-23T12:24:05.653

一个非常隐藏的功能是您可以在 if 条件中定义变量，其范围将仅跨越 if 及其 else 块：

```
if(int * p = getPointer()) {
    // do something
} 
```

一些宏使用它，例如提供一些像这样的“锁定”范围：

```
struct MutexLocker { 
    MutexLocker(Mutex&);
    ~MutexLocker(); 
    operator bool() const { return false; } 
private:
    Mutex &m;
};

#define locked(mutex) if(MutexLocker const& lock = MutexLocker(mutex)) {} else 

void someCriticalPath() {
    locked(myLocker) { /* ... */ }
} 
```

BOOST_FOREACH 也在后台使用它。要完成这一点，不仅可以在 if 中，也可以在 switch 中：

```
switch(int value = getIt()) {
    // ...
} 
```

在一个while循环中：

```
while(SomeThing t = getSomeThing()) {
    // ...
} 
```

（也处于 for 条件）。但我不太确定这些是否有用:)

* * *

## 回答 #15

> 赞同：29
> 
> 时间：2010-02-01T11:21:59.907

### 防止逗号运算符调用运算符重载

有时您有效地使用了逗号运算符，但您想确保没有用户定义的逗号运算符妨碍您，因为例如您依赖于左侧和右侧之间的序列点，或者想要确保没有任何干扰行动。这是`void()`进入游戏的地方：

```
for(T i, j; can_continue(i, j); ++i, void(), ++j)
  do_code(i, j); 
```

忽略我为条件和代码放置的占位符。重要的是`void()`，它使编译器强制使用内置逗号运算符。有时，这在实现特征类时也很有用。

* * *

## 回答 #16

> 赞同：28
> 
> 时间：2008-10-04T16:17:09.430

构造函数中的数组初始化。例如，在一个类中，如果我们有一个`int`as 数组：

```
class clName
{
  clName();
  int a[10];
}; 
```

我们可以在构造函数中将数组中的所有元素初始化为其默认值（这里数组的所有元素为零），如下所示：

```
clName::clName() : a()
{
} 
```

* * *

## 回答 #17

> 赞同：27
> 
> 时间：2008-09-16T23:48:52.987

哦，我可以想出一个宠物讨厌的清单：

*   如果您打算以多态方式使用析构函数，则需要是虚拟的
*   有时成员是默认初始化的，有时不是
*   局部类不能用作模板参数（使它们不太有用）
*   异常说明符：看起来有用，但不是
*   函数重载隐藏了具有不同签名的基类函数。
*   国际化没有有用的标准化（便携式标准宽字符集，有人吗？我们必须等到 C++0x）

从积极的一面

*   隐藏功能：功能尝试块。不幸的是，我还没有找到它的用途。是的，我知道他们为什么添加它，但是您必须重新抛出一个构造函数，这使得它毫无意义。
*   值得仔细看看 STL 对容器修改后迭代器有效性的保证，它可以让你做一些更好的循环。
*   Boost - 这不是什么秘密，但值得使用。
*   返回值优化（不明显，但标准明确允许）
*   函子又名函数对象又名运算符（）。这被 STL 广泛使用。不是真正的秘密，而是运算符重载和模板的一个很好的副作用。

* * *

## 回答 #18

> 赞同：26
> 
> 时间：2009-06-30T19:42:48.713

您可以访问任何类的受保护数据和函数成员，没有未定义的行为，并且具有预期的语义。继续阅读以了解如何。另请阅读有关此[的缺陷报告](http://tinyurl.com/defect-report)。

通常，C++ 禁止您访问类对象的非静态受保护成员，即使该类是您的基类

```
struct A {
protected:
    int a;
};

struct B : A {
    // error: can't access protected member
    static int get(A &x) { return x.a; }
};

struct C : A { }; 
```

这是禁止的：您和编译器不知道引用实际指向什么。它可能是一个`C`对象，在这种情况下，类`B`没有关于其数据的业务和线索。`x`仅当对派生类或派生类的引用时才授予此类访问权限。它可以允许任意一段代码通过构建一个读取成员的“丢弃”类来读取任何受保护的成员，例如`std::stack`：

```
void f(std::stack<int> &s) {
    // now, let's decide to mess with that stack!
    struct pillager : std::stack<int> {
        static std::deque<int> &get(std::stack<int> &s) {
            // error: stack<int>::c is protected
            return s.c;
        }
    };

    // haha, now let's inspect the stack's middle elements!
    std::deque<int> &d = pillager::get(s);
} 
```

当然，如您所见，这会造成太大的伤害。但是现在，成员指针允许绕过这种保护！关键点是成员指针的类型绑定到实际包含该成员的类，*而不是*绑定到您在获取地址时指定的类。这使我们能够绕过检查

```
struct A {
protected:
    int a;
};

struct B : A {
    // valid: *can* access protected member
    static int get(A &x) { return x.*(&B::a); }
};

struct C : A { }; 
```

当然，它也适用于`std::stack`示例。

```
void f(std::stack<int> &s) {
    // now, let's decide to mess with that stack!
    struct pillager : std::stack<int> {
        static std::deque<int> &get(std::stack<int> &s) {
            return s.*(pillager::c);
        }
    };

    // haha, now let's inspect the stack's middle elements!
    std::deque<int> &d = pillager::get(s);
} 
```

在派生类中使用 using 声明会更容易，它使成员名称公开并引用基类的成员。

```
void f(std::stack<int> &s) {
    // now, let's decide to mess with that stack!
    struct pillager : std::stack<int> {
        using std::stack<int>::c;
    };

    // haha, now let's inspect the stack's middle elements!
    std::deque<int> &d = s.*(&pillager::c);
} 
```

* * *

## 回答 #19

> 赞同：26
> 
> 时间：2008-10-03T22:19:54.270

隐藏功能：

1.  纯虚函数可以有实现。常见的例子，纯虚析构函数。
2.  如果一个函数抛出了一个未在其异常规范中列出的异常，但该函数`std::bad_exception`在其异常规范中有，则该异常将自动转换为`std::bad_exception`并抛出。这样你至少会知道 a`bad_exception`被抛出了。[在这里](http://cpptruths.blogspot.com/2007/05/use-of-stdbadexception.html)阅读更多。

3.  功能尝试块

4.  在类模板中消除 typedef 歧义的模板关键字。如果成员模板特化的名称出现在`.`、`->`或`::`运算符之后，并且该名称具有明确限定的模板参数，请在成员模板名称前加上关键字 template。[在这里](http://en.wikibooks.org/wiki/More_C++_Idioms/Policy_Clone)阅读更多。

5.  函数参数默认值可以在运行时更改。[在这里](http://cpptruths.blogspot.com/2005/07/changing-c-function-default-arguments.html)阅读更多。

6.  `A[i]`效果一样好`i[A]`

7.  可以修改类的临时实例！可以在临时对象上调用非常量成员函数。例如：

    ```
    struct Bar {
      void modify() {}
    }
    int main (void) {
      Bar().modify();   /* non-const function invoked on a temporary. */
    } 
    ```

    [在这里](http://cpptruths.blogspot.com/2009/08/modifying-temporaries.html)阅读更多。

8.  `:`如果在三元 ( ) 运算符表达式的前后存在两种不同的类型`?:`，则表达式的结果类型是两者中最通用的类​​型。例如：

    ```
    void foo (int) {}
    void foo (double) {}
    struct X {
      X (double d = 0.0) {}
    };
    void foo (X) {} 

    int main(void) {
      int i = 1;
      foo(i ? 0 : 0.0); // calls foo(double)
      X x;
      foo(i ? 0.0 : x);  // calls foo(X)
    } 
    ```

* * *

## 回答 #20

> 赞同：26
> 
> 时间：2010-07-04T20:56:26.233

另一个隐藏的功能是您可以调用可以转换为函数指针或引用的类对象。对它们的结果进行重载解析，并完美地转发参数。

```
template<typename Func1, typename Func2>
class callable {
  Func1 *m_f1;
  Func2 *m_f2;

public:
  callable(Func1 *f1, Func2 *f2):m_f1(f1), m_f2(f2) { }
  operator Func1*() { return m_f1; }
  operator Func2*() { return m_f2; }
};

void foo(int i) { std::cout << "foo: " << i << std::endl; }
void bar(long il) { std::cout << "bar: " << il << std::endl; }

int main() {
  callable<void(int), void(long)> c(foo, bar);
  c(42); // calls foo
  c(42L); // calls bar
} 
```

这些被称为“代理调用函数”。

* * *

## 回答 #21

> 赞同：24
> 
> 时间：2008-10-05T17:55:44.647

`map::operator[]`如果缺少键，则创建条目并返回对默认构造的条目值的引用。所以你可以写：

```
map<int, string> m;
string& s = m[42]; // no need for map::find()
if (s.empty()) { // assuming we never store empty values in m
  s.assign(...);
}
cout << s; 
```

我很惊讶有多少 C++ 程序员不知道这一点。

* * *

## 回答 #22

> 赞同：20
> 
> 时间：2008-10-20T12:45:47.340

将函数或变量放在无名命名空间中会弃用将`static`它们限制在文件范围内的使用。

* * *

## 回答 #23

> 赞同：19
> 
> 时间：2009-01-19T07:05:32.413

在类模板中定义普通友元函数需要特别注意：

```
template <typename T> 
class Creator { 
    friend void appear() {  // a new function ::appear(), but it doesn't 
        …                   // exist until Creator is instantiated 
    } 
};
Creator<void> miracle;  // ::appear() is created at this point 
Creator<double> oops;   // ERROR: ::appear() is created a second time! 
```

在这个例子中，两个不同的实例创建了两个相同的定义——直接违反了[ODR](http://en.wikipedia.org/wiki/One_Definition_Rule)

因此，我们必须确保类模板的模板参数出现在该模板中定义的任何友元函数的类型中（除非我们想防止在特定文件中多次实例化类模板，但这不太可能）。让我们将其应用到我们之前示例的变体中：

```
template <typename T> 
class Creator { 
    friend void feed(Creator<T>*){  // every T generates a different 
        …                           // function ::feed() 
    } 
}; 

Creator<void> one;     // generates ::feed(Creator<void>*) 
Creator<double> two;   // generates ::feed(Creator<double>*) 
```

免责声明：我已从[C++ 模板粘贴此部分：完整指南](https://rads.stackoverflow.com/amzn/click/com/0201734842)/第 8.4 节

* * *

## 回答 #24

> 赞同：18
> 
> 时间：2010-02-01T11:15:50.060

### void 函数可以返回 void 值

鲜为人知，但下面的代码很好

```
void f() { }
void g() { return f(); } 
```

以及以下看起来很奇怪的一个

```
void f() { return (void)"i'm discarded"; } 
```

了解了这一点，您可以在某些领域发挥优势。一个例子：`void`函数不能返回一个值，但你也不能什么都不返回，因为它们可能被实例化为非 void。而不是将值存储到局部变量中，这会导致错误`void`，直接返回一个值

```
template<typename T>
struct sample {
  // assume f<T> may return void
  T dosomething() { return f<T>(); }

  // better than T t = f<T>(); /* ... */ return t; !
}; 
```

* * *

## 回答 #25

> 赞同：17
> 
> 时间：2008-11-20T02:40:27.233

将文件读入字符串向量：

```
 vector<string> V;
 copy(istream_iterator<string>(cin), istream_iterator<string>(),
     back_inserter(V)); 
```

[istream_iterator](http://www.sgi.com/tech/stl/istream_iterator.html)

* * *

## 回答 #26

> 赞同：14
> 
> 时间：2009-01-07T20:14:42.797

任何编程语言中最有趣的语法之一。

其中三个属于一起，两个是完全不同的东西......

```
SomeType t = u;
SomeType t(u);
SomeType t();
SomeType t;
SomeType t(SomeType(u)); 
```

除了第三个和第五个之外，所有`SomeType`对象都在堆栈上定义了一个对象并对其进行初始化（`u`在前两种情况下，在第四种情况下使用默认构造函数。第三个是声明一个不带参数并返回 a 的函数`SomeType`。第五个类似地声明一个函数，它通过`SomeType`名为的类型的值获取一个参数`u`。

* * *

## 回答 #27

> 赞同：14
> 
> 时间：2009-11-20T17:01:16.247

您可以对位域进行模板化。

```
template <size_t X, size_t Y>
struct bitfield
{
    char left  : X;
    char right : Y;
}; 
```

我还没有为此想出任何目的，但这确实让我感到惊讶。

* * *

## 回答 #28

> 赞同：12
> 
> 时间：2010-07-06T18:22:47.147

支配规则很有用，但鲜为人知。它说即使在通过基类晶格的非唯一路径中，如果成员属于虚拟基类，则部分隐藏成员的名称查找也是唯一的：

```
struct A { void f() { } };

struct B : virtual A { void f() { cout << "B!"; } };
struct C : virtual A { };

// name-lookup sees B::f and A::f, but B::f dominates over A::f !
struct D : B, C { void g() { f(); } }; 
```

我用它来[实现对齐支持](https://stackoverflow.com/questions/2366879/operator-new-overloading-and-alignment/2366998#2366998)，它通过支配规则自动计算出最严格的对齐。

*这不仅适用于虚拟函数，还适用于 typedef 名称、静态/非虚拟成员和其他任何东西。*我已经看到它用于在元程序中实现可覆盖的特征。

* * *

## 回答 #29

> 赞同：12
> 
> 时间：2010-02-26T07:08:10.030

三元条件运算符`?:`要求其第二个和第三个操作数具有“令人愉快”的类型（非正式地说）。但是这个要求有一个例外（双关语）：第二个或第三个操作数可以是一个 throw 表达式（它具有 type `void`），而不管另一个操作数的类型。

换句话说，可以使用`?:`运算符编写以下完全有效的 C++ 表达式

```
i = a > b ? a : throw something(); 
```

顺便说一句， throw 表达式实际上是*一个表达式*（类型`void`）而不是语句，这是 C++ 语言的另一个鲜为人知的特性。这意味着，除其他外，以下代码是完全有效的

```
void foo()
{
  return throw something();
} 
```

虽然这样做没有多大意义（也许在一些通用模板代码中这可能会派上用场）。

* * *

## 回答 #30

> 赞同：12
> 
> 时间：2008-09-25T11:52:28.943

摆脱前向声明：

```
struct global
{
     void main()
     {
           a = 1;
           b();
     }
     int a;
     void b(){}
}
singleton; 
```

使用 ?: 运算符编写 switch 语句：

```
string result = 
    a==0 ? "zero" :
    a==1 ? "one" :
    a==2 ? "two" :
    0; 
```

在一行上做所有事情：

```
void a();
int b();
float c = (a(),b(),1.0f); 
```

没有 memset 的结构清零：

```
FStruct s = {0}; 
```

归一化/包裹角和时间值：

```
int angle = (short)((+180+30)*65536/360) * 360/65536; //==-150 
```

分配参考：

```
struct ref
{
   int& r;
   ref(int& r):r(r){}
};
int b;
ref a(b);
int c;
*(int**)&a = &c; 
```

* * *

## 回答 #31

> 赞同：9
> 
> 时间：2008-09-16T18:57:34.060

我发现这个博客是一个关于 C++ 奥秘的惊人资源：[C++ Truths](http://cpptruths.blogspot.com/)。

* * *

## 回答 #32

> 赞同：8
> 
> 时间：2009-01-19T07:26:52.837

一个危险的秘密是

```
Fred* f = new(ram) Fred(); http://www.parashift.com/c++-faq-lite/dtors.html#faq-11.10
f->~Fred(); 
```

我最喜欢的秘密，我很少看到使用：

```
class A
{
};

struct B
{
  A a;
  operator A&() { return a; }
};

void func(A a) { }

int main()
{
  A a, c;
  B b;
  a=c;
  func(b); //yeah baby
  a=b; //gotta love this
} 
```

* * *

## 回答 #33

> 赞同：8
> 
> 时间：2010-06-23T10:28:04.057

本地课程很棒：

```
struct MyAwesomeAbstractClass
{ ... };

template <typename T>
MyAwesomeAbstractClass*
create_awesome(T param)
{
    struct ans : MyAwesomeAbstractClass
    {
        // Make the implementation depend on T
    };

    return new ans(...);
} 
```

相当整洁，因为它不会用无用的类定义污染命名空间......

* * *

## 回答 #34

> 赞同：7
> 
> 时间：2009-06-22T19:45:10.777

原始类型具有构造函数。

```
int i(3); 
```

作品。

* * *

## 回答 #35

> 赞同：7
> 
> 时间：2010-07-04T20:40:19.987

一个隐藏的功能，甚至对[GCC 开发人员](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=43453)来说都是隐藏的，是使用字​​符串文字初始化数组成员。假设您有一个需要使用 C 数组的结构，并且您希望使用默认内容初始化数组成员

```
struct Person {
  char name[255];
  Person():name("???") { }
}; 
```

这有效，并且仅适用于 char 数组和字符串字面量初始值设定项。不需要`strcpy`！

* * *

## 回答 #36

> 赞同：6
> 
> 时间：2008-09-16T19:34:23.567

> 众多示例中的一个：模板元编程。标准委员会中没有人打算在编译时执行图灵完备的子语言。

模板元编程几乎不是一个隐藏的功能。它甚至在 boost 库中。请参阅[MPL](http://www.boost.org/doc/libs/release/libs/mpl/doc/index.html)。但如果“几乎隐藏”足够好，那么看看[boost 库](http://www.boost.org/doc/libs)。它包含许多好东西，如果没有强大的库支持，这些好东西是不容易获得的。

一个例子是[boost.lambda](http://www.boost.org/doc/libs/release/doc/html/lambda.html)库，它很有趣，因为 C++ 在当前标准中没有 lambda 函数。

另一个例子是[Loki](http://loki-lib.sourceforge.net/index.php?n=Main.HomePage)，它“广泛使用 C++ 模板元编程并实现了几个常用工具：typelist、functor、singleton、smart pointer、object factory、visitor 和 multimethods。” [[维基百科](http://en.wikipedia.org/wiki/Loki_%28C%2B%2B%29)]

* * *

## 回答 #37

> 赞同：5
> 
> 时间：2008-09-16T19:07:49.340

没有隐藏的功能，但是 C++ 语言非常强大，甚至标准的开发人员也经常无法想象 C++ 可以用来做什么。

实际上，通过足够简单的语言结构，您可以编写出非常强大的东西。www.boost.org 上提供了很多这样的东西作为示例（其中包括[http://www.boost.org/doc/libs/1_36_0/doc/html/lambda.html ）。](http://www.boost.org/doc/libs/1_36_0/doc/html/lambda.html)

要了解如何将简单的语言构造组合成强大的东西，最好阅读[David Vandevoorde、Nicolai M. Josuttis 的“C++ 模板：完整指南”](https://rads.stackoverflow.com/amzn/click/com/0201734842)和 Andrei Alexandrescu 的真正神奇[的书“Modern C++ Design ...”](https://rads.stackoverflow.com/amzn/click/com/0201704315) .

最后，C++ 很难学，你应该努力补上 ;)

* * *

## 回答 #38

> 赞同：4
> 
> 时间：2009-06-30T14:43:09.780

在我看来，只有少数人知道未命名的命名空间：

```
namespace {
  // Classes, functions, and objects here.
} 
```

未命名的命名空间的行为就像它们被替换为：

```
namespace __unique_name__ { /* empty body */ }
using namespace __unique_name__;
namespace __unique_name__ {
  // original namespace body
} 
```

“.. 在翻译单元中所有出现的 [此唯一名称] 都被相同的标识符替换，并且此标识符不同于整个程序中的所有其他标识符。” [C++03, 7.3.1.1/1]

* * *

## 回答 #39

> 赞同：4
> 
> 时间：2009-04-08T13:31:53.313

[C++ 模板是否可以检查函数是否存在？](https://stackoverflow.com/questions/257288/possible-for-c-template-to-check-for-a-functions-existence)

* * *

## 回答 #40

> 赞同：3
> 
> 时间：2009-01-03T15:44:32.517

来自[C++ 真理](http://cpptruths.blogspot.com/2008/01/function-template-overload-resolution.html)。

在同一范围内定义具有相同签名的函数，因此这是合法的：

```
template<class T> // (a) a base template
void f(T) {
  std::cout << "f(T)\n";
}

template<>
void f<>(int*) { // (b) an explicit specialization
  std::cout << "f(int *) specilization\n";
}

template<class T> // (c) another, overloads (a)
void f(T*) {
  std::cout << "f(T *)\n";
}

template<>
void f<>(int*) { // (d) another identical explicit specialization
  std::cout << "f(int *) another specilization\n";
} 
```

* * *

## 回答 #41

> 赞同：3
> 
> 时间：2008-09-16T18:41:32.557

我不确定是否隐藏，但有一些[有趣](http://en.wikipedia.org/wiki/Duff%27s_device) [的“技巧”](http://en.wikipedia.org/wiki/Template_metaprogramming)可能仅通过阅读规范并不明显。

* * *

## 回答 #42

> 赞同：3
> 
> 时间：2008-09-16T19:10:07.790

有很多“未定义的行为”。您可以学习如何避免他们阅读好书和阅读标准。

* * *

## 回答 #43

> 赞同：3
> 
> 时间：2008-09-16T21:12:08.887

大多数 C++ 开发人员忽略了模板元编程的力量。查看[Loki 库](http://loki-lib.sourceforge.net/index.php?n=Main.HomePage)。[它广泛使用模板元编程（来自维基百科](http://en.wikipedia.org/wiki/Loki_(C%2B%2B))）实现了几个高级工具，如类型列表、函子、单例、智能指针、对象工厂、访问者和多方法。在大多数情况下，您可以将这些视为“隐藏的”c++ 功能。

* * *

## 回答 #44

> 赞同：3
> 
> 时间：2008-09-17T00:10:15.823

*   指向类方法的指针
*   “类型名”关键字

* * *

## 回答 #45

> 赞同：3
> 
> 时间：2009-09-23T12:08:06.313

[throw 是一个表达式](http://www.reddit.com/r/programming/comments/96aku/in_c_throw_is_an_expression/)

* * *

## 回答 #46

> 赞同：2
> 
> 时间：2009-03-27T21:22:01.633

注意自由函数指针和成员函数指针初始化的区别：

成员函数：

```
struct S
{
 void func(){};
};
int main(){
void (S::*pmf)()=&S::func;//  & is mandatory
} 
```

和免费功能：

```
void func(int){}
int main(){
void (*pf)(int)=func; // & is unnecessary it can be &func as well; 
} 
```

多亏了这个多余的 &，您可以在没有它的情况下在链中添加流操纵器（它们是免费功能）：

```
cout<<hex<<56; //otherwise you would have to write cout<<&hex<<56, not neat. 
```

* * *

## 回答 #47

> 赞同：2
> 
> 时间：2009-11-20T16:53:05.233

main() 不需要返回值：

```
int main(){} 
```

是最短的有效 C++ 程序。

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2010-02-26T08:24:02.187

1.  `map::insert(std::pair(key, value));`如果键值已经存在，则不会覆盖。

2.  您可以在定义后立即实例化一个类：（我可能会补充说，由于缺少分号，此功能给我带来了数百个编译错误，而且我从未见过有人在类上使用它）

    ```
    class MyClass {public: /* code */} myClass; 
    ```

* * *

## 回答 #49

> 赞同：1
> 
> 时间：2009-03-23T19:54:11.937

[间接转换成语](http://www.devx.com/cplus/10MinuteSolution/32145/0/page/1)：

> 假设您正在设计一个智能指针类。除了重载运算符 * 和 -> 之外，智能指针类通常定义一个转换运算符为 bool：

```
template <class T>
class Ptr
{
public:
 operator bool() const
 {
  return (rawptr ? true: false);
 }
//..more stuff
private:
 T * rawptr;
}; 
```

> 转换为 bool 使客户端能够在需要 bool 操作数的表达式中使用智能指针：

```
Ptr<int> ptr(new int);
if(ptr ) //calls operator bool()
 cout<<"int value is: "<<*ptr <<endl;
else
 cout<<"empty"<<endl; 
```

> 此外，在条件声明中需要隐式转换为 bool，例如：

```
if (shared_ptr<X> px = dynamic_pointer_cast<X>(py))
{
 //we get here only of px isn't empty
} 
```

> 唉，这种自动转换打开了不受欢迎的惊喜之门：

```
Ptr <int> p1;
Ptr <double> p2;

//surprise #1
cout<<"p1 + p2 = "<< p1+p2 <<endl; 
//prints 0, 1, or 2, although there isn't an overloaded operator+()

Ptr <File> pf;
Ptr <Query> pq; // Query and File are unrelated 

//surprise #2
if(pf==pq) //compares bool values, not pointers! 
```

解决方案：使用“间接转换”习语，通过从指向数据成员 [pMember] 的指针到 bool 的转换，这样只有 1 次隐式转换，这将防止上述意外行为：pMember->bool 而不是 bool->something别的。

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2008-09-16T19:18:21.983

C++ 中有大量“棘手”的结构。它们来自使用虚拟继承的[密封/最终类](http://www.gamedev.net/reference/programming/features/cppseal/)的“简单”实现。并获得相当“复杂”的元编程结构，例如 Boost 的[MPL](http://www.boost.org/doc/libs/1_36_0/libs/mpl/doc/index.html)（[教程](http://ubiety.uwaterloo.ca/~tveldhui/papers/Template-Metaprograms/meta-art.html)）。对自己不利的可能性是无穷无尽的，但如果加以控制（即经验丰富的程序员），在可维护性和性能方面提供一些最佳的灵活性。

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2009-01-07T20:02:23.447

如果 operator delete() 除了 *void 之外还接受 size 参数，这意味着它将高度地成为一个基类。该大小参数可以检查类型的大小以销毁正确的类型。斯蒂芬杜赫[斯特](http://semantics.org/commonknowledge/index.html)讲述了这一点：

> 另请注意，我们使用了 operator delete 的两个参数版本，而不是通常的一个参数版本。这个有两个参数的版本是成员 operator delete 的另一个“通常”版本，通常由基类使用，这些基类期望派生类继承其 operator delete 实现。第二个参数将包含要删除的对象的大小——这些信息在实现自定义内存管理时通常很有用。

* * *

## 回答 #52

> 赞同：1
> 
> 时间：2009-05-18T03:44:33.853

类和结构类键几乎相同。主要区别在于类默认为成员和基的私有访问，而结构默认为公共访问：

```
// this is completely valid C++:
class A;
struct A { virtual ~A() = 0; };
class B : public A { public: virtual ~B(); };

// means the exact same as:
struct A;
class A { public: virtual ~A() = 0; };
struct B : A { virtual ~B(); };

// you can't even tell the difference from other code whether 'struct'
// or 'class' was used for A and B 
```

联合也可以有成员和方法，并且与结构类似，默认为公共访问。

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2009-10-15T16:04:04.290

我发现递归模板实例非常酷：

```
template<class int>
class foo;

template
class foo<0> {
    int* get<0>() { return array; }
    int* array;  
};

template<class int>
class foo<i> : public foo<i-1> {
    int* get<i>() { return array + 1; }  
}; 
```

我用它来生成一个包含 10-15 个函数的类，这些函数将指针返回到数组的各个部分，因为我使用的 API 需要一个函数指针来处理每个值。

即通过递归对编译器进行编程以生成一堆函数。非常简单。:)

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2009-05-24T09:52:13.530

向模板添加[约束。](https://stackoverflow.com/questions/122316/template-constraints-c)

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2010-02-26T06:57:34.967

您可以使用某些编译器通过命令行开关查看所有预定义的宏。这适用于 gcc 和 icc（英特尔的 C++ 编译器）：

```
$ touch empty.cpp
$ g++ -E -dM empty.cpp | sort >gxx-macros.txt
$ icc -E -dM empty.cpp | sort >icx-macros.txt
$ touch empty.c
$ gcc -E -dM empty.c | sort >gcc-macros.txt
$ icc -E -dM empty.c | sort >icc-macros.txt 
```

对于 MSVC，它们被列在一个[地方](http://msdn.microsoft.com/en-us/library/b0084kay%28VS.80%29.aspx)。它们也可以记录在一个地方供其他人使用，但是在应用所有其他命令行开关后，通过上述命令，您可以清楚地*看到*定义和未定义的内容以及使用的值。

比较（排序后）：

```
 $ diff gxx-macros.txt icx-macros.txt
 $ diff gxx-macros.txt gcc-macros.txt
 $ diff icx-macros.txt icc-macros.txt 
```

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2009-12-27T20:01:05.693

My favorite (for the time being) is the lack of sematics in a statement like A=B=C. What the value of A is basically undetermined.

Think of this:

```
class clC
{
public:
   clC& operator=(const clC& other)
   {
      //do some assignment stuff
      return copy(other);
   }
   virtual clC& copy(const clC& other);
}

class clB : public clC
{
public:
  clB() : m_copy()
  {
  }

  clC& copy(const clC& other)
  {
    return m_copy;
  }

private:
  class clInnerB : public clC
  {
  }
  clInnerB m_copy;
} 
```

now A might be of a type inaccessible to any other than objects of type clB and have a value that's unrelated to C.

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2009-09-09T23:29:19.670

成员指针和成员指针运算符 ->*

```
#include <stdio.h>
struct A { int d; int e() { return d; } };
int main() {
    A* a = new A();
    a->d = 8;
    printf("%d %d\n", a ->* &A::d, (a ->* &A::e)() );
    return 0;
} 
```

对于方法 (a ->* &A::e)() 有点像 JavaScript 中的 Function.call()

```
var f = A.e
f.call(a) 
```

对于成员来说，这有点像使用 [] 运算符访问

```
a['d'] 
```

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2009-02-21T12:33:20.267

```
class Empty {};

namespace std {
  // #1 specializing from std namespace is okay under certain circumstances
  template<>
  void swap<Empty>(Empty&, Empty&) {} 
}

/* #2 The following function has no arguments. 
   There is no 'unknown argument list' as we do
   in C.
*/
void my_function() { 
  cout << "whoa! an error\n"; // #3 using can be scoped, as it is in main below
  // and this doesn't affect things outside of that scope
}

int main() {
  using namespace std; /* #4 you can use using in function scopes */
  cout << sizeof(Empty) << "\n"; /* #5 sizeof(Empty) is never 0 */
  /* #6 falling off of main without an explicit return means "return 0;" */
} 
```

* * *

## 回答 #59

> 赞同：-1
> 
> 时间：2009-04-15T23:19:17.747

使用**静态演员**模拟**重新解释**演员表：

 **```
int var;
string *str = reinterpret_cast<string*>(&var); 
```

上面的代码等价于：

```
int var;    
string *str = static_cast<string*>(static_cast<void*>(&var)); 
```

* * *

## 回答 #60

> 赞同：-2
> 
> 时间：2010-03-26T00:32:41.817

Template metaprogramming is.

* * *

## 回答 #61

> 赞同：-2
> 
> 时间：2010-06-16T18:25:08.700

You can return a variable reference as part of a function. It has some uses, mostly for producing horrible code:

```
int s ;
vector <int> a ;
vector <int> b ;

int &G(int h)
{
    if ( h < a.size() ) return a[h] ;
    if ( h - a.size() < b.size() ) return b[ h - a.size() ] ;
    return s ;
}

int main()
{
    a = vector <int> (100) ;
    b = vector <int> (100) ;

    G( 20) = 40 ; //a[20] becomes 40
    G(120) = 40 ; //b[20] becomes 40
    G(424) = 40 ; //s becomes 40
} 
```

* * *

## 回答 #62

> 赞同：-2
> 
> 时间：2008-09-25T08:45:25.070

指针算术。

它实际上是一个 C 特性，但我注意到很少有人使用 C/C++ 真正意识到它甚至存在。我认为 C 语言的这一特性真正体现了其发明者的天才和远见。

长话短说，指针算法允许编译器对任何类型的 a 执行 a[n] 作为 *(a+n)。附带说明一下，因为“+”是可交换的，所以 a[n] 当然等价于 n[a]。

* * *

## 回答 #63

> 赞同：-2
> 
> 时间：2010-05-26T11:22:52.097

实际上不是隐藏功能，而是纯粹的令人敬畏：

```
#define private public 
```

* * *

## 回答 #64

> 赞同：-3
> 
> 时间：2010-02-26T09:03:47.490

我认识一个只用一种方法同时定义 getter 和 setter 的人。像这样：

```
class foo
{
    int x;

    int* GetX(){
        return &x;
    }
} 
```

您现在可以像往常一样使用它作为吸气剂（嗯，几乎）：

```
int a = *GetX(); 
```

作为二传手：

```
*GetX() = 17; 
```

# .net - 在安装过程中初始化 user.config 或 app.exe.config

> ID：75546
> 
> 赞同：11
> 
> 时间：2008-09-16T18:37:32.970
> 
> 标签：.net, deployment, configuration-files

我正在开发一个 .NET WinForms 应用程序，它依赖于 user.config 来存储各种有用的设置，例如 Intranet Web 服务 URL。我们希望能够在安装过程中导入自定义初始设置。用例是，如果一家公司有 100 台机器要安装软件，并且它们都应该引用相关的 Intranet Web 服务，则不需要在所有机器上手动设置。

我们目前正在使用 VS2008 安装项目来生成安装包。

到目前为止，我们的想法是使安装程序能够使用信息（来自模板）制作一个自定义的初始 .config 文件，然后将其放置在适当的位置，而不是安装项目安装的默认文件。

但是，除了这几个之外，我看不到其他方法：

1.  将可执行文件名称硬编码到自定义安装程序操作（源自 System.Configuration.Install.Installer）中，以便使用 ConfigurationManager 类来确定 .config 文件路径。如果可执行文件名称发生更改，这将需要手动更改安装程序。
2.  滚动我们自己的配置类或文件/文件夹层次结构来存储设置。如果我理解正确的话，这基本上会阻止我们使用 .NET 提供的隔离机制（这也是这里的障碍）的优势。

有谁知道任何替代方案，或使上述两个可口的方法？

我担心答案可能是“不要这样做，它违背了机制的精神，滚动你自己的设置导入机制”。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T18:11:51.833

如果您为较大的公司创建此应用程序，那么您应该看看[Group Policy](http://technet.microsoft.com/en-us/windowsserver/grouppolicy/default.aspx)。不幸的是，它将使您的应用程序回到注册表的黄金时代。我知道，这将是您程序中的一个巨大变化，但这是实现这一目标的方法。

但是，如果 Web 服务的 URL 是唯一的东西，那么您必须以这种方式进行设置，那么 GPO 可能有点过头了。在这种情况下，我会硬编码可执行文件的名称。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T21:35:53.777

我知道这并不完全是您正在寻找的答案，但您应该选择更“认真”的安装程序。我们正在使用 Advanced Installer，它非常棒，可以做任何你能想到的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T09:11:15.370

如果您可以在配置文件中硬编码至少一个设置，您可以使用它来指向可以存储所有自定义配置设置的数据库或 Web 服务或网络文件路径。使用 System.Configuration.ConfigurationManager.OpenExeConfiguration() 您可以在第一次运行或每次应用程序启动时从该位置更新配置文件。

# c# - 将 ApplicationSettings 数据绑定到自定义组件

> ID：75577
> 
> 赞同：1
> 
> 时间：2008-09-16T18:41:04.023
> 
> 标签：c#, data-binding, custom-component

我有一个已实现的自定义组件， `INotifyPropertyChanged`并且`IBindableComponent`.

但是，当我尝试对属性进行数据绑定时，设计器会添加以下行：

```
this.component11.TestString =
global::WindowsFormsApplication2.Properties.Settings.Default.Setting; 
```

而不是像使用 TextBox 那样创建绑定：

```
this.textBox2.DataBindings.Add(new System.Windows.Forms.Binding(
   "Text",
   global::WindowsFormsApplication2.Properties.Settings.Default,
   "Setting2",
   true,
   System.Windows.Forms.DataSourceUpdateMode.OnPropertyChanged)); 
```

我原以为设计者会简单地查看是否 `IBindableComponent`已实现，如果是，则生成绑定编码而不是分配代码。

任何想法为什么这适用于文本框而不是我的自定义组件？

这是我的自定义组件：

```
public partial class Component1 : Component, INotifyPropertyChanged, IBindableComponent
    {
        public Component1()
        {
            InitializeComponent();
        }

        public Component1(IContainer container)
        {
            container.Add(this);

            InitializeComponent();
        }

        private string teststring;
        [Bindable(true)]
        public string TestString
        {
            get
            {
                return teststring;
            }
            set
            {
                if (teststring != value)
                {
                    teststring = value;
                    FirePropertyChanged("TestString");
                }
            }
        }

        #region INotifyPropertyChanged Members

        public event PropertyChangedEventHandler PropertyChanged;

        void FirePropertyChanged(string propertyName)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
            }
        }

        #endregion

        #region IBindableComponent Members

        private BindingContext bindingContext = null;

        public BindingContext BindingContext
        {
            get
            {
                if (null == bindingContext)
                {
                    bindingContext = new BindingContext();
                }

                return bindingContext;
            }
            set { bindingContext = value; }
        }

        private ControlBindingsCollection databindings;

        public ControlBindingsCollection DataBindings
        {
            get
            {
                if (null == databindings)
                {
                    databindings = new ControlBindingsCollection(this);
                }
                return databindings;
            }
            set { databindings = value; }
        }

        #endregion
    }

print("code sample"); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T03:31:41.377

尝试：

```
[ DesignerSerializationVisibility( DesignerSerializationVisibility.Hidden ),
  EditorBrowsable( EditorBrowsableState.Advanced ),
  Browsable( false ) ]
public BindingContext BindingContext {
    ...
}

[ ParenthesizePropertyName( true ),
  RefreshProperties( RefreshProperties.All ),
  DesignerSerializationVisibility( DesignerSerializationVisibility.Content ),
  Category( "Data" ) ]
public ControlBindingsCollection DataBindings {
   ...
} 
```

# .net - 将 SQL CE 数据序列化为 XML

> ID：75608
> 
> 赞同：2
> 
> 时间：2008-09-16T18:44:22.673
> 
> 标签：.net, xml, .net-2.0, sql-server-ce

我正在开发一种产品功能，该功能允许用户在我的应用程序的一个副本上从 SQL CE 数据库中导出数据，并在另一端将其重新导入 SQL CE。这些数据不是整个表，而是查询的结果。

我曾希望利用 .net 内置的基于 XML 的序列化，如 DataTable.WriteXML。但是，针对 SqlCeCommand 执行查询的任何方法都没有提供序列化为 XML 或提取 DataTable 的明显方法，而后者可以提供该方法。

有什么我想念的吗？我是否必须编写自己的序列化反序列化方法或者是否有内置方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T18:56:35.703

假设 cmd 是你的 SqlCeCommand....

```
using(var dr = cmd.ExecuteReader())
{
   DataSet ds = new DataSet();
   DataTable dt = ds.Tables.Add();
   dt.Load(dr);
   ds.WriteXML(...);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T18:53:12.497

您想创建一个数据集`SqlCeDataAdapter`并使用它`.Fill()`。`.WriteXml()`然后通过它的方法序列化整个数据集。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T18:49:39.493

我认为您可以将数据检索到 DataSet，在其上调用 WriteXML，然后在另一端声明一个新的 DataSet 并在其上调用 ReadXML。

# windows - 在 Windows Vista 和 2008 Server 上以管理员身份使用内存中的锁定页面

> ID：75614
> 
> 赞同：0
> 
> 时间：2008-09-16T18:44:55.683
> 
> 标签：windows, admin-rights

以下问题回答了如何在 Windows 上获取大内存页面：
“[我如何在 Windows 中使用大页面运行我的应用程序](https://stackoverflow.com/questions/39059/how-do-i-run-my-app-with-large-pages-in-windows)”。

我要解决的问题是如何在 Vista 和 2008 Server 上配置它。

通常，您只允许特定用户将页面锁定在内存中即可。但是，在 Vista 和 2008 上，这仅在您使用管理员帐户时才有效。如果用户实际上是 Administrators 组的一部分，则无济于事。所有其他用户总是收到 1300 错误代码，说明缺少某些权限。

任何人都知道还需要配置什么？

谢谢，斯塔凡

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T18:51:31.113

[http://support.microsoft.com/default.aspx?scid=kb;EN-US;918483](http://support.microsoft.com/default.aspx?scid=kb;EN-US;918483)

浏览固定页面所需的用户权限

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T16:21:58.090

在 Vista 和 Windows 2008 上，您会被 UAC 所困扰。管理员组中的人有一个受限令牌，其中不包含他们的所有权限。UAC 提升提示用于打开额外权限。

我假设“在内存中锁定页面”特权是附加功能之一。

真正的“管理员”帐户不受 UAC 约束。

您需要提升运行程序，这意味着从提升的命令提示符运行它，或者使用声明“requireAdministrator”的清单设置它。

# python - 如何使用未绑定表单中的表单值

> ID：75621
> 
> 赞同：10
> 
> 时间：2008-09-16T18:45:34.387
> 
> 标签：python, django

我有一个网络报告，它使用 Django 表单（新表单）来控制用于生成报告的查询（开始日期、结束日期......）。我遇到的问题是页面应该使用表单的初始值（未绑定）工作，但我无法访问 clean_data 字段，除非我调用`is_valid()`. 但`is_valid()`总是在未绑定的表单上失败。

似乎 Django 的表单是为编辑数据的用例而设计的，因此未绑定的表单除了显示 HTML 之外并没有真正的用处。

例如，如果我有：

```
if request.method == 'GET':
    form = MyForm()
else:
    form = MyForm(request.method.POST)

if form.is_valid():
    do_query(form.cleaned_data['start_date'], form.cleaned_data['end_date']) 
```

is_valid() 如果这是一个 GET 将失败（因为它是未绑定的），如果我这样做：

```
if request.method == 'GET':
    form = MyForm()
    do_query(form.cleaned_data['start_date'], form.cleaned_data['end_date'])
else:
    form = MyForm(request.method.POST)
    if form.is_valid():
       do_query(form.cleaned_data['start_date'], form.cleaned_data['end_date']) 
```

第一次调用 do_query 会触发 form.cleaned_data 上的异常，该字段不是有效字段，因为`is_valid()`尚未调用。看来我必须做类似的事情：

```
if request.method == 'GET':
    form = MyForm()
    do_query(form['start_date'].field.initial, form['end_date'].field.initial)
else:
    form = MyForm(request.method.POST)
    if form.is_valid():
       do_query(form.cleaned_data['start_date'], form.cleaned_data['end_date']) 
```

也就是说，没有用于在绑定表单和未绑定表单之间检索表单值的通用接口。

有没有人看到更清洁的方法来做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-16T19:18:57.910

如果将此方法添加到表单类中：

```
def get_cleaned_or_initial(self, fieldname):
        if hasattr(self, 'cleaned_data'):
            return self.cleaned_data.get(fieldname)
        else:
            return self[fieldname].field.initial 
```

然后，您可以将代码重写为：

```
if request.method == 'GET':
    form = MyForm()
else:
    form = MyForm(request.method.POST)
    form.is_valid()

do_query(form.get_cleaned_or_initial('start_date'), form.get_cleaned_or_initial('end_date')) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T09:02:07.463

*未绑定*意味着没有与表单关联的数据（初始或稍后提供），因此验证可能会失败。如其他答案（以及您自己的结论）中所述，您必须提供初始值并检查绑定数据和初始值。

表单的用例是表单处理**和**验证，因此在访问`cleaned_data`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T19:07:39.513

您可以将初始值字典传递给您的表单：

```
if request.method == "GET":
    # calculate my_start_date and my_end_date here...
    form = MyForm( { 'start_date': my_start_date, 'end_date': my_end_date} )
... 
```

请参阅[官方表单 API 文档](http://docs.djangoproject.com/en/dev/ref/forms/api/)，他们在其中演示了这一点。

**编辑**：根据其他用户的回答，也许这是最干净的解决方案：

```
if request.method == "GET":
    form = MyForm()
    form['start_date'] = form['start_date'].field.initial
    form['end_date'] = form['end_date'].field.initial
else:
    form = MyForm(request.method.POST)
if form.is_valid():
    do_query(form.cleaned_data['start_date'], form.cleaned_data['end_date']) 
```

不过，我还没有尝试过；有人可以确认这行得通吗？我认为这比创建一个新方法要好，因为这种方法不需要其他代码（可能不是您编写的）来了解您的新“魔术”访问器。

# java - 如何将对象传递给 JSP 标记？

> ID：75626
> 
> 赞同：31
> 
> 时间：2008-09-16T18:46:07.380
> 
> 标签：java, jsp, jsp-tags, el

我有一个 JSP 页面，其中包含我实例化对象的脚本。我想将该对象传递给 JSP 标记而不使用任何缓存。

例如我想做到这一点：

```
<%@ taglib prefix="wf" uri="JspCustomTag" %>

<% 
 Object myObject = new Object();
%>

<wf:my-tag obj=myObject /> 
```

我试图避免直接与任何缓存（页面、会话、servletcontext）交互，我宁愿让我的标签处理它。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-08-04T15:02:55.040

我在这里寻找的一个稍微不同的问题：“如何将对象传递给标记文件？”

答：使用属性指令的“类型”属性：

```
<%@ attribute name="field" 
              required="true"
              type="com.mycompany.MyClass" %> 
```

该类型[默认为 java.lang.String](http://java.sun.com/j2ee/1.4/docs/tutorial/doc/JSPTags5.html#wp89854)，因此如果没有它，如果您尝试访问对象字段说它无法从 String 类型中找到该字段，则会收到错误消息。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-10T06:28:54.770

```
<jsp:useBean id="myObject" class="java.lang.Object" scope="page" />
<wf:my-tag obj="${myObject}" /> 
```

不鼓励在 JSP 页面中使用 Scriptlets。它扼杀了模板语言的目的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T19:09:44.453

最初的语法是重用 '<%= %>'

所以

```
<wf:my-tag obj="<%= myObject %>" /> 
```

有关示例，请参阅[Sun 标记库教程的这一部分](http://java.sun.com/products/jsp/tutorial/TagLibraries16.html#62510)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T19:48:18.807

对我来说，表达式语言只有在我使该变量可访问时才有效，例如将其放在页面上下文中。

```
<%  Object myObject = new Object();
    pageContext.setAttribute("myObject", myObject);
%>
<wf:my-tag obj="${myObject}" /> 
```

否则 tas 收到 null。

并且`<wf:my-tag obj="<%= myObject %>" />`无需额外的努力即可工作。<%=%> 还提供 jsp 编译时类型验证，而 El 仅在运行时验证。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-12-10T08:46:42.863

您可以使用 "<%= %>" 直接在标签中获取对象值：

```
 <wf:my-tag obj="<%= myObject %>"/> 
```

并获取该对象中任何变量的值，您可以使用“obj.parameter”获得该值，例如：

```
<wf:my-tag obj="<%= myObject.variableName %>"/> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T19:01:27.453

使用表达语言：

```
    <wf:my-tag obj="${myObject}" />

```

# visual-studio - 在团队环境中进行 Visual Studio 后期构建部署的最佳方式？

> ID：75650
> 
> 赞同：1
> 
> 时间：2008-09-16T18:49:36.717
> 
> 标签：visual-studio, deployment, build

我在一个团队环境中工作，每个开发人员都从他们的本地桌面工作并部署到他们在网络上拥有的虚拟机上。我要做的是设置 Visual Studio 解决方案，以便当他们构建解决方案时，每个项目部署都在该开发人员虚拟机的构建后事件中处理。

我真正想做的是将这些脚本的所有权也授予单个开发人员，以便他们拥有自己的后期构建步骤，并且不必对每个人都一样。

几个问题：

*   构建后事件是执行此类部署操作的地方吗？如果不是最好的地方是什么？
*   有哪些软件、工具或教程/博客文章可用于帮助开发支持这些场景的自动部署系统？

**编辑：** MSBuild 似乎是在这种情况下要走的路。有人成功使用替代技术吗？

**编辑：**如果您正在阅读此问题并想知道如何为每个开发人员执行一组不同的 MSBuild 任务，请参阅此问题；[为每个用户执行不同的 MSBuild 任务集？](https://stackoverflow.com/questions/78018/executing-different-set-of-msbuild-tasks-for-each-user)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T18:57:17.620

我会研究 MSBuild 或 ANT

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T19:04:08.570

如果您使用的是 Visual Studio 2005 或更高版本，则项目文件是 MSBUild 文件。在 MsBuild 文件中，有一个“AfterBuild”目标。我建议使用它来完成部署任务，而不是 Post Build Event。

通过使用 MSBuild 任务，您可以更好地进入持续集成系统，如 CruiseControl.NET 或 Team City。

我不确定为什么您的所有开发人员都拥有自己的虚拟机，在某些时候您似乎想要一个所有开发人员工作的中心位置，以确保所有开发人员的代码都能集成和构建（这是一个使用持续集成系统的原因）。我相信您可以找到一种方式，CruiseControl.Net 或 Team City 或其他几个选择之一可以在这种情况下为您提供帮助。但就获得初始设置而言，请使用 MSBuild。

# firefox - 是否有使用 vim 编辑文本框的 Firefox 插件？

> ID：75652
> 
> 赞同：63
> 
> 时间：2008-09-16T18:49:41.523
> 
> 标签：firefox, vim

或“如何在文本框中使用 gVim 在 Firefox 中回答关于 SO 的问题？”

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-09-16T18:51:29.600

[全是文字！](https://addons.mozilla.org/en-US/firefox/addon/4125)

从扩展页面：

> 在任何编辑框的右下角，都会出现一个小编辑按钮。点击它。如果这是您第一次使用“全是文本！” 然后你会被要求设置你的偏好，最重要的是编辑器。
> 
> 该网页将在您选择的编辑器中弹出。保存后，它会在网页中刷新。等待神奇的黄色光芒，这意味着辐射已经生效！

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-16T18:52:06.057

[Vimperator](http://vimperator.mozdev.org/)使 Firefox 的行为非常像 VIM：

> Vimperator 是一个免费的 Firefox 浏览器插件，它的外观和行为类似于 Vim 文本编辑器。它具有类似的键绑定，您可以将其称为模态 Web 浏览器，因为键绑定会根据您所处的模式而有所不同。

将光标放在文本框中后，点击`Ctrl`-`I`在编辑器中打开，默认为 gvim。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2018-05-03T20:31:35.093

由于 Mozilla 删除了 XUL 以支持 WebExtensions，因此当前的答案不再适用。对于最近的 Firefox 版本，有以下选项（按 addons.mozilla.org 上的当前流行度降序排列）。

[GhostText](https://addons.mozilla.org/en-US/firefox/addon/ghosttext/)通过特定于编辑器的插件在编辑器和文本框之间提供即时同步。该项目在[github](https://github.com/GhostText/GhostText)上，[vim 扩展](https://github.com/falstro/ghost-text-vim)是用 Tcl 编写的。

[withExEditor](https://addons.mozilla.org/en-US/firefox/addon/withexeditor/)是跨平台的，但需要使用 node.js 编写的本机应用程序。除了编辑文本字段之外，它还允许查看页面源、MathML、SVG 和当前选择。[github](https://github.com/asamuzaK/withExEditor)上的项目和本[机 node.js 应用程序](https://github.com/asamuzaK/withExEditorHost)

[Textern](https://addons.mozilla.org/en-US/firefox/addon/textern/)需要使用 Python 编写的（当前）仅限 Linux 的本机应用程序。在您在编辑器中键入时同步文本字段的内容。扩展和本机应用程序可以在[github上找到](https://github.com/jlebon/textern)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-16T18:53:29.313

[全是文字！](https://addons.mozilla.org/en-US/firefox/addon/4125)会让你使用你想要的任何编辑器。要使用 vim，您需要一个小的 shell 脚本在终端中打开它：

```
#!/bin/sh
exec xterm -e /usr/bin/vim "$@" 
```

如果你有 GVim，你显然不需要 shell、脚本。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-16T19:26:46.177

[ViewSourceWith](https://addons.mozilla.org/en-US/firefox/addon/394)是另一个值得一看的插件。它支持的不仅仅是编辑框和文本。例如，您可以将其配置为在 GIMP 中打开图像。

另一个我觉得有用的功能是它可以弹出一个对话框，显示页面上使用的所有 js 和 css 脚本。然后，您可以选择在首选编辑器中查看/编辑文件。

要回答关于 SO 的问题，您可能还需要获取[Vim Markdown 语法文件](http://www.vim.org/scripts/script.php?script_id=1242)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-16T18:51:58.070

也许是“全是文本”扩展名？

[http://addons.mozilla.org/en-US/firefox/addon/4125](http://addons.mozilla.org/en-US/firefox/addon/4125)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2020-04-24T15:10:35.867

[Tridactyl](https://addons.mozilla.org/en-US/firefox/addon/tridactyl-vim/)可能是您现在正在寻找的东西。

它是 Pentadactyl 和 Vimperator 之类的精神继承者，它们不适用于当前版本的 Firefox。

如果您想要更像 It's All Text 的东西，其中编辑区域显示在浏览器文本区域的顶部而不是启动编辑器窗口，并且您愿意使用 Neovim，请查看[firenvim](https://github.com/glacambre/firenvim)。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-06T15:08:22.680

如果您使用[vimperator](http://vimperator.mozdev.org/)并安装了[markdown 语法文件](http://www.vim.org/scripts/script.php?script_id=1242)，则 .vimperatorrc 的有用行是：

```
au LocationChange .* :set editor="gvim -f"
au LocationChange stackoverflow\.com :set editor="gvim -f -c 'set ft=mkd'" 
```

当您在 stackoverflow.com 上时，这将告诉 vim 为 markdown 进行语法突出显示，但当您在任何其他站点时则不会。wikipedia/mediawiki 等也有类似的黑客攻击。享受:)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-16T18:51:23.547

做到这一点的一种方法是使用[vimperator](http://vimperator.mozdev.org/)扩展 - 当然，这*比*您要寻找的要多得多。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-05T17:56:44.437

在撰写本文时，它是实验性的，但[jV 扩展](https://addons.mozilla.org/en-US/firefox/addon/8529)看起来不错。从页面引用：

*这个扩展使所有 html 文本区域成为一个非常精简的 Vi[m] 版本。它是模态的，支持无限撤消，具有寄存器支持、搜索、可视模式以及各种移动和编辑命令。*

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-05-06T21:07:17.730

[有一种实验方法可以使用嵌入式编辑器](http://people.ksp.sk/~martin/firefox/extensions/EmbeddedEditor/)将真正的 vim 直接嵌入到 firefox 中——尽管它需要 mozplugger 并且只能在 Linux 上运行。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-08T00:07:36.090

在 Windows 中使用 Vimperator（我使用的是 Vista）时，您可能需要双重转义 gvim.exe 的路径才能将其用作外部编辑器。单次转义对我不起作用，因为 Vimperator 两次转义。例如：

```
:set editor="C:\\\\Program\\ Files\\ (x86)\\\\Vim\\\\vim72\\\\gvim.exe" -f 
```

然后在文本框中使用 Ctrl+I 它将打开 gvim 进行编辑。当您保存并退出时，它将更新文本框。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-07-04T20:12:52.807

试用 wasavi 扩展。您可能需要查看所有版本页面以确保您试用最新版本。（[此答案](https://superuser.com/questions/527895/edit-text-areas-using-vi-key-bindings-inside-the-textbox-in-firefox-without-o/615678#615678)的副本。）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-18T03:42:15.757

您也可以使用[ViewSourceWith](https://addons.mozilla.org/en-US/firefox/addon/394)插件来实现相同的目的。只需右键单击任何文本输入，您就可以使用 Vim 对其进行编辑。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-16T21:23:34.387

正如其他人所说，作为 Vi/(g)Vim 用户，您可能希望查看 Vimperator 插件，它还提供了您所要求的内容：在文本框中，点击 <Ci> 以启动外部编辑器。（可以在 _vimperatorrc 中定义： set editor=gvim -f ）

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-03-15T19:55:59.093

给 Mac 用户的提示：如果你想在 vim 中使用“It's all text”，最简单的方法是使用[http://code.google.com/p/macvim/](http://code.google.com/p/macvim/)。将“It's all text”指向与 .app 一起提供的 mvim 脚本（您可以将此脚本放在任何地方，我选择 /usr/bin/ 以便我可以从命令行加载 mvim）

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-10-21T07:11:21.527

[Pterosaur](https://github.com/ardagnir/pterosaur)是一个 Firefox 插件，允许您在所有输入字段中使用 Vim。它在后台使用一个实际的 Vim 进程，因此它具有您期望的所有功能，包括读取您的 .vimrc 配置和插件。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-01-07T15:36:24.277

在 Linux 上使用 Firefox-57，我安装了 textern [https://addons.mozilla.org/en-US/firefox/addon/textern/](https://addons.mozilla.org/en-US/firefox/addon/textern/)，发现它是 ViewSourceWith 编辑文本框的合适替代品。

# sql - 如何转储一些 SQLite3 表的数据？

> ID：75675
> 
> 赞同：196
> 
> 时间：2008-09-16T18:52:49.690
> 
> 标签：sql, sqlite

如何转储数据库的某些 SQLite3 表（不是所有表）的数据，仅转储数据，而不转储模式？转储应该是 SQL 格式，因为它应该稍后很容易重新输入到数据库中，并且应该从命令行完成。就像是

```
sqlite3 db .dump 
```

但无需转储模式并选择要转储的表。

* * *

## 回答 #1

> 赞同：221
> 
> 时间：2008-10-13T22:18:56.783

你不是说你想对转储的文件做什么。

获取 CSV 文件（可以导入几乎所有内容）

```
.mode csv 
-- use '.separator SOME_STRING' for something other than a comma.
.headers on 
.out file.csv 
select * from MyTable; 
```

获取 SQL 文件（可以重新插入到不同的 SQLite 数据库中）

```
.mode insert <target_table_name>
.out file.sql 
select * from MyTable; 
```

* * *

## 回答 #2

> 赞同：173
> 
> 时间：2011-09-23T08:10:04.137

您可以这样做以获得 .schema 和 .dump 命令的差异。例如使用 grep：

```
sqlite3 some.db .schema > schema.sql
sqlite3 some.db .dump > dump.sql
grep -vx -f schema.sql dump.sql > data.sql 
```

`data.sql`文件将仅包含没有架构的数据，如下所示：

```
BEGIN TRANSACTION;
INSERT INTO "table1" VALUES ...;
...
INSERT INTO "table2" VALUES ...;
...
COMMIT; 
```

我希望这可以帮助你。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2009-12-21T06:12:45.527

您可以为 .dump 特殊命令指定一个或多个表参数，例如 .dump `sqlite3 db ".dump 'table1' 'table2'"`。

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2009-01-08T01:04:10.387

不是最好的方法，但至少不需要外部工具（grep 除外，它是 *nix 盒子的标准）

```
sqlite3 database.db3 .dump | grep '^INSERT INTO "tablename"' 
```

但是您确实需要为要查找的每个表执行此命令。

请注意，这不包括架构。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2013-11-16T03:18:09.597

任何建议使用 grep 排除`CREATE`行或仅从输出中获取`INSERT`行的答案`sqlite3 $DB .dump`都会严重失败。这些`CREATE TABLE`命令每行列出一列（因此排除`CREATE`不会得到全部），并且`INSERT`行上的值可以嵌入换行符（因此您不能只抓取`INSERT`行）。

```
for t in $(sqlite3 $DB .tables); do
    echo -e ".mode insert $t\nselect * from $t;"
done | sqlite3 $DB > backup.sql 
```

在 sqlite3 版本 3.6.20 上测试。

如果你想排除某些表，你可以用 过滤它们`$(sqlite $DB .tables | grep -v -e one -e two -e three)`，或者如果你想得到一个特定的子集，用 替换它`one two three`。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2011-11-01T23:19:31.797

作为对 Paul Egan 答案的改进，可以按如下方式完成：

```
sqlite3 database.db3 '.dump "table1" "table2"' | grep '^INSERT' 
```

- 或者 -

```
sqlite3 database.db3 '.dump "table1" "table2"' | grep -v '^CREATE' 
```

当然，需要注意的是您必须安装 grep。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-05-14T15:14:35.170

在 Python 或 Java 或任何高级语言中，.dump 不起作用。我们需要手动将转换编码为 CSV。我举一个 Python 例子。其他示例将不胜感激：

```
from os import path   
import csv 

def convert_to_csv(directory, db_name):
    conn = sqlite3.connect(path.join(directory, db_name + '.db'))
    cursor = conn.cursor()
    cursor.execute("SELECT name FROM sqlite_master WHERE type='table';")
    tables = cursor.fetchall()
    for table in tables:
        table = table[0]
        cursor.execute('SELECT * FROM ' + table)
        column_names = [column_name[0] for column_name in cursor.description]
        with open(path.join(directory, table + '.csv'), 'w') as csv_file:
            csv_writer = csv.writer(csv_file)
            csv_writer.writerow(column_names)
            while True:
                try:
                    csv_writer.writerow(cursor.fetchone())
                except csv.Error:
                    break 
```

如果您有'面板数据，换句话说，许多带有 id 的单个条目将其添加到 with 外观中，它还会转储摘要统计信息：

```
 if 'id' in column_names:
            with open(path.join(directory, table + '_aggregate.csv'), 'w') as csv_file:
                csv_writer = csv.writer(csv_file)
                column_names.remove('id')
                column_names.remove('round')
                sum_string = ','.join('sum(%s)' % item for item in column_names)
                cursor.execute('SELECT round, ' + sum_string +' FROM ' + table + ' GROUP BY round;')
                csv_writer.writerow(['round'] + column_names)
                while True:
                    try:
                        csv_writer.writerow(cursor.fetchone())
                    except csv.Error:
                        break 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-05-18T10:23:38.977

# 审查其他可能的解决方案

**仅包括 INSERT**

```
sqlite3 database.db3 .dump | grep '^INSERT INTO "tablename"' 
```

易于实施，但如果您的任何列包含新行，它将失败

**SQLite 插入模式**

```
for t in $(sqlite3 $DB .tables); do
    echo -e ".mode insert $t\nselect * from $t;"
done | sqlite3 $DB > backup.sql 
```

这是一个不错且可自定义的解决方案，但如果您的列在 spatialite 中具有像“几何”类型这样的 blob 对象，则它不起作用

**将转储与架构进行比较**

```
sqlite3 some.db .schema > schema.sql
sqlite3 some.db .dump > dump.sql
grep -v -f schema.sql dump > data.sql 
```

不知道为什么，但不适合我

# 另一个（新的）可能的解决方案

这个问题可能没有最佳答案，但对我有用的是 grep 插入，考虑到列值中的新行，[表达式如下](https://stackoverflow.com/a/7167115/930271)

```
grep -Pzo "(?s)^INSERT.*\);[ \t]*$" 
```

选择表确实被转储`.dump`承认一个 LIKE 参数来匹配表名，但如果这还不够，可能一个简单的脚本是更好的选择

```
TABLES='table1 table2 table3'

echo '' > /tmp/backup.sql
for t in $TABLES ; do
    echo -e ".dump ${t}" | sqlite3 database.db3 | grep -Pzo "(?s)^INSERT.*?\);$" >> /tmp/backup.sql
done 
```

或者，为了尊重外键并将所有转储封装在一个事务中进行更详细的处理

```
TABLES='table1 table2 table3'

echo 'BEGIN TRANSACTION;' > /tmp/backup.sql
echo '' >> /tmp/backup.sql
for t in $TABLES ; do
    echo -e ".dump ${t}" | sqlite3 $1 | grep -Pzo "(?s)^INSERT.*?\);$" | grep -v -e 'PRAGMA foreign_keys=OFF;' -e 'BEGIN TRANSACTION;' -e 'COMMIT;' >> /tmp/backup.sql
done

echo '' >> /tmp/backup.sql
echo 'COMMIT;' >> /tmp/backup.sql 
```

考虑到如果`);`任何列中存在字符串，则 grep 表达式将失败

恢复它（在已创建表的数据库中）

```
sqlite3 -bail database.db3 < /tmp/backup.sql 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-01-19T09:38:31.023

根据 SQLite[命令行 Shell](https://www.sqlite.org/cli.html)的 SQLite 文档，您可以将 SQLite 表（或表的一部分）导出为 CSV，只需将“模式”设置为“csv”，然后运行查询以提取所需的行桌子：

```
sqlite> .header on
sqlite> .mode csv
sqlite> .once c:/work/dataout.csv
sqlite> SELECT * FROM tab1;
sqlite> .exit 
```

然后使用“.import”命令将 CSV（逗号分隔值）数据导入 SQLite 表：

```
sqlite> .mode csv
sqlite> .import C:/work/dataout.csv tab1
sqlite> .exit 
```

请阅读有关要考虑的两种情况的进一步文档：（1）表“tab1”以前不存在，（2）表“tab1”确实存在。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-17T02:05:18.947

最好的方法是采用 sqlite3 db 转储将执行的代码，不包括架构部分。

示例伪代码：

```
SELECT 'INSERT INTO ' || tableName || ' VALUES( ' || 
  {for each value} ' quote(' || value || ')'     (+ commas until final)
|| ')' FROM 'tableName' ORDER BY rowid DESC 
```

实际代码见：（`src/shell.c:838` 对于 sqlite-3.5.9）

您甚至可以只使用该外壳并注释掉架构部分并使用它。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-05-16T13:40:43.577

此版本适用于插入内的换行符：

`sqlite3 database.sqlite3 .dump | grep -v '^CREATE'`

`CREATE`在实践中排除所有以不太可能包含换行符开头的行

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-02-17T03:42:02.477

回溯的答案应该是最接近的答案，但它不适用于我的情况。一个插入查询刚刚在中间中断，导出刚刚停止。不知道是什么原因。但是它在`.dump`.

最后，我编写了一个工具来拆分生成的 SQL `.dump`：

[https://github.com/motherapp/sqlite_sql_parser/](https://github.com/motherapp/sqlite_sql_parser/)

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2008-09-16T18:55:07.250

您可以对表格进行选择，在每个字段后插入逗号以生成 csv，或使用 GUI 工具返回所有数据并将其保存到 csv。

# algorithm - 将均匀分布转换为正态分布

> ID：75677
> 
> 赞同：119
> 
> 时间：2008-09-16T18:53:01.500
> 
> 标签：algorithm, language-agnostic

如何将均匀分布（大多数随机数生成器产生，例如在 0.0 和 1.0 之间）转换为正态分布？如果我想要我选择的平均值和标准差怎么办？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2010-07-16T13:16:20.693

方法很多：

*   不要**使用**Box Muller。特别是如果您绘制许多高斯数。Box Muller 产生的结果被限制在 -6 和 6 之间（假设双精度。浮点数会使情况恶化。）。而且它确实比其他可用方法效率低。
*   Ziggurat 很好，但需要查找表（以及由于缓存大小问题而进行的一些特定于平台的调整）
*   Ratio-of-uniforms 是我最喜欢的，只有几个加法/乘法和 1/50 的时间（例如，[看那里](http://books.google.fr/books?id=UQW_VL2H56IC&pg=PA368&lpg=PA368&dq=%22ratio+of+uniforms%22+normal+distribution&source=bl&ots=PLY_fm-_az&sig=sh7sfCZ7PeXSpyVcVi37BMhVYPo&hl=fr&ei=BlxATOmbK4HLOOjn9ZkN&sa=X&oi=book_result&ct=result&resnum=8&ved=0CD0Q6AEwBw#v=onepage&q=%22ratio%20of%20uniforms%22%20normal%20distribution&f=false)）。
*   反转 CDF**是**有效的（并且被忽略了，为什么？），如果您搜索 google，您可以快速实现它。准随机数是强制性的。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-09-16T18:58:45.820

[Ziggurat 算法](http://en.wikipedia.org/wiki/Ziggurat_algorithm)在这方面非常有效，尽管[Box-Muller 变换](http://en.wikipedia.org/wiki/Box-Muller_transform)更容易从头实现（而且速度并不慢）。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-09-17T19:46:54.887

将任何函数的分布更改为另一个函数涉及使用所需函数的倒数。

换句话说，如果你的目标是一个特定的概率函数 p(x)，你可以通过积分得到分布 -> d(x) = integral(p(x)) 并使用它的逆： Inv(d(x)) . 现在使用随机概率函数（具有均匀分布）并通过函数 Inv(d(x)) 转换结果值。您应该根据您选择的函数获得随机分布的值。

这是通用数学方法 - 通过使用它，您现在可以选择您拥有的任何概率或分布函数，只要它具有逆或良好的逆近似值。

希望这会有所帮助，并感谢关于使用分布而不是概率本身的小评论。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2008-10-13T07:39:54.747

这是一个使用 Box-Muller 变换的极坐标形式的 javascript 实现。

```
/*
 * Returns member of set with a given mean and standard deviation
 * mean: mean
 * standard deviation: std_dev 
 */
function createMemberInNormalDistribution(mean,std_dev){
    return mean + (gaussRandom()*std_dev);
}

/*
 * Returns random number in normal distribution centering on 0.
 * ~95% of numbers returned should fall between -2 and 2
 * ie within two standard deviations
 */
function gaussRandom() {
    var u = 2*Math.random()-1;
    var v = 2*Math.random()-1;
    var r = u*u + v*v;
    /*if outside interval [0,1] start over*/
    if(r == 0 || r >= 1) return gaussRandom();

    var c = Math.sqrt(-2*Math.log(r)/r);
    return u*c;

    /* todo: optimize this algorithm by caching (v*c) 
     * and returning next time gaussRandom() is called.
     * left out for simplicity */
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-17T23:05:09.370

使用中心极限定理[维基百科条目](http://en.wikipedia.org/wiki/Central_limit_theorem) [mathworld 条目](http://mathworld.wolfram.com/CentralLimitTheorem.html)对您有利。

生成 n 个均匀分布的数字，将它们相加，减去 n*0.5，您将得到一个近似正态分布的输出，其均值等于 0，方差等于`(1/12) * (1/sqrt(N))`（参见关于最后一个[均匀分布的维基百科）](http://en.wikipedia.org/wiki/Uniform_distribution_(continuous))

n=10 给你的东西快了一半。如果您想要超过一半的体面的东西，请选择 tylers 解决方案（如[wikipedia entry on normal distributions](http://en.wikipedia.org/wiki/Normal_distribution#Generating_values_for_normal_random_variables)中所述）

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-16T19:15:02.320

我会使用 Box-Muller。关于这件事有两点：

1.  每次迭代最终得到两个值
    通常，您缓存一个值并返回另一个值。在下一次调用样本时，您返回缓存的值。
2.  Box-Muller 给出 Z 分数
    然后您必须按标准差缩放 Z 分数并添加平均值以获得正态分布中的完整值。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-10-14T17:51:24.183

其中 R1、R2 是随机统一数：

正态分布，SD 为 1：

```
sqrt(-2*log(R1))*cos(2*pi*R2) 
```

这是准确的......不需要做所有那些慢循环！

参考：[dspguide.com/ch2/6.htm](http://dspguide.com/ch2/6.htm)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-04-03T18:06:47.340

八年后我可以添加一些东西似乎令人难以置信，但是对于 Java，我想向读者指出[Random.nextGaussian()](https://docs.oracle.com/javase/8/docs/api/java/util/Random.html#nextGaussian--)方法，它为您生成平均值为 0.0 和标准差为 1.0 的高斯分布。

一个简单的加法和/或乘法将根据您的需要改变平均值和标准差。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T19:17:32.593

标准 Python 库模块**random**有你想要的：

> normalvariate(mu, sigma)
> 正态分布。mu 是平均值，sigma 是标准差。

对于算法本身，请查看 Python 库中 random.py 中的函数。

手动输入在[这里](http://docs.python.org/lib/module-random.html)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-11-28T17:23:54.300

[这是使用Box-Muller](https://en.wikipedia.org/wiki/Box%E2%80%93Muller_transform)变换的极坐标形式的 Matlab 实现：

功能`randn_box_muller.m`：

```
function [values] = randn_box_muller(n, mean, std_dev)
    if nargin == 1
       mean = 0;
       std_dev = 1;
    end

    r = gaussRandomN(n);
    values = r.*std_dev - mean;
end

function [values] = gaussRandomN(n)
    [u, v, r] = gaussRandomNValid(n);

    c = sqrt(-2*log(r)./r);
    values = u.*c;
end

function [u, v, r] = gaussRandomNValid(n)
    r = zeros(n, 1);
    u = zeros(n, 1);
    v = zeros(n, 1);

    filter = r==0 | r>=1;

    % if outside interval [0,1] start over
    while n ~= 0
        u(filter) = 2*rand(n, 1)-1;
        v(filter) = 2*rand(n, 1)-1;
        r(filter) = u(filter).*u(filter) + v(filter).*v(filter);

        filter = r==0 | r>=1;
        n = size(r(filter),1);
    end
end 
```

调用`histfit(randn_box_muller(10000000),100);`它是结果： [![Box-Muller Matlab Histfit](https://i.stack.imgur.com/s4LeV.png)](https://i.stack.imgur.com/s4LeV.png)

显然，与 Matlab 内置的[randn](https://it.mathworks.com/help/matlab/ref/randn.html)相比，它确实效率低下。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-03-01T15:04:02.460

这是我在 Donald Knuth 的书*The Art of Computer Programming的第 3.4.1 节中对***算法 P**（*正态偏差的 Polar 方法*）的 JavaScript 实现：

 *```
function normal_random(mean,stddev)
{
    var V1
    var V2
    var S
    do{
        var U1 = Math.random() // return uniform distributed in [0,1[
        var U2 = Math.random()
        V1 = 2*U1-1
        V2 = 2*U2-1
        S = V1*V1+V2*V2
    }while(S >= 1)
    if(S===0) return 0
    return mean+stddev*(V1*Math.sqrt(-2*Math.log(S)/S))
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-01-19T19:44:32.553

我觉得你应该在 EXCEL 中试试这个：`=norminv(rand();0;1)`。这将产生应以零均值和统一方差正态分布的随机数。可以为“0”提供任何值，以便数字具有所需的平均值，通过更改“1”，您将获得等于输入平方的方差。

例如：`=norminv(rand();50;3)`将屈服于 MEAN = 50 VARIANCE = 9 的正态分布数。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-12-03T01:17:32.080

Q 如何将均匀分布（大多数随机数生成器产生，例如在 0.0 和 1.0 之间）转换为正态分布？

1.  对于软件实现，我知道几个随机生成器名称，它们为您提供 [0,1] 中的伪均匀随机序列（Mersenne Twister，Linear Congruate Generator）。我们称它为 U(x)

2.  存在称为概率论的数学领域。第一件事：如果你想用积分分布 F 对 rv 建模，那么你可以尝试评估 F^-1(U(x))。在 pr.theory 中证明了这样的 rv 将具有整数分布 F。

3.  当 F^-1 可以毫无问题地解析推导出时，步骤 2 可以适用于在不使用任何计数方法的情况下生成 rv~F。（例如 exp.distribution）

4.  要模拟正态分布，您可以计算 y1*cos(y2)，其中 y1~ 在 [0,2pi] 中是均匀的。y2 是 relei 分布。

问：如果我想要我选择的平均值和标准差怎么办？

您可以计算 sigma*N(0,1)+m。

可以证明，这种移位和缩放会导致 N(m,sigma)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-11-08T22:34:34.763

我有以下代码可能会有所帮助：

```
set.seed(123)
n <- 1000
u <- runif(n) #creates U
x <- -log(u)
y <- runif(n, max=u*sqrt((2*exp(1))/pi)) #create Y
z <- ifelse (y < dnorm(x)/2, -x, NA)
z <- ifelse ((y > dnorm(x)/2) & (y < dnorm(x)), x, z)
z <- z[!is.na(z)] 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-01-23T20:07:13.290

使用实现的函数 rnorm() 也更容易，因为它比为正态分布编写随机数生成器要快。请参阅以下代码作为证明

```
n <- length(z)
t0 <- Sys.time()
z <- rnorm(n)
t1 <- Sys.time()
t1-t0 
```

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2008-09-16T22:33:04.107

```
function distRandom(){
  do{
    x=random(DISTRIBUTION_DOMAIN);
  }while(random(DISTRIBUTION_RANGE)>=distributionFunction(x));
  return x;
} 
```

# c# - 如何使用 vb.net 或 asp.net 或 C# 从通过 USB 电缆连接到计算机的数码相机拍照？

> ID：75691
> 
> 赞同：6
> 
> 时间：2008-09-16T18:54:13.227
> 
> 标签：c#, vb.net, image-capture

我正在使用 vb.net/c# 编写图片编辑 Windows 窗体应用程序。我有一个客户要求从连接到计算机的数码相机拍摄照片。

如何在我的 Windows 应用程序中从 USB 连接的数码相机设备捕获照片？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-01T15:21:46.397

如果您使用 Windows 图像采集库，您将在那里看到用于捕获相机新图片事件的事件。我有类似的要求并写了一个测试台；我们去了当地的相机商店，尝试了他们拥有的所有相机。我们能找到的唯一支持此功能的相机是尼康 D 系列相机。

我们发现，对于大多数相机，插入时您甚至无法拍照。当您将它们插入 USB 端口时，大多数相机会切换到它们唯一要做的就是传输数据的模式。确定相机是否可以工作的快速方法是将其插入 PC，然后尝试拍照。如果它让你这样做，你就有机会。它还需要支持 PTP。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T19:01:48.840

我假设您想激活从相机所连接的计算机上拍照的动作。如果是这种情况，那么我要做的第一件事就是为该特定相机型号搜索 API。除了访问相机内的存储卡之外，我不相信有用于与数码相机交互的标准协议/框架。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T19:16:25.513

这取决于相机导出的接口。如果这是标准的大容量存储接口，您只需使用标准文件接口，即您会将相机视为可移动磁盘，并且可以使用标准的创建/读取/写入/文件操作。
许多新相机都有ptp（图片传输协议）接口。所以你需要使用[Windows Image Acquisition](http://msdn.microsoft.com/en-us/library/aa139779.aspx) API。

您可能会发现以下[链接](http://www.codeproject.com/KB/dotnet/wiascriptingdotnet.aspx)很有用。如果我理解正确，这是您正在寻找的示例代码。谷歌是你的朋友 :)

另一条信息：许多相机将同时支持大容量存储和 ptp 接口，并且可以通过相机用户界面进行选择。在自动模式的情况下相机可能会切换到 ptp 界面。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T18:59:54.803

通常，连接相机时，相机会显示为可移动驱动器。

因此，对于 Winforms 应用程序，只需让用户选择要上传的驱动器和图片。一旦有了图片的 FileStream，就可以进行任何处理。

在 ASP.net 中，您将需要一个 FileUpload 控件，用户可以在其中再次选择要上传的驱动器和图片。这次处理将通过 HttpRequest.Files 对象上的 MemoryStream 进行。

希望有帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T19:00:08.610

这取决于您的相机。

许多相机将简单地安装为 USB 大容量存储设备。如果是这种情况，那么您可以像复制外部磁盘上的任何其他文件一样从可见文件系统复制文件。

如果相机无法以这种方式提供其内容，您需要查看相机驱动程序文档以了解他们建议如何与之交互。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T19:01:03.787

这将取决于相机的品牌。这是[佳能](http://www.usa.canon.com/consumer/controller?act=SDKHomePageAct&keycode=Sdk_Lic&fcategoryid=314&modelid=7474&id=3464)的开始链接。

# linux - 是否可以使 raidz zfs 池中的磁盘脱机？

> ID：75693
> 
> 赞同：1
> 
> 时间：2008-09-16T18:54:52.117
> 
> 标签：linux, filesystems, solaris, zfs

当我尝试使 zfs raidz 池中的磁盘脱机时（raidz 池未镜像），zfs 说该磁盘无法脱机，因为它没有有效的镜像。

raidz 的属性之一不是它有一个冗余磁盘（甚至 raidz2 中的 2 个磁盘）......？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T22:49:32.070

你能多介绍一下你的配置吗？你正在使用什么命令？如果我理解你的问题，那应该可行。

注意：

> 您不能使池脱机到出现故障的地步。例如，您不能使 RAID-Z 配置中的两个设备脱机，也不能使顶级虚拟设备脱机。

管理[ZFS 存储池中](http://docs.huihoo.com/opensolaris/solaris-zfs-administration-guide/html/ch04s04.html)的设备。

ZFS 最佳实践[指南](http://www.solarisinternals.com/wiki/index.php/ZFS_Best_Practices_Guide)。

# postgresql - PostgreSQL 8.3 权限未更新 - 使用错误？

> ID：75696
> 
> 赞同：7
> 
> 时间：2008-09-16T18:55:41.210
> 
> 标签：postgresql, authentication, roles, privileges

我在向 PostgreSQL 8.3 中的另一个用户授予权限时遇到问题。虽然 GRANT 命令没有给我任何错误，但权限并没有显示出来。我需要“冲洗”它们吗？

```
sirprize=# CREATE DATABASE testdb;
CREATE DATABASE
sirprize=# GRANT ALL PRIVILEGES ON DATABASE testdb TO testuser;
GRANT
sirprize=# \c testdb
You are now connected to database "testdb".
testdb=# \z
 Access privileges for database "testdb"
 Schema | Name | Type | Access privileges
--------+------+------+-------------------
(0 rows)

testdb=# 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-16T21:41:57.397

`\z`显示数据库中包含的对象的表、视图和序列权限。它不显示对数据库本身的权限。如果您在 'testdb' 中创建表或其他对象，它将显示在`\z`' 输出中。

您可以查看系统上存在哪些数据库`\l`（或`\l+`获取更多信息）。

请参阅[第 9.22 节。PostgreSQL 8.3 手册](http://www.postgresql.org/docs/8.3/interactive/functions-info.html)中有关如何以编程方式确定给定数据库上的用户存在哪些权限的信息。

# java - JPA 多事务管理器

> ID：75700
> 
> 赞同：12
> 
> 时间：2008-09-16T18:56:20.243
> 
> 标签：java, spring, orm, jpa, transactions

我有一个 applicationContext.xml 文件，它在 Spring 中间件自定义应用程序中配置了两个 org.springframework.orm.jpa.JpaTransactionManager （每个都有自己的持久性单元，不同的数据库）。

我想使用基于注释的事务（@Transactional），而不是搞乱 TransactionStatus 提交、保存和回滚。

一位同事提到，当有多个事务管理器时，即使上下文文件设置正确（引用转到正确的持久性单元），这样做也会感到困惑。有人见过问题吗？

* * *

在您的配置中，您会有两个事务管理器吗？你会有 txManager1 和 txManager2 吗？

这就是我在 JPA 中所拥有的，两个不同的 Spring bean 是事务管理器。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-16T23:56:40.503

我猜你有2个选择

如果您的用例从不需要在同一事务中更新两个数据库，那么您可以使用两个 JpaTransactionManager，但我不确定您是否能够使用 @Transactional 方法？在这种情况下，您需要回退到使用简单[TransactionProxyFactoryBean](http://static.springframework.org/spring/docs/2.5.5/api/org/springframework/transaction/interceptor/TransactionProxyFactoryBean.html)来定义事务边界的旧机制，例如：

```
<bean id="firstRealService" class="com.acme.FirstServiceImpl"/>
<bean id="firstService"  
    class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
    <property name="transactionManager" ref="firstJpaTm"/>
    <property name="target" ref="firstRealService"/>
    <property name="transactionAttributes">
        <props>
           <prop key="insert*">PROPAGATION_REQUIRED</prop>
           <prop key="update*">PROPAGATION_REQUIRED</prop>
           <prop key="*">PROPAGATION_REQUIRED,readOnly</prop>
        </props>
    </property>
</bean>
<!-- similar for your second service --> 
```

如果您需要跨越两个数据库的事务，那么您将需要使用 JTA 事务管理器。[API](http://static.springframework.org/spring/docs/2.5.5/api/org/springframework/orm/jpa/JpaTransactionManager.html)声明：

> 此事务管理器适用于使用单个 JPA EntityManagerFactory 进行事务数据访问的应用程序。JTA（通常通过 JtaTransactionManager）对于访问同一事务中的多个事务资源是必需的。请注意，您需要相应地配置您的 JPA 提供程序以使其参与 JTA 事务。

这意味着您需要提供一个 JTA 事务管理器。在我们的应用程序中，我们使用类似于以下的配置：

```
<tx:annotation-driven transaction-manager="txManager"/>

<bean id="txManager" 
    class="org.springframework.transaction.jta.JtaTransactionManager">
    <property name="transactionManagerName" value="appserver/jndi/path" />
</bean> 
```

如果您在应用服务器中进行部署，那么 spring JtaTransactionManager 需要对应用服务器提供的真正符合 XA 的 JTA 事务管理器进行查找。但是，您也可以使用独立的 JTA 事务管理器（但我自己还没有尝试过）

至于配置 Jpa 持久化提供者，我不是很熟悉。您使用的是什么 JPA 持久性提供程序？

上面的代码基于我们的方法，我们使用的是本机 Hibernate，而不是 Hibernate 的 JPA 实现。在这种情况下，我们能够摆脱两个 HibernateTransactionManager bean，并简单地确保两个 SessionFactories 都注入了​​相同的 JTA TM，然后使用 tx:annotation-driven 元素。

希望这可以帮助

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-11T13:30:50.833

您可以拥有两个 Spring 事务管理器的唯一情况是，如果您永远不会同时打开两个事务。这本质上与分布式事务无关 - 即使您希望两个数据源具有完全独立的（但可能在时间上重叠）事务生命周期，同样的限制也适用。

在内部，Spring 的事务管理器都使用 Spring 的 TransactionSynchronizationManager，它在静态 ThreadLocal 变量中保存了一堆关键状态，因此事务管理器可以保证相互之间的状态。

# c++ - DLL 中声明的全局变量会怎样？

> ID：75701
> 
> 赞同：42
> 
> 时间：2008-09-16T18:56:21.770
> 
> 标签：c++, windows, dll

假设我用 C++ 编写了一个 DLL，并声明了一个具有非平凡析构函数的类的全局对象。DLL卸载时会调用析构函数吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-16T23:11:06.293

在 Windows C++ DLL 中，所有全局对象（包括类的静态成员）将在使用 DLL_PROCESS_ATTACH 调用 DllMain 之前构建，并且在使用 DLL_PROCESS_DETACH 调用 DllMain 之后将它们销毁。

现在，您必须考虑三个问题：

0 - 当然，全局非常量对象是邪恶的（但你已经知道了，所以我将避免提及多线程、锁、上帝对象等）

1 - 不保证对象或不同编译单元（即 CPP 文件）的构建顺序，因此如果两个对象在两个不同的 CPP 中实例化，您不能希望对象 A 在 B 之前构建。如果 B 依赖于 A，这很重要。解决方案是将所有全局对象移动到同一个 CPP 文件中，因为在同一个编译单元内，对象的实例化顺序将是构造顺序（以及顺序的倒数）破坏）

2 - 在 DllMain 中有一些禁止做的事情。这些东西在构造函数中也可能是被禁止的。所以避免锁定一些东西。请参阅 Raymond Chen 关于该主题的优秀博客：

*   [在你的 DllMain 中不要做任何可怕的事情的一些理由](https://devblogs.microsoft.com/oldnewthing/20040127-00/?p=40873)
*   [不要在 DllMain 中做任何可怕的事情的另一个原因：无意的死锁](https://devblogs.microsoft.com/oldnewthing/20040128-00/?p=40853)
*   [在 DllMain 中不做任何可怕事情的一些理由，第 3 部分](https://devblogs.microsoft.com/oldnewthing/20140821-00/?p=183)

在这种情况下，延迟初始化可能会很有趣：类保持在“未初始化”状态（内部指针为 NULL，布尔值为 false，等等），直到您调用它们的方法之一，此时它们将自行初始化。如果您在 main（或 main 的后代函数之一）中使用这些对象，您会没事的，因为它们将在 DllMain 执行后被调用。

3 - 当然，如果 DLL A 中的一些全局对象依赖于 DLL B 中的全局对象，你应该非常小心 DLL 的加载顺序，以及依赖关系。在这种情况下，具有直接或间接循环依赖的 DLL 会让您非常头疼。最好的解决方案是打破循环依赖。

PS：请注意，在 C++ 中，构造函数可以抛出，并且您不希望在 DLL 加载过程中出现异常，因此请确保您的全局对象在没有非常非常好的理由的情况下不会使用异常。由于正确编写的析构函数无权抛出，因此在这种情况下，DLL 卸载应该没问题。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-16T19:57:52.030

Microsoft 的此页面详细介绍了 DLL 初始化和全局变量的破坏：http:
[//msdn.microsoft.com/en-us/library/988ye33t.aspx](http://msdn.microsoft.com/en-us/library/988ye33t.aspx)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T20:32:02.227

如果您想查看链接 .dll 时执行的实际代码，请查看`%ProgramFiles%\Visual Studio 8\vc\crt\src\dllcrt0.c`.

`_cexit()`通过检查，当 dll CRT 维护的内部引用计数达到零时，将调用析构函数。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T19:04:55.120

它应该在应用程序结束或 DLL 被卸载时调用，以先到者为准。请注意，这在某种程度上取决于您正在编译的实际运行时。

此外，请注意非平凡的析构函数，因为存在时间和顺序问题。您的 DLL 可能会在您的析构函数依赖的 DLL**之后被卸载，这显然会导致问题。**

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-07-01T14:37:35.413

在带有扩展名*.exe 的windows 二进制图像文件中，*.dll 为[PE 格式](https://msdn.microsoft.com/en-us/windows/hardware/gg463119.aspx)， 此类文件具有入口点。您可以使用 dumpbin 工具查看它，例如

> dumpbin /headers dllname.dll

如果您使用 Microsoft 的 C 运行时，那么您的入口点将类似于 *CRTStartup 或 *DllMainCRTStartup

此类函数执行 c 和 c++ 运行时的初始化，并将执行分别委托给 (main, WinMain) 或 DllMain。

如果您使用微软的 VC 编译器，那么您可以在您的 VC 目录中查看此函数的源代码：

*   crt0.c
*   dllcrt0.c

DllMainCRTStartup 在正常情况下，当它在 dll 卸载期间检索通知 DLL_PROCESS_DETACH 时，所有事情都需要从 .data 部分初始化/取消初始化您的全局变量。例如：

*   程序启动线程的main或WinMain返回控制流
*   您明确调用 FreeLibrary 并且 use-dll-counter 为零

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T19:10:25.107

当调用带有 fdwReason = DLL_PROCESS_DETACH 参数的 DllMain 时，意味着应用程序卸载了 DLL。这是调用全局/静态对象的析构函数之前的时间。

# mysql - 如何检查一个值是否是 MySQL 中的整数？

> ID：75704
> 
> 赞同：132
> 
> 时间：2008-09-16T18:56:53.830
> 
> 标签：mysql

我看到在 MySQL 中有从值创建整数`Cast()`的`Convert()`函数，但是有没有办法检查一个值是否是一个整数？`is_int()`我正在寻找类似PHP 的东西。

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2008-09-16T19:13:47.313

我假设你想检查一个字符串值。一种不错的方法是 REGEXP 运算符，将字符串与正则表达式匹配。简单地做

```
select field from table where field REGEXP '^-?[0-9]+$'; 
```

这是相当快的。如果您的字段是数字，只需测试

```
ceil(field) = field 
```

反而。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-16T19:01:00.263

将其与正则表达式匹配。

cf [http://forums.mysql.com/read.php?60,1907,38488#msg-38488](http://forums.mysql.com/read.php?60,1907,38488#msg-38488)引用如下：

> Re: MySQL 中的 IsNumeric() 子句？
> 发布者：kevinclark ()
> 日期：2005 年 8 月 8 日 01:01PM
> 
> 我同意。这是我为 MySQL 5 创建的函数：

```
CREATE FUNCTION IsNumeric (sIn varchar(1024)) RETURNS tinyint
RETURN sIn REGEXP '^(-|\\+){0,1}([0-9]+\\.[0-9]*|[0-9]*\\.[0-9]+|[0-9]+)$'; 
```

> 这允许在开头使用可选的加号/减号、一个可选的小数点和其余数字。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-09-25T06:28:40.997

假设我们有一列包含字母数字字段的条目，例如

```
a41q
1458
xwe8
1475
asde
9582
.
.
.
.
.
qe84 
```

并且您想要此 db 列中的最高数值（在本例中为 9582），那么此查询将帮助您

```
SELECT Max(column_name) from table_name where column_name REGEXP '^[0-9]+$' 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-03-09T10:54:25.020

这是假设数据类型为 varchar 的简单解决方案

```
select * from calender where year > 0 
```

如果年份是数字，它将返回 true，否则返回 false

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2013-12-24T12:33:40.083

这也有效：

```
CAST( coulmn_value AS UNSIGNED ) // will return 0 if not numeric string. 
```

例如

```
SELECT CAST('a123' AS UNSIGNED) // returns 0
SELECT CAST('123' AS UNSIGNED) // returns 123 i.e. > 0 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-07-29T07:36:58.070

要检查 Mysql 中的值是否为 Int，我们可以使用以下查询。此查询将给出具有 Int 值的行

```
SELECT col1 FROM table WHERE concat('',col * 1) = col; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-04-18T10:59:37.837

我能想到的最好的变量是 int 是与 MySQL 的函数`CAST()`和`LENGTH()`.
此方法适用于字符串、整数、双精度/浮点数数据类型。

```
SELECT (LENGTH(CAST(<data> AS UNSIGNED))) = (LENGTH(<data>)) AS is_int 
```

见演示[http://sqlfiddle.com/#!9/ff40cd/44](http://sqlfiddle.com/#!9/ff40cd/44)

> 如果该列具有单个字符值，它将失败。如果列的值为“A”，则 Cast('A' as UNSIGNED) 将评估为 0，LENGTH(0) 将为 1。因此 LENGTH(Cast('A' as UNSIGNED))=LENGTH(0) 将评估为1=1 => 1

真正的 Waqas Malik 完全忘记了测试那个案例。补丁是。

```
SELECT <data>, (LENGTH(CAST(<data> AS UNSIGNED))) = CASE WHEN CAST(<data> AS UNSIGNED) = 0 THEN CAST(<data> AS UNSIGNED) ELSE (LENGTH(<data>)) END AS is_int; 
```

**结果**

```
**Query #1**

    SELECT 1, (LENGTH(CAST(1 AS UNSIGNED))) = CASE WHEN CAST(1 AS UNSIGNED) = 0 THEN CAST(1 AS UNSIGNED) ELSE (LENGTH(1)) END AS is_int;

| 1   | is_int |
| --- | ------ |
| 1   | 1      |

---
**Query #2**

    SELECT 1.1, (LENGTH(CAST(1 AS UNSIGNED))) = CASE WHEN CAST(1.1 AS UNSIGNED) = 0 THEN CAST(1.1 AS UNSIGNED) ELSE (LENGTH(1.1)) END AS is_int;

| 1.1 | is_int |
| --- | ------ |
| 1.1 | 0      |

---
**Query #3**

    SELECT "1", (LENGTH(CAST("1" AS UNSIGNED))) = CASE WHEN CAST("1" AS UNSIGNED) = 0 THEN CAST("1" AS UNSIGNED) ELSE (LENGTH("1")) END AS is_int;

| 1   | is_int |
| --- | ------ |
| 1   | 1      |

---
**Query #4**

    SELECT "1.1", (LENGTH(CAST("1.1" AS UNSIGNED))) = CASE WHEN CAST("1.1" AS UNSIGNED) = 0 THEN CAST("1.1" AS UNSIGNED) ELSE (LENGTH("1.1")) END AS is_int;

| 1.1 | is_int |
| --- | ------ |
| 1.1 | 0      |

---
**Query #5**

    SELECT "1a", (LENGTH(CAST("1.1" AS UNSIGNED))) = CASE WHEN CAST("1a" AS UNSIGNED) = 0 THEN CAST("1a" AS UNSIGNED) ELSE (LENGTH("1a")) END AS is_int;

| 1a  | is_int |
| --- | ------ |
| 1a  | 0      |

---
**Query #6**

    SELECT "1.1a", (LENGTH(CAST("1.1a" AS UNSIGNED))) = CASE WHEN CAST("1.1a" AS UNSIGNED) = 0 THEN CAST("1.1a" AS UNSIGNED) ELSE (LENGTH("1.1a")) END AS is_int;

| 1.1a | is_int |
| ---- | ------ |
| 1.1a | 0      |

---
**Query #7**

    SELECT "a1", (LENGTH(CAST("1.1a" AS UNSIGNED))) = CASE WHEN CAST("a1" AS UNSIGNED) = 0 THEN CAST("a1" AS UNSIGNED) ELSE (LENGTH("a1")) END AS is_int;

| a1  | is_int |
| --- | ------ |
| a1  | 0      |

---
**Query #8**

    SELECT "a1.1", (LENGTH(CAST("a1.1" AS UNSIGNED))) = CASE WHEN CAST("a1.1" AS UNSIGNED) = 0 THEN CAST("a1.1" AS UNSIGNED) ELSE (LENGTH("a1.1")) END AS is_int;

| a1.1 | is_int |
| ---- | ------ |
| a1.1 | 0      |

---
**Query #9**

    SELECT "a", (LENGTH(CAST("a" AS UNSIGNED))) = CASE WHEN CAST("a" AS UNSIGNED) = 0 THEN CAST("a" AS UNSIGNED) ELSE (LENGTH("a")) END AS is_int;

| a   | is_int |
| --- | ------ |
| a   | 0      | 
```

看[演示](https://www.db-fiddle.com/f/NNXJ9cPwxjNPz9NknsSGU/0)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-07-27T18:20:23.077

关于什么：

```
WHERE table.field = "0" or CAST(table.field as SIGNED) != 0 
```

测试数字和推论：

```
WHERE table.field != "0" and CAST(table.field as SIGNED) = 0 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-05-16T21:05:38.390

我曾尝试使用上面列出的正则表达式，但它们不适用于以下情况：

```
SELECT '12 INCHES' REGEXP '^(-|\\+){0,1}([0-9]+\\.[0-9]*|[0-9]*\\.[0-9]+|[0-9]+)$' FROM ... 
```

上面将返回`1`( `TRUE`)，这意味着字符串 '12 INCHES' 针对上面的正则表达式的测试，返回`TRUE`。它看起来像一个基于上面使用的正则表达式的数字。在这种情况下，因为 12 位于字符串的开头，所以正则表达式将其解释为数字。

以下将返回正确的值（即`0`），因为字符串以字符而不是数字开头

```
SELECT 'TOP 10' REGEXP '^(-|\\+){0,1}([0-9]+\\.[0-9]*|[0-9]*\\.[0-9]+|[0-9]+)$' FROM ... 
```

上面将返回`0`( `FALSE`) 因为字符串的开头是文本而不是数字。

但是，如果您处理的字符串混合了数字和以数字开头的字母，您将不会得到想要的结果。REGEXP 会将字符串解释为有效数字，而实际上它不是。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-01-07T12:57:41.443

这适用于以数字开头或不以数字开头的 VARCHAR。

```
WHERE concat('',fieldname * 1) != fieldname 
```

当您获得较大的 NNNNE+- 数字时可能会受到限制

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-01-25T07:42:10.190

对我来说唯一有效的是：

```
CREATE FUNCTION IsNumeric (SIN VARCHAR(1024)) RETURNS TINYINT
RETURN SIN REGEXP '^(-|\\+){0,1}([0-9]+\\.[0-9]*|[0-9]*\\.[0-9]+|[0-9]+)$'; 
```

`234jk456`从 kevinclark 所有其他返回无用的东西给我，以防万一`12 inches`

# c# - 如何使用 C#/.NET ODBC 或 OLE 读取/写入 dBase III 文件？

> ID：75705
> 
> 赞同：8
> 
> 时间：2008-09-16T18:56:54.937
> 
> 标签：c#, .net, dbf, dbase

我已经搜索了有关如何通过 C#/.NET 使用 OLEDB 或 ODBC 读取/写入 dBase III (dbf) 文件的各种技术。我已经尝试了几乎所有发布的技术，但没有成功。有人可以指出我正确的方向吗？

谢谢你的时间。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-16T19:18:05.213

就像是 ... ？

```
 ConnectionString = "Provider=Microsoft.Jet.OLEDB.4.0;" & _
"Data Source=e:\My Documents\dBase;Extended Properties=dBase III"
Dim dBaseConnection As New System.Data.OleDb.OleDbConnection(ConnectionString )
dBaseConnection.Open() 
```

来自：[http ://bytes.com/forum/thread112085.html](http://bytes.com/forum/thread112085.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-05-08T05:12:57.800

我意识到这是一个旧线程，但万一有人通过谷歌来到这里（就像我几天前一样）。正如我在[这里](https://stackoverflow.com/questions/3206029/optimal-way-to-handle-dbf-from-c-sharp/10492849#10492849)写的那样，优雅的解决方案是使用[LINQ to VFP](http://linqtovfp.codeplex.com/)来读取和写入 DBF 文件。我用一些 dBase III 文件对其进行了测试。它是这样的：

您定义表以匹配 DBF 定义，如下所示：

```
public partial class MyTable 
{
    public System.Int32 ID { get; set; }
    public System.Decimal Field1 { get; set; }
    public System.String Field2 { get; set; }
    public System.String Field3 { get; set; }
} 
```

您可以这样定义上下文：

```
public partial class Context : DbEntityContextBase 
{
    public Context(string connectionString)
        : this(connectionString, typeof(ContextAttributes).FullName) 
    {
    }

    public Context(string connectionString, string mappingId)
        : this(VfpQueryProvider.Create(connectionString, mappingId)) 
    {
    }

    public Context(VfpQueryProvider provider)
        : base(provider) 
    {
    }

    public virtual IEntityTable<MyTable> MyTables 
    {
        get { return this.GetTable<MyTable>(); }
    }
} 
```

您可以像这样定义上下文属性：

```
public partial class ContextAttributes : Context 
{
    public ContextAttributes(string connectionString)
        : base(connectionString) {
    }

    [Table(Name="mytable")]
    [Column(Member="ID", IsPrimaryKey=true)]
    [Column(Member="Field1")]
    [Column(Member="Field2")]
    [Column(Member="Field3")]
    public override IEntityTable<MyTable> MyTables 
    {
        get { return base.MyTables; }
    }
} 
```

您还需要一个连接字符串，您可以像这样在 app.config 中定义它（`Data\`在这种情况下，相对路径用作 DBF 文件的来源）：

```
<connectionStrings>
  <add name="VfpData" providerName="System.Data.OleDb"
    connectionString="Provider=VFPOLEDB.1;Data Source=Data\;"/>
</connectionStrings> 
```

最后，您可以对 DBF 文件执行读写操作，如下所示：

```
// Construct a new context
var context = new Context(ConfigurationManager.ConnectionStrings["VfpData"].ConnectionString);

// Write to MyTable.dbf
var my = new MyTable
{
    ID = 1,
    Field1 = 10,
    Field2 = "foo",
    Field3 = "bar"
}
context.MyTables.Insert(my);

// Read from MyTable.dbf
Console.WriteLine("Count:  " + context.MyTables.Count());
foreach (var o in context.MyTables)
{
    Console.WriteLine(o.Field2 + " " + o.Field3);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T19:10:01.037

FoxPro 2.0 文件与 dBase III 文件完全相同，但对于任何类型为“memo”的字段都有一个额外的位（不确定确切的名称，已经有一段时间了）。这意味着如果您只使用[FoxPro 2.x 方法](http://www.connectionstrings.com/?carrier=visualfoxpro)来访问文件，它应该可以工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T00:44:34.733

这是一个不错的方法，我没有测试过，但我很快就会......

[http://www.c-sharpcorner.com/uploadfile/rfederico/xbaseenginerfv12022005011623am/xbaseenginerfv.aspx](http://www.c-sharpcorner.com/uploadfile/rfederico/xbaseenginerfv12022005011623am/xbaseenginerfv.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-04-23T18:29:22.177

我提供了许多关于使用数据库文件的答案（更具体地说是 VFP，但 Microsoft VFP OleDb 提供程序将识别较旧的 dbase 文件。您可以通过以下方式进行搜索以找到更多这些链接：

用户：74195[vfp][oledb]

首先，我将从下载[Microsoft VFP OleDb Provider](https://www.microsoft.com/en-us/download/details.aspx?id=14839)开始。

接下来，如果您已经有一些 dbf 文件要尝试连接以进行测试，则需要建立连接。连接必须指向文件所在的 PATH，而不是特定的 .dbf 文件。因此，如果您有一个包含 20 个表的文件夹，一旦您连接到 PATH，您可以通过标准 VFP-SQL 语法从任何/所有表中查询（与许多 sql 的整体结构相同，但根据某些功能而有所不同像字符串、日期和数字操作）。

了解参数化您的查询。使用 VFP OleDb，参数是用“？”完成的。字符作为占位符，因此需要以与查询中出现的完全相同的顺序添加参数。这 ”？” 可以显示为字段值、连接条件、where 条件等。

以下是一些让您开始的方法，希望让您开始使用有效的连接、查询，然后使用参数插入/更新/删除。

1.  [显示连接字符串和来自表的简单查询的示例](https://stackoverflow.com/questions/33746435/how-to-query-a-foxpro-dbf-file-with-ndx-index-file-using-the-oledb-driver-in-c/33746532#33746532)

2.  [显示一个参数化的 sql-insert](https://stackoverflow.com/questions/32578233/create-dbf-file-from-sql-table-records/32696552#32696552)，但在这种情况下从另一个数据源获取数据，例如 sql-server 并从中创建一个 VFP/dbf 样式表。它遍历记录并为每个参数提取值并插入。

3.  [另一个显示参数化 SQL 更新](https://stackoverflow.com/questions/30648602/oledb-update-command-not-changing-data/30650636#30650636)

祝你好运，还有很多其他人回答了 VFP 和 OleDb Access，这些只是我专门参与的一些，并展示了一些你可能会错过的功能实现。

# .net - 在个人资料中获取具有特定值的用户

> ID：75712
> 
> 赞同：1
> 
> 时间：2008-09-16T18:58:07.087
> 
> 标签：.net, membership, roles

我在我的 vb .net 应用程序中使用成员身份和角色进行身份验证。我们在应用程序中有大约 5 个角色，其中某些角色填写特定的配置文件值。示例是角色是商店，配置文件值是商店编号。显然，如果您为总部工作，您没有商店编号，所以我不在乎。每个商店也可以有超过 1 名员工。

我需要获取特定商店编号的用户。这意味着我只希望属于商店编号 101 的用户显示该列表。我们现在这样做的方式是遍历所有用户并将符合条件的用户添加到排序列表中。这个功能，但问题是当你开始传递大约 3,000 个用户时。它只是变得缓慢。

你们会如何找到不同的方法呢？我真的不想做自定义存储过程或更改底层类，因为我担心这一切都会在更高版本的 .net 上中断，因为它们会更改成员资格和角色。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T19:25:10.423

这确实是您想要在 SQL 中过滤的东西。我认为没有任何技巧可以绕过对数据进行线性扫描并获得所需的结果。

如果在 SQL 中这样做不是一个选项，那么也许您可以避免创建第二个列表，而只需对您的主用户数组进行排序，并让显示器只显示您关心的那些。这样至少可以节省内存复制时间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T19:23:34.250

您使用的是内置的.NET 角色管理器，它保存到我接受的 SQL Server 实例中？当您当前查看用户对象以评估标准时，您的用户对象采用什么格式？如果您发布代码示例，我有一个想法......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:20:44.313

```
 Public Shared Function LoadALLUsersInRole(ByVal Code As Integer, ByVal Role As String) As ArrayList
        Dim pb As ProfileBase
        Dim usersArrayList As New ArrayList
        Dim i As Integer
        Dim AllUsersInRole() As String = Roles.GetUsersInRole(Role)

        For i = 0 To AllUsersInRole.Length - 1

            pb = ProfileBase.Create(AllUsersInRole(i), True)

            'Check to see if the current user in the collect belongs to this Store.
            If CType(pb.GetPropertyValue("Store.Code"), Integer) = Code Then                    
                    usersArrayList.Add(AllUsersInRole(i))                   
            End If
            pb = Nothing
        Next

        Return usersArrayList
    End Function 
```

那是我如何做的示例代码。我不想在 SOL 方面这样做的原因是，我会非常依赖成员资格和角色不会改变的事实。

# wpf - WPF 无法将数据绑定到接口？

> ID：75713
> 
> 赞同：2
> 
> 时间：2008-09-16T18:58:08.723
> 
> 标签：wpf, data-binding, interface

我正在尝试将 WPF 表单中的控件绑定到接口，但出现运行时错误，它无法找到接口的属性。

这是我用作数据源的类：

```
public interface IPerson
{
    string UserId { get; set; }
    string UserName { get; set; }
    string Email { get; set; }
}

public class Person : EntityBase, IPerson
{
    public virtual string UserId { get; set; }
    public string UserName { get; set; }
    public virtual string Email { get; set; }
} 
```

这是 XAML（摘录）：

```
<TextBox Name="userIdTextBox" Text="{Binding UserId}" />
<TextBox Name="userNameTextBox" Text="{Binding UserName}" />
<TextBox Name="emailTextBox" Text="{Binding Email}" /> 
```

这是背后的代码（再次摘录）：

```
var person = PolicyInjection.Wrap<IPerson>(new Person());
person.UserId = "jdoe";
person.UserName = "John Doe";
person.Email = "jdoe@live.com";

this.DataContext = person; 
```

请注意，我用作数据源的类需要是一个实体，因为我通过 entlib 的策略注入应用程序块使用策略注入。

我在运行时收到此错误：

```
System.Windows.Data Error: 16 : Cannot get 'Email' value (type 'String') from '' (type 'Person'). BindingExpression:Path=Email; DataItem='Person' (HashCode=22322349); target element is 'TextBox' (Name='emailTextBox'); target property is 'Text' (type 'String') TargetException:'System.Reflection.TargetException: Object does not match target type.
   at System.Reflection.RuntimeMethodInfo.CheckConsistency(Object target)
   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture, Boolean skipVisibilityChecks)
   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.RuntimePropertyInfo.GetValue(Object obj, BindingFlags invokeAttr, Binder binder, Object[] index, CultureInfo culture)
   at System.Reflection.RuntimePropertyInfo.GetValue(Object obj, Object[] index)
   at MS.Internal.Data.PropertyPathWorker.GetValue(Object item, Int32 level)
   at MS.Internal.Data.PropertyPathWorker.RawValue(Int32 k)' 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T21:28:52.153

我不熟悉 entlib 的策略注入，但我很确定你的问题出在那儿，而不是因为你正在使用接口。
如果你要更换

```
var person = PolicyInjection.Wrap<IPerson>(new Person()); 
```

和

```
IPerson person = new Person(); 
```

肯定会奏效吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T21:36:48.377

在我们的项目中，我们几乎只绑定了接口，一切都没有问题。您遇到的问题是由于 entlib... 但我对 entlib 不够熟悉，无法帮助您。但是，WPF 可以绑定到接口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T21:33:25.543

我认为代码没有太大问题。从技术上讲，您正在绑定 Person 类的实例（即无论如何尝试绑定到接口是没有意义的）我不知道您的 PolicyInjection.Wrap 方法是做什么的，但我假设它返回一个具体的人物类？无论如何，我只是在最后尝试了这个，它工作正常......

```
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();

        IPerson person = new Person() { FirstName = "Hovito" };

        this.DataContext = person;
    }
}

public class Person : IPerson
{
    public virtual string FirstName { get; set; }
    public string LastName { get; set; }
}

public interface IPerson
{
    string FirstName { get; set; }
    string LastName { get; set; }
} 
```

我建议您多研究一下 PolicyInjection 类。看看它是否真的像你期望的那样返回一个 Person 类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-27T22:13:56.093

尝试在 XAML 中明确指定属性路径：

```
<TextBox Name="userIdTextBox" Text="{Binding (myns:IPerson.UserId)}" /> 
<TextBox Name="userNameTextBox" Text="{Binding (myns:IPerson.UserName)}" /> 
<TextBox Name="emailTextBox" Text="{Binding (myns:IPerson.Email)}" /> 
```

我猜策略注入生成的类型是基于 Person 类的，但是是动态的和内部的。据我所知，XAML 数据绑定引擎只能与公共类型一起使用。

# c# - PropertyGrid、DefaultValueAttribute、动态对象和枚举

> ID：75714
> 
> 赞同：2
> 
> 时间：2008-09-16T18:58:12.017
> 
> 标签：c#, reflection, attributes, enumeration

注意：我使用的是 .Net 1.1，尽管我并不完全反对使用更高版本的答案。

我在 PropertyGrid 中显示一些动态生成的对象。这些对象具有数字、文本和枚举属性。目前我在设置枚举的默认值时遇到问题，因此它们在列表中并不总是显示为粗体。枚举本身也是动态生成的，并且除了默认值之外似乎工作正常。

首先，我想展示在导致错误的情况下如何生成枚举。第一行使用自定义类来查询数据库。只需将此行替换为 DataAdapter 或使用数据库值填充 DataSet 的首选方法。我正在使用第 1 列中的字符串值来创建我的枚举。

```
private Type GetNewObjectType(string field, ModuleBuilder module, DatabaseAccess da)

//Query the database.
System.Data.DataSet ds = da.QueryDB(query);

EnumBuilder eb = module.DefineEnum(field, TypeAttributes.Public, typeof(int));

for(int i = 0; i < ds.Tables[0].Rows.Count; i++)
{
    if(ds.Tables[0].Rows[i][1] != DBNull.Value)
    {
        string text = Convert.ToString(ds.Tables[0].Rows[i][1]);

        eb.DefineLiteral(text, i);
    }
}

return eb.CreateType(); 
```

现在了解如何创建类型。这主要基于[此处](http://mironabramson.com/blog/post/2008/06/Create-you-own-new-Type-and-use-it-on-run-time-(C).aspx)提供的示例代码。本质上，将 pFeature 视为数据库行。我们遍历列，使用列名作为新的属性名，使用列值作为默认值；至少这是目标。

```
// create a dynamic assembly and module
AssemblyName assemblyName = new AssemblyName();
assemblyName.Name = "tmpAssembly";
AssemblyBuilder assemblyBuilder = System.Threading.Thread.GetDomain().DefineDynamicAssembly(assemblyName, AssemblyBuilderAccess.Run);
ModuleBuilder module = assemblyBuilder.DefineDynamicModule("tmpModule");

// create a new type builder
TypeBuilder typeBuilder = module.DefineType("BindableRowCellCollection", TypeAttributes.Public | TypeAttributes.Class);

// Loop over the attributes that will be used as the properties names in out new type
for(int i = 0; i < pFeature.Fields.FieldCount; i++)
{
    string propertyName = pFeature.Fields.get_Field(i).Name;
    object val = pFeature.get_Value(i);

    Type type = GetNewObjectType(propertyName, module, da);

    // Generate a private field
    FieldBuilder field = typeBuilder.DefineField("_" + propertyName, type, FieldAttributes.Private);

    // Generate a public property
    PropertyBuilder property =
        typeBuilder.DefineProperty(propertyName,
        PropertyAttributes.None,
        type,
        new Type[0]);

    //Create the custom attribute to set the description.
    Type[] ctorParams = new Type[] { typeof(string) };
    ConstructorInfo classCtorInfo =
        typeof(DescriptionAttribute).GetConstructor(ctorParams);

    CustomAttributeBuilder myCABuilder = new CustomAttributeBuilder(
        classCtorInfo,
        new object[] { "This is the long description of this property." });

    property.SetCustomAttribute(myCABuilder);

    //Set the default value.
    ctorParams = new Type[] { type };
    classCtorInfo = typeof(DefaultValueAttribute).GetConstructor(ctorParams);

    if(type.IsEnum)
    {
        //val contains the text version of the enum. Parse it to the enumeration value.
        object o = Enum.Parse(type, val.ToString(), true);
        myCABuilder = new CustomAttributeBuilder(
            classCtorInfo,
            new object[] { o });
    }
    else
    {
        myCABuilder = new CustomAttributeBuilder(
            classCtorInfo,
            new object[] { val });
    }

    property.SetCustomAttribute(myCABuilder);

    // The property set and property get methods require a special set of attributes:
    MethodAttributes GetSetAttr =
        MethodAttributes.Public |
        MethodAttributes.HideBySig;

    // Define the "get" accessor method for current private field.
    MethodBuilder currGetPropMthdBldr =
        typeBuilder.DefineMethod("get_value",
        GetSetAttr,
        type,
        Type.EmptyTypes);

    // Intermediate Language stuff...
    ILGenerator currGetIL = currGetPropMthdBldr.GetILGenerator();
    currGetIL.Emit(OpCodes.Ldarg_0);
    currGetIL.Emit(OpCodes.Ldfld, field);
    currGetIL.Emit(OpCodes.Ret);

    // Define the "set" accessor method for current private field.
    MethodBuilder currSetPropMthdBldr =
        typeBuilder.DefineMethod("set_value",
        GetSetAttr,
        null,
        new Type[] { type });

    // Again some Intermediate Language stuff...
    ILGenerator currSetIL = currSetPropMthdBldr.GetILGenerator();
    currSetIL.Emit(OpCodes.Ldarg_0);
    currSetIL.Emit(OpCodes.Ldarg_1);
    currSetIL.Emit(OpCodes.Stfld, field);
    currSetIL.Emit(OpCodes.Ret);

    // Last, we must map the two methods created above to our PropertyBuilder to
    // their corresponding behaviors, "get" and "set" respectively.
    property.SetGetMethod(currGetPropMthdBldr);
    property.SetSetMethod(currSetPropMthdBldr);
}

// Generate our type
Type generatedType = typeBuilder.CreateType(); 
```

最后，我们使用该类型创建它的实例并加载默认值，以便稍后使用 PropertiesGrid 显示它。

```
// Now we have our type. Let's create an instance from it:
object generatedObject = Activator.CreateInstance(generatedType);

// Loop over all the generated properties, and assign the default values
PropertyInfo[] properties = generatedType.GetProperties();
PropertyDescriptorCollection props = TypeDescriptor.GetProperties(generatedType);

for(int i = 0; i < properties.Length; i++)
{
    string field = properties[i].Name;

    DefaultValueAttribute dva = (DefaultValueAttribute)props[field].Attributes[typeof(DefaultValueAttribute)];

    object o = dva.Value;

    Type pType = properties[i].PropertyType;

    if(pType.IsEnum)
    {
        o = Enum.Parse(pType, o.ToString(), true);
    }
    else
    {
        o = Convert.ChangeType(o, pType);
    }

    properties[i].SetValue(generatedObject, o, null);
}

return generatedObject; 
```

但是，当我们尝试获取枚举的默认值时，这会导致错误。DefaultValueAttribute dva 未设置，因此当我们尝试使用它时会导致异常。

如果我们更改此代码段：

```
 if(type.IsEnum)
    {
        object o = Enum.Parse(type, val.ToString(), true);
        myCABuilder = new CustomAttributeBuilder(
            classCtorInfo,
            new object[] { o });
    } 
```

对此：

```
 if(type.IsEnum)
    {
        myCABuilder = new CustomAttributeBuilder(
            classCtorInfo,
            new object[] { 0 });
    } 
```

获取 DefaultValueAttribute dva 没有问题；但是，该字段随后在 PropertiesGrid 中以粗体显示，因为它与默认值不匹配。

当我将默认值设置为生成的枚举时，任何人都可以弄清楚为什么我无法获得 DefaultValueAttribute 吗？正如你可能猜到的，我对 Reflection 还是新手，所以这对我来说都是全新的。

谢谢。

更新：作为对 alabamasucks.blogspot 的回应，使用 ShouldSerialize 肯定会解决我的问题。我能够使用普通类创建方法；但是，我不确定如何为生成的类型执行此操作。据我所知，我需要使用 MethodBuilder 并生成 IL 来检查该字段是否等于默认值。听起来很简单。我想在 IL 代码中表示这一点：

```
public bool ShouldSerializepropertyName()
{
     return (field != val);
} 
```

我能够使用 ildasm.exe 从类似的代码中获取 IL 代码，但我有几个问题。如何在 IL 代码中使用 val 变量？在我的示例中，我使用了一个值为 0 的 int。

```
IL_0000:  ldc.i4.s   0
IL_0002:  stloc.0
IL_0003:  ldloc.0
IL_0004:  ldarg.0
IL_0005:  ldfld      int32 TestNamespace.TestClass::field
IL_000a:  ceq
IL_000c:  ldc.i4.0
IL_000d:  ceq
IL_000f:  stloc.1
IL_0010:  br.s       IL_0012
IL_0012:  ldloc.1
IL_0013:  ret 
```

这肯定会变得很棘手，因为 IL 对每种类型都有不同的加载命令。目前，我使用整数、双精度、字符串和枚举，因此代码必须根据类型进行自适应。

有谁知道如何做到这一点？还是我走错了方向？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T05:09:18.287

我不确定如何使该属性起作用，但还有另一种可能更容易的选择。

除了检查 DefaultValueAttribute，PropertyGrid 还使用反射来查找名为“ShouldSerializeProperty Name”的方法，其中 [Property Name] 是相关属性的名称。如果属性设置为非默认值，则此方法应返回一个布尔值，否则返回 false。您可能更容易使用反射来创建一个返回正确值的方法，然后修复属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T14:59:17.947

您应该尝试使用带 String 和 Type 参数的 DefaultValueAttribute，传入字符串枚举值 (val.ToString) 和枚举类型。

# c# - 是否有比嵌套“使用”更好的确定性处置模式？

> ID：75722
> 
> 赞同：20
> 
> 时间：2008-09-16T18:59:07.130
> 
> 标签：c#, c++, using, raii

在 C# 中，如果我想确定性地清理非托管资源，我可以使用“using”关键字。但是对于多个依赖对象，这最终会越来越嵌套：

```
using (FileStream fs = new FileStream("c:\file.txt", FileMode.Open))
{
    using (BufferedStream bs = new BufferedStream(fs))
    {
        using (StreamReader sr = new StreamReader(bs))
        {
            // use sr, and have everything cleaned up when done.
        }
    }
} 
```

在 C++ 中，我习惯于使用析构函数来做到这一点：

```
{    
    FileStream fs("c:\file.txt", FileMode.Open);
    BufferedStream bs(fs);
    StreamReader sr(bs);
    // use sr, and have everything cleaned up when done.
} 
```

在 C# 中有没有更好的方法来做到这一点？还是我坚持多层嵌套？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-16T19:01:51.180

您不必嵌套多个使用：

```
using (FileStream fs = new FileStream("c:\file.txt", FileMode.Open))
using (BufferedStream bs = new BufferedStream(fs))
using (StreamReader sr = new StreamReader(bs))
{
    // all three get disposed when you're done
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T19:02:29.230

您可以将 using 语句放在左大括号之前，如下所示：

```
 using (StreamWriter w1 = File.CreateText("W1"))
  using (StreamWriter w2 = File.CreateText("W2"))
  {
      // code here
  } 
```

[http://blogs.msdn.com/ericgu/archive/2004/08/05/209267.aspx](http://blogs.msdn.com/ericgu/archive/2004/08/05/209267.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T19:02:31.647

您可以使用此语法将内容压缩一下：

```
using (FileStream fs = new FileStream("c:\file.txt", FileMode.Open))
using (BufferedStream bs = new BufferedStream(fs))
using (StreamReader sr = new StreamReader(bs))
{
} 
```

恕我直言，这是对所有块不使用 { } 的罕见情况之一。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T19:01:41.417

您可以手动编写 .Dispose 调用，而不是嵌套 using 语句 - 但您几乎肯定会在某些时候错过一个。

运行 FxCop 或其他可以确保所有 IDisposable 实现类型实例都有 .Dispose() 调用的东西，或者处理嵌套。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T20:25:40.760

我之前已经实现了类似[Michael Meadows](https://stackoverflow.com/questions/75722/is-there-a-better-deterministic-disposal-pattern-than-nested-usings-in-c#75836)的解决方案，但是他的`StreamWrapper`代码没有考虑到如果在`Dispose()`成员变量上调用的方法由于某种原因引发异常，`Dispose()`则不会调用后续的 es 并且资源可能会悬空。更安全的工作方式是：

```
 var exceptions = new List<Exception>();

        try
        {
            this.sr.Dispose();
        }
        catch (Exception ex)
        {
            exceptions.Add(ex);
        }

        try
        {
            this.bs.Dispose();
        }
        catch (Exception ex)
        {
            exceptions.Add(ex);
        }

        try
        {
            this.fs.Dispose();
        }
        catch (Exception ex)
        {
            exceptions.Add(ex);
        }

        if (exceptions.Count > 0)
        {
            throw new AggregateException(exceptions);
        }
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T19:03:50.270

您可以省略花括号，例如：

```
using (FileStream fs = new FileStream("c:\file.txt", FileMode.Open))
using (BufferedStream bs = new BufferedStream(fs))
using (StreamReader sr = new StreamReader(bs))
{
        // use sr, and have everything cleaned up when done.
} 
```

或使用常规的 try finally 方法：

```
FileStream fs = new FileStream("c:\file.txt", FileMode.Open);
BufferedStream bs = new BufferedStream(fs);
StreamReader sr = new StreamReader(bs);
try
{
        // use sr, and have everything cleaned up when done.
}finally{
   sr.Close(); // should be enough since you hand control to the reader
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T19:08:55.190

这使得代码行数增加了很多，但在可读性方面有明显的提高：

```
using (StreamWrapper wrapper = new StreamWrapper("c:\file.txt", FileMode.Open))
{
    // do stuff using wrapper.Reader
} 
```

StreamWrapper 在这里定义的地方：

```
private class StreamWrapper : IDisposable
{
    private readonly FileStream fs;
    private readonly BufferedStream bs;
    private readonly StreamReader sr;

    public StreamWrapper(string fileName, FileMode mode)
    {
        fs = new FileStream(fileName, mode);
        bs = new BufferedStream(fs);
        sr = new StreamReader(bs);
    }

    public StreamReader Reader
    {
        get { return sr; }
    }

    public void Dispose()
    {
        sr.Dispose();
        bs.Dispose();
        fs.Dispose();
    }
} 
```

通过一些努力，可以将 StreamWrapper 重构为更通用和可重用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T23:32:15.023

应该注意的是，通常在基于另一个流创建流时，新流将关闭正在传入的流。因此，为了进一步减少您的示例：

```
using (Stream Reader sr = new StreamReader( new BufferedStream( new FileStream("c:\file.txt", FileMode.Open))))
{
    // all three get disposed when you're done
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-05-20T19:48:01.063

对于这个例子，让我们假设你有：

c:\ 下名为 1.xml 的文件

一个名为 textBox1 的文本框，其多行属性设置为 ON。

```
const string fname = @"c:\1.xml";

StreamReader sr=new StreamReader(new BufferedStream(new FileStream(fname,FileMode.Open,FileAccess.Read,FileShare.Delete)));
textBox1.Text = sr.ReadToEnd(); 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-16T19:01:13.850

using 语句是语法糖，可转换为：

```
 try
   {
      obj declaration
      ...
   }
   finally
   {
      obj.Dispose();
   } 
```

您可以在对象上显式调用 Dispose，但它不会那么安全，因为如果其中一个抛出异常，资源将不会被正确释放。

# html - 不在同一个元素上使用宽度和填充/边距？

> ID：75732
> 
> 赞同：5
> 
> 时间：2008-09-16T19:00:21.560
> 
> 标签：html, css

我看到很多人提到你不应该在与 CSS 相同的元素上使用宽度和填充或边距。这是为什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-16T19:02:04.847

因为一些浏览器将宽度视为元素的总宽度，包括填充和边距，而其他浏览器将宽度视为添加填充和边距的基本宽度。因此，您的设计在不同的浏览器中看起来会有所不同。

有关详细信息，请参阅[有关 Box Model](http://www.w3.org/TR/CSS2/box.html)和[quirksmode 的](http://www.quirksmode.org/css/box.html)W3C 页面。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T20:57:19.420

很多人仍然坚持认为 IE 中有缺陷的盒子模型，并认为如果你开始搞乱元素宽度、填充和边距，你就会遇到麻烦。

这是相当过时的建议——假设您使用[的是正确的 doctype](http://alistapart.com/articles/doctype/)，所有相当现代的浏览器（包括 IE6+）都将适用于相同的盒子模型，并且您不应该遇到太多与之相关的问题。

这是 CSS，你显然会遇到一百万*个其他*跨浏览器问题，但臭名昭著的 IE 框模型正在成为过去。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T19:05:02.140

我从来没有遇到过同时使用宽度、填充和/或边距引起的问题。

只要你有一个有效的 DOCTYPE 并且没有处于 Quirks 模式，你就会有一个可预测的盒子模型，因此应该使用最合适的边距/填充来表示你正在尝试做的事情。

注意：边距适用于边框之外，填充适用于边框内。宽度表示容器的内部宽度，总宽度=边距+边框+填充+宽度（记住前三个是为左右手边添加的）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T19:05:46.727

您是说填充和/或边距值不应与也分配有宽度值的 DOM 元素共存吗？如果是这样，那么只有当您不想编写与 IE 以及实现 Web 标准的浏览器（例如 Firefox）兼容的 CSS 时，才是正确的。如果没有一些边距或填充值，通常很难实现您正在寻找的布局。但我建议您编写兼容两种浏览器的 CSS。如果这不是您要问的，请纠正我:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T19:07:23.337

原因可能是著名的[盒子模型问题](http://en.wikipedia.org/wiki/Internet_Explorer_box_model_bug)。

摘要：如果填充和边距与宽度或高度一起使用， IE 呈现的*宽度与标准呈现不同。*

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T19:08:46.547

我能想到2个原因：

1) IE 的旧“盒子模型”真的很不稳定，所以当你有一个样式为 { width: 300px; 的元素时 内边距：30px；margin: 20px;} 它的轮廓实际上可能与预期的 400px 不匹配（300 px 大小，加上 2 30px 填充，加上 2 20 px 边距。我认为它的实际宽度将是 340，因为它会将填充滚动到宽度计算中.

这带来的是……

2）有些人发现计算有点混乱。

也就是说，我个人使用宽度以及填充和边距并且没有问题。如果您在使用填充/边距时限制自己不使用宽度，这意味着您在代码中添加了很多非语义垃圾。这确实意味着您必须了解各种浏览器将如何处理该元素，但这就是我们进行浏览器测试的原因。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T23:52:43.883

需要注意的重要一点是，它几乎不可能使用百分比宽度。举个例子，如果你想让你的“内容”div占据整个宽度，但有一个 10px 的填充：

```
#content {
    width: 100%;
    padding: 0 10px;
} 
```

这适用于（合理但不正确的）IE 模型，但在符合标准的浏览器中，您的 div 将占据 100% + 20px 的宽度，这是不好的。解决方案是使用另一个“内部”容器。

```
<div id="content">
    <div class="inner">
        content here.
    </div>
</div>

#content {
    width: 100%;
}
#content .inner {
    padding: 0 10px;
} 
```

有额外的标记有点烦人，但从长远来看，它会让很多事情变得更容易。

# c# - Nullable 条件运算符赋值 类型？

> ID：75746
> 
> 赞同：65
> 
> 时间：2008-09-16T19:01:27.610
> 
> 标签：c#, conditional-operator, nullable

```
EmployeeNumber =
string.IsNullOrEmpty(employeeNumberTextBox.Text)
    ? null
    : Convert.ToInt32(employeeNumberTextBox.Text), 
```

我经常发现自己想做这样的事情（因为它`EmployeeNumber`是`Nullable<int>`LINQ-to-SQL dbml 对象的属性，其中列允许 NULL 值）。不幸的是，编译器认为

> 'null' 和 'int' 之间没有隐式转换

即使这两种类型在对它们自己的可为空的 int 的赋值操作中都是有效的。

据我所知，使用空合并运算符不是一个选项，因为`.Text`如果字符串不为空，则需要在字符串上进行内联转换。

据我所知，这样做的唯一方法是使用 if 语句和/或分两步分配它。在这种特殊情况下，我发现这非常令人沮丧，因为我想使用对象初始化器语法，而这个赋值将在初始化块中......

有谁知道更优雅的解决方案？

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2008-09-16T19:08:05.970

出现问题是因为条件运算符不查看如何使用值（在这种情况下分配）来确定表达式的类型 - 只是真/假值。在这种情况下，您有 a`null`和 an `Int32`，并且无法确定类型（有真正的原因不能仅仅假设`Nullable<Int32>`）。

如果你真的想以这种方式使用它，你必须将其中一个值强制转换为`Nullable<Int32>`自己，以便 C# 可以解析类型：

```
EmployeeNumber =
    string.IsNullOrEmpty(employeeNumberTextBox.Text)
    ? (int?)null
    : Convert.ToInt32(employeeNumberTextBox.Text), 
```

或者

```
EmployeeNumber =
    string.IsNullOrEmpty(employeeNumberTextBox.Text)
    ? null
    : (int?)Convert.ToInt32(employeeNumberTextBox.Text), 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T19:20:49.920

我认为一种实用方法可以帮助使这个更清洁。

```
public static class Convert
{
    public static T? To<T>(string value, Converter<string, T> converter) where T: struct
    {
        return string.IsNullOrEmpty(value) ? null : (T?)converter(value);
    }
} 
```

然后

```
EmployeeNumber = Convert.To<int>(employeeNumberTextBox.Text, Int32.Parse); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-16T19:32:47.410

虽然亚历克斯为您的问题提供了正确和最接近的答案，但我更喜欢使用`TryParse`：

```
int value;
int? EmployeeNumber = int.TryParse(employeeNumberTextBox.Text, out value)
    ? (int?)value
    : null; 
```

它更安全，并且可以处理无效输入的情况以及您的空字符串情况。否则，如果用户输入类似的内容，`1b`他们将看到一个错误页面，其中包含`Convert.ToInt32(string)`.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T19:05:30.080

您可以转换 Convert 的输出：

```
EmployeeNumber = string.IsNullOrEmpty(employeeNumberTextBox.Text)
   ? null
   : (int?)Convert.ToInt32(employeeNumberTextBox.Text) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-04-24T15:31:30.957

```
//Some operation to populate Posid.I am not interested in zero or null
int? Posid = SvcClient.GetHolidayCount(xDateFrom.Value.Date,xDateTo.Value.Date).Response;
var x1 = (Posid.HasValue && Posid.Value > 0) ? (int?)Posid.Value : null; 
```

编辑：上面的简要说明，我试图在 varibale 中获取`Posid`（如果其非空`int`且值大于 0）的值`X1`。我不得不使用`(int?)`on`Posid.Value`来让条件运算符不抛出任何编译错误。仅供参考`GetHolidayCount`是一种`WCF`可以给出`null`或任何数字的方法。希望有帮助

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-07-04T10:22:33.540

从[C# 9.0](https://devblogs.microsoft.com/dotnet/welcome-to-c-9-0/#target-typed--and-)开始，这将最终成为可能：

> ### 目标打字？？和 ？：
> 
> 有时有条件？？和 ?: 表达式在分支之间没有明显的共享类型。这种情况今天失败了，但如果有两个分支都转换为的目标类型，C# 9.0 将允许它们：
> 
> ```
> Person person = student ?? customer; // Shared base type
> int? result = b ? 0 : null; // nullable value type 
> ```

这意味着问题中的代码块也将无错误地编译。

```
EmployeeNumber =
string.IsNullOrEmpty(employeeNumberTextBox.Text)
    ? null
    : Convert.ToInt32(employeeNumberTextBox.Text), 
```

# sharepoint - Sharepoint：使用“兼容”用户界面显示非 Sharepoint 内容列表的最佳方式？

> ID：75747
> 
> 赞同：1
> 
> 时间：2008-09-16T19:01:29.217
> 
> 标签：sharepoint, xslt, list, web-parts

我为 Sharepoint 构建了一个从外部服务检索数据的 Web 部件。我想以与 Sharepoint 的 UI 兼容的方式显示项目（适合其周围环境。）

我知道“DataFormWebPart”，但无法使其正常工作。它需要一个有效的数据源，而我无法从 Web 服务调用的结果中构建一个……部分问题是我的 Web 服务包装器没有公开 XML 返回信息，而是我有一堆反序列化的对象. 似乎没有一种简单的方法可以将实际对象转换为数据源，或者从对象数据填充“通用”数据源。

我可以使用 SPGridView 来获得相同的 UI，但是网格控件没有太多的智能方式 - 并且 - 它强制每个字段进入自己的列。我更愿意将每个列表项呈现为具有复杂渲染的单个单元格（例如 StackOverflow 显示其问题列表的方式。）我还希望获得尽可能多的 Sharepoint 标准 UI，例如排序、过滤和分页控件。

所以，首先：这里有没有人写过一个Sharepoint控件来做这个，如果有，你有示例代码可以分享吗？如果不是：我是否忽略了一些有用的控件，无论是 MS 提供的还是在外部库中可用？

谢谢！史蒂夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T03:24:02.190

> Sharepoint：使用“兼容”用户界面显示非 Sharepoint 内容列表的最佳方式？

看看内置的 sharepoint web 控件：

[Microsoft.SharePoint.WebControls 命名空间](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.webcontrols.aspx)

它包含 sharepoint 中使用的所有控件。我会告诉你更多，但文档非常详尽。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T20:56:43.230

SharePoint 的问题在于有很多不同的方法可以做到这一点。如果您的数据不经常更改并且不是太大，则可能值得考虑将其输入列表以进行显示。如果您拥有 Enterprise 许可证，则可能值得将您的数据放入 BDC 并在那里使用它。您可能必须将对象转换为 xml 或使用带有 XML Webpart 的序列化对象进行显示。这仍然存在使用 XSLT 进行自定义呈现的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T23:22:37.920

这是一篇很棒的文章，它解释了如何使用 BDC 定义编辑器配置 BDC 与 Web 服务的连接：

**使用业务数据目录定义编辑器创建 Web 服务连接** [http://msdn.microsoft.com/en-us/library/bb737887.aspx](http://msdn.microsoft.com/en-us/library/bb737887.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T03:07:55.693

执行此 IMO 的最佳方法是制作 Web 部件。作为 Web 部件，UI 将自动呈现为与站点使用的主题相同（除非您覆盖它），并且任何具有管理员权限的人都可以将其放置在任何地方。

*   [制作 Web 部件的教程](http://www.naspinski.net/post/WSS-30MOSS-2007-Web-Part-Tutorial.aspx)
*   [打包和部署 Web 部件的教程](http://naspinski.net/post/Packaging-and-Deploying-a-SharePoint-2007-Web-Part.aspx)
*   [示例 Web 部件源代码](http://naspinski.net/post/Free-SharePoint-2007-Web-Part-Time-Zones.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-12T11:26:35.137

您可以创建自定义 Web 部件并使用 SPGridView。您说您不喜欢它，因为它强制每个字段进入自己的列，但事实并非如此。您可以为每一列创建一个模板 (ITemplate) 并完全自定义其中显示的内容，就像使用普通的 ASP.Net GridView 一样。使用这种方法，我在列表项的标题旁边添加了小的“新”图像，就像 SharePoint 本身一样。

# mysql - 在 sql 结果中填充空日期的最直接方法是什么（在 mysql 或 perl 端）？

> ID：75752
> 
> 赞同：33
> 
> 时间：2008-09-16T19:01:43.100
> 
> 标签：mysql, perl, calendar, datediff

我正在从 mysql 表中构建一个快速 csv，其查询如下：

```
select DATE(date),count(date) from table group by DATE(date) order by date asc; 
```

并将它们转储到 perl 中的文件中：

```
while(my($date,$sum) = $sth->fetchrow) {
    print CSV "$date,$sum\n"
} 
```

但是，数据中存在日期差距：

```
| 2008-08-05 |           4 | 
| 2008-08-07 |          23 | 
```

我想用零计数条目填充数据以填充缺失的日期，最终得到：

```
| 2008-08-05 |           4 | 
| 2008-08-06 |           0 | 
| 2008-08-07 |          23 | 
```

我用每月几天的数组和一些数学计算了一个非常尴尬（而且几乎肯定有问题）的解决方法，但是在 mysql 或 perl 方面必须有更直接的方法。

为什么我这么愚蠢，有什么天才的想法/耳光吗？

* * *

我最终使用了一个存储过程，该过程为相关日期范围生成了一个临时表，原因如下：

*   我知道我每次都会寻找的日期范围
*   不幸的是，有问题的服务器不是我可以在 atm 上安装 perl 模块的服务器，而且它的状态已经足够陈旧，以至于它没有远程安装任何东西 Date::-y

perl 日期/日期时间迭代的答案也很好，我希望我可以选择多个答案！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-16T19:19:20.670

当您在服务器端需要类似的东西时，通常会创建一个包含两个时间点之间所有可能日期的表，然后将该表与查询结果左连接。像这样的东西：

```
create procedure sp1(d1 date, d2 date)
  declare d datetime;

  create temporary table foo (d date not null);

  set d = d1
  while d <= d2 do
    insert into foo (d) values (d)
    set d = date_add(d, interval 1 day)
  end while

  select foo.d, count(date)
  from foo left join table on foo.d = table.date
  group by foo.d order by foo.d asc;

  drop temporary table foo;
end procedure 
```

在这种特殊情况下，最好在客户端进行一些检查，如果当前日期不是 previos+1，则添加一些附加字符串。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-16T19:06:51.153

当我不得不处理这个问题时，为了填写缺失的日期，我实际上创建了一个参考表，其中只包含我感兴趣的所有日期，并在日期字段中加入了数据表。它很粗糙，但它有效。

```
SELECT DATE(r.date),count(d.date) 
FROM dates AS r 
LEFT JOIN table AS d ON d.date = r.date 
GROUP BY DATE(r.date) 
ORDER BY r.date ASC; 
```

至于输出，我只是使用[SELECT INTO OUTFILE](http://dev.mysql.com/doc/refman/5.0/en/select.html)而不是手动生成 CSV。让我们也不必担心转义特殊字符。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-16T19:11:47.227

不笨，这不是 MySQL 所做的，插入空日期值。我在 perl 中通过两步过程执行此操作。首先，将查询中的所有数据加载到按日期组织的哈希中。然后，我创建一个 Date::EzDate 对象并按天递增，所以...

```
my $current_date = Date::EzDate->new();
$current_date->{'default'} = '{YEAR}-{MONTH NUMBER BASE 1}-{DAY OF MONTH}';
while ($current_date <= $final_date)
{
    print "$current_date\t|\t%hash_o_data{$current_date}";  # EzDate provides for     automatic stringification in the format specfied in 'default'
    $current_date++;
} 
```

其中最终日期是另一个 EzDate 对象或包含日期范围结束的字符串。

EzDate 现在不在 CPAN 上，但您可能会找到另一个 perl mod 来进行日期比较并提供日期增量器。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-16T19:37:10.283

您可以使用[DateTime](http://search.cpan.org/perldoc?DateTime)对象：

```
use DateTime;
my $dt;

while ( my ($date, $sum) = $sth->fetchrow )  {
    if (defined $dt) {
        print CSV $dt->ymd . ",0\n" while $dt->add(days => 1)->ymd lt $date;
    }
    else {
        my ($y, $m, $d) = split /-/, $date;
        $dt = DateTime->new(year => $y, month => $m, day => $d);
    }
    print CSV, "$date,$sum\n";
} 
```

上面的代码所做的是将最后打印的日期保存在一个 `DateTime`对象`$dt`中，并且当当前日期超过未来一天时，它会增加`$dt`一天（并将其打印一行 `CSV`）直到它与当前日期。

这样您就不需要额外的表格，也不需要提前获取所有行。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-05-01T12:23:52.797

我希望你能弄清楚其余的。

```
select  * from (
select date_add('2003-01-01 00:00:00.000', INTERVAL n5.num*10000+n4.num*1000+n3.num*100+n2.num*10+n1.num DAY ) as date from
(select 0 as num
   union all select 1
   union all select 2
   union all select 3
   union all select 4
   union all select 5
   union all select 6
   union all select 7
   union all select 8
   union all select 9) n1,
(select 0 as num
   union all select 1
   union all select 2
   union all select 3
   union all select 4
   union all select 5
   union all select 6
   union all select 7
   union all select 8
   union all select 9) n2,
(select 0 as num
   union all select 1
   union all select 2
   union all select 3
   union all select 4
   union all select 5
   union all select 6
   union all select 7
   union all select 8
   union all select 9) n3,
(select 0 as num
   union all select 1
   union all select 2
   union all select 3
   union all select 4
   union all select 5
   union all select 6
   union all select 7
   union all select 8
   union all select 9) n4,
(select 0 as num
   union all select 1
   union all select 2
   union all select 3
   union all select 4
   union all select 5
   union all select 6
   union all select 7
   union all select 8
   union all select 9) n5
) a
where date >'2011-01-02 00:00:00.000' and date < NOW()
order by date 
```

和

```
select n3.num*100+n2.num*10+n1.num as date 
```

你会得到一列数字从 0 到 max(n3)*100+max(n2)*10+max(n1)

由于这里我们将 max n3 设为 3，因此 SELECT 将返回 399，加上 0 -> 400 条记录（日历中的日期）。

您可以通过限制来调整您的动态日历，例如，从您必须的 min(date) 到 now()。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T19:43:41.423

由于您不知道差距在哪里，但是您想要从列表中的第一个日期到最后一个日期的所有值（大概），请执行以下操作：

```
use DateTime;
use DateTime::Format::Strptime;
my @row = $sth->fetchrow;
my $countdate = strptime("%Y-%m-%d", $firstrow[0]);
my $thisdate = strptime("%Y-%m-%d", $firstrow[0]);

while ($countdate) {
  # keep looping countdate until it hits the next db row date
  if(DateTime->compare($countdate, $thisdate) == -1) {
    # counter not reached next date yet
    print CSV $countdate->ymd . ",0\n";
    $countdate = $countdate->add( days => 1 );
    $next;
  }

  # countdate is equal to next row's date, so print that instead
  print CSV $thisdate->ymd . ",$row[1]\n";

  # increase both
  @row = $sth->fetchrow;
  $thisdate = strptime("%Y-%m-%d", $firstrow[0]);
  $countdate = $countdate->add( days => 1 );
} 
```

嗯，结果比我想象的要复杂..我希望这是有道理的！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-05-27T17:57:50.573

我认为该问题最简单的通用解决方案是创建一个`Ordinal`具有您需要的最多行数的表（在您的情况下为 31*3 = 93）。

```
CREATE TABLE IF NOT EXISTS `Ordinal` (
  `n` int(10) unsigned NOT NULL AUTO_INCREMENT, PRIMARY KEY (`n`)
);
INSERT INTO `Ordinal` (`n`)
VALUES (NULL), (NULL), (NULL); #etc 
```

接下来，对您的数据执行`LEFT JOIN`from 。`Ordinal`这是一个简单的案例，上周的每一天：

```
SELECT CURDATE() - INTERVAL `n` DAY AS `day`
FROM `Ordinal` WHERE `n` <= 7
ORDER BY `n` ASC 
```

你需要改变的两件事是起点和间隔。为了清楚起见，我使用`SET @var = 'value'`了语法。

```
SET @end = CURDATE() - INTERVAL DAY(CURDATE()) DAY;
SET @begin = @end - INTERVAL 3 MONTH;
SET @period = DATEDIFF(@end, @begin);

SELECT @begin + INTERVAL (`n` + 1) DAY AS `date`
FROM `Ordinal` WHERE `n` < @period
ORDER BY `n` ASC; 
```

因此，如果您要加入以获取过去三个月每天的消息数量，最终代码将如下所示：

```
SELECT COUNT(`msg`.`id`) AS `message_count`, `ord`.`date` FROM (
    SELECT ((CURDATE() - INTERVAL DAY(CURDATE()) DAY) - INTERVAL 3 MONTH) + INTERVAL (`n` + 1) DAY AS `date`
    FROM `Ordinal`
    WHERE `n` < (DATEDIFF((CURDATE() - INTERVAL DAY(CURDATE()) DAY), ((CURDATE() - INTERVAL DAY(CURDATE()) DAY) - INTERVAL 3 MONTH)))
    ORDER BY `n` ASC
) AS `ord`
LEFT JOIN `Message` AS `msg`
  ON `ord`.`date` = `msg`.`date`
GROUP BY `ord`.`date` 
```

提示和评论：

*   查询中最难的部分可能是确定限制时使用的天数`Ordinal`。相比之下，将整数序列转换为日期很容易。
*   您`Ordinal`可以满足所有不间断序列的需求。只要确保它包含比最长序列更多的行。
*   您可以对多个序列使用多个查询`Ordinal`，例如列出过去七 (1-7) 周的每个工作日 (1-5)。
*   您可以通过在`Ordinal`表格中存储日期来加快速度，但灵活性会降低。这样`Ordinal`，无论您使用多少次，您都只需要一张桌子。不过，如果速度值得，请尝试`INSERT INTO ... SELECT`语法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T19:15:06.093

使用一些 Perl 模块进行日期计算，例如推荐的 DateTime 或 Time::Piece（来自 5.10 的核心）。只需增加日期和打印日期，0 到日期将与当前日期匹配。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-16T19:08:57.590

我不知道这是否可行，但是如果您创建一个包含所有可能日期的新表怎么样（如果日期范围会发生不可预测的变化，这可能是这个想法的问题......）和然后在两个表上做一个左连接？如果有大量可能的日期，或者无法预测第一个和最后一个日期，我想这是一个疯狂的解决方案，但如果日期范围是固定的或易于计算，那么这可能会奏效。

# ruby - 如何在 Ruby 中实现枚举？

> ID：75759
> 
> 赞同：348
> 
> 时间：2008-09-16T19:02:09.073
> 
> 标签：ruby, enums

在 Ruby 中实现枚举习惯用法的最佳方法是什么？我正在寻找可以（几乎）使用的东西，例如 Java/C# 枚举。

* * *

## 回答 #1

> 赞同：347
> 
> 时间：2008-09-16T19:32:30.110

两种方式。符号（`:foo`符号）或常数（`FOO`符号）。

当您想增强可读性而不用文字字符串乱扔代码时，符号是合适的。

```
postal_code[:minnesota] = "MN"
postal_code[:new_york] = "NY" 
```

当你有一个重要的基础值时，常量是合适的。只需声明一个模块来保存您的常量，然后在其中声明常量。

```
module Foo
  BAR = 1
  BAZ = 2
  BIZ = 4
end

flags = Foo::BAR | Foo::BAZ # flags = 3 
```

添加于 2021-01-17

如果您正在传递枚举值（例如，将其存储在数据库中）并且您需要能够将值转换回符号，那么这两种方法都是混搭的

```
COMMODITY_TYPE = {
  currency: 1,
  investment: 2,
}

def commodity_type_string(value)
  COMMODITY_TYPE.key(value)
end

COMMODITY_TYPE[:currency] 
```

这种方法的灵感来自 andrew-grimm 的回答[https://stackoverflow.com/a/5332950/13468](https://stackoverflow.com/a/5332950/13468)

我还建议通读此处的其余答案，因为有很多方法可以解决此问题，并且归结为您关心的其他语言枚举的含义

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2011-05-29T21:19:58.597

我很惊讶没有人提供类似以下的东西（从[RAPI](https://github.com/cstrahan/rapi/blob/master/lib/rapi.rb) gem 中获取）：

```
class Enum

  private

  def self.enum_attr(name, num)
    name = name.to_s

    define_method(name + '?') do
      @attrs & num != 0
    end

    define_method(name + '=') do |set|
      if set
        @attrs |= num
      else
        @attrs &= ~num
      end
    end
  end

  public

  def initialize(attrs = 0)
    @attrs = attrs
  end

  def to_i
    @attrs
  end
end 
```

可以这样使用：

```
class FileAttributes < Enum
  enum_attr :readonly,       0x0001
  enum_attr :hidden,         0x0002
  enum_attr :system,         0x0004
  enum_attr :directory,      0x0010
  enum_attr :archive,        0x0020
  enum_attr :in_rom,         0x0040
  enum_attr :normal,         0x0080
  enum_attr :temporary,      0x0100
  enum_attr :sparse,         0x0200
  enum_attr :reparse_point,  0x0400
  enum_attr :compressed,     0x0800
  enum_attr :rom_module,     0x2000
end 
```

例子：

```
>> example = FileAttributes.new(3)
=> #<FileAttributes:0x629d90 @attrs=3>
>> example.readonly?
=> true
>> example.hidden?
=> true
>> example.system?
=> false
>> example.system = true
=> true
>> example.system?
=> true
>> example.to_i
=> 7 
```

这在数据库场景中或在处理 C 风格的常量/枚举时（如使用RAPI 广泛使用的[FFI时就是这种情况）效果很好。](https://github.com/ffi/ffi/)

此外，您不必担心拼写错误会导致静默失败，就像使用哈希类型解决方案一样。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2008-09-16T19:06:04.790

最惯用的方法是使用符号。例如，而不是：

```
enum {
  FOO,
  BAR,
  BAZ
}

myFunc(FOO); 
```

...您可以只使用符号：

```
# You don't actually need to declare these, of course--this is
# just to show you what symbols look like.
:foo
:bar
:baz

my_func(:foo) 
```

这比枚举更开放，但它非常符合 Ruby 精神。

符号也表现得很好。例如，比较两个符号是否相等比比较两个字符串要快得多。

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2011-04-15T10:46:46.657

我使用以下方法：

```
class MyClass
  MY_ENUM = [MY_VALUE_1 = 'value1', MY_VALUE_2 = 'value2']
end 
```

我喜欢它有以下优点：

1.  它在视觉上将值组合为一个整体
2.  它会进行一些编译时检查（与仅使用符号相反）
3.  我可以轻松访问所有可能值的列表：只需`MY_ENUM`
4.  我可以轻松访问不同的值：`MY_VALUE_1`
5.  它可以有任何类型的值，而不仅仅是 Symbol

符号可能会更好，因为您不必写外部类的名称，如果您在另一个类中使用它（`MyClass::MY_VALUE_1`）

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2014-12-08T00:04:22.303

如果您使用的是 Rails 4.2 或更高版本，则可以使用 Rails 枚举。

Rails 现在默认有枚举，而不需要包含任何 gem。

这与 Java、C++ 枚举非常相似（并且具有更多功能）。

引自[http://edgeapi.rubyonrails.org/classes/ActiveRecord/Enum.html](http://edgeapi.rubyonrails.org/classes/ActiveRecord/Enum.html)：

```
class Conversation < ActiveRecord::Base
  enum status: [ :active, :archived ]
end

# conversation.update! status: 0
conversation.active!
conversation.active? # => true
conversation.status  # => "active"

# conversation.update! status: 1
conversation.archived!
conversation.archived? # => true
conversation.status    # => "archived"

# conversation.update! status: 1
conversation.status = "archived"

# conversation.update! status: nil
conversation.status = nil
conversation.status.nil? # => true
conversation.status      # => nil 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-12-07T13:46:41.670

我知道这家伙发布这个问题已经很久了，但我有同样的问题，而这篇文章没有给我答案。我想要一种简单的方法来查看数字代表什么，轻松比较，最重要的是 ActiveRecord 支持使用表示枚举的列进行查找。

我什么也没找到，所以我做了一个很棒的实现，叫做[yinum](https://github.com/toplex/enum)，它允许我寻找任何东西。做了很多规格，所以我很确定它是安全的。

一些示例功能：

```
COLORS = Enum.new(:COLORS, :red => 1, :green => 2, :blue => 3)
=> COLORS(:red => 1, :green => 2, :blue => 3)
COLORS.red == 1 && COLORS.red == :red
=> true

class Car < ActiveRecord::Base    
  attr_enum :color, :COLORS, :red => 1, :black => 2
end
car = Car.new
car.color = :red / "red" / 1 / "1"
car.color
=> Car::COLORS.red
car.color.black?
=> false
Car.red.to_sql
=> "SELECT `cars`.* FROM `cars` WHERE `cars`.`color` = 1"
Car.last.red?
=> true 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2011-03-16T21:46:48.707

查看 ruby​​-enum gem，[https://github.com/dblock/ruby-enum](https://github.com/dblock/ruby-enum)。

```
class Gender
  include Enum

  Gender.define :MALE, "male"
  Gender.define :FEMALE, "female"
end

Gender.all
Gender::MALE 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2012-07-12T15:48:35.760

这是我在 Ruby 中使用枚举的方法。我追求的是简短而甜蜜的，不一定是最像 C 的。有什么想法吗？

```
module Kernel
  def enum(values)
    Module.new do |mod|
      values.each_with_index{ |v,i| mod.const_set(v.to_s.capitalize, 2**i) }

      def mod.inspect
        "#{self.name} {#{self.constants.join(', ')}}"
      end
    end
  end
end

States = enum %w(Draft Published Trashed)
=> States {Draft, Published, Trashed} 

States::Draft
=> 1

States::Published
=> 2

States::Trashed
=> 4

States::Draft | States::Trashed
=> 5 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2014-12-19T21:50:52.597

也许最好的轻量级方法是

```
module MyConstants
  ABC = Class.new
  DEF = Class.new
  GHI = Class.new
end 
```

这种方式值具有关联的名称，如在 Java/C# 中：

```
MyConstants::ABC
=> MyConstants::ABC 
```

要获取所有值，您可以执行

```
MyConstants.constants
=> [:ABC, :DEF, :GHI] 
```

如果你想要一个枚举的序数值，你可以做

```
MyConstants.constants.index :GHI
=> 2 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2011-03-16T23:14:48.757

如果您担心符号的拼写错误，请确保您的代码在您使用不存在的键访问值时引发异常。您可以通过使用`fetch`而不是`[]`：

```
my_value = my_hash.fetch(:key) 
```

或者如果您提供不存在的密钥，则默认情况下使哈希引发异常：

```
my_hash = Hash.new do |hash, key|
  raise "You tried to access using #{key.inspect} when the only keys we have are #{hash.keys.inspect}"
end 
```

如果哈希已经存在，您可以添加异常引发行为：

```
my_hash = Hash[[[1,2]]]
my_hash.default_proc = proc do |hash, key|
  raise "You tried to access using #{key.inspect} when the only keys we have are #{hash.keys.inspect}"
end 
```

通常，您不必担心常量的错字安全。如果你拼错了一个常量名，它通常会引发一个异常。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-16T20:35:24.310

这完全取决于您如何使用 Java 或 C# 枚举。你如何使用它将决定你在 Ruby 中选择的解决方案。

尝试原生`Set`类型，例如：

```
>> enum = Set['a', 'b', 'c']
=> #<Set: {"a", "b", "c"}>
>> enum.member? "b"
=> true
>> enum.member? "d"
=> false
>> enum.add? "b"
=> nil
>> enum.add? "d"
=> #<Set: {"a", "b", "c", "d"}> 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-03-04T20:47:49.597

有人继续写了一个名为[Renum](http://renum.rubyforge.org/)的红宝石。它声称可以获得最接近 Java/C# 的行为。就我个人而言，我还在学习 Ruby，当我想让一个特定的类包含一个静态枚举（可能是一个哈希）时，我有点震惊，而这并不是很容易通过 google 找到的。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2015-12-28T17:53:47.860

最近我们发布了一个在 Ruby中实现**Enums的**[gem](https://github.com/mezuka/enum)。在我[的帖子](http://railsguides.net/safe-enums-in-ruby/)中，您将找到问题的答案。我还在那里描述了为什么我们的实现比现有的更好（实际上在 Ruby 中这个特性有很多实现作为 gems）。

 *** * *

## 回答 #14

> 赞同：4
> 
> 时间：2017-07-14T07:58:12.393

另一种解决方案是使用 OpenStruct。它非常直接和干净。

[https://ruby-doc.org/stdlib-2.3.1/libdoc/ostruct/rdoc/OpenStruct.html](https://ruby-doc.org/stdlib-2.3.1/libdoc/ostruct/rdoc/OpenStruct.html)

例子：

```
# bar.rb
require 'ostruct' # not needed when using Rails

# by patching Array you have a simple way of creating a ENUM-style
class Array
   def to_enum(base=0)
      OpenStruct.new(map.with_index(base).to_h)
   end
end

class Bar

    MY_ENUM = OpenStruct.new(ONE: 1, TWO: 2, THREE: 3)
    MY_ENUM2 = %w[ONE TWO THREE].to_enum

    def use_enum (value)
        case value
        when MY_ENUM.ONE
            puts "Hello, this is ENUM 1"
        when MY_ENUM.TWO
            puts "Hello, this is ENUM 2"
        when MY_ENUM.THREE
            puts "Hello, this is ENUM 3"
        else
            puts "#{value} not found in ENUM"
        end
    end

end

# usage
foo = Bar.new    
foo.use_enum 1
foo.use_enum 2
foo.use_enum 9

# put this code in a file 'bar.rb', start IRB and type: load 'bar.rb' 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-10-02T20:47:41.460

符号是红宝石的方式。但是，有时需要与一些 C 代码或其他东西或 Java 交谈，这些代码为各种事物公开了一些枚举。

* * *

```
#server_roles.rb
module EnumLike

  def EnumLike.server_role
    server_Symb=[ :SERVER_CLOUD, :SERVER_DESKTOP, :SERVER_WORKSTATION]
    server_Enum=Hash.new
    i=0
    server_Symb.each{ |e| server_Enum[e]=i; i +=1}
    return server_Symb,server_Enum
  end

end 
```

* * *

然后可以这样使用

* * *

```
require 'server_roles'

sSymb, sEnum =EnumLike.server_role()

foreignvec[sEnum[:SERVER_WORKSTATION]]=8 
```

* * *

这当然可以抽象化，您可以滚动我们自己的 Enum 类

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2012-02-28T13:38:05.410

我已经实现了这样的枚举

```
module EnumType

  def self.find_by_id id
    if id.instance_of? String
      id = id.to_i
    end 
    values.each do |type|
      if id == type.id
        return type
      end
    end
    nil
  end

  def self.values
    [@ENUM_1, @ENUM_2] 
  end

  class Enum
    attr_reader :id, :label

    def initialize id, label
      @id = id
      @label = label
    end
  end

  @ENUM_1 = Enum.new(1, "first")
  @ENUM_2 = Enum.new(2, "second")

end 
```

然后它很容易做操作

```
EnumType.ENUM_1.label 
```

...

```
enum = EnumType.find_by_id 1 
```

...

```
valueArray = EnumType.values 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2012-07-11T12:29:01.167

```
module Status
  BAD  = 13
  GOOD = 24

  def self.to_str(status)
    for sym in self.constants
      if self.const_get(sym) == status
        return sym.to_s
      end
    end
  end

end

mystatus = Status::GOOD

puts Status::to_str(mystatus) 
```

输出：

```
GOOD 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2013-04-16T20:09:44.973

这似乎有点多余，但这是我使用过几次的方法，尤其是在我与 xml 或类似的集成的地方。

```
#model
class Profession
  def self.pro_enum
    {:BAKER => 0, 
     :MANAGER => 1, 
     :FIREMAN => 2, 
     :DEV => 3, 
     :VAL => ["BAKER", "MANAGER", "FIREMAN", "DEV"]
    }
  end
end

Profession.pro_enum[:DEV]      #=>3
Profession.pro_enum[:VAL][1]   #=>MANAGER 
```

这给了我 ac# 枚举的严谨性，并且它与模型相关联。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-16T19:04:45.887

大多数人使用符号（这是`:foo_bar`语法）。它们是一种独特的不透明值。符号不属于任何枚举风格的类型，因此它们并不是 C 枚举类型的真正忠实表示，但这几乎与它得到的一样好。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-03-06T11:38:10.390

```
irb(main):016:0> num=[1,2,3,4]
irb(main):017:0> alph=['a','b','c','d']
irb(main):018:0> l_enum=alph.to_enum
irb(main):019:0> s_enum=num.to_enum
irb(main):020:0> loop do
irb(main):021:1* puts "#{s_enum.next} - #{l_enum.next}"
irb(main):022:1> end 
```

输出：

1 - a
2 - b
3 - c
4 - d

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2015-08-21T21:54:19.370

有时我只需要能够获取枚举的值并识别它的名称，类似于 java world。

```
module Enum
     def get_value(str)
       const_get(str)
     end
     def get_name(sym)
       sym.to_s.upcase
     end
 end

 class Fruits
   include Enum
   APPLE = "Delicious"
   MANGO = "Sweet"
 end

 Fruits.get_value('APPLE') #'Delicious'
 Fruits.get_value('MANGO') # 'Sweet'

 Fruits.get_name(:apple) # 'APPLE'
 Fruits.get_name(:mango) # 'MANGO' 
```

对我来说，这符合枚举的目的，并且也保持了它的可扩展性。您可以向 Enum 类添加更多方法，viola 在所有已定义的枚举中免费获取它们。例如。get_all_names 之类的东西。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-01-11T04:47:02.487

试试inum。 [https://github.com/alfa-jpn/inum](https://github.com/alfa-jpn/inum)

```
class Color < Inum::Base
  define :RED
  define :GREEN
  define :BLUE
end 
```

```
Color::RED 
Color.parse('blue') # => Color::BLUE
Color.parse(2)      # => Color::GREEN 
```

查看更多[https://github.com/alfa-jpn/inum#usage](https://github.com/alfa-jpn/inum#usage)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-09-29T18:07:32.430

另一种方法是使用包含名称和值的哈希的 Ruby 类，如以下[RubyFleebie 博客文章](http://www.rubyfleebie.com/enumerations-and-ruby/)中所述。这使您可以轻松地在值和常量之间进行转换（特别是如果您添加一个类方法来查找给定值的名称）。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2010-04-03T23:57:49.383

我认为实现类型枚举的最佳方法是使用符号，因为它几乎表现为整数（在性能方面，object_id 用于进行比较）；您无需担心索引，它们在您的代码中看起来非常整洁 xD

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2012-12-30T01:44:43.050

另一种模仿具有一致平等处理的枚举的方法（从 Dave Thomas 无耻地采用）。允许开放枚举（很像符号）和封闭（预定义）枚举。

```
class Enum
  def self.new(values = nil)
    enum = Class.new do
      unless values
        def self.const_missing(name)
          const_set(name, new(name))
        end
      end

      def initialize(name)
        @enum_name = name
      end

      def to_s
        "#{self.class}::#@enum_name"
      end
    end

    if values
      enum.instance_eval do
        values.each { |e| const_set(e, enum.new(e)) }
      end
    end

    enum
  end
end

Genre = Enum.new %w(Gothic Metal) # creates closed enum
Architecture = Enum.new           # creates open enum

Genre::Gothic == Genre::Gothic        # => true
Genre::Gothic != Architecture::Gothic # => true 
```

# visual-studio - 如何调试在另一个进程 (2.exe) 下运行的进程 (1.exe)？

> ID：75763
> 
> 赞同：3
> 
> 时间：2008-09-16T19:02:30.803
> 
> 标签：visual-studio, debugging

1.exe 没有给我足够的时间来启动 IDE 并将 1.exe 附加到调试器以闯入。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T19:07:34.053

在这种情况下，我建议采用与 NT 服务相同的方法。它们也会启动，但通常不会给您足够的时间来为启动例程附加调试器。

此处描述了详细信息：http: [//www.debuginfo.com/articles/debugstartup.html](http://www.debuginfo.com/articles/debugstartup.html)

简而言之，您为第二个 exe 添加了一个注册表项：

> HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\2.exe 调试器 = "c:\progs\msvs\common7\ide\devenv.exe /debugexe" (REG_SZ)

更改 c:\progrs\msms\ 以匹配您的设置。

希望有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T19:12:57.533

如果您愿意考虑使用 Visual Studio 以外的调试器，[WinDBG](http://www.microsoft.com/whdc/devtools/debugging/install64bit.mspx)可以自动调试子进程（仅限本机代码）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:07:34.923

你没有提到你使用的是什么语言。但是，如果您使用 C# 或 VB.NET，您可以添加 Debug.Break() 或 Stop 来触发将调试器附加到进程的提示。

或者如上所述，只需使用 Console.Readline() 或 MessageBox.Show() 之类的东西来暂停进程的启动，直到您可以将调试器附加到它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T19:05:53.667

我假设你有 1.exe 的源代码（如果你正在调试它），然后只需在开头附近插入一个语句，这将导致它挂起足够长的时间来附加调试器。（ getch() 如果你很绝望并且它不是交互式的。）

附加后，只需跳到下一条语句并放开它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T19:06:12.433

您可以为调试构建放入一些预处理器命令 - 只需记住在发布模式下构建您的发行版：

```
#ifdef DEBUG
Thread.Sleep(10000);
#endif 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T19:10:23.297

1.exe是如何启动的？如果可以使用 CreateProcess() 启动它，则可以在挂起状态下启动进程，附加调试器，然后释放新进程。

# c# - .NET Control.Margin 属性有什么用？

> ID：75777
> 
> 赞同：11
> 
> 时间：2008-09-16T19:03:49.647
> 
> 标签：c#, controls, margin

我假设 C# 边距属性的含义类似于 CSS - 控件外部的间距。但无论我输入什么值，边距值似乎都被忽略了。

然后我在 SDK 上阅读：

> 在停靠控件上设置 Margin 属性不会影响控件与其容器边缘的距离。

鉴于我在窗体上放置控件，并且可能将它们停靠，Margin 属性给我带来了什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-16T19:17:45.307

就像 Philip Rieck 所说，margin 属性只被执行布局的容器控件所尊重。这是一个示例，可以清楚地说明如何`TableLayoutPanel`尊重 Margin 属性：

```
using System.Drawing;
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();

            TableLayoutPanel pnl = new TableLayoutPanel();
            pnl.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 50));
            pnl.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 50));
            pnl.Dock = DockStyle.Fill;
            this.Controls.Add(pnl);

            Button btn1 = new Button();
            btn1.Text = "No margin";
            btn1.Dock = DockStyle.Fill;

            Button btn2 = new Button();
            btn2.Margin = new Padding(25);
            btn2.Text = "Margin";
            btn2.Dock = DockStyle.Fill;

            pnl.Controls.Add(btn1, 0, 0);
            pnl.Controls.Add(btn2, 1, 0);
        }
    }
}
```

我相信唯一尊重此属性的 .NET 2.0 内置控件是`FlowLayoutPanel`and `TableLayoutPanel`; 希望第三方组件也能尊重它。其他场景基本没有影响。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-16T19:10:11.783

无论您的控制主机（例如，面板）正在使用什么布局引擎，无论布局引擎认为合适的方式，都可以使用边距属性。但是，正如您所假设的那样，它最适合用于间距。只需阅读该特定布局引擎的文档即可。

例如，在使用 FlowLayoutPanel 或 TableLayoutPanel 时，它可以非常方便 - 减少默认填充或空间一些东西。显然，如果您编写自定义布局提供程序，则可以使用您认为合适的 Margin。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-11-30T08:42:24.547

如果您不使用布局容器，而是手动放置控件，Control.Margin 属性在设计时也很有用。

[它会影响对齐线出现](https://stackoverflow.com/questions/1376622/change-spacing-of-snaplines-in-visual-studio#answer-15649647)的手动拖动控件之间的距离。

例如，对于文本框的默认边距值 3，您将拥有以下对齐线：

[![在此处输入图像描述](https://i.stack.imgur.com/HR89v.png)](https://i.stack.imgur.com/HR89v.png)

对于 10 的边距 - 这些（标签在两种情况下的边距均为 3）：

[![在此处输入图像描述](https://i.stack.imgur.com/rlKfs.png)](https://i.stack.imgur.com/rlKfs.png)

因此，如果您对 UI 有一些严格的指导方针，那么您只需根据需要设置边距并将控件拖动到对齐线。

# c# - 您如何在 WPF 中进行 AppBar 对接（到屏幕边缘，如 WinAmp）？

> ID：75785
> 
> 赞同：61
> 
> 时间：2008-09-16T19:04:39.210
> 
> 标签：c#, wpf, dock, docking, appbar

是否有关于在 WPF 中进行 AppBar 对接（例如锁定到屏幕边缘）的完整指南？我知道需要进行 InterOp 调用，但我正在寻找基于简单 WPF 表单的概念证明或可以使用的组件化版本。

相关资源：

*   [http://www.codeproject.com/KB/dotnet/AppBar.aspx](http://www.codeproject.com/KB/dotnet/AppBar.aspx)
*   [http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/05c73c9c-e85d-4ecd-b9b6-4c714a65e72b/](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/05c73c9c-e85d-4ecd-b9b6-4c714a65e72b/)

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2008-09-17T16:23:06.967

**请注意：**这个问题收集了大量的反馈，下面的一些人提出了很好的观点或修复。因此，虽然我将代码保留在这里（并可能更新它），但我还在**[github 上](https://github.com/PhilipRieck/WpfAppBar)****创建了一个**WpfAppBar 项目。随时发送拉取请求。

同一个项目也构建到[WpfAppBar nuget 包](https://www.nuget.org/packages/WpfAppBar/)

* * *

我从问题中提供的第一个链接（[http://www.codeproject.com/KB/dotnet/AppBar.aspx](http://www.codeproject.com/KB/dotnet/AppBar.aspx)）中获取了代码，并对其进行了修改以做两件事：

1.  使用 WPF
2.  成为“独立” - 如果您将这个单个文件放在您的项目中，您可以调用 AppBarFunctions.SetAppBar(...) 而不需要对窗口进行任何进一步的修改。

这种方法不会创建基类。

要使用，只需从普通 wpf 窗口中的任何位置调用此代码（例如单击按钮或初始化）。请注意，在窗口初始化之前，您不能调用它，如果尚未创建 HWND（如在构造函数中），则会发生错误。

使窗口成为应用栏：

```
AppBarFunctions.SetAppBar( this, ABEdge.Right ); 
```

将窗口恢复为普通窗口：

```
AppBarFunctions.SetAppBar( this, ABEdge.None ); 
```

这是文件的完整代码 -**请注意**，您需要将第 7 行的命名空间更改为适当的名称。

```
using System;
using System.Collections.Generic;
using System.Runtime.InteropServices;
using System.Windows;
using System.Windows.Interop;
using System.Windows.Threading;

namespace AppBarApplication
{    
    public enum ABEdge : int
    {
        Left = 0,
        Top,
        Right,
        Bottom,
        None
    }

    internal static class AppBarFunctions
    {
        [StructLayout(LayoutKind.Sequential)]
        private struct RECT
        {
            public int left;
            public int top;
            public int right;
            public int bottom;
        }

        [StructLayout(LayoutKind.Sequential)]
        private struct APPBARDATA
        {
            public int cbSize;
            public IntPtr hWnd;
            public int uCallbackMessage;
            public int uEdge;
            public RECT rc;
            public IntPtr lParam;
        }

        private enum ABMsg : int
        {
            ABM_NEW = 0,
            ABM_REMOVE,
            ABM_QUERYPOS,
            ABM_SETPOS,
            ABM_GETSTATE,
            ABM_GETTASKBARPOS,
            ABM_ACTIVATE,
            ABM_GETAUTOHIDEBAR,
            ABM_SETAUTOHIDEBAR,
            ABM_WINDOWPOSCHANGED,
            ABM_SETSTATE
        }
        private enum ABNotify : int
        {
            ABN_STATECHANGE = 0,
            ABN_POSCHANGED,
            ABN_FULLSCREENAPP,
            ABN_WINDOWARRANGE
        }

        [DllImport("SHELL32", CallingConvention = CallingConvention.StdCall)]
        private static extern uint SHAppBarMessage(int dwMessage, ref APPBARDATA pData);

        [DllImport("User32.dll", CharSet = CharSet.Auto)]
        private static extern int RegisterWindowMessage(string msg);

        private class RegisterInfo
        {
            public int CallbackId { get; set; }
            public bool IsRegistered { get; set; }
            public Window Window { get; set; }
            public ABEdge Edge { get; set; }
            public WindowStyle OriginalStyle { get; set; }            
            public Point OriginalPosition { get; set; }
            public Size OriginalSize { get; set; }
            public ResizeMode OriginalResizeMode { get; set; }

            public IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam, 
                                    IntPtr lParam, ref bool handled)
            {
                if (msg == CallbackId)
                {
                    if (wParam.ToInt32() == (int)ABNotify.ABN_POSCHANGED)
                    {
                        ABSetPos(Edge, Window);
                        handled = true;
                    }
                }
                return IntPtr.Zero;
            }

        }
        private static Dictionary<Window, RegisterInfo> s_RegisteredWindowInfo 
            = new Dictionary<Window, RegisterInfo>();
        private static RegisterInfo GetRegisterInfo(Window appbarWindow)
        {
            RegisterInfo reg;
            if( s_RegisteredWindowInfo.ContainsKey(appbarWindow))
            {
                reg = s_RegisteredWindowInfo[appbarWindow];
            }
            else
            {
                reg = new RegisterInfo()
                    {
                        CallbackId = 0,
                        Window = appbarWindow,
                        IsRegistered = false,
                        Edge = ABEdge.Top,
                        OriginalStyle = appbarWindow.WindowStyle,                        
                        OriginalPosition =new Point( appbarWindow.Left, appbarWindow.Top),
                        OriginalSize = 
                            new Size( appbarWindow.ActualWidth, appbarWindow.ActualHeight),
                        OriginalResizeMode = appbarWindow.ResizeMode,
                    };
                s_RegisteredWindowInfo.Add(appbarWindow, reg);
            }
            return reg;
        }

        private static void RestoreWindow(Window appbarWindow)
        {
            RegisterInfo info = GetRegisterInfo(appbarWindow);

            appbarWindow.WindowStyle = info.OriginalStyle;            
            appbarWindow.ResizeMode = info.OriginalResizeMode;
            appbarWindow.Topmost = false;

            Rect rect = new Rect(info.OriginalPosition.X, info.OriginalPosition.Y, 
                info.OriginalSize.Width, info.OriginalSize.Height);
            appbarWindow.Dispatcher.BeginInvoke(DispatcherPriority.ApplicationIdle,
                    new ResizeDelegate(DoResize), appbarWindow, rect);

        }

        public static void SetAppBar(Window appbarWindow, ABEdge edge)
        {
            RegisterInfo info = GetRegisterInfo(appbarWindow);
            info.Edge = edge;

            APPBARDATA abd = new APPBARDATA();
            abd.cbSize = Marshal.SizeOf(abd);
            abd.hWnd = new WindowInteropHelper(appbarWindow).Handle;

            if( edge == ABEdge.None)
            {
                if( info.IsRegistered)
                {
                    SHAppBarMessage((int)ABMsg.ABM_REMOVE, ref abd);
                    info.IsRegistered = false;
                }
                RestoreWindow(appbarWindow);
                return;
            }

            if (!info.IsRegistered)
            {
                info.IsRegistered = true; 
                info.CallbackId = RegisterWindowMessage("AppBarMessage");
                abd.uCallbackMessage = info.CallbackId;

                uint ret = SHAppBarMessage((int)ABMsg.ABM_NEW, ref abd);

                HwndSource source = HwndSource.FromHwnd(abd.hWnd);
                source.AddHook(new HwndSourceHook(info.WndProc));
            }

            appbarWindow.WindowStyle = WindowStyle.None;            
            appbarWindow.ResizeMode = ResizeMode.NoResize;
            appbarWindow.Topmost = true;

            ABSetPos(info.Edge, appbarWindow);                
        }

        private delegate void ResizeDelegate(Window appbarWindow, Rect rect);
        private static void DoResize(Window appbarWindow, Rect rect)
        {
            appbarWindow.Width = rect.Width;
            appbarWindow.Height = rect.Height;
            appbarWindow.Top = rect.Top;
            appbarWindow.Left = rect.Left;
        }

        private static void ABSetPos(ABEdge edge, Window appbarWindow)
        {
            APPBARDATA barData = new APPBARDATA();
            barData.cbSize = Marshal.SizeOf(barData);
            barData.hWnd = new WindowInteropHelper(appbarWindow).Handle;
            barData.uEdge = (int)edge;

            if (barData.uEdge == (int)ABEdge.Left || barData.uEdge == (int)ABEdge.Right)
            {
                barData.rc.top = 0;
                barData.rc.bottom = (int)SystemParameters.PrimaryScreenHeight;
                if (barData.uEdge == (int)ABEdge.Left)
                {
                    barData.rc.left = 0;
                    barData.rc.right = (int)Math.Round(appbarWindow.ActualWidth);
                }
                else
                {
                    barData.rc.right = (int)SystemParameters.PrimaryScreenWidth;
                    barData.rc.left = barData.rc.right - (int)Math.Round(appbarWindow.ActualWidth);
                }
            }
            else
            {
                barData.rc.left = 0;
                barData.rc.right = (int)SystemParameters.PrimaryScreenWidth;
                if (barData.uEdge == (int)ABEdge.Top)
                {
                    barData.rc.top = 0;
                    barData.rc.bottom = (int)Math.Round(appbarWindow.ActualHeight);
                }
                else
                {
                    barData.rc.bottom = (int)SystemParameters.PrimaryScreenHeight;
                    barData.rc.top = barData.rc.bottom - (int)Math.Round(appbarWindow.ActualHeight);
                }
            }

            SHAppBarMessage((int)ABMsg.ABM_QUERYPOS, ref barData);
            SHAppBarMessage((int)ABMsg.ABM_SETPOS, ref barData);

            Rect rect = new Rect((double)barData.rc.left, (double)barData.rc.top, 
                (double)(barData.rc.right - barData.rc.left), (double)(barData.rc.bottom - barData.rc.top));
            //This is done async, because WPF will send a resize after a new appbar is added.  
            //if we size right away, WPFs resize comes last and overrides us.
            appbarWindow.Dispatcher.BeginInvoke(DispatcherPriority.ApplicationIdle, 
                new ResizeDelegate(DoResize), appbarWindow, rect);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2017-03-26T02:05:26.480

有一篇 1996 年的优秀 MSDN 文章是最新的，有趣的是：[Extend the Windows 95 Shell with Application Desktop Toolbars](http://web.archive.org/web/20170704171718/https://www.microsoft.com/msj/archive/S274.aspx)。遵循其指导会生成一个基于 WPF 的应用栏，该应用栏可以处理此页面上的其他答案无法处理的许多场景：

*   允许停靠到屏幕的任何一侧
*   允许停靠到特定显示器
*   允许调整应用栏的大小（如果需要）
*   处理屏幕布局更改和监视器断开连接
*   处理`Win`++`Shift`并`Left`尝试最小化或移动窗口
*   处理与其他应用栏的合作（OneNote 等）
*   处理每个显示器的 DPI 缩放

我有一个[演示应用程序和`AppBarWindow`GitHub 上](https://github.com/mgaffigan/WpfAppBar)的实现。

示例使用：

```
<apb:AppBarWindow x:Class="WpfAppBarDemo.MainWindow" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:apb="clr-namespace:WpfAppBar;assembly=WpfAppBar"
    DataContext="{Binding RelativeSource={RelativeSource Self}}" Title="MainWindow" 
    DockedWidthOrHeight="200" MinHeight="100" MinWidth="100">
    <Grid>
        <Button x:Name="btClose" Content="Close" HorizontalAlignment="Left" VerticalAlignment="Top" Width="75" Height="23" Margin="10,10,0,0" Click="btClose_Click"/>
        <ComboBox x:Name="cbMonitor" SelectedItem="{Binding Path=Monitor, Mode=TwoWay}" HorizontalAlignment="Left" VerticalAlignment="Top" Width="120" Margin="10,38,0,0"/>
        <ComboBox x:Name="cbEdge" SelectedItem="{Binding Path=DockMode, Mode=TwoWay}" HorizontalAlignment="Left" Margin="10,65,0,0" VerticalAlignment="Top" Width="120"/>

        <Thumb Width="5" HorizontalAlignment="Right" Background="Gray" x:Name="rzThumb" Cursor="SizeWE" DragCompleted="rzThumb_DragCompleted" />
    </Grid>
</apb:AppBarWindow> 
```

代码隐藏：

```
public partial class MainWindow
{
    public MainWindow()
    {
        InitializeComponent();

        this.cbEdge.ItemsSource = new[]
        {
            AppBarDockMode.Left,
            AppBarDockMode.Right,
            AppBarDockMode.Top,
            AppBarDockMode.Bottom
        };
        this.cbMonitor.ItemsSource = MonitorInfo.GetAllMonitors();
    }

    private void btClose_Click(object sender, RoutedEventArgs e)
    {
        Close();
    }

    private void rzThumb_DragCompleted(object sender, DragCompletedEventArgs e)
    {
        this.DockedWidthOrHeight += (int)(e.HorizontalChange / VisualTreeHelper.GetDpi(this).PixelsPerDip);
    }
} 
```

更改停靠位置：

> [![AppBar 停靠在边缘](https://i.stack.imgur.com/f13P8.gif)](https://i.stack.imgur.com/f13P8.gif)

用拇指调整大小：

> [![调整大小](https://i.stack.imgur.com/ifgn8.gif)](https://i.stack.imgur.com/ifgn8.gif)

与其他应用栏的合作：

> [![协调](https://i.stack.imgur.com/PiydR.gif)](https://i.stack.imgur.com/PiydR.gif)

如果您想使用它，请[从 GitHub](https://github.com/mgaffigan/WpfAppBar)克隆。库本身只有三个文件，可以很容易地放在一个项目中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-04-10T06:39:13.887

对不起我的英语......这是 Philip Rieck 的解决方案，有一些更正。它可以正确处理任务栏位置和大小的变化。

```
using System;
using System.Collections.Generic;
using System.Runtime.InteropServices;
using System.Windows;
using System.Windows.Interop;
using System.Windows.Threading;

namespace wpf_appbar
{
    public enum ABEdge : int
    {
        Left,
        Top,
        Right,
        Bottom,
        None
    }

    internal static class AppBarFunctions
    {
        [StructLayout(LayoutKind.Sequential)]
        private struct RECT
        {
            public int Left;
            public int Top;
            public int Right;
            public int Bottom;
            public RECT(Rect r)
            {
                Left = (int)r.Left;
                Right = (int)r.Right;
                Top = (int)r.Top;
                Bottom = (int)r.Bottom;
            }
            public static bool operator ==(RECT r1, RECT r2)
            {
                return r1.Bottom == r2.Bottom && r1.Left == r2.Left && r1.Right == r2.Right && r1.Top == r2.Top;
            }
            public static bool operator !=(RECT r1, RECT r2)
            {
                return !(r1 == r2);
            }
            public override bool Equals(object obj)
            {
                return base.Equals(obj);
            }
            public override int GetHashCode()
            {
                return base.GetHashCode();
            }
        }

        [StructLayout(LayoutKind.Sequential)]
        private struct APPBARDATA
        {
            public int cbSize;
            public IntPtr hWnd;
            public int uCallbackMessage;
            public int uEdge;
            public RECT rc;
            public IntPtr lParam;
        }

        private enum ABMsg : int
        {
            ABM_NEW = 0,
            ABM_REMOVE,
            ABM_QUERYPOS,
            ABM_SETPOS,
            ABM_GETSTATE,
            ABM_GETTASKBARPOS,
            ABM_ACTIVATE,
            ABM_GETAUTOHIDEBAR,
            ABM_SETAUTOHIDEBAR,
            ABM_WINDOWPOSCHANGED,
            ABM_SETSTATE
        }
        private enum ABNotify : int
        {
            ABN_STATECHANGE = 0,
            ABN_POSCHANGED,
            ABN_FULLSCREENAPP,
            ABN_WINDOWARRANGE
        }

        private enum TaskBarPosition : int
        {
            Left,
            Top,
            Right,
            Bottom
        }

        [StructLayout(LayoutKind.Sequential)]
        class TaskBar
        {
            public TaskBarPosition Position;
            public TaskBarPosition PreviousPosition;
            public RECT Rectangle;
            public RECT PreviousRectangle;
            public int Width;
            public int PreviousWidth;
            public int Height;
            public int PreviousHeight;
            public TaskBar()
            {
                Refresh();
            }
            public void Refresh()
            {
                APPBARDATA msgData = new APPBARDATA();
                msgData.cbSize = Marshal.SizeOf(msgData);
                SHAppBarMessage((int)ABMsg.ABM_GETTASKBARPOS, ref msgData);
                PreviousPosition = Position;
                PreviousRectangle = Rectangle;
                PreviousHeight = Height;
                PreviousWidth = Width;
                Rectangle = msgData.rc;
                Width = Rectangle.Right - Rectangle.Left;
                Height = Rectangle.Bottom - Rectangle.Top;
                int h = (int)SystemParameters.PrimaryScreenHeight;
                int w = (int)SystemParameters.PrimaryScreenWidth;
                if (Rectangle.Bottom == h && Rectangle.Top != 0) Position = TaskBarPosition.Bottom;
                else if (Rectangle.Top == 0 && Rectangle.Bottom != h) Position = TaskBarPosition.Top;
                else if (Rectangle.Right == w && Rectangle.Left != 0) Position = TaskBarPosition.Right;
                else if (Rectangle.Left == 0 && Rectangle.Right != w) Position = TaskBarPosition.Left;
            }
        }

        [DllImport("SHELL32", CallingConvention = CallingConvention.StdCall)]
        private static extern uint SHAppBarMessage(int dwMessage, ref APPBARDATA pData);

        [DllImport("User32.dll", CharSet = CharSet.Auto)]
        private static extern int RegisterWindowMessage(string msg);

        private class RegisterInfo
        {
            public int CallbackId { get; set; }
            public bool IsRegistered { get; set; }
            public Window Window { get; set; }
            public ABEdge Edge { get; set; }
            public ABEdge PreviousEdge { get; set; }
            public WindowStyle OriginalStyle { get; set; }
            public Point OriginalPosition { get; set; }
            public Size OriginalSize { get; set; }
            public ResizeMode OriginalResizeMode { get; set; }

            public IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam,
                                    IntPtr lParam, ref bool handled)
            {
                if (msg == CallbackId)
                {
                    if (wParam.ToInt32() == (int)ABNotify.ABN_POSCHANGED)
                    {
                        PreviousEdge = Edge;
                        ABSetPos(Edge, PreviousEdge, Window);
                        handled = true;
                    }
                }
                return IntPtr.Zero;
            }

        }
        private static Dictionary<Window, RegisterInfo> s_RegisteredWindowInfo
            = new Dictionary<Window, RegisterInfo>();
        private static RegisterInfo GetRegisterInfo(Window appbarWindow)
        {
            RegisterInfo reg;
            if (s_RegisteredWindowInfo.ContainsKey(appbarWindow))
            {
                reg = s_RegisteredWindowInfo[appbarWindow];
            }
            else
            {
                reg = new RegisterInfo()
                {
                    CallbackId = 0,
                    Window = appbarWindow,
                    IsRegistered = false,
                    Edge = ABEdge.None,
                    PreviousEdge = ABEdge.None,
                    OriginalStyle = appbarWindow.WindowStyle,
                    OriginalPosition = new Point(appbarWindow.Left, appbarWindow.Top),
                    OriginalSize =
                        new Size(appbarWindow.ActualWidth, appbarWindow.ActualHeight),
                    OriginalResizeMode = appbarWindow.ResizeMode,
                };
                s_RegisteredWindowInfo.Add(appbarWindow, reg);
            }
            return reg;
        }

        private static void RestoreWindow(Window appbarWindow)
        {
            RegisterInfo info = GetRegisterInfo(appbarWindow);

            appbarWindow.WindowStyle = info.OriginalStyle;
            appbarWindow.ResizeMode = info.OriginalResizeMode;
            appbarWindow.Topmost = false;

            Rect rect = new Rect(info.OriginalPosition.X, info.OriginalPosition.Y,
                info.OriginalSize.Width, info.OriginalSize.Height);
            appbarWindow.Dispatcher.BeginInvoke(DispatcherPriority.ApplicationIdle,
                    new ResizeDelegate(DoResize), appbarWindow, rect);

        }

        public static void SetAppBar(Window appbarWindow, ABEdge edge)
        {
            RegisterInfo info = GetRegisterInfo(appbarWindow);
            info.Edge = edge;

            APPBARDATA abd = new APPBARDATA();
            abd.cbSize = Marshal.SizeOf(abd);
            abd.hWnd = new WindowInteropHelper(appbarWindow).Handle;

            if (edge == ABEdge.None)
            {
                if (info.IsRegistered)
                {
                    SHAppBarMessage((int)ABMsg.ABM_REMOVE, ref abd);
                    info.IsRegistered = false;
                }
                RestoreWindow(appbarWindow);
                info.PreviousEdge = info.Edge;
                return;
            }

            if (!info.IsRegistered)
            {
                info.IsRegistered = true;
                info.CallbackId = RegisterWindowMessage("AppBarMessage");
                abd.uCallbackMessage = info.CallbackId;

                uint ret = SHAppBarMessage((int)ABMsg.ABM_NEW, ref abd);

                HwndSource source = HwndSource.FromHwnd(abd.hWnd);
                source.AddHook(new HwndSourceHook(info.WndProc));
            }

            appbarWindow.WindowStyle = WindowStyle.None;
            appbarWindow.ResizeMode = ResizeMode.NoResize;
            appbarWindow.Topmost = true;

            ABSetPos(info.Edge, info.PreviousEdge, appbarWindow);
        }

        private delegate void ResizeDelegate(Window appbarWindow, Rect rect);
        private static void DoResize(Window appbarWindow, Rect rect)
        {
            appbarWindow.Width = rect.Width;
            appbarWindow.Height = rect.Height;
            appbarWindow.Top = rect.Top;
            appbarWindow.Left = rect.Left;
        }

        static TaskBar tb = new TaskBar();

        private static void ABSetPos(ABEdge edge, ABEdge prevEdge, Window appbarWindow)
        {
            APPBARDATA barData = new APPBARDATA();
            barData.cbSize = Marshal.SizeOf(barData);
            barData.hWnd = new WindowInteropHelper(appbarWindow).Handle;
            barData.uEdge = (int)edge;
            RECT wa = new RECT(SystemParameters.WorkArea);
            tb.Refresh();
            switch (edge)
            {
                case ABEdge.Top:
                    barData.rc.Left = wa.Left - (prevEdge == ABEdge.Left ? (int)Math.Round(appbarWindow.ActualWidth) : 0);
                    barData.rc.Right = wa.Right + (prevEdge == ABEdge.Right ? (int)Math.Round(appbarWindow.ActualWidth) : 0);
                    barData.rc.Top = wa.Top - (prevEdge == ABEdge.Top ? (int)Math.Round(appbarWindow.ActualHeight) : 0) - ((tb.Position != TaskBarPosition.Top && tb.PreviousPosition == TaskBarPosition.Top) ? tb.Height : 0) + ((tb.Position == TaskBarPosition.Top && tb.PreviousPosition != TaskBarPosition.Top) ? tb.Height : 0);
                    barData.rc.Bottom = barData.rc.Top + (int)Math.Round(appbarWindow.ActualHeight);
                    break;
                case ABEdge.Bottom:
                    barData.rc.Left = wa.Left - (prevEdge == ABEdge.Left ? (int)Math.Round(appbarWindow.ActualWidth) : 0);
                    barData.rc.Right = wa.Right + (prevEdge == ABEdge.Right ? (int)Math.Round(appbarWindow.ActualWidth) : 0);
                    barData.rc.Bottom = wa.Bottom + (prevEdge == ABEdge.Bottom ? (int)Math.Round(appbarWindow.ActualHeight) : 0) - 1 + ((tb.Position != TaskBarPosition.Bottom && tb.PreviousPosition == TaskBarPosition.Bottom) ? tb.Height : 0) - ((tb.Position == TaskBarPosition.Bottom && tb.PreviousPosition != TaskBarPosition.Bottom) ? tb.Height : 0);
                    barData.rc.Top = barData.rc.Bottom - (int)Math.Round(appbarWindow.ActualHeight);
                    break;
            }

            SHAppBarMessage((int)ABMsg.ABM_QUERYPOS, ref barData);
            switch (barData.uEdge)
            {
                case (int)ABEdge.Bottom:
                    if (tb.Position == TaskBarPosition.Bottom && tb.PreviousPosition == tb.Position)
                    {
                        barData.rc.Top += (tb.PreviousHeight - tb.Height);
                        barData.rc.Bottom = barData.rc.Top + (int)appbarWindow.ActualHeight;
                    }
                    break;
                case (int)ABEdge.Top:
                    if (tb.Position == TaskBarPosition.Top && tb.PreviousPosition == tb.Position)
                    {
                        if (tb.PreviousHeight - tb.Height > 0) barData.rc.Top -= (tb.PreviousHeight - tb.Height);
                        barData.rc.Bottom = barData.rc.Top + (int)appbarWindow.ActualHeight;
                    }
                    break;
            }
            SHAppBarMessage((int)ABMsg.ABM_SETPOS, ref barData);

            Rect rect = new Rect((double)barData.rc.Left, (double)barData.rc.Top, (double)(barData.rc.Right - barData.rc.Left), (double)(barData.rc.Bottom - barData.rc.Top));
            appbarWindow.Dispatcher.BeginInvoke(new ResizeDelegate(DoResize), DispatcherPriority.ApplicationIdle, appbarWindow, rect);
        }
    }
} 
```

您可以为左右边缘编写相同的代码。干得好，菲利普·里克，谢谢！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-09-19T13:53:31.957

我修改了 Philip Rieck 的代码（顺便说一句。非常感谢）以在多个显示设置中工作。这是我的解决方案。

```
using System;
using System.Collections.Generic;
using System.Runtime.InteropServices;
using System.Windows;
using System.Windows.Interop;
using System.Windows.Threading;

namespace AppBarApplication
{
    public enum ABEdge : int
    {
        Left = 0,
        Top,
        Right,
        Bottom,
        None
    }

    internal static class AppBarFunctions
    {
        [StructLayout(LayoutKind.Sequential)]
        private struct RECT
        {
            public int left;
            public int top;
            public int right;
            public int bottom;
        }

        [StructLayout(LayoutKind.Sequential)]
        private struct APPBARDATA
        {
            public int cbSize;
            public IntPtr hWnd;
            public int uCallbackMessage;
            public int uEdge;
            public RECT rc;
            public IntPtr lParam;
        }

        [StructLayout(LayoutKind.Sequential)]
        private struct MONITORINFO
        {
          public int cbSize;
          public RECT  rcMonitor;
          public RECT  rcWork;
          public int dwFlags;
        }

        private enum ABMsg : int
        {
            ABM_NEW = 0,
            ABM_REMOVE,
            ABM_QUERYPOS,
            ABM_SETPOS,
            ABM_GETSTATE,
            ABM_GETTASKBARPOS,
            ABM_ACTIVATE,
            ABM_GETAUTOHIDEBAR,
            ABM_SETAUTOHIDEBAR,
            ABM_WINDOWPOSCHANGED,
            ABM_SETSTATE
        }
        private enum ABNotify : int
        {
            ABN_STATECHANGE = 0,
            ABN_POSCHANGED,
            ABN_FULLSCREENAPP,
            ABN_WINDOWARRANGE
        }

        [DllImport("SHELL32", CallingConvention = CallingConvention.StdCall)]
        private static extern uint SHAppBarMessage(int dwMessage, ref APPBARDATA pData);

        [DllImport("User32.dll", CharSet = CharSet.Auto)]
        private static extern int RegisterWindowMessage(string msg);

        [DllImport("User32.dll", CharSet = CharSet.Auto)]
        private static extern IntPtr MonitorFromWindow(IntPtr hwnd, uint dwFlags);

        [DllImport("User32.dll", CharSet = CharSet.Auto)]
        private static extern bool GetMonitorInfo(IntPtr hMonitor, ref MONITORINFO mi);

        private const int MONITOR_DEFAULTTONEAREST = 0x2;
        private const int MONITORINFOF_PRIMARY = 0x1;

        private class RegisterInfo
        {
            public int CallbackId { get; set; }
            public bool IsRegistered { get; set; }
            public Window Window { get; set; }
            public ABEdge Edge { get; set; }
            public WindowStyle OriginalStyle { get; set; }
            public Point OriginalPosition { get; set; }
            public Size OriginalSize { get; set; }
            public ResizeMode OriginalResizeMode { get; set; }

            public IntPtr WndProc(IntPtr hwnd, int msg, IntPtr wParam,
                                    IntPtr lParam, ref bool handled)
            {
                if (msg == CallbackId)
                {
                    if (wParam.ToInt32() == (int)ABNotify.ABN_POSCHANGED)
                    {
                        ABSetPos(Edge, Window);
                        handled = true;
                    }
                }
                return IntPtr.Zero;
            }

        }
        private static Dictionary<Window, RegisterInfo> s_RegisteredWindowInfo
            = new Dictionary<Window, RegisterInfo>();
        private static RegisterInfo GetRegisterInfo(Window appbarWindow)
        {
            RegisterInfo reg;
            if (s_RegisteredWindowInfo.ContainsKey(appbarWindow))
            {
                reg = s_RegisteredWindowInfo[appbarWindow];
            }
            else
            {
                reg = new RegisterInfo()
                {
                    CallbackId = 0,
                    Window = appbarWindow,
                    IsRegistered = false,
                    Edge = ABEdge.Top,
                    OriginalStyle = appbarWindow.WindowStyle,
                    OriginalPosition = new Point(appbarWindow.Left, appbarWindow.Top),
                    OriginalSize =
                        new Size(appbarWindow.ActualWidth, appbarWindow.ActualHeight),
                    OriginalResizeMode = appbarWindow.ResizeMode,
                };
                s_RegisteredWindowInfo.Add(appbarWindow, reg);
            }
            return reg;
        }

        private static void RestoreWindow(Window appbarWindow)
        {
            RegisterInfo info = GetRegisterInfo(appbarWindow);

            appbarWindow.WindowStyle = info.OriginalStyle;
            appbarWindow.ResizeMode = info.OriginalResizeMode;
            appbarWindow.Topmost = false;

            Rect rect = new Rect(info.OriginalPosition.X, info.OriginalPosition.Y,
                info.OriginalSize.Width, info.OriginalSize.Height);
            appbarWindow.Dispatcher.BeginInvoke(DispatcherPriority.ApplicationIdle,
                    new ResizeDelegate(DoResize), appbarWindow, rect);

        }

        public static void SetAppBar(Window appbarWindow, ABEdge edge)
        {
            RegisterInfo info = GetRegisterInfo(appbarWindow);

            info.Edge = edge;

            APPBARDATA abd = new APPBARDATA();
            abd.cbSize = Marshal.SizeOf(abd);
            abd.hWnd = new WindowInteropHelper(appbarWindow).Handle;

            if (edge == ABEdge.None)
            {
                if (info.IsRegistered)
                {
                    SHAppBarMessage((int)ABMsg.ABM_REMOVE, ref abd);
                    info.IsRegistered = false;
                }
                RestoreWindow(appbarWindow);
                return;
            }

            if (!info.IsRegistered)
            {
                info.IsRegistered = true;
                info.CallbackId = RegisterWindowMessage("AppBarMessage");
                abd.uCallbackMessage = info.CallbackId;

                uint ret = SHAppBarMessage((int)ABMsg.ABM_NEW, ref abd);

                HwndSource source = HwndSource.FromHwnd(abd.hWnd);
                source.AddHook(new HwndSourceHook(info.WndProc));
            }

            appbarWindow.WindowStyle = WindowStyle.None;
            appbarWindow.ResizeMode = ResizeMode.NoResize;
            appbarWindow.Topmost = true;

            ABSetPos(info.Edge, appbarWindow);
        }

        private delegate void ResizeDelegate(Window appbarWindow, Rect rect);
        private static void DoResize(Window appbarWindow, Rect rect)
        {
            appbarWindow.Width = rect.Width;
            appbarWindow.Height = rect.Height;
            appbarWindow.Top = rect.Top;
            appbarWindow.Left = rect.Left;
        }

        private static void GetActualScreenData(ABEdge edge, Window appbarWindow, ref int leftOffset, ref int topOffset, ref int actualScreenWidth, ref int actualScreenHeight)
        {
            IntPtr handle = new WindowInteropHelper(appbarWindow).Handle;
            IntPtr monitorHandle = MonitorFromWindow(handle, MONITOR_DEFAULTTONEAREST);

            MONITORINFO mi = new MONITORINFO();
            mi.cbSize = Marshal.SizeOf(mi);

            if (GetMonitorInfo(monitorHandle, ref mi))
            {
                if (mi.dwFlags == MONITORINFOF_PRIMARY)
                {
                    return;
                }
                leftOffset = mi.rcWork.left;
                topOffset = mi.rcWork.top;
                actualScreenWidth = mi.rcWork.right - leftOffset;
                actualScreenHeight = mi.rcWork.bottom - mi.rcWork.top;
            }
        }

        private static void ABSetPos(ABEdge edge, Window appbarWindow)
        {
            APPBARDATA barData = new APPBARDATA();
            barData.cbSize = Marshal.SizeOf(barData);
            barData.hWnd = new WindowInteropHelper(appbarWindow).Handle;
            barData.uEdge = (int)edge;

            int leftOffset = 0;
            int topOffset = 0;
            int actualScreenWidth = (int)SystemParameters.PrimaryScreenWidth;
            int actualScreenHeight = (int)SystemParameters.PrimaryScreenHeight;

            GetActualScreenData(edge, appbarWindow, ref leftOffset, ref topOffset, ref actualScreenWidth, ref actualScreenHeight);

            if (barData.uEdge == (int)ABEdge.Left || barData.uEdge == (int)ABEdge.Right)
            {
                barData.rc.top = topOffset;
                barData.rc.bottom = actualScreenHeight;
                if (barData.uEdge == (int)ABEdge.Left)
                {
                    barData.rc.left = leftOffset;
                    barData.rc.right = (int)Math.Round(appbarWindow.ActualWidth) + leftOffset;
                }
                else
                {
                    barData.rc.right = actualScreenWidth + leftOffset;
                    barData.rc.left = barData.rc.right - (int)Math.Round(appbarWindow.ActualWidth);
                }
            }
            else
            {
                barData.rc.left = leftOffset;
                barData.rc.right = actualScreenWidth + leftOffset;
                if (barData.uEdge == (int)ABEdge.Top)
                {
                    barData.rc.top = topOffset;
                    barData.rc.bottom = (int)Math.Round(appbarWindow.ActualHeight) + topOffset;
                }
                else
                {
                    barData.rc.bottom = actualScreenHeight + topOffset;
                    barData.rc.top = barData.rc.bottom - (int)Math.Round(appbarWindow.ActualHeight);
                }
            }

            SHAppBarMessage((int)ABMsg.ABM_QUERYPOS, ref barData);
            SHAppBarMessage((int)ABMsg.ABM_SETPOS, ref barData);

            Rect rect = new Rect((double)barData.rc.left, (double)barData.rc.top,
                (double)(barData.rc.right - barData.rc.left), (double)(barData.rc.bottom - barData.rc.top));
            //This is done async, because WPF will send a resize after a new appbar is added.  
            //if we size right away, WPFs resize comes last and overrides us.
            appbarWindow.Dispatcher.BeginInvoke(DispatcherPriority.ApplicationIdle,
                new ResizeDelegate(DoResize), appbarWindow, rect);
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-08T20:34:13.403

很高兴找到这个问题。上面的类确实很有用，但并没有完全涵盖 AppBar 实现的所有基础。

要完全实现 AppBar 的所有行为（应对全屏应用等），您也需要阅读这篇 MSDN 文章。

[http://msdn.microsoft.com/en-us/library/bb776821.aspx](http://msdn.microsoft.com/en-us/library/bb776821.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T20:50:19.757

抱歉，我发布的最后一个代码在调整任务栏大小时不起作用。以下代码更改似乎效果更好：

> ```
>  SHAppBarMessage((int)ABMsg.ABM_QUERYPOS, ref barData);
> 
>   if (barData.uEdge == (int)ABEdge.Top)
>     barData.rc.bottom = barData.rc.top + (int)Math.Round(appbarWindow.ActualHeight);
>   else if (barData.uEdge == (int)ABEdge.Bottom)
>     barData.rc.top = barData.rc.bottom - (int)Math.Round(appbarWindow.ActualHeight);
> 
>   SHAppBarMessage((int)ABMsg.ABM_SETPOS, ref barData); 
> ```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-13T04:58:28.683

作为商业替代品，请参阅 WPF 的即用[型 ShellAppBar](http://www.ssware.com/shlobj/shlobj.htm)组件，它支持所有案例和条件，例如停靠在左侧、右侧、顶部、底部边缘的任务栏、支持多显示器、拖放停靠、自动隐藏等。与尝试自己处理所有这些案件相比，它可能会节省您的时间和金钱。

**免责声明**：我为 ShellAppBar 的开发人员 LogicNP Software 工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-10-22T02:16:20.700

我花了几个星期来探索这个挑战，最后创建了一个非常可靠的 NuGet 包，以非常友好的方式提供了这个功能。只需创建一个新的 WPF 应用程序，然后将主窗口的类从 Window 更改为 DockWindow（在 XAML 中），就是这样！

[在此处](https://www.nuget.org/packages/Canyonix.UI.Windows/1.0.1)获取包并查看演示应用程序的 Git 存储库。

# eclipse - Eclipse - 如何将“项目方面”从 Tomcat 6 更改为 Tomcat 5.5？

> ID：75786
> 
> 赞同：56
> 
> 时间：2008-09-16T19:04:43.187
> 
> 标签：eclipse, tomcat, tomcat6, tomcat5.5, ganymede

（Eclipse 3.4，木卫三）

我在 Eclipse 中有一个现有的动态 Web 应用程序项目。创建项目时，我在“配置”下拉菜单下指定了“Apache Tomcat v6 的默认配置”。

过了一两个月，我现在想将配置更改为 Tomcat 'v5.5'。（这将是生产服务器上的 Tomcat 版本。）

我尝试了以下步骤（没有成功）：

*   我`Targeted Runtimes`在 Project 下选择了`Properties`
    The `Tomcat v5.5`option was disabled 并且 UI 显示了这条消息：
    `If the runtime you want to select is not displayed or is disabled you may need to uninstall one or more of the currently installed project facets.`
*   然后我点击了`Uninstall Facets...`链接。
    在`Runtimes`选项卡下，仅`Tomcat 6`显示。
    对于`Dynamic Web Module`，我选择了版本`2.4`来代替`2.5`.
    在`Runtimes`选项卡下，`Tomcat 5.5`现在显示。
    但是，用户界面现在显示此消息：
    `Cannot change version of project facet Dynamic Web Module to 2.4.`
    按钮`Finish`已禁用 - 所以我走到了死胡同。

我可以使用 Tomcat v5.5 配置成功创建一个新项目。但是，出于某种原因，它不会让我降级'现有项目。

作为一种解决方法，我创建了一个新项目并从旧项目中复制了源文件。尽管如此，解决方法还是相当痛苦且有些笨拙。

谁能解释我如何将项目配置从“Tomcat 6”“降级”到“Tomcat 5”？或者也许可以解释为什么会发生这种情况？

谢谢皮特
_

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-09-16T19:49:49.147

这是一种黑客日食，您可能会遇到麻烦，但这应该可以：

打开导航器视图，发现项目下有一个 .settings 文件夹，将其展开然后打开文件：`org.eclipse.wst.common.project.facet.core.xml`您应该会看到一行内容： `<installed facet="jst.web" version="2.5"/>` 将其更改为 2.4 并保存。

只要确保你的项目没有使用任何特定于 2.5 的东西，你就应该很好。

还要检查您的 web.xml 是否具有正确的配置：

```
<web-app version="2.4" 
        xmlns="http://java.sun.com/xml/ns/j2ee" 
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-03-01T14:52:08.267

这可能很旧，但我尝试在 eclipse Galilio 中找到以下内容。

打开navigator视图，发现你的项目下有一个.settings文件夹，展开后打开文件：org.eclipse.wst.common.project.facet.core。删除这个文件的内容，右键项目并单击属性。在弹出窗口中转到 Project Facats，您可以单击运行时选项卡并将您的项目转换为您想要的新方面。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-01-28T15:53:45.687

如果您使用的是 Maven，则关闭 eclipse，然后键入`>mvn eclipse:eclipse -Dwtpversion=2.0`，然后重新启动 eclipse。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T23:21:40.870

抱歉，如果没有足够的代表，我似乎无法发表评论，所以......

我认为 Eclipse 很难安全地降级到较低的标准，因为它无法真正知道您是否使用了较新的 Web 标准中的某些内容。因此，如果它只是允许您这样做，则可能会导致您的程序在旧版本上失败。

您始终可以向后兼容，但不能向前兼容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-29T11:44:38.917

您可以尝试取消选中构面，应用，更改构面的值并检查。它在 Eclipse Helios SR1 中对我有用。

所以主要区别在于我使用“动态 Web 模块”来实现。

我希望它也适合你。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-04-06T19:20:13.407

我看到了同样的事情，然后我更改了`web.xml`. 这样做可以为您解决这个问题。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-05-10T20:55:58.923

如果您使用的是 maven，则可以使用 maven eclipse 插件生成 eclipse 设置。

对于 jst.web 版本，Maven eclipse 插件考虑了项目的依赖关系。如果您定义了 servlet api 依赖项：

```
<dependency>
    <groupId>org.apache.tomcat</groupId>
    <artifactId>servlet-api</artifactId>
    <version>6.0.32</version>
</dependency> 
```

您的 jst.web 参数将为 6.0

```
<faceted-project>
  ...
  <installed facet="jst.web" version="6.0"/>
  ...
</faceted-project> 
```

# python - Django -vs- Grails -vs-？

> ID：75798
> 
> 赞同：23
> 
> 时间：2008-09-16T19:05:48.660
> 
> 标签：python, django, frameworks

我想知道是否有类似 Django 的 Web 应用程序开发的简易性与良好的部署、调试和其他工具相结合？

Django 是一个用于构建内容密集型网站的高效框架；与那里的一些 Java 怪物相比，这是我尝试过的最好的，呼吸了新鲜空气。然而，它是用 Python 编写的，这意味着在部署/打包、调试、分析器和其他使构建和维护应用程序变得更加容易的工具方面几乎没有真正的支持。

Ruby 也有类似的问题，虽然我喜欢 Ruby比喜欢 Python**好得多**，但我的印象是 Rails 在管理/支持应用程序方面与 Django 大致相同。

这里有没有人尝试过 Django 和 Grails（或其他 Web 框架）来完成不平凡的项目？他们是如何比较的？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-12-23T22:42:54.923

你要找一个同时使用 Grails 和 Django 的人。我已经为大型项目完成了这两个方面的工作。这是我的想法：

**IDE：** Django 在 Eclipse 中运行良好，Grails 在 IntelliJ Idea 中运行良好。

**调试：** 几乎相同（假设您将 IntelliJ 用于 Grails，将 Eclipse 用于 Python）。单步调试、检查变量等……都不需要打印语句。有时 django 错误消息可能毫无用处，但 Grails 错误消息通常非常冗长且难以解析。

**运行单元测试的时间：** django：2 秒。Grails：20 秒（测试本身都在几分之一秒内运行，这是关于加载框架以运行它们的部分，其余部分...如您所见，Grails 的加载速度慢得令人沮丧）。

**部署：** Django：将一个文件复制并粘贴到 apache 配置中，要重新部署，只需更改代码并重新加载 apache。Grails：创建一个 .war 文件，将其部署在 tomcat 上，冲洗并重复以重新部署。

**编程语言：** Groovy 非常棒。我喜欢它，比 Python 更喜欢它。但我当然没有抱怨。

**插件：** Grails：许多损坏的插件（并且可以使用每个 Java 库）。Django：一些稳定的插件，但足以满足您的大部分需求。

**数据库：** Django：使用 South 的模式迁移，通常是直观的关系。Grails：没有模式迁移，默认情况下它会在启动时删除数据库...... WTF

**用途：** Django：初创公司（尤其是在 Gov 2.0 领域）、独立的网络开发商店。Grails：企业

希望有帮助！

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-16T22:02:55.863

> 然而，它是用 Python 编写的，这意味着在部署/打包、调试、分析器和其他使构建和维护应用程序变得更加容易的工具方面几乎没有真正的支持。

Python有：

1.  一个[很棒的交互式调试器](http://docs.python.org/lib/module-pdb.html)，它很好地利用了 Python [REPL](http://en.wikipedia.org/wiki/REPL)。
2.  [easy_install](http://peak.telecommunity.com/DevCenter/EasyInstall) anv [virtualenv](http://pypi.python.org/pypi/virtualenv)用于依赖管理、打包和部署。
3.  与其他语言相媲美的[分析功能](http://docs.python.org/lib/profile.html)

所以恕我直言，你不应该担心这些事情，使用 Python 和 Django 并快乐地生活 :-)

幸运的是，最新版本的[Django 在 Jython 上运行](http://blog.leosoto.com/2008/08/django-on-jython-its-here.html)，因此您无需放弃整个 Java 生态系统。

说到框架，我今年评估过：

1.  [塔架](http://pylonshq.com/)(Python)
2.  [网页](http://webpy.org/)（Python）
3.  [Symfony](http://www.symfony-project.org/) (PHP)
4.  [CakePHP](http://www.cakephp.org/) (PHP)

这些框架中没有一个能比得上 Django 或 Ruby on Rails 的强大功能。根据我同事的意见，我可以向您推荐[kohana](http://www.kohanaphp.com/home)框架。缺点是，它是用 PHP 编写的，据我所知，PHP 没有出色的工具来调试、分析和打包应用程序。

**编辑：**这是一篇关于 Python 应用程序（特别是 Django 应用程序）的打包和部署的非常好的[文章。](http://bud.ca/blog/pony)现在是 Django 社区的热门话题。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-20T07:32:41.500

圣杯。

Grails 看起来就像 Rails (Ruby)，但它使用了比 java 更简单的 groovy。它使用 java 技术，您可以毫无问题地使用任何 java lib。

我也选择 Grails 而不是简单，并且有很多 java lib（例如 jasper report、jawr 等），我很高兴现在他们加入了 SpringSource，这使得他们的基础更加稳固。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-01-04T05:37:55.090

*grails 在启动时删除数据库*的说法是完全错误的。它在启动时的行为是完全可配置且易于配置的。在开发模式下运行应用程序时，我通常使用 create-drop。我在测试和生产中运行时使用更新。

我也喜欢引导处理，它让我可以在 Grails 中按环境预先配置测试用户、数据等。

我很乐意看到真正构建和部署了一些商业项目的人对利弊发表评论。成为一本真正有趣的书。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-16T23:45:56.957

我有两个朋友最初开始使用 Ruby on Rails 编写应用程序，但遇到了许多问题和限制。经过大约 8 周的研究，他们决定研究其他替代方案。

他们选择了[Catalyst Framework](http://www.catalystframework.org)和 Perl。那是大约 4 个月前的事了，他们反复谈论应用程序的运行情况有多好，以及他们有多大的灵活性。

使用 Perl，您可以使用所有的 CPAN，以及包含的大量工具。我建议至少看看它。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-18T22:47:52.960

“良好的部署”问题——对于 Python——没有它对 Java 的深刻意义。

Django 的 Python 部署基本上是“移动文件”。如果你愿意，你可以直接跑出 subversion 主干目录。

您可以毫不费力地使用 Python [distutils](http://docs.python.org/dist/dist.html)并为自己构建一个分发工具包，将您的 Django 应用程序放入 Python 的站点包中。我不是它的忠实粉丝，但它真的很容易做到。

因为我的东西在 Linux 中运行，所以我有简单的“install.py”脚本，可以将东西从 Subversion 目录移到目录`/opt/this`中`/opt/that`。我在我的 Apache 配置中使用显式路径设置来命名应用程序所在的目录。

可以通过就地编辑文件来完成修补。（一个糟糕的策略。）我更喜欢在 SVN 位置进行编辑并重新运行我的小安装，以确保我确实控制了所有文件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T19:49:26.260

cakephp.org

Cakephp 非常好，非常接近 ruby​​ on rails (1.2)。它在 php 中，在共享主机上运行良好并且易于实现。

唯一的缺点是文档有些欠缺，但你很快就能得到它并很快开始做一些很酷的事情。

我完全推荐cakephp。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-17T10:12:02.913

就我个人而言，我用 Django 做了一些相当大的项目，但我只能与所说的“montrosities”（Spring、EJB）和像 Twisted 这样的非常低级的东西进行比较。

使用解释性语言的 Web 框架大多处于起步阶段，所有这些（即积极维护）每天都在变得更好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-17T13:19:14.147

您是否将“良好部署”与 Java 的 EAR 文件进行比较，后者允许您通过将单个文件上传到 J2EE 服务器来部署 Web 应用程序？（并且，在较小程度上，WAR 文件；EAR 文件可以包含依赖项目的 WAR 文件）

我认为 Django 或 Rails 还没有达到这一点，但我可能是错的...... zuber 指出了一篇关于 Python 方面的更多细节的文章。

[Capistrano](http://www.capify.org/)可能会在 Ruby 方面有所帮助。

不幸的是，我没有真正使用过 Python 或 Ruby，所以我无法在分析器或调试器方面提供帮助。

# asp.net - ASP.NET 自定义控件 - PostBack 的替代品？

> ID：75805
> 
> 赞同：5
> 
> 时间：2008-09-16T19:06:25.337
> 
> 标签：asp.net, postback, viewstate, custom-server-controls

在深入自定义 ASP.NET 控件开发的旅程中，我显然对 ASP.NET PostBack 模型及其对控件开发的影响有所了解。

我知道控件在 ASP.NET 中没有“生命周期”，因此必须在每次加载页面时重新初始化。我们通过将对象值/参数持久化到 ViewState 来克服这个问题。

因此，我阅读的许多文章都建议不要使用 PostBack，因为这会给页面增加相当大的开销。**我不是在寻找如何禁用它，我知道。**

我正在寻找的是：

**除了使用 PostBack 模型来初始化控件之外，我们还有哪些替代方法？**

我知道我们*可以*使用 QueryString，但这看起来非常混乱，而且显然不可靠。

**理想情况下，您可以给我一个不同方法的架构/设计的概述以及它的优点/缺点。**

非常感谢^_^

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T19:10:58.180

好吧，Session State 是一个服务器端解决方案，如果你想完全避免 ViewState，它有自己的一堆麻烦要处理。但实际上，在自定义控件中使用 ViewState 一切都很好——只是对你存储的内容挑剔——只存储声明的控件状态的增量，不要存储任何你将在回发时得到的东西（例如从DB调用）等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T19:12:06.633

您必须将值存储在某处，因此您仅限于查询字符串和隐藏的表单字段。如果您将其与 HTTP 相关联，则基本上它是 GET 或 POST 参数。

我想你可以使用 cookie，但这会很麻烦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T19:12:16.537

1.  将对象状态存储在会话上下文中：这会将保持状态的负担从客户端转移到服务器，这对于小型 Intranet 应用程序来说*可能是可以接受的。*对于首都 I 互联网上的站点，这将不起作用；

2.  AJAX 启用您的控件：在这种情况下，只需要回发状态*更改。*选择正确的框架是关键；有关官方 MS 方法，请参见[http://www.asp.net/ajax/ajaxcontroltoolkit/samples/](http://www.asp.net/ajax/ajaxcontroltoolkit/samples/)；许多其他的都是可能的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T06:06:14.713

如果您真的完全在寻找 PostBack 模型的替代品，那么我建议您研究 ASP.NET MVC 框架。我很想把 WebForms 踢到路边并在 MVC 中做我所有的事情，但是，唉，遗留代码是一个 tarbaby，重写几乎永远不是答案，所以我继续插入......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T19:13:10.857

我认为您仍然对控件有一些误解。控件只有在您将它们动态添加到页面时才会出现您描述的问题。如果您在 aspx 代码中预先声明您的控件，那么它们将与页面一起构建。

# svn - Subversion 的部分提交

> ID：75809
> 
> 赞同：107
> 
> 时间：2008-09-16T19:07:06.830
> 
> 标签：svn, git

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2013-07-09T01:27:34.373

Tortoise SVN 1.8[现在支持](https://tortoisesvn.net/tsvn_1.8_releasenotes.html#commitparts)它的“提交后恢复”功能。这允许您对文件进行编辑，所有编辑在提交后都将被撤消

**根据文档：**

> 仅提交与一个特定问题相关的文件部分：
> 
> 1.  在提交对话框中，右键单击文件，选择“提交后恢复”
> 2.  在例如 TortoiseMerge 中编辑文件：撤消您还不想提交的更改
> 3.  保存文件
> 4.  提交文件

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-09-16T19:16:50.270

我已经使用[TortoiseSVN](http://tortoisesvn.tigris.org/ "TortoiseSVN")完成了这项工作。

内置的合并实用程序允许您显示存储库版本和工作副本之间的差异。

使用diff 实用程序的*创建备份功能*

1.  去提交您的文件，就好像您要提交所有更改一样。
2.  在提交窗口中，双击文件以显示差异。
3.  在差异设置中，单击*备份原始文件*的选项。
4.  右键单击您不想要的更改，然后使用 select *use other text block*。
5.  只保存**一次**差异。每次保存时都会覆盖备份。这就是为什么您只想保存一次。
6.  提交更改。
7.  用创建的 .bak 文件覆盖原始文件（其中将包含您的所有原始更改）。
8.  提交您的文件。

您现在应该使用两个单独的提交提交所有更改。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-09-16T19:37:43.747

使用 git-svn，您可以创建远程 SVN 存储库的本地 GIT 存储库，使用完整的 GIT 功能集（包括部分提交）使用它，然后将其全部推送回 SVN 存储库。

[git-svn (1)](http://schacon.github.com/git/git-svn.html)

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-09-16T19:21:23.787

尝试使用`svn diff > out.patch`然后将`out.patch`文件复制到`out.patch.add`和`out.patch.modify`

*只有当您有一个工作补丁文件时，才*使用`svn revert out.c`.

手动编辑补丁文件，使其仅包含用于添加或修改的*内容*。使用`patch`命令将它们应用于原始文件，测试添加是否有效，然后`svn commit`添加。

对`out.patch.modify`贴片重复洗涤漂洗。

如果按照您最初的问题所述，文件中的更改是分开的-添加了新方法，更改了现有方法-这将起作用

这是一个非常乏味的解决方案——尽管我不相信你应该有任何理由分开你的提交。

您还可以签出同一来源的多个工作副本以应用您的工作：

> `svn co http://location/repository methodAdd`
> 
> `svn co http://location/repository methodModify`

请务必进行`svn up`测试以确保一切正常。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2013-10-08T18:40:33.347

从 v1.8 开始，这可以使用 TortoiseSvn (Windows)。

> 4.4.1。提交对话框
> 
> 如果您的工作副本是最新的并且没有冲突，那么您就可以提交更改了。选择您要提交的任何文件和/或文件夹，然后选择 TortoiseSVN → 提交...。
> 
> <剪辑>
> 
> 4.4.3\. 仅提交部分文件
> 
> 有时您只想提交对文件所做的部分更改。这种情况通常发生在您正在处理某事但需要提交紧急修复程序时，并且该修复程序恰好位于您正在处理的同一文件中。
> 
> 右键单击文件并使用上下文菜单→提交后恢复。这将按原样创建文件的副本。然后您可以编辑该文件，例如在 TortoiseMerge 中并撤消您不想提交的所有更改。保存这些更改后，您可以提交文件。
> 
> 提交完成后，文件的副本会自动恢复，您将拥有所有未提交的修改的文件。

在 Linux 上，我会尝试[http://webstaff.itn.liu.se/~karlu20/div/blog/2013-05-31_SVNPartialCommit.php 。](http://webstaff.itn.liu.se/%7Ekarlu20/div/blog/2013-05-31_SVNPartialCommit.php)不过，我自己还没有尝试过。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-16T19:13:52.977

我曾经这样做：

*   在我的编辑器（我使用 vim）中，编辑文件以便只显示其中一项更改
*   保存文件（但不要退出编辑器）
*   将修改后的文件提交到 svn
*   在编辑器中点击“撤消”足够多次，以使第二组更改重新出现
*   再次保存文件
*   提交第二组更改。

这是一种简单的方法，假设一组更改相当容易撤消。对于更复杂的情况，我会放弃并提交这两项更改而不必担心。

现在我使用了 git，这是我希望我永远不必再做的事情！

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-16T19:18:23.810

我使用本地 darcs 存储库，或者只是逐渐合并更改。使用合并（opendiff 打开 FileMerge，Xcode 自带的合并程序；用你喜欢的合并工具替换）：

```
cp file file.new
svn revert file
opendiff file.new file -merge file 
```

合并相关更改，保存合并，退出合并程序

```
svn ci -m 'first hunk' file
mv file.new file
svn ci -m 'second hunk' file 
```

如果文件中有多个不相关的块，请冲洗并重复（但为什么要等这么久才提交？！）

另外，如果你知道 git，你可以使用[git-svn](http://git.or.cz/course/svn.html)来维护一个本地 git repo 并将你的提交同步到一个 svn 主服务器；在我有限的经验中效果很好。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-03-23T14:49:55.853

为 Visual Studio尝试[VisualSVN](https://www.visualsvn.com/visualsvn/)。最新的[6.1 版本](https://www.visualsvn.com/company/news/visualsvn-6.1)引入了 QuickCommit 功能。您可以使用Visual Studio 编辑器中的新**提交此块**和**提交选择上下文菜单命令部分提交文件中的选定更改。**

[![在此处输入图像描述](https://i.stack.imgur.com/hV92h.gif)](https://i.stack.imgur.com/hV92h.gif)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-20T17:45:00.013

1.  在选择编辑器中打开要拆分的所有文件
2.  使用不同的工具集（在 Win 上，使用 Spike 的建议（旧版本））退出第二组
3.  犯罪
4.  返回您选择的编辑器并保存所有文件

这比 Spike 的完整建议风险更大，但更容易做到。还要确保您先在其他东西上尝试它，因为某些编辑器会拒绝保存从他们下面更改的文件，除非您重新加载该文件（丢失所有更改）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-02-12T19:35:26.977

我认为比生成差异文件、还原等更简单的选择是检查存储库的两个副本，并使用像 DeltaWalker 这样的可视差异工具将大块从一个复制到另一个。

第一个副本将是您实际使用的副本，第二个副本仅用于此目的。一旦您对第一个部分进行了大量更改，您可以将一个部分复制到第二个部分，提交它，复制另一个部分，提交它等等。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-10-13T14:10:41.123

1.  将所有修改过的文件复制到备份副本。
2.  使用 .创建工作状态的补丁`svn diff`。
3.  使用 还原文件`svn revert`。
4.  `patch`使用该工具或通过手动编辑或其他方式重新应用您希望提交的补丁部分。
5.  之后运行`diff`以将您的工作副本与备份进行比较，以确保您正确应用了补丁部分。
6.  构建和测试。
7.  犯罪。
8.  将您的备份副本复制回您的存储库签出。
9.  在 2 处重复（不是在 1 处！）直到完成。

# sql - SQL 查询 - 仅在不存在完全匹配时才使用 Like？

> ID：75819
> 
> 赞同：2
> 
> 时间：2008-09-16T19:07:49.823
> 
> 标签：sql, left-join

我对当前使用的查询有疑问

```
LEFT JOIN weblog_data AS pwd 
  ON (pwd.field_id_41 != '' 
  AND pwd.field_id_41 LIKE CONCAT('%', ewd.field_id_32, '%')) 
```

但是，我发现只有在没有完全匹配的情况下才需要它。正在发生的事情是由于使用 ，查询是双重浸入`LIKE`，所以如果它首先测试完全匹配，那么它将避免双重浸入问题。任何人都可以为我提供任何进一步的指导吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T19:24:08.537

听起来您想首先根据完全匹配在您的代码段中加入别名为 pwd 和 ewd 的表，如果失败，则基于您现在的类似比较。

试试这个：

```
LEFT JOIN weblog_data AS pwd1 ON (pwd.field_id_41 != '' AND pwd.field_id_41 = ewd.field_id_32)
LEFT JOIN weblog_data AS pwd2 ON (pwd.field_id_41 != '' AND pwd.field_id_41 LIKE CONCAT('%', ewd.field_id_32, '%')) 
```

然后，在您的 select 子句中，使用如下内容：

```
select
  isnull(pwd1.field, pwd2.field) 
```

但是，如果您正在处理 pwd 中可以为 null 的字段，这将导致问题，但这应该可以工作：

```
select
  case pwd1.nonnullfield is null then pwd2.field else pwd1.field end 
```

您还必须确保进行分组，因为连接到 pwd2 仍会将行添加到您的结果集中，即使您最终忽略了其中的数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T19:11:42.717

你说的是短路评估。

看看这篇文章可能对你有帮助： [http ://beingmarkcohen.com/?p=62](http://beingmarkcohen.com/?p=62)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T19:14:39.950

使用 TSQL，运行精确匹配，检查行数 == 0，如果是，则运行类似，否则不要运行类似或在精确匹配下方添加类似结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T19:16:26.857

我只能想到用代码来做。查找完全匹配，如果结果为空，则查找 LIKE。另一个选项是此查询中的 WHERE，例如 WHERE ({count from exact match}=0)，在这种情况下，如果完全匹配返回超过 0 个结果，它将不会与 LIKE 进行比较。但它的效率非常低……更不用说在代码中有意义地使用它是相当困难的。

我会去一个 If(count from exact match = 0) 然后做类似查询，否则只使用完全匹配的结果。

# python - 使用 SQLAlchemy 的声明性语法时访问表实例的最佳方式

> ID：75829
> 
> 赞同：8
> 
> 时间：2008-09-16T19:08:29.683
> 
> 标签：python, sql, sqlalchemy

SQLAlchemy 的所有文档都给出了使用本地表实例的示例（例如`INSERT`... ）`UPDATE``tablename.update()`

使用声明性语法执行此操作似乎很困难，我需要引用`Base.metadata.tables["tablename"]`以获取表引用。

我应该以另一种方式做到这一点吗？使用声明性语法时是否有不同的语法`INSERT`和`UPDATE`推荐？我应该改用旧方法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-01T10:14:09.400

它对我有用：

```
class Users(Base):
    __tablename__   = 'users'
    __table_args__  = {'autoload':True}

users = Users()
print users.__table__.select() 
```

...选择用户.......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T22:30:56.933

通过`__table__`声明性类的属性

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-24T20:45:32.927

**表**（对象）和**表**名（表的名称，一个字符串）之间可能存在一些混淆。使用**表**类属性对我来说很好。

# java - 在 Java Server Faces 框架中使用 Spry

> ID：75848
> 
> 赞同：0
> 
> 时间：2008-09-16T19:10:07.120
> 
> 标签：java, jsf, dreamweaver

我正在尝试使用[Dreamweaver将](http://en.wikipedia.org/wiki/Adobe_Dreamweaver)[Spry](http://en.wikipedia.org/wiki/Spry_framework) [手风琴](http://en.wikipedia.org/wiki/Accordion_(GUI))插入到现有的[JSF](http://en.wikipedia.org/wiki/JavaServer_Faces)页面中。这可能吗？

我已经尝试了几件事，但只显示标签。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T09:43:03.777

我不是 Dreamweaver 专家，但 Spry Accordian 所需要的只是正确的 HTML 结构。例如：

```
 <div id="Accordion1" class="Accordion">
            <div class="AccordionPanel">
                <div class="AccordionPanelTab">Panel 1</div>
                <div class="AccordionPanelContent">
                    Panel 1 Content<br/>
                    Panel 1 Content<br/>
                    Panel 1 Content<br/>
                </div>
            </div>
    </div> 
```

如果您正确加载了[JavaScript](http://en.wikipedia.org/wiki/JavaScript)库，那么这几乎就是您需要做的所有事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T21:03:22.367

您可能要检查的唯一另一件事是您的 id 是否被 JSF 篡改。显然，这可能会影响 Spry 将自身连接到您的手风琴 html 结构的能力。

+1 戴夫的回答。

# mysql - 如何更安全地使用 MyISAM 表？

> ID：75857
> 
> 赞同：5
> 
> 时间：2008-09-16T19:10:34.420
> 
> 标签：mysql, innodb, myisam, database-integrity

我喜欢 InnoDB 的安全性、一致性和自检性。

但我需要 MyISAM 的速度和重量。

如何使 MyISAM 不易因崩溃、不良数据等而损坏？通过检查（CHECK TABLE 或 myisamchk）需要很长时间。

我不是要求事务安全——这就是 InnoDB 的目的。但我确实想要一个可以快速重启的数据库，而不是几小时（或几天！）之后。

*更新：*我不是在问如何更快地将数据加载到表中。我已经对此表示反对，并确定为我的 LOAD DATA 使用 MyISAM 表要快得多。我现在追求的是降低使用 MyISAM 表*的风险*。也就是说，减少损坏的机会，提高恢复速度。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T19:22:54.280

MyISAM 所谓的速度优势实际上很快就会消失——它缺乏行级锁定这一事实意味着小更新可能导致大量数据被锁定，并且查询被阻塞。正因为如此，我对声称的 MyISAM 速度优势持怀疑态度：开始执行多次更新，每秒的查询量将会下降。

我认为您最好问“如何使 InnoDB 支持的应用程序变得更快？” 然后答案处理缓存数据，也许是在对象级别，在轻量级缓存中 - ACID 是有成本的，对于网络应用程序来说，它并不是真正需要的。

如果 UPDATE 很少见（如果不是，MyISAM 不是一个好的选择），那么您甚至可以使用 MySQL 查询缓存。

memcached ( [http://www.danga.com/memcached/](http://www.danga.com/memcached/) ) 是一个非常流行的对象缓存选项。根据您的应用程序，您还有其他选项（HTTP 缓存等）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T01:49:47.837

While I agree with the innodb comments, I will give a solution to your MyISAM problem.

A good way to prevent corruption and increasing speed would be to use [MERGE tables](http://dev.mysql.com/doc/refman/5.1/en/merge-storage-engine.html)

You can use 2 or more MyISAM files. One is usually for backup'd old data that isn't used that often and the other is newer data. Then you will have 2 FRM (the MyISAM table files) on your harddisk and one will be protected. Usually you [compress](http://dev.mysql.com/doc/refman/5.1/en/myisampack.html) the old MyISAM tables and then they will defiantly not be corrupted, since they become read-only.

This technique is usually used to speed up big MyISAM tables, but you can apply it here as well.

Hope that helped your question. While I realize it didn't really help crash-proof MyISAM, it does give quite a bit of protection.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T18:41:01.183

在通常的实践中，你不应该得到腐败。如果您遇到损坏，您需要查看诸如内存损坏、硬盘驱动器损坏、驱动器控制器损坏或可能是 mysql 错误之类的问题。

如果你想避开所有这些，你可以设置一个复制从属。当主服务器死亡时，停止从服务器上的复制并使其成为您的新主服务器。清除旧主人的数据并将其设置为奴隶。用户停机时间将被限制为检测到主服务器死亡并启动从服务器所需的时间。

这还有一个额外的好处，那就是实现零停机备份的好方法：关闭从属进程并备份从属进程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T20:40:35.407

在某些情况下，MyISAM 的性能优势实际上非常小。您需要对自己的应用程序 MyISAM 与 InnoDB 进行基准测试。专门使用 InnoDB 事务引擎也有其他好处。

在我的测试中，InnoDB 通常会比 MyISAM 多使用 150% 的磁盘空间——这是因为它的块结构和缺乏索引压缩。

如果您负担得起，请改用 InnoDB。

就回答您的实际问题而言：如果您将表分区为多个 MyISAM 表，则崩溃所需的修复量会少得多；如果您的数据很大，出于其他原因，这可能是一个好主意。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T19:15:28.463

你嫁给 MySQL 了吗？[Postgres](http://www.postgresql.org/)与 ACID 兼容（如 innoDB）并且（在经过良好调整时）几乎与 MyISAM 一样快。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T17:20:44.840

获得一个良好的 UPS，具有良好的电源调节。在稳定和冗余的硬件上运行。

我不相信 MyISAM 表能够在写入过程中发生崩溃，所以我认为最好的选择是减少崩溃（和写入）的发生。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T12:56:14.827

这在很大程度上取决于您如何使用表格。如果它们的写入量很大，那么您可能需要考虑删除索引，这将加快恢复时间。如果它们被大量读取，您可能需要考虑使用复制来序列化所有对表的写入，从而最大限度地减少崩溃后读取副本的恢复时间。

您可以做的事情是写入表的 InnoDB 副本，然后复制到 MyISAM 副本。无论如何，MyISAM 的性能优势主要是面向读取的。

当然，使用复制，您将在读取和写入之间有延迟时间

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T12:41:34.003

你的评论：

> 不，主要问题是将数据初始导入表中的磁盘密集型令人吃惊。MyISAM 时间：12 分钟。InnoDB 时间：3+ 小时。在我的初始加载之后，更新不存在，插入也很少见。InnoDB 令人失望的加载操作没有已知的解决方案。

建议删除约束和索引，然后在加载后启用/重建它们可能会显着加快速度 - 我假设你尝试过？这有改善吗？

# linux - 在环回上挂载 rootfs

> ID：75862
> 
> 赞同：2
> 
> 时间：2008-09-16T19:11:43.077
> 
> 标签：linux, rootfs

我有一个 rootfs 启动映像，我想通过挂载到本地文件系统上来进行测试。我怎样才能做到这一点 ？

编辑：该文件是一个 rootfs.img 但事实证明我的自定义内核中没有正确的文件系统支持。一旦有 fs 支持，pjz 的答案就会起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T19:14:54.817

需要更多信息 - 它是什么样的图像？

它是一个文件系统吗？如果是这样，您可以像这样安装它：

```
 mount -o loop rootfs.img /mnt/rootfs 
```

如果它是您通过 nfs 导出的文件系统的子目录，您可以通过 chroot 来模拟您创建的环境：

```
 chroot /path/to/nfs/rootdir/ 
```

# c# - C#驱动程序开发？

> ID：75886
> 
> 赞同：18
> 
> 时间：2008-09-16T19:14:49.153
> 
> 标签：c#, kernel, drivers, device

在我一头扎进 C# 之前...

我一直觉得 C 或者 C++ 最适合在 Windows 上开发驱动程序。我不热衷于在 .NET 机器上开发驱动程序的想法。

但是 .NET 似乎是 MS 走向应用程序开发的方式，所以我现在想知道：

*   人们是否在使用 C# 开发驱动程序？
*   您是否必须做很多 API 挂钩，或者 C# 是否具有与内核交互而无需大量黑客的设施？
*   谁能比通常情况下更接近 Ring 0 运行 C# 程序的可靠性和安全性？

我希望我的设备可以在 C# 中使用，如果 C# 中的驱动程序开发很成熟，那显然是要走的路，但如果不推荐的话，我不想在那里花很多精力。

*   有哪些很好的入门资源，比如开发一个简单的虚拟串行端口驱动程序？

-亚当

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-16T19:32:56.583

您不能在 C# 中制作内核模式设备驱动程序，因为运行时无法安全地加载到 ring0 并按预期运行。

此外，C# 不会创建适合作为设备驱动程序加载的二进制文件，尤其是关于驱动程序需要公开的入口点。在加载过程中对运行时的依赖跳转并分析和 JIT 二进制文件禁止直接访问驱动子系统加载二进制文件所需的直接访问。

然而，将一些设备驱动程序提升到用户模式的工作正在进行中，您可以[在这里](http://channel9.msdn.com/posts/Charles/Peter-Wieland-User-Mode-Driver-Framework/)看到对 UDMF（用户模式驱动程序框架）团队的 Peter Wieland 的采访。

用户模式驱动程序更适合托管工作，但您必须搜索一下以了解是否直接支持 C# 和 .NET。我所知道的是内核级驱动程序仅在 C# 中不可用。

但是，如果您绝对必须用 C# 编写大量代码，则您可以制作 C/C++ 驱动程序和 C# 服务（或类似服务）并让驱动程序与托管代码对话。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T19:23:10.303

这将以某种方式帮助您：[Windows Driver Kit](http://www.microsoft.com/whdc/devtools/wdk/default.mspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T19:18:59.877

这不是对您问题的直接回答，但如果您有兴趣，可以查看[Singularity project](http://research.microsoft.com/os/Singularity/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T19:38:28.893

> 谁能比通常情况下更接近 Ring 0 运行 C# 程序的可靠性和安全性？

C# 在 .NET 虚拟机中运行，您不能将它移到比 VM 更靠近 Ring 0 的位置，并且 VM 在用户空间中运行。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-18T03:31:12.597

如果您愿意尝试专有框架，[Jungo 的 WinDriver 工具包](http://www.jungo.com/st/windriver_usb_pci_driver_development_software.html)支持 USB、PCI 和 PCI-E 设备的用户模式驱动程序开发（甚至在托管代码中）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T19:24:09.303

微软在托管代码操作系统领域有许多研究项目，换句话说就是用 Win32 API 杀死。

请参阅 Mary Jo Foley 的文章：[重建遗产](http://reddevnews.com/features/article.aspx?editorialsid=2555)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T20:01:13.223

在 .net 中编写设备驱动程序对于当前版本的 windows 没有意义。

<推测>
有传言说 MS 正在投入大量资金将 Singularity 提升到一个新的水平。只是寻找[Midori](http://en.wikipedia.org/wiki/Midori_(operating_system))。但那是 2015+
</speculation>

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-05-12T18:52:57.427

如果我没记错的话，[Dokan 项目](https://dokan-dev.github.io/)是一个用户模式文件系统驱动程序，它还允许系统驱动程序执行 .NET 代码：[https](https://github.com/dokan-dev/dokan-dotnet) ://github.com/dokan-dev/dokan-dotnet 。

因此，您可以开发一个 C#“驱动程序”（实际上是用户模式应用程序），然后由 C++ 内核模式驱动程序调用/调用。内核驱动程序可以简单地传递所有内容而无需处理数据并充当简单的包装器。
不用说，这是非常不安全的，你很可能会以 BSOD 结束（我试过了）。

* * *

*轻度相关：*

[Cosmos 项目](http://gocosmos.org)是一个开源操作系统，使用 C# 开发并运行完全
用 C#/F#/VB.NET/... 编写的“（内核）驱动程序”和用户级应用程序。

虽然这些在技术上是内核级别的驱动程序，但操作系统不再是 Windows，而是您自己的，所以我想这不是一个正确的答案......

# algorithm - 寻找相似图像的算法

> ID：75891
> 
> 赞同：87
> 
> 时间：2008-09-16T19:15:18.077
> 
> 标签：algorithm, math, image-comparison

我需要一种算法来确定两个图像是否“相似”并识别相似的颜色、亮度、形状等模式。我可能需要一些关于人脑使用哪些参数来“分类”图像的指针。..

我看过基于 hausdorff 的匹配，但这似乎主要用于匹配变换后的对象和形状模式。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-17T13:56:43.497

[我做了类似的事情，通过使用小波变换](http://en.wikipedia.org/wiki/Wavelet)将图像分解为签名。

我的方法是从每个转换后的通道中选择最重要的*n 个*系数，并记录它们的位置。这是通过根据 abs(power) 对 (power,location) 元组列表进行排序来完成的。相似的图像将具有相似性，因为它们在相同的地方具有显着的系数。

我发现最好将图像转换为 YUV 格式，这样可以有效地对形状（Y 通道）和颜色（UV 通道）的相似性进行加权。

您可以在[macorii](https://github.com/freespace/mactorii)中找到我对上述内容的实现，不幸的是，我并没有像我应该做的那样努力:-)

另一种方法，我的一些朋友使用的效果出奇的好，就是简单地将图像大小调整为 4x4 像素并将其存储为您的签名。可以通过使用相应像素计算两幅图像之间的[曼哈顿距离](http://en.wikipedia.org/wiki/Manhattan_distance)来对两幅图像的相似程度进行评分。我没有他们如何执行调整大小的详细信息，因此您可能必须使用可用于该任务的各种算法来找到合适的算法。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2009-04-21T22:23:58.170

[pHash](http://www.phash.org/)可能会让您感兴趣。

> 感知哈希 n. 音频、视频或图像文件的指纹，它在数学上基于其中包含的音频或视频内容。与依赖于输入的微小变化导致输出剧烈变化的雪崩效应的密码散列函数不同，如果输入在视觉或听觉上相似，则感知散列彼此“接近”。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-17T22:41:30.600

我使用[SIFT](http://en.wikipedia.org/wiki/Scale-invariant_feature_transform)重新检测不同图像中的相同对象。它真的很强大，但相当复杂，可能有点矫枉过正。如果图像应该非常相似，一些基于两张图像之间差异的简单参数可以告诉你很多。一些指示：

*   归一化图像，即通过计算两者的平均亮度并根据比例缩小最亮的图像（以避免在最高水平上剪裁）来使两个图像的平均亮度相同）特别是如果你对形状更感兴趣而不是在颜色。
*   每个通道的归一化图像的色差总和。
*   找到图像中的边缘并测量两个图像中边缘像素之间的距离。（形状）
*   将图像划分为一组离散区域并比较每个区域的平均颜色。
*   在一个（或一组）级别对图像进行阈值处理，并计算生成的黑白图像不同的像素数。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-03-28T12:23:10.297

我的实验室也需要解决这个问题，我们使用了 Tensorflow。这是用于可视化图像相似性的[完整应用程序实现。](https://github.com/YaleDHLab/pix-plot)

有关对图像进行矢量化以进行相似度计算的教程，请查看[此页面](http://douglasduhaime.com/posts/identifying-similar-images-with-tensorflow.html)。这是 Python（同样，完整的工作流程请参见帖子）：

```
from __future__ import absolute_import, division, print_function

"""

This is a modification of the classify_images.py
script in Tensorflow. The original script produces
string labels for input images (e.g. you input a picture
of a cat and the script returns the string "cat"); this
modification reads in a directory of images and 
generates a vector representation of the image using
the penultimate layer of neural network weights.

Usage: python classify_images.py "../image_dir/*.jpg"

"""

# Copyright 2015 The TensorFlow Authors. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# ==============================================================================

"""Simple image classification with Inception.

Run image classification with Inception trained on ImageNet 2012 Challenge data
set.

This program creates a graph from a saved GraphDef protocol buffer,
and runs inference on an input JPEG image. It outputs human readable
strings of the top 5 predictions along with their probabilities.

Change the --image_file argument to any jpg image to compute a
classification of that image.

Please see the tutorial and website for a detailed description of how
to use this script to perform image recognition.

https://tensorflow.org/tutorials/image_recognition/
"""

import os.path
import re
import sys
import tarfile
import glob
import json
import psutil
from collections import defaultdict
import numpy as np
from six.moves import urllib
import tensorflow as tf

FLAGS = tf.app.flags.FLAGS

# classify_image_graph_def.pb:
#   Binary representation of the GraphDef protocol buffer.
# imagenet_synset_to_human_label_map.txt:
#   Map from synset ID to a human readable string.
# imagenet_2012_challenge_label_map_proto.pbtxt:
#   Text representation of a protocol buffer mapping a label to synset ID.
tf.app.flags.DEFINE_string(
    'model_dir', '/tmp/imagenet',
    """Path to classify_image_graph_def.pb, """
    """imagenet_synset_to_human_label_map.txt, and """
    """imagenet_2012_challenge_label_map_proto.pbtxt.""")
tf.app.flags.DEFINE_string('image_file', '',
                           """Absolute path to image file.""")
tf.app.flags.DEFINE_integer('num_top_predictions', 5,
                            """Display this many predictions.""")

# pylint: disable=line-too-long
DATA_URL = 'http://download.tensorflow.org/models/image/imagenet/inception-2015-12-05.tgz'
# pylint: enable=line-too-long

class NodeLookup(object):
  """Converts integer node ID's to human readable labels."""

  def __init__(self,
               label_lookup_path=None,
               uid_lookup_path=None):
    if not label_lookup_path:
      label_lookup_path = os.path.join(
          FLAGS.model_dir, 'imagenet_2012_challenge_label_map_proto.pbtxt')
    if not uid_lookup_path:
      uid_lookup_path = os.path.join(
          FLAGS.model_dir, 'imagenet_synset_to_human_label_map.txt')
    self.node_lookup = self.load(label_lookup_path, uid_lookup_path)

  def load(self, label_lookup_path, uid_lookup_path):
    """Loads a human readable English name for each softmax node.

    Args:
      label_lookup_path: string UID to integer node ID.
      uid_lookup_path: string UID to human-readable string.

    Returns:
      dict from integer node ID to human-readable string.
    """
    if not tf.gfile.Exists(uid_lookup_path):
      tf.logging.fatal('File does not exist %s', uid_lookup_path)
    if not tf.gfile.Exists(label_lookup_path):
      tf.logging.fatal('File does not exist %s', label_lookup_path)

    # Loads mapping from string UID to human-readable string
    proto_as_ascii_lines = tf.gfile.GFile(uid_lookup_path).readlines()
    uid_to_human = {}
    p = re.compile(r'[n\d]*[ \S,]*')
    for line in proto_as_ascii_lines:
      parsed_items = p.findall(line)
      uid = parsed_items[0]
      human_string = parsed_items[2]
      uid_to_human[uid] = human_string

    # Loads mapping from string UID to integer node ID.
    node_id_to_uid = {}
    proto_as_ascii = tf.gfile.GFile(label_lookup_path).readlines()
    for line in proto_as_ascii:
      if line.startswith('  target_class:'):
        target_class = int(line.split(': ')[1])
      if line.startswith('  target_class_string:'):
        target_class_string = line.split(': ')[1]
        node_id_to_uid[target_class] = target_class_string[1:-2]

    # Loads the final mapping of integer node ID to human-readable string
    node_id_to_name = {}
    for key, val in node_id_to_uid.items():
      if val not in uid_to_human:
        tf.logging.fatal('Failed to locate: %s', val)
      name = uid_to_human[val]
      node_id_to_name[key] = name

    return node_id_to_name

  def id_to_string(self, node_id):
    if node_id not in self.node_lookup:
      return ''
    return self.node_lookup[node_id]

def create_graph():
  """Creates a graph from saved GraphDef file and returns a saver."""
  # Creates graph from saved graph_def.pb.
  with tf.gfile.FastGFile(os.path.join(
      FLAGS.model_dir, 'classify_image_graph_def.pb'), 'rb') as f:
    graph_def = tf.GraphDef()
    graph_def.ParseFromString(f.read())
    _ = tf.import_graph_def(graph_def, name='')

def run_inference_on_images(image_list, output_dir):
  """Runs inference on an image list.

  Args:
    image_list: a list of images.
    output_dir: the directory in which image vectors will be saved

  Returns:
    image_to_labels: a dictionary with image file keys and predicted
      text label values
  """
  image_to_labels = defaultdict(list)

  create_graph()

  with tf.Session() as sess:
    # Some useful tensors:
    # 'softmax:0': A tensor containing the normalized prediction across
    #   1000 labels.
    # 'pool_3:0': A tensor containing the next-to-last layer containing 2048
    #   float description of the image.
    # 'DecodeJpeg/contents:0': A tensor containing a string providing JPEG
    #   encoding of the image.
    # Runs the softmax tensor by feeding the image_data as input to the graph.
    softmax_tensor = sess.graph.get_tensor_by_name('softmax:0')

    for image_index, image in enumerate(image_list):
      try:
        print("parsing", image_index, image, "\n")
        if not tf.gfile.Exists(image):
          tf.logging.fatal('File does not exist %s', image)

        with tf.gfile.FastGFile(image, 'rb') as f:
          image_data =  f.read()

          predictions = sess.run(softmax_tensor,
                          {'DecodeJpeg/contents:0': image_data})

          predictions = np.squeeze(predictions)

          ###
          # Get penultimate layer weights
          ###

          feature_tensor = sess.graph.get_tensor_by_name('pool_3:0')
          feature_set = sess.run(feature_tensor,
                          {'DecodeJpeg/contents:0': image_data})
          feature_vector = np.squeeze(feature_set)        
          outfile_name = os.path.basename(image) + ".npz"
          out_path = os.path.join(output_dir, outfile_name)
          np.savetxt(out_path, feature_vector, delimiter=',')

          # Creates node ID --> English string lookup.
          node_lookup = NodeLookup()

          top_k = predictions.argsort()[-FLAGS.num_top_predictions:][::-1]
          for node_id in top_k:
            human_string = node_lookup.id_to_string(node_id)
            score = predictions[node_id]
            print("results for", image)
            print('%s (score = %.5f)' % (human_string, score))
            print("\n")

            image_to_labels[image].append(
              {
                "labels": human_string,
                "score": str(score)
              }
            )

        # close the open file handlers
        proc = psutil.Process()
        open_files = proc.open_files()

        for open_file in open_files:
          file_handler = getattr(open_file, "fd")
          os.close(file_handler)
      except:
        print('could not process image index',image_index,'image', image)

  return image_to_labels

def maybe_download_and_extract():
  """Download and extract model tar file."""
  dest_directory = FLAGS.model_dir
  if not os.path.exists(dest_directory):
    os.makedirs(dest_directory)
  filename = DATA_URL.split('/')[-1]
  filepath = os.path.join(dest_directory, filename)
  if not os.path.exists(filepath):
    def _progress(count, block_size, total_size):
      sys.stdout.write('\r>> Downloading %s %.1f%%' % (
          filename, float(count * block_size) / float(total_size) * 100.0))
      sys.stdout.flush()
    filepath, _ = urllib.request.urlretrieve(DATA_URL, filepath, _progress)
    print()
    statinfo = os.stat(filepath)
    print('Succesfully downloaded', filename, statinfo.st_size, 'bytes.')
  tarfile.open(filepath, 'r:gz').extractall(dest_directory)

def main(_):
  maybe_download_and_extract()
  if len(sys.argv) < 2:
    print("please provide a glob path to one or more images, e.g.")
    print("python classify_image_modified.py '../cats/*.jpg'")
    sys.exit()

  else:
    output_dir = "image_vectors"
    if not os.path.exists(output_dir):
      os.makedirs(output_dir)

    images = glob.glob(sys.argv[1])
    image_to_labels = run_inference_on_images(images, output_dir)

    with open("image_to_labels.json", "w") as img_to_labels_out:
      json.dump(image_to_labels, img_to_labels_out)

    print("all done")
if __name__ == '__main__':
  tf.app.run() 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-16T19:19:33.870

您可以使用[感知图像差异](http://pdiff.sourceforge.net/)

它是一个命令行实用程序，使用感知度量比较两个图像。也就是说，它使用人类视觉系统的计算模型来确定两个图像在视觉上是否不同，因此忽略像素的微小变化。此外，它还大大减少了由随机数生成差异、操作系统或机器架构差异引起的误报数量。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-16T19:20:35.737

这是一个难题！这取决于您需要有多准确，并且取决于您使用的图像类型。您可以使用直方图来比较颜色，但这显然没有考虑图像中这些颜色的空间分布（即形状）。边缘检测和某种分割（即挑选形状）可以提供与另一个图像匹配的模式。您可以使用 coocurence 矩阵来比较纹理，将图像视为像素值的矩阵，然后比较这些矩阵。有一些关于图像匹配和机器视觉的好书——在亚马逊上搜索会找到一些。

希望这可以帮助！

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-17T13:54:09.057

一些图像识别软件解决方案实际上并非纯粹基于算法，​​而是利用**神经网络**概念。查看[http://en.wikipedia.org/wiki/Artificial_neural_network](http://en.wikipedia.org/wiki/Artificial_neural_network)和 NeuronDotNet，其中还包括有趣的示例：[http ://neurondotnet.freehostia.com/index.html](http://neurondotnet.freehostia.com/index.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-17T17:54:12.990

有使用 Kohonen 神经网络/自组织图的相关研究

更多学术系统（Google for PicSOM）或更少学术
（[http://www.generation5.org/content/2004/aiSomPic.asp](http://www.generation5.org/content/2004/aiSomPic.asp)，（可能不适合所有工作环境））演示文稿都存在。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-10-14T15:44:04.153

计算大幅缩小版本（例如：6x6 像素）的像素颜色值差异的平方和效果很好。相同的图像产生 0，相似的图像产生小的数字，不同的图像产生大的数字。

上面其他人首先闯入 YUV 的想法听起来很有趣——虽然我的想法很有效，但我希望我的图像被计算为“不同的”，以便它产生正确的结果——即使从色盲观察者的角度来看也是如此。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-16T19:30:59.130

这听起来像是视力问题。您可能想研究 Adaptive Boosting 以及 Burns Line Extraction 算法。这两个概念应该有助于解决这个问题。如果您不熟悉视觉算法，边缘检测是一个更简单的起点，因为它解释了基础知识。

至于分类参数：

*   调色板和位置（梯度计算，颜色直方图）
*   包含的形状（Ada. 提升/训练以检测形状）

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-17T13:47:54.080

根据您需要多少准确结果，您可以简单地将图像分解为 nxn 像素块并进行分析。如果您在第一个块中得到不同的结果，您将无法停止处理，从而导致一些性能改进。

例如，为了分析正方形，您可以获得颜色值的总和。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-06-03T10:41:32.290

我发现这篇文章对解释它是如何工作的很有帮助：

[http://www.hackerfactor.com/blog/index.php?/archives/432-Looks-Like-It.html](http://www.hackerfactor.com/blog/index.php?/archives/432-Looks-Like-It.html)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-16T19:16:53.063

您可以在两个图像之间执行某种块匹配运动估计，并测量残差和运动矢量成本的总和（就像在视频编码器中所做的那样）。这将补偿运动；对于加分，进行仿射变换运动估计（补偿缩放和拉伸等）。你也可以做重叠块或光流。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-16T19:19:57.347

作为第一遍，您可以尝试使用颜色直方图。但是，您确实需要缩小问题范围。通用图像匹配是一个非常困难的问题。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-10-17T05:39:04.313

很抱歉在讨论中加入晚了。

我们甚至可以使用 ORB 方法来检测两个图像之间的相似特征点。以下链接给出了 ORB 在 python 中的直接实现

[http://scikit-image.org/docs/dev/auto_examples/plot_orb.html](http://scikit-image.org/docs/dev/auto_examples/plot_orb.html)

甚至 openCV 也直接实现了 ORB。如果您有更多信息，请遵循下面给出的研究文章。

[https://www.researchgate.net/publication/292157133_Image_Matching_Using_SIFT_SURF_BRIEF_and_ORB_Performance_Comparison_for_Distorted_Images](https://www.researchgate.net/publication/292157133_Image_Matching_Using_SIFT_SURF_BRIEF_and_ORB_Performance_Comparison_for_Distorted_Images)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-16T19:26:26.380

在其他线程中有一些很好的答案，但我想知道涉及光谱分析的东西是否可行？即，将图像分解为其相位和幅度信息并进行比较。这可以避免一些与裁剪、转换和强度差异有关的问题。无论如何，这只是我的猜测，因为这似乎是一个有趣的问题。如果您搜索[http://scholar.google.com](http://scholar.google.com)，我相信您可以找到几篇关于此的论文。

# wpf - 如何将 XAML/WPF 文件转换为视频（AVI、WMV 等）

> ID：75906
> 
> 赞同：4
> 
> 时间：2008-09-16T19:17:03.423
> 
> 标签：wpf, xaml, video, animation, record

我有一个简单的 WPF (XAML) 文件，其中包含一些动画形状和文本。动画没有交互行为。我想将此动画录制为视频文件，稍后我打算将其用作截屏视频的“介绍”屏幕。

我认为我需要的是：接受输入 XAML 文件并以（例如 24fps）输出高质量 WMV 的 C# 代码。

# 我已经调查过的可能替代方案

1.  使用 Camtasia Studio 等屏幕录制软件进行录制。这可行，但动画不那么流畅，尤其是当动画有很多过渡或移动时

2.  使用 Epiphan Systems 的 DVI2USB 等硬件。成本太高；没试过。

3.  使用 DVR 卡录制电视输出（S-Video 等） - 低质量和低分辨率。

# 2008 年 10 月 28 日更新 - 工作源代码

这篇博文有一个完整的工作源代码示例，将 WPF/XAML 导出为 AVI。它没有我想要的那么快，但它可以满足我的需求：

[链接到 MSDN 博客博文](http://blogs.msdn.com/saveenr/archive/2008/09/22/wpf-xaml-saving-an-animation-as-an-avi-video-file.aspx)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T19:27:12.133

使用 RenderTargetBitmap 渲染帧，然后使用您选择的编解码器进行编码。不是很快，但在普通 PC 上可以达到 24 fps。我们使用类似的技术将视频流从新的 WPF 指示器馈送到旧的位图系统。可能有更好的解决方案，但它有效。

*我还听说过一种解决方案，可以从 WPF 内部使用的 DirectX 缓冲区中提取渲染帧，它的工作速度比 RenderTargetBitmap 快得多，但在生产系统中使用它似乎太不可靠了*

更新：您似乎不需要实时，因此 RenderTargetBitmap 应该可以正常工作。

# .net - 如何阻止来自 FullTrust 程序集的 CAS 安全要求

> ID：75909
> 
> 赞同：0
> 
> 时间：2008-09-16T19:17:29.397
> 
> 标签：.net, cas, full-trust

我有一个 FullTrust 程序集，程序集 A，它调用第 3 方组件程序集 B。我有什么办法可以通过 A.dll.config 或在 A 的代码中阻止任何 CAS 要求将堆栈传播到程序集 B，哪个没有 FullTrust？

如果可能，我不想更改机器的安全策略。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-16T19:29:09.243

您可以使用 2.0 中的沙盒 API 创建一个单独的应用程序域。MSDN比我能[解释](http://msdn.microsoft.com/en-us/magazine/cc163701.aspx)得更好。当然，您正在编组应用程序域；但如果你想要隔离，那就是你必须付出的代价。

# sql-server - 哪种类型的外部驱动器适合 SQL 备份文件？

> ID：75919
> 
> 赞同：0
> 
> 时间：2008-09-16T19:18:29.597
> 
> 标签：sql-server

作为数据库维护的一部分，我们正在考虑将每日备份到外部/火线驱动器上。是否有任何特定推荐的驱动器用于从 sql server 2000 进行频繁的读/写操作以进行备份？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T19:20:27.547

无论您做什么，都不要使用 USB 1.1。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T19:26:59.437

一个简单的事实是，硬盘在一段时间内会出现故障。不幸的是，我可以推荐的最好的两种解决方案都没有使用硬盘。

使用磁带备份虽然速度较慢，但​​您可以灵活地选择异地备份。将胶带放在汽车后备箱中很容易。旋转磁带意味着您可以针对任何不可预见的情况获得最近的保护。

另一种选择是在线备份解决方案，其中备份被加密并在异地复制。我的建议绝对是至少在您保留 SQL 服务器的建筑物外部进行某种异地备份。毕竟是“灾难”恢复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T19:31:05.120

几乎任何外部驱动器都可以在这里使用，只要它有足够的空间来保存您的备份和足够的性能来获取备份。具体取决于您的确切要求。

根据我的经验，无论理论上的最大传输速率如何，FireWire 的磁盘活动性能都优于 USB。FireWire 800 的性能会更好。当您进行多个并发读取/写入时，我发现 FireWire 和 USB 驱动器的性能很差，但是对于备份，通常是更大的顺序读取和写入。

另一个设置和管理稍微复杂一些但可以为您提供更大灵活性和性能的选项是外部 SATA (eSATA)。您甚至可以获得可热插拔的外部 SATA 机箱，以获得更大的便利性，并且可以轻松地将备份带到异地。

然而，另一个我取得了巨大成功的相关选项是设置一个单独的服务器作为您的备份服务器。您可以使用您选择的任何磁盘选项（FireWire、SATA、eSATA、SCSI、FiberChannel、iSCSI 等），并将该磁盘存储共享为网络共享（我在 Linux 机器上使用 NFS 和 Samba，但面向 Windows网络，Windows 共享将正常工作）。然后，您可以通过网络访问共享并将多台计算机备份到其中。此外，如果您需要离线维护、添加/删除存储等，备份服务器与生产机器的分离将为您提供更大的灵活性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T19:44:54.290

德罗博！

使用普通的 USB 硬盘驱动器 RAID 阵列 - 现成的硬盘驱动器。4个托架，当您需要更多空间时，请购买另一个硬盘驱动器。出海湾？购买更大的硬盘并更换阵列中最小的硬盘。

[http://www.drobo.com/](http://www.drobo.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T20:38:03.150

根据数据库的大小，驱动器的速度可能是一个真正的因素。我会研究类似 Drobo 但带有 eSata 或 SAS 接口的东西。没有什么比观看一个 TB 通过 USB 2.0 更有趣的了。此外，您可能会考虑使用 hyperbac 或 RedGate SQL Backup 之类的东西来压缩备份并使其更容易安装到驱动器上。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T21:15:02.267

在大多数情况下，外部驱动器不是一个好的选择——除非你的数据库真的很小。

除了其他人列出的一些选项之外，您还可以将 UNC/网络共享用作一个很好的“开箱即用”选项。

查看以下视频了解其他一些选项：
[SQL Server 备份选项（免费视频）](http://www.sqlservervideos.com/sqlserver-backups/backup-options)

网站上有关配置备份的视频将向您展示如何为备份目的指定网络路径。

# .net - WPF 中 ProgressBar 上的文本

> ID：75924
> 
> 赞同：61
> 
> 时间：2008-09-16T19:18:59.610
> 
> 标签：.net, wpf, controls, progress-bar

对于 WPF 行家来说，这可能是显而易见的，但我想知道是否有一种简单的方法可以将文本放在 WPF ProgressBar 上。对我来说，一个空的进度条看起来很赤裸。那是屏幕空间，可以传递有关正在进行的信息，甚至只是在表示中添加数字**。**现在，WPF 都是关于容器和扩展的，我正在慢慢地围绕着它思考，但由于我没有看到“文本”或“内容”属性，我想我将不得不添加一些东西到作为我的进度条的容器。是否有一种或两种技术比我最初的 WinForms 冲动更自然？向进度条添加文本的最佳、最自然的 WPF 方式是什么？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-09-19T03:19:52.573

之前的两个响应（创建一个新的`CustomControl`或一个`Adorner`）都是更好的做法，但如果你只是想要快速和肮脏的（或从视觉上理解如何做到这一点），那么这段代码可以工作：

```
<Grid Width="300" Height="50">  
   <ProgressBar Value="50" />
   <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center">
      My Text
   </TextBlock>
</Grid> 
```

请记住，z-index 使得列出的最后一项位于顶部。

此外，如果您还没有[Kaxaml](http://www.kaxaml.com/)，请务必选择它 - 当您尝试解决问题时，它非常适合使用 XAML。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2015-06-19T15:25:44.627

**这可以很简单**（除非有很多方法可以让它工作）。

您可以使用`Style`来完成此操作，或者您只需覆盖 a`TextBlock`和 a `ProgressBar`。

我个人用它来显示等待完成时的进度百分比。

> 为了简单起见，我只想拥有**一个** `Binding`，所以我`TextBock.Text`将`ProgressBar.Value`.

                                           **然后只需复制代码即可完成。**

```
<Grid>
   <ProgressBar Minimum="0" 
                Maximum="100" 
                Value="{Binding InsertBindingHere}" 
                Name="pbStatus" />
   <TextBlock Text="{Binding ElementName=pbStatus, Path=Value, StringFormat={}{0:0}%}" 
           HorizontalAlignment="Center" 
           VerticalAlignment="Center" />
</Grid> 
```

                                                **这是它的样子：**

                                    [![在此处输入图像描述](https://i.stack.imgur.com/OvaW7.png)](https://i.stack.imgur.com/OvaW7.png)

查看[WPF 教程](http://www.wpf-tutorial.com/misc-controls/the-progressbar-control/)以获取完整的帖子。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-09-16T19:23:33.297

如果您需要一种可重用的方法来添加文本，您可以创建一个新的 Style/ControlTemplate，它有一个额外的 TextBlock 来显示文本。您可以劫持 TextSearch.Text 附加属性来设置进度条上的文本。

如果它不需要可重用，只需将进度条放在一个 Grid 中，然后在网格中添加一个 TextBlock。由于 WPF 可以将元素组合在一起，这将很好地工作。

如果需要，您可以创建一个将 ProgressBar 和 TextBlock 公开为公共属性的 UserControl，因此它比创建自定义 ControlTemplate 工作量少。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-16T19:30:56.773

您可以使用 Adorner 在其顶部显示文本。

请参阅[有关装饰器的 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms743737(VS.85).aspx#adorn_single_element)

您将创建一个继承自 Adorner 类的类。重写 OnRender 方法以绘制所需的文本。如果您愿意，可以为您的自定义 Adorner 创建一个依赖属性，其中包含您要显示的文本。然后使用我提到的链接中的示例将此装饰器添加到进度条的装饰器层。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-01-14T03:05:58.507

**具有 2 个属性（值/最大值**）的文本和绑定的进度条：

```
<Grid>
    <ProgressBar Name="pbUsrLvl"
                 Minimum="1" 
                 Maximum="99" 
                 Value="59" 
                 Margin="5"  
                 Height="24"  Foreground="#FF62FF7F"/>
    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center">
        <TextBlock.Text>
            <MultiBinding StringFormat="{}UserLvl:{0}/{1}">
                <Binding Path="Value" ElementName="pbUsrLvl" />
                <Binding Path="Maximum" ElementName="pbUsrLvl" />
            </MultiBinding>
        </TextBlock.Text>
    </TextBlock>
</Grid> 
```

结果：

[![在此处输入图像描述](https://i.stack.imgur.com/cKsaG.png)](https://i.stack.imgur.com/cKsaG.png)

* * *

相同，但**进度百分比**：

```
<Grid>
    <ProgressBar Name="pbLifePassed"
                 Minimum="0" 
                 Value="59" 
                 Maximum="100"
                 Margin="5" Height="24" Foreground="#FF62FF7F"/>
    <TextBlock Text="{Binding ElementName=pbLifePassed, Path=Value, StringFormat={}{0:0}%}" 
           HorizontalAlignment="Center" VerticalAlignment="Center" />
</Grid> 
```

[![在此处输入图像描述](https://i.stack.imgur.com/2irXR.png)](https://i.stack.imgur.com/2irXR.png)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-01-29T09:46:32.947

右键单击`ProgressBar`，然后单击编辑模板 > 编辑副本。

然后在VS生成的Style`TextBlock`中将如下图的结束标记放在上面。`Grid`

```
 <Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="2"/>
   <TextBlock Background="Transparent" Text="work in progress" Foreground="Black" TextAlignment="Center"/>
 </Grid>
 <ControlTemplate.Triggers> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-11-21T09:56:21.307

这是基于给定的答案。由于我使用的是 MahApps Metro，我最终得到了这个：

```
<Grid>
    <metro:MetroProgressBar x:Name="pbar" Value="50" Height="20"></metro:MetroProgressBar>
    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="{Binding ElementName=pbar, Path=Value, StringFormat={}{0:0}%}"></TextBlock>
</Grid> 
```

如果您想使用带有 Metro Style 的普通栏：

```
<Grid>
    <ProgressBar x:Name="pbar" Value="50" Height="20" Style="{StaticResource MetroProgressBar}"></ProgressBar>
    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="{Binding ElementName=pbar, Path=Value, StringFormat={}{0:0}%}"></TextBlock>
</Grid> 
```

没有样式也一样：

```
<Grid>
    <ProgressBar x:Name="pbar" Value="60" Height="20" Style="{x:Null}"></ProgressBar>
    <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="{Binding ElementName=pbar, Path=Value, StringFormat={}{0:0}%}"></TextBlock>
</Grid> 
```

怎么了？

你有你的进度条，只需在上面放置文本。因此，您只需按照自己的方式使用进度条即可。将进度条放在网格中并在其中放置一个文本块。然后，您可以根据需要发送文本或获取当前百分比，即进度条中的值。

# .net - 在.net中使用xsd生成XML

> ID：75935
> 
> 赞同：6
> 
> 时间：2008-09-16T19:20:18.390
> 
> 标签：.net, xml, xsd

我正在一个 .net 应用程序中工作，我们需要根据从数据库中检索到的数据集动态生成 XML 文件。XML 模式应该基于提供的 xsd。我想知道是否有任何方法可以将数据集或每个数据行与 xsd 绑定或关联。我不知道它是否可以完成，或者我可能从错误的角度考虑使用 XSD。如果我错了，请纠正我，让我知道将从 db 检索到的数据关联到预定义模式的最佳方法。谢谢。

更新：如果我对 xsd 的看法是错误的，请说明如何使用 xsd（或者可能指向一些有用的链接）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T19:31:27.083

使用架构文档作为 Visual Studio 附带的命令行 xsd.exe 程序的参数，以生成可以包含在项目/解决方案中的类文件或类型化数据集。这些类或数据集可以序列化为 xml，并符合您用于创建它们的模式文档。

唯一的问题是它不是动态的：您不能等到运行时才能获取架构文件。但是没有内置的东西支持这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:07:35.517

除了 Joel Coehoorn 建议的解决方案——从 XSD 生成类型化数据集或业务实体——让我添加一些其他方法：

1.  如果您使用支持 XML 类型的数据库，如 Oracle 或 MS SQL Server，您可以直接在 SQL 查询中构建 XML，并绕过数据集的填充直接从数据库中检索 XML。
2.  如果您的数据库模式没有直接映射到给定的 XSD，即您已经有一个类型化的数据集或一组可序列化 XML 的业务对象，并且这些对象被序列化为不符合您提供的 XSD 的 XML，然后您可以使用 XSLT 将您的 XML 转换为另一个符合给定 XSD 的 XML 文档。

# c - 如何使用 gcc 将 homepath 导入 c 程序

> ID：75937
> 
> 赞同：1
> 
> 时间：2008-09-16T19:20:22.087
> 
> 标签：c, gcc

我正在为**windows使用****gcc**。操作系统是**windows XP**。如何将 homepath 变量导入我的 c 程序，以便我可以写入 c:\%homepath%\desktop？我想使用类似的东西：

 ****`fd = fopen("C:\\%%homepath%%\\desktop\\helloworld.txt","w")`;

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T19:28:06.547

使用 getenv() 获取环境变量的值，然后使用 sprintf 或 strcat 组合路径。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T19:43:40.363

用于`getenv("homepath")`获取环境变量的值。您应该处理尚未定义变量的情况（在这种情况下`getenv`返回`NULL`）。

组成路径使用`sprintf`

```
char * homepath = getenv("homepath");

if(homepath == null) {
    /* variable HOMEPATH has not been defined */ 
}

sprintf(path,"%s\\desktop\\helloworld.txt",homepath); 
```

您应该使路径足够大以容纳值`homepath`和`\\desktop\\helloworld.txt`.

还要注意`\\`在字符串中的使用。你不能使用单`\`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T23:16:59.677

注意：您实际上还需要获取 HOMEDRIVE 的值，并将其添加到 HOMEPATH。在许多公司环境中，主目录保存在大型网络设备或服务器上。

# javascript - 如何执行动态加载的 JavaScript 块？

> ID：75943
> 
> 赞同：39
> 
> 时间：2008-09-16T19:20:45.177
> 
> 标签：javascript, ajax

我正在一个网页上进行 AJAX 调用，该调用返回一大块 HTML，例如：

```
<div>
  <!-- some html -->
  <script type="text/javascript">
    /** some javascript */
  </script>
</div> 
```

我将整个东西插入到 DOM 中，但 JavaScript 没有运行。有没有办法运行它？

一些细节：我无法控制脚本块中的内容（所以我无法将其更改为可以调用的函数），我只需要执行整个块。我无法对响应调用 eval，因为 JavaScript 位于更大的 HTML 块中。我可以做某种正则表达式来分离出 JavaScript，然后在其上调用 eval，但这很糟糕。有人知道更好的方法吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-16T19:38:57.847

通过设置元素的 innerHTML 属性添加的脚本不会被执行。尝试创建一个新的 div，设置它的 innerHTML，然后将这个新的 div 添加到 DOM。例如：

```
<html>
<头部>
<脚本类型='文本/javascript'>
函数 addScript()
{
    var str = "<script>alert('我在这里');<\/script>";
    var newdiv = document.createElement('div');
    newdiv.innerHTML = str;
    document.getElementById('target').appendChild(newdiv);
}
</脚本>
</head>
<正文>
<input type="button" value="add script" onclick="addScript()"/>
<div>你好世界</div>
<div id="target"></div>
</正文>
</html>

```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-16T19:27:41.633

如果您使用响应来填充 div 或其他内容，则不必使用正则表达式。您可以使用 getElementsByTagName。

```
div.innerHTML = response;
var scripts = div.getElementsByTagName('script');
for (var ix = 0; ix < scripts.length; ix++) {
    eval(scripts[ix].text);
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-02-17T16:37:34.177

虽然@Ed 接受了答案。不适用于当前版本的 Firefox、Google Chrome 或 Safari 浏览器我设法熟练使用他的示例以调用动态添加的脚本。

必要的更改仅在于将脚本添加到 DOM 的方式。而不是添加它作为`innerHTML`技巧是创建一个新的脚本元素并将实际脚本内容添加`innerHTML`到创建的元素，然后将脚本元素附加到实际目标。

```
<html>
<head>
<script type='text/javascript'>
function addScript()
{
    var newdiv = document.createElement('div');

    var p = document.createElement('p');
    p.innerHTML = "Dynamically added text";
    newdiv.appendChild(p);

    var script = document.createElement('script');
    script.innerHTML = "alert('i am here');";
    newdiv.appendChild(script);

    document.getElementById('target').appendChild(newdiv);
}
</script>
</head>
<body>
<input type="button" value="add script" onclick="addScript()"/>
<div>hello world</div>
<div id="target"></div>
</body>
</html> 
```

这适用于 Firefox 42、Google Chrome 48 和 Safari 9.0.3

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T19:36:13.877

另一种方法是不只是使用 InnerHTML 将 Ajax 调用的返回值转储到 DOM 中。

您可以动态插入每个节点，然后脚本将运行。

否则，浏览器只会假定您正在插入一个文本节点，而忽略脚本。

使用 Eval 是相当邪恶的，因为它需要启动另一个 Javascript VM 实例并 JIT 传递的字符串。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T19:33:38.750

最好的方法可能是直接通过 DOM 识别和评估脚本块的内容。

不过我会小心.. 如果您正在实施此操作以克服某些场外呼叫的限制，那么您将打开一个安全漏洞。

你实现的任何东西都可能被用于 XSS。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T20:09:02.550

您可以使用一种流行的 Ajax 库来为您完成此操作。我喜欢[原型](http://www.prototypejs.org/)。您可以将 evalScripts:true 添加为 Ajax 调用的一部分，它会自动发生。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-08-31T20:04:14.077

对于那些喜欢危险生活的人：

```
// This is the HTML with script element(s) we want to inject
var newHtml = '<b>After!</b>\r\n<' +
  'script>\r\nchangeColorEverySecond();\r\n</' +
  'script>';

// Here, we separate the script tags from the non-script HTML
var parts = separateScriptElementsFromHtml(newHtml);

function separateScriptElementsFromHtml(fullHtmlString) {
    var inner = [], outer = [], m;
    while (m = /<script>([^<]*)<\/script>/gi.exec(fullHtmlString)) {
        outer.push(fullHtmlString.substr(0, m.index));
        inner.push(m[1]);
        fullHtmlString = fullHtmlString.substr(m.index + m[0].length);
    }
    outer.push(fullHtmlString);
    return {
        html: outer.join('\r\n'),
        js: inner.join('\r\n')
    };
}

// In 2 seconds, inject the new HTML, and run the JS
setTimeout(function(){
  document.getElementsByTagName('P')[0].innerHTML = parts.html;
  eval(parts.js);
}, 2000);

// This is the function inside the script tag
function changeColorEverySecond() {
  document.getElementsByTagName('p')[0].style.color = getRandomColor();
  setTimeout(changeColorEverySecond, 1000);
}

// Here is a fun fun function copied from:
// https://stackoverflow.com/a/1484514/2413712
function getRandomColor() {
  var letters = '0123456789ABCDEF';
  var color = '#';
  for (var i = 0; i < 6; i++) {
    color += letters[Math.floor(Math.random() * 16)];
  }
  return color;
}
```

```
<p>Before</p>
```

# html - 如何使 Internet Explorer 不更改我的 PNG 图像中的颜色

> ID：75947
> 
> 赞同：12
> 
> 时间：2008-09-16T19:21:19.510
> 
> 标签：html, internet-explorer-7, png, gamma

在我的网站上使用 PNG 文件（使用 Paint.NET 制作）作为背景图像时，IE7 正在更改颜色并实际上显示我的图像的较暗版本，如此[处所示](http://twitpic.com/bud1 "IE7 抖动")。在此图像中，深色背景和背景图像都应为#001122，中等背景和背景图像应为#004466。但是IE7将图像分别更改为#000C1A和#003A5B。FF3没问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T19:28:05.550

IE 有一个已知的 PNG gamma 信息错误，尽管我认为他们已经在版本 7 中修复了它：-？

我使用“PNG Crush”从 PNG 文件中删除了伽马信息。我在 Windows 资源管理器中创建了一个右键单击快捷方式。更多信息：[在 Windows 中使用 pngcrush](http://www.weirdlooking.com/blog/64)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-11T09:18:25.340

PNGOUT 的替代方案是 TweakPNG。自带图形用户界面，无安装程序，很容易删除gAMA（只需右键删除它！）

[http://entropymine.com/jason/tweakpng/](http://entropymine.com/jason/tweakpng/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T19:24:00.473

我认为这与伽玛校正有关。看看这个

[http://www.hanselman.com/blog/GammaCorrectionAndColorCorrectionPNGIsStillTooHard.aspx](http://www.hanselman.com/blog/GammaCorrectionAndColorCorrectionPNGIsStillTooHard.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T20:22:23.110

关于这个问题的其他资源：[http ://www.modernblue.com/web-design-blog/tweak-that-gamma/](http://www.modernblue.com/web-design-blog/tweak-that-gamma/)

# oracle - 如何使用实体框架实现数据库独立性

> ID：75959
> 
> 赞同：8
> 
> 时间：2008-09-16T19:22:33.690
> 
> 标签：oracle, entity-framework, linq-to-entities

我已经使用实体框架启动了一个相当简单的示例项目。在该项目中，我从 SQL Server 2000 数据库创建了一个新的实体数据模型。我能够使用 LINQ to Entities 查询数据并在屏幕上显示值。

我有一个架构极其相似的 Oracle 数据库（我试图准确，但我不知道 Oracle 的所有细节）。我希望我的项目能够轻松地在 SQL Server 和 Oracle 数据存储上运行。我希望我可以简单地更改我的实体数据模型的配置字符串，而实体框架会处理剩下的事情。但是，它似乎不会像我想的那样无缝地工作。

有人做过我想做的事吗？同样，我正在尝试编写一个应用程序，该应用程序可以使用 Entity Framework 以最小的努力从 SQL Server 或 Oracle 数据库中查询（和更新）数据。第二个目标是在数据存储之间来回切换时不必重新编译应用程序。如果我必须“从数据库更新模型”可能没问题，因为我不必重新编译，但我不想走这条路。有谁知道可能需要的任何步骤？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T13:07:19.777

在术语“持久性无知”下通常理解的是，您的实体类没有被框架依赖项淹没（对于 N 层场景很重要）。现在情况并非如此，因为实体类必须实现某些 EF 接口（“IPOCO”），而不是普通的旧 CLR 对象。正如另一位发帖人所提到的，有一个解决方案，称为[实体框架 V1](http://blogs.msdn.com/jkowalski/archive/2008/09/09/persistence-ignorance-poco-adapter-for-entity-framework-v1.aspx)的持久性无知 (POCO) 适配器，EF V2 将支持开箱即用的 POCO。

但我认为您真正想到的是数据库独立性。使用一个包含存储模型、概念模型以及将在设计时生成类型化 ObjectContext 的两者之间的映射的大型配置 XML，我还发现很难想象如何透明地支持两个数据库。

看起来更有希望的是应用一个独立于数据库的 ADO.NET 提供程序，例如来自[DataDirect](http://www.datadirect.com)的提供程序。DataDirect 还宣布了对 2008 年第三季度的 EF 支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T00:45:07.893

[http://blogs.msdn.com/jkowalski/archive/2008/09/09/persistence-ignorance-poco-adapter-for-entity-framework-v1.aspx](http://blogs.msdn.com/jkowalski/archive/2008/09/09/persistence-ignorance-poco-adapter-for-entity-framework-v1.aspx)

主要问题是实体框架的设计没有考虑到持久性无知。老实说，我会考虑使用实体框架以外的东西。

# c# - 如何以及何时放弃在 C# 中使用数组？

> ID：75976
> 
> 赞同：25
> 
> 时间：2008-09-16T19:24:24.997
> 
> 标签：c#, .net, arrays, theory

我一直被告知向数组添加元素是这样的：

> 创建数组 + 1 个元素的空副本，然后将原始数组中的数据复制到其中，然后加载新元素的新数据

如果这是真的，那么由于内存和 CPU 利用率，在需要大量元素活动的场景中使用数组是相反的，对吗？

如果是这种情况，当您要添加大量元素时，您是否应该尽量避免使用数组？您应该改用 iStringMap 吗？如果是这样，如果您需要两个以上的维度并且需要添加大量元素添加，会发生什么情况。您只是受到性能影响还是应该使用其他东西？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-16T19:27:27.453

将泛型`List<T>`视为数组的替代品。它们支持数组所做的大部分事情，包括根据需要分配初始存储大小。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-16T19:34:36.640

这实际上取决于您所说的“添加”。

如果你的意思是：

```
T[] array;
int i;
T value;
...
if (i >= 0 && i <= array.Length)
    array[i] = value; 
```

那么，不，这不会创建新数组，实际上是在 .NET 中更改任何类型 IList 的最快方法。

但是，如果您使用的是 ArrayList、List、Collection 等，那么调用“Add”方法*可能会*创建一个新数组——但他们对此很聪明，他们不只是调整 1 个元素的大小，他们几何增长，所以如果你只是偶尔添加很多值，它必须分配一个新数组。即使那样，如果您知道要添加多少元素，您也可以使用“Capacity”属性来强制它提前增长（`list.Capacity += numberOfAddedElements`）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T19:29:20.460

一般来说，我更喜欢避免使用数组。只需使用列表<T>。它在内部使用动态大小的数组，并且对于大多数用途来说足够快。如果您使用多维数组，请在必要时使用 List<List<List<T>>>。它在内存方面并没有那么糟糕，并且添加项目要简单得多。

如果您在 0.1% 的使用量中需要极速，请确保在尝试优化之前确实是您的列表访问问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T19:30:50.533

如果您要大量添加/删除元素，只需使用 List。如果它是多维的，您总是可以使用 List<List<int>> 或其他东西。

另一方面，如果您主要做的是*遍历*列表，则列表的效率低于数组，因为数组都位于 CPU 缓存中的一个位置，而列表中的对象分散在各处。

如果您想使用数组进行高效阅读，但您要经常“添加”元素，您有两个主要选择：

1) 将其生成为 List（或 List of Lists），然后使用 ToArray() 将其转换为高效的数组结构。

2) 将数组分配为比您需要的更大，然后将对象放入预先分配的单元格中。如果您最终需要比预分配更多的元素，您可以在数组填满时重新分配，每次将大小加倍。这给了 O(log n) 调整大小的性能，而不是 O(n)，就像使用 reallocate-once-per-add 数组一样。请注意，这几乎就是 StringBuilder 的工作方式，为您提供了一种更快的方式来不断地追加到字符串。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-11-11T13:23:52.467

> 何时放弃使用数组

1.  首先，*当数组的语义与您的意图**不***匹配时- 需要动态增长的集合？不允许重复的集合？一个必须保持不变的集合？在所有情况下都避免使用数组。这是 99% 的情况。只是陈述明显的基本观点。

2.  其次，*当您**没有**为绝对的性能关键性进行编码*时- 这大约是 95% 的情况。[数组性能*稍微*](https://stackoverflow.com/questions/1168915/which-one-is-more-efficient-listint-or-int)好一点，[尤其是在迭代中](https://stackoverflow.com/questions/454916/performance-of-arrays-vs-lists)。它几乎总是无关紧要。

3.  *当您**没有**被带有`params`关键字*的参数所强迫时- 我只是希望`params`接受任何`IEnumerable<T>`甚至更好的语言构造本身来表示*序列*（而不是框架类型）。

4.  *当您**不**编写遗留代码或处理互操作时*

简而言之，您实际上需要一个数组是非常罕见的。我会补充一点，为什么人们可以避免它？

1.  避免使用数组 imo 的最大原因是概念性的。数组更接近实现，远离抽象。数组传达了更多*如何完成而不是完成*了*什么*这违背了高级语言的精神。这并不奇怪，考虑到数组更接近金属，它们直接来自一种特殊类型（尽管内部数组是一个类）。不是教学法，但数组确实可以转换为非常罕见的语义含义。最有用和最常见的语义是具有任何条目的集合、具有不同项目的集合、键值映射等，以及可添加、只读、不可变、尊重顺序的变体的任意组合。想一想，您可能想要一个可添加的集合，或者带有预定义项目的只读集合，无需进一步修改，但是您的逻辑多久看起来像“我想要一个动态可添加的集合，但只有固定数量的集合，它们也应该是可修改的“？我会说非常罕见。

2.  Array 是在前泛型时代设计的，它通过大量运行时黑客来模仿泛型，它会在这里和那里展示它的古怪之处。我发现的一些问题：

    1.  [破坏的协方差。](https://stackoverflow.com/questions/4317459/why-is-array-co-variance-considered-so-horrible)

        ```
        string[] strings = ...
        object[] objects = strings;
        objects[0] = 1; //compiles, but gives a runtime exception. 
        ```

    2.  [数组可以为您提供对结构的引用！](https://stackoverflow.com/questions/6705583/indexers-in-list-vs-array). 这与其他任何地方都不一样。一个样品：

        ```
        struct Value { public int mutable; }

        var array = new[] { new Value() };  
        array[0].mutable = 1; //<-- compiles !
        //a List<Value>[0].mutable = 1; doesnt compile since editing a copy makes no sense
        print array[0].mutable // 1, expected or unexpected? confusing surely 
        ```

    3.  [`ICollection<T>.Contains`对于 structs 和 classes ，运行时实现的方法](https://stackoverflow.com/questions/19888123/t-contains-for-struct-and-class-behaving-differently)可能会有所不同。这没什么大不了的，但是如果您忘记为期望泛型集合查找泛型的引用类型正确覆盖*非泛型`Equals`**，`Equals`*您将得到不正确的结果。

        ```
        public class Class : IEquatable<Class>
        {
            public bool Equals(Class other)
            {
                Console.WriteLine("generic");
                return true;
            }
            public override bool Equals(object obj)
            {
                Console.WriteLine("non generic");
                return true;
            } 
        }

        public struct Struct : IEquatable<Struct>
        {
            public bool Equals(Struct other)
            {
                Console.WriteLine("generic");
                return true;
            }
            public override bool Equals(object obj)
            {
                Console.WriteLine("non generic");
                return true;
            } 
        }

        class[].Contains(test); //prints "non generic"
        struct[].Contains(test); //prints "generic" 
        ```

    4.  上的`Length`属性和`[]`索引器`T[]`似乎是您可以通过反射访问的常规属性（这应该涉及一些魔法），但是当涉及到表达式树时，您必须吐出与编译器完全相同的代码。有单独`ArrayLength`的`ArrayIndex`方法可以做到这一点。这里有一个这样[的问题](https://stackoverflow.com/questions/19336342/how-to-get-memberinfo-of-arraylength-type-expressions)。另一个例子：

        ```
        Expression<Func<string>> e = () => new[] { "a" }[0];
        //e.Body.NodeType == ExpressionType.ArrayIndex

        Expression<Func<string>> e = () => new List<string>() { "a" }[0];
        //e.Body.NodeType == ExpressionType.Call; 
        ```

> 如何放弃使用数组

最常用的替代品是`List<T>`具有更简洁的 API。但它是一个动态增长的结构，这意味着您可以`List<T>`在末尾添加 a 或在任何位置插入任何容量。无法替代数组的确切行为，但人们大多将数组用作只读集合，您无法在其末尾添加任何内容。一个替代品是`ReadOnlyCollection<T>`。我进行了这种扩展方法：

```
public ReadOnlyCollection<T> ToReadOnlyCollection<T>(IEnumerable<T> source)
{
    return source.ToList().AsReadOnly();
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T19:26:56.550

调整数组大小时，必须分配一个新数组并复制内容。如果只是修改数组的内容，那只是内存分配。

因此，当您不知道数组的大小时，不应该使用数组，否则大小可能会发生变化。但是，如果您有一个固定长度的数组，它们是一种通过索引检索元素的简单方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-16T19:29:24.250

ArrayList 和 List 在需要时将数组增加一倍以上（我认为这是通过将大小增加一倍，但我没有检查源）。当您构建动态大小的数组时，它们通常是最佳选择。

当您的基准测试表明数组调整大小严重拖慢了您的应用程序时（请记住 - 过早优化是万恶之源），您可以评估编写自定义数组类并调整调整大小行为。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-16T20:16:17.163

通常，如果您必须拥有最好的索引查找性能，最好先构建一个列表，然后将其转换为一个数组，这样一开始会付出一点代价，但以后要避免。如果问题是您将不断添加新数据和删除旧数据，那么您可能希望使用 ArrayList 或 List 方便，但请记住它们只是特殊情况下的数组。当它们“增长”时，它们分配一个全新的数组并将所有内容复制到其中，这非常慢。

[ArrayList](http://blogs.msdn.com/bclteam/articles/273454.aspx)只是一个在需要时增长的数组。Add 是摊销 O(1)，只是要小心确保调整大小不会在错误的时间发生。插入是 O(n) 必须将右侧的所有项目移过来。删除是 O(n) 必须将右侧的所有项目移过。

同样重要的是要记住 List 不是链表。它只是一个类型化的 ArrayList。List[文档](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)确实指出它在大多数情况下表现更好，但没有说明原因。

最好的办法是选择适合您的问题的数据结构。这取决于很多事情，因此您可能想要浏览[System.Collections.Generic](http://msdn.microsoft.com/en-us/library/system.collections.generic.aspx)命名空间。

在这种特殊情况下，我会说如果你能想出一个好的键值[字典](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)将是你最好的选择。它具有接近 O(1) 的插入和删除。但是，即使使用 Dictionary，您也必须小心不要让它调整其内部数组的大小（O(n) 操作）。最好通过在构造函数中指定比您预期使用的更大的初始容量来给它们很大的空间。

-瑞克

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T19:27:47.453

你能做的最好的事情是尽可能多地分配你需要的内存。这将防止[.NET](http://en.wikipedia.org/wiki/.NET_Framework)不得不进行额外的调用来获取堆上的内存。如果做不到这一点，那么以五个或任何对您的应用程序有意义的数量进行分配是有意义的。

这是一条可以真正应用于任何事物的规则。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T19:28:02.333

标准数组应该定义一个长度，它在一个连续的块中保留它需要的所有内存。向数组中添加一个项目会将其放入已保留的内存块中。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-16T19:29:33.797

数组非常适合少量写入和多次读取，尤其是那些具有迭代性质的 - 对于其他任何事情，请使用许多其他数据结构中的一种。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-16T19:33:56.627

你是对的，数组非常适合查找。然而，对数组大小的修改代价高昂。

在修改数组大小的场景中，您应该使用支持增量大小调整的容器。您可以使用允许您设置初始大小的 ArrayList，并且您可以不断检查大小与容量，然后将容量增加一个大块以限制调整大小的数量。

或者你可以只使用一个链表。然后，但是查找速度很慢...

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-16T20:07:13.987

如果我认为我将在集合的整个生命周期中向集合中添加很多项目，那么我将使用列表。如果我确定声明集合时集合的大小是多少，那么我将使用一个数组。

另一次我通常在 List 上使用数组是当我需要将集合作为对象的属性返回时 - 我不希望调用者通过 List 的 Add 方法添加该集合的项目，而是希望他们将项目添加到集合中通过我的对象的界面。在这种情况下，我将使用内部 List 并调用 ToArray 并返回一个数组。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-16T20:21:07.730

如果您要进行大量添加，*并且*不会进行随机访问（例如`myArray[i]`）。您可以考虑使用链表 ( `LinkedList<T>`)，因为它永远不会像`List<T>`实现一样“增长”。但是请记住，您只能`LinkedList<T>`使用`IEnumerable<T>`接口真正访问实现中的项目。

# c# - 在不同于二进制文件的位置访问 App.config

> ID：75978
> 
> 赞同：5
> 
> 时间：2008-09-16T19:24:31.190
> 
> 标签：c#

在 .NET Win 控制台应用程序中，我想访问与控制台应用程序二进制文件不同的位置的 App.config 文件。例如，C:\bin\Text.exe 如何从 C:\Test.exe.config 获取其设置？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-16T19:37:39.910

```
using System.Configuration;    

Configuration config =
ConfigurationManager.OpenExeConfiguration("C:\Test.exe"); 
```

然后，您可以从配置实例访问应用程序设置、连接字符串等。这当然假设配置文件格式正确并且您的应用程序具有对该目录的读取权限。注意路径***不是***“C:\Test.exe.config” 该方法查找与您指定的文件关联的配置文件。如果您指定“C:\Test.exe.config”，它会寻找“C:\Test.exe.config.config” 有点蹩脚，但我猜是可以理解的。

参考这里：http: [//msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.openexeconfiguration.aspx](http://msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.openexeconfiguration.aspx)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-08-13T19:56:24.907

看来您可以使用该[`AppDomain.SetData`](http://msdn.microsoft.com/en-us/library/37z40s1c.aspx)方法来实现这一点。该文档指出：

> 您不能使用此方法插入或修改系统条目。

无论如何，这样做似乎确实有效。该[`AppDomain.GetData`](http://msdn.microsoft.com/en-us/library/system.appdomain.getdata.aspx)方法的文档列出了可用的系统条目，感兴趣的是`"APP_CONFIG_FILE"`条目。

如果我们`"APP_CONFIG_FILE"`在使用任何应用程序设置之前设置，我们可以修改`app.config`从哪里加载。例如：

```
public class Program
{
    public static void Main()
    {
        AppDomain.CurrentDomain.SetData("APP_CONFIG_FILE", @"C:\Temp\test.config");
        //...
    }
} 
```

我发现这个解决方案记录在[这个博客](http://weblogs.asp.net/israelio/archive/2005/01/10/349825.aspx)中，更完整的答案（相关问题）可以在[这里](https://stackoverflow.com/a/6151688/142794)找到。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-16T19:35:59.367

使用以下（记得包括 System.Configuration 程序集）

```
ConfigurationManager.OpenExeConfiguration(exePath) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T19:36:24.780

您可以通过创建一个新的应用程序域来设置它：

```
AppDomainSetup domainSetup = new AppDomainSetup();
domainSetup.ConfigurationFile = fileLocation;
AppDomain add = AppDomain.CreateDomain("myNewAppDomain", securityInfo, domainSetup); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-06-02T04:10:25.267

```
AppDomainSetup domainSetup = new AppDomainSetup();
        domainSetup.ConfigurationFile = @"D:\Mine\Company\";
        string browserName = ConfigurationManager.AppSettings["browser"]; 
```

# javascript - 你什么时候应该使用转义而不是 encodeURI / encodeURIComponent？

> ID：75980
> 
> 赞同：1472
> 
> 时间：2008-09-16T19:24:34.730
> 
> 标签：javascript, encoding, query-string

编码要发送到 Web 服务器的查询字符串时 - 您何时使用`escape()`以及何时使用`encodeURI()`or `encodeURIComponent()`：

使用转义：

```
escape("% +&="); 
```

或者

使用 encodeURI() / encodeURIComponent()

```
encodeURI("http://www.google.com?var1=value1&var2=value2");

encodeURIComponent("var1=value1&var2=value2"); 
```

* * *

## 回答 #1

> 赞同：1980
> 
> 时间：2010-08-31T12:04:17.180

# 逃脱（）

不要使用它！ [在B.2.1.2](https://www.ecma-international.org/ecma-262/9.0/index.html#sec-escape-string)`escape()`节中定义了转义，附件 B的[介绍文本](https://www.ecma-international.org/ecma-262/9.0/index.html#sec-additional-ecmascript-features-for-web-browsers)说：

> ... 本附件中规定的所有语言特征和行为都有一个或多个不受欢迎的特征，在没有遗留使用的情况下，将从本规范中删除。...
> ... 程序员在编写新的 ECMAScript 代码时不应使用或假设存在这些特性和行为......

行为：

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/escape](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/escape)

特殊字符被编码，除了：@*_+-./

字符的十六进制形式，其代码单元值为 0xFF 或更小，是一个两位数的转义序列：`%xx`.

对于具有更大代码单元的字符，使用四位数格式`%uxxxx`。这在查询字符串中是不允许的（在[RFC3986](https://www.rfc-editor.org/rfc/rfc3986#section-3.4)中定义）：

```
query       = *( pchar / "/" / "?" )
pchar         = unreserved / pct-encoded / sub-delims / ":" / "@"
unreserved    = ALPHA / DIGIT / "-" / "." / "_" / "~"
pct-encoded   = "%" HEXDIG HEXDIG
sub-delims    = "!" / "$" / "&" / "'" / "(" / ")"
              / "*" / "+" / "," / ";" / "=" 
```

百分号仅在直接后跟两个十六进制数字时才允许使用，不允许百分号后跟`u`。

# 编码URI()

如果您想要一个工作 URL，请使用 encodeURI。拨打此电话：

```
encodeURI("http://www.example.org/a file with spaces.html") 
```

要得到：

```
http://www.example.org/a%20file%20with%20spaces.html 
```

不要调用 encodeURIComponent ，因为它会破坏 URL 并返回

```
http%3A%2F%2Fwww.example.org%2Fa%20file%20with%20spaces.html 
```

请注意，与 encodeURIComponent 一样，encodeURI 不会转义 ' 字符。

# 编码URIComponent()

如果要对 URL 参数的值进行编码，请使用 encodeURIComponent。

```
var p1 = encodeURIComponent("http://example.org/?a=12&b=55") 
```

然后你可以创建你需要的 URL：

```
var url = "http://example.net/?param1=" + p1 + "&param2=99"; 
```

你会得到这个完整的 URL：

`http://example.net/?param1=http%3A%2F%2Fexample.org%2F%Ffa%3D12%26b%3D55&param2=99`

请注意，encodeURIComponent 不会转义`'`字符。一个常见的错误是使用它来创建 html 属性，例如`href='MyUrl'`，这可能会遭受注入错误。如果您从字符串构造 html，请使用`"`而不是`'`for 属性引号，或者添加额外的编码层（`'`可以编码为 %27）。

有关此类编码的更多信息，您可以查看：[http ://en.wikipedia.org/wiki/Percent-encoding](http://en.wikipedia.org/wiki/Percent-encoding)

* * *

## 回答 #2

> 赞同：475
> 
> 时间：2014-05-24T06:54:51.143

`encodeURI()`和之间的区别`encodeURIComponent()`恰好是由 encodeURIComponent 编码但不是由 encodeURI 编码的 11 个字符：

![encodeURI 和 encodeURIComponent 的十个区别表](https://i.imgur.com/rHWC1r1.png)

我使用以下代码在 Google Chrome 中使用**console.table**轻松生成了此表：

```
var arr = [];
for(var i=0;i<256;i++) {
  var char=String.fromCharCode(i);
  if(encodeURI(char)!==encodeURIComponent(char)) {
    arr.push({
      character:char,
      encodeURI:encodeURI(char),
      encodeURIComponent:encodeURIComponent(char)
    });
  }
}
console.table(arr);
```

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2012-10-09T09:26:43.437

我发现这篇文章很有启发性： [Javascript Madness: Query String Parsing](http://unixpapa.com/js/querystring.html)

当我试图理解为什么 decodeURIComponent 没有正确解码“+”时，我发现了它。这是一个摘录：

```
String:                         "A + B"
Expected Query String Encoding: "A+%2B+B"
escape("A + B") =               "A%20+%20B"     Wrong!
encodeURI("A + B") =            "A%20+%20B"     Wrong!
encodeURIComponent("A + B") =   "A%20%2B%20B"   Acceptable, but strange

Encoded String:                 "A+%2B+B"
Expected Decoding:              "A + B"
unescape("A+%2B+B") =           "A+++B"       Wrong!
decodeURI("A+%2B+B") =          "A+++B"       Wrong!
decodeURIComponent("A+%2B+B") = "A+++B"       Wrong! 
```

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2013-05-08T07:51:13.737

encodeURIComponent 不编码`-_.!~*'()`，导致在 xml 字符串中将数据发布到 php 时出现问题。

例如：
`<xml><text x="100" y="150" value="It's a value with single quote" /> </xml>`

一般逃生用`encodeURI`
`%3Cxml%3E%3Ctext%20x=%22100%22%20y=%22150%22%20value=%22It's%20a%20value%20with%20single%20quote%22%20/%3E%20%3C/xml%3E`

可以看到，单引号没有编码。为了解决问题，我创建了两个函数来解决我的项目中的问题，用于编码 URL：

```
function encodeData(s:String):String{
    return encodeURIComponent(s).replace(/\-/g, "%2D").replace(/\_/g, "%5F").replace(/\./g, "%2E").replace(/\!/g, "%21").replace(/\~/g, "%7E").replace(/\*/g, "%2A").replace(/\'/g, "%27").replace(/\(/g, "%28").replace(/\)/g, "%29");
} 
```

对于解码 URL：

```
function decodeData(s:String):String{
    try{
        return decodeURIComponent(s.replace(/\%2D/g, "-").replace(/\%5F/g, "_").replace(/\%2E/g, ".").replace(/\%21/g, "!").replace(/\%7E/g, "~").replace(/\%2A/g, "*").replace(/\%27/g, "'").replace(/\%28/g, "(").replace(/\%29/g, ")"));
    }catch (e:Error) {
    }
    return "";
} 
```

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2008-09-16T19:26:22.293

encodeURI() - escape() 函数用于 javascript 转义，而不是 HTTP。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2015-10-08T15:20:20.967

小型比较表 Java vs. JavaScript vs. PHP。

```
1\. Java URLEncoder.encode (using UTF8 charset)
2\. JavaScript encodeURIComponent
3\. JavaScript escape
4\. PHP urlencode
5\. PHP rawurlencode

char   JAVA JavaScript --PHP---
[ ]     +    %20  %20  +    %20
[!]     %21  !    %21  %21  %21
[*]     *    *    *    %2A  %2A
[']     %27  '    %27  %27  %27 
[(]     %28  (    %28  %28  %28
[)]     %29  )    %29  %29  %29
[;]     %3B  %3B  %3B  %3B  %3B
[:]     %3A  %3A  %3A  %3A  %3A
[@]     %40  %40  @    %40  %40
[&]     %26  %26  %26  %26  %26
[=]     %3D  %3D  %3D  %3D  %3D
[+]     %2B  %2B  +    %2B  %2B
[$]     %24  %24  %24  %24  %24
[,]     %2C  %2C  %2C  %2C  %2C
[/]     %2F  %2F  /    %2F  %2F
[?]     %3F  %3F  %3F  %3F  %3F
[#]     %23  %23  %23  %23  %23
[[]     %5B  %5B  %5B  %5B  %5B
[]]     %5D  %5D  %5D  %5D  %5D
----------------------------------------
[~]     %7E  ~    %7E  %7E  ~
[-]     -    -    -    -    -
[_]     _    _    _    _    _
[%]     %25  %25  %25  %25  %25
[\]     %5C  %5C  %5C  %5C  %5C
----------------------------------------
char  -JAVA-  --JavaScript--  -----PHP------
[ä]   %C3%A4  %C3%A4  %E4     %C3%A4  %C3%A4
[ф]   %D1%84  %D1%84  %u0444  %D1%84  %D1%84 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2014-04-23T16:54:17.263

我建议不要按原样使用其中一种方法。编写你自己的函数来做正确的事情。

MDN 给出了一个很好的 url 编码示例，如下所示。

```
var fileName = 'my file(2).txt';
var header = "Content-Disposition: attachment; filename*=UTF-8''" + encodeRFC5987ValueChars(fileName);

console.log(header); 
// logs "Content-Disposition: attachment; filename*=UTF-8''my%20file%282%29.txt"

function encodeRFC5987ValueChars (str) {
    return encodeURIComponent(str).
        // Note that although RFC3986 reserves "!", RFC5987 does not,
        // so we do not need to escape it
        replace(/['()]/g, escape). // i.e., %27 %28 %29
        replace(/\*/g, '%2A').
            // The following are not required for percent-encoding per RFC5987, 
            //  so we can allow for a little better readability over the wire: |`^
            replace(/%(?:7C|60|5E)/g, unescape);
} 
```

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2017-04-21T07:55:51.573

出于编码 javascript 的目的，它提供了三个内置函数 -

1.  `escape()`- 不编码`@*/+` 此方法在 ECMA 3 之后已弃用，因此应避免使用。

2.  `encodeURI()`- 不编码`~!@#$&*()=:/,;?+'` 它假定 URI 是一个完整的 URI，因此不对 URI 中具有特殊含义的保留字符进行编码。当意图转换完整的 URL 而不是某些特殊的 URL 段时，使用此方法。示例 -`encodeURI('http://stackoverflow.com');` 将给出 - [http://stackoverflow.com](http://stackoverflow.com)

3.  `encodeURIComponent()`- 不编码 `- _ . ! ~ * ' ( )` 此函数通过将某些字符的每个实例替换为表示字符的 UTF-8 编码的一个、两个、三个或四个转义序列来对统一资源标识符 (URI) 组件进行编码。此方法应用于转换 URL 的组件。例如，需要附加一些用户输入示例 -`encodeURIComponent('http://stackoverflow.com');` 将给出 - http%3A%2F%2Fstackoverflow.com

*所有这些编码都以 UTF 8 执行，即字符将转换为 UTF-8 格式。*

***encodeURIComponent 与 encodeURI 的不同之处在于它对保留字符和数字符号 # of encodeURI 进行编码***

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-09-16T19:40:32.850

还要记住，它们都对不同的字符集进行编码，并适当地选择您需要的字符集。encodeURI() 编码的字符比 encodeURIComponent() 编码的字符少，而 encodeURIComponent() 编码的字符比 escape() 编码的字符少（而且在 dannyp 的观点上也不同）。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2020-06-17T18:48:06.950

只是尝试`encodeURI()`和`encodeURIComponent()`你自己...

```
console.log(encodeURIComponent('@#$%^&*'));
```

输入：`@#$%^&*`。输出：`%40%23%24%25%5E%26*`。所以，等等，发生了什么事`*`？为什么没有转换？如果您尝试这样做，肯定会导致问题`linux command "$string"`。TLDR：您实际上想要[`fixedEncodeURIComponent()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)和[`fixedEncodeURI()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI)。很长的故事...

***何时使用`encodeURI()`？*** 绝不。 `encodeURI()`在括号编码方面未能遵守 RFC3986。[**按照MDN encodeURI() 文档**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI)`fixedEncodeURI()`中的定义和进一步说明使用...[](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI)

 **> ```
> function fixedEncodeURI(str) {
>    return encodeURI(str).replace(/%5B/g, '[').replace(/%5D/g, ']');
> } 
> ```

***何时使用`encodeURIComponent()`？*** 绝不。 `encodeURIComponent()`在编码方面未能遵守 RFC3986`!'()*`：. [**按照MDN encodeURIComponent() 文档**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)`fixedEncodeURIComponent()`中的定义和进一步说明使用...[](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)

 **> ```
> function fixedEncodeURIComponent(str) {
>  return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
>    return '%' + c.charCodeAt(0).toString(16);
>  });
> } 
> ```

然后您可以使用`fixedEncodeURI()`对单个 URL 片段进行编码，而`fixedEncodeURIComponent()`将对 URL 片段和连接器进行编码；或者，简单地说，`fixedEncodeURI()`不会编码`+@?=:#;,$&`（作为常见的 URL 运算符），但`&`会。`+``fixedEncodeURIComponent()`

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-08-08T12:34:09.147

我发现尝试各种方法是一种很好的健全性检查，即使在很好地掌握了它们的各种用途和功能之后也是如此。

为此，我发现[这个网站](http://www.the-art-of-web.com/javascript/escape/)非常有用，可以证实我的怀疑，即我正在做一些适当的事情。它还被证明对解码编码URIComponent 的字符串很有用，这可能很难解释。一个很棒的书签：

[http://www.the-art-of-web.com/javascript/escape/](http://www.the-art-of-web.com/javascript/escape/)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-09-27T06:56:16.080

接受的答案很好。扩展最后一部分：

> 请注意，encodeURIComponent 不会转义 ' 字符。一个常见的错误是使用它来创建 html 属性，例如 href='MyUrl'，这可能会遭受注入错误。如果您从字符串构造 html，请使用 " 而不是 ' 作为属性引号，或者添加额外的编码层（' 可以编码为 %27）。

如果您想安全起见，也应该[对未保留字符的百分比编码](https://en.wikipedia.org/wiki/Percent-encoding#Percent-encoding_unreserved_characters)进行编码。

您可以使用此方法来逃避它们（来源[Mozilla](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)）

```
function fixedEncodeURIComponent(str) {
  return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
    return '%' + c.charCodeAt(0).toString(16);
  });
}

// fixedEncodeURIComponent("'") --> "%27" 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2019-02-11T11:56:19.273

受到[Johann 表的](https://stackoverflow.com/questions/75980/when-are-you-supposed-to-use-escape-instead-of-encodeuri-encodeuricomponent/23842171#23842171)启发，我决定扩展表。我想看看哪些 ASCII 字符被编码。

[![console.table 的截图](https://i.stack.imgur.com/gjKxF.png)](https://i.stack.imgur.com/gjKxF.png)

```
var ascii = " !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";

var encoded = [];

ascii.split("").forEach(function (char) {
    var obj = { char };
    if (char != encodeURI(char))
        obj.encodeURI = encodeURI(char);
    if (char != encodeURIComponent(char))
        obj.encodeURIComponent = encodeURIComponent(char);
    if (obj.encodeURI || obj.encodeURIComponent)
        encoded.push(obj);
});

console.table(encoded);
```

表仅显示编码字符。空单元格表示原始字符和编码字符相同。

* * *

只是为了额外，我正在为[`urlencode()`](http://php.net/manual/en/function.urlencode.php)vs添加另一个表[`rawurlencode()`](http://php.net/manual/en/function.rawurlencode.php)。唯一的区别似乎是空格字符的编码。

[![console.table 的截图](https://i.stack.imgur.com/gJnmU.png)](https://i.stack.imgur.com/gJnmU.png)

```
<script>
<?php
$ascii = str_split(" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~", 1);
$encoded = [];
foreach ($ascii as $char) {
    $obj = ["char" => $char];
    if ($char != urlencode($char))
        $obj["urlencode"] = urlencode($char);
    if ($char != rawurlencode($char))
        $obj["rawurlencode"] = rawurlencode($char);
    if (isset($obj["rawurlencode"]) || isset($obj["rawurlencode"]))
        $encoded[] = $obj;
}
echo "var encoded = " . json_encode($encoded) . ";";
?>
console.table(encoded);
</script> 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-02-09T01:45:03.073

@johann-echavarria 答案的现代重写：

```
console.log(
    Array(256)
        .fill()
        .map((ignore, i) => String.fromCharCode(i))
        .filter(
            (char) =>
                encodeURI(char) !== encodeURIComponent(char)
                    ? {
                          character: char,
                          encodeURI: encodeURI(char),
                          encodeURIComponent: encodeURIComponent(char)
                      }
                    : false
        )
)
```

或者，如果您可以使用表格，请替换`console.log`为`console.table`（用于更漂亮的输出）。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-06-21T12:39:51.527

我有这个功能...

```
var escapeURIparam = function(url) {
    if (encodeURIComponent) url = encodeURIComponent(url);
    else if (encodeURI) url = encodeURI(url);
    else url = escape(url);
    url = url.replace(/\+/g, '%2B'); // Force the replacement of "+"
    return url;
}; 
```***********************