# StackOverflow 问答 1010000-1010999

# mfc - MFC：GetCurrentDirectory 函数

> ID：1010002
> 
> 赞同：8
> 
> 时间：2009-06-17T23:19:46.987
> 
> 标签：mfc

我知道 GetCurrentDirectory() 和 SetCurrentDirectory() 函数存在于 MFC 框架中，但我的应用程序中没有 CFtpConnection 对象。我有一个简单的 CWinApp 派生类，我想在程序启动时检索它的工作目录。实现这一目标的最简单方法是什么？提前感谢您的建议。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-17T23:36:59.213

GetCurrentDirectory 是一个简单的 Win32 API 函数，因此只需像这样调用它：

```
TCHAR currentDir[MAX_PATH];
GetCurrentDirectory( MAX_PATH, currentDir ); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-05-02T18:31:54.730

我假设您正在尝试获取 .exe 文件所在的目录，而不是当前目录。此目录可以与当前目录不同。

```
 TCHAR buff[MAX_PATH];
    memset(buff, 0, MAX_PATH);
    ::GetModuleFileName(NULL,buff,sizeof(buff));    
    CString strFolder = buff;
    strFolder = strFolder.Left(strFolder.ReverseFind(_T('\\'))+1); 
```

# design-patterns - UML：有人可以为我解释一下工厂方法图吗？

> ID：1010007
> 
> 赞同：0
> 
> 时间：2009-06-17T23:22:37.993
> 
> 标签：design-patterns, uml, factory-method

我不知道从 ConcreteCreator 到 ConcreteProduct 的断箭头是什么意思。我在互联网上搜索，我想出了“依赖”。有人可以用外行的方式解释依赖关系吗？谢谢！

[![替代文字](../Images/89bc36d7e89815a246050c242e1de735.png)](https://i.stack.imgur.com/e20S6.gif)

图片来自[http://www.dofactory.com/Patterns/PatternFactory.aspx](http://www.dofactory.com/Patterns/PatternFactory.aspx)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-17T23:28:55.703

正如您正确指出的那样，虚线表示 ConcreteCreator（作为依赖或客户元素）和 ConcreteProduct（作为独立或供应商元素）之间的依赖关系。

在这种特定情况下，该行表示 ConcreteCreator 负责创建 ConcreteProduct 的实例。通过将“创建”构造型附加到依赖项可以更清楚地说明这一点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-17T23:43:04.020

虚线/空箭头表示依赖关系，这意味着 ConcreteCreator 以某种方式“使用”ConcreteProduct。箭头本身并没有定义依赖的性质，只是存在依赖并且 ConcreteProduct 实际上不是 ConcreteCreator 的成员。

提供的注释（即“返回新的 ConcreteProduct”）暗示 ConcreteCreator 将实例化（或创建）类型为 ConcreteProduct 的对象，这对于工厂来说是很自然的。传统上，在 UML 中，您可以通过在虚线箭头上写“<<creates>>”来阐明这种关系。UML 将这些注释称为“刻板印象”。

有关更多信息，请参阅[Allen Holub 的 UML 快速参考](http://www.holub.com/goodies/uml/)。您可以看到他有一个非常相似的示例，其中“用户”创建“资源”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-17T23:28:07.483

我认为这意味着 ConcreteCreator 必须知道 ConcreteProduct 是什么才能创建它，所以那里有一个明确的依赖关系。工厂方法创建一个产品，但该方法的 ConcreteCreator 覆盖必须返回一个 ConcreteProduct。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-17T23:30:53.063

这不仅仅是工厂方法——这看起来更像是抽象工厂模式。Creator 的特定具体派生类将创建派生 Product 类的相应实例。

# vb.net - VB.net 中的 DataGridView 不允许我更新

> ID：1010011
> 
> 赞同：0
> 
> 时间：2009-06-17T23:25:53.103
> 
> 标签：vb.net, datagridview

我有一个 datagridview 作为 dataSource 的 dataTable。用户可以向 datagridview 添加新行，但我不显示主键列（出于显而易见的原因）并将其设置为`.visible = false`. 当我需要将datagridview中的信息更新到数据库中时，我使用`sqlClient.SqlCommandBuilder`来更新底层数据源（上面提到的dataTable）。

现在，因为隐藏列是主键，所以我循环遍历 datagridview 并以编程方式将所需的主键字段添加到尚未包含主键的每个新行（用户添加的行）。这在 95% 的时间里都很好用……

问题是当用户以某种方式在某个点（任何点）将焦点放在 datagridview 上的底行，在他们添加的行下方，用于添加新行。update 命令给了我一个错误，指出它不能将 null 插入主键字段，即使在检查每一行中的所有值时，它们中的任何一个都绝对不是 null。

我试图捕获`row.isNewRow`（因为该字段从不显示为空）并删除该行，但我收到一条错误消息，指出我无法删除未提交的行。如果焦点从未放在现有行和用户添加的行下方的空行上，则更新工作正常。

到底是怎么回事？！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-04-15T17:00:46.877

听起来您的代码正试图从数据库中删除空白的新行——但它还没有在数据库中；它是“分离的”，并且只是在 DataGridView 的内存中......所以这就是你需要删除它的地方。您可以在验证事件中使用一行来执行此操作，这当然会（或应该）在您保存之前调用。

处理此问题的一种方法是提示用户完全填写新行：

```
Private Sub dataGridView1_RowValidating(ByVal sender As Object, ByVal e As DataGridViewCellCancelEventArgs)
    If dataGridView1.Rows(e.RowIndex) IsNot Nothing AndAlso Not dataGridView1.Rows(e.RowIndex).IsNewRow Then
        Dim [error] As String = ""

        If dataGridView1.Rows(e.RowIndex).Cells("Field1").Value Is Nothing OrElse dataGridView1.Rows(e.RowIndex).Cells("Field1").Value.ToString().Trim() = "" Then
            [error] += " * Field #1" & vbLf
        End If

        If dataGridView1.Rows(e.RowIndex).Cells("Field2").Value Is Nothing OrElse dataGridView1.Rows(e.RowIndex).Cells("Field2").Value.ToString().Trim() = "" Then
            [error] += " * Field #2" & vbLf
        End If

        If [error] <> "" Then
            MessageBox.Show("The following required fields were left blank:" & vbLf & vbLf & [error], "Row Validation Error", MessageBoxButtons.OK, MessageBoxIcon.[Error])
            e.Cancel = True
        End If
    End If
End Sub 
```

另一种处理方法是从 DataGridView 中删除（空）行：

```
Private Sub dataGridView1_RowValidating(ByVal sender As Object, ByVal e As DataGridViewCellCancelEventArgs)
    If dataGridView1.Rows(e.RowIndex) IsNot Nothing AndAlso Not dataGridView1.Rows(e.RowIndex).IsNewRow Then
        dataGridView1.Rows.Remove(e.RowIndex)
    End If
End Sub 
```

第三种流行的处理方法是让您的验证在什么都不做的情况下取消对当前行的编辑：

```
Private Sub dataGridView1_RowValidating(ByVal sender As Object, ByVal e As DataGridViewCellCancelEventArgs)
    Dim drv As DataRowView = TryCast(dataGridView1.CurrentRow.DataBoundItem, DataRowView)
    If drv IsNot Nothing AndAlso drv(0) = DBNull.Value Then
        drv.CancelEdit()
        e.Cancel = True
    End If
End Sub 
```

（另外，附带说明：如果您的主键（a/k/a 身份）字段设置为自动编号，您可能会发现 ADO.NET 能够更好地处理获取下一个 id 等细节保存。有关更多信息，请查看[MSDN 文章“检索自动编号值的标识”](http://msdn.microsoft.com/en-us/library/ks9f57t0.aspx)以及[SQL Server 和 MS Access 的这组出色示例](http://www.mikesdotnetting.com/Article/54/Getting-the-identity-of-the-most-recently-added-record)。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-18T10:21:47.937

```
Private Sub dataGridView1_RowValidating(ByVal sender As Object, ByVal e As DataGridViewCellCancelEventArgs)
    If dataGridView1.Rows(e.RowIndex) IsNot Nothing AndAlso Not dataGridView1.Rows(e.RowIndex).IsNewRow Then
        Dim [error] As String = ""

        If dataGridView1.Rows(e.RowIndex).Cells("Field1").Value Is Nothing OrElse dataGridView1.Rows(e.RowIndex).Cells("Field1").Value.ToString().Trim() = "" Then
            [error] += " * Field #1" & vbLf
        End If

        If dataGridView1.Rows(e.RowIndex).Cells("Field2").Value Is Nothing OrElse dataGridView1.Rows(e.RowIndex).Cells("Field2").Value.ToString().Trim() = "" Then
            [error] += " * Field #2" & vbLf
        End If

        If [error] <> "" Then
            MessageBox.Show("The following required fields were left blank:" & vbLf & vbLf & [error], "Row Validation Error", MessageBoxButtons.OK, MessageBoxIcon.[Error])
            e.Cancel = True
        End If
    End If
End Sub 
```

# vb.net - 检查字符串是否为双精度

> ID：1010012
> 
> 赞同：-1
> 
> 时间：2009-06-17T23:25:54.023
> 
> 标签：vb.net

如果 Double.Parse(list_numbers.Item(i), possibledouble)

list_numbers 是一个字符串列表

list_numbers.Item(i) = "0.000"

possibledouble 是双精度

调试器返回“输入字符串的格式不正确”

我认为双重解析会将字符串转换为“0.0”的双重格式，但它给了我一个错误。请帮忙

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-17T23:58:02.243

您的代码应该看起来像这样（请参阅下面的解释）

```
If Double.TryParse(list_numbers.Item(i), possibledouble) Then

                        Select Case possibledouble
                            Case 0 To 49.99
                                list_numbers.Item(i) = ""
                            Case 59 To 99.99
                                list_numbers.Item(i) = "1"
                            Case 100 To 199.99
                                list_numbers.Item(i) = "2"
                            Case Is > 200
                                list_numbers.Item(i) = "3"
                            Case Else
                                list_numbers.Item(i) = "n/a"
                         End Select

End If 
```

好吧，据我所知，您的代码存在一些问题，我确信这可以解释您所看到的行为。

首先，Double.Parse 方法实际上已经为您返回了该项目的双精度数，因此以后无需使用 Cdbl 再次转换它。

该行的另一个更主要的问题是，如果该方法无法将字符串转换为双精度，则会引发异常。我猜想在您的代码中的某些地方，您在没有意识到的情况下捕获了该异常。

最后一个问题是我实际上没有找到 Double.Parse 的任何重载，除了 string 和 double 这让我相信你实际上是想使用 Double.TryParse 方法而不是 Parse 方法。如果解析成功，TryParse 将返回 true 或 false，如果解析成功，则将值放入您指定的 double 中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-17T23:27:46.300

为你提问；

什么是 list_numbers？（数组？控制？别的东西？）

一个小改进，你应该改变

```
 Select Case CDbl(list_numbers.Item(i)) 
```

和

```
 Select Case possibledouble 
```

和你的标题问题；

我认为在你的情况下 isnumeric 函数应该足够了

[你已经知道如何从这里做](https://stackoverflow.com/questions/1009953/converting-to-double-error)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-17T23:39:46.010

...您在[此处](https://stackoverflow.com/questions/1009902/select-case-to-check-range-of-a-decimal-number)的案例陈述中得到了更好的答案。见jvanderh的回答。

# asp.net - NonPublic 在反映中等信任度时导致权限错误

> ID：1010016
> 
> 赞同：0
> 
> 时间：2009-06-17T23:26:54.397
> 
> 标签：asp.net, reflection, permissions, medium-trust

我必须说到目前为止，我可能只是非常幸运，因为我从未遇到过与以中等信任度运行的网站相关的问题。我只开发过 Intranet 应用程序，或者碰巧使用过完全信任的托管公司。但是我被要求用于最近的项目的主机以中等信任度运行，所以我试图让我的应用程序运行它。几个问题 - 我在 Windows XP 上开发。那里的 IIS 可以配置为中等信任（更易于调试）和/或它是 web.config 设置吗？关于这个主题有大量的信息，而且学习曲线很陡峭。

其次，经过大量的摆弄和删除代码，我认为这一行导致了权限错误：

对于 Type.GetFields 中的每个 FieldInfo 作为 FieldInfo（BindingFlags.Instance 或 BindingFlags.NonPublic 或 BindingFlags.Public）

谁能澄清这是一个可能的候选人，尤其是。那个非公共标志？这是复制和粘贴的代码（Coding Horror 强调了这样做的风险）所以我从来没有真正想过。我假设循环是通过对象中的每个字段，包括公共和非公共字段——我已经读过，受保护的字段是禁止使用对中等信任进行反射的。

干杯，罗布。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-24T01:12:28.153

抱歉，与 NonPublic 的反射等同于完全信任。

如果不知何故我没有完全信任但有 NonPublic 反射，我可以利用它来改变我自己的代码信任级别（可写字符串等）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-24T01:08:00.643

是的，可以将 XP 上的网站配置为以中等信任度运行：

在 <system.web> 部分添加以下内容：

```
<!-- Case is important: it's Medium, not medium -->
<trust level="Medium"/> 
```

而你在那里。

您可能会发现大多数主机在略微提升的“中等”信任设置中运行他们的网站，除了默认设置之外还有一些额外的权限 - 他们的技术人员应该能够告诉您他们有什么不同（如果有的话）。

如果你看看：

```
C:\Windows\Microsoft.NET\Framework\v2.0.50727\CONFIG\web_mediumtrust.config 
```

您将看到应用的默认设置。

反射是 Medium 信任中受限的关键内容之一 - 来自[GetFields](http://msdn.microsoft.com/en-us/library/6ztex2dc.aspx)页面上的备注：

> 如果请求的字段是非公共的并且调用者没有 ReflectionPermission 来反映当前程序集之外的非公共对象，则此方法返回一个空引用（在 Visual Basic 中为 Nothing）。

由于这有可能返回 null，因此您可能应该在开始迭代之前检查 null，或者在使用之前检查 FieldInfo 是否为 null/nothing。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-23T21:36:53.393

我将把它标记为已关闭，因为没有人回答，而且事实证明它太有问题了，无法尝试重新编码。该程序写得还不错，但在对象映射中大量使用了反射，老实说，找到支持完全信任的托管公司更容易。

# c# - ThreadState 属性是什么值？

> ID：1010030
> 
> 赞同：3
> 
> 时间：2009-06-17T23:32:52.420
> 
> 标签：c#, .net, multithreading

[这个问题](https://stackoverflow.com/questions/1006691/how-to-check-if-a-win32-thread-is-running-or-in-suspended-state)让我想到了 .NET 等价物。`ThreadState`Thread 类的属性有什么价值？在此代码示例中：

```
if (someThread.ThreadState != System.Threading.ThreadState.Running)
{
    someThread = new Thread(SomeMethod);
    someThread.Start();
} 
```

的属性可以在 和 里面`someThread`的代码之间`ThreadState`切换，对吧？`Running``if``if`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T00:28:45.317

ThreadState 是那些一开始看起来很有希望的奇妙属性之一，但一旦你深入研究 in 函数的方式，你会发现它几乎完全没用。

ThreadState 的主要问题是枚举名称非常具有误导性。以 ThreadState.Runnning 为例。这是一个非常糟糕的名字，因为它实际上并不表示线程正在运行。相反，它表示线程在最近的某个时间点正在运行，并且可能仍在运行，也可能未在运行。

这可能看起来微不足道，但事实并非如此。从字面上理解枚举的名称并生成非常漂亮的代码真的很容易。然而，除了代码读取之外，它通常基于有缺陷的逻辑。

我真的只将此属性用于调试目的。

这个值在非常有限的场景中很有用，在这些场景中你有一些其他机制来控制你正在查看的线程。例如锁或WaitHandle。但通常使用另一种形式的同步比依赖此属性更好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-17T23:44:10.867

来自[MSDN](http://msdn.microsoft.com/en-us/library/system.threading.threadstate.aspx)：

> 重要说明：
> 有两个线程状态枚举，System.Threading.ThreadState 和 System.Diagnostics.ThreadState。线程状态枚举仅在少数调试场景中有用。您的代码不应该使用线程状态来同步线程的活动。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T00:00:39.273

ThreadState 对于在调试器中查看很有用，以帮助理解和调试某些类型的阻塞/同步错误。例如，您可以通过查看它并查看 ThreadState 设置为 ThreadState.WaitSleepJoin 来判断特定线程是否在调试器中被阻塞。

话虽如此，这是我几乎从不依赖的东西。我尝试使用它进行调试的结果好坏参半，所以总的来说，我认为最好假装它不存在。

# javascript - Jquery循环浏览多个图像并一次显示3个

> ID：1010031
> 
> 赞同：2
> 
> 时间：2009-06-17T23:33:07.643
> 
> 标签：javascript, jquery, plugins, animation, effects

你能指点我一个 jquery 插件，或者我可以用来做这个的片段吗？

问题是：假设我有 12 张图片，我想一次显示 3 张并以这种方式循环浏览 12 张图片：

(img1-img2-img3) 然后 (img2-img3-img4) 然后 (img3-img4-img5)...

明白了吗？事实上，我想要一种图像的选框。

这是可行的吗？

感谢一百万次！:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-17T23:39:06.040

可以在这里找到一个漂亮的插件，可以满足您的需要：

[http://www.agilecarousel.com/examples/multi_example/carousel.html](http://www.agilecarousel.com/examples/multi_example/carousel.html)

乔什

# c# - ASP.NET MVC 模型绑定

> ID：1010035
> 
> 赞同：1
> 
> 时间：2009-06-17T23:34:44.473
> 
> 标签：c#, asp.net-mvc, model-binding

我遇到了模型绑定问题。如果我*确实*在 CopyToModelStateDictionary 方法中使用了前缀，我不会收到无效控件的样式或验证消息。如果我*不*使用前缀，我会收到样式和验证消息，但如果用户没有从动态创建的单选按钮列表中进行选择，页面会崩溃。我怎样才能得到两者？我不明白这里发生了什么。

```
 [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Edit(int id, FormCollection collection)
    {
        Request request = requestRepository.GetById(id);
        UpdateModel(request);
        Helpers.CopyToModelStateDictionary(request.GetRuleViolations(), ModelState, "request");
        ...
        if (!ModelState.IsValid) 
        {
            return View("Edit_Requestor", request);
        }
    }

    public static void CopyToModelStateDictionary(NameValueCollection errors, ModelStateDictionary modelState, string prefix)
    {
        foreach (string key in errors)
        {
            foreach (string value in errors.GetValues(key))
            {
                modelState.AddModelError(prefix + "." + key, value);
            }
        }
    } 
```

错误信息

```
Line 9:   foreach (ProblemType problemType in problemTypes)
Line 10:  {
Line 11:      Writer.Write(Html.RadioButton("ProblemType", problemType.Value));
Line 12:      Writer.Write(problemType.Text + "<br/>");
Line 13:  } 
```

堆栈跟踪：

```
[NullReferenceException: Object reference not set to an instance of an object.]
System.Web.Mvc.HtmlHelper.GetModelStateValue(String key, Type destinationType) +63
System.Web.Mvc.Html.InputExtensions.InputHelper(HtmlHelper htmlHelper, InputType inputType, String name, Object value, Boolean useViewData, Boolean isChecked, Boolean setId, Boolean isExplicitValue, IDictionary`2 htmlAttributes) +328
System.Web.Mvc.Html.InputExtensions.RadioButton(HtmlHelper htmlHelper, String name, Object value, Boolean isChecked, IDictionary`2 htmlAttributes) +193
System.Web.Mvc.Html.InputExtensions.RadioButton(HtmlHelper htmlHelper, String name, Object value, IDictionary`2 htmlAttributes) +282
System.Web.Mvc.Html.InputExtensions.RadioButton(HtmlHelper htmlHelper, String name, Object value) +61
ASP.views_request_lstproblemtype_ascx.__Render__control1(HtmlTextWriter __w, Control parameterContainer) in c:\Web\Views\Request\lstProblemType.ascx:11
System.Web.UI.Control.RenderChildrenInternal(HtmlTextWriter writer, ICollection children) +256
System.Web.UI.Control.RenderChildren(HtmlTextWriter writer) +19
System.Web.UI.Control.Render(HtmlTextWriter writer) +10
System.Web.UI.Control.RenderControlInternal(HtmlTextWriter writer, ControlAdapter adapter) +27
System.Web.UI.Control.RenderControl(HtmlTextWriter writer, ControlAdapter adapter) +99
System.Web.UI.Control.RenderControl(HtmlTextWriter writer) +25
System.Web.UI.Control.RenderChildrenInternal(HtmlTextWriter writer, ICollection children) +134
System.Web.UI.Control.RenderChildren(HtmlTextWriter writer) +19
System.Web.UI.Page.Render(HtmlTextWriter writer) +29
System.Web.Mvc.ViewPage.Render(HtmlTextWriter writer) +59
System.Web.UI.Control.RenderControlInternal(HtmlTextWriter writer, ControlAdapter adapter) +27
System.Web.UI.Control.RenderControl(HtmlTextWriter writer, ControlAdapter adapter) +99
System.Web.UI.Control.RenderControl(HtmlTextWriter writer) +25
System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +1266 
```

感谢您阅读我的问题！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T01:14:25.443

这可能会有所帮助。

您正在添加一个模态错误，因此 MVC 正在尝试检索尝试的值，但因为您没有添加它，所以它失败了。

[使用 ModelState 验证表单](https://stackoverflow.com/questions/887757/validating-form-using-modelstate)

[ASP.NET MVC - Html.Textbox() 抛出“对象引用未设置为对象的实例”](https://stackoverflow.com/questions/647266/asp-net-mvc-html-textbox-throws-object-reference-not-set-to-an-instance-of-an)

# .net - 在 .NET 中处理大量内存对象

> ID：1010040
> 
> 赞同：3
> 
> 时间：2009-06-17T23:38:24.123
> 
> 标签：.net, memory, in-memory

本质上，我有一个非常大的列表，其中包含相对较大的字典。

所以基本上，我有一个非常大的内存集合。

然后我手动将此集合序列化为 XML，并通过 http 发送。不用说，XML 太大了，有时太大了，我什至在尝试发送它之前就得到了 OutOfMemory 异常。

**在 .NET 中，我将如何计算潜在的内存使用量。**例如，在这种情况下，我必须通过一次仅处理少量 Collection 将 XML 分解成块。

**如何有效地即时计算每个“块”的大小。**我不想选择一个任意数字，例如“一次处理 100 个项目”，**我想知道每个块应该有多大，以逐案为基础。**

干杯

**更新**

尽管@Jacob 为这个特定问题提供了最佳解决方案，但该应用程序的概念结构本身存在缺陷。

实际上，解决方案是执行消息的一部分，以便在使用集合时计算消息的潜在大小。

然后，您一个接一个地发送每个可接受大小的单元。

但这只是一个技巧。真正的解决方案是要么找到一种不传递大消息的方法，要么完全使用完全不同的协议。

如果你想使用 SOAP，这里有一篇[关于这个主题的有趣帖子](http://geekswithblogs.net/evjen/archive/2006/09/13/91112.aspx)，但是我决定找到一种方法来绕过发送如此多的数据。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-17T23:43:52.193

为什么不直接流式传输数据，以便即时转换为 XML，避免内存中存在巨大的 XML 文件？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T00:15:19.620

我认为您可能比其他任何事情都更容易遇到概念问题。“计算潜在内存使用量”与“有效计算每个块的大小”不一致。**真正**使您的内存使用达到可以预测足够块大小的准确程度的唯一方法是**实际**进行转换。

听起来最好的方法可能是逐步解决这个问题——基本上是那些建议使用流对象的人所说的。如果您不能利用实际的流式传输，您可能希望构建您的序列化，以便一次处理一个概念单元（即列表中的一个项目及其伴随的字典子项）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-17T23:58:45.440

你怎么寄？您应该通过可以进行流式传输的 WCF 来执行此操作。它还可以通过配置让您选择是使用 XML 还是二进制文件，或者其他什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-10T09:00:42.703

如果发送有问题，接收不也有问题吗？你听起来像是在尝试解决一半的问题。XML 是大数据的一大禁忌。

# javascript - 如何在 JQuery 中将输入文本字段交换为密码区域？

> ID：1010046
> 
> 赞同：6
> 
> 时间：2009-06-17T23:42:06.957
> 
> 标签：javascript, jquery, html

我想在密码区域中将“密码”显示为文本，当聚焦时，该框应该变为空并允许用户输入正常的密码（星号）。

目前我使用以下方法。最初我显示一个显示密码的文本字段，当聚焦时它被删除并替换为密码字段。这是jQuery：

```
$(document).ready(function() {
    $("#password").focus( function() {
        $("#pwd").html('<input type="password" id="password" name="password" value="" />');
        $("#password").focus();
    });
}); 
```

这适用于 Firefox 和 Chrome，但在 IE 8（可能还有其他 IE）中失败，因为焦点调用由于某种原因失败（也许 DOM 还没有准备好？）。

[jsbin](http://jsbin.com/apuza)上有一个演示。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T00:47:50.257

你可以试试[水印](http://plugins.jquery.com/project/jquery-watermark)插件。我不知道它是否适用于IE8。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-17T23:53:13.407

在意识到我原来的解决方案行不通后，出于好奇，我花了一段时间试图提出一个可行的解决方案。我仍然建议使用推荐的 jQuery 插件[eKek0](https://stackoverflow.com/questions/1010046/how-can-you-swap-an-input-text-field-to-a-password-area-on-focus-in-jquery/1010241#1010241)，因为它会更好地降级。

下面的例子相当灵活。替换标签不是将替换`<input />`标签硬编码为字符串，而是从原始标签派生而来。如果`<input />`标签属性被更改，这会有所帮助，因为您不会丢失任何样式或赋予标签的其他属性。

以下解决方案已在 Chrome、Firefox、IE8 和 IE7 兼容模式下的 IE8 中进行了测试。

```
$(document).ready(function() { 

    var focusEvent = function() { 
        if(this.type == 'text') {
            var html = $(this).clone().wrap('<span></span>').parent().html();
            html = html.replace(/type=("|')?text("|')?/, 'type="password"');
            var $newPwdBx = $(html);      

            $(this).replaceWith($newPwdBx);
            $newPwdBx.removeClass('readOnly');
            $newPwdBx.val('');
            $newPwdBx.focus();
            $newPwdBx.blur(blurEvent);
        }
    };

    var blurEvent = function() { 
        if(this.value == '') { 
            var html = $(this).clone().wrap('<span></span>').parent().html();
            html = html.replace(/type=("|')?password("|')?/, 'type="text"');
            var $newTxtBx = $(html);            

            $(this).replaceWith($newTxtBx);
            $newTxtBx.addClass('readOnly');
            $newTxtBx.val('password');
            $newTxtBx.focus(focusEvent);
        } 
    };

    $("#password").focus(focusEvent); 
}); 
```

此代码将 替换为`<input />`模糊和焦点的适当类型。它还添加/删除了一个用于设置“密码”占位符文本样式的类，因此它更有用，因为占位符“密码”文本不是默认的黑色，这可能会误导用户。

你可以在这里看到它的工作：http: [//jsbin.com/azugu](http://jsbin.com/azugu)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T00:57:39.317

我做过类似的事情。如果您打算使用 javascript，这是一种方法：

*   有两个输入字段，一个普通字段和一个密码字段
*   密码用css隐藏
*   当正常输入获得焦点时
    *   隐藏正常输入
    *   显示密码输入
    *   重点关注密码输入

这种方法有一些问题需要考虑。如果有人禁用了 javascript，或者正在使用 Firefox 的 NoScript 扩展，他们可能无法提交表单。如果有人在加载 javascript 之前开始输入，可能会出现意想不到的结果。

另一种方法是使用 css 并将 javascript 作为备份（对于 IE6）。创建具有文本“密码”的图像。将该图像作为密码字段的背景图像。您可以使用 css 中的伪类来更改悬停和 . 这样，如果一个人禁用了 javascript，该表单仍然有效。它也可以在加载 css 后立即工作。

CSS 可能看起来像这样：

```
.pass { 
    background-image: url(/path/to/img.png);
}
.pass:hover {
    background: white;
} 
```

使用 jquery，javascript 可能看起来像这样：

```
 $( ".pass" ).hover( function() {
     $( this ).css( "background", "white" );
  }; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T06:12:26.853

实现这一点的最常见方法是在密码字段中设置一个背景图像，其中包含文本“密码”，并在获得焦点时移除背景图像。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-17T23:52:17.247

为什么不只是更改属性并清除值？

```
$("#password").focus( function() {
    $(this).attr('type','password');
    $(this).attr('value','');        
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T00:40:03.377

试试这个，如果你愿意的话：

```
$(document).ready(function() {
    $(".pass").focus(function() {
        $pwInput = $('<input type="password" class="pass" name="password" value="" />');
        $(this).remove();
        $("#someDiv").append($pwInput);
    }).focus();
}); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T00:41:29.287

你为什么不在顶部放一个 div 呢？

```
var $pwd = $("#passwordBox"),
    pos = $pwd.position()
;
$pwd
    .after(  // add the div
        $('<div></div>')
            .html("Password")
            .css({
                position : "absolute",    // place it over this
                top : pos.top + "px",  // adjust as necessary
                left : pos.top + "px"
            })
    )
    .next() // select the new div
    .andSelf()
    .one('click focus', function() {
        $pwd.next().remove()    // remove the div
            .end().focus() // focus the input box
        ;
    })
; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-18T00:43:06.443

这适用于 FF 和 IE：

```
$(document).ready(function() {
    $("#password").focus( function() {
        $(this)
          .after('<input type="password" id="password" name="password" value="" />')
          .remove();
        $("#password").focus();
    });
}); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-10T21:02:34.963

还有这个由 Simone Lippolis 制作的[txReplaceFormPassword插件。](http://www.barattalo.it/2010/03/10/how-to-write-a-text-description-into-html-input-type-password/)

# operators - 在 csh 中，为什么 4 - 3 + 1 == 0？

> ID：1010049
> 
> 赞同：13
> 
> 时间：2009-06-17T23:43:18.250
> 
> 标签：operators, csh

```
#!/bin/csh

@ cows = 4 - 3 + 1
echo $cows 
```

当我期望“2”时，这个简单的 csh 脚本在运行时会产生“0”作为输出。

```
~root: csh simple.1
0 
```

我看了一堆，我唯一能想到的是“-”被解读为一元否定而不是减法，因此改变了运算符的优先级并以 4 - 4 而不是 2 + 1 结束。这是正确的？如果是这样，有什么理由吗？如果没有...帮助！

编辑：所以他们是正确的联想！这些运算符在 C 中不是右结合的，是吗？C-Shell 与 C 有什么不同吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-06-17T23:51:34.567

虽然您期望运算符是左关联的，但它们[在 csh 中是右关联的](http://docs.oracle.com/cd/E19253-01/816-5165/csh-1/index.html#Expressions%20and%20Operators)，因此它被评估为`4-(3+1)`

```
 -
  / \
 /   \
4     +
     / \
    3   1 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-06-17T23:46:30.737

+ 和 - 运算符在 csh 中是右结合的。这意味着“4 - 3 + 1”被评估为“4 - (3 + 1)”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-17T23:45:31.880

运算符分组。它将运算读取为 4 - (3 + 1)，而不是 (4 - 3) + 1。

# wpf - C# EventHandler 漂亮的代码（如何？）

> ID：1010053
> 
> 赞同：5
> 
> 时间：2009-06-17T23:44:48.480
> 
> 标签：wpf, event-handling

我承认，它有点小，但我正在寻找更好的方法来执行以下代码块。他们应该自我解释...

```
 private void listBoxItem_PreviewMouseDown(object sender, MouseButtonEventArgs e)
    {
        var listBoxItem = sender as ListBoxItem;
        if (listBoxItem != null)
        {
            var clickObject = listBoxItem.DataContext as ClickObject;
            if (clickObject != null)
            {
                clickObject.SingleClick();
            }
        }
    } 
```

另一个丑陋的：

```
 private void listBox_SelectionChangedA(object sender, SelectionChangedEventArgs e)
    {
        var lB = sender as ListBox;
        if (lB != null)
            StatusBoxA.Text = "Elements selected" + lB.SelectedItems.Count;
    } 
```

是的，我知道，这不是濒临死亡的紧急情况。但我不喜欢（如果！= null）。任何可以缩短它的神奇想法:-)

顺便说一句，我发现了一些关于类似主题的好信息：[Null Items 上的循环](https://stackoverflow.com/questions/644715/c-code-simplification-query-the-null-container-and-the-foreach-loop) 很高兴阅读......

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-18T00:14:42.133

我喜欢好的、干净的代码，但在大多数情况下，干净优雅并不意味着短小精悍。代码简洁有利于竞赛。将“if not null”语句更改为 foreach 可能看起来更酷，但项目中的其他人更难理解您要完成的工作。相信我，即使几个月后你也不会记得它：P。你的代码就这样很好！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T00:29:46.407

```
private void listBoxItem_PreviewMouseDown(object sender, MouseButtonEventArgs e)
{
        var listBoxItem = sender as ListBoxItem;
        if (listBoxItem == null) return;

        var clickObject = listBoxItem.DataContext as ClickObject;
        if (clickObject == null) return;

        clickObject.SingleClick();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T00:09:52.610

**单线**：

```
private void listBox_SelectionChangedA(object sender, SelectionChangedEventArgs e)
{
    As<ListBox>(sender, (lB) => StatusBoxA.Text = "Elements selected" + lB.SelectedItems.Count);
} 
```

或者，嵌套：

```
private void listBoxItem_PreviewMouseDown(object sender, MouseButtonEventArgs e)
{
    As<ListBoxItem>(sender, (listBoxItem) => {
        As<ClickObject>(listBoxItem.DataContext,
            (clickObject) => clickObject.SingleClick());
    };
} 
```

使用这个静态泛型方法（T 是目标类型，输入是要转换的对象，代码是要在成功时执行的委托（或 lambda 表达式）：

```
static void As<T>(object input, Action<T> code) where T : class
{
  T foo = input as T;
  if (foo != null)
  code(foo);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T00:19:12.793

由于您使用的是来自 .NET 框架（而不是第三方）的已知事件，并且从代码看来您只是将这些方法用于特定类（即 ListBoxItems 和 ListBoxes），因此您需要做一些事情*知道*是真的：

*   `sender`永远不会为空
*   `sender`将始终分别是 ListBoxItem 或 ListBox

那么为什么要使用`as`运算符呢？刚投！

然后第一个片段变成

```
private void listBoxItem_PreviewMouseDown(object sender, MouseButtonEventArgs e)
{
        var listBoxItem = (ListBoxItem)sender;
        var clickObject = (ClickObject)listBoxItem.DataContext;
        clickObject.SingleClick();
} 
```

请注意，在一般情况下并非如此（如果您在一个处理程序中为所有 Control 类型处理所有 PreviewMouseDown 事件，则不会这样做），但是对于这样的事件处理代码，尤其是在 UI 代码中，您可以尽您所能确定，该发件人不会为空，发件人将是您期望的类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-17T23:54:18.850

也许我只是迂腐，但是如果您在其主机容器代码中使用事件，为什么需要强制发送发送者。

无论是谁对列表进行了更改，您都不能为列表框命名并使用它。

```
<ListBox x:Name="listbox1" />

private void listBox_SelectionChangedA(object sender, SelectionChangedEventArgs e)
{
    StatusBoxA.Text = "Elements selected" + listbox1.SelectedItems.Count;
} 
```

或者您甚至可以使用绑定来实现其中的一些，而无需任何代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T00:01:20.897

这应该和第一个一样，重新格式化一下：

```
private void listBoxItem_PreviewMouseDown(object sender, MouseButtonEventArgs e)
{
    ClickObject clickObject;
    if (
        ((sender as ListBoxItem) != null) &&
        ((clickObject = ((ListBoxItem)sender).DataContext as ClickObject) != null)
        )
    {
        clickObject.SingleClick();
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T00:02:09.117

您可以将扩展方法添加到表单元素，然后可以触发事件：

```
public static void OnSelectionChanged(this ListBox b, Action<ListBox> a)
{
    b.SelectedIndexChanged += (s,e) =>
    {
        if (s is ListBox)
           a(s as ListBox);           
    };
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-18T00:40:49.520

使用与 Utaal 解决方案相同的想法，但作为扩展方法......

```
public static void As<TSource>(this object item, Action<TSource> action) where TSource : class
{
    var cast = item as TSource;

    if (cast != null)
        action(cast);
}

private void listBoxItem_PreviewMouseDown(object sender, MouseButtonEventArgs e)
{
    sender.As<ListBoxItem>(listBoxItem => 
        listBoxItem.DataContext.As<ClickObject>(clickObject =>
            clickObject.SingleClick()));
} 
```

# jquery - jQuery 动画 css 边界半径属性（webkit、mozilla）

> ID：1010058
> 
> 赞同：30
> 
> 时间：2009-06-17T23:46:39.473
> 
> 标签：jquery, jquery-animate, border, css

**jQuery**中有没有办法为Webkit 和 Mozilla 浏览器中可用的 css3**边框半径属性设置动画？**

我还没有找到可以做到这一点的插件。

```
-webkit-border-radius

-moz-border-radius 
```

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-06-18T00:28:16.363

我原本期望像...

```
$("selector")
  .css({borderRadius: 10});
  .animate({borderRadius: 30}, 900); 
```

...会工作。但是，我错了：Webkit 允许您通过*设置*所有四个角的值`borderRadius`，但不会让您回读它 - 因此使用上面的代码，动画将始终从 0 而不是 10 开始。IE 具有相同的问题。Firefox*会让*你回读它，所以一切都按预期工作。

嗯......边界半径有某种实现差异的历史。

幸运的是，有一个解决方法：只需单独指定每个角半径：

```
$("selector")
  .css({
    borderTopLeftRadius: 10, 
    borderTopRightRadius: 10, 
    borderBottomLeftRadius: 10, 
    borderBottomRightRadius: 10 })
  .animate({
    borderTopLeftRadius: 30, 
    borderTopRightRadius: 30, 
    borderBottomLeftRadius: 30, 
    borderBottomRightRadius: 30}, 900); 
```

请注意，如果您希望保持与旧浏览器的兼容性，您可以全力以赴并使用旧的浏览器前缀名称：

```
$("selector")
  .css({
    borderTopLeftRadius: 10, 
    borderTopRightRadius: 10, 
    borderBottomLeftRadius: 10, 
    borderBottomRightRadius: 10,
    WebkitBorderTopLeftRadius: 10, 
    WebkitBorderTopRightRadius: 10, 
    WebkitBorderBottomLeftRadius: 10, 
    WebkitBorderBottomRightRadius: 10, 
    MozBorderRadius: 10 
  })
  .animate({
    borderTopLeftRadius: 30, 
    borderTopRightRadius: 30, 
    borderBottomLeftRadius: 30, 
    borderBottomRightRadius: 30,
    WebkitBorderTopLeftRadius: 30, 
    WebkitBorderTopRightRadius: 30, 
    WebkitBorderBottomLeftRadius: 30, 
    WebkitBorderBottomRightRadius: 30, 
    MozBorderRadius: 30 
  }, 900); 
```

不过，这开始变得非常疯狂。如果可能的话，我会避免它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-01-13T18:21:17.987

使用 cssHooks。

这将帮助您：

[http://www.webmuse.co.uk/articles/border_radius_csshook_with_internet_explorer_support/](http://www.webmuse.co.uk/articles/border_radius_csshook_with_internet_explorer_support/)

cssHooks 的链接：

[https://github.com/brandonaaron/jquery-cssHooks](https://github.com/brandonaaron/jquery-cssHooks)

祝你好运！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-01-13T18:40:13.010

只是一个建议，我们可以使用一个函数来检测浏览器的 CSS 前缀这里有一个示例代码.. [http://jsfiddle.net/molokoloco/f6Z3D/](http://jsfiddle.net/molokoloco/f6Z3D/)

# php - 计算日期

> ID：1010062
> 
> 赞同：1
> 
> 时间：2009-06-17T23:49:05.570
> 
> 标签：php, mysql, timestamp

我需要制作一个时间戳以放入 MySQL。用户正在提交数周（周数），我需要将数周添加到今天的日期。我要做的是计算用户提交的广告的结束日期。

关于如何做到这一点的任何建议？谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-17T23:52:22.503

您可以使用[`strtotime`](http://www.php.net/strtotime)将时间添加到日期 - 如果没有传递，则它需要第二个参数，即当前时间。然后，您可以将该创建的时间传递给该[`date`](http://www.php.net/date)函数以创建您的时间戳：

```
$timestamp = date('Y-m-d H:i:s', strtotime('+10 weeks')); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-17T23:53:49.617

例如，我认为 DATE_ADD(CURDATE(), INTERVAL 2 WEEK) 会在当前日期增加 2 周

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T00:10:06.010

如果您希望广告在一天中的某个时间过期，您可以使用 mktime：

$day = date("d") + ($weeks * 7);
mktime($hour,$minute,$second,$month,$day,$year);

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T00:21:05.350

顺便说一句，有人会说将 UNIX 时间作为一个普通的 int 字段存储在数据库中是更灵活和可移植的解决方案。此外，插入和更新发生得更快，因为它们只涉及存储简单的整数。*这实际上取决于您需要*在数据库级别进行多少日期操作。我倾向于使用可移植性并在 PHP 中进行所有日期计算。要存储当前时间戳，我只需将以下输出插入整数列：

```
strtotime('now'); 
```

或者

```
time(); 
```

两者都返回当前（unix）时间戳。此后的日期比较可以通过从数据库中获取时间戳并执行简单的算术运算来完成，如下所示：

```
if($tsFromDb > strtotime('+28 days')) {
   echo 'it is the future, zombies!';
} 
```

这实际上取决于您使用日期的目的。

# mysql - 在mysql中存储数据的最佳方法？

> ID：1010063
> 
> 赞同：1
> 
> 时间：2009-06-17T23:49:15.053
> 
> 标签：mysql, performance

我有一个非常基本的问题，关于在我的数据库中存储数据的首选方式。

我有一个名为“users”的表，每个用户都有一个用户名和 user_id。现在，我想创建一个名为“comments”的表格，供用户对新闻发表评论。

最好在评论中有一个名为“用户名”的列并存储登录用户的名称，还是有一个名为“user_id”的列。如果我使用 user_id 我将不得不让我的 sql 语句有另一个 select 语句。“（从用户中选择用户名，其中 users.id = comments.user_id）作为用户名”。似乎只存储用户名性能会更好。

我以为我阅读是为了避免数据库中的重复数据。

哪个更好？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-17T23:52:21.350

通常，您使用 ID 字段将表链接在一起。原因是（在您的情况下）您可能允许该人更改其用户名，但您不想尝试更新位于...的所有位置

因此，将 user_id 放入您的评论表中，并在连接中提取用户名，如您所示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-17T23:51:24.097

如果 user_id 是主键，那么您应该使用 user_id 而不是 username，如果您想使用 username 而不是 user_id，那么为什么首先要有 user_id？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-17T23:52:22.550

如果有可能创建足够大的数据库，请将 user_id 存储在 comments 表中。更少的开销。还要考虑这样可以更轻松地修改用户名。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T00:08:44.967

数据应该以（至少）[第三规范化形式](http://en.wikipedia.org/wiki/Database_normalization)存储，因此您应该使用 user_id 作为 users 表中的主键，并作为 comments 表中的外键并使用它来获取详细信息：

```
SELECT comments.*, users.username  
FROM comments, users
WHERE users.user_id = comments.user_id; 
```

如果您收到基于文章的评论，您可以这样做：

```
SELECT comments.*, users.username  
FROM comments, users
WHERE users.user_id = comments.user_id  
AND comments.article_id = '$current_article_id'; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-17T23:52:22.770

存储用户 ID（整数）将意味着以后更快的 JOIN。除非您打算让人们手动挖掘数据库，否则真的没有理由使用用户名

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-17T23:52:33.033

我很确定将用户 ID 存储在评论表中就足够了。如果要从 comments 表返回行，只需使用 JOIN 语句。

干杯

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-17T23:58:38.827

哪个将是唯一标识符？user_id，我敢打赌，否则你的系统中不能有两个“John Smith”。

如果数量很重要，从长远来看，匹配用户名字段的文本将比链接到查询中的用户表更昂贵。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-18T00:12:17.097

与字母数字 id 相比，数字值的加入和索引成本更低。使用数字来唯一标识一行。另一个好处是，如果需要更改用户 ID，则 PK 不需要更改。最后一个好处是这是大多数现代 Web 框架的设计，例如 django 和 rails。

# ccnet-config - CCNET 服务器异常

> ID：1010077
> 
> 赞同：7
> 
> 时间：2009-06-17T23:53:59.570
> 
> 标签：ccnet-config

CCNET 在 Web 仪表板上抛出了这个异常。这是什么原因造成的？System.Net.Sockets.SocketException：无法建立连接，因为目标计算机主动拒绝它 127.0.0.1:21234 服务器堆栈跟踪：在 System.Net.Sockets.Socket.DoConnect(EndPoint endPointSnapshot, SocketAddress socketAddress) 在 System.Net .Sockets.Socket.Connect(EndPoint remoteEP) 在 System.Runtime.Remoting.Channels.RemoteConnection.CreateNewSocket(EndPoint ipEndPoint) 在 System.Runtime.Remoting.Channels.RemoteConnection.CreateNewSocket() 在 System.Runtime.Remoting.Channels.RemoteConnection .GetSocket() 在 System.Runtime.Remoting.Channels.SocketCache.GetSocket(String machinePortAndSid, Boolean openNew) 在 System.Runtime.Remoting.Channels.Tcp.TcpClientTransportSink.SendRequestWithRetry(IMessage msg, ITransportHeaders requestHeaders,

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-10-27T15:27:15.233

你有没有检查 ccservice 是否已启动？您可以使用 telnet 进行检查，为了进行测试，我们可以使用 ccnet.exe，它是一个控制台应用程序，用于简化

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-04-21T15:14:27.100

这个问题看起来像另一个进程锁定了 CCNet 正在使用的同一个端口。您可以使用[PortMon](http://technet.microsoft.com/en-us/sysinternals/bb896644)来跟踪哪个进程正在锁定该特定端口。您还可以在配置文件中配置 CCNet 以使用不同的端口来避免冲突。配置应如下所示

```
 <system.runtime.remoting> 
    <application> 
      <channels> 
          <!-- change port here -->
          <channel ref="tcp" port="21234">              
          <serverProviders> 
            <formatter ref="binary" typeFilterLevel="Full"/> 
          </serverProviders> 
        </channel> 
      </channels> 
    </application> 
  </system.runtime.remoting> 
```

# python - Python - 在装饰器中获取原始函数参数

> ID：1010080
> 
> 赞同：47
> 
> 时间：2009-06-17T23:55:25.243
> 
> 标签：python, decorator

我正在尝试为 WSGI+Werkzeug 应用程序中的视图编写“login_required”装饰器。

为此，我需要访问用户的会话，该会话可通过传递给视图方法的 Request 对象访问。

不过，我不知道如何在装饰器中获取 Request 实例。我查看了 PEP318，特别是第四个示例，但我不太明白。

这是我正在尝试的：

```
def login_required(*args, **kw):
    def goto_login(**kw):
        return redirect(url_for('login'))

    def decorate(f):
        # args[0] should be request
        args[0].client_session['test'] = True
        logged_in = 0
        if logged_in:
            return f
        else:
            return goto_login
    return decorate

@login_required()
@expose('/hello/<string:name>')
def hello(request, name):
    return render_template('say_hello.html', name=name) 
```

但我在尝试调用时遇到索引越界错误`args[0]`。

有什么方法可以访问传递给“login_required”装饰器中“hello”函数的请求参数？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-06-18T00:02:17.227

装饰器`login_required`被传递给函数（`hello`在这种情况下）。

所以你想做的是：

```
def login_required(f):
    # This function is what we "replace" hello with
    def wrapper(*args, **kw):
        args[0].client_session['test'] = True
        logged_in = 0
        if logged_in:
            return f(*args, **kw)  # Call hello
        else:
            return redirect(url_for('login'))
    return wrapper 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2017-05-28T13:54:55.120

`kwargs`是一个字典，包含作为键的参数和作为值的值。

所以你需要做的就是检查： `some_var = kw['my_property']`

# java - 用于 Java 的 RTSP 库

> ID：1010084
> 
> 赞同：0
> 
> 时间：2009-06-17T23:56:49.017
> 
> 标签：java, rtsp

我正在寻找一个 RTSP Java 库，但我没有找到任何东西。有人可以建议我使用 Java 库来处理 RTSP 吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-06-09T16:53:40.117

我不知道你是否还需要那个。我用 Java 编写了一个小型 RTSP 客户端库，我希望能得到一些反馈。此外，它可以扩展为实现服务器端。

该项目的链接是[http://code.google.com/p/rtsplib-java/](http://code.google.com/p/rtsplib-java/)

问候，保罗。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-11T23:55:58.990

Here is one in C# if you wanna port something [http://net7mma.codeplex.com/](http://net7mma.codeplex.com/)

# sharepoint - 工作流和信息路径

> ID：1010086
> 
> 赞同：0
> 
> 时间：2009-06-17T23:56:54.913
> 
> 标签：sharepoint, workflow, infopath

我是否需要在本地安装 Infopath 才能在 sharepoint 的工作流程中编辑表单？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T12:32:44.643

**创作 InfoPath 表单**

如果一个人需要创建一个新的 Infopath 表单或需要更改现有表单的布局，则需要使用 InfoPath 客户端。

表单布局和数据结构保存为 XML，因此可能会尝试对其进行编辑，但我建议您不要乱用它。

**填写表格**

为了填写表格，有两种情况：

1.  用户通过 Web 浏览器填写表单（不需要 InfoPath 客户端）
2.  用户通过 InfoPath 客户端填写表单

第一个选项听起来很有趣，但确实存在限制：

*   您必须购买 MOSS Enterprise 许可证（有关 SharePoint 版本之间的差异，请查看：此处的[概述](http://www.sharepointusecases.com/index.php/2007/08/which-sharepoint-edition-is-right-for-you)或[详细信息](http://office.microsoft.com/en-us/sharepointserver/FX101758881033.aspx#5)）。可以选择购买专用的 Forms Server。
*   作为 Web 表单的 Infopath 不支持作为 Infopath 客户端表单的所有功能
*   尽管网络表单听起来很吸引人，但我的经验告诉我，最重要的功能在网络版中不可用。[在这里查看详细列表](http://office.microsoft.com/en-us/infopath/HA102040851033.aspx)。

**默认工作流表单**

您最初的问题尚不清楚，但如果您正在谈论编辑默认工作流表单，如批准工作流表单（即 InfoPath），则没有简单的方法可以做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T08:14:23.963

只要您的表单支持浏览器并且您在 MOSS 上运行（以使用 InfoPath Forms Services），您就不需要 InfoPath。

如果您使用的是普通 WSS，则需要安装 InfoPath 来填写表格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T00:38:54.267

如果表单存储在 SharePoint 文档库中，我认为没有必要这样做。

您的意思是编辑单个表单，还是设计一个表单？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T07:07:20.587

是的，您会这样做，它将在站点中呈现为 HTML，但要对其进行编辑，您需要一份 infopath.xml 的副本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-29T06:19:24.367

如果你只是一个用户，而且它是一个 web 表单，那么你不需要安装软件，否则你应该。这取决于 InfoPath 显示的形式。

如果您是开发人员，则必须将其安装在本地，以便编辑和部署模板。

# jquery - 如何将jQuery插件拆分为多个文件

> ID：1010089
> 
> 赞同：8
> 
> 时间：2009-06-17T23:57:59.810
> 
> 标签：jquery, file, plugins, extend

我正在编写一个小型 CMS 作为 jQuery AJAX 插件，虽然它绝不会太长（目前大约 500 行），但我可以看到能够将它拆分为单独的文件会很好，每个“子类”一个文件：

```
(function($) {
    $.fn.myCMS = function() {
        this.classOne = function() {
        ...
        }
        this.classTwo = function() {
        ...
        }
    }
})(jQuery); 
```

在上面的示例中，我想将 classOne 的代码放在一个文件中，将 classTwo 放在另一个文件中，将 myCMS“基类”放在第三个文件中。是否有可能用这样的东西（在每个“子类”文件中）来实现这一点？

```
$.extend(myCMS,classOne = function() {
...
}) 
```

非常感谢，

JS

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-12-12T14:16:30.967

您想添加到具有私有范围/关注点分离的“插件”中。这对于基于插件的 Web 应用程序的维护和长期可扩展性非常重要，无论所有内容是构建到一个文件还是多个文件中。

您可以通过直接附加方法或添加到 jQuery.fn.foo 方法的原型来创建私有范围并扩展现有的 jQuery.fn 方法

```
(function ($) {

     // instance method attached to the constructor function
     $.fn.myCMS.classOne = function () {

     };

     // or "shared" method attached to prototype
     $.fn.myCMS.prototype.classOne = function() {

     };

})(jQuery); 
```

您可以使用 jQuery.extend()，在这种情况下，它实际上是一种“速记”，用于将方法添加到构造函数实例中，就像上面的第一个方法一样。您必须将要添加的任何内容封装到一个对象中（通常这将是一个匿名对象）：

```
$.extend($.fn.myCMS,{ classOne: function () { } }); 
```

从设计的角度来看，如果您有“类”需要经常获取相同的封闭变量，它们可能应该是同一个函数作用域/封闭的一部分，或者您应该为这些封闭变量公开 getter 和 setter（可能使用 _foo 约定这表明它们仅供您的代码使用）。

```
(function ($) {

    var foo = "foo!";

    // combined getter/setter
    // could also check arguments.length
    $.fn.myCMS._foo = function (value) {
          if (typeof(value) != "undefined") {
               foo = value;
          } else {
               return foo;
          }
    };

)(jQuery); 
```

如果你想成为一名黑客，并且需要从不同的范围获取封闭变量，我相信你可以通过使用其他范围的 .call() 或 .apply() 在它们自己的范围内执行这些新方法来做到这一点。我可以尝试制作一些有关其工作原理的示例，但是如果您自己研究范围解析在这些场景中的工作原理，那将是一个好主意。

我相信您可以通过使用 with ($.fn.myCMS) { } 构造从原始“插件”方法中“借用”范围，但我对此并不是 100% 肯定，因为我自己没有做过，只是阅读关于它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-09T07:51:30.340

还有助于查看 jQuery ui 代码。例如，进度条插件需要三个文件 ui.core、ui.widget 和 ui.progressbar。下载 jQuery UI 源包并查看 demos 目录下的进度条示例。（我找不到托管在任何地方的简化版本，但源包有简化示例）

# ruby-on-rails - Rails“徽章”类型插件/教程？

> ID：1010096
> 
> 赞同：6
> 
> 时间：2009-06-17T23:59:08.607
> 
> 标签：ruby-on-rails, badge, achievements

有谁知道是否有 Rails gem/plugin/tutorial 显示如何创建类似于 stackoverflow 使用的徽章/成就系统。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-02-02T20:04:18.500

您可能还想尝试成就宝石：[https ://github.com/mrb/achievements](https://github.com/mrb/achievements)

它基于 Redis，所以你需要先让它工作。基本上，如果需要，您可以定义一堆成就上下文（查看的页面、发送的消息等）以及多个级别。然后，您在某些事件上适当地增加您的价值，然后您可以检查是否已达到成就。

这个链接也对徽章/成就系统背后的思想进行了比较详细的解释：[RoR成就系统-多态关联和设计问题](https://stackoverflow.com/questions/3538282/ror-achievement-system-polymorphic-association-design-issues)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-08T03:39:09.287

查看[https://github.com/paulca/paths_of_glory](https://github.com/paulca/paths_of_glory)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T14:24:08.763

我认为这不是一个框架，而是一个设计问题。如果您知道如何以面向对象的方式构建它，那么您最终也会知道如何在 Rails 中构建它。

如果您是 Rails 新手，请查看[Rails 指南中的“活动记录关联”](http://guides.rubyonrails.org/association_basics.html)并尝试识别“徽章/成就系统”的模型和关联。

除此之外：不，我不知道任何可以帮助您构建这样一个系统的交钥匙宝石/插件/教程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-08-15T06:39:57.063

还有Gioco，我还没试过：http: [//joaomdmoura.github.io/gioco/](http://joaomdmoura.github.io/gioco/)

# sharepoint - 如何获得重复的 SharePoint 日历列表项

> ID：1010099
> 
> 赞同：0
> 
> 时间：2009-06-17T23:59:59.807
> 
> 标签：sharepoint, caml, spquery

我在与 Web 应用程序相同的服务器上运行此查询，因此 SPQuery.ExpandRecurrence 应该可以工作。但是，使用以下内容，我在返回的列表集合中只得到 3 个项目，而这 3 个项目和重复出现，所有这些都属于当月。

我确实使用 Stramit Caml Viewer 验证了查询是否有效，并返回了相同的 3 个项目。

请告诉我我遗漏了一些明显的东西吗？

```
 static SPListItemCollection GetSourceColl(SPList list)
    {
        SPQuery query = new SPQuery();
        query.ExpandRecurrence = true;
        query.CalendarDate = new DateTime(DateTime.Now.Year,DateTime.Now.Month, 1);

        System.Text.StringBuilder oSb = new System.Text.StringBuilder();

        oSb.Append("     <Query xmlns=\"http://schemas.microsoft.com/sharepoint/soap/\">");
        oSb.Append("         <Where>");
        oSb.Append("              <And>");
        oSb.Append("                   <DateRangesOverlap>");
        oSb.Append("                        <FieldRef Name=\"EventDate\" />");
        oSb.Append("                        <FieldRef Name=\"EndDate\" />");
        oSb.Append("                        <FieldRef Name=\"RecurrenceID\" />");
        oSb.Append("                        <Value Type=\"DateTime\">");
        oSb.Append("                             <Month />");
        oSb.Append("                        </Value>");
        oSb.Append("                   </DateRangesOverlap>");
        oSb.Append("                   <And>");
        oSb.Append("                        <And>");
        oSb.Append("                             <Eq>");
        oSb.Append("                                  <FieldRef Name=\"Status\" />");
        oSb.Append("                                  <Value Type=\"Text\">Finalized</Value>");
        oSb.Append("                             </Eq>");
        oSb.Append("                             <Leq>");
        oSb.Append("                                  <FieldRef Name=\"DistributionStartDate\" />");
        oSb.Append("                                  <Value Type=\"DateTime\">");
        oSb.Append("                                       <Today />");
        oSb.Append("                                  </Value>");
        oSb.Append("                             </Leq>");
        oSb.Append("                        </And>");
        oSb.Append("                        <Neq>");
        oSb.Append("                             <FieldRef Name=\"Distribution\" />");
        oSb.Append("                             <Value Type=\"Text\">Intranet</Value>");
        oSb.Append("                        </Neq>");
        oSb.Append("                   </And>");
        oSb.Append("              </And>");
        oSb.Append("         </Where>");
        oSb.Append("    </Query>");
        query.Query = oSb.ToString();

        return list.GetItems(query);
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T14:11:53.693

我不熟悉查询日历项目，但是我在使用`<Query>`SPQuery.Query 属性的标签时遇到了问题。如果删除这两行，它是否可以正常工作：

```
oSb.Append("<Query xmlns=\"http://schemas.microsoft.com/sharepoint/soap/\">");
...
oSb.Append("</Query>"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-13T02:58:13.650

将 ViewName tie 传递给您的自定义查询是个好主意，如下所示

```
 private SPListItemCollection GetSourceColl(SPList list, string viewName)
{
    SPQuery query = new SPQuery();
    query.ExpandRecurrence = true;
    query.CalendarDate = new DateTime(DateTime.Now.Year, DateTime.Now.Month, 1);
    System.Text.StringBuilder oSb = new System.Text.StringBuilder();
    oSb.Append("<Query xmlns=\"http://schemas.microsoft.com/sharepoint/soap/\">");
    oSb.Append("         <Where>"); oSb.Append("              <And>");
    oSb.Append("                   <DateRangesOverlap>");
    oSb.Append("                        <FieldRef Name=\"EventDate\" />");
    oSb.Append("                        <FieldRef Name=\"EndDate\" />");
    oSb.Append("                        <FieldRef Name=\"RecurrenceID\" />");
    oSb.Append("                        <Value Type=\"DateTime\">");
    oSb.Append("                             <Month />");
    oSb.Append("                        </Value>");
    oSb.Append("                   </DateRangesOverlap>");
    oSb.Append("                   <And>");
    oSb.Append("                        <And>");
    oSb.Append("                             <Eq>");
    oSb.Append("                                  <FieldRef Name=\"Status\" />");
    oSb.Append("                                  <Value Type=\"Text\">Finalized</Value>");
    oSb.Append("                             </Eq>");
    oSb.Append("                             <Leq>");
    oSb.Append("                                  <FieldRef Name=\"DistributionStartDate\" />");
    oSb.Append("                                  <Value Type=\"DateTime\">");
    oSb.Append("                                       <Today />");
    oSb.Append("                                  </Value>");
    oSb.Append("                             </Leq>");
    oSb.Append("                        </And>");
    oSb.Append("                        <Neq>");
    oSb.Append("                             <FieldRef Name=\"Distribution\" />");
    oSb.Append("                             <Value Type=\"Text\">Intranet</Value>");
    oSb.Append("                        </Neq>");
    oSb.Append("                   </And>");
    oSb.Append("              </And>");
    oSb.Append("         </Where>");
    oSb.Append("    </Query>");
    query.Query = oSb.ToString();
    SPListItemCollection itemColl = null;
    if (string.IsNullOrEmpty(viewName))
    {
        itemColl = list.GetItems(query);
    }
    else
    {
        itemColl =  list.GetItems(query, viewName);
    }
    return itemColl;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T07:14:26.547

嘿，您使用的是什么列表视图？

由于您没有指定从中检索项目的视图，因此它会从默认视图中获取查询结果。

您的默认视图是否有可能不是日历视图？因为我认为 ExpandRecurrence 仅适用于日历视图，而不适用于任何其他视图。

# svn - subversion 使用 SVNParentPath 阻止在文件夹中列出存储库

> ID：1010101
> 
> 赞同：3
> 
> 时间：2009-06-18T00:00:35.640
> 
> 标签：svn, permissions, access-control

我的域上有几个存储库：svn.domain.com

它将按 SVNParentPath 配置列出存储库。

我想为每个文件夹/存储库创建用户权限，但如果用户无权访问它，我想从列表中删除该存储库。

这主要适用于只需要访问一个给定存储库并且不应该看到我们正在处理的其他项目的外部人员。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-05T18:14:58.533

Subversion 本身不处理权限 - 您需要在访问 subversion 的 apache 服务器中配置权限：

```
<Directory /usr/local/svn/repo>
  AuthType Basic
  AuthName intranet
  AuthUserFile /www/passwd/users
  AuthGroupFile /www/passwd/groups
  Require group customers
  Order allow,deny
  Allow from internal.com
  Satisfy any
</Directory> 
```

当然你可以使用任何[apache支持的认证方式](http://httpd.apache.org/docs/1.3/howto/auth.html#access)

# python - 如何从原始 HTTP 请求字节流构造 webob.Request 或 WSGI 'environ' dict？

> ID：1010103
> 
> 赞同：3
> 
> 时间：2009-06-18T00:00:43.703
> 
> 标签：python, wsgi, webob

假设我有一个字节流，其中包含以下内容：

```
POST /mum/ble?q=huh
内容长度：18
内容类型：应用程序/json；字符集="utf-8"
主机：本地主机：80

[“做”，“重新”，“我”]

```

有没有办法从中生成 WSGI 风格的“环境”字典？

希望我忽略了一个简单的答案，它与相反的操作一样容易实现。考虑：

```
>>> import json
>>> from webob import Request
>>> r = Request.blank('/mum/ble?q=huh')
>>> r.method = 'POST'
>>> r.content_type = 'application/json'
>>> r.charset = 'utf-8'
>>> r.body = json.dumps(['do', 're', 'mi'])
>>> print str(r) # Request's __str__ method gives raw HTTP bytes back! 
```

```
POST /mum/ble?q=huh
内容长度：18
内容类型：应用程序/json；字符集="utf-8"
主机：本地主机：80

[“做”，“重新”，“我”]

```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T03:27:59.043

为此目的重用 Python 的标准库代码有点棘手（它的设计初衷不是为了这样重用！-），但应该是可行的，例如：

```
import cStringIO
from wsgiref import simple_server, util

input_string = """POST /mum/ble?q=huh HTTP/1.0
Content-Length: 18
Content-Type: application/json; charset="utf-8"
Host: localhost:80

["do", "re", "mi"]
"""

class FakeHandler(simple_server.WSGIRequestHandler):
    def __init__(self, rfile):
        self.rfile = rfile
        self.wfile = cStringIO.StringIO() # for error msgs
        self.server = self
        self.base_environ = {}
        self.client_address = ['?', 80]
        self.raw_requestline = self.rfile.readline()
        self.parse_request()

    def getenv(self):
        env = self.get_environ()
        util.setup_testing_defaults(env)
        env['wsgi.input'] = self.rfile
        return env

handler = FakeHandler(rfile=cStringIO.StringIO(input_string))
wsgi_env = handler.getenv()

print wsgi_env 
```

基本上，我们需要对请求处理程序进行子类化，以伪造通常由服务器为其执行的构造过程（`rfile`并`wfile`从套接字构建到客户端，等等）。我认为这还不是很完整，但应该很接近，我希望它会有所帮助！

请注意，我还修复了您的示例 HTTP 请求：`HTTP/1.0`在原始请求行的末尾没有 or 1.1，a`POST`被认为是格式错误的，并导致异常并在`handler.wfile`.

# c++ - 如何调试堆损坏错误？

> ID：1010106
> 
> 赞同：173
> 
> 时间：2009-06-18T00:01:42.190
> 
> 标签：c++, windows, debugging, heap-corruption

我正在 Visual Studio 2008 下调试（本机）多线程 C++ 应用程序。在看似随机的情况下，我收到“Windows 已触发断点...”错误，并指出这可能是由于堆。这些错误不会总是立即使应用程序崩溃，尽管它可能会在不久之后崩溃。

这些错误的最大问题是它们仅在实际发生损坏后才会弹出，这使得它们很难跟踪和调试，尤其是在多线程应用程序上。

*   什么样的事情会导致这些错误？

*   我该如何调试它们？

欢迎使用提示、工具、方法、启示……。

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2009-06-18T04:46:28.500

[应用程序验证器](http://msdn.microsoft.com/en-us/library/ms220948.aspx)与[Windows 调试工具](http://msdn.microsoft.com/en-us/library/windows/hardware/ff551063.aspx)相结合是一个了不起的设置。您可以将两者作为[Windows Driver Kit 的一部分或较轻的 Windows SDK 获得](http://msdn.microsoft.com/en-us/windows/hardware/hh852365)。[（在研究有关堆损坏问题的早期问题](https://stackoverflow.com/questions/811951/mt-and-md-builds-crashing-but-only-when-debugger-isnt-attached-how-to-debug)时发现了 Application Verifier 。）我过去也使用过 BoundsChecker 和 Insure++（在其他答案中提到），尽管我很惊讶 Application Verifier 中有多少功能。

Electric Fence（又名“efence”）、[dmalloc](http://dmalloc.com/)、[valgrind](http://valgrind.org/)等都值得一提，但其中大多数在 *nix 下比在 Windows 下运行要容易得多。Valgrind 非常灵活：我使用它调试过存在许多堆问题的大型服务器软件。

当所有其他方法都失败时，您可以提供自己的全局运算符 new/delete 和 malloc/calloc/realloc 重载——如何这样做会因编译器和平台而异——这将是一项投资——但从长远来看，它可能会有所回报。dmalloc 和electricfence 以及令人惊讶的优秀书籍[Writing Solid Code](https://rads.stackoverflow.com/amzn/click/com/1556155514)中的理想功能列表应该看起来很熟悉：

*   **哨兵值**：在每个分配之前和之后允许更多的空间，尊重最大对齐要求；填充幻数（有助于捕获缓冲区溢出和下溢，以及偶尔的“野生”指针）
*   **alloc fill**：用一个神奇的非 0 值填充新分配——Visual C++ 已经在调试版本中为您执行此操作（有助于捕获未初始化变量的使用）
*   **free fill**：用一个神奇的非 0 值填充已释放的内存，旨在在大多数情况下取消引用时触发段错误（有助于捕获悬空指针）
*   **延迟释放**：暂时不要将释放的内存返回到堆中，保持空闲填充但不可用（有助于捕获更多悬空指针，捕获接近的双释放）
*   **跟踪**：能够记录分配的位置有时很有用

请注意，在我们的本地自制系统（对于嵌入式目标）中，我们将跟踪与大多数其他内容分开，因为运行时开销要高得多。

* * *

如果您对重载这些分配函数/运算符的更多原因感兴趣，请查看[我对“任何理由重载全局运算符 new 和 delete？”的回答。](https://stackoverflow.com/a/1215807/80074); 除了无耻的自我推销之外，它还列出了有助于跟踪堆损坏错误的其他技术，以及其他适用的工具。

* * *

因为在搜索 MS 使用的 alloc/free/fence 值时，我一直在这里找到自己的答案，所以这是[另一个涵盖 Microsoft dbgheap fill values](https://stackoverflow.com/a/370362/80074)的答案。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-06-18T04:24:34.610

您可以通过为您的应用程序启用 Page Heap 来检测很多堆损坏问题。为此，您需要使用作为[Windows 调试工具一部分的 gflags.exe](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/)

运行 Gflags.exe 并在可执行文件的图像文件选项中，选中“启用页面堆”选项。

现在重新启动您的 exe 并附加到调试器。启用页堆后，只要发生任何堆损坏，应用程序就会进入调试器。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-01-13T23:37:16.190

To really slow things down and perform a lot of runtime checking, try adding the following at the top of your `main()` or equivalent in Microsoft Visual Studio C++

```
_CrtSetDbgFlag(_CRTDBG_ALLOC_MEM_DF | _CRTDBG_LEAK_CHECK_DF | _CRTDBG_CHECK_ALWAYS_DF ); 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-08-06T09:17:27.790

一篇非常相关的文章是*[使用 Application Verifier 和 Debugdiag 调试堆损坏](http://blogs.msdn.com/lagdas/archive/2008/06/24/debugging-heap-corruption-with-application-verifier-and-debugdiag.aspx)*。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-06-18T08:54:18.327

我从[Detecting access to free memory](http://smallcode.weblogs.us/oldblog/2006/12/28/detecting-access-to-freed-memory/ "检测对释放内存的访问")中得到的一个快速提示是：

> 如果想快速定位错误，不检查每条访问内存块的语句，可以在释放块后将内存指针设置为无效值：
> 
> ```
> #ifdef _DEBUG // detect the access to freed memory
> #undef free
> #define free(p) _free_dbg(p, _NORMAL_BLOCK); *(int*)&p = 0x666;
> #endif 
> ```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-06-18T00:09:33.063

> 什么样的事情会导致这些错误？

用内存做一些调皮的事情，例如在缓冲区结束后写入，或者在缓冲区被释放回堆后写入缓冲区。

> 我该如何调试它们？

使用向可执行文件添加自动边界检查的工具：即 Unix 上的 valgrind，或 Windows 上的 BoundsChecker（维基百科也建议 Purify 和 Insure++）之类的工具。

请注意，这些会减慢您的应用程序，因此如果您的应用程序是软实时应用程序，它们可能无法使用。

另一个可能的调试辅助工具/工具可能是 MicroQuill 的 HeapAgent。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-06-18T04:20:42.877

我发现每次都有用且有效的最佳工具是代码审查（与优秀的代码审查者一起）。

除了代码审查，我会先尝试[Page Heap](http://technet.microsoft.com/en-us/library/cc783985(WS.10).aspx)。Page Heap 需要几秒钟的时间来设置，如果幸运的话，它可能会查明您的问题。

如果 Page Heap 不成功，请从 Microsoft 下载[适用于 Windows 的调试工具](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx)并学习使用 WinDbg。抱歉无法为您提供更具体的帮助，但调试多线程堆损坏更像是一门艺术而不是科学。谷歌搜索“WinDbg heap corruption”，你会发现很多关于这个主题的文章。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-02-04T01:20:28.437

您可能还想检查是否链接到动态或静态 C 运行时库。如果您的 DLL 文件链接到静态 C 运行时库，则 DLL 文件具有单独的堆。

因此，如果您要在一个 DLL 中创建一个对象并尝试在另一个 DLL 中释放它，您将收到与上面相同的消息。这个问题在另一个堆栈溢出问题中引用，*[释放在不同 DLL 中分配的内存](https://stackoverflow.com/questions/1634773/freeing-memory-allocated-in-a-different-dll)*。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-06-18T00:25:27.133

您使用的是什么类型的分配函数？我最近使用 Heap* 样式分配函数遇到了类似的错误。

事实证明，我错误地使用该`HEAP_NO_SERIALIZE`选项创建了堆。这实质上使堆函数在没有线程安全的情况下运行。如果使用得当，它会提高性能，但如果您在多线程程序中使用 HeapAlloc [1]，则不应该使用它。我只提到这一点是因为您的帖子提到您有一个多线程应用程序。如果您在任何地方使用 HEAP_NO_SERIALIZE，请将其删除，它可能会解决您的问题。

[1] 在某些情况下这是合法的，但它要求您序列化对 Heap* 的调用，并且通常不适用于多线程程序。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-06-18T17:39:51.080

如果这些错误是随机发生的，那么您很可能会遇到数据争用。请检查：您是否修改了来自不同线程的共享内存指针？英特尔线程检查器可能有助于检测多线程程序中的此类问题。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-11-07T11:28:36.313

[**您可以对_CrtSetDbgFlag**](http://msdn.microsoft.com/en-us/library/5at7yxcs%28v=vs.80%29.aspx)使用 VC CRT 堆检查宏：**_CRTDBG_CHECK_ALWAYS_DF**或**_CRTDBG_CHECK_EVERY_16_DF** .. **_CRTDBG_CHECK_EVERY_1024_DF**。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-06-18T00:29:20.340

除了寻找工具外，还要考虑寻找可能的罪魁祸首。是否有任何您正在使用的组件，可能不是您编写的，可能未经设计和测试以在多线程环境中运行？或者只是你不*知道*的一个在这样的环境中运行。

上次发生在我身上时，它是一个本机包，多年来已成功地从批处理作业中使用。但这是这家公司第一次在 .NET Web 服务（多线程）中使用它。就是这样——他们谎称代码是线程安全的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-05-23T16:40:39.163

我想补充一下我的经验。在过去的几天里，我在我的应用程序中解决了这个错误的一个实例。在我的特殊情况下，代码中的错误是：

*   在迭代它时从 STL 集合中删除元素（我相信 Visual Studio 中有调试标志来捕获这些东西；我在代码审查期间发现了它）
*   这个比较复杂，我会分步进行：
    *   从本机 C++ 线程回调托管代码
    *   在托管域中，调用`Control.Invoke`和处理一个托管对象，该对象包装了回调所属的本机对象。
    *   由于对象在本机线程中仍然存在（它将在回调调用中保持阻塞直到`Control.Invoke`结束）。我应该澄清我使用`boost::thread`，所以我使用成员函数作为线程函数。
    *   **解决方案**：改用`Control.BeginInvoke`（我的GUI是用Winforms制作的），以便在对象被销毁之前可以结束本机线程（回调的目的是准确地通知线程结束并且可以销毁对象）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-10-30T22:18:33.973

我有一个类似的问题 - 它非常随机地弹出。也许构建文件中的某些内容已损坏，但我最终通过先清理项目然后重建来修复它。

因此，除了给出的其他回复：

**什么样的事情会导致这些错误？** 构建文件中的某些内容已损坏。

**我该如何调试它们？** 清理项目并重建。如果它已修复，这可能是问题所在。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-08-12T06:45:38.703

我也遇到过这个问题。就我而言，我分配了 x 大小的内存并附加了 x+n 大小的数据。因此，当释放它时显示堆溢出。只需确保您分配的内存足够并检查内存中添加了多少字节即可。

# java - Java、XSLT：如何在 XSLT 中处理 Axis 生成的动态命名空间

> ID：1010110
> 
> 赞同：1
> 
> 时间：2009-06-18T00:02:38.117
> 
> 标签：java, xslt

我有一个应用程序调用 Web 服务（基于轴）以获取以下格式的响应：

```
<?xml 版本="1.0"?>
<soapenv:信封 xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
    <soapenv:正文>
        <axis2ns394:ServiceLevelDetailsResponse xmlns:axis2ns394="urn:myco:com:mapping:service:3.0">
            <ns1:errorFlag xmlns:ns1="urn:myco:com:mapping:service:3.0">false</ns1:errorFlag>
            <axis2ns394:customerProgram>
                <axis2ns394:name>ABC</axis2ns394:name>
                <axis2ns394:description>ABC 服务</axis2ns394:description>
                <axis2ns394:programRank>1</axis2ns394:programRank>
                <axis2ns394:bindOptions>
                    <axis2ns394:name>PRO1A</axis2ns394:name>
                    <axis2ns394:description>完整的家庭解决方案</axis2ns394:description>
                    <axis2ns394:programName>促销</axis2ns394:programName>
                    <axis2ns394:programDescription>促销包 1A</axis2ns394:programDescription>
                </axis2ns394:bindOptions>
                <axis2ns394:bindOptions>
                    <axis2ns394:name>PRO2A</axis2ns394:name>
                    <axis2ns394:description>买1送1</axis2ns394:description>
                    <axis2ns394:programName>促销</axis2ns394:programName>
                    <axis2ns394:programDescription>促销包 2A</axis2ns394:programDescription>
                </axis2ns394:bindOptions>
            </axis2ns394:customerProgram>
        </axis2ns394:ServiceLevelDetailsResponse>
    </soapenv:正文>
</soapenv:信封>

```

这里 - 命名空间“axis2ns394”是在运行时动态生成的。我需要编写一个 XSLT 来将此 XML 展平为一个更简单的 XML（比如一个 html 表，每个“customerProgram”都有一行）。但我不确定如何处理这些动态命名空间。

任何帮助将不胜感激。

问候，
-阿什什

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T00:30:07.733

*命名空间*是动态的，还是命名空间***前缀***是动态的？

XML 的实际命名空间是**`urn:myco:com:mapping:service:3.0`**

因此，转换结果的示例样式表不需要知道命名空间*前缀*是什么，而是知道*命名空间*是什么。您可以在 XSLT 中使用不同的名称空间前缀，只要您正确声明*名称空间*，它将匹配元素。

例如，这个样式表为*命名空间***urn:myco:com:mapping:service:3.0声明命名空间***前缀* **myco**：

 ***```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" 
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:myco="urn:myco:com:mapping:service:3.0"
>

<xsl:template match="/">
<table border="1">
<thead>
<tr>
 <th>Name</th>
 <th>Description</th>
 <th>Program Rank</th>
</tr>
</thead>
  <xsl:apply-templates select="//myco:customerProgram" />
</table>
</xsl:template>

<xsl:template match="myco:customerProgram">
<tr>
  <td>
   <xsl:value-of select="myco:name" />
  </td>
 <td>
   <xsl:value-of select="myco:description" />
  </td>
 <td>
   <xsl:value-of select="myco:programRank" />
  </td>

</tr>
</xsl:template>
</xsl:stylesheet> 
```

会产生：

```
<table border="1">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Program Rank</th>
</tr>
</thead>
<tbody>
<tr>
<td>ABC</td>
<td>ABC SERVICES</td>
<td>1</td>
</tr>
</tbody>
</table> 
```***

# vb.net - 有没有办法比较忽略时间的 Date 对象？

> ID：1010113
> 
> 赞同：3
> 
> 时间：2009-06-18T00:03:38.253
> 
> 标签：vb.net, datetime

有没有办法在忽略时间的情况下比较两个日期（包括时间）？

我有一个 2009 年 1 月 1 日上午 8:00 和 2009 年 1 月 1 日上午 9:00，我只想知道它是否是同一天，而不关心它是什么时间。

我知道我可以转换日期并比较字符串，但还有其他方法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-18T00:06:47.217

是的，您可以使用您正在使用的 Date 对象的 .Date 属性。

```
dim originalDate as DateTime
originalDate = '(get your date for comparison)
if originalDate.Date = Datetime.now.date then
  'it happened today.
end if 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T00:06:54.800

```
dim Date1 = firstdate.ToShortDateString
dim Date2 = seconddate.ToShortDateString
if (Date1 = Date2) then
   'Dates Match!
   return true;
else return false 
```

# c - 为什么运算符在 CShell 中是右结合的，而在 C 中是左结合的？

> ID：1010119
> 
> 赞同：1
> 
> 时间：2009-06-18T00:05:20.717
> 
> 标签：c, operators, csh

继[我之前的问题](https://stackoverflow.com/questions/1010049/in-csh-why-does-4-3-1-0)之后，为什么 CShell 与 C 如此不同？

*   4 - 3 + 1 = 2 在 C 中。
*   4 - 3 + 1 = 0 在 CShell 中。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T21:42:41.117

通常，人类论文中的传统符号是从左到右（左结合）。所以对于人类（早在 c、csh 甚至任何计算机概念之前就使用过这个符号）：

```
4 - 3 + 1 = (4 - 3) + 1 = 1 + 1 = 2 
```

为什么？我想最好的答案是因为。这与在道路左侧或右侧行驶相同。只要每个人都使用相同的一面，那实际上并不重要。

恕我直言，csh 是错误的，因为它违反直觉。可能这是一个错误（他们希望留下关联但编码错误）并成为遗留问题，因为其他事情已经依赖于此。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T00:32:36.870

不同的人编写产品，他们对如何处理计算有不同的看法。而且由于 C Shell 是第二个编写的，我认为他们没有遵循名义上的父语言的领导是错误的。

# java - Java Regex 中的最大组数

> ID：1010120
> 
> 赞同：0
> 
> 时间：2009-06-18T00:05:43.850
> 
> 标签：java, regex

我曾假设最大值是 9，但经过一些实验后我知道它不是。[Pattern](http://java.sun.com/javase/6/docs/api/java/util/regex/Pattern.html)和[Matcher](http://java.sun.com/javase/6/docs/api/java/util/regex/Matcher.html)的 javadocs没有列出最大值。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T01:02:04.440

没有明确的上限，所以理论上最大值是 Integer.MAX_VALUE。实际上，最大值会根据可用资源而有所不同，但我敢肯定它比您需要的要多得多。

# url - 您可以传递给 Wininet 函数 HttpOpenRequest 的最大 URL 长度是多少？

> ID：1010121
> 
> 赞同：3
> 
> 时间：2009-06-18T00:06:04.117
> 
> 标签：url, wininet

您可以传递给 Wininet 函数 HttpOpenRequest 的最大 URL 长度是多少？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-18T10:50:35.843

WinInet.h 中有一些最大长度常量：

```
...
//
// maximum field lengths (arbitrary)
//

#define INTERNET_MAX_HOST_NAME_LENGTH   256
#define INTERNET_MAX_USER_NAME_LENGTH   128
#define INTERNET_MAX_PASSWORD_LENGTH    128
#define INTERNET_MAX_PORT_NUMBER_LENGTH 5           // INTERNET_PORT is unsigned short
#define INTERNET_MAX_PORT_NUMBER_VALUE  65535       // maximum unsigned short value
#define INTERNET_MAX_PATH_LENGTH        2048
#define INTERNET_MAX_SCHEME_LENGTH      32          // longest protocol name length
#define INTERNET_MAX_URL_LENGTH         (INTERNET_MAX_SCHEME_LENGTH \
                                        + sizeof("://") \
                                        + INTERNET_MAX_PATH_LENGTH)
... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T00:27:15.600

HttpOpenRequest 没有最大长度，但您所针对的服务器软件可能会对您的 URL 长度有限制。

> **阿帕奇（服务器）**
> 
> 我早期尝试在 Web 浏览器中测量最大 URL 长度时遇到了大约 4,000 个字符的服务器 URL 长度限制，之后 Apache 产生“413 Entity Too Large”错误。我使用了 Red Hat Enterprise Linux 4 中最新的 Apache 版本。官方的 Apache 文档只提到了请求中单个字段的 8,192 字节限制。
> 
> **Microsoft Internet 信息服务器（服务器）**
> 
> 默认限制为 16,384 个字符（是的，Microsoft 的 Web 服务器接受比 Microsoft 的 Web 浏览器更长的 URL）。这是可配置的。
> 
> **Perl HTTP::守护进程（服务器）**
> 
> 最多 8,000 个字节可以工作。那些使用 Perl 的 HTTP::Daemon 模块构建 Web 应用程序服务器的人将遇到所有 HTTP 请求标头的总大小限制为 16,384 字节。这不包括 POST 方法的表单数据、文件上传等，但它确实包括 URL。实际上，当 URL 明显超过 8,000 个字符时，这会导致 413 错误。这个限制可以很容易地消除。在 Daemon.pm 中查找所有出现的 16x1024 并将它们替换为更大的值。当然，这确实会增加您遭受拒绝服务攻击的风险。

（来自[Boutell.com](http://www.boutell.com/newfaq/misc/urllength.html)）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T00:11:08.380

[我建议少于 2000 个字符。](https://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-an-url/417184#417184)，但是这篇[知识库文章](http://support.microsoft.com/kb/q208427/)建议 Internet Explorer 的限制为 2083，这也可能适用于您的情况。

# c# - 命名为String.Format，有可能吗？

> ID：1010123
> 
> 赞同：34
> 
> 时间：2009-06-18T00:06:23.960
> 
> 标签：c#, string.format

而不是使用`{0} {1}`等。我想使用`{title}`。然后以某种方式填充该数据（在下面我使用了 a `Dictionary`）。此代码无效并引发异常。我想知道我是否可以做一些类似于我想要的事情。使用`{0 .. N}`不是问题。我只是好奇而已。

```
Dictionary<string, string> d = new Dictionary<string, string>();
d["a"] = "he";
d["ba"] = "llo";
d["lol"] = "world";
string a = string.Format("{a}{ba}{lol}", d); 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-18T00:18:26.213

不，但是这个扩展方法可以做到

```
static string FormatFromDictionary(this string formatString, Dictionary<string, string> valueDict) 
{
    int i = 0;
    StringBuilder newFormatString = new StringBuilder(formatString);
    Dictionary<string, int> keyToInt = new Dictionary<string,int>();
    foreach (var tuple in valueDict)
    {
        newFormatString = newFormatString.Replace("{" + tuple.Key + "}", "{" + i.ToString() + "}");
        keyToInt.Add(tuple.Key, i);
        i++;                    
    }
    return String.Format(newFormatString.ToString(), valueDict.OrderBy(x => keyToInt[x.Key]).Select(x => x.Value).ToArray());
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-09-22T05:49:14.913

勾选这个，它支持格式化：

```
 public static string StringFormat(string format, IDictionary<string, object> values)
    {
        var matches = Regex.Matches(format, @"\{(.+?)\}");
        List<string> words = (from Match matche in matches select matche.Groups[1].Value).ToList();

        return words.Aggregate(
            format,
            (current, key) =>
                {
                    int colonIndex = key.IndexOf(':');
                    return current.Replace(
                        "{" + key + "}",
                        colonIndex > 0
                            ? string.Format("{0:" + key.Substring(colonIndex + 1) + "}", values[key.Substring(0, colonIndex)])
                            : values[key].ToString());
                });
    } 
```

如何使用：

```
string format = "{foo} is a {bar} is a {baz} is a {qux:#.#} is a really big {fizzle}";
var dictionary = new Dictionary<string, object>
    {
        { "foo", 123 },
        { "bar", true },
        { "baz", "this is a test" },
        { "qux", 123.45 },
        { "fizzle", DateTime.Now }
    };
StringFormat(format, dictionary) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-18T00:14:11.773

您可以实现自己的：

```
public static string StringFormat(string format, IDictionary<string, string> values)
{
    foreach(var p in values)
        format = format.Replace("{" + p.Key + "}", p.Value);
    return format;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-18T02:10:58.200

Phil Haack 不久前在他的博客上讨论了几种方法：http: [//haacked.com/archive/2009/01/14/named-formats-redux.aspx](http://haacked.com/archive/2009/01/14/named-formats-redux.aspx)。我在两个项目中使用了“Hanselformat”版本，没有任何抱怨。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-10-08T22:10:01.590

# 现在有可能

使用C# 6.0 的[插值字符串](https://msdn.microsoft.com/en-us/library/dn961160.aspx)，您可以执行以下操作：

```
string name = "John";
string message = $"Hi {name}!";
//"Hi John!" 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T01:47:03.973

```
static public class StringFormat
{
    static private char[] separator = new char[] { ':' };
    static private Regex findParameters = new Regex(
        "\\{(?<param>.*?)\\}",
        RegexOptions.Compiled | RegexOptions.Singleline);

    static string FormatNamed(
        this string format,
        Dictionary<string, object> args)
    {
        return findParameters.Replace(
            format,
            delegate(Match match)
            {
                string[] param = match.Groups["param"].Value.Split(separator, 2);

                object value;
                if (!args.TryGetValue(param[0], out value))
                    value = match.Value;

                if ((param.Length == 2) && (param[1].Length != 0))
                    return string.Format(
                        CultureInfo.CurrentCulture,
                        "{0:" + param[1] + "}",
                        value);
                else
                    return value.ToString();
            });
    }
} 
```

比其他扩展方法涉及更多一点，但这也应该允许在它们上使用非字符串值和格式模式，因此在您的原始示例中：

```
Dictionary<string, object> d = new Dictionary<string, object>();
d["a"] = DateTime.Now;
string a = string.FormatNamed("{a:yyyyMMdd-HHmmss}", d); 
```

也会工作...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-06-22T00:18:30.857

```
public static string StringFormat(this string format, IDictionary<string, object> values)
{
    return Regex.Matches(format, @"\{(?!\{)(.+?)\}")
            .Select(m => m.Groups[1].Value)
            .Aggregate(format, (current, key) =>
            {
                string[] splits = key.Split(":");
                string replacement = splits.Length > 1
                    ? string.Format($"{{0:{splits[1]}}}", values[splits[0]])
                    : values[key].ToString();
                return Regex.Replace(current, "(.|^)("+ Regex.Escape($"{{{key}}}")+")(.|$)", 
                                     m => m.Groups[1].ToString() == "{" && m.Groups[3].ToString() == "}"
                                        ? m.Groups[2].ToString()
                                        : m.Groups[1] + replacement + m.Groups[3]
                                    );
            });
} 
```

这类似于另一个答案，但它考虑使用 {{text}} 转义。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-11-14T23:32:25.153

为什么要字典？这是不必要的，而且过于复杂。一个简单的名称/值对的二维数组也可以工作：

```
public static string Format(this string formatString, string[,] nameValuePairs)
{
    if (nameValuePairs.GetLength(1) != 2)
    {
        throw new ArgumentException("Name value pairs array must be [N,2]", nameof(nameValuePairs));
    }
    StringBuilder newFormat = new StringBuilder(formatString);
    int count = nameValuePairs.GetLength(0);
    object[] values = new object[count];
    for (var index = 0; index < count; index++)
    {
        newFormat = newFormat.Replace(string.Concat("{", nameValuePairs[index,0], "}"), string.Concat("{", index.ToString(), "}"));
        values[index] = nameValuePairs[index,1];
    }
    return string.Format(newFormat.ToString(), values);
} 
```

调用上述内容：

```
string format = "{foo} = {bar} (really, it's {bar})";
string formatted = format.Format(new[,] { { "foo", "Dictionary" }, { "bar", "unnecessary" } }); 
```

结果是：`"Dictionary = unnecessary (really, it's unnecessary)"`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-02-09T10:29:40.820

自 C# 6 发布以来，您可以使用[字符串插值功能](https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-6#string-interpolation)

解决您的问题的代码：

```
string a = $"{d["a"]}{d["ba"]}{d["lol"]}"; 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2016-01-22T14:00:44.520

这是一个很好的解决方案，在格式化电子邮件时非常有用：[http ://www.c-sharpcorner.com/UploadFile/e4ff85/string-replacement-with-named-string-placeholders/](http://www.c-sharpcorner.com/UploadFile/e4ff85/string-replacement-with-named-string-placeholders/)

编辑：

```
public static class StringExtension  
{  
    public static string Format( this string str, params Expression<Func<string,object>>[] args)  
    {  
        var parameters = args.ToDictionary( e=>string.Format("{{{0}}}",e.Parameters[0].Name), e=>e.Compile()(e.Parameters[0].Name));  

        var sb = new StringBuilder(str);  
        foreach(var kv in parameters)  
        {  
            sb.Replace( kv.Key, kv.Value != null ? kv.Value.ToString() : "");  
        }  

        return sb.ToString();  
    }  
} 
```

示例用法：

```
public string PopulateString(string emailBody)  
{  
  User person = _db.GetCurrentUser();  
  string firstName = person.FirstName;    //  Peter  
  string lastName = person.LastName;      //  Pan  
  return StringExtension.Format(emailBody.Format(  
    firstname => firstName,  
    lastname => lastName  
  ));   
} 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-06-18T00:14:09.823

（您的 Dictionary + foreach + string.Replace）包裹在子例程或扩展方法中？

显然没有优化，但是...

# asp.net - 在 VB.NET 中搜索网站页面内容 - 第三方工具？代码示例？

> ID：1010130
> 
> 赞同：-1
> 
> 时间：2009-06-18T00:09:34.997
> 
> 标签：asp.net, vb.net, search, web

我希望在我的 asp.net 网站中实现搜索。我一直在网上搜索，但我不确定该走哪条路。这是我正在寻找的：

*   能够在我的网站上搜索静态页面中的文本
*   排除我不想搜索的页面或文件夹
*   代码必须在 vb.net 或 c# 中
*   必须是我可以快速实施的东西
*   .net 2.0 或更高版本的首选

到目前为止我发现的最好的例子是[http://www.codeproject.com/KB/applications/SearchDotnet.aspx](http://www.codeproject.com/KB/applications/SearchDotnet.aspx)

我喜欢。我只是希望找到一个更现代的。这是用 .NET 1.0 编写的

谢谢，埃里克

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T14:52:14.860

嗯...如果您想快速，您可能应该使用谷歌集成。

但是，我首选的可以实现自定义的搜索引擎是 Lucene.NET。那里应该有很多示例，并且文档非常好。根据您的技能水平，您可能能够快速完成它......但如果您是初学者则不太可能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2022-02-26T11:12:38.620

要在静态页面中搜索文本，您可以尝试以下方法：

```
 Dim search As String = txtsearch.Text.ToLower
    Dim target As String = web1.DocumentText.ToLower
    Dim counter As Integer = 0
    Dim m As Match = Regex.Match(target, search)

    Do While m.Success
        counter = counter + 1
        m = m.NextMatch()
    Loop

Or:

Dim wb as new WebClient
Dim html as string = wb.DownloadString("http://somesite.com") 
```

要排除页面，我建议您参考下面的链接。我不确定它是否有帮助，但它确实提供了代码，如果您需要将其转换为 vb.net，请转到最底部的链接： [Exclude files from web site publish in Visual Studio](https://stackoverflow.com/questions/650875/exclude-files-from-web-site-publish-in-visual-studio)

如何实现 IndexOf() 的示例在这里：[https ://www.dotnetperls.com/indexof-vbnet](https://www.dotnetperls.com/indexof-vbnet)

[将 C#转换](https://converter.telerik.com)为 vb.net：https://converter.telerik.com

# perforce - 可以将 Perforce 客户端规范中映射的特定文件设为不可编辑吗？

> ID：1010134
> 
> 赞同：1
> 
> 时间：2009-06-18T00:10:45.807
> 
> 标签：perforce, perforce-client-spec

例如，来自“已发布”仓库的客户端规范映射文件的某些部分。有没有办法将这些所谓的已发布地图强制设为只读，即无法打开编辑？

例如（忽略[不可编辑]）：

```
//Development/foo/... //client/foo/...
//Published/bar/1.0/... //client/bar/... [not editable]
//Published/qux/2.0/... //client/qux/... [not editable] 
```

换句话说，我想防止文件被打开（例如，默认情况下被锁定）并且想知道这是否可以在客户端规范级别强制执行。

如果没有，是否有一种方法可以在不将“已发布”仓库设置为对某些用户只读的情况下使用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-19T10:56:22.693

正确执行此操作的唯一方法是通过 Perforce 权限表。您可以使用 p4 保护命令或通过 P4V 中的管理菜单来完成此操作。

只需打开它 - 您需要管理员权限 - 并在表中添加一行以将这些文件标记为只读。这将允许您的客户同步到文件，但不允许打开以进行编辑（或删除等）。

您对权限表拥有最终控制权。您还可以对此进行细化，以仅允许一部分用户能够修改文件，而其他所有人都将其视为只读。

Perforce 管理员指南在权限表上非常好。直接链接[在这里](http://www.perforce.com/perforce/doc.082/manuals/p4sag/04_protect.html#1016808)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T00:15:11.803

您可以使用[p4 lock](http://www.perforce.com/perforce/doc.current/manuals/cmdref/lock.html)，它禁止其他人提交更改。

您还可以管理用户访问权限，请参阅[p4 Protect](http://www.perforce.com/perforce/doc.082/manuals/cmdref/protect.html#1040665)和[p4 group](http://www.perforce.com/perforce/doc.082/manuals/cmdref/group.html#1040665)。我相信这可以逐个文件使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T00:35:06.007

您可以创建一个虚拟客户端并将这些文件锁定在虚拟客户端上。然后，不要让任何人使用该客户端，例如将其放在服务器上。

# python - 如何使用 Python 按比例分配日期

> ID：1010139
> 
> 赞同：0
> 
> 时间：2009-06-18T00:13:16.550
> 
> 标签：python, algorithm, datetime, timedelta

我有一个非常简单的图表组件，它在 x/y 轴上采用整数。我的问题是我需要在此图表上表示日期/浮点数。所以我虽然可以按比例分配日期。换句话说，假设我有以下日期：01/01/2008、02/01/2008 和 31/12/2008。该算法将返回 0、16.667 和 100（1 个月 = 16.667%）。

我尝试使用 Python 2.5 的`datetime`和`timedelta`类，但我无法实现这一点。我以为我可以使用刻度数，但我什至无法从`datetime`.

知道如何用 Python 编写这个算法吗？否则，还有其他想法或算法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T00:51:12.480

如果您正在处理日期，那么您可以使用[toordinal](http://docs.python.org/library/datetime.html#datetime.date.toordinal)方法。

```
import datetime

jan1=datetime.datetime(2008,1,1)
dec31=datetime.datetime(2008,12,31)
feb1=datetime.datetime(2008,02,01)

dates=[jan1,dec31,feb1]
dates.sort()

datesord=[d.toordinal() for d in dates]
start,end=datesord[0],datesord[-1]

def datetofloat(date,start,end):
    """date,start,end are ordinal dates
    ie Jan 1 of the year 1 has ordinal 1
       Jan 1 of the year 2008 has ordinal 733042"""
    return (date-start)*1.0/(end-start)

print datetofloat(dates[0],start,end)
  0.0
print datetofloat(dates[1],start,end)
  0.0849315068493*
print datetofloat(dates[2],start,end)
  1.0 
```

*16.67% 大约是一年中的两个月，因此 2 月 1 日的比例大约是该比例的一半。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T00:37:20.293

将 timedelta 转换为数值相当容易。

选择一个纪元时间。计算相对于时代的每个值的增量。将增量转换为数值。然后像往常一样映射数值。

转换是直截了当的。就像是：

```
def f(delta):
   return delta.seconds + delta.days * 1440 * 60 + 
      (delta.microseconds / 1000000.0) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T00:26:47.130

我不知道我是否完全理解您要做什么，但是您可以处理自 UNIX 时代以来的秒数，然后只需使用普通的旧减法即可获得一个可以缩放到大小的范围你的阴谋。

在处理过程中，map 函数将为您处理这种情况。 [http://processing.org/reference/map_.html](http://processing.org/reference/map_.html) 我相信您可以根据自己的目的进行调整

# sql - 有很多列的表

> ID：1010148
> 
> 赞同：7
> 
> 时间：2009-06-18T00:15:21.897
> 
> 标签：sql, sql-server-2008, asp.net-3.5

如果我的表有大量列（超过 80 列），我应该将其拆分为具有 1 对 1 关系的多个表还是保持原样？为什么？我主要关心的是性能。

PS - 我的桌子已经是第三范式了。

PS2 - 我使用的是 MS Sql Server 2008。

PS3 - 我不需要一次访问所有表数据，而是在该表中有 3 个不同类别的数据，我分别访问它们。它类似于：会员偏好、会员帐户、会员资料。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-06-18T00:20:28.877

80列真的不多……

从性能的角度来看，我不会担心它。拥有一个表（如果您通常在标准操作中使用所有数据）可能会胜过具有 1-1 关系的多个表，尤其是在您正确索引的情况下。

不过，从维护的角度来看，我会担心这个（可能）。单个表中的数据列越多，该表在您的宏伟计划中的作用就越难以理解。此外，如果您通常只使用一小部分数据，并且并不总是需要所有 80 列，则拆分为 2 个以上的表可能有助于提高性能。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-18T00:24:51.660

关于性能问题 - 这取决于。行越大，一次读取可以从磁盘读取的行越少。如果您有很多行，并且您希望能够非常快速地从表中读取核心信息，那么可能值得将其拆分为两个表 - 一个只有可以快速读取的核心信息的小行，以及一个额外的表格，其中包含您很少使用的所有信息，您可以在需要时查找这些信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-18T00:47:02.660

从维护和测试的角度来看，如果您说在一个表中有 3 个不同的数据组，尽管它们都具有相同的唯一 ID（例如 member_id），那么将其拆分为单独的表可能是有意义的.

如果您需要添加字段来说明成员信息表的个人资料详细信息部分，您是否真的要冒重新测试应用程序的首选项和帐户详细信息元素的风险，以确保不会产生影响。

如果您想跟踪最后一个用户 ID/时间戳以更改成员数据，也可用于审计跟踪。如果管理应用程序允许单独更新首选项/帐户详细信息/个人资料详细信息，那么将它们放在单独的表中以更轻松地跟踪更新是有意义的。

不是一个 SQL/Performance 答案，但也许可以从数据库和应用程序设计 pov 中看到

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T00:20:29.517

取决于这些列是什么。如果您有硬编码的重复字段，如 Colour1、Colour2、Colour3，那么这些是子表的候选者。我的一般经验法则是，如果有多个相同类型的字段（颜色），那么您最好为其中的 N 个进行编码，而不是一个固定的数字。

抢。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T00:21:43.477

如果您说 Member_Info，1-1 可能会更容易；会员偏好；成员_个人资料。如果您想要大量的 varchar(255)，那么拥有太多列可能会使其运行，因为您可能会超过行大小限制，这只会让人感到困惑。

只要确保你有正确的 forgein 键约束等等，所以每个表中总是有 1 行具有相同的 member_id

# domain-driven-design - 领域驱动设计中遇到的主要问题/解决方案是什么？

> ID：1010152
> 
> 赞同：5
> 
> 时间：2009-06-18T00:18:17.617
> 
> 标签：domain-driven-design

实践领域驱动设计时会出现哪些问题/解决方案？

随着新情况的不断出现，我发现掌握它有点困难，所以我试图在一个地方编制一份好的资源/问题列表，以帮助我和任何像我一样难以掌握/实施它的人。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T18:55:51.720

您可以在 SO 中搜索标签[domain-driven-design](https://stackoverflow.com/questions/tagged/domain-driven-design)或[ddd找到一些问题。](https://stackoverflow.com/questions/tagged/ddd)埃里克·埃文斯 (Eric Evans) 的书还对您可能面临的一些情况提供了一些很好的见解。

一个重要的注意事项是 ddd 就像测试一样，它增加了新功能的开发时间，但提高了质量（因此，从长远来看，减少了开发时间）。您可能需要经常与领域专家联系，以便在每次出现问题时改进模型。

恕我直言，ddd 最重要的问题是拥有一个好的、有意义的域。大多数问题（尽管不是全部）的根本问题是对领域的理解不足

很难说什么问题是最常见的，因为每个领域都是不同的领域，有自己的特点......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-23T02:23:13.293

以我的经验，最重要的规则之一是“**构建无所不在的语言**”。不要忘记它，它是 DDD 为开发过程提供的最有价值的方面之一。强大且共享的无处不在的语言带来了有意义的领域和对问题有很大帮助的共同愿景。

我的第二条规则是“**模型只有一个**”：不要建模数据、对象、类、表……只要面对领域一个模型就可以了，其他一切都必须从这个模型中自然派生出来，一个模型之间没有差距模型中的 UML 类和 Java（或您正在使用的语言）类。

# c# - 是否可以编写 .member 并假设 C# 中的类/结构

> ID：1010176
> 
> 赞同：0
> 
> 时间：2009-06-18T00:29:22.540
> 
> 标签：c#

我想做类似下面的事情

```
using (MyClass)
{
.a = a;
.title = sz;
.abc = paramEFG
etc = .lol;
} 
```

这在 C# 中可能吗？显然不是那种语法，而是另一个关键字？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T00:34:31.420

好吧，据我所知，虽然*对象初始值设定项*很接近，但并不完全是这样：

```
var foo = new MyClass
{
  a = a,
  title = sz,
  abc = paramEFG
}; 
```

但显然，它们仅适用于在调用构造函数后直接创建对象和初始化属性，而不像 VB 那样在任何时候都有效`With`（它几乎与您在问题中描述的语法完全相同）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T00:33:58.020

不，这在语言中不存在。您可能在想JavaScript 或 Visual Basic的*with关键字？*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T00:35:11.780

C# 不支持。VB 使用`With`关键字。

如果 MyClass 很长（例如，`this.Controls[0].Controls[3].Font`），您可以为其分配一个名称较短的局部变量。

如果它是一个长类名（例如，`Dictionary<RichTextBox, List<GroupPanel>>`），您可以使用该`using`语句创建一个别名，如下所示：

```
using MyThingy = System.Collections.Generic.Dictionary<System.Windows.Forms.RichTextBox, System.Collections.Generic.List<System.Windows.Forms.GroupPanel>>; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T00:35:24.010

你不能在 C# 中做到这一点，它更像是一个 VB 的东西。但是，您可以像这样设计一个流体界面：

```
var c = MyClass.Build()
.SetA(a)
.SetTitle(sz);
.SetParam(paramEFG); 
```

或者您可以使用 C# 3 语法并执行

```
var c = new MyClass() {
  A = a, 
  Title = sz 
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T00:35:26.880

看起来您正在要求像 VB.Net 的 With 运算符这样的功能。

```
With someClass
 .Name = "foo"
 .IntValue = 42
End With 
```

如果是这样，那么这在 C# 中是不可能的。

# c# - My datagrid's selection is lost when updating my database from the grid's bound dataset. Any workarounds?

> ID：1010181
> 
> 赞同：0
> 
> 时间：2009-06-18T00:30:38.293
> 
> 标签：c#, ado.net, datagrid, concurrency, dataset

I am using Xceed's Datagrid, bound to a dataset. I want to update the database when the datagrid's RowEditEnd is called. The problem is that in order to avoid concurrency violations when updating, I have to clear the dataset after update and refill it, like this:

```
public void UpdateDatabaseFromDataSet()
{
    adapter.Update(exampleDataSet);
    exampleDataSet.Clear();
    adapter.Fill(exampleDataSet);
} 
```

I think I have to do this because my dataset's primary autoincrement column "ID" does not match the values generated by the database. When I clear the dataset, it clears the datagrid and its selected cell. This is very annoying since, if you edit a cell and hit enter or a directional key, the cell and database will update fine, but your selection gets reset instead of navigating to the next row/cell. This makes entering data by hand very cumbersome.

Here is the method that creates the dataset:

```
public void InitDataSet(int tableid)
{
    cmd = new SQLiteCommand("SELECT * FROM table_" + tableid, con);
    adapter = new SQLiteDataAdapter(cmd);
    cb = new SQLiteCommandBuilder(adapter);

    try
    {

        exampleDataSet = new DataSet();

        adapter.Fill(exampleDataSet);
        prodDataSet.Tables[0].Columns[0].AutoIncrementSeed = -1;
        prodDataSet.Tables[0].Columns[0].AutoIncrementStep = -1;

        currenttableID = tableid;
    }
    catch (ApplicationException ex)
    {
        MessageBox.Show("Encountered an error.", "Error: " + ex.ToString());
    }
} 
```

Note that I have tried setting the tables autoincrementseed and autoincrementsteps to -1 but I still get concurrency violations if I don't refill the dataset.

I would really like my datagrid to work the way it does if I do not clear and refill the dataset. Is there anyway to avoid the concurrency violations I'm running into? Am I going about this the wrong way?

Thanks for your help. -Steven

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T06:20:23.730

I don't exactly understand the complete problem but I might be able to give you something
When you **don't clear** the dataset and call "fill" it'll try to "merge" the records from the DB with the existing records. The clear forces your grid to refresh I guess.. losing the selected row.

With
Adapter.FillLoadOption = LoadOption.PreserveChanges (or other);
You can influence how records from the db that are changed are merged with the dataset.

Now there is one problem left and that is to determine the new **autoinc** value when an insert has taken place. You can catch the **Adapter.RowUpdated**

```
void Adapter_RowUpdated(object sender, SqlRowUpdatedEventArgs e)
        {
            if (e.StatementType==StatementType.Insert)
            {

                Select last autoinc value with @@Identity  
                e.Row["ID"] = last autoinc value
            } 
        } 
```

So :

*   Don't clear de datatable
*   Catch rowupdated and get the latest autoinc value in the db in put it in the new row
*   Evt. call fill to see if other users have made changes

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-27T17:21:19.830

Here is the code that ended up working for me, putting it here for other's benefits.

Here's my data providers update method (note that I was able to remove the extra fill call):

```
public void UpdateDatabaseFromDataSet()
{
    adapter.Update(exampleDataSet);
} 
```

And here is the RowUpdated event I'm using:

```
void adapter_RowUpdated(object sender, System.Data.Common.RowUpdatedEventArgs e)
{
    if (e.StatementType == StatementType.Insert)
    {
        SQLiteCommand cmdNewID = new SQLiteCommand("SELECT last_insert_rowid()", con);
        e.Row["RowID"] = cmdNewID.ExecuteScalar();
    }
} 
```

# continuous-integration - 如何从 FinalBuilder 输出将被 TeamCity 捕获的消息？

> ID：1010182
> 
> 赞同：5
> 
> 时间：2009-06-18T00:30:47.437
> 
> 标签：continuous-integration, teamcity, finalbuilder

我正在运行 TeamCity Professional 4.5.3 和 FinalBuilder Pro 6；TeamCity 使用命令行任务运行 FinalBuilder 项目。

如何让 FinalBuilder 将消息打印到构建日志中，以便 TeamCity 捕获它们？[TeamCity 文档](http://www.jetbrains.net/confluence/display/TCD4/Build+Script+Interaction+with+TeamCity)很清楚，但我找不到从 FinalBuilder 输出所需值的任何方法——我需要作为 DOS 命令调用，`echo`还是运行一小段脚本，或者其他什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-31T00:13:25.067

使用运行脚本操作 (Javascript)：

```
Action.SendLogMessage("hello team city",stInformation); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T20:35:09.907

Action.SendLogMessage("Hello World!",stInformation)

# design-patterns - 使用Repository模式，Parent和Child对象最好一起保存还是分开保存？

> ID：1010183
> 
> 赞同：6
> 
> 时间：2009-06-18T00:30:50.883
> 
> 标签：design-patterns, repository-pattern

拥有一个父对象 Employee 和一个 Address 子对象列表：

```
class Employee
{
    List<Address> addresses;
} 
```

和一个存储库方法：

```
void Insert(Employee); 
```

此存储库中的代码应该尝试保存父 Employee 以及子 Address 对象，还是应该单独的存储库处理父对象和子对象？

如果是单独的存储库，那么当在客户端代码中保存 Employee 对象及其子对象时，这应该是该级别的单独调用，结合某种服务还是有其他选择？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T00:35:22.497

存储库应该处理整个聚合对象（父对象和所有子对象），因为这就是使其成为存储库的原因。如果您分别保存根对象和子对象，那么您使用的模式并不真正称为存储库（尽管它可能仍然是一个非常好的解决方案）

“存储库”只是用于一次性加载和保存整个聚合的特定数据访问模式的方便名称 - 因此，当您对另一位开发人员说您正在使用存储库模式时，他们知道这就是正在发生的事情。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-31T19:54:00.220

实体之间有两种联系。

**一个**是*引用*：当一个实体包含对另一个实体的引用时。该实体是独立的，它们中的任何一个都可以与该类型的另一个适当实体组合。

例如：客户和产品、用户和地址等。

**另一种**类型是*聚合*：当少数实体表示单个对象时，由于某些原因存储在几个表中/拆分为几个类。但它仍然是一个***单一***的对象：一个部分没有其他部分就没有意义，也不能与其他实体结合。在这种情况下，一个实体总是*主要*的，删除主要的总是会导致删除聚合实体。

例如：订购和订购物品、房子和它的房间等。

引用代表关系，聚合代表拥有。

**所以** 保存引用的实体不应该保存引用的实体（除非引用实体的情况是新的，但在这种情况下，最好先保存引用的实体）。

使用聚合保存实体必须保存聚合实体。在单笔交易中。因为这是一个单一的对象。此外，最好不允许单独保存聚合（仅在性能非常关键的情况下） - 否则您会遇到很多并发问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T02:20:56.153

我会尝试使用工作单元模式，您可以在其中打开、进行更改、提交，然后它会找出正确的做法。

如果你在一个关系数据库中，你最终会得到像 Hibernate 这样的东西，每个表都有一个映射器。如果您在非关系数据库中，您可能需要发挥创造力，并将域对象标记为 IAggregateRoot 或其他东西，以了解哪些有自己的存储库，哪些没有。

例如，如果员工存储在一个 SOA 中，而地址存储在另一个 SOA 中，则它们都是 IAggregateRoots，理想情况下，工作单元会自动将每个脏实例交给其相应的存储库进行保存。

因此，它对客户端代码是透明的，但不是无用的间接层（就像服务一样，无论如何在 java 世界中——并非总是如此，但我见过的那些）。

我喜欢 DDD，但我认为它过度炒作了存储库，并且从经验上讲会引起很多混乱，因为人们总是在问如何正确地使用它们。

除非我的系统具有已知的多个基于 SOA 的后端（而不仅仅是“嘿，我们可能有一天会成为亚马逊并且需要它”），否则我个人会回避存储库。当然，基于 Hibernate 的映射器/DAO/某些东西，但它们似乎比存储库更简单、更具体。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T18:45:21.300

我更喜欢为您处理级联保存的 NHibernate。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T02:40:01.590

我更喜欢每个表一个存储库，但将它们粘合到一个聚合存储库中：

```
public RootEmployeeRepository (
  IEmployeeRepository employeeRepository, 
  IAddressRepository addressRepository)
{
  // init
}

public SaveEmployee (Employee employee)
{
  // call IEmployeeRepository to save the employee record minus childen
  // call IAddressRepository to save employee.addresses
  // commit all changes to the DB via UnitOfWork
} 
```

# linux - Linux 中的汇编

> ID：1010192
> 
> 赞同：0
> 
> 时间：2009-06-18T00:34:09.067
> 
> 标签：linux, assembly

我正在阅读有关构建编译器的教程。在教程中，编译器生成程序集 80X86，我想知道该编译器制作的程序是否可以在 Intel Celeron Linux 中运行。如果不是，编译器应该在那里生成哪种程序集？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T00:40:51.720

很难理解你的问题。如果您询问如何在 Linux 中编译汇编代码，[http://asm.sourceforge.net/](http://asm.sourceforge.net/)似乎提供了一些信息。

至于组装商，有[GAS](http://en.wikipedia.org/wiki/GNU_Assembler)和[NASM](http://www.nasm.us/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T00:41:07.023

赛扬是x86的。gcc 会为你组装东西。（我相信 -S 选项。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T00:41:14.013

是的，只需使用 nasm。在这里完美运行。祝你好运。

# sql-server - dm_exec_query_stats 返回过时的数据？

> ID：1010202
> 
> 赞同：1
> 
> 时间：2009-06-18T00:37:26.547
> 
> 标签：sql-server

我一直在 SQL Server 2005 数据库上测试我的应用程序，并尝试使用 sys.dm_exec_query_stats 建立查询性能的初步图景。

问题：有一个我感兴趣的特定查询，因为 total_elapsed_time 和 last_elapsed_time 都是很大的数字。当我让我的应用程序调用该查询（运行成功），然后刷新我的统计视图时，我发现

1) execution_count 已经增加（预期） 2) last_execution_time 已经更新到现在（预期） 3) last_elapsed_time 仍然是一个很大的值（不是预期的 - 我预期一个新值） 4) total_elapsed_time 没有改变（矛盾？）

如果last_elapsed_time 指的是@last_execution_time 发生的执行，那么total_elapsed_time 应该增加了？

该文档： http: [//msdn.microsoft.com/en-us/library/ms189741](http://msdn.microsoft.com/en-us/library/ms189741(SQL.90).aspx) (SQL.90).aspx告诉我 last_execution_time 是该计划的最后一次执行时间，last_elapsed_time 来自“最近执行的计划” "，但没有告诉我为什么这些可能会有所不同。

查询本身并不复杂（SELECT/WHERE/ORDER BY - 出现在 where 子句中的参数，但没有巧妙的操作），该表现在可能有 25 行。

问题： 1) execution_count、last_execution_time 和 last_elapsed_time 之间的真正关系是什么？2) 这种关系的文档在哪里（手册、第三方书籍、博客、bug 票、石碑......）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-22T07:56:00.810

我不知道这是否真的回答了您的问题，但统计信息仅在大约 20% 的表格内容发生更改后才会更新。如果您运行`UPDATE STATISTICS`，然后使用 查询，`RECOMPILE`那会有所不同吗？

# visual-studio - 编辑并继续：“当...时不允许更改”

> ID：1010213
> 
> 赞同：112
> 
> 时间：2009-06-18T00:40:08.603
> 
> 标签：visual-studio, visual-studio-2008, edit-and-continue

即使我创建了一个干净的 WinForms 项目，“编辑并继续”也不起作用并给我错误：

> 当调试器已附加到已运行的进程或正在调试的代码在构建或运行时进行了优化时，不允许进行更改。

1.  在工具 → 选项 → 调试中选中编辑并继续选项。
2.  未启用优化。
3.  似乎没有设置任何托管分析器。
4.  我在调试模式下运行
5.  我在 x64 CPU 和 Windows XP 32 位上运行，但是将平台目标设置为 x86 而不是 AnyCpu 并没有帮助。
6.  修复 Visual Studio 安装没有帮助。

我还在MSDN 网站上找到[了这篇文章：](http://msdn.microsoft.com/en-us/library/ms164927(VS.80).aspx)

> **不支持的场景**
> 
> 编辑并继续在以下调试方案中不可用：
> 
> *   在 Windows 98 上调试。
>     
>     
> *   混合模式（本机/托管）调试。
>     
>     
> *   SQL 调试。
>     
>     
> *   调试 Dr. Watson 转储。
>     
>     
> *   在未处理的异常后编辑代码，当未选择“在未处理的异常上展开调用堆栈”选项时。
>     
>     
> *   调试嵌入式运行时应用程序。
>     
>     
> *   使用 Attach to 调试应用程序，而不是使用 Debug 菜单中的 Start 运行应用程序。
>     
>     
> *   调试优化代码。
>     
>     
> *   当目标是 64 位应用程序时调试托管代码。如果要使用“编辑并继续”，则必须将目标设置为 x86。（项目属性，编译选项卡，高级编译器设置。）。
>     
>     
> *   由于构建错误导致新版本构建失败后调试旧版本的代码。

但我可以对这个列表中的每一项都回答“否”。

它以前工作过，但几天前它停止工作，我不知道可能是什么原因。

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2014-12-28T01:11:12.577

###其他适用的解决方案#

**如果您尝试快速修复“编辑并继续” *，以下是一个不完整的、***无序列表的可能解决方案列表。*****

*   确保您处于*调试模式*

*   确保您没有启动混合模式进程

*   尝试将 CPU 目标设置为*x86*而不是*AnyCPU*（在 x64 机器上）

*   在*项目属性->调试*中取消选中*调试模式的**优化代码*复选框

***   取消选中*Project Properties->Build中的**Optimize Code*复选框

    **   在*高级编译器设置*中取消选中*启用优化*

    **   （ASP.NET）如果是这种情况，请检查[nightcoder 的答案](https://stackoverflow.com/questions/1010213/edit-and-continue-changes-are-not-allowed-when-the-debugger-has-been-attached/1154063#1154063)

    *   （ASP.NET）如果是这种情况，请检查[此答案（通过 matrixugly）](https://stackoverflow.com/questions/30632427/how-to-edit-and-continue-in-asp-net-mvc-6/35073039#35073039)

    *   (ASP.NET) 确保在*Web*选项卡上启用了*编辑并继续*(vs2010)

    **   (ASP.NET) 转到*Properties > Web > Servers*，并确保在*Use Visual Studio Development Server*下选中*Enable and continue*。

    **   (ASP.NET WebAPI) 在尝试编辑控制器之​​前，请确保您已经使用断点停止了控制器的方法。

    *   (vs2017) 转到*工具 > 选项 > 调试*并*取消选中*（取消选择）“编辑并继续”。这实际上与“传统”建议相反（请参阅本文中的其他几点）。它不允许您在*正在运行的*程序中实际进行更改（即它不会热交换您所做的代码更改） - 它只是允许您编辑您的代码（即它可以防止烦人的消息并“锁定”您的编辑器）。

    *   转到*工具 > 选项 > 调试 > 常规*，并确保未选中*要求源文件与原始版本完全匹配*。

    *   检查启用 Windows 调试堆分配器（仅限本机）[VS Community 2017]

    *   你在使用微软假货吗？它禁止编辑并继续。

    *   通过在*任务管理器中选择**End Process Tree*来终止所有**.vshost.exe*实例。VS 将重新生成一个正确的实例。

    ***   使用*Debug->Delete All Breakpoints 删除所有断点*

    *   *启用并继续*存在于*工具 > 选项 > 调试*菜单和*项目设置*中。一定要检查这两个地方。扩展的 Intellitrace 设置不支持编辑并继续。

    *   确保*Project Properties > Build > Advanced > Output > Debug Info**中*的Debug Info设置为*Full*

    ***   某些插件可能会干扰。通过禁用/卸载进行检查，然后再次尝试其他解决方案。

    *   如果您没有给予足够的关注，那么您在尝试解决此问题时遇到的错误可能会变成其他更容易诊断的错误。例如，包含 lambda 表达式的方法不支持编辑和继续。

    *   确保系统变量`COR_ENABLE_PROFILING`未设置为`1`. 一些分析器在安装时设置它并在卸载后保留它。打开命令提示符并键入`set`以快速检查您的系统是否受到影响，如果是，请删除变量或将其设置为`0`：

    *   在 Windows 8 及更高版本中，搜索*系统*（控制面板）。
    *   单击*高级系统设置*链接。
    *   单击*环境变量*。
    *   消除`COR_ENABLE_PROFILING`*   请注意[不受支持的场景](https://web.archive.org/web/20171021002324/https://msdn.microsoft.com/en-us/library/7932e88z.aspx)（如问题中所述）和[不受支持的编辑](https://web.archive.org/web/20171021003115/https://docs.microsoft.com/en-us/visualstudio/debugger/supported-code-changes-csharp)。********** 

 *** * *

** 通过“你”，我的意思是页面的访问者正在敲击键盘以找到解决方案。*

* * *

**如果此处未列出，请随时编辑此答案以添加您的解决方法！**

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2011-10-28T13:37:16.407

如果您正在调试 ASP.NET 应用程序，请转到属性 > Web > 服务器，并确保在使用 Visual Studio 开发服务器下选中“启用并继续”。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-07-20T14:53:57.907

我终于解决了这个问题：**卸载 Gallio**

Gallio 似乎有很多粗糙的边缘，最好不要使用 MbUnit 3.0，而是使用 MbUnit 2.0 框架，但使用 Gallio 运行器，您无需从安装程序（也安装了 Visual Studio 插件）安装即可运行。

顺便说一句，即使在“禁用”他的 Gallio 插件之后，我也遇到了这个问题。只有卸载解决了问题。

**PS。由 nightcoder 编辑：**
在我的情况下，**禁用 TypeMock Isolator**（模拟框架）终于有**帮助了**！编辑并继续现在有效！！！

这是来自 TypeMock 支持的答案：

> 在进一步查看编辑和继续问题并与 Microsoft 讨论后，我们得出的结论是 Isolator 无法解决。Isolator 实现了一个 CLR 分析器，根据我们的研究，一旦启用并附加了 CLR 分析器，编辑和继续就会自动禁用。很抱歉，这不再被视为错误，而是 Isolator 的限制。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-10-23T02:28:18.893

我有同样的问题。我什至重新安装了 VS 2008，但问题并没有消失。但是，当我删除所有断点时，它开始工作。

```
Debug->Delete All Breakpoints 
```

我认为这是因为我删除了一个在其代码中有断点的 aspx 页面，然后我创建了另一个具有相同名称的页面。这可能混淆了 VS 2008。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-07-29T12:48:15.227

“编辑并继续”启用后，仅允许您在代码处于中断模式时编辑代码：例如，由于异常暂停执行或遇到断点。

这意味着您*无法*在执行未暂停时编辑代码！在调试 (ASP.NET) Web 项目时，这是非常不直观的，因为您经常希望在请求之间进行更改。此时，您的（可能）调试代码没有运行，但也没有暂停！
要解决此问题，您可以单击“全部中断”（或按`Ctrl`+ `Alt`+ `Break`）。或者，在某处设置断点（例如在您的`Page_Load`事件中），然后重新加载页面，以便在遇到断点时暂停执行，*现在*您可以编辑代码。甚至`.cs`文件中的代码。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-06-18T00:42:27.350

几件事要检查

*   确保您的编译设置为调试与发布
*   确保您没有启动混合模式进程
*   如果在 64 位机器上确保将 CPU 目标设置为 x86 而不是 AnyCPU

**编辑**

我认为这无关紧要，但请确保为目标平台启用了托管进程。恐怕帮不上忙。

如果它适用于新项目，那么它可能会更加微妙。我会尝试以下。

*   备份 HKCU:\Software\Wow6432Node\VisualStudio\9.0 （也许只是重命名）
*   删除相同的密钥
*   再次尝试复制

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-01-03T15:05:23.540

上述解决方案都不适合我（在 64x 机器上运行）。

最后我点击了`'advanced compiler settings'`UNCHECKED **'** `'enable optimizations`，现在我可以在调试时单步执行代码和编辑。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-08-25T13:43:32.157

对我来说，由于我不明白的原因，“高级编译器设置”中的“生成调试信息”设置被设置为“pdb-only”而不是“完整”。

默认情况下，此参数始终设置为“Full”，但一个神秘的 poltergeist 在昨晚更改了此参数。:)

PS 我在 Visual Basic .Net 中使用 Visual Studio 2010

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-06-14T16:10:09.713

如果您关心的是 ASP.NET 应用程序，请确保您已在 Web 选项卡 (vs2010) 上启用编辑并继续。在早期版本中还有一个单独的 ASP.NET 调试设置。

问候，

亚当。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2011-08-05T15:57:26.907

我发现即使在项目属性下构建和调试选项卡设置为调试并且所有其他设置都是正确的，我仍然收到消息，但是在构建菜单下挖掘更多之后选择配置管理器...并确保选择调试那里也有两个地方。去看看......他们需要设置多少个不同的地方来设置调试？？？？？？即使您将项目 - 配置设置为调试，然后在构建 - 管理器下它没有更改，因此您在那里也更改了相同的设置项目配置 - 似乎又是一个微软问题......。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-08-20T17:41:46.980

此问题是由于 Intellitrace 设置造成的

如果启用了 Intellitrace，请确保选中 Intellitrace 事件

否则这将不允许编辑并继续..

如果您单击 Intellitrace 选项，您将看到警告。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2013-02-28T09:02:51.770

以下拍摄帮助我使用了 VS2010：

转到工具、选项、调试、常规，并确保未选中“要求源文件与原始版本完全匹配”。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-06-18T01:27:57.290

当调试器没有遇到断点或者您没有点击 Break All（暂停）时，就会发生这种情况。不可能这么简单吧？

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-02-18T08:43:29.833

该错误表示可能的原因是：“正在调试的代码在构建或运行时进行了优化”。转到项目属性->调试并取消选中调试模式的优化代码框。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2013-08-08T06:14:48.870

我在 Microsoft Visual Studio 2008 中遇到过这个问题，解决方案很简单。当您运行项目时，请设置为“调试”模式而不是“发布”。另一个人的解决方案可能很有用。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2010-12-06T14:53:45.450

如果我创建一个新项目，调试时的编辑不起作用。如果我创建一个新网站，则在调试时进行编辑会按预期工作。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2014-08-14T23:12:50.320

我今天遇到了这个问题 - 事实证明，将 Debug Info 设置为 pdb-only（或者我想没有）将阻止 Edit and Continue 工作。

首先确保您的调试信息设置为“完整”！

项目属性 > 构建 > 高级 > 输出 > 调试信息

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2010-12-20T15:28:20.753

在我的情况下，只需重置为默认调试器设置并设置 IntelliTrace-> only intellytrace events 有帮助

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2011-11-04T01:47:27.347

一些似乎有助于使用 VS2010 的事情：

*   转到工具、选项、调试、常规，并确保未选中“要求源文件与原始版本完全匹配”。
*   多个 .vshost.exe 实例可能会被遗留下来，例如从停止的进程中分离 VS 调试器。这也会干扰断点和编译。使用任务管理器的“进程”选项卡，通过右键单击每个实例并选择“结束进程树”来终止 .vshost.exe 的所有实例。VS 将创建一个新实例。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-04-20T05:37:21.113

我从我的项目中删除了一个数据集，因为我没有使用它。之后我可以在调试时修改程序。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2013-10-29T04:10:39.873

我做了所有其他答案中提到的所有更改，但都没有奏效。我学到了什么？*启用并继续*存在于工具 > 选项 > 调试菜单和项目设置中。在我检查两者之后，启用和继续对我有用。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-03-16T14:48:34.297

似乎不合逻辑，但唯一的方法是禁用编辑并从 VS 2017 选项继续...然后 AspNet 编辑并继续开始工作...

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2018-04-13T10:47:49.483

对我有用的是取消选中“使用托管兼容模式”下

> 工具 -> 选项 -> 调试

TBN：选中或取消选中“要求源文件与原始版本完全匹配”似乎不会影响 E&C

希望这能有所帮助。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2018-04-22T18:16:03.777

启用编辑并继续仅运行 IIS Express。不要在本地 ISS 或外部主机中工作。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2019-11-30T08:04:14.163

我正在添加我的答案，因为尚未明确提及为我解决它的事情。实际上对我有帮助的是这篇文章：

[http://www.rubencanton.com/blog/2012/02/how-to-fix-error-changes-are-not-allowed-while-code-is-running-in-net.html](http://www.rubencanton.com/blog/2012/02/how-to-fix-error-changes-are-not-allowed-while-code-is-running-in-net.html)

这是解决方案的简短描述：

1.  停止运行您的应用程序。
2.  转到工具 > 选项 > 调试 > 编辑并继续
3.  禁用“启用编辑并继续”</li>

请注意这是多么违反直觉：我必须*禁用*（取消选中）“启用编辑并继续”。

这将允许您在编辑器中更改代码，而不会收到“代码运行时不允许更改”的消息。

但是请注意，您所做的代码更改不会反映在您正在运行的程序中 - 因为您需要停止并重新启动您的程序（我认为模板/ASPX 更改确实会得到反映，但不会反映在 VB/C#更改，即“代码隐藏”代码）。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2019-12-04T07:48:09.073

**我安装了stackify，当我在图标托盘上启用它时，它会通过编辑停止我的调试，所以我发现**

*   关闭视觉工作室，在我的情况下是 vs2017
*   转到图标托盘并右键单击 stackify 图标并禁用 .NET Profiler
*   使用调试器在调试模式下再次打开 Visual Studio 运行应用程序，它允许我在调试时进行编辑

[![看图片](../Images/450baa55f83426fb96aeeb8caa0eb83a.png)](https://i.stack.imgur.com/bx6AI.png)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2020-01-18T10:30:40.393

自从我将 VS 2019 升级到 16.4.3 后，我遇到了这个烦人的问题，这让我很头疼。
最后我以这种方式解决了这个问题：

1\. 停止调试
2\. 从“解决方案资源管理器”中选择解决方案
3\. 在“*属性*”窗口中，将*“活动配置”*属性从**“释放|任何 CPU”**更改为**“调试|任何 CPU”**
4 . 在 Debug > Options > General 检查**Edit and Continue**复选框

这对我有用，希望它也对你有用。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-11-06T01:30:11.133

嵌入互操作类型 Visual Studio 应设置为 false

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2015-12-01T16:05:18.560

我在链接的类文件中发生了这种情况。项目的其余部分允许 E&C，但我在编辑链接文件时遇到了同样的错误。解决方案是将链接文件分解为它自己的项目并引用该项目。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2017-02-24T06:10:08.920

我遇到了同样的问题。我的问题是我可以修改一个文件，但不能修改另一个文件（两者都在同一个项目中）。后来我发现我无法修改的文件也是另一个项目的一部分。未加载另一个项目（单元测试），*智能*VS 调试器显示未加载此给定文件的程序集的错误，并且不允许更改。多么奇怪！

因此，我不得不卸载单元测试项目并继续进行 EnC 调试。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2017-11-10T04:08:42.410

我在解决方案中有一个数据库项目，它阻止了 webforms 项目的编辑。

我在数据库项目上单击“卸载”，现在一切正常。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2017-11-29T10:47:18.723

对于 VS2017，它可以帮助删除解决方案中的 .suo 文件，它对我有用。:)

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2018-02-03T17:22:32.547

我在 Visual Studio 2005 中遇到了同样的问题。我的配置是 64 位。它在 VS 解决方案之一上运行良好，但在另一个解决方案上运行良好。我注意到我**只**为我想在调试模式下进行更改的项目启用了“启用编辑并继续”。当我也为我的**启动项目**选择“启用并继续”时，这终于为我解决了。

除了启用和继续需要之外，没有配置更改。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2018-09-20T19:45:13.653

对我来说，它发生在我遇到断点、进行一些编辑、然后继续单步执行代码、最后按 F5 或“继续”以到达末尾并退出我的代码块之后。

在尝试“删除所有断点”选项（提示符上的 Ctrl+Shift+PrtScn 和 OK）并执行 Rebuild All 后，我的错误日志中仍然有一个关于我的项目未加载的 DLL 的错误...“无法应用更改，未加载 x.DLL”。重新启动 Visual Studio 后，一切正常。对我来说，结果就是这么简单。

这里的其他事情对我不起作用，比如“要求源文件与原始版本完全匹配”在事情再次开始正常工作之前和之后检查过，并且在我的 x64 机器上定位“任何 CPU”也很好（确实不需要指定 x86 或 x64)。我在“工具”>“选项”>“调试”和“项目属性”>“Web”选项卡设置中启用了“启用编辑并继续”。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2019-06-16T23:28:24.943

在 Rider 中遇到了这个问题。我`.csproj`直接打开了文件而不是`.sln`文件。结果是即使我单击了调试按钮，运行时配置也没有设置为调试。您会注意到它`<No Configurations>`在调试按钮旁边的工具栏中显示。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2020-08-25T13:29:40.070

VS2019 - ASP.NET 表单在我的情况下是工具 - 选项 - Windows 窗体设计器 - “优化代码生成” <- 到 false

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2022-03-05T00:21:41.680

自 VS2013 以来，“编辑并继续”对这两个特定项目不起作用，所以我一直在为这些项目保留它。让它在 VS2022 上运行的新尝试终于产生了一个原因：

**出错时**

如果您在 On Error 中编辑代码，则会收到“进行了无法编译的编辑”错误。将错误列表显示选项设置为 Build + Intellisense，您最终会看到错误“围绕活动语句更新 On Error 语句需要重新启动应用程序”，这是阻止继续执行的原因。

可悲的是，由于一个非常具体的原因，我故意为这两个特定项目保留了这种遗留错误处理方法，并且需要进行结构化错误处理是一个重大的生产力挫折。

但是现在我需要使用一些不再与 VS2013 兼容的更现代的库，所以我不得不继续前进。**

# windows - Windows 7 - 从开发人员的角度来看会发生什么？

> ID：1010226
> 
> 赞同：5
> 
> 时间：2009-06-18T00:43:23.697
> 
> 标签：windows, windows-7

我可以期待 Windows 7 中的哪些功能：

1.  让我作为开发人员的工作更轻松。

或者...

2.  作为开发人员，让我的工作“与众不同”（更难）。

我已经听到很多关于性能改进和一些 UI 效果增强的消息，但对于 Windows 7 上的开发将是什么样子却一无所知。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T01:27:06.197

以下是新领域：

1.  用于开发基于触摸的应用程序的多点触控 API
2.  用于存储用户特定数据的“库”的新概念（类似于 mydocuments）
3.  增强对 GPS 和其他此类硬件的支持
4.  Office2007 Ribbon 用户界面

有关详细信息，请参阅[http://windowsteamblog.com/blogs/developers/default.aspx](http://windowsteamblog.com/blogs/developers/default.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T00:54:09.480

新的传感器 API 将使您的工作更轻松，前提是 Microsoft 可以让足够多的人使用它。如果您使用这种东西进行编程，它应该为您提供与 GPS 和光传感器等接口的标准方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T01:06:04.993

非常易于使用且无缝的 Virtual PC 非常适合调试和测试。

触控是另一项新功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T01:10:15.593

[来自维基百科的功能列表](http://en.wikipedia.org/wiki/Features_new_to_Windows_7)。

回答您的实际问题：
我认为它们中的任何一个都没有明确针对开发人员（真的是一个很小的利基市场）。

对于请求“在应用程序中使用的功能”的问题：
我希望看到很多搜索扩展器、跳转列表和那些小的“预览快捷方式”按钮的东西（我不知道它们叫什么）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T02:50:52.503

Microsoft 发布了官方的[Windows 7 开发人员指南](http://code.msdn.microsoft.com/Win7DeveloperGuide/Release/ProjectReleases.aspx?ReleaseId=1702)。

# sybase - 无法插入表，因为表已经存在？

> ID：1010232
> 
> 赞同：15
> 
> 时间：2009-06-18T00:45:01.790
> 
> 标签：sybase

我有一个用户表。我想将数据插入到我的用户表中。

我有一个声明：

```
SELECT columna, columnb, 
INTO my_table 
FROM my_other_table
WHERE (... conditions ...) 
```

我收到以下错误：

```
SQL Server Error on (myserver) Error:2714 at Line:1 Message:There is already an object named 'my_table' in the database. 
```

是的，谢谢 Sybase。我知道这个。我知道该表存在。我想在其中插入数据。

为什么 Sybase 不能正常运行？:(

（Sybase 不是我的强项，Oracle 是。这可能只是一个理解问题，或者缺乏理解。这在 Oracle 中永远不会发生......）

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-06-18T00:47:44.220

SELECT ... INTO 用于创建新表。

对现有表使用 INSERT ... SELECT。例如：

```
INSERT INTO my_table 
SELECT columna, columnb, 
FROM my_other_table
WHERE (... conditions ...) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T00:47:22.923

你试过这种方式吗？

```
Insert INTO my_table
SELECT columna, columnb, 
FROM my_other_table
WHERE (... conditions ...) 
```

它似乎正在尝试为您隐式创建一个名为 my_table 的新表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T00:52:30.417

不确定 SYBASE 但在 DB2 中这对我有用

```
 INSERT INTO my_table
 (
      columna,
      columnb
 )
 SELECT
      columna,
      columnb
 FROM
      my_other_table
 WHERE
      (... conditions...) 
```

我认为在插入语句中指定列也更安全，而不是假设它们与选择的顺序相同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-05-31T07:22:56.667

在“into”之后使用“existing”关键字插入现有表。

```
SELECT [COLUMN LIST] INTO EXISTING [TABLE NAME] 
```

# c# - 跟踪变量的通用方法

> ID：1010245
> 
> 赞同：-1
> 
> 时间：2009-06-18T00:49:48.863
> 
> 标签：c#, xna

我有一个相机类，我希望它能够跟踪物理对象。然而，在我的游戏引擎（相机类将成为其中的一部分）中，您可以使用不同的物理引擎（甚至有些我没有开发）。无论我使用什么物理引擎，如何让我的相机能够跟踪物体？如果有帮助，我将有一个包装类来帮助抽象处理特定引擎物理实现的一些细节。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-29T01:18:59.770

用包含标准位置对象（可能是 Vector3）的东西包装您的对象。然后，只需添加一个允许您跟踪对象的 Camera.LookAt(GameObject) 方法。此外，这很适合与引擎中的其他对象一起使用，它只是让您能够使用任何相机跟踪任何对象。这是我在之前的两个游戏应用程序中使用的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T00:56:45.387

这完全取决于您的图形引擎是如何设置的。

大多数图形引擎都有某种形式的场景图，以及一种将相机附加到场景图中的节点的方法。这将使相机继承其父节点的变换，这意味着它可以轻松地“跟随”另一个节点。

如果物理系统完全集成，它将在场景中移动对象，这会影响它们的节点。这将自动传播到相机中。

如果您想指定您正在使用的游戏引擎+物理集成包，我可能会给您更多细节。

# xslt - XSLT 在嵌套在不需要的元素中时选择需要的元素

> ID：1010247
> 
> 赞同：0
> 
> 时间：2009-06-18T00:51:02.230
> 
> 标签：xslt

当要提取的节点有时是要忽略的嵌套节点时，我将使用什么 XSLT 来提取一些节点以输出，而忽略其他节点？

考虑：

```
<alpha_top>This prints.
  <beta>This doesn't.
    <alpha_bottom>This too prints.</alpha_bottom>
  </beta>
</alpha_top> 
```

我想要一个产生的转换：

```
<alpha_top>This prints.
    <alpha_bottom>This too prints.</alpha_bottom>
</alpha_top> 
```

此[答案](https://stackoverflow.com/questions/1004236/xslt-selection-of-nodes-based-on-substring-of-element-name)显示了如何根据元素标记名称中是否存在字符串来选择节点。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T00:58:55.380

以下样式表适用于您的特定情况，但我怀疑您正在寻找更通用的东西。我也确信有一种更简单的方法。

```
<?xml version="1.0"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
    <xsl:apply-templates select="alpha_top"></xsl:apply-templates>
</xsl:template>

<xsl:template match="alpha_top">
    <xsl:copy>
    <xsl:apply-templates select="beta/alpha_bottom|text()"></xsl:apply-templates>
    </xsl:copy>
</xsl:template>

<xsl:template match="*|text()">
    <xsl:copy>
        <xsl:apply-templates select="*|text()"></xsl:apply-templates>
    </xsl:copy>
</xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T01:01:52.647

好的，这是一个更好的方法

```
<?xml version="1.0"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

<xsl:template match="beta">
    <xsl:apply-templates select="*"></xsl:apply-templates>
</xsl:template>

<xsl:template match="/|*|text()">
    <xsl:copy>
        <xsl:apply-templates select="*|text()"></xsl:apply-templates>
    </xsl:copy>
</xsl:template>

</xsl:stylesheet> 
```

这基本上进行了身份转换，但是对于您不想包含的元素，我删除了 xsl:copy 并且仅在子元素上应用了模板。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T07:46:58.293

我认为，一旦您对 XSLT 遍历的工作原理有了合理的了解（希望我在您的另一个问题中回答了这个问题），这将变得非常简单。

对于如何执行此操作，您有多种选择。Darrell Miller 的回答表明您必须处理整个文档并删除您不感兴趣的元素。这是一种方法。

在进一步讨论之前，我的印象是您可能无法完全“理解”XSLT 中的上下文概念。这很重要，将使您的生活更简单。在 XSLT 中的任何时候都只有一个上下文节点。这是当前正在“处理”的节点（元素、属性、注释等）。在通过 xsl:select 调用的模板中，已选择的节点是上下文节点。所以，给定你的xml：

```
<alpha_top>This prints.
  <beta>This doesn't.
    <alpha_bottom>This too prints.</alpha_bottom>
  </beta>
</alpha_top> 
```

以及以下内容：

```
<xsl:apply-templates select='beta'/> 
```

和

```
<xsl:template match='beta'>...</xsl:template> 
```

beta 节点将是模板内的上下文节点。还有比这更多的东西，但不多。

因此，当您使用以下内容开始样式表时：

```
<xsl:template match='/'>
    <xsl:apply-templates select='alpha_top'/>
</xsl:apply-templates> 
```

您正在选择文档节点的子节点（唯一的子元素是 alpha_top 元素）。你里面的xpath语句是相对于上下文节点的。

现在，在该顶级模板中，您可能决定只想处理您的 alpha_bottom 节点。然后，您可以输入如下声明：

```
<xsl:template match='/>
    <xsl:apply-templates select='//alpha_top'/>
</xsl:template> 
```

这将沿着树向下走并选择所有 alpha_top 元素，仅此而已。

或者，您可以处理所有元素并简单地忽略 beta 节点的内容：

```
<xsl:template match='beta'>
    <xsl:apply-templates/>
</xsl:template> 
```

（正如我在给您的其他回复中提到的那样，没有选择属性的 xsl:apply-templates 与使用*select='* '* 相同）。

This will ignore the content of the beta node but process all of it's children (assuming you have templates).

So, ignoring elements in your output is basically a matter of using the correct xpath statements in your select attributes. Of course, you might want a good xpath tutorial :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T09:21:14.203

The probably simplest solution to your problem is this:

```
<xsl:template match="alpha_top|alpha_bottom">
  <xsl:copy>
    <xsl:value-of select="text()" />
    <xsl:apply-templates />
  </xsl:copy>
</xs:template>

<xsl:template match="text()" /> 
```

This does not exhibit the same white-space behavior you have in your example, but this is probably irrelevant.

# java - 创建一个保证数据安全的网络服务？

> ID：1010249
> 
> 赞同：1
> 
> 时间：2009-06-18T00:51:18.003
> 
> 标签：java, ruby-on-rails, web-services, web-applications, server-side

我想创建一个 Web 服务，允许用户输入特定建筑物的经度和纬度。建筑物将属于更广泛的类别，称为区域。如果某个区域中不存在特定建筑物，则用户可以通过 Web 服务添加经度和纬度数据。同样，如果用户发现数据不准确，他们可以对其进行更新。

这个 web 服务不需要有一个 web 前端，只有一个 RESTful API，只能由我的应用程序访问。我希望网络服务能够接受新的和更新的数据（如上所述），并根据适当的 API 调用打印出相关数据（以 xml 格式）。

我需要确保这些数据是安全的——即没有人能够访问我积累的数据。

做这个的最好方式是什么？我熟悉客户端 Java 而不是很熟悉服务器端技术（不熟悉服务器端 Java、rails、django 等...）。我应该使用什么语言/框架以最浅的学习曲线来满足我的需求？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T00:55:06.327

您可以在启用 ssl 的情况下使用基本身份验证（用户名/密码）。这样，您就可以加密连接并提供广泛支持的身份验证方式。我相信 apache Axis 会为您处理大部分工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T03:16:11.563

我使用[Restlet](http://www.restlet.org/)框架来部署受密码保护的 Web 服务。它支持基本身份验证和其他几个开箱即用的身份验证。您还可以在 https“服务器连接器”后面设置您的服务。

另一种方法是在支持 JSR 196（例如 Glassfish 或 JBoss）的 Java EE 应用服务器中运行您的应用程序。然后，您将使用服务器的设施来建立身份验证。

这是[Glassfish 安全页面](https://glassfish.dev.java.net/javaee5/security/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T12:50:32.063

如果您从未编写过服务器端代码，恐怕您将面临相当陡峭的学习曲线。如果您对 Java 感到满意，那么另一位评论者提到的 Restlet 框架是一个不错的选择。它易于使用，包括客户端和服务器工具，并且有相当不错的文档。视频截屏非常好。

另一种选择是 Ruby on Rails。我目前正在实施与您的计划非常相似的东西，Rails 运行得非常好。Rails 通过 ActiveRecord 类和 XML Builder 模板内置了对 XML 输出的支持。我在客户端和服务器之间使用了 Atom 身份验证 ( [http://www.xml.com/pub/a/2003/12/17/dive.html](http://www.xml.com/pub/a/2003/12/17/dive.html) )，它运行良好。Ruby 和 Rails 都有一个学习曲线，但框架的强大功能使它值得。我偏爱 The Pragmatic Programmer 的 Ruby 和 Rails 书籍，但 O'Reilly 也有一些不错的书籍。

# java - 我在哪里可以找到至少两个很棒的在线教程，用于使用 Spring 框架构建 Web 应用程序

> ID：1010259
> 
> 赞同：5
> 
> 时间：2009-06-18T00:55:08.180
> 
> 标签：java, spring

我对我在网上找到的所有试图教授 Spring 框架的东西感到非常失望。这是迄今为止我找到的最好的教程，因为它清楚地教导了如何使用 Spring 构建一个简单的 Web 应用程序：

[http://maestric.com/en/doc/java/spring](http://maestric.com/en/doc/java/spring)

我需要更多这样的东西才能开始，但这个问题的大多数答案都是相同的——购买 Spring in Action 书。很抱歉，当我真正想知道的只是如何开始构建 Web 应用程序时，50 美元实在是太贵了。

是否有任何好的博客文章或教程展示了如何使用 Spring 框架逐步设置网站或 Web 应用程序？视频教程也会很有帮助——可能与此处的教程类似：

[http://www.asp.net/learn/](http://www.asp.net/learn/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T00:58:16.723

这里有两个：

1.  [Spring MVC 一步一步](http://static.springframework.org/docs/Spring-MVC-step-by-step/)
2.  [春天金融](http://stsmedia.net/spring-finance-part-1-introduction-architecture/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-26T13:51:57.550

[http://www.ervacon.com/products/springwebflow/index.html](http://www.ervacon.com/products/springwebflow/index.html)

已部署应用程序的演示。 [http://spring.ervacon.com/](http://spring.ervacon.com/)

# internet-explorer - SSL 未在 IE 中验证

> ID：1010260
> 
> 赞同：-1
> 
> 时间：2009-06-18T00:55:25.827
> 
> 标签：internet-explorer, ssl

我有一个 SSL 证书，可以在除 IE 之外的所有浏览器中验证良好，但我不知道为什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-20T17:28:45.220

如果证书是通配符证书，请注意 IE 只允许“*”代表一个 DNS 标签（例如其中没有点）。

但是，正如其他人所指出的，获得真正答案的唯一方法是提供该站点的 URL，以便我们查看。

# imagemagick - 使用 imagemagick 运行批处理

> ID：1010261
> 
> 赞同：2
> 
> 时间：2009-06-18T00:55:58.570
> 
> 标签：imagemagick

我需要用 imagemagick 保存一堆（几千）图像。

我对它完全陌生，它的文档似乎完全不透明且完全迷宫。快速入门指南在哪里？

看着它，我想我想使用`mogrify`.

所以我 cd 到我安装 imagemagick 的程序文件目录。

`mogrify -format png *.png`我在各种例子中看到的那样运行。

它说：

```
mogrify：无法打开图像`fgimg\'：没有这样的文件或目录@ blob.c/OpenB
吊球/2489。
mogrify：无法打开文件 `fgimg\' @ png.c/ReadPNGImage/2865。

```

如何指示它在子目录 \fgimg 中的所有图像上运行？

非常感谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-18T19:28:48.900

这里的问题是你达到了你可以在命令行上放多少的限制。您需要将其拆分为适合的块。这应该会更好：

```
find -name '*.png' -print0 | xargs -0 -r mogrify -format png 
```

`-print0`and`-0`用于处理文件名中的空格，如果无事可做，则表示`-r`不运行 mogrify。

# zend-framework - My_Validate_PasswordConfirmation 应该放在 Zend 框架的什么位置？

> ID：1010265
> 
> 赞同：2
> 
> 时间：2009-06-18T00:56:23.640
> 
> 标签：zend-framework

我在这里使用 Zend 官方文档中的密码确认验证器：http:
[//framework.zend.com/manual/en/zend.form.elements.html](http://framework.zend.com/manual/en/zend.form.elements.html)

在 Bootstrap.php 中，我将命名空间设置为
'namespace' => 'My_'

该文件位于 application/validate/PasswordConfirmation.php

但是，“致命错误：找不到类 'My_Validate_PasswordConfirmation'”出现在我的 Zend_Form 中。

我应该怎么做才能解决问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T01:18:57.790

我设计并实现`Zend_Filter_Input`了 ，包括它的命名空间特性。

您对该功能的工作原理有一个倒退的理解。它旨在允许您在验证器类的实际名称较长时使用该类的短名称。您显然正在做相反的事情，试图用比实际名称更长的名称命名一个类。

要解决此问题，我建议执行以下步骤：

*   为班级命名`My_Validate_PasswordConfirmation`
*   把它放在`application/My/Validate/PasswordConfirmation.php
*   添加`namespace=>'My_Validate'`到您的`Zend_Filter_Input`选项中。
*   简单地调用验证器“PasswordConfirmation”。

* * *

更新：我花了一些时间。我的第一个想法似乎偏离了目标。您遇到的命名空间问题与 的功能无关`Zend_Filter_Input`，它与`Zend_Application`引导功能有关。似乎您可以为自动加载器指定一个类前缀。

这是另一个[线索](http://framework.zend.com/manual/en/zend.loader.autoloader-resource.html)：

> Zend_Loader_Autoloader_Resource 假设您正在自动加载的所有代码将在命名空间、组件和类之间使用下划线分隔符。因此， 在注册资源自动加载器时，**您不需要使用尾随下划线。**

所以试试这个：

```
'namespace' => 'My', 
```

没有尾随下划线。

# java - 从 VB.net 过渡到 java

> ID：1010276
> 
> 赞同：1
> 
> 时间：2009-06-18T00:58:55.570
> 
> 标签：java

好的，这里是我的情况的细分。

*   我刚刚完成了高中“计算机科学”的第一年，学习了神话般的语言，Vb.net（现在让你笑出来）
*   明年我将进入 AP 计算机科学专业。我们将使用 Java。
*   今年夏天我有很多空闲时间，我想提高我的编程技能，成为一个更有效率的程序员。
*   我将使用 BlueJ IDE for Java

你认为我可以在 9 月之前学习 Java 编程吗？你会为新手程序员推荐什么练习来摆脱我在 vb.net 编程时可能会或可能不会养成的坏习惯？从 VB.net 过渡到 Java 有多难？使用不同的 IDE 会很容易，还是应该只使用一个 IDE？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T01:04:16.463

[Java 教程](http://java.sun.com/docs/books/tutorial/)将是开始学习 Java 的好地方。

如果想法是重新开始并尝试改掉“坏习惯”（当然，使用 Visual Basic .NET 并不一定意味着您可能已经养成了坏习惯），那么采取从头开始看教程。

至于单个或多个 IDE 的情况，一开始，我会说从一个开始并稍微适应一下不会有什么坏处。

实际上，在开始时跳过 IDE 并使用文本编辑器和命令行来编译和运行程序可能不是一个坏主意。

为什么？我注意到许多只依赖 IDE 的人不知道如何编译和运行程序的基础知识，因此对如何在基本级别实际运行的了解较少，因为 IDE为他们照顾它。

我自己没有使用过 VB .NET，但我怀疑如果您以面向对象的方式进行编程，那么从 VB .NET 到 Java 的过渡可能不会有很大的飞跃。但是，如果面向对象编程看起来很困难，那么从一开始就使用像 BlueJ（我只使用过几次，几年前）这样的 IDE 可能会更容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T01:07:51.930

在 9 月之前学习 Java 是完全可行的，但是有很多前期学习，尤其是 IDE 可能会产生动机问题。Java 比 VB 严格得多，所以这种转换可能看起来很奇怪。

就个人而言，只是出于我的兴趣，我会从处理（[http://processing.org/](http://processing.org/)）开始采取渐进的方法。处理是Java，但设计用于制作数字艺术。它还推迟了对大量样板文件的需求，直到您需要它为止。我发现学习曲线非常平缓，技能转化得很好。此外，编写漂亮的图片或简单的 pong 实现（至少对我而言）比编写“Hello World”有趣得多。

我从 QBASIC 过渡到 C++，然后是 Java 和其他语言。这真的不算太糟糕。

祝你好运

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T01:08:38.340

嗯，语法方面的 VB.NET 和 Java 不是很相似，但根据我的经验，语法是学习一门新语言中最少的问题。

您当然必须掌握 Java 的标准类库，它的组织方式与 .NET 略有不同，尽管它基本上包含几乎相同的内容。

更重要的是，Java 几乎没有语法糖可以让您轻松完成任务。编写更大的程序几乎总是需要设计模式，而 Java 是一种在这些方面非常繁重的语言。学习它们并知道何时使用它们（或至少在类库中发现它们）可能需要一些时间，除非您已经具备该领域的知识。

例如，在 VB.NET 中，您有用于在对象之间传播消息的*事件*，这样的概念在 Java 世界中并不直接存在。有这种事情的*观察者模式*。取决于您如何看待它，.NET 事件只是观察者模式的语法糖，在初级程序员不知道的情况下进行，或者 .NET 根本不需要使用类和接口来近似解决方案，其中一个合适的已经到位。

实际上，我对 Java 最大的抱怨是冗长，而且几乎所有东西都必须是一个类。

但是对于学习，我建议您尝试直接进入。有很多教程可以帮助您入门（Sun 有[很多很好的](http://java.sun.com/docs/books/tutorial/)教程，涵盖了 Java 平台的关键方面）。你可以重做一个你已经在 VB 中完成的项目，或者想出一个你想自己解决的任务（虽然我不太擅长这些事情，ymmv :-)）。

但是学习一门语言最简单的方法是实际使用它进行编程。在 9 月之前你肯定不会成为专家，但解决一些问题应该是完全可行的。另外，我怀疑他们会期望你到那时已经掌握了这门语言。

至于 IDE，我们在这里经常使用 Eclipse，并且只是在一次讲座中使用了 BlueJ。我会说你应该使用最适合你的东西，尽管我记得 BlueJ 与其说是 IDE，不如说是一个交互式 Java 游乐场左右。我可能弄错了，因为当时我经常不注意听课:-)。

# java - 自动启动 JBoss 服务 (MBean)

> ID：1010278
> 
> 赞同：8
> 
> 时间：2009-06-18T01:00:24.210
> 
> 标签：java, jboss, service, jakarta-ee, mbeans

我正在尝试构建一个应该在每次启动服务器时自动启动的 JBoss 服务。

我的服务有以下类结构：

```
public interface CumbiaXPMServiceMBean extends org.jboss.system.ServiceMBean
public class CumbiaXPMService extends org.jboss.system.ServiceMBeanSupport implements CumbiaXPMServiceMBean 
```

我还有以下配置文件——jboss-service.xml——用于我的服务：

```
<server>
    <mbean code="uniandes.cumbia.xpm.jboss.CumbiaXPMService"
       name="jcumbia:service=JCumbiaEngine">
      <depends>jcumbia:service=cumbiaConsole</depends>
      <attribute name="LocationInCumbia" attributeClass="java.lang.String">XPMEngine</attribute>    
    </mbean>
</server> 
```

我的问题是：如何自动启动此服务？

我希望 JBoss 将调用 start() 方法作为加载过程的一部分，但事实并非如此：我的 start() 方法中有很多登录代码，但我没有看到任何输出。

但是，当我使用 JMXConsole 查看 MBean 状态时，它的状态 (StateString) 是“已启动”。

**问题解决了**

我找到了解决我的问题的方法。我重写了方法 start()、stop()、destroy() 和 create()；尽管如此，由于我正在扩展抽象类 ServiceMBeanSupport，我应该重写方法 startService()、stopService() 等。

我刚刚将我的代码从方法 start() 移动到方法 startService()，现在一切都按照我的需要运行：只要它的依赖关系得到满足，我的服务就会启动并执行 startService() 方法。

我认为结论是：虽然 MBean 的生命周期涉及调用 create()、start()、stop() 和 destroy()，但抽象类 ServiceMBeanSupport 的实现使用这些方法来处理生命周期。然而，它提供了受保护的方法 *Service() 以允许程序员参与生命周期。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T09:03:58.060

**问题解决了**

我找到了解决我的问题的方法。我重写了方法 start()、stop()、destroy() 和 create()；尽管如此，由于我正在扩展抽象类 ServiceMBeanSupport，我应该重写方法 startService()、stopService() 等。

我刚刚将我的代码从方法 start() 移动到方法 startService()，现在一切都按照我的需要运行：只要它的依赖关系得到满足，我的服务就会启动并执行 startService() 方法。

我认为结论是：虽然 MBean 的生命周期涉及调用 create()、start()、stop() 和 destroy()，但抽象类 ServiceMBeanSupport 的实现使用这些方法来处理生命周期。然而，它提供了受保护的方法 *Service() 以允许程序员参与生命周期。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-01T11:02:34.547

对我来说，它有助于在 MBean 接口中定义停止和启动方法：

```
public interface MyServiceMBean {
    ...

    // Lifecycle callbacks
    void start() throws Exception;
    void stop();
} 
```

优点是您不必扩展 ServiceMBean 或 ServiceMBeanSupport。

# sql - 如何通过还原从 sql 2000 迁移到 sql 2008？

> ID：1010279
> 
> 赞同：2
> 
> 时间：2009-06-18T01:00:43.863
> 
> 标签：sql, sql-server-2008, migrate

我正在运行这段代码：

```
RESTORE DATABASE [MyDB_2009May11] 
FROM  DISK = N'C:\DB Copy\MyDB_2009May11.bak' 
WITH  
MOVE N'Archive_Data' 
    TO N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.mdf',  
MOVE N'Data' 
    TO N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.mdf',  
MOVE N'Log' 
    TO N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.ldf',  
NOUNLOAD,  
STATS = 10
GO 
```

我收到此错误：

消息 3176，级别 16，状态 1，第 1 行文件“C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.mdf”由“Archive_Data”（3）和“Data”（1）声明）。WITH MOVE 子句可用于重定位一个或多个文件。消息 3013，级别 16，状态 1，第 1 行 RESTORE DATABASE 异常终止。

当我只有备份文件时，我该如何从 sql server 2000 迁移到 2008？

:) 任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T01:02:48.713

您正在尝试将 Archive_Data 和 Data 移动到同一个文件 - 更改文件名，您应该没问题 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T01:09:40.790

执行 select * from sysaltfiles 并查看正确的文件名，然后相应地更改 move to part 中的名称

这将为您提供当前所有文件组的名称

```
select filename from master..sysaltfiles
where name = 'MyDB_2009May11' 
```

如果您还没有编写数据库脚本，请先执行此操作。确保文件夹存在，您可能还想更改文件大小

```
 CREATE DATABASE [MyDB_2009May11] ON (NAME = N'Data',
    FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.mdf'
     , SIZE = 12, FILEGROWTH = 10%),
     (NAME = N'Archive_Data',
    FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.ndf'
     , SIZE = 12, FILEGROWTH = 10%)
    LOG ON (NAME = N'Log', 
FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.ldf'
     , SIZE = 21, FILEGROWTH = 10%)
     COLLATE SQL_Latin1_General_CP1_CI_AS 
```

现在恢复应该是这样，注意存档文件组的 ndf 扩展名

```
RESTORE DATABASE [MyDB_2009May11] 
FROM  DISK = N'C:\DB Copy\MyDB_2009May11.bak' 
WITH  
MOVE N'Archive_Data' 
    TO N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.mdf',  
MOVE N'Data' 
    TO N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.ndf',  
MOVE N'Log' 
    TO N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.ldf',  
NOUNLOAD,  
STATS = 10
GO 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-16T21:41:37.600

我也遇到了这个问题，我不得不使用该`REPLACE`子句，因为我要恢复到的数据库与数据库备份中的不同：

```
RESTORE DATABASE [MyDB_2009May11]  
FROM  DISK = N'C:\DB Copy\MyDB_2009May11.bak'  
WITH   
MOVE N'Archive_Data'  
    TO N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.mdf',   
MOVE N'Data'  
    TO N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.ndf',   
MOVE N'Log'  
    TO N'C:\Program Files\Microsoft SQL Server\MSSQL10.SQL2008\MSSQL\DATA\MyDB_2009May11.ldf',   
**REPLACE**,
NOUNLOAD,   
STATS = 10 
GO 
```

# xslt - 资源解释 XSLT 处理路径

> ID：1010285
> 
> 赞同：2
> 
> 时间：2009-06-18T01:02:33.283
> 
> 标签：xslt

学习 XSLT 应用模板规则的原则的最佳资源是什么？

像[这样](https://stackoverflow.com/questions/1010247/xslt-to-select-desired-elements-when-nested-in-not-desired-elements)的问题似乎应该相对容易回答，经过一些研究后肯定是这样。我几乎不好意思发布它们。但是我查看了 Kay 的 XSLT Programmer's Reference、XSLT Cookbook 和 Learning XSLT，我仍然无法找到关于如何通过一组规则处理节点及其子节点的清晰解释。也许我是个白痴，但我还没有发现 Python、Linux、Apache、MySQL 或 bash 与 XSLT 完全一样，因为我很沮丧。

更新感谢您的回答。几天后我将无法再次收到它，但我非常感谢您的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T01:07:32.820

[XSLT 模板规则](http://www.w3.org/TR/xslt#rules)规范中的这一部分非常简单明了，并提供了示例。

不要认为 XSLT 作用于您的 XML。

将您的 XML 想象为流经 XSLT。

XSLT 从根模板开始，假想的光标位于文档树的根级别：

```
<xsl:template match="/">
    ...stuff in here...
</xsl:template> 
```

在中间，XSLT 将开始执行语句。如果您有一个`<xsl:apply-templates select="...something..."/>`，那么它将在光标处找到与 select= 中的 XPath 匹配的所有内容，并查找带有`<xsl:template match="...something...">`. 它找到的第一个，根据优先规则，它将执行。

在执行那个新模板时，同样的事情适用，除了上下文现在是匹配的节点。

这些是基础。例如，如果您有这个 XSLT 程序，那么无论输入什么，您都会得到`<hello world="!"/>`输出：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:template match="/">
        <hello world="!"/>
    </xsl:template>
</xsl:stylesheet> 
```

但如果你有这样的输入：

```
<people>
    <name>Paige</name>
    <name>Hayley</name>
    <name>Hamlet</name>
</people> 
```

并将其用作转换：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:template match="/">
        <html>
            <body>
                <table>
                    <xsl:apply-templates select="/people/name[substring(., 1, 1) = 'H']"/>
                </table>
            </body>
        </html>
    </xsl:template>
    <xsl:template match="name">
        <tr>
            <td>
                <xsl:value-of select="."/>
            </td>
        </tr>
    </xsl:template>
</xsl:stylesheet> 
```

它将首先设置一个 HTML 文件。然后它将在根元素下的 'people' 元素下找到所有 'name' 元素，如果它们以字母 'H' 开头，则将搜索与 'name' 匹配的模板。由于我们有一个，它会写出一个带有名称的表格行。它将执行该规则两次，然后关闭 HTML 元素，脚本将结束。

这有帮助吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T07:32:49.320

上面的答案很好地解释了如果定义了模板会发生什么，但理解 XSLT 的内置行为也非常重要。

模板处理由 XSLT 引擎本身驱动，而不是（通常）由您的代码驱动。这样，它与您提到的程序语言非常不同。如果您有任何函数式编程背景，那将有很大帮助。

XSLT 的初始行为是匹配文档节点。文档节点是一个“虚构”节点，它充当 xml 文档根节点的父节点。它代表整个文档。内置行为实际上是一个 xsl:apply-templates，如下所示：

```
<xsl:apply-templates select='/|*'/> 
```

xpath 语句匹配文档节点或任何其他元素。它匹配根节点，然后遍历您的文档。将文档想象成一棵树。在每个元素节点上，它将执行完全相同的语句。XSLT 以从左到右的顺序遍历节点（因此，如果您的根元素有两个子元素，它将在第二个之前到达文档中的第一个）。由于它正在执行上面的选择，因此它将前进到该节点的子节点并执行相同的操作。这是树的深度优先从左到右遍历。

现在，在 XSLT 引擎命中的每个元素节点上，它将寻找匹配的模板。规则相对简单——它将选择执行最具体的模板。内置模板总是最不具体的。匹配完整路径的模板非常具体：

```
<xsl:template match='/some/path/to/a/node'>...</xsl:template>. 
```

仅匹配节点名称的模板不太具体：

```
<xsl:template match='node'>...</xsl:template> 
```

如果您定义了引擎选择的模板（您定义的任何模板都将优先使用内置模板），则上述默认遍历将停止。它执行您的模板并停止，除非您的模板再次开始遍历：

```
<xsl:template match='node'>
    <p><xsl:value-of select='@text'/></p>
    <xsl:apply-templates/>
</xsl:template> 
```

上面的 apply-templates 重新开始了我们的遍历（顺便说一句，没有 select 属性的 apply-templates 与使用*select='* '*.

我希望这会有所帮助。这是图表是最佳方法的情况之一。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T01:21:23.543

如果你有一些钱可以花在培训上，Ken Holman 有一套优秀的 XML/XSLT/XPATH/XSL-FO 培训课程。

[http://www.cranesoftwrights.com/training/ptux/ptux-video.htm](http://www.cranesoftwrights.com/training/ptux/ptux-video.htm) 他链接到一些示例视频。

我亲自参加了他的培训课程。他非常透彻，解释了 XML/XSLT/XPATH 的处理模型、功能和方面。了解如何处理节点树以及 XSLT 引擎如何“遍历树”非常重要。那么 XSLT 模板和“push”和“pull”之间的区别真的很有意义。

XSLT 需要一种不同的看待事物的方式。许多程序员很难调整或理解 XSLT，因为他们一直根据过程代码而不是更实用的方式来思考问题。

# silverlight - 何时支持 Visual Studio 中的 Silverlight XAML 的 WYSIWIG 编辑？

> ID：1010287
> 
> 赞同：0
> 
> 时间：2009-06-18T01:04:03.547
> 
> 标签：silverlight, xaml

为什么在我已经为 Visual Studio 2008 订阅 MSDN 花费了 $$$$ 之后，我们还要为 Expression Blend 花费更多的 $$$$？是否会有 2008 年的服务包来支持这一点，它会成为 VS2010 的一部分，还是我们总是必须使用单独的工具？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T01:12:46.680

好吧，您[今天](http://www.microsoft.com/visualstudio/en-us/products/2010/default.mspx)就可以做到（与 2010 测试版相比）。这是个好主意吗？我不知道。

在我看来，xaml 的设计工具总会有空间。使用动画和画笔以及其他所有内容，将所有内容都放入 VS 是没有意义的。我的 2 美分。

HTH，埃里克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T01:08:21.947

我相信微软正计划将它作为一个单独的工具，而不是包含它（至少在 Pro 级别的 MSDN 订阅中）。

官方的想法似乎是 Visual Studio->Programmer 和 Expression->Designer，而且官方认为这两个程序是由两个不同的人使用的。这给了他们另一个收入来源，以及一个足够好的借口，我怀疑他们会改变它。

但是......我不为微软工作，我不会假装理解与微软开发工具商业模式相关的疯狂的深度......

# html - 在 HTML5 中，您可以以编程方式将图像保存到缓存吗？

> ID：1010290
> 
> 赞同：14
> 
> 时间：2009-06-18T01:04:59.190
> 
> 标签：html, canvas

我喜欢在 HTML5 中您可以将文本数据保存到本地数据库，甚至可以使用 SQL 来完成。( [http://webkit.org/blog/126/webkit-does-html5-client-side-database-storage/](http://webkit.org/blog/126/webkit-does-html5-client-side-database-storage/) )

我有一个为 iPhone 的 MObile Safari 编写的应用程序，它可以离线缓存除图像之外的所有内容。图像仍然必须从服务器下载，我不知道如何确保它们会保持缓存。理想情况下，我想将它们写到 localStorage 数据库中。

我正在考虑将图像写入画布，然后将其序列化为文本......有什么想法吗？有没有更简单的方法来做到这一点？

理想情况下，我想用 HTML 和 JavaScript 来完成这一切，而不是原生应用程序/objective-C。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-18T01:09:26.560

查看 html5 中的应用程序缓存，它基本上完全符合您的要求（如果您想支持完全离线的 Web 应用程序，这也是您想要使用的）。

或者，您可以（有点难看）将图像拖到画布上，然后到 canvas.toDataURL() 以获取图像的数据 url，然后您可以将其存储在普通数据库或离线存储 API 中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-01-24T13:44:42.077

您可以做 Google 在 Mobile GMail 中所做的事情，并将其实现为数据 Url。这意味着后续将被缓存为页面的一部分（如果包含在 cache.manifest 中），因为它们不是外部的。任何一个：

```
<img src="data:image/gif;base64,R0lGODlhEAAOALMAAOazToeHh0tLS/7LZv/0jvb29t/f3//Ub/
/ge8WSLf/rhf/3kdbW1mxsbP//mf///yH5BAAAAAAALAAAAAAQAA4AAARe8L1Ekyky67QZ1hLnjM5UUde0ECwLJoExKcpp
V0aCcGCmTIHEIUEqjgaORCMxIC6e0CcguWw6aFjsVMkkIr7g77ZKPJjPZqIyd7sJAgVGoEGv2xsBxqNgYPj/gAwXEQA7" 
width="16" height="14" alt="embedded folder icon"> 
```

或者：

```
<style type="text/css">
.Jd{background:#fff;width:100%;border-width:7px;-webkit-box-sizing:border-box;-webkit-border-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAWCAYAAAAvg9c4AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAUlJREFUeNpi/P//P4O+VwcfAwODGxDLATGITSr4BMSPgHjXxW0Vnxj1PNtFmBgZU/79/38MKHgBqoAoADQATEMdZQA0xwpozlwWEUFu7zfvvx4ACp5gIBOAXAekDgEN/yEqzOPD9P3nHwWoC6kBLnz99kue6eu3n4xAzg8Civ8jYXwu/vXt+y8GJgYagBFuKAuOSCEUabD0CYsgxmHifVjWQwYwb+KSJ2go0ABGAuHISMiCkZ5OBfm5mN9//MaBr1BBDjvkSMMSH2z8vBzMLI4Wqjzrdl7UA4qdwqOYkUhHGjhbqfOwxAaafjh0+q7fm3dfQK49B8RfSPUu0FIeIGUkIsTjBjKPEVhHyQO93zV96ZFXR8/c+/zkxYdfpBoqIyHAZm2ixJsZbSMGDM4ykKEgcREgzgRibSAWIiNu3gHxVSCeDsRvAAIMAK29e2M9JZVZAAAAAElFTkSuQmCCCg==") 9 7 8 7}
</style> 
```

在此处阅读有关该主题的更多信息：[http ://www.websiteoptimization.com/speed/tweak/inline-images/](http://www.websiteoptimization.com/speed/tweak/inline-images/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-24T23:06:24.270

您可以使用HTML5 数据库中的[数据 UI 方案](http://en.wikipedia.org/wiki/Data_URI_scheme)存储图像。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-06T10:04:37.540

另见： [http ://www.w3.org/TR/offline-webapps/](http://www.w3.org/TR/offline-webapps/)

# java - JavaMail 不发送主题或从码头下：运行战争

> ID：1010296
> 
> 赞同：10
> 
> 时间：2009-06-18T01:06:58.843
> 
> 标签：java, smtp, jakarta-mail, war

有没有人看到 JavaMail 没有将正确的 MimeMessages 发送到 SMTP 服务器，这取决于 JVM 的启动方式？归根结底，我无法发送带有 Subject: 或 From: 字段的 JavaMail SMTP 消息，并且似乎缺少其他标头，仅当将应用程序作为战争运行时。

Web 项目是使用 Maven 构建的，我正在测试使用浏览器和简单的 mail.jsp 发送 JavaMail 以调试并查看启动应用程序时的不同行为：

> 1) mvn jetty:run （邮件发送良好，主题和发件人字段正确）
> 
> 2) mvn jetty:run-war（邮件发送正常，但缺少主题、发件人和其他字段）

我在（详细的）Maven 调试输出 (-X) 上精心运行了 diff，并且两者之间的运行时依赖项存在零差异。我还比较了系统属性，它们是相同的。改变 JavaMail 行为方式的 jetty:run-war 案例正在发生其他事情。还有哪些石头需要车削？

奇怪的是，我在这两种情况下都尝试了调试器，发现 javax.mail.internet.MimeMessage 实例的创建方式不同。webapp 使用 Spring 发送从 Apache ActiveMQ 队列中提取的电子邮件。当运行应用程序时，`mvn jetty:run`MimeMessage.contentStream 变量用于消息内容。as 运行时`mvn jetty:run-war`，MimeMessage.content 变量用于消息内容，content = ASCIIUtility.getBytes(is); call 从解析的内容中删除所有的标头数据。由于这看起来很奇怪，并且调试 Spring/ActiveMQ 是一项深入研究，因此我创建了一个没有任何基础设施的简化测试：只是一个使用 mail-1.4.2.jar 的 JSP，但缺少相同的标头。

另外值得注意的是，在 Tomcat 5.5.27 下运行 WAR 文件时，这些标头会丢失。运行 WAR 时，Tomcat 的行为与 Jetty 类似，但缺少相同的标头。

打开 JavaMail 调试后，我清楚地看到了不同的输出。

好案例：在 jetty:run（非 WAR）中，日志输出为：

```
DEBUG: JavaMail version 1.4.2
DEBUG: successfully loaded resource: /META-INF/javamail.default.providers
DEBUG: Tables of loaded providers
DEBUG: Providers Listed By Class Name: {com.sun.mail.smtp.SMTPSSLTransport=javax.mail.Provider[TRANSPORT,smtps,com.sun.mail.smtp.SMTPSSLTransport,Sun Microsystems, Inc], com.sun.mail.smtp.SMTPTransport=javax.mail.Provider[TRANSPORT,smtp,com.sun.mail.smtp.SMTPTransport,Sun Microsystems, Inc], com.sun.mail.imap.IMAPSSLStore=javax.mail.Provider[STORE,imaps,com.sun.mail.imap.IMAPSSLStore,Sun Microsystems, Inc], com.sun.mail.pop3.POP3SSLStore=javax.mail.Provider[STORE,pop3s,com.sun.mail.pop3.POP3SSLStore,Sun Microsystems, Inc], com.sun.mail.imap.IMAPStore=javax.mail.Provider[STORE,imap,com.sun.mail.imap.IMAPStore,Sun Microsystems, Inc], com.sun.mail.pop3.POP3Store=javax.mail.Provider[STORE,pop3,com.sun.mail.pop3.POP3Store,Sun Microsystems, Inc]}
DEBUG: Providers Listed By Protocol: {imaps=javax.mail.Provider[STORE,imaps,com.sun.mail.imap.IMAPSSLStore,Sun Microsystems, Inc], imap=javax.mail.Provider[STORE,imap,com.sun.mail.imap.IMAPStore,Sun Microsystems, Inc], smtps=javax.mail.Provider[TRANSPORT,smtps,com.sun.mail.smtp.SMTPSSLTransport,Sun Microsystems, Inc], pop3=javax.mail.Provider[STORE,pop3,com.sun.mail.pop3.POP3Store,Sun Microsystems, Inc], pop3s=javax.mail.Provider[STORE,pop3s,com.sun.mail.pop3.POP3SSLStore,Sun Microsystems, Inc], smtp=javax.mail.Provider[TRANSPORT,smtp,com.sun.mail.smtp.SMTPTransport,Sun Microsystems, Inc]}
DEBUG: successfully loaded resource: /META-INF/javamail.default.address.map
DEBUG: getProvider() returning javax.mail.Provider[TRANSPORT,smtp,com.sun.mail.smtp.SMTPTransport,Sun Microsystems, Inc]
DEBUG SMTP: useEhlo true, useAuth true
DEBUG SMTP: trying to connect to host "mail.authsmtp.com", port 465, isSSL false
220 mail.authsmtp.com ESMTP Sendmail 8.14.2/8.14.2/Kp; Thu, 18 Jun 2009 01:35:24 +0100 (BST)
DEBUG SMTP: connected to host "mail.authsmtp.com", port: 465

EHLO jmac.local
250-mail.authsmtp.com Hello sul-pubs-3a.Stanford.EDU [171.66.201.2], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE 52428800
250-AUTH CRAM-MD5 DIGEST-MD5 LOGIN PLAIN
250-DELIVERBY
250 HELP
DEBUG SMTP: Found extension "ENHANCEDSTATUSCODES", arg ""
DEBUG SMTP: Found extension "PIPELINING", arg ""
DEBUG SMTP: Found extension "8BITMIME", arg ""
DEBUG SMTP: Found extension "SIZE", arg "52428800"
DEBUG SMTP: Found extension "AUTH", arg "CRAM-MD5 DIGEST-MD5 LOGIN PLAIN"
DEBUG SMTP: Found extension "DELIVERBY", arg ""
DEBUG SMTP: Found extension "HELP", arg ""
DEBUG SMTP: Attempt to authenticate
DEBUG SMTP: check mechanisms: LOGIN PLAIN DIGEST-MD5 
AUTH LOGIN
334 VXNlcm5hjbt7
YWM0MDkwhi==
334 UGFzc3dvjbt7
YXV0aHNtdHAydog3
235 2.0.0 OK Authenticated
DEBUG SMTP: use8bit false
MAIL FROM:<webmaster@mydomain.org>
250 2.1.0 <webmaster@mydomain.org>... Sender ok
RCPT TO:<jason@mydomain.org>
250 2.1.5 <jason@mydomain.org>... Recipient ok
DEBUG SMTP: Verified Addresses
DEBUG SMTP:   Jason Thrasher <jason@mydomain.org>
DATA
354 Enter mail, end with "." on a line by itself
From: Webmaster <webmaster@mydomain.org>
To: Jason Thrasher <jason@mydomain.org>
Message-ID: <5158456.0.1245285323633.JavaMail.jason@mail.authsmtp.com>
Subject: non-Spring: Hello World
MIME-Version: 1.0
Content-Type: text/plain;charset=UTF-8
Content-Transfer-Encoding: 7bit

Hello World: message body here
.
250 2.0.0 n5I0ZOkD085654 Message accepted for delivery
QUIT
221 2.0.0 mail.authsmtp.com closing connection 
```

坏情况：作为 WAR 运行时，缺少标头的日志输出完全不同：

```
Loading javamail.default.providers from jar:file:/Users/jason/.m2/repository/javax/mail/mail/1.4.2/mail-1.4.2.jar!/META-INF/javamail.default.providers
DEBUG: loading new provider protocol=imap, className=com.sun.mail.imap.IMAPStore, vendor=Sun Microsystems, Inc, version=null
DEBUG: loading new provider protocol=imaps, className=com.sun.mail.imap.IMAPSSLStore, vendor=Sun Microsystems, Inc, version=null
DEBUG: loading new provider protocol=smtp, className=com.sun.mail.smtp.SMTPTransport, vendor=Sun Microsystems, Inc, version=null
DEBUG: loading new provider protocol=smtps, className=com.sun.mail.smtp.SMTPSSLTransport, vendor=Sun Microsystems, Inc, version=null
DEBUG: loading new provider protocol=pop3, className=com.sun.mail.pop3.POP3Store, vendor=Sun Microsystems, Inc, version=null
DEBUG: loading new provider protocol=pop3s, className=com.sun.mail.pop3.POP3SSLStore, vendor=Sun Microsystems, Inc, version=null
Loading javamail.default.providers from jar:file:/Users/jason/Documents/dev/subscribeatron/software/trunk/web/struts/target/work/webapp/WEB-INF/lib/mail-1.4.2.jar!/META-INF/javamail.default.providers
DEBUG: loading new provider protocol=imap, className=com.sun.mail.imap.IMAPStore, vendor=Sun Microsystems, Inc, version=null
DEBUG: loading new provider protocol=imaps, className=com.sun.mail.imap.IMAPSSLStore, vendor=Sun Microsystems, Inc, version=null
DEBUG: loading new provider protocol=smtp, className=com.sun.mail.smtp.SMTPTransport, vendor=Sun Microsystems, Inc, version=null
DEBUG: loading new provider protocol=smtps, className=com.sun.mail.smtp.SMTPSSLTransport, vendor=Sun Microsystems, Inc, version=null
DEBUG: loading new provider protocol=pop3, className=com.sun.mail.pop3.POP3Store, vendor=Sun Microsystems, Inc, version=null
DEBUG: loading new provider protocol=pop3s, className=com.sun.mail.pop3.POP3SSLStore, vendor=Sun Microsystems, Inc, version=null
DEBUG: getProvider() returning provider protocol=smtp; type=javax.mail.Provider$Type@98203f; class=com.sun.mail.smtp.SMTPTransport; vendor=Sun Microsystems, Inc
DEBUG SMTP: useEhlo true, useAuth false
DEBUG SMTP: trying to connect to host "mail.authsmtp.com", port 465, isSSL false
220 mail.authsmtp.com ESMTP Sendmail 8.14.2/8.14.2/Kp; Thu, 18 Jun 2009 01:51:46 +0100 (BST)
DEBUG SMTP: connected to host "mail.authsmtp.com", port: 465

EHLO jmac.local
250-mail.authsmtp.com Hello sul-pubs-3a.Stanford.EDU [171.66.201.2], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE 52428800
250-AUTH CRAM-MD5 DIGEST-MD5 LOGIN PLAIN
250-DELIVERBY
250 HELP
DEBUG SMTP: Found extension "ENHANCEDSTATUSCODES", arg ""
DEBUG SMTP: Found extension "PIPELINING", arg ""
DEBUG SMTP: Found extension "8BITMIME", arg ""
DEBUG SMTP: Found extension "SIZE", arg "52428800"
DEBUG SMTP: Found extension "AUTH", arg "CRAM-MD5 DIGEST-MD5 LOGIN PLAIN"
DEBUG SMTP: Found extension "DELIVERBY", arg ""
DEBUG SMTP: Found extension "HELP", arg ""
DEBUG SMTP: Attempt to authenticate
DEBUG SMTP: check mechanisms: LOGIN PLAIN DIGEST-MD5 
AUTH LOGIN
334 VXNlcm5hjbt7
YWM0MDkwhi==
334 UGFzc3dvjbt7
YXV0aHNtdHAydog3
235 2.0.0 OK Authenticated
DEBUG SMTP: use8bit false
MAIL FROM:<webmaster@mydomain.org>
250 2.1.0 <webmaster@mydomain.org>... Sender ok
RCPT TO:<jason@mydomain.org>
250 2.1.5 <jason@mydomain.org>... Recipient ok
DEBUG SMTP: Verified Addresses
DEBUG SMTP:   Jason Thrasher <jason@mydomain.org>
DATA
354 Enter mail, end with "." on a line by itself

Hello World: message body here
.
250 2.0.0 n5I0pkSc090137 Message accepted for delivery
QUIT
221 2.0.0 mail.authsmtp.com closing connection 
```

这是我正在测试战争/非战争的实际 mail.jsp。

```
<%@page import="java.util.*"%>
<%@page import="javax.mail.internet.*"%>
<%@page import="javax.mail.*"%>

<%
    InternetAddress from = new InternetAddress("webmaster@mydomain.org", "Webmaster");
    InternetAddress to = new InternetAddress("jason@mydomain.org", "Jason Thrasher");
    String subject = "non-Spring: Hello World";
    String content = "Hello World: message body here";

    final Properties props = new Properties();
    props.setProperty("mail.transport.protocol", "smtp");
    props.setProperty("mail.host", "mail.authsmtp.com");
    props.setProperty("mail.port", "465");
    props.setProperty("mail.username", "myusername");
    props.setProperty("mail.password", "secret");
    props.setProperty("mail.debug", "true");
    props.setProperty("mail.smtp.auth", "true");
    props.setProperty("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");
    props.setProperty("mail.smtp.socketFactory.fallback", "false");

    Session mailSession = Session.getDefaultInstance(props);

    Message message = new MimeMessage(mailSession);
    message.setFrom(from);
    message.setRecipient(Message.RecipientType.TO, to);
    message.setSubject(subject);
    message.setContent(content, "text/plain;charset=UTF-8");

    Transport trans = mailSession.getTransport();
    trans.connect(props.getProperty("mail.host"), Integer
            .parseInt(props.getProperty("mail.port")), props
            .getProperty("mail.username"), props
            .getProperty("mail.password"));
    trans.sendMessage(message, message
            .getRecipients(Message.RecipientType.TO));
    trans.close();
%>

email was sent 
```

解决方案：

是的，问题是 Apache CXF 2 的传递依赖。我不得不从构建中排除 geronimo-javamail_1.4_spec，只依赖 javax 的 mail-1.4.jar。

```
<dependency>
    <groupId>org.apache.cxf</groupId>
    <artifactId>cxf-rt-frontend-jaxws</artifactId>
    <version>2.2.6</version>
    <exclusions>
        <exclusion>
            <groupId>org.apache.geronimo.specs</groupId>
            <artifactId>geronimo-javamail_1.4_spec</artifactId>
        </exclusion>
    </exclusions>
</dependency> 
```

感谢所有的答案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-08-28T18:53:06.857

当您将其构建为 WAR 时，是否可能会引入其他依赖项？似乎其他人遇到了这个问题，原因是 geronimo 中的一个错误（有关更多信息，请参阅[http://mail-archives.apache.org/mod_mbox/geronimo-user/200902.mbox/%3C21943498.post@talk .nabble.com%3E](http://mail-archives.apache.org/mod_mbox/geronimo-user/200902.mbox/%3C21943498.post@talk.nabble.com%3E)）。

我们的产品中还包含 geronimo-javamail_1.4_spec-1.2，并且该软件包的标头存在错误。我们从依赖项中排除了这个（连同 geronimo-activation_1.1_spec），它纠正了问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-29T01:16:45.097

这是造成此问题的依赖项，请确保在包含 javax.mail.Transport 类的其他 jar 之前加载 mail.jar。就我而言，罪魁祸首是 javaee-api-5.0-1.jar

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-04T23:03:46.373

我也有同样的问题。当我使用 Spring 和一大堆应用程序 jar 在 TestNG 中运行时，我看到了损坏的电子邮件。当我在普通的 java main 方法中运行时，它工作正常。这是我在 TestNG 与 PSVM 中运行此代码时的类差异

这些是我在 TestNG 中运行时不存在的邮件类：

```
-com.sun.mail.smtp.SMTPTransport$Authenticator
-com.sun.mail.smtp.SMTPTransport$DigestMD5Authenticator
-com.sun.mail.smtp.SMTPTransport$LoginAuthenticator
-com.sun.mail.smtp.SMTPTransport$PlainAuthenticator
-com.sun.mail.util.FolderClosedIOException
-com.sun.mail.util.MessageRemovedIOException
-com.sun.mail.util.PropUtil
-javax.mail.FolderClosedException
-javax.mail.MessageRemovedException
-javax.mail.Multipart
-javax.mail.internet.ParameterList$MultiValue
-javax.net.SocketFactory
-javax.net.ssl.SSLException
-javax.net.ssl.SSLPeerUnverifiedException
-javax.net.ssl.SSLSocket 
```

此邮件类存在于 TestNG 但不存在于 PSVM

```
 +javax.mail.internet.CachedDataHandler 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-11-29T22:32:00.810

就我而言，真正的罪魁祸首是一些亚马逊图书馆正在取代标准传输机制：

```
<dependency>
       <groupId>com.amazonaws</groupId>
       <artifactId>aws-java-sdk</artifactId>
       <version>1.3.9</version>
</dependency> 
```

在创建会话时，我不得不强制会话使用标准会话：

```
properties.setProperty("mail.smtp.class", "com.sun.mail.smtp.SMTPTransport"); // Fix to prevent Amazon AWS from giving their transport 
```

我不得不提一下，我还实现了 Jason 和 Vijay 给出的修复，以排除 geronimo 库。

也许亚马逊 SDK 的传输在内部使用了 geronimo 代码？...

谢谢！

# c++ - MFC：一组单选按钮的 CButton 突出显示

> ID：1010297
> 
> 赞同：0
> 
> 时间：2009-06-18T01:07:05.660
> 
> 标签：c++, mfc, radio-button

我知道我可以为一组单选按钮创建一个整数变量，将其设置为整数，然后调用 UpdateData(FALSE) 以使窗口突出显示相应的单选按钮控件。但是，我可能想改用 CButton 控件，但我不知道如何设置 CButton 状态以便检查组的特定单选按钮。MFC甚至可以这样做吗？提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T20:25:02.080

由于我只需要在启动或重置状态时设置状态，因此我将 CButton 控件与 CButton 控件的适当 id 标志链接，然后再将它们切换为打开状态。CButton 控件稍后可以包含其他值，因为我使用 onclicked() 处理程序来正确映射选定的单选按钮值。

```
void UserControls::DoDataExchange(CDataExchange* pDX)
{
    ...
    // Mapping the integer variables to the Radio control for proper
    // displaying
    // not the id of the first radio button of the group for both of them
    DDX_Control(pDX, IDC_NOBTL, nobCtrl);         
    DDX_Control(pDX, IDC_UIHARD, uiCtrl);
    ...
} 
```

# regex - RegEx - 匹配一组单词

> ID：1010310
> 
> 赞同：3
> 
> 时间：2009-06-18T01:10:31.520
> 
> 标签：regex

我已经在这个上一段时间了，似乎无法解决这个问题。这就是我想要做的。给定三个单词 word1、word2 和 word3，我想构建一个正则表达式，它将按该顺序匹配它们，但它们之间有一组潜在的单词（新行除外）。

例如，如果我有以下内容：

```
word1 = what
word2 = the
word3 = hell 
```

我想用一个匹配来匹配以下字符串：

```
"what the hell"
"what in the hell"
"what the effing hell"
"what in the 9 doors of hell" 
```

我认为我可以执行以下操作（允许每个单词变量之间存在 0 到 5 个单词）：

```
regex = "\bword1(\b\w+\b){0,5}word2(\b\w+\b){0,5}word3\b" 
```

唉，不，它不起作用。重要的是，我有一种方法可以指定单词之间的 am 到 n 个单词的距离（其中 m 始终 < n）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T01:21:01.983

`"\bwhat(\s*\b\w*\b\s*){0,5}the(\s*\b\w*\b\s*){0,5}hell"`为我工作（在 Ruby 中）

```
list = ["what the hell", "what in the hell", "what the effing hell", 
  "what in the 9 doors of hell", "no match here hell", "what match here hell"]

list.map{|i| /\bwhat(\s*\b\w*\b\s*){0,5}the(\s*\b\w*\b\s*){0,5}hell/.match(i) }
=> [#<MatchData:0x12c4d1c>, #<MatchData:0x12c4d08>, #<MatchData:0x12c4cf4>,
   #<MatchData:0x12c4ce0>, nil, nil] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T01:29:32.997

```
$ cat try
#! /usr/bin/perl

use warnings;
use strict;

my @strings = (
  "what the hell",
  "what in the hell",
  "what the effing hell",
  "what in the 9 doors of hell",
  "hello",
  "what the",
  " what the hell",
  "what the hell ",
);

for (@strings) {
  print "$_: ", /^what(\s+\w+){0,5}\s+the(\s+\w+){0,5}\s+hell$/
                  ? "match\n"
                  : "no match\n";
}

$ ./try
what the hell: match
what in the hell: match
what the effing hell: match
what in the 9 doors of hell: match
hello: no match
what the: no match
 what the hell: no match
what the hell : no match 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T03:34:27.860

在clojure中为我工作：

```
(def phrases ["what the hell" "what in the hell" "what the effing hell"
              "what in the 9 doors of hell"])

(def regexp #"\bwhat(\s*\b\w*\b\s*){0,5}the(\s*\b\w*\b\s*){0,5}hell")

(defn valid? []
  (every? identity (map #(re-matches regexp %) phrases)))

(valid?)  ; <-- true 
```

按照本休斯的模式。

# iphone - iPhone SDK 3.0 摄像头访问

> ID：1010317
> 
> 赞同：9
> 
> 时间：2009-06-18T01:13:13.230
> 
> 标签：iphone, camera, augmented-reality

谁能建议 iPhone SDK 3.0 是否仍然不允许访问原始相机像素数据

这就是所有以前的 SDK 的情况，我认为这一定是 Apple 的举措，以确保它们是第一个实现视频录制的。由于3.0现在有录像，据我所知情况还是一样，那么显然我错了。

我想知道的是苹果在玩什么？为什么他们不允许我们在 iPhone 上编写疯狂的超酷增强现实应用程序。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T10:48:23.917

不，使用 SDK 3.0 和新的 Iphone 3GS，您实际上可以使用提供的 API 捕捉电影。您只能观看 10 分钟的视频。

在 UIImagePickerControllerDelegate 中，您现在可以找到 UIImagePickerControllerMediaType。这指定了用户选择的媒体类型。该值是一个 NSString 对象，其中包含一个类型代码，例如 kUTTypeImage 或 kUTTypeMovie。

此方法已添加：

imagePickerController:didFinishPickingMediaWithInfo：告诉代理用户选择了图像或电影。此方法是可选的。

*   (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *)info

参数 picker 管理图像选择器界面的控制器对象。

info 包含原始图像和编辑图像的字典（如果选择了图像）；或电影的文件系统 URL（如果选择了电影）。该词典还包含任何相关的编辑信息。此词典的键列在“编辑信息键”中。</p>

讨论 您的委托对象对此方法的实现应该将指定的媒体传递给任何需要它的自定义代码，然后关闭选取器视图。

启用编辑后，选择器视图会向用户显示当前所选图像或电影的预览以及用于修改它的控件。（此行为在调用此方法之前由选取器视图管理。）如果用户修改图像或电影，则可以在 info 参数中获得编辑信息。原始图像也在 info 参数中返回。

最长影片时长为 10 分钟。如果用户选择时长超过 10 分钟的电影，他们将被迫在保存之前对其进行修剪。

此方法的实现是可选的，但在意料之中。

可用性 适用于 iPhone OS 3.0b 及更高版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-15T00:20:53.497

```
- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *)info

{   
    NSURL *videoURL = [info objectForKey:UIImagePickerControllerMediaURL];

        /* Now put some code here to either write it to a folder or play it

    [self dismissModalViewControllerAnimated:YES];

} 
```

# java - GridBagLayout 重量错误？

> ID：1010323
> 
> 赞同：3
> 
> 时间：2009-06-18T01:16:48.403
> 
> 标签：java, swing, layout, grid

我正在处理的项目中组件的布局看起来不正确，我怀疑 Swing 中存在错误。基本上，似乎正在发生的是，当布置的单元具有不同的最小尺寸和/或首选尺寸时，并没有遵守比例`weightx`。`weighty`我创建了一个示例程序来演示这一点，这里是源代码：

```
package com.ensoftcorp.product.simmerge.gui.swing.dialogs;

import java.awt.Color;
import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;

import javax.swing.BorderFactory;
import javax.swing.Box;
import javax.swing.JButton;
import javax.swing.JComponent;
import javax.swing.JFrame;
import javax.swing.JPanel;

public class TestClass {

    /**
     * @param args
     */
    public static void main(String[] args) {
        try {
            //UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
            new TestClass();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    static final GridBagConstraints GBC_CELL = new GridBagConstraints();
    static final GridBagConstraints GBC_ROWEND = new GridBagConstraints();
    static final GridBagConstraints GBC_FILLROW = new GridBagConstraints();
    static {
        GBC_CELL.anchor = GridBagConstraints.NORTHWEST;
        GBC_CELL.weightx = 0.5;
        GBC_CELL.fill = GridBagConstraints.BOTH;

        GBC_ROWEND.gridwidth = GridBagConstraints.REMAINDER;

        GBC_FILLROW.gridwidth = GridBagConstraints.REMAINDER;
        GBC_FILLROW.weightx = 1.0;
        GBC_FILLROW.fill = GridBagConstraints.BOTH;
    }

    public TestClass() {
        JFrame frame = new JFrame();

        JPanel pnlContent = new JPanel(new GridBagLayout());
        pnlContent.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));

        /*
         * Layout "ruler" panel
         */
        JPanel pnlRuler = new JPanel(new GridBagLayout());

        pnlRuler.add(createRulerCell(Color.BLACK, Color.WHITE),GBC_CELL);
        pnlRuler.add(createRulerCell(Color.BLACK, Color.WHITE),GBC_CELL);

        pnlRuler.add(Box.createHorizontalGlue(),GBC_ROWEND);

        /*
         * Layout "correct" panel
         */
        JPanel pnlGoodLayout = new JPanel(new GridBagLayout());

        pnlGoodLayout.add(new JButton("JButton1"),GBC_CELL);
        pnlGoodLayout.add(new JButton("JButton2"),GBC_CELL);

        pnlGoodLayout.add(Box.createHorizontalGlue(),GBC_ROWEND);

        pnlGoodLayout.add(new JButton("JButton3"),GBC_CELL);
        pnlGoodLayout.add(new JButton("JButton4"),GBC_CELL);

        pnlGoodLayout.add(Box.createHorizontalGlue(),GBC_ROWEND);

        /*
         * Layout "incorrect" panel
         */
        JPanel pnlBadLayout = new JPanel(new GridBagLayout());

        pnlBadLayout.add(new JButton("JButton1"),GBC_CELL);
        pnlBadLayout.add(new JButton("JButton2"),GBC_CELL);

        pnlBadLayout.add(Box.createHorizontalGlue(),GBC_ROWEND);

        pnlBadLayout.add(new JButton("JButton number 3 is wide"),GBC_CELL);
        pnlBadLayout.add(new JButton("JButton4"),GBC_CELL);

        pnlBadLayout.add(Box.createHorizontalGlue(),GBC_ROWEND);

        /*
         * Add panels to main panel
         */
        pnlContent.add(pnlRuler,GBC_FILLROW);
        pnlContent.add(Box.createVerticalStrut(8),GBC_FILLROW);
        pnlContent.add(pnlGoodLayout,GBC_FILLROW);
        pnlContent.add(Box.createVerticalStrut(8),GBC_FILLROW);
        pnlContent.add(pnlBadLayout,GBC_FILLROW);

        /*
         * Configure frame
         */
        frame.getContentPane().add(pnlContent);
        frame.setTitle("GridBagLayout Weight Bug?");

        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(400,200);
        frame.setVisible(true);
}

    JComponent createRulerCell(Color border, Color background) {
        JPanel glue = new JPanel();
        glue.setBorder(BorderFactory.createLineBorder(border));
        glue.setBackground(background);

        return glue;
    }

} 
```

示例程序分为三组……第一组是显示 50% 标记的“标尺”。第二组和第三组是使用 GridBagLayout 的面板，其中每个单元格的 a`weightx`为 0.5。组之间的唯一区别是按钮文本长度，但第二组即使有足够的空间也不会均匀地比例列。

那么我的问题是：以前有没有人遇到过这个问题，并且有他们推荐的解决方法？

PS - 我正在使用 jdk1.6.0_11，如果这有区别的话。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T01:59:17.287

来自[GridBagConstraints.weightx JavaDoc](http://java.sun.com/javase/6/docs/api/java/awt/GridBagConstraints.html#weightx)：

> 指定如何分配额外的水平空间。
> 
> 网格包布局管理器将列的权重计算为列中所有组件的最大权重 x。如果生成的布局在水平方向上小于它需要填充的区域，则额外的空间将按其权重按比例分配到每一列。

考虑到这一点，我不认为这是一个错误，因为带有宽按钮的列被计算为需要更多空间。一旦计算了正常按钮列的大小，就会分配剩余空间。

解决方法：

要解决此问题，您可以在添加每个按钮之前设置`GBC_CELL.gridx`，`GBC_CELL.gridy`在与大按钮共享行的按钮之前，您可以设置

`GBC_CELL.ipadx=100;`

然后`0`在添加宽按钮（#3）之前将其设置为。这应该在更多的网格中对齐您的按钮。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T07:05:42.600

使用内置的[GroupLayout](http://java.sun.com/docs/books/tutorial/uiswing/layout/group.html)。您拥有比 GridBagLayout 更多的控制权。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-07-25T00:11:10.447

这可能会有所帮助[（来源）](http://www.exampledepot.com/egs/java.awt/gridbag_Stretch.html)：

> 当多于一列具有非零权重时，多余的空间使用权重值分布在非零权重列之间。特别是，如果多余的空间是 P 个像素，并且 column^i 的列权重是 weight^i，那么 column^i 正好是 (weight^i * P) / (sum-of-all-column-weights)。例如，如果第 1 列的权重为 1，第 2 列的权重为 2，并且剩余空间为 90 个像素，则第 1 列将获得 30 个额外像素，第 2 列将获得 60 个额外像素。具有非零权重的行以类似的方式表现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-01-27T10:43:19.723

我找到了一个简单的解决方法。`preferredSize.width`将每个属性显式设置`JButton`为`preferredSize.width=0`.

这是这样做的方法：

```
private JButton createButton(String text) {
    JButton button = new JButton(text);
    button.setPreferredSize(new Dimension(0, button.getPreferredSize().height));
    return button;
} 
```

这是您修改后的示例（我用`// <==============`注释标记了更改）：

```
public class TestClass {

    /**
     * @param args
     */
    public static void main(String[] args) {
        try {
            //UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
            new TestClass();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    static final GridBagConstraints GBC_CELL = new GridBagConstraints();
    static final GridBagConstraints GBC_ROWEND = new GridBagConstraints();
    static final GridBagConstraints GBC_FILLROW = new GridBagConstraints();
    static {
        GBC_CELL.anchor = GridBagConstraints.NORTHWEST;
        GBC_CELL.weightx = 0.5;
        GBC_CELL.fill = GridBagConstraints.BOTH;

        GBC_ROWEND.gridwidth = GridBagConstraints.REMAINDER;

        GBC_FILLROW.gridwidth = GridBagConstraints.REMAINDER;
        GBC_FILLROW.weightx = 1.0;
        GBC_FILLROW.fill = GridBagConstraints.BOTH;
    }

    public TestClass() {
        JFrame frame = new JFrame();

        JPanel pnlContent = new JPanel(new GridBagLayout());
        pnlContent.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));

        /*
         * Layout "ruler" panel
         */
        JPanel pnlRuler = new JPanel(new GridBagLayout());

        pnlRuler.add(createRulerCell(Color.BLACK, Color.WHITE),GBC_CELL);
        pnlRuler.add(createRulerCell(Color.BLACK, Color.WHITE),GBC_CELL);

        pnlRuler.add(Box.createHorizontalGlue(),GBC_ROWEND);

        /*
         * Layout "correct" panel
         */
        JPanel pnlGoodLayout = new JPanel(new GridBagLayout());

        pnlGoodLayout.add(createButton("JButton1"),GBC_CELL); // <==============
        pnlGoodLayout.add(createButton("JButton2"),GBC_CELL); // <==============

        pnlGoodLayout.add(Box.createHorizontalGlue(),GBC_ROWEND);

        pnlGoodLayout.add(createButton("JButton3"),GBC_CELL); // <==============
        pnlGoodLayout.add(createButton("JButton4"),GBC_CELL); // <==============

        pnlGoodLayout.add(Box.createHorizontalGlue(),GBC_ROWEND);

        /*
         * Layout "incorrect" panel
         */
        JPanel pnlBadLayout = new JPanel(new GridBagLayout());

        pnlBadLayout.add(createButton("JButton1"),GBC_CELL); // <==============
        pnlBadLayout.add(createButton("JButton2"),GBC_CELL); // <==============

        pnlBadLayout.add(Box.createHorizontalGlue(),GBC_ROWEND);

        pnlBadLayout.add(createButton("JButton number 3 is wide"),GBC_CELL); // <==============
        pnlBadLayout.add(createButton("JButton4"),GBC_CELL); // <==============

        pnlBadLayout.add(Box.createHorizontalGlue(),GBC_ROWEND);

        /*
         * Add panels to main panel
         */
        pnlContent.add(pnlRuler,GBC_FILLROW);
        pnlContent.add(Box.createVerticalStrut(8),GBC_FILLROW);
        pnlContent.add(pnlGoodLayout,GBC_FILLROW);
        pnlContent.add(Box.createVerticalStrut(8),GBC_FILLROW);
        pnlContent.add(pnlBadLayout,GBC_FILLROW);

        /*
         * Configure frame
         */
        frame.getContentPane().add(pnlContent);
        frame.setTitle("GridBagLayout Weight Bug?");

        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(400,200);
        frame.setVisible(true);
    }

    JComponent createRulerCell(Color border, Color background) {
        JPanel glue = new JPanel();
        glue.setBorder(BorderFactory.createLineBorder(border));
        glue.setBackground(background);

        return glue;
    }

    private JButton createButton(String text) {
        JButton button = new JButton(text);
        button.setPreferredSize(new Dimension(0, button.getPreferredSize().height));
        return button;
    }

} 
```

这就是结果的样子。看？现在空间分布均匀：

[![在此处输入图像描述](../Images/24871ad2a0dd196a24b1dea7d3ba96d0.png)](https://i.stack.imgur.com/3F8Y8.png)

[![在此处输入图像描述](../Images/0793c3f87dc54e059286d0661fe42907.png)](https://i.stack.imgur.com/af4sJ.png)

# .net - 重复的 lambda 表达式会解析为相同的生成代码吗？

> ID：1010326
> 
> 赞同：1
> 
> 时间：2009-06-18T01:17:43.940
> 
> 标签：.net, generics

这是一个简单的问题。如果同一个类中两个 lambda 表达式的内容完全相同，编译器会生成并使用一个 backer 方法，还是会为每个实例生成一个方法？

**例子**

```
ctl.MouseOver += (sender,e) => UpdateStatus();
ctl.MouseOut += (sender,e) => UpdateStatus(); 
```

这会产生一两个支持者方法吗？

ps 我知道您可以创建另一个方法 HandleUpdate(object,EventArgs) 并将事件附加到该方法。但我对编译器实际发生了什么更好奇。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T01:27:03.500

情况很复杂。IIRC（我可能离这里很远，我已经有一段时间没有阅读确切的细节了），两个表达式*可以*“解析”到同一个实例，但实际上很难做到，因为表达式往往会创建闭包略有不同，需要用表达式提升。基本上，呼叫站点也很重要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T01:20:41.827

我的经验是它会生成两个副本。可能有一些我没有达到的优化，但是每次我检查我的代码时，我都会得到两个副本。

如果您要进行重复处理，我建议您创建一个 HandleUpdate 方法，正如您所提到的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T01:35:46.913

将 lambda 表达式放在同一个类中并不足以认为表达式相同，因为编译器也会考虑在哪个方法中调用它们。

在同一个方法中使用同一个表达式两次，你可能会得到同一个实例，但我不会编写依赖于这种行为的代码。

If you really need to know the current behaviour of the compiler, grab a copy of [reflector](http://www.red-gate.com/products/reflector/) and have a look at the IL generated.

# flash - FLVPlayback 全屏按钮不起作用

> ID：1010327
> 
> 赞同：1
> 
> 时间：2009-06-18T01:17:46.123
> 
> 标签：flash, actionscript-3, macos, safari

在我使用 FLVPlayback 的 Flash 视频中，单击全屏按钮不会执行任何操作，无论是在 html 加载版本中还是在本地运行时（更麻烦的是）。我在对象中将“allowFullscreen”设置为 true，并在 html 版本中设置了嵌入标签。在本地运行时，flash 控制台中没有错误。 [例子。](http://e1.simplecdn.net/newview/simplecdn_test.html)

关于我做错了什么的任何想法？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T09:39:12.653

如果您的意思是 FLVPlayback 控件的全屏按钮，那对我有用。我在 Mac OSX 10.4.11 上使用 Firefox 3.0.11

如果您是： 测试浏览器将对象和嵌入标签的 allowFullscreen 设置为 true ，一切都应该没问题。

[我发现displayState](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/display/Stage.html#displayState)属性的示例代码很方便：

```
function createMouseListener(event:Event):void {
            stage.addEventListener(MouseEvent.CLICK,toggleFullScreen);
        }        

function toggleFullScreen(event:MouseEvent):void {
            if(stage.displayState == "fullScreen") 
stage.displayState = "normal"
else
stage.displayState = "fullScreen"
        } 
```

再说一次，您可以在一行中执行此操作，因为您使用的是 FLVPlayback 组件的 [enterFullScreenDisplayState](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/fl/video/FLVPlayback.html#enterFullScreenDisplayState())方法，或者如果您有一个带有全屏按钮的皮肤（您这样做:)），则可以使用 0 行代码

**我注意到在 html 文件中，allowFullscreen 在 object 标记中设置为“1”而不是 true，在 embed 标记中设置为“true”。我记得不同的浏览器使用不同的标签。我猜Firefox正在使用嵌入，因为它对我有用。如果它不起作用，您可能正在使用 Internet Explorer（我目前无法对其进行测试）。尝试在对象标记中将 allowFullscreen 设置为“true”。**

祝你好运 ！

# c - C比较char和int

> ID：1010330
> 
> 赞同：5
> 
> 时间：2009-06-18T01:18:11.223
> 
> 标签：c

在下面的代码块中，7 的 if 语句中发生的隐式转换是什么？我会认为它最终会是 (0x98 <= 0x07) 但当条件评估为 true 并且调用 DoMyStuff 时，情况并非如此。

```
char minstogo = 0x98;
if(minstogo <= 7) {
   DoMyStuff();
} 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-06-18T01:45:28.580

每当您在`+` `-` `*` `/` `%` `<<` `>>` `&` `|` `^` `==` `!=` `<` `<=` `>` `>=`不同类型的两个整数操作数之间有一个二元运算符（其中一个）时，这两种类型都会在执行操作之前转换为公共类型。决定转换为类型的规则是（来自 C99 标准的第 6.3.1.8 节）：

> 如果两个操作数具有相同的类型，则不需要进一步的转换。
> 
> 否则，如果两个操作数都具有有符号整数类型或都具有无符号整数类型，则具有较小整数转换等级的类型的操作数将转换为具有较高等级的操作数的类型。
> 
> 否则，如果无符号整数类型的操作数的等级大于或等于另一个操作数类型的等级，则将有符号整数类型的操作数转换为无符号整数类型的操作数的类型。
> 
> 否则，如果有符号整数类型的操作数的类型可以表示无符号整数类型的操作数的所有值，则将无符号整数类型的操作数转换为有符号整数类型的操作数的类型。
> 
> 否则，两个操作数都转换为与带符号整数类型的操作数类型对应的无符号整数类型。

在这种情况下，`char`可以是有符号或无符号整数类型——它的符号是实现定义的。不过幸运的是，假设您在一个s 为 8 位且s 至少为 16 位的系统上，an`int`可以表示 a 的所有可能值`char`，无论是否带符号。`char``char``int`

如果`char`是有符号的，那么上面的第二段适用，因此两个操作数都被转换为`int`（具有更高等级的类型；等级以某种复杂的方式定义，但它本质上等同于该类型的位大小）。由于 0x98 作为有符号`char`的 是负数，因此将其转换为整数 -104，即小于 7。

如果相反`char`是未签名的，则适用第四段。无符号`char`数将转换为 152 作为`int`，大于 7。

永远不要依赖`char`s 被签名或未签名。如果您需要具有特定符号的 8 位整数，请显式使用`signed char`or `unsigned char`，或使用 C99 类型`int8_t`and `uint8_t`，定义 int `<stdint.h>`。

整数提升规则引起的细微错误很容易被咬。我强烈建议您始终`-Wall`使用 gcc 进行编译，它会警告您有符号和无符号整数之间的比较，这通常是导致错误的原因。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-18T01:23:24.677

这里可能发生的是 char 是有符号值，因此 0x98 注册为负数。因此小于 7

同样在这种情况下，7 将不进行任何转换。相反，char 将扩大到与 7 相同的整数类型，然后进行比较。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T01:29:01.827

将字符表示为 8 位字节，将 minstogo 设置为 0x98 是二进制值 10011000。符号位已设置，它是一个负整数值。您可能需要一个 unsigned char 以便测试评估为假。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T01:29:02.887

`0x98 <= 7`除非平台的`char`类型默认为有符号且为 8，否则它的评估结果相同`CHAR_BIT`。在这种情况下， 的值为`minstogo`负数且`minstogo <= 7`为真。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T01:24:41.163

使用具有当前设置的编译器，char 是有符号类型：并且由于设置了其值的高位 (0x80)，因此该值为负数。当 minstogo 被加宽时，该负号被保留（通过符号扩展），因此 minstogo 被加宽为小于 7 的负整数（例如 0xFF98）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T01:27:09.460

0x98 是 152。

由于您声明了“char”，而不是“unsigned char”，因此您尝试将 152 分配给范围为[-128 - 127](http://msdn.microsoft.com/en-us/library/s3f49ktz(VS.80).aspx)的类型。

这将溢出，并给您一个负数，即 < 7 (0x07)。

# html - 将 html 布局转换为 Silverlight 3.0 的工具

> ID：1010331
> 
> 赞同：1
> 
> 时间：2009-06-18T01:18:42.020
> 
> 标签：html, silverlight, xaml, silverlight-3.0, xaml-tools

我有几个客户的应用程序被拖入网络踢腿和尖叫。即使只是作为概念验证练习，我也想尝试将一些内容迁移到 Silverlight 3.0。我想看看我是否可以让它们成为完整的应用程序、布局等等。我认为带有图形的网络应用程序的布局很好，并且不想失去这一方面。

这引出了我的问题，是否有将现有 HTML/图形转换为 Xaml 的工具？我宁愿使用 SL 3.0 导航，而不是在每个页面上嵌入 Silverlight xap，因为我必须使用 ASP.NET MVC / Silverlight 类型的解决方案。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T01:36:12.327

在做了一些研究后，我问了一个相关的精神问题，我可以很自信地说不。有一些 Silverlight 1.0 和 2.0 的工具，您可以通过简单的 google 搜索（术语：html 到 xaml 转换器）找到，但没有专门针对 Silverlight 3.0

如果您使用 Fireworks 来设计您的网站，[Infragistics](http://www.infragistics.com/design/Fireworks_XAML_Exporter.aspx)的 xaml 导出器可能会有所帮助，否则您可能会不走运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T01:53:35.817

刚刚经历了这个（现有的 ASP.NET 到 Silverlight 3），我建议不要尝试自动转换布局。与 ASP.NET 相比，Silverlight 具有一组非常离散的控件和布局机制，如果有任何工具进行了简洁的翻译，我会感到非常惊讶。自动生成代码的工具（无论是 XAML 还是 HTML）往往会创建非常次优的语法（想到表达式设计 -> XAML）。如果你成功了，你仍然需要考虑整个数据访问模式，这也将驱动你的 XAML 的结构。

# asp.net - 为什么我的 img 没有出现在 ASP.NET 中

> ID：1010339
> 
> 赞同：0
> 
> 时间：2009-06-18T01:21:48.330
> 
> 标签：asp.net, visual-studio

我使用 MSVS 9 创建了一个 C# web 项目，这就是我对我的配置所了解的全部内容。

在我的浏览器中，我可以访问我项目中的任何 aspx 文件。但是，当我使用[http://localhost:3288/img/test.png 时，](http://localhost:3288/img/test.png)我什么也看不到。工作目录是 ./root，png 文件在 ./root/img/test.png 我如何让 ASP.NET 显示我的图像和文件夹中的所有其他内容？（和子文件夹）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T01:26:48.180

.png 是否包含在解决方案中？

当您点击“播放”按钮时，您实际上启动了一个新网站（ localhost:2383 ），因此如果它不在解决方案中，它不会被复制到调试器附加的新的临时网站。

如果这是问题，快速解决方法是点击解决方案资源管理器顶部的“显示所有文件”按钮，这将显示硬盘驱动器上该文件夹中的所有文件。然后右键单击要包含的 .png 并点击“包含在项目中”。

* * *

根据您的评论，您唯一的解决方案是实际为您的解决方案创建一个 IIS 站点，其根目录与您的 Web 项目相同。然后在项目属性中，您必须告诉调试器附加到本地 IIS 而不是 Visual Studio。不确定确切的单击路径，右键单击您的项目并转到属性，查找调试选项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T01:39:08.327

看一下[ASP Image 控件](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.image.aspx)，您可以指定从您的应用根目录 (~) 开始的路径：

```
<asp:Image id="Image1" runat="server"
           ImageUrl="~/Images/image1.png"/> 
```

或者，您可以使用显示的页面的相对路径。

查看这篇关于[ASP .NET 网站路径](http://msdn.microsoft.com/en-us/library/ms178116.aspx)的文章。

# ios - 如何使用 AVAudioRecorder 在 iPhone 上录制音频？

> ID：1010343
> 
> 赞同：148
> 
> 时间：2009-06-18T01:24:43.177
> 
> 标签：ios, objective-c, iphone, audio, recording

现在 iPhone 3.0 SDK 已经公开，我想我可以向那些已经在使用 3.0 SDK 的人提出这个问题。我想在我的应用程序中录制音频，但我想使用而不是像示例所示`AVAudioRecorder`的旧录制方式。`SpeakHere`iPhone Dev Center 中没有任何关于如何最好地做到这一点的示例，仅引用了这些类。我是 iPhone 开发的新手，所以我正在寻找一个简单的示例来帮助我入门。

* * *

## 回答 #1

> 赞同：207
> 
> 时间：2009-06-18T07:31:26.403

实际上，根本没有例子。这是我的工作代码。记录由用户按下导航栏上的按钮触发。录音使用 cd 质量（44100 个样本）、立体声（2 通道）线性 pcm。注意：如果您想使用不同的格式，尤其是编码格式，请确保您完全了解如何设置 AVAudioRecorder 设置（仔细阅读音频类型文档），否则您将永远无法正确初始化它。还有一件事。在代码中，我没有展示如何处理计量数据，但您可以轻松搞定。最后，请注意，在撰写本文时，AVAudioRecorder 方法 deleteRecording 会使您的应用程序崩溃。这就是我通过文件管理器删除录制文件的原因。录制完成后，我使用 KVC 将录制的音频作为 NSData 保存在当前编辑的对象中。

```
#define DOCUMENTS_FOLDER [NSHomeDirectory() stringByAppendingPathComponent:@"Documents"]

- (void) startRecording{

UIBarButtonItem *stopButton = [[UIBarButtonItem alloc] initWithTitle:@"Stop" style:UIBarButtonItemStyleBordered  target:self action:@selector(stopRecording)];
self.navigationItem.rightBarButtonItem = stopButton;
[stopButton release];

AVAudioSession *audioSession = [AVAudioSession sharedInstance];
NSError *err = nil;
[audioSession setCategory :AVAudioSessionCategoryPlayAndRecord error:&err];
if(err){
    NSLog(@"audioSession: %@ %d %@", [err domain], [err code], [[err userInfo] description]);
    return;
}
[audioSession setActive:YES error:&err];
err = nil;
if(err){
    NSLog(@"audioSession: %@ %d %@", [err domain], [err code], [[err userInfo] description]);
    return;
}

recordSetting = [[NSMutableDictionary alloc] init];

[recordSetting setValue :[NSNumber numberWithInt:kAudioFormatLinearPCM] forKey:AVFormatIDKey];
[recordSetting setValue:[NSNumber numberWithFloat:44100.0] forKey:AVSampleRateKey]; 
[recordSetting setValue:[NSNumber numberWithInt: 2] forKey:AVNumberOfChannelsKey];

[recordSetting setValue :[NSNumber numberWithInt:16] forKey:AVLinearPCMBitDepthKey];
[recordSetting setValue :[NSNumber numberWithBool:NO] forKey:AVLinearPCMIsBigEndianKey];
[recordSetting setValue :[NSNumber numberWithBool:NO] forKey:AVLinearPCMIsFloatKey];

// Create a new dated file
NSDate *now = [NSDate dateWithTimeIntervalSinceNow:0];
NSString *caldate = [now description];
recorderFilePath = [[NSString stringWithFormat:@"%@/%@.caf", DOCUMENTS_FOLDER, caldate] retain];

NSURL *url = [NSURL fileURLWithPath:recorderFilePath];
err = nil;
recorder = [[ AVAudioRecorder alloc] initWithURL:url settings:recordSetting error:&err];
if(!recorder){
    NSLog(@"recorder: %@ %d %@", [err domain], [err code], [[err userInfo] description]);
    UIAlertView *alert =
    [[UIAlertView alloc] initWithTitle: @"Warning"
                               message: [err localizedDescription]
                              delegate: nil
                     cancelButtonTitle:@"OK"
                     otherButtonTitles:nil];
    [alert show];
    [alert release];
    return;
}

//prepare to record
[recorder setDelegate:self];
[recorder prepareToRecord];
recorder.meteringEnabled = YES;

BOOL audioHWAvailable = audioSession.inputIsAvailable;
if (! audioHWAvailable) {
    UIAlertView *cantRecordAlert =
    [[UIAlertView alloc] initWithTitle: @"Warning"
                               message: @"Audio input hardware not available"
                              delegate: nil
                     cancelButtonTitle:@"OK"
                     otherButtonTitles:nil];
    [cantRecordAlert show];
    [cantRecordAlert release]; 
    return;
}

// start recording
[recorder recordForDuration:(NSTimeInterval) 10];

}

- (void) stopRecording{

[recorder stop];

NSURL *url = [NSURL fileURLWithPath: recorderFilePath];
NSError *err = nil;
NSData *audioData = [NSData dataWithContentsOfFile:[url path] options: 0 error:&err];
if(!audioData)
    NSLog(@"audio data: %@ %d %@", [err domain], [err code], [[err userInfo] description]);
[editedObject setValue:[NSData dataWithContentsOfURL:url] forKey:editedFieldKey];   

//[recorder deleteRecording];

NSFileManager *fm = [NSFileManager defaultManager];

err = nil;
[fm removeItemAtPath:[url path] error:&err];
if(err)
    NSLog(@"File Manager: %@ %d %@", [err domain], [err code], [[err userInfo] description]);

UIBarButtonItem *startButton = [[UIBarButtonItem alloc] initWithTitle:@"Record" style:UIBarButtonItemStyleBordered  target:self action:@selector(startRecording)];
self.navigationItem.rightBarButtonItem = startButton;
[startButton release];

}

- (void)audioRecorderDidFinishRecording:(AVAudioRecorder *) aRecorder successfully:(BOOL)flag
{

NSLog (@"audioRecorderDidFinishRecording:successfully:");
// your actions here

} 
```

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2010-12-05T01:07:58.467

尽管这是一个已回答的问题（而且有点老），但我决定将我的完整工作代码发布给那些发现很难找到好的工作（开箱即用）播放和录制示例的其他人 - 包括编码、pcm、通过扬声器播放，写入文件这里是：

**AudioPlayerViewController.h：**

```
#import <UIKit/UIKit.h>
#import <AVFoundation/AVFoundation.h>

@interface AudioPlayerViewController : UIViewController {
AVAudioPlayer *audioPlayer;
AVAudioRecorder *audioRecorder;
int recordEncoding;
enum
{
    ENC_AAC = 1,
    ENC_ALAC = 2,
    ENC_IMA4 = 3,
    ENC_ILBC = 4,
    ENC_ULAW = 5,
    ENC_PCM = 6,
} encodingTypes;
}

-(IBAction) startRecording;
-(IBAction) stopRecording;
-(IBAction) playRecording;
-(IBAction) stopPlaying;

@end 
```

**AudioPlayerViewController.m：**

```
#import "AudioPlayerViewController.h"

@implementation AudioPlayerViewController

- (void)viewDidLoad
{
    [super viewDidLoad];
    recordEncoding = ENC_AAC;
}

-(IBAction) startRecording
{
NSLog(@"startRecording");
[audioRecorder release];
audioRecorder = nil;

// Init audio with record capability
AVAudioSession *audioSession = [AVAudioSession sharedInstance];
[audioSession setCategory:AVAudioSessionCategoryRecord error:nil];

NSMutableDictionary *recordSettings = [[NSMutableDictionary alloc] initWithCapacity:10];
if(recordEncoding == ENC_PCM)
{
    [recordSettings setObject:[NSNumber numberWithInt: kAudioFormatLinearPCM] forKey: AVFormatIDKey];
    [recordSettings setObject:[NSNumber numberWithFloat:44100.0] forKey: AVSampleRateKey];
    [recordSettings setObject:[NSNumber numberWithInt:2] forKey:AVNumberOfChannelsKey];
    [recordSettings setObject:[NSNumber numberWithInt:16] forKey:AVLinearPCMBitDepthKey];
    [recordSettings setObject:[NSNumber numberWithBool:NO] forKey:AVLinearPCMIsBigEndianKey];
    [recordSettings setObject:[NSNumber numberWithBool:NO] forKey:AVLinearPCMIsFloatKey];   
}
else
{
    NSNumber *formatObject;

    switch (recordEncoding) {
        case (ENC_AAC): 
            formatObject = [NSNumber numberWithInt: kAudioFormatMPEG4AAC];
            break;
        case (ENC_ALAC):
            formatObject = [NSNumber numberWithInt: kAudioFormatAppleLossless];
            break;
        case (ENC_IMA4):
            formatObject = [NSNumber numberWithInt: kAudioFormatAppleIMA4];
            break;
        case (ENC_ILBC):
            formatObject = [NSNumber numberWithInt: kAudioFormatiLBC];
            break;
        case (ENC_ULAW):
            formatObject = [NSNumber numberWithInt: kAudioFormatULaw];
            break;
        default:
            formatObject = [NSNumber numberWithInt: kAudioFormatAppleIMA4];
    }

    [recordSettings setObject:formatObject forKey: AVFormatIDKey];
    [recordSettings setObject:[NSNumber numberWithFloat:44100.0] forKey: AVSampleRateKey];
    [recordSettings setObject:[NSNumber numberWithInt:2] forKey:AVNumberOfChannelsKey];
    [recordSettings setObject:[NSNumber numberWithInt:12800] forKey:AVEncoderBitRateKey];
    [recordSettings setObject:[NSNumber numberWithInt:16] forKey:AVLinearPCMBitDepthKey];
    [recordSettings setObject:[NSNumber numberWithInt: AVAudioQualityHigh] forKey: AVEncoderAudioQualityKey];
}

NSURL *url = [NSURL fileURLWithPath:[NSString stringWithFormat:@"%@/recordTest.caf", [[NSBundle mainBundle] resourcePath]]];

NSError *error = nil;
audioRecorder = [[ AVAudioRecorder alloc] initWithURL:url settings:recordSettings error:&error];

if ([audioRecorder prepareToRecord] == YES){
    [audioRecorder record];
}else {
    int errorCode = CFSwapInt32HostToBig ([error code]); 
    NSLog(@"Error: %@ [%4.4s])" , [error localizedDescription], (char*)&errorCode); 

}
NSLog(@"recording");
}

-(IBAction) stopRecording
{
NSLog(@"stopRecording");
[audioRecorder stop];
NSLog(@"stopped");
}

-(IBAction) playRecording
{
NSLog(@"playRecording");
// Init audio with playback capability
AVAudioSession *audioSession = [AVAudioSession sharedInstance];
[audioSession setCategory:AVAudioSessionCategoryPlayback error:nil];

NSURL *url = [NSURL fileURLWithPath:[NSString stringWithFormat:@"%@/recordTest.caf", [[NSBundle mainBundle] resourcePath]]];
NSError *error;
audioPlayer = [[AVAudioPlayer alloc] initWithContentsOfURL:url error:&error];
audioPlayer.numberOfLoops = 0;
[audioPlayer play];
NSLog(@"playing");
}

-(IBAction) stopPlaying
{
NSLog(@"stopPlaying");
[audioPlayer stop];
NSLog(@"stopped");
}

- (void)dealloc
{
[audioPlayer release];
[audioRecorder release];
[super dealloc];
}

@end 
```

希望这会对你们中的一些人有所帮助。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-09-09T05:53:49.050

我已经上传了一个示例项目。你可以看看。

[录音机](https://github.com/AvinashP/VoiceRecorder)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-10-06T07:45:33.500

它真的很有帮助。我唯一的问题是录制后创建的声音文件的大小。我需要减小文件大小，所以我对设置进行了一些更改。

```
NSMutableDictionary *recordSetting = [[NSMutableDictionary alloc] init];
[recordSetting setValue :[NSNumber numberWithInt:kAudioFormatAppleIMA4] forKey:AVFormatIDKey];
[recordSetting setValue:[NSNumber numberWithFloat:16000.0] forKey:AVSampleRateKey];
[recordSetting setValue:[NSNumber numberWithInt: 1] forKey:AVNumberOfChannelsKey]; 
```

文件大小从 360kb 减少到仅 25kb（2 秒录制）。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-02-03T22:41:04.360

在过去的 2 个小时里，我一直试图让这段代码正常工作，虽然它在模拟器上没有显示错误，但设备上有一个错误。

事实证明，至少在我的情况下，错误来自使用的目录（捆绑）：

```
NSURL *url = [NSURL fileURLWithPath:[NSString stringWithFormat:@"%@/recordTest.caf", [[NSBundle mainBundle] resourcePath]]]; 
```

它不可写或类似的东西......除了prepareToRecord失败的事实之外没有错误......

因此，我将其替换为：

```
NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
NSString *recDir = [paths objectAtIndex:0];
NSURL *url = [NSURL fileURLWithPath:[NSString stringWithFormat:@"%@/recordTest.caf", recDir]] 
```

它现在就像一个魅力。

希望这对其他人有帮助。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-02-02T11:36:24.063

非常感谢**@Massimo Cafaro**和**Shaybc** 我能够完成以下任务

***在 iOS 8 中：***

> **录制音频并保存**
> 
> **播放保存的录音**

1.将“AVFoundation.framework”添加到您的项目中

在 .h 文件中

2.在导入语句'AVFoundation/AVFoundation.h'下面添加。

3.定义“AVAudioRecorderDelegate”

4.使用录制、播放按钮及其操作方法创建布局

5.定义记录器和播放器等。

这是可能对您有所帮助的完整示例代码。

> 视图控制器.h

```
#import <UIKit/UIKit.h>
#import <AVFoundation/AVFoundation.h>

@interface ViewController : UIViewController <AVAudioRecorderDelegate>

@property(nonatomic,strong) AVAudioRecorder *recorder;
@property(nonatomic,strong) NSMutableDictionary *recorderSettings;
@property(nonatomic,strong) NSString *recorderFilePath;
@property(nonatomic,strong) AVAudioPlayer *audioPlayer;
@property(nonatomic,strong) NSString *audioFileName;

- (IBAction)startRecording:(id)sender;
- (IBAction)stopRecording:(id)sender;

- (IBAction)startPlaying:(id)sender;
- (IBAction)stopPlaying:(id)sender;

@end 
```

然后在

> 视图控制器.m

```
#import "ViewController.h"

#define DOCUMENTS_FOLDER [NSHomeDirectory() stringByAppendingPathComponent:@"Documents"]

@interface ViewController ()
@end

@implementation ViewController

@synthesize recorder,recorderSettings,recorderFilePath;
@synthesize audioPlayer,audioFileName;

#pragma mark - View Controller Life cycle methods
- (void)viewDidLoad
{
    [super viewDidLoad];
}
- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
}

#pragma mark - Audio Recording
- (IBAction)startRecording:(id)sender
{
    AVAudioSession *audioSession = [AVAudioSession sharedInstance];
    NSError *err = nil;
    [audioSession setCategory :AVAudioSessionCategoryPlayAndRecord error:&err];
    if(err)
    {
        NSLog(@"audioSession: %@ %ld %@", [err domain], (long)[err code], [[err userInfo] description]);
        return;
    }
    [audioSession setActive:YES error:&err];
    err = nil;
    if(err)
    {
        NSLog(@"audioSession: %@ %ld %@", [err domain], (long)[err code], [[err userInfo] description]);
        return;
    }

    recorderSettings = [[NSMutableDictionary alloc] init];
    [recorderSettings setValue :[NSNumber numberWithInt:kAudioFormatLinearPCM] forKey:AVFormatIDKey];
    [recorderSettings setValue:[NSNumber numberWithFloat:44100.0] forKey:AVSampleRateKey];
    [recorderSettings setValue:[NSNumber numberWithInt: 2] forKey:AVNumberOfChannelsKey];
    [recorderSettings setValue :[NSNumber numberWithInt:16] forKey:AVLinearPCMBitDepthKey];
    [recorderSettings setValue :[NSNumber numberWithBool:NO] forKey:AVLinearPCMIsBigEndianKey];
    [recorderSettings setValue :[NSNumber numberWithBool:NO] forKey:AVLinearPCMIsFloatKey];

    // Create a new audio file
    audioFileName = @"recordingTestFile";
    recorderFilePath = [NSString stringWithFormat:@"%@/%@.caf", DOCUMENTS_FOLDER, audioFileName] ;

    NSURL *url = [NSURL fileURLWithPath:recorderFilePath];
    err = nil;
    recorder = [[ AVAudioRecorder alloc] initWithURL:url settings:recorderSettings error:&err];
    if(!recorder){
        NSLog(@"recorder: %@ %ld %@", [err domain], (long)[err code], [[err userInfo] description]);
        UIAlertView *alert =
        [[UIAlertView alloc] initWithTitle: @"Warning" message: [err localizedDescription] delegate: nil
                         cancelButtonTitle:@"OK" otherButtonTitles:nil];
        [alert show];
        return;
    }

    //prepare to record
    [recorder setDelegate:self];
    [recorder prepareToRecord];
    recorder.meteringEnabled = YES;

    BOOL audioHWAvailable = audioSession.inputIsAvailable;
    if (! audioHWAvailable) {
        UIAlertView *cantRecordAlert =
        [[UIAlertView alloc] initWithTitle: @"Warning"message: @"Audio input hardware not available"
                                  delegate: nil cancelButtonTitle:@"OK" otherButtonTitles:nil];
        [cantRecordAlert show];
        return;
    }

    // start recording
    [recorder recordForDuration:(NSTimeInterval) 60];//Maximum recording time : 60 seconds default
    NSLog(@"Recroding Started");
}

- (IBAction)stopRecording:(id)sender
{
    [recorder stop];
    NSLog(@"Recording Stopped");
}

- (void)audioRecorderDidFinishRecording:(AVAudioRecorder *) aRecorder successfully:(BOOL)flag
{
    NSLog (@"audioRecorderDidFinishRecording:successfully:");
}

#pragma mark - Audio Playing
- (IBAction)startPlaying:(id)sender
{
    NSLog(@"playRecording");

    AVAudioSession *audioSession = [AVAudioSession sharedInstance];
    [audioSession setCategory:AVAudioSessionCategoryPlayback error:nil];

     NSURL *url = [NSURL fileURLWithPath:[NSString stringWithFormat:@"%@/%@.caf", DOCUMENTS_FOLDER, audioFileName]];
    NSError *error;
    audioPlayer = [[AVAudioPlayer alloc] initWithContentsOfURL:url error:&error];
    audioPlayer.numberOfLoops = 0;
    [audioPlayer play];
    NSLog(@"playing");
}
- (IBAction)stopPlaying:(id)sender
{
    [audioPlayer stop];
    NSLog(@"stopped");
}

@end 
```

![在此处输入图像描述](../Images/2e0686db5e49c0ee565761fb5958367c.png)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-29T02:56:22.523

好的，所以我得到的答案帮助我朝着正确的方向前进，我非常感谢。它帮助我弄清楚了如何在 iPhone 上实际录制，但我想我还会包含一些从 iPhone 参考库中获得的有用代码：

[音视频技术](http://developer.apple.com/IPhone/library/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/AudioandVideoTechnologies/AudioandVideoTechnologies.html#//apple_ref/doc/uid/TP40007072-CH19-SW14)

我使用了这段代码并很容易地将它添加到 avTouch 示例中。使用上面的代码示例和参考库中的示例，我能够让它工作得很好。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-09-24T19:56:08.823

在以下链接中，您可以找到有关使用 AVAudioRecording 进行录制的有用信息。在第一部分“使用音频”的此链接中，有一个名为“使用 AVAudioRecorder 类录制”的锚点。这将引导您查看示例。

[AudioVideo Conceptual MultimediaPG](http://developer.apple.com/library/ios/#documentation/AudioVideo/Conceptual/MultimediaPG/UsingAudio/UsingAudio.html#//apple_ref/doc/uid/TP40009767-CH2-SW6)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-07-04T12:57:35.117

```
This is from Multimedia programming guide...

- (IBAction) recordOrStop: (id) sender {
if (recording) {
    [soundRecorder stop];
    recording = NO;
    self.soundRecorder = nil;
    [recordOrStopButton setTitle: @"Record" forState:
     UIControlStateNormal];
    [recordOrStopButton setTitle: @"Record" forState:
     UIControlStateHighlighted];
    [[AVAudioSession sharedInstance] setActive: NO error:nil];
} 
else {
    [[AVAudioSession sharedInstance]
     setCategory: AVAudioSessionCategoryRecord
     error: nil];
    NSDictionary *recordSettings =
    [[NSDictionary alloc] initWithObjectsAndKeys:[NSNumber numberWithFloat: 44100.0], AVSampleRateKey,
     [NSNumber numberWithInt: kAudioFormatAppleLossless], AVFormatIDKey,
     [NSNumber numberWithInt: 1], AVNumberOfChannelsKey,
     [NSNumber numberWithInt: AVAudioQualityMax],
     AVEncoderAudioQualityKey,
     nil];
    AVAudioRecorder *newRecorder =
    [[AVAudioRecorder alloc] initWithURL: soundFileURL
                                settings: recordSettings
                                   error: nil];
    [recordSettings release];
    self.soundRecorder = newRecorder;
    [newRecorder release];
    soundRecorder.delegate = self;
    [soundRecorder prepareToRecord];
    [soundRecorder record];
    [recordOrStopButton setTitle: @"Stop" forState: UIControlStateNormal];
    [recordOrStopButton setTitle: @"Stop" forState: UIControlStateHighlighted];
    recording = YES;
}
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-08-29T08:24:09.937

对于音频设置下方的 wav 格式

```
NSDictionary *audioSetting = [NSDictionary dictionaryWithObjectsAndKeys:
                              [NSNumber numberWithFloat:44100.0],AVSampleRateKey,
                              [NSNumber numberWithInt:2],AVNumberOfChannelsKey,
                              [NSNumber numberWithInt:16],AVLinearPCMBitDepthKey,
                              [NSNumber numberWithInt:kAudioFormatLinearPCM],AVFormatIDKey,
                              [NSNumber numberWithBool:NO], AVLinearPCMIsFloatKey, 
                              [NSNumber numberWithBool:0], AVLinearPCMIsBigEndianKey,
                              [NSNumber numberWithBool:NO], AVLinearPCMIsNonInterleaved,
                              [NSData data], AVChannelLayoutKey, nil]; 
```

参考： http: [//objective-audio.jp/2010/09/avassetreaderavassetwriter.html](http://objective-audio.jp/2010/09/avassetreaderavassetwriter.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-02-19T15:57:34.573

**开始**

```
NSError *sessionError = nil;
[[AVAudioSession sharedInstance] setDelegate:self];
[[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayAndRecord error:&sessionError];
[[AVAudioSession sharedInstance] setActive: YES error: nil];
UInt32 doChangeDefaultRoute = 1;
AudioSessionSetProperty(kAudioSessionProperty_OverrideCategoryDefaultToSpeaker, sizeof(doChangeDefaultRoute), &doChangeDefaultRoute);

NSError *error = nil;
NSString *filename = [NSString stringWithFormat:@"%@.caf",FILENAME];
NSString *path = [[NSHomeDirectory() stringByAppendingPathComponent:@"Documents"] stringByAppendingPathComponent:filename];
NSURL *soundFileURL = [NSURL fileURLWithPath:path];

NSDictionary *recordSettings = [NSDictionary dictionaryWithObjectsAndKeys:
                                [NSNumber numberWithInt: kAudioFormatMPEG4AAC], AVFormatIDKey,
                                [NSNumber numberWithInt:AVAudioQualityMedium],AVEncoderAudioQualityKey,
                                [NSNumber numberWithInt:AVAudioQualityMedium], AVSampleRateConverterAudioQualityKey,
                                [NSNumber numberWithInt: 1], AVNumberOfChannelsKey,
                                [NSNumber numberWithFloat:22050.0],AVSampleRateKey,
                                nil];

AVAudioRecorder *audioRecorder = [[AVAudioRecorder alloc]
                 initWithURL:soundFileURL
                 settings:recordSettings
                 error:&error];

if (!error && [audioRecorder prepareToRecord])
{
    [audioRecorder record];
} 
```

**停止**

```
[audioRecorder stop];
[audioRecorder release];
audioRecorder = nil; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-07-25T04:57:50.000

```
-(void)viewDidLoad {
 // Setup audio session
    AVAudioSession *session = [AVAudioSession sharedInstance];
    [session setCategory:AVAudioSessionCategoryPlayAndRecord error:nil];

    // Define the recorder setting
    NSMutableDictionary *recordSetting = [[NSMutableDictionary alloc] init];

    [recordSetting setValue:[NSNumber numberWithInt:kAudioFormatMPEG4AAC] forKey:AVFormatIDKey];
    [recordSetting setValue:[NSNumber numberWithFloat:44100.0] forKey:AVSampleRateKey];
    [recordSetting setValue:[NSNumber numberWithInt: 2] forKey:AVNumberOfChannelsKey];

    // Initiate and prepare the recorder
    recorder = [[AVAudioRecorder alloc] initWithURL:outputFileURL settings:recordSetting error:NULL];
    recorder.delegate = self;
    recorder.meteringEnabled = YES;
    [recorder prepareToRecord];

}    

- (IBAction)btnRecordDidClicked:(UIButton *)sender {
        if (player1.playing) {
            [player1 stop];
        }

        if (!recorder.recording) {
            AVAudioSession *session = [AVAudioSession sharedInstance];
            [session setActive:YES error:nil];

            // Start recording
            [recorder record];
            [_recordTapped setTitle:@"Pause" forState:UIControlStateNormal];

        } else {

            // Pause recording
            [recorder pause];
            [_recordTapped setTitle:@"Record" forState:UIControlStateNormal];
        }

        [_stopTapped setEnabled:YES];
        [_playTapped setEnabled:NO];

    }

    - (IBAction)btnPlayDidClicked:(UIButton *)sender {
        if (!recorder.recording){
            player1 = [[AVAudioPlayer alloc] initWithContentsOfURL:recorder.url error:nil];
            [player1 setDelegate:self];
            [player1 play];
        }
    }

    - (IBAction)btnStopDidClicked:(UIButton *)sender {
        [recorder stop];
        AVAudioSession *audioSession = [AVAudioSession sharedInstance];
        [audioSession setActive:NO error:nil];
    }

    - (void) audioRecorderDidFinishRecording:(AVAudioRecorder *)avrecorder successfully:(BOOL)flag{
        [_recordTapped setTitle:@"play" forState:UIControlStateNormal];

        [_stopTapped setEnabled:NO];
        [_playTapped setEnabled:YES];

    } 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-06-19T09:40:43.520

根据上述答案，我进行了一些更改，并得到了正确的输出。

**第 1 步：**在“inf.plist”下添加麦克风使用权限 ==>

```
 <key>NSMicrophoneUsageDescription</key>
  <string>${PRODUCT_NAME} Microphone Usage</string> 
```

**第2步：**

1.  将录制的音频文件保存到本地文档目录

2.  播放/停止录音

3.  获取保存的音频文件的持续时间

这是源代码。请看一下并使用它。

**视图控制器.h**

```
#import <UIKit/UIKit.h>
#import <AVFoundation/AVFoundation.h>

@interface ViewController : UIViewController{
AVAudioPlayer *audioPlayer;
AVAudioRecorder *audioRecorder;
}

-(IBAction) startRecording;
-(IBAction) stopRecording;
-(IBAction) playRecording;
-(IBAction) stopPlaying;

@end 
```

**视图控制器.m**

```
#import "ViewController.h"
@interface ViewController () <AVAudioRecorderDelegate, AVAudioPlayerDelegate>

@end

@implementation ViewController

- (void)viewDidLoad {
[super viewDidLoad];
// Do any additional setup after loading the view, typically from a nib.
}

-(IBAction) startRecording{
// Setup audio session
AVAudioSession *audioSession = [AVAudioSession sharedInstance];
NSError *err = nil;
[audioSession setCategory :AVAudioSessionCategoryPlayAndRecord error:&err];
if(err)
{
    NSLog(@"audioSession: %@ %ld %@", [err domain], (long)[err code], [[err userInfo] description]);
    return;
}
[audioSession setActive:YES error:&err];
err = nil;
if(err)
{
    NSLog(@"audioSession: %@ %ld %@", [err domain], (long)[err code], [[err userInfo] description]);
    return;
}
AVAudioSessionRecordPermission permissionStatus = [audioSession recordPermission];
switch (permissionStatus) {
    case AVAudioSessionRecordPermissionUndetermined:{
        [[AVAudioSession sharedInstance] requestRecordPermission:^(BOOL granted) {
            // CALL YOUR METHOD HERE - as this assumes being called only once from user interacting with permission alert!
            if (granted) {
                // Microphone enabled code
                NSLog(@"Mic permission granted.  Call method for granted stuff.");
                [self startRecordingAudioSound];
            }
            else {
                // Microphone disabled code
                NSLog(@"Mic permission indeterminate. Call method for indeterminate stuff.");
                //        UIApplication.sharedApplication().openURL(NSURL(string: UIApplicationOpenSettingsURLString)!)
            }
        }];
        break;
    }
    case AVAudioSessionRecordPermissionDenied:
        // direct to settings...
        NSLog(@"Mic permission denied. Call method for denied stuff.");

        break;
    case AVAudioSessionRecordPermissionGranted:
        // mic access ok...
        NSLog(@"Mic permission granted.  Call method for granted stuff.");
        [self startRecordingAudioSound];
        break;
    default:
        // this should not happen.. maybe throw an exception.
        break;
}
}

#pragma mark - Audio Recording
- (BOOL)startRecordingAudioSound{
NSError *error = nil;
NSMutableDictionary *recorderSettings = [[NSMutableDictionary alloc] init];
[recorderSettings setValue :[NSNumber numberWithInt:kAudioFormatLinearPCM] forKey:AVFormatIDKey];
[recorderSettings setValue:[NSNumber numberWithFloat:44100.0] forKey:AVSampleRateKey];
[recorderSettings setValue:[NSNumber numberWithInt: 2] forKey:AVNumberOfChannelsKey];
[recorderSettings setValue :[NSNumber numberWithInt:16] forKey:AVLinearPCMBitDepthKey];
[recorderSettings setValue :[NSNumber numberWithBool:NO] forKey:AVLinearPCMIsBigEndianKey];
[recorderSettings setValue :[NSNumber numberWithBool:NO] forKey:AVLinearPCMIsFloatKey];

// Create a new audio file
NSArray *searchPaths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
NSString *documentPath_ = [searchPaths objectAtIndex: 0];
NSString *pathToSave = [documentPath_ stringByAppendingPathComponent:[self dateString]];
NSLog(@"the path is %@",pathToSave);

// File URL
NSURL *url = [NSURL fileURLWithPath:pathToSave];//FILEPATH];

//Save recording path to preferences
NSUserDefaults *prefs = [NSUserDefaults standardUserDefaults];
[prefs setURL:url forKey:@"Test1"];
[prefs synchronize];

audioRecorder = [[AVAudioRecorder alloc] initWithURL:url settings:recorderSettings error:&error];
if (!audioRecorder)
{
    NSLog(@"Error establishing recorder: %@", error.localizedFailureReason);
    return NO;
}

// Initialize degate, metering, etc.
audioRecorder.delegate = self;
audioRecorder.meteringEnabled = YES;
//self.title = @"0:00";

if (![audioRecorder prepareToRecord])
{
    NSLog(@"Error: Prepare to record failed");
    //[self say:@"Error while preparing recording"];
    return NO;
}

if (![audioRecorder record])
{
    NSLog(@"Error: Record failed");
    //  [self say:@"Error while attempting to record audio"];
    return NO;
}
NSLog(@"Recroding Started");
return YES;
}

#pragma mark - AVAudioRecorderDelegate
- (void) audioRecorderDidFinishRecording:(AVAudioRecorder *)avrecorder successfully:(BOOL)flag{
NSLog (@"audioRecorderDidFinishRecording:successfully:");
}

#pragma mark - AVAudioPlayerDelegate
- (void) audioPlayerDidFinishPlaying:(AVAudioPlayer *)player successfully:(BOOL)flag{
NSLog (@"audioPlayerDidFinishPlaying:successfully:");
}

- (NSString *) dateString {
// return a formatted string for a file name
NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
formatter.dateFormat = @"ddMMMYY_hhmmssa";
return [[formatter stringFromDate:[NSDate date]]stringByAppendingString:@".aif"];
}

-(IBAction) stopRecording{
NSLog(@"stopRecording");
[audioRecorder stop];
NSLog(@"stopped");
}

-(IBAction) playRecording{
//Load recording path from preferences
NSUserDefaults *prefs = [NSUserDefaults standardUserDefaults];
NSURL *temporaryRecFile = [prefs URLForKey:@"Test1"];

//Get Duration of Audio File
AVURLAsset* audioAsset = [AVURLAsset URLAssetWithURL:temporaryRecFile options:nil];
CMTime audioDuration = audioAsset.duration;
float audioDurationSeconds = CMTimeGetSeconds(audioDuration);
NSLog(@"Duration Of Audio: %f", audioDurationSeconds);

audioPlayer = [[AVAudioPlayer alloc] initWithContentsOfURL:temporaryRecFile error:nil];
audioPlayer.delegate = self;
[audioPlayer setNumberOfLoops:0];
audioPlayer.volume = 1;
[audioPlayer prepareToPlay];
[audioPlayer play];
NSLog(@"playing");
}

-(IBAction) stopPlaying{
NSLog(@"stopPlaying");
[audioPlayer stop];
NSLog(@"stopped");
 }

 @end 
```

# iphone - 你需要为每个开发者支付 iPhone SDK 的费用吗？

> ID：1010344
> 
> 赞同：1
> 
> 时间：2009-06-18T01:25:02.317
> 
> 标签：iphone

有没有链接可以让我获得 3.0 SDK 而无需第二次付费？我要和我公司的另一个人一起做一个项目。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T01:29:25.320

您可以通过登录开发者门户下载 3.0 SDK。

此外，您可以使用开发人员门户将其他开发人员添加到您公司的团队中。

添加其他团队成员时不收取任何费用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T01:28:15.073

不，您不必为每个开发者付费，他们可以在创建免费开发者帐户时自行下载 sdk。您还可以将他们的设备 ID 添加到您的帐户，以便他们可以在他们的 iphone 或 ipod touch 设备上测试应用程序

# python - 提取页面元数据会很好地利用多重继承吗？

> ID：1010349
> 
> 赞同：1
> 
> 时间：2009-06-18T01:26:58.960
> 
> 标签：python, django, architecture, multiple-inheritance, mixins

我想知道我是否有几个模型都包含“meta_keywords”或“slug”之类的字段，这些字段与将显示模型实例的网页有关，是否建议将这些页面元数据元素分开进入他们自己的类，比如PageMeta，并让我的其他模型通过多重继承继承这些模型？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T02:01:10.403

对轻度指定问题的一般建议：

Python 中非平凡的多重继承需要高级技术来处理元类/元类型冲突。从 ActiveState 档案中查看[这个配方](http://code.activestate.com/recipes/204197/)，看看它是否看起来像你喜欢的那种东西：

## 从链接食谱中提取：

> 发生元类型冲突的最简单情况如下。考虑具有元类的 A 类`M_A` 和具有独立元类的 B 类`M_B`；假设我们从 A 和 B 派生出 C。问题是：C 的元类是什么？是`M_A`还是`M_B` ？
> 
> 正确的答案（请参阅“使元类发挥作用”一书进行深思熟虑的讨论）是`M_C`，其中 `M_C`是继承自 `M_A`和的元类`M_B`。
> 
> 但是，Python 并不是那么神奇，它不会自动创建`M_C`. 相反，它会引发 TypeError，警告程序员可能出现的混淆。

因此，我建议将您在 Python 中使用多重继承限制在以下情况：

1.  您必须这样做，因为您的问题域要求您组合两个单独维护的单继承库。
2.  你已经非常流畅地使用元类型和元类，你可以像编写打印语句一样轻松自信地编写[配方 204197](http://code.activestate.com/recipes/204197/)或其等效项。

编辑：

[这是Python 简介中](http://www.network-theory.co.uk/docs/pytut/MultipleInheritance.html)的 Guido van Rossum ：

> 很明显，不加选择地使用多重继承是维护的噩梦，因为 Python 依赖于约定以避免意外的名称冲突。

在这里，他再次出现在[PEP 253](http://www.python.org/dev/peps/pep-0253/)中，它描述了融入 Python 的想法，但没有描述实现：

> 元类型决定了类型的各种*策略* ，例如调用类型时会发生什么，动态类型如何（类型的**dict**在创建后是否可以修改），方法解析顺序是什么，如何查找实例属性，以及很快。
> 
> 我会争辩说，当您想充分利用多重继承时，从左到右的深度优先并不是最好的解决方案。
> 
> 我会争辩说，对于多重继承，子类型的元类型必须是所有基本类型的元类型的后代。

这并不*意味着*您不应该使用多重继承；我只是警告你，这样你就不会惊讶于有一天你会发现自己拍了拍你的额头并惊呼“D'oh！我的一个子类型的元类型不是其所有基本类型的元类型的后代！不要你不讨厌这种情况发生吗？”

# sql - 使用 sql Server 2008 Express 如何使用“@”插入电子邮件添加。在记录中

> ID：1010354
> 
> 赞同：0
> 
> 时间：2009-06-18T01:27:26.510
> 
> 标签：sql

尝试在记录中插入电子邮件地址时出现错误。我认为它们与@符号有关。

我需要对 @ 符号做些什么特别的事情吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T01:28:44.730

将字符串存储到的变量前面可以有一个 @ 以“逐字”或“逐字”

如

```
String myEmail;

myEmail = @"test@email.com";

... 
```

尽管我必须承认，在处理文件系统路径时我只需要文字，而不是电子邮件地址。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T01:28:35.993

如果您使用字符串连接来执行此操作，那么您将收到错误...＆符号用于指示参数。您可以发布更多信息（即示例代码、错误、编程语言）吗？

# c# - Linq +无效的表达式术语'>'

> ID：1010355
> 
> 赞同：5
> 
> 时间：2009-06-18T01:27:44.763
> 
> 标签：c#, .net, linq

任何人都可以在这里帮助我，以下在我的 xp 上运行良好，但在我的 vista 机器上运行良好。我正在查询通用字典。

两台计算机都有 .NET 3.5 + SP1、3.0、2.0 等，并且有针对 3.5 框架的 Web 项目。

```
using System.Linq;
string val = "Test";
var d = DictionaryOfStuff().Where(n => n.Key.ToLower().Contains(val.ToLower())); 
```

给我错误：CS1525: Invalid expression term '>'

我可以在 vista 上的不同项目中运行它，我将 IIS 配置为使用 .NET 2.0，而 VS 中的项目针对 3.5 我什至尝试将它添加到 web.config，它编译得很好，没有任何 lambda/linq

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-18T01:56:42.533

嗯，这就是答案..

我将项目更改为 .NET 3.0，尝试编译得到各种错误，将其改回 3.5 并且编译正常。

我必须从某事那里得到一个旧的参考。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T01:29:52.917

根据错误消息，我不得不说您的 Vista 机器上存在配置问题，并且 Web 项目使用的是 2.0 编译器而不是 3.5 编译器。这是我能想到您会收到此消息的唯一原因。

确保

*   IIS 配置正确
*   Web 设置配置正确。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T01:30:38.530

`val`在这种情况下，“”是什么？您从未在示例中声明它。你说的是“ `n.Value`”吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-28T18:02:07.503

schmoopy 你摇滚 :) 和 Visual Studio :P 从早上开始就陷入同一个问题 :P

[http://www.hyperlinksolutions.net](http://www.hyperlinksolutions.net) http://barchitect.blogspot.com

# java - 如何在不提示输入用户名/密码的情况下使用 Windows 身份验证调用 Active Directory？

> ID：1010356
> 
> 赞同：2
> 
> 时间：2009-06-18T01:27:47.477
> 
> 标签：java, command-line, active-directory, windows-authentication

`InitialLdapContext`您可以在以下帖子中看到使用 Java 中的类访问 LDAP 的示例：

[http://forums.sun.com/thread.jspa?threadID=603815](http://forums.sun.com/thread.jspa?threadID=603815)

[http://forums.devshed.com/ldap-programming-76/active-directory-services-using-java-api-89586.html](http://forums.devshed.com/ldap-programming-76/active-directory-services-using-java-api-89586.html)

这需要输入登录名和密码（即使运行 java 进程的服务帐户或用户已经登录才能运行）。

由于用户或服务帐户已经登录 - 他们已经可以在没有用户名或密码的情况下运行如下活动目录命令：

```
dsquery user -samid "login" |dsget user -samid -email -display 
```

那么，如果 Windows 已经可以使用这个查询，为什么 Java 需要登录密码呢？Kosuke 暗示在这篇博文的结论中不需要它：

[https://community.oracle.com/blogs/kohsuke/2008/06/12/more-active-directory-integration-java](https://community.oracle.com/blogs/kohsuke/2008/06/12/more-active-directory-integration-java)

我们如何在 Java 中调用 Active Directory，而无需：

*   使用登录名或密码（在已登录的帐户下运行）？
*   在命令行上执行命令？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T02:43:23.300

这可能是因为

*   您正在使用 LDAP 库/上下文与 Active Directory 进行通信，并且这些库需要支持其他类型的 LDAP（AD 甚至算作 LDAP 吗？）
*   这些实现的提供者是需要它的提供者。LDAP 通信是通过提供实现的提供者完成的，而不是由实际的 Java 运行时完成的。
*   当前用户的密码不是（我希望）由 Windows 实际提供给 Java 的。

当 Windows 在您运行需要它的应用程序时针对 AD 对您进行身份验证时，除了您的实际密码之外，它还会提供一些其他凭据集。这些凭证在 Java 中不可用，或者至少没有 LDAP 通信器的提供者提供检索它的方法。

[在他关于该主题的另一篇博文中，](https://community.oracle.com/blogs/kohsuke/2008/01/10/active-directory-authentication-hudson) Kohsuke 进一步扩展了为什么在涉及 Active Directory 时事物在 Java 领域是这样的。

# c# - 测试远程消息队列是否存在（使用 C#）

> ID：1010366
> 
> 赞同：7
> 
> 时间：2009-06-18T01:29:53.213
> 
> 标签：c#, msmq

如何判断远程消息队列是否[存在](http://msdn.microsoft.com/en-us/library/system.messaging.messagequeue.exists.aspx%0A)？该文档指出“Exists”方法不适用于远程机器。

以下内容无效（我知道队列路径是准确的，因为我能够将消息发送到队列）：

```
if (!MessageQueue.Exists(@"FormatName:Direct=TCP:192.168.2.58\Private$\MyQueue"))
  throw new InvalidOperationException("队列不存在");

```

问题是向后面没有侦听队列的网络地址发送消息不会导致异常。为无效队列地址抛出异常对我们的应用程序至关重要。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T01:36:36.990

有一篇关于这个的文章：

> Frank 的替代方法是利用 MSMQ 提供的其他功能，例如带有管理队列的否定确认消息。
> 
> 应该发生的是：
> 
> *   消息将成功传递到目标队列
> *   否定确认 (NACK) 将返回到具有“目标队列不存在”类的管理队列。(MQMSG_CLASS_NACK_BAD_DST_Q) 或者，您可以使用负源日志，并且在未能交付时，应该在相应的“死信消息”系统队列中看到相同类别的 NACK。
> 
> 总之，不要检查队列是否存在，而是在发现队列不存在时处理未传递的消息。

[http://blogs.msdn.com/johnbreakwell/archive/2008/07/31/checking-if-msmq-queues-exist-is-hard-work-so-should-you-bother.aspx](http://blogs.msdn.com/johnbreakwell/archive/2008/07/31/checking-if-msmq-queues-exist-is-hard-work-so-should-you-bother.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T01:36:31.140

如果遥控器 Q 被第三方控制，而您没有任何控制权怎么办？

您最好进行某种超时检查，而不是依赖远程信息。

# c# - 如何启动低优先级的进程？C＃

> ID：1010370
> 
> 赞同：40
> 
> 时间：2009-06-18T01:34:37.587
> 
> 标签：c#, process, shellexecute

我想执行一个命令行工具来处理数据。它不需要阻塞。我希望它是低优先级的。所以我写了下面

```
 Process app = new Process();
 app.StartInfo.FileName = @"bin\convert.exe";
 app.StartInfo.Arguments = TheArgs;
 app.PriorityClass = ProcessPriorityClass.BelowNormal;
 app.Start(); 
```

但是，我收到一条`System.InvalidOperationException`消息“没有进程与此对象关联”。为什么？如何以低优先级正确启动此应用程序？

没有这条线`app.PriorityClass = ProcessPriorityClass.BelowNormal;`，应用程序运行良好。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-06-18T01:37:37.737

尝试在启动该过程后设置 PriorityClass。任务管理器以这种方式工作，允许您为已经运行的进程设置优先级。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2015-10-15T21:06:59.910

您可以通过做一些小技巧来创建优先级较低的进程。您降低父进程优先级，创建新进程，然后恢复到原始进程优先级：

```
var parent   = Process.GetCurrentProcess();
var original = parent.PriorityClass;

parent.PriorityClass = ProcessPriorityClass.Idle;
var child            = Process.Start("cmd.exe");
parent.PriorityClass = original; 
```

`child`将`Idle`在开始时拥有进程优先级。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-09-29T15:46:37.673

如果您准备 P/Invoke to `CreateProcess`，您可以传入`CREATE_SUSPENDED`标志。然后，您可以在恢复流程之前调整流程优先级。

# windows - MSTAPI 请求 ID 在哪里初始化？

> ID：1010371
> 
> 赞同：0
> 
> 时间：2009-06-18T01:35:17.257
> 
> 标签：windows, tapi

我继承了一些实现 MSTAPI 接口并与之对话的代码。我很好奇请求 ID 的初始化位置（或者是否初始化）。例如，请求 ID 是指`idRequest`LINE_REPLY [Message](http://msdn.microsoft.com/en-us/library/ms736570(VS.85).aspx)的参数。

我很好奇的原因是，当我拥有 TSP 和客户端显示请求 ID 时，我认为以下是一个典型的序列，并且双方都同意这些数字：

```
66304
66303
66286
66269
66252
66235
... 
```

第一个值转换为`0x00010300`（这对我没有任何意义，而是一个整数），然后请求 ID从那里*减少。*（除非请求 ID 在内部被视为带符号的 2 字节整数，我认为这是可能的。）

我怀疑一侧或另一侧应该正在初始化某些东西，而不是或正在将其初始化为不合适的东西。

有谁知道请求 ID 应该如何工作？它是由 MSTAPI 内部生成并提供给 TSP 和客户端的不透明数字吗？任何人都可以指出解释这一点的参考资料吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-08T08:32:51.503

请求 ID 由 TAPI 在内部为所有异步操作生成。当您的程序调用 lineMakeCall 等异步 TAPI 函数时，TAPI 会为此操作返回一个请求 ID。在 TSPI_lineMakeCall 中向 TSP 提供相同的请求 ID。当 TSP 完成 MakeCall 操作时，TSP 使用此请求 ID 调用 CompletionProc 回调，告诉 TAPI 该操作已完成。之后，TAPI 使用相同的请求 ID 向您的应用程序发送 LINE_REPLY 消息，因此您知道您的 lineMakeCall 操作已完成。

# python - Python 因式分解

> ID：1010381
> 
> 赞同：12
> 
> 时间：2009-06-18T01:39:13.273
> 
> 标签：python, algorithm

我只想知道列出一个数字的所有整数因子的最佳方法，给定一个包含其素因子及其指数的字典。
例如，如果我们有 {2:3, 3:2, 5:1} (2^3 * 3^2 * 5 = 360)
那么我可以这样写：

```
for i in range(4):
  for j in range(3):
    for k in range(1):
      print 2**i * 3**j * 5**k 
```

但在这里我有 3 个可怕的 for 循环。给定任何分解作为字典对象参数，是否可以将其抽象为函数？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-06-18T08:53:59.280

我已经[写过关于这个的博客](http://numericalrecipes.wordpress.com/tag/divisors/)，最快的纯 python（没有 itertools）来自 Tim Peters 到 python 列表的帖子，并使用嵌套递归生成器：

```
def divisors(factors) :
    """
    Generates all divisors, unordered, from the prime factorization.
    """
    ps = sorted(set(factors))
    omega = len(ps)

    def rec_gen(n = 0) :
        if n == omega :
            yield 1
        else :
            pows = [1]
            for j in xrange(factors.count(ps[n])) :
                pows += [pows[-1] * ps[n]]
            for q in rec_gen(n + 1) :
                for p in pows :
                    yield p * q

    for p in rec_gen() :
        yield p 
```

请注意它的编写方式，它需要一个主要因素列表，而不是字典，即`[2, 2, 2, 3, 3, 5]`而不是`{2 : 3, 3 : 2, 5 : 1}`.

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-18T02:17:59.123

[`itertools.product`](http://docs.python.org/library/itertools.html#itertools.product)从 Python 2.6 开始使用：

```
#!/usr/bin/env python
import itertools, operator

def all_factors(prime_dict):
    series = [[p**e for e in range(maxe+1)] for p, maxe in prime_dict.items()]
    for multipliers in itertools.product(*series):
        yield reduce(operator.mul, multipliers) 
```

例子：

```
print sorted(all_factors({2:3, 3:2, 5:1})) 
```

输出：

```
[1, 2, 3, 4, 5, 6, 8, 9, 10, 12, 15, 18, 20, 24, 30, 36, 40, 45, 60,
 72, 90, 120, 180, 360] 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-06-18T02:18:50.603

好吧，不仅你有 3 个循环，而且如果你有 3 个以上的因素，这种方法也行不通:)

一种可能的方式：

```
def genfactors(fdict):    
    factors = set([1])

    for factor, count in fdict.iteritems():
        for ignore in range(count):
            factors.update([n*factor for n in factors])
            # that line could also be:
            # factors.update(map(lambda e: e*factor, factors))

    return factors

factors = {2:3, 3:2, 5:1}

for factor in genfactors(factors):
    print factor 
```

此外，您可以避免在内部循环中重复一些工作：如果您的工作集是 (1,3)，并且想要应用于 2^3 因子，我们正在做：

*   `(1,3) U (1,3)*2 = (1,2,3,6)`
*   `(1,2,3,6) U (1,2,3,6)*2 = (1,2,3,4,6,12)`
*   `(1,2,3,4,6,12) U (1,2,3,4,6,12)*2 = (1,2,3,4,6,8,12,24)`

看看我们在第二组中有多少重复项？

但我们可以这样做：

*   `(1,3) + (1,3)*2 = (1,2,3,6)`
*   `(1,2,3,6) + ((1,3)*2)*2 = (1,2,3,4,6,12)`
*   `(1,2,3,4,6,12) + (((1,3)*2)*2)*2 = (1,2,3,4,6,8,12,24)`

没有集合，解决方案看起来更好：

```
def genfactors(fdict):
    factors = [1]

    for factor, count in fdict.iteritems():
        newfactors = factors
        for ignore in range(count):
            newfactors = map(lambda e: e*factor, newfactors)
            factors += newfactors

    return factors 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-18T02:18:11.307

是的。当你有一个需要 n 个嵌套 for 循环的算法时，你通常可以把它变成一个递归函数：

```
def print_factors(d, product=1):
    if len(d) == 0:      # Base case: we've dealt with all prime factors, so
        print product    # Just print the product
        return
    d2 = dict(d)         # Copy the dict because we don't want to modify it
    k,v = d2.popitem()   # Pick any k**v pair from it
    for i in range(v+1): # For all possible powers i of k from 0 to v (inclusive)
                         # Multiply the product by k**i and recurse.
        print_factors(d2, product*k**i)

d = {2:3, 3:2, 5:1}
print_factors(d) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T02:11:16.967

基本上，您在这里拥有的是一个集合，由目标数的每个因素组成。在您的示例中，该集合将是`{2 2 2 3 3 5}`. 该集合的每个严格子集都是您的数字的一个除数的因式分解，因此如果您可以生成该集合的所有子集，您可以将每个子集的元素相乘并获得所有整数除数。

从那里代码应该很明显：生成一个包含分解的列表，生成该列表的所有子集（使用生成器的奖励点；我认为标准库中有一个相关的函数）。然后乘以从那里去。无论如何都不是最佳效率，但看起来很漂亮。

# php - 删除刷新帮助 Jquery

> ID：1010382
> 
> 赞同：0
> 
> 时间：2009-06-18T01:42:34.013
> 
> 标签：php, javascript, jquery

我试图让 div 最近的活动仅在单击删除时刷新

<a href='#' onclick=\"javascript:remove_wall('$id')\">删除

但是当我每次点击链接时，它都会尝试刷新。当鼠标移到 tr 上时，会出现一个链接说 remove here 是它的代码。

```
$(function () {
    $("tr").hover(function () {
        var id = this.id.split('_').pop();
        $("#remove_" + id).show();
    }, function () {
        var id = this.id.split('_').pop();
        $("#remove_" + id).hide();
    });
}); 
```

这是单击链接时发生的情况。

```
function remove_wall(id) {
    var refresh = setInterval(function () {
        $("#recent_activity").load("activity.php?random=" + unique_requestid());
    }, 1);

    $("#contentArea").load("remove.php?wall_id=" + id + "");
}; 
```

php中的删除工作得很好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T02:13:08.163

问题是您正在使用 setInterval - 它每 x 毫秒重复一个函数，其中 x 是给定的间隔。

您真正需要使用的是 setTimeout - 它将启动一个计时器，然后在计时器倒计时后运行，并且只运行一次。

您的代码应如下所示：

```
function remove_wall(id) {  
    var refresh = setTimeout(function() {
        $("#recent_activity").load("activity.php?random=" +unique_requestid());
    }, 1);
    $("#contentArea").load("remove.php?wall_id="+id+"");
}; 
```

进一步阅读的链接：[带有 setTimeout 和 setInterval 的计时器](http://www.elated.com/articles/javascript-timers-with-settimeout-and-setinterval/)

# sql-server - SQL Server Raiserror 不会在 .NET 客户端中导致异常

> ID：1010383
> 
> 赞同：7
> 
> 时间：2009-06-18T01:42:33.967
> 
> 标签：sql-server

我在 SQL Server 2005 数据库上有一个存储过程，其中包含如下语句：

```
 IF @Condition = 0
    BEGIN
        RAISERROR('some error message',16,1)
        RETURN
    END 
```

它是从 C# 客户端调用的，如下所示：

```
 try
           {
                SomeVariable = SqlHelper.ExecuteScalar(GetConnectionString(), "MySP", new object[] { param1, param2});
            }
            catch (SqlException e)
            {
                Console.WriteLine(e.Message);
            } 
```

但是，也没有例外。SP 中的条件对于测试始终为真。为了验证这一点，我从 SQL Server Profiler 复制了调用并在查询窗口中执行它，并打印了 ErrorMessage，这意味着引发了错误。

不知道发生了什么。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T17:41:14.463

我浏览了 SQL Helper 类，发现 ExecuteScalar 吃掉了异常并返回 null。我切换到不执行此操作的 ExecuteDataSet。我希望不同的 Execute.. 方法的行为方式相同。另一种方法是使用 ExecuteScalar，当 SP 检测到错误时，它会执行 SELECT 一些可以在客户端处理的错误号。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T13:00:59.470

根据 SQL Books online 的严重性为 16“表示可以由用户更正的一般错误”。- 这样严重性就可以了。

我只有 SQL 2008 可以使用，但我已经测试了 RAISERROR('some error message',16,1) 并且在我的 c# 应用程序中发现了错误。您确定您的“SqlHelper”类中没有处理错误吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-05T10:02:18.497

来自在线书籍

指定 10 或更低的严重性以使用 RAISERROR 从 TRY 块返回消息*而不*调用 CATCH 块。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T12:16:01.463

这与严重程度有关吗？如果您将严重性提高到 19，它是否会通过您的代码引发异常？

# c# - 将数据集（.net）中的列加载到字符串 [] 中的最佳方法是什么？

> ID：1010385
> 
> 赞同：1
> 
> 时间：2009-06-18T01:42:52.780
> 
> 标签：c#, asp.net

ASP.NET/C# 3.0

我有一个具有以下签名的方法：

公共静态无效发送电子邮件（字符串 sFrom，字符串 sSubject，字符串 sBody，参数字符串 [] sAddresses）

我需要遍历一个数据集来检查 column2 的值。如果 column2 的值为 True，则 column1 中的字符串值应添加到 sAddresses 字符串 []。

我知道的唯一方法是在每次迭代时调整 string[] +1 的大小。这听起来不是很有效。雪莉有更好的方法。

谢谢！凯文

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T01:47:50.883

使用 a`List<string>`并在那里添加项目。完成后，调用 ToArray 以取回字符串数组。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T02:19:00.430

默认情况下，我跳转到 Linq。不过，它可能不是最好的：

```
string[] addresses = (from row in table.Rows
                      where ((bool)row[2])
                      select (string)row[1]).ToArray() 
```

# hibernate - Hibernate 属性 hibernate.jdbc.factory_class 的默认值是多少？

> ID：1010386
> 
> 赞同：1
> 
> 时间：2009-06-18T01:44:29.923
> 
> 标签：hibernate, default-value

我想为 Hibernate 提供一个自定义的 Batcher 以供使用（出于这个原因：[hibernate insert batch with partitioned postgresql](https://stackoverflow.com/questions/83093/hibernate-insert-batch-with-postgresql)），但我想创建它已经使用的任何内容（BatchingBatcher 或 NonBatchingBatcher）的修改。hibernate.jdbc.factory_class 的默认值是多少，或者我如何确定当前使用的是哪个 Batcher Hibernate？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-27T19:35:40.430

[请参阅此文件](http://www.docjar.com/html/api/org/hibernate/cfg/SettingsFactory.java.html)中的 createBatcherFactory 方法。

默认情况下，如果批量大小为 0，则使用 NonBatchingBatcher；否则使用 BatchingBatcher。

默认批处理大小为正，因此如果未设置批处理大小，将使用 BatchingBatcher。

# wpf - WPF“十六进制网格”组件

> ID：1010391
> 
> 赞同：3
> 
> 时间：2009-06-18T01:47:13.990
> 
> 标签：wpf, custom-controls, hexagonal-tiles

进入 WPF 自定义控件的世界，想知道设计 HexGrid 控件的最佳方法是什么？想想你最喜欢的桌面战争游戏；或者，同样有可能，您最喜欢的电子游戏从令人自豪的桌面战争游戏历史中窃取设计。

底层模型公开了一个重要的方法，作为 Map 类的一部分：

```
Hex GetHex(int x, int y, int z)*; 
```

十六进制包含所有相关数据（目前，将 1:1 映射到背景颜色的地形枚举；从小开始......）。

可能相关的约束：
地图的大小不变，十六进制数据在非常可预测的时间发生变化（总是直接响应用户操作）。

理想情况下，组件将扩展以干净地填充其容器，并且可以直接在 XAML 中声明。

我正在寻找的是我需要做些什么来构建它的粗略轮廓，而不是一个现成的组件。

*虽然我对这个寻址方案很聪明，但显然我[迟到了](http://sc.tri-bit.com/Hex_Grids#Flattened_3D)。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2017-07-21T21:12:16.320

在我看来，在 WPF 中，将 HexGrid 设计为 a`Panel`而不是 UserControl 更为合理。面板没有视觉表示，只需要正确排列子元素（在 HexGrid 的情况下 - 以蜂窝模式）。这些子元素又应该具有六角形。

概念证明：我的 HexGrid 项目（太大，无法在此处发布）

[代码项目文章](https://www.codeproject.com/Articles/1195543/HexGrid)

[GitHub存储库](https://github.com/AlexanderSharykin/HexGrid)

**HexList** : 选择器 ItemsControl 在 HexGrid 面板上显示 HexItem 容器中的项目

**HexGrid** : 以蜂窝模式排列子元素的面板

**HexItem** : 六边形 ContentControl

声明性用法示例：

```
<hx:HexList Name="HexColors" Orientation="Vertical"
            Grid.Row="1"
            Padding="10"
            SelectedIndex="0"
            Background="{Binding Path=SelectedItem.Background, RelativeSource={RelativeSource Self}}"
            RowCount="5" ColumnCount="5">
    <hx:HexItem Grid.Row="0" Grid.Column="1" Background="#006699"/>
    <hx:HexItem Grid.Row="0" Grid.Column="2" Background="#0033CC"/>
    <hx:HexItem Grid.Row="0" Grid.Column="3" Background="#3333FF"/>
    <!--...-->
    <hx:HexItem Grid.Row="4" Grid.Column="1" Background="#CC9900"/>
    <hx:HexItem Grid.Row="4" Grid.Column="2" Background="#FF3300"/>
    <hx:HexItem Grid.Row="4" Grid.Column="3" Background="#CC0000"/>
</hx:HexList> 
```

[![十六进制颜色选择器](../Images/a51e1317fbe2d45d4c103d6f57343144.png)](https://i.stack.imgur.com/C4U1K.png)

*我知道这个问题是老问题，但请分享我的解决方案以防万一*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-12T01:21:45.403

编辑：这是一个链接到皮特的项目页面，其中有一个十六进制网格示例。 [http://blois.us/Projects.html](http://blois.us/Projects.html) 有一个寻路示例显示了一个名为寻路的项目，它有一个十六进制网格，并且可能使用与扫雷相同的基本代码。我还没看过。它是 Silverlight 3，因此可能需要升级。扫雷非常优雅。

拉尔夫

原文：有一个由 peter blois 制作的 silverlight 2 的六边形扫雷艇样本。

它包括源代码。他有一个非常优雅的方法，通过覆盖网格上的measureoverride和arrangeoverride。鼠标悬停等工作正常。代码非常少。

我在网上找不到这个项目了，尽管谷歌通过搜索六角扫雷机 silverlight 源代码 blois 找到了一个过时的链接

Peter Blois 在以下地址有一个当前博客，因此您可以尝试在此处与他联系... [http://blois.us/Projects.html](http://blois.us/Projects.html)

祝你好运，告诉我情况如何，我会做类似的事情。

# c# - 为 Web 服务创建 Java 存根的库

> ID：1010392
> 
> 赞同：2
> 
> 时间：2009-06-18T01:47:23.833
> 
> 标签：c#, java, web-services, code-generation, stub

我想知道是否有人可以推荐一个好的库来生成 java webservices 存根作为客户端。

目前我正在使用一个产品，它嵌入了一个只需要 WSDL 的生成器，然后创建所需的类和方法。

我的问题是它会引发警告，并且不会为我尝试使用的某些 Web 服务创建任何方法。

真正的问题是它没有解释问题是什么（所以我可以和 web 服务的所有者一起修改它），也不让我修改输出，这样我就可以自己解决问题。

然而，网络服务的所有者（因为这发生在几个不同的 ws 上）说他们的 ws 运行良好，实际上如果我使用[soapUI](http://www.soapui.org/)，它们实际上可以工作！！！

我快速浏览了soapUI它自己使用的库，我看起来很有希望。

**我知道有[Axis](http://ws.apache.org/axis/) 应该做这项工作，但我担心的是我失败的生成器已经在使用那个库（这让我觉得它会再次失败）**

最近我不知道这两个库是生成java源存根还是只有类似的方法

```
Object [] args = ...;
service.inkvoke("updateCustomer", args ); 
```

当我想要的是这样的：

```
CustomerWs cws = ....
cws.updateCustomer(custId, custName, custAddress /*etc*/ ); 
```

那么，任何人都可以推荐一个**好的**ws 存根生成器吗？

[我即将自己手动编码，但肯定需要几天才能被接受]

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T02:50:28.213

当您提到“Axis”时要非常小心：[Apache Axis 1](http://ws.apache.org/axis/)在 2006 年初被放弃，因为线程安全错误导致死锁和 CPU 旋转（我们都经历过这两种情况）。你会深深后悔使用它。 [Apache Axis 2](http://ws.apache.org/axis2/)完全重写，可能值得一看。但我建议您先看看[Apache CXF](http://cxf.apache.org/)和[Glassfish Metro](https://metro.dev.java.net/)。

[更新：这里是关于死锁](http://issues.apache.org/jira/browse/AXIS-2792)和[100% CPU 自旋](http://issues.apache.org/jira/browse/AXIS-2647)的错误报告。这是 Cyrille Le Clerc三年前[提出的补丁，从未承诺过。](http://issues.apache.org/jira/browse/AXIS-2498)

我们通过直接用 Java 重新编码我们的客户端来消除我们的死锁和旋转。然后 Axis 服务器拒绝与我们交谈，发回 HTTP 500 错误。我们需要谎称我们是 Axis 客户才能得到适当的回应。SOAP 互操作性不是 Axis 1 团队的优先事项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T02:03:14.207

你目前在用什么？我使用 Axis Wsdl2Java 作为 Ant 任务。它生成您想要的存根类型。效果很好，尽管在 Eclipse 中设置运行构建的类路径有点麻烦（我需要跟踪和包含一些 jar）。在我的 ant 构建文件中，它看起来像这样：

```
<taskdef name="axis-wsdl2java" classname="org.apache.axis.tools.ant.wsdl.Wsdl2javaAntTask" />
<target name="foo">
<axis-wsdl2java
              output="${build.dir}"
              testcase="false"
              verbose="true"
              typemappingversion="1.2"
              url="http://ws.domain.com/url/of/WebService?wsdl" />
<!-- Compile, etc... -->
</target> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T04:23:34.440

我喜欢 Apache CXF——它通过一个插件很好地与 Maven 集成，并且可以正常工作。我用它来生成客户端存根代码已经有一段时间了，在我工作的最后一家公司，他们也将它用于 WS 的服务器部分。

在我使用 CXF + Maven + Subversion 处理的最后一个项目中，我们没有在 Subversion 中包含生成的类，只有 WSDL 文件的副本——存根类是在 Maven 的“生成”目标中生成的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T01:53:54.273

Apache Axis 2 是要走的路……尽管您可能需要尝试一下才能正确使用它。这可能是最常见的方法。也许您使用的工具是基于 Axis 1 的？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T14:40:39.720

我肯定会建议使用基于标准 API 的东西。那将意味着 JAX-WS API。Apache CXF 和 Metro 是两个主要的 JAX-WS 实现，尽管 JBoss 也有一个实现。Axis2 有一个未经认证的实现，但不支持代码生成。

使用基于标准的 API 的最佳部分是，如果您在产品上遇到问题，您可以尝试另一个。在我看到的许多情况下，其他产品也不起作用，但会吐出不同的错误消息或类似的信息，帮助诊断它确实是我们自己的代码或 wsdl 中的问题。

此外，JAX-WS 直接内置于 Java6 中。如果您打算在 Java6 上运行，则可以使用它而不必处理额外的 jar 等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T01:54:51.417

[作为 Metro ( http://metro.dev.java.net](http://metro.dev.java.net) )一部分的最新 JAX-WS是一个非常好的抽象层。需要一点调整，但对我来说，它比其他一些选项更直观。

# mysql - MySQL：@variable 与变量。有什么不同？（第2部分）

> ID：1010397
> 
> 赞同：1
> 
> 时间：2009-06-18T01:51:18.037
> 
> 标签：mysql, variables, session-scope

好的，基于[我问的最后一个问题](https://stackoverflow.com/questions/1009954/mysql-variable-vs-variable-whats-the-difference)，Mysql 如何处理以下代码中的 where 语句：

```
DELIMITER ;//
DROP PROCEDURE IF EXISTS `test`;//
CREATE PROCEDURE `test`
(
  id INT
)
BEGIN
  SELECT *
    FROM some_table
   WHERE id = id;
END;// 
```

MySQL 在这种情况下会做什么？是否将 where 子句视为

```
some_table.id = id 
```

还是像对待它一样对待它

```
some_table.id = some_table.id 
```

现在我正在做类似的事情

```
WHERE id = @id 
```

因为我不知道 MySQL 中有会话变量并且它没有抱怨，我认为这是一种明确的方式来表示“此列等于此变量的位置”。

有些人可能会说“duh .. 当然它把它当作 column = variable”，但我可以很容易地说 where “variable = column”。那么它是如何处理这个问题的呢？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-18T06:13:20.737

MySQL 的变量命名模式在第一次查看时有点奇怪。通常 MySQL 区分三种类型的变量：

*   系统变量（[全局](http://dev.mysql.com/doc/refman/5.0/en/server-system-variables.html)或[会话](http://dev.mysql.com/doc/refman/5.0/en/server-session-variables.html)范围）：`@@varname`
*   [用户定义](http://dev.mysql.com/doc/refman/5.0/en/user-variables.html)的变量（它们是会话范围的）：`@varname`
*   [存储程序中的局部](http://dev.mysql.com/doc/refman/5.0/en/variables-in-stored-programs.html)变量：`varname`

所以命名冲突，比如你上面提到的那些，只出现在存储程序中。因此，您首先应该尝试通过分配明确的参数名称来避免这些命名冲突，例如通过在参数前面加上`p`诸如`pId`. 如果 MySQL 遇到歧义**，它会将引用解释为变量的名称**（[请参见此处](http://dev.mysql.com/doc/refman/5.0/en/local-variable-scope.html)）：

> [...] 局部变量名称不应与列名称相同。如果一条 SQL 语句，例如`SELECT ... INTO` 语句，包含对列的引用和同名的已声明局部变量，则**MySQL 当前将该引用解释为变量的名称。**[...]

*当前*的措辞以某种方式给人一种印象，即这种行为可能会在未来的版本中发生变化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T02:00:38.377

我很确定 @ 表示它是过程中的变量，而不是引用表列。只有一个名为 的表列`id`，因此在这种情况下它是明确的。如果您正在执行连接，则需要为其添加前缀：

```
select *
from table1, table2
where table1.id = @id
and table2.some_field = table1.id 
```

不管它在哪里，变量总是需要@前缀，就像在这个查询中一样：

```
select id, @id
from table1 
```

第一个 id 是明确的表列 table1.id，@id 引用存储过程变量。

# php - 如何修复 PHP 中的内存泄漏

> ID：1010402
> 
> 赞同：17
> 
> 时间：2009-06-18T01:53:30.920
> 
> 标签：php, memory-leaks, reference-counting

我的 PHP 应用程序有一个可以导入记录的导入脚本。

目前，它正在从 CSV 文件导入。它正在读取 CSV 文件的每一行，使用 fgetcsv 一次一行，并且对于每一行，它对该记录*进行大量*处理，包括数据库查询，然后转到下一行。它不应该需要不断积累更多的内存。

在导入大约 2500 条记录后，PHP 死了，说它已超出其内存限制（132 MB 左右）。

CSV 文件本身只有几兆 - 发生的其他处理会进行大量字符串比较、差异等。我有大量代码在上面操作，很难想出一个“最小的复制”样本'。

有哪些好方法可以找到并解决此类问题？

***发现问题原因***

*我有一个调试类，它在运行时记录我所有的数据库查询。因此，那些大约 30KB 长的 SQL 字符串保留在内存中。我意识到这不适合设计为长时间运行的脚本。*

*可能还有其他内存泄漏来源，但我很确定这是我的问题的原因。*

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T03:12:20.823

如果您确实怀疑脚本中只有一两个内存泄漏导致它崩溃，那么您应该采取以下步骤：

*   改成`memory_limit`小的，比如 500KB
*   注释掉除一个应用于每一行的处理步骤之外的所有处理步骤。
*   对整个 CSV 文件运行有限的处理，看看它是否可以完成。
*   逐渐添加更多步骤并观察内存使用量是否达到峰值。

例子：

```
ini_set('memory_limit', 1024 * 500);
$fp = fopen("test.csv", 'r');
while($row = fgetcsv($fp)) {
    validate_row($row);         // step 1: validate
    // add these back in one by one and keep an eye on memory usage
    //calculate_fizz($row);     // step 2: fizz
    //calculate_buzz($row);     // step 3: buzz
    //triangulate($row);        // step 4: triangulate
}
echo "Memory used: ", memory_get_peak_usage(), "\n"; 
```

最坏的情况是，您的*所有*处理步骤都相当低效，您需要优化所有这些步骤。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-18T02:02:33.210

查看代码会有所帮助，但如果您想自己调试，请查看[Xdebug](http://www.xdebug.org/)，它将有助于分析您的应用程序。

当然，根据您的操作，它可能会累积一些内存，尽管 132MB 对于 2500 条记录来说似乎已经很高了。当然，如果需要，您可以在 php.ini中[调整内存限制。](http://www.php.net/manual/en/ini.core.php#ini.memory-limit)

您正在阅读的 CSV 文件有多大？您正在对它进行哪些对象和类型的处理？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T02:01:38.547

这取决于您在完成变量后如何清除它们。

看起来您已完成记录，但您仍在某处存储信息。如果有疑问，请使用[unset()](http://us3.php.net/manual/en/function.unset.php)清除变量。

如果这没有帮助，请提供一个最小的重现代码示例，以查看所有内存在哪里。

顺便说一句，生成将重现问题的最小代码示例是一种很好的调试技术，因为它迫使您再次仔细检查代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-18T06:44:10.250

您可以尝试本地安装 php5.3 并调用 http://www.php.net/manual/en/function.gc-collect-cycles.php。

> `gc_collect_cycles`— 强制收集任何现有的垃圾循环

如果情况有所改善，您至少验证了（一个）问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T02:06:16.183

你是如何阅读文件的？如果您使用 fread/filegetcontents 或其他此类函数，那么您将在内存中消耗整个文件大小（或使用 fread 加载多少），因为在调用时加载整个文件。但是，如果您使用[fgetcsv](http://php.net/fgetcsv) if 一次只能读取一行，具体取决于行的长度，这对您的记忆来说会非常容易。

还要确保在每个循环中重用尽可能多的变量。检查其中没有包含大量数据的数组。

作为最后一点，还要确保您在循环之前打开文件，然后在之后关闭它：

```
$fh = fopen(...);
while(true)
{
//...
}
fclose($fh); 
```

你真的不想这样做：

```
while(true)
{
$fh = fopen(...);
//...
fclose($fh);
} 
```

就像其他人所说的那样，如果不看一些代码就很难说。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T01:58:54.247

没有看到任何代码很难说出原因。但是，一个典型的问题是递归引用，即。对象 A 指向对象 B，反之亦然，这可能会导致 GC 搞砸。

我不知道您当前如何处理该文件，但您可以尝试一次只读取一行文件。如果您一次读取整个文件，可能会消耗更多内存。

这实际上是我经常更喜欢 Python 来处理批处理任务的原因之一。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T02:16:34.337

你能在你的 php.ini 中改变你的 memory_limit 吗？

另外，对变量执行 unset($var) 可以释放一些内存吗？$var = null 也有帮助吗？

另请参阅此问题：[使用 PHP 释放内存有什么好处：unset() 或 $var = null](https://stackoverflow.com/questions/584960/whats-better-at-freeing-memory-with-php-unset-or-var-null)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-10-28T02:21:41.753

我遇到了同样的问题，也是由于数据库分析（Zend_Db_Profiler_Firebug）。就我而言，它每分钟泄漏 1mb。这个脚本应该运行几天，所以它会在几个小时内崩溃。

# c# - 无法访问的代码在哪里？

> ID：1010408
> 
> 赞同：2
> 
> 时间：2009-06-18T01:55:40.790
> 
> 标签：c#, for-loop, sharpdevelop

```
int x;
int iHateDataRows = dt.Rows.Count + 2;
System.Data.DataRow[] dra = new System.Data.DataRow[1000];

for(x = 0; x < iHateDataRows; ++x) 
```

所以，这显然是一个循环，但我的问题是它`++x`告诉我它无法访问。我不知道这是否只是我的 IDE 疯了还是什么（我使用 SharpDevelop，主要是因为 VS2008 太笨重而且没有我喜欢的整洁的小功能。）

我希望我提供了足够的信息让有人猜测这个问题。我一直盯着这个东西，改变了变量。一切，它不会让步。

编辑：

这是在 for 循环之后：

```
if(dra[x].ItemArray[2].ToString() == "0")
{
    return x.ToString();
}
else
{
    return "Fail";
} 
```

我当然希望这段代码是正确的，因为我从来没有测试过它。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-18T02:06:18.523

在进入下一次迭代之前，您总是从循环中返回。也就是说，“if”语句的两半都返回。你永远不会回到循环的顶部。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-18T02:04:37.573

你可能在循环中有一个`break`or `return`（或者，天堂禁止， ）。`goto`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-18T02:07:07.523

由于循环中的一个或另一个“ `if`”子句将被执行，因此保证会发生返回，并且循环将永远不会运行第二次迭代；因此，增量永远不会发生。

# javascript - 检查 mousemove 是确定是否下载资产的好方法吗？

> ID：1010410
> 
> 赞同：4
> 
> 时间：2009-06-18T01:56:35.203
> 
> 标签：javascript, web-applications, mootools, user-experience, asset-management

所以我有一个网络应用程序，它可以用于所有意图和目的的照片查看器。

单击缩略图时，应用程序

1.  请求图像资产，
2.  将其作为 IMG 标签注入 DOM
3.  并处置其他

（MooTools`Asset.image`和）。`inject``dispose`

如果他们点击已经加载的图像，我只需再次注入它，因为它会`dispose`存储它。

用户平均查看图像 12 秒（根据我的统计数据），有足够的时间下载更多图像。

所以我的问题又来了，稍微改写一下：

**根据鼠标的移动来确定我是否应该在后台下载其他资产是好的还是坏的做法？**

因此，如果鼠标没有移动，请下载接下来的几个资产。如果它开始移动，请停止并等待鼠标停止（并在再次开始下载之前有一点间隔，例如 1 或 2 秒）。

对我来说这似乎是个好主意，但感觉就像有一些我没有考虑的次要影响。

格拉西亚斯。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T02:07:12.827

要直接回答您的问题，我认为除了检查鼠标移动会产生一定程度的性能开销之外，不会有问题。完成后，我会在慢速机器上测量性能，看看这是否是一个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T02:11:50.913

您可以使后退和前进按钮具有更大的区域（白色/透明背景）并检查这些背景上的鼠标悬停并在光标位于这些区域时加载图像。基本上在用户单击按钮之前加载图像。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2017-04-17T23:05:50.427

这些类型的后台任务有一个入口点：`requestidlecallback`

# model-view-controller - 在 Visual Studio 2008 中创建 ASP.NET MVC 控制器

> ID：1010412
> 
> 赞同：0
> 
> 时间：2009-06-18T01:58:42.360
> 
> 标签：model-view-controller, controller, option

我正在运行 ASP.net 上的电影数据库 MVC 示例。出于某种原因，当我在 Visual Studio 解决方案资源管理器中右键单击控制器文件夹时，我没有从添加菜单中获得控制器选项。我有 Visual Studio 2008 SP1 并使用 .net 3.5。

任何想法为什么缺少控制器选项？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T02:07:10.750

你也安装了[ASP.Net MVC](http://www.asp.net/mvc/download/)吗？这是一个单独的下载，因为它是从框架的其余部分带外发布的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-20T12:16:58.923

糟糕，我以为我下载了最新版本的 MVC。原来，我有测试版。删除 Beta 并安装 MVC 1.0 解决了该问题。

[在此处获取 MVC 1.0](http://www.microsoft.com/downloads/details.aspx?FamilyID=53289097-73ce-43bf-b6a6-35e00103cb4b&displaylang=en)

# rhino-mocks - 使用 RhinoMocks 模拟内部类

> ID：1010413
> 
> 赞同：4
> 
> 时间：2009-06-18T01:58:47.663
> 
> 标签：rhino-mocks, castle, internalsvisibleto

所以我有一堆内部类，我试图用 RhinoMocks 模拟它们。我在 assemblyinfo.cs 中添加了以下行：

```
[assembly:InternalsVisibleTo(RhinoMocks.StrongName)] 
```

但是，这**仍然**不允许我模拟内部类；我从 NUnit 收到以下错误消息：

> MyTests.SomeTest：System.TypeLoadException：来自程序集“DynamicProxyGenAssembly2，Version=0.0.0.0，Culture=neutral，PublicKeyToken=null”的类型“SomeType504cf40be6b444abfd417dccf5d6752”上的方法“SomeMethod”正在覆盖从该程序集中不可见的方法。

请注意，我使用的是 RhinoMocks 的“合并”版本（而不是下载选项“带有 Castle 程序集”）。我不知道 Castle 是如何合并到 RhinoMocks 中的，但不应该让我的内部对 RhinoMocks 可见，同样让它对 Castle 可见（它是 Rhino.Mocks.dll 的一部分）？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-08-03T08:42:11.563

所以我终于有一些时间，发现我需要做的就是将以下内容添加到 AssemblyInfo.cs 中：

```
[assembly: InternalsVisibleTo("DynamicProxyGenAssembly2")] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T07:37:44.677

您的问题是 RhinoMocks 动态生成具有动态代理的程序集这一事实。因此，让 RhinoMocks 可以看到你的内部结构并没有帮助。我看到的唯一可能解决您的问题的方法是：

1.  将您希望模拟的课程设为公开。
2.  在您的测试项目程序集中手动编写一个模拟类并修改您的 InternalVisibleTo 属性以授予您的测试程序集访问权限。

# amazon-s3 - 将 100,000 张图像传输到 S3。最快的方法是什么？

> ID：1010415
> 
> 赞同：5
> 
> 时间：2009-06-18T01:59:15.713
> 
> 标签：amazon-s3

我正在寻找将大约 100,000 张图像从服务器传输到我的 Amazon S3 存储桶的最快方法。

那是循环遍历每个图像并执行单独的 PUT 请求吗？我希望有一个更快的方法，但没有找到任何东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T03:55:32.750

也许试试蜗牛邮件？

[亚马逊进出口](http://aws.amazon.com/importexport/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-28T15:18:22.617

[s3漏斗](https://github.com/sstoiana/s3funnel)。我上周使用它将大约 3,000,000 张图像传输到 S3。它是多线程的，因此往往非常快。我测试了许多商业和开源工具，s3funnel 是迄今为止最好的 IMO。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T02:21:49.223

不熟悉 S3，但如果没有批量上传工具，您可以通过在多个并行进程中循环您的图像来加快速度，直到您最大化您的网络连接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T03:07:15.980

您可以尝试使用[Image Uploader](http://image-uploader-docs.aurigma.com/Docs/ImageUploader/UploadingtoCloudStorage.htm)批量上传控件。[或者，如果这是我考虑使用一些Amazon sample](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=2263&categoryID=47)的一次性任务。

无论如何，如果您想使用 PUT/POST 请求进行上传，每个请求一个文件 - 是亚马逊的 API 限制，在我看来，没有什么可做的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-30T04:31:52.163

我们 ( CloudOpt ) 构建了一个解决方案来优化数据传输到 Amazon S3，称为 CloudOptimizer。它使用对称重复数据删除、压缩和许多其他技术。看看，让我知道你的想法。我很想得到你的反馈。

[http://www.cloudopt.com](http://www.cloudopt.com)

# .net - FieldInfo.SetValue 与 Type.InvokeMember（fieldName，BindingFlags.SetField）

> ID：1010417
> 
> 赞同：1
> 
> 时间：2009-06-18T01:59:24.823
> 
> 标签：.net, reflection

使用 FieldInfo.SetValue 与 Type.Type.InvokeMember(fieldName, BindingFlags.SetField, ...) 有什么区别？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T02:15:55.507

Type.InvokeMember(fieldName, BindingFlags.SetField, ...) 内部调用FieldInfo.SetValue，所以没有区别，除了Type.InvokeMember中的额外检查

# python - 以特定角度和偏移量绘制线

> ID：1010423
> 
> 赞同：0
> 
> 时间：2009-06-18T02:02:47.857
> 
> 标签：python, image, plot, offset, angle

我正在尝试在我拥有的原始图像（数组）上绘制一条特定的线。基本上，我有一个角度和偏移量（从图像中心测量），我想在上面绘制线条。问题是，我不完全确定如何做到这一点。我可以编写一段非常复杂的代码来做到这一点，但我想知道是否有一种我不知道的更简单的方法（也许使用 matplotlib）。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T03:15:13.063

假设您的偏移量实际上是线中心的 ax, y 坐标，并且线应该是固定长度，那么使用 matplotlib 三角函数就是一个简单的问题：

```
x = [offsetx-linelength*cos(angle), offsetx+linelength*cos(angle)]
y = [offsety-linelength*sin(angle), offsety+linelength*sin(angle)]
plot(x, y, '-') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T03:37:30.460

使用 PIL 并在原始图像上绘制线条、线条或其他图像

```
import Image, ImageDraw

im = Image.open("my.png")

draw = ImageDraw.Draw(im)
draw.line((0, 0, 100, 100), fill=128)
del draw 

# write to stdout
im.save(sys.stdout, "PNG") 
```

# python - 将 URL 模式映射到 WSGIApplication 中的单个 RequestHandler

> ID：1010427
> 
> 赞同：3
> 
> 时间：2009-06-18T02:05:22.563
> 
> 标签：python, google-app-engine

是否可以将 URL 模式（正则表达式或其他映射）映射到单个 RequestHandler？如果是这样，我该如何做到这一点？

理想情况下，我想做这样的事情：

```
application=WSGIApplication([('/*',MyRequestHandler),]) 
```

这样 MyRequestHandler 会处理所有发出的请求。请注意，我正在开发一个概念验证应用程序，根据定义，我不会知道将进入该域的所有 URL。另请注意，如果这很重要，我会在 Google App Engine 上执行此操作。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-18T12:27:29.990

您描述的模式可以正常工作。此外，您指定的正则表达式中的任何组都将作为参数传递给处理程序方法（get、post 等）。例如：

```
class MyRequestHandler(webapp.RequestHandler):
  def get(self, date, id):
    # Do stuff. Note that date and id are both strings, even if the groups are numeric.

application = WSGIApplication([('/(\d{4}-\d{2}-\d{2})/(\d+)', MyRequestHandler)]) 
```

在上面的示例中，两个组（日期和 ID）被分解并作为参数传递给您的处理程序函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T02:16:30.263

```
application=WSGIApplication([(r'.*',MyRequestHandler),]) 
```

有关更多信息，请参阅[AppEngine 文档](http://code.google.com/appengine/docs/python/tools/webapp/running.html)

# tcp - 在服务器端控制（减慢）下载

> ID：1010434
> 
> 赞同：1
> 
> 时间：2009-06-18T02:07:05.370
> 
> 标签：tcp

我想控制我这边的下载量/速度 - 以及服务器端（礼貌）。...这与“我自己的下载管理器”**无关。**

让我们想象一下：我允许我儿子每天从 utube 下载最大 500Mb，但他仍然启动了一个会话来下载 10Gb 高清电影。（不一定是家长控制，但从技术上讲，这是一个很好的例子）。

我的问题是：如何限制。我想编写一个在 TCP（IP？）级别上控制它的驱动程序。是否可以在 TCP 级别？

我知道我可以在本地处理它（例如通过缩小我向服务器通告的 TCP 窗口，或者在 XXX 字节后简单地关闭连接）。

但是我真正想要的是礼貌地告诉（说）utube：（在建立连接并且正在进行下载之后）：不要努力仍然将这部电影压缩成小片段，并创建很多n/w 上的拥堵 - 我们完成了。

我想避免任何方面不必要的 n/w；基本上，我希望能够（在 TCP 级别上）告诉另一端：就是这样，我们今天就完成了。请不要重试传递整部电影，我对观看其余部分不感兴趣（今天）。（这样 utube 就会立即停止污染带宽）。

也许会让你更加困惑——但希望澄清一下——这是“Linux 网络编程权威指南”第 31 页的摘录：（谈论 TCP 标头的 6 位部分：URG、ACK、PSH， RST, SYS, FIN): ""... 当数据必须在带外传输时出现。...这就是 URG 位是否起作用。考虑一个用户**希望中止**的连接，例如...”（等等）。

这可能就是我正在寻找的：向 utube 发送带有“ABORT”的“URG”。从这篇文章中我唯一不清楚的是这个“ABORT”。这是“RST”吗？或者是什么？

请把我推向正确的方向。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T03:04:23.320

您可以使用现有的 QoS 基础设施在您的 Linux 机器中进行流量整形。

最好的方法是使用[iproute 的 tc](http://tldp.org/HOWTO/Traffic-Control-HOWTO/index.html)（或[tcng](http://tcng.sourceforge.net/)）命令创建不同的队列并为每个队列设置限制，并使用 iptables 将数据包分类到现有队列之一。这将为您提供最大的灵活性和更少的代码编写:-)（这可能是也可能不是您想要的）。我找到了一个[工具](http://www.mastershaper.org)，[据说](http://www.ctunion.com/node/189)可以使所有这些过程变得更容易。

[这里](http://www.knowplace.org/pages/howtos/traffic_shaping_with_linux/examples.php)和[这里](http://blog.kovyrin.net/2006/04/06/5min-guide-to-linux-shaping-htb/)的例子。

您可能还想查看[Shaperd以查看使用](http://freshmeat.net/projects/shaperd/)[libipq](http://www.linuxquestions.org/linux/answers/Programming/Libipq_by_example)的示例代码（如果有点旧），它允许在用户空间中进行数据包排队（此后已被 libnetfilter_queue 取代）。

如果您使用的不是 Linux，而是 Windows，您可能需要查看[QoS API](http://blogs.msdn.com/wndp/archive/2007/10/09/introduction-to-windows-qos-traffic-control.aspx)或现有的可以为您完成此任务的软件，例如[Traffic Shaper](http://bandwidthcontroller.com/trafficShaperXp.html)

# asp.net-mvc - json.net 中的 JObject 有什么命名空间？

> ID：1010450
> 
> 赞同：6
> 
> 时间：2009-06-18T02:15:19.940
> 
> 标签：asp.net-mvc, json.net

json.net 中的 JObject 有什么命名空间？

刚刚安装 int 似乎找不到那个类？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-18T02:51:46.013

[JObject 类 > 命名空间 > Newtonsoft.Json.Linq > JObject](http://james.newtonking.com/projects/json/help/html/T_Newtonsoft_Json_Linq_JObject.htm)

# mysql - 处理已删除表行的最佳实践？

> ID：1010465
> 
> 赞同：0
> 
> 时间：2009-06-18T02:19:17.683
> 
> 标签：mysql, sql

这是我的情况。我有以下表格：

*   **产品**,
*   **产品属性**，
*   **订购产品**（引用 product_id 和 order_id），
*   **订单产品属性**（引用 order_product 和 product_attribute）。

当管理员进入编辑产品属性（例如“颜色”）时，他可能会错误地删除该属性，然后再将其添加回来。如果该产品已下订单，则当他删除并重新添加该属性时，其在“产品属性”表中的 ID 会更改。这使得 Order Product Attribute 引用了一个不存在的属性 ID（尽管该属性仍然存在）。

解决这个问题的最佳方法是什么？也许我只是需要对这个问题有不同的看法。

[注意：如果在编辑产品时刷新所有属性并重新添加当前选择的可能相同的属性，也可能会出现此问题（同样重要）。]

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T02:22:19.287

不允许“错误删除”......只需在产品属性表中添加一个“活动”或“非活动”标志作为列。

您始终可以使用顺序而不是属性 id 来保存属性。如果您的设计使得属性 ID 不断变化，那么您的订单没有历史有效性。要么制作产品的新“版本”，并在进行更改时将旧版本设置为不活动，要么按顺序保存产品的状态，以便您拥有一些历史记录。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T02:37:08.600

使用 innodb 作为您的表类型，并为您的依赖表添加适当的外键关系。然后，您将无法意外删除您所依赖的行。

当然，如果您仍然希望（在某些情况下）允许这样做，您可以将 foreign_key_ 检查设置为关闭。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T02:20:33.563

向表中添加触发器以防止删除正在使用的属性？

或者

向该表添加一个已删除标志并设置该标志，而不是实际删除该行。添加`IsDeleted = False`到访问属性表的任何查询的 where 子句以进行选择。

# .net - 有什么方法可以让 Visual Studio 自托管 ASP.NET 应用程序接收外部连接？

> ID：1010466
> 
> 赞同：0
> 
> 时间：2009-06-18T02:19:49.167
> 
> 标签：.net, asp.net, visual-studio

我无法从外部获取我的开发机器上托管的任何页面，即使在 Windows 防火墙上打开异常后也是如此。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T02:36:02.893

Visual Studio Web 服务器（又名 Casini）不接受远程连接 - 您需要使用 IIS。

当然，我猜你可以做一些事情，比如运行一个代理远程请求的程序，但这比在你的开发机器上安装 IIS 并使用它要痛苦得多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T02:36:04.030

如果您使用的是 ASP.NET 调试服务器，则无法远程访问。如果您有带有 IIS 的 Windows XP Professional 或 Vista，您可以创建一个指向您的发布文件夹的虚拟目录。

如果您使用 IIS 并且您在路由器后面，请确保将端口 80 流量转发到您的计算机。

# sql-server - 删除 SQL Server 2005 中的大量数据

> ID：1010475
> 
> 赞同：0
> 
> 时间：2009-06-18T02:22:54.713
> 
> 标签：sql-server

从 SQL Server 2005 数据库中删除大型二进制列同时最小化生成的 .mdf 和 .ldf 文件大小的最佳方法是什么？

我们的应用程序曾经允许用户上传他们的文件。这些作为 BLOB 存储在*文档*表的列中。随着时间的推移，该表增长到超过整个数据库大小的 90%。

从那以后，我们改变了一些东西，不再需要像这样存储文档。我现在想将此列中的数据归零并将数据库恢复到可管理的大小（磁盘空间有点贵）。作为一个遗留应用程序，我想保持兼容性，而不是更改表的结构。

最明显的方法是执行以下操作：

`update documents set content = 0x0`

但它似乎将 .ldf 炸毁了很多。

针对特定的症状，我可以截断日志`backup log mydb with truncate_only`（`dbcc shrinkdatabase(mydb)``dbcc shrinkfile(mydb_log, 20)`

*除了内容*列之外，创建第二个表，复制数据然后`truncate`第一个表会更好吗？

任何想法将不胜感激。

干杯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T02:28:30.927

尝试删除列：

```
ALTER TABLE foo
DROP COLUMN foo.name 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-24T04:22:35.010

从实验来看，这似乎没有灵丹妙药。

这两个建议都允许我在不大幅增加 .ldf 大小的情况下删除大内容，但是，之后减小 .mdf 大小的唯一方法是类似 dbcc shrinkdatabase 的方法，它以页面碎片为代价。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T02:25:31.930

是的，您从第一个减去内容列创建第二个表然后截断原始表的想法可能是最有效的。

# emacs - 为什么 Emac 的方案模式中有一个额外的换行符？

> ID：1010478
> 
> 赞同：3
> 
> 时间：2009-06-18T02:24:13.743
> 
> 标签：emacs, scheme, elisp, emacs23

我正在使用 Emacs 23 的方案模式运行 ypsilon 方案。当我在解释器中输入一个表达式时，它会添加一个额外的换行符（见下文）。我从未见过任何其他口译员会发生这种情况。我知道 ypsilon 没有这样做，因为它看起来很好~~外壳模式~~一个外壳（尽管外壳模式表现出相同的错误行为）。scheme 或 comint 模式下的什么函数可能会添加这个额外的换行符？

看起来像这样：

```
> (+ 1 2)
3

> ;; extra newline above 
```

应该是这样的：

```
> (+ 1 2)
3
> ;; no extra newline above 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T15:12:30.140

我想到了。comint-send-input 有一个可选的 no-newline 参数。我通过将 Return 键重新绑定到包装 comint-send-input 的新函数将其设置为 true（不要插入另一个换行符）。那些额外的换行符消失了。不过，我不知道它们为什么首先出现。

```
(defun comint-send-input-no-newline ()
  (interactive)
  (comint-send-input t nil)) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T03:15:24.467

这更像是一种解决方法，但试试[SLIME 。](http://common-lisp.net/project/slime/)我发现它可以很好地处理输入/输出。你可以找到支持 Scheme 的 SLIME 后端。

# sql-server - 'ftcat_documentindex' 离线时如何备份CRM3.0？

> ID：1010482
> 
> 赞同：0
> 
> 时间：2009-06-18T02:25:49.293
> 
> 标签：sql-server, sql-server-2005, backup

我的组织使用 Microsoft CRM 3.0，我正在尝试备份数据库。以下错误阻止我这样做，有谁知道如何解决这个问题？

**错误：**

System.Data.SqlClient.SqlError：不允许备份全文目录“ftcat_documentindex”，因为它不在线。检查错误日志文件，了解全文目录脱机的原因并使其联机。或者，可以通过使用 FILEGROUP 或 FILE 子句将选择限制为仅包括联机数据来执行 BACKUP。(Microsoft.SqlServer.Smo)

如需帮助，请单击： http: [//go.microsoft.com/fwlink ?ProdName=Microsoft+SQL+Server&ProdVer=9.00.4035.00&LinkId=20476](http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&ProdVer=9.00.4035.00&LinkId=20476)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T04:04:09.573

如错误所述，您可以进行[文件组备份](http://msdn.microsoft.com/en-us/library/ms179401.aspx)，也可以将全文数据目录联机。您可以使用以下命令识别全文目录的位置（或至少应该在的位置）：

```
SELECT  sf.filename
FROM    sys.fulltext_catalogs ftc
JOIN    sys.sysfiles sf ON ftc.[file_id] = sf.fileid 
```

如果您的目录不存在，可能它已被删除。您可以手动重新创建它，或者 MSCRM 中可能有一个实用程序来重建它 - 您可能需要联系您的经销商寻求帮助。

# php - UTC 问题，不确定如何解决（PHP/MySQL）

> ID：1010486
> 
> 赞同：0
> 
> 时间：2009-06-18T02:28:00.257
> 
> 标签：php, mysql, timezone

我在服务器上的所有日期/时间字段中都看到了 UTC 日期和时间，我将其全部跟踪到我的网络服务器上的时区设置处于 UTC 时间......我的问题是如何将这些设置为本地用户日期和时间？所有时间都以 UTC 格式存储在 MySQL 服务器上。

我有用户城市、地区（省/州）和国家。最坏的情况我想在 PHP 默认时区显示日期和时间。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T02:55:11.963

您可以使用此函数，并将用户的位置“珀斯，华盛顿州，澳大利亚”作为地址传递给它。

您可以让它返回服务器时区和默认 php 时区之间的偏移量，而不是在失败时返回 0。

您可能希望将其存储在会话变量中，并且仅在变量为空时调用该函数，这将提高页面呈现的速度。

```
/**
 * This function finds the geocode of any given place using the geocoding service of yahoo
 * @example getGeoCode("White House, Washington");
 * @example getGeoCode("Machu Pichu");
 * @example getGeoCode("Dhaka");
 * @example getGeoCode("Hollywood");
 *
 * @param   string address - something you could type into Yahoo Maps and get a valid result
 * @return  int timeZoneOffset - the number of seconds difference between the user's timezone and your server's timezone, 0 if it fails.
 */
function getTimeZoneOffset($address) {
    $_url = 'http://api.local.yahoo.com/MapsService/V1/geocode';
    $_url .= sprintf('?appid=%s&location=%s',"phpclasses",rawurlencode($address));
    $_result = false;
    if($_result = file_get_contents($_url)) {
        preg_match('!<Latitude>(.*)</Latitude><Longitude>(.*)</Longitude>!U', $_result, $_match);
        $lng = $_match[2];
        $lat = $_match[1];

        $url = "http://ws.geonames.org/timezone?lat={$lat}&lng={$lng}";
        $timedata = file_get_contents($url);
        $sxml = simplexml_load_string($timedata);
        $timeZoneOffset = strtotime($sxml->timezone->time) - time();
        return $timeZoneOffset;
    }
    else
    return 0;
} 
```

代码改编自[Time Engine](http://www.phpclasses.org/browse/package/4446.html)，一个 LGPL php 类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T02:37:37.600

在 MySQL 中，当您从数据库中选择数据时，您可以使用函数[CONVERT_TZ](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_convert-tz)将所有日期转换为当前时区。另一个 stackoverflow 线程讨论了[如何使用 PHP 5 的 DateTime 类转换时区。](https://stackoverflow.com/questions/952975/how-can-i-easily-convert-dates-from-utc-via-php)

# iphone - 嵌套的 UISCrollViews - 防止父 Scrollview 在缩放子项时滚动

> ID：1010489
> 
> 赞同：1
> 
> 时间：2009-06-18T02:29:09.473
> 
> 标签：iphone, objective-c, cocoa-touch, uiscrollview, nested

我有一个带有嵌套 UIImageViews 的 UIScrollView。每个图像视图都可以缩放，但是当我在缩放图像时尝试滚动内部滚动视图时，外部滚动视图会拾取它并切换图像视图。

如何防止这种情况发生，以便外部滚动视图仅在内部未缩放时滚动？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T07:20:54.007

我将发布我必须努力帮助他人的答案。

处理嵌套 UIScrollView 的一种简单方法是共享同一个委托。这样，当您检测到一个 UIScrollView 滚动时，您可以轻松地共享控制器逻辑并将设置应用于另一个。

为了解决我遇到的这个特殊问题，我所要做的就是在当前缩放状态下保持一个 BOOL 。一旦应用检测到内部滚动视图正在缩放，

```
- (UIView *)viewForZoomingInScrollView:(UIScrollView *)scrollView1 {
    return [innerScrollViews objectAtIndex:[self indexOfComicViewWithOffset:currentOffset]];    
}

- (void)scrollViewDidEndZooming:(UIScrollView *)scrollView1 withView:(UIView *)view atScale:(float)scale {
    if (scale == 1) {
        zooming = NO;
        [outerScrollView setScrollEnabled:YES];
    } else {
        zooming = YES;
        [outerScrollView setScrollEnabled:NO];
    }
} 
```

# javascript - Javascript打包问题

> ID：1010490
> 
> 赞同：1
> 
> 时间：2009-06-18T02:30:16.693
> 
> 标签：javascript

我有一个导致问题的缩小/打包的 javascript 文件。问题是未打包的输入文件在*某处*缺少一些分号，当有换行符时这不是问题，但是当文件被打包时，换行符被删除，这会导致解析器错误。例如：

```
//input
var x = function() {
    doSomething();
}  // note: no semicolon
var y = 'y';

//----
// output
var x=function(){doSomething();}var y='y';
//                  error here: ^ 
```

奇怪的是，当我对输出文件进行替换以用分号和新行替换所有分号时，该文件有效！这使得找到错误变得非常困难，因为AFAIK，我想不出分号后换行应该改变任何东西的任何情况。关于为什么进行此替换会使它起作用的任何想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T02:33:36.983

呃……你试过[JSLint](http://www.jslint.com/lint.html)吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T02:36:44.997

当有换行符时，有一个隐含的分号。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T02:43:26.590

使用[jslint](http://jslint.org/)检查您的代码。如果你这样做并让它通过分号，它应该正确打包。

在 JavaScript 中，分号隐式添加到换行符处。这引入了可能模棱两可的情况。这篇博文：[http](http://robertnyman.com/2008/10/16/beware-of-javascript-semicolon-insertion/) : //robertnyman.com/2008/10/16/beware-of-javascript-semicolon-insertion/ 简洁地描述了这个问题并给出了一个例子。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T02:46:51.513

JSlint 是一个很好的解决方案。此外，一些代码编辑器会为您发现这些类型的错误。如果我没记错的话，NetBeans 会在您键入时实时捕获这些内容。我相信 Komodo 和 Aptana 也是如此。

# websphere - 错误 404：没有为 uri 配置目标 servlet

> ID：1010493
> 
> 赞同：7
> 
> 时间：2009-06-18T02:31:14.213
> 
> 标签：websphere

我刚刚完成了一个使用 Spring Framework 构建的新 Web 模块。到目前为止，我正在使用 Tomcat 测试本地机器上的所有页面。今天将应用程序移至 Websphere 后，我收到以下错误：

```
 Error 404: No target servlet configured for uri 
```

我需要在 web.xml 或某处做些什么吗？我在我的 WAS 上部署了一个 EAR 文件，它有另一个 war 文件。

以下是我在控制台上看到的输出，如果有帮助的话。

```
The resource WEB-INF/ibm-web-bnd.xmi that is defined in URI WEB-INF/ibm-web-bnd.xmi for module analytics.war is not valid.  The resource has a cross reference org.eclipse.jst.j2ee.webapplication.internal.impl.WebAppImpl@4be44be4 (eProxyURI: WEB-INF/web.xml#WebApp_ID) that cannot be resolved.
[6/17/09 15:24:49:465 CDT] 00000011 ArchiveDeploy W   ADMA0091E: The resource WEB-INF/ibm-web-ext.xmi that is defined in URI WEB-INF/ibm-web-ext.xmi for module analytics.war is not valid.  The resource has a cross reference org.eclipse.jst.j2ee.webapplication.internal.impl.WebAppImpl@7b7a7b7a (eProxyURI: WEB-INF/web.xml#WebApp_ID) that cannot be resolved. 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T02:41:09.123

看起来您的 servlet 配置不正确。我会说您的 web.xml 有一个 servlet-name 条目，它与您的 WEB-INF 目录中的 -servlet.xml 文件不对应。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-08T20:58:00.970

我的 json 响应出现了同样的错误。这可以通过在操作中设置 contentLength 来解决。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-10-19T04:41:54.303

**ibm-web-bnd.xmi**有一个属性：`fileServingEnabled`.

这控制是否`Websphere`提供静态内容（index.html、图片等）。

这是真的，如果省略，默认情况下，但您可以通过将其添加到标签来确保它处于打开状态`WebAppExtension`

```
fileServingEnabled="true" 
```

# java - 如何在 linux 中调试 java system.loadlibrary 错误？

> ID：1010503
> 
> 赞同：4
> 
> 时间：2009-06-18T02:38:57.630
> 
> 标签：java, eclipse, java-native-interface

我有一个 Java 程序，它通过我试图在 Linux 上运行的 JNI 调用 C 代码。外部代码由两个 .so 文件组成：一个用于 JNI 绑定（使用 swig 构建），另一个用于实际功能。我在同一个目录中有两个库，并且 LD_LIBRARY_PATH 设置正确。ldd 从命令行运行时没有报告任何问题，但是当我在 Eclipse 编辑器的“运行配置”对话框中将 LD_LIBRARY_PATH 设置为相同的值并尝试执行程序时，会出现以下错误：

java.lang.UnsatisfiedLinkError: [path to libraries]/[JNI binding library].so: [actual code library].so: cannot open shared object file: No such file or directory

这使我相信 JNI 包装器库已成功加载，但是当该库尝试加载包含实际代码的库时会失败。有什么办法可以进一步调试吗？

我将进一步指出，这个问题发生在 eclipse 编辑器本身中，并且我没有尝试将代码打包到 jar 中并在独立的 jvm 实例中运行它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-24T06:26:22.917

我认为问题在于对 System.loadLibrary(String) 的调用和使用 LD_LIBRARY_PATH。使用 loadLibrary("foo") 将在您的 java.library.path 中查找名为 libfoo.so 的内容。如果找不到任何名为 libfoo.so 的内容，您将收到此错误。

现在如果你只是设置了LD_LIBRARY_PATH，你想要的本地符号会被链接器自动拾取，所以你不需要设置-Djava.library.path。

根据我在 gdal 项目中 swig 的经验，这个错误实际上是无害的，并且由于设置了 LD_LIBRARY_PATH，这将正常工作。

我建议使用 -Djava.library.path 并显式调用 loadLibrary，原因是如果您决定使用 webstart 部署您的应用程序，您将明确需要调用 loadLibrary 来获取您的本机库。

当我使用 eclipse 时，我按照 Daff 给出的说明在构建路径中的库选项卡中的 jar 下编辑本机库。再说一遍，这只是将 java.library.path 设置在幕后。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-24T23:39:52.243

可能您只需要在运行配置对话框中找到正确的位置即可放置 -Djava.library.path=... 选项。我认为你想 -D 在参数选项卡上的“vm参数”中定义，而如果你想定义环境选项卡上的 LD_LIBRARY_PATH 。Eclipse 会很高兴地让你把东西放在它们不代表你认为它们的意思的地方。无论如何，我以前以这种方式使用过库，如果有机会，我会查看我所做的并在此处编辑我的答案。

另一件要尝试的事情是使用 LD_DEBUG。您可以将环境变量 LD_DEBUG 设置为各种事物（尝试 ALL），然后 linux 加载器将泄露有关应用程序试图加载什么、它*在哪里*寻找事物等的各种有用信息。当然，这个预先假设您从命令行启动 eclipse，因此您既可以设置环境变量并查看加载程序诊断；但就系统而言，当您从 eclipse 内部运行您的应用程序时，您的应用程序只是 eclipse 正在做的事情，因此可以通过这种方式看到任何库加载行为。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T12:33:36.997

据我所知，Eclipse 不使用 LD_LIBRARY_PATH。设置正确的本地库路径的最简单方法是转到 Project properties -> Java Build Path -> Libraries 然后展开 JRE System Library 条目或（如果可用）使用您的本地库的 Jar 文件，选择“Native库位置”然后单击“编辑...”并选择您的库所在的文件夹。实际上它确实设置了 -Djava.library.path 变量，因此如果您从 Eclipse 外部启动程序，则必须将其包含在命令行中.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T06:17:49.793

你可以试试`-Djava.library.path=actual.so`命令行参数吗？

在 Windows 上，我在使用 JNI 包装器 DLL 作为其 DLL 的 3rd 方库时遇到了类似的问题。我的项目在 lib 目录中有 DLL，所以我将 lib 添加到 PATH（例如`PATH=%PATH%;./lib`环境变量，一切都开始工作了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-10T06:28:32.360

是的 LD_LIBRARY_PATH 为我工作

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-29T21:21:04.900

您的两个库还依赖于其他库吗？如果是这样，您需要确保 JVM 也可以访问它们。

请注意，手动设置“-Djava.library.path”似乎会删除默认库路径。

因此，使用以下代码：

```
public class LibTest {
    public static void main(String[] args) {
        String property = System.getProperty("java.library.path");
        StringTokenizer parser = new StringTokenizer(property, ":");
        while (parser.hasMoreTokens()) {
            System.err.println(parser.nextToken());
        }
    }
} 
```

从 eclipse 启动，带有 Java 1.6.0_14 输出：

```
/opt/java/jre/lib/i386/client
/opt/java/jre/lib/i386
/opt/java/jre/../lib/i386
/opt/java/jre/lib/i386/client
/opt/java/jre/lib/i386
/usr/lib/xulrunner-devel-1.9.0.11
/usr/lib/xulrunner-devel-1.9.0.11
/usr/java/packages/lib/i386
/lib
/usr/lib 
```

但是当我设置 JVM arg "-Djava.library.path=/tmp/" 我只得到：

```
/tmp/ 
```

如果您手动设置 java.library.path，这可以解释为什么 ldd 从命令行工作但您的 .so 不能从 eclipse/java 工作。

您可以尝试不设置 java.library.path 并将 System.load 与库的绝对路径一起使用，而不是调用 System.loadLibrary。这可能允许 JVM 找到您的 .so 并在搜索其依赖项时仍使用默认路径。

当然，如果这没有用，那么您也可以尝试在命令行中使用“-verbose:jni”打开 jni 调试输出。这可能会给你一些问题的线索。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-11-20T06:59:18.490

添加这个答案可能很有用在 AIX 机器中，我们需要设置 LIBPATH 环境变量而不是 LD_LIBRARY_PATH。

# asp.net-mvc - LINQ to SQL 和数据投影，MVC

> ID：1010505
> 
> 赞同：0
> 
> 时间：2009-06-18T02:39:35.100
> 
> 标签：asp.net-mvc, linq, projection

嗨，我有一个包含一些值（ID）的表，当然，当我得到结果时，我只得到了 int ID，但我想让它更加用户友好，例如当它是数字 1 时，我想把字符串“可用”，当它的 2“不可用”时，我在 N 层环境中，我需要在模型上完成此操作，实现此目的的最佳方法是什么，我必须声明另一个类来投影字符串，或者我必须使用字典之类的东西，Key -> Value。

现在我只有这个

```
return from t in db.products where t.productID==productID select t; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T04:48:55.097

如果您使用的是 Linq to SQL，则需要另一个表来包含产品状态：

```
Table Name: Product Status
Fields:     ProductStatusID   int Indentity Primary Key
            ProductStatus     nvarchar(50) 
```

在您的产品表中添加一个字段：

```
Field to Add:  ProductStatusID    int 
```

将一些状态添加到新表中，并将每个产品的 ProductStatusID 设置为适当的状态 ID。

添加将两个 ProductStatusID 字段连接在一起的约束。最简单的方法是在 SQL Server Management Studio Express 中创建一个图表，将两个表拖到图表上，然后将 ProductStatusID 字段从 ProductStatus 表拖到 Products 表，然后在打开的对话框中单击“确定”。

重建您的 Linq to SQL 数据类。为此，您可以删除并重新创建 DBML 文件，然后再次将表拖到设计器中。

当您从 dataContext 对象中获取产品对象 (p) 时，您现在应该会看到：

```
p.ProductStatus   <-- The text description of the product's status. 
```

Linq to SQL 将进入您的 ProductStatus 表，并查找适当的状态描述。

# php - 不使用“ping”从动态语言 ping

> ID：1010506
> 
> 赞同：0
> 
> 时间：2009-06-18T02:39:43.667
> 
> 标签：php, linux, unix, command-line-interface, packet

我在一个不允许使用“ping”应用程序的 Linux 系统上（ping: icmp open socket: Operation not allowed）。但是，我正在编写的脚本（PHP，但如果需要，我可以对任何脚本/程序使用 exec() 调用）需要确定主机是否“活动”。如果不使用“ping”，我怎么能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T10:52:28.213

如果 ping 不能做到这一点，你就不能用不同的语言来做到这一点。这是一个类比，可以帮助您理解原因。假设文件系统上有一个文件，您想要它的内容。你跑`cat filename`，它说`cat: filename: Permission denied`。你认为 Perl（或任何其他语言）会比 C 在这里做得更好吗？我们试试看：

```
#!/usr/bin/perl

use strict;
use warnings;

die "usage: $0 filename" unless @ARGV == 1;
my $filename = shift;

open my $fh, "<", $filename
    or die "could not open $filename: $!\n";

print while <$fh>; 
```

当针对文件运行时，它会显示`could not open filename: Permission denied`. 无论您尝试使用哪种语言，您都将获得`Operation not permitted`.

也就是说，还有其他方法可以确定机器是否还活着。如果已知有一台服务器始终在机器上运行，您可以尝试连接到它。请注意，您不需要完成连接（例如登录），只要您可以成功启动连接就足以知道该框已启动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-29T22:08:08.130

或者您可以在 unix 上的“ping”程序上设置 SUID 位；）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T15:10:04.047

要执行 ping (ICMP)，您需要 root 访问权限。

您唯一的方法是执行**TCP 或 UDP ping**。如果你想要一个例子检查[Cacti](http://www.cacti.net/)的代码，或者你可以使用 hping 为你做

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T02:46:41.733

[http://us2.php.net/manual-lookup.php?pattern=socket](http://us2.php.net/manual-lookup.php?pattern=socket)

但是如果你不能用 ping 打开一个套接字，你就不可能使用其中的任何一个。与您的托管服务提供商交谈。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T03:11:28.733

PHP 手册为用户提供了在 PHP 中执行[ping 的代码](http://us3.php.net/manual/en/function.socket-create.php#80775)。不幸的是，它需要 root 访问权限，因此您也不太可能使用它。一种替代方法是使用 curl 并查看[curl_getinfo()](http://us.php.net/manual/en/function.curl-getinfo.php)返回的值：

```
c = curl_init('http://www.site.com/');
curl_exec($c);
$info = curl_getinfo($ch); 
```

它远不等同于 ping，但仍可能适合您的需求。

# regex - 如何编写一个正则表达式来排除字母数字字符和空格？

> ID：1010508
> 
> 赞同：1
> 
> 时间：2009-06-18T02:40:51.307
> 
> 标签：regex

我有以下正则表达式模式，它去除了非字母数字。

> **[^0-9A-Za-z]**

效果很好。

我希望修改这个正则表达式，以便它查找字母数字和空格。我该如何调整它以使其也接受空格？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-18T02:43:04.250

在括号里加一个空格

```
[^0-9A-Za-z ] 
```

你的问题也有点模棱两可。我假设您要**排除**字母数字和空格。

# php - 安全地使用 exec 和 PHP 运行 ffmpeg

> ID：1010518
> 
> 赞同：3
> 
> 时间：2009-06-18T02:44:07.087
> 
> 标签：php, security, ffmpeg

我想从 PHP 运行 ffmpeg 以进行视频编码。

我正在考虑使用 exec 或 passthru 命令。但是，我被警告说启用这些功能存在安全风险。用我的支持人员的话来说：

> 指令“disable_functions”用于禁用任何允许执行系统命令的功能。这是为了提高服务器的安全性。如果使用不当，这些 PHP 函数可以用来破解服务器。

我猜如果启用了 exec，那么有人可以（可能）执行任意的 unix 命令。有谁知道从 PHP 运行 ffmpeg 的安全方法？

顺便说一句，我在专用服务器上。提前谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T03:01:52.793

`exec`与登录安全终端相比，它本身不会带来安全风险。

这样想，如果您要像这样列出目录的内容

`exec( 'ls /foo/bar' );`

您的用户发送给您的 php 脚本的内容并不重要，它只会列出指定的目录。

**只要您仔细清理用户的任何输入，并避免输出敏感信息，您就可以了。**

在命令行上运行输入之前，请使用以下方法对输入进行清理：

*   [escapeshellarg()](http://au.php.net/manual/en/function.escapeshellarg.php) - 转义要用作 shell 参数的字符串
*   [escapeshellcmd()](http://au.php.net/manual/en/function.escapeshellcmd.php) - 转义 shell 元字符

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-07T21:42:59.487

您可以尝试使用 ffmpeg-php 库...在这里找到：http: [//sourceforge.net/projects/ffmpeg-php/](http://sourceforge.net/projects/ffmpeg-php/)

# linux - 您可以使用多个线程来跟踪应用程序吗？

> ID：1010520
> 
> 赞同：8
> 
> 时间：2009-06-18T02:46:00.970
> 
> 标签：linux, multithreading, debugging, ptrace

我正在编写一个主要针对 Linux 的面向 GUI 的调试器，但我计划将来移植到其他操作系统。因为 GUI 必须始终保持交互，所以我有几个线程处理不同的事情。

首先，我有一个“调试事件”线程，它只是循环等待 waitpid 返回并将接收到的事件传递给其他线程。我这样做是因为 waitpid 没有超时，这使得它很难与其他事件循环集成并保持响应（waitpid 可以无限期挂起！）。

到目前为止，这种策略对于 Linux 构建非常有效。最近我一直试图让我的调试器线程感知（如在被调试应用程序中的线程中，而不是调试器本身）。

所以我将 ptrace 选项设置为跟踪克隆事件并查找将高 16 位设置为`PTRACE_EVENT_CLONE`. 然后我`PTRACE_GETEVENTMSG`用来获取新线程的 TID。这一切都在我的小型测试工具应用程序中运行良好。但是由于某种原因，当我将该代码放入我的实际调试器时它失败了。（我收到“没有这样的过程”错误代码）

我想到的一件事是 Windows 有一个规则，即只有附加到应用程序的线程才能侦听调试事件。Linux 的 ptrace 有类似的限制吗？如果是这样，为什么我的代码适用于其他调试事件？

**编辑：**

似乎至少 waitpid 支持从不同的线程等待，手册页说：

> 在 Linux 2.4 之前，线程只是进程的一种特殊情况，因此一个线程不能等待另一个线程的子线程，即使后者属于同一个线程组。然而，POSIX 规定了这样的功能，从 Linux 2.4 开始，一个线程可以并且默认情况下会等待同一线程组中其他线程的子线程。

所以最多这是一个 ptrace 限制。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-12-08T17:48:20.240

[在实现Maxine VM debugger](http://wikis.sun.com/display/MaxineVM/Inspector)的 Linux 特定部分时，我遇到了同样的问题（还有许多其他问题！）。您的猜测是正确的，调试器中只有一个线程可以使用 ptrace 来控制被调试者。我们通过在专用线程上对 ptrace 进行所有调用来实现这一点。您可能会发现查看 kenai.com/projects/maxine/sources/maxine/show 上的 Maxine 源中的 LinuxTask.java、linuxTask.h 和 linuxTask.c 文件很有用

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-11T02:42:51.847

据我所知，这是不允许的。任务不能`ptrace`在它没有附加的任务上使用。此外，一个任务最多可以由另一个任务跟踪，因此您不能简单地在每个线程中附加一次。我认为这是因为当一个任务附加到另一个任务时，跟踪任务成为跟踪任务的父级，每个任务只能有一个父级。

似乎应该允许多线程跟踪，因为线程是同一进程的一部分，但在实现方面，Linux 内核中的线程和进程之间实际上并没有太大区别。线程只是碰巧与另一个任务共享其大部分资源的任务。

如果您有兴趣，可以浏览内核[中 ptrace 的源代码。](http://lxr.kelp.or.kr/source/kernel/ptrace.c?v=2.6.28)具体看，大多数请求[`ptrace_check_attach`](http://lxr.kelp.or.kr/source/kernel/ptrace.c?v=2.6.28#L82)都会调用它。[`sys_ptrace`](http://lxr.kelp.or.kr/source/kernel/ptrace.c?v=2.6.28#L548)如果目标任务的父级不是当前任务，它会返回`-ESRCH`（听起来像你得到的错误代码）。

# language-agnostic - 常见的编程特殊字符有哪些昵称？

> ID：1010523
> 
> 赞同：7
> 
> 时间：2009-06-18T02:47:31.247
> 
> 标签：language-agnostic

句号、感叹号和星号有常用的俚语名称：
. “点”
！“砰”
*“星”

但是像
%
&
<
{
[
;
等等

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-06-18T03:00:05.653

这里有一些，诗歌风格：

```
<> !*''#
^"`$$-
!*=@$_
%*<> ~#4
&[]../
|{,,SYSTEM HALTED 
```

只有大声朗读才能欣赏这首诗：

```
Waka waka bang splat tick tick hash,
Caret quote back-tick dollar dollar dash,
Bang splat equal at dollar under-score,
Percent splat waka waka tilde number four,
Ampersand bracket bracket dot dot slash,
Vertical-bar curly-bracket comma comma CRASH. 
```

资料来源：[http ://babek.info/libertybasicfiles/lbnews/nl123/fun.htm](http://babek.info/libertybasicfiles/lbnews/nl123/fun.htm)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-18T02:49:38.573

[互联网知道很多这些](http://ascii-table.com/pronunciation-guide.php)

或者，检查[行话文件](http://catb.org/jargon/html/A/ASCII.html)。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-06-18T02:51:36.543

力求清晰，不要使用俚语，而是使用每个符号的普遍接受的名称。因此，

```
. dot or period
! exclamation point
* asterisk or star
% percent (sometimes mod)
& ampersand
< less than
{ left brace
[ left bracket
; semicolon 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-06-18T02:57:16.860

intercal 参考手册是权威指南：

```
.           spot                    identify 16-bit variable      
:           two-spot                identify 32-bit variable      
,           tail                    identify 16-bit array         
;           hybrid                  identify 32-bit array         
#           mesh                    identify constant             
=           half-mesh                                             
'           spark                   grouper                       
`           backspark                                             
!           wow                     equivalent to spark-spot      
?           what                    unary exlusive OR (ASCII)     
"           rabbit-ears             grouper                       
".          rabbit                  equivalent to ears-spot       
|           spike                                                 
%           double-oh-seven         percentage qualifier          
-           worm                    used with angles              
<           angle                   used with worms               
>           right angle                                           
(           wax                     precedes line label           
)           wane                    follows line label            
[           U turn                                                
]           U turn back                                           
{           embrace                                               
}           bracelet                                              
*           splat                   flags invalid statements      
&           ampersand[5]            unary logical AND             
V           V                       unary logical OR              
            (or book)                                             
V-          bookworm                unary exclusive OR            
            (or universal qualifier)                              
$           big money               unary exclusive OR (ASCII)                            
c|          change                  binary mingle                 
~           sqiggle                 binary select                 
_           flat worm                                             
            overline                indicates "times 1000"        
+           intersection            separates list items          
/           slat                                                  
\           backslat                                              
@           whirlpool                                             
-'         hookworm                                              
^           shark                                                 
            (or simply sharkfin) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T03:44:00.867

一定要找比较有英伦风味的，我喜欢#！（阅读“嘎吱嘎吱”）就像在[CrunchBang Linux](http://crunchbanglinux.org/)中一样。对于纯粹的怪异，我喜欢称“#”为“octothorpe”。

我听说过的其他一些有趣的（我很难找到这些）：

```
= "gets" (when reading C code "int num = 5;" would be "num gets five")
` "quasiquote" (lisp)
#! together are often pronounced "shebang" (consider that a kind of tech-dipthong) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-12T20:43:38.743

考虑这些额外的：

```
! not
@ these (Perl)
$ this (Perl)
: otherwise (ternary operator)
; stop (read as a telegram?)
* anything (regex-esque)
& and
| or 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T03:06:08.837

除了[Tyler McHenry 的](https://stackoverflow.com/questions/1010523/what-are-the-nicknames-for-common-programming-special-characters/1010526#1010526)列表之外，还有 Jeff 的[博客文章](http://www.codinghorror.com/blog/archives/001133.html)链接到 The New Hacker's Dictionary 中的[ASCII](http://www.elsewhere.org/jargon/jargon.html#ASCII)条目。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-18T03:12:16.377

```
# = "pound" 
```

如在

```
#sand 
```

或者

```
#puppy 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-20T00:34:52.610

@在俄语中发音为“狗”（собака）（用于视觉图片）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-07-06T07:59:54.303

呵呵，小时候，我叫“#”——字符（别笑！）“嗯”。而“$”被称为“xsssss”。

# c++ - 多重继承层次结构

> ID：1010524
> 
> 赞同：2
> 
> 时间：2009-06-18T02:48:02.510
> 
> 标签：c++, multiple-inheritance

很长一段时间以来，我一直在寻找一种干净的方式来做到这一点。在我的问题中，存在 3 个类不共享任何父类，但每个类都有一些同名的方法（A.doSomething、B.doSomething、C.doSomething）。因此，具有相同的函数签名，类 D 从 A 继承并使用方法 doSomething() 将“看起来相同”，以 E 从 B 或 C 继承。

这是我想做的事情的草图：

```
class Base {
    public:
    void myMethod(void) { doSomething(); }
};

class Independent {
    public:
        doSomething();
};

clase Derived : public Base : public Independent {
 (...)
};

int main(void) {
   Derived *derivedObject = new Derived();
   derivedObject->myMethod();
} 
```

在这个问题中，“独立”类型的对象由我无法更改的库提供。我想定义一个使用稍后将被继承的方法的基类。我找不到使用虚拟继承来执行此操作而不会导致编译不明确的正确方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T03:16:11.127

你那里的情况很糟糕。对此的一种解决方案是使用奇怪重复的模板模式在编译时执行继承，如下所示：

```
template <typename D>
class Base {
    public:
        void myMethod(void) { static_cast<D*>(this)->doSomething(); }
};

class Independent {
    public:
        void doSomething();
};

clase Derived : public Base : public Independent {
    /*...*/
};

int main(void) {
   Derived *derivedObject = new Derived();
   derivedObject->myMethod();
} 
```

或者，您可以选择在中间放置一个中间人类来转发`Independent`（我假设您有许多类派生自同一个`Base`and `Independent`，只是不想为每个类都这样做）。

```
template <typename D>
class Base {
    private:
        virtual void doSomethingImpl();
    public:
        void myMethod(void) { doSomethingImpl(); }
};

class Independent {
    public:
        void doSomething();
};

class IndependentWrapper : public Base : public Independent {
    private:
        void doSomethingImpl() { Independent::doSomething(); }
};

clase Derived : public IndependentWrapper {
    /*...*/
};

int main(void) {
   Derived *derivedObject = new Derived();
   derivedObject->myMethod();
} 
```

# java - 键盘事件

> ID：1010525
> 
> 赞同：0
> 
> 时间：2009-06-18T02:48:17.313
> 
> 标签：java

我已经添加了键盘事件......使用机器人类的对象在记事本上写入键值......但是当我按下**“a”**时，它会将其解释为**“1”**等等......对于所有的钥匙...

当我显示所有键的 asci 值时，它将打印准确的值，如 a-97、b-98 等....

为什么会发生这种情况，请给出一些解决方案....

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T02:55:38.423

该[`Robot.keyPress`](http://java.sun.com/javase/6/docs/api/java/awt/Robot.html#keyPress(int))方法接受一个`int`关键代码——而不是一个实际的字符代码。

从有关的文档中`keycode`：

```
keycode - Key to press (e.g. KeyEvent.VK_A) 
```

因此，输入以下内容将不起作用：

```
Robot r = new Robot();
r.keyPress('a');            // Won't work -- it will press an "1" 
```

要正常工作，必须使用以下常量[`KeyEvent`](http://java.sun.com/javase/6/docs/api/java/awt/event/KeyEvent.html)：

```
Robot r = new Robot();
r.keyPress(KeyEvent.VK_A);  // This works -- it will press an "a" 
```

此外，如果想要使用`KeyEvent`从 a`KeyListener`的事件返回的 s ，例如`keyPressed`and `keyReleased`，则该`KeyEvent`对象有一个[`getKeyCode`](http://java.sun.com/javase/6/docs/api/java/awt/event/KeyEvent.html#getKeyCode())方法将返回`keycode`事件的 。

# php - 具有动态内容的 Ajax 后退按钮

> ID：1010530
> 
> 赞同：1
> 
> 时间：2009-06-18T02:50:28.120
> 
> 标签：php, jquery, ajax

我使用 JQuery 和 Ajax 创建了一个页面，该页面帮助用户筛选一系列选项，并最终显示符合其规范的经过筛选的产品列表。

这一切都很好。

我遇到的问题是 Ajax 的“后退按钮”问题，我知道如何使用静态内容上的锚点（即 Filter.php#Step2）来解决这个问题。

但是，该页面通过返回产品规格列表来工作，当单击规格链接时，Ajax 会再次应用链接参数加载同一页面，此操作最多重复六次，之后，用户被重定向到过滤后的产品网址。

如果用户然后单击“返回”，那么过滤器页面当然会从第 1 步而不是最后一步（第 6 步）重新加载。

有谁知道这是否可能？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T03:22:08.807

每次您希望能够返回上一步时，更改 window.location.hash。

IE。

```
window.location.hash = 'step1'; 
```

这会更改 URL 中的 #foo 部分。您还需要 JavaScript 中的计时器来检查哈希是否已更改，因为没有办法可靠地检测到点击后退按钮。类似于...的东西

```
var oldHash = window.location.hash;
setInterval(function(){
  if(window.location.hash != oldHash) {
    //the hash was changed, do something
  }
}, 50); 
```

我希望这有帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T03:16:48.643

我不能说我以前亲自实现过这个，但我记得 jQuery Tools 选项卡组件做了类似的事情。我不确定它是否适用于您的特定情况，但可能值得以他们的方法为起点。

[jQuery 工具 AJAX：具有历史支持的选项卡](http://flowplayer.org/tools/demos/tabs/ajax-history.html)

# ruby-on-rails - 您如何使用 accept_nested_attributes_for 创建 RoR 工厂关联？

> ID：1010532
> 
> 赞同：2
> 
> 时间：2009-06-18T02:50:36.310
> 
> 标签：ruby-on-rails, factory-bot, factories

正如安东指出的那样（感谢安东！）我的问题是测试中的关联缓存，看起来我确实在工厂中正确地创建了nested_attribute。正确的语法是：

```
Factory.define :job do |f|
  ...
  f.vehicles_attributes [{:vin => "1", :model => "ford", :make => "escort"},{:vin => "1", :model => "ford", :make => "escort" }]
end 
```

* * *

我`accepts_nested__attributes_for`在我的工作模型中使用，并且在每次更改模型时几乎失去我的弹珠“夹具潜水”后试图迁移到工厂女孩。

我在下面发布了一堆代码，但我的问题很简单：

**如何使用工厂创建nested_attributes？**

我可以使用下面的代码创建一个 Job 实例，但我无法在我的单元测试中创建创建车辆。如果没有`f.vehicles_attributes...`我的作业测试验证失败。

我的单元测试产生以下结果：

```
 test "factory" do
    job = Factory(:job)
    assert(job.valid?)  # => true
    assert(job.vehicles.first.valid?) # => true
    vehicle = Factory(:vehicle)
    assert(vehicle.job.vehicles.size == 1) # => true
    assert_equal(vehicle.job.vehicles.first.vin, "2") # => FALSE.  <"1"> expected but was <"2">
  end 
```

* * *

```
Factory.define :job do |f|
  ...
  f.vehicles_attributes [:vin => "1", :model => "ford", :make => "escort" ]
end

Factory.define :vehicle do |f|
  f.vin "2"
  f.model "ford"
  f.make "escort"
  f.association :job
end 
```

* * *

```
class Job < ActiveRecord::Base
  has_many :vehicles, :dependent => :destroy
  validate :job_must_have_at_least_one_vehicle
  accepts_nested_attributes_for :vehicles, :allow_destroy => :true, :reject_if => proc { |vehicle_attributes| Job.insufficient_vehicle_input?(vehicle_attributes) }

  def job_must_have_at_least_one_vehicle
    errors.add(:vehicles, "need to be added") if self.vehicles.empty?
  end

  def self.insufficient_vehicle_input?(vehicle_attributes)
    vehicle_property_keys = vehicle_attributes.keys
    vehicle_property_keys.delete('_delete')
    vehicle_property_keys.delete('is_operational')
    vehicle_property_keys.delete('has_keys')
    vehicle_property_keys.each do |attribute_to_validate|
      if(!vehicle_attributes[attribute_to_validate].nil? && !vehicle_attributes[attribute_to_validate].empty?)
        return false
      end
    end
    return true
  end
end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T21:15:11.010

这都是关于**关联缓存**的。

以下是它的工作原理：
1.`Factory(:vehicle)`构建`vehicle`对象并创建`job`记录
2\. 之后，填充`vehicle.job_id`并保存它

但是从步骤 1`vehicle.job`中指出了一个对象。 因此，您所需要的只是重新加载：`job`
`job`

```
vehicle = Factory(:vehicle)
vehicle.job.reload.vehicles.size # => 2 
```

# c# - 带有大列表的 StackOverflowException

> ID：1010535
> 
> 赞同：1
> 
> 时间：2009-06-18T02:51:20.943
> 
> 标签：c#, list

我想做一个非常简单的任务，以某种方式使程序崩溃。

我有一个包含在其中的数字列表，都是唯一的。超过某个数字，我想颠倒顺序。

示例 : 5, 16, 11, **3, 8, 4** -> 5, 16, 11, **4, 8, 3**当使用 3 作为轴心点时。

以下是我尝试过的众多方法之一。

```
private List<int> ShiftPath(List<int> oldPath, int shift)
{
    List <int> newPath = new List<int>();
    int counter = 0;
    // Start reordering
        // Forwards
    while (oldPath[counter] != shift)
    {
        newPath.Add(oldPath[counter]);
        counter++;
    }
        // Backwards
    counter = oldPath.Count - 1;
    while (oldPath[counter] != shift)
    {
        newPath.Add(oldPath[counter]);
        counter--;
    }
        // New endpoint
    newPath.Add(shift); 

    // Update

    return newPath;
} 
```

现在这行得通。它可能不是最佳解决方案，但它确实有效。我已经使用这种方法很长一段时间了，但现在我已经达到了列表中的项目数量变得非常大（超过 6,000 个）的地步。最终，在尝试向 newPath 添加内容时，我得到了 StackOverFlowException。

我 100% 确定没有像 VS 声称的无限循环。我尝试了其他方法，例如直接获取项目范围，for 和 foreach 循环而不是 while，最终都会崩溃。数据量似乎太大了。而且它只会变得更大（高达 20,000）。

证明（？）：即使这样也会使程序抛出异常： List <int> newPath = new List<int>(oldPath);

关于是什么导致这个/如何解决它的任何想法？

-从初学者。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T02:58:28.493

堆栈溢出不能出现在您向我们展示的代码中，因为那里没有递归。寻找你的代码在哪里进行递归。更好的是，当您获得 StackOverflowException 时，您得到的堆栈跟踪是什么？这将告诉您代码在递归中的哪个位置进入无限递归循环。

一个普通的旧无限循环不会导致 StackOverflowException。为此，您需要进行不结束的递归，直到您的堆栈耗尽。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T03:00:04.060

A`StackOverflowException`不会发生，因为您在 a 中有太多项目`List`（那将是`OutOfMemoryException`），当您进行太多方法调用时会发生这种情况，通常是因为递归。

附带说明一下，a 中的 6,000`int`秒`List`不算什么。我刚刚运行了一些测试代码，在我得到一个`OutOfMemoryException`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T05:39:47.280

我必须同意@Eddie - 看起来你没有向我们展示导致堆栈溢出的代码 - 你向我们展示的代码不会导致堆栈溢出。

另一种解决方案，使用 .NET 3.5：

```
class Program
{
    static void Main(string[] args)
    {
        const int where = 5;
        var aList = new List<int>();
        for (var i=0; i < 100; i++)
            aList.Add(i);

        var reversed = aList.Take(where).Concat(Enumerable.Reverse(aList)
            .Take(aList.Count - where));

        Console.WriteLine(String.Join(",",
            reversed.Select(i => i.ToString()).ToArray()));
        Console.ReadLine();
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T03:10:28.300

我可能会像这样解决这个问题：

```
List<int> reverseMe = new List<int>();
List<int> reversedList = new List<int>();

reverseMe.Add(5);
reverseMe.Add(16);
reverseMe.Add(11);
reverseMe.Add(3);
reverseMe.Add(8);
reverseMe.Add(4);

int pivotPoint = 3;

for (int c = 0; c < reverseMe.Count; c++)
{
    if (c >= pivotPoint)
    {
        reversedList.Add(reverseMe[reverseMe.Count - c + pivotPoint - 1]);
    }
    else
    {
        reversedList.Add(reverseMe[c]);
    }
} 
```

这使用了原始列表空间的两倍，但是 20k 这并不是一个真正的问题，至少对我来说它更具可读性 - 并且不应该遇到任何 StackOverflow 异常

将我的算法修改为（不像第一个那样经过测试，并且没有太多考虑到计算 for 条件的最佳方法）

```
int temp;
for (int c2 = pivotPoint; c2 < reverseMe.Count - ((reverseMe.Count - pivotPoint) / 2); c2++)
{
    temp = reverseMe[reverseMe.Count - c2 + pivotPoint - 1];
    reverseMe[reverseMe.Count - c2 + pivotPoint - 1] = c2;
    reverseMe[c2] = temp;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T15:11:52.373

感谢您的回答，它帮助我确定了问题

在此之前我确实有一个递归。但是我很肯定它不是无限的（这就是为什么我不认为这是问题所在，特别是因为它不是发生溢出的地方）。大致可以描述为：

Search(parameters)
--SomeParameters.ShiftPath
--移位有用吗？
----Yes -> Exit recursion
----No -> 我们可以移动更多吗？
------是->搜索（新参数）
------否->回溯

（搜索的效果在很大程度上取决于其他数千行代码给出的数据——尽管代码确实适用于较小的问题。）

因为在找到答案之前它可能会非常深入，我想这就是导致溢出的原因吧？所以我想我会尝试另一种方法，比如使用堆来代替：

虽然（只要需要）
--ArrayOfParameters.Last().ShiftPath
--转移有用吗？
----是 -> 退出循环
----否 -> 我们可以转移更多吗？
-------是 -> 将当前参数添加到 ArrayofParameters
-------否 -> 回溯 - 删除 ArrayOfParameters.Last()

# c++ - 在没有模板特化的情况下更改函数的返回类型。C++

> ID：1010539
> 
> 赞同：15
> 
> 时间：2009-06-18T02:52:13.280
> 
> 标签：c++, templates, return

我想知道是否可以根据分配给它的变量类型来更改函数的返回类型。这是我的意思的一个快速示例。

我想创建一个函数来解析字符串中的 int、bool 或 float 变量。例如...

```
Int value = parse("37");
Float value = parse("3.14");
Bool value = parse("true"); 
```

我知道如果我将此函数设为模板，则必须从始终为字符串的参数列表中确定变量类型。有没有其他方法可以用 c++ 做到这一点？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-06-18T03:28:39.573

这可以通过转换函数来完成

```
struct proxy {
    string str;
    proxy(string const &str):str(str) { }
    template<typename T> operator T() { 
        return boost::lexical_cast<T>(str); 
    }
};

proxy parse(string const &str) { return proxy(str); } 
```

现在你只需要做

```
float a = parse("3.1"); 
```

它应该运作良好。顺便说一句，您可以直接使用该类。我建议将其重命名为`conversion_proxy`以表明它只是正在发生的转换的代理，但它本身不进行转换

```
struct conversion_proxy {
    string str;
    conversion_proxy(string const &str):str(str) { }
    template<typename T> operator T() { 
        return boost::lexical_cast<T>(str); 
    }
};

float a = conversion_proxy("3.1"); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-06-18T03:01:34.277

我无法从您的问题中判断您是否知道这一点，但您确实可以使用模板来做到这一点。唯一的问题是，您必须在每次调用中指定要转换的类型，而不是依赖推理（因为正如您所说，参数类型将始终相同）。

```
template<typename T> T parse(const string& str) { /* do stuff for other types */ }
template<> int parse<int>(const string& str) { /* do stuff for ints */ }
template<> double parse<double>(const string& str) { /* do stuff for doubles */ }
template<> bool parse<bool>(const string& str) { /* do stuff for bools */ }
// etc. 
```

然后调用为

```
int value = parse<int>("37");
double value = parse<double>("3.14");
bool value = parse<bool>("true"); 
```

如果您已经知道这一点，请忽略此答案，但从您的问题中不清楚您是否知道这是可能的。

当然，如果您正在做的事情不是真正通用的（因此您必须专门针对要解析的每种类型），那么编写模板无论如何都不是正确的事情。

顺便说一句，您可以使用这样的单个函数非常通用地完成它（假设 parse 是您真正想要做的）：

```
#include <sstream>
template<typename T> T parse(const string& str) 
{
  T t;
  std::istringstream sstr(str);
  sstr >> t;
  return t;
} 
```

这适用于任何默认可构造、可流提取的类型，包括所有内置函数。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-18T03:21:20.257

您可以将输出参数作为指针或引用传递。

像这样：

```
template<class T> void parse(const std::string &input, T& output); 
```

然后这样的代码：

```
double d; parse(input, d);
int i; parse(input, i); 
```

应该管用。

但是，您的代码看起来非常适合 std::istringstream ，它只是：

```
istringstream is(input);
input >> d; 
```

如果你有一些复杂的格式，我很幸运的一个技巧是使用自定义操作符>>创建自定义对象来提取数据。

那么它可能是这样的：

```
istringstring is(input);
input >> LineExtracter(x, y, d); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-18T03:34:41.650

我会同意比我快一点的 litb。使用铸造运算符。

```
#include <iostream>
#include <string>
#include <sstream>

class Convertible
{
public:
    int m_Integer;
    bool m_Bool;
    double m_Double;

    Convertible() : m_Integer(0), m_Bool(false), m_Double(0.0) {};

    operator int() const
    {
        return m_Integer;
    }
    operator bool() const
    {
        return m_Bool;
    }
    operator double() const
    {
        return m_Double;
    }
};

Convertible parse(std::string data)
{
    Convertible l_result;

    std::istringstream converter(data);
    converter >> l_result.m_Integer;

    std::istringstream converter2(data);
    converter2 >> l_result.m_Bool;

    std::istringstream converter3(data);
    converter3 >> l_result.m_Double;

    return l_result;
}

void main()
{
    int l_convertedInt = parse("2");
    bool l_convertedBool = parse("true");
    double l_convertedDouble = parse("3.14");

    std::cout << "Converted '2' to " << l_convertedInt << std::endl;
    std::cout << "Converted 'true' to " << l_convertedBool << std::endl;
    std::cout << "Converted '3.14' to " << l_convertedDouble << std::endl;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T02:53:33.620

不幸的是，这是不可能的。在 C++ 中，不可能根据函数的返回值重载函数。您要么必须拥有 3 个函数，ParseInt、ParseFloat 和 ParseBool，要么使用函数模板。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T02:56:49.433

您可以返回 void* 然后根据需要转换结果。

我建议不要这样做。C++ 是一种强类型语言。这样做的好处是编译器可以比动态类型语言更早地捕获错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T03:16:28.943

不，这种行为在 C++ 中是不可能的。为了允许，它必须能够在相同的范围内定义相同名称的函数，这些函数仅在返回类型上有所不同。这在 C++ 中是不合法的。

C++ 可以做一些返回类型的特殊化，例如覆盖虚函数的协变返回类型。但它不支持您要查找的内容。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-03-09T03:31:00.850

这是我对[@Tyler McHenry 的答案](https://stackoverflow.com/a/1010569/1497596)的改编，适用于我的情况，其中的参数`parse()`是字符串以外的类型。

请注意，我发现我必须引入**模板专业化**以避免**类型转换警告**（`float`to `int`）。

（另见[现场演示](http://codepad.org/cexRUava)。）

```
#include <iostream>

struct MyUnion
{
public:
  union {
    bool bool_value;
    int int_value;
    float float_value;
  };
};

template<typename T> T parse(const MyUnion& h)
{
  T t;

  if (typeid(T) == typeid(bool)) {
    t = h.bool_value;
  } else if (typeid(T) == typeid(int)) {
    t = h.int_value;
  } else if (typeid(T) == typeid(float)) {
    // t = h.float_value; // see **Warning** below; use float specialization instead
  }

  return t;
}

// 'float' template specialization to avoid conversion warning.
template<> float parse(const MyUnion& h)
{
  return h.float_value;
}

int main()
{
  MyUnion mu1; mu1.bool_value = true;
  MyUnion mu2; mu2.int_value = 42;
  MyUnion mu3; mu3.float_value = 3.14159;

  std::cout << "As bool: "  << parse<bool>(mu1)  << std::endl;
  std::cout << "As int: "   << parse<int>(mu2)   << std::endl;
  std::cout << "As float: " << parse<float>(mu3) << std::endl;
}

// **Warning**
// In function 'T parse(const Heterogeneous&) [with T = int]':
// Line 22: warning: converting to 'int' from 'const float' 
```

# java - 目标-C。你能像 Java 接口那样使用协议吗？

> ID：1010541
> 
> 赞同：23
> 
> 时间：2009-06-18T02:52:50.690
> 
> 标签：java, objective-c

这些基本上是一样的吗？

例如，如果我有一个 Java 接口

```
public interface CoolObject{
 ...
} 
```

我可以在以 a作为参数的函数中使用任何实现`CoolObject`接口的对象：`CoolObject`

```
public void foo(CoolObject o) {
...
} 
```

这在 Objective-C 中是否相同？

```
@protocol CoolProtocol
...
@end

@interface Foo: NSObject <CoolProtocol>
...
@end

(void) - someMethod: (CoolProtocol *) obj {
} 
```

上述工作（并被认为是正确的？）

谢谢你的时间。如果您需要我澄清我的问题，请告诉我。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-06-18T03:21:46.560

关。在 Objective C 中，您表明一个对象实现了一个带有尖括号 <> 的协议，因此您可以编写如下方法之一：

```
- (void) someMethod: (id <CoolProtocol>) obj { }
- (void) someMethod: (id <NSObject, CoolProtocol>) obj { }
- (void) someMethod: (NSObject <CoolProtocol> *) obj { } 
```

在所有情况下，您都在说 someMethod 需要一个实现 CoolProtocol 的对象。

id 是指向任何类型的 Objective C 对象的通用指针。

所以 id < CoolProtocol> 的意思是“任何一种实现 CoolProtocol 的目标 C 对象”。

通常，您希望能够保留/释放/自动释放对象，并且通常将其视为常规的 Cocoa 对象，因此添加 NSObject 协议通常也很好，这就是第二种情况。

如果你想确保它实际上是一个正确的 Cocoa 对象（不包括基于 NSProxy 的对象），那么你可以使用最后一种形式，它基本上说“我想要任何实现 CoolProtocol 的真正的 Cocoa Objective C 对象”。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-06-18T17:13:41.350

彼得斯的回答很棒。不过我想补充一件事。如果您将“NSObject”协议添加到您的协议

```
@protocol CoolProtocol <NSObject>
@end 
```

这将减轻您在方法声明中声明 NSObject 协议的需要。

```
- (void) someMethod: (id <NSObject, CoolProtocol>) obj { } 
```

现在变成

```
 - (void) someMethod: (id <CoolProtocol>) obj { } 
```

# qt - 使用 OpenGL 和 Qt 进行科学可视化

> ID：1010542
> 
> 赞同：2
> 
> 时间：2009-06-18T02:52:58.630
> 
> 标签：qt, opengl, qt4, visualization, scientific-computing

我正在尝试使用 Qt 为一些科学数据编写一个 OpenGL 可视化程序。我希望能够原封不动地使用我现有的程序，并且能够简单地调用 glwidget 并告诉它在每个时间步结束时更新数据。但是，为了运行 Qt 程序，您似乎必须使用`QApplication`然后`qt.run()`阻塞 cpu。

这是伪代码

```
main()

{
    ..set up stuff
    myVisualizer = new myGLWidget();

    for(int i=0;i<1000;i++)
    {
        ..do calculations
        myVisualizer.update(new data)
    }
} 
```

我意识到我可以将所有现有代码放入 a 中`QThread`，并让它在连接到更新时发送信号。这样会更容易。有人知道如何解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T17:05:21.547

如果您真的不想研究线程解决方案，这会更好，您可以使用 0 的特殊情况超时。基本上，当您运行超时为 0 的计时器时，它会在之后运行适当的代码处理当前在事件队列中的事件。所以，你可以设置这样的东西：

```
class MyDialog : public QDialog
{
    Q_OBJECT
public:
    MyDialog()
    {
        m_step = 0;
        QTimer::singleShot( 0, this, SLOT( Process() ) );
    }

public slots:
    void Process() 
    {
        // do calculations
        m_step++;
        QTimer::singleShot( 0, this, SLOT( Redraw() ) );
        if ( m_step != 1000 )
            QTimer::singleShot( 0, this, SLOT( Process() ) );
    }

    void Redraw() { // do redrawing code here }

private:
    int m_steps;
}; 
```

然后将它与 Qt-proper 的主代码结合起来：

```
int main( int argc, char** argv )
{
    QApplication app( argc, argv );
    MyDialog dialog;
    dialog.show();
    return ( app.exec() );
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T09:07:09.753

您可以在应用程序中使用 QThread 并在单独的线程中进行计算。您要做的就是继承 QThread 并实现 run() 方法。

您可以创建一个计算器类并在该类中添加一些信号，然后将信号连接到显示小部件的更新槽（在本例中为 QGLWidget::updateGL()）。

这是一个粗略的示例：（您所要做的就是在 main() 函数中创建一个线程和 DisplayWidget 并设置线程的 DisplayWidget。）

```
class Calculator: public QObject
{
     Q_OBJECT

     public:
        Calculator();
        void start();

    signals:
        void updateDisplayWidget(/* you can put the resulting data */);
};

class DisplayWidget(): public QGLWidget
{
     Q_OBJECT
     // override paint methods here
     public slots:
          void slotUpdateDisplayWidget(/* you can receive the resulting data*/);
};

class MyThread : public QThread
{
public:
    void run();
    void setDisplayWidget(DisplayWidget* displayWidget);

private:
    Calculator mCalculator;
};

void MyThread::run()
{
     mCalculator.start();
     exec();
}

MyThread::setDisplayWidget(DisplayWidget* displayWidget)
{
    displayWidget->moveToThread(this);
    connect(&mCalculator, SIGNAL(updateDisplayWidget()), displayWidget, SLOT(slotUpdateDisplayWidget()));
} 
```

# jquery - 如何在 jQuery 中不刷新页面的情况下发布表单？

> ID：1010546
> 
> 赞同：0
> 
> 时间：2009-06-18T02:54:59.110
> 
> 标签：jquery, forms, post

我希望能够在不刷新 jquery 页面的情况下发布以下表单，并且我需要表单将信息发布到 actions.php

有人可以帮帮我吗？

```
<div id="postbox">
    <form method="post" id="ptowall">
        <input name="post" type="submit" value="Post" />
    </form>
</div> 
```

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T03:23:59.940

```
$("#ptowall").bind("submit", function() { return false; });

$.post("your-form-submit-handler", $("#ptowall").serialize()); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T02:59:03.643

您可以使用带有[Ajax 函数的](http://docs.jquery.com/Ajax)[$("form").serialize()](http://docs.jquery.com/Ajax/serialize)命令与服务器通信。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T02:56:57.577

[jQuery Form Plugin](http://malsup.com/jquery/form/)非常好用，可以满足您的需求。

# windows - Mac 客户端无法解析 Windows Home Server 名称

> ID：1010549
> 
> 赞同：1
> 
> 时间：2009-06-18T02:56:44.007
> 
> 标签：windows, svn, macos, networking, netbios

我认为这更像是一个 Mac 网络配置问题，但我不确定。

我在我的 Windows Home Server 机器上设置了 Subversion（类似于：[http](http://www.hanselman.com/blog/RunningASubversionServerOffYourWindowsHomeServer.aspx) ://www.hanselman.com/blog/RunningASubversionServerOffYourWindowsHomeServer.aspx ）。这个设置已经为我工作了几个月，使用 Windows 客户端。

现在我正在尝试添加一个 Mac 客户端，但它无法解析我的 WHS 服务器的网络名称。如果我在 Mac 上打开一个终端窗口，并尝试 ping 或使用 nslookup，我会收到一个错误，它找不到服务器。在 PC 端，我可以 ping，但 nslookup 无法解析名称，所以我假设 PC 的 ping 将名称解析为 NetBios 名称。

我在网上找到了很多文章，解释了如何根据Windows域设置默认后缀，但是Windows Home Server默认不建立域。（它处于工作组模式。）

有人有任何建议或指示吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T03:46:12.143

让这项工作快速简便的方法是在 MAC 上的主机文件中添加一个条目。您可以在 /etc/hosts 中找到该文件

编辑文件并在末尾添加一个条目，如下所示：

```
<ip address>  <hostname> 
```

例子：

69.59.196.211 www.stackoverflow.com

这就是我要走的路，他们在您发布的文章中提到使用主机文件。关于编辑不同机器的主机文件的更多信息可以在这里找到：

[http://practice.chatserve.com/hosts.html](http://practice.chatserve.com/hosts.html)

# jquery - 在 jQuery appendTo 函数之后选择一个元素

> ID：1010553
> 
> 赞同：2
> 
> 时间：2009-06-18T02:57:21.523
> 
> 标签：jquery, ajax

我需要通过 jQuery 将一组元素动态附加到 div，然后转身引用它们。你不能这样做真的很奇怪，因为如果你在 firebug 中查看 DOM，元素就在那里。jQuery 只是不像它们存在那样行事。

HTML...

```
<div id="images"></div> 
```

这给了我我的元素添加到`<div>`...

```
$.getJSON("http://localhost/wordpress/test.php",
    function (data) {
        $.each(data, function (i, item) {
            $("<img/>").attr("src", item).appendTo("#images");
        });
    }); 
```

然后我立即尝试选择和使用图像......

```
$("img").each(
    function (i, item) {
        alert(item);
    }); 
```

jQuery 不会选择任何新添加的元素。它基本上就像没有添加任何图像一样。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T03:08:40.877

我会冒险猜测，当您运行第二个代码块时，图像还不存在。getJSON 调用是异步的。这意味着您不知道它何时返回并将图像元素添加到页面。

您是否尝试在调用 appendTo 的同一函数中添加第二个代码块？当人们编写异步代码时，这是一个常见的混淆来源。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T03:09:08.770

您需要使用 jQuery 的[live 功能](http://docs.jquery.com/Events/live#typefn)，因为您的新图像在页面加载后被插入到 DOM 中。

举个简单的例子：

```
$("img").live("click", function() {
    alert(this);
}); 
```

无论何时添加，都会在页面上的每个图像上触发警报。您的典型`$("img").click()`将无法处理您附加的图像。

# javascript - 向内容编辑器添加自定义样式

> ID：1010554
> 
> 赞同：2
> 
> 时间：2009-06-18T02:57:29.603
> 
> 标签：javascript, html, css, content-management

我有标准的内容编辑器，它使用 iFrame 作为文本区域，然后执行它执行的下拉列表的 onchange：

idContent.document.execCommand(cmd,"",opt);

其中“idContent”是 iFrame。

其中一个下拉菜单应该是样式，但它执行“formatBlock”命令。

我有一个自定义样式表。有没有办法让我将我创建的样式放入此样式下拉列表中？如果没有，我可以为这些自定义样式设置另一个下拉列表，但是设置这些样式的命令名称是什么？

这是我目前正在使用的下拉列表和 javascript：

```
 <select onchange="cmdExec('formatBlock',this[this.selectedIndex].value);this.selectedIndex=0">
<option selected>Style</option>
    <option value="Normal">Normal</option>
    <option value="Heading 1">Heading 1</option>
    <option value="Heading 2">Heading 2</option>
    <option value="Heading 3">Heading 3</option>
    <option value="Heading 4">Heading 4</option>
    <option value="Heading 5">Heading 5</option>
    <option value="Address">Address</option>
    <option value="Formatted">Formatted</option>
    <option value="Definition Term">Definition Term</option>
  </select>

 function cmdExec(cmd,opt) 
    {   
    idContent.document.execCommand(cmd,"",opt);
         idContent.focus();
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T12:10:27.137

假设您在 iframe 中有一个处于 designMode 的文档，则可以将样式表链接到您当前正在编辑的文档。样式表可以包含您喜欢的样式，您可以通过更改元素 CSS 类名或包装在具有类名的 HTML 元素中来应用这些样式。但是，您将无法使用 designMode 命令应用它。您必须使用选择和范围，并手动更改 HTML 标记以应用您想要的样式。

阅读以下关于您可以应用的一般命令的文章：[https ://developer.mozilla.org/en/Midas](https://developer.mozilla.org/en/Midas)

以下文章将解释使用选择和范围的高级编辑技术： [https ://developer.mozilla.org/en/DOM/Selection](https://developer.mozilla.org/en/DOM/Selection)

[https://developer.mozilla.org/en/DOM/range](https://developer.mozilla.org/en/DOM/range)

# c# - IO 101：TextWriter、FileStream 和 StreamWriter 之间的主要区别是什么？

> ID：1010555
> 
> 赞同：43
> 
> 时间：2009-06-18T02:57:38.573
> 
> 标签：c#, .net-3.5, io, .net

如果这个问题对于你们当中的经验丰富的程序员来说可能听起来有点业余，让我首先道歉，问题是我在工作中对此有很多争论，所以我真的很想弄清楚这一点，这基本上就是我依赖的原因在stackoverflow社区上一劳永逸地解决这个问题:)

因此，一方面根据 MSDN，我们有：

> **TextWriter 类**
> 
> 表示可以编写一系列连续字符的编写器。这个类是抽象的。
> 
> **文件流类**
> 
> 围绕文件公开 Stream，支持同步和异步读写操作。
> 
> **StreamWriter 类**
> 
> 实现一个 TextWriter，用于以特定编码将字符写入流。

另一方面，很明显它们都属于 System.IO，但鉴于 MSDN 示例混合了其中的一些，我仍然没有达到非常理想的 a-ha 时刻。

任何评论将不胜感激，在此先感谢！

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-06-18T02:58:42.660

Streams 处理*字节*，Writers 处理*字符*。

字节！= 字符。一个字符可能需要超过一个字节来表示。从字符到字节的映射称为*编码*。

A`FileStream`指的是写入文件的字节，类似于 a`MemoryStream`指的是写入内存缓冲区的字节。为了将字符写入流，您需要将它们转换为字节串。这就是 a`StreamWriter`发挥作用的地方。它采用字符序列和编码，并将其转换为字节序列。

A`TextWriter`是所有 Writer 必须遵守的接口（嗯，抽象基类）。它具有基于字符的所有操作。bytes 的等价物是`Stream`抽象基类。

事情也朝着相反的方向发展。有一个`TextReader`抽象基类，描述如何从某个地方读取字符，还有一个`StreamReader`，它允许您从提供编码的面向字节的流中读取字符 - 但这次反向使用，将任何多字节序列聚合为单个适当的字符。

A`Stream`可用于读取和写入，因为字节是 I/O 操作中使用的最低级别的项目。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-18T03:15:24.607

我一直发现最好的办法就是看看它们提供了哪些方法以及如何构建它们。这几乎总是我在使用 API 时最关心的事情，如果不是唯一的话。我如何构建它，它可以做什么？

您不能实例化 TextWriter。很抽象。这告诉我它服务的唯一真正目的是抽象。如果您编写一个将任何类型的 writer 作为参数的函数，那么您很有可能应该将 TextWriter 变得更加通用。

您可以实例化一个 StreamWriter，它会按照它所说的去做，它会写入流。这意味着它需要一个流来完成任何真正的写入。但是，一旦你有了那个流，你就可以做各种巧妙的事情，比如一次写一整行，而不是像直接在流上那样处理单个字符（或者更确切地说是字节）。

所以基本上，你会得到一个流，这样你就可以将它提供给 StreamWriter（或 Reader）。如果您正在编写文本，您可能不想直接使用流，也不想使用字符数组而不是字符串。

FileStreams 可以方便地直接从 File 和 FileInfo 类实例化，在我的使用中，这就是它们通常的实例化方式。获取一个文件（我喜欢使用 FileInfo）并调用 OpenWrite()。将它传递给 StreamWriter（它只是一种 TextWriter），然后您就可以使用了。

概括：当你想找出一个类时，试着看看你是如何实例化它的以及它可以做什么。这通常会清除很多。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-06-18T03:12:45.703

“Stream”和“Writer/Reader”之间有明显的区别。

流是字节级别的表示，实际上是一个可以以多种方式实现的抽象概念。例如，您有一个 FileStream 和一个 MemoryStream。这两个都是字节流，但它们的存储方式不同。

Writers 和 Readers 为您提供了一种处理流、从中添加和提取数据的方法。

对于您的特定示例， TextWriter 是一个抽象类，可将字符顺序写入流。它有几个实现（StreamWriter、StringWriter）在不同的上下文中很有用。你会使用当时有意义的任何一个。然而，对于一些 API，所需要的只是一个 TextWriter，或者可以调用“Write”或“WriteLine”的东西。如果您的编写器用于将内容放入字符串、任意内存或文件中，这些 API 就不必担心。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2018-06-14T20:26:28.610

`Stream`是代表一系列字节的抽象基类。

*   `MemoryStream`是保存在内存中的字节流，由数组支持。

*   `FileStream`是文件中的字节流，通常由磁盘上某处的文件句柄支持。

文本字符本身由字节组成，单个字符可以是多个字节，具体取决于编码。有一些标准类使用特定的编码读取和写入文本到不同的源。

`TextWriter`是用于将文本字符写入目的地的抽象基类。

*   `StreamWriter`将文本字符（转换为字节）写入字节流。
*   `StringWriter`将文本字符写入字符串（通过 StringBuilder）。

`TextReader`是用于从源读取文本字符的抽象基类。

*   `StreamReader`从字节流中读取文本字符（从字节转换而来）。
*   `StringReader`从字符串中读取文本字符。

* * *

`Stream`, `TextWriter`,`TextReader`都是抽象基类，因此它们从不直接使用，而是通过类似上述的实现来使用。但是，您将在方法定义中看到基类，以便可以使用不同的实现，包括您自己的自定义实现（如果需要）。抽象类类似于接口，但实际上可以定义方法的逻辑，可以重用这些方法，而无需每个实现都重复相同的基本代码。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-18T03:12:23.647

[FileStream](http://msdn.microsoft.com/en-us/library/system.io.filestream.aspx)类管理获取文件的句柄并打开它以进行读取或写入以及其他文件系统功能。[BinaryWriter](http://msdn.microsoft.com/en-us/library/system.io.binarywriter.aspx)将二进制数据写入流，[StreamWriter](http://msdn.microsoft.com/en-us/library/system.io.streamwriter.aspx)将字符数据写入流。它们都可以使用 FileStream 对象将二进制或字符数据写入文件。

TextWriter 是 StreamWriter 继承自的基类。[TextWriter](http://msdn.microsoft.com/en-us/library/system.io.textwriter.write.aspx)旨在使用其 Write 方法获取类型并输出[字符串](http://msdn.microsoft.com/en-us/library/system.io.textwriter.write.aspx)。StreamWriter 的 TextWriter.Write 方法实现将字符串或字符数据写入流。BinaryWriter 不继承 TextWriter 因为它不将字符数据写入流。

# unix - Unix系统调用监视器

> ID：1010561
> 
> 赞同：4
> 
> 时间：2009-06-18T02:59:16.310
> 
> 标签：unix, debugging, monitoring, system-calls

如何监控进程的系统调用？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-18T03:00:56.947

检查[strace](http://linux.die.net/man/1/strace)

> 在最简单的情况下，strace 会运行指定的命令，直到它退出。它拦截并记录进程调用的系统调用和进程接收到的信号。每个系统调用的名称、它的参数和它的返回值都打印在标准错误或使用 -o 选项指定的文件中。
> 
> 跟踪中的每一行都包含系统调用名称，后跟括号中的参数及其返回值。

# php - 如何使用 symfony 的 use_dynamic_javascript() 助手？

> ID：1010566
> 
> 赞同：0
> 
> 时间：2009-06-18T03:00:15.433
> 
> 标签：php, frameworks, symfony1

在任何地方都没有使用示例，甚至没有关于如何使用它的说明。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T03:40:54.587

这是源代码，随心所欲。（IMO 似乎不太有用）。

```
566 /**
567  * Adds a dynamic javascript to the response object.
568  *
569  * The first argument is an internal URI.
570  * The helper automatically adds the sf_format to the internal URI, so you don't have to.
571  *
572  * @see sfResponse->addJavascript()
573  */
574 function use_dynamic_javascript($js, $position = '', $options = array())
575 {
576   $options['raw_name'] = true;
577 
578   return use_javascript(_dynamic_path($js, 'js'), $position, $options);
579 } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-29T15:17:51.760

我知道这个问题有它的年龄，但我认为我们中的许多人仍然存在这个问题:)

在把我的头撞到墙上几个小时之后，我想和你分享一些信息：P

如何在 symfony 中使用 use_dynamic_javascript()[助手](http://goodies.lemonsoftware.eu/doku.php?id=sym:dynamicjs)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-29T16:51:29.717

显然，这个助手添加了非静态（由你生成）JS 来响应。第一个参数是一个 url，就好像它被传递了一样`url_for()`。

# c# - FormsAuthentication 类 c#

> ID：1010571
> 
> 赞同：1
> 
> 时间：2009-06-18T03:03:41.480
> 
> 标签：c#, asp.net, forms-authentication

如果我调用 FormsAuthentication.SetAuthCookie("john", true)，用户名是否存储在 cookie 中？

我试图找出的是如果用户会话超时然后用户再次访问该站点，Request.IsAuthenticated 设置为 true，但用户名来自哪里？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T03:10:45.710

会话超时和身份验证超时是两个不同的东西。您可以在不使身份验证无效的情况下使会话超时。

是的，用户名存储在身份验证 cookie 中。但是，它是加密的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T03:13:10.883

您可以使用浏览器检查 cookie 的内容。例如，我的流 cookie 堆栈看起来像：

F650CE82F53D2C39C8C06B5F26EB34E20FEAC3585035E2A6E9FA30B8ECF5051F4D9C8 ....

该值是用户名和可能的用户角色的加密goo。

只要你想要，饼干就很好。它与会话无关。

在您的示例代码中，您创建了一个持久性 cookie，因此即使您关闭浏览器，它也会在 cookie 的生命周期内存在。现在，如果 cookie 是基于内存的，它会一直持续到您关闭浏览器，即使到期时间会延长它的寿命。

以下是默认值：

```
<forms loginUrl="Login.aspx"
           protection="All"
           timeout="30"
           name=".ASPXAUTH" 
           path="/"
           requireSSL="false"
           slidingExpiration="true"
           defaultUrl="default.aspx"
           cookieless="UseDeviceProfile"
           enableCrossAppRedirects="false" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T03:11:40.073

从这个[MSDN](http://msdn.microsoft.com/en-us/library/twk5762b.aspx)页面开始，如果[CookiesSupported](http://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.cookiessupported.aspx)设置为 false，它将表单身份验证票设置为 cookie 或 URL。

当您将*第二个参数*设置为 true 时，cookie 是持久的，因此当用户第二次访问时（会话超时后），您的应用程序会使用 auth-ticket 获取 cookie，因此它会获取用户详细信息（据我所知）。

如果您不想发生这种情况，我认为将第二个参数设置为 false：

```
FormsAuthentication.SetAuthCookie("john", false); 
```

或明确清除票证（以及cookie）：

```
FormsAuthentication.SignOut(); 
```

会为你工作。

# google-app-engine - 如何从本地 Google App-engine 数据存储中删除所有实体？

> ID：1010573
> 
> 赞同：33
> 
> 时间：2009-06-18T03:04:31.947
> 
> 标签：google-app-engine, google-cloud-datastore

如何删除所有实体或重置我的 dev_appserver 上的本地数据存储？我在测试时不小心递归地调用了一个函数来创建一个实体。

我在带有 Python 的 Vista 上使用 Google App-engine SDK。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-06-18T03:06:45.373

```
dev_appserver.py --clear_datastore=yes myapp 
```

请参阅[此处](http://code.google.com/appengine/docs/python/tools/devserver.html)了解更多信息。

速记版本：

```
dev_appserver.py -c 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2013-04-09T08:59:06.600

如果您来这里是为了**Java 解决方案**：删除以下文件：

`{project root}/WEB-INF/appengine-generated/local_db.bin`

重建并重新启动您的项目。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-12-20T09:02:49.553

dev_appserver.py [应用目录] --clear_datastore true

如果服务器当时正在运行，则需要关闭服务器以释放端口

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-25T15:36:32.870

一个有用的做法是始终指定--datastore_path，例如--datastore_path=test.datastore。

要删除它，您只需删除该文件即可。您还可以保留副本并将它们换入和换出。并且商店将在重新启动后持续存在（无论如何，当 /tmp/ 它在 Linux 上的默认位置被清除时）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-27T08:14:31.060

在生产中 - 您可以转到 appengine 仪表板 => 数据存储区管理员

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-03-21T15:14:01.247

这是我运行 dev_appserver 后的输出

```
INFO     2017-03-21 15:07:36,085 devappserver2.py:764] Skipping SDK update check.
INFO     2017-03-21 15:07:38,342 api_server.py:268] Starting API server at: http://localhost:63970
INFO     2017-03-21 15:07:38,349 dispatcher.py:199] Starting module "default" running at: http://localhost:8080
INFO     2017-03-21 15:07:38,373 admin_server.py:116] Starting admin server at: 
```

所以我去[http://localhost:8000](http://localhost:8000)并且我可以去我的本地 App Engine 管理控制台并编辑/删除数据存储实体。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-05-06T11:06:51.413

在生产中，这也可能派上用场（或成为安全噩梦）。

```
# will DELETE the database use http://localhost:8083/deletemodels?force=true
class DeleteModels(webapp.RequestHandler):
    def get(self):

    def dMsg(msg):
      self.response.out.write(msg + '\n')
    n = self.request.get('force')
    if n:
      dMsg('clearing YourModelHere data....')
      for uc in YourModelHere.all():
               uc.delete()
               dMsg('.')
      dMsg('clearing YouNextModelHere data....')           
      for uc in YouNextModelHere.all():
               uc.delete()
               dMsg('.') 
```

# css - Cocoa WebKit - 检测 CSS 翻转/悬停

> ID：1010574
> 
> 赞同：0
> 
> 时间：2009-06-18T03:04:58.763
> 
> 标签：css, cocoa, webkit, webview

我有一个显示 HTML 页面的 WebView，链接到一个 CSS 文件。

CSS 文件使用伪类 :active 和 :hover 来实现翻转效果。

问：如何在我的 WebView 中判断 :active 和 :hover 何时被调用？我想拦截这些调用并在 Cocoa 中以编程方式处理它们。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T03:18:34.430

:active 和 :hover 不是调用；它们是 CSS 伪类，用于 CSS 选择器。您在 CSS 中使用它们来*选择*要设置样式的元素。它们是形容词，不是动词。

尝试将 JavaScript 事件处理程序添加到元素。您可以使用 WebScriptObject 将您的一些 Cocoa 方法投影到 JavaScript 空间中，以供事件处理程序使用。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-06-18T03:13:16.360

我正在查看 2.2 SDK 文档，但在`UIWebViewDelegate`协议中看不到任何内容。实现这一目标的最大希望可能是`UIWebView`被调用的实例方法`stringByEvaluatingJavaScriptFromString`。不幸的是，这可能意味着某种轮询，因为似乎没有办法定义 JavaScript 可以为此类事件回调的 Objective-C 方法。我可能是错的，但我不认为它可以做到（在 2.2 中）。

# python - Python中的数学方程操作

> ID：1010583
> 
> 赞同：16
> 
> 时间：2009-06-18T03:07:52.627
> 
> 标签：python, math, equation

我想开发一个显示给定数学方程的 GUI 应用程序。当您单击方程中的特定变量以表示它是未知变量（即要计算）时，方程会自行转换以评估所需的未知变量。

例如：

* * *

```
a = (b+c*d)/e 
```

*假设我单击“d”表示它是未知变量。那么方程应该被重新构造为：*

```
d = (a*e - b)/c 
```

* * *

到目前为止，我只想知道如何根据用户输入重新排列给定的方程。我从我兄弟那里得到的一个建议是在后端使用前缀/后缀符号表示来评估它。

这是唯一的方法还是有更简单的建议？此外，我不仅会使用基本的数学函数，还会使用三角函数和微积分（我认为是基本的。没有偏微分等等）。我认为 pre/post-fix 符号评估可能对评估更高的数学函数没有帮助。

不过这只是我个人的看法，如有错误请指出。此外，我将使用[SymPy](http://en.wikipedia.org/wiki/SymPy)进行数学评估，因此对给定数学方程的评估不是问题，从给定的通用方程创建特定方程是我的主要问题。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-06-18T03:40:25.023

使用[SymPy](http://sympy.org/)，您的示例将如下所示：

```
>>> import sympy
>>> a,b,c,d,e = sympy.symbols('abcde')
>>> r = (b+c*d)/e
>>> l = a
>>> r = sympy.solve(l-r,d)
>>> l = d
>>> r
[(-b + a*e)/c]
>>> 
```

它似乎也适用于三角函数：

```
>>> l = a
>>> r = b*sympy.sin(c)
>>> sympy.solve(l-r,c)
[asin(a/b)]
>>> 
```

并且由于您使用的是 GUI，因此您（可能）想要从字符串来回转换为表达式：

```
>>> r = '(b+c*d)/e'
>>> sympy.sympify(r)
(b + c*d)/e
>>> sympy.sstr(_)
'(b + c*d)/e'
>>> 
```

或者您可能更喜欢将它们显示为呈现的[LaTeX 或 MathML](http://docs.sympy.org/latest/tutorial/printing.html)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-08-19T05:47:47.440

自 2009 年以来，情况确实发生了变化。我不知道您的 GUI 应用程序进展如何，但现在可以直接在 IPython qtconsole 中实现（可以嵌入到自定义 PyQt/PySide 应用程序中，并跟踪所有定义的符号，允许在单独的列表框中进行 GUI 交互等）

![在此处输入图像描述](../Images/4828ed60655fbc06deb1ee4d7e2e91c6.png)

*（使用`sympyprt`IPython 的扩展*）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-06-18T03:58:12.097

如果你想开箱即用，不依​​赖库，我认为你会发现的问题与 Python 无关。如果你想找到这样的方程，你必须描述解这些方程所必需的启发式方法。

首先，您必须表示您的方程式。怎么分开：

*   操作数：
    *   符号操作数 (a,b)
    *   数字操作数 (1,2)
*   运营商：
    *   一元运算符（-，三角函数）
    *   二元运算符（+、-、*、/）

一元运算符显然会包含一个操作数，二元运算将包含两个。

类型呢？

我认为所有这些组件都应该源自一个通用`expression`类型。这个类将有一个`getsymbols`方法来快速定位你的表达式中的符号。

然后区分一元和二元运算符，添加一些基本的补码/重排序原语......

就像是：

```
class expression(object):
    def symbols(self):
        if not hasattr(self, '_symbols'):
            self._symbols = self._getsymbols()
        return self._symbols
    def _getsymbols(self):
        """
        return type: list of strings
        """
        raise NotImplementedError

class operand(expression): pass

class symbolicoperand(operand):
    def __init__(self, name):
        self.name = name
    def _getsymbols(self):
        return [self.name]
    def __str__(self):
        return self.name

class numericoperand(operand):
    def __init__(self, value):
        self.value = value
    def _getsymbols(self):
        return []
    def __str__(self):
        return str(self.value)

class operator(expression): pass

class binaryoperator(operator):
    def __init__(self, lop, rop):
        """
        @type lop, rop: expression
        """
        self.lop = lop
        self.rop = rop
    def _getsymbols(self):
        return self.lop._getsymbols() + self.rop._getsymbols()
    @staticmethod
    def complementop():
        """
        Return complement operator:
         op.complementop()(op(a,b), b) = a
        """
        raise NotImplementedError
    def reorder():
        """
        for op1(a,b) return op2(f(b),g(a)) such as op1(a,b) = op2(f(a),g(b))
        """
        raise NotImplementedError
    def _getstr(self):
        """
        string representing the operator alone
        """
        raise NotImplementedError
    def __str__(self):
        lop = str(self.lop)
        if isinstance(self.lop, operator):
            lop = '(%s)' % lop
        rop = str(self.rop)
        if isinstance(self.rop, operator):
            rop = '(%s)' % rop
        return '%s%s%s' % (lop, self._getstr(), rop)

class symetricoperator(binaryoperator): 
    def reorder(self):
        return self.__class__(self.rop, self.lop)

class asymetricoperator(binaryoperator):
    @staticmethod
    def _invert(operand):
        """
        div._invert(a) -> 1/a
        sub._invert(a) -> -a
        """
        raise NotImplementedError

    def reorder(self):
        return self.complementop()(self._invert(self.rop), self.lop)

class div(asymetricoperator):
    @staticmethod
    def _invert(operand):
        if isinstance(operand, div):
            return div(self.rop, self.lop)
        else:
            return div(numericoperand(1), operand)
    @staticmethod
    def complementop():
        return mul
    def _getstr(self):
        return '/'

class mul(symetricoperator):
    @staticmethod
    def complementop():
        return div
    def _getstr(self):
        return '*'

class add(symetricoperator):
    @staticmethod
    def complementop():
        return sub
    def _getstr(self):
        return '+'

class sub(asymetricoperator):
    @staticmethod
    def _invert(operand):
        if isinstance(operand, min):
            return operand.op
        else:
            return min(operand)
    @staticmethod
    def complementop():
        return add
    def _getstr(self):
        return '-'

class unaryoperator(operator):
    def __init__(self, op):
        """
        @type op: expression
        """
        self.op = op
    @staticmethod
    def complement(expression):
        raise NotImplementedError

    def _getsymbols(self):
        return self.op._getsymbols()

class min(unaryoperator):
    @staticmethod
    def complement(expression):
        if isinstance(expression, min):
            return expression.op
        else:
            return min(expression) 
    def __str__(self):
        return '-' + str(self.op) 
```

设置了这个基本结构后，您应该能够描述一个简单的启发式方法来解决非常简单的方程。想想你学到的解方程的简单规则，然后把它们写下来。那应该工作:)

然后是一个非常幼稚的求解器：

```
def solve(left, right, symbol):
    """
    @type left, right: expression
    @type symbol: string
    """
    if symbol not in left.symbols():
        if symbol not in right.symbols():
            raise ValueError('%s not in expressions' % symbol)
        left, right = right, left

    solved = False
    while not solved:
        if isinstance(left, operator):
            if isinstance(left, unaryoperator):
                complementor = left.complement
                right = complementor(right)
                left = complementor(left)
            elif isinstance(left, binaryoperator):
                if symbol in left.rop.symbols():
                    left = left.reorder()
                else:
                    right = left.complementop()(right, left.rop)
                    left = left.lop
        elif isinstance(left, operand): 
            assert isinstance(left, symbolicoperand)
            assert symbol==left.name
            solved = True

    print symbol,'=',right

a,b,c,d,e = map(symbolicoperand, 'abcde')

solve(a, div(add(b,mul(c,d)),e), 'd') # d = ((a*e)-b)/c
solve(numericoperand(1), min(min(a)), 'a') # a = 1 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-18T03:26:53.587

你想做的事情并不容易。有些方程很容易重新排列（例如使`b`的主语`a = b*c+d`为`b = (a-d)/c`），而另一些则不那么明显（例如使`x`的主语为`y = x*x + 4*x + 4`），而另一些则不可能（尤其是当您使用三角函数和其他复杂情况时）。

正如其他人所说，请查看 Sage。它[做](http://sagemath.org/doc/tutorial/tour_algebra.html)你想做的事：

```
You can solve equations for one variable in terms of others:

sage: x, b, c = var('x b c')
sage: solve([x^2 + b*x + c == 0],x)
[x == -1/2*b - 1/2*sqrt(b^2 - 4*c), x == -1/2*b + 1/2*sqrt(b^2 - 4*c)] 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-18T03:16:47.850

Sage 支持符号数学。您可以只使用一些内置的方程操作函数：

[http://sagemath.org/](http://sagemath.org/)

# php - Wordpress php 致命错误：调用未定义的函数 language_attributes()？

> ID：1010586
> 
> 赞同：5
> 
> 时间：2009-06-18T03:10:12.170
> 
> 标签：php, wordpress, fatal-error

**如何修复以下错误。**

> 致命错误：调用未定义的函数 language_attributes()

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T11:18:16.620

如果您没有 wp-config.php 文件，则可能会发生这种情况。将 wp-config-sample.php 文件重命名为 wp-config.php，编辑 db-settings 并重试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T03:13:03.130

看起来您的主题要么没有正确上传，要么与您使用的 wordpress 版本不兼容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T14:52:17.840

你用的是什么版本的WP？根据我的研究，我发现 language_attributes() 函数是 WP 2.1 的一个新特性。如果您使用的 Wordpress 版本早于 2.1，那么您可以从 header.php 文件中删除函数调用或升级您的 wordpress 安装。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-11-26T20:53:23.500

出现此错误是因为该功能`language_attributes()`不可用。如果您在日志中看到它但您的站点运行正常，则可能只是有人试图直接访问您主题中的文件。

主题目录中的文件通常在 WordPress 加载后访问（使一堆功能可用，如`language_attributes()`）。如果您尝试直接访问它们，例如通过`yoursite.com/wp-content/themes/yourtheme/header.php`在您的网络浏览器中访问，您应该会看到一个空白页面，并且应该记录一个错误（例如在`error_log`文件中）。

其他文件将触发略有不同的错误，具体取决于这些文档调用的函数。在我刚刚测试过的网站上，如果我遇到`mytheme/index.php`错误`Call to undefined function get_header()...`，则会记录下来。

如果您在日志中看到此错误但没有遇到任何问题，则可能是由于某些机器人或不雅的用户在四处窥探。您可以忽略该错误（除非您有很多错误，在这种情况下，您可能需要安装一个安全插件以防万一......）

# git - 使用 Git 或 Bazaar 管理代码更容易吗？

> ID：1010588
> 
> 赞同：23
> 
> 时间：2009-06-18T03:10:40.793
> 
> 标签：git, version-control, bazaar

我正在研究 [Git](http://git-scm.com/)和[Bazaar](http://bazaar-vcs.org/)功能，想知道哪个功能更丰富的代码管理？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-06-18T07:21:47.250

我想您还阅读了[Bazaar 与 Git](http://bazaar-vcs.org/BzrVsGit)的文章，但最后，这一切都归结为*您*在“功能丰富的代码管理”方面所寻找的内容。

*   如果通过代码管理，您指的是*文件*（以及目录和重命名），请使用 Bazaar。

*   如果通过代码管理，您正在查看*内容*管理，Git 旨在管理它（例如，暂存区域允许您记录您想要提交的当前*内容*，即使您已经开始制作一些大型您最终不想在当前分支中提交的修改）

可以肯定的是，请重新阅读[Linus](http://www.gelato.unsw.edu.au/archives/git/0504/0598.html)对 Git 的最初愿景（早在 2005 年 4 月）。如果你同意它，Git 很可能会提供你想要的东西。简而言之：

*   非常简单的模型（blob-tree-commit-tag）
*   没有添加元数据（例如用于跟踪重命名）
*   “强”原则如：

    > *   “文件”无关紧要。唯一重要的是“内容”如何在树中移动
    > *   您有一个 SCM 可以跟踪真正重要的唯一级别的更改，即整个项目。在较小的粒度上，所有信息实际上都没有任何意义，因为根据定义，“项目”依赖于其他文件，否则它就不是项目

“所有项目”的概念实际上是 Git 在项目管理方面的优势和**[限制](https://stackoverflow.com/questions/984707/what-are-the-git-limits/984973#984973)**：您不应该寻求将*所有内容都*放在*一个*Git 存储库中。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-18T03:19:12.883

这将归结为个人喜好，简单明了。

我使用 Bazaar，发现它非常容易。Git 中的暂存区概念提供了一些很好的灵活性，但也增加了复杂性。你可以很容易地在 Bazaar 中使用 4 个命令（添加、提交、合并（可能是推/拉）和日志或 qlog）来管理代码，如果你想要多个分支，你只需要合并。

通常 Bazaar 似乎在做正确的事。我从来没有真正遇到过它做一些愚蠢的事情或让我做一些愚蠢的事情。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-06-18T10:26:58.657

我认为这取决于您的个人品味-两者都有争论。从 0.8 天开始，我已经将 bzr 广泛用于个人项目已有几年了，但我去年改用了 git，并且从未回头，至少在源代码管理方面。

懒得改写自己的[印象](http://cournape.wordpress.com/2008/10/30/going-away-from-bzr-toward-git/)了，总结一下：

*   bzr 跨平台工作更一致
*   bzr 更容易被发现（如果你有任何文档的工具，任何半胜任的用户都将能够使用 bzr，这对于 git 来说并非如此）
*   bzr 更容易以 API 方式扩展，git 更容易以 unix 方式（管道）扩展
*   git 是非常强大的恕我直言；特别是，我相信他们的重命名处理方法和内容跟踪方法在许多情况下都是正确的
*   bzr revno 系统不好恕我直言。它看起来更简单，但是一旦您开始拥有许多分支并更改主线，它就会变得非常混乱。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2015-04-27T19:11:19.160

Bazaar的发展已经停止。最后一个版本是 2.6，日期为 2013-08-04。自 2015 年 4 月以来，[提交的次数少于 20 次](http://bazaar.launchpad.net/~bzr-pqm/bzr/bzr.dev/changes/)。

如果您从版本控制开始，您应该考虑一个处于活动状态的版本控制（很可能是 Git 或 Mercurial）。

编辑 1：自从我的帖子发布以来，发布了 2.7 版本，但这并没有改变这个项目基本上已经死掉的事实，每年大约有 10 次提交。

编辑 2：现在有一个名为[Breezy](https://launchpad.net/brz)的集市分支，其活动比集市多。我怀疑这将成为一个真正活跃的项目，但至少这意味着该工具得到了维护（例如，它应该在 Python 2 结束后仍然存在，Breezy 的目标之一是移植到 Python 3）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-16T03:55:08.427

Bazaar 与 ubuntu 集成得很好，我已经使用 ubuntu 很多年了，厌倦了切换到其他更怪异的发行版，但没有意义。我选择 bazaar 而不是 git/mercurial 因为 bazaar 通知在 Ubuntu 中集成得非常好。此外，您还可以从 Launchpad 获得免费托管，这是一个巨大的优势。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-09T13:30:12.140

Git 做得更好的一件事就是处理大量的分支。它比 bzr 快得多，并且不需要源代码的多个副本。所有分支都在同一个目录中。我发现自己使用 git 分支比使用 bzr 更频繁，特别是因为我的 repo 不小而且还涉及二进制文件（总共 180MB）。

**编辑**：实际上，我错了。--no-trees + 轻量级结帐确实像 Git 一样工作。谢谢，FryGuy。哦，我发现[这个博客条目](http://www.taoeffect.com/blog/2009/06/using-bazaar-like-git-repoalias-plugin/)包含有用的信息。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-05-29T19:39:40.747

使用 git vs bzr/hg 的最佳理由是因为 github 很摇滚。Launchpad 还可以，但 github 的搜索、社交和风格都不错。

从技术上讲，启动板可能在许多方面都更好。合并、集成构建系统和其他功能使启动板吸引了许多人。github上的内置编辑器，要点......那里有一个启动板没有的流程。在视觉上，在社交上，没有竞争。

# maven-2 - Seam - 没有活动的事件上下文

> ID：1010602
> 
> 赞同：0
> 
> 时间：2009-06-18T03:14:54.203
> 
> 标签：maven-2, seam, jetty

我的 Seam 应用程序有问题，我不确定是因为使用 Maven 和 Jetty 进行测试，还是只是我的错误配置。我得到的错误相当简单，当 Seam 尝试关闭事件上下文时，它希望它是打开的，并且它一定已经被其他东西关闭了。问题是什么以及如何确定是什么原因造成的。

这是堆栈跟踪，但它没有多大帮助：

```
java.lang.IllegalStateException: No active event context
at org.jboss.seam.core.Manager.instance(Manager.java:368)
at org.jboss.seam.servlet.ContextualHttpServletRequest.run(ContextualHttpServletRequest.java:55)
at org.jboss.seam.web.ContextFilter.doFilter(ContextFilter.java:37)
at org.jboss.seam.servlet.SeamFilter$FilterChainImpl.doFilter(SeamFilter.java:69)
at org.jboss.seam.servlet.SeamFilter$FilterChainImpl.doFilter(SeamFilter.java:73)
at org.jboss.seam.web.HotDeployFilter.doFilter(HotDeployFilter.java:53)
at org.jboss.seam.servlet.SeamFilter$FilterChainImpl.doFilter(SeamFilter.java:69)
at org.jboss.seam.web.LoggingFilter.doFilter(LoggingFilter.java:60)
at org.jboss.seam.servlet.SeamFilter$FilterChainImpl.doFilter(SeamFilter.java:69)
at org.jboss.seam.servlet.SeamFilter.doFilter(SeamFilter.java:158)
at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1139)
at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:378)
at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)
at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)
at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765)
at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:417)
at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230)
at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)
at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)
at org.mortbay.jetty.Server.handle(Server.java:324)
at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:535)
at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:865)
at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:539)
at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212)
at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)
at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409)
at org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:520) 
```

这些是我的 WEB-INF/lib 文件夹中的所有 jars

```
-rw-r--r-- 1 walterw staff   54665 2009-03-02 19:28 activation-1.0.2.jar
-rw-r--r-- 1 walterw staff  443432 2009-03-02 19:28 antlr-2.7.6.jar
-rw-r--r-- 1 walterw staff   43033 2009-03-02 19:23 asm-3.1.jar
-rw-r--r-- 1 walterw staff 1604162 2009-03-02 19:28 axis-1.2.1.jar
-rw-r--r-- 1 walterw staff   32071 2009-03-02 19:28 axis-jaxrpc-1.2.1.jar
-rw-r--r-- 1 walterw staff  148230 2009-06-17 22:27 cglib-asm-1.0.jar
-rw-r--r-- 1 walterw staff  188671 2009-03-02 19:28 commons-beanutils-1.7.0.jar
-rw-r--r-- 1 walterw staff  571259 2009-03-02 19:28 commons-collections-3.2.jar
-rw-r--r-- 1 walterw staff  146108 2009-06-14 18:20 commons-digester-1.8.1.jar
-rw-r--r-- 1 walterw staff   71442 2009-03-02 19:28 commons-discovery-0.2.jar
-rw-r--r-- 1 walterw staff  261809 2009-03-02 19:28 commons-lang-2.4.jar
-rw-r--r-- 1 walterw staff   38015 2009-03-02 19:28 commons-logging-1.0.4.jar
-rw-r--r-- 1 walterw staff   26202 2009-03-02 19:28 commons-logging-api-1.0.4.jar
-rw-r--r-- 1 walterw staff  313898 2009-03-02 19:28 dom4j-1.6.1.jar
-rw-r--r-- 1 walterw staff   50583 2009-03-02 19:27 ejb3-persistence-1.0.2.GA.jar
-rw-r--r-- 1 walterw staff   15506 2009-03-14 11:21 FileIO-2009.3.14.jar
-rw-r--r-- 1 walterw staff  170443 2009-03-02 19:23 flickrapi-1.1.jar
-rw-r--r-- 1 walterw staff  279714 2009-03-02 19:27 hibernate-annotations-3.4.0.GA.jar
-rw-r--r-- 1 walterw staff   66993 2009-03-02 19:27 hibernate-commons-annotations-3.1.0.GA.jar
-rw-r--r-- 1 walterw staff 2266769 2009-03-02 19:27 hibernate-core-3.3.0.SP1.jar
-rw-r--r-- 1 walterw staff  119292 2009-04-03 18:41 hibernate-entitymanager-3.4.0.GA.jar
-rw-r--r-- 1 walterw staff  313785 2009-06-17 22:46 hibernate-search-3.1.1.GA.jar
-rw-r--r-- 1 walterw staff   62574 2009-03-02 19:27 hibernate-validator-3.1.0.GA.jar
-rw-r--r-- 1 walterw staff  630486 2009-06-17 22:46 hsqldb-1.8.0.2.jar
-rw-r--r-- 1 walterw staff  552514 2009-03-12 21:54 javassist-3.7.1.GA.jar
-rw-r--r-- 1 walterw staff  131456 2009-03-02 19:23 java-unrar-0.2.jar
-rw-r--r-- 1 walterw staff  134652 2009-06-13 21:46 jboss-el-1.0_02.CR4.jar
-rw-r--r-- 1 walterw staff  288761 2009-06-17 22:48 jboss-envers-1.2.1.GA-hibernate-3.3.jar
-rw-r--r-- 1 walterw staff   25589 2009-06-17 22:48 jboss-logging-log4j-2.1.0.GA.jar
-rw-r--r-- 1 walterw staff   12623 2009-06-17 22:48 jboss-logging-spi-2.1.0.GA.jar
-rw-r--r-- 1 walterw staff   16148 2009-06-13 21:46 jboss-seam-debug-2.1.2.jar
-rw-r--r-- 1 walterw staff    2507 2009-06-13 21:46 jboss-seam-jul-2.1.2.jar
-rw-r--r-- 1 walterw staff   28223 2009-06-13 21:46 jboss-seam-mail-2.1.2.jar
-rw-r--r-- 1 walterw staff  294735 2009-06-13 21:46 jboss-seam-ui-2.1.2.jar
-rw-r--r-- 1 walterw staff  312629 2009-06-14 18:20 jsf-api-1.2-b19.jar
-rw-r--r-- 1 walterw staff  302352 2009-03-02 19:23 jsf-facelets-1.1.15.B1.jar
-rw-r--r-- 1 walterw staff 1122787 2009-06-14 18:20 jsf-impl-1.2-b19.jar
-rw-r--r-- 1 walterw staff   13236 2009-03-02 19:28 jta-1.1.jar
-rw-r--r-- 1 walterw staff  367444 2009-03-02 19:28 log4j-1.2.14.jar
-rw-r--r-- 1 walterw staff  822794 2009-06-17 22:46 lucene-core-2.4.1.jar
-rw-r--r-- 1 walterw staff 1139907 2009-06-13 21:46 org.jboss.seam-jboss-seam-2.1.2.jar
-rw-r--r-- 1 walterw staff  445090 2009-03-08 20:11 quartz-1.6.1.jar
-rw-r--r-- 1 walterw staff  171921 2009-06-14 18:20 richfaces-api-3.3.1.GA.jar
-rw-r--r-- 1 walterw staff 1551810 2009-06-14 18:20 richfaces-impl-3.3.1.GA.jar
-rw-r--r-- 1 walterw staff 4160770 2009-06-14 18:21 richfaces-ui-3.3.1.GA.jar
-rw-r--r-- 1 walterw staff  102493 2009-06-17 22:48 SeamCore-2009.06.17.jar
-rw-r--r-- 1 walterw staff   16591 2009-03-02 19:24 slf4j-api-1.5.0.jar
-rw-r--r-- 1 walterw staff    8880 2009-03-02 19:24 slf4j-log4j12-1.5.0.jar
-rw-r--r-- 1 walterw staff   25814 2009-06-17 22:49 WebContent-2009.06.17.jar
-rw-r--r-- 1 walterw staff  109318 2009-03-02 19:28 xml-apis-1.0.b2.jar 
```

在此之前我有一些版本冲突实际上确实导致了问题，我只是想知道这是否可能是这些问题之一。

谢谢，沃尔特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-24T14:57:11.473

它看起来不像一个 Maven 问题。我会检查以下其中一项：

1.  您是否设置了 seam servlet 上下文侦听器？

    <listener> <listener-class>org.jboss.seam.servlet.SeamListener</listener-class> </listener>

2.  基于[这个问题](http://seamframework.org/Community/NoActiveEventContextSimpleWebApp)，您是否配置了额外的上下文过滤器？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-28T02:50:49.313

感谢您的回复。

它似乎实际上是事物的组合：

1.  我在每个 requestInitialized 和 requestDestroyed (ServletRequestListener) 中实例化 ContextualHttpServletRequest 以监控每个 Http 请求。
2.  我已经在除面孔以外的每个 URL 上配置了 ContextFilter（不是 *.xhtml 的所有内容）
3.  我的 a4j 请求出错了？我正在使用 RichFaces 并在 firebug 中看到对 /a4j 资源的请求。我根据我使用的 2.2.0.GA 版本配置了 Seam 和 RichFaces。

Jetty 解决了这个问题，但我在 Tomcat 中遇到了这些错误。我正在尝试收集 Jetty 和 Tomcat 之间可能存在的不同之处。奇怪的是，我的 ServletRequestListener 类功能正常，因为它记录了所有进入应用程序的 Http 请求，但实际上并没有提供视图，因为它抛出了一个无活动事件上下文异常。

编辑：这不适用于 Tomcat 但 Jetty 的原因是我没有捕捉到 ContextFilter 抛出的异常。我现在拥有自己的 ContextFilter，它仅在 SeamPhaseListener 尚未这样做时才尝试为当前请求创建上下文。在某些情况下，它仍然失败，这就是我需要捕获异常的原因。这是一个创可贴修复，但它现在在 tomcat 中运行良好。我猜它与 jsessionid 以及 a4j 请求的资源有关。

这对我来说足够好。

沃尔特

# maven-2 - maven cobertura 生成类

> ID：1010611
> 
> 赞同：0
> 
> 时间：2009-06-18T03:16:40.690
> 
> 标签：maven-2, cobertura

我正在使用 maven cobertura 插件生成覆盖率报告，但由于某种原因，仪器目标陷入了无限循环。

在我的类目录（名为 bin）中，会发生无限循环并创建目录`named generated-classes/cobertura/generated-classes/cobertura`......只要我让仪器目标运行，就会不断地循环。在每个 cobertura 目录中都是我的检测类。知道为什么会发生这种情况吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T03:45:11.287

你可以发布你的pom文件吗？或者至少是相关部分？您应该具有以下内容：

```
<build>
    <pluginManagement>
        <plugins>
...snip...              
            <!-- cobertura code coverage plugin -->
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>cobertura-maven-plugin</artifactId>
                <version>2.2</version>
                <configuration>
                    <formats>
                        <format>xml</format>
                    </formats>
                </configuration>
            </plugin>
            <!-- end cobertura code coverage plugin -->

        </plugins>
    </pluginManagement>
</build>

<reporting>
<plugins>
    <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>cobertura-maven-plugin</artifactId>
        <version>2.2</version>
        <configuration>
            <formats>
                <format>xml</format>
            </formats>
        </configuration>
    </plugin>
</plugins>
</reporting> 
```

另外，您是否遵循源代码的标准 Maven 目录布局？相对于源文件，您的 pom 文件在哪里，您的目录布局是什么样的？

# mysql - 稍微复杂的 MySQL 查询

> ID：1010612
> 
> 赞同：0
> 
> 时间：2009-06-18T03:16:41.080
> 
> 标签：mysql

员工 e_id first last 1 John Smith 2 Bob Smith 3 Alex Smith 4 John Doe 5 Ron Doe

```
clockpunch
e_id    time    for adjustment
1   0650    in  early
3   0710    in  late
4   0725    in  early
1   1100    lunch   ---
2   1150    in  late
2   1400    lunch   ---
4   1320    out --- 
```

我需要一个 SINGLE 查询，它将列出所有员工姓名，以及该用户早到的次数，按早到次数降序排列。这将如何完成？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T03:22:32.610

这可能有效（未经测试）

```
select first,last,count(*) from employees e, clockpunch c 
where e.e_id = c.e_id and adjustment = 'early' 
group by first,last
order by count(*) desc 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T03:23:52.623

```
 select a.first,a.last,sum(case b.adjustment when 'early' then 1 else 0 end) as ct 
from employees a, clockpunch b where a.e_id=b.e_id
    group by a.first, a.last 
```

# iphone - 使用 Interface Builder 编辑 UITableViewCell 的模式

> ID：1010615
> 
> 赞同：0
> 
> 时间：2009-06-18T03:17:01.797
> 
> 标签：iphone, cocoa-touch, uitableview

我将旧的 UITableViewCell 从以编程方式创建转换为使用 Interface Builder 和 Xib。在代码和编辑模式下实现时，我移动了单元格中的一些标签，以便为删除按钮腾出空间。当实现为 Xib 时，如何在编辑模式下更改单元格的布局？最好是动画。当然欢迎链接或教程！

如果重要的话，这适用于 3.0 SDK 应用程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T05:44:12.873

您需要获得对要移动的子视图的引用。有两种方法可以做到这一点：

1.  在 IB 中标记视图

2.  使用 IBOutlets

如果您标记要移动的子视图，您可以通过以下方式找到它：

```
[cell.contentView viewWithTag:kMyTag]; 
```

如果您选择使用 IBOutlets，您应该考虑为每个单元创建单元控制器。

可以在这里找到一个很好的教程：

[http://bill.dudney.net/roller/objc/entry/uitableview_from_a_nib_file](http://bill.dudney.net/roller/objc/entry/uitableview_from_a_nib_file)

还可以考虑将单元格逻辑移入单元格控制器并移出本教程中提到的表格视图控制器：

[http://cocoawithlove.com/2008/12/heterogeneous-cells-in.html](http://cocoawithlove.com/2008/12/heterogeneous-cells-in.html)

# java - Java：MVC 中的表单提交：最佳实践是什么？

> ID：1010616
> 
> 赞同：0
> 
> 时间：2009-06-18T03:17:44.180
> 
> 标签：java, model-view-controller, form-submit

我正在使用一个有点像 struts 的 MVC 框架。所以，假设我的应用程序中有一个“编辑商店”链接，这就是 URL 的样子：

[http://localhost:9080/test?action=editStore&storeNum=10](http://localhost:9080/test?action=editStore&storeNum=10)

现在，action 决定了我要运行的 Action（类似于 Struts Action）。这里对应的动作是：EditStoreAction。单击此按钮将打开一个弹出窗口，其中包含商店的不同属性以供编辑。

我的问题是：我如何写我的动作？在这种情况下我要写两个动作吗？

1.  将呈现 edit.jsp 的 EditStoreAction
2.  StoreSaveAction 将在用户对 edit.jsp 的呈现响应按下接受时调用。

或者我只写一个动作吗？EditStoreAction 并将表单提交到相同的操作，我会知道用户已按下接受按钮以进行提交更改。因此，我将在 Action 中执行不同的流程，它将更新保存到数据库并重定向到差异页面。

这里最好的做法是什么？创建尽可能多的动作，因为它保持代码模块化？或者只写一个动作来处理jsp中的一切？

我知道这个问题听起来有点微不足道，但是，有时您只想把所有事情都做好。因此，问题。感谢你的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T04:51:10.603

这个想法类似于 Spring MVC，将您的操作映射到特定类的方法，比如控制器。

因此，在您的情况下，这两个操作将映射到同一类的两个不同方法上。你可以调用类`StoreFormController`和两个方法，`editStore()`和`saveStore()`。

如果您为每个实体制作两个控制器，那就更好了。可能一个用于所有 GET 请求，另一个用于 POST 请求。因此，在您的情况下，将有两个控制器`StoreController`用于所有其他请求和`StoreFormController`所有表单提交，即发布请求。现在，您的第一个操作是 GET 将转到`editStore()`方法`StoreController`，而第二个是 POST 请求将转到`saveStore()`方法`StoreFormController`。您可以根据请求类型在这两个类中的任何一个中定义任意数量的方法。

如果你知道 Spring MVC API，你可以很容易地看到我来自哪里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T04:19:00.490

我喜欢使用 struts DispatchAction 类，因为我可以在动作类（“执行”）方法中定义多个方法。在后台，它所做的只是找到它必须执行的方法（在表单中提交或在 URL 中传递），使用反射找到方法，使用正确的参数集调用它（方法必须具有相同的“执行”方法的签名），获取结果并传递。DispatchAction 只是重写 Action 类的“执行”方法来实现该行为。

话虽如此，在您的情况下，我将只定义一个类 - 比如说“DispatchStoreAction”，我将定义两种方法，可能是“准备”和“保存”。我喜欢这样做，因为我仍然有一个很好的类抽象（并且你没有将你正在执行的“动作”放在类名中），因为你的方法可以清楚地识别它们应该做什么，而且因为，根据定义，动作类往往很小。您可能会在某处定义“StoreLogic”或“StoreBusiness”，并且此类将处理与您正在处理的实体相关的业务逻辑。我个人认为如果你有一个“StoreAction”然后一个“StoreLogic”、一个“UserAction”和一个“UserLogic”会很好

检查 DispatchAction 类的源代码以了解如何执行此操作的想法，但实现应该是微不足道的。

# c# - 将对象传递给 UITypeEditor

> ID：1010617
> 
> 赞同：5
> 
> 时间：2009-06-18T03:18:10.513
> 
> 标签：c#, propertygrid, uitypeeditor

我目前希望使用 PropertyGrid 来允许用户编辑我的一些类，但是我在将对象传递给他们使用的 UITypeEditor 时遇到了困难。当用户按下下拉菜单时，我想显示一个已加载纹理的列表框以供选择，如果他们想使用应用程序尚未加载的纹理，他们可以单击一个按钮从文件对话框中选择一个。如果我在这里没有意义，请模拟以下形式：

![下拉图片](../Images/dcb233486d0cd86a4caaba5532c5fac7.png).

**我的问题：**要填充列表框，我需要访问管理 UITypeEditor 中资源列表的类。

现在我已经为我自己的类解决了这个问题，方法是在创建它们的管理对象时给它们一个参考。然后，在 UITypeEditor 中，我使用该引用来访问我需要的内容。但是我不能为我没有写过的类做这个，比如 XNA Texture2D 类。

以下是我使用的类的样子：

```
class StaticGeometryChunk
{
    // Geometry data to draw with. Contains a reference to its managing 
    // class for use in its UITypeEditor.
    public GeometryData { get; set; }
    ....
}

class Material
{
    // These are XNA classes. I can't just add a reference to its managing 
    // class (I think?).
    public Texture2D Texture1 { get; set; }
    public Texture2D Texture2 { get; set; }
    ....
} 
```

我一直在研究我的选择，它们似乎是：

1.  使管理类静态。

我真的不想这样做。由于每种资源的加载方式不同，因此有几个管理类。还有一些类需要在这些之前创建并传入。

2.  将管理类设为单例。

我也不想这样做。这似乎是一种“隐藏”问题而不是“解决”问题的快速而肮脏的方式。我也可能希望将来有几个管理类，单例会消除这些类。

3.  创建一个包含对管理类及其目标（例如 XNA Texture2D）的引用的包装类。

这就是我目前正在考虑做的事情。它会非常简单快捷地完成，但它的一些事情让我烦恼，但我不知道是什么。

关于将我需要的内容传递给 UITypeEditor 的上述方法或其他方法有什么想法吗？

感谢您的阅读。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-18T12:20:33.357

在 EditValue 方法中，您将获得一个上下文。使用 context.Instance 访问包含您的属性的对象。此对象还应包含一个属性，使您可以访问要显示的内容列表。例如，您可以测试 context.Instance 是否为 ITextureProvider，然后对其进行转换并访问纹理。不确定这在您的设计中是否有意义，但请告诉我。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-05-19T10:44:47.163

作为替代方案，您可以尝试以下方法。我觉得它非常优雅，因为它不需要在对象中存储可用属性值的列表。因此，例如，您可以在一个表单上显示一组值，而在另一个表单上显示另一组值。

1.  创建一个接口 IYourDataProviderService。
2.  创建 IYourDataProviderService 的实现，它知道要提供的具体数据。
3.  创建一个实现 ISite 的类。在 GetService() 方法中，如果 serviceType 参数是 typeof(IYourDataProviderService)，则返回实现 IYourDataProviderService 的类的实例。我留下了其余的 ISite 方法抛出 NotImplementedException（DesignMode 属性除外），对我来说它有效，但这可能不是一个理想的解决方案。
4.  在“加载”事件处理程序中，将您的实现分配给您的 propertygrid 的 Site 属性。
5.  享受！

# javacc - 有人有 javacc 教程的链接吗？

> ID：1010621
> 
> 赞同：17
> 
> 时间：2009-06-18T03:21:20.697
> 
> 标签：javacc

在网上很难找到这种文件。

我在JAVAWORLD找到了一个，但是这个不包括jjTree和visitor的。

有没有人碰巧有一些教程的链接？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-18T04:26:34.577

已经有一段时间了，但我发现[本教程](http://web.archive.org/web/20060714170209/http://www-128.ibm.com:80/developerworks/db2/library/techarticle/dm-0401brereton/index.html)对以前的项目非常有帮助。我能够在几天内为我们的应用程序创建一种查询语言，而以前基本上没有使用 javacc 的经验。

我还没有读过它，但是在寻找其他教程时，我也找到[了这个](http://web.archive.org/web/20160112091616/http://www.ibm.com/developerworks/xml/library/x-javacc1.html)。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-23T17:57:45.890

[您可以在我的 JavaCC 书籍的网站上](http://generatingparserswithjavacc.com/)找到我针对各种 JavaCC/JJTree 主题撰写的大量博客文章。那里有很多东西——使用 JavaCC 解析二进制数据、基于 JavaCC 的语法高亮显示、使用 JavaCC 解析固定宽度数据等。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-08-03T12:19:54.767

我发现了一个很棒的教程！！！它让你开始做一个简单的加法器，然后是计算器。它绝对可以帮助您理解 JavaCC 的结构和语法！

[http://www.engr.mun.ca/~theo/JavaCC-Tutorial](http://www.engr.mun.ca/~theo/JavaCC-Tutorial)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-07-28T03:09:24.737

[FAQ](http://www.engr.mun.ca/~theo/JavaCC-FAQ/)中有书籍、文章和教程的列表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-01T20:43:11.120

这就是为什么我最终不喜欢使用 javacc 的类的主要原因，甚至工作人员也无法弄清楚其中的一些错误/消息。似乎任何人使用更标准的东西都会好得多，比如 flex & bison。

# iphone - NSAutoreleasePool 跨方法携带？

> ID：1010629
> 
> 赞同：1
> 
> 时间：2009-06-18T03:23:14.233
> 
> 标签：iphone, objective-c, cocoa, memory-management, autorelease

我正在构建一个 iPhone 应用程序，我在其中分离一些线程以在后台执行长时间运行的工作，以免挂起 UI。我知道线程需要 NSAutoreleasePool 实例来进行内存管理。我不确定线程​​方法是否调用另一个方法 - 该方法是否还需要 NSAutoreleasePool？

示例代码：

```
- (void)primaryMethod {
    [self performSelectorInBackground:@selector(threadedMethod) withObject:nil];
}

- (void)threadedMethod {
    NSAutoreleasePool *aPool = [[NSAutoreleasePool alloc] init];

    // Some code here

    [self anotherMethod];

    // Maybe more code here

    [aPool drain];
}

- (void)anotherMethod {
    // More code here
}
```

我问的原因是我收到的错误是对象正在自动释放而没有适当的池，并且“只是泄漏”。

我已经看到人们根本没有自动释放池的其他问题，我理解为什么需要自动释放池。我特别想知道在（在本例中）创建的自动释放池是否`threadedMethod`适用于在`anotherMethod`.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T05:13:47.373

要回答您的问题，是的，anotherMethod 正在使用您在 threadedMethod 中创建的 NSAutoreleasePool，当 aPool 被释放/耗尽时，您自动释放的任何东西都会被释放。

因此，您的错误不太可能直接源于此代码（除非还有更多事情发生）。

在 _NSAutoreleaseNoPool 上放置一个断点（在 Breakpoints 窗口中按名称添加它）并在调试器中运行您的代码，它会在没有池的情况下调用 autorelease 时停止，这应该可以解决您的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-12T05:42:34.550

在您的示例中，是的， NSAutoreleasePool 跨方法进行，因为调用`[self anotherMethod]`嵌套在 -`(void)threadedMethod`中。

*   Q: NSAutoreleasePool 跨方法携带？
*   答：这取决于：
    1.  跨嵌套调用，是的。
    2.  在兄弟调用中，没有。

无论如何，`NSAutoreleasePool`当父范围消失时，实例本身就会超出范围。*- 在您的示例中，在`-(void)threadedMethod { }`*.

前面提到的文章（[http://thegothicparty.com/dev/macos/nsautoreleasepool/](http://thegothicparty.com/dev/macos/nsautoreleasepool/)）对此非常清楚。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-18T03:28:43.147

自动释放池确实会传递给另一个方法。但是，当您的线程函数结束时，您应该调用 [aPool release] 而不是 [aPool drain]。它们大致相同，但 aPool 释放会导致 NSAutoreleasePool 释放自身以及池中的所有其他对象。当您的线程函数在调用 drain 后结束时，自动释放池的保留计数仍然为 +1！奇怪的是，“刚刚泄漏”的对象是 aPool！

编辑：

吉姆普尔斯关于释放和排水是等价的是正确的。Apple 文档明确表示它们在非垃圾收集环境中是相同的，并且在垃圾收集的情况下排水效果更好。不阅读文档是我的错！

这是一篇介绍 NSAutoreleasePools 的一般概述的文章 - 它应该可以帮助您指出正确的方向。由于有一个自动释放池的虚拟堆栈，因此最上面的一个将在您的应用程序中的任何地方使用 - 无论对象在哪里被自动释放。

[http://thegothicparty.com/dev/macos/nsautoreleasepool/](http://thegothicparty.com/dev/macos/nsautoreleasepool/)

# c# - 强制链接到 mp3 文件以下载/另存为

> ID：1010636
> 
> 赞同：2
> 
> 时间：2009-06-18T03:25:13.060
> 
> 标签：c#, javascript, html

我的网站上有 mp3 文件的链接（普通`<a href="file.mp3">`标签）。

但是对于许多安装了*Apple Quicktime*的用户来说，当您单击链接时，它将打开 mp3 文件而不是“保存”它们。

您可以强制浏览器保存链接而不是使用浏览器首选项吗？

我可以使用 JavaScript 或 C# .NET，如果可能的话，我正在寻找一个简单的解决方案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T03:54:52.470

您需要设置一个 http 标头，其中“Content-Disposition”设置为“附件”。这将强制浏览器弹出保存对话框。[873207](https://stackoverflow.com/questions/873207/force-download-of-a-file-on-web-server-asp-net-c)在 C# 中有一种简洁的方式来执行此操作。

**但是**，就像[Pax](https://stackoverflow.com/questions/1010636/force-link-to-mp3-files-to-download/1010643#1010643)说的那样，默认情况下您可能不应该这样做。一个很好的方法是提供一个正常的文件链接（你正在做的方式），并在它旁边提供一个辅助链接来强制保存对话框。这样一来，您就可以让“不太有天赋”的用户进行简单的点击保存操作，并让其他所有用户对 mp3 做任何他们想做的事情。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-01-03T00:46:48.097

**这是一个相当过时的问题，我不确定以这种方式做事是否有任何问题，但我最近遇到了一个问题，我想我会发布我最终用作解决方案的内容。**

将此作为 php 文件（例如 downloadmusicfile.php）保存在与您的音乐相同的文件夹中：

```
<?php
$filename = $_GET['file'];
if (isset($filename))
{
// Prevents access to something that is not in the same directory as this script
if(substr_count($filename,"/") > 0)
{
die('This should not happen.');
};
$len = filesize($filename);
header('Pragma: public');
header('Expires: 0');
header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
header('Cache-Control: public');
header('Content-Description: File Transfer');
header('Content-Type: application/force-download');
header('Content-Disposition: attachment; filename='.$filename);
header('Content-Transfer-Encoding: binary');
header('Content-Length: '.$len);
readfile($filename);
}
else
{
die('No file specified.');
};
?> 
```

然后像这样链接到文件：

```
<a href="downloadmusicfile.php?file=song.mp3">Link Name</a> 
```

当用户单击/左键单击下载链接时，这会强制出现“另存为”框。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-18T03:39:19.083

只需将[Content-Disposition](http://classicasp.aspfaq.com/general/how-do-i-prompt-a-save-as-dialog-for-an-accepted-mime-type.html)标题添加到您的页面！

这是一个简单的 .htaccess 规则来做到这一点：

```
<FilesMatch "\.mp3$">
Header set Content-Disposition attachment; filename=downloaded.mp3
</FilesMatch> 
```

这样做的缺点是您下载的文件将在“另存为”对话框中具有相同的名称。这可能在没有文件名部分的情况下工作，但我还没有测试过。（尽管我也没有测试其余部分......;P）

**编辑：**此外，如果您有可用的服务器端脚本，您可以使用它来获取文件的名称并设置 Content-Disposition 标头。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-03-01T23:49:31.673

它适用于许多浏览器，但不适用于 Safari 或 IE：使用 HTML5 的下载属性

`<a href="/audio/myfile.mp3" download>`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T03:30:38.337

我认为你不能轻易做到这一点。此外，您*不应该这样*做。这台机器属于用户，如果他们更愿意流式传输您的 MP3 而不是下载它们，这是他们的决定。

我自己的解决方案是为人们提供一个链接，让他们抱怨他们是流式传输而不是下载的（嗯，抱怨*任何事情*，真的），并让社区（包括你自己）提供解决方案。

然后，如果有人说它似乎总是在播放而不是下载，您可以与他们一起确定他们正在使用 Firefox 和 QuickTime，并告诉他们可以右键单击另存为或重新配置 Firefox。

我会说会有*一些*方法可以实现这一点，例如更改向下发送的 MIME 类型或文件名，但我认为这应该在用户的控制之下。无论如何，一个坚定的用户可以很容易地重新配置他们的浏览器，以流式传输您决定使用的任何 MIME 类型，因此您仍然无法保证。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T03:36:13.770

绝对强制它是不可能的，但您可以尝试将该行添加到您的 apache 配置中：

```
AddType application/random-fake-type .mp3 
```

据我了解，IE 会查看请求并尝试猜测 MIME 类型，因此上述解决方法不会真正起作用。您也可以编写一个脚本来为您处理这个问题，就像这个类似的[php 脚本一样。](http://elouai.com/force-download.php)

# c# - 从 C# 中的画笔集合中选择随机画笔的最佳方法是什么？

> ID：1010638
> 
> 赞同：6
> 
> 时间：2009-06-18T03:27:26.970
> 
> 标签：c#, collections, select, brush

从 C# 中的 System.Drawing.Brushes 集合中选择随机画笔的最佳方法是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-18T03:36:51.770

如果你只想要一个随机颜色的实心刷子，你可以试试这个：

```
 Random r = new Random();
    int red = r.Next(0, byte.MaxValue + 1);
    int green = r.Next(0, byte.MaxValue + 1);
    int blue = r.Next(0, byte.MaxValue + 1);
    System.Drawing.Brush brush = new System.Drawing.SolidBrush(Color.FromArgb(red, green, blue)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-07-01T13:37:56.357

对于 WPF，使用反射：

```
var r = new Random();
var properties = typeof(Brushes).GetProperties();
var count = properties.Count();

var colour = properties
            .Select(x => new { Property = x, Index = r.Next(count) })
            .OrderBy(x => x.Index)
            .First();

return (SolidColorBrush)colour.Property.GetValue(colour, null); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-06-15T09:54:42.800

我建议获取足够的示例画笔列表，并从中随机选择。

仅仅获得一种随机颜色会产生糟糕的颜色，您可以轻松设置一个可能有 50 种颜色的列表，然后每次需要随机颜色时都可以使用这些颜色。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T03:33:10.623

一个明显的方法是生成一个随机数，然后选择相应的画笔。

# java - registerNatives() 方法有什么作用？

> ID：1010645
> 
> 赞同：78
> 
> 时间：2009-06-18T03:30:57.103
> 
> 标签：java, c, object, methods, java-native-interface

java中`registerNatives()`Object类的私有静态方法有什么作用？

* * *

## 回答 #1

> 赞同：121
> 
> 时间：2009-06-18T12:40:19.183

其他答案在技术上是正确的，但对于没有 JNI 经验的人来说不是很有用。:-)

通常，为了让 JVM 找到您的本机函数，它们必须以某种方式命名。例如，对于`java.lang.Object.registerNatives`，对应的 C 函数被命名为`Java_java_lang_Object_registerNatives`。通过使用`registerNatives`（或者更确切地说，JNI 函数`RegisterNatives`），您可以随意命名您的 C 函数。

这是相关的 C 代码（来自 OpenJDK 6）：

```
static JNINativeMethod methods[] = {
    {"hashCode",    "()I",                    (void *)&JVM_IHashCode},
    {"wait",        "(J)V",                   (void *)&JVM_MonitorWait},
    {"notify",      "()V",                    (void *)&JVM_MonitorNotify},
    {"notifyAll",   "()V",                    (void *)&JVM_MonitorNotifyAll},
    {"clone",       "()Ljava/lang/Object;",   (void *)&JVM_Clone},
};

JNIEXPORT void JNICALL
Java_java_lang_Object_registerNatives(JNIEnv *env, jclass cls)
{
    (*env)->RegisterNatives(env, cls,
                            methods, sizeof(methods)/sizeof(methods[0]));
} 
```

（注意它`Object.getClass`不在列表中；它仍会以 的“标准”名称调用`Java_java_lang_Object_getClass`。）对于列出的函数，相关的 C 函数如表中所列，这比编写一堆转发函数更方便。

如果您将 Java 嵌入到 C 程序中并希望链接到应用程序本身（而不是共享库中）的函数，或者正在使用的函数没有以其他方式“导出”，那么注册本机函数也很有用，因为这些标准方法查找机制通常不会找到。注册本机函数也可用于将本机方法“重新绑定”到另一个 C 函数（例如，如果您的程序支持动态加载和卸载模块，则很有用）。

我鼓励大家阅读[JNI 的书](http://www.informit.com/store/java-native-interface-programmers-guide-and-specification-9780201325775)，其中谈到了这一点以及更多内容。:-)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-11-07T00:09:28.663

可能有点令人困惑的是，上`java.lang.Object.registerNatives`一个答案中显示的代码只是如何注册本机函数的*示例。*这是（在 OpenJDK 的实现中）为类 Object 注册本机函数的代码。要为您自己的类注册本机函数，您必须`RegisterNatives`从您自己的库中的本机代码调用 JNI 函数。这听起来可能有点循环，但有几种方法可以打破循环。

1.  遵循类 Object 的这个实现的例子：

    一种。在您的 Java 类中，声明一个名为`registerNatives`（或任何其他名称。没关系）的本机方法（最好是静态的）。

    湾。在您的本机代码中，定义一个名为 的函数`Java_<your fully qualified class name>_registerNatives`，其中包含对 JNI 函数的调用`RegisterNatives`。

    C。确保在您的 Java 代码中，您的 Java`registerNatives`方法在调用其他本机方法之前被调用。

或者

2.  采用`JNI_OnLoad`

    一种。在您的本机库中定义一个函数`jint JNI_OnLoad(JavaVM *vm, void *reserved)`。在此函数的主体中，调用 JNI 函数`RegisterNatives`。

    湾。`JNI_OnLoad`当您的本机库由 加载时，Java VM 将自动查找并调用`System.loadLibrary`，您应该已经在调用它，可能在您的类的静态初始化程序中。（您可以`env`通过调用指针指向`GetEnv`的表中的函数来获得所需的指针`vm`。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-09-21T03:23:50.377

它用于这样的场景：

C 或 C++ 用作主机，Java JVM 用作客户端。（C加载`jvm.dll`并使用`JNI_CreateJavaVM`创建JVM）

当java代码需要调用host的C函数时，如果仍然使用jni dll( `System.loadLibrary("foo.dll");`)绑定native java方法，dll的内存空间和C host的内存空间是不一样的。（如果您调用的函数*与主机状态无关*，它仍然有效，但您无法以这种方式访问​​主机的状态值）

在这里，您需要使用`env->RegisterNatives()`at host 将主机的 C 函数注入（绑定、公开、导出）到 JVM。

# mysql - MySQL - 将数字转换为英文表示

> ID：1010646
> 
> 赞同：1
> 
> 时间：2009-06-18T03:31:22.033
> 
> 标签：mysql, formatting

有没有一种特别简单的方法可以使用 MySQL 将“21.08”之类的数字转换为“21 和 08/100”？

我知道在 Oracle 中有一个技巧可以用来处理 Julian 日期。它可以在一行左右完成工作，但它似乎在 MySQL 中不起作用（因为它不支持 Julian 日期）。

在“真正的”编程语言中，这不是一个特别困难的问题，但将其写成存储过程或函数的想法是可怕的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T19:46:28.600

好奇为什么你在数据库层而不是在表示层这样做......

如果你真的，真的想用 MySQL 做这个，你可以创建两个查找表，例如“ones”和“tens”，它们存储英文表示，然后对每个数字执行查询。通过将数字转换为字符串并从小数点向后迭代来提取数字，然后在适当的表中执行查找。也许第三个表可用于提供诸如“Hundred”、“Thousand”等字符串。

这是我能看到的最直接的解决方案，但是写起来会很痛苦，而且在国际化方面可能会很脆弱。此外，它会使架构与与您的数据没有任何关系的查找表变得混乱。

也许编写一个[用户定义函数 (UDF)](http://dev.mysql.com/doc/refman/5.1/en/adding-udf.html)会是一个更好的解决方案，尽管我想它仍然会非常耗时。

# database - 将图像（jpg、gif、png）存储在文件系统或数据库中？

> ID：1010652
> 
> 赞同：3
> 
> 时间：2009-06-18T03:34:40.713
> 
> 标签：database, configuration, image, filesystems

> **可能的重复：**
> [哪个更安全：文件系统还是数据库？](https://stackoverflow.com/questions/1010589/which-is-more-secure-filesystem-or-database)
> [用户图像 - 数据库与文件系统存储](https://stackoverflow.com/questions/585224/user-images-database-vs-filesystem-storage)
> [在数据库或系统文件中存储图像？](https://stackoverflow.com/questions/766048/store-image-in-database-or-in-a-system-file)

我无法决定我应该跟随哪一个。大家能给点意见吗？我应该将图像存储在文件系统还是数据库中？（我想防止别人盗用我的图片）

当您回答这个问题时，请包括安全性、性能等方面的比较。

谢谢。

* * *

**完全重复：** [用户图像：数据库或文件系统存储？](https://stackoverflow.com/questions/585224/user-images-database-vs-filesystem-storage)
**完全重复：** [在数据库中存储图像：是还是不是？](https://stackoverflow.com/questions/3748/storing-images-in-db-yea-or-nay)
**完全重复：** [我应该将图像存储在数据库还是文件夹中？](https://stackoverflow.com/questions/713243/should-i-store-my-images-in-the-database-or-folders)
**完全重复：** [您会将二进制数据存储在数据库还是文件夹中？](https://stackoverflow.com/questions/662488/would-you-store-binary-data-in-database-or-in-file-system)
**完全重复：** [将图片存储为文件或网络应用程序的数据库？](https://stackoverflow.com/questions/561447/store-pictures-as-files-or-in-the-database-for-a-web-app)
**完全重复：** [存储少量图像：blob 还是 fs？](https://stackoverflow.com/questions/325126/storing-a-small-number-of-images-blob-or-fs)
**完全重复：** [将图像存储在文件系统或数据库中？](https://stackoverflow.com/questions/766048/store-image-in-database-or-in-a-system-file)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-18T03:38:17.137

将图像移入数据库并编写代码以提取图像可能比它的价值更麻烦。这一切都将回到围绕保护图像需求或性能需求的业务需求。

我建议坚持在数据库中存储文件路径或目录位置并将文件保存在磁盘上的久经考验的真实系统。原因如下：

*   文件系统更容易维护。必须对图像的结构和组织进行一些思考。即每个客户的目录，每个[Attribute-X] 的子目录和每个[Attribute-Y] 的另一个子文件夹。在一个目录中保留太多图像最终会减慢文件访问速度（即数十万）
*   如果存储在数据库中的想法是针对文件系统丢失的对策（即磁盘出现故障或目录被意外删除），那么我会反驳以下建议，即当您使用源代码控制时，它不是检索任何丢失/丢失/删除文件的问题。
*   如果您需要扩展并迁移到内容分发场景，则必须移回文件系统或执行大量提取以推送给提供者。
*   这也符合俗语：“将结构化数据保存在数据库中”。Microsoft 有一篇关于[管理非结构化数据](http://www.microsoft.com/sqlserver/2008/en/us/wp-sql-2008-manage-unstructured.aspx)的文章。
*   如果安全是一个需要解决的问题，那么文件系统就有一个带有 ACL 的完整结构。在安全方面重新发明轮子可能超出了业务需求的范围。

也可以在以下位置找到有关此主题的大量讨论：

*   [问题 3748](https://stackoverflow.com/questions/3748/storing-images-in-db-yea-or-nay)
*   [问题 561447](https://stackoverflow.com/questions/561447/store-pictures-as-files-or-in-the-database-for-a-web-app)

将您的图像存储为`varbinary`某种类型的 blob（取决于您的平台），我建议这比它的价值更麻烦。您需要扩展的工作意味着您必须维护、单元测试和防御缺陷的更多代码。

如果您的环境可以支持 SQL Server 2008，那么您可以在 SQL 2008 中使用新的 FileStream 数据类型两全其美。

*   一篇 MSDN 文章将[SQL 2008 中的 FileStream 数据类型](http://msdn.microsoft.com/en-us/library/cc949109(loband).aspx)吹捧为高性能。
*   [SQL Skills 有一篇很棒的文章，其中包含一些 SQL 2008 Filestream 性能测量](http://www.sqlskills.com/blogs/paul/post/SQL-Server-2008-FILESTREAM-performance.aspx)。
*   这是一篇针对[varbinary 与 FileStream 以及两种数据类型的性能的](http://coolthingoftheday.blogspot.com/2009/01/sql-server-varbinary-vs-filestream-code.html)文章。
*   如果您是 SQL Mag 订阅者，您可以[在 SQL Mag 上看到一篇关于 SQL 2008 FileStream 的精彩文章](http://www.sqlmag.com/Article/ArticleID/101388/sql_server_101388.html)。
*   [微软研究院文章：To Blob or Not To Blob](http://research.microsoft.com/apps/pubs/default.aspx?id=64525)

我很乐意看到在 Flickr 或 Facebook 等大型用户群的真实场景中进行的研究。

同样，这一切都可以追溯到您的业务需求。祝你好运！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T03:44:40.647

就防止“盗窃”而言，将它们存储在哪里并不重要。如果您将字节流传送到浏览器，任何人都可以截获并保存它。没有办法阻止这种情况（我假设您正在谈论将图像传送到浏览器）。

如果您只是在谈论保护机器本身上的图像，那也没关系。操作系统可以像数据库一样安全地锁定，防止任何人获取图像。

在性能方面（将图像呈现给浏览器时），我个人认为从文件系统提供服务会更快。无论如何，您必须在单独的 HTTP 事务中呈现图像，这几乎肯定需要多次访问数据库。我怀疑（尽管我没有硬数据）将图像 URL 存储在数据库中指向文件系统上的静态图像会更快 - 然后获取图像的行为是由 Web 服务器打开的简单文件，而不是而不是运行代码来访问数据库。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-18T03:45:11.583

您可能必须得到一大堆“但文件系统*是*数据库”的答案。这不是其中之一。

文件系统选项取决于许多因素，例如，服务器是否对目录有写入权限？（是的，我见过 apache 无法写入 DocumentRoot 的服务器。）

如果您想要跨平台 100% 的交叉兼容性，那么数据库选项是最好的选择。它还可以让您存储与图像相关的元数据，例如用户 ID、上传日期，甚至是同一图像的替代版本（例如缓存的缩略图）。

不利的一面是，您需要编写自定义代码来从数据库中读取图像并将它们提供给用户，而任何标准的 Web 服务器只会让您按原样发送图像。

但是，当涉及到底线时，您应该只选择适合您的项目和服务器配置的选项。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-18T11:04:37.193

这取决于您希望处理多少图像，以及您必须对它们做什么。我有一个应用程序需要每天临时存储 100K 到几百万张图像。我将它们以 2gb 的连续块写入文件系统，将图像标识符、文件名、起始位置和长度存储在数据库中。

为了检索，我只是将索引保存在内存中，文件以只读方式打开并来回寻找以获取它们。我找不到更快的方法来做到这一点。它比查找和加载单个文件要快得多。一旦您将许多单个文件转储到文件系统中，Windows 可能会变得非常慢。

我想它可能有助于安全性，因为如果没有索引数据，图像会有点难以检索。

对于可扩展性，将 Web 服务放在它前面并在多台机器上分发它不会花费很长时间。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-18T04:10:50.110

将它们存储在 FileSystem 中，将文件路径存储在 DB 中。

当然，您可以使其可扩展和分布式，您只需要保持图像目录在它们之间同步（对于 JackM）。或者使用连接到多个 Web 前端服务器的共享存储。

无论如何，偷窃部分已在您的其他问题中涵盖，基本上是不可能的。可以访问图像的人将始终能够（或多或少地）将它们保存在本地……即使这意味着“打印屏幕”并粘贴到 Photoshop 中并保存。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T03:48:37.113

如果您希望您的应用程序具有可扩展性，请不要在实际的 Web 服务器上使用文件系统。您可以将文件的位置存储在持久数据存储中，例如数据库或 NoSQL 解决方案。

例如，对于 AWS 解决方案，您应该：

*   将图像存储在 S3 上
*   将 S3 密钥保存到数据库
*   通过云端 (Amazon CDN) 在 S3 上提供您的图像

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-18T05:13:32.193

对于我负责的 Web 应用程序，我们将图像存储在数据库中，但要确保它们很好地缓存在文件系统中。

来自 Web 服务器前端之一的图像请求需要快速的内存缓存检查，以查看数据库中的图像是否已更改，如果没有，则从文件系统提供它。如果它已更改，它会从中央数据库中获取它并将副本放入文件系统中。

这提供了将它们存储在文件系统中的大部分优势，同时保留了数据库的一些优势——我们只有一个位置来存放所有数据，这使得备份更容易，这意味着我们可以毫无问题地跨多台机器进行扩展。它也不会给数据库带来过多的负载。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-18T23:32:50.063

将文件存储在文件服务器中，并将原始数据存储在数据库中。虽然文件服务器（尤其是基于 HTTP 的）可以很好地扩展，但数据库服务器却不能。不要将它们混合在一起。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-18T03:44:31.350

将文件保存到数据库将提供一些安全性，因为另一个用户需要访问数据库才能检索文件，但是，就效率而言，对每个加载的图像进行 sql 查询，将所有负载留给服务器端。帮自己一个忙，找到一种方法来保护文件系统内的图像，它们很多。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-18T23:49:55.097

如果您需要编辑、管理或以其他方式维护图像，则应将其存储在数据库之外。

此外，文件系统具有许多数据库没有的安全特性。

该数据库非常适合存储指向实际数据的指针（文件路径）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-18T03:57:21.317

数据库开箱即用的最大优势是可以从网络上的任何位置访问它，如果您拥有多个服务器，这一点至关重要。

如果您想从其他机器访问文件系统，您需要设置某种共享方案，这可能会增加复杂性并可能出现同步问题。

如果您确实将图像存储在数据库中，您仍然可以使用本地（非共享）磁盘作为缓存来减少数据库的压力。您只需要查询数据库以获取时间戳或其他内容，以查看文件是否仍然是最新的（如果您允许可以更改的文件）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-18T04:11:04.853

如果问题是可扩展性，您将通过将内容移入数据库而遭受巨大损失。您可以通过 DNS 轮询网络服务器，但是为每个图像添加 CGI 进程和数据库查找的开销是疯狂的。它还使您的数据库更难维护，图像更难处理。

至于您问题的另一部分，您可以像访问数据库记录一样轻松地保护对文件的访问，但归根结底，只要有一个返回文件的 URL，您就可以选择有限的选项来防止该 URL使用（至少没有强制使用 cookie 和/或 javascript）。

# java - J2ME 中的高效 Gameloop

> ID：1010656
> 
> 赞同：1
> 
> 时间：2009-06-18T03:36:47.373
> 
> 标签：java, java-me, game-loop

我已经完成了一系列关于 J2ME 游戏开发的问题，在最近的一个问题中，Neil Coffey 评论道

> 作为一个附带问题——你真的想在 J2ME 游戏中达到 100 次/秒吗？正如我认为某人已经提到的那样，您实际上也应该睡到下一个所需的唤醒点，而不是每次都固定的持续时间。

出于某种原因，那件事留在了我的脑海中，现在我想要答案，我需要什么才能让我的游戏循环睡眠到*所需的唤醒点*，我真的不知道那个点在哪里 xD（理论上来说）。

为了反馈，这是我的游戏循环的简化版本：

```
public void run() {
    Graphics g = this.getGraphics();
    while (running) {
        long diff = System.currentTimeMillis() - lastLoop;
        lastLoop = System.currentTimeMillis();
        input();
        this.level.doLogic();
        render(g, diff);
        try {
            Thread.sleep(10);
        } catch (InterruptedException e) {
            stop(e);
        }
    }
} 
```

谢谢你的帮助！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T03:57:02.533

如果您还没有阅读过，[这里](http://dewitters.koonsolo.com/gameloop.html)有一篇关于游戏循环的优秀文章。

根据我编写 J2ME 游戏的经验，您会希望尽量减少在游戏循环中执行任何操作的次数，因为编写不佳的游戏循环会很快耗尽手机微不足道的电池电量。也就是说，如果您每 10 毫秒渲染一次，请务必检查是否有任何更改，如果没有，请跳过它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T03:49:28.490

如果您决定每 10 毫秒渲染一次，那么您：

```
loop {
  - record current time; render
  - do input/logic
  - check the current time, and calculate elapsed time
    - if less than 10 ms has elapsed, calculate the remaining time (10 millis - elapsed time); sleep for this duration
} 
```

我了解计时器分辨率可能存在问题（例如，Thread.sleep(10) 可能无法准确睡眠 10 毫秒；并且 System.currentTimeMillis() 可能无法返回粒度低至 1 毫秒的结果）。这取决于平台。

# winforms - 使用 ClickOnce 的独立存储上的应用程序无法启动

> ID：1010657
> 
> 赞同：1
> 
> 时间：2009-06-18T03:36:51.320
> 
> 标签：winforms, deployment, clickonce, isolatedstorage

我创建了一个可以保存本地驱动器和隔离存储数据的应用程序。然后我通过使用 FullTrust 的 ClickOnce 部署对其进行了测试。这工作正常，但是当我将其设置为 PartialTrust（Internet 区域）时，应用程序无法启动。

如何解决这个问题呢？

我尝试创建空窗体 Windows 应用程序，然后使用 PartialTrust 进行部署，运行应用程序时仍然出错。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T13:37:34.170

ClickOnce 应用程序**不需要**完全信任权限即可写入隔离存储。但是，应用程序**确实**需要完全信任常规文件 I/O。所以我猜你的应用程序必须请求完全信任才能工作。

但是，我不确定为什么您的空应用程序无法在部分信任下工作。你得到什么错误信息？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-22T15:54:47.703

你在使用 SaveFileDialog 吗？从内存中，这会为从 Internet 区域部署的部分信任 ClickOnce 应用程序引发 UIPermission 异常。如果发生这种情况，您需要更改应用部署以请求此特定权限。

**更新：**如果您进行调试构建，异常堆栈跟踪将给出导致安全异常的行号。

# lucene - nutch 场问题

> ID：1010661
> 
> 赞同：0
> 
> 时间：2009-06-18T03:39:14.963
> 
> 标签：lucene, field, nutch

我正在使用类似的东西：

```
Field notdirectory = new Field("notdirectory","1", Field.Store.NO, Field.Index.UN_TOKENIZED); 
```

并且像“notdirectory:1”这样的查询可以一直很好地处理。

但最近我改变了“Field.Store.NO, Field.Index.UN_TOKENIZED”来索引一个非数字字符串：

```
Field stateField = new Field("state","irn_" + state, Field.Store.NO, Field.Index.UN_TOKENIZED); 
```

并且像“state：irn_CA”这样的查询再也无法获取任何结果，即使我通过hadoop日志看到“irn_CA”实际上已添加到“state”字段中。

所以我怀疑满足“Field.Store.NO，Field.Index.UN_TOKENIZED”的字段，只有数字字段可以搜索，但我没有看到任何相关文档。

那么这其中的真正原因是什么呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T05:42:18.477

我认为，您正在使用 StandardAnalyzer 解析输入查询，这会将您的输入查询“irn_CA”标记为两个标记 - “irn”和“CA”。由于索引将“irn_CA”作为单个标记，因此它不会匹配。

搜索时尝试使用[KeywordAnalyzer](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/analysis/KeywordAnalyzer.html)。它将为查询字符串生成单个标记并正确匹配索引标记。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-04T16:07:17.270

我认为 searcher bean 强制所有内容都小写......所以在添加到索引时使状态为小写：

```
Field stateField = new Field("state","irn_" + state.toLowerCase(), Field.Store.NO, Field.Index.UN_TOKENIZED); 
```

当您查询时：“state:irn_ca”而不是“state:irn_CA”。

我还注意到您以 'irn_' 为前缀 - 好调用，否则荧光笔会标记查询。

# rdlc - 报告页面设置问题？

> ID：1010665
> 
> 赞同：0
> 
> 时间：2009-06-18T03:39:46.680
> 
> 标签：rdlc

```
select * from ........ 
```

这个查询输出是

```
sn   id  name    fatherName

1     1    A     Asssss

2     2    B     ABssss

3     3    C     ABCsss

4     4    D     ABCDss 
```

显示基于 SN 的**RDLC报告。每个 SN 打印在每一页上。**在行信息上打印后，页面的其余部分必须为空白......

喜欢 ：

> 第 1 页

`1 1 A Asssss`

其余页面空白

> 第2页

```
2     2    B     ABssss` 
```

都一样.....我有四个**SN**，所以我必须得到四页，每页只有一行信息........哪个属性或哪个条件可以帮助我做？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-23T14:34:55.953

简单的。在每一行之后放置一个分页符。

# c# - 我想将简单的 C++ 回显服务器移植到 C#

> ID：1010670
> 
> 赞同：0
> 
> 时间：2009-06-18T03:41:37.753
> 
> 标签：c#, c++, networking, sockets

```
SOCKET  client  = accept(listen_sock, 0, 0);

timeval client_to;
client_to.tv_sec    = 1;
client_to.tv_usec   = 0;
setsockopt(client, SOL_SOCKET, SO_RCVTIMEO, (char*)&client_to, sizeof(client_to));
char    buffer[1024];
while ((ret = recv(client, buffer, 1024, 0)) != 0)
{
    cout    << "<in loop>" << endl;
    if (ret == -1 && WSAGetLastError() != WSAETIMEDOUT) break;
    if (ret > 0)    cout    << std::string(buffer, 0, ret) << endl;
}

closesocket(client); 
```

以上代码是用 C++ 编写的简单回显服务器的一部分。我面临的问题是...

1.  如何设置超时值并检测超时时间是否过期？
2.  如何检测套接字断开连接？

请让我用 C# 显示一些代码。谢谢。

已添加>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

我的部分 C# 代码如下...

```
try
{
    // Read all
    spider.Client.ReceiveTimeout = 500; // spider is TcpClient type and blocking socket.
    int readCount = 0;
    SocketError socketError;
    while ((readCount = spider.Client.Receive(tempBuffer, 0, tempBuffer.Length, SocketFlags.None, out socketError)) > 0) // I  think time-out does not work, Receive() returns immediately.
    {
    recvBuffer.Append(tempBuffer, 0, readCount);
    }
}
catch (Exception e) // even though spider is disconnect, no exception occurred. how can I detect disconnection?
{
    Console.WriteLine("Exception: {0}", e.Message);

} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T10:16:12.500

查看**[kodart](http://www.kodart.com/)**为 .net提供的**[XF.Server](http://www.kodart.com/download/)**套接字库。当您下载该库时，它带有一个回显服务器作为 Xf.Server 库的示例实现。这对你有用。

www.kodart.com

谢谢。

# c# - 在使用 Activator.CreateInstance 创建的泛型基类上调用方法

> ID：1010671
> 
> 赞同：1
> 
> 时间：2009-06-18T03:41:49.017
> 
> 标签：c#, generics

以下程序可以正常工作。但是，我想将其更改为不使用 InvokeMember。我希望能够将 CreateInstance 的返回值转换为 GenericBase 并直接调用 Foo 方法。在此代码示例中，我知道类型是派生的。但是，在我的实际代码中，我只知道该类型是从 GenericBase 派生的。我所有将**对象**转换为**GenericBase**的尝试都无法编译。当我在强制转换中使用 GenericType 时，C# 坚持我提供类型参数。

这可能吗？

```
using System;
using System.Collections.Generic;
using System.Text;

namespace GenericTest
{
    class Program
    {
        static void Main(string[] args)
        {
            Type t = typeof(Derived);
            object o = Activator.CreateInstance(t);
            t.InvokeMember("Foo", System.Reflection.BindingFlags.InvokeMethod, null, o, new object[] { "Bar" });
        }
    }

    class GenericBase<T>
    {
        public void Foo(string s)
        {
            Console.WriteLine(s);
        }
    }

    class Derived : GenericBase<int>
    {
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T03:47:17.477

`GenericBase<Bar>`先验地，您对和之间可能存在的共同特征一无所知`GenericBase<Baz>`。他们可能没有共同点。因此，在不知道父泛型类的类型的情况下，您实际上根本不知道有关该对象的任何有用信息。

*现在，另一方面*，很明显，您在这个特定示例中所说的是和之间*有*一些共同点——它们都实现了非泛型. 因此，为了能够对您的对象做一些有用的事情，您需要形式化这种行为；放入非通用接口，并实现该接口。然后您可以将您的对象转换为, 并调用.`GenericBase<Bar>``GenericBase<Baz>``void Foo(string s)``Foo``IFoo``GenericBase<T>``IFoo``Foo`

# java - 使用 Apache POI 刷新数据透视表

> ID：1010673
> 
> 赞同：10
> 
> 时间：2009-06-18T03:43:10.900
> 
> 标签：java, apache, excel, pivot-table, apache-poi

我目前正在开发一个使用包含数据透视表的模板 excel 文件的 Java 应用程序。

模板文件还有一个为数据透视表提供种子的数据表。此数据表通过 Apache POI api 动态加载到 java 应用程序中。

当我打开 excel 文件时，我必须手动刷新数据透视表才能正确加载数据。

有什么方法可以使用 POI api 刷新数据透视表，这样我就不必手动执行了吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2013-11-05T16:39:20.937

您可以简单地激活一个选项，该选项将在每次打开文件时刷新数据透视表。

这个[微软文档](http://office.microsoft.com/en-au/excel-help/refresh-pivottable-data-HA101906071.aspx#_Toc270952720)说：

> 在“数据透视表选项”对话框的“数据”选项卡上，选中“打开文件时刷新数据”复选框。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-10-23T08:52:49.267

有可能的。在 中`PivotCacheDefinition`，有一个属性`refreshOnLoad`可以设置为`true`。然后在打开工作簿时刷新缓存。[更多信息在这里](http://msdn.microsoft.com/en-us/library/documentformat.openxml.spreadsheet.pivotcachedefinition.aspx)。

在 POI 中，这可以通过调用`setRefreshOnLoad(boolean bool)`CTPivotCacheDefinition 上的方法来完成，该方法将布尔值作为参数。

编辑：Apache POI 现在提供了创建数据透视表的可能性，并且默认情况下数据透视表在加载时刷新。[XSSFPivotTable 类](https://poi.apache.org/apidocs/org/apache/poi/xssf/usermodel/XSSFPivotTable.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-11T09:27:13.643

这篇文章说您可以打开数据透视表上的一个选项，该选项将导致它在每次打开工作簿时自动刷新：

[如何使用宏刷新 Excel 工作簿中的所有数据透视表？](https://stackoverflow.com/questions/70947/how-can-i-refresh-all-the-pivot-tables-in-my-excel-workbook-with-a-macro)

希望在您使用 Apache POI 刷新或扩展数据透视表所基于的数据行之后，这仍然是正确的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-08T15:50:52.083

对此的基本答案是否定的。POI 是一个文档格式阅读器和编写器。更新数据透视表是一个 excel 引擎问题。当然，另一个应用程序可能会尝试在此处复制 Excel 引擎的行为，但这确实会变得很难看。我建议使用[Joel 的](http://www.joelonsoftware.com/items/2008/02/19.html)通过 web 服务访问 excel COM 对象的解决方法来完成这种事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-09-02T13:34:20.437

```
 protected void setRefreshPtOnLoad(boolean refreshOnLoad){
        List<POIXMLDocumentPart.RelationPart> relationParts = ((XSSFWorkbook) workbook).getRelationParts();
        for (POIXMLDocumentPart.RelationPart part : relationParts) {
            PackageRelationship relationship = part.getRelationship();
            if (relationship.getRelationshipType().contains("pivotCacheDefinition")){
                String relationId = relationship.getId();
                XSSFPivotCacheDefinition cache = (XSSFPivotCacheDefinition)((XSSFWorkbook) workbook).getRelationById(relationId);
                CTPivotCacheDefinition ctCache = cache.getCTPivotCacheDefinition();
                ctCache.setRefreshOnLoad(refreshOnLoad);
                break; // if only pivot table cache exists in workbook, else - remove *break*
            }
        }
    } 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2017-06-23T13:04:38.900

这可能有效：

```
XSSFPivotTable pivotTable = pivotSheet.getPivotTables().get(0);     
pivotTable.getPivotCacheDefinition().getCTPivotCacheDefinition().setRefreshOnLoad(true); 
```

# iphone - iPhone 方向表示为旋转

> ID：1010674
> 
> 赞同：1
> 
> 时间：2009-06-18T03:43:37.327
> 
> 标签：iphone, orientation, accelerometer

奥拉人，

```
 This might not be the right place for this. Let me know where I should post if I should post it elsewhere.

 I want to get the orientation of the device. I am thinking I can use something like this:

float fAngleX = atan2(acceleration.y, acceleration.z);
float fAngleY = atan2(acceleration.x, acceleration.z);
float fAngleZ = atan2(acceleration.y, acceleration.x);

 First, is my formula right?
 Second, is this going to work for the device? 
 Third, I'm going back and forth about filtering out gravity. Any thoughts?
 Lastly, is there a better way to get the devices orientation expressed as rotation for all three axis? 
```

谢谢

-isdi-

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T04:43:41.370

将设备的旋转作为三个数字给出，实际上是模棱两可的。这种事情会让人很困惑。我认为这可能是最好的起点：[http ://en.wikipedia.org/wiki/Euler_angles](http://en.wikipedia.org/wiki/Euler_angles)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T08:48:37.053

只要您小心，就可以使用角度，尽管直接使用向量可能会更容易。

您几乎肯定会想要进行过滤；一个简单的低通会很好，但不要过滤掉重力，因为它**是**设备的方向:)。

# c# - .NET 控制台应用程序是否有任何有用的库？

> ID：1010675
> 
> 赞同：5
> 
> 时间：2009-06-18T03:43:52.380
> 
> 标签：c#, .net, console

我想知道是否有任何有用的（免费）库来帮助开发控制台应用程序。

只是一个简单的例子：

一个封装了在控制台应用程序中选择文件的所有行为的库（又名控制台应用程序的 OpenFileDialog）呢？

当然有 MonoCurses，但我想知道是否还有其他的？

谢谢。 **更新：** 我知道您当然可以简单地使用 OpenFileDialog。但我说的是纯控制台应用程序。没有 Windows 窗体或 WPF 元素。纯控制台。（例如在没有图形用户界面的 Linux 系统上运行）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T05:44:31.190

这是我在使用控制台应用程序[命令行解析器时用于解析命令行参数的一个很好的代码](http://www.codeproject.com/KB/recipes/command_line.aspx)

# javascript - 为什么我的 onbeforeunload 处理程序会导致“未指定错误”错误？

> ID：1010681
> 
> 赞同：2
> 
> 时间：2009-06-18T03:44:54.593
> 
> 标签：javascript, internet-explorer-6, onbeforeunload

我在 IE6 中使用以下 JavaScript 函数：

```
window.onbeforeunload = function() {  
  if (itemChanged) {  
     return 'You have made changes to data on this page.  If you navigate away from this page without first saving your data, the changes will be lost.';  
  }  
}; 
```

但是当我按下对话框上的取消按钮时，我收到一个 JavaScript 页面错误：

> 错误：未指定的错误。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T03:54:41.830

检查 (itemChanged) 的值。是否有其他原因导致错误？这对我来说可以。

[Jsbin](http://jsbin.com/uwudu)示例。

# c# - MSTest 是否与 NUnit 的 TestCase 等效？

> ID：1010685
> 
> 赞同：132
> 
> 时间：2009-06-18T03:46:10.660
> 
> 标签：c#, nunit, mstest, testcase, rowtest

我发现`TestCase`NUnit 中的功能非常有用，可以作为一种快速指定测试参数的方法，而无需为每个测试使用单独的方法。MSTest 中有类似的东西吗？

```
 [TestFixture]  
 public class StringFormatUtilsTest  
 {  
     [TestCase("tttt", "")]  
     [TestCase("", "")]  
     [TestCase("t3a4b5", "345")]  
     [TestCase("3&amp;amp;5*", "35")]  
     [TestCase("123", "123")]  
     public void StripNonNumeric(string before, string expected)  
     {  
         string actual = FormatUtils.StripNonNumeric(before);  
         Assert.AreEqual(expected, actual);  
     }  
 } 
```

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2016-02-25T15:42:56.300

微软最近发布了**“MSTest V2”**（参见[博客文章](https://blogs.msdn.microsoft.com/visualstudioalm/2016/06/17/taking-the-mstest-framework-forward-with-mstest-v2/)）。这使您可以始终如一地（桌面、UWP、...）使用 -`DataRow`属性！

```
 [TestClass]  
 public class StringFormatUtilsTest  
 {  
     [DataTestMethod]  
     [DataRow("tttt", "")]  
     [DataRow("", "")]  
     [DataRow("t3a4b5", "345")]  
     [DataRow("3&amp;amp;5*", "35")]  
     [DataRow("123", "123")]  
     public void StripNonNumeric(string before, string expected)  
     {  
         string actual = FormatUtils.StripNonNumeric(before);  
         Assert.AreEqual(expected, actual);  
     }  
 } 
```

同样，不幸的是，Visual Studio Express 的测试资源管理器无法识别这些测试。但至少“完整”VS 版本现在支持该功能！

要使用它，只需安装 NuGet 包[MSTest.TestFramework](https://www.nuget.org/packages/MSTest.TestFramework/)和[MSTest.TestAdapter](https://www.nuget.org/packages/MSTest.TestAdapter/)（现在都是预发布版）。

## 较旧的答案：

如果不必坚持使用 MSTest 并且您只是使用它来通过测试资源管理器运行测试~~因为您只有 Visual Studio Express 版本~~，那么这可能是您的解决方案：

VsTestAdapter [VSIX 扩展](http://nunit.org/index.php?p=vsTestAdapter&r=2.6)能够通过测试资源管理器运行 NUnit 测试。不幸的是，VS Express 用户无法安装扩展......但幸运的是[VsTestAdapter 也带有一个普通的 NuGet-Package](https://www.nuget.org/packages/NUnitTestAdapter/)！

~~因此，如果您是 VS Express 用户，只需安装 VsTestAdapter NuGet-Package 并享受通过测试资源管理器运行您的 NUnit 测试/测试用例！~~

* * *

不幸的是，上述说法不正确。虽然通过 Express 版本安装包是完全可能的，但它没有用，因为它不能使用测试资源管理器。以前有一个关于[旧版本](https://www.nuget.org/packages/NUnitTestAdapter/1.2.0)TestAdapter 的旁注，该版本已从[2.0.0 的描述页面](https://www.nuget.org/packages/NUnitTestAdapter/2.0.0)中删除：

> 请注意，它不适用于 VS Express

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2013-10-23T09:00:24.203

我知道这是一个迟到的答案，但希望它可以帮助其他人。

我到处寻找一个优雅的解决方案，最后自己写了一个。我们在 20 多个具有数千个单元测试和数十万次迭代的项目中使用它。从来没有错过任何一个节拍。

[https://github.com/Thwaitesy/MSTestHacks](https://github.com/Thwaitesy/MSTestHacks)

**1)**安装[NuGet](https://www.nuget.org/packages/MSTestHacks/ "NuGet")包。

**2）**从TestBase继承你的测试类

```
public class UnitTest1 : TestBase
{ } 
```

**3)**创建返回 IEnumerable 的属性、字段或方法

```
[TestClass]
public class UnitTest1 : TestBase
{
    private IEnumerable<int> Stuff
    {
        get
        {
            //This could do anything, get a dynamic list from anywhere....
            return new List<int> { 1, 2, 3 };
        }
    }
} 
```

**4)**将 MSTest DataSource 属性添加到您的测试方法中，指向上面的 IEnumerable 名称。这需要完全合格。

```
[TestMethod]
[DataSource("Namespace.UnitTest1.Stuff")]
public void TestMethod1()
{
    var number = this.TestContext.GetRuntimeDataSourceObject<int>();

    Assert.IsNotNull(number);
} 
```

**最终结果：** 3 次迭代，就像普通的 DataSource 一样 :)

```
using Microsoft.VisualStudio.TestTools.UnitTesting;
using MSTestHacks;

namespace Namespace
{
    [TestClass]
    public class UnitTest1 : TestBase
    {
        private IEnumerable<int> Stuff
        {
            get
            {
                //This could do anything, get a dynamic list from anywhere....
                return new List<int> { 1, 2, 3 };
            }
        }

        [TestMethod]
        [DataSource("Namespace.UnitTest1.Stuff")]
        public void TestMethod1()
        {
            var number = this.TestContext.GetRuntimeDataSourceObject<int>();

            Assert.IsNotNull(number);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2015-01-10T21:59:12.080

我知道这是另一个较晚的答案，但是在我的团队中，他们一直使用 MS 测试框架，我们开发了一种技术，它只依赖匿名类型来保存一组测试数据，并使用 LINQ 循环并测试每一行。它不需要额外的类或框架，并且往往相当容易阅读和理解。它也比使用外部文件或连接数据库的数据驱动测试更容易实现。

例如，假设您有一个这样的扩展方法：

```
public static class Extensions
{
    /// <summary>
    /// Get the Qtr with optional offset to add or subtract quarters
    /// </summary>
    public static int GetQuarterNumber(this DateTime parmDate, int offset = 0)
    {
        return (int)Math.Ceiling(parmDate.AddMonths(offset * 3).Month / 3m);
    }
} 
```

您可以使用和组合到 LINQ 的匿名类型数组来编写如下测试：

```
[TestMethod]
public void MonthReturnsProperQuarterWithOffset()
{
    // Arrange
    var values = new[] {
        new { inputDate = new DateTime(2013, 1, 1), offset = 1, expectedQuarter = 2},
        new { inputDate = new DateTime(2013, 1, 1), offset = -1, expectedQuarter = 4},
        new { inputDate = new DateTime(2013, 4, 1), offset = 1, expectedQuarter = 3},
        new { inputDate = new DateTime(2013, 4, 1), offset = -1, expectedQuarter = 1},
        new { inputDate = new DateTime(2013, 7, 1), offset = 1, expectedQuarter = 4},
        new { inputDate = new DateTime(2013, 7, 1), offset = -1, expectedQuarter = 2},
        new { inputDate = new DateTime(2013, 10, 1), offset = 1, expectedQuarter = 1},
        new { inputDate = new DateTime(2013, 10, 1), offset = -1, expectedQuarter = 3}
        // Could add as many rows as you want, or extract to a private method that
        // builds the array of data
    }; 
    values.ToList().ForEach(val => 
    { 
        // Act 
        int actualQuarter = val.inputDate.GetQuarterNumber(val.offset); 
        // Assert 
        Assert.AreEqual(val.expectedQuarter, actualQuarter, 
            "Failed for inputDate={0}, offset={1} and expectedQuarter={2}.", val.inputDate, val.offset, val.expectedQuarter); 
        }); 
    }
} 
```

使用此技术时，使用包含 Assert 中的输入数据的格式化消息会很有帮助，以帮助您识别导致测试失败的行。

我已经在[AgileCoder.net](http://agilecoder.net/2015/01/08/data-driven-mstest/)上发布了有关此解决方案的博客，其中包含更多背景和详细信息。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2017-11-20T13:48:12.620

Khlr 给出了很好的详细解释，显然这种方法在 VS2015 Express for Desktop 中开始工作。我试图留下评论，但我缺乏声誉并不允许我这样做。

让我在这里复制解决方案：

```
[TestClass]  
 public class StringFormatUtilsTest  
 {  
     [TestMethod]  
     [DataRow("tttt", "")]  
     [DataRow("", "")]  
     [DataRow("t3a4b5", "345")]  
     [DataRow("3&amp;amp;5*", "35")]  
     [DataRow("123", "123")]  
     public void StripNonNumeric(string before, string expected)  
     {  
         string actual = FormatUtils.StripNonNumeric(before);  
         Assert.AreEqual(expected, actual);  
     }  
 } 
```

要使用它，只需安装 NuGet 包[MSTest.TestFramework](https://www.nuget.org/packages/MSTest.TestFramework/)和[MSTest.TestAdapter](https://www.nuget.org/packages/MSTest.TestAdapter/)。

一个问题是

> 错误 CS0433 类型“TestClassAttribute”同时存在于“Microsoft.VisualStudio.QualityTools.UnitTestFramework, Version=10.0.0.0 和 'Microsoft.VisualStudio.TestPlatform.TestFramework, Version=14.0.0.0”中

因此，请从项目的引用中删除**Microsoft.VisualStudio.QualityTools.UnitTestFramework 。**

非常欢迎您编辑原始回复并删除此回复。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-06-15T22:17:26.797

考虑使用[DynamicDataAttribute](https://github.com/Microsoft/testfx-docs/blob/main/RFCs/006-DynamicData-Attribute.md)：

**NUnit 测试用例**

```
private static readonly IEnumerable<TestCaseData> _testCases = new[]
{
    new TestCaseData("input value 1").Returns(new NameValueCollection { { "a", "b" } }),
    new TestCaseData("input value 2").Returns(new NameValueCollection { { "a", "b" } }),
    /* .. */
};

[TestCaseSource(nameof(_testCases))]
public NameValueCollection test_test(string str)
{
    var collection = new NameValueCollection();
    collection.TestedMethod(str);
    return collection;
} 
```

**MSTest 测试用例**

```
private static IEnumerable<object[]> _testCases
{
    get
    {
        return new[]
        {
            new object[] { "input value 1", new NameValueCollection { { "a", "b" } } },
            new object[] { "input value 2", new NameValueCollection { { "a", "b" } } },
            /* .. */
        };
    }
}

[TestMethod]
[DynamicData(nameof(_testCases))]
public void test_test(string str, NameValueCollection expectedResult)
{
    var collection = new NameValueCollection();
    collection.TestedMethod(str);

    CollectionAssert.AreEqual(expectedResult, collection);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-08T16:26:16.160

MSTest 具有 DataSource 属性，它允许您向它提供数据库表、csv、xml 等。我已经使用它并且效果很好。我不知道如何将数据作为您的问题中的属性放在上面，但是设置外部数据源和文件非常容易，并且可以将文件包含在项目中。我从一开始就让它运行了一个小时，而且我不是自动化测试专家。

[https://msdn.microsoft.com/en-us/library/ms182527.aspx?f=255&MSPPError=-2147217396](https://msdn.microsoft.com/en-us/library/ms182527.aspx?f=255&MSPPError=-2147217396)有一个基于数据库输入的完整教程。

[http://www.rhyous.com/2015/05/11/row-tests-or-paramerterized-tests-mstest-xml/](http://www.rhyous.com/2015/05/11/row-tests-or-paramerterized-tests-mstest-xml/)有一个基于 XML 文件输入的教程。

# c# - 在 Visual Studio 中为 C# 项目管理多个配置文件

> ID：1010690
> 
> 赞同：1
> 
> 时间：2009-06-18T03:47:27.210
> 
> 标签：c#, .net, visual-studio, build-process

我了解到构建应该非常直接，并且需要较少的人工干预。在我的情况下，我有 3 个环境，DEV（开发版）、SIT（STG 集成测试）和 UAT（用户验收测试）。所有这些环境都有不同的数据库连接详细信息和其他设置（例如日志记录）。

目前，当需要将应用程序部署到 SIT 环境时，我需要做的是构建应用程序。安装到目标环境，手动修改配置文件。这是有问题的，因为我可能会错过一些条目。当配置文件很大时，情况会变得更糟。

**问题**

1 - 从VS进行构建时是否有指定环境名称。以便使用该环境的配置文件。

2 - 还有哪些其他有助于减少人为干预构建的方法？

3 - 假设我的应用程序名称是“Foo”。我在解决方案中有一个包项目，它将创建可安装的包。是否有根据环境指定产品标题？我的意思是如果选择 SIT，安装时的产品名称将是“Foo-SIT”。我想这将避免混淆第一版正在安装的环境。如果有任何更好的选择，我将很高兴听到任何更好的选择。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-19T13:12:23.667

2 -- 你是绝对正确的 -- 你应该尽可能地自动化你的构建和部署过程。[您最好的选择是使用类似NAnt](http://nant.sourceforge.net/)的东西设置一个自动构建/部署脚本。您的脚本可以为每个环境设置目标，例如

```
<project name="MyApp" xmlns="http://nant.sf.net/release/0.85/nant.xsd">
    <target name="DEV">
      <!-- execute any tasks needed to build the app, such as msbuild(1) -->

      <!-- execute any tasks needed to build the tweak the config files, such as xmlpeek / xmlpoke(2) -->

      <!-- execute any tasks needed to copy the now-built and configured project output the tweak the destination server, such as copy(3)-->
    </target>

    <target name="SIT">...</target>
    <target name="UAT">...</target>

</project> 
```

如果您对 NAnt 不熟悉，那么您应该在不到一天的时间内就可以启动并运行和编写脚本。回报是立竿见影且持久的，因为您无需再将 VNC 安装到服务器上并再次调整配置文件。

*   (1)[构建](http://nantcontrib.sourceforge.net/release/0.85/help/tasks/msbuild.html)
*   (2) [xmlpeek](http://nant.sourceforge.net/release/latest/help/tasks/xmlpeek.html) / [xmlpoke](http://nant.sourceforge.net/release/latest/help/tasks/xmlpoke.html)
*   (3)[复制](http://nant.sourceforge.net/release/latest/help/tasks/copy.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-15T11:56:49.287

您可以查看[codeplex.com 上的 EnvRide 工具](http://envride.codeplex.com/)。其目的正是为了更轻松地以自动化方式管理多个配置文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T19:58:06.330

处理此问题的一种方法是创建 3 个项目并将环境置于新项目的名称中。然后使用构建后事件根据项目名称复制正确的文件。

在构建后事件中，您可以根据 $(ProjectName) 宏告诉项目名称。所以你可以做类似的事情

```
IF "$(ProjectName)"="devproject" (
   copy ...
   copy ...
) 
```

最好让这些项目将大部分实际工作（编译）推迟到单个项目，这样您就不必在多个项目中保持设置最新。

# objective-c - Objective C 的正确根类？

> ID：1010695
> 
> 赞同：2
> 
> 时间：2009-06-18T03:49:04.353
> 
> 标签：objective-c

我在网上找到了关于 ObjC 的两个不同根类的参考资料，要么`objc/Object.h`要么`Foundation/NSObject.h`. 它们需要不同的编译器标志（`-lobj`vs. `-lobjc -framework Foundation`，并且有不同的选择器来初始化和释放对象。NSObject 是替代品，还是它们有不同的应用程序？显然`NSObject.h`对于 NextStep 类型的东西会更好，但确实`Object.h`有一些优势可以让它变得更好在某些情况下？

FWIW，来自 comp.lang.objective-c 的[更新常见问题解答](http://www.thaesofereode.info/clocFAQ/#cocoa-root)似乎表明这`NSObject.h`是正确的；旧[版本](http://www.faqs.org/faqs/computer-lang/Objective-C/faq/)提到`Object.h`

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T04:00:17.577

我对这种情况的理解是 Objective-C 有两个运行时库。使用 NSObject 的 Apple 库和使用 Object 的 GNU 库。如果您正在为 Apple 平台开发，请使用它们的运行时。如果您正在为非 Apple 平台开发，则使用另一个。

# c# - 如何将 DateTime 值转换为双精度值？

> ID：1010697
> 
> 赞同：2
> 
> 时间：2009-06-18T03:50:30.877
> 
> 标签：c#, datetime

如何将`DateTime`值转换为`double`？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-18T03:53:44.933

如果`double`您的意思是 OLE 自动化日期，那么您可以使用[`DateTime.ToOADate()`](http://msdn.microsoft.com/en-us/library/system.datetime.tooadate.aspx). 从链接的 MSDN 主题：

> OLE 自动化日期实现为浮点数，其值为从 1899 年 12 月 30 日午夜开始的天数。例如，1899 年 12 月 31 日午夜由 1.0 表示；1900 年 1 月 1 日上午 6 点由 2.25 表示；1899 年 12 月 29 日午夜，用 -1.0 表示；1899 年 12 月 29 日上午 6 点用 -1.25 表示。
> 
> 基本 OLE 自动化日期是 1899 年 12 月 30 日午夜。最大 OLE 自动化日期与 MaxValue 相同，即 9999 年 12 月 31 日的最后时刻。

如果您正在谈论也可以存储在 a 中的其他日期表示`double`，请指定...

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T03:54:29.630

DateTime.ToOADate()在 C# 中转换为双[OLE 自动化日期](http://msdn.microsoft.com/en-us/library/system.datetime.tooadate.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-22T22:54:50.427

是的，OLE 自动化日期可以`Datetime`转换为 Decimal/double 类型。但是，十进制/双精度的结果/值不是精确的系统`Datetime`。

例如，

```
Decimal dateIndDec = Convert.Decimal (Datetim.Today.ToOADate()); 
```

不等于 MS SQL

```
 Select Convert (Decimal (10, 9), GetDate()) 
```

结论：OLE 自动化日期不是真正的系统`datetime`信息......不能使用它。

我到处搜索关于`Datetime`在 C# 中将值转换为十进制值，但没有任何运气。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-12-22T05:51:15.587

您可以计算 DateTime 和 DateTime.MinValue 之间的差异，然后获取任何`Total*`值。

```
var difference = DateTime.Now - DateTime.MinValue;
Console.WriteLine(difference.TotalMinutes);
Console.WriteLine(difference.TotalMilliseconds); 
```

# string - Groovy 字符串连接

> ID：1010698
> 
> 赞同：7
> 
> 时间：2009-06-18T03:51:24.323
> 
> 标签：string, groovy

当前代码：

```
row.column.each(){column ->
    println column.attributes()['name']
    println column.value()
} 
```

`Column`是`Node`具有单个属性和单个值的。我正在解析一个 xml 以将创建插入语句输入到访问中。是否有一种 Groovy 方法来创建以下结构化语句：

```
Insert INTO tablename (col1, col2, col3) VALUES (1,2,3) 
```

我目前将属性和值存储到单独的数组中，然后将它们按正确的顺序弹出。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-06-19T03:22:29.380

我认为 groovy 比目前接受的答案要容易得多。collect 和 join 方法就是为这种事情而构建的。Join 会自动处理连接，并且不会将尾随逗号放在字符串上

```
def names = row.column.collect { it.attributes()['name'] }.join(",")
def values = row.column.collect { it.values() }.join(",")
def result = "INSERT INTO tablename($names) VALUES($values)" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T11:09:33.593

您可以只使用两个 StringBuilder。像这样的东西，粗糙且未经测试：

```
def columns = new StringBuilder("Insert INTO tablename(")
def values = new StringBuilder("VALUES (")
row.column.each() { column ->
    columns.append(column.attributes()['name'])
    columns.append(", ")
    values.append(column.value())
    values.append(", ")
}
// chop off the trailing commas, add the closing parens
columns = columns.substring(0, columns.length() - 2)
columns.append(") ")
values = values.substring(0, values.length() - 2)
values.append(")")

columns.append(values)
def result = columns.toString() 
```

[您可以在此处](http://groovy.codehaus.org/JN1525-Strings)找到各种 Groovy 字符串操作运算符。

# php - PHP 对象缓存性能

> ID：1010699
> 
> 赞同：2
> 
> 时间：2009-06-18T03:51:26.133
> 
> 标签：php, performance, oop, caching, object

在磁盘上缓存 PHP 对象有区别吗？如果缓存，对象只会为所有站点访问者创建一次，如果没有，它们将为每个访问者创建一次。这有性能差异还是我会浪费时间这样做？

基本上，归根结底，主要问题是：

内存中的多个对象，每个用户（每个用户都有自己的一组实例化对象）

VS

为所有用户缓存在文件中的单个对象（所有用户使用相同的对象，例如，相同的错误处理程序类、相同的模板处理程序类和相同的数据库句柄类）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T04:37:57.600

要使用这些对象，每个 PHP 脚本都必须反序列化它们。因此，绝对不是为了节省内存而将它们缓存在磁盘上——它不会节省内存。

缓存这些对象的原因是创建对象的成本太高。对于普通的 PHP 对象，情况并非如此。但是，如果对象代表昂贵的数据库查询的结果，或从远程 Web 服务获取的信息，例如，将其缓存在本地可能是有益的。

基于磁盘的缓存不一定是一个巨大的胜利。如果您使用 PHP 并且关心性能，那么您必须在操作码缓存环境（如 APC 或 Zend 平台）中运行应用程序。这些工具还提供缓存，您可以使用这些缓存将 PHP 对象保存在应用程序中。Memcached 也是用于应用程序数据的快速内存缓存的流行解决方案。

另请记住，并非所有 PHP 对象都可以序列化，因此无法将它们保存在缓存中，无论是基于磁盘的还是内存中的，都不可能适用于所有数据。基本上，如果对象包含对 PHP 资源的引用，您可能无法序列化它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T15:04:49.767

> 在磁盘上缓存 PHP 对象有区别吗？

与所有性能调整一样，您应该衡量自己在做什么，而不是盲目地执行一些您不完全理解的伏都教仪式。当您将对象保存在 中时`$_SESSION`，PHP 将捕获对象状态并从中生成一个文件（序列化）。在下一次请求时，PHP 将创建一个新对象并使用此状态重新填充它。这个过程比创建对象要昂贵得多，因为 PHP 必须进行磁盘 I/O 然后解析序列化数据。这必须在读取和写入时发生。

通常，PHP 被设计为无共享架构。这有其优点和缺点，但试图以某种方式回避它通常不是一个好主意。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T13:43:21.443

不幸的是，对此没有正确的答案。在同一台服务器上为同一网站提供相同的解决方案可以提供更好的性能或更差的性能。这实际上取决于太多因素（应用程序、软件、硬件、配置、服务器负载等）。

要记住的要点是： - 服务器最慢的部分是硬盘驱动器。- 对象创建比磁盘访问好得多。

=> 尽可能远离 HD 并尽可能在 RAM 中缓存数据。

如果您没有性能问题，我建议您做...什么也不做。

如果您有性能问题：基准，基准，基准。（找到更好解决方案的唯一真正方法）。

关于该主题的有趣视频：[YouTube 可扩展性](http://www.youtube.com/watch?v=ZW5_eEKEC28)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-17T15:06:50.697

我认为你会浪费时间，除非数据是静态的并且生成起来很复杂。

假设您有一个表示 ACL（访问控制列表）的对象，该对象说明哪些用户级别对某些资源具有权限。

填充此 ACL 可能需要相当长的时间，尤其是在数据来自数据库的情况下。缓存的 ACL 可以更快地实例化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-17T15:18:55.337

我使用了缓存 SQL 查询结果和耗时的计算结果，并取得了令人印象深刻的结果。现在，我正在开发一个应用程序，该应用程序从包含超过 200,000 条记录的表中获取超过 200 条数据库记录（其中包含大量 SQL 函数和计算），并根据获取的数据计算每个请求的结果。我使用 Zend Framework 的 Zend_Cache 组件来缓存计算结果，所以下次我不需要：

1.  连接到数据库
2.  等待数据库服务器找到我的记录，计算我的sql函数，返回结果
3.  将至少 200 条（甚至丰富的 1000 条）记录提取到内存中
4.  遍历所有这些数据并计算我想要的

我只是做：

1.  调用 Zend_Cache::load() 方法，它会做一些文件读取。

这将为每个请求节省至少 4-5 秒（非常不准确，我实际上没有对其进行分析。但性能提升非常明显）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-17T15:19:05.337

在某些情况下可能很有用，但需要仔细研究影响和其他类型的性能改进（如数据库查询、数据结构、算法等）。

您缓存的查询应该是恒定的（并且数量有限）并且数据应该是非常静态的。为了有效（并且值得），您的硬盘访问需要比您对该数据的数据库查询快得多。

我曾经通过序列化文件中的缓存对象来使用它，在主页上的相对静态内容上使用重负载的单实例数据库，以每秒 200 次以上的命中率使用，不可避免的查询（在我的水平上）。在该主页上获得了大约 40% 的性能。

代码 - 从头开始​​开发时 - 非常快速和直接，带有 pile_put/get_contents 和 un/serialize。例如，您可以在查询的 md5 校验和之后命名您的文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-06T13:06:39.007

将对象缓存在内存中通常比在磁盘上更好：

[http://code.google.com/p/php-object-cache/](http://code.google.com/p/php-object-cache/)

但是，为自己设定基准并比较结果。那是只有你可以确定的。

# ruby-on-rails - 为什么activeresource.rb 只是调用active_resource.rb？

> ID：1010704
> 
> 赞同：4
> 
> 时间：2009-06-18T03:54:50.177
> 
> 标签：ruby-on-rails, ruby, activeresource

以下是全部内容`activeresource.rb`：

```
require 'active_resource' 
```

有人可以解释一下这个逻辑吗？

为什么不简单地`activeresource.rb`包含包含`active_resource.rb`的内容而忘记附加`require`语句？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T04:02:13.113

[David Heinemeier Hansson](http://www.loudthinking.com/)将 activeresource.rb 添加到代码库中，这样人们就可以根据 gem 名称本身来满足他们的要求，而不必记住即使 gem 被命名为 activeresource，他们也必须需要 active_resource.rb

任何已经在使用它的人仍然需要原始文件，因此新文件只需要旧文件。

[检查 activeresource.rb 的评论](http://github.com/rails/rails/commits/master/activeresource/lib/activeresource.rb)

编辑：

找到导致此更改的原始[增强票](http://dev.rubyonrails.org/ticket/8845)

# .net - 阻塞套接字上的 10035 错误

> ID：1010708
> 
> 赞同：3
> 
> 时间：2009-06-18T03:56:08.993
> 
> 标签：.net, sockets

有谁知道在超时的阻塞套接字上读取时可能导致 10035 错误（EWOULDBLOCK）的原因是什么？这是在 Windows XP 下使用 .NET 框架 3.5 版套接字库。我自己从来没有设法得到这个，但我的一位同事一直在得到它。他正在向速度慢得多的设备发送相当大量的数据，然后等待响应，这通常会给出 10035 错误。我想知道 TCP 缓冲区是否会出现问题，但在这种情况下，我希望读取等待或超时。套接字肯定是阻塞的，而不是非阻塞的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-04-25T01:39:12.307

可能是 Mono 错误。我刚开枪。

[https://bugzilla.novell.com/show_bug.cgi?id=599488](https://bugzilla.novell.com/show_bug.cgi?id=599488)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-24T03:53:24.627

似乎正在发生的事情是在读取超时后重试时发生错误。超时（10060）后，我重新发送数据并等待回复。超时似乎将套接字设置为非阻塞模式，即使调试器在 .Net 套接字对象上显示 Blocking 设置为 true，我立即收到 10035 错误。如果我在重试之前将套接字上的 Blocking 显式设置为 true，则 10035 错误就会消失。这看起来像是 Winsock 或 .Net 中的一个错误，或者可能是一个特性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T03:58:32.487

[http://www.lancerobinson.net/archive/2005/07/20/WinsockError10035.aspx](http://www.lancerobinson.net/archive/2005/07/20/WinsockError10035.aspx)

> 当客户端或服务器端的 winsock 缓冲区已满时，会发生此错误。

# git - 将分支移动到新标签

> ID：1010713
> 
> 赞同：10
> 
> 时间：2009-06-18T03:58:17.340
> 
> 标签：git, tags, branch, rebase

我的个人 Wordpress 安装是从GitHub 上的[wordpress git 镜像克隆的。](http://github.com/veilleperso/wordpress/)我检查了分支“stable”（`git checkout -b stable 2.7.1`）的 2.7.1 标记，从那以后它一直运行良好。现在 WordPress 2.8 已经发布我想将我的稳定分支移动到 2.8 标签。

我尝试了以下（所有在稳定分支上），但在尝试应用每个提交时遇到冲突，似乎有些不对劲。我没有在稳定分支上进行本地更改/提交。

```
git fetch 
git fetch --tags
git rebase 2.8

First, rewinding head to replay your work on top of it...
Applying: Prepare the branch for the inevitable.
error: patch failed: wp-includes/version.php:8
error: wp-includes/version.php: patch does not apply
Using index info to reconstruct a base tree...
Falling back to patching base and 3-way merge...
Auto-merging wp-includes/version.php
CONFLICT (content): Merge conflict in wp-includes/version.php
Failed to merge in the changes.
Patch failed at 0001 Prepare the branch for the inevitable.

When you have resolved this problem run "git rebase --continue".
If you would prefer to skip this patch, instead run "git rebase --skip".
To restore the original branch and stop rebasing run "git rebase --abort". 
```

如何将我的稳定分支“移动”到 2.8 标签？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-18T07:25:21.957

```
# git checkout stable
# git reset --hard 2.8 
```

你去吧。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-06-18T04:08:54.757

使用“git checkout 2.8”。

如果你想移动“稳定”，你可以简单地删除/重新创建它：

```
$ git checkout 2.8
$ git branch -d stable
$ git checkout -b stable 
```

# c# - C#中的守护进程监听按键

> ID：1010723
> 
> 赞同：1
> 
> 时间：2009-06-18T04:04:19.030
> 
> 标签：c#, keyboard, daemon, keypress

我正在寻找创建一个小型 C# 应用程序，该应用程序将作为守护程序运行或坐在任务栏中，并等待特定的按键。当遇到预期的按键时，我将执行一些操作。

这将主要用于将数据快速发布到我正在编写的网络服务中。我在网上浏览了一段时间，但我的搜索词太模糊了，我还没有遇到任何具体的例子或指南。

谢谢，

迈克·特雷西奇

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T04:10:32.433

我在 CodeProject 上遇到了这个。它会在不集中时捕获击键。 [CodeProject：一个简单的 C# 全局低级键盘钩子](http://www.codeproject.com/KB/cs/CSLLKeyboardHook.aspx?fid=423705&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2800876)

# linux - 我可以阅读 Linux 内核的哪些部分以获得乐趣？

> ID：1010724
> 
> 赞同：38
> 
> 时间：2009-06-18T04:05:56.330
> 
> 标签：linux, open-source, operating-system, kernel

编程不是我的主要工作，尽管我喜欢它并且有时会为此获得报酬。多年来，我一直在听说 Linux，我的朋友向我展示了许多 *nix（或 *nici？），尽管我坚持使用 Mac OS。

你认为 Linux 内核的任何部分是我喜欢看的，这将有助于我理解全部内容吗？例如，Linux 与达尔文有何不同？

我是在汇编程序和 DOS 下长大的，所以中断或低级 C 之类的东西不应该成为理解的障碍。但最后我对高级概念更感兴趣，比如线程或网络堆栈——我知道不同的操作系统做它们的方式不同。我正在寻找一些有趣、轻松和愉快的东西，比如深夜阅读。

（注：做了一个CW，以防万一）

更新：我查找了一些文档并开始阅读：

*   [不可靠的锁定指南](http://kernelnewbies.org/Documents/Kernel-Docbooks?action=AttachFile&do=get&target=kernel-locking_2.6.29.pdf)

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-06-19T02:31:48.657

我建议看看[LXR](http://lxr.linux.no/linux)。它使遵循代码流变得更容易（您不必搜索每个调用的函数——嗯，你有，但网站会为你做）。

当前版本（2.6.30）的一些起点：

*   [`start_kernel()`](http://lxr.linux.no/linux+v2.6.30/init/main.c#L536)— 将其视为`main()`. 这个函数初始化了几乎所有的内核子系统；按照它在代码中查看您在引导期间在屏幕上看到的滚动内容。
*   [entry_32.S](http://lxr.linux.no/linux+v2.6.30/arch/x86/kernel/entry_32.S) — 系统调用和中断（x86-32 版本，应该更接近您所知道的；注意使用 AT&T 程序集方言而不是您可能更习惯的英特尔方言）。
*   [head_32.S](http://lxr.linux.no/linux+v2.6.30/arch/x86/kernel/head_32.S) — 内核入口点。这是内核切换到保护模式后启动的地方；最后，它会调用`start_kernel()`.
*   [arch/x86/boot](http://lxr.linux.no/linux+v2.6.30/arch/x86/boot/) — 实模式引导代码。它从汇编（[boot/header.S](http://lxr.linux.no/linux+v2.6.30/arch/x86/boot/header.S)）开始，但很快跳转到 C 代码（从[boot/main.c](http://lxr.linux.no/linux+v2.6.30/arch/x86/boot/main.c)开始）。是否进行实模式初始化（​​主要是在切换到保护模式之前必须完成的 BIOS 调用）；它是使用一个奇怪的 GCC 技巧 ( `.code16gcc`) 编译的，它允许生成 32 位实模式代码。
*   [arch/x86/boot/compressed——](http://lxr.linux.no/linux+v2.6.30/arch/x86/boot/compressed/)如果你想知道“Decompressing Linux...”消息是从哪里来的，它就来自这里。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-06-18T04:13:53.700

我自己，我一直觉得任务调度代码有点麻烦：-/

我认为你需要让自己在这个行业之外有一个爱好。或者生活:-)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-06-18T04:15:01.097

内核中的注释可能很有趣。有一些[关于在哪里可以找到](http://kerneltrap.org/node/542)kerneltrap 上最好的提示的提示。

> arch/sparc/lib/checksum.S- /* Sun，你就是打不过我，你就是打不过。停止尝试，arch/sparc/lib/checksum.S：* 放弃。我是认真的，我要把你这活生生的狗屎arch/sparc/lib/checksum.S-*踢出去，游戏结束，熄灯。*/

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-03-21T05:12:30.790

[linux-0.01.tar.gz](http://www.kernel.org/pub/linux/kernel/Historic/linux-0.01.tar.gz)是 Historic Kernel 并且适合启动
它简单而小巧并且更适合开始阅读
（它也有 void main(void) 而不是 start_kernel() 哈哈：D）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-18T04:18:53.593

在深入研究 Linux 内核之前，您可能想阅读或浏览一本描述 Linux 内核的书。

想到的书有：

*   [了解 Linux 内核，第二版](http://oreilly.com/catalog/9780596002138/)
*   [UNIX操作系统的设计](https://rads.stackoverflow.com/amzn/click/com/0132017997)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-18T05:41:50.867

您需要在您的上下文中重新定义“有趣”这个词。:)

也就是说，Linux 内核可能是一个太大的怪物。首先，您可能希望从一些学术或更原始的内核开始了解正在发生的事情。您可能还想考虑[Jolix](http://www.amazon.com/s/ref=nb_ss_gw?url=search-alias%3Daps&field-keywords=jolitz+kernel&x=0&y=0)的书。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-18T04:17:10.643

您可能会从阅读有关操作系统理论的书中获得更多信息。就源代码而言：我不知道，但您可以轻松下载[Linux 内核源代码](http://www.kernel.org/)，看看是否能找到任何吸引人的东西。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-18T05:40:48.323

当在 src 目录中运行时，这应该会出现一些有趣的代码：

```
grep -ir "fixme" * 
```

也可以尝试其他滑稽的术语，废话，狗屎，f ***，企鹅等。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-18T05:50:01.490

很多人都推荐，linux v0.0.1 是最容易理解的。

但是，如果您正在寻找好的内核源代码来阅读，我不会使用 linux，它是一个 hack 的野兽（就像说 GCC 源代码是“有趣的”）相反，您可能希望尝试 Minix 或其中一个BSD（Darwin 基本上是 NetBSD iirc 的一个分支）甚至是许多免费的 DOS 克隆之一，如果其他一切都太吓人的话..

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-06-22T21:17:14.317

尝试阅读实现这些字符设备的代码： /dev/zero /dev/null /dev/full

如果你愿意的话，也许是随机数生成器。该代码比所有其他设备驱动程序都简单明了，因为它不涉及任何硬件。

从驱动程序/字符/内存开始。*

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-01-13T09:23:42.660

[内核.h](https://code-grep.com/view/project/54b083273b2082684a000008/linux-3.19-rc2/tools/virtio/linux/kernel.h)

我们可以学习一些简单的技巧，例如

```
#define ARRAY_SIZE(x) (sizeof(x)/sizeof(x[0]))
...
#define min(x, y) ...
...
#define container_of 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-06-30T18:33:27.550

为了好玩，我想您还可以看到 Minix，它不完全是 linux，但 tenenbaum 的 Modern Operating systems 是一本不错的读物。

# c# - 从 URL 中隐藏 default.aspx

> ID：1010727
> 
> 赞同：3
> 
> 时间：2009-06-18T04:07:16.130
> 
> 标签：c#, asp.net, seo, url-rewriting

我想知道是否有解决方案使用 IIS6 让应用程序摆脱 url 中的 default.aspx 文本。例如，如果用户点击：

www.website.com/default.aspx

浏览器只显示：

www.website.com/

无论。这只是为了搜索引擎优化。

我已经在我的应用程序中使用 UrlRewriting.NET 进行了一些重写，但是我没有那么聪明地为此创建规则。

非常感谢任何帮助。

谢谢。何塞

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-02T23:29:24.180

我认为 ScottGu 已经涵盖了在 ASP.NET 中重写的主题：[http](http://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx) ://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx .

他涵盖了以下内容：

*   使用 UrlRewriter.net 重写，ISAPI 重写
*   ASP.NET 技巧，回发（点击友好版本的 url）

对于您的问题，我认为您需要结合使用，永远不要链接到“default.aspx”，即。仅链接到“/”。然后使用 Scott 的 Form Postback 浏览器文件来确保回发总是命中同一个友好版本的 url。

将“default.aspx”重定向到“/”，然后由“default.aspx”提供服务，这对我来说听起来像是一场灾难。只需修复您的链接，以确保您永远不会明确地使用“default.aspx”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-02T23:38:11.603

我认为更改搜索结果索引的最简单方法（假设它知道 HTTP 301）是在 default.aspx 的 Page_Load 中编写一个小函数，该函数使用 301 永久移动（或 302 临时移动）重定向浏览器。

```
void Page_Load(...) {

    if(Request.Path.EndsWith("default.aspx", true/*case-insensitive*/, null)) {
       Response.StatusCode = 301;
       Response.StatusDescription = "Moved Permanently";
       Response.Headers.Add("Location", "/");
       HttpContext.Current.ApplicationInstance.CompleteRequest(); // end the request
    }

    // do normal stuff here
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T10:50:37.190

如果将 default.aspx 设置为在 IIS 中提供的默认文档，并且您的所有内部站点链接都包含*没有*default.aspx 的 URL，那么我认为这应该可以解决问题。

尽管用户仍然可以输入*default.aspx*，但搜索引擎蜘蛛应该只从您的链接 href 属性中获取更友好的 URL。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T05:15:16.793

如果您需要进行 URL 重写，那么您需要做的就是确保您的链接指向正确的 URL。

如果您不修复链接，则由浏览器决定是否要显示它请求的实际链接。

如果你真的想做一个狡猾的工作，你可以使用一些 javascript 使浏览器的地址栏显示你喜欢的任何内容，即使它是无效的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T05:22:25.867

我这样做的方法是在公共类 Global 中使用 Application_BeginRequest ： System.Web.HttpApplication 并检查 HttpContext.Current.Request.URL 的 default.aspx，然后从那里使用 HttpContext.Current.Response.Redirect 如果你发现它。

缺点是重定向并不总是那么好，如果您将数据发布到该 default.aspx 页面，这将不起作用。但是你不能简单地欺骗浏览器显示不同的 url，尽管你可以告诉 ASP.NET 为任何请求提供你想要的任何页面。

# java - 对 Project Euler #200 有帮助吗？

> ID：1010739
> 
> 赞同：1
> 
> 时间：2009-06-18T04:12:36.460
> 
> 标签：java

> **可能重复：**
> [需要帮助解决 Project Euler 问题 200](https://stackoverflow.com/questions/778387/need-help-solving-project-euler-problem-200)

类似于[这个问题](https://stackoverflow.com/questions/778387/)

[欧拉计划问题 200。](http://projecteuler.net/index.php?section=problems&id=200)

我用 Java 编写了一个蛮力解决方案，需要几个小时才能运行，并生成了前 500 多个 sqube 数字，我认为这应该足够了。但是，从 190 到 210 的答案似乎都不是正确答案。

我想知道我在这里做错了什么以及如何优化它。问题可能出在`BigInteger.isProbablePrime()`哪里？

我不确定 Stackoverflow 是否是问这个问题的最佳场所，但我似乎被困住了。我已经包含了我的代码和生成的数据。

如果有人能给我一些提示或指示，我将不胜感激。

**编辑：**我使用前 500,000 个素数再次运行程序；花了一天的时间运行，但产生了正确的答案。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-06-19T18:56:05.863

我是 Project Euler 的管理员。请不要发布可能破坏他人问题的信息，尤其是代码和答案，甚至是半功能代码。请相应地编辑您的问题。编辑：谢谢你这样做！

求解者使用网络搜索解决问题的信息并不少见，如果他们偶然发现了这样的剧透，这将带走一些乐趣。（是的，我知道有些网站有很多现成的解决方案，但至少它们通常是针对编号较低的简单问题。）

我们有[讨论](http://forum.projecteuler.net/)问题的困难和获取提示的论坛，这些论坛针对剧透进行了积极的编辑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T15:56:38.017

难道你不应该想出一个不需要一天甚至一个小时就能运行的聪明的解决方案吗？:D 我认为问题在于 isProbablePrime，它不能保证一个数字是素数。它只是说找到的素数可能是具有一定概率的素数。你应该使用一种算法，它可以确定它已经找到了一个素数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T18:33:21.050

第一个答案是不正确的，因为 isProbablyPrime 并不总是正确的（因此可能）。它很慢，部分原因是您使用的是 BigInteger。所涉及的所有值都适合长。为什么不用长的？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-20T00:56:12.707

您可以进行一些简单的重构，以节省一些时间。似乎大部分时间都花在了嵌套的 for 循环中。数量级是 n 的平方。您可以通过不嵌套循环来降低复杂性。另一个问题是您发现的潜在结果比需要的要多。您只需要找到 200。您需要找到更多的原因是因为您没有按数字顺序找到潜在结果。TreeSet 确实使结果保持有序，但如果算法能够在找到第 200 个结果时停止，算法会更快。

# bash - 如何使用 bash 跨服务器 scp？

> ID：1010748
> 
> 赞同：-2
> 
> 时间：2009-06-18T04:15:11.377
> 
> 标签：bash, scp

可行吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T04:21:58.183

嗯，是的，是的。这个怎么样？

```
scp pax@machine1:/tmp/qq pax@machine2:/tmp/qq 
```

要么就是这样，要么我在你的问题中遗漏了一些基本的东西。

看：

```
usage: scp [-1246BCpqrv] [-c cipher] [-F ssh_config] [-i identity_file]
       [-l limit] [-o ssh_option] [-P port] [-S program]
       [[user@]host1:]file1 ... [[user@]host2:]file2 
```

# java - 丢失的套接字消息

> ID：1010753
> 
> 赞同：4
> 
> 时间：2009-06-18T04:18:10.350
> 
> 标签：java, c, sockets

我从事套接字编程已经很多年了，但我从来没有使用 TCP 丢失过消息——直到现在。我在 C 语言中有一个 java 服务器和一个客户端 - 都在本地主机上。他们以字符串的形式来回发送短消息，中间有一些延迟。我有一个特殊情况，消息永远不会到达客户端。它是可重现的，但奇怪的是依赖于机器。

为了提供更多细节，我可以调试服务器端并查看发送和刷新。我可以附加到客户端并遍历选择调用（在循环中），但它根本不会出现。有没有人遇到过这种情况，除了编码错误还有其他解释吗？

换句话说，如果您有一个已连接的套接字并在一侧进行写入并在另一侧进行读取，那么中间会发生什么导致这样的事情？

另一个细节 - 我在环回接口上使用了 tcpdump 并且可以看到丢失的消息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T04:27:00.333

我以前在 SMTP 事务中看到过这种情况。您在那台机器上运行病毒扫描程序吗？如果是这样，请尝试将其关闭，看看是否会有所不同。

否则，我建议安装[Wireshark](http://www.wireshark.org/)，以便您查看实际发生的情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T05:43:12.173

最后 - 在嗅了一些之后，我发现了问题。在读取之前发送了两条消息（有时，但很少......），所以它们都被读取了，但只有第一条被处理。这就是为什么第二条消息似乎从未到达的原因。它被埋在接收缓冲区中。

# php - 为什么我的 PHP 变量不会出现在 CakePHP 视图的 HREF 中？

> ID：1010755
> 
> 赞同：0
> 
> 时间：2009-06-18T04:18:25.810
> 
> 标签：php, cakephp

在我的 CakePHP 代码中，我有以下代码。如果我单击图像删除它会移动到href中的链接。在 href 我不知道如何显示我的 php 值。我像下面这样尝试过，但它没有用。

```
 <a href="http://localhost/cake_1.2.1.8004/index.php/forms/delete/"<?php echo $r['Form']['id'];?> >
    <img border="0" alt="Delete" src="/cake_1.2.1.8004/app/webroot/img/delete.png"/>
  </a> 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T04:29:28.540

使用 cakephp 查看助手：

```
<?php
    echo $html->link(
        $html->image('delete.png'),
        array('action'=>'delete', $r['Form']['id']),
        array(),
        'really delete?',
        false
    );
?> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T04:22:36.700

将您的回声放在引号中：

```
<a href="http://localhost/cake_1.2.1.8004/index.php/forms/delete/<?php echo $r['Form']['id'];?>">
    <img border="0" alt="Delete" src="/cake_1.2.1.8004/app/webroot/img/delete.png"/>
</a> 
```

# unit-testing - 如何设置 ManagementException 的 ErrorCode？

> ID：1010773
> 
> 赞同：1
> 
> 时间：2009-06-18T04:25:36.963
> 
> 标签：unit-testing, exception, mocking, error-code

我只想为特定的 ErrorCode 处理 ManagementException 异常，并且在为其编写单元测试时遇到了麻烦。通常，我会编写测试，使其类似于以下内容：

```
Searcher search = MockRepository.GenerateMock<Searcher>(); 
// wrapper for ManagementObjectSearcher

...

search.Expect(s => s.Get()).Throw(new ManagementException());

... 
```

但是，这并没有将 ErrorCode 设置为我特别想要的那个，实际上 ManagementException 没有设置该值的构造函数。

如何才能做到这一点？

（请注意，我使用 RhinoMocks 作为我的模拟框架，但我假设这是独立于框架的；这里我需要知道的是如何创建一个具有特定 ErrorCode 值的 ManagementException。我还在`System.Management.ManagementException.ThrowWithExtendedInfo(ManagementStatus errorCode)`网上找到了一些对方法的引用但这似乎无法公开访问）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-06T05:42:30.923

克服这个障碍的最少努力是使用反射来破解所需错误代码中的静态帮助器/实用程序方法。使用最优秀的反射器，我看到有一个私有的“errorCode”字段，它只能通过 ManagementException 中定义的内部ctors 设置。所以 ：）

```
public static class EncapsulationBreaker
   {
      public static ManagementException GetManagementExceptionWithSpecificErrorCode(ManagementStatus statusToBeStuffed)
      {
         var exception = new ManagementException();
         var fieldInfo = exception.GetType().GetField("errorCode", 
            BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.GetField | BindingFlags.DeclaredOnly);
         fieldInfo.SetValue(exception, statusToBeStuffed);
         return exception;
      }
   } 
```

验证它有效

```
[Test]
      public void TestGetExceptionWithSpecifiedErrorCode()
      {
         var e = EncapsulationBreaker.GetManagementExceptionWithSpecificErrorCode(ManagementStatus.BufferTooSmall);
         Assert.AreEqual(ManagementStatus.BufferTooSmall, e.ErrorCode);
      } 
```

尽管**我通常不赞成在测试中进行反思**，但这是需要/有用的罕见情况之一。
高温高压

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-06T03:50:58.183

从 ManagementException 派生一个类并用您自己的隐藏错误代码实现。让你的模拟返回这个类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-06T03:53:48.083

我会继承子类`ManagementException`并在子类中覆盖`ErrorCode`getter（如果正常的保护级别阻止你这样做，也许内省可以让你更接近）。毕竟，任何处理`ManagementException`但从未听说过您的特定子类的代码都应该“好像”处理您的子类，因为它是`ManagementException`您为了测试目的而试图模拟的。

**编辑**：可以想象，`ErrorCode`不能被覆盖（我讨厌如此僵化的语言，以至于他们可以以这种方式停止测试，但不能否认它们存在；-）。在这种情况下，*依赖注入*仍然可以拯救你——DI 是我最喜欢的测试模式之一。

DI 在测试中的目的是将被测代码与会抑制可测试性的严格假设分离——这正是我们在这里所拥有的，尽管是以一种不寻常的形式。例如，您的被测代码当前确实`x.ErrorCode`会获取异常 x 的错误代码。很好，然后它必须做，而不是，通常只做的委托`getErrorCode(x)`在哪里；并且它必须有一个委托的设置器，以便出于测试目的，您可以将其更改为一个委托（或您想要模拟以进行测试的任何错误代码值）。`getErrorCode``return x.ErrorCode``getErrorCode``return 23`

细节可能会有所不同，但依赖注入可以（除其他外）帮助补偿您不可避免地从系统（或您无法直接修改的其他库和c）获得的对象中的某些过度僵化，如本例所示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-06T04:24:13.310

有一个非常简单和小的方法或类来捕获该异常并从中获取错误代码，然后将其传递给执行该工作的真实类。在测试中，将该代码替换为直接传递给真正的类，当你得到错误代码时你会传递什么。

最明显的方法是对异常进行子类化，但如果这不起作用，那么捕获它并立即抛出您自己的异常并允许您公开该代码的代码将是另一种选择。

# iphone - 在 iPhone 上加载外部 .bundle

> ID：1010775
> 
> 赞同：0
> 
> 时间：2009-06-18T04:26:38.353
> 
> 标签：iphone

我想将资源文件添加到 .bundle 并将它们推送到我的应用程序，它似乎在模拟器中工作正常，但当我更改为设备时无法构建。

> /Users/sosborn/Projects/MyPro/build/Debug-iphoneos/FooBar.bundle：目标文件格式无效或不合适

我不想加载任何代码或任何东西，只想加载纯文本和 jpeg，能够将它们打包为依赖项会很好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T08:20:08.380

iPhone 和 iPod touch 不支持加载外部模块（`bundle`s 和`dylib`s 都不支持）。如果需要在项目之间共享目标代码，可以使用静态库

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T08:13:09.713

与其像 NSBundle 一样尝试加载它，只需通过路径引用其中的资源。

您可以很容易地创建自己的类，该类执行类似于 NSBundle 中的非代码内容的操作来提供帮助，因为其中确实没有太多逻辑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T03:48:19.820

我找到了一个更好的解决我的问题的方法。它实际上根本不需要使用捆绑包。我刚刚创建了一个聚合目标而不是捆绑目标。然后我添加了一个复制步骤和一个脚本步骤。复制步骤包含我在捆绑目标中拥有的所有资源，脚本步骤实际上是压缩文件。然后，当我将内容下载到我的应用程序中时，我可以将其解压缩并像捆绑一样使用它，因为我只是存储资源依赖项。

谢谢你的帮助。

# ruby-on-rails - Rails：在 Lib 中使用 ActionView 方法清理时出错

> ID：1010778
> 
> 赞同：2
> 
> 时间：2009-06-18T04:27:10.943
> 
> 标签：ruby-on-rails

我正在尝试使用 ActionView 中的 Sanitize 方法。

这条线`r_str = Helper.instance.sanitize(r_str, :tags => @@allowed_tags, :attributes => @@allowed_attribs)`给了我错误

```
undefined method `white_list_sanitizer' for Parsers::HTML::Helper:Class 
```

这是我的代码`lib/parsers.rb`

```
module Parsers
  module HTML
    @@allowed_tags = %w(--snip--)
    @@allowed_attribs = %w(--snip--)

    class Helper
        include Singleton
        include ActionView::Helpers::SanitizeHelper
    end

    #Use built-in santizer and the Hpricot plugin
    def self.clean(str)
      rgx = /<code>(.*?)<\/code>/ #All html within a code tag should be escaped.
      r_str = str.gsub(rgx) { |match| "<code>" + CGI.escapeHTML(match[5..-7]) + "</code>" } # TODO: test this.
      r_str = Helper.instance.sanitize(r_str, :tags => @@allowed_tags, :attributes => @@allowed_attribs)
      Hpricot(r_str)
    end

  end

  --snip-- 

end 
```

我究竟做错了什么？

（请不要评论允许用户提交 HTML 的危险，我知道风险）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-18T08:54:54.267

只需做而不是“包括 ActionView::Helpers::SanitizeHelper”，

```
 include ActionView::Helpers 
```

上面的这将混合来自 SanitizeHelper 的 ClassMethods，并且您的代码将起作用。

注意：我还看到了明确建议：

```
extend ActionView::Helpers::SanitizeHelper::ClassMethods 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T10:54:37.120

您还需要来自 sanitize helper 的类方法

```
 class Helper
   include Singleton
   include ActionView::Helpers::SanitizeHelper

   class << self
     include SanitizeHelper::ClassMethods
   end
 end 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-11-18T17:50:45.397

rails 中的正确类是`HTML::Sanitizer`

# windows-mobile - Windows Mobile 滚动用户界面

> ID：1010779
> 
> 赞同：1
> 
> 时间：2009-06-18T04:27:26.527
> 
> 标签：windows-mobile

我想为 Windows Mobile 开发一个滚动 UI。请为我推荐参考资料以帮助我入门。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T07:58:25.243

你为什么不缩小一点：

1.  您使用哪种编程语言？C#、C++、Java
2.  可以选择开发环境吗？

这里有一些提示：

1.  [掌上电脑开发者网络](http://pocketpcdn.com/)
2.  [MSDN Windows 移动版](http://msdn.microsoft.com/en-us/library/bb847935.aspx)

# c++ - std::string.c_str() 使用什么编码？

> ID：1010783
> 
> 赞同：36
> 
> 时间：2009-06-18T04:29:33.810
> 
> 标签：c++, string, utf-8

我正在尝试将 C++ 转换`std::string`为 UTF-8 或`std::wstring`不丢失信息（考虑包含非 ASCII 字符的字符串）。

根据[http://forums.sun.com/thread.jspa?threadID=486770&forumID=31](http://forums.sun.com/thread.jspa?threadID=486770&forumID=31)：

> 如果 std::string 有非 ASCII 字符，您必须提供一个函数，将您的编码转换为 UTF-8 [...]

使用什么编码`std::string.c_str()`？如何将其转换为 UTF-8 或`std::wstring`跨平台方式？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-06-18T04:32:31.703

`std::string`本身不使用编码——它将返回您放入其中的字节。例如，这些字节可能正在使用 ISO-8859-1 编码......或任何其他，真的：关于编码的信息不存在 - 你必须知道字节来自哪里！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-18T04:34:46.103

`std::string`包含任何字节序列，因此编码由您决定。您必须知道它是如何编码的。但是，如果您不知道它是其他东西，它可能只是 ASCII。在这种情况下，它已经兼容 UTF-8。

# ruby-on-rails - FormHelper::label 和 FormTagHelper::label_tag 有什么区别？

> ID：1010784
> 
> 赞同：9
> 
> 时间：2009-06-18T04:31:45.463
> 
> 标签：ruby-on-rails

我正在编写一个处理多个模型的表单。如何做到这一点的一些例子使用[ActionView::Helpers::FormHelper::label](http://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#M001891)，一些使用[ActionView::Helpers::FormTagHelper::label_tag](http://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#M002017)，我不太明白其中的区别。

在我的特殊情况下，两者似乎都会产生相同的输出：

```
<% form_for :post, :url => { :action => 'create' } do %>
  <p>
    <%= label_tag 'post_type' %><br />
    <%= text_field :post, :post_type %>
  </p>
  <p>
    <%= label :post, :parent_post_id %><br />
    <%= text_field :post, :parent_post_id %>
  </p>
  ... 
```

渲染：

```
 <p>
    <label for="post_type">Post type</label><br />
    <input id="post_post_type" name="post[post_type]" size="30" type="text" />
  </p>
  <p>
    <label for="post_parent_post_id">Parent post</label><br />
    <input id="post_parent_post_id" name="post[parent_post_id]" size="30" type="text" />
  </p> 
```

标签助手似乎更有用，因为它可以做一些额外的事情，因为它知道它所标记的模型和属性，但我找不到任何支持它的东西。两者之间有实际区别吗？我什么时候应该使用一个助手而不是另一个？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-18T06:19:05.283

Rails 提供了两种类型的表单助手：专门处理模型属性的和不使用的。*_tag 帮助器用于创建不依赖于分配给模板的 Active Record 对象的表单标签。

`label`尽管如您所示，为元素生成的标记没有区别，但在您的情况下，您应该使用`label`表单助手以与您使用其他表单助手保持一致，因为它会自动将`for`属性设置为正确的 ID关联的文本字段元素。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-11-11T12:38:36.560

`f.label`当您在使用创建的表单对象中`form_for(...) do |f|`并想要引用模型属性时使用。如果您的应用程序是 i18n-ed，Rails 将使用翻译来显示属性名称。

`label_tag`当您不在表单对象中时使用。（或者您在表单对象中，但想为非模型属性创建一个虚拟标签。）

所有的表单输入都有这两种变体，带和不带`_tag`后缀，比如`select`and`select_tag`等

# web-applications - 基于浏览器的实时游戏

> ID：1010787
> 
> 赞同：0
> 
> 时间：2009-06-18T04:33:13.747
> 
> 标签：web-applications

我想实现一个支持大量成员并提供实时操作的 bbg。

我目前的游戏一直在运行，但它似乎很快就烧毁了。

我使用的方法是轮询。我猜空闲用户的浪费使服务器烧毁（服务器是C#，客户端是Javascript）

我该怎么做才能解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-01-12T23:40:17.963

也许[http://goldfishserver.com](http://goldfishserver.com)可能对您有用（即 Comet 服务器）。它提供了一个简单的 API 来允许将通知推送到您的网页。简而言之，当您的数据更新时，将其（一些有效负载数据）发送到 Goldfish 服务器，您的客户端浏览器将收到通知，其中包含相同的数据。

回合制游戏非常适合金鱼，尽管可能会使用更“大世界”的系统，具体取决于您的设计。

免责声明：我是一名开发金鱼的开发人员。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-09-08T15:13:54.720

你总会有一些滞后。我不确定您是否正在轮询单个更新，但您可以查看以下一些操作以降低滞后和密集的服务器资源：

*   轮询一次以获取所有更新。不要在一个呼叫中轮询“生命数”而在另一个呼叫中轮询“位置”，一键完成所有操作。

*   轮询较少，因为更新较少。当有很多更新时，我会经常投票。当没有或更少的新更新时，我会减少轮询频率。

*   最后，我会发送多个更新，并注明它们发生的时间。因此，假设玩家 x 移动到 5,5，然后攻击某人并移动到 5,8。那将是在一次民意调查中返回的三个不同事件。前端将负责以对用户有意义的方式随时间显示这些变化。

我认为这不是最终解决方案。这更多是关于如何更好地处理轮询方面的建议。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T04:53:21.960

如果您希望某些东西实时做出反应，轮询将无法完成这项工作。您将需要通过长时间运行的 http 连接或其他方式使用某种持久连接。（彗星）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T05:43:27.523

HTTP 中的持久连接/轮询可能很棘手，正如您所指出的，无论如何效率都不是很高。我建议迁移到支持服务器推送消息的基于插件的游戏。也许是[Unity](http://unity3d.com)，因为它基本上是为游戏设计的，但如果你想要更普遍的东西，那就是 Flash。

如果您真的想坚持使用 HTML，则可以使用混合解决方案，通过插件传递消息并在响应中重写 DOM。

# python - python中的字典？

> ID：1010788
> 
> 赞同：-1
> 
> 时间：2009-06-18T04:34:35.557
> 
> 标签：python, dictionary, traversal

我以多少种方式遍历python中的字典？？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T04:45:50.653

很多种方法！

```
testdict = {"bob" : 0, "joe": 20, "kate" : 73, "sue" : 40}

for items in testdict.items():
    print (items)

for key in testdict.keys():
    print (key, testdict[key])

for item in testdict.iteritems():
    print item

for key in testdict.iterkeys():
    print (key, testdict[key]) 
```

这只是一些，但它开始从这些简单的方式转向更复杂的方式。所有代码都经过测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T04:44:59.000

如果我正确解释了您的问题，您可以通过多种方式横向字典。

适合初学者的好读物位于[此处](http://www.diveintopython.org/getting_to_know_python/dictionaries.html)。

此外，字典可能不是您最好的选择。更多信息会很有帮助，更不用说它会帮助您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T04:46:57.143

[http://docs.python.org/tutorial/datastructures.html#looping-techniques](http://docs.python.org/tutorial/datastructures.html#looping-techniques)

```
>>> knights = {'gallahad': 'the pure', 'robin': 'the brave'}
>>> for k, v in knights.iteritems():
...     print k, v
...
gallahad the pure
robin the brave 
```

# tsql - 如何在此查询中使用 Count 子句？

> ID：1010793
> 
> 赞同：1
> 
> 时间：2009-06-18T04:35:21.547
> 
> 标签：tsql

我有一个相当昂贵的查询，它返回一页结果：

```
SELECT * FROM 
    (SELECT         
        ROW_NUMBER() OVER (ORDER BY j.PostDate DESC) as Row,                                            
        FROM 
            JobListing j, 
            Location l, 
            City c,
            JobListing_Skill_XREF js,
            @SkillTable st            
        WHERE 
            DistanceBetween(@lat,@long, c.Lat,c.Long) <= @miles AND
            js.Skill_ID = st.id AND                     
            j.location = l.id AND
            j.id = js.JobListing_Id AND         
            l.CityID = c.Id             
    ) AS RESULTS
    WHERE Row Between (@PageNumber - 1) * @PageSize + 1 and (@PageNumber * @PageSize) 
```

我想做的也是返回内部查询的总数，以便我可以计算总页数。

但是，我不知道如何将 COUNT 子句插入其中，并且我真的不想将其选择到临时表中或运行两次以计算页数。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T12:21:38.190

```
SELECT * FROM 
        (SELECT                 
                ROW_NUMBER() OVER (ORDER BY j.PostDate DESC) as Row,
                COUNT(*) OVER() AS total
                FROM 
                        JobListing j, 
                        Location l, 
                        City c,
                        JobListing_Skill_XREF js,
                        @SkillTable st                    
                WHERE 
                        DistanceBetween(@lat,@long, c.Lat,c.Long) <= @miles AND
                        js.Skill_ID = st.id AND                                         
                        j.location = l.id AND
                        j.id = js.JobListing_Id AND                     
                        l.CityID = c.Id                         
        ) AS RESULTS
        WHERE Row Between (@PageNumber - 1) * @PageSize + 1 and (@PageNumber * @PageSize) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T05:01:29.753

使用[CTE](http://msdn.microsoft.com/en-us/library/ms190766.aspx)吗？类似的东西（显然无法测试:) ...

```
WITH R (Row) 
AS 
(
  SELECT                                 
  ROW_NUMBER() OVER (ORDER BY j.PostDate DESC) as Row,
  FROM JobListing j, Location l, City c, JobListing_Skill_XREF js,@SkillTable st
  WHERE DistanceBetween(@lat,@long, c.Lat,c.Long) <= @miles AND 
    js.Skill_ID = st.id AND
    j.location = l.id AND
    j.id = js.JobListing_Id AND
    l.CityID = c.Id      
)
SELECT R.*, COUNT(R.*) AS [Count] FROM R
WHERE R.Row Between (@PageNumber - 1) * 
  @PageSize + 1 and (@PageNumber * @PageSize) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T05:46:28.813

这是我能做的最好的，我很想知道人们是否有更好的建议：

```
DECLARE @JobTable TABLE
(
    ...snip...
);
INSERT INTO @JobTable 
    SELECT          
        ROW_NUMBER() OVER (ORDER BY j.PostDate DESC) as Row,
        j.*                     
        FROM 
            JobListing j, 
            Location l, 
            City c,
            JobListing_Skill_XREF js,
            @SkillTable st            
        WHERE 
            DistanceBetween(@lat,@long, c.Lat,c.Long) <= @miles AND
            js.Skill_ID = st.id AND                     
            j.location = l.id AND
            j.id = js.JobListing_Id AND         
            l.CityID = c.Id 

SELECT * 
         FROM @JobTable
         WHERE 
               Row BETWEEN 
                 (@PageNumber - 1) * @PageSize + 1 
                 AND (@PageNumber * @PageSize)

SELECT @TotalRows = Count(1) FROM @JobTable; 
```

# python - 自定义 Django 自动管理术语

> ID：1010794
> 
> 赞同：2
> 
> 时间：2009-06-18T04:36:20.720
> 
> 标签：python, django

我正在玩 Django 的管理模块，但我似乎遇到了一点麻烦，这比错误更令人烦恼。我使用 UserData 和 Status 之类的名称设置模块，因此 Django 的管理面板喜欢尝试将 UserData 中的每一行称为用户数据，将每个状态称为状态。有什么方法可以更改术语，例如，它会说配置文件而不是用户数据。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T04:40:25.367

您可以在模型的内部类中定义`verbose_name`和覆盖那里使用的值。请参阅[http://docs.djangoproject.com/en/dev/ref/models/options/#verbose-name-plural](http://docs.djangoproject.com/en/dev/ref/models/options/#verbose-name-plural)`verbose_name_plural``Meta`

# mysql - mysql查询

> ID：1010796
> 
> 赞同：0
> 
> 时间：2009-06-18T04:38:00.377
> 
> 标签：mysql

我有一张这样的桌子：

```
col1   col2

2001   3001
2002   3001
2003   3001
2004   3002
2002   3003
2001   3003 
```

我想创建一个查询，找出 col1 中的项目与 col1 中的某个项目的所有组合，如果它们发生在 col2 中的同一项目上，以及出现的频率。例如，如果我们想在 col1 中探索项目编号“2001”，则查询应返回：

```
col3   col4   col5
2001   2002   0.667
2001   2003   0.333 
```

有人可以给我一个提示吗？提前谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T04:52:10.913

以这种方式考虑，您正试图通过 col2 将表与自身相关联，因此我们将从连接到自身开始：

```
select left.col1, right.col1/*, ...*/ from table left inner join table right on left.col2 = right.col2 where left.col1 = '2001' /* ... */ 
```

现在为您的聚合。您想聚合 all right.col1 以获取该列的计数：

```
select left.col1, right.col1, COUNT(*) from table left inner join table right on left.col2 = right.col2 where left.col1 = '2001' group by right.col2 
```

我相信这应该是原始数据。我相信您必须重新查询并获得总数才能获得频率。

请注意，如果 col1 不是常数，这将更加复杂。

**编辑添加**：如果您正在寻找一个查询，而不是用您查询的任何语言对其进行迭代，您需要进行两次分组：

```
SELECT abs_freq.col1, abs_freq.col2, abs_freq.freq / totals.total
FROM (SELECT
       left.col1 AS col1,
       COUNT(*)  AS total
      FROM TABLE LEFT
      INNER JOIN TABLE RIGHT
        ON left.col2 = right.col2
      WHERE left.col1 = '2001'
      GROUP BY left.col1
      ) totals
INNER JOIN (SELECT
              left.col1  AS col1,
              right.col1 AS col2,
              COUNT(*)   AS freq
            FROM TABLE LEFT
            INNER JOIN TABLE RIGHT
              ON left.col2 = right.col2
            WHERE left.col1 = '2001'
            GROUP BY right.col2
            ) abs_freq
   ON abs_freq.col1 = totals.col1 
```

# windows - ssh隧道链

> ID：1010808
> 
> 赞同：17
> 
> 时间：2009-06-18T04:45:49.967
> 
> 标签：windows, ssh, tunnel

这是场景

我正在尝试获取对 server3 的 scp 访问权限，但只有对服务器 1 的公共 ssh 访问。要 ssh 到 server3，我必须先 ssh 到 server1，ssh 到 server2，然后 ssh 到 server3。

我希望的最终结果是我可以 WinSCP 到 localhost:8022，它会给我对 server3 的文件访问权限。

我正在尝试使用 ssh 隧道，但是通过我读过的所有教程和问题，似乎没有一个适用于这种情况。

我在 Windows 上使用腻子。

任何建议都会很有帮助。谢谢你。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-07-13T21:50:01.473

在 OpenSSH 中，我在需要隧道时使用此设置。这使我可以直接键入`sftp server3`，而不必担心先手动启动`server2`和`server1`隧道。

```
# ~/.ssh/config

# 连接到server2，隧道通过server1
主机服务器2
ProxyCommand ssh server1 nc %h %p

# 连接server3，通过server2隧道
主机服务器3
ProxyCommand ssh server2 nc %h %p

```

为了更完整，我通常`ssh -oCiphers=arcfour128,arcfour256,arcfour,blowfish-cbc -oControlMaster=no -oForwardX11=no -oForwardAgent=no -oPermitLocalCommand=no -oClearAllForwardings=yes server1 nc %h %p`使用`ProxyCommand`.

*   被隧道化的 ssh 连接已经被加密，所以在外层使用较重的`aes`/是没有意义的；并且更快。`3des``arcfour``blowfish`
*   其余的`-o****`设置是出于偏执，因此即使将`Host server1`具有非常奇怪设置的节添加到`ssh_config`.

同样，您可以将 PuTTY 配置为使用 proxy 命令`plink -P %proxyport -pw %pass %user@%proxyhost nc %host %port`，并在 Connection/Proxy 配置窗格中相应地设置代理主机名/端口/用户/密码。 `plink`PuTTY 套件的其余部分（`pscp`、`psftp`等）加载保存在 PuTTY 图形配置中的任何内容；希望 WinSCP 也是如此。（我不使用它，所以我对它的功能不太熟悉。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-18T06:35:36.130

想到的第一个解决方案是将一个本地端口隧道连接到每个服务器。由于 SSH 使用端口 22，我们将使用每个 SSH 连接将本地端口隧道连接到下一个服务器的端口 22。

当您打开 PuTTY 时，您会看到 PuTTY 配置对话框。您需要编辑的两个类别是“会话”和“连接→SSH→隧道”。

1.  打开 PuTTY 的副本。使用这些设置：

    *   连接到主机

        *   主机名：`server1`
        *   端口：22
    *   隧道端口

        *   本地模式
        *   源端口：`15500`
        *   目的地：（`server2:22`安全外壳端口）

            ![按添加之前的 PuTTY 配置窗口](../Images/9eaa80b26bbe4d82a02be97ec9a0f8d3.png) ![按添加后的 PuTTY 配置窗口](../Images/9bebe07c25e7d536fea9947fca38e496.png)

    现在，每次您连接到本地计算机上的端口 15500 时，您的连接都会通过隧道连接到 server2 上的端口 22。

2.  打开 PuTTY 的副本。使用这些设置：

    *   连接到主机
        *   主机名：`localhost`
        *   端口：15500
    *   隧道端口
        *   本地模式
        *   源端口：`15501`
        *   目的地：（`server3:22`安全外壳端口）
3.  打开 PuTTY 的副本。使用这些设置：

    *   连接到主机
        *   主机名：`localhost`
        *   端口：15501
    *   隧道端口
        *   本地模式
        *   源端口：`15502`
        *   目的地：（`server3:22`安全外壳端口）
4.  使用 WinSCP 连接到`localhost`端口`15502`。您的连接将通过隧道传输，就像您`server3`直接连接一样。

在评论中让我知道这是否适合您。祝你好运！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-02-09T23:00:14.930

此方法类似于您可以在打开的 ssh 配置文件中使用 proxycommand 的方式。

此方法的先决条件是所有中间（代理）主机必须将 Pageant 与公钥身份验证一起使用，否则您最终将得到一个闪烁的光标而没有其他任何东西。要了解有关 Pageant、PuTTYgen 和公钥的更多信息，请参阅： http:
[//the.earth.li/~sgtatham/putty/0.62/htmldoc/Chapter8.html#pubkey](http://the.earth.li/~sgtatham/putty/0.62/htmldoc/Chapter8.html#pubkey)
[http://the.earth.li/~sgtatham/putty /0.62/htmldoc/Chapter9.html#pageant](http://the.earth.li/~sgtatham/putty/0.62/htmldoc/Chapter9.html#pageant)

我们有四台机器可以按顺序访问
PuttyPC -> server01 -> server02 -> server03

对于 server01，我们有一个 Putty 保存的会话：
主窗口：`user1@server01`//端口`22`//`SSH`
将此会话保存为 server01

对于 server02，我们有一个 Putty 保存的会话：
主窗口：`user2@server02`//端口`22`//`SSH`
代理配置窗口：类型`local`//代理命令`plink -load server01 -nc %host:%port`
将此会话保存为 server02

对于 server03，我们有一个 Putty 保存的会话：
主窗口：`user3@pc3`//端口`22`//`SSH`
代理配置面板：类型`local`//代理命令`plink -load server02 -nc %host:%port`
将此会话保存为 server03

这意味着 server03 的已保存会话将调用 server02 的已保存会话，而 server02 已保存会话将调用 server01 会话。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T15:38:38.183

答案是从 server3 反向隧道

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T04:54:42.037

[这里](http://www.perlmonks.org/?node_id=574891)有很好的描述 perl 脚本解决方案。也请阅读帖子上的评论。

阅读有关[SSH 代理转发](http://unixwiz.net/techtips/ssh-agent-forwarding.html)的更多信息（在 perl 脚本帖子评论中引用）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-01-19T14:04:36.393

如果您只需要超越一台服务器，我发现直接在 WinSCP 中进行此设置更容易。

场景：计算机->server1->server2

1：设置与 server2 的连接

2：点击高级->连接->隧道

3：启用SSH隧道并将主机设置为server1

# php - 如果你只是把这段代码丢在你的腿上，你会怎么做？

> ID：1010810
> 
> 赞同：5
> 
> 时间：2009-06-18T04:46:08.623
> 
> 标签：php

伙计，我刚刚收到了这个项目——他们说要扩展这个。

这是 ONE 函数的示例：

```
<?php

//500+ lines of pure wonder.
function page_content_vc($content) {
    global $_DBH, $_TPL, $_SET;

 $_SET['ignoreTimezone'] = true;

    lu_CheckUpdateLogin();

    if($_SESSION['dash']['VC']['switch'] == 'unmanned' || $_SESSION['dash']['VC']['switch'] == 'touchscreen') {
        if($content['page_name'] != 'vc') {
            header('Location: /vc/');
            die();
        }
    }

    if($_GET['l']) {
        unset($_SESSION['dash']['VC']);
        if($loc_id = lu_GetFieldValue('ID', 'Location', $_GET['l'])) {

            if(lu_CheckPermissions('vc', $loc_id)) {

    $timezone = lu_GetFieldValue('Time Zone', 'Location', $loc_id, 'ID');
    if(strlen($timezone) > 0) {
     $_SESSION['time_zone'] = $timezone;
    }

                $_SESSION['dash']['VC']['loc_ID'] = $loc_id;
                header('Location: /vc/');
                die();
            }
        }
    }

    if($_SESSION['dash']['VC']['loc_ID']) {

  $timezone = lu_GetFieldValue('Time Zone', 'Location', $_SESSION['dash']['VC']['loc_ID'], 'ID');
  if(strlen($timezone) > 0) {
   $_SESSION['time_zone'] = $timezone;
  }

        $loc_id = $_SESSION['dash']['VC']['loc_ID'];
        $org_id = lu_GetFieldValue('record_ID', 'Location', $loc_id);

        $_TPL->assign('loc_id', $loc_id);

        $location_name = lu_GetFieldValue('Location Name', 'Location', $loc_id);
        $_TPL->assign('LocationName', $location_name);

        $customer_name = lu_GetFieldValue('Customer Name', 'Organisation', $org_id);
        $_TPL->assign('CustomerName', $customer_name);

        $enable_visitor_snap = lu_GetFieldValue('VisitorSnap', 'Location', $loc_id);
        $_TPL->assign('EnableVisitorSnap', $enable_visitor_snap);

  $lacps = explode("\n", lu_GetFieldValue('Location Access Control Point', 'Location', $loc_id));
        array_walk($lacps, 'trim_value');

  if(count($lacps) > 0) {
   if(count($lacps) == 1) {
    $_SESSION['dash']['VC']['lacp'] = $lacps[0];
   }
   else {
    if($_GET['changeLACP'] && in_array($_GET['changeLACP'], $lacps)) {
     $_SESSION['dash']['VC']['lacp'] = $_GET['changeLACP'];
     header('Location: /vc/');
     die();
    }
    else if(!in_array($_SESSION['dash']['VC']['lacp'], $lacps)) {
     $_SESSION['dash']['VC']['lacp'] = $lacps[0];
    }
    $_TPL->assign('LACP_array', $lacps);
   }
   $_TPL->assign('current_LACP', $_SESSION['dash']['VC']['lacp']);
   $_TPL->assign('showContractorSearch', true);
   /*
   if($contractorStaff = lu_GetTableRow('ContractorStaff', $org_id, 'record_ID', 'record_Inactive != "checked"')) {
    foreach($contractorStaff['rows'] as $contractor) {
     $lacp_rights = lu_OrganiseCustomDataFunctionMultiselect($contractor[lu_GetFieldName('Location Access Rights', 'ContractorStaff')]);
     if(in_array($_SESSION['dash']['VC']['lacp'], $lacp_rights)) {
      $_TPL->assign('showContractorSearch', true);
     }
    }
   }
   */
  }

  $selectedOptions = explode(',', lu_GetFieldValue('Included Fields', 'Location', $_SESSION['dash']['VC']['loc_ID']));
  $newOptions = array();
  foreach($selectedOptions as $selOption) {
   $so_array = explode('|', $selOption, 2);
   if(count($so_array) > 1) {
    $newOptions[$so_array[0]] = $so_array[1];
   }
   else {
    $newOptions[$so_array[0]] = "Both";
   }
  }  

  if($newOptions[lu_GetFieldName('Expected Length of Visit', 'Visitor')]) {

   $alert = false;

            if($visitors = lu_OrganiseVisitors(
                lu_GetTableRow('Visitor', 'checked',
                    lu_GetFieldName('Checked In', 'Visitor'),
                    lu_GetFieldName('Location for Visit', 'Visitor').'="'.$_SESSION['dash']['VC']['loc_ID'].'"
                    AND '.lu_GetFieldName('Checked Out', 'Visitor').' != "checked"'), false, true, true)) {

                foreach($visitors['rows'] as $key => $visitor) {
     if($visitor['expected'] && $visitor['expected'] + (60*30) < time()) {
      $alert = true;
     }
                }
            }
   if($alert == true) {
    $_TPL->assign('showAlert', 'red');
   }
   else {
    //$_TPL->assign('showAlert', 'green');
   }
  }

        $_TPL->assign('switch', $_SESSION['dash']['VC']['switch']);
  if($_SESSION['dash']['VC']['switch'] == 'touchscreen') {
   $_TPL->assign('VC_unmanned', true);
  }

        if($_GET['check'] == 'in') {
   if($_SESSION['dash']['VC']['switch'] == 'touchscreen') {
    lu_CheckInTouchScreen();
            }
   else {
    lu_CheckIn();
   }
        }
        else if($_GET['check'] == 'out') {
   if($_SESSION['dash']['VC']['switch'] == 'touchscreen') {
    lu_CheckOutTouchScreen();
            }
   else {
    lu_CheckOut();
   }
        }
        else if($_GET['switch'] == 'unmanned') {
            $_SESSION['dash']['VC']['switch'] = 'unmanned';
            if($_GET['printing'] == true && (lu_GetFieldValue('Printing', 'Location', $_SESSION['dash']['VC']['loc_ID']) != "No" && lu_GetFieldValue('Printing', 'Location', $_SESSION['dash']['VC']['loc_ID']) != "")) {
                $_SESSION['dash']['VC']['printing'] = true;
            }
            else {
                $_SESSION['dash']['VC']['printing'] = false;
            }
            header('Location: /vc/');
            die();
        }
        else if($_GET['switch'] == 'touchscreen') {
            $_SESSION['dash']['VC']['switch'] = 'touchscreen';
            if($_GET['printing'] == true && (lu_GetFieldValue('Printing', 'Location', $_SESSION['dash']['VC']['loc_ID']) != "No" && lu_GetFieldValue('Printing', 'Location', $_SESSION['dash']['VC']['loc_ID']) != "")) {
                $_SESSION['dash']['VC']['printing'] = true;
            }
            else {
                $_SESSION['dash']['VC']['printing'] = false;
            }
            header('Location: /vc/');
            die();
        }

        else if($_GET['switch'] == 'manned') {
            if($_POST['password']) {
                if(md5($_POST['password']) == $_SESSION['dash']['password']) {
                    unset($_SESSION['dash']['VC']['switch']);
                    //setcookie('email', "", time() - 3600);
                    //setcookie('location', "", time() - 3600);
                    header('Location: /vc/');
                    die();
                }
                else {
                    $_TPL->assign('switchLoginError', 'Incorrect Password');
                }
            }

            $_TPL->assign('switchLogin', 'true');
        }
        else if($_GET['m'] == 'visitor') {
            lu_ModifyVisitorVC();
        }

        else if($_GET['m'] == 'enote') {
            lu_ModifyEnoteVC();
        }

        else if($_GET['m'] == 'medical') {
            lu_ModifyMedicalVC();
        }

        else if($_GET['print'] == 'label' && $_GET['v']) {
            lu_PrintLabelVC();
        }

        else {
            unset($_SESSION['dash']['VC']['checkin']);
            unset($_SESSION['dash']['VC']['checkout']);

            $_TPL->assign('icon', 'GroupCheckin');

            if($_SESSION['dash']['VC']['switch'] != 'unmanned' && $_SESSION['dash']['VC']['switch'] != 'touchscreen') {

                $staff_ids = array();
                if($staffs = lu_GetTableRow('Staff', $_SESSION['dash']['VC']['loc_ID'], 'record_ID')) {
                    foreach($staffs['rows'] as $staff) {
                        $staff_ids[] = $staff['ID'];
                    }
                }

                if($_GET['view'] == "tomorrow") {
                    $dateStart = date('Y-m-d', mktime(0, 0, 0, date("m")  , date("d")+1, date("Y")));
                    $dateEnd = date('Y-m-d', mktime(0, 0, 0, date("m")  , date("d")+1, date("Y")));
                }
                else if($_GET['view'] == "month") {
                    $dateStart = date('Y-m-d', mktime(0, 0, 0, date("m"), date("d"), date("Y")));
                    $dateEnd = date('Y-m-d', mktime(0, 0, 0, date("m"), date("d")+30, date("Y")));
                }
                else if($_GET['view'] == "week") {
                    $dateStart = date('Y-m-d', mktime(0, 0, 0, date("m"), date("d"), date("Y")));
                    $dateEnd = date('Y-m-d', mktime(0, 0, 0, date("m"), date("d")+7, date("Y")));
                }
                else {
                    $dateStart = date('Y-m-d');
                    $dateEnd = date('Y-m-d');
                }

    if(lu_GetFieldValue('Enable Survey', 'Location', $_SESSION['dash']['VC']['loc_ID']) == 'checked'
     && lu_GetFieldValue('Add Survey', 'Location', $_SESSION['dash']['VC']['loc_ID']) == 'checked') {
      $_TPL->assign('enableSurvey', true);
    }

                //lu_GetFieldName('Checked In', 'Visitor')
                //!= "checked"

                //date('d/m/Y'), lu_GetFieldName('Date of Visit', 'Visitor')

                if($visitors = lu_OrganiseVisitors(lu_GetTableRow('Visitor', $_SESSION['dash']['VC']['loc_ID'], lu_GetFieldName('Location for Visit', 'Visitor'), lu_GetFieldName('Checked In', 'Visitor').' != "checked" AND '.lu_GetFieldName('Checked Out', 'Visitor').' != "checked" AND '.lu_GetFieldName('Date of Visit', 'Visitor').' >= "'.$dateStart.'" AND '.lu_GetFieldName('Date of Visit', 'Visitor').' <= "'.$dateEnd.'"'))) {
                    foreach($visitors['days'] as $day => $visitors_day) {
                        foreach($visitors_day['rows'] as $key => $visitor) {
                            $visitors['days'][$day]['rows'][$key]['visiting'] = lu_GetTableRow('Staff', $visitor['record_ID'], 'ID');
                            $visitors['days'][$day]['rows'][$key]['visiting']['notify'] = $_DBH->getRow('SELECT * FROM lu_notification WHERE ent_ID = "'.$visitor['record_ID'].'"');
                        }
                    }

                    //array_dump($visitors);

                    $_TPL->assign('visitors', $visitors);
                }

    if($_GET['conGroup']) {
     if($_GET['action'] == 'add') {
      $_SESSION['dash']['VC']['conGroup'][$_GET['conGroup']] = $_GET['conGroup'];
     }
     else {
      unset($_SESSION['dash']['VC']['conGroup'][$_GET['conGroup']]);
     }
    }

    if(count($_SESSION['dash']['VC']['conGroup']) > 0) {
                    if($conGroupResult = lu_GetTableRow('ContractorStaff', '1', '1', ' ID IN ('.implode(',', $_SESSION['dash']['VC']['conGroup']).')')) {

      if($_POST['_submit'] == 'Check-In Group >>') {

                         $form = lu_GetForm('VisitorStandard');
       $standarddata = array();

       foreach($form['items'] as $key=>$item) {
        $standarddata[$key] = $_POST[lu_GetFieldName($item['name'], 'Visitor')];
       }

       foreach($conGroupResult['rows'] as $conStaff) {
        $data = $standarddata;

        foreach($form['items'] as $key=>$item) {
         if($key != 'ID' && $key != 'record_ID' && $conStaff[lu_GetFieldName(lu_GetNameField($key, 'Visitor'), 'ContractorStaff')]) {
          $data[$key] = $conStaff[lu_GetFieldName(lu_GetNameField($key, 'Visitor'), 'ContractorStaff')];
         }
        }

        $data['record_ID'] = $data[lu_GetFieldName('Visiting', 'Visitor')];
                          $data[lu_GetFieldName('Date of Visit', 'Visitor')] = date('Y-m-d');
                          $data[lu_GetFieldName('Time of Visit', 'Visitor')] = date('H:i');
                          $data[lu_GetFieldName('Checked In', 'Visitor')] = 'checked';
                          $data[lu_GetFieldName('Location for Visit', 'Visitor')] = $_SESSION['dash']['VC']['loc_ID'];
                          $data[lu_GetFieldName('ConStaff ID', 'Visitor')] = $conStaff['ID'];
        $data[lu_GetFieldName('From', 'Visitor')] = lu_GetFieldValue('Legal Name', 'Contractor', $conStaff[lu_GetFieldName('Contractor', 'ContractorStaff')]);

                          $id = lu_UpdateData($form, $data);
                          lu_VisitorCheckIn($id);

        //array_dump($data);
        //array_dump($id);
       }

       unset($_SESSION['dash']['VC']['conGroup']);
       header('Location: /vc/');
       die();
      }

      if(count($conGroupResult['rows'])) {
                         foreach($conGroupResult['rows'] as $key => $cstaff) {
                             $conGroupResult['rows'][$key]['contractor'] = lu_GetTableRow('Contractor', $cstaff[lu_GetFieldName('Contractor', 'ContractorStaff')], 'ID');
                         }
                         $_TPL->assign('conGroupResult', $conGroupResult);
      }

      $conGroupForm = lu_GetForm('VisitorConGroup');
      $conGroupForm = lu_OrganiseVisitorForm($conGroupForm, $_SESSION['dash']['VC']['loc_ID'], 'Contractor');

            $secure_options_array = lu_GetSecureOptions($org_id);
            if($secure_options_array[$_SESSION['dash']['VC']['loc_ID']]) {
             $conGroupForm['items'][lu_GetFieldName('Secure Area', 'Visitor')]['options']['values'] = $secure_options_array[$_SESSION['dash']['VC']['loc_ID']];
       $conGroupForm['items'][lu_GetFieldName('Secure Area', 'Visitor')]['name'] = 'Secure  Area';
      }
      else {
                unset($conGroupForm['items'][lu_GetFieldName('Secure Area', 'Visitor')]);
      }

         if($secure_options_array) {
             $form['items'][lu_GetFieldName('Secure Area', 'Visitor')]['options']['values'] = $secure_options_array;
       $form['items'][lu_GetFieldName('Secure Area', 'Visitor')]['name'] = 'Secure  Area';
         }
         else {
             unset($form['items'][lu_GetFieldName('Secure Area', 'Visitor')]);
         }

         $_TPL->assign('conGroupForm', $conGroupForm);
      $_TPL->assign('hideFormCancel', true);
     }
    }

                if($_GET['searchVisitors']) {
                    $_TPL->assign('searchVisitorsQuery', $_GET['searchVisitors']);
                    $where = '';

                    if($_GET['searchVisitorsIn'] == 'Yes') {
                        $where .= ' AND '.lu_GetFieldName('Checked In', 'Visitor').' = "checked"';
                        $_TPL->assign('searchVisitorsIn', 'Yes');
                    }
                    else {
                        $where .= ' AND '.lu_GetFieldName('Checked In', 'Visitor').' != "checked"';
                        $_TPL->assign('searchVisitorsIn', 'No');
                    }

                    if($_GET['searchVisitorsOut'] == 'Yes') {
                        $where = '';
                        $where .= ' AND '.lu_GetFieldName('Checked Out', 'Visitor').' = "checked"';
                        $_TPL->assign('searchVisitorsOut', 'Yes');
                    }
                    else {
                        $where .= ' AND '.lu_GetFieldName('Checked Out', 'Visitor').' != "checked"';
                        $_TPL->assign('searchVisitorsOut', 'No');
                    }

                    if($searchVisitors = lu_OrganiseVisitors(lu_GetTableRow('Visitor', $_GET['searchVisitors'], '#search#', lu_GetFieldName('Location for Visit', 'Visitor').'="'.$_SESSION['dash']['VC']['loc_ID'].'"'.$where))) {
                        foreach($searchVisitors['rows'] as $key => $visitor) {
                            $searchVisitors['rows'][$key]['visiting'] = lu_GetTableRow('Staff', $visitor['record_ID'], 'ID');
                        }

                        $_TPL->assign('searchVisitors', $searchVisitors);
                    }
                    else {
                        $_TPL->assign('searchVisitorsNotFound', true);
                    }
                }
                else if($_GET['searchStaff']) {

                    if($_POST['staff_id']) {
                        if(lu_CheckPermissions('staff', $_POST['staff_id'])) {
                            $_DBH->query('UPDATE '.lu_GetTableName('Staff').' SET '.lu_GetFieldName('Current Location', 'Staff').' = "'.$_POST['current_location'].'" WHERE ID="'.$_POST['staff_id'].'"');
                        }
                    }

                    $locations = lu_GetTableRow('Location', $org_id, 'record_ID');

                    if(count($locations['rows']) > 1) {
                        $_TPL->assign('staffLocations', $locations);
                    }

                    $loc_ids = array();
                    foreach($locations['rows'] as $location) {
                        $loc_ids[] = $location['ID'];
                    }

                    // array_dump($locations);
                    // array_dump($_POST);

                    $_TPL->assign('searchStaffQuery', $_GET['searchStaff']);
                    $where = ' AND record_Inactive != "checked"';

                    if($_GET['searchStaffIn'] == 'Yes' && $_GET['searchStaffOut'] != 'Yes') {
                        $where .= ' AND ('.lu_GetFieldName('Staff Status', 'Staff').' = "" OR '.lu_GetFieldName('Staff Status', 'Staff').' = "On-Site")'.

                        $_TPL->assign('searchStaffIn', 'Yes');
                        $_TPL->assign('searchStaffOut', 'No');
                    }
                    else if($_GET['searchStaffOut'] == 'Yes' && $_GET['searchStaffIn'] != 'Yes') {
                        $where .= ' AND ('.lu_GetFieldName('Staff Status', 'Staff').' != "" AND '.lu_GetFieldName('Staff Status', 'Staff').' != "On-Site")'.
                        $_TPL->assign('searchStaffOut', 'Yes');
                        $_TPL->assign('searchStaffIn', 'No');
                    }
                    else {
                        $_TPL->assign('searchStaffOut', 'Yes');
                        $_TPL->assign('searchStaffIn', 'Yes');
                    }

                    if($searchStaffs = lu_GetTableRow('Staff', $_GET['searchStaff'], '#search#', 'record_ID IN ('.implode(',', $loc_ids).')'.$where, lu_GetFieldName('First Name', 'Staff').','.lu_GetFieldName('Surname', 'Staff'))) {
                        $_TPL->assign('searchStaffs', $searchStaffs);
                    }
                    else {
                        $_TPL->assign('searchStaffNotFound', true);
                    }
                }
    else if($_GET['searchContractor']) {

                    $_TPL->assign('searchContractorQuery', $_GET['searchContractor']);
                    //$where = ' AND '.lu_GetTableName('ContractorStaff').'.record_Inactive != "checked"';
     $where = ' ';

                    if($_GET['searchContractorIn'] == 'Yes' && $_GET['searchContractorOut'] != 'Yes') {
                        $where .= ' AND ('.lu_GetFieldName('Onsite Status', 'ContractorStaff').' = "Onsite")';

                        $_TPL->assign('searchContractorIn', 'Yes');
                        $_TPL->assign('searchContractorOut', 'No');
                    }
                    else if($_GET['searchContractorOut'] == 'Yes' && $_GET['searchContractorIn'] != 'Yes') {
                        $where .= ' AND ('.lu_GetFieldName('Onsite Status', 'ContractorStaff').' != "Onsite")'.
                        $_TPL->assign('searchContractorOut', 'Yes');
                        $_TPL->assign('searchContractorIn', 'No');
                    }
                    else {
                        $_TPL->assign('searchContractorOut', 'Yes');
                        $_TPL->assign('searchContractorIn', 'Yes');
                    }

     $join = 'LEFT JOIN '.lu_GetTableName('Contractor').' ON '.lu_GetTableName('Contractor').'.ID = '.lu_GetTableName('ContractorStaff').'.'.lu_GetFieldName('Contractor', 'ContractorStaff');

     $extrasearch = array (
      lu_GetTableName('Contractor').'.'.lu_GetFieldName('Legal Name', 'Contractor')
     );

                    if($searchContractorResult = lu_GetTableRow('ContractorStaff', $_GET['searchContractor'], '#search#', lu_GetTableName('ContractorStaff').'.record_ID = "'.$org_id.'" '.$where, lu_GetFieldName('First Name', 'ContractorStaff').','.lu_GetFieldName('Surname', 'ContractorStaff'), $join, $extrasearch)) {

      /*
      foreach($searchContractorResult['rows'] as $key=>$contractor) {
       $lacp_rights = lu_OrganiseCustomDataFunctionMultiselect($contractor[lu_GetFieldName('Location Access Rights', 'ContractorStaff')]);
       if(!in_array($_SESSION['dash']['VC']['lacp'], $lacp_rights)) {
        unset($searchContractorResult['rows'][$key]);
       }
      }
      */

      if(count($searchContractorResult['rows'])) {
                         foreach($searchContractorResult['rows'] as $key => $cstaff) {
        /*
        if($cstaff[lu_GetFieldName('Onsite_Status', 'Contractor')] == 'Onsite')) {
         if($visitor['rows'][0][lu_GetFieldName('ConStaff ID', 'Visitor')]) {
                   $_DBH->query('UPDATE '.lu_GetTableName('ContractorStaff').' SET '.lu_GetFieldName('Onsite Status', 'ContractorStaff').' = "" WHERE ID="'.$visitor['rows'][0][lu_GetFieldName('ConStaff ID', 'Visitor')].'"');
         }
        }
        */
        if($cstaff[lu_GetFieldName('SACN Expiry Date', 'ContractorStaff')] != '0000-00-00') {
         if(strtotime($cstaff[lu_GetFieldName('SACN Expiry Date', 'ContractorStaff')]) < time()) {
          $searchContractorResult['rows'][$key]['sacn_expiry'] = true;
         }
         else {
          $searchContractorResult['rows'][$key]['sacn_expiry'] = false;
         }
        }
        else {
         $searchContractorResult['rows'][$key]['sacn_expiry'] = false;
        }

        if($cstaff[lu_GetFieldName('Induction Valid Until', 'ContractorStaff')] != '0000-00-00') {
         if(strtotime($cstaff[lu_GetFieldName('Induction Valid Until', 'ContractorStaff')]) < time()) {
          $searchContractorResult['rows'][$key]['induction_expiry'] = true;
         }
         else {
          $searchContractorResult['rows'][$key]['induction_expiry'] = false;
         }
        }
        else {
         $searchContractorResult['rows'][$key]['induction_expiry'] = false;
        }

                             $searchContractorResult['rows'][$key]['contractor'] = lu_GetTableRow('Contractor', $cstaff[lu_GetFieldName('Contractor', 'ContractorStaff')], 'ID');
                         }
                         $_TPL->assign('searchContractorResult', $searchContractorResult);
      }
      else {
                         $_TPL->assign('searchContractorNotFound', true);
      }
                    }
                    else {
                        $_TPL->assign('searchContractorNotFound', true);
                    }
    }

                $occupancy = array();
                $occupancy['staffNumber'] = $_DBH->getOne('SELECT count(*) FROM '.lu_GetTableName('Staff').' WHERE record_ID = "'.$_SESSION['dash']['VC']['loc_ID'].'" AND record_Inactive != "checked" AND '.lu_GetFieldName('Ignore Counts', 'Staff').' != "checked"');
                $occupancy['staffNumberOnsite']= $_DBH->getOne(
                        'SELECT count(*) FROM '.lu_GetTableName('Staff').' WHERE
                        (
                            (record_ID = "'.$_SESSION['dash']['VC']['loc_ID'].'"
                                AND
                                ('.lu_GetFieldName('Staff Status', 'Staff').' = "" OR  '.lu_GetFieldName('Staff Status', 'Staff').' = "On-Site"))
                                OR '.lu_GetFieldName('Current Location', 'Staff').' = "'.$_SESSION['dash']['VC']['loc_ID'].'")
                                AND record_Inactive != "checked"
        AND '.lu_GetFieldName('Ignore Counts', 'Staff').' != "checked"');

                $occupancy['visitorsOnsite'] = $_DBH->getOne('SELECT count(*) FROM '.lu_GetTableName('Visitor').' WHERE '.lu_GetFieldName('Location for Visit', 'Visitor').' = "'.$_SESSION['dash']['VC']['loc_ID'].'" AND '.lu_GetFieldName('Checked In', 'Visitor').' = "checked" AND '.lu_GetFieldName('Checked Out', 'Visitor').' != "checked"');
                $_TPL->assign('occupancy', $occupancy);

                if($enotes = lu_GetTableRow('Enote', $org_id, 'record_ID', lu_GetFieldName('Note Emailed', 'Enote').' = "0000-00-00" AND '.lu_GetFieldName('Note Passed On', 'Enote').' != "Yes"')) {
                    $_TPL->assign('EnoteNotice', true);
                }

                if($medical = lu_GetTableRow('MedicalRoom', $_SESSION['dash']['VC']['loc_ID'], 'record_ID', 'record_Inactive != "Yes"')) {
                    $_TPL->assign('MedicalNotice', true);
                }

                if(lu_GetFieldValue('Printing', 'Location', $_SESSION['dash']['VC']['loc_ID']) != "No" && lu_GetFieldValue('Printing', 'Location', $_SESSION['dash']['VC']['loc_ID']) != "") {
                    $_TPL->assign('UnmannedPrinting', true);
                }
            }
            else {
                if($_SESSION['dash']['VC']['printing'] == true) {
                    $_TPL->assign('UnmannedPrinting', true);
                }
            }

   // enable if contractor check-in buttons should be enabled
            if(lu_GetFieldValue('Enable Contractor Check In', 'Location', $_SESSION['dash']['VC']['loc_ID']) == "checked") {
                $_TPL->assign('ContractorCheckin', true);
            }

        }

  if($_SESSION['dash']['entity_id'] && $_GET['fixupCon'] == 'true') {
         $conStaffs = lu_GetTableRow('ContractorStaff', $_SESSION['dash']['ModifyConStaffs']['org_ID'], 'record_ID', '', lu_GetFieldName('First Name', 'ContractorStaff').','.lu_GetFieldName('Surname', 'ContractorStaff'));
      foreach($conStaffs['rows'] as $key => $cstaff) {
    if($cstaff[lu_GetFieldName('Site Access Card Number', 'ContractorStaff')] && $cstaff[lu_GetFieldName('Site Access Card Type', 'ContractorStaff')]) {
     echo $cstaff['ID'].' ';
     $_DBH->query('UPDATE '.lu_GetTableName('Visitor').' SET '.lu_GetFieldName('Site Access Card Number', 'Visitor').' = "'.$cstaff[lu_GetFieldName('Site Access Card Number', 'ContractorStaff')].'", '.lu_GetFieldName('Site Access Card Type', 'Visitor').' = "'.$cstaff[lu_GetFieldName('Site Access Card Type', 'ContractorStaff')].'" WHERE '.lu_GetFieldName('ConStaff ID', 'Visitor').'="'.$cstaff['ID'].'"');
    }
      }
  }

    }
    else {
        if($_SESSION['dash']['staffs']) {
            foreach($_SESSION['dash']['staffs']['rows'] as $staff) {
                if($staff[lu_GetFieldName('Reception Manager', 'Staff')] == 'checked') {
                    $loc_id = $staff['record_ID'];
                    unset($_SESSION['dash']['VC']);
                    if($loc_id = lu_GetFieldValue('ID', 'Location', $loc_id)) {
                        $_SESSION['dash']['VC']['loc_ID'] = $loc_id;
                        header('Location: /vc/');
                        die();
                    }
                }
            }
        }

        $_TPL->assign('mode', 'public');
    }

    $content['page_content'] = $_TPL->fetch('modules/vc.htm');
    return $content;
}

?> 
```

这个问题可能会结束 - 我只需要我的编码兄弟姐妹的一些支持。*哭泣*

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-06-18T04:52:51.803

全球搜索和替换是您的朋友。

开始：

1.  将巨大的“if ... else”分解成单独的函数，一旦你弄清楚它们的作用，你就可以稍后重命名它们。
2.  对 $_GET[...] 和 $_SESSION['dash'] 变量进行全局搜索/替换，以赋予它们更有意义的名称
3.  继续清理

简而言之，使用基本的计算机编程技术：分而治之。将功能划分为更小的部分，然后清理各个部分。应该不会超过一个小时。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-06-18T09:13:05.827

软件是一门生意。

您收到了基本上无法维护的代码，并被要求对其进行处理。这将需要大量的重构。

坏消息是它会**很烂**。

好消息是，公司会给你**钱来**换取你的时间，你可以用这些钱换取食物、衣服、啤酒和音乐会门票等**商品和服务。**

只要每个人都对所涉及的时间成本有正确或至少近似的理解，你就可以了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-18T04:49:41.650

我会告诉任何将项目倾倒在我身上的人，如果他们想对网站做任何事情，就必须彻底重写。（这个建议不能保证不会让你被解雇。）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-06-18T08:45:22.620

相信我，我见过更糟糕的代码。正如其他人所说，应用一些重构。

我通常的攻击计划：

*   如果代码没有与系统中的其他所有内容紧密耦合，请编写大量单元测试。这些将帮助您确保重构代码的行为没有改变。
*   尽可能多地提取函数，除以逻辑运算。即使这意味着某些函数将包含两行代码。
*   内联您创建的 200 种方法中的一些 :)

推荐阅读：

*   [http://www.refactoring.com/catalog/](http://www.refactoring.com/catalog/)

*   [这本书](https://rads.stackoverflow.com/amzn/click/com/0201485672)

[![替代文字](../Images/be2b4217e7501bd123d27e181363758d.png)](https://i.stack.imgur.com/FiiRd.gif)
[（来源：[martinfowler.com](http://www.martinfowler.com/refactoringBook.gif)）]

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-18T04:50:24.707

我对继承这样的代码的正常反应是追踪原始开发人员的家庭地址，以防万一我需要它。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-18T04:52:30.913

坚持在那里。我知道你的感受。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-06-18T07:42:24.527

要坚强，我的朋友。

这确实是丑陋的代码，但并非不可能不可读。

除了前面提到的替换策略（我也建议）之外，我的建议是记录函数中发生的事情，因为你更好地理解它 - 这可以在代码中的临时注释中，在单独的文本文件中，或在一张纸上。重要的是，在您长时间休息或周末到来的情况下，您有一些东西可以参考。讨厌的代码带来了大脑想要忘记它的习惯——确保你的发现得到了备份。

考虑到示例函数的长度，另一个建议是，一旦您对代码的理解足以确定通用逻辑的部分，就可以将这些宏功能分解为更小的功能。它将提高可读性 - 为您和其他人。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-18T04:53:36.827

我小时候经常写这样的代码。太可怕了。最糟糕的是，这些功能的大部分只是被复制/粘贴到其他地方。我记得为乐队的粉丝网站建立了一个完整的“粉丝查找器”类型的注册表。它给了你一张世界地图，并指出了每个签署它的人的位置。你可以点击不同的国家，按名字搜索——等等，你会得到世界各地所有这些粉丝的名单和名单，他们都有自己的小档案可以编辑（最喜欢的歌曲、乐队成员等） ）。一切都在 PHP 中，看起来像这样。全部使用纯文本文件......这太残忍了。我只是重写了大部分文件解析函数，在每个函数中我一次又一次地处理文本文件......我的上帝，这太糟糕了。我知道你可能想为此勒死我，这就是为什么我

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-18T04:52:36.407

我会支持重写选项，但是，如果我还建议为原始代码编写尽可能多的单元测试用例，这几乎涵盖了此代码在进行完全重写之前所做的一切，那么验证您的重写将变得非常重要正在做同样的工作。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-18T04:53:37.560

看起来有人需要对高内聚原则进行一点复习。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-06-18T05:44:31.330

告诉给你这个的人需要重写。

看起来这个函数确定用户类型，为页面生成器设置标志和内容。您可以将此功能放在流程图中并重新组织此项目。整个事情似乎可以很好地适应面向对象的编程。您可以真正降低对会话全局变量的相互依赖程度，使用更小的代码并使整个事情更加健壮。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-06-18T05:47:25.817

我曾经有一堆这样的垃圾。我最终想出的最佳策略是从外向内而不是从内向外弄清楚它做了什么。所以这与第一响应者（描述了我开始做的事情）相反。如果代码有一些伪装的结构，这是有道理的，但这可能不是理所当然的事情。例如，我最终找出了一堆永远无法调用的代码。在其中一些情况下，相同的功能以几种不同的方式实现。浪费了很多时间。

最终它会生成一个网页。可能更容易弄清楚网页的外观以及它的一般操作方式，并且只需使用代码来提示不言自明的内容。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-06-18T08:55:07.953

这也可能对您有所帮助。

[https://stackoverflow.com/questions/108141/how-do-i-work-effectively-with-very-messy-legacy-code/108164#108164](https://stackoverflow.com/questions/108141/how-do-i-work-effectively-with-very-messy-legacy-code/108164#108164)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-02-03T07:17:53.530

**不要碰它！相信我 ！**

# unit-testing - 将单元测试提升到一个新的水平

> ID：1010819
> 
> 赞同：12
> 
> 时间：2009-06-18T04:51:16.733
> 
> 标签：unit-testing, tdd

在过去一年左右的时间里，我一直在开发我的 TDD 印章，因此我现在相当擅长基本要素——首先编写测试、模拟框架、测试尽可能小的东西、DI 等。

但是我觉得还有很多事情我没有从单元测试中得到。

例如，我经常发现以这种方式进行单元测试并不能真正测试我的代码应该做什么的集成和整体*大图。*随着一切都被嘲笑，我发现我忽略了被测试的方法是否正在产生我真正*需要*的结果，而不仅仅是他们所说的将提供的结果。当我开始转向 BDD 时，我发现这个问题只会加剧，导致浪费的开发时间和无效的测试。

另一个问题是单元测试需要大量维护以保持它们的有序性，从而减慢了重构速度。

当我第一次开始单元测试时，和大多数人一样，我发现我正在编写的实际上是集成测试。然而，这些测试有很多好处——它们*更*容易阅读，并且在我的程序 API 上充当了体面的文档。他们还倾向于更快地捕捉现实世界的问题，而不是单元测试，我发现单元测试花费了大量时间来针对仅通过不正确使用 API （例如空引用、除以 0 等）才会出现的边缘情况。

你怎么认为？你能推荐一些好的书籍、文章或实践来解决更高级的单元测试并保持生产力和有效性吗？

编辑： 给出答案后，只需关注一些问题：所以基本上你是说尽管做了所有这些单元“测试”，但我并没有真正测试代码......我回答说，“但我想测试该死的代码！事实上，当我编写大量“更重”的集成测试时，我发现我的代码往往会更快地达到正确状态，并且更早地发现错误。如果没有集成测试的可维护性问题，是否有可能实现这一目标？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-18T04:59:13.517

TDD 和 BDD 并不是*用来*衡量代码质量的工具，它们是用来帮助设计松散耦合、高度可维护的代码片段的工具。它更多地与 API 设计有关。这是为了确保代码按照它所说的去做，并且以一种改变代码的一部分不会影响其他部分的方式来做。

我希望您对 BDD 的愤怒感源于您编写工具以简单地“消除错误”或“替换您的 QA 流程”的期望，而这两者都不是 BDD 和 TDD 的本意。测试驱动开发意味着“由测试驱动的开发”，而不是“由开发驱动的测试”。在我看来，你想要后者。

集成测试和软件质量保证是完全不同的主题，但我理解它们之间的巨大混淆以及将 TDD 与它们相关联的原因。

测试驱动开发意味着“由测试驱动的开发”，而不是“由开发驱动的测试”。在我看来，你想要后者。

**更新**只想分享我关于这个问题的博客文章：[在我之后重复：测试驱动开发是关于设计，而不是测试！](http://dotnet.kapenilattex.com/?p=132)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T05:04:47.380

我和你似乎在同一条路上。对我来说，已经成为我的单元测试圣经的书是Gerard Meszaros 的[xUnit Test Patterns - Refactoring Test Code](http://xunitpatterns.com/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T05:00:47.803

单元测试只是一种类型的测试，它不是唯一的测试类型。

**单元测试**应该覆盖尽可能小的工作单元，模拟所有依赖项是实现这一目标的一个非常关键的过程，因为这些依赖项有自己的单元测试来覆盖它们。

在你覆盖了相当数量的小单元之后，你就可以进行所谓的**功能测试**，它看起来像单元测试，但是它不会模拟你在单元测试中模拟的所有东西，通常如果你的系统是由不同的团队构建的，Functional Tests 仅模拟其他团队引入的依赖项，但您的团队代码不会被模拟。

在您介绍了功能测试之后，您将拥有**集成测试**，并且当您开始使用来自其他团队的真正依赖项时，通常您不应该在此类测试中进行任何模拟。

鉴于所有三种类型的测试都是使用 mstest 或 NUnit 构建的，它仍然是代码测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T05:09:47.483

如果您真的按照从业者的描述遵循 TDD，那么每个测试都应该测试代码的相对较小部分（仅几行）。根据定义，这些不是集成测试。TDD 人员会告诉您，您需要一整套单独的测试来进行集成测试。

你是对的，因为这样一套 TDD 测试最终会让你陷入细枝末节。测试驱动的开发，顾名思义是树的创建、设计和测试，而不是森林。TDD 是通过单元测试创​​建需求，但就其本质而言，它体现了微观层面的需求。

如果像 TDD 人员声称的那样，您需要单独的集成测试，那么您还需要要求、规范和过程来配合这些测试。当你开始沿着食物链上升时，你的测试开始变得越来越复杂，直到你到达功能/用户界面级别，自动化测试几乎变得不可能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T05:29:31.197

查看 Bertrand Mayer 的“面向对象的软件构建”。

这个概念被称为“合同驱动开发”，它是一种功能级别的在线测试，它改变了我的编程方式。

如果您在 Eiffel 中使用 CDD，该语言也是由 Bertrand 编写的，它们会在测试和调试阶段由运行时自动检查。

[http://www.amazon.com/Object-Oriented-Software-Construction-Prentice-Hall-International/dp/0136291554](https://rads.stackoverflow.com/amzn/click/com/0136291554)

[http://dev.eiffel.com](http://dev.eiffel.com)

# web-hosting - 需要 Windows 和 Linux 的 Web 托管设置

> ID：1010828
> 
> 赞同：0
> 
> 时间：2009-06-18T04:53:43.753
> 
> 标签：web-hosting

我有一个系统，其中网站需要托管在 Linux 机器上，而网站与之对话的后端应用程序需要驻留在 Windows 上。这种托管有什么“常见做法”吗？

注意 - 这两个系统都是我的，因此存在是否将机器物理放置在一起以避免网络呼叫延迟的困境。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T07:28:50.887

（顺便说一句，我在上面发帖作为对 statenjason 的帮助。）

尽管您没有提到服务器的具体数字，但我假设两者都是相对现代的机器并且能够执行以下操作 -

当您将 Windows 应用程序描述为“遗留后端”时，我假设它是为它编写的，并且可能更喜欢在旧版本的 Windows（XP 或更早版本）上运行。由于这些系统越来越容易出现安全漏洞，因此将它们与开放网络（或类似的攻击媒介）保持距离很重要。

出于这个原因，以及最小化 RoR 应用程序和后端之间的距离，我建议在 Linux 服务器内虚拟化整个 Windows 安装。这允许 Linux 服务器充当前端，同时仍通过环回网络设备使用 Windows 内部的后端（比必须通过外部路由器运行更快）。然后可以使用两台服务器中功能较弱的服务器来镜像此设置，以提供备份和故障转移解决方案。

虚拟化 Windows 还允许轻松恢复和保护，同时最大限度地减少运行冲突应用程序（即防火墙、防病毒）的需求。

要回答机器是否应该放在一起，在前面提到的备份设置中，不，在网络计算设置（都托管单独的应用程序）中，是的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T05:37:06.160

根据系统编写的语言，您可以在同一台服务器上运行它们，无论是 windows 还是 linux 服务器 - PHP 在 windows 上运行良好，并且使用 Mono，您也可以让大多数 .Net 应用程序在 Linux 下运行

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T05:01:41.890

这对于 Web 服务来说是一个很好的场景。您可以在 Windows 端设置服务（使用 WCF、JAX-WS 等），并以 Linux 端将使用的任何语言设置客户端。这就是 Web 服务的美妙之处：互操作性。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-06-18T05:24:38.487

有一个提供 windows 和 linux 的网络托管服务。它被称为[莫索](http://www.mosso.com)。

编辑：据我所知，我认为最好使用 Mosso 之类的服务，但是，如果不能，您可以同时运行这两个服务并通过套接字相互通信。如果您的站点像 stackoverflow 一样繁忙，我怀疑延迟将是一个问题。如果您这样做，最好将两台服务器物理上位于同一位置，并通过 LAN 连接。

# php - 如何以人类可读的格式显示数组？

> ID：1010833
> 
> 赞同：3
> 
> 时间：2009-06-18T04:54:56.310
> 
> 标签：php, arrays, formatting

如果我有一个看起来像这样的数组：

```
$str = '';
if( $_POST['first'] )
    $str = $_POST['first'];
if( $_POST['second'] )
    $str .= ($str != '' ? ',' : '') . $_POST['second'];
if( $_POST['third'] )
    $str .= ($str != '' ? ',' : '') . $_POST['third'];
if( $_POST['fourth'] )
    $str .= ($str != '' ? ',' : '') . $_POST['second'];
$str .= ($str != '' ? '.' : ''); 
```

这给了我这样的东西：

乔、亚当、迈克。

但是，我想在最后一项之前添加一个“**和”。**

所以它会这样写：

乔、亚当**和**迈克。

我怎样才能修改我的代码来做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-18T05:00:02.110

数组对此非常棒：

```
$str = array();
foreach (array('first','second','third','fourth') as $k) {
    if (isset($_POST[$k]) && $_POST[$k]) {
        $str[] = $_POST[$k];
    }
}
$last = array_pop($str);
echo implode(", ", $str) . " and " . $last; 
```

当有一个项目时，您可能应该对上述情况进行特殊处理。事实上，我写了一个名为“conjunction”的函数，它可以完成上述操作，并包括特殊情况：

```
function conjunction($x, $c="or")
{
    if (count($x) <= 1) {
        return implode("", $x);
    }
    $ll = array_pop($x);
    return implode(", ", $x) . " $c $ll";
} 
```

好问题！

**更新**：执行此操作的通用方法：

```
function and_form_fields($fields)
{
     $str = array();
     foreach ($fields as $k) {
         if (array_key_exists($k, $_POST) && $v = trim($_POST[$k])) {
              $str[] = $v;
         }
     }
     return conjunction($str, "and");
}

...

and_form_fields(array("Name_1","Name_2",...)); 
```

我添加了正确的 $_POST 检查以避免通知和空白值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T05:04:44.977

我想到的第一个想法是始终在辅助变量中保留姓氏。当你有另一个要输入的时候，你把它放在“逗号”上，然后在辅助中得到下一个名字。

最后，当您完成添加名称时，您添加 'and' 和来自 aux 的姓氏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T05:53:38.880

与其将每个变量作为单独的变量发布，不如将它们作为数组发布：

```
#pull the array from the POST:
$postedarray = $_POST['names'];

#count the number of elements in the posted array:
$numinarray = count($postedarray);

#subtract 1 from the number of elements, because array elements start at 0
$numinarray = $numinarray -1;

#set a prepend string
$prependstr = "and ";

#Pull the last element of the array
$lastname = $postedarray[$numinarray];

#re-define the last element to contan the prepended string
$postedarray[$numinarray] = "$prependstr$lastname";

#format the array for your requested output
$comma_separated = implode(", ", $postedarray);

print "$comma_separated"; 
```

# java - 表列名称 - NetBeans IDE

> ID：1010834
> 
> 赞同：0
> 
> 时间：2009-06-18T04:55:07.700
> 
> 标签：java, database, javadb

我正在使用 NetBeans 构建桌面应用程序。我使用 JavaDB 作为数据库。我需要一个名为 "Date" 的列。但是，每当我尝试命名一个列时，我都会收到错误消息。有什么建议么 ？

提前致谢 。

PS我是新手

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T05:05:28.410

日期是保留字。您需要将其命名为其他名称。例如，日期类型的名称类似于 DATE_CREATED

# xml - XML 中子节点容器的优缺点？

> ID：1010837
> 
> 赞同：2
> 
> 时间：2009-06-18T04:56:16.310
> 
> 标签：xml, schema

我注意到不同的 XML 模式对子元素的定义不同。有些直接在父节点下定义它们，如下所示：

```
<parent>
    <foo />
    <foo />
    ...
    <foo />
    <bar />
    <bar />
    ...
    <bar />
</parent> 
```

当其他人在子节点周围定义容器节点时，如下所示：

```
<parent>
    <foos>
        <foo />
        <foo />
        ...
        <foo />
    </foos>
    <bars>
        <bar />
        <bar />
        ...
        <bar />
    </bars>
</parent> 
```

我没有遇到任何必要的序列化/反序列化为任何一种格式的问题，而且我想不出任何理由更喜欢其中一种。

每种方法的优缺点是什么（如果有的话）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T05:01:33.997

好吧，第二个更“直观”。更有层次感。例如你有这个：

```
<animal>
 <snakes>
   <boa />
   <python />
 </snakes>
 <monkeys>
   <red_ass_monkey />
   <yellow_monkey />
 </monkeys>
</animal> 
```

当您的对象以某种方式与层次结构联系在一起时，我肯定会选择第二个，因为它更合乎逻辑。此外，当您阅读自己以直接在 xml 中修改某些内容时（以防万一），您会发现自己的方式更好，因为知道蟒蛇是一种动物的蛇（当事情变得复杂时，这比在整体中搜索要好）列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T05:02:42.747

这种结构的一种可能性是，如果您需要将一些`<foo/>`s 组合成一个重复集：

`

```
<foos id=1>
    <foo />
    <foo />
    ...
    <foo />
</foos>
<foos id=2>
    <foo />
    <foo />
    ...
    <foo />
</foos> 
```

`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T05:03:57.413

第一个方案是可扩展的，实现起来并不难，您只需遍历所有`childNodes`内容`parent`并查看名称空间和元素名称是否与您可以读取的任何内容匹配。但是，有时，拆分可能是有利的，特别是当处理`bars`取决于全部`foos`左右时。

借用一个例子：

```
<zoo xmlns="http://example.org/zoo" xmlns:z="http://example.org/zoo">
<cages>
  <cage name="open-air" />
  <cage name="glass-cage" />
</cages>
<animals>
  <monkey name="Orlan" cage="open-air"/>
  <monkey name="Jeremey" cage="glass-cage"/>
  <snake name="spssshs" cage="glass-cage"/>
  <panda xmlns="http://china.cn/zoo" z:name="Ying Ying" z:cage="open-air"/>
</animals>
</zoo> 
```

`cages`所以，分开`animals`是有道理的。但是，如果您将动物分组为猴子和蛇，则需要为 pandas 添加大量额外的处理逻辑。

# .net - Flash Lite 在 webservice .net 基础上访问复杂数据？

> ID：1010838
> 
> 赞同：1
> 
> 时间：2009-06-18T04:56:24.267
> 
> 标签：.net, web-services, flashlite

我是 flashlite/actionscript 的新手，我的问题是.. 我如何调用具有复杂数据（返回数据和参数）的 web 服务中的方法，web 服务是基于 .net 的，它针对移动友好类型的 web 服务进行了调整（没有xsd：import）......当来自WS的复杂数据/参数是c＃的结构数据时，问题就出现了......我认为AS / Flash需要在数据处理中进行一些远程访问......我已经读过要进行闪存远程处理，您必须在机器中安装闪存远程处理，但是它可以在手机中使用吗？如何使用手机中的闪光灯处理来自 / 到 WS 的复杂数据......对不起，我真的很新......希望有人能帮助我......

我从 WS 方法调用此错误消息... complexDataStructure myMethod(); “无法连接到端点：[http://localhost:8001/myservice](http://localhost:8001/myservice) undefined”

我可以加载我的 Web 服务，并且在某些具有简单数据类型的方法上没有问题……我只是不知道如何处理具有复杂类型的方法……

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-30T03:46:05.623

你能举一个复杂数据类型的例子吗？

我很想使来自 web 服务的对象变得非常简单，即使这意味着 flash 必须进行一些处理才能适当地使用它们。

# python - 在 django 中遍历多维字典

> ID：1010848
> 
> 赞同：-1
> 
> 时间：2009-06-18T05:01:43.483
> 
> 标签：python, django, django-models, dictionary, django-templates

我在 Python 领域的第一天是一个 PHP 人，试图将一个 php 站点转换为 python（学习经验），我很想得到建议。我从来没有想过使用多维数组或字典会如此困难，就像你们 Python 人所说的那样。

[所以我可以使用这个](http://parand.com/say/index.php/2007/07/13/simple-multi-dimensional-dictionaries-in-python/)创建多维数组，但我不能在 django 模板中循环它。[这](http://code.activestate.com/recipes/389639/)不起作用，但我想如果我能让它工作，我就无法循环通过它。

```
{% for key,val in dictionary.items %} 
```

似乎只适用于实际字典，而不适用于 custon 多维字典类。

我正在从 sql 查询创建我的字典：

```
vid[ video[ 7 ] ][ 'cat_short_name' ] = video[ 2 ]
vid[ video[ 7 ] ][ 'cat_name' ] = video[ 1 ]
vid[ video[ 7 ] ][ 'cat_id' ] = video[ 7 ]

vid[ video[ 7 ] ][ 'companies' ][ video[ 14 ] ][ 'comp_short_name' ] = video[ 5 ]
vid[ video[ 7 ] ][ 'companies' ][ video[ 14 ] ][ 'comp_name' ] = video[ 4 ]
vid[ video[ 7 ] ][ 'companies' ][ video[ 14 ] ][ 'comp_website' ] = video[ 6 ]

vid[ video[ 7 ] ][ 'companies' ][ video[ 14 ] ][ 'videos' ][ video[ 8 ] ][ 'top_video' ] = 0
vid[ video[ 7 ] ][ 'companies' ][ video[ 14 ] ][ 'videos' ][ video[ 8 ] ][ 'vid_id' ] = video[ 8 ]
vid[ video[ 7 ] ][ 'companies' ][ video[ 14 ] ][ 'videos' ][ video[ 8 ] ][ 'vid_name' ] = video[ 9 ]
vid[ video[ 7 ] ][ 'companies' ][ video[ 14 ] ][ 'videos' ][ video[ 8 ] ][ 'vid_url' ] = video[ 10 ] 
```

我基本上需要获取某个类别中的所有公司，然后获取该公司中的所有视频，以便我可以轻松地将它们嵌套在我的模板中。这就是我在 php 中的做法，创建了一个巨大的深度数组。尝试在 Python 中复制已被证明是困难的。

我想也许我可以使用 set_MODEL 在 django 中进行向后查找，但我也想不通。

任何有关如何实现我的目标的帮助将不胜感激。我希望我的问题很清楚

## 编辑：

当我在我的模板中循环完成时，它看起来像这样......

```
<h1>Category</h1>
   <h2>Company</h2>
   <ul>
        <li>video</li>
    </ul>
    <h2>Company</h2>
    <ul>
        <li>video</li>
        <li>video</li>
    </ul>
<h1>Category</h1>
   <h2>Company</h2>
   <ul>
        <li>video</li>
    </ul>
    <h2>Company</h2>
    <ul>
        <li>video</li>
        <li>video</li>
    </ul> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T06:54:50.373

您应该使用内置的[ORM](http://docs.djangoproject.com/en/dev/topics/db/)而不是使用您自己的查询（至少对于像这样简单的事情），这会使事情变得更容易（假设您还在 models.py 文件中构建了模型）

在您看来：

```
def categories_view(request):
    categories = Categories.objects.all()   #maybe put an order_by or filter here
    return render_to_response("your_template.html", {'categories':categories}) 
```

在您的模板中：

```
{% for category in categories %}
    <h1>{{ category.name }}</h1>
    {% for company in category.company_set.all %}
        <h2>{{ company.name }}</h2>
        <ul>
        {% for video in company.video_set.all %}
            <li>{{ video.name }}</li>
        {% endfor %}
        </ul>
    {% endfor %}
{% endfor %} 
```

我没有测试过它，但它应该可以工作。将此代码与您在不使用 ORM（PHP 或 Python）时必须编写的代码进行比较。

查看 django 文档以获取更多信息，我建议您花几个小时完成[教程](http://docs.djangoproject.com/en/dev/intro/tutorial01/#intro-tutorial01)。

**更新：**修改代码以使用“_set.all”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T06:22:54.557

从一种语言或框架迁移到另一种语言或框架时，您需要意识到以完全相同的方式编写代码通常不是一个好主意，即使您可以。

例如：

> 我正在从 sql 查询创建我的字典

你为什么做这个？在 Django 中表示来自数据库的对象的方法是使用模型。这将为您处理很多事情，包括 SQL，但也有助于迭代相关表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T05:08:08.530

我也是一个Django初学者......

您应该能够嵌套 for 循环以获得如下内容：

```
{% for key,val in dictionary.items %}
    {% for key,val in val.items %} 
```

等等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T05:10:13.473

如果您按以下方式构建复杂的字典：

```
vid[ video[ 7 ], 'cat_short_name' ] = video[ 2 ]
vid[ video[ 7 ], 'cat_name' ] = video[ 1 ]
vid[ video[ 7 ], 'cat_id' ] = video[ 7 ]

vid[ video[ 7 ], 'companies', video[ 14 ], 'comp_short_name' ] = video[ 5 ] 
```

等等，会有帮助吗？在这种情况下，关键是一个元组（前三种情况有 2 个项目，第四个有 4 个项目），我不确定你的意思是如何对待它，但是项目上的循环以获取键和值，就其本身而言，应该可以正常工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T06:04:25.523

 `````
{% for key, val in vid.items %}
    <h1>{{ val.cat_name }}</h1>
    {% for k2, v2 in val.companies.items %}
        <h2>{{ v2.comp_name }}</h2>
        <ul>
        {% for k3, v3 in v2.videos.items %}
            <li>{{ v3.vid_name }}</li>
        {% endfor %}
        </ul>
    {% endfor %}
{% endfor %} 
`````

# sql - SQL - 多行成单列

> ID：1010849
> 
> 赞同：3
> 
> 时间：2009-06-18T05:02:15.090
> 
> 标签：sql, tsql

我想从下面的查询中获取数据输出，并将所有电子邮件地址连接在一起，并用按员工姓名分组的分号分隔。

```
SELECT
    DISTINCT
    p.email
    , e.name 
FROM
    PERSON p
INNER JOIN 
    EMPLOYEE e
ON 
    p.agentofrecord_id = e.employee_id 
WHERE 
    dbo.GetPersonMember(p.person_id) = 1
    AND (p.isactive = 1)
    AND p.email <> ''
ORDER BY name 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T05:04:55.493

基本上，看起来您想要`GROUP_CONCAT`在 TSQL 中使用 MySql 的聚合函数。如果是这种情况，[这篇文章](http://blog.shlomoid.com/2008/11/emulating-mysqls-groupconcat-function.html)可能会有所帮助——看看吧！

# wpf - 复选框未按预期更新

> ID：1010851
> 
> 赞同：1
> 
> 时间：2009-06-18T05:03:56.583
> 
> 标签：wpf, vb.net, .net-3.5, binding

我有一个绑定到业务对象列表的列表框。列表框中的项目使用 itemtemplate 进行格式化。itemtemplate 包括一个绑定到业务对象的布尔属性的复选框。当我启动应用程序时，当我单击复选框时，列表中对象的 bool 属性会发生变化。到目前为止，一切都很好。

该对话框具有“全选”和“全部清除”按钮。当我单击这些按钮时，对象的属性会更改，但复选框不会更新。

全选点击事件中的代码是。. .

```
For Each x As BusObj In _BusObjList
  x.BlockIsInserted = True
Next 
```

我可以单步执行代码并观察对象属性的变化，但复选框不会更新。有什么建议么？

谢谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T05:10:02.227

使用双向绑定应该有助于我猜

```
{Binding ..., Path=Text, Mode=TwoWay} 
```

是的，是 BlockIsInserted 属性依赖项吗？或实施 INotifyPropertyChanged？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-06-20T18:26:32.333

我遇到了同样的问题，即使绑定设置为双向并且表示业务对象的视图模型正确实现了 INotifyPropertyChanged。我发现的（相当蛮力的）解决方案是 NotifyChanged 在表示业务对象集合的属性上 - 这解决了问题。

# php - 如果语句不起作用

> ID：1010854
> 
> 赞同：0
> 
> 时间：2009-06-18T05:04:37.647
> 
> 标签：php, mysql

如果数据库中“站点”列下的任何地方都没有 $entry 值，我希望下面的代码输出为“$entry 不存在”。但是，当我输入一个我知道不在数据库“站点”列下的 $entry 值时，这不会发生。我的 if 语句有问题吗？

提前致谢，

约翰

```
$result = mysql_query("SHOW TABLES FROM feather") 
or die(mysql_error()); 

while(list($table)= mysql_fetch_row($result))
{
  $sqlA = "SELECT COUNT(*) FROM `$table` WHERE `site` LIKE '$entry'";

  $resA = mysql_query($sqlA) or die("$sqlA:".mysql_error());
  if(mysql_num_fields($resA)>0){
  list($isThere) = mysql_fetch_row($resA);
  if ($isThere)
  {
     $table_list[] = $table;
  }
  }
  else{
print "<p class=\"topic\">$entry does not exist</p>\n";
}
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T05:23:30.983

是的。但是，您的格式并没有真正做到公正，请尝试清理它以便更容易理解。NetBeans IDE，甚至 Zend Development Environmont ($) 都会自动进行代码格式化，这让生活变得更轻松。

```
$result = mysql_query("SHOW TABLES FROM feather") or die(mysql_error()); 
while(list($table)= mysql_fetch_row($result)) {
    $sqlA = "SELECT COUNT(*) FROM `$table` WHERE `site` LIKE '$entry'";

    $resA = mysql_query($sqlA) or die("$sqlA:".mysql_error());
    if(mysql_num_fields($resA)>0){
        list($isThere) = mysql_fetch_row($resA);
        if ($isThere) {
            $table_list[] = $table;
        }
    } else{
        print "<p class=\"topic\">$entry does not exist</p>\n";
    }
} 
```

简而言之：

mysql_num_fields($resA) 总是大于零，因为 COUNT(*) 函数将始终返回一个值，无论（0 或 1 或 1000000 等）

要修复，将 else 提高一级，我会使用强制更安全。最后，mysql_num_fields 并不是必需的，因为您知道它始终为 1：

```
$result = mysql_query("SHOW TABLES FROM feather") or die(mysql_error()); 
while(list($table)= mysql_fetch_row($result)) {
    $sqlA = "SELECT COUNT(*) FROM `$table` WHERE `site` LIKE '$entry'";
    $resA = mysql_query($sqlA) or die("$sqlA:".mysql_error());
    list($isThere) = mysql_fetch_row($resA);
    $isThere = intval($isThere);
    if ($isThere > 0) {
        $table_list[] = $table;
    } else{
        print "<p class=\"topic\">$entry does not exist</p>\n";
    }
} 
```

你有它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-15T02:44:00.807

请出于对互联网的热爱，不要自己构建 SQL 查询。使用[PDO](http://php.net/pdo)。

# performance - 对于 VS Foreach 的阵列性能（在 AS3/Flex 中）

> ID：1010859
> 
> 赞同：16
> 
> 时间：2009-06-18T05:06:26.503
> 
> 标签：performance, flash, actionscript-3, apache-flex, actionscript

哪个更快？为什么？

```
var messages:Array = [.....]

// 1 - for
var len:int = messages.length;
for (var i:int = 0; i < len; i++) {
    var o:Object = messages[i];
    // ...
}

// 2 - foreach
for each (var o:Object in messages) {
    // ...
} 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-06-21T01:50:53.793

从我坐的地方来看，常规`for`循环比`for each`最小情况下的循环要快一些。此外，与 AS2 天一样，通过`for`循环递减方式通常会提供非常小的改进。

但实际上，这里的任何细微差别都会与您在循环中实际执行的操作的要求相形见绌。您可以找到在任何一种情况下工作得更快或更慢的操作。真正的答案是，没有一种循环可以有意义地说比另一种更快——您必须分析您的代码，因为它出现在您的应用程序中。

示例代码：

```
var size:Number = 10000000;
var arr:Array = [];
for (var i:int=0; i<size; i++) { arr[i] = i; }
var time:Number, o:Object;

// for()
time = getTimer();
for (i=0; i<size; i++) { arr[i]; }
trace("for test: "+(getTimer()-time)+"ms");

// for() reversed
time = getTimer();
for (i=size-1; i>=0; i--) { arr[i]; }
trace("for reversed test: "+(getTimer()-time)+"ms");

// for..in
time = getTimer();
for each(o in arr) { o; }
trace("for each test: "+(getTimer()-time)+"ms"); 
```

结果：

```
for test: 124ms
for reversed test: 110ms
for each test: 261ms 
```

编辑：为了改进比较，我改变了内部循环，所以它们除了访问集合值什么都不做。

编辑 2：对 oshyshko 评论的回答：

1.  编译器可以跳过我的内部循环中的访问，但它不会。如果是这样，循环退出的速度会快两到三倍。
2.  您发布的示例代码中的结果发生了变化，因为在该版本中，`for`循环现在具有隐式类型转换。为了避免这种情况，我将作业排除在循环之外。当然，有人可能会争辩说，在`for`循环中有一个额外的演员是可以的，因为“真正的代码”无论如何都需要它，但对我来说，这只是另一种说法“没有一般的答案；哪个循环更快取决于你做什么在你的循环内”。这是我给你的答案。;)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-21T03:50:59.017

在遍历数组时，for each 循环在我的测试中要快得多。

```
var len:int = 1000000;
var i:int = 0;
var arr:Array = [];

while(i < len) {
    arr[i] = i;
    i++;
}

function forEachLoop():void {
    var t:Number = getTimer();
    var sum:Number = 0;
    for each(var num:Number in arr) {
        sum += num;
    }
    trace("forEachLoop :", (getTimer() - t));
}

function whileLoop():void {
    var t:Number = getTimer();
    var sum:Number = 0;
    var i:int = 0;
    while(i < len) {
        sum += arr[i] as Number;                
        i++;
    }
    trace("whileLoop :", (getTimer() - t));
}

forEachLoop();
whileLoop(); 
```

这给出了：

forEachLoop：87 whileLoop：967

在这里，可能大部分 while 循环时间都用于将数组项转换为数字。但是，我认为这是一个公平的比较，因为这是你在 for each 循环中得到的。

我的猜测是，这种差异与这样一个事实有关，如前所述，as 运算符相对昂贵且数组访问也相对较慢。我认为，对于每个循环，这两个操作都是本地处理的，而不是在 Actionscript 中执行的。

但是请注意，如果确实发生了类型转换，则 for each 版本会慢得多，而 while 版本会明显更快（尽管仍然是 for each beats while）：

要进行测试，请将数组初始化更改为：

```
while(i < len) {
    arr[i] = i + "";
    i++;
} 
```

现在结果是：

forEachLoop：328 whileLoop：366

forEachLoop：324 whileLoop：369

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-22T09:43:04.647

我之前和几位同事讨论过这个问题，我们都发现了针对不同场景的不同结果。但是，为了比较，我发现有一个测试很有说服力：

```
var array:Array=new Array();
for (var k:uint=0; k<1000000; k++) {
    array.push(Math.random());
}

stage.addEventListener("mouseDown",foreachloop);
stage.addEventListener("mouseUp",forloop);

/////// Array /////

/* 49ms */
function foreachloop(e) {
    var t1:uint=getTimer();
    var tmp:Number=0;
    var i:uint=0;
    for each (var n:Number in array) {
        i++;
        tmp+=n;
    }
    trace("foreach", i, tmp, getTimer() - t1);
}
/***** 81ms  ****/
function forloop(e) {
    var t1:uint=getTimer();
    var tmp:Number=0;
    var l:uint=array.length;
    for(var i:uint = 0; i < l; i++)
        tmp += Number(array[i]);
    trace("for", i, tmp, getTimer() - t1);
} 
```

我喜欢这个测试的地方在于，您在两个循环的每次迭代中都有一个键和值的参考（在“for-each”循环中删除键计数器并不那么相关）。此外，它与 Number 一起运行，这可能是您想要优化的最常见的循环。最重要的是，获胜者是“for-each”，这是我最喜欢的循环：P

笔记：

- 在“for-each”循环的函数中引用局部变量中的数组是无关紧要的，但在“for”循环中，您确实会遇到减速带（75ms 而不是 105ms）：

```
function forloop(e) {
    var t1:uint=getTimer();
    var tmp:Number=0;
    var a:Array=array;
    var l:uint=a.length;
    for(var i:uint = 0; i < l; i++)
        tmp += Number(a[i]);
    trace("for", i, tmp, getTimer() - t1);
} 
```

- 如果您使用 Vector 类运行相同的测试，结果会有点混乱：S

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T05:15:00.867

对于数组来说，for 会更快……但根据情况，它可能是最好的 foreach……请参阅这个[.net 基准测试](http://diditwith.net/2006/10/05/PerformanceOfForeachVsListForEach.aspx)。

就个人而言，我会使用其中任何一种，直到我需要优化代码为止。过早的优化是浪费:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-15T23:46:32.483

也许在所有元素都存在并从零（0到X）开始的数组中，使用for循环会更快。在所有其他情况下（稀疏数组），每个使用它可能会快很多。原因是数组中使用了两种数据结构：Hast table 和 Debse Array。请阅读我使用 Tamarin 来源的阵列分析：http: [//jpauclair.wordpress.com/2009/12/02/tamarin-part-i-as3-array/](http://jpauclair.wordpress.com/2009/12/02/tamarin-part-i-as3-array/)

for 循环将检查未定义的索引，其中 for each 将跳过那些跳转到 HastTable 中的下一个元素的索引

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-10-01T09:48:20.497

伙计们！尤其是**胡安·巴勃罗·卡利法诺**。我检查了你的测试。获取数组项的主要区别。如果你放`var len : int = 40000;`，你会看到'while'循环更快。但是它会丢失大量的数组，而不是 for..each。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-09-13T09:05:52.737

只是一个附加组件：

a ***for each...in***循环并不能向您保证，***数组/向量***中的元素会按照它们存储在其中的顺序进行枚举。（XML 除外）这是一个至关重要的区别，IMO。

“...因此，您不应该编写依赖于 for-each-in 或 for-in 循环的枚举顺序的代码，除非您正在处理 XML 数据...” C.Moock

（我希望不要违反法律说明这句话......）

快乐的基准测试。

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2009-06-18T15:59:27.810

很抱歉证明你们错了，但每个人都更快。甚至很多。除非，如果您不想访问数组值，但是 a）这没有意义，b）这里不是这种情况。

因此，我在我的超级新博客上发表了详细[的帖子......：D](http://back2dos.wordpress.com/2009/06/18/actionscript-3-iteration/)

问候

back2dos

# php - 为什么我在 CakePHP 中收到我的视图未找到的错误？

> ID：1010860
> 
> 赞同：0
> 
> 时间：2009-06-18T05:06:48.813
> 
> 标签：php, cakephp

我正在使用 cakephp 进行表单设计应用程序。

在我的代码中

```
<?php echo $html->link('Delete', array('action' => 'deleteForm', 'id' => $r['Form']['id']), null, 'Are you sure?' )?> 
```

在我的控制器中

```
 function deleteForm($id = null) {
          $this->Form->del($id);
          $this->Session->setFlash('Your entry has been deleted.');
          $this->redirect(array('action'=>'homepage'));
   } 
```

在我的 deleteForm.ctp 文件中，我只保留了一个反向链接。

表格被删除，Flash 消息来了。但显示错误

```
forms/deleteForm/1 is not found in this SERVER. 
```

**解决方案：** 错误是因为我将视图文件保存为deleteForm.ctp，而不是delete_form.ctp。现在它起作用了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T05:13:00.930

这是您关于 PHP 和 CakePHP 的第二个非常基本的问题，我可以建议您阅读各自的文档吗？

*   [PHP 文档](http://www.php.net/manual/)
*   [CakePHP 文档](http://book.cakephp.org/)

为了给你指明正确的方向，这里是 AppController::redirect() 的文档：

*   [3.5.4.2.1 重定向](http://book.cakephp.org/view/57/Controller-Methods#redirect-425)

请在发布简单问题之前阅读文档，这些问题将通过快速浏览来回答。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2012-07-02T03:30:52.353

我之前也有同样的问题，我用的是WAMP，控制器的编码是UTF-8，这种情况下redirect方法不起作用，但是把文件的编码改成ANSI，就可以了！

因此，尝试在 Windows 中将编码更改为 ANSI。

# video-encoding - 媒体编码

> ID：1010864
> 
> 赞同：0
> 
> 时间：2009-06-18T05:08:50.683
> 
> 标签：video-encoding, content-encoding

我必须为从各种来源收集媒体的项目选择数字化和编码媒体的方法。
我应该考虑哪些开放媒体编码标准？
哪些因素会影响我对选择的决定？

干杯
乌奇塔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T05:22:03.217

有很多事情需要考虑，例如：平台、编码速度、客户将满足的要求（在编解码器方面）、质量/大小的权衡。看看[xvid](http://www.xvid.org/)。这是一个免费的 PC MPEG-4 视频编解码器。

# methodology - 您是如何构思 Web 应用程序的？

> ID：1010865
> 
> 赞同：1
> 
> 时间：2009-06-18T05:08:57.360
> 
> 标签：methodology

我想知道当您从头开始启动 Web 应用程序时，您遵循哪些步骤和哪些概念。

当您被要求开发一个新的 Web 应用程序时，您被告知的唯一一件事就是需要哪些功能，您会怎么做？

您如何以及以何种顺序构思应用程序中的所有不同层，从数据库设计到 UI 设计，而不会忘记后端......

您使用哪些工具？你遵守哪些规则？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T05:14:29.697

我喜欢从故事板开始。我使用模拟屏幕作为示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T05:49:59.540

我觉得这篇文章很足智多谋。

希望能帮助到你 ：）

[开发 Web 应用程序必须了解的结构化流程](http://woork.blogspot.com/2009/01/structured-process-you-must-know-to.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T05:37:41.557

尝试编写一些功能规范，在编写应用程序必须处理的不同功能时简单地捕捉到一些东西。完成此操作后，您可以坐下来确定最适合您需求的框架/语言/平台/等。在这个阶段，模型也会有所帮助 - 尝试准确找出您需要哪些屏幕以及每个屏幕上必须包含哪些信息 - 不要担心布局，只需担心必要的信息。从那里您可以继续对这些屏幕中的每一个进行编码 - 确保您只提供设计中的功能 - 没有必要仅仅因为可以而使事情过于复杂。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T06:30:06.043

对这个问题的任何回答都是非常主观的。

关于如何以及以什么顺序，你可以参考这些线程，这些线程显然是不确定的：
[哪个更重要？数据库设计或编码？](https://stackoverflow.com/questions/773715/which-is-more-important-db-design-or-coding)
[https://stackoverflow.com/questions/329160?sort=votes#sort-top](https://stackoverflow.com/questions/329160?sort=votes#sort-top)

关于这些工具，这里有一个主题：
[您使用什么进行 Web 开发以及您认为它为何如此出色？](https://stackoverflow.com/questions/214057/what-do-you-use-for-web-development-and-why-you-think-it-rocks)

您遵循的规则部分与您使用的工具相关，部分与您选择的设计相关。您应该了解可用框架和工具的好处和限制来完成您需要完成的工作。

在设计应用程序时，您可以根据需要进行尽可能多的预先计划以了解问题（即：故事板、UI 模型、实体关系图、功能规范等）。目标是了解您正在解决哪些问题以及您希望用户在应用程序上进行哪些交互，然后使用合适的技术来实现该目标 - 以尽可能最有效和最灵活的方式进行优化。

# lucene - 跨 2 个应用服务器同步 Lucene 索引

> ID：1010868
> 
> 赞同：2
> 
> 时间：2009-06-18T05:09:51.150
> 
> 标签：lucene, lucene.net

我有一个托管在 Web 服务器（IIS 7）上的 asp.net Web 应用程序。它使用 Lucene 进行搜索功能。Lucene 搜索请求由位于 2 个应用程序服务器 (IIS 7) 上的 .Net WCF 服务提供服务。这两个应用程序服务器使用“netscaler”进行负载平衡。

这两个服务器都托管一个 .net windows 服务，该服务每天晚上更新各自服务器上的搜索索引。

我需要在这两个服务器上同步搜索索引，以便在任何时候这两个服务器都有最新的索引。考虑到两个应用程序服务器中的任何一个都可以根据其可用性来服务搜索请求，我在想什么可能是最好的架构/设计策略。

请问有什么输入吗？

谢谢阅读！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T06:15:34.493

基本上，您需要相同 Lucene 索引的两个相同副本 - 每个 IIS 服务器一个。我相信最简单的方法是在一台机器上建立一个更新的索引，对其进行优化，然后将其复制到另一台机器上。在 Linux 上我会使用[rsync](http://www.samba.org/rsync/)，但我不知道 Windows 的等价物。请参阅[Jeff Atwood 关于 Windows rsync 替代方案的想法](http://www.codinghorror.com/blog/archives/001045.html)。或者，您可以向两个 Lucene 索引发出相同的索引更新命令并验证它们是否被正确处理。这在技术上更难，并且仅在您有更频繁的更新时才有用。有关分布式 Lucene 索引的更广泛讨论，请参阅[Scaling Lucene 和 Solr](http://www.lucidimagination.com/Community/Hear-from-the-Experts/Articles/Scaling-Lucene-and-Solr)。

# c++ - 具有精度的字符串到整数散列函数

> ID：1010875
> 
> 赞同：4
> 
> 时间：2009-06-18T05:14:25.890
> 
> 标签：c++, hash

我想将 char 数组散列到 int 或 long 中。结果值必须遵守给定的精度值。我一直在使用的功能如下：

```
int GetHash(const char* zKey, int iPrecision /*= 6*/)
{
        /////FROM : http://courses.cs.vt.edu/~cs2604/spring02/Projects/4/elfhash.cpp

        unsigned long h = 0;
        long M = pow(10, iPrecision);

        while(*zKey)
        {
                h = (h << 4) + *zKey++;
                unsigned long g = h & 0xF0000000L;
                if (g) h ^= g >> 24;
                h &= ~g;
        }            

        return (int) (h % M);
} 
```

要散列的字符串类似于“SAEUI1210.00000010_1”。

但是，这在某些情况下会产生重复值。是否有任何好的替代方案不会为不同的字符串值复制相同的哈希值。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-18T05:20:27.007

散列的定义是它为某些值产生重复值，因为散列值范围小于散列数据的空间。

理论上，32 位散列有足够的范围来散列所有 ~6 个字符串（仅限 AZ、az、0-9），而不会导致冲突。在实践中，散列并不是输入的完美排列。给定一个 32 位散列，由于[生日悖论](http://en.wikipedia.org/wiki/Birthday_paradox)，您可以预期在散列约 16 位随机输入后会出现散列冲突。

给定一组静态数据值，总是可以构造一个专门为它们设计的散列函数，它永远不会与自身发生冲突（当然，它的输出大小至少是`log(|data set|)`. 但是，它需要你知道所有可能的数据值提前。这称为[完美散列](http://en.wikipedia.org/wiki/Perfect_hash_function)。

话虽如此，[这里](http://www.cse.yorku.ca/~oz/hash.html)有一些可以帮助您入门的替代方案（它们旨在最大程度地减少碰撞）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T05:20:02.187

每个哈希都会有冲突。时期。这就是所谓的[生日问题](http://en.wikipedia.org/wiki/Birthday_paradox)。

您可能想检查加密是否具有 MD5 之类的功能（相对较快，并且您不在乎它不安全），但它也会发生冲突。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T05:20:33.683

哈希为不同的输入生成相同的值——这就是它们的作用。您所能做的就是创建一个具有足够分布或位深度（或两者兼有）的哈希函数，以最大限度地减少这些冲突。由于您有这个额外的精度限制（0-5？），那么您将更频繁地遇到碰撞。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T05:29:10.993

[MD5](http://en.wikipedia.org/wiki/MD5)或[SHA](http://en.wikipedia.org/wiki/SHA_hash_functions)。有许多开放的实现，结果不太可能产生重复的结果。

# java - 创建arraylist哈希图的最佳方法

> ID：1010879
> 
> 赞同：32
> 
> 时间：2009-06-18T05:17:24.013
> 
> 标签：java, data-structures, collections, arraylist, hashmap

我有一百万行 .txt 格式的数据。格式非常简单。对于每一行：

```
用户 1，值 1
用户2，价值2
用户 3，价值 3
用户 1，值 4
...

```

你知道我的意思。对于每个用户，它可能出现多次，或者只出现一次（你永远不知道）。我需要找出每个用户的所有值。因为用户可能随机出现，所以我使用 Hashmap 来做。即：HashMap(key: String, value: ArrayList)。但是要向arrayList添加数据，我必须不断地使用HashMap get(key)来获取arrayList，给它添加值，然后把它放回HashMap。我觉得效率不是很高。有人知道更好的方法吗？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-06-18T06:19:53.220

您无需将 ArrayList 重新添加回您的地图。如果 ArrayList 已经存在，那么只需将您的值添加到它。

改进的实现可能如下所示：

```
Map<String, Collection<String>> map = new HashMap<String, Collection<String>>(); 
```

在处理每一行时：

```
String user = user field from line
String value = value field from line

Collection<String> values = map.get(user);
if (values==null) {
    values = new ArrayList<String>();
    map.put(user, values)
}
values.add(value); 
```

**2014 年4 月跟进**- 我在 2009 年写了原始答案，当时我对 Google Guava 的了解有限。鉴于 Google Guava 所做的一切，我现在建议使用它`Multimap`而不是重新发明它。

```
Multimap<String, String> values = HashMultimap.create();
values.put("user1", "value1");
values.put("user2", "value2");
values.put("user3", "value3");
values.put("user1", "value4");

System.out.println(values.get("user1"));
System.out.println(values.get("user2"));
System.out.println(values.get("user3")); 
```

输出：

```
[value4, value1]
[value2]
[value3] 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-06-18T05:21:50.970

使用 Google Collections 中的 Multimap。它允许同一个键有多个值

[https://google.github.io/guava/releases/19.0/api/docs/com/google/common/collect/Multimap.html](https://google.github.io/guava/releases/19.0/api/docs/com/google/common/collect/Multimap.html)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2018-03-22T12:20:48.443

从 Java 8 开始，您可以使用`map.computeIfAbsent`

[https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#computeIfAbsent-K-java.util.function.Function-](https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#computeIfAbsent-K-java.util.function.Function-)

```
Collection<String> values = map.computeIfAbsent(user, k -> new ArrayList<>());
values.add(value); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-18T05:21:58.177

HashMap 中的 ArrayList 值是引用。您不需要“将其放回 HashMap”。您正在对已作为 HashMap 中的值存在的对象进行操作。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-03-11T15:47:15.363

如果您不想导入库。

```
package util;    

import java.util.ArrayList;    
import java.util.HashMap;    
import java.util.List;    

/**    
 * A simple implementation of a MultiMap. This implementation allows duplicate elements in the the    
 * values. (I know classes like this are out there but the ones available to me didn't work).    
 */    
public class MultiMap<K, V> extends HashMap<K, List<V>> {    

  /**    
   * Looks for a list that is mapped to the given key. If there is not one then a new one is created    
   * mapped and has the value added to it.    
   *     
   * @param key    
   * @param value    
   * @return true if the list has already been created, false if a new list is created.    
   */    
  public boolean putOne(K key, V value) {    
    if (this.containsKey(key)) {    
      this.get(key).add(value);    
      return true;    
    } else {    
      List<V> values = new ArrayList<>();    
      values.add(value);    
      this.put(key, values);    
      return false;    
    }    
  }    
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T05:24:46.317

我认为你想要的是Multimap。您可以从 apache 的 commons 集合或 google-collections 中获取它。

[http://commons.apache.org/collections/](http://commons.apache.org/collections/)

[http://code.google.com/p/google-collections/](http://code.google.com/p/google-collections/)

> “类似于 Map 的集合，但它可能将多个值与单个键相关联。如果您使用相同的键但不同的值调用 put(K, V) 两次，则多重映射包含从键到两个值的映射。”

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-01-06T15:59:28.717

我找不到任何简单的方法。MultiMap 并不总是可用的选项。所以我写了这个。

```
public class Context<K, V> extends HashMap<K, V> {

    public V addMulti(K paramK, V paramV) {
        V value = get(paramK);
        if (value == null) {
            List<V> list = new ArrayList<V>();
            list.add(paramV);
            put(paramK, paramV);
        } else if (value instanceof List<?>) {
            ((List<V>)value).add(paramV);
        } else {
            List<V> list = new ArrayList<V>();
            list.add(value);
            list.add(paramV);
            put(paramK, (V) list);
        }
        return paramV;
    }
} 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-06-18T05:21:29.533

如果您使用 LinkedList 而不是 ArrayList 会更快，因为 ArrayList 在接近容量时需要调整大小。

您还需要适当地估计您正在创建的包装集合（HashMap 或 Multimap）的容量，以避免重复重新散列。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-10-05T03:43:16.693

如前所述，`MultiMap`是您的最佳选择。

根据您的业务需求或对数据文件的限制，您可能需要考虑对其进行一次性排序，以使其更适合加载。

# c# - 如何识别和获取sqlserver数据文件filepath

> ID：1010881
> 
> 赞同：0
> 
> 时间：2009-06-18T05:19:17.117
> 
> 标签：c#, sql-server, sql-server-2005, smo

恐怕我无法找到 SQL SERVER 数据文件的绝对路径。

我试图通过执行以下操作来做到这一点。

```
 foreach( Database db in srv.Databases)
     string filepath=db.PrimaryFilepath;
     string name=db.Name;
     abspth=filepath+"//"+name+".mdf"; 
```

像这样我有解决方法。但是有没有其他方法可以获得绝对路径。

但如果是日志文件，它会给出绝对路径.......

在这方面帮助我...

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T05:33:59.847

在`Database`SMO 中应该包含一个`Filegroups`集合，该集合又包含一个`Files`集合 - 你应该在那里找到你的文件路径。

```
 foreach(FileGroup fg in db.FileGroups)
        {
            foreach(DataFile df in fg.Files)
            {
                Console.WriteLine("File path: {0}", df.FileName);
            }
        } 
```

马克

# language-agnostic - 文体问题：空白的使用

> ID：1010886
> 
> 赞同：4
> 
> 时间：2009-06-18T05:21:40.283
> 
> 标签：language-agnostic, coding-style, whitespace

我对我的代码的美学有一种特别愚蠢的不安全感......坦率地说，我对空格的使用很尴尬。我的代码看起来像极客跳舞；不是很吓人，但很尴尬，以至于你盯着看会感觉很糟糕，但又无法移开视线。

我只是不确定何时应该留下空白行或使用行尾注释而不是上面的行注释。我更喜欢在我的代码上方发表评论，但有时为了三个字的评论打断流程似乎很奇怪。有时在一段代码之前和之后加入一个空行就像在一段平滑的代码中放一个减速带。例如，在一个嵌套循环中，在中间分隔三行或四行代码块几乎抵消了缩进的视觉效果（我注意到 K&R 括号比 Allman/BSD/GNU 样式更不容易出现这个问题）。

我个人的偏好是密集的代码，除了函数/方法/注释块之间，几乎没有“减速带”。对于棘手的代码部分，我喜欢留下一个大的注释块，告诉你我将要做什么以及为什么，然后在该代码部分中添加一些“标记”注释。不幸的是，我发现其他一些人通常喜欢大方的垂直空白。一方面，我可以拥有更高的信息密度，而其他人认为流动性不是很好，另一方面，我可以以更低的信噪比为代价拥有更好的流动代码库。

我知道这是一件微不足道、愚蠢的事情，但这是我真正想要努力的事情，因为我提高了我的其他技能。

有人愿意提供一些提示吗？你认为什么是流畅的代码，在哪里使用垂直空白是合适的？对两三个字评论的行尾评论有什么想法吗？

谢谢！

PS 这是我一直在研究的代码库中的一种方法。不是我最好的，但不是我迄今为止最差的。

```
/**  
 * TODO Clean this up a bit.  Nothing glaringly wrong, just a little messy.  
 * Packs all of the Options, correctly ordered, in a CommandThread for executing.  
 */  
public CommandThread[] generateCommands() throws Exception
 {  
  OptionConstants[] notRegular = {OptionConstants.bucket, OptionConstants.fileLocation, OptionConstants.test, OptionConstants.executable, OptionConstants.mountLocation};  
  ArrayList<Option> nonRegularOptions = new ArrayList<Option>();  
  CommandLine cLine = new CommandLine(getValue(OptionConstants.executable));  

  for (OptionConstants constant : notRegular)  
   nonRegularOptions.add(getOption(constant));  

  // --test must be first  
  cLine.addOption(getOption(OptionConstants.test));  

  // and the regular options...  
  Option option;  
  for (OptionBox optionBox : optionBoxes.values())  
   {  
    option = optionBox.getOption();  
    if (!nonRegularOptions.contains(option))  
     cLine.addOption(option);  
   }  

  // bucket and fileLocation must be last  
  cLine.addOption(getOption(OptionConstants.bucket));  
  cLine.addOption(getOption(OptionConstants.fileLocation));  

  // Create, setup and deploy the CommandThread  
  GUIInteractiveCommand command = new GUIInteractiveCommand(cLine, console);  
  command.addComponentsToEnable(enableOnConnect);  
  command.addComponentsToDisable(disableOnConnect);  
  if (!getValue(OptionConstants.mountLocation).equals(""))  
   command.addComponentToEnable(mountButton);  

  // Piggy-back a Thread to start a StatReader if the call succeeds.  
  class PiggyBack extends Command  
   {  
    Configuration config = new Configuration("piggyBack");  
    OptionConstants fileLocation  = OptionConstants.fileLocation;  
    OptionConstants statsFilename = OptionConstants.statsFilename;  
    OptionConstants mountLocation = OptionConstants.mountLocation;  

    PiggyBack()  
     {  
      config.put(OptionConstants.fileLocation, getOption(fileLocation));  
      config.put(OptionConstants.statsFilename, getOption(statsFilename));  
     }  

  @Override  
  public void doPostRunWork()  
   {  
    if (retVal == 0)  
     {  
// TODO move this to the s3fronterSet or mounts or something.  Take advantage of PiggyBack's scope.  
      connected = true;  
      statReader = new StatReader(eventHandler, config);  
      if (getValue(mountLocation).equals(""))  
       {  
        OptionBox optBox = getOptionBox(mountLocation);  
        optBox.getOption().setRequired(true);  
        optBox.requestFocusInWindow();  
       }  

      // UGLY HACK... Send a 'ps aux' to grab the parent PID.  
      setNextLink(new PSCommand(getValue(fileLocation), null));  
      fireNextLink();  
     }  
   }  
 }  

PiggyBack piggyBack = new PiggyBack();  
piggyBack.setConsole(console);  
command.setNextLink(piggyBack);  
return new CommandThread[]{command};  
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-18T05:32:10.663

没关系。

1) 发展一种你自己的风格。无论你觉得最容易和最舒服的是什么，都去做。尽量保持一致性，但不要成为一致性的奴隶。拍摄约 90%。

2) 当您修改其他开发人员的代码，或处理小组项目时，请使用代码库中存在的或样式指南中规定的样式约定。不要抱怨它。如果您能够定义风格，请提出您的偏好，但愿意妥协。

如果你同时遵循这两个，你就会万事俱备。把它想象成以两种不同的方式说同一种语言。例如：在朋友面前说话的方式与在祖父面前说话的方式不同。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-18T05:34:02.860

编写漂亮的代码并不是一件小事。当我写了一些我真正引以为豪的东西时，我通常可以退后一步，查看整个方法或类，一眼就知道它做了什么——甚至几个月后。美学在其中起到了一定的作用，尽管没有好的设计那么大。另外，意识到你不能*总是*写漂亮的代码，（无类型的 ADO.NET 任何人？）但是当你可以的时候，请这样做。

不幸的是，至少在这个更高的级别上，我不确定您是否可以遵守任何硬性规则来始终生成美观的代码。我可以提供的一条建议是简单地**阅读代码**。很多。在许多不同的框架和语言中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-18T05:50:44.563

我喜欢用空格分解代码的逻辑“短语”。这有助于其他人轻松地可视化方法中的逻辑 - 或者在我返回查看旧代码时提醒我。例如，我更喜欢

```
reader.MoveToContent();
if( reader.Name != "Limit" )
    return false;

string type = reader.GetAttribute( "type" );
if( type == null )
    throw new SecureLicenseException( "E_MissingXmlAttribute" );

if( String.Compare( type, GetLimitName(), false ) != 0 )
    throw new SecureLicenseException( "E_LimitValueMismatch", type, "type" ); 
```

代替

```
reader.MoveToContent();
if( reader.Name != "Limit" )
    return false;
string type = reader.GetAttribute( "type" );
if( type == null )
    throw new SecureLicenseException( "E_MissingXmlAttribute" );
if( String.Compare( type, GetLimitName(), false ) != 0 )
    throw new SecureLicenseException( "E_LimitValueMismatch", type, "type" ); 
```

使用大括号几乎可以实现相同的中断，但我发现这实际上增加了视觉噪音并减少了可以同时在视觉上消耗的代码量。

**代码行上的评论**

至于行尾的评论 - 几乎从来没有。这还不错，只是在扫描代码时很容易错过。它们使代码变得混乱，使代码更难阅读。我们的大脑已经被连接到一行一行地摸索。当注释位于行尾时，我们必须将该行拆分为两个具体概念 - 代码和注释。我说如果它足够重要，可以评论，把它放在代码后面的那一行。

话虽如此，我确实发现关于特定值含义的一两行提示注释有时是可以的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-18T05:40:19.510

我发现很少有空格的代码很难阅读和导航，因为我需要实际阅读代码才能找到其中的逻辑结构。巧妙地使用空格来分隔函数中的逻辑部分可以增加理解代码的便利性，不仅对作者而且对其他人也是如此。

请记住，如果您在一个代码可能由他人维护的环境中工作，他们将花费大部分时间查看*不是*您编写的代码。如果您的风格与他们习惯看到的截然不同，那么*您流畅的代码可能会成为他们的减速带*。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T05:34:33.123

我尽量减少空白。我将主要注释块放在代码块上方，并将附加的行尾注释放在其他开发人员可能不明显的东西上。我想你已经这样做了

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T05:43:07.027

对于大多数开发人员来说，我喜欢的风格可能是厌恶的，但我会偶尔添加空行来分隔看起来合适的代码“段落”。它对我有用，在代码审查期间没有人抱怨（但是！），但我可以想象它对其他人来说可能是任意的。如果其他人不喜欢它，我可能会停止。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-18T13:49:25.580

要记住的最重要的事情是，当您加入现有代码库时（在您的职业生涯中几乎总是这样），您需要遵守项目规定的代码样式指南。

许多开发人员在重新开始一个项目时，会选择使用基于 Linux 内核编码样式文档的样式。该文档的最新版本可以在[http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/CodingStyle;h=8bb37237ebd25b19759cc47874c63155406ea28f查看;hb=头](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/CodingStyle;h=8bb37237ebd25b19759cc47874c63155406ea28f;hb=HEAD)。

同样，许多维护者坚持在向版本控制提交更改之前使用 Checkpatch。您可以在我在上面链接到的同一棵树的 scripts/checkpatch.pl 中看到 Linux 内核附带的最新版本（我会链接到它，但我是新手，每个答案只能发布一个超链接）。

虽然 Checkpatch 与您关于空格使用的问题没有特别相关，但它肯定会帮助您消除尾随空格、制表符前的空格等。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-18T13:53:33.590

我使用的空格数量与您完全相同：) 方法之前，注释块之前的空格。在 C、C++ 中，括号还提供了一些“伪空白”，因为在某些行上只有一个左大括号/右大括号，因此这也有助于打破代码密度。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-18T13:58:48.120

代码完成，史蒂夫·麦康奈尔（Steve McConnell）（在通常的位置有售）是我关于这类事情的圣经。它有一整章关于布局和风格的内容非常好。整本书充满了有用和实用的建议。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-07-02T20:02:56.327

你的代码很好，只要做你（和你可能与之合作的其他人）觉得舒服的事情。

我认为一些（没有经验的）程序员关于空格的唯一错误是他们可能害怕使用它，在这种情况下这是不正确的。

然而，我确实注意到您在示例代码中没有使用超过一个连续的空白行，在某些情况下，您应该使用它。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-07-02T21:08:15.837

以下是我将如何重构该方法。事情肯定还可以改进，我还没有重构 PiggyBack 类（我只是把它移到了上层）。

通过使用[组合方法模式](http://codebetter.com/blogs/jeremy.miller/archive/2006/12/03/Composed-Method-Pattern.aspx)，当代码被划分为每个做一件事并在单一抽象级别上工作的方法时，代码变得更易于阅读。也需要更少的评论。回答“什么”问题的注释[是代码气味](http://butunclebob.com/ArticleS.TimOttinger.ApologizeIncode)（即代码应该被重构以更具可读性）。有用的注释回答了“为什么”这个问题，即使这样，最好还是改进代码，这样原因就很明显了（有时可以通过一个没有不明显代码的测试来完成）。

```
public CommandThread[] buildCommandsForExecution() {
    CommandLine cLine = buildCommandLine();
    CommandThread command = buildCommandThread(cLine);
    initPiggyBack(command);
    return new CommandThread[]{command};
}

private CommandLine buildCommandLine() {
    CommandLine cLine = new CommandLine(getValue(OptionConstants.EXECUTABLE));
    // "--test" must be first, and bucket and file location must be last,
    // because [TODO: enter the reason]
    cLine.addOption(getOption(OptionConstants.TEST));
    for (Option regularOption : getRegularOptions()) {
        cLine.addOption(regularOption);
    }
    cLine.addOption(getOption(OptionConstants.BUCKET));
    cLine.addOption(getOption(OptionConstants.FILE_LOCATION));
    return cLine;
}

private List<Option> getRegularOptions() {
    List<Option> options = getAllOptions();
    options.removeAll(getNonRegularOptions());
    return options;
}

private List<Option> getAllOptions() {
    List<Option> options = new ArrayList<Option>();
    for (OptionBox optionBox : optionBoxes.values()) {
        options.add(optionBox.getOption());
    }
    return options;
}

private List<Option> getNonRegularOptions() {
    OptionConstants[] nonRegular = {
            OptionConstants.BUCKET,
            OptionConstants.FILE_LOCATION,
            OptionConstants.TEST,
            OptionConstants.EXECUTABLE,
            OptionConstants.MOUNT_LOCATION
    };
    List<Option> options = new ArrayList<Option>();
    for (OptionConstants c : nonRegular) {
        options.add(getOption(c));
    }
    return options;
}

private CommandThread buildCommandThread(CommandLine cLine) {
    GUIInteractiveCommand command = new GUIInteractiveCommand(cLine, console);
    command.addComponentsToEnable(enableOnConnect);
    command.addComponentsToDisable(disableOnConnect);
    if (isMountLocationSet()) {
        command.addComponentToEnable(mountButton);
    }
    return command;
}

private boolean isMountLocationSet() {
    String mountLocation = getValue(OptionConstants.MOUNT_LOCATION);
    return !mountLocation.equals("");
}

private void initPiggyBack(CommandThread command) {
    PiggyBack piggyBack = new PiggyBack();
    piggyBack.setConsole(console);
    command.setNextLink(piggyBack);
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-11-10T16:42:08.147

对于 C#，我说 "if" 只是一个词，而 "if(" 是代码 - "if"、"for"、"try" 等后面的空格根本不利于可读性，所以我认为它更好没有空间。

另外：Visual Studio> 工具> 选项> 文本编辑器> 所有语言> 选项卡> 保持选项卡！

如果你是一个坚持使用制表符所在的空格的软件开发人员，我会坚持认为你是个懒汉——但无论如何——最后，它都是编译好的。另一方面，如果你是一个 Web 开发人员，在你的 HTML/CSS/JavaScript 上都有一堆连续的空格和其他多余的空格，那么你要么对客户端代码一无所知，要么就是不给废话。客户端代码未编译（也未使用 IIS 默认设置压缩） - 客户端脚本中无意义的空格就像在服务器端代码中添加无意义的 Thread.Sleep() 调用。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-06-18T12:57:39.943

我喜欢最大化可以在窗口中看到的代码量，所以我只在函数之间使用一个空行，很少在函数内使用。希望你的函数不会太长。看你的例子，我不喜欢一个空括号的空行，但我会有一个结束。压痕和着色应该足以显示结构。

# vector - 当 inc=1 时，BLAS daxpy 和 dcopy 是否比仅使用 a(:,t) = b(:,t) 更快？

> ID：1010891
> 
> 赞同：1
> 
> 时间：2009-06-18T05:22:21.653
> 
> 标签：vector, copy, performance, fortran

好吧，标题已经说明了，我正在 Fortran 中进行以下操作：

```
a(:,t) = b(:,t)
c(:,t) = x(i,t)*d(:,t) 
```

在这种inc = 1的情况下，使用BLAS的子程序`daxpy`有什么好处吗？`dcopy`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T15:35:15.790

你永远不会注意到任何区别。

BLAS 必须与 Fortran 77 兼容，我很确定它没有那些花哨的功能。

那些子程序在那里制作数组或矩阵复制 1 行代码，因为它做了很多。循环往往会占用其他例程，例如矩阵求逆，因此复制通常不是性能问题。

如果您担心性能，只需以合理的方式对其进行编码。那我要做的就是[打断它几次](https://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024)。这将向您显示时间的实际去向。如果它在复制上花费了很多时间，它会告诉你。如果没有，它会告诉你。

# c# - 在我的情况下如何提高 SQL 查询性能

> ID：1010897
> 
> 赞同：1
> 
> 时间：2009-06-18T05:25:10.873
> 
> 标签：c#, sql-server, optimization

我有一个表，架构非常简单，一个 ID 列作为唯一主键（唯一标识符类型）和其他一些 nvarchar 列。我目前的目标是，对于 5000 个输入，我需要计算表中已经包含哪些，哪些没有。输入是字符串，我有一个将字符串转换为唯一标识符（GUID）的 C# 函数。我的逻辑是，如果存在现有 ID，则我将字符串视为已包含在表中。

我的问题是，如果我需要找出 5000 个输入字符串中哪些已经包含在 DB 中，哪些没有，那么最有效的方法是什么？

顺便说一句：我当前的实现是，使用 C# 代码将字符串转换为 GUID，然后调用/实现一个存储过程，该过程查询数据库中是否存在 ID 并返回到 C# 代码。

我的工作环境：VSTS 2008 + SQL Server 2008 + C# 3.5。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T05:31:23.207

我的第一直觉是将你的 5000 个输入泵入一个单列临时表 X，可能对其进行索引，然后使用：

```
SELECT X.thecol
FROM X
JOIN ExistingTable USING (thecol) 
```

获取存在的那些，并且（如果需要两套）

```
SELECT X.thecol
FROM X
LEFT JOIN ExistingTable USING (thecol)
WHERE ExistingTable.thecol IS NULL 
```

得到那些缺席的人。至少值得进行基准测试。

编辑：根据要求，这里有一些关于 SQL Server 中临时表的优秀文档和教程。 [Bill Graziano](http://www.sqlteam.com/article/temporary-tables)有一个简单的介绍，涵盖临时表、表变量和全局临时表。 [Randy Dyess](http://www.sql-server-performance.com/articles/per/temp_tables_necessary_p1.aspx)和[SQL Master](http://sqlserver-qa.net/blogs/perftune/archive/2008/01/17/3228.aspx)讨论了支持和反对他们的性能问题（但请记住，如果您遇到性能问题，您确实希望对替代方案进行基准测试，*而*不仅仅是进行理论考虑！-）。

MSDN 有关于[tempdb](http://msdn.microsoft.com/en-us/library/ms190768.aspx)（保存临时表的位置）和[优化](http://msdn.microsoft.com/en-us/library/ms175527.aspx)其性能的文章。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T06:03:50.267

第 1 步：确保您有问题需要解决。在很多情况下，一次插入 5000 个插入并不多。

您确定最简单的方法还不够吗？到目前为止，您测量了哪些性能问题？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T05:32:30.710

您需要对表中存在或不存在的那些条目做什么？

根据您的需要，也许`MERGE`SQL Server 2008 中的新语句可以满足您的需求 - 更新已经存在的内容，插入新内容，所有这些都整齐地包装到单个 SQL 语句中。一探究竟！

*   [http://blogs.conchango.com/davidportas/archive/2007/11/14/SQL-Server-2008-MERGE.aspx](http://blogs.conchango.com/davidportas/archive/2007/11/14/SQL-Server-2008-MERGE.aspx)
*   [http://www.sql-server-performance.com/articles/dba/SQL_Server_2008_MERGE_Statement_p1.aspx](http://www.sql-server-performance.com/articles/dba/SQL_Server_2008_MERGE_Statement_p1.aspx)
*   [http://blogs.msdn.com/brunoterkaly/archive/2008/11/12/sql-server-2008-merge-capability.aspx](http://blogs.msdn.com/brunoterkaly/archive/2008/11/12/sql-server-2008-merge-capability.aspx)

你的陈述看起来像这样：

```
MERGE INTO 
    (your target table) AS t
USING 
    (your source table, e.g. a temporary table) AS s
ON t.ID = s.ID
WHEN NOT MATCHED THEN  -- new rows does not exist in base table
  ....(do whatever you need to do)
WHEN MATCHED THEN      -- row exists in base table
  ... (do whatever else you need to do)
; 
```

为了使这非常快，我会使用 BULK INSERT 将“新”记录从例如 TXT 或 CSV 文件加载到 SQL 服务器中的临时表中：

```
BULK INSERT YourTemporaryTable
FROM 'c:\temp\yourimportfile.csv'
WITH 
(
    FIELDTERMINATOR =',',
    ROWTERMINATOR =' |\n'
) 
```

BULK INSERT 与 MERGE 相结合应该为您提供在这个星球上可以获得的最佳性能:-)

马克

PS：这是[TechNet](http://technet.microsoft.com/en-us/library/cc879317.aspx)上关于 MERGE 性能以及为什么它比单个语句更快的说明：

*在 SQL Server 2008 中，您可以使用 MERGE 语句在单个语句中执行多个数据操作语言 (DML) 操作。例如，您可能需要根据在另一个表中发现的差异，通过在一个表中插入、更新或删除行来同步两个表。通常，这是通过执行包含单独的 INSERT、UPDATE 和 DELETE 语句的存储过程或批处理来完成的。**但是，这意味着源表和目标表中的数据都会被多次评估和处理；每个语句至少一次。** 通过使用 MERGE 语句，您可以将单个 DML 语句替换为单个语句。这可以提高查询性能，因为操作是在单个语句中执行的，因此可以最大限度地减少源表和目标表中数据的处理次数。但是，性能提升取决于是否有正确的索引、连接和其他考虑因素。本主题提供最佳实践建议，以帮助您在使用 MERGE 语句时获得最佳性能。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T06:20:20.630

如果你想要简单，因为 5000 条记录不是很多，那么从 C# 中只需使用循环为要添加到表中的每个字符串生成插入语句。将插入包装在 TRY CATCH 块中。像这样一次性将它们全部发送到服务器：

```
BEGIN TRY
INSERT INTO table (theCol, field2, field3)
SELECT theGuid, value2, value3
END TRY BEGIN CATCH END CATCH

BEGIN TRY
INSERT INTO table (theCol, field2, field3)
SELECT theGuid, value2, value3
END TRY BEGIN CATCH END CATCH

BEGIN TRY
INSERT INTO table (theCol, field2, field3)
SELECT theGuid, value2, value3
END TRY BEGIN CATCH END CATCH 
```

如果您在字符串 GUID 上定义了唯一索引或主键，则重复插入将失败。提前检查记录是否不存在只会重复 SQL 无论如何都要执行的工作。

如果性能真的很重要，那么考虑将 5000 GUIDS 下载到本地站点并在本地进行所有分析。读取 5000 个 GUIDS 应该花费不到 1 秒的时间。这比批量导入临时表（这是从临时表获得性能的唯一方法）和使用临时表的连接进行更新更简单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-18T06:29:19.070

绝对不要一个接一个地做。

我首选的解决方案是创建一个存储过程，其中包含一个可以采用的参数和以下格式的 XML：

```
<ROOT>
  <MyObject ID="60EAD98F-8A6C-4C22-AF75-000000000000">
  <MyObject ID="60EAD98F-8A6C-4C22-AF75-000000000001">
  ....
</ROOT> 
```

然后在具有 NCHAR(MAX) 类型参数的过程中，将其转换为 XML，然后将其用作具有单列的表（我们称之为 @FilterTable）。存储过程如下所示：

```
CREATE PROCEDURE dbo.sp_MultipleParams(@FilterXML NVARCHAR(MAX))
AS BEGIN
    SET NOCOUNT ON

    DECLARE @x XML
    SELECT @x = CONVERT(XML, @FilterXML)

    -- temporary table (must have it, because cannot join on XML statement)
    DECLARE @FilterTable TABLE (
         "ID" UNIQUEIDENTIFIER
    )

    -- insert into temporary table
    -- @important: XML iS CaSe-SenSiTiv
    INSERT      @FilterTable
    SELECT      x.value('@ID', 'UNIQUEIDENTIFIER')
    FROM        @x.nodes('/ROOT/MyObject') AS R(x)

    SELECT      o.ID,
                SIGN(SUM(CASE WHEN t.ID IS NULL THEN 0 ELSE 1 END)) AS FoundInDB
    FROM        @FilterTable o
    LEFT JOIN   dbo.MyTable t
            ON  o.ID = t.ID
    GROUP BY    o.ID

END
GO 
```

您将其运行为：

```
EXEC sp_MultipleParams '<ROOT><MyObject ID="60EAD98F-8A6C-4C22-AF75-000000000000"/><MyObject ID="60EAD98F-8A6C-4C22-AF75-000000000002"/></ROOT>' 
```

你的结果看起来像：

```
ID                                   FoundInDB
------------------------------------ -----------
60EAD98F-8A6C-4C22-AF75-000000000000 1
60EAD98F-8A6C-4C22-AF75-000000000002 0 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T06:39:15.123

由于您使用的是 Sql server 2008，因此您可以使用表值参数。这是一种将表作为参数提供给存储过程的方法。

使用 ADO.NET，您可以轻松地预填充 DataTable 并将其作为 SqlParameter 传递。您需要执行的步骤：

创建自定义 Sql 类型

```
CREATE TYPE MyType AS TABLE
(
UniqueId INT NOT NULL,
Column NVARCHAR(255) NOT NULL
) 
```

创建一个接受类型的存储过程

```
CREATE PROCEDURE spInsertMyType
@Data MyType READONLY
AS 
xxxx 
```

使用 C# 调用

```
SqlCommand insertCommand = new SqlCommand(
   "spInsertMyType", connection);
 insertCommand.CommandType = CommandType.StoredProcedure;
 SqlParameter tvpParam = 
    insertCommand.Parameters.AddWithValue(
    "@Data", dataReader);
 tvpParam.SqlDbType = SqlDbType.Structured; 
```

链接：[Sql 2008 中的表值参数](http://msdn.microsoft.com/en-us/library/bb675163.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-18T05:28:37.063

尽量确保您最终只运行一个查询 - 即，如果您的解决方案包括对数据库运行 5000 个查询，那么这可能是该操作的最大资源消耗者。

如果您可以将 5000 个 ID 插入到临时表中，那么您可以编写一个查询来查找数据库中不存在的 ID。

# oracle - 如何在 Oracle 中查找当前打开的游标

> ID：1010898
> 
> 赞同：36
> 
> 时间：2009-06-18T05:25:22.247
> 
> 标签：oracle, oracle10g, database-cursor

查找 Oracle 实例中当前打开的游标数量的查询是什么？

另外，这些数据的准确性/更新频率是多少？

我正在使用 Oracle 10gR2

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-06-18T05:36:46.740

打开的游标总数，按会话：

```
select a.value, s.username, s.sid, s.serial#
from v$sesstat a, v$statname b, v$session s
where a.statistic# = b.statistic#  and s.sid=a.sid
and b.name = 'opened cursors current'; 
```

来源：[http ://www.orafaq.com/node/758](http://www.orafaq.com/node/758)

据我所知，对 v$ 视图的查询基于直接指向 SGA 相关部分的伪表（“x$”表），因此您无法获得比这更准确的信息；然而，这也意味着它是时间点（即脏读）。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2013-08-29T15:38:25.110

```
select  sql_text, count(*) as "OPEN CURSORS", user_name from v$open_cursor
group by sql_text, user_name order by count(*) desc; 
```

似乎对我有用。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-06-18T06:55:16.283

以下是如何查找已解析的打开游标。您需要以有权访问 v$open_cursor 和 v$session 的用户身份登录。

```
COLUMN USER_NAME FORMAT A15

SELECT s.machine, oc.user_name, oc.sql_text, count(1) 
FROM v$open_cursor oc, v$session s
WHERE oc.sid = s.sid
GROUP BY user_name, sql_text, machine
HAVING COUNT(1) > 2
ORDER BY count(1) DESC
; 
```

If 为您提供部分 SQL 文本，因此它可用于识别泄漏的应用程序。如果游标没有被解析，那么它就不会出现在这里。请注意，Oralce 有时会比您保持打开的时间更长。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-07-01T08:53:24.620

1）您的 id 应该具有 sys dba 访问权限 2）

```
select sum(a.value) total_cur, avg(a.value) avg_cur, max(a.value) max_cur, 
 s.username, s.machine
 from v$sesstat a, v$statname b, v$session s 
 where a.statistic# = b.statistic# and s.sid=a.sid
 and b.name = 'opened cursors current' 
 group by s.username, s.machine
 order by 1 desc; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-02-07T06:22:59.590

Oracle 有一个关于此问题的页面，其中包含 SQL 和故障排除建议。

“解决打开光标问题” [http://docs.oracle.com/cd/E40329_01/admin.1112/e27149/cursor.htm#OMADM5352](http://docs.oracle.com/cd/E40329_01/admin.1112/e27149/cursor.htm#OMADM5352)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-07-03T18:59:42.157

我使用这样的东西：

```
select 
  user_name, 
  count(*) as "OPEN CURSORS" 
from 
  v$open_cursor 
group by 
  user_name; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-11-30T10:01:44.570

我会使用这个快速 SQL 来比较当前的最高使用量与允许的最大值。这将允许您立即查看是否有任何进程对游标的使用率过高。

```
SELECT MAX (a.VALUE) AS highest_open_cur, p.VALUE AS max_open_cur
FROM v$sesstat a, v$statname b, v$parameter p
WHERE a.statistic# = b.statistic#
AND b.name = 'opened cursors current'
AND p.name = 'open_cursors'
GROUP BY p.VALUE; 
```

从上面的 SQL 中可能很清楚，OPEN_CURSORS 值是一个 Oracle 参数，可以像这样在运行时找到。

```
SELECT * FROM v$parameter WHERE NAME = 'open_cursors'; 
```

您可能需要 sysdba 或同等权限才能查询上述表。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-02-01T17:36:43.543

这可以工作：

```
SELECT    sql_text "SQL Query", 
          Count(*) AS "Open Cursors" 
FROM      v$open_cursor 
GROUP BY  sql_text 
HAVING    Count(*) > 2 
ORDER BY  Count(*) DESC; 
```

# c++ - C++：如何在不舍入、截断或填充的情况下将浮点数转换为字符串？

> ID：1010899
> 
> 赞同：6
> 
> 时间：2009-06-18T05:26:11.060
> 
> 标签：c++, floating-point

我面临一个问题，无法解决。需要大师的帮助。这是示例代码：-

```
float f=0.01f;
printf("%f",f); 
```

如果我们在调试期间检查变量中的值 f 包含 '0.0099999998' 值并且 printf 的输出为 0.010000。

一个。有什么方法可以强制编译器为浮点类型的变量分配相同的值？

湾。我想将浮点数转换为字符串/字符数组。怎么可能只有并且只有完全相同的值被转换为字符串/字符数组。我想确保没有填充零，没有填充不需要的值，没有数字变化，如上例所示。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T05:40:15.563

使用以 2 为底的值不可能准确地表示以 10 为底的十进制数，除了极少数值（例如 0.25）。为了得到你需要的东西，你必须从 float/double 内置类型切换到某种十进制数字包。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T09:05:03.313

你可以这样使用`boost::lexical_cast`：

```
float blah = 0.01;
string w = boost::lexical_cast<string>( blah ); 
```

该变量`w`将包含文本值 0.00999999978。但我看不出你什么时候真正需要它。

最好使用`boost::format`将浮点数准确格式化为字符串。以下代码显示了如何执行此操作：

```
float blah = 0.01;
string w = str( boost::format("%d") % blah ); // w contains exactly "0.01" now 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T05:30:15.673

看看这个 [C++ 参考](http://www.cplusplus.com/reference/clibrary/cstdio/printf/)。特别是关于精度的部分：

```
float blah = 0.01;
printf ("%.2f\n", blah); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-18T05:38:06.143

有无数个实数。

`float`数据类型、`double`和`long double`可以采用的值的数量是有限的。

也就是说，将有无数的实数无法使用这些数据类型精确表示。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-06T12:17:29.650

事实上，使用浮点处理器或协处理器或芯片本身的部分（现在大多数都集成到 CPU 中）永远不会产生准确的数学结果，但它们确实给出了相当粗略的准确度，为了更准确的结果，你可以考虑定义一个类“DecimalString”，它使用 nybbles 作为十进制字符和符号......并尝试使用字符串来模仿 base 10 数学......在这种情况下，取决于你想要制作字符串多长时间，你甚至可以完全取消指数部分，字符串 256 可以使用实际的 ASCII 以直接十进制表示 1x10^-254 到 1^+255，如果你想要一个符号则更短，但这可能会慢得多。您可以通过颠倒数字顺序来加快速度，因此从左到右读取单位，十，百，千......

**简单的例子** 例如。“0021”变为 1200 这需要左右“移动”以使小数点在例程之前对齐，最好的办法是从 ADD 和 SUB 函数开始，因为您将在 MUL 和DIV 函数。如果您在大型机器上，理论上您可以根据自己的意愿制作它们！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T06:12:28.350

Mark Ransom 的帖子很好地解释了调试器为您提供不同值的原因。

关于打印没有舍入、截断和更完整精度的浮点数，您缺少精度说明符 - printf 的默认精度通常为 6 个小数位。

尝试以下操作以获得 10 位的精度：

```
float amount = 0.0099999998;
printf("%.10f", amount); 
```

附带说明一下，使用 cout 做事的更 C++ 方式（与 C 风格相比）：

```
float amount = 0.0099999998;
cout.precision(10);
cout << amount << endl; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-06-06T11:58:14.197

同样，您可以使用 stdlib.h，其中有`sprintf`、`ecvt`和`fcvt`函数（或者至少应该有！）。

```
int sprintf(char* dst,const char* fmt,...);

char *ecvt(double value, int ndig, int *dec, int *sign);

char *fcvt(double value, int ndig, int *dec, int *sign); 
```

**sprintf**返回它写入字符串的字符数，例如

```
float f=12.00;
char buffer[32];
sprintf(buffer,"%4.2f",f) // will return 5, if it is an error it will return -1 
```

**ecvt**和**fcvt**将字符返回到包含数字的以 null 结尾的十进制表示形式的静态 char* 位置，没有小数点，最重要的数字在前，小数点的偏移量存储在 dec 中，符号在 "sign" (1=-,0 =+) ndig 是要存储的有效位数。如果 dec<0 那么你必须用 -dec 零填充到小数点。我不确定，而且你不是在 Windows7 系统上工作（有时不会运行旧的 DOS3 程序）寻找 Dos 3 的 TurboC 版本 2，仍有一两个下载可用，它是 Borland 的一个相对较小的程序，它是一个小型的 Dos C/C++ 编辑器/编译器，甚至带有 TASM，16 位机器代码 386/486 编译，它包含在帮助文件中，以及许多其他有用的信息块。

所有三个例程都在“stdlib.h”中，或者应该是，尽管我发现在 VisualStudio2010 上它们不是标准的，经常重载处理 WORD 大小字符的函数并要求您使用它自己的特定函数来代替...... “**标准**库就这么多，”我几乎每次都对自己喃喃自语，“也许他们出去找一本更好的字典！”

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-18T08:40:59.417

回答你的第二个问题：

可以准确无误地将浮点数表示为字符串。但是，这需要十六进制表示。例如，1/16 = 0.1，10/16 为 0.A。

使用十六进制浮点数，您可以定义规范表示。我个人会使用固定数量的数字来表示底层位数，但您也可以决定去除尾随零。没有可能混淆哪些尾随数字为零。

由于表示是精确的，因此转换是可逆的：`f==hexstring2float(float2hexstring(f))`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-18T10:05:38.323

对于（b），你可以做

```
std::ostringstream os;
os << f;
std::string s = os.str(); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-18T06:22:20.127

您需要查阅您的平台标准以确定如何最好地确定正确的格式，您需要将其显示为 a*b^C，其中“a”是包含符号的组成部分，“b”是实现定义的（可能由标准固定），“C”是用于该数字的指数。

或者，您可以仅以十六进制显示它，尽管它对人类没有任何意义，并且对于所有实际目的它仍然是二进制的。（而且同样便携！）

# asp.net-mvc - 如何在 ASP.NET MVC 中测试 ajax 提交？

> ID：1010900
> 
> 赞同：3
> 
> 时间：2009-06-18T05:27:33.727
> 
> 标签：asp.net-mvc, unit-testing

具体来说，如何传递静态方法 Request.IsAjaxRequest()？

当我尝试测试以下代码时，出现异常“System.ArgumentNullException”：

```
if (Request.IsAjaxRequest())
{
  return Json(data);
}
return View(data2); 
```

我正在使用起订量。谢谢你的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-18T09:25:15.707

您需要模拟 Request 和 Request.Headers 才能使用 Request.IsAjaxRequest()：

```
var request = new Mock<HttpRequestBase>();
request.SetupGet(x => x.Headers).Returns(new System.Net.WebHeaderCollection {
    {"X-Requested-With", "XMLHttpRequest"}
});

var context = new Mock<HttpContextBase>();
context.SetupGet(x => x.Request).Returns(request.Object);

var controller = new YourController();
controller.ControllerContext = new ControllerContext(context.Object, new RouteData(), controller); 
```

# c# - Microsoft 同步框架 - 双向同步如何工作？

> ID：1010902
> 
> 赞同：3
> 
> 时间：2009-06-18T05:29:07.983
> 
> 标签：c#, .net, sql-server, synchronization, .net-3.5

我有两个客户端 A 和 B。两个客户端都有相同的同步本地数据缓存。

如果客户端 A 对记录 X 进行离线编辑，然后客户端 B 也离线编辑记录 X 并与服务器同步，当客户端 A 与服务器同步时，客户端 B 所做的更改不会反映，并且没有多少双向同步会使两个客户端与服务器正确同步。

除此之外，我的同步应用程序非常适合删除、添加编辑等。只有同时离线编辑会破坏完整性。

我正在使用 SQL 2005（应用了用于同步支持的必要 SQL 脚本）

是否有任何资源可以解释同步框架的实际工作原理以及它如何决定何时同步条目？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T12:08:28.110

> 是否有任何资源可以解释同步框架的实际工作原理以及它如何决定何时同步条目？

你看过[同步框架规范](http://msdn.microsoft.com/en-us/library/bb902834.aspx)吗？[Steve Lasker 的博客](http://blogs.msdn.com/stevelasker/)也有一些关于 OCS 和同步框架的好技巧。他几乎是 OCS 和 SF 背后的主要推动力，尽管他现在搬到了 Cloud。

# java - 你有什么使用 nginx 和 memcached 优化网站的经验？

> ID：1010905
> 
> 赞同：4
> 
> 时间：2009-06-18T05:29:54.940
> 
> 标签：java, glassfish, memcached, nginx

我们有一个在[Glassfish](http://glassfish.java.net/)应用服务器集群上运行的基于 Java EE 的 Web 应用程序。传入的流量主要是对我们应用程序资源的基于 XML 的表示的 RESTful 请求，但可能有 5% 的流量可能是基于 JSON 或 XHTML/CSS 的表示。

我们现在正在研究负载平衡解决方案，以在集群中的 Glassfish 实例之间分配传入流量。我们还在研究如何使用 memcached 卸载集群，memcached 是一种内存分布式哈希映射，其键是 REST 资源名称（例如，“/user/bob”、“/group/jazzlovers”），其值为相应的 XML 表示。

一种听起来很有希望的方法是用一块石头杀死两只鸟，并使用轻量级、快速的[nginx](http://wiki.nginx.org//Main) HTTP 服务器/反向代理。Nginx 将通过首先在 memcached 中查找其 URI 来处理每个传入请求，以查看是否已经存在未过期的 XML 表示。如果没有，nginx 会将请求发送到 Glassfish 实例之一。[这篇简短](http://www.igvita.com/2008/02/11/nginx-and-memcached-a-400-boost)的文章中描述了 nginx memcached 模块。

你对 nginx 和 memcached 这样使用的总体印象如何，你对它们有多满意？您发现哪些资源对了解它们最有帮助？如果您尝试了它们并且它们不适合您的目的，为什么不呢？您改用了什么？

注意：这是一个[相关的问题](https://stackoverflow.com/questions/125957/nginx-setup-question/129855#129855)。

更新：我后来在 ServerFault.com 上问[了同样的问题。](https://serverfault.com/questions/34638/how-well-do-nginx-and-memcached-work-together)那里的答案主要是建议替代 nginx （有帮助，但间接）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-07-07T15:34:36.280

假设您有一组应用程序服务器向用户上游传递数据。

```
upstream webservices {
    server 10.0.0.1:80;
    server 10.0.0.2:80;
    server 10.0.0.3:80;
}
server {
    ... default nginx stuff ...
    location /dynamic_content {
          memcached_pass localhost:11211;
          default_type   text/html;
          error_page     404 502 = @dynamic_content_cache_miss;
          set $memcached_key $uri;
    }
    location @dynamic_content_cache_miss {
          proxy_pass http://webservices;
    } 
```

上面的 nginx.conf 片段所做的是将所有流量从[http://example.com/dynamic/](http://example.com/dynamic/) * 直接定向到 memcached 服务器。如果 memcache 有内容，您的上游服务器将看不到任何流量。

如果缓存命中失败并出现 404 或 502 错误（不在缓存中或无法访问内存缓存），则 nginx 会将请求传递给上游服务器。由于上游定义中有三台服务器，因此您还可以获得透明的负载平衡代理。

现在唯一需要注意的是，您必须确保后端应用程序服务器保持 memcache 中的数据新鲜。我使用 nginx + memcached + web.py 创建简单的小系统，在相对适中的硬件上每分钟处理数千个请求。

应用服务器的一般伪代码是这样的 web.py

```
class some_page:
     def GET(self):
         output = 'Do normal page generation stuff'
         web_url = web.url().encode('ASCII')
         cache.set(web_url, str(output), seconds_to_cache_content)
         return output 
```

在上面的 web.py / 伪代码中要记住的重要一点是，通过 nginx 来自 memcached 的内容根本无法更改。nginx 使用简单的字符串而不是 unicode。如果您将 unicode 输出存储在 memcached 中，您至少会在缓存内容的开头和结尾处获得奇怪的字符。

我将 nginx 和 memcached 用于与体育相关的网站，在那里我们获得了仅持续几个小时的巨大流量脉冲。如果没有 nginx 和 memcached，我就过不下去了。实施上述更改后，我们上一次 7 月 4 日大型体育赛事期间的服务器负载从 70% 下降到 0.6%。我不能推荐它。

# email - 如何使用 sendmail 限制出站电子邮件？

> ID：1010907
> 
> 赞同：0
> 
> 时间：2009-06-18T05:30:50.697
> 
> 标签：email, sendmail, spam

我知道，我知道，我应该切换到 Postfix。但与此同时，如何在 Sendmail 中限制出站电子邮件（尤其是发送到单个域的电子邮件）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-18T05:56:18.253

不知道如何在sendmail中做到这一点。

如果它是发送到您想要限制的单个域的邮件，并且您知道该域的 MX(s) 只有该域的 MX，我认为您可以对该域的 MX(s) IP(s) 和相关使用 iptables 速率限制端口，尽管我从未出于任何目的实际使用过 iptables 速率限制。

我看到的大多数 iptables 速率限制示例都是针对传入（INPUT 链）的，但我想它也适用于传出。

# python - Python的字节码优化了多少地方（2.5版）

> ID：1010914
> 
> 赞同：1
> 
> 时间：2009-06-18T05:33:29.663
> 
> 标签：python, bytecode

谁能告诉我在 Python 的字节码中有多少地方进行了优化？这几天一直在尝试反编译Python的字节码，但是发现在Python的2.5版本中有很多优化。例如：to this code

```
a,b,c=([],[],[])#build list 
```

version2.5之前的非优化字节码是这样的：

```
BUILD_LIST_0
BUILD_LIST_0
BUILD_LIST_0
BUILD_LIST_4
UNPACK_LIST_
STORE_NAME 'a'
STORE_NAME 'b'
STORE_NAME 'c' 
```

在2.5版本中，优化后的字节码是这样的：

```
BUILD_LIST_0
BUILD_LIST_0
BUILD_LIST_0
ROT_THREE
ROT_TWO
STORE_FAST 'a'
STORE_FAST 'b'
STORE_FAST 'c' 
```

这只是一个例子，但还有很多其他地方可以优化。那么，有没有人知道是否有一些文档来阐明这些优化或告诉我可以通过哪种方式找到所有这些优化？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T05:46:05.460

[Python/peephole.c](http://svn.python.org/projects/python/trunk/Python/peephole.c)源文件基本上是执行所有此类优化的地方——我提供的链接是当前版本（2.6 或更高版本），因为我无法在[此处](http://svn.python.org/view/python/?view=log)访问动态源浏览器，但一旦它再次工作很容易看到特定版本，例如（比如说）2.5.2 或任何其他您需要此信息的特定版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T05:41:59.710

我不认为有任何文档本身，但有 Python 解释器的 C 代码。你可以在[这里](http://python.org/download/releases/)找到它的几个不同版本。

# java - 在运行时将文件添加到 java 类路径

> ID：1010919
> 
> 赞同：74
> 
> 时间：2009-06-18T05:34:12.767
> 
> 标签：java, runtime, classpath

是否可以在运行时将文件（不一定是 jar 文件）添加到 java 类路径。具体来说，该文件已经存在于类路径中，我想要的是我是否可以将该文件的修改副本添加到类路径中。

谢谢，

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-06-18T06:46:01.337

您只能将文件夹或 jar 文件添加到类加载器。所以如果你有一个单独的类文件，你需要先把它放到合适的文件夹结构中。

[这](http://www.javafaq.nu/java-example-code-895.html)是一个在运行时添加到 SystemClassLoader 的相当丑陋的 hack：

```
import java.io.IOException;
import java.io.File;
import java.net.URLClassLoader;
import java.net.URL;
import java.lang.reflect.Method;

public class ClassPathHacker {

  private static final Class[] parameters = new Class[]{URL.class};

  public static void addFile(String s) throws IOException {
    File f = new File(s);
    addFile(f);
  }//end method

  public static void addFile(File f) throws IOException {
    addURL(f.toURL());
  }//end method

  public static void addURL(URL u) throws IOException {

    URLClassLoader sysloader = (URLClassLoader) ClassLoader.getSystemClassLoader();
    Class sysclass = URLClassLoader.class;

    try {
      Method method = sysclass.getDeclaredMethod("addURL", parameters);
      method.setAccessible(true);
      method.invoke(sysloader, new Object[]{u});
    } catch (Throwable t) {
      t.printStackTrace();
      throw new IOException("Error, could not add URL to system classloader");
    }//end try catch

   }//end method

}//end class 
```

反射是访问受保护方法所必需的`addURL`。如果有 SecurityManager，这可能会失败。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2012-02-27T06:37:48.047

试穿这件的尺码。

```
private static void addSoftwareLibrary(File file) throws Exception {
    Method method = URLClassLoader.class.getDeclaredMethod("addURL", new Class[]{URL.class});
    method.setAccessible(true);
    method.invoke(ClassLoader.getSystemClassLoader(), new Object[]{file.toURI().toURL()});
} 
```

这将编辑系统类加载器以包含给定的库 jar。这很丑陋，但它有效。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2013-05-15T12:07:10.273

我这样做的方法是使用我自己的类加载器

```
URLClassLoader urlClassLoader = (URLClassLoader) ClassLoader.getSystemClassLoader();
DynamicURLClassLoader dynalLoader = new DynamicURLClassLoader(urlClassLoader); 
```

并创建以下类：

```
public class DynamicURLClassLoader extends URLClassLoader {

    public DynamicURLClassLoader(URLClassLoader classLoader) {
        super(classLoader.getURLs());
    }

    @Override
    public void addURL(URL url) {
        super.addURL(url);
    }
} 
```

工作没有任何反射

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-06-18T06:08:14.020

您可以尝试 java.net.URLClassloader 与更新的类所在的文件夹/ja​​r 的 url，并在创建新线程时使用它而不是默认的类加载器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T05:50:36.250

是的，我相信这是可能的，但您可能必须实现自己的类加载器。我从来没有做过，但那是我可能会考虑的路径。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-06-18T05:41:39.133

是的你可以。如果您想将其隔离，则它需要位于其包结构中与其余已编译代码不同的目录中。然后，您只需将其基本目录放在命令行上类路径的前面。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2015-04-30T14:38:52.877

我的解决方案：

```
File jarToAdd = new File("/path/to/file");

new URLClassLoader(((URLClassLoader) ClassLoader.getSystemClassLoader()).getURLs()) {
    @Override
    public void addURL(URL url) {
         super.addURL(url);
    }
}.addURL(jarToAdd.toURI().toURL()); 
```

# c - 关于round_up宏的问题

> ID：1010922
> 
> 赞同：14
> 
> 时间：2009-06-18T05:35:48.520
> 
> 标签：c, macros

```
#define ROUND_UP(N, S) ((((N) + (S) - 1) / (S)) * (S)) 
```

使用上面的宏，有人可以帮助我理解“（s）-1”部分，这是为什么呢？

还有像这样的宏：

```
#define PAGE_ROUND_DOWN(x) (((ULONG_PTR)(x)) & (~(PAGE_SIZE-1)))
#define PAGE_ROUND_UP(x) ( (((ULONG_PTR)(x)) + PAGE_SIZE-1)  & (~(PAGE_SIZE-1)) ) 
```

我知道“（~（PAGE_SIZE-1）））”部分会将最后五位清零，但除此之外我一无所知，尤其是'&'运算符所扮演的角色。

谢谢，

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-06-18T06:03:46.697

该`ROUND_UP`宏依靠整数除法来完成工作。它仅在两个参数都是整数时才有效。我假设这`N`是要四舍五入的数字，也是应该四舍五入`S`的间隔。也就是说，`ROUND_UP(12, 5)`应该返回 15，因为 15 是 5 大于 12 的第一个区间。

想象一下我们是向下取整而不是向上取整。在这种情况下，宏将只是：

```
#define ROUND_DOWN(N,S) ((N / S) * S) 
```

`ROUND_DOWN(12,5)`将返回 10，因为`(12/5)`在整数除法中是 2，而 2*5 是 10。但我们不是在做 ROUND_DOWN，而是在做 ROUND_UP。因此，在进行整数除法之前，我们希望在不损失准确性的情况下尽可能多地相加。如果我们添加`S`，它几乎适用于所有情况；`ROUND_UP(11,5)`将变为 (((11+5) / 5) * 5)，并且由于整数除法中的 16/5 是 3，我们将得到 15。

当我们传递一个已经四舍五入到指定倍数的数字时，问题就来了。 `ROUND_UP(10, 5)`将返回 15，这是错误的。因此，我们不添加 S，而是添加 S-1。这保证了我们永远不会不必要地将某些东西推到下一个“桶”。

`PAGE_`宏与二进制数学有关。为简单起见，我们假设我们正在处理 8 位值。让我们假设`PAGE_SIZE`是`0b00100000`。 `PAGE_SIZE-1`是这样的`0b00011111`。 `~(PAGE_SIZE-1)`是那么`0b11100000`。

二进制`&`将排列两个二进制数并在两个数都有 1 的任何地方留下 1。因此，如果`x`是 0b01100111，则操作将如下所示：

```
 0b01100111  (x)
& 0b11100000  (~(PAGE_SIZE-1))
------------
  0b01100000 
```

您会注意到该操作实际上仅将最后 5 位清零。就这样。但这正是需要向下舍入到最接近的区间的操作`PAGE_SIZE`。请注意，这只有效，因为`PAGE_SIZE`它恰好是 2 的幂。这有点像说对于任何任意十进制数，您只需将最后两位数归零即可向下舍入到最接近的 100。它工作得很好，而且真的很容易做到，但如果你试图四舍五入到最接近的 76 倍数，它根本就不起作用。

`PAGE_ROUND_UP`做同样的事情，但它会在切断页面之前尽可能多地添加到页面中。*这有点像我如何通过将 99 添加到任何数字然后*将最后两位数归零来四舍五入到最接近的 100 倍数。（我们添加`PAGE_SIZE-1`的原因与`S-1`上面添加的相同。）

祝你的虚拟内存好运！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T05:44:00.567

使用整数算术，除法总是向下舍入。为了解决这个问题，如果原始数字是整除的，则添加不会影响结果的最大可能数字。对于数字 S，最大可能的数字是 S-1。

四舍五入到 2 的幂是特殊的，因为您可以通过位操作来实现。2 的倍数将在低位有一个零，4 的倍数将在低两位总是有零，依此类推。2 的幂的二进制表示是一个位，后跟一串零；减 1 将清除该位，并将所有位设置为右侧。反转该值会在需要清除的位置创建一个带有零的位掩码。& 运算符将清除值中的这些位，从而将值向下舍入。将 (PAGE_SIZE-1) 添加到原始值的相同技巧会导致它向上舍入而不是向下舍入。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T06:12:51.750

页舍入宏假定 `PAGE_SIZE 是 2 的幂，例如：

```
0x0400    -- 1 KiB
0x0800    -- 2 KiB`
0x1000    -- 4 KiB 
```

因此，的值`PAGE_SIZE - 1`全为一位：

```
0x03FF
0x07FF
0x0FFF 
```

因此，如果整数是 16 位（而不是 32 或 64 - 它节省了我一些输入），那么值为`~(PAGE_SIZE-1)`：

```
0xFC00
0xFE00
0xF000 
```

当您取`x`（假设，对于现实生活令人难以置信，但足以说明，这`ULONG_PTR`是一个无符号的 16 位整数）的值`0xBFAB`时，则

```
PAGE_SIZE         PAGE_ROUND_DN(0xBFAB)   PAGE_ROUND_UP(0xBFAB)

0x0400     -->    0xBC00                  0xC000
0x0800     -->    0xB800                  0xC000
0x1000     -->    0xB000                  0xC000 
```

宏向下和向上舍入到最接近的页面大小倍数。`PAGE_SIZE == 0x20`最后五位只有在（或 32）时才会被清零。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T06:47:56.110

但是，根据当前的草案标准 (C99)，此宏并不完全正确，但请注意，对于负值，`N`结果几乎肯定是不正确的。

公式：

```
#define ROUND_UP(N, S) ((((N) + (S) - 1) / (S)) * (S)) 
```

利用整数除法对非负整数向下取整的事实，并使用`S - 1`部分强制它向上取整。

但是，整数除法向零舍入（C99，第 6.5.5 节。乘法运算符，第 6 项）。对于负数`N`，“四舍五入”的正确方法是：' `N / S`'，仅此而已，仅此而已。

`S`如果也允许为负值，它会更加复杂，但我们甚至不要去那里......（请参阅：[如何确保整数的除法总是四舍五入？](https://stackoverflow.com/questions/921180/c-round-up)有关各种错误和一两个正确的解决方案）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T06:08:03.567

& 使它如此......好吧，让我们取一些二进制数。

```
（页面大小为 1000）
PAGE_ROUND_UP(01101b)=
01101b+1000b-1b & ~(1000b-1b) =
01101b+111b & ~(111b) =
01101b+111b & ...11000b = (... 表示 1 对于 ULONG 的大小继续)
10100b & 11000b=
10000b

```

所以，正如你所看到的（希望如此）这通过将 PAGE_SIZE 添加到 x 然后进行 ANDing 来进行四舍五入，因此它取消了未设置的 PAGE_SIZE 的底部位

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-10-14T17:49:52.103

这就是我使用的：

```
#define SIGN(x)            ((x)<0?-1:1)
#define ROUND(num, place)  ((int)(((float)(num) / (float)(place)) + (SIGN(num)*0.5)) * (place))

float A=456.456789
B=ROUND(A, 50.0f) // 450.0
C=ROUND(A, 0.001) // 456.457 
```

# regex - 有没有更短的方法可以将组从 Powershell 正则表达式中拉出来？

> ID：1010924
> 
> 赞同：18
> 
> 时间：2009-06-18T05:37:01.217
> 
> 标签：regex, powershell

在 PowerShell 中，我发现自己一遍又一遍地为比赛做这种事情：

```
some-command | select-string '^(//[^#]*)' |
     %{some-other-command $_.matches[0].groups[1].value} 
```

所以基本上 - 运行一个生成文本行的命令，对于每一行我想在该行内的正则表达式捕获上运行一个命令（如果它匹配）。看起来真的很简单。以上工作，但有没有更短的方法来拉出那些正则表达式捕获组？如果我没记错的话，Perl 有 1 美元等等。豪华必须有类似的东西，对吧？我在 SO 上看到了“$matches”引用，但不知道是什么原因造成的。

顺便说一句，我对 PowerShell 很陌生，刚开始学习。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-06-18T06:58:56.293

您可以使用`-match`运算符将​​您的命令重新表述为：

```
some-command | Foreach-Object { if($_ -match '^(//[^#]*)') { some-other-command $($matches[1])}} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-03-07T19:22:25.700

命名替换

```
'foo bar' -replace '(?<First>foo).+', '${First}' 
```

返回： foo

未命名替换

```
 'foo bar' -replace '(foo).+(ar)', '$2 z$2 $1' 
```

返回：ar zar foo

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-18T08:18:25.717

你可以试试这个：

```
Get-Content foo.txt | foreach { some-othercommand [regex]::match($_,'^(//[^#]*)').value } 
```

# java - 更快的替代方法来替换 Java 字符串中的方法？

> ID：1010928
> 
> 赞同：15
> 
> 时间：2009-06-18T05:38:02.587
> 
> 标签：java, replace

replace 方法返回一个字符串对象而不是替换给定字符串的内容这一事实有点迟钝（但当您知道字符串在 Java 中是不可变的时可以理解）。通过在某些代码中使用深度嵌套的替换，我的性能受到了重大影响。有什么我可以用它来代替它可以让它更快吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-06-18T05:41:47.947

这就是[StringBuilder](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/StringBuilder.html)的意义所在。如果您要进行大量操作，请在 a 上进行操作`StringBuilder`，然后`String`在需要时将其转换为 a 。

`StringBuilder`是这样描述的：

> “一个可变的字符序列。这个类提供了一个与 StringBuffer 兼容的 API，但不保证同步”。

它有`replace`(and `append`, `insert`, `delete`, et al)，你可以用`toString`它把它变成一个真实的`String`.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-06-18T06:46:00.293

前面的帖子是对的，StringBuilder/StringBuffer是一个解决方案。

但是，您还必须质疑对内存中的大字符串进行替换是否是个好主意。

我经常有作为流实现的字符串操作，因此我不是在字符串中替换它然后将其发送到 OutputStream，而是在我将字符串发送到输出流的那一刻进行替换。这比任何替换都快得多。

如果您希望此替换实现模板机制，这会更快。流式传输总是更快，因为您消耗的内存更少，如果客户端速度很慢，您只需要以较慢的速度生成 - 因此它可以更好地扩展。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-07-15T17:12:11.947

以下代码约为。如果没有匹配则快 30 倍，如果有匹配则快 5 倍。

```
static String fastReplace( String str, String target, String replacement ) {
    int targetLength = target.length();
    if( targetLength == 0 ) {
        return str;
    }
    int idx2 = str.indexOf( target );
    if( idx2 < 0 ) {
        return str;
    }
    StringBuilder buffer = new StringBuilder( targetLength > replacement.length() ? str.length() : str.length() * 2 );
    int idx1 = 0;
    do {
        buffer.append( str, idx1, idx2 );
        buffer.append( replacement );
        idx1 = idx2 + targetLength;
        idx2 = str.indexOf( target, idx1 );
    } while( idx2 > 0 );
    buffer.append( str, idx1, str.length() );
    return buffer.toString();
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-07-19T19:42:35.533

添加到@paxdiablo 答案，这是一个使用 StringBuffers 的 replaceAll 示例实现，它比 String.replaceAll() 快约 3.7 倍：

代码：

```
public static String replaceAll(final String str, final String searchChars, String replaceChars)
{
  if ("".equals(str) || "".equals(searchChars) || searchChars.equals(replaceChars))
  {
    return str;
  }
  if (replaceChars == null)
  {
    replaceChars = "";
  }
  final int strLength = str.length();
  final int searchCharsLength = searchChars.length();
  StringBuilder buf = new StringBuilder(str);
  boolean modified = false;
  for (int i = 0; i < strLength; i++)
  {
    int start = buf.indexOf(searchChars, i);

    if (start == -1)
    {
      if (i == 0)
      {
        return str;
      }
      return buf.toString();
    }
    buf = buf.replace(start, start + searchCharsLength, replaceChars);
    modified = true;

  }
  if (!modified)
  {
    return str;
  }
  else
  {
    return buf.toString();
  }
} 
```

测试用例——输出如下（Delta1 = 1917009502；Delta2 =7241000026）：

```
@Test
public void testReplaceAll() 
{
  String origStr = "1234567890-1234567890-";

  String replacement1 =  StringReplacer.replaceAll(origStr, "0", "a");
  String expectedRep1 = "123456789a-123456789a-";

  String replacement2 =  StringReplacer.replaceAll(origStr, "0", "ab");
  String expectedRep2 = "123456789ab-123456789ab-";

  String replacement3 =  StringReplacer.replaceAll(origStr, "0", "");
  String expectedRep3 = "123456789-123456789-";

  String replacement4 =  StringReplacer.replaceAll(origStr, "012", "a");
  String expectedRep4 = "1234567890-1234567890-";

  String replacement5 =  StringReplacer.replaceAll(origStr, "123", "ab");
  String expectedRep5 = "ab4567890-ab4567890-";

  String replacement6 =  StringReplacer.replaceAll(origStr, "123", "abc");
  String expectedRep6 = "abc4567890-abc4567890-";

  String replacement7 =  StringReplacer.replaceAll(origStr, "123", "abcdd");
  String expectedRep7 = "abcdd4567890-abcdd4567890-";

  String replacement8 =  StringReplacer.replaceAll(origStr, "123", "");
  String expectedRep8 = "4567890-4567890-";

  String replacement9 =  StringReplacer.replaceAll(origStr, "123", "");
  String expectedRep9 = "4567890-4567890-";

  assertEquals(replacement1, expectedRep1);
  assertEquals(replacement2, expectedRep2);
  assertEquals(replacement3, expectedRep3);
  assertEquals(replacement4, expectedRep4);
  assertEquals(replacement5, expectedRep5);
  assertEquals(replacement6, expectedRep6);
  assertEquals(replacement7, expectedRep7);
  assertEquals(replacement8, expectedRep8);
  assertEquals(replacement9, expectedRep9);

  long start1 = System.nanoTime();
  for (long i = 0; i < 10000000L; i++)
  {
    String rep =  StringReplacer.replaceAll(origStr, "123", "abcdd");
  }
  long delta1 = System.nanoTime() -start1;

  long start2= System.nanoTime();

  for (long i = 0; i < 10000000L; i++)
  {
    String rep =  origStr.replaceAll( "123", "abcdd");
  }

  long delta2 = System.nanoTime() -start1;

  assertTrue(delta1 < delta2);

  System.out.printf("Delta1 = %d; Delta2 =%d", delta1, delta2);

} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-06T21:03:49.023

如果您有许多要替换的字符串（例如 XML 转义序列），尤其是在替换的长度与模式不同的情况下，FSM 词法分析器类型算法似乎是最有效的，类似于以流方式处理的建议，其中输出是增量构建的。

也许可以使用 Matcher 对象来有效地做到这一点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-09-15T13:09:14.107

只需获取`char[]`of the`String`并遍历它。使用临时`StringBuilder`.

如果找不到模式，则在迭代时查找要替换的模式，将扫描的内容写入 . `StringBuilder`，否则将替换文本写入`StringBuilder`.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T05:41:07.560

一般来说，所有字符串操作都很慢。考虑使用 StringBuffer，它与 String 类不完全一样，但有很多共同点，而且它也是可变的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-19T14:52:19.853

当您替换单个字符时，请考虑迭代您的字符数组，但使用 (pre-created) 替换字符`HashMap<Character, Character>()`。

我使用这种策略将整数指数字符串转换为 unicode 上标字符。

它的速度大约是 的两倍`String.replace(char, char)`。请注意，与创建哈希映射相关的时间不包括在此比较中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-04-22T12:58:03.343

因为`String.replace(CharSequence target, CharSequence replacement)`有`Pattern.compile`, `matcher`,`replaceAll`在里面，可以通过使用预编译的目标模式常量来稍微优化它，像这样：

```
private static final Pattern COMMA_REGEX = Pattern.compile(",");
...
COMMA_REGEX.matcher(value).replaceAll(replacement); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-02-17T15:29:11.290

Apache commons 的东西，基于`StringBuilder`

`StringUtils.replace(String text, String searchString, String replacement)`

# html - CSS 框架——现成的还是自产的？

> ID：1010930
> 
> 赞同：3
> 
> 时间：2009-06-18T05:38:11.603
> 
> 标签：html, css, frameworks, frontend

是否有一个现有的框架可以满足您的项目需求，只需稍作修改，或者您是否在此过程中开发了自己的框架？对于试图通过以下优先事项做出决定的人，您有什么建议：

1.  CSS 重置
2.  注意排版；基线网格
3.  语义类
4.  可访问性
5.  许多“帮助”类：例如 .demphasized、.errormsg、.readmore 等。
6.  网格系统，除非它与#3 冲突

不是优先事项： - 流体/弹性布局支持 - 输入 ems/%s

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-18T05:41:30.100

没有任何框架可以做你想做的一切。

但[蓝图](http://code.google.com/p/blueprintcss/)应该足以让您入门。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T06:56:30.243

我已经设法在这些方面走得很远：

[960 网格布局](http://960.gs/)

[蓝图](http://blueprintcss.org/)

[jQuery UI CSS 框架](http://docs.jquery.com/UI/Theming/API#The_jQuery_UI_CSS_Framework)

[YAML](http://www.yaml.de/en/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-17T04:13:07.207

Elastic css 框架几乎可以完成您想要的所有工作，除了基线（还），但您可以将它集成到您​​的baseline.css，到elasticss.com。

没有神秘的类名，支持组合类，x 和 y 居中，高度相同，seo 友好（支持模板和自适应布局）

许多辅助类，并且绝对不会干扰您的类或绝对定位。全部免费且适用于所有浏览器:) 希望你喜欢它。

是的，它支持固定的、流动的、弹性的布局，你可以将它们组合起来以获得高级的东西，你还可以获得无限的嵌套，所以弹性不会让你在第一级之后失望

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-16T22:40:39.950

我向您推荐[Siimpler](http://siimpler.com/ "更简单的 HTML 框架")，它是一个简单的 html 框架，具有现成的文件/文件夹结构，但您可以根据需要对其进行配置。对于经验。您可以在 CSS 重置和 Normalize.css 之间进行选择。

# c# - 从视频文件中提取wav文件

> ID：1010937
> 
> 赞同：6
> 
> 时间：2009-06-18T05:41:06.390
> 
> 标签：c#, winforms, video, audio

我正在开发一个需要从视频中提取音频的应用程序。音频需要以 .wav 格式提取，但视频格式没有问题。只要我可以将音频提取到 wav 文件中，任何格式都可以。

目前我正在使用 Windows 窗体中的 Windows Media Player COM 控件来播放视频，但任何其他嵌入式播放器也可以。

关于如何做到这一点的任何建议？谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2018-03-30T13:45:21.780

如果您想使用 C# 执行此操作，请查看[NAudio library](https://github.com/naudio/NAudio)。它可以分析音频格式（如 FFMpeg）并提供音频流。这是[一个例子](https://github.com/tompaana/hls-transcription-sample)。

样本片段：

```
using NAudio.Wave;
using System.IO;

...

// contentAsByteArray consists of video bytes
MemoryStream contentAsMemoryStream = new MemoryStream(contentAsByteArray);

using (WaveStream pcmStream =
    WaveFormatConversionStream.CreatePcmStream(
        new StreamMediaFoundationReader(contentAsMemoryStream)))
{
    WaveStream blockAlignReductionStream = new BlockAlignReductionStream(pcmStream);

    // Do something with the wave stream
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T06:29:20.927

[这是一个关于如何使用 GraphEdit 提取音频的链接，GraphEdit 是](http://www.videohelp.com/forum/archive/how-to-extract-to-wav-from-avi-using-graphedit-t239907.html)[DirectShow API](http://msdn.microsoft.com/en-us/library/ms783323.aspx)的前端 UI，因此它可以做的所有事情都可以用 API 做。
您可以使用[DirectShow.NET](http://directshownet.sourceforge.net/)自由，它为托管世界包装了 DirectShow API。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T06:07:46.237

可能最容易将 ffmpeg 用于这种事情......

# bash - `ls` 退出状态

> ID：1010939
> 
> 赞同：4
> 
> 时间：2009-06-18T05:41:15.640
> 
> 标签：bash, ls, gnu-fileutils

编辑：这里没什么可看的！！！127 return 表示找不到命令 - 由于某种原因必须给出命令的绝对路径：/（我没有删除，以防其他人有这个问题）

是否有常见 Linux 函数的返回状态参考，例如`ls`？（它似乎不在手册页中，至少对于`ls`）。如果没有，有人能告诉我`ls`返回 127 是什么意思吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-22T17:37:13.913

127 是找不到命令的错误。在这种情况下，我只需要使用命令的绝对路径 ( `/bin/ls`)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T05:52:40.287

根据[http://www.opengroup.org/onlinepubs/009695399/utilities/ls.html](http://www.opengroup.org/onlinepubs/009695399/utilities/ls.html)返回值 0 表示成功，任何 >0 都是错误

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T05:48:24.707

`ls`不是 Bash 函数。它是一个外部实用程序。在 Linux 上，`ls`是 GNU File Utilities 的一部分。`man ls`应该向您显示与[http://www.gnu.org/software/coreutils/manual/html_node/ls-invocation.html](http://www.gnu.org/software/coreutils/manual/html_node/ls-invocation.html)类似的信息，其中退出状态的唯一可能值定义为 0、1 和 2。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T05:50:33.627

for ls: "退出状态为 0 正常，1 小问题，2 大问题。"

来源：[UNIX 手册页：ls](http://unixhelp.ed.ac.uk/CGI/man-cgi?ls)

我怀疑您发现这一点的选择通常是：

1.  男人
2.  谷歌
3.  源代码分析

# php - HTML 输入数组

> ID：1010941
> 
> 赞同：54
> 
> 时间：2009-06-18T05:41:19.150
> 
> 标签：php, html, arrays, forms

```
<input name="foo[]" ... > 
```

我以前用过这些，但我想知道它叫什么，是否有规范？

[我在HTML 4.01 规范](http://www.w3.org/TR/html401/interact/forms.html)中找不到它，导致各种 Google 结果只称它为“数组”以及许多处理表单数据的 PHP 示例。

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2009-06-18T05:47:41.370

它只是 PHP，而不是 HTML。

它将所有带有 [] 的 HTML 字段解析为一个数组。

所以你可以拥有

```
<input type="checkbox" name="food[]" value="apple" />
<input type="checkbox" name="food[]" value="pear" /> 
```

提交后，PHP 将使 $_POST['food'] 成为一个数组，您可以像这样访问它的元素：

```
echo $_POST['food'][0]; // would output first checkbox selected 
```

或查看所有选择的值：

```
foreach( $_POST['food'] as $value ) {
    print $value;
} 
```

无论如何，不​​要认为它有一个特定的名称

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-06-18T05:43:04.733

据我所知，HTML 规范中没有任何内容，因为浏览器不应该为这些字段做任何不同的事情。他们只是像往常一样发送它们，PHP 和其他语言一样将它们解析为数组。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-03-22T13:37:03.210

[PHP.net 上此页面](http://www.php.net/manual/en/faq.html.php#faq.html.arrays)的评论中有一些参考和指针：

托斯滕 说

> “XHTML 规范的兼容性指南的第 C.8 节适用于将 name 属性用作片段标识符。如果您检查 DTD，您会发现 'name' 属性仍然定义为表单元素的 CDATA。”

喷气男孩 说

> “据此：[http](http://www.w3.org/TR/xhtml1/#C_8) ://www.w3.org/TR/xhtml1/#C_8名称属性的类型在 XHTML 1.0 中已更改，这意味着 XHTML 名称属性中的方括号无效。
> 
> 无论如何，在撰写本文时，W3C 的验证器并没有在 XHTML 文档中检测到这一点。”

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-03-30T08:31:02.590

跟着它...

```
<form action="index.php" method="POST">
<input type="number" name="array[]" value="1">
<input type="number" name="array[]" value="2">
<input type="number" name="array[]" value="3"> <!--taking array input by input name array[]-->
<input type="number" name="array[]" value="4">
<input type="submit" name="submit">
</form>
<?php
$a=$_POST['array'];
echo "Input :" .$a[3];  // Displaying Selected array Value
foreach ($a as $v) {
    print_r($v); //print all array element.
}
?> 
```

# c# - EF Distinct (IEqualityComparer) 错误

> ID：1010944
> 
> 赞同：14
> 
> 时间：2009-06-18T05:41:40.257
> 
> 标签：c#, .net, entity-framework, c#-3.0, linq-to-entities

早上好！

鉴于：

```
public class FooClass
{
    public void FooMethod()
    {
        using (var myEntity = new MyEntity)
        {
            var result = myEntity.MyDomainEntity.Where(myDomainEntity => myDomainEntity.MySpecialID > default(int)).Distinct(new FooComparer);
        }
    }

}

public class FooComparer : IEqualityComparer<MyEntity.MyDomainEntity>
{
    public bool Equals(MyEntity.MyDomainEntity x, MyEntity.MyDomainEntity y)
    {
        return x.MySpecialID == y.MySpecialID;
    }

    public int GetHashCode(MyEntity.MyDomainEntity obj)
    {
        return obj.MySpecialID.GetHashCode();
    }
} 
```

这将编译，但在运行时我会得到一个`Linq to Entity could not translate Comparer`-Exception。
有什么建议么？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-06-18T05:59:46.263

如果您提供自己的比较，则需要`Distinct`在 .NET 代码中执行调用。为确保发生这种情况，请使用`AsEnumerable`to`IQueryable<T>`变成`IEnumerable<T>`：

```
var result = myEntity.MyDomainEntity
        .Where(myDomainEntity => myDomainEntity.MySpecialID > default(int))
        .AsEnumerable()
        .Distinct(new FooComparer()); 
```

当然，此时您将从数据库中提取更多数据。另一种方法是对数据进行分组：

```
var result = from entity in myEntity.MyDomainEntity
             where entity.MySpecialID > 0
             group entity by entity.MySpecialID into groups
             select groups.FirstOrDefault(); 
```

这将使您成为每个 ID 遇到的第一个实体（假设我的 query-fu 没有让我失望）。无论如何，这基本上就是 Distinct 所做的，但这一切都在数据库中。

（未来读者请注意：调用`First()`比 更有意义`FirstOrDefault()`，但显然这不起作用。）

# coding-style - 你在哪里添加新方法？

> ID：1010959
> 
> 赞同：1
> 
> 时间：2009-06-18T05:45:32.887
> 
> 标签：coding-style

当你向一个类添加一个新方法时，你把它放在哪里？在课程结束时......顶部？您是否将方法组织成特定的组？按字母顺序排序？

只是寻找保持类方法井井有条的一般做法。

**更新**分组时，您在组中的何处添加新方法？只是在最后还是你使用某种子分组，排序？

**更新 2**嗯……我猜这个问题并不像我想象的那么清楚。我不是真的在寻找班级组织。我对向现有类添加新方法特别感兴趣。例如：

```
public class Attendant
{
    public void GetDrinks(){}
    public void WelcomeGuests(){}
    public void PickUpTrask(){}
    public void StrapIn(){}
} 
```

现在我们要添加一个新方法`PrepareForCrash()`。它去哪儿了？在列表的顶部、底部、按字母顺序排列或靠近`StrapIn()`方法，因为它是相关的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T05:50:12.770

靠近“StrapIn”，因为它是相关的。这样，如果您稍后重构，所有相关代码都在附近。

大多数代码编辑器允许您在另一个窗格中按字母顺序浏览方法名称，因此在实际代码本身中按功能组织代码是有意义的。将功能方法组合在一起，使在类中导航时更轻松。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T06:18:56.157

看在上帝的份上，不是按字母顺序！

我倾向于按照我希望在对象生命周期内调用它们的顺序对函数进行分组，以便从上到下读取头文件往往可以解释类的操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T05:59:10.510

我认为这是个人选择。但是我喜欢这样组织我的课程。

```
public class classname  
{
    <member variables>

    <constructors>
    <destructor>

    <public methods>

    <protected methods>

    <private methods>
} 
```

原因是这样的。

**顶部的**
成员变量查看存在哪些成员变量以及它们是否已初始化。

**构造函数** 查看成员变量是否已设置/初始化以及类的所有构造选项。

**析构**
函数查看类是如何被清理的，并用构造函数和成员变量来验证它。

**公共方法**
查看对象的调用者可以使用哪些可用的协定。

**受保护的方法** 查看将使用哪些继承类。

**私有方法** 因为它是关于类内部的信息，如果您需要了解内部，您可以直接快速滚动到最后。但是要知道类的接口，一切都在开始。

**更新 - 基于 OP 的更新**
从逻辑上讲，一个好方法是按它们所做的类别来组织方法。这样，您就可以从 IDE 中获得对方法进行分类以及按字母顺序搜索的可读性（前提是在您的 IDE 中）。

但是在实际意义上，我认为将方法放在该部分的末尾是最好的方法。如果代码由多人共享，则很难持续监控每种方法的去向，因为它是主观的，因为它是主观的。

如果您要将此作为标准，则很难为每种方法的放置位置提供界限。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T05:50:56.950

我喜欢 C# 和 VB.net 的地方在于能够使用#region 标签，所以我的类通常看起来像这样

```
class MyClass
{

#region Constructors

public MyClass()
{
}

public MyClass(int x)
{
_x = x;
}

#endregion

#region Members
private int _x;
#endregion

#region methods
public void DoSomething()
{
}
#endregion

#region Properties
public int Y {get; private set;}
#endregion

} 
```

所以基本上你把相似的东西放在一起，这样你就可以把所有东西都折叠起来，然后更快地找到你的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T05:51:32.440

一般取决于现有的分组；如果有一个新方法适合的现有分组，我会把它放在那里。例如，如果有一组运算符，如果它是运算符，我会将新方法与运算符放在一起。

当然，如果没有好的分组，添加一个方法可能会提示一个新的分组；我将其视为重构的机会，并尝试在合理的情况下重新组合现有的运算符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T05:51:53.830

我将所有方法组织成区域，如公共方法、私有方法或有时通过保存方法等功能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T06:17:48.670

恕我直言：如果您按字母顺序组织方法，则根据其名称放置一个新方法。否则放在相关组的底部。这有助于了解哪种方法较新。更大的问题是如何在组中组织方法，例如取决于哪些属性，但这对每个人来说都更加个性化，并且取决于特定的类。

# python - 分割字符串的方法？

> ID：1010961
> 
> 赞同：12
> 
> 时间：2009-06-18T05:45:47.473
> 
> 标签：python

我有一个字符串，例如：

```
s = "this is a string, a" 
```

其中`','`（逗号）始终是倒数第三个字符，也就是`s[-3]`.

我正在考虑删除“，”的方法，但只能考虑将字符串转换为列表，将其删除，然后将其转换回字符串。然而，这对于简单的任务来说似乎有点太多了。

我怎样才能以更简单的方式做到这一点？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-06-18T05:48:55.813

通常，您只需执行以下操作：

```
s = s[:-3] + s[-2:] 
```

为`s[:-3]`您提供一个字符串，但不包括您要删除的逗号 ( `"this is a string"`)，并`s[-2:]`为您提供另一个字符串，该字符串以该逗号 ( ) 之外的一个字符开头`" a"`。

然后，将两个字符串连接在一起可以得到你所追求的 ( `"this is a string a"`)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-18T09:13:15.420

使用“删除最后一个逗号”而不是“删除倒数第三个字符”的几个变体是：

```
s[::-1].replace(",","",1)[::-1] 
```

或者

```
''.join(s.rsplit(",", 1)) 
```

但这些都非常难看。稍微好一点的是：

```
a, _, b = s.rpartition(",")
s = a + b 
```

如果您不知道逗号的位置（字符串中的最后一个逗号除外）并且实际上需要“从右侧替换”，这可能是最好的方法。然而，对于“删除倒数第三个字符”，[Anurag 的回答更像是 Pythonic。](https://stackoverflow.com/questions/1010961/string-slicing-python/1010973#1010973)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-18T05:52:41.830

Python 字符串是不可变的。这意味着您**必须**创建至少 1 个新字符串才能删除逗号，而不是使用 C 等语言就地编辑字符串。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-18T08:08:53.240

要删除文本中的每个“，”字符，您可以尝试

```
s = s.split(',')
>> ["this is a string", " a"]
s = "".join(s)
>> "this is a string a" 
```

或者在一行中：

```
s0 = "".join(s.split(',')) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-08-20T02:13:40.400

最好的简单方法是：您可以使用替换功能：-

```
>>> s = 'this is a string, a'
>>> s = s.replace(',','')
>>> s
'this is a string a' 
```

在这里， ***replace()***函数搜索字符 ',' 并将其替换为 '' 即空字符

请注意，replace() 函数默认所有 ',' 但如果你只想替换一些 ',' 在某些情况下你可以使用：***s.replace(',' , '', 1)***

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-07-31T16:03:20.857

要将任意长度的字符串切成多个等长任意长度的切片，您可以这样做

```
def slicer(string, slice_length):
    return [string[i:i + slice_length]
            for i in xrange(0, len(string), slice_length)] 
```

如果 slice_length 不完全划分为 len(string) ，则列表末尾将有一个切片来保存余数。

# wpf - 如何让菜单在 WPF 中打开到左侧？

> ID：1010962
> 
> 赞同：3
> 
> 时间：2009-06-18T05:45:54.760
> 
> 标签：wpf, menu, menuitem

我在 WPF 中有一个菜单（带有 menuitems）。不幸的是，当我单击菜单标题时，它会打开右侧的菜单。问题是右边有一些我不希望它重叠的东西。如何告诉 WPF 打开左侧的菜单？我需要做一个控制模板吗？（对于这种基本的样式更改，控件模板似乎过于笨拙）。

谢谢！

KSG

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-06-18T07:43:04.353

虽然您可以像他们在[此处](http://www.codeproject.com/KB/WPF/SearchMenuTextBox.aspx)一样创建一个 ControlTemplate 来执行此操作，但我同意仅修改菜单项的一部分上的一个值是一种麻烦的方法。相反，我认为这是使用 AttachedProperty 的好地方。我们可以创建类似于[ContextMenuService](http://msdn.microsoft.com/en-us/library/system.windows.controls.contextmenuservice.aspx)的东西，但是对于 Popups（事实上，我有点惊讶它不是内置的）。

要更改弹出窗口的打开位置，我们需要设置弹出窗口的 PlacementMode。我们可以使用 propa 快捷方式来生成我们的[AttachedProperty](http://msdn.microsoft.com/en-us/library/ms749011.aspx)（或者如果你想实现其余的属性）。我们需要向 PropertyMetadata 添加回调，但如果在 XAML 中的控件上内联设置了 AttachedProperty，则回调将在整个控件完全构造之前触发。为了确保应用了 MenuItem 的模板，并且在我们尝试设置它的值之前 Popup 存在，如果它尚未加载，我们可以附加到 Loaded 事件。加载后，我们想从模板中检索 Popup，如果我们查看[MenuItem 类](http://msdn.microsoft.com/en-us/library/system.windows.controls.menuitem(VS.85).aspx)我们可以看到它有一个 TemplatePartAttribute 将 Popup 的名称定义为“PART_Popup”。一旦我们有了它，我们就可以在 MenuItem 的 Popup 上设置 PlacementMode。

```
 public static PlacementMode GetMenuPlacement(DependencyObject obj)
    {
        return (PlacementMode)obj.GetValue(MenuPlacementProperty);
    }

    public static void SetMenuPlacement(DependencyObject obj, PlacementMode value)
    {
        obj.SetValue(MenuPlacementProperty, value);
    }

    // Using a DependencyProperty as the backing store for MenuPlacement.  This enables animation, styling, binding, etc...
    public static readonly DependencyProperty MenuPlacementProperty =
        DependencyProperty.RegisterAttached("MenuPlacement",
        typeof(PlacementMode),
        typeof(Window1),
        new FrameworkPropertyMetadata(PlacementMode.Bottom, FrameworkPropertyMetadataOptions.Inherits, new PropertyChangedCallback(OnMenuPlacementChanged)));

    private static void OnMenuPlacementChanged(DependencyObject o, DependencyPropertyChangedEventArgs e)
    {
        var menuItem = o as MenuItem;
        if (menuItem != null)
        {
            if (menuItem.IsLoaded)
            {
                SetPopupPlacement(menuItem, (PlacementMode)e.NewValue);
            }
            else
            {
                menuItem.Loaded += new RoutedEventHandler((m, v) => SetPopupPlacement(menuItem, (PlacementMode)e.NewValue));
            }
        }
    }

    private static void SetPopupPlacement(MenuItem menuItem, PlacementMode placementMode)
    {
        Popup popup = menuItem.Template.FindName("PART_Popup", menuItem) as Popup;
        if (popup != null)
        {
            popup.Placement = placementMode;
        }
    } 
```

现在我们有了 AttachedProperty，很容易在 UI 中更改 Popup 的位置。

```
<Menu>
    <MenuItem Header="Item 1"
              local:Window1.MenuPlacement="Right">
        <MenuItem Header="SubItem 1" />
        <MenuItem Header="SubItem 2" />
        <MenuItem Header="SubItem 3" />
        <MenuItem Header="SubItem 4" />
    </MenuItem>
    <MenuItem Header="Item 2"
              local:Window1.MenuPlacement="Left">
        <MenuItem Header="SubItem 5" />
        <MenuItem Header="SubItem 6" />
        <MenuItem Header="SubItem 7" />
        <MenuItem Header="SubItem 8" />
    </MenuItem>
    <MenuItem Header="Item 3"
              local:Window1.MenuPlacement="Mouse">
        <MenuItem Header="SubItem 9" />
        <MenuItem Header="SubItem 10" />
        <MenuItem Header="SubItem 11" />
        <MenuItem Header="SubItem 12" />
    </MenuItem>
</Menu> 
```

# django - 在 django-south 的 startmigration 中使用新的“--freeze”选项的正确方法是什么？

> ID：1010965
> 
> 赞同：2
> 
> 时间：2009-06-18T05:46:32.637
> 
> 标签：django, migration

我尝试了以下方法，但这似乎只创建了一个空的迁移文件：

```
startmigration appname freeze_appname --freeze appname 
```

我也试过了：

```
startmigration --freeze appname 
```

也不行。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-18T23:47:24.870

好的，因为我周围没有 SOUTH 用户，所以我必须弄清楚如何做到这一点。

我做错的是首先创建数据迁移而不冻结应用程序

我这样做了：

```
startmigration appname migrate_data 
```

这创建了空白迁移文件，然后我将数据迁移功能放入其中。但我没有冻结我想在迁移中使用/访问的应用程序

正确的做法是：

```
startmigration appname migrate_data --freeze apptouseinmigration 
```

# c - GCC警告“案例标签值超过类型的最大值”是什么意思？

> ID：1010966
> 
> 赞同：7
> 
> 时间：2009-06-18T05:46:39.390
> 
> 标签：c, gcc, warnings, switch-statement

我的代码如下所示：

```
char * decode_input(char ch)
{
        switch(ch) {
                case 'g':
                        return "get";
                        break;
                case KEY_F(9):
                        return "quit";
                        break;
                default:
                        return "unknown";
                        break;
        }
} 
```

有什么线索吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-18T05:54:37.320

那么，KEY_F(9) 将是 273（参见 curses.h），它超出了 char 的范围（-128,127）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-18T05:53:37.710

char 是介于 -128 和 127 之间的数字。KEY_F(9) 可能是该范围之外的值。

采用：

*   无符号字符，或
*   整数，或
*   (字符) KEY_F(9)

或者更好的是，使用调试器并确定 sizeof(KEY_F(9)) 以确保它是一个字节而不是一个短字节。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-18T05:53:37.243

在这种情况下，`KEY_F(9)`正在评估的范围之外的东西`char`。该`switch`语句假设因为它的参数是 a `char`，所以所有 case 标签也将是。改变`switch`阅读`switch((unsigned int)ch)`将治愈它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T05:53:33.607

看起来 KEY_F(9) 必须评估为超出字符范围的内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T06:05:00.157

其他人对 char 范围的看法。

我记得我早期编写 C 时的情况……您可能是从循环中调用 decode_input ，对吗？如果用户按下 F9 之类的键，您将在键盘缓冲区中获得两个字节 - 第一个字节将是 0x0。

# c++ - 参见“某些符号”的先前定义

> ID：1010968
> 
> 赞同：1
> 
> 时间：2009-06-18T05:46:54.727
> 
> 标签：c++, visual-studio

在使用 C++ 编程时，大多数时候我得到的“某些符号”已经被定义，请参阅先前的“某些符号”定义

我认为这是因为包含的头文件顺序不正确。

我怎样才能找出“某个符号”的所有定义

提前致谢， 乌代

编辑：

我正在使用 Visual Studio 我记得一些命令，例如 dumpbin /exports （我不记得确切）来获取所有定义

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-18T05:53:11.923

这通常是由于几个常见问题造成的：

*   您正在重新定义相同的符号
*   您多次包含一个头文件，但它没有包含保护
*   您错误地向前声明了不兼容的类型，然后包括

我会开始尝试修复第二个。确保所有标题都包含保护，这样如果您从不同的地方包含它们，它就不会尝试重新定义符号：

```
#ifndef HEADER_FILE_NAME_GUARD // or something alike
#define HEADER_FILE_NAME_GUARD
// rest of file
#endif 
```

如果您需要订购您的包含，那么您稍后会遇到麻烦，请确保您可以并且确实在所有地方包含所有依赖项。（或者如果可以的话，转发声明）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-18T05:48:14.850

全文搜索是最跨平台的跨环境和最有效的技术。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-18T05:50:48.480

如果您使用安装了[Visual Assist](http://www.wholetomato.com/)的 Visual Studio ，则 alt-G 将弹出一个列表，其中列出了所有定义了某些内容的位置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-18T07:10:41.640

如果您使用安装了 Visual Assist 的 Visual Studio，则最好按 Alt+X 然后按 D 查看对符号的所有引用

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-18T08:32:55.110

将 C++ 翻译成可执行文件有两个步骤。在第一步中，编译器通过输入（通常是 .cpp 文件及其包含的头文件）线性工作。在第 2 步中，链接器结合第 1 步的结果。

根据您对“之前定义的符号”的描述，我得出结论，问题必须发生在 .cpp 文件中，因为这些文件是线性处理的。dumpbin /exports 适用于步骤 1 的输出，您可能没有。包含标头可能是罪魁祸首，因为这是编译的早期阶段。您想要预处理的输入。IIRC，您可以使用 /EP 开关获得它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-18T06:00:31.037

如果您需要订购包括，首先表明“代码气味”。很可能，您的代码设计得不够好。你所有的公共代码都应该是一个单独的包/dll/lib（不管）的一部分，并且应该从那里包含/链接。

如果您使用 C++/VC++，这通常发生在您直接从其他项目中包含 cpp 和 h 文件而不是链接到某种实用程序库时。

正如有人已经指出的那样，如果您必须忍受它，文本搜索是最好的选择，但请尝试以更好的方式重新设计代码（如果可以的话）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T05:48:56.330

通常我只是 grep 头文件。

# tomcat - 为什么当我将 PermGen 设置为 128M 以上时，我的 Sun JVM 无法初始化？

> ID：1010986
> 
> 赞同：2
> 
> 时间：2009-06-18T05:51:47.463
> 
> 标签：tomcat, permgen

我需要增加我的 PermGen。目前我将以下内容作为命令行参数传递：

`-XX:PermSize=128m -XX:MaxPermSize=128m`

这行得通。但是，如果我尝试增加这些值，我的 JVM 无法初始化，给我这个错误：

`[2009-06-18 01:39:44] [info] Error occurred during initialization of VM [2009-06-18 01:39:44] [info] Could not reserve enough space for object heap [2009-06-18 01:39:44] [info] [2009-06-18 01:39:44] [395 javajni.c] [error] CreateJavaVM Failed`

具体来说，我正在尝试在包含的*JRE6*中启动*Tomcat*，但我认为这无关紧要。

 ***编辑：**我正在运行具有 2GB RAM 的 Win2k3 VM 映像。我使用带有以下参数的*Monitor Tomcat*应用程序启动 JVM ：

初始内存池：**1024**，最大内存池：**1536**

`-XX:PermSize=128m -XX:MaxPermSize=128m -XX:+CMSPermGenSweepingEnabled -XX:+CMSClassUnloadingEnabled -XX:+UseConcMarkSweepGC -Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 6.0 -Dcatalina.base=C:\Program Files\Apache Software Foundation\Tomcat 6.0 -Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat 6.0\endorsed -Djava.io.tmpdir=E:\tomcat\temp -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Djava.util.logging.config.file=C:\Program Files\Apache Software Foundation\Tomcat 6.0\conf\logging.properties`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-18T05:56:03.697

尝试使用 -Xmx512m 给它一个更大的堆（这将提供 512 MB）

您还使用哪些其他内存参数？你的机器有多少内存？你是在 32 位还是 64 位机器上？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T02:08:53.163

Perm Gen 是 Heap 的附加功能，因此请检查流程——您需要有 1.5 GB 以上的 2G 可用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-18T06:35:07.720

我有 2GB 的内存，我使用设置 -Xmx1024m -XX:PermSize=512m -XX:MaxPermSize=512m 运行 tomcat。这通常运行良好。*

# php - php中的空间索引查询

> ID：1010989
> 
> 赞同：0
> 
> 时间：2009-06-18T05:52:21.440
> 
> 标签：php, mysql, spatial-query

我正在尝试用 PHP 编写一个空间索引查询。但是我在为以下代码行编写查询时遇到了麻烦...

```
SET @p = CONCAT('Polygon((',lat1,'',lon1,',',lat1,'',lon2,',',lat2,'',lon2,',',lat2,'',lon1,',',lat1,'',lon1,'))'); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-18T23:02:00.780

通常正确的顺序（除了一些奇怪的例外）是`(long lat)`, not `(lat long)`。还是您只是在 concat 之间缺少一个空格`lat1 long1`？WKT 语法是：

`GeomFromText('POLYGON(long1 lat1, long2 lat2, long3 lat3)')`

坐标用空格隔开，点用逗号隔开。甚至*可能*存在区分大小写的问题，尽管规范不区分大小写，但最好使用`ALL CAPS`，并且我得到了我认为与大小写有关的错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T14:57:17.957

如果您在 php 中使用 mysql 扩展，此查询返回错误。如果使用mysql扩展，请使用mysqli扩展

# svn - 如何处理很多项目中需要的库（+ svn）

> ID：1010997
> 
> 赞同：0
> 
> 时间：2009-06-18T05:54:07.257
> 
> 标签：svn, deployment, shared-libraries

早上好！

我们有一个 SVN 存储库，其中包含一个 VS 解决方案。在这个解决方案中，有许多 Web 项目，每个项目都使用一个 JavaScript-Lib，它是在一个额外的项目中开发的（我们称之为它`DemoWeb`）并手动部署到其他 Web 项目。
这种结构有很多缺点：

1.  您可以在部署时忘记要复制到的项目。
2.  你可能会错过一些文件
3.  您在 SVN 存储库中多次拥有相同的 .js 文件
4.  ...

我认为这种情况（许多项目使用相同的库 - 例如 JavaScript、.dll 文件、图像......）很常见，所以我问你：
你如何处理它？
你如何摆脱这些缺点？
如何不丢失 VS 中 IntelliSense 的引用（例如 CssClass-Checking）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T06:02:30.177

**自动化您的构建和/或部署例程**。研究持续集成。部署您的应用程序应该采取一个步骤。（单击链接，执行脚本等...）除此之外，您还要求搞砸。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-18T07:45:39.403

*   用于构建/部署的自动化构建
*   对于智能感知：VS 有一个名为“添加为链接”的东西，因此您可以将您的 js 放在一个地方并从所有项目中引用它：单击项目->添加->现有项目，找到您的文件并查看“添加”btn ，右边有一个小箭头，使用它并选择“添加为链接”