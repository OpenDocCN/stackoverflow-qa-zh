# StackOverflow 问答 000667000-000667999

# javascript - 使用 Javascript 对下拉列表进行排序

> ID：667010
> 
> 赞同：24
> 
> 时间：2009-03-20T16:53:13.723
> 
> 标签：javascript, list, sorting, drop-down-menu

我想使用javascript对下拉项目进行排序，谁能告诉我如何做到这一点。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-03-20T17:41:59.363

你可以使用 jQuery 和类似这样的东西：

```
$("#id").html($("#id option").sort(function (a, b) {
    return a.text == b.text ? 0 : a.text < b.text ? -1 : 1
})) 
```

但最好问问你为什么以及你想要完成什么。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-20T18:12:42.050

```
<select id="foo" size="10">
  <option value="3">three</option>
  <option value="1">one</option>
  <option value="0">zero</option>
  <option value="2">two</option>
</select>
<script>
  // WARN: won't handle OPTGROUPs!
  var sel = document.getElementById('foo');
  // convert OPTIONs NodeList to an Array
  // - keep in mind that we're using the original OPTION objects
  var ary = (function(nl) {
    var a = [];
    for (var i = 0, len = nl.length; i < len; i++)
      a.push(nl.item(i));
    return a;
  })(sel.options);
  // sort OPTIONs Array
  ary.sort(function(a,b){
    // sort by "value"? (numeric comparison)
    // NOTE: please remember what ".value" means for OPTION objects
    return a.value - b.value;
    // or by "label"? (lexicographic comparison) - case sensitive
    //return a.text < b.text ? -1 : a.text > b.text ? 1 : 0;
    // or by "label"? (lexicographic comparison) - case insensitive
    //var aText = a.text.toLowerCase();
    //var bText = b.text.toLowerCase();
    //return aText < bText ? -1 : aText > bText ? 1 : 0;
  });
  // remove all OPTIONs from SELECT (don't worry, the original
  // OPTION objects are still referenced in "ary") ;-)
  for (var i = 0, len = ary.length; i < len; i++)
    sel.remove(ary[i].index);
  // (re)add re-ordered OPTIONs to SELECT
  for (var i = 0, len = ary.length; i < len; i++)
    sel.add(ary[i], null);
</script> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-06-15T10:36:08.530

您可以尝试使用 JQuery 排序功能来完成这项工作——

[尝试这个](http://jsfiddle.net/rjt6U/77/)

HTML 代码 -

```
<select id="ddlList">
  <option value="3">Three</option>
  <option value="1">One</option>
  <option value="1">one</option>
  <option value="1">a</option>
  <option value="1">b</option>
  <option value="1">A</option>
  <option value="1">B</option>
  <option value="0">Zero</option>
  <option value="2">Two</option>
  <option value="8">Eight</option>
</select> 
```

查询代码 -

```
$("#ddlList").html($('#ddlList option').sort(function(x, y) {        
     return $(x).text().toUpperCase() < $(y).text().toUpperCase() ? -1 : 1;
}));
$("#ddlList").get(0).selectedIndex = 0;
e.preventDefault(); 
```

或者

您也可以为此使用数组排序 -

[尝试这个](http://jsfiddle.net/axLVz/)

```
 var options = $('#ddlList option');
 var arr = options.map(function (_, o) { return { t: $(o).text(), v: o.value }; }).get();
 arr.sort(function (o1, o2) { return o1.t.toUpperCase() > o2.t.toUpperCase() ? 1 : o1.t.toUpperCase() < o2.t.toUpperCase() ? -1 : 0; });         
 options.each(function (i, o) {
     o.value = arr[i].v;
     $(o).text(arr[i].t);
 }); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-20T16:58:17.800

将选项值和文本放入一个数组中，对数组进行排序，然后将现有的选项元素替换为从排序后的数组构造的新元素。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-12-20T18:12:53.723

**取决于 JQUERY**

```
function SortOptions(id) {
    var prePrepend = "#";
    if (id.match("^#") == "#") prePrepend = "";
    $(prePrepend + id).html($(prePrepend + id + " option").sort(
        function (a, b) { return a.text == b.text ? 0 : a.text < b.text ? -1 : 1 })
    );
} 
```

例子：

<select id="my-list-id"> 排序为：

```
SortOptions("#my-list-id"); 
```

或者

```
SortOptions("my-list-id"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-04-21T11:03:56.180

对于整个项目的下拉

```
$(document).ready(function () {
    $.when($('select').addClass('auto-drop-sort')).then($.fn.sortDropOptions("auto-drop-sort"))
})

/*sort all dropdown*/
$.fn.sortDropOptions = function(dropdown_class){
    var prePrepend = ".";
    if (dropdown_class.match("^.") == ".") prePrepend = "";
    var myParent = $(prePrepend + dropdown_class);
    $.each(myParent, function(index, val) {
        /*if any select tag has this class 'manual-drop-sort' this function wont work for that particular*/
        if ( ! $(val).hasClass('manual-drop-sort') ) {
            var selectedVal = $(val).val()
            $(val).html($(val).find('option').sort(
                function (a, b) {
                    if ( a.value != -1 && a.value != 0 && a.value != '' ) {
                        return a.text == b.text ? 0 : a.text < b.text ? -1 : 1 
                    }
                })
            );
            $(val).val(selectedVal)
        }else{
            /* set custom sort for individual select tag using name/id */
        }
    });
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-05-24T02:29:41.347

提供的答案并不真正适合我的情况，所以我自己做了（尤其是不想要 jQuery）。认为它可能会帮助其他人。

```
sortDropDown(document.querySelector('select'));

function sortDropDown(d){
    //save option values
    var existingOptions=d.options; 

    //keep track of previously selected option
    var selectedOpt=d.selectedOptions[0].value;

    //turn nodeList into Array of values
    existingOptions=[].slice.call(existingOptions).map(function(a){return a.innerText});

    //make sure options are unique
    existingOptions = existingOptions.filter( function(value, index, self) { 
        return self.indexOf(value) === index;
    }); 

    //sort options
    existingOptions.sort();

    //keep "All" option as first element
    existingOptions.splice(0, 0, existingOptions.splice(existingOptions.indexOf('All'), 1)[0]);

    //repleace dropdown contents
    var t='';
    existingOptions.forEach(function(a){
        t+='<option '+(a==selectedOpt?'selected':'')+' value="'+a+'">'+a+'</option>';
    });
    d.innerHTML=t;
} 
```

# gridview - 渲染时替换 gridview 行

> ID：667012
> 
> 赞同：1
> 
> 时间：2009-03-20T16:53:19.777
> 
> 标签：gridview, overriding, row, render

我有一个绑定到 gridview 的数据表，在 RowDataBound 事件中，我检查字段的值以确定在 gridview 行中显示的内容。

但是，在某些情况下，当无法计算行中的数据值时，我想显示一个只有一个标签的行，该标签跨越所有列。

当gridview绑定删除/添加控件时，有没有办法覆盖单行的呈现？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T16:56:57.850

是的，[RowCreated](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowcreated.aspx)事件。

# c++ - ＃包括 找不到符号，为什么？

> ID：667015
> 
> 赞同：0
> 
> 时间：2009-03-20T16:54:07.623
> 
> 标签：c++, xcode

我有这个代码：

```
#include <iostream>
#include <mp4.h>

int main (int argc, char * const argv[]) {
    // insert code here...
    std::cout << "Hello, World!\n";

    MP4Read("filename", MP4_DETAILS_ALL );

    return 0;
} 
```

而且我已将 -I/opt/local/include 和 -L/opt/local/lib 添加到路径（通过 macports 安装 mp4 库后驻留的位置），但我得到的只是：

> 未定义符号：“_MP4Read”，引用自：main.old 中的 _main：未找到符号

即使 XCode 找到它并正确地自动完成......

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-20T16:56:06.417

您最有可能需要链接库，即添加 -lmp4 或类似于您的链接命令。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T16:57:22.327

您只指定了路径。您需要在 mp4 库中进行链接。类似于以下内容：

```
g++ -I /.../ -L /.../ -lmp4 -o out main.cpp 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T16:58:45.847

-L 标志告诉编译器在哪里寻找，-l 标志告诉它要寻找什么。

# python - 如何将图像蓝盒化？

> ID：667016
> 
> 赞同：0
> 
> 时间：2009-03-20T16:54:22.177
> 
> 标签：python, python-imaging-library

我有一张扫描图像，基本上是黑色打印在一些奇怪的（非灰色）背景上，比如绿色或黄色（想想旧纸）。

我怎样才能摆脱绿色/黄色并接收与原始图像的灰色结构一样多的灰色图片？即我想保持字母周围的灰色以实现抗锯齿效果或灰色区域，但我想将任何甚至是远程绿色/黄色的东西变成纯白色？

请注意，背景绝不是同质的；所以算法应该能够接受颜色和误差范围或颜色范围。

加分：如何自动确定背景颜色？

我想将 Python 与 Imaging Library 或 ImageMagick 一起使用。

注意：我知道像[unpaper](http://unpaper.berlios.de/)这样的包。我对 unpaper 的问题是它生成的黑白图像可能对 OCR 软件看起来不错，但对人眼来说却不是。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T17:18:03.320

我更多的是 C++ 而不是 python 程序员，所以我不能给你一个代码示例。但一般算法是这样的：

查找背景颜色：您制作图像的直方图。直方图应该有两个峰代表背景和前景色。因为您知道背景具有更高的强度，所以您选择具有更高强度的峰，这就是背景颜色。现在你有了 RGB 背景`(R_bg, G_bg, B_bg)`

将背景设置为白色：循环遍历所有像素并计算到背景的距离：

```
distance = sqrt((R_bg - R_pixel) ^ 2 + (G_bg - G_pixel) ^ 2 + (B_bg - B_pixel) ^ 2) 
```

如果距离小于阈值，则将像素设置为白色。您可以尝试不同的阈值，直到获得良好的结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-08-05T17:42:54.880

我知道这个问题很老，但我正在玩 ImageMagick 试图做类似的事情，并想出了这个：

```
convert text.jpg -fill white -fuzz 50% +opaque black out.jpg 
```

这将其转换为：

![在此处输入图像描述](https://i.stack.imgur.com/yNBpO.jpg)

进入这个：

![在此处输入图像描述](https://i.stack.imgur.com/sJtNe.jpg)

至于“平均”颜色，我使用了这个：

```
convert text.jpg -colors 2 -colorspace RGB -format %c histogram:info:-
 5894: ( 50, 49, 19) #323113 rgb(50,49,19)
19162: (186,187, 87) #BABB57 rgb(186,187,87)       <- THIS ONE ! 
```

这是这种颜色：

![在此处输入图像描述](https://i.stack.imgur.com/PO0an.jpg)

经过更多的实验，我可以得到这个：

![在此处输入图像描述](https://i.stack.imgur.com/c2nVg.jpg)

使用这个：

```
convert text.jpg -fill black -fuzz 50% -opaque rgb\(50,50,10\) -fill white +opaque black out.jpg 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-30T20:50:00.320

不久前，我希望使任意背景颜色透明并开发了这个脚本。它采用图像中最流行的（背景）颜色并创建一个透明度与与背景颜色的距离成正比的 alpha 蒙版。获取 RGB 颜色空间距离对于大图像来说是一个昂贵的过程，所以我尝试使用 numpy 和快速整数 sqrt 逼近操作进行一些优化。首先转换为 HSV 可能是正确的方法。如果你还没有解决你的问题，我希望这会有所帮助：

```
from PIL import Image
import sys, time, numpy

fldr = r'C:\python_apps'
fp = fldr+'\\IMG_0377.jpg'

rz = 0  # 2 will halve the size of the image, etc..

# ----------------

im = Image.open(fp)

if rz:
    w,h = im.size
    im = im.resize((w/rz,h/rz))
    w,h = im.size

h = im.histogram()
rgb = r0,g0,b0 = [b.index(max(b)) for b in [ h[i*256:(i+1)*256] for i in range(3) ]]

def isqrt(n):
    xn = 1
    xn1 = (xn + n/xn)/2
    while abs(xn1 - xn) > 1:
        xn = xn1
        xn1 = (xn + n/xn)/2
    while xn1*xn1 > n:
        xn1 -= 1
    return xn1

vsqrt = numpy.vectorize(isqrt)

def dist(image):
    imarr = numpy.asarray(image, dtype=numpy.int32)  # dtype=numpy.int8
    d = (imarr[:,:,0]-r0)**2 + (imarr[:,:,1]-g0)**2 + (imarr[:,:,2]-b0)**2
    d = numpy.asarray((vsqrt(d)).clip(0,255), dtype=numpy.uint8)
    return Image.fromarray(d,'L')

im.putalpha(dist(im))
im.save(fldr+'\\test.png') 
```

# certificate - 如何检查文件是否有数字签名

> ID：667017
> 
> 赞同：38
> 
> 时间：2009-03-20T16:54:24.220
> 
> 标签：certificate, code-signing

我想以编程方式检查文件是否已进行数字签名。

目前，我发现了一个相当晦涩的[Microsoft 代码](https://docs.microsoft.com/en-us/windows/win32/seccrypto/example-c-program--verifying-the-signature-of-a-pe-file)，它无法编译......

对这个主题有任何想法吗？

顺便说一句，带有命令行的外部工具也很棒。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2014-03-17T23:24:24.360

答案提到的重要缺失部分`signtool`是：

是的，您还可以通过众所周知的`signtool.exe`方式找出文件是否已签名。无需下载其他工具！

例如用简单的线：

```
signtool verify /pa myfile.exe
if %ERRORLEVEL% GEQ 1 echo This file is not signed. 
```

（对于详细输出，请在`/v`之后添加`/pa`。）

有人可能会问：为什么这很重要？我只是（再次）签署应该签署的文件并且它可以工作。

我的目标是保持构建干净，并且不要第二次签署文件，因为不仅日期改变了，而且之后的二进制文件也不同。

业务示例：我的客户有一个简化的自动化“开发操作”类构建和构建后流程。不同的文件集有多个来源，最后所有文件都经过构建、测试和捆绑分发 - 为此必须对一些文件进行签名。为保证某些文件在没有签名的情况下不会离开设备，我们曾经对媒体上找到的所有重要文件进行签名，即使它们已经签名。

但这还不够干净！一般来说：

1.  如果我们再次对已经签名的文件进行签名，文件日期和二进制指纹会发生变化，并且如果只是简单地复制文件，文件就会失去与其来源的可比性。（至少如果您使用时间戳签名，我们总是这样做，我认为这是强烈推荐的。）

这是一个严重的质量损失，因为尽管文件本身没有更改，但该文件不再与其前身相同。

2.  如果我们再次签署文件，当它是不应由我们公司签署的第三方文件时，这也可能是一个错误。

您可以通过根据前面提到的调用的返回码使签名本身有条件来避免这两种情况`signtool verify`。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2013-06-17T23:09:16.310

下载[`Sigcheck`](https://docs.microsoft.com/en-us/sysinternals/downloads/sigcheck)并使用以下命令。

```
sigcheck.exe -a -u -e 
```

已签名 dll 的示例

```
File version:   0.0.0.0
Strong Name:    Signed 
```

未签名 dll 的示例

```
File version:   0.0.0.0
Strong Name:    Unsigned 
```

`Sigcheck`是一个显示文件版本号的命令行实用程序。祝你好运

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2015-12-10T11:39:37.993

[我在网上找到了](http://certhelp.ksoftware.net/support/solutions/articles/50357-how-do-i-verify-a-digital-signature-in-c-)另一个选项（纯 .NET 代码）。

该代码非常简单并且有效。

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Text;
using System.Threading.Tasks;

internal class Program
{
    private static void Main(string[] args)
    {
        string filePath = args[0];

        if (!File.Exists(filePath))
        {
            Console.WriteLine("File not found");
            return;
        }

        X509Certificate2 theCertificate;

        try
        {
            X509Certificate theSigner = X509Certificate.CreateFromSignedFile(filePath);
            theCertificate = new X509Certificate2(theSigner);
        }
        catch (Exception ex)
        {
            Console.WriteLine("No digital signature found: " + ex.Message);

            return;
        }

        bool chainIsValid = false;

        /*
         *
         * This section will check that the certificate is from a trusted authority IE
         * not self-signed.
         *
         */

        var theCertificateChain = new X509Chain();

        theCertificateChain.ChainPolicy.RevocationFlag = X509RevocationFlag.ExcludeRoot;

        /*
         *
         * Using .Online here means that the validation WILL CALL OUT TO THE INTERNET
         * to check the revocation status of the certificate. Change to .Offline if you
         * don't want that to happen.
         */

        theCertificateChain.ChainPolicy.RevocationMode = X509RevocationMode.Online;

        theCertificateChain.ChainPolicy.UrlRetrievalTimeout = new TimeSpan(0, 1, 0);

        theCertificateChain.ChainPolicy.VerificationFlags = X509VerificationFlags.NoFlag;

        chainIsValid = theCertificateChain.Build(theCertificate);

        if (chainIsValid)
        {
            Console.WriteLine("Publisher Information : " + theCertificate.SubjectName.Name);
            Console.WriteLine("Valid From: " + theCertificate.GetEffectiveDateString());
            Console.WriteLine("Valid To: " + theCertificate.GetExpirationDateString());
            Console.WriteLine("Issued By: " + theCertificate.Issuer);
        }
        else
        {
            Console.WriteLine("Chain Not Valid (certificate is self-signed)");
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-03-20T17:14:47.993

如果需要外部工具，可以使用 signtool.exe。它是 Windows SDK 的一部分，它接受命令行参数，你可以在这里找到更多关于它的信息， http: [//msdn.microsoft.com/en-us/library/aa387764.aspx](http://msdn.microsoft.com/en-us/library/aa387764.aspx)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2020-08-04T08:23:18.097

从 PowerShell 5.1 开始，您可以使用它[`Get-AuthenticodeSignature`](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/get-authenticodesignature)来验证二进制文件或 PowerShell 脚本的签名。

```
> Get-AuthenticodeSignature -FilePath .\MyFile.exe

SignerCertificate                 Status        Path                                                                                   
-----------------                 ------        ----                                                                                   
A59E92E31475F813DDAF41C3CCBC8B78  Valid         MyFile.exe 
```

或者

```
> (Get-AuthenticodeSignature -FilePath .\MyFile.exe).Status
Valid 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-08-19T12:00:38.017

您也可以尝试为此`sign-check`目的使用 npm 包。

这个包实现了 WinVerifyTrust API 并且使用简单：

```
npm install -g sign-check

sign-check 'path/to/file' 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-03-07T10:27:18.320

选择`<*>.exe`右键单击>属性。如果文件已签名，那么您将在该文件的属性窗口中获得此选项卡。

[![文件的属性](https://i.stack.imgur.com/xgoIS.png)](https://i.stack.imgur.com/xgoIS.png)

# css - css div溢出和动态水平大小

> ID：667023
> 
> 赞同：2
> 
> 时间：2009-03-20T16:54:58.167
> 
> 标签：css, dynamic-css

我有一个显示大量表格数据的网页，这些表格中的每一个都需要放在一条水平线上。我在下面模拟了一个例子：

```
<html>
<style>
  .outer{width:300px;height:300px;overflow: scroll;}
  .inner{white-space: nowrap;}
  .inline{float: left;}
</style>
<body>
<div class="outer">
    <div class="inner">
        <div class="inline"><table><tr><td>stuff</td></tr></table></div>
        <div class="inline"><table><tr><td>stuff</td></tr></table></div>
        <div class="inline"><table><tr><td>stuff</td></tr></table></div>
        <div class="inline"><table><tr><td>stuff</td></tr></table></div>
        <div class="inline"><table><tr><td>stuff</td></tr></table></div>
        <div class="inline"><table><tr><td>stuff</td></tr></table></div>
        <div class="inline"><table><tr><td>stuff</td></tr></table></div>
        <div class="inline"><table><tr><td>stuff</td></tr></table></div>
        <div class="inline"><table><tr><td>stuff</td></tr></table></div>
    </div>
</div>
</body>
</html> 
```

我遇到了内部 div 包裹表格 div 的问题，除非我将其设置为具有较大的宽度，例如 4000px。有没有一种很好的方法来保持所有表内联，即使它们超过了仅使用 css 的外部 div 的大小？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T17:07:24.017

我们这个属性：

```
white-space:nowrap; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-03-23T19:17:21.717

更改`.inline{float: left;}`为`.inline{display:inline-block;}`

[http://jsfiddle.net/QLe5r/](http://jsfiddle.net/QLe5r/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-23T16:26:22.277

这是因为 float: left 在 div“内联”上。而是使用 display: inline-block，（和 display: inline for IE，我认为。检查）。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-06-06T00:54:23.310

为什么在地球上你在大量的 div 中有大量的表格？！？这违背了将表格用于表格数据的目的......当您处理表格数据时，您应该只使用表格......而不是应用无用的组合。

只需使用一个表并`<td>stuff</td>`在每次有更多数据要添加时使用......无论如何，td 都是基于水平的，因此您甚至不必费心使用 css 来扩展它。

# java - 寻找用于与 JPA 模型交互的通用库

> ID：667029
> 
> 赞同：0
> 
> 时间：2009-03-20T16:56:34.947
> 
> 标签：java, jpa, crud, dao

我正在使用 JPA 对象模型构建应用程序，并创建多个数据访问对象以与该模型进行交互。我发现我在不同的数据访问对象之间重复了很多代码（本质上是 CRUD）。唯一不同的是目标 JPA 类。

我想知道是否有人知道可以与任何 JPA 模型一起使用并会生成必要的 DAO（或 CRUD 操作）的抽象库。当然支持所有的一对一、一对多、多对一和多对多关系。

谢谢

PS - 即使不是 JPA 模型，您是否知道这样的库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T17:39:39.150

您可以使用泛型并将您的 DAO 编码为接口。[Spring 文档](http://blog.springsource.com/2006/05/30/getting-started-with-jpa-in-spring-20/)对此进行了解释。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T01:59:48.840

我建议你看看这篇文章：[http](http://www.ibm.com/developerworks/java/library/j-genericdao.html) ://www.ibm.com/developerworks/java/library/j-genericdao.html 。

它解释了使用 Hibernate 和 Spring AOP 实现通用 DAO 的模式，但可以轻松适应 JPA 命名查询（以及基于 AspectJ 的 AOP，如果您不想使用 Spring）。

基于 Java 反射 API，这个概念是非常可扩展的。例如，我见过使用带注释的方法参数作为命名参数的实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-11T03:23:16.903

我也在寻找一个通用的 DAO 库。这是我发现的。

图书馆：

*   [http://code.google.com/p/hibernate-generic-dao/](http://code.google.com/p/hibernate-generic-dao/)（我可能会使用这个，虽然它不再被维护）
*   [http://code.google.com/p/generic-dao/](http://code.google.com/p/generic-dao/)
*   [http://code.google.com/p/genericdao/](http://code.google.com/p/genericdao/)

文章：

*   [http://www.javaworld.com/community/node/8239](http://www.javaworld.com/community/node/8239)
*   [http://www.codeproject.com/Articles/251166/The-Generic-DAO-pattern-in-Java-with-Spring-3-and](http://www.codeproject.com/Articles/251166/The-Generic-DAO-pattern-in-Java-with-Spring-3-and)
*   [http://www.ibm.com/developerworks/java/library/j-genericdao/index.html](http://www.ibm.com/developerworks/java/library/j-genericdao/index.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-01T08:31:53.937

如果您想使用针对 Eclipse RCP 应用程序的 JPA 数据模型快速开发您的应用程序，您可以查看[http//www.adichatz.org 。](http://www.adichatz.org)目前它仅适用于 Jboss 或 Java SE 模式。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-09-23T21:43:26.833

JPA 或 Hibernate 的 DAO 没有任何意义。DAO 的存在是为了隐藏数据库的复杂性中的其他代码。这就是 JPA 和 Hibernate 所做的，非常好。那么，为什么要在 DAO 层中添加 DAO？

# math - 简单的基于物理的运动

> ID：667034
> 
> 赞同：31
> 
> 时间：2009-03-20T16:57:37.130
> 
> 标签：math, 2d, physics

我正在开发一个 2D 游戏，我正在尝试使用一些基本的物理代码将对象加速到最高速度。

这是它的伪代码：

```
 const float acceleration = 0.02f;
const float friction     = 0.8f;  // value is always 0.0..1.0
      float velocity     = 0;
      float position     = 0;

move()
{
   velocity += acceleration;
   velocity *= friction;
   position += velocity;
} 
```

这是一种非常简化的方法，不依赖于质量或实际摩擦（代码中的摩擦只是作用于运动的通用力）。它和“速度 *= 摩擦力”一样有效；部分防止速度超过某个点。然而，正是这个最高速度以及它与加速度和摩擦的关系让我有点迷茫。

我想做的是设置一个最高速度，以及达到它所需的时间，然后用它们来推导出加速度和摩擦值。

IE，

```
 const float max_velocity = 2.0; 
const int   ticks;       = 120; // If my game runs at 60 FPS, I'd like a 
                                // moving object to reach max_velocity in 
                                // exactly 2 seconds.
const float acceleration = ?
const float friction     = ? 
```

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-20T17:13:37.980

我发现这个问题非常有趣，因为我最近做了一些关于用阻力建模抛射体运动的工作。

**第 1 点：**您实际上是在使用[显式/前向欧拉迭代](http://en.wikipedia.org/wiki/Euler's_method)来更新位置和速度，其中状态的每个新值都应该是旧值的函数。在这种情况下，您应该先更新位置*，*然后再更新速度。

**第 2 点：**[阻力摩擦效应](http://en.wikipedia.org/wiki/Air_resistance)有更真实的物理模型。一个模型（由[Adam Liss](https://stackoverflow.com/questions/667034/simple-physics-based-movement/667839#667839)建议）涉及与速度成比例的阻力（称为斯托克斯阻力，通常适用于低速情况）。*我之前建议的一个涉及与速度的平方*成正比的阻力（称为二次阻力，通常适用于高速情况）。我将就如何推导出最大速度的公式以及有效达到最大速度所需的时间来解决每一个问题。我将放弃完整的推导，因为它们相当复杂。

* * *

**[斯托克斯的阻力：](https://en.wikipedia.org/wiki/Drag_(physics)#Very_low_Reynolds_numbers:_Stokes.27_drag)**

更新速度的方程为：

```
velocity += acceleration - friction*velocity 
```

它表示以下微分方程：

```
dv/dt = a - f*v 
```

使用[这个积分表](http://www.sosmath.com/tables/integral/integ3/integ3.html)中的第一个条目，我们可以找到解（假设 v = 0 在 t = 0）：

```
v = (a/f) - (a/f)*exp(-f*t) 
```

当 t >> 0 时出现最大（即终端）速度，因此等式中的第二项非常接近于零，并且：

```
v_max = a/f 
```

关于达到最大速度所需的时间，请注意方程从未真正达到它，而是逐渐接近它。然而，当指数的参数等于 -5 时，速度大约是最大速度的 98%，可能接近到足以认为它相等。然后，您可以将达到最大速度的时间近似为：

```
t_max = 5/f 
```

然后，您可以使用这两个方程来求解**f**和**给**定的所需**vmax**和**tmax**。

* * *

**[二次阻力：](https://en.wikipedia.org/wiki/Drag_(physics)#Drag_at_high_velocity)**

更新速度的方程为：

```
velocity += acceleration - friction*velocity*velocity 
```

它表示以下微分方程：

```
dv/dt = a - f*v^2 
```

使用[这个积分表](http://www.sosmath.com/tables/integral/integ10/integ10.html)中的第一个条目，我们可以找到解（假设 v = 0 在 t = 0）：

```
v = sqrt(a/f)*(exp(2*sqrt(a*f)*t) - 1)/(exp(2*sqrt(a*f)*t) + 1) 
```

当 t >> 0 时出现最大（即终端）速度，因此指数项远大于 1，方程接近：

```
v_max = sqrt(a/f) 
```

关于达到最大速度所需的时间，请注意方程从未真正达到它，而是逐渐接近它。然而，当指数的参数等于 5 时，速度大约是最大速度的 99%，可能接近到足以认为它相等。然后，您可以将达到最大速度的时间近似为：

```
t_max = 2.5/sqrt(a*f) 
```

这也相当于：

```
t_max = 2.5/(f*v_max) 
```

对于所需的**vmax**和**tmax ，** **tmax**的第二个等式将告诉您**f**应该是什么，然后您可以将其代入**vmax**的等式以获得**a**的值。

* * *

这似乎有点矫枉过正，但这些实际上是建模阻力的一些最简单的方法！任何*真正*想查看集成步骤的人都可以给我发电子邮件，我会发送给您。他们有点太投入了，无法在这里输入。

**另一点：我没有立即意识到这一点，但是如果您改为使用我为****v(t)**导出的公式，则不再需要更新速度。如果您只是简单地对静止加速进行建模，并且您正在跟踪自加速开始以来的时间，则代码将如下所示：

```
position += velocity_function(timeSinceStart) 
```

其中“velocity_function”是**v(t)**的两个公式之一，您将不再需要速度变量。一般来说，这里有一个权衡：计算**v(t)**可能比简单地用迭代方案更新速度更昂贵（由于指数项），但它保证保持稳定和有界。在某些条件下（例如试图获得非常短的**tmax**），迭代可能会变得不稳定和爆炸，这是前向欧拉方法的常见问题。但是，保持对变量的限制（如 0 < **f** < 1）应该可以防止这些不稳定性。

此外，如果您感觉有点自虐，您可以整合**v(t)**的公式以获得**p(t)**的封闭形式解决方案，从而完全不需要牛顿迭代。我会把这个留给其他人尝试。=)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T20:25:21.653

### 警告：部分解决方案

如果我们遵循所述的物理学，则没有最大速度。从纯粹的物理角度来看，您已将加速度固定在一个恒定值，这意味着速度始终在增加。

作为替代方案，请考虑作用在对象上的两种力：

*   趋向于加速它的恒定外力**F**和
*   阻力**d**与速度成正比并趋于减慢速度。

因此迭代速度`n`变为：*v* [n] = *v* [0] + n **F** - **d** *v* [n-1]

您已要求选择迭代时出现的最大速度*v* [nmax]`nmax`。

请注意，问题是*欠约束的*；也就是**F**和**d**是相关的，所以可以任意给其中一个取一个值，然后再计算另一个。

*现在球在滚动，有人愿意学习数学吗？*

**警告：**它很丑陋并且涉及[幂级数](http://en.wikipedia.org/wiki/Geometric_series#Geometric_power_series)！

* * *

编辑：为什么`n**F**`第一个等式中的序列会按字面意思出现，除非 ? 后面有空格`n`？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-20T17:11:49.763

```
velocity *= friction; 
```

这并不能阻止速度达到某个点...

随着速度的增加，摩擦力呈指数增长（不要引用我的话），并且在静止时为0。最终，您将达到摩擦=加速度的地步。

所以你想要这样的东西：

```
velocity += (acceleration - friction);
position += velocity;
friction = a*exp(b*velocity); 
```

在哪里选择 a 和 b 的值。b 将控制达到最高速度所需的时间，a 将控制摩擦增加的突然程度。（再一次，不要对此进行自己的研究——我从我记得的 12 年级物理开始。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-20T21:09:34.700

这没有回答您的问题，但是在这样的模拟中您不应该做的一件事是依赖于固定的帧速率。计算自上次更新以来的时间，并在方程中使用 delta-T。就像是：

```
static double lastUpdate=0;
if (lastUpdate!=0) {
  deltaT = time() - lastUpdate;
  velocity += acceleration * deltaT;
  position += velocity * deltaT;
}
lastUpdate = time(); 
```

检查您是否失去焦点并停止更新也很好，当您获得焦点时，将 lastUpdate 设置为 0。这样，当您返回时，您不会获得巨大的 deltaT 来处理。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-20T20:30:04.047

如果你想看看使用*非常简单的数学可以用**非常*简单的物理模型做什么，请查看[http://scratch.mit.edu/](http://scratch.mit.edu/)上的一些 Scratch 项目- 你可能会得到一些有用的想法，你会当然玩得开心。

 ** * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-20T20:50:00.643

这可能不是您正在寻找的，但取决于您正在使用的引擎，使用其他人构建的引擎可能会更好，例如[farseer](http://www.codeplex.com/FarseerPhysics)（用于 C#）。 *注意*Codeplex 因维护而停机。

# sql - MySQL 重复行

> ID：667035
> 
> 赞同：4
> 
> 时间：2009-03-20T16:58:11.870
> 
> 标签：sql, mysql

我有一个包含一些重复信息的表：Id、Name、Lastname、Birth、PersonalKey、Personal Info、Direction、Source。

来源告诉我信息来自哪里。

重复的信息有唯一的ID，我需要删除被欺骗的信息。 **但是**，我优先于一些源信息，我需要成为一个保留而另一个删除的源信息。

另一件事是另一个源信息有一些我想留下的信息没有，所以我需要将 PersonalKey 重新填充到将要留下的信息并删除重复的信息。

名为 Pruebas 的表

```
---Id, Name, Firstname, Lastname, Birth, RFC, Source, PersonalKey---
---2,Juan,Garcia,Escobeddo,1983-08-04,GAED87393, DRV484930, 34233--
---3,Juan,Garcia,Escobedo,1987-08-04,GAED87393, FIN484930, --
---4,Juan,Garcia,Escobedo,1987-08-04,GAED87393, SA484930, -- 
```

正如你看到的：

*   ID 是唯一的
*   姓名、名字和姓氏重复
*   id 2 有 PersonalKey 值，但 3 和 4 没有
    *   我希望保留带有“FIN%”源的那个并删除其他的，但首先我需要确保剩余的行获得 PersonalKey 值（IOW，我不想丢失 PersonalKey 值）。

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T17:43:36.177

我会在这个查询上运行一个游标（使用 MySQL SP 编程语言、Java、Python、.NET）：

```
select Name, Firstname, Lastname, count(1)
  from Pruebas
 group by Name, Firstname, Lastname
having count(1) > 1 
```

然后，在从游标返回的行上，做任何你需要做的事情：检查 FIN% 实例，检查 PersonalKey 的存在，并相应地更新。

对于游标上的每一行，您可以使用以下命令打开不同的游标：

```
select *
  from Pruebas
 where Name = the_Name
   and Firstname = the_Firstname
   and Lastname = the_Lastname 
```

现在，您将拥有一个内部游标，其中包含您要修改的所有行。如果它是您需要的，请保留它并使用您提到的 KEY 值对其进行更新。否则，删除它。

在 Oracle 中，您可以在一个查询中完成您想要的，但我认为您不会获得与使用这种方法相同的性能。

希望能帮助到你。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T21:07:18.807

The most straightforward solution I can think of is to copy the `PersonalKey` to other duplicate rows, and then delete all rows that don't match `'FIN%'`.

```
UPDATE Pruebas p1 JOIN Pruebas p2
 ON (SOUNDEX(CONCAT(p1.Name, p2.Firstname, p3.Lastname)) 
   = SOUNDEX(CONCAT(p2.Name, p2.Firstname, p2.Lastname)))
SET p1.PersonalKey = p2.PersonalKey
WHERE p2.PersonalKey IS NOT NULL;

DELETE FROM Pruebas WHERE Source NOT LIKE 'FIN%'; 
```

I'm showing an approximate match expression for the join, using [`SOUNDEX()`](http://dev.mysql.com/doc/refman/5.1/en/string-functions.html#function_soundex).

* * *

I see from other comments you have left that you have a lot of variation and uncertainty. In this case, there's no way to automate the cleanup and de-duplication -- or at least automatic cleanup will be more complex and harder to get right than just doing it manually.

* * *

Re your comment that the query takes many hours: yes, it's really not expected to be efficient. The JOIN expression is not *sargable* -- that is, it cannot take advantage of an index. You could make it more efficient by adding an extra column to physically store the `SOUNDEX()` value of the name,firstname,lastname. Then create an index on that column.

But `SOUNDEX()` isn't guaranteed to find all possible misspellings anyway. You are facing a data cleanup task that cannot be automated fully. **Any solution to data cleanup requires manual work.**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-20T18:06:35.310

我会做这样的事情：

> CREATE TABLE Pruebas_new
> SELECT * FROM Pruebas
> GROUP BY name, firstname, lastname with
> Source like 'FIN%';

如果您需要它更快，可以使用临时表重写它并覆盖原始表中的内容，但这会以最简单的方式获取您需要的数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T23:04:47.230

很抱歉延迟回答。这两天我有点忙。

以下是我基于以下假设的回答：

1）您将通过其他一些机制来清理名称拼写问题（您提到您将在对原始问题的评论中使用正则表达式来清理它）。

2) 可以使用名字、姓氏和出生来识别 DUP 集（您在对原始问题的评论中提到了这一点）。

3) Firstname、Lastname 和 Birth 不能为 NULL。

4）您在 DUP 集中不能有多个 FIN 记录（您在对原始问题的评论中提到了这一点）。

如果上述任何假设无效，则必须修改我的答案。

以下是要采取的步骤：

1) 更新所有 FIN 记录以从非 FIN 记录复制 PersonalKey：

```
 UPDATE Pruebas p1
INNER JOIN Pruebas p2
        ON p1.Firstname = p2.Firstname
       AND p1.Lastname = p2.Lastname
       AND p1.Birth = p2.Birth
       SET p1.PersonalKey = p2.PersonalKey
     WHERE p1.Source like 'FIN%'
       AND p1.PersonalKey is null
       AND p2.PersonalKey is not null; 
```

2）删除我们有FIN记录的所有非FIN记录：

```
 DELETE p2
      FROM Pruebas p1
INNER JOIN Pruebas p2
        ON p1.Firstname = p2.Firstname
       AND p1.Lastname = p2.Lastname
       AND p1.Birth = p2.Birth
     WHERE p1.Source like 'FIN%'
       AND p2.Source not like 'FIN%'; 
```

此时所有带有 FIN 记录的 DUP 都已被清除，因此只剩下 FIN 记录。

3) 如果我们决定在所有其他情况下保留 DRV 记录。我们需要将 PersonalKey 从另一条记录复制到 DRV 记录：

```
 UPDATE Pruebas p1
INNER JOIN Pruebas p2
        ON p1.Firstname = p2.Firstname
       AND p1.Lastname = p2.Lastname
       AND p1.Birth = p2.Birth
       SET p1.PersonalKey = p2.PersonalKey
     WHERE p1.Source like 'DRV%'
       AND p1.PersonalKey is null
       AND p2.PersonalKey is not null; 
```

4) 删除我们有 DRV 记录的所有非 DRV 记录：

```
 DELETE p2
      FROM Pruebas p1
INNER JOIN Pruebas p2
        ON p1.Firstname = p2.Firstname
       AND p1.Lastname = p2.Lastname
       AND p1.Birth = p2.Birth
     WHERE p1.Source like 'DRV%'
       AND p2.Source not like 'DRV%'; 
```

此时，所有带有 DRV 记录的 DUP 都已被清除，因此只剩下 DRV 记录。

如果唯一的其他记录类型是 SA 记录，那么应该没有更多的 DUP，我们就完成了。

5) 如果我们要选择填写信息最多的记录，或者如果我们完成了 3 和 4 并且仍然存在多个记录类型导致 DUP。对于所有非 FIN 记录，我们需要将 PersonalKey 从具有它的 DUP 集中的任何记录复制到没有它的任何记录：

```
 UPDATE Pruebas p1
INNER JOIN Pruebas p2
        ON p1.Firstname = p2.Firstname
       AND p1.Lastname = p2.Lastname
       AND p1.Birth = p2.Birth
       SET p1.PersonalKey = p2.PersonalKey
     WHERE p1.Source not like 'FIN%'
       AND p1.PersonalKey is null
       AND p2.PersonalKey is not null; 
```

6) 删除所有记录，除了信息最多的记录（由 info_score 计算列定义）：

```
 DELETE p5
      FROM Pruebas p5
INNER JOIN (SELECT p3.Firstname
                 , p3.Lastname
                 , p3.Birth
                 , MIN(p3.Id) AS min_id
              FROM Pruebas p3
        INNER JOIN (SELECT p1.Firstname
                         , p1.Lastname
                         , p1.Birth
                         , count(*) AS c
                         , MAX((p1.Name is not null) + (p1.RFC is not null) + (p1.Source is not null) + (p1.PersonalKey is not null)) AS info_score
                      FROM Pruebas p1
                  GROUP BY p1.Firstname
                         , p1.Lastname
                         , p1.Birth 
                    HAVING count(*) > 1) p2
                ON p3.Firstname = p2.Firstname
               AND p3.Lastname = p2.Lastname
               AND p3.Birth = p2.Birth
               AND ((p3.Name is not null) + (p3.RFC is not null) + (p3.Source is not null) + (p3.PersonalKey is not null)) = p2.info_score
          GROUP BY p3.Firstname
                 , p3.Lastname
                 , p3.Birth) p4
        ON p4.Firstname = p5.Firstname
       AND p4.Lastname = p5.Lastname
       AND p4.Birth = p5.Birth
       AND p4.min_id <> p5.Id; 
```

此时所有 DUP 都已折叠，如果 PersonalKey 可用则保存，如果存在则保存 FIN 记录，否则将保存 DRV 记录或信息最多的记录。

如果您对上述任何内容有任何疑问，请告诉我。

希望能帮助到你，

-蘸

# fluent-nhibernate - 如何在我的基类中映射私有属性？

> ID：667039
> 
> 赞同：0
> 
> 时间：2009-03-20T16:58:44.787
> 
> 标签：fluent-nhibernate, nhibernate-mapping

使用流利的 nhibernate，是否可以在基类中映射私有属性？

我在我的基类中定义了这个：

```
private DateTime? lastModifiedDT { get; set; } 
```

但是当我像这样映射它时：

```
Version(Reveal.Property<EntityType>("lastModifiedDT")).ColumnName("LastModifiedDT"); 
```

我得到一个`FluentNHibernate.UnknownPropertyException`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T17:06:33.940

`protected`如果可以，请尝试制作该属性。

# javascript - 从 HTML Canvas 获取像素？

> ID：667045
> 
> 赞同：122
> 
> 时间：2009-03-20T17:00:05.097
> 
> 标签：javascript, html, canvas

是否可以查询 HTML Canvas 对象以获取特定位置的颜色？

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2009-03-20T17:06:52.647

W3C 文档中有一个关于[像素操作的部分。](http://dev.w3.org/html5/spec/Overview.html#pixel-manipulation)

这是[一个关于如何反转图像的示例](http://dev.opera.com/articles/view/html-5-canvas-the-basics/#pixelbasedmanipulation)：

```
var context = document.getElementById('myCanvas').getContext('2d');

// Get the CanvasPixelArray from the given coordinates and dimensions.
var imgd = context.getImageData(x, y, width, height);
var pix = imgd.data;

// Loop over each pixel and invert the color.
for (var i = 0, n = pix.length; i < n; i += 4) {
    pix[i  ] = 255 - pix[i  ]; // red
    pix[i+1] = 255 - pix[i+1]; // green
    pix[i+2] = 255 - pix[i+2]; // blue
    // i+3 is alpha (the fourth element)
}

// Draw the ImageData at the given (x,y) coordinates.
context.putImageData(imgd, x, y); 
```

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2009-03-20T17:11:21.137

试试[`getImageData`](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas#getting_the_pixel_data_for_a_context)方法：

```
var data = context.getImageData(x, y, 1, 1).data;
var rgb = [ data[0], data[1], data[2] ]; 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2014-12-30T13:49:27.063

是的，只要你有它的上下文。*（查看如何在[此处](https://stackoverflow.com/a/27705693/985454)获取画布上下文。）*

```
var imgData = context.getImageData(0,0,canvas.width,canvas.height)
// { data: [r,g,b,a,r,g,b,a,r,g,..], ... }

function getPixel(imgData, index) {
  var i = index*4, d = imgData.data
  return [d[i],d[i+1],d[i+2],d[i+3]] // Returns array [R,G,B,A]
}

// AND/OR

function getPixelXY(imgData, x, y) {
  return getPixel(imgData, y*imgData.width+x)
} 
```

* * *

**PS：**如果您打算改变数据并将它们绘制回画布上，您可以使用`subarray`

```
var
  idt = imgData, // See previous code snippet
  a = getPixel(idt, 188411), // Array(4) [0, 251, 0, 255]
  b = idt.data.subarray(188411*4, 188411*4 + 4) // Uint8ClampedArray(4) [0, 251, 0, 255]

a[0] = 255 // Does nothing
getPixel(idt, 188411) // Array(4) [0, 251, 0, 255]

b[0] = 255 // Mutates the original imgData.data
getPixel(idt, 188411) // Array(4) [255, 251, 0, 255]

// Or use it in the function
function getPixel(imgData, index) {
  var i = index*4, d = imgData.data
  return imgData.data.subarray(i, i+4) // Returns subarray [R,G,B,A]
} 
```

您可以在[http://qry.me/xyscope/](http://qry.me/xyscope/)上进行试验，此代码在源代码中，只需在控制台中复制/粘贴即可。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2015-04-17T13:44:39.977

```
function GetPixel(context, x, y)
{
    var p = context.getImageData(x, y, 1, 1).data; 
    var hex = "#" + ("000000" + rgbToHex(p[0], p[1], p[2])).slice(-6);  
    return hex;
}

function rgbToHex(r, g, b) {
    if (r > 255 || g > 255 || b > 255)
        throw "Invalid color component";
    return ((r << 16) | (g << 8) | b).toString(16);
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-20T17:07:09.137

是的，看看[`getImageData()`](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas#getting_the_pixel_data_for_a_context)。下面是一个使用 canvas 使用 JavaScript 破解 CAPTCHA 的示例：

*[JavaScript 中的 OCR 和神经网络](http://ejohn.org/blog/ocr-and-neural-nets-in-javascript/)*

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-12-31T07:51:00.580

请注意，`getImageData`返回快照。含义是：

*   更改将在以后生效`putImageData`
*   `getImageData`并且`putImageData`通话速度相对较慢

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2015-02-06T11:03:17.587

```
//Get pixel data
var imageData = context.getImageData(x, y, width, height);

//Color at (x,y) position
var color = [];
color['red'] = imageData.data[((y*(imageData.width*4)) + (x*4)) + 0];
color['green'] = imageData.data[((y*(imageData.width*4)) + (x*4)) + 1];
color['blue'] = imageData.data[((y*(imageData.width*4)) + (x*4)) + 2];
color['alpha'] = imageData.data[((y*(imageData.width*4)) + (x*4)) + 3]; 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-07-15T10:36:08.313

您可以使用`i << 2`.

```
const data = context.getImageData(x, y, width, height).data;
const pixels = [];

for (let i = 0, dx = 0; dx < data.length; i++, dx = i << 2) {
    pixels.push({
        r: data[dx  ],
        g: data[dx+1],
        b: data[dx+2],
        a: data[dx+3]
    });
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-02-01T11:35:28.630

# 快速方便

使用以下实现[本文](https://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/)中描述的快速方法并包含您需要的所有方法的类：`readPixel`, `putPixel`, get `width/height`。调用`refresh()`方法后类更新画布。示例求解二维[波动方程的简单情况](https://en.wikipedia.org/wiki/Wave_equation)

```
class Screen{
  constructor(canvasSelector) {
    this.canvas = document.querySelector(canvasSelector);
    this.width  = this.canvas.width;
    this.height = this.canvas.height;
    this.ctx = this.canvas.getContext('2d');
    this.imageData = this.ctx.getImageData(0, 0, this.width, this.height);
    this.buf = new ArrayBuffer(this.imageData.data.length);
    this.buf8 = new Uint8ClampedArray(this.buf);
    this.data = new Uint32Array(this.buf);  
  }

  // r,g,b,a - red, gren, blue, alpha components in range 0-255
  putPixel(x,y,r,g,b,a=255) {
    this.data[y * this.width + x] = (a << 24) | (b << 16) | (g <<  8) | r;
  }

  readPixel(x,y) {
    let p= this.data[y * this.width + x]
    return [p&0xff, p>>8&0xff, p>>16&0xff, p>>>24];
  }

  refresh() {
    this.imageData.data.set(this.buf8);
    this.ctx.putImageData(this.imageData, 0, 0);
  }
}

// --------
// TEST
// --------

let s=new Screen('#canvas');

function draw() {

  for (var y = 1; y < s.height-1; ++y) {
    for (var x = 1; x < s.width-1; ++x) {      
      let a = [[1,0],[-1,0],[0,1],[0,-1]].reduce((a,[xp,yp])=> 
        a+= s.readPixel(x+xp,y+yp)[0]
      ,0);
      let v=a/2-tmp[x][y];
      tmp[x][y]=v<0 ? 0:v;
    }
  }

  for (var y = 1; y < s.height-1; ++y) {
    for (var x = 1; x < s.width-1; ++x) {  
      let v=tmp[x][y];
      tmp[x][y]= s.readPixel(x,y)[0];
      s.putPixel(x,y, v,v,v);
    }
  }

  s.refresh();
  window.requestAnimationFrame(draw)
}

// temporary 2d buffer ()for solving wave equation)
let tmp = [...Array(s.width)].map(x => Array(s.height).fill(0));

function move(e) { s.putPixel(e.x-10, e.y-10, 255,255,255);}

draw();
```

```
<canvas id="canvas" height="150" width="512" onmousemove="move(event)"></canvas>
<div>Move mouse on black box</div>
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-10-13T18:38:11.757

如果您想通过将像素坐标传递给函数来提取特定颜色的像素，这将派上用场：

```
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
function detectColor(x, y){
  data=ctx.getImageData(x, y, 1, 1).data;
  col={
    r:data[0],
    g:data[1],
    b:data[2]
  };
  return col;
} 
```

`x`,`y`是要滤除颜色的坐标。

```
var color = detectColor(x, y) 
```

颜色是对象，您将通过`color.r`, `color.g`,获得 RGB 值`color.b`。

# c# - 从 PInvoked OpenFileDialog (GetOpenFileName) 编组一个非托管的字符串数组

> ID：667049
> 
> 赞同：0
> 
> 时间：2009-03-20T17:00:33.783
> 
> 标签：c#, windows, pinvoke, marshalling, openfiledialog

OpenFileDialog 返回一个指向内存的指针，该指针包含一系列以 null 结尾的字符串，后跟 final null 以指示数组的结尾。

这就是我从非托管指针取回 C# 字符串的方式，但我确信必须有一种更安全、更优雅的方式。

```
 IntPtr unmanagedPtr = // start of the array ...
            int offset = 0;
            while (true)
            {
                IntPtr ptr = new IntPtr( unmanagedPtr.ToInt32() + offset );
                string name = Marshal.PtrToStringAuto(ptr);
                if(string.IsNullOrEmpty(name))
                    break;

                // Hack!  (assumes 2 bytes per string character + terminal null)
                offset += name.Length * 2 + 2;
            } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T17:29:44.213

你正在做的事情看起来很不错——我要做的唯一改变是使用`Encoding.Unicode.GetByteCount(name)`而不是`name.Length * 2`（它只是更明显的是发生了什么）。

`Marshal.PtrToStringUni(ptr)`此外，如果您确定非托管数据是 Unicode，则可能需要使用它，因为它消除了有关字符串编码的任何歧义。

# .net - 使用委托和声明事件

> ID：667050
> 
> 赞同：3
> 
> 时间：2009-03-20T17:00:43.160
> 
> 标签：.net, delegates, event-handling

我正在开发一个供其他开发人员使用的类库，并将允许他们使用 WithEvents（或其他语言中的类似方法）声明我的类的实例，并允许他们使用类中定义的委托。我只是在这里这样做是多余的吗？

```
Public Delegate Sub TimerElapsedDelegate(ByVal sender As Object, ByVal e As System.EventArgs)
Public Event TimerElapsed(ByVal sender As Object, ByVal e As System.EventArgs)
Private _TimerElapsed As TimerElapsedDelegate = Nothing 
```

还是我应该只声明事件并让它们执行 AddHandler 等？

感谢您对此的任何建议......我认为我是多余的，不想要毫无意义的代码，更不用说避免 DRY 原则。

{edit}只是想发布代码的其余部分，并强调此类实例执行的“工作”是在单独的线程上完成的。{/edit}

```
#Region "Delegates"
Public Delegate Sub TimerElapsedDelegate(ByVal sender As Object, ByVal e As System.EventArgs)
Public Event TimerElapsed(ByVal sender As Object, ByVal e As System.EventArgs)
Private _TimerElapsed As TimerElapsedDelegate = Nothing
Public Property OnTimerElapsed() As TimerElapsedDelegate
    Get
        Return _TimerElapsed
    End Get
    Set(ByVal value As TimerElapsedDelegate)
        If value Is Nothing Then
            _TimerElapsed = Nothing
        Else
            If _TimerElapsed Is Nothing Then
                _TimerElapsed = value
            Else
                _TimerElapsed = System.Delegate.Combine(_TimerElapsed, value)
            End If
        End If
    End Set
End Property
Private Sub TriggerTimerElapsed()
    If OnTimerElapsed IsNot Nothing Then
        OnTimerElapsed.Invoke(Me, New System.EventArgs)
    End If
    RaiseEvent TimerElapsed(Me, New System.EventArgs)
End Sub

Public Delegate Sub ItemReadyForQueueDelegate(ByVal sender As Object, ByVal e As System.EventArgs)
Public Event ItemReadyForQueue(ByVal sender As Object, ByVal e As System.EventArgs)
Private _ItemReadyForQueue As ItemReadyForQueueDelegate = Nothing
Public Property OnItemReadyForQueue() As ItemReadyForQueueDelegate
    Get
        Return _ItemReadyForQueue
    End Get
    Set(ByVal value As ItemReadyForQueueDelegate)
        If value Is Nothing Then
            _ItemReadyForQueue = Nothing
        Else
            If _ItemReadyForQueue Is Nothing Then
                _ItemReadyForQueue = value
            Else
                _ItemReadyForQueue = System.Delegate.Combine(_ItemReadyForQueue, value)
            End If
        End If
    End Set
End Property
Private Sub TriggerItemReadyForQueue(ByVal oItem As h3Budgeteer.FileSystem.ReportTemplateFile.ReportTemplate)
    If OnItemReadyForQueue IsNot Nothing Then
        OnItemReadyForQueue.Invoke(Me, New ItemReadyForQueueEventArgs(oItem))
    End If
    RaiseEvent ItemReadyForQueue(Me, New ItemReadyForQueueEventArgs(oItem))
End Sub
Public Class ItemReadyForQueueEventArgs
    Inherits System.EventArgs
    Private _ReportTemplate As h3Budgeteer.FileSystem.ReportTemplateFile.ReportTemplate = Nothing
    Public ReadOnly Property ReportTemplate() As h3Budgeteer.FileSystem.ReportTemplateFile.ReportTemplate
        Get
            Return _ReportTemplate
        End Get
    End Property
    Public Sub New(ByVal oReportTemplate As h3Budgeteer.FileSystem.ReportTemplateFile.ReportTemplate)
        _ReportTemplate = oReportTemplate
    End Sub
End Class 
```

# 结束区域

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-20T17:16:23.933

我想说完全删除你的代表。

您的代表正在做与事件完全相同的事情。您几乎是在编写自己的事件管道，而不是使用框架的事件调用。事件与您编写的内容几乎完全相同，只是它更易于使用，并且还可以更轻松地取消订阅该事件。

两者都提供没有任何好处 - 活动完成了您的“代表”所做的一切，并且更加清晰。

（之前：）

> 如果您将其开发为类库，我建议您不要密封您的类，并遵循更标准的方法。允许逻辑被覆盖或插入代码并允许事件的正常方法是提供子类化挂钩。
> 
> 可以在这种情况下使用委托，以允许用户插入自己的逻辑。然而，在许多情况下，拥有受保护的虚函数会使这一点更加清晰，并且更容易实现。
> 
> 事件应该就是这样，一个通知用户一些“事件”的事件。这些应该是用户附加其委托的钩子。
> 
> 例如，基本的 Windows 窗体控件不提供委托和事件，而是使用受保护的方法（即：OnMouseDown）和默认触发的事件（MouseDown）。
> 
> 这允许用户继承您的类并覆盖逻辑（这可能是您想要委托的原因）以及处理事件。
> 
> 我会提供委托的一个地方是在极少数情况下，您的类或方法需要用户添加逻辑。在这种情况下，您可以提供一个抽象基类，或者为该逻辑传递一个委托。一个很好的例子是 LINQ 中的 .Where() 方法。如果没有用于过滤的谓词，Where 是无用的，因此在这种情况下传递委托是有意义的。但请注意，没有与此相关的事件 - 它确实提供了不同的功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T17:14:17.980

对于您的类库，您只需要编写公共事件代码行。

```
Public Event TimerElapsed(ByVal sender As Object, ByVal e As System.EventArgs) 
```

当然，请确保在您图书馆的任何地方提出该事件。任何客户端开发人员都会为事件添加处理程序。

它不是多余的，只是没有必要，除非您的库要处理该类中的任何事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T17:27:08.480

[您可以使用通用 EventHandler](http://msdn.microsoft.com/en-us/library/db0etb8x.aspx)摆脱委托。您所要做的就是创建您自己的继承自 EventArgs 的类。

```
Public Class Foo
    Inherits EventArgs
End Class

Public Class Bar
    Public Event MyEvent As EventHandler(Of Foo)
End Class 
```

我不认为你是多余的。[请参阅此](https://stackoverflow.com/questions/9033/hidden-features-of-c)问题的第一个答案。添加一个空的事件处理程序将保证使用您的事件的人如果不想收听/处理事件，则在触发时不会收到 NullReferenceException。

-编辑-

看到你的代码后，我同意[Reed](https://stackoverflow.com/users/65358/reed-copsey)。由于它将是一个共享库，我认为*您*不需要执行使用者的事件处理程序。您图书馆的工作就是触发事件并让消费者知道发生了什么事。由他们来处理或不处理事件。

我会说你的属性是多余的。它们本质上是事件处理程序。

# asp.net - 在 ASP.NET 中实现 404 的最佳方法

> ID：667053
> 
> 赞同：37
> 
> 时间：2009-03-20T17:01:41.550
> 
> 标签：asp.net, http-status-code-404

我正在尝试确定在标准 ASP.NET Web 应用程序中实现 404 页面的最佳方式。我目前在 Global.asax 文件中的 Application_Error 事件中捕获 404 错误并重定向到友好的 404.aspx 页面。问题是请求看到 302 重定向，然后是 404 页面丢失。有没有办法绕过重定向并立即响应包含友好错误消息的 404？

如果对不存在页面的请求返回 302 后跟 404，Googlebot 等网络爬虫是否关心？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-03-20T20:36:26.557

在 Global.asax 的 OnError 事件中处理此问题：

```
protected void Application_Error(object sender, EventArgs e){
  // An error has occured on a .Net page.
  var serverError = Server.GetLastError() as HttpException;

  if (serverError != null){
    if (serverError.GetHttpCode() == 404){
      Server.ClearError();
      Server.Transfer("/Errors/404.aspx");
    }
  }
} 
```

在您的错误页面中，您应该确保正确设置状态代码：

```
// If you're running under IIS 7 in Integrated mode set use this line to override
// IIS errors:
Response.TrySkipIisCustomErrors = true;

// Set status code and message; you could also use the HttpStatusCode enum:
// System.Net.HttpStatusCode.NotFound
Response.StatusCode = 404;
Response.StatusDescription = "Page not found"; 
```

您还可以很好地处理此处的各种其他错误代码。

Google 通常会遵循 302，然后遵守 404 状态代码 - 因此您需要确保在错误页面上返回该代码。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-20T17:05:24.130

您可以使用 web.config 将 404 错误发送到自定义页面。

```
 <customErrors mode="RemoteOnly" defaultRedirect="GenericErrorPage.htm">
        <error statusCode="403" redirect="NoAccess.htm" />
        <error statusCode="404" redirect="FileNotFound.htm" />
    </customErrors> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-20T17:06:34.503

最简单的答案：不要在代码中这样做，而是[配置 IIS](http://www.xoc.net/works/404handler/default.asp)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-02-25T11:28:04.523

我也遇到了 302 而不是 404。我设法通过执行以下操作来修复它：

**控制器：**

```
public ViewResult Display404NotFoundPage()
        {
            Response.StatusCode = 404;  // this line fixed it.

            return View();
        } 
```

**看法：**

向用户显示一些错误消息。

**网络配置：**

```
<customErrors mode="On"  redirectMode="ResponseRedirect">
      <error statusCode="404" redirect="~/404NotFound/" />
</customErrors> 
```

**最后，RouthConfig：**

```
routes.MapRoute(
             name: "ErrorPage",
             url: "404NotFound/",
             defaults: new { controller = "Pages", action = "Display404NotFoundPage" }
         ); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-04-18T01:32:53.887

我真的很喜欢这种方法：它创建一个视图来处理所有错误类型并覆盖 IIS。

[1]：从 Web.config 中删除所有“customErrors”和“httpErrors”

[2]：检查 'App_Start/FilterConfig.cs' 看起来像这样：

```
public class FilterConfig
{
    public static void RegisterGlobalFilters(GlobalFilterCollection filters)
    {
        filters.Add(new HandleErrorAttribute());
    }
} 
```

[3]：在“Global.asax”中添加这个方法：

```
public void Application_Error(Object sender, EventArgs e)
{
    Exception exception = Server.GetLastError();
    Server.ClearError();

    var routeData = new RouteData();
    routeData.Values.Add("controller", "ErrorPage");
    routeData.Values.Add("action", "Error");
    routeData.Values.Add("exception", exception);

    if (exception.GetType() == typeof(HttpException))
    {
        routeData.Values.Add("statusCode", ((HttpException)exception).GetHttpCode());
    }
    else
    {
        routeData.Values.Add("statusCode", 500);
    }

    Response.TrySkipIisCustomErrors = true;
    IController controller = new ErrorPageController();
    controller.Execute(new RequestContext(new HttpContextWrapper(Context), routeData));
    Response.End();
} 
```

[4]：添加“控制器/ErrorPageController.cs”

```
public class ErrorPageController : Controller
{
    public ActionResult Error(int statusCode, Exception exception)
    {
        Response.StatusCode = statusCode;
        ViewBag.StatusCode = statusCode + " Error";
        return View();
    }
} 
```

[5]：在“视图/共享/Error.cshtml”中

```
@model System.Web.Mvc.HandleErrorInfo
@{
    ViewBag.Title = (!String.IsNullOrEmpty(ViewBag.StatusCode)) ? ViewBag.StatusCode : "500 Error";
}

 <h1 class="error">@(!String.IsNullOrEmpty(ViewBag.StatusCode) ? ViewBag.StatusCode : "500 Error"):</h1>

//@Model.ActionName
//@Model.ContollerName
//@Model.Exception.Message
//@Model.Exception.StackTrace 
```

:D

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-20T17:06:47.153

你在任何地方都用这个吗？

```
 Response.Status="404 Page Not Found" 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-20T17:38:48.967

我可以看到在 web.config 中设置 404 页面是一种很好的干净方法，但它最初仍会以 302 重定向响应错误页面。例如，如果您导航到：

[https://stackoverflow.com/x.aspx](https://stackoverflow.com/x.aspx)

您将通过 302 重定向重定向到：

[https://stackoverflow.com/404?aspxerrorpath=/x.aspx](https://stackoverflow.com/404?aspxerrorpath=/x.aspx)

我想要发生的是：

[http://www.cnn.com/x.aspx](http://www.cnn.com/x.aspx)

没有重定向。对丢失 URL 的请求会返回 404 状态代码和友好的错误消息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-20T17:05:06.940

您可以将 IIS 本身配置为返回特定页面以响应任何类型的 http 错误（包括 404）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-20T17:09:08.303

我认为最好的方法是使用 web.config 中的自定义错误构造，如下所示，这让您可以连接页面以简单有效的方式处理所有不同的 HTTP 代码。

```
 <customErrors mode="On" defaultRedirect="~/500.aspx">
     <error statusCode="404" redirect="~/404.aspx" />
     <error statusCode="500" redirect="~/500.aspx" />
  </customErrors> 
```

# c++ - DJGPP 的 fread 错误

> ID：667055
> 
> 赞同：0
> 
> 时间：2009-03-20T17:03:31.327
> 
> 标签：c++, c, file-io, djgpp

在 DOS 上使用 DJGPP 读取二进制文件时，此代码挂起。这发生在进行 fread 调用时。如果调用被删除，则程序成功运行。相同的代码在 Visual C++ 2008 中运行良好。有没有人遇到过与 djgpp 类似的问题？我错过了一些非常简单的东西吗？

```
char x; 
string Filename = "my.bin" ; 
fp = fopen(Filename.c_str(),"rb"); 

if (fp == NULL)
{
    cout << "File not found" << endl ; 
}

if (fseek (fp, 0, SEEK_END) != 0)
{
    cout <<"End of File can't be seeked"; 
    return -1; 
}

if ( (fileLength = ftell(fp)) == -1)
{
    cout <<"Can't read current position of file"; 
    return -1; 
}

if (fseek (fp, 0, SEEK_SET) != 0)
{
    cout <<"Beginning of File can't be seeked"; 
    return -1; 
} 

if (fread(&x,sizeof(x),1,fp) != sizeof(x))
{
    cout <<"file not read correctly"; 
    return -1; 
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-23T11:51:48.120

*   我不明白'fp'是什么。我只需要假设它是'FILE * fp;'。

*   我没有看到您实际上包含 < stdio.h >，并且必须假设您这样做。

*   我没有看到您实际上包含 <iostream> 并声明“使用命名空间 std;”，并且必须假设您这样做。

*   我看不到 fread() 调用之后会发生什么，它可以告诉你调用是否成功。

当一段代码让你目瞪口呆时，你首先*应该*做的第一件事是将你的错误代码减少到绝对但完全的最低限度以重现错误。

它可能（并且通常确实）证明问题甚至不在您认为的位置。

话虽如此，我会尝试更换

```
if (fread(&x,sizeof(x),1,fp) != sizeof(x))
{
    cout <<"file not read correctly"; 
    return -1; 
} 
```

和

```
int i;
if ( ( i = fgetc( fp ) ) == EOF )
{
    perror( "File not read correctly" );
    return -1;
}
x = (char) i;
cout << "Success, read '" << x << "'." << endl; 
```

使用 'perror()' 而不是自制的 cout 消息可以为您提供有关任何错误原因的更多信息。使用 'fgetc()' 将告诉您该文件确实包含您认为的内容，并且您的问题不是由于对单个字节使用 fread() 有点不常见。

然后回来汇报。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T17:11:13.883

[fread](http://www.cplusplus.com/reference/clibrary/cstdio/fread.html)将指针作为第一个参数。如果你只需要读入一个字符，`char x;`那很好，但要传递 x 的地址。

```
fread(&x,sizeof(x),1,fp) != sizeof(x) 
```

并且由于 sizeof char 始终为 1（根据定义），您可以很好地编写：

```
fread(&x,1,1,fp) != 1 
```

# c++ - C++：使用 boost::exception 的跨线程异常处理问题

> ID：667077
> 
> 赞同：4
> 
> 时间：2009-03-20T17:08:53.017
> 
> 标签：c++, multithreading, exception, boost, exception-handling

基本上，我遇到了这样一种情况，即一个线程引发了一个不同线程需要处理的异常。我正在尝试使用 boost 异常来执行此操作，但是在某处异常会丢失其类型，因此不会被 catch 块捕获。

基本上，线程 B 想要做某事，但是由于各种原因，它必须使用线程 A 完成（如果您想知道这些原因，请询问 MS 为什么必须由创建窗口的同一线程创建、重置和释放 Direct3d 9 设备）。如果在执行这些操作时发生异常，线程 A 会捕获它，并将其传递回线程 B，然后线程 B 会根据需要重新抛出它以进行处理。问题是线程 B 中抛出的异常似乎与线程 A 中抛出的异常不同。:(

我的程序的调试输出，代码如下。

```
0x776b42eb 处的第一次机会异常 ...: fllib::exception::Error at memory location 0x0019e590..  
0x776b42eb 处的第一次机会异常 ...：在内存位置 0x00000000 处 [重新抛出]..  
0x776b42eb 处的第一次机会异常 ...: boost::exception_detail::clone_impl<boost::unknown_exception> 在内存位置 0x0019eed4..

```

```
//thread B
...
try
{
    SendCallback(hwnd, boost::bind(&Graphics::create, this));
}
catch(fllib::exception::Error &except)//example catch block, doesnt catch example exception
{
    ...handle exception...
}

void SendCallback(HWND hwnd, boost::function<void()> call)
{
    boost::exception_ptr *except_ptr = 
        (boost::exception_ptr*)SendMessage(hwnd, WM_CALLBACK, (unsigned)&call, SEND);
    if(except_ptr)//if an exception occurred, throw it in thread B's context
    {
        boost::exception_ptr except = *except_ptr;
        delete except_ptr;
        boost::rethrow_exception(except);
    }
}
//thread A
LRESULT CALLBACK HookProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
{
    //check for our custom message
    if(msg == WM_CALLBACK)
    {
        if(lParam == POST)
        {
            ...
        }
        else
        {
            boost::function<void()> *call = (boost::function<void()>*)wParam;
            try
            {
                (*call)();
            }
            catch(...)
            {
                return (unsigned)new boost::exception_ptr(boost::current_exception());
            }
            return 0;
        }
    }
    else
    {
        ...
    }
}

void Graphics::create()
{
...code that may throw exceptions...
eg
    throw fllib::exception::Error(L"Test Exception...");
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T19:02:05.943

确保线程 A 的每次抛出都使用 boost::enable_current_exception 包装器。看到[这个](http://www.boost.org/doc/libs/1_38_0/libs/exception/doc/enable_current_exception.html)。

> “除非在抛出表达式中使用异常对象时调用 enable_current_exception，否则使用 current_exception 复制它的尝试可能会返回一个引用 unknown_exception 实例的 exception_ptr。”

为此，您可能需要捕获线程 A 中的所有异常，并在使用 throw boost::enable_current_exception(your_exception) 包装它们后重新抛出它们。

此外，这对于除零之类的结构化异常不起作用，除非您使用[_set_se_translator](http://msdn.microsoft.com/en-us/library/5z4bw5h5(VS.80).aspx)调用包装器并将它们包装在异常对象中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T23:58:45.307

我为自己的异常类型找到了解决方案。

Baiscly 我为我的所有异常类型添加了 2 个虚拟方法。

*   虚拟基地*克隆（）；克隆异常并在堆上返回一个新异常。这绕过了离开 catch 块时 origenall 被破坏的事实。
*   虚拟无效 ThrowAndDelete(); 这会生成堆分配的异常对象的本地副本，删除堆（以防止内存泄漏），然后抛出堆栈副本。这具有将 throw 作为最派生类型的优点。

这意味着我现在可以简单地做：

```
void SendCallback(HWND hwnd, boost::function<void()> call)
{
    fllib::exception::Base *except_ptr = 
        (fllib::exception::Base*)SendMessage(hwnd, WM_CALLBACK, (unsigned)&call, SEND);
    if(except_ptr) except_ptr->ThrowAndDelete();
}
LRESULT CALLBACK HookProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam)
{
    //check for our custom message
    if(msg == WM_CALLBACK)
    {
        if(lParam == POST)
        {
            ...
        }
        else
        {
            boost::function<void()> *call = (boost::function<void()>*)wParam;
            try
            {
                (*call)();
            }
            catch(fllib::exception::Base &except)
            {
                return (unsigned)except.Clone();
            }
            return 0;
        }
    }
    else
    {
        ...
    }
} 
```

我不确定如何处理 std:: 和 boost:: 各种异常，因为它们似乎没有上述效果的方法......但是 95% 以上的异常可能不会被处理之前是我自己的课程，而那些不是几乎可以肯定无论如何都不会处理的课程......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-14T06:54:29.860

1.  使用 BOOST_THROW_EXCEPTION 抛出异常。

2.  在线程中，catch(...)，然后调用 boost::current_exception 将异常（无论它可能是什么）填充到 boost::exception_ptr 中。

3.  将 exception_ptr 复制到主线程，然后调用 rethrow_exception。这将重新抛出 catch(...) 在线程中捕获的异常对象。

请参阅 www.boost.org/doc/libs/release/libs/exception/doc/tutorial_exception_ptr.html。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T19:30:02.753

我认为你有问题，因为没有用 boost 方式抛出异常。

您可以在挂钩过程中捕获线程 A 中的具体异常，将其复制到新对象中，返回指针..
检查 SendCallback 中的结果，如果结果存在（非 NULL）则抛出。
但是您应该确保如果没有异常，将始终返回 NULL。

# java - 相对于窗口大小将绘制的字符串居中？

> ID：667088
> 
> 赞同：1
> 
> 时间：2009-03-20T17:13:26.343
> 
> 标签：java, string, center

我正在尝试在 Java 中将使用 ""system", Font.BOLD, 90" 字体绘制的字符串居中。我试过 (width/2 - (font.size/2 * num_of_chars)) 但这没有用。

```
g2d.setFont(new Font("system", Font.BOLD, 90));
g2d.drawString("Pause", (int) ((800/2) - ((Font.getSize()/2) * 5)),270); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-20T17:18:12.027

使用[`getFontMetrics()`](http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html#getFontMetrics()). [`getStringBounds(String, Graphics)`](http://java.sun.com/javase/6/docs/api/java/awt/FontMetrics.html)使用当前字体获取字符串的边界。

所以它看起来像这样：

```
g2d.setFont(new Font("system", Font.BOLD, 90));
String msg = "Pause";
Rectangle2D bounds = g2d.getFontMetrics().getStringBounds(msg, g2d);
g2d.drawString(msg, (int) ((getWidth() + bounds.getWidth()) / 2), 270); 
```

# sql-server - Table Spool/Eager Spool

> ID：667093
> 
> 赞同：3
> 
> 时间：2009-03-20T17:14:32.020
> 
> 标签：sql-server, optimization

我有一个查询

```
select * into NewTab from OpenQuery(rmtServer, 'select c1, c2 from rmtTab') 
```

当我查看执行计划时，它告诉我它执行“表假脱机/急切假脱机”，“将数据存储在临时表中以优化倒带”

现在我预计不会有任何倒带。如果出现某种崩溃，我可以删除 newTab 并重新开始。

有什么办法可以阻止它将数据存储在临时表中？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-20T23:46:02.967

这可能是导致它的openquery。

没有关于多少行的信息，没有统计信息，什么都没有，所以 SQL Server 将简单地假脱机结果以允许它评估我怀疑的后面的位。这是基本的想法。

我建议将newtab的创建和填充分开。

顺便说一句，倒带不是回滚。Rewind 与交易安全无关。它是 SQL Server 预期重用行。这是正确的，因为 openquery 是一个黑匣子。

[查看这篇简单谈话文章](http://www.simple-talk.com/sql/performance/graphical-execution-plans-for-simple-sql-queries/)底部附近的倒带。您有一个“远程查询”。

**编辑**

基于我上周发现的一个东西，看看[sp_tableoption](http://msdn.microsoft.com/en-us/library/ms173530(SQL.90).aspx)。

> 当与 OPENROWSET 批量行集提供程序一起使用以将数据导入到没有索引的表中时，TABLOCK 使多个客户端能够通过优化的日志记录和锁定同时将数据加载到目标表中

尝试填满 TABLOCK。我们与使用 .net SQLBulkCopy 的客户端开发人员一起玩得很开心，但性能非常差。

这也是来自，[Kalen Delaney](http://sqlmag.com/t-sql/tame-bulky-inserts)

这不直观。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T18:00:53.857

首先创建 NewTab，然后从 openquery 插入到...。

# vba - Outlook根据类别自动更改提醒

> ID：667103
> 
> 赞同：2
> 
> 时间：2009-03-20T17:16:58.863
> 
> 标签：vba, outlook

我需要自动化 Outlook，以便当用户在约会中设置某个类别时，它会根据该类别自动设置提醒时间。

例如，用户具有“现场会议”类别和“场外会议”类别。他希望提醒时间自动更改为现场会议的 15 分钟和场外会议的 30 分钟。他明白，如果他错误地设置类别或同时应用这两个类别，时间将不会正确更改。

是否有可能做到这一点，如果可以，我该怎么做？我想当约会类别发生变化时，我可以捕捉和处理一个事件。

谢谢

编辑：约会请求是通过电子邮件收到的，他在接受会议请求时设置类别。每当类别发生变化时，都应设置提醒时间。如何连接到事件是我似乎找不到的部分。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T17:21:47.930

提醒时间的更改究竟应该在什么时候发生？最初组成会议的时间是什么时候？何时修改类别？

（例如，如果用户已经为提醒设置了一个值，然后更改了类别，提醒会改变吗？）

无论如何，我想解决方案是连接到 Outlook 中发生的一些事件，并根据您的逻辑设置这些值。但在回答上述问题之前，尚不清楚您需要连接哪些事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-03-03T14:06:55.517

您将需要 ItemAdd 和 ItemChange

[http://msdn.microsoft.com/en-us/library/office/ff869609(v=office.14).aspx](http://msdn.microsoft.com/en-us/library/office/ff869609(v=office.14).aspx)

[http://msdn.microsoft.com/en-us/library/office/ff865866(v=office.14).aspx](http://msdn.microsoft.com/en-us/library/office/ff865866(v=office.14).aspx)

像这样的东西：

```
Public Sub Application_Startup()
    Set objCalendar = Outlook.Session.GetDefaultFolder(olFolderCalendar).Items
End Sub

Private Sub objCalendar_ItemAdd(ByVal Item As Object)
    setReminder Item
End Sub

Private Sub objCalendar_ItemChange(ByVal Item As Object)
    setReminder Item
End Sub

Sub setReminder(ByVal Item As Object)
    If InStr(Item.Categories, "A")
        ' Set the reminder time A
        GoTo exitRoutine ' A the longer takes priority over B the shorter
    End If

    If InStr(Item.Categories, "B")
        ' Set the reminder time B
    End If

exitRoutine:

End Sub 
```

# c# - 关于using语句的一些高级问题

> ID：667111
> 
> 赞同：2
> 
> 时间：2009-03-20T17:18:19.157
> 
> 标签：c#, .net, idisposable

我知道这里有很多关于如何使用 using 语句和调用 Dispose() 方法的线程。我已经阅读了这些主题的大部分内容。

如果我调用 Dispose()，它会调用 Close() 吗？

如果我想使用一个对象（比如 SqlDataReader），然后在另一个代码块中再次使用它，我不应该调用 Dispose() 吗？这也意味着省略 using 语句。

此外，为了澄清，如果 FileStream 正在包装 StreamWriter 并且我在 FileStream 上调用 dispose，这将在 StreamWriter 上调用 Flush()、Close() 和 Dispose()（取决于 Dispose() 是否调用 Close()），对？同样，如果我在 FileStream 上调用 Close，这只会在 FileStream 上调用 Flush() 和 Close()。

检查 IL 是回答这些关于幕后发生的事情的好方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T17:24:04.790

“如果我调用 Dispose()，它会调用 Close() 吗？”

从理论上讲，它应该。BCL 类都执行此操作，但要由库作者正确处理此问题。如果您使用的库正确完成，Dispose() 也应该 Close() [并且 Close() 将 Dispose() - 调用应该是可互换的]。

“如果我想使用一个对象（比如 SqlDataReader），然后在另一个代码块中再次使用它，我应该不调用 Dispose() 吗？这也意味着省略 using 语句。”

正确的。如果使用 using 语句，它将始终调用 Dispose()。这将在您的其他块可以使用它之前关闭数据读取器。

“另外，澄清一下，如果 FileStream 正在包装 StreamWriter 并且我在 FileStream 上调用 dispose，这将在 StreamWriter 上调用 Flush()、Close() 和 Dispose()（取决于 Dispose() 是否调用 Close()） ，对吗？同样，如果我在 FileStream 上调用 Close，这只会在 FileStream 上调用 Flush() 和 Close()。

如果您将 FileStream 包装在 StreamWriter 周围，我强烈建议您始终如一地对待它们。对两个成员使用单个 using 语句，因此它们都在块的末尾被处理掉。这是最安全、最干净的方法。

“检查 IL 是回答这些关于幕后发生的事情的好方法吗？”

这是一种方式——虽然是一种更困难的方式。在 MSDN 上阅读有关使用和流的信息，文档将用比尝试解析 IL 更简单的术语来解释它。但是，如果您好奇的话，IL 会确切地告诉您会发生什么。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T17:24:31.090

> 如果我调用 Dispose()，它会调用 Close() 吗？

如果实施得当，Close() 和 Dispose() 会做同样的事情；这只是一个命名的东西。关闭文件比处理文件听起来更简单。请参阅[实施 Finalize 和 Dispose 以清理非托管资源，](http://msdn.microsoft.com/en-us/library/b1yfkh5e.aspx)尤其是“自定义 Dispose 方法名称”。

> 如果我想使用一个对象（比如 SqlDataReader），然后在另一个代码块中再次使用它，我应该不调用 Dispose() 吗？这也意味着省略 using 语句。

是的，因为对象在退出 using 块时被处置。

> 另外，澄清一下，如果 FileStream 正在包装 StreamWriter 并且我在 > FileStream 上调用 dispose，这将在 StreamWriter 上调用 Flush()、Close() 和 Dispose()（取决于 Dispos() 是否调用 Close()） ， 对？同样，如果我在 FileStream 上调用 Close，> 这只会在 FileStream 上调用 Flush() 和 Close()。

这是另一种方式；StreamWriter 基于底层流关闭 StreamWriter 关闭可能是 FileStream 的底层流；请参阅[MSDN](http://msdn.microsoft.com/de-de/library/system.io.streamwriter.close.aspx)以供参考。因此，StreamWriter 的单个 using 语句就足够了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T17:23:32.277

> 如果我调用 Dispose()，它会调用 Close() 吗？

Calling[`Dispose`](http://msdn.microsoft.com/en-us/library/system.idisposable.dispose.aspx)应该采取任何必要的操作来处理资源，这应该与 calling 相似，如果不完全相同的话[`Close`](http://msdn.microsoft.com/en-us/library/system.io.stream.close.aspx)。然而，这是一个实现细节，不一定能保证（尽管我们可以预期 BCL 遵循此指南）。

> 如果我想使用一个对象（比如 SqlDataReader），然后在另一个代码块中再次使用它，我不应该调用 Dispose() 吗？这也意味着省略 using 语句。

如果您想再次使用该对象，则绝对不应该丢弃它。但是，如果您要两次访问数据库，通常应该使用两个单独的连接。[将IDataReader](http://msdn.microsoft.com/en-us/library/system.data.idatareader.aspx)保持在比获取所需数据所需的时间更长的时间通常不是一个好主意。

> 此外，为了澄清，如果 FileStream 正在包装 StreamWriter 并且我在 FileStream 上调用 dispose，这将在 StreamWriter 上调用 Flush()、Close() 和 Dispose()（取决于 Dispose() 是否调用 Close()），对？同样，如果我在 FileStream 上调用 Close，这只会在 FileStream 上调用 Flush() 和 Close()。

处理包装另一个一次性对象`Dispose`的对象应该调用内部对象。调用`Close`a`FileStream`会调用它的`Dispose`方法，所以它也会作用于两个流。

> 检查 IL 是回答这些关于幕后发生的事情的好方法吗？

检查 IL 肯定会明确回答这些问题中的大部分。正如[@Rich](https://stackoverflow.com/questions/667111/some-advanced-questions-on-the-using-statement/667123#667123)所说，您也可以尝试调试自己的 Dispose 实现。当然，在您尝试自己弄清楚之前，还有 MSDN 文档可以开始，如果您不想在 IL 中乱七八糟，还可以使用 Reflector。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T17:24:44.833

> > 如果我调用 Dispose()，它会调用 Close() 吗？

不必要。我有时会使用 Reflector 来检查 Close 和 Dispose 中实际发生的情况。

> > 如果我想在另一个代码块中再次使用 (...) 它，我应该不调用 Dispose() 吗？

正确的。完成后调用 Dispose。**但这**并不意味着您总是希望让您的对象长时间保持活动状态 - 您有时可以从创建多个实例（多个`using`构造）中受益 - 例如，您可能希望尽快关闭连接，然后创建一个需要时再换新的。

正如您所说，这方面有很多资源，但我将包含一些指南的 MSDN 链接：[实现 Finalize 和 Dispose 以清理非托管资源](http://msdn.microsoft.com/en-us/library/b1yfkh5e(VS.71).aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T17:22:10.767

比通过 IL 代码进行调试更简单的方法是从 IDisposable 派生，覆盖除了调用之外什么都不做的必要方法`base.[Method Name]()`，并在每个方法中设置一个断点。然后，如果您将派生类包装在 using 块中，您将看到这些调用的生命周期。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-20T17:23:11.123

不，IDisposable 不需要 Close()，但实现 IDispose 的对象可能足够好，可以将它包含在 Dispose() 方法中。

您应该在获得从数据库中获取的数据后立即处理它。不要让阅读器打开超过您需要的时间。如果您正在对数据进行任何*实际*工作，请使用 dataAdapter/dataset 而不是阅读器。

不知道。检查生成的 IL

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-20T17:23:26.007

我尝试将 using 子句向上移动，因为我更喜欢使用该语法。然后从使用块内部使用该资源调用其他块。

# javascript - 为什么这会将元素移动 4 次？

> ID：667113
> 
> 赞同：2
> 
> 时间：2009-03-20T17:19:32.723
> 
> 标签：javascript, jquery, dom, browser, animation

为什么这行不通？我想要达到的效果是积木从左向右移动，并开始“推动”下一个积木。嵌套回调在外部元素上执行动画似乎是一个问题。

谁能解释一下？它有点工作，但一切都移动了太多次。

```
<html>
<head>
<style>
.item { width: 49px; height: 49px; border: 1px solid orange; background-color: #ccccff; }
#i0 { position: absolute; left: 0px; }
#i1 { position: absolute; left: 150px; }
#i2 { position: absolute; left: 200px; }
#i3 { position: absolute; left: 250px; }
#i4 { position: absolute; left: 400px; }
#i5 { position: absolute; left: 450px; }
</style>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script>
jQuery(function() {
  $("#i0").animate({left:"+=100"}, function() { 
    $("#i0,#i1,#i2,#i3").animate({left:"+=100"}, function() { 
      $("#i0,#i1,#i2,#i3,#i4,#i5").animate({left:"+=50"});
    });
  });
});
</script>
</head>
<body>  
  <div id="i0" class="item"></div>
  <div id="i1" class="item"></div>
  <div id="i2" class="item"></div>
  <div id="i3" class="item"></div>
  <div id="i4" class="item"></div>
  <div id="i5" class="item"></div>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T18:24:15.237

animate() 的第二个参数是动画完成时调用的回调。由于 $("#i0,#i1,#i2,#i3").animate(..) 动画 4 件事，它调用它的回调 4 次。像这样的方法可能有效：

```
function move(i, left, callback) {
  $("#i"+i).animate({left:left}, callback);
}

function sequence(n, left, callback) {
  return function() {
    var i = 0;
    for (; i < n; i++) {
      move(i, left);
    }
    move(i, left, callback);
  }
}

jQuery(function() { move(0, "+=100", sequence(3, "+=100", sequence(5, "+=100"))) }); 
```

# java - 序列化不存储对象数据，只存储对象引用

> ID：667117
> 
> 赞同：1
> 
> 时间：2009-03-20T17:20:22.957
> 
> 标签：java, serialization

我有一个由 Node 对象构建的节点树。它们比我展示的代码更复杂，但只有原始或可序列化的实例成员。

假设每个节点最多可以有 10 个子节点，代码看起来有点像这样。

```
public class Node implements Serializable{

    private static final long serialVersionUID = -848926218090221003L;

private Node _parent;
private boolean _hasParent;
private Node[] _children;
private int _childCount = 0;

public Node(Node parent){

    _children = new Node[10];
    _parent = parent;
    _hasParent = (parent != null);
}

    ...

    //Various accessors etc

} 
```

现在这棵树的构建非常昂贵，但是一旦完成，我就会将它写入一个文件：

```
ObjectOutputStream serializedOuput = new ObjectOutputStream(new FileOutputStream(cacheFile));
serializedOuput.writeObject(tree);
serializedOuput.close(); 
```

当我完成对树的缓存后，我会进行一些不可逆转的更改，例如修剪掉不需要的树枝。

然后，当我接下来需要一个基础树来工作时，我通过读取我的序列化文件来创建一个新的树对象。

问题...

从文件创建树似乎只是创建一个指向旧对象的新对象。换句话说，写入文件后所做的修改也已对新树进行。

如果我重新启动应用程序并尝试读取序列化文件，它将返回 null。

所以我似乎在序列化对象引用而不是对象本身，有什么想法会出错吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T17:45:54.627

为我工作，带有 gij 4.3.2 的 GNU/Linux。

确保 Node 类中的所有字段也是可序列化的。

这是我试过的代码（应该和你的一样）：

```
import java.io.*;

public class TestCase {
    public static void main(String[] args) {
        try {
            if (args.length > 0 && args[0].equals("read")) {
                ObjectInputStream ois = new ObjectInputStream(
                        new FileInputStream("File.log")
                    );
                Node root = (Node) ois.readObject();
                ois.close();

                System.out.println("Root value: " + root.getValue());
                for(Node n : root.children())
                    System.out.println("Child: " + n.getValue());

                return;
            }

            Node root = new Node(null, "First");
            root.add(
                    new Node(root, "Second.Child.1"),
                    new Node(root, "Second.Child.2")
                );

            ObjectOutputStream oos = new ObjectOutputStream(
                    new FileOutputStream("File.log")
                );
            oos.writeObject(root);
            oos.close();
        } catch(Exception e) {
            System.err.println(e.getMessage());
            e.printStackTrace();
        }
    }
}

class Node implements Serializable {
    private static final long serialVersionUID = 2304728943L;
    private Node _parent;
    private Node[] _children;
    private String _value;

    public Node(Node parent, String value) {
        this._parent = parent;
        this._value = value;
        this._children = new Node[2];
    }
    public void add(Node child, Node child2) {
        this._children[0] = child;
        this._children[1] = child2;
    }
    public String getValue() {
        return this._value;
    }
    public Node[] children() {
        return this._children;
    }
    public Node parent() {
        return this._parent;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T18:28:47.550

您可能正在做的一件事是将对象序列化，对其进行更改，然后将其序列化到同一个流中。您将需要重置流，否则处理非分层结构的逻辑将忽略您的更改。其他可能性是静态/单例或 readResolve 的奇怪使用。

# javascript - 加快 IE 中的多个鼠标悬停事件

> ID：667118
> 
> 赞同：1
> 
> 时间：2009-03-20T17:21:31.223
> 
> 标签：javascript, html, events, dom, browser

我有一个网页，上面有许多（最多 100 多个）html 元素。每个都注册了一个 onmouseover 事件来触发执行一些逻辑和渲染，具体取决于悬停在哪个元素上。

我发现在 IE 中，regitered 的 onmouseover 事件越多，它们触发的时间就越长。在 Firefox 中速度很好，在 Chrome 中更快！

有谁知道这个问题的解决方案。我想也许注册一个 onmousemove 事件并尝试从坐标中检索 DOM 元素，但我不确定如何执行此操作，或者它是否只是解决问题的一种手段。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T17:34:45.370

将 onmouseover 或 mousemove （我认为这两个气泡，不记得）事件附加到主体，当您将鼠标悬停在实际元素上时，您可以处理您需要做的事情，因为它会冒泡到您可以的主体处理您实际鼠标悬停的元素。您可以使用该元素的自定义属性或扩展属性来处理您需要在鼠标悬停时为特定元素执行的操作。

您实际上应该只在需要时附加事件，并在不再需要时分离它们。在琐碎的页面上，这可能不是必需的，但在像您这样的场景中，它将提高客户端性能。当我们在页面上有数千个表单元素时，我们曾经在我工作的地方做这样的事情。

我的两分钱，nickyt

# multithreading - 在临界区取消 (p) 线程

> ID：667124
> 
> 赞同：4
> 
> 时间：2009-03-20T17:22:34.900
> 
> 标签：multithreading, pthreads

我有一个运行多个线程的应用程序，这些线程有时会被取消。这些线程可能会调用另一个内部访问资源（套接字）的对象。为了防止同时访问资源，有一个关键部分可以在执行中获得一些顺序。

现在，当取消线程时，（有时）会发生线程正好在被临界区阻塞的代码中。临界区使用对象锁定，我希望在取消线程后，该对象将被破坏并因此释放锁定。然而，情况似乎并非如此，因此在线程销毁时，该资源对象被永久锁定。

更改资源对象可能不是一种选择（第 3 方交付），此外，防止同时访问无法并行使用的资源是有意义的。

我已经尝试过在该部分被锁定/解锁时使用 pthread_setcancelstate 来防止线程被取消，但是这确实感觉有点脏，并且不会成为其他情况的最终解决方案（例如获取互斥锁等）。

我知道首选的解决方案是不使用 pthread_cancel 而是在线程中设置一个标志，它会在准备好时自行取消（以干净的方式）。但是，由于我想尽快取消线程，我想知道（也是出于学术兴趣）是否还有其他选择。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T00:11:12.933

没有应用程序帮助（提到的标志）的线程取消是一个坏主意。只是[谷歌](http://www.google.com/search?hl=en&q=thread+cancellation+problem)。

实际上取消是如此困难，以至于在最新的 C++0x 草案中已将其省略。您可以搜索[http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2497.html](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2497.html)并且根本找不到任何取消的提及。这是提议的线程类的定义（你不会在那里找到取消）：

```
class thread
{
public:
    // types:
    class id;
    typedef implementation-defined native_handle_type; // See [thread.native]

    // construct/copy/destroy:
    thread();
    template <class F> explicit thread(F f);
    template <class F, class ...Args> thread(F&& f, Args&&... args);
    ~thread();
    thread(const thread&) = delete;
    thread(thread&&);
    thread& operator=(const thread&) = delete;
    thread& operator=(thread&&);

    // members:
    void swap(thread&&);
    bool joinable() const;
    void join();
    void detach();
    id get_id() const;
    native_handle_type native_handle(); // See [thread.native]

    // static members:
    static unsigned hardware_concurrency();
}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-23T11:11:08.243

您可以使用 pthread_cleanup_push() 将取消清理处理程序推送到线程取消清理堆栈上。该处理程序将负责解锁关键部分。

离开临界区后，您应该调用 pthread_cleanup_pop(0) 将其删除。

IE

```
CRIITICAL_SECTION g_section;

void clean_crit_sec( void * )
{
    LeaveCriticalSection( &g_section )
}

void *thrfunc( void * )
{
    EnterCriticalSection( &g_section );
    pthread_cleanup_push( clean_crit_sec, NULL );

    // Do something that may be cancellable

    LeaveCriticalSection( &g_section );
    pthread_cleanup_pop( 0 );
} 
```

这仍然会留下一个小的竞争条件，其中关键部分已被解锁，但如果线程在 Leave.. 和 cleanup_pop 之间取消，则仍可以执行清理处理程序。

您可以使用 1 调用 pthread_cleanup_pop ，这将执行您的清理代码，而不是自己解除临界区。IE

```
CRIITICAL_SECTION g_section;

void clean_crit_sec( void * )
{
    LeaveCriticalSection( &g_section )
}

void *thrfunc( void * )
{
    EnterCriticalSection( &g_section );
    pthread_cleanup_push( clean_crit_sec, NULL );

    // Do something that may be cancellable

    pthread_cleanup_pop( 1 );  // this will pop the handler and execute it.
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T11:43:51.227

在不使用定义良好的控制方法（即标志）的情况下中止线程的想法是如此邪恶，以至于您根本不应该这样做。

如果你有第三方代码，除了这样做你别无选择，我可能会建议在进程中抽象出可怕的代码，然后与进程交互，很好地分离每个这样的组件。

现在，这样的设计在windows上会更糟，因为windows不擅长运行多个进程，但在linux上这并不是一个坏主意。

当然，为您的线程模块进行明智的设计会更好......

（就个人而言，我更喜欢根本不使用线程，总是使用进程，或者非阻塞设计）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T18:01:41.967

如果控制临界区的锁没有直接暴露给你，你无能为力。当您取消一个线程时，该线程的所有清理处理程序都以正常的相反顺序执行，但当然这些处理程序只能释放您有权访问的互斥锁。因此，除了在访问 3rd 方组件期间禁用取消之外，您真的无能为力。

我认为您最好的解决方案是*同时*使用标志*和*pthread_cancel 功能。当您进入第 3 方组件时，禁用取消处理 (PTHREAD_CANCEL_DISABLE)；当你退出它时，重新启用它。重新启用后，检查标志：

```
/* In thread which you want to be able to be canceled: */
int oldstate;
pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, &oldstate);
... call 3rd party component ...
pthread setcancelstate(oldstate, NULL);
if (cancelled_flag) pthread_exit(PTHREAD_CANCELED);

/* In the thread canceling the other one. Note the order of operations
   to avoid race condition: */
cancelled_flag = true;
pthread_cancel(thread_id); 
```

# ruby-on-rails - Rails 在视图中编辑 HTML

> ID：667125
> 
> 赞同：1
> 
> 时间：2009-03-20T17:22:38.240
> 
> 标签：ruby-on-rails, views

我正在做*Head-First Rails*的教程（通过 Safari Online），并且无法编辑 HTML 以显示在浏览器中（我的意思是更改）。具体来说，我只是将其中一列的标签从“Seat seq id”更改为“Seat #”。我已经打开了四个视图文件，edit、index、new 和 show.html.erb。到处都有一个 'f.label :seat_id_seq' 我把它改成了 'f.label "Seat #"'。对于表头，我已将 Seat # 放入**标签。我已经保存了文件并刷新了浏览器（甚至重新启动了服务器），但所有视图仍然有 Seat id seq。**

 **我错过了什么？我检查了勘误表，但没有任何相关内容。

编辑#7：请注意，这是由于 Rails 2.3.2 与 Vim 补丁模式和/或备份文件的使用不兼容，所以没有一个被赞成的答案是正确的。我把它放在这里，这样你就可以找到正确的解决方案，而不必费力地浏览所有帖子。

编辑#1：routes.rb 的内容

```
ActionController::Routing::Routes.draw do |map|
  map.resources :tickets
  map.connect ':controller/:action/:id'
  map.connect ':controller/:action/:id.:format'
end 
```

编辑#2：我在 Vista 上使用 gvim 进行编辑（没有选择）。

编辑#3：似乎没有在开发模式下启动。但是不应该重新启动服务器来解决这个问题吗？

编辑#4：杂种输出：

```
C:\Users\kathyj\Desktop\tickets>ruby script/server -e development
=> Booting Mongrel
=> Rails 2.3.2 application starting on http://0.0.0.0:3000
=> Call with -d to detach
=> Ctrl-C to shutdown server 
```

编辑#5：重新启动浏览器没有帮助。

编辑#6 @Sarah Mei：

```
<h1>New ticket</h1>

<% form_for(@ticket) do |f| %>
  <%= f.error_messages %>

  <p>
    <%= f.label :name %><br />
    <%= f.text_field :name %>
  </p>
  <p>
    <%= f.label :seat_id_seq, "Seat #" %><br />
    <%= f.text_field :seat_id_seq %>
  </p>
  <p>
    <%= f.label :address %><br />
    <%= f.text_area :address %>
  </p>
  <p>
    <%= f.label :price_paid %><br />
    <%= f.text_field :price_paid %>
  </p>
  <p>
    <%= f.label :phone %><br />
    <%= f.text_field :phone %>
  </p>
  <p>
    <%= f.label :email_address %><br />
    <%= f.text_field :email_address %>
  </p>
  <p>
    <%= f.submit 'Create' %>
  </p>
<% end %>

<%= link_to 'Back', tickets_path %> 
```

该字段仍然显示 Seat id seq。

@Mark Robinson：在浏览器刷新时未选择更改 New Ticket 标头。此外，我没有得到你所做的所有 Mongrel 输出，我注意到我使用的是更新版本的 Rails。

注意我的 Rails 体验应该以小时而不是天来衡量。

@Ghoti：（1）Ctrl-F5 没有区别。正如 vrish88 建议的那样，我还关闭了缓存。(2) 我将您的 <%= nil.fail %> 推到了名称字段的 f.label 正上方的 app\views\tickets\new.html.erb 中，但它的显示与以往一样。我什至尝试过使用 IE；一切正常，但我所做的任何更改都没有出现。(3) 我找到了log\development.log，但我不知道你在找什么。它有很多处理和渲染行，并显示了一些迁移。添加列的迁移不会显示在视图中。创建另一个表的迁移，我可以看到它的页面。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T17:50:02.450

确保 rails 处于开发模式。当您运行脚本/服务器时，您会看到下面的行。Mongrel 启动输出如下。

```
=> Booting Mongrel (use 'script/server webrick' to force WEBrick)
=> Rails 2.2.2 application starting on http://0.0.0.0:3000
=> Call with -d to detach
=> Ctrl-C to shutdown server
** Starting Mongrel listening at 0.0.0.0:3000
** Starting Rails with development environment...
** Rails loaded.
** Loading any Rails specific GemPlugins
** Signals ready.  TERM => stop.  USR2 => restart.  INT => stop (no restart).
** Rails signals registered.  HUP => reload (without restart).  It might not work well.
** Mongrel 1.1.5 available at 0.0.0.0:3000
** Use CTRL-C to stop. 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T20:24:21.003

我认为这是浏览器缓存。尝试按 ctrl-F5 而不是 F5。

呈现页面时日志中出现了什么？

如果您想确保正在重新加载模板，请在其中放入容易出错的内容并查看是否出现异常屏幕，例如 <%= nil.fail %>。如果它没有失败，那么它不会被重新加载。这可能与您机器上的时间戳有关，开发模式会查看时间戳以查看需要重新加载的内容。

标签命令是正确的。我建议下载[Rails Brain](http://www.railsbrain.com/)和[Ruby Brain](http://www.rubybrain.com/)，这样你就可以拿到文档并直接使用它。文件说

标签（对象名称，方法，文本 = nil，选项 = {}）

因为您处于表单助手中（使用块参数 f），所以假定对象名称参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T18:49:04.647

我会尝试重新启动浏览器。除非您在 Rails 应用程序中明确打开缓存，否则服务器本身不应缓存内容。

我在使用 Firefox 时遇到了这个问题，我必须每隔一段时间重新启动浏览器才能看到更改。但是有一种方法可以告诉 Firefox 停止缓存内容。签出：[关闭缓存](https://stackoverflow.com/questions/289751/turn-off-caching-for-javascript-files-on-firefox)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T17:37:04.773

我要检查的第一个地方是 routes.rb 文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T17:42:01.890

也许这些页面是由 Rails 或您的浏览器缓存的？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-20T18:05:43.160

[该`label`方法](http://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#M001574)采用指定文本的可选参数。

```
f.label :seat_id_seq 
```

隐式扩展为

```
f.label :my_model, :seat_id_seq 
```

如果它被指定模型的 form_for 标记包围。因此，您需要做的就是将文本参数添加到您的调用中。

```
f.label :seat_id_seq, "Seat #"
# => <label for="seat_id_seq">Seat #</label> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-20T20:09:38.370

我从未使用过`f.label`样式助手，但您所做的似乎是正确的。如果您：

1.  自己写一个标签标签，在 HTML 中：`<label for="seat_id_seq">Seat #:</label>`
2.  `label`按如下方式使用：`<%= label 'ticket', 'seat_id_seq', 'Seat #' %>` 参见[label](http://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#M001574)和[label_tag](http://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html#M001700)。

确保您实际上正在编辑您需要的视图。也许您在其他目录中也有编辑、显示等视图。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-20T22:40:58.660

我将 rails gem 降级到 2.1.2，我的代码运行良好。

编辑：显然 Rails 跟踪要显示哪些视图文件的方式发生了一些变化[（请参阅此处的各种解释）](http://groups.google.com/group/rubyonrails-core/browse_thread/thread/6d887ac76ec07a39)。我只是在进行了一些试错测试后才找到该链接，并发现如果我删除了我已将 Vim 配置为自动制作的备份和补丁模式文件，*然后*重新启动服务器，我的更改会在使用 v. 2.3 时被拾取.2.

我已经更改了我的 .vimrc 以便不再制作这些文件（.swp 文件不会导致问题）。这些其他文件仅在视图目录中存在问题。我专门在控制器目录中进行了测试，并且对补丁文件的存在没有任何困难。现在我可以对视图进行更改，只需简单的刷新 (F5) 即可立即获取它们。

# html - 如何使用 Perl 正则表达式删除未使用的嵌套 HTML span 标签？

> ID：667130
> 
> 赞同：4
> 
> 时间：2009-03-20T17:23:53.353
> 
> 标签：html, regex, perl

我正在尝试从 HTML 文件中删除未使用的跨度（即没有属性的跨度），已经清理了所有我不想要的其他正则表达式的属性。

我的正则表达式有问题，没有选择正确的开始和结束标签对来删除。

```
my $a = 'a <span>b <span style="color:red;">c</span> d</span>e';
$a =~ s/<span\s*>(.*?)<\/span>/$1/g;
print "$a\ 
```

返回

```
a b <span style="color:red;">c d</span>e 
```

但我希望它回来

```
a b <span style="color:red;">c</span> de 
```

帮助表示赞赏。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-20T18:41:38.720

尝试[HTML::Parser](http://search.cpan.org/perldoc?HTML::Parser)：

```
#!/usr/bin/perl

use strict;
use warnings;

use HTML::Parser;

my @print_span;
my $p = HTML::Parser->new(
  start_h   => [ sub {
    my ($text, $name, $attr) = @_;
    if ( $name eq 'span' ) {
      my $print_tag = %$attr;
      push @print_span, $print_tag;
      return if !$print_tag;
    }
    print $text;
  }, 'text,tagname,attr'],
  end_h => [ sub {
    my ($text, $name) = @_;
    if ( $name eq 'span' ) {
      return if !pop @print_span;
    }
    print $text;
  }, 'text,tagname'],
  default_h => [ sub { print shift }, 'text'],
);
$p->parse_file(\*DATA) or die "Err: $!";
$p->eof;

__END__
<html>
<head>
<title>This is a title</title>
</head>
<body>
<h1>This is a header</h1>
a <span>b <span style="color:red;">c</span> d</span>e
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-20T17:57:36.753

正则表达式不足以解析 HTML（或 XML）。您可以提出的任何正则表达式都无法匹配有效 HTML 的各种公式（更不用说现实世界的标签汤了）。

这是一个嵌套问题。正则表达式通常根本无法处理嵌套，但是 Perl 有一个非标准扩展来支持正则表达式递归：(?n)，其中 n 是要递归到的组号。因此，在您的示例中，这样的内容将匹配两个跨度：

```
(<span[^>]*>.*+(?1)?.*+<\/span>) 
```

见[perlfaq 6.11](http://faq.perl.org/perlfaq6.html#Can_I_use_Perl_regul)。

不幸的是，这仍然不够，因为它需要能够同时计算归属和未归属的 <span> 开始标签，从而允许 </span> 结束标签关闭其中任何一个。如果不匹配属性跨度开始标签，我想不出一种方法。

为此，您需要一个 HTML 解析器，并且无论如何您都应该使用它，因为 HTML/XML 的正则表达式显然是错误的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-20T17:54:33.810

不要使用正则表达式处理 (HTML ==) XML。你永远不知道你会得到什么输入。考虑一下，有效的 HTML：

```
a <span>b <span style="color:red;" title="being closed with </span>">c</span> de 
```

你会想到吗？

请改用 XML 处理器。

另请参阅您的问题的*相关*问题（右侧）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-23T16:29:54.473

在您的帮助下，我发布了一个脚本，可以满足我的一切需求。

[http://github.com/timabell/decrufter/](http://github.com/timabell/decrufter/)

# asp.net - 在交替的彩色行gridview中选择整行

> ID：667131
> 
> 赞同：2
> 
> 时间：2009-03-20T17:23:55.320
> 
> 标签：asp.net, gridview, row, highlighting

我有一个具有交替行颜色的 Gridview，并且希望在单击该行的任意位置时突出显示该行。不幸的是，我找到并正在使用的代码将较深的颜色阴影应用于先前单击的行。例如，如果在 4 行 gridview 中，2 和 4 是银色阴影，而其他 2 是白色。如果我单击第 1 行，然后单击第 4 行，第 1 行现在是银色阴影。如果我单击任何其他行，也会发生这种情况。这是我的代码：

```
protected void CCAGridView_OnRowCreated(object sender, GridViewRowEventArgs e)
    {
        if (e.Row.RowType == DataControlRowType.DataRow)
            e.Row.Attributes.Add("onclick", "HilightRow(this)");
    }

<asp:GridView ID="GridView" runat="server"  HeaderStyle-Width="200" HeaderStyle-BackColor="#2B6292" HeaderStyle-ForeColor="White" 
    AllowSorting="true" AllowPaging="true" Width="600" AutoGenerateColumns="False" OnRowCreated="GridView_OnRowCreated" 
    DataKeyNames="Id" AlternatingRowStyle-BackColor="Silver" BorderColor="#2B6292" BorderWidth="1" BorderStyle="solid">
        <Columns>
         ...
        </Columns>
    </asp:GridView> 
```

任何帮助，将不胜感激。谢谢。

另外，谁能帮我找到突出显示的行，服务器端？就像一个选择。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T19:29:45.217

好吧，假设您知道主键，我可以帮助您找到选定的行。在您的 RowDataBound 事件中，您可以获得 DataItem（将其转换为真实类型），然后将其与您正在寻找的值进行比较（然后突出显示它）。我不得不关闭alternatingRowSTyle 才能完成这项工作。对此了解不多。

protected void Page_Load(object sender, EventArgs e) { GridViewCompany.AlternatingRowStyle.Reset(); GridViewCompany.SelectedRowStyle.Reset(); }

```
 protected void GridViewCompany_RowDataBound(object sender, GridViewRowEventArgs e)
    {
        int selectedCompanId = Convert.ToInt32(StateService.I.Get(CookieIdType.CompanySelected));
        if (e.Row.RowType == DataControlRowType.DataRow)
        {
            var userResult = e.Row.DataItem as CompanyResult;
            if (userResult != null)
            {
                if (userResult.Id == selectedCompanId)
                {
                    e.Row.BackColor = Color.LightGray;
                }
            }
        }
    } 
```

# sql - 什么时候不应该使用关系数据库？

> ID：667141
> 
> 赞同：73
> 
> 时间：2009-03-20T17:25:24.987
> 
> 标签：sql, database, nosql, relational-database

除了 google/bigtable 场景，什么时候不应该使用关系数据库？为什么不，你应该使用什么？（你学会了“艰难的方式”吗？）

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-20T19:41:21.667

根据我的经验，当以下任何一个条件为真时，您不应该使用关系数据库：

*   您的数据被结构化为任意深度的层次结构或图形（网络），
*   典型的访问模式强调读而不是写，或者
*   不需要临时查询。

深层层次结构和图表不能很好地转换为关系表。即使在 Oracle 等专有扩展的帮助下`CONNECT BY`，使用 SQL 查找树也是一件非常痛苦的事情。

关系数据库为简单的读取访问增加了很多开销。事务完整性和引用完整性很强大，但对于某些应用程序来说太过分了。因此，对于以读取为主的应用程序，文件隐喻就足够了。

最后，如果没有预期的意外查询，您根本不需要具有成熟查询语言的关系数据库。如果没有西装询问诸如“我们在东海岸按销售人员分组销售了多少 5% 折扣的蓝色小部件？”之类的问题，而且永远不会有，那么先生，您可以摆脱 DB。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-03-20T18:21:21.657

关系数据库范式对数据的使用做出了一些假设。

*   关系由一组无序的行组成。
*   关系中的所有行都具有相同的列集。
*   每列在所有行上都有固定的名称和数据类型和语义含义。
*   关系中的行由主键列中的唯一值标识。
*   等等

这些假设支持简单性和结构，但牺牲了一些灵活性。并非所有数据管理任务都适合这种结构。例如，具有复杂属性或可变属性的实体不会。如果您在关系数据库解决方案不支持的领域需要灵活性，您需要使用不同类型的解决方案。

还有其他解决方案可用于管理具有不同要求的数据。例如，语义 Web 技术允许每个实体定义自己的属性并进行自我描述，方法是将元数据视为属性，就像数据一样。这比关系数据库强加的结构更灵活，但这种灵活性是有代价的。

总体而言，您应该为每项工作使用正确的工具。

另请参阅我对“[下一代数据库](https://stackoverflow.com/questions/282783/the-next-gen-databases/282813#282813)”的其他回答。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2010-03-23T00:33:11.360

有三个主要数据模型（CJDate、EFCodd），我正在向其中添加一个平面文件：

*   平面文件（结构各不相同 - 从“愚蠢的”平面文本到符合语法的文件，加上聪明的工具可以做非常聪明的事情，想想编译器和他们能做什么，缩小在建模新事物中的应用）
*   [分层](http://en.wikipedia.org/wiki/Hierarchical_data_model)（树，嵌套集 - 示例：xml 和其他标记语言，注册表，组织结构图等；任何东西都可以建模，但完整性规则不容易表达，检索难以自动优化，有些检索很快，有些检索非常慢 ）
*   [网络](http://en.wikipedia.org/wiki/Network_data_model)（网络、图形 - 示例：导航数据库、超链接、语义网，几乎任何东西都可以建模，但检索的自动优化是个问题）
*   [关系](http://en.wikipedia.org/wiki/Relational_data_model)（一阶谓词逻辑 - 示例：关系数据库，检索的自动优化）

层次和网络都可以用关系表示，而关系可以用其他两种表示。

[关系被认为“更好”的原因不仅在于数据检索语言，而且在于数据定义语言的声明性和标准化，包括强大的声明性数据完整性，以稳定](http://en.wikipedia.org/wiki/ACID)、可扩展、多用户管理系统为后盾。

好处是有代价的，大多数项目认为这对于存储长期数据的系统（多应用程序）来说是一个很好的比例，可以在可预见的未来使用。

如果您不是在构建系统，而是在构建单个应用程序，可能是针对单个用户，并且您相当确定您不会希望多个应用程序使用您的数据，也不会希望多个用户，那么您可能会很快找到更快的方法.

此外，如果您不知道要存储什么样的数据以及如何对其建模，那么关系模型的优势就会被浪费在上面。

或者，如果您根本不关心数据的完整性（这很好）。

所有数据结构都针对某种用途进行了优化，只有在适当建模的情况下才会尝试以语义无偏见的方式表示“现实”。对关系数据库体验不佳的人通常不会意识到他们使用其他类型的数据模型的体验会更糟。可怕的实现是可能的，尤其是关系数据库，在其中构建复杂的模型相对容易，你最终可能会得到一个相当大的怪物。当我尝试在 xml 中想象同一个怪物时，我总是感觉更好。

IMO 关系模型有多好的一个例子是您会发现涉及 SQL 的问题的复杂性与简短性的比率。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-03-20T17:31:11.260

我建议您访问[High Scalability 博客](http://highscalability.com/)，该博客几乎每天都在讨论这个主题，并且有许多关于选择分布式哈希等项目而不是 RDMBS 的文章。

快速（但非常不完整的答案）是并非所有数据都能以有效的方式很好地转换为表格。例如，如果您的数据本质上是一本大字典，那么可能有比普通的旧 RDBMS 更快的替代方案。话虽如此，这主要是性能问题，如果性能不是项目中的一个大问题，例如稳定性、一致性和可靠性，那么我认为深入研究这些技术没有多大意义。 RDBMS 是一个更加成熟和完善的方案，支持所有语言和平台以及可供选择的大量解决方案。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-20T17:31:15.647

十五年前，我正在研究信用风险系统（基本上是一个大树行走系统）。我们在 HPUX 和 solaris 上使用 Sybase，性能让我们感到很沮丧。我们直接从 Sybase 聘请了顾问，他们说无法做到。然后我们切换到 OO 数据库（在本例中为对象存储）并获得了大约 100 倍的性能提升（并且代码也更容易编写 100 倍）

但这种情况很少见——关系数据库是一个不错的首选。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-03-20T20:37:07.587

当您的架构变化很大时，您将很难使用关系数据库。这是 XML 数据库或键值对数据库最适合的地方。或者您可以使用 IBM DB2 并让关系数据和 XML 数据由单个数据库引擎管理。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-20T19:50:48.290

大约 7 到 8 年前，我在一个网站上工作，该网站的受欢迎程度超出了我们最初的预期，这让我们在性能方面遇到了麻烦。由于我们在基于 Web 的项目方面都相对缺乏经验，这给我们带来了很大的压力，除了通常的数据库分离到单独的服务器、负载平衡等之外，我们还需要做什么。

有一天，我想到了一件很简单的事情。由于网站是基于用户的，他们的个人资料以人们通常的方式存储在数据库表中 - 用户 ID、大量信息变量和类似的东西 - 这将显示为其他用户可以查找的用户个人资料页面. 我已经将所有数据刷新到一个简单的 html 文件中，该文件已经准备好作为用户个人资料页面并得到显着提升 - 基本上是一个缓存。我什至制作了一个系统，当用户编辑他们的个人资料信息时，它会解析原始 html 文件，将其提交编辑，然后将 html 刷新回文件系统 - 得到了更大的提升。

我做了一些与用户相互发送的消息类似的东西。基本上，只要我可以让系统完全绕过数据库，避免 INSERT 或 UPDATE，我就得到了显着的提升。这听起来像是常识，但这是一个启发性的时刻。这不是避免关系设置本身，而是完全避免数据库 - KISS。

# security - 黑客和利用 - 您如何处理发现的任何安全漏洞？

> ID：667147
> 
> 赞同：26
> 
> 时间：2009-03-20T17:28:17.617
> 
> 标签：security, exploit

今天，在线安全是一个非常重要的因素。许多企业完全基于在线，只有使用网络浏览器才能查看大量敏感数据。

寻求知识来保护我自己的应用程序 我发现我经常测试其他应用程序的漏洞利用和安全漏洞，也许只是出于好奇。随着我通过测试自己的应用程序、阅读零日漏洞以及阅读[《Web 应用程序黑客手册：发现和利用安全](http://eu.wiley.com/WileyCDA/WileyTitle/productCd-0470170778.html)漏洞》一书扩展了我在该领域的知识，我开始意识到大多数在线 Web 应用程序确实是暴露了很多安全漏洞。

所以你会怎么做？我没有兴趣破坏或破坏任何东西，但我最大的黑客“突破”我决定提醒页面的管理员。我的询问很快被忽略了，安全漏洞还没有修复。他们为什么不想修复它？多久会有一个心怀不轨的人闯入旅馆并选择摧毁一切？

我想知道为什么这些天没有更多地关注这一点，而且我认为在实际提供测试 Web 应用程序的安全漏洞方面会有很多商机。是只有我有太大的好奇心，还是有其他人有同样的经历？在挪威，实际尝试闯入网页是受到法律惩罚的，即使您只是检查源代码并在那里找到“隐藏密码”，使用它进行登录，您已经触犯了法律。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-20T17:51:41.087

我曾经在一家在线有声读物商店中报告了一个严重的身份验证漏洞，该漏洞允许您在登录后切换帐户。如果我应该报告这个，我也很谨慎。因为在德国，黑客行为也是法律禁止的。所以我匿名报告了这个漏洞。

答案是，虽然他们无法自己检查这个漏洞，因为该软件是由母公司维护的，但他们很高兴我的报告。

后来我得到了回复，他们确认了该漏洞的危险性，并且现在已修复。他们想再次感谢我提供这份安全报告，并为我提供了 iPod 和有声读物积分作为礼物。

所以我相信报告漏洞是正确的方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-23T13:33:44.880

“我发现我经常测试其他应用程序的漏洞利用和安全漏洞，也许只是出于好奇”。

在英国，我们有“计算机滥用法”。现在，如果众所周知，您“查看”的这些应用程序是基于 Internet 的，并且 ISP 的相关人员可能会费心进行调查（出于纯粹的政治动机），那么您就会敞开心扉，受到指责。除非你是英国广播公司，否则即使做最轻微的“测试”也足以让你在这里被定罪。

即使是渗透测试机构也需要希望进行正式工作以为其系统提供安全保证的公司的签字。

为了对报告漏洞的难度设定预期，我曾与实际雇主进行过此操作，其中提出了一些非常严重的问题，人们已经坐了几个月，从品牌受损到完全关闭运营以支持每年£ 100m 电子商务环境。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-20T17:32:26.033

我通常会联系网站管理员，尽管回复几乎总是“天哪，你破坏了我的 javascript 页面验证，我会起诉你”。

人们只是不喜欢听到他们的东西坏了。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-20T17:35:25.650

通知管理员是最好的做法，但有些公司就是不会接受不请自来的建议。他们不相信或不相信消息来源。

有些人会建议您以破坏性的方式利用安全漏洞来引起他们对危险的注意，但我建议您不要这样做，您可能会因此而产生严重后果。

基本上，如果您已通知他们，这不再是您的问题（不是一开始就存在）。

确保您引起他们注意的另一种方法是提供有关如何利用它的具体步骤。这样一来，任何收到电子邮件的人都可以更轻松地对其进行验证，并将其传递给合适的人。

但是最后，你什么都不欠他们，所以你选择做的任何事情都是伸出你的脖子。

此外，您甚至可以为自己创建一个新的电子邮件地址来提醒网站，因为正如您所提到的，有些地方甚至验证漏洞利用都是非法的，有些公司会选择追捕您而不是安全漏洞.

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-20T17:40:06.637

如果它不会影响很多用户，那么我认为通知站点管理员是您最多可以做的事情。如果漏洞利用具有广泛的后果（如 Windows 安全漏洞利用），那么您应该通知有能力解决问题的人，然后在您发布漏洞利用之前*给他们时间修复它*（如果发布它是您的意图）。

很多人对漏洞利用发布感到哭泣，但有时这是获得回应的唯一途径。请记住，如果您发现了一个漏洞利用，那么很可能是不那么利他的人发现了它并已经开始利用它。

**编辑：**在发布任何可能损害公司声誉的内容之前，请咨询律师。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-20T17:38:03.633

我和你一样经历过。我曾经在一家 oscommerce 商店中发现了一个漏洞，您可以在该商店中免费下载电子书。我写了两封邮件：1）oscommerce的开发人员，他们回答“已知问题，不要使用这个paypal模块，我们不会修复”2）商店管理员：根本没有答案

实际上我不知道什么是最好的行为方式......甚至可能发布漏洞以迫使管理员做出反应。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-20T18:24:51.320

联系管理员，而不是业务类型的人。一般来说，管理员会感谢通知，并有机会在事情发生之前解决问题并因此受到指责。上级，或者客服人员要经过的渠道，是律师介入的渠道。

我是一群人中的一员，他们报告了我们在大学的 NAS 系统上偶然发现的一个问题。管理员非常感谢我们发现了漏洞并报告了它，并代表我们与他们的老板争论（负责人想钉死我们）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-09-24T13:49:36.410

我们向主要开发人员通报了他们登录页面上的 sql 注入漏洞。说真的，这是经典`'<your-sql-here>--`品种。无法绕过登录，但可以轻松执行任意sql。2个月了还没修好！不知道现在该做什么......我办公室里没有其他人真正关心过，这让我感到惊讶，因为我们为每一个小升级和新功能付出了如此多的代价。当我想到代码质量以及我们在这个软件中投入了多少库存时，我也感到害怕。

# iphone - [touch view] 究竟返回了什么？

> ID：667149
> 
> 赞同：1
> 
> 时间：2009-03-20T17:29:20.750
> 
> 标签：iphone

我是 iphone 开发的新手，我想知道。UITouch 实例方法视图究竟做了什么

```
[touch view]; 
```

我阅读了文档并了解它返回触摸“in”的视图，但是如果存在视图层次结构怎么办。我原本以为它会返回“最前面”的子视图。这个假设总是成立吗？

确定触摸是否在某个视图上的推荐方法是什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T17:33:36.373

是的，无论在哪里处理触摸，它都会返回实际触摸的视图（最顶层的视图）。

我能想到的唯一例外是最顶层的视图是不可见的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T19:37:50.690

实际上，我相信它可以为您提供触摸“开始”的位置，即使触摸现在可能处于不同的视图中。如果您正在观看 touchMove 和 touchEnd 事件，请记住一些事情。

# c# - 异步调用新手问题

> ID：667157
> 
> 赞同：2
> 
> 时间：2009-03-20T17:30:53.027
> 
> 标签：c#, asynchronous

我正在做一个小项目，我需要一个接一个地进行两个异步调用。

我的代码看起来像这样：

```
AsynchronousCall1();
AsynchronousCall2(); 
```

我遇到的问题是，这两个调用都需要一到两秒的时间来执行，而且我永远不知道哪一个会最后完成。我正在寻找的是一种确定谁最后完成的方法。如果 Call1() 最后完成，我会做一件事。如果 Call2() 最后完成，我会做另一件事。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T17:45:40.227

这是一个使用 a`lock`来确保只有一个线程可以输入一段代码的简单示例。但这是一个通用示例，它可能最适合您的应用程序，也可能不适合您的应用程序。为您的问题添加一些详细信息，以帮助我们找到您要查找的内容。

```
 void AsynchronousCall1()
 {
      // do some work
      Done("1");
 }

 void AsynchronousCall2()
 {
      // do some work
      Done("2");
 }

 readonly object _exclusiveAccess = new object();
 volatile bool _alreadyDone = false;
 void Done(string who)
 {
      lock (_exclusiveAccess)
      {
           if (_alreadyDone)
               return;

           _alreadyDone = true;
           Console.WriteLine(who + " was here first");
      }
  } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T17:34:57.227

我相信有一种方法是 Thread 类的成员，可以检查特定线程并确定其状态。另一种选择是使用 BackgroundWorker 代替，因为这将允许您通过创建单独的方法来说明该线程完成时会发生什么。

“线程不安全”选项将使用类变量，并且在每个线程结束时，如果它没有被锁定/已经具有另一个线程的值，请不要设置它。否则设置它。

然后在您的 main 方法中，在调用等待所有线程完成后，测试类变量。

这将为您提供关于哪个线程首先完成的答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T19:01:32.980

您可以使用两个`ManualResetEvent`对象执行此操作。这个想法是让主线程都初始化为无信号，然后调用异步方法。然后主线程`WaitAny`对两个对象执行 a 。完成`AsynchronousCall1`后，它会向其中一个对象发出信号。完成`AsynchronousCall2`后，它会向另一个发出信号。这是代码：

```
ManualResetEvent Event1 = new ManualResetEvent(false);
ManualResetEvent Event2 = new ManualResetEvent(false);

void SomeMethod()
{
    WaitHandle[] handles = {Event1, Event2};
    AsynchronousCall1();
    AsynchronousCall2();
    int index = WaitHandle.WaitAny(handles);
    // if index == 0, then Event1 was signaled.
    // if index == 1, then Event2 was signaled.
}

void AsyncProc1()
{
    // does its thing and then
    Event1.Signal();
}

void AsyncProc2()
{
    // does its thing and then
    Event2.Signal();
} 
```

这里有几个警告。如果两个异步方法都在调用 之前完成`WaitAny`，则不可能说哪个先完成。此外，如果两个方法的完成时间非常接近（即调用 1 完成，然后调用 2 在主线程的等待被释放之前完成），则不可能说哪一个先完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T18:17:50.587

You may want to check out the Blackboard design pattern: [http://chat.carleton.ca/~narthorn/project/patterns/BlackboardPattern-display.html](http://chat.carleton.ca/~narthorn/project/patterns/BlackboardPattern-display.html). That pattern sets up a common data store and then lets agents (who know nothing about one another -- in this case, your async calls) report their results in that common location. Your blackboard's 'supervisor' would then be aware of which call finished first and could direct your program accordingly.

# dependency-injection - 是否有任何关于控制反转或依赖注入价值的硬数据？

> ID：667159
> 
> 赞同：3
> 
> 时间：2009-03-20T17:31:03.023
> 
> 标签：dependency-injection, inversion-of-control, yagni

我已经阅读了很多关于 IoC 和 DI 的内容，但我并不真正相信在大多数情况下使用它们会收获很多。

如果您正在编写需要可插拔组件的代码，那么是的，我看到了它的价值。但如果你不是，那么我质疑将依赖项从类更改为接口是否真的为你带来了任何好处，除了更多的打字。

在某些情况下，我可以看到 IoC 和 DI 在哪些方面有助于模拟，但如果您不使用模拟或 TDD，那么它的价值是什么？这是 YAGNI 的案例吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T10:38:17.890

我怀疑你会有任何关于它的硬数据，所以我会添加一些想法。

首先，您不使用 DI（或其他 SOLID 原则），因为它可以帮助您进行 TDD。反过来说，你做 TDD 是因为它可以帮助你进行设计——这通常意味着你得到的代码遵循这些原则。

讨论为什么使用接口是另一回事，请参阅：[https](https://stackoverflow.com/questions/667139/what-is-the-purpose-of-interfaces) ://stackoverflow.com/questions/667139/what-is-the-purpose-of-interfaces 。

我假设你同意让你的类做许多不同的事情会导致代码混乱。因此，我假设您已经开始使用 SRP。

因为您有不同的类来做特定的事情，所以您需要一种方法来关联它们。如果您在类（即构造函数）中关联它们，您将获得大量使用特定版本的类的代码。这意味着对系统进行更改将很困难。

您将需要更改系统，这是软件开发的一个事实。你可以打电话给 YAGNI 关于不添加特定的额外功能，但不是说你不需要更改系统。就我而言，这是非常重要的，因为我每周都会进行冲刺。

我使用通过代码完成配置的 DI 框架。通过非常小的代码配置，您可以连接许多不同的关系。因此，当您取消关于接口与具体类的讨论时，您实际上是在节省打字，而不是相反。同样对于具体类在构造函数上的情况，它会自动将其连接起来（我不必配置）构建其余的关系。它还允许我控制一些对象的生命周期，特别是我可以将一个对象配置为 Singleton 并且它一直处理一个实例。

另请注意，仅使用这些做法并不会增加开销。第一次使用它们是导致开销的原因（因为学习过程+在某些情况下思维定势改变）。

Bottom line: you ain't gonna need to put all those constructor calls all over the place to go faster.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T17:39:50.523

DI 最显着的收益不一定是由于使用了接口。您实际上不需要使用接口来获得依赖注入的有益效果。如果只有一个实现，您可能可以直接注入它，并且可以混合使用类和接口。

您仍然处于松散耦合状态，并且如果需要，您可以通过一些按键来引入相当多的开发环境。

我无法给出关于松散耦合价值的硬数据，但只要我记得，它就一直是教科书中的愿景。现在它是真实的。

当涉及到大型结构的层次结构时，DI 框架还为您提供了一些非常惊人的功能。我建议您寻找一个功能齐全的框架，而不是寻找最精简的 DI 框架。少并不*总是*多，至少在学习新的编程方式时是如此。*然后*你可以少花钱。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T08:47:27.050

除了测试之外，松耦合也是值得的。

我从事嵌入式 Java 系统的组件工作，该系统在启动后具有固定的对象配置（大约 50 个不同的对象）。

第一个组件是没有依赖注入的遗留代码，以及到处创建的子对象。现在发生了好几次，对于一些修改，一些代码需要与一个只有三个构造函数可用的对象对话。那么除了向构造函数添加另一个参数并传递它之外，您还能做什么，或者甚至将其存储在一个字段中以供以后传递。从长远来看，事情变得比现在更加纠结。

我从头开始开发的第二个组件，使用了依赖注入（当时不知道）。也就是说，我有一个工厂，它构建了所有对象并在需要知道的基础上注入。添加另一个依赖项很容易，只需将其添加到工厂和对象构造函数（或添加一个 setter 以避免循环）。无需触及无关的代码。

# python - 在 Python 中查找类的静态属性

> ID：667166
> 
> 赞同：3
> 
> 时间：2009-03-20T17:33:12.240
> 
> 标签：python, class-design

这是一个不寻常的问题，但我想`__slots__`根据我碰巧添加到类中的任何属性动态生成类的属性。

例如，如果我有一堂课：

```
class A(object):
    one = 1
    two = 2

    __slots__ = ['one', 'two'] 
```

我想动态地执行此操作，而不是手动指定参数，我该怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T17:41:24.060

在您尝试定义**slot**时，该类尚未构建，因此您无法从 A 类中动态定义它。

要获得您想要的行为，请使用元类来内省 A 的定义并添加插槽属性。

```
class MakeSlots(type):

    def __new__(cls, name, bases, attrs):
        attrs['__slots__'] = attrs.keys()

        return super(MakeSlots, cls).__new__(cls, name, bases, attrs)

class A(object):
    one = 1
    two = 2

    __metaclass__ = MakeSlots 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-31T07:25:51.647

需要注意的一件非常重要的事情——如果这些属性保留在类中，那么`__slots__`生成将是无用的……好吧，也许不是*无用*的——它将使类属性只读；可能不是你想要的。

简单的方法是说，“好的，我将它们初始化为 None，然后让它们消失。” 优秀的！这是一种方法：

```
class B(object):
    three = None
    four = None

    temp = vars()                    # get the local namespace as a dict()
    __slots__ = temp.keys()          # put their names into __slots__
    __slots__.remove('temp')         # remove non-__slots__ names
    __slots__.remove('__module__')   # now remove the names from the local
    for name in __slots__:           # namespace so we don't get read-only
        del temp[name]               # class attributes
    del temp                         # and get rid of temp 
```

如果您想保留这些初始值，则需要做更多的工作......这是一种可能的解决方案：

```
class B(object):
    three = 3
    four = 4

    def __init__(self):
        for key, value in self.__init__.defaults.items():
            setattr(self, key, value)

    temp = vars()
    __slots__ = temp.keys()
    __slots__.remove('temp')
    __slots__.remove('__module__')
    __slots__.remove('__init__')
    __init__.defaults = dict()
    for name in __slots__:
        __init__.defaults[name] = temp[name]
        del temp[name]
    del temp 
```

如您所见，没有元类也可以做到这一点——但谁想要所有的样板文件？元类绝对可以帮助我们清理它：

```
class MakeSlots(type):
    def __new__(cls, name, bases, attrs):
        new_attrs = {}
        new_attrs['__slots__'] = slots = attrs.keys()
        slots.remove('__module__')
        slots.remove('__metaclass__')
        new_attrs['__weakref__'] = None
        new_attrs['__init__'] = init = new_init
        init.defaults = dict()
        for name in slots:
            init.defaults[name] = attrs[name]
        return super(MakeSlots, cls).__new__(cls, name, bases, new_attrs)

def new_init(self):
    for key, value in self.__init__.defaults.items():
        setattr(self, key, value)

class A(object):
    __metaclass__ = MakeSlots

    one = 1
    two = 2

class B(object):
    __metaclass__ = MakeSlots

    three = 3
    four = 4 
```

现在所有的乏味都保留在元类中，并且实际的类很容易阅读和（希望！）理解。

如果您需要在这些类中添加除属性之外的任何其他内容，我强烈建议您将任何内容放在 mixin 类中——将它们直接放在最终类中会使元类更加复杂。

# asp.net - 从 ASP.NET 中的 SQL 查询填充 XML 的最佳方法？

> ID：667168
> 
> 赞同：1
> 
> 时间：2009-03-20T17:33:38.183
> 
> 标签：asp.net, sql, xml

我需要创建一个服务，该服务将返回包含来自数据库的数据的 XML。所以我正在考虑使用一个 ASHX 来接受日期范围之类的内容并返回一个 XML 文件。我已经处理了从 SQL Server 中提取数据并填充到数据网格中以进行可视化显示的页面，但从来没有处理过用于交付的 XML，最好的方法是什么？此外，如果 ASHX 和 POST 不是最好的交付方式，请告诉我...谢谢！

编辑：这些答案很好，为我指明了正确的方向。我还应该提到 XML 格式已经确定，所以我不能使用任何自动生成的格式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T18:09:01.060

将 linq2sql 与 XElement 类结合起来，大致如下：

```
var xmlContacts =
      new XElement("contacts",
         (from c in context.Contacts
         select new XElement("contact",
            new XElement
            {
               new XElement("name", c.Name), 
               new XElement("phone", c.Phone),
               new XElement("postal", c.Postal)
            )
         )
         ).ToArray()
      )
   ); 
```

Linq2sql 将在对数据库的一次调用中检索数据，并且 XML 的处理将在业务服务器上完成。这可以更好地分配负载，因为您没有让 sql 服务器完成所有工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T17:35:57.163

你试过[DataSet.WriteXml()](http://msdn.microsoft.com/en-us/library/system.data.dataset.writexml.aspx)吗？

您可以将其作为 Web 服务调用的输出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T17:43:32.387

Sql Server 2005 及更高版本有一个“FOR XML AUTO”命令，可以为您将记录集转换为 XML。然后你只需要从你的 ASHX 返回一个字符串。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T17:52:58.573

从 SQL Server 2000 开始，您可以将查询结果作为 XML 返回。要对它们进行绝对控制，请使用“FOR XML EXPLICIT”命令。你可以使用任何你想要的格式。

[http://msdn.microsoft.com/en-us/library/ms189068.aspx](http://msdn.microsoft.com/en-us/library/ms189068.aspx)

就像将结果写入原始输出一样简单。对于附加点，您可以将结果集返回到 a `XPathDocument`，通过 XSL 转换传递它，然后以您选择的任何格式发送结果（HTML 与 XML 可能只需单击一个按钮）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T17:37:34.693

您可以将其获取到数据表，然后调用 myTable.WriteXML()

如果您使用数据库结果填充类，则将可序列化属性添加到类的标题中，并使用 XMLSerializer

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-22T06:13:45.587

将自动生成的格式转换为指定格式是 xslt 的工作。只需找到一种通过 xslt 过滤器运行该工具的输出的方法。

Oracle 有一个出色的产品来完成这项工作——oracle XDK。但据我所知，这是一个 java 的东西，而不是 ASP。

例如，这个 XHTML [http://www.anbg.gov.au/abrs/online-resources/flora/stddisplay.xsql?pnid=2524](http://www.anbg.gov.au/abrs/online-resources/flora/stddisplay.xsql?pnid=2524)

由 oracle 生成的这个 XML 自动生成 [http://www.anbg.gov.au/abrs/online-resources/flora/stddisplay.xsql?pnid=2524&xml-stylesheet=none](http://www.anbg.gov.au/abrs/online-resources/flora/stddisplay.xsql?pnid=2524&xml-stylesheet=none)

当然，您追求的不是 XHTML，而是其他一些 XML 格式。但是 XSLT 可以完成这项工作。

# c# - 尽管数据源完整，但数据绑定 DataGridView 为空

> ID：667170
> 
> 赞同：0
> 
> 时间：2009-03-20T17:34:56.870
> 
> 标签：c#, .net, data-binding, datagridview

我有一个基表单类，其中包含一个返回 DataTable 的方法：

```
protected DataTable GetTableData(string sql, OracleConnection connection)
{
  DataTable table = null;
  OracleDataAdapter adapter = null;

  try
  {
    table = new DataTable();
    adapter = new OracleDataAdapter(sql, connection);
    table.Locale = System.Globalization.CultureInfo.InvariantCulture;
    adapter.Fill(table);
  }
  catch (Exception e)
  {
    MessageBox.Show("An error occurred while trying to process your request:\n\n" + e.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
  }
  finally
  {
    if (null != adapter)
    {
      adapter.Dispose();
    }
  }
  return table;
} 
```

另一个窗口是它的子类，并按如下方式调用它：

```
private void LoadViewData(OracleConnection connection)
{

  DataTable table = null;

  try
  {
    var sql = "SELECT * FROM " + this.ObjectName;
    table = GetTableData(sql, connection);
    this.resultBindingSource.DataSource = table;
  }
  catch (Exception e)
  {
    MessageBox.Show("An error occurred while trying to process your request:\n\n" + e.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
  }
  finally
  {
    this.sqlEditor.Focus();
  }
} 
```

`resultBindingSource`是一个`System.Windows.Forms.BindingSource`。它被设置为`DataSource`a 的属性`System.Windows.Forms.DataGridView`。（表达式 ,`this.ObjectName`计算为数据库中表或视图的名称。）

当我在调试器中运行代码时，我可以看到 SQL 执行得很好。我可以看到`DataTable`包含数据。可以看到控件正确绑定到数据源，通过属性`DataGridView`可以看到数据表中的数据。`DataSource`但是，控件本身中不显示任何数据。没有行或列标题，也没有显示任何数据。

我已经尝试了我能想到的一切来确定这个问题的原因。此代码的工作方式与另一个表单上显示的完全相同。我尝试删除有问题的控件并重新创建它们，但无济于事。我查阅了 MSDN 上关于如何正确地将数据绑定到`DataGridView`控件的文章。我尝试了有无一个`OracleCommandBuilder`（这对我来说似乎没有必要，因为这是数据的只读视图）。

坦率地说，我没有想法。我可能忽略了一些相当明显的事情。我知道数据绑定有效，因为我之前已经成功地完成了它。

任何指向正确方向的指针将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T17:48:55.523

我尝试使用您在此处提到的部分重新创建您的程序。我实际上并没有从数据表中获取数据，但这无关紧要。这是我所做的：

```
public partial class Form1 : BaseForm
    {
        BindingSource source = new BindingSource();
        public Form1()
        {
            InitializeComponent();
            this.dataGridView1.DataSource = source;

        }

        private void button1_Click(object sender, EventArgs e)
        {
            DataTable table = GetDataTable();
            this.source.DataSource = table;
        }
    }

    public class BaseForm : Form
    {
        protected DataTable GetDataTable()
        {
            DataTable result = new DataTable();
            result.Columns.Add("Name");
            result.Columns.Add("Age", typeof(int));
            result.Rows.Add("Alex", 27);
            return result;
        }
    } 
```

这与您的情况大致相同吗？我一点问题都没有。根据您发布的内容，这应该有效。您确定将所有内容正确绑定吗？如果可能的话，发布更多的绑定代码......

# security - 堆溢出攻击

> ID：667177
> 
> 赞同：19
> 
> 时间：2009-03-20T17:37:16.007
> 
> 标签：security, buffer-overflow

堆溢出攻击是如何执行的？

在堆栈溢出攻击的情况下，攻击者将函数返回地址替换为他选择的地址。

在堆溢出攻击的情况下如何做到这一点？另外，是否可以从堆中运行代码？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-03-20T17:52:09.527

请注意，这因平台而异，我的示例过于简化。它基本上归结为具有可能被溢出的链表的堆管理器，并且您可以使用链表指针来覆盖进程内存的随机部分。

想象一下，我有一个简单的堆实现，它的控制块是这样的：

```
struct HeapBlockHeader
{
    HeapBlockHeader* next;
    HeapBlockHeader* prev;
    int size;

    // Actual heap buffer follows this structure.
}; 
```

当堆被释放时，这个控制块通过修改下一个/上一个指针返回到一个已释放块的列表中。如果我超出堆缓冲区，我可以用我控制的数据覆盖下一个控制块中的指针。假设我覆盖这些链接以指向代码的指针（可能只是在我覆盖的缓冲区中）和堆栈上函数的返回地址。当堆管理器试图将块链接回一个已释放的列表时，它实际上会用指向我控制的代码的指针覆盖堆栈上的返回地址。

这篇文章对堆溢出攻击有一个很好的概述： [http ://www.h-online.com/security/features/A-Heap-of-Risk-747161.html](http://www.h-online.com/security/features/A-Heap-of-Risk-747161.html)

这篇文章描述了进入 Vista 的堆管理器以防止这种攻击的一些强化：http: [//www.blackhat.com/presentations/bh-usa-06/BH-US-06-Marinescu.pdf](http://www.blackhat.com/presentations/bh-usa-06/BH-US-06-Marinescu.pdf)

编辑：关于从堆运行代码的可能性，是的，这是可能的。许多平台现在默认使堆内存不可执行，这增加了运行任意代码的障碍。但是，您仍然可以执行“跳转到 libc”样式的攻击 - 将返回地址覆盖为可执行的已知函数。

# windows - 显示 Windows 剪贴板的内容

> ID：667179
> 
> 赞同：20
> 
> 时间：2009-03-20T17:37:50.917
> 
> 标签：windows, clipboard

如何在不使用粘贴操作的情况下查看 Windows 剪贴板当前包含的内容？

我不希望“粘贴到”应用程序在剪贴板上执行任何操作（例如，格式化文本和转换）。

是否有显示剪贴板对象及其格式（CF_BITMAP、CF_TEXT 等）和内容（例如简单字节）的工具？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-09T16:26:48.143

维基百科上有一个剪贴板管理器工具列表： *[剪贴板管理器](http://en.wikipedia.org/wiki/Clipboard_manager)*

[ClipX](http://bluemars.org/clipx/)允许您通过按`Ctrl`+ `Shift`+查看以前剪贴板条目的日志`V`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2018-06-26T15:30:32.000

NirSoft 提供免费的“<a href="https://www.nirsoft.net/utils/inside_clipboard.html" rel="nofollow noreferrer">Inside Clipboard”实用程序，可让您查看原始剪贴板内容和不同格式。它与您在编程 API 中看到的很接近，但有一个不错的 GUI。它的 GUI 包括十六进制视图。它还允许导出数据，并允许将快照保存到`.clp`可以打开并允许您稍后检查的文件中。

如果您需要在编程 API 级别查看事物以快速检查事物而无需自己编写程序，我推荐此工具。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-20T17:58:20.447

如果使用 .NET，您可以查询[剪贴板](https://msdn.microsoft.com/en-us/library/system.windows.clipboard(v=vs.110).aspx)对象。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-03-17T03:26:41.073

Windows XP 中的常规旧 Clipbrd.exe 剪贴板查看器怎么样？

这仍将在 Windows Vista 和 Windows 7、IIRC 上运行。

* * *

## 回答 #5

> 赞同：-7
> 
> 时间：2010-07-09T06:33:28.397

1.  从开始菜单中选择运行。
2.  在其中输入“clipbrd.exe”。

然后您可以在 Windows 系统中看到剪贴板项目。

# floating-point - 核心 OCaml 中浮点数的绝对值

> ID：667180
> 
> 赞同：9
> 
> 时间：2009-03-20T17:37:56.207
> 
> 标签：floating-point, ocaml, absolute-value

我需要 OCaml 中浮点数的绝对值函数，而核心语言似乎没有，所以我写了以下内容：

```
let absF (f:float) = if f > 0.0 then f else (f *. -1.0);; 
```

这似乎适用于积极因素，但不适用于消极因素，理由是：

此表达式的类型为 float -> float 但此处与 int 类型一起使用

我的逻辑有什么错误？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-20T20:01:38.030

核心语言确实有一个，`abs_float`.

此外，您可以使用`~-.`来表示一元否定，这也适用于整数以及`~-`运算符。您可以像这样定义这样的运算符（即使它已经存在）：

```
let (~-) a : int = 0 - a
let (~-.) a : float = 0.0 -. a 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-20T17:47:35.653

当您键入

```
absF -1.0;; 
```

OCaml 将其解释为

```
(absF) - (1.0);; 
```

即作为减法。相反，做

```
absF (-1.0);; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-11-20T16:46:06.473

如果你有 int 值可以使用

```
# abs(-1)
- : int = 1 
```

否则，如果你有一个浮动

```
# abs_float(-1.0)
- : float = 1. 
```

# c++ - 在 C++ 中填充 stl 字符串

> ID：667183
> 
> 赞同：70
> 
> 时间：2009-03-20T17:38:51.227
> 
> 标签：c++, string, padding, stdstring

我正在使用`std::string`并且需要将它们填充到给定的宽度。在 C++ 中推荐的方法是什么？

样本输入：

```
123 
```

填充到 10 个字符。

样本输出：

```
 123 
```

*（123前面7个空格）*

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2009-03-20T17:45:04.940

std::setw (setwidth) 操纵器

```
std::cout << std::setw (10) << 77 << std::endl; 
```

或者

```
std::cout << std::setw (10) << "hi!" << std::endl; 
```

输出填充 77 和“嗨！”。

如果您需要结果作为字符串，请使用 std::stringstream 的实例而不是 std::cout 对象。

ps：负责的头文件`<iomanip>`

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-03-20T17:47:13.627

```
void padTo(std::string &str, const size_t num, const char paddingChar = ' ')
{
    if(num > str.size())
        str.insert(0, num - str.size(), paddingChar);
}

int main(int argc, char **argv)
{
    std::string str = "abcd";
    padTo(str, 10);
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2009-03-20T17:50:07.113

你可以像这样使用它：

```
std::string s = "123";
s.insert(s.begin(), paddedLength - s.size(), ' '); 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-03-20T17:50:40.560

我能想到的最简单的方法是使用字符串流：

```
string foo = "foo";
stringstream ss;
ss << setw(10) << foo;
foo = ss.str(); 
```

`foo`现在应该填充。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-03-20T17:47:38.850

您可以通过调用创建一个包含 N 个空格的字符串

```
string(N, ' '); 
```

所以你可以这样做：

```
string to_be_padded = ...;
if (to_be_padded.size() < 10) {
  string padded(10 - to_be_padded.size(), ' ');
  padded += to_be_padded;
  return padded;
} else { return to_be_padded; } 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2016-02-17T08:33:37.333

```
std::string pad_right(std::string const& str, size_t s)
{
    if ( str.size() < s )
        return str + std::string(s-str.size(), ' ');
    else
        return str;
}

std::string pad_left(std::string const& str, size_t s)
{
    if ( str.size() < s )
        return std::string(s-str.size(), ' ') + str;
    else
        return str;
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-20T17:48:36.603

有一个很好而且简单的方法:)

```
const int required_pad = 10;

std::string myString = "123";
size_t length = myString.length();

if (length < required_pad)
  myString.insert(0, required_pad - length, ' '); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-20T17:49:15.757

怎么样：

```
string s = "          "; // 10 spaces
string n = "123";
n.length() <= 10 ? s.replace(10 - n.length(), n.length(), s) : s = n; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-02-24T18:50:07.087

最小的工作代码：

```
#include <iostream>
#include <iomanip>

int main()
{
    for(int i = 0; i < 300; i += 11)
    {
        std::cout << std::setfill ( ' ' ) << std::setw (2) << (i % 100) << std::endl;
    }
    return 0;
}

/*
Note:
- for std::setfill ( ' ' ):
  - item in '' is what will be used for filling
- std::cout may be replaced with a std::stringstream if you need it
- modulus is used to cut the integer to an appropriate length, for strings use substring
- std::setw is used to define the length of the needed string
*/ 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-02-01T20:10:26.200

[在https://repl.it/@JomaCorpFX/Padding#main.cpp](https://repl.it/@JomaCorpFX/Padding#main.cpp)上测试此代码

我们有 2 种类型的 Padding

*   **正常填充**

它将字符串的每个字符作为一个单独的元素

```
std::string str = u8"Hello"; //5 elements
std::string str2 = u8"Hello "; //10 elements //  has 4 chars.
std::string str3 = u8""; //4 elements //  has 4 chars. 
```

*   **UTF8 填充**

长度为 UTF8 单位，一个 UTF8 单位可以是 1-4 个字符

```
std::string str = u8"Hello"; //5 UTF8 units.
std::string str2 = u8"Hello "; //7 UTF8 units //  is an individual element.
std::string str3 = u8""; //1 UTF8 units 
```

**功能**

```
class Strings
{

    static size_t LengthUTF8(const String& data);

    static String SubstringUTF8(const String& data, size_t startIndex, size_t length);

    static String PadRight(const String& data, const size_t& totalWidth, const char& padding);

    static String PadLeft(const String& data, const size_t& totalWidth, const char& padding);

    static String PadRight(const String& data, const size_t& totalWidth, const String& padding);

    static String PadLeft(const String& data, const size_t& totalWidth, const String& padding);

    static String PadRightUTF8(const String& data, const size_t& totalWidth, const char& padding);

    static String PadLeftUTF8(const String& data, const size_t& totalWidth, const char& padding);

    static String PadRightUTF8(const String& data, const size_t& totalWidth, const String& padding);

    static String PadLeftUTF8(const String& data, const size_t& totalWidth, const String& padding);
}; 
```

以 UTF8 结尾的函数以 UTF8 单位处理字符串以确定其长度。不以 UTF8 结尾的函数会以每个 char 为单位来确定长度。

如果填充是一个字符串，并且如果它是一个 UTF8 函数，它将以 UTF8 单位处理，否则作为字符处理。

参数 totalWidth 基于函数 normal 或 UTF8。

**全码**

```
 #include <iostream>
#include <set>
#include <string>
#include <locale>

// WINDOWS
#if (_WIN32)
#include <Windows.h>
#include <conio.h>
#define WINDOWS_PLATFORM 1
#define DLLCALL STDCALL
#define DLLIMPORT _declspec(dllimport)
#define DLLEXPORT _declspec(dllexport)
#define DLLPRIVATE
#define NOMINMAX

//EMSCRIPTEN
#elif defined(__EMSCRIPTEN__)
#include <emscripten/emscripten.h>
#include <emscripten/bind.h>
#include <unistd.h>
#include <termios.h>
#define EMSCRIPTEN_PLATFORM 1
#define DLLCALL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))

// LINUX - Ubuntu, Fedora, , Centos, Debian, RedHat
#elif (__LINUX__ || __gnu_linux__ || __linux__ || __linux || linux)
#define LINUX_PLATFORM 1
#include <unistd.h>
#include <termios.h>
#define DLLCALL CDECL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))
#define CoTaskMemAlloc(p) malloc(p)
#define CoTaskMemFree(p) free(p)

//ANDROID
#elif (__ANDROID__ || ANDROID)
#define ANDROID_PLATFORM 1
#define DLLCALL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))

//MACOS
#elif defined(__APPLE__)
#include <unistd.h>
#include <termios.h>
#define DLLCALL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))
#include "TargetConditionals.h"
#if TARGET_OS_IPHONE && TARGET_IPHONE_SIMULATOR
#define IOS_SIMULATOR_PLATFORM 1
#elif TARGET_OS_IPHONE
#define IOS_PLATFORM 1
#elif TARGET_OS_MAC
#define MACOS_PLATFORM 1
#else

#endif

#endif

typedef std::string String;
typedef std::wstring WString;

#define EMPTY_STRING u8""s
#define EMPTY_WSTRING L""s

using namespace std::literals::string_literals;

class Strings
{
public:
    static String WideStringToString(const WString& wstr)
    {
        if (wstr.empty())
        {
            return String();
        }
        size_t pos;
        size_t begin = 0;
        String ret;

#if WINDOWS_PLATFORM
        int size;
        pos = wstr.find(static_cast<wchar_t>(0), begin);
        while (pos != WString::npos && begin < wstr.length())
        {
            WString segment = WString(&wstr[begin], pos - begin);
            size = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), NULL, 0, NULL, NULL);
            String converted = String(size, 0);
            WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), &converted[0], converted.size(), NULL, NULL);
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = wstr.find(static_cast<wchar_t>(0), begin);
        }
        if (begin <= wstr.length())
        {
            WString segment = WString(&wstr[begin], wstr.length() - begin);
            size = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), NULL, 0, NULL, NULL);
            String converted = String(size, 0);
            WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), &converted[0], converted.size(), NULL, NULL);
            ret.append(converted);
        }
#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        size_t size;
        pos = wstr.find(static_cast<wchar_t>(0), begin);
        while (pos != WString::npos && begin < wstr.length())
        {
            WString segment = WString(&wstr[begin], pos - begin);
            size = wcstombs(nullptr, segment.c_str(), 0);
            String converted = String(size, 0);
            wcstombs(&converted[0], segment.c_str(), converted.size());
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = wstr.find(static_cast<wchar_t>(0), begin);
        }
        if (begin <= wstr.length())
        {
            WString segment = WString(&wstr[begin], wstr.length() - begin);
            size = wcstombs(nullptr, segment.c_str(), 0);
            String converted = String(size, 0);
            wcstombs(&converted[0], segment.c_str(), converted.size());
            ret.append(converted);
        }
#else
        static_assert(false, "Unknown Platform");
#endif
        return ret;
    }

    static WString StringToWideString(const String& str)
    {
        if (str.empty())
        {
            return WString();
        }

        size_t pos;
        size_t begin = 0;
        WString ret;
#ifdef WINDOWS_PLATFORM
        int size = 0;
        pos = str.find(static_cast<char>(0), begin);
        while (pos != std::string::npos) {
            std::string segment = std::string(&str[begin], pos - begin);
            std::wstring converted = std::wstring(segment.size() + 1, 0);
            size = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, &segment[0], segment.size(), &converted[0], converted.length());
            converted.resize(size);
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = str.find(static_cast<char>(0), begin);
        }
        if (begin < str.length()) {
            std::string segment = std::string(&str[begin], str.length() - begin);
            std::wstring converted = std::wstring(segment.size() + 1, 0);
            size = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, segment.c_str(), segment.size(), &converted[0], converted.length());
            converted.resize(size);
            ret.append(converted);
        }

#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        size_t size;
        pos = str.find(static_cast<char>(0), begin);
        while (pos != String::npos)
        {
            String segment = String(&str[begin], pos - begin);
            WString converted = WString(segment.size(), 0);
            size = mbstowcs(&converted[0], &segment[0], converted.size());
            converted.resize(size);
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = str.find(static_cast<char>(0), begin);
        }
        if (begin < str.length())
        {
            String segment = String(&str[begin], str.length() - begin);
            WString converted = WString(segment.size(), 0);
            size = mbstowcs(&converted[0], &segment[0], converted.size());
            converted.resize(size);
            ret.append(converted);
        }
#else
        static_assert(false, "Unknown Platform");
#endif
        return ret;
    }

    static size_t LengthUTF8(const String& data)
    {
        size_t ret = 0;
        for (char value : data)
        {
            if ((value & 0xc0) != 0x80)
            {
                ++ret;
            }
        }
        return ret;
    }

    static String SubstringUTF8(const String& data, size_t startIndex, size_t length)
    {
        size_t units = LengthUTF8(data);
        if (startIndex >= units)
        {
            throw std::invalid_argument(u8"Invalid UTF8 character position.");
        }
        String result;
        String::const_iterator it = data.begin();
        String::const_iterator beginIterator = data.begin();
        size_t endIndex = length == SIZE_MAX ? units : startIndex + length;
        size_t utf8pos = 0;
        while (it != data.end())
        {
            char value = *it;
            if ((value & 0xc0) != 0x80) // Es inicio de caracter //utf8pos = 0 / beginIterator = 0 / endIndex = 1+12
            {
                if (utf8pos == startIndex)
                {
                    beginIterator = it;
                    if (length >= units)
                    {
                        return String(beginIterator, data.end());
                    }
                }

                if (utf8pos == endIndex)
                {
                    break;
                }
                utf8pos += 1;
            }
            it++;
        }
        return String(beginIterator, it);
    }

    static String GetCharUTF8(const String& data, size_t pos)
    {
        return SubstringUTF8(data, pos, 1);
    }

    static String PadRight(const String& data, const size_t& totalWidth, const char& padding)
    {
        if (data.length() >= totalWidth)
        {
            return data;
        }
        String ret = data;
        ret.resize(totalWidth, padding);
        return ret;
    }

    static String PadLeft(const String& data, const size_t& totalWidth, const char& padding)
    {
        if (data.length() >= totalWidth)
        {
            return data;
        }
        String ret = data;
        ret.insert(0, totalWidth - ret.length(), padding);
        return ret;
    }

    static String PadRight(const String& data, const size_t& totalWidth, const String& padding)
    {

        if (data.length() >= totalWidth)
        {
            return data;
        }
        size_t modulo = (totalWidth - data.length()) % padding.length();
        size_t paddingUnits = (totalWidth - data.length()) / padding.length();
        String ret = data;
        for (size_t i = 0; i < paddingUnits; i++)
        {
            ret.append(padding);
        }
        ret.append(padding.substr(0, modulo));
        return ret;
    }

    static String PadLeft(const String& data, const size_t& totalWidth, const String& padding)
    {
        if (data.length() >= totalWidth)
        {
            return data;
        }
        size_t modulo = (totalWidth - data.length()) % padding.length();
        size_t paddingUnits = (totalWidth - data.length()) / padding.length();
        String ret = data;
        for (size_t i = 0; i < paddingUnits; i++)
        {
            ret.insert(0, padding);
        }
        ret.insert(0, padding.substr(0, modulo));
        return ret;
    }

    static String PadRightUTF8(const String& data, const size_t& totalWidth, const char& padding)
    {
        size_t totalUtf8 = LengthUTF8(data);
        if (totalUtf8 >= totalWidth)
        {
            return data;
        }
        String ret = data;
        ret.resize(ret.length() + (totalWidth - totalUtf8), padding);
        return ret;
    }

    static String PadLeftUTF8(const String& data, const size_t& totalWidth, const char& padding)
    {
        size_t totalUtf8 = LengthUTF8(data);
        if (totalUtf8 >= totalWidth)
        {
            return data;
        }
        String ret = data;
        ret.insert(0, totalWidth - totalUtf8, padding);
        return ret;
    }

    static String PadRightUTF8(const String& data, const size_t& totalWidth, const String& padding)
    {
        size_t units = LengthUTF8(data);
        size_t paddingUnits = LengthUTF8(padding);
        if (units >= totalWidth)
        {
            return data;
        }
        size_t modulo = (totalWidth - units) % paddingUnits;
        size_t n = (totalWidth - units) / paddingUnits;
        String ret = data;
        for (size_t i = 0; i < n; i++)
        {
            ret.append(padding);
        }
        ret.append(SubstringUTF8(padding, 0, modulo));
        return ret;
    }

    static String PadLeftUTF8(const String& data, const size_t& totalWidth, const String& padding)
    {
        size_t units = LengthUTF8(data);
        size_t paddingUnits = LengthUTF8(padding);
        if (units >= totalWidth)
        {
            return data;
        }
        size_t modulo = (totalWidth - units) % paddingUnits;
        size_t n = (totalWidth - units) / paddingUnits;
        String ret = data;
        for (size_t i = 0; i < n; i++)
        {
            ret.insert(0, padding);
        }
        ret.insert(0, SubstringUTF8(padding, 0, modulo));
        return ret;
    }

};

enum class ConsoleTextStyle
{
    DEFAULT = 0,
    BOLD = 1,
    FAINT = 2,
    ITALIC = 3,
    UNDERLINE = 4,
    SLOW_BLINK = 5,
    RAPID_BLINK = 6,
    REVERSE = 7,
};

enum class ConsoleForeground
{
    DEFAULT = 39,
    BLACK = 30,
    DARK_RED = 31,
    DARK_GREEN = 32,
    DARK_YELLOW = 33,
    DARK_BLUE = 34,
    DARK_MAGENTA = 35,
    DARK_CYAN = 36,
    GRAY = 37,
    DARK_GRAY = 90,
    RED = 91,
    GREEN = 92,
    YELLOW = 93,
    BLUE = 94,
    MAGENTA = 95,
    CYAN = 96,
    WHITE = 97
};

enum class ConsoleBackground
{
    DEFAULT = 49,
    BLACK = 40,
    DARK_RED = 41,
    DARK_GREEN = 42,
    DARK_YELLOW = 43,
    DARK_BLUE = 44,
    DARK_MAGENTA = 45,
    DARK_CYAN = 46,
    GRAY = 47,
    DARK_GRAY = 100,
    RED = 101,
    GREEN = 102,
    YELLOW = 103,
    BLUE = 104,
    MAGENTA = 105,
    CYAN = 106,
    WHITE = 107
};

class Console //For Printing Unicode strings.
{
private:
    static void EnableVirtualTermimalProcessing()
    {
#if defined WINDOWS_PLATFORM
        HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);
        DWORD dwMode = 0;
        GetConsoleMode(hOut, &dwMode);
        if (!(dwMode & ENABLE_VIRTUAL_TERMINAL_PROCESSING))
        {
            dwMode |= ENABLE_VIRTUAL_TERMINAL_PROCESSING;
            SetConsoleMode(hOut, dwMode);
        }
#endif
    }

    static void ResetTerminalFormat()
    {
        std::cout << u8"\033[0m";
    }

    static void SetVirtualTerminalFormat(ConsoleForeground foreground, ConsoleBackground background, std::set<ConsoleTextStyle> styles)
    {
        String format = u8"\033[";
        format.append(std::to_string(static_cast<int>(foreground)));
        format.append(u8";");
        format.append(std::to_string(static_cast<int>(background)));
        if (styles.size() > 0)
        {
            for (auto it = styles.begin(); it != styles.end(); ++it)
            {
                format.append(u8";");
                format.append(std::to_string(static_cast<int>(*it)));
            }
        }
        format.append(u8"m");
        std::cout << format;
    }
public:
    static void Clear()
    {

#ifdef WINDOWS_PLATFORM
        std::system(u8"cls");
#elif LINUX_PLATFORM || defined MACOS_PLATFORM
        std::system(u8"clear");
#elif EMSCRIPTEN_PLATFORM
        emscripten::val::global()["console"].call<void>(u8"clear");
#else
        static_assert(false, "Unknown Platform");
#endif
    }

    static void Write(const String& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
#ifndef EMSCRIPTEN_PLATFORM
        EnableVirtualTermimalProcessing();
        SetVirtualTerminalFormat(foreground, background, styles);
#endif
        String str = s;
#ifdef WINDOWS_PLATFORM
        WString unicode = Strings::StringToWideString(str);
        WriteConsole(GetStdHandle(STD_OUTPUT_HANDLE), unicode.c_str(), static_cast<DWORD>(unicode.length()), nullptr, nullptr);
#elif defined LINUX_PLATFORM || defined MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        std::cout << str;
#else
        static_assert(false, "Unknown Platform");
#endif

#ifndef EMSCRIPTEN_PLATFORM
        ResetTerminalFormat();
#endif
    }

    static void WriteLine(const String& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
        Write(s, foreground, background, styles);
        std::cout << std::endl;
    }

    static void Write(const WString& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
#ifndef EMSCRIPTEN_PLATFORM
        EnableVirtualTermimalProcessing();
        SetVirtualTerminalFormat(foreground, background, styles);
#endif
        WString str = s;

#ifdef WINDOWS_PLATFORM
        WriteConsole(GetStdHandle(STD_OUTPUT_HANDLE), str.c_str(), static_cast<DWORD>(str.length()), nullptr, nullptr);
#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        std::cout << Strings::WideStringToString(str);
#else
        static_assert(false, "Unknown Platform");
#endif

#ifndef EMSCRIPTEN_PLATFORM
        ResetTerminalFormat();
#endif
    }

    static void WriteLine(const WString& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
        Write(s, foreground, background, styles);
        std::cout << std::endl;
    }

    static void WriteLine()
    {
        std::cout << std::endl;
    }

    static void Pause()
    {
        char c;
        do
        {
            c = getchar();
            std::cout << "Press Key " << std::endl;
        } while (c != 64);
        std::cout << "KeyPressed" << std::endl;
    }

    static int PauseAny(bool printWhenPressed = false, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
        int ch;
#ifdef WINDOWS_PLATFORM
        ch = _getch();
#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        struct termios oldt, newt;
        tcgetattr(STDIN_FILENO, &oldt);
        newt = oldt;
        newt.c_lflag &= ~(ICANON | ECHO);
        tcsetattr(STDIN_FILENO, TCSANOW, &newt);
        ch = getchar();
        tcsetattr(STDIN_FILENO, TCSANOW, &oldt);
#else
        static_assert(false, "Unknown Platform");
#endif
        if (printWhenPressed)
        {
            Console::Write(String(1, ch), foreground, background, styles);
        }
        return ch;
    }
};

int main()
{

    //u8"" 4 char units

    char charPadding = u8'@';
    std::string stringPadding = u8"<>"s;
    std::string unicodeStringPadding = u8""s;

    std::locale::global(std::locale(u8"en_US.UTF8"));

    //No UTF8 examples
    String str = u8"Hello "s;
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadLeft(str, 10, charPadding) + u8" █ PadLeft with char padding");//"Hello " No changes. Length 10 == totalWith 10
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadLeft(str, 15, charPadding) + u8" █ PadLeft with char padding");//"@@@@@Hello "

    str = u8"Hello "s;
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadRight(str, 10, charPadding) + u8" █ PadRight with char padding");//"Hello " No changes. Length 10 == totalWith 10
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadRight(str, 15, charPadding) + u8" █ PadRight with char padding");//"Hello @@@@@"

    str = u8"Hello "s;
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadLeft(str, 10, stringPadding) + u8" █ PadLeft with string padding");//"Hello " No changes. Length 10 == totalWith 10
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadLeft(str, 15, stringPadding) + u8" █ PadLeft with string padding");//"<<><>Hello "

    str = u8"Hello "s;
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadRight(str, 10, stringPadding) + u8" █ PadRight with string padding");//"Hello " No changes. Length 10 == totalWith 10
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadRight(str, 15, stringPadding) + u8" █ PadRight with string padding");//"Hello <><><"

    //UTF8 Examples
    str = u8"Hello "s;
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadLeftUTF8(str, 7, charPadding) + u8" █ PadLeftUTF8 with char padding");//"Hello " No changes. UTF8Length 7 == totalWith 7
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadLeftUTF8(str, 15, charPadding) + u8" █ PadLeftUTF8 with char padding");//"@@@@@@@@Hello "

    str = u8"Hello "s;
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadRightUTF8(str, 7, charPadding) + u8" █ PadRightUTF8 with char padding");//"Hello " No changes. UTF8Length 7 == totalWith 7
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadRightUTF8(str, 15, charPadding) + u8" █ PadRightUTF8 with char padding");//"Hello @@@@@@@@"

    str = u8"Hello "s;
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadLeftUTF8(str, 7, unicodeStringPadding) + u8" █ PadLeftUTF8 with string padding");//"Hello " No changes. UTF8Length 7 == totalWith 7
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadLeftUTF8(str, 15, unicodeStringPadding) + u8" █ PadLeftUTF8 with string padding");//"Hello "

    str = u8"Hello "s;
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadRightUTF8(str, 7, unicodeStringPadding) + u8" █ PadRightUTF8 with string padding");//"Hello " No changes. UTF8Length 7 == totalWith 7
    Console::WriteLine(u8"Original: " + str + u8" █ StrLength: " + std::to_string(str.length()) + u8" █ UTF8Chars: " + std::to_string(Strings::LengthUTF8(str)) + u8" █ Padded:" + Strings::PadRightUTF8(str, 15, unicodeStringPadding) + u8" █ PadRightUTF8 with string padding");//"Hello "

    Console::WriteLine();
    Console::WriteLine(u8"Press any key to exit"s, ConsoleForeground::DARK_GRAY);
    Console::PauseAny();

} 
```

**输出**

```
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello  █ PadLeft with char padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:@@@@@Hello  █ PadLeft with char padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello  █ PadRight with char padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello @@@@@ █ PadRight with char padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello  █ PadLeft with string padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:<<><>Hello  █ PadLeft with string padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello  █ PadRight with string padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello <><>< █ PadRight with string padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello  █ PadLeftUTF8 with char padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:@@@@@@@@Hello  █ PadLeftUTF8 with char padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello  █ PadRightUTF8 with char padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello @@@@@@@@ █ PadRightUTF8 with char padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello  █ PadLeftUTF8 with string padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello  █ PadLeftUTF8 with string padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello  █ PadRightUTF8 with string padding
Original: Hello  █ StrLength: 10 █ UTF8Chars: 7 █ Padded:Hello  █ PadRightUTF8 with string padding 
```

*使用新的[Windows 终端](https://docs.microsoft.com/en-us/windows/terminal/)*可以绘制 unicode glyps-emoticons。将 Microsoft Visual C++ 编译器与 Visual Studio + /std:c++17 + /utf-8 一起使用：

[![Windows 终端、windows、visual studio、msvc](https://i.stack.imgur.com/3XMam.png)](https://i.stack.imgur.com/3XMam.png)

*使用经典控制台 cmd.exe*绘制效果不佳

[![cmd, windows, 视觉工作室, msvc](https://i.stack.imgur.com/x0Xdy.png)](https://i.stack.imgur.com/x0Xdy.png)

*repl.it 中的输出，使用 Linux + Clang + std=c++17 [https://repl.it/@JomaCorpFX/Padding#main.cpp](https://repl.it/@JomaCorpFX/Padding#main.cpp)*

[![Linux，铿锵](https://i.stack.imgur.com/R5Aq8.png)](https://i.stack.imgur.com/R5Aq8.png)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-01-19T17:42:31.483

我正在寻找这个话题，因为我正在开发 VCL；无论如何，制作一个函数并不是那么难。

```
void addWhiteSpcs(string &str, int maxLength) {
    int i, length;

    length = str.length();
    for(i=length; i<maxLength; i++)
    str += " ";
};

string name1 = "johnny";
string name2 = "cash";

addWhiteSpcs(name1, 10);
addWhiteSpcs(name2, 10); 
```

在这两种情况下，它都会在右侧添加 10 个空格。我建议使用 courier 或 consolas 等等宽字体以获得正确的格式。

当您不使用等宽字体
johnny____
cash______时会发生这种情况

```
// using monospace font the output will be
johnny____
cash______ 
```

两种情况的长度相同。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-11-03T15:26:32.377

如果您想在不使用流的情况下进行填充：

```
std::size_t pad_size = 10, value = 123;
std::string t = std::string(pad_size , ' ') + std::to_string(value);
std::string padded = t.substr(std::min(t.size() - pad_size, pad_size)); 
```

[在线尝试！](https://tio.run/##ZY7BDoIwEETv/YpNPAARDOoNkF8htW1Ik1II3XrQ@O11LYok9jSdmX0ZMU2FMNz2Iey0FcZLBY0eHc6KDy37eeRo27eMaYswcG3TDB4M6DmUVeX0XXUIE5fdW8IFjmUON2581KdzvelGFCAFm3@63uaQQJLBfklx7D6FSMv@QXQolSQaHpy/kpnGdKCN5BCRphbrtHxV2ZYlRo/QNF8YqWgrK83SmhX62UJZs2cILw "C++ (clang) – 在线试用")

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2021-02-01T18:32:57.623

这个怎么样：

```
const int column_len = 50;
string s;
s = "....some value ... ";
int fill_pad = column_len - s.length();
std::cout << s << std::setw(fill_pad) << " Second column " << other_field << std::endl; 
```

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2009-03-20T17:39:42.723

创建一个包含 10 个空格的新字符串，并在两个字符串中向后工作。

```
string padstring(const string &source, size_t totalLength, char padChar)
{
    if (source.length() >= totalLength) 
        return source;

    string padded(totalLength, padChar);
    string::const_reverse_iterator iSource = source.rbegin();
    string::reverse_iterator iPadded = padded.rbegin();
    for (;iSource != source.rend(); ++iSource, ++iPadded)
        *iPadded = *iSource;
    return padded;
} 
```

# sql-server - 如何阻止奇怪的用户尝试连接到我的 SQL 服务器数据库？

> ID：667192
> 
> 赞同：2
> 
> 时间：2009-03-20T17:40:27.153
> 
> 标签：sql-server, sql-server-2005, security

我在服务器上有一个 asp.net 网站，在另一台服务器上有 db MS SQL 2005，最近几天该网站向我显示此错误消息：“在建立与 SQL Server 的连接时发生网络相关或特定于实例的错误。找不到或无法访问服务器。验证实例名称是否正确以及 SQL Server 是否配置为允许远程连接。（提供程序：命名管道提供程序，错误：40 - 无法打开与 SQL Server 的连接）"

当我打开我在事件查看器中找到的数据库服务器时，我发现有很多从奇怪的 IP 登录到 sql 服务器失败，这不是我们的，我认为他们正在尝试破解数据库，注意数据库是窗口验证。

我的问题是，如何阻止它？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-20T17:43:48.983

您可以做的最好的事情是拒绝访问您的防火墙上的服务器的 SQL 端口。该请求永远不会到达您的服务器，您会很高兴。您可能想拒绝 1433 和 1444。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T23:54:22.883

您需要将防火墙设置为拒绝外部世界对 SQL Server 的任何访问。您可能还想拒绝外部世界在 80 和 443 以外的任何端口（使用 SSL）上访问您的网络服务器。否则，您只是要求您的服务器被闯入（如果他们还没有被闯入）。

如果您的服务器与您位于不同的站点，或者您的办公室在您的办公室和服务器之间设置站点到站点 VPN，以便您可以直接访问。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-20T17:47:41.970

限制 IP 或只允许某些 Mac 的，寻找可以为您提供此功能的好的防火墙

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-23T13:04:18.087

听起来像是妥协，或者至少有人在“修补”Web/Apps 层或数据库。如果您将数据库实例直接暴露在 Internet 上，则后者会表现出来——我真诚地希望您没有这样做。如果是（发表评论，我会离线跟进）.....似乎有人发起了多个连接请求以暴力登录帐户。如果您有一个实施锁定的密码策略，那么他们很可能会将其淘汰。SQL 帐户？嗯，如果是我，我会先尝试“sa”。不是web实例找不到数据库吗？

从 Chip Andrews 网站[http://sqlsecurity.com](http://sqlsecurity.com)查看原理。另外，IIS 配置和底层 Windows O/S 是否被锁定？

下一步 .....

您的 ASP 应用程序/Web 层如何连接到 SQL 后端？通过存储过程或运行中的 SQL？在任何一种情况下，仍有误用的机会。

例如，从 SQL2005 开始，更有趣的存储过程（例如 xp_cmdshell）被禁用。如果您尚未从系统中删除 dll，您仍然可以启用它们，即

exec sp_configure '显示高级选项', 1 exec sp_configure 重新配置 exec sp_configure '显示高级选项', 1 exec sp_configure 'xp_cmdshell', 1 exec sp_configure 重新配置

如果您正在使用 SQL，请查看本网站推荐的输入验证技术。

该网站是否提供任何上传区域？

如果您已经实现了 Windows 集成身份验证，如果有人通过 Web/App 间接呈现的界面访问了您的 SQL 服务器，那么他们可以将自己设置为域管理员并拥有您的整个 Windows 资产。

干杯。顺便说一句，在 IP 方面......欧洲的[http://www.ripe.net/](http://www.ripe.net/)和美国的 ARIN（也是 samspade.org）可能有助于确定那些流氓源 IP 地址。如果这些 IP 是在英国的 BT 等大型服务提供商之一注册的，您可能无法对这些信息做很多事情，但您永远不知道

# iphone - 检测 iPhone/iPod Touch 配件

> ID：667196
> 
> 赞同：10
> 
> 时间：2009-03-20T17:41:29.100
> 
> 标签：iphone, objective-c, ipod-touch

是否可以检测 iPod Touch/iPhone 是否连接了任何耳机或其他配件？

我正在构建一个需要麦克风的应用程序，并且需要通过底座连接或使用耳机端口（例如 Apple 的嵌入式耳机/麦克风配件）知道“iSomething”是否已连接。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-20T22:43:02.540

终于找到了——初始化Audio Session对象后——AudioSessionInitialize()——可以调用AudioSessionGetProperty，得到kAudioSessionProperty_AudioInputAvailable的值。

```
AudioSessionInitialize(NULL, NULL, NULL, NULL);    
UInt32 propertySize, micConnected;
    AudioSessionGetProperty(kAudioSessionProperty_AudioInputAvailable, &propertySize, &micConnected);
    [self updateMicStatus:micConnected]; // user-created method 
```

根据音频会话服务的文档，应该使用它而不是使用设备模型（iPhone 与 iPod Touch）来确定音频输入是否可用。您还可以设置一个回调函数，通过 AudioSessionAddPropertyListener() 来监控此属性的更改。

尚不确定此属性是否也适用于通过 Dock 连接器连接的设备，但它似乎适用于耳机插孔。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-12-28T15:36:15.870

或者你可以使用：

```
if (![[AVAudioSession sharedInstance] inputIsAvailable]) {
    // your code here for no audio input available
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-09-24T15:28:01.470

在**IOS 6** `inputIsAvailable`中已**弃用**。将来我们需要使用`inputAvailable`：

```
BOOL audioHWAvailable = audioSession.inputAvailable; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T19:04:43.067

要确定设备是否具有内置麦克风，您可以通过`[UIDevice currentDevice].model`查看它是 iPhone 还是第二代 iPod Touch。至于第三方麦克风插入底座连接器，这在当前的 2.2.1 SDK 中是不可能的，但它可能会在以后的版本中:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-27T21:01:25.840

这是解决方案，您可能喜欢它或对您有帮助。

在使用以下方法之前，请同时写下这两行

```
UInt32 audioRouteOverride = kAudioSessionOverrideAudioRoute_None;
    AudioSessionSetProperty (kAudioSessionProperty_OverrideAudioRoute,sizeof (audioRouteOverride),&audioRouteOverride);

- (void)isHeadsetPluggedIn {

    UInt32 routeSize = sizeof (CFStringRef);
    CFStringRef route;

    AudioSessionGetProperty (kAudioSessionProperty_AudioRoute,
                                              &routeSize,
                                              &route);

    //NSLog(@"Error >>>>>>>>>> :%@", error);
    /* Known values of route:
     * "Headset"
     * "Headphone"
     * "Speaker"
     * "SpeakerAndMicrophone"
     * "HeadphonesAndMicrophone"
     * "HeadsetInOut"
     * "ReceiverAndMicrophone"
     * "Lineout"
     */

    NSString* routeStr = (NSString*)route;

    NSRange headsetRange = [routeStr rangeOfString : @"Headset"];
    NSRange receiverRange = [routeStr rangeOfString : @"Receiver"];

    if(headsetRange.location != NSNotFound) {
        // Don't change the route if the headset is plugged in.
        NSLog(@"headphone is plugged in ");
    } 
    else if (receiverRange.location != NSNotFound) {
        // Change to play on the speaker
        NSLog(@"play on the speaker");

    } 
    else {
        NSLog(@"Unknown audio route.");

    }
} 
```

# html - 指定制表符宽度？

> ID：667200
> 
> 赞同：65
> 
> 时间：2009-03-20T17:42:32.560
> 
> 标签：html, css, xhtml, whitespace

是否可以在显示空白时定义制表符宽度（例如在 <pre> 标记或其他内容中）？我找不到任何可以使用 CSS 执行此操作的内容，但这似乎是一件很常见的事情。

在我的例子中，标签宽度太宽了，以至于我在页面上的一些代码片段太宽了。如果我能以某种方式缩短制表符宽度以使其适合没有滚动条，那会让事情变得更容易。（我想我可以用空格替换制表符，但理想情况下我很想找到一种方法来做到这一点而不这样做）

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2011-12-29T00:27:29.760

使用[tab-size 属性](http://www.w3.org/TR/css3-text/#tab-size)。您目前需要供应商前缀。例子：

```
pre
{
    -moz-tab-size: 4;
    -o-tab-size:   4;
    tab-size:      4;
} 
```

另请参阅 developer.mozilla.org 上的文章：[tab-size](https://developer.mozilla.org/en-US/docs/CSS/tab-size)。

```
.tabstop
{
    -moz-tab-size: 4;
    -o-tab-size:   4;
    tab-size:      4;
}
```

```
Unstyled tabs (browser default)
<pre>
	one tab
		two tabs
			three tabs
</pre>

Styled tabs (4em)
<pre class="tabstop">
	one tab
		two tabs
			three tabs
</pre>
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-20T17:45:16.500

我相信这篇[博文](http://blogs.warwick.ac.uk/andrewingram/entry/css_changing_the/)应该可以帮助你：

> 这是一个解决方案，它并不整洁，因为它必须为选项卡的每个实例完成，但它使选项卡占用更少的空间并保留从浏览器复制出来的格式（显然将“A SINGLE TAB HERE”替换为真正的标签，这个博客软件会自动从条目中删除标签）：

```
<span style="display:none">A SINGLE TAB HERE</span><span style="margin-left:YOUR NEW TAB WIDTH"></span> 
```

> 基本上，用该代码片段替换代码中选项卡的每个实例（选择合适的宽度后，您可以很容易地在样式表中完成）。代码人为地插入边距，同时保留代码中的原始选项卡以供复制/粘贴。

顺便说一句，它看起来像是`tab stops`被纳入了[CSS 规范](http://www.w3.org/People/howcome/t/970224HTMLERB-CSS/WD-tabs-970117.html)。

[关于这个主题](https://stackoverflow.com/questions/195991/best-way-to-implement-tab-stops-in-valid-xhtml)还有另一个 Stack Overflow 问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-11-05T01:19:52.793

正如 George Stocker 指出的那样，制表位应该在未来的 CSS 中出现（FF4 应该有），但与此同时......

链接博客文章的问题是从浏览器复制/粘贴时不会复制选项卡。作为替代方法，请尝试以下操作：

```
<style>
.tabspan{
    display:inline:block;
    width:4ex;
}
</style>
<pre>
int main()
{
<span class=tabspan>\t</span>return 0;
}
</pre> 
```

上面的“\t”是实际的制表符。现在它应该正确复制和粘贴。不如在 <pre> 标记上添加 css 属性那么好，但这就是生活。

（PS 回答了这个旧帖子，因为它在谷歌上的“css 标签宽度”很高，我来到这里后不久就想出了这个解决方案。）

# c# - 将控件绑定到类属性——这在技术上可行吗？

> ID：667205
> 
> 赞同：2
> 
> 时间：2009-03-20T17:44:38.123
> 
> 标签：c#, .net, asp.net, vb.net, data-binding

我还没有找到在.Net 中进行两种方式数据绑定的“好”方法。
例如，在目前的 asp.net 中，我不喜欢的一件事是两种方式的数据绑定是在 aspx 页面中进行绑定，即没有编译时检查，即：

```
<asp:TextBox ID="TitleTextBox"
            runat="server"            Text='<%# Bind("Title_oops_spelled_wrong") %>'> 
```

我想要这样的东西：

```
Class Binder
Public Sub BindControl(ctl As Control, objectProperty As ???????)
  '// Add ctl and objectProperty to a collection

End Sub 
```

我不知道的是，在我的示例中如何接收 objectProperty；我想接收对属性的*引用*（即：指针），所以稍后，通过这个引用，我可以读取或写入属性。

这可以通过代表以某种方式完成吗？

更新：
注意，我想将控件*引用*添加到绑定集合，然后该集合将用于绑定和解除绑定。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T14:52:12.023

您是否有理由要避免使用 .NET 数据绑定机制？它已经处理了控件值和类属性值之间的奇偶校验，并提供了丰富的设计时支持。

您可以通过两种方式与数据绑定引擎交互：以编程方式或通过设计器。以编程方式进行基本数据绑定是微不足道的。假设我有一个名为“FooClass”的类，它有一个名为“MyString”的字符串属性。我在一个表单上有一个名为 myTxtBox 的文本框，其中有一个名为 foo 的 FooClass 实例，我想将它绑定到 MyString 属性：

```
myTxtBox.DataBindings.Add("Text", foo, "MyString"); 
```

执行此操作将导致对 TextBox 的更新分配给属性，并且从其他地方对属性的更改将反映在 TextBox 中。

对于更复杂的数据绑定方案，您可能希望在项目中创建一个对象数据源并在表单上放置一个 BindingSource。如果您在创建数据源的特定步骤方面需要帮助，我可以提供帮助，但通常您将在项目中创建源并选择要绑定的类。然后，您可以在窗体上放置一个 BindingSource，将其指向您的对象项目数据源，然后使用 Visual Studio 设计器将控件的属性绑定到对象的属性。然后，将代码中的 DataSource 属性设置为要绑定的类或集合的实例。

附带说明一下，据我所知，没有“属性委托”，因为属性实际上是函数对（get_ 和 set_）。

更新：

在阅读您的评论时，我想指出 .NET 数据绑定，即使在控制级别，也不会自动使用反射。数据绑定是围绕类型描述符和属性描述符构建的，用于绑定控件和数据源。确实，如果其中一方或双方没有实现特定的属性和类型描述，则将使用反射，但任何一方都可以自由地提供自己的不使用反射的描述配置文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T22:31:50.773

Bind 不是一个方法，并且在场景后面没有某个对象持有绑定关系。这只是页面解析器用来生成代码的“神奇”词。从本质上讲，它转化为 Eval 和控制构建代码。另一方面，Eval 将使用反射来访问绑定项的属性。

如果我正确理解您想要的内容，则只读属性绑定已经有效。假设您的班级中有一个属性 Title：

```
<asp:TextBox ID="TitleTextBox" runat="server" Text='<%# Title %>' /> 
```

对于双向绑定，您必须创建自己的模板或反映现有模板并传递 ExtractTemplateValuesMethod 方法并将 DataBinding 事件分配给您的控件。这是 .NET 使用 Eval 的地方，您可以将其替换为属性分配。

在我看来，这就是 DataBinding 事件的用途。

但是，如果您的问题更多是关于是否可以引用属性，那么恐怕不能。每个人都没有财产。您必须方法（获取和设置）和元数据中的条目。您可以存储对对象和属性名称的引用，但是您必须使用反射。

您可以使用委托，但这会将您带回到与 .NET 生成的代码相同的代码，即定义 ExtractTemplateValuesMethod 并无论如何执行 DataBinding。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T23:35:50.980

一种解决方案是通过 objectProperty ByRef。

如果您想要编译时类型检查，您需要为您计划使用的任何类型重载 BindControl。例如：

```
Public Sub BindControl(ctl As ITextControl, ByRef objectProperty As String)
    objectProperty = ITextControl.Text
End Sub

Public Sub BindControl(ctl As ITextControl, ByRef objectProperty As Integer)
    Integer.TryParse(TextControl.Text, objectProperty)
End Sub
.. 
```

# schema - 数据库架构混乱

> ID：667208
> 
> 赞同：3
> 
> 时间：2009-03-20T17:45:25.300
> 
> 标签：schema

当我设计一些课程时，我的术语有些混乱。在 Sql Server 2005 中，“模式”指的是命名空间和数据库对象的组织系统。但是对于一般的关系数据库，“模式”意味着表、字段等的 DDL 设计。如果我对此是正确的，它解释了当我试图阅读微软文档并理解各种数据时的很多不和谐访问 API。你能解释一下这里发生了什么吗，“模式”的定义真的有那么大的不同吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T18:05:32.117

是的，不幸的是，“模式”这个词在数据库供应商中已经被过度使用了。

“ [SQL-99 Complete,真的](https://rads.stackoverflow.com/amzn/click/com/0879305681)”说：

> SQL 目录是一组命名的模式。...
> 
> SQL Schema 是一组命名的 SQL 数据，由特定的 . ...每个模式对象都有一个名称，该名称在其所属的模式中必须是唯一的（在其名称类的对象中）。模式对象名称类是：
> 
> *   基表和视图
> *   域和 UDT
> *   约束和断言
> *   字符集
> *   排序规则
> *   翻译
> *   触发器
> *   SQL 服务器模块
> *   SQL 调用的例程

Oracle 交替使用“模式”和“用户”，这总是让我大吃一惊。

MySQL`SCHEMA`用作`DATABASE`.

PostgreSQL 使用“模式”但使用“数据库”来指代标准 SQL 所称的“目录”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T17:54:50.737

你是对的。在 SQL 2005/2008 中，“模式”指的是命名空间，而在关系数据库讨论中，“模式”指的是表、视图、过程、函数等的逻辑结构。

# html - 为什么我的 YUI 数据表在 IE 中无法正确显示？

> ID：667218
> 
> 赞同：0
> 
> 时间：2009-03-20T17:46:54.297
> 
> 标签：html, internet-explorer, firefox

我设置了一个 YUI 数据表，其中包含大约 90 行数据，我希望用户按照他们认为合适的方式对列进行排序，然后打印页面。

我已经设置了所有 YUI 的东西，而且效果很好。但是，在打印时，它会删除所有颜色，并使用表格布局。

我添加了这个：

```
[
H1 { 
    text-align: center 
}

.hideOnPrint { visibility: hidden; display: none; }

.yui-skin-sam .yui-dt table {
    font-size:10px;
    border:1px solid #808080;
    border-collapse:collapse;border-spacing:1;
}
.yui-skin-sam .yui-dt thead {
    text-align:center;
    font-family:"Lucida Grande","Verdana",sans-serif;
    font-size:12px;
    font-weight:bold;
    font-style:italic;
    display: table-header-group;
}

.yui-skin-sam tr {
    border:1px solid #888888;
}
] 
```

它现在在 Firefox 3 中可以正常打印，但是在 IE7 中效果不佳。

Firefox 3 采用大约 1.5 页长的表格，并将其切成 2/3 在一个 oage 上，在另一个 1/3 上，两个页面都有标题、标题并且格式正确。

在 IE7 中，它将数据切成两半，并在两页上复制前半部分数据。

我不确定这是因为 YUI 标记，还是 IE 需要一些特殊设置，或者是什么。

这是页面：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Intercom List</title>

<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.7.0/build/fonts/fonts-min.css" />
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.7.0/build/datatable/assets/skins/sam/datatable.css" />

<style type="text/css">
/*margin and padding on body element
  can introduce errors in determining
  element position and are not recommended;
  we turn them off as a foundation for YUI
  CSS treatments. */
body {
    margin:0;
    padding:0;
}

H2 { 
    font-size: 10px;
    font-style: italic;
 }

/* basic skin styles */
.yui-skin-sam .yui-dt table {
    filter: alpha(opacity=100);margin:0;padding:2,3,2,3;text-align:center;font-family:"Lucida Grande","Verdana",sans-serif;font-size:11px;border-collapse:separate;*border-collapse:collapse;border-spacing:0;}
.yui-skin-sam .yui-dt thead {border-spacing:0;border:none;border-right:0px solid #CBCBCB;} /* for safari bug */
.yui-skin-sam .yui-dt caption {padding-bottom:0em;text-align:left;}

.yui-skin-sam tr.yui-dt-even { background-color:#DFD2C2; } /* white */
.yui-skin-sam tr.yui-dt-odd { background-color:#F3ECE4; } /* light blue */
.yui-skin-sam tr.yui-dt-even td.yui-dt-asc,
.yui-skin-sam tr.yui-dt-even td.yui-dt-desc { background-color:#D3C7B8; } /* light blue sorted EDF5FF */
.yui-skin-sam tr.yui-dt-odd td.yui-dt-asc,
.yui-skin-sam tr.yui-dt-odd td.yui-dt-desc { background-color:#E0D9D2; } /* dark blue sorted DBEAFF */

</style>

 <STYLE type="text/css" media="print">
 H1 { 
    text-align: center 
}

.hideOnPrint { visibility: hidden; display: none; }

.yui-skin-sam .yui-dt table {
    font-size:10px;
    border:1px solid #808080;
    border-collapse:collapse;border-spacing:1;
}
.yui-skin-sam .yui-dt thead {
    text-align:center;
    font-family:"Lucida Grande","Verdana",sans-serif;
    font-size:12px;
    font-weight:bold;
    font-style:italic;
    display: table-header-group;
}

.yui-skin-sam tr {
    border:1px solid #888888;
}
</STYLE>

<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/yahoo-dom-event/yahoo-dom-event.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/dragdrop/dragdrop-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/element/element-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/datasource/datasource-min.js"></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/datatable/datatable-min.js"></script>

<!--begin custom header content for this example-->
<style type="text/css">
/* custom styles for this example */
.yui-skin-sam .yui-dt-liner { white-space:nowrap; } 
</style>

<!--end custom header content for this example-->

</head>

<body class="yui-skin-sam">

<h1>INTERCOM List</h1>

<!--BEGIN SOURCE CODE FOR EXAMPLE =============================== -->

<div class="hideOnPrint"> <h2>Order List by clicking on the column header, resort the list by clicking and dragging the column header, resize the column by clicking on the devider line and dragging left or right.</h2></div>

<div id="intercomList"></div>

<script type="text/javascript" src="employee data.js"></script>

<script type="text/javascript">

YAHOO.util.Event.addListener(window, "load", function() {
    YAHOO.example.Basic = function() {

        var sortLastName = function(a, b, desc) {
            // Deal with empty values
            if(!YAHOO.lang.isValue(a)) {
                return (!YAHOO.lang.isValue(b)) ? 0 : 1;
            }
            else if(!YAHOO.lang.isValue(b)) {
                return -1;
            }

            // First compare by lastname
            var comp = YAHOO.util.Sort.compare;
            var compState = comp(a.getData("lastname"), b.getData("lastname"), desc);

            // If states are equal, then compare by firstname
            return (compState !== 0) ? compState : comp(a.getData("firstname"), b.getData("firstname"), desc);
        };

        var sortFirstName = function(a, b, desc) {
            // Deal with empty values
            if(!YAHOO.lang.isValue(a)) {
                return (!YAHOO.lang.isValue(b)) ? 0 : 1;
            }
            else if(!YAHOO.lang.isValue(b)) {
                return -1;
            }

            // First compare by firstname
            var comp = YAHOO.util.Sort.compare;
            var compState = comp(a.getData("firstname"), b.getData("firstname"), desc);

            // If states are equal, then compare by lastname
            return (compState !== 0) ? compState : comp(a.getData("lastname"), b.getData("lastname"), desc);
        };

        var sortBuildingName = function(a, b, desc) {
            // Deal with empty values
            if(!YAHOO.lang.isValue(a)) {
                return (!YAHOO.lang.isValue(b)) ? 0 : 1;
            }
            else if(!YAHOO.lang.isValue(b)) {
                return -1;
            }

            // First compare by firstname
            var comp = YAHOO.util.Sort.compare;
            var compState = comp(a.getData("building"), b.getData("building"), desc);

            var compState2 = (compState !== 0) ? compState : comp(a.getData("firstname"), b.getData("firstname"), desc);

            // If states are equal, then compare by lastname
            return (compState2 !== 0) ? compState2 : comp(a.getData("lastname"), b.getData("lastname"), desc);
        };

        var sortCompanyName = function(a, b, desc) {
            // Deal with empty values
            if(!YAHOO.lang.isValue(a)) {
                return (!YAHOO.lang.isValue(b)) ? 0 : 1;
            }
            else if(!YAHOO.lang.isValue(b)) {
                return -1;
            }
            // First compare by firstname
            var comp = YAHOO.util.Sort.compare;
            var compState = comp(a.getData("company"), b.getData("company"), desc);

            var compState2 = (compState !== 0) ? compState : comp(a.getData("firstname"), b.getData("firstname"), desc);

            // If states are equal, then compare by lastname
            return (compState2 !== 0) ? compState2 : comp(a.getData("lastname"), b.getData("lastname"), desc);
        };

        var myColumnDefs = [
            {key:"extension", width: 65, sortable:true, resizeable:true},
            {key:"firstname", width: 100, sortOptions:{sortFunction:sortFirstName}, sortable:true, resizeable:true},
            {key:"lastname", width: 100, sortOptions:{sortFunction:sortLastName}, sortable:true, resizeable:true},
            {key:"company", width: 100, sortOptions:{sortFunction:sortCompanyName}, sortable:true, resizeable:true},
            {key:"building", width: 100, sortOptions:{sortFunction:sortBuildingName}, sortable:true, resizeable:true}
        ];

        var myDataSource = new YAHOO.util.DataSource(YAHOO.Data.employees);
        myDataSource.responseType = YAHOO.util.DataSource.TYPE_JSARRAY;
        myDataSource.responseSchema = {
            fields: ["extension","firstname","lastname","company","building"]
        };

        var myDataTable = new YAHOO.widget.DataTable("intercomList",
                myColumnDefs, myDataSource, {draggableColumns:true});

        return {
            oDS: myDataSource,
            oDT: myDataTable
        };
    }();
});
</script>

<!--END SOURCE CODE FOR EXAMPLE =============================== -->

</body>
</html> 
```

这是员工数据文件：

```
YAHOO.Data = {
    employees: [
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"},
        {extension:"265", firstname:"firstname", lastname:"lastname", company:"company", building:"st addresss"}
    ]
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T18:28:03.903

Have you tried specifying a specific print stylesheet?

BTW, Prob better to link to a working version of the code, rather than expect stackoverflow users to recreate locally.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-07T13:04:46.467

默认情况下，所有浏览器中的背景图像和颜色都将被禁用。只要启用它，它就会正确打印。

问候 Kailash Kumar P 电子邮件：kailashkumarp@gmail.com

# css - CSS 优先级

> ID：667223
> 
> 赞同：26
> 
> 时间：2009-03-20T17:47:45.027
> 
> 标签：css

我的网页包含：

```
<link href="/Content/Site.css" rel="stylesheet" type="text/css" />
<style type="text/css">
td {
    padding-left:10px;
} 
</style> 
```

引用的样式表包含：

```
.rightColumn * {margin: 0; padding: 0;} 
```

我在 ID 中有一个表格`rightcolumn`，我希望单元格有一点填充。但是，引用的样式表优先于内联样式。我通过 Firebug 直观地看到了这一点。如果我在 Firebug 中关闭`padding:0`指令，padding-left 就会生效。

我怎样才能让它`padding-left`工作？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-20T19:21:26.643

大多数答案在说这是一个特异性问题时是正确的，但在解释特异性规则时是不正确或不完整的。

基本上，在您的情况下，`.rightColoumn *`它比“更具体” `td`，因此即使它出现得更早，该规则也会获胜。

[CSS 2.1 规则位于此处](http://www.w3.org/TR/CSS21/cascade.html#specificity)。这些规则是：

*   计数 1 如果声明来自是“样式”属性而不是带有选择器的规则，否则为 0 (= a) （在 HTML 中，元素的“样式”属性的值是样式表规则。这些规则没有选择器，所以 a=1、b=0、c=0 和 d=0。）
*   统计选择器中 ID 属性的数量（= b）
*   计算选择器中其他属性和伪类的数量（= c）
*   计算选择器中元素名称和伪元素的数量（= d）

连接四个数字 abcd（在具有大基数的数字系统中）给出了特异性。

因此，在您的情况下，您有两个规则：

```
.rightColumn * {} /* a = 0, b = 0; c = 1, d = 0 : Specificity = 0010*/
td {} /* a = 0, b = 0, c = 0, d = 1 : Specificity = 0001 */ 
```

0001 低于 0010，因此第一条规则获胜。

有两种方法可以解决此问题：

1.  用于`!important`使规则更“重要”。我会避免这样做，因为当您将大量规则分布在多个文件中时，这会让人感到困惑。
2.  为要修改的 td 使用更高特异性的选择器。您可以为其添加类名或 id，这将允许您取代链接的 CSS 文件中的规则。

例子：

```
<style>
  .rightColomn * { padding: 0; } /* 0010 */
  td#myUnpaddedTable { padding: 10px; } /* 0101 */
  td.anUnpaddedTable { padding: 10px; } /* 0011 */ 
</style> 
```

**编辑：**修复了 *. 大卫的评论促使我重新阅读规范，这确实表明 * 选择器对特异性得分没有任何贡献。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-20T18:17:21.527

正如其他人所提到的，您有一个特异性问题。在确定两个规则中的哪一个应该优先时，CSS 引擎会计算`#id`每个选择器中 s 的数量。如果一个比另一个多，它就会被使用。否则，它会继续以相同的方式比较`.class`es 和`tag`s。在这里，您在样式表规则上有一个类，但在内联规则上没有，因此样式表优先。

你可以用 覆盖它`!important`，但这是一个非常大的锤子在这里使用。你最好提高你的内联规则的特异性。根据您的描述，听起来您的`.rightColumn`元素是或包含 a`table`并且您希望该表中的单元格有额外的间距？如果是这样，您要查找的选择器是“ `.rightColumn td`”，它比样式表规则更具体，并且优先。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-20T17:52:04.300

让它工作的最简单方法是在 CSS 中添加 "!important" 以保证它的优先级（除非你有多个 !important 规则）：

```
td {
    padding-left: 10px !important;
} 
```

如果你正在寻找一个没有 !important 的答案，你应该阅读[CSS specificity specification](http://www.w3.org/TR/CSS2/cascade.html#specificity)。链接的站点很好地解释了它的工作原理，尽管基本上它从最重要到最不重要，id 选择器最重要，类选择器第二，元素选择器第三。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T17:52:15.860

试试这个：

```
td.rightColumn * {margin: 0; padding: 0;} 
```

`td`外部样式表中的 更具体，因此胜出。如果您`rightColumn`使用元素名称限定类，则将应用页面级样式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-20T17:53:20.973

您可以尝试添加！内联 CSS 的重要标志。

例如

td { padding-left:10px ！重要的; }

此外，有关 css 规则排序的一般规则，请查看以下内容：

[http://www.w3.org/TR/CSS2/cascade.html#specificity](http://www.w3.org/TR/CSS2/cascade.html#specificity)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-20T17:53:48.353

做这个：

```
.rightColumn *,
td.rightColumn * {
  margin: 0;
  padding: 0;
} 
```

CSS中的优先级如下：

*   如果某个规则有一个 ID，那么它将在任何其他规则之前。
*   如果某些规则具有类属性，它将位于仅标记规则之前。
*   如果两条规则都有ID或标签，那么它们的数量就可以解开“战斗”。

例子：

```
<style type="text/css">
  #myid{
    padding: 10px;
  }

  .class{
    padding: 20px;
  }
</style>
<div id="myid" class="class"></div> 
```

尽管您的 div 既有 ID 又有一个类，但 ID 规则将覆盖 .class 规则。

要阅读有关 CSS 规则优先级的更多信息，我推荐[http://www.w3.org/TR/CSS2/cascade.html#specificity](http://www.w3.org/TR/CSS2/cascade.html#specificity)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-03-01T20:26:41.977

好的，我承认我在这里玩游戏有点晚了..但是3年过去了，我想我仍然可以为第一名的答案射击..

我的回答中的额外调味料是有一个具有 2 级类名的 css 示例..

在下面的示例中，您可以看到没有类的“td”获得“.interval td”样式，而带有“indragover”类的 td 获得“table.interval td.indragover”样式。

（此代码用于 html 拖放，因此有一些 javascript 将 'indragover' 类应用于 dragenter、dragleave 事件中的 td）

```
// put this in a css file
.interval {
    height: 100%;
    width: 100%;
    background: #FFFFCC;
    border: 2px solid #000000;
    border-collapse: collapse;
}

table.interval tr td {
    border: 2px solid black;
    color:#112ABB;
    background: #FFFFCC;
    height: 20px;
}

table.interval td.indragover {
    background: #AAAA00;
}

// put this in a html file
<table class="interval">
<tr><td>blah</td><td class="indragover">blah</td></tr>
<tr><td class="indragover">blah</td><td>blah</td></tr>
</table> 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2015-09-29T19:54:35.670

```
1.div p.bio {font-size: 14px}
#sidebar p {font-size: 12px} 
```

乍一看，CSS 的第一行可能看起来更具体，但实际上上面的第二行更具体到段落的字体大小。

An`id`比 a 更具体`class`，后者比元素更具体。

```
2.p {font-size: 12px}
p.bio {font-size: 14px} 
```

当涉及到您的段落时，CSS ( ) 的第二行`p.bio`比第一行更具体。`class="bio"`

的优先级`class`高于`p`元素。

# asp.net - 当 StackedBar 中的值为零时如何隐藏数据点标签

> ID：667228
> 
> 赞同：7
> 
> 时间：2009-03-20T17:48:49.720
> 
> 标签：asp.net, charts, mschart

我有一个 StackedBar，每条显示 5 个值，数据值显示在每个块的中间。到目前为止，一切都很好。但是，当值为零时，仍然显示该值，当有很多零时，这很混乱。

我希望能够将标签隐藏为零。我怎样才能做到这一点？

（我想我可以通过逐行读取数据并逐步构建图表来完成这项工作，但我更希望能够将查询结果扔给控件）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-08T15:03:08.623

您可以在自定义事件中隐藏标签：

```
protected void SummaryChart_Customize(object sender, EventArgs e)
{
    //hide label value if zero
    foreach (System.Web.UI.DataVisualization.Charting.Series series in SummaryChart.Series)
    {
        foreach (System.Web.UI.DataVisualization.Charting.DataPoint point in series.Points)
        {
            if (point.YValues.Length > 0 && (double)point.YValues.GetValue(0) == 0)
            {
                point.IsValueShownAsLabel = false;
            }
            else
            {
                point.IsValueShownAsLabel = true;
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-02-29T05:26:00.147

吉姆的解决方案对我不起作用，但我是这样做的，利用他的一些代码 - 谢谢吉姆！

1.  在 Designer 中，在相关 Series 元素下设置 EmptyPointStyle 元素。这应该将值设置为不显示为标签，而不是在图例中。
2.  在代码隐藏中，使用 DataBound 或 Customize 事件通过将其 IsEmpty 属性设置为 True 来隐藏零​​点。

**代码：**

1.  在 ASPX 中：

    ```
     <Series>
            <asp:Series ChartType="Pie" Name="Series1" ..etc....>
                <EmptyPointStyle IsValueShownAsLabel="false" IsVisibleInLegend="false" />              
            </asp:Series>
      </Series> 
    ```

2.  在后面的代码中（是的，在这里使用 VB！）：

（注意：我还必须分解这个特定饼图上的所有点，这与这个问题无关，但我把它留在了，以防它帮助某人。）

```
Protected Sub Chart1_DataBound(sender As Object, e As EventArgs) Handles Chart1.DataBound
    Dim chart As Chart = TryCast(sender, Chart)

    If chart IsNot Nothing Then
        ' Explode all points
        For Each p As DataPoint In chart.Series(0).Points
            p.CustomProperties = "Exploded=true"

            ' Remove zero points
            If p.YValues.Length > 0 AndAlso p.YValues.GetValue(0) = 0 Then
                p.IsEmpty = True
            End If
        Next
    End If
End Sub 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-09-13T11:45:14.597

这对我来说非常适合

```
 foreach (System.Web.UI.DataVisualization.Charting.Series series in SummaryChart.Series)
  {
    foreach (System.Web.UI.DataVisualization.Charting.DataPoint point in series.Points)
    {
        if (point.YValues.Length > 0 && (double)point.YValues.GetValue(0) == 0)
        {
                point.LegendText = point.AxisLabel;//In case you have legend
                point.AxisLabel = string.Empty;
                point.Label = string.Empty;
        }
    }
  } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-12T17:54:45.380

使用抑制零的自定义数字格式，例如

一般的;;;

0.0%;;;

$#,##0.00;;;

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-11-29T08:06:14.990

这工作正常（我只测试了一个系列）

```
foreach (System.Windows.Forms.DataVisualization.Charting.DataPoint point in chartShow.Series["S3"].Points)
{
     if (point.YValues.Length > 0 && (double)point.YValues.GetValue(0) == 0)
     {
          point.IsEmpty = true;
     }
     else
     {
          point.IsEmpty = false;
     }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-12-05T09:13:09.760

这对我有用

```
For Each s As Series In Chart1.Series
    For Each dp As DataPoint In s.Points
        If dp.YValues(0) = 0 Then
            dp.IsEmpty = True
        End If
    Next
Next 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-21T21:44:51.947

我遇到了同样的问题，我使用以下数字格式解决了它

```
[=0]"";0.0% 
```

第一部分：

```
[=0]"" 
```

意味着：如果值等于零，它应该显示一个空字符串

第二部分：

```
0.0% 
```

在这种特定情况下，意味着所有其他值应显示为带一位小数的百分比。任何数字格式都可以用作第二部分。

```
[=0];General (Standard in some localized versions of Excel) 
```

可用于使用默认格式。

使用 VBA 将是：

```
Dim area as range
'The data area for the chart'
set area = Sheet1.range("A1:B3")
area.NumberFormat = "[=0];General" 
```

# blackberry - 默认 SSH/Telnet 终端大小

> ID：667229
> 
> 赞同：2
> 
> 时间：2009-03-20T17:48:54.417
> 
> 标签：blackberry, ssh, terminal, telnet

我正在为黑莓（以及其他手持设备）编写一个 SSH/Telnet 客户端。

我的问题更多与可用性有关。由于某些设备和分辨率的屏幕尺寸限制，我应该如何设置屏幕的默认行/列？

目前我将其设置为 80 列。行数取决于防止滚动的字体大小。

我听说 80x24 是大多数终端类型的事实上的默认值。这是真的？

对于那些 SSH/Telnet 用户，您希望如何为手持设备上的终端客户端默认设置行/列？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T18:00:58.053

[80×25](http://en.wikipedia.org/wiki/80x25)实际上更典型。

顺便提一句。不了解黑莓，但对于其他智能手机和手持设备，有[PuTTY](http://en.wikipedia.org/wiki/PuTTY)端口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T18:02:01.140

我更喜欢检测终端大小的应用程序（具有`stty -a`或道德等价物），并且大多数应用程序都这样做。所以我认为更重要的问题是，您的客户是否正确地向远程应用程序报告大小，以便他们可以相应地调整自己的大小？

PS 我个人会对这样的应用程序感兴趣——现有的黑莓 ssh 客户端不是很好。如果您想跟进，我的用户名后跟我的域名（“现实”）后跟 tld (com) 可用于发送电子信件。（屏幕刮掉，垃圾邮件机器人！）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-18T16:14:29.760

大多数 Telnet 仿真器使用 24x80 模式，用于 VT100 类型的终端。

一些用户更喜欢 XTERM 类型的仿真器，它没有固定的宽度/高度。

[您可以在http://mochasoft.dk/telnetbb.htm](http://mochasoft.dk/telnetbb.htm)看到我的 Telnet - 黑莓的 ssh-2 版本

# java - 如何使用在 Windows 上运行的 Java 服务检测用户活动？

> ID：667233
> 
> 赞同：6
> 
> 时间：2009-03-20T17:49:37.817
> 
> 标签：java, windows, windows-services, android-activity

我的目标是使用 Java 创建一个系统监控应用程序。我想知道用户何时在 Windows PC 上进行活动。结果将是这样的：

8:00 - 8:15 活动

9:12 - 10:29 活动

12:24 - 15:34 活动

我对任何其他信息（按下哪个键、使用的应用程序等）都不感兴趣。只有用户活动。

这在Java中甚至可能吗？我计划将我的 java 应用程序作为服务运行。但至于在用户使用计算机时获取事件，我不知道从哪里开始。

* * *

[编辑] 进一步澄清：我对活动的*细节*不感兴趣，只是用户移动了鼠标或按下了键。我不在乎按下了哪个键，只要我知道在某个应用程序中按下了某个键即可。除了按键和鼠标移动之外，我也不关心任何其他活动（例如，如果 USB 密钥插入 USB 端口，我不感兴趣）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-23T17:33:00.437

您不能直接从服务监控用户活动。该服务将在与用户活动不同的窗口站中运行，因此无法挂接到该活动（除非通过需要用 C 编写的过滤器驱动程序）。

因此，您将需要一个在用户桌面上运行并与键盘和鼠标活动挂钩的客户端应用程序。您可以使用 JNI 通过两次调用 Windows API [SetWindowsHookEx](http://msdn.microsoft.com/en-us/library/ms644990(VS.85).aspx)（用于低级键盘和鼠标挂钩）来实现。为了监视活动，应用程序需要处理键盘和鼠标钩子以获取消息。

您可以通过向注册表的 Run 键添加一个条目来将应用程序作为自动启动启动，或者您可以让您的服务监视器用于会话日志事件并从中[启动应用程序](https://stackoverflow.com/questions/564829/launching-a-net-winforms-application-interactively-from-a-service/564874)。然后，用户会话应用程序可以自己处理信息，也可以通过管道或套接字将其传递给服务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T17:56:09.297

“用户活动”到底是什么意思？您需要首先准确定义该术语才能开始考虑解决方案，尤其是当您说“按下按键、使用应用程序等”时。不是活动。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T16:33:20.697

你可以试试这个[SWT Win32 Extension](http://feeling.sourceforge.net/)。它允许您在 Windows 上从 java 设置键盘和鼠标挂钩。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T19:11:46.557

java平台不直接支持这个

如果您探索 .NET 替代方案，会容易得多。

在 .net 中搜索[捕获全局用户输入](http://www.google.com/search?q=capture+global+user+input+.net)

# rss - 如何将 RSS 提要转换为 Atom，内联？

> ID：667239
> 
> 赞同：2
> 
> 时间：2009-03-20T17:50:33.680
> 
> 标签：rss, atom-feed

我承认在理解 RSS/Atom 提要问题方面有点落后。

我所知道的是，我希望将 Atom 提要转换为内联的 RSS 提要。这意味着我想在某处指定一个选项，说明使用此 xsl 或任何东西将 Atom 提要转换为 RSS 提要。

有没有什么方法不需要在我的本地机器上运行一个单独的监听器来完成翻译？即，我不是直接要求 Atom 提要，而是让我的“服务”来获取提要，对其进行转换并将其提供给真正的订阅者？

对不起（可能）愚蠢的问题。不知何故，我从来没有收到过关于这些东西的备忘录。

谢谢 - 乔恩

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T18:43:04.693

Similar to Paul's answer... we use [Feedburner](http://www.feedburner.com "Feedburner") for feeds - it's trivial to have it convert one type of feed to another.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T18:23:18.530

Atom to RSS on the fly

Sounds like a Yahoo Pipes job to me..

[http://pipes.yahoo.com/pipes/pipe.info?_id=Aj_YHfi62xGuBj4KkAtvUw](http://pipes.yahoo.com/pipes/pipe.info?_id=Aj_YHfi62xGuBj4KkAtvUw)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T13:25:26.380

If you want to write your own, using C#. You would download the Atom and save it as RSS using the [SyndicationFeed](http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication.syndicationfeed.aspx) class. It's about 4 lines of code.

# c# - 如何从 c# 中删除 IIS 对象？

> ID：667243
> 
> 赞同：7
> 
> 时间：2009-03-20T17:51:15.770
> 
> 标签：c#, .net, iis, installation, wmi

作为卸载方法的一部分，我需要从 .NET 中删除虚拟目录和应用程序池。我在网上某处找到了以下代码：

```
 private static void DeleteTree(string metabasePath)
    {
        // metabasePath is of the form "IIS://<servername>/<path>"
        // for example "IIS://localhost/W3SVC/1/Root/MyVDir" 
        // or "IIS://localhost/W3SVC/AppPools/MyAppPool"
        Console.WriteLine("Deleting {0}:", metabasePath);

        try
        {
            DirectoryEntry tree = new DirectoryEntry(metabasePath);
            tree.DeleteTree();
            tree.CommitChanges();
            Console.WriteLine("Done.");
        }
        catch (DirectoryNotFoundException)
        {
            Console.WriteLine("Not found.");
        }
    } 
```

但它似乎抛出了`COMException`一个`tree.CommitChanges();`。我需要这条线吗？这是一个正确的方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T18:07:06.963

如果要删除应用程序池、虚拟目录或 IIS 应用程序等对象，则需要这样做：

```
string appPoolPath = "IIS://Localhost/W3SVC/AppPools/MyAppPool";
using(DirectoryEntry appPool = new DirectoryEntry(appPoolPath))
{
    using(DirectoryEntry appPools = 
               new DirectoryEntry(@"IIS://Localhost/W3SVC/AppPools"))
    {
        appPools.Children.Remove(appPool);
        appPools.CommitChanges();
    }
} 
```

`DirectoryEntry`您为要删除的项目创建一个对象，然后`DirectoryEntry`为其父项创建一个对象。然后，您告诉父级删除该对象。

您也可以这样做：

```
string appPoolPath = "IIS://Localhost/W3SVC/AppPools/MyAppPool";
using(DirectoryEntry appPool = new DirectoryEntry(appPoolPath))
{
    using(DirectoryEntry parent = appPool.Parent)
    {
        parent.Children.Remove(appPool);
        parent.CommitChanges();
    }
} 
```

根据手头的任务，我将使用任何一种方法。

# c++ - Windows中的strptime？

> ID：667250
> 
> 赞同：6
> 
> 时间：2009-03-20T17:52:17.280
> 
> 标签：c++, c, windows, visual-studio, linux

我编写了这个非常好的应用程序，它在 Linux 中运行良好。

它使用 strptime()。Windows没有这个。

有Windows替代品吗？

我的同事需要使用这个应用程序。

（我已经尝试谷歌搜索无济于事）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-11-07T20:15:05.303

我已经编写了一个 strptime，我在 Windows 上使用它来弥补它在 Microsoft C 运行时库中的缺失。这里是：

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <ctype.h>

#ifdef _MSC_VER
const char * strp_weekdays[] = 
    { "sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"};
const char * strp_monthnames[] = 
    { "january", "february", "march", "april", "may", "june", "july", "august", "september", "october", "november", "december"};
bool strp_atoi(const char * & s, int & result, int low, int high, int offset)
    {
    bool worked = false;
    char * end;
    unsigned long num = strtoul(s, & end, 10);
    if (num >= (unsigned long)low && num <= (unsigned long)high)
        {
        result = (int)(num + offset);
        s = end;
        worked = true;
        }
    return worked;
    }
char * strptime(const char *s, const char *format, struct tm *tm)
    {
    bool working = true;
    while (working && *format && *s)
        {
        switch (*format)
            {
        case '%':
            {
            ++format;
            switch (*format)
                {
            case 'a':
            case 'A': // weekday name
                tm->tm_wday = -1;
                working = false;
                for (size_t i = 0; i < 7; ++ i)
                    {
                    size_t len = strlen(strp_weekdays[i]);
                    if (!strnicmp(strp_weekdays[i], s, len))
                        {
                        tm->tm_wday = i;
                        s += len;
                        working = true;
                        break;
                        }
                    else if (!strnicmp(strp_weekdays[i], s, 3))
                        {
                        tm->tm_wday = i;
                        s += 3;
                        working = true;
                        break;
                        }
                    }
                break;
            case 'b':
            case 'B':
            case 'h': // month name
                tm->tm_mon = -1;
                working = false;
                for (size_t i = 0; i < 12; ++ i)
                    {
                    size_t len = strlen(strp_monthnames[i]);
                    if (!strnicmp(strp_monthnames[i], s, len))
                        {
                        tm->tm_mon = i;
                        s += len;
                        working = true;
                        break;
                        }
                    else if (!strnicmp(strp_monthnames[i], s, 3))
                        {
                        tm->tm_mon = i;
                        s += 3;
                        working = true;
                        break;
                        }
                    }
                break;
            case 'd':
            case 'e': // day of month number
                working = strp_atoi(s, tm->tm_mday, 1, 31, 0);
                break;
            case 'D': // %m/%d/%y
                {
                const char * s_save = s;
                working = strp_atoi(s, tm->tm_mon, 1, 12, -1);
                if (working && *s == '/')
                    {
                    ++ s;
                    working = strp_atoi(s, tm->tm_mday, 1, 31, 0);
                    if (working && *s == '/')
                        {
                        ++ s;
                        working = strp_atoi(s, tm->tm_year, 0, 99, 0);
                        if (working && tm->tm_year < 69)
                            tm->tm_year += 100;
                        }
                    }
                if (!working)
                    s = s_save;
                }
                break;
            case 'H': // hour
                working = strp_atoi(s, tm->tm_hour, 0, 23, 0);
                break;
            case 'I': // hour 12-hour clock
                working = strp_atoi(s, tm->tm_hour, 1, 12, 0);
                break;
            case 'j': // day number of year
                working = strp_atoi(s, tm->tm_yday, 1, 366, -1);
                break;
            case 'm': // month number
                working = strp_atoi(s, tm->tm_mon, 1, 12, -1);
                break;
            case 'M': // minute
                working = strp_atoi(s, tm->tm_min, 0, 59, 0);
                break;
            case 'n': // arbitrary whitespace
            case 't':
                while (isspace((int)*s)) 
                    ++s;
                break;
            case 'p': // am / pm
                if (!strnicmp(s, "am", 2))
                    { // the hour will be 1 -> 12 maps to 12 am, 1 am .. 11 am, 12 noon 12 pm .. 11 pm
                    if (tm->tm_hour == 12) // 12 am == 00 hours
                        tm->tm_hour = 0;
                    s += 2;
                    }
                else if (!strnicmp(s, "pm", 2))
                    {
                    if (tm->tm_hour < 12) // 12 pm == 12 hours
                        tm->tm_hour += 12; // 1 pm -> 13 hours, 11 pm -> 23 hours
                    s += 2;
                    }
                else
                    working = false;
                break;
            case 'r': // 12 hour clock %I:%M:%S %p
                {
                const char * s_save = s;
                working = strp_atoi(s, tm->tm_hour, 1, 12, 0);
                if (working && *s == ':')
                    {
                    ++ s;
                    working = strp_atoi(s, tm->tm_min, 0, 59, 0);
                    if (working && *s == ':')
                        {
                        ++ s;
                        working = strp_atoi(s, tm->tm_sec, 0, 60, 0);
                        if (working && isspace((int)*s))
                            {
                            ++ s;
                            while (isspace((int)*s)) 
                                ++s;
                            if (!strnicmp(s, "am", 2))
                                { // the hour will be 1 -> 12 maps to 12 am, 1 am .. 11 am, 12 noon 12 pm .. 11 pm
                                if (tm->tm_hour == 12) // 12 am == 00 hours
                                    tm->tm_hour = 0;
                                }
                            else if (!strnicmp(s, "pm", 2))
                                {
                                if (tm->tm_hour < 12) // 12 pm == 12 hours
                                    tm->tm_hour += 12; // 1 pm -> 13 hours, 11 pm -> 23 hours
                                }
                            else
                                working = false;
                            }
                        }
                    }
                if (!working)
                    s = s_save;
                }
                break;
            case 'R': // %H:%M
                {
                const char * s_save = s;
                working = strp_atoi(s, tm->tm_hour, 0, 23, 0);
                if (working && *s == ':')
                    {
                    ++ s;
                    working = strp_atoi(s, tm->tm_min, 0, 59, 0);
                    }
                if (!working)
                    s = s_save;
                }
                break;
            case 'S': // seconds
                working = strp_atoi(s, tm->tm_sec, 0, 60, 0);
                break;
            case 'T': // %H:%M:%S
                {
                const char * s_save = s;
                working = strp_atoi(s, tm->tm_hour, 0, 23, 0);
                if (working && *s == ':')
                    {
                    ++ s;
                    working = strp_atoi(s, tm->tm_min, 0, 59, 0);
                    if (working && *s == ':')
                        {
                        ++ s;
                        working = strp_atoi(s, tm->tm_sec, 0, 60, 0);
                        }
                    }
                if (!working)
                    s = s_save;
                }
                break;
            case 'w': // weekday number 0->6 sunday->saturday
                working = strp_atoi(s, tm->tm_wday, 0, 6, 0);
                break;
            case 'Y': // year
                working = strp_atoi(s, tm->tm_year, 1900, 65535, -1900);
                break;
            case 'y': // 2-digit year
                working = strp_atoi(s, tm->tm_year, 0, 99, 0);
                if (working && tm->tm_year < 69)
                    tm->tm_year += 100;
                break;
            case '%': // escaped
                if (*s != '%')
                    working = false;
                ++s;
                break;
            default:
                working = false;
                }
            }
            break;
        case ' ':
        case '\t':
        case '\r':
        case '\n':
        case '\f':
        case '\v':
            // zero or more whitespaces:
            while (isspace((int)*s))
                ++ s;
            break;
        default:
            // match character
            if (*s != *format)
                working = false;
            else
                ++s;
            break;
            }
        ++format;
        }
    return (working?(char *)s:0);
    }
#endif // _MSC_VER 
```

我在编写这个函数时参考了在线手册页[man strptime(3) 。](http://linux.die.net/man/3/strptime "人 strptime(3)")

# django - Django Admin Template Overriding：显示 checkboxselectmultiple 小部件

> ID：667256
> 
> 赞同：3
> 
> 时间：2009-03-20T17:54:14.873
> 
> 标签：django, django-admin, django-templates, django-forms

有 2 个表域和组具有一对多关系。这些表与用户表有多对多的关系

在用户管理界面上，我将组和域呈现为 CheckboxSelectMultiple 小部件。

是否可以以具有 2 列的表格形式呈现这一点：一列中的域和另一列中属于该域的组列表。

我想覆盖管理员的字段集模板。但是，我很难知道哪些方法/属性可以与 AdminField 一起使用。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-07T13:55:48.373

我有类似的问题，我所做的是我创建了新的 html 页面并将相同的代码从 Admin Template 目录 HTML 页面复制到我的模板目录，该目录将被自动覆盖，然后将 HTML 代码更改为我想要的。希望这是有用的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-29T09:56:27.497

我不太确定我 100% 遵循您要显示的内容。

[不幸的是， AdminField](http://code.djangoproject.com/browser/django/trunk/django/contrib/admin/helpers.py#L82)没有记录，但它是一个简短的类，只有 18 行长，所以你可以在[这里](http://code.djangoproject.com/browser/django/trunk/django/contrib/admin/helpers.py#L82)阅读。

我有一种感觉，您可能试图超越管理员允许您轻松完成的工作，一旦您尝试在同一页面上组合两个以上不同的模型，事情可能会变得有点混乱，您很快就会从事定制业务管理员通过编写自定义视图和模板。

我认为您想更改对象列表是否正确？而不是更改编辑/创建页面？

# c# - 来自 Service.OnStart 的信号初始化失败

> ID：667260
> 
> 赞同：4
> 
> 时间：2009-03-20T17:55:26.133
> 
> 标签：c#, .net, service, onstart

我们有一个案例，在服务启动（OnStart）期间，启动了一个工作线程。工作线程连接到 SQL 数据库。如果数据库不可用，工作线程可以向主线程发出故障信号。问题是; 如何向服务控制管理器发出启动失败的信号。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T18:04:23.960

这就是我们处理这种情况的方式。这段代码被添加到我们的主服务类中，然后在我们想要返回启动失败的地方，调用 SetServiceFail(1065)，然后从 OnStart 返回。在这种情况下 1065 返回数据库不存在状态。

我还要注意，在 SetServiceFail 中我对 serviceType 进行了硬编码，因为在我们的例子中，我们所有的服务都是独立的，所以我保持简单。

```
private void SetServiceFail (int ErrorCode)
{
     SERVICE_STATUS _ServiceStatus = new SERVICE_STATUS ();
     _ServiceStatus.currentState = (int) State.SERVICE_STOPPED;
     _ServiceStatus.serviceType = 16; //SERVICE_WIN32_OWN_PROCESS
     _ServiceStatus.waitHint = 0;
     _ServiceStatus.win32ExitCode = ErrorCode;
     _ServiceStatus.serviceSpecificExitCode = 0;
     _ServiceStatus.checkPoint = 0;
     _ServiceStatus.controlsAccepted = 0 |
           (this.CanStop ? (int) ControlsAccepted.ACCEPT_STOP : 0) |
           (this.CanShutdown ? (int) ControlsAccepted.ACCEPT_SHUTDOWN : 0) |
           (this.CanPauseAndContinue ? (int) ControlsAccepted.ACCEPT_PAUSE_CONTINUE : 0) |
           (this.CanHandleSessionChangeEvent ? (int) ControlsAccepted.ACCEPT_SESSION_CHANGE : 0) |
           (this.CanHandlePowerEvent ? (int) ControlsAccepted.ACCEPT_POWER_EVENT : 0);
     SetServiceStatus (this.ServiceHandle, ref _ServiceStatus);
}

public enum State
{
     SERVICE_STOPPED = 1,
     SERVICE_START_PENDING = 2,
     SERVICE_STOP_PENDING = 3,
     SERVICE_RUNNING = 4,
     SERVICE_CONTINUE_PENDING = 5,
     SERVICE_PAUSE_PENDING = 6,
     SERVICE_PAUSED = 7
}

public enum ControlsAccepted
{
     ACCEPT_STOP = 1,
     ACCEPT_PAUSE_CONTINUE = 2,
     ACCEPT_SHUTDOWN = 4,
     ACCEPT_POWER_EVENT = 64,
     ACCEPT_SESSION_CHANGE = 128
}

[StructLayout (LayoutKind.Sequential)]
private struct SERVICE_STATUS
{
     public int serviceType;
     public int currentState;
     public int controlsAccepted;
     public int win32ExitCode;
     public int serviceSpecificExitCode;
     public int checkPoint;
     public int waitHint;
}

[DllImport ("advapi32.dll")]
private static extern bool SetServiceStatus (IntPtr hServiceStatus, ref SERVICE_STATUS lpServiceStatus); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T18:30:07.860

One way to stop it is to use the ServiceController, but you wont get any fancy message in the service control manager about an error or a failure to start.

```
 var controller = new System.ServiceProcess.ServiceController("NameOfYourService");
controller.Stop(); 
```

# c# - 为什么没有从 msi 调用我的卸载方法？

> ID：667261
> 
> 赞同：3
> 
> 时间：2009-03-20T17:55:26.180
> 
> 标签：c#, .net, installation, windows-installer

我正在为我的网络应用程序编写安装程序，但我在卸载程序部分遇到了困难。尽管我在我的应用程序设置项目中创建了一个关于卸载的自定义操作，但 InstallerClass 设置为 true，方法：

```
public override void Uninstall(IDictionary savedState)
    {
        //MessageBox.Show("Attach debugger!", "Viper.Setup");
        Cleanup();
        base.Uninstall(savedState);
    } 
```

在安装程序类上似乎没有被调用。任何想法可能是什么原因？

编辑：我还注意到它不仅没有运行安装程序，而且也没有删除我的主 dll 文件。更糟糕的是，当我卸载上一个后安装新版本时，这个dll仍然是旧的（即使安装和卸载都成功了）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T20:28:48.637

您是否在安装程序的“代码操作”选项卡中包含了安装程序代码的输出？

如果不是这样...

我过去遇到过类似的问题，发现我需要定义所有 4 种方法，否则卸载将无法运行。将您的代码添加到下面的模板中：

```
[RunInstaller(true)]
public class MyInstaller: Installer
{
    public override void Install(IDictionary stateSaver)
    {
        base.Install(stateSaver);
    }

    public override void Commit(IDictionary savedState)
    {
        base.Commit(savedState);
    }

    public override void Rollback(IDictionary savedState)
    {
        base.Rollback(savedState);
    }

    public override void Uninstall(IDictionary savedState)
    {
        base.Uninstall(savedState);
    }
} 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-09-08T11:40:59.617

我实际上不知道为什么您的覆盖卸载不起作用。但是每当我遇到这个问题时，我都会记录卸载过程。并据此您可以轻松检查问题所在！这是通过安装程序类制作日志的方法。

```
 private string logFilePath = "C:\\SetupLog.txt";    
 public void Log(string str)
    {
        StreamWriter Tex;
        try
        {
            Tex = File.AppendText(this.logFilePath);
            Tex.WriteLine(DateTime.Now.ToString() + " " + str);
            Tex.Close();
        }
        catch
        { }
    } 
```

并在 Override 函数中调用此方法，例如 ->

```
 public override void Uninstall(IDictionary savedState)
    {
       try 
          {
             base.Uninstall(savedState);
             Log("Omg :O it works !");    
           }
      catch(Exception ex)
           {
             Log(ex.Message.ToString());
           }     
    } 
```

最后，Windows msi ...还不错..只是不要称它为垃圾Plz ..:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-03-17T09:14:21.137

遇到了同样的问题。在这里阅读答案，但乍一看误解了 dynaclips 的有用答案。

> 您是否在安装程序的“代码操作”选项卡中包含了安装程序代码的输出？

所以在这里为了更清楚，截图......

[![缺少自定义操作](https://i.stack.imgur.com/I8oAi.png)](https://i.stack.imgur.com/I8oAi.png)

[![卸载和回滚的自定义操作](https://i.stack.imgur.com/TlZpC.png)](https://i.stack.imgur.com/TlZpC.png)

最后在这里相同的覆盖，但在 VB.net

```
Public Class Installer1

Public Sub New()
    MyBase.New()

    'This call is required by the Component Designer.
    InitializeComponent()

    'Add initialization code after the call to InitializeComponent
End Sub

<Security.Permissions.SecurityPermission(Security.Permissions.SecurityAction.Demand)>
Public Overrides Sub Install(ByVal stateSaver As System.Collections.IDictionary)
    MyBase.Install(stateSaver)
    YourCustomInstallAction2BeRenamed()
End Sub

<Security.Permissions.SecurityPermission(Security.Permissions.SecurityAction.Demand)>
Public Overrides Sub Commit(ByVal savedState As System.Collections.IDictionary)
    MyBase.Commit(savedState)
End Sub

<Security.Permissions.SecurityPermission(Security.Permissions.SecurityAction.Demand)>
Public Overrides Sub Rollback(ByVal savedState As System.Collections.IDictionary)
    MyBase.Rollback(savedState)
    YourCustomRollbackAction2BeRenamed()
End Sub

<Security.Permissions.SecurityPermission(Security.Permissions.SecurityAction.Demand)>
Public Overrides Sub Uninstall(ByVal savedState As System.Collections.IDictionary)
    MyBase.Uninstall(savedState)
    YourCustomDeleteAction2BeRenamed()
End Sub 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-12-08T01:56:37.027

我通过将自定义操作的“InstallerClass”属性设置为 False 解决了这个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-01T12:40:37.487

我在这里遇到了同样的问题......为了找出原因而伤了我的头！！！事实证明，尽管我的安装项目将服务的主要输出设置为“发布”，而我正在对“调试”中的安装程序进行项目更改。当我将它们设置为相同的那一刻，我的 MessageBoxes 弹出以显示代码正在执行......

..您现在可以将您的项目更新为更简洁的解决方案:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-10-02T09:09:58.933

我已经为 wpf 应用程序创建了一个安装程序项目，类似于您的设置，请参见[此处](https://stackoverflow.com/q/32891384/4862745)，此处描述的问题对本主题不太重要。

> 不过，我遇到了与您描述的相同的问题。我已将该安装程序类放置在 Visual Studio 安装程序项目中，以防止该类执行。每当将安装程序类放入主应用程序时，一切都运行良好。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-08-24T09:23:19.010

我停止使用这些垃圾 msi，而是创建了一个 zip + cmd 脚本。强烈推荐，我花了 10 倍的时间来设置并实际工作。

# sql - SQL Server 2005 - 链接服务器和代理作业

> ID：667263
> 
> 赞同：0
> 
> 时间：2009-03-20T17:56:02.263
> 
> 标签：sql, sql-server-2005, login, linked-server, sql-server-agent

我有一个奇怪的场景，我目前无法解释。我生活在希望这只是“周五的感觉”，或者这里的某个善意的鞋底会拯救我的大脑，让我免于“但是为什么！？”的无休止循环。:)

两台服务器，运行 SQL Server 2005，DNS 条目为：

```
1\. ServerA  
2\. ServerB 
```

（嗯，他们不是真的这么叫，但它就足够了......）

在两个 SQL Server 实例上，都配置了指向另一台服务器的链接服务器。

出于明显的安全原因，LinkedServer Security 配置设置为：

```
- Be made using the login's current security context 
```

其他“链接服务器选项”是...

```
Collation Compatible: True
Data Access:          True
RPC:                  True
RPC Out:              True
Use Remote Collation: True
Collation Name:       <blank>
Connection Timeout:   30
Command Timeout:      10 
```

在两个实例上使用相同的密码创建登录名。登录名被授予对相关存储过程的适当执行权限。

我编写了一些代码，并在该登录名下执行它，一切*正常*

但是当我创建一个代理作业来运行这些存储过程时，一切都出错了。代理作业的所有者是“automated_job_login”，但我的错误日志显示如下： - 用户“automated_job_login”登录失败

（再一次，这个名字已经被改变以保护有罪的人。）

我一生都无法弄清楚为什么当我以该用户身份登录时它会起作用，但是连接到链接服务器时会出现作业错误。（肯定是在链接服务器连接点。）

为了让事情变得更加混乱，如果我将链接服务器安全配置更改为“使用此安全上下文：”并使用正确的密码指定“automated_job_login”，它可以正常工作。

我错过了一些东西，我知道我一定是，但我找不到什么。我已经阅读了文档，直到我的眼睛流血并且我失败了。请帮我 ：）

[将链接服务器安全选项保留为“使用此安全上下文：”不是一个选项，因为这会给该服务器的所有用户提供对另一台服务器的不可接受的访问级别。]

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T00:25:40.407

SQL 代理作业可能归您的登录名所有，但不会在该登录上下文中执行。它在[SQL 代理服务帐户上下文中](http://msdn.microsoft.com/en-us/library/ms189326(SQL.90).aspx)

因为您有 SQL Server 2005，所以您可以使用 EXEC AS USER = 'mylogin' 作为存储过程选项。

否则，您必须使用 的`@database_user_name`参数设置数据库用户名[`sp_add_jobstep`](http://msdn.microsoft.com/en-us/library/ms187358(SQL.90).aspx)。[在 SSMS](http://msdn.microsoft.com/en-us/library/ms187910(SQL.90).aspx)中，您可以设置上下文。工作所有权与 IIRC 的设置略有不同。

# javascript - 如何强制 NetBeans 注释 javascript 文件？

> ID：667267
> 
> 赞同：0
> 
> 时间：2009-03-20T17:56:47.080
> 
> 标签：javascript, svn, netbeans

我正在使用 NetBeans 6.5，我有一些 javascript 文件，它声称是二进制文件，不会显示注释。`svn propedit`表明 svn:mime-type 是 text/javascript 并且要在命令行上显示注释，我必须运行“svn annotate --force file.js”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-25T13:16:05.913

来自[http://subversion.tigris.org/svn_1.4_releasenotes.html](http://subversion.tigris.org/svn_1.4_releasenotes.html)：

> svn blame --force 显示责备的输出，即使文件是二进制文件。

看起来这不是特定于 NetBeans 的问题，而是与 svn 如何处理您的 .js 文件有关的问题。最好为这个问题添加一个适当的标签。

来自[http://subversion.tigris.org/faq.html#binary-files](http://subversion.tigris.org/faq.html#binary-files)：

> Subversion 只查看文件的前 1024 个字节；如果任何字节为零，或者超过 15% 不是 ASCII 打印字符，则 Subversion 调用文件二进制。(...) Subversion 将以下文件视为文本： (...) svn:mime-type 以“text/”开头的文件

如果您的 javascript 文件包含二进制数据，您可以考虑将其移至文件末尾。

该属性有可能设置为“ text/javascript”或对人类来说类似于 text/javascript 的东西，但对 svn 却没有。

该文件有可能曾经是二进制文件，但现在不再是了，但是您已经更新了您的存储库，但没有对 .svn/ 目录的写访问权（并且 svn 仍然“认为”该文件是二进制文件）。

有可能您已将属性更改为正确的属性，但尚未提交。

最后，我遇到过的最强大的 svn 问题解决方案是复制文件，从 svn 中删除它，提交，将文件添加回来（从副本中）并提交。当心：您这样做会丢失更改历史记录。

祝您好运，找出导致此问题的原因！

# php - 如果文件不存在，.htaccess 重定向

> ID：667284
> 
> 赞同：6
> 
> 时间：2009-03-20T18:02:02.187
> 
> 标签：php, .htaccess, mod-rewrite

所以这就是我想要做的。我有一个简单的框架，我正在使用 mod rewrite 来重写 url，以便它们指向正确的文件。我有一个进程文件夹，它位于 web 文件夹内（web 文件夹是所有实际网站文件（如图像、css 等）所在的位置）。

这很好用，但我现在要做的是有一个 default.php 文件来处理表单。如果我将表单指向它，该文件效果很好，但我希望能够将表单指向它的正确文件，如果文件不存在，那么它使用 default.php

表单由一个类创建，动作设置为 process/{ID OF THE FORM}.php 这个想法是任何人都可以使用该类创建一个表单，如果他们不需要做任何特别的事情， default.php 文件将处理表单。

我意识到我可以将表单类设置为始终使用 default.php，然后在 default.php 文件上我可以检查是否存在正确的文件。如果是，则使用该文件，如果不是，则继续处理表单，但我仍然很想知道这样的事情是否适用于 mod rewrite：

```
RewriteRule ^process/([^/]*) /web/process/$1
RewriteCond %{DOCUMENT_ROOT}/web/process/$1 !-f
RewriteCond %{DOCUMENT_ROOT}/web/process/$1 !-d
RewriteRule ^process/([^/]*) /web/process/default.php [L] 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-20T18:15:18.567

This rule alone should do it:

```
RewriteCond %{DOCUMENT_ROOT}web/$0 !-f
RewriteRule ^process/[^/]+$ web/process/default.php [L] 
```

If the requested path cannot be mapped to an existing file, it should be rewritten to the default file.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T18:05:59.477

您通常应该在 RewriteRule 之前调用 RewriteCond。如果满足条件，则触发规则。

# c# - Questions about Structs

> ID：667285
> 
> 赞同：7
> 
> 时间：2009-03-20T18:02:04.963
> 
> 标签：c#, class, struct, language-specifications

MSDN says that a class that would be 16 bytes or less would be better handled as a struct [[citation]](http://msdn.microsoft.com/en-us/library/ah19swz4(VS.71).aspx).
Why is that?
Does that mean that if a struct is over 16 bytes it's less efficient than a class or is it the same?
How do you determine if your class is under 16 bytes?
What restricts a struct from acting like a class? (besides disallowing parameterless constructors)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-20T18:15:56.270

There are a couple different answers to this question, and it is a bit subjective, but some reasons I can think of are:

*   `struct`s are value-type, `class`es are reference type. If you're using 16 bytes for total storage, it's probably not worth it to create memory references (4 to 8 bytes) for each one.
*   When you have really small objects, they can often be pushed onto the IL stack, instead of references to the objects. This can really speed up some code, as you're eliminating a memory dereference on the callee side.
*   There is a bit of extra "fluff" associated with classes in IL, and if your data structure is very small, none of this fluff would be used anyway, so it's just extra junk you don't need.

The most important difference between a `struct` and a `class`, though, is that `struct`s are value type and `class`es are reference type.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T18:48:58.970

By "efficient", they're probably talking about the amount of memory it takes to represent the class or struct.

On the 32-bit platform, allocating an object requires a minimum of 16 bytes. On a 64-bit platform, the minimum object size is 24 bytes. So, if you're looking at it purely from the amount of memory used, a struct that contains less than 16 bytes of data will be "better" than the corresponding class.

But the amount of memory used is not the whole story. Value types (structs) are fundamentally different than reference types (classes). Structs can be inconvenient to work with, and can actually cause performance problems if you're not careful.

The real answer, of course, is to use whichever works best in your situation. In most cases, you'll be much better off using classes.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-20T18:15:03.403

Check this link, I found it on one of the answers in SO today: [.NET Type Internals](http://www.codeproject.com/KB/cs/net_type_internals.aspx). You can also try searching SO and Googling for "reference types vs value types" for differences between structs and classes.

> > What restricts a struct from acting like a class?

There are many differences. You cannot inherit from a struct, for example.

You can't have virtual methods, so you cannot use a struct to implement an interface. Instance methods in structs can access struct's private fields, but apart from that they behave a lot like auxilirary "helper" functions (for immutable structs, they sometimes don't even need to access private data). So I find them to be not as near as "valuable" as class methods.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T18:17:32.587

`struct`s are different from `class`es because they are stored on the stack, and not on the heap. That means that every time you call a method with the `struct` as parameter, a copy is created and passed to the method. That is why large `struct`s are extremely inefficient.

I would actively discourage to use `struct`s nevertheless, because it could cause some subtle bugs: e.g. when you change a field of a `struct`, its not going to be reflected for the caller (because you only changed the copy) - which is completely different behavior to classes.

So the 16 bytes I think is a reasonable maximum size of a `struct`, but still in most cases it is better to have a `class`. If you still want to create a `struct`, try to make it immutable at least.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T18:13:29.333

In memory, the struct will hold the data directly, while a class will behave more like a pointer. That alone makes an important difference, since passing the struct as a parameter to a method will pass its values (copy them on the stack), while the class will pass the reference to the values. If the struct is big, you will be copying a lot of values on each method call. When it is really small copying the values and using them directly will be probably faster than copying the pointer and having to grab them from another place.

About restrictions: you can't assign it to null (although you can use Nullable<>) and you have to initialize it right away.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-20T18:16:37.190

This is due to the different way that the CLR handles structs and classes. Structs are value types which means they live on the stack rather than in the managed heap. It is a good rule of thumb to keep structs small because once you start passing them as method arguments you will incur overhead as structs are copied in their entirety when passed to a method.

Since classes pass a copy of their reference to methods they incur much less overhead when used as method arguments.

The best way to determine the size of your class is to total the number of bytes required by all the members of your class plus an extra 8 bytes for CLR overhead stuff (the sync block index and the reference to the type of the object).

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-01-20T21:36:44.490

Copying an instance of a struct takes less time than creating a new instance of a class and copying data from an old one, but class instances can be shared and struct instances cannot. Thus, "structvar1 = structvar2" requires copying new struct instance, whereas "classvar1 = classvar2" allows classvar1 and classvar2 refer to the same struct instance (without having to create a new one).

The code to handle the creation of new struct instances is optimized for sizes up to 16 bytes. Larger structs are handled less efficiently. Structs are a win in cases where every variable that holds a struct will hold an independent instance (i.e. there's no reason to expect that any particular two variables will hold identical instances); they are not much of a win (if they're a win at all) in cases where many variables could hold the same instance.

# css - IE8 对透明 png 的渲染在我的网站上是 FUBARed

> ID：667286
> 
> 赞同：13
> 
> 时间：2009-03-20T18:02:34.133
> 
> 标签：css, xhtml, internet-explorer-8

我刚刚下载了 IE8 完整版本，所以我可以测试我刚刚创建的网站。[删除示例]

专注于左侧边栏背景图像。假设它是重复的 1x1 半透明 .png 图像。IE8 将其渲染为渐变！！！当您尝试滚动窗口或将鼠标悬停在侧边栏上时，它会变得更加不稳定。

我已经在普通浏览器（IE7、Firefox 和 Chrome）中测试过这个站点。它看起来和我在这些中设计的完全一样。IE8 虽然是 FUBARed。我试图将 IE8 设置为“IE7”模式，但它仍然看起来很糟糕。IE7 模式下的 IE 8 的渲染方式显然与真正的 IE7 不同。甚至“IE7 元标记”也不起作用。

有没有其他人遇到过这样的问题？我认为 IE8 应该是一种改进，而不是倒退。

PS 请原谅此页面上的蹩脚标记。我使用了 IE 的“保存整个页面”功能。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-20T18:24:33.207

这可能是 IE8 中的渲染错误，或者可能是平滑重复图像边缘的某些功能，这会给您带来意想不到的结果。无论哪种方式，使用如此小的图像遇到问题都不足为奇。您是否意识到浏览器必须绘制图像 190152 次才能呈现页面？

我使用 10x10 半透明 png 作为页面中 div 的背景，它在 IE8 中呈现得很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T18:41:17.287

我修复了这个错误，这不是其他帖子中提到的伽马问题。我的问题是由图像大小为 1x1 像素这一事实引起的。我只是将其更改为 1x2 并解决了问题。奇怪的

[编辑] 在我问这个问题后，我才看到 Guffa 的帖子。见他的答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-21T02:07:33.333

我正在构建的网站也有类似的问题。该问题仅发生在 50% 的 ie8 机器上进行测试，我正在为一家 IT 公司构建它，因此可以访问大量计算机。我们能够通过在问题机器上切换硬件加速来“修复”问题，这根本不是真正的修复。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-13T15:40:10.473

感谢您在这个问题上的帮助 - 多么奇怪的错误。

我在 50% 的运行 IE8 的计算机上也遇到了这个问题（可以访问很多机器）。当我使用 CSS 将 1x1px 半透明 png 设置为 div 上的背景图像时，IE 会将其渲染为时髦的垂直透明渐变。

将源图像更改为具有相同不透明度的 5x5px png 修复了该错误...去 IE！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-19T09:34:29.250

> 问题是我的原始 png 是 1×1，无论出于何种原因，IE8 都不喜欢尝试平铺它并同时处理 alpha 透明度。当我不小心用剪贴板上的一个更大的副本（100×100）保存了该图像时，它最终解决了 Internet Explorer 在处理 png 的透明度时遇到的任何问题。

[来源](http://www.jasonferguson.me/transparent-png-background-turns-into-a-gradient-in-ie8/)

# java - 为什么 autoReconnect=true 似乎不起作用？

> ID：667289
> 
> 赞同：34
> 
> 时间：2009-03-20T18:04:19.903
> 
> 标签：java, jdbc, timeout

我正在使用 JDBC 连接到 MySQL 服务器（我认为没有连接池）。在我的连接 URL 中`autoReconnect=true`

但我的连接仍然超时。我什至检查过`conn.isClosed()`它是错误的。但是当我尝试使用连接时，出现以下异常。

```
com.mysql.jdbc.CommunicationsException：由于底层异常导致通信链接失败：

** 开始嵌套异常 **

java.net.SocketException
消息：软件导致连接中止：套接字写入错误

堆栈跟踪：

java.net.SocketException：软件导致连接中止：套接字写入错误
...

```

我知道在 Java 1.6 中你可以`conn.isValid(0)`用来检查连接，但我使用的是 Java 1.5

有没有办法确保它不会超时？还是我必须升级到 Java 1.6？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-20T18:15:52.933

我有同样的问题，这绝对令人抓狂。这是 MySQL 网站上的文档所说的（强调我的）

*驱动程序是否应该尝试重新建立陈旧和/或死连接？**如果启用，驱动程序将为在陈旧或死连接上发出的查询抛出异常，这些查询属于当前事务，但会在新事务中的连接上发出下一个查询之前尝试重新连接**。不建议使用此功能，因为当应用程序无法正确处理 SQLExceptions 时，它会产生与会话状态和数据一致性相关的副作用，并且仅设计用于无法将应用程序配置为处理因死而导致的 SQLExceptions 时使用并正确地过时的连接。或者，研究将 MySQL 服务器变量“wait_timeout”设置为某个较高的值，而不是默认值 8 小时。*

根据我的经验，“在下一个查询时重新连接”功能似乎也不起作用，但我使用的是 MySQL 4.0，这可能就是原因。

我最终编写了一个小型框架来捕获异常，检查特定错误，并在可能的情况下尝试重新连接并重试查询。

**ETA**：[此链接](http://bugs.mysql.com/bug.php?id=5020)提供了更多信息，并表明将来可能会删除自动重新连接。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T18:14:21.673

autoReconnect 仍然会引发异常，因此您可以根据需要选择对这种情况做些什么。如果你抓住它，你应该会发现连接再次在那里。（如果你在一个交易中，会有更多的复杂性——你当前的交易几乎已经死了。）

# iphone - SQLite 数据库 - 看不到更新

> ID：667290
> 
> 赞同：1
> 
> 时间：2009-03-20T18:04:23.803
> 
> 标签：iphone, objective-c, sqlite

我有一个 sqlite 数据库，我正在向其中添加新单词。问题是我只能在重新启动应用程序后才能看到它们添加到表中。在重新启动应用程序之前，“SELECT”语句不会“看到”新添加的元素。

为什么会发生这种情况？

我正在创建某种字典。这是我添加新项目的方法：

```
const char *sql_query = "INSERT INTO words(word) VALUES(?)";
        if(sqlite3_prepare_v2(database, sql_query, -1, &addWordsStmt, NULL) != SQLITE_OK)
        {
            return FALSE;
        }

sqlite3_bind_text(addWordsStmt, 1, [ word UTF8String], -1, SQLITE_TRANSIENT);

    if( sqlite3_step(addWordsStmt) != SQLITE_DONE)
        NSAssert1(0, @"Error while inserting data. '%s'", sqlite3_errmsg(database));

sqlite3_reset(addWordsStmt);

sqlite3_finalize(addWordsStmt); 
```

这是我的检索代码：

```
const char *sql_query = "SELECT word FROM words WHERE id=?";

        if(sqlite3_prepare_v2(database, sql_query, -1, &getWordsStmt, NULL) != SQLITE_OK) 
        {
            return;
        }

sqlite3_bind_int(getWordsStmt, 1, wordid);

    if( sqlite3_step(getWordsStmt) != SQLITE_ROW)
    {
        NSLog(@"Error while getting data. '%s'", sqlite3_errmsg(database));
        sqlite3_reset(getWordsStmt);
        return;
    }

    NSString *word = [NSString stringWithUTF8String:(char *)sqlite3_column_text(getWordsStmt, 0)];

sqlite3_reset(getWordsStmt);

sqlite3_finalize(getWordsStmt); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T19:40:00.267

你的问题是：

```
const char *sql_query = "SELECT word FROM words WHERE id=?"; 
```

这不是您使用 SQL 的方式。相反，你应该使用`SELECT word FROM words;`和步进来获取每一行，只要你得到，`SQLITE_ROW`直到你得到`SQLITE_DONE`. 这会让你得到你所有的话。当你不知道新添加的单词的 id 时，你将如何通过 id 查找单词？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-27T19:51:45.893

我的猜测是您正在进行交易。在您的打开和关闭例程中必须有一些其他调用将您的调用包装在事务中并且未显示在您的代码片段中。

这就是为什么您在应用程序退出之前看不到新词的原因

# c++ - 多语言编译中的 I/O 问题

> ID：667302
> 
> 赞同：-1
> 
> 时间：2009-03-20T18:06:02.393
> 
> 标签：c++, c, makefile

问候大家

我正在尝试在 UNIX 中分别使用 gcc、g++ 和 f77 编译和运行 C、C++ 和 fortran 中的多语言代码。我的程序由两部分组成，一个在 C 中，另一个在 C++ 中。它们通过用 C+ 编写的 main() 进行接口，而对于这种情况，可以忽略 fortran 代码。

我遇到了很多问题，最明显的是在我运行可执行文件时发生的分段错误。我的前两个主题已经削弱了它，不幸的是，除了在我的程序的任何一半中完全删除任何输入/输出过程之外，似乎没有什么能彻底解决问题，这是不可行的。

[使用 C 从 C++ 访问公共类内存](https://stackoverflow.com/questions/666320/accessing-public-class-memory-from-c-using-c) [C & C++ 之间的输出冲突](https://stackoverflow.com/questions/666713/output-conflicts-between-c-c)

当我在程序的两个部分中使用输入/输出时，我需要找到收到分段错误的原因。所有源代码都编译，所有链接都成功，我知道每个部分（C 和 C++）在单独链接时工作，没有这样的分段错误（当然，修改后让它们单独工作）。我已经包含了在这两个部分之间进行接口并执行输入/输出功能的所有代码。

任何帮助将不胜感激。

生成文件

```
products: SlowDynamic.exe

SlowDynamic.exe: main.o SA.o mersenne.o CFE.o BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o MA_57.o blas.o MA_57_Depend.o Metis.o
    f77 -L/usr/sfw/lib -R/usr/sfw/lib -lgcc_s -lstdc++ -o SlowDynamic.exe main.o \
        SA.o mersenne.o CFE.o MA_57.o blas.o MA_57_Depend.o Metis.o\
        BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o

main.o: main.cpp
    g++ -c -o main.o main.cpp

SA.o: SA.cpp
    g++ -c -o SA.o SA.cpp

mersenne.o: mersenne.cpp
    g++ -c -o mersenne.o mersenne.cpp

CFE.o: CFE.c
    gcc -c -o CFE.o CFE.c

MA_57.o: MA_57.f
    f77 -c -o MA_57.o MA_57.f

blas.o: blas.f
    f77 -c -o blas.o blas.f

MA_57_Depend.o: MA_57_Depend.f
    f77 -c -o MA_57_Depend.o MA_57_Depend.f

Metis.o: Metis.f
    f77 -c -o Metis.o Metis.f

BCs.o: BCs.c
    gcc -c -o BCs.o BCs.c

EMatrix.o: EMatrix.c
    gcc -c -o EMatrix.o EMatrix.c

Numbering.o: Numbering.c
    gcc -c -o Numbering.o Numbering.c

KMatrix.o: KMatrix.c
    gcc -c -o KMatrix.o KMatrix.c

Solve.o : Solve.c
    gcc -c -o Solve.o Solve.c

clean: 
    rm *.o Main.exe *.gpi 
```

主文件

```
#include <iostream>
#include "SA.h" 

using namespace std;

int main() 
{   

    Initial.Initialize();

    Parent.SA(Initial.Write);

    system ("PAUSE");

    return 0;
} 
```

SA.h

```
#ifndef SA_H
#define SA_H

#include <vector>

class SimAnneal {

    std::vector< std::vector<float> > DensityDomain;

    float Solid_Ele_Num, Void_Ele_Num;
    float Solid, Void;

    double Energy;
    double Time;

    void Metropolis (double, int, int);
    void Next_State (double, int);
    double Schedule (double, int);
    double ObjFunction ();
    void Distribute ();
    void Mutate ();
    void Convert ();
    void PrintDomain ();
    void WriteResults (double, double, double, double, double);

  public:
    int x_max, y_max;
    ...
    std::vector<float> DensityArray; 
    std::vector<float> EnergyArray;
    ...
    void SA (int);
    void Initialize ();
};

extern SimAnneal Initial, Parent, Child, Mutation, Best;

#endif 
```

SA.cpp

```
include <math.h>
#include <iostream>
#include <fstream>          
#include <time.h>           
#include <vector>

#include "SA.h"
#include "CFE.h"
#include "randomc.h"

using namespace std;

SimAnneal Initial, Parent, Child, Mutation, Best;

...

void SimAnneal::Initialize () 
{
    x_max = ReturnX();
    y_max = ReturnY();

    EnergyArray.resize(x_max*y_max);
    DensityArray.resize(x_max*y_max);

    ...

    Energy = ObjFunction();
}

...

void SimAnneal::PrintDomain () 
{
    static ofstream OutputFile;

    if (!OutputFile.is_open())
    {
        char FileName [] = "DensityDomain.txt";

        OutputFile.open(FileName);

        if (!OutputFile)
        {
            cerr << "Failed to open " << FileName << endl;
            exit(EXIT_FAILURE);  
        }

        //cout << "\nGenerating 'DensityDomain.txt'... \n" << endl;
    }

    for (int y = 0; y < y_max; y++) 
    {    
        for (int x = 0; x < x_max; x++) 
        {      
            OutputFile << DensityDomain[y][x] << " "; 
        }  

        OutputFile << endl;
    }  

    OutputFile.close();
}

void SimAnneal::WriteResults (double i, double T, double x, double y, double z) 
{
    static ofstream OutputFile;

    if (!OutputFile.is_open()) //check is file has been opened
    {
        char FileName [] = "Results.txt";

        OutputFile.open(FileName);

        if (!OutputFile)
        {
            cerr << "Failed to open " << FileName << endl;
            exit(EXIT_FAILURE);  //abort program
        }

        //cout << "\nWriting to file in progress... \n" << endl;

        OutputFile << "Iterations" << '\t' << "Temperatures" << '\t' << "Sum Strain Energy" << endl;  //<< "SwapNum1" << '\t' << "SwapNum2" << '\t' << "Distance" << endl; 
        OutputFile << endl;

        Initial.Time = (int)time(0);
    }

    OutputFile << i << '\t' << T << '\t' << z << endl;  //'\t' << y << '\t' << z << endl; 

    if (i == N_max || T <= T_abs) 
    {   
        Parent.Time = (int)time(0);

        OutputFile << endl
               << "Settings: " << endl
               << "Initial Temperature: " << Initial.Temp << endl
               << "Temperature Iterations: " << i << endl
               << "Step Iterations: " << N_step << endl
               << endl
               << "Results: " << endl
               << "Final Temperature: " << Temp << endl 
               << "Minimum: " << Energy << endl
               << "Computational Time (s): " << (Parent.Time-Initial.Time) << endl;

        OutputFile.close();
    }
} 
```

CFE.h

```
#ifdef __cplusplus
extern "C" {
#endif 

int ReturnX ();
int ReturnY ();
void CFE(float density[], float energy[], int Length);

#ifdef __cplusplus
 }
#endif 
```

CFE.c

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include "BCs.h"
#include "EMatrix.h"
#include "Numbering.h"
#include "KMatrix.h"
#include "fg_types.h"
#include "Solve.h"

int ReturnX ()
{
    FILE *infile;
    infile = fopen("test05", "r");

    int elemX,elemY;
    fscanf(infile, "%i %i", &elemX, &elemY);

    fclose(infile);

    return elemX;
}

int ReturnY () { Same but returns elemY }

void CFE(float density[], float energy[])
{
    // Extensive use of fscanf(), printf() & fprintf()
    // and the following:

FILE *outfile;

outfile = fopen("File.txt", "w");
if(outfile == NULL){

    }
else{
    for(n=0;n<8;n++)
    {
        for(m=0;m<8;m++)
        {
            fprintf(outfile,"%f",KE[n][m]);
            fprintf(outfile,"\t");
        }
        fprintf(outfile,"\n");
    }
}

fclose(outfile);

} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T18:36:01.387

我建议您以批判的眼光检查您的代码，并检查所有看起来甚至很奇怪的东西。

我会为你做的，但 C++ 目前不在我的轮换中，我正在误报。例如，这引起了我的注意：

```
if (!OutputFile.is_open())
{
    char FileName [] = "DensityDomain.txt";

    OutputFile.open(FileName);

    if (!OutputFile)
    {
        cerr << "Failed to open " << FileName << endl;
        exit(EXIT_FAILURE);  
    }

    //cout << "\nGenerating 'DensityDomain.txt'... \n" << endl;
} 
```

在已经调用它之后，你正在测试是否`OutputFile`为空。在我看来，要么 1)不会为空，要么 2)在测试*之前你不应该调用它的方法。*但是我错了。`is_open()``open()``OutputFile`

 *明白了吗？

# java - Java Web 开发的学习路径？

> ID：667308
> 
> 赞同：2
> 
> 时间：2009-03-20T18:08:36.617
> 
> 标签：java, jsp

我继承了一个大型 Java Web 项目，我必须对其进行一些修改，在基础知识方面我是一个相当称职的 Java 程序员，但我以前从未做过任何 JSP 编程或 EJB 编程。我记得大约 5 年前在大学里模糊地做一些 servlet 编程，但我假设从那时起一切都发生了变化。

我计划在这个周末让自己加快速度，但我不知道从哪里开始。

什么是让我从零到众所周知的英雄的好学习路径？或者至少达到让我能够阅读 JSP servlet 和 EJB 代码并理解它如何工作得足以修改和部署它的能力水平？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T18:17:44.457

当然，这在很大程度上取决于您继承的项目以及编写时间。还使用了哪些技术？

开始 J2EE 开发的最佳资源我认为是[Java Passion 站点](http://www.javapassion.com/j2ee/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T09:26:09.273

netbeans.org 上的在线教程非常好。我建议下载 NetBeans 6.5 IDE（免费）并浏览 J2EE 教程。教程写得很好，介绍了企业和 Web 开发的基本要素。他们也需要很少的时间来完成。

[http://www.netbeans.org/kb/](http://www.netbeans.org/kb/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T19:06:12.983

了解它有多复杂。没有 EJB 的 Web 应用程序和有 EJB 的 Web 应用程序之间存在巨大差异。

它是否在 JBoss/Tomcat/Jetty/Resin/BEA/WebSphere 中运行？

# documentation - 如何在 doxygen 输出中生成导航树？

> ID：667309
> 
> 赞同：7
> 
> 时间：2009-03-20T18:08:59.783
> 
> 标签：documentation, javadoc, doxygen

如果您使用过 javadoc，然后来到 doxygen，那么您可能知道我说我想念使从类到类和方法到方法的跳转变得容易的分层（基于框架）视图的意思。（对于那些没有看过它的人，想象一下 IDE 或文件系统中的树导航器）。

如果可能的话，我怎样才能让 Doxygen 包含导航树？

[10 月份有人问](https://stackoverflow.com/questions/165451/suggest-a-good-doxygen-stylesheet)了一个类似的问题，但这只是关于样式表的替代品，只有一个出现了。我想我正在寻找更重要的东西。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-08-27T20:15:54.010

请注意，要在 Quinn 的示例中获取左侧的树，您需要做的就是在配置文件中将 GENERATE_TREEVIEW 设置为 YES。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-15T16:45:08.070

在基本层面上，Doxygen 输出就是这样，我认为没有“更好的方式来查看”静态 HTML 内容。我认为你想要的是让 Doxygen 生成更类似于 Javadoc 的 HTML 输出，这既有优点也有缺点。（最大的缺点是它不太可能发生，因为涉及的努力和广泛的用户群。）

我管理[一个使用 Doxygen 记录的项目，](http://dysart.cs.byu.edu/CHDataStructures/)我不确定我的配置在多大程度上使用了 Doxygen 默认值，但我在左框架中获得了一个用于平面类列表和类层次结构的部分。此外，由于我启用了图表，图形类层次结构是一种快速跳转到我想要的位置的方法。我还没有深入研究 Doxygen 模块，所以我没有任何经验来判断这是否会类似于 Javadoc 对包的处理方式。

# php - 如何判断一个函数是否在php中定义

> ID：667311
> 
> 赞同：3
> 
> 时间：2009-03-20T18:09:22.527
> 
> 标签：php

如何确定函数是否在 php 中定义？我想做类似的事情：

```
if(! function_defined(money_format)) // function not defined on windows
{
      function money_format($str) { ... }
} 
```

这在php中可能吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-20T18:11:48.637

您可以使用该[`function_exists`](http://us2.php.net/manual/en/function.function-exists.php)函数来确定是否已定义函数。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-20T18:17:48.777

值得一提的是，您需要使用[method_exists](http://us2.php.net/manual/en/function.method-exists.php)来查看对象是否定义了特定的方法。

# .net - Silverlight：TargetType="{x:Type TextBlock}" 的属性类型无效

> ID：667317
> 
> 赞同：6
> 
> 时间：2009-03-20T18:10:51.383
> 
> 标签：.net, silverlight, xaml

只是玩弄 Silverlight 并尝试设置一种样式以应用于所有 TextBlocks。以下 XAML：

```
<Style TargetType="{x:Type TextBlock}">
   <Setter Property="Margin" Value="10, 10, 10, 10" />
</Style> 
```

给我错误`Invalid attribute value {x:Type TextBlock} for property TargetType.`

我从 MSDN 复制并粘贴了这一点，所以我有点不知道为什么会出现这个错误。

编辑：

这是我现在尝试的完整代码：

```
<UserControl x:Class="NIRC.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    Width="400" Height="300">
    <UserControl.Resources>
        <Style TargetType="TextBlock">
            <Setter Property="Margin" Value="10" />
            <Setter Property="Foreground" Value="Red" />
        </Style>
    </UserControl.Resources>
    <TextBlock>Hello World!</TextBlock>
</UserControl> 
```

这是它的外观：

[替代文字 http://www.netortech.com/Content/slhw.jpg](http://www.netortech.com/Content/slhw.jpg)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-24T13:03:34.897

Silverlight 不支持通过通用样式的隐式样式（即使用 TargetType 但没有静态资源键 - x:Key=""），但 WPF 支持。

您需要在要使用 Style="{StaticResource *stylename* }" 设置样式的每个元素实例上使用 StaticResource 引用显式应用样式。

[Silverlight 工具包](http://silverlight.codeplex.com/)有一个隐式样式管理器 (ISM)，它通过包装 Silverlight 标记并通过解析内容应用来自 ResourceDictionaries 的样式来解决此问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-20T18:30:03.443

TargetType 的值仅更改为 TextBlock。它应该工作。

```
<Style TargetType="TextBlock">
   <Setter Property="Margin" Value="10, 10, 10, 10" />
</Style> 
```

可选地，给它 x:Key 和这个属性的值在你的 TextBlock 中用作静态资源。

```
<Style x:Key="someStyleName" TargetType="TextBlock">
   <Setter Property="Margin" Value="10, 10, 10, 10" />
</Style>
...
<TextBlock x:Name="myTextBlock" Text="Silverlight" Style="{StaticResource someStyleName}"/> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-01-10T16:32:10.647

由于您尝试做的是隐式样式，因此到目前为止，Gordon 的答案似乎是正确的：“Silverlight 不支持通过通用样式进行隐式样式（即使用 TargetType 但没有静态资源键 - x:Key=""）但是WPF 可以。”

然而，隐式样式**将适用于 Silverlight 4**。请参阅[http://www.silverlightshow.net/items/Implicit-Styles-in-Silverlight-4.aspx](http://www.silverlightshow.net/items/Implicit-Styles-in-Silverlight-4.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-20T18:37:59.587

嗯，以下应该工作并级联到用户控件元素中的所有文本块。

```
<UserControl>
    <UserControl.Resources>
        <Style TargetType="TextBlock">
            <Setter Property="Margin" Value="10" />
        </Style>
    </UserControl.Resources>
    <TextBlock Text="This has a margin of 10 on all sides!" />
</UserControl> 
```

编辑：用户控件的代码隐藏正确吗
？`NIRC.Page`

我希望我知道出了什么问题，以下在用户控件中非常适合我。

```
<UserControl x:Class="..."
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Height="300" Width="300">
    <UserControl.Resources>
        <Style TargetType="TextBlock">
            <Setter Property="Margin" Value="10" />
            <Setter Property="Foreground" Value="Red" />
        </Style>
    </UserControl.Resources>
    <TextBlock>Hello World!</TextBlock>
</UserControl> 
```

结果是红色文本，边距为 10 像素。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-25T16:07:27.637

是的，Silverlight 4 现在让您可以使用隐式样式，您只需要按照 Quinton 所说的进行设置，无需键即可设置 TargetType，您就可以开始使用了。将它放在 App.xaml 中，它应该将样式传播到应用程序中的所有控件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-07-17T09:38:14.927

如果不想`Style`每次使用控件时都设置，可以在构造函数代码中设置：

```
Style = (Style)Application.Current.Resources["YourStyle"]; 
```

# .net - 将路径作为字符串传递而不是使用 DirectoryInfo/FileInfo 的充分理由

> ID：667318
> 
> 赞同：18
> 
> 时间：2009-03-20T18:10:59.870
> 
> 标签：.net, string, directory

在我的新代码中，我*没有*使用字符串来传递目录路径或文件名。相反，我使用的是 DirectoryInfo 和 FileInfo，因为它们似乎封装了很多信息。

我已经看到很多代码使用字符串来传递目录信息，然后它们在冗长的难以理解的语句中“拆分”、“mid”和“instr”，直到他们得到他们正在寻找的目录部分。

是否有充分的理由将路径作为字符串传递？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-20T18:18:55.173

一般来说，我认为将信息保存在 FileInfo/DirectoryInfo 中会更好。这些类中有很多有用的功能，以及很多安全性，因为它更容易检查文件是否存在，查看最初指定的文件等。

我将（可能）将路径作为字符串传递而不是使用 FileInfo 和 DirectoryInfo 的唯一地方是，如果路径要跨 AppDomains 或在进程之间传递等。

FileInfo 和 DirectoryInfo 都可以跨 AppDomain 边界正常工作（因为它们是可序列化的），但在这种情况下它们的开销要大得多。如果事情来回很多，它可能会产生影响。

不过，在这种情况下，我会坚持使用 FileInfo 和 DirectoryInfo，除非我发现在我的分析过程中存在明显的问题，并且我试图减少序列化数据的数量。如果我没有遇到性能问题，我会坚持使用这些类，因为它们提供了很多安全性和功能性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-20T18:12:51.567

一旦路径在应用程序中（即不在纯文本配置文件中），不，没有充分的理由。

唯一一次（我能想到的）它可能有用的是与只接受路径作为字符串的代码进行互操作时。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-20T18:13:24.373

`DirectoryInfo`如果您需要的只是一条路径，那么四处走动`FileInfo`会非常沉重。我会更关心“分裂和中间和instr”的垃圾。学习以下方法：

Path.GetFileName
Path.GetDirectoryName
Path.Combine
等...

顺便说一句，那些来自`System.IO.Path`班级。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-09T14:32:15.290

我认为您确实需要一个类来封装文件或目录路径，而不是使用原始字符串并使用静态 System.IO.Path 类来操作它们。但是，[我不觉得 DirectoryInfo 和 FileInfo 合适](https://stackoverflow.com/questions/2026991/combining-a-directoryinfo-and-a-fileinfo-path)，因为它们似乎更多地用于执行文件/目录操作而不是路径操作。如果您为路径操作创建一个自定义类，您可以提供[更用户友好的路径操作功能](https://stackoverflow.com/questions/52071/net-path-manipulation-library/3677449#3677449)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-07-28T16:33:09.157

要记住路径字符串和 FileInfo 之间的一个显着区别，可以在下面的测试中总结：

**FileInfo 反映了文件实例化时的信息**——它可以被删除/修改，而​​ FileInfo 不会反映这一点。

```
[TestMethod]
        public void TestFileInfo()
        {
            var path = @"C:\Users\bjarmuz\Desktop\aybabtu.txt";
            File.WriteAllText(path, "All your base are belong to us!");
            var file = new FileInfo(path);

            Assert.IsTrue(file.Exists);
            File.Delete(file.FullName);
            Assert.IsTrue(file.Exists);
            Assert.IsFalse(File.Exists(file.FullName));
        }

  [TestMethod]
        public void TestFileInfo()
        {
            var path = @"C:\Users\bjarmuz\Desktop\aybabtu.txt";
            File.WriteAllText(path, "All your base are belong to us!");
            Thread.Sleep(1000);

            var file = new FileInfo(path);
            var date = DateTime.UtcNow;

            Assert.IsTrue(file.LastWriteTimeUtc< date);

            File.WriteAllText(path, "No!");
            Assert.IsTrue(File.GetLastWriteTimeUtc(file.FullName)> date);

            Assert.IsFalse(file.LastWriteTimeUtc > date);
        } 
```

这可能有点误导，如果您的代码传递 FileInfos 而不是字符串，您可能会看到属性的错误结果，例如`Exists`or `Last[..]Time`- 如果您使用这些`File.Get[...]()`方法，则不会发生这种情况。

**但是，另一方面，**您也不应该依赖 File.Exists() 方法 - 因为可以在运行测试后立即创建/删除文件。正确的方法是不做这个检查，而是接受它可以抛出 IO 异常（并准备好正确处理它）。这篇很棒的文章中的更多信息[https://blogs.msdn.microsoft.com/ericlippert/2008/09/10/vexing-exceptions/](https://blogs.msdn.microsoft.com/ericlippert/2008/09/10/vexing-exceptions/)

此外，FileInfo/DirectoryInfo 的一个重要“优势”是它可以保护您的方法（和方法使用者）免受以下影响：

```
void SaveEntity(Entity theThing, string path)
{
    //now, based on the signature, you don't know whether you need file path or directory path

}

//void SaveEntity(Entity theThing, DirectoryInfo path) {}
//void SaveEntity(Entity theThing, FileInfo path) {} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-15T13:08:36.080

将 FileInfo 传递给 DMZ 时遇到问题。据我所见 - 如果我错了，请纠正我 - FileInfo 在反序列化时执行权限检查，这在 DMZ 中不起作用并导致“找不到路径”。使用您的数据创建并传递自定义对象。

# multithreading - 多个句柄同时发出信号时 WaitForMultipleObjects 的行为

> ID：667319
> 
> 赞同：5
> 
> 时间：2009-03-20T18:11:00.433
> 
> 标签：multithreading, winapi, events

给定：我用自动重置事件填充了一个句柄数组，并使用 bWaitAll = FALSE 将其传递给 WaitForMultipleObjects。

来自 MSDN：“当 bWaitAll 为 FALSE 时，此函数会按从索引 0 开始的顺序检查数组中的句柄，直到其中一个对象发出信号。如果有多个对象发出信号，则该函数返回数组中第一个句柄的索引，其对象被发出信号。”</p>

因此，现在如果多个对象发出信号，我将获得第一个对象的索引。我是否必须遍历我的阵列以查看是否有其他人发出信号？

现在我有一个循环，大致如下：

```
For ( ; ; )
{
WaitForMultipleObjects(…)
If  (not failed)
     Process object that called. 
     Remove the handle that signaled from the array.
     Compact the arrary.
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T18:12:51.677

是的。一种替代方法是您可以在每个句柄上执行 WaitForSingleObject(handle, 0) ，该句柄将立即返回并指示它们是否已发出信号。

编辑：这是我的意思的示例伪代码：

```
ret = WaitForMultipleObjects()
if (ret >= WAIT_OBJECT_0 && ret < WAIT_OBJECT_0 + (count))
{
    firstSignaled = ret - WAIT_OBJECT_0;

    // handles[firstSignaled] guaranteed signalled!!

    for (i = firstSignaled + 1; i < count; i++)
    {
        if (WaitForSingleObject(handles[i], 0) == WAIT_OBJECT_0)
        {
           // handles[i] Signaled!
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-25T06:08:10.720

> 因此，现在如果多个对象发出信号，我将获得第一个对象的索引。我是否必须遍历我的阵列以查看是否有其他人发出信号？

为什么不直接回到 Wait() 中呢？如果多个对象发出信号，当你回来时它们仍然会发出信号。当然，如果您在等待对象数组中有一个非常快速地触发第一个对象，它将使其他对象挨饿；您所做的是按触发频率对等待对象数组中的对象进行排序，频率最低的优先。

顺便说一句，在你使用无穷无尽的 for() 的地方，你可以使用 goto。如果您真的没有离开循环，那么无条件 goto 最恰当地表达了您的意图。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-22T15:21:53.100

您可能拥有的另一种选择是使用[`RegisterWaitForSingleObject`](http://msdn.microsoft.com/en-us/library/ms685061(VS.85).aspx). 这个想法是，您在回调函数的辅助数组中标记事件的信号状态，然后发出用于唤醒主线程的主事件（在主事件上调用 WaitForSingleObject）。

显然，您必须注意确保辅助数组不受主线程访问，但它会起作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-07-26T00:49:58.267

只有结束等待的自动重置事件（返回其索引）才会被重置。如果等待超时，则不会重置任何事件。

cf [https://blogs.msdn.microsoft.com/oldnewthing/20150409-00/?p=44273](https://blogs.msdn.microsoft.com/oldnewthing/20150409-00/?p=44273)

# java - 浏览器 Java 插件检测

> ID：667320
> 
> 赞同：5
> 
> 时间：2009-03-20T18:11:48.637
> 
> 标签：java, javascript, browser, plugins, cross-browser

确定浏览器中是否安装了 Sun Java 插件的首选方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-20T18:13:52.360

[java部署工具包](http://java.sun.com/javase/6/docs/technotes/guides/jweb/deployment_advice.html#deplToolkit)

```
脚本 src="http://java.com/js/deployJava.js"

if (deployJava.versionCheck('1.6'))
{
警报（“已安装 1.6”）
}

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-08-08T09:34:22.090

您也可以考虑[PluginDetect](http://www.pinlady.net/PluginDetect/JavaDetect.htm)脚本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-28T18:30:35.547

这不是您确切问题的答案，而是作为确定浏览器本身的解决方案提供的。不要太苛刻，这真的是我前段时间写的老代码。

```
import java.applet.*;

public class BrowserDetector extends Applet {

    public void init() {
        if (isNetscape()) {
            System.out.println("This browser is a Netscape Browser.");
        }
        if (isMicrosoft()) {
            System.out.println("This browser is a Microsoft Browser.");
        }
        System.out.println("VM Type: " + getVMType());
    }

    public static boolean isNetscape() {
        try {
            Class.forName("netscape.applet.MozillaAppletContext");
        } catch (ClassNotFoundException e) {
            System.out.println("This browser is not a Netscape Browser.");
            return false;
        }
        return true;
    }

    public static boolean isMicrosoft() {
        try {
            Class.forName("com.ms.applet.GenericAppletContext");
        } catch (ClassNotFoundException e) {
            System.out.println("This browser is not a Microsoft Browser.");
            return false;
        }
        return true;
    }

    public String getVMType() {
        String theBrowser = "No VM";
        String appletContext = getAppletContext().toString();
        if (appletContext.startsWith("sun.applet.AppletViewer"))
            theBrowser = "APPLETVIEWER";
        else if (appletContext.startsWith("netscape.applet."))
            theBrowser = "NETSCAPE";
        else if (appletContext.startsWith("com.ms.applet."))
            theBrowser = "MICROSOFT";
        else if (appletContext.startsWith("sunw.hotjava.tags.TagAppletPanel"))
            theBrowser = "HOTJAVA";
        else if (appletContext.startsWith( "sun.plugin.navig.win32.AppletPlugin"))
            theBrowser = "NETSCAPEPLUGIN";
        else if (appletContext.startsWith( "sun.plugin.ocx.ActiveXApplet"))
            theBrowser = "MICROSOFTPLUGIN";
        else if (appletContext.startsWith( "sun.plugin.viewer.context.IExplorerAppletContext"))
            theBrowser = "MICROSOFTPLUGINJRE1.4";

        return theBrowser;
    }

} 
```

# .net - 刷新没有“参数值”对话框的 Crystal Reports

> ID：667348
> 
> 赞同：5
> 
> 时间：2009-03-20T18:17:51.773
> 
> 标签：.net, vb.net, crystal-reports, report

我正在为 Visual Studio 2008 运行 Crystal Reports Basic。

我想根据参数动态刷新我的报告。

例如，我将有一份客户合同，我想基于 VB.NET winform 按钮单击在客户之间切换。

我原以为下面的代码可以工作，但我不断得到“输入参数值”对话框，为什么不使用我刚刚设置的参数值？

```
CustomerReport1.SetParameterValue("CustomerID", txtCustID.Text)
CrystalReportViewer1.RefreshReport() 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T18:50:13.333

通过删除 RefreshReport 解决：

```
CustomerReport1.SetParameterValue("CustomerID", txtCustID.Text)
CrystalReportViewer1.ReportSource = CustomerReport1 
```

# sql - SQL Schema to allow users add comments to various tables

> ID：667351
> 
> 赞同：3
> 
> 时间：2009-03-20T18:19:15.530
> 
> 标签：sql, schema

So, I'm building a website and I'm going to have standard CMS tables like Article, Blog, Poll, etc. I want to let users post comments to any of these items. So my question is, do I need to create separate comments tables for each (e.g. ArticleComment, BlogComment, PollComment), or can I just make a generic Comment table that could be used with any table? What has worked for people?

**Method 1: Many Comment Tables**

*   Article {ArticleID [PK], Title, FriendlyUrl}
*   ArticleComment {ArticleCommendID [PK], ArticleID [FK], Comment}
*   Blog {BlogID, Title, PubDate, Category}
*   BlogComment {BlogCommendID [PK], BlogID [FK], Comment}
*   Poll {PollID, Title, IsClosed}
*   PollComment {PollCommentID [PK], PollID [FK], Comment}

**Method 2: Single Comment Table**

*   Article {ArticleID [PK], Title, FriendlyUrl}
*   Blog {BlogID, Title, PubDate, Category}
*   Poll {PollID, Title, IsClosed}
*   Comment {CommentID [PK], ReferenceID [FK], Comment}

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-20T18:20:48.833

I'd go with the generic comment table. It will make a lot of things much simpler. I'd also tag comments with the ID of the user who created them, or other source-identifying information (IP address, etc.). Even if you don't display this it can be very handy when you have to clean up spam, etc.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T18:54:40.733

There seem to be two major ways of mapping OO-inheritance to relational databases:

1.  Take all the attributes from the parent class and all the child classes and put them in the table, together with a 'which class is this?' field. Each object is serialized as one row in one table.

2.  Create one table for the parent class and one table for each child class. The table for the parent class table contains the 'which class is this?' field. The child class table contains a foreign key pointing to the parent class table. Each object is serialized as one row in the parent class table and one row in the child class table.

Method one doesn't really scale well: it quickly winds up with lots of nullable fields, almost always null, and scary `CHECK` constraints. But it is fairly simple for small class hierarchies.

Method two scales much better, but is more work. It also results in many more tables in your schema.

I suggest taking a look at method two for your Articles/Polls/Blogs tables — to me, they sound like child tables of a `Content` or something. You will then have a very clear and easy place to attach comments: to the `Content`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T14:40:11.197

为什么要将所有评论保留在同一个表格中？您会将所有评论视为一个群体吗？如果您不期望将所有项目的所有评论作为一个组来处理，那么就没有理由将它们全部放在一起。仅仅因为数据库中的两个实体共享相同的属性并不意味着它们应该放在同一个物理表中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T18:21:36.600

I'd suggest just one comment table, adding an ItemID field telling which type of item is the comment for:

```
Article {ArticleID [PK], Title, FriendlyUrl}
Blog {BlogID, Title, PubDate, Category}
Poll {PollID, Title, IsClosed}
Comment {CommentID [PK], ReferenceID [FK], ItemID, Comment}
Item {ItemID, Type} 
```

The last table would contain records such as (1, 'article'), (2, 'blog'), etc.

That way you'll be able to identify which content type each comment was made for.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T18:34:10.407

I am working on a system where we used the following model for comments:

```
 Data Table(s)      Many-to-many Assoc             Comment Table
  CommentableId  ->  CommentableId/CommentId   ->   Comment_Id 
```

Not my design, but I like the fexibility. It allows us to use one comment in many different places. Since this is not trivial to implement in the UI, users don't get to see this feature (just a text box to type in a comment), but it is used when we do batch imports and legacy data processing in the database.

# wpf - 通过触发器更改 TreeViewItem 标题

> ID：667352
> 
> 赞同：0
> 
> 时间：2009-03-20T18:19:45.047
> 
> 标签：wpf, header, treeviewitem

有这样的风格

```
<Style TargetType="TreeViewItem">
  <Style.Triggers>
    <Trigger Property="IsExpanded" Value="True">
      <Setter Property="Header" Value="Pink"></Setter>
    </Trigger>
  </Style.Triggers>
</Style> 
```

我希望扩展的 TreeViewItems 的文本是“粉红色”，但实际上没有设置。如果我改为改为 Property="Background"，它就可以工作。*Header*与*Background*有何不同？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T18:47:13.137

我想我需要更多信息才能更完整地回答这个问题。但是，如果我不得不猜测，我会说您可能会像这样明确地设置 TreeViewItem 上的 Header 属性：

```
<TreeView>
    <TreeViewItem
        Header="Blue"/>
</TreeView> 
```

而且，在这种情况下，显式设置它会覆盖您在样式中放置的任何内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T19:01:11.000

详细说明 ascalonx 的答案：

复制自[Josh Smith 的](http://joshsmithonwpf.wordpress.com/2007/05/16/demystifying-dependency-properties/)博客：

> WPF 内部使用一组定义明确的规则来确定 DP 的真正价值是什么。以下是解析 DP 值时使用的优​​先级规则的简要总结（从最高优先级到最低优先级）：
> 
> 1.  属性系统强制
> 2.  活动动画，或具有 Hold 行为的动画
> 3.  当地价值
> 4.  TemplatedParent 模板
> 5.  风格触发器
> 6.  模板触发器
> 7.  样式设置器
> 8.  主题风格
> 9.  遗产
> 10.  依赖属性元数据的默认值

因此，如果您明确设置 Header 属性，（或者如果您绑定它我认为），您就会遇到这个问题。

# python - 用 python 处理 xml

> ID：667359
> 
> 赞同：5
> 
> 时间：2009-03-20T18:22:30.937
> 
> 标签：python, xml

我需要删除 xml 标签之间的空格，例如，如果原始 xml 看起来像：

```
<node1>
    <node2>
        <node3>foo</node3>
    </node2>
</node1> 
```

我希望将最终结果简化为*单行*：

```
<node1><node2><node3>foo</node3></node2></node1> 
```

请注意，我无法控制 xml 结构，因此解决方案应该足够通用以能够处理任何有效的 xml。此外，xml 可能包含 CDATA 块，我需要将其排除在此*处理之外*并保持原样。

到目前为止，我有几个想法：（1）将 xml 解析为文本并查找标签 < 和 > 的开始和结束（2）另一种方法是加载 xml 文档并逐个节点打印出一个*新*的通过连接标签来记录文档。

我认为这两种方法都可以，但我不想在这里重新发明轮子，所以可能有一个 python 库已经做了这样的事情？如果没有，那么在推出我自己的*cruncher*时需要注意的任何问题/陷阱？有什么建议吗？

**编辑** 谢谢大家的回答/建议，Triptych 和 Van Gale 的解决方案都对我有用，并且完全符合我的要求。希望我能接受这两个答案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-20T18:52:01.987

这很容易用 lxml 处理（注意：这个特殊功能不在 ElementTree 中）：

```
from lxml import etree

parser = etree.XMLParser(remove_blank_text=True)

foo = """<node1>
    <node2>
        <node3>foo  </node3>
    </node2>
</node1>"""

bar = etree.XML(foo, parser)
print etree.tostring(bar,pretty_print=False,with_tail=True) 
```

结果是：

```
<node1><node2><node3>foo  </node3></node2></node1> 
```

**编辑：** Triptych 的回答让我想起了 CDATA 要求，因此创建解析器对象的行实际上应该如下所示：

```
parser = etree.XMLParser(remove_blank_text=True, strip_cdata=False) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-20T18:33:18.880

我会使用 XSLT：

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output method="xml" encoding="UTF-8" omit-xml-declaration="yes"/>
    <xsl:strip-space elements="*"/>

    <xsl:template match="*">
        <xsl:copy>
            <xsl:copy-of select="@*" />
            <xsl:apply-templates />
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet> 
```

这应该够了吧。

在 python 中，您可以使用[lxml（直接链接到主页上的示例）](http://codespeak.net/lxml/xpathxslt.html#xslt)来转换它。

对于某些测试，使用`xsltproc`, sample：

```
xsltproc test.xsl  test.xml 
```

`test.xsl`上面的文件和`test.xml`您的 XML 文件在哪里。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-20T18:59:55.260

**BeautifulSoup 非常简单。**

此解决方案假定可以从字符数据的尾部去除空格。
例子：`<foo> bar </foo>`变成`<foo>bar</foo>`

它将正确地忽略注释和 CDATA。

```
import BeautifulSoup

s = """
<node1>
    <node2>
        <node3>foo</node3>
    </node2>
    <node3>
      <!-- I'm a comment! Leave me be! -->
    </node3>
    <node4>
    <![CDATA[
      I'm CDATA!  Changing me would be bad!
    ]]>
    </node4>
</node1>
"""

soup = BeautifulSoup.BeautifulStoneSoup(s)

for t in soup.findAll(text=True):
   if type(t) is BeautifulSoup.NavigableString: # Ignores comments and CDATA
      t.replaceWith(t.strip())

print soup 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-20T18:34:09.457

不是真正的解决方案，但因为您要求提供建议：我建议您不要进行自己的解析（除非您想学习如何编写复杂的解析器），因为正如您所说，并非所有空格都应该删除。不仅有 CDATA 块，还有带有“xml:space=preserve”属性的元素，这些元素对应`<pre>`于 XHTML 中的内容（其中包含的空格实际上是有意义的），并编写一个能够识别这些元素并离开的解析器单独的空白是可能的，但令人不快。

我会使用解析方法，即加载文档并逐个节点打印出来。这样，您可以轻松识别哪些节点可以去除空格，哪些不能。Python 标准库中有一些模块，我从来没有使用过 ;-) 可能对您有用...尝试`xml.dom`，或者我不确定您是否可以使用`xml.parsers.expat`.

# c - 解释 C 代码的工具

> ID：667362
> 
> 赞同：9
> 
> 时间：2009-03-20T18:23:43.630
> 
> 标签：c

我记得前段时间阅读了一个解释 C 代码的命令行工具，有人知道它可能被命名为什么吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-20T18:26:08.680

也许您的意思是 cdecl，一个可以将复杂的声明翻译成英文并返回的程序？

例如

```
cdecl> explain int (*(*foo)(int ))(float )
declare foo as pointer to function (int) returning pointer to function (float) returning int 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T20:09:35.593

如果您的意思是解释，那么我认为答案已经给出。如果您的意思是寻找潜在的问题，那么有 lint 及其变体，首先要停止任何代码审查。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-05T04:27:28.327

[http://en.wikipedia.org/wiki/Lint_programming_tool](http://en.wikipedia.org/wiki/Lint_programming_tool)

编辑： [C/C++ 免费替代 Lint？](https://stackoverflow.com/questions/632057/c-c-free-alternative-to-lint)

高温高压

# ant - What's the best way to define dependencies between multiple ant build files?

> ID：667371
> 
> 赞同：1
> 
> 时间：2009-03-20T18:27:19.927
> 
> 标签：ant, dependencies, dependency-management

I have a bunch of modules which I'd like to all have their own ant build files. However, modules have dependencies on other modules. What's the best way to define dependencies between build files?

I've looked at the <import>, <ant>, and <antcall> tasks, but it seems like maybe there's a better way to do this.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-23T11:21:14.933

您可以考虑使用[Apache Ivy](http://ant.apache.org/ivy/index.html) ( [features](http://ant.apache.org/ivy/features.html) ) 来管理您的依赖项。有一个关于[如何在多项目环境中使用 Ivy](http://ant.apache.org/ivy/history/latest-release/tutorial/multiproject.html)的教程，听起来就像你所追求的。我建议[从头开始阅读这些教程，](http://ant.apache.org/ivy/history/latest-release/tutorial.html)因为从头开始可能会有点棘手。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T15:50:49.217

我尝试将所有定义放入[Antlib](http://ant.apache.org/manual/Types/antlib.html)并将它们包含在主`build.xml`文件中。如果您按照“约定优于配置”规则编写宏，您会惊讶地发现 Ant 可以如此简洁。

如果你想看一个例子，你可以看看[我](http://code.google.com/p/workingonit/source/browse/trunk/depictus/build.xml)的谷歌沙箱代码

# javascript - 如何暂时阻止可滚动的 div 滚动？

> ID：667377
> 
> 赞同：0
> 
> 时间：2009-03-20T18:28:24.370
> 
> 标签：javascript, html, events, javascript-events, event-handling

这是我目前的情况：

我有一个包含几个可滚动 div 的网页。这些 div 中的每一个都包含许多对象。我正在使用 YUI 来显示可以在每个对象上执行的操作的弹出菜单。每个对象都有自己的与之关联的菜单，该菜单是动态构建和显示的。弹出菜单可以很大，并且可以与可滚动 div 的边界重叠。

从我认为焦点问题（菜单必须可访问）来看，当我将鼠标悬停在可滚动 div 边缘顶部的操作上时，div 会自动滚动，移动内容但使菜单保持静止。尝试在发生这种情况时动态移动菜单不是我想做的事情，因为我相信它会提供糟糕的用户体验。

所以我需要防止这个集中菜单滚动 div。我提供最佳用户界面的想法是防止这些内部 div 在菜单打开时滚动。这使菜单位于最佳位置，以向用户显示正在操作的项目。如果用户想要滚动该框，他们可以单击关闭菜单，然后正常滚动。

我怎样才能做到这一点？我需要一个适用于主流浏览器的解决方案。

我的第一个想法是听那个特定元素的*onscroll*事件。不幸的是，似乎没有一种简单的方法可以防止滚动发生。一方面，我的 Javascript 事件代码似乎在实际滚动发生后执行。

然后，我认为由于我的代码在对象滚动后运行，我可以重置**obj.scrollTop**和**obj.scrollLeft**。果然，这似乎可行，尽管我担心在慢速浏览器上用户会看到 div 内的内容“跳来跳去”。此外，如果元素滚动的量是事件对象的一部分，那就太好了。它卡在某个地方了吗？我正在寻找一种替代方法，而不是必须为此元素存储 scrollTop 和 scrollLeft 变量，然后在暂时禁用滚动时使用它们。

解决整个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T18:35:13.963

简单的答案是不，你不能这样做。如果你想要一个跨浏览器的解决方案，它是双重的。

~~向用户提供可以滚动的清晰可见性，然后拒绝它们，这只是糟糕的 UI 设计。~~

好的，所以在您编辑之后，您实际上并没有试图阻止用户滚动。

不过，主要答案仍然正确。听起来好像焦点将变为矩形（可能是锚？），它没有完全显示并导致滚动。这个矩形必须获得焦点是否有原因？为了可访问性？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T18:39:15.670

我同意 Anthony 关于您试图禁止的功能的介绍。如果您要禁用滚动，那么您应该使页面的该部分在视觉上被禁用或删除。

为此，您可以在相关可滚动 div 的顶部放置一个半透明 div，这将捕获鼠标事件并直观地显示可滚动 div 目前处于非活动状态。很难使跨浏览器兼容并且不会完美，但是像这样的客户端技巧也很少。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T18:36:17.097

如果您没有使用*overflow: scroll*而是使用了*overflow: hidden*并提供了向上/向下滚动按钮，允许用户在必要时滚动怎么办？这些按钮当然可以很容易地禁用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T18:36:23.850

虽然它可能不是您正在寻找的答案，但如果您要在页面加载（从服务器）时将 div 的显示值设置为“none”，然后将事件连接到页面加载（pageLoad in ajax.net 或通过 javascript 将其附加到 onload 事件），这将使 div 显示设置为 'block' .. 这将确保较慢的浏览器不会看到 div '跳跃'（甚至可以放置一个'加载' div 中的图像以向用户展示它正在做某事而不仅仅是不可见）

抱歉，我无法提供更复杂/流畅的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T20:49:46.963

我找到了解决此问题的方法。通过从可滚动的 div 中删除菜单元素，然后将其直接附加到 document.body，浏览器都停止尝试滚动 div 以显示焦点元素（即使该元素已经完全可见）。

感谢大家的时间和答案！

# c# - 在 vista 中以管理员身份以编程方式运行 cmd.exe，C#

> ID：667381
> 
> 赞同：6
> 
> 时间：2009-03-20T18:29:01.730
> 
> 标签：c#, windows-vista, process, cmd, administrator

我有一个视觉工作室设置和部署项目。我在其中添加了一个 .cmd 脚本。该脚本需要管理员权限才能运行。当用户单击 setup.exe 时，UAC 会提示用户提供管理员权限。所以我假设在 setup.exe 中创建和调用的所有进程都将以管理员身份运行。因此，我进行了设置调用我的控制台应用程序，其中包含以下代码。

```
ProcessStartInfo p1 = new ProcessStartInfo();
p1.UseShellExecute = true;
p1.Verb = "runas";
p1.FileName = "cmd.exe";
Process.Start(p1); 
```

所以它应该可以在管理员空间下运行。

我想以管理员身份通过 c# 进程类运行 cmd.exe。我正在运行 windows vista。

我试过没有用！我能做些什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-20T18:32:32.503

尝试执行`runas` *命令*：

```
...

using System.Diagnostics;

...

string UserName = "user name goes here";
ProcessStartInfo p1 = new ProcessStartInfo();
  p1.FileName = "runas";
  p1.Arguments = String.Format("/env /u:{0} cmd", UserName);
Process.Start(p1);

... 
```

（而且我认为您不需要明确的 UseShellExecute）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-18T15:03:45.507

试试这个，这对我有用。

```
...

using System.Diagnostics;

...

ProcessStartInfo startInfo = new ProcessStartInfo();
  startInfo.UseShellExecute = true;            
  startInfo.Verb = "runas";
  startInfo.Arguments = "/env /user:" + "Administrator" + " cmd";
Process.Start(startInfo);

... 
```

阿舒托什

# c# - 使用反射查找委托字段的名称

> ID：667387
> 
> 赞同：0
> 
> 时间：2009-03-20T18:30:20.153
> 
> 标签：c#, reflection, delegates, field

假设我有以下代表：

```
public delegate void Example(); 
```

和一个类，如下所示：

```
public class TestClass {
    Example FailingTest = () => Assert.Equal(0,1);
} 
```

如何使用反射来获得名称“FailingTest”？

到目前为止，我已经尝试过：

```
var possibleFields = typeof(TestClass).GetFields(relevant_binding_flags)
                            .Where(x => x.FieldType.Equals(typeof(Example)));

foreach(FieldInfo oneField in possibleFields) {
  // HERE I am able to access the declaring type name
  var className = oneField.ReflectedType.Name; // == "TestClass"

  // but I am not able to access the field 
  // name "FailingTest" because:
  var fieldName = oneField.Name; // == "CS$<>9__CachedAnonymousMethodDelegate1"
} 
```

在调试器中单步执行，我找不到声明字段名称“FailingTest”的路径。

该信息是在运行时保留还是在分配匿名委托时丢失？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T18:49:05.053

你`BindingFlags`传递给`GetFields`什么？我用了这些：

```
BindingFlags.NonPublic | BindingFlags.Instance 
```

我能够看到该字段的名称。

# java - 在 Lucene 中获取词频

> ID：667389
> 
> 赞同：6
> 
> 时间：2009-03-20T18:32:17.043
> 
> 标签：java, full-text-search, lucene

是否有一种快速简便的方法可以从 Lucene 索引中获取术语频率，而无需通过`TermVectorFrequencies`课程进行，因为这需要大量时间来收集大型集合？

我的意思是，有没有类似的东西`TermEnum`不仅有文档频率，还有词频？

更新：使用 TermDocs 太慢了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-20T20:22:03.003

用于[`TermDocs`](http://lucene.apache.org/core/old_versioned_docs/versions/3_0_3/api/all/org/apache/lucene/index/TermDocs.html)获取给定文档的词频。与文档频率一样，您可以`IndexReader`使用感兴趣的术语从 中获取术语文档。

* * *

您不会找到比`TermDocs`不失一般性更快的方法。`TermDocs`直接从索引段中的“.frq”文件中读取，其中每个词频按文档顺序列出。

如果这“太慢”，请确保您已优化索引以将多个段合并为一个段。按顺序遍历文档（跳过没问题，但不能有效地在文档列表中来回跳转）。

您的下一步可能是进行额外处理，以创建一个更专业的文件结构，从而省略`SkipData`. 就我个人而言，我会寻找一种更好的算法来实现我的目标，或者提供更好的硬件——大量的内存，或者保存一个`RAMDirectory`，或者提供给操作系统以在其自己的文件缓存系统上使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-14T22:48:02.553

Lucene 的主干版本（最终将是 4.0）现在公开了来自 TermsEnum 的每个术语的 totalTermFreq()。这是该术语在所有内容中出现的总次数（但与 docFreq 一样，不考虑删除）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T20:22:04.690

[TermDocs](http://lucene.apache.org/java/2_4_1/api/org/apache/lucene/index/TermDocs.html)在包含该术语的每个文档中给出给定术语的 TF。您可以通过遍历每个 <document, frequency> 对并计算对数来获得 DF，尽管 TermEnums 应该更快。[IndexReader](http://lucene.apache.org/java/2_4_1/api/org/apache/lucene/index/IndexReader.html)有一个[termDocs(Term) 方法](http://lucene.apache.org/java/2_4_1/api/org/apache/lucene/index/IndexReader.html#termDocs(org.apache.lucene.index.Term))，该方法返回给定 Term 和索引的 TermDocs。

# version-control - 如何创建相同文件的相同 gzip？

> ID：667391
> 
> 赞同：10
> 
> 时间：2009-03-20T18:32:51.723
> 
> 标签：version-control, binary, compression, diff, mysqldump

我有一个文件，它的内容是相同的。它被传递到 gzip 中，并且只存储压缩形式。我希望能够再次生成 zip，并且只有在它们不同时才更新我的副本。就目前的差异工具（diff、xdelta、subversion）而言，文件已更改。

前提是，我将一个重要数据库的 mysqldump 存储到一个颠覆存储库中。我的意图是 cronjob 定期转储数据库、gzip 并提交文件。目前，每次转储文件然后压缩文件时，它都被认为是不同的。我不想让我的修订号每 15m 不必要地增加。

我意识到我可以将文件作为纯文本转储，但我不喜欢它，因为它相当大。

我目前用来生成转储的命令是：

```
mysqldump $DB --skip-extended-insert | sed '$d' | gzip -n > $REPO/$DB.sql.gz 
```

`-n`指示 gzip 删除文件名/时间戳信息。`sed '$d'`删除 mysqldump 放置时间戳的文件的最后一行。

在这一点上，我可能会恢复以纯文本方式存储它，但我很好奇有什么样的解决方案。

**解决了，[Bright 先生是正确](https://stackoverflow.com/questions/667391/how-to-create-an-identical-gzip-of-the-same-file/667409#667409)的，当正确的参数是小写时，我错误地使用了大写 N。**

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-20T18:38:08.527

> -N 指示 gzip 删除文件名/时间戳信息。

实际上，这恰恰相反。 `-n`是什么告诉它忘记原始文件名和时间戳。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T18:38:31.147

我认为 gzip 会保留文件上的原始日期和时间戳，这将导致它生成不同的存档。

```
-N --name
          When  compressing,  always  save  the original file
          name and time stamp;  this  is  the  default.  When
          decompressing,  restore  the original file name and
          time stamp if present. This  option  is  useful  on
          systems  which  have a limit on file name length or
          when the time stamp has  been  lost  after  a  file
          transfer. 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-04-03T10:48:41.587

但请注意：在不同时间对同一个未更改文件制作的两个 gzip 不同。这是因为 gzip 本身带有 gzip 创建日期的时间戳 - 这会写入 gzip 文件的标头。因此，明显不同的 gzip 可以包含完全相同的内容。

# c++ - 由 const 引用传递的参数由 const 引用返回

> ID：667396
> 
> 赞同：12
> 
> 时间：2009-03-20T18:34:43.497
> 
> 标签：c++

我正在阅读 C++ Faq Second Edition ，faq number 32.08 。

常见问题解答说，由 const 引用传递并由 const 引用返回的参数可能会导致悬空引用。

但是如果参数通过引用传递并通过引用返回就可以了。

我知道在 const 引用的情况下它是不安全的，但是在参数是非 const 引用的情况下它是如何安全的。

FAQ的最后一行说“请注意，如果函数通过非常量引用接受参数（例如，f（string＆s）），则返回此引用参数的副本是安全的，因为临时不能通过非常量引用传递。”

需要对此有所了解！

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-20T18:39:20.210

如果你喜欢

```
const Foo & bar(const Foo &f) { return f; } 
```

并称它为

```
const Foo &ret = bar(Foo()); 
```

这可以编译，但问题是现在 'ret' 是一个悬空引用，因为调用 Foo() 创建的临时对象在 bar 返回后被释放。这里详细的执行顺序是：

1.  分配临时 Foo
2.  使用临时对象的引用调用 bar
3.  bar 返回参考
4.  现在 bar 已返回临时 Foo 已释放
5.  由于对象被破坏，引用现在悬空

但是，如果您将 Foo 声明为

```
Foo & bar(Foo &f) { return f; } 
```

那么您的呼叫 bar(Foo())**将不会被编译器接受**。将临时对象传递给函数时，只能通过 const 引用或作为副本来获取；这是语言定义的一部分。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T18:38:56.607

临时对象可以通过 const 引用传递——当函数返回时，临时对象被销毁，因此调用者留下了一个悬空的引用。

例如：

```
#include <iostream>

using namespace std;

int const& output( int const& x) 
{
    cout << x << endl;

    return x;
} 

int main ()
{
    int a = 1;

    int const& ref1 = output( a); // OK

    int const& ref2 = output(a+1); // bad

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T18:44:39.837

我认为这个例子会有所帮助：

```
const int& f(const int& n)
{
    return n;
}

int f1(int& n)
{
    return n;
}

int main(int argc, char **argv)
{
    //Passing a reference to an anonymous object created by
    //the compiler to function f()
    const int& n = f(10);

    //Undefined behavior here as the scope of the anonymous object
    //was only till previous statement
    int k = n + 10;

    //Compiler error - Can not pass non-const reference to a anonymous object
    int n = f1(10);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T19:40:43.213

[这](http://blogs.msdn.com/vcblog/archive/2009/02/03/rvalue-references-c-0x-features-in-vc10-part-2.aspx)是一个关于 C++0x 右值引用的页面，开头是对左值和右值在 C++ 中如何工作的相当不错的总结，以及如何允许它们与引用绑定。

大多数关于 C++0x 中右值引用的文章都会让你对此有所了解。

# ruby-on-rails - 带有助手的 Rails 2.3 迁移问题

> ID：667398
> 
> 赞同：0
> 
> 时间：2009-03-20T18:35:21.980
> 
> 标签：ruby-on-rails, plugins

我正在迁移我的一个使用引擎插件的插件。在我的插件中，有一个帮助程序无法被 rails 识别。

有谁知道任何相关的问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T20:45:30.327

我明白了，我必须手动包含我的助手，例如：

```
ActionView::Base.send :include, ResourcesHelper 
```

在 init.rb 文件中。

# ruby-on-rails - How can I detect if an html page element exists by using RoR RJS Template code?

> ID：667408
> 
> 赞同：0
> 
> 时间：2009-03-20T18:38:07.107
> 
> 标签：ruby-on-rails, ajax, rjs

I tried several ways but all are failing.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T18:05:47.800

正如 dbarker 所提到的，您可以`page['theElementID']`根据其 ID 来测试特定的 HTML 元素是否存在。

如果您的目标元素没有 ID 属性，您还可以使用 CSS 选择器检查它，包括类名。例如：

```
if page.select('div.comment').any?
    # Logic here if there is at least one comment
else
    # Logic for no comments
end 
```

文档`page.select`：[http ://api.rubyonrails.org/classes/ActionView/Helpers/PrototypeHelper/JavaScriptGenerator/GeneratorMethods.html#M001632](http://api.rubyonrails.org/classes/ActionView/Helpers/PrototypeHelper/JavaScriptGenerator/GeneratorMethods.html#M001632)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-05-21T09:57:22.707

其实我拿不到

```
 if page[:element]
        # code here
    end 
```

去工作。相反，我最终使用

```
 page << "if( $('element') ) {"
        # code here
    page << "}" 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-20T23:07:03.967

您可以使用 dbarker 所说的话：

```
 if page['theElementId'].nil?
       # then have you logic here if the element does not exist
 else
       # if the element does exist
 end 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-20T19:06:46.337

您可以使用 JavascriptGenerator 的 [ ] 方法来查找这样的元素：

```
page['theElementId'] 
```

这是详细信息的链接：

[模块 ActionView::Helpers::PrototypeHelper::JavaScriptGenerator::GeneratorMethods](http://api.rubyonrails.org/classes/ActionView/Helpers/PrototypeHelper/JavaScriptGenerator/GeneratorMethods.html#M001630)

# c# - 使用函数指针的好处

> ID：667410
> 
> 赞同：15
> 
> 时间：2009-03-20T18:38:19.277
> 
> 标签：c#, c++, c, programming-languages, function-pointers

我已经编程了几年，并且在某些情况下使用了函数指针。我想知道的是什么时候出于性能原因使用它们是合适的或不使用它们，我的意思是在游戏而不是商业软件的背景下。

函数指针很快，John Carmack 在 Quake 和 Doom 源代码中滥用了它们，因为他是个天才 :)

我想更多地使用函数指针，但我想在最合适的地方使用它们。

如今，在现代 c 风格语言（如 C、C++、C# 和 Java 等）中，函数指针的最佳和最实用的用途是什么？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-20T19:48:22.883

函数指针没有什么特别“快”的。它们允许您调用在运行时指定的函数。但是您的开销与从任何其他函数调用中获得的开销完全相同（加上额外的指针间接）。此外，由于要调用的函数是在运行时确定的，因此编译器通常不能像在其他任何地方那样内联函数调用。因此，在某些情况下，函数指针加起来可能比常规函数调用慢得多。

函数指针与性能无关，永远不应该用来获得性能。

相反，它们是对函数式编程范式的轻微认可，因为它们允许您将函数作为参数传递或在另一个函数中返回值。

一个简单的例子是一个通用的排序函数。它必须有某种方法来比较两个元素，以确定它们应该如何排序。这可能是传递给排序函数的函数指针，实际上 c++`std::sort()`可以完全这样使用。如果您要求它对未定义小于运算符的类型的序列进行排序，则必须传入一个函数指针，它可以调用它来执行比较。

这很好地引导我们找到一个更好的选择。在 C++ 中，您不仅限于函数指针。您经常使用函子代替 - 即重载 operator 的类`()`，以便它们可以像函数一样被“调用”。与函数指针相比​​，函子有几个很大的优势：

*   它们提供了更大的灵活性：它们是成熟的类，具有构造函数、析构函数和成员变量。它们可以维护状态，并且可以公开周围代码可以调用的其他成员函数。
*   它们更快：与函数指针不同，函数指针的类型只编码函数的签名（类型的变量`void (*)(int)`可以是*任何*接受 int 并返回 void 的函数。我们不知道是哪一个），函子的类型编码精确的函数那应该被调用（因为函子是一个类，称之为C，我们知道要调用的函数是，并且永远是，`C::operator()`）。这意味着编译器可以内联函数调用。这就是使泛型`std::sort`与专为您的数据类型设计的手动编码排序函数一样快的魔力。编译器可以消除调用用户定义函数的所有开销。
*   它们更安全：函数指针中几乎没有类型安全性。你不能保证它指向一个有效的函数。它可能是 NULL。指针的大多数问题也适用于函数指针。它们很危险且容易出错。

函数指针（在 C 中）或函子（在 C++ 中）或委托（在 C# 中）都解决了相同的问题，具有不同级别的优雅和灵活性：它们允许您将函数视为一等值，像您一样传递它们任何其他变量。您可以将一个函数传递给另一个函数，它会在指定的时间调用您的函数（当计时器到期时，当窗口需要重绘时，或者当它需要比较数组中的两个元素时）

据我所知（我可能是错的，因为我已经很久没有使用 Java 了），Java 没有直接的等价物。相反，您必须创建一个类，该类实现一个接口并定义一个函数（`Execute()`例如调用它）。然后不是调用用户提供的函数（以函数指针、仿函数或委托的形式），而是调用`foo.Execute()`. 原则上类似于 C++ 实现，但没有 C++ 模板的通用性，也没有允许您以相同方式处理函数指针和函子的函数语法。

这就是你使用函数指针的地方：当更复杂的替代方案不可用时（即你被困在C语言中），你需要将一个函数传递给另一个函数。最常见的场景是回调。您定义了一个函数 F，您希望系统在 X 发生时调用该函数。因此，您创建一个指向 F 的函数指针，并将其传递给相关系统。

所以说真的，忘记 John Carmack，不要假设你在他的代码中看到的任何东西都会神奇地让你的代码变得更好，如果你复制它。他使用函数指针是因为你提到的游戏是用 C 编写的，没有更好的替代品，而不是因为它们是某种神奇的成分，它的存在使代码运行得更快。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-20T18:55:00.310

如果您直到运行时才知道目标平台支持的功能（例如 CPU 功能、可用内存），它们会很有用。显而易见的解决方案是编写如下函数：

```
int MyFunc()
{
  if(SomeFunctionalityCheck())
  {
    ...
  }
  else
  {
    ...
  }
} 
```

如果在重要循环的深处调用此函数，那么最好为 MyFunc 使用函数指针：

```
int (*MyFunc)() = MyFunc_Default;

int MyFunc_SomeFunctionality()
{
  // if(SomeFunctionalityCheck())
  ..
}

int MyFunc_Default()
{
  // else
  ...
}

int MyFuncInit()
{
  if(SomeFunctionalityCheck()) MyFunc = MyFunc_SomeFunctionality;
} 
```

当然还有其他用途，比如[回调函数](http://en.wikipedia.org/wiki/Callback_(computer_science))、从内存执行字节码或创建解释语言。

在 Windows 上执行[Intel 兼容的字节码](http://www.intel.com/products/processor/manuals/)，这可能对解释器有用。例如，这是一个 stdcall 函数，返回 42 (0x2A) 存储在一个可以执行的数组中：

```
code = static_cast<unsigned char*>(VirtualAlloc(0, 6, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE));
// mov eax, 42
code[0] = 0x8b;
code[1] = 0x2a;
code[2] = 0x00;
code[3] = 0x00;
code[4] = 0x00;
// ret
code[5] = 0xc3;
// this line executes the code in the byte array
reinterpret_cast<unsigned int (_stdcall *)()>(code)();

...

VirtualFree(code, 6, MEM_RELEASE); 
```

);

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-20T18:40:44.403

每当您在 C# 中使用事件处理程序或委托时，您实际上是在使用函数指针。

不，它们与速度无关。函数指针是为了方便。

乔纳森

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-20T18:41:20.640

在许多情况下，函数指针用作回调。一种用途是作为排序算法中的比较函数。因此，如果您尝试比较自定义对象，您可以提供一个指向比较函数的函数指针，该函数知道如何处理该数据。

也就是说，我将提供我从前任教授那里得到的一句话：

> 对待一个新的 C++ 特性，就像对待一个拥挤的房间里的自动武器一样：永远不要仅仅因为它看起来很漂亮而使用它。等你明白后果，别装可爱，写你知道的，知道你写的。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-20T18:44:06.670

如今，在现代 c 风格语言中，整数的最佳和最实用的用途是什么？

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-03-26T15:37:19.107

根据我的个人经验，它们可以帮助您节省大量代码。

考虑条件：

```
switch(sample_var)
{

case 0:
          func1(<parameters>);
          break;

case 1:
          func2(<parameters>);
          break;

up to case n:
          funcn(<parameters>);
          break;

} 
```

其中`func1()`...`funcn()`是具有相同原型的函数。我们可以做的是：声明一个**`arrFuncPoint`**包含函数地址的 **`func1()`**函数指针数组**`funcn()`**

然后整个开关盒将被替换为

`*arrFuncPoint[sample_var];`

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-20T20:22:35.110

在 C++ 之前的黑暗时代，我在代码中使用了一种常见模式，即定义一个带有一组函数指针的结构，这些函数指针（通常）以某种方式对该结构进行操作并为其提供特定的行为。在 C++ 术语中，我只是在构建一个 vtable。不同之处在于我可以在运行时对结构产生副作用，以根据需要动态更改单个对象的行为。这以稳定性和易于调试为代价提供了更丰富的继承模型。然而，最大的代价是只有一个人可以有效地编写这段代码：我。

我在 UI 框架中大量使用了它，它让我可以即时更改对象的绘制方式、命令的目标对象等等——这是很少有 UI 提供的。

用 OO 语言形式化这个过程在每一个有意义的方面都会更好。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-20T18:41:35.837

只是说 C#，但函数指针在 C# 中使用。委托和事件（以及 Lambda 等）在底层都是函数指针，因此几乎所有 C# 项目都会充斥着函数指针。基本上每个事件处理程序，每个 LINQ 查询附近等 - 都将使用函数指针。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-20T22:17:24.990

函数指针是穷人的功能性尝试。您甚至可以提出一个论点，即拥有函数指针会使语言功能化，因为您可以使用它们编写更高阶的函数。

没有闭包和简单的语法，它们有点恶心。所以你倾向于使用它们远远低于预期。主要用于“回调”功能。

有时，OO 设计通过创建一个完整的接口类型来传递所需的函数来解决使用函数的问题。

C# 有闭包，所以函数指针（它实际上存储一个对象，因此它不仅是一个原始函数，而且也是一个类型化的状态）在那里更有用。

**编辑** 其中一条评论说应该有一个带有函数指针的高阶函数的演示。任何采用回调函数的函数都是高阶函数。比如说，[EnumWindows](http://msdn.microsoft.com/en-us/library/ms633497.aspx)：

```
BOOL EnumWindows(          
    WNDENUMPROC lpEnumFunc,
    LPARAM lParam
); 
```

第一个参数是要传入的函数，很简单。但是由于 C 中没有闭包，我们得到了这个可爱的第二个参数：“指定要传递给回调函数的应用程序定义的值。” 该应用程序定义的值允许您手动传递无类型状态以补偿缺少闭包。

.NET 框架也充满了类似的设计。例如，[IAsyncResult](http://msdn.microsoft.com/en-us/library/system.iasyncresult_members.aspx) .AsyncState：“获取一个用户定义的对象，该对象限定或包含有关异步操作的信息。” 由于 IAR 是您在回调中获得的全部内容，没有闭包，您需要一种方法将一些数据推送到异步操作中，以便稍后将其丢弃。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-23T09:51:45.350

有时使用函数指针可以加快处理速度。可以使用简单的调度表来代替长的 switch 语句或 if-then-else 序列。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-20T18:43:49.497

> > 函数指针很快

在什么情况下？相比？

听起来您只想使用函数指针来使用它们。那会很糟糕。

指向函数的指针通常用作回调或事件处理程序。

# c# - 如何从母版页中的控件调用 javascript 函数？

> ID：667412
> 
> 赞同：1
> 
> 时间：2009-03-20T18:38:37.323
> 
> 标签：c#, asp.net, jquery, jquery-ui

我有一个带有登录控件的母版页。单击登录按钮时，如果用户的会员资格将在 30 天内到期，我希望弹出一个 JQuery 对话框，否则它将正常登录。我不知道该怎么做。我将发布部分代码：

这是javascript：

```
<script type="text/javascript">
    function showjQueryDialog() {
        $("#dialog").dialog("open");
    }

    $(document).ready(function() {
        $("#dialog").dialog({
            autoOpen: false,
            modal: true,
            buttons: { "Renew Membership": function() 
                     { $(this).dialog("close"); } }
        });
    });
</script> 
```

登录按钮称为 ibtnLoginButton，下面是部分代码：

```
//Grab the user profile.
UserProfiles userProfile = 
             UserProfiles.GetUserProfiles(txtUserName1.Text);

//Calculate the Time Span
TimeSpan timeSpan = userProfile.Expiration.Subtract(DateTime.Now);

if (timeSpan.Days < 30)
{
 //Show JQuery Dialog Here
}
else
{
  //Continue with Login Process.
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T18:54:06.337

这个怎么样？

```
if (timeSpan.Days < 30)
{
 //Show JQuery Dialog Here
ScriptManager.RegisterClientScriptBlock(this, typeof(Page), "showExpiration", "showjQueryDialog()", true);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T18:48:35.257

为什么不总是在单击按钮时调用 jquery 方法，然后在 javascript 方法中确定是否要显示对话框？如果没有，就什么也不做。由于您只是在检查 ExpirationDate 是否小于 now + 30 天，因此您可以在 javascript 中进行该计算。

编辑：

我无法为您提供确切的解决方案，但这里有一些伪代码可以帮助您上路。

首先使用户个人资料的到期日期需要在 javascript 中可用：

```
<script>
var userProfileExpiresOn = "<asp:Literal ID="userProfileExpiresOn" />";
</script> 
```

然后编辑您的方法，使其执行您当前在服务器端为您执行的逻辑：

```
<script>
function showjQueryDialog() {
  if (userProfileExpiresOn < (now + 30 days))
    $("#dialog").dialog("open");
}
</script> 
```

您可以在 W3schools 找到一些关于[如何在 Javascript 中使用日期的文档。](http://www.w3schools.com/jsref/jsref_obj_date.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T21:55:47.287

如果，正如您所说，当单击 asp:Button 时出现此 jQuery 对话框，为什么不隐藏按钮并将您的 javascript 更改为在页面加载后仅按下按钮？

# java - 在我的 GUI (java) 中显示 CMD 输出

> ID：667416
> 
> 赞同：5
> 
> 时间：2009-03-20T18:39:35.620
> 
> 标签：java, user-interface, swing, cmd, real-time

如何让 CMD 进程的输出显示在我的 GUI 中？这是我用来运行该过程的代码：

```
try {
    String line;
    Process p = Runtime.getRuntime().exec("cmd /c \"e:\\folder\\someCommands.cmd\"");
    BufferedReader input =
            new BufferedReader(new InputStreamReader(p.getInputStream()));
    while ((line = input.readLine()) != null) {
        System.out.println(line);
    }
    input.close();
} catch (Exception err) {
    err.printStackTrace();
} 
```

我试过这样做：

```
jLabel1.setText(line); 
```

...但是在进程运行时 GUI 完全被锁定，所以直到最后都没有更新，这不是很有用。除此之外，CMD 工作正常。我只想实时显示输出。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T18:44:39.993

设置标签文本后是否重新绘制（）？

无论如何，您通常应该对在 GUI 事件线程上执行长时间操作感到犹豫。考虑使用 a[`SwingWorker`](http://java.sun.com/javase/6/docs/api/javax/swing/SwingWorker.html)代替。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T18:49:51.977

您需要启动一个单独的线程来运行该进程。您用来运行它的代码大部分可以按原样插入到线程的（或`Runnable`）`run()`方法中，但是要在 JLabel 中设置文本，您应该使用如下内容：

```
...
while ((line = input.readLine()) != null) {
    SwingUtilities.invokeLater(new SetTextRunnable(jLabel1, line));
}
...

class SetTextRunnable implements Runnable {
    private String line;
    private JLabel jLabel1
    public SetTextRunnable(JLabel jLabel1, String line) {
        this.jLabel1 = jLabel1;
        this.line = line;
    }
    public void run() {
        jLabel1.setText(line);
    }
} 
```

*编辑*：刚刚注意到一些事情：显然这个类`SwingWorker`是为这种事情设计的，所以这是你的另一个选择（如果它存在于你的 Java 版本中）。

*编辑到编辑*：我太傻了，我没有注意到`SwingWorker`另一个答案中已经提到过。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-20T18:54:34.180

除了其他人所说的多线程之外 - 您还需要阅读子进程错误流。我相信（在某些情况下）如果你不为进程耗尽错误流，它可能会导致它挂起。

# .net - Serialize .NET Array to XML as base 64?

> ID：667418
> 
> 赞同：1
> 
> 时间：2009-03-20T18:39:56.337
> 
> 标签：.net, arrays, serialization, base64

I'm writing a custom .NET serializer in C# and want to read and write Array objects to XML using XmlReader and XmlWriter. I would like to base64-encode the Array. The arrays may be 1-, 2- or 3-dimensional and the elements are bool or numeric types.

I'm completely stumped. XmlReader and XmlWriter have methods for reading/writing Byte[] arrays as base64 but I can't figure out how to get from an Array to a Byte[] and back.

The arrays could be large so I would prefer a solution that does not involve copying the array or processing one element at a time. Unsafe code and managed or native C++ are fine. I could use something other than base64 if it is safe for XML.

Thanks for any help or hints.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T18:50:20.433

You will have different options, depending on what kind of 'Array' you are using. Is it an Array, List<>, or ArrayList?

For List<>, you can use `CopyTo()` to grab parts of your List and put them into a binary array, which you could then write using XmlWriter. To read them back from the XmlReader, you can then simply use `InsertRange` to de-serialize the data.

A Reading Example:

```
// elsewhere
List<byte> bytes;

// in the deserialization
int bufferSize = 1024;
byte[] buffer = new byte[bufferSize]; 
int index = 0;
int numRead = -1;

while (numRead != 0) // actually read stuff
{
    numRead = reader.ReadContentAsBase64(buffer,  bufferSize);
    if (numRead > 0)
    {
        bytes.CopyTo(buffer, index, numRead);
        index += numRead;
    }
} 
```

Note: code above is not tested, but is probably close. You can do something similar, but in reverse, for encoding and writing the data to base64\. For other types, you simply need to convert your array into a list of bytes.

To get other types than bytes into a byte array, you'll need to use `System.BitConverter`. This has two methods that will make you very happy: `GetBytes` which converts any basic data type into a byte array, and `ToXxx`, which includes `ToInt32` and `ToBoolean`. You'll be responsible for doing that conversion yourself after you've read in the base64 information or before you write it out.

You can use BitConverter to do the per-bit conversion to a set of bytes, but it's up to you to design an algorithm for converting your arrays to a single byte array and back.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-15T15:09:58.283

如果使用 XmlSerializer，则可以在类型为 byte[] 的属性中指定 XmlElementAttribute，并将 DataType 属性设置为“base64Binary”。见[这里](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlelementattribute.datatype(VS.80).aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T22:38:35.330

如果您需要由包含 Base-64 文本的单个 XML 元素表示的单个数组，最简单的方法可能是使用[BinaryFormatter](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.formatters.binary.binaryformatter.aspx)将您的数据（任意维数的数组、列表等）转换为字节数组，并且然后只需对它进行 base-64 编码并将其粘贴到您的 XML 文件中。我想不出任何其他将任意数组转换为字节数组的简单方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-24T19:56:16.683

对我最终所做的事情的快速总结：对于序列化，我使用 BinaryWriter 将单个元素写入包含在 MemoryStream 中的字节数组。我将写入分成小块，因此 MemoryStream 数组保持较小。将块编写为具有 base64 编码文本内容的单个 XML 元素。

反序列化几乎是相反的。base64 块被解码为字节数组；字节数组由内存流包装并由 BinaryReader 读取以将元素推送到结果数组中。

# ruby - 为什么我不能连接两个字符串并将它们分配给一个符号？

> ID：667423
> 
> 赞同：11
> 
> 时间：2009-03-20T18:41:29.347
> 
> 标签：ruby, string, concatenation, symbols

. . . 如本例所示：

```
helloworld.rb:1: syntax error, unexpected '=', expecting $end
:helloworld = "hello ".concat("world") 
```

我想如果我使用 concat 我正在修改字符串“hello”并添加“world”，然后最终将生成的字符串 - “hello world” - 分配给等号左侧的 :helloworld 符号。我认为这是合法的，就像我写的一样：

```
:helloworld = "hello world" 
```

哦，等等，这也不起作用。（抓头）。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-20T18:47:08.910

Ruby 符号不能为它们分配值，因为它们代表规范值。如果要从字符串构建符号，可以使用 "hello".concat("world").to_sym。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-11-12T02:00:27.873

试试这个：

```
:"hello world" 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-20T19:31:44.403

当来自没有类似符号的语言时，符号会令人困惑。你不能分配给符号，那不是它们的用途。

这里有几个例子可以帮助解释它。

```
5.times do |i|
  # a new string is created in each iteration of the loop
  puts "my string".object_id

  # there is only ever one symbol for each possible value
  # so a new object is not created during each iteration
  puts :my_symbol.object_id

  # this often makes a difference when you're using them for things like hash keys
  #some_method(:name => 'bob')
  #some_method('name' => 'bob')
end 
```

另一个很大的区别是符号比较只是一个指针比较。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-20T19:39:57.193

也许你真正在寻找的是一个常数？它们可以动态生成，稍后参考，如果您尝试重新分配它们，则会收到警告。

```
>> HELLO_WORLD = "hello ".concat("world")
=> "hello world"
>> HELLO_WORLD = "foo"
(irb):3: warning: already initialized constant HELLO_WORLD
=> "foo" 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-06-20T15:14:45.317

你不能分配给一个符号，但你可以返回一个符号，它是其他符号的串联，尽管据我所知你必须通过字符串（我想知道是否有更好的方法）。

假设您要从符号和`:myway`开始获取符号；`:my``:way`

```
(:my.to_s + :way.to_s).to_sym # return :myway 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-20T18:47:01.487

嗯，是的。您不能分配给符号。你的意思是这样的：

```
foo = { :helloworld => "hello ".concat("world") } 
```

?

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-02-23T01:08:22.340

```
class Symbol
  def + (to)
    return "#{self}#{to}".to_sym
  end
end 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-05-30T11:20:08.983

这对我有用

```
@foo = 'world'
"hello #{@foo}".to_s.to_sym 
```

输出=>：“你好世界”

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-08-29T08:42:26.073

您可以使用默认的 ruby​​ 字符串到符号转换来创建函数。根据例子

```
def sum_of_two_sym(sym1, sym2)
    (sym1.to_s + sym2.to_s).to_sym
end

sum_of_two_sym(:hello, :world) 
```

结果将显示：helloworld

这里我只是写了一个函数，函数的名称`sum_of_two_sym`我在两个参数中传递了两个参数：hello 和 :world，`sym1`然后`sym2`sym1 和 sym2 转换为字符串并将它们连接起来，最后将结果转换为符号并返回。

# jquery - 拖动调整大小手柄时多次触发调整大小事件

> ID：667426
> 
> 赞同：21
> 
> 时间：2009-03-20T18:41:44.040
> 
> 标签：jquery, resize, window, jquery-events

我希望这个 jQuery 插件能够工作，但它没有：

[http://andowebsit.es/blog/noteslog.com/post/how-to-fix-the-resize-event-in-ie](http://andowebsit.es/blog/noteslog.com/post/how-to-fix-the-resize-event-in-ie) （旧链接是 noteslog.com/post/how-to-fix-the-resize -事件在IE）。

我在他的网站上添加了一条评论，但它们是经过审核的，所以你可能还看不到它。

但无论如何，让我解释一下我的愿望。我希望在用户暂停调整大小和/或完成调整大小时触发“调整大小”类型的事件，而不是*在*用户主动拖动浏览器的窗口调整大小句柄时触发。我有一个相当复杂且耗时的`OnResizeHandled`函数，我需要运行，但不能运行 100 次，因为用户将窗口扩大了 100 像素，并且事件被触发了移动像素。我想最好的办法是在用户完成调整大小后处理它。

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2009-03-20T22:06:33.363

像这样的一些代码怎么样：

```
function resizeStuff() {
 //Time consuming resize stuff here
}
var TO = false;
$(window).resize(function(){
 if(TO !== false)
    clearTimeout(TO);
 TO = setTimeout(resizeStuff, 200); //200 is time in miliseconds
}); 
```

这应该确保该函数仅在用户停止调整大小时才调整大小。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-20T18:47:19.673

从并发解决方案中借鉴一些想法来管理来自浏览器的大量事件。

例如，当您第一次收到 resize 事件时，将标志设置为 true，表示用户当前正在调整大小。设置超时以在 1 秒后调用实际的调整大小事件处理程序。然后，只要此标志为真，就忽略调整大小事件。然后，在实际的处理程序中，一旦一切都完成并正确，将标志设置回 false。

这样，您每秒只处理一次最新事件（或其他一段时间，具体取决于您的要求）。如果用户在调整大小的过程中暂停，它将处理。如果用户完成，它将处理。

这可能不适合您，但还有许多其他使用锁的方法可能更有帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-06-16T16:33:18.397

Paul Irish 有一个很棒的[Debounced jQuery 插件](http://paulirish.com/2009/throttled-smartresize-jquery-event-handler/)可以解决这个问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-10-17T14:23:46.603

如果你喜欢图书馆，你应该检查下划线，下划线已经满足了你的需要，你的项目中可能会有更多。

这是下划线去抖器如何工作的示例：

```
// declare Listener function
var debouncerListener = _.debounce( function(e) {

    // all the actions you need to happen when this event fires

}, 300 ); // the amount of milliseconds that you want to wait before this function is called again 
```

然后只需在调整窗口大小时调用该 debouncer 函数

```
window.addEventListener("resize", debouncerListener, false); 
```

在这里查看所有可用的下划线函数[http://underscorejs.org/](http://underscorejs.org/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-20T18:45:53.720

当用户暂停调整大小时如何设置超时？发生调整大小时重置超时，或者如果超时到期，则触发调整大小事件处理程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-20T18:52:14.250

由于它是用 jQuery 构建的，你不能将某种 onComplete 事件绑定到扩展并传递一个在调用时应该执行的函数吗？

编辑：

当用户开始调整窗口大小时，设置观察窗口尺寸的时间间隔。如果在您的规范的预设时间段内尺寸没有改变，那么您可以考虑调整窗口大小“完成”。您在此选择的 javascript 函数将是 setInterval()，它接受两个参数 - 一个调用每个刻度的函数，以及每个刻度需要多长时间（以毫秒为单位）。

至于如何在 jquery 框架中专门编写它，好吧，我对 jquery 的了解还不够，无法告诉你。也许其他人可以更具体地帮助您，但同时您可以考虑扩展您已经与 onComplete 事件链接的 jquery 扩展，该事件就像我刚才描述的那样工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-02T02:10:07.450

几天前我扩展了默认的 jQuery `on`-event-handler。如果在给定的时间间隔内未触发事件，它会将一个或多个事件的事件处理函数附加到所选元素。如果您只想在延迟后触发回调，这很有用，例如调整大小事件，或者其他。 [https://github.com/yckart/jquery.unevent.js](https://github.com/yckart/jquery.unevent.js)

```
;(function ($) {
    var methods = { on: $.fn.on, bind: $.fn.bind };
    $.each(methods, function(k){
        $.fn[k] = function () {
            var args = [].slice.call(arguments),
                delay = args.pop(),
                fn = args.pop(),
                timer;

            args.push(function () {
                var self = this,
                    arg = arguments;
                clearTimeout(timer);
                timer = setTimeout(function(){
                    fn.apply(self, [].slice.call(arg));
                }, delay);
            });

            return methods[k].apply(this, isNaN(delay) ? arguments : args);
        };
    });
}(jQuery)); 
```

像任何其他`on`或`bind`-event 处理程序一样使用它，除了你可以传递一个额外的参数作为最后一个：

```
$(window).on('resize', function(e) {
    console.log(e.type + '-event was 200ms not triggered');
}, 200); 
```

[http://jsfiddle.net/ARTsinn/EqqHx/](http://jsfiddle.net/ARTsinn/EqqHx/)

# jquery - 如何优雅地索引 jQuery 对象数组？

> ID：667428
> 
> 赞同：4
> 
> 时间：2009-03-20T18:42:33.290
> 
> 标签：jquery

我发现自己开始写这个：

```
$($("a-selector-which-returns-multiple-objects")[index]).SomejQueryFunctionForExampleShow() 
```

因为我有一个返回多个对象的查询，所以`[index]`运算符返回 DOM 对象，而不是 jQuery 对象，所以我将它转换回带有外部`$()`.

这工作正常，但似乎不优雅，我觉得我错过了一些关于索引到 jQuery 对象集的东西 - 这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-20T18:47:16.367

在您描述的情况下，您根本不需要索引您的元素。由于 JQuery 链接其命令的方式，您将在前一个选择器返回的*所有*元素上运行任何命令。

以下示例将隐藏所有`<a>`元素：

```
$(document).ready(function() {
    $("a").hide();
}); 
```

如果它需要是一个特定的元素，你应该给它一个唯一的 ID 来选择：

```
$(document).ready(function() {
    $("#my-unique-id").hide();
}); 
```

如果要将特定索引作为 JQuery 对象返回，则应使用[eq 函数](http://docs.jquery.com/Core/eq#position)。

```
$(document).ready(function() {
    $("a").eq(0).hide();
}); 
```

但同样，在您的情况下，您根本不需要索引。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T19:00:05.870

jQuery 为此目的提供了诸如[Traversing/eq](http://docs.jquery.com/Traversing/eq)和[Traversing/slice](http://docs.jquery.com/Traversing/slice)之类的功能，以及针对更复杂情况的其他诸如[Traversing/filter之类的功能。](http://docs.jquery.com/Traversing/filter)

```
$("selector").eq(0).show(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T18:46:35.323

如果你想在某些对象上执行 SomejQueryFunctionForExampleShow() 为什么 index 只是这样做：

```
$("a-selector-which-returns-multiple-objects").SomejQueryFunctionForExampleShow(). 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T19:03:12.977

您可以使用[filter 命令](http://docs.jquery.com/Traversing/filter)过滤原始包装集，然后对子集执行命令（然后使用[end 命令](http://docs.jquery.com/Traversing/end)返回原始包装集）。

# asp.net - Using a colon (:) in a url with ASP.NET/IIS

> ID：667429
> 
> 赞同：19
> 
> 时间：2009-03-20T18:42:54.070
> 
> 标签：asp.net, iis, url, httphandler, colon

I'm implementing a custom controller in ASP.NET MVC and *really* want to be able to use a colon in the urls, so that I can identify class/column names and their values, like so:

[http://example.com/user:chaiguy](http://example.com/user:chaiguy)

...but apparently ASP.NET or IIS doesn't allow colons in urls. I did some digging and apparently it's considered a security issue, *but*, I'm using MVC and am handling *all* url paths manually (just treating them as strings), and not relating them to the file system, so I'm pretty sure this doesn't apply.

I also heard some talk about implementing a custom Http handler or something.

Any thoughts or ideas would be much appreciated.

* * *

> Er.... why? Seriously, why break standards? – Randolpho

...

> I suggest, then, that you investigate building a web service. WCF is a nice technology for that, and it hosts well in IIS.

I happen to like urls, and WCF is way too complicated for my purposes. I want it to be url-compatible, like REST, but capable of more than just navigating hierarchies, or doing well laid-out things. The problem I have with /users/chaiguy is that it is interpreting hierarchy where there is none: in my system "user" is a class, it's not a folder. user:chaiguy means the instance of the user class with the value of "chaiguy", and that is a single entity, that has the potential of having child-entities. So for example:

`/user:chaiguy/name`

...I would like to display the name of that entity. If I did this with your method, it would look like this:

`/users/chaiguy/name`

The problem is how do you know what's the class and what's the value? It could be interpreted as

`/users/chaiguy:name`

in my system, and that doesn't make sense. See what I'm getting at? To give a slightly more complicated example, suppose we want to select a child of the user entity out of multiple instances. So a user might have several email addresses. To select one, we might use:

`/user:chaiguy/email:me@here.com/`

So it is in fact recursive. It's not a file path, it's more like an XPath (or maybe similar to jQuery based on what little I know of it yet). That is, it's more of a dynamically-evaluated query selection than a hardwired file path. It gets evaluated on the server.

Make no mistake, I'm not building a typical web site or even web service here.

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2011-04-25T21:40:25.480

更改web.config中的`requestPathInvalidCharacters`属性：`httpRuntime`

```
<httpRuntime maxRequestLength="20480" requestValidationMode="2.0" requestPathInvalidCharacters="" maxQueryStringLength="20480" /> 
```

并且 ASP.NET 不应再阻止您的请求路径中的冒号。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-08-23T05:20:57.580

在这里回答了类似的问题：[https ://stackoverflow.com/a/12037000/134761](https://stackoverflow.com/a/12037000/134761)

似乎 ASP.net 不允许在“？”之前使用冒号。在 URL 中，即使它被编码为 %3A。

例如，这些将不起作用：

[http://foo.org/api/persons/foo:bar](http://foo.org/api/persons/foo:bar)

[http://foo.org/api/persons/foo%3abar](http://foo.org/api/persons/foo%3abar)

但这有效：

[http://foo.org/api/persons?id=foo%3abar](http://foo.org/api/persons?id=foo%3abar)

在所有示例中，我们希望 ASP.NET MVC 将“foo:bar”作为 id 参数传递，并正确解码。我刚刚用 MVC4 测试了这个，它似乎工作。令人讨厌的是它不接受问号之前的 URL 编码，但我确信这是有充分理由的。可能将问号之前的所有内容保留为有效的 URL 以及问号之后的任何参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T18:50:44.673

I suggest you rethink what you want to do. Use pathing to indicate context and hide your class and field names, mapping particular contexts within your URL paths to class names and fields. If you need to indicate a user, for example, build your URL layout like `example.com/users/chaiguy` rather than `example.com/user:chaiguy`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-07T09:06:12.970

尝试设置 HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\HTTP\Parameters\AllowRestrictedChars。这是来自[http://support.microsoft.com/?id=820129](http://support.microsoft.com/?id=820129)。我不知道 ASP.NET/MVC 是否自己做一些检查，但如果它只是 http.sys 阻止你，这应该可以解决它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-12-15T15:24:54.387

这个 web.config 设置对我有用。它在 url 中接受冒号 (:)。

```
<httpRuntime targetFramework="4.6.1" requestPathInvalidCharacters=""/> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-07T09:14:34.310

实际上有 WCF REST 可用，您可以使用[此处](http://www.asp.net/downloads/starter-kits/wcf-rest/)提供的 WCF 入门工具包在一小时内轻松启动并运行。这利用了 REST 的强大功能并将其与 WCF 的易用性相结合。此外，使用 WCF，您还可以创建自己的传输层，如果需要，可以以任何您希望的方式解释 URL。关于初学者工具包的一件有趣的事情是它允许在 Url 中使用空格，这实际上给真正的 REST Fundi 带来了一些麻烦。

由于 WCF，我并不热衷于查看它，但您真的不需要知道那么多。该解决方案创建您需要的一切，只需添加代码。

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2012-01-02T03:13:18.497

我建议使用句号。基于 HTTP 协议的 REST 是一个为 HTTP 构建新用途的示例，该用途符合标准并且非常成功。也许你可以这样做。

和一个“。” 在许多语言中是标准的“class.method”或“class.attribute”。

现在ME，我想在URL参数中使用冒号，有些地方正在这样做。我还得看看我能不能摆脱它。

PS，对我来说，我可以使用这个： [http ://www.businesscasualblog.com/2009/07/how-to-share-a-link-to-a-specific-timecode-in-youtube-video.html](http://www.businesscasualblog.com/2009/07/how-to-share-a-link-to-a-specific-timecode-in-youtube-video.html)

本质上是'--h--m--s'

* * *

## 回答 #8

> 赞同：-10
> 
> 时间：2011-04-04T15:08:35.863

**冒号在 url 中有效吗？**简短的回答**没有**。

长答案，是的，如果它在一个 url**片段**中。

示例：（`http://site/gwturl#user:45/comments`注意冒号是哈希标签）

来源

*   这个答案，
*   [冒号对于友好 URL 使用安全吗？](https://stackoverflow.com/questions/2053132/is-a-colon-safe-for-friendly-url-use)
*   以及在 ASP.NET 中添加`:`到 url 并获得 YSOD的个人测试`A potentially dangerous Request.Path value was detected from the client (:)`

# synchronization - How to synchronize threads when polling for state changes with boost

> ID：667436
> 
> 赞同：0
> 
> 时间：2009-03-20T18:44:28.683
> 
> 标签：synchronization, locking, monitor, boost-thread

In my application I want to be informed by events, that another application has been started or stopped. I have an existing API to the running application **which cannot be changed** to accomodate notification which would be the obvious solution.

What I have is a function call in the API (isRunning), so I decided to make a polling thread which polls the state through the API and informs my app.

My problem is now, the API call in the polling thread uses an object which is also used in my own application's main thread and I'd like to know how to be sure that I make it right :).

My idea would be to wrap each call to the API object (through an adapter e.g., see the second code block) with a mutex lock, so I'm sure the API is not called by my threads more than once.

Is this the right approach?

I'm using boost for threading/syncing (see code).

This is the polling thread:

```
void EventCreator::start()
{
    stop();
    m_bShouldRun = true;    
    m_spThread = BoostThreadPtr(new thread(bind(&EventCreator::run,this)));
}

void EventCreator::stop()
{
    {
        lock_guard<mutex> lock(m_mutex);
        m_bShouldRun = false;
        m_condition.notify_one();
    }

    if (m_spThread)
    {
        m_spThread->join();
        m_spThread.reset();
    }    
}

void EventCreator::run()
{
    bool isRTAppRunning = m_pDevice->isApplicationRunning();
    while (m_bShouldRun)
    {
        boost::unique_lock<mutex> lock(m_mutex);
        // 
        if(!m_condition.timed_wait(lock,boost::system_time(boost::get_system_time() + boost::posix_time::milliseconds(25))))
        {
            // here because of time out, so no sleep necessary
            bool isStillRunning = m_pDevice->isApplicationRunning();
            if (isRTAppRunning != isStillRunning)
            {   

                if (isStillRunning)
                {
                    // Using SendMessage to main thread => no problem here
                    notifyAppStarted();
                }
                else
                {   
                    notifyAppStopped(); 
                }
                isRTAppRunning = isStillRunning;
            }
            // in addition to wait above
            m_spThread->yield();
        }
    }
} 
```

These are some API calls from the main thread:

```
void Device::getData(Int32 byteCnt)
{
    mutex::scoped_lock lock(m_monitor);
    m_pApi->fetchBytes(&m_buf,byteCnt);
}

bool Device::isApplicationRunning()
{
    mutex::scoped_lock lock(m_monitor);
    return m_pApi->getState() == DV_RUNNING;
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T19:08:26.987

这听起来是个不错的方法。

一般来说，锁在非竞争时应该非常快地获取。您的轮询线程应该不经常轮询，即最多每隔几秒一次，因此对锁的争用应该非常小。

如果您的两个线程一直在争夺锁，您将需要重新考虑您的设计。

# nhibernate - 在 NHibernate 中使用 Enterprise Library 日志记录应用程序块

> ID：667438
> 
> 赞同：3
> 
> 时间：2009-03-20T18:44:35.780
> 
> 标签：nhibernate, log4net, enterprise-library

我们正在尝试将 NHibernate 集成为我们的 OR/M，但是，我们目前正在使用 Enterprise Library 的日志记录应用程序块。我知道 NHibernate 使用 log4net 来记录。有没有人有任何关于如何使用 Enterprise Library 记录 NHibernate 相关日志的示例？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T18:57:16.953

编写你自己的 log4net appender 写入 EL 记录器。这是一个适配器模式。

继承一个新的/自定义的 appender 类`log4net.Appender.AppenderSkeleton`

覆盖`Append`骨架类中的事件处理程序，并在其中显示`RenderedMessage`，如下所示：

```
using System;
using log4net;
using System.Windows.Forms;

namespace MyAppender
{
    public class CustomAppender : log4net.Appender.AppenderSkeleton
    {
        protected override void Append(log4net.spi.LoggingEvent log)
        {
            // log to EL logger based on log properties.
        }
    }
} 
```

然后你需要配置 log4net 配置文件....

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <log4net>
        <appender name="MyAppender" type="MyAppender.CustomAppender,CustomAppender">
            <threshold value="DEBUG"/>
        </appender>

        <root>
            <level value="DEBUG" />
                <appender-ref ref="MyAppender" />
        </root>
    </log4net>
</configuration> 
```

我没有测试过这个，但它应该能让你继续前进。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T18:51:26.997

为什么不让 nHibernate 使用 log4net？是的，您必须管理两个，否则您必须为 log4net 编写一个适配器以登录到 EntLibrary。

我也使用 EntLibrary，只处理用于 nHibernate 的 Log4Net。在他们的开发讨论组中，他们谈到删除 log4net 作为一种依赖，但我认为尚未对此进行任何工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T20:56:20.223

这是我一直想知道的关于自己的事情。我可以为您确认[NHibernate 对 Log4Net 有很强的依赖关系](http://groups.google.com/group/nhusers/browse_thread/thread/1fe14d3c2548ddf8/9d9bb9297b03092a?q=#9d9bb9297b03092a)，因此，您必须按照 Josh 的说明编写一个附加程序。

**编辑：从 NHibernate 3 开始，不再存在硬依赖。**

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-20T22:31:13.087

NHibernate 3 及更高版本允许您通过获取必要的二进制文件并配置它们来使用他们的 Common Logging 实现以及 Microsoft 的 Enterprise Library 5.0。请参阅[NHibernate.Logging.CommonLogging](http://nhlogging.codeplex.com/ "NHibernate.Logging.CommonLogging")和[Common.Logging.EntLib50](http://nuget.org/packages/Common.Logging.EntLib50 "Common.Logging.EntLib50")。

我在网上的任何地方都没有找到这个，所以我想即使问题很旧，我也会发布它。这是一个配置文件（您必须添加必要的引用）：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
 <section name="loggingConfiguration" type="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.LoggingSettings, Microsoft.Practices.EnterpriseLibrary.Logging, Version=5.0.505.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" requirePermission="true" />
 <sectionGroup name="common">
      <section name="logging" type="Common.Logging.ConfigurationSectionHandler, Common.Logging" />
    </sectionGroup>
  </configSections>

  <loggingConfiguration name="" tracingEnabled="true"
    defaultCategory="General">
    <listeners>
      <add name="Event Log Listener" type="Microsoft.Practices.EnterpriseLibrary.Logging.TraceListeners.FormattedEventLogTraceListener, Microsoft.Practices.EnterpriseLibrary.Logging, Version=5.0.505.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
        listenerDataType="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.FormattedEventLogTraceListenerData, Microsoft.Practices.EnterpriseLibrary.Logging, Version=5.0.505.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
        source="Enterprise Library Logging" formatter="Text Formatter"
        log="trace.log" machineName="." traceOutputOptions="DateTime" />
      <add name="Flat File Trace Listener" type="Microsoft.Practices.EnterpriseLibrary.Logging.TraceListeners.FlatFileTraceListener, Microsoft.Practices.EnterpriseLibrary.Logging, Version=5.0.505.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
        listenerDataType="Microsoft.Practices.EnterpriseLibrary.Logging.Configuration.FlatFileTraceListenerData, Microsoft.Practices.EnterpriseLibrary.Logging, Version=5.0.505.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
        fileName="MyLogNameGoesHere.txt" formatter="Text Formatter" traceOutputOptions="DateTime" />
    </listeners>
    <formatters>
      <add type="Microsoft.Practices.EnterpriseLibrary.Logging.Formatters.TextFormatter, Microsoft.Practices.EnterpriseLibrary.Logging, Version=5.0.505.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
        template="Timestamp: {timestamp}{newline}&#xA;Message: {message}{newline}&#xA;Category: {category}{newline}&#xA;Priority: {priority}{newline}&#xA;EventId: {eventid}{newline}&#xA;Severity: {severity}{newline}&#xA;Title:{title}{newline}&#xA;Machine: {localMachine}{newline}&#xA;App Domain: {localAppDomain}{newline}&#xA;ProcessId: {localProcessId}{newline}&#xA;Process Name: {localProcessName}{newline}&#xA;Thread Name: {threadName}{newline}&#xA;Win32 ThreadId:{win32ThreadId}{newline}&#xA;Extended Properties: {dictionary({key} - {value}{newline})}"
        name="Text Formatter" />
    </formatters>
    <categorySources>
      <add switchValue="All" name="General">
        <listeners>
          <add name="Event Log Listener" />
        </listeners>
      </add>
    </categorySources>
    <specialSources>
      <allEvents switchValue="All" name="All Events">
        <listeners>
          <add name="Flat File Trace Listener" />
        </listeners>
      </allEvents>
      <notProcessed switchValue="All" name="Unprocessed Category" />
      <errors switchValue="All" name="Logging Errors &amp; Warnings">
        <listeners>
          <add name="Event Log Listener" />
        </listeners>
      </errors>
    </specialSources>
  </loggingConfiguration>

  <appSettings>
    <add key="nhibernate-logger" value="NHibernate.Logging.CommonLogging.CommonLoggingLoggerFactory, NHibernate.Logging.CommonLogging" />
  </appSettings>
  <common>
    <logging>
      <factoryAdapter type="Common.Logging.EntLib.EntLibLoggerFactoryAdapter, Common.Logging.EntLib50"/>
    </logging>
  </common>

  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="NHibernate" publicKeyToken="aa95f207798dfdb4" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-3.2.1.4000" newVersion="3.2.1.4000" />
      </dependentAssembly>
    </assemblyBinding>
  </runtime>
</configuration> 
```

# sql - 如何外连接两个表（主表和多对一子表）以仅从第二个表中获取一项？

> ID：667459
> 
> 赞同：1
> 
> 时间：2009-03-20T18:50:13.317
> 
> 标签：sql, postgresql, join, outer-join

我有两个类似这样的表：

主表：id（int）、title（varchar）等 子表：main_table_id（主表的外键）、tag（varchar）等

对于主表中的给定行，可以有零个或多个子表行。

我想做一个查询，它将返回主表的每一行，主表的列，以及子表的单行（无关紧要）中的列，如果有的话，否则在这些列中为 NULL。

当然，如果我只是做一个基本的 LEFT OUTER JOIN，那么我当然会让主表重复多次，子表中的每个匹配一个。

我确信我在使用 LEFT OUTER JOIN 和某种技巧之前已经看到了这一点，它强制从子表中只选择一行，而不是全部 - 也许选择最小或最大 OID。然而，一个多小时的谷歌搜索并没有产生任何解决方案。

有人在他们的工具带中有这个技巧吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T19:03:55.720

如果您使用的是 SQL Server，则可以使用 TOP 子句。如果它不是 SQL Server，您将必须查看该数据库是否提供等效的东西（其中许多提供）。像这样的东西...

```
Select * from Main m
left outer join 
(select top 1 * from subtable s
  where s.main_table_id = m.id) q
on q.main_table_id = m.id; 
```

注意：这是向您展示总体思路。我没有机会运行它，因此可能需要进行一些更改，但概念就在那里。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T19:16:25.267

我最喜欢查理的回答，但我不确定 Postges 是否有 TOP/LIMIT 函数，所以这里有一个不需要的替代解决方案（但假设 sub_table 有一个名为“id”的主键）：

```
SELECT * 
FROM main_table m LEFT OUTER JOIN sub_table s 
ON s.main_table_id = m.id
WHERE s.id IS NULL OR s.id IN ( 
  SELECT MAX(id) FROM sub_table GROUP BY main_table_id
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T18:54:44.417

如果您只是检查第二个表中的某些内容与第一个表中的项目一起使用，则可以使用带有 group by 子句和聚合的外连接：

```
select t1.[name], count(t1.[name]) as t2count
   from table1 t1
   left outer join table2 t2 on t1.fk = t2.pk
group by t1.[name] 
```

然后，t2count 为 0 的任何内容都将是 table2 中没有任何内容的内容

**编辑：**实际上，我不记得 t2count 中是否会有 null 或 0 ......它应该是这些值之一。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-09-18T14:09:51.757

Postgres 中的有趣方法（根本不是学校）：

```
SELECT * 
 FROM main_table m left join (
   select (max(s::character varying)::subtable).* from subtable s group by main_table_id 
 ) s ON s.main_table_id = m.id 
```

说明：
您选择完整记录作为一个字段：

```
select s from subtable s 
```

您将其转换为不同的字符，以便能够使用 max agregat （或 min ...）

```
 select max(s::character varying) from subtable s group by main_table_id 
```

您仅通过 main_table_id 获得一行，其中包含代表您的记录的 varchar，因此我们必须再次在“subtable”中转换并分解它 -> (myvarchar::subtable)。*

```
select (max(s::character varying)::subtable).* from subtable s group by main_table_id 
```

您只需一行 main_table_id 即可获得表格子表

# sql - 使用 STSADM 添加内容数据库，但无法连接到 SQL Server

> ID：667469
> 
> 赞同：1
> 
> 时间：2009-03-20T18:52:58.773
> 
> 标签：sql, sql-server, sharepoint-2007

我正在尝试将内容数据库添加到我的 MOSS 2007 站点，但我似乎无法连接到 SQL Server。我从命令提示符运行以下命令：

stsadm -o addcontentdb -url htt://testserver:101 -databasename WSS_ Content_MySite -databaseserver SHAREPOINT01

STASADM 给我这个错误：“建立与服务器的连接时发生错误。连接到 SQL Server 2005 时，此故障可能是由于在默认设置下 SQL Server 不允许远程连接。” 那么我的服务器当然允许远程连接。

根据 SQL Server 错误日志，虽然没有问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T12:17:44.523

所以事实证明问题出在我的参数上。在指定数据库服务器时，我只提到了 SQL 实例名称。正确的格式是 -databaseserver SERVER\INSTANCE，因为我只有 INSTANCE。之后就没有问题了！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T20:37:20.273

[http://technet.microsoft.com/en-us/library/cc261956.aspx#section1](http://technet.microsoft.com/en-us/library/cc261956.aspx#section1)

这可能是一个荒谬的建议，但也可以尝试使用 -dn 而不是 databasename 和 -ds。

这就是它在文档中的列出方式，所以也许它不喜欢这样并追求你的本地服务器，这已经存在？？？

你会认为如果它不喜欢这个开关，它会抛出一个错误。

# windows - 如何使用 Strawberry Perl 运行程序？

> ID：667471
> 
> 赞同：28
> 
> 时间：2009-03-20T18:54:03.433
> 
> 标签：windows, perl, ack, strawberry-perl

一位同事试图在他的 Windows 机器上使用[ack](http://betterthangrep.com)（一个 Perl 程序），他在 Linux 下尝试过，并决定他肯定想使用它。他设法在他的机器上安装了[Strawberry Perl](http://www.strawberryperl.com)，但似乎无法弄清楚如何从命令提示符下使用它运行 ack。他尝试编辑 #! 行，但我知道那行不通。我很确定 Strawberry perl 在他的 PATH 中。

使用 Strawberry 在 Windows 上的 PATH 中运行通用 Perl 程序需要做什么？

更新：我在网上看到一些关于 PATHEXT 变量的信息，但还不够。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-21T16:25:46.557

首先，要注意程序在 . 中`Path`，而不仅仅是`perl.exe`. Perl 二进制文件和核心程序通常最终位于`<installdir>\bin`，但其他可能最终位于站点特定目录`<installdir>\site\bin`中。命令

```
dir C:\strawberry\ack* /s 
```

可能有助于您的搜索。确保您`Path`反映了您的设置。

至少据我所知，有两种常用方法可以从 Windows 命令提示符运行 Perl 程序。

首先是使用[pl2bat](http://search.cpan.org/~rgarcia/perl-5.10.0/win32/bin/pl2bat.pl)创建程序的批处理版本，它将`perl`与程序一起执行。已安装的程序通常会自动执行此操作，因为`MakeMaker`并`Module::Build`会处理此问题。

二是创建`.pl`文件关联。这是通过创建注册表项`HKEY_LOCAL_MACHINE\SOFTWARE\Classes\.pl\Shell\Open\Command`（或者`HKEY_CURRENT_USER`如果它仅适用于当前用户）并将`(Default)`值设置为

```
"C:\strawberry\perl\bin\perl.exe" "%1" %* 
```

这样，您只需使用`.pl`扩展名命名程序即可调用程序。现在您可以使用`program.pl`.

您可能已经注意到，您可以在没有扩展名的情况下调用 Windows 上的程序。该程序在 中搜索`Path`，但当没有扩展名时，`PATHEXT`用于完成名称。追加`.pl`到列表中，您可以使用 调用程序`program`。请注意，此列表中的顺序对于搜索很重要，就像中的顺序一样`Path`。

安装人员通常会处理最后两个步骤，但如果您想添加自己的步骤或需要修复它，这些知识很有用。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-20T20:03:14.750

我只是安装 ack 并从命令行运行它没有问题。

草莓 Perl 是否安装正确？你能从 cmd.exe 运行“perl”吗？

```
C:\> perl -V
Summary of my perl5 (revision 5 version 10 subversion 0) configuration:
  Platform:
    osname=MSWin32, osvers=5.1, archname=MSWin32-x86-multi-thread
... 
```

App::Ack 是否安装正确？

```
C:\> cpan App::Ack
...
Installing C:\strawberry\perl\site\lib\App\Ack.pm
Installing C:\strawberry\perl\site\lib\App\Ack\Plugin.pm
Installing C:\strawberry\perl\site\lib\App\Ack\Repository.pm
Installing C:\strawberry\perl\site\lib\App\Ack\Resource.pm
Installing C:\strawberry\perl\site\lib\App\Ack\Plugin\Basic.pm
Installing C:\strawberry\perl\bin\ack
Installing C:\strawberry\perl\bin\ack.bat
Writing C:\strawberry\perl\site\lib\auto\ack\.packlist
Appending installation info to C:\strawberry\perl\lib/perllocal.pod
  PETDANCE/ack-1.88.tar.gz
  C:\strawberry\c\bin\dmake.EXE install UNINST=1 -- OK 
```

如果是这样，我不明白为什么你不能从命令行运行“ack”：

```
C:\> ack --version
ack 1.88

Copyright 2005-2009 Andy Lester, all rights reserved.

This program is free software; you can redistribute it and/or modify it
under the same terms as Perl itself. 
```

如果它不起作用，那么该链条中的哪些地方坏了？例如，如果你不能从命令行运行“perl”，那么草莓没有正确安装（或者不在你的 PATH 中），你需要修复它。但除此之外，ack 会使用“ack.bat”包装器安装到与“perl”相同的路径中，因此如果您可以运行“perl”，您应该能够运行“ack”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-08T10:32:42.483

另一种解决方案是使用 PAR::Packer 创建 ack.exe - 他根本不需要 Strawberry。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-05-17T04:52:28.383

1.安装strawberry-perl 2.打开perl命令行 3.编写命令perl test.pl

[脚步](https://i.stack.imgur.com/ojs1L.png)

# upload - 如何批量上传到 s3？

> ID：667478
> 
> 赞同：6
> 
> 时间：2009-03-20T18:55:15.740
> 
> 标签：upload, amazon-s3, performance, bulk

我最近重构了一些代码，使用“加载数据”将行填充到数据库中，效果很好——但是对于我拥有的每条记录，我必须将 2 个文件上传到 s3——这完全破坏了我获得的巨大速度升级. 虽然我每秒能够处理 600 多个这些文档，但由于 s3，它们现在以 1/秒的速度流入。

您对此有什么解决方法？查看 API，我发现它主要是 RESTful，所以我不确定该怎么做——也许我应该将所有这些都保存到数据库中。文本文件通常不超过 1.5k。（我们在其中填充的另一个文件是文本的 xml 表示）

我已经将这些文件缓存在对我的 Web 服务器的 HTTP 请求中，因为它们被大量使用。

顺便说一句：我们当前的实现使用java；我还没有尝试过线程，但这可能是一个选择

建议？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T20:15:36.063

您可以使用[JetS3t](https://jets3t.dev.java.net/)`putObjects`的 [ ][1] 功能一次上传多个文件。

或者，您可以使用后台线程从队列上传到 S3，并从将数据加载到数据库的代码中将文件添加到队列中。

[1]：[http](http://jets3t.s3.amazonaws.com/api/org/jets3t/service/multithread/S3ServiceMulti.html#putObjects(org.jets3t.service.model.S3Bucket) ://jets3t.s3.amazonaws.com/api/org/jets3t/service/multithread/S3ServiceMulti.html#putObjects(org.jets3t.service.model.S3Bucket, org.jets3t.service.model. S3对象[])

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-03-29T18:25:34.490

**我刚刚找到了一个很好的解决方案，可以使用php**上传整个目录：

```
$client->uploadDirectory(
  SOURCE_FOLDER,
  YOUR_BUCKET_NAME,
  DESTINATION,
  array(
    'concurrency' => 5,
    'debug'          => TRUE,
    'force'            => FALSE,
    'params'        => array(
      'ServerSideEncryption' => 'AES256',
    ),
  )
); 
```

# asp.net - 在 ASP.NET 中访问要写入浏览器的内容

> ID：667486
> 
> 赞同：0
> 
> 时间：2009-03-20T18:59:20.253
> 
> 标签：asp.net, html, browser, rewrite, response

我希望访问将要写入浏览器的网页内容。我已经使用表单适配器进行了测试和测试，它适用于介于两者之间的任何内容`<form>`，`</form>`但超出它的内容不在传递给表单适配器的上下文中。

有没有办法（通过我假设的 HTTP 模块）获取即将转储到浏览器的内容？我想在输出到达用户之前修改输出中的一些文本/标签，并且它并不总是在`<form>`标签之间。

我正在使用 VB.NET，但如果您有 C# 示例，则可以访问代码重写器。

**编辑**：我希望完成的是编辑发送到浏览器的文本并更改显示的一些 URL。例如，当人们在内部使用内容编辑器时，所有图像都将来自服务器“img.mysite.com” - 但是当它公开提供时，我希望它来自“img1.mysite.com”或“ img2.mysite.com" 等... 不超过我们拥有的服务器数量。另外，还有其他一些我们想要更改的项目。我已经有了 RegEx，它可以找到我们想要的标签并替换文本。我已经在表单适配器中实现了它并且效果很好。但是，我们有一些我想了解的`<form>`标签（等）之外的东西。`<head>`

通过更改 URL，它还可以让我超越每个 URL 2 个连接的限制。

肖恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T19:24:32.270

一种更简单的方法是设置循环 DNS 解析，以便主机名 img.mysite.com 的解析请求在每个提供图像的实际服务器之间轮换。每个服务器将被配置为理解它是“img.mysite.com”，以便它处理请求。

# python - 如何调试奇怪的线程打开 fifo 问题？

> ID：667500
> 
> 赞同：0
> 
> 时间：2009-03-20T19:01:14.447
> 
> 标签：python, multithreading, stream, fifo, inetd

Web 服务被配置为在接收到 USR1 信号时公开其一些数据。当 xinetd 服务器接收到来自远程客户端的请求时，该信号将由 xinetd 服务器发送，例如 nc myserver 50666。当 web 服务器收到 USR1 信号时，它会打开一个专用的 fifo 管道，将其数据写入管道，然后关闭管道。与此同时，xinetd 服务器读取管道并提供给远程客户端。

在大多数情况下，它们工作得很好，但偶尔，出于某种原因，客户端会收到重复记录。从日志来看，管道似乎没有正确关闭并且缓存是剩余的，所以下次它服务时，以前的和当前的都被发送到客户端。问题是它在尝试复制时不会经常发生，不幸的是，我无法复制一次。

以下是演示该过程的简单片段：

网络服务器：（webserver.py）

```
def SendStream(data, pipe):
  try:
    for i in data:
      pipe.write(i + '\n') 
      pipe.flush()
  finally:
      pipe.close()

def Serve():
  threading.Thread(target=SendStream, args=(data, pipe)).start() 
```

xinetd.d 服务器：（spitter.py）

```
def Serve():
  if not os.path.exists(PIPE_FILE):
    os.mkfifo(PIPE_FILE)
  os.kill(server_pid, signal.SIGUSR1)
  for i in open(PIPE_FILE):
    print i, 
```

那么究竟是什么导致了 dup 呢？如何触发它？当前修复我取消链接管道文件并每次重新创建它以避免任何剩余但我不知道这是否是一个正确的解决方案。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T19:40:18.253

如果你同时运行了两个 splitter.py 副本，就会有麻烦，而且几乎任何发生在你身上的事情都是合法的。尝试将进程 ID 值添加到 webserver.py，即：

pipe.write(str(os.getpid()) + i + '\n')

这可能很有启发性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T21:13:25.717

这里没有足够的调试。您没有显示服务器如何处理信号或打开管道。

如果可能的话，我建议不要使用信号。它们在 C 语言中已经够多的了，更不用说在上面添加了 python 自己的特性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T20:23:02.177

So the real problem is that there are multiple clients exist. The server has been queried/abused from other unknown clients which weren't initially being agreed with customers and sure it will break under the current design. A fix has been deployed to address the issue. So Andy's suspicion is right. Thanks guys!

# sql-server - 对数据库进行多次计算的最佳方法（.NET 2.0 VB）

> ID：667503
> 
> 赞同：0
> 
> 时间：2009-03-20T19:01:25.803
> 
> 标签：sql-server, sqldatareader

是创建大量 SQL 语句还是在 asp .NET 中缓存数据并从那里操作数据更好？

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T19:12:37.743

这取决于计算可能是什么，即它是否可以在 SQL 中轻松完成，每台服务器上的负载是多少，等等。如果数据库服务器没有承受太多负载，那么网络服务器就是数据库端反之亦然。

每种情况都没有一个答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T19:08:17.410

您不应该将数据读取器存储在缓存中，这可能会导致垃圾收集问题并保持打开的数据库连接。每次处理数据都应该是一个进入/退出的过程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T19:08:30.840

这实际上取决于应用程序、环境、您的数据和计算类型。如果没有更多信息，就没有很好的方法来回答这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T19:55:30.010

考虑您是否会在将通过网络发送的内容中保存任何内容。例如，如果您需要聚合数据（计数、总和等），通常最好让 sql 服务器处理它。这样你只发送一小部分信息。尝试将它们加入同一个数据库调用中，这样您就不会以多次往返结束（由于延迟，这实际上是最糟糕的）。

如果您仍将出于其他原因提取所有数据，那么您可以通过在应用程序级别执行它来节省 sql server 上的一些处理。这可以让您更好地分散负载。

# wpf - WPF：数据绑定 - 用户控件没有行为

> ID：667505
> 
> 赞同：2
> 
> 时间：2009-03-20T19:01:45.600
> 
> 标签：wpf, data-binding, user-controls

我有一点数据绑定问题。（我通常有...）

这是我在运行时在输出窗口中得到的错误：

```
System.Windows.Data Error: 39 : BindingExpression path error: 'CurrentKlokke' property not found on 'object' ''UIKlokke' (Name='anaKlokke')'. BindingExpression:Path=CurrentKlokke; DataItem='UIKlokke' (Name='anaKlokke'); target element is 'UIKlokke' (Name='anaKlokke'); target property is 'klokke' (type 'Klokke') 
```

'anaKlokke' 是 'UIKlokke' 的一个实例，它是一个代表模拟时钟的用户控件。

```
 <UserControl
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Klokketrening"
        mc:Ignorable="d"
        x:Class="Klokketrening.UIKlokke"
        x:Name="UserControl"
        DataContext="{Binding RelativeSource={RelativeSource self}}"
        d:DesignWidth="400" d:DesignHeight="400">

        <UserControl.Resources>
            <ControlTemplate x:Key="clockTemplate">
                <Grid>
                    <Grid.Resources>
                        <local:TimeTilVinkel x:Key="hourToAngle"/>
                        <local:MinuttTilVinkel x:Key="minuteToAngle"/>
                    </Grid.Resources>
                    <Grid.LayoutTransform>
                        <ScaleTransform ScaleX="2" ScaleY="2" />
                    </Grid.LayoutTransform>
                    <Ellipse Width="108" Height="108" StrokeThickness="3">
                        <Ellipse.Stroke>
                            <LinearGradientBrush>
                                <GradientStop Color="LightBlue" Offset="0" />
                                <GradientStop Color="DarkBlue" Offset="1" />
                            </LinearGradientBrush>
                        </Ellipse.Stroke>
                    </Ellipse>

                    <Canvas Width="102" Height="102">
                        <Ellipse Width="8" Height="8" Fill="Black" Canvas.Top="46" Canvas.Left="46" />
                        <Rectangle x:Name="HourHand" Canvas.Top="26" Canvas.Left="48" Fill="Black" Width="4" Height="25">
                            <Rectangle.RenderTransform>
                                <RotateTransform x:Name="HourHand2" CenterX="2" CenterY="25" Angle="{Binding Converter={StaticResource hourToAngle}}" />                     
                            </Rectangle.RenderTransform>
                        </Rectangle>
                        <Rectangle x:Name="MinuteHand" Canvas.Top="16" Canvas.Left="49" Fill="Black" Width="2" Height="35">
                            <Rectangle.RenderTransform>
                                <RotateTransform CenterX="1" CenterY="35" Angle="{Binding Converter={StaticResource minuteToAngle}}" />
                            </Rectangle.RenderTransform>
                        </Rectangle>
                    </Canvas>
                </Grid>
            </ControlTemplate>
        </UserControl.Resources>
        <Grid>
            <Control Template="{StaticResource clockTemplate}" DataContext="{Binding klokke}" />
        </Grid> 
    </UserControl> 
```

以及背后的代码：

```
public partial class UIKlokke
{

    public Klokke klokke
    {
        get {return (Klokke)GetValue(UIKlokke.KlokkeProperty); }
        set { SetValue(UIKlokke.KlokkeProperty, value); } 
    }

    public static readonly DependencyProperty KlokkeProperty;

    public UIKlokke()
    {
        this.InitializeComponent();
    }

    static UIKlokke()
    {
        UIKlokke.KlokkeProperty = DependencyProperty.Register("klokke", typeof(Klokke), typeof(UIKlokke));
    }
} 
```

在我使用这个用户控件的地方，我想将用户控件的“klokke”属性绑定到“游戏”对象的“CurrentKlokke”属性。

```
<local:UIKlokke x:Name="anaKlokke" Grid.Column="0" Grid.Row="1" klokke="{Binding CurrentKlokke}"/> 
```

CurrentKlokke 是一个依赖属性。

```
 public Klokke CurrentKlokke
    {
        get { return (Klokke)GetValue(Game.CurrentKlokkeProperty); }
        set { SetValue(Game.CurrentKlokkeProperty, value);  }
    }
    public static readonly DependencyProperty CurrentKlokkeProperty;

    static Game()
    {
        Game.CurrentKlokkeProperty = DependencyProperty.Register("CurrentKlokke", typeof(Klokke), typeof(Game));
    } 
```

我在代码中为包含 UIKlokke 实例的网格设置了 DataContext：

```
 _game = new Game(Game.GameLevel.Easy, 10);
        gridGameUI.DataContext = _game; 
```

我将列表框的 itemsource 绑定到 Game 对象的另一个属性，它工作正常。

有人可以帮我解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T19:53:13.650

尝试从 UIKlokke 控件中删除 Klokke 属性，并将 anaKlokke 对象的 DataContext 直接绑定到 Klokke。

此外，您不需要将控件放在用户控件内的网格​​内。您可以只使用 UserControls.Template：

```
<UserControl ... DataContext="No needed its set on the game">
  <UserControl.Template>
    <ControlTemplate>
      <Grid>
        <!-- ... -->
      </Grid>
    </ControlTemplate>
  </UserControl.Template>
</UserControl> 
```

这样，DataContext 直接设置为 UserControl

如果您需要在代码隐藏中访问 Klokke，您可以使用

```
var klokke = DataContext as Klokke;
if (klokke == null) return;

// use klokke 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T19:45:03.593

不确定这一点，我只是从 WPF 开始。但是你不应该`Path`像这样在你的绑定中使用：

```
<local:UIKlokke x:Name="anaKlokke"  
                Grid.Column="0" Grid.Row="1" 
                klokke="{Binding Path=CurrentKlokke}"/> 
```

# python - 什么是好的速率限制算法？

> ID：667508
> 
> 赞同：172
> 
> 时间：2009-03-20T19:02:27.640
> 
> 标签：python, algorithm, message-queue

我可以使用一些伪代码，或者更好的 Python。我正在尝试为 Python IRC 机器人实现一个限速队列，它可以部分工作，但是如果有人触发的消息少于限制（例如，速率限制是每 8 秒 5 条消息，而这个人只触发 4 条），并且下一个触发时间超过 8 秒（例如，16 秒后），机器人发送消息，但队列已满，机器人等待 8 秒，尽管由于 8 秒的时间已经过去，因此不需要它。

* * *

## 回答 #1

> 赞同：259
> 
> 时间：2009-03-20T23:15:27.253

这是[最简单的算法](http://en.wikipedia.org/wiki/Token_bucket)，如果您只想在消息到达太快时丢弃消息（而不是排队，这是有道理的，因为队列可能会变得任意大）：

```
rate = 5.0; // unit: messages
per  = 8.0; // unit: seconds
allowance = rate; // unit: messages
last_check = now(); // floating-point, e.g. usec accuracy. Unit: seconds

when (message_received):
  current = now();
  time_passed = current - last_check;
  last_check = current;
  allowance += time_passed * (rate / per);
  if (allowance > rate):
    allowance = rate; // throttle
  if (allowance < 1.0):
    discard_message();
  else:
    forward_message();
    allowance -= 1.0; 
```

在这个解决方案中没有数据结构、计时器等，它工作得很干净:) 看到这一点，“津贴”最多以每秒 5/8 个单位的速度增长，即每八秒最多五个单位。转发的每条消息都会扣除一个单位，因此每八秒发送的消息不能超过五条。

注意`rate`应该是一个整数，即没有非零小数部分，否则算法将无法正常工作（实际速率不会是`rate/per`）。例如`rate=0.5; per=1.0;`不起作用，因为`allowance`永远不会增长到 1.0。但`rate=1.0; per=2.0;`工作正常。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2009-03-20T19:51:44.137

在入队的函数之前使用这个装饰器 @RateLimited(ratepersec)。

基本上，这会检查自上次以来是否已经过 1/rate secs，如果没有，则等待剩余时间，否则不等待。这有效地限制了您的速率/秒。装饰器可以应用于您想要限制速率的任何功能。

在您的情况下，如果您希望每 8 秒最多发送 5 条消息，请在您的 sendToQueue 函数之前使用 @RateLimited(0.625) 。

```
import time

def RateLimited(maxPerSecond):
    minInterval = 1.0 / float(maxPerSecond)
    def decorate(func):
        lastTimeCalled = [0.0]
        def rateLimitedFunction(*args,**kargs):
            elapsed = time.clock() - lastTimeCalled[0]
            leftToWait = minInterval - elapsed
            if leftToWait>0:
                time.sleep(leftToWait)
            ret = func(*args,**kargs)
            lastTimeCalled[0] = time.clock()
            return ret
        return rateLimitedFunction
    return decorate

@RateLimited(2)  # 2 per second at most
def PrintNumber(num):
    print num

if __name__ == "__main__":
    print "This should print 1,2,3... at about 2 per second."
    for i in range(1,100):
        PrintNumber(i) 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-03-20T19:04:30.803

令牌桶实现起来相当简单。

从一个有 5 个令牌的存储桶开始。

每 5/8 秒：如果桶中的令牌少于 5 个，则添加一个。

每次要发送消息：如果bucket中的token≥1，则取出一个token发送消息。否则，等待/丢弃消息/无论如何。

（显然，在实际代码中，您将使用整数计数器而不是真正的令牌，并且您可以通过存储时间戳来优化每 5/8 秒的步骤）

* * *

再次阅读问题，如果速率限制每 8 秒完全重置一次，那么这里是一个修改：

`last_send`从很久以前（例如，在纪元）的时间戳开始。此外，从相同的 5 令牌桶开始。

执行每 5/8 秒规则。

每次发送消息时：首先检查是否`last_send`≥8 秒前。如果是这样，请填充存储桶（将其设置为 5 个令牌）。其次，如果桶中有令牌，则发送消息（否则，丢弃/等待/等）。第三，设置`last_send`到现在。

这应该适用于那种情况。

* * *

我实际上已经使用这样的策略（第一种方法）编写了一个 IRC 机器人。它在 Perl 中，而不是 Python 中，但这里有一些代码来说明：

这里的第一部分处理向存储桶添加令牌。您可以看到基于时间添加令牌的优化（第 2 到最后一行）然后最后一行将存储桶内容钳制到最大值（MESSAGE_BURST）

```
 my $start_time = time;
    ...
    # Bucket handling
    my $bucket = $conn->{fujiko_limit_bucket};
    my $lasttx = $conn->{fujiko_limit_lasttx};
    $bucket += ($start_time-$lasttx)/MESSAGE_INTERVAL;
    ($bucket <= MESSAGE_BURST) or $bucket = MESSAGE_BURST; 
```

$conn 是一个被传递的数据结构。这是在一个例行运行的方法中（它计算下一次它什么时候有事情要做，并且休眠那么长时间或者直到它获得网络流量）。该方法的下一部分处理发送。它相当复杂，因为消息具有与之相关的优先级。

```
 # Queue handling. Start with the ultimate queue.
    my $queues = $conn->{fujiko_queues};
    foreach my $entry (@{$queues->[PRIORITY_ULTIMATE]}) {
            # Ultimate is special. We run ultimate no matter what. Even if
            # it sends the bucket negative.
            --$bucket;
            $entry->{code}(@{$entry->{args}});
    }
    $queues->[PRIORITY_ULTIMATE] = []; 
```

这是第一个队列，无论如何都会运行。即使它使我们的连接因洪水而被杀死。用于极其重要的事情，例如响应服务器的 PING。接下来，剩下的队列：

```
 # Continue to the other queues, in order of priority.
    QRUN: for (my $pri = PRIORITY_HIGH; $pri >= PRIORITY_JUNK; --$pri) {
            my $queue = $queues->[$pri];
            while (scalar(@$queue)) {
                    if ($bucket < 1) {
                            # continue later.
                            $need_more_time = 1;
                            last QRUN;
                    } else {
                            --$bucket;
                            my $entry = shift @$queue;
                            $entry->{code}(@{$entry->{args}});
                    }
            }
    } 
```

最后，桶状态被保存回 $conn 数据结构（实际上在该方法中稍晚一点；它首先计算它多久会有更多工作）

```
 # Save status.
    $conn->{fujiko_limit_bucket} = $bucket;
    $conn->{fujiko_limit_lasttx} = $start_time; 
```

如您所见，实际的桶处理代码非常小——大约四行。其余代码是优先队列处理。该机器人具有优先级队列，例如，与它聊天的人无法阻止它执行重要的踢/禁止职责。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-06-20T17:39:35.310

要阻塞处理直到可以发送消息，从而使更多消息排队，antti的漂亮解决方案也可以这样修改：

```
rate = 5.0; // unit: messages
per  = 8.0; // unit: seconds
allowance = rate; // unit: messages
last_check = now(); // floating-point, e.g. usec accuracy. Unit: seconds

when (message_received):
  current = now();
  time_passed = current - last_check;
  last_check = current;
  allowance += time_passed * (rate / per);
  if (allowance > rate):
    allowance = rate; // throttle
  if (allowance < 1.0):
    time.sleep( (1-allowance) * (per/rate))
    forward_message();
    allowance = 0.0;
  else:
    forward_message();
    allowance -= 1.0; 
```

它只是等到有足够的余量来发送消息。为了不以两倍的费率开始，津贴也可以用0初始化。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-20T19:07:15.557

一种解决方案是为每个队列项目附加一个时间戳，并在 8 秒后丢弃该项目。您可以在每次添加队列时执行此检查。

仅当您将队列大小限制为 5 并在队列已满时丢弃任何添加时，这才有效。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-20T19:18:10.367

保留最后五行发送的时间。保留排队的消息，直到第五个最近的消息（如果存在）过去至少 8 秒（last_five 作为时间数组）：

```
now = time.time()
if len(last_five) == 0 or (now - last_five[-1]) >= 8.0:
    last_five.insert(0, now)
    send_message(msg)
if len(last_five) > 5:
    last_five.pop() 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-06-10T19:23:38.193

如果有人仍然感兴趣，我将这个简单的可调用类与定时 LRU 键值存储结合使用来限制每个 IP 的请求率。使用双端队列，但可以重写为与列表一起使用。

```
from collections import deque
import time

class RateLimiter:
    def __init__(self, maxRate=5, timeUnit=1):
        self.timeUnit = timeUnit
        self.deque = deque(maxlen=maxRate)

    def __call__(self):
        if self.deque.maxlen == len(self.deque):
            cTime = time.time()
            if cTime - self.deque[0] > self.timeUnit:
                self.deque.append(cTime)
                return False
            else:
                return True
        self.deque.append(time.time())
        return False

r = RateLimiter()
for i in range(0,100):
    time.sleep(0.1)
    print(i, "block" if r() else "pass") 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-10-20T09:52:31.630

只是来自已接受答案的代码的 python 实现。

```
import time

class Object(object):
    pass

def get_throttler(rate, per):
    scope = Object()
    scope.allowance = rate
    scope.last_check = time.time()
    def throttler(fn):
        current = time.time()
        time_passed = current - scope.last_check;
        scope.last_check = current;
        scope.allowance = scope.allowance + time_passed * (rate / per)
        if (scope.allowance > rate):
          scope.allowance = rate
        if (scope.allowance < 1):
          pass
        else:
          fn()
          scope.allowance = scope.allowance - 1
    return throttler 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-01T22:58:49.223

这个怎么样：

```
long check_time = System.currentTimeMillis();
int msgs_sent_count = 0;

private boolean isRateLimited(int msgs_per_sec) {
    if (System.currentTimeMillis() - check_time > 1000) {
        check_time = System.currentTimeMillis();
        msgs_sent_count = 0;
    }

    if (msgs_sent_count > (msgs_per_sec - 1)) {
        return true;
    } else {
        msgs_sent_count++;
    }

    return false;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-10-14T03:39:42.813

我需要 Scala 的变体。这里是：

```
case class Limiter[-A, +B](callsPerSecond: (Double, Double), f: A ⇒ B) extends (A ⇒ B) {

  import Thread.sleep
  private def now = System.currentTimeMillis / 1000.0
  private val (calls, sec) = callsPerSecond
  private var allowance  = 1.0
  private var last = now

  def apply(a: A): B = {
    synchronized {
      val t = now
      val delta_t = t - last
      last = t
      allowance += delta_t * (calls / sec)
      if (allowance > calls)
        allowance = calls
      if (allowance < 1d) {
        sleep(((1 - allowance) * (sec / calls) * 1000d).toLong)
      }
      allowance -= 1
    }
    f(a)
  }

} 
```

以下是它的使用方法：

```
val f = Limiter((5d, 8d), { 
  _: Unit ⇒ 
    println(System.currentTimeMillis) 
})
while(true){f(())} 
```

# python - 有没有办法在 py-transport 服务器端手动注册用户？

> ID：667510
> 
> 赞同：1
> 
> 时间：2009-03-20T19:02:48.233
> 
> 标签：python, xmpp, ejabberd

我正在尝试编写一些脚本来将我的用户迁移到 ejabberd，但是建议我使用传输注册用户的唯一方法是让他们使用他们的客户端并发现服务。肯定有办法的吧？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-09T19:02:43.027

1.  每次运输都要经过一次并自己注册。捕获 XMPP 数据包。
2.  将当前系统中的传输注册数据转储到 csv 文件、xml 文件或其他您可以知道其结构的文件中。
3.  使用 jabberpy、xmpppy、pyxmpp 或其他任何东西编写脚本，并模拟您注册传输的每个用户。

一个问题是您可能必须连接到 Internet 才能使传输联机。然后，您将使用其他人的帐户。如果您无法为您的 jabber 服务器获取他们当前的密码数据，请将其全部设置为默认值，然后在传输注册后将其迁移回来。

# wpf - 仅绑定标签的一部分

> ID：667511
> 
> 赞同：27
> 
> 时间：2009-03-20T19:02:57.593
> 
> 标签：wpf, binding, label

如何在 WPF 绑定控件中实现绑定值与常量文本的混合？

例如，假设我有一个显示订单的表单，并且我想要一个显示诸如“订单 ID 1234”之类的文本的标签。

我试过这样的事情：

```
text="Order ID {Binding ....}" 
```

这是可以实现的，还是我必须做一些事情，比如在流控制中有多个标签？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-05-13T17:55:56.940

Binding.StringFormat 属性对标签不起作用，您需要在标签上使用 ContentStringFormat 属性。
例如，以下示例将起作用：

```
<Label>
    <Label.Content>
        <Binding Path="QuestionnaireName"/>
    </Label.Content>
    <Label.ContentStringFormat>
        Thank you for taking the {0} questionnaire
    </Label.ContentStringFormat>
</Label> 
```

与短版相同：

```
<Label Content="{Binding QuestionnaireName}" ContentStringFormat="Thank you for taking the {0} questionnaire" /> 
```

使用它在值之后显示一个单位：

```
<Label Content="{Binding Temperature}" ContentStringFormat="{}{0}°C" /> 
```

虽然此示例不会：

```
<Label>
    <Label.Content>
        <Binding Path="QuestionnaireName" StringFormat="Thank you for taking the {0} questionnaire"/>
    </Label.Content>            
</Label> 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-20T19:10:30.057

如果您使用的是 3.5 SP1，则可以`StringFormat`在绑定上使用该属性：

```
<Label Content="{Binding Order.ID, StringFormat=Order ID \{0\}}"/> 
```

否则，请使用转换器：

```
<local:StringFormatConverter x:Key="StringFormatter" StringFormat="Order ID {0}" />
<Label Content="{Binding Order.ID, Converter=StringFormatter}"/> 
```

作为`StringFormatConverter`一个`IValueConverter`：

```
[ValueConversion(typeof(object), typeof(string))]
public class StringFormatConverter : IValueConverter
{
    public string StringFormat { get; set; }

    public object Convert(object value, Type targetType,
                          object parameter, CultureInfo culture) {
         if (string.IsNullOrEmpty(StringFormat)) return "";
         return string.Format(StringFormat, value);
    }

    public object ConvertBack(object value, Type targetType,
                              object parameter, CultureInfo culture)
    {
        throw new NotSupportedException();
    } 
```

这样就行了。

[**编辑**：将`Text`属性更改为`Content`]

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-21T03:31:37.090

例如，经常被忽视的是简单地将多个文本块链接在一起

```
<TextBlock Text="{Binding FirstName}" />
<TextBlock Text=" " />
<TextBlock Text="{Binding LastName}" /> 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-20T19:22:20.573

另一种方法是使用单个 TextBlock，其中包含多个 Run 元素：

```
<TextBlock><Run>Hello</Run><Run>World</Run></TextBlock> 
```

..但是要绑定到您需要使用的元素，请添加一个[BindableRun](http://fortes.com/2007/03/bindablerun/)类。

**更新**但是这种技术有一些缺点......见[这里](http://msdn.microsoft.com/en-us/magazine/dd569761.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-12-08T11:13:31.953

我找到了另一种方法。@Inferis 的解决方案对我不起作用，@LPCRoy 的解决方案对我来说并不优雅：

```
<Label Content="{Binding Path=Order.ID, FallbackValue=Placeholder}" ContentStringFormat="Order ID {0}"> 
```

这是我目前最喜欢的，它看起来灵活而浓缩。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-19T14:22:26.560

修改了 Mikolaj 的答案。

```
<Label Content="{Binding Order.ID}" ContentStringFormat="Order ID {0}" /> 
```

FallbackValue 不是必须的。

# javascript - Firefox 设置启用跨域 Ajax 请求

> ID：667519
> 
> 赞同：47
> 
> 时间：2009-03-20T19:04:27.217
> 
> 标签：javascript, http, xmlhttprequest

我需要*暂时*允许跨域 XMLHttpRequest。更改 Firefox 安全设置似乎是要走的路。但是我已经尝试过[这个](http://blog.dirolf.com/2007/06/enabling-cross-domain-ajax-in-firefox.html)和[这个](http://www.zachleat.com/web/2007/08/30/cross-domain-xhr-with-firefox/)，但它们没有用。以前有没有人能够配置这个？谢谢。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2012-03-30T13:11:50.603

如果您只是不想在开发和测试应用程序期间将时间浪费在跨域问题上，您可以使用插件[Force CORS](https://addons.mozilla.org/en-US/firefox/addon/forcecors/) for FF。

更新：这个插件似乎不再存在。但还有另一种选择 - 这个[Chrome 扩展](https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-11-05T07:08:30.357

对于现代浏览器，您可以尝试以下方法：

[https://developer.mozilla.org/en/HTTP_access_control](https://developer.mozilla.org/en/HTTP_access_control)

简而言之，您需要将以下内容添加到`SERVER`响应标头中（以下内容允许*从* `foo.example`访问）：

```
Access-Control-Allow-Origin: http://foo.example
Access-Control-Allow-Methods: POST, GET, OPTIONS
Access-Control-Allow-Headers: X-PINGOTHER
Access-Control-Max-Age: 1728000 
```

请注意，这`X-PINGOTHER`是由 JavaScript 插入的自定义标头，并且应该因站点而异。

如果您希望任何站点在 Ajax 中访问您的服务器，请`*`改用。

* * *

编辑：

**当我在2009 年**第一次回答这个问题时，我实际上遇到了同样的问题，我使用服务器端配置解决了这个问题。

那时 FF 或 Chrome 上还没有插件。

但是，现在我们确实有使用浏览器端插件的替代方案，请查看答案`tsds`

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-20T19:10:19.807

你试过使用 jQuery 的[ajax](http://docs.jquery.com/Ajax/jQuery.ajax#options)请求吗？从 1.3 版开始，jQuery 支持某些类型的跨域 ajax 请求。

引用上面的参考资料：

> 注意：当 'script' 或 'jsonp' 是 dataType 时，所有远程（不在同一个域上）请求都应指定为 GET（因为它使用 DOM 脚本标签加载脚本）。需要 XMLHttpRequest 对象的 Ajax 选项不适用于这些请求。complete 和 success 函数在完成时调用，但不接收 XHR 对象；不调用 beforeSend 和 dataFilter 函数。
> 
> 从 jQuery 1.2 开始，如果指定 JSONP 回调，则可以加载位于另一个域中的 JSON 数据，可以像这样：“myurl?callback=?”。jQuery 自动替换 ? 使用正确的方法名称调用，调用您指定的回调。或者，如果您将 dataType 设置为“jsonp”，则会自动将回调添加到您的 Ajax 请求中。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-26T03:28:29.600

事情是这样的，没有办法“暂时”禁用跨域 XMLHttpRequest，如果你可以暂时禁用它，那么它可以永久禁用。这是现代 AJAX 编程中一个相当普遍的问题，通常使用称为跨域脚本的技术来解决。

这里的想法是，如果您调用跨域脚本，它会返回 JavaScript (JSON) 结果，然后将这些结果传递给您端的函数。

以下是一些示例代码，用于说明从 JavaScript 代码角度看它的外观：

```
 function request_some_data() {
    var s = "http://my.document.url.com/my_data?p1=v1&p2=v2&callback=myfunc";

      try {
        try{
          document.write("<scr"+"ipt type='text/javascript' src='"+s+"'></scr"+"ipt>");
        } 
        catch(e){
          var x = document.createElement("script");
          x.src = s;
          document.getElementsByTagName("head")[0].appendChild(x);
        }
      }
      catch (e) {
        alert(e.message);
      }
   } 
```

然后，您将在代码中定义一个接收数据的函数，并在您“处理”回调案例的服务器中定义一个函数，这里是客户端 JavaScript：

```
function myfunc(data) {
  alert(data);
} 
```

在服务器端，我在这里给出一个 PHP 示例，但这可以在 Java 或任何您的服务器端技术中轻松完成：

```
<?php
   if($_GET["callback"]) {
     print($_GET["callback"] . "(");
   }
   /* place your JSON object code/logic here */
   if($_GET["callback"]) {
     print(");");
   }
 ?> 
```

请注意，您在服务器端生成的内容最终是一些在客户端执行的 JavaScript。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-20T19:12:04.250

我也尝试过使用“UniversalBrowswerRead”的东西，但它没有用。您也许可以添加一个“允许”标题，但我还没有真正尝试过这样做。这很新。

[你可以在这里](http://websecurity.ro/blog/2008/04/10/cross-domain-requests-will-be-back/)找到更多信息

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-12-15T10:32:13.337

我正面临着这个从`file://`。我想从本地 HTML 文件（测试平台）向两台服务器发送查询。

这种特殊情况不应该是任何安全问题，但只有 Safari 允许这样做。

这是我发现的关于这个问题的[最佳讨论。](http://www.simple-talk.com/dotnet/asp.net/calling-cross-domain-web-services-in-ajax/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-22T22:44:05.423

使用 mod_proxy 之类的东西怎么样？然后它在您的浏览器中看起来就像请求将发送到同一台服务器，但它们实际上是被转发到另一台服务器。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-08-05T07:19:30.573

我使用 Fiddler 作为代理。[Fiddler](http://www.fiddler2.com/fiddler2/)将 localhost 调用重定向到外部服务器。

我将 Firefox 配置为使用手动代理（127.0.0.1 端口 8888）。Fiddler 使用 URL 过滤器捕获调用并将它们重定向到另一台服务器。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-07-15T20:05:21.343

允许跨域：

1.  进入`about:config`
2.  接受要小心
3.  `security.fileuri.strict_origin_policy`在搜索栏中输入
4.  改为假

您现在可以关闭选项卡。通常，您现在可以使用此配置进行跨域请求。

有关更多详细信息，请参见[此处](http://kb.mozillazine.org/Security.fileuri.strict_origin_policy)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-05-06T11:11:03.117

您可以查看我的 Firefox 插件。它允许在最新的 firefox 版本中跨域：[https ://addons.mozilla.org/en-US/firefox/addon/cross-domain-cors/](https://addons.mozilla.org/en-US/firefox/addon/cross-domain-cors/)

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2016-03-29T12:33:23.490

手动编辑 Firefox 的设置是可行的方法，但是当您需要经常这样做时会很不方便。

相反，您可以安装一个插件，一键即可完成。

我使用`CORS everywhere`，这对我很有用。

这是[安装程序的链接](https://addons.mozilla.org/en-US/firefox/addon/cors-everywhere/)

# c# - 从 SharpSSH 使用 SCP 客户端时出错

> ID：667524
> 
> 赞同：0
> 
> 时间：2009-03-20T19:06:09.160
> 
> 标签：c#, ssh, sftp, scp

我正在使用 SharpSSH ( [http://sharpssh2.codeplex.com/](http://sharpssh2.codeplex.com/) ) 将文件从 windows 盒子( 使用 C# ) 发送到 linux 盒子。我使用 Sftp 类创建目录（mkdir 命令）和 Sftp.put 命令将文件传输到 Linux 机器。

当并发用户的数量大约为 30 或更多时，连接将被丢弃并且 mkdir 和 SFTP.put 命令将失败。

这与重新配置 sshd_config 参数（在 linux 机器上）以允许更多连接有关，还是我必须对正在调用 scp/sftp 以传输文件的 Windows 客户端进行一些调整？

还是我使用了不可靠的 SSH 客户端 (SharpSSH) 并且应该寻找替代解决方案？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T19:09:34.160

sshd_config 中有一个 MaxSessions 属性 - 你检查过它的值吗？

# asp.net - ASPX 链接到带有 IFRAME（内部 ASP 页面）的 ASPX...现在我想重定向回 ASPX

> ID：667532
> 
> 赞同：0
> 
> 时间：2009-03-20T19:08:49.810
> 
> 标签：asp.net, asp-classic

我有一个 ASPX 页面，该页面重定向到具有 IFRAME 的页面，该页面请求完全不同域上的 ASP 页面。一旦我完成了我需要在那里做的事情，我需要回到原来的 ASPX 页面。

有没有办法做到这一点？history.goback(-1) 不起作用，因为它只是刷新 IFRAME。有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T19:12:03.843

您可以将原始 URL 作为查询字符串参数传递给 ASP。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T19:13:55.023

我认为您可能需要考虑一些可以从 iFrame 中的页面运行的 Javascript，调用父窗口来更改它已加载的 URL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T19:17:05.827

您可能会考虑在包含 IFrame 的外部页面中包含引用标头的副本作为锚点的 HREF。单击此链接将返回到引用者。

这可能不适用于所有情况。浏览器可以配置为不提供引用。

# user-interface - 插入表格视图并添加按钮或空行时最好的是什么？

> ID：667539
> 
> 赞同：9
> 
> 时间：2009-03-20T19:11:03.207
> 
> 标签：user-interface

当呈现一个简单的表格视图（甚至我想是一个列表视图）时，您输入新数据的首选方法是什么。

使用这样的添加/删除按钮： ![带按钮](https://i575.photobucket.com/albums/ss192/darkadept/withAddDelete.jpg)

或者用一个空行表示这样的新记录： ![替代文字](https://i575.photobucket.com/albums/ss192/darkadept/blankLine.jpg)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-20T19:17:29.913

这个问题有点开放，但我个人更喜欢添加按钮，它对最终用户来说更加明确。

空白行可能看起来只是另一行数据，而不是添加内容的机会。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T19:53:59.250

像大多数 UI 问题一样，答案是“视情况而定”。根据什么？用户想要完成什么以及他们的心理模型是什么。

对我来说，如果该操作类似于“添加一行”，我想要一个按钮来执行此操作。另一方面，如果我的心理模型更像是“填写一行”，我认为空白行是有道理的。

例如，当我在 Quicken（它使用空白行概念）中添加事务时，我不会在想“我需要添加一行”。相反，我觉得我只是在概念上无限的资产负债表中填写下一个空白行。对电子表格也有同样的想法——想象一下，如果每次要添加行或列时都必须单击一个按钮，那么使用电子表格会有多难。

因此，与其寻找一刀切的解决方案，不如专注于您试图自动化的特定问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T11:53:27.057

对于多条记录的重复输入，空行稍微容易一些。用户完成一条记录后，用户只需再次切换到新创建的空白行并继续。无需伸手去拿鼠标。使用空行还可以使记录按照用户输入的顺序排列，便于随时检查自己的工作。如果您知道用户的任务是输入记录（例如，表格是空的），您可以将光标预先定位在空白行中，以节省用户查找并单击插入按钮的麻烦。

插入按钮更容易添加与其他任务混合的记录。用户在添加之前不必滚动到表格的末尾，这通常比点击按钮需要更长的时间，并且会使用户失去他/她在表格中的位置。对于已经填满记录的表，假设按钮始终在视图中（底部的空白被滚动出视图，用户可能不会考虑向下滚动并找到它），则插入按钮可能比空白行更容易被发现。

当然，您可以同时拥有一个插入按钮和一个空白行，或者尝试两全其美。例如，您可以使用“插入”按钮，但如果表为空，则可以使用为用户预先插入的空行打开它。从最后一行的最后一个字段跳动可能是为数据输入用户插入一行的“专家”方法。或者插入按钮可以有一个加速键（比如，可能是插入？），因此数据输入用户可以使用它来插入多条记录，而无需手指离开键盘。插入按钮可能还应该在当前记录下方插入一条新记录，以便新记录按照输入的顺序排列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T19:24:16.217

我同意**大篷车**。我认为第一种方法更明确和直观。

# python - 输入的完整命令行

> ID：667540
> 
> 赞同：36
> 
> 时间：2009-03-20T19:11:34.437
> 
> 标签：python, command-line

我想在输入时获得完整的命令行。

这个：

`" ".join(sys.argv[:])`

在这里不起作用（删除双引号）。此外，我不希望重新加入已解析和拆分的内容。

有任何想法吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-20T19:16:07.797

你太迟了。当键入的命令到达 Python 时，你的 shell 已经发挥了它的魔力。例如，引号被消耗（正如你所注意到的），变量被插值等等。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-20T19:15:42.523

在 Unix 环境中，这通常是不可能的……你能希望的最好的就是传递给你的进程的命令行。

因为外壳程序（基本上是*任何*外壳程序）可能会在将键入的命令行交给操作系统执行之前以多种方式处理键入的命令行。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-20T20:04:36.743

## *尼克斯

查看[提供对命令行和程序环境的访问的初始堆栈布局（Linux on i386）](http://asm.sourceforge.net/articles/startup.html#st)：进程只看到单独的参数。

您无法获取命令行，因为它是在一般情况下*键入的。*在 Unix 上，shell 将命令行解析为单独的参数，并最终[`execv(path, argv)`调用调用相应系统调用的函数](http://pubs.opengroup.org/onlinepubs/9699919799/functions/exec.html)。`sys.argv`派生`argv`自传递给`execve()`函数的参数。`" ".join(map(pipes.quote, argv))`尽管您不需要，但您可以获得等效的东西，例如，如果您想使用稍微不同的命令行参数重新启动脚本，那么`sys.argv`就足够了（[在许多情况下](http://bugs.python.org/issue29857)），请参阅[Is it possible to set the python -O (optimize ) 脚本中的标志？](https://stackoverflow.com/a/7527983/4279)

有一些创造性（非实用）的解决方案：

*   使用 gdb 附加 shell 并询问它（大多数 shell 能够重复相同的命令两次）——你应该能够得到几乎与输入相同的命令——或者如果它在进程退出之前被更新，则直接读取它的历史文件
*   使用屏幕、脚本实用程序来获取终端会话
*   使用键盘记录器来获取输入的内容。

## 视窗

在 Windows 上，本机`CreateProcess()`接口是一个字符串，但 python.exe 仍然接收作为列表的参数。`subprocess.list2cmdline(sys.argv)`可能有助于扭转这一过程。 `list2cmdline`专为使用[与 MS C 运行时相同规则的](http://www.daviddeley.com/autohotkey/parameters/parameters.htm#WINCRULESCHANGE)应用程序而设计——<code>python.exe 就是其中之一。`list2cmdline`不会返回*键入的命令行，*但在这种情况下会返回等效的功能。

在 Python 2 上，您可能需要[`GetCommandLineW()`](https://stackoverflow.com/a/846931/4279), 从命令行获取无法在 Windows ANSI 代码页中表示的 Unicode 字符（例如 cp1252）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-20T20:40:46.267

如前所述，这可能无法做到，至少不可靠。在少数情况下，您可能能够找到 shell 的历史文件（例如 - “bash”，但不是“tcsh”）并从中获取用户的输入信息。我不知道您对用户环境的控制程度（如果有的话）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-21T01:09:36.447

在 Linux 上`/proc/<pid>/cmdline`，它的格式为`argv[]`(即所有行之间有 0x00，并且您无法真正知道有多少字符串，因为您没有得到 argc；尽管当文件用完时您会知道数据的 ;）。

您可以确定该命令行也已经被修改了，因为所有转义/变量填充都已完成并且参数被很好地打包（参数之间没有额外的空格等）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-20T21:10:35.167

If you're on Linux, I'd suggest monkeying with the `~/.bash_history` file or the shell `history` command, although I believe the command must finish executing before it's added to the shell history.

I started playing with:

```
import popen2
x,y = popen2.popen4("tail ~/.bash_history")
print x.readlines() 
```

But I'm getting weird behavior where the shell doesn't seem to be completely flushing to the `.bash_history` file.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-05-11T04:12:15.327

以下是如何从 Python 程序中获取完整的命令字符串的方法。由于命令行参数在发送到 之前已经处理过一次，因此`sys.argv`您可以通过这种方式重建该字符串。

```
commandstring = '';

for arg in sys.argv:
    if ' ' in arg:
        commandstring += '"{}"  '.format(arg);
    else:
        commandstring+="{}  ".format(arg);

print(commandstring); 
```

例子：

从终端像这样调用，

```
./saferm.py sdkf lsadkf -r sdf -f sdf -fs -s "flksjfksdkfj sdfsdaflkasdf" 
```

将在命令字符串中给出相同的字符串：

```
./saferm.py sdkf lsadkf -r sdf -f sdf -fs -s "flksjfksdkfj sdfsdaflkasdf" 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-12-16T05:34:21.113

我只是迟到了 10.5 年，但是......这就是我在 Linux 下处理与 OP 完全相同的问题的方式（正如其他人所说，在 Windows 中可能可以从系统中检索信息） .

首先，请注意我使用`argparse`模块来解析传递的参数。此外，然后假定参数以`--parname=2`、或的形式传递。`--parname="text"``-p2``-p"text"`

```
call = ""
for arg in sys.argv:
    if arg[:2] == "--": #case1: longer parameter with value assignment
        before = arg[:arg.find("=")+1]
        after = arg[arg.find("=")+1:]
        parAssignment = True
    elif arg[0] == "-": #case2: shorter parameter with value assignment
        before = arg[:2]
        after = arg[2:]
        parAssignment = True
    else: #case3: #parameter with no value assignment
        parAssignment = False
    if parAssignment:
        try: #check if assigned value is "numeric"
            complex(after) # works for int, long, float and complex
            call += arg + " "
        except ValueError:
            call += before + '"' + after + '" '
    else:
        call += arg + " " 
```

它可能无法完全涵盖所有极端情况，但它对我很有帮助（它甚至可以检测到`1e-06`不需要引号的数字）。

在上面，为了检查传递给参数的值是否是“数字”，我从[这个非常聪明的答案](https://stackoverflow.com/a/3335060/12358222)中窃取。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-12-29T02:22:36.470

我需要使用多行参数和看起来像选项但实际上不是的值来重播一个复杂的命令行。

结合[2009 年](https://stackoverflow.com/a/667754/9201239)的答案和各种评论，这是一个在 unix 上运行良好的现代 python 3 版本。

```
import sys
import shlex
print(sys.executable, " ".join(map(shlex.quote, sys.argv))) 
```

让我们测试一下：

```
$ cat << EOT > test.py
import sys
import shlex
print(sys.executable, " ".join(map(shlex.quote, sys.argv)))
EOT 
```

然后：

```
$ python test.py --foo 1 --bar " aha " --tar 'multi \
line arg' --nar '--prefix1 --prefix2' 
```

印刷：

```
/usr/bin/python test.py --foo 1 --bar ' aha ' --tar 'multi \
line arg' --nar '--prefix1 --prefix2' 
```

请注意，它被`'--prefix1 --prefix2'`正确引用了，多行参数也被引用了！

唯一的区别是完整的 python 路径。

这就是我所需要的。

感谢您提出使这项工作发挥作用的想法。

* * *

更新：这里是一个更高级的版本，它可以重放所需的环境变量，并用 bash 换行符很好地包装长输出，以便输出可以立即粘贴到论坛中，而无需手动处理分解长行以避免水平滚动。

```
import os
import shlex
import sys
def get_orig_cmd(max_width=80, full_python_path=False):
    """
    Return the original command line string that can be replayed 
    nicely and wrapped for 80 char width
    Args:
        - max_width: the width to wrap for. defaults to 80
        - full_python_path: whether to replicate the full path 
          or just the last part (i.e. `python`). default to `False`
    """

    cmd = []

    # deal with critical env vars
    env_keys = ["CUDA_VISIBLE_DEVICES"]
    for key in env_keys:
        val = os.environ.get(key, None)
        if val is not None:
            cmd.append(f"{key}={val}")

    # python executable (not always needed if the script is executable)
    python = sys.executable if full_python_path else sys.executable.split("/")[-1]
    cmd.append(python)

    # now the normal args
    cmd += list(map(shlex.quote, sys.argv))

    # split up into up to MAX_WIDTH lines with shell multi-line escapes
    lines = []
    current_line = ""
    while len(cmd) > 0:
        current_line += f"{cmd.pop(0)} "
        if len(cmd) == 0 or len(current_line) + len(cmd[0]) + 1 > max_width - 1:
            lines.append(current_line)
            current_line = ""
    return "\\\n".join(lines)

print(get_orig_cmd()) 
```

这是此函数生成的示例：

```
CUDA_VISIBLE_DEVICES=0 python ./scripts/benchmark/trainer-benchmark.py \
--base-cmd \
' examples/pytorch/translation/run_translation.py --model_name_or_path t5-small \
--output_dir output_dir --do_train --label_smoothing 0.1 --logging_strategy no \
--save_strategy no --per_device_train_batch_size 32 --max_source_length 512 \
--max_target_length 512 --num_train_epochs 1 --overwrite_output_dir \
--source_lang en --target_lang ro --dataset_name wmt16 --dataset_config "ro-en" \
--source_prefix "translate English to Romanian: " --warmup_steps 50 \
--max_train_samples 2001 --dataloader_num_workers 2 ' \
--target-metric-key train_samples_per_second --repeat-times 1 --variations \
'|--fp16|--bf16' '|--tf32' --report-metric-keys 'train_loss train_samples' \
--table-format console --repeat-times 2 --base-variation '' 
```

请注意，它非常复杂，因为一个参数有多个参数作为其值，而且它也是多行的。

另请注意，此特定版本不会重新包装单个参数 - 如果任何参数长于请求的宽度，它们将保持未包装（按设计）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-05-11T13:52:02.003

您可以使用`psutil`它提供**跨平台**解决方案：

```
import psutil
import os
my_process = psutil.Process( os.getpid() )
print( my_process.cmdline() ) 
```

如果这不是您想要的，您可以进一步获取父程序的命令行：

```
my_parent_process = psutil.Process( my_process.ppid() )
print( my_parent_process.cmdline() ) 
```

变量仍将被拆分为其组件，但与`sys.argv`解释器不同的是，它们不会被修改。

# c# - Resharper 和 C# Catch 子句

> ID：667541
> 
> 赞同：2
> 
> 时间：2009-03-20T19:11:39.663
> 
> 标签：c#, .net, resharper, try-catch

我是 Resharper 的新手，我试图理解为什么它似乎暗示：
`catch (Exception) { }`
`for`
`catch { }`

和

`catch { }`
`for`
`catch (Exception) { }`

我很困惑。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-20T19:16:48.997

基本上，它为您提供了一种在两种选择之间切换的方式，而不是提出哪个更好的具体建议。

您可以更改 ReSharper / 选项 / 代码检查 / 检查严重性下提供的内容 - 找到相关选项并更改无、提示、建议、警告或错误之间的优先级。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-20T19:53:06.320

Resharper 确实有另一条信息更像是一个建议：它建议你不要去`Exception`上课。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-23T12:50:47.127

`catch { }` <-- 抑制所有错误。我们应该这样做，只有当我们确定丢弃任何错误时。

`catch { throw; }` <-- 这不是必需的。编译器已经注意将错误重新抛出给调用函数。不需要显式添加。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T19:16:45.347

它只是为您提供了可供考虑的替代方案，这可能会激发您对改进代码的一些见解。如果没有意义，请忽略该建议。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-03-20T19:16:50.027

因为有时在整理 catch 块时，您会移动到/从`catch(Exception ex)`到`catch(Exception)`到`catch`，反之亦然，这取决于您是尝试纯粹过滤、记录/包装还是吞下异常。（看到[我为 CodeRush 请求相同的功能，却不知道它甚至存在于 R# 中](http://www.devexpress.com/Support/Center/p/S131074.aspx)）

[IIRC 从它们生成的代码/它们过滤和遗漏的东西的角度来看，两者之间也可能存在差异](http://blogs.msdn.com/clrteam/archive/2009/02/19/why-catch-exception-empty-catch-is-bad.aspx)

编辑：该链接以前被标记为“空捕获是坏的”，因此非常正确的反对票！

# sharepoint - 项目级权限（仅编辑他们自己的，但请阅读所有人）

> ID：667548
> 
> 赞同：3
> 
> 时间：2009-03-20T19:12:49.253
> 
> 标签：sharepoint, moss, sharepoint-2007

我有一个设置了项目级权限的列表。我将其设置为允许用户阅读所有项目并且只编辑他们自己的项目......

问题是，如果我这样做，那么我仍然可以编辑所有项目......

如果我将其更改为只能阅读自己的内容并且只能编辑自己的内容，那么它将按预期工作...

任何人都对为什么会发生这种情况以及解决方案有任何想法...

我已将列表设置为仅允许一个具有贡献权限的用户帐户用于测试目的...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T18:03:26.260

当您更改列表高级设置中的权限时，它仍然允许贡献者转到 EditForm 但是一旦贡献者尝试保存不属于他们的项目，它会显示您没有权限的错误消息。

试一试，由某个用户创建一个项目，比如说 User1，然后尝试使用 User2 凭据修改该项目（用户必须在站点/列表上只有贡献者权限），它会让你转到 EditForm，但不会让你保存物品。

我希望它对你有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T19:40:45.427

您是列表管理员（例如，网站所有者）吗？列表管理员有额外的权限。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T20:32:11.067

仅当您的用户无权根据站点权限编辑列表中的所有项目时，这才有效。例如，如果您的用户对站点具有贡献权限，这将覆盖单个项目的权限。

# javascript - 如何在 JavaScript 中检测空闲时间

> ID：667555
> 
> 赞同：547
> 
> 时间：2009-03-20T19:15:50.370
> 
> 标签：javascript

是否可以在 JavaScript中检测“**空闲”时间？**

我的主要用例可能是预取或预加载内容。

我将空闲时间定义*为用户不活动或没有任何 CPU 使用的时间段*

* * *

## 回答 #1

> 赞同：477
> 
> 时间：2010-10-27T02:17:44.030

这是一个使用 jQuery 处理 mousemove 和 keypress 事件的简单脚本。如果时间到期，页面将重新加载。

```
<script type="text/javascript">
    var idleTime = 0;
    $(document).ready(function () {
        // Increment the idle time counter every minute.
        var idleInterval = setInterval(timerIncrement, 60000); // 1 minute

        // Zero the idle timer on mouse movement.
        $(this).mousemove(function (e) {
            idleTime = 0;
        });
        $(this).keypress(function (e) {
            idleTime = 0;
        });
    });

    function timerIncrement() {
        idleTime = idleTime + 1;
        if (idleTime > 19) { // 20 minutes
            window.location.reload();
        }
    }
</script> 
```

* * *

## 回答 #2

> 赞同：451
> 
> 时间：2012-04-12T14:47:35.163

不使用 jQuery，只有 vanilla JavaScript：

```
var inactivityTime = function () {
    var time;
    window.onload = resetTimer;
    // DOM Events
    document.onmousemove = resetTimer;
    document.onkeydown = resetTimer;

    function logout() {
        alert("You are now logged out.")
        //location.href = 'logout.html'
    }

    function resetTimer() {
        clearTimeout(time);
        time = setTimeout(logout, 3000)
        // 1000 milliseconds = 1 second
    }
}; 
```

并在需要的地方初始化函数（例如：onPageLoad）。

```
window.onload = function() {
  inactivityTime();
} 
```

如果需要，您可以添加更多 DOM 事件。最常用的是：

```
document.onload = resetTimer;
document.onmousemove = resetTimer;
document.onmousedown = resetTimer; // touchscreen presses
document.ontouchstart = resetTimer;
document.onclick = resetTimer;     // touchpad clicks
document.onkeydown = resetTimer;   // onkeypress is deprectaed
document.addEventListener('scroll', resetTimer, true); // improved; see comments 
```

或使用数组注册所需的事件

```
window.addEventListener('load', resetTimer, true);
var events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
events.forEach(function(name) {
 document.addEventListener(name, resetTimer, true);
}); 
```

**DOM 事件**列表：[http ://www.w3schools.com/jsref/dom_obj_event.asp](http://www.w3schools.com/jsref/dom_obj_event.asp)

记得使用`window`，或`document`根据您的需要。在这里您可以看到它们之间的区别：*[JavaScript 中的窗口、屏幕和文档有什么区别？](https://stackoverflow.com/questions/9895202/what-is-the-difference-between-window-screen-and-document-in-javascript)*

**使用@frank-conijn 和@daxchen**更新的代码**`window.onscroll`改进：如果滚动在可滚动元素内，则不会触发，因为滚动事件不会冒泡。在`window.addEventListener('scroll', resetTimer, true)`中，第三个参数告诉侦听器在捕获阶段而不是冒泡阶段捕获事件。**

 *** * *

## 回答 #3

> 赞同：107
> 
> 时间：2014-07-28T06:59:41.933

改进[Equiman 的（原始）答案](https://stackoverflow.com/questions/667555/how-to-detect-idle-time-in-javascript-elegantly/10126042#10126042)：

```
function idleLogout() {
    var t;
    window.onload = resetTimer;
    window.onmousemove = resetTimer;
    window.onmousedown = resetTimer;  // catches touchscreen presses as well      
    window.ontouchstart = resetTimer; // catches touchscreen swipes as well      
    window.ontouchmove = resetTimer;  // required by some devices 
    window.onclick = resetTimer;      // catches touchpad clicks as well
    window.onkeydown = resetTimer;   
    window.addEventListener('scroll', resetTimer, true); // improved; see comments

    function yourFunction() {
        // your function for too long inactivity goes here
        // e.g. window.location.href = 'logout.php';
    }

    function resetTimer() {
        clearTimeout(t);
        t = setTimeout(yourFunction, 10000);  // time is in milliseconds
    }
}
idleLogout(); 
```

除了关于活动检测的改进以及从`document`to的更改之外`window`，此脚本实际上调用了该函数，而不是让它闲置。

它不会直接捕获零 CPU 使用率，但这是不可能的，因为执行函数会导致 CPU 使用率。并且用户不活动最终导致 CPU 使用率为零，因此它间接地捕获了零 CPU 使用率。

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2013-04-25T19:05:30.490

我创建了一个小型库来执行此操作：

[https://github.com/shawnmclean/Idle.js](https://github.com/shawnmclean/Idle.js)

描述：

> 用于报告用户在浏览器中的活动的小型 JavaScript 库（离开、空闲、不看网页、在不同的选项卡中等）。它独立于任何其他 JavaScript 库，例如 jQuery。

Visual Studio 用户可以通过以下方式从 NuGet 获取它：

```
Install-Package Idle.js 
```

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2009-03-20T19:46:34.900

这是[tvanfosson 的想法](https://stackoverflow.com/questions/667555/how-to-detect-idle-time-in-javascript-elegantly/667580#667580)的一个粗略的 jQuery 实现：

```
$(document).ready(function(){

   idleTime = 0;

   //Increment the idle time counter every second.
   var idleInterval = setInterval(timerIncrement, 1000);

   function timerIncrement()
   {
     idleTime++;
     if (idleTime > 2)
     {
       doPreload();
     }
   }

   //Zero the idle timer on mouse movement.
   $(this).mousemove(function(e){
      idleTime = 0;
   });

   function doPreload()
   {
     //Preload images, etc.
   }

}) 
```

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2009-03-20T21:10:53.993

Similar to [Peter J's solution](https://stackoverflow.com/questions/667555/how-to-detect-idle-time-in-javascript-elegantly/667688#667688) (with a jQuery custom event)...

```
// Use the jquery-idle-detect.js script below
$(window).on('idle:start', function() {
  // Start your prefetch, etc. here...
});

$(window).on('idle:stop', function() {
  // Stop your prefetch, etc. here...
}); 
```

* * *

### File *jquery-idle-detect.js*

```
(function($, $w) {
  // Expose configuration option
  // Idle is triggered when no events for 2 seconds
  $.idleTimeout = 2000;

  // Currently in idle state
  var idle = false;

  // Handle to idle timer for detection
  var idleTimer = null;

  // Start the idle timer and bind events on load (not DOM-ready)
  $w.on('load', function() {
    startIdleTimer();
    $w.on('focus resize mousemove keyup', startIdleTimer)
      .on('blur', idleStart) // Force idle when in a different tab/window
      ;
  ]);

  function startIdleTimer() {
    clearTimeout(idleTimer); // Clear prior timer

    if (idle) $w.trigger('idle:stop'); // If idle, send stop event
    idle = false; // Not idle

    var timeout = ~~$.idleTimeout; // Option to integer
    if (timeout <= 100)
      timeout = 100; // Minimum 100 ms
    if (timeout > 300000)
      timeout = 300000; // Maximum 5 minutes

    idleTimer = setTimeout(idleStart, timeout); // New timer
  }

  function idleStart() {
    if (!idle)
      $w.trigger('idle:start');
    idle = true;
  }

}(window.jQuery, window.jQuery(window))) 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2014-06-25T22:07:43.020

[您可以使用Underscore.js](http://underscorejs.org/#debounce)和[jQuery](http://api.jquery.com/on/)更优雅地做到这一点：

```
$('body').on("click mousemove keyup", _.debounce(function(){
    // do preload here
}, 1200000)) // 20 minutes debounce 
```

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2015-07-31T17:24:24.820

所有先前的答案都有一个始终处于活动状态的 mousemove 处理程序。如果处理程序是 jQuery，则 jQuery 执行的附加处理可以累加。特别是如果用户使用游戏鼠标，每秒可能会发生多达 500 个事件。

此解决方案避免处理每个 mousemove 事件。这会导致一个小的计时误差，但您可以根据需要进行调整。

```
function setIdleTimeout(millis, onIdle, onUnidle) {
    var timeout = 0;
    startTimer();

    function startTimer() {
        timeout = setTimeout(onExpires, millis);
        document.addEventListener("mousemove", onActivity);
        document.addEventListener("keydown", onActivity);
    }

    function onExpires() {
        timeout = 0;
        onIdle();
    }

    function onActivity() {
        if (timeout) clearTimeout(timeout);
        else onUnidle();
        //since the mouse is moving, we turn off our event hooks for 1 second
        document.removeEventListener("mousemove", onActivity);
        document.removeEventListener("keydown", onActivity);
        setTimeout(startTimer, 1000);
    }
} 
```

[http://jsfiddle.net/jndxq51o/](http://jsfiddle.net/jndxq51o/)

* * *

## 回答 #9

> 赞同：19
> 
> 时间：2015-12-29T18:21:13.060

我的回答受到[vijay 的回答的](https://stackoverflow.com/a/32138859/2840103)启发，但它是一个更短、更通用的解决方案，我认为我会分享给任何可能有帮助的人。

```
(function () { 
    var minutes = true; // change to false if you'd rather use seconds
    var interval = minutes ? 60000 : 1000; 
    var IDLE_TIMEOUT = 3; // 3 minutes in this example
    var idleCounter = 0;

    document.onmousemove = document.onkeypress = function () {
        idleCounter = 0;
    };

    window.setInterval(function () {
        if (++idleCounter >= IDLE_TIMEOUT) {
            window.location.reload(); // or whatever you want to do
        }
    }, interval);
}()); 
```

按照目前的情况，此代码将立即执行，并在 3 分钟没有鼠标移动或按键后重新加载您的当前页面。

这使用了普通的 JavaScript 和[立即调用的函数表达式](https://stackoverflow.com/q/14317998/2840103)，以干净且独立的方式处理空闲超时。

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2016-03-02T05:28:12.867

我有同样的问题，我找到了一个很好的解决方案。

我使用*[了 jquery.idle](https://github.com/kidh0/jquery.idle)*，我只需要这样做：

```
$(document).idle({
  onIdle: function(){
    alert('You did nothing for 5 seconds');
  },
  idle: 5000
}) 
```

请参阅[JsFiddle 演示](https://jsfiddle.net/ddan/f238hchm/1/)。

（仅供参考：[后端事件跟踪 Leads browserload 见此](https://jsfiddle.net/f238hchm/42/)）

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2009-03-20T19:20:37.833

您可以通过检测表单主体上的鼠标移动并使用上次移动时间更新全局变量来将某些东西组合在一起。然后，您需要运行一个间隔计时器，它会定期检查最后一次移动时间，并在检测到最后一次鼠标移动后已经足够长的时间做一些事情。

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2015-10-20T23:13:55.400

如果您的目标是[受支持的浏览器](https://caniuse.com/#feat=requestidlecallback)（截至 2018 年 12 月的 Chrome 或 Firefox），您可以试验[requestIdleCallback](https://developers.google.com/web/updates/2015/08/using-requestidlecallback?hl=en)并为不受支持的浏览器包含[requestIdleCallback shim 。](https://gist.github.com/paullewis/55efe5d6f05434a96c36)

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2018-07-09T22:07:01.573

我写了一个小的[ES6](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_%E2%80%93_ECMAScript_2015)类来检测活动并在空闲超时时触发事件。它涵盖了**键盘、鼠标和触摸**，可以**激活和停用**，并且具有非常精简的 API：

```
const timer = new IdleTimer(() => alert('idle for 1 minute'), 1000 * 60 * 1);
timer.activate(); 
```

它不**依赖**于 jQuery，尽管您可能需要通过 Babel 运行它以支持旧版浏览器。

[https://gist.github.com/4547ef5718fd2d31e5cdcafef0208096](https://gist.github.com/4547ef5718fd2d31e5cdcafef0208096)

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2018-07-02T22:21:19.410

*（部分受到[Equiman 回答](https://stackoverflow.com/questions/667555/how-to-detect-idle-time-in-javascript-elegantly/10126042#10126042)的良好核心逻辑的启发。）*

## sessionExpiration.js

* * *

[sessionExpiration.js](https://github.com/Fomtriok/sessionExpiration.js)是轻量级但有效且可定制的。实施后，**仅在一行中使用：**

```
sessionExpiration(idleMinutes, warningMinutes, logoutUrl); 
```

*   **影响**浏览器的所有选项卡，而不仅仅是一个。
*   用**纯 JavaScript 编写**，没有依赖关系。完全客户端。
*   *（如果需要。）*具有**警告横幅**和**倒计时**时钟，可通过用户交互取消。
*   只需包含**sessionExpiration.js**并调用该函数，并使用参数**[1]**空闲分钟数（跨所有选项卡）直到用户注销，**[2]**空闲分钟数直到显示警告和倒计时，以及**[3]**注销网址。
*   将 CSS 放入样式表中。如果您愿意，可以自定义它。*（或者如果您不想要它，请跳过并删除横幅。）*
*   但是，如果您*确实*想要警告横幅，那么您必须在页面上放置一个 ID*为 sessExpirDiv的空 div* *（建议将其放在页脚中）*。
*   现在，如果所有选项卡在给定的持续时间内都处于非活动状态，则用户将自动注销。
*   *可选：您可以向该函数提供第四个参数（URL serverRefresh），以便在您与页面交互时也刷新服务器端会话计时器。*

* * *

如果您不更改 CSS，这是一个实际效果的示例。

[![演示图像](https://i.stack.imgur.com/z0d2n.png)](https://i.stack.imgur.com/z0d2n.png)

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2015-08-21T11:12:44.590

试试这个代码。它完美地工作。

```
var IDLE_TIMEOUT = 10; //seconds
var _idleSecondsCounter = 0;

document.onclick = function () {
    _idleSecondsCounter = 0;
};

document.onmousemove = function () {
    _idleSecondsCounter = 0;
};

document.onkeypress = function () {
    _idleSecondsCounter = 0;
};

window.setInterval(CheckIdleTime, 1000);

function CheckIdleTime() {
    _idleSecondsCounter++;
    var oPanel = document.getElementById("SecondsUntilExpire");
    if (oPanel)
        oPanel.innerHTML = (IDLE_TIMEOUT - _idleSecondsCounter) + "";
    if (_idleSecondsCounter >= IDLE_TIMEOUT) {
        alert("Time expired!");
        document.location.href = "SessionExpired.aspx";
    }
} 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2015-04-21T09:16:52.120

```
<script type="text/javascript">
    var idleTime = 0;
    $(document).ready(function () {
        //Increment the idle time counter every minute.
        idleInterval = setInterval(timerIncrement, 60000); // 1 minute

        //Zero the idle timer on mouse movement.
        $('body').mousemove(function (e) {
            //alert("mouse moved" + idleTime);
            idleTime = 0;
        });

        $('body').keypress(function (e) {
            //alert("keypressed"  + idleTime);
            idleTime = 0;
        });

        $('body').click(function() {
            //alert("mouse moved" + idleTime);
            idleTime = 0;
        });
    });

    function timerIncrement() {
        idleTime = idleTime + 1;
        if (idleTime > 10) { // 10 minutes

            window.location.assign("http://www.google.com");
        }
    }
</script> 
```

我认为这个 jQuery 代码是完美的，虽然是从上面的答案复制和修改的！！

不要忘记在文件中包含 jQuery 库！

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2016-09-30T17:41:34.393

具有正确设置的重置时间和绑定的纯 JavaScript `addEventListener`：

```
(function() {

  var t,
    timeout = 5000;

  function resetTimer() {
    console.log("reset: " + new Date().toLocaleString());
    if (t) {
      window.clearTimeout(t);
    }
    t = window.setTimeout(logout, timeout);
  }

  function logout() {
    console.log("done: " + new Date().toLocaleString());
  }
  resetTimer();

  //And bind the events to call `resetTimer()`
  ["click", "mousemove", "keypress"].forEach(function(name) {
    console.log(name);
    document.addEventListener(name, resetTimer);
  });

}()); 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2014-10-04T15:13:26.297

所有这些解决方案的问题虽然是正确的，但在考虑到会话超时有价值的设置、使用 PHP、.NET 或在[ColdFusion](https://en.wikipedia.org/wiki/Adobe_ColdFusion)开发人员的 Application.cfc 文件中时，它们是不切实际的。

上述方案设置的时间需要与服务器端会话超时时间同步。如果两者不同步，您可能会遇到只会让用户感到沮丧和困惑的问题。

例如，服务器端会话超时可能设置为 60 分钟，但用户可能认为他/她是安全的，因为 JavaScript 空闲时间捕获增加了用户可以在单个页面上花费的总时间。用户可能已经花时间填写了一个长表单，然后去提交它。会话超时可能会在处理表单提交之前启动。

我倾向于只给我的用户 180 分钟，然后使用 JavaScript 自动注销用户。本质上，使用上面的一些代码来创建一个简单的计时器，但没有捕获鼠标事件部分。

通过这种方式，我的客户端和服务器端时间完美同步。如果您在 UI 中向用户显示时间，则不会造成混淆，因为它会减少。每次在 CMS 中访问新页面时，都会重置服务器端会话和 JavaScript 计时器。简单而优雅。如果用户在一个页面上停留超过 180 分钟，我首先认为该页面有问题。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2015-08-03T09:37:02.737

我编写了一个简单的 jQuery 插件，它可以满足您的需求。

[https://github.com/afklondon/jquery.inactivity](https://github.com/afklondon/jquery.inactivity)

```
$(document).inactivity( {
    interval: 1000, // the timeout until the inactivity event fire [default: 3000]
    mouse: true, // listen for mouse inactivity [default: true]
    keyboard: false, // listen for keyboard inactivity [default: true]
    touch: false, // listen for touch inactivity [default: true]
    customEvents: "customEventName", // listen for custom events [default: ""]
    triggerAll: true, // if set to false only the first "activity" event will be fired [default: false]
}); 
```

该脚本将侦听鼠标、键盘、触摸和其他自定义事件不活动（空闲）并触发全局“活动”和“不活动”事件。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2016-09-27T13:10:09.187

您可以使用下面提到的解决方案

```
var idleTime;
$(document).ready(function () {
         reloadPage();
        $('html').bind('mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick', function () {
            clearTimeout(idleTime);
            reloadPage();
        });
});
function reloadPage() {
    clearTimeout(idleTime);
    idleTime = setTimeout(function () {
        location.reload();
    }, 3000);
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2009-03-20T19:20:37.537

是否可以每 10 秒运行一次函数，并检查“计数器”变量？如果可能的话，您可以在页面上设置鼠标悬停，不是吗？

如果是这样，请使用鼠标悬停事件来重置“计数器”变量。如果您的函数被调用，并且计数器高于您预先确定的范围，则执行您的操作。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2014-01-03T11:38:39.773

我已经测试了这个代码工作文件：

```
var timeout = null;
    var timee = '4000'; // default time for session time out.
    $(document).bind('click keyup mousemove', function(event) {

    if (timeout !== null) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(function() {
              timeout = null;
            console.log('Document Idle since '+timee+' ms');
            alert("idle window");
        }, timee);
    }); 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2015-02-16T21:54:23.293

这是我找到的最佳解决方案：

*[用户空闲时触发事件](http://css-tricks.com/snippets/jquery/fire-event-when-user-is-idle/)*

这是JavaScript：

```
idleTimer = null;
idleState = false;
idleWait = 2000;

(function ($) {

    $(document).ready(function () {

        $('*').bind('mousemove keydown scroll', function () {

            clearTimeout(idleTimer);

            if (idleState == true) {

                // Reactivated event
                $("body").append("<p>Welcome Back.</p>");
            }

            idleState = false;

            idleTimer = setTimeout(function () {

                // Idle Event
                $("body").append("<p>You've been idle for " + idleWait/1000 + " seconds.</p>");

                idleState = true; }, idleWait);
        });

        $("body").trigger("mousemove");

    });
}) (jQuery) 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2016-12-02T16:08:39.380

我使用这种方法，因为您不需要不断地重置事件触发的时间。相反，我们只记录时间，这会生成空闲起点。

```
function idle(WAIT_FOR_MINS, cb_isIdle) {
    var self = this,
        idle,
        ms = (WAIT_FOR_MINS || 1) * 60000,
        lastDigest = new Date(),
        watch;
    //document.onmousemove = digest;
    document.onkeypress = digest;
    document.onclick = digest;

    function digest() {
       lastDigest = new Date();
    }

    // 1000 milisec = 1 sec
    watch = setInterval(function() {
        if (new Date() - lastDigest > ms && cb_isIdel) {
            clearInterval(watch);
            cb_isIdle();
        }

    }, 1000*60);
}, 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2020-07-11T10:08:39.117

根据[equiman 提供](https://stackoverflow.com/questions/667555/how-to-detect-idle-time-in-javascript-elegantly/10126042#10126042)的输入：

```
class _Scheduler {
    timeoutIDs;

    constructor() {
        this.timeoutIDs = new Map();
    }

    addCallback = (callback, timeLapseMS, autoRemove) => {
        if (!this.timeoutIDs.has(timeLapseMS + callback)) {
            let timeoutID = setTimeout(callback, timeLapseMS);
            this.timeoutIDs.set(timeLapseMS + callback, timeoutID);
        }

        if (autoRemove !== false) {
            setTimeout(
                this.removeIdleTimeCallback, // Remove
                10000 + timeLapseMS, // 10 secs after
                callback, // the callback
                timeLapseMS, // is invoked.
            );
        }
    };

    removeCallback = (callback, timeLapseMS) => {
        let timeoutID = this.timeoutIDs.get(timeLapseMS + callback);
        if (timeoutID) {
            clearTimeout(timeoutID);
            this.timeoutIDs.delete(timeLapseMS + callback);
        }
    };
}

class _IdleTimeScheduler extends _Scheduler {
    events = [
        'load',
        'mousedown',
        'mousemove',
        'keydown',
        'keyup',
        'input',
        'scroll',
        'touchstart',
        'touchend',
        'touchcancel',
        'touchmove',
    ];
    callbacks;

    constructor() {
        super();
        this.events.forEach(name => {
            document.addEventListener(name, this.resetTimer, true);
        });

        this.callbacks = new Map();
    }

    addIdleTimeCallback = (callback, timeLapseMS) => {
        this.addCallback(callback, timeLapseMS, false);

        let callbacksArr = this.callbacks.get(timeLapseMS);
        if (!callbacksArr) {
            this.callbacks.set(timeLapseMS, [callback]);
        } else {
            if (!callbacksArr.includes(callback)) {
                callbacksArr.push(callback);
            }
        }
    };

    removeIdleTimeCallback = (callback, timeLapseMS) => {
        this.removeCallback(callback, timeLapseMS);

        let callbacksArr = this.callbacks.get(timeLapseMS);
        if (callbacksArr) {
            let index = callbacksArr.indexOf(callback);
            if (index !== -1) {
                callbacksArr.splice(index, 1);
            }
        }
    };

    resetTimer = () => {
        for (let [timeLapseMS, callbacksArr] of this.callbacks) {
            callbacksArr.forEach(callback => {
                // Clear the previous IDs
                let timeoutID = this.timeoutIDs.get(timeLapseMS + callback);
                clearTimeout(timeoutID);

                // Create new timeout IDs.
                timeoutID = setTimeout(callback, timeLapseMS);
                this.timeoutIDs.set(timeLapseMS + callback, timeoutID);
            });
        }
    };
}
export const Scheduler = new _Scheduler();
export const IdleTimeScheduler = new _IdleTimeScheduler(); 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2019-01-07T22:59:45.673

尽可能简单地检测鼠标何时移动：

```
var idle = false;

document.querySelector('body').addEventListener('mousemove', function(e) {
    if(idle!=false)
        idle = false;
});

var idleI = setInterval(function()
{
    if(idle == 'inactive')
    {
        return;
    }

    if(idle == true)
    {
        idleFunction();
        idle = 'inactive';
        return;
    }

    idle = true;
}, 30000); // half the expected time. Idle will trigger after 60 s in this case.

function idleFuntion()
{
   console.log('user is idle');
} 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-03-20T19:47:41.933

您可能会使用列出的 mousemove 技巧检测网页上的不活动状态，但这不会告诉您用户不在另一个窗口或选项卡的另一个页面上，或者用户在[Word](https://en.wikipedia.org/wiki/Microsoft_Word)或[Photoshop](https://en.wikipedia.org/wiki/Adobe_Photoshop)或[WoW](https://en.wikipedia.org/wiki/World_of_Warcraft)中只是此时没有查看您的页面。

一般来说，我只是做预取并依赖客户端的多任务处理。如果你*真的*需要这个功能，你可以在 Windows 中使用[ActiveX](https://en.wikipedia.org/wiki/ActiveX)控件，但它充其量是丑陋的。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2020-06-16T08:10:25.167

当然，您想了解[window.requestIdleCallback()](https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback)，它将在浏览器空闲期间调用的函数排队。

[您可以在Quicklink 存储库](https://github.com/GoogleChromeLabs/quicklink/blob/master/src/request-idle-callback.mjs)中看到此 API 的优雅用法。

```
const requestIdleCallback = window.requestIdleCallback ||
  function (cb) {
    const start = Date.now();
    return setTimeout(function () {
      cb({
        didTimeout: false,
        timeRemaining: function () {
          return Math.max(0, 50 - (Date.now() - start));
        },
      });
    }, 1);
  }; 
```

上面代码的意思是：如果浏览器支持`requestIdleCallback`（检查兼容性），就使用它。如果不支持，则使用 a`setTimeout(()=> {}, 1)`作为后备，它应该将要在事件循环结束时调用的函数排队。

然后你可以像这样使用它：

```
requestIdleCallback(() => {...}, {
    timeout: 2000
  }); 
```

`timeout`第二个参数是可选的，如果你想确保函数被执行，你可能需要设置一个。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2018-09-25T12:45:05.247

去抖动实际上是一个好主意！这是一个无 jQuery 项目的版本：

```
const derivedLogout = createDerivedLogout(30);
derivedLogout(); // It could happen that the user is too idle)
window.addEventListener('click', derivedLogout, false);
window.addEventListener('mousemove', derivedLogout, false);
window.addEventListener('keyup', derivedLogout, false);

function createDerivedLogout (sessionTimeoutInMinutes) {
    return _.debounce( () => {
        window.location = this.logoutUrl;
    }, sessionTimeoutInMinutes * 60 * 1000 )
} 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2015-10-23T17:20:55.630

这是用于在 Angular 中完成的 AngularJS 服务。

```
/* Tracks now long a user has been idle.  secondsIdle can be polled 
   at any time to know how long user has been idle. */
fuelServices.factory('idleChecker',['$interval', function($interval){
    var self = {
        secondsIdle: 0,
        init: function(){
            $(document).mousemove(function (e) {
                self.secondsIdle = 0;
            });
            $(document).keypress(function (e) {
                self.secondsIdle = 0;
            });
            $interval(function(){
                self.secondsIdle += 1;
            }, 1000)
        }
    }
    return self;
}]); 
```

请记住，此空闲检查器将针对所有路线运行，因此应`.run()`在加载 Angular 应用程序时对其进行初始化。然后你可以`idleChecker.secondsIdle`在每条路线内使用。

```
myApp.run(['idleChecker',function(idleChecker){
    idleChecker.init();
}]); 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2014-07-16T14:08:15.770

尝试了[freddoo 的解决方案](https://stackoverflow.com/questions/667555/how-to-detect-idle-time-in-javascript-elegantly/4029518#4029518)，但它在 1 分钟超时后不起作用，所以我稍微更改了它以记录用户最后一次点击页面的日期+时间，并在我的`timerIncrement`函数中计算当前时间和当前时间之间的差异最后点击时间，如果该值恰好大于或等于超时值，那么我重定向：

```
var clickedDate = new Date();
var idleTime = 1; //

function timerIncrement() {

    var nowDate = new Date();
    var diffMs = (nowDate - clickedDate); //Milliseconds between now & the last time a user clicked somewhere on the page
    var diffMins = Math.round(((diffMs % 86400000) % 3600000) / 60000); //Convert ms to minutes

    if (diffMins >= idleTime) {
        //Redirect user to home page etc...
    }
}

$(document).ready(function () {

    var idleInterval = setInterval(timerIncrement, 60000); // 1 minute

    $(this).click(function (e) {
        clickedDate = new Date();
    });

}); 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2009-03-20T21:04:18.863

JavaScript has no way of telling the CPU usage. This would break the sandbox JavaScript runs inside.

Other than that, hooking the page's onmouseover and onkeydown events would probably work.

You could also set use setTimeout in the onload event to schedule a function to be called after a delay.

```
// Call aFunction after 1 second
window.setTimeout(aFunction, 1000); 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2009-03-20T19:20:45.647

好吧，您可以将单击或鼠标移动事件附加到重置计时器的文档正文。

有一个按定时间隔调用的函数，检查计时器是否超过指定时间（如 1000 毫秒）并开始预加载。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2013-05-17T21:09:21.160

对于有同样问题的其他用户。这是我刚刚编写的一个函数。

它不会*在*用户每次移动鼠标时运行，也不会在每次鼠标移动时清除计时器。

```
<script>
// Timeout in seconds
var timeout = 10; // 10 seconds

// You don't have to change anything below this line, except maybe
// the alert('Welcome back!') :-)
// ----------------------------------------------------------------
var pos = '', prevpos = '', timer = 0, interval = timeout / 5 * 1000;
timeout = timeout * 1000 - interval;

function mouseHasMoved(e){
    document.onmousemove = null;
    prevpos = pos;
    pos = e.pageX + '+' + e.pageY;
    if(timer > timeout){
        timer = 0;
        alert('Welcome back!');
    }
}

setInterval(function(){
    if(pos == prevpos){
        timer += interval;
    }else{
        timer = 0;
        prevpos = pos;
    }
    document.onmousemove = function(e){
        mouseHasMoved(e);
    }
}, interval);
</script> 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2018-10-02T13:16:24.887

我终于让这个为我的网站工作了。我发现[equiman 的回答](https://stackoverflow.com/questions/667555/how-to-detect-idle-time-in-javascript-elegantly/10126042#10126042)最有帮助。这个答案的问题`alert()`在于 JavaScript 中的函数会暂停脚本执行。如果您想像我一样希望发送警报，然后如果没有收到站点自动注销的响应，则暂停执行是一个问题。

解决方案是`alert()`用自定义部门替换 ，[在此处](https://stackoverflow.com/questions/42506714/display-warning-after-x-time-of-inactivity-and-logout-after-xy-time-javascript)描述。

这是代码：（**注意**：您需要更改第 58 行以重定向到您网站的适当 URL）

```
var inactivityTracker = function () {

  // Create an alert division
  var alertDiv = document.createElement("div");
  alertDiv.setAttribute("style","position: absolute;top: 30%;left: 42.5%;width: 200px;height: 37px;background-color: red;text-align: center; color:white");
  alertDiv.innerHTML = "You will be logged out in 5 seconds!!";

  // Initialise a variable to store an alert and logout timer
  var alertTimer;
  var logoutTimer;

  // Set the timer thresholds in seconds
  var alertThreshold = 3;
  var logoutThreshold = 5;

  // Start the timer
  window.onload = resetAlertTimer;

  // Ensure timer resets when activity logged
  registerActivityLoggers(resetAlertTimer);

  // ***** FUNCTIONS ***** //

  // Function to register activities for alerts
  function registerActivityLoggers(functionToCall) {
    document.onmousemove = functionToCall;
    document.onkeypress = functionToCall;
  }

  // Function to reset the alert timer
  function resetAlertTimer() {
    clearTimeout(alertTimer);
    alertTimer = setTimeout(sendAlert, alertThreshold * 1000);
  }

  // Function to start logout timer
  function startLogoutTimer() {
    clearTimeout(logoutTimer);
    logoutTimer = setTimeout(logout, logoutThreshold * 1000);
  }

  // Function to logout
  function sendAlert() {

    // Send a logout alert
    document.body.appendChild(alertDiv);

    // Start the logout timer
    startLogoutTimer();

    // Reset everything if an activity is logged
    registerActivityLoggers(reset);
  }

  // Function to logout
  function logout(){

    //location.href = 'index.php';
  }

  // Function to remove alert and reset logout timer
  function reset(){

    // Remove alert division
    alertDiv.parentNode.removeChild(alertDiv);

    // Clear the logout timer
    clearTimeout(logoutTimer);

    // Restart the alert timer
    document.onmousemove = resetAlertTimer;
    document.onkeypress = resetAlertTimer;
  }
};
```

```
<html>

  <script type="text/javascript" src="js/inactivityAlert.js"></script>

  <head>
        <title>Testing an inactivity timer</title>
    </head>
    <body onload="inactivityTracker();" >
      Testing an inactivity timer
  </body>

</html>
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2018-10-25T00:22:37.210

我在这里提出的实现与其他答案在以下方面有所不同：

*   空闲事件（默认名为“idleTimeSeconds”）每 10 秒触发一次，因此您可以让多个订阅者订阅同一个事件
*   每个文档实例只设置一个计时器
*   计时器比空闲事件更频繁地触发（默认情况下每 1 秒对每 10 秒） - 这将实现默认间隔精度
*   记录空闲时间开始的时间戳，用于计算总空闲时间；其他解决方案建议在空闲时间计数器中​​增加秒数，这会降低价格，因为计时器的实际延迟可能比配置的长，请参阅[“延迟时间超过 WindowOrWorkerGlobalScope.setTimeout() 中指定的时间的原因”](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout#Reasons_for_delays_longer_than_specified)示例。
*   正如其他一些解决方案所建议的那样，计时器永远不会被取消/重置；取消和重置计时器更昂贵

文件`Idle.js`：

```
import $ from 'jquery';

export const IDLE_EVENT_NAME = 'idleTimeSeconds';

/**
 * How often an 'idleTimeSeconds' event is fired on the document instance.
 *
 * @type {number}
 */
const IDLE_EVENT_RATE_SECONDS = 10;

/**
 * How often the idle time is checked against the IDLE_EVENT_RATE_SECONDS.
 *
 * Should be much smaller than the value of IDLE_EVENT_RATE_SECONDS
 * (the smaller the value is, the more precisely the event is fired) -
 * because the actual delay may be longer, see "Reasons for delays
 * longer than specified in WindowOrWorkerGlobalScope.setTimeout() for examples":
 * https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout#Reasons_for_delays_longer_than_specified
 *
 * @type {number}
 */
const IDLE_TIMER_RATE_SECONDS = 1;

/**
 * Because the actual timer delay may be longer, we track the timestamp
 * when the idle time started, instead of incrementally adding to the total idle time.
 * Having a starting point, we can always calculate the idle time precisely
 * without accumulating delay errors.
 *
 * @type {number}
 */
let idleStartTimeMilliseconds;

/**
 * Holds the interval reference.
 */
let idleInterval;

/**
 * Holds the value of the latest idle time value
 * for which the event was fired (integer value in seconds).
 *
 * The value is therefore factor of IDLE_EVENT_RATE_SECONDS.
 *
 * @type {number}
 */
let lastFiredSeconds;

const $document = $(document);

/**
 * Resets the idle timer.
 * Called on user interaction events, like keydown or touchstart.
 */
function resetIdleStartTime() {

    // Reset the timestamp when the idle time started
    idleStartTimeMilliseconds = (new Date).getTime();

    // Reset the latest idle time value for which the even was fired
    // (integer value in seconds).
    lastFiredSeconds = 0;
}

/**
 * Ticks every IDLE_TIMER_RATE_SECONDS, which is more often than the expected
 * idle event firing rate.
 *
 * Fires the 'idleTimeSeconds' event on the document instance.
 */
function timerCallback() {

    const nowMilliseconds = (new Date).getTime();
    const idleTimeSeconds = Math.floor((nowMilliseconds - idleStartTimeMilliseconds) / 1000);

    // When do we expect the idle event to be fired again?
    // For example, if the event firing rate is 10 seconds,
    // and last time it was fired at 40 seconds of idle time,
    // the next one will be at 40 + 10 = 50 seconds.
    const nextIdleSecondsToFire = lastFiredSeconds + IDLE_EVENT_RATE_SECONDS;

    if (idleTimeSeconds >= nextIdleSecondsToFire) {

        // Record last fired idle time that is factor of the rate,
        // so that we keep firing the event as close to the desired rate as possible
        lastFiredSeconds = nextIdleSecondsToFire;

        $document.triggerHandler(IDLE_EVENT_NAME, [idleTimeSeconds]);
    }
}

// Initialize the idle timer once only per the document instance
$(function() {

    // Start the idle timer
    idleInterval = setInterval(timerCallback, IDLE_TIMER_RATE_SECONDS * 1000);

    // Reset the idle time start timestamp
    $document.on('mousemove keydown mousedown touchstart', resetIdleStartTime);
}); 
```

示例用法（例如 file `index.js`）：

```
import {IDLE_EVENT_NAME} from './Idle';
import $ from 'jquery';

$(function() {
    $(document).on(IDLE_EVENT_NAME, function(e, idleSeconds) {
        console.log('IDLE SECONDS:', idleSeconds);
    });
}); 
```

示例输出（摘录）：

```
IDLE SECONDS: 580
IDLE SECONDS: 590
IDLE SECONDS: 600
IDLE SECONDS: 610
IDLE SECONDS: 620
IDLE SECONDS: 630
IDLE SECONDS: 640
IDLE SECONDS: 650
IDLE SECONDS: 660
IDLE SECONDS: 670
IDLE SECONDS: 680
IDLE SECONDS: 691
IDLE SECONDS: 700
IDLE SECONDS: 710
IDLE SECONDS: 720
IDLE SECONDS: 730
IDLE SECONDS: 740
IDLE SECONDS: 750
IDLE SECONDS: 761
IDLE SECONDS: 770
IDLE SECONDS: 780
IDLE SECONDS: 790
IDLE SECONDS: 800
IDLE SECONDS: 810
IDLE SECONDS: 820
IDLE SECONDS: 830
IDLE SECONDS: 840
IDLE SECONDS: 850
IDLE SECONDS: 860
IDLE SECONDS: 871
IDLE SECONDS: 880
IDLE SECONDS: 890
IDLE SECONDS: 900
IDLE SECONDS: 910
IDLE SECONDS: 921 
```

当我切换到另一个选项卡并在那里做一些活动一段时间时，会产生上面的输出。可以看出，计时器有时会延迟（我想是因为在后台选项卡中以精确的速率触发计时器不是优先级）。但是空闲计时器仍然以正确的间隔 +/- 1 秒触发。在这种情况下，1 秒是空闲计时器的精度（通过`IDLE_TIMER_RATE_SECONDS`常量 in配置`Idle.js`）。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2019-05-04T14:49:10.570

您要求优雅，我创建了一个简单的类来支持惰性检查（具有空闲状态），除了命令式方式（带有回调）。此外，当违反空闲时间时，该类支持“backToActive”。

```
class Idle {
    constructor(timeout = 10, idleCallback = null, backToActiveCallback = null, autoStart = true, backToActiveOnXHR = false) {
        this.timeout = timeout
        this.idleCallback = idleCallback
        this.backToActiveCallback = backToActiveCallback
        this.autoStart = autoStart // only F5
        this.backToActiveOnXHR = backToActiveOnXHR
        this.idle = false
        this.timer = null
        this.events = ['scroll', 'mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart']
        this.init()
    }

    init() {
        if(this.backToActiveOnXHR) {
            this.events.push('load')
        }
        this.events.forEach(name => {
            window.addEventListener(name, this.backToActive, true)
        })
        if(this.autoStart) {
            this.backToActive()
        }
    }

    goIdle = () => {
        this.idle = true
        if(!!this.idleCallback) {
            this.idleCallback(this.timeout)
        }
    }

    backToActive = () => {
        if(this.idle) {
            this.backToActiveCallback()
        }
        this.idle = false
        clearTimeout(this.timer)
        this.timer = setTimeout(this.goIdle, this.timeout * 1000)
    }
} 
```

用法：

```
let idleCallback = timeout => { console.log(`Went idle after ${timeout} seconds`) }
let backToActiveCallback = () => { console.log('Back to active') }
let idle = new Idle(30, idleCallback, backToActiveCallback) 
```

开发工具中的结果：

```
// Went idle after 30 seconds <--- goes idle when no activity is detected
// Back to active <--- when the user is detected again 
```

支持懒惰的好处：

```
setInterval(() => {
    common.fetchApi('/api/v1/list', { status: idle.idle ? 'away' : 'online' }).then(/* show a list of elements */)
}, 1000 * 5) 
```

为什么要进行惰性检查？有时我们使用周期性[XHR](https://en.wikipedia.org/wiki/XMLHttpRequest)（使用 setInterval），即，当用户观看航班、游乐设施、电影、订单等列表时。然后，我们可以使用每个 XHR 添加有关他/她的活动状态（在线/离开）的信息，所以我们对系统中的活跃用户有一种感觉。

我的课程基于[Equiman](https://stackoverflow.com/questions/667555/how-to-detect-idle-time-in-javascript-elegantly/10126042#10126042)和[Frank Conijn 的](https://stackoverflow.com/questions/667555/how-to-detect-idle-time-in-javascript-elegantly/24989958#24989958)答案。

# sql-server - SQL Server Browser 只显示主机名，不显示实例名

> ID：667559
> 
> 赞同：5
> 
> 时间：2009-03-20T19:16:48.387
> 
> 标签：sql-server, sql-server-2008, sql-server-2008-express, sqlbrowser

我刚刚使用 SQL Server 2008 Express 实例设置了一台新的 Windows Server 2008 机器。SQL Browser 服务似乎无法正常工作。在 Management Studio 中，浏览服务器会显示新服务器的主机名，但不会显示实例名称。当您从列表中选择主机名时，它不会连接。但是我可以通过键入主机名\实例名组合来手动连接。

更新1：

1.  浏览器服务正在运行，我尝试了几个不同的帐户，包括域管理员，这是一种不好的做法，但我还是尝试了故障排除。
2.  我尝试在防火墙上打出适当的孔，并完全关闭防火墙。
3.  这是在 Hyper-V、Windows Server 2008 32 位客户机上运行的，它位于 Windows Server 2008 64 位主机上。我之前在同一台主机上做过这个（没有问题），但使用的是 SQL 2008 Standard 而不是 Express。
4.  当我在 SQL Server 机器上浏览 SSMS(Express) 中的服务器时，它工作正常并显示整个实例名称。当我使用 SSMS（标准）在远程机器（在同一个 Intranet 上）上浏览它时，它只显示主机名。

更新2：

按照建议按照数据包进行操作，发现以下内容

1.  客户端按预期发送了广播，并从同一网络上的其他 SQL Server 接收到正确的响应。
2.  服务器收到广播但没有发送响应。

考虑到这些结果，我想知道为什么主机名首先出现在客户端列表中。它根本不应该出现，对吧？

更新 3：

在微软支持的电话上花了一个半小时。我学到了一些东西，但问题还没有解决。有人建议我尝试在同一台机器上安装 SQL Standard 实例。我这样做了，新实例表现出所有相同的症状。主机名仅在浏览列表中显示一次，而不是每个实例一次。

更新4：

多亏了赏金系统，Stackoverflow 为我选择了一个答案，但这个问题没有得到解答。今天我尝试将整个 VM 移动到不同的主机服务器 - 一切都完全相同。主机名仍然出现在浏览列表中，但没有实例名称。

更新5：

确认 Hyper-V 集成服务已安装在来宾 (SQL) 服务器上。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T01:32:56.017

检查浏览器服务是否正在运行，默认情况下未打开。

**UPDATE1：** 查看是否可以安装[网络监视器](http://www.microsoft.com/downloads/details.aspx?familyid=f4db40af-1e08-4a21-a26b-ec2f4dc4190d&displaylang=en)/ [Wireshark](http://www.wireshark.org)以在 SQL Server 上进行网络跟踪，以查看它是否正在接收广播并发送响应。我认为这是解决此问题的最佳选择。根据[MSDN](http://msdn.microsoft.com/en-us/library/ms181087.aspx)，该服务使用 UDP 端口 1434，因此这是要监视的流量。

**UPDATE2：**服务器是否有多个IP？根据[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms190181.aspx)，Windows Server 2008 防火墙在响应 SQL Browser 服务广播时存在问题，即使规则允许数据包通过。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T17:30:18.447

我倾向于不依赖浏览。您会得到不一致的结果，因为浏览会发出广播 udp/1434 数据包并等待回复。但是，由于您能够通过 SERVERNAME\INSTANCENAME 进行远程连接，因此 SQL Browser 服务的这一方面正在发挥作用。如果不是，您将无法连接。话虽如此，要对浏览部分进行故障排除：

*   您是否尝试过停止并重新启动 SQL Browser 服务？
*   如果不起作用，您是否尝试过停止并重新启动实例？

不幸的是，要彻底解决这个问题，您必须进行数据包跟踪。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T22:58:57.970

听起来浏览服务以某种方式搞砸了......

不知道能不能暂时把这个SQL Server暂时下架。但如果是这样，你可能想试试这个：

1.  完全卸载所有 SQL\instances。
2.  运行 SQL Express 2008 的安装
3.  在安装期间创建默认实例（不是命名实例）
4.  再次运行安装程序并创建默认命名实例 (SQLExpress)
5.  尝试再次连接到命名实例。如果有效，您可以删除默认实例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-05T10:59:14.530

我在虚拟机中遇到了同样的问题。关闭防火墙后它工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-06-06T15:35:50.353

我刚遇到同样的问题。我无法在 SSMS 网络服务器选项卡中看到实例名称。事实证明，我已经设置了 Hyper-V 并在我的本地计算机上创建了一个内部网络。该网络被标识为公共/来宾网络，并且启用了 Windows 防火墙，即使我的域设置禁用了防火墙。一旦我在我的计算机上禁用了该访客网络，我就可以看到所有实例。

机器：运行 Hyper-V 的物理 SQL Server 2014 Ent Windows 8.1 笔记本电脑

# c# - 优化对绑定到 DataGridView 的 DataTable 的更新

> ID：667571
> 
> 赞同：9
> 
> 时间：2009-03-20T19:18:27.103
> 
> 标签：c#, .net, datagridview, datatable

我的应用程序中有一个显示一些数据的表单。当我第一次显示窗体时，我将一些数据加载到 DataTable 中，然后将 DataTable 绑定到 DataGridView。我还启动了一个异步方法来执行一些较慢的数据库查询。当这些慢查询完成后，我需要更新 DataTable 中的几百行，填充从慢查询返回的值，如下所示：

```
foreach (DataRow row in data.Rows)
{
    SlowLoadingData slow_stuff = slow_query_results[(int)row["id"]];

    row.BeginEdit();
    row[column_one] = slow_stuff.One;
    row[column_two] = slow_stuff.Two;
    row[column_three] = slow_stuff.Three;
    row.EndEdit();
} 
```

这非常慢，将 UI 线程挂起一分钟或更长时间，大概是因为每一行都在触发重绘。

经过一番研究，我找到了一种快速的方法。首先，将 DataGridView 绑定到绑定到 DataTable 的 BindingSource，而不是直接绑定到 DataTable。然后，在对 DataTable 进行更改时执行以下操作：

```
binding_source.SuspendBinding();
binding_source.RaiseListChangedEvents = false;
// foreach (DataRow in Data.Rows) ... code above
binding_source.RaiseListChangedEvents = true;
binding_source.ResumeBinding();
grid.Refresh(); 
```

但是有一个问题，而且很麻烦：上面的代码阻止了 DataGridView 检测添加到 DataTable 的新行。**添加到表中的任何新行都不会出现在网格中。**如果您使用箭头键将当前单元格选择移出网格的底端，则网格也可能引发异常，因为基础数据源具有更多行但网格尚未创建网格行来显示它们。

因此，我可以看到两种可能的解决方案：

1.  在对底层 DataTable 进行更改时，是否有更好的方法来抑制绑定更新？

2.  有没有一种简单的方法来告诉 DataGridView 优雅地刷新其网格行集合以匹配底层 DataTable 行的数量？（注意：我尝试调用 BindingSource.ResetBindings，但如果您从 DataTable中*删除了行，它似乎会触发更多异常！）*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T19:56:37.153

您可以尝试在 DataTable 上使用[Merge 方法。](http://msdn.microsoft.com/en-us/library/system.data.datatable.merge.aspx)我将尝试创建一个简单的演示应用程序并将其发布在这里，但想法很简单。当您要更新 Grid 时，将结果查询到新的 DataTable 中，然后将旧表与新表合并。只要两个表都有主键（如果它们没有从数据库返回，您可以在内存中创建它们）然后它应该跟踪更改并无缝更新 DataGridView。它还具有不丢失用户在网格上的位置的优点。

好的，这是一个示例。我创建了一个带有两个按钮和一个 dataGridView 的表单。在 button1 单击时，我用一些数据填充主表，并将网格绑定到它。然后，在第二次单击时，我创建了另一个具有相同架构的表。向其中添加数据（一些具有相同的主键，一些具有新的主键）。然后，他们将它们合并回原始表。它按预期更新网格。

```
 public partial class Form1 : Form
    {
        private DataTable mainTable;
        public Form1()
        {
            InitializeComponent();
            this.mainTable = this.CreateTestTable();
        }

        private void button1_Click(object sender, EventArgs e)
        {
            for (int i = 1; i <= 10; i++)
            {
                this.mainTable.Rows.Add(String.Format("Person{0}", i), i * i);
            }

            this.dataGridView1.DataSource = this.mainTable;
        }

        private void button2_Click(object sender, EventArgs e)
        {
            DataTable newTable = this.CreateTestTable();
            for (int i = 1; i <= 15; i++)
            {
                newTable.Rows.Add(String.Format("Person{0}", i), i + i);
            }
            this.mainTable.Merge(newTable);
        }

        private DataTable CreateTestTable()
        {
            var result = new DataTable();
            result.Columns.Add("Name");
            result.Columns.Add("Age", typeof(int));
            result.PrimaryKey = new DataColumn[] { result.Columns["Name"] };

            return result;

        }
    } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-20T19:38:13.610

您是否考虑过在填充表格时断开 dataGrid 或 bindingSource 并在之后重新连接？它可能看起来有点难看，但它应该快得多。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T05:41:22.363

如果您使用的`BindingSource`是复杂数据绑定，请务必了解这一点，`SuspendBinding`并且`ResumeBinding`只暂停和恢复*当前项目的绑定。* 这使您可以禁用当前项的绑定并更改其一系列属性，而无需对属性进行的任何单独更改都被推送到绑定控件。（这在 的文档中没有解释`BindingSource`，它会很有用，哦不：它在 的文档中`CurrencyManager`。）

您对列表中的其他项目（即除当前项目之外的所有项目）所做的任何更改都会引发`ListChanged`事件。如果您禁用这些事件，BindingSource 将停止告诉绑定控件有关列表更改的信息，直到您重新启用它们。这具有您所看到的结果：您将所有行添加到底层`DataTable`，但是由于您关闭`ListChanged`了事件，所以`BindingSource`不会告诉`DataGridView`它们，所以`DataGridView`仍然是空的。

正确的解决方案是调用`ResetBindings`，它使用绑定列表中的当前值强制`BindingSource`刷新绑定到它的所有控件。

打电话后你会得到什么样的例外`ResetBindings`？因为它对我来说很好用，无论我从底层添加、编辑、删除还是删除行`DataTable`。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-08-26T16:50:05.390

我遇到了类似的问题。这是一个更简单的解决方案（如果不那么优雅）。

我发现这是：

```
dataGridView.DataSource = null;
dataTable.BeginLoadData();
foreach(DataRow row in dataTable.Rows){
    //modify row
}
dataTable.EndLoadData();
dataGridView.DataSource = dataTable; 
```

...比这快得多：

```
dataTable.BeginLoadData();
foreach(DataRow row in dataTable.Rows){
    //modify row
}
dataTable.EndLoadData(); 
```

干杯--DC

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-07-14T20:27:00.340

将其发布为解决方案：已经对评论和帖子进行了一些注释。BFree提到的Merge Table方法是一个非常好用的方法，我认为是正确的方法，而不是太简单和优雅。这是我的笔记为什么和我不确定是否有任何一个被捕获的是服务器上的查询命中。该操作在他对 BFree 的评论中表示，他需要复制该表来执行他需要做的事情，当然我不确定哪个表，因为他的代码：

```
foreach (DataRow row in data.Rows) 
```

这些行来自他的名为 data 的表，其中所需的副本是 - 他已经拥有它。

然后，这是该循环的每次迭代中都会出现的内容：

```
SlowLoadingData slow_stuff = slow_query_results[(int)row["id"]]; 
```

OP 是否真的在这些行的每次迭代中查询数据库（如果它是一个大表，我们说的是 100,000 行+）。想想服务器上的负载（他的应用程序也必须生成这个查询请求！），以及它在网络上的流量！如果它是唯一的应用程序，也许没关系，但即便如此，如果我想提高效率，我也不愿意这样做。

如果在一个查询中从数据库中收集数据似乎很多 - 那么也许更好的方法是将他的数据分页并进行合并。

```
SlowLoadingData Page1_SlowLoadingData = slow_query_results[Page1] as DataTable;
data.Merge(Page1_SlowLoadingData);

SlowLoadingData Page2_SlowLoadingData = slow_query_results[Page2] as DataTable;
data.Merge(Page2_SlowLoadingData); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-18T17:13:33.753

我发现使用 resetBindings 似乎会移动滚动条，而用户却在想我做了什么？我发现使用 bindingList 作为数据源，使用 INotifyPropertyChanged 的​​对象，然后在编辑行时（绑定到对象）。在表单上单击或选择更改之前，该行不会更新。

但是调用 dgv.Refresh() 似乎可以解决问题，而无需滚动更改。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-03-08T07:17:04.823

我发现 Ravi LVS 在 codeproject 上的解决方案效果很好：

```
BindingSource bs = new BindingSource();
DataTable dt = new DataTable();

bs.DataSource = dt;
bs.SuspendBinding();
bs.RaiseListChangedEvents = false; 
bs.Filter = "1=0"; 
dt.BeginLoadData(); 

//== some modification on data table

dt.EndLoadData();
bs.RaiseListChangedEvents = true;
bs.Filter = ""; 
```

链接到原始页面： http: [//www.codeproject.com/Tips/55730/Achieve-performance-while-updating-a-datatable-bou](http://www.codeproject.com/Tips/55730/Achieve-performance-while-updating-a-datatable-bou)

# c++ - 模拟蓝屏

> ID：667581
> 
> 赞同：9
> 
> 时间：2009-03-20T19:20:40.733
> 
> 标签：c++, windows, crash, bsod

我正在尝试制作一个定期记录一大堆事情的程序。具体原因是，如果它蓝屏，开发人员可以返回并检查大量环境，看看当时发生了什么。

我的问题，他们是导致蓝屏的方法吗？也许通过 windowsAPI 调用（也许是零内存？）。

Anywhoo，如果您能想出一种方法来导致蓝屏待命，我将不胜感激。

我正在测试它的计算机旨在接受这样的东西哈哈。

顺便说一句，我使用的语言是 C\C++。谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-20T19:24:46.090

您可以将机器配置为在击键时崩溃 (Ctrl-ScrollLock)

*   [http://support.microsoft.com/kb/244139](http://support.microsoft.com/kb/244139)

由于有时这在某些带有 USB 键盘的系统上不起作用，您还可以获取 Windows 调试工具，安装内核调试器，并使用“ `.crash`”命令强制进行错误检查。

*   [http://www.microsoft.com/whdc/devtools/debugging/default.mspx](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-20T19:30:48.057

为了导致蓝屏死机，在内核模式下运行的驱动程序需要导致它。如果你真的想这样做，你可以编写一个驱动程序，将 KeBugCheck 暴露给用户模式。

[http://msdn.microsoft.com/en-us/library/ms801640.aspx](http://msdn.microsoft.com/en-us/library/ms801640.aspx)

感谢下面的 Andrew 指出这个实用程序：

[http://download.sysinternals.com/files/NotMyFault.zip](http://download.sysinternals.com/files/NotMyFault.zip)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-20T19:23:28.230

如果您终止 csrss 进程，您将很快获得蓝屏。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T19:24:26.840

如果您想模拟蓝屏等硬崩溃，您几乎必须拔掉电源线。不建议。

如果发生崩溃，任何未保存到持久存储的内容都将丢失。如果您想模拟崩溃以记录日志，请在您的记录器中写入一个“终止开关”，以停止日志记录。现在，您可以通过终止日志记录来模拟崩溃，并确保您拥有在发生实际崩溃时想要的数据。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-23T11:46:02.787

首先，我建议您使用虚拟机来测试此[BSOD](http://technet.microsoft.com/en-us/library/cc750081.aspx)。这将允许您保留备份，以防蓝屏死机对系统造成一些损害。[这是有关如何通过按 CTRL+SCROLLLOCK+SCROLLLOCK](http://pcsupport.about.com/od/tipstricks/ht/makebsodxp.htm)来生成 BSOD的提示。

是否有一个 Windows API 来生成一个？不，根据[这篇文章](http://www.irrlicht3d.org/pivot/entry.php?id=571)。尽管如此，如果您使用无效数据调用某些 API，它们仍然可能导致内核内部崩溃，这将导致您的 BSOD。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-20T19:28:13.307

我不确定你到底要测试什么。由于您的程序定期运行，因此在系统运行时检查信息是否以您指定的频率转储就足够了？您是否在检查蓝屏后信息是否保留？根据您转储它的方式（以及您是否正在刷新缓冲区），这可能不是必需的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-02-07T11:04:46.617

如果您不想编写代码（驱动程序、IOCTL ...），您可以使用[DiskCryptor](http://diskcryptor.net/wiki/Console/en)。请注意，不需要磁盘加密。

只需要安装驱动：

> dcinst.exe -设置

然后使用 DC 控制台生成一个 bsod：

> dccon.exe -bsod

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-10-12T20:45:55.290

以批评者身份运行进程并退出 [http://waleedassar.blogspot.co.uk/2012/03/rtlsetprocessiscritical.html](http://waleedassar.blogspot.co.uk/2012/03/rtlsetprocessiscritical.html)

# delphi - 如何重新启动用 Delphi 编写的 Windows 服务应用程序？

> ID：667588
> 
> 赞同：2
> 
> 时间：2009-03-20T19:22:20.450
> 
> 标签：delphi, winapi, windows-services

我有一个用 Delphi 编写的 Windows 服务。它使用的第三方资源之一偶尔会损坏，我发现解决这种情况的唯一方法是退出并重新启动程序。我可以从程序中检测到资源何时损坏，我可以告诉 Windows 在服务停止后重新启动服务，但我不知道如何让服务告诉自己停止。

该程序非常简单。我以看似正常的方式创建了一个服务应用程序。我有一个 TService 的子类来管理服务，而所有功能都发生在一个单独的线程中。TService 子类几乎只是管理子线程的执行，我将在子线程中检测损坏。

作为参考，这里是服务和子线程的标头信息。

```
type
  TScannerThread = class(TThread)
   private     
    Scanner    : TScanner;
    DefaultDir : String;
    ImageDir   : String;
    procedure CheckScanner;
   public      
    Parent     : TComponent;
    procedure Execute; override;
  end;         

  TCardScanSvc   = class(TService)
    procedure ServiceCreate(Sender: TObject);
    procedure ServiceExecute(Sender: TService);
    procedure ServiceStart(Sender: TService; var Started: Boolean);
    procedure ServiceStop(Sender: TService; var Stopped: Boolean);
    procedure ServicePause(Sender: TService; var Paused: Boolean);
    procedure ServiceContinue(Sender: TService; var Continued: Boolean);
   private        
    ScannerThread : TScannerThread;
   public         
    function GetServiceController: TServiceController; override;
  end;            

var
  CardScanSvc : TCardScanSvc; 
```

在 GUI 应用程序中，我会调用 Application.Terminate，但 TServiceApplication 似乎没有该方法。我可以终止子线程，但主线程永远不会注意到，Windows 认为该服务仍在运行。我真的想不出还有什么可以尝试的。

该程序最初是在 Delphi 5 中创建的，我目前使用的是 Delphi 2007，以防万一。

* * *

### 编辑：

使用mghie的代码，我可以停止服务，但Windows只会在服务意外失败时重新启动服务，而不是在正常停止的情况下。我要做的是制作一个单独的服务应用程序，如果有问题，让第一个信号发出第二个信号，然后让第二个重新启动第一个。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-20T20:00:36.037

服务自行停止没有问题 - 我只是尝试使用我自己的一项服务，用 Delphi 4 编写（不使用*TService*类）。以下例程对我有用：

```
procedure TTestService.StopService;
var
  Scm, Svc: SC_Handle;
  Status: SERVICE_STATUS;
begin
  Scm := OpenSCManager(nil, nil, SC_MANAGER_ALL_ACCESS);
  if Scm <> 0 then begin
    Svc := OpenService(Scm, PChar(ServiceName), SERVICE_ALL_ACCESS);
    if Svc <> 0 then begin
      ControlService(Svc, SERVICE_CONTROL_STOP, Status);
      // handle Status....
      CloseServiceHandle(Svc);
    end;
    CloseServiceHandle(Scm);
  end;
end; 
```

您需要检查它是否也适用于您的工作线程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T19:28:17.673

您应该能够使用 WMI (Windows Management Instrumentation) 重新启动服务，即使是在服务本身内。不知道这是否会导致任何奇怪的问题，但它应该可以工作。 [这](http://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=628&lngWId=7)是一篇关于使用 Delphi 进行 WMI 的文章。

更新：好吧，我假设（我的错误）只有一个 WMI 服务重启命令，例如您可以在服务管理列表中单击的按钮。显然不是。
您可以改为编写一个控制台应用程序，该服务在数据损坏时启动。控制台应用程序将从单独的进程重新启动服务。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-12-21T16:59:34.990

我找到了一个更简单的替代方案。您可以向您的 TService 子类添加一个方法：

```
procedure TSomeService.StopService;
begin
  Controller(SERVICE_CONTROL_STOP);
end; 
```

我使用与 OP 相同的设置 - 具体来说，是一个 TService 后代，它只是启动一个工作线程，然后除了处理 Windows 消息之外什么都不做。不幸的是，您不能从工作线程调用 Controller，因为它是受保护的。当然，解决它的简单方法是创建一个我上面展示的公共方法。要从工作线程中使用它，您需要一个对可从工作线程内访问的 TService 对象的引用。我通过在线程的构造函数中将我的 TService 对象传递给我的工作线程来做到这一点。

# c# - 创建枚举后销毁 EnumBuilder？

> ID：667599
> 
> 赞同：1
> 
> 时间：2009-03-20T19:24:41.940
> 
> 标签：c#, .net, enums, reflection.emit

我正在尝试减少我的应用程序使用的内存量。在我的应用程序中，我使用 System.Reflection.Emit.EnumBuilder 根据我在运行时收到的信息动态创建枚举。我只使用 EnumBuilder 来创建一个单独的枚举，之后我就不再使用它了。在使用 CLRProfiler 时，我注意到 EnumBuilders 永远不会被破坏。我的应用程序在运行时可以进行数千次枚举，因此这些 EnumBuilder 使用的内存量可以加起来。EnumBuilder 没有定义 Dispose 方法，所以我不能那样销毁它。是否有可能以某种方式从内存中删除剩余的 EnumBuilders？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-20T19:34:09.203

`EnumBuilder`在动态程序集中创建枚举。根据[如何：加载和卸载](http://msdn.microsoft.com/en-us/library/ms173101(VS.80).aspx)程序集（C# 编程指南），如果不卸载所有使用它的应用程序域，就无法卸载程序集。尤其：

“即使程序集超出范围，实际的程序集文件仍将保持加载，直到包含它的所有应用程序域都被卸载。”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T19:46:32.997

> 我的应用程序可以在运行时进行数千次枚举，

为什么？听起来你正在做一些你可能不应该做的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T19:27:09.610

我也注意到了。这是 ModuleBuilder 中的一个“泄漏”，它挂在字节和字符串 IIRC 上。

您可以查看加载了 SOS 的 WinDbg 以获得更好的内存信息。

# javascript - 为什么这不起作用？在循环中调用属于对象的函数

> ID：667606
> 
> 赞同：0
> 
> 时间：2009-03-20T19:26:08.163
> 
> 标签：javascript, loops, object

在我的代码中 jsc.tools 是一个包含对象的对象。每个子对象都包含一个 init() 和 run() 方法。

我在启动时运行以下代码：

```
for(tool in jsc.tools) {
    tool.init();
} 
```

这给了我错误“tool.init 不是函数”。

工具声明的示例是：

```
jsc.tools.sometool = {};
jsc.tools.sometool.run = function() {
    // Apply tool
}
jsc.tools.sometool.init = function() {
    // Set bits of data needed for the tool to run
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T19:28:56.860

javascript 中的 for in x 运算符为您提供对象的属性名称。尝试：

```
for(tool in jsc.tools) {
    jsc.tools[tool].init();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T19:29:26.860

你需要使用

```
for(tool in jsc.tools) {
    jsc.tools[tool].init();
} 
```

# c++ - 错误，实现绕组数算法，（OpenGL，C++）

> ID：667608
> 
> 赞同：0
> 
> 时间：2009-03-20T19:26:11.720
> 
> 标签：c++, opengl, graphics, geometry

我正在尝试实现绕组数算法来测试一个点是否在另一个多边形内。虽然我的算法的结果是错误的并且不一致。我已经为此工作了很长时间，这已经变得有点痛苦了！

我基本上已经转换了笔记和网站的伪代码，例如[softsurfer.com](http://softsurfer.com/Archive/algorithm_0103/algorithm_0103.htm#wn_PinPolygon())

我成功检测到我的播放器和建筑对象边界框是否重叠。我将结果返回到一个结构（BoxResult），它让我知道是否发生了碰撞并返回它与之碰撞的框（下）

```
struct BoxResult{
bool collide;
Building returned;
};

void buildingCollision(){
int wn = 0;                         //winding number count
BoxResult detect = boxDetection();  //detect if any bounding boxes intersect
    if(detect.collide){ //If a bounding box has collided, excute Winding Number Algorithm.
        for(int i = 0; i < player.getXSize(); i++){
            Point p;
            p.x = player.getXi(i);
            p.y = player.getYi(i);
            wn = windingNum(detect.returned,p);
            cout << wn << endl;
            //Continue code to figure out rebound reaction
        }
    }
} 
```

然后我测试建筑物和玩家之间的碰撞（下图）。我已经尝试了 5 次不同的尝试和数小时的调试来了解错误发生的位置，但是我正在实施仅使用数学的最​​无效的方法（如下）。

```
 int windingNum(Building & b, Point & p){
int result = 0;             //Winding number is one, if point is in poly
float total;            //Counts the total angle between different vertexs
double wn;

    for(int i = 0; i <= b.getXSize()-1;i++){
    float acs, nom, modPV, modPV1, denom, angle;
        if(i ==  3){
                //Create the different points PVi . PVi+1
                Point PV, PV1;
                PV.x = (b.getXi(i) + wx) * p.x; 
                PV.y = (b.getYi(i) + wy) * p.y;
                PV1.x = (b.getXi(0) + wx) * p.x; 
                PV1.y = (b.getYi(0) + wy) * p.y;

                modPV = sqrt( (PV.x * PV.x) + (PV.y * PV.y));       //Get the modulus of PV
                modPV1 = sqrt( (PV1.x * PV1.x) + (PV1.y * PV1.y));  //Get modulus of PV1

                nom = (PV1.x * PV.x) + (PV1.y * PV.y);              //Dot product of PV and PV1
                denom = modPV * modPV1;     //denomintor of winding number equation
                angle = nom / denom;
                acs = acos(angle) * 180/PI;     //find the angle between the different points
                total = total + acs;        //add this angle, to the total angle count
            }
            if(i < 3){
                //Create the different points PVi . PVi+1
                Point PV, PV1;
                PV.x = (b.getXi(i) + wx) * p.x; 
                PV.y = (b.getYi(i) + wy) * p.y;
                PV1.x = (b.getXi(i+1) +wx) * p.x; 
                PV1.y = (b.getYi(i+1) +wy) * p.y;

                modPV = sqrt((PV.x * PV.x) + (PV.y * PV.y));        //Get the modulus of PV
                modPV1 = sqrt((PV1.x * PV1.x) + (PV1.y * PV1.y));   //Get modulus of PV1

                nom = (PV1.x * PV.x) + (PV1.y * PV.y);              //Dot product of PV and PV1
                denom = modPV * modPV1;     //denomintor of winding number equation
                angle = nom / denom;
                acs = acos(angle) * 180/PI;  //find the angle between the different points
                total = total + acs;        //add this angle, to the total angle count
                }
    }

    wn = total;
    if(wn < 360){
        result = 0;}
    if(wn == 360){
        result = 1;}

    return result;
} 
```

由于我不明白的原因 acs = acos(angle) 总是返回 1.#IND000。顺便说一句，你知道，我只是在另一个方块上测试算法，因此如果 i == 3 和 if i < 3 有两个 if 语句。

如果你需要知道这些，wy 和 wx 是被翻译的世界坐标。因此，在世界范围内移动玩家，例如向前移动玩家，一切都被转换为 wy 的负数。

此外，Building 对象看起来类似于以下结构：

```
struct Building {
vector<float> x;   //vector storing x co-ords
vector<float> y;   //vector storing y co-ords
float ymax, ymin, xmax, xmin //values for bounding box
vector<int> polygons; //stores the number points per polygon (not relevant to the problem)
} 
```

如果有人可以提供帮助，我将不胜感激！我只是希望我能看到哪里出了问题！（我确信所有程序员都曾说过，哈哈）感谢您的阅读...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T22:42:41.230

计算 PV 和 PV1 模数的两条线不正确。他们应该是

```
modPV  = sqrt(PV.x  * PV.x  + PV.y  * PV.y );
modPV1 = sqrt(PV1.x * PV1.x + PV1.y * PV1.y); 
```

这能解决问题吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T10:39:15.970

我可能不理解您的问题/问题，但这里有一个简单而可靠的多边形测试点：[PNPOLY](http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T12:20:16.447

至于你对交叉数算法的实现，第一个明显的错误是你没有遍历所有的边。你是个矮人。您应该循环到 i < n 然后将 i 加一定义为

```
int ip1 = ( i + 1 )  % n; 
```

这当然也适用于您原始问题中的代码，以节省您必须拥有两个代码副本。

第二个是

```
rem = cn % 1; 
```

没有效果。softsurfer 上的代码很好，即

```
rem = (cn&1); 
```

它试图通过测试最后一位是否设置来检测 cn 是奇数还是偶数。如果您想使用模运算符 % 进行相同的测试，那么您应该将其写为

```
rem = cn % 2; 
```

因为这将 cn 除以 2 的余数分配给 rem。

我还没有去看看是否还有其他问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T15:34:37.587

您好，正如 Troubadour 建议的关于交叉数算法的建议并进行了一些更改，但是 if 语句由于某种原因永远不会返回 true。我发布的新代码如下。顺便说一句，再次感谢大家的回复:-)

```
int cn_PnPoly( Point P, Building & b, int n )
{
    int    cn = 0;    // the crossing number counter
    int     rem = 0;
    vector<float>x;
    vector<float>y;
    x.swap(b.getX());
    y.swap(b.getY());
    //// loop through all edges of the polygon
    //for (int i=0; i<n; i++) {    // edge from V[i] to V[i+1]
    //   if (((V[i].y <= P.y) && (V[i+1].y > P.y))    // an upward crossing
    //    || ((V[i].y > P.y) && (V[i+1].y <= P.y))) { // a downward crossing
    //        // compute the actual edge-ray intersect x-coordinate
    //        float vt = (float)(P.y - V[i].y) / (V[i+1].y - V[i].y);
    //        if (P.x < V[i].x + vt * (V[i+1].x - V[i].x)) // P.x < intersect
    //            ++cn;   // a valid crossing of y=P.y right of P.x
    //    }
    //}
    //return (cn&1);    // 0 if even (out), and 1 if odd (in)

        // loop through all edges of the polygon
    for (int i=0; i<n; i++) {    // edge from V[i] to V[i+1]
    int ip1 = (i +1) %n;
        if (((y.at(i) <= P.y) && (y.at(ip1) > P.y))    // an upward crossing
            || ((y.at(i) > P.y) && (y.at(ip1) <= P.y))) { // a downward crossing
            // compute the actual edge-ray intersect x-coordinate
                float vt = (float)(P.y - y.at(i)) / (y.at(ip1) - y.at(i));
                if (P.x < x.at(i) + vt * (x.at(ip1) - x.at(i))) // P.x < intersect
                ++cn;   // a valid crossing of y=P.y right of P.x
        }
    }
    rem =  (cn&1);
    return (rem);    // 0 if even (out), and 1 if odd (in)
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T15:50:29.933

下面我更正了代码，我忘了添加世界坐标。又一个愚蠢的错误...

```
int cn_PnPoly( Point P, Building & b, int n )
{
    int    cn = 0;    // the crossing number counter
    int     rem = 0;
    vector<float>x;
    vector<float>y;
    x.swap(b.getX());
    y.swap(b.getY());

        // loop through all edges of the polygon
    for (int i=0; i<n; i++) {    // edge from V[i] to V[i+1]
    int ip1 = (i +1) %n;
        if (((  (y.at(i)+wy) <= P.y) && ( (y.at(ip1)+wy) > P.y))    // an upward crossing
            || ((  (y.at(i)+wy) > P.y) && ( (y.at(ip1)+wy) <= P.y))) { // a downward crossing
            // compute the actual edge-ray intersect x-coordinate
                float vt = (float)(P.y - (y.at(i)+wy) ) / ( (y.at(ip1)+wy) - (y.at(i)+wy) );
                if (P.x < (x.at(i)+wx) + vt * ( (x.at(ip1)+wx) - (x.at(i)+wx) )) // P.x < intersect
                ++cn;   // a valid crossing of y=P.y right of P.x
        }
    }
    rem =  (cn&1);
    return (rem);    // 0 if even (out), and 1 if odd (in)
} 
```

虽然这可以检测一个点何时在多边形中，但它没有考虑玩家的当前航向。

如果这没有意义，在 2D 游戏中，我通过按世界坐标平移所有多边形来围绕玩家移动世界地图。这些是游戏中的wx和wy。我还围绕一个标题变量旋转播放器。

这些是在绘图函数中计算出来的，但是碰撞检测函数不考虑航向。为此，我只需将 Building 对象给出的 x 和 y 坐标乘以标题？不幸的是，我不太擅长几何。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T10:10:45.337

我已经放弃了缠绕数字代码，它真的让我着迷！如果有人确实找到了解决方案，我仍然会非常感激。我现在正在尝试使用交叉数算法进行多点检测。我在评论中保留了伪代码，再次来自 softsurfer....

```
int cn_PnPoly( Point P, Building & b, int n )
{
    int    cn = 0;    // the crossing number counter
    int     rem = 0;
    vector<float>x;
    vector<float>y;
    x.swap(b.getX());
    y.swap(b.getY());
    //// loop through all edges of the polygon
    //for (int i=0; i<n; i++) {    // edge from V[i] to V[i+1]
    //   if (((V[i].y <= P.y) && (V[i+1].y > P.y))    // an upward crossing
    //    || ((V[i].y > P.y) && (V[i+1].y <= P.y))) { // a downward crossing
    //        // compute the actual edge-ray intersect x-coordinate
    //        float vt = (float)(P.y - V[i].y) / (V[i+1].y - V[i].y);
    //        if (P.x < V[i].x + vt * (V[i+1].x - V[i].x)) // P.x < intersect
    //            ++cn;   // a valid crossing of y=P.y right of P.x
    //    }
    //}
    //return (cn&1);    // 0 if even (out), and 1 if odd (in)

        // loop through all edges of the polygon
    for (int i=0; i<n-1; i++) {    // edge from V[i] to V[i+1]
        if (((y.at(i) <= P.y) && (y.at(i+1) > P.y))    // an upward crossing
            || ((y.at(i) > P.y) && (y.at(i+1) <= P.y))) { // a downward crossing
            // compute the actual edge-ray intersect x-coordinate
                float vt = (float)(P.y - y.at(i)) / (y.at(i+1) - y.at(i));
                if (P.x < x.at(i) + vt * (x.at(i+1) - x.at(i))) // P.x < intersect
                ++cn;   // a valid crossing of y=P.y right of P.x
        }
    }
    rem = cn % 1;
    return (rem);    // 0 if even (out), and 1 if odd (in)
} 
```

同样，这总是返回零，我不确定为什么！？！我是否错误地转换了算法？测试点的哪个方向（即顺时针，逆时针）是否重要？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-21T12:01:20.937

我已经尝试按照 audris 的建议实施 PNPOLY。然而，这给出了一些有趣的结果。下面是原始的 C 代码，下面是我为我的应用程序转换的代码......

原始C代码...

```
int pnpoly(int nvert, float *vertx, float *verty, float testx, float testy)
{
  int i, j, c = 0;
  for (i = 0, j = nvert-1; i < nvert; j = i++) {
    if ( ((verty[i]>testy) != (verty[j]>testy)) &&
     (testx < (vertx[j]-vertx[i]) * (testy-verty[i]) / (verty[j]-verty[i]) + vertx[i]) )
       c = !c;
  }
  return c;
} 
```

我的代码....

其中 wx 和 wy 是全局坐标。

```
int pnpoly(int nvert, vector<float> vertx, vector<float> verty, float testx, float testy)
{
  int i, j, c = 0;
  for (i = 0, j = nvert-1; i < nvert; j = i++) {
      if ( (( (verty.at(i)+wy) > testy) != ( (verty.at(j)+wy) >testy)) &&
        (testx < ((vertx.at(j)+wx) - (vertx.at(i)+wx) ) * (testy- (verty.at(i)+wy) ) / ( (verty.at(j)+wy) - (verty.at(i)+wy)) + (vertx.at(i)+wx)) )
       c++;
  }
  return c;
} 
```

我正在针对 2D 方形建筑测试玩家对象。这也会返回奇怪的结果，当我达到底线（xmin，ymin 到 xmax，ymin）它工作正常。如果我击中两边的 ethier（xmin，ymin 到 xmin，ymax 或 xmax，ymin 到 xmax，ymax），则仅当玩家距离起点点太远时它才会返回 1。同样在玩家进入边界框的一侧（xmin，ymin 到 xmin，ymax），尽管击中多边形，算法仍返回 2。在顶部，(xmin,ymax to xmax,ymax) 只有当玩家完全在多边形中时它才返回 1。

我还传递了来自 Building 对象的两个向量 x 和 y，向量大小为 int nvert。这可能与播放器对象的标题有关吗？在算法中是如何计算的？

# c - 投射到 LPCWSTR？

> ID：667616
> 
> 赞同：7
> 
> 时间：2009-03-20T19:27:42.200
> 
> 标签：c, windows, winapi, unicode

我正在尝试创建一个（非常）简单的 Win32 GUI 程序，但由于某种原因，编译器（我使用的是 VC++ 2008 Express）希望我手动将每个字符串或 char* 类型转换为 LPCWSTR：

每次执行此操作时都会出现此编译器错误，例如“Hello”和“Note”出现此错误：

错误 C2664：“MessageBoxW”：无法将参数 2 从“const char [22]”转换为“LPCWSTR”

请告诉我，我不必每次都这样做......

这是代码：

```
#include <windows.h>

int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, 
    LPSTR lpCmdLine, int nCmdShow)
{
    MessageBox(NULL, "Hello", "Note", MB_OK);
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-20T19:33:20.080

VS2008 中新项目的默认设置是构建支持 UNICODE 的应用程序。您可以更改该默认设置并返回使用 ANSI 或 MBCS 应用程序（属性->配置属性->常规->字符集），或使用 Unicode 字符串，如下所示：

```
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, 
    LPSTR lpCmdLine, int nCmdShow)
{
    MessageBox(NULL, L"Hello", L"Note", MB_OK);
    return 0;
} 
```

不要**将**字符串转换为 LPCWSTR，因为这会导致未定义的行为！char 与 wchar_t 不同！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T19:31:25.933

问题是您正在为 UNICODE 构建并且正在传递非 Unicode 字符串。

尝试：

```
MessageBox(NULL, L"Hello", L"Note", MB_OK); 
```

或为 ANSI/MBCS 设置您的构建或研究使用 TCHAR（这很痛苦）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T19:35:36.703

我对 Win32 C 编程的记忆很模糊，但我记得，你需要首先将你的字符串文字包装在这个宏中：

_T("我的字符串")

当您构建 unicode 时，这将被转换为 unicode 字符串。

如果您只构建 unicode，或者您确定您只处理 unicode 中的特定字符串，您可以使用 L"" 标记，这是 _T 宏在幕后所做的。

您可能需要包含 tchar.h 标头。

在进行 win32 编程时，我通常将字符串声明为 TCHAR * szWhatever，这样在 Win9x 上的工作几乎与 NT/Win2k/XP 一样。（其中还有其他方便的宏，如 LPTSTR 等，MFC 包含一些简单的转换宏，用于实际需要在 ansi 和 unicode 之间转换以调用特定 API 的情况）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T19:41:31.447

正如其他帖子所说，您正在构建一个 Unicode 应用程序。您可以在项目设置中切换到 Unicode 项目（不要忘记为“调试”和“发布”配置进行设置。

如果你想使用它，你必须在你所有的静态字符串前面加上 L：

```
L"Some static string" 
```

对于 char[] 字符串，有一个方法 mbstowcs_s，大致如下使用：

```
std::string str; // the string you want to convert

WCHAR wstr[128];
size_t convertedChars = sizeof(wstr)/sizeof(WCHAR);
mbstowcs_s(&convertedChars, wstr, str.c_str(), _TRUNCATE); 
```

这就是我在我的一个项目中使用它的方式。有关确切用法，请参阅[MSDN](http://msdn.microsoft.com/en-us/library/eyktyxsx(VS.80).aspx)。

# c# - 对 C# 对象数组和隐式类型转换感到困惑

> ID：667619
> 
> 赞同：0
> 
> 时间：2009-03-20T19:28:12.277
> 
> 标签：c#, arrays, object, type-conversion

我正在尝试将一个简单对象的数组传递给 Web 服务，但在我的 Web 客户端项目的编译过程中我真的遇到了这个错误：

无法将类型“TRIMBrokerUtil.MetaData[]”隐式转换为“TRIMBrokerASMXProxy.ASMXProxy.MetaData[]”

这是我编译到 TRIMBrokerUtil.dll 中的“实用程序”项目：

```
namespace TRIMBrokerUtil
{
    public class MetaData
    {
    protected string _Name;
    protected string _Value;
    public MetaData(string keyword, string setting) 
    {
        this.Name = keyword;
        this.Value = setting;
    }
    public string Name
    {
        get
        {
        return this._Name;
        }
        set
        {
        Name = value;
        }
    }
    public string Value
    {
        get
        {
        return this._Value;
        }
        set
        {
        _Value = value;
        }
    }
    } 
```

这是一个 Web 服务的片段，它也可以很好地编译： using TRIMBrokerUtil; 命名空间 TRIMBrokerService { [WebService(Namespace = " [http://tempuri.org/](http://tempuri.org/) ")] [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)] [ToolboxItem(false)] 公共类 FileService : System.Web.Services.WebService {

```
 [WebMethod]
    public string UploadFile(byte[] incomingArray
        , string FileName
        , long FileLengthInBytes
        , MetaData[] metaDataArray)
    { 
```

...以及以后的用法：

```
Update update = BuildMetaData(metaDataArray); 
```

...还有这个：

```
private Update BuildMetaData(MetaData[] nvPairs)
{
    Update update = new Update();
    InputProperty[] ip = new InputProperty[nvPairs.Length];
    int i;
    for (i=0; i < nvPairs.Length; i++)
    {
    ip[i].Name = "udf:" + nvPairs[i].Name;
    ip[i].Val = nvPairs[i].Value;
    }
    update.Items = ip;
    return update;
} 
```

接下来，（通过“添加 Web 引用”）我将我的 ASMX Web 服务代理类放在一个单独的项目中，它可以毫无问题地编译。在生成的 reference.cs 文件中，我发现这看起来不错：

```
 [System.Web.Services.Protocols.SoapDocumentMethodAttribute("http://tempuri.org/UploadFile", RequestNamespace="http://tempuri.org/", ResponseNamespace="http://tempuri.org/", Use=System.Web.Services.Description.SoapBindingUse.Literal, ParameterStyle=System.Web.Services.Protocols.SoapParameterStyle.Wrapped)]
    public string UploadFile([System.Xml.Serialization.XmlElementAttribute(DataType="base64Binary")] byte[] incomingArray, string FileName, long FileLengthInBytes, MetaData[] metaDataArray) {
        object[] results = this.Invoke("UploadFile", new object[] {
                    incomingArray,
                    FileName,
                    FileLengthInBytes,
                    metaDataArray});
        return ((string)(results[0]));
    } 
```

现在针对web客户端项目（default.aspx.cs）编译时出现的错误：

```
 using TRIMBrokerUtil;

public partial class _Default : System.Web.UI.Page
{
    private void UploadFile(HttpPostedFile postedFile
                , string fileNameOnly
                , MetaData[] metaDataArray)
    {
        string strURI = string.Empty;
        TRIMBrokerASMXProxy.ASMXProxy.FileService client = new TRIMBrokerASMXProxy.ASMXProxy.FileService();
        BinaryReader b = new BinaryReader(postedFile.InputStream);
        byte[] binData = b.ReadBytes(numBytes);
        TRIMBrokerASMXProxy.ASMXProxy.MetaData[] kvData = metaDataArray; // error complains about this line
        strURI = client.UploadFile(binData, fileNameOnly, binData.Length, kvData ); 
```

我还尝试将上面的最后两行更改为仅此一行：

```
strURI = client.UploadFile(binData, fileNameOnly, binData.Length, metaDataArray); 
```

...但是该更改引入了编译器的第二个错误，内容如下：

'TRIMBrokerASMXProxy.ASMXProxy.FileService.UploadFile(byte[], string, long, TRIMBrokerASMXProxy.ASMXProxy.MetaData[])' 的最佳重载方法匹配有一些无效参数

（注意关于“无法转换”的原始错误是第二个错误）。

很抱歉上面这么冗长。希望您能帮助阐明这种困惑。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T19:36:35.140

您正在尝试将 TRIMBrokerUtil.MetaData 数组分配给 TRIMBrokerASMXProxy.ASMXProxy.MetaData 数组。请记住，asp.net 代理声明了它自己的类型。

只需将数据复制到具有代理类型的新数组中即可。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T19:38:23.110

添加对 Web 服务的引用时，Visual Studio 将自动为用作 Web 服务功能参数的对象生成代码。这就是您的`TRIMBrokerASMXProxy.ASMXProxy.MetaData`课程的来源。

`TRIMBrokerUtil.MetaData`这和你的课不一样。您可以从`TRIMBrokerUtil`命名空间中删除该类，而只使用 Web 服务代理中的类。

# c# - web.config 中的多个版本的 Crystal Reports

> ID：667627
> 
> 赞同：1
> 
> 时间：2009-03-20T19:29:10.527
> 
> 标签：c#, asp.net, crystal-reports, web-config

在我们没有使用 Crystal Reports 之前。现在，在我们的项目中，我们已将 Crystal Reports 添加到我们的项目中。当我将我的项目转移到服务器时，它产生了一个 Crystal 错误。我怀疑服务器上没有安装 Crystal。然后在服务器上安装 Crystal 11。开发机器有Crystal 8.5。服务器在应用程序启动时产生此错误。

> “无法加载文件或程序集 'CrystalDecisions.ReportAppServer.ClientDoc, Version=10.2.3600.0, Culture=neutral, PublicKeyToken=692fbea5521e1304' 或其依赖项之一。系统找不到指定的文件。”

*   是否可以在 web.config 中有两个版本参考？（即水晶 8.5 和 11）

*   如何解决这个问题？

在开发环境中使用 C#、Visual Studio 2005 和 Crystal Reports 8.5。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-03-07T13:35:08.843

Best solution is installing same runtime on the server.
Anyway, you can use this XML in your app.config or web.config:

```
 <runtime> 
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="CrystalDecisions.CrystalReports.Engine" publicKeyToken="692fbea5521e1304" culture="neutral"/>
        <bindingRedirect oldVersion="xx.x.xxxx.x" newVersion="yy.y.yyyy.y"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="CrystalDecisions.Shared" publicKeyToken="692fbea5521e1304" culture="neutral"/>
        <bindingRedirect oldVersion="xx.x.xxxx.x" newVersion="yy.y.yyyy.y"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="CrystalDecisions.ReportSource" publicKeyToken="692fbea5521e1304" culture="neutral"/>
        <bindingRedirect oldVersion="xx.x.xxxx.x" newVersion="yy.y.yyyy.y"/>
      </dependentAssembly>
      <dependentAssembly>
        ...
    </assemblyBinding>
  </runtime> 
```

where **oldVersion** is the version you use for development and **newVersion** is the version installed on the server

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T19:35:57.420

这只是版本冲突，因为您的开发机器使用的是早期版本，当您尝试在服务器上运行它时，它正在寻找该版本的 .DLL 文件。您可能最好确保在您的开发机器和服务器上都安装了相同的版本，然后确保您的 web.config 在两者中都使用 Crystal 11 中的 DLL 文件。

现在的快速破解方法是找出服务器上正确的文件版本，并将该数字输入到 web.config 中。

编辑：另一个选项是更改服务器上 web.config 中 .DLL 的版本，这基本上就是其他人所说的。问题是每次部署时都必须不断更改它……这会很烦人。另外，您在开发机器上进行测试并不是真正有效的，因为您正在测试不同的程序。您几乎可以保证在生产中看到您在 DEV 中永远不会看到的错误，因为版本之间发生了一些变化。

您是否有某些原因无法在您的开发 PC 上安装 Crystal 11？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T19:37:05.513

您可能需要在项目中添加对该 DLL 的引用（或者将其放入您的 /bin 文件夹。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T19:37:19.257

错误消息说明了一切，您的服务器是否具有版本 10.2.3600.0 的 CrystalDecisions.ReportAppServer.ClientDoc，在 GAC 或您的应用程序或网站可以找到的某个地方具有匹配的令牌？

听起来您需要在服务器上进行配置更新。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-30T00:36:33.953

10.2.3600.0 是带有最新补丁的 Visual Studio 2005 中包含的 Crystal Reports 版本。

您需要在服务器上安装适用于 .net 2.0 的 Crystal Reports 运行时。您可以从开发机器获取运行时安装程序

x64 C:\Program Files (x86)\Microsoft Visual Studio 8\Crystal Reports\CRRedist\X64

x86 C:\Program Files (x86)\Microsoft Visual Studio 8\SDK\v2.0\BootStrapper\Packages\CrystalReports

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-07T00:20:22.940

不，不可能引用同一个命名程序集的两个不同版本。

完成这项工作的一种方法是拥有两个不同的 web.config 文件。一个用于开发，另一个用于生产。作为部署的一部分，只需使用文件的 prod 版本。如果您的部署是自动化的，这应该像删除 dev web.config 并在复制文件后重命名生产版本一样简单。

# c++ - 在 C++ 类中使用虚拟方法的性能成本是多少？

> ID：667634
> 
> 赞同：118
> 
> 时间：2009-03-20T19:30:37.933
> 
> 标签：c++, performance, virtual-functions

在 C++ 类（或其任何父类）中至少有一个虚拟方法意味着该类将有一个虚拟表，并且每个实例都有一个虚拟指针。

所以内存成本是很清楚的。最重要的是实例的内存成本（特别是如果实例很小，例如，如果它们只包含一个整数：在这种情况下，在每个实例中都有一个虚拟指针可能会使实例的大小加倍。至于虚拟表使用的内存空间，我想与实际方法代码使用的空间相比，它通常可以忽略不计。

这让我想到了我的问题：使方法虚拟化是否有可衡量的性能成本（即速度影响）？在运行时，每次方法调用都会在虚拟表中进行查找，所以如果对这个方法的调用非常频繁，并且如果这个方法很短，那么可能会对性能造成可测量的影响？我想这取决于平台，但有人运行过一些基准测试吗？

我问的原因是我遇到了一个错误，该错误恰好是由于程序员忘记定义虚拟方法所致。这不是我第一次看到这种错误。我想：为什么我们在需要时*添加*virtual 关键字，而不是在绝对确定不需要时*删除**virtual*关键字？如果性能成本低，我想我会在我的团队中简单地推荐以下内容：只需在每个类中默认将*每个*方法（包括析构函数）设为虚拟，并仅在需要时将其删除。你觉得这听起来很疯狂吗？

 *** * *

## 回答 #1

> 赞同：118
> 
> 时间：2009-03-20T19:43:26.607

我在一个 3ghz 有序的 PowerPC 处理器上[运行了一些计时。](https://web.archive.org/web/20210225014950/http://assemblyrequired.crashworks.org/how-slow-are-virtual-functions-really/)在该架构上，虚拟函数调用的成本比直接（非虚拟）函数调用长 7 纳秒。

因此，除非函数类似于普通的 Get()/Set() 访问器，否则不值得担心成本，其中除了 inline 之外的任何东西都是一种浪费。内联到 0.5ns 的函数的 7ns 开销是严重的；一个需要 500ms 执行的函数的 7ns 开销是没有意义的。

虚函数的最大成本并不是在 vtable 中查找函数指针（通常只是一个循环），而是间接跳转通常不能进行分支预测。这可能会导致大的流水线气泡，因为在间接跳转（通过函数指针的调用）退出并计算出新的指令指针之前，处理器无法获取任何指令。因此，虚函数调用的成本比从程序集中看起来要大得多……但仍然只有 7 纳秒。

**编辑：** Andrew、Not Sure 和其他人也提出了一个很好的观点，即虚函数调用可能会导致指令缓存未命中：如果你跳转到不在缓存中的代码地址，那么整个程序就会死机，而指令从主存中取出。这*总是*一个重要的停顿：在氙气灯上，大约 650 个周期（根据我的测试）。

但是，这不是虚拟函数特有的问题，因为如果您跳转到不在缓存中的指令，即使是直接函数调用也会导致未命中。重要的是该函数最近是否已运行（使其更有可能在缓存中），以及您的体系结构是否可以预测静态（非虚拟）分支并将这些指令提前获取到缓存中。我的 PPC 没有，但英特尔最新的硬件可能有。

我的时间控制了 icache 未命中对执行的影响（故意的，因为我试图单独检查 CPU 管道），所以他们打折了这个成本。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-20T19:44:25.293

调用虚函数时肯定有可测量的开销——调用必须使用 vtable 来解析该类型对象的函数地址。额外的说明是您最不必担心的。vtable 不仅会阻止许多潜在的编译器优化（因为编译器的类型是多态的），它们还会破坏您的 I-Cache。

当然，这些惩罚是否严重取决于您的应用程序、这些代码路径的执行频率以及您的继承模式。

不过，在我看来，默认情况下将所有内容都设为虚拟是对您可以通过其他方式解决的问题的一揽子解决方案。

也许你可以看看类是如何设计/记录/编写的。一般来说，一个类的标题应该非常清楚哪些函数可以被派生类覆盖以及它们是如何被调用的。让程序员编写此文档有助于确保它们被正确标记为虚拟。

我还要说，将每个函数声明为虚拟可能会导致更多错误，而不仅仅是忘记将某些东西标记为虚拟。如果所有功能都是虚拟的，那么一切都可以被基类取代——公共的、受保护的、私有的——一切都变得公平。偶然或有意的子类可能会改变函数的行为，这些行为在基础实现中使用时会导致问题。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-21T01:44:36.817

这取决于。:) （你还期待别的吗？）

一旦一个类获得了一个虚函数，它就不再是一个 POD 数据类型，（它可能以前也不是一个，在这种情况下这不会产生影响），这使得整个优化范围变得不可能。

普通 POD 类型上的 std::copy() 可以诉诸简单的 memcpy 例程，但必须更仔细地处理非 POD 类型。

由于必须初始化 vtable，因此构造变得慢了很多。在最坏的情况下，POD 和非 POD 数据类型之间的性能差异可能很大。

在最坏的情况下，您可能会看到 5 倍的执行速度（这个数字取自我最近为重新实现一些标准库类所做的一个大学项目。一旦它存储的数据类型得到一个虚拟表）

当然，在大多数情况下，您不太可能看到任何可衡量的性能差异，这只是指出在*某些*边界情况下，它可能代价高昂。

但是，性能不应该是您在这里的主要考虑因素。出于其他原因，将一切虚拟化并不是一个完美的解决方案。

允许在派生类中覆盖所有内容使得维护类不变量变得更加困难。当任何一个方法可以随时重新定义时，一个类如何保证它保持一致的状态？

将所有东西都虚拟化可能会消除一些潜在的错误，但也会引入新的错误。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-20T19:34:22.587

如果你需要虚拟调度的功能，你必须付出代价。C++ 的优点是您可以使用编译器提供的非常有效的虚拟调度实现，而不是您自己实现的可能效率低下的版本。

但是，如果您不需要x，则用开销使自己变得笨拙，这可能有点过分了。而且大多数类都不是为了继承而设计的——创建一个好的基类需要的不仅仅是使其函数虚拟化。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-01-26T07:27:31.637

虚拟调度比一些替代方案慢一个数量级——与其说是由于间接不如说是防止内联。下面，我通过对比虚拟调度与在对象中嵌入“类型（识别）编号”的实现并使用 switch 语句来选择特定于类型的代码来说明这一点。这完全避免了函数调用开销 - 只需进行本地跳转。通过类型特定功能的强制本地化（在开关中），可维护性、重新编译依赖项等存在潜在成本。

* * *

**执行**

```
#include <iostream>
#include <vector>

// virtual dispatch model...

struct Base
{
    virtual int f() const { return 1; }
};

struct Derived : Base
{
    virtual int f() const { return 2; }
};

// alternative: member variable encodes runtime type...

struct Type
{
    Type(int type) : type_(type) { }
    int type_;
};

struct A : Type
{
    A() : Type(1) { }
    int f() const { return 1; }
};

struct B : Type
{
    B() : Type(2) { }
    int f() const { return 2; }
};

struct Timer
{
    Timer() { clock_gettime(CLOCK_MONOTONIC, &from); }
    struct timespec from;
    double elapsed() const
    {
        struct timespec to;
        clock_gettime(CLOCK_MONOTONIC, &to);
        return to.tv_sec - from.tv_sec + 1E-9 * (to.tv_nsec - from.tv_nsec);
    }
};

int main(int argc)
{
  for (int j = 0; j < 3; ++j)
  {
    typedef std::vector<Base*> V;
    V v;

    for (int i = 0; i < 1000; ++i)
        v.push_back(i % 2 ? new Base : (Base*)new Derived);

    int total = 0;

    Timer tv;

    for (int i = 0; i < 100000; ++i)
        for (V::const_iterator i = v.begin(); i != v.end(); ++i)
            total += (*i)->f();

    double tve = tv.elapsed();

    std::cout << "virtual dispatch: " << total << ' ' << tve << '\n';

    // ----------------------------

    typedef std::vector<Type*> W;
    W w;

    for (int i = 0; i < 1000; ++i)
        w.push_back(i % 2 ? (Type*)new A : (Type*)new B);

    total = 0;

    Timer tw;

    for (int i = 0; i < 100000; ++i)
        for (W::const_iterator i = w.begin(); i != w.end(); ++i)
        {
            if ((*i)->type_ == 1)
                total += ((A*)(*i))->f();
            else
                total += ((B*)(*i))->f();
        }

    double twe = tw.elapsed();

    std::cout << "switched: " << total << ' ' << twe << '\n';

    // ----------------------------

    total = 0;

    Timer tw2;

    for (int i = 0; i < 100000; ++i)
        for (W::const_iterator i = w.begin(); i != w.end(); ++i)
            total += (*i)->type_;

    double tw2e = tw2.elapsed();

    std::cout << "overheads: " << total << ' ' << tw2e << '\n';
  }
} 
```

* * *

**性能结果**

在我的 Linux 系统上：

```
~/dev  g++ -O2 -o vdt vdt.cc -lrt
~/dev  ./vdt                     
virtual dispatch: 150000000 1.28025
switched: 150000000 0.344314
overhead: 150000000 0.229018
virtual dispatch: 150000000 1.285
switched: 150000000 0.345367
overhead: 150000000 0.231051
virtual dispatch: 150000000 1.28969
switched: 150000000 0.345876
overhead: 150000000 0.230726 
```

这表明内联类型数字切换方法的速度大约是 (1.28 - 0.23) / (0.344 - 0.23) = **9.2**倍。当然，这特定于经过测试的确切系统/编译器标志和版本等，但通常具有指示性。

* * *

**评论重新虚拟调度**

必须说，尽管虚函数调用开销很少是重要的，而且仅适用于经常调用的琐碎函数（如 getter 和 setter）。即使这样，您也可以提供一个函数来一次获取和设置很多东西，从而最大限度地降低成本。人们太担心虚拟调度——所以在找到尴尬的替代方案之前做分析。它们的主要问题是它们执行了一个离线函数调用，尽管它们也会使执行的代码离域，这会改变缓存利用模式（更好或更经常）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-20T20:19:57.597

在大多数情况下，额外的成本几乎没有。（原谅双关语）。ejac 已经发布了合理的相关措施。

您放弃的最大的事情是由于内联而可能进行的优化。如果使用常量参数调用函数，它们会特别好。这很少会产生真正的影响，但在少数情况下，这可能是巨大的。

* * *

关于优化：
了解和考虑语言结构的相对成本很重要。大 O 表示法只是故事的一半——*您的应用程序如何扩展*。另一半是它前面的常数因子。

根据经验，我不会特意避开虚函数，除非有明确而具体的迹象表明它是一个瓶颈。干净的设计永远是第一位的——但只有一个利益相关者不应该**过度**伤害他人。

* * *

人为的示例：一个包含一百万个小元素的数组上的空虚拟析构函数可能会遍历至少 4MB 的数据，从而破坏您的缓存。如果可以内联该析构函数，则不会触及数据。

在编写库代码时，这样的考虑远非为时过早。你永远不知道你的函数会有多少循环。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-22T17:08:27.150

虽然其他人对虚拟方法的性能等都是正确的，但我认为真正的问题是团队是否知道 C++ 中虚拟关键字的定义。

考虑这段代码，输出是什么？

```
#include <stdio.h>

class A
{
public:
    void Foo()
    {
        printf("A::Foo()\n");
    }
};

class B : public A
{
public:
    void Foo()
    {
        printf("B::Foo()\n");
    }
};

int main(int argc, char** argv)
{    
    A* a = new A();
    a->Foo();

    B* b = new B();
    b->Foo();

    A* a2 = new B();
    a2->Foo();

    return 0;
} 
```

这里没有什么令人惊讶的：

```
A::Foo()
B::Foo()
A::Foo() 
```

因为没有什么是虚拟的。如果在 A 和 B 类中都将 virtual 关键字添加到 Foo 的前面，我们将得到以下输出：

```
A::Foo()
B::Foo()
B::Foo() 
```

几乎是每个人所期望的。

现在，您提到存在错误，因为有人忘记添加虚拟关键字。所以考虑这段代码（virtual 关键字被添加到 A，而不是 B 类）。那么输出是什么？

```
#include <stdio.h>

class A
{
public:
    virtual void Foo()
    {
        printf("A::Foo()\n");
    }
};

class B : public A
{
public:
    void Foo()
    {
        printf("B::Foo()\n");
    }
};

int main(int argc, char** argv)
{    
    A* a = new A();
    a->Foo();

    B* b = new B();
    b->Foo();

    A* a2 = new B();
    a2->Foo();

    return 0;
} 
```

答：和B中加了virtual关键字一样吗？原因是 B::Foo 的签名与 A::Foo() 完全匹配，并且因为 A 的 Foo 是虚拟的，所以 B 的也是。

现在考虑 B 的 Foo 是虚拟的而 A 不是的情况。那么输出是什么？在这种情况下，输出是

```
A::Foo()
B::Foo()
A::Foo() 
```

virtual 关键字在层次结构中向下工作，而不是向上工作。它永远不会使基类方法成为虚拟的。第一次在层次结构中遇到虚方法是在多态性开始时。后面的类没有办法让前面的类具有虚拟方法。

不要忘记，虚拟方法意味着这个类正在让未来的类能够覆盖/改变它的一些行为。

**因此，如果您有删除 virtual 关键字的规则，它可能不会达到预期的效果。**

C++ 中的 virtual 关键字是一个强大的概念。您应该确保团队中的每个成员都真正了解这个概念，以便可以按设计使用它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-20T19:38:21.847

根据您的平台，虚拟呼叫的开销可能是非常不可取的。通过将每个函数声明为虚拟函数，您实际上是通过函数指针调用它们。至少这是一个额外的取消引用，但在某些 PPC 平台上，它将使用微编码或其他缓慢的指令来完成此操作。

出于这个原因，我建议您反对您的建议，但如果它可以帮助您防止错误，那么它可能值得权衡。不过，我不禁认为，一定有一些中间立场值得寻找。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-20T19:55:53.707

它只需要几个额外的 asm 指令来调用虚拟方法。

但我不认为你担心 fun(int a, int b) 与 fun() 相比有几个额外的“推送”指令。所以也不要担心虚拟，直到你处于特殊情况并看到它确实会导致问题。

PS如果你有一个虚拟方法，请确保你有一个虚拟析构函数。这样你就可以避免可能出现的问题

* * *

回应“xtofl”和“Tom”的评论。我做了 3 个功能的小测试：

1.  虚拟的
2.  普通的
3.  正常，带 3 个 int 参数

我的测试是一个简单的迭代：

```
for(int it = 0; it < 100000000; it ++) {
    test.Method();
} 
```

结果如下：

1.  3,913 秒
2.  3,873 秒
3.  3,970 秒

它是由 VC++ 在调试模式下编译的。我对每种方法只进行了 5 次测试并计算了平均值（因此结果可能非常不准确）......无论如何，假设 1 亿次调用，这些值几乎相等。并且具有 3 次额外推送/弹出的方法较慢。

要点是，如果您不喜欢与 push/pop 进行类比，请在代码中考虑额外的 if/else？当您添加额外的 if/else 时，您是否考虑 CPU 管道；-) 此外，您永远不知道代码将在哪个 CPU 上运行......通常的编译器可以生成对一个 CPU 更优化而对另一个 CPU 不太优化的代码（[英特尔C++ 编译器](http://en.wikipedia.org/wiki/Intel_C%2B%2B_Compiler)）

# python - 如何判断python中的连接是否已死

> ID：667640
> 
> 赞同：69
> 
> 时间：2009-03-20T19:31:50.160
> 
> 标签：python, sockets

我希望我的 python 应用程序能够判断另一侧的套接字何时被删除。有办法吗？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2013-03-02T13:35:25.890

简短的回答：

> 使用非阻塞的 recv()，或阻塞的 recv() / select()，超时时间很短。

长答案：

处理套接字连接的方法是根据需要读取或写入，并准备好处理连接错误。

TCP 区分“断开”连接的 3 种形式：超时、重置、关闭。

其中，超时并不能真正检测到，TCP 可能只会告诉你时间还没有到期。但即使它告诉你，时间也可能马上到期。

另请记住，您或您的对等方（连接的另一端）使用 shutdown() 可能只关闭传入字节流，并保持传出字节流运行，或关闭传出流并保持传入字节流运行。

所以严格来说，你要检查读取流是否关闭，或者写入流是否关闭，或者两者是否都关闭。

即使连接被“断开”，您仍然应该能够读取仍在网络缓冲区中的任何数据。只有在缓冲区为空后，您才会收到与 recv() 的断开连接。

检查连接是否断开就像问“读取当前缓冲的所有数据后我会收到什么？” 要找出这一点，您只需读取当前缓冲的所有数据。

我可以看到“读取所有缓冲数据”对于某些人来说可能是一个问题，他们仍然认为 recv() 是一个阻塞函数。使用阻塞recv()，当缓冲区已经为空时“检查”读取将阻塞，这违背了“检查”的目的。

在我看来，任何被记录为可能无限期阻塞整个过程的函数都是一个设计缺陷，但我想它仍然存在由于历史原因，从像普通文件描述符一样使用套接字时开始是一个很酷的想法。

你可以做的是：

*   将套接字设置为非阻塞模式，但您会得到一个与系统相关的错误，表明接收缓冲区为空，或者发送缓冲区已满
*   坚持阻塞模式，但设置一个非常短的套接字超时。这将允许您使用 recv()“ping”或“检查”套接字，这几乎是您想要做的
*   使用 select() 调用或 asyncore 模块，超时时间很短。错误报告仍然是系统特定的。

对于问题的写入部分，保持读取缓冲区为空几乎可以解决问题。在非阻塞读取尝试后，您会发现连接“断开”，并且您可以选择在读取返回关闭的通道后停止发送任何内容。

我想确保您发送的数据已到达另一端（并且不在发送缓冲区中）的唯一方法是：

*   在同一个套接字上接收您发送的确切消息的正确响应。基本上，您正在使用更高级别的协议来提供确认。
*   在套接字上执行成功的 shutdown() 和 close()

python socket howto 说如果通道关闭，send() 将返回写入的 0 个字节。您可以使用非阻塞或超时 socket.send() 如果它返回 0，则您不能再在该套接字上发送数据。但是如果它返回非零，你已经发送了一些东西，祝你好运:)

同样在这里，我没有考虑将 OOB（带外）套接字数据作为解决您的问题的一种手段，但我认为 OOB 不是您的意思。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-03-20T19:52:41.843

这取决于您所说的“丢弃”是什么意思。对于 TCP 套接字，如果另一端通过 close() 或进程终止关闭连接，您将通过读取文件末尾或收到读取错误来发现，通常将 errno 设置为任何“连接重置” peer' 由您的操作系统决定。对于 python，您将读取一个零长度的字符串，或者当您尝试从套接字读取或写入时会抛出一个 socket.error。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-20T19:50:20.320

从 Jweede 发布的链接中：

> 异常socket.timeout：
> 
> ```
> This exception is raised when a timeout occurs on a socket
> which has had timeouts enabled via a prior call to settimeout().
> The accompanying value is a string whose value is currently
> always “timed out”. 
> ```

[这是python文档](http://docs.python.org/library/socket.html#example)中socket模块的演示服务器和客户端程序

```
# Echo server program
import socket

HOST = ''                 # Symbolic name meaning all available interfaces
PORT = 50007              # Arbitrary non-privileged port
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind((HOST, PORT))
s.listen(1)
conn, addr = s.accept()
print 'Connected by', addr
while 1:
    data = conn.recv(1024)
    if not data: break
    conn.send(data)
conn.close() 
```

和客户：

```
# Echo client program
import socket

HOST = 'daring.cwi.nl'    # The remote host
PORT = 50007              # The same port as used by the server
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((HOST, PORT))
s.send('Hello, world')
data = s.recv(1024)
s.close()
print 'Received', repr(data) 
```

在我从中提取这些的文档示例页面上，有更复杂的示例采用了这个想法，但这里是简单的答案：

假设您正在编写客户端程序，只需将所有使用套接字的代码（当它有被丢弃的风险）放在 try 块中......

```
try:
    s.connect((HOST, PORT))
    s.send("Hello, World!")
    ...
except socket.timeout:
    # whatever you need to do when the connection is dropped 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-20T19:39:31.610

如果我没记错的话，这通常是通过[timeout](http://docs.python.org/library/socket.html)来处理的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-06-27T17:17:02.020

我将这篇博文中的代码示例翻译成 Python：[如何检测客户端何时关闭连接？](https://web.archive.org/web/20210430040842/https://stefan.buettcher.org/cs/conn_closed.html)，它对我很有效：

```
from ctypes import (
    CDLL, c_int, POINTER, Structure, c_void_p, c_size_t,
    c_short, c_ssize_t, c_char, ARRAY
)

__all__ = 'is_remote_alive',

class pollfd(Structure):
    _fields_ = (
        ('fd', c_int),
        ('events', c_short),
        ('revents', c_short),
    )

MSG_DONTWAIT = 0x40
MSG_PEEK = 0x02

EPOLLIN = 0x001
EPOLLPRI = 0x002
EPOLLRDNORM = 0x040

libc = CDLL('libc.so.6')

recv = libc.recv
recv.restype = c_ssize_t
recv.argtypes = c_int, c_void_p, c_size_t, c_int

poll = libc.poll
poll.restype = c_int
poll.argtypes = POINTER(pollfd), c_int, c_int

class IsRemoteAlive:  # not needed, only for debugging
    def __init__(self, alive, msg):
        self.alive = alive
        self.msg = msg

    def __str__(self):
        return self.msg

    def __repr__(self):
        return 'IsRemoteAlive(%r,%r)' % (self.alive, self.msg)

    def __bool__(self):
        return self.alive

def is_remote_alive(fd):
    fileno = getattr(fd, 'fileno', None)
    if fileno is not None:
        if hasattr(fileno, '__call__'):
            fd = fileno()
        else:
            fd = fileno

    p = pollfd(fd=fd, events=EPOLLIN|EPOLLPRI|EPOLLRDNORM, revents=0)
    result = poll(p, 1, 0)
    if not result:
        return IsRemoteAlive(True, 'empty')

    buf = ARRAY(c_char, 1)()
    result = recv(fd, buf, len(buf), MSG_DONTWAIT|MSG_PEEK)
    if result > 0:
        return IsRemoteAlive(True, 'readable')
    elif result == 0:
        return IsRemoteAlive(False, 'closed')
    else:
        return IsRemoteAlive(False, 'errored') 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-01-26T10:24:41.503

试图改进@kay 的响应。我做了一个更pythonic的版本

（请注意，它尚未在“真实”环境中进行测试，仅在 Linux 上）

这会检测远程端是否关闭了连接，而不实际使用数据：

```
import socket
import errno

def remote_connection_closed(sock: socket.socket) -> bool:
    """
    Returns True if the remote side did close the connection

    """
    try:
        buf = sock.recv(1, socket.MSG_PEEK | socket.MSG_DONTWAIT)
        if buf == b'':
            return True
    except BlockingIOError as exc:
        if exc.errno != errno.EAGAIN:
            # Raise on unknown exception
            raise
    return False 
```

* * *

这是来自 asyncio echo 服务器的一个简单示例：

```
import asyncio

async def handle_echo(reader, writer):
    addr = writer.get_extra_info('peername')
    sock = writer.get_extra_info('socket')
    print(f'New client: {addr!r}')

    # Initial of client command
    data = await reader.read(100)
    message = data.decode()

    print(f"Received {message!r} from {addr!r}")

    # Simulate a long async process
    for _ in range(10):
        if remote_connection_closed(sock):
            print('Remote side closed early')
            return
        await asyncio.sleep(1)

    # Write the initial message back
    print(f"Send: {message!r}")
    writer.write(data)
    await writer.drain()
    writer.close()

async def main():
    server = await asyncio.start_server(
        handle_echo, '127.0.0.1', 8888)

    addrs = ', '.join(str(sock.getsockname()) for sock in server.sockets)
    print(f'Serving on {addrs}')

    async with server:
        await server.serve_forever()

if __name__ == '__main__':
    asyncio.run(main()) 
```

# mysql - C 语言中的 MySQL 批量更新

> ID：667643
> 
> 赞同：1
> 
> 时间：2009-03-20T19:32:25.073
> 
> 标签：mysql, c

MySQL 的 C API 是否支持批量更新？我正在编写一个应用程序，其中某些事务被大批量处理。如果在记录过程中我最终为每个插入执行一个调用数据库，这将非常低效。

C 是否有类似于 Java 的用于批量 SQL 更新的 API 的东西？

谢谢，

N。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T20:05:58.097

您有几个选项可以帮助加快`INSERT`MySQL 的速度：

*   您可以准备一个查询并使用不同的值执行它。这比为插入的每一行准备和执行查询具有更少的开销。请参阅“ [C API 准备语句函数概述](http://dev.mysql.com/doc/refman/5.1/en/c-api-prepared-statement-function-overview.html)”。

*   `INSERT`您可以使用一条语句插入多行。请参阅“[插入语法](http://dev.mysql.com/doc/refman/5.1/en/insert.html)”。

*   借助 API 支持，您可以在一次调用中执行多个语句。请参阅“[对多语句执行的 C API 支持](http://dev.mysql.com/doc/refman/5.1/en/c-api-multiple-queries.html)”。

*   您绝对应该使用显式事务（假设您使用 InnoDB）来避免每行启动和提交事务的开销。

*   `INSERT`在“[插入语句的](http://dev.mysql.com/doc/refman/5.1/en/insert-speed.html)速度”中还有其他提高速度的技巧。

*   批量数据加载的最佳性能是通过`LOAD DATA INFILE`. 这可以比使用快二十倍`INSERT`。请参阅“[加载数据输入语法](http://dev.mysql.com/doc/refman/5.1/en/load-data.html)”。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-20T20:07:11.307

是的，即使它没有任何单独的功能。看看：
[http ://dev.mysql.com/doc/refman/5.0/en/c-api-multiple-queries.html](http://dev.mysql.com/doc/refman/5.0/en/c-api-multiple-queries.html)

您必须指定[mysql_real_query()](http://dev.mysql.com/doc/refman/5.0/en/mysql-real-query.html)应该解析多个由 ; 分隔的语句。提前，通过在连接或使用[mysql_set_server_option()](http://dev.mysql.com/doc/refman/5.0/en/mysql-set-server-option.html)时启用标志。

```
mysql_set_server_option(&mysql, MYSQL_OPTION_MULTI_STATEMENTS_ON); 
```

这就是 php 实现[mysqli_multi_query()](http://se2.php.net/mysqli_multi_query)的方式：

```
PHP_FUNCTION(mysqli_multi_query)
{
    // ...
    MYSQLI_ENABLE_MQ;
    if (mysql_real_query(mysql->mysql, query, query_len)) {
        // ...
        MYSQLI_DISABLE_MQ;
        // ...

        RETURN_FALSE;
    }
    RETURN_TRUE;
} 
```

MYSQLI_ENABLE_MQ 宏计算为我上面提供的代码。

# sql-server - SQL 服务器 | 对 int/smallint/tinyint 字段的按位运算

> ID：667647
> 
> 赞同：0
> 
> 时间：2009-03-20T19:35:21.447
> 
> 标签：sql-server, bit-manipulation

我想知道您是否可以对 SQL SERVER 中的 int/uint 字段进行按位运算？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T19:42:12.663

是的，您可以对 int/uint 字段进行按位运算。

例如，考虑一下：

```
declare @myvar int
set @myvar = 3
if ((@myvar & 2) = 2)
begin
   print 'hello'
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T19:51:21.643

是的，至少在 Transact-SQL 中可以。请参阅[Microsoft 的 SQL Server 文档](http://msdn.microsoft.com/en-us/library/ms176122.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T19:53:06.850

答案是肯定的！

仅仅因为它们被称为按位运算符，dopes 并不意味着它们仅对存储在 SQL Server“位”错字中的数据值进行操作。

所有数据都以位的形式存储在计算机中……因此您可以在多种类型上使用位运算符，包括任何整数类型 int、smallint、tinyint 等。

位运算符的使用不限于位类型值。

我不知道您是否可以在其他类型上使用它，但请尝试一下，看看会发生什么......

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-03-20T19:37:18.713

嗯....这是一个**BIT**，除了 0 或 1，您还想存储什么值？所以直接回答，不。

编辑。我回答了你的主题，而不是你的描述。请澄清问题。

# c# - web.config 批处理 =“假”

> ID：667653
> 
> 赞同：21
> 
> 时间：2009-03-20T19:37:07.027
> 
> 标签：c#, asp.net, vb.net, web-config, .net-1.1

在 ASP.NET 1.1 的编译标签中添加 batch="false" 的目的是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-20T19:54:54.067

MSDN 说批处理标志的用途

> 消除了第一次访问文件时需要编译造成的延迟。当此属性设置为 True 时，ASP.NET 会以批处理模式预编译所有未编译的文件，这会导致第一次编译文件时的延迟更长。然而，在这个初始延迟之后，编译延迟在随后的文件访问中被消除。

将其设置为 false 可能会使其第一次编译得更快，但随后的编译速度会变慢，我相信这也适用于 1.1。

[MSDN 链接](http://msdn.microsoft.com/en-us/library/s10awwz0.aspx)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-03-03T14:01:45.643

我知道这个问题已经结束（关于 v1.1），但在 .Net 2.0 及以后的版本中，批处理属性实际上默认为 True。

[http://msdn.microsoft.com/en-us/library/s10awwz0%28VS.80%29.aspx](http://msdn.microsoft.com/en-us/library/s10awwz0%28VS.80%29.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-20T19:54:17.643

在 asp.net 1.1 中，当你在“批处理模式”设置为 true 的情况下编译时，源文件的输出会根据目录、文件类型等编译成单个程序集。当“批处理模式”关闭时，输出是整个项目的单个程序集。

一些优点和缺点在[MSDN 文章的这一小段](http://msdn.microsoft.com/en-us/library/aa479312.aspx#issue29)中进行了描述。

> 使用此属性时应注意几个问题。
> 
> *   性能—当 Batch=false 时，ASP.NET 编译器将为您的 Web 应用程序中的每个 Web 窗体和用户控件创建一个程序集。当您使用 F5 构建时，它还会导致编译器在 Visual Studio 2005 中进行完全编译，而不是增量编译。最终结果是您的 Web 应用程序在部署时可能会运行得更慢，并且您的构建时间在 Visual Studio 2005 中会显着增加。
> *   程序集引用——Batch 属性可以隐藏潜在的损坏程序集引用（当 Batch=True 时），甚至引入循环引用（当 Batch=False 时）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T19:39:25.180

我相信默认值是 false（在 2.0+ 中），所以添加的重点`batch=false`是作为默认值的文档，或者作为占位符，所以如果你想要 true，很明显要改变什么。

# .net - 如何获取 ASP.NET 控制字符串属性以在设计器下拉列表中显示建议列表？

> ID：667681
> 
> 赞同：0
> 
> 时间：2009-03-20T19:43:37.107
> 
> 标签：.net, asp.net, designer

如何向我的 ASP.NET 自定义控件添加一个字符串属性，这将导致设计器（在 HTML 视图或所见即所得视图中）通过提供大约 30 个建议字符串的列表来提供自动完成功能，同时允许自定义字符串输入？

现在我正在使用枚举类型的属性来允许用户从列表中进行选择，但字符串必须是有效的枚举值名称，并且它们必须是 URI。此外，它不允许输入自定义字符串。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T19:48:26.533

看`TypeConverter`。

您将需要覆盖`GetStandardValues`和`GetStandardValuesSupported`。您可以在运行时随心所欲地满足这种需求。

# c# - Visual Studio 中的项目依赖项

> ID：667685
> 
> 赞同：0
> 
> 时间：2009-03-20T19:45:36.167
> 
> 标签：c#, .net, visual-studio-2008, dependencies

我在解决方案 WinSync 中有三个项目。我有 WinSyncGui、WinSyncLib 和安装程序。WinSyncGui 需要来自 WinSyncLib 的文件。如何让它在 WinSyncGui 中包含 WinSyncLib？

VS 抱怨找不到类型或命名空间名称“WinSyncLib”（您是否缺少 using 指令或程序集引用？）

我已经设置了依赖项，以便 WinSyncGui 依赖于 WinSyncLib（因此首先构建了 Lib），但它仍然无法正常工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-20T19:47:49.623

右键单击您的项目 (WebSyncGui) 并选择 Add Reference，Projects 选项卡，然后选择您需要引用的项目。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T19:47:41.573

您需要在 WinSyncGui 项目中添加 WinSyncLib 作为参考。

[添加项目引用。](http://msdn.microsoft.com/en-us/library/wkze6zky(VS.80).aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-20T19:48:22.493

> 我已经设置了依赖项

这听起来不对。您设置了“依赖项”还是设置了“引用”。依赖关系只是确定构建顺序，引用用于链接项目。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T19:48:34.753

您确定所有类型都是公开的吗？如果省略修饰符，则默认为内部。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-03-10T07:17:52.763

右键单击解决方案，选择`Project dependencies`并设置任何您想要的依赖项。例如，当您在一个解决方案中有两个 exe 文件时，它很有用。添加另一个 exe 作为参考很奇怪，所以我使用此选项首先构建依赖的可执行文件，然后构建后事件将其复制到目标目录中。很实用的玩具。

[![在此处输入图像描述](https://i.stack.imgur.com/HRmBb.png)](https://i.stack.imgur.com/HRmBb.png)

# .net - 在 Silverlight 和“plain vanilla”.Net 之间共享程序集

> ID：667686
> 
> 赞同：6
> 
> 时间：2009-03-20T19:45:55.213
> 
> 标签：.net, wcf, silverlight

我正在使用一些通用类作为数据容器，并使用它们将数据传入和传出 wcf 服务。由于 WCF 将客户端上的通用名称修改为名为“ListOfBlah231546797646”之类的类的方式，我将添加对真实程序集的引用作为“KnownType”。

Silverlight 需要使用这些服务，但只能引用“silverlight 程序集”。我已将这些类移动到它们自己的“silverlight 程序集”，并且可以从 silverlight 引用它们，但是当服务运行时，我在 System.Runtime.Serialization 程序集上收到“找不到引用的程序集”错误。

事实证明，Silverlight 有自己的一组二进制文件，都标有 2.0.5.0 版本。这些不在服务的 GAC 中，因此会引发异常。

因此，我无法从我的服务代码中引用我的“Silverlight 程序集”。有什么办法可以解决这个问题，使两种口味在序列化时交叉兼容？

这个问题很相似，但没有一个答案有帮助。有任何想法吗？ [类似的问题](https://stackoverflow.com/questions/274952/sharing-service-interfaces-and-model-in-silverlight-using-wcf)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-23T01:44:44.100

我在 Silverlight 和普通 CLR 之间共享代码的方式是在 C# 项目中使用“添加为链接”功能。所以它最终看起来像这样：

```
| SilverlightLib
|   File1.cs
|   File2.cs
| ClrLib
|   File1.cs <as link>
|   File2.cs <as link> 
```

然后 VS 工作正常，两组代码都被编译。令人讨厌的部分是 Silverlight 框架没有对齐的地方。（WCF 有一些在 SL 中不存在的部分。）在这种情况下，您需要使用预处理器“#if SILVERLIGHT”来使代码面向两个平台。

到目前为止，这工作得很好。这样，我可以编写代码，使用 VSTS 进行测试，但仍然可以从同一来源在 SL 上运行。一些提示：

*   始终从 SL 项目进行编辑——这样编辑器将限制为 SL，以后不会有意外。
*   有时您必须关闭打开的文件，Intellisense 才能在另一个项目中更新。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T19:59:30.000

我过去有两种方法。

首先也是最简单的。将 WCF 服务作为 ServiceReference 添加到 Silverlight。这将负责重新生成所有类库并在需要时刷新它们。

其次，存储两个类的副本，一个在 silverlight 中，一个在 .net 3.5 clr 中。然后确保 DataContract 名称和命名空间匹配。如果您在 silverlight 中添加 ServiceReference，然后在资源管理器中查看 ServiceReference 文件夹并查看 Reference.cs 文件，您将看到生成的类并可以复制这些类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T18:33:32.693

不确定在您的场景中是否可行，但您是否考虑过将序列化为 Json 的对象提供给 Silverlight 客户端？然后在您的 silverlight 应用程序中，您可以在 silverlight 中使用[JsonObject](http://msdn.microsoft.com/en-us/library/system.json.jsonobject(VS.95).aspx)。这样您就可以避免在您的 silverlight 应用程序中使用另一组模型对象。

```
JsonObject user = (JsonObject)JsonObject.Load(responseStream);
bool isMember = user["IsMember"];
string name = user["Name"];
int age = user["Age"]; 
```

该示例来自[此 msdn 示例](http://msdn.microsoft.com/en-us/library/cc197957(VS.95).aspx)

这种方法的好处还在于您在 silverlight 中具有 linq 支持，并且您的 ajax 客户端也可以使用它。它也比将您的真实对象暴露给客户端上运行的 silverlight 应用程序更安全。

# ruby - 使用 Hpricot (Ruby) 解析 HTML 表格

> ID：667697
> 
> 赞同：0
> 
> 时间：2009-03-20T19:48:27.703
> 
> 标签：ruby, parsing, hpricot

我正在尝试使用 Hpricot 解析 HTML 表格，但被卡住了，无法从具有指定 ID 的页面中选择表格元素。

这是我的红宝石代码：-

```
require 'rubygems'
require 'mechanize'
require 'hpricot'

agent = WWW::Mechanize.new

page = agent.get('http://www.indiapost.gov.in/pin/pinsearch.aspx')

form = page.forms.find {|f| f.name == 'form1'}
form.fields.find {|f| f.name == 'ddl_state'}.options[1].select
page = agent.submit(form, form.buttons[2])

doc = Hpricot(page.body)

puts doc.to_html # Here the doc contains the full HTML page

puts doc.search("//table[@id='gvw_offices']").first # This is NIL 
```

谁能帮我确定这有什么问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T20:40:00.060

Mechanize 将在内部使用 hpricot（它是 mechanize 的默认解析器）。更重要的是，它会将 hpricot 的东西传递给解析器，所以你不必自己做：

```
require 'rubygems'
require 'mechanize'

#You don't really need this if you don't use hpricot directly
require 'hpricot'

agent = WWW::Mechanize.new

page = agent.get('http://www.indiapost.gov.in/pin/pinsearch.aspx')

form = page.forms.find {|f| f.name == 'form1'}
form.fields.find {|f| f.name == 'ddl_state'}.options[1].select
page = agent.submit(form, form.buttons[2])

puts page.parser.to_html # page.parser returns the hpricot parser

puts page.at("//table[@id='gvw_offices']") # This passes through to hpricot 
```

另请注意，`page.search("foo").first`相当于`page.at("foo")`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T10:47:38.833

请注意，在更高版本（0.9.0）中，Mechanize 默认不再使用 Hpricot（它使用 Nokogiri），您必须明确指定 Hpricot 才能继续使用：

```
 WWW::Mechanize.html_parser = Hpricot 
```

就像这样，Hpricot 周围没有引号或任何东西 - 可能有一个您可以为 Hpricot 指定的模块，因为如果您将此语句放在您自己的模块声明中，它将不起作用。这是在课堂上做到这一点的最佳方法（在打开模块或课堂之前）

```
require 'mechanize'
require 'hpricot'

# Later versions of Mechanize no longer use Hpricot by default
# but have an attribute we can set to use it
begin
  WWW::Mechanize.html_parser = Hpricot
rescue NoMethodError
  # must be using an older version of Mechanize that doesn't
  # have the html_parser attribute - just ignore it since 
  # this older version will use Hpricot anyway
end 
```

通过使用救援块，您可以确保如果他们确实有旧版本的 mechanize，它不会因不存在的 html_parser 属性而烦恼。（否则你需要让你的代码依赖于最新版本的 Mechanize）

同样在最新版本中，不推荐使用 WWW::Mechanize::List。不要问我为什么，因为它完全破坏了语句的向后兼容性，例如

```
page.forms.name('form1').first 
```

这曾经是一个常见的习惯用法，因为 Page#forms 返回了一个具有“名称”方法的机械化列表。现在它返回一个简单的表单数组。

我发现这一点很困难，但是您的用法会起作用，因为您使用`find`的是数组方法。

但是查找具有给定名称的第一个表单的更好方法是`Page#form`使您的表单查找行变为

```
form = page.form('form1') 
```

此方法适用于旧版本和新版本。

# ruby - 网络上最活跃的 Ruby 论坛/博客是什么？

> ID：667711
> 
> 赞同：4
> 
> 时间：2009-03-20T19:52:58.143
> 
> 标签：ruby, user-forums

我刚刚在 Ruby 上度过了 2 天，我在过去两天的观察是，很难（与 .NET/Java 相比）找到一个对 Ruby 有帮助的活跃论坛/博客（或者我可能没有）不认识他们，因为我是新人）。

开发人员在需要 Ruby 方面的帮助时最常访问哪些论坛/博客（Stack Overflow 除外）？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-20T19:58:50.813

您最好的选择是 irc.freenode.net 上的以下 IRC 频道。很活跃。

#rubyonrails

#ruby 语言

＃红宝石

您几乎总能在几分钟内得到答案。有一种礼仪要遵守，如果你不遵守，他们会变得暴躁，但我认为主要是因为一些主要的回答者坐在那里几个小时回答一个又一个问题，他们希望你以某种方式表达事情这使他们能够高效。

这里有一些不错的博客：

[错误博客](http://errtheblog.com/)

[Jamis Buck 的博客（Capistrano 的作者，使用 DHH 为 37 Signals 工作）](http://weblog.jamisbuck.org/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-20T20:05:16.430

ruby-talk 邮件列表很有帮助，每天可以收到 70-100 条消息。

[http://www.ruby-lang.org/en/community/mailing-lists/](http://www.ruby-lang.org/en/community/mailing-lists/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T08:42:51.367

Ruby 博客太多了，我就不在这里一一列举了。[www.ruby-forum.com](http://www.ruby-forum.com)有很多帖子，如果你喜欢 rails 的东西[www.railsforum.com](http://www.railsforum.com)非常活跃，[www.pragprog.com](http://www.pragprog.com)有很多很棒的 ruby​​ 书籍出售，包括 Programming Ruby，被广泛接受为第一本学习 Ruby 的书，无论好坏。RubyInside，RufyFlow 很棒，但是[Ruby Learning](http://rubylearning.com/blog/2009/03/12/50-ruby-related-blogs-to-read/)网站上的博客列表很好，如果你需要 Ruby API 文档[Ruby Brain](http://www.rubybrain.com)，如果你正在做 Rails，那么[Rails Brain](http://www.railsbrain.com)也很好，虽然我真的没有卢布出现 Ruby 的东西通过搜索谷歌，但东西应该让你继续前进一段时间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-04-07T05:25:29.263

Shameless plug, but here's a good resource: [http://www.postrank.com/topic/ruby](http://www.postrank.com/topic/ruby)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-20T19:56:49.010

如果您正在使用 Rails，RailsCasts 非常棒。

对于普通的 Ruby，我只是在谷歌上搜索并找到大部分内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-22T06:33:25.007

对于 Ruby on Rails，我更喜欢 [http://www.workingwithrails.com/](http://www.workingwithrails.com/)

如果您有任何关于 RoR 的问题，您可以使用“询问 Rails 专家”论坛，如果您想与其他 RoR 开发人员讨论，您可以参加“工作场所中的 Rails”论坛。

希望这可以帮助。

[ [http://www.workingwithrails.com/]http://www.workingwithrails.com/](http://www.workingwithrails.com/]http://www.workingwithrails.com/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-21T12:00:06.947

我将添加一些我认为对于真正对 Ruby 感兴趣的人来说必须的博客：

[后退一步](http://onestepback.org/index.cgi)
[has_many :through](http://blog.hasmanythrough.com/)
[On Ruby](http://on-ruby.blogspot.com/)
[Igvita](http://www.igvita.com/)

还有更多我个人认为有趣的个人博客，但这 4 个对任何对语言本身感兴趣的人都有好处。

除此之外，ruby-talk / ruby​​-forum 是闲逛的好地方，如果您需要任何帮助，您可以随时访问 irc.freenode.net 中的#ruby-lang

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-21T12:05:01.193

你可以看看这些链接：

*   [http://rubylearning.com/](http://rubylearning.com/)
*   [http://www.railsenvy.com/](http://www.railsenvy.com/)
*   [http://rubyflow.com/](http://rubyflow.com/)
*   [http://peepcode.com/](http://peepcode.com/)
*   [http://www.rubyinside.com/](http://www.rubyinside.com/)
*   [http://www.ruby-lang.org/en/](http://www.ruby-lang.org/en/)
*   [http://guides.rubyonrails.org/](http://guides.rubyonrails.org/)
*   [http://www.digitalmediaminute.com/article/1816/top-ruby-on-rails-tutorials](http://www.digitalmediaminute.com/article/1816/top-ruby-on-rails-tutorials)

# asp.net-mvc - 替换使用 ASP.MVC Ajax

> ID：667714
> 
> 赞同：1
> 
> 时间：2009-03-20T19:53:07.723
> 
> 标签：asp.net-mvc

我有以下 ajax 表单标签：

当表单被提交时，控制器返回一个包含完整行的部分以插入到表中（同样的部分也用于首先呈现表）。

这个想法是，在用户编辑一个项目后，该项目在表中的行将被替换为部分的更新版本。当我将 UpdateTargetId 指向一个`<div>`元素时，它似乎工作正常，但是当我将它指向一个`<tr>`元素时，它就不行了。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T20:07:35.177

我假设您的部分实际上呈现了整行。在这种情况下，默认替换语义将不适用于`<tr>`元素，因为您将在现有行中插入新行并获得类似：

```
<tr><tr>...new contents</tr></tr> 
```

您可能想查看更改 InsertionMode（我忘记了其他可能的选项）或让您的部分仅生成行内容，即`<td>`元素而不是行本身。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T02:10:10.173

我最终改变了我的方法。我更改了控制器以在 jason 中返回对象的值，并让视图的 js 函数简单地使用新值更新表格行的内容。现在似乎工作正常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T13:30:17.913

Rich Strahl 有一篇关于如何[使用 jQuery 进行客户端模板](http://www.west-wind.com/Weblog/posts/509108.aspx)化的优秀文章。

# c++ - Makefile 的标准 F90 库

> ID：667716
> 
> 赞同：2
> 
> 时间：2009-03-20T19:53:14.913
> 
> 标签：c++, makefile, fortran

大家好，

尝试使用 g++ 进行编译，并且需要为我的 Makefile 中的一些 fortran 源代码链接标准 f90（甚至 f77）库。我在任何地方都找不到它的名字。

制造商文件：

```
products: SlowDynamic.exe

SlowDynamic.exe: main.o SA.o mersenne.o CFE.o BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o MA_57.o blas.o MA_57_Depend.o Metis.o
    g++ -L/usr/sfw/lib -R/usr/sfw/lib -lgcc_s -lstdc++ -o SlowDynamic.exe main.o \
        SA.o mersenne.o CFE.o MA_57.o blas.o MA_57_Depend.o Metis.o\
        BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o

main.o: main.cpp
    g++ -c -o main.o main.cpp

SA.o: SA.cpp
    g++ -c -o SA.o SA.cpp

mersenne.o: mersenne.cpp
    g++ -c -o mersenne.o mersenne.cpp

CFE.o: CFE.c
    gcc -c -o CFE.o CFE.c

MA_57.o: MA_57.f
    f77 -c -o MA_57.o MA_57.f

blas.o: blas.f
    f77 -c -o blas.o blas.f

MA_57_Depend.o: MA_57_Depend.f
    f77 -c -o MA_57_Depend.o MA_57_Depend.f

Metis.o: Metis.f
    f77 -c -o Metis.o Metis.f

BCs.o: BCs.c
    gcc -c -o BCs.o BCs.c

EMatrix.o: EMatrix.c
    gcc -c -o EMatrix.o EMatrix.c

Numbering.o: Numbering.c
    gcc -c -o Numbering.o Numbering.c

KMatrix.o: KMatrix.c
    gcc -c -o KMatrix.o KMatrix.c

Solve.o : Solve.c
    gcc -c -o Solve.o Solve.c

clean: 
    rm *.o Main.exe *.gpi 
```

编译器：

```
birch $ make
mksh: Warning: newline is not last character in file Makefile
Current working directory /u/f/osv20/Y4-UNIX/complete
g++ -L/usr/sfw/lib -R/usr/sfw/lib -lgcc_s -o SlowDynamic.exe main.o \
        SA.o mersenne.o CFE.o MA_57.o blas.o MA_57_Depend.o Metis.o\
        BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o
Undefined                       first referenced
 symbol                             in file
__f90_sfw_i4                        MA_57.o
__f90_sfw_ch                        MA_57.o
__f90_sfw_r4                        MA_57.o
__f90_ifw_ch                        MA_57.o
__f90_ifw_r4                        MA_57.o
__nintf                             MA_57.o
__s_cmp                             blas.o
__r_sign                            MA_57_Depend.o
__f90_sifw                          MA_57.o
__f90_ssfw                          MA_57.o
__f90_stop                          blas.o
__f90_esfw                          MA_57.o
__f90_eifw                          MA_57.o
ld: fatal: Symbol referencing errors. No output written to SlowDynamic.exe
collect2: ld returned 1 exit status
*** Error code 1
make: Fatal error: Command failed for target `SlowDynamic.exe' 
```

运行“f77 -v hello.f”的结果

```
amos $ f77 -v hello.f
NOTICE: Invoking /usr/bin/f90 -f77 -ftrap=%none -v hello.f
###     command line files and options (expanded):
### -f77=%all -ftrap=%none -v hello.f -lf77compat
### f90: Note: NLSPATH = /opt/SUNWspro/prod/bin/../lib/locale/%L/LC_MESSAGES/%N.cat:/opt/SUNWspro/prod/bin/../../lib/locale/%L/LC_MESSAGES/%N.cat
/opt/SUNWspro/prod/bin/f90comp -y-o -yhello.o -ev -y-ftrap=%none -m3 -dq -y-fbe -y/opt/SUNWspro/prod/bin/fbe -y-xarch=generic -y-s -H "/opt/SUNWspro/prod/bin/f90 -f77 -ftrap=%none -v " -y-xcache=generic -xcache=generic -I/opt/SUNWspro/prod/include/f95/v8 -p/opt/SUNWspro/prod/lib/modules -y-verbose -xall -xmemalign=8i -y-xmemalign=8i -f77=%all -y-xdbggen=no%stabs+dwarf2 -y-xdbggen=incl -xassume_control=optimize -y-xassume_control=optimize -iorounding=processor-defined -xhasc=yes hello.f
hello.f:
 MAIN hellow:
### f90: Note: LD_LIBRARY_PATH = (null)
### f90: Note: LD_RUN_PATH     = (null)
### f90: Note: LD_OPTIONS = (null)
/usr/ccs/bin/ld -t -R/opt/SUNWspro/lib/sparc:/opt/SUNWspro/lib -o a.out /opt/SUNWspro/prod/lib/crti.o /opt/SUNWspro/prod/lib/crt1.o /opt/SUNWspro/prod/lib/misalign.o /opt/SUNWspro/prod/lib/values-xi.o -Y P,/opt/SUNWspro/lib/sparc:/opt/SUNWspro/prod/lib/sparc:/opt/SUNWspro/lib:/opt/SUNWspro/prod/lib:/usr/ccs/lib:/lib:/usr/lib hello.o -lf77compat -lfui -lfai -lfai2 -lfsumai -lfprodai -lfminlai -lfmaxlai -lfminvai -lfmaxvai -lfsu -lsunmath -Bdynamic -lmtsk -lm -lc /opt/SUNWspro/prod/lib/crtn.o
rm hello.o 
```

运行“f90 -v hello.f”的结果

```
amos $ f90 -v hello.f
###     command line files and options (expanded):
### -v hello.f
### f90: Note: NLSPATH = /opt/SUNWspro/prod/bin/../lib/locale/%L/LC_MESSAGES/%N.cat:/opt/SUNWspro/prod/bin/../../lib/locale/%L/LC_MESSAGES/%N.cat
/opt/SUNWspro/prod/bin/f90comp -y-o -yhello.o -ev -y-ftrap=common -m3 -dq -y-fbe -y/opt/SUNWspro/prod/bin/fbe -y-xarch=generic -y-s -H "/opt/SUNWspro/prod/bin/f90 -v " -y-xcache=generic -xcache=generic -I/opt/SUNWspro/prod/include/f95/v8 -p/opt/SUNWspro/prod/lib/modules -y-verbose -xall -xmemalign=8i -y-xmemalign=8i -y-xdbggen=no%stabs+dwarf2 -y-xdbggen=incl -xassume_control=optimize -y-xassume_control=optimize -iorounding=processor-defined -xhasc=yes hello.f
### f90: Note: LD_LIBRARY_PATH = (null)
### f90: Note: LD_RUN_PATH     = (null)
### f90: Note: LD_OPTIONS = (null)
/usr/ccs/bin/ld -t -R/opt/SUNWspro/lib/sparc:/opt/SUNWspro/lib -o a.out /opt/SUNWspro/prod/lib/crti.o /opt/SUNWspro/prod/lib/crt1.o /opt/SUNWspro/prod/lib/misalign.o /opt/SUNWspro/prod/lib/values-xi.o -Y P,/opt/SUNWspro/lib/sparc:/opt/SUNWspro/prod/lib/sparc:/opt/SUNWspro/lib:/opt/SUNWspro/prod/lib:/usr/ccs/lib:/lib:/usr/lib hello.o -lfui -lfai -lfai2 -lfsumai -lfprodai -lfminlai -lfmaxlai -lfminvai -lfmaxvai -lfsu -lsunmath -Bdynamic -lmtsk -lm -lc /opt/SUNWspro/prod/lib/crtn.o
rm hello.o 
```

使用 f77 成功编译的结果：

```
amos $ make
mksh: Warning: newline is not last character in file Makefile
Current working directory /u/f/osv20/Y4-UNIX/complete
g++ -c -o main.o main.cpp
In file included from main.cpp:16:
SA.h:85:9: warning: no newline at end of file
main.cpp:38:2: warning: no newline at end of file
g++ -c -o SA.o SA.cpp
In file included from SA.cpp:22:
SA.h:85:9: warning: no newline at end of file
In file included from SA.cpp:23:
CFE.h:25:8: warning: no newline at end of file
SA.cpp:468:4: warning: no newline at end of file
g++ -c -o mersenne.o mersenne.cpp
gcc -c -o CFE.o CFE.c
In file included from BCs.h:9,
                 from CFE.c:29:
fg_types.h:38:7: warning: no newline at end of file
In file included from CFE.c:29:
BCs.h:15:84: warning: no newline at end of file
In file included from CFE.c:32:
KMatrix.h:12:171: warning: no newline at end of file
In file included from CFE.c:34:
Solve.h:9:91: warning: no newline at end of file
CFE.c: In function `CFE':
CFE.c:145: warning: `return' with a value, in function returning void
gcc -c -o BCs.o BCs.c
In file included from BCs.h:9,
                 from BCs.c:9:
fg_types.h:38:7: warning: no newline at end of file
In file included from BCs.c:9:
BCs.h:15:84: warning: no newline at end of file
BCs.c:74:2: warning: no newline at end of file
gcc -c -o EMatrix.o EMatrix.c
In file included from EMatrix.h:9,
                 from EMatrix.c:9:
fg_types.h:38:7: warning: no newline at end of file
EMatrix.c:78:2: warning: no newline at end of file
gcc -c -o Numbering.o Numbering.c
In file included from Numbering.h:8,
                 from Numbering.c:8:
fg_types.h:38:7: warning: no newline at end of file
Numbering.c:144:3: warning: no newline at end of file
gcc -c -o KMatrix.o KMatrix.c
In file included from KMatrix.h:8,
                 from KMatrix.c:9:
fg_types.h:38:7: warning: no newline at end of file
In file included from KMatrix.c:9:
KMatrix.h:12:171: warning: no newline at end of file
KMatrix.c:194:2: warning: no newline at end of file
gcc -c -o Solve.o Solve.c
In file included from Solve.c:8:
Solve.h:9:91: warning: no newline at end of file
Solve.c:95:2: warning: no newline at end of file
f77 -c -o MA_57.o MA_57.f
NOTICE: Invoking /usr/bin/f90 -f77 -ftrap=%none -c -o MA_57.o MA_57.f
MA_57.f:
        ma57i:
        ma57a:
        ma57b:
        ma57c:
        ma57q:
        ma57r:
        ma57u:
        ma57s:
        ma57t:
        ma57d:
        ma57e:
        ma57g:
        ma57j:
        ma57k:
        ma57f:
        ma57l:
        ma57m:
        ma57n:
        ma57o:
        ma57p:
        ma57w:
        ma57x:
        ma57y:
        ma57v:
        ma57h:
        ma57z:
f77 -c -o blas.o blas.f
NOTICE: Invoking /usr/bin/f90 -f77 -ftrap=%none -c -o blas.o blas.f
blas.f:
        sgemm:
        stpsv:
        isamax:
        xerbla:
        lsame:
        sgemv:
f77 -c -o MA_57_Depend.o MA_57_Depend.f
NOTICE: Invoking /usr/bin/f90 -f77 -ftrap=%none -c -o MA_57_Depend.o MA_57_Depend.f
MA_57_Depend.f:
        mc47a:
        mc47b:
        mc71a:
        mc34a:
        mc59a:
        mc59b:
        mc59c:
        mc59d:
        mc59e:
        mc59f:
        ma27i:
        ma27a:
        ma27b:
        ma27c:
        ma27g:
        ma27h:
        ma27u:
        ma27j:
        ma27k:
        ma27l:
        ma27m:
        ma27n:
        ma27o:
        ma27p:
        ma27q:
        ma27r:
        mc64i:
        mc64a:
        mc64b:
        mc64d:
        mc64e:
        mc64f:
        mc64r:
        mc64s:
        mc64q:
        mc64u:
        mc64w:
        mc21a:
        mc21b:
        fd15a:
f77 -c -o Metis.o Metis.f
NOTICE: Invoking /usr/bin/f90 -f77 -ftrap=%none -c -o Metis.o Metis.f
Metis.f:
        metis_nodend:
f77 -L/usr/sfw/lib -R/usr/sfw/lib -lgcc_s -lstdc++ -o SlowDynamic.exe main.o \
        SA.o mersenne.o CFE.o MA_57.o blas.o MA_57_Depend.o Metis.o\
        BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o
NOTICE: Invoking /usr/bin/f90 -f77 -ftrap=%none -L/usr/sfw/lib -R/usr/sfw/lib -lgcc_s -lstdc++ -o SlowDynamic.exe main.o SA.o mersenne.o CFE.o MA_57.o blas.o MA_57_Depend.o Metis.o BCs.o EMatrix.o Numbering.o KMatrix.o Solve.o 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T01:49:04.823

您使用的是什么版本的 GCC？GCC 中的 fortran 编译器随着时间的推移发生了彻底的变化（g77 vs gfortran）——所以正确的答案非常依赖于确切的版本。自从我需要这样做已经有一段时间了（我使用了旧的 g77 版本 - 所以事情可能已经改变了）但我记得当时有几个选择是：

*   尝试使用 g77 链接并包含库 -lstdc++（可能还有 -lm？）
*   尝试使用 g++ 链接并包含库 -lg2c -lm （可能还有 -lfrtbegin？）

如果使用较新的 gfortran，则 -lgfortran 应该在与 g++ 链接时工作，如果与 gfortran 链接，则 -lstdc++ 应该工作。

您还需要确保您的makefile 中的g++ 和f77 命令正在运行您希望它们运行的​​命令（例如，不访问意外目录或不同/不兼容版本中的可执行文件）。

编辑：从您最近对问题的编辑来看，您似乎正在尝试将 SUN 编译器的 f77 与 GCC g++ 链接起来。我不认为这是可能的。尝试使用 GCC 的 g77 或 gfortran 代替 SUN f77。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T09:36:26.590

劳格纳尔，

我建议您参考[我](https://stackoverflow.com/questions/662904/unix-symbol-referencing-error/662953#662953)对您之前关于未解决符号的问题的回答。

赶紧跑：

```
f77 -v something.f 
```

在独立的 Fortran90 程序上，编译器将准确显示默认链接的支持库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T20:07:36.690

Fortran 没有“标准库”。它确实有很多内在功能，但它们是语言的一部分，由标准定义。

* * *

评论的答案，因为评论字段在字符数方面有点过于严格：

@Michael - 是的，你可以这么说。但是，它仍然与您可能习惯的其他语言不同。我的意思是这个；当您编译和构建一个 fortran 程序时，编译器或链接器不需要您在该过程中包含库。这是编译器内部的东西。这适用于“标准”函数（内在函数等）。

如果您正在使用一些外部函数或子例程（例如，一些绘图例程），那么您需要分别包含它们。

但是，如果您使用作为语言一部分的标准数学函数，那么您的工作就完成了。你编写程序，编译和构建它。无需知道这些功能在哪里实现或如何实现，实现存储在哪里等等。那是编译器的工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T14:12:09.303

最后结合大家的建议解决了这个问题。

一旦我意识到我使用的是 SUN 而不是 GCC，我就转而使用 cc (gcc)、CC (g++) 和 f95 (f77) 进行编译。

解决问题的方法是从 f77 详细反馈（在主帖上方）粘贴整个链接器行，并逐渐删除那些没有贡献的部分。最后添加了以下文本：

-t -R/opt/SUNWspro/lib/sparc:/opt/SUNWspro/lib -YP,/opt/SUNWspro/lib/sparc:/opt/SUNWspro/prod/lib/sparc:/opt/SUNWspro/lib:/ opt/SUNWspro/prod/lib:/usr/ccs/lib:/lib:/usr/lib -lfui -lfai -lfai2 -lfsumai -lfprodai -lfminlai -lfmaxlai -lfminvai -lfmaxvai -lfsu -lsunmath -Bdynamic -lmtsk -lm -lc

# programming-languages - 真正的多语言编程语言？

> ID：667720
> 
> 赞同：12
> 
> 时间：2009-03-20T19:55:13.910
> 
> 标签：programming-languages, internationalization

我意识到大多数语言都支持多种语言，但我见过的每种语言都或多或少以美国为中心。我的意思是关键字、标准库函数等都有英文名称。所以，作为一名程序员，你仍然真的需要至少懂一些英语才能理解它。

是否有任何真正的“多语言”语言支持语言关键字等多种语言？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-20T20:30:03.937

这通常是一个可怕的想法，任何在本地化 IDE 中工作的人都可以证明这一点。程序员严重依赖于拥有一个共同的词汇表。当编译器给我错误“缺少类型说明符 - 假定为 int”时，我可以与其他人分享这个确切的错误消息，例如在 SO 上，其他人会*熟悉*它，所以他们可以告诉我这意味着什么。如果编译器改为用丹麦语生成错误消息，我将仅限于从相对少数会说丹麦语的程序员那里获得帮助。

突然之间，我的词汇量不再与德国、法国或日本处于同一位置的人相同。我们不能再交换代码、错误、错误修复或想法。

西班牙的开发人员无法使用我的代码，因为它实际上是用另一种语言编写的。如果我的代码有问题，其他人将无法调试它，因为它甚至无法在他们的本地化设置下编译（如果是这样，他们仍然无法阅读）。

归根结底，编程语言是*一种语言*。它可能从英语中借了一些词，但它*不是*英语，你不需要懂英语就可以在其中编程，就像我需要懂拉丁语才能说英语一样（英语也借用拉丁词）。

你不妨要求多语种英语。*有什么意义*呢？是的，理论上它会让不会说英语的人……说英语。它只是不会像其他所有说英语的人说的一样英语，所以它实际上不会使他们之间的交流成为可能。

`if`编程语言中*的*关键字与英语中的 if 关键字不同。它们意味着不同的东西，即使一个显然是受到另一个的启发。

C# 中的`delegate`关键字与英文中的“delegate”含义不同。或“构造函数”也没有`while`。`return`它们不是英文单词，它们是 C++、Java、C#、Python 或任何其他编程语言中的关键字或概念。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-20T20:12:36.863

对我来说听起来是个坏主意。如果我正在编写一个程序，我怎么知道我输入的变量名实际上是保加利亚语或韩语的音译关键字？我是否必须处理数千个关键字，或者我在结合瑞典和埃及同事编写的两个例程时遇到问题？

只要意识到编程关键字是英文的，就像音乐关键字是意大利语一样。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-20T20:04:11.567

这似乎是一个很好的起点：[非英语编程语言](http://en.wikipedia.org/wiki/Non-English-based_programming_languages)。

那里有一些有趣的，比如[Python 翻译成中文](http://www.chinesepython.org/cgi_bin/cgb.cgi/home.html)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-20T20:20:56.953

您可以使用 C/C++ 预处理器重新定义所有关键字 - 有些人已经这样做了。我在一家挪威公司担任培训师/导师时遇到了它。一些明亮的火花已经实现了将所有 C 关键字翻译成挪威语并强制使用它的方法。挪威工作人员，他们都说一口流利的英语（或者我不能和他们一起挣钱）都讨厌它，它死了。

我在荷兰也有过相当广泛的工作，那里的大多数程序员似乎都是用英语编程的。我遇到的唯一在编程语言中抵制英语霸权的人是（不用说）法国人。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-30T18:07:39.813

在一个领域，本地化语言可能是有用的和有帮助的，这些是旨在供非程序员使用的 DLS（领域特定语言）。这些语言肯定会从本地化中受益，因为来自非英语国家的商业用户通常不像程序员那样懂英语。

如果他们处理大量不可翻译的术语，那么这种本地化的 DSL 也可以证明对程序员有利。我遇到的一个相当成功的系统被用来计算以色列军队人员的薪水。它使用基于希伯来语的语法以及数百个只能用希伯来语正确表达的术语。在这种特殊情况下，标准逻辑关键字`if`、`then`、`else`等被翻译成希伯来语，整个代码编辑器是从右到左的。直到今天，大量的业务逻辑都以这种方式维护，恕我直言，这是正确的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-03-26T02:24:33.327

这似乎是出了名的困难，除非它是社区的努力，但对于某些语言，我不明白为什么你不能使现有语言成为多语言，而是创建本地化标准库的自定义库。

例如，在 Java 中，您可以创建

```
public class HoweverYouSayExampleObjectInYourLanguage extends ExampleObjectName {
  } 
```

然后使用目标语言的名称创建包装函数/方法，但基本上调用现有的标准方法

```
private void HoweverYouSayExampleMethodInYourLanguage(parameters) {
      this.ExampleMethod(parameters);
      // Some error handling code
} 
```

如果您正确地进行错误处理，堆栈跟踪/错误将全部引用标准库中的错误，除非它是您的本地化库实现的错误 - 在这种情况下，应通过本地化中的正确错误处理来指出图书馆本身。

正如其他人提到的那样，缺点是共享源代码。如果我们都在同一个页面上使用给定语言的 IDE - 我看不出为什么您无法构建一个真正国际化的 IDE，其中您在屏幕上看到的源代码不是真正的源代码本身，而是通过某种形式的映射对真实源代码的本地呈现。

我将继续说，我上面所说的一切可能充其量只是一个好主意，因为函数名称并不像库和 API 的本地化文档那么重要。根据我的经验，对于常见的编程语言/上下文来说，这些事情做得非常糟糕或根本没有。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-20T20:10:22.113

[您可以用拉丁文](http://search.cpan.org/~dconway/Lingua-Romana-Perligata-0.50/lib/Lingua/Romana/Perligata.pm)编写 Perl 。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-20T20:45:36.940

不要尝试用自然语言编写代码，那是没有用的。[改为学习“编程”语言](https://stackoverflow.com/questions/202723/coding-in-other-spoken-languages)。

例如，“switch”这个词在英语中对我没有任何意义，但它是一个决定几个选择的指令。

后来（当我学习英语时）我想..嘿，这很有趣，英语也有一个“切换”词，就像C一样。（doh！）

:)

不管你的英语好坏，你都不能对java说

将 java.util.* 导入我的 CD-ROM；

因为它不是有效的语法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-20T21:51:14.600

像[APL](http://en.wikipedia.org/wiki/APL_programming_language)和[J](http://en.wikipedia.org/wiki/J_(programming_language))这样的语言呢？APL 中的关键字都是单个符号；不幸的是，其中大部分不在您的键盘上，因此 J 出现并用 ASCII 表示（在许多情况下由多个字符组成）替换了其中的大部分。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-01T06:00:40.247

[排序！](http://p-nand-q.com/humor/programming_languages/sorted.html)

> 排序！是双语的。它可以理解英语和德语代码。据我所知，排序！是世界上唯一可以做到这一点的编程语言。

有什么有用的吗？这是一个更好的问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-01-28T21:47:48.823

在很大程度上，您可以使用任何 unicode 脚本在 prolog 中编程（因为它是一种符号语言）。有一个（微小的，微不足道的）捕获 - 在您可能遇到的所有 prolog 编译器中，变量由首字母大写罗马字母表示，您必须重新定义内置函数（但 prolog 使这相对容易*）。

我认为一个例子可以说明我的意思是最好的：

% 查找复活节日期的算法，给定年份（作为第一个参数）

```
復活節( V1, V2, V3) :-
   A 是 (V1 mod 19),
   B 是 V1// 100,
   C 是 V1 mod 100,
   D 是 B // 4,
   E 是 B mod  4,
   F 是 (B + 8) // 25,
   G 是 (B - F + 1) // 3,
   H 是 (19*A + B - D - G + 15 )mod 30,
   I 是 C // 4,
   J 是 C mod  4,
   K 是 (32 + 2*E + 2*I - H - J) mod  7 ,
   L 是 (A + 11*H + 22*K) // 451,
   M 是 (H + K - 7*L + 114) // 31,
   N 是 (H + K - 7*L + 114)mod  31,
   V2 是 M,
   V3 是 N + 1. 
```

/*

示例测试：

?- 下午（2013，V2，V3）。V2 = 3 , V3 = 31

即今年的复活节将在 3 月 31 日

*/

*   这是我用来重新定义'is'运算符中的构建（如果它不完美，请不要开枪）：

    :-op(500,xfy,是)。

    是(X,Y):-是(X,Y)。

# f# - 如何在 F# 中反转矩阵？

> ID：667721
> 
> 赞同：7
> 
> 时间：2009-03-20T19:55:18.340
> 
> 标签：f#, matrix

我需要使用 F# 执行一些基本的 OLS 回归。为此，我需要一些线性代数函数，但我对那里有什么感到困惑。我找不到任何方法来反转矩阵。有一些名为 的库的文档`Microsoft.FSharp.Math.LinearAlgebra`，但我不知道它是否存在。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T21:19:05.473

如果您将 FSharp Powerpack 添加到您的项目中（在 .NET 参考中），您可以使用矩阵库的各种功能

编辑：还需要添加实验库Fsharp.Powerpack.MathProviders，然后可以如下调用

```
open    Microsoft.FSharp.Math
let m = Matrix.create 10 10 1.2
let m2 = Experimental.LinearAlgebra.Inverse m 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-23T14:43:08.973

[FlyingFrog](http://www.ffconsultancy.com/)做了一个[Numerics](http://www.ffconsultancy.com/products/fsharp_for_numerics/index.html)库，其中包含许多其他函数中的矩阵求逆。

不确定哪个更可取，或者 PowerPack 中的（显然已弃用）“实验性”代码。我想您可以始终将 PowerPack 版本的托管位的源代码保存在安全的地方，仍然可以在这里找到：

```
C:\Program Files\FSharp-1.9.6.2\source\fsharp\FSharp.PowerPack\math\lapack\linear_algebra_managed.fs. 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T20:00:37.970

我不知道; 在 F# 的 1.9.6 版本中，我看不到任何东西，文档在这里

[http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html](http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html)

并且 FSharp.Powerpack.dll 中的 Microsoft.FSharp.Math 命名空间中有 Matrix 的东西，但我没有看到“反转”，我不知道“线性代数”的东西（不推荐使用？网络搜索建议它消失了几个版本）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T20:08:54.503

你检查过[这个](http://cs.hubfs.net/forums/thread/258.aspx)。它可能会有所帮助。

# c# - 从 UserControl 传回信息

> ID：667730
> 
> 赞同：1
> 
> 时间：2009-03-20T19:57:40.317
> 
> 标签：c#, winforms, validation

我刚刚开始掌握 UserControl 的概念。

我创建了一个 UserControl 来将多个控件组合在一起，这些控件在 TabControl 的各个页面上被复制。

其中一些控件是需要验证的文本字段，当验证不成功时，我需要显示错误消息。但是，我要显示错误消息的位置在主窗体的状态栏上。

在这种情况下处理验证/错误显示的最佳方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T20:01:08.577

**要处理验证，请执行以下操作之一：**

*   使用用户控件内的方法进行验证
*   让您的用户控件具有可以处理验证的[`delegate`](http://msdn.microsoft.com/en-us/library/ms173171(VS.80).aspx)属性（例如`ValidationHandler`）（这将允许您拥有一个包含一堆验证器的类，您可以将它们分配给您的控件）

    `public delegate void Validator(...)`

    `public Validator ValidationHandler { get; set; }`

*   让您的用户控件生成验证请求[`event`](http://msdn.microsoft.com/en-us/library/awbftdfh.aspx)（例如`ValidationRequested`）

    `public event EventHandler<ValidationEventArgs> ValidationRequested`

**要通知系统发生了错误，请执行以下操作之一：**

*   使用[`event`](http://msdn.microsoft.com/en-us/library/awbftdfh.aspx)感兴趣的各方可以订阅的（例如`ValidationFailed`）

*   如果执行验证的对象（通过`delegate`or `event`）也是您要从中生成错误消息的对象，它可以自己引发错误消息。

**编辑：**

既然您说过您将在您的控件内进行验证，那么 ValidationFailed 事件的代码可能如下所示：

```
// In your user control

public class ValidationFailedEventArgs : EventArgs
{
   public ValidationFailedEventArgs(string message)
   {
      this.Message = message;
   }

   public string Message { get; set; }
}

private EventHandler<ValidationFailedEventArgs> _validationFailed;
public event EventHandler<ValidationFailedEventArgs> ValidationFailed
{
   add { _validationFailed += value; }
   remove { _validationFailed -= value; }
}

protected void OnValidationFailed(ValidationFailedEventArgs e)
{
   if(_validationFailed != null)
      _validationFailed(this, e);
}

private void YourValidator()
{
   if(!valid)
   {
      ValidationFailedEventArgs args = 
         new ValidationFailedEventArgs("Your Message");
      OnValidationFailed(args);
   }
}

// In your main form:

userControl.ValidationFailed += 
   new EventHandler<ValidationFailedEventArgs>(userControl_ValidationFailed);

// ...
private void userControl_ValidationFailed(object sender, 
                                          ValidationFailedEventArgs e)
{
   statusBar.Text = e.Message;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T20:02:24.253

如果您在 UserControl 中进行验证，您可以让它提供一个公共 ValidationFailed 事件并将消息包含在 EventArgs 中。然后父控件可以订阅 ValidationFailed 事件并更新状态栏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T19:59:54.413

您可以在用户控件本身上放置一个验证器，引发异常，或将公共 getter 添加到您希望在父表单中显示的字段。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T20:00:51.433

在您的用户控件上创建一个验证其字段的公共方法，您可以传入字符串输出参数。

所以像

```
 public bool IsValid(out string status)
{
 // do validation and set the status message
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T20:05:05.480

您可以在用户控件中使用 asp.net 验证器，并在主窗体上使用验证摘要，它会为您列出错误。

对于其他类型的使用，您可以公开一个事件，并让包含该控件的页面订阅该事件并采取任何必要的操作。

# asp.net - 付费 ASP.NET 控件的最佳价值

> ID：667733
> 
> 赞同：2
> 
> 时间：2009-03-20T19:59:01.000
> 
> 标签：asp.net, controls, telerik

我们对免费的 .NET 库和应用程序有疑问，但我很好奇您使用的哪些**ASP.NET 控件**包可以为您带来最大的收益。是的，付费的东西。

我会说我喜欢[Telerik](http://www.telerik.com/products/aspnet-ajax.aspx)控件，但它们的价格并不高。我要说这里的价值最大的一个原因是许可，这使得部署变得如此容易。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-13T17:02:25.120

*[完全披露：我在 Telerik 工作。]*

我不会就哪些控制是最好的做出任何陈述——因为很明显我的意见会有偏见——但我会说在“第三方”组件市场（换句话说，不是微软也不是开源）中的定价大玩家都是一样的。总的来说，如果您需要任何 3rd 方套件提供的丰富功能，价格*远*低于您在自己的开发时间从头开始重建控件（甚至自定义开源控件）所支付的价格）。

不过，在处理许可的方式上存在一些显着差异，正如 Josh 最初强调的那样，Telerik 拥有最开放、“对开发人员友好”的许可方式。购买的控件*没有*要处理的许可证密钥。

希望有帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T20:29:49.927

我同时拥有 Telerik 和 DevExpress，我发现自己越来越远离 Telerik 的东西并使用更多的 DevExpress 控件。我特别喜欢 DevExpress 报告包（Telerik 无法使用）和 Grid / PivotGrid。然而，Telerik 确实有更好的 AJAX 管理助手（尽管我不再使用它们，因为我已经对“原始”AJAX 了解得足够多）并且 Telerik Editor 控件是最好的。

所以...在这里为 DevExpress 投一票。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-20T20:26:07.113

Telerik 是迄今为止成本最高的；但你说得对，成本有点高。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-20T20:26:07.457

我们使用来自 ComponentArt 的“Web.UI”套件，我们对此非常满意。您可以获得源代码、重新分发等。确保我们的网络应用程序脱颖而出。

[http://componentart.com](http://componentart.com)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-13T17:33:38.587

Telerik / DevExpress 控件的成本与让一两个人开发“更好的东西”的成本相比是便宜的。我让开发人员在没有 Ajax 的网格上工作了两周，没有客户端任何东西，它看起来像废话。除非你对 jQuery 等工具有很好的技能，而且团队都具备这些技能，否则购买库会更便宜。卡在一个问题上，打开一张票。就是这么简单。

# c# - 在 asp.net 中使用 OnInit 事件

> ID：667734
> 
> 赞同：6
> 
> 时间：2009-03-20T19:59:03.247
> 
> 标签：c#, asp.net

我有 contentpage 覆盖母版页的 OnInit 事件。覆盖工作正常，直到我在页面上放置一个自定义用户控件：在这种情况下，不会为 contentpage 触发 OnInit 事件（用户控件中没有使用覆盖）

可能的原因/解决方案是什么？（我使用 OnInit 事件来创建动态控件）

* * *

**编辑：**

现在我在内容页面中尝试了这个：

（ OnPreInit 部分运行，但 Masters_Init 没有被调用......）

```
 protected override void OnPreInit(EventArgs e)
    {
        base.Master.Init += new EventHandler(Masters_Init);
    }

    void Masters_Init(object sender, EventArgs e)
    { 
    //code 
    } 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-20T20:03:17.980

你打电话给 base.OnInit 吗？

```
public override void OnInit(EventArgs e)
{
  // code before base oninit
  base.OnInit(e);
  // code after base oninit
} 
```

**更新**

```
public class Page1 : Page
{
  public Page1 : base() {
    PreInit += Page_PreInit;
  }
  void Page_PreInit(object sender, EventArgs e)
  {
    Master.Init += Master_Init;
  }
  void Master_Init(object sender, EventArgs e)
  {
    //code
  }
} 
```

同样正如评论中提到的，如果您不必这样做，我建议不要覆盖事件，但如果您必须确保调用基地。所以在你上面的编辑中应该是

```
protected override void OnPreInit(EventArgs e)
{
  base.OnPreInit(e);
  base.Master.Init += new EventHandler(Masters_Init);
} 
```

# c# - C#中的回调

> ID：667742
> 
> 赞同：17
> 
> 时间：2009-03-20T20:01:22.103
> 
> 标签：c#, .net, callback

我想要一个库，其中有一个函数，它接受一个对象作为它的参数。

有了这个对象，我希望能够在 X 完成时调用指定的函数。将被调用的函数由调用者指定，X 将由库完成和监控。

我怎样才能做到这一点？

作为参考，我使用的是 C# 和 .NET 3.5

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-20T20:12:24.587

两种选择：

1.  让函数接受一个[委托](https://docs.microsoft.com/en-us/dotnet/api/system.delegate?view=netframework-4.8)（[`Action`](https://docs.microsoft.com/en-us/dotnet/api/system.action-1?view=netframework-4.8)对于不返回任何内容的回调，对于返回的回调[`Func`](https://docs.microsoft.com/en-us/dotnet/api/system.func-2?view=netframework-4.8)），并在调用它时使用匿名委托或 Lambda 表达式。

2.  使用接口

## 使用委托/lambda

```
public static void DoWork(Action processAction)
{
  // do work
  if (processAction != null)
    processAction();
}

public static void Main()
{
  // using anonymous delegate
  DoWork(delegate() { Console.WriteLine("Completed"); });

  // using Lambda
  DoWork(() => Console.WriteLine("Completed"));
} 
```

如果你的回调需要传递一些东西，你可以使用一个类型参数`Action`：

```
public static void DoWork(Action<string> processAction)
{
  // do work
  if (processAction != null)
    processAction("this is the string");
}

public static void Main()
{
  // using anonymous delegate
  DoWork(delegate(string str) { Console.WriteLine(str); });

  // using Lambda
  DoWork((str) => Console.WriteLine(str));
} 
```

如果它需要多个参数，您可以将更多类型参数添加到`Action`. 如果您需要返回类型，如上所述，请使用`Func`并将返回类型作为*最后一个*类型参数（`Func<string, int>`是一个接受字符串并返回 int 的函数。）

更多关于代表[的信息在这里](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/delegates/index?view=netframework-4.8)。

## 使用接口

```
public interface IObjectWithX
{
  void X();
}

public class MyObjectWithX : IObjectWithX
{
  public void X()
  {
    // do something
  }
}

public class ActionClass
{
  public static void DoWork(IObjectWithX handlerObject)
  {
    // do work
    handlerObject.X();
  }
}

public static void Main()
{
  var obj = new MyObjectWithX()
  ActionClass.DoWork(obj);
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-20T20:05:58.440

听起来像是委托的完美秘诀——特别是，带有委托的回调正是 .NET 中异步模式的处理方式。

调用者通常会传递给你一些状态和一个委托，然后你将它们存储在你所拥有的任何上下文中，然后调用委托传递给它状态和你可能得到的任何结果。

您可以使状态只是`object`或可能使用通用委托并采用适当类型的状态，例如

```
public delegate void Callback<T>(T state, OperationResult result) 
```

然后：

```
public void DoSomeOperation(int otherParameterForWhateverReason,
                            Callback<T> callback, T state) 
```

当您使用 .NET 3.5 时，您可能希望使用现有类型`Func<...>`和`Action<...>` 委托类型，但您*可能会*发现声明自己的类型更清晰。（这个名称可能会让您更清楚地使用它。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T20:03:06.683

有问题的对象将需要实现您提供的接口。将接口作为参数，然后就可以调用接口暴露的任何方法。否则，您将无法知道该对象的能力。那，或者您可以将委托作为参数并调用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T20:06:30.420

是否有理由不让您的库提供在操作完成时触发的公共事件？然后调用者可以注册来处理事件，你不必担心传递对象或委托。

实现您提供的接口的对象可以工作，但它似乎更像是 Java 方法而不是 .NET 方法。事件对我来说似乎更干净一些。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2015-11-04T21:45:38.943

您可以将 C#.NET 中可用的 System.Action 用于回调函数。请检查此示例：

```
 //Say you are calling some FUNC1 that has the tight while loop and you need to 
    //get updates on what percentage the updates have been done.
    private void ExecuteUpdates()
    {
        Func1(Info => { lblUpdInfo.Text = Info; });
    }

    //Now Func1 would keep calling back the Action specified in the argument
    //This System.Action can be returned for any type by passing the Type as the template.
    //This example is returning string.
    private void Func1(System.Action<string> UpdateInfo)
    {
        int nCount = 0;
        while (nCount < 100)
        {
            nCount++;
            if (UpdateInfo != null) UpdateInfo("Counter: " + nCount.ToString());
            //System.Threading.Thread.Sleep(1000);
        }
    } 
```

# delphi - Delphi 包构建/安装调试

> ID：667746
> 
> 赞同：5
> 
> 时间：2009-03-20T20:02:54.157
> 
> 标签：delphi, ide, packages, custom-component

我正在使用 Delphi 2007 Pro。我有一个运行时包，其中包含我正在开发的许多基于 TFrame 的复合组件。还有一个相关的设计包将这些组件安装到工具面板中。由于各种原因，这些 TFrame 后代使用了许多第三方组件，并且还相互继承，作为类层次结构。到目前为止（并且在这里得到了一些很好的建议的帮助），这种方法对于我想要完成的工作非常有效。

然而，最近我遇到了一个问题，编译/构建运行时包。最初，它与以 nxEventLog.pas 为中心的一些冲突有关，遗憾的是我未能记录其细节，但基本上类似于“此方法的定义与之前的定义不符”。就像你的实现声明与你的类声明不一致时得到的一样。此文件是 NexusDB 文件（应用程序使用 NexusDB 嵌入式服务器）。

我尝试了各种方法，但从未成功让冲突消失。我最接近的是在编译时，让 IDE 请求将完全不相关的单元的 TRUCKLOAD 添加到 contains/uses 子句。稍后会详细介绍，但如果我继续这样做，它仍然无法正常工作。nxEventLog 文件未从其原始状态更改。

无法找出为什么会出现这个错误——它出现在 Nexus 文件中，而不是我的实际包或单元中，而且我在 Nexus 代码中没有更改任何内容——我终于继续并完全卸载了 Nexus，并手动搜索以确保我已删除所有相关的 dcu 和 bpl 文件，然后重新安装。（我正在运行 Nexus 2.07）

启动 IDE 后，出现以下错误：

> bds.exe - 未找到入口点
> ---------------
> 程序入口点
> @Nxsddatadictionary@TnxBaseTableDescriptor@LoadFromReader$qqrp15Classes@TReader 可以不在动态链接库 NexusDB207sd110.bpl 中。
> ----------------------------
> 好的

其次是：

> Can't load package ....NexusDB207dv110.bpl
> Can't load package ....cmTPPanels_D2007_DesignReg.bpl 找不到
> 指定的程序。
> 您想在下次加载包时尝试加载此包吗？

Once I uninstalled the cmTPPanels runtime/design packages (my component set), via Component -> Install Package -> Remove, my other "normal Nexus DB" applications seem to work fine, including those which include Nexus's nxEventLog ocmponent. This seems to indicate the problem is definitely in my install packages somewhere.

So, having confirmed that my Nexus installation does not seem to be the actual problem, I opened up the project group which contains both packages. Building (or compiling) the runtime package, the Delphi IDE gives me the same dialog box I mentioned above:

> "The following changes are necessary to make this package compatible with other installed package. Choose OK to apply these changes and rebuild the package."
> 
> Add dsnap.
> dsnap contains implicit unit(s) DBClient, Provider, DataBkr, MidConst, Midas, DSIntf.
> 
> Add ibxpress.
> ibxpress contains implicit unit(s) IBUtils, IB, IBSQLMonitor, IBHeader, IBIntf, IBXConst, IBXMLHeader, IBSQL, IBBlob, IBCustomDataSet, IBDatabase, IBErrorCodes, IBDatabaseInfo,
> IBExternals, IBInstallHeader, IBServices.
> 
> Add IndyCore.
> IndyCore contains implicit unit(s) IdIOHandlerSocket, IdSocks, IdIOHandlerStack, IdBuffer, IdResourceStringsCore, IdIntercept, IdCustomTransparentProxy, IdExceptionCore, IdSocketHandle, IdIOHandler, IdTCPConnection, IdReplyRFC, IdReply, IdTCPClient, IdIPAddress, IdAssignedNumbers.
> 
> Add IndySystem.
> IndySystem contains implicit unit(s) IdBaseComponent, IdGlobal, IdStreamVCL, IdSysNativeVCL, IdSysVCL, IdSysBase, IdSysWin32, IdResourceStrings, IdException, IdSys, IdStream, IdObjs, IdComponent, IdStack, IdStackWindows, IdWship6, IdWinSock2, IdStackConsts, IdStackBSDBase, IdAntiFreezeBase.
> 
> Add Rz30DBCtls90.
> Rz30DBCtls90 contains implicit unit(s) RzDBNav, RzDBLbl, RzDBStat.
> 
> Add lmdweb30_d10.
> lmdweb30_d10 contains implicit unit(s) LMDWebHTTPGet, LMDHTMLObjectUnit, LMDFSSupport, LMDHTTPSupp, LMDStringsSupport, LMDURLSupp, LMDRASSupport, LMDRASCF, LMDWebConst, LMDRAS, LMDSyncUnit, LMDWebBase, LMDWebLex, LMDWebHTMLLex, LMDWebDownloadFormUnit, LMDDownload, LMDInetConst, LMDWebConfig, LMDWebInfo.
> 
> Add lmddsg30_d10.
> lmddsg30_d10 contains implicit unit(s) LMDDsgPropInsp, LMDDsgPropEditors, LMDDsgMenuEditor, LMDDsgObjects, LMDDsgClass, LMDDsgCst, LMDDsgCollectionEditor, LMDDsgStrsEditor, LMDDsgPropPage, LMDDsgModule.
> 
> Add lmdstorage10_d10.
> lmdstorage10_d10 contains implicit unit(s) LMDStorFormProperties, LMDStorFormHook, LMDStorBase, LMDStorConsts, LMDStorPropertiesStorage, LMDStorCommon, LMDStorINIVault.
> 
> Add ExceptionExpert11.
> ExceptionExpert11 contains implicit unit(s) ExceptionLog, EDisAsm, EHash, EListView, EConsts, ETypes, ELogManager, EEncrypt, EBase64, EXMLBuilder, ECore, EWebTools, EZip, EZlib, ESockets, ELang, EHook, EDebug, ELeaks.
> 
> Add RemObjects_Core_D11.
> RemObjects_Core_D11 contains implicit unit(s) uROClasses, uROSerializer, uROXMLIntf, uROMSXMLImpl, uRORes, uROMSXML2_TLB, uROClient, uRODLToXML, uRODL, uROTypes, uROHTTPTools, uROClientIntf, uROEncryption, uROZlib, uROCipher1, uROHash, uRODECUtil, uRODECConst, uROCipher, uROCiphers, uROBinaryHelpers, uROCompression, uROEventRepository, uROServerIntf, uROSessions, uRODynamicRequest, uRORemoteService, uROThreadPool, uROServer, uROAsync, uROThread, uROBinMessage, uROStreamSerializer.
> 
> Add RemObjects_Indy_D11.
> RemObjects_Indy_D11 contains implicit unit(s) uROSuperTCPChannel, uROSCHelpers.
> 
> Add DataAbstract_Core_D11.
> DataAbstract_Core_D11 contains implicit unit(s) uDADataTable, uDASupportClasses, uDARes, uDABusinessProcessor, uDAEngine, uDASQL92QueryBuilder, uDASQL92Interfaces, uDAWhere, uDAInterfaces, DataAbstract4_Intf, DataAbstract3_Intf, uDAHelpers, uDAClasses, uDAMemDataTable, uDAMemDataset, uDAExpressionEvaluator, uDAMacros, uDAUtils, uDAXMLUtils, uDADriverManager, uDAInterfacesEx, uDADelta, uDARegExpr, uDAScriptingProvider, uDAOracleInterfaces, uDAMacroProcessors, uDADataStreamer, uDACDSDataTable, uDARemoteDataAdapter, uDAReconcileDialog, uDAReconcileDialogDetails, uDARemoteDataAdapterRequests, uDABinAdapter.
> 
> Add VirtualTreesD11.
> VirtualTreesD11 contains implicit unit(s) VirtualTrees, VTAccessibilityFactory.
> 
> Add VirtualShellToolsD11.
> VirtualShellToolsD11 contains implicit unit(s) VirtualExplorerTree, ColumnForm, VirtualResources, VirtualShellAutoComplete, VirtualShellNotifier, VirtualScrollbars.
> 
> Add dxBarDBNavD11.
> dxBarDBNavD11 contains implicit unit(s) dxBarDBNav, dxBarDBNavStrs.
> 
> Add dxBarExtDBItemsD11.
> dxBarExtDBItemsD11 contains implicit unit(s) dxBarExtDBItems.
> 
> Add cxVerticalGridD11.
> cxVerticalGridD11 contains implicit unit(s) cxDBVGrid, cxVGridViewInfo, cxVGridUtils, cxVGrid, cxVGridNewCategory, cxVGridConsts.
> 
> Add dxNavBarD11.
> dxNavBarD11 contains implicit unit(s) dxNavBar, dxNavBarExplorerViews, dxNavBarConsts, dxNavBarGraphics, dxNavBarStyles, dxNavBarBase, dxNavBarViewsFact, dxNavBarCollns, dxNavBarVSToolBoxViews, dxNavBarBaseViews, dxNavBarOffice11Views, dxNavBarOfficeViews, dxNavBarXPViews.
> 
> Add dxLayoutControlD11.
> dxLayoutControlD11 contains implicit unit(s) dxLayoutControl, dxLayoutCustomizeForm, dxLayoutEditForm, dxLayoutCommon, dxLayoutLookAndFeels, dxLayoutControlAdapters.
> 
> Add dxMasterViewD11.
> dxMasterViewD11 contains implicit unit(s) dxMasterViewColumns, dxMasterView, dxMasterViewStrs.
> 
> Add dxdbtrD11.
> dxdbtrD11 contains implicit unit(s) dxdbtrel, dxlocate, dxtree, dxdbtree.
> 
> Add dxPSCoreD11.
> dxPSCoreD11 contains implicit unit(s) dxPSEdgePatterns, dxPSUtl, dxPSImgs, dxPSRes, dxPrnDev, dxPSGlbl, dxPSEngn, dxPSSngltn, dxPSESys, dxBase, dxPSCore, dxPSPrVwStd, dxPSPopupMan, dxPgsDlg, dxWrap, dxPSHFToolBarBld, dxPSfmAutoHFTextFmt, dxPSEvnt, dxPrnPg, dxPpAttr, dxBkGnd, dxFEFDlg, dxPcPrVw,dxExtCtrls, dxExtCtrlsStrs, dxPSForm, dxPSAutoHFTextMnuBld, dxfmDfnStl, dxfmMnPg, dxfmClr, dxPreVw, dxPSPrVw, dxfmZoom, dxPSExtDlgs, dxfmPNFmt, dxfmDTFmt, dxPSPrVwOpt, dxPSfmCompositionDsg, dxPSfmCompositionAdd, dxPSCompsProvider, dxPSXplorerTreeView, dxPSfmReportProperties, dxPSPgsMnuBld, dxfmChFN, dxPSfmTtl, dxPSCPDsg, dxPSfmLnkAdd, dxPSfmEditDesc, dxPSFillPatterns, dxPrnDlg.
> 
> Add dxPScxCommonD11.
> dxPScxCommonD11 contains implicit unit(s) dxPScxCommon.
> 
> Add dxPScxGridLnkD11.
> dxPScxGridLnkD11 contains implicit unit(s) dxPScxGridLnk.
> 
> Add NexusDB207se110.
> NexusDB207se110 contains implicit unit(s) nxseAutoComponent, nxseAllEngines, nxseRecordCompressionEngineSmart, nxseRecordEngineVariable, nxseFulltextEngineCursor, nxseFulltextEngineTable, nxseRefIntEngine, nxseJournalEngine, nxseSortEngineMerge, nxseTemporaryStorageChunked, nxseRecordEngineStatic, nxseIndicesEngineSimple, nxseIndexBase, nxseHeapEngineCached, nxseBlockHeapEngineNonfragmenting, nxseBlobEngineSimple, nxseIndexEngineStaticKeyBstarTree, nxseHeaderAccess, nxseEncryptionEngineBlowfishRC4, nxseBlobEngineSegmented, nxseAutoIncEngineSimple, nxseStreamEngineSimple.
> 
> Add NexusDB207sr110.
> NexusDB207sr110 contains implicit unit(s) nxsrSqlEngineBase, nxExeConst, nxsrServerEngine, nxsrBlobHandlerCaching, nxsrTimeoutHandling, nxsrTypes, nxsrBlobHandlerBase, nxsrBufferManager, nxsrFileImplWin32, nxsrStrings, nxsrEncryptionEngineBase, nxsrConst, nxsrTemporaryStorageBase, nxsrBlobEngineBase, nxsrSubEngineBase, nxsrBlobHandlerPassthrough, nxsrRecordMapperEngine, nxsrFieldMapperEngineAutoInc, nxsrFieldMapperEngine, nxsrFieldMapper, nxsrSortEngineBase, nxsrFulltextEngineBase, nxsrIndexEngineBase, nxsrRecordEngineBase, nxsrRefIntEngineBase, nxsrAutoIncEngineBase, nxsrStreamEngineBase, nxsrTableLockContainer, nxsrDataDictionary, nxsrFileHandling, nxsrServerCursorMapping, nxsrSystemStorage, nxsrRecordCompressionEngineBase, nxsrHeapEngineBase, nxsrBlockHeapEngineBase.
> 
> Add NexusDB207sq110.
> NexusDB207sq110 contains implicit unit(s) nxsqlEngine, nxsqlFunctions, nxsqlDataDef, nxsqlFunctionOrganizer, nxsqlCondExp, nxsqlTableExp, nxsqlViews, nxsqlProxies, nxSQLParse, nxsqlPSM, nxsqlTest, CocoaBaseW, nxsqlBase, nxsqlDataManip, nxSQLTok, nxSQLProxiesIntf.
> 
> Add NexusDB207lg110.
> NexusDB207lg110 contains implicit unit(s) nxlgEventLogDispatcher, nxlgEventLog.
> 
> Add NexusDB207dv110.
> NexusDB207dv110 contains implicit unit(s) nxServerManager, nxBaseServerComp, nxConfigSettings.
> 
> Add MPCommonLibD11.
> MPCommonLibD11 contains implicit unit(s) MPDataObject, MPCommonObjects, MPCommonUtilities, MPResources, MPShellTypes, MPThreadManager, MPShellUtilities.

What's weird about this, aside from the fact that includes just about everything but the kitchen sink, is that a number of the packages mentioned aren't even relevant to the components included in this package I'm trying to install; DataSnap, Indy, IBExpress, RemObjects Data Abstract, etc -- none of these are even referenced in my components.

If I click "OK" to all these added units/packages, more chaos ensues, and it doesn't compile.

The NexusDB folders, and the folders which these components I'm developing reside in, are all on my Library path, with my custom components listed last.

I'm working on a virtual machine, and can snapshot as needed, but I can't seem to get around this problem regardless, and it's clear that I don't have enough in-depth understanding of how the compiler works to know where to look for diagnosis of the problem. Anything anyone can mention which might help me do so, would be much appreciated.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-20T20:11:00.270

As a rule, these errors come from having incompatible, or, more commonly, multiple versions of the same BPL and/or DCP files on the path. Do a full search of your system for all the BPLs and DCPs, and make sure there is only one copy of each.

Tracking these types of errors down can be a massive pain in the ass. :-/

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-31T09:24:41.717

If you have several related packages, the build and installation order is extremely important. If package A depends on B and some unit in B changes, it sometimes goes really wrong. You can reinstall Delphi, but its better to reinstall the packages in order.

First remove all packages. (With inslall packages and remove all you can.)

Then check the registry. Sometimes some information is left which can cause problems later on.

```
In the HKCU\Software\ [Borland|Codegear]\[Version]\Disabled Packages, there is a list of packages that are disabled. Have a look at these. And remove anything you need.
In the HKCU\Software\ [Borland|Codegear]\[Version]\Known Packages, there is a list of all known packages. Have a look at these and remove all suspicious packages. 
```

For older versions this infomation can be found in: In the HKLM\Software\Borland[Version]\Known Packages

Try to restart Delphi for sanity and rebuild and install anything needed in the correct order.

# iphone - 如何将按钮样式的单元格添加到 iPhone 应用程序的表格视图中？

> ID：667752
> 
> 赞同：0
> 
> 时间：2009-03-20T20:04:02.767
> 
> 标签：iphone, objective-c, uitableview, uikit

我在苹果的文档中找不到任何具体的例子。我想以编程方式向表格视图添加两到三个按钮，就像联系人应用程序对联系人信息上的发送短信/添加到收藏夹按钮所做的那样。有谁知道如何配置这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T23:17:17.390

我在我的应用程序中所做的是创建一个带有按钮的视图，并在 UITableView 委托的`tableView:viewForHeaderInSection`: 和/或方法中返回该视图。`tableView:viewForFooterInSection:`

# .net - 帮助 ASP.NET 中的 Elmah 配置

> ID：667756
> 
> 赞同：5
> 
> 时间：2009-03-20T20:04:53.310
> 
> 标签：.net, asp.net, dotnetnuke, elmah

我正在尝试设置[ELMAH](http://code.google.com/p/elmah/)来为我们的应用程序记录错误。我已成功添加模块并且加载 ErrorLog 页面 (elmah.axd) 没有问题。但是，Elmah 没有记录我生成的任何测试异常。

我的 web.config 看起来像这样：

```
<configSections>
    <!-- Other stuff -->
    <sectionGroup name="elmah">
        <section name="security" requirePermission="false" type="Elmah.SecuritySectionHandler, Elmah"/>
        <section name="errorLog" requirePermission="false" type="Elmah.ErrorLogSectionHandler, Elmah"/>
        <section name="errorMail" requirePermission="false" type="Elmah.ErrorMailSectionHandler, Elmah"/>
    </sectionGroup>
</configSections>

<elmah>
    <errorLog type="Elmah.XmlFileErrorLog, Elmah" logPath="~/App_Data" /> 
</elmah> 

<httpHandlers> 
    <!-- Other stuff -->
    <add verb="POST,GET,HEAD" path="elmah.axd" type="Elmah.ErrorLogPageFactory, Elmah"/>
</httpHandlers>

<httpModules>
    <!-- Other stuff -->
    <add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah"/>
    <add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah"/>
    <add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah"/>
</httpModules> 
```

点击测试异常页面会`http://localhost/elmah.axd/test`生成[黄屏](http://en.wikipedia.org/wiki/Yellow_Screen_of_Death#ASP.NET)，但没有日志条目。

在提供的示例和[DotNetSlackers](http://dotnetslackers.com/articles/aspnet/ErrorLoggingModulesAndHandlers.aspx)上的教程之间，我看不出有任何问题。有什么我想念的吗？我也尝试通过[Signaling](http://code.google.com/p/elmah/wiki/DotNetSlackersArticle#Error_Signaling)生成错误，但这也不起作用。

我正在针对 DotNetNuke 运行它，这就是我目前认为问题所在的地方。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-25T13:55:17.353

我认为您需要做的是禁用 DotNetNuke 中的自定义错误消息。
1\. 以主机身份登录 dnn 门户
2\. 导航到主机 > 主机设置。
2\. 进入基本设置 - 外观部分。
3\. 在使用自定义错误消息中，取消选中该复选框。
4\. 单击更新。
这将禁用 DotNetNuke 的错误处理程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T20:07:46.690

可能是 DNN 正在吞噬异常——它有自己的异常处理机制吗？

我将 ELMAH 与 Monorail 一起使用并遇到了类似的问题 - [Castle MonoRail & ELMAH](https://stackoverflow.com/questions/275810/castle-monorail-elmah)

仅供参考，[其他人](http://www.dotnetnuke.com/Community/Forums/tabid/795/forumid/160/threadid/266910/scope/posts/Default.aspx)也有同样的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T21:14:32.393

DNN 确实处理所有异常，所以这可能是您看到的问题。我相信它在应用程序级别处理错误事件，将所有内容记录到数据库中。我不知道有什么方法可以关闭它，但我也从未真正尝试过。

# python - 如何创建动态创建多个对象的 D-Bus 服务？

> ID：667760
> 
> 赞同：2
> 
> 时间：2009-03-20T20:05:24.417
> 
> 标签：python, dbus

我是 D-Bus 的新手（以及 Python 的新手，双重打击！），我正在尝试找出做本教程中讨论的事情的最佳方法。

> 但是，文本编辑器应用程序可以很容易地拥有多个总线名称（例如，除了通用 TextEditor 之外，org.kde.KWrite），具有多个对象（可能 /org/kde/documents/4352，其中编号根据文档而变化)，并且每个对象可以实现多个接口，例如 org.freedesktop.DBus.Introspectable、org.freedesktop.BasicTextField、org.kde.RichTextDocument。

例如，假设我想创建一个包装器`flickrapi`，以便服务可以公开一些 Flickr API 方法（例如，`urls_lookupGroup()`）。如果我想假设该服务将始终指定相同的 API 密钥并且验证信息对于使用该服务的每个人来说都是相同的，那么这相对简单。

尤其是在后一种情况下，我不能真正假设这是真的。

根据上面引用的文档，我假设应该是这样的：

```
# Get the connection proxy object.
flickrConnectionService = bus.get_object("com.example.FlickrService",
                                         "/Connection")

# Ask the connection object to connect, the return value would be
# maybe something like "/connection/5512" ...
flickrObjectPath = flickrConnectionService.connect("MY_APP_API_KEY",
                                                   "MY_APP_API_SECRET",
                                                   flickrUsername)

# Get the service proxy object.
flickrService = bus.get_object("com.example.FlickrService",
                               flickrObjectPath);

# As the flickr service object to get group information.
groupInfo = flickrService.getFlickrGroupInfo('s3a-belltown') 
```

所以，我的问题：

1）这是应该如何处理的？

2）如果是这样，服务如何知道客户端何时完成？有没有办法检测当前客户端是否断开连接，以便服务可以清理其动态创建的对象？另外，我将如何首先创建单个对象？

3）如果这不是应该如何处理的，还有什么其他建议可以完成类似的事情？

我已经阅读了许多 D-Bus 教程和各种文档，并且我最接近看到我正在寻找的内容是我上面引用的内容。然而，没有一个例子看起来真的做这样的事情，所以我不知道如何继续。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T20:17:20.613

1）大多数情况下是的，正如我在 2）中解释的那样，我只会更改连接方法中的一件事。

2) D-Bus 连接不是持久的，一切都是通过请求/响应消息完成的，没有连接状态被存储，除非您像使用`flickerObject`. python绑定中的d-bus对象主要是抽象远程对象的代理，就好像你“连接”到它们一样，但它真正做的是根据你提供给D-Bus对象实例化的信息（对象路径，界面等）。因此，如果客户端没有通过其他显式调用宣布它，则服务无法知道客户端何时完成。

要处理意外的客户端终结，您可以在客户端中创建一个 D-Bus 对象，并在连接时将对象路径发送到服务，更改您的`connect`方法以同时接受一个`ObjectPath`参数。该服务可以监听**`NameOwnerChanged`**信号以了解客户端是否已死亡。

要创建单个对象，您只需在与“/Connection”相同的服务中实例化一个对象，但您必须确保您使用的是不存在的名称。您可以有一个“/Connection/Manager”，以及各种“/Connection/1”、“/Connection/2”...

3）如果你需要存储连接状态，你必须做类似的事情。

# jquery - jQuery 验证 - 要求回答所有问题或选择退出调查

> ID：667761
> 
> 赞同：2
> 
> 时间：2009-03-20T20:05:51.327
> 
> 标签：jquery, validation, radio-button

我们有一个注册表，要求提供人口统计信息，并带有不提供任何信息的附加选项。但是，为了保持我们的数字正确相加，如果您选择任何人口统计数据，我们希望您输入所有信息。表单的渲染：

*   性别
    *   （ ） 男性
    *   （ ） 女性
*   残疾？
    *   （ ） 是的
    *   （ ） 不
*   种族
    *   （ ） 一种
    *   ( ) 乙
    *   （ ） C
*   ( ) 我不想提供人口统计信息

我们希望允许选择“我不希望...”和所有选项，例如“男性/是/A”，但不允许选择部分答案，例如“女性/C”。

我们如何构建 .validate() 规则和选项来实现这个目标？理想情况下，如果您的回复不充分，我们会显示/隐藏单个标签。

附加信息：

*   使用[jQuery 验证插件](http://docs.jquery.com/Plugins/Validation)
*   人口统计类型是从数据库列表动态创建的

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T20:15:19.697

我假设您正在使用[jQuery 验证](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)插件。如果是这样，您需要的是[带有依赖项检查的自定义要求规则，该规则](http://docs.jquery.com/Plugins/Validation/Methods/required#dependency-expression)允许您在用户不选择退出的情况下进行所需的输入。您可能希望在选择退出时有一个单击处理程序来清除其他字段，这样您就不必在用户选择退出时检查部分条目。

# sql-server - 如果在插入失败后选择 SCOPE_IDENTITY() 会发生什么 (SQL Server 2005)

> ID：667764
> 
> 赞同：8
> 
> 时间：2009-03-20T20:06:00.670
> 
> 标签：sql-server, sql-server-2005

MSDN 文档对此并不完全清楚。或者也许我读得不够好。

如果我进行插入（可能插入零行），然后

```
;SELECT SCOPE_IDENTITY() 
```

然后通过 ExecuteScalar() 调用命令...

如果 Insert 没有插入任何行，结果会是什么？

如果失败，我想停止，这样我就不会继续将子记录插入错误或错误的父 ID。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-20T20:11:28.927

如果没有插入身份 SCOPE_IDENTITY() 将返回 null，您可以通过将 SCOPE_IDENTITY() 分配给变量然后检查变量内容来检查您指定的条件。

插图

```
Create Proc SomeInsertToFail(@ID int OUTPUT)
as
Begin
    Select @ID =  Scope_Identity()
End
Declare @SOMEID int
Exec SomeInsertToFail @SOMEID OUTPUT
Select @SOMEID  --This will yield null 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-10-09T18:18:52.720

这取决于当前范围内是否存在 SUCCESSFUL 插入。

```
declare @tb table (i int identity, ky varchar(100));

insert into @tb values('Success');

insert into @tb select ky from @tb where ky = 'Failure';

select SCOPE_IDENTITY();  -- returns 1
select * from @tb 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-20T20:12:01.810

空值

来源：在空白查询上做了一个 SELECT scope_identity()（又名没有插入）

# c# - 需要使用 StreamReader.ReadLine() 获取行终止符

> ID：667771
> 
> 赞同：8
> 
> 时间：2009-03-20T20:07:19.640
> 
> 标签：c#, readline, streamreader, newline

我编写了一个 C# 程序来读取 Excel .xls/.xlsx 文件并输出为 CSV 和 Unicode 文本。我编写了一个单独的程序来删除空白记录。这是通过读取每一行来完成的`StreamReader.ReadLine()`，然后逐个字符地遍历字符串，如果它包含所有逗号（对于 CSV）或所有制表符（对于 Unicode 文本），则不将行写入输出。

当 Excel 文件在单元格内包含嵌入的换行符 (\x0A) 时，就会出现此问题。我将我的 XLS 更改为 CSV 转换器以找到这些新行（因为它逐个单元格）并将它们写为 \x0A，而普通行只使用 StreamWriter.WriteLine()。

该问题出现在单独的程序中以删除空白记录。当我读入 with 时`StreamReader.ReadLine()`，根据定义，它只返回带有行的字符串，而不是终止符。由于嵌入的换行符显示为两个单独的行，因此当我将它们写入最终文件时，我无法分辨哪个是完整记录，哪个是嵌入的换行符。

我什至不确定我是否可以读取 \x0A，因为输入上的所有内容都注册为“\n”。我可以一个字一个字地去，但这破坏了我删除空行的逻辑。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-20T21:04:48.767

我建议您更改架构，使其更像编译器中的解析器。

您想创建一个返回标记序列的词法分析器，然后创建一个解析器来读取标记序列并使用它们进行处理。

在您的情况下，令牌将是：

1.  列数据
2.  逗号
3.  行结束

您会将 '\n' ('\x0a') 本身视为嵌入的新行，因此将其作为列数据标记的一部分。'\r\n' 将构成行尾标记。

这具有以下优点：

1.  仅对数据进行 1 次传递
2.  仅存储最多 1 行的数据
3.  尽可能多地重用内存（用于字符串生成器和列表）
4.  如果您的要求发生变化，很容易改变

下面是 Lexer 的样例：

**免责声明：**我什至没有编译，更不用说测试了，这个代码，所以你需要清理它并确保它工作。

```
enum TokenType
{
    ColumnData,
    Comma,
    LineTerminator
}

class Token
{
    public TokenType Type { get; private set;}
    public string Data { get; private set;}

    public Token(TokenType type)
    {
        Type = type;
    }

    public Token(TokenType type, string data)
    {
        Type = type;
        Data = data;
    }
}

private  IEnumerable<Token> GetTokens(TextReader s)
{
   var builder = new StringBuilder();

   while (s.Peek() >= 0)
   {
       var c = (char)s.Read();
       switch (c)
       {
           case ',':
           {
               if (builder.Length > 0)
               {
                   yield return new Token(TokenType.ColumnData, ExtractText(builder));
               }
               yield return new Token(TokenType.Comma);
               break;
           }
           case '\r':
           {
                var next = s.Peek();
                if (next == '\n')
                {
                    s.Read();
                }

                if (builder.Length > 0)
                {
                    yield return new Token(TokenType.ColumnData, ExtractText(builder));
                }
                yield return new Token(TokenType.LineTerminator);
                break;
           }
           default:
               builder.Append(c);
               break;
       }

   }

   s.Read();

   if (builder.Length > 0)
   {
       yield return new Token(TokenType.ColumnData, ExtractText(builder));
   }
}

private string ExtractText(StringBuilder b)
{
    var ret = b.ToString();
    b.Remove(0, b.Length);
    return ret;
} 
```

您的“解析器”代码将如下所示：

```
public void ConvertXLS(TextReader s)
{
    var columnData = new List<string>();
    bool lastWasColumnData = false;
    bool seenAnyData = false;

    foreach (var token in GetTokens(s))
    {
        switch (token.Type)
        {
            case TokenType.ColumnData:
            {
                 seenAnyData = true;
                 if (lastWasColumnData)
                 {
                     //TODO: do some error reporting
                 }
                 else
                 {
                     lastWasColumnData = true;
                     columnData.Add(token.Data);
                 }
                 break;
            }
            case TokenType.Comma:
            {
                if (!lastWasColumnData)
                {
                    columnData.Add(null);
                }
                lastWasColumnData = false;
                break;
            }
            case TokenType.LineTerminator:
            {
                if (seenAnyData)
                {
                    OutputLine(lastWasColumnData);
                }
                seenAnyData = false;
                lastWasColumnData = false;
                columnData.Clear();
            }
        }
    }

    if (seenAnyData)
    {
        OutputLine(columnData);
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-20T20:12:24.120

您无法更改`StreamReader`以返回线路终止符，也无法更改它用于线路终止的内容。

我并不完全清楚你正在做什么转义方面的问题，特别是在“并将它们写为 \x0A”方面。该文件的样本可能会有所帮助。

听起来您*可能*需要逐个字符地工作，或者可能首先加载整个文件并进行全局替换，例如

```
x.Replace("\r\n", "\u0000") // Or some other unused character
 .Replace("\n", "\\x0A") // Or whatever escaping you need
 .Replace("\u0000", "\r\n") // Replace the real line breaks 
```

我相信你可以用正则表达式来做到这一点，它可能会更有效，但我发现还有很长的路要走更容易理解 :) 不过，不得不进行全局替换有点麻烦 - 希望我们能提供更多信息会想出更好的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T20:24:01.347

本质上，Excel 中的硬返回（shift+enter 或 alt+enter，我不记得了）在我用来编写 CSV 的默认编码中放置了一个相当于 \x0A 的换行符。当我写入 CSV 时，我使用 StreamWriter.WriteLine()，它输出行加上换行符（我相信是 \r\n）。

CSV 很好，并且准确地显示 Excel 将如何保存它，问题是当我将它读入空白记录删除器时，我正在使用 ReadLine() 它将带有嵌入换行符的记录视为 CRLF。

这是我转换为 CSV 后的文件示例...

```
Reference,Name of Individual or Entity,Type,Name Type,Date of Birth,Place of Birth,Citizenship,Address,Additional Information,Listing Information,Control Date,Committees
1050,"Aziz Salih al-Numan
",Individual,Primary Name,1941 or 1945,An Nasiriyah,Iraqi,,Ba’th Party Regional Command Chairman; Former Governor of Karbala and An Najaf Former Minister of Agriculture and Agrarian Reform (1986-1987),Resolution 1483 (2003),6/27/2003,1518 (Iraq)
1050a,???? ???? ???????,Individual,Original script,1941 or 1945,An Nasiriyah,Iraqi,,Ba’th Party Regional Command Chairman; Former Governor of Karbala and An Najaf Former Minister of Agriculture and Agrarian Reform (1986-1987),Resolution 1483 (2003),6/27/2003,1518 (Iraq) 
```

如您所见，第一条记录在 al-Numan 之后嵌入了换行符。当我使用 ReadLine() 时，我得到 '1050,"Aziz Salih al-Numan'，当我写出它时，WriteLine() 以 CRLF 结束该行。我丢失了原始行终止符。当我再次使用 ReadLine() ，我得到以'1050a'开头的行。

我可以读入整个文件并替换它们，但之后我必须将它们替换回来。基本上我想要做的是让行终止符来确定它是 \x0a 还是 CRLF，然后如果它是 \x0A，我将使用 Write() 并插入该终止符。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-12T21:41:34.617

我知道我在这里玩游戏有点晚了，但我遇到了同样的问题，我的解决方案比大多数给出的要简单得多。

如果您能够确定应该很容易做到的列数，因为第一行通常是列标题，您可以根据预期的列数检查列数。如果列数不等于预期的列数，您只需将当前行与之前不匹配的行连接起来。例如：

```
string sep = "\",\"";
int columnCount = 0;
while ((currentLine = sr.ReadLine()) != null)
{
    if (lineCount == 0)
    {
        lineData = inLine.Split(new string[] { sep }, StringSplitOptions.None);
        columnCount = lineData.length;
        ++lineCount;
        continue;
    }
    string thisLine = lastLine + currentLine;

    lineData = thisLine.Split(new string[] { sep }, StringSplitOptions.None);
    if (lineData.Length < columnCount)
    {
        lastLine += currentLine;
        continue;
    }
    else
    {
        lastLine = null;
    }
    ...... 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-28T13:26:10.703

非常感谢您的代码和其他一些我想出了以下解决方案！我在底部添加了一个链接，指向我编写的一些代码，这些代码使用了此页面中的一些逻辑。我想我会在应该获得荣誉的地方给予荣誉！谢谢！

下面是关于我需要什么的解释：试试这个，我写这个是因为我有一些非常大的“|” 在某些列中有 \r\n 的分隔文件，我需要使用 \r\n 作为行尾分隔符。我试图使用 SSIS 包导入一些文件，但由于文件中的一些损坏的数据，我无法导入。该文件超过 5 GB，因此太大而无法打开和手动修复。我通过查看大量论坛以了解流的工作原理并最终提出了一个解决方案，该解决方案读取文件中的每个字符并根据我添加到其中的定义吐出该行，从而找到了答案。这是在命令行应用程序中使用的，带有帮助:)。我希望这可以帮助其他人，我在其他任何地方都没有找到类似的解决方案，

[https://stackoverflow.com/a/12640862/1582188](https://stackoverflow.com/a/12640862/1582188)

# sql-server - 使用 SMO 运行 SQL 安装脚本。需要替代解决方案

> ID：667777
> 
> 赞同：2
> 
> 时间：2009-03-20T20:07:54.490
> 
> 标签：sql-server, scripting, installation, smo

我有一个使用 Microsoft Sql 管理对象 (SMO) dll 的 Web 应用程序。我想知道如何重新分配远程机器的库。

据我了解，这些随 SQL 服务器或 Sql express 一起提供——它们不在远程（共享）网络服务器上。要求主机安装，可能是不可能的，那么是否可以动态加载它们？

请参阅下面的错误 -

无法加载文件或程序集“Microsoft.SqlServer.Smo，Version=9.0.242.0，Culture=neutral，PublicKeyToken=89845dcd8080cc91”或其依赖项之一。该系统找不到指定的文件。

或者，如果任何人都可以为下面的代码片段提供一种解决方法，这也是有用的。script 变量是一个 SQL 安装脚本，已经读到最后。这样做的好处是从 SQL 输出每个执行字符串。我当然可以只在一个块中执行它，但这不会逐行向用户提供视觉反馈，表明 sql 执行正常。

有没有可以执行这种事情的存储过程？或者在没有完全权限的情况下执行安装脚本的另一种方法。

```
 Dim connection As New SqlConnection(Me.ConnectionString)

            connection.Open()
            connection.Close()

            Dim server As New Server(New ServerConnection(connection))
            server.ConnectionContext.SqlExecutionModes = SqlExecutionModes.ExecuteAndCaptureSql
            Dim commands As StringCollection = server.ConnectionContext.CapturedSql.Text
            server.ConnectionContext.ExecuteNonQuery(script, ExecutionTypes.ContinueOnError)

            Dim s As String
            For Each s In server.ConnectionContext.CapturedSql.Text
                AppendMessages(s)
            Next 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T09:50:11.470

[http://www.mattberther.com/2005/04/11/executing-a-sql-script-using-adonet/](http://www.mattberther.com/2005/04/11/executing-a-sql-script-using-adonet/)

从

[http://coolthingoftheday.blogspot.com/2006/11/execute-t-sql-scripts-with-gos.html](http://coolthingoftheday.blogspot.com/2006/11/execute-t-sql-scripts-with-gos.html)

是我一直在寻找的，并且成功了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T16:18:00.540

你可以尝试使用sql server自带的[sqlcmd utilty](http://msdn.microsoft.com/en-us/library/ms162773.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T13:36:03.383

不，你不能动态加载它们，不，你不能在没有权限的情况下安装它们。很抱歉，但那里没有骰子。

# model-view-controller - MVC 和 MVVM 有什么区别？

> ID：667781
> 
> 赞同：1395
> 
> 时间：2009-03-20T20:09:18.777
> 
> 标签：model-view-controller, mvvm, design-patterns

标准的“模型视图控制器”模式和微软的模型/视图/视图模型模式有区别吗？

* * *

## 回答 #1

> 赞同：725
> 
> 时间：2010-08-22T09:19:15.567

## MVC/MVVM 不是*非此即彼*的选择。

这两种模式以不同的方式出现在 ASP.Net 和 Silverlight/WPF 开发中。

对于 ASP.Net，MVVM 用于在视图*中双向绑定*数据。这通常是客户端实现（例如使用 Knockout.js）。另一方面，MVC 是一种*在服务器端*分离关注点的方法。

对于 Silverlight 和 WPF，MVVM 模式更具包容性，*看起来*可以替代 MVC（或其他将软件组织成单独职责的模式）。这种模式经常出现的一个假设是，简单地替换了`ViewModel`控制器`MVC`（好像你可以在首字母缩写词中替换，一切都会被原谅）......`VM``C`

## ViewModel*不一定*会取代对单独控制器的需求。

问题是：要独立测试*，特别是在需要时可重用，视图模型不知道显示它的视图是什么，但更重要的是*不知道它的数据来自哪里*。

*注意：实际上，控制器从 ViewModel 中删除了大部分需要单元测试的逻辑。然后，VM 变成了一个只需要很少（如果有的话）测试的哑容器。这是一件好事，因为 VM 只是设计人员和编码人员之间的桥梁，所以应该保持简单。

即使在 MVVM 中，控制器通常也会包含所有处理逻辑，并决定使用哪些视图模型在哪些视图中显示哪些数据。

从目前我们所看到的来看，ViewModel 模式的主要好处是从 XAML 代码隐藏中删除代码，*从而使 XAML 编辑成为一项更加独立的任务*。我们仍然在需要时创建控制器来控制（没有双关语）我们应用程序的整体逻辑。

## 我们遵循的基本 MVCVM 指南是：

*   视图*显示某种形状的数据*。他们不知道数据来自哪里。
*   ViewModel*持有某种形状的数据和命令*，它们不知道数据或代码来自哪里或如何显示。
*   模型*保存实际数据*（各种上下文、存储或其他方法）
*   控制器监听并发布事件。控制器提供了控制可以查看哪些数据以及在何处查看数据的逻辑。控制器向 ViewModel 提供命令代码，以便 ViewModel 实际上是可重用的。

我们还注意到，[Sculpture 代码生成框架](https://www.codeproject.com/Articles/29051/Introduction-to-Model-Driven-Development-with-Scul)实现了 MVVM 和类似于 Prism 的模式，并且它还广泛使用控制器来分离所有用例逻辑。

## 不要假设控制器已被视图模型淘汰。

[我已经开始了一个关于这个主题的博客，我会在可以的时候添加（仅在主机丢失时存档）](https://web.archive.org/web/20180430230531/http://blog.hitechmagic.com/?page_id=513)。将 MVCVM 与常见的导航系统结合起来存在问题，因为大多数导航系统只使用视图和虚拟机，但我将在以后的文章中讨论。

使用 MVCVM 模型的另一个好处是，*在应用程序的整个生命周期中，只有控制器对象需要存在于内存中，*并且控制器主要包含代码和很少的状态数据（即很小的内存开销）。与必须保留视图模型的解决方案相比，这使得内存密集型应用程序的内存占用少得多，并且它非常适合某些类型的移动开发（例如，使用 Silverlight/Prism/MEF 的 Windows Mobile）。这当然取决于应用程序的类型，因为您可能仍需要保留偶尔缓存的 VM 以提高响应速度。

*注意：这篇文章已被多次编辑，并没有专门针对所提出的狭隘问题，所以我已经更新了第一部分，现在也涵盖了。以下评论中的大部分讨论仅与 ASP.Net 相关，与更广泛的情况无关。这篇文章旨在涵盖 MVVM 在 Silverlight、WPF 和 ASP.Net 中的更广泛使用，并试图阻止人们用 ViewModels 替换控制器。*

* * *

## 回答 #2

> 赞同：326
> 
> 时间：2013-02-13T14:11:57.827

我认为理解这些首字母缩略词应该意味着什么的最简单方法是暂时忘记它们。相反，想想他们所使用的软件，每一个。它真的归结为早期网络和桌面之间的区别。

随着它们在 2000 年代中期变得越来越复杂，在 1970 年代首次描述的 MVC 软件设计模式开始应用于 Web 应用程序。想想数据库、HTML 页面和介于两者之间的代码。让我们稍微改进一下以达到 MVC：对于»database«，让我们假设数据库加上接口代码。对于»HTML 页面«，我们假设 HTML 模板加上模板处理代码。对于“中间代码”，我们假设代码将用户点击映射到操作，可能会影响数据库，肯定会导致显示另一个视图。就是这样，至少出于比较的目的。

让我们保留这个 Web 东西的一个特性，而不是像今天这样，而是像十年前那样，当时 JavaScript 是一种卑鄙、卑鄙的烦恼，真正的程序员很好地避开了这一点：HTML 页面本质上是愚蠢和被动的. 浏览器是一个瘦客户端，或者如果你愿意的话，一个糟糕的客户端。浏览器没有智能。整页重新加载规则。»view« 每次都会重新生成。

让我们记住，这种网络方式尽管风靡一时，但与桌面相比却是可怕的落后。如果您愿意，桌面应用程序是胖客户端或富客户端。（即使是像 Microsoft Word 这样的程序也可以被认为是某种客户端，一个文档客户端。）它们是充满智慧的客户端，对他们的数据充满了知识。他们是有状态的。他们将正在处理的数据缓存在内存中。没有像整页重新加载这样的废话。

而这种丰富的桌面方式可能就是第二个缩写词 MVVM 的起源。不要被字母和 C 的遗漏所迷惑。控制器仍然存在。他们需要。什么都没有被删除。我们只添加一件事：有状态，缓存在客户端的数据（以及处理该数据的智能）。该数据，本质上是客户端上的缓存，现在被称为 »ViewModel«。它允许丰富的交互性。就是这样。

*   MVC = 模型、控制器、视图 = 本质上是单向通信 = 交互性差
*   MVVM = 模型、控制器、缓存、视图 = 双向通信 = 丰富的交互性

我们可以看到，借助 Flash、Silverlight 以及——最重要的——JavaScript，网络已经接受了 MVVM。浏览器不能再被合法地称为瘦客户端。看看它们的可编程性。看看他们的内存消耗。查看现代网页​​上的所有 Javascript 交互性。

就个人而言，我发现这个理论和首字母缩略词业务通过查看它在具体现实中所指的内容更容易理解。抽象概念很有用，尤其是在具体问题上进行演示时，因此理解可能会绕一圈。

* * *

## 回答 #3

> 赞同：181
> 
> 时间：2009-03-20T20:18:53.747

[MVVM](http://en.wikipedia.org/wiki/Model_View_ViewModel) **Model-View ViewModel**类似于MVC，**Model-View Controller**

**控制器**被替换为**ViewModel**。ViewModel 位于 UI 层之下。ViewModel 公开视图所需的数据和命令对象。您可以将其视为视图从中获取其数据和操作的容器对象。ViewModel 从模型中提取数据。

***Russel East***写了一篇博客，更详细地讨论了 [为什么 MVVM 与 MVC 不同](http://russelleast.wordpress.com/2008/08/09/overview-of-the-modelview-viewmodel-mvvm-pattern-and-data-binding/)

* * *

## 回答 #4

> 赞同：98
> 
> 时间：2009-03-20T20:17:36.383

一方面，MVVM 是 MVC 模式的发展，它使用 XAML 来处理显示。 [本文](http://www.orbifold.net/default/?p=550)概述了两者的一些方面。

> 模型/视图/视图模型架构的主要推动力似乎是在数据（“模型”）之上，还有另一层非可视组件（“视图模型”）更紧密地映射数据的概念数据视图（“视图”）的概念。View 绑定的是 ViewModel，而不是 Model 直接绑定。

* * *

## 回答 #5

> 赞同：57
> 
> 时间：2013-06-12T20:48:46.460

Microsoft[在此处提供了对 Windows 环境中的 MVVM 模式的解释](http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj721615%28v=vs.105%29.aspx)。

这是一个关键部分：

> 在 Model-View-ViewModel 设计模式中，一个应用程序由三个通用组件组成。![在此处输入图像描述](https://i.stack.imgur.com/qmuTb.png)
> 
> *   **模型**：这表示您的应用使用的数据模型。例如，在图片共享应用程序中，该层可能表示设备上可用的图片集以及用于读取和写入图片库的 API。
>     
>     
> *   **视图**：一个应用程序通常由多个 UI 页面组成。向用户显示的每个页面都是 MVVM 术语中的视图。视图是用于定义和设置用户所见内容的 XAML 代码。模型中的数据显示给用户，ViewModel 的工作是根据应用程序的当前状态向 UI 提供这些数据。例如，在图片共享应用程序中，视图将是向用户显示设备上的相册列表、相册中的图片以及向用户显示特定图片的另一个 UI。
>     
>     
> *   **ViewModel**：ViewModel 将数据模型或简称模型与应用程序的 UI 或视图联系起来。它包含用于管理来自模型的数据的逻辑，并将数据作为一组属性公开，XAML UI 或视图可以绑定到这些属性。例如，在图片共享应用程序中，ViewModel 会公开一个相册列表，并为每个相册公开一个图片列表。UI 不知道图片的来源和检索方式。它只知道 ViewModel 公开的一组图片并将它们显示给用户。

* * *

## 回答 #6

> 赞同：51
> 
> 时间：2010-05-21T11:38:25.723

我认为主要区别之一是在 MVC 中，您的 V 直接读取您的 M，并通过 C 来操作数据，而在 MVVM 中，您的 VM 充当 M 代理，并为您提供可用的功能五。

如果我没有满是垃圾，我很惊讶没有人创建混合，您的 VM 只是一个 M 代理，而 C 提供所有功能。

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2017-01-25T05:15:21.007

**MVC 是受控环境，MVVM 是反应式环境。**

在受控环境中，您应该拥有更少的代码和通用的逻辑源；它应该始终存在于控制器中。然而; 在 Web 世界中，MVC 很容易分为视图创建逻辑和视图动态逻辑。创作存在于服务器上，动态存在于客户端。您可以在 ASP.NET MVC 与 AngularJS 的结合中看到很多，而服务器将创建一个视图并传入一个模型并将其发送到客户端。然后客户端将与视图交互，在这种情况下，AngularJS 会作为本地控制器介入。提交后，模型或新模型将传回服务器控制器并进行处理。（因此循环继续，并且在使用套接字或 AJAX 等时，这种处理有很多其他的翻译，但总体而言，架构是相同的。）

MVVM 是一种反应式环境，这意味着您通常编写将基于某些事件激活的代码（例如触发器）。在 MVVM 蓬勃发展的 XAML 中，这一切都可以通过内置的数据绑定框架轻松完成，但如前所述，这将在任何视图中使用任何编程语言的任何系统上工作。它不是特定于 MS 的。ViewModel 触发（通常是属性更改事件），View 根据您创建的任何触发器对其做出反应。这可能是技术性的，但底线是视图是无状态的并且没有逻辑。它只是根据值更改状态。此外，ViewModel 是无状态的，逻辑很少，而模型是具有本质上零逻辑的状态，因为它们应该只维护状态。我将其描述为应用程序状态（模型）、状态转换器（视图模型），然后是视觉状态/交互（视图）。

在 MVC 桌面或客户端应用程序中，您应该有一个模型，并且该模型应该由控制器使用。基于模型，控制器将修改视图。视图通常与具有接口的控制器绑定，以便控制器可以与各种视图一起工作。在 ASP.NET 中，MVC 的逻辑在服务器上稍微倒退，因为控制器管理模型并将模型传递给选定的视图。然后，视图会根据模型填充数据并具有自己的逻辑（通常是另一个 MVC 集，例如使用 AngularJS 完成的）。人们会争论并将这与应用程序 MVC 混淆，并尝试两者都做，此时维护项目最终将成为一场灾难。使用 MVC 时，始终将逻辑和控制放在一个位置。不要在 View 后面的代码中（或通过 JS 用于 Web 的 View 中）编写 View 逻辑来容纳 Controller 或 Model 数据。让控制器改变视图。应该存在于视图中的唯一逻辑是通过它使用的接口创建和运行所需的一切。这方面的一个例子是提交用户名和密码。无论是桌面还是网页（在客户端），只要 View 触发 Submit 操作，Controller 都应该处理提交过程。如果操作正确，您总是可以轻松地在 MVC Web 或本地应用程序中找到自己的方式。无论是桌面还是网页（在客户端），只要 View 触发 Submit 操作，Controller 都应该处理提交过程。如果操作正确，您总是可以轻松地在 MVC Web 或本地应用程序中找到自己的方式。无论是桌面还是网页（在客户端），只要 View 触发 Submit 操作，Controller 都应该处理提交过程。如果操作正确，您总是可以轻松地在 MVC Web 或本地应用程序中找到自己的方式。

MVVM 是我个人最喜欢的，因为它完全是反应式的。如果模型更改状态，ViewModel 会监听并转换该状态，仅此而已！！！然后 View 会监听 ViewModel 的状态变化，它还会根据 ViewModel 的转换进行更新。有些人称它为纯 MVVM，但实际上只有一个，我不在乎你如何争论它，它始终是纯 MVVM，其中视图绝对不包含任何逻辑。

这是一个小例子：假设您希望在按下按钮时滑入菜单。在 MVC 中，您的界面中将有一个 MenuPressed 操作。当你点击 Menu 按钮时，Controller 会知道，然后根据另一个 Interface 方法（例如 SlideMenuIn）告诉 View 在 Menu 中滑动。往返是什么原因？如果控制器决定您不能或想要做其他事情，这就是原因。Controller 应该负责 View，除非 Controller 这么说，否则 View 什么都不做。然而; 在 MVVM 中，动画中的幻灯片菜单应该是内置的并且是通用的，而不是被告知将其滑入，而是基于某些值。所以它会监听 ViewModel 并且当 ViewModel 说 IsMenuActive = true （或者无论如何）时，动画就会发生。现在，话虽如此，我想真正清楚地说明另一点，请注意。IsMenuActive 可能是 BAD MVVM 或 ViewModel 设计。在设计 ViewModel 时，您永远不应该假设 View 将具有任何功能并且只是传递已转换的模型状态。这样，如果您决定更改视图以删除菜单并仅以另一种方式显示数据/选项，则 ViewModel 不在乎。那么您将如何管理菜单？当数据有意义时，就是这样。因此，一种方法是给 Menu 一个选项列表（可能是内部 ViewModel 的数组）。如果该列表有数据，则菜单知道通过触发器打开，如果没有，则它知道通过触发器隐藏。您只需在 ViewModel 中有或没有菜单的数据。不要决定在 ViewModel 中显示/隐藏该数据。简单地转换模型的状态。这种方式视图是完全反应和通用的，可以在许多不同的情况下使用。

如果您还没有至少稍微熟悉每个架构的架构并且学习它可能会非常混乱，因为您会在网上找到很多糟糕的信息，那么所有这些可能完全没有意义。

所以...要记住这一点，要记住的事情。预先决定如何设计您的应用程序并坚持下去。

如果您使用 MVC，这很棒，那么请确保您的 Controller 是可管理的并且可以完全控制您的 View。如果您有一个大视图，请考虑向具有不同控制器的视图添加控件。只是不要将这些控制器级联到不同的控制器。维护起来非常令人沮丧。花点时间以一种可以作为单独组件工作的方式单独设计事物......并且始终让控制器告诉模型提交或持久存储。MVC 中的理想依赖设置是**View ← Controller → Model** 或使用 ASP.NET（不要让我开始）**Model ← View ↔ Controller → Model （其中 Model 可以是相同的，也可以是完全不同的 Model 从控制器到视图）**...当然，此时唯一需要了解 View 中的 Controller 主要是为了端点参考，以了解将模型传回何处。

如果你做 MVVM，我会祝福你善良的灵魂，但请花时间做对！不要使用接口之一。让您的视图根据值决定它的外观。使用模拟数据查看视图。如果您最终拥有一个向您显示菜单的视图（根据示例），即使您当时不想要它，那么很好。您的观点正在按应有的方式工作，并根据应有的价值观做出反应。只需向您的触发器添加更多要求，以确保当 ViewModel 处于特定的已翻译状态或命令 ViewModel 清空此状态时不会发生这种情况。在您的 ViewModel 中不要使用内部逻辑删除它，就好像您正在从那里决定视图是否应该看到它一样。请记住，您不能假设 ViewModel 中有或没有菜单。最后，模型应该只允许您更改并且最有可能存储状态。这就是验证和一切都会发生的地方；例如，如果模型不能修改状态，那么它只会将自己标记为脏或其他东西。当 ViewModel 意识到这一点时，它将翻译什么是脏的，然后 View 将意识到这一点并通过另一个触发器显示一些信息。View 中的所有数据都可以绑定到 ViewModel，因此只有 Model 可以是动态的，而 ViewModel 完全不知道 View 将如何对绑定做出反应。事实上，模型也不知道视图模型。设置依赖项时，他们应该这样指向并且只指向这样 t 修改状态然后它会简单地将自己标记为脏或其他东西。当 ViewModel 意识到这一点时，它将翻译什么是脏的，然后 View 将意识到这一点并通过另一个触发器显示一些信息。View 中的所有数据都可以绑定到 ViewModel，因此只有 Model 可以是动态的，而 ViewModel 完全不知道 View 将如何对绑定做出反应。事实上，模型也不知道视图模型。设置依赖项时，他们应该这样指向并且只指向这样 t 修改状态然后它会简单地将自己标记为脏或其他东西。当 ViewModel 意识到这一点时，它将翻译什么是脏的，然后 View 将意识到这一点并通过另一个触发器显示一些信息。View 中的所有数据都可以绑定到 ViewModel，因此只有 Model 可以是动态的，而 ViewModel 完全不知道 View 将如何对绑定做出反应。事实上，模型也不知道视图模型。设置依赖项时，他们应该这样指向并且只指向这样 View 中的所有数据都可以绑定到 ViewModel，因此只有 Model 可以是动态的，而 ViewModel 完全不知道 View 将如何对绑定做出反应。事实上，模型也不知道视图模型。设置依赖项时，他们应该这样指向并且只指向这样 View 中的所有数据都可以绑定到 ViewModel，因此只有 Model 可以是动态的，而 ViewModel 完全不知道 View 将如何对绑定做出反应。事实上，模型也不知道视图模型。设置依赖项时，他们应该这样指向并且只指向这样**View → ViewModel → Model** （以及这里的旁注......这也可能会引起争论，但我不在乎......不要将模型传递给视图，除非该模型是不可变的；否则用正确的视图模型。视图不应该看到模型周期。我给老鼠破解你看过的演示或你是如何做到的，这是错误的。）

这是我的最后一个提示... 查看一个设计良好但非常简单的 MVC 应用程序，并为 MVVM 应用程序做同样的事情。一个人将拥有更多的控制权，但灵活性有限，而另一个人将没有控制权和无限的灵活性。

受控环境有利于从一组控制器或（单个源）管理整个应用程序，而反应式环境可以分解为单独的存储库，完全不知道应用程序的其余部分在做什么。微观管理与自由管理。

如果我还没有让您感到困惑，请尝试与我联系...我不介意通过插图和示例详细了解这一点。

归根结底，我们都是程序员，并且在编码时存在着无政府状态......所以规则会被打破，理论会改变，所有这一切最终都会被洗白......但是当在大型工作时在项目和大型团队中，就设计模式达成一致并实施它确实很有帮助。有朝一日，它会使一开始采取的额外小步骤在以后成为突飞猛进的储蓄。

* * *

## 回答 #8

> 赞同：31
> 
> 时间：2016-12-14T00:20:05.407

简单的区别：（受 Yaakov 的 Coursera AngularJS 课程启发）

[![在此处输入图像描述](https://i.stack.imgur.com/zoL2x.png)](https://i.stack.imgur.com/zoL2x.png)

**MVC**（模型视图控制器）

1.  **模型：**模型包含数据信息。不调用或使用 Controller 和 View。包含业务逻辑和表示数据的方式。这些数据中的一些可能以某种形式显示在视图中。它还可以包含从某个源检索数据的逻辑。
2.  **控制器：**充当视图和模型之间的连接。视图调用控制器，控制器调用模型。它基本上通知模型和/或视图进行适当的更改。
3.  **View：**处理 UI 部分。与用户交互。

**MVVM**（模型视图视图模型）

**视图模型**：

1.  它是视图状态的表示。
2.  它保存视图中显示的数据。
3.  响应查看事件，也就是表示逻辑。
4.  调用其他功能进行业务逻辑处理。
5.  永远不要直接要求视图显示任何内容。

* * *

## 回答 #9

> 赞同：26
> 
> 时间：2018-05-19T06:19:42.433

对于不太熟悉架构模式主题的人来说，其他答案可能不容易理解。对应用程序架构不熟悉的人可能想知道它的选择如何在实践中影响她的应用程序以及社区中的所有大惊小怪。

为了阐明上述内容，我编写了这个涉及 MVVM、MVP 和 MVC 的剧本。故事从用户点击电影搜索应用程序中的“查找”按钮开始……：

用户：点击……</p>

*观点*：那是谁？[ **MVVM|MVP|MVC** ]

用户：我刚刚点击了搜索按钮……</p>

*观点*：好的，等一下…… [ **MVVM|MVP|MVC** ]

（*视图*调用*ViewModel* | *Presenter* | *Controller* ...） [ **MVVM|MVP|MVC** ]

*视图*：嘿*ViewModel* | *主持人*| *控制器*，一个用户刚刚点击了搜索按钮，我该怎么办？[ **MVVM|MVP|MVC** ]

*视图模型*| *主持人*| *控制器*：嘿*视图*，那个页面上有搜索词吗？[ **MVVM|MVP|MVC** ]

*观点*：是的，……这里是……“钢琴” [ **MVVM|MVP|MVC** ]

**—— 这是MVVM**和**MVP**最重要的区别| **MVC** ———</p>

*主持人*| *控制器*：谢谢*View*，... 同时我正在查找*模型*上的搜索词，请给他/她显示一个进度条 [ **MVP** | **MVC** ]

（*Presenter* | *Controller*正在调用*模型*……） [ **MVP** | **MVC** ]

*ViewModel ：谢谢，我会在**Model*上查找搜索词，但不会直接更新您。相反，如果有任何结果，我将触发事件到 searchResultsListObservable。所以你最好注意这一点。[ **MVVM** ]

（在观察 searchResultsListObservable 中的任何触发器时，*View*认为它应该向用户显示一些进度条，因为*ViewModel*不会与它对话）

——————————————————————————————</p>

*视图模型*| *主持人*| *控制器*：嘿*模型*，你有匹配这个搜索词吗？：“钢琴” [ **MVVM** | **最有价值球员**| **MVC** ]

*型号*：嘿*ViewModel* | *主持人*| *控制器*，让我检查一下…… [ **MVVM** | **最有价值球员**| **MVC** ]

（*模型*正在查询电影数据库……） [ **MVVM** | **最有价值球员**| **MVC** ]

（ 过了一会儿 … ）

**————这就是MVVM**、**MVP**和**MVC**的分歧点 ——————</p>

*模型*：我为你找到了一个列表，*ViewModel* | *Presenter*，这里是 JSON “[{“name”:”Piano Teacher”,”year”:2001},{“name”:”Piano”,”year”:1993}]” [ **MVVM** | **最有价值球员**]

*模型*：有一些可用的结果，控制器。我在我的实例中创建了一个字段变量并用结果填充它。它的名字是“searchResultsList” [ **MVC** ]

（*Presenter* | *Controller*感谢*Model*并返回*View*） [ **MVP** | **MVC** ]

*主持人*：感谢您的等待，我为您找到了一个匹配结果列表，并将它们排列成一个像样的格式：[“Piano Teacher 2001”，”Piano 1993”] *。*也请现在隐藏进度条[ **MVP** ]

*控制器*：感谢您等待*View*，我已经向 Model 询问了您的搜索查询。它说它找到了一个匹配结果列表并将它们存储在其实例内名为“searchResultsList”的变量中。你可以从那里得到它。也请现在隐藏进度条 [ **MVC** ]

*ViewModel* : searchResultsListObservable 上的任何观察者都会被通知有这个新列表的格式：[“Piano Teacher 2001”，”Piano 1993”]。[ **MVVM** ]

*观点*：非常感谢Presenter [ **MVP** ]

*View* : 谢谢“<em>Controller” [ **MVC** ] （现在*View*正在质疑自己：我应该如何将我从*模型*中得到的结果呈现给用户？电影的制作年份应该排在第一位还是最后...？）

*View* : 哦，在 searchResultsListObservable 里有一个新的触发器……，很好，有一个像样的列表，现在我只需要在一个列表中显示它。既然我有结果，我也应该隐藏进度条。[ **MVVM** ]

[如果你有兴趣，我在这里](http://www.digigene.com/android-architecture-wolfkcats)写了一系列文章，通过实现一个电影搜索安卓应用程序来比较 MVVM、MVP 和 MVC。

* * *

## 回答 #10

> 赞同：19
> 
> 时间：2009-03-27T21:22:48.900

MVVM 是[表示模型](http://martinfowler.com/eaaDev/PresentationModel.html)模式的改进（有争议）。我说有争议，因为唯一的区别在于 WPF 如何提供数据绑定和命令处理的能力。

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2010-03-23T10:16:15.053

视图模型是用户界面元素的“抽象”模型。它必须允许您以非可视方式执行视图中的命令和操作（例如测试它）。

如果您使用过 MVC，您可能有时会发现创建模型对象以反映视图的状态很有用，例如，显示和隐藏一些编辑对话框等。在这种情况下，您使用的是视图模型。

MVVM 模式只是将该实践推广到所有 UI 元素。

而且它不是 Microsoft 模式，附加的是 WPF / Silverlight 数据绑定特别适合使用这种模式。但是，例如，没有什么能阻止您将它与 java 服务器端一起使用。

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2014-08-26T06:23:32.120

令我惊讶的是，这是一个投票率很高的答案，却没有提及 MVVM 的**起源**。[MVVM](http://en.wikipedia.org/wiki/Model_View_ViewModel)是微软社区中使用的一个流行术语，它**起源**于 Martin Fowler 的[Presentation Model](http://martinfowler.com/eaaDev/PresentationModel.html)。因此，要了解该模式的动机以及与其他模式的不同之处，首先要阅读有关该模式的原始文章。

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2014-10-15T13:58:29.890

## 使用 MVC 将强类型视图模型注入视图

1.  控制器负责更新 ViewModel 并将其注入到 View 中。（用于获取请求）
2.  ViewModel 是 DataContext 和视图状态的容器，例如最后选择的项目等。
3.  该模型包含数据库实体，并且非常接近它执行查询和过滤的数据库模式。（为此我喜欢 EF 和 LINQ）
4.  模型还应该考虑将存储库和/或结果投影到强类型中（EF 有一个很好的方法...... EF.Database.Select(querystring, parms) 用于直接 ADO 访问以注入查询并取回强类型。这解决了 EF是缓慢的论点**。EF 不慢**！
5.  ViewModel 获取数据并执行业务规则和验证
6.  **回**发的控制器将调用 ViewModel Post 方法并等待结果。
7.  控制器会将新更新的 Viewmodel 注入到 View 中。视图**只使用强类型绑定**。
8.  视图仅呈现数据，并将事件发送回控制器。（见下面的例子）
9.  MVC 拦截入站请求并将其路由到具有**强数据类型的适当控制器**

在这个模型中，*不再有*与​​请求或响应对象的 HTTP 级别联系，因为 MSFT 的 MVC 机器对我们隐藏了它。

**为澄清上述第 6 项（应要求）...**

假设一个 ViewModel 是这样的：

```
public class myViewModel{
     public string SelectedValue {get;set;}
public void Post(){
    //due to MVC model binding the SelectedValue string above will be set by MVC model binding on post back.
    //this allows you to do something with it.
    DoSomeThingWith(SelectedValue);
    SelectedValue = "Thanks for update!";
 }
} 
```

帖子的控制器方法将如下所示（见下文），请注意 mvm 的实例是由 MVC 绑定机制自动实例化的。结果，您永远不必下拉到查询字符串层！这是 MVC 根据查询字符串为您实例化 ViewModel！

```
[HTTPPOST]   
public ActionResult MyPostBackMethod (myViewModel mvm){
         if (ModelState.IsValid)
        {
               // Immediately call the only method needed in VM...
               mvm.Post()
        }
      return View(mvm);
} 
```

请注意，为了使上述操作方法按您的预期工作，您必须定义一个空 CTOR 来初始化帖子中未返回的内容。回发还必须回发那些更改的名称/值对。如果缺少名称/值对，MVC 绑定引擎会做正确的事情，这根本就什么都不是！如果发生这种情况，您可能会发现自己说“我正在丢失回发数据”......

这种模式的优点是 ViewModel 完成了与模型/业务逻辑接口的所有“杂乱”工作，控制器只是某种路由器。这是 SOC 在行动。

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2009-03-20T20:20:58.297

MVVM 将视图模型添加到组合中。这很重要，因为它允许您使用 WPF 的大量绑定方法，而无需将所有 UI 特定部分放入常规模型中。

我可能是错的，但我不确定 MVVM 是否真的强制控制器进入混合状态。我发现这个概念更符合：[http](http://martinfowler.com/eaaDev/PresentationModel.html) ://martinfowler.com/eaaDev/PresentationModel.html 。我认为人们选择将它与 MVC 结合起来，而不是它内置在模式中。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2010-08-22T07:42:43.773

据我所知，MVVM 映射到 MVC 的 MV——这意味着在传统的 MVC 模式中，V 不直接与 M 通信。在 MVC 的第二个版本中，M 和 V 之间存在直接链接。MVVM似乎承担了与 M 和 V 通信相关的所有任务，并将其与 C 解耦。实际上，仍然存在更大范围的应用程序工作流（或使用场景的实现），但在 MVVM 中没有完全考虑。这就是控制器的作用。通过从控制器中移除这些较低级别的方面，它们更干净，并且更容易修改应用程序的使用场景和业务逻辑，也使控制器更具可重用性。

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2019-11-11T05:57:19.487

**MVVM**

1.  视图➡视图模型➡模型

*   该视图具有对 ViewModel 的引用，但反之则不然。
*   ViewModel 具有对 Model 的引用，但反之则不然。
*   视图没有参考模型，反之亦然。

2.  如果您使用的是控制器，它可以引用**Views**和**ViewModels**，尽管控制器并不总是必需的，如[SwiftUI](https://developer.apple.com/xcode/swiftui/)中所示。
3.  **数据绑定**：我们为 ViewModel 属性创建侦听器，以便数据可以通过视图模型从视图流向模型。虽然引用是一种方式：View ➡ ViewModel ➡ Model，但数据需要流动：View ↔ ViewModel ↔ Model。通过读取它自己的属性，它清楚视图如何从模型中获取数据。数据绑定是如何检测视图中的事件并将它们反馈给模型。

```
class CustomView: UIView {
  var viewModel = MyViewModel {
    didSet {
      self.color = viewModel.viewColor
    }
  }

  convenience init(viewModel: MyViewModel) {
    self.viewModel = viewModel
  }
}

struct MyViewModel {
   var viewColor: UIColor {
      didSet {
         colorChanged?() // This is where the binding magic happens.
      }
   }

   var colorChanged: ((UIColor) -> Void)?
}

class MyViewController: UIViewController {

   let myViewModel = MyViewModel(viewColor: .green)
   let customView: CustomView!

   override func viewDidLoad() {
      super.viewDidLoad()

      // This is where the binder is assigned.
      myViewModel.colorChanged = { [weak self] color in 
        print("wow the color changed")
      }
      customView = CustomView(viewModel: myViewModel)
      self.view = customView
   }
} 
```

*设置差异*

1.  业务逻辑保存在 MVC 的控制器和 MVVM 的 ViewModel 中。
2.  事件直接从视图传递到 MVC 中的控制器，而事件从视图传递到 ViewModel 到 MVVM 的控制器（如果有的话）。

*共同特征*

1.  MVVM 和 MVC 都不允许 View 直接向 Model/s 发送消息。
2.  两者都有模型。
3.  两者都有意见。

**MVVM 的优点**

1.  因为 ViewModel 包含业务逻辑，所以它们是更小的具体对象，使它们易于单元测试。另一方面，在 MVC 中，业务逻辑在 ViewController 中。如果不同时测试所有方法和侦听器，你怎么能相信视图控制器的单元测试是全面安全的？你不能完全相信单元测试的结果。
2.  在 MVVM 中，由于业务逻辑从 Controller 中抽取到原子 ViewModel 单元中，因此 ViewController 的大小会缩小，这使得 ViewController 代码更加清晰。

**MVC的优点**

1.  在控制器中提供业务逻辑减少了对分支的需求，因此语句更有可能在缓存上运行，这比将业务逻辑封装到 ViewModel 中性能更高。
2.  在一个地方提供业务逻辑可以加速不需要测试的简单应用程序的开发过程。我不知道什么时候不需要测试。
3.  在 ViewController 中提供业务逻辑对于新开发人员来说更容易考虑。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2013-09-28T09:10:50.457

嗯，通常 MVC 用于 Web 开发，而 MVVM 在 WPF/Silverlight 开发中最流行。但是，有时 Web 架构可能会混合使用 MVC 和 MVVM。

例如：您可能会使用**knockout.js**，在这种情况下，您将在客户端拥有 MVVM。而且你的 MVC 的服务器端也可以改变。在复杂的应用程序中，没有人使用纯模型。将 ViewModel 用作 MVC 的“模型”可能有意义，而您的真实模型基本上将成为该 VM 的一部分。这为您提供了一个额外的抽象层。

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2018-06-23T21:38:23.017

在 MVVM 中，Controller 不会被 ViewModel 取代，因为 ViewModel 具有与 Controller 完全不同的功能。你仍然需要一个控制器，因为没有控制器你的模型、视图模型和视图将不会做很多事情......在 MVVM 中你也有一个控制器，MVVM 的名称只是误导。

在我看来，MVVMC 是正确的名称。

如您所见，ViewModel 只是 MVC 模式的一个补充。它将转换逻辑（例如将对象转换为字符串）从 Controller 移动到 ViewModel。

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2019-06-30T19:01:04.220

简而言之——在 MVC 中，控制器知道（控制）视图，而在 MVVM 中，ViewModel 不知道谁在使用它。ViewModel 将其可观察的属性和操作公开给任何可能对使用它感兴趣的人。这个事实使测试更容易，因为 ViewModel 中没有对 UI 的引用。

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2010-10-09T06:17:24.507

MVMC，或者可能是 MVC+，对于企业以及快速应用程序开发来说似乎是一种可行的方法。虽然将 UI 与业务和交互逻辑分开是很好的，但“纯”MVVM 模式和大多数可用示例在单一视图上效果最好。

不确定您的设计，但是我的大多数应用程序都包含页面和几个（可重用）视图，因此 ViewModel 确实需要在某种程度上进行交互。使用页面作为控制器将完全破坏 MVVM 的目的，因此不使用“VM-C”方法来处理底层逻辑可能会导致......好吧......随着应用程序的成熟，具有挑战性的构造。即使在 VB-6 中，我们大多数人也可能停止将业务逻辑编码到 Button 事件中并开始将命令“中继”到控制器，对吧？我最近查看了许多关于该主题的新兴框架；我最喜欢的显然是 Magellan（在 codeplex）方法。快乐编码！

[http://en.wikipedia.org/wiki/Model_View_ViewModel#References](http://en.wikipedia.org/wiki/Model_View_ViewModel#References)

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2014-12-17T17:53:05.423

从实用的角度来看，MVC（Model-View-Controller）是一种模式。然而，当 MVC 用作 ASP.net MVC 时，当与实体框架 (EF) 和“电动工具”结合使用时，它是一种非常强大的、部分自动化的方法，用于将数据库、表和列引入网页，无论是完整的仅限 CRUD 操作或 R（检索或读取）操作。至少在我使用 MVVM 时，视图模型与依赖于业务对象的模型进行交互，而这些模型又是“手工制作”的，经过大量努力，幸运地得到了与 EF 给出的一样好的模型开箱即用”。从实际编程的角度来看，MVC 似乎是一个不错的选择，因为它提供了许多开箱即用的实用程序，但仍有可能添加一些花里胡哨的东西。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2016-11-08T01:09:28.390

作为给出的许多回复的补充，我想从*现代*客户端 Web 或**富 Web 应用程序**的角度添加一些额外的视角。

事实上，如今简单的网站和大型 Web 应用程序通常使用许多流行的库（例如 Bootstrap）构建。[Knockout](http://knockoutjs.com/)由 Steve Sanderson 构建，提供对 MVVM 模式的支持，该模式模仿了该模式中最重要的行为之一：通过视图模型进行数据绑定。使用一点 JavaScript，可以实现数据和逻辑，然后可以将其添加到具有简单`data-bind`HTML 属性的页面元素中，类似于使用[Bootstrap](http://getbootstrap.com/)的许多功能。这两个库单独一起提供交互式内容。当与路由相结合时，这种方法可以产生一种简单而强大的方法来构建**单页应用程序**。

类似地，像[Angular](https://angularjs.org/)这样的现代客户端框架按照约定遵循 MVC 模式，但也添加了一个服务。有趣的是，它被吹捧为 Model-View-Whatever (MVW)。（请参阅[Stack Overflow 上的这篇文章](https://stackoverflow.com/a/13329501/2939745)。）

*此外，随着 Angular 2 等渐进*式 Web 框架的兴起，我们看到了术语的变化，也许还有一种新的架构模式，其中组件由视图或模板组成并与服务交互——所有这些都可以包含在一个模块; 和一系列模块组成了应用程序。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2017-03-02T10:38:01.320

我曾经认为MVC和MVVM是一样的。现在由于 Flux 的存在，我可以区分：

在 MVC 中，对于应用程序中的每个视图，您都有一个模型和一个控制器，所以我称之为视图、视图模型、视图控制器。该模式没有告诉您一个视图如何与另一个视图进行通信。因此，在不同的框架中，有不同的实现。例如，在某些实现中，控制器相互通信，而在其他实现中，有另一个组件在它们之间进行调解。甚至还有视图模型相互通信的实现，这是对 MVC 模式的突破，因为视图模型只能由视图控制器访问。

在 MVVM 中，每个组件都有一个视图模型。该模式没有指定视图应该如何影响视图模型，因此通常大多数框架只是在视图模型中包含控制器的功能。但是，MVVM 确实告诉您，您的视图模型的数据应该来自模型，这是整个模型不知道或自定义到特定视图。

为了演示差异，让我们以 Flux 模式为例。Flux 模式告诉应用程序中的不同视图应该如何通信。每个视图都监听一个存储并使用调度程序触发操作。调度程序反过来告诉所有商店关于刚刚执行的操作，并且商店会自行更新。Flux 中的存储对应于 MVVM 中的（通用）模型。它不是任何特定视图的习惯。所以通常人们在使用 React 和 Flux 时，每个 React 组件实际上都实现了 MVVM 模式。当一个动作发生时，视图模型调用调度器，最后它根据存储中的变化进行更新，也就是模型。你不能说每个组件都实现了 MVC，因为在 MVC 中只有控制器可以更新视图模型。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2018-01-03T09:49:40.607

mvc 是服务器端，mvvm 是 Web 开发中的客户端（浏览器）。

大多数时候 javascript 用于浏览器中的 mvvm。mvc 有很多服务器端技术。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2019-12-05T13:07:51.377

**模型-视图-控制器**（通常称为**MVC**）是一种软件设计模式，通常用于开发用户界面，将相关的程序逻辑划分为三个相互关联的元素。这样做是为了将信息的内部表示与信息呈现给用户和被用户接受的方式分开。遵循 MVC 架构模式将这些主要组件解耦，从而允许代码重用和并行开发。

传统上用于桌面图形用户界面 (GUI)，这种模式在设计 Web 应用程序时变得很流行。JavaScript、Python、Ruby、PHP、Java 和 C# 等流行的编程语言具有开箱即用的用于 Web 应用程序开发的 MVC 框架。

**模型**

模式的中心组件。它是应用程序的动态数据结构，独立于用户界面。它直接管理应用程序的数据、逻辑和规则。

**看法**

信息的任何表示形式，例如图表、图表或表格。相同信息的多个视图是可能的，例如用于管理的条形图和用于会计师的表格视图。

**控制器**

接受输入并将其转换为模型或视图的命令。

除了将应用程序划分为这些组件之外，模型-视图-控制器设计还定义了它们之间的交互。

模型负责管理应用程序的数据。它接收来自控制器的用户输入。

视图意味着以特定格式呈现模型。

控制器响应用户输入并在数据模型对象上执行交互。控制器接收输入，可选地对其进行验证，然后将输入传递给模型。 [![在此处输入图像描述](https://i.stack.imgur.com/munxk.png)](https://i.stack.imgur.com/munxk.png)

**模型-视图-视图模型**(MVVM) 是一种软件架构模式。

MVVM 有助于将图形用户界面的开发（无论是通过标记语言还是 GUI 代码）与业务逻辑或后端逻辑（数据模型）的开发分开。MVVM 的视图模型是一个值转换器，这意味着视图模型负责以易于管理和呈现对象的方式从模型中公开（转换）数据对象。在这方面，视图模型比视图更像模型，并且处理大部分（如果不是全部）视图的显示逻辑。视图模型可以实现中介者模式，围绕视图支持的用例集组织对后端逻辑的访问。

MVVM 是 Martin Fowler 的演示模型设计模式的一种变体。MVVM 以相同的方式抽象视图的状态和行为，但 Presentation Model 以不依赖于特定用户界面平台的方式抽象视图（创建视图模型）。

MVVM 由 Microsoft 架构师 Ken Cooper 和 Ted Peters 发明，专门用于简化用户界面的事件驱动编程。该模式被纳入 Windows Presentation Foundation (WPF)（Microsoft 的 .NET 图形系统）和 Silverlight（WPF 的 Internet 应用程序衍生产品）。微软的 WPF 和 Silverlight 架构师之一 John Gossman 于 2005 年在他的博客上宣布了 MVVM。

模型-视图-视图模型也称为模型-视图-绑定器，尤其是在不涉及 .NET 平台的实现中。ZK（一个用 Java 编写的 Web 应用程序框架）和 KnockoutJS（一个 JavaScript 库）使用模型-视图-绑定器。 [![在此处输入图像描述](https://i.stack.imgur.com/guQtb.png)](https://i.stack.imgur.com/guQtb.png)

# c# - C# 到 Oxygene 代码转换器

> ID：667787
> 
> 赞同：2
> 
> 时间：2009-03-20T20:11:25.293
> 
> 标签：c#, delphi, codedom, oxygene

我知道 CodeGear 制作了[BabelCode](http://lingua.codegear.com/babelcode/)，它使用 Code DOM 将 C# 转换为 Delphi for .NET。我很好奇是否还有其他类似的工具可以将 C# 转换为 Delphi Prism？如果不是，那么使用 Code DOM 创建一个涉及到什么（是的，这是开放式的！）

**更新**：这现在内置在 Delphi Prism 中。只需粘贴或导入您的 C#，您就有了 Oxygene aka Delphi Prism Code。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-03T15:37:51.693

它处于早期阶段，但 Carlo 刚刚发布了他的开源“C# to Oxygene”工具的第一个修订版：

[http://code.remobjects.com/p/cshaptoxy/](http://code.remobjects.com/p/csharptoxy/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T20:12:11.670

我看到的一个选项是在 C# 编译程序集上使用 .NET Reflector。它具有 Oxygene 语法。这是一种很长的路要走，并不完全是最优的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T01:17:05.823

使用 BabelCode 将您的 C# 转换为 Delphi，然后使用 Oxidizer 将[Delphi](http://prismwiki.codegear.com/en/Oxidizer)转换为 Prism。我意识到这不是一个好主意，但它至少可能比通过 Reflector 更自动化一些。祝你好运。

# c# - C# 中的 JOptionPane 等价物？

> ID：667791
> 
> 赞同：2
> 
> 时间：2009-03-20T20:11:48.160
> 
> 标签：c#, winforms, user-input, joptionpane

在 Java 中，标准 Swing 库中有一个有用的类，称为“JOptionPane”，它提供了一堆预制但可定制的窗口，用于显示消息和获取（简单）用户输入。

我知道有“MessageBox.Show(..)”可以在 C# 中向用户显示是/否/取消类型的消息，但是是否有提供易于使用的可自定义输入框的等效类（或简单库）？

我正在寻找类似[JOptionPane](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/JOptionPane.html)提供的[功能。](http://java.sun.com/docs/books/tutorial/uiswing/components/dialog.html#input)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-03-17T10:03:15.383

在 windows vista 中，有[taskdialog](http://msdn.microsoft.com/en-us/library/ms650925.aspx) api。

这是一个操作系统功能，而不是 ac# 库，在这个意义上不是你问的。但它大致涵盖了相同的领域：一个更通用的消息框 api，它可以让您从手动布局简单的对话框中解脱出来。如果你用谷歌搜索，你可以找到在旧 Windows 上模拟这个 api 的 c# 包装器。

最后，这里有[一篇博客文章如何在c#中使用它](http://bartdesmet.net/blogs/bart/archive/2006/09/26/4470.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T20:20:33.897

嗯，我能想到的唯一相似的就是[这个。](http://msdn.microsoft.com/en-us/library/microsoft.visualbasic.interaction.inputbox.aspx)它是 Microsoft.VisualBasic.dll 的一部分，因此您必须添加参考。我认为没有比这更多的自定义方法了，但这确实给了你*更多*的灵活性。

# delphi - 如何在 64 位 Vista 上设置 Delphi 书签

> ID：667798
> 
> 赞同：1
> 
> 时间：2009-03-20T20:13:08.033
> 
> 标签：delphi, ide, delphi-2007, bookmarks

在 Delphi (2007) 中，我习惯于使用 CTRL-SHIFT-0,1,2 等设置书签。

由于我已升级到 Vista x64，因此上述内容不再有效。我仍然可以使用 CTRL-K-0,1,2 等设置书签，但我习惯了传统方式（而且它更快）。

有谁知道为什么它对我不起作用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-09-28T19:09:04.500

我有同样的问题。更多调查表明这是由 Vista 的变化引起的。

输入法编辑器键盘快捷键 (CTRL+SHIFT+0) 在 Vista 中切换输入语言。以下链接显示如何禁用此快捷方式，从而使其再次可用于其他应用程序（包括 Delphi）：http: [//support.microsoft.com/kb/967893](http://support.microsoft.com/kb/967893)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T21:36:07.443

我在 Windows 2008 Server 64 位（基于 Vista）上运行，我使用 CTRL+SHIFT+1 设置书签，它工作正常。在家里，我有 Vista 32 位，也可以正常工作。

您可能会检查以确保您的 OEM 没有在上面安装一些疯狂的键盘挂钩或其他东西。在后台程序重新映射了一些组合键并阻止它们在 Delphi 中工作之前，我曾经发生过这种情况。

程序员比大多数“普通”用户使用更多的组合键。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-23T09:13:08.283

确认您没有与之冲突的系统范围的热键。我在 Trillian 劫持一些 Delphi 快捷方式时遇到了同样的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-28T21:22:51.773

如前所述，Vista 正在使用该组合键。

如果您不想禁用它，Ctrl+K CTRL+0 是设置书签 0 的老式方法。

# c# - 将 Excel 列字母转换为其数字的算法是什么？

> ID：667802
> 
> 赞同：70
> 
> 时间：2009-03-20T20:14:42.163
> 
> 标签：c#, excel, math

我需要一种算法来将 Excel 列字母转换为正确的数字。

这将用 C# 编写，但任何语言都可以，甚至是伪代码。

请注意，我将把它放在 C# 中，我不想使用 office dll。

对于“A”，预期结果将为 1

对于'AH' = 34

对于'XFD' = 16384

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2009-03-20T20:43:26.930

```
public static int ExcelColumnNameToNumber(string columnName)
{
    if (string.IsNullOrEmpty(columnName)) throw new ArgumentNullException("columnName");

    columnName = columnName.ToUpperInvariant();

    int sum = 0;

    for (int i = 0; i < columnName.Length; i++)
    {
        sum *= 26;
        sum += (columnName[i] - 'A' + 1);
    }

    return sum;
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-20T20:48:22.443

```
int result = colName.Select((c, i) =>
    ((c - 'A' + 1) * ((int)Math.Pow(26, colName.Length - i - 1)))).Sum(); 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-21T09:18:21.313

```
int col = colName.ToCharArray().Select(c => c - 'A' + 1).
          Reverse().Select((v, i) => v * (int)Math.Pow(26, i)).Sum(); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-20T20:27:03.053

从最后一个到第一个循环遍历字符。将每个字母的值 (A=1, Z=26) 乘以 26**N，加到总和。我在 C# 中的字符串操作技能是不存在的，所以这里有一些非常混合的伪代码：

```
sum=0;
len=length(letters);
for(i=0;i<len;i++)
  sum += ((letters[len-i-1])-'A'+1) * pow(26,i); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-08-26T21:52:58.187

如果有人感兴趣，这是我用 JavaScript 编写的解决方案。

```
var letters = "abc".toUpperCase();
var sum = 0;
for(var i = 0; i < letters.length;i++)
{
    sum *= 26;
    sum += (letters.charCodeAt(i) - ("A".charCodeAt(0)-1));
}
alert(sum); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-20T20:26:17.113

您能否将其视为以 26 为基数的数字，然后用字母代替以 26 为基数的数字？

所以实际上，您最右边的数字将始终是 1 到 26 之间的原始数字，而“数字”的其余部分（左侧部分）是收集的 26 的数量？所以 A 代表 26 的一个，B 代表 2，以此类推。

举个例子：

```
B = 2 = 第 2 列
AB = 26 * 1(A) + 2 = 第 28 列
BB = 26 * 2(B) + 2 = 第 54 列
DA = 26 * 4(D) + 1 = 第 105 列

```

ETC

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-12-13T13:12:08.370

较短的版本：

```
int col = "Ab".Aggregate(0, (a, c) => a * 26 + c & 31);  // 28 
```

忽略非`A-Za-z`字符：

```
int col = " !$Af$3 ".Aggregate(0, (a, c) => (uint)((c | 32) - 'a') > 25 ? a : a * 26 + (c & 31)); // 32 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-07-19T12:22:05.787

在 Excel VBA 中，您可以使用`.Range`Method 来获取数字，如下所示：

```
Dim rng as Range
Dim vSearchCol as variant 'your input column
Set rng.Thisworkbook.worksheets("mySheet").Range(vSearchCol & "1:" & vSearchCol & "1") 
```

然后使用`.column`属性：

```
 debug.print rng.column 
```

如果您需要完整代码，请参见下文：

```
Function ColumnbyName(vInput As Variant, Optional bByName As Boolean = True) As Variant
    Dim Rng As Range
    If bByName Then
       If Not VBA.IsNumeric(vInput) Then
            Set Rng = ThisWorkbook.Worksheets("mytab").Range(vInput & "1:" & vInput & "1")
            ColumnbyName = Rng.Column
       Else
            MsgBox "Please enter valid non Numeric column or change paramter bByName to False!"
       End If

    Else
        If VBA.IsNumeric(vInput) Then
            ColumnbyName = VBA.Chr(64 + CInt(vInput))
        Else
            MsgBox "Please enter valid Numeric column or change paramter bByName to True!"
        End If

    End If
End Function 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-08-22T20:01:05.923

我想这基本上与其他一些答案几乎相同，但它可能会更清楚地说明数字数字的 alpha 等价物发生了什么。它不是一个基本的 26 系统，因为没有 0 占位符。也就是说，第 26 列将是 'A0' 或其他东西，而不是 26 进制中的 Z。它不是 27 进制，因为 'alpha-gits' 不代表 27 的幂。伙计，它真的让你明白这是多么混乱算术一定是在巴比伦人发明零之前！

```
 UInt32 sum = 0, gitVal = 1;
  foreach (char alphagit in ColumnName.ToUpperInvariant().ToCharArray().Reverse())
  {
    sum += gitVal * (UInt32)(alphagit - 'A' + 1)
    gitVal *= 26;
  } 
```

像其他一些人一样，我颠倒了字符数组，所以我不需要知道任何关于指数的事情。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-07-28T10:45:33.763

为此，我只使用一行：

```
int ColumnNumber = Application.Range[MyColumnName + "1"].Column; 
```

# c# - 任意定界符/转义字符处理的最佳算法是什么？

> ID：667803
> 
> 赞同：10
> 
> 时间：2009-03-20T20:14:44.003
> 
> 标签：c#, regex, algorithm

我有点惊讶网络上没有这方面的一些信息，而且我一直发现这个问题比我想象的要棘手一些。

这是规则：

1.  您从分隔/转义的数据开始拆分为一个数组。
2.  分隔符是一个任意字符
3.  转义字符是一个任意字符
4.  分隔符和转义符都可能出现在数据中
5.  正则表达式很好，但性能好的解决方案是最好的
6.  编辑：可以忽略空元素（包括前导或结束分隔符）

代码签名（在 C# 中基本上是）

```
public static string[] smartSplit(
                         string delimitedData, 
                         char delimiter, 
                         char escape) {} 
```

问题最棘手的部分是转义连续转义字符的情况，当然，因为（调用 / 转义字符和 ，分隔符）： ////////, = ////,

我是否错过了在网络上或另一个 SO 问题中处理的地方？如果没有，那就用你的大脑袋来工作......我认为这个问题对于公共利益来说是件好事。我自己正在研究它，但还没有一个好的解决方案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T20:46:12.820

简单的状态机通常是最简单和最快的方法。Python 中的示例：

```
def extract(input, delim, escape):
  # states
  parsing = 0
  escaped = 1

  state = parsing
  found = []
  parsed = ""

  for c in input:
    if state == parsing:
      if c == delim:
        found.append(parsed)
        parsed = ""
      elif c == escape:
        state = escaped
      else:
        parsed += c
    else: # state == escaped
       parsed += c
       state = parsing

  if parsed:
    found.append(parsed)

  return found 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-20T20:49:03.190

```
void smartSplit(string const& text, char delim, char esc, vector<string>& tokens)
{
    enum State { NORMAL, IN_ESC };
    State state = NORMAL;
    string frag;

    for (size_t i = 0; i<text.length(); ++i)
    {
        char c = text[i];
        switch (state)
        {
        case NORMAL:
            if (c == delim)
            {
                if (!frag.empty())
                    tokens.push_back(frag);
                frag.clear();
            }
            else if (c == esc)
                state = IN_ESC;
            else
                frag.append(1, c);
            break;
        case IN_ESC:
            frag.append(1, c);
            state = NORMAL;
            break;
        }
    }
    if (!frag.empty())
        tokens.push_back(frag);
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-01-26T07:05:30.587

```
private static string[] Split(string input, char delimiter, char escapeChar, bool removeEmpty)  
    {  
        if (input == null)
        {
            return new string[0];
        }

        char[] specialChars = new char[]{delimiter, escapeChar};

        var tokens = new List<string>();
        var token = new StringBuilder();

        for (int i = 0; i < input.Length; i++)
        {
            var c = input[i];

            if (c.Equals(escapeChar))
            {
                if (i >= input.Length - 1)
                {
                    throw new ArgumentException("Uncompleted escape sequence has been encountered at the end of the input");
                }

                var nextChar = input[i + 1];

                if (nextChar != escapeChar && nextChar != delimiter)
                {
                    throw new ArgumentException("Unknown escape sequence has been encountered: " + c + nextChar);
                }

                token.Append(nextChar);
                i++;
            }
            else if (c.Equals(delimiter))
            {
                if (!removeEmpty || token.Length > 0)
                {
                    tokens.Add(token.ToString());
                    token.Length = 0;
                }
            }
            else
            {
                var index = input.IndexOfAny(specialChars, i);

                if (index < 0)
                {
                    token.Append(c);
                }
                else
                {
                    token.Append(input.Substring(i, index - i));
                    i = index - 1;
                }
            }
        }

        if (!removeEmpty || token.Length > 0)
        {
            tokens.Add(token.ToString());
        } 

        return tokens.ToArray();
    } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-20T20:29:21.987

就 FSM 而言，这种标记器的实现相当简单。

您确实需要做出一些决定（例如，我该如何处理前导分隔符？剥离或发出 NULL 标记）。

* * *

这是一个忽略前导和多个分隔符的抽象版本，并且不允许转义换行符：

```
state(input)     action
========================
BEGIN(*):         token.clear(); state=START;
END(*):           return;
*(\n\0):          token.emit(); state=END;
START(DELIMITER): ; // NB: the input is *not* added to the token!
START(ESCAPE):    state=ESC; // NB: the input is *not* added to the token!
START(*):         token.append(input); state=NORM;
NORM(DELIMITER):  token.emit(); token.clear(); state=START;
NORM(ESCAPE):     state=ESC; // NB: the input is *not* added to the token!
NORM(*):          token.append(input);
ESC(*):           token.append(input); state=NORM; 
```

这种实现的优点是可以自然地处理连续的 excapes，并且可以很容易地扩展以赋予更多的转义序列特殊的含义（即添加类似 的规则`ESC(t) token.appeand(TAB)`）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-23T17:49:55.590

这是我在 C# 中移植的函数

```
 public static void smartSplit(string text, char delim, char esc, ref List<string> listToBuild)
    {
        bool currentlyEscaped = false;
        StringBuilder fragment = new StringBuilder();

        for (int i = 0; i < text.Length; i++)
        {
            char c = text[i];
            if (currentlyEscaped)
            {
                fragment.Append(c);
                currentlyEscaped = false;
            }
            else 
            {
                if (c == delim)
                {
                    if (fragment.Length > 0)
                    {
                        listToBuild.Add(fragment.ToString());
                        fragment.Remove(0, fragment.Length);
                    }

                }
                else if (c == esc)
                    currentlyEscaped = true;
                else
                    fragment.Append(c);
            }
        }

        if (fragment.Length > 0)
        {
            listToBuild.Add(fragment.ToString());
        }
    } 
```

希望这对将来的某人有所帮助。感谢 KenE 为我指明了正确的方向。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-12-13T02:01:41.830

这是一种更惯用和可读的方法：

```
public IEnumerable<string> SplitAndUnescape(
    string encodedString,
    char separator,
    char escape)
{
    var inEscapeSequence = false;
    var currentToken = new StringBuilder();

    foreach (var currentCharacter in encodedString)
        if (inEscapeSequence)
        {
            currentToken.Append(currentCharacter);
            inEscapeSequence = false;
        }
        else
            if (currentCharacter == escape)
                inEscapeSequence = true;
            else
                if (currentCharacter == separator)
                {
                    yield return currentToken.ToString();
                    currentToken.Clear();
                }
                else
                    currentToken.Append(currentCharacter);

    yield return currentToken.ToString();
} 
```

请注意，这不会删除空元素。我认为这不应该是解析器的责任。如果要删除它们，只需调用`Where(item => item.Any())`结果即可。

我认为这对于单一方法来说逻辑太多了；很难跟上。如果有人有时间，我认为最好将其分解为多个方法，也许还有它自己的类。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-20T20:18:53.697

您正在寻找类似“字符串标记器”的东西。我很快找到了一个类似的[版本。](http://www.codeproject.com/KB/recipes/stringtokenizer.aspx)或者看看[getopt](http://www.gnu.org/software/libtool/manual/libc/Getopt.html)。

# c# - 整个 If prevValue != currValue 事情在一个循环中

> ID：667804
> 
> 赞同：2
> 
> 时间：2009-03-20T20:15:05.190
> 
> 标签：c#, loops, list

假设我们有一个列表 {a, a, a, b, b, c, c }

我们希望循环遍历列表并在项目值更改时进行某种更改...例如：

```
prevEmployer = String.empty;
foreach(Person p in PersonList){
  if(p.Employer != prevEmployer){ 
    doSomething(); 
    prevEmployer = p.Employer;
  }
  ... more code
} 
```

有没有其他选择？它对我来说只是看起来很笨拙。

编辑：使代码更符合手头的问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T20:18:18.053

你想要不同的价值观吗？即会有{a,a,a,b,b,a,c,c,a}吗？如果没有，您可以使用 LINQ：

```
foreach(string s in theList.Distinct()) {
   doSomething(); // with s
} 
```

* * *

重新更新；也许使用类似的东西`DistinctBy`：

```
foreach(var item in data.DistinctBy(x=>x.Foo)) {
    Console.WriteLine(item.Bar);
}

public static IEnumerable<TSource> DistinctBy<TSource,TValue>(
        this IEnumerable<TSource> source, Func<TSource,TValue> selector) {
    var set = new HashSet<TValue>();
    foreach (var item in source) {
        if (set.Add(selector(item))) {
            yield return item;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T20:22:23.673

这实际上取决于您要对其余代码执行的操作。@Marc Gravell 的响应是正确的，如果您只需要对列表中的每个不同元素执行操作，但是，如果 doSomething() 只是根据列表元素已更改的事实设置一些状态并且您正在对列表中的每个元素进行操作列表（或需要单个元素用于其他目的），那么您的方法似乎非常合理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T20:20:45.863

只要 String.Empty 永远不是您列表的元素并且您的列表已排序，对我来说看起来不错。可能想确保 theList 没有被其他线程改变。看起来像是处理列表中过渡工作的一种非常常用的方法......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T21:08:43.487

我决定采用以下解决方案，它更漂亮，但会导致更多的数据库调用。

```
foreach(Employer employer in EmployerList){
  ProcessEmployees(employer);
}

ProcessEmployees(Employer employer){
  EmployeeList = GetEmployees(employer);
  foreach(Employee employee in EmployeeList){
    doStuff...
  }
} 
```

所以不是从 {a, a, a, b, b, c, c } 开始，我将处理 {a, a, a} {b, b} {c, c}

# ios - 以编程方式访问在 Interface Builder 中添加的 UIView 的子视图

> ID：667807
> 
> 赞同：0
> 
> 时间：2009-03-20T20:17:06.120
> 
> 标签：ios, uiview, iboutlet

我有一个 nib 文件，其中有一个视图，其中包含一个背景图像、一个按钮和另一个覆盖全屏的图像（阴影），需要移动到前面。在视图上，我正在创建子视图，在创建并添加它们之后，`[self addView]`我需要将阴影图像移到前面。

我目前正在使用 tag 属性来查找该视图，但我认为可能有更好的方法，方法是通过某个名称识别我在 Interface Builder 中添加的子视图。

我尝试添加一个 IBOutlet 以将子视图与其父级连接，但它不起作用（并且没有任何意义，因为子视图已经以某种方式连接到其父级）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T20:25:33.650

该`IBOutlets`方法应该有效，并且可能是最好的方法。在 .h 文件中声明它们之后，确保在 Interface Builder 中建立了正确的连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T08:20:30.827

iPhone 会延迟加载视图控制器。nib 可能没有加载到 initWithCoder 或 Kendall 指定的任何 init 方法中。

如果您想在视图显示之前访问它们，viewDidLoad 是从 nib 访问任何内容的首选位置。

希望有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T20:56:19.537

您在什么时候尝试访问子视图？如果您在 ViewController 的 init 中尝试，IBOutlets 将为 nil。您可以获得的第一个方法可能是 viewDidLoad。

这样做确实有意义的原因是 IBOutlets 只是指向某个组件的直接指针，即使它们已经是其他东西的子视图。只是节省了很多狩猎。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T21:53:04.377

只要您使用 viewWithTag: 方法，使用标签是定位特定视图的一种非常有效的方法。如果您已经在使用标签，则无需更改为 IBOutlets，除非您只是不喜欢调用 viewWithTag:。

# c# - C# DllImport 返回类型是 TCHAR？

> ID：667808
> 
> 赞同：0
> 
> 时间：2009-03-20T20:17:23.157
> 
> 标签：c#, interop, dllimport

我有一个带有以下签名的 c++ 函数

```
TCHAR *DXGetErrorDescription9(HRESULT hr); 
```

我有

```
[DllImport("dxerr9.dll",EntryPoint="GetDXErrorString9")]
    static public extern string GetDXErrorString9(int DXError); 
```

如何将字符串编组为 TCHAR*？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T20:25:08.537

经过一番挖掘，结果发现directx 错误例程不是作为dll 提供的，它们是作为静态链接到可执行文件中的库提供的。我应该根据 dxerr9.lib 的大小来计算这一点（它是 5M，比任何其他存根库都大）。

所以为了让它工作，我做了以下工作：

1.  制作一个包装所有错误处理库函数的“包装器”本机 dll。由于只有 3 个（DXGetErrorDescription、DXGetERrorString 和 DXTrace），这没什么大不了的。
2.  让 .NET 调用包装函数。

您可以通过创建 Win32 项目在 Visual Studio 中执行此操作（更改应用程序设置，使其成为 dll 并导出符号）。我称分钟为“DirectXErrWrapper”。

在包装器项目中添加 DXGetErrorDescription 的传递。我调用了我的 DXGetErrDescPassThrough()：

```
extern "C" {

DIRECTXERRWRAPPER_API TCHAR * DXGetErrDescPassThrough(HRESULT hr)
{
    return (TCHAR *)DXGetErrorDescription(hr);
}

} 
```

extern "C" 块很重要（与解构 C++ 名称有关）。该项目需要#include "dxerr.h" 并静态链接 dxerr.lib，因此您必须将 directx sdk 包含目录添加到您的包含路径，并将directx sdk lib 目录添加到您的 lib 路径。

然后让您的托管代码从您的包装器 dll 中导入调用：

```
[DllImport("DirectXErrWrapper.dll", CharSet=CharSet.Unicode)]
static public extern string DXGetErrDescPassThrough(int DXError); 
```

2005 年的原生项目默认使用 unicode，因此 DllImport 需要指定 unicode。最后，通过以下方式从托管代码中调用它：

```
Debug.WriteLine("DXGettErrDescPassThrough=" + DXGetErrDescPassThrough(0)); 
```

在这种情况下，调用将“函数成功完成”打印到调试设备，因为 0 表示成功。

（上一篇文章如下）

> 这看起来像是 DirectX 函数之一（C++ 不是 C# AFAIK）。我很确定它附带 unicode 和 ansi 版本。在 unicode 上编译时，TCHAR 将映射到 unicode（T 是类型的助记符；unicode 上的 unicode，mbcs 上的多字节字符集，否则为 ansi）。您通常可以使用 CharSet=CharSet.Auto 但如果这会导致兼容性问题（例如，您必须使用 ansi 字符串，因为您已经移植的某些结构需要它）您可以使用与您的项目一致的任何一个（Charset .Unicode 如果您都是 unicode 或 Charset.Ansi），那么将其编组为 C# 字符串应该没有问题。您可能需要将其装饰为 [OUT] 尽管返回值可能是 OUT 隐式。我也希望 DirectX 按照标准 [out, retval] 约定与 TLB 一起发布！

# javascript - .live() 绑定是否适用于 IE7 中的 jQuery？

> ID：667812
> 
> 赞同：2
> 
> 时间：2009-03-20T20:18:10.143
> 
> 标签：javascript, jquery, web-applications

我有一段 javascript 应该锁定到通过 XHR 引入的表单上。它看起来像：

```
$(document).ready(function() {

   $('#myform').live('submit', function() {
      $(foo).appendTo('#myform');
      $(this).ajaxSubmit(function() {
        alert("HelloWorld");
    });
       return false;
   });

}); 
```

这恰好适用于FF3，但不适用于IE7。知道问题是什么吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-20T20:35:51.397

[Events/live](http://docs.jquery.com/Events/live)当前不支持提交事件。

**可能的事件值**：click、dblclick、mousedown、mouseup、mousemove、mouseover、mouseout、keydown、keypress、keyup

**目前不支持：** blur、focus、mouseenter、mouseleave、change、submit

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-20T20:30:58.303

你是如何执行提交的？你可以试试这个吗？

```
$(':submit').live('click', function(e) {
  $(foo).appendTo('#myform');

  $('#myform').ajaxSubmit(function() {
    alert('Hello World');
  });

  e.preventDefault();
  return false;
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-05T16:37:39.970

关于上面的 CMS，在 JQuery 1.4 中，live*应该*与“提交”一起使用，但似乎仍然不能与 IE7 一起使用。我将尝试委托，看看是否有帮助。

# regex - 正则表达式匹配所有 HTML 标签和标签内容，除了 和

> ID：667818
> 
> 赞同：1
> 
> 时间：2009-03-20T20:19:45.957
> 
> 标签：regex, coldfusion

我正在寻找一个正则表达式来匹配所有 HTML 标签，除了`<p>`标签`</p>`内容。我正在 ColdFusion 中开发。

[之前](https://stackoverflow.com/questions/29869/regex-to-match-all-html-tags-except-p-and-p)有一篇关于匹配标签的文章，除了`<p>`and `</p>`，但我还需要抓取标签之间的所有内容。例如，以下内容应完全匹配：

```
<a href="http://www.google.com">Google</a> 
```

和

```
<em>Some text here</em> 
```

但不是

```
<p>Some text and tags here</p> 
```

关于如何做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T20:38:29.643

使用正则表达式解析 HTML 非常困难和痛苦。

您最好使用某种基于 DOM 的解析器并找到您需要的元素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T20:38:18.287

有时将正则表达式与一些额外的检查结合起来会更容易。

所以`\<.*?\>.*?\<\/.*?\>` 应该匹配`<..>...</..>`相似标签之间的任何内容。然后，您可以以编程方式分别检查`<..>`and `</...>`are not`<p>`和`</p>`。如果您将它们分组，可能最容易检查这一点：

```
(\<.*?\>).*?(\<\/.*?\>) 
```

然后检查以确保`$1`并且`$2`（或者您在环境中进行反向引用）不是段落打开和关闭标签。

`.*?`指定最小匹配；我假设您的正则表达式环境支持这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T21:43:58.550

您还没有说您要做什么，但是有一个很好的改变，您最好使用该`XmlParse`函数创建一个 XML DOM，然后改用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-30T21:59:29.037

这行得通吗？我只对其进行了一些检查，但似乎：

```
Regex expr = new Regex(@"<([A-OQ-Z][A-Z0-9]*)\b[^>]*>(.*?)</\1>", RegexOptions.IgnoreCase); 
```

我刚刚复制并粘贴了 C# 代码。要获取标签之间的所有内容，您需要使用 \1，然后您需要关闭区分大小写，因此 IgnoreCase 或 -i 或您使用的任何工具都提供了该选项。如果您的工具不这样做，那么您将不得不做 A-Oa-oq-zQ-z 等。只是正则表达式：

```
<([A-OQ-Z][A-Z0-9]*)\b[^>]*>(.*?)</\1> 
```

请注意，这将记录匹配独立标签，但应该可以帮助您入门。

# asp.net - 强制 ASP.NET 干净编译

> ID：667821
> 
> 赞同：3
> 
> 时间：2009-03-20T20:20:39.047
> 
> 标签：asp.net

如何强制 ASP.NET 1.1 像在 ASP.NET 临时文件位置一样重新编译其运行时？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T20:50:43.077

要强制重建，请更改 web.config 文件（只需换行即可），这会强制重新编译。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T20:33:21.807

关闭 IIS（确保 wpworker procs 已被杀死），清除 WINDOWS\Microsoft.NET\Framework\v1.1.4322\Temporary ASP.NET 文件并清除您自己的 bin 目录中的所有 dll。重新启动 IIS 后，它将重建。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T20:47:39.947

我可能正在阅读 WAYYY 以深入了解这个问题，但如果您在引用方面遇到问题，以防万一它有助于尝试这个：

[http://geekswithblogs.net/shahed/archive/2006/11/16/97240.aspx](http://geekswithblogs.net/shahed/archive/2006/11/16/97240.aspx)

尽管禁用批处理编译会影响性能。

# asp.net - 确定我的视图状态中的内容的好方法是什么？

> ID：667831
> 
> 赞同：5
> 
> 时间：2009-03-20T20:22:45.513
> 
> 标签：asp.net, viewstate, decode

我有一个具有非常大的视图状态（> 300KB）的页面。...是的，我知道。我已将此异常范围缩小到一个用户控件，但在确定该控件到底放在那里的内容时遇到了麻烦。

我已经在页面中覆盖了 SavePageStateToPersistenceMedium，但不擅长处理传入的 viewstate 对象。我可以将它传递给一些递归函数来打印出对象中的所有内容吗？

我试过使用免费提供的视图状态解码器，但没有一个奏效。当它试图反序列化视图状态时，我总是会出错。

我非常想在这里寻找代码片段。

谢谢，
马克

感谢您的跟踪建议，尤其是。trace.axd 的东西。但这仍然只告诉我控件有多大，并没有告诉我视图状态中有什么。我希望能够查看是否存在我错误地序列化为视图状态的对象。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T20:31:53.153

我曾经使用过trace.axd。它列出每个请求并转储视图状态的内容。您必须在 web.config 中启用跟踪。如果您有很多请求，您需要将缓存大小更新为 10 以上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-23T22:31:13.463

[Fritz Onion 的 ViewState 解码器](http://www.pluralsight.com/community/media/p/51688.aspx)正是您所需要的！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T20:45:48.703

关于视图状态解码器的问题，您可能已经加密了视图状态。检查这篇文章的评论/链接：[http](http://www.testingreflections.com/node/view/3424) ://www.testingreflections.com/node/view/3424 。

更新：尝试在 web.config 中的 pages 元素上完全关闭它：

```
<pages ... viewStateEncryptionMode="Never" ... /> 
```

查看此 msdn 文档中的视图状态部分[如何：在 ASP.NET 2.0 中配置 MachineKey](http://msdn.microsoft.com/en-us/library/ms998288.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T21:03:22.920

I would just add Trace="true" to the page directive on your local machine. The control tree section will show you the viewstate size of each control.

# sql-server-2005 - 在 SQL Server 2005 中创建表之前禁用约束

> ID：667833
> 
> 赞同：0
> 
> 时间：2009-03-20T20:23:18.087
> 
> 标签：sql-server-2005

是否可以在使用 T-SQL 创建数据库表之前禁用唯一和外键约束？例如，在 MySQL（在 5.1 版中测试）中，如果您有一个创建数据库模式的 SQL 脚本，您可以输入以下内容：

```
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */; 
```

在脚本的开头（在任何 CREATE TABLE 语句之前）禁用提到的约束。然后在脚本结束时，您可以使用以下命令再次启用它们。

```
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */; 
```

SQL Server 2005 有类似的东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T20:31:09.037

我对 MySQL 不是很熟悉，但是我接近您在 SQL Server 中尝试实现的方法是从 create table 语句中删除约束定义，然后在脚本末尾添加约束，沿着下面的行。

```
Create table table1 (id int not null, val varchar(10))
Create table table2 (id int, t1id int, val varchar(10)) 
```

...做其他陈述

```
 Alter table table1 add 
        Constraint pk_table1 Primary Key (id)
    Alter table table2 Add 
        Constraint fk_table1 Foreign Key (t1id) References table1(id) 
```

# c# - DIV 内容显示在页面而不是 JQuery 对话框上

> ID：667841
> 
> 赞同：11
> 
> 时间：2009-03-20T20:25:33.980
> 
> 标签：c#, asp.net, jquery, jquery-ui

我有以下 DIV 标记：

```
<div id="dialog" title="Membership Renewal">
Your membership is going to expire.
</div> 
```

我有以下 javascript 来执行 JQuery：

```
<script type="text/javascript">
function showjQueryDialog() {
    $("#dialog").dialog("open");
    //alert("Time to renew Membership!");
}

$(document).ready(function() {
    $("#dialog").dialog({
        autoOpen: false,
        modal: true,
        buttons: { "Renew Membership": function() { $(this).dialog("close"); } }
    });
});
</script> 
```

我有一个 asp:Button，它位于控件内部，并且该控件位于母版页上。我注意到的第一件事是，当页面加载时，div 会显示，然后在页面加载完成时消失。当我单击按钮时，它执行以下操作：

```
if (timeSpan.Days >= 30)
{
//Show JQuery Dialog Here
ScriptManager.RegisterClientScriptBlock(this, typeof(Page), "showExpiration",    
"showjQueryDialog()", true);
} 
```

当我单击按钮时，不会弹出对话框，而是显示 div 的内容。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2011-11-08T17:17:42.427

我知道这已经过时了。但是，将您的类设置为 ui-helper-hidden 中内置的 jQuery UI。

```
<div id="dialog" title="Membership Renewal" class="ui-helper-hidden"> 
    Your membership is going to expire. 
</div> 
```

这将解决您的 div 不需要的客串行为。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-20T20:45:24.070

我相信你在这里有两个相关的问题。

首次加载时显示 DIV 的原因是您尚未告诉它不要这样做。使 DIV 表现为对话框的 jQuery 脚本在加载 HTML DOM 之前不会运行，并且在此之前它不会隐藏 DIV。一个简单的解决方案是默认使用 CSS 隐藏 DIV。

```
<div id="dialog" title="Membership Renewal" style="display:none;">
Your membership is going to expire.
</div> 
```

按钮点击问题是相关的：`RegisterClientScriptBlock`一遇到就会输出一个脚本，所以把它变成对话框的jQuery代码还没来得及运行。为了给它一个这样做的机会，您可以将 C# 代码更改为 use `RegisterStartupScript`，这将延迟执行`showjQueryDialog()`直到页面完成加载并且 jQuery 代码有机会将 DIV 变成一个对话框。

```
if (timeSpan.Days >= 30)
{
  //Show JQuery Dialog Here
    ScriptManager.RegisterStartupScript(this, typeof(Page), 
        "showExpiration", "showjQueryDialog()", true);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T20:35:06.920

确保您在页面顶部指定了正确的文档类型，这似乎是我看到的一些问题的原因。

编辑：

另外，为了防止它一开始就闪烁，你可以有类似的东西

```
#debug { display: none; } 
```

元素之前的某个地方（很可能是您的样式表或头部）。

另一件可能有帮助的事情是，如果你设置：

```
OnClientClick="showjQueryDialog(); return false;"; 
```

在页面加载或类似的情况下，您将不需要回发（异步或其他方式）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T20:50:13.263

它未显示的原因是该文档可能尚未加载。并且 document.ready 没有被调用，所以 dialog("open") 在 dialog({options}) 之前被调用；所以要解决这个问题，只需将代码添加到 doc.ready 调用中。

此外，您只加载一次对话框，因此您实际上不需要将其初始化为 autoOpen:false，使用 display:none 然后按照 John Boker 所说的那样显示它

```
function showjQueryDialog() {
  $(document).ready(function() {
    $("#dialog").dialog({
        modal: true,
        buttons: { "Renew Membership": function() { $(this).dialog("close"); } });
    $("#dialog").show();  // sets display:block;
    //alert("Time to renew Membership!");
  });
}

<div id="dialog" style="display:none">
  <!--..-->
</div> 
```

# drag-and-drop - 从 QTableView/QSqlTableModel 中拖动项目

> ID：667844
> 
> 赞同：3
> 
> 时间：2009-03-20T20:26:07.910
> 
> 标签：drag-and-drop, qt4

我希望能够从具有 QSqlTableModel 作为其模型的 QTableView 中拖动一个项目（实际上是一整行）。

`QSqlTableModel::flags(const QModelIndex &index)`不返回`Qt::ItemIsDragEnabled.`这是否意味着我可以让它工作的唯一方法是如果我将 QSqlTableModel 子类化并重新实现该`flags()`方法？

仅仅拖动项目似乎有点过头了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T18:20:01.417

是的。这是让它工作的唯一方法。

# java - 你能对混淆代码进行单元测试吗？

> ID：667846
> 
> 赞同：6
> 
> 时间：2009-03-20T20:26:56.643
> 
> 标签：java, ant, obfuscation

我希望在我们现有的 Ant 构建脚本中混淆我们的 Java Web 应用程序代码，但在单元测试方面遇到了问题。我在代码编译后、在 jar-ed 之前以及在运行单元测试之前对代码进行了混淆。

但是，如果我混淆了我的生产代码而不是我的测试代码，我的所有测试都会失败，因为它们试图调用不再存在的方法，因为它们已被混淆器重命名。我可以将某些方法标记为不混淆，以便外部系统（例如我们的测试套件）使用它们，但是由于我们正在为高单元测试覆盖率而努力，因此我们需要将**所有**方法标记为不可混淆。

如果我也混淆测试类，我会遇到两个问题：

1：生产类和测试类合并到同一个输出目录中，我无法从生产 .jar 文件中排除测试类

2：我无法运行正常的 Ant 批处理测试调用：

```
 <batchtest todir="${basedir}/reports">
      <fileset dir="${basedir}/components/common/build-zkm">
           <include name="**/*Test.class"/>
      </fileset>
 </batchtest> 
```

因为混淆器更改了测试的名称。

我可以在生成的 .war/.ear 文件上运行混淆器，但我想让我们的单元测试针对修改后的代码运行，以消除由混淆器引起的任何错误。

我目前正在与 Zelix KlassMaster 合作，但我仍处于评估阶段，因此如果它们能更好地工作，我愿意接受其他选择。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-20T21:03:21.767

我使用[yguard](http://www.yworks.com/en/products_yguard_about.htm)（它是免费的，这就是我提到它的原因）。

你应该能够告诉混淆器不要混淆某些东西（看起来[你](http://www.zelix.com/klassmaster/featuresZKMScript.html)可以）。

正如其他人所说，不要混淆测试，但要混淆其余部分。

但是，我建议您执行以下操作：

1.  编译
2.  jar 未混淆的文件（如果需要）
3.  测试未混淆的文件
4.  如果他们通过测试然后混淆 jar 混淆文件
5.  测试混淆文件

它会更慢，但如果测试在第 3 步失败，它会更容易修复（可能），如果测试在 5 失败，那么你知道混淆不是你的源代码有问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T20:31:27.367

你能告诉它运行混淆器，以便它有效地重构代码，*包括*来自测试的引用（即，当生产名称更改时，测试代码会更改其引用）但不会混淆测试本身（即不要更改测试类或其方法的名称）？鉴于以前使用混淆器的经验，我希望这能奏效。

例如，假设我们有未混淆的来源：

```
public class ProductionCode
{
    public void productionMethod() {}
}

public class ProductionCodeTest
{
    public void testProductionMethod()
    {
        new ProductionCode().productionMethod();
    }
} 
```

您想设置混淆器的选项以使其*有效*：

```
public class Xyzzy
{
    public void ababa() {}
}

public class ProductionCodeTest
{
    public void testProductionMethod()
    {
        new Xyzzy(). ababa();
    }
} 
```

这样，您的“运行测试”Ant 任务应该能够保持不变，因为测试的 API 没有改变——只是方法的实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T20:55:00.197

混淆器不应更改您的公开电话。似乎你应该在混淆之前运行其他测试，因为它们检查在混淆之后不应该改变的内部功能。

那么如果是这样的话，为什么不直接运行调用公共功能的测试呢？您需要做的就是拥有一个带有这些调用的单独类，并使用混淆代码重新构建它，然后运行该 dll。

# java - Java 套接字：TCP 校验和不正确

> ID：667848
> 
> 赞同：6
> 
> 时间：2009-03-20T20:27:04.333
> 
> 标签：java, sockets, tcp

我正在试验 w/java 套接字。我可以连接到一个套接字并发送/接收数据字节而没有 oa 问题。但是我也在使用wireshark嗅探流量，并注意到来自java套接字的每个数据包都被wireshark标记为“tcp校验和不正确”。

任何人有任何见解？

java 版本 "1.6.0_12" Java(TM) SE Runtime Environment (build 1.6.0_12-b04) Java HotSpot(TM) Client VM (build 11.2-b01, 混合模式, 共享)

Wireshark v1.0.6 w/WinPcap 4.0.2

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-20T20:31:10.860

我发现在很多情况下，使用像 Wireshark 这样的工具会给你在本地数据包上不正确的 tcp 校验和。

这是因为操作系统明智地不会浪费精力在发往本地主机的数据包上填充 tcp 校验和（毕竟它们不可能是不正确的）。

此外，在真实物理接口上发出的本地生成的数据包可能无论如何都具有硬件生成的 tcp 校验和。这意味着*发送*的数据包通常看起来像它们的校验和不正确（在网络上，它们是正确的）。

在你的交换机上设置一个监视器端口，在一个单独的盒子上运行 Wireshark，你会看到真实的画面。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-20T22:49:28.687

这在[此处](http://wiki.wireshark.org/TCP_checksum_offload)的 Wireshark wiki 中有记录。

# ruby - 简单的递归问题

> ID：667850
> 
> 赞同：0
> 
> 时间：2009-03-20T20:27:36.517
> 
> 标签：ruby, recursion, coin-flipping

我正在迈出递归和动态编程的第一步，并且有一个关于形成子问题来建模递归的问题。

问题：

> 有多少种不同的方法可以将一枚公平的硬币抛 5 次，并且连续出现三个或更多的正面朝上？

如果有人可以提出一些重注释的代码（Ruby 首选但不是必需的）来帮助我到达那里。如果这很重要，我不是学生，这是对[Project Euler](http://projecteuler.net/)问题的修改，使我很容易掌握。我只需要掌握编写递归公式的窍门。

如果您想将问题抽象为有多少种不同的方式可以将一枚公平的硬币抛 Y 次，并且连续没有 Z 次或更多正面，那也可能是有益的。再次感谢，这个网站很棒。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T20:48:27.823

您可以简单地为此创建一个公式：

抛硬币 5 次且连续 3 次正面朝上的次数等于 5 次抛硬币的组合数减去至少连续 3 次正面朝上的组合数。在这种情况下：

```
HHH-- (4 combinations)
THHH- (2 combinations)
TTHHH (1 combination) 
```

组合总数 = 2^5 = 32。而 32 - 7 = 25。

如果我们连续抛硬币 N 次，没有 Q 次正面朝上，总金额为 2^N，至少有 Q 次正面正面的金额为 2^(N-Q+1)-1。所以一般的答案是：

```
Flip(N,Q) = 2^N - 2^(N-Q+1) +1 
```

当然也可以用递归来模拟总量：

```
flipme: N x N -> N
flipme(flipsleft, maxhead) = flip(flipsleft, maxhead, 0)

flip: N x N x N -> N
flip(flipsleft, maxhead, headcount) ==
  if flipsleft <= 0 then 0
  else if maxhead<=headcount then 0
  else 
    flip(flipsleft - 1, maxhead, headcount+1) + // head
    flip(flipsleft - 1, maxhead, maxhead)       // tail 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T20:32:46.333

这不是取所有可能的 5 位序列并删除存在三个连续 1 位的情况（假设 1 = 头，0 = 尾）的问题吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T23:09:39.537

这是我在 Ruby 中的解决方案

```
def combination(length=5)
  return [[]] if length == 0
  combination(length-1).collect {|c| [:h] + c if c[0..1]!= [:h,:h]}.compact +
  combination(length-1).collect {|c| [:t] + c }
end

puts "There are #{combination.length} ways" 
```

所有递归方法都从结束情况的早期输出开始。

```
return [[]] if length == 0 
```

这将返回一个组合数组，其中唯一的零长度组合是`[]`

下一位（简化）是......

```
combination(length-1).collect {|c| [:h] + c } +
combination(length-1).collect {|c| [:t] + c } 
```

所以..这说..我想要所有比所需长度短一个的组合，每个组合都添加一个 :head ......加上所有短一个并添加一个尾巴的组合。

考虑递归的方法是..“假设我有一种方法来处理 n-1 案例..我必须添加什么才能使其涵盖 n 案例”。对我来说，这感觉像是归纳证明。

此代码将生成给定长度的所有正面和反面组合。

我们不想要那些有 :h :h :h 的。这只会发生在我们有 :h :h 并且我们正在添加 :h 的地方。所以...我`if c[0..1] != [:h,:h]`在添加 :h 时添加了一个，因此`nil`当它即将进行无效组合时它将返回而不是数组。

然后我不得不`compact`忽略所有结果`nil`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T20:47:21.117

这分解为：

当第一次是正面时+第一次是反面时，有多少种方法可以将一枚公平的硬币掷四次：

所以在python中：

```
HEADS = "1"
TAILS = "0"

def threeOrMoreHeadsInARow(bits):
    return "111" in bits

def flip(n = 5, flips = ""):
   if threeOrMoreHeadsInARow(flips):
      return 0
   if n == 0:
      return 1
   return flip(n - 1, flips + HEADS) + flip(n - 1, flips + TAILS) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T20:51:44.337

这是在 Python 中执行此操作的一种方法：

```
#This will hold all possible combinations of flipping the coins. 
flips = [[]]
for i in range(5):
    #Loop through the existing permutations, and add either 'h' or 't' 
    #to the end. 
    for j in range(len(flips)):
        f = flips[j]
        tails = list(f)
        tails.append('t')
        flips.append(tails)
        f.append('h')

#Now count how many of the permutations match our criteria.
fewEnoughHeadsCount = 0
for flip in flips:
    hCount = 0
    hasTooManyHeads = False
    for c in flip:
        if c == 'h': hCount += 1
        else: hCount = 0
        if hCount >= 3: hasTooManyHeads = True
    if not hasTooManyHeads: fewEnoughHeadsCount += 1

print 'There are %s ways.' % fewEnoughHeadsCount 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T18:02:47.543

`yield`这是一个使用 Ruby语句的递归组合函数：

```
def combinations(values, n)
  if n.zero?
    yield []
  else
    combinations(values, n - 1) do |combo_tail|
      values.each do |value|
        yield [value] + combo_tail
      end
    end
  end
end 
```

您可以使用正则表达式连续解析出三个头：

```
def three_heads_in_a_row(s)
  ([/hhh../, /.hhh./, /..hhh/].collect {|pat| pat.match(s)}).any?
end 
```

最后，你会得到这样的答案：

```
total_count = 0
filter_count = 0

combinations(["h", "t"], 5) do |combo|
  count += 1
  unless three_heads_in_a_row(combo.join)
      filter_count += 1
  end
end

puts "TOTAL: #{ total_count }"
puts "FILTERED: #{ filter_count }" 
```

所以我就是这样做的:)

# vb.net - 最佳实践：期权推断

> ID：667851
> 
> 赞同：21
> 
> 时间：2009-03-20T20:27:43.707
> 
> 标签：vb.net, visual-studio-2008, option-infer

您认为在您的项目中使用 Option Infer 的最佳实践是什么？

在 Visual Studio 2008 中，Option Infer 是一个指令，它允许编译器通过查看分配给它的内容来推断已声明变量的数据类型。

这是 VS2008 中的一个关键特性，广泛用于 LINQ 语句和查询。但是，打开 Option Infer 可能会给未来的维护程序员带来陷阱。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-20T20:44:42.263

C# 使用的类型推断（因此我认为其他 .net 语言）非常精确（并且非常出色）。编译器仅在类型清晰明确的情况下才允许该语句。因此，结果并不是真正的精度损失......这只是让开发人员免于多次声明类型。您正在减少代码中的重复。

（编辑：另外，重要的是要认识到结果**仍然是强类型**的。编译器在**编译时**知道变量的确切类型。**没有什么**像变体那样涉及。如果你输入`var x = 42;`它只是计算出 x是一个 int，因为您在右侧放置了一个 int，从而节省了一些打字和重复）。

未来的维护程序员可能不理解它的唯一原因是他们根本不理解类型推断的语言特性。但我认为期望和要求维护程序员了解语言特性比避免良好的语言特性担心未来的程序员不知道它们更合理。

我想如果你**知道**未来的程序员是初级的并且对语言不是很了解，那么你可能会避免一些事情。但这让我想知道您是否应该考虑其他一些语言，甚至是像 Access 这样的“平台”，它是“真正的编程”和非程序员可以做一些事情的混合体。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-20T20:57:47.927

这是我的建议：

**如果您已经设置了 Option Explicit On 和 Option Strict On（在任何级别）**

1.  在 IDE 和项目属性中关闭 Option Infer
2.  需要时在代码文件中打开 Option Infer。这确保了代码易于阅读，并且当它打开时，它会提醒读者注意它的使用并提醒他们将鼠标悬停在 var 上以查看其类型。

**When Option Explicit is Off...**

启用 Option Infer On 可以让充满变体的旧 VB6 代码更好地编译和运行，因为编译器会在编译时为 var 分配一个类型，而不是允许 var 被后期绑定。但是，应该进行测试以确保 var 在其生命周期内不会存储多种类型。

注意：这不能替代对移植到 .NET 的 VB6 代码的适当重构。变种很糟糕，孩子们，嗯？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-21T13:14:18.703

我看到的大多数错误都与 Strict 和 Explicit 有关，但有些错误与 Infer 有关。对于 VB，我认为这个 Option Strict On : Option Explicit On : Option Infer Off 是最好的起点。它确实使 For Next 的编写变得更加麻烦，但这确实意味着您的意图不会受到质疑。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-20T07:16:36.713

VB.Net 类型推断不能在 Partial Trust 环境中的 aspx 页面中使用……通常，VB.Net 默认选项让我们的生活更加艰难。在 VB9 中，有用的 Option Infer 默认是关闭的。我们不能写 Option Infer On... 我们不能在页面顶部写 <%@Page ... infer="true"%> ... 我们不能在 web.config 中写... 有人刚刚忘记了 VB 。网。

……

请参阅此处：[https ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=321981](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=321981)

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-03-20T20:44:05.853

我相信这是一个安全的选择，因为您不能跨方法边界传递“Var”类型。我不是 VB 或 Javascript Variant 类型的忠实粉丝，但 C# 中的 Var 非常方便。如果您打算使用 Linq，我不会关闭该选项。

——马特

# mysql - Django 连接池和时间字段

> ID：667859
> 
> 赞同：6
> 
> 时间：2009-03-20T20:30:04.717
> 
> 标签：mysql, django, sqlalchemy, connection-pooling

有没有人使用 Django、SQLAlchemy 和 MySQL 进行连接池？

我使用了本教程（[http://node.to/wordpress/2008/09/30/another-database-connection-pool-solution-for-django-mysql/](http://node.to/wordpress/2008/09/30/another-database-connection-pool-solution-for-django-mysql/)），效果很好，但我遇到的问题是我带回了一个时间字段，它正在转换为 timedelta，因为没有使用 Django 特定的转换。

来自 django/db/backends/mysql/base.py 的转换代码

```
django_conversions = conversions.copy()
django_conversions.update({
FIELD_TYPE.TIME: util.typecast_time,
FIELD_TYPE.DECIMAL: util.typecast_decimal,
FIELD_TYPE.NEWDECIMAL: util.typecast_decimal, 
```

})

文章中的连接代码：

```
if settings.DATABASE_HOST.startswith('/'):
            self.connection = Database.connect(port=kwargs['port'], 
                                               unix_socket=kwargs['unix_socket'], 
                                               user=kwargs['user'], 
                                               db=kwargs['db'], 
                                               passwd=kwargs['passwd'], 
                                               use_unicode=kwargs['use_unicode'], 
                                               charset='utf8')
        else:
            self.connection = Database.connect(host=kwargs['host'], 
                                               port=kwargs['port'], 
                                               user=kwargs['user'], 
                                               db=kwargs['db'], 
                                               passwd=kwargs['passwd'], 
                                               use_unicode=kwargs['use_unicode'], 
                                               charset='utf8') 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-05-25T03:47:37.317

在 Django 主干中，编辑 django/db/ **init** .py 并注释掉该行：

信号.request_finished.connect(close_connection)

此信号处理程序导致它在每次请求后断开与数据库的连接。我不知道这样做的所有副作用会是什么，但是在每次请求之后启动新连接没有任何意义；正如您所注意到的，它会破坏性能。

另一个必要的更改是在 django/middleware/transaction.py；删除两个 transaction.is_dirty() 测试并始终调用 commit() 或 rollback()。否则，如果它只从数据库中读取，它将不会提交事务，这将使应该关闭的锁处于打开状态。

# java - 是否有 selenium API 调用来检查 MultiSelectField 中是否有 somethingIsSelected？

> ID：667865
> 
> 赞同：1
> 
> 时间：2009-03-20T20:31:40.283
> 
> 标签：java, firefox, junit, selenium

我知道有一个 selenium API (isSomethingSelected) 用于查看是否在单选下拉列表中选择了一个值。多选是否有等价物？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T20:40:52.053

您是否尝试过 storeSelectedIndexes()、storeSelectedLabels() 或 storeSelectedValues()？

据我所见，没有办法直接检查多选元素的选择，但有人可能已经写了一个扩展。

# sql-server - 获取 SQL Server 2000 上的存储过程使用数据

> ID：667870
> 
> 赞同：2
> 
> 时间：2009-03-20T20:33:23.570
> 
> 标签：sql-server, stored-procedures, sql-server-2000

从 SQL Server 2000 中获取特定数据库上的存储过程使用数据的最佳方法是什么？

我需要的数据是：

1.  X 时间内所有存储过程调用的总数
2.  X 时间内每个特定存储过程调用的总数。
3.  X 时间内处理所有存储过程所花费的总时间。
4.  X 时间内处理特定存储过程所花费的总时间。

我的第一个预感是用一堆过滤器设置 SQL Profiler 来收集这些数据。我不喜欢这个解决方案的地方是数据必须写入某个文件或表中，我必须进行数字运算才能找出我需要的结果。当我应用更改以查看更改如何影响数据库时，我还希望在多天的过程中获得这些结果。

我无法直接访问服务器来运行 SQL Profiler，因此我需要创建跟踪模板文件并将其提交给我的 DBA，让他们在 X 时间内运行它，然后将结果返回给我。

有没有更好的解决方案来获取我需要的数据？如果可能的话，我想获得更多数据，但上述数据足以满足我当前的需求，我没有太多时间花在这上面。

编辑：也许有一些推荐的工具可以处理配置文件创建的跟踪文件以提供我想要的统计信息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T20:39:22.057

我看到的两个选项：

1.  重新编写脚本并重新编译您的存储过程以调用日志记录存储过程。所有想要进行性能跟踪的 sproc 都会调用该 sproc。将其写入带有存储过程名称、当前日期时间和您想要的任何其他内容的表中。 **优点**：很容易可逆，因为您可以在脚本中拥有存储过程的副本，您可以轻松地退出。轻松查询！ **缺点**：每次运行您要衡量的存储过程都会受到性能影响。

2.  使用将在每个 sproc 调用开始和结束时写入日志文本文件的代码重新编译数据访问层。您是否从一个可以在一个地方插入此日志记录代码的类继承您的 DAL？**优点**：没有数据库混乱，当您想停止此性能测量时，您可以在组件上切换进出。甚至可以通过 app.config 中的开/关进行调整。**缺点**：磁盘 I/O。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-20T21:14:20.493

也许在 SQL Profiler 之外创建 SQL Server Trace 可能会有所帮助。

[http://support.microsoft.com/kb/283790](http://support.microsoft.com/kb/283790)

此解决方案涉及创建一个包含所有跟踪选项的文本文件。输出被放入一个文本文件中。也许可以修改它以转储到日志表中。

监控痕迹： http: [//support.microsoft.com/kb/283786/EN-US/](http://support.microsoft.com/kb/283786/EN-US/)

# crystal-reports - Crystal Reports 运行总字段公式

> ID：667876
> 
> 赞同：1
> 
> 时间：2009-03-20T20:36:19.570
> 
> 标签：crystal-reports

```
WhileReadingRecords;
numbervar ContadorVenda=0;
IF {RELATORIO_ANGLO.tp_movimento} = "V" THEN
    ContadorVenda:=ContadorVenda+1; 
```

如何制作此公式以在报告中显示“ContadorVenda”的值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T20:42:52.597

只需添加一个 ContadorVenda；在末尾。像这样：

```
WhileReadingRecords;
numbervar ContadorVenda=0;
IF {RELATORIO_ANGLO.tp_movimento} = "V" THEN
    ContadorVenda:=ContadorVenda+1;

ContadorVenda; 
```

# web-services - 下载所有导入/包含的 WSDL 和模式的简单工具

> ID：667880
> 
> 赞同：20
> 
> 时间：2009-03-20T20:38:03.043
> 
> 标签：web-services, import, wsdl

WSDL 通常会导入其他 WSDL 和 XML 模式。

给定一个 WSDL 的 URL，是否有一个工具可以下载 WSDL 和所有其他引用的 WSDL 和模式？

理想情况下，这个工具应该是 Java 或 Perl 友好的。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-20T21:33:56.373

如网站所述，soapUI 有一个 WSDL 内容查看器

界面查看器允许对导入的 WSDL 的整个合同进行相对轻松的导航和检查，包括所有导入和包含的 WSDL 和 XSD 文件及其包含的类型、定义等。

[http://www.soapui.org/userguide/interfaces/interfaceeditor.html](http://www.soapui.org/userguide/interfaces/interfaceeditor.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2016-10-07T06:03:32.637

以下 perl 脚本将执行您想要的操作：

```
#!/usr/bin/perl
#

use strict;
use warnings;

use LWP::Simple;

sub downloadfile {
        my ($url, $file) = @_;
        getstore($url, $file);
}

sub getLinesMatching {
        my ($file, $pattern) = @_;
        open my $fh,'<',$file or die "Could not open $file: $!";
        my @matching = grep /schemaLocation/,<$fh>;
        my $size = @matching;
        close $fh;
        @matching;
}

sub processFile {
        my ($url, $file) = @_;

        downloadfile $url, $file;

        my @lines = getLinesMatching $file,'schemaLocation';
        if (@lines > 0) {
                foreach my $line (@lines) {
                        $line =~ /schemaLocation=\"([^\"]*)/;
                        my ($url2) = $1;
                        print "$url2\n\n";
                        $url2 =~ /.*\/([^\/]*)/;
                        my ($file2) = $1;
                        print "$file2\n\n";
                        processFile ($url2, $file2);
                }
        }
}

my ($url) = @ARGV;
$url =~ /.*\/([^\/]*)/;
my ($base) = $1;
$base =~ s/\?/./;

print "Processing [$base] for [$url]\n\n";

processFile $url, $base; 
```

总之，它将传入的参数作为 URL 来检索作为第一个文件。然后它扫描该文件的 schemaLocation 属性，并以递归方式下载每个文件，直到找到或找不到所有模式。

要调用脚本：

> perl thisscript.perl wsdlURL

它将尝试通过每个导入的 xsd 从 wsdl 文件递归工作，并在当前目录中创建所有文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T13:36:35.263

Altova [SchemaAgent](http://www.altova.com/products/schemaagent/xml_schema_management.html)工具可以下载、可视化和建模 WSDL 和多个模式。当事情变得复杂时，这非常好。

# c# - 序列化强类型对象列表

> ID：667881
> 
> 赞同：1
> 
> 时间：2009-03-20T20:38:09.893
> 
> 标签：c#, asp.net, xml

我可能搞砸了设计决定。我没有使用强类型的自定义对象集合，而是使用了通用列表。本质上，我所拥有的是：

```
public class AreaFields
{
    [XmlArray("Items")]
    [XmlArrayItem("Item")]
    public List<Fields> Fields { set; get; }

    [XmlAttribute]
    int id { set; get; }
}

public class Fields
{
    [XmlAttribute]
    public string Name { set; get; }
} 
```

在整个应用程序中，我使用了`List<AreaFields>`Now，我需要将列表序列化为 XML。我希望得到的是：

```
 <SomeXMLTag>
    <AreaFields id='1000'>
     <Items>
       <Item Name="Test1" />
       <Item Name="Test2" />
     </Items>
    </AreaFields>
    <AreaFields id='1001'>
     <Items>
       <Item Name="Test1" />
       <Item Name="Test2" />
     </Items>
    </AreaFields>
    </SomeXMLTag> 
```

由于我无法序列化 List<> （或者我可以吗？），我将不得不序列化列表中的每个项目。

```
Ex: List<AreaFields> list = new List<AreaFields>();
//    more code to add to list
    list[0].GetRawXML(); //A method i have to serialize 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T20:46:07.690

你需要一个包装类；然后根据您的示例序列化实例`MyWrapper`以获取 xml。

```
[XmlRoot("SomeXMLTag")]
public class MyWrapper
{
    [XmlElement("AreaFields")]
    public List<AreaFields> AreaFields { get; set; }
}

public class AreaFields
{
    [XmlArray("Items")]
    [XmlArrayItem("Item")]
    public List<Fields> Fields { set; get; }

    [XmlAttribute]
    public int id { set; get; }
}

public class Fields
{
    [XmlAttribute]
    public string Name { set; get; }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-20T20:41:38.340

您可以序列化 List<>。[在这里](https://stackoverflow.com/questions/664267/serializing-an-arraylist-in-c/664504#664504)阅读我使用的属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T20:53:16.113

```
using System;
using System.Collections.Generic;
using System.Xml;
using System.Xml.Serialization;
using System.Text;
using System.IO;

namespace Utils
{
    public class XMLSerializer
    {
        public static Byte[] StringToUTF8ByteArray(String xmlString)
        {
            return new UTF8Encoding().GetBytes(xmlString);
        }

        public static String SerializeToXML<T>(T objectToSerialize)
        {
            StringBuilder sb = new StringBuilder();

            XmlWriterSettings settings = 
                new XmlWriterSettings {Encoding = Encoding.UTF8, Indent = true};

            using (XmlWriter xmlWriter = XmlWriter.Create(sb, settings))
            {
                if (xmlWriter != null)
                {
                    new XmlSerializer(typeof(T)).Serialize(xmlWriter, objectToSerialize);
                }
            }

            return sb.ToString();
        }

        public static void DeserializeFromXML<T>(string xmlString, out T deserializedObject) where T : class
        {
            XmlSerializer xs = new XmlSerializer(typeof (T));

            using (MemoryStream memoryStream = new MemoryStream(StringToUTF8ByteArray(xmlString)))
            {
                deserializedObject = xs.Deserialize(memoryStream) as T;
            }
        }
    }
} 
```

然后，当您要打印列表时，请执行以下操作：

```
List<AreaFields> list = new List<AreaFields>();
//    more code to add to list
Console.WriteLine(Utils.XMLSerializer.SerializeToXML(areaFields)); 
```

**编辑**：更改序列化程序以避免其中一种二进制转换。你需要确保你想要序列化的所有属性都是公共的，并且你有一个不带参数的构造函数。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-03-22T06:24:03.347

Java 泛型通过类型擦除工作。这有点意味着当应用程序实际运行时，JVM 并不关心泛型。编译器会注意它们，然后从字节码中丢弃它们（尽管某些注释放在 .class 文件等中）

因此，对泛型类型的对象进行序列化和反序列化是一件轻而易举的事。它反序列化为列表，然后您将其转换。

# iphone - iPhone 是否支持具有 alphatransparency 的 24 位 PNG？

> ID：667883
> 
> 赞同：3
> 
> 时间：2009-03-20T20:38:19.750
> 
> 标签：iphone, png

我知道 iPhone 更喜欢 PNG。还有带有 alphatransparency 的 PNG-24？我希望是的！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-20T20:43:25.653

我认为即使它确实可以通过 pngcrush 在部署时将 png 优化到 8 位......为什么你需要如此高水平的色彩准确度？

我忘了提到支持透明度。想想看，24 位 png 每个通道只有 8 位（我在想 16 位）所以.. 是的！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-06T15:14:03.557

[来自自定义图标和图像创建指南](http://developer.apple.com/library/ios/#documentation/userexperience/conceptual/mobilehig/IconsImages/IconsImages.html)文档的一些信息：

> 对于所有图像和图标，建议使用 PNG 格式（**避免使用交错的 PNG**）。
> 
> 图标和图像的**标准位深度为 24 位**（红色、绿色和蓝色各 8 位），外加一个 8 位 Alpha 通道。
> 
> 您无需将调色板限制为网络安全颜色。尽管您可以在为导航栏、工具栏和标签栏创建的图标中使用 Alpha 透明度，但不要在应用程序图标中使用它。

# asp.net - ASP.NET 中的 AES 与 VB.NET

> ID：667887
> 
> 赞同：4
> 
> 时间：2009-03-20T20:39:40.653
> 
> 标签：asp.net, encryption, cryptography, aes

关于使用 AES 加密 URL 链接以使用 VB.NET 2005 将用户名传递到 ASP.NET 中的另一个网站的好链接或文章是什么？仅供参考：接收网站将有权访问私钥进行解密。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-20T22:40:52.563

## 第一的

不要这样做！编写自己的加密系统很容易导致出错。最好使用现有系统，或者如果没有，请让知道密码学的人来做。如果您必须自己做，请阅读[实用密码学](https://rads.stackoverflow.com/amzn/click/com/0471223573)。

请记住：**“我们已经拥有足够快但不安全的系统。”** (Bruce Schneier) -- 做正确的事，以后再担心性能。

也就是说，如果您坚持使用 AES 来推出自己的产品，这里有一些建议。

## 初始化向量

AES 是一种分组密码。给定一个密钥和一个明文块，它将其转换为特定的密文。这样做的问题是，相同的数据块每次都会使用相同的密钥生成相同的密文。所以假设你发送这样的数据：

用户=加密（用户名）&角色=加密（用户角色）

它们是两个独立的块，无论名称如何，UserRoles 加密每次都将具有相同的密文。我所需要的只是管理员的密文，我可以用我的密码用户名将其放入。哎呀。

所以，有[密码操作模式](http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation)。主要思想是您将获取一个块的密文，并将其异或到下一个块的密文中。这样我们就可以进行 Encrypt(UserRoles, Username)，而用户名密文会受到 UserRoles 的影响。

问题是第一个块仍然容易受到攻击——只要看到某人的密文，我就可能知道他们的角色。输入[初始化向量](http://en.wikipedia.org/wiki/Initialization_vector)。IV“启动”密码并确保它具有随机数据来加密流的其余部分。因此，现在 UserRoles 密文具有随机 IV XOR 的密文。问题解决了。

因此，请确保为每条消息生成一个随机 IV。IV 不敏感，可以与密文一起发送明文。使用足够大的 IV - 对于许多情况，块的大小应该没问题。

## 正直

AES 不提供完整性功能。任何人都可以修改您的密文，并且解密仍然有效。一般来说，它不太可能是*有效*数据，但可能很难知道什么是有效数据。例如，如果您要传输加密的 GUID，则很容易修改一些位并生成一个完全不同的位。这可能会导致应用程序错误等等。

修复方法是在明文上运行哈希算法（使用 SHA256 或 SHA512），并将其包含在您传输的数据中。因此，如果我的消息是 (UserName, Roles)，您将发送 (UserName, Roles, Hash(UserName, Roles))。现在，如果有人通过翻转来篡改密文，哈希将不再计算，您可以拒绝该消息。

## 密钥派生

如果您需要从密码生成密钥，请使用内置类：[System.Security.Cryptography.PasswordDeriveBytes](http://msdn.microsoft.com/en-us/library/system.security.cryptography.passwordderivebytes.aspx)。这提供了加盐和迭代，可以提高派生密钥的强度，并减少密钥泄露时发现密码的机会。

## 计时/重播

编辑：很抱歉之前没有提到这一点：P。你还需要确保你有一个反重放系统。如果您只是加密消息并传递它，那么任何收到消息的人都可以重新发送它。为避免这种情况，您应该在消息中添加时间戳。如果时间戳与某个阈值不同，则拒绝该消息。您可能还想在其中包含一个一次性 ID（这可能是 IV）并拒绝来自使用相同 ID 的其他 IP 的时间有效消息。

在包含计时信息时，确保进行哈希验证很重要。否则，如果您未检测到此类蛮力尝试，则有人可能会篡改一些密文并可能生成有效的时间戳。

## 示例代码

由于显然正确使用 IV 对某些人来说是有争议的，这里有一些代码可以生成随机 IV 并将它们添加到您的输出中。它还将执行身份验证步骤，确保未修改加密数据。

```
using System;
using System.Security.Cryptography;
using System.Text;

class AesDemo {

    const int HASH_SIZE = 32; //SHA256

    /// <summary>Performs encryption with random IV (prepended to output), and includes hash of plaintext for verification.</summary>
    public static byte[] Encrypt(string password, byte[] passwordSalt, byte[] plainText) {
        // Construct message with hash
        var msg = new byte[HASH_SIZE + plainText.Length];
        var hash = computeHash(plainText, 0, plainText.Length);
        Buffer.BlockCopy(hash, 0, msg, 0, HASH_SIZE);
        Buffer.BlockCopy(plainText, 0, msg, HASH_SIZE, plainText.Length);

        // Encrypt
        using (var aes = createAes(password, passwordSalt)) {
            aes.GenerateIV();
            using (var enc = aes.CreateEncryptor()) {

                var encBytes = enc.TransformFinalBlock(msg, 0, msg.Length);
                // Prepend IV to result
                var res = new byte[aes.IV.Length + encBytes.Length];
                Buffer.BlockCopy(aes.IV, 0, res, 0, aes.IV.Length);
                Buffer.BlockCopy(encBytes, 0, res, aes.IV.Length, encBytes.Length);
                return res;
            }
        }
    }

    public static byte[] Decrypt(string password, byte[] passwordSalt, byte[] cipherText) {
        using (var aes = createAes(password, passwordSalt)) {
            var iv = new byte[aes.IV.Length];
            Buffer.BlockCopy(cipherText, 0, iv, 0, iv.Length);
            aes.IV = iv; // Probably could copy right to the byte array, but that's not guaranteed

            using (var dec = aes.CreateDecryptor()) {
                var decBytes = dec.TransformFinalBlock(cipherText, iv.Length, cipherText.Length - iv.Length);

                // Verify hash
                var hash = computeHash(decBytes, HASH_SIZE, decBytes.Length - HASH_SIZE);
                var existingHash = new byte[HASH_SIZE];
                Buffer.BlockCopy(decBytes, 0, existingHash, 0, HASH_SIZE);
                if (!compareBytes(existingHash, hash)){
                    throw new CryptographicException("Message hash incorrect.");
                }

                // Hash is valid, we're done
                var res = new byte[decBytes.Length - HASH_SIZE];
                Buffer.BlockCopy(decBytes, HASH_SIZE, res, 0, res.Length);
                return res;
            }
        }
    }

    static bool compareBytes(byte[] a1, byte[] a2) {
        if (a1.Length != a2.Length) return false;
        for (int i = 0; i < a1.Length; i++) {
            if (a1[i] != a2[i]) return false;
        }
        return true;
    }

    static Aes createAes(string password, byte[] salt) {
        // Salt may not be needed if password is safe
        if (password.Length < 8) throw new ArgumentException("Password must be at least 8 characters.", "password");
        if (salt.Length < 8) throw new ArgumentException("Salt must be at least 8 bytes.", "salt");
        var pdb = new PasswordDeriveBytes(password, salt, "SHA512", 129);
        var key = pdb.GetBytes(16);

        var aes = Aes.Create();
        aes.Mode = CipherMode.CBC;
        aes.Key = pdb.GetBytes(aes.KeySize / 8);
        return aes;
    }

    static byte[] computeHash(byte[] data, int offset, int count) {
        using (var sha = SHA256.Create()) {
            return sha.ComputeHash(data, offset, count);
        }
    }

    public static void Main() {
        var password = "1234567890!";
        var salt = new byte[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 0 };
        var ct1 = Encrypt(password, salt, Encoding.UTF8.GetBytes("Alice; Bob; Eve;: PerformAct1"));
        Console.WriteLine(Convert.ToBase64String(ct1));
        var ct2 = Encrypt(password, salt, Encoding.UTF8.GetBytes("Alice; Bob; Eve;: PerformAct2"));
        Console.WriteLine(Convert.ToBase64String(ct2));

        var pt1 = Decrypt(password, salt, ct1);
        Console.WriteLine(Encoding.UTF8.GetString(pt1));
        var pt2 = Decrypt(password, salt, ct2);
        Console.WriteLine(Encoding.UTF8.GetString(pt2));

        // Now check tampering
        try {
            ct1[30]++;
            Decrypt(password, salt, ct1);
            Console.WriteLine("Error: tamper detection failed.");
        } catch (Exception ex) {
            Console.WriteLine("Success: tampering detected.");
            Console.WriteLine(ex.ToString());
        }
    }
} 
```

输出：

> JZVaD327sDmCmdzY0PsysnRgHbbC3eHb7YXALb0qxFVlr7Lkj8WaOZWc1ayWCvfhTUz/y0QMz+uv0PwmuG8VBVEQThaNTD02JlhIs1DjJtg= QQvDujNJ31qTu/foDFUiVMeWTU0jKL/UJJfFAvmFtz361o3KSUlk/zH+4701mlFEU4Ce6VuAAuaiP1EENBJ74Wc8mE/QTofkUMHoa65/5e4= Alice; 鲍勃；Eve;: PerformAct1 爱丽丝; 鲍勃；Eve;: PerformAct2 成功：检测到篡改。System.Security.Cryptography.CryptographicException：消息哈希不正确。在 AesDemo.Decrypt(String password, Byte[] passwordSalt, Byte[] cipherText) 在 C:\Program.cs:line 46 在 AesDemo.Main() 在 C:\Program.cs:line 100

删除随机 IV 和哈希后，输出类型如下：

> tZfHJSFTXYX8V38AqEfYVXU5Dl/meUVAond70yIKGHY= tZfHJSFTXYX8V38AqEfYVcf9a3U8vIEk1LuqGEyRZXM=

注意第一个块如何对应于“Alice; Bob; Eve;” 是一样的。确实是“角落案例”。

## 没有散​​列的例子

这是一个传递 64 位整数的简单示例。只需加密，您就会受到攻击。事实上，攻击很容易完成，即使使用 CBC 填充。

```
public static void Main() {
    var buff = new byte[8];
    new Random().NextBytes(buff);
    var v = BitConverter.ToUInt64(buff, 0);
    Console.WriteLine("Value: " + v.ToString());
    Console.WriteLine("Value (bytes): " + BitConverter.ToString(BitConverter.GetBytes(v)));
    var aes = Aes.Create();
    aes.GenerateIV();
    aes.GenerateKey();
    var encBytes = aes.CreateEncryptor().TransformFinalBlock(BitConverter.GetBytes(v), 0, 8);
    Console.WriteLine("Encrypted: " + BitConverter.ToString(encBytes));
    var dec = aes.CreateDecryptor();
    Console.WriteLine("Decrypted: " + BitConverter.ToUInt64(dec.TransformFinalBlock(encBytes, 0, encBytes.Length), 0));
    for (int i = 0; i < 8; i++) {
        for (int x = 0; x < 250; x++) {
            encBytes[i]++;
            try {
                Console.WriteLine("Attacked: " + BitConverter.ToUInt64(dec.TransformFinalBlock(encBytes, 0, encBytes.Length), 0));
                return;
            } catch { }
        }
    }
} 
```

输出：

> 价值：6598637501946607785 价值
> 
> （字节）：A9-38-19-D1-D8-11-93-5B
> 
> 加密：
> 
> 31-59-B0-25-FD-C5-13-D7-81-D8-F5-8A-33-2A-57-DD
> 
> 解密：6598637501946607785
> 
> 被攻击：14174658352338201502

因此，如果这是您发送的那种 ID，它可以很容易地更改为另一个值。您需要在消息之外进行身份验证。有时，消息结构不太可能落实到位，并且可以起到保护作用，但为什么要依赖可能改变的东西呢？无论应用程序如何，您都需要能够依赖您的加密货币正常工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T21:03:51.263

我写了一篇博客文章，其中有一个示例项目，您可以在此处下载（虽然是 C#）： http: [//www.codestrider.com/blog/read/AESFileEncryptorWithRSAEncryptedKeys.aspx](http://www.codestrider.com/blog/read/AESFileEncryptorWithRSAEncryptedKeys.aspx)

该代码基本上使用 AES 加密二进制数据，然后 RSA 使用 X509Certificate 加密密钥和 IV。所以，只要有私钥证书，就可以解密Key和IV，进而解密AES加密的数据..

您可以设置您的证书存储，以便“加密器”只能访问公钥证书，而“解密器”可以访问私钥。

这使您可以每次使用不同的密钥和 IV 进行加密，并避免对任何内容进行硬编码。我认为这更安全。您的源代码中不应该有任何内容可以轻易地让某人解密您的数据 - 如果您的系统曾经受到威胁，您只需将证书换成新证书即可。无需使用新的硬编码值重新编译应用程序.. :)

示例代码可能与您的预期用途略有不同，但我认为该技术和一些代码可能对您有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T21:08:27.900

Below you'll find a class that provides AES Encryption/Decryption methods that explicitly provide URL-friendly strings for use in applications like yours. It also has the methods that work with byte arrays.

NOTE: you should use different values in the Key and Vector arrays! You wouldn't want someone to figure out your keys by just assuming that you used this code as-is! All you have to do is change some of the numbers (must be <= 255) in the Key and Vector arrays.

Using it is easy: just instantiate the class and then call (usually) EncryptToString(string StringToEncrypt) and DecryptString(string StringToDecrypt) as methods. It couldn't be any easier (or more secure) once you have this class in place.

* * *

```
using System;
using System.Data;
using System.Security.Cryptography;
using System.IO;

public class SimpleAES
{
    // Change these keys
    private byte[] Key = { 123, 217, 19, 11, 24, 26, 85, 45, 114, 184, 27, 162, 37, 112, 222, 209, 241, 24, 175, 144, 173, 53, 196, 29, 24, 26, 17, 218, 131, 236, 53, 209 };
    private byte[] Vector = { 146, 64, 191, 111, 23, 3, 113, 119, 231, 121, 2521, 112, 79, 32, 114, 156 };

    private ICryptoTransform EncryptorTransform, DecryptorTransform;
    private System.Text.UTF8Encoding UTFEncoder;

    public SimpleAES()
    {
        //This is our encryption method
        RijndaelManaged rm = new RijndaelManaged();

        //Create an encryptor and a decryptor using our encryption method, key, and vector.
        EncryptorTransform = rm.CreateEncryptor(this.Key, this.Vector);
        DecryptorTransform = rm.CreateDecryptor(this.Key, this.Vector);

        //Used to translate bytes to text and vice versa
        UTFEncoder = new System.Text.UTF8Encoding();
    }

    /// -------------- Two Utility Methods (not used but may be useful) -----------
    /// Generates an encryption key.
    static public byte[] GenerateEncryptionKey()
    {
        //Generate a Key.
        RijndaelManaged rm = new RijndaelManaged();
        rm.GenerateKey();
        return rm.Key;
    }

    /// Generates a unique encryption vector
    static public byte[] GenerateEncryptionVector()
    {
        //Generate a Vector
        RijndaelManaged rm = new RijndaelManaged();
        rm.GenerateIV();
        return rm.IV;
    }

    /// ----------- The commonly used methods ------------------------------    
    /// Encrypt some text and return a string suitable for passing in a URL.
    public string EncryptToString(string TextValue)
    {
        return ByteArrToString(Encrypt(TextValue));
    }

    /// Encrypt some text and return an encrypted byte array.
    public byte[] Encrypt(string TextValue)
    {
        //Translates our text value into a byte array.
        Byte[] bytes = UTFEncoder.GetBytes(TextValue);

        //Used to stream the data in and out of the CryptoStream.
        MemoryStream memoryStream = new MemoryStream();

        /*
         * We will have to write the unencrypted bytes to the stream,
         * then read the encrypted result back from the stream.
         */
        #region Write the decrypted value to the encryption stream
        CryptoStream cs = new CryptoStream(memoryStream, EncryptorTransform, CryptoStreamMode.Write);
        cs.Write(bytes, 0, bytes.Length);
        cs.FlushFinalBlock();
        #endregion

        #region Read encrypted value back out of the stream
        memoryStream.Position = 0;
        byte[] encrypted = new byte[memoryStream.Length];
        memoryStream.Read(encrypted, 0, encrypted.Length);
        #endregion

        //Clean up.
        cs.Close();
        memoryStream.Close();

        return encrypted;
    }

    /// The other side: Decryption methods
    public string DecryptString(string EncryptedString)
    {
        return Decrypt(StrToByteArray(EncryptedString));
    }

    /// Decryption when working with byte arrays.    
    public string Decrypt(byte[] EncryptedValue)
    {
        #region Write the encrypted value to the decryption stream
        MemoryStream encryptedStream = new MemoryStream();
        CryptoStream decryptStream = new CryptoStream(encryptedStream, DecryptorTransform, CryptoStreamMode.Write);
        decryptStream.Write(EncryptedValue, 0, EncryptedValue.Length);
        decryptStream.FlushFinalBlock();
        #endregion

        #region Read the decrypted value from the stream.
        encryptedStream.Position = 0;
        Byte[] decryptedBytes = new Byte[encryptedStream.Length];
        encryptedStream.Read(decryptedBytes, 0, decryptedBytes.Length);
        encryptedStream.Close();
        #endregion
        return UTFEncoder.GetString(decryptedBytes);
    }

    /// Convert a string to a byte array.  NOTE: Normally we'd create a Byte Array from a string using an ASCII encoding (like so).
    //      System.Text.ASCIIEncoding encoding = new System.Text.ASCIIEncoding();
    //      return encoding.GetBytes(str);
    // However, this results in character values that cannot be passed in a URL.  So, instead, I just
    // lay out all of the byte values in a long string of numbers (three per - must pad numbers less than 100).
    public byte[] StrToByteArray(string str)
    {
        if (str.Length == 0)
            throw new Exception("Invalid string value in StrToByteArray");

        byte val;
        byte[] byteArr = new byte[str.Length / 3];
        int i = 0;
        int j = 0;
        do
        {
            val = byte.Parse(str.Substring(i, 3));
            byteArr[j++] = val;
            i += 3;
        }
        while (i < str.Length);
        return byteArr;
    }

    // Same comment as above.  Normally the conversion would use an ASCII encoding in the other direction:
    //      System.Text.ASCIIEncoding enc = new System.Text.ASCIIEncoding();
    //      return enc.GetString(byteArr);    
    public string ByteArrToString(byte[] byteArr)
    {
        byte val;
        string tempStr = "";
        for (int i = 0; i <= byteArr.GetUpperBound(0); i++)
        {
            val = byteArr[i];
            if (val < (byte)10)
                tempStr += "00" + val.ToString();
            else if (val < (byte)100)
                tempStr += "0" + val.ToString();
            else
                tempStr += val.ToString();
        }
        return tempStr;
    }
} 
```

* * *

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-20T20:47:32.740

[Markt](https://stackoverflow.com/users/56128/markt)指出，Rijndael 使用 AES 加密算法。由于托管实现随 .net 框架一起提供（并且至少从 1.1 开始），因此使用它应该满足 OP。

[API 文档](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndael.aspx)有一个使用 Rijndael 作为加密和解密流的非常简单的示例。

如果您有办法将共享秘密（例如，私钥）获取到另一个网站，那么您可能可以使用普通的旧对称加密（没有公钥，双方都知道 IV 和私钥） ）。如果您的大脑是共享密钥的“不安全通道”（例如，您管理两个网站），情况尤其如此。:)

> 查看[“使用新的高级加密标准确保您的数据安全”](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndael.aspx)。AES 实现不随 .NET 框架提供，但它链接到自定义实现 (AES.exe)。
> 
> [1](https://stackoverflow.com/users/56128/markt)：http: [//msdn.microsoft.com/en-us/magazine/cc164055.aspx](http://msdn.microsoft.com/en-us/magazine/cc164055.aspx)

# delphi - 用于 Delphi 的运行时可更改的 ORM / OPF 对象持久性框架

> ID：667891
> 
> 赞同：3
> 
> 时间：2009-03-20T20:41:06.280
> 
> 标签：delphi, object-persistence

我正在进行的项目之一涉及一个模块，该模块需要允许最终用户创建本质上等同于他们自己的“对象类”，存储他们可以在运行时设计和修改的数据结构/记录类型。用户还可以相当程度地自定义用户界面，但这不是这个问题的范围。

我已经看到，与我们正在努力使用此功能构建的最接近的示例将非常类似于 InstantObjects 在设计时提供的东西，除了我们的系统将在运行时提供它，并将类设计控件放在最终用户的手中（显然，他们通常在技术上相当复杂）。

我最近遇到了 Delphi Win32 的对象持久性框架列表：http: [//tdelphihobbyist.blogspot.com/2008/01/win32-object-persistence-frameworks.html](http://tdelphihobbyist.blogspot.com/2008/01/win32-object-persistence-frameworks.html)

关于其中哪些可能最有利于我们正在尝试创建的运行时灵活性的任何建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T02:05:36.203

tiopf 新闻组目前正在对此进行讨论。Tiopf 是一个开源的对象持久化框架。目前它不支持用户可修改的对象，但看起来有人很快就会添加这个功能。

主站点：[http](http://tiopf.sourceforge.net/) ://tiopf.sourceforge.net/ 新闻组：参见[http://tiopf.sourceforge.net/Support.shtml](http://tiopf.sourceforge.net/Support.shtml)

请参阅支持新闻组中的“tiOPF 广告运行时修改”线程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T17:19:43.433

[JSON](http://json.org/)可用于在运行时声明和修改用户定义的数据结构。Delphi 有两个库，[SuperObject](http://www.progdigy.com/?page_id=6)和[lkJSON](http://sourceforge.net/projects/lkjson/)。使用 JSON，对象层次结构将很容易构建。SuperObject 演示源包括许多使用领域的示例。SuperObject 还包含给定 JSON 对象结构的迭代器方法。我将它用于 Delphi 客户端库，该库能够使用 ApacheMQ 消息代理与 Java 交换对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T00:40:35.927

您可以使用 xml 创建某种形式的持久性，然后相应地构建一个表单，例如，我们为可配置的过滤器窗口做了很多事情

# delphi - 对象状态（子集）持久性

> ID：667897
> 
> 赞同：3
> 
> 时间：2009-03-20T20:42:47.137
> 
> 标签：delphi, persistence, set

我需要帮助：

我将对象属性存储在 DataPacket 类中。属性是这样定义的

```
type
  TProperty = class
  private
    FName: string;
  public
    constructor Create(const AName: string);
    property Name: string read FName;
  end;

  TIntegerProperty = class(TProperty)
  private
    FValue: Integer;
  protected
    procedure SetValue(const AValue:integer);
  public
    property Value: Integer read FValue write SetValue;
  end; 
```

数据包类：

```
type
  TDataPacket = class
  private
    FProperties: TStringList;
  public
    function GetIntegerValue(const APropertyName: string): integer;
    .....
    procedure SetIntegerValue(const APropertyName: string; AValue: integer);
end; 
```

它们的实现方式如下：

```
function TDataPacket.GetIntegerValue(const APropertyName: string): integer;
var
  Pos: integer;
begin
  Pos := FProperties.IndexOf(APropertyName);
  if Pos > -1 then
    Result := TIntegerProperty(FProperties.Objects[Pos]).Value
  else
    Result := 0;
end;

procedure TDataPacket.SetIntegerValue(const APropertyName: string; AValue: integer);
var
  Pos: integer;
  AProperty: TIntegerProperty;
begin
  Pos := FProperties.IndexOf(APropertyName);
  if Pos >- 1 then
    TIntegerProperty(FProperties.Objects[Pos]).Value := AValue
  else
    begin
      AProperty:= TIntegerProperty.Create(APropertyName);
      AProperty.Value := AValue;
      FProperties.AddObject(APropertyName, AProperty);
    end;
end; 
```

现在的问题是：我需要定义一个定义为 TObjectStatus 的 Status 属性，其中：

```
type
  TStatus = (Deleted, Unchanged, Added , Modified, ChildsModified);

  TObjectStatus = Set of TStatus; 
```

关于如何定义、存储和检索它的任何想法？

抱歉冗长的解释，并提前感谢您的帮助

迈克尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T20:52:56.270

First:

```
Result := TIntegerProperty(FProperties.Objects[Pos]).Value 
```

Is risky because you will crash if it is not a TIntegerProperty. Use something like:

```
Pos := FProperties.IndexOf(APropertyName);
if (Pos >= 0) and (FProperties.Objects[Pos] is TIntegerProperty) then
  Result := TIntegerProperty(FProperties.Objects[Pos]).Value
else
  Result := 0; 
```

Next the status, I don't think you need them al:

For the list - Deleted a child: Deleted - Added a child: Added - Child had been changed: ChildsModified

You don't need unchanged because in that case, the set is empty. And you don't need Modified because in that case the set is not empty.

For the properties you can just add a Changed value. You can add ChildsModified directly if a child is changed. Or you can use lazy evaluation and walk all children to check for Changed.

Ok you can do something like this:

```
type
  TStatus = (stDeleted, stAdded , stModified, stChildsModified);
  TObjectStatus = Set of TStatus;

  TDataPacket = class;
  TProperty = class
  private
    FName   : string;
    FParent : TDataPacket; 
  protected
    procedure NotifyChange(const AStatus: TStatus);
  public
    constructor Create(const AParent: TDataPacket; const AName: string);
    property Name: string read FName;
  end;

  TIntegerProperty = class(TProperty)
  private
    FValue: Integer;
    procedure SetValue(const AValue:integer);
  public
    property Value: Integer read FValue write SetValue;
  end;

  TDataPacket = class
  private
    FProperties: TStringList;
    FStatus : TObjectStatus;
  protected 
    procedure NotifyChange(const AStatus: TStatus);

    function GetProperty(const AName: string): TProperty;
  public
    function GetIntegerValue(const APropertyName: string): integer;
    procedure SetIntegerValue(const APropertyName: string; AValue: integer);
  end;

procedure TProperty.NotifyChange(const AStatus: TStatus);
begin
  FParent.NotifyChange(AStatus);
end;

constructor TProperty.Create(const AParent: TDataPacket; const AName: string);
begin
  Assert(AParent<>nil);
  FName := AName;
  FParent := AParent;
end;

procedure TIntegerProperty.SetValue(const AValue:integer);
begin
  if AValue<>FValue then begin
    FValue := AValue;
    NotifyChange(stChildsModified);
  end;
end;

procedure TDataPacket.NotifyChange(const AStatus: TStatus);
begin
  if AProp=nil then begin
    case AStatus of

  TStatus = (stDeleted, stAdded , stModified, stChildsModified);

  FStatus := FStatus + [AStatus];
end;

function TDataPacket.GetProperty(const AName: string): TProperty;
var
  i : Integer;
begin
  i := FProperties.IndexOf(AName);
  if i>=0 then
    Result := TProperty(FProperties.Objects[i])
  else
    Result := nil;
end;

function TDataPacket.GetIntegerValue(const APropertyName: string): integer;
var
  prop : TProperty;
begin
  prop := GetProperty(APropertyName);
  if (prop<>nil) and (prop is TIntegerProperty) then
    Result := TIntegerProperty(prop).Value
  else
    Result := 0; 
end;

procedure TDataPacket.SetIntegerValue(const APropertyName: string; AValue: integer);
var
  prop : TProperty;
  intprop : TIntegerProperty; 
begin
  prop := GetProperty(APropertyName);
  if (prop<>nil) and not (AProperty is TIntegerProperty) then begin
    // PANIC!
  end else begin
    if prop=nil then begin
      intprop := TIntegerProperty.Create(self, APropertyName);
      intprop.Value := AValue;
      FProperties.AddObject(APropertyName, intprop);
      NotifyChange(stAdded);
    end else begin
      TIntegerProperty(prop).Value := AValue;   
    end;
  end;
end; 
```

And off course add support for deletion.

You can let the Property handle all changes (Add when constructed and Delete when freed).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T15:42:59.330

如果您正在存储一个对象的属性，并且其中一个属性应该是状态属性，那么您最终需要做的就是与您为 所做的相同`TIntegerProperty`，但`Integer`用`TObjectStatus`.

`TObjectStatus`首先，定义另一个保存您的值的属性类：

```
type
  TObjectStatusProperty = class(TProperty)
  private
    FValue: TObjectStatus;
  protected
    procedure SetValue(const AValue: TObjectStatus);
  public
    property Value: TObjectStatus read FValue write SetValue;
  end; 
```

接下来，将方法添加到您的数据包以使用该类型的属性：

```
function TDataPacket.GetObjectStatusValue(
  const APropertyName: string): TObjectStatus;
var
  Pos: integer;
  Prop: TProperty;
begin
  Pos := FProperties.IndexOf(APropertyName);
  if Pos >= 0 then begin
    Prop := FProperties.Objects[Pos] as TProperty;
    Assert(Prop.Name = APropertyName);
    if Prop is TObjectStatusProperty then
      Result := TObjectStatusProperty(Prop).Value
    else
      raise EWrongPropertyType.CreateFmt('Expected %s but got %s',
        [TObjectStatusProperty.ClassName, Prop.ClassName]);
  end else
    Result := [];
end;

procedure TDataPacket.SetObjectStatusValue(
  const APropertyName: string; AValue: TObjectStatus);
var
  Pos: integer;
  Prop: TProperty;
begin
  Pos := FProperties.IndexOf(APropertyName);
  if Pos >= 0 then begin
    Prop := FProperties.Objects[Pos] as TProperty;
    Assert(Prop.Name = APropertyName);
    if Prop is TObjectStatusProperty then
      TObjectStatusProperty(Prop).Value := AValue
    else
      raise EWrongPropertyType.CreateFmt('Expected %s but got %s',
        [TObjectStatusProperty.ClassName, Prop.ClassName]);
  end else begin
    Prop := TObjectStatusProperty.Create(APropertyName);
    TObjectStatusProperty(Prop).Value := AValue;
    FProperties.AddObject(APropertyName, Prop);
  end;
end; 
```

如果您拥有 Delphi 2009 并且 Delphi 的泛型支持集合，这可能是使用泛型减少您需要编写的类数量的绝佳机会。`T`*`X`*`Property`

# c++ - Boost (BGL)：如何去混淆我的错误？

> ID：667912
> 
> 赞同：2
> 
> 时间：2009-03-20T20:46:08.860
> 
> 标签：c++, templates, boost, boost-graph

我似乎记得读过有关在与 boost 库相关的编译器错误中“减少”模板喷射大小的方法。我的回忆是它为模板参数提供了比编译器默认命名更好的名称（这非常可怕）。

这是真的，还是我梦到的？我一直试图找到我在哪里读到这篇文章，但我似乎找不到任何东西 - 有没有办法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T20:52:17.270

我听说这很好用。
[http://www.bdsoft.com/tools/stlfilt.html](http://www.bdsoft.com/tools/stlfilt.html)

它是一个 perl 脚本，用于解析错误消息并生成更易读的版本

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T20:53:23.573

女士们，先生们，[这个](http://lists.boost.org/Archives/boost/2002/03/27321.php)GCC 扩展正是我所想的......

# html - 将换行符/回车符发布为隐藏字段值

> ID：667915
> 
> 赞同：10
> 
> 时间：2009-03-20T20:47:03.037
> 
> 标签：html, post, newline, hidden-field, carriage-return

我需要通过隐藏字段发布多行数据。数据将在发布后在文本区域中查看。如何在 html 表单中发布换行符/回车符？

我试过 \r\n 但这只是发布实际的“\r\n”数据

```
<input type="hidden" name="multiline_data" value="line one\r\nline two" /> 
```

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-05-09T15:56:22.267

而不是使用

`<input type="hidden">`

尝试使用

`<textarea style="visibility:hidden;position:absolute;">`

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-11-17T22:10:58.927

*虽然 <input> 的隐藏*状态在技术上允许新行（回车和换行），但为了与旧浏览器兼容，它们应该被转义。您可以通过将所有回车符 ( `\u000D`or `\r`) 和所有换行符 ( `\u000A`or `\n`) 替换为您的应用程序识别为回车符或换行符的专有字符串（如果存在于原始字符串中，也进行转义）。

> 简单的字符实体在这里不起作用，因为不合格的浏览器可能知道`&#10;`并且`&#13;`是新行并将它们从值中剥离。

# 例子

例如，在 PHP 中，如果您要将`echo`值传递给文本区域，您将包含换行符（和未转义的字符串）。

> <textarea>一些带有 \ 的文本
> 和一个带有 \r\n 作为提交值的新行</textarea>

但是，在 PHP 中，如果您要为 <input> 标记`echo`的*value*`\r`属性赋值，您将使用您的专有字符串（例如和`\n`）转义新行，并转义提交值中您专有字符串的任何实例。

> <input type="hidden" value="包含 \\ 的一些文本\r\n 和一个新行 \\r\\n 作为提交值">

然后，在其他地方使用该值之前（插入数据库、发送电子邮件等），如有必要，请务必取消转义提交的值。

# 放心

作为进一步的保证，我询问了 WHATWG，目前 HTML 规范的编辑 Ian Hickson 回答说：

> **bfrohs**关于 <input type=hidden> 的问题——值中是否允许换行和回车？它们在文本状态和搜索状态中被明确禁止，但未提及隐藏状态。如果没有，是否有一个可接受的 HTML 解决方案来存储来自 textarea 的表单数据？
> 
> **Hixie**是的，它们是允许的 // iirc // 出于遗留原因，您可能希望将它们转义，尽管有些浏览器会将它们标准化 // 我忘记了我们是否修复了 // 在规范中
> 
> [来源](http://krijnhoetmer.nl/irc-logs/whatwg/20111117#l-1059)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-20T20:51:15.913

确实取决于字符集，但 应该是换行和 应该是回车。您应该能够在 value 属性中使用它们。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-20T21:14:00.897

你没有说这是为了什么或者你正在使用什么技术，但你需要知道你不能相信隐藏字段保留 value="line one line two"，因为恶意用户可以篡改在它在 POST 中发回之前使用它。由于您稍后将值放入 <textarea> 中，因此您肯定会受到例如跨站点脚本攻击，除非您在写回之前验证和/或清理您的“multiline_data”字段内容。

将值写入隐藏字段并将其读回时，通常最好将其保留在服务器上，作为会话或页面流的属性，或者您的环境提供的任何此类操作。

# oop - 业务对象上的静态工厂违反单一职责原则？

> ID：667917
> 
> 赞同：4
> 
> 时间：2009-03-20T20:47:14.380
> 
> 标签：oop, single-responsibility-principle

如果我将“数据访问”方法放在业务对象上，我是否违反了单一职责原则 (SRP)？我的直觉是，如果类本身存在 Load 方法，那么 API 会感觉更加用户友好，而不必猜测该方法恰好在哪个类中？

例子：

```
public class Image
{    
   public static Image FromFile(string filename)
   {
       return ImageLoader.LoadImage(filename)
   }

   public void SetPixel(int x, int y, Color color)
   {
   }
 } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-20T20:50:26.587

我认为这*本身*没有问题，除了静态方法没有令人信服的理由存在于 Image 类中（因为它不依赖于类中的任何内容，而是依赖于类本身）。

如果你最终得到一堆加载方法，它们在不同的类中可能会更好

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T20:51:54.353

一般来说，我不认为知道如何通过单个路径（在这种情况下，从图像文件）创建自己的实例并确保有效状态必然会使 SRP 紧张。如果您有大量此类方法，那将是代码异味，然后您应该提示将它们分开。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T20:53:35.097

我认为它是静态的这一事实使它不那么“令人震惊”地违反了 SRP，但我不是最大的 SOLID 纯粹主义者。这种启发式方法不应该过于虔诚地对待......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T20:54:01.057

在某种程度上，是的，但它并不像你想象的那么糟糕。任何原则都可以被带到一个极端，使它不舒服。

问题是，如果稍后您希望将它们分开，因为您希望该静态应用于其他图像，或者您想要实现可能适用于其他类型数据的更复杂的方法，该怎么办。

一般来说，重构java很容易，我建议您使用现在有意义的方法，只要记住在它看起来可能导致您撤消复杂性时重新访问它。

# core-data - KVC compliance for numbers in NSManagedObject subclass (CoreData)

> ID：667936
> 
> 赞同：0
> 
> 时间：2009-03-20T20:50:06.137
> 
> 标签：core-data, numbers, key-value-coding

I'm trying a basic test of sorting an NSManagedObject subclass. I set up a basic subclass "TestClass" with two attributes: `stringField` and `numberField`. They use the standard Obj-C 2.0 accessor protocol:

```
@interface TestClass : NSManagedObject
@property (retain) NSString *stringField;
@property (retain) NSNumber *numberField;
@end

@implementation TestClass
@dynamic stringField;
@dynamic numberField;
@end 
```

When I try to fetch instances of this entity, I can fetch based on either attribute. However, if I use a sort descriptor, the `numberField` is said to not be KVC-compliant.

Within the model, I set the `numberField` to Int64, but I'm confused. I thought the wrapper (NSNumber) would handle the KVC problem. What do I need to do to make this work?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T22:13:14.540

一些最初的“电脑开着了吗？”类型的问题：

1.  您的模型是否指定实体的托管对象类是 TestClass？
2.  在排序描述符中指定键时，您确定拼写`numberField`正确吗？
3.  `numberField`您的模型中有瞬态属性吗？

这些是我能想到的常见问题，在使用排序描述符获取时可能会导致此类错误，尤其是第一个。

此外，这不会影响 KVC，但您的属性的属性声明应该是`(copy)`，而不是`(retain)`因为它们是符合`NSCopying`协议的“值”类并且可能具有可变子类。您不想传入一个可变字符串并在 Core Data 下对其进行变异。（是的，Cocoa 中没有 NSMutableNumber 或 NSMutableDate，但这并不妨碍创建 MyMutableNumber 或 MyMutableDate 子类......）

# php - 快速病例计数

> ID：667938
> 
> 赞同：1
> 
> 时间：2009-03-20T20:50:13.983
> 
> 标签：php, optimization

我有大量的字符串要在 php 中处理。我想将它们“修复”为标题大小写（使用`ucwords(strtolower($str))`），但前提是它们已经全部为大写或全部小写。如果它们已经是混合大小写，我宁愿让它们保持原样。

检查这个的最快方法是什么？似乎`for`通过字符串 ing 是一种相当缓慢的方法。

这是我所拥有的，我认为这太慢了：

```
function fixCase($str)
{
    $uc = 0;
    $lc = 0;
    for($i=0;$i<strlen($str);$i++)
    {
        if ($str[$i] >= 'a' && $str[$i] <= 'z')
            $lc++;
        else if ($str[$i] >= 'A' && $str[$i] <= 'Z')
            $uc++;
    }

    if ($uc == 0 || $lc == 0)
    {
        return ucwords(strtolower($str));
    }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T20:56:19.210

只需使用字符串比较（区分大小写）

```
function fixCase($str)
{
  if ( 
       (strcmp($str, strtolower($str)) === 0) || 
       (strcmp($str, strtoupper($str)) === 0) ) 
  {
    $str = ucwords(strtolower($str));
  }

  return $str;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T20:58:33.120

不会有任何惊人的优化，因为根据问题的性质，您需要查看每个字符。

就个人而言，我会用这种算法循环字符串的字符：

*   查看字符串中的第一个字符，设置一个变量来指示它是大写还是小写。
*   现在依次检查每个字符。如果您到达字符串的末尾并且它们都与第一个字符的大小写相同，请根据需要修复字符串的大小写。
*   如果**任何**字符的大小写与第一个字符不同，则中断循环并返回字符串。

* * *

**编辑：**实际代码，我认为这与您将获得的一样好。

```
// returns 0 if non-alphabetic char, 1 if uppercase, 2 if lowercase
function getCharType($char)
{
    if ($char >= 'A' && $char <= 'Z')
    {
        return 1;
    }
    else if ($char >= 'a' && $char <= 'z')
    {
        return 2;
    }
    else
    {
        return 0;
    }
}

function fixCase($str)
{
    for ($i = 0; $i < strlen($str); $i++)
    {
        $charType = getCharType($str[$i]);
        if ($charType != 0)
        {
            $firstCharType = $charType;
            break;
        }
    }

    for ($i = $i + 1; $i < strlen($str); $i++)
    {
        $charType = getCharType($str[$i]);
        if ($charType != $firstCharType && $charType != 0)
        {
            return $str;
        }
    }

    if ($firstCharType == 1) // uppercase, need to convert to lower first
    {
        return ucwords(strtolower($str));
    }
    else if ($firstCharType == 2) // lowercase, can just ucwords() it
    {
        return ucwords($str);
    }
    else // there were no letters at all in the string, just return it
    {
        return $str;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T15:46:53.343

[您可以尝试我在此处](https://stackoverflow.com/questions/371116/how-to-check-case-of-a-string-in-php/371832#371832)发布的字符串大小写测试功能

```
function getStringCase($subject)
{
    if (!empty($subject))
    {
        if (preg_match('/^[^A-Za-z]+$/', $subject))
            return 0;   // no alphabetic characters
        else if (preg_match('/^[^A-Z]+$/', $subject))
            return 1;   // lowercase
        else if (preg_match('/^[^a-z]+$/', $subject))
            return 2;   // uppercase
        else
            return 3;   // mixed-case
    }
    else
    {
        return 0;   // empty
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T16:16:54.910

如果您想避免修复已经混合大小写的字符串的原因是为了提高效率，那么您可能会浪费时间，无论当前条件如何，都转换每个字符串：

```
function fixCase($str)
{
    return ucwords(strtolower($str));
} 
```

如果它的运行速度比您通常想要标题大小写的字符串的长度慢于可接受的答案，我会感到非常惊讶，并且这是您需要担心的少一个条件。

但是，如果有充分的理由避免转换已经混合大小写的字符串，例如您想在大小写中保留一些预期的含义，那么是的，jcinacio 的答案肯定是最简单且非常有效的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T20:57:43.607

检查 string = lowercase(string) 还是 string = uppercase(string) 不是更容易吗，如果是，那就离开它。否则执行您的操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-20T22:28:21.593

好吧，我决定对迄今为止提出的 2 个答案和我的原始解决方案进行测试。我不会想到结果会这样，但我猜原生方法/that/总体上要快得多。

代码：

```
function method1($str)
{
    if (strcmp($str, strtolower($str)) == 0)
    {
        return ucwords($str);
    }
    else if (strcmp($str, strtoupper($str)) == 0)
    {
        return ucwords(strtolower($str));
    }
    else
    {
        return $str;
    }
}

// returns 0 if non-alphabetic char, 1 if uppercase, 2 if lowercase
function getCharType($char)
{
    if ($char >= 'A' && $char <= 'Z')
    {
        return 1;
    }
    else if ($char >= 'a' && $char <= 'z')
    {
        return 2;
    }
    else
    {
        return 0;
    }
}

function method2($str)
{
    for ($i = 0; $i < strlen($str); $i++)
    {
        $charType = getCharType($str[$i]);
        if ($charType != 0)
        {
            $firstCharType = $charType;
            break;
        }
    }

    for ($i = $i + 1; $i < strlen($str); $i++)
    {
        $charType = getCharType($str[$i]);
        if ($charType != $firstCharType && $charType != 0)
        {
            return $str;
        }
    }

    if ($firstCharType == 1) // uppercase, need to convert to lower first
    {
        return ucwords(strtolower($str));
    }
    else if ($firstCharType == 2) // lowercase, can just ucwords() it
    {
        return ucwords($str);
    }
    else // there were no letters at all in the string, just return it
    {
        return $str;
    }
}

function method0($str)
{
        $uc = 0;
        $lc = 0;
        for($i=0;$i<strlen($str);$i++)
        {
                if ($str[$i] >= 'a' && $str[$i] <= 'z')
                        $lc++;
                else if ($str[$i] >= 'A' && $str[$i] <= 'Z')
                        $uc++;
        }

        if ($uc == 0 || $lc == 0)
        {
                return ucwords(strtolower($str));
        }
}

function test($func,$s)
{
    $start = gettimeofday(true);
    for($i = 0; $i < 1000000; $i++)
    {
        $s4 = $func($s);
    }
    $end = gettimeofday(true);
    echo "$func Time: " . ($end-$start) . " - Avg: ".sprintf("%.09f",(($end-$start)/1000000))."\n";
}

$s1 = "first String";
$s2 = "second string";
$s3 = "THIRD STRING";

test("method0",$s1);
test("method0",$s2);
test("method0",$s3);

test("method1",$s1);
test("method1",$s2);
test("method1",$s3);

test("method2",$s1);
test("method2",$s2);
test("method2",$s3); 
```

结果：

```
method0 Time: 19.2899270058 - Avg: 0.000019290
method0 Time: 20.8679389954 - Avg: 0.000020868
method0 Time: 24.8917310238 - Avg: 0.00002489   
method1 Time: 3.07466816902 - Avg: 0.000003075
method1 Time: 2.52559089661 - Avg: 0.000002526
method1 Time: 4.06261897087 - Avg: 0.000004063
method2 Time: 19.2718701363 - Avg: 0.000019272
method2 Time: 35.2485661507 - Avg: 0.000035249
method2 Time: 29.3357679844 - Avg: 0.000029336 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-20T22:47:23.933

请注意，只要有重音或变音符号，任何只看 [AZ] 的东西都会不正确。如果结果不正确，优化速度是没有意义的（嘿，如果结果不一定是正确的，它可以为您编写一个非常快速的实现......）

# javascript - 如何使用javascript获取位于范围内的节点？

> ID：667951
> 
> 赞同：20
> 
> 时间：2009-03-20T20:52:16.007
> 
> 标签：javascript, dom, range, traversal

我正在尝试获取范围对象内的所有 DOM 节点，最好的方法是什么？

```
var selection = window.getSelection(); //what the user has selected
var range = selection.getRangeAt(0); //the first range of the selection
var startNode = range.startContainer;
var endNode = range.endContainer;
var allNodes = /*insert magic*/; 
```

在过去的几个小时里，我一直在想一种方法，并想出了这个：

```
var getNextNode = function(node, skipChildren){
    //if there are child nodes and we didn't come from a child node
    if (node.firstChild && !skipChildren) {
        return node.firstChild;
    }
    if (!node.parentNode){
        return null;
    }
    return node.nextSibling 
        || getNextNode(node.parentNode, true);
};

var getNodesInRange = function(range){
    var startNode = range.startContainer.childNodes[range.startOffset]
            || range.startContainer;//it's a text node
    var endNode = range.endContainer.childNodes[range.endOffset]
            || range.endContainer;

    if (startNode == endNode && startNode.childNodes.length === 0) {
        return [startNode];
    };

    var nodes = [];
    do {
        nodes.push(startNode);
    }
    while ((startNode = getNextNode(startNode)) 
            && (startNode != endNode));
    return nodes;
}; 
```

但是，当结束节点是开始节点的父节点时，它会返回页面上的所有内容。我确定我忽略了一些明显的东西？或者也许以完全错误的方式去做。

[MDC/DOM/范围](https://developer.mozilla.org/en/DOM/range)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-10-28T14:58:41.840

这是我想出的解决此问题的实现：

```
function getNextNode(node)
{
    if (node.firstChild)
        return node.firstChild;
    while (node)
    {
        if (node.nextSibling)
            return node.nextSibling;
        node = node.parentNode;
    }
}

function getNodesInRange(range)
{
    var start = range.startContainer;
    var end = range.endContainer;
    var commonAncestor = range.commonAncestorContainer;
    var nodes = [];
    var node;

    // walk parent nodes from start to common ancestor
    for (node = start.parentNode; node; node = node.parentNode)
    {
        nodes.push(node);
        if (node == commonAncestor)
            break;
    }
    nodes.reverse();

    // walk children and siblings from start until end is found
    for (node = start; node; node = getNextNode(node))
    {
        nodes.push(node);
        if (node == end)
            break;
    }

    return nodes;
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-20T21:24:12.857

如果它是父节点，getNextNode 将递归地跳过您想要的 endNode。

改为在 getNextNode 内执行条件中断检查：

```
var getNextNode = function(node, skipChildren, endNode){
  //if there are child nodes and we didn't come from a child node
  if (endNode == node) {
    return null;
  }
  if (node.firstChild && !skipChildren) {
    return node.firstChild;
  }
  if (!node.parentNode){
    return null;
  }
  return node.nextSibling 
         || getNextNode(node.parentNode, true, endNode); 
}; 
```

在 while 语句中：

```
while (startNode = getNextNode(startNode, false , endNode)); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-10-14T23:05:19.550

Rangy[库](http://code.google.com/p/rangy/)有一个[`Range.getNodes([Array nodeTypes[, Function filter]])`功能](https://github.com/timdown/rangy/wiki/Rangy-Range#getnodesarray-nodetypes-function-filter)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-01-26T12:31:38.033

我根据 MikeB 的回答做了 2 个额外的修复，以提高所选节点的准确性。

除了通过沿着跨越多个元素的文本拖动光标来进行范围选择之外，我特别在选择所有操作上对此进行了测试。

在 Firefox 中，点击全选 (CMD+A) 会返回一个范围，其中 startContainer 和 endContainer 是 contenteditable div，区别在于 startOffset 和 endOffset 分别是第一个和最后一个子节点的索引。

在 Chrome 中，点击全选 (CMD+A) 会返回一个范围，其中 startContainer 是 contenteditable div 的第一个子节点，endContainer 是 contenteditable div 的最后一个子节点。

我添加的修改解决了两者之间的差异。您可以查看代码中的注释以获取更多说明。

```
function getNextNode(node) {
    if (node.firstChild)
        return node.firstChild;

    while (node) {
        if (node.nextSibling) return node.nextSibling;
        node = node.parentNode;
    }
}

function getNodesInRange(range) {

    // MOD #1
    // When the startContainer/endContainer is an element, its
    // startOffset/endOffset basically points to the nth child node
    // where the range starts/ends.
    var start = range.startContainer.childNodes[range.startOffset] || range.startContainer;
    var end = range.endContainer.childNodes[range.endOffset] || range.endContainer;
    var commonAncestor = range.commonAncestorContainer;
    var nodes = [];
    var node;

    // walk parent nodes from start to common ancestor
    for (node = start.parentNode; node; node = node.parentNode)
    {
        nodes.push(node);
        if (node == commonAncestor)
            break;
    }
    nodes.reverse();

    // walk children and siblings from start until end is found
    for (node = start; node; node = getNextNode(node))
    {
        // MOD #2
        // getNextNode might go outside of the range
        // For a quick fix, I'm using jQuery's closest to determine
        // when it goes out of range and exit the loop.
        if (!$(node.parentNode).closest(commonAncestor)[0]) break;

        nodes.push(node);
        if (node == end)
            break;
    }

    return nodes;
}; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-03-04T12:04:47.680

下面的代码解决你的问题

```
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>payam jabbari</title>
<script src="http://code.jquery.com/jquery-2.0.2.min.js" type="text/javascript"></script>
<script type="text/javascript">

$(document).ready(function(){
    var startNode = $('p.first').contents().get(0);
var endNode = $('span.second').contents().get(0);
var range = document.createRange();
range.setStart(startNode, 0);
range.setEnd(endNode, 5);
var selection = document.getSelection();
selection.addRange(range);
// below code return all nodes in selection range. this code work in all browser
var nodes = range.cloneContents().querySelectorAll("*");
for(var i=0;i<nodes.length;i++)
{
   alert(nodes[i].innerHTML);
}
});
</script>
</head>

<body>
<div>

<p class="first">Even a week ago, the idea of a Russian military intervention in Ukraine seemed far-fetched if not totally alarmist. But the arrival of Russian troops in Crimea over the weekend has shown that he is not averse to reckless adventures, even ones that offer little gain. In the coming days and weeks</p>

<ol>
    <li>China says military will respond to provocations.</li>
    <li >This Man Has Served 20 <span class="second"> Years—and May Die—in </span> Prison for Marijuana.</li>
    <li>At White House, Israel's Netanyahu pushes back against Obama diplomacy.</li>
</ol>
</div>
</body>
</html> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-08-18T06:53:25.483

我为此编写了完美的代码，它对每个节点都 100% 有效：

```
function getNodesInSelection() {

var range = window.getSelection().getRangeAt(0);
var node = range.startContainer;

var ranges = []
var nodes = []

while (node != null) {        

    var r = document.createRange();
    r.selectNode(node)

    if(node == range.startContainer){
        r.setStart(node, range.startOffset)
    }

    if(node == range.endContainer){
        r.setEnd(node, range.endOffset)
    }

    ranges.push(r)
    nodes.push(node)

    node = getNextElementInRange(node, range)
}

// do what you want with ranges and nodes
} 
```

这里有一些辅助函数

```
function getClosestUncle(node) {

var parent = node.parentElement;

while (parent != null) {
    var uncle = parent.nextSibling;
    if (uncle != null) {
        return uncle;
    }

    uncle = parent.nextElementSibling;
    if (uncle != null) {
        return uncle;
    }

    parent = parent.parentElement
}

return null
}

function getFirstChild(_node) {

var deep = _node

while (deep.firstChild != null) {

    deep = deep.firstChild
}

return deep
}

function getNextElementInRange(currentNode, range) {

var sib = currentNode.nextSibling;

if (sib != null && range.intersectsNode(sib)) {
    return getFirstChild(sib)
}

var sibEl = currentNode.nextSiblingElemnent;

if (sibEl != null && range.intersectsNode(sibEl)) {
    return getFirstChild(sibEl)
}

var uncle = getClosestUncle(currentNode);
var nephew = getFirstChild(uncle)

if (nephew != null && range.intersectsNode(nephew)) {
    return nephew
}

return null
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-06-25T21:46:45.343

安农，干得好。我已经修改了原始版本，并在下面添加了 Stefan 的修改。

另外，我去掉了对 Range 的依赖，将函数转换为通用算法，在两个节点之间行走。另外，我将所有内容都包装到了一个函数中。

关于其他解决方案的想法：

*   对依赖 jquery 不感兴趣
*   使用 cloneNode 将结果提升到一个片段，这可以防止在过滤期间可能想要进行的许多操作。
*   在克隆的片段上使用 querySelectAll 很不稳定，因为开始或结束节点可能位于包装节点内，因此解析器可能没有结束标记？

例子：

```
<div>
    <p>A</p>
    <div>
        <p>B</p>
        <div>
            <p>C</p>
        </div>
    </div>
</div> 
```

假设起始节点是“A”段落，结束节点是“C”段落。生成的克隆片段将是：

```
<p>A</p>
    <div>
        <p>B</p>
        <div>
            <p>C</p> 
```

我们缺少结束标签？导致时髦的DOM结构？

无论如何，这里的函数，它包括一个过滤器选项，它应该返回 TRUE 或 FALSE 以包含/排除结果。

```
var getNodesBetween = function(startNode, endNode, includeStartAndEnd, filter){
    if (startNode == endNode && startNode.childNodes.length === 0) {
        return [startNode];
    };

    var getNextNode = function(node, finalNode, skipChildren){
        //if there are child nodes and we didn't come from a child node
        if (finalNode == node) {
            return null;
        }
        if (node.firstChild && !skipChildren) {
            return node.firstChild;
        }
        if (!node.parentNode){
            return null;
        }
        return node.nextSibling || getNextNode(node.parentNode, endNode, true);
    };

    var nodes = [];

    if(includeStartAndEnd){
        nodes.push(startNode);
    }

    while ((startNode = getNextNode(startNode, endNode)) && (startNode != endNode)){
        if(filter){
            if(filter(startNode)){
                nodes.push(startNode);
            }
        } else {
            nodes.push(startNode);
        }
    }

    if(includeStartAndEnd){
        nodes.push(endNode);
    }

    return nodes;
}; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-06-10T05:46:53.237

鲍勃 该函数仅返回 startNode 和 endNode。中间的节点不会被推送到数组中。

似乎 while 循环在 getNextNode() 上返回 null，因此该块永远不会被执行。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-06-14T15:41:39.280

这是函数返回子范围数组

```
function getSafeRanges(range) {

var doc = document;

var commonAncestorContainer = range.commonAncestorContainer;
var startContainer = range.startContainer;
var endContainer = range.endContainer;
var startArray = new Array(0),
    startRange = new Array(0);
var endArray = new Array(0),
    endRange = new Array(0);
// @@@@@ If start container and end container is same
if (startContainer == endContainer) {
    return [range];
} else {
    for (var i = startContainer; i != commonAncestorContainer; i = i.parentNode) {
        startArray.push(i);
    }
    for (var i = endContainer; i != commonAncestorContainer; i = i.parentNode) {
        endArray.push(i);
    }
}
if (0 < startArray.length) {
    for (var i = 0; i < startArray.length; i++) {
        if (i) {
            var node = startArray[i - 1];
            while ((node = node.nextSibling) != null) {
                startRange = startRange.concat(getRangeOfChildNodes(node));
            }
        } else {
            var xs = doc.createRange();
            var s = startArray[i];
            var offset = range.startOffset;
            var ea = (startArray[i].nodeType == Node.TEXT_NODE) ? startArray[i] : startArray[i].lastChild;
            xs.setStart(s, offset);
            xs.setEndAfter(ea);
            startRange.push(xs);
        }
    }
}
if (0 < endArray.length) {
    for (var i = 0; i < endArray.length; i++) {
        if (i) {
            var node = endArray[i - 1];
            while ((node = node.previousSibling) != null) {
                endRange = endRange.concat(getRangeOfChildNodes(node));
            }
        } else {
            var xe = doc.createRange();
            var sb = (endArray[i].nodeType == Node.TEXT_NODE) ? endArray[i] : endArray[i].firstChild;
            var end = endArray[i];
            var offset = range.endOffset;
            xe.setStartBefore(sb);
            xe.setEnd(end, offset);
            endRange.unshift(xe);
        }
    }
}
var topStartNode = startArray[startArray.length - 1];
var topEndNode = endArray[endArray.length - 1];
var middleRange = getRangeOfMiddleElements(topStartNode, topEndNode);
startRange = startRange.concat(middleRange);
response = startRange.concat(endRange);
return response; 
```

}

# .net - 在 Linq To SQL 中更新的最佳方法

> ID：667957
> 
> 赞同：6
> 
> 时间：2009-03-20T20:52:56.813
> 
> 标签：.net, visual-studio-2008, linq, linq-to-sql

我有几个实体类，用于解析固定宽度的文本文件以及利用 Linq to SQL。我使用这些类来解析来自所述文本文件的数据，并与数据库中的数据进行比较。

其中一个实体有很多属性，我不想浪费时间在 Linq 结果对象上设置每个单独的属性。

有没有办法告诉 Linq “这是我的对象，用它来更新记录”？这是我正在处理的代码：

```
if (partialContent.MonthlyAddChange == "A")
   {
       bookContentTable.InsertOnSubmit(partialContent);
   }
   否则 if (partialContent.MonthlyAddChange == "C")
   {
       var query = 来自 bookContentTable 中的 bookContent
                   其中 bookContent.EAN == partialContent.EAN
                   选择书籍内容；

       如果（查询！= null）
       {
           // 用 query.First() 做一些事情
       }
   }
}

```

在这种情况下删除记录并执行 InsertOnSubmit() 会更好吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T20:59:42.727

我认为*编辑记录的概念与**删除和插入*新记录不同。基本上，我认为 ORM 应该抽象出主键生成和其他相关内容。通过删除和插入，您可能会删除记录的完整性（可能会发布新的主键，使引用的实体无效等等......）。我建议每当您采取的行动在*概念上是更新*时更新记录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-20T21:03:51.233

我在想你可以使用 DataContext.Table.Attach(record, true) 和 DataContext.SubmitChanges() 之类的东西。但我并没有完全充实...

所以现在我做了一个测试。这仅在您不需要并发检查时才有效（即您是唯一更新表的人）。

这是我的桌子

```
People
PersonID int
FirstName varchar(50)
LastName varchar(50) 
```

我用以下记录填充了表格

```
> PersonID     FirstName    LastName
> 1            Jason        Punyon 
```

我只使用名为 PeopleDataContext 的表创建了一个 LINQ2SQL DataContext，并且在 People 类的每个属性上，我将每个记录属性的 UpdateCheck 属性设置为 Never。

这是代码：

```
static void Main(string[] args)
{
    var p = new People();
    p.PersonID = 1;
    p.FirstName = "Jason";
    p.LastName = "This is a new last name";

    using (var db = new PeopleDataContext())
    {
        db.Peoples.Attach(p, true);
        db.SubmitChanges();
    }
} 
```

它工作成功。没有反射或任何东西，但就像我说的，你失去了并发检查。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T21:10:19.410

您可以考虑使用 automapper 为您复制值。检查此以获取更多信息：[http ://www.lostechies.com/blogs/jimmy_bogard/archive/2009/01/22/automapper-the-object-object-mapper.aspx](http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/01/22/automapper-the-object-object-mapper.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-22T21:21:09.693

> 在这种情况下删除记录并执行 InsertOnSubmit() 会更好吗？

不，绝对不是——只要考虑任何好的、稳定的数据库设计都应该使用的引用完整性。如果您的记录已被其他行使用，则不能简单地将其删除并重新插入 - 您会破坏这些完整性约束。

如果您只是更改一些值，请更新现有行 - 更容易且更一致。

马克

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T20:59:21.743

我不会删除/重新创建。假设这两个对象对于要更新的​​属性具有相同的接口，我将使用反射并将更改的值复制到现有对象。如果任何值与原始值不同，记录将被标记为需要更新，并且 SubmitChanges 将处理它。

例如（几乎没有错误检查）：

```
 foreach (var bookInfo in bookContent.GetType().GetProperties())
 {
     var partialInfo = partialContent.GetType().GetProperty( bookInfo.Name );
     if (partialInfo != null)
     {
         bookInfo.SetValue( partialInfo.GetValue( partialContent, null ) );
     }
 } 
```

如果您知道它们是同一类型，则可以重用第一个 PropertyInfo 而不是为 partialContent 获取新的。

# winforms - Microsoft 报表查看器控件不显示报表

> ID：667972
> 
> 赞同：1
> 
> 时间：2009-03-20T20:56:08.663
> 
> 标签：winforms, reporting-services, reportviewer

我已经构建了一个简单的报告并在测试 winform 应用程序中成功运行它，但是当我尝试在我的生产 winforms 应用程序中运行相同的报告时，报告只是没有显示在查看器中。我在 InitializeComponent 之后查看了 ReportViewer 控件，一切看起来都很好。

是否有调试技术或陷阱可以指出报告未显示的原因。感觉应该有某种错误，但它只是显示一个空白表格。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T14:54:39.520

这是一个简单的错误。

在 MVP 环境中实现报表查看器时，我设法在表单加载中没有注意到/实现 RefreshReport。一旦我打电话给刷新报告，报告就出现了。

# delphi - Delphi 的 RAD Studio\5.0\lib\debug 文件夹

> ID：667988
> 
> 赞同：1
> 
> 时间：2009-03-20T20:59:41.027
> 
> 标签：delphi, ide, packages

也许是一个愚蠢的问题，但这个 Delphi 文件夹的目的到底是什么？：C:\Program Files\CodeGear\RAD Studio\5.0\lib\debug

..以及为什么/何时将 *.dcu 文件放在那里而不是 C:\Program Files\CodeGear\RAD Studio\5.0\lib\ ？

我正在尝试查找重复的 DCU 和 BPL 文件，基于我在此处收到的另一个问题的回答，似乎 lib 和 lib\debug 文件夹有时包含相同或相似的 *.DCU 文件。这可以吗，还是不行……以及何时/为什么？

提前感谢您的任何帮助。:)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T21:02:36.340

调试文件夹中的 DCU 和 BPL 已使用调试信息进行编译，因此您可以使用调试器单步执行它们提供的功能。如果您在项目选项中选中“启用调试 DCU”（或类似的，不记得），链接器将使用调试文件夹中的 DCU 和 BPL，而不是发布文件夹。

# rsync - rsync 错误：未能在“/foo/bar”上设置时间：不允许操作

> ID：667992
> 
> 赞同：232
> 
> 时间：2009-03-20T21:01:46.340
> 
> 标签：rsync, file-transfer

我从 rsync 得到一个令人困惑的错误，而我从网络搜索中找到的最初的东西（以及所有常见的 chmod'ing）都没有解决它：

```
rsync: failed to set times on "/foo/bar": Operation not permitted (1)
rsync error: some files could not be transferred (code 23) 
  at /SourceCache/rsync/rsync-35.2/rsync/main.c(992) [sender=2.6.9] 
```

尽管有这个错误，它似乎还在工作，但摆脱它会很好。

* * *

## 回答 #1

> 赞同：319
> 
> 时间：2009-03-20T21:20:24.643

如果`/foo/bar`在 NFS（或者可能是某些 FUSE 文件系统）上，那可能就是问题所在。

无论哪种方式，将`-O`/添加`--omit-dir-times`到您的命令行将避免它尝试在目录上设置修改时间。

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2012-01-06T12:16:30.397

该问题可能是由于远程 darwin (OS X) 系统上的写入进程不拥有 /foo/bar。 **该问题的解决方案是在远程站点上设置足够的所有者。**

由于这个答案已经过投票，因此希望对某人有用，我正在扩展它以使其更清晰。

发生这种情况的原因是 rsync 在复制文件时可能试图设置任意修改时间（mtime）。

为了做到这一点，darwin的系统`utime()`功能要求编写过程的有效uid要么与文件uid相同，要么与超级用户的uid相同，请参见[opengroup utime的页面](http://www.opengroup.org/onlinepubs/007904975/functions/utime.html)。检查[这个](http://www.mail-archive.com/rsync@lists.samba.org/msg08776.html)关于 rsync 邮件列表的讨论作为参考。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2020-04-29T14:56:10.630

正如@racl101 对答案的评论，这个问题可能与**文件夹所有者**有关。rsync 命令应由与文件夹所有者相同的用户执行。如果不一样，您可以更改它。

```
chown -R userCorrect /remote/path/to/foo/bar 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-10-15T08:14:12.810

我的问题是“接收器安装点”安装不正确。它处于只读模式（出于某种额外的原因）。看起来 rsync 正在复制文件，但事实并非如此。我检查了我的 fstab 文件并将挂载选项更改为默认值，重新挂载文件系统并再次执行 rsync。那一切都好。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-02-25T07:33:14.423

我有同样的问题。对我来说，解决方案是删除远程文件并`rsync`重新创建。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-20T21:19:32.447

当我写入一个不能（正确）处理时间的文件系统时，我已经看到了这个问题——我认为 SMB 共享或 FAT 之类的。

你的目标文件系统是什么？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-09-06T08:32:14.497

这发生在我的 type 分区上`xfs (rw,relatime,seclabel,attr2,inode64,noquota)`，其中目录由我们都是成员的组中的另一个用户拥有。组成员在登录之前已经建立，整个目录结构是组可写的。我已经手动运行`sudo chown -R otheruser.group directory`并`sudo chmod -R g+rw directory`确认了这一点。

我仍然不知道为什么它最初不起作用，而是通过`sudo chown -R myuser.group directory`修复它获得所有权。也许与 SELinux 相关？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-12-08T15:23:14.737

如果您对源或目标中最近未修改的文件运行 rsync 进程，也可能会弹出此错误...因为它无法为最近修改的文件设置时间。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-12-27T00:29:41.057

我也遇到了这个问题，我遇到的问题是包含我试图发送的文件的根文件夹的权限问题。我不关心包含在其中的根文件夹，`rsync`我只关心其中的内容。错误来自我的命令，我需要`/`在最后指定一个附加值。如果您没有该斜杠，`rsync`将尝试设置该文件夹的次数。

例子：

这将尝试设置时间`html`

```
rsync /var/www/html/ ubuntu@xxx.xxx.xxx.xxx:html 
```

这不会

```
rsync /var/www/html/ ubuntu@xxx.xxx.xxx.xxx:html/ 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2010-02-15T21:08:15.233

可能是您对某些文件没有权限。从管理员帐户，尝试“sudo rsync -av” 或者，启用 root 帐户并以 root 身份登录。这应该可以让你完全控制你的系统并暴力破解你的 rsync！;-) 我不确定上面提到的 --extended-attributes 是否有帮助，但我也把它扔进去了，只是为了更好的衡量。

# cocoa - 为什么 NSString 和 NSLog 似乎以不同的方式处理 %C 和 %lc（以及 %S 和 %ls）？

> ID：667994
> 
> 赞同：5
> 
> 时间：2009-03-20T21:02:46.993
> 
> 标签：cocoa, unicode, formatting, printf

Apple 的[字符串格式](http://developer.apple.com/documentation/Cocoa/Conceptual/Strings/Articles/formatSpecifiers.html)说明符文档声明，

> NSString 格式化方法和 CFString 格式化函数支持的格式说明符遵循[IEEE printf 规范](http://www.opengroup.org/onlinepubs/009695399/functions/printf.html)；…您还可以将这些格式说明符与 NSLog 函数一起使用。

但是，虽然`printf`规范定义`%C`为`%lc`和`%S`的等价物`%ls`，但只有`%C`和`%S`似乎可以与`NSLog`和一起正常工作`+[NSString stringWithFormat:]`。

例如，考虑以下代码：

```
#import <Foundation/Foundation.h>

int main (int argc, const char * argv[]) {
    NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];
    unichar str[3];
    str[0] = 63743;
    str[1] = 33;
    str[2] = (unichar)NULL;

    NSLog(@"NSLog");
    NSLog(@"%%S:  %S", str);
    NSLog(@"%%ls: %ls", str);

    NSLog(@"%%C:  %C", str[0]);
    NSLog(@"%%lc: %lc", str[0]);

    NSLog(@"\n");
    NSLog(@"+[NSString stringWithFormat:]");

    NSLog(@"%%S:  %@", [NSString stringWithFormat:@"%S", str]);
    NSLog(@"%%ls: %@", [NSString stringWithFormat:@"%ls", str]);

    NSLog(@"%%C:  %@", [NSString stringWithFormat:@"%C", str[0]]);
    NSLog(@"%%lc: %@", [NSString stringWithFormat:@"%lc", str[0]]);

    [pool drain];
    return 0;
} 
```

鉴于`printf`规范，我希望上述每一对都打印相同的东西。但是，当我运行代码时，我得到以下输出：

```
2009-03-20 17:00:13.363 UnicharFormatSpecifierTest[48127:10b] NSLog
2009-03-20 17:00:13.365 UnicharFormatSpecifierTest[48127:10b] %S:  !
2009-03-20 17:00:13.366 UnicharFormatSpecifierTest[48127:10b] %ls: ˇ¯!
2009-03-20 17:00:13.366 UnicharFormatSpecifierTest[48127:10b] %C:  
2009-03-20 17:00:13.367 UnicharFormatSpecifierTest[48127:10b] %lc: 
2009-03-20 17:00:13.367 UnicharFormatSpecifierTest[48127:10b] 
2009-03-20 17:00:13.368 UnicharFormatSpecifierTest[48127:10b] +[NSString stringWithFormat:]
2009-03-20 17:00:13.368 UnicharFormatSpecifierTest[48127:10b] %S:  !
2009-03-20 17:00:13.369 UnicharFormatSpecifierTest[48127:10b] %ls: ˇ¯!
2009-03-20 17:00:13.369 UnicharFormatSpecifierTest[48127:10b] %C:  
2009-03-20 17:00:13.370 UnicharFormatSpecifierTest[48127:10b] %lc: 
```

我做错了什么，或者这是Apple代码中的错误？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T05:25:04.417

在 Mac OS X 上，`<machine/_types.h>`定义`wchar_t`为`int`，因此在所有当前支持的架构上它是四个字节（32 位）。

正如您所注意到的，`printf`(3) 联机帮助页定义`%S`为等效于`%ls`，它接受一个指向某些`wchar_t`字符 ( `wchar_t *`) 的指针。

但是，您链接到的 Cocoa 文档（及其 CF 等效文档）确实`%S`单独定义：

> *   `%S`: 以 Null 结尾的**16 位**Unicode 字符数组

重点补充。此外，对于`%C`.

所以，这不是一个错误。CF 和 Cocoa 的解释方式`%S`与它的表亲对它们的解释`%C`方式不同。`printf`CF 和 Cocoa 将字符视为 UTF-16，而`printf`（可能）将它们视为 UTF-32。

CF/Cocoa 解释在使用核心服务时更有用，因为某些 API（例如文件管理器）会将文本作为`UniChar`s 数组而不是 CFString 传递给您；只要您对该数组进行空终止，就可以使用它`%S`来打印字符串。

# c# - 如何在 .NET MVC 中将表单值传递给控制器

> ID：667998
> 
> 赞同：1
> 
> 时间：2009-03-20T21:04:03.277
> 
> 标签：c#, asp.net-mvc, request

在 ASP.net MVC 中：

我应该/我如何将表单数据（从视图）传递给控制器​​？

这是我前进的方向：

*   Controller Index 函数将 ViewModel 对象传递给 View。
*   ViewModel 对象包含一个分页列表以及一些 SelectLists。_ ViewModel 对象还包含一个我命名为 theFilter 的自定义类。此类的目的是保存通过表单从视图发布的过滤器信息。
*   我希望 Index [AcceptVerbs(HttpVerbs.Post)] 函数接收填充了表单数据的Filter对象，以及页码（就像现在一样）

以下是我的代码片段：

控制器/索引回发功能：

```
 [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Index(int? page, CaseFilter caseFilter)
    {
        const int pageSize = 10;
        var cases = caseRepo.FindAllCases();
        var paginatedCases = new PaginatedList<Case>(cases, page ?? 0, pageSize);
        return View(new CaseIndexViewModel(paginatedCases, caseFilter));
    } 
```

过滤器类：

```
public class CaseFilter
{
    int iVolume_id = 0,
        iSubject_id = 0;

    public CaseFilter() {

    }

    public int Volume_id { get { return iVolume_id; } set { iVolume_id = value; } }
    public int Subject_id { get { return iSubject_id; } set { iSubject_id = value; } }

} 
```

和 ViewModel 类：

```
 public class CaseIndexViewModel
    {
    public PaginatedList<Case> PaginatedCases { get; private set; }
    public CaseFilter CaseFilter { get; private set; }

    public CaseIndexViewModel(PaginatedList<Case> paginatedCases, CaseFilter caseFilter)
    {

       PaginatedCases = paginatedCases;
       CaseFilter = caseFilter;
    }
} 
```

基本上我试图避免使用 Request.Form 来填充 Filter 类，至少不要在 Controller 中使用它。

欢迎任何帮助，建议或disses！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T21:10:03.340

```
[AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Index(FormCollection collection)
    {
         string valueFromNameTextBox = collection["name"];
    } 
```

您可以使用表单上所有输入的名称对该集合进行索引。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T21:17:06.040

我没有使我的方法签名复杂化，而是在控制器中使用 ValueProvider 属性和 Try/UpdateModel 来检索表单/路由值，除非这些值是简单属性。另一方面，我可能也不会将过滤器作为视图模型的一部分——我倾向于对页面模型有更狭隘的概念，希望它成为**业务**模型而不是所有模型页面上的数据——并且只需通过 ViewData 传递过滤器值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T21:19:14.537

要扩展 BFree 的答案，您可以通过执行以下操作来浏览表单中的所有元素：

```
foreach (string key in collection.keys) {
   if (key.contains("blah"))
      text1 = collection[key];
} 
```

如果它的 key.contains if 元素太多，它可能会变得有点难看，所以要小心;)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-23T12:55:40.277

最后，我什至不需要使用请求集合。CaseFilter 对象在我将其设置为参数时自动填充

```
public ActionResult Index(int? page, CaseFilter caseFilter) 
```

上面的代码按原样工作。********