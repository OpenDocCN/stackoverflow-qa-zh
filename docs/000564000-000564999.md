# StackOverflow 问答 000564000-000564999

# iphone - 通过手机查看网页外观的程序

> ID：564030
> 
> 赞同：0
> 
> 时间：2009-02-19T05:19:08.500
> 
> 标签：iphone

我知道这可能跑题了，但是什么是好的程序让我看看一个网站在 iPhone 或其他连接到 Internet 的移动设备上的样子。Dreamweaver cs3 可能有这个，但我找不到有人知道吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T05:26:12.867

使用 iphone 模拟器（iphone SDK 的一部分）并转到您要使用 safari 进行测试的网页。

非常简单，除了你需要一个 intel mac （可以在 ppc mac 上完成，但安装 SDK 需要 ppc 上的一些技巧并且不受支持）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T05:28:10.243

[Aptana](http://www.aptana.com/)有一个[iPhone 插件，](http://www.aptana.com/iphone)其中还包括一个内置显示器。所有这些都是免费的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T05:38:40.623

Iphone Similutor 是我使用的一种，它的工作非常好，并且可以与 iphone SDK 一起使用

# sql - 将动态行数插入 SQL Server

> ID：564033
> 
> 赞同：0
> 
> 时间：2009-02-19T05:21:04.457
> 
> 标签：sql, sql-server, tsql, dynamic-queries

有没有办法在给定查找值的情况下从 sql server（.sql 脚本）中插入动态行数，并为每个插入设置一列？我想用不同表中每一行的外键附加一行。

例如：

```
table 1:
1 j k l m n 2-(fk)
2 j k l m n 3-(fk)
3 k u y k l 2-(fk)

table 2:
2 hi you
3 hey ho 
```

现在假设我想在表 1 中添加 2 行，表 2 中的 fk 值为 2 和 3。

所以决赛桌看起来像：

```
table 1:
1 j k l m n 2-(fk)
2 j k l m n 3-(fk)
3 k u y k l 2-(fk)
4 a a a a a 3-(fk)
5 a a a a a 2-(fk) 
```

使用编程语言，这很容易。伪：对于（表 2 中的行）DO 插入表 1 'aaaaa rows.id'

这如何在 sql server 中完成？

编辑：

对于表 2 中的每一行，获取它的 id，将其设置为表 1 的一行中的 fk，然后插入它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T05:26:45.177

```
INSERT [table 1]
SELECT 'a','a','a','a','a', fk 
FROM [table 2] 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-19T05:46:22.273

好的，有人过来告诉我一个方法来做到这一点......

```
insert into table_one  
select col1 = 'a',  
   col2 = 'b',  
   col3 = 'c',  
   col4fk,  
   col5 = 'k'  
from table2 
```

It's only selecting col4fk from table 2, as long as it has the same name as the column in table 1.

# java - 大型应用程序的 JVM 性能调优

> ID：564039
> 
> 赞同：33
> 
> 时间：2009-02-19T05:24:11.187
> 
> 标签：java, jvm, performance, jvm-arguments

默认的 JVM 参数对于运行大型应用程序不是最佳的。任何在实际应用程序上对其进行调整的人的见解都会有所帮助。我们在 32 位 windows 机器上运行应用程序，[默认](http://java.sun.com/docs/hotspot/gc5.0/ergo5.html#0.0.%20Garbage%20collector,%20heap,%20and%20runtime%20compiler|outline)使用客户端 JVM 。我们添加了 -server 并将 NewRatio 更改为 1:3（更大的年轻一代）。

您尝试过并发现有用的任何其他参数/​​调整？

[更新] 我说的特定类型的应用程序是很少关闭的服务器应用程序，至少占用 -Xmx1024m。还假设应用程序已经过概要分析。我只在**JVM 性能**方面寻找一般指导方针。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2016-05-25T22:20:10.677

# 前言

## 背景

去过Java商店。花了整整几个月的时间在分布式系统上运行性能测试，主要的应用程序是 Java。其中一些暗示由 Sun 自己（当时是 Oracle）开发和销售的产品。

我将复习我学到的课程，一些关于 JVM 的历史，一些关于内部结构的讨论，一些参数的解释，最后是一些调整。尽量保持重点，以便您可以在实践中应用它。

Java 世界中的事物正在迅速变化，因此自去年我已经完成所有这些工作以来，其中的一部分可能已经过时了。（Java 10 已经发布了吗？）

# 良好实践

## 你应该做什么：基准，基准，基准！

当您真的需要了解性能时，您需要针对您的工作负载执行真正的基准测试。没有其他选择。

此外，**您应该监视 JVM。启用监控。**好的应用程序通常提供监控网页和/或 API。除此之外，还有通用的 Java 工具（JVisualVM、JMX、hprof 和一些 JVM 标志）。

**请注意，调整 JVM 通常不会获得任何性能**。更像是一个*“撞还是不撞，找转折点”*。重要的是要知道，当您为应用程序提供*这么*多资源时，您可以始终如一地期望获得*这么*多的性能作为回报。*知识就是力量。*

**性能主要取决于您的应用程序。如果你想要更快，你必须编写更好的代码。**

## 大多数时候你会做的事情：与可靠的敏感默认值一起生活

我们没有时间优化和调优每一个应用程序。大多数时候，我们将简单地接受合理的默认设置。

配置新应用程序时要做的第一件事是阅读文档。大多数严肃的应用程序都附带性能调整指南，包括有关 JVM 设置的建议。

然后您可以配置应用程序：`JAVA_OPTS: -server -Xms???g -Xmx???g`

*   `-server`: 启用完全优化（这个标志现在在大多数 JVM 上是自动的）
*   `-Xms` `-Xmx`：设置最小和最大堆（两者总是相同的值，这是唯一要做的优化）。

**干得好，你知道所有关于 JVM 的优化参数，恭喜！**那很简单：D

## 你永远不会做的事：

请不要复制您在互联网上找到的随机字符串，尤其是当它们采用多行时：

```
-server  -Xms1g -Xmx1g  -XX:PermSize=1g -XX:MaxPermSize=256m  -Xmn256m -Xss64k  -XX:SurvivorRatio=30  -XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled  -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=10  -XX:+ScavengeBeforeFullGC -XX:+CMSScavengeBeforeRemark  -XX:+PrintGCDateStamps -verbose:gc -XX:+PrintGCDetails -Dsun.net.inetaddr.ttl=5  -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=`date`.hprof   -Dcom.sun.management.jmxremote.port=5616 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -server -Xms2g -Xmx2g -XX:MaxPermSize=256m -XX:NewRatio=1 -XX:+UseConcMarkSweepGC 
```

例如，在 google 的第一页上发现的这个东西是非常糟糕的。有多次指定的参数具有冲突的值。有些只是强制使用 JVM 默认值（最终是 2 个 JVM 版本之前的默认值）。一些已经过时并且被简单地忽略了。最后，至少有一个参数是如此无效，以至于它会在启动时不断地因为它的存在而使 JVM 崩溃。

# 实际调优

## 如何选择内存大小：

从您的应用程序中阅读指南，它应该给出一些指示。监控生产并事后调整。如果您需要准确性，请执行一些基准测试。

**重要提示**：java 进程将占用**max heap PLUS 10%**。X% 的开销是堆管理，不包括在堆本身中。

所有内存通常在启动时由进程预先分配。您可能会一直看到使用最大堆的进程。这根本不是真的。**您需要使用 Java 监控工具来查看真正使用的是什么。**

找到合适的尺寸：

*   如果它因 OutOfMemoryException 而崩溃，则内存不足
*   如果它没有因 OutOfMemoryException 而崩溃，则说明内存过多
*   如果内存太多但硬件得到了它和/或已经支付了费用，那么这是一个*完美*的数字，大功告成！

## JVM6 是青铜，JVM7 是黄金，JVM8 是白金……

JVM 一直在改进。垃圾收集是一个非常复杂的事情，有很多非常聪明的人在做这件事。它在过去十年中取得了巨大的进步，并将继续这样做。

仅供参考。它们是 Oracle Java 7-8 (HotSpot) 和 OpenJDK 7-8 中至少 4 个可用的垃圾收集器。（其他 JVM 可能完全不同，例如 Android、IBM、嵌入式）：

*   串行GC
*   并行GC
*   并发MarkSweepGC
*   G1GC
*   （加上变体和设置）

[从 Java 7 开始。Oracle 和 OpenJDK 代码是部分共享的。GC 在两个平台上应该（大部分）相同。]

JVM >= 7 有许多优化并选择不错的默认值。它会因平台而有所变化。它平衡了多种事物。例如决定是否启用多核优化 CPU 是否有多个内核。你应该让它去做。**不要更改或强制 GC 设置。**

让计算机为您做出决定是可以的（这就是计算机的用途）。最好让 JVM 设置始终保持 95% 的最佳状态，而不是在所有盒子上强制“总是 8 核积极收集以减少暂停时间”，其中一半最终是 t2.small。

**例外**：当应用程序附带性能指南和特定调整时。保留提供的设置是完全可以的。

**提示**：迁移到更新的 JVM 以从最新的改进中受益有时可以毫不费力地提供很好的提升。

## 特例：-XX:+UseCompressedOops

JVM 有一个特殊设置，强制在内部使用 32 位索引（读取：指针式）。这允许寻址 4 294 967 295 个对象 * 8 字节地址 => 32 GB 内存。（不要与 REAL 指针的 4GB 地址空间混淆）。

它减少了整体内存消耗，对所有缓存级别都有潜在的积极影响。

**现实生活中的例子**：ElasticSearch 文档指出，就内存中保存的实际数据而言，运行 32GB 32 位节点可能等同于 40GB 64 位节点。

**历史注释**：已知该标志在 java-7 之前的时代（甚至可能是 java-6 之前）不稳定。它已经在较新的 JVM 中完美运行了一段时间。

[Java HotSpot™虚拟机性能增强](https://docs.oracle.com/javase/7/docs/technotes/guides/vm/performance-enhancements-7.html)

> [...] 在 Java SE 7 中，当未指定 -Xmx 并且 -Xmx 的值小于 32 GB 时，使用压缩 oops 是 64 位 JVM 进程的默认设置。对于 6u23 发行版之前的 JDK 6，请在 java 命令中使用 -XX:+UseCompressedOops 标志来启用该功能。

**请参阅**：JVM 再次比手动调优领先数年。尽管如此，了解它还是很有趣的=）

## 特例：-XX:+UseNUMA

> 非均匀内存访问 (NUMA) 是一种用于多处理的计算机内存设计，内存访问时间取决于相对于处理器的内存位置。资料来源：[维基百科](https://en.wikipedia.org/wiki/Non-uniform_memory_access)

现代系统具有极其复杂的内存架构，具有多层内存和缓存，无论是私有的还是共享的，跨内核和 CPU。

很明显，在当前处理器中访问二级缓存中的数据比从另一个插槽一路访问记忆棒要快得多。

我相信今天销售的所有多**插槽**系统都是 NUMA 设计的，而所有消费者系统都不是。`numactl --show`用linux上的命令检查你的服务器是否支持 NUMA 。

NUMA-aware 标志告诉 JVM 为底层硬件拓扑优化内存分配。

性能提升可能很大（即两位数：+XX%）。事实上，如果有人从“NOT-NUMA 10CPU 100GB”切换到“NUMA 40CPU 400GB”，如果他不知道这个标志，他可能会经历[戏剧性的]性能损失。

**注意**：有讨论检测 NUMA 并在 JVM 中自动设置标志[http://openjdk.java.net/jeps/163](http://openjdk.java.net/jeps/163)

**奖励**：所有打算在大型硬件（即 NUMA）上运行的应用程序都需要针对它进行优化。它并不特定于 Java 应用程序。

## 面向未来：-XX:+UseG1GC

Garbage Collection 的最新改进是[G1 收集器（阅读：Garbage First）](http://www.oracle.com/technetwork/java/javase/tech/g1-intro-jsp-135488.html)。

它适用于高内核、高内存系统。绝对最低 4 核 + 6 GB 内存。它的目标是使用 10 倍甚至更多的数据库和内存密集型应用程序。

简短的版本，在这些大小下，传统的 GC 面临着太多的数据无法一次处理，并且暂停正在失控。G1 将堆分成许多小部分，这些小部分可以在应用程序运行时独立和并行管理。

第一个版本于 2013 年推出。它现在已经足够成熟，可用于生产，但不会很快成为默认版本。对于大型应用程序来说，这值得一试。

## 请勿触摸：世代规模（NewGen、PermGen...）

GC 将内存分成多个部分。（不详述，你可以谷歌“Java GC Generations”。）

上一次我花了一周时间在一个应用程序上尝试 20 种不同的世代标志组合，达到 10000 hit/s。我得到了从 -1% 到 +1% 的巨大提升。

Java GC 生成是阅读或撰写论文的有趣主题。除非您是那 1% 的一部分，他们可以在真正需要优化的 1% 的人中投入大量时间以获得微不足道的收益，否则它们不是一个需要调整的东西。

# 结论

希望这可以帮到你。享受 JVM 的乐趣。

Java是世界上最好的语言和最好的平台！去传播爱：D

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-19T05:28:40.677

周围有大量这样的信息。

首先，在调优 JVM 之前分析代码。

其次，仔细阅读[JVM文档；](http://www.oracle.com/technetwork/java/javase/tech/index-jsp-137187.html)周围有很多“都市传说”。例如，-server 标志仅在 JVM 驻留并运行一段时间时才有用；-server “打开” JIT/HotSpot，需要多次通过同一路径才能打开。另一方面，-server*会减慢*JVM 的初始执行，因为有更多的设置时间。

周围有几本好书和网站。例如，参见[http://www.javaperformancetuning.com/](http://www.javaperformancetuning.com/)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-19T05:54:27.120

看这里（或谷歌搜索热点调整）[http://java.sun.com/javase/technologies/hotspot/gc/gc_tuning_6.html](http://java.sun.com/javase/technologies/hotspot/gc/gc_tuning_6.html)

在尝试调整 vm 之前，您肯定想分析您的应用程序。NetBeans 内置了一个很好的分析器，它可以让您看到各种各样的东西。

曾经有人告诉我，他们的应用程序的 GC 已损坏 - 我查看了代码，发现他们从未关闭任何数据库查询结果，因此他们保留了大量的字节数组。一旦我们关闭结果，时间从 20 多分钟和 1 GB 内存变为大约 2 分钟和非常少量的内存。他们能够删除 JVM 调优参数，一切都很愉快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T06:13:30.070

回答这个问题的绝对最佳方法是在尽可能接近“生产”环境中对应用程序执行受控测试。很有可能使用 -server、合理的起始堆大小和最近 JVM 的相对智能行为将表现得与通常尝试的绝大多数设置一样好或更好。

这种广泛的概括有一个特定的例外：如果您在 Web 容器中运行，那么您很有可能想要增加永久代设置。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T22:48:04.563

我建议您同时打开 CPU 采样和对象分配监控来分析您的应用程序。你会发现你得到了非常不同的结果，这有助于调整你的代码。还可以尝试使用内置的 hprof 分析器，它也会给出非常不同的结果。

一般来说，分析您的应用程序比 JVM 参数有更大的不同。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-10-15T23:07:14.660

32 位 Windows 机器上的 Java，您的选择是有限的。根据我的经验，以下参数设置会影响应用程序性能：

1.  内存大小
2.  GC收集器的选择
3.  GC收集器相关参数

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T05:38:31.637

这将高度依赖于您的应用程序以及 JVM 的供应商和版本。您需要清楚您认为是性能问题的原因。您是否关心代码的某些关键部分？你有没有分析过这个应用程序？JVM 是否花费太多时间进行垃圾收集？

我可能会从 -verbose:gc JVM 选项开始，以观察垃圾收集是如何工作的。很多时候，最简单的解决方法是使用 -Xmx 增加最大堆大小。如果您学会解释 -verbose:gc 输出，它将告诉您几乎所有关于调整整个 JVM 所需的知识。但是单独这样做并不会神奇地使调优的代码运行得更快。大多数 JVM 调优选项旨在提高垃圾收集器的性能和/或内存大小。

对于分析，我喜欢[yourkit.com](http://www.yourkit.com)

# java - Java 对新闻网站来说是否矫枉过正？

> ID：564061
> 
> 赞同：2
> 
> 时间：2009-02-19T05:35:19.087
> 
> 标签：java, web

我的一个客户想要一个用 Java 设计的新闻网站，我告诉他 Java 对于那种网站来说太过分了。我向他建议，我们可以为他定制几十个 CMS，以及其他更适合网站的编程语言，但他坚持。

Java 对新闻网站来说是否矫枉过正？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T05:43:51.017

我认为这里真正的问题是，无论您的客户是谁，都有这样一种观念，即问题可以通过名称删除的编程语言来解决。我知道您也意识到了这个问题，但在任何业务中“客户永远是对的”，您必须让步。

那么对于新闻网站来说，Java 是不是矫枉过正呢？那要看。如果他要求的内容可以在 Drupal 甚至 Wordpress 中开箱即用，那么答案是肯定的。进一步的真正问题将是：

*   他的组织在 Java 方面有多少专业知识（你必须考虑他想自己维护系统的可能性——如果他的员工知道 Java，你现在知道他为什么坚持它了）
*   他真正想要的功能是什么？未来网站将如何发展？（会有一些功能在 PHP 中比在 Java 中更难实现）
*   成本影响是什么？（如果他想要更便宜，您可以提供简单地定制 Drupal 或 Wordpress，但如果预算不是主要考虑因素，使用 Java 就可以了）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T05:40:15.080

我认为语言论点有点无关紧要，只要有足够的时间和技能，您就可以实际地用任何东西编写任何东西。Java 并不比许多其他工具好/差。然而，真正的答案已经在这里——使用 CMS 必须是有意义的。为什么要从头开始写，听起来确实像是在重新发明一个轮子。

为什么不做一个基本的需求列表，交叉匹配到 CMS（Java、Python、Ruby 等），然后如果你必须从头开始编码，那么对相同的功能进行定价。这是一个很好的论据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T05:47:13.223

让他看看[http://en.wikipedia.org/wiki/Magnolia_(CMS)](http://en.wikipedia.org/wiki/Magnolia_(CMS)) ( [http://www.magnolia-cms.com/home.html](http://www.magnolia-cms.com/home.html) ) - 它是用 java 编写的。社区版是开源的

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T17:24:06.360

该语言没有定义可能的功能集，对于任何重要的事情，Java 与 PHP 相比也没有特别高的开销。真正的问题是：

1.  它必须是Java吗？客户可能因为现有的部署需求或 Java 团队希望稍后修改代码而需要 Java，在这种情况下，Java 需求可能是不可协商的。
2.  它可以是预先构建的解决方案还是必须是定制的？许多语言都有现成的 CMS，包括 Java。RedHat（JBoss）制作了一个（个人从未使用过）。

我会尝试与您的客户澄清真正的要求是什么；您也许可以使用现有的 CMS 并对其进行自定义；一些 CMS 可以使用 SOAP 或其他一些外部 API 进行自定义，允许您使用任何您想要的语言进行自定义。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T17:30:42.673

除非他真的知道他在说什么需要 Java（可能与硬件/操作系统相关等），否则您可能只是向他展示他正在寻找的示例。

基本上，让他专注于他想要的东西。一旦他承诺，“这就是我需要的”时刻，你可以向他解释他不需要 Java，但他可以用其他更便宜的东西和更快的速度为他开发。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T23:06:46.500

有许多开源产品可以满足需要。我建议你看看其中的一些，然后确定你是否可以扩展它们来做任何缺失的事情。

我会说用任何语言从头开始编写这样的服务是矫枉过正的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T11:48:29.673

[我们](http://www.bbc.co.uk)使用 java（除其他外）为我们的[新闻站点](http://news.bbc.co.uk)编写自定义 CMS ，但我们可能是一个不寻常的案例 - 网络上最大的新闻站点之一。

也许 java 也是您的客户的正确答案 - 但他们更有可能从购买现有解决方案中获得更好的价值，除非您找不到实现所有必需功能的解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-18T08:44:46.910

在我看来，从长远来看，Java 非常适合构建和**维护CMS……当使用正确的设计和工具时，它为您提供了类型安全和 IDE 支持的所有好处。**

看看 Jease ( [http://www.jease.org/](http://www.jease.org/) )，这是在几分钟内创建自定义 Java-CMS 的一个很好的开始。

# batch-file - 如何实现每批文件的回显开/关设置？

> ID：564068
> 
> 赞同：1
> 
> 时间：2009-02-19T05:39:16.317
> 
> 标签：batch-file

我们有一些复杂的 bat 文件，其中一个调用另一个，另一个调用另一个。它们`@echo off`的顶部都有一个。

对于调试，我想有选择地在其中一些中打开回声。最简单的方法是什么？到目前为止我的一些想法：

*   仅在顶级文件中更改设置。但这仅适用于少数已知的非顶级文件。否则任何文件都可以调用任何其他文件。

*   在退出每个 bat 文件之前将其更改回以前的设置。我需要确保有一个单一的出口点。我还需要知道进入时的设置，我不知道如何找到。

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T07:16:09.703

怎么样：

```
@if defined talk (echo on) else (echo off) 
```

在每个文件的顶部。然后您可以设置 TALK=True 并立即将它们全部启动。

要对特定文件有选择地执行此操作，您将需要使用 TALK_XYZ，并且您需要确保每个批处理文件在退出之前都设置回显。这应该可以通过所有出口点的“GOTO END”来完成：

```
...
:END
@echo off 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T05:44:54.040

`echo on`在您要为其打开它的文件及其依赖项的开头调用（`echo off`如果您愿意，可以在末尾调用）。

注意：你说它是为了调试，所以它不必遵循一个宏大的计划——它现在只需要产生输出。

...当然，除非我错过了什么。

* * *

您也可以编写一个快速脚本来 REM 退出回声呼叫。对于您想要回显的每个文件，文本搜索“.bat”以获取依赖项列表。然后在它们上运行 REMming 脚本并搜索“.bat”，冲洗重复。

* * *

另一种选择是，如果您不介意查看所有输出，只需通过 REMming 脚本提供所有文件。这比递归地寻找依赖要容易一些。`ECHO`然后在要跟踪的部分的开头和结尾放置一个大而明确的命令。将整个输出加载到记事本中并搜索您的书签。

* * *

作为参考，如果你只运行命令 ECHO 不带任何参数，你可以看到当前的 echo 设置：“ECHO is on|off.”。

# .net - 非 COM、非 .NET DLL 的正确名称？

> ID：564079
> 
> 赞同：3
> 
> 时间：2009-02-19T05:46:23.770
> 
> 标签：.net, windows, com, dll

在 Windows 世界中，好的正确名称是什么。带有导出函数的老式 C++ DLL？不是 COM DLL，也不是 .NET DLL。我们过去通过调用 LoadLibrary() 和 GetProcAddress() 调用的那种 DLL？

我一直称它们为“平面 DLL”，因为调用者无法从 DLL 实例化对象，但正确的名称是什么？

编辑

感谢您的回答。

只是“DLL”在技术上可能是正确的，但在我工作的地方，每个人都认为“DLL”是指 COM，或者可能是 .NET，所以我需要一个能够准确区分我的意思的术语。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T05:50:21.873

一个.dll？所有这些其他事情都使用 .dll 提供的基本功能来完成它们各自的事情。如果你想学究气，也许是原始的 .dll，但 .dll 应该没问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T06:13:15.000

不再有“正确”的名称，而是“普通汽车”的“正确”名称。（我确实使用“普通 DLL”。

COM DLL、OCX、.NET DLL……它们都是 DLL，带有附加功能。例如，没有什么可以阻止您拥有可以通过 COM 或手动 LoadLibrary/GetProcAdress 访问的 DLL。我已经看到了它。您甚至可以通过“普通”非对象化 API 公开相同的对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T06:16:47.723

“本机”可能是最常用的术语，尽管“窗口”或“控制台”在技术上更正确，因为这些是可能使用的子系统（“本机”子系统有所不同）。我也听说过使用“C DLL”，暗示与您使用“flat DLL”相同。

动态链接库是一个通用概念——“Windows 动态链接库”不同于 *nix 的等价物，也不同于托管库。

在这种情况下，COM 只不过是一种封装约定——Windows DLL 可以包含 COM 服务器，可移植可执行 (PE) 文件也可以。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T06:50:40.467

我和查尔斯·格雷厄姆在一起。它们只是 DLL。不多也不少。

一些 DLL 公开的 API 允许它们与某些编程模式一起使用（例如，公开 DllGetClassObject 和 DllCanUnloadNow 的 DLL 可用于托管 COM 对象（但还有其他方式可以托管 COM 对象））。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T06:12:32.053

可能是“常规 DLL”。这是我们使用的术语，但“DLL”也可以。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T07:00:00.817

这是一个“动态链接库”。有时称为“动态链接库”。与“静态链接库”相反，您可以在其中选择自己的毒药。取而代之的是，您使用了毒药，由用户在执行路径的某个地方随机安装。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T05:51:05.460

我一直只是称它们为 DLL，但我并没有在 C++/VB6 世界中停留太久。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-06-29T21:13:05.477

我同意需要用术语来描述不能作为托管代码执行（换句话说，托管代码需要互操作）并且不能用作 COM 对象的 DLL。很多时候，开发人员只是说 DLL，这是模棱两可的。是的，将 .Net 类库称为 DLL 并将 COM 进程内服务器称为 DLL 是完全有效的，但出于通信的目的，仅说 DLL 是模棱两可的。

有关更多信息，请参阅我的文章[本机 Windows 动态链接库 (DLL)](http://www.c-sharpcorner.com/UploadFile/SamTomato/native-windows-dynamic-link-libraries-dlls/)。

# parsing - 递归下降解析器：如何找到 FIRST、FOLLOW 和 PREDICT 集？

> ID：564084
> 
> 赞同：4
> 
> 时间：2009-02-19T05:49:43.530
> 
> 标签：parsing, recursive-descent

当给定语法时，我正在寻找对 RDP 的 FIRST、FOLLOW 和 PREDICT 集的定义的良好解释。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T06:52:54.657

尝试由 Michael L. Scott (Morgan Kaufmann)编写的*Programming Language Pragmatics 。*解析在第 2 章中介绍。递归下降解析在第 2.2.3 节中描述；*首先*并*遵循*2.2.5 中的设置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-03-27T19:43:06.657

[您可以使用BNF（Backus Naur 形式）语法规范中的计算预测、第一和跟随集合](http://hackingoff.com/compilers/predict-first-follow-set)自动计算第一、跟随和预测集合，而无需下载任何内容。这是验证答案或使乏味自动化的好方法。

如果您想手动完成，[Dragon Book](https://rads.stackoverflow.com/amzn/click/com/0321486811)（第 2 版）第 221-222 页对此进行了介绍。

# sql-server-2005 - 在 Sql Server 2005 中，有没有办法查询服务器上可用的总磁盘空间（物理硬盘驱动器）？

> ID：564090
> 
> 赞同：1
> 
> 时间：2009-02-19T05:51:01.637
> 
> 标签：sql-server-2005

我在谷歌上找到了这个，但我不认为这是完整的代码？

[http://www.dba-oracle.com/t_sql_server_2005_windows_script_display_disk_space_usage.htm](http://www.dba-oracle.com/t_sql_server_2005_windows_script_display_disk_space_usage.htm)

我希望有一个简单的系统存储过程，比如查找 MDF 文件的总大小（exec sp_helpdb DATABASE_NAME）。

任何建议，将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T06:09:07.290

xp_fixeddrives 能解决问题吗？

```
EXEC master.dbo.xp_fixeddrives 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T07:01:02.983

您可以像这样使用 CLR 存储过程：

[http://weblogs.sqlteam.com/tarad/archive/2007/12/18/60435.aspx](http://weblogs.sqlteam.com/tarad/archive/2007/12/18/60435.aspx)

# javascript - 以下列方式显示“无 JavaScript”警告是否有任何陷阱？

> ID：564093
> 
> 赞同：1
> 
> 时间：2009-02-19T05:52:02.040
> 
> 标签：javascript

我有一个网页，它有一个评论框，可以通过单击链接来切换（框的打开和关闭是使用 JavaScript 控制的，特别是 JQuery）。这个框默认是隐藏的，所以很自然地，不使用 JavaScript 是无法显示的。我并不担心这个事实：评论框不是“必要”功能，而且这是一个小型个人网站，所以我不介意一小部分访问者可能无法体验完整的功能。但是，如果用户没有启用 JavaScript，我想显示一个警告。

我已经考虑了通过在切换评论框的链接附近显示一条小消息（使用简单的 HTML`<p>`标记）来执行此操作的想法，使用以下代码：

```
<p class="alert" id="nojs-warning">You must have JavaScript enabled to leave a comment.</p> 
```

*当然，如果*启用了JavaScript，我不想显示这个，所以我设置了以下 JQuery 触发器，以便在加载页面时立即隐藏该框：

```
$(function() {
    $('#nojs-warning').hide();
}); 
```

因此，如果用户启用了 JavaScript，该事件将触发并且警告将被隐藏；如果用户没有启用 JavaScript，则事件*不会*触发，因此仍会显示警告。

对于这样一个小型的个人网站，这似乎是一个优雅的解决方案。这种方法有什么陷阱吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-19T05:57:12.607

为什么不使用[`<noscript>`](http://www.w3schools.com/TAGS/tag_noscript.asp)标签？这就是它的目的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T05:57:57.270

唯一明显的问题是即使启用了 javascript，该函数也不会运行。您没有使用 HTML 中内置的标签是否有特殊原因。它可能会做同样的事情，但不需要 javascript。 [链接文本](http://www.w3schools.com/TAGS/tag_noscript.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-25T13:44:10.650

更好的是：为什么不在网站上设置评论框，并为那些使用 Javascript 的人用 Javascript 隐藏它？那么每个人都可以使用它，对吗？

# utf-8 - 小程序中出现乱码的日文字体

> ID：564096
> 
> 赞同：0
> 
> 时间：2009-02-19T05:53:17.700
> 
> 标签：utf-8, applet

我有一个 Java Swing 应用程序 JAR 作为 JSP 中的小程序运行。在其中一个 JTextfields 中，用户粘贴了日语字符，结果显示为乱码。但是，当我运行与小程序相同的应用程序时，它显示得很好。JSP 的内容根据 META 标记表示为 UTF-8。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T14:11:31.340

我猜有几种可能。当显示器认为它是有效字符时，可能会显示框，但无法找到与该字符对应的字形（字体中的条目）。

您是否可能没有安装包含这些字符的字体？甚至小程序无法将这些代码点映射到系统中的某种字体？

如果问题是由于预期和实际字符编码之间的不匹配造成的，我认为它不仅仅是盒子，而且还可能包含不正确的字符，即 gobbledy-gook。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-21T09:52:55.050

我对日语本地化问题有一点经验，所以我会尝试提供一个可能的解决方案（虽然很晚）。

JSP 内容编码与applet 使用的编码无关。小程序使用用户默认用户 JRE/JVM 设置。

假设日语至少在一个屏幕上出现在用户面前，这是复制和粘贴管理器不知道如何复制文本的问题（它复制文本的字节，但在粘贴时重新组装字节不正确):

将诊断屏幕添加到应用程序并在您的计算机和用户计算机上记录以下系统属性：

```
System.getProperty("xx"); 
```

*   文件编码
*   用户国家
*   用户语言

在小程序启动时，您应该能够使用您自己的正确设置覆盖属性，以在所有用户 PC 上获得正确的行为。

# c++ - 从 C++ 检查 Lua 堆栈项的值

> ID：564100
> 
> 赞同：1
> 
> 时间：2009-02-19T05:56:53.183
> 
> 标签：c++, lua, stack

如何检查 Lua 中堆栈顶部的值？

我有以下 C++ 代码：

```
if (luaL_loadfile(L, filename) == NULL) {
        return 0;// error..
    }

    lua_pcall(L,0,0,0); // execute the current script..

    lua_getglobal(L,"variable");

    if (!lua_isstring(L,-1)){ // fails this check..
        lua_pop(L,1);
        return 0; // error
} 
```

有问题的文件的内容是

```
-- A comment
variable = "MyString" 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T06:53:25.310

可能的问题是[`luaL_loadfile()`](http://www.lua.org/manual/5.1/manual.html#luaL_loadfile)记录返回相同的值[`lua_load()`](http://www.lua.org/manual/5.1/manual.html#lua_load)或一个额外的错误代码。在任何一种情况下，返回值都是一个`int`，其中 0 表示成功，非零值是错误代码。

因此，如果文件已加载，则测试`luaL_loadfile(...) == NULL`为**真**，但代码调用错误并返回。

该函数`lua_pcall()`还返回一个状态代码，您可能还想验证它。

否则，所示脚本确实会创建一个全局变量，`lua_getglobal()`并将其检索到可以使用 测试它的堆栈中`lua_isstring()`，或者如果它与 具有足够的字符串相似性，可能更有用的是让您返回它的值[`lua_tostring()`](http://www.lua.org/manual/5.1/manual.html#lua_tostring)。后一个函数将返回一个`const char *`指向以 nul 结尾的字符串，或者如果堆栈索引处的值无法转换为字符串，则返回 NULL。`lua_tostring()`请参阅链接中的 Lua 参考手册以获取其余详细信息以及有关在循环内使用的警告。

**编辑：**我在几个地方添加了更好的手册链接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T06:43:42.370

我想你想用 lua_dofile 替换[luaL_loadfile](http://www.lua.org/manual/2.4/node14.html)。lua_pcall 是不必要的。我的猜测是使用 luaL_loadfile 将文件作为函数加载，然后使用 pcall 运行它可能不会创建您想要的全局变量。

# .net - .net 运行时 - Silverlight 运行时 =？

> ID：564106
> 
> 赞同：3
> 
> 时间：2009-02-19T06:00:07.513
> 
> 标签：.net, silverlight, frameworks, clr, silverlight-2.0

我用谷歌搜索了一下，但我找不到一个很好的清单，列出了 .net CLR 中的哪些类不包含在“CoreCLR”又名 Silverlight 中。

**Windows .net 框架中缺少什么 Silverlight？**

此外，Silverlight 运行时是否有任何 .net 框架没有的东西？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T06:04:25.553

Silverlight Runtime (Silverlight CLR) 本质上是一个迷你迷你 CLR :)。

Microsoft 完成了删除对 .NET Framework 程序集的许多依赖项的工作，这些程序集不是 Silverlight 版本的一部分

> Silverlight CLR 是 .NET Framework 的子集，其中包含组件和库，包括数据集成、可扩展的 Windows 控件、网络、基类库、垃圾收集和公共语言运行时 (CLR)。
> 
> Silverlight 的 .NET Framework 的某些部分与您的应用程序一起部署。这些“Silverlight 库”是未包含在 Silverlight 运行时中的程序集，而是在 Silverlight SDK 中提供。在您的应用程序中使用 Silverlight 库时，它们会与您的应用程序一起打包并下载到浏览器。其中包括新的 UI 控件、XLINQ、Syndication (RSS/Atom)、XML 序列化和动态语言运行时 (DLR)。

要了解详细比较，请参阅此链接[http://codebetter.com/blogs/patricksmacchia/archive/2008/10/01/comparing-silverlight-and-the-net-framework.aspx](http://codebetter.com/blogs/patricksmacchia/archive/2008/10/01/comparing-silverlight-and-the-net-framework.aspx)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-19T06:20:21.303

您可以查看包含 API 文档的在线[Silverlight 2文档。](http://msdn.microsoft.com/en-us/library/cc838158(vs.95).aspx)

或者转到[Silverlight 2 Getting Started Page](http://silverlight.net/GetStarted/)并下载 Visual Studio 2008 的插件（如果您有它）（如果您没有 Visual Studio 2008，它可以与免费的 Visual Web Developer Express 一起使用）或下载 Silverlight 2 SDK，它是在入门页面下方列出。

安装 Silverlight 2 SDK 后，您可以启动开始 -> 所有程序 -> Microsoft Silverlight 2 -> 欢迎，其中包含指向已安装文档和其他资源的链接。

# .net - 操作系统中的特殊文件夹信息

> ID：564108
> 
> 赞同：1
> 
> 时间：2009-02-19T06:02:25.993
> 
> 标签：.net

使用 Environment.SpecialFolder 是否保证所有 Windows 操作系统上的正确文件夹信息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T06:09:04.200

是的，它确实。[`SHGetFolderPath`](http://msdn.microsoft.com/en-us/library/bb762181(VS.85).aspx)它使用Windows XP RTM 和所有安装了 IE 5.0 的低级 Windows 版本上可用的 Win32 API 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T07:08:14.870

我发现这些*特殊*的文件夹位置有时令人困惑。我创建了一张表格，比较了 Windows XP 和 Vista 上的文件夹位置。这可能对你有用。 [链接在这里。](http://spreadsheets.google.com/pub?key=p4j46E_RfMgTVcQzHZRRmDQ)

# javascript - 如何确定点击了什么？

> ID：564110
> 
> 赞同：0
> 
> 时间：2009-02-19T06:03:12.497
> 
> 标签：javascript, jquery

在 jquery 中，如何确定单击了哪个对象？

有没有办法提醒（...）标签的类型？就像它是一个`<a href>`或一个`<img>`等？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T06:37:33.057

被点击的对象以`this`. 您可以使用 找出元素的类型`nodeName`。像这样：

```
function handle_click() {
   var clicked_element = this;
   alert(clicked_element.nodeName);
}
$("#mylink").click(handle_click); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T14:34:35.903

只要您想知道什么类型的元素*处理*了事件（您将事件附加到了什么），[Magnar 的答案就是正确的。](https://stackoverflow.com/questions/564110/how-to-figure-out-what-got-clicked/564190#564190)如果您想确切知道单击了哪个元素，包括该元素的子元素，则需要[event.target](http://docs.jquery.com/Events/jQuery.Event#event.target)属性。使用 Magnar 的示例：

```
// show the type of the element that event handler was bound to
function handle_click() {
    var clicked_element = this;
    alert(clicked_element.nodeName);
}

// show the type of the exact element that was clicked, which may be a child
// of the bound element
function handle_child_click(e) {
    var clicked_element = e.target;
    alert(clicked_element.nodeName);
}

// show the type of the element that matches "#myLink"
$("#mylink").click(handle_click);

// show the type of the element that matches "#myLink" or any of its children
$("#mylink").click(handle_child_click); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T06:14:46.480

查看[jquery 文档站点](http://docs.jquery.com)！

具体来说，[点击](http://docs.jquery.com/Events/click)事件

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T06:23:00.000

可以广告一个 onclick 事件来提醒一个属性

```
<p id='pWoo' onclick='alert(this.id);'>Woo</p> 
```

不特定于 jquery。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T14:40:52.910

可能不是您想要的，但我发现本教程很有趣：[http ://css-tricks.com/tracking-clicks-building-a-clickmap-with-php-and-jquery/](http://css-tricks.com/tracking-clicks-building-a-clickmap-with-php-and-jquery/)

# language-agnostic - 始终保持 n 个最佳元素的数据结构

> ID：564112
> 
> 赞同：9
> 
> 时间：2009-02-19T06:04:04.603
> 
> 标签：language-agnostic, data-structures, priority-queue

我需要一个始终保存`n`迄今为止插入的最大项目的数据结构（无特定顺序）。

所以，如果`n`是 3，我们可以在下面的会话中插入一些数字并且容器的内容发生变化：

```
[]  // now insert 1
[1] // now insert 0
[1,0] // now insert 4
[1,0,4] // now insert 3
[1,4,3] // now insert 0
[1,4,3] // now insert 3
[4,3,3] 
```

你明白了。数据结构的名称是什么？实现这一点的最佳方法是什么？或者这是在某个图书馆？

我正在考虑使用一个容器，`priority_queue`它的元素（委托）使用反向比较，因此`pop`将删除最小的元素。因此该`insert`函数首先检查要插入的新元素是否大于最小元素。如果是这样，我们将最小的元素扔掉并推出新元素。

（我有一个`C++`实现，但问题与语言无关。）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-19T06:50:34.757

您想要的特定数据结构可能是*隐式堆*。原始数据结构只是一个数组；为方便起见，假设它的大小为 N=2^n 个元素，并且您希望保持最大的 N-1 个元素。

这个想法是将数组（称为 A）视为深度为 n 的完整二叉树：

*   忽略 A[0]；将 A[1] 视为根节点
*   对于每个节点 A[k]，子节点是 A[2*k] 和 A[2*k+1]
*   节点 A[N/2..N-1] 是叶子

要将树维护为“堆”，您需要确保每个节点都小于（或等于）其子节点。这称为“堆条件”：

*   A[k] <= A[2*k]
*   A[k] <= A[2*k+1]

要使用堆来维护最大的 N 个元素：

*   请注意，根 A[1] 是堆中的最小元素。
*   将每个新元素 (x) 与根进行比较：如果它更小 (x<A[1])，则拒绝它。
*   否则，将新元素插入堆中，如下所示：
    *   从堆中删除根（A[1]，最小元素），并拒绝它
    *   用新元素替换它 (A[1]:= x)
    *   现在，恢复堆条件：
        *   如果 x 小于或等于它的两个孩子，你就完成了
        *   否则，将 x 与最小的孩子交换
        *   在每个新位置重复测试和交换，直到满足堆条件

基本上，这将导致任何替换元素“过滤”树，直到它达到其自然位置。这将最多需要 n=log2(N) 个步骤，这是你能得到的最好的。此外，树的隐式形式允许非常快速的实现；现有的有界优先级队列库很可能会使用隐式堆。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T07:30:58.963

在Java 中，您可以使用由TreeSet 实现的SortedSet。每次插入后检查集合是否太大，如果是则删除最后一个元素。

这是相当有效的，我已经成功地使用它来解决几个 Project Euler 问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T06:15:23.780

priority_queue 是 C++ 中最接近 STL 的东西。您可以将其包装在另一个类中，以创建您自己的实现自动修剪大小。

与语言无关（尽管可能不是安全的内存碎片）：

1.  插入数据
2.  种类
3.  删除第 n 个元素之后的所有内容

std::priority_queue 为您执行第 2 步。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T06:07:08.917

一个*有界的优先级队列*，我认为...... Java 在其标准库中有类似的东西。*编辑*：它被称为[`LinkedBlockingQueue`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/LinkedBlockingQueue.html). 我不确定 C++ STL 是否包含类似的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T07:30:42.333

难道不能只从排序集合中获取前 n 个元素吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-09-28T03:44:43.223

在 Pyhton 中，使用 heapq。在它周围创建一个小包装器，如下所示：

```
class TopN_Queue:
    def __init__(self, n):
        self.max_sz = n
        self.data = []

    def add(self, x):
        if len(self.data) == self.max_sz:
            heapq.heappushpop(self.data, x)
        else:
            heapq.heappush(self.data, x) 
```

...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-11-21T07:46:11.880

是的，您可以保持最小的大小为 N，然后在每次插入时将新项目与根项目进行比较

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-01-05T09:30:13.943

创建一个最小堆，同时存储一个计数器。

每当到达计数器时；提取分钟。

您可以这样做：O(1) insert、get-min 和 O(log log n) extract-min。`[1]`或者，对于其他提到的操作，您可以使用 O(log n) 插入和 O(1) 来执行此操作。`[2]`

* * *

`[1]`M. Thorup，“Integer priority queues with reduction key in constant time and the single source shortest paths problem”，第 35 届 ACM 年度计算理论研讨会论文集，纽约，纽约，美国，2003 年，第 149 页–158。

`[2]`GS Brodal、G. Lagogiannis、C. Makris、A. Tsakalidis 和 K. Tsichlas，“指针机中的最佳手指搜索树”，J. Comput。系统。科学，卷。67，没有。2，第 381-418 页，2003 年 9 月。

# eclipse-plugin - Eclipse RCP：应用程序无法识别定义的编辑器。（获取 PartInitException）

> ID：564125
> 
> 赞同：1
> 
> 时间：2009-02-19T06:09:31.750
> 
> 标签：eclipse-plugin, eclipse-rcp

我从 org.eclipse.ui.editors 扩展并将 plugin.xml 中的编辑器 ID 定义为“MyEditorId”。我写了相应的编辑器类。然后我尝试使用此代码从视图中打开编辑器。

page.openEditor(input, "MyEditorId");

但我得到“PartInitException”。即应用程序无法通过其 ID 识别编辑器。我检查了引用的 editor-id 中没有拼写错误。为什么编辑器不被认可？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T07:38:39.243

快速检查：

*   `-clean`请使用“ ”选项启动您的 RCP 应用程序。
*   检查您对[org.eclipse.ui.editors](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.platform.doc.isv/guide/workbench_basicext_editors.htm)扩展名的定义（例如，它是否[错过了图标定义](http://dev.eclipse.org/newslists/news.eclipse.platform.rcp/msg02177.html)？）
*   您是否创建了适当的“[虚拟输入](http://dev.eclipse.org/mhonarc/lists/platform-dev/msg00598.html)”以传递给您的编辑器？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T08:57:19.927

嘿，谢谢VonC。我错过了图标定义。我现在可以使用图标定义打开编辑器。

图标是编辑器扩展的强制属性有点奇怪。它甚至可以留空。如果没有图标定义，则在读取插件扩展时，定义的编辑器永远不会进入编辑器注册表。是不是有点奇怪？！

# unix - 在列之间减去并使用 AWK 打印

> ID：564128
> 
> 赞同：0
> 
> 时间：2009-02-19T06:10:47.957
> 
> 标签：unix, awk

我有以下输入数据：

```
AATGCCACGTTGAGAGGCGTTCGCGGAAGGCGCG      44      40.000
AATGCCACTCGGGTCCGAGATGGCGGATCTCCAC      35      37.000
AATGCCAGAGCTGTGGTAGTGTGAAAGCAGCAGT      13      13.000 
```

我想要做的是用第 2 列减去第 3 列，得到：

```
AATGCCACGTTGAGAGGCGTTCGCGGAAGGCGCG      -4
AATGCCACTCGGGTCCGAGATGGCGGATCTCCAC      2
AATGCCAGAGCTGTGGTAGTGTGAAAGCAGCAGT      0 
```

但是为什么这个 awk 不起作用：

```
 $ awk '{dif =($3 - $2)}END{print dif}' input.txt 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T06:15:06.730

因为您最后只打印出一次差异，这意味着除了最后一行之外的所有内容都被有效地丢弃。（当*整个*输入被读取和处理`END`后，该块只运行一次）你想要这个：

 *```
awk 'NF > 0 { print $1 "\t" ($3 - $2) }' input.txt 
```

`NF > 0`防止 awk 为空行打印无意义的 0 。

# php - if () { } 和 if () 的区别：endif;

> ID：564130
> 
> 赞同：166
> 
> 时间：2009-02-19T06:11:11.607
> 
> 标签：php, syntax

有没有区别...

```
if ($value) {

} 
```

...和...

```
if ($value):

endif; 
```

?

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2009-02-19T06:15:11.503

它们是相同的，但是如果您的代码中有 MVC 并且不想在代码中出现很多回声，那么第二个非常好。例如，在我的`.phtml`文件（Zend 框架）中，我将编写如下内容：

```
<?php if($this->value): ?>
Hello
<?php elseif($this->asd): ?>
Your name is: <?= $this->name ?>
<?php else: ?>
You don't have a name.
<?php endif; ?> 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-02-19T06:18:10.153

在我们公司，处理 HTML 的首选方式是：

```
<? if($condition) { ?>
   HTML content here
<? } else { ?>
   Other HTML content here
<? } ?> 
```

最后，这真的是选择一个并坚持下去的问题。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-04-14T01:43:02.440

它们在功能上确实是相同的。

但是，如果与`endif`通讯员的距离太远，`if`我认为给它提供参考评论会更好。这样您就可以轻松找到它的打开位置。不管是什么语言：

```
if (my_horn_is_red or her_umbrella_is_yellow)
{

    // ...

    // let's pretend this is a lot of code in the middle

    foreach (day in week) {
        sing(a_different_song[day]);
    }

    // ...

} //if my_horn_is_red 
```

这实际上适用于任何类似的“关闭事物”！;)

此外，一般来说，编辑器会更好地处理大括号，因为他们可以将您指向打开的位置。但即便如此，描述性评论的有效性并没有降低。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-19T06:19:09.573

您可以在官方文档中找到它：[PHP：控制结构的替代语法](http://ca3.php.net/manual/en/control-structures.alternative-syntax.php)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2013-07-15T08:28:09.457

我认为当您在视图脚本中混合使用`if`s、`for`s 和es 时，它会特别清晰：`foreach`

```
<?php if ( $this->hasIterable ): ?>
    <h2>Iterable</h2>
    <ul>
    <?php foreach ( $this->iterable as $key => $val ):?>
        <?php for ( $i = 0; $i <= $val; $i++ ): ?>
        <li><?php echo $key ?></li>
        <?php endfor; ?>
    <?php endforeach; ?>
    </ul>
<?php elseif ( $this->hasScalar ): ?>
    <h2>Scalar</h2>
    <?php for ( $i = 0; $i <= $this->scalar; $i++ ): ?>
    <p>Foo = Bar</p>
    <?php endfor; ?>
<?php else: ?>
    <h2>Other</h2>
    <?php if ( $this->otherVal === true ): ?>
    <p>Spam</p>
    <?php else: ?>  
    <p>Eggs</p>  
    <?php endif; ?>
<?php endif; ?> 
```

相对于：

```
<?php if ( $this->hasIterable ){ ?>
    <h2>Iterable</h2>
    <ul>
    <?php foreach ( $this->iterable as $key => $val ){?>
        <?php for ( $i = 0; $i <= $val; $i++ ){ ?>
        <li><?php echo $key ?></li>
        <?php } ?>
    <?php } ?>
    </ul>
<?php } elseif ( $this->hasScalar ){ ?>
    <h2>Scalar</h2>
    <?php for ( $i = 0; $i <= $this->scalar; $i++ ){ ?>
    <p>Foo = Bar</p>
    <?php } ?>
<?php } else { ?>
    <h2>Other</h2>
    <?php if ( $this->otherVal === true ){ ?>
    <p>Spam</p>
    <?php } else { ?>  
    <p>Eggs</p>  
    <?php } ?>
<?php } ?> 
```

这对于可能无法从底部大括号中看到顶部声明的长控制语句特别有用。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2012-03-14T16:54:26.680

我认为这真的取决于你个人的编码风格。如果您习惯于 C++、Javascript 等，您可能会觉得使用 {} 语法更舒服。如果您习惯于 Visual Basic，则可能需要使用 if : endif; 句法。

我不确定有人可以肯定地说一个比另一个更容易阅读——这是个人喜好。我通常会这样做：

```
<?php
if ($foo) { ?>
   <p>Foo!</p><?php
} else { ?>
   <p>Bar!</p><?php
}  // if-else ($foo) ?> 
```

这是否比以下内容更容易阅读：

```
<?php
if ($foo): ?>
   <p>Foo!</p><?php
else: ?>
   <p>Bar!</p><?php
endif; ?> 
```

见仁见智。我明白为什么有些人会觉得第二种方式更容易——但前提是你一生都没有用 Javascript 和 C++ 编程。:)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-19T06:15:32.657

如果可能，我会使用第一个选项，无论新选项如何。语法是标准的，每个人都知道。它也是向后兼容的。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-02-19T06:26:58.667

两者都是一样的。

但是：如果您想在视图文件（MVC 的 V）中使用 PHP 作为模板语言，您可以使用这种替代语法来区分为实现业务逻辑（MVC 的控制器和模型部分）而编写的 php 代码和 gui-逻辑。当然这不是强制性的，你可以使用你喜欢的任何语法。

ZF 使用这种方法。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-02-19T06:31:49.013

两种语法之间没有技术差异。替代语法并不新鲜。至少早在 PHP 4 甚至更早的时候它就受到支持。

您可能更喜欢另一种形式，因为它明确说明了哪个控制结构正在结束：`endwhile`例如，只能终止一个`while`块，而如果遇到大括号，它可能会关闭任何东西。

但是，如果您使用的编辑器对其他类 C 语法中的大括号具有特殊支持，您可能更喜欢传统语法。例如，Vim 支持几个键击来导航到匹配的大括号以及大括号分隔块的开头和结尾。替代语法会破坏该编辑器功能。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-06-14T11:17:11.877

最后，您只是不想寻找以下行，然后不得不猜测它从哪里开始：

```
<?php } ?> 
```

在技​​术和功能上它们是相同的。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-01-31T22:53:35.263

这一切都取决于，我个人更喜欢带有回声和大量缩进的传统语法，因为它更容易阅读。

```
<?php
    if($something){
        doThis();
    }else{
        echo '<h1>Title</h1>
            <p>This is a paragraph</p>
            <p>and another paragraph</p>';
    }
?> 
```

我同意 alt 语法对于不同的结束子句更清晰，但是如果没有文本编辑器突出显示的帮助，我真的很难处理它们，而且我只是不习惯看到这样的“浓缩”代码：

```
<?php if( $this->isEnabledViewSwitcher() ): ?>
<p class="view-mode">
    <?php $_modes = $this->getModes(); ?>
    <?php if($_modes && count($_modes)>1): ?>
    <label><?php echo $this->__('View as') ?>:</label>
    <?php foreach ($this->getModes() as $_code=>$_label): ?>
        <?php if($this->isModeActive($_code)): ?>
            <strong title="<?php echo $_label ?>" class="<?php echo strtolower($_code); ?>"><?php echo $_label ?></strong>&nbsp;
        <?php else: ?>
            <a href="<?php echo $this->getModeUrl($_code) ?>" title="<?php echo $_label ?>" class="<?php echo strtolower($_code); ?>"><?php echo $_label ?></a>&nbsp;
        <?php endif; ?>
    <?php endforeach; ?>
    <?php endif; ?>
</p>
<?php endif; ?> 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-07-16T04:44:55.190

我曾经使用花括号，但现在由于代码的可读性和可访问性，我更喜欢使用这种简写的替代语法。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-03-08T18:57:35.167

就我个人而言，我更喜欢在两个单独的部分中制作它，但在同一个 PHP 中，例如：

```
<?php 
    if (question1) { $variable_1 = somehtml; }
    else { $variable_1 = someotherhtml; } 

    if (question2) {
        $variable_2 = somehtml2;
    }

    else { 
        $variable_2 = someotherhtml2;
    }         

etc.
$output=<<<HERE
htmlhtmlhtml$variable1htmlhtmlhtml$varianble2htmletcetcetc
HERE;
echo $output;

?> 
```

**但也许它更慢？**

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-19T15:54:21.913

我认为这是一个偏好问题。我个人使用：

```
if($something){
       $execute_something;
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-05-10T03:21:41.780

我曾经使用大括号来表示“if, else”条件。但是，我发现“if(xxx): endif;” 如果代码被大量包装并且在任何编辑器中更易于阅读，则更具语义。

Of course, lots editors are capable of recognise and highlight chunks of code when curly brackets are selected. 有些人在“if(xxx):endif”对上也做得很好（例如，NetBeans）

就个人而言，我会推荐“if(xxx):endif”，但是对于小的条件检查（例如，只有一行代码），并没有太大的区别。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-05-03T18:16:08.237

我觉得没有一个预先存在的答案可以完全确定这里的答案，所以我将阐述我自己的观点。从功能上讲，这两种方法是相同的。如果程序员熟悉遵循 C 语法的其他语言，那么他们可能会对大括号感到更舒服，或者如果 php 是他们正在学习的第一种语言，他们会对`if` `endif`语法感到更舒服，因为它看起来更接近为常规语言。

如果您是一个非常认真的程序员并且需要快速完成工作，那么我相信花括号语法更优越，因为它可以节省打字时间

```
if(/*condition*/){
    /*body*/ 
} 
```

相比

```
if(/*condition*/):
    /*body*/
endif; 
```

对于其他循环尤其如此，例如，`foreach`您最终会输入额外的 10 个字符。使用大括号，您只需要输入两个字符，但对于基于关键字的语法，您必须为每个循环和条件语句输入一个完整的额外关键字。

# c# - 在 C# XNA 中声明、实例化和使用委托

> ID：564137
> 
> 赞同：0
> 
> 时间：2009-02-19T06:14:57.057
> 
> 标签：c#, visual-studio-2008, xna

我正在尝试按照标题所示进行操作，但是我感到困惑。

我知道委托应该如何工作，但 Visual Studio 告诉我我错了。说明如何执行此操作的 Microsoft 文档包含一个复杂的示例，该示例使用了一个书店程序，该程序包含模板和一堆难以理解的逻辑代码。

你怎么做到这一点？谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T10:23:21.327

在您的示例中，我假设您希望该`SetGameAreaWithCallback`方法实际调用.`changeGameArea``Game1`

为此，您需要创建您的委托实例，以便它引用该方法：

```
// game1 is the instance of the Game1 class that you want to call
// Instantiate the handler
SetGameAreaDelegate handler = new SetGameAreaDelegate(game1.changeGameArea); 
```

如果您使用的是 C#2 或更高版本，则语法会更简单：

```
// game1 is the instance of the Game1 class that you want to call
// Instantiate the handler
SetGameAreaDelegate handler = game1.changeGameArea; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T06:20:01.617

委托是一个安全的函数指针，您应该将方法分配给该名称的已声明变量，而不是尝试分配您正在执行的类型本身。

```
class MyGameClass
{
    SetGameAreaDelegate handler;
    MyGameClass()
    {
        // Instantiate the handler (since my callback is a non-static method)
        // You'll need to preform this assignment in the constructor, 'this'
        // is not valid during initialization 
        handler = new SetGameAreaDelegate(myGameAreaWithCallback);
        handler = MyGameAreaWithCallback; // short for above
    }
    void MyGameAreaWithCallback(Game1.gameAreas newArea)
    {
        //...
    }
} 
```

### 更新：有关代表的详细信息

委托是函数指针的托管包装器。它有自己的类型签名，可能是原始函数指针的保存替代方案。委托可以持有对实例对象的引用，例如 C++ 风格的成员函数指针，但您不必担心这一点，因为运行时会为您计算出此类信息。

知道非静态方法的委托将跟踪对该对象的引用可能会很好。这可能导致内存不会被垃圾回收，因为委托虽然看起来无害，但会维护或跟踪对象引用。

您的代码的问题是类型签名...

```
void SetGameAreaWithCallback(Game1.gameAreas newArea, SetGameAreaDelegate callback) 
```

...与您的委托类型不匹配...

```
delegate void SetGameAreaDelegate(Game1.gameAreas newArea); 
```

...为此工作...

```
SetGameAreaDelegate handler = SetGameAreaWithCallback; 
```

...你的代表应该是...

```
delegate void SetGameAreaDelegate(Game1.gameAreas newArea, SetGameAreaDelegate callback); 
```

...如果这是您真正的意思，您忘记了一个参数，这就是方法解析失败的原因。

# mysql - 如何在 MySQL 查询中放入 IF 语句

> ID：564151
> 
> 赞同：3
> 
> 时间：2009-02-19T06:20:20.600
> 
> 标签：mysql

我有一个简单地从 3 个表中选择的查询。

1.  从评论表中选择一篇文章的所有评论

2.  从 UserID 表中选择以查找它是什么类型的用户

3.  如果用户是一种类型，则搜索一个表...否则搜索另一个表以获取最终信息。

我该怎么办？我对 MySQL 的东西有点新，所以我非常感谢你的耐心！

PS - 如果不清楚，请告诉我...

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T06:39:54.360

好的，所以假设类型条件是 - 如果用户 if 类型为 'foo' 搜索表 'foovalues' 否则搜索表 'finalvalues'.... 假设表结构如下

评论 CommentID UserID ArticleID

用户 用户 ID 用户类型

```
 Declare TestUserType varchar(3);

 select * from Comments where ArticleID = <inputid>; //Returns the comments 

 select TestUserType = UserType from Users where UserID = <inputuser>; //Returns the usertype for a user and assigns it to a variable

 if TestUserType = 'foo' 
   begin 
    select * from FooValues;
   end
 else
   begin 
    select * from FinalValues;
   end 
```

免责声明：上面的 SQL 应该可以在 mySQL 中工作，但是自从我在那个数据库上工作已经有一段时间了，我现在无法访问它，所以上面的 SQL 可能会遇到语法错误。

您也可以将 SQL 放入存储过程中 - 如果您正在这样做，mySQL 有这个关于分隔符的东西，您可能需要注意 - 我在[这里写了博客](http://technikhil.wordpress.com/2007/03/13/nikhil-in-mysql-land-2-2/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T06:29:06.350

我不会将它们全部放在一个查询中。如果您将操作分解为更小的步骤，则代码的可读性会更高。

如果性能不是问题，您可以先获取用户类型，然后根据类型运行另一个查询。

对于更正确的方法，您应该考虑使用存储过程。

# java - 如何在客户端和服务器端中止对 Web 服务的调用？

> ID：564153
> 
> 赞同：0
> 
> 时间：2009-02-19T06:20:28.370
> 
> 标签：java, .net, wcf, web-services, soa

我可以通过调用 Web 服务代理的 ABORT 方法中止来自客户端的 Web 服务调用。

但是，在托管 Web 服务的服务器上，调用仅在完成处理时结束。由于服务器在处理它时不期望与已调用的 Web 方法相关的任何其他输入，因此我无法从客户端关闭它。

有什么办法我也可以中止服务器上的调用，即停止大型计算（并从数据库服务器中提取一些数据）哪个服务器正在处理？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T13:46:39.497

如果您使用的是 ASMX Web 服务，那么肯定没有办法做到这一点。也许其他人可以谈论 WCF 是否可行。

通常，它会要求您编写服务以预期中断。大多数服务代码不是这样编写的。

您是否希望经常中止请求？如果没有，那么最好在服务器上什么也不做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-13T06:51:09.693

既然你在谈论一个简单的同步请求响应，我不知道你会怎么做。

方法调用通常需要多长时间？

您真正想要的行为听起来像：

*   启动一系列动作（处理一些数据），取回一个 cookie
*   当进程完成时（轮询/获取通知），使用 cookie 获取结果
*   使用 cookie 传递控制指令，如中止

这听起来确实像是将您的处理建模为工作流，而不是函数调用。

如果你发现切换到这种做事模式有很大的好处，那么是的，你有选择。否则，只吃（很少）浪费计算的成本可能会更简单。

# java - 为组创建具有写入权限的目录

> ID：564154
> 
> 赞同：13
> 
> 时间：2009-02-19T06:21:44.903
> 
> 标签：java, linux

我使用 File 对象的 mkdirs() 函数在我的 java 程序（在 linux 上运行）中创建了一个文件夹。问题是该文件夹仅获得该组的读取权限。我需要它也有写权限（以便以后能够删除它的文件）。这样做的方法是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2012-09-18T23:42:46.323

一个非常简单的解决方案是：

```
file.setExecutable(true, false);
file.setReadable(true, false);
file.setWritable(true, false); 
```

在上面的代码中，file 是一个 File 对象。

当您创建文件集时，这些对文件的权限`setExecutable(true)`将允许您将该文件设置`Executable`为仅所有者。如果您再添加一个我在上面代码中添加的参数，`file.setExecutable(true, false);`它将`Executable` `false`仅用于所有者，这意味着它将为所有组/世界设置权限。

在 Debian 和 Windows XP 上测试和工作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-07-17T10:17:20.157

Java nio 可以帮助处理 posix 文件属性： [https ://docs.oracle.com/javase/8/docs/api/java/nio/file/attribute/PosixFileAttributeView.html](https://docs.oracle.com/javase/8/docs/api/java/nio/file/attribute/PosixFileAttributeView.html)

```
Path path = ...
 Set<PosixFilePermission> perms =
     EnumSet.of(OWNER_READ, OWNER_WRITE, OWNER_EXECUTE, GROUP_READ, GROUP_WRITE);
 Files.createFile(path, PosixFilePermissions.asFileAttribute(perms)); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T06:26:28.417

我怀疑（除非/直到有人发布相反的答案）在 Java 的标准库中没有办法做到这一点，因为 POSIX 组权限（你习惯的 rwxrwxrwx 类型）不是跨平台的。Java 6 将允许您设置所有者权限或全局权限，但（据我所知）不是组权限。如果您确实必须这样做，请尝试使用`Runtime.exec("chmod g+w directory")`，但在风格上将其包装在类似`setGroupWritable()`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T06:43:26.817

好的，这不是 Java 解决方案，而且绝对不可移植。

由于您提到您是 linux，因此您可能会考虑检查“umask”设置并进行适当的设置（以创建具有组写入权限的目录），然后启动您的 java 程序。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-19T06:24:43.803

在 java 6 上，有一些方法可以让您执行此操作，例如 setwriteable()。在以前的 java 版本中，您必须访问命令行才能执行 chmod 命令。

[Java 6 SE 文件类文档。](http://java.sun.com/javase/6/docs/api/java/io/File.html)

编辑：糟糕，我完全错了；我没有注意到您特别想要组权限。如果没有 Runtime.exec()，这些似乎是不可设置的。

@大卫：你是对的。

另一个想法：如果您有很多文件要更改，那么编写一个 shell 脚本并从 runtime.exec() 调用它怎么样？

# java - Eclipse 中的视觉摆动

> ID：564156
> 
> 赞同：10
> 
> 时间：2009-02-19T06:22:45.180
> 
> 标签：java, eclipse, swing

有什么方法可以使用可视化编辑器在 Eclipse 中制作摇摆应用程序？我正在使用Ganymede。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-11-24T20:45:22.937

您的选择是：

1.  [WindowBuilder Pro](http://www.eclipse.org/windowbuilder/) (eclipse.org)：“WindowBuilder 是一个功能强大且易于使用的双向 Java GUI 设计器”，另请参见[code.google.com 上的 WindowBuilder Pro](http://code.google.com/javadevtools/wbpro/index.html)。

2.  [Visual Swing for Eclipse](http://code.google.com/p/visualswing4eclipse/) - 一个直接处理 .java 源文件的编辑器。笔记：

    1.  首页上的更新网址错误（[问题 115](http://code.google.com/p/visualswing4eclipse/issues/detail?id=115)），应改为：`http://visualswing4eclipse.googlecode.com/svn/trunk/vs4e/`
    2.  您必须取消勾选“按类别分组项目”才能看到安装。
    3.  [eclipse视觉摆动](http://eclipse.dzone.com/announcements/visual-swing-designer-eclipse)的原始公告。
    4.  打开 netbeans 生成的 swing 文件时，我崩溃了。

3.  [来自 ehecht.com 的可视化编辑器](http://www.ehecht.com/eclipse_ve/ve.html) - 某人自己的版本，最后更新于 2010-08-29：“prelininary [sic] eclipse 3.6 (helios) 版本”（直接下载：[ve_eclipse_36_win32_201008292115.zip](http://www.ehecht.com/eclipse_ve/ve_eclipse_36_win32_201008292115.zip)）*“这些文件是非官方版本。所以你使用风险自负。”*

4.  改用[NetBeans](http://netbeans.org/) _

    1.  内置图形用户界面编辑器
    2.  使用 xml 文件作为 gui 设计的源，执行单向转换
    3.  将自己的库添加到您的项目以支持 GUI 创建。

5.  [用于 Eclipse 和 WebSphere 的 Jigloo SWT/Swing GUI Builder](http://www.cloudgarden.com/jigloo/index.html) -*注意：Jigloo 可免费用于非商业用途，但需要购买专业许可证才能用于商业用途（在成功评估 Jigloo 之后）。*

* * *

选项不再可行/可用：

*   官方“可视化编辑器”，[由 eclipse](http://www.eclipse.org/archived/)存档：（存档：2011 年 6 月），http://wiki.eclipse.org/VE/Update 上的匹配安装说明，以及[http:](http://www.eclipse.org/articles/Article-VE-Custom-Widget/customwidget.html) [//www.eclipse](http://wiki.eclipse.org/VE/Update)上的过时文章/教程[.org/articles/Article-VE-Custom-Widget/customwidget.html](http://www.eclipse.org/articles/Article-VE-Custom-Widget/customwidget.html)，另见[eclipse 可视化编辑器死了吗？](https://stackoverflow.com/questions/319242/is-eclipse-visual-editor-dead)

* * *

这是对这个问题的所有其他答案的总结，因为我花了一段时间才弄明白它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T09:24:46.257

我经常使用[Jigloo](http://www.cloudgarden.com/jigloo/index.html)，它非常好。可以为 Swing 和 SWT 生成 GUI。非商业用途免费，商业用途每位开发者只需 85 美元即可负担得起。适用于 3.4（Ganymede）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T07:26:34.263

您可以尝试安装[echech 的 VE](http://www.ehecht.com/eclipse_ve/ve.html)（[可视化编辑器](http://www.eclipse.org/articles/Article-VE-Custom-Widget/customwidget.html)）版本。如果第一个设置过程不起作用，
您可以[在此处执行另一个设置过程](http://wiki.eclipse.org/VE/Update)

![原创活动菜单](https://i.stack.imgur.com/5IPN8.png)

它应该与 eclipse3.4 (Ganymede) 一起使用。
或者您可以下载原始版本并将其安装在 eclipse3.2 设置中。

它是我唯一的[可视化编辑器](http://www.eclipse.org/vep/WebContent/main.php)~~知道~~知道哪个~~是~~是免费的并支持 Swing。
注意：它是自 2011 年 6 月以来存档的 Eclipse 项目。

[tehvan](https://stackoverflow.com/users/61848/tehvan)提到了一位商业编辑：~~[摇摆设计师](http://www.xmarks.com/site/www.instantiations.com/swing-designer/)~~（现在只剩[下 Smalltalk 的 WBPro](http://www.instantiations.com/products/add-ons/windowbuilderpro.html)）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T07:03:33.943

您可能想尝试一下[这个免费的 Swing](http://code.google.com/p/visualswing4eclipse/) eclipse 可视化编辑器。我还没有时间运行它，但那在我的待办事项列表中（这个编辑器看起来很有趣，而且它是开源的）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-09-23T12:40:21.953

这是比VE更好的东西

[Eclipse 的 Visual Swing](http://eclipse.dzone.com/announcements/visual-swing-designer-eclipse)

# perl - 如何找出 Perl 包的文件名？

> ID：564168
> 
> 赞同：6
> 
> 时间：2009-02-19T06:26:38.730
> 
> 标签：perl, packages, cpan, filenames

我想将 Perl 包名称转换为文件的完整路径。

```
say package_name_to_path('Foo::Bar::Baz');
/tmp/Foo/Bar/Baz.pm 
```

我知道有一个 CPAN 模块可以做到这一点？就是找不到了？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-19T08:13:16.023

如果您已经加载了模块，只需查看 %INC，但您必须按文件名进行操作。

```
say $INC{"Foo/Bar/Baz.pm"}; 
```

如果还没有，可以使用 Module::Util 或 Module::Info 附带的 module_info 程序。

```
$ module_info Module::Build

Name:        Module::Build
Version:     0.30
Directory:   /usr/local/lib/site_perl
File:        /usr/local/lib/site_perl/Module/Build.pm
Core module: no 
```

或者您可以手动通过@INC。

```
my $module = "Foo::Bar";

# Convert from Foo::Bar to Foo/Bar.pm
my $file   = $module;
$file =~ s{::}{/};
$file .= ".pm";

my $path;
for my $dir (@INC) {
    $path = "$dir/$file";
    last if -r $path;
    $path = undef;
}

say defined $path ? "$module is found at $path" : "$module not found"; 
```

（完全跨平台的解决方案将使用 File::Spec 而不是用斜杠连接。）

如果您只需要快速找到一个模块，`perldoc -l`就像 Fayland 提到的那样，它会很好地找到一个没有 POD 的模块。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T06:30:24.617

呵呵——我才想起来。

```
use Module::Util qw( :all );

$valid = is_valid_module_name $potential_module;

$relative_path = module_path $module_name;

$file_system_path = module_fs_path $module_name; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T06:43:53.040

好吧，perldoc 可以告诉你文件名：

```
[fayland@alpha ~]$ perldoc -l Catalyst
/home/fayland/perl5/lib/perl5/Catalyst.pm 
```

或在加载模块后查看 %INC。

谢谢。

# c++ - 在 Windows 上实现堆栈跟踪

> ID：564177
> 
> 赞同：0
> 
> 时间：2009-02-19T06:30:40.780
> 
> 标签：c++, winapi

我正在为我正在编写的游戏实现一个崩溃报告工具，我想为报告提供一个（相当）详细的本机堆栈跟踪。我已经在 GNU/Linux 上实现了这个，但是在 Windows 上我遇到了麻烦。这是我试图开始工作的一些示例代码：

[http://pastebin.com/m30b50f76](http://pastebin.com/m30b50f76)

每次调用 SymFromAddr 时，都会收到错误消息“尝试访问无效地址”。有没有人有使用 StackWalk64/SymFromAddr 及其亲属的经验？

谢谢，罗伯

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T06:48:04.420

为什么不直接捕获一个小型转储并将其与报告一起发送？您可以在调试器中自己重建堆栈跟踪，您将获得所有局部变量以及其他线程的所有堆栈。

另外，我认为该错误是因为您缺少程序的符号（PDB）。

# jquery - 棘手的 jQuery 操作，不确定我是否正在使用“this”属性

> ID：564185
> 
> 赞同：0
> 
> 时间：2009-02-19T06:35:25.510
> 
> 标签：jquery, ajax, events, callback

使用 jQuery，我将一些图像标签与这样的点击事件绑定：

```
$('.imageClass > a > img').bind('click', onImageClick);

this.onImageClick = function() {
    $.post("/blah/123", { test : 'a' }, function(data) { myCallback(this, data); }, "json");
}

this.myCallback(event, data) {
    alert($(event).parent.attr("href"));
}; 
```

我的 DOM 看起来像这样：

```
<div class="imageClass">
    <a href="#"><img src="/images/1.jpg" alt="1"></a> <strong>hello</strong>
    <a href="#"><img src="/images/2.jpg" alt="2"></a>
</div> 
```

**我想以某种方式使用 data.Message 更改 mycallback 中的文本“你好”**

我似乎无法确定强标签，我也不确定我是否将正确的值传递给 mycallback ！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T06:48:30.470

要使用来自 ajaxcall 的数据更改强文本，请尝试以下操作：

```
$(".imageClass > a > img").click(on_image_click);

function on_image_click() {
    var image = this, strong = image.parent().next();
    $.getJSON("/blah/123", {test: 'a'}, function (data) {
        strong.text(data.Message);
    });
} 
```

似乎您有点不确定如何使用`this`-operator，这是可以理解的。一旦理解，这是一个强大的概念。我试过在网上找到一篇好文章。[Quirksmode 有一个](http://www.quirksmode.org/js/this.html)，但它也有点混乱。然而，我可以衷心推荐 Douglas Crockfords [Javascript：好的部分](https://rads.stackoverflow.com/amzn/click/com/0596517742)。

# c# - 使用 c# 在单击 datalist 之外的按钮时重置 datalist 中的复选框

> ID：564220
> 
> 赞同：0
> 
> 时间：2009-02-19T06:54:12.267
> 
> 标签：c#, .net, checkbox, datalist

使用 c# 在单击 datalist 之外的按钮时重置 datalist 中的复选框

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T07:29:29.840

在按钮 OnClick 事件的事件处理程序中，您将遍历数据列表中的每个项目并找到复选框并重置它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T07:36:46.627

CKret 所说的，而且我经常发现[Enumerable.OfType Method](http://msdn.microsoft.com/en-us/library/bb360913.aspx)方法对于做这样的事情非常有用。在某种集合中循环某种类型的组件。例如，我在某处做这样的事情：

```
foreach(CheckBox c in somePanel.Controls.OfType<CheckBox>())
{
    c.Checked = false;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-21T20:48:02.920

使用这个，希望对你有帮助：

```
foreach (DataListItem row in yourdatalist.Items)
{
   CheckBox check = row.FindControl("nameofthecheckbox") as CheckBox;
   check.Checked = false
} 
```

# .net - ASP.NET 应用程序需要定时炸弹

> ID：564221
> 
> 赞同：17
> 
> 时间：2009-02-19T06:54:42.560
> 
> 标签：.net, asp.net, security, time-bomb

我们开发了一个定制的 ASP.NET 应用程序，用于我们客户的 Intranet。看来他们不太可能为此付钱，所以我们的老板希望我们引入一个定时炸弹。

***[编辑：] 请仅提供技术回复！这是否是一个好的（或合法的）想法是 CEOoverflow.com 的问题***；-)

应用程序中的所有页面都继承自一个名为 ApplicationBasePage 的类并具有一致的错误处理，因此我认为在 ApplicationBasePage 的生命周期早期抛出异常将是使应用程序无法使用的一种简单方法。不过，我对您可能有的其他想法持开放态度。

我的问题是：**我们应该如何以及在哪里存储应用程序到期的日期？**

需要注意的几点：

*   该应用程序安装在客户办公室的单个服务器上。
*   应用程序数据保存在同一服务器上的 SQL Server 2005 数据库中。该数据库由我们设计，不用于其他任何用途。
*   该应用程序只能在他们的 Intranet 上访问：无法通过 Internet 访问该应用程序。
*   我们目前可以远程桌面访问他们的服务器，但如果事情变得糟糕，我们预计会失去它。
*   该应用程序是用 .NET 2.0 编写的。
*   安全性由 FormsAuthentication 处理。
*   我们需要能够关闭定时炸弹或轻松更改其触发日期（假设我们仍有远程桌面访问权限来执行此操作）。
*   服务器可以正常上网，但最好不要依赖这个。
*   定时炸弹只会锁定用户：它不会破坏任何数据。
*   除非它触发，否则客户绝不能意识到定时炸弹的存在。
*   他们的 IT 人员会很乐意在 web.config 或数据库中四处寻找。他不是程序员，但他并不害怕改变事情“只是为了看看会发生什么”。对应用程序进行反编译或逆向工程将超出他的能力范围。

对于额外的信用，您认为在这种情况下通过默默无闻来依赖安全性是可以的？

[**编辑：** ]

*   该应用程序做了很多与日期相关的关键业务，因此我们可以确定他们不会更改服务器上的时钟，因为这会使应用程序变得更糟。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-19T08:07:03.107

“他们看起来不太可能为此买单，所以我们的老板希望我们引入一个定时炸弹。”

一个不称职的商人要求您针对业务问题实施技术解决方案。如果你的客户不付钱，你的老板应该像成年人一样处理这种情况，而不是像高中黑客那样摆弄逻辑炸弹。

这是不道德的，可能是非法的，但大多数情况下它只是愚蠢的。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-19T07:29:14.880

我同意关于将其称为试用版并让它过期的评论。在我们的一个产品中，一个网络发布系统，我们有一个公共页面类，它将检查用户的许可证密钥，如果它无效，我们将在所有页面的顶部打印一条消息。该消息非常明显，但不会影响程序的工作方式。

为了进行检查，我们在 web.config 文件中存储了一个“注册密钥”。我们将其与我们计算的密钥进行比较，计算它的算法存储在单独的程序集中。如果密钥匹配，我们假定该产品已获得许可。

对于我们的使用，我们仅向注册密钥计算算法提供客户名称，但您可能需要添加版本号或其他日期。然后通过计算所提供名称的 MD5 哈希值和保密代码（数组中的一些随机字节）来生成注册密钥。

这绝不是万无一失或非常可靠的，但它很简单，已经足够我们使用了。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-19T07:18:26.623

好吧，这是我能想到的一些事情

1.  放置一个取决于您的一个人登录的逻辑炸弹 - 因此在最后一次登录应用程序关闭后的一定天数内。
2.  使用基于日期的锁定并将日期存储在 SQL Server 的表中。但是使用标准算法加密存储的值，该算法使用代码中的盐。这样您就可以避免将日期暴露给系统管理员。
3.  使用上面的方法存储一个大的整数值，一旦应用程序加载到 IIS 中，您就可以从该值开始倒计时 - 一旦达到零，删除数据库中的值并锁定应用程序 - 您必须使用加密重置该值再次工作。
4.  如果这个应用程序通过默默无闻的安全性很好，但如果你想把它作为产品推销，那么你需要某种加密。

但是，这些都不是万无一失的……
免责声明：我不是任何法律专家-我仅从技术角度回答了这个问题。我个人不会这样做，因为我认为这在道德上是模棱两可的。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-19T07:26:12.703

我真的看不到任何结局会很好的情况。如果您担心收到付款（并且他们可能担心在应用交付之前为其付款），那么设置某种托管怎么样？他们按照双方商定的放款条款将付款存入托管，然后您知道这笔钱已被搁置，直到您完成工作，您才能继续工作。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-19T14:48:19.740

抛开道德问题不谈，如果您担心您的序列号实施被黑客入侵，为什么不使用 X509 证书呢？例如，如果您有一个安装了证书服务器的 Windows 机器，它可以在 Internet 上公开证书吊销列表。

为每个客户端颁发一个客户端标识证书（如果您向中央服务器提供更新检查，则奖励 - 现在您可以使用客户端/服务器 HTTPS 而无需担心密码）。

如果客户不付款，则撤销证书。在您的应用程序启动中，只需加载证书并检查它的有效性......

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-26T16:07:11.587

感谢您的所有回复！

我们并没有完全按照任何人的建议去做，而是使用了你们几个人的想法。

首先，我们不再称其为定时炸弹，而是将其称为许可证。由于该软件目前（可以说）不完整，并且由于客户尚未为其付费，因此我们可以将其称为过期的测试版本。这（可能）让我们越过了大部分合法的雷区，并且（正如 zsharp 指出的那样）如果他们声称该产品不合格，如果他们不能使用它，他们就不能真正抱怨。

无论如何，技术实现是这样的：

我们希望将到期日期隐藏在不会被偶然发现的地方，并且如果它被注意到，则采用不易修改的形式。它还必须在某个我们可以确定不会受到无意影响的地方，即使它位于我们没有太多控制权的服务器上。

因此，我们加密了到期日期并将其放入应用程序使用的数据库上的扩展属性中，并为其提供了一个适当的误导性名称。

应用程序在启动时检查密钥，如果应用程序尚未过期，则将静态布尔标志设置为 true。站点中的每个页面都会检查此标志，如果标志为假，则将用户退回到错误页面。

我们对此解决方案感到满意，原因如下：

*   我们可以轻松更改应用程序的到期日期。
*   不依赖于可以访问的互联网，也不依赖于他们的服务器之外的任何其他东西。
*   保护将在备份和恢复或应用程序被移动到另一个盒子时继续存在。

当争论停止时，他们已经付钱给我们，我们又是朋友了，下一次升级到他们的应用程序时根本不会检查，确保这段被遗忘的代码不会在某些时候被意外触​​发点数年（谢谢，克里斯汀！）。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-19T07:06:31.800

他们的网络服务器是否可以访问互联网？除了其他方法之外，您可能希望使用 Web 服务来触发定时炸弹，因为狡猾的系统管理员可能愿意将服务器上的时钟设置回几年。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-02-19T07:20:14.247

需要考虑的几点：

这甚至合法吗？假设您不打算公开这个复活节彩蛋，“*除非它触发，否则客户绝不能意识到定时炸弹的存在*”，您可能会遇到一些法律问题......

如果客户可以访问源代码，那么我无法想象您如何包含他们无法聘请开发人员删除的任何内容。即使 IT 人员不是开发人员，他们也没有能力聘请另一位开发人员对代码进行逆向工程。

最后，业障……如果您真的在与您认为自己不信任实际付款的客户合作，那么为什么要与他们合作呢？我希望您希望在执行工作之前将所有内容都放在桌面上并获得客户的全面承诺。如果客户不愿承诺付款，那么我会走路..

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-02-19T09:21:07.297

如果客户拥有软件的所有部分，您就无法完全阻止它。

唯一正确的方法是使应用程序依赖于您拥有的某些组件，例如它可能需要在一段时间后激活，或者对您的 Web 服务器执行 ping 操作。

这可以通过获取安装日期并将其用作某种盐/加密密钥并用它加密所有数据来实现。然后，您可以与该安装日期进行比较。如果客户拧紧它（将时钟拨回），您会注意到它，因为您有原始安装日期。如果他们更改日期，那也将更改加密密钥，因此无法再解密数据。

仍然有一种解决方法，但是对于任何基于时间的解决方案，您确实需要以某种方式将安装日期作为比较的基础，并且您需要使这个修补程序安全，因此使用某种加密的想法用它来保护所有数据。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-02-19T09:20:00.543

这听起来像是律师的工作。

除此之外，我会使用一个包含到期日期的简单配置文件。然后将该日期的 RSA 加密哈希也存储在配置文件中。如果您更新到期日期，那么您也只需更新加密哈希。应用程序定期读取日期并使用公共 RSA 密钥解密散列，然后检查散列。如果他们修改日期、加密哈希或公钥，则应用程序将停止工作。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-02-19T15:33:58.343

两个想法：

1) 我会在场外为他们托管申请，直到他们付款，或者直到他们将钱存入托管。如果他们说它不起作用并且不会付款，那么他们不会介意您在协议整理期间关闭访问权限，对吗？！

2）我们以前做过类似的事情。我们花了更多的时间考虑任何可能的“定时炸弹”如何 100% 防弹，这样它就不会在截止日期之前意外爆炸，或者在“拆除”后的某个时候意外爆炸。例如，实际删除代码可能比将标志从“试用”更改为“无限使用”更好

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-02-19T14:19:28.233

不要把你的名字放在你所做的任何事情上，并删除所有包含你名字的现有评论。如果它确实合法并且您的名字出现在计划中，那么您的老板很容易将您扔到公共汽车下并说他与此无关。我会认真地重新考虑是否遵循这个方向。我知道这是管理层的决定，但如果你做的工作很容易回来咬你。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-02-19T15:08:04.967

我不是律师，但这是我的观点：如果他们声称该程序不起作用并且无法使用，那么他们以后不能争辩说它“效果不佳”并要求您对损害负责，除非他们已经为什么支付了部分费用确实有效。

在您尝试此处的任何建议之前，我会以书面形式收到他们的投诉。（我要补充一点，“免费试用”路线似乎最安全）

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-02-19T07:26:18.680

如果您希望日期位于服务器本身而不是 Internet 上，那么通过默默无闻来确保安全似乎是您唯一的选择。不过，这是明智的——您不希望应用程序每次在该日期开始时都检查互联网，并在互联网连接不良时死掉。

最简单的方法是将程序集中的日期保存为变量。如果您害怕简单的反编译，请对其进行加密并将密钥也存储在程序集中。如果您认为将来想更改日期，请将其存储在 DB/web.config 中（当然是加密的）。对于加密，您可以使用从 base64 到公钥加密的任何内容。显然，这不会妨碍对您的代码进行认真的反编译......但它对初学者有好处。

顺便说一句，“逻辑炸弹”是否也让您想起了剑鱼？

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-02-19T07:54:13.027

故意引入这样的“定时炸弹”当然是非法的。你的老板不是第一个考虑它的人，也不会是最后一个。他最好的选择是在付款之前停止生产实施。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-02-19T15:58:08.493

您可能想警告您的老板，如果他的客户遭受任何金钱损失（包括客户流失），您的公司将对该损失承担责任，并且可能还会受到处罚，以及您公司的法律费用。而且，如果公司无法在诉讼和和解中幸存下来，你就会失业。

如果我是你，我会三思而后行。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-02-19T08:01:33.820

像这里的许多其他人一样，我会说不要这样做。我不知道这是否违法，但感觉不对。业务必须基于信任，公开讨论必须优先于此类计划。

如有必要，谈论您的担忧并冻结开发 - 我认为他们毕竟想要产品！

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-02-19T14:38:36.177

这是相当卑鄙的，但是您可以编写一个计划任务来执行一个对所有密码进行加盐的程序。它不会破坏任何数据，只要您有权访问，您就可以禁用计划任务。此外，如果在您想将信息返回给他们的地方发生了什么事，这就像脱盐......脱盐......密码一样简单。

与许多其他人一样，我对实际实施这一点持保留态度。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-02-19T15:42:19.913

我将在您存储在 bin 目录中的已编译 dll 中实现某种方法。称它为`timebomb.dll`.

然后，您应该在此 dll 中有一个返回 true 或 false 的方法：

```
public bool hasTimeExpired() {
  //Pseudocode
  DateTime expires = new DateTime(Janurary 10, 2009);
  return ( DateTime.Now() >= expires );
} 
```

只需检查应用程序启动 (global.ascx??) 或某些代码页上的 hasTimeExpired() 方法，具体取决于您希望如何处理过期消息。

当您想关闭定时炸弹或延长时间时，bin 目录中的 dll 可以很容易地替换为新的编译版本。必须对它进行反编译才能确定到期日期，并且如果他们知道它是如何工作的，就很容易绕过它，但正如你所说，有问题的管理员可能不会这样做。

除此之外，您确实需要与律师合作，但有时锁定这样的借用软件比律师更有效且更便宜。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-02-19T16:12:29.003

我不能谈论法律问题。

从技术上讲，我想你可以做到这一点。制作密钥对，并使用私钥加密具有到期日期的文件。您的应用程序将使用公钥解密具有到期日期的文件。每次程序运行时，突出显示“距离许可证到期还剩 57 天。yada，yada”。这样一来，他们就会持续收到应用程序将停止工作的警告。

至于在到期后破坏任何数据，我不会这样做。我想我会加密数据中需要应用程序解密的一些关键项目。

不过，很难绕过一个会让时钟倒退的系统管理员。但是，如果它有网络连接，您可以让它“打电话回家”以获取密钥，如果它无法获取它，则根本无法工作。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-02-19T07:36:21.090

将一些逻辑移至您自己服务器上的 Web 服务。让客户应用程序依赖于该 Web 服务。有充分的理由移动该逻辑，例如“这是我们的核心业务，因此我们需要控制它”，将更改作为程序“新版本”的一部分。

与客户续签合同，其中包含一个新部分，该部分告诉他们如果他们不付款，您的 Web 服务将被断开。

如果他们不想签署合同，他们不想与您做生意，您可以为他们断开网络服务，如果他们签署，他们同意新条款。

如果您想确保他们在不付款的情况下无法使用它，这确实是唯一的方法。否则，您必须继续起诉他们或类似的威胁。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-02-19T08:37:23.173

技术问题由程序员处理，业务问题由律师处理。你的老板需要使用正确的工具来完成这项工作。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-02-19T16:19:43.010

执行防病毒路由，外部调用“更新”。如果您没有获得更新，如果他们不付款，应用程序将停止工作，请停止向他们提供更新。

我认为这是解决问题的错误方法，但我知道您的工作就是按照指示去做。

# amazon-web-services - 亚马逊 S3 架构

> ID：564223
> 
> 赞同：15
> 
> 时间：2009-02-19T06:57:08.280
> 
> 标签：amazon-web-services, hadoop, amazon-s3, couchdb, distributed-system

虽然[@http://highscalability.com/amazon-architecture](http://highscalability.com/amazon-architecture)的帖子总体上解释了 Amazon 的架构，但我有兴趣了解 Amazon S3 是如何实现的。

我的一些猜测是

1.  像 HDFS 这样的分布式文件系统 [http://hadoop.apache.org/core/docs/current/hdfs_design.html](http://hadoop.apache.org/core/docs/current/hdfs_design.html)
2.  一个非关系持久数据库，如 CouchDB [http://couchdb.apache.org/](http://couchdb.apache.org/)

是否可以使用 Python 或 PHP 等脚本语言在更小范围内实现类似的功能？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T23:24:46.937

Amazon S3 is implemented using the architecture described in the Dynamo Paper:

[http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html](http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html)

The paper explains consistent hashing, and how and why the guarantee is "eventual consistency".

The conflict resolution they talk about for Dynamo is not exposed to users of S3\. It is used internally in Amazon's applications, but for S3, the only conflict resolution is last write wins.

Edit: Werner Vogels has said "Dynamo is not directly exposed externally as a web service; however, Dynamo and similar Amazon technologies are used to power parts of our Amazon Web Services, such as S3." [http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html](http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html)

I would emphasize that he isn't saying S3 and Dynamo share components, he explicitly says that Dynamo itself is one of the technologies that power S3\. Everything I've seen from S3, including the caveats, is accounted for by assuming S3 is a fancy web services wrapper around Dynamo with authentication, accounting, and a last-write-wins conflict resolve that is invisible to the user.

The original question was about the underlying storage mechanism for S3\. It is explicitly not a distributed file system like HDFS or a non-relational database like CouchDB. Dynamo fills this role.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-22T12:27:47.860

Amazon S3 的架构及其实施都尚未公开。因此，它不可用于扩展以开发创建任何规模的私有云的能力。

有几篇关于云存储架构主题的论文。您可能会发现它们很有用。这是一个：[CACSS：迈向通用云存储服务](http://www.leonli.co.uk/blog/cacss-towards-generic-cloud-storage-service/)

还详细介绍了将不同技术相结合以提供单一性能优良、高度可扩展且可靠的云存储系统的方法。这项研究为缺乏经验的云提供商提供了知识来源，使他们能够快速建立自己的云存储服务

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T18:27:18.057

它更接近于 2，尽管内容存储为“BLOB”，系统不关心内容，而 CouchDB 可以。后端存储对用于存储多个副本的集群节点使用本地数据库（BDB？）。读取可以转到任何具有副本的节点，写入也可以，但是需要解决写入以消除冲突。正如凯文所提到的，这保证了“最终一致性”，但没有严格保证何时或哪个写入获胜（来自外部 POV；内部已定义）。

阅读 Dynamo 文档有助于理解许多概念，但 AFAIK 的实现是不同的。Dynamo 被亚马逊内部用于其他用途。两者都有开源实现；一个有趣的是[伏地魔计划](http://project-voldemort.com/)。CouchDB 显然也很有趣。

# qt4 - 如何将 QT Qimage 转换为 java awt 缓冲图像？

> ID：564228
> 
> 赞同：1
> 
> 时间：2009-02-19T07:00:05.763
> 
> 标签：qt4

我正在尝试使用以下代码将 java qt QImage 转换为 BufferedImage，但它不起作用

QImage image = map.toImage();

字节 buf[] = image.copyOfBytes();

```
 InputStream in = new ByteArrayInputStream(buf);
    try {
        BufferedImage img = javax.imageio.ImageIO.read(in);
              File file = new File("newimage.bmp");
            ImageIO.write(img, "bmp", file);

    } catch (Exception e) {
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-12-02T10:30:19.240

我用这段代码做了逆向逻辑，它可以工作：

```
Object o_image = mimeData.imageData();
QImage image = (QImage)o_image;

BufferedImage bufferedImage = new BufferedImage(
    image.width(), image.height(), BufferedImage.TYPE_INT_ARGB);

for (int x = 0; x < image.width(); ++x) {
    for (int y = 0; y < image.height(); ++y) {
        bufferedImage.setRGB(x, y, image.pixel(x, y));
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-23T17:15:42.090

[http://wiki.qtjambi.info/Converting_java.awt.Image_to_QImage](http://wiki.qtjambi.info/Converting_java.awt.Image_to_QImage) 上面链接上的方法是反过来的。它将图像转换为 QImage，我猜想反转逻辑并反过来做应该不会太难。

但是，我会提前警告您，它并不是很快。如果我找到更快的方法，我会更新页面。

# c# - 如何处理循环中的异常并保持迭代？

> ID：564229
> 
> 赞同：13
> 
> 时间：2009-02-19T07:00:22.953
> 
> 标签：c#, for-loop

我需要一个 for 循环来完成它的所有迭代，即使在任何一次迭代中都有任何异常。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-19T07:02:56.427

```
for (...)
{
    try
    {
        // Do stuff
    }
    catch (Exception ex)
    {
        // Handle (or ignore) the exception
    }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-19T07:02:54.523

只需将每次迭代都放在 try..catch 中

```
foreach(Person a in people)
{
      try
      {
              WorkOnPerson(a);
      }
      catch
      {
              // do something if you want to.
       }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T08:47:49.590

或者，如果这是您的程序中重复出现的模式，**并且您冒着这种捕获所有异常样式的风险**，请将其包装为您的集合的扩展。将其应用于前面的示例：

```
people.ForEachIgnorant(ofThrowingWorkOnPerson); 
```

或者：

```
people.ForEachIgnorant(p => WorkOnPersonThatThrows(p)); 
```

执行：

```
public static void IgnorantForEach<T>(this IEnumerable<T> source, Action<T> action)
{
    foreach (var item in source)
    {
        try
        {
            action(item);
        }
        catch { }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T07:21:52.543

好吧，事情是……您的解决方案必须包含一个 for 循环和某种错误/异常处理过程，因此您可能必须在您的 for 循环中嵌入一个 try catch 语句。

如果抛出异常，您将无法像未抛出异常时那样完成一次迭代。但是，通过使用 try catch，您可以确保您的循环执行所有不引发异常的迭代。

如果您需要在 for 循环中嵌入异常处理方面的帮助，只需使用 teedyay 发布的示例！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T09:32:41.840

我认为还值得注意的是，如果您使用的是通用列表 - 您可以使用以下内容来迭代集合：

ForEach（动作动作）

[http://msdn.microsoft.com/en-us/library/bwabdf9z.aspx](http://msdn.microsoft.com/en-us/library/bwabdf9z.aspx)

```
 EmployeesList.ForEach(ProcessEmployee);

    void ProcessEmployee(Employee employeeItem)
    {
        try
        {
            ...
        }
        catch { }
    } 
```

这有利于使循环中的代码可重用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-16T02:22:52.467

您知道异常是什么以及会导致什么吗？你能测试它并防止它被抛出，即。CanCompleteStep 或 TryCompleteStep。如果您无法完成，请跳过该步骤。然后，您可以将异常处理置于循环之外。

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2009-02-19T07:05:02.740

**循环**中没有内置功能可以做到这一点。这不是 C# 中内置的语言功能，它不会自动处理异常并继续循环。

此外，请尽可能避免将 try-catch 块放入循环中。即使它解决了您提到的问题，请考虑编译器和运行时必须做那么多额外的工作。如果没有异常发生，那一切都会白费。

相反，让例外成为例外。这是异常发生的事情：在您设计的输入考虑之外。当然，这只是一个建议，如果你真的要继续循环，请使用上面建议的两个选项。

# php - 解析/拆分正斜杠分隔的字符串

> ID：564238
> 
> 赞同：0
> 
> 时间：2009-02-19T07:03:34.490
> 
> 标签：php, regex, parsing, text-extraction, csv

这更像是一个通用的正则表达式问题，而不是特定于 PHP 的问题。

我得到了不同的字符串，可能看起来像：

> `A/B/PA ID U/C/D`

我正在尝试使用以下方法提取中间斜杠中包含空格（“/PA ID U”）的段：

> `preg_match('/(\/PA .+)(\/.+|$)/', $string, $matches);`

然而，我得到的不是“/PA ID U”，而是“/PA ID U/C/D”。

如何使它在最后一组中优先匹配“/.+”而不是“$”？

* * *

补充笔记：

我需要最后一组来匹配另一个“/somethingsomthing”或“”，因为字符串变化很大。如果我只匹配“/.+”，如果它位于行尾，例如“A/B/PA ID U”，我将无法获得“/PA ID U”。

基本上，我需要能够像这样提取特定的段：

> 鉴于： `"A/B/PA ID U/PA ID U/C/D"`
> 
> 提炼： `(A), (B), (PA ID U), (PA ID U), (C), (D)`

* * *

[更新]

我试图避免使用`split()`or`explode()`因为这意味着我必须单独匹配“PA ID U”模式。除了仅提取斜杠分隔的段之外，我还需要验证子字符串是否与特定模式匹配。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T07:07:32.937

我认为你可以最有效地使用 split 来完成你想要的。

```
split('/',$string); 
```

见：[php手册](http://us2.php.net/split)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T07:25:06.763

您的正则表达式不起作用，因为它`.+`是贪婪的。您可以通过将非贪婪修饰符 (a `?`) 添加到您的第一个修饰符来修复它`.+`：

```
preg_match('/(\/PA .+?)(\/.+|$)/', '', $matches); 
```

您也可以这样做：

```
'/\/(PA [^\/]+)(\/.+|$)/' 
```

我将斜线移到括号之外以避免捕获它（我想你对斜线不感兴趣）。将`[^\/]+`捕获直到下一个斜杠的任何字符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T07:11:25.657

内克拉米雷斯，

```
(\w+\s?)+ 
```

应该管用

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-03-10T13:49:49.263

通过在否定字符类中写入定界字符或使用定界符作为文字字符进行拆分来匹配。

代码：（[演示](https://3v4l.org/8nki6)）

```
$string = 'A/B/PA ID U/PA ID U/C/D';

// get only first value starting with PA:
echo preg_match('~PA[^/]+~', $string, $match) ? $match[0] : '';

echo "\n---\n";

// get all values strings with PA:
var_export(preg_match_all('~PA[^/]+~', $string, $matches) ? $matches[0] : []);

echo "\n---\n";

// get all delimited values:
var_export(explode('/', $string)); 
```

输出：

```
PA ID U
---
array (
  0 => 'PA ID U',
  1 => 'PA ID U',
)
---
array (
  0 => 'A',
  1 => 'B',
  2 => 'PA ID U',
  3 => 'PA ID U',
  4 => 'C',
  5 => 'D',
) 
```

# c# - C# 中的媒体播放列表

> ID：564248
> 
> 赞同：0
> 
> 时间：2009-02-19T07:08:39.423
> 
> 标签：c#, visual-studio-2008

如何在 C# .NET 中创建用于播放音频文件的动态播放列表？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T07:33:45.620

这个问题非常笼统......如果问题只是关于动态播放列表，那么请更具体 - 一般的答案是您将需要一个动态数组（ArrayList），您将在其中存储音频文件的位置（以及您可能想要包含的任何其他信息 - 您可能应该创建一个结构来保存信息）。

如果您想要/需要更多信息，请更具体。如果我误解了你的问题，我也很抱歉。

# .net - 如果您必须选择一个免费的 CMS 来与 ASP.NET MVC 集成，您会选择什么？

> ID：564256
> 
> 赞同：4
> 
> 时间：2009-02-19T07:11:44.737
> 
> 标签：.net, asp.net, asp.net-mvc, content-management-system, content-management

我正在寻找从头开始使用 CMS - 特别是可以与 ASP.NET MVC 很好地集成的CMS。

*   最好有人为我写了 Html Helpers
*   必须很容易被白痴编辑
*   必须给我非常干净的 HTML
*   必须能够存储简单的字符串或完整的文档
*   真的更喜欢 SQL 服务器作为后端 - 如果它必须是 mysql 或者 web 服务接口
*   必须有利于未来的本地化问题

我对这些东西*知之甚少*，我将在 Stackoverflow 上探索更多 CMS 问题——但到目前为止还没有特别找到关于 MVC 集成的太多信息。

实际上，我最初正在寻找的是关于我是否应该挂断简单的 MVC 集成而不是仅仅寻找最好的 CMS 的建议。

**编辑：**我将存储的内容类型将是资源，例如字符串、可能描述产品的简短 HTML“部分”、竞赛的简短描述、最初在 Word 中创建的长文档。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T10:26:05.347

[N2 CMS](http://www.n2cms.com/)有一个针对早期版本的 MVC 构建的示例站点，可以从[codeplex](http://www.codeplex.com/n2/Release/ProjectReleases.aspx?ReleaseId=20272)下载它- 一年多前，源代码已移至[GoogleCode](http://code.google.com/p/n2cms/)，我发现我需要下载它并根据最新的 MVC 位重新编译它以让它工作。

这是我看过的为数不多的开源 CMS 之一，我实际上会考虑使用 CMS，而不是“美化的博客引擎”——不过我只考虑了 0.02 英镑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T07:30:32.180

ASP.NET MVC 还很年轻（甚至还没有 RTM），而且还没有很多（或任何真正的 Oxite 之外的）预构建产品/解决方案。您可以使用它从头开始构建您自己的 CMS，但请参阅：wheel。

如果您正在寻找已经构建的产品，请选择最能满足您需求的产品，无论平台如何。

您也没有提到 CMS 的用途，这是一个重要的区别。

# javascript - 如何在 javascript 中定义一组键/值以及查找值并按顺序迭代该组？

> ID：564264
> 
> 赞同：2
> 
> 时间：2009-02-19T07:19:37.540
> 
> 标签：javascript

我有一组键/值，例如橙色=123、香蕉=4、苹果=567。如何将这些键/值存储在 javascript 对象中，以便我可以：

1.  通过查找检索一个值，例如 set["orange"] 应该返回 123 并且，
2.  ***按照添加键/值对的顺序***遍历集合。

似乎对于 1\. 对象字面量是合适的，但不能保证迭代顺序，对于 2\. 键/值对（对象字面量）数组将提供迭代顺序，但不能根据关键。

@* 感谢所有的答案 - 这个问题不是一个常见的问题吗？像 jQuery 这样的库不包括对这种类型的支持吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T09:36:53.500

烹饪自己的列表构造函数怎么样？

```
function List(obj) {

  if (this instanceof List) {
   var t     = this,
       keys  = [];

    /* inititalize: add the properties of [obj] to the list, 
       and store the keys of [obj] in the private keys array */
    for (var l in obj) {
       keys.push(l);
       t[l] = obj[l];
    }
    /* public:
       add a property to the list 
    */
     t.add = 
         function(key, value) {
              t[key] = value;
              keys.push(key);
              return t; /* allows method chaining */
            };

    /* public:
       return raw or sorted list as string, separated by [separator] 
       Without [sort] the order of properties is the order in which 
       the properties are added to the list
    */
     t.iterate =
       function(sort,separator){
         separator = separator || '\n';
         var ret   = [],
             lkeys = sort ? keys.slice().sort() : keys;

         for (var i=0;i<lkeys.length;i++){
           ret.push(lkeys[i]+': '+t[lkeys[i]]);
         }
       return ret.join(separator);
      };

  } else if (obj && obj instanceof Object) {
     return new List(obj);

  } else if (arguments.length === 2) { 
     var a    = {};
     a[String(arguments[0])] = arguments[1];
     return new List(a);

  } else { return true; }

 /* the 'if (this instanceof List)' pattern makes
    the use of the 'new' operator obsolete. The 
    constructor also allows to be initialized with
    2 parameters => 'List(key,value)' 
 */
} 
```

现在您可以将其原始（保持添加道具的顺序）或排序：

```
var myList = 
 List( { orange:123,
         banana:4,
         apple:567 }
     );
myList.add('peach',786);
alert(myList.iterate());
  /*=>output:
    orange: 123
    banana: 4
    apple: 567
    peach: 786
  */
or: alert(myList.iterate(1));
  /*=>output:
    apple: 567
    banana: 4
    orange: 123
    peach: 786
  */ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T07:23:58.123

你的两个假设都是正确的。不保证对象文字以任何顺序返回键。

在不旋转您自己的类型的情况下执行此操作的唯一方法是维护一个有序的键列表：

```
var obj = {
    orange:123,
    banana:4,
    apple:567
}

var keys = ['orange', 'banana', 'apple'];

for (var i=0; i<keys.length; i++){
  value = obj[keys[i]]];
} 
```

丑陋，我知道。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T09:58:49.047

一个简单的封装：

```
function Dictionary(p)
{
    if(!this.Add)
    {
        Dictionary.prototype.Add = function(a)
        {
            if(!a.length) {a = [a];}
            for(var i = 0, n=a.length; i<n; i++)
            {
                for(x in a[i])
                {
                    this[x] = a[i][x];
                    this.keys.push(x);
                }
            }
        }
    }

    this.keys = [];

    if(typeof(p)!='undefined') {this.Add(p);}
}

var a = new Dictionary({'orange':123, 'banana':4, 'apple':567});

alert(a.keys);//returns [orange,banana,apple]

alert(a.keys[0]);//returns orange

alert(a.orange) //returns 123

a.Add({'mango':88}); //another way to add data

a.Add([{kiwi:16},{grapefruit:79}]) //another way to add data

alert(a.keys);//returns [orange,banana,apple,mango,kiwi,grapefruit] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T07:28:58.533

您可以通过不同的方式进行操作：

```
var a = {'orange':123, 'banana':4, 'apple':567};

var b = new Object();
b['orange'] = 123;
b['banana'] = 4;
b['apple'] = 567;

var c = new Object();
c.orange = 123;
c.banana = 4;
c.apple = 567; 
```

语法不同，但在内部这三个声明是等价的。

# ms-access - ODBC 更改时如何刷新 Access mdb 中的链接表

> ID：564265
> 
> 赞同：12
> 
> 时间：2009-02-19T07:19:43.110
> 
> 标签：ms-access, odbc

我可以创建一个 Access mdb 并通过 ODBC 将链接表添加到 Sql Server 数据库。如果我使用 ODBC 控制面板小程序更改 ODBC 连接的 Sql Server，则 mdb 仍会连接到原始 Sql Server，直到重新启动 Access。

有没有办法在不重新启动 Access 的情况下重新链接这些链接的服务器表？

编辑：我想在代码中做到这一点

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-19T08:58:34.060

您可以使用下面的代码将 Access 项目中的所有 ODBC 表刷新到给定的 DSN。

**如何使用它**

只需将代码复制到新的或现有的 VBA 模块中，然后在要刷新链接的地方，使用正确的 DSN 调用它以用于新的 ODBC 连接：

```
RefreshODBCLinks "ODBC;DRIVER=SQL Server Native Client 10.0;" & _"
                 "SERVER=SQLSERVER;UID=Administrator;" & _
                 "Trusted_Connection=Yes;" & _
                 "APP=2007 Microsoft Office system;DATABASE=OrderSystem;" 
```

另外，请查看该`TableDef.RefreshLink`方法的 Access 帮助。

**代码版本 1**

经典的重新链接方式，但如果调用之前使用过的表，Access 可能会将连接信息保留在内存中`RefreshODBCLinks`。

```
Public Sub RefreshODBCLinks(newConnectionString As String)
    Dim db As DAO.Database
    Dim tb As DAO.TableDef
    Set db = CurrentDb
    For Each tb In db.TableDefs
        If Left(tb.Connect, 4) = "ODBC" Then
            tb.Connect = newConnectionString
            tb.RefreshLink
            Debug.Print "Refreshed ODBC table " & tb.Name
        End If
    Next tb
    Set db = Nothing
End Sub 
```

**代码版本 2**

这将完全重新创建 ODBC 链接表：旧的链接表将被重命名，然后使用给定 DSN 的新表将在删除旧链接版本之前创建。
请确保您对此进行了测试，并且可能会添加一些代码以更好地处理必要的错误。

另请注意，`dbAttachSavePWD`在创建 ODBC 表期间传递的参数会将 ODBC 密码（如果有）保存在 Access 中。如果这不是您需要的，只需将其删除。

```
Public Sub RefreshODBCLinks(newConnectionString As String)
    Dim db As DAO.Database
    Dim tb As DAO.TableDef
    Dim originalname As String
    Dim tempname As String
    Dim sourcename As String
    Dim i As Integer

    Set db = CurrentDb
    ' Get a list of all ODBC tables '
    Dim tables As New Collection
    For Each tb In db.TableDefs
        If (Left(tb.Connect, 4) = "ODBC") Then
            tables.Add Item:=tb.Name, key:=tb.Name
        End If
    Next tb

    ' Create new tables using the given DSN after moving the old ones '
    For i = tables.count To 1 Step -1
            originalname = tables(i)
            tempname = "~" & originalname & "~"
            sourcename = db.TableDefs(originalname).SourceTableName
            ' Create the replacement table '
            db.TableDefs(originalname).Name = tempname
            Set tb = db.CreateTableDef(originalname, dbAttachSavePWD, _
                                        sourcename, newConnectionString)
            db.TableDefs.Append tb
            db.TableDefs.Refresh
            ' delete the old table '
            DoCmd.DeleteObject acTable, tempname
            db.TableDefs.Refresh
            tables.Remove originalname
            Debug.Print "Refreshed ODBC table " & originalname
    Next i
    Set db = Nothing
End Sub 
```

最后一件事：如果您仍然遇到需要重新启动 Access 以使更改可见的问题，请查看我在我的网站上[*以编程方式重新启动和压缩数据库中的代码。*](http://blog.nkadesign.com/2008/ms-access-restarting-the-database-programmatically/)

注意：代码版本 2 的部分灵感来自[这篇 Access Web 文章](http://www.mvps.org/access/tables/tbl0010.htm)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T07:43:07.000

您使用的是哪个版本的 Access？在 2000 中，您可以转到工具>数据库实用程序>链接表管理器来更改您的设置。

# c# - 读取提交到 ASP.Net 表单的 Post 数据

> ID：564289
> 
> 赞同：111
> 
> 时间：2009-02-19T07:33:52.047
> 
> 标签：c#, asp.net, post

我在 asp.net 应用程序中有一个有效的登录表单。带有用户名和密码文本框以及处理登录的按钮的标准内容。工作正常。

我有一个新要求，允许用户从一个单独的纯 html 页面输入用户名和密码，该页面不是我的 asp.net 应用程序的一部分。我计划使用标准 html 来实现这一点 - 表单、输入、提交按钮等。表单操作将是我的 asp.net 登录页面的 URL，其方法将是 POST。

我想在 asp.net 登录表单的 C# 代码后面的页面中做的事情，大概是在 Page_Load 事件中，是检查对页面的请求是否包含传入的用户名和密码值。如果是，那么我需要读取这些值并处理登录，就好像有人单击了 asp.net 页面上的登录按钮一样。如果没有，那么我将照常显示登录表单。

如何检查我的页面请求中是否存在并读取用户名和密码值。

* * *

## 回答 #1

> 赞同：155
> 
> 时间：2009-02-19T07:44:23.957

阅读 Request.Form NameValueCollection 并相应地处理您的逻辑：

```
NameValueCollection nvc = Request.Form;
string userName, password;
if (!string.IsNullOrEmpty(nvc["txtUserName"]))
{
  userName = nvc["txtUserName"];
}

if (!string.IsNullOrEmpty(nvc["txtPassword"]))
{
  password = nvc["txtPassword"];
}

//Process login
CheckLogin(userName, password); 
```

... 其中“txtUserName”和“txtPassword”是发布页面上控件的**名称**。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-19T07:37:14.597

```
if (!string.IsNullOrEmpty(Request.Form["username"])) { ... } 
```

用户名是提交页面上输入的名称。密码可以通过同样的方式获得。如果它不为 null 或为空，则它存在，然后登录用户（我不记得 ASP.NET Membership 的确切步骤，假设您正在使用它）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-06-08T11:17:55.420

```
NameValueCollection nvclc = Request.Form;
string   uName= nvclc ["txtUserName"];
string   pswod= nvclc ["txtPassword"];
//try login
CheckLogin(uName, pswod); 
```

# sql-server - 如何在 Sql Server 链接服务器中指定 MS Access 工作组文件？

> ID：564295
> 
> 赞同：1
> 
> 时间：2009-02-19T07:36:58.950
> 
> 标签：sql-server, ms-access, linked-server

我有一个 Sql Server 数据库，其中包含一个链接到 MS Access mdb 数据库的服务器。Access 数据库具有工作组安全性，并且需要有效的用户名和密码。这很容易在 sql management studio 的链接服务器对话框中设置。问题是 Sql Server 需要能够找到 MS Access mdw 文件才能登录。

我设法让它工作的唯一方法是设置注册表项的注册表值`SystemDB`：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Jet\4.0\Engines 
```

到工作组文件的路径，但这会导致其他问题（例如其他 MS Access 应用程序或 Excel）。

有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T06:18:10.567

我已经有一段时间没有这样做了，在最近的 SQL Server 版本中也没有这样做，但我似乎记得当您添加到 Jet 数据库的链接时，它提供了定义工作组、用户名和密码的机会。当然，如果您使用的是 ODBC，那是 Jet 基本 ODBC 驱动程序的一部分。

# php - SQLite 事务没有按预期工作

> ID：564298
> 
> 赞同：5
> 
> 时间：2009-02-19T07:37:42.507
> 
> 标签：php, sqlite, pdo, transactions

我准备了 2 个文件，“1.php”和“2.php”。

“1.php”是这样的。

```
<?php
$dbh = new PDO('sqlite:test1');
$dbh->beginTransaction();

print "aaa<br>";
sleep(55);
$dbh->commit();

print "bbb";
?> 
```

而“2.php”就是这样的。

```
<?php
$dbh = new PDO('sqlite:test1');
$dbh->beginTransaction();

print "ccc<br>";
$dbh->commit();
print "ddd";
?> 
```

我执行“1.php”。它启动一个事务并等待 55 秒。

所以当我立即执行“2.php”时，我的期望是：

1.  “1.php”正在获得交易和
2.  “1”持有数据库锁
3.  “2”不能开始交易
4.  "2" 无法获得数据库锁所以
5.  "2" 必须等待 55 秒

但是，但测试进行了另一种方式。当我执行“2”时，然后

1.  "2" 立即返回结果
2.  “2”没等

所以我不得不认为“1”无法获得事务，或者无法获得数据库锁。

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-19T08:01:23.307

据我了解，SQLite 事务不会锁定数据库，除非

*   一个。您制作它们`EXCLUSIVE`（`DEFERRED`默认情况下它们是），或者
*   湾。你实际上访问了数据库

所以要么你明确地打电话

```
$dbh->exec("BEGIN EXCLUSIVE TRANSACTION"); 
```

或者您在开始之前对 DB 进行写操作 ( `INSERT`/ ) 。`UPDATE``sleep()`

引用[文档](http://www.sqlite.org/lang_transaction.html)（强调我的）：

> 事务可以是延迟的、立即的或排他的。**默认事务行为被延迟。** 延迟意味着在第一次访问数据库之前不会在数据库上获取锁。**因此，对于延迟事务，`BEGIN` 语句本身什么也不做。**在第一次读取或写入操作之前不会获取锁。对数据库的第一个读操作创建一个共享锁，第一个写操作创建一个保留锁。

# database - 函数式编程和数据库交互的最佳实践是什么？

> ID：564302
> 
> 赞同：9
> 
> 时间：2009-02-19T07:41:11.123
> 
> 标签：database, orm, functional-programming, lisp, crud

我知道在像 Java 这样的纯面向对象语言中，使用像 Hibernate 这样的 ORM 通常是有意义的。但是在 Clojure 或 Common LISP 中编写 CRUD 类型的功能时我会怎么做？

将 SQL 作为一阶函数传递？但是在 HTML 生成代码中使用 SQL 不是很丑陋吗？

谢谢，

奥莱克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T08:22:21.977

Common Lisp 不是一种自觉的 FP 语言。Clojure 可以只使用 Hibernate。

对于 Common Lisp：[数据库](http://www.cliki.net/database)。这是一个[持久对象 one](http://common-lisp.net/project/elephant/)。这是[教程](http://roeim.net/vetle/docs/cl-webapp-intro/part-1/)的第一部分，它与 Hunchentoot、CL 网络服务器和动态网页工具包一起使用。CL 中的 SQL[可能看起来像这样](http://clsql.b9.com/manual/ch02s02.html)（看起来比实际更长，因为 SQL 是水平格式化的，而 CL 不是）。如果你愿意，[这个人](http://github.com/tomoyuki28jp)正在开发一个旨在简洁的 Web 框架（使用 CLSQL 和 Elephant，已经链接到），着眼于弧线挑战。

编辑：[最近的答案](https://stackoverflow.com/questions/556456/is-it-feasible-to-do-serious-web-development-in-lisp/556618#556618)对此进行了扩展。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-04-09T18:29:52.487

Ur/Web 可能很有趣，尽管它不是基于 lisp：http: [//plv.csail.mit.edu/ur/](http://plv.csail.mit.edu/ur/)

正如他们的网站所引用的：

> Ur/Web 支持构建由 SQL 数据库支持的动态 Web 应用程序。标准库的签名使得类型良好的 Ur/Web 程序在非常广泛的意义上“不会出错”。它们不仅不会在特定页面生成期间崩溃，而且它们也可能不会：
> 
> *   遭受任何类型的代码注入攻击
> *   返回无效的 HTML
> *   包含无效的应用程序内链接
> *   HTML 表单与其处理程序预期的字段不匹配
> *   包括对远程 Web 服务器提供的“AJAX”样式服务做出错误假设的客户端代码
> *   尝试无效的 SQL 查询
> *   在与 SQL 数据库或浏览器和 Web 服务器之间的通信中使用不正确的编组或解组

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T17:29:04.463

[另一个答案](https://stackoverflow.com/questions/64953/anyone-using-lisp-for-a-mysql-backended-web-app/78735#78735)中描述了一组替代的 Common Lisp 工具

# c# - DateTime 数据类型的问题

> ID：564303
> 
> 赞同：0
> 
> 时间：2009-02-19T07:41:28.470
> 
> 标签：c#, datetime

我对 DateTime 数据类型有疑问。通过一个文本框，我想添加人的出生日期。由于 C# 中没有日期数据类型，我被迫使用 DateTime 数据类型，但是在将 TxtDateofBirth 转换为 DateTime 时出现错误，“字符串未被识别为有效的 DateTime。” 这是我的转换代码。我将此代码保留在添加事件中。

```
DateTime dateofbirth = Convert.ToDateTime(TxtDateOfBirth.Text); 
```

我应该怎么办？

谢谢，

马苏姆

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T07:42:38.733

将 DateTime.ParseExact 与仅指定日期部分的格式字符串一起使用。

或者，由于这是用户输入，[`DateTime.TryParseExact`](http://msdn.microsoft.com/en-us/library/system.datetime.tryparseexact.aspx)因此如果用户输入了错误的日期，则无需捕获异常：

```
using System;

class Test
{
    static void Main()
    {
        TestParsing("24/10/2009");
        TestParsing("flibble");
    }

    static void TestParsing(string text)
    {
        DateTime dt;

        if (DateTime.TryParseExact(text, "d", null, 0, out dt))
        {
            Console.WriteLine("Parsed to {0}", dt);
        }
        else
        {
            Console.WriteLine("Bad date");
        }
    }
} 
```

请注意，格式字符串“d”表示“短日期格式”（请参阅​​ MSDN 中的[“标准日期和时间格式字符串”](http://msdn.microsoft.com/en-us/library/az4se3k1.aspx)和[“自定义日期和时间格式字符串”](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx)页面）。“null”意味着“使用当前的文化”——所以上面的内容在英国适用于我，但你需要在美国制作字符串“10/24/2009”。如果您不想使用线程的当前默认值，则可以指定特定的文化。0 表示默认的日期和时间样式。查看 MSDN 页面了解更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T07:57:52.677

或者，[使用掩码](http://msdn.microsoft.com/en-us/library/system.windows.forms.maskedtextbox.validatingtype.aspx)使用户只能输入有效日期。（请参阅给定链接示例下的 c# 部分）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T07:58:58.477

乔恩的答案几乎没有什么可以补充的，但在这种情况下，我想指出一点：

尝试了解您的问题不是因为 DateTime 数据类型，而是因为您的日期字符串与 DateTime 构造函数的预期格式（基于区域设置/线程文化）不匹配。

您说您“被迫”使用 DateTime 数据类型。您应该记住，应始终将日期视为日期。我见过太多的开发人员陷入使用日期作为字符串（并执行拆分/搜索操作）而不是使用 DateTime 的陷阱，因为他们觉得后者太复杂了。

# ruby-on-rails - 我是否需要手动为 HABTM 连接表创建迁移？

> ID：564306
> 
> 赞同：78
> 
> 时间：2009-02-19T07:41:45.913
> 
> 标签：ruby-on-rails

我现在正在努力让 HATBM 正常工作。我有一个被打败的scanario：文章和标签。我想，HABTM 应该在这里使用，因为它是多对多的关系。但是我不知道是否应该手动创建一个连接表（在这种情况下为articles_tags）。

我的代码目前如下：

```
class Article < ActiveRecord::Base
  has_and_belongs_to_many :tags  
end

class Tag < ActiveRecord::Base
  has_and_belongs_to_many :articles
end 
```

当我运行迁移时，没有创建第三个表。另外，我想补充一点，我的第三个表不包含任何域逻辑，只是盲目分配。

我正在使用 Rails 2.2.2

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2009-02-19T07:50:20.180

您应该在其中一个表的迁移中执行此操作，或者如果已运行这些迁移，则应在单独的迁移中执行此操作：

```
create_table :articles_tags, :id => false do |t|
  t.references :article, :tag
end

add_index :articles_tags, [:article_id, :tag_id] 
```

这将为您创建表，并`:id => false`告诉 Rails 不要向该表添加 id 字段。还有一个索引，它将加快此连接表的查找速度。

您还可以为此生成一个模型（ArticlesTag）并执行以下操作：

```
# article.rb
has_many :articles_tags
has_many :tags, :through => :articles_tags

# tag.rb
has_many :articles_tags
has_many :articles, :through => :articles_tags

# article_tag.rb
belongs_to :tag
belongs_to :article 
```

`script/generate model articles_tag`然后在调用生成的迁移中创建表。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-03-08T12:39:42.383

请注意，这已包含在 API 中。

[http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#method-i-has_and_belongs_to_many](http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#method-i-has_and_belongs_to_many)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-26T05:26:48.943

您可能还想为迁移添加索引：

add_index "articles_tags", "article_id"

add_index "articles_tags", "tag_id"

但是，如果您想要标记功能，我建议您使用acts_as_taggable_on rails 插件：

[http://www.intridea.com/tag/acts_as_taggable_on](http://www.intridea.com/tag/acts_as_taggable_on) [http://github.com/mbleigh/acts-as-taggable-on/](http://github.com/mbleigh/acts-as-taggable-on/)

我在一个项目中使用过它，它很容易实现。

用于标记的连接表的一个问题是，为您希望使其可标记的每种内容类型（即，comments_tags、posts_tags、images_tags 等）创建一个连接表很容易变得难看。该插件使用包含鉴别器的标记表来确定内容类型，而无需为每种类型提供特定的连接表。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-19T14:35:57.530

结合这个 Qeuestion(1st answear) [How to set up atypical users HABTM roles relationship](https://stackoverflow.com/questions/6689540/how-to-set-up-a-typical-users-habtm-roles-relationship)和 1st answear from here，连猴子都懂。我是 RoR 的新手，它的工作就像一个魅力

# database - 我应该使用数字还是电子邮件 ID 来识别网站上的用户？

> ID：564310
> 
> 赞同：3
> 
> 时间：2009-02-19T07:43:04.613
> 
> 标签：database, database-design

我有一个网络应用程序，我根据他们的电子邮件 ID 注册用户。

从设计/易用性/灵活性的角度来看，我应该为每个用户分配一个唯一编号还是根据 emailid 识别用户？

分配唯一编号的优点：

1.  我可以在以后更改登录本身而不会丢失用户的数据（灵活）。

坏处：

1.  使用 sql 命令行时我必须处理数字（容易出错）。

哪个更好？您是否看到任何其他方案需要考虑的其他问题？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-19T08:21:53.163

您的用户的身份应该是唯一且不可变的。选择电子邮件地址作为身份并不是一个好主意，原因如下：

*   电子邮件是用户身份的一个方面，可以随时更改。
*   您可能决定允许多封电子邮件。
*   您可能决定添加其他方面，例如 OpenID 或 Live ID，甚至只是旧的普通用户名。
*   允许多个身份共享同一个电子邮件方面没有任何问题。这是一种罕见的情况，但并非闻所未闻。
*   规范化电子邮件地址很困难且容易出错，因此您可能会遇到强制唯一性的问题。（电子邮件地址是否区分大小写？您会忽略电子邮件内部的 . 或 + 吗？您如何比较非英语电子邮件？）

顺便说一句，使用电子邮件作为用户身份的公开表示可能是一个安全和隐私问题。特别是如果您的一些用户未满 13 岁。对于用户身份，您将需要一个不同的公共方面。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-19T07:49:30.043

两者都用。您必须添加一个 id，因为您真的不希望其他表使用电子邮件地址作为外键。使电子邮件地址唯一，以便您仍然可以使用它来通过 sql 命令行识别用户。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T07:58:25.233

唯一号码 - 总是！但请对用户隐藏该号码。

应该允许用户更改他们的电子邮件。如果将其用作主要标识符，则在多个表中使用该键时可能会导致很多复杂情况。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T07:54:07.147

你的劣势不是劣势。在 sql 中使用数字并不比使用电子邮件或其他任何事情更成问题。

另一方面，您的优势非常强大，您可能希望将用户彼此关联，将不同的电子邮件与一个用户帐户关联，等等，并且始终使用电子邮件会使事情变得更加困难。

还要考虑包括用户标识在内的 url，在那里处理 ID 比您必须考虑正确 url endocing 的电子邮件要容易得多。

因此，为了灵活性和易用性，我强烈推荐一个唯一的用户 ID。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T07:57:41.070

除了用户电子邮件地址之外，您应该有另一个标识符，该标识符对用户不可见并且永远不会更改。然后，您应该强制电子邮件地址的唯一性，以便它可以用作候选键。

您会发现用户会想要更改他们的电子邮件地址，或者他们可以看到的任何东西，因此您应该拥有一个无法更改的标识符作为良好的做法。

处理 sql 命令对象中的数字实际上不会比使用实际的电子邮件地址更容易出错，如果有的话，我认为它更不容易出错。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T07:54:39.547

只是需要考虑的几点。

*   您将如何验证电子邮件地址？
*   你如何确保它真的是独一无二的（我并不总是使用我的真实地址 egmmouse at disney.com
*   我喜欢使用数据库生成的唯一键来识别记录，然后分别添加我无法控制的属性
*   一个人的电子邮件可以更改，但 id 不会

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-01-08T01:05:29.857

唯一编号。除了确定的原因之外，我认为它比使用电子邮件地址*更不*容易出错。更短，没有有趣的字符，更容易验证等。

# jquery - 使用 jQuery 提取列表的 ID 名称

> ID：564312
> 
> 赞同：0
> 
> 时间：2009-02-19T07:43:07.517
> 
> 标签：jquery, list

我正在使用 jQuery，我需要提取列表的 ID 名称。

```
<ul id="nav">
    <li id="outer1m"><a href="#url"><b class="">outer1</b></a></li>
    <li id="outer2m"><a href="#url"><b class="">outer2</b></a></li>

    <li id="outer3m"><a href="#url"><b class="">outer3  </b></a>
        <ul style="display: none;">
            <li id="sub1"><a href="#url">inner1</a></li>
            <li id="sub2"><a href="#url">inner2</a></li>
            <li id="sub3"><a href="#url">inner3</a></li>
        </ul>
    </li>

    <li id="outer4m"><a href="#url"><b class="">outer4</b></a>
        <ul style="display: none;">
            <li id="sub8"><a href="#url"><i class="">inner4 </i></a></li>
            <li id="sub9"><a href="#url"><i class=""> inner5</i></a></li>
        </ul>
    </li>
</ul> 
```

### 我的代码

```
$("li ").click(function()
{
    if ($(this).is("[id ^='sub']")) {
        var current_id=$(this).attr('id');
        alert(current_id);
    }
}); 
```

此代码有助于在单击期间提醒内部列表，例如 sub1、sub2 等。如何提醒外部 IDS？

单击时，当我尝试将上述代码检查到外部时，它还会提醒子 ID 名称。什么是优化的程序？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T07:45:31.300

```
var parent_id=$(this).parent().parent().attr('id'); 
```

这很丑陋，但我知道的唯一方法是遍历树。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T08:27:17.753

你想要做的是向上遍历 parent() 树到最后一个——这就是我的做法：

```
$("li").click(function(){
    if($(this).is("[id^='sub']")){
        var all_ul_parents = [];
        // get parents which are uls, and put each id in an array
        $(this).parents().filter('ul').each(function(){
            all_ul_parents.push($(this).attr('id'));
        });
        // the final one added will be highest level ul parent
        current_id = all_ul_parents.pop();
        alert(current_id);
    }   
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T09:48:35.403

尝试：

```
$(this).parents('ul:last').attr('id') 
```

# visual-studio - 将 Visual Studio 安装从“只为我”升级到“所有人”

> ID：564317
> 
> 赞同：2
> 
> 时间：2009-02-19T07:45:34.750
> 
> 标签：visual-studio, installation

我正在使用 Visual Studio 安装工具包为我的产品创建 msi。我发现了一个问题 - 我过去使用“Just For Me”选项安装了该产品，现在我想升级并将其更改为“Everyone”。在升级结束时，我可以在“添加/删除程序”中看到我的产品有两条线。有谁知道如何解决它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T08:31:32.203

通常，“Just Me”和“Everyone”之间的唯一区别是创建的快捷方式的位置。

如果您右键单击开始按钮并选择“探索”，您应该能够将“Visual Studio”程序组从用户开始菜单文件夹拖到所有用户开始菜单。

（不在 Windows atm 上，所以恐怕我无法给出准确的方向！）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-15T11:19:27.990

每个安装对于“每个人”和“只有我”选项都是唯一的。您可能需要先卸载旧版本才能解决此问题。没有可用的现有安装的自动升级。

如果您在早期的安装程序中提到了版本号。**然后，您可以通过在新版本中将“ RemovePreviousVersion** ”属性设置为“ **true** ”来选择使用删除早期版本。

# .net - .Net 中的 DLast 等效项

> ID：564318
> 
> 赞同：1
> 
> 时间：2009-02-19T07:46:13.437
> 
> 标签：.net, ms-access, vba

在 Microsoft Access 中，有一个[DLast](http://www.techonthenet.com/access/functions/domain/dlast.php)函数，它从指定的记录集中返回最后一个值的应用程序键。我想知道 .Net 中 DLast 的等价物是什么，它使我能够检索上一次插入的主键？

我正在使用通过 OLEDBConnection 访问

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T07:50:35.157

您如何比较 Access 和 .NET？如果您想在 SQL 中表达相同的内容，对于这些：

```
DLast("UnitPrice", "Order Details", "OrderID = 10248") 
```

它会像

```
select top 1 UnitPrice 
    from OrderDetails 
    where OrderID = 10248 
    order by UnitPrice desc 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T07:53:02.437

您使用的是哪个数据库？是否通过 OLEDB 连接访问？在这种情况下，您可以在这样的查询中运行 DLast 函数：

```
SELECT DLast("COLUMNNAME","TABLENAME","WHERE CLAUSE"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T07:52:28.007

我认为这取决于您的数据库系统，而不是您的开发框架（例如.NET）。

对于 SQL Server，请查看[@@Identity](http://msdn.microsoft.com/en-us/library/ms187342.aspx)系统函数。

# multithreading - 实现线程安全

> ID：564319
> 
> 赞同：19
> 
> 时间：2009-02-19T07:46:23.513
> 
> 标签：multithreading, delphi, synchronization, thread-safety

**问题**如何确保我的应用程序是线程安全的？他们有什么常见的做法、测试方法、要避免的事情、要寻找的事情吗？

**背景**我目前正在开发一个服务器应用程序，它在不同的线程中执行许多后台任务，并使用 Indy 与客户端通信（使用另一组自动生成的线程进行通信）。由于应用程序应该是高度可用的，程序崩溃是一件非常糟糕的事情，我想确保应用程序是线程安全的。无论如何，我不时发现一段代码会引发以前从未发生过的异常，并且在大多数情况下，我意识到这是某种同步错误，我忘记正确同步我的对象。因此，我提出了关于最佳实践、线程安全测试等问题的问题。

mghie：谢谢你的回答！我也许应该更精确一点。为了清楚起见，我了解多线程的原理，我在整个程序中使用同步（监视器），并且我知道如何区分线程问题和其他实现问题。但是，尽管如此，我还是时不时忘记添加适当的同步。举个例子，我在代码中使用了 RTL 排序函数。看起来像

```
FKeyList.Sort (CompareKeysFunc); 
```

事实证明，我必须在排序时同步 FKeyList。最初编写那行简单的代码时，我并没有想到它。我想谈的就是这些。哪些地方容易忘记添加同步代码？您如何确保在所有重要位置添加了同步代码？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-19T08:03:25.283

您无法真正测试线程安全性。您所能做的就是证明您的代码不是线程安全的，但是如果您知道如何做到这一点，那么您已经知道在程序中要做什么来修复该特定错误。问题在于您不知道的错误，您将如何为这些错误编写测试？除此之外，线程问题比其他问题更难发现，因为调试行为已经可以改变程序的行为。从一个程序运行到下一个程序，从一台机器到另一台机器，情况会有所不同。CPU 和 CPU 内核的数量、并行运行的程序的数量和种类、程序中发生的事情的确切顺序和时间——所有这些以及更多都会对程序行为产生影响。[我实际上想将月相之类的东西添加到这个列表中，

我的建议是不要将其视为实现问题，而应开始将其视为程序设计问题。你需要学习和阅读所有你能找到的关于多线程的东西，不管它是不是为 Delphi 编写的。最后，您需要了解基本原理并将其正确应用到您的编程中。诸如临界区、互斥体、条件和线程之类的原语是操作系统提供的，大多数语言只将它们包装在它们的库中（这忽略了诸如 Erlang 提供的绿色线程之类的东西，但这是一个很好的起点）。

我会说从[关于线程的维基百科文章](http://en.wikipedia.org/wiki/Thread_(computer_science))开始，然后通过链接的文章开始工作。我从Aaron Cohen 和 Mike Woodring 的[“Win32 多线程编程”](http://www.oreilly.de/catalog/9781565922969/)一书开始——它已经绝版，但也许你可以找到类似的东西。

**编辑：**让我简要跟进您编辑的问题。所有对非只读数据的访问都需要正确同步才能线程安全，并且对列表进行排序不是只读操作。因此，显然需要围绕对列表的所有访问添加同步。

但是随着系统中的内核越来越多，持续锁定将限制可以完成的工作量，因此寻找一种不同的方式来设计程序是一个好主意。一个想法是在程序中引入尽可能多的只读数据——不再需要锁定，因为所有访问都是只读的。

我发现接口在设计多线程程序时非常有用。接口可以实现为只有对内部数据进行只读访问的方法，如果你坚持使用它们，你可以非常确定很多潜在的编程错误不会发生。您可以在线程之间自由共享它们，并且线程安全的引用计数将确保当对它们的最后一个引用超出范围或被分配另一个值时，它们被正确释放。

您所做的是创建从 TInterfacedObject 派生的对象。它们实现了一个或多个接口，这些接口都只提供对对象内部的只读访问，但它们也可以提供改变对象状态的公共方法。创建对象时，您同时保留对象类型的变量和接口指针变量。这样生命周期管理很容易，因为当异常发生时对象会被自动删除。您使用指向对象的变量来调用正确设置对象所需的所有方法。这会改变内部状态，但由于这只发生在活动线程中，因此没有潜在的冲突。正确设置对象后，您将接口指针返回给调用代码，并且由于除了通过接口指针之外没有其他方法可以访问该对象，因此您可以确定只能执行只读访问。通过使用这种技术，您可以完全消除对象内部的锁定。

如果你需要改变对象的状态怎么办？你没有，你通过从接口复制数据来创建一个新对象，然后改变新对象的内部状态。最后，您将引用指针返回到新对象。

通过使用它，您只需要锁定获取或设置此类接口的位置。通过使用原子交换函数，它甚至可以在没有锁定的情况下完成。有关设置接口指针的类似用例，请参阅Primoz Gabrijelcic 的[这篇博客文章。](http://17slon.com/blogs/gabr/2009/02/hassle-free-critical-section.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T09:30:18.477

很简单：不要使用共享数据。每次访问共享数据时，您都有可能遇到问题（如果您忘记同步访问）。更糟糕的是，每次访问共享数据时，您都有可能阻塞其他线程，这会损害您的并行化。

我知道这个建议并不总是适用的。尽管如此，如果您尝试尽可能多地遵循它并没有什么坏处。

编辑：对 Smasher 评论的更长回应。不适合评论:(

你是完全正确的。这就是为什么我喜欢在只读线程中保留主要数据的卷影副本。我在结构中添加了一个版本控制（一个 4 对齐的 DWORD），并在（受锁保护的）数据写入器中增加了这个版本。数据读取器将比较全局版本和私有版本（可以在没有锁定的情况下完成），并且只有当它们不同时才会锁定结构，将其复制到本地存储，更新本地版本并解锁。然后它将访问结构的本地副本。如果阅读是访问结构的主要方式，则效果很好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T08:20:32.807

我会同意 mghie 的建议：设计了线程安全性。您可以在任何地方阅读它。

要深入了解它是如何实现的，请查找有关实时操作系统内核内部结构的书。一个很好的例子是Jean J. Labrosse 的[**MicroC/OS-II: The Real Time Kernel**](http://www.amazon.com/gp/search?index=books&linkCode=qs&keywords=1578201039)，它包含工作内核的完整注释源代码，以及关于为什么事情会以这种方式完成的讨论。

**编辑**：鉴于改进的问题侧重于使用 RTL 功能......

任何可以被多个线程看到的对象都是潜在的同步问题。线程安全对象在每个方法的实现中都会遵循一致的模式，在方法的持续时间内锁定对象状态的“足够”，或者可能会缩小到“足够长”。当然，对对象状态的任何部分的任何读-修改-写序列都必须相对于其他线程以原子方式完成。

艺术在于弄清楚如何完成有用的工作，而不会出现死锁或造成执行瓶颈。

至于发现这样的问题，测试并不能保证。可以修复测试中出现的问题。但是为线程安全编写单元测试或回归测试是极其困难的......所以面对现有的代码体，你可能的求助是不断的代码审查，直到线程安全的实践成为第二天性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T18:01:05.777

正如人们所提到的，我想你知道，一般来说，确定你的代码是线程安全的是不可能的（我相信证明是不可能的，但我必须追查这个定理）。*自然，您想让事情变得比这更容易。*

我尝试做的是：

*   **使用已知的多线程设计模式**：[线程池](http://en.wikipedia.org/wiki/Thread_pool_pattern)、[actor 模型范例](http://en.wikipedia.org/wiki/Actor_model)、[命令模式](http://www.ddj.com/database/184416612)或一些此类方法。这样，同步过程在整个应用程序中以相同的方式*以统一的方式发生。*
*   **限制和集中同步点**。编写您的代码，以便您需要在尽可能少的地方进行同步，并将同步代码保留在代码中的一个或几个地方。
*   编写同步代码，以便在进入和退出警卫时**，值之间的逻辑关系是清晰的。**我为此使用了很多断言（您的环境可能会限制这一点）。
*   **Don't ever access shared variables without guards/synchronization**. *Be very clear what your shared data is.* (I've heard there are paradigms for guardless multithreaded programming but that would require even more research).
*   Write your code as cleanly, clearly and DRY-ly as possible.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T09:58:02.090

我的简单答案与这些答案相结合是：

*   使用线程安全方式创建您的应用程序/程序
*   避免在所有地方使用公共静态变量

因此，它通常很容易陷入这种习惯/习惯，但需要一些时间来习惯：

用函数式编程语言（例如 F#）甚至使用 Scheme 或 Haskell 对您的逻辑（而不是 UI）进行编程。函数式编程也促进了线程安全实践，同时它也警告我们在函数式编程中始终保持纯洁性。如果您使用 F#，那么使用可变或不可变对象（例如变量）也有明显的区别。

* * *

由于方法（或简单的函数）是 F# 和 Haskell 中的一等公民，因此您编写的代码也将更加严格地朝向不那么可变的状态。

同样使用通常可以在这些函数式语言中找到的惰性求值风格，您可以确保您的程序不受副作用影响，并且您还会意识到，如果您的代码需要效果，您必须明确定义它。如果考虑了副作用，那么您的代码将准备好利用代码中组件内的可组合性和多核编程。

# java - 您可以在 if 子句中存储变量吗？

> ID：564320
> 
> 赞同：20
> 
> 时间：2009-02-19T07:47:04.027
> 
> 标签：java, if-statement, initialization

我有点等待这个问题的“不”回答。

如果您在 if 子句中检查变量时是否可以同时保存变量，我很感兴趣。

假设我有这个代码。

```
if(foo!=null){
  if(foo.getBar()!=null){
    Bar bar = foo.getBar();
    System.out.println("Success: " + bar);
  } else {
    System.out.println("Failure.");
  }
} else {
  System.out.println("Failure.");
} 
```

我现在独立处理“失败”状态，即使结果相同。我可以像这样把它们放在一起：

```
if(foo!=null && foo.getBar()!=null){
  Bar bar = foo.getBar();
  System.out.println("Success: " + bar);
} else {
  System.out.println("Failure.");
} 
```

已经更整洁的代码了。如果 foo 为空，它将停在那里并且不会尝试 foo.getBar（在 if 中），所以我不会得到 NPE。我想增强的最后一件事，也是主要问题：我真的两次调用 foo.getBar() 吗？如果 getBar() 是一个非常繁重的操作，那么摆脱第二个相同的调用会很好。所以我想知道是否有可能做一些与此类似的事情：

```
if(foo!=null && (Bar bar = foo.getBar())!=null){
  Bar bar = foo.getBar();
  System.out.println("Success: " + bar);
} else {
  System.out.println("Failure.");
} 
```

如果我愿意的话，我必须把它分成两个不同的 if's again

```
Bar bar = foo.getBar();
if (bar!=null) ... 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-19T07:53:21.017

这是你能得到的最接近的：

```
Bar bar;
if(foo!=null && (bar = foo.getBar())!=null){
  System.out.println("Success: " + bar);
} else {
  System.out.println("Failiure.");
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-19T07:52:01.177

我在从 BufferedReader 遍历行时使用了该技术：

```
BufferedReader br = // create reader
String line
while ((line = br.readLine()) != null) {
    // process the line
} 
```

所以是的，你可以做一个赋值，结果就是左边的变量，然后你可以检查它。但是，在测试中声明变量是不合法的，因为它们只会被限定为该表达式。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-19T08:07:50.700

如果您想限制 Bar bar 的范围，我会在 Michael 发布的代码周围添加 { 和 }。

```
无效的富（）
{
    // 一些代码...

    // 这个块限制了“Bar bar”的范围，使得该方法的其余部分看不到
    // 它。
    {
        酒吧酒吧；
        if(foo!=null && (bar = foo.getBar())!=null){
            System.out.println("成功：" + bar);
        } 别的 {
            System.out.println("失败。");
        }
    }
}

```

如果有意义，您可能还想检查空对象模式。如果可以的话，我个人会尽量避免事情为空……真的要考虑是否要允许空值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T10:34:25.077

来自“我的编程语言比你的编程语言更好”部门：在[Groovy](http://groovy.codehaus.org/)中，您可以使用“？”。操作员：

```
Bar bar = foo?.bar
if (bar != null) {
} 
```

在 Java 中，这是一个很好的模式（*）：

```
Bar bar = foo == null ? null : foo.getBar();
if (bar != null) {
} 
```

*：您可以保存在指尖的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T13:06:08.317

完全无法回答问题的三点：

`null`是邪恶的。不要编写返回它的方法。然后，您的示例问题将消失。

我认为您可能会错过封装。而不是可以使您执行“告诉不要问”操作`foo.getBar()`的界面？`foo`

表达式中的副作用往往会导致错误的代码。喜欢更多、更简单的线条而不是更少、错误的线条。`++`如果在访问缓冲区或类似的迭代器样式算法时使用增加索引，则通常的例外情况。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-03-22T14:02:27.233

实际上我认为这是一种使用 Java Optional 的方法，这里有一个例子：

```
Optional.ofNullable("text").ifPresent( $0 -> {
  System.out.println($0.toUpperCase());
}); 
```

或者在你的情况下：

```
 if(foo != null){
      Optional.ofNullable(foo.getBar()).ifPresent(bar -> {
          System.out.println("Success: " + bar);
      });
  } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-07-21T22:59:00.780

您不能在 Java 条件中声明变量，但可以在`for`循环中：

```
for (Bar bar = (null != foo) ? foo.getBar() : null; bar != null;) {
    System.out.println("Success: " + bar);
    break;
} 
```

但这并不漂亮。我完全同意汤姆霍廷的评论。

# linux - 在linux上展开文件

> ID：564321
> 
> 赞同：0
> 
> 时间：2009-02-19T07:47:55.990
> 
> 标签：linux, file, folding

我有一个巨大的文本文件，在 liux 上大约有 400.000 行 80 个字符宽。

需要“展开”文件，将四行合并为一行，最终有 1/4 行，每行 80*4 字符长。

有什么建议么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-19T07:57:06.267

```
perl -pe 'chomp if (++$i % 4);' 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T07:57:34.657

我希望我正确理解了你的问题。您有这样的输入行（除了您的行更长）：

```
abcdef
ghijkl
mnopqr
stuvwx
yz0123
456789
ABCDEF 
```

你想要这样的输出：

```
abcdefghijklmnopqrstuvwx
yz0123456789ABCDEF 
```

以下 awk 程序应该这样做：

```
{ line = line $0 }
(NR % 4) == 0 { print line; line = "" }
END { if (line != "") print line } 
```

像这样运行它：

```
awk -f merge.awk data.txt 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T14:30:26.070

使用 awk 更简单的方法是：

```
awk '{ printf $0 } (NR % 4 == 0) { print }' filename 
```

虽然如果你想防止在没有尾随换行符的情况下结束，它会变得有点复杂：

```
awk '{ printf $0 } (NR % 4 == 0) { print } END { if (NR % 4 != 0) print }' filename 
```

# wcf - 如何处理 wcf 服务同步？

> ID：564326
> 
> 赞同：1
> 
> 时间：2009-02-19T07:50:06.873
> 
> 标签：wcf, synchronization

我已经实现了一个 wcf 服务，现在，我的客户希望它拥有它的三个副本，在不同的机器上独立工作。主从方式。我需要找到一个可以启用行为的解决方案：

第一个实例化的服务“询问”另外两个“他们是否还活着？” - 如果不是，那么它就成为一个主人，并且它是在网络上活跃的那个。另外两个，一旦实例化，看到已经有一个主人活着，所以他们成为奴隶并开始睡觉。需要有一些机制来定期检查 master 是否没有死，如果是，则选择下一个活着的副本成为 master（直到它分别死亡）

我认为这应该是一种架构模式，所以我很乐意得到任何建议。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T08:21:00.310

我建议查看 WCF 对等通道 (System.Net.PeerToPeer) 以帮助每个节点了解其他节点。这是一个提供不错介绍的[链接。](http://msdn.microsoft.com/en-us/library/cc297274.aspx)

至于确定哪个节点应该是主节点，诀窍将是如果两个或多个节点大约同时上线，则协商哪个节点应该是主节点。一旦节点相互了解，就需要一些确定性机制来建立主节点。例如，您可以使用最早的创建时间、每个节点 IP 地址的最后一个八位字节的最小值，或者其他任何东西。您只需要定义一些允许节点自动协商的方案。

最后，至于检查主人是否还活着，我建议使用[这里](http://msdn.microsoft.com/en-us/magazine/cc163537.aspx)描述的基于事件的机制。主节点可以发送其他节点注册的周期性健康和状态事件。我会在代码入口点放置一个 try/catch/finally 块，这样如果主服务器崩溃，它可以发布一个最终的 MasterClosing 事件，让从服务器知道它正在消失。这不考虑系统崩溃，例如电源故障等。要处理此问题，请在从站中提供超时，以便当超时到期时，从站可以查询主站以查看它是否仍然存在。如果没有，奴隶可以使用您的确定性算法在他们之间协商谁应该成为下一个主人。

# emacs - 为什么 Emacs 的“downcase”函数会拒绝进行 downcase？

> ID：564332
> 
> 赞同：0
> 
> 时间：2009-02-19T07:52:48.913
> 
> 标签：emacs, elisp

我正在尝试编写简单的 Emacs 函数来在 C 样式和 camelCase 之间转换 id（即 c_style <-> cStyle）。但是出于某种原因，Emacs 内置`downcase`函数使这个词保持原样。`M-x downcase-word`工作正常，所以我完全迷路了。欢迎任何想法。

```
(defun toggle-id-style ()
  "Toggle between C-style ids and camel Case ones (i.e. c_style_id -> cStyleId and  back)."
  (interactive)
    (save-excursion
      (progn
        (re-search-forward "[^A-Za-z0-9_]" nil t)
          (let ((end (point))
            (case-fold-search nil))
            (progn
              (re-search-backward "[^A-Za-z0-9_]" nil t)
              (let* ((cstyle (if (string-match "_" (buffer-substring-no-properties (point) end)) t nil))
                     (regexp (if cstyle "_\\(\\w+\\)" "\\([A-Z][a-z0-9]+\\)") )
                     (func (if cstyle 'capitalize (lambda (s) (concat "_" (downcase s) ) ))))
             (progn
                   (while (re-search-forward regexp end t)
                     (replace-match (funcall func (match-string 1)) nil nil)))))))))

;;M-x replace-regexp _\(\w+\) -> \,(capitalize \1) ;; c_style -> cStyle
;;M-x replace-regexp \([A-Z][a-z0-9]+\) -> _\,(downcase \1) ;;cStyle -> c_style 
```

如果我转换它工作正常，`c_style`但是当我尝试转换时，`cStyle`我得到了`c_Style`结果。是的，我已经检查过这是由于`downcase`行为造成的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T12:41:06.410

您的问题是`replace-match`. 从文档中：

> ```
> 如果第二个 arg 固定大小写不为零，则不要更改替换文本的大小写。
> 否则可能将整个文本大写，或者只是单词首字母，
> 基于替换的文本。
> 如果被替换的文本只有大写字母
> 并且至少有一个多字母单词，将 newtext 转换为全部大写。
> 否则，如果替换文本中的所有单词都大写，
> 将 newtext 中的每个单词大写。
> 
> ```

您正在传递参数，当被替换的文本大写时，这会导致`nil`替换大写。而是通过，这部分代码将起作用。`fixedcase``replace-match``t`

我对您的代码有两个一般性评论。

1.  你所有的使用`progn`都是不必要的。的主体`save-excursion`是隐含的，和的主体也是`progn`如此。`let``let*`

2.  您向前搜索然后向后搜索以尝试找到点下方符号的边界。Emacs 已经有一个`thingatpt`库可以在该点或附近找到东西。在您的情况下，您可以调用`(bounds-of-thing-at-point 'symbol)`which 返回一个 cons 单元格`(START . END)`，给出找到的符号的开始和结束位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:33:35.990

我认为您需要替换匹配的第二个参数为 t 而不是 nil。

# c# - C#：在 KeyDown 事件中，我应该使用什么来检查哪个键被按下？

> ID：564338
> 
> 赞同：5
> 
> 时间：2009-02-19T07:54:24.913
> 
> 标签：c#, keyboard

在 KeyDown 事件中，我可以使用 KeyEventArgs。它具有（除其他外）以下三个属性：

*   `e.KeyCode`
*   `e.KeyData`
*   `e.KeyValue`

我应该使用哪一个？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-19T08:00:04.887

**编辑：**不知何故，我误读了您的问题，包括检查有效字符。你修改了吗？我已经添加了每个的描述。

*   **KeyCode**是关闭的键的[Keys](http://msdn.microsoft.com/en-us/library/system.windows.forms.keys.aspx)枚举值
*   **KeyData**与 KeyCode 相同，但与任何 SHIFT/CTRL/ALT 键组合
*   **KeyValue**只是 KeyCode 的整数表示

如果您*只*需要角色，我可能会建议使用 KeyPress 事件并使用[KeyPressEventArgs](http://msdn.microsoft.com/en-us/library/system.windows.forms.keypresseventargs.aspx)。[KeyChar](http://msdn.microsoft.com/en-us/library/system.windows.forms.keypresseventargs.keychar.aspx)属性。然后，您可以使用[Char.IsLetterOrDigit()](http://msdn.microsoft.com/en-us/library/system.char.aspx)来确定它是否是有效字符。

或者，您可以将[KeyEventArgs.KeyCode](http://msdn.microsoft.com/en-us/library/system.windows.forms.keyeventargs.keycode.aspx)转换为 char，然后在其上使用 Char.IsLetterOrDigit。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T08:06:59.300

我建议使用该`KeyCode`属性来检查`Keys`大多数操作的枚举。然而，下面的一些基本区别可能会帮助您更好地决定您需要哪一个来适应您的情况。

差异：

*   `KeyCode`- 表示`Keys`表示当前处于 Down 状态的键的枚举值。

*   `KeyData`- 与 相同`KeyCode`，只是它具有修饰符形式的附加信息 - Shift/Ctrl/Alt 等。

*   `KeyValue`- 的数值`KeyCode`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T08:18:04.360

非常基本的 KeyDown 使用

```
 private void tbSomeText_KeyDown (object sender, KeyEventArgs e)
    {
        if (e.KeyCode == Keys.B && e.Modifiers != Keys.Shift) {

            MessageBox.Show("You Pressed b");
        }
        else if (e.KeyCode == Keys.A && e.Modifiers == Keys.Shift) {
            MessageBox.Show("You Pressed Shift+A");
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T08:30:05.187

请参阅[我](https://stackoverflow.com/questions/564358/c-activate-a-textbox-when-user-starts-typing/564387#564387)对您[其他问题](https://stackoverflow.com/questions/564358/c-activate-a-textbox-when-user-starts-typing)的回答：

使用[KeyPressed](https://stackoverflow.com/questions/564358/c-activate-a-textbox-when-user-starts-typing)事件。

引用 MSDN：

> KeyPressEventArgs 指定用户按下某个键时所组成的字符。例如，当用户按下 SHIFT + K 时，KeyChar 属性返回一个大写的 K。

这样你就不需要弄乱`e.KeyCode`, `e.KeyData`和 `e.KeyValue`。

# javascript - 从 Greasemonkey 调用 jQuery UI 对话框时抛出错误

> ID：564342
> 
> 赞同：2
> 
> 时间：2009-02-19T07:57:36.450
> 
> 标签：javascript, jquery, greasemonkey

每当我尝试从 Greasemonkey 创建一个对话框时，我都会遇到这个尴尬的错误......我相信这与 XPCNativeWrapper [https://developer.mozilla.org/en/XPCNativeWrapper#Limitations_of_XPCNativeWrapper](https://developer.mozilla.org/en/XPCNativeWrapper#Limitations_of_XPCNativeWrapper)的限制有关 ，尽管我是不是100%确定。

我使用的核心 jQuery 方法都没有导致错误（append、css、submit、keydown、each、...）。

这可能是 Greasemonkey 中的错误，或者是由于 Greasemonkey 和 jquery ui 之间的交互，但我真的很想弄清楚如何让它们一起工作。

```
// ==UserScript==
// @name           Dialog Test
// @namespace      http://strd6.com
// @description    jquery-ui-1.6rc6 Dialog Test
// @include        *
//
// @require        http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js
// @require        http://strd6.com/stuff/jqui/jquery-ui-personalized-1.6rc6.min.js

// ==/UserScript==

$(document).ready(function() {
 $('<div title="Test">SomeText</div>').dialog();
}); 
```

错误：[异常...“组件不可用”nsresult：“0x80040111（NS_ERROR_NOT_AVAILABLE）”位置：“JS 框架 :: file:///home/daniel/.mozilla/firefox/.../components/greasemonkey. js :: 匿名 :: 第 347 行”数据：否] [打破此错误] if (line) {

Firefox 版本：Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.6) Gecko/2009020911 Ubuntu/8.04 (hardy) Firefox/3.0.6

更新：标准 jQuery 库中的 focus() 方法也会抛出相同的错误：

```
$('body').focus(); 
```

也许 UI 在某个时候调用了 focus 方法？

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-11-06T19:23:46.627

这个线程已经很老了，但是将 Greasemonkey 与 Jquery 一起使用到 focus() 的方法是将 [0] 添加到 jquery 对象以将其转回 DOM 元素。

```
 //Example:  
      $('#obj').focus();                          //Does not work
      document.getElementById('obj').focus();     //Works

      //Hybrid:
      $(#obj)[0].focus();                         //Work around 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T04:23:03.090

这是一种解决方法，但还涉及其他不那么引人注目的问题。

```
// ==UserScript==
// @name           Dialog Test
// @namespace      http://strd6.com
// @description    jquery-ui-1.6rc6 Dialog Test
// @include        *
//
// @resource       jQuery               http://ajax.googleapis.com/ajax/libs/jquery/1.3.1/jquery.min.js
// @resource       jQueryUI             http://strd6.com/stuff/jqui/jquery-ui-personalized-1.6rc6.min.js

// ==/UserScript==

// Inject jQuery into page... gross hack... for now...
(function() {
  var head = document.getElementsByTagName('head')[0];

  var script = document.createElement('script');
  script.type = 'text/javascript';

  var jQuery = GM_getResourceText('jQuery');
  var jQueryUI = GM_getResourceText('jQueryUI');

  script.innerHTML = jQuery + jQueryUI;
  head.appendChild(script);

  $ = unsafeWindow.$;
})();

$(document).ready(function() {
  $('<div title="Test">SomeText</div>').dialog();
}); 
```

现在的问题源于 $ 处于 unsafeWindow 上下文中，因此无法从不安全上下文中调用某些 GM 方法（例如在 $.each 中时的 GM_getValue）。必须有一种方法来解决这个问题，并让 jQueryUI 在 Greasemonkey 中工作。我 90% 确定这是 XPCNativeWrapper 问题，因此应该有一个简单的解决方法，即更改对话框插件中的一些代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-27T03:24:18.783

不是直接回答，而是：

如果您没有与 Greasemonkey 结婚，但想要在 Firefox 中实现良好的 jQuery 集成和类似 Greasemonkey 的功能，您应该查看[Mozilla Ubiquity](https://wiki.mozilla.org/Labs/Ubiquity)。它内置了 jQuery，可以很好地访问浏览器窗口，从任意位置加载内容的相对自由度，每页加载执行选项（a la Greasemonkey），外部脚本加载器（这就是我会去尝试加载 jQuery UI..) 和一堆其他非常酷的东西。我发现在几分钟内玩游戏和运行起来比搞乱 GM / Firefox 插件的怪异要容易得多。

# xaml - “非侵入式代码隐藏”是好还是坏的做法？

> ID：564353
> 
> 赞同：4
> 
> 时间：2009-02-19T08:01:35.990
> 
> 标签：xaml, code-behind

我有点惊讶的是，在学习 WPF/XAML/Silverlight 时，我遇到的几乎所有 XAML/C# 示例在 XAML 中都有“单击”事件，而在 Window 或 Page 构造函数中却很少。

由于这些天都强调“非侵入式 Javascript”，我认为更多的开发人员实际上会像这样构建他们的 XAML/代码隐藏：

**XAML：**

```
<Grid>
    <Button x:Name="btnEdit"/>
</Grid> 
```

**后面的代码：**

```
public Window1()
{
    InitializeComponent();

    btnEdit.Content = "Edit";
    btnEdit.Click += new RoutedEventHandler(btnEdit_Click);
}

private void btnEdit_Click(object sender, RoutedEventArgs e)
{
    btnEdit.Content = "This button was clicked.";
} 
```

关于为什么这是一个好的或坏的做法有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T08:58:19.770

大多数较小的 WPF 示例只给人一种印象，*而不*关注设计问题或良好风格。

在现实世界的应用程序中，XAML 应该只用于声明式编程。例如，将命令绑定到按钮或声明数据绑定。Karl Shifflett 有一些关于[MVVM](http://karlshifflett.wordpress.com/mvvm/)模式的精彩文章，它很好地分离了 WPF/Silverlight 应用程序的关注点。

在我看来，后面的代码只适用于小型应用程序。它倾向于混合视图、控制和数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T08:43:19.820

如果我没记错的话，我认为有一个部分类实现了上面的 Init 代码，它是由 Visual Studio 生成的代码。我不能代表 WPF，但它在 ASP.Net 2.0 中执行此操作，所以我假设它在这里执行相同操作。我花了很长时间才习惯这一点。

我同意。我讨厌在标记中定义事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-23T01:23:48.190

我同意你的担心。

经过多次辩论，我们正在遵循类似的非侵入式、超精简 XAML 模式，并在代码隐藏中绑定命令和数据。

如果您在 XAML 中添加事件，则会有一个指向事件代码的上下文菜单导航。如果您在 XAML 中绑定命令，则没有等效命令。您可以从 XAML 中的命令声明导航，但不能从它分配给控件的 Command 属性的位置导航。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2011-09-07T21:58:59.600

MVVM 是不好的做法。您认为您将数据和视图分开。什么？具有 XAML 绑定、绑定命令、将其转换为方法并实现 INotifyPropertyChanged 的​​完整机制是为了什么？对于 UTests（我制作 - 我测试他的概念）？正确的软件只需要在用户的测试中......它是你的代码以这样的方式分离，你有时不明白在哪里是什么。

你使用 INotify 做什么？对于 Microsoft ALL WPF 控件和整个 WPF 中的实体从 FrameworkElement 继承并具有魔术 DependencyProperties 的内容？

多重绑定是硬资源技术（阅读 MVVM 的作者）。

我在不到一年的时间内编写了没有任何模式的高度复杂的 3D CAE 系统......具有经典的应用程序组织，带有类和代码隐藏。 [https://skydrive.live.com/?cid=ea6ad1087e3103f0&sc=photos&id=EA6AD1087E3103F0!103&sff=1#cid=EA6AD1087E3103F0&id=EA6AD1087E3103F0!118&sc=photos](https://skydrive.live.com/?cid=ea6ad1087e3103f0&sc=photos&id=EA6AD1087E3103F0!103&sff=1#cid=EA6AD1087E3103F0&id=EA6AD1087E3103F0!118&sc=photos)

MVVM 中的所有示例都是关于公司中的客户...我提供名称 MVVMCC 模式（公司中的客户）

# .net - 如何使 ElementHost 透明，使其后面的表单可见且可点击？

> ID：564355
> 
> 赞同：2
> 
> 时间：2009-02-19T08:05:43.327
> 
> 标签：.net, wpf, winforms, transparency

我试图派生一个类形式 ElementHost 并覆盖 CreateParams 方法：

```
 protected override CreateParams CreateParams
    {
        get
        {
            const int WS_EX_TRANSPARENT = 0x20;
            CreateParams cp = base.CreateParams;
            cp.ExStyle = cp.ExStyle | WS_EX_TRANSPARENT;
            return cp;
        }
    } 
```

这使其透明，但表单不可点击。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T12:49:30.867

尝试将此添加到您的派生类中：

```
private const int WM_NCHITTEST             = 0x0084;
private const int HTTRANSPARENT            = (-1);

protected override void WndProc(ref Message m)
{
   if (m.Msg == WM_NCHITTEST)
   {
      m.Result = (IntPtr) HTTRANSPARENT;
   }
   else
   {
      base.WndProc(ref m);
   }
} 
```

这应该使整个 ElementHost 对鼠标“透明”，如果您希望 WPF 内容响应鼠标，则必须使用 VisualTreeHelper.HitTest 来决定从 WM_NCHITTEST 处理程序返回什么。

我没有用 ElementHost 测试过它，但它适用于普通的 WinForms 控件。

# c# - C#/.NET 应用程序沙盒中的脚本语言

> ID：564357
> 
> 赞同：6
> 
> 时间：2009-02-19T08:06:45.320
> 
> 标签：c#, embedded, scripting-language

[这个问题与这个问题类似[，](https://stackoverflow.com/questions/462311/scripting-language-for-embedding-into-c-net-applications)但我也对沙盒的可能性感兴趣。]

我正在考虑在我的 C#/.NET 应用程序中嵌入一种脚本语言，然后将我的一些应用程序的 API 暴露给脚本。似乎有多种不错的选择（Lua、Boo、IronPython 等），但是是否有简单的选择可以限制使用脚本语言的内置函数？例如，我不希望脚本能够执行 I/O，除非通过我明确公开的 API，因此不能打印到控制台、打开文件等。这些脚本语言中的任何一种都提供了一种简单的方法吗？这？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T10:52:11.103

您可以将 te 脚本加载到不同的 AppDomain 并控制第二个 AppDomain 的权限。

这个链接应该让你开始：http:
[//blogs.msdn.com/shawnfa/archive/2005/08/08/449050.aspx](http://blogs.msdn.com/shawnfa/archive/2005/08/08/449050.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T09:27:41.633

我自己在 Windows 上使用过 Powershell 作为脚本语言，发现它非常有用，如果您熟悉 .NET，那么它就更容易了。

在此处下载一个两[页的参考文档](http://www.microsoft.com/downloads/details.aspx?familyid=df8ed469-9007-401c-85e7-46649a32d0e0&displaylang=en&tm)，这就是您开始所需的全部内容。

但是是的，您可以使用 .NET System.IO 命名空间通过 Powershell 执行 IO 操作

同样张贴#[这个链接](https://stackoverflow.com/questions/535212/programming-a-command-line-shell-whats-in-it/535582#535582)

# c# - C#：当用户开始输入时激活一个文本框

> ID：564358
> 
> 赞同：1
> 
> 时间：2009-02-19T08:06:49.580
> 
> 标签：c#, winforms, controls, keyboard, focus

我想在用户开始输入内容时激活搜索文本框（即使文本框当时没有聚焦）。我已经`KeyPreview`将表格设置为`true`. 然后在 KeyDown 事件处理程序中，我有这个：

```
if(!searchTextBox.Focused)
{
    searchTextBox.Focus();
} 
```

这几乎可以工作。文本框已聚焦，但第一个键入的字母丢失了。我想这是因为文本框从来没有真正得到事件，因为它发生时没有集中注意力。那么，有没有人有一个聪明的解决方案来让我像它应该的那样工作？

我还想要一些提示，说明如何仅在按下常规键时才发生这种情况。所以不像箭头键、修饰键、功能键等。但这我可能会想办法去做。另一方面，上一个问题，我不太确定我应该如何解决......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T08:22:29.980

作为对 SDX2000 答案的补充，请查看 KeyDown 事件的[MSDN 文章](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.keydown.aspx)。它也指[KeyPressed](http://msdn.microsoft.com/en-us/library/system.windows.forms.keypresseventargs.aspx)事件，它在 KeyDown 事件之后触发，我认为它更适合您想要做的事情。

引用 MSDN：

> KeyPressEventArgs 指定用户按下某个键时所组成的字符。例如，当用户按下 SHIFT + K 时，KeyChar 属性返回一个大写的 K。

```
private void YourEventHandler(object Sender, KeyPressEventArgs Args)
{
    if(!searchTextBox.Focused)
    {
        searchTextBox.Focus();
        searchTextBox.Text += Args.KeyChar;
        // move caret to end of text because Focus() selects all the text
        searchTextBox.SelectionStart = searchTextBox.Text.Length
    }
} 
```

我实际上不确定您是否可以使用`+=`将字符附加到字符串，因此您需要检查一下。而且我不知道当用户点击时会发生什么`return`，最好也跟进该问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T08:09:12.553

作为 KeyDown 事件的一部分，您将获得第一次击键。您可以自己将其保存到文本框中。

# asp.net - 使用 ASP.NET MVC 呈现大量 html 或文本文件的最佳实践是什么？

> ID：564361
> 
> 赞同：0
> 
> 时间：2009-02-19T08:07:16.740
> 
> 标签：asp.net, asp.net-mvc

我有很多html页面，但我不知道如何通过asp.net mvc视图显示它们。

我构建了一个视图作为我的模板，并使用 asp.net mvc 将 html 插入到模板中，然后渲染它。

但问题是我必须使用 FileStream 将基于 html 的原始文件读入 memroy，然后将其放入视图模板中，例如 ViewData["content"] = ???。

我只是想知道是否还有其他更好的方法可以将静态 html 文件呈现给浏览器。

我是否清楚地描述了这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T10:12:36.643

我想您也可以直接将 HTML 中的 iframe 元素指向目标文件 url。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T08:28:09.780

我想你可以做这样的事情：

```
using(var file = new StreamReader(htmlFileName))
{
    return Content(file.ReadToEnd());
} 
```

请注意，mime 类型自动默认为 text/html，但您可以选择通过将类型作为附加参数提供给方法来指定应发送哪些 mime 类型标头`Content`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:45:50.470

或者，您可以编写自己的 ActionResult ，将文件的内容写入 Response.Output （可能会避免一次将整个文件加载到内存中，尽管这可能不是一个大问题）。

# unix - 如何从 Solaris 的命令行创建非阻塞管道？

> ID：564363
> 
> 赞同：0
> 
> 时间：2009-02-19T08:08:14.413
> 
> 标签：unix, lua, pipe, nonblocking

我正在尝试编写一个从其他进程读取输入并对其进行分析的 lua 脚本。为此，我正在使用 io.popen 并且它在 Windows 中按预期工作，但在 Unix（Solaris）上从 io.popen 块读取，所以脚本只是在那里等待直到出现某些东西而不是立即返回......

据我所知，我无法从脚本中更改 io.popen 的功能，如果可能的话，我宁愿不必更改 C 代码，因为那样脚本将需要与修补后的绑定二进制。

这会给我留下任何命令行解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T09:31:50.173

好的，到目前为止还没有答案，但是对于后代，如果有人需要类似的解决方案，我或多或少做了以下事情

```
function my_popen(name,cmd)
    local process = {}
    process.__proc = assert(io.popen(cmd..">"..name..".tmp", 'r'))
    process.__file = assert(io.open(name..".tmp", 'r'))
    process.lines  = function(self)
        return self.__file:lines()
    end
    process.close = function(self)
        self.__proc:close()
        self.__file:close()
    end
    return process
end

proc = my_popen("somename","some command")
while true
    --do stuf
    for line in proc:lines() do
        print(line)
    end
    --do stuf
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T14:33:23.147

您的问题似乎与缓冲有关。由于某种原因，管道在允许打开的程序向其写入更多内容之前正在等待读取一些数据，并且它似乎不到一行。您可以做的是使用 io.popen(cmd):read"*a" 来读取所有内容。这应该避免缓冲问题。然后你可以用 for line in string.gmatch("[^\n]+") do someting_with(line) end 分割返回的字符串。

您的解决方案包括将进程的输出转储到文件中，然后读取该文件。您可以将您的 use 或 io.popen 替换为 io.execute，并丢弃返回值（只需检查它是否为 0）。

# c# - 将通用列表/可枚举转换为数据表？

> ID：564366
> 
> 赞同：294
> 
> 时间：2009-02-19T08:10:18.840
> 
> 标签：c#, list, generics, datatable

我有几个方法可以返回不同的通用列表。

.net 中是否存在任何类静态方法或任何将任何列表转换为数据表的方法？我唯一能想象的是使用反射来做到这一点。

如果我有这个：

```
List<Whatever> whatever = new List<Whatever>(); 
```

（下一个代码当然不起作用，但我希望有可能：

```
DataTable dt = (DataTable) whatever; 
```

* * *

## 回答 #1

> 赞同：356
> 
> 时间：2009-02-19T08:17:00.273

这是使用来自 NuGet的[FastMember](https://www.nuget.org/packages/FastMember/)的 2013 年更新：

```
IEnumerable<SomeType> data = ...
DataTable table = new DataTable();
using(var reader = ObjectReader.Create(data)) {
    table.Load(reader);
} 
```

这使用 FastMember 的元编程 API 以获得最大性能。如果您想将其限制为特定成员（或强制执行命令），那么您也可以这样做：

```
IEnumerable<SomeType> data = ...
DataTable table = new DataTable();
using(var reader = ObjectReader.Create(data, "Id", "Name", "Description")) {
    table.Load(reader);
} 
```

Editor's *Dis* / claimer **:** FastMember 是一个 Marc Gravell 项目。这是黄金和全飞！

* * *

[是的，这与这个](https://stackoverflow.com/questions/545328/asp-net-potential-memory-leaks-converting-datatable-to-lists/545429#545429)几乎完全相反。反射就足够了——或者如果你需要更快，[`HyperDescriptor`](https://www.codeproject.com/Articles/18450/HyperDescriptor-Accelerated-dynamic-property-acces)在 2.0 中，或者`Expression`在 3.5 中。其实`HyperDescriptor`应该绰绰有余。

例如：

```
// remove "this" if not on C# 3.0 / .NET 3.5
public static DataTable ToDataTable<T>(this IList<T> data)
{
    PropertyDescriptorCollection props =
        TypeDescriptor.GetProperties(typeof(T));
    DataTable table = new DataTable();
    for(int i = 0 ; i < props.Count ; i++)
    {
        PropertyDescriptor prop = props[i];
        table.Columns.Add(prop.Name, prop.PropertyType);
    }
    object[] values = new object[props.Count];
    foreach (T item in data)
    {
        for (int i = 0; i < values.Length; i++)
        {
            values[i] = props[i].GetValue(item);
        }
        table.Rows.Add(values);
    }
    return table;        
} 
```

现在只需一行，您就可以比反射快很多倍（通过启用[`HyperDescriptor`](https://www.codeproject.com/Articles/18450/HyperDescriptor-Accelerated-dynamic-property-acces)object-type `T`）。

* * *

编辑重新性能查询；这是一个带有结果的测试台：

```
Vanilla 27179
Hyper   6997 
```

我怀疑瓶颈已经从成员访问转移到`DataTable`性能......我怀疑你会在这方面取得很大进步......

代码：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Diagnostics;
public class MyData
{
    public int A { get; set; }
    public string B { get; set; }
    public DateTime C { get; set; }
    public decimal D { get; set; }
    public string E { get; set; }
    public int F { get; set; }
}

static class Program
{
    static void RunTest(List<MyData> data, string caption)
    {
        GC.Collect(GC.MaxGeneration, GCCollectionMode.Forced);
        GC.WaitForPendingFinalizers();
        GC.WaitForFullGCComplete();
        Stopwatch watch = Stopwatch.StartNew();
        for (int i = 0; i < 500; i++)
        {
            data.ToDataTable();
        }
        watch.Stop();
        Console.WriteLine(caption + "\t" + watch.ElapsedMilliseconds);
    }
    static void Main()
    {
        List<MyData> foos = new List<MyData>();
        for (int i = 0 ; i < 5000 ; i++ ){
            foos.Add(new MyData
            { // just gibberish...
                A = i,
                B = i.ToString(),
                C = DateTime.Now.AddSeconds(i),
                D = i,
                E = "hello",
                F = i * 2
            });
        }
        RunTest(foos, "Vanilla");
        Hyper.ComponentModel.HyperTypeDescriptionProvider.Add(
            typeof(MyData));
        RunTest(foos, "Hyper");
        Console.ReadLine(); // return to exit        
    }
} 
```

* * *

## 回答 #2

> 赞同：267
> 
> 时间：2011-04-27T13:38:03.907

我不得不修改 Marc Gravell 的示例代码来处理可空类型和空值。我在下面包含了一个工作版本。谢谢马克。

```
public static DataTable ToDataTable<T>(this IList<T> data)
{
    PropertyDescriptorCollection properties = 
        TypeDescriptor.GetProperties(typeof(T));
    DataTable table = new DataTable();
    foreach (PropertyDescriptor prop in properties)
        table.Columns.Add(prop.Name, Nullable.GetUnderlyingType(prop.PropertyType) ?? prop.PropertyType);
    foreach (T item in data)
    {
        DataRow row = table.NewRow();
        foreach (PropertyDescriptor prop in properties)
             row[prop.Name] = prop.GetValue(item) ?? DBNull.Value;
        table.Rows.Add(row);
    }
    return table;
} 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2010-12-07T16:21:05.753

这是解决方案的简单组合。它适用于 Nullable 类型。

```
public static DataTable ToDataTable<T>(this IList<T> list)
{
  PropertyDescriptorCollection props = TypeDescriptor.GetProperties(typeof(T));
  DataTable table = new DataTable();
  for (int i = 0; i < props.Count; i++)
  {
    PropertyDescriptor prop = props[i];
    table.Columns.Add(prop.Name, Nullable.GetUnderlyingType(prop.PropertyType) ?? prop.PropertyType);
  }
  object[] values = new object[props.Count];
  foreach (T item in list)
  {
    for (int i = 0; i < values.Length; i++)
      values[i] = props[i].GetValue(item) ?? DBNull.Value;
    table.Rows.Add(values);
  }
  return table;
} 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-01-27T13:49:44.513

对[Marc 的回答稍作](https://stackoverflow.com/a/564373/128662)改动，使其适用`List<string>`于数据表等值类型：

```
public static DataTable ListToDataTable<T>(IList<T> data)
{
    DataTable table = new DataTable();

    //special handling for value types and string
    if (typeof(T).IsValueType || typeof(T).Equals(typeof(string)))
    {

        DataColumn dc = new DataColumn("Value", typeof(T));
        table.Columns.Add(dc);
        foreach (T item in data)
        {
            DataRow dr = table.NewRow();
            dr[0] = item;
            table.Rows.Add(dr);
        }
    }
    else
    {
        PropertyDescriptorCollection properties = TypeDescriptor.GetProperties(typeof(T));
        foreach (PropertyDescriptor prop in properties)
        {
            table.Columns.Add(prop.Name, Nullable.GetUnderlyingType(prop.PropertyType) ?? prop.PropertyType);
        }
        foreach (T item in data)
        {
            DataRow row = table.NewRow();
            foreach (PropertyDescriptor prop in properties)
            {
                try
                {
                    row[prop.Name] = prop.GetValue(item) ?? DBNull.Value;
                }
                catch (Exception ex)
                {
                    row[prop.Name] = DBNull.Value;
                }
            }
            table.Rows.Add(row);
        }
    }
    return table;
} 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2012-02-22T13:14:40.113

MSDN 上的这个链接值得一看：[How to: Implement CopyToDataTable<T> Where the Generic Type T Is Not a DataRow](http://msdn.microsoft.com/en-us/library/bb669096.aspx)

这添加了一个扩展方法，可以让您执行此操作：

```
// Create a sequence. 
Item[] items = new Item[] 
{ new Book{Id = 1, Price = 13.50, Genre = "Comedy", Author = "Gustavo Achong"}, 
  new Book{Id = 2, Price = 8.50, Genre = "Drama", Author = "Jessie Zeng"},
  new Movie{Id = 1, Price = 22.99, Genre = "Comedy", Director = "Marissa Barnes"},
  new Movie{Id = 1, Price = 13.40, Genre = "Action", Director = "Emmanuel Fernandez"}};

// Query for items with price greater than 9.99.
var query = from i in items
             where i.Price > 9.99
             orderby i.Price
             select i;

// Load the query results into new DataTable.
DataTable table = query.CopyToDataTable(); 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2015-12-10T13:17:24.703

另一种方法是上面的：

```
 List<WhateEver> lst = getdata();
  string json = Newtonsoft.Json.JsonConvert.SerializeObject(lst);
  DataTable pDt = JsonConvert.DeserializeObject<DataTable>(json); 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2015-12-03T10:01:37.930

```
public DataTable ConvertToDataTable<T>(IList<T> data)
{
    PropertyDescriptorCollection properties =
        TypeDescriptor.GetProperties(typeof(T));

    DataTable table = new DataTable();

    foreach (PropertyDescriptor prop in properties)
            table.Columns.Add(prop.Name, Nullable.GetUnderlyingType(prop.PropertyType) ?? prop.PropertyType);

    foreach (T item in data)
    {
        DataRow row = table.NewRow();
        foreach (PropertyDescriptor prop in properties)
        {
           row[prop.Name] = prop.GetValue(item) ?? DBNull.Value;
        }
        table.Rows.Add(row);
    }
    return table;
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-05-14T08:40:04.360

试试这个

```
public static DataTable ListToDataTable<T>(IList<T> lst)
{

    currentDT = CreateTable<T>();

    Type entType = typeof(T);

    PropertyDescriptorCollection properties = TypeDescriptor.GetProperties(entType);
    foreach (T item in lst)
    {
        DataRow row = currentDT.NewRow();
        foreach (PropertyDescriptor prop in properties)
        {

            if (prop.PropertyType == typeof(Nullable<decimal>) || prop.PropertyType == typeof(Nullable<int>) || prop.PropertyType == typeof(Nullable<Int64>))
            {
                if (prop.GetValue(item) == null)
                    row[prop.Name] = 0;
                else
                    row[prop.Name] = prop.GetValue(item);
            }
            else
                row[prop.Name] = prop.GetValue(item);                    

        }
        currentDT.Rows.Add(row);
    }

    return currentDT;
}

public static DataTable CreateTable<T>()
{
    Type entType = typeof(T);
    DataTable tbl = new DataTable(DTName);
    PropertyDescriptorCollection properties = TypeDescriptor.GetProperties(entType);
    foreach (PropertyDescriptor prop in properties)
    {
        if (prop.PropertyType == typeof(Nullable<decimal>))
             tbl.Columns.Add(prop.Name, typeof(decimal));
        else if (prop.PropertyType == typeof(Nullable<int>))
            tbl.Columns.Add(prop.Name, typeof(int));
        else if (prop.PropertyType == typeof(Nullable<Int64>))
            tbl.Columns.Add(prop.Name, typeof(Int64));
        else
             tbl.Columns.Add(prop.Name, prop.PropertyType);
    }
    return tbl;
} 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-12-08T07:04:35.603

```
It's also possible through XmlSerialization.
The idea is - serialize to `XML` and then `readXml` method of `DataSet`.

I use this code (from an answer in SO, forgot where)

        public static string SerializeXml<T>(T value) where T : class
    {
        if (value == null)
        {
            return null;
        }

        XmlSerializer serializer = new XmlSerializer(typeof(T));

        XmlWriterSettings settings = new XmlWriterSettings();

        settings.Encoding = new UnicodeEncoding(false, false);
        settings.Indent = false;
        settings.OmitXmlDeclaration = false;
        // no BOM in a .NET string

        using (StringWriter textWriter = new StringWriter())
        {
            using (XmlWriter xmlWriter = XmlWriter.Create(textWriter, settings))
            {
               serializer.Serialize(xmlWriter, value);
            }
            return textWriter.ToString();
        }
    }

so then it's as simple as:

            string xmlString = Utility.SerializeXml(trans.InnerList);

        DataSet ds = new DataSet("New_DataSet");
        using (XmlReader reader = XmlReader.Create(new StringReader(xmlString)))
        { 
            ds.Locale = System.Threading.Thread.CurrentThread.CurrentCulture;
            ds.ReadXml(reader); 
        }

Not sure how it stands against all the other answers to this post, but it's also a possibility. 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-06-18T21:18:15.513

我自己编写了一个小型库来完成这项任务。它仅在第一次将对象类型转换为数据表时使用反射。它发出一个方法，该方法将完成转换对象类型的所有工作。

它的速度很快。你可以在这里找到它：

*   [GitHub 上 MoreLinq 中的 ToDataTable()](https://github.com/morelinq/MoreLINQ/blob/ee238241083a9b31dc03c39781b29f4189b4fe73/MoreLinq/Extensions.ToDataTable.g.cs)
*   原文：[GoogleCode 上的 ModelShredder](http://code.google.com/p/modelshredder/)，被合并到 MoreLinq 中，从 GoogleCode 移到了 GitHub

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-02-22T23:58:01.740

Marc Gravell 的回答，但在 VB.NET 中

```
Public Shared Function ToDataTable(Of T)(data As IList(Of T)) As DataTable
    Dim props As PropertyDescriptorCollection = TypeDescriptor.GetProperties(GetType(T))
    Dim table As New DataTable()
    For i As Integer = 0 To props.Count - 1
            Dim prop As PropertyDescriptor = props(i)
            table.Columns.Add(prop.Name, prop.PropertyType)
    Next
    Dim values As Object() = New Object(props.Count - 1) {}
    For Each item As T In data
            For i As Integer = 0 To values.Length - 1
                    values(i) = props(i).GetValue(item)
            Next
            table.Rows.Add(values)
    Next
    Return table
End Function 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2020-01-30T16:43:28.567

```
List<YourModel> data = new List<YourModel>();
DataTable dataTable = Newtonsoft.Json.JsonConvert.DeserializeObject<DataTable>(Newtonsoft.Json.JsonConvert.SerializeObject(data)); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2019-10-04T19:56:07.680

如果您使用的是 .NET Core，2019 年的答案 - 使用[Nuget ToDataTable library](https://www.nuget.org/packages/ToDataTable)。好处：

*   比 FastMember 更好的性能
*   还创建结构化 SqlParameters 以用作[SQL Server 表值参数](https://docs.microsoft.com/en-us/sql/relational-databases/tables/use-table-valued-parameters-database-engine?view=sql-server-2017)

**免责声明**- 我是 ToDataTable 的作者

**性能**- 我跨越了一些[Benchmark .Net](https://github.com/dotnet/BenchmarkDotNet)测试并将它们包含在[ToDataTable 存储库](https://github.com/ChrisHodges/ToDataTable)中。结果如下：

*创建 100,000 行数据表*：

```
 MacOS         Windows
Reflection                 818.5 ms      818.3 ms
FastMember from           1105.5 ms      976.4 ms
 Mark's answer
Improved FastMember        524.6 ms      456.4 ms
ToDataTable                449.0 ms      376.5 ms 
```

[Marc 的答案](https://stackoverflow.com/a/564373/1916816)中建议的 FastMember 方法的性能似乎比[Mary 的](https://stackoverflow.com/a/5805044/1916816)使用反射的答案差，但我使用 FastMember[推出了另一种方法](https://github.com/ChrisHodges/ToDataTable/blob/master/ToDataTable/ToDataTable.Benchmarks/ToDataTableBenchmarkingExtensionMethods.cs)`TypeAccessor`，它的性能要好得多。然而，**ToDataTable**包的表现优于很多。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2020-01-11T09:42:20.413

**将通用列表转换为 DataTable**

使用 Newtonsoft.Json；

```
public DataTable GenericToDataTable(IList<T> list)
{
    var json = JsonConvert.SerializeObject(list);
    DataTable dt = (DataTable)JsonConvert.DeserializeObject(json, (typeof(DataTable)));
    return dt;
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2013-10-01T23:58:15.720

我还必须想出一个替代解决方案，因为这里列出的选项都不适用于我的情况。我正在使用一个 IEnumerable，它返回一个 IEnumerable 并且无法枚举属性。这成功了：

```
// remove "this" if not on C# 3.0 / .NET 3.5
public static DataTable ConvertToDataTable<T>(this IEnumerable<T> data)
{
    List<IDataRecord> list = data.Cast<IDataRecord>().ToList();

    PropertyDescriptorCollection props = null;
    DataTable table = new DataTable();
    if (list != null && list.Count > 0)
    {
        props = TypeDescriptor.GetProperties(list[0]);
        for (int i = 0; i < props.Count; i++)
        {
            PropertyDescriptor prop = props[i];
            table.Columns.Add(prop.Name, Nullable.GetUnderlyingType(prop.PropertyType) ?? prop.PropertyType);
        }
    }
    if (props != null)
    {
        object[] values = new object[props.Count];
        foreach (T item in data)
        {
            for (int i = 0; i < values.Length; i++)
            {
                values[i] = props[i].GetValue(item) ?? DBNull.Value;
            }
            table.Rows.Add(values);
        }
    }
    return table;
} 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2013-11-28T07:19:53.720

```
 using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data;
using System.ComponentModel;

public partial class Default3 : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        DataTable dt = new DataTable();
        dt = lstEmployee.ConvertToDataTable();
    }
    public static DataTable ConvertToDataTable<T>(IList<T> list) where T : class
    {
        try
        {
            DataTable table = CreateDataTable<T>();
            Type objType = typeof(T);
            PropertyDescriptorCollection properties = TypeDescriptor.GetProperties(objType);
            foreach (T item in list)
            {
                DataRow row = table.NewRow();
                foreach (PropertyDescriptor property in properties)
                {
                    if (!CanUseType(property.PropertyType)) continue;
                    row[property.Name] = property.GetValue(item) ?? DBNull.Value;
                }

                table.Rows.Add(row);
            }
            return table;
        }
        catch (DataException ex)
        {
            return null;
        }
        catch (Exception ex)
        {
            return null;
        }

    }
    private static DataTable CreateDataTable<T>() where T : class
    {
        Type objType = typeof(T);
        DataTable table = new DataTable(objType.Name);
        PropertyDescriptorCollection properties = TypeDescriptor.GetProperties(objType);
        foreach (PropertyDescriptor property in properties)
        {
            Type propertyType = property.PropertyType;
            if (!CanUseType(propertyType)) continue;

            //nullables must use underlying types
            if (propertyType.IsGenericType && propertyType.GetGenericTypeDefinition() == typeof(Nullable<>))
                propertyType = Nullable.GetUnderlyingType(propertyType);
            //enums also need special treatment
            if (propertyType.IsEnum)
                propertyType = Enum.GetUnderlyingType(propertyType);
            table.Columns.Add(property.Name, propertyType);
        }
        return table;
    }

    private static bool CanUseType(Type propertyType)
    {
        //only strings and value types
        if (propertyType.IsArray) return false;
        if (!propertyType.IsValueType && propertyType != typeof(string)) return false;
        return true;
    }
} 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2014-04-11T13:59:56.520

我意识到这已经关闭了一段时间；但是，我对这个特定问题有一个解决方案，但需要稍微改变一下：列和数据表需要预定义/已经实例化。然后我需要简单地将类型插入数据表中。

所以这是我所做的一个例子：

```
public static class Test
{
    public static void Main()
    {
        var dataTable = new System.Data.DataTable(Guid.NewGuid().ToString());

        var columnCode = new DataColumn("Code");
        var columnLength = new DataColumn("Length");
        var columnProduct = new DataColumn("Product");

        dataTable.Columns.AddRange(new DataColumn[]
            {
                columnCode,
                columnLength,
                columnProduct
            });

        var item = new List<SomeClass>();

        item.Select(data => new
        {
            data.Id,
            data.Name,
            data.SomeValue
        }).AddToDataTable(dataTable);
    }
}

static class Extensions
{
    public static void AddToDataTable<T>(this IEnumerable<T> enumerable, System.Data.DataTable table)
    {
        if (enumerable.FirstOrDefault() == null)
        {
            table.Rows.Add(new[] {string.Empty});
            return;
        }

        var properties = enumerable.FirstOrDefault().GetType().GetProperties();

        foreach (var item in enumerable)
        {
            var row = table.NewRow();
            foreach (var property in properties)
            {
                row[property.Name] = item.GetType().InvokeMember(property.Name, BindingFlags.GetProperty, null, item, null);
            }
            table.Rows.Add(row);
        }
    }
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-04-25T11:01:54.247

如果您使用的是 VB.NET，那么这个类就可以完成这项工作。

```
Imports System.Reflection
''' <summary>
''' Convert any List(Of T) to a DataTable with correct column types and converts Nullable Type values to DBNull
''' </summary>

Public Class ConvertListToDataset

    Public Function ListToDataset(Of T)(ByVal list As IList(Of T)) As DataTable

        Dim dt As New DataTable()
        '/* Create the DataTable columns */
        For Each pi As PropertyInfo In GetType(T).GetProperties()
            If pi.PropertyType.IsValueType Then
                Debug.Print(pi.Name)
            End If
            If IsNothing(Nullable.GetUnderlyingType(pi.PropertyType)) Then
                dt.Columns.Add(pi.Name, pi.PropertyType)
            Else
                dt.Columns.Add(pi.Name, Nullable.GetUnderlyingType(pi.PropertyType))
            End If
        Next

        '/* Populate the DataTable with the values in the Items in List */
        For Each item As T In list
            Dim dr As DataRow = dt.NewRow()
            For Each pi As PropertyInfo In GetType(T).GetProperties()
                dr(pi.Name) = IIf(IsNothing(pi.GetValue(item)), DBNull.Value, pi.GetValue(item))
            Next
            dt.Rows.Add(dr)
        Next
        Return dt

    End Function

End Class 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-10-20T16:29:42.903

如果你的类中有属性，这行代码就可以了！！

```
PropertyDescriptorCollection props =
            TypeDescriptor.GetProperties(typeof(T)); 
```

但如果你有所有公共领域，那么使用这个：

```
public static DataTable ToDataTable<T>(  IList<T> data)
        {
        FieldInfo[] myFieldInfo;
        Type myType = typeof(T);
        // Get the type and fields of FieldInfoClass.
        myFieldInfo = myType.GetFields(BindingFlags.NonPublic | BindingFlags.Instance
            | BindingFlags.Public);

        DataTable dt = new DataTable();
        for (int i = 0; i < myFieldInfo.Length; i++)
            {
            FieldInfo property = myFieldInfo[i];
            dt.Columns.Add(property.Name, property.FieldType);
            }
        object[] values = new object[myFieldInfo.Length];
        foreach (T item in data)
            {
            for (int i = 0; i < values.Length; i++)
                {
                values[i] = myFieldInfo[i].GetValue(item);
                }
            dt.Rows.Add(values);
            }
        return dt;
        } 
```

原来的答案是从上面，我只是编辑使用字段而不是属性

并使用它来做到这一点

```
 DataTable dt = new DataTable();
            dt = ToDataTable(myBriefs);
            gridData.DataSource = dt;
            gridData.DataBind(); 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-07-22T11:06:40.120

要将通用列表转换为数据表，您可以使用[DataTableGenerator](https://github.com/MajeQafouri/DataTableGenerator)

该库可让您将列表转换为具有多种功能的数据表，例如

*   翻译数据表头
*   指定要显示的列

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2019-12-19T07:05:02.367

```
 private DataTable CreateDataTable(IList<T> item)
        {
            Type type = typeof(T);
            var properties = type.GetProperties();

            DataTable dataTable = new DataTable();
            foreach (PropertyInfo info in properties)
            {
                dataTable.Columns.Add(new DataColumn(info.Name, Nullable.GetUnderlyingType(info.PropertyType) ?? info.PropertyType));
            }

            foreach (T entity in item)
            {
                object[] values = new object[properties.Length];
                for (int i = 0; i < properties.Length; i++)
                {
                    values[i] = properties[i].GetValue(entity);
                }

                dataTable.Rows.Add(values);
            }
            return dataTable;
        } 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2021-03-06T08:31:25.743

您可以尝试以下方法

```
public static DataTable GetDataTableFromObjects(object[] objects)
{
    if (objects != null && objects.Length > 0)
    {
        Type t = objects[0].GetType();
        DataTable dt = new DataTable(t.Name);
        foreach (PropertyInfo pi in t.GetProperties())
        {
            dt.Columns.Add(new DataColumn(pi.Name));
        }
        foreach (var o in objects)
        {
            DataRow dr = dt.NewRow();
            foreach (DataColumn dc in dt.Columns)
            {
                dr[dc.ColumnName] = o.GetType().GetProperty(dc.ColumnName).GetValue(o, null);
            }
            dt.Rows.Add(dr);
        }
        return dt;
    }
    return null;
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-05-04T08:37:17.330

这是将列表转换为数据表的简单控制台应用程序。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Data;
using System.ComponentModel;

namespace ConvertListToDataTable
{
    public static class Program
    {
        public static void Main(string[] args)
        {
            List<MyObject> list = new List<MyObject>();
            for (int i = 0; i < 5; i++)
            {
                list.Add(new MyObject { Sno = i, Name = i.ToString() + "-KarthiK", Dat = DateTime.Now.AddSeconds(i) });
            }

            DataTable dt = ConvertListToDataTable(list);
            foreach (DataRow row in dt.Rows)
            {
                Console.WriteLine();
                for (int x = 0; x < dt.Columns.Count; x++)
                {
                    Console.Write(row[x].ToString() + " ");
                }
            }
            Console.ReadLine();
        }

        public class MyObject
        {
            public int Sno { get; set; }
            public string Name { get; set; }
            public DateTime Dat { get; set; }
        }

        public static DataTable ConvertListToDataTable<T>(this List<T> iList)
        {
            DataTable dataTable = new DataTable();
            PropertyDescriptorCollection props = TypeDescriptor.GetProperties(typeof(T));
            for (int i = 0; i < props.Count; i++)
            {
                PropertyDescriptor propertyDescriptor = props[i];
                Type type = propertyDescriptor.PropertyType;

                if (type.IsGenericType && type.GetGenericTypeDefinition() == typeof(Nullable<>))
                    type = Nullable.GetUnderlyingType(type);

                dataTable.Columns.Add(propertyDescriptor.Name, type);
            }
            object[] values = new object[props.Count];
            foreach (T iListItem in iList)
            {
                for (int i = 0; i < values.Length; i++)
                {
                    values[i] = props[i].GetValue(iListItem);
                }
                dataTable.Rows.Add(values);
            }
            return dataTable;
        }
    }
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2017-05-31T18:14:19.940

```
 Dim counties As New List(Of County)
 Dim dtCounties As DataTable
 dtCounties = _combinedRefRepository.Get_Counties()
 If dtCounties.Rows.Count <> 0 Then
    For Each row As DataRow In dtCounties.Rows
      Dim county As New County
      county.CountyId = row.Item(0).ToString()
      county.CountyName = row.Item(1).ToString().ToUpper()
      counties.Add(county)
    Next
    dtCounties.Dispose()
 End If 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-03-20T11:42:55.217

我认为它更方便和易于使用。

```
 List<Whatever> _lobj= new List<Whatever>(); 
    var json = JsonConvert.SerializeObject(_lobj);
                DataTable dt = (DataTable)JsonConvert.DeserializeObject(json, (typeof(DataTable))); 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2020-06-03T13:39:50.757

如果您想使用反射并设置列顺序/仅包含某些列/排除某些列，请尝试以下操作：

```
 private static DataTable ConvertToDataTable<T>(IList<T> data, string[] fieldsToInclude = null,
string[] fieldsToExclude = null)
    {
        PropertyDescriptorCollection properties = TypeDescriptor.GetProperties(typeof(T));
        DataTable table = new DataTable();
        foreach (PropertyDescriptor prop in properties)
        {
            if ((fieldsToInclude != null && !fieldsToInclude.Contains(prop.Name)) ||
                (fieldsToExclude != null && fieldsToExclude.Contains(prop.Name)))
                continue;
            table.Columns.Add(prop.Name, Nullable.GetUnderlyingType(prop.PropertyType) ?? prop.PropertyType);
        }

        foreach (T item in data)
        {
            var atLeastOnePropertyExists = false;
            DataRow row = table.NewRow();
            foreach (PropertyDescriptor prop in properties)
            {

                if ((fieldsToInclude != null && !fieldsToInclude.Contains(prop.Name)) ||
(fieldsToExclude != null && fieldsToExclude.Contains(prop.Name)))
                    continue;

                row[prop.Name] = prop.GetValue(item) ?? DBNull.Value;
                atLeastOnePropertyExists = true;
            }

            if(atLeastOnePropertyExists) table.Rows.Add(row);
        }

        if (fieldsToInclude != null)
            SetColumnsOrder(table, fieldsToInclude);

        return table;

    }

    private static void SetColumnsOrder(DataTable table, params String[] columnNames)
    {
        int columnIndex = 0;
        foreach (var columnName in columnNames)
        {
            table.Columns[columnName].SetOrdinal(columnIndex);
            columnIndex++;
        }
    } 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-12-15T15:34:09.937

```
List<object> Basket;

string json = JsonConvert.SerializeObject(Basket, Formatting.Indented);
DataTable dtUsingMethod = Business.GetJSONToDataTableUsingNewtonSoftDll(json);

public static DataTable GetJSONToDataTableUsingNewtonSoftDll(string JSONData)
{
    DataTable dt = (DataTable)JsonConvert.DeserializeObject(JSONData, (typeof(DataTable)));
    return dt;
} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-12-15T22:32:29.897

这是列表中的另一个。[Cinchoo ETL](https://www.nuget.org/packages/ChoETL/) - 一个将可枚举转换为数据表的开源库。

```
List<Whatever> whatever = new List<Whatever>();
var dt = whatever.AsDataTable(); 
```

免责声明：我是这个库的作者。

# c++ - XML解析问题

> ID：564367
> 
> 赞同：0
> 
> 时间：2009-02-19T08:12:11.673
> 
> 标签：c++, xml

我有一个 XML 解析器在不完整的 XML 数据上崩溃。因此，提供给它的 XML 数据可能是以下之一：

```
<one><two>twocontent</two</one>

<a/><b/> ( the parser treats it as two root elements ) 
```

元素属性也被处理（虽然上面没有显示）。

现在，问题是当我从套接字读取数据时，我会以片段的形式获取数据。例如：

```
<one>one

content</two>

</one> 
```

因此，在将 XML 发送到解析器之前，我必须构造一个有效的 XML 并发送它。哪种编程结构（如迭代、递归等）最适合这种情况。

我正在用 C++ 编程。

请帮忙。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T10:17:08.410

简短的回答：*你做错了。*

您的问题混淆了两个不同的问题：

1.  **解析完全不是格式良好的 XML 的数据*，***即所谓的标签汤。

    示例：由不懂 XML 或具有糟糕编码习惯的程序员生成的文件。

    *   可以说：不是格式良好的 XML 的文件根本就不是 XML 文档。每个正确的 XML 解析器都会拒绝它。理想情况下，您将努力更正此数据的来源并确保生成正确的 XML。

    *   或者，使用标签汤解析器，即进行错误纠正的解析器。

        有用的标签汤解析器通常实际上是 HTML 解析器。 [tidy](http://tidy.sourceforge.net/)已经在另一个答案中指出。

        确保您了解此类解析器实际执行的更正步骤，因为没有可以修复 XML 的通用方法。尤其是 Tidy 在“修复”数据方面非常积极，例如，比真正的浏览器和 HTML 5 规范更积极。

2.  **从 socket 解析 XML**，数据在流中逐块到达。在这种情况下，XML 文档可能被视为“无限的”，在看到根元素的最终结束标记之前很久就会处理块。

    示例：XMPP 是一个像这样工作的协议。

    *   解决方案是使用基于拉取的解析器，例如 libxml2 中的[XMLTextReader](http://www.xmlsoft.org/xmlreader.html) API。

    *   如果需要解析器的 XML 子元素的基于树的数据结构，您可以为正在读取的每个此类元素构建树结构，而不是为整个文档构建树结构。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T10:09:04.340

什么是从套接字连接的另一端向您提供 XML 的？正如您所说明的那样，您应该丢失一些东西是没有意义的，只是因为您是从套接字接收的。

如果套接字使用 TCP（或具有类似属性的自定义协议），则不应丢失 XML 的某些部分。因此，您应该能够将其全部缓冲，直到另一端发出“文档结束”信号，然后将其提供给您挑剔的 XML 解析器。

如果您使用 UDP 或其他一些“有损”协议，则需要重新考虑，因为显然不可能通过随机丢弃片段的通道正确传输大型 XML 文档。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T09:12:17.253

因为 XML 结构是一个层次结构（一棵树），所以递归将是解决这个问题的最佳方法。您可以对每个孩子调用递归并修复丢失的 XML 标识符。基本上，您将执行与 DOM 对象解析器相同的操作，只是您将解析文件以修复其结构。但有一件事，在我看来，好像在这种方法中您要重新编写 XML 解析器。这不是时间的腰部吗？也许最好找到一种方法让 XML 到达正确的结构，而不是试图修复它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T08:21:36.767

有多个作家吗？为什么您的解析器不验证 XML？

使用一棵树，其中每个节点代表一个元素并带有一个脏位。该节点的第一次出现将其标记为脏，即您期待一个结束标记，除非该节点当然是形式`<a/>`。此外，您遇到的第一个元素是根。

当您碰到脏节点时，请继续将节点推入堆栈，直到您弹出内容时点击结束标记。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T10:04:22.887

`<two>`在您的示例中，一旦检测到开始标签丢失，您将如何确定在内容中的确切位置？正如他们所说，这不是微不足道的。

# asp.net - 新创建的身份验证票证中的到期日期（asp.net forms auth）

> ID：564384
> 
> 赞同：0
> 
> 时间：2009-02-19T08:21:58.063
> 
> 标签：asp.net, cookies, forms-authentication

我正在使用 asp.net 表单身份验证和 asp.net 登录控件。登录控件有一个“RememberMe”复选框。

用户通过身份验证后，它会引发 LoggedIn(object sender, EventArgs e) 方法，在此方法中，我正在查看使用此方法创建的身份验证 cookie

```
HttpCookie authCookie = FormsAuthentication.GetAuthCookie(userName, true); 
```

当我检查 authCookie.Expires 值时，我希望未选中 RememberMe 时为 30 分钟，选中 RememberMe 时为 50 年（根据 MS 文档，这些是默认值）

但无论我是否检查RememberMe，它总是30 分钟。我检查了我的 web.config 并且我没有为“超时”字段设置任何内容，所以我不确定为什么会发生这种情况。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T09:24:02.500

这很令人困惑，但看起来我必须在我的 web.config 中的 authentication/forms 部分下设置“超时”和“slidingExpiration”，才能让 RememberMe 部分正常工作

我已经设置好了，一切都按预期工作

```
slidingExpiration="true" timeout="5120" 
```

rick strahl 的博客帮我找到了答案 [http://www.west-wind.com/WebLog/posts/157861.aspx](http://www.west-wind.com/WebLog/posts/157861.aspx)

# subscription - 基于订阅的软件：它有效吗？

> ID：564390
> 
> 赞同：6
> 
> 时间：2009-02-19T08:23:00.960
> 
> 标签：subscription

不久前，我在一家销售专业软件产品的软件公司工作。他们经常会免费发布补丁和需要升级费用的新版本。这通常是软件行业的运作方式。

一段时间后，该公司决定了一项新战略，即基于订阅的软件。事实证明，这是软件公司对其软件执行的每项“交易”收取少量增量费用的一种方式。在这种模式下，补丁和升级包含在每笔交易费用中，并且为了收取费用，每隔一段时间就会对交易数量进行“真实调整”。

对我来说，这似乎是开发和销售软件的更好方式。软件公司获得持续的收入流，客户不必担心升级成本等，如果客户真的很大，那么您的收入流会随着他们的增长而增长。

问题（以及这个问题的原因）是我看不到有人再这样做了。是因为这个模型行不通吗？我是否对开发和销售软件采取了过于简单化的观点，而没有看到该模型的某些负面影响？

**[编辑]**我对开发人员关于编写基于订阅的软件是否是开发软件的好方法的意见感兴趣。

所以这个问题是针对那些从事商业应用程序的专业开发人员的： **任何人都可以谈谈这个模型的经验，以及为什么它有效/无效？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T08:39:59.267

我曾经在一家公司工作，该公司从产品许可证转向基于订阅的模式。以下是对此的一些观察：

1.  提供产品许可和订阅模式
2.  在产品许可证中：用户购买“n”个席位供他们使用。
3.  在订阅模式中，客户*购买您的软件“x”个月时间和“y”人。*
4.  如果您的公司还开发“顾问”，他们将与您的客户一起在客户现场获得软件实施等（任何所需的安装、培训等），这将对您有很大帮助

事实上，如果您看到 GMail 企业、Fogbuz 等服务，它们会提供不同的定价选项：

*   您希望应用托管的位置：您的服务器或其服务器
*   每使用该软件的人数将向您收取 $x

我认为订阅模型（基于时间）在当前肯定会起作用，事实上云模型有助于实现收入模型的这种自由：例如，您可以选择“订阅”云数据库而不是购买数据库服务器.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T08:55:52.443

是的，它确实。有关示例，请参见[salesforce.com 。](http://www.salesforce.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T08:40:23.913

不完全一样，但[37Signals](http://www.37signals.com/)的 basecamp 非常成功，按月收费，[FogBugz](http://www.fogcreek.com/FogBugz/)也使用相同的模型。您在这里谈论的方法似乎类似于早期在网络上被视为收入来源的 MircoPayment 想法。我不确定是否有人成功地从这种模式中赚钱，我敢肯定很多 VC 都花在尝试上。

**[编辑]**我认为这是小型 ISV 经营业务的绝佳方式。SAAS 和订阅的结合是快速获得收入的好方法。有很多优点

1) 持续收入

2) 小额或零初始付款，吸引客户，解决信用卡价格问题（每月收取 10 美元比一次性收取 100 美元更容易）

3) 在 ISV 和供应商之间建立稳固的关系

4) 有机会追加销售，假设产品不错

成为大型软件供应商的唯一方法是先成为小型软件供应商。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T09:28:03.770

红帽似乎认为它有效。购买一年的支持获得所有升级/etc/etc。除了他们让你在年底时保留产品（所以..我猜客户也喜欢这样=）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T08:43:50.070

由于软件开发的性质，基于订阅的模型确实是要走的路，但是如何确保您有持续的更新，实际上使软件值得订阅费用。

如果您提供服务，那么激励免费订阅会容易得多，但如果您计划让人们按月支付每月发布的费用，那么成功与彻底失败之间的界限就在一线。我不明白这将如何与大多数软件一起使用。

### 更新：@Dscoduc

那时我会称之为服务。明确区分软件发布计划和支持。如果您想为高级支持交易收费，那么该服务必须是原始的。但我确实看到它是如何工作的。人们最终可能会在无需编程经验且成本低廉的前提下购买基于订阅的软件，这样他们就可以对其进行定制以满足他们的需求。

您的挑战在于能够倾听您的客户并真正找到一种方法来获取他们的反馈，并将其作为您软件生命周期的基础，而这并不是一件容易的事情。

*也许我们应该向 stackoverflow 申请一种标记与编程无关但对程序员感兴趣的内容的方法。*

# vim - Specman 的 VIM 语法文件

> ID：564391
> 
> 赞同：2
> 
> 时间：2009-02-19T08:24:55.433
> 
> 标签：vim, syntax-highlighting, specman

在哪里可以找到 specman 的更新语法文件？网上有很多这样的，但我想要一个有建议的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T00:19:40.600

我不使用 VIM，但这是我们在项目 wiki 上发布的： [http ://www.specman-mode.com/specman-vim.html](http://www.specman-mode.com/specman-vim.html)

我知道我的团队中有很多人对此感到满意。

# java - 将对象数组转换为其原始类型的数组

> ID：564392
> 
> 赞同：82
> 
> 时间：2009-02-19T08:26:50.047
> 
> 标签：java, arrays, primitive-types

如果您有一组具有原始类型（例如字节、整数、字符等）的 Java 对象。有没有一种巧妙的方法可以将其转换为原始类型的数组？特别是，这可以在不必创建新数组并循环内容的情况下完成。

例如，给定

```
Integer[] array 
```

将其转换为最简洁的方法是什么

```
int[] intArray 
```

不幸的是，当在 Hibernate 和一些我们无法控制的第三方库之间进行交互时，这是我们必须经常做的事情。看起来这将是一个很常见的操作，所以如果没有捷径，我会感到惊讶。

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-02-19T09:07:54.473

[Apache Commons Lang](http://commons.apache.org/proper/commons-lang/)再次成为您的朋友。他们提供[了 ArrayUtils.toPrimitive()](http://commons.apache.org/proper/commons-lang/javadocs/api-release/org/apache/commons/lang3/ArrayUtils.html#toPrimitive(java.lang.Integer[]))，这正是您所需要的。您可以指定要如何处理空值。

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2014-07-13T06:27:42.800

使用Java 8 中引入的[流](http://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html)可以做到这一点：

```
int[] intArray = Arrays.stream(array).mapToInt(Integer::intValue).toArray(); 
```

但是，目前只有`int`,`long`和的原始流`double`。如果您需要转换为另一种原始类型，例如`byte`没有外部库的最短方法是这样的：

```
byte[] byteArray = new byte[array.length];
for(int i = 0; i < array.length; i++) byteArray[i] = array[i]; 
```

或者，如果您愿意，可以将 for 循环替换为流：

```
IntStream.range(0, array.length).forEach(i -> byteArray[i] = array[i]); 
```

`NullPointerException`如果您的任何元素是，所有这些都会抛出`null`.

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2009-02-19T08:37:31.190

不幸的是，Java 平台中没有任何东西可以做到这一点。顺便说一句，您还需要显式处理数组`null`中的元素（您打算为这些元素使用什么？）。`Integer[]``int`

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2013-09-13T20:05:31.200

使用[番石榴](https://code.google.com/p/guava-libraries/)：

```
int[] intArray = Ints.toArray(Arrays.asList(array)); 
```

文档：

*   [`Arrays.asList`](http://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#asList-T...-)（核心 API）
*   [`Ints.toArray`](https://google.github.io/guava/releases/snapshot/api/docs/com/google/common/primitives/Ints.html#toArray-java.util.Collection-)（番石榴）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-19T08:41:46.110

> 特别是，这可以在不必创建新数组并循环内容的情况下完成。

在 Java 中，您不能将 Integer 数组转换为 int（即，您不能更改数组元素的类型）。因此，您必须创建一个新的 int[] 数组并将 Integer 对象的值复制到其中，或者您可以使用适配器：

```
class IntAdapter {
    private Integer[] array;
    public IntAdapter (Integer[] array) { this.array = array; }
    public int get (int index) { return array[index].intValue(); }
} 
```

这可以使您的代码更具可读性，并且 IntAdapter 对象只会消耗几个字节的内存。适配器的最大优点是您可以在此处处理特殊情况：

```
class IntAdapter {
    private Integer[] array;
    public int nullValue = 0;
    public IntAdapter (Integer[] array) { this.array = array; }
    public int get (int index) { 
        return array[index] == null ? nullValue : array[index].intValue();
    }
} 
```

另一种解决方案是使用包含许多预定义适配器的[Commons Primitives 。](http://commons.apache.org/primitives/)在您的情况下，请查看[ListIntList](http://commons.apache.org/primitives/api-release/org/apache/commons/collections/primitives/adapters/ListIntList.html)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-19T08:46:38.830

或者如果你只做一次，就用简单的方法做。但是您还没有谈到 Integer!=null 案例。

```
 //array is the Integer array
    int[] array2 = new int[array.length];
    int i=0;
    for (Integer integer : array) {
        array2[i] = integer.intValue();
        i++;
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-01T20:17:47.490

使用[美元](http://bitbucket.org/dfa/dollar)很简单：

```
Integer[] array = ...;
int[] primitiveArray = $(array).toIntArray(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-07-14T17:28:06.057

这是所有原始类型的通用解决方案

```
/**
 * Convert Collection to equivalent array of primitive type
 * @param <S> [in] Object type of source collection
 * @param tcls [in] class of the primitive element
 * @param q [in] source collection
 * @return Equivalent Array of tcls-elements, requires cast to "tcls"[]
 */
public static <S> Object asPrimitiveArray(Class<?> tcls, Collection<S> q)
{
    int n = q.size();
    Object res = Array.newInstance(tcls, n);
    Iterator<S> i = q.iterator();
    int j = 0;
    while (i.hasNext())
    {
        Array.set(res, j++, i.next());
    }
    return res;
}

/**
 * Convert Object array to equivalent array of primitive type
 * @param <S> [in] Object type of source array
 * @param tcls [in] class of the primitive element
 * @param s [in] source array
 * @return Equivalent Array of tcls-elements, requires cast to "tcls"[]
 */
public static <S> Object asPrimitiveArray(Class<?> tcls, S[] s)
{
    return asPrimitiveArray(tcls, Arrays.asList(s));
} 
```

对于整数到整数的转换

```
Integer[] a = ...
int[] t = (int[]) asPrimitiveArray(int.class, a); 
```

# c# - 使用 msi 文件进行本地化

> ID：564397
> 
> 赞同：0
> 
> 时间：2009-02-19T08:28:28.827
> 
> 标签：c#, windows-installer

在我的应用程序中，我想支持 2 种语言（英语和阿拉伯语）。现在，我将帮助文件的英文版放在某个路径中。如果我希望用户选择他想要安装他的应用程序的语言并根据选择我将把相关的 chm 文件放在该路径中。

Q 的另一部分，我可以做一些事情，比如当你安装一个应用程序时，它会询问你的语言，然后它只抛出相关`exe`文件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T09:09:04.127

您没有告诉您如何在应用程序中实现本地化。由于您在 .NET 中进行开发，因此我假设您有一个包含所有本地化数据的每种语言的 .resx 文件。那么为什么不安装这两个帮助文件并将帮助文件的路径作为资源文件中的本地化字符串呢？

顺便说一句，使用本地化的资源文件，您将只需要安装一个可执行文件。您可以在加载表单的过程中通过指定`CultureInfo.CurrentUICulture`相应的语言来选择将使用的语言，例如基于配置设置或注册表项。

关于问题的第二部分：您可以让您的用户选择目标语言。这将设置上述配置设置或注册表项。但是，在安装过程中更改语言不会更改 MSI 安装程序的 UI 语言（我认为不支持 *）。

因此，我建议您为每种语言使用单独的安装程序或使用不同的安装系统（NSIS 似乎是一个不错的选择）。

*) MSI 可以根据为用户定义的区域设置[自动选择 UI 语言。](http://www.installsite.org/pages/en/msi/articles/embeddedlang/)但是，这种行为不受官方支持，实现它的方法也有点复杂。

# asp.net - 使用带有输出缓存的 ASP.NET AJAX UpdatePanel

> ID：564403
> 
> 赞同：1
> 
> 时间：2009-02-19T08:33:07.583
> 
> 标签：asp.net, updatepanel, outputcache

有没有办法让 UpdatePanel 控件与输出缓存很好地配合使用？我想使用 @OutputCache 指令缓存整个 ASP.NET 页面，UpdatePanel 区域除外。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T09:37:31.780

你看过 asp:substitution 控制吗？

[http://msdn.microsoft.com/en-us/library/ms228212(v=vs.100).aspx](http://msdn.microsoft.com/en-us/library/ms228212(v=vs.100).aspx)

# wpf - 轻量级的可模板化 WPF 形状

> ID：564404
> 
> 赞同：3
> 
> 时间：2009-02-19T08:33:22.637
> 
> 标签：wpf, templates, shape

我使用椭圆和其他形状作为屏幕标记，我希望其他人能够使用模板更改这些视觉效果。但是，由于形状不支持模板，我不得不创建一个基本的 UserControl，它默认显示一个椭圆，然后使用它而不是基本形状。

有没有人有更整洁的解决方案？我有点担心如果我在屏幕上创建 1000 个这样的性能/内存会有点开销。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T08:40:10.733

`UserControl`源自`ContentControl`。听起来好像您不需要内容（在形状内托管其他控件的能力），所以我会继续提升层次结构......

以下是血统分析：

```
UserControl
    ContentControl
        Control
            FrameworkElement
                UIElement
                    Visual
                        ... 
```

[`Control`](http://msdn.microsoft.com/en-us/library/system.windows.controls.control.aspx)定义[`Template`](http://msdn.microsoft.com/en-us/library/system.windows.controls.control.template.aspx)属性，所以我认为实现你想要的最简单的方法是使用`Control`：

```
<Control Style="{StaticResource MyStyle}"/> 
```

...并使用 a`Style`设置您需要的模板和任何触发器/等。

但是，如果您确实需要在形状内托管子元素，则应该`ContentControl`这样使用：

```
<ContentControl Style="{StaticResource MyStyle}"/> 
```

如果您发现这种方法在运行时过于繁重，那么您可以考虑使用[Shape](http://msdn.microsoft.com/en-us/library/system.windows.shapes.shape.aspx)。

```
Shape
    FrameworkElement
        UIElement
            Visual
                ... 
```

`Shape`不继承自`Control`，而是直接继承自`FrameworkElement`。它不可模板化。它是一个抽象类，您需要创建自己的自定义子类，该子类知道如何通过`DefiningGeometry`属性描述自己的表示。这可能比在 a 上定义样式更复杂`Control`，但是如果您需要额外的性能，那么您可能必须走这条路。

**编辑**您可能还想查看[DrawingVisual](http://msdn.microsoft.com/en-us/library/ms742254(VS.85).aspx)。来自 MSDN：

> DrawingVisual 是一个轻量级的绘图类，用于呈现形状、图像或文本。这个类被认为是轻量级的，因为它不提供布局或事件处理，从而提高了它的性能。

它也不是可模板化的，但如果您需要原始性能，那么值得一看。

# ruby-on-rails - 寻找页面设计师

> ID：564409
> 
> 赞同：0
> 
> 时间：2009-02-19T08:38:54.573
> 
> 标签：ruby-on-rails

我的网站目前有一些静态页面。我正在寻找一个rails wysiwyg webtool，我可以使用它动态更改那些静态页面（带有图像）。页数是固定的，我不必动态添加新的。

**更新** 该站点已经分配了一个设计模板，我不需要更改。我只需要能够更改某些页面的内容。

有人可以给我一些建议吗？

谢谢 Stijn

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T08:55:56.483

尝试[辐射 CMS](http://radiantcms.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T08:59:38.877

您是否正在寻找一种有助于编辑静态 HTML 文件但使用 Web 浏览器界面的服务器站点工具？

如果是这样，我认为这只解决了部分问题。您的页面可能仍然有一些常见的“家具”，例如横幅窗格、左窗格、右窗格、页脚。如果要更改这些，则必须编辑每个文件。如果您在横幅中有电话号码怎么办 - 如果更改了，最好集中更改。

这些是内容管理系统解决的问题，因此如果您不熟悉这些问题，您可能需要阅读 CMS。

要比较 CMS 系统，请参阅：[http ://cmsmatrix.org/matrix/cms-matrix?func=search](http://cmsmatrix.org/matrix/cms-matrix?func=search)

您可以在搜索表单的语言字段中输入“Rails”或“Ruby”

# java - ICEfaces：如何禁用某些表单的发送接收更新机制

> ID：564411
> 
> 赞同：1
> 
> 时间：2009-02-19T08:39:25.320
> 
> 标签：java, ajax, jsf, icefaces

我对 ICEfaces 还很陌生，但总体上已经有 JSF/Facelets 和 Java EE 的经验。

目前，除了一些实用程序标签（如 outputStyle 和 outputDeclaration）之外，我并没有使用太多 ICEfaces，但即使这样也真的很不错。

尽管我计划稍后使用一些 AJAX 功能，但我有一些 h:forms（或 ice:forms）我想作为正常的 JSF POST 请求发送，而不通过 /block/send-receive-updates。原因是，我想使用一个过滤器，它作用于请求的 URI，如果所有内容都发送到 /block/send-receive-updates，这是不可能的。

有没有办法做到这一点？

**编辑：**澄清我想要做什么：

我们正在开发的网站由公开的页面和一些只有注册会员才能访问的页面组成。servlet 标准中定义的基于 FORM 的标准安全机制非常不灵活，因为它只允许定义显示的单个登录页面，当有人想要访问某些受限内容时。因为我们还希望用户能够使用每个页面上可见的小型登录表单来登录，所以我们开发了一个过滤器，它几乎像 Web 容器一样处理身份验证和授权。如果用户未经过身份验证/授权，它会重定向到自定义登录页面，但也允许从支持 bean 对用户进行身份验证。为了使其工作几乎透明，它包装了 HttpServletRequest 以提供 Principal 和用户角色。

当过滤器重定向到自定义登录页面时，它会保存当前请求，以便稍后在用户成功通过身份验证时“重放”它。为此，过滤器必须能够检测 POST 请求是否来自登录页面（因此用户现在是否已通过身份验证/授权）。但是，如果每个 POST 都通过 /block/send-receive-updates 进行，这将不再起作用。

当然，我可以排除登录页面由 ICEfaces 处理，但这意味着我不能在登录页面上使用任何 ICEfaces/AJAX。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T16:37:45.743

我已经使用 IceFaces 将近一年了，还没有遇到任何不通过 send-receive-updates 提交表单的方式。但我很好奇，你说“我打算稍后使用一些 AJAX 功能”。IceFaces 的重点是它几乎透明地将 AJAX 添加到您的 JSF 应用程序中。这是一种“全有或全无”的事情——任何使用 IceFaces 的页面都将使用 AJAX。

我能想到的唯一一件事就是不要将 IceFaces 用于要在其上使用 POST 请求的页面 - 即，您可以将 IceFaces 页面映射到 *.iface，但将普通 JSF 映射到 *.faces。

或者，很可能还有其他方法可以完成您想要使用过滤器执行的操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-25T00:59:49.840

这可能不是最好的方法，但它可能是*一种*方法。为了争论，我假设您的标题包含您的额外登录表单。如果您要在单独的框架或主布局页面中制作标题并将您的 JSF 页面嵌入到 iframe 中，这可能会起作用。这个想法是因为它被呈现为一个单独的页面，您可以以单独的方式处理它。

此外，可能有一种不同的方式来处理您的安全性，这会使它更像 IceFaces-y。也许，当您点击过滤器并确定您没有登录时，它应该创建一个 bean（可能是会话），其中包含来自原始请求的信息（URL、参数等）并将您发送到登录页面。登录页面完成它的工作，添加您的安全内容，然后使用该会话 bean 中的信息强制重定向到您的新页面。您可以使用 FacesContext 来获取您的 HttpContext 并进行重定向。您可能需要使用重定向来添加任何适当的参数。最后，您应该摆脱会话 bean。

最后，我知道有几个框架（Spring WebFlow，*我*想到了）可以保存您的请求状态，让您进行登录，并将您无缝地重定向回最初的位置（其中，提醒我，我认为 Seam 也可以做到这一点。可能 Orchestra 和您的其他框架也是如此。）

希望这可以帮助！

# wcf - System.Net.Sockets 如何在查找 WCF 服务的上下文中执行其 DNS 查找？

> ID：564412
> 
> 赞同：1
> 
> 时间：2009-02-19T08:39:56.193
> 
> 标签：wcf, iis, permissions, dns, application-pool

我在同一个 Windows 2003 开发服务器上托管了一个 Web 应用程序和一个 WCF 服务。它们每个都有自己的 IIS 网站节点，分别响应 drs.displayscreen.web 和 drs.displayscreen.service 主机头。hosts 文件包含两个指向 127.0.0.1 的标头的条目。该网站有一个对 drs.displayscreen.service 的服务引用。

当它们的应用程序池使用“网络服务”帐户时，这两个应用程序都能完美运行。

我需要在服务的后台执行一些 COM 处理，因此我想以自定义身份运行应用程序。两个站点都在一个新的应用程序池上运行。

当我更改应用程序池标识以使用为此目的创建的新 Windows 帐户时，我收到以下（内部）异常： [EndpointNotFoundException: Could not connect to [http://drs.displayscreen.service/Handler.svc](http://drs.displayscreen.service/Handler.svc)。TCP错误码10060：连接尝试失败，因为连接方在一段时间后没有正确响应，或者连接失败，因为连接的主机没有响应192.168.98.2:8080。]

192.168.98.2:8080 是不再使用的 DNS 服务器的地址。解决方案中的任何地方都没有引用它。ipconfig 根本没有引用它。

我已确保新帐户是 IIS_WPG 的成员，并且我已运行 aspnet_regiis -ga 。我还明确授予该帐户读取主机文件的权限。

为什么应用程序尝试使用失效的 DNS 服务器来解析临时 url (drs.displayscreen.service) 而不是主机文件条目？它必须是某种权限，因为它在网络服务帐户下运行时没有这个问题。帮助！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T12:37:22.753

好吧，看来答案可能涉及 .Net 框架中的错误。我发现[一篇博客文章](http://codicesoftware.blogspot.com/2008/10/troubles-in-net-remoting-when-ip.html)让我了解到 SocketCache.GetSocket 的 MS .Net 实现可能会缓存无效的套接字，而[另一个](http://abstrusemind.wordpress.com/2007/04/11/exceptions-uggh/)则以显式不使用代理配置设置的形式提出解决方法/黑客攻击.

在出现此问题的环境中，我们实际上并未使用代理服务器，但似乎 SocketCache.GetSocket 在设置了不使用代理设置时被覆盖或行为不同。奇怪的是，删除设置会导致问题再次出现，因此很明显，当发现并成功使用有效的 ip/主机名时，SocketCache 并未修复。根据上面提到的第一篇文章的作者所说，该错误在 Mono 中不存在。:)

# apache-flex - 单击不是子菜单的项目时的 Flex menuBar 事件

> ID：564417
> 
> 赞同：1
> 
> 时间：2009-02-19T08:40:42.353
> 
> 标签：apache-flex, events, menubar

有没有办法像子菜单中使用的那样处理 menuEvents 但在没有子菜单的顶级菜单中？

并使用如下功能：

```
 private function menuHandler(event:MenuEvent):void  {
                if (event.item.@data != "top") {
                    Alert.show("Label: " + event.item.@label + "\n" + 
                        "Data: " + event.item.@data, "Clicked menu item");
                }        
            } 
```

处理点击？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T08:58:34.167

您需要了解当有人单击您的菜单项之一时如何引发（或调度）您自己的事件

我建议通过[这个](http://livedocs.adobe.com/flex/3/html/help.html?content=16_Event_handling_5.html)来了解如何在 Flex 中管理事件。

您需要的基本内容是侦听按钮上的 MouseEvent.CLICK 事件，然后将它们作为自定义菜单事件重新调度（可能包含有关已单击哪个事件的数据）

您可能还想看看 TabBar 组件，因为它可能包含您可能想要的菜单栏的所有功能。

# iphone - 移动 UITableView 行，然后选择它后，它只在边缘变成蓝色

> ID：564420
> 
> 赞同：4
> 
> 时间：2009-02-19T08:42:32.427
> 
> 标签：iphone, uitableview

我有一个`UITableView`可重新排序的行，我正在使用标准`UITableViewCell.text`属性来显示文本。当我点击编辑，移动一行，点击完成，然后点击该行时，内置`UILabel`变为完全白色（文本和背景）并且不透明，并且单元格的蓝色阴影不会显示在其后面。是什么赋予了？有什么我不应该做的事情吗？我有一个hacky修复，但我想要真正的McCoy。

以下是如何重现它：

从 iPhone OS 2.2.1 SDK 中的标准“基于导航的应用程序”模板开始：

1.  打开 RootViewController.m

2.  取消注释`viewDidLoad`，并启用 Edit 按钮：

    ```
    - (void)viewDidLoad {
        [super viewDidLoad];
        // Uncomment the following line to display an Edit button in the navigation bar for this view controller.
        self.navigationItem.rightBarButtonItem = self.editButtonItem;
    } 
    ```

3.  指定表格有几个单元格：

    ```
    - (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
        return 4;
    } 
    ```

4.  在`tableView:cellForRowAtIndexPath:`中，添加一行来设置单元格的文本属性，因此要使用内置的 UILabel 子视图：

    ```
    // Set up the cell...
    cell.text = @"Test"; 
    ```

5.  要启用重新排序，请取消注释`tableView:moveRowAtIndexPath:toIndexPath:`。默认实现是空白的，在这种情况下很好，因为模板不包含数据模型。

6.  为 Simulator、OS 2.2.1、Build and Go 配置项目。当应用程序出现时，点击编辑，然后将任意行滑动到新位置，点击完成，然后一次点击每一行。通常点击会选择一行，将其变为蓝色，并将其文本变为白色。但是在您刚刚移动的行上轻按一下，*就会*使 UILabel 的背景颜色为白色。结果是一个令人困惑的白色开放空间，边缘有蓝色条带。奇怪的是，在第一次虚假点击之后，另一次点击似乎可以纠正问题。

到目前为止，我已经找到了一个修复它的黑客，但我对此并不满意。它的工作原理是确保内置`UILabel`是不透明的，并且在选择后立即没有背景颜色。

```
- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    // hacky bugfix: when a row is reordered and then selected, the UILabel displays all crappy
    UITableViewCell *cell = [tableView cellForRowAtIndexPath:indexPath];
    for (UIView *view in cell.contentView.subviews) {
        if ([[view class] isSubclassOfClass:[UILabel class]]) {
            ((UILabel *) view).backgroundColor = nil;
            view.opaque = NO;
        }
    }

    // regular stuff: only flash the selection, don't leave it blue forever
    [tableView deselectRowAtIndexPath:indexPath animated:YES];
} 
```

这似乎可行，但我不希望它永远是一个好主意。解决此问题的正确方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T01:27:30.657

这看起来像是 UITableView 渲染中的一个错误，您应该提交一份 Radar 错误报告。就像移动后单元格没有正确刷新一样。

目前解决此问题的一种方法是不使用内置标签，而是在单元格中滚动您自己的标签：

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {

    static NSString *CellIdentifier = @"Cell";

    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
    if (cell == nil) {
        cell = [[[UITableViewCell alloc] initWithFrame:CGRectZero reuseIdentifier:CellIdentifier] autorelease];

        CGRect frame = cell.contentView.bounds;
        frame.origin.x = frame.origin.x + 10.0f;

        UILabel *textLabel = [[UILabel alloc] initWithFrame:frame];
        [textLabel setAutoresizingMask:UIViewAutoresizingFlexibleRightMargin];
        textLabel.tag = 1;
        textLabel.textAlignment = UITextAlignmentLeft;
        textLabel.backgroundColor = [UIColor clearColor];
        textLabel.textColor = [UIColor blackColor];
        textLabel.font = [UIFont boldSystemFontOfSize:20.0];
        textLabel.numberOfLines = 1;
        textLabel.highlightedTextColor = [UIColor whiteColor];
        [cell.contentView addSubview:textLabel];
        [textLabel release];

    }

    UILabel *textLabel = (UILabel *)[cell viewWithTag:1];
    textLabel.text = @"Test";

    return cell;
} 
```

我试过这个，它没有显示出与内置标签相同的白色空白矩形。但是，将另一个非透明视图添加到表格单元格可能不是整体渲染性能的最佳选择。

我不知道这是一个多么严重的故障，因为 Apple 不希望您在表格行上保留选择突出显示（他们最近在审查过程中一直在执行此操作）。您应该选中复选标记或通过选择移动到导航层次结构中的下一个级别，此时此白色框只会在屏幕上显示几分之一秒。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-06T07:54:41.253

布拉德解决方案的诀窍似乎是：

> textLabel.backgroundColor = [UIColor clearColor];

如果您将背景保留为默认值，即使您滚动自己的单元格 UITableViewCells，您仍然会遇到问题。我将其保留为默认值的原因是因为文档说使用不透明背景的计算成本更低。理想情况下，我不想使用 [UIColor clearColor] 来修复此错误。

也许一个完全定制的涂漆单元会以某种方式修复它。我以前没有尝试过这些。

还有其他人对此有解决方案吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-16T22:44:52.370

感谢您提供信息，我正在寻找如何从 UILabel 中擦除背景颜色。

我使用了以下行：

textLabel.backgroundColor = [UIColor clearColor];

并且工作完美！！！

谢谢

亚历杭德拉:)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-02-27T00:42:38.190

选择并不意味着长时间显示！（我们的几个应用程序都遇到了这个问题）

？？？这意味着 Apple 不会在 iPhone 上批准他们自己的日历应用程序！当您去编辑事件的开始和结束时间时，开始时间是无限期选择的，只有在用户点击下一个字段时才会更改。

# windows - 哪些 Windows CVS 客户端支持正确处理注释中的编码？

> ID：564425
> 
> 赞同：1
> 
> 时间：2009-02-19T08:44:16.620
> 
> 标签：windows, cvs, tortoisecvs

我们目前正在使用 tortoisecvs (1.8.31) 提交/访问我们的 cvs 存储库。

我们最近希望在评论中支持日文文本，以便可以使用 viewvc 进行浏览。但是，您似乎无法将 Tortoisecvs 发送的评论的编码设置为正确转换/发送为 UTF8。

Tortoisecvs 输出示例：

```
In D:\Workspace\dummy\src: "C:\Program Files\TortoiseCVS\cvs.exe" -q commit -m コミットテスト日本語 dummy.py
CVSROOT=:pserver:username@cvs.project.repository.com:/cvsroot/dummy

/cvsroot/dummy/src/dummy.py,v  <--  dummy.py
new revision: 1.10; previous revision: 1.9

/opt/viewvc-1.0.5/lib/cvsdb.py:198: Warning: Incorrect string value: '\x83R\x83~\x83b...' for column 'description' at row 1
  cursor.execute(sql, sql_args) 
```

我通过 Eclipse 提交确认 cvs 存储库/viewvc 支持日语，您可以在其中定义发送到存储库的注释的编码。但是，我们的大部分开发都不是在 Eclipse 中完成的。

有没有办法让 tortoisecvs 为评论分配正确的编码？或者，如果它是与命令行相关的问题，有没有办法将窗口更改为默认为 utf-8？（这会解决它吗？）（Tortoisecvs 似乎只是在调用一个命令行工具，我假设它只是将默认系统的编码应用于文本）

如果没有，哪些 Windows CVS 客户端（如果有）支持正确处理注释中的编码？

**更新** 删除了 SVN，经过测试，SVN 正确处理编码并以 UTF-8 传输注释。谢谢，斯特凡澄清这一点。

在 sourceforge 上的 tortosiecvs 项目中找到了这个请求：

[https://sourceforge.net/tracker/index.php?func=detail&aid=1592167&group_id=48103&atid=451975](https://sourceforge.net/tracker/index.php?func=detail&aid=1592167&group_id=48103&atid=451975)

它从 2006 年开始营业。我想这对很多人来说都不是什么大问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T09:44:29.767

我不认识任何客户，但您是否报告了针对 tortoisecvs/svn 的错误？修复它可能很容易。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T12:19:37.227

Subversion 客户端需要将所有编码为 utf-8 的字符串传递给底层 API，从而传递给服务器。TortoiseSVN 绝对可以做到这一点。就像我尝试过的所有其他 SVN 客户端一样（而且还不到两年）。

当然，如果机器上安装了相应的字体，您只能输入/显示日文注释。

如果您可以在提交到 SVN 存储库之前在 eclipse 中指定编码，那么这是 eclipse（或负责 SVN 访问的 eclipse 插件）中的错误。因为，正如我提到的，SVN 客户端**必须**使用 utf-8 编码的字符串

# project-management - 项目经理是否应该询问实现某些功能需要多少时间？

> ID：564426
> 
> 赞同：6
> 
> 时间：2009-02-19T08:45:00.627
> 
> 标签：project-management, estimation

我们的项目经理通常会咨询开发人员他们需要多少小时来实现客户要求的某些功能。这是否符合管理原则？您或您的项目经理是否也这样做？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-19T08:48:19.433

没有其他方法可以知道某件事需要多长时间。真的，你应该感谢你的 PM 甚至在咨询你——太多的经理与客户聚在一起，承诺不可能的时间表，然后期望开发人员兑现他们离谱的承诺。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-19T08:48:54.923

当然。如果没有得到开发时间的估计，没有人知道发生了什么。您需要能够管理利益相关者的期望，在这种情况下是您的客户。更好的估计来自马嘴（在这种情况下是开发人员），而不是 PM 承诺不可能的时间框架！

开发人员有时会对进行这种性质的估计感到有趣（我知道我会这样做），但这对于经营业务至关重要。处理它的最简单方法是了解 PM 只是想要信息。开诚布公——不要说事情不会做，但要解释什么时候和为什么事情可能是未知的，或者为什么你的估计可能存在风险因素。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-19T08:53:07.660

是的，您无法摆脱想要确切了解某件事需要多长时间的 PM。

我的方法是给出带有 +/- 值的估计值。我有 60% 的把握我会在一周内完成这个，有 30% 的机会会更长，有 10% 的机会会是 2 天。PM 需要一段时间才能习惯这个想法，但这是现实情况。正如某位智者曾经说过的那样，只有[在这里插入神]可以改变现实，无论首相希望它有多大不同。

我们知道，Dev 是一门不精确的科学，传统项目管理的张力、满足创造力和最佳猜测估计可能是专业发展的最大难题。从敏捷中学到的一个非常好的东西就是我们在估计方面有多糟糕，大多数开发人员会低估 80% 的时间——无论如何，这是我的估计。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-19T09:21:41.583

**是的，这是他的工作，因为时间=金钱**

如果你考虑到这样一个事实

1.  你是企业的一部分
2.  企业的目的是赚钱
3.  时间=金钱

那么你的经理问你**“这需要多少时间”是完全有道理的，因为它完美地转化为“这将花费多少”**。

必须有人支付这笔费用，要么是客户，要么是您的公司。PM 将使用您的估计来确保项目按时完成并在预算内完成。如果您说某事需要 10 天，而这比他想要的多 5 天，那么由他决定 a) 削减一些其他功能以实现此功能或 b) 延长截止日期。

这就是 PM 的工作，从您那里获得估算，并在交付时间和交付的功能之间取得平衡。

**你的工作是提供最好、最诚实的估计**。就像别人说的，总是给一个信心百分比。“2 天，30% 的信心”“可能 1 天，可能是 3 个最坏的情况”等。

经常被问到可能很烦人，但这是他的工作。

PS 有时“我不知道”的答案是完全可以接受的，但是您应该将其表述为“我不知道，我需要再看一下，然后我会有更好的主意”。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-19T08:52:42.857

你显然从来没有为一个不要求你估价的经理工作过。否则你会比质疑他们是否应该这样做更好。:-)

说真的，很少有经理可以对提供特定功能所需的时间做出现实的估计，主要是因为真正理解所有技术错综复杂并不是他们的工作。一个好的经理会意识到这一点，并且总是让开发人员参与进来，以便在创建时间表时对可以适合的工作进行良好的估计。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-19T08:50:38.943

我觉得挺好听的 与其只是向客户承诺一些可能会变得不切实际的事情，他似乎更好地要求将要进行此操作的人进行估算。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T08:54:26.207

条件是他接受你的回答。

如果 PM 在问你问题时心里有数，他不应该对他的结果感到惊讶。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-19T08:59:37.970

项目经理应始终询问开发人员需要多长时间。项目经理对这些估算所做的工作将根据他们自己的经验和技能而有很大差异。

如果 PM 有丰富的开发经验，他们应该能够帮助更多初级开发人员确定开发人员的估计是否有效——并希望指出他们认为估计错误的原因。此外，PM 应该能够添加开发人员倾向于忘记的其他因素——会议时间、疾病、SO 时间等，这些都会影响他们的时间。

如果 PM 几乎没有开发经验，那么最准确的估计将来自开发人员。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-19T09:55:51.580

这样做的主要优点之一是它可以帮助您在游戏的早期发现您被一项任务所淹没：如果您无法计时，您可能不知道如何解决它。

此外，如果您的估计超过一周，那么它可能会下降 100-1'000'000%（也就是“纯粹的推测”）。如果你想出“几个星期”，我建议开始分解任务并估算碎片。这将帮助您注意危险区域（您真的不知道需要多长时间）。

此过程将使您的经理能够及时为您提供完成任务所需的帮助/工具（而不是在截止日期前两天注意到重要的缺失）。

如果你对这些东西更感兴趣，我推荐《[死亡行军](http://books.google.ch/books?id=FdAZUX9H_gAC&dq=Death+March)》这本书和[极限编程](http://www.extremeprogramming.org/)网站（尤其是[这个页面](http://www.extremeprogramming.org/rules/userstories.html)）。对 XP 持保留态度：规则永远无法解决您的问题；他们只是告诉你什么对其他人有用。您将始终明智地使用它们。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-20T19:45:22.673

问比假设好得多。

我们有一位业务经理最近在一次全体员工会议上提到，一堆新功能正在开发中，它们不应该花费太多精力来实施。这对开发团队来说是个新闻！！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-19T08:49:34.393

是的。经理最好在所需时间咨询团队。团队必须在考虑所有因素的情况下提出实际的时间表。团队有责任证明提供高质量输出所需的时间是合理的。如果经理足够好，他/她会很感激并同意团队。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-19T09:10:37.540

这是一个公平的问题，只是永远不要回答即兴估计。总是从某种规范中得出估计值，这样你就可以在水平线上，这就是我的建议。

# asp.net - Microsoft.Office.Interop.Excel 的 Excel dll

> ID：564443
> 
> 赞同：10
> 
> 时间：2009-02-19T08:55:14.130
> 
> 标签：asp.net, excel, interop, asp.net-2.0

我们想在我们的 Web 应用程序中使用 Microsoft.Office.Interop.Excel。在我们的本地机器上一切正常，但在我们的测试机器上，我们遇到了问题。它既没有安装 Visual Studio 也没有安装 Office。
我们正在使用 .NET 框架 2.0，并且服务器在带有 IIS6 的 Windows Server 2003 上运行。

是否有dll需要安装在机器上或添加到web应用程序的bin中？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T09:16:40.940

您需要在服务器上安装 MS Office 和 Office Interop 程序集才能使其正常工作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T09:12:35.583

我很确定您需要在运行它的机器上安装 Office。至少这是我构建使用 Office.Interop 的桌面应用程序的经验

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T09:10:43.873

请通过以下 URL 进行重新分发：

[如何更改参考文献](http://msdn.microsoft.com/en-us/library/aa159923(office.11).aspx)

[在哪里获得分销](http://www.microsoft.com/downloads/details.aspx?familyid=3c9a983a-ac14-4125-8ba0-d36d67e0f4ad&displaylang=en)

这可能有助于您的适应。而且根据分发页面，你还需要安装office。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-07-26T13:12:39.487

开放XML？

我现在可以创建 Office 2007/Open Office 电子表格文件。

1.  指向表格
2.  包括列标题 - 可选参数
3.  检测数据类型 - 可选参数
4.  流式传输到用户或保存到文件系统或保存到文件系统然后立即下载。
5.  结果是一个 Excel 文件，其中包含被检测为数字/字符串的单元格。

# java - 通过浏览器显示多个 PDF 文件的最佳方式是什么？

> ID：564449
> 
> 赞同：1
> 
> 时间：2009-02-19T08:56:46.433
> 
> 标签：java, performance, jsp, pdf, web-applications

我正在使用 Flex 和 JSP 开发一个 Web 应用程序。

我在显示多个 PDF 文件时遇到了一些性能问题。我正在尝试显示大约 50-100 个 PDF 文件。我知道这有点疯狂。因此，我制作了将 PDF 文件转换为 JPG 格式并显示 JPG 文件的项目。

我想知道是否有办法将 PDF 的文件大小减小到 JPG 的大小。

另外，我想寻求其他可以提高性能的方法。

有谁知道为 Web 应用程序显示许多 PDF 文件（主要是文本）的好方法？或者，我应该让它显示 JPG 文件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T09:02:27.887

如果 PDF 文件主要是文本，您可能应该使用 HTML。有什么东西会阻止您从 PDF 制作常规页面吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T10:05:05.053

您可以将 PDF 转换为 rtf 文本文件，使用 rtf 文件中的文本来填充您的 HTML 页面，也许在表格中。

查看**ghostscript** lib 以进行此转换。

# sql - 将行数据拆分为列

> ID：564450
> 
> 赞同：2
> 
> 时间：2009-02-19T08:57:01.707
> 
> 标签：sql, oracle

我有一张桌子，结构简单：

> user_id, 月, 余额, balance_type

我想为每个用户显示每月选定的余额类型：

> user_id, 月, balance_1, balance_2, balance_3, balance_...

所以从数据来看：

```
ROW user_id month balance balance_type    
1   5667    09   20         2068
2   5667    08   23         2068
3   5667    07   21         2068
4   5667    06   19         2068
5   5667    10   22         2068
6   5667    09   20         2069
7   5667    08   23         2069
8   5667    06   19         2069
9   5667    07   21         2069
10  5667    10   22         2069
11  5667    09   4199       2114
12  5667    06   4329       2114
13  5667    08   4365       2114    
14  5667    10   4172,88    2114    
15  5667    07   4000       2114    
16  5667    10   572,1      6062    
17  5667    08   598,44     6062    
18  5667    07   548,4      6062    
19  5667    06   593,51     6062    
20  5667    09   575,69     6062 
```

例如，我会在第 9 个月得到：

```
user_id, month, balance_1, balance_2, balance_3, balance_4    
5667      09      20        20            4199    575,69 
```

在 SQL 或/和 PL/SQL 中对此的最佳解决方案是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T09:07:05.240

如果这是一次性要求，我可以建议一个 hack。在 user_id 和 month 上使用多个自连接（您将需要与余额类型一样多的连接）。

```
select a.user_id, a.month, a.balance balance_1, b.balance balance_2, c.balance balance_3...
from mytable a, mytable b, mytable c....
where 
a.month = 9 and
a.balance_type=1 and
a.user_id = b.user_id and
a.month = b.month and
b.balance_type=2 and
b.user_id = c.user_id and 
c.user_id = d.user_id and
c.balance_type=3.... 
```

这种解决方案可能不是最好的，但就像一次性破解一样具有魅力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T09:11:45.930

如果您有固定数量的余额类型并且 (user_id, month, balance_type) 是唯一的元组，那么您可以为每个余额类型执行一个内联子查询。例如：

```
select user_id, month, 
(select balance from balance_table bt where bt.user_id = user_id and bt.month = month and bt.balance_type = '1'),
(select balance from balance_table bt where bt.user_id = user_id and bt.month = month and bt.balance_type = '2') .....
from balance_table 
```

如果可能有多个行具有相同的 balance_type、month 和 user_id，那么您可能需要使用 pivot 命令来为每个组添加余额，这在 SQL Server 和 Oracle（仅限 11g）中都存在。比如说你有 balance_types 1,2,3,4

```
select * from balance_table pivot (select sum(balance) for balance_type IN (1,2,3,4)) 
```

如果您事先不知道有多少 balance_types，那么我认为动态生成的 sql 是唯一的方法，在这种情况下，您应该使用例如 Oracle 的 DBMS_SQL PL/SQL 包。

# performance - JMeter 在执行 JDBC 请求时使 XP 崩溃

> ID：564456
> 
> 赞同：2
> 
> 时间：2009-02-19T08:59:13.917
> 
> 标签：performance, automated-tests, jmeter

我正在使用 JMeter 2.3.2 和 XP SP3。当我尝试 JDBC 请求时，XP 崩溃。这不是很方便。

这是我第一次使用 JMeter，所以我正在寻找关于在哪里寻找的灵感。

它有一个相当简单的 JDBC 请求（简单的选择，没有参数，聚合报告等）。

数据库是 SQL 服务器，正确的 jar 在 lib 目录中，据我所知，所有设置都是正确的。

有没有人有这个问题的经验？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-20T07:37:35.010

我找到了问题，是 URL 的 IP 地址不正确。

我更改了IP地址，现在它可以工作了。日志文件中有很多“无法连接到 IP 地址”，我认为 Jmeter 或 XP 都在保持这些连接，直到缓冲区溢出。

这很奇怪，但现在我知道了答案，我无法再重现这个问题了。或许终究不是这样。无论如何，它现在有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-08T19:56:53.257

听起来 Java 内存不足并冻结了您的系统。

# python - 有人用 Google AppEngine 尝试过 mosso CloudFiles 吗？

> ID：564460
> 
> 赞同：1
> 
> 时间：2009-02-19T09:01:04.990
> 
> 标签：python, google-app-engine, storage, cloud, mosso

我想知道是否有人试图将 mosso CloudFiles 与在 Google AppEngine 上运行的应用程序集成（mosso 不提供测试沙箱，所以我无法在不注册的情况下检查自己）？查看代码，由于 AppEngine 环境中的 httplib 和 urllib 限制，这似乎不起作用，但也许有人修补了 cloudfile？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T11:56:20.653

它似乎实现了一个简单的 RESTful API，因此您没有理由不能从 App Engine 中使用它。以前，您必须使用 App Engine 的 urlfetch API 编写自己的库来执行此操作，但随着 SDK 1.1.9 的发布，您现在可以改用 urllib 和 httplib。

# java - 什么是好的免费游戏引擎？

> ID：564469
> 
> 赞同：9
> 
> 时间：2009-02-19T09:05:39.657
> 
> 标签：java, c++, python

对于C++、Java或者Python，有哪些好用的游戏+免费游戏引擎好上手？

任何类型的游戏引擎都可以。我只是想通过研究不同的游戏引擎及其功能来开始某个地方。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-19T09:13:27.207

对于我在大学的计算机图形课程，我们使用了开源[OGRE 3D](http://www.ogre3d.org/)引擎。这不仅是一个非常强大的 3D 引擎，而且是一个爆炸！

使用它开发中型游戏，您将很好地体验许多不同的[游戏编程专业](http://en.wikipedia.org/wiki/Game_programmer)。你会发现自己在做 3D 建模、音效、物理编程、人工智能等工作。

[alt text http://www.mactabilisarts.com/Images/multiplayer%20games.jpg](http://www.mactabilisarts.com/Images/multiplayer%20games.jpg)
*最近的 OGRE 3D 游戏截图*

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-12-22T23:09:57.663

Java在这里没有任何爱吗？对于 win/mac/linux/android 上的 2D 和 3D OpenGL，请尝试[libgdx](http://code.google.com/p/libgdx/)。对于 API 类似于 Java2D 的 2D，请尝试[Slick](http://slick.cokeandcode.com/)。[LWJGL](http://lwjgl.org/)用于纯 OpenGL 绑定。[Ardor3D](http://www.ardor3d.com/)或[JMonkeyEngine](http://www.jmonkeyengine.com/)用于更高级别的 3D 库。对于网络，[KryoNet](http://code.google.com/p/kryonet/)。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-19T09:06:54.867

我会建议[pygame](http://www.pygame.org/news.html) 它过去对我来说很好用。它非常易于使用，并带有 python 的好处:)

它有一个活跃的社区，可以在 Unix 和 Windows 上运行。（我没在 Mac 上试过）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-19T14:39:31.087

对于 python 游戏开发，我会考虑使用[panda3d](http://panda3d.org/)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-19T10:05:05.897

不是你想要的语言，但我仍然认为它是一个很好的引擎：[Löve](http://www.love2d.org/)，它是用[Lua 编写](http://www.lua.org/)的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-19T15:23:58.640

**Python**

我放弃了 Pygame 并开始使用[Pyglet](http://pyglet.mirror.codeflow.org/)。

它非常容易上手，非常完整（OpenGL、mp3 支持、图像格式、操纵杆...），并且有一个很好的教程。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T09:09:29.617

如果你准备好更深层次的力学但更大的自由，看看[Crystal Space](http://www.crystalspace3d.org/main/Main_Page) (C++)，如果你想使用更多已经准备好的对象，你可以考虑[Irrlicht Engine](http://irrlicht.sourceforge.net/) (C++)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-20T08:44:53.883

我也推荐[Ogre3D](http://www.ogre3d.org/about)，它相当广泛，跨平台，你可以通过现有的附加组件添加像物理这样的功能 - 或者用 C++ 编写你自己的。然而，它是一个图形引擎，而不是一个专用的游戏引擎，但附加组件修正了这一点。

更重要的是，有 Python ( [Python-Ogre](http://www.python-ogre.org/) )、Java ( [ogre4j](http://ogre4j.sourceforge.net/) ) 和 .Net ( [MOGRE](http://www.ogre3d.org/wiki/index.php/MOGRE) ) 的包装器。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-19T09:10:20.193

我听说过有关[Ogre](http://www.ogre3d.org/)的好消息，但我自己没有使用过。

在一个完全不同的领域，我认为[Blender](http://www.blender.org/)已经补充了交互功能。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-19T09:29:07.527

许多开源项目都托管在[launchpad](https://launchpad.net/)上，有些是游戏，有些使用 3rd 方引擎。也许你可以看看那里？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-19T09:48:31.223

[Garry 的 Mod](http://en.wikipedia.org/wiki/Garry's_Mod)是使用 Half-Life 2 的[Source engine](http://en.wikipedia.org/wiki/Source_engine)编写的，大概是使用[Hammer](http://en.wikipedia.org/wiki/Valve_Hammer_Editor)编辑器。

诚然，这可以说比游戏设计更接近关卡设计，但无论如何都可能很有趣。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-19T16:08:05.997

在 Java 方面，请查看[jMonkeyEngine](http://www.jmonkeyengine.com/)。它有很多[功能](http://www.jmonkeyengine.com/wiki/doku.php?id=complete_features_list)，包括使用 OpenGL 的硬件加速。我没有尝试使用它开发任何东西，但我已经关注社区一段时间了；他们在几个 JavaOne 之前做了一个演示和演示。

从客户端转移到服务器，如果您对构建 MMOG 的工具包感兴趣，请查看[Project Darkstar](http://www.projectdarkstar.com/)。它是一个服务器端框架（用 Java 编写），带有用于 Java 和 C 的客户端 SDK。整个项目由 Sun 赞助。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-12-22T23:57:20.843

如果你对 3D 游戏编程感兴趣，id Software of Doom 和 Quake 经常会发布他们引擎的源代码。您可以在此处找到 Quake I、II 和 III 的源代码，[在此处](http://www.idsoftware.com/business/techdownloads/)找到Doom 3 代码的大部分，在[此处找到](http://www.iddevnet.com/doom3/downloads.php)[Quake](http://www.iddevnet.com/quake4/) IV 。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-12-23T00:01:38.073

如果您有兴趣，有一个名为 VERGE 的 RPG 引擎。从未尝试过，但我从中听到了好消息。我认为它在 C++ 中。

# xaml - 如何让 TextBlock 右对齐？

> ID：564470
> 
> 赞同：13
> 
> 时间：2009-02-19T09:06:11.823
> 
> 标签：xaml

如何让下方状态栏中的 TextBlock 与右侧对齐？

我已经告诉它：

*   水平对齐 =“右”
*   文本对齐 =“右”

但是文字仍然不听话地坐在左边。我还有什么要说的？

```
<Window x:Class="TestEvents124.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300"
        MaxWidth="700" Width="700"
        >
    <DockPanel HorizontalAlignment="Stretch" Margin="0,0,0,0" Width="Auto">

        <StatusBar Width="Auto" Height="25" Background="#888" DockPanel.Dock="Bottom" HorizontalAlignment="Stretch">
            <TextBlock 
                Width="Auto" 
                Height="Auto" 
                Foreground="#fff" 
                Text="This is the footer." 
                HorizontalAlignment="Right"
                TextAlignment="Right"
                />
        </StatusBar>

        <GroupBox DockPanel.Dock="Top" Height="Auto" Header="Main Content">
            <WrapPanel Width="Auto" Height="Auto">
                <TextBlock Width="Auto" Height="Auto" TextWrapping="Wrap" Padding="10">
                This is an example of the content, it will be swapped out here.
                </TextBlock>
            </WrapPanel>
        </GroupBox>

    </DockPanel>

</Window> 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-19T09:25:46.927

我玩过您的代码，并通过使用 StatusBarItem 而不是 TextBlock 设法使它看起来“正确”（不是双关语）：

```
<StatusBar Width="Auto" Height="25" 
    Background="#888" DockPanel.Dock="Bottom" 
    HorizontalAlignment="Stretch" >
    <StatusBarItem Foreground="#fff" 
        HorizontalContentAlignment="Right">This is the footer</StatusBarItem>
</StatusBar> 
```

不确定 TextBlock 发生了什么 - 我的所有经验都表明，Horizo​​ntalContentAlignment 和 Horizo​​ntalAlignment 的某种组合（在 StatusBar 和 TextBlock 上）应该可以实现您想要的。无论如何 - 希望 StatusBarItem 对你有用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-04-25T16:32:47.503

```
<StatusBar>
    <StatusBar.ItemsPanel>
        <ItemsPanelTemplate>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="100"/>
                </Grid.ColumnDefinitions>
            </Grid>
        </ItemsPanelTemplate>
    </StatusBar.ItemsPanel>
    <StatusBarItem Grid.Column="0">
        <TextBlock>something</TextBlock>
    </StatusBarItem>
    <Separator Grid.Column="1" />
    <StatusBarItem Grid.Column="2">
        <TextBlock>logged in</TextBlock>
    </StatusBarItem>
</StatusBar> 
```

这个例子不会弄乱你的分隔符。基于取自[http://kent-boogaart.com/blog/the-perfect-wpf-statusbar的示例](http://kent-boogaart.com/blog/the-perfect-wpf-statusbar)

您不应该在 StatusBarItem 中放置分隔符，它会将分隔符减少为一个点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-08-04T10:37:31.387

对于任何在标题中寻找问题答案的人（不一定要在状态栏中使用），我发现 Label 比 TextBlock 更好，因为它可以控制对齐并且仍然感觉语义正确。

# c++ - 嵌入：mono vs lua

> ID：564480
> 
> 赞同：10
> 
> 时间：2009-02-19T09:09:39.257
> 
> 标签：c++, mono, lua, embedding, mono-embedding

我有兴趣了解人们在 C/C++ 应用程序中嵌入单声道（.NET 的开源实现）的经验。如何分发这样的应用程序以及依赖项是什么？我已经在 OS X 上进行了测试，mono 是一个巨大的框架（数百 MB）。我的应用程序的用户是否都需要这个大框架，或者可以将其剥离或将所有内容编译到主可执行文件中。

我以前有在 C++ 应用程序中嵌入 Lua 的经验，而且效果非常好，因为我可以将整个 lua 解释器与我的主要可执行文件静态链接。所以我没有外部依赖。可以用单声道做类似的事情吗？

这里有任何 Lua 人可以评论他们如何发现 Mono 与 Lua 相比吗？

PS：通过嵌入，我的意思是一个 C++ 应用程序，它初始化一个单声道环境并加载一个 .NET 程序集并执行它，然后允许在程序集中的 C# 代码和主可执行文件中的 C++ 方法之间进行通信。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T09:44:01.360

您可能还应该查看 Mono 的[Small Footprint](http://www.mono-project.com/Small_footprint)页面，该页面描述了如何嵌入更小的运行时。哎呀，他们自己用[月光](http://www.mono-project.com/Moonlight)做。

我希望这会有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-06-22T12:04:32.580

这是2岁的问题。所以现在情况可能会变得不同。

对我来说，最重要的一点是 GC。我为交互式应用程序和游戏嵌入了 Lua，因为需要增量 GC。目前 Lua 5.1 有精确的增量 GC，但我在 Mono 上找不到任何增量或精确 GC 的证据。所以内存会泄漏（即使它非常小！），应用程序会间歇性地挣扎。

人们说 GC 暂停可以通过调整一些参数和池化对象来解决，但正如我所经历的，如果没有任何在 GC 中**随时间分布的 GC 负载方法，它***永远*无法解决。分代GC是一种分布算法，但它过于粗糙，几乎没有帮助。

 **因为您无法通过汇集代码中使用的对象而不是您的来控制生命周期模式或重用实例。（如基础类库）

所以我不推荐 C# 平台（至少目前是 Mono 或 .NET）用于交互式/（软）实时应用程序。

* * *

编辑

我不知道 Mono 或 .NET 上是否存在任何增量/并发方法 GC。如果您可以确定他们提供了那种 GC，那么当然可以使用 :)

# iphone - 为什么检测触摸越来越慢？

> ID：564486
> 
> 赞同：4
> 
> 时间：2009-02-19T09:10:51.953
> 
> 标签：iphone, cocoa-touch

在我的游戏中，如果我多次玩特定游戏，我的触摸需要更多时间才能被检测到。它存储所有触摸，然后同时应用这些触摸。

谁能告诉我有什么问题？

在`touchesBegan`我写道：

```
if (CGRectContainsPoint([tapView frame], [touch locationInView:self])
    && tapView.alpha == 1) {
    [self callTapCode];
} 
```

这是 的代码`touchesEnded`。如果我点击并释放点击它会显示一个点击事件。

```
- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event {
    if (checkTap == TRUE && tapView.alpha == 1 )
        tap_effect_view.alpha = 0;
}

- (void)callTapCode {
    // Move player code by 6 pixels
    // not possible to write all code
} 
```

在`tapView`我不断点击。`callTapCode`将玩家移动六个像素。但过了一段时间后，我的触摸检测非常缓慢，所以玩家看起来像是在跳来跳去。我连续玩了 15 到 16 次游戏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T08:45:13.243

我找到了解决我的问题的方法。在我的游戏中，我启用了`tapView.multipleTouchEnabled = TRUE`

`tapView`是我不断敲击的视图。

当我让它`FALSE`工作时。

IE

```
tapView.multipleTouchEnabled = FALSE; 
```

我完全不知道怎么做。但它有效。

感谢您的回复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:06:55.697

您可以通过本[教程](http://www.mobileorchard.com/find-iphone-memory-leaks-a-leaks-tool-tutorial/)学习如何使用**Leaks** Instrument。这是 Xcode 附带的 Instruments 套件的一部分，除其他外，它将帮助您跟踪应用程序的内存泄漏和一般性能问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T09:53:16.237

尝试查找任何内存泄漏。也许 iPhone 必须大量使用虚拟内存。

# algorithm - 推荐一些类似 Bresenham 的 2D 球体映射算法？

> ID：564492
> 
> 赞同：2
> 
> 时间：2009-02-19T09:13:38.233
> 
> 标签：algorithm, graphics, cross-platform, rendering

我需要最快的球体映射算法。有点像布雷森汉姆的画线。
类似于我在 Star Control 2（旋转行星）中看到的实现。
是否有任何已经发明和/或实施的技术？

我真的不想重新发明自行车。请帮忙...

**问题描述。**
我在 2D 表面上有一个必须出现球体的地方。球体（让它成为地球）必须使用精细地图进行纹理化，并且必须具有自由缩放和旋转的能力。我想用地图或一些简单的坐标变换函数来实现它：球体的 2D 图像上的每个像素都被定义为球体圆柱图的像素数。这使我能够实现结果图像的抗锯齿。如果结果图片上的一个像素对应于原始地图上的多个像素（例如，靠近球体的两极），我还考虑使用 mipmap 来实现映射。在内心深处，我觉得这可以通过一些微不足道的数学来实现。但所有这些想法只是我的想法。

这个问题与这个问题有点相关：[Textured spheres without strong disconnect](https://stackoverflow.com/questions/213147/textured-spheres-without-strong-distortion)，但我的问题没有答案。

**UPD：**我想我没有硬件支持。我想要一个跨平台的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T09:49:39.817

进行这种映射的标准方法是*立方体贴图*：球体投影到立方体的 6 个边上。现代显卡在硬件层面支持这种纹理，包括全纹理过滤；我相信 mipmapping 也被支持。

另一种方法（硬件未明确支持，但可以通过程序着色器以合理的性能实现）是抛物线映射，它将球体投影到两个相对的抛物线上（每个抛物线都映射到中间的一个圆）方形纹理）。抛物线投影不是投影变换，因此您需要“手动”处理数学。

在这两种情况下，失真都受到严格限制。由于硬件支持，我推荐立方体贴图。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T10:07:57.260

有一个很好的新方法可以做到这一点：[HEALPIx](https://sourceforge.net/projects/healpix/)。

与任何其他映射相比的优势：

1.  位图可以分成相等的部分（很少失真）
2.  具有任意精度的非常简单的球体递归几何。

[示例图像](http://healpix.jpl.nasa.gov/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T22:48:47.427

我是 StarconII 的忠实粉丝，但不幸的是我不记得行星绘图的细节......

第一个选项是对球体进行三角剖分并使用标准 3D 多边形绘制它。就多样性而言，这有一定的弱点，但它使用了可用的硬件加速，并且可以看起来相当不错。

如果你想自己滚动，你可以自己光栅化它。Foley、van Dam 等人的*计算机图形学——原理与实践*有一章是关于 Bresenham 式算法的；您需要有关“扫描转换椭圆”的部分。

对于我在之前的评论中建议的点云想法：您可以通过预先选择和存储表面点的 (x,y,z) 坐标而不是 2D 地图来避免运行时参数化问题。我正在考虑部分随机化球体上的点位置，这样它们在转换（向前，向后，无论 8 ^）到屏幕上时不会导致结构化混叠。不利的一面是，您必须处理“填充”因素——在绘制颜色时总结颜色，然后除以点数。*呃,还有*,没有积分的话,你就有问题了,怎么办; 例如，如果您想以极高的放大倍率放大，您需要在这种情况下寻找*最近的*点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T07:10:17.867

您看过 Jim Blinn 的文章“[如何绘制球体](http://books.google.fr/books?id=SEPKDRC8mUQC)”吗？我无法访问完整的文章，但它看起来像你需要的。

# php - Create a multi-tabs Excel file

> ID：564503
> 
> 赞同：1
> 
> 时间：2009-02-19T09:22:16.997
> 
> 标签：php, html, tabs, export-to-excel

My PHP script have to create a multi-tabs Excel file with a report in each tab, but those reports already exists as HTML pages, so I don't want to duplicate code and work. I know I can rename a HTML file to .xls, and Excel/OpenOffice Calc will open it as a spreadsheet, but I don't know how to have severals tabs.

I do not even know if it is possible.

I already know Biffwriter and others PHP libs to create Excel file, but I am looking for a smarter solution.

Thanks, Cédric

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T09:34:05.470

[Pear Excel Spreadsheet Writer](http://pear.php.net/package/Spreadsheet_Excel_Writer) has a function to create [new Worksheets](http://pear.php.net/manual/en/package.fileformats.spreadsheet-excel-writer.spreadsheet-excel-writer-workbook.addworksheet.php) if thats what you are looking for.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T08:31:13.367

If you don't mind serving excel 2007 files, you can do this:

1.  create an excel 2007 file
2.  create all the tabs you need
3.  save the file
4.  rename the file as .zip
5.  extract the contents of the zip file

Now you can use the file structure there to populate the file corresponding to each tab with the report you need. You may want to use them as templates, keep the same code and render different files depending on whether you generate the html report of the excel report.

In the end, zip up the entire directory structure and serve it with an xlsx extension.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T09:37:35.243

Please check the URLS of [a library](http://www.codeplex.com/PHPExcel) and turorials [from IBM](http://www.ibm.com/developerworks/opensource/library/os-phpexcel/index.html) and

[from 999Tutorials](http://www.999tutorials.com/tutorial-create-excel-files-with-php.html)

# cgi - 什么是 CGI 模式？

> ID：564504
> 
> 赞同：1
> 
> 时间：2009-02-19T09:22:40.083
> 
> 标签：cgi

当我们说应用程序可以在 CGI 模式下运行时，这是什么意思？我在 cmsmatrix.org 上查看了各种 CMS 系统的功能，“CGI 模式支持”被列为一项功能。Web 应用程序可以运行的其他“模式”是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T09:24:49.673

CGI 代表“通用网关接口”，它是 Web 应用程序的旧架构。CGI 通过放置来自 HTTP 请求的变量和 fork/exec()ing CGI 进程来工作。它在 Web 开发的早期很受欢迎，因为它在 unix 主机上运行良好。Perl/CGI 在这个时代是一种流行的架构，它极大地促进了 Perl 作为一种语言的流行。

CGI 的主要声名是它不需要太多的管道，因此它可以与大多数 Web 服务器一起使用。主要缺点是 fork-exec 进程很慢，因为必须启动 CGI 脚本（这可能涉及启动 perl 或其他解释器）。在 Windows 上，生成新进程比 unix 慢得多，因此 CGI 效率更低。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T09:31:46.070

基本上，CGI 意味着网络服务器将执行一个外部进程，获取其结果（生成的 HTML 页面、图像……）并将其发送回客户端。

这有很大的缺点，因为它每次需要时都会启动外部进程，所以这可能是一个很大的开销。

您还拥有启动外部进程一次并在需要时重用它的 FastCGI。

但通常，语言直接集成在网络服务器中。例如，Apache 有一个 mod_perl 模块来执行 perl 脚本，而不是通过 CGI 执行 perl 脚本

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T09:31:07.163

[CGI](http://en.wikipedia.org/wiki/Common_Gateway_Interface)是一种协议，Web 服务器使用它来调用服务器上的可执行文件。收到请求后，它会将有关请求的信息发送到 cgi 脚本，并将该脚本的结果返回给浏览器。

一个替代方案是 fastcgi。这意味着，Web 服务器不联系脚本来回答请求，而是联系一个过程。但是，通信协议仍然相同（因此得名）。

# ruby - 在Ruby中将字符串拆分为一对字符

> ID：564510
> 
> 赞同：24
> 
> 时间：2009-02-19T09:25:12.433
> 
> 标签：ruby, regex

我有一个字符串（例如“AABBCCDDEEFF”），并希望将其拆分为一个数组，每个元素包含两个字符 - [“AA”、“BB”、“CC”、“DD”、“EE”、“FF”] .

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-02-19T09:27:17.093

试试 String 对象的[scan](http://www.ruby-doc.org/core/classes/String.html#M000827)方法：

```
>> foo = "AABBCCDDEEFF"
=> "AABBCCDDEEFF"
>> foo.scan(/../)
=> ["AA", "BB", "CC", "DD", "EE", "FF"] 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-02-19T14:55:21.643

根据您的需要，这可能会更好：

```
> foo = "AAABBCDEEFF"
=> "AAABBCDEEFF"
> foo.scan(/.{1,2}/)
=> [“AA”、“AB”、“BC”、“DE”、“EF”、“F”]

```

不确定您的输入是什么样的。上面的答案将删除任何没有一对的字符，这个将适用于奇数长度的字符串。

# java - 使用 Spring 依赖项打包并运行 Java 应用程序

> ID：564515
> 
> 赞同：5
> 
> 时间：2009-02-19T09:26:37.593
> 
> 标签：java, spring, ant, build-process, packaging

我构建了一个独立的 Java 应用程序，它具有一堆依赖项（Apache Commons 库等）以及对 Spring 框架的依赖项，而 Spring 框架又具有一堆依赖项。

我在 Eclipse 中构建了它，它运行良好。现在我需要将它部署到生产环境中，因此我试图找出将它与所有依赖项打包的最佳方法，以及如何调用它（它将从命令行调用）。

蛮力的方法是将我的项目导出为一个 jar，找到所有依赖的 jar（及其依赖项！），将它们复制到一个公共目录，编写一个包含类路径中每个的 shell 脚本并运行它。显然，这看起来既愚蠢又乏味。

我应该使用 Ant、Maven 吗？我应该将所有依赖的 Spring jar 打包到一个大文件中吗？有关处理此问题的任何提示都会有所帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T09:43:22.780

Java 部署在 2009 年仍然是愚蠢和乏味的。所以通常的选择是编写这个小脚本。如果您将所有 JAR 放入一个目录（例如`lib\`），您可以使用自动构建类路径的通用脚本（请参阅[此博客条目](http://www.1160pm.net/2009/01/26/building-a-java-classpath-from-a-windows-batch-file/)）。我建议`cd /d %~dp0`在 cd 的开头添加一个到脚本的目录。

Maven 2 有一个插件，可以将您的应用程序组装到一个“超级 JAR”（[mvn assembly:assembly](http://maven.apache.org/plugins/maven-assembly-plugin/)）中。除非您使用 DB2 JCC 驱动程序（其中包含*转换为 com.ibm* .- > ClassNotFoundException 的“COM.ibm.”包），否则此方法有效。

最后一个解决方案，如果您已经有一个可以工作的 ANT build.xml，是解压缩所有依赖的 JAR 并自己创建一个“超级 JAR”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T10:16:39.860

使用 Ant，您可以执行以下操作：

1.  将所有依赖项组合在一起。
2.  使用您的应用程序打包一个 JAR 文件，并在 MANIFEST.MF 文件中嵌入对依赖项的引用，并在 jar 中使用“Class-Path”指令。这应该消除在启动时构建类路径的需要。
3.  将它们捆绑在一起作为存档，然后分发。使用“java -jar your.jar”直接运行 jar 就足够了。

为了管理您的依赖关系，您可以使用[Ivy](http://ant.apache.org/ivy)。与 Maven 非常相似，它能够在构建时从您配置的任何存储库中检索依赖项，包括 Maven 存储库或您自己的私有存储库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T09:44:43.900

我们发现依赖管理和打包的最佳解决方案是使用 Maven 和[Assembly](http://maven.apache.org/plugins/maven-assembly-plugin/)插件。这为将项目以及所有运行时依赖项和支持脚本打包到二进制发行版中提供了一种非常优雅的方法。使用程序集的最大优势之一是可以根据需要将项目拆分为不同的组件。如果您使用的是 Spring Integration，它很常见，您将有单独的组件拆分到多台机器上。程序集插件允许您根据需要对其进行配置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-21T15:00:18.027

所有这些 Maven 的爱，没有人提到 Ivy？哦亲爱的！

好吧，这里是[Ant Ivy](http://ant.apache.org/ivy/)，这里是[与 Maven2 的比较](http://ant.apache.org/ivy/m2comparison.html)。在与几乎每个人的建议一起去之前，请先看看它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T00:01:17.523

我们正在使用带有[m2eclipse](http://m2eclipse.codehaus.org/)插件的 Maven 2；效果很好。插件有一个依赖关系图视图，将显示冲突等。

现在，如果您想将所有依赖项打包到单个 jar 中，您可以查看[Jar Jar Links](http://code.google.com/p/jarjar/)（不开玩笑！）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T09:50:48.817

您可以使用正确设置类路径的启动器。然后，您将有更多的灵活性来打包您的 JAR。您可以轻松地将它们全部放在一个目录中，这比创建“混蛋” ueber jar 要干净得多...

这样的启动器之一是[commons-launcher](http://commons.apache.org/launcher/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-21T14:22:51.847

如果您使 JAR 可执行并添加包括 ClassPath 的清单，那么您的很多顾虑都会消失。不幸的是，您确实必须将 JAR 及其依赖项压缩在一起，但您的 CLASSPATH 问题已得到解决。

创建一个 OSGi 包怎么样？我自己还没有研究过它，但它应该是打包 Java 应用程序的下一步。它用于应用服务器，如 Spring 的 dm 服务器。也许它也可以帮助你。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-21T14:41:46.963

在我的 ANT 构建脚本中，我生成了 *.bat 和 *.sh 启动脚本，其中包含在构建时根据构建的 lib 目录的内容动态构建的 JAR 列表。

例如，要创建带有适当分隔符的 jar 列表：

```
<path id="jar-classpath">
    <fileset dir="${build.war.dir}/WEB-INF/lib">
        <include name="**/*.jar" />
    </fileset>
</path>

<pathconvert refid="jar-classpath" targetos="unix" property="exec.classpath.unix">
       <map from="${build.war.dir}\WEB-INF\lib\" to="../lib/"/>
</pathconvert>

<pathconvert refid="jar-classpath" targetos="windows" property="exec.classpath.windows">
        <map from="${build.war.dir}\WEB-INF\lib\" to="../lib/"/>
</pathconvert> 
```

然后，您可以在 java 调用脚本中使用`${exec.classpath.unix}`和值。`${exec.classpath.windows}`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-17T06:43:50.210

maven-assembly-plugin 可能不是最佳选择。您应该查看 onejar-maven-plugin，如下所述：

[http://blog.jayway.com/2009/03/22/executable-jar-with-onejar-maven-plugin/](http://blog.jayway.com/2009/03/22/executable-jar-with-onejar-maven-plugin/)

它让你所有的依赖 jar 都保持在 jar 中，并且你的代码在它自己的 jar 中。所有这些罐子都放在一个更大的罐子里，它是可执行的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-04-25T00:17:10.580

你也可以使用 Gradle，这里是你可以在那里做的：

```
mainClassName = "my.App"

task runnableJar(type: Jar, dependsOn: [':assemble']) {
    from files(sourceSets.main.output.classesDir)
    from files(sourceSets.main.output.resourcesDir)
    from configurations.runtime.asFileTree.files.collect { zipTree(it) }

    manifest {
        attributes 'Main-Class': mainClassName
    }
} 
```

# accessibility - 视障人士如何处理启动失败和其他低级环境

> ID：564521
> 
> 赞同：6
> 
> 时间：2009-02-19T09:27:44.830
> 
> 标签：accessibility, boot, low-level

我知道屏幕阅读器和类似软件的存在是为了帮助盲人和视障者在 Windows 或其他操作系统中使用计算机。

我很好奇在 OS 安装程序和 BIOS 设置等较低级别的环境中提供哪些支持。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T12:34:38.860

如果它是 linux 并且您有一个外部语音合成器，您可以使用一个名为 speakup 的程序来朗读内核消息。除此之外，你运气不好，不得不打电话给眼睛比你更好的人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T23:21:43.583

在 Windows 中，视障用户确实无法在 Windows 登录屏幕出现之前使用计算机。JAWS（以及 WindowEyes 和 Hal，可能还有其他）在显示驱动程序下安装视频挂钩，这些挂钩在显示 GUI 登录之前不会加载。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T15:52:02.753

对于仅视力受损而不是完全失明的人来说，一般来说，较低级别系统的颜色比白色背景上的黑色更容易看到。增加的对比度应该会有所帮助。除此之外，我所知道的没有什么可以帮助他们的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T15:55:27.913

系统通常会在出现问题时发出标准系列的哔哔声，例如没有 CPU、没有 RAM 等。但是您只能通过阅读手册了解这些哔声的含义...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-20T04:14:29.023

通常可以从制造商/零售商处获得技术支持。只是付费的问题。显然，使用有洞察力的极客会更便宜......

# sql - 有哪些好的 SQL 播客？

> ID：564525
> 
> 赞同：5
> 
> 时间：2009-02-19T09:29:27.480
> 
> 标签：sql, sql-server, podcast

受到[这个问题](https://stackoverflow.com/questions/1644/what-good-technology-podcasts-are-out-there)的启发，因为我在那里找不到任何好的 sql 转换，而且我至今在网上找不到任何好的 sql。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T09:31:45.197

我不听它（或任何 SQL 播客），但我知道 Greg Low 的[SQL Down Under](http://www.sqldownunder.com/)，我相信它的声誉很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T09:38:04.383

很好的问题，我一直在寻找好的竞争。

Brent Ozar 和 SQL Server Pedia 上的好友提供了一些不错的播客。

[http://sqlserverpedia.com/wiki/SQL_Server_Tutorials](http://sqlserverpedia.com/wiki/SQL_Server_Tutorials)

干杯，约翰

# javascript - 如何创建 JavaScript 表单和用户特定操作？

> ID：564534
> 
> 赞同：0
> 
> 时间：2009-02-19T09:32:32.463
> 
> 标签：javascript, database, login

我想创建一个弹出窗口或 Javascript 项目，允许用户接受为我完成报价的条款。一旦他们接受了这些条款，我希望他们同意在帐户下的一个部分或标有“报价”的表格中进行报价。

请告知如何编码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T09:37:33.060

您可以使用 javascripts 确认。它将创建一个对话框，允许用户按“确定”或“取消”。您可以执行以下操作：

```
<html>
<head>
<script type="text/javascript">
<!--
function confirmation() {
    var answer = confirm("Do you agree to the terms of Service?")
    if (answer){
        window.location = "http://yoursite.com/offers.html";
    }
    else{
        alert("You must agree to continue")
    }
}
//-->
</script>
</head>
<body>
<form>
<input type="button" onclick="confirmation()" value="Continue">
</form>
</body>
</html> 
```

如果您希望在页面加载时出现此对话框，您可以将 onLoad="confirmation()" 放在 body 标记中。javascript 确认框的替代方案将类似于以下内容，我知道有些人真的不喜欢弹出窗口和确认：

```
<input type="button" onclick="window.location='http://yoursite.com/offers.html';" value="Agree">
<input type="button" onclick="alert('You must agree to the terms of service');" value="Disagree"> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T22:02:41.523

为什么不设置一个用户必须选中才能继续的复选框，而不是侵入性弹出窗口？如果未选中该复选框，则表单将不会提交或会出现错误消息，告诉用户他不接受这些条款。

除非有特定原因需要使用 JavaScript，否则我会尽量远离 JavaScript 来实现这样的功能，尤其是考虑到用户可以关闭 JavaScript。

例如（使用 JavaScript 阻止表单提交）：

```
<form name="offerForm" action="/offer" method="post" onsubmit="return this.elements['agreeTerms'].checked;">
    <!-- the rest of your form goes here -->
    <input type="checkbox" name="agreeTerms" id="agreeTerms" value="1" /> <label for="agreeTerms">I agree to the terms.</label><br />
    <input type="submit" value="Submit Offer Form" />
</form> 
```

在服务器端，我假设您在所有内容背后都有一个关系数据库。假设您有一个 users 表、一个 offer 表和一个 users_offers 桥接表来表示哪些用户接受了哪些 offer。

使用上面的示例，如果agreementTerms 返回值为“1”，您只需将新记录添加到users_offers 桥接表。如果未选中该复选框，则agreementTerms 将没有值。

如果您可以根据您的具体情况（您使用的服务器端语言、基本数据库表信息等）编辑您的问题，我将能够填写更多详细信息。

# php - $_server 中未定义的索引“PWD”

> ID：564539
> 
> 赞同：0
> 
> 时间：2009-02-19T09:34:53.800
> 
> 标签：php

当我尝试通过 php.exe 运行一个简单的 PhP 脚本时出现此错误。脚本的名称是 gulliver（无扩展名），我在命令提示符中输入：

```
php %Dir%\gulliver 
```

这是格列佛文件中的内容：

```
<?php
//***************** Operating Systems parameters  **************************
  if ( PHP_OS == 'WINNT' ) 
    define('PATH_SEP', '\\');
  else
    define('PATH_SEP', '/');

//***************** Defining the Home Directory *********************************
  $docuroot =  explode ( PATH_SEP , $_SERVER['PWD'] ); 
```

发生的错误是**PHP 通知：未定义的索引：%Directory%gulliver 中的 PWD。**

知道如何解决这个问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T09:54:12.443

[我在$_SERVER 的手册页中](http://php.net/manual/en/reserved.variables.server.php)找不到 PWD 。要找出定义了哪些索引，请使用[var_dump](http://php.net/var_dump) ($_SERVER);

如果需要“当前工作目录”，使用[getcwd](http://php.net/getcwd) ()函数。

PS：您可以使用预定义的常量 DIRECTORY_SEPERATOR，而不是定义自己的 PATH_SEP。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T10:10:39.063

那么，您通过 CLI 版本的解释器执行脚本并期望看到 $_SERVER 数组？通过 Web 服务器执行脚本时会填充哪个？

# xml - 用于应用程序配置的 XML 与数据库

> ID：564540
> 
> 赞同：11
> 
> 时间：2009-02-19T09:36:08.930
> 
> 标签：xml, entity-framework

我的应用程序配置非常分层，非常适合单个 XML。很快（YAGNI，Yeh）部分信息将被其他应用程序远程使用，这需要数据库。

因此，我开始设计数据库表并将它们映射回我的应用程序的类层次结构（使用 EF）。然而，它变成了维护的噩梦。

我很想听听其他人考虑这个问题的经验，谢谢。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-19T10:27:38.743

我们在将配置存储在数据库中以用于长时间运行的应用程序（如网站和服务）方面有着非常好的经验。好处：

*   您可以远程安全地编辑配置（用户/密码）
*   应用程序很容易`select max(lmod) from config`自动或通过信号（ping 网页或在某处创建空文件）获取更改 ( )
*   应用程序只需要每个环境（开发、测试、产品）的一项配置：要使用的数据库。如果您有应用服务器，那么您的应用程序对于所有环境都是免费的。

如果你有一个复杂的、带有默认值、列表和继承的分层配置结构，主要的问题是编辑。我们的解决方案：

*   配置表有这些行：Application varchar(32)、Key varchar(512)、Value varchar(4096)
*   每个环境一个数据库（本地开发者机器、开发测试、集成测试、生产）
*   键是分层的（option.suboption....名称）
*   默认使用“ option..name *”（例如，“* jdbc..driver”，因为我们只使用一种类型的数据库）
*   列表存储为字符串，由换行符分隔。
*   地图存储为字符串，“name=value\n”
*   有一个实现可以从文件中读取配置（用于单元测试）。将键的每个层次结构映射到一个元素（......）

配置对象隐藏了这些细节，因此应用程序只使用对象。

一个特殊的类负责在发生更改时重新读取配置。通常，我们会在一天中的某个时间更新配置，定时作业会在几个小时后重新加载它。这样，我们永远不需要同步配置方法。

但是，备份和更改历史记录是个问题。我们通过在 VCS 中使用 XML 文件来解决这个问题，然后将这些文件“上传”到数据库。这样，我们可以在上传之前验证生产配置（通过在开发人员机器上使用一组特殊的单元测试）。当它在晚上被激活时，它通常会立即工作，负责该应用程序的操作员只需要做一些测试。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T09:43:53.823

恕我直言，配置应该存在于文件中，文件适用于人们，它们适用于计算机。数据库适用于大数据，但它们对于人类的东西来说太过分了。这两者通常是相互排斥的，当你尝试将它们结合起来时，你会得到类似注册表的东西 - uggh。

为什么不将配置保留在一个文件中，并围绕它构建一个 DAL 和服务层，以便您的应用程序可以使用它。这假设您可以托管到中央服务器上，如果没有文件的多个副本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T10:07:25.313

使用数据库（可能存储此配置 xml 文件，如果您希望保留格式）具有优势 - 您可以记录/审核对配置的更改，还可以进行备份和恢复。

基本上你的问题（我看到它的方式）混合了两件事，

1.  配置应该采用什么格式（xml、.ini 文件等）
2.  它应该存储在哪里（磁盘上的平面文件，数据库中的表列）

您可以轻松地将配置 xml 文件存储在数据库中，并提供用于编辑/显示信息的界面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T10:09:15.167

配置文件应该是最容易处理的东西——所以将它们放入文件中。这样，即使使用记事本（如有必要），也可以在那里进行更改。数据库确实是一种过度杀伤，除非您希望您的配置驻留在某个全局服务器中并且所有实例都共享它。

# .net - 如何摆脱 VS2008 中的“目标程序集不包含服务类型”错误消息？

> ID：564541
> 
> 赞同：70
> 
> 时间：2009-02-19T09:36:23.517
> 
> 标签：.net, visual-studio-2008, wcf, debugging

我有一个客户端/服务器 wcf 应用程序

我的可执行文件没有定义任何`ServiceContract`东西，它甚至没有引用`System.ServiceModel`（*而是引用了一个包含与服务器的连接逻辑的程序集*）

我有另一个程序集，它由我的 EXE 引用，其中包含一个`ServiceContract`.

它曾经工作得很好。昨天，我在项目设置（*部分信任、完全信任、部署设置等*）上玩了很多，现在，每次启动客户端时，我都会收到以下消息框：

> Microsoft WCF 服务主机
> 目标程序集不包含服务类型。
> 您可能需要调整此程序集的代码访问安全策略。

然后VS冻结1分钟，最终让我像往常一样调试我的程序。

我找到[了有关此问题的帖子](http://cs.rthand.com/blogs/blog_with_righthand/archive/2008/03/10/_2200_The-target-assembly-contains-no-service-types.--You-may-need-to-adjust-the-Code-Access-Security-policy-of-this-assembly_2E002200_-annoyance.aspx)，但该解决方案不适用于我的情况。有任何想法吗？

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2009-02-19T09:47:01.803

总是这样。您搜索了 2 个小时，最终在 SO 上发帖，5 分钟后，您找到了答案。

在定义 的项目属性的[WCF 选项选项](http://msdn.microsoft.com/en-us/library/cc668754.aspx)`ServiceContract`卡中， **有一个标记为“在同一解决方案中调试另一个项目时启动 WCF 服务主机”的复选框，我未选中该复选框。**

我不知道它是如何被检查的。

无论如何，这解决了我的问题。有关此项目设置，请参阅[MSDN 参考](http://msdn.microsoft.com/en-us/library/cc668754.aspx)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2014-10-23T18:29:41.210

以防万一其他人正在寻找答案，导致此错误的另一个原因可能是您碰巧`App.config`在项目中有一个文件，该文件是具有部分的类库`<system.serviceModel>`。

我将服务代码从一个项目中移出，该项目是另一个项目的可执行文件，但不小心留下了旧`App.config`文件。我的新项目是一个以编程方式配置并启动 WCF 的控制台应用程序，但由于旧`App.config`文件位于引用的程序集中，即使在调试控制台应用程序时，我也会得到那个神秘的对话框。

花了大约 12 个小时来追踪这个，因为我没有意识到 VS 调试器会检查所有引用的 App.config 程序集，这些程序集配置了 WCF 服务。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-04-02T12:23:49.720

要确定有此问题的项目，请在项目文件中找到字符串 3D9AD99F-2412-4246-B90B-4EAA41C64699。

例子：`<ProjectTypeGuids>{3D9AD99F-2412-4246-B90B-4EAA41C64699};{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}</ProjectTypeGuids>`

然后关闭项目选项**“WCF 选项/在同一解决方案中调试另一个项目时启动 WCF 服务主机”**

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-05-22T12:12:55.943

一些博客说，这可能是因为从不同的分支复制项目而发生的，这会覆盖 GUID......所以只需按照[本博客中的说明删除它们。](http://kalirajanl.wordpress.com/2013/02/19/wcf-annoying-error/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-01-04T06:30:33.297

我也遇到了同样的问题并搜索了几个小时来摆脱这个特殊的错误。最后我确实找到了摆脱它的方法。

当您遇到此特定问题时，您**尝试以*管理员***身份运行服务器和客户端应用程序，并更改项目的**WPF 属性**。

当您单击项目的 WPF 属性时，您会发现一个构建选项。在构建选项中，有一个名为*PLATFORM TARGET*的选项，您可以在其中将平台目标更改为*x86*。另请注意，对于*x84*，您需要将其设置为*x84*。

现在**从控制台运行您的项目**，即转到保存项目的文件夹，在**客户端的 bin 中，您将找到一个文件夹*debug*，您将在其中获得控制台应用程序**。您现在应该能够成功运行该应用程序。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-09-17T06:22:05.377

此错误也可能是由配置文件中的错误服务名称引起的：

```
<system.serviceModel>
    <services>
      <service name="MyServiceLibrary.WrongServiceName">
... 
```

检查您的配置文件并确保服务名称正确。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-07-19T13:11:20.213

旧线程。只需从选项中的调试部分中删除任何命令行参数。这对我有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-03-19T19:11:45.577

添加另一个解决方案，因为此消息似乎有多种原因。从项目文件的 ProjectTypeGuids 标记中删除以下 GUID 解决了该问题。

```
<ProjectTypeGuids>{3D9AD99F-2412-4246-B90B-4EAA41C64699}</ProjectTypeGuids> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-02-23T14:42:14.643

在我的情况下，问题是，因为一个普通的类库项目（由 WCF 服务库引用）在它的 .csproj 文件中有这个：

```
<ProjectExtensions>
    <VisualStudio>
      <FlavorProperties GUID="{3D9AD99F-2412-4246-B90B-4EAA41C64699}">
        <WcfProjectProperties>
          <AutoStart>True</AutoStart>
        </WcfProjectProperties>
      </FlavorProperties>
    </VisualStudio>
  </ProjectExtensions> 
```

将其更改为 False 解决了这个问题。这个答案已经存在，但请确保您检查了所有项目，而不仅仅是 WCF 服务库之一。

# c# - 在 WPF 用户控件中公开多个命令

> ID：564545
> 
> 赞同：0
> 
> 时间：2009-02-19T09:37:32.343
> 
> 标签：c#, wpf, wpf-controls, command, routed-commands

一个更好的解释，我希望：

*   我有一个带有 3 个按钮的工具栏，所有三个按钮都绑定到一个命令（包括一个命令参数）
*   此工具栏用于多个屏幕
*   工具栏的 xaml 在所有这些屏幕上都完全相同

我想删除工具栏实例并将其替换为提供 3 个命令的用户控件，这样我就可以在每个屏幕中保留绑定。计划稍后更改工具栏功能，但外部编程接口（即 3 个命令）是相同的。

所以：

*   我创建了一个用户控件，并为每个命令（OneCommand、OneCommandParameter、OneCommandTarget）创建了 3 组依赖属性，因此我可以将它们用于绑定。
*   我在用户控件 xaml 中移动了工具栏 xaml。
*   我修改了工具栏按钮上的绑定以绑定到内部用户控件属性
*   在每个屏幕上（或者实际上，现在只有第一个屏幕）我用用户控件替换了原始工具栏，将新属性绑定到正确的命令。

控件显示，但按钮不起作用。就是这样。

--

原始解释 - 不太清楚：

我有一个封装了许多按钮的 WPF 用户控件。以前，该控件是一个带有许多按钮的工具栏，但由于我需要在多个屏幕上具有完全相同的功能，因此我将工具栏重构为自定义控件。

但是，我想保留原始按钮的命令绑定。

*   我在用户控件上创建了 3 组依赖属性（XCommand、XCommandParameter 和 XCommandTarget）。
*   在用户控件 xaml 中，我将“真实”按钮绑定到这些属性（每个按钮到每组属性）。
*   在我使用用户控件的地方，我将新属性绑定到真正的命令绑定。

本质上，我想为用户控件公开的每个“命令”保留 ICommandSource 功能。但是，这种双重数据绑定方案似乎不起作用，或者我做错了什么。:)

有一个更好的方法吗？我所需要的只是将控件外部的命令“桥接”到内部按钮，以便保留 Execute 和 CanExecute 功能。

* * *

## 回答 #1

> 赞同：-5
> 
> 时间：2009-02-19T12:24:57.807

我解决了这个问题。我的内部控件绑定中的 RelativeSource 存在错误。它现在按预期工作正常。

# asp.net - 如何停止 asp.net 编码和获取参数？

> ID：564549
> 
> 赞同：2
> 
> 时间：2009-02-19T09:39:16.487
> 
> 标签：asp.net, url, parameters, get

我正在使用以下代码在 asp.net 中向页面的 body 参数添加一系列调用：

```
uxBodyTag.Attributes["onbeforeunload"] += 
  "ajaxRequest('UnlockQuery.ashx?QueryID=" + queryId.ToString() + 
  "&UserID=" + Session["UserID"].ToString() + "');"; 
```

这被渲染为：

```
<body id="uxBodyTag" onbeforeunload=
    "ajaxRequest('UnlockQuery.ashx?QueryID=176&amp;UserID=11648');"> 
```

& 意味着我的 ashx 页面没有检索到正确的变量 - 我怎样才能阻止 asp.net 这样做？

编辑：

使用 Server.UrlEncode 给了我以下信息：

```
<body id="uxBodyTag" onbeforeunload=
 "ajaxRequest('UnlockQuery.ashx%3fQueryID%3d179%26UserID%3d11648')%3b"> 
```

这要糟糕得多。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T10:18:26.160

在 HTML 中，& 符号需要在任何时候、任何地方进行编码，也需要在属性值中进行编码（显然，`<script>`标记的内容是一个明显的例外）。ASP.NET 做了正确的事。

浏览器在实际使用属性值之前将对其进行未编码。所以你的`onbeforeunload`属性有一个字面值：

```
ajaxRequest('UnlockQuery.ashx?QueryID=176&UserID=11648');

```

而 HTML 表示需要`&amp;`替换`&`. 浏览器通常也能理解错误编码的版本，但 SGML 解析器会抱怨名为`&UserID`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T10:03:31.687

您使用 & 编码为 & 时看到的行为 是你想要的行为。当文本到达您的 ajaxRequest 函数时，它将再次未编码，一切都应该没问题。

# java - 通过 Java 中的代理获取 SSL 页面的最简单方法

> ID：564550
> 
> 赞同：6
> 
> 时间：2009-02-19T09:39:55.410
> 
> 标签：java, ssl, proxy, http-proxy

我想用 Java 获取 SSL 页面。问题是，我必须针对 http 代理进行身份验证。

所以我想要一个简单的方法来获取这个页面。我尝试了 Apache Commons httpclient，但这对我的问题来说开销太大。

我尝试了这段代码，但它不包含身份验证操作：

```
import java.io.*;
import java.net.*;

public class ProxyTest {

  public static void main(String[] args) throws ClientProtocolException, IOException {

    URL url = new URL("https://ssl.site");
    Socket s = new Socket("proxy.address", 8080);
    Proxy proxy = new Proxy(Proxy.Type.HTTP, s.getLocalSocketAddress());

    URLConnection connection = url.openConnection(proxy);
    InputStream inputStream = connection.getInputStream();
    BufferedReader br = new BufferedReader(new InputStreamReader(inputStream));
    String tmpLine = "";

    while ((tmpLine = br.readLine()) != null) {
      System.out.println(tmpLine);
    }

  }
} 
```

谁能提供一些信息如何以简单的方式实现它？

提前致谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T09:54:59.227

您需要在打开连接之前设置[java.net.Authenticator ：](http://java.sun.com/j2se/1.5.0/docs/api/java/net/Authenticator.html)

```
...

public static void main(String[] args) throws Exception {
    // Set the username and password in a manner which doesn't leave it visible.
    final String username = Console.readLine("[%s]", "Proxy Username");
    final char[] password = Console.readPassword("[%s"], "Proxy Password:");

    // Use a anonymous class for our authenticator for brevity
    Authenticator.setDefault(new Authenticator() {
        protected PasswordAuthentication getPasswordAuthentication() {
            return new PasswordAuthentication(username, password);
        }
    });

    URL url = new URL("https://ssl.site");
    ...
} 
```

要在完成后删除您的身份验证器，请调用以下代码：

```
Authenticator.setDefault(null); 
```

Java SE 6 中的身份验证器支持`HTTP Basic`,`HTTP Digest` *和* `NTLM`. 有关详细信息，请参阅sun.com上的[Http 身份验证文档](http://java.sun.com/javase/6/docs/technotes/guides/net/http-auth.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T09:56:29.427

org.apache.commons.httpclient.HttpClient 是你的朋友，

[来自http://hc.apache.org/httpclient-3.x/sslguide.html](http://hc.apache.org/httpclient-3.x/sslguide.html)的示例代码

```
 HttpClient httpclient = new HttpClient();
  httpclient.getHostConfiguration().setProxy("myproxyhost", 8080);
  httpclient.getState().setProxyCredentials("my-proxy-realm", " myproxyhost",
  new UsernamePasswordCredentials("my-proxy-username", "my-proxy-password"));
  GetMethod httpget = new GetMethod("https://www.verisign.com/");
  try { 
    httpclient.executeMethod(httpget);
    System.out.println(httpget.getStatusLine());
  } finally {
    httpget.releaseConnection();
  } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T10:20:29.727

使用 apache commons-http-client 4：你会发现很多例子 @ [https://github.com/apache/httpcomponents-client/tree/master/httpclient5/src/test/java/org/apache/hc/ client5/http/examples](https://github.com/apache/httpcomponents-client/tree/master/httpclient5/src/test/java/org/apache/hc/client5/http/examples)

尤其是[https://github.com/apache/httpcomponents-client/blob/master/httpclient5/src/test/java/org/apache/hc/client5/http/examples/ClientProxyAuthentication.java](https://github.com/apache/httpcomponents-client/blob/master/httpclient5/src/test/java/org/apache/hc/client5/http/examples/ClientProxyAuthentication.java)

# silverlight - Flare 的 Silverlight 实现

> ID：564551
> 
> 赞同：1
> 
> 时间：2009-02-19T09:40:04.740
> 
> 标签：silverlight, flare

有人知道[Flare 框架](http://flare.prefuse.org/)的 Silverlight 端口吗？

谷歌什么也没发现，但如果有人在移植这个我不会感到惊讶？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T12:51:08.103

您有一个名为 VISIfire 的 Silverlight 开源图表框架。

链接在这里： http: [//www.visifire.com](http://www.visifire.com)

# c# - 是否可以将属性作为“out”或“ref”参数传递？

> ID：564557
> 
> 赞同：34
> 
> 时间：2009-02-19T09:43:26.620
> 
> 标签：c#, arguments, pass-by-reference

如果不能，我可以将属性作为“out”或“ref”参数传递，那为什么不呢？

例如

```
Person p = new Person(); 
```

. . .

```
public void Test(out p.Name); 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-02-19T09:45:28.220

为简短的回答道歉，但不，C# 语言规范不允许它。

请参阅另一个问题的[答案](https://stackoverflow.com/questions/340528/c-automatic-properties-why-do-i-have-to-write-get-set/340682#340682)，以了解尝试时会发生什么。它还说明了为什么您不应该将房产设置为公共领域以规避限制。

希望这可以帮助

**编辑：你问为什么？**

您将一个变量传递给一个`out`或`ref`参数，您实际上是在传递变量的地址（或内存中的位置）。在函数内部，编译器知道变量的真正位置，并获取并将值写入该地址。

属性看起来像一个值，但它实际上是一对函数，每个函数都有不同的签名。因此，要传递一个属性，您实际上需要传递两个函数指针，一个用于获取，一个用于设置。

传递给函数与变量的地址完全不同

即一个变量地址v 的两个函数指针。

**更新**
*为什么 C# 不为我们处理这个？*

我不是[Eric Lippert](https://stackoverflow.com/users/88656/eric-lippert)，但我会试一试为什么

你调用的函数的签名应该是什么？
假设你想打电话`void MyFn(ref int i)`应该保持这种状态，还是应该改变说我们也允许属性？如果它更改为类似这样的语法，`void MyFn(prop_ref int i)`那么这是相当没用的，您不能将属性传递给库函数或未使用特殊 prop_ref 修饰符编写的第 3 方代码。无论如何，我认为您的建议不应该有所不同。

现在让我们说`MyFn`传递`i`给 COM 函数或 WinAPI 调用，传递`i`（即外部 .net，通过 ref）的地址。如果它是一个属性，你如何获得地址`i`？属性下可能没有实际的 int 来获取地址。你做 VB.Net 做的事吗？

当属性作为 ByRef 参数传递给方法时，Vb.Net 编译器会发现。此时它声明了一个变量，将属性复制到变量中，通过引用传递变量，然后在调用方法之后，将变量复制回属性中。IE

```
MyFunc(myObject.IntProperty) 
```

变成

```
Dim temp_i As Integer = myObject.IntProperty
MyFunc(temp_i)
myObject.IntProperty = temp_i 
```

在返回之前不会发生任何属性副作用`MyFunc`，这可能会导致各种问题并导致*非常*微妙的错误。

在我看来，这个问题的 Vb.Net 解决方案也被打破了，所以我不会接受它作为答案。

你认为 C# 编译器应该如何处理这个问题？

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-19T11:09:32.793

其他人解释说您不能在 C# 中执行此操作。在 VB.NET 中，您*可以*执行此操作，即使使用选项 strict/explicit on：

```
Option Strict On
Option Explicit On
Imports System.Text

Module Test

   Sub Main()
       Dim sb as new StringBuilder
       Foo (sb.Length)
   End Sub

   Sub Foo(ByRef x as Integer)
   End Sub

End Module 
```

上面的代码等价于这个 C# 代码：

```
using System.Text;

class Test
{
     static void Main()
     {
         StringBuilder sb = new StringBuilder();
         int tmp = sb.Length;
         Foo(ref tmp);
         sb.Length = tmp;
     }

     static void Foo(ref int x)
     {
     }
} 
```

就我个人而言，我很高兴 C# 没有这个 - 它使水变得非常混乱，特别是在属性的值方面，如果在方法中设置参数但随后抛出异常。

编辑：根据要求，我关于为什么我相信在水中传递财产的理由。如果您通过引用传递一个普通变量，那么每次在方法中引用它时都会评估该变量。如果值因某种原因发生变化（例如，作为方法中某些其他工作的副作用），则该更改将立即在方法中可见。如果您在 VB.NET 中通过引用传递属性，则情况并非如此：属性 getter 被调用一次，然后属性 setter 被调用一次。这不像您要传入“这是一个*属性*- 每当您使用参数时都可以从中获取和设置”。

这是一个完整的示例，其中在 .NET 中传递一个字段和传递一个完全无关紧要的属性会产生非常不同的结果：

```
Option Strict On
Option Explicit On
Imports System.Text

Class Test

   Dim counter as Integer

   Property CounterProperty As Integer
       Get
           Return counter
       End Get
       Set (ByVal value as Integer)
           counter = value
       End Set
   End Property

   Sub Increment
       counter += 1
   End Sub

   Shared Sub Main()
       Dim t as new Test()
       Console.WriteLine("Counter = {0}", t.counter)
       t.Foo(t.counter)
       Console.WriteLine("Counter = {0}", t.counter)

       t.CounterProperty = 0
       Console.WriteLine("CounterProperty = {0}", t.CounterProperty)
       t.Foo(t.CounterProperty)
       Console.WriteLine("CounterProperty = {0}", t.CounterProperty)
   End Sub

   Sub Foo(ByRef x as Integer)
       x = 5
       Increment
       Increment
       Increment
       x += 1
   End Sub

End Class 
```

.Net-Fiddle：[https](https://dotnetfiddle.net/ZPFIEZ) ://dotnetfiddle.net/ZPFIEZ （字段和属性的不同结果）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T10:43:08.847

相反，你应该做这样的事情

```
WhatEverTheType name;

Test(out name);

// Choose one of the following construction

Person p = new Person();
p.Name = name;

Person p = new Person(name);
Person p = new Person(Name => name); 
```

# c# - 调用 Icon.ToBitmap() 后处理 Icon 是否安全？

> ID：564574
> 
> 赞同：3
> 
> 时间：2009-02-19T09:50:42.327
> 
> 标签：c#, .net, icons, idisposable

调用`System.Drawing.Icon.ToBitmap()`创建图像后，处置原件是否安全`Icon`？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T09:59:14.380

该方法将`Icon`a 转换为新`Bitmap`对象，因此不会有从`Bitmap`到 的引用`Icon`。

所以是的，处理`Icon`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T09:59:55.580

是的。Icon.ToBitmap 将 Icon 绘制到一个新的 Bitmap 对象上，因此之后可以安全地处理它。

编辑：
查看 Reflector 中的 Icon.ToBitmap() 方法很有趣。我希望它是一个简单的 Graphics.DrawImage 或 Graphics.DrawIcon 调用，但它比这更复杂。只要有可能，该函数将对图标图像数据进行内存复制，但如果无法执行复制，它将恢复为 Graphics.DrawImage 或 Graphics.DrawIcon 调用。内存复制要快得多，所以这显然是原因，但这使得代码更难阅读。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T09:55:31.597

是的。如果您不再需要该图标，并且将位图存储在某处，那就没问题了。

# c - 如何在不使用 WinMain 的情况下编写 Windows 应用程序？

> ID：564576
> 
> 赞同：17
> 
> 时间：2009-02-19T09:51:01.483
> 
> 标签：c, winapi, main, crt, winmain

用 C/C++ 编写的 Windows GUI 应用程序将“WinMain”作为入口点（而不是“main”）。我对此的理解是编译器会生成一个由 C 运行时调用的“主”函数。这个'main'函数为GUI设置必要的环境并调用'WinMain'（指定实例句柄等）。

简而言之，我相信控制台和 GUI 应用程序启动在以下方面有所不同：

控制台应用程序：C 运行时 --> 'main' 函数（手工编码）

GUI 应用程序：C 运行时 --> 'main' 函数（编译器生成） --> 'WinMain' 函数（手工编码）

我想验证这种理解并找出我如何仅使用“main”函数（即无需编写“WinMain”）手动编写 Windows GUI。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-19T10:32:25.753

你的理解有误。main 和 WinMain 之间的区别，除了一些不同的初始化代码之外，就是传递给它的参数。

主要看起来像这样：

```
int main(int argc, char* argv[]); 
```

虽然 WinMain 看起来像这样：

```
int WINAPI WinMain(HINSTANCE hInstance,
    HINSTANCE hPrevInstance,
    LPSTR lpCmdLine,
    int nCmdShow
); 
```

必须设置这些参数并进行调用，这就是启动代码。当您编译和链接程序时，链接器参数之一是入口点，根据控制台或 GUI 应用程序，这将是不同的启动代码位。

您当然可以编写自己的启动代码，只需进入您的 Visual c++ 源目录即可找到启动代码，它名为 crt0.c，位于 VC\crt\src 目录中。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-19T10:40:17.027

使用 Just main，您不能编写 Winmain。出于正当理由，以下陈述取自 [http://blogs.msdn.com/oldnewthing/archive/2007/12/03/6644060.aspx](http://blogs.msdn.com/oldnewthing/archive/2007/12/03/6644060.aspx)

> [在 Windows 编程中] 为什么应用程序入口点不叫 main？好吧，一方面，名称 main 已经被使用，并且 Windows 无权保留备用定义。那时还没有 C 语言标准化委员会；C 就是 Dennis 所说的那样，并且很难保证 Dennis 会采取任何特殊措施来保持 Windows 源代码在任何未来版本的 C 语言中的兼容性。由于 K&R 没有指定实现可以扩展 main 函数的可接受形式，因此完全有可能存在合法的 C 编译器拒绝错误声明 main 的程序。当前的 C 语言标准明确允许 main 的特定于实现的替代定义，
> 
> 如果你设法克服了这个障碍，你就会遇到 Windows 版本的 main 必须是这样的问题：
> 
> ```
> int main(int argc, char *argv[], HINSTANCE hinst,
>          HINSTANCE hinstPrev, int nCmdShow); 
> ```
> 
> 由于执行 C 链接的方式，函数的所有变体都必须就它们的共同参数达成一致。这意味着 Windows 版本必须将其参数添加到现有最长的 main 版本的末尾，然后您必须祈祷并希望 C 语言永远不会添加另一个 main 的替代版本。如果你走这条路，你的交叉手指会让你失望，因为事实证明第三个参数是在一段时间后添加到 main 的，它与你的 Windows 友好版本冲突。
> 
> 假设您设法说服 Dennis 不允许使用 main 的三参数版本。您仍然必须提出前两个参数，这意味着每个程序的启动代码都需要包含一个命令行解析器。回到 16 位时代，人们节俭地保存每个字节。告诉他们，“哦，你所有的程序都会变大 2KB”可能不会让你交到很多朋友。我的意思是，那是软盘上的四个 I/O 扇区！
> 
> 但是，Windows 入口点被赋予不同名称的原因可能是为了强调它是一个不同的执行环境。如果它被称为 main，人们会将为控制台环境设计的 C 程序放入 Windows 编译器中，然后运行它们，结果是灾难性的。

希望这能消除您的疑虑。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-19T10:05:43.257

它以另一种方式工作。编译器附带了一个静态链接的目标文件，它包含实际的入口点。该入口点进行初始化，然后调用您的入口点（即 WinMain）。

该静态部分期望调用的内容可能是可调整的。例如，在 Visual Studio 中，链接器设置中有一个入口点名称字段。

# multithreading - 在线程之间划分循环迭代

> ID：564577
> 
> 赞同：8
> 
> 时间：2009-02-19T09:52:02.260
> 
> 标签：multithreading, loops

我最近编写了一个小型数字运算程序，它基本上在 N 维网格上循环并在每个点执行一些计算。

```
for (int i1 = 0; i1 < N; i1++)
  for (int i2 = 0; i2 < N; i2++)
    for (int i3 = 0; i3 < N; i3++)
      for (int i4 = 0; i4 < N; i4++)
        histogram[bin_index(i1, i2, i3, i4)] += 1; // see bottom of question 
```

它工作得很好，yadda yadda yadda，产生了可爱的图表；-) 但后来我想，我的电脑上有 2 个内核，为什么不让这个程序多线程，这样我就可以以两倍的速度运行它？

现在，我的循环总共运行了大约 10 亿次计算，我需要一些方法将它们在线程之间拆分。我想我应该将计算分组为“任务” - 说最外层循环的每次迭代都是一个任务 - 并将任务分发给线程。我考虑过

*   只是给线程 #n 最外层循环的所有迭代 where `i1 % nthreads == n`- 基本上预先确定哪些任务去哪些线程
*   `i1`尝试设置一些受互斥保护的变量，该变量保存下一个需要执行的任务的参数（在这种情况下） - 动态地将任务分配给线程

有什么理由选择一种方法而不是另一种方法？还是我没有想到的另一种方法？这还重要吗？

顺便说一句，我用 C 编写了这个特定的程序，但我想我也会用其他语言再次做同样的事情，所以答案不必是 C 特定的。（不过，如果有人知道用于 Linux 的 C 库可以做这种事情，我很想知道）

*编辑*：在这种情况下`bin_index`是一个确定性函数，除了它自己的局部变量之外不会改变任何东西。像这样的东西：

```
int bin_index(int i1, int i2, int i3, int i4) {
    // w, d, h are constant floats
    float x1 = i1 * w / N,  x2 = i2 * w / N, y1 = i3 * d / N, y2 = i4 * d / N;
    float l = sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2) + h * h);
    float th = acos(h / l);
    // th_max is a constant float (previously computed as a function of w, d, h)
    return (int)(th / th_max);
} 
```

（尽管我很欣赏所有评论，即使是那些不适用于确定性 bin_index 的评论）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T10:00:50.260

第一种方法就足够了。这里不需要复杂化。如果您开始使用互斥锁，您将面临难以检测错误的风险。

除非你真的看到你需要这个，否则不要开始复杂化。同步问题（尤其是在多线程而不是多进程的情况下）可能真的很痛苦。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T10:04:14.853

据我了解，[OpenMP](http://en.wikipedia.org/wiki/OpenMP)是为您想要做的事情而制作的，尽管我不得不承认我自己还没有使用过它。基本上，它似乎归结为只包含一个标题并添加一个 pragma 子句。

您可能还可以使用英特尔的[线程构建块](http://www.threadingbuildingblocks.org/)库。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T10:18:35.160

第一种方法很简单。如果您期望负载将在线程上均匀平衡，这也足够了。在某些情况下，特别是如果 bin_index 的复杂性非常依赖于参数值，则其中一个线程最终可能会完成比其他线程更重的任务。请记住：当最后一个线程完成时，任务就完成了。

第二种方法稍微复杂一些，但如果任务足够细粒度（任务数远大于线程数），则负载平衡更均匀。

请注意，将计算放在单独的线程中可能会遇到问题。确保 bin_index 在多个线程同时执行时正常工作。谨防将全局或静态变量用于中间结果。

此外，“histogram[bin_index(i1, i2, i3, i4)] += 1" 可能被另一个线程中断，导致结果不正确（如果赋值获取值，将其递增并将结果值存储在大批）。您可以为每个线程引入一个局部直方图，并在所有线程完成后将结果组合成一个直方图。您还可以确保只有一个线程同时修改直方图，但这可能会导致线程在大多数情况下相互阻塞。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T10:48:10.970

如果您从未编写过多线程应用程序，我让您从 OpenMP 开始：

*   该库现在默认包含在 gcc 中
*   这很容易使用

在您的示例中，您应该只需要添加此编译指示：

```
#pragma omp parallel shared(histogram)
{
for (int i1 = 0; i1 < N; i1++)
  for (int i2 = 0; i2 < N; i2++)
    for (int i3 = 0; i3 < N; i3++)
      for (int i4 = 0; i4 < N; i4++)
        histogram[bin_index(i1, i2, i3, i4)] += 1;
} 
```

使用这个 pragma，编译器将添加一些指令来创建线程、启动它们、围绕对变量的访问添加一些互斥锁`histogram`等等......有很多选项，但定义明确的 pragma 会为您完成所有工作。基本上，简单性取决于数据依赖性。

当然，结果不应该是最佳的，就像您手动编码一样。但是如果你没有负载平衡问题，你可能会接近 2 倍的速度。实际上这只是写在没有空间依赖性的矩阵中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-24T02:16:56.387

我会做这样的事情：

```
void HistogramThread(int i1, Action<int[]> HandleResults)
{
    int[] histogram = new int[HistogramSize];

    for (int i2 = 0; i2 < N; i2++)
       for (int i3 = 0; i3 < N; i3++)
          for (int i4 = 0; i4 < N; i4++)
             histogram[bin_index(i1, i2, i3, i4)] += 1;

    HandleResults(histogram);
}

int[] CalculateHistogram()
{
    int[] histogram = new int[HistogramSize];

    ThreadPool pool; // I don't know syntax off the top of my head
    for (int i1=0; i1<N; i1++)
    {
       pool.AddNewThread(HistogramThread, i1, delegate(int[] h)
       {
           lock (histogram)
           {
               for (int i=0; i<HistogramSize; i++)
                   histogram[i] += h[i];
           }
       });
    }
    pool.WaitForAllThreadsToFinish();

    return histogram;
} 
```

这样你就不需要共享任何内存，直到最后。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T10:02:48.053

如果您曾经在 .NET 中进行过此操作，请使用[Parallel Extensions](http://blogs.msdn.com/pfxteam/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T10:12:15.630

如果您想编写多线程数字运算代码（并且您将来会做很多事情），我建议您考虑使用像 OCaml 或 Haskell 这样的函数式语言。

由于函数式语言（嗯，主要是）缺乏副作用和缺乏共享状态，使您的代码跨多个线程运行要容易得多。另外，您可能会发现最终得到的代码要少得多。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T22:12:04.150

我同意 Sharptooth 的观点，即您的第一种方法似乎是唯一可行的方法。

您的单线程应用程序不断分配内存。为了获得任何加速，您的多个线程还需要不断地分配给内存。如果一次只分配一个线程，则根本不会获得加速。因此，如果您的作业受到保护，整个练习就会失败。

这将是一种*危险*的方法，因为您在没有警卫的情况下分配给共享内存。但这似乎值得冒险（如果 x2 加速很重要）。如果您可以确定 bin_index(i1, i2, i3, i4) 的所有值在循环的划分中都不同，那么它应该可以工作，因为数组分配将分配到共享内存中的不同位置。尽管如此，人们总是应该认真研究这样的方法。

我假设您还会生成一个测试例程来比较两个版本的结果。

## 编辑：

查看您的 bin_index(i1, i2, i3, i4) ，我怀疑您的进程如果不付出相当大的努力就无法并行化。

再次，在循环中划分计算工作的唯一方法是确保您的线程将访问内存中的相同区域。但是，看起来 bin_index(i1, i2, i3, i4) 可能会经常重复值。您可以将迭代划分为 bin_index 高于截止值和低于截止值的条件。或者你可以任意划分，看看增量是否是原子实现的。但是，如果您一开始只能使用两个内核，那么任何复杂的线程方法似乎都不太可能提供改进。

# xcode - 如何使用 Xcode 中的 p4merge？

> ID：564580
> 
> 赞同：2
> 
> 时间：2009-02-19T09:53:22.930
> 
> 标签：xcode, svn, macos, merge, perforce

我想在 SVN 设置中使用 Xcode 中的 p4merge 工具。自找麻烦？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T10:14:29.727

在这里找到解决方案： [http ://wiki.changesapp.com/index.php/Application_Integration#XCode_2.5_.26_3](http://wiki.changesapp.com/index.php/Application_Integration#XCode_2.5_.26_3)

1.  转到 XCode 首选项中的“SCM”部分。
2.  选择“选项”选项卡。
3.  在“查看比较使用：”的弹出窗口中选择“其他...”
4.  在打开的面板中，点击斜杠 (/)。在弹出的字段中，输入：/Applications/p4merge.app/Contents/Resources/launchp4merge

# c# - 什么是 Environment.FailFast？

> ID：564581
> 
> 赞同：41
> 
> 时间：2009-02-19T09:53:32.803
> 
> 标签：c#, .net, vb.net

什么是 Environment.FailFast？

它有什么用处？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-19T09:58:47.643

它用于杀死应用程序。这是一种静态方法，可以立即终止应用程序而不会被任何异常块捕获。

> Environment.FastFail(String) 实际上是一个很棒的调试工具。例如，假设您有一个应用程序，它直接给您一些奇怪的输出。你不知道为什么。你知道这是错误的，但没有任何例外会浮出水面来帮助你。好吧，如果您可以访问 Visual Studio 2005 的 Debug->Exceptions... 菜单项，您实际上可以告诉 Visual Studio 允许您查看那些第一次机会异常。如果你没有，但是你可以将 Environment.FastFail(String) 放在一个异常中，并使用演绎推理和消除过程来找出你的问题所在。

[参考](https://netfxharmonics.com/2006/10/uncatchable-exception)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-01-07T19:13:14.263

它还创建了一个转储和事件查看器条目，这可能很有用。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-19T09:58:47.033

这是一种在不引发异常的情况下立即退出应用程序的方法。

文档在[这里](https://docs.microsoft.com/en-us/dotnet/api/system.environment.failfast#System_Environment_FailFast_System_String_)。

在某些安全或数据关键的上下文中可能很有用。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2016-08-05T02:18:06.753

Failfast 可用于可能危及用户数据的情况。假设在数据库引擎中，当您​​检测到内部数据结构损坏时，唯一明智的做法是尽快停止该过程，以避免将垃圾写入数据库并冒损坏数据库和丢失用户数据的风险。这是故障快速有用的一种可能情况。

另一个用途是捕获程序员错误。假设您正在编写一个库，并且某个函数接受一个在任何情况下都不能为空的指针，也就是说，如果它为空，那么您显然存在程序员错误。您可以返回 E_POINTER 之类的错误或抛出一些 InvalidArgument 异常并希望有人注意到，但是通过快速失败可以更好地引起他们的注意:-)

请注意，我并没有将示例限制为指针，您可以概括为任何不应该发生的参数或条件。快速失败最终会产生质量更好的应用程序，因为许多错误不再被忽视。

最后，快速失败有助于尽可能忠实地捕获进程的状态（当创建内存转储时），特别是在检测到不可恢复的错误或真正意外的情况后*立即快速失败时。*

如果允许进程继续，例如“finally”子句将运行或堆栈将被解开，并且在进行内存转储之前，事物将被破坏或处置，那么进程的状态可能会改变这样的方式使得诊断问题的根本原因变得更加困难。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-06-11T20:12:48.753

它会杀死应用程序，甚至跳过 try/finally 块。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-04-04T15:48:20.373

来自[.NET Framework Design Guidelines on Exception Throwing](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/exception-throwing)：

> **✓ 考虑通过调用System.Environment.FailFast**（.NET Framework 2.0 功能）来终止进程，**而不是在代码遇到进一步执行不安全的情况时抛出异常**。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-07-08T11:02:39.920

Joe Duffy 在这里讨论了快速失败和使其有用的纪律。

[http://joeduffyblog.com/2014/10/13/if-youre-going-to-fail-do-it-fast/](http://joeduffyblog.com/2014/10/13/if-youre-going-to-fail-do-it-fast/)

从本质上讲，他是说对于编程错误 - 即意外错误是程序员而不是程序用户的错误或其他可以合理*预期*为坏的输入或情况 - 然后决定总是因为意外错误而快速失败以提高代码质量。

我认为，由于这是一个可选的团队决策和纪律，因此在 C# 中使用此 API 很少见，因为实际上我们都主要为 HR 或在线商店中的 12 人编写 LoB 应用程序。

所以对我们来说，当我们想要拒绝我们 API 的消费者进行任何进一步操作的机会时，我们可能会使用它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-02-08T02:08:39.507

在任务中抛出（或重新抛出）的未处理异常在任务被垃圾收集之前不会生效，在某个可能是随机的时间之后。

此方法可让您立即使进程崩溃 - 请参阅[此答案](https://stackoverflow.com/a/21648387/49942)。

# c# - Linq2sql 继承强制转换

> ID：564584
> 
> 赞同：0
> 
> 时间：2009-02-19T09:54:36.810
> 
> 标签：c#, linq-to-sql

我在 linq2sql 中使用继承，并拥有从客户继承的供应商和买方。我需要能够将买家“升级”为供应商。

我试过了：

```
 Client client = ClientMethods.ValidateId<Client>(clientId);
        client.ClientTypeId = ClientMethods.CLIENT_TYPE_SUPPLIER;
        db.SubmitChanges(); 
```

但是得到“不允许：继承鉴别器从'1'更改为'2'会将类型从'买方'更改为'供应商'。”

我能找到的唯一解决方案是在没有 linq2sql 的情况下执行此操作并编写一个 SP??

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T11:17:25.967

我想知道如果您想从一种类型更改为另一种类型是很自然的情况，为什么还要有两个不同的子类。我认为你应该重构你拥有的东西，让买家和供应商成为一个实体。然后，如果您的行为应该根据客户是买家还是供应商而有所不同，我会将其提取到一个单独的对象中，您可以将其设置或添加到客户中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-21T23:40:16.917

我刚刚遇到了同样的问题，并通过将鉴别器字段加倍到一个实际用作鉴别器值的计算列和一个存储该值的整数列来解决*）

*) - 可能会产生不良副作用的著名解决方案之一，因此请注意

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T10:01:10.180

也许，尝试通过填充买方的属性值来创建新的供应商？

# java - 使用 jmx 的动态代理会导致线程泄漏？

> ID：564589
> 
> 赞同：8
> 
> 时间：2009-02-19T09:56:14.327
> 
> 标签：java, multithreading, jmx, proxy-classes

我在 Java 中有一个问题，我用 JMX 接口设置了一个动态代理，将它传递给另一个组件，然后调用代理对象。当我这样做时，应用程序会为每个调用泄漏两个线程，这些线程似乎永远不会超时，并且会不断累积，直到应用程序内存不足。

线程成对出现，请参阅底部的堆栈跟踪。

我尝试在 JMX 中使用一些稍微模糊的系统属性来关闭超时，但这并没有什么不同。关键操作似乎是动态代理调用。通过代理调用的对象实现了 Serializable ，所以这应该不是问题。

当我手动创建一个带有 MBean 路径和对象接口字符串的 Bean 并从中调用方法时，问题就消失了。

当涉及到动态代理时，我主要在这里寻找经典的陷阱，因为我对它们没有太多经验。

这就是代理实例的创建方式

```
public <T> T create(final Class<T> type,
        final Object... nameParameters) throws JmxConnectionException {
    return type.cast(Proxy.newProxyInstance(
            type.getClassLoader(),
            new Class< ? >[] {type},
            new MyInvocationHandler(this,
                    fill(nameOf(type), nameParameters))));
} 
```

以及 MyInvocationHandler 的实现：

```
final class MyInvocationHandler implements InvocationHandler, Serializable {
private static final long serialVersionUID = 0L; //actually a proper random long
private final transient ProxyFactory proxyFactory;
private String mBeanName;
private RemoteObject remoteObject;

MyInvocationHandler(final ProxyFactory proxyFactory,
        final String mBeanName) {
    this.proxyFactory = proxyFactory;
    this.mBeanName = mBeanName;
}

private void writeObject(final ObjectOutputStream out)
throws IOException {
    try {
        checkConnected();
    } catch (final JmxConnectionException e) {
        throw new IOException(e);
    }
    out.writeObject(mBeanName);
    out.writeObject(remoteObject);
}

private void readObject(final ObjectInputStream in)
throws IOException, ClassNotFoundException {
    mBeanName = (String) in.readObject();
    remoteObject = (RemoteObject) in.readObject();
}

public Object invoke(final Object proxy, final Method method,
        final Object[] args) throws Throwable {
    checkConnected(); //Just checks that the RemoteObject isn't null.
    try {
        return invokeMethod(method, args); // Calls the method on the remoteObject with the arguments, code cut.
    } catch (final InvocationTargetException e) {
        throw e.getCause();
    }
} 
```

}

两个线程的线程堆栈跟踪（总是成对出现）：

```
Name: JMX server connection timeout 53
State: TIMED_WAITING on [I@18bbe70
Total blocked: 3  Total waited: 4

Stack trace: 
java.lang.Object.wait(Native Method)
com.sun.jmx.remote.internal.ServerCommunicatorAdmin$Timeout.run(ServerCommunicatorAdmin.java:150)
java.lang.Thread.run(Thread.java:619)

Name: Thread-21
State: TIMED_WAITING
Total blocked: 0  Total waited: 1

Stack trace: 
java.lang.Thread.sleep(Native Method)
com.sun.jmx.remote.internal.ClientCommunicatorAdmin$Checker.run(ClientCommunicatorAdmin.java:154)
java.lang.Thread.run(Thread.java:619) 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-19T16:19:51.467

问题已解决。在序列化 RemoteObject 下的对象期间出现此问题。

创建[JMXConnector](http://docs.oracle.com/javase/7/docs/api/javax/management/remote/JMXConnector.html)时，请确保在使用完后将其关闭，而不是将其留给垃圾收集，否则它们似乎会继续堆积...

```
JMXConnector connector = JMXConnectorFactory.connect(url);
//...
connector.close(); 
```

# sql-server - 是否可以自动化 SQL Server 2008 探查器？

> ID：564608
> 
> 赞同：4
> 
> 时间：2009-02-19T10:03:02.937
> 
> 标签：sql-server, database, automation, sql-server-profiler

有一篇关于有用的 SQL 技巧的[帖子。](https://stackoverflow.com/questions/488020/what-is-your-most-useful-sql-trick-to-avoid-writing-more-code)在这里，我将提到[SQL Server Profiler](http://msdn.microsoft.com/en-us/library/ms181091.aspx)工具，因为它帮助我减少了编写 SQL。我会编写 SQL 来询问、理解或猜测数据库业务逻辑。

Profiler 非常有用，尤其是在应用程序代码嵌入了 SQL 并且您想在尽可能短的时间内弄清楚它在做什么的情况下。（另外，您可能不知道应用程序环境中使用了哪个源代码版本，或者更糟糕的是，没有可用的源代码！）。

**我想知道探查器是否有我可以挂钩的 API？**

当我们想通过设置环境变量/标志（例如，PROFILER_ON=TRUE）来快速检查系统中调用了什么 SQL 时，这将非常有用。然后系统可以启动 SQL 分析器，设置各种跟踪属性，然后写入日志或表 - 支持团队可以查看这些属性。

我想编写一个组件来打开探查器并监视生产环境（在安静的时候），所以不能真正改变代码库（应用程序代码和 SQL 存储过程）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-06T18:02:02.603

您可以利用[Microsoft.SqlServer.Management.Trace](http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.trace.traceserver.aspx)命名空间对象；它们针对 SQL Profiler 提供的相同功能提供 API。这是针对数据库编写自己的 sql 脚本的替代方法。然而，就像 SQL Profiler 一样，这些对象在幕后所做的是执行 SQL Trace 存储过程（或其变体）来创建、运行和管理跟踪。

如果您使用 1 个探查器实例来分析另一个（或使用探查器通过从跟踪中删除“NOT LIKE 'SQL Profiler...'”过滤条件来分析自身（我认为这是一个应用程序名称过滤器），那么您会看到探查器所做的与您在 SQL 中所做的或 SMO 对象将从 API 中所做的完全一样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-21T10:24:11.203

您可以做的是设置“完美”跟踪并将其编写为 SQL。然后执行它以运行跟踪并将输出保存到文件或表中。

现在，您可以包装 SQL 以在另一个存储过程中创建跟踪，该过程可以通过 SQL 代理/空闲阈值运行，但使用 fn_trace_getinfo 来查看是否已经运行。

您*不能*在 SSMS 中自动化它或使用环境变量：代码、作业、警报等都必须存在于服务器上。

您可以将脚本跟踪放入批处理文件并通过 osql/sqlcmd 运行它，但必须手动调用它。

没有分析器 API：它所做的只是运行存储过程，就像任何解决方案都必须这样做一样。

为什么不能添加独立于应用程序代码的监控 SQL 代码？

您[也不能使用 SMO](http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.trace(SQL.90).aspx) ...仅用于读取痕迹

编辑：跟踪始终需要对服务器运行 SQL

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T10:07:58.633

您可以使用系统存储过程来自动化探查器。[在http://vyaskn.tripod.com/server_side_tracing_in_sql_server.htm](http://vyaskn.tripod.com/server_side_tracing_in_sql_server.htm)查看执行相同操作的详细信息

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-08T12:05:36.063

GBN 就在这里；SQL Profiler 所做的只是在 SQL Server 上执行存储过程：这些过程启动、配置和停止跟踪。这意味着您无需尝试自动化分析器，只需执行相同的跟踪过程，您将获得相同的行为。

要自动启动和停止跟踪，您可以使用 SQL Profiler 创建脚本；该脚本可以从批处理文件中执行。所以你会做这样的事情；

*   打开 SQL 探查器
*   在跟踪配置文件中设置您想要的跟踪；选择您感兴趣的事件和要跟踪的文件。
*   启动跟踪，然后停止它。
*   转到文件 | 出口 | 脚本跟踪定义...并保存`.sql`文件

该`.sql`文件包含您可以运行的代码；如果你打开它，你会在顶部看到这种代码；

```
exec @rc = sp_trace_create @TraceID output, 0, N'InsertFileNameHere', @maxfilesize, NULL 
if (@rc != 0) goto error

-- Client side File and Table cannot be scripted

-- Set the events
declare @on bit
set @on = 1
exec sp_trace_setevent @TraceID, 14, 1, @on
exec sp_trace_setevent @TraceID, 14, 9, @on
exec sp_trace_setevent @TraceID, 14, 6, @on
exec sp_trace_setevent @TraceID, 14, 10, @on
exec sp_trace_setevent @TraceID, 14, 14, @on
exec sp_trace_setevent @TraceID, 14, 11, @on
This creates a trace that writes to a file. 
```

这是创建跟踪并将事件附加到跟踪。

所以现在，要开始你的跟踪，你可以安排这个文件的执行。批处理文件看起来像；

```
osql -E -S MACHINE\INSTANCE -i "c:\my-trace-definition.sql" 
```

# asp.net - ASP.NET 2.0 成员资格：ValidateUser 没有锁定用户？

> ID：564610
> 
> 赞同：0
> 
> 时间：2009-02-19T10:03:34.107
> 
> 标签：asp.net, membership, locking, validation

我在我的 ASP.NET 2.0 网站中使用默认 SQLMembershipProvider，并期望 Membership.ValidateUser 在输入多个错误密码（在我的情况下为 5 个）后锁定用户，但 ValidateUser 似乎并不关心记录错误密码尝试并锁定用户。

怎么了？

我的 web.config 中的成员资格配置：

```
<membership defaultProvider="SqlMembershipProvider" >
   <providers>
     <clear />
      <add connectionStringName="ConnectionStringName" enablePasswordRetrieval="true"
         enablePasswordReset="true" requiresQuestionAndAnswer="false"
         requiresUniqueEmail="true" passwordFormat="Encrypted" maxInvalidPasswordAttempts="5"
         minRequiredPasswordLength="6" minRequiredNonalphanumericCharacters="0"
         passwordAttemptWindow="10" passwordStrengthRegularExpression=""
         applicationName="MyApp" name="SqlMembershipProvider"
         type="System.Web.Security.SqlMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
   </providers>
</membership> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T10:18:30.917

PasswordAttemptWindow 和 MaxInvalidPasswordAttempts 设置为什么？这些配置设置是否在正确的 web.config 中设置？（测试环境实际使用的那个）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T10:25:13.867

这是我的会员使用配置，如果有任何用途，它可以按要求工作：

```
<membership defaultProvider="AspNetSqlMembershipProvider" userIsOnlineTimeWindow="30">
  <providers>
    <remove name="AspNetSqlMembershipProvider" />
    <!-- 
      Membership defaults mainly below this point:
      connString, reqQ&A - modified - all others currently default.
    -->
    <add connectionStringName="CustomSqlServerProvider"
          name="AspNetSqlMembershipProvider"
          type="System.Web.Security.SqlMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
          enablePasswordRetrieval="false"
         enablePasswordReset="true"
         requiresQuestionAndAnswer="false"
         requiresUniqueEmail="false"
         passwordFormat="Hashed"
         maxInvalidPasswordAttempts="5"
         minRequiredPasswordLength="7"
         minRequiredNonalphanumericCharacters="1"
         passwordAttemptWindow="10"
         passwordStrengthRegularExpression=""
         applicationName="/" />
  </providers>
</membership> 
```

另外，您是否尝试过使用 .Login() 方法进行身份验证过程？这就是我正在使用的，而不是 validateuser()。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-11T11:23:06.247

请将 user.[IsApproved] 设置为 true

# asp.net-mvc - MVC 和日期格式

> ID：564611
> 
> 赞同：1
> 
> 时间：2009-02-19T10:03:44.590
> 
> 标签：asp.net-mvc, date-formatting

在基于 MVC 的架构中，日期格式（长/短/时间/无时间/英国/美国）应该存在于何处？我希望能够在每个字段的基础上指定长/短/时间/无时间 - 即 DateOfBirth 不关心时间，但 CreationDate 可能。

使用 ASP.NET MVC，在 View 中似乎没有一种简单的方法可以做到这一点，这让我想知道它是否应该作为 FormattedDate 字段位于 ViewModel 中？

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T10:43:32.730

首先，（1：长/短）、（2：时间/无时间）和（3：英国/美国）之间存在差异。1\. 绝对是一个视图选择，2\. 有效地描述数据类型（“DateTime”，“Date”（不存在，您需要创建））和 3\. 是用户配置文件，这又是属于视图。

到目前为止，您只有两种类型 DateTime（存在）和 Date（不存在）。这些是您可以期望模型公开的类型。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T20:48:09.797

我把它读成两部分：

*   格式化（长，短）
*   数据类型（日期和时间，只是日期，只是时间）

第一部分主要是视图关注点，应该包含在演示文稿中。我很可能只是为 DateTime/Date/Time 制作一些扩展方法，其中包括所需的翻译，甚至可能创建类型的演示版本。

第二部分是模型问题，因为出生日期（通常）不包括时间，无论您以何种方式呈现它，并且重复讲座的开始时间不应该有日期（因为它是重复的，它会实际上有一个开始/结束）。可悲的是，.net 不包括（据我所知）日期和时间的单独对象，所以我通常自己滚动。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-23T08:34:38.793

我在这些情况下使用 Htmlhelpers。这是在丹麦（猜猜我住的地方）形成的首选金额的退还金额的原始方法。我有类似的返回日期和时间。

```
public static class FormatMoneyExtension {
    public static string FormatMoney(this HtmlHelper htmlHelper, decimal? amount) {
        if (null != amount) {
            return ((decimal)amount).ToString("N", System.Globalization.CultureInfo.CreateSpecificCulture("da-DK"));
        } else {
            return new decimal(0.0).ToString("N", System.Globalization.CultureInfo.CreateSpecificCulture("da-DK"));
        }
    }
} 
```

它使视图更具可读性，即：`<%:Html.FormatMoney(Model.amount)%>`.

您可以以类似的方式包装本机控件，例如 texbox 等。

祝你好运，工作愉快

# svn - SVN 预提交挂钩

> ID：564631
> 
> 赞同：3
> 
> 时间：2009-02-19T10:12:42.820
> 
> 标签：svn, batch-file, svn-hooks, findstr, pre-commit

我目前正在尝试扩展我们已经存在的（和工作的）预提交批处理文件以提交到 SVN。第一部分阻止任何没有评论并按预期工作的提交。第二部分是阻止用户提交 SUO 文件的尝试，但这目前正在阻止所有提交。

我对 DO 脚本的理解不是很好，所以我怀疑这可能是我对 FindStr 的使用？

任何人都可以帮忙吗？

```
"C:\Program Files\VisualSVN Server\bin\svnlook.exe" log -t %2 %1 | FindStr [a-zA-Z0-9]
IF %ERRORLEVEL% EQU 0 GOTO OK
echo "Commit Comments are Required" >&2
exit 1
:OK
"C:\Program Files\VisualSVN Server\bin\svnlook.exe" diff -t %2 %1 | FindStr /R "[a-zA-Z]\.suo"
IF %ERRORLEVEL% EQU 0 exit 0
echo "SUO files cannot be committed" >&2
exit 1 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T11:19:31.723

findstr 如果找到了某些东西，则返回 0，如果没有找到，则返回 1。你只是把支票倒过来了。

不需要 batch-foo，即使在 Windows 上，shell 也是交互式的，所以你可以尝试一下：

```
>dir | findstr ".sln"
15.01.2009  16:37            33.844 Project.sln

>echo %ERRORLEVEL%
0

>dir | findstr ".slngimpf"

>echo %ERRORLEVEL%
1 
```

顺便说一句，更容易写

```
if errorlevel 0 andthencontinuewithwhatever 
```

这样，您的脚本对于不祥的情况也很稳定：

```
set errorlevel=0 
```

然后，这将破坏任何未来以正确方式使用 %errorlevel% 打印出错误级别的尝试。

（**编辑**）重要提示：我忘了说**`if errorlevel`**语法检查错误级别是否**大于或等于**被测试的值。因此，要正确使用它，您必须始终首先检查最高错误，例如：

```
someCommand
if errorlevel 10 ...
if errorlevel 9 ...
if errorlevel 0 ... 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T10:29:15.930

不完全是您正在寻找的答案，但您可以使用 [global-ignores](http://svnbook.red-bean.com/en/1.1/ch07.html)选项阻止所有 *.suo 文件。

# c# - 如何在 Perl 中加密消息以在 C# 中解密？

> ID：564632
> 
> 赞同：1
> 
> 时间：2009-02-19T10:13:16.047
> 
> 标签：c#, .net, perl, encryption, integrity

我需要使用 Perl 加密并在 .Net (C#) 上解密。即 Perl 加密文件，我的 .Net 代码解密文件（甚至可能验证完整性）。

问题是我不熟悉 Perl 的加密功能。任何人都可以就如何最好地解决这个问题以及可能性是什么提供指导吗？

提前致谢！

直流

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-19T10:40:28.820

正如 Lars 所说，AES 可能是当今最好的选择。对于 Perl 实现，请参阅[Crypt::Rijndael](http://search.cpan.org/perldoc?Crypt::Rijndael)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T10:16:48.537

使用带有公共密钥的 AES 加密。

[Perl](http://www.google.no/search?hl=no&q=AES+perl&btnG=Google-s%C3%B8k&meta=&aq=f&oq=)

[C＃](http://www.google.no/search?hl=no&safe=off&q=AES+c%23&btnG=S%C3%B8k&meta=)

# c# - C Sharp：传入 ado.net 记录集的参数

> ID：564638
> 
> 赞同：1
> 
> 时间：2009-02-19T10:16:34.293
> 
> 标签：c#, ado.net

我正在尝试执行类似于以下的代码行

```
rs3 = cn2.Execute(strsql); 
```

但我想在 c# 中我必须传递一些参数来执行 strsql。有人可以在这个话题上启发我。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T10:54:40.380

我认为你应该看看 ADO.NET 提供给你的类和接口：

IDbConnection、ICommand、SqlConnection、SqlCommand 等......看看 System.Data 命名空间。

例如：

```
// setup a connection to a sql server
SqlConnection conn = new SqlConnection( "here is the connectionstring" );

SqlCommand cmd = new SqlCommand(conn);
cmd.CommandText = "SELECT * FROM table WHERE Id = @pId";
cmd.Parameters.Add ("@pId", SqlDbType.Int).Value = 1;

using( SqlDataReader dr = cmd.ExecuteReader() )
{
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T10:57:55.783

[ADO.NET 命令对象](http://asp.dotnetheaven.com/howto/doc/adoplus/ExecuteCommand.aspx)

# macos - “cd ..”的 Zsh 制表符补全

> ID：564648
> 
> 赞同：37
> 
> 时间：2009-02-19T10:20:39.010
> 
> 标签：macos, shell, autocomplete, zsh

如何配置 Zsh 选项卡完成，以便当我键入`cd ..<TAB>`它时它会展开`cd ../`并在再次按下`<TAB>`后建议父目录中的文件夹完成？

例如，它应该显示与键入时相同的行为，例如`cd Documents<TAB>`，它扩展为`cd Documents/`并在再次按下`<TAB>`后建议文件夹`Documents`完成。

作为配置的起点，我使用`.zshrc`来自 MacPorts 的空 Zsh 4.3.9。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-04-04T11:23:50.050

debian 不稳定，Ubuntu jaunty 也有同样的问题，都发布了 zsh 4.3.9。我知道多个具有不同配置的人。

阅读[http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=514152](http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=514152)后我添加了

```
zstyle ':completion:*' special-dirs true 
```

到我的配置，现在一切正常。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-19T10:47:08.587

把它放到你的 ~/.zshrc 中：

```
autoload -Uz compinit
compinit 
```

* * *

[在http://code.google.com/p/zsh-templates-osx/](http://code.google.com/p/zsh-templates-osx/)上还有一个用于 Mac OS X 的 zsh 功能/配置项目。就个人而言，我认为使用整个软件包有点过头了。但发现挑选一些技巧、功能、完成等并创建我自己的 .zshrc 很有用

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T12:58:22.173

事实上我现在发现问题似乎不是来自配置。当使用`.zshrc`仅包含

```
autoload -Uz compinit
compinit 
```

`cd ..<TAB>`使用默认的 Mac OS X Zsh (4.3.4) 时，tab-completion 按预期工作。但是对于 MacPorts Zsh (4.3.9)，tab-completion 仅适用于其他文件夹，不适用于 ..

* * *

## 回答 #4

> 赞同：-15
> 
> 时间：2009-02-19T10:41:36.197

这可能是一个有用的答案，也可能不是一个有用的答案 - 切换到**bash**，它可以做你想要的开箱即用。

# c# - 在 .NET 中将 HTML 转换为 PDF

> ID：564650
> 
> 赞同：486
> 
> 时间：2009-02-19T10:21:22.377
> 
> 标签：c#, html, pdf, itextsharp

我想通过将 HTML 内容传递给函数来生成 PDF。我已经为此使用了 iTextSharp，但是当它遇到表格并且布局变得混乱时，它表现不佳。

有没有更好的办法？

* * *

## 回答 #1

> 赞同：244
> 
> 时间：2015-08-11T14:35:33.960

**编辑：** [使用 PdfSharp 的 PDF 的新建议 HTML 渲染器](https://www.nuget.org/packages/HtmlRenderer.PdfSharp/)

*（在尝试 wkhtmltopdf 并建议避免它之后）*

HtmlRenderer.PdfSharp 是**100% 完全 C# 托管代码**，**易于**使用、线程安全且最重要的是**免费** *（[新 BSD 许可证](https://htmlrenderer.codeplex.com/license)）*解决方案。

用法

1.  下载**HtmlRenderer.PdfSharp** nuget 包。
2.  使用示例方法。

    ```
    public static Byte[] PdfSharpConvert(String html)
    {
        Byte[] res = null;
        using (MemoryStream ms = new MemoryStream())
        {
            var pdf = TheArtOfDev.HtmlRenderer.PdfSharp.PdfGenerator.GeneratePdf(html, PdfSharp.PageSize.A4);
            pdf.Save(ms);
            res = ms.ToArray();
        }
        return res;
    } 
    ```

**一个很好的替代品**是[iTextSharp](https://www.nuget.org/packages/iTextSharp/5.5.7)的[免费版本](https://www.nuget.org/packages/iTextSharp-LGPL/4.1.6)

在 4.1.6 版之前，iTextSharp 是在 LGPL 许可下获得许可的，并且 4.16 之前的版本（或者可能还有分叉）作为包提供并且可以免费使用。当然有人可以使用续订 5+[付费版](https://www.nuget.org/packages/iTextSharp/5.5.7)。

我试图在我的项目中集成**wkhtmltopdf**解决方案，但遇到了很多障碍。

由于以下原因，我个人会避免在托管企业应用程序上使用**基于 wkhtmltopdf 的解决方案。**

1.  首先，wkhtmltopdf 是 C++ 实现的，而不是 C#，将它嵌入到 C# 代码中会遇到各种问题，尤其是在项目的 32 位和 64 位版本之间切换时。不得不尝试几种解决方法，包括条件项目构建等，以避免在不同机器上出现“无效格式异常”。
2.  如果您管理自己的虚拟机，则可以。但是，如果您的项目在受限制的环境中运行，例如（***Azure*** *（TuesPenchin 作者提到的天蓝色实际上是不可能的*）、 **Elastic Beanstalk**等），那么仅配置该环境以使 wkhtmltopdf 工作是一场噩梦。
3.  wkhtmltopdf 正在您的服务器中创建文件，因此您必须管理用户权限并授予对 wkhtmltopdf 运行位置的“写入”访问权限。
4.  Wkhtmltopdf 作为独立应用程序运行，因此它**不受 IIS 应用程序池管理**。因此，您必须将其作为服务托管在另一台机器上，否则您将在生产服务器中遇到处理峰值和内存消耗。
5.  它使用临时文件来生成 pdf，在**AWS EC2**这样的磁盘 i/o 非常慢的情况下，这是一个很大的性能问题。
6.  许多用户报告的最讨厌的“无法加载DLL'wkhtmltox.dll'”错误。

**--- 预编辑部分 ---**

**对于任何想在更简单的应用程序/环境中从 html 生成 pdf 的人，我将我的旧帖子留作建议。**

[周二佩奇金](https://github.com/tuespetre/TuesPechkin)

[https://www.nuget.org/packages/TuesPechkin/](https://www.nuget.org/packages/TuesPechkin/)

或特别适用于**MVC** Web 应用程序 *（但我认为您可以在任何 .net 应用程序中使用它）*

[Rotativa](https://github.com/webgio/Rotativa)

[https://www.nuget.org/packages/Rotativa/](https://www.nuget.org/packages/Rotativa/)

他们都利用 [wkhtmtopdf](http://wkhtmltopdf.org/)二进制文件将 html 转换为 pdf。它使用 webkit 引擎来呈现页面，因此它也可以解析**css 样式表**。

它们提供易于使用的与 C# 的无缝集成。

Rotativa 还可以从任何**Razor** View 直接生成 PDF。

此外，对于现实世界的 Web 应用程序，他们还管理线程安全等......

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2019-09-05T17:25:40.687

**最后更新时间：2020 年 10 月**

这是我整理的 .NET 中 HTML 到 PDF 转换的选项列表（有些是免费的，有些是付费的）

*   **GemBox.Document**

    *   [https://www.nuget.org/packages/GemBox.Document/](https://www.nuget.org/packages/GemBox.Document/)
    *   免费（最多20段）
    *   680 美元 - [https://www.gemboxsoftware.com/document/pricelist](https://www.gemboxsoftware.com/document/pricelist)
    *   [https://www.gemboxsoftware.com/document/examples/c-sharp-convert-html-to-pdf/307](https://www.gemboxsoftware.com/document/examples/c-sharp-convert-html-to-pdf/307)
*   **PDF变形.Net**

    *   [https://www.nuget.org/packages/sautinsoft.pdfmetamorphosis/](https://www.nuget.org/packages/sautinsoft.pdfmetamorphosis/)
    *   539 美元 - 1078 美元 - [https://www.sautinsoft.com/products/pdf-metamorphosis/order.php](https://www.sautinsoft.com/products/pdf-metamorphosis/order.php)
    *   [https://www.sautinsoft.com/products/pdf-metamorphosis/convert-html-to-pdf-dotnet-csharp.php](https://www.sautinsoft.com/products/pdf-metamorphosis/convert-html-to-pdf-dotnet-csharp.php)
*   **HtmlRenderer.PdfSharp**

    *   [https://www.nuget.org/packages/HtmlRenderer.PdfSharp/1.5.1-beta1](https://www.nuget.org/packages/HtmlRenderer.PdfSharp/1.5.1-beta1)
    *   BSD 未指定许可证
*   **PuppeteerSharp**

    *   [https://www.puppeteersharp.com/examples/index.html](https://www.puppeteersharp.com/examples/index.html)
    *   麻省理工学院许可证
    *   [https://github.com/kblok/puppeteer-sharp](https://github.com/kblok/puppeteer-sharp)
*   **EO.PDF**

    *   [https://www.nuget.org/packages/EO.Pdf/](https://www.nuget.org/packages/EO.Pdf/)
    *   799 美元 - [https://www.essentialobjects.com/Purchase.aspx?f=3](https://www.essentialobjects.com/Purchase.aspx?f=3)
*   **WnvHtmlToPdf_x64**

    *   [https://www.nuget.org/packages/WnvHtmlToPdf_x64/](https://www.nuget.org/packages/WnvHtmlToPdf_x64/)
    *   750 美元 - 1600 美元 - [http://www.winnovative-software.com/Buy.aspx](http://www.winnovative-software.com/Buy.aspx)
    *   演示 - [http://www.winnovative-software.com/demo/default.aspx](http://www.winnovative-software.com/demo/default.aspx)
*   **铁PDF**

    *   [https://www.nuget.org/packages/IronPdf/](https://www.nuget.org/packages/IronPdf/)
    *   399 美元 - 1599 美元 - [https://ironpdf.com/licensing/](https://ironpdf.com/licensing/)
    *   [https://ironpdf.com/examples/using-html-to-create-a-pdf/](https://ironpdf.com/examples/using-html-to-create-a-pdf/)
*   **尖顶.PDF**

    *   [https://www.nuget.org/packages/Spire.PDF/](https://www.nuget.org/packages/Spire.PDF/)
    *   免费（最多 10 页）
    *   599 美元 - 1799 美元 - [https://www.e-iceblue.com/Buy/Spire.PDF.html](https://www.e-iceblue.com/Buy/Spire.PDF.html)
    *   [https://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Convert-HTML-to-PDF-Customize-HTML-to-PDF-Conversion-by-Yourself.html](https://www.e-iceblue.com/Tutorials/Spire.PDF/Spire.PDF-Program-Guide/Convert-HTML-to-PDF-Customize-HTML-to-PDF-Conversion-by-Yourself.html)
*   **假设.HTML**

    *   [https://www.nuget.org/packages/Aspose.Html/](https://www.nuget.org/packages/Aspose.Html/)
    *   599 美元 - 1797 美元 - [https://purchase.aspose.com/pricing/html/net](https://purchase.aspose.com/pricing/html/net)
    *   [https://docs.aspose.com/html/net/html-to-pdf-conversion/](https://docs.aspose.com/html/net/html-to-pdf-conversion/)
*   **EvoPDF**

    *   [https://www.nuget.org/packages/EvoPDF/](https://www.nuget.org/packages/EvoPDF/)
    *   450 美元 - 1200 美元 - [http://www.evopdf.com/buy.aspx](http://www.evopdf.com/buy.aspx)
*   **ExpertPdfHtmlToPdf**

    *   [https://www.nuget.org/packages/ExpertPdfHtmlToPdf/](https://www.nuget.org/packages/ExpertPdfHtmlToPdf/)
    *   550 美元 - 1200 美元 - [https://www.html-to-pdf.net/Pricing.aspx](https://www.html-to-pdf.net/Pricing.aspx)
*   **Zetpdf**

    *   [https://zetpdf.com](https://zetpdf.com)
    *   299 美元 - 599 美元 - [https://zetpdf.com/pricing/](https://zetpdf.com/pricing/)
    *   不是一个众所周知或受支持的库 - [ZetPDF - 有人知道这个产品的背景吗？](https://stackoverflow.com/questions/52080208/zetpdf-does-anyone-know-the-background-of-this-product)
*   **PDFtron**

    *   [https://www.pdftron.com/documentation/samples/cs/HTML2PDFTes](https://www.pdftron.com/documentation/samples/cs/HTML2PDFTes)
    *   4000 美元/年 - [https://www.pdftron.com/licensing/](https://www.pdftron.com/licensing/)
*   **WkHtmlToXSharp**

    *   [https://github.com/pruiz/WkHtmlToXSharp](https://github.com/pruiz/WkHtmlToXSharp)
    *   自由的
    *   并发转换被实现为处理队列。
*   **选择PDF**

    *   [https://www.nuget.org/packages/Select.HtmlToPdf/](https://www.nuget.org/packages/Select.HtmlToPdf/)
    *   免费（最多 5 页）
    *   499 美元 - 799 美元 - [https://selectpdf.com/pricing/](https://selectpdf.com/pricing/)
    *   [https://selectpdf.com/pdf-library-for-net/](https://selectpdf.com/pdf-library-for-net/)

如果以上选项都不能帮助您，您可以随时搜索 NuGet 包：
[https ://www.nuget.org/packages?q=html+pdf](https://www.nuget.org/packages?q=html+pdf)

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2011-04-12T13:06:13.403

大多数 HTML 到 PDF 转换器依赖 IE 来进行 HTML 解析和渲染。当用户更新他们的 IE 时，这可能会中断。[这](http://www.essentialobjects.com/Products/EOPdf/Default.aspx)是一个不依赖 IE 的。

代码是这样的：

```
EO.Pdf.HtmlToPdf.ConvertHtml(htmlText, pdfFileName); 
```

与许多其他转换器一样，您可以传递文本、文件名或 URL。结果可以保存到文件或流中。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2015-04-23T19:53:38.407

我强烈推荐[NReco](http://www.nrecosite.com/doc/NReco.PdfGenerator/)，认真的。它有免费版和付费版，真的很值得。它在后台使用 wkhtmtopdf，但您只需要一个程序集。极好的。

使用示例：

通过[NuGet](https://www.nuget.org/packages/NReco.PdfGenerator/)安装。

```
var htmlContent = String.Format("<body>Hello world: {0}</body>", DateTime.Now);
var pdfBytes = (new NReco.PdfGenerator.HtmlToPdfConverter()).GeneratePdf(htmlContent); 
```

免责声明：我不是开发人员，只是该项目的粉丝 :)

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2020-01-28T07:31:06.207

您可以在无头模式下使用 Google Chrome 打印到 PDF 功能。我发现这是最简单但最强大的方法。

```
var url = "https://stackoverflow.com/questions/564650/convert-html-to-pdf-in-net";
var chromePath = @"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe";
var output = Path.Combine(Environment.CurrentDirectory, "printout.pdf");
using (var p = new Process())
    {
        p.StartInfo.FileName = chromePath;
        p.StartInfo.Arguments = $"--headless --disable-gpu --print-to-pdf={output} {url}";
        p.Start();
        p.WaitForExit();
    } 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2017-08-20T11:40:02.723

# 2018年的更新，让我们使用标准的HTML+CSS=PDF等式！

对于 HTML 到 PDF 的需求，有好消息。正如[这个答案所示](https://stackoverflow.com/a/21345708/287948)，**W3C 标准[css-break-3](https://www.w3.org/TR/css-break-3/)将解决这个问题**……它是一个候选推荐，计划在 2017 年或 2018 年经过测试成为最终推荐。

正如[print-css.rocks 所示](https://print-css.rocks)，有一些解决方案不那么标准，带有 C# 插件。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2021-03-27T20:04:11.903

对于所有在这里寻找有效解决方案的人，`.net 5`您可以去。

这是我的工作解决方案。

### 使用`wkhtmltopdf`：

1.  [从这里](https://wkhtmltopdf.org/downloads.html)下载并安装`wkhtmltopdf`最新版本。
2.  使用下面的代码。

```
public static string HtmlToPdf(string outputFilenamePrefix, string[] urls,
    string[] options = null,
    string pdfHtmlToPdfExePath = @"C:\Program Files\wkhtmltopdf\bin\wkhtmltopdf.exe")
{
    string urlsSeparatedBySpaces = string.Empty;
    try
    {
        //Determine inputs
        if ((urls == null) || (urls.Length == 0))
            throw new Exception("No input URLs provided for HtmlToPdf");
        else
            urlsSeparatedBySpaces = String.Join(" ", urls); //Concatenate URLs

        string outputFilename = outputFilenamePrefix + "_" + DateTime.Now.ToString("yyyy-MM-dd-hh-mm-ss-fff") + ".PDF"; // assemble destination PDF file name

        var p = new System.Diagnostics.Process()
        {
            StartInfo =
            {
                FileName = pdfHtmlToPdfExePath,
                Arguments = ((options == null) ? "" : string.Join(" ", options)) + " " + urlsSeparatedBySpaces + " " + outputFilename,
                UseShellExecute = false, // needs to be false in order to redirect output
                RedirectStandardOutput = true,
                RedirectStandardError = true,
                RedirectStandardInput = true, // redirect all 3, as it should be all 3 or none
                WorkingDirectory = Path.Combine(Path.GetDirectoryName(Assembly.GetEntryAssembly().Location))
            }
        };

        p.Start();

        // read the output here...
        var output = p.StandardOutput.ReadToEnd();
        var errorOutput = p.StandardError.ReadToEnd();

        // ...then wait n milliseconds for exit (as after exit, it can't read the output)
        p.WaitForExit(60000);

        // read the exit code, close process
        int returnCode = p.ExitCode;
        p.Close();

        // if 0 or 2, it worked so return path of pdf
        if ((returnCode == 0) || (returnCode == 2))
            return outputFilename;
        else
            throw new Exception(errorOutput);
    }
    catch (Exception exc)
    {
        throw new Exception("Problem generating PDF from HTML, URLs: " + urlsSeparatedBySpaces + ", outputFilename: " + outputFilenamePrefix, exc);
    }
} 
```

3.  并将上述方法称为`HtmlToPdf("test", new string[] { "https://www.google.com" }, new string[] { "-s A5" });`
4.  如果您需要将`HTML`字符串转换为`PDF`，请调整上述方法并将其替换`Arguments`为`Process StartInfo``$@"/C echo | set /p=""{htmlText}"" | ""{pdfHtmlToPdfExePath}"" {((options == null) ? "" : string.Join(" ", options))} - ""C:\Users\xxxx\Desktop\{outputFilename}""";`

**这种方法的缺点：**

1.  发布此答案时的最新版本`wkhtmltopdf`不支持 latest`HTML5`和`CSS3`. 因此，如果您尝试导出任何 html，`CSS GRID`那么输出将不符合预期。
2.  您需要处理并发问题。

### 使用`chrome headless`：

1.  [从这里](https://www.google.com/intl/en_in/chrome/)下载并安装最新的 chrome 浏览器。
2.  使用下面的代码。

```
var p = new System.Diagnostics.Process()
{
    StartInfo =
    {
        FileName = "C:/Program Files (x86)/Google/Chrome/Application/chrome.exe",
        Arguments = @"/C --headless --disable-gpu --run-all-compositor-stages-before-draw --print-to-pdf-no-header --print-to-pdf=""C:/Users/Abdul Rahman/Desktop/test.pdf"" ""C:/Users/Abdul Rahman/Desktop/grid.html""",
    }
};

p.Start();

// ...then wait n milliseconds for exit (as after exit, it can't read the output)
p.WaitForExit(60000);

// read the exit code, close process
int returnCode = p.ExitCode;
p.Close(); 
```

3.  这会将`html`文件转换为`pdf`文件。
4.  如果您需要将一些转换`url`为`pdf`然后使用以下`Argument`内容`Process StartInfo`

`@"/C --headless --disable-gpu --run-all-compositor-stages-before-draw --print-to-pdf-no-header --print-to-pdf=""C:/Users/Abdul Rahman/Desktop/test.pdf"" ""https://www.google.com""",`

**这种方法的缺点：**

1.  这可以按预期使用最新的`HTML5`和`CSS3`功能。输出将与您在浏览器中查看的相同，但通过 IIS 运行时，您需要在 Identity`AppliactionPool`下运行您的应用程序，`LocalSystem`或者您需要提供`read`/`write`访问`IISUSRS`.

### 使用`Selenium WebDriver`：

1.  安装 Nuget 包`Selenium.WebDriver`和`Selenium.WebDriver.ChromeDriver`.
2.  使用下面的代码。

```
public async Task<byte[]> ConvertHtmlToPdf(string html)
{
    var directory = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.CommonDocuments), "ApplicationName");
    Directory.CreateDirectory(directory);
    var filePath = Path.Combine(directory, $"{Guid.NewGuid()}.html");
    await File.WriteAllTextAsync(filePath, html);

    var driverOptions = new ChromeOptions();
    // In headless mode, PDF writing is enabled by default (tested with driver major version 85)
    driverOptions.AddArgument("headless");
    using var driver = new ChromeDriver(driverOptions);
    driver.Navigate().GoToUrl(filePath);

    // Output a PDF of the first page in A4 size at 90% scale
    var printOptions = new Dictionary<string, object>
    {
        { "paperWidth", 210 / 25.4 },
        { "paperHeight", 297 / 25.4 },
        { "scale", 0.9 },
        { "pageRanges", "1" }
    };
    var printOutput = driver.ExecuteChromeCommandWithResult("Page.printToPDF", printOptions) as Dictionary<string, object>;
    var pdf = Convert.FromBase64String(printOutput["data"] as string);

    File.Delete(filePath);

    return pdf;
} 
```

**这种方法的优点：**

1.  这只需要安装 Nuget 并按预期使用最新`HTML5`的`CSS3`功能。输出将与您在浏览器中查看的相同。

**这种方法的缺点：**

1.  这种方法需要在运行应用程序的服务器上安装最新的 chrome 浏览器。

使用这种方法，请确保添加如下所示的文件`<PublishChromeDriver>true</PublishChromeDriver>`：`.csproj`

```
<PropertyGroup>
  <TargetFramework>net5.0</TargetFramework>
  <LangVersion>latest</LangVersion>
  <Nullable>enable</Nullable>
  <PublishChromeDriver>true</PublishChromeDriver>
</PropertyGroup> 
```

这将`chrome driver`在发布项目时发布。

这是我的工作项目回购的链接 - [HtmlToPdf](https://github.com/fingers10/HtmlToPdf)

`Selenium`在几乎花了 2 天时间使用可用选项并最终实施了基于解决方案及其工作后，我得出了上述答案。希望这可以帮助您并节省您的时间。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2020-05-08T19:35:51.140

Quite likely most projects will wrap a C/C++ engine rather than implementing a C# solution from scratch. Try Project [Gotenberg](https://github.com/thecodingmachine/gotenberg).

To test it

```
docker run --rm -p 3000:3000 thecodingmachine/gotenberg:6 
```

Curl sample

```
curl --request POST \
    --url http://localhost:3000/convert/url \
    --header 'Content-Type: multipart/form-data' \
    --form remoteURL=https://brave.com \
    --form marginTop=0 \
    --form marginBottom=0 \
    --form marginLeft=0 \
    --form marginRight=0 \
    -o result.pdf 
```

C# sample.cs

```
using System;
using System.Net.Http;
using System.Threading.Tasks;
using System.IO;
using static System.Console;

namespace Gotenberg
{
    class Program
    {
        public static async Task Main(string[] args)
        {
            try
            {
                var client = new HttpClient();            
                var formContent = new MultipartFormDataContent
                    {
                        {new StringContent("https://brave.com/"), "remoteURL"},
                        {new StringContent("0"), "marginTop" }
                    };
                var result = await client.PostAsync(new Uri("http://localhost:3000/convert/url"), formContent);
                await File.WriteAllBytesAsync("brave.com.pdf", await result.Content.ReadAsByteArrayAsync());
            }
            catch (Exception ex)
            {
                WriteLine(ex);
            }
        }
    }
} 
```

To compile

```
csc sample.cs -langversion:latest -reference:System.Net.Http.dll && mono ./sample.exe 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-06-21T13:45:08.070

下面是使用 iTextSharp (iTextSharp + itextsharp.xmlworker) 将 html + css 转换为 PDF 的示例

```
using iTextSharp.text;
using iTextSharp.text.pdf;
using iTextSharp.tool.xml;

byte[] pdf; // result will be here

var cssText = File.ReadAllText(MapPath("~/css/test.css"));
var html = File.ReadAllText(MapPath("~/css/test.html"));

using (var memoryStream = new MemoryStream())
{
        var document = new Document(PageSize.A4, 50, 50, 60, 60);
        var writer = PdfWriter.GetInstance(document, memoryStream);
        document.Open();

        using (var cssMemoryStream = new MemoryStream(System.Text.Encoding.UTF8.GetBytes(cssText)))
        {
            using (var htmlMemoryStream = new MemoryStream(System.Text.Encoding.UTF8.GetBytes(html)))
            {
                XMLWorkerHelper.GetInstance().ParseXHtml(writer, document, htmlMemoryStream, cssMemoryStream);
            }
        }

        document.Close();

        pdf = memoryStream.ToArray();
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-19T10:26:41.290

这取决于您的任何其他要求。

一个非常简单但不易部署的解决方案是使用 WebBrowser 控件加载 Html，然后使用 Print 方法打印到本地安装的 PDF 打印机。有几种免费的 PDF 打印机可用，WebBrowser 控件是 .Net 框架的一部分。

编辑：如果您的 Html 是 XHtml，您可以使用[PDFizer](https://sourceforge.net/projects/pdfizer/)来完成这项工作。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-01-02T07:32:41.607

到目前为止，最好的**免费**.NET 解决方案似乎是[TuesPechkin](https://github.com/tuespetre/TuesPechkin)库，它是[wkhtmltopdf](https://github.com/wkhtmltopdf/wkhtmltopdf)本机库的包装器。

我现在使用单线程版本将几千个 HTML 字符串转换为 PDF 文件，它似乎工作得很好。它应该也可以在多线程环境（例如 IIS）中工作，但我还没有测试过。

另外由于我想使用最新版本的**wkhtmltopdf**（撰写本文时为 0.12.5），我从官方网站下载了 DLL，将其复制到我的项目根目录，将复制到输出设置为 true，然后初始化库，如所以：

```
var dllDir = AppDomain.CurrentDomain.BaseDirectory;
Converter = new StandardConverter(new PdfToolset(new StaticDeployment(dllDir))); 
```

上面的代码将***准确地查找***“wkhtmltox.dll”，所以不要重命名文件。我使用了 64 位版本的 DLL。

确保您阅读了多线程环境的说明，因为您必须在每个应用程序生命周期中只初始化一次，因此您需要将其放入单例或其他东西中。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-08T16:26:36.023

我前段时间也在找这个。我遇到了 HTMLDOC [http://www.easysw.com/htmldoc/](http://www.easysw.com/htmldoc/)，这是一个免费的开源命令行应用程序，它将 HTML 文件作为参数并从中输出 PDF。对于我的副业项目来说，这对我来说效果很好，但这一切都取决于你实际需要什么。

制造它的公司出售编译后的二进制文件，但您可以免费从源代码下载和编译并免费使用它。我设法编译了一个最近的修订版（1.9 版），我打算在几天内发布一个二进制安装程序，所以如果你有兴趣，我可以在发布后立即提供一个链接。

编辑（2/25/2014）：似乎文档和站点已移至[http://www.msweet.org/projects.php?Z1](http://www.msweet.org/projects.php?Z1)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-11-14T14:08:50.700

如果您需要在 pdf 中完美呈现 html，则需要使用商业库。

[ExpertPdf Html To Pdf Converter](http://www.html-to-pdf.net/ ".NET 的 Html 到 pdf")非常易于使用，它支持最新的html5/css3。您可以将整个 url 转换为 pdf：

```
using ExpertPdf.HtmlToPdf; 
byte[] pdfBytes = new PdfConverter().GetPdfBytesFromUrl(url); 
```

或一个 html 字符串：

```
using ExpertPdf.HtmlToPdf; 
byte[] pdfBytes = new PdfConverter().GetPdfBytesFromHtmlString(html, baseUrl); 
```

您还可以选择将生成的 pdf 文档直接保存到磁盘上的文件流中。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2019-03-06T07:41:41.223

这是一个**免费的图书馆**，很容易工作：***OpenHtmlToPdf***

```
string timeStampForPdfName = DateTime.Now.ToString("yyMMddHHmmssff");

string serverPath = System.Web.Hosting.HostingEnvironment.MapPath("~/FolderName");
string pdfSavePath = Path.Combine(@serverPath, "FileName" + timeStampForPdfName + ".FileExtension");

//OpenHtmlToPdf Library used for Performing PDF Conversion
var pdf = Pdf.From(HTML_String).Content();

//FOr writing to file from a ByteArray
 File.WriteAllBytes(pdfSavePath, pdf.ToArray()); // Requires System.Linq 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-02-02T06:16:58.377

[要在 C# 中将 HTML 转换为 PDF，请使用 ABCpdf](http://www.websupergoo.com/abcpdf-html.htm)。

ABCpdf 可以使用 Gecko 或 Trident 渲染引擎，因此您的 HTML 表格看起来与在 FireFox 和 Internet Explorer 中显示的相同。

在 www.abcpdfeditor.com 上有一个 ABCpdf 的在线演示。您可以使用它来检查您的表格将如何首先呈现，而无需下载和安装软件。

要渲染整个网页，您需要 AddImageUrl 或 AddImageHtml 函数。但是，如果您只想添加 HTML 样式的文本，那么您可以尝试 AddHtml 函数，如下所示：

```
Doc theDoc = new Doc();
theDoc.FontSize = 72;
theDoc.AddHtml("<b>Some HTML styled text</b>");
theDoc.Save(Server.MapPath("docaddhtml.pdf"));
theDoc.Clear(); 
```

ABCpdf 是一个商业软件名称，但是标准版通常可以通过特价免费获得。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-06-11T09:22:38.317

您可以创建 HTML 页面的位图，然后将位图插入 PDF，而不是将 HTML 直接解析为 PDF，例如使用[iTextSharp](http://sourceforge.net/projects/itextsharp/)。

这是如何获取 URL 的位图的代码。我在 SO 的某个地方找到了它，如果我找到源代码，我会链接它。

```
public System.Drawing.Bitmap HTMLToImage(String strHTML)
{
    System.Drawing.Bitmap myBitmap = null;

    System.Threading.Thread myThread = new System.Threading.Thread(delegate()
    {
        // create a hidden web browser, which will navigate to the page
        System.Windows.Forms.WebBrowser myWebBrowser = new System.Windows.Forms.WebBrowser();
        // we don't want scrollbars on our image
        myWebBrowser.ScrollBarsEnabled = false;
        // don't let any errors shine through
        myWebBrowser.ScriptErrorsSuppressed = true;
        // let's load up that page!    
        myWebBrowser.Navigate("about:blank");

        // wait until the page is fully loaded
        while (myWebBrowser.ReadyState != System.Windows.Forms.WebBrowserReadyState.Complete)
            System.Windows.Forms.Application.DoEvents();

        myWebBrowser.Document.Body.InnerHtml = strHTML;

        // set the size of our web browser to be the same size as the page
        int intScrollPadding = 20;
        int intDocumentWidth = myWebBrowser.Document.Body.ScrollRectangle.Width + intScrollPadding;
        int intDocumentHeight = myWebBrowser.Document.Body.ScrollRectangle.Height + intScrollPadding;
        myWebBrowser.Width = intDocumentWidth;
        myWebBrowser.Height = intDocumentHeight;
        // a bitmap that we will draw to
        myBitmap = new System.Drawing.Bitmap(intDocumentWidth - intScrollPadding, intDocumentHeight - intScrollPadding);
        // draw the web browser to the bitmap
        myWebBrowser.DrawToBitmap(myBitmap, new System.Drawing.Rectangle(0, 0, intDocumentWidth - intScrollPadding, intDocumentHeight - intScrollPadding));
    });
    myThread.SetApartmentState(System.Threading.ApartmentState.STA);
    myThread.Start();
    myThread.Join();

    return myBitmap;
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-03-18T10:12:39.257

我发现并用于生成 javascript 和样式呈现的视图或 html 页面的 PDF 的最佳工具是**phantomJS**。

下载带有示例文件夹 exe 根目录中的 rasterize.js 函数的 .exe 文件并放入解决方案中。

它甚至允许您在不打开该文件的情况下以任何代码下载文件，它还允许在应用样式和特别是 jquery 时下载文件。

以下代码生成 PDF 文件：

```
public ActionResult DownloadHighChartHtml()
{
    string serverPath = Server.MapPath("~/phantomjs/");
    string filename = DateTime.Now.ToString("ddMMyyyy_hhmmss") + ".pdf";
    string Url = "http://wwwabc.com";

    new Thread(new ParameterizedThreadStart(x =>
    {
        ExecuteCommand(string.Format("cd {0} & E: & phantomjs rasterize.js {1} {2} \"A4\"", serverPath, Url, filename));
                           //E: is the drive for server.mappath
    })).Start();

    var filePath = Path.Combine(Server.MapPath("~/phantomjs/"), filename);

    var stream = new MemoryStream();
    byte[] bytes = DoWhile(filePath);

    Response.ContentType = "application/pdf";
    Response.AddHeader("content-disposition", "attachment;filename=Image.pdf");
    Response.OutputStream.Write(bytes, 0, bytes.Length);
    Response.End();
    return RedirectToAction("HighChart");
}

private void ExecuteCommand(string Command)
{
    try
    {
        ProcessStartInfo ProcessInfo;
        Process Process;

        ProcessInfo = new ProcessStartInfo("cmd.exe", "/K " + Command);

        ProcessInfo.CreateNoWindow = true;
        ProcessInfo.UseShellExecute = false;

        Process = Process.Start(ProcessInfo);
    }
    catch { }
}

private byte[] DoWhile(string filePath)
{
    byte[] bytes = new byte[0];
    bool fail = true;

    while (fail)
    {
        try
        {
            using (FileStream file = new FileStream(filePath, FileMode.Open, FileAccess.Read))
            {
                bytes = new byte[file.Length];
                file.Read(bytes, 0, (int)file.Length);
            }

            fail = false;
        }
        catch
        {
            Thread.Sleep(1000);
        }
    }

    System.IO.File.Delete(filePath);
    return bytes;
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2015-09-03T09:18:50.820

您也可以检查**Spire**，它允许您`HTML to PDF`使用这段简单的代码进行创建

```
 string htmlCode = "<p>This is a p tag</p>";

//use single thread to generate the pdf from above html code
Thread thread = new Thread(() =>
{ pdf.LoadFromHTML(htmlCode, false, setting, htmlLayoutFormat); });
thread.SetApartmentState(ApartmentState.STA);
thread.Start();
thread.Join();

// Save the file to PDF and preview it.
pdf.SaveToFile("output.pdf");
System.Diagnostics.Process.Start("output.pdf"); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2016-12-02T11:48:59.687

作为 HiQPdf Software 的代表，我相信最好的解决方案是[HiQPdf HTML to PDF converter for .NET](http://www.hiqpdf.com/)。它包含市场上最先进的 HTML5、CSS3、SVG 和 JavaScript 渲染引擎。还有一个[免费版本的 HTML 到 PDF 库](http://www.hiqpdf.com/free-html-to-pdf-converter.aspx)，您可以使用它免费生成多达 3 个 PDF 页面。从 HTML 页面生成 PDF 作为 byte[] 的最小 C# 代码是：

```
HtmlToPdf htmlToPdfConverter = new HtmlToPdf();

// set PDF page size, orientation and margins
htmlToPdfConverter.Document.PageSize = PdfPageSize.A4;
htmlToPdfConverter.Document.PageOrientation = PdfPageOrientation.Portrait;
htmlToPdfConverter.Document.Margins = new PdfMargins(0);

// convert HTML to PDF 
byte[] pdfBuffer = htmlToPdfConverter.ConvertUrlToMemory(url); 
```

[您可以在HiQPdf HTML to PDF Converter 示例存储库](https://hiqpdf.codeplex.com/)中找到更详细的 ASP.NET 和 MVC示例。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-08-01T16:43:14.300

试试这个**PDF Duo .Net**转换组件，用于将[ASP.NET](http://www.duodimension.com)应用程序中的 HTML 转换为 PDF，而无需使用额外的 dll。

您可以传递 HTML 字符串或文件，或流以生成 PDF。使用下面的代码（示例 C#）：

```
string file_html = @"K:\hdoc.html";   
string file_pdf = @"K:\new.pdf";   
try   
{   
    DuoDimension.HtmlToPdf conv = new DuoDimension.HtmlToPdf();   
    conv.OpenHTML(file_html);   
    conv.SavePDF(file_pdf);   
    textBox4.Text = "C# Example: Converting succeeded";   
} 
```

Info + C#/VB 示例可以在以下位置找到：[http ://www.duodimension.com/html_pdf_asp.net/component_html_pdf.aspx](http://www.duodimension.com/html_pdf_asp.net/component_html_pdf.aspx)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-09-13T09:35:41.500

使用[Winnovative HTML 到 PDF](http://www.winnovative-software.com/)转换器，您可以在一行中转换 HTML 字符串

```
byte[] outPdfBuffer = htmlToPdfConverter.ConvertHtml(htmlString, baseUrl); 
```

基本 URL 用于解析 HTML 字符串中的相对 URL 引用的图像。或者，您可以使用 HTML 中的完整 URL 或使用 src="data:image/png" 作为图像标签嵌入图像。

在回答有关 Winnovative 转换器的“fubaar”用户评论时，需要进行更正。该转换器不使用 IE 作为渲染引擎。它实际上不依赖于任何已安装的软件，并且渲染与 WebKit 引擎兼容。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-03-18T09:28:42.857

如果您希望用户在浏览器中下载渲染页面的 pdf，那么最简单的问题解决方案是

```
window.print(); 
```

在客户端，它将提示用户保存当前页面的 pdf。您还可以通过链接样式自定义pdf的外观

```
<link rel="stylesheet" type="text/css" href="print.css" media="print"> 
```

print.css 在打印时应用于 html。

**局限性**

您不能将文件存储在服务器端。用户提示打印页面而不是他必须手动保存页面。页面必须在选项卡中呈现。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-02-24T07:57:13.010

如果您已经在使用 itextsharp dll，则无需添加第三方 dll（插件），我认为您使用的是 htmlworker 而不是使用 xmlworker，您可以轻松地将 html 转换为 pdf。

有些 css 不能工作，它们是[受支持的 CSS](http://demo.itextsupport.com/xmlworker/itextdoc/CSS-conformance-list.htm)
[完整解释，带有示例参考点击这里](http://allinworld99.blogspot.com/2016/02/how-to-convert-html-to-pdf-using-c.html)

```
 MemoryStream memStream = new MemoryStream();
        TextReader xmlString = new StringReader(outXml);
        using (Document document = new Document())
        {
            PdfWriter writer = PdfWriter.GetInstance(document, memStream);
            //document.SetPageSize(iTextSharp.text.PageSize.A4);
            document.Open();
            byte[] byteArray = System.Text.Encoding.UTF8.GetBytes(outXml);
            MemoryStream ms = new MemoryStream(byteArray);
            XMLWorkerHelper.GetInstance().ParseXHtml(writer, document, ms, System.Text.Encoding.UTF8);
            document.Close();
        }

        Response.ContentType = "application/pdf";
        Response.AddHeader("content-disposition", "attachment;filename=" + filename + ".pdf");
        Response.Cache.SetCacheability(HttpCacheability.NoCache);
        Response.BinaryWrite(memStream.ToArray());
        Response.End();
        Response.Flush(); 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-09-08T11:33:28.053

PDFmyURL 最近还发布了一个用于网页/HTML 到 PDF 转换的 .NET 组件。这有一个非常用户友好的界面，例如：

```
PDFmyURL pdf = new PDFmyURL("yourlicensekey");
pdf.ConvertURL("http://www.example.com", Application.StartupPath + @"\example.pdf"); 
```

文档：[PDFmyURL .NET 组件文档](http://pdfmyurl.com/html-to-pdf-api-net-component)

免责声明：我为拥有 PDFmyURL 的公司工作

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-08-29T11:56:31.847

您可以使用 WebBrowser 控件的另一个技巧，下面是我的完整工作代码

在我的情况下将 URL 分配给文本框控件

```
 protected void Page_Load(object sender, EventArgs e)
{

   txtweburl.Text = "https://www.google.com/";

 } 
```

下面是使用线程生成屏幕的代码

```
 protected void btnscreenshot_click(object sender, EventArgs e)
  {
    //  btnscreenshot.Visible = false;
    allpanels.Visible = true;
    Thread thread = new Thread(GenerateThumbnail);
    thread.SetApartmentState(ApartmentState.STA);
    thread.Start();
    thread.Join();

}

private void GenerateThumbnail()
{
    //  btnscreenshot.Visible = false;
    WebBrowser webrowse = new WebBrowser();
    webrowse.ScrollBarsEnabled = false;
    webrowse.AllowNavigation = true;
    string url = txtweburl.Text.Trim();
    webrowse.Navigate(url);
    webrowse.Width = 1400;
    webrowse.Height = 50000;

    webrowse.DocumentCompleted += webbrowse_DocumentCompleted;
    while (webrowse.ReadyState != WebBrowserReadyState.Complete)
    {
        System.Windows.Forms.Application.DoEvents();
    }
} 
```

在下面的代码中，我在下载后保存 pdf 文件

```
 private void webbrowse_DocumentCompleted(object sender, WebBrowserDocumentCompletedEventArgs e)
{
    // btnscreenshot.Visible = false;
    string folderPath = Server.MapPath("~/ImageFiles/");

    WebBrowser webrowse = sender as WebBrowser;
    //Bitmap bitmap = new Bitmap(webrowse.Width, webrowse.Height);

    Bitmap bitmap = new Bitmap(webrowse.Width, webrowse.Height, PixelFormat.Format16bppRgb565);

    webrowse.DrawToBitmap(bitmap, webrowse.Bounds);

    string Systemimagedownloadpath = System.Configuration.ConfigurationManager.AppSettings["Systemimagedownloadpath"].ToString();
    string fullOutputPath = Systemimagedownloadpath + Request.QueryString["VisitedId"].ToString() + ".png";
    MemoryStream stream = new MemoryStream();
    bitmap.Save(fullOutputPath, System.Drawing.Imaging.ImageFormat.Jpeg);

    //generating pdf code 
     Document pdfDoc = new Document(new iTextSharp.text.Rectangle(1100f, 20000.25f));
     PdfWriter writer = PdfWriter.GetInstance(pdfDoc, Response.OutputStream);
     pdfDoc.Open();
     iTextSharp.text.Image img = iTextSharp.text.Image.GetInstance(fullOutputPath);   
     img.ScaleAbsoluteHeight(20000);
     img.ScaleAbsoluteWidth(1024);     
     pdfDoc.Add(img);
     pdfDoc.Close();
     //Download the PDF file.
     Response.ContentType = "application/pdf";
     Response.AddHeader("content-disposition", "attachment;filename=ImageExport.pdf");
     Response.Cache.SetCacheability(HttpCacheability.NoCache);
     Response.Write(pdfDoc);
     Response.End();

} 
```

您还可以参考我最旧的帖子以获取更多信息：[Navigation to the pages was cancelled getting message in asp.net web form](https://stackoverflow.com/questions/57602584/navigation-to-the-webpage-was-canceled-getting-message-in-asp-net-web-form?noredirect=1#comment101797192_57602584)

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2017-06-15T11:18:52.693

[另一个建议是通过https://grabz.it](https://grabz.it)尝试解决方案。

他们提供了一个很好的 .NET API 来捕捉屏幕截图并以一种简单灵活的方式对其进行操作。

要在您的应用程序中使用它，您需要先获取[密钥 + 秘密](https://grabz.it/api/#Key)并[下载](https://grabz.it/api/aspnet/download.aspx).NET SDK（它是免费的）。

现在是一个使用它的简短示例。

要使用 API，您首先需要创建 GrabzItClient 类的实例，将应用程序密钥和应用程序机密从 GrabzIt 帐户传递给构造函数，如下例所示：

```
//Create the GrabzItClient class
//Replace "APPLICATION KEY", "APPLICATION SECRET" with the values from your account!
private GrabzItClient grabzIt = GrabzItClient.Create("Sign in to view your Application Key", "Sign in to view your Application Secret"); 
```

现在，要将 HTML 转换为 PDF，您只需：

```
grabzIt.HTMLToPDF("<html><body><h1>Hello World!</h1></body></html>"); 
```

您也可以转换为图像：

```
grabzIt.HTMLToImage("<html><body><h1>Hello World!</h1></body></html>"); 
```

接下来，您需要保存图像。您可以使用两种可用的保存方法之一，`Save`如果可公开访问的回调句柄可用，`SaveTo`否则。[检查文档](https://grabz.it/api/aspnet/)以获取详细信息。

# xslt - 使用 XSLT 更改 XML 中的字体

> ID：564652
> 
> 赞同：1
> 
> 时间：2009-02-19T10:23:05.743
> 
> 标签：xslt

我是 XSLT 的新手。我正在尝试使用 XSLT 更改 XML 文件中特定文本的字体大小。例如，我有包含以下数据的 CDDatalog.xml 文件。

```
 <?xml version="1.0" encoding="ISO-8859-1" ?>
<?xml-stylesheet type="text/xsl" href="cdcat.xsl"?>

<catalog>
 <cd>
  <title>Empire Burlesque</title> 
  <artist><SmallText>Bob Dylan</SmallText><LineBreak/>*</artist>
  <country>USA</country>
  <company>Columbia</company> 
  <price>10.90</price> 
  <year>1985</year> 
  </cd>
</catalog> 
```

cdCat.XSL 文件是-

```
<?xml version="1.0" encoding="ISO-8859-1" ?> 

<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:output method="html" version="1.0" encoding="UTF-8" indent="yes" />
  <xsl:include href="cdCatalog.xsl" /> <!-- I added this -->
<xsl:template match="/">
 <html>
 <body>
  <h2>My CD Collection</h2> 
 <table border="1">
 <tr bgcolor="#9acd32">
  <th align="left">Title</th> 
  <th align="left">Artist</th> 
  </tr>
 <xsl:for-each select="catalog/cd">
 <tr>
 <td>
  <xsl:value-of select="title" /> 
  </td>
 <td>
 <xsl:value-of select="artist" /> 
  </td>
  </tr>
  </xsl:for-each>

  </table>
  </body>
  </html>
  </xsl:template>

</xsl:stylesheet> 
```

我添加了一个新的 xsl 文件 cdCatalog.XSL 文件，其中包含以下详细信息 -

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

<xsl:template match="LineBreak">
    <br/>
</xsl:template>

<xsl:template match="Superscript">
    <sup>
        <xsl:value-of select="."/>
    </sup>
</xsl:template>

<xsl:template match="SmallText">
    <font size="1">
        <xsl:value-of select="."/>
    </font>
</xsl:template>
</xsl:stylesheet> 
```

并将此文件包含在 CDCat.xsl 文件中。并在 CdCatalog.xml 文件中添加了标签`<smallText>`- `<LineBreak>`。现在，当我打开 xml 文件时，我看不到 LineBreak 也看不到字体大小的差异。任何人都可以建议我是否遗漏了什么。

提前感谢赛

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T10:39:30.400

您需要使用 apply-templates 来指示您的模板匹配应该在哪里生效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T10:27:38.650

XML 没有说明任何关于表示的内容，这就是重点。这是一种*数据*格式。

如果您希望您的 XSLT 输出到显示很重要的内容，我建议您转换为 HTML 并让 HTML/CSS 处理样式。

* * *

现在看到您的实际代码（提示：创建问题时使用格式）不要使用字体标签。您在语义上和实践中想要的只是 headers `<h1>`、`<h2>`等`<h3>`，我仍然建议您在其中添加一个 CSS 链接。哦和`<xsl:output method="html" />`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T10:44:42.087

在这两个开始标签之间：

```
<html>
<body> 
```

...我会放置一个指向定义字体大小的样式表的链接。或者（如果您想要一个自包含的 HTML 文件通过电子邮件发送，这很有用）您可以在那里放置一个样式块。

# silverlight - Silverlight 2 GDR 1 的最佳实践？

> ID：564658
> 
> 赞同：0
> 
> 时间：2009-02-19T10:26:10.213
> 
> 标签：silverlight

今天早上我注意到一些关于 Silverlight 新版本发布的推文 - Silverlight 2 GDR 1 (2.0.40115.0)。什么/为什么/我应该针对它/它是否向后兼容/等等的细节在地面上看起来非常薄。

在 Microsoft.com 上点击此[Silverlight 页面](http://www.microsoft.com/silverlight/resources/install.aspx)告诉我我的版本 (RTW) 现在已过时，我应该升级到 GDR 1。但点击[silverlight.net](http://silverlight.net/) - 没有提及它，页面上的 Silverlight 元素不告诉我的版本已过时，入门页面仍链接到 RTW 工具。

这让我推测，如果您升级您的开发工具以针对 GDR 版本，那么您的用户也需要升级他们的 Silverlight 安装？

可以在[发行说明](http://download.microsoft.com/download/F/D/8/FD8F5947-78FF-40A5-9A34-5E35243C12E4/40115/Microsoft%20Silverlight%20Release%20History.html)中找到有关 GDR 中内容的一些详细信息- 但如果 Microsoft 能够阐明其目的并建议采用，那肯定会很好。有人知道更多细节吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T16:47:47.633

Tim Heuer 解释了一切：[http ://timheuer.com/blog/archive/2009/02/19/silverlight-2-gets-minor-update-gdr1.aspx](http://timheuer.com/blog/archive/2009/02/19/silverlight-2-gets-minor-update-gdr1.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T13:29:08.433

它似乎只是错误修复。

因此，如果您的应用程序（因此您的用户）不关心这些错误，则暂时不需要更新您的插件。

# iphone - 物体运动中的抖动效应

> ID：564661
> 
> 赞同：0
> 
> 时间：2009-02-19T10:27:12.240
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch

我正在尝试创建一个游戏，其中很少有对象（UIImageViews）遍历屏幕...这些对象以 1 到 0.45 秒的间隔生成...当它们在 1-0.60 秒的范围内生成时，它们会顺利遍历。 .但是当它们以小于 0.6 秒的速度生成时，它们的运动并不顺畅，它们开始抽搐..我还有一个 UIImageView，它会根据 touchesmoved 事件改变位置...请帮忙

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T10:29:13.903

显然，您的游戏使用了过多的 CPU 功率。尝试使用分析器（例如 Shark）对其进行优化，并减少对象创建方法的耗时。（一次创建一堆对象，然后重复使用它们而不是创建新对象？）

## 什么是剖析？

我你根本不知道分析，请阅读[Mike Ash 写的这篇介绍](http://www.mikeash.com/?page=pyblog/friday-qa-2009-02-06-profiling-with-shark.html)。（优秀的博客顺便说一句。）

[这是 Apple 的 Shark 文档](http://developer.apple.com/documentation/developertools/Conceptual/SharkUserGuide/SelectingExecutiontoSampleorTrace/chapter_6_section_9.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T11:14:27.727

嘿伙计们，我能够通过创建 3 个不同的线程来解决这个问题，即一个用于生成对象，一个用于遍历对象，另一个用于在触摸移动事件上移动对象。我以前用过定时器...

但使用线程解决了问题

无论如何感谢您的所有帮助:)

# python - Python - ConfigParser 抛出评论

> ID：564662
> 
> 赞同：1
> 
> 时间：2009-02-19T10:27:21.943
> 
> 标签：python, configparser

基于 ConfigParser 模块，我如何过滤掉并抛出 ini 文件中的每条评论？

```
import ConfigParser
config = ConfigParser.ConfigParser()
config.read("sample.cfg")

for section in config.sections():
    print section
    for option in config.options(section):
        print option, "=", config.get(section, option) 
```

例如。在上面的基本脚本下面的 ini 文件中打印出进一步的注释行，例如：

```
something  = 128     ; comment line1
                      ; further comments 
                       ; one more line comment 
```

我需要的是其中只有部分名称和纯键值对，没有任何注释。ConfigParser 是否以某种方式处理这个问题，或者我应该使用正则表达式......还是？干杯

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T10:36:28.160

根据以or开头的[文档](http://docs.python.org/library/configparser.html)行将被忽略。您的格式似乎不满足该要求。您可以更改输入文件的格式吗？`;``#`

**编辑**：由于您无法修改输入文件，我建议您使用以下内容预先解析它们：

```
tmp_fname = 'config.tmp'
with open(config_file) as old_file:
    with open(tmp_fname, 'w') as tmp_file:
        tmp_file.writelines(i.replace(';', '\n;') for i in old_lines.readlines())
# then use tmp_fname with ConfigParser 
```

显然，如果分号出现在选项中，您将不得不更有创意。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T13:38:19.033

最好的方法是编写一个无注释的`file`子类：

```
class CommentlessFile(file):
    def readline(self):
        line = super(CommentlessFile, self).readline()
        if line:
            line = line.split(';', 1)[0].strip()
            return line + '\n'
        else:
            return '' 
```

您可以将它与 configparser （您的代码）一起使用：

```
import ConfigParser
config = ConfigParser.ConfigParser()
config.readfp(CommentlessFile("sample.cfg"))

for section in config.sections():
    print section
    for option in config.options(section):
        print option, "=", config.get(section, option) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T11:40:31.267

看来您的评论不在以评论领导者*开头的行上。*如果评论领导者是该行的第一个字符，它应该可以工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-12T05:37:27.497

正如文档所说：“（为了向后兼容，只有 ; 开始一个内联注释，而 # 没有。）”所以使用“;” 而不是 "#" 用于内联注释。它对我来说效果很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-20T06:30:42.090

Python 3 带有一个内置解决方案：类[configparser.RawConfigParser](http://docs.python.org/py3k/library/configparser.html?highlight=rawconfigparser#rawconfigparser-objects)具有构造函数参数`inline_comment_prefixes`。例子：

```
class MyConfigParser(configparser.RawConfigParser):
    def __init__(self):
      configparser.RawConfigParser.__init__(self, inline_comment_prefixes=('#', ';')) 
```

# sql - 存储过程的统计结果

> ID：564667
> 
> 赞同：15
> 
> 时间：2009-02-19T10:28:18.163
> 
> 标签：sql, stored-procedures

我有一个存储过程返回 ID、名称、描述并且不接受输入参数。但是，我对我得到多少结果感兴趣。

我期待这样的工作：

```
SELECT COUNT(*) FROM EXEC MyStoredProcedure 
```

但我在 SqlServer Managment Studio 中收到以下错误：关键字“EXEC”附近的语法不正确。你能告诉我一个小代码示例我该怎么做吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-19T10:34:42.953

这行不通。我可以建议：

```
exec MyStoredProcedure
select @@rowcount 
```

或者，您可以将计数作为输出参数返回

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T10:36:53.993

您需要将逻辑放入存储过程中并从存储过程中返回计数。您可以在查询后立即使用@@ROWCOUNT 变量来执行此操作。这至少可以在 MS SQL Servet 中工作。

**存储过程：**

```
CREATE PROC MyPROC
AS
DECLARE @MyCount int

...

SELECT * FROM MyTable WHERE ...

SELECT @MyCount = @@ROWCOUNT

...

return @MyCOunt 
```

**调用代码：**

```
DECLARE @MyCount int

EXEC @MyCount = EXEC MyProc 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T10:37:01.920

```
SELECT @@ROWCOUNT 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-02-19T10:31:25.257

编写一个新的存储过程，它会为您计算。

# sharepoint - 在 SharePoint 中创建子网站需要很长时间

> ID：564670
> 
> 赞同：2
> 
> 时间：2009-02-19T10:30:38.487
> 
> 标签：sharepoint

我在一个 MOSS 2007 项目中工作，并定制了其中的许多部分。生产服务器存在问题，需要很长时间（超过 15 分钟，有时由于超时而失败）来创建子站点（即使使用内置站点模板）。在开发服务器中，只需 1 到 2 分钟。

两台服务器都具有相同的配置，具有 8 核 CPU 和 8 GIGs RAM。两者都使用具有相同配置的单独数据库服务器。内容数据库大小约为 100 GB。那里有一百多个子站点。

在另一台服务器上花费这么多时间的原因可能是什么？有什么配置或其他我需要注意的吗？

## 更新：

所以今天我有机会和我的客户一起检查环境。但是，尽管他们说他们没有更改服务器中的任何配置，但站点创建速度如此之快。

我还利用这个机会检查了数据库。磁盘碎片非常高，达到 49%，所以我建议他们运行碎片整理。而且我还要求将数据库文件增长从默认的 1MB 增加到 100MB。

因此，我怀疑某些进程以前在服务器上大量运行，这就是为什么花了这么多时间。

## 更新 2：

昨天我的客户报告说网站创建又慢了，所以我去检查它。当我检查数据库时，我发现内容数据库大小不是报告的**100GB ，而是大约****30GB**。所以它仍然远低于推荐的尺寸。

引起我注意的一件事是，网站收藏回收站里有近**500 万件物品**。而且每当我尝试浏览网站集回收站时，打开都会花费大量时间，并且整个网站集都无法访问。

由于 Web 应用程序设置设置为默认值（清理前 30 天，第二阶段回收站的大小为 50%），这是正常的还是潜在的问题？

实际上，还有另一个 Web 应用程序使用具有 100GB 内容数据库的同一数据库服务器，而且它总是很快。但是30GB的速度很慢。两者都具有相同的设置，只有不同的数据。

接下来我应该检查什么？

* * *

所以今天我有机会和我的客户一起检查环境。但是，尽管他们说他们没有更改服务器中的任何配置，但站点创建速度如此之快。

我还利用这个机会检查了数据库。磁盘碎片非常高，达到 49%，所以我建议他们运行碎片整理。而且我还要求将数据库文件增长从默认的 1MB 增加到 100MB。

因此，我怀疑某些进程以前在服务器上大量运行，这就是为什么花了这么多时间。

感谢大家的投入，我真的很感激。

* * *

昨天我的客户报告说网站创建又慢了，所以我去检查它。当我检查数据库时，我发现内容数据库大小不是报告的**100GB ，而是大约****30GB**。所以它仍然远低于推荐的尺寸。

引起我注意的一件事是，网站收藏回收站里有近**500 万件物品**。而且每当我尝试浏览网站集回收站时，打开都会花费大量时间，并且整个网站集都无法访问。

由于 Web 应用程序设置设置为默认值（清理前 30 天，第二阶段回收站的大小为 50%），这是正常的还是潜在的问题？

实际上，还有另一个 Web 应用程序使用具有 100GB 内容数据库的同一数据库服务器，而且它总是很快。但是30GB的速度很慢。两者都具有相同的设置，只有不同的数据。

知道接下来我应该检查什么吗？非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-14T06:36:17.730

是的，如果您没有关闭第二阶段回收站或设置站点配额，则它是正常的 OOB。如果没有设置站点配额，则第二阶段回收站的增长不受限制...

第二阶段回收站默认限制为站点配额的 50%，换句话说，如果您的站点配额为 100gb，那么您将拥有一个 50gb 的第二阶段回收站。如果未设置站点配额，则没有任何增长限制...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T15:09:03.460

[我支持 Nat 所说](https://stackoverflow.com/questions/564670/creating-a-sub-site-in-sharepoint-takes-a-very-long-time/569239#569239)的一切，并强调拆分内容数据库。如果您有多个网站集而不是一个庞大的网站集，则有[关于如何执行此操作的说明。](http://technet.microsoft.com/en-us/library/cc825328.aspx)

还要检查您的 SharePoint 数据库是否状况良好。你试过 DBCC CHECKDB 吗？您是否配置了 SQL Server 维护计划来重新索引和减少碎片？阅读[TechNet 上的这些资源](http://technet.microsoft.com/en-us/library/cc263420.aspx)（尤其是数据库维护文章）以了解详细信息。

最后，看看您是否可以做更多的事情来将 SQL Server 隔离为问题。是否有任何其他应用程序在同一 SQL Server 上具有数据库，它们是否有问题？您是否在显示任何瓶颈的 SQL Server 或 SharePoint 服务器上运行性能监控？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T11:35:16.890

将生产数据库备份到 dev 并将其附加到您的 dev SharePoint 服务器。尝试创建一个站点。如果创建站点不需要永远，您可以假设 Prod 数据库存在问题。

尽管如此，在 100gig 上，您已经达到了内容数据库的极限，并且应该计划将内容放入多个数据库中。当您尝试备份数据库时，您就会知道为什么。现在搜索也应该开始花费很长时间。

从长远来看，您将不得不计划将您的网站拆分为不同的内容数据库。

**--回应--**

是的，数据库大小只是关于处理它的 SQL 服务器。100GB 只是“不止于此，它开始成为一种痛苦”的经验法则。完整搜索爬网也将开始一段时间。

鉴于您无权访问生产数据库并且创建子站点主要是数据库操作，因此您无法真正找出问题所在。

您可以在跟踪 Dev 数据库的同时尝试创建一个子站点，并查看这些命令引用的表以查看是否存在确凿证据，但如果没有生产访问权限，您确实会受到阻碍。

生产系统服务器页面和文档的速度是否合理？看看您是否可以在创建过程中开始从数据库中获取一些统计信息，找出正在完成的工作。SQL 现在有一些很棒的工具。

# asp.net - 为什么我的 onbeforeunload 以前没有运行？还是 AJAX 在第二个相同的命令上失败？

> ID：564676
> 
> 赞同：0
> 
> 时间：2009-02-19T10:33:10.913
> 
> 标签：asp.net, ajax, server-tags

这是从[这个](https://stackoverflow.com/questions/564549/how-can-i-stop-asp-net-encoding-in-get-params)问题开始的

这**是**有效的：

```
<body onbeforeunload=
 "ajaxRequest('UnlockQuery.ashx?QueryID=266&UserID=11631');"> 
```

这是在 aspx 页面中使用以下内容创建的：

```
<body onbeforeunload=
 "ajaxRequest('UnlockQuery.ashx?QueryID=<%= Session["QueryId"] %>&
 UserID=<%= Session["UserID"] %>')"> 
```

这**不起作用**：

```
<body id="uxBodyTag" onbeforeunload=
 "ajaxRequest('UnlockQuery.ashx?QueryID=266&amp;UserID=11631');"> 
```

这是使用以下方法创建的：

```
uxBodyTag.Attributes["onbeforeunload"] += 
 "ajaxRequest('UnlockQuery.ashx?QueryID=" + 
 queryId.ToString() + "&UserID=" + Session["UserID"].ToString() + "');"; 
```

被调用的代码是这样的：

```
function ajaxRequest(url)
{
    xmlhttp=null;
    if (window.XMLHttpRequest)
    {   // code for all new browsers
        xmlhttp=new XMLHttpRequest();
    }
    else if (window.ActiveXObject)
    {   // code for IE5 and IE6
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
    if (xmlhttp!=null)
    {
        xmlhttp.onreadystatechange=null;
        xmlhttp.open("GET",url,true);
        xmlhttp.send(null);
    }
} 
```

编辑：

它似乎仅在对同一解锁进行后续调用时才会失败。我认为这可能是一个 AJAX 问题....

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T11:10:45.817

对于调试的手段，我们尝试了：

```
alert(url);
xmlhttp.open("GET",url,true); 
```

这给出了预期的结果：

```
解锁Query.ashx?QueryID=319&UserID=11648

```

现在我们可以通过以下方式检查服务器必须说的内容：

```
xmlhttp.onreadystatechange = function() { 
  if (this.readyState == 4) alert(this.status + ": " + this.StatusText); 
}; 
```

编辑：

事实证明，浏览器缓存是导致意外结果的原因。我建议禁止通过适当的 HTTP 标头 ( `Pragma`, `Cache-Control`, `Expires`) 缓存 AJAX 页面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T11:21:06.167

添加

```
&date=DateTime.now.Ticks.ToString() 
```

似乎已经修复了它。我不认为 IE7 喜欢当相同的 AJAX 调用进入并且前一个尚未“解决”（页面在 AJAX 调用返回之前被处理）时。

感谢所有提供帮助的人。

# c# - 在c#中单击后禁用链接按钮

> ID：564678
> 
> 赞同：1
> 
> 时间：2009-02-19T10:33:17.670
> 
> 标签：c#, asp.net, user-interface

我想在单击它后禁用链接按钮并启用其他。使用 c# 在两个链接按钮之间切换启用/禁用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T10:44:08.360

订阅此按钮的 Click 事件并将 Enabled 属性设置为 true 或 false。

```
 void LinkButton_Click(Object sender, EventArgs e) 
  {
     // First enable all buttons
     btn1.Enabled = true;
     btn2.Enabled = true;

     // Then disable the clicked button
     (sender as Control).Enabled = false;

     ...
  } 
```

这只是您如何执行此操作的一个示例。可以优化...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T10:44:45.723

要禁用链接按钮，您应该将 false 分配给其[Enabled](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.webcontrol.enabled.aspx)属性：

```
button.Enabled = false; 
```

在链接的 MSDN 文章中还有一个如何挂钩 OnClick 事件的示例。

# .net - 什么是“第一次机会例外”？

> ID：564681
> 
> 赞同：116
> 
> 时间：2009-02-19T10:33:34.983
> 
> 标签：.net, visual-studio, debugging, exception, first-chance-exception

什么是第一次机会例外？它是如何以及从何处起源于 .NET 程序的？为什么用那个特殊的名字来称呼它（我们在谈论什么“机会”）？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-02-19T10:37:29.030

这是一个调试概念。*基本上异常首先*被抛出到调试器，然后到实际程序，如果它没有被处理，它会*第二*次被抛出到调试器，让你有*机会*在应用程序之前和之后在你的 IDE 中对它做一些事情本身。这似乎是 Microsoft Visual Studio 的一项发明。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-02-19T10:40:09.227

抛出异常时会引发第一次机会异常通知。第二次机会通知是当它没有被捕获时。（机会——有机会闯入调试器中的代码）。

[第一次和第二次机会异常处理](https://blogs.msdn.microsoft.com/davidklinems/2005/07/12/what-is-a-first-chance-exception/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-07-08T05:36:28.453

我刚开始使用调试器并遇到了这个问题。在我的研究中，我发现了 MSDN 博客文章*[什么是第一次机会异常？](https://docs.microsoft.com/en-us/archive/blogs/davidklinems/what-is-a-first-chance-exception)*这为我清除了它。

对我来说，这篇博文的最大收获是它指的是对调试器的通知，而不是我的代码必须处理的事情，最重要的是，

> “第一次机会异常消息通常并不意味着代码中存在问题。”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-31T13:38:12.417

调试应用程序时，只要遇到异常，调试器就会收到通知。此时，应用程序被挂起，调试器决定如何处理异常。第一次通过这种机制称为“第一次机会”异常。

根据调试器的配置，它要么恢复应用程序并传递异常，要么让应用程序暂停并进入调试模式。如果应用程序处理了异常，它会继续正常运行。

首次机会异常消息通常并不意味着代码中存在问题。对于优雅地处理异常的应用程序/组件，第一次机会异常消息让开发人员知道遇到并处理了异常情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-04-13T13:15:43.570

从开发人员的角度来看，它更多地涉及第二次机会异常，因为这意味着*它没有在代码中处理*；因此应用程序将停止。

第一次机会可能有很多，但是从开发的角度来看，需要更多关注的是第二次机会，因为它会导致应用程序崩溃。

# php - PHP 读取安全文件

> ID：564682
> 
> 赞同：4
> 
> 时间：2009-02-19T10:34:07.247
> 
> 标签：php, xml

我在子域 a 上有一个 xml 文件，在子域 b 上有一个 php 脚本。我想通过 PHP 读取和使用 XML 文件中的数据。

这就是问题所在。该文件使用 HTTP 身份验证进行保护。

如何让 PHP 登录并读取文件的内容？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T10:38:23.413

[url 包装器](http://us.php.net/manual/en/wrappers.http.php)支持表单的 URL，因此`http://USER:PASS@yourdomain.com/foo/bar`您可以简单地使用[file_get_contents](http://php.net/file_get_contents)。

或者，您可以使用[cURL](http://curl.haxx.se/)获取它，或者使用 curl 命令行，或者使用[curl 扩展名](http://php.net/curl)。如果做不到这一点，您可以使用 fsockopen 等手动对请求进行编码。[基本身份验证](http://en.wikipedia.org/wiki/Basic_access_authentication)被称为 Basic 是有原因的 - 它很容易实现：[这是手册中的一个用户提交的示例](http://php.net/manual/en/function.fsockopen.php#32830)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T12:25:25.217

除非您需要 cURL 的高级版本（现在 IMO 不太需要），否则您可以在读取 XML 文件的任何位置以“ [http://user:password@example.com ”开头文件名，它应该可以非常透明地工作。](http://user:password@example.com)它将使用阻塞连接，因此您的脚本将在等待响应时暂停。

```
$xdocument = simplexml_load_file('http://user:password@subdomain.example.com/thexmlfile.xml'); 
```

# browser - 我的密码如何从我的浏览器安全地传输到 Web 服务器？

> ID：564684
> 
> 赞同：5
> 
> 时间：2009-02-19T10:34:24.327
> 
> 标签：browser, encryption, cryptography, passwords

我输入的密码（例如 Gmail 登录表单）如何安全地传输到网络服务器？

*   浏览器或任何客户端应用程序是做什么的？
*   网络服务器是做什么的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T10:36:00.923

通过使用[SSL](http://en.wikipedia.org/wiki/Secure_Sockets_Layer)。

**编辑**
关于安全性和加密的一个很好的信息资源是现在的[安全性！](http://www.grc.com/securitynow.htm)Steve Gibson 和 Leo Laporte 的播客。史蒂夫可以非常透彻地解释安全性是如何工作的，所以去看看吧！

最新一集（#183）是关于**加密模式的**（[链接到 shownotes/podcast](http://www.grc.com/sn/sn-183.htm)）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T10:37:17.800

对于 GMail 或任何其他基于表单的身份验证，保护来自传输层。如果您通过 HTTP 发送表单，则基本上没有保护。如果您使用 SSL（您应该使用）发送表单，则保护来自 SSL。[您可以在http://en.wikipedia.org/wiki/Transport_Layer_Security](http://en.wikipedia.org/wiki/Transport_Layer_Security)阅读有关 SSL 的更多信息

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T10:51:03.897

这完全取决于它是 HTTPS 还是 HTTP 请求。通常，HTTP 身份验证请求以所谓的“等价明文”形式发送。它以 Base-64 编码，很容易反转，因此它基本上是纯文本 - 这意味着它不安全。

一些浏览器，如 Internet Explorer，有一些扩展允许将“安全”密码发送到能够理解并解码它们的服务器。这通常意味着 IIS 在域环境中运行。我将安全放在引号中，因为就像 Microsoft 所做的大多数事情一样，真正的安全性通常有待讨论。

如果您使用 HTTPS，密码仍然以相同的方式发送，但因为它通过安全传输，所以密码是否为明文并不重要，因为传输正在对其进行编码。

# python - 有没有办法在 Python 中更改有效的进程名称？

> ID：564695
> 
> 赞同：82
> 
> 时间：2009-02-19T10:37:12.247
> 
> 标签：python, process, arguments, hide, ps

我可以更改 Python 脚本的有效进程名称吗？当我获取系统进程列表时，我想显示一个不同的名称而不是进程的真实名称。在 CI 中可以设置

```
strcpy(argv[0],"othername"); 
```

但是在 Python 中

```
argv[0] = "othername" 
```

似乎不起作用。当我获得进程列表（`ps ax`在我的 linux 框中）时，真实名称不会改变。如果存在，我更喜欢便携式解决方案（或者一个用于 posix 的解决方案和另一个用于 Windows 环境的解决方案）。

提前致谢

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-12-08T12:40:46.683

我最近编写了一个 Python 模块来以可移植的方式更改进程标题：检查[https://github.com/dvarrazzo/py-setproctitle](https://github.com/dvarrazzo/py-setproctitle)

它是 PostgreSQL 用于执行标题更改的代码的包装器。它目前针对 Linux 和 Mac OS X 进行了测试：Windows（功能有限）和 BSD 移植正在进行中。

**编辑：**截至 2010 年 7 月，该模块适用于 BSD，在 Windows 上功能有限，并且已移植到 Python 3.x。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-05-28T20:39:05.810

实际上，您在 linux 上需要两件事：`argv[0]`从`C`（为`ps auxf`和朋友）修改并`prctl`使用`PR_SET_NAME`标志调用。

绝对没有办法从 python 本身做第一件。虽然，您可以通过调用 prctl 来更改进程名称。

```
def set_proc_name(newname):
    from ctypes import cdll, byref, create_string_buffer
    libc = cdll.LoadLibrary('libc.so.6')
    buff = create_string_buffer(len(newname)+1)
    buff.value = newname
    libc.prctl(15, byref(buff), 0, 0, 0)

def get_proc_name():
    from ctypes import cdll, byref, create_string_buffer
    libc = cdll.LoadLibrary('libc.so.6')
    buff = create_string_buffer(128)
    # 16 == PR_GET_NAME from <linux/prctl.h>
    libc.prctl(16, byref(buff), 0, 0, 0)
    return buff.value

import sys
# sys.argv[0] == 'python'

# outputs 'python'
get_proc_name()

set_proc_name('testing yeah')

# outputs 'testing yeah'
get_proc_name() 
```

`ps auxf`之后将只显示“python”:(。但是`top`会`ps -A`显示新的“正在测试”进程名称:)。也`killall`将`pkill`使用新名称。

顺便说一句，来自 googlecode 的 procname 也会更改`argv[0]`，因此，甚至会更改`ps auxf`输出。

**更新**：此答案中发布的解决方案有时在 FreeBSD 上效果不佳。我现在在各种 linux 和 freebsd 机器上使用[这个答案](https://stackoverflow.com/questions/564695/is-there-a-way-to-change-effective-process-name-in-python/1866700#1866700)中所述的[py-setproctitle](http://code.google.com/p/py-setproctitle/)一年左右。到目前为止没有失败！大家也应该！:)。[它使用的代码与](http://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/misc/ps_status.c;hb=HEAD)[PostgreSQL](http://www.postgresql.org)在其主数据库和子进程中使用的代码几乎相同。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2010-01-05T14:28:37.827

看看[setproctitle](http://code.google.com/p/py-setproctitle/)包

这是一个相当便携的版本，适用于许多平台。

```
pip install setproctitle 
```

```
import setproctitle

setproctitle.setproctitle('new proc title as seen in top') 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-19T12:26:14.997

简而言之，没有便携的方式。您必须测试系统并使用该系统的首选方法。

此外，我对 Windows 上的进程名称的含义感到困惑。

你的意思是服务名称吗？我想是这样，因为没有其他东西真正有意义（至少对于我的非 Windows 使用大脑而言）。

如果是这样，您需要使用[Tim Golden 的 WMI 接口](http://timgolden.me.uk/python/wmi)并调用服务上的 .Change 方法......至少根据他的[教程](http://timgolden.me.uk/python/wmi/tutorial.html)。

对于 Linux，除了这个为您设置 argv[0] 的[包装不佳的模块外，我发现没有任何方法有效。](http://code.google.com/p/procname/)

我什至不知道这是否适用于 BSD 变体（它确实有一个 setproctitle 系统调用）。我很确定 argv[0] 不会在 Solaris 上工作。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-19T11:31:25.517

首先，我不确定`argv[0]`C 程序中的简单设置是否可移植地更改`ps`. 也许它在某些unixen中确实如此，但我的理解是它并不期望如此。

其次，由于 Windows 特别不兼容 POSIX，因此在 POSIX 和非 POSIX 之间只有少数东西是“可移植的”。由于您特别说“ps”，我假设 POSIX 是您的优先事项，Windows 可能无法正常工作。

更重要的是，我对改变的理解`argv[0]`是，它需要调用来`exec`进行这些改变。具体来说，`exec`调用既有可执行文件的路径，也有单独的`argv`列表。进行自己的调用可以打破将可执行文件名称放入`argv[0]`.

您拥有[操作系统库进程管理](http://docs.python.org/library/os.html#process-management)，可让您直接访问操作系统库以执行此操作。您应该考虑将您的脚本分成两部分——启动器和“实际工作”。启动器建立运行时环境，并使用所需参数执行实际工作。

在 C 中，您正在用另一个进程替换您自己的进程。在 Python 中，您将使用具有不同 argv[0] 的新解释器替换旧的 Python 解释器。希望它不会因此而犹豫。一些程序检查 argv[0] 来决定他们在做什么。

您还可以使用[subprocess.popen](http://docs.python.org/library/subprocess.html#subprocess.Popen)设置所需的参数和可执行文件。但是，在这种情况下，父进程应该在子进程完成时逗留以收集子进程。父母可能没有做更多的事情`Popen.wait`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-11-25T09:12:35.097

[我对标记为重复](https://stackoverflow.com/questions/2255444/changing-the-process-name-of-a-python-script/25338292#25338292)的类似问题的回答：

有更简单的（你不需要导入任何库）但可能不是那么优雅的方式。您必须不要在 shebang 行内使用“env”。

换句话说，这将在进程列表中命名为“python”：

```
#!/usr/bin/env python 
```

但这将以您的脚本名称命名：

```
#!/usr/bin/python 
```

所以你可以用类似的东西找到`pidof -x scriptname`它`ps -C scriptname`

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-02-07T15:45:35.020

我发现[python-prctl](http://packages.python.org/python-prctl/ "python-prctl")在 Linux 下工作得很好。您将不得不为 Windows 找到其他东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-07-24T09:43:47.980

如果你只需要支持 Linux 并且只需要更改进程名称，那么你可以简单地将其写入`/proc/self/comm`.

例子：

```
import os
import subprocess

print(subprocess.run(['pidof', 'foo'], stdout=subprocess.PIPE,
        universal_newlines=True))
print(subprocess.check_output(['ps', 'p', str(os.getpid()), '-o', 'pid,comm,cmd'],
        universal_newlines=True))

with open(f'/proc/self/comm', 'w') as f:
    f.write('foo')

print(subprocess.check_output(['pidof', 'foo'], universal_newlines=True))
print(subprocess.check_output(['ps', 'p', str(os.getpid()), '-o', 'pid,comm,cmd'],
    universal_newlines=True)) 
```

输出：

```
$ python3 test.py argone argtwo
CompletedProcess(args=['pidof', 'foo'], returncode=1, stdout='')
    PID COMMAND         CMD
2881003 python3 test.py python3 test.py argone argtwo

2881003

    PID COMMAND         CMD
2881003 foo             python3 test.py argone argtwo 
```

* * *

注意：在 Linux 上，在 C 程序中，写入 to`argv[0]`只是更改参数in`/proc/self/cmdline`而**不是**`/proc/self/comm`. 因此，它不会影响COMMAND 列、`pidof`COMMAND列、plain等。`top``ps``pgrep`

* * *

[setproctitle](https://pypi.org/project/setproctitle/)包支持多个平台，并且 - 在 Linux 上 - 更改命令和参数向量。但是，它是 C 扩展。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2021-11-25T16:04:24.823

Windows 上的一个超级 hack 是复制 python.exe，将其重命名为 process_name.exe，使用重命名的 python 调用您的脚本。

它是一个超级 hacky，但由于 Windows 上没有简单的解决方案，如果一个人只需要快速完成它以便一个脚本能够监控它，它是一个公平的选择。

从理论上讲，它甚至可以编写脚本……超级骗子黑客！？

* * *

## 回答 #10

> 赞同：-21
> 
> 时间：2009-02-19T10:39:53.130

```
In [1]: import sys

In [2]: print sys.argv[0]
C:\Python25\scripts\ipython.py

In [3]: sys.argv[0] = 'foo'

In [4]: print sys.argv[0]
foo 
```

注意单个“=”符号

# java - Java/C# 中的声明顺序是否重要？

> ID：564699
> 
> 赞同：5
> 
> 时间：2009-02-19T10:37:50.607
> 
> 标签：java, c#

在 C++ 中，如果我在调用方法之后声明它，我就不能使用它。

这个顺序在 Java 或 C# 等其他语言中是否重要？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-19T11:02:41.920

方法的声明顺序在 C# 或 Java 中无关紧要。同样，无论您是在它使用的变量之前还是之后声明方法都没有关系。

然而，变量的声明顺序*可能*很重要，当它们被初始化时，一个依赖于另一个。例如（C#）：

```
using System;

class Test
{
    static int x = 5;
    static int y = x;

    static void Main()
    {
        // Prints x=5 y=5
        Console.WriteLine("x={0} y={1}", x, y);
    }
} 
```

但：

```
using System;

class Test
{
    static int y = x;
    static int x = 5;

    static void Main()
    {
        // Prints x=5 y=0
        Console.WriteLine("x={0} y={1}", x, y);
    }
} 
```

Java 阻止了这种*确切的*情况，但很容易模仿：

```
public class Test
{
    static int y = getInitialValue();
    static int x = 5;

    public static void main(String args[])
    {
        System.out.println("x=" + x + " y=" + y);
    }

    static int getInitialValue()
    {
        return x;
    }
} 
```

在 C# 中，当您涉及部分类时，事情变得更加混乱。初始化在 C# 中以文本顺序发生，但当您有多个文件贡献于同一个类时，该顺序未完全定义。

不用说，尽可能避免这种情况！

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-02-19T10:41:06.543

不 。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-09-22T08:39:43.983

不，编译器执行两次传递。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T10:43:22.700

在 Java 和 c# 中，没有单独的方法声明。

方法的声明是通过它的实现来完成的。您**也不需要跟踪**文件包含，这样只要类在同一个命名空间中，它们就可以相互了解。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-22T08:38:34.797

对于 Java，权威答案隐藏在 Java 语言规范（“JLS”，第 3 版，可在线免费查看）的第 1 章（简介）中：

> 声明顺序仅对局部变量、局部类以及类或接口中字段的初始值设定项的顺序很重要。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T10:39:19.353

我不确定c#，但在java中你可以。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T10:42:50.407

它不在 C# 中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T10:43:08.957

C# 和 Java 都没有。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-09T14:33:01.040

在某些极端情况下，方法/构造函数的顺序在 Java 中确实很重要：

```
class Callee {
    private static void bar(int i) { } // compilation error if first
    public static void bar(String s) { } // ok if this method is first
}

class Caller {
    private void foo() { Callee.bar(bar()); }
    private <T> T bar() { return null; }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-09-22T08:46:36.937

有一种棘手的情况，可以在调用点之后在词法上声明要调用的函数，但不能在语义上声明。这是因为类被认为完全定义在类成员函数的主体中。

> $9.2.2 - “在类说明符的结束 } 处，类被认为是完全定义的对象类型（3.9）（或完整类型）。在类成员规范中，类在函数体中被认为是完整的， “

```
struct A{
    void f(){g();}    // OK to call 'g' even if the compiler has not seen 'g' as yet
    void g(){};
};

int main(){
    A a;
    a.f();
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-19T10:52:01.120

该变量应该可以在使用它的方法中访问。在使用之前或之后声明它都没有关系。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-12-07T22:19:42.353

这些答案相互矛盾，使事情难以理解。最佳实践是以常识的时间顺序声明您的方法、变量等，以免混淆，这适用于所有编程语言。您的 main 将始终是第一个，因此可以在开头或结尾，但是，您仍然应该从 main 开始，并且当您在 main 中调用方法时，它应该是 main 之后的下一个方法，依此类推。至少对我来说，这是最有意义的，并使代码最易读（注释也很有帮助，因为让我们面对现实吧，代码真的很乱）。我不是编码专家，但我知道任何算法的最佳实践都是根据需要将其分解为尽可能多的简单步骤（请提供评论）。这没有意义：

```
 final List<int[]> intArrays = Arrays.stream(testarray).collect(Collectors.toList());
   final List<Integer> integers = intArrays.stream().flatMap(z -> 
                  Arrays.stream(z).boxed()).collect(Collectors.toList());

unless you add comments like:
final List<int[]> intArrays = Arrays.stream(testarray).collect(Collectors.toList());
// this makes a List (of ints) variable type that cannot be changed based on the stream of 
//(the testarray in this case) and uses the Collector method to add the ints
//to intArrays (our variable name)
final List<Integer> integers = intArrays.stream().flatMap(z -> 
                  Arrays.stream(z).boxed()).collect(Collectors.toList());
// I would have to look this up, because I honestly have no clue what it does exactly. 
```

就像我说的，代码基本上是乱码。无论您使用哪种语言，都可以帮助您自己和其他可能查看您的代码并按逻辑顺序编写代码的人。（同样，请使用评论！稍后你会感谢我的。）

# c++ - Java 程序员 - C++ 人如何使用类？指向类的指针，默认参数？

> ID：564703
> 
> 赞同：7
> 
> 时间：2009-02-19T10:38:34.893
> 
> 标签：c++, pointers, constructor

我知道面向对象编程的方式，但我习惯了 Java，直到最近我才接触过 C++。

我认为我的问题与语法无关，而是与 C++ 中的 OOP 哲学有关。我了解指针和地址以及堆栈和堆之间的区别，以及其他东西，但我仍然觉得我错过了一些东西。

这是一个示例：我有一个包含一些数据的类（Shape）。我有另一个使用多个形状的类（应用程序）。

```
class Square {
    private: 
        int x;
        int y;
        int size;

    public:
        /* constructor */
        Square(int x, int y, int size);
}

class App {
    private:
        Square redSquare;
        Square blueSquare;

    public:
        void setup();
        void draw();
} 
```

在某些时候，某些东西会实例化我的应用程序并调用 setup()。问题是，当我声明 App 类（例如在 App.hpp 中）时，“redSquare”和“blueSquare”会被实例化，而不仅仅是声明。作为一名 Java 程序员，在本例中，我将在 setup() 中实例化我的类。但这意味着我不能像上面那样做，我必须将 redSquare 和 blueSquare 设置为 POINTERS，然后我可以使用 setup() 中的 new 创建它们。

但你会这样做吗？或者你会用默认参数创建一个构造函数，像上面一样创建 redSquare 和 blueSquare，然后在 App.setup() 中设置这些正方形的值，使用类似 Square.init(x, y, size) 之类的东西？还是其他方式？

你曾经聚合类，还是只聚合指针？

我当然可以以一种或另一种方式破解它，这样它自己就可以工作，但我有一种感觉，我正在以“Java 方式”做事，而不是了解 C++ 程序员的想法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T14:38:47.110

在我看来，问题来自“setup()”方法的存在。IIUC，其目的是将 App 用作：

```
App a;
a.setup(); 
```

在调用 setup() 之前，“a”处于什么状态？如果调用 draw() 会发生什么？如果答案是“必须先调用 setup() 才能对 App 对象进行任何操作”，那么这意味着 setup() 是 App 的“真正”构造函数，并且 App 的当前 ctor 没有意义。结论：删除“setup()”方法并用有意义的ctor替换它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T10:42:30.283

您需要在 App 构造函数中指定构造函数的参数，例如

```
App(int bx, int by, bsize, int rx, int ry, int rsize) : 
blueSquare(bx, by, bsize), redSquare(rx, ry, rsize) {} 
```

这只是一个示例，您可能会使用更好的设计 IRL。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T10:44:58.343

给 app 一个构造函数：

```
App :: App() 
    : redSquare( 10, 20, 100 ), blueSquare( 50, 500, 25 ) {
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T11:35:36.443

首先，如果在 setup() 之前调用 draw()，您需要选择您希望 App 类的行为方式：

1.  如果你想默认有一些预定义的方块，那么在 App 初始化列表中初始化它们。

2.  如果您不希望这种情况发生，请使用指针并防止这种情况发生。

关于2的一些注释：

*   你在 C/C++ 中没有垃圾收集器，你必须“删除”你“新”的东西
*   您可以使用[“智能指针”来拥有 RAII](https://stackoverflow.com/questions/395123/raii-and-smart-pointers-in-c)（资源分配即初始化），这将使内存管理更简单
*   您可能应该使用[Null 设计模式](http://en.wikipedia.org/wiki/Null_Object_pattern)来避免许多“if (redSquare == NULL)”块。
*   在任何情况下，将 App 初始化列表中的**指针**初始化为 NULL 或 null 方形对象。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T10:59:15.110

Square 类有一个带有 3 个参数的构造函数。App 类没有定义构造函数——这意味着编译器将提供一个默认构造函数（不带任何参数的构造函数）。在类的默认构造函数中，所有成员变量都由默认构造函数初始化。由于您的 Square 类没有默认构造函数，因此您的代码将无法编译。

构造函数应该使用其成员变量的默认值初始化一个类实例。如果您需要更改这些变量中的任何一个，那么您可以定义一些 getter 和 setter：

```
class Square {
    private: 
        int x;
        int y;
        int size;

    public:
        /* constructor */
        Square(int x, int y, int size);

        int getX() const {return x;}
        int getY() const {return y;}
        int getSize() const {return size;}

        void setX(int nx) {x = nx;}
        void setY(int ny) {y = ny;}
        void setSize(int s) {size = s;}
} 
```

然后调用这些函数来改变 Square 的内部变量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T11:22:44.163

我会使用 Square * 而不是 Square 作为 App 的私有成员。这样可以节省内存，App 中 Square 对象的构建可以延迟到任何需要的时候，或者它们可以在 App 的构造函数中完成，默认或其他方式。当然，如果两个 Square 对象被创建，析构函数应该销毁它们。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T11:35:25.693

您应该使用指针而不是实际对象。

使用指针将使您的类的行为类似于 Java（它将迫使您在“设置”方法或构造函数上显式实例化它）。在 Java 中，每个对象都是一个引用（类似于 {但不等于} 指针），并且没有与您使用 C++ 完成的等效项：

```
class A {
   B b;
} 
```

希望能帮助到你。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T14:53:07.153

为什么要使用 setup/init 函数？改用构造函数，初始化对象是构造函数存在的*理由*。可能处于不可用状态的对象是 PItA，它们需要每个函数来测试我们是否可以对它们做任何好事。加强它们的不变量并禁止它们的存在，直到你能够完全构建它们。

即使在 Java 中，init/setup 函数在我看来也是一种有问题的做法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-03T02:24:47.357

如果您的*setup()*确实没有参数并且没有返回任何值，那么将该功能放在构造函数中（*我假设您只是为了简洁而忽略了这些*）。

拥有一个必须在构造函数之后调用的*setup()函数并不是***最好**的，但是当在构造函数中抛出异常不是一种选择时，它可能是完全有效的。您的*setup()*函数可以以更灵活的方式处理问题。

但是：不要让构造函数让对象处于以后会导致问题的状态，特别是：

*   初始化**所有指针**成员变量！！一般来说，您应该将所有内容设置为一些有意义的默认值。至少要有一个保护位来确定*setup()*是否已经完成并处理它可能会咬你的*每一种*情况。
*   *在需要调用setup()*的每个函数中，确保它已经调用它，或者然后调用它。
*   当然，释放析构函数中的所有分配！

换句话说：成员变量的初始化就像在婆婆来访之前打扫你的房子——要么立即做，要么设置一个警卫，让你在需要之前做。

哦，不要浪费太多时间试图避免 C++ 中的指针，但一定要确保你学会了如何避免这些陷阱。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-03T02:55:59.137

没有 C++ish 方法可以做到这一点。

C++方式是：

> 做你想做的，我会给你尽可能多的绳索。
> 见鬼！你甚至可以用它上吊，我不会阻止你的！

您可以使用指针，但您必须注意内存泄漏！你必须定义谁（在哪个类/对象中）拥有这个对象，谁拥有删除它的专有权！

或者，您可以插入一个垃圾收集器（我听说有一些流行的，但我自己从未尝试过），然后像在 java 中一样使用指针。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-19T11:26:51.393

要么使用指针，要么让 App 构造函数采用上面建议的参数。

```
(in App.h)
Square* redSquare;
Square* blueSquare;
void setup(int,int,int,int);
...

(in App.cpp)
void App::setup(int x1,int y1,int x2,int y2){
    redSquare=new Square(x1,y1);
    blueSquare=new Square(x2,y2);   // don't forget to "delete" these later
    ...
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-19T11:47:27.303

我会让代码说话。**警告：未经测试的代码！**

```
/**
    Typically we will use Shape as a base class.
    This defines the interface that clients of the
    Shape class can expect and use reliably. Of
    course, some shapes can be dough-nuts and have 
    a eat() method, but that's just them dough-nuts.
*/
class Shape
{
public:
    /**
        The base class's default ctor.
        The compiler generates one if you don't specify any ctors,
        but if you specify at least one, this is skipped, so we 
        to mention it explicitly
    */
    Shape(void) {} 
    Shape(const std::string& c) { std::cout << c.length() << std::endl; } /* print the color */
    ~Shape(void) {}

    /**
        The interface. The '=0' makes it virtual. This class
        has now become abstract. Subclasses MUST define this
        member function.
    */
    virtual size_t area() = 0 { return 0; }
};

/**
    The more interesting objects, real world shapes.
    They have their own version of implementing an
    algorithm to find out area.
*/
class Circle : public Shape
{
public:
    Circle(const std::string& color) /* no default parameters */
         /* the base class's default ctor is called automagically */
        :_color(color) /* the user must specify the color */        
    {}
    ~Circle(void) {}

    virtual size_t area() /* = 0 */ /*we dont want this to be abstract! */
            { return 42; }

private:
    std::string _color;
};

class Triangle: public Shape
{
public:
    Triangle(const std::string& color = "red") 
        Shape(color)/* this base class ctor has to be called by you */
        : _color(color) /* use initializer lists to populate ctor parameters */
    {}
    ~Triangle(void) {}

    virtual size_t area() { return 42 + sizeof Triangle; }
private:
    std::string _color;
};

/**
    We will also use design patterns. And an oft-abused 
    one -- the Singleton. We want only one app to run after
    all.
*/
class App {
public:
    /**
        This would typically be in a differnt '.cpp' file.
    */
    int Run() {
        /* create a few shapes */
        Triangle t1;
        Circle c1; // error -- no default parameter
        Circle c2("green");

        /* You want to sum the areas of all these objects */
        size_t total_area = t1.area() + c2.area();

        /* Now, how do you process different shapes in one go? */
        /* Put them in a container for base class pointers */
        std::list<Shape *> shape_list;
        shape_list.insert(&t1); 
        shape_list.insert(&c2);

        /* process them -- calculate total area differently */
        size_t total_area2 = 0;
        std::list<Shape *>::iterator f = shape_list.end();
        for (std::list<Shape *>::iterator i = shape_list.begin();
            i != f;
            ++i) {
            total_area2 += i->area(); 
            /* see why we need virtual functions? */
        }

        /* or use the STL to the hilt and do */
        size_t total_area3 = std::accumulate(shape_list.begin(), shape_list.end(), 
            0, 
            std::bind2nd(std::plus<size_t>(std::mem_fun(&Shape::area))));

    }
private:
    App();
    App(const App&);
    App& operator(const App&);
};

/* the program entry-point, you have to have one, and only one */
int main() {
    App.Run();
} 
```

# wpf - 如何让 MessageBox.Show() 在我的 WPF 应用程序中间弹出？

> ID：564710
> 
> 赞同：29
> 
> 时间：2009-02-19T10:39:57.513
> 
> 标签：wpf

我有一个 700w x 300h WPF 应用程序，可以将它拖到我的大屏幕上的任何位置。

当我的应用程序执行时：

```
MessageBox.Show("Sorry, this function is not yet implemented."); 
```

消息框出现在我的*屏幕*中间，它可能靠近应用程序本身，也可能不靠近应用程序本身。

我怎样才能让我的 MessageBox 出现在我的*应用程序*中间？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2013-08-28T14:54:24.707

这是另一个使用 WPF 样式消息框的线程中发布的 MessageBoxEx 帮助器类的版本（请注意，您仍然需要引用 System.Drawing）：

```
using System;
using System.Text;
using System.Runtime.InteropServices;
using System.Windows;
using System.Windows.Interop;
using System.Drawing;

public class MessageBoxEx
{
    private static IntPtr _owner;
    private static HookProc _hookProc;
    private static IntPtr _hHook;

    public static MessageBoxResult Show(string text)
    {
        Initialize();
        return MessageBox.Show(text);
    }

    public static MessageBoxResult Show(string text, string caption)
    {
        Initialize();
        return MessageBox.Show(text, caption);
    }

    public static MessageBoxResult Show(string text, string caption, MessageBoxButton buttons)
    {
        Initialize();
        return MessageBox.Show(text, caption, buttons);
    }

    public static MessageBoxResult Show(string text, string caption, MessageBoxButton buttons, MessageBoxImage icon)
    {
        Initialize();
        return MessageBox.Show(text, caption, buttons, icon);
    }

    public static MessageBoxResult Show(string text, string caption, MessageBoxButton buttons, MessageBoxImage icon, MessageBoxResult defResult)
    {
        Initialize();
        return MessageBox.Show(text, caption, buttons, icon, defResult);
    }

    public static MessageBoxResult Show(string text, string caption, MessageBoxButton buttons, MessageBoxImage icon, MessageBoxResult defResult, MessageBoxOptions options)
    {
        Initialize();            
        return MessageBox.Show(text, caption, buttons, icon, defResult, options);
    }

    public static MessageBoxResult Show(Window owner, string text)
    {
        _owner = new WindowInteropHelper(owner).Handle;
        Initialize();
        return MessageBox.Show(owner, text);
    }

    public static MessageBoxResult Show(Window owner, string text, string caption)
    {
        _owner = new WindowInteropHelper(owner).Handle;
        Initialize();
        return MessageBox.Show(owner, text, caption);
    }

    public static MessageBoxResult Show(Window owner, string text, string caption, MessageBoxButton buttons)
    {
        _owner = new WindowInteropHelper(owner).Handle;
        Initialize();
        return MessageBox.Show(owner, text, caption, buttons);
    }

    public static MessageBoxResult Show(Window owner, string text, string caption, MessageBoxButton buttons, MessageBoxImage icon)
    {
        _owner = new WindowInteropHelper(owner).Handle;
        Initialize();
        return MessageBox.Show(owner, text, caption, buttons, icon);
    }

    public static MessageBoxResult Show(Window owner, string text, string caption, MessageBoxButton buttons, MessageBoxImage icon, MessageBoxResult defResult)
    {
        _owner = new WindowInteropHelper(owner).Handle;
        Initialize();
        return MessageBox.Show(owner, text, caption, buttons, icon, defResult);
    }

    public static MessageBoxResult Show(Window owner, string text, string caption, MessageBoxButton buttons, MessageBoxImage icon, MessageBoxResult defResult, MessageBoxOptions options)
    {
        _owner = new WindowInteropHelper(owner).Handle;
        Initialize();
        return MessageBox.Show(owner, text, caption, buttons, icon,
                                defResult, options);
    }

    public delegate IntPtr HookProc(int nCode, IntPtr wParam, IntPtr lParam);

    public delegate void TimerProc(IntPtr hWnd, uint uMsg, UIntPtr nIDEvent, uint dwTime);

    public const int WH_CALLWNDPROCRET = 12;

    public enum CbtHookAction : int
    {
        HCBT_MOVESIZE = 0,
        HCBT_MINMAX = 1,
        HCBT_QS = 2,
        HCBT_CREATEWND = 3,
        HCBT_DESTROYWND = 4,
        HCBT_ACTIVATE = 5,
        HCBT_CLICKSKIPPED = 6,
        HCBT_KEYSKIPPED = 7,
        HCBT_SYSCOMMAND = 8,
        HCBT_SETFOCUS = 9
    }

    [DllImport("user32.dll")]
    private static extern bool GetWindowRect(IntPtr hWnd, ref Rectangle lpRect);

    [DllImport("user32.dll")]
    private static extern int MoveWindow(IntPtr hWnd, int X, int Y, int nWidth, int nHeight, bool bRepaint);

    [DllImport("User32.dll")]
    public static extern UIntPtr SetTimer(IntPtr hWnd, UIntPtr nIDEvent, uint uElapse, TimerProc lpTimerFunc);

    [DllImport("User32.dll")]
    public static extern IntPtr SendMessage(IntPtr hWnd, int Msg, IntPtr wParam, IntPtr lParam);

    [DllImport("user32.dll")]
    public static extern IntPtr SetWindowsHookEx(int idHook, HookProc lpfn, IntPtr hInstance, int threadId);

    [DllImport("user32.dll")]
    public static extern int UnhookWindowsHookEx(IntPtr idHook);

    [DllImport("user32.dll")]
    public static extern IntPtr CallNextHookEx(IntPtr idHook, int nCode, IntPtr wParam, IntPtr lParam);

    [DllImport("user32.dll")]
    public static extern int GetWindowTextLength(IntPtr hWnd);

    [DllImport("user32.dll")]
    public static extern int GetWindowText(IntPtr hWnd, StringBuilder text, int maxLength);

    [DllImport("user32.dll")]
    public static extern int EndDialog(IntPtr hDlg, IntPtr nResult);

    [StructLayout(LayoutKind.Sequential)]
    public struct CWPRETSTRUCT
    {
        public IntPtr lResult;
        public IntPtr lParam;
        public IntPtr wParam;
        public uint message;
        public IntPtr hwnd;
    } ;

    static MessageBoxEx()
    {
        _hookProc = new HookProc(MessageBoxHookProc);
        _hHook = IntPtr.Zero;
    }

    private static void Initialize()
    {
        if (_hHook != IntPtr.Zero)
        {
            throw new NotSupportedException("multiple calls are not supported");
        }

        if (_owner != null)
        {
            _hHook = SetWindowsHookEx(WH_CALLWNDPROCRET, _hookProc, IntPtr.Zero, AppDomain.GetCurrentThreadId());
        }
    }

    private static IntPtr MessageBoxHookProc(int nCode, IntPtr wParam, IntPtr lParam)
    {
        if (nCode < 0)
        {
            return CallNextHookEx(_hHook, nCode, wParam, lParam);
        }

        CWPRETSTRUCT msg = (CWPRETSTRUCT)Marshal.PtrToStructure(lParam, typeof(CWPRETSTRUCT));
        IntPtr hook = _hHook;

        if (msg.message == (int)CbtHookAction.HCBT_ACTIVATE)
        {
            try
            {
                CenterWindow(msg.hwnd);
            }
            finally
            {
                UnhookWindowsHookEx(_hHook);
                _hHook = IntPtr.Zero;
            }
        }

        return CallNextHookEx(hook, nCode, wParam, lParam);
    }

    private static void CenterWindow(IntPtr hChildWnd)
    {
        Rectangle recChild = new Rectangle(0, 0, 0, 0);
        bool success = GetWindowRect(hChildWnd, ref recChild);

        int width = recChild.Width - recChild.X;
        int height = recChild.Height - recChild.Y;

        Rectangle recParent = new Rectangle(0, 0, 0, 0);
        success = GetWindowRect(_owner, ref recParent);

        System.Drawing.Point ptCenter = new System.Drawing.Point(0, 0);
        ptCenter.X = recParent.X + ((recParent.Width - recParent.X) / 2);
        ptCenter.Y = recParent.Y + ((recParent.Height - recParent.Y) / 2);

        System.Drawing.Point ptStart = new System.Drawing.Point(0, 0);
        ptStart.X = (ptCenter.X - (width / 2));
        ptStart.Y = (ptCenter.Y - (height / 2));

        ptStart.X = (ptStart.X < 0) ? 0 : ptStart.X;
        ptStart.Y = (ptStart.Y < 0) ? 0 : ptStart.Y;

        int result = MoveWindow(hChildWnd, ptStart.X, ptStart.Y, width,
                                height, false);
    }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-06-13T17:38:19.837

此处已[针对 Windows.Forms 回答了此问题，](https://stackoverflow.com/a/3498791/353147)但在您的课程中添加了以下内容，您可以让它在 WPF 中工作。

您必须添加对`System.Windows.Forms`&的引用才能`System.Drawing`使上面的类工作并执行以下操作。

```
public partial class YourWPFWindow : Window, System.Windows.Forms.IWin32Window
{
    public IntPtr Handle
    {
        get { return new WindowInteropHelper(this).Handle; }
    }
} 
```

然后您可以使用以下方法调用 MessageBoxEx：

```
MessageBoxEx.Show(this, "Message"); 
```

它应该显示在窗口的中间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-03-10T14:09:24.540

另一种方法是创建自己的消息框窗口并将窗口的启动位置设置为中心所有者。优点是您可以轻松拥有自己的样式和自定义，而无需挂钩。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-01-03T14:17:53.137

除了[弗拉姆克的回答](https://stackoverflow.com/a/18491385/512728)

此部分不适用于多个屏幕

```
ptStart.X = (ptStart.X < 0) ? 0 : ptStart.X;
ptStart.Y = (ptStart.Y < 0) ? 0 : ptStart.Y; 
```

这是一个快速修复：

```
var allScreens = System.Windows.Forms.Screen.AllScreens;
ptStart.X = allScreens.All(a => a.WorkingArea.Left > ptStart.X) ? allScreens.Min(a => a.WorkingArea.Left) : ptStart.X;
ptStart.X = allScreens.All(a => a.WorkingArea.Right - width < ptStart.X) ? allScreens.Max(a => a.WorkingArea.Right) - width : ptStart.X;
ptStart.Y = allScreens.All(a => a.WorkingArea.Top > ptStart.Y) ? allScreens.Min(a => a.WorkingArea.Top) : ptStart.Y;
ptStart.Y = allScreens.All(a => a.WorkingArea.Bottom - height < ptStart.Y) ? allScreens.Max(a => a.WorkingArea.Bottom) - height : ptStart.Y; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-04-30T15:29:52.790

如果您愿意使用外部库，一个选项是 Xceed WPF Toolkit，它有一个可以正确居中的 MessageBox。它通常也与 WPF 非常一致，例如，它可以从 XAML 样式化。

[https://github.com/xceedsoftware/wpftoolkit/wiki/MessageBox](https://github.com/xceedsoftware/wpftoolkit/wiki/MessageBox)

> **用法**
> 
> MessageBox 密切模仿 System.Windows.MessageBox 的行为。您使用类似的语法来创建和显示消息框。
> 
> ```
> MessageBoxResult result =  Xceed.Wpf.Toolkit.MessageBox.Show("Hello world!", "Extended WPF ToolKit MessageBox", MessageBoxButton.OK, MessageBoxImage.Question);
> 
> MessageBoxResult result =  Xceed.Wpf.Toolkit.MessageBox.Show("Hello world!", "Extended WPF ToolKit MessageBox", MessageBoxButton.OK);
> 
> MessageBoxResult result =  Xceed.Wpf.Toolkit.MessageBox.Show("Hello world!", "Extended WPF ToolKit MessageBox");
> 
> MessageBoxResult result =  Xceed.Wpf.Toolkit.MessageBox.Show("Hello world!"); 
> ```

以父窗口为中心似乎是自动的。

* * *

## 回答 #6

> 赞同：-8
> 
> 时间：2009-02-20T11:44:55.883

如果您的应用程序有多个窗口，您可能需要使用`Application.Current.MainWindow`：

```
MessageBox.Show(Application.Current.MainWindow, "Can't login with given names.", "Login Failure", MessageBoxButton.OK, MessageBoxImage.Error, MessageBoxResult.Cancel); 
```

# amazon-ec2 - 如何在 Amazon EC2 中创建数据库

> ID：564716
> 
> 赞同：4
> 
> 时间：2009-02-19T10:40:30.443
> 
> 标签：amazon-ec2

我已经在 Ec2 中创建了一个帐户，但是我不明白如何在 ec2 服务器中上传文件，如何创建用于传输文件的 ftp 帐户以及如何在 ec2 中创建 MySQL 数据库。

如果有人知道，请与我分享。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T11:36:36.487

由于您拥有 Amazon 和 EC2 的帐户，因此您可以使用他们的控制台：[https](http://aws.amazon.com/ebs/) ://console.aws.amazon.com/ec2/home 。

在控制台中，单击**Instances**，然后单击**Launch Instance**以创建新的虚拟机。有很多操作系统可供选择；第一个实例的一个不错的选择是在一个`m1.small`实例上运行 32 位 Ubuntu。

如果您已有密钥对，请从列表中选择您想要的密钥对。否则，您可以在**Keypair**对话框中创建一个新的 Keypair。创建新实例后，您可以使用密钥对连接到它，使用如下命令：

```
ssh -i siva_keypair root@InstancePublicDNS 
```

您可以从控制台获取实例公有 DNS 名称。此时，您基本上已登录到一台新机器，并且可以以任何您可以使用真实物理机器的方式使用它。

听上去，你会想要创建一些用户帐户，安装一个 FTP 服务器和 MySQL（`apt-get`如果你在 Ubuntu 上使用）。

请注意，如果实例出现故障，您*可能*会丢失放在本地磁盘上的数据 - 如果您正在运行数据库，您应该使用非常容易设置的[EBS](http://aws.amazon.com/ebs/)，并为您提供持久、快速的存储，可以附加到任何 EC2 实例。

# sql - 衡量查询性能：“执行计划查询成本”与“所用时间”

> ID：564717
> 
> 赞同：53
> 
> 时间：2009-02-19T10:40:48.570
> 
> 标签：sql, sql-server, sql-server-2005, optimization, sql-execution-plan

我正在尝试确定两个不同查询的相对性能，并有两种方法可供我使用：
1\. 运行两者并为每个查询计时
2\. 运行两者并从实际执行计划中获取“查询成本”

这是我为查询计时而运行的代码...

```
DBCC FREEPROCCACHE
GO
DBCC DROPCLEANBUFFERS
GO
DECLARE @start DATETIME SET @start = getDate()
EXEC test_1a
SELECT getDate() - @start AS Execution_Time
GO

DBCC FREEPROCCACHE
GO
DBCC DROPCLEANBUFFERS
GO
DECLARE @start DATETIME SET @start = getDate()
EXEC test_1b
SELECT getDate() - @start AS Execution_Time
GO 
```

我得到的是以下内容：

```
Stored_Proc     Execution_Time     Query Cost (Relative To Batch)

test_1a         1.673 seconds      17%
test_1b         1.033 seconds      83% 
```

执行时间的结果直接与查询成本的结果相矛盾，但我很难确定“查询成本”的实际含义。我最好的猜测是它是 Reads/Writes/CPU_Time/etc 的集合，所以我想我有几个问题：

1.  是否有明确的来源来解释该措施的含义？

2.  人们还使用哪些其他“查询性能”指标，它们的相对优点是什么？

需要注意的是，这是一个中型 SQL Server，在 MS Server 2003 Enterprise Edition 上运行 MS SQL Server 2005，具有多个处理器和 100 多个并发用户。

编辑：

经过一番麻烦后，我设法获得了对该 SQL Server 的 Profiler 访问权限，并且可以提供额外的信息（它支持与系统资源相关的查询成本，而不是执行时间本身......）

```
Stored_Proc    CPU      Reads    Writes   Duration   

test_1a        1313     3975     93       1386
test_1b        2297     49839    93       1207 
```

令人印象深刻的是，使用更多的 CPU 和更多的读取需要更少的时间 :)

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-19T13:05:15.807

探查器跟踪将其置于透视图中。

*   查询 A：1.3 秒 CPU，1.4 秒持续时间
*   查询 B：2.3 秒 CPU，1.2 秒持续时间

查询 B 使用并行：CPU > 持续时间 例如查询使用 2 个 CPU，平均每个 1.15 秒

查询 A 可能不是：CPU < 持续时间

这解释了相对于批处理的成本：更简单的非并行查询计划的成本为 17%。

优化器计算出查询 B 更昂贵，并且将从并行性中受益，即使这样做需要额外的努力。

但请记住，查询 B 使用 100% 的 2 个 CPU（所以 50% 用于 4 个 CPU）一秒钟左右。查询 A 使用 100% 的单个 CPU 1.5 秒。

查询 A 的峰值较低，但会增加持续时间。一个用户，谁在乎？有100个，也许会有所不同...

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-03-07T05:41:53.370

```
SET STATISTICS TIME ON

SELECT * 

FROM Production.ProductCostHistory
WHERE StandardCost < 500.00;

SET STATISTICS TIME OFF; 
```

并查看消息选项卡，它将如下所示：

```
SQL Server Execution Times:

   CPU time = 0 ms,  elapsed time = 10 ms.

(778 row(s) affected)

SQL Server parse and compile time: 

   CPU time = 0 ms, elapsed time = 0 ms. 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-19T10:51:06.067

> 执行时间的结果直接与查询成本的结果相矛盾，但我很难确定“查询成本”的实际含义。

`Query cost`是优化器认为您的查询需要多长时间（相对于总批处理时间）。

优化器尝试通过查看您的查询和数据统计信息来选择最佳查询计划，尝试多个执行计划并选择成本最低的执行计划。

[**在这里**](http://technet.microsoft.com/ru-ru/library/cc966419(en-us).aspx)，您可以更详细地了解它是如何尝试做到这一点的。

如您所见，这可能与您实际获得的结果有很大不同。

当然，唯一真正的查询性能指标是查询实际需要多长时间。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-08-16T11:00:51.540

采用`SET STATISTICS TIME ON`

在您的查询之上。

在附近的结果选项卡下方，您可以看到一个消息选项卡。在那里你可以看到时间。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-09-24T06:34:44.037

**查询执行时间：**

```
DECLARE @EndTime datetime
DECLARE @StartTime datetime 
SELECT @StartTime=GETDATE() 

` -- Write Your Query`

SELECT @EndTime=GETDATE()
--This will return execution time of your query
SELECT DATEDIFF(MILLISECOND,@StartTime,@EndTime) AS [Duration in millisecs] 
```

查询输出将如下所示：

![在此处输入图像描述](https://i.stack.imgur.com/AZCnx.png)

**优化查询成本：**

单击您的 SQL 管理工作室

![在此处输入图像描述](https://i.stack.imgur.com/hYqD2.png)

运行查询并单击查询结果的消息选项卡旁边的执行计划。你会看到像

![在此处输入图像描述](https://i.stack.imgur.com/nPT1m.png)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-03-02T21:12:43.090

我知道这是一个老问题——但是我想添加一个成本相同但一个查询比另一个查询更好的示例。

正如您在问题中所观察到的，执行计划中显示的百分比并不是确定最佳查询的唯一标准。在以下示例中，我有两个查询执行相同的任务。执行计划显示两者都一样好（各 50%）。现在我执行了`SET STATISTICS IO ON`显示明显差异的查询。

在以下示例中，查询 1 使用`seek`，而查询 2 使用`scan`表 LWManifestOrderLineItems。然而，当我们实际检查执行时间时，会发现查询 2 效果更好。

另请阅读[什么时候寻找不是寻找？](http://sqlblog.com/blogs/paul_white/archive/2011/02/16/when-is-a-seek-not-a-seek.aspx)保罗·怀特

**询问**

```
---Preparation---------------
-----------------------------
DBCC FREEPROCCACHE
GO
DBCC DROPCLEANBUFFERS
GO

SET STATISTICS IO ON  --IO
SET STATISTICS TIME ON

--------Queries---------------
------------------------------

SELECT LW.Manifest,LW.OrderID,COUNT(DISTINCT LineItemID)
FROM LWManifestOrderLineItems LW
INNER JOIN ManifestContainers MC
    ON MC.Manifest = LW.Manifest
GROUP BY LW.Manifest,LW.OrderID
ORDER BY COUNT(DISTINCT LineItemID) DESC  

SELECT LW.Manifest,LW.OrderID,COUNT( LineItemID) LineCount
FROM LWManifestOrderLineItems LW
WHERE LW.Manifest IN (SELECT Manifest FROM ManifestContainers)
GROUP BY LW.Manifest,LW.OrderID
ORDER BY COUNT( LineItemID) DESC 
```

**统计 IO**

[![在此处输入图像描述](https://i.stack.imgur.com/3WvsE.png)](https://i.stack.imgur.com/3WvsE.png)

**执行计划**

[![在此处输入图像描述](https://i.stack.imgur.com/cesIO.jpg)](https://i.stack.imgur.com/cesIO.jpg)

# code-freeze - 未完成时冻结代码

> ID：564720
> 
> 赞同：4
> 
> 时间：2009-02-19T10:41:21.410
> 
> 标签：code-freeze

我正在从事一个已经运行了很长时间的项目，我们即将发布该产品的最终版本。

目前的测试工作发现系统中还存在大约 30 个缺陷，但是我们没有时间修复所有这些缺陷（我敢肯定这是一种非常常见的情况）。

我已经与不同的人讨论过代码冻结是否应该继续进行。目前我的经理希望保持代码冻结，但是要修复冻结和发布之间的窗口中剩余的关键缺陷（大约 5 周）。我担心这不是实际的代码冻结，而是充其量是代码“糊涂”。这些缺陷将由一个高级工程师团队进行分类，以确保实际解决剩余问题中的关键修复，但是从最初的外观来看，关键问题似乎占未解决缺陷总数的三分之二左右。

我知道代码冻结会给开发人员带来某些心理上的好处，例如为所有工作提供固定的结束日期。然而，这似乎完全被我的经理完全否定了，他公开讨论了将在“冻结”之后进行的修复。

我想知道是否有其他人有过类似的经历，或者可以就处理这种情况的最佳方法向我提供一些建议。我开始认为没有人会在他们说要去的那一天冻结他们的代码库。

我们计划在代码冻结日从 subversion 的主干分支，以确保产品的最终发布版本与开发主干隔离，所以我不太担心所做的更改会影响发布版本的问题的产品。

谢谢，

艾多斯

编辑：我想解释我的经理想法的最好方法是它不是真正的代码冻结，更多的是“功能冻结”，但是由于所有功能已经在产品中已有一段时间了，我认为这是一个严重的过度简化。

EDIT2：我要感谢大家的出色回答，不幸的是，我只能将其中一个标记为有帮助，尽管到目前为止所有 7 个答案都非常有帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T10:46:37.870

这是一个平衡的行为。

一方面，有一个代码冻结期很好，但另一方面，如果您发布的产品具有足够大的关键问题以使您的客户离开，这对您没有任何利益。

如果问题足够严重，如果它是我的产品，任何代码冻结都不会阻止我修复它们。

祝你好运！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T11:12:08.090

我认为实际的代码冻结是不可能的。通常当发生代码冻结时，会进行更密集的测试。然后呢？发现的所有问题都是下个版本的文档？如果您发现问题严重到关键功能无法工作怎么办？

您必须有一种方法来处理每个问题/错误，因为大多数优秀的开发人员都很懒惰（意见），分支\标记和强制开发人员将他们的更改合并或复制到 2 个地方将阻止他们中的大多数人尝试进行并非 100% 必要的更改。

从那时起，您需要处理每个出现的错误/问题。它们每个都必须根据以下因素进行加权：问题是什么，问题的影响，距离最终发布重新测试还有多少天。每个问题的成本效益比。只有这样，才能做出明智的决定。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T10:50:57.703

在这种情况下我能想到的事情是避免出现问题，

```
If bug not fixed
   you will be in trouble;

if codefreeze === true
   fix your local version;
   update the dev version on SVN;

goto manager;
state the severity of the bugs;
follow her direction because she already got a plan; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T11:02:13.497

代码冻结通常意味着所有**当前已知的**错误都不会得到修复。（希望不言而喻，没有添加新功能）。如果在冻结期间发现错误，它们会添加新信息，并且根据分类视图，可能需要暂时“解冻”代码以修复错误。希望在代码冻结期间所做的更改得到非常仔细的审查。

据估计，三分之一的错误修复会引入随机严重性的新错误。代码冻结让您有时间将未知错误（严重程度可变）“转换”为已知严重程度的已知错误。

真正的“代码冻结”没有任何改变是没有意义的——如果你发现了一个重大错误怎么办？你不能忽视它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T10:48:33.827

在我们的例子中，当我们开始 alpha 时（主分支保持休眠一段时间），我们正在分支，当我们决定修复缺陷时，我们在第一次客户发货之前编码冻结（不再提交）。

过去，我曾在一家公司工作，其中代码冻结实际上意味着功能冻结（不再添加功能）和分支。然后，我们正在处理缺陷。

我不会将您描述的称为代码冻结，而是将其称为打包分支的创建，您可以在其中消除细节并准备发布代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T10:50:02.560

AFAIK“代码冻结”实际上，毫不客气地表示“新代码冻结”。这样做的目的是为了调试的稳定性，错误修复不包含在冻结中，因为它们不是新代码，而是对旧代码的修复。

*当您真正*的意思是放弃代码时，我们更喜欢术语“向下工具” 。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T11:43:39.043

您的冻结真的是代码冻结还是功能冻结？你的问题不是100％清楚。

话虽如此，我同意上述关于分支和合并的评论。这允许您和您的开发人员使用该分支来修复您知道的错误以及未来几周内将出现的错误。然后，它允许您以受控方式将已修复的任何关键错误集成回主（冻结）行。

通过这种方式，您可以希望在不引入太多新缺陷的情况下解决最严重的问题。集成和回归测试在这里很重要。

# c - 类型转换，擅长 C 的人的简单问题

> ID：564722
> 
> 赞同：1
> 
> 时间：2009-02-19T10:41:44.747
> 
> 标签：c, pointers, casting

我有一个库，我必须将 (char **)&return_string 传递给函数 hci_scan，如以下摘录所示：

```
char return_string[250];
int num_hosts;

if ((num_hosts = hci_scan((char **) & return_string, 0x03)) > 0) {
    //case where one or more devices are found...
} else {
    //case where zero devices are found...
} 
```

执行后，return_string 中有什么？（到目前为止，我得到的只是内存地址）

谢谢你的帮助

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T10:43:22.323

for 的文档`hci_scan`应该准确地告诉您它会产生什么，但我的猜测是它将是一个字符串，其内存是从内部分配的`hci_scan`。您真的不需要定义`return_string`为数组；`char *return_string;`应该也能正常工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T10:51:29.403

如果 hci_scan*修改*了传递给它的值，就像使用 (char**) 似乎暗示的那样，那么您的代码是非法的，因为您不允许更改数组的地址。我怀疑 hci_scan 想要分配内存，所以你想要这样的东西：

```
char * buf;
hci_scan( & buf );   // allocates string & points buff to it 
```

但是您确实需要阅读 hci_scan 文档以确保。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T11:01:30.940

投射`char (*) []`到是错误的`char **`。考虑以下代码：

```
char foo[42];
assert((void *)foo == (void *)&foo); // this will pass! 
```

`&foo`是类型`char (*) [42]`并引用数组的内存位置，它`(char *)foo`与`&foo[0]`指向的位置相同！

这表示

```
char ** p = (char **)&foo; 
```

是相同的

```
char ** p = (char **)foo; 
```

这通常不是程序员想要做的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T11:33:26.807

```
char return_string[250];
int num_hosts;

if ((num_hosts = hci_scan((char **) & return_string, 0x03)) > 0) {
    //case where one or more devices are found...
} else {
    //case where zero devices are found...
} 
```

嗯，hci_scan() 的签名是什么？我的意思是它返回什么？即使您无权访问 hci_scan() 定义，您仍然可以拥有签名，假设它是第三方 api 的一部分。

看起来 hci_scan() 需要一个指向指针的指针，以便它可以分配自己的内存并返回指针。如果确实如此，您可以这样做

```
char * return_string; /* No memory allocation for string */
int num_hosts;

if ((num_hosts = hci_scan(&return_string, 0x03)) > 0) { /* get back pointer to allocated memory */
    //case where one or more devices are found...
} else {
    //case where zero devices are found...
} 
```

但话又说回来，这取决于 hci_scan 试图做什么。

# file-format - CorelDraw 文件格式

> ID：564725
> 
> 赞同：4
> 
> 时间：2009-02-19T10:43:05.820
> 
> 标签：file-format, coreldraw

是否有关于 CorelDraw CDR 文件使用的文件格式的任何文档\代码？

我基本上对以简单的方式以编程方式操作 coreldraw 文件感兴趣，而无需打开实际程序。我知道该应用程序支持在 VBA 中编写脚本或类似的东西，但我更希望能够操作文件而无需启动 CorelDraw。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T11:01:19.210

这是 coreldraw.com 的一个[论坛讨论](http://coreldraw.com/forums/t/2922.aspx)，建议改用 CMX。似乎没有可用的 CDR 规范，但您可以为 CMX 获取它们。

另一种选择是尝试一些转换器并转换为更好的文档格式（但是您必须查看转换时信息是否丢失）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T11:47:57.130

您可以使用[SVG](http://www.w3.org/Graphics/SVG/)格式而不是 CorelDraw 的 CDR。SVG 规范是开放的，并且是基于 XML 的，甚至可以使用文本编辑器进行编辑。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2018-06-19T19:34:50.240

***启动coreldraw****所需的***.cdr** 使用的文件格式。您可以将文件类型更改为**dwg**或**dxf**尝试使用此格式文件

 ******# c# - 允许双击标题栏以最大化对话框但没有最大最小按钮

> ID：564742
> 
> 赞同：1
> 
> 时间：2009-02-19T10:48:27.773
> 
> 标签：c#, .net, winforms

这有点 C# 特有的。可调整大小对话框的默认行为是单击标题栏最大化对话框，第二次双击恢复大小。但是，我想要的是打开帮助按钮，这意味着最小化和最大化按钮被隐藏，但我仍然希望标题栏双击行为。这可能通过一些子类化来实现，但也许有人对此有一些好主意。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T11:06:04.003

您应该能够处理 WM_NCHITTEST 并查找 HT_CAPTION，有关详细信息，请参阅*[WM_NCHITTEST 消息](http://msdn.microsoft.com/en-us/library/ms645618(VS.85).aspx)*。

您需要重写 WndProc 才能处理这些消息，这在*[Control.WndProc Method](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.wndproc(VS.71).aspx)*中进行了演示。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T12:03:50.353

```
 private const int WM_NCLBUTTONDBLCLK = 0xA3;

    protected override void WndProc(ref Message m)
    {
        switch (m.Msg)
        {
            case WM_NCLBUTTONDBLCLK:
                if (this.WindowState==System.Windows.Forms.FormWindowState.Maximized)
                    this.WindowState=System.Windows.Forms.FormWindowState.Normal;
                else if (this.WindowState == System.Windows.Forms.FormWindowState.Normal)
                    this.WindowState = System.Windows.Forms.FormWindowState.Maximized;
                return;
        }
        base.WndProc(ref m);
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-09T15:28:16.653

```
 private const int WM_NCHITTEST = 0x0084;

    // Let Windows drag this form for us
    protected override void WndProc(ref Message m)
    {
        switch (m.Msg)
        {
            case WM_NCHITTEST:
                m.Result = (IntPtr)2;   // HTCLIENT
                return;
        }

        base.WndProc(ref m);
    } 
```

# iis - IIS w3wp 进程挂起 og 阻止访问网站

> ID：564754
> 
> 赞同：0
> 
> 时间：2009-02-19T10:52:53.317
> 
> 标签：iis

每天晚上，我的 IIS 都会在任务管理器列表中挂起 3 个 w3wp.exe 进程。使用最多内存无法杀死 w3wp 任务。甚至 iisreset 都没有帮助。我必须重新启动机器才能摆脱 w3wp 进程。

有什么建议么？

![http://img530.imageshack.us/img530/7417/taskmanagerw3wpjn4.jpg](https://i.stack.imgur.com/NB1MH.jpg)

补充：我已将默认应用程序池的最大内存减少到 120，但进程仍然超过 200mb。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T09:47:53.703

我没有找到解决问题的永久解决方案，但是当我从我的 vps 中删除一些网站并减少默认应用程序池允许的最大内存时，情况有所改善。我还删除了在其自己的 appPool 下运行的管理网站。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T13:26:59.557

在应用程序池中，设置内存使用限制，这将重新启动应用程序。当它使用太多内存时。可能有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-21T02:18:56.720

从屏幕截图中，我看不到 CPU 使用率高或内存使用量大等问题。

您可以了解如何使用调试诊断来捕获挂起转储，然后使用调试诊断分析转储。它的报告应该为您提供一些提示。

[http://www.microsoft.com/downloadS/details.aspx?FamilyID=28bd5941-c458-46f1-b24d-f60151d875a3&displaylang=en](http://www.microsoft.com/downloadS/details.aspx?FamilyID=28bd5941-c458-46f1-b24d-f60151d875a3&displaylang=en)

如果您自己无法做到这一点，我建议您联系我们的 Microsoft 支持团队。

# sql-server - SQL Server 文本类型与 varchar 数据类型

> ID：564755
> 
> 赞同：300
> 
> 时间：2009-02-19T10:53:42.113
> 
> 标签：sql-server, text, varchar, sqldatatypes

我有可变长度的字符数据并希望存储在 SQL Server (2005) 数据库中。我想学习一些关于如何选择 TEXT SQL 类型或选择 VARCHAR SQL 类型的最佳实践，以及性能/足迹/功能方面的优缺点。

* * *

## 回答 #1

> 赞同：292
> 
> 时间：2009-02-19T11:07:59.037

`TEXT`用于大块字符串数据。如果字段的长度超过某个阈值，则文本存储在行外。

`VARCHAR`始终存储在行中，并且限制为*8000 个*字符。如果您尝试创建 a `VARCHAR(x)`，其中*x > 8000*，则会出现错误：

> 服务器：消息 131，级别 15，状态 3，第 1 行
> 
> 赋予类型 'varchar' 的大小 () 超过任何数据类型允许的最大值 (8000)

这些长度限制`VARCHAR(MAX)`在*SQL Server 2005*中不涉及，它可能存储在行外，就像`TEXT`.

请注意，`MAX`这里不是一种常量，`VARCHAR`而是`VARCHAR(MAX)`非常不同的类型，后者非常接近`TEXT`.

在*SQL Server*的早期版本中，您无法`TEXT`直接访问，您只能获取 a并在和函数`TEXTPTR`中使用它。`READTEXT``WRITETEXT`

在*SQL Server 2005*中，您可以直接访问`TEXT`列（尽管您仍然需要显式强制转换`VARCHAR`来为它们分配值）。

`TEXT`很好：

*   如果您需要在数据库中存储大文本
*   如果您不搜索列的值
*   如果您很少选择此列并且不加入它。

`VARCHAR`很好：

*   如果你存储小字符串
*   如果您搜索字符串值
*   如果您总是选择它或在连接中使用它。

通过*选择*此处，我的意思是发出任何返回列值的查询。

通过在这里*搜索*，我的意思是发出任何查询，其结果取决于`TEXT`or`VARCHAR`列的值。这包括在任何情况下使用`JOIN`它`WHERE`。

由于`TEXT`存储在行外，不涉及`TEXT`列的查询通常更快。

`TEXT`有什么好处的一些例子：

*   博客评论
*   维基页面
*   代码源

`VARCHAR`有什么好处的一些例子：

*   用户名
*   页面标题
*   文件名

根据经验，如果您需要超过*200 个*字符的文本值**并且**不要在此列上使用连接，请使用`TEXT`.

否则使用`VARCHAR`.

*PS*这同样适用于`UNICODE`enabled`NTEXT`和`NVARCHAR`，您应该在上面的示例中使用它。

*PPS*这同样适用于*SQL Server 2005+*使用`VARCHAR(MAX)`and`NVARCHAR(MAX)`而不是and 。如果您希望它们始终存储在行外，则需要为它们启用。*`TEXT``NTEXT``large value types out of row``sp_tableoption`*

 *如上所述和[**这里**](http://technet.microsoft.com/en-us/library/ms189087.aspx)，`TEXT`将在未来的版本中被弃用：

> 该`text in row`选项将在*SQL Server*的未来版本中删除。避免在新的开发工作中使用此选项，并计划修改当前使用`text in row`. 我们建议您使用 、 或 数据类型来存储`varchar(max)`大`nvarchar(max)`数据`varbinary(max)`。要控制这些数据类型的行内和行外行为，请使用该`large value types out of row`选项。

* * *

## 回答 #2

> 赞同：228
> 
> 时间：2009-02-19T11:13:03.783

如果您使用的是 SQL Server 2005 或更高版本，请使用`varchar(MAX)`. 该`text`数据类型已弃用，不应用于新的开发工作。从[文档](http://msdn.microsoft.com/en-us/library/ms187993.aspx)：

> ### 重要的
> 
> **`ntext`**、**`text`**和**`image`**数据类型将在 Microsoft SQL Server 的未来版本中删除。避免在新的开发工作中使用这些数据类型，并计划修改当前使用它们的应用程序。请改用[nvarchar(max)](http://msdn.microsoft.com/en-us/library/ms186939.aspx)、[varchar(max)](http://msdn.microsoft.com/en-us/library/ms176089.aspx)和[varbinary(max)](http://msdn.microsoft.com/en-us/library/ms188362.aspx)。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2009-02-19T11:18:48.403

在 SQL Server 2005 中引入了新的数据类型：`varchar(max)`和`nvarchar(max)` 它们具有旧文本类型的优点：它们可以包含 2GB 的数据，但它们也具有 和 的大部分`varchar`优点`nvarchar`。这些优势之一是能够使用字符串操作函数，例如 substring()。

此外，varchar(max) 存储在表的（磁盘/内存）空间中，而大小低于 8Kb。只有当您在字段中放置更多数据时，它才会存储在表空间之外。存储在表空间中的数据（通常）检索得更快。

简而言之，永远不要使用 Text，因为有更好的选择：(n)varchar(max)。并且仅在常规 varchar 不够大时使用 varchar(max)，即如果您希望要存储的字符串将超过 8000 个字符。

如前所述，您可以在 TEXT 数据类型上使用 SUBSTRING，但前提是 TEXT 字段包含少于 8000 个字符。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-06-25T15:14:19.490

ms 2008 发生了一些重大变化 -> 在决定使用哪种数据类型时可能值得考虑以下文章。 [http://msdn.microsoft.com/en-us/library/ms143432.aspx](http://msdn.microsoft.com/en-us/library/ms143432.aspx)

每字节数

1.  varchar(max)、varbinary(max)、xml、文本或图像列 2^31-1 2^31-1
2.  nvarchar(max) 列 2^30-1 2^30-1

# java - 如何将所有控制台输出重定向到 GUI 文本框？

> ID：564759
> 
> 赞同：11
> 
> 时间：2009-02-19T10:55:33.123
> 
> 标签：java, eclipse, user-interface

我目前有一个程序，它以各种方式将文本行打印到屏幕上，例如“System.out.println()”语句，并将数组中的所有元素循环打印到屏幕上。

我现在正在向这个程序添加一个 GUI。我的问题是我想将打印到 Eclipse 控制台的所有内容打印到我的 GUI 中的文本框。这可能吗？如果可以，我将如何去做。

提前致谢。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-19T11:06:50.803

查看这篇名为[Redirecting System.out and System.err to JTextPane or JTextArea 的](http://unserializableone.blogspot.com/2009/01/redirecting-systemout-and-systemerr-to.html)博客文章。它描述了您需要的几乎所有内容。

基本思想是您创建自己的专用输出流。在`write()`方法的实现中，您调用一些代码将新数据附加到您的文本框中。然后，您`System.out`通过调用`System.setOut()`或将此新输出流设置为您的`System.setErr()`。

**注意：那篇文章缺少一件事。您需要[在单独的线程中启动您的程序](https://stackoverflow.com/a/20938818/495796)。**

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T11:03:10.810

一个主意：

创建您自己的 PrintStream，将所有内容输出到此文本框。然后将这个新的 PrintStream 设置为[标准输出](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/System.html#setOut(java.io.PrintStream))流，如下所示：

```
System.setOut(myPrintStream()); 
```

# php - 这种方法是否足够好/安全，可以向用户显示错误？- PHP

> ID：564761
> 
> 赞同：2
> 
> 时间：2009-02-19T10:56:05.540
> 
> 标签：php, error-handling, http-referer

我正在开发一个网站，由于用户输入或其他原因，我需要显示一些错误消息。为此，我有一个名为*error.php*的页面，并使用 $_GET 获取错误号。所有错误消息都存储在一个数组中。

例子：

```
header( 'Location: error.php?n=11' ); 
```

但我不希望用户在 URL 中输入错误代码并查看所有其他错误消息。为了防止这种情况，我认为我可以将引用页面列入白名单，并且仅在我的白名单中找到引用者时才显示错误消息。

它应该与此类似（尚未测试；））

```
$accept = false;
$allowedReferer = array (0=>'page1.php', 'page2.php');
if (in_array($_SERVER['HTTP_REFERER'], $allowedReferer )) {$accept = true;}
if ($accept) { $n=$_GET['n'];echo "Error: " . $errorList[$n];} 
```

这种方法是否足以避免*间谍用户*？

我用 PHP5 做这个

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-19T10:58:23.817

不，它不是远程安全的：`HTTP` `Referer`标头很容易被欺骗，也不是必需的标头。我建议您阅读[这篇文章](http://www.mustap.com/phpzone_post_62_how-to-bypass-the-referer-se)以获取利用代码（用 PHP 编写）的示例，或者下载[这个](http://refspoof.mozdev.org/)用于 Firefox 的附加组件，以便在您自己的浏览器中舒适地进行操作。

此外，您的`$allowedReferer`数组应该包含**完整**的 URL，而不仅仅是脚本名称，否则代码也将可以从远程引用中被利用，例如来自

```
http://www.example.org/page1.php 
```

总而言之：您不能在不要求身份验证的情况下限制对任何*公共*网络资源的访问。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T11:17:36.423

而不是重定向，您可以简单地“就地”显示错误 - 例如像调整您当前的代码一样简单的东西

```
if ($error_condition)
{
    $_GET['n']=11;
    include "/path/to/error.php";
    exit;
} 
```

在实践中它可能会更复杂一点，但想法是一样的——用户会看到一条错误消息而无需重定向。确保输出某种错误标头，例如 header("HTTP/1.0 401 Bad Request") 以告诉浏览器它并没有真正看到请求的页面。

如果您确实想重定向，那么您可以通过包含错误编号的哈希值和只有您的代码知道的盐来创建“防篡改”URL，例如

```
$n=11;
$secret="foobar";
$hash=md5($n.$secret);
$url="http://{$_SERVER['HTTP_HOST']}/error.php?n={$n}&hash={$hash}"; 
```

现在您的 error.php 可以检查是否正确创建了提供的哈希。如果是，那么它很可能是由您的代码而不是用户创建的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T11:06:39.960

您不应该使用外部重定向来访问错误页面。我的 PHP 结构是这样的：

我有一个包含在每个页面中的通用文件，具有通用功能：处理登录/注销、设置常量等。有一个 error() 函数，您可以将错误信息传递给它将显示错误页面并退出。另一种方法是使用 index.php?include=pagename.php 习惯用法来实现通用功能，但我发现这更加不稳定且容易出错。

如果您从外部重定向客户端（有时显然需要这样做），则永远不要依赖通过该机制传递的信息。像所有用户输入一样，它本质上是不可信的，应该非常谨慎地进行清理和处理。也不要使用 cookie（同样的问题）。如果您需要在请求之间保留信息，请使用会话。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T11:00:47.697

`HTTP_REFERER`那些有足够激励措施的人可以轻而易举地欺骗（`telnet`是那里选择的工具），并且不应该被信任。

无论如何，错误消息都不应该透露任何关键信息，因此我建议您将错误消息设计为可以显示给任何人的方式。

那，或者使用随机哈希来识别错误（而不是`11`，使用`98d1ud109j2`等），这些错误将存储在某个关联数组的中心位置：

```
$errors[A_VERY_FATAL_ERROR] => "308dj10ijd"
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T11:38:32.863

为什么不只包含错误消息脚本？为了摆脱以前的输出数据，使用[输出控件](http://docs.php.net/manual/en/book.outcontrol.php)缓冲它并在错误时清除它：

```
if ($error) {
    ob_clear();
    $errorCode = 11;
    include 'error.php';
    exit;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T11:09:27.973

为什么不包含错误页面，而不是重定向到错误页面。您可以使用 .htaccess 限制对包含包含错误内容的 php 文件的目录的访问：

```
RedirectMatch 404 ^error-pages/*$ 
```

在错误页面中，您可以拥有显示错误的可包含页面。

使用这种方法，您可以确保没有人可以直接访问错误页面目录中的页面，但您仍然可以将它们包含在可公开访问的脚本中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T11:30:55.253

如果您在发送标头之前处理错误，您可以轻松地创建一个输出带有内容的基本 html 页面的函数，并在它之后立即退出。这样就不需要任何其他页面（我猜除了功能页面）。

就像检查是否有问题一样简单，如果有问题，只需调用该函数。

我使用这样的函数，它甚至在被调用时会写入数据，所以我有自己的错误日志......

# c# - 选择 winforms treevew 项目时的水平滚动位置

> ID：564773
> 
> 赞同：1
> 
> 时间：2009-02-19T10:59:26.093
> 
> 标签：c#, .net, winforms, user-interface, treeview

我们有一些使用 .net Windows.Forms.TreeView 的代码。When an item in the view is selected then code does

```
treeView.BeginUpdate();
// ... some stuff ...
SendMessage(treeView.Handle, WM_HSCROLL, SB_LEFT, 0);
treeView.EndUpdate(); 
```

这是为了使树视图显示不会向右滚动（这是默认行为 - 我假设尽可能多地显示所选项目标签，但以隐藏一些树结构为代价）。不幸的是，当树视图包含 30,000 个项目并且在右键单击期间调用此代码并导致上下文菜单需要几秒钟才能出现时（足以令人不安）。

如果您删除 Begin/EndUpdate，则上下文菜单会立即出现，但是当您看到视图向右移动然后返回左边缘时，您会感到烦人的抽搐。摆脱“将其推回左边缘”滚动条的建议遇到了一些阻力。

我已经尝试在树视图上过滤掉 SB_RIGHT ，但是当控件移动以显示标签时，这似乎并没有真正用于。

So is there a way of keeping the tree view in at it's current horizo​​ntal scroll position when the item is selected that doesn't involve Begin/EndUpdate and the corresponding lag or the twitch?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-26T04:58:24.837

您是否尝试过仅“按需”填充树的节点？

这将导致树中的节点更少，因此 BeginUpdate 的处理速度更快。

# javascript - 用户关闭 IE 时显示消息框

> ID：564778
> 
> 赞同：3
> 
> 时间：2009-02-19T11:00:58.833
> 
> 标签：javascript, internet-explorer, events

当用户关闭 IE 时，是否有任何 javascript 提示消息框？我试图找到一个代码示例已经有一段时间了，但失败了。

提前谢谢，乔治

这是我的 html 代码，但它有以下错误。有任何想法吗？

为了帮助保护您的安全，Internet Explorer 已限制此网页运行可能访问您计算机的脚本或 ActiveX 控件。单击此处查看选项...

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T11:03:54.133

**您正在寻找[`beforeunload`](http://msdn.microsoft.com/en-us/library/ms536907(VS.85).aspx)事件。**

例如：

```
function someCloseEvent() {
  return "Any string value here forces a dialog box to \n" +
         "appear before closing the window.";
}

window.onbeforeunload = someCloseEvent; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T11:13:34.077

还是 onUnload？-> [http://www.w3schools.com/jsref/jsref_onunload.asp](http://www.w3schools.com/jsref/jsref_onunload.asp)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T11:20:17.727

您也会在刷新期间收到卸载消息。最好在 beforeunload 中检查 clientx 和 clientY。这是伪代码...

```
<script type="text/javascript">

    var myclose = false;

    function ConfirmClose()
    {
        if (event.clientY < 0)
        {
            event.returnValue = 'Any message you want';

            setTimeout('myclose=false',100);
            myclose=true;
        }
    }

    function HandleOnClose()
    {
        if (myclose==true) alert("Window is closed");
    }
</script> onbeforeunload="ConfirmClose()" onunload="HandleOnClose()" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T13:56:35.310

在旁注中，我会认真考虑您是否要这样做。当我关闭窗口时，我已经完成了您的网站，我不想再收到您的任何消息。弹出一个额外的窗口会惹恼很多人。

# bash - 如何将此路径传递给 bash 函数？

> ID：564785
> 
> 赞同：0
> 
> 时间：2009-02-19T11:01:56.180
> 
> 标签：bash, cygwin

我一直无法移动到名称中有空格的目录，但我只是认为这是 Cygwin 的问题并解决了它。

然后我发现我可以创建指向那些目录的符号链接，这让我可能认为它不是 Cygwin。然后我记得我为它创建了一个别名，`cd`它会列出目录内容并看到了这个：

```
cdls { cd $1; ls; }
alias cd='cdls' 
```

所以问题是当我尝试这个时它失败了：

```
$ cd /cygdrive/c/Program\ Files/
bash: cd: /cygdrive/c/Program: No such file or directory 
```

我可以看到空间导致路径被拆分为多个参数，但我如何再次将它们连接在一起？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T11:04:59.560

引用它：

```
cdls { cd "$1"; ls; } 
```

在 bash 中引用可能会变得很麻烦，因为有多个级别的解释，但通常只是稍微玩一下而已。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T11:05:16.860

尝试：

```
cdls() { cd "$1"; ls; } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T11:05:24.987

看起来我只需要解释问题就可以得到答案。我的解决方案是：

```
cdls () { cd "$*"; ls ; }
alias cd='cdls' 
```

简单的。

# java - 可排序的类表 Java 类

> ID：564807
> 
> 赞同：2
> 
> 时间：2009-02-19T11:07:13.500
> 
> 标签：java, sorting

有谁知道 Java 中有一个具有元素列表的类，以便元素可以按任何元素成员排序？这个想法基本上是有一些类似数据库表的实现，您可以在其中添加字段以进行排序。为了显示：

```
SomeTable table = new SomeTable();
table.addField("name", String);
table.addField("age", int);
table.addField("hair color", String);
table.add(new Object[]{"Thomas", 32, "brown"});
table.add(new Object[]{"Jack", 34, "black"}); 
```

`table.sort("age")`将对表格进行排序，使 Thomas 成为第一个元素，同时`table.sort("name")`对表格进行排序，使 Jack 成为第一个元素。

我可以自己编写这样的代码（实际上我曾经做过一次），但我只是想看看是否有现成的库可以做这些事情（没有数据库）。

PS：我知道那`int`不是一门课，但这不是重点。这个示例代码只是为了展示我期望的那种功能。

* * *

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T11:20:53.093

您必须考虑`Collection.sort()`功能，与`Comparator`接口。[这里](http://mindprod.com/jgloss/sort.html#EXAMPLE)有一个很好的例子

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T11:25:56.247

我自己能想到的最接近的东西是 Apache Commons [BeanUtils](http://commons.apache.org/beanutils/) API。例如对于“学生”表。

```
 DynaProperty[] props = new DynaProperty[]{
        new DynaProperty("firstName", String.class),
        new DynaProperty("lastName",  String.class),
        new DynaProperty("address", java.util.Map.class)

      };
    BasicDynaClass dynaClass = new BasicDynaClass("student", null, props); 
```

给定这些学生对象的集合*表*。我们定义一个 BeanComparator

```
 BeanComparator surnameComparator
        = new BeanComparator("lastname");
Collections.sort(table, surnameComparator); 
```

不确定这是否是您要查找的内容，但似乎非常接近。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T12:52:09.003

**Publicobject 的[glazedlists](http://publicobject.com/glazedlists/)几乎完全符合您的需求。** 我已将它用于类似的报告生成要求。它本质上是一种机制，可以让您查看内存列表。您的视图可以通过各种方式进行排序、过滤和一般转换。它还具有简单的更新机制，因此您可以在主列表中插入新项目，并且所有过滤/排序的视图都会看到更新事件。

传统上，它作为 Swing 网格/JTables 的支持模型非常流行，但它与 Swing API 没有任何关联，并且可以在任何缓存列表的地方使用。

当我使用它时，我们的内存中只有几千个对象，而且性能非常好。不确定它如何扩展到巨大的数字。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T11:23:58.390

看看 JXTable：[http ://swinglabs.org/docs/components/JXTable/tutorial.jsp](http://swinglabs.org/docs/components/JXTable/tutorial.jsp)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T11:27:14.857

[Google Collections Library](http://code.google.com/p/google-collections/)有一种类似的东西叫做[Multimap](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/Multimap.html)。根据 API 文档：

*“一个类似于 Map 的集合，但它可能将多个值与单个键相关联。如果您使用相同的键但不同的值调用 put(K, V) 两次，则多重映射包含从键到两个值的映射。”*

因此，您可以将 name 作为键并调用`put("Thomas", 32);`then`put("Thomas", "brown");`等。

如果您使用此接口的[TreeMultimap](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/TreeMultimap.html)实现，您可以传入 Comparator 进行排序/排序。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T11:55:48.453

至少存在一种支持排序的 javax.sql.rowset 实现。

许多 Swing`TableModel`扩展允许排序（我认为这是教程示例）。即使您不做 GUI 的东西，也不要害怕“摇摆”位。大多数 Swing 模型根本不引用“真实”的 Swing 组件，因此可以认为是完全独立的（除了命名不当）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T13:02:51.430

*   创建一个包含名为“姓名”、“年龄”、“头发颜色”的字段的类
*   将该类的实例放入`ArrayList`
*   将 Collections.sort() 与用于比较特定字段的自定义比较器一起使用

# php - 在页面内加载页面

> ID：564814
> 
> 赞同：2
> 
> 时间：2009-02-19T11:10:35.317
> 
> 标签：php, javascript, jquery, html, ajax

我是 PHP 和 Javascript 的初学者。

[我从http://cmichelis.whsites.net/whblog/jquery-extjs-1/example2](http://cmichaelis.whsites.net/whblog/jquery-extjs-1/example2)找到了一个链接

里面有一段代码说：

```
function addPanel(location)
{
 tabpanel.add({
       autoLoad: {url: location},
       title: 'More Information...',
       closable:true,
       autoScroll:true
 }).show();
} 
```

如何使用 ：

```
<a href="javascript:void(0);"
   onclick="addPanel('loadpage.php?a=http://www.google.com')">
   head over to Google
</a> 
```

我想问的是.. loadpage.php 的代码是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T11:37:34.550

PHP 页面没有像其他答案中所建议的那样回显 google.com 的内容。它输出一个指向 Google 的 iframe：

```
<iframe src="http://www.google.com" width="100%" height="100%" frameborder="no"></iframe> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T11:31:27.170

看起来`loadpage.php`可以`www.google.com`使用[file_get_contents 来回](http://ie.php.net/file_get_contents)显 的内容。

**加载页面.php**：

```
<?php
    // Simplified output - should sanitise $_REQUEST params etc first..
    echo file_get_contents($_REQUEST['a']);
?> 
```

`loadpage`有效地充当代理，允许您的 javascript 调用不在您自己域中的页面。

正如@annakata 在评论中指出的那样，上面的代码是非常危险的。该代码说明了代理文件背后的基本思想——在生产中，该文件需要确保`$_REQUEST`参数已被清理，例如只接受来自白名单的值。

[同源策略](http://en.wikipedia.org/wiki/Same_origin_policy)是 javascript的一个安全元素，可阻止您使用 javascript 将域外的内容拉到您的页面上。

一些网站通过调用他们自己的服务器上的代理页面（`loadpage`在这种情况下）来解决这个问题，这实际上只是打印出目标 url 的内容。由于此代理页面位于您的服务器上，因此绕过了同源安全问题，并且仍然可以使用来自另一个域的页面内容 - 这里`www.google.com`

* * *

糟糕，我有点愚蠢地没有 RTFA，而只是问题中的代码并假设它可以做什么。[@andynormancx](https://stackoverflow.com/questions/564814/load-page-within-the-page/564889#564889)对 q 中链接的页面实际在做什么的回答是正确的。

# vb.net - 反射 - 类内数组的 SetValue？

> ID：564816
> 
> 赞同：3
> 
> 时间：2009-02-19T11:11:28.793
> 
> 标签：vb.net, arrays, reflection

好的，我已经做了一段时间的工作，使用反射来完成很多我需要做的事情，但是我遇到了一个绊脚石......

我正在尝试使用反射来填充子属性数组的属性...不确定这是否清楚，因此最好在代码中对其进行解释：

家长班：

```
Public Class parent
    Private _child As childObject()
    Public Property child As childObject()
        Get
            Return _child
        End Get
        Set(ByVal value As child())
            _child = value
        End Set
    End Property
End Class 
```

儿童班：

```
Public Class childObject
    Private _name As String
    Public Property name As String
        Get
            Return _name
        End Get
        Set(ByVal value As String)
            _name = value
        End Set
    End Property

    Private _descr As String
    Public Property descr As String
        Get
            Return _descr
        End Get
        Set(ByVal value As String)
            _descr = value
        End Set
    End Property
End Class 
```

所以，使用反射，我试图通过父对象设置子对象数组的值......

我已经尝试了几种方法......以下几乎是我目前所拥有的（我添加了示例数据只是为了让事情变得简单）：

```
 Dim Results(1) As String

    Results(0) = "1,2"
    Results(1) = "2,3"
    Dim parent As New parent

    Dim child As childObject() = New childObject() {}
    Dim PropInfo As PropertyInfo() = child.GetType().GetProperties()
    Dim i As Integer = 0
    For Each res As String In Results 
        Dim ResultSet As String() = res.Split(",")
        ReDim child(i)

        Dim j As Integer = 0
        For Each PropItem As PropertyInfo In PropInfo
            PropItem.SetValue(child, ResultSet(j), Nothing)
            j += 1
        Next
        i += 1
    Next
    parent.child = child 
```

这在 PropItem.SetValue 上以 ArgumentException 失败：找不到属性集方法。

有人有想法么？

@乔恩：-

谢谢，我想我已经走得更远了，通过创建单独的子对象，然后将它们分配给一个数组......现在的问题是试图将该数组分配给父对象（使用反射）。

这应该不难，但我认为问题来了，因为我不一定知道父/子类型。我正在使用反射来确定传入哪个父/子。父始终只有一个属性，即子对象的数组。当我尝试将子数组分配给父对象时，我得到一个无效的强制转换异常，说它无法将 Object[] 转换为 .

编辑： *基本上，我现在拥有的是：*

```
Dim PropChildInfo As PropertyInfo() = ResponseObject.GetType().GetProperties()
For Each PropItem As PropertyInfo In PropChildInfo
    PropItem.SetValue(ResponseObject, ResponseChildren, Nothing)
Next 
```

ResponseObject 是父类的实例，ResponseChildren 是子对象类的数组。

这失败了：“System.Object[]”类型的对象无法转换为“childObject[]”类型。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T11:19:08.387

首先，我会去掉等式的数组部分——我看不出这有什么关系。尝试编写代码来设置*单个*孩子的值。

其次，您似乎依赖于`GetProperties`按所需顺序排列的结果-您不应该这样做。无法保证返回属性的顺序。您应该根据要拆分的字符串知道所需的顺序，并按*name*获取属性。

第三，我*怀疑*问题在于您有一些只读属性以及可写属性。我建议您启动一个简短的控制台应用程序来检查这一点，在设置之前记录您尝试设置的属性。

如果这没有帮助，请发布一个简短但完整的控制台应用程序来演示该问题，我相信我们将能够解决它。

编辑：好的，如果您现在只停留在数组部分，我建议您展示一个简短但完整的*示例*。我怀疑问题是您创建了一个错误类型的数组。您可以使用 Array.CreateInstance 创建正确类型的数组，然后设置属性时该数组应该是有效的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-22T03:34:53.000

有一些库可以使反射工作更容易（和更快）。例如，[Fasterflect](http://fasterflect.codeplex.com)允许您编写以下代码：

```
parent.Property("child").GetElement(index).SetFieldValue("Name",name); 
```

这将检索对象“父”上称为“子”的属性。由于我们希望它是一个数组，我们将在位置“index”（单个子实例）处获取元素并将其 Name 属性设置为“name”。

免责声明：我作为贡献者参与了上述项目。

# acrobat - showAnnotToolsWhenNoCollab 和 Acrobat 9

> ID：564817
> 
> 赞同：0
> 
> 时间：2009-02-19T11:11:42.833
> 
> 标签：acrobat, collaboration

这段代码

```
js_obj := oAcroPDDoc.GetJSObject;
js_obj.Collab.showAnnotToolsWhenNoCollab := true; 
```

曾经在 Acrobat 7 和 8 中工作（实际上需要启用注释/注释/注释的编辑）似乎会使 Acrobat 9 崩溃。

有谁知道是否有解决方法（[这里](http://www.adobeforums.com/webx/.59b7bcf3)列出的对我不起作用）。Adobe 的任何人都使用 SO 并愿意回答吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T21:40:37.760

看起来[你不是唯一一个遇到](http://www.adobeforums.com/webx/.59b7bcf3)这个问题的人。它已作为已知错误报告给 Adob​​e。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T00:10:03.770

这是一个已知的错误。

它似乎已在更新 9.1 中修复

# sharepoint - 修改用户 mysite 上的 Web 部件

> ID：564818
> 
> 赞同：0
> 
> 时间：2009-02-19T11:12:08.027
> 
> 标签：sharepoint, mysite

作为管理员，我需要能够访问用户“我的站点”并更改他们拥有的 Web 部件。

我似乎可以在 UI 中找到方法或从 Google 中找到任何东西。

想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T14:56:37.267

为单个特定用户更改“我的网站”Web 部件的最简单方法是以该用户身份登录。

1.  单击 SharePoint 网站右上角的“欢迎名字姓氏”。
2.  单击“以其他用户身份登录”。然后填写他们的凭据。
3.  点击右上角的“我的网站”链接。
4.  根据需要调整 Web 部件。

# sql-server-2005 - SQL Server 2005：审计随机记录删除

> ID：564824
> 
> 赞同：1
> 
> 时间：2009-02-19T11:13:15.497
> 
> 标签：sql-server-2005, records, auditing

这似乎是一个愚蠢的问题，但我现在处于一个头->墙的情况。

我在一个大型 ERP 应用程序上工作，其中 SQL Server 2005 数据库由多个不同的应用程序更新。我试图找出特定表中的删除来自何处。

我尝试使用 Profiler，但我无法过滤足够多的事件类型以识别错误的 SP，因为来自各个方面的数据库每秒都有很多命中。此外，Profiler 似乎更倾向于查找 DDL 更改或 Object DROP 类型的操作。

我只是想回答这个问题：**什么存储了 Proc。还是 SQL 查询导致从表 X 中删除记录？**

我应该使用什么工具？我希望避免像[Trigger based Auditing](http://weblogs.asp.net/jgalloway/archive/2008/01/27/adding-simple-trigger-based-auditing-to-your-sql-server-database.aspx)这样的事情。或者 Profiler 是进行此类调查的最佳工具吗？还是第三方工具是唯一的手段？

请提供任何有用的链接，因为我对这个主题相对不熟悉。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T11:28:19.050

您可以为此使用 SQL Profiler，但您需要过滤结果。要监视 DELETE 语句，请选择“RPC:Starting”和“SP:Starting”事件并在 TextData 列上应用过滤器：“TextData LIKE '%DELETE%FROM%'”。

-Edoode

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T13:30:56.620

使用 profiler 找到罪魁祸首就像大海捞针，尤其是在繁忙的系统上；如果您无法使用 edosoft 建议的过滤器找到它，请尝试通过消除 writes=0 的语句、按应用程序名称过滤、按文本数据过滤而不是 '%select%' 来最小化噪音；你应该能够缩小范围。

如果你真的很绝望，你可以拒绝对桌子上所有用户的删除权限，然后等待电话响起。

您还可以偶尔在表上运行 SELECT COUNT(*) 到带有时间戳的工作表中，并尝试将记录计数的任何下降与其他活动相关联。

# c++ - 从服务以交互方式启动 .Net winforms 应用程序

> ID：564829
> 
> 赞同：1
> 
> 时间：2009-02-19T11:14:18.413
> 
> 标签：c++, winforms, winapi, windows-services

环境 - VS2008，Vista SP1。

我编写了一个进程管理服务，它可以在会话 0 或交互式控制台（通常是 1）中启动应用程序。请注意，这不是正常的操作模式，它仅用于内部调试目的。在现场，这些进程将安全地隐藏在会话 0 中。安全问题不适用。

### 显然人们没有读到这个：安全问题不适用。我们有几十个这样编写的现有服务器应用程序（不是服务）。我们不打算彻底改造这些应用程序，我们只需要在内部运行发布版本时能够访问它们的内置调试对话框。我已经知道所有关于规范解决方案和管道等的知识。如果可以接受将远程接口添加到所有这些应用程序中，那就是我们正在做的事情。

我使用以下代码来执行此操作：

```
ZeroMemory (&sui, sizeof(STARTUPINFO));
sui.cb = sizeof (STARTUPINFO);
sui.wShowWindow = pTask->GetWinStartState() ;
sui.dwFlags     = STARTF_USESHOWWINDOW ;
ZeroMemory (&pi,sizeof(pi));

if (bInteractive)
{
   HANDLE  hToken = NULL;
   DWORD dwSessionId = WTSGetActiveConsoleSessionId();
   WTSQueryUserToken (dwSessionId, &hToken);
   sui.lpDesktop = TEXT("winsta0\\default"); 
   LPVOID  pEnv = NULL;
   DWORD dwCreationFlag = NORMAL_PRIORITY_CLASS | CREATE_NEW_CONSOLE;
   HMODULE hModu = LoadLibrary(TEXT("Userenv.dll"));

   if (hModu )
   {
      if (CreateEnvironmentBlock (&pEnv, hToken, FALSE))
         dwCreationFlag |= CREATE_UNICODE_ENVIRONMENT;    
      else
         pEnv = NULL;
   }

   bCreatedOk = CreateProcessAsUser (hToken,
                                     NULL,
                                     (LPTSTR)(pTask->GetExeName()),
                                     NULL,
                                     NULL,
                                     FALSE,
                                     dwCreationFlag,
                                     pEnv,
                                     NULL,
                                     &sui,
                                     &pi);
}
else
{
   bCreatedOk = CreateProcess (NULL, ... blah...);
} 
```

这一切都很好，我可以在 Vista 服务会话和控制台中运行和监视本机进程。伟大的。每个人的蛋糕和啤酒。

所以这就是问题所在。如果我尝试像这样以交互方式运行**winforms** (C#) 应用程序，它似乎正在运行，在进程资源管理器中显示为在会话 1 中运行，但在桌面上...... nada。根本没有窗口出现。该过程运行并关闭一切正常，但没有出现任何窗口。从资源管理器运行的完全相同的 winform exe 也出现在会话 1 中，但这次出现在桌面上就好了。

有任何想法吗 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T15:43:21.873

**尽管存在明显的歇斯底里，但只要使用与交互式用户相同或更低的权限，将**应用程序从服务启动到交互式会话中并没有错。由于您是以交互式用户身份启动的，因此无法提升权限。

你正在做的事情确实有效。我怀疑这个问题与您的 STARTUPINFO 结构有关。您似乎正在堆栈上创建您的 sui，但您没有显示您正在使用它做什么。您是否将其初始化为全 0，如果不是，您可能会从堆栈中获取一些垃圾，导致窗口不显示或在屏幕外的某些坐标处显示。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T11:17:58.000

一句话，“不要”。

服务通常以降低的权限运行，而不是以当前用户身份运行。因此，在 Vista+ 中，它们不允许与用户桌面交互。最重要的是，服务获得了一个空窗口站。

您过去可以选中一个框，上面写着“允许与桌面交互”，但现在不行了。这是不好的做法。

你最好的办法是创建一个在用户上下文中运行并通过命名管道、LRPC 或套接字与服务通信的帮助应用程序，然后让你的帮助应用程序为用户启动程序。这是现在大多数反病毒软件的工作方式。

另外，请阅读Microsoft 提供的有关该主题的[白皮书](http://www.microsoft.com/whdc/system/vista/services.mspx)。服务不能在会话 0 以外的任何地方运行。

注意：一些研究似乎表明您需要使用以下方式复制令牌：

```
DuplicateTokenEx(hTokenNew,MAXIMUM_ALLOWED,NULL,
    SecurityIdentification,TokenPrimary,&hTokenDup); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T11:30:13.163

看起来好像您正试图打破会话隔离。就像神秘人说的，我不认为这是正确的做法。

如果您真的想这样做，[http://support.microsoft.com/ ?scid=kb%3Ben-us%3B165194&x=5&y=3 可能会很有用。](http://support.microsoft.com/?scid=kb%3Ben-us%3B165194&x=5&y=3)在那边的代码示例中，他们似乎比你初始化更多的东西。

* * *

**编辑**如果是出于调试目的，即 VS 2008 步入，只需在开头添加一个等待循环，并以管理员权限启动 VS。您可以附加到您的服务进程而不会遇到系统隔离。

# .net - WCF 和 NetTcpBinding

> ID：564836
> 
> 赞同：2
> 
> 时间：2009-02-19T11:16:53.897
> 
> 标签：.net, wcf, remoting

当我使用 NetTcpBinding 公开服务时，是否在表面下使用 .Net 远程处理？我可以在客户端使用 .Net 远程处理使用此服务吗？

我问这个是因为我一直认为 WCF 只是底层协议（如 WS*、Remoting、COM+ 和 MSMQ）的包装器。虽然我知道公开 WS* 会按预期工作，但其他人似乎更加矛盾。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T11:44:27.153

WCF/NetTcpBinding 与远程处理不同。WCF 是一个基于消息的 API；远程处理是一个激活/代理框架（本质上）（[另见](http://msdn.microsoft.com/en-us/library/aa730857(VS.80).aspx)）。

我非常怀疑您是否可以通过远程客户端使用 WCF/NetTcpBinding 服务；他们太不一样了。

WCF 是一个框架，它提供对许多消息传递协议的统一访问——实际上你可以添加你自己的——但这并不容易。

我建议使用适当的 WCF 客户端，或者（如果这不可能）使用基本 http 客户端，或者（我最不喜欢的选项）如果你真的必须使用旧式远程处理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T16:13:23.143

WCF 不仅仅是一个包装器。它是一个伪魔术层，根据配置信息为组件开发人员处理大量内容。使用 WCF，您可以创建服务合同和实现，然后通过 HTTP、HTTPS、NET-TCP 在多台机器上使用它们，通过命名管道、安全、非安全等在单台机器上使用它们，只需调整配置设置即可。

这与 .net 远程处理的方式截然不同。

[获取 Juval Lowy 的“ Programming WCF Services](http://oreilly.com/catalog/9780596521301/index.html) ”的副本，以更好地了解您可以使用 WCF 做什么。

# ruby-on-rails - 在 Rails 中测试辅助方法

> ID：564837
> 
> 赞同：2
> 
> 时间：2009-02-19T11:17:20.700
> 
> 标签：ruby-on-rails, testing, mocking, helpers

我正在测试我的 rails helper 方法，如下所示：

```
require File.dirname(__FILE__) + '/../../test_helper'
require 'action_view/test_case'
require 'action_view/helpers'

class ListingsHelperTest < ActionView::TestCase

  def setup
    @controller = ListingsController.new
    @request  = ActionController::TestRequest.new
    @response = ActionController::TestResponse.new
  end
end 
```

这很好用，除非助手调用需要发生请求的方法，例如**url_for**。由于我不想通过请求进程运行整个堆栈来测试这些（例如通过调用 get :index），所以需要初始化或删除什么才能使其工作？

我正在寻找一个更通用的解决方案来模拟请求，但具体来说，我得到的错误是：

```
NoMethodError: You have a nil object when you didn't expect it!
The error occurred while evaluating nil.rewrite
rails/actionpack/lib/action_controller/base.rb:625
rails/actionpack/lib/action_view/helpers/url_helper.rb:85
rails/actionpack/lib/action_view/helpers/url_helper.rb:85 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T01:22:07.107

我觉得：

```
include ActionView::Helpers::UrlHelper
include ActionController::UrlWriter 
```

可能有帮助？

# actionscript - Flash：什么是 SWX 数据格式？

> ID：564846
> 
> 赞同：0
> 
> 时间：2009-02-19T11:19:17.370
> 
> 标签：actionscript, flash, swx

我经常听到的这种**SWX 数据格式是什么？**

*   维基[百科文章](http://en.wikipedia.org/wiki/SWX_Format)说：“数据存储为 SWF 字节码，由 Adob​​e Flash Player 解释。”

*   他们的[官方网站](http://swxformat.org/)说：“SWX 是 Fl​​ash 平台的原生数据格式。”，并且有许多允许用户修改/更新数据的网站示例。

这是否意味着：

*   数据按照开放的 Adob​​e SWF 规范存储，这意味着数据（数组/对象）可以作为**SWF 影片**直接加载到 Flash SWF 中。

*   数据存储在 XML/SQL 中，当 Flash 请求“SWF”文件时，**服务器端代码会生成**一个“SWF”文件并将其传递给 Flash SWF。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T11:49:22.213

“SWX 是 Fl​​ash 平台的本机数据格式”是一个非常令人困惑的说法。您的问题的简短答案是（来自[维基百科](http://en.wikipedia.org/wiki/SWX_Format)）：

> SWX 数据文件可以通过以下方式加载到 Flash 电影中：
> 
> *   ActionScript 2，使用 Flash 内部函数 loadMovie()。
> *   ActionScript 3，使用 SWX API 函数，当接收到数据时，SWX
>     调度自定义事件。

这意味着 SWX 不是“数据格式”，而是用**普通 SWF 字节码**编写的规范。否则它将无法使用内部 Flash 函数加载。（AS3 需要 SWX API 函数的原因是 AS3 不如 AS2 宽容。）所以你的第一个选择（“遵循开放的 Adob​​e SWF”）是正确的。官方网页上的一个很好的例子是：

> 就像 JSON 是 JavaScript 的一个子集

用您的话来说，JSON*是*JavaScript，相应地，SWX*是*SWF。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T11:51:56.247

你看过[SWX 格式](http://swxformat.org/4)的网站吗？希望（特别是链接页面）应该回答您的问题。

# javascript - 我想在单击它和其他启用后禁用链接按钮。使用 javascript 在两个链接按钮之间切换启用/禁用

> ID：564858
> 
> 赞同：6
> 
> 时间：2009-02-19T11:23:53.007
> 
> 标签：javascript

我想在单击它和其他启用后禁用链接按钮。使用 javascript 在两个链接按钮之间切换启用/禁用

```
<a id="a1" href="page1.aspx">One</a><a id="a2" href="page2.aspx">Two</a> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T11:40:23.780

很简单，只需将侦听器添加到`onclick`两个链接上的事件，即禁用相关链接并启用另一个链接。

就像是

```
document.getElementById('a1').onclick = function() {
   document.getElementById('a1').disabled = true;
   document.getElementById('a2').disabled = false;
};

document.getElementById('a2').onclick = function() {
   document.getElementById('a2').disabled = true;
   document.getElementById('a1').disabled = false;
};
```

当然，如果您要将其扩展到多个按钮，那么您可以轻松地将上述内容抽象为注册方法，循环按钮数组等（可能是那些实现特定类而不是显式指定数组的那些）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-26T05:35:16.523

要禁用 LINK 而不是 BUTTON，除了隐藏它之外，您唯一能做的就是将其设置为不去任何地方。

```
onclick="this.href='javascript: void(0)';" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-08T04:23:03.183

最简单的方法是**隐藏**链接而不是**禁用**它。

您可以使用此代码在单击后隐藏链接。

> 它经过测试的代码和它对我来说非常完美。:-)

```
<script type="text/javascript">
    onclick = function() {
        var chk= document.getElementById('myElementId');
        chk.style.display="none"; 
    };
</script> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T15:52:45.600

您的问题可以有以下 3 种可能的情况中的任何一种。选择适合您的问题的任何一个。

Case1）您的问题中的一个问题是，由于它们是分别指向 page1.aspx 和 page2.aspx 的链接，因此一旦您单击链接，就会在浏览器中加载一个新页面。所以你想要达到的效果并不重要。

案例 2）如果您在每个 aspx 页面上都有链接“一”和“二”，那么您也可以硬编码禁用指向自身的链接。（或者根本没有链接）。

案例 3）如果您有一个框架来显示链接“一”、“二”，并且您有另一个框架来加载两个链接的内容，那么您的问题具有禁用另一个链接的含义。这是相同的代码。

```
 <html>
<a id="a1" href="javascript:void(0)" onclick="toggle(objA1,objA2,'page1.aspx')">One</a>
<a id="a2" href="javascript:void(0)"  onclick="toggle(objA2,objA1,'page2.aspx')">Two</a>
<br><iframe id="ifrm" src=""></iframe>

<script>
    var objA1 = document.getElementById('a1');
    var objA2 = document.getElementById('a2');

    // d=element to disable, e=element to enable 
    function toggle(d,e,link)
    {
        //if already disabled do nothing(don't follow url)
        if(d.disabled) return; 

        //enable/disable
        d.disabled = true;
        d.style.cursor = 'default';
        e.disabled = false;
        e.style.cursor = 'hand';

        //follow link
        ifrm.src = link;
    }
</script>
</html> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T11:29:01.357

您可以像这样访问和设置“禁用”属性：

```
if(somebutton.disabled == true){
  somebutton.disabled = false;
} 
```

我推荐使用像 jQuery 这样的 JavaScript 框架。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-27T16:39:16.900

```
<html>
<head>

<script type="text/javascript" src="jquery-1.4.2.min.js"></script>

<style type="text/css">
    .submit{
        padding:8px;
        border:1px solid blue;
    }
</style>

</head>

<body>

<h1>Disabled submit form button after clicked with jQuery</h1>

<form action="#">
    <p>
        I'm a form ~
    </p>
    <input type="submit" value="Submit"></input>
        <button>Enable Submit Button</button>
</form>

<script type="text/javascript">

$('input:submit').click(function(){
    $('p').text("Form submiting.....").addClass('submit');
    $('input:submit').attr("disabled", true);   
});

$('button').click(function(){
    $('p').text("I'm a form ~").removeClass('submit');
    $('input:submit').attr("disabled", false);  
});

</script>

</body>
</html> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-09-18T21:24:52.280

```
<script type="text/javascript">  
    function validateForm(formObj) {
        if (formObj.username.value=='') {  
            alert('Please enter a username');  
            return false;  
        }
        formObj.submitButton.disabled = true;  
        formObj.submitButton.value = 'Please Wait...';  
        return true;  
    }
</script>
<form name="frmTest" action="" method="post" onsubmit="return validateForm(this);">  
    Username: <input type="text" name="username" value="" /><br />  
    <input type="submit" name="submitButton" value="Submit" />  
</form> ​​​​​​ 
```

# mysql - MySQL中的触发器和存储过程

> ID：564861
> 
> 赞同：-1
> 
> 时间：2009-02-19T11:25:23.207
> 
> 标签：mysql, stored-procedures

我用了一段时间的 MSSQL 存储过程和触发器；MySQL 让我对如何编写更简单的程序非常着迷。

为什么在这个如此愚蠢的触发器中出现语法错误？

```
CREATE TRIGGER set_prio_default BEFORE INSERT ON categories
FOR EACH ROW
BEGIN
  set @my_prio := 1;
    SET new.prio := @my_prio;
END 
```

事实上，这个 TRIGGER 是对以下内容的过度简化：

```
DELIMITER $$
DROP PROCEDURE IF EXISTS `slot08`.`test` $$
CREATE PROCEDURE `slot08`.`test` ()
BEGIN
     select 1 + max(prio) from categories INTO @my_prio;
     select @my_prio;
END $$
DELIMITER ; 
```

我仍然不明白如何在程序中使用变量。如果我使用 DECLARE 语句并且变量名错过了 @ 字符，我从 mysql 收到一个错误，告诉我“未知系统变量”——但我看到的许多示例都使用了这种语法

我是说：

这不起作用

```
CREATE TRIGGER set_prio_default BEFORE INSERT ON categories
FOR EACH ROW
BEGIN
  declare  my_prio integer default 1;
  set my_prio := 1;
    SET new.prio := my_prio;
END 
```

如果我使用 @ 我会得到语法错误。

有一些提示吗？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T13:51:34.337

我认为您不必使用 := 运算符。一个简单的等号就可以了。在存储过程中声明的所有变量都必须以 @symbol 为前缀。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T14:36:33.747

嘿，找到答案了。希望像我这样在 MySQL 程序方面经验很少的人可以避免花费我在同一问题上花费的时间。这*确实*有效：

```
DELIMITER $$
CREATE TRIGGER blablabla    
BEFORE INSERT ON myStupidTable
FOR EACH ROW
BEGIN
      declare  my_prio integer;
      select   1 + max(prio) from myStupidTable INTO my_prio;
      SET      new.prio := my_prio;
END $$
DELIMITER ; 
```

到目前为止，MySQL 语法错误似乎是一个分隔符问题。

问候

丹尼尔

# sql - 我可以在 SQL Server 的更新语句中使用存储过程输出吗？

> ID：564862
> 
> 赞同：0
> 
> 时间：2009-02-19T11:25:39.773
> 
> 标签：sql, sql-server, sql-server-2005

我在 SQL Server 2005 中转换一些数据。我有一个这样的表更新：

```
update Invoices set Invoices.InvoiceReference = 'NewRef'
where Invoices.InvoiceReference='Unknown' 
```

但我想插入而不是“NewRef”的是使用 Invoices 表列中的参数的存储过程的输出。存储过程本身会更新另一个表。可能吗？下面是这样的（当然这是错误的：）

```
DECLARE @Ref nvarchar(20)   
update Invoices set Invoices.InvoiceReference = (
    EXEC InvoiceGenerateRef
        @ClientCode = Invoices.ClientCode,
        @EventCode = Invoices.EventCode,
        @Ref = @Ref OUTPUT
    SELECT @Ref)
where Invoices.InvoiceReference='Unknown' 
```

我需要使用游标还是语法错误？

谢谢，克里斯。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T11:49:01.107

我认为您最好将存储过程更改为函数或视图（取决于您在 proc 中实际执行的操作）。

我认为您所追求的是加入无法正常工作的存储过程的结果集。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T11:29:36.567

您快到了，实现您想要做的正确方法是将输出参数定义为存储过程定义的一部分。

然后可以将此参数用作更新语句的一部分。

```
DECLARE @Ref nvarchar(20)  

EXEC InvoiceGenerateRef
        @ClientCode = N'ABC2',
        @EventCode = N'X1'
        @Ref = @Ref OUTPUT

update Invoices 
    set Invoices.InvoiceReference = @Ref
where Invoices.InvoiceReference='Unknown' 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T15:21:17.390

1）您可以更改 InvoiceGenerateRef 以便它可以选择将生成的 Ref 保存到 InvoiceReference 字段中。大概您还必须提供参数来定义选择

2）您可以使用 e 光标来遍历每一行

```
SELECT ...
FROM Invoices 
WHERE Invoices.InvoiceReference='Unknown' 
```

并将详细信息传递给 InvoiceGenerateRef，然后更新该行。恕我直言，这很糟糕，而且会很慢（您最好的选择是基于集合的解决方案）

3）您可以将适当的 Invoices.ID 选择到一个临时表中，该表将在 InvoiceGenerateRef 的范围内，以便它可以迭代（即选择要更新的哪些行在 SProc 外部，但 SProc 进行实际更新)

```
CREATE TABLE #TEMP
(
    T_ID int NOT NULL
)

INSERT INTO #TEMP (T_ID)
SELECT ID
FROM Invoices 
WHERE Invoices.InvoiceReference='Unknown'

EXEC InvoiceGenerateRef @ACTION='UpdateFromTemporaryTable' 
```

4）您可以将 InvoiceGenerateRef 更改为执行相同任务的函数：

```
UPDATE U
SET U.InvoiceReference = 
    dbo.MyInvoiceGenerateRefFunction(U.ClientCode, U.EventCode)
FROM Invoices AS U
WHERE U.InvoiceReference='Unknown' 
```

MyInvoiceGenerateRefFunction 必须是确定性的（我认为！）

这将是我的首选

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T14:48:33.390

通过使用 OPENROWSET，您可以像查看视图一样查询存储过程结果：

[http://blogs.technet.com/wardpond/archive/2005/08/01/the-openrowset-trick-accessing-stored-procedure-output-in-a-select-statement.aspx](http://blogs.technet.com/wardpond/archive/2005/08/01/the-openrowset-trick-accessing-stored-procedure-output-in-a-select-statement.aspx)

因此，对于您的情况，这可能很有用。

# actionscript - 客户端代码可以修改 SWX 数据文件吗？

> ID：564863
> 
> 赞同：0
> 
> 时间：2009-02-19T11:25:44.733
> 
> 标签：actionscript, flash, swx

数据存储在[SWX 文件](http://swxformat.org/)中，Flash Player 在本机将其作为“对象”读取。

客户端能否请求服务器更新/**修改 SWX**文件，就像 MySQL 数据库一样？如何？SWX-PHP？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T12:04:20.867

您必须在服务器端读取 SWX 文件。这可能很难做到，而且不是很实用。

您可能会考虑将数据存储在数据库中（例如 MySQL）并使用例如 SWX-PHP 服务访问它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T11:55:23.057

不。

从技术上讲，*数据*不存储在 SWX 文件中；SWX 文件是遵循特定规范的 SWF 文件。[官方网站上](http://swxformat.org/documentation#71)有一些很好的定义。在 SWX-RPC 中，SWX 文件是所涉及的 Remote Procedure Call 协议的实现，该协议可以通过 SWX 服务包装器使用，不需要由客户端代码修改 - 如果需要修改它，为什么?

存储在 SWX 文件中的是**实际代码**，采用 Flash Player 原生格式，例如（在 SWX-RPC 中），用于处理与底层服务网关的交互。

您可能想要做的*而不是*修改 SWX 文件是有一种方法来生成与服务网关交互所需的 SWX 文件。通常，只有在服务接口发生变化时才需要新的 SWX。如果您出于服务交互以外的其他原因想要 SWX 文件，请随时发表评论。

对于通过 PHP 的 SWX-RPC，SWX-PHP 站点有很好的[入门示例](http://swxformat.org/82)。

# visual-c++ - 在 Visual C++ 中链接具有依赖项的库而不获取 LNK4006

> ID：564872
> 
> 赞同：24
> 
> 时间：2009-02-19T11:29:31.527
> 
> 标签：visual-c++, module, warnings

我有一组静态编译的库，库之间具有相当深入的运行依赖关系。例如，可执行文件 X 使用库 A 和 B，A 使用库 C，B 使用库 C 和 D：

```
X -> A
     A -> C
X -> B
     B -> C
     B -> D 
```

当我将 X 与 A 和 B 链接时，如果没有将 C 和 D 也添加到库列表中，我不希望出现错误 - A 和 B 在内部使用这些库的事实是 X 不需要的实现细节要知道。此外，当在依赖关系树的任何位置添加新的依赖关系时，任何使用 A 或 B 的程序的项目文件都必须重新配置。对于深度依赖树，所需库的列表可能会变得非常长且难以维护。

因此，我在 A 项目中使用 Librarian 部分的“附加依赖项”设置，添加 C.lib。在 B 的项目的同一部分，我添加了 C.lib 和 D.lib。这样做的效果是图书馆员将 C.lib 捆绑到 A.lib 中，并将 C.lib 和 D.lib 捆绑到 B.lib 中。

但是，当我链接 X 时，A.lib 和 B.lib 都包含它们自己的 C.lib 副本。这导致了大量的警告

> A.lib(c.obj) : 警告 LNK4006 "symbol" (_symbol) 已在 B.lib(c.obj) 中定义；第二个定义被忽略。

如何在不收到警告的情况下完成此操作？有没有办法简单地禁用警告，还是有更好的方法？

**编辑**：我看到不止一个答案表明，由于缺乏更好的选择，我只是禁用了警告。好吧，这是问题的一部分：我什至不知道如何禁用它！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-27T13:45:14.023

据我所知，您不能禁用链接器警告。但是，您可以使用链接器的命令行参数忽略其中一些，例如。/忽略：4006

将它放在链接器->命令行设置下的项目属性中（不记得确切位置）。

另请阅读：

[链接/忽略](http://www.geoffchappell.com/studies/msvc/link/link/options/ignore.htm)

[MSDN 论坛 - 隐藏 LNK 警告](http://social.msdn.microsoft.com/Forums/en-US/vclanguage/thread/f7f11f7e-1b5b-449d-b80e-4e4732667dd2/)

瓦切克

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-25T23:01:18.433

**更新**如果您可以在单个解决方案中构建所有涉及的项目，请尝试以下操作：

*   将所有项目放在一个 sln 中。
*   从项目的链接器或库管理器属性中删除对静态库的所有引用。
*   解决方案资源管理器中每个项目的上下文菜单中都有“项目依赖项...”选项。使用它来定义项目之间的依赖关系。

它应该工作。它不会使我之前所说的任何内容无效，构建 C/C++ 程序的基本模型保持不变。VS（至少 2005 年及更新版本）足够聪明，可以将所有需要的静态库添加到链接器命令行。您可以在项目属性中看到它。

当然，如果您需要使用已编译的静态库，此方法将无济于事。然后您需要将它们全部添加到直接或间接使用它们的 exe 或 dll 项目中。

* * *

我认为你对此无能为力。您应该从静态库项目中删除对其他静态库的引用，并将所有需要的静态库项目添加为 exe 或 dll 项目的依赖项。您将不得不接受任何包含 A.lib 或 B.lib 的项目也需要包含 C.lib 的事实。

作为替代方案，您可以将您的库转换为提供更丰富模型的 dll。

静态编译的库根本不是具有依赖信息等的真实库，例如 dll。看看，当你构建它们时，你真的不需要提供它们所依赖的库吗？标题就是所需要的。看？你甚至不能说静态库依赖于某些东西。

静态库只是已编译但尚未链接的目标代码的存档。不是整体一致的。每个目标文件都是单独编译的，并且在库中保持独立的实体。当您构建 exe 或 dll 时会发生链接。那是您需要提供所有目标代码的时候。那是所有符号和依赖关系解析发生的时候。

如果您将其他静态库添加到静态库依赖项中，librarian 将简单地将所有代码复制在一起。然后，在构建 exe 时，链接器会给你很多关于重复符号的警告。您也许可以阻止这些警告（我不知道如何），但要小心。它可能会隐藏真正的问题，例如具有不同定义的真正重复符号。如果你在库中定义了静态数据，它可能无论如何都不会工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-27T16:00:44.527

Microsoft (R) Incremental Linker Version 9.00.x ( **link.exe** ) 知道参数**/ignore:4006**

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-24T20:38:17.847

您可以创建一个包含 A、B、C 和 D 的库，然后将 X 链接到该库。

由于它是一个库，因此只有实际引用的对象模块才会链接到最终的可执行文件中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-07-20T09:29:08.470

请注意，获得此警告的一种方法是在没有 inline 语句的标头中定义成员函数：

```
// Foo.h

class Foo
{
    void someFunction();
};

void Foo:someFunction() // Warning!  - should be "inline void Foo::someFunction()"
{
    // do stuff
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T11:59:01.597

问题是您没有本地化库 C 的符号。因此，当您在 A 和 B 中链接时，您会违反 ODR。您需要有办法将这些设为私有。默认情况下，所有符号都被导出。一种方法是为 A 和 B 提供一个特殊的链接器定义文件，明确指出需要导出哪些文件。

[1] ODR = 一个定义规则。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T11:59:37.057

我认为这里最好的做法是忽略/禁用链接器警告（LNK4006），因为 C.lib 需要同时成为 A.Lib 和 B.lib 的一部分，而 A.Lib 不需要知道 B.lib本身使用 C.Lib。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-25T23:19:54.660

这可能无法修复您的链接错误，但它可能有助于解决您的依赖关系树问题。

我所做的只是使用#pragma 在需要它的.cpp 文件中包含一个库。例如：

```
#pragma comment(lib:"wsock32") 
```

就像我说的那样，我不确定它是否会将符号保留在该目标文件中，我必须编写一个示例来尝试一下。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2010-08-15T00:27:33.630

可怜的 flodin 似乎很沮丧，因为没有人会解释如何禁用链接器警告。好吧，我也遇到过类似的问题，多年来我一直忍受着显示数百条警告的事实。然而，现在，感谢来自[Link /ignore](http://www.geoffchappell.com/viewer.htm?doc=studies/msvc/link/link/options/ignore.htm)的信息，我想出了如何禁用链接器警告。

我正在使用 Visual Studio 2008。在项目 -> 设置 -> 配置属性 -> 图书馆员 -> 命令行 -> 附加选项中，我添加了“/ignore:4006”（不带引号）。现在我的警告消失了！

# c++ - C ++中的点和线类？

> ID：564877
> 
> 赞同：7
> 
> 时间：2009-02-19T11:31:04.083
> 
> 标签：c++, pointers

我正在学习 C++（以及一般的编程），我正在尝试同时创建一个 Point 类和一个 Line 类。

一条线应由 2 个点对象组成。

C++ 大师能否查看我的工作并告诉我这是否是您应该正确使用指针、引用和类的方式？

```
class Point
{
    private:
        int x, y;
    public:
        Point() : x(0), y(0) {}
        Point(int x, int y) : x(x), y(y) {}
}

class Line
{
    private:
        Point *p1;
        Point *p2;
    public:
        Line(Point &p1, Point &p2) : p1(p1), p2(p2) {}

        void setPoints(Point &p1, Point &p2)
        {
            this->p1 = p1;
            this->p2 = p2;
        }
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T11:36:29.700

您根本不应该在代码中使用指针。使用实际对象。指针实际上在 C++ 中很少使用。

```
class Point
{
    private:
        int x, y;
    public:
        Point() : x(0), y(0) {}
        Point(int x, int y) : x(x), y(y) {}
}

class Line
{
    private:
        Point p1;
        Point p2;
    public:
        Line(const Point & p1, const Point & p2 ) : p1(p1), p2(p2) {}

        void setPoints( const Point & ap1, const Point & ap2)
        {
            p1 = ap1;
            p2 = ap2;
        }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T11:43:54.707

+1 zabzonk 所说的。

正如您所使用的那样，使用指针的时间是：

1.  你有几点
2.  您想使用这些点创建线
3.  您想要更改点的值并隐式更改线条。

如果行包含指向现有点的指针，则可以实现上述第 3 步。虽然它引入了复杂性（例如，“当你销毁一个 Point 实例时，包含指向该 Point 的指针的 Line 实例会发生什么？”），当（如 zabzonk 建议的那样）每条 Line 包含其自己的 Point 值时，它不存在。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-19T11:50:11.680

无论你的 line 类的 Point 成员是否是指针，都会创建一个非常不同类型的类。使用指针将产生经典的 CoGo 风格方法，可以将点视为板上的钉子，而线是连接这些钉子的橡皮筋。改变一个点就像移动一个钉子，所有相关的线条都会自动跟随，这在某些应用程序中是可取的。

使用字面点意味着行都是相互独立的，这适用于其他类型的应用程序。

在此阶段，这是您的课程的关键设计决策。

**编辑：**正如其他帖子和下面的评论中所述，利用简单的指针来实现多行和多点之间的关联也存在严重的潜在问题。具体来说，如果一个点在内存中被删除或移动，所有指向该点的指针都必须更新。在实践中，这往往可以通过使用唯一的点 ID 来查找点而不是简单的指针来克服。这也允许 CoGo 结构易于序列化/保存。因此，我们的点类将有一个静态成员来根据 ID 获取一个点，而我们的线类将有两个点 ID 而不是指针。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T11:37:13.850

我更喜欢这个...

```
class Point
{
    private:
        int x, y;
    public:
        Point() : x(0), y(0) {}
        Point(int x, int y) : x(x), y(y) {}
}

class Line
{
    private:
        Point p1;
        Point p2;
    public:
        Line(const Point &p1, const Point &p2) : p1(p1), p2(p2) {}

        void setPoints(const Point &p1, const Point &p2)
        {
            this->p1 = p1;
            this->p2 = p2;
        }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T11:38:22.973

无需在 Line 类中使用指针。

此外，以下行不正确：

```
Line(Point &p1, Point &p2) : p1(p1), p2(p2) {} 
```

为什么？您将`Point &`(p1)分配给`Point *`(Line::p1)，这是非法的。你会想要那里的指针。

您的 Point 类无法修改其数据。不太好用...

对我来说， Line 类看起来像这样：

```
class Line
{
    private:
        Point p1, p2;

    public:
        Line()
        {
        }

        Line(Point start, Point end) :
            p1(start), p2(end)
        {
        }

        const Point &startPoint() const
        {
            return p1;
        }

        Point &startPoint()
        {
            return p1;
        }

        const Point &endPoint() const
        {
            return p2;
        }

        Point &endPoint()
        {
            return p2;
        }
}; 
```

您现在可以像这样编辑您的行：

```
Line line;
line.startPoint() = Point(4, 2);
line.endPoint() = Point(6, 9); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T11:38:29.773

我注意到了几件事：

*   您可以将两个点构造函数组合成一个具有默认值的构造函数。
*   您完全没有必要使用指针。使用对象本身。
*   您可以互换使用指针和引用。不要混淆它们，或看到最后一点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T11:39:14.967

我认为制作 Point 的指针没有什么价值（除了具有讽刺意味的价值）。您的点在 32 位系统（2 个整数）上占用 8 个字节。一个指针占用 4 个字节。你节省了 4 个字节。

至于正确性，您的 Line 构造函数接受引用，但您将它们分配给指针。那甚至不应该编译。你也在 setPoints 中做同样的事情。最好简单地使两点成为实际对象并复制它们的值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T11:41:14.883

```
class Line
{
    private:
        Point *p1; /* No memory allocated */
        Point *p2; /* No memory allocated */
    public:
        Line(Point &p1, Point &p2) : p1(p1), p2(p2) {}

        void setPoints(Point &p1, Point &p2) /* passed references to Point objects */
        {
            this->p1 = p1; /* asssiging Point objects to Point *! */
            this->p2 = p2; /* asssiging Point objects to Point *! */
        }
} 
```

setPoints() 函数不起作用 - 乍一看。它应该是

```
 void setPoints(Point &p1, Point &p2) 
            {
                this->p1 = &p1; /* asssiging Point objects to Point *! */
                this->p2 = &p2; /* asssiging Point objects to Point *! */
            } 
```

再说一次，我们无法控制 p1 和 p2 何时被销毁。最好使用 p1 和 p2 中的数据创建 this->p1 和 this->p2 以便析构函数可以控制内存

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T11:52:15.310

编译器将在此代码上给出错误：

1.  在 Line 构造函数的初始化列表中，您将 Point 引用 p1 分配给类成员 p1，它是指向 Point 的指针。要编译它，您应该使用 Line(Point &p1, Point &p2) : p1(&p1), p2(&p2)。
2.  同样的问题也出现在 setpoints 方法中。应该将其更改为 this->p1 = &p1 等。
3.  小问题：在类的结束 } 之后，放入一个分号 (;)

我认为这结束了语法。

代码还有另一个问题：

Line 的 p1 和 p2 类成员是指向 Point 实例的指针。谁创建了这些实例，谁在不再需要它们时将它们删除？如果按照现在的方式设计类，则创建 Line 实例的代码会将两个 Point 实例传递给构造函数。如果这些 Point 实例在 Line 删除之前被删除，则 Line 会留下两个悬空指针（不再引用有效实例的指针）。

此外，现在属于 Line 的两个 Point 实例可以从 Line 类之外的代码进行修改。这可能导致非常不利的情况。

在这种情况下，我会将 p1 和 p2 成员声明为 Point（而不是指向 Point 的指针）。这样，传递给构造函数的 Point 实例将被复制到类成员。只要 Line 存在，Point 成员就会存在。它们只能由线路类本身更改。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T12:19:14.140

在询问语言大师的意见之前，请开始考虑设计，在这种情况下尤其是关于对象的生命周期：点是否需要没有线而存在？线是否共享点？谁创造了一个点，它什么时候停止存在？具有相同坐标的两个点是相同的还是相等的（一个可能是红色的，另一个可能是蓝色的）？...

看来这里的大多数人都同意您应该在如此小的代码库上使用值语义。有时，问题需要多方引用同一个对象（即Point），然后使用指针（或引用）。

指针和引用之间的选择仍然是另一回事。我更喜欢在实现聚合时使用引用（没有端点就不能存在线），在实现不太“亲密”的关系时更喜欢使用指针。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-19T13:58:07.270

在 Line 类中使用 Point 对象。这些点的所有权尚不清楚，您可能会遇到悬空指针或内存泄漏的风险。

您的默认构造函数是一个问题，因为您很少希望在 (0,0) 处创建一个点。您最好将默认 x,y 值设置为 MAXINT 之类的值，并断言对 Point 的任何使用都没有 MAXINT 作为其值之一。有一个 is_valid() 函数，以便客户端可以测试。您的 Line 类也可以有一个前提条件，即它的两个点不是无效的。不允许有效点具有 MAXINT 值的好处是，您可以检测点何时未正确初始化，并且您将消除一些在类使用中难以发现的错误。

# sorting - SSRS Microsoft 报告：条件分组

> ID：564880
> 
> 赞同：1
> 
> 时间：2009-02-19T11:32:34.330
> 
> 标签：sorting, reporting-services, conditional, grouping, rdlc

是否可以进行分组和排序？如果是这样，是否有可能根据文本框项目的值以某种方式做到这一点？

我想我可以只设置组的表达式并排序为类似的东西`=IIF(ReportItems!TheTextBox.Value = 0, 0, Fields!FieldName.Value)`，这将是完美的，但它不允许我在组中使用 ReportItems 或排序表达式 =(

真的不想在需要该功能时制作两份报告……希望有人能对此有所了解！

使用：

*   微软报告服务
*   具有本地处理功能的报告查看器

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T11:53:29.380

**编辑**

> 这是一个子报表，所以我不能使用报表参数。

你可以。请参阅[如何：添加子报表和参数 (Reporting Services)](http://msdn.microsoft.com/en-us/library/ms160348.aspx)
**/edit**

尝试在分组表达式中检查此报表参数集合。就像是：

```
=IIF(Parameters!<ParameterName>.Count = 0, 0, Fields!FieldName.Value) 
```

请参阅[在表达式中使用参数集合引用 (Reporting Services)](http://msdn.microsoft.com/en-us/library/aa337293.aspx)

# pair-programming - 如果你结对编程，你还需要同行评审吗？

> ID：564882
> 
> 赞同：2
> 
> 时间：2009-02-19T11:34:28.270
> 
> 标签：pair-programming

我认为一般来说，同行评审是开发过程中非常好的一部分，他们经常会发现或质疑最初编写代码时不明显的事情，并使您更加自觉，因此您可以更好地格式化，发表评论等。

然而，如果你是结对编程，你实际上有一个实时的同行评审，那么作为流程的一部分，还值得有一个同行评审吗？您可以进行配对同行评审吗？

我问，结对编程开始在我工作的地方发生，通常这被视为同行评审的替代品。我不太确定，但认为开发人员花在结对编程和同行评审上的时间可能会损害生产力。

前段时间有一个[类似的问题](https://stackoverflow.com/questions/23935/peer-reviews-or-pair-programming-or-both)，但重点不同，没有明确的共识

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T11:51:42.973

那要看。

在我看来，同行评审的目标不仅是直接发现编写代码的缺陷，而且要确保代码也能与现有代码库一起正常工作。有时，您可能希望让您正在编写的代码的专家参与其中，而他可能不是该组合的成员。

例如，如果您编写应用程序的 3D 图形部分，您可能希望 OpenGL 专家对其进行审核。

因此，根据具体情况，您可能需要第三双眼睛来看待您的问题。这个人甚至可能没有被并置（在另一个时区或其他地方）。

另外，当你配对时，你可能会有相似的想法。因此，另一种意见可能会让您对错过的事情大开眼界。

如果我的开发人员与代码配对，如果他们不是 100% 的代码专家，我仍然会鼓励他们审查他们的代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T11:39:53.030

如果合作伙伴在结对编程中发生变化，那么您基本上会自动获得同行评审（甚至不仅仅是一对“额外”的眼睛）。如果两个程序员都不确定如何做某事，他们仍然可以（*应该*）寻求帮助，这再次导致某种同行评审。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T11:43:50.447

我认为同行评审仍然很重要，因为这两种情况下涉及的思维定势在编程时非常不同，正常思维定势在进行同行评审时并不重要，涉及的思维方式是批判性分析，就像通过手动测试完成开发它的同一个开发者不如从测试人员那里完成它

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T14:00:46.343

*配对交换*旨在解决同行评审的问题。当开发人员加入新对时，他/她必须了解他/她将要解决的问题。理解包括审查。

我相信只需要对系统的关键点进行单独的专家审查。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T18:27:50.363

配对是同行评审。或者正如 XP 所说，如果有什么好的，那就把它发挥到极致。如果同行评议很好，那就继续做，即结对编程。

当配对编程正确完成并且配对经常轮换时，您将完成对所有开发代码的持续同行评审。更好的是，代码在设计、测试和编写时进行审查（是的，首先编写测试，AKA 测试驱动开发），而不是在编写代码并且修复成本更高之后。

同行评审的代码只是结对编程的优势之一。其他优点是：

**提高质量**：一对活跃的程序员在同一张故事卡上工作，完成卡时缺陷更少

**提高生产力**：在解决问题时，如果没有完全阻塞，则一对不太可能放慢速度。此外，当您与合作伙伴一起工作时，更难通过电子邮件或网络度假……您不想让合作伙伴失望。成对工作时，您将通过更简洁的设计和更少的代码行来解决问题

**消除知识孤岛**：通过轮换对，您将在整个团队中学习应用程序和领域业务知识。该团队不太可能被阻止，因为 Sue 去度假了，没有其他人知道她的代码。

**技能传授：**当他们一起工作时，轮换的两人互相传授新技能（工程和领域）。每个人的团队水平都会提高，知识会通过团队传播。

**团队自我选择：**团队学习一个花药的技能，并迅速淘汰表现不佳的人。

# sdk - 如何学习新的 SDK/API/库？

> ID：564883
> 
> 赞同：8
> 
> 时间：2009-02-19T11:34:32.203
> 
> 标签：sdk

假设您必须实现一些重要的功能（至少需要 1 个工作周）。您有一个 SDK/API/库，其中包含（大量）代码示例，演示了 SDK 部分用于实现该功能的用法。

您如何学习所有样本，提取必要的信息、技术等，以便使用它们来实现“真实的东西”。关键问题是：

*   您是否使用一些工具来绘制控制流、SDK 中的功能之间的交互以及示例本身？你觉得哪种图表有用？（在这种情况下，我认为 UML 序列图与调试器一起非常有用）。

*   您如何在必须用作参考的示例程序中保留有关 SDK/API 函数调用、一般结构和调用顺序的相关且经常相互关联的信息 - 思维导图、一些纯文本注释、示例代码中的添加注释, 对示例代码进行一些重构以适合您的个人编码风格以使学习更容易？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T11:40:37.553

我个人使用原型设计方法。将开发保持在可管理的迭代中。一开始，这些迭代非常小。作为其中的一部分，不要害怕扔掉代码并重新开始（每次我说项目经理在某个地方心脏病发作）。

如果您的特定任务不能轻松或合理地划分为非常小的起始任务，那么从一些替代品开始，直到您开始。

你想让它尽可能简单（众所周知的“Hello world”）只是为了让自己熟悉构建、部署、调试、错误消息的样子、一开始可能出错的简单事情等等。

抱歉，我没有使用图表工具（我几乎看不出这对我的工作有什么意义）。

一旦你开始尝试一些事情，你就会掌握它的窍门，即使一开始你不知道发生了什么以及为什么你正在做的事情有效（或无效）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T11:42:27.050

我通常会编译和修改示例，使它们适合我自己需要做的事情。我倾向于在使用和注释相应的文档时这样做。作为一个有点老派的人，我通常用于绘制图表的工具是铅笔，或者用于真正复杂的东西的两支或更多彩色笔。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-26T01:26:22.947

我绝不是一个经验丰富的程序员。事实上，我正在学习 C++，而且我主要从书本上学习这门语言。例如，当我试图偏离书本时（这种情况经常发生，因为我想开始为 LibreOffice 之类的程序做出贡献），我发现自己迷失了方向。此外，当我使用库的功能时，我的实现是错误的，因为我并不真正了解库是如何创建的和/或为什么需要这样做。当我查看示例源代码时，我看到了一些事情是如何完成的，但我不明白为什么这样做会导致我的程序设计不佳。结果，我不断地猜测如何做某事并在遇到错误时处理它们。非常低效和令人沮丧。

回到我的书评，我不止一次地从头到尾准备好两本书，分别是 Ivor Horton 的《Beginning Visual C++ 2010》和《从 C++ 开始：早期对象（第 7 版）》。我真正喜欢 Ivor Horton 的书的地方在于，它包含对为什么需要以某种方式完成某事的详尽解释。例如，在开始任何 Windows 编程之前，首先给出了很多关于 Windows 工作原理的解释。了解事物如何以及为什么以某种方式工作确实有助于我开发软件。

所以贡献我的两分钱来回答你的问题。我认为最好的方法是拿起写得很好的书，坐下来开始学习图书馆、API、SDK，无论是结构化的方法，提供真实世界的例子，并解释事物是如何以及为什么实现的是。

我不知道我是否完全错过了你的问题，但我想我没有。

干杯!

这是我在这个网站上的第一篇文章。不要太用力地撕扯我。（：

# sql-server - IsUnique=Yes 的唯一键和索引有什么区别？

> ID：564895
> 
> 赞同：51
> 
> 时间：2009-02-19T11:39:58.833
> 
> 标签：sql-server, database

我有一个带有主键的表，但我希望限制另外两列，因此保证两者的组合始终是唯一的。

（一个愚蠢的例子：在 BOOKS 表中，IBAN 列是主键，但 Title 和 Author 列的组合也应该始终是唯一的。）

在 SQL Server Management Studio 中，可以创建一个新索引并将 IsUnique 设置为 Yes，或者我可以创建一个新的唯一键。

这两种方法有什么区别，哪一种最适合哪种目的？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-19T11:47:35.913

创建一个 UNIQUE 约束是对规则的更清晰的陈述。索引的 IsUnique 属性是一个实现细节——规则是**如何**实现的，而不是规则是**什么**。不过效果是一样的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-19T21:26:31.840

两者之间有明显的区别。唯一约束定义了哪些列组合必须是唯一的。唯一索引只是确保上述内容始终有效的一种方式。但是可能有一个支持唯一约束的非唯一索引。（如果约束是可延迟的=仅在提交时有效，但允许在事务中间被破坏）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-19T13:59:12.760

只是让您知道，当您创建唯一约束时，SQL Server 将在幕后创建索引

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-04-19T21:45:39.980

我刚刚发现困难的一件事是，在 SSMS 中，唯一键的脚本默认设置为 true，但索引的脚本设置为 False。当我使用 SSMS 中的 Script Table As 上下文菜单时，我没有得到我的唯一索引。

此外，如果类型设置为唯一键，则无法更改“忽略重复键”设置。首先，您将类型从唯一键更改为索引，然后您可以将忽略重复键设置为 true。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T11:42:17.800

唯一索引是唯一键。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-12-21T02:30:12.483

我认为它们之间没有任何区别，但是使用唯一索引，我们可以有两个好处，因为该列已经是唯一的并且上面也有索引，所以我会更快地搜索。所以使用唯一索引更有好处。

# java - 选择具有预期数量的唯一值和插入的 HashSet 的初始容量

> ID：564899
> 
> 赞同：16
> 
> 时间：2009-02-19T11:40:48.177
> 
> 标签：java, set

好的，这是我的情况：

我有一个状态数组，其中可能包含重复项。为了摆脱重复，我可以将它们全部添加到一个集合中。

但是，当我创建 Set 时，它希望定义初始容量和负载因子，但是应该将它们设置为什么？

从谷歌搜索，我想出了：

```
String[] allStates = getAllStates();
Set<String> uniqueStates = new HashSet<String>(allStates.length, 0.75); 
```

问题在于 allStates 可以包含 1 到 5000 个状态。因此 Set 的容量将超过 5000，但最多只能包含 50 个。

因此，或者将 Set 的最大大小设置为最大状态数，并将负载因子设置为 1。

我想我的问题真的是：

*   当您不知道 Set 中有多少项目时，您应该将初始容量设置为多少？
*   当它可以包含的最多是 50 时，它设置为什么真的很重要吗？
*   我什至应该担心它吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-19T13:14:26.750

假设您知道不会超过 50 个州（您是指美国的州吗？），则

```
Set<String> uniqueStates = new HashSet<String>(allStates.length, 0.75); 
```

引用肯定是错误的。我建议您选择 50 / 0.75 = 67 的初始容量，或者为了安全起见可能是 68。

我也觉得有必要指出你可能过度思考了这一点。将 arraylist 的大小从 16 调整到 64 两次不会给您带来明显的性能影响，除非这恰好在程序的最关键性能部分中。

所以最好的答案可能是使用：

```
new HashSet<String>(); 
```

这样一来，您就不会在一年后回来并疑惑为什么选择如此奇怪的构造函数参数。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T11:45:18.323

使用不需要指定这些值的[构造函数，然后选择合理的默认值。](http://java.sun.com/j2se/1.5.0/docs/api/java/util/HashSet.html#HashSet())

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-05-29T18:27:30.003

首先，我要说的是，在你的情况下，你肯定是想多了。但是，在某些情况下，人们可能想要正确处理它。所以这就是我的理解：

1）您可以在 HashSet 中保存的项目数 = 初始容量 x 负载因子。因此，如果您希望能够容纳 n 个项目，则需要执行[Zarkonnen](https://stackoverflow.com/users/15255/zarkonnen)所做的操作，并将 n 除以负载因子。

[2) 在幕后，每个 Oracle 教程](http://docs.oracle.com/javase/tutorial/collections/implementations/set.html)的初始容量四舍五入为 2 的幂。

[3) 如Tom Hawtin-tackline](https://stackoverflow.com/users/4725/tom-hawtin-tackline)所述，负载系数不应超过 0.80 以防止过度碰撞。

如果您只接受默认值（初始容量 = 16，负载系数 = 0.75），那么您最终的尺寸将增加一倍 3 倍。（初始最大尺寸 = 12，第一次增加使容量 32 和最大尺寸 24（32 * .75），第二次增加使容量 64 和最大尺寸 48（64 * .75），第三次增加使容量 128 和最大尺寸 96（128 * .75).)

要使您的最大尺寸接近 50，但要使集合尽可能小，请考虑 64（2 的幂）的初始容量和 0.79 或更高的负载系数。64 * .79 = 50.56，所以你可以得到所有 50 个州。指定 32 < 初始容量 < 64 将导致初始容量向上舍入为 64，因此这与预先指定 64 相同。指定初始容量 <= 32 将导致大小增加。除非您的初始容量 > 64，否则使用 < .79 的负载因子也会导致大小增加。

所以我的建议是指定初始容量 = 64 和负载因子 = .79。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T12:12:55.060

安全的赌注是选择太小的尺寸。

因为调整大小可以通过指数增长算法得到改善（参见几周前的 stackoverflow 播客），所以变小永远不会花费你那么多。如果你有很多套（你很幸运），那么如果它们过大，那么性能就会很重要。

负载因子是一个棘手的问题。我建议将其保留为默认值。我了解：低于 0.70f 您会使阵列太大，因此速度较慢。高于 0.80f，您将开始遇到许多关键冲突。据推测，探测算法将需要比桶算法更低的负载因子。

另请注意，“初始容量”的含义与大多数人认为的略有不同。它指的是数组中的条目数。要获得许多元素的确切容量，请除以所需的负载因子（并适当地四舍五入）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T11:46:03.610

做一个很好的猜测。没有硬性规定。如果您知道可能有 10-20 个州，我会从这个数字（20）开始。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T14:20:39.760

我第二扎科宁。你的最后一个问题是最重要的。如果这恰好发生在您的应用程序的热点中，那么可能值得努力查看并尝试优化，否则 CPU 周期比烧毁自己的神经元要便宜。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-12-28T17:22:12.293

如果您要对此进行优化 - 并且这样做可能是合适的 - 您的某些决定将取决于您希望数组具有多少重复项。

*   如果有很多重复项，您将需要较小的初始容量。迭代时，大而稀疏的哈希表很糟糕。

*   如果预计不会有很多重复，您将需要一个初始容量，以便整个阵列无需调整大小即可容纳。

我的猜测是你想要后者，但如果你追求这个，这是值得考虑的事情。

# sql-server - 使用内部连接更新到相同的表优化

> ID：564902
> 
> 赞同：1
> 
> 时间：2009-02-19T11:41:46.180
> 
> 标签：sql-server

查询是：

```
CREATE TABLE logfile (
   sequence_number BIGINT,
   start_time DECIMAL,
   finish_time DECIMAL,
   irp_major VARCHAR(100),
   offset BIGINT,
   length BIGINT,
   filename VARCHAR(2000),
   is_seq BIT 
   );
//bulk insert 120 000 rows
CREATE CLUSTERED INDEX IX_logfile ON logfile(sequence_number); 
UPDATE dbo.logfile SET is_seq = (
SELECT  CASE WHEN a.offset = (b.offset + b.length) THEN 1 ELSE 0 END AS seq
FROM    dbo.logfile a
        LEFT JOIN dbo.logfile b
            ON a.sequence_number = b.sequence_number + 1
WHERE a.sequence_number = logfile.sequence_number) 
```

无论如何我可以提高更新查询的性能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T11:47:19.830

```
MERGE
INTO logfile l
USING (
  SELECT sequence_number + 1 AS pseq,
         p.*
  FROM logfile p
) pl
ON l.sequence_number = pseq
WHEN MATCHED THEN
  UPDATE
  SET is_seq = CASE WHEN l.offset = (pl.offset + pl.length) THEN 1 ELSE 0 END 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T11:52:48.540

也许这个更新会更快

```
UPDATE dbo.LogFile SET is_seq = 0
UPDATE dbo.LogFile SET is_seq = 1
FROM dbo.LogFile f
     INNER JOIN (
       SELECT f2.sequence_number
       FROM dbo.LogFile f1
            INNER JOIN dbo.LogFile f2 ON f2.sequence_number = f1.sequence_number + 1     
       WHERE f1.Offset <> f2.Offset + f2.Length
     ) f2 ON f2.sequence_number = f.sequence_number 
```

# java - ConcurrentLinkedQueue#poll() 会阻塞吗？

> ID：564903
> 
> 赞同：2
> 
> 时间：2009-02-19T11:42:11.433
> 
> 标签：java, concurrency

我的线程永远运行并在 ConcurrentLinkedQueue#peek() 之后调用 ConcurrentLinkedQueue#poll()。

但在某些情况下，线程似乎挂起。我知道这有点含糊，但人们可以为我确认 poll() 或 peek() 方法**永远不会**阻塞。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T12:04:41.537

据我所知，[ConcurrentLinkedQueue](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html)是一个“无需等待”的实现。

所以我必须假设每次独立调用`poll()`或`peek()`永远**不会阻塞**。

此集合上的原子操作是同步的，并且保证对队列的每个单独调用都是线程安全的。

你的代码一定有问题。例如，如果你这样做：

```
Object obj;

if (queue.peek() != null)
   obj = queue.poll() 
```

不garentee那`obj`将不会`null`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T12:02:46.923

根据 Javadoc，似乎 peek() 和 poll() 永远不应该阻塞。我进行了快速的生产者/消费者测试，并且没有遇到任何阻塞。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:10:05.487

我不相信你的问题是由于这个，但 poll() 和 peek() 可以（至少在理论上）阻止：

顾名思义，ConcurrentLinkedQueue 实现为链表。在轮询或窥视时，实现尝试从头部开始并遍历链接的节点，试图找到一个没有被删除的节点。如果找到一个非空节点，则返回该节点，如果到达末尾，则返回队列为空，但如果找到已删除节点，则重试。

所以考虑这个序列。P是生产者线程，我们有两个消费者线程C1和C2：

```
P:  queue.add()
C1: starts queue.poll(), begins to inspect first node
C2: completes a queue.poll() removing the item.
P:  queue.add()
C1: continues inspecting the first node, notes that it is deleted. 
      Restarts and begins to inspect the new first node.
C2: completes a queue.poll() removing the item.
P:  queue.add()
C1: continues inspecting the first node, notes that it is deleted. 
      Restarts and begins to inspect the new first node.
etc. 
```

所以 poll() 和 peek() 会阻塞，直到它们可以确定队列是否为空。

但是除非您使用一些非常奇怪的线程优先级，否则这种情况**极**不可能发生，我建议您在别处寻找您的错误。

# sql - 尝试使用 xp_cmdshell 移动文件时访问被拒绝

> ID：564907
> 
> 赞同：2
> 
> 时间：2009-02-19T11:42:28.470
> 
> 标签：sql, sql-server-2005, tsql, command-line, windows-server-2003

我试图使用一些 T-SQL 将一些文件从一个目录移动到另一个目录。我使用 xp_cmdshell 来调用移动命令就像这样：

```
create table #output(line varchar(2000) null)
insert into #output exec master..xp_cmdshell 'move /y "D:\files\*.txt" "D:\oldfiles"' 
```

但是文件 inst move 和 #output 表包含来自 move 命令的输出

```
Access is denied.
Access is denied.
Access is denied.
Access is denied.
Access is denied.
Access is denied.
        0 file(s) moved.
NULL 
```

sql server 代理帐户映射到本地管理员如果我在输入移动命令时打开命令提示符

```
move /y "D:\files\*.txt" "D:\oldfiles" 
```

文件完美移动

这一切都发生在运行在 w2k3 服务器上的 sql2005 上。

我以本地管理员身份登录服务器

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-19T11:47:52.810

你能运行一个“我是谁？” 命令，像这样：

```
exec master..xp_cmdshell 'whoami' 
```

并告诉这会返回什么？

**编辑：**

*   根据 OP 的评论，命令运行为`NETWORK SERVICE`. 允许`NETWORK SERVICE`有问题的目录解决了这个问题。

*   “修改”权限足以用于文件更改。

*   如果文件位于网络共享而不是本地驱动器上，请确保在共享本身上也设置了足够的权限。共享权限后检查文件权限，因此如果文件允许“修改”，但共享只允许“读取”，则整体权限仍将是“读取”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-11-21T09:24:18.417

如上所述，它错过了许可。另一种简单的方法是尽可能通过 xp_cmdshell 创建文件夹。如果是根目录，则无法应用。

```
exec xp_cmdshell 'mkdir d:\files'
exec xp_cmdshell 'mkdir d:\oldfiles' 
```

它确保文件夹具有适当的权限。

# asp.net - 共享服务器上的 FSharp 站点，我需要在 bin 文件夹中包含哪些 dll？

> ID：564908
> 
> 赞同：0
> 
> 时间：2009-02-19T11:42:32.277
> 
> 标签：asp.net, f#

我需要在 bin 文件夹中包含哪些 dll？还是我需要在自己的服务器上安装 F#？

注意： **已解决**

*   所有 FSharp dll 现在都在站点 Bin 中
*   该站点是使用 Visual Studio 中的“发布”选项部署的
    *   必须**取消选中****允许预编译站点可更新**的选项

 **来自我的网站的错误：

**该系统找不到指定的文件**

**说明**：执行当前 Web 请求期间发生未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。

**异常详细信息**：System.ComponentModel.Win32Exception：系统找不到指定的文件

**源错误**：

在执行当前 Web 请求期间生成了未处理的异常。可以使用下面的异常堆栈跟踪来识别有关异常起源和位置的信息。

**堆栈跟踪**：

```
[Win32Exception (0x80004005): The system cannot find the file specified]
   System.Diagnostics.Process.StartWithCreateProcess(ProcessStartInfo startInfo) +2097
   System.Diagnostics.Process.Start() +140
   Microsoft.FSharp.Compiler.CodeDom.Internal.Compiler.compileFiles(String args, CompilerResults res) +120
   Microsoft.FSharp.Compiler.CodeDom.Internal.Compiler.compileAssemblyFromFileBatch(CompilerParameters options, String[] fileNames, CompilerResults results, FastFunc`2 sortf) +278
   System.CodeDom.Compiler.CodeDomProvider.CompileAssemblyFromFile(CompilerParameters options, String[] fileNames) +23
   System.Web.Compilation.AssemblyBuilder.Compile() +843
   System.Web.Compilation.BuildProvidersCompiler.PerformBuild() +164
   System.Web.Compilation.BuildManager.CompileWebFile(VirtualPath virtualPath) +267
   System.Web.Compilation.BuildManager.GetVPathBuildResultInternal(VirtualPath virtualPath, Boolean noBuild, Boolean allowCrossApp, Boolean allowBuildInPrecompile) +582
   System.Web.Compilation.BuildManager.GetVPathBuildResultWithNoAssert(HttpContext context, VirtualPath virtualPath, Boolean noBuild, Boolean allowCrossApp, Boolean allowBuildInPrecompile) +93
   System.Web.UI.BaseTemplateParser.GetReferencedType(VirtualPath virtualPath, Boolean allowNoCompile) +325
   System.Web.UI.PageParser.EnsureMasterPageFileFromConfigApplied() +89
   System.Web.UI.PageParser.HandlePostParse() +16
   System.Web.UI.TemplateParser.Parse() +155
   System.Web.Compilation.BaseTemplateBuildProvider.get_CodeCompilerType() +105
   System.Web.Compilation.BuildProvider.GetCompilerTypeFromBuildProvider(BuildProvider buildProvider) +54
   System.Web.Compilation.BuildProvidersCompiler.ProcessBuildProviders() +182
   System.Web.Compilation.BuildProvidersCompiler.PerformBuild() +29
   System.Web.Compilation.BuildManager.CompileWebFile(VirtualPath virtualPath) +267
   System.Web.Compilation.BuildManager.GetVPathBuildResultInternal(VirtualPath virtualPath, Boolean noBuild, Boolean allowCrossApp, Boolean allowBuildInPrecompile) +582
   System.Web.Compilation.BuildManager.GetVPathBuildResultWithNoAssert(HttpContext context, VirtualPath virtualPath, Boolean noBuild, Boolean allowCrossApp, Boolean allowBuildInPrecompile) +93
   System.Web.Compilation.BuildManager.GetVirtualPathObjectFactory(VirtualPath virtualPath, HttpContext context, Boolean allowCrossApp, Boolean noAssert) +111
   System.Web.Compilation.BuildManager.CreateInstanceFromVirtualPath(VirtualPath virtualPath, Type requiredBaseType, HttpContext context, Boolean allowCrossApp, Boolean noAssert) +54
   System.Web.UI.PageHandlerFactory.GetHandlerHelper(HttpContext context, String requestType, VirtualPath virtualPath, String physicalPath) +31
   System.Web.UI.PageHandlerFactory.System.Web.IHttpHandlerFactory2.GetHandler(HttpContext context, String requestType, VirtualPath virtualPath, String physicalPath) +40
   System.Web.HttpApplication.MapHttpHandler(HttpContext context, String requestType, VirtualPath path, String pathTranslated, Boolean useAppConfig) +139
   System.Web.MapHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute() +128
   System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean& completedSynchronously) +161 
```

版本信息：Microsoft .NET Framework 版本：2.0.50727.1433；ASP.NET 版本：2.0.50727.1433

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T12:20:57.973

在服务器上安装 F# 肯定会解决您的问题，但并非绝对必要。您肯定会获得对 FSharp.core.dll 的依赖，如果您从项目中引用了 FSharp.PowerPack.dll 以及您可能会引用的任何其他 FSharp.*.dll，您可能还会获得对 FSharp.PowerPack.dll 的依赖有参考。您通常可以使用反射器来查找您的应用程序所依赖的 dll。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:28:45.193

如果您使用 aspnet_compiler.exe 工具（或使用 Visual Studio 中的发布按钮）“预编译”网站而不将其编译为“可更新”（意味着所有 ASPX 和 FS 文件都必须编译成 DLL），那么我认为你只需要：

*   FSharp.Core.dll（包含核心 F# 库、列表、元组等）
*   可能是 FSharp.PowerPack.dll （正如罗伯特提到的）

运行时不需要来自 F# 安装的其他 DLL。如果您想在服务器上编译 Web 应用程序（使用 F# CodeDOM）（即，将其部署为可更新的网站），那么您需要在服务器上安装 F#，并且您需要生成“fsc”的权限.exe”（所以这看起来不像共享服务器的情况）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:40:40.093

我可以通过取消选中允许此预编译站点可更新并将所有 dll 包含在目录中来解决此问题。

感谢您的建议。

# java - 如何在 Eclipse 中打印到 textArea 而不是控制台？

> ID：564913
> 
> 赞同：1
> 
> 时间：2009-02-19T11:44:45.127
> 
> 标签：java, eclipse

我目前有一个程序，它以各种方式将文本行打印到屏幕上，例如“System.out.println()”语句，并将数组中的所有元素循环打印到屏幕上。

我现在在一个单独的类中向这个程序添加一个 GUI。我的问题是我想将打印到 Eclipse 控制台的所有内容打印到我的 GUI 中的文本框。这可能吗？如果可以，我将如何去做。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-24T09:39:53.420

如果您真的想这样做，请将 System OutputStream 设置为 PipedOutputStream 并将其连接到您从中读取的 PipedInputStream 以将文本添加到您的组件，例如：

```
PipedOutputStream pOut = new PipedOutputStream();
System.setOut(new PrintStream(pOut));
PipedInputStream pIn = new PipedInputStream(pOut);
BufferedReader reader = new BufferedReader(new InputStreamReader(pIn)); 
```

然后，您可以从阅读器中读取并将其写入您的文本组件，例如：

```
while(appRunning) {
    try {
        String line = reader.readLine();
        if(line != null) {
            // Write line to component
        }
    } catch (IOException ex) {
        // Handle ex
    }
} 
```

我建议您不要将 System.out 用于您的应用程序输出，它可以被任何东西使用（例如，您决定使用的任何第三方库）。我会使用某种类型的日志记录（java.util.logging、Log4J 等）和适当的附加程序来写入您的组件。

# sharepoint - 在一个 SharePoint Web 中创建多个“帖子”列表

> ID：564914
> 
> 赞同：1
> 
> 时间：2009-02-19T11:44:57.620
> 
> 标签：sharepoint, blogs

是否可以在单个 SharePoint 网站中创建多个 SharePoint 列表。我们不想为每个博客站点创建单独的子网站。关于如何实现这一点的任何指示都会非常有帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T18:47:33.907

这是无法做到的。Posts 列表的 ContentType 限制每个站点只能创建一个。

# database-design - 私信设计

> ID：564917
> 
> 赞同：4
> 
> 时间：2009-02-19T11:46:17.773
> 
> 标签：database-design

我正在开发一个新网站，我必须为我们的用户发送私人消息。我已经在其他项目上做过这个，但是那里的设计似乎不正确（例如，我不能让两个以上的人参与一条消息）。那么什么是“正确”的方法呢？我想为我的用户提供与 Facebook 相同的功能（同样，我已经这样做了，但感觉很脏:)）所以系统应该支持 2 个或更多用户进行对话和类似线程的消息。

我在想，一种解决方案是有两个这样的表：

pm_messages：id | pm_messages_id |user_id | 标题 | 内容 | 约会时间

pm_recipients：id | pm_messages_id | 用户 ID | 看过| 已删除

我会将实际内容存储在“pm_messages”表中，并将收件人（包括原始发件人）存储在“pm_recipients”表中。

这是正确的方向还是我完全不同意？这里困扰我的是，在所有收件人都删除了导致一些尴尬的删除逻辑之前，消息并没有真正被删除。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T12:02:40.917

如果可以有多个收件人，并且他们可以发送回复消息，那么您更多的是处理某种聊天应用程序。您可以将“聊天”会话或对话存储在单独的表格中，其中对话和参与者之间的关系为 1-n，对话和消息之间的关系为 1-n（下表列出）。但最终，这当然取决于你。对于常规消息发送，您使用的消息和收件人之间的 1-n 即可。

```
table user:
- id (pk)
- name

table conversation (one entry per "chat/messaging" session)
- id (pk)
- started_by_user_id
- started_ts

table conversation_participant (keeps track of all recipients)
- id (pk)
- conversation_id
- user_id (refers to user.id)

table message
- id
- conversation_id (refers to conversation.id)
- sender (refers to user.id)
- msg 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:01:55.880

我不会说您在帖子中提出的实施一定是一个糟糕的实施。当然，它不是最简洁或最快的，但在我看来，它似乎是人类最容易理解的。此外，删除逻辑不应该很难封装。

我可能建议的一种解决方案是使用一个存储每条消息的表，其中包含发件人 ID 字段和另一个字段，即收件人 ID 列表。当然，问题在于决定如何使用标准数据库类型之一来表示 ID 列表，因为通常没有数组/向量/列表类型。我建议您使用 VARBINARY(max) 类型（如果可用），将其视为位向量（例如，每个收件人 ID 4 个字节）。然后，您可以创建几个函数来对数组/列表进行非常简单的按位编码/解码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T12:12:27.587

pm_messages 表中的 pm_messages_id 列是做什么用的？

否则它是有道理的......但我不明白为什么删除逻辑应该很尴尬。您可以通过以下两种方式之一来处理它：

1.  用户删除后：如果没有更多收件人，则删除。
2.  作为 cron 任务或稍后手动执行：没有理由需要立即进行此删除。它们只是孤儿记录，很容易找到：

例如：

```
DELETE FROM pm_messages
RIGHT JOIN pm_recipients ON pm_messages.id = pm_recipients.pm_messages_id 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-25T20:56:44.800

还有一个需要考虑的用例（我知道我的用户想要这个）......他们都想要一个“已发送的项目”。可以这么说，在您打扫房间之前可能要考虑该用例。

> 这里困扰我的是，在所有收件人都删除了导致一些尴尬的删除逻辑之前，消息并没有真正被删除。

创建一个为您执行此操作的触发器。您的应用程序代码需要做的就是担心将您的“已删除”列设置为 true，并在每个人都将消息标记为已删除时让 UPDATE 触发器破坏整个交易。

当然，接下来您知道，您的用户将希望取消删除。就个人而言，我永远不会从数据库中删除消息，只是对用户隐藏它。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-19T12:44:01.863

（评论太长了）

Tehvans 方法涉及存储特定对话的参与者列表，而在您的方法中，参与者是按消息存储的。我希望这样做的原因是允许删除和读取标记，问题是 - 为什么会这样？

论坛通常不要求您将对话的每个部分都标记为已读，因此在参与者表中存储一个 last_read 时间戳，这样在时间戳之后创建/修改的任何消息都可以突出显示。

在（几乎）所有情况下，论坛消息的删除都是由作者/管理员完成的，并导致消息从所有用户的视图中删除。

# c# - ASP.Net 中的组织结构图

> ID：564918
> 
> 赞同：0
> 
> 时间：2009-02-19T11:46:24.140
> 
> 标签：c#

我正在尝试探索 ASP.net 中的其他选项以在不使用任何第三方工具的情况下创建组织结构图。我正在为我的 ASP.net 页面使用 C#。我想要一些想法/代码来实现一个简单的组织结构图。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T11:56:10.090

您可以使用CodeProject 上的[树形图生成器。](http://www.codeproject.com/KB/cs/TreeGenerator.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-04-23T07:50:53.737

示例表结构在这里： [http ://unifosys.com/hierarchy-chart/Create_Organization_Chart_from_Database_Sample.html](http://unifosys.com/hierarchy-chart/Create_Organization_Chart_from_Database_Sample.html)

# sql - SQL 查询中的 NOT(x > y) 和 (x < y) 有什么区别？

> ID：564920
> 
> 赞同：4
> 
> 时间：2009-02-19T11:47:09.240
> 
> 标签：sql

以下查询有什么区别：

```
SELECT * FROM employee  WHERE NOT(start_date > '01-JAN-1970'); 
```

这个查询：

```
SELECT * FROM employee  WHERE start_date < '01-JAN-1970'; 
```

有什么区别吗，如果有，`NOT(x > y)`使用方式与`(x < y)`. 谁能提供一个例子？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-19T11:55:19.343

在`MySQL`和`PostgreSQL`

```
SELECT * FROM employee WHERE not(start_date > '01-JAN-1970') 
```

不会使用`INDEX`on`start_date`如果有的话，他们的优化器不够聪明。

`not(start_date >= '01-JAN-1970')`否则，如果您在其中一种情况（或或）中更正条件不严格`start_date <= '01-JAN-1970'`，则查询是相等的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T11:54:46.210

非不等价的

```
SELECT * FROM employee WHERE not(start_date > '01-JAN-1970'); 
```

是

```
SELECT * FROM employee WHERE start_date <= '01-JAN-1970'; 
```

不是

```
SELECT * FROM employee WHERE start_date < '01-JAN-1970'; 
```

因为那会错过 start_date = '01-JAN-1970' 的情况

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T11:50:26.687

除了显而易见的`not(start_date > '01-JAN-1970')`包括*Jan* 1, 1970 而`start_date < '01-JAN-1970'`排除*它*之外，我认为这些陈述是相同的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T11:52:08.370

NOT() 只是对括号内的任何内容的否定。在您的示例中：

```
SELECT * FROM employee WHERE not(start_date > '01-JAN-1970'); 
```

这将匹配开始日期早于 1970 年的员工。是的，在这种情况下，您可以反转 <> 括号以否定它，但在更复杂的情况下或使用其他运算符 NOT 是翻转它的唯一方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-19T12:17:19.073

在您的示例中，这两个子句非常等效-但是如果您希望它们返回完全相同的结果，那么您应该使用`<`and `>=`（或`<=`and `>`）而不是同时使用`<`and `>`。

`NOT`当您有基于集合的子句时，它变得更加有用。例如：

```
SELECT * FROM my_table
WHERE my_column NOT IN (273, 430, 9567, 8, 433, 765, 6252, 13)

SELECT * FROM my_table
WHERE my_column NOT IN (SELECT another_column FROM another_table) 
```

不使用`NOT`这些查询充其量会变得很麻烦，或者最坏的情况是不可能的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-19T12:34:18.767

在这里忽略任何特定于 SQL 的内容，但从逻辑的角度来看，< 的否定是 >=（同样，> 的否定是 <=），所以 (x > y) 和 !(x < y) 不是相等的。

当您使用诸如“什么不小于 Y？”之类的简单示例时，这一点很明显。答案是“Y 和它上面的一切”；

!(x < y) == (x >= y)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T11:51:03.333

not start_date > '01-JAN-1970' 意味着开始日期可以等于 '01-JAN-1970' start_date < '01-JAN-1970' 意味着开始日期为 '01-JAN-1970' 的员工不是选择

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T11:56:46.300

您忘记了 start_date == '01-JAN-1970' 的行；-)

```
SELECT * FROM employee WHERE start_date <= '01-JAN-1970'; 
```

# asp.net - 网址重写

> ID：564921
> 
> 赞同：1
> 
> 时间：2009-02-19T11:47:13.233
> 
> 标签：asp.net, .net-2.0

我正在使用 regx 进行 URL 重写。创建了一个 XML 文件并在 Global.ASAX 文件中编写以下代码

字符串 sPath = Context.Request.Path;

```
 Context.Items["VirtualURL"] = sPath;
    Regex oReg;
    System.Xml.XmlDocument xmlDoc = new System.Xml.XmlDocument();
    xmlDoc.Load(Server.MapPath("~/Rule.xml"));
    System.Xml.XmlElement _oRules = xmlDoc.DocumentElement;

    foreach (System.Xml.XmlNode oNode in _oRules.SelectNodes("rule"))
    {
        oReg = new Regex(oNode.SelectSingleNode("url/text()").Value);

        Match oMatch = oReg.Match(sPath);

        if (oMatch.Success)
        {
            sPath = oReg.Replace(sPath,
              oNode.SelectSingleNode("rewrite/text()").Value);
            break;
        }
    }
    Context.RewritePath(sPath); 
```

虚拟 URL 为 /ProductDatabaseCMS/Category/Product/A320.aspx

原始 URL 是 /ProductDatabaseCMS/Product.aspx?PROD_ID=A320

product.aspx 使用具有路径 /ProductDatabaseCMS/Main.master 的母版页，它通过路径 /ProductDatabaseCMS/App_Themes/Styles/Styles.css 包含样式表

当我尝试使用超链接控件通过其他网页打开 product.aspx 页面时，样式表在 product.aspx 页面中不起作用，因为它需要路径

/ProductDatabaseCMS/Category/Product/App_Themes/Styles/Styles.css 和母版页中的所有链接也采用相同的路径

/ProductDatabaseCMS/类别/产品/...

我不想包含 /Category/Product/.. 因为这两个文件夹路径是虚拟的。

什么是解决方案。

* * *

**欺骗：[URL重写](https://stackoverflow.com/questions/556240/url-rewriting)**

（答案：使用根相对路径）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T11:52:36.683

请查看重写器的配置/规则会有所帮助。

我怀疑您只需要在重写规则的顶部停止处理任何以 .css 结尾的 URL。

在不知道您使用的是哪个重写器的情况下，我无法给出任何示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T12:01:47.330

我同意 teknohippy，图像是否也不起作用或只是样式表？我假设样式表没有在服务器上运行？

您可以使用在服务器上运行的带有 ~/ url 的 rel 标记来加载样式表，或者只是使您的重写规则仅适用于特定文件类型。

重写规则更改可能是最好的，但您可能会发现 rel 标签更快？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-20T20:18:51.890

~/yourpathtoyourcss.css

蒂尔达大刀阔斧

# html - 查找和替换以及所见即所得的编辑器

> ID：564928
> 
> 赞同：1
> 
> 时间：2009-02-19T11:48:09.890
> 
> 标签：html, text

我的问题如下：

我有一个专栏：ProductName。现在，这里输入的文本是从 tinyMCE 输入的，所以它有各种标签。用户希望能够对所有产品进行查找和替换，并且它必须支持着色。

例如 - 假设这是 ProductName 的一部分：

> 其他文字.. `<strong>text text <font color="#ff6600">colortext&reg;</font></strong>`..其他文字

现在，用户想要替换：

```
<font color="#ff6600">colortext&reg;</font> 
```

原始名称中包含`<strong>`标签，因此显示为粗体。所以用户把它加粗 - 现在他正在搜索的文本是：

```
<strong><font color="#ff6600">colortext&reg;</font></strong> 
```

显然我不会找到它。另外还有空间的问题：在一个地方它有一个空间，而在另一个地方却没有。

有没有办法克服这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T15:33:48.077

从搜索文本中去除 HTML 标签并首先进行纯文本搜索。然后，逐个部分（即逐个文本节点的文本节点），获取搜索文本部分的元素路径，并将它们与找到的文本中的对应部分进行比较。如果所有部分的路径都匹配，那么您就完成了。

**编辑**：通过路径，我的意思是类似于 XPath 或 TinyMCE 编辑器的路径概念。示例：搜索文本的纯文本部分是“colortext®”。此文本节点在搜索文本中的路径是`<strong>/<font color="#ff6600">`。在文本正文中搜索相同的纯文本（平凡），并取它的路径，也就是`<strong>/<font color="#ff6600">`. （比较一下“其他文本..”的路径，即`/`，和“文本文本”的路径，即`<strong>`。）这两个路径是相同的，所以这是一个真正的匹配。如果您有 DOM 树表示，确定路径应该不难。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T15:45:57.700

如果它是有效的 XML，那么 XSLT 对于这种练习将是微不足道的。使用标识模板，然后添加 XPath 以查找所需的特定节点：

```
<xsl:template match="//strong/font">
    <xsl:copy>
        <!-- Insert the replacement text here -->
    </xsl:copy>
</xsl:template> 
```

在使用 XML 时，这将是一个可维护、可扩展的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T15:58:56.393

您要求几个相关但离散的能力：

*   搜索和替换内容
*   搜索和替换格式
*   搜索和替换相似（即忽略空格中的细微差别）

您应该分步进行 - 否则它会变得不堪重负，并且单个搜索算法将无法在不付出巨大努力的情况下完成所有这三个操作，并导致难以维护代码。

首先，看类似的问题。进行忽略空格和大小写的搜索。如果您还需要处理“碗”与“碗”以及“智能”与“智能”，您可能想要进入 Lucene 或其他搜索引擎技术——尽管我预计这超出了您当前的需求。

一旦你完成了这项工作，它就会成为你搜索堆栈中的一层。

其次，看一下格式搜索。这通常使用标记或标签来完成 - 您已经以 HTML 的形式拥有。但是，您必须能够处理乱序的事情——因此`<b><i>text</i></b>`需要在搜索中`<i><b>text</b></i>`发现标签未正确嵌套的格式错误的表示，例如`<b><i>text</b></i>`.

一种方法是预先解析字符串并将格式化样式应用于每个字符。因此，您将拥有粗体和斜体、粗体和斜体的 e 等，以使这更容易和更快地使用散列来表示样式组合 - 阅读第一个字符，找出它是什么样式（跟踪这会打开和关闭样式，然后您会找到标签），如果它已经存在于哈希中，则将该哈希编号分配给该字母。如果没有，请获取新的哈希号并分配它。

现在您可以将字母及其样式哈希与您的搜索进行比较，并获取格式和内容匹配。将其堆叠在类似的比赛之上，您就拥有了所需的东西。

-亚当

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-19T14:39:36.390

不确定是否理解您所说的所有内容，但使用正则表达式似乎是克服您正在谈论的问题的好方法。

# c++ - C++头文件源？

> ID：564933
> 
> 赞同：0
> 
> 时间：2009-02-19T11:49:50.963
> 
> 标签：c++

我正在使用 VS.Net C++ 2008 在 C++ CLI 中编程。我正在寻找一种可以从头文件创建我的 C++ 源定义 (*.cpp) 的工具。这样的工具存在吗？请指教，谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T11:59:18.850

Code::Blocks IDE 似乎有一个“插入/所有没有实现的类方法”方法，它生成了一些基本的功能骨架。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T11:55:14.803

> 我正在寻找一种可以从头文件创建我的 C++ 源定义 (*.cpp) 的工具。

你的意思是：我如何复制函数签名？因为，我不希望程序为我定义任何功能。现在谁想失业；）

无论如何，如果您想复制签名，您可以为 IDE 定义自己的宏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T14:01:04.813

对于纯 C++ 代码，如果可以在 VS.Net 框架中添加 3rd 方生成器，那么我强烈推荐：[lzz](http://www.lazycplusplus.com/)。

该工具将文本文件作为输入，并会根据需要为您提供头文件和源文件。以下是网页中的基本示例：

> ```
> // A.lzz
> class A
> {
> public:
>   inline void f (int i) { ... }
>   void g (int j = 0) { ... }
> };
> bool operator == (A const & a1, A const & a2) { ... } 
> ```
> 
> lzz会生成一个头文件：
> 
> ```
> // A.h
> #ifndef LZZ_A_h
> #define LZZ_A_h
> class A
> {
> public:
>   void f (int i);
>   void g (int j = 0);
> };
> inline void A::f (int i) { ... }
> bool operator == (A const & a1, A const & a2);
> #endif 
> ```
> 
> 和一个源文件：
> 
> ```
> // A.cpp
> #include "A.h"
> void A::g (int j) { ... }
> bool operator == (A const & a1, A const & a2) { ... } 
> ```

# c# - “lambda 表达式”和“lambda 表达式”之间没有隐式转换？

> ID：564935
> 
> 赞同：45
> 
> 时间：2009-02-19T11:50:13.273
> 
> 标签：c#, lambda

> 无法确定条件表达式的类型，因为“lambda 表达式”和“lambda 表达式”之间没有隐式转换

说什么？有人可以向我解释这个编译错误吗？这是产生它的代码：

```
 protected override Func<System.IO.Stream> GetStream()
    {
        return someBool
            ? () => EmbeddedResourceExtractor.GetFile("SomeFile1.ext")
            : () => EmbeddedResourceExtractor.GetFile("SomeFile2.ext");
    } 
```

这不会：

```
 protected override Func<System.IO.Stream> GetStream()
    {
        return () => EmbeddedResourceExtractor.GetFile("SomeFile1.ext");
    } 
```

也不这样做：

```
 protected override Func<System.IO.Stream> GetStream()
    {
        if(someBool)
            return () => EmbeddedResourceExtractor.GetFile("SomeFile1.ext");
        return () => EmbeddedResourceExtractor.GetFile("SomeFile2.ext");
    } 
```

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-02-19T11:58:19.023

条件表达式的类型必须作为一个整体来推断 - 并且 lambda 表达式总是必须转换为特定的委托或表达式树类型。

在后两个示例中，编译器知道它试图将 lambda 表达式转换为什么。在第一个示例中，它首先尝试计算出整个条件表达式的类型。

不过，在其中一个分支中进行演员就足够了：

```
protected override Func<Stream> GetStream()
{
    return someBool
        ? (Func<Stream>)
          (() => EmbeddedResourceExtractor.GetFile("SomeFile1.ext"))
        : () => EmbeddedResourceExtractor.GetFile("SomeFile2.ext");
} 
```

*如果*`someBool`您在调用函数时乐于评估， Sergio 的修复（现已删除，但包含在下面）将起作用：

```
protected override Func<Stream> GetStream()
{
    return () => someBool
          ? EmbeddedResourceExtractor.GetFile("SomeFile1.ext")
          : EmbeddedResourceExtractor.GetFile("SomeFile2.ext");
} 
```

根据时间的不同，有各种不同的方法可以修复您实际给出的示例，例如

```
protected override Func<Stream> GetStream()
{
    string name = someBool ? "SomeFile1.ext" : "SomeFile2.ext";
    return () => EmbeddedResourceExtractor.GetFile(name);
} 
```

我猜你的真实代码更复杂。

在某些方面，C# 的类型推断不能更强大是一种耻辱——但它已经相当复杂了。

# java - Java Web Start - 流行度

> ID：564936
> 
> 赞同：30
> 
> 时间：2009-02-19T11:50:26.453
> 
> 标签：java, jnlp, java-web-start

我最近使用了一个 Java Web Start 应用程序。我使用我正在查看的页面中的嵌入式 jnlp 链接从我的网络浏览器启动它。该应用程序已下载、启动并运行良好。它可以访问我的本地文件系统并记住我在重新启动它之间的偏好。

我想知道的是为什么 Java Web Start 应用程序对于 web 上的复杂应用程序不是更流行的交付格式？当使用 Java 和 Java Web Start 可以更轻松地交付桌面应用程序的功能时，为什么开发人员经常花费大量时间和精力在 html/javascript 中复制桌面功能？

我知道在某些公司环境中，例如银行，它们是向客户提供复杂交易应用程序的相对流行的方式，但为什么它们没有在整个网络中普遍存在？

（为了讨论，让我们假设一个世界：下载源是“可信的”，应用程序是“签名的”（即没有安全问题），下载速度很快（加载时间很快），并且开发人员知道 Java（在他们知道html/js/php))。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-08-17T05:14:33.510

我认为原因不是应用程序的安全性或启动时间。在找出根本原因之前，让我们先了解幕后情况。

Java 控制面板具有允许用户使用默认浏览器的代理设置或覆盖它们的设置。换言之，基础架构团队能够自定义 Windows 或操作系统安装映像，以使 JVM 预安装企业代理设置。所以我相信这根本不是问题。

Java Web Start 实际上会在 Java 控制面板中缓存所有具有可自定义设置的应用程序。一旦应用程序被缓存，应用程序就会像其他应用程序一样被“安装”。虽然第一次执行可能很慢，但由于 JVM 的智能内存分配技术，第二次会很快。所以启动时间可能是个问题，但是很多网站（甚至是企业内部的）现在都迁移到了门户网站。Web 门户通常包含许多用于开发目的的未使用库，因为门户本身并不预期在特定页面上构建和部署哪些类型的 portlet。因此，下载单个门户页面可能会消耗高达 MB 并在 5 秒以上的时间内完成一个页面；这只是一页，缓存可以帮助高达 30%，但每次仍然需要下载大量 HTML/Javascript/CSS 组件。有了这个，我确信 Java Web Start 在这里是一个优势。

只要服务器副本未升级，Java Web Start 就不会再次下载。因此，如果像MS Project这样的项目管理软件，使用SmartClient（类似于JWS）来完成，客户端和服务器之间的信息交换将是纯粹的数据，没有像浏览器的整页刷新那样的呈现。即使在 Ajax 的帮助下，它也不能完全消除整页下载。此外，很多公司都认为 Ajax 还不成熟且不安全。这就是为什么 Ajax 在开发人员圈子中是一个热门话题，但在企业软件中还不是。考虑到这一点，JWS 应用程序肯定具有更多优势，例如 JWS 应用程序如何在沙箱中部署和执行、签名以及具有更多交互式 GUI。

其他优势包括更快的开发（更容易调试代码和性能）、响应式用户界面（不需要 Comet 服务器提供 PUSH 功能）和执行速度更快（当然，因为客户端计算机无需像 HTML/Javascript/CSS 那样翻译即可呈现 GUI，和更少的数据处理）。

毕竟这些，我还没有触及这个问题，为什么JWS没有那么有名？

我的观点是，这与 Brian Knoblauch 的评论相同，没有意识。

IT 人员也被 Web 技术、Ajax PUSH、GWT 的炒作所吸引，所有这些流行语使他们偏向于使用不同技术或解决技术挑战的乐趣，而不是真正为客户工作的东西。

看看思杰。我认为 Citrix 实际上是一个好主意。Citrix 允许您在幕后构建自己的应用程序场。您可以在不影响客户体验的情况下采用大量升级和实施策略。Citrix 部署非常简单、稳定和安全。企业仍在使用它。但是，我认为 JWS 甚至比 Citrix 还要好。JWS 的想法是在客户端机器上运行应用程序，而不是托管大量的服务器场，让客户端机器能够自己运行这些应用程序。这为公司节省了很多钱！！！使用 JWS，开发团队仍然可以在服务器端构建业务逻辑和数据。但是，没有Web处理单元，让客户端计算机来做渲染过程，大大降低了网络消耗量和服务器处理能力。

为什么 JWS 是一个了不起的想法的另一个例子是 Blackberry MDS。黑莓应用程序实际上是从 Javascript 翻译而来的 Java 应用程序。使用 BB 的 MDS 工作室，您可以使用 GUI 工具构建 BB 应用程序 GUI，用 Javascript 编写 GUI 逻辑。然后应用程序被翻译并部署在 BES 服务器上。然后 BES 服务器会将这些应用分发给 BB。在每个 BB 上，它运行一个仅具有 GUI 呈现和网络功能的瘦 Java 应用程序。每当应用程序需要数据时，它都会通过 Web 服务与 BES 通信，以使用来自其他服务器的服务。这不就是JWS BB版吗？它非常成功。

最后，我认为 JWS 不受欢迎是因为 Sun 宣传它的方式。BB 从不宣传他们的 BB Java 应用程序有多好，他们相信客户甚至不会关心它是什么。BB 宣传使用 MDS 开发应用程序的好处：快速、节省成本、业务回报。

只是我的，有点长，2美分...... :)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-19T12:38:58.427

Java Webstart 的一个主要障碍可能是您仍然需要安装 JVM，然后它才能尝试下载和启动您的应用程序。每个人都有一个浏览器。不是每个人都有 JVM。

**编辑：** 我已经获得了一些动手的 webstart 经验，现在可以添加这两点：

*   [Deployment Toolkit 脚本](http://download.oracle.com/javase/tutorial/deployment/webstart/deploying.html)和在 Java 1.6u10 附近发布的模块化 JVM 使 JVM 需求的问题更少，因为它可以自动下载 JVM 和 API 核心并在下载其余部分的同时启动程序。
*   Web Start 有严重的错误。即使在 Java 1.6 版本中，也有一个每次都下载整个应用程序，另一个下载它然后失败并显示一个模糊的错误消息。总而言之，我真的不推荐依赖这样一个脆弱的系统。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-19T12:30:07.187

我认为这主要是由于缺乏意识。它工作得很好。相当无缝。应用程序仅在第一次、有升级或最终用户清除缓存时才下载。部署成熟的桌面应用程序的好方法，用户不必担心手动升级！

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-19T12:02:18.237

Webstart 的问题在于，您实际上必须“启动”一些即使连接速度也没有那么快的东西，而使用 web 应用程序，您输入 URL 并且应用程序就在那里。

webstart 也可能出现很多问题。可能目标用户没有所需的权限，或者 webstart 的代理配置错误，或者 jre 依赖项出现问题，或者根本没有安装 java。因此，对于互联网上的普通 john doe 来说，它一点也不讨人喜欢。

在像公司这样的受控环境中，在许多情况下，它是一个很好且简单的解决方案。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-03-28T07:33:37.003

几年来，我已经在数千名用户基础上开发了一个 JWS 部署的应用程序，它的自动升级实际上是一个巨大的痛苦。

由于某种原因，每次更新都会有数十名用户“卡在中间”。你得到的只是“找不到类”异常（如果你很幸运的话），或者在 JWS 到达你的代码之前就从 JWS 中“无法启动”。看起来更新已下载一半。或者，换句话说，它不会自动下载和应用更新并且缓存很差，因此从相同的 URL 重新启动应用程序并不能解决任何问题。

除了清除 JWS 缓存或提供不同的 URL（例如`?dummyparam=jwssucks`在末尾附加）之外，没有其他方法可以解决它。即使我作为开发人员有时也会遇到它并且看不到解决方法。

当它起作用时，它就会起作用。但通常情况并非如此，这对您和您的帮助台来说是一个巨大的痛苦。我不建议将它用于企业或关键任务用途。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-17T10:48:10.380

有一个非常大的问题，即它不允许“立即启动程序，然后在后台检查并下载任何更新”部署，这是应用程序的实际行为正在趋同的。

我个人认为这非常令人烦恼，以至于我们正在积极寻找另一种提供这种技术的技术。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-06T07:14:24.887

从这些帖子中可以看出，在使用 Web 启动时，好好照顾服务器很重要。每次启动时下载应用程序的“巨大痛苦”可能是由于服务器传递的时间戳不正确造成的。这里不是应用程序，而是服务器必须配置为正确使用缓存，而不仅仅是禁用它。关于错误启动，我不太确定，但在我看来，这也可能是由不可靠的连接引起的。

Web start 的重要优点是它可以很好地与 Linux 下的 OpenJDK 配合使用。一些快乐的开发人员的客户只使用 Windows，但我的客户不使用。

在最初的问题中提到的 HTML 和 JavaScript 是较轻的方法，可以很好地处理较小的任务，例如动画按钮甚至交互式表格。Java 利基似乎围绕着更复杂的任务。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-03-22T13:04:12.133

Java Web Start 是 Java Applet 的继承者，Applet 在新千年左右被烧毁。但是，我仍然认为 Java Applets 比 GWT 或 Javascript 地狱要好得多。

[Java Web Start 与嵌入式 Java 小程序](https://stackoverflow.com/questions/2530380/java-web-start-vs-embedded-java-applet)

# java - 为什么 Class.forName() 对我不起作用？

> ID：564938
> 
> 赞同：2
> 
> 时间：2009-02-19T11:50:41.477
> 
> 标签：java, class, instantiation, classname

我正在尝试从变量实例化一个类，并编写了一些测试代码。但是，不幸的是，它不起作用。这是代码：

```
Object co1 = new CommandDownloadHttp();
Class cc1 = Class.forName("CommandDownloadHttp");
Object co = cc1.newInstance(); 
```

不幸的是，在第二行它与`java.lang.ClassNotFoundException`.

你能告诉我我做错了什么吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T11:53:45.493

CommandDownloadHttp 是类的*全*名，即它没有包吗？如果它*确实*有一个包，请包括：

```
Class.forName("foo.bar.CommandDownloadHttp"); 
```

（我认为你有更好的理由在你的真实代码中这样做，顺便说一句 - 显然在这种情况下你实际上不需要通过反射来获取类:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T11:54:40.937

你的课在包里吗？这个包是进口的吗？所以它在第 1 行有效。但是您需要 Class.forName("my.package.to.CommandDownloadHttp") 中的完整限定名。

# sql-server-2005 - SQL2000/2005中如何临时禁用日志？

> ID：564950
> 
> 赞同：1
> 
> 时间：2009-02-19T11:53:51.797
> 
> 标签：sql-server-2005, sql-server-2000, logfiles

有没有办法阻止日志文件在 SQL2000/2005 中增长（或至少增长一样多）？

我正在运行一个非常广泛的过程，其中包含大量插入，并且日志正在通过屋顶。

**编辑**：请注意，我说的是批量导入过程，而不是每天更新实时数据。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T11:59:49.443

您不能禁用日志，但可以分批执行插入并在批次之间备份/截断日志。

如果数据来自您的数据库之外，您也可以考虑使用[BCP](http://msdn.microsoft.com/en-us/library/aa174646.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T08:58:18.657

请记住，将恢复模式设置为 SIMPLE 仅允许您将数据库恢复到最近的备份点。未提交到数据库的待处理事务（在创建备份后）将丢失。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-09T08:41:24.733

如果您需要恢复，更改恢复模式将导致您的旧日志备份毫无用处，因为这会更改日志链。

如果您通常需要完全恢复，则需要在加载过程中增加日志备份频率。这可以通过在加载过程之前和之后通过 msdb 数据库中的 sp_update_jobschedule 过程更改日志备份的作业计划来完成。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-09-16T19:56:58.973

您的批次可能过多地使用临时表。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-02-19T12:03:45.283

您可以在创建数据库时关闭“自动增长”。
您可以为数据库和/或日志文件单独更改此设置。

[更改自动增长设置 SQL Server http://www.server-management.co.uk/images/library/c1652bc7-.jpg](http://www.server-management.co.uk/images/library/c1652bc7-.jpg)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-02-20T08:51:27.953

将恢复模式更改为 SIMPLE 会导致日志增长不那么快。

人们对此解决方案有何看法？

# c# - 单套接字多客户端架构

> ID：564952
> 
> 赞同：3
> 
> 时间：2009-02-19T11:54:04.807
> 
> 标签：c#, multithreading, architecture, sockets

我必须维护到支付网关的单个持久套接字连接，并使用它来发送财务消息并接收相同的确认。然后我的应用程序将被各种客户端使用，因此我需要设计一种方法来同时处理它们并处理诸如超时和重试等问题。

现在，我的主要问题是访问套接字......我应该只锁定每个消息请求和响应的发送和接收，还是设置一个排队系统并匹配它们？我还将在另一个线程上发送定期回显消息。

哦，我打算用 C# 来做。我将不胜感激有关此问题的一般性建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T12:11:57.213

你需要一个到支付网关的持久套接字，好的。我假设你的意思是它必须保持连接。

然后您需要创建一个侦听器套接字来侦听来自您的客户端的连接。然后充当两者之间的翻译。

我不确定我理解您所说的“锁定套接字”是什么意思。怎么锁？

除非支付网关的协议用于多个并发操作，否则您可能不希望一次发送多个请求。这将意味着某种队列，或者每个请求的线程使用某种互斥锁或信号量来控制访问。在大多数情况下，队列更有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:35:39.560

我做了这件事（如果我理解正确的话）。我有一台服务器通过套接字连接到一些目标设备，然后客户端连接到服务器以与不同的目标系统通信。这是（某种）你想要的吗？我有多个客户端通过服务器与同一个套接字通信。

在我的服务器中，我保留了已连接客户端的列表和已连接目标的列表。当客户端请求一个目标时，我将它添加到一个矩阵中，该矩阵本质上是一个连接字典，因为多个客户端可以同时与一个目标对话。然后，服务器完全异步地在客户端和目标之间泵送消息，我使用事务 ID 来跟踪消息。这样当目标响应请求时，服务器就知道将响应发送给哪个客户端。

我不确定这是否是您想要的，但也许我所做的无论如何都会对您有所帮助。如果我走在正确的轨道上，我可以进一步详细说明。

# c# - lambda 表达式中的事件 - C# 编译器错误？

> ID：564961
> 
> 赞同：10
> 
> 时间：2009-02-19T11:55:26.537
> 
> 标签：c#, compiler-construction, lambda, compiler-errors

我正在研究使用lamba表达式来允许以强类型方式连接事件，但中间有一个监听器，例如给定以下类

```
class Producer
{
    public event EventHandler MyEvent;
}

class Consumer
{
    public void MyHandler(object sender, EventArgs e) { /* ... */ }
}

class Listener
{
    public static void WireUp<TProducer, TConsumer>(
        Expression<Action<TProducer, TConsumer>> expr) { /* ... */ }
} 
```

一个事件将被连接为：

```
Listener.WireUp<Producer, Consumer>((p, c) => p.MyEvent += c.MyHandler); 
```

但是，这会产生编译器错误：

> CS0832：表达式树可能不包含赋值运算符

现在起初这似乎是合理的，尤其是在[阅读了关于为什么表达式树不能包含赋值的解释](http://msdn.microsoft.com/en-us/library/bb384223.aspx)之后。然而，尽管有 C# 语法，但`+=`不是赋值，它是对`Producer::add_MyEvent`方法的调用，正如我们可以从生成的 CIL 中看到的，如果我们只是正常连接事件：

```
L_0001: newobj instance void LambdaEvents.Producer::.ctor()
L_0007: newobj instance void LambdaEvents.Consumer::.ctor()
L_000f: ldftn instance void LambdaEvents.Consumer::MyHandler(object, class [mscorlib]System.EventArgs)
L_0015: newobj instance void [mscorlib]System.EventHandler::.ctor(object, native int)
L_001a: callvirt instance void LambdaEvents.Producer::add_MyEvent(class [mscorlib]System.EventHandler) 
```

所以在我看来这是一个编译器错误，因为它抱怨不允许分配，但没有发生分配，只是一个方法调用。还是我错过了什么……？

**编辑：**

请注意，问题是“这种行为是编译器错误吗？”。抱歉，如果我不清楚我在问什么。

**编辑 2**

在阅读了 Inferis 的答案后，他说“此时 += 被认为是赋值”，这确实有些道理，因为此时编译器可能不知道它将被转换为 CIL。

但是，我不允许编写显式方法调用表单：

```
Listener.WireUp<Producer, Consumer>(
    (p, c) => p.add_MyEvent(new EventHandler(c.MyHandler))); 
```

给出：

> CS0571：“Producer.MyEvent.add”：无法显式调用运算符或访问器

所以，我想问题归结为`+=`在 C# 事件的上下文中的实际含义。它的意思是“为此事件调用 add 方法”还是“以尚未定义的方式添加到该事件”。如果是前者，那么这在我看来是一个编译器错误，而如果是后者，那么它有点不直观，但可以说不是一个错误。想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T12:21:13.383

在规范的第 7.16.3 节中，+= 和 -= 运算符被称为“事件赋值”，这当然使它听起来像一个赋值运算符。它在第 7.16 节（“赋值运算符”）中的事实是一个很大的提示 :) 从这个角度来看，编译器错误是有道理的。

但是，我同意它*过于*严格，因为表达式树完全有可能表示 lambda 表达式给出的功能。

我*怀疑*语言设计者采用了“限制性稍强但在操作符描述中更一致”的方法，恐怕是以牺牲这种情况为代价的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:03:11.930

+= 是一个赋值，不管它做什么（例如添加一个事件）。从解析器的角度来看，它仍然是一个赋值。

你试过了吗

```
Listener.WireUp<Producer, Consumer>((p, c) => { p.MyEvent += c.MyHandler; } ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T12:10:13.317

为什么要使用 Expression 类？`Expression<Action<TProducer, TConsumer>>`将您的代码更改为简单`Action<TProducer, TConsumer>`，并且一切都应该按照您的意愿工作。您在这里所做的是强制编译器将 lambda 表达式视为表达式树而不是委托，并且表达式树确实不能包含此类分配（它被视为分配，因为您使用 += 运算符我相信）。现在，可以将 lambda 表达式转换为任何一种形式（如 [MSDN][1] 中所述）。通过简单地使用委托（这就是 Action 类的全部内容），这样的“分配”是完全有效的。我可能误解了这里的问题（也许你需要使用表达式树有一个特定的原因？），但幸运的是，解决方案似乎很简单！

**编辑：**对，我现在从评论中更好地理解了你的问题。有什么理由不能将 p.MyEvent 和 c.MyHandler 作为参数传递给 WireUp 方法并在 WireUp 方法中附加事件处理程序（从设计的角度来看，这对我来说似乎更好）......会这不能消除对表达式树的需要吗？我认为最好还是避免使用表达式树，因为与委托相比，它们往往相当慢。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T12:11:26.560

实际上，就编译器而言，它*是*一个赋值。+= 运算符被重载，但编译器此时并不关心这一点。毕竟，您正在通过 lambda 生成一个表达式（它在某一时刻将被编译为实际代码）并且没有真正的代码。

所以编译器所做的就是说：创建一个表达式，在其中添加`c.MyHandler`到当前值`p.MyEvent`并将更改后的值存储回`p.MyEvent`. 所以你实际上是在做一个任务，即使最后你不是。

您是否有理由希望 WireUp 方法采用表达式而不仅仅是一个动作？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T12:11:11.163

我认为问题在于，除了`Expression<TDelegate>`对象之外，从编译器的角度来看，表达式树不是静态类型的。`MethodCallExpression`和朋友不暴露静态类型信息。

即使编译器知道表达式中的所有类型，在将 lambda 表达式转换为表达式树时，这些信息也会被丢弃。（查看为表达式树生成的代码）

尽管如此，我还是会考虑将其提交给微软。

# c# - 在 c# 中保留加载事件的 datalist 数据

> ID：564970
> 
> 赞同：0
> 
> 时间：2009-02-19T11:57:33.160
> 
> 标签：c#

我有包含单选按钮和复选框的数据列表。如果我选择其中一些然后重定向到另一个 aspx 页面。当我来到上一页时，必须选中 datalist 中的单选按钮和复选框。我在会话变量中选择了数据。如何使用 c# 做到这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T14:22:24.437

使用 ItemDataBound 事件，我将检索单选按钮并将其值与您的 Session 变量进行比较

像这样的东西：

```
protected void MyDataList_ItemDataBound(object sender, DataListItemEventArgs e)
{
    RadioButton myRadioButton = e.Items.FindControl("myRadioButton") as RadioButton;

    if (myRadioButton == null) { }
    else
    {
        if (string.IsNullOrEmpty(Session[myRadioButton.Value])) {}
        else myRadioButton.Checked = true;        
    }
} 
```

# .net - 实体框架 - 按类型继承的表 - 现有数据库

> ID：564975
> 
> 赞同：1
> 
> 时间：2009-02-19T11:59:13.280
> 
> 标签：.net, entity-framework, inheritance, orm

我想为现有数据库使用 Entity 框架实现 Table Per Type 继承。

数据库：

![替代文字](https://i.stack.imgur.com/bxRDF.png)

ImageParagraphs 的继承工作完美，但由于主键不同（ParagraphID；ParagraphID+LinkID），我无法使用 LinkListParagraph 进行 Table Per Type 继承：

> 错误 1 ​​错误 3003：从第 113 行开始映射片段时出现问题：EntitySet 段落的所有关键属性（Paragraphs.ParagraphID）必须映射到表 LinkListParagraph 的所有关键属性（LinkListParagraph.LinkID、LinkListParagraph.ParagraphID）。C:\Users\buc\Documents\Visual Studio 2008\Projects\ParagraphTest\ParagraphTest\ParagraphModel.edmx 114 15 ParagraphTest

是否有可能在不更改数据库的情况下解决此问题？

我想做的是这样的：

![替代文字](https://i.stack.imgur.com/0Lkqj.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T12:56:29.790

一种方法可能是就主键向实体框架撒谎。这将需要进入 EDMX 中的存储映射并更改主键标志。但是要意识到，如果您这样做，那么从数据库更新模型向导将在您每次进行更新时尝试“修复”您的映射。

另一种方法是在数据库中创建一个视图并映射视图而不是表。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-22T09:30:09.800

主要问题来自实体框架不必要的默认键创建。尝试以 xml 格式打开 .edmx 文件，您现在将看到以下类似内容：

```
<EntityType Name="GSKItemDetails">
          <Key>
            <PropertyRef Name="ItemId" />
            <!--<PropertyRef Name="Description" />
            <PropertyRef Name="NDCNumber" />-->
          </Key>
          <Property Name="ItemId" Type="varchar" Nullable="false" MaxLength="47" />
          <Property Name="Description" Type="varchar" Nullable="false" MaxLength="30" />
          <Property Name="NDCNumber" Type="varchar" Nullable="false" MaxLength="16" />
          <Property Name="UnitPrice" Type="decimal" Precision="19" Scale="4" /> 
        </EntityType> 
```

在我的情况下，如上所述，注释掉不必要的 PropertyRefs，解决了给出错误的问题：错误 3003。

# javascript - Javascript - 表单选择元素在新窗口中打开 url 并提交表单

> ID：564980
> 
> 赞同：2
> 
> 时间：2009-02-19T12:00:47.193
> 
> 标签：javascript, jquery, forms, select, form-submit

**已更新**- 请阅读原始问题下方的更多详细信息

我有一个带有各种 url 的选择表单元素，我想在选择时在新窗口中打开 - 为此，我在元素的 onchange 事件中有以下代码：

```
window.open(this.options[this.selectedIndex].value,'_blank'); 
```

这工作正常。但是我也想在更改此选择元素值时提交表单-我尝试了各种方法，但似乎无法使其正常工作。

我有 jquery，所以如果通过它更容易实现，那很好。

*更新 - 我刚刚意识到上面还有另一个问题，因为一些 url 实际上用于生成和输出 pdf，而这些不起作用 - 它们打开然后立即关闭（至少在 IE7 中）。*

**2009 年 7 月 5日更新**- 我现在已经为这个问题开了一个赏金，因为我真的需要想出一个可行的解决方案。我最初确实通过显示链接而不是表单选择元素来解决这个问题，但这不再可行。

我需要上述内容的原因是我有大量可能需要查看/打印的文件，太多而无法合理地显示为链接列表。我需要提交表单以记录特定文件已被查看/打印的事实，然后在表单上显示文件历史记录 - 我很乐意实现这一方面，所以不需要帮助，但我认为这将有助于放置上下文。

因此，为了阐明我的要求 - 我需要一个表单选择元素和“查看”按钮，单击该按钮不仅会在新窗口中启动文件下载（请注意当这些文件是 PDF 时我遇到的上述问题），而且还提交包含选择元素的表单。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-07T11:58:23.237

给你

```
<script type="text/javascript">
    $(function() {
        $("#selectElement").change(function() {
            if ($(this).val()) {
                window.open($(this).val(), '_blank');
                $("#formElement").submit();
            }
        });

        // just to be sure that it is submitting, remove this code
        $("#formElement").submit(function() {
            alert('submitting ... ');
        });
    });
</script>

<form id="formElement" method="get" action="#">
    <select id="selectElement">
        <option></option>
        <option value="http://www.deviantnation.com/">View Site 1</option>
        <option value="http://stackoverflow.com/">View Site 2</option>
        <option value="http://serverfault.com/">View Site 3</option>
    </select>
</form> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T12:07:05.430

**您可以使用`this.form.submit()`触发表单提交：**

```
<script language="javascript">
    function myChangeHandler() {
        window.open(this.options[this.selectedIndex].value, '_blank');
        this.form.submit();
}
</script>

<select onchange="myChangeHandler.apply(this)">
    ...
</select> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T12:12:43.093

刚刚测试了 Aron 的示例，它工作正常，所以我建议您得到的错误来自 onchange 事件之外的代码。试试下面的工作示例，看看你是否得到同样的错误。

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
 <HEAD>
  <TITLE> Example onchange and submit </TITLE>

  <script language="javascript">    
   function myChangeHandler() 
   {
    window.open(this.options[this.selectedIndex].value, '_blank');
    this.form.submit();
   }
  </script>
 </HEAD>

 <BODY>
 <form id="myform1" action="test.html">
  <select onchange="myChangeHandler.apply(this)">
    <option>Please select....</option>
    <option value="http://stackoverflow.com">Stackoverflow</option>
    <option value="http://twitter.com">Twitter</option>
    </select>
  </form>
 </BODY>
</HTML> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T12:48:26.127

根据您的描述，您的标记可能看起来像这样：

```
<form ...>
  <input name="submit" ...>
  ...
</form> 
```

因为浏览器的传统是将输入的名称添加到表单元素的对象（作为属性）中，所以输入中的“提交”属性掩盖了表单固有的“提交”属性或方法。您可以通过重命名输入元素（即使是临时重命名）来纠正此问题（假设只有一个）：

```
form_object.elements['submit'].name = 'notsubmit';
form_object.submit(); 
```

如果有多个——例如，由于某种原因，一系列名为“提交”的单选按钮——那么 .elements['submit'] 应该是一个元素集合，就像一个数组，你可以循环到它做同样的事。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T12:07:48.347

您知道可以为表单设置目标属性吗？

```
<form target="_blank" method="post">
  <select onchange="load()">
    ...
  </select>
</form>
<script>
  load() {
    document.forms[0].action = this.value;
    document.forms[0].submit();
  }
</script> 
```

原谅可能不好的 Javascript。这些天我倾向于做更多的jQuery，所以我对香草Javascript生疏了。但你得到了一般的想法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T12:08:00.920

虽然我不熟悉 jQuery，但你应该可以做这样的事情（原型风格）：

```
$('select-field').observe('change',function(event){
  window.open(this.options[this.selectedIndex].value,'_blank');
  this.form.submit();
} 
```

虽然我之前在使用 Javascript 提交表单时遇到了一些奇怪的问题，所以如果这不起作用，您可以尝试调用`click()`或等效`fireEvent('click')`于表单的提交按钮，如下所示：

```
$('submit-button').fireEvent('click'); 
```

# ruby-on-rails - 为什么我的观点没有更新？

> ID：564988
> 
> 赞同：1
> 
> 时间：2009-02-19T12:02:50.887
> 
> 标签：ruby-on-rails

我是 Ruby on Rails 的新手，正在创建一个测试应用程序。到目前为止，它正在工作，但是当我对我的视图进行一些小的更改时，页面并没有改变。

我的问题可能与[这个问题有关](https://stackoverflow.com/questions/87802/why-does-rails-cache-view-files-when-hosted-on-vm-and-codebase-on-samba-share)，但我不确定在 VM 中设置日期和时间是什么意思。我的代码在远程托管的服务器上，所以我假设它会使用该机器的系统时间。

这里有缓存问题吗？我能做些什么呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T12:13:03.857

如果您自己无法控制服务器环境（没有 shell 访问权限等），您可以在顶部设置以下内容`config/environment.rb`：

```
ENV['RAILS_ENV'] = 'development' 
```

开发不会缓存太多，因此虽然速度较慢，但​​开发起来会更好。

`app/`在对文件夹外的任何内容（配置、插件等）进行更改后，您仍然需要重新启动您的应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T12:08:33.633

如果您处于生产模式，则需要重新启动 Rails 应用程序（如果您使用的是 Passenger，则需要重新启动 Apache）！

# c# - 将 .NET 3.5 应用程序移植到便携式设备

> ID：564990
> 
> 赞同：1
> 
> 时间：2009-02-19T12:03:23.473
> 
> 标签：c#, .net, mobile, webserver, porting

我已经使用 C# 中的套接字为 .NET 3.5 编写了一个服务器/客户端应用程序。我有兴趣将客户端部分移植到某种移动设备上，并且正在考虑最好的方法。客户端实际上是一个底层库和一个严重依赖于触摸界面功能的 GUI。

正如我所看到的，我有几个选择：

1.  只需要一台 EEE PC 并在其上运行，这有点便携，但我失去了触控部分
2.  为移动平台重建库并制作一个新的、简化的 GUI 应用程序
3.  启动一个 Web 服务器并制作某种 Web 界面以在 iPhone 上运行等等

最好的路线是什么？我在上面的替代方案中会遇到什么问题？我真的更喜欢替代 1 或 2 而不是 3，因为服务器当前是如何完成的，而且我对网络服务器或 ASP.NET 一无所知。哦，我想留在我已经在的环境中，即 .NET，所以请不要 Ruby on Rails 建议。（不是说 Ruby 不好或其他什么，我只是不知道，也没有时间学习）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T13:07:18.267

那我会选择选项2。将库移植到 Compact Framework 并提供它只是套接字等不会花费您太长时间（希望如此），那么我确信 CF 会很好地处理它。

**编辑：**选项 2 的唯一问题是如果您使用任何不在 CF 中的 .Net 函数。如果是这种情况，您通常可以在 OpenNETCF 中找到它。

您将需要创建一个新的 GUI，但如果您已经对库进行了很好的编码，那么它应该只是在您的设备上适用的情况下分配方法/事件。

我想说虽然选项 3 是最好的选择 - 它极大地扩展了您的客户群，尤其是随着 WM 和 iPhone 用户数量的增加。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T23:09:46.237

我会选择选项2。

System.Net.Sockets 命名空间中的[TcpClient 类](http://msdn.microsoft.com/en-au/library/system.net.sockets.tcpclient.aspx)类的大部分成员都是在 .Net Compact Framework 中实现的。

我很想了解您在选择移动设备时的要求。Windows Mobile Smartphone 和 EEE PC 之间有很多不同之处。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-25T00:00:54.630

尼克拉斯，

在您决定在移动客户端上使用的技术堆栈之前，您需要确定他们将拥有哪些移动设备，这往往会为您决定技术。

iPhone - Objective C 黑莓 - Java Nokia - C/Java Windows - .NET CF

否则有可能把客户端变成一个移动网站，然后通过你的 TCP Socket 东西与服务器通信吗？这样您就无需担心移动设备上的技术。

# sql - 加入两个sql查询

> ID：564997
> 
> 赞同：40
> 
> 时间：2009-02-19T12:05:59.957
> 
> 标签：sql, database, join

我有两个 SQL 查询，第一个是：

```
select Activity, SUM(Amount) as "Total Amount 2009"
from Activities, Incomes
where Activities.UnitName = ? AND
      Incomes.ActivityId = Activities.ActivityID
GROUP BY Activity
ORDER BY Activity; 
```

第二个是：

```
select Activity, SUM(Amount) as "Total Amount 2008"
from Activities, Incomes2008
where Activities.UnitName = ? AND
      Incomes2008.ActivityId = Activities.ActivityID
GROUP BY Activity
ORDER BY Activity; 
```

（不要介意'？'，它们代表 birt 中的一个参数）。我想要实现以下目标：我想要一个返回与第一个查询相同的 SQL 查询，但有一个额外的（第三个）列，看起来与“Total Amount 2008”（来自第二个查询）完全相同。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-02-19T12:33:00.533

一些 DBMS 支持该`FROM (SELECT ...) AS alias_name`语法。

将您的两个原始查询视为临时表。您可以像这样查询它们：

```
SELECT t1.Activity, t1."Total Amount 2009", t2."Total Amount 2008"
FROM (query1) as t1, (query2) as t2
WHERE t1.Activity = t2.Activity 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-19T12:10:57.513

```
SELECT Activity, arat.Amount "Total Amount 2008", abull.Amount AS "Total Amount 2009"
FROM
  Activities a
LEFT OUTER JOIN
  (
  SELECT ActivityId, SUM(Amount) AS Amount
  FROM Incomes ibull
  GROUP BY
    ibull.ActivityId
  ) abull
ON abull.ActivityId = a.ActivityID
LEFT OUTER JOIN
  (
  SELECT ActivityId, SUM(Amount) AS Amount
  FROM Incomes2008 irat
  GROUP BY
    irat.ActivityId
  ) arat
ON arat.ActivityId = a.ActivityID
WHERE a.UnitName = ?
ORDER BY Activity 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-19T12:13:15.290

我只会使用一个[联盟](http://www.w3schools.com/sql/sql_union.asp)

在您的第二个查询中添加额外的列名并`''`在其他查询中的所有相应位置添加

例子

```
//reverse order to get the column names
select top 10 personId, '' from Telephone//No Column name assigned 
Union 
select top 10 personId, loanId from loan 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-12-13T06:41:32.427

这对我有用：

```
select visits, activations, simulations, simulations/activations
   as sims_per_visit, activations/visits*100
   as adoption_rate, simulations/activations*100
   as completion_rate, duration/60
   as minutes, m1 as month, Wk1 as week, Yr1 as year 

from
(
    (select count(*) as visits, year(stamp) as Yr1, week(stamp) as Wk1, month(stamp)
    as m1 from sessions group by week(stamp), year(stamp)) as t3

    join

    (select count(*) as activations, year(stamp) as Yr2, week(stamp) as Wk2,
    month(stamp) as m2 from sessions where activated='1' group by week(stamp),
    year(stamp)) as t4

    join

    (select count(*) as simulations, year(stamp) as Yr3 , week(stamp) as Wk3,
    month(stamp) as m3 from sessions where simulations>'0' group by week(stamp),
    year(stamp)) as t5

    join

    (select avg(duration) as duration, year(stamp) as Yr4 , week(stamp) as Wk4,
    month(stamp) as m4 from sessions where activated='1' group by week(stamp),
    year(stamp)) as t6
)
where Yr1=Yr2 and Wk1=Wk2 and Wk1=Wk3 and Yr1=Yr3 and Yr1=Yr4 and Wk1=Wk4 
```

我使用了连接，而不是联合（我需要为每个查询使用不同的列，连接将它们全部放在同一列中）并且我删除了引号（与 Liam 所做的相比），因为它们给了我错误。

谢谢！没有这个页面，我不可能做到这一点！PS：对不起，我不知道你是如何用颜色格式化你的陈述的。等等

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-03-31T06:45:38.480

您也可以使用 CTE，如下所示。

```
With cte as
(select Activity, SUM(Amount) as "Total Amount 2009"
   from Activities, Incomes
  where Activities.UnitName = ? AND
        Incomes.ActivityId = Activities.ActivityID
  GROUP BY Activity
),
cte1 as 
(select Activity, SUM(Amount) as "Total Amount 2008"
   from Activities, Incomes2008
  where Activities.UnitName = ? AND
        Incomes2008.ActivityId = Activities.ActivityID
  GROUP BY Activity
)
Select cte.Activity, cte.[Total Amount 2009] ,cte1.[Total Amount 2008]      
  from cte join cte1 ON cte.ActivityId = cte1.ActivityID
 WHERE a.UnitName = ?
 ORDER BY cte.Activity 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T12:10:34.113

试试这个：

```
select Activity, SUM(Incomes.Amount) as "Total Amount 2009", SUM(Incomes2008.Amount) 
as "Total Amount 2008" from
Activities, Incomes, Incomes2008
where Activities.UnitName = ?  AND
Incomes.ActivityId = Activities.ActivityID  AND
Incomes2008.ActivityId = Activities.ActivityID GROUP BY
Activity ORDER BY Activity; 
```

基本上，您必须在第一个查询的输出中加入 Income2008 表。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T12:13:51.280

如果您假设两年中所有活动都存在价值，那么只需按如下方式进行内部连接

```
 select act.activity, t1.amount as "Total 2009", t2.amount as "Total 2008"
from Activities as act,
    (select activityid,  SUM(Amount) as amount
    from Activities, Incomes
    where Activities.UnitName = ? AND
          Incomes.ActivityId = Activities.ActivityID
    GROUP BY Activityid) as t1,
    (select activityid, SUM(Amount) as amount
    from Activities, Incomes2008
    where Activities.UnitName = ? AND
          Incomes2008.ActivityId = Activities.ActivityID
    GROUP BY Activityid) as t2
    WHERE t1.activityid= t2.activityid
    AND act.activityId = t1.activityId
    ORDER BY act.activity 
```

如果你不能假设这一点，那么看看做一个外连接

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T12:18:43.827

也许不是解决这个问题的最优雅的方法

```
select  Activity, 
        SUM(Amount) as "Total_Amount",
        2009 AS INCOME_YEAR
from    Activities, Incomes
where Activities.UnitName = ? AND
      Incomes.ActivityId = Activities.ActivityID
GROUP BY Activity
ORDER BY Activity;

UNION

select  Activity, 
        SUM(Amount) as "Total_Amount",
        2008 AS INCOME_YEAR
from Activities, Incomes2008
where Activities.UnitName = ? AND
      Incomes2008.ActivityId = Activities.ActivityID
GROUP BY Activity
ORDER BY Activity; 
```************