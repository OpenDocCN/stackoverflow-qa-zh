# StackOverflow 问答 000753000-000753999

# c# - LINQ to SQL 插入顺序 GUID

> ID：753003
> 
> 赞同：7
> 
> 时间：2009-04-15T18:12:46.860
> 
> 标签：c#, linq, guid

我有一个数据库，它是合并复制方案的一部分，它有一个 GUID，因为它是 PK。具体来说，数据类型是*uniqueidentifier*，默认值*(newsequentialid())*，RowGUID 设置为*Yes*。当我执行 InsertOnSubmit(CaseNote) 时，我认为我可以单独留下 CaseNoteID，并且数据库将输入下一个 Sequential GUID，就像在 MSSMS 中手动输入新行一样。相反，它发送*00000000-0000-0000-0000-000000000000*。如果我添加`CaseNoteID = Guid.NewGuid(),`我得到一个 GUID 但不是一个顺序的（我很确定）。

有没有办法让 SQL 在 LINQ InsertOnSubmit() 上创建下一个顺序 ID？

下面的参考是我用来将新记录插入数据库的代码。

```
 CaseNote caseNote = new CaseNote
                                {
                                    CaseNoteID = Guid.NewGuid(),
                                    TimeSpentUnits = Convert.ToDecimal(tbxTimeSpentUnits.Text),
                                    IsCaseLog = chkIsCaseLog.Checked,
                                    ContactDate = Convert.ToDateTime(datContactDate.Text),
                                    ContactDetails = memContactDetails.Text
                                };
        caseNotesDB.CaseNotes.InsertOnSubmit(caseNote);

        caseNotesDB.SubmitChanges(); 
```

* * *

根据以下建议之一，我为该列启用了在 LINQ 中自动生成，现在我收到以下错误——>*如果语句包含没有 INTO 子句的 OUTPUT 子句，则 DML 语句的目标表不能有任何启用的触发器。* 想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-15T18:17:44.100

在 Linq to Sql 设计器中，将该列的 Auto Generated Value 属性设置为 true。

这等效于列的[IsDbGenerated 属性](http://msdn.microsoft.com/en-us/library/system.data.linq.mapping.columnattribute.isdbgenerated.aspx)。唯一的限制是您不能使用 Linq 更新值。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-15T18:17:48.220

从右侧“相关”框的顶部：

[Linq-to-Sql 中的顺序 GUID？](https://stackoverflow.com/questions/665417/sequential-guid-in-linq-to-sql)

如果您真的想要“下一个”值，请使用 int64 而不是 GUID。COMB guid 将确保 GUID 是有序的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-31T20:46:41.223

关于您的“如果语句包含没有 INTO 子句的 OUTPUT 子句，则 DML 语句的目标表不能有任何启用的触发器”，请查看此 MS KB 文章，这似乎是 LINQ 中的错误：

[http://support.microsoft.com/kb/961073](http://support.microsoft.com/kb/961073)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-15T12:47:33.143

你真的需要做几件事。

1.  删除对 GUID 类型属性的任何分配
2.  将列更改为自动生成
3.  在数据库中创建一个约束，将列默认为 NEWSEQUENTIALID()
4.  像以前一样在提交时插入。

在插入到表中时，ID 将被创建并且是连续的。 [NEWSEQUENTIALID() 与其他方法的性能比较](http://www.codeproject.com/KB/database/AgileWareNewGuid.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-05T19:52:41.630

当使用自动生成的（guid/sequential guid）主键并在表上有触发器时，Linq2Sql 中存在一个错误。这就是导致您的错误的原因。该问题有一个修复程序：

[http://support.microsoft.com/default.aspx?scid=kb;en-us;961073&sd=rss&spid=2855](http://support.microsoft.com/default.aspx?scid=kb;en-us;961073&sd=rss&spid=2855)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-25T09:38:16.667

Masstransit 使用 combguid ：

[https://github.com/MassTransit/MassTransit/blob/master/src/MassTransit/NewId/NewId.cs](https://github.com/MassTransit/MassTransit/blob/master/src/MassTransit/NewId/NewId.cs)

这是你要找的吗？

来自维基百科：

> 顺序算法
> 
> GUID 通常用作数据库表的主键，因此，表通常在该属性上具有聚集索引。这在插入记录时会出现性能问题，因为完全随机的 GUID 意味着可能需要将记录插入表中的任何位置，而不仅仅是附加在表的末尾附近。作为缓解此问题的一种方法，同时仍提供足够的随机性以有效防止重复数字冲突，已使用多种算法来生成顺序 GUID。第一种技术，由 Jimmy Nilsson 在 2002 年 8 月 [7] 描述并称为“COMB”（“组合 guid/时间戳”），将 Data4 的最后 6 个字节替换为当前系统日期的最不重要的 6 个字节/时间。虽然这可能会导致 GUID 在相同的几分之一秒内乱序生成，但他的测试表明这对插入几乎没有实际影响。这种方法的一个副作用是，如果需要，可以在以后轻松地从值中提取插入的日期和时间。从 Microsoft SQL Server 版本 2005 开始，Microsoft 在 Transact-SQL 语言中添加了一个名为 NEWSEQUENTIALID()，[8] 的函数，该函数生成的 GUID 值保证会增加，但在以下情况下可能以较小的数字开始（仍保证唯一）服务器重新启动。这减少了可能发生插入的数据库表页的数量，但不能保证值总是增加值。这个函数的返回值很容易预测，所以这个算法不适合为安全或散列目的生成晦涩的数字。2006 年，一位程序员发现 Oracle 提供的 SYS_GUID 函数在某些平台上会返回顺序 GUID，但这似乎是一个错误而不是一个特性。 [9]

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-04-13T20:48:32.867

您必须处理 OnCreated() 方法

```
Partial Class CaseNote
    Sub OnCreated()
        id = Guid.NewGuid()
    End Sub
End Class 
```

# language-agnostic - 最简单的请求更改很难实现？

> ID：753007
> 
> 赞同：2
> 
> 时间：2009-04-15T18:13:41.443
> 
> 标签：language-agnostic

我很好奇，来自测试人员、客户或经理、程序员的变更请求看起来非常简单，但实际上非常复杂。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T18:17:46.677

你能添加一个撤消按钮吗？（到自定义的所见即所得编辑器）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-15T18:32:39.400

回到我的大学时代，我为一个客户做一个附带项目。这是一个中等大小的 Win32 桌面应用程序，用于制作一些 2D 图表，每一步和每个演示都很棒。客户喜欢它。最后，当他们问我是否可以先让它在网络上运行时，我已经准备好交付它并完成了。

经典的“缺少需求杀死项目”场景。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T18:16:06.727

向这个命令行应用程序添加 GUI 怎么样？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T18:16:15.960

我遇到的一件事是被要求更改窗口标题中的一个单词。然而，窗口的标题实际上是在一个库中本地化的，并与多个应用程序共享。在任一标题中更改它的标题都意味着要么更改它获取数据的位置（丑陋且与其余代码不一致），更改 dll（将影响其他软件），要么添加硬编码修复（hacky）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T18:19:20.213

“我想在数据库中使用 Oracle 而不是 SQLServer。”

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-15T18:26:42.847

“你能把它变大吗？” 参考单选按钮的大小.. 回到 CSS 之前

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-15T18:17:11.480

“只是让它更网络化”

# ms-access - access 2003 adp 在 2007 年打开和保存现在在 2003 年表现奇怪

> ID：753014
> 
> 赞同：1
> 
> 时间：2009-04-15T18:16:14.697
> 
> 标签：ms-access, ms-access-2007

我继承了一个使用 sql 2000 作为数据源的 access 2003 ADP 文件。这是我的第一个访问维护项目，没有考虑所涉及的问题，只是在我的开发机器上的 access 2007 中打开它。它当然奏效了，我开始做要求的工作。

我已完成工作并将文件提交给客户，他在 access 2003 中打开该文件并继续收到几个错误，这些错误都与未声明的变量有关。正是在这一点上，我意识到没有任何代码文件具有 Option Explicit 集。我再次查看 access 2007 中的项目 - 没有错误。行为就像 access 2007 尊重缺乏 Option Explicit 并按预期工作，但 access 2003 “认为” Option Explicit 已设置，即使它从未出现在任何代码文件中。

我意识到我可以只使用 access 2003 重新做这项工作，但这会比我想要的更耗时。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T18:29:03.717

奇怪的问题 - 我看不到 Access 2003 如何在没有任何 Option Explicit 的情况下检查显式变量声明。一定有别的事情发生。

您可以使用 Access 2003 在您的机器上重现该行为吗？

你如何真正声明你的变量？无论如何，您都应该设置 Option Explicit。

更新：

因为目标是尝试让 Access 2003 mdb（从 2007 年保存）工作。我会再尝试一件事。

使用 Access 2003 使用 /decompile 开关打开 mdb

*   备份您的 mdb
*   通过快捷方式打开您的 mdb（按住 SHIFT 键以停止运行任何代码）：msaccess.exe database.mdb /decompile
*   打开一个模块并编译您的应用程序
*   保存并关闭访问
*   再次打开（再次SHIFT）而不反编译
*   压缩和修复数据库
*   关闭访问

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T18:45:11.460

这不会对您有太大帮助，但是当我的一个客户切换到 Office 2007 时，我很快了解到我不应该在 2007 年使用 2003 数据库，然后尝试在 2003 年运行它。在 2007 年开发然后转换到 2003 年也不起作用。在 2003 年开发，然后在 2007 年运行 2003 db（没有转换）效果很好。大多数时候。

您问题第二部分的可能答案：1.将您的 2007 db 转换为 2003 格式。2\. 在 2003 中打开一个新的空 db 3\. 从转换的 2003 db 中导入所有对象。重新编译，并在您的客户端机器上尝试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-22T04:39:48.503

我也有这个问题。我花了 2 年时间开发连接到 SQL 后端的 Access 2003 前端。我开始使用 Access 2007，以为我所要做的就是以 2003 格式保存，一切都会好起来的。

不是这样。我所有仍在使用 2003 的用户都报告了问题。

这个问题最后很容易解决。我实际上并没有使用任何 2007 功能，因此更改的只是库引用。我缺少对 Word 和 Excel 12.0 库的 2 个引用，这些引用仅在 2007 年打开数据库时自动包含在内。

取出这些参考资料，我能够“修复”我的数据库，而无需恢复到早期版本。

# php - 为什么我应该在 php 中使用 __get() 和 __set()-magic 方法？

> ID：753021
> 
> 赞同：0
> 
> 时间：2009-04-15T18:17:39.670
> 
> 标签：php, setter, getter

> **可能重复：**
> [我什么时候应该/应该在 PHP 中使用 __construct()、__get()、__set() 和 __call()？](https://stackoverflow.com/questions/250616/when-do-should-i-use-construct-get-set-and-call-in-php)

这是我没有找到任何好的答案的一个领域。谁能向我解释为什么/如何正确使用它们？它们不只是一个糟糕的设计决定吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T18:20:25.297

我认为[文档](http://is.php.net/manual/en/language.oop5.overloading.php#language.oop5.overloading.members)解释得最好。它被称为重载。

> `__set()`在将数据写入不可访问的成员时运行。
> 
> `__get()`用于从不可访问的成员中读取数据。

它也有一些使用这些的例子。

# java - 本土实用方法

> ID：753029
> 
> 赞同：2
> 
> 时间：2009-04-15T18:19:06.843
> 
> 标签：java, utilities

OO 纯粹主义者通常不赞成静态实用程序方法。

然而，我想知道人们对用于避免在整个应用程序中进行空检查等简单操作的实用方法有何看法。

`String.trim()`在空字符串上调用时抛出 NPE。所以我必须这样做：

```
if(str!=null) 
     setValue(str.trim());
else
     setValue(""); 
```

如果我创建一个检查 null 的实用程序方法会怎样？

```
setValue(myTrim(str));

public static String myTrim(String str) {

  if(str==null) return "" 

  else return str.trim();
} 
```

我在使用此类方法时遇到的一个问题是团队中的一些开发人员可能不喜欢/不知道此实用程序，并且可能在进行空值比较后进行直接调用。

这也是你做你的框架的东西吗？如果是，人们创建并在他们的应用程序中使用的其他常见实用程序通用方法是什么？

你觉得这两种方法的优缺点是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-15T18:34:53.060

当现有库（如 Apache Commons Blah Blah Blah）已经编写了它时，我倾向于替换本土使用。您可以卸载给其他人的代码让您专注于软件的重要部分，这些部分真正将您的工作与其他人的工作区分开来。但是，是的，带有静态方法的实用程序类非常棒，如果它们需要你自己编写的话。

仅供参考，看看[StringUtils.trimToEmpty()](http://commons.apache.org/lang/api/org/apache/commons/lang/StringUtils.html#trimToEmpty(java.lang.String))。祝你好运。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T18:28:26.617

> *团队中的一些开发人员可能不喜欢/不知道这个实用程序*

这就是沟通的好处。我不是指电子邮件。

谈到这类功能，可能其他团队成员也在做同样的事情，如果不交流，你就是在重复代码和工作。

您可能会找到使用这些实用方法的方法，甚至一些更有经验的开发人员可能已经开发了更成熟的库或使用了第 3 方。

但无论如何，与你的**团队沟通**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T18:28:27.397

我不是一个OO纯粹主义者。所以我喜欢这样的东西。任何可以让编写反映我意图的代码变得更容易的东西，而不会陷入不相关的细节中。

写下来。自己使用。不要害羞——*展示*它让你的代码变得多么干净。最坏的情况，至少*你的*代码会少一点重复......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T20:02:32.023

就设计原则而言，有些东西只是逻辑上更静态的方法。如果您正在编写的实用程序类实际上没有任何“状态”，并且使用一堆静态方法使其无法实例化感觉更合乎逻辑，那么就这样做。但是要确保你的类是真正不可实例化的（给它一个私有构造函数；我见过人们将这个类声明为抽象的，但这并不好，因为人们可以覆盖它）。

然后您遇到的问题是，**如果您的类是项目范围的，则需要将其视为库类**。编写库与编写通用代码不同：

*   在一般代码中，您应该分析而不是过早地优化；但是在库方法中，您无法预测人们将来将如何使用您的调用；
*   您需要非常小心地记录或清楚地说明您的方法的作用；
*   你需要给它*通用*的行为，而不是被你当时需要的某些特定功能所蒙蔽（例如，如果你有一个“标记字符串”的方法，你如何处理空标记？如果*你*需要忽略它们，*其他*调用者会调用你的方法吗？）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T18:43:43.867

我有一些只包含最喜欢的静态方法的类——它们*确实*有意义。您可以将广泛的单元测试放在一起检查任何和所有边界条件。

在您描述的情况下 - 让 setValue 方法接受发送给它的任何字符串不是更好吗？然后，该方法可以应用默认的空字符串，修剪它，如果值不正确，甚至抛出异常。

然后，该例程上的 JavaDoc 可以清楚地说明哪些输入是有效/无效的，以及无效输入会发生什么。

不是说这是对的——只是另一种观点

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-15T21:50:37.100

我使用了很多实用功能。有些东西只是不需要“对象”，但我不喜欢你的 trim() 的特定示例。

对空字符串的引用与空字符串非常不同。除非应用程序非常简单，并且您知道您总是想将空引用读取为“”，否则我不会这样做。对于这种情况，我更喜欢：

```
setValue((str != null) ? str.trim() : "") 
```

对我来说，未捕获的 NPE 很好地表明应用程序中发生了重大错误！

# c# - GAE 上的 RoR？

> ID：753031
> 
> 赞同：5
> 
> 时间：2009-04-15T18:19:28.200
> 
> 标签：c#, java, ruby-on-rails, google-app-engine, jvm-languages

由于 Google App Engine 即将全面支持[Java](http://googleappengine.blogspot.com/2009/04/seriously-this-time-new-language-on-app.html)：

是否可以在 Google App Engine 上运行 Ruby on Rails？或者 AppEngine 运行时施加的限制会影响 JRuby 的实现？

Groovy、Clojure、Scheme 等其他语言呢？

是否有任何努力在 JVM 中支持 .net 和 C#？我认为这将在 web 开发上创建一个 NEXT 级别。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T19:09:20.060

这[已经成为可能](http://olabini.com/blog/2009/04/jruby-on-rails-on-google-app-engine/)。它并不完美，但我希望快速改进。

更多信息：

*   [官方工作图书馆清单](http://groups.google.com/group/google-appengine-java/web/will-it-play-in-app-engine)
*   [非官方工作图书馆清单](http://spreadsheets.google.com/pub?key=pRJ_0hajVrhacLjp3HqD5ew)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T18:22:47.333

看起来计划是最终支持这些技术。

[http://googleappengine.blogspot.com/2009/04/seriously-this-time-new-language-on-app.html](http://googleappengine.blogspot.com/2009/04/seriously-this-time-new-language-on-app.html)

如果您*可以*使用 GAE 的新技术来完成您想要的，我认为这样做对您有利。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T18:22:42.297

GAE 计划支持 JRuby on Rails、AFAIK。

.NET 和 C# 已经拥有自己的 VM，并且可以通过 Mono 在 Linux 下运行...如果您想要在 JVM (C#) 上使用低级语言，只需使用 Java，如果您想要要使用.NET，你最好留在微软世界。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-03T14:11:08.613

JRuby 已经得到支持，只要 GAE/Java 支持任何 JRE 语言。主要的困难——用户可以克服，而不需要谷歌支持——是使 ActiveRecord 与谷歌数据存储 API 一起工作。

不幸的是，我不熟悉 Ruby，所以我不能说这有多难。我敢肯定已经有人在做这件事了。

# c - What is the fastest way to decide if a digit appears in a string?

> ID：753036
> 
> 赞同：5
> 
> 时间：2009-04-15T18:20:59.227
> 
> 标签：c, performance, string

This simple solution popped into my mind quickly.

```
#include <ctype.h>

int digit_exists_in
(
    const char *s
)
{
    while (*s)
    {
        if (isdigit(*s))
        {
            return 1;
        }
        else
        {
            s++;
        }
    }

    return 0;
}

int main(void)
{
    int foundDigit = digit_exists_in("abcdefg9ijklmn");

    return 0;
} 
```

**What other techniques could be applied to get better speed?**

The actual strings being searched are variable length, and the characters themselves are ASCII, not the full character set. The strings are NUL terminated.

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-16T01:19:58.750

*liw.fi* is right, by the way. I was a bit surprised by this, since strcspn has to do a much more general problem than the isdigit() approach, but it seems to be the case:

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>
#include <assert.h>

#define NTESTS 10000
#define TESTSIZE 10000

char stest1[TESTSIZE];
char stest2[TESTSIZE];

int test_isdigit(char *s) {
    while (*s) {
        if (isdigit(*s)) return 1;
        s++;
    }
    return 0;
}

int test_range(char *s) {
    while (*s) {
        if ((*s >= '0') && (*s <= '9')) return 1;
        s++;
    }
    return 0;
}

int test_strcspn(char *s) {
    return s[strcspn(s, "0123456789")] != '\0';
}

int main(int argc, char **argv) {
    long int i;
    for (i=0; i<TESTSIZE; i++) {
        stest1[i] = stest2[i] = 'A' + i % 26;
    }
    stest2[TESTSIZE-1] = '5';

    int alg = atoi(argv[1]);

    switch (alg) {
        case 0:        
            printf("Testing strcspn\n");
            for (i=0; i<NTESTS; i++) {
                assert(test_strcspn(stest1) == 0);
                assert(test_strcspn(stest2) != 0);
            }
            break;
        case 1:
            printf("Testing isdigit() loop\n");
            for (i=0; i<NTESTS; i++) {
                assert(test_isdigit(stest1) == 0);
                assert(test_isdigit(stest2) != 0);
            }
            break;
        case 2:
            printf("Testing <= => loop\n");
            for (i=0; i<NTESTS; i++) {
                assert(test_range(stest1) == 0);
                assert(test_range(stest2) != 0);
            }
            break;
        default:
            printf("eh?\n");
            exit(1);
    }    

    return 0;
} 
```

It's awfully hard to beat the standard libraries at their own game ... (the usual caveats apply -- YMMV)

```
$ gcc -O6 -Wall -o strcspn strcspn.c 

$ time ./strcspn 0
Testing strcspn

real    0m0.085s
user    0m0.090s
sys 0m0.000s

$ time ./strcspn 1
Testing isdigit() loop

real    0m0.753s
user    0m0.750s
sys 0m0.000s

$ time ./strcspn 2
Testing <= => loop

real    0m0.247s
user    0m0.250s
sys 0m0.000s 
```

* * *

UPDATE: Just for fun, I added a bitmap lookup version based on Mike Dunlavey's answer:

```
char bitmap[256] = {
        /* 0x00 */ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        /* 0x10 */ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        /* 0x20 */ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        /* 0x30 */ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
};

int test_bitmap(char *s) {
    while (!bitmap[*(unsigned char *)s]) s++;
    return (*s);
} 
```

Which slightly outperforms the others (~.170s) but still can't touch strcspn!

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-15T19:33:59.487

I would start by using the appropriate library function, [strcspn](http://linux.die.net/man/3/strcspn), on the assumption that the library has been optimized with extreme prejudice:

```
#include <string.h>
#include <stdio.h>

int digit_exists_in(const char *s)
{
    return s[strcspn(s, "0123456789")] != '\0';
}

int main(void)
{
    printf("%d\n", digit_exists_in("foobar"));
    printf("%d\n", digit_exists_in("foobar1"));
    return 0;
} 
```

If the library hasn't been optimized sufficiently, it'd be a good idea to put the optimization into the library so everyone can benefit. (You have the source, right?)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-15T18:43:05.960

There isn't a faster algorithm, but you can look at a full register's worth of bytes per instruction or use SIMD operations to speed things up. You can either use a mask and zero test to see if it is even possible if there are any digits in a range, or if your SIMD operations are fast enough on large enough vectors, you could do iterate through tests for specific numerical values in a vector of bytes faster than doing character compares.

So, for example, you could do something like:

```
byte buffer[8] = { 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30 };
uint64 *mask = (uint64 *) buffer; //this is just for clarity

if (*((uint64 *) s) & *mask) == 0)
    //You now don't need to do the < '0' test for the next 8 bytes in s 
```

Some optimizers might be smart enough to do this for you just from your code sample above.

You had better be comparing a TON of bytes to be thinking about optimizations at this level though.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-15T18:23:14.493

Any algorithm will be O(N).

I assume isdigit is pretty efficient already.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-15T18:24:29.077

Conceptually there is no faster way. This is assuming that you have a string which where the placement of digits is seemingly random. This forces you to search every item in the string for a digit hence front to back is as likely to find the digit first as any other search mechanism.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-15T18:35:21.437

You could go multithreaded, although that's probably adding too much complexity to the algorithm for something that's already pretty fast.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-15T18:45:41.897

The real question is how important is it for this function to be optimal? I say leave the simple solution and profile it. You should only optimize it if it is causing a bottleneck in your code.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-15T19:16:08.733

Just for fun, maybe something allong the lines of:

```
 // accumulator
unsigned char thereIsADigit = 0;
// lookup table
unsigned char IsDigit[256] = {0,0,0 ..., 1,1,1,1,1,1,1,1,1,0,0,0 ...};

// an unrolled loop, something like:
thereIsADigit |= IsDigit[s[0]];
thereIsADigit |= IsDigit[s[1]];
thereIsADigit |= IsDigit[s[2]];
thereIsADigit |= IsDigit[s[3]];
thereIsADigit |= IsDigit[s[4]];
thereIsADigit |= IsDigit[s[5]];
thereIsADigit |= IsDigit[s[6]];
thereIsADigit |= IsDigit[s[7]];
if (thereIsADigit) break;
s += 8; 
```

On the IBM 360 there was a ["translate" instruction](http://publibfp.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/DZ9AR005/7.5.97?DT=19981021101933) that could do this in one step.

**OK, OK,** Christopher Smith's answer got me thinking. Suppose you are only using 7-bit ASCII. Here's a way to do SIMD with wide-integer arithmetic.

Suppose C is a 32-bit word containing 4 characters.

```
 // compare by subtracting in 8-bit 2s complement arithmetic
( (C + ((0x3a3a3a3a ^ 0x7f7f7f7f) + 0x01010101)) // set high bit for any char <= '9'
  &
  (0x2f2f2f2f + ((C ^ 0x7f7f7f7f) + 0x01010101)) // set high bit for any char >= '0'
) // high bit is set for any char <= '9' and >= '0'
& 0x80808080 // look only at the high-order bits
// if any of these 4 bits is 1, there is a digit in C
// if the result is zero, there are no digits in C 
```

It depends on the high-order bit of each character being initially zero, so that a carry into that bit will not propogate. (I'm sure this could be simplified.)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-18T04:03:52.613

Taking the test program and throwing my profiler at it yields the following.

```
 Count      %   % with           Time   Statement
                      child
-----------------------------------------------------------------------------------------------
                                             int test_isdigit(char *s)   
     20,000    0.0    0.0          2,160.4   {   
199,990,000   13.2    9.5     14,278,460.7       while (*s)  
                                                 {   
199,980,000   69.8   49.9     75,243,524.7            if (isdigit(*s)) return 1;  
199,970,000   17.0   12.1     18,312,971.5            s++;    
                                                 }   

     10,000    0.0    0.0          1,151.4       return 0;   
                                             }   

                                             int test_range(char *s)     
     20,000    0.0    0.0          1,734.2   {   
199,990,000   33.6    9.4     14,114,309.7       while (*s)  
                                                 {
199,980,000   32.2    9.0     13,534,938.6           if ((*s >= '0') && 
                                                        (*s <= '9')) return 1;   
199,970,000   34.2    9.5     14,367,161.9           s++;    
                                                 }   

     10,000    0.0    0.0          1,122.2       return 0;   
                                             }   

                                             int test_strcspn(char *s)   
     20,000    0.2    0.0          1,816.6   {   
     20,000   99.8    0.6        863,113.2       return s[strcspn(s, "0123456789")] 
                                                          == '0'; 
                                             } 
```

strcspn does the job well enough. Looking at the asm code for it, I see it builds a bitmap of size 256 sets the bits based on the search characters, then processes the string.

The bit map gets built on the stack once for every call.

One other approach would be to build and keep the bit map, and reused it each time.

Another approach would be to do the operations in parallel using the techniques that Chris Smith talked about.

For the moment strcspn will suffice.

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-15T18:26:49.367

if you really want to reduce the overhead time and you don't mind making it specific for char, then you can check the ascii values between 0 and 9 inclusive.

48 to 57 decimal

this removes a stack call.

I should have said lookup table as well...

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-15T18:28:47.100

As others have said, you can't get below O(N).

I can think of a contrived scenario with logarithmic speed... Say you're writing a text editor and it needs a "does this file contain any digits" feature. You can keep a sorted array of all unique characters present in the file, update it on every keystroke, and query it with binary search. This probably lies outside the scope of your question though (and can be done in several better ways).

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-16T01:43:42.377

Here's a version that may or may not be faster, but it handles a NULL pointer...

```
int digit_exists_in(const char *s)
{
    if (!s)
        return (0);
    while (*s)
        if (isdigit(*s++))
            return (1);
    return (0);
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-16T02:28:12.860

## Memory Prefetch

If your strings are very long, either get your compiler to do it or manually unroll your loop and drop in a memory prefetch instruction or two every cache-line.

That way while the CPU is scanning, the memory controller can be pulling in the next lines of data.

If you save the length of the string when you create it you can skip all the checks for the NUL byte, which means you can unroll your loop to operate in bigger chunks and reduce the number of compare and branch operations, although with current branch predictors, it honestly doesn't make much difference.

Even with great CPU branch predictors, the loop will slow down if it has to check the loop counter every time through the loop to decide when to do a memory prefetch so unrolling is still helpful in that case.

## Profiling Feedback

For best performance the CPU does need to get the branches hinted correctly, and that's where profiling feedback comes in very handy. Otherwise the compiler is just making a somewhat educated guess.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-15T19:48:45.210

Have a human look at it. Humans can do this in O(1) time, we have MUCH larger word sizes than even modern processors.

That said, actual time would still be better with your method...what with the difference in cycle time between a modern core and a human brain.

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-15T19:59:49.737

I may be wrong, but there may be a faster way.

Quicksort the string.

The serial search has a best time of O(1), a mean of O(1/2n) and worse case of O(n).

Quicksort has best O(log n), mean O(nlog n), worse case O(n^2).

The thing is, *you can bail out of the quicksort as soon as you see a digit*. If the quicksort actually completes, the digit will be at the beginning of the sorted string, so you'll find it then in O(1).

The achievement here it to shift the best, mean and worse case behaviours. A quicksort will have worse worst case behaviour, but better mean behaviour.

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-16T00:55:21.417

Of course, you can sacrifice accuracy for speed:

```
int digit_exists_in(const char* s)
{
    return 0;
} 
```

This algorithm has a complexity of O(1) and an approximacity of O((246/256)^N).

# python - 从 Python 中的字符串中去除 HTML

> ID：753052
> 
> 赞同：327
> 
> 时间：2009-04-15T18:24:26.503
> 
> 标签：python, html

```
from mechanize import Browser
br = Browser()
br.open('http://somewebpage')
html = br.response().readlines()
for line in html:
  print line 
```

在 HTML 文件中打印一行时，我试图找到一种只显示每个 HTML 元素的内容而不是格式本身的方法。如果找到`'<a href="whatever.com">some text</a>'`，它只会打印“一些文本”，`'<b>hello</b>'`打印“你好”等。如何去做呢？

* * *

## 回答 #1

> 赞同：490
> 
> 时间：2009-05-29T11:47:41.610

我总是使用这个函数来去除 HTML 标签，因为它只需要 Python 标准库：

对于 Python 3：

```
from io import StringIO
from html.parser import HTMLParser

class MLStripper(HTMLParser):
    def __init__(self):
        super().__init__()
        self.reset()
        self.strict = False
        self.convert_charrefs= True
        self.text = StringIO()
    def handle_data(self, d):
        self.text.write(d)
    def get_data(self):
        return self.text.getvalue()

def strip_tags(html):
    s = MLStripper()
    s.feed(html)
    return s.get_data() 
```

对于 Python 2：

```
from HTMLParser import HTMLParser
from StringIO import StringIO

class MLStripper(HTMLParser):
    def __init__(self):
        self.reset()
        self.text = StringIO()
    def handle_data(self, d):
        self.text.write(d)
    def get_data(self):
        return self.text.getvalue()

def strip_tags(html):
    s = MLStripper()
    s.feed(html)
    return s.get_data() 
```

* * *

## 回答 #2

> 赞同：180
> 
> 时间：2011-02-02T01:09:16.633

我对它会错过的情况没有太多考虑，但你可以做一个简单的正则表达式：

```
re.sub('<[^<]+?>', '', text) 
```

对于那些不理解正则表达式的人，这将搜索一个字符串`<...>`，其中内部内容由一个或多个 ( `+`) 字符组成，而不是`<`. 这`?`意味着它将匹配它可以找到的最小字符串。例如给定`<p>Hello</p>`的，它将与 . 匹配`<'p>`并`</p>`分开`?`。没有它，它将匹配整个 string `<..Hello..>`。

如果非标签`<`出现在 html 中（例如。`2 < 3`），它应该被写成一个转义序列`&...`，所以这`^<`可能是不必要的。

* * *

## 回答 #3

> 赞同：109
> 
> 时间：2015-12-30T15:31:13.693

您可以使用 BeautifulSoup[`get_text()`](https://www.crummy.com/software/BeautifulSoup/bs4/doc/#get-text)功能。

```
from bs4 import BeautifulSoup

html_str = '''
<td><a href="http://www.fakewebsite.com">Please can you strip me?</a>
<br/><a href="http://www.fakewebsite.com">I am waiting....</a>
</td>
'''
soup = BeautifulSoup(html_str)

print(soup.get_text()) 
#or via attribute of Soup Object: print(soup.text) 
```

建议明确指定[解析器](https://www.crummy.com/software/BeautifulSoup/bs4/doc/#specifying-the-parser-to-use)，例如 as `BeautifulSoup(html_str, features="html.parser")`，以使输出可重现。

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2013-11-01T15:51:12.463

## 简洁版本！

```
import re, cgi
tag_re = re.compile(r'(<!--.*?-->|<[^>]*>)')

# Remove well-formed tags, fixing mistakes by legitimate users
no_tags = tag_re.sub('', user_input)

# Clean up anything else by escaping
ready_for_web = cgi.escape(no_tags) 
```

[正则表达式来源： MarkupSafe](https://github.com/mitsuhiko/markupsafe/blob/0.23/markupsafe/__init__.py#L21)。他们的版本也处理 HTML 实体，而这个快速的版本没有。

## 为什么我不能直接剥离标签并留下它？

让人们远离`<i>italicizing</i>`事物是一回事，而不是让人们`i`四处飘荡。但接受任意输入并使其完全无害是另一回事。此页面上的大多数技术都会保留未封闭的注释 ( `<!--`) 和不属于标签 ( `blah <<<><blah`) 的尖括号等内容。HTMLParser 版本甚至可以留下完整的标签，如果它们在一个未封闭的评论中。

如果您的模板是`{{ firstname }} {{ lastname }}`怎么办？ `firstname = '<a'`并且`lastname = 'href="http://evil.com/">'`将被此页面上的每个标签剥离器（@Medeiros 除外！）允许通过，因为它们本身并不是完整的标签。去除普通的 HTML 标签是不够的。

Django's`strip_tags`是这个问题的最佳答案的改进（见下一个标题）版本，它给出了以下警告：

> 绝对不保证生成的字符串是 HTML 安全的。因此，切勿在`strip_tags`不先转义的情况下将调用结果标记为安全，例如使用`escape()`.

听从他们的建议！

## 要使用 HTMLParser 去除标签，您必须多次运行它。

**绕过这个问题的最佳答案很容易。**

看看这个字符串（[来源和讨论](https://www.mehmetince.net/django-strip_tags-bypass-vulnerability-exploit/)）：

```
<img<!-- --> src=x onerror=alert(1);//><!-- --> 
```

HTMLParser 第一次看到它时，无法判断它`<img...>`是一个标签。它看起来坏了，所以 HTMLParser 没有摆脱它。它只取出`<!-- comments -->`, 留给你

```
<img src=x onerror=alert(1);//> 
```

这个问题在 2014 年 3 月被披露给 Django 项目。他们的 old`strip_tags`与这个问题的 top answer 基本相同。 [他们的新版本](https://github.com/django/django/blob/1.7.7/django/utils/html.py#L170)基本上循环运行它，直到再次运行它不会改变字符串：

```
# _strip_once runs HTMLParser once, pulling out just the text of all the nodes.

def strip_tags(value):
    """Returns the given HTML with all tags stripped."""
    # Note: in typical case this loop executes _strip_once once. Loop condition
    # is redundant, but helps to reduce number of executions of _strip_once.
    while '<' in value and '>' in value:
        new_value = _strip_once(value)
        if len(new_value) >= len(value):
            # _strip_once was not able to detect more tags
            break
        value = new_value
    return value 
```

当然，如果你总是逃避`strip_tags()`.

**2015 年 3 月 19 日更新**：在 1.4.20、1.6.11、1.7.7 和 1.8c1 之前的 Django 版本中存在一个错误。这些版本可能会在 strip_tags() 函数中进入无限循环。上面复制了固定版本。 [更多细节在这里](https://www.djangoproject.com/weblog/2015/mar/18/security-releases/)。

## 好东西可以复制或使用

我的示例代码不处理 HTML 实体 - Django 和 MarkupSafe 打包版本可以。

我的示例代码是从优秀的[MarkupSafe](https://pypi.python.org/pypi/MarkupSafe)库中提取的，用于防止跨站点脚本。它方便快捷（使用 C 加速到其原生 Python 版本）。它包含在[Google App Engine](https://developers.google.com/appengine/docs/python/tools/libraries27)中，供[Jinja2（2.7 及更高版本）](http://jinja.pocoo.org/docs/intro/#markupsafe-dependency)、Mako、Pylons 等使用。它可以轻松地与 Django 1.7 中的 Django 模板一起使用。

Django 的 strip_tags 和*最近版本*的其他 html 实用程序很好，但我发现它们不如 MarkupSafe 方便。它们非常独立，你可以从[这个文件](https://github.com/django/django/blob/1.7.1/django/utils/html.py)中复制你需要的东西。

如果你需要去除*几乎*所有的标签，[Bleach](http://bleach.readthedocs.org/en/latest/)库很好。您可以让它强制执行诸如“我的用户可以将事物斜体，但他们不能制作 iframe”之类的规则。

了解标签剥离器的属性！对其进行模糊测试！ [这是](https://gist.github.com/tgs/5b6bba6891565762fe39)我用来研究这个答案的代码。

*尴尬的注释*- 问题本身是关于打印到控制台的，但这是“python 从字符串中剥离 html”的最高 Google 结果，所以这就是为什么这个答案是关于网络的 99%。

* * *

## 回答 #5

> 赞同：34
> 
> 时间：2011-10-15T14:19:55.690

我需要一种去除标签*并将*HTML 实体解码为纯文本的方法。以下解决方案基于 Eloff 的回答（我无法使用，因为它会剥离实体）。

```
import html.parser

class HTMLTextExtractor(html.parser.HTMLParser):
    def __init__(self):
        super(HTMLTextExtractor, self).__init__()
        self.result = [ ]

    def handle_data(self, d):
        self.result.append(d)

    def get_text(self):
        return ''.join(self.result)

def html_to_text(html):
    """Converts HTML to plain text (stripping tags and converting entities).
    >>> html_to_text('<a href="#">Demo<!--...--> <em>(&not; \u0394&#x03b7;&#956;&#x03CE;)</em></a>')
    'Demo (\xac \u0394\u03b7\u03bc\u03ce)'

    "Plain text" doesn't mean result can safely be used as-is in HTML.
    >>> html_to_text('&lt;script&gt;alert("Hello");&lt;/script&gt;')
    '<script>alert("Hello");</script>'

    Always use html.escape to sanitize text before using in an HTML context!

    HTMLParser will do its best to make sense of invalid HTML.
    >>> html_to_text('x < y &lt z <!--b')
    'x < y < z '

    Named entities are handled as per HTML 5.
    >>> html_to_text('&nosuchentity; &apos; ')
    "&nosuchentity; ' "
    """
    s = HTMLTextExtractor()
    s.feed(html)
    return s.get_text() 
```

快速测试：

```
html = '<a href="#">Demo <em>(&not; \u0394&#x03b7;&#956;&#x03CE;)</em></a>'
print(repr(html_to_text(html))) 
```

结果：

```
'Demo (¬ Δημώ)' 
```

**安全注意事项：**不要将 HTML*剥离*（将 HTML 转换为纯文本）与 HTML*清理*（将纯文本转换为 HTML）混淆。此答案将删除 HTML 并将实体解码为纯文本 - 这不会使结果在 HTML 上下文中安全使用。

示例：`&lt;script&gt;alert("Hello");&lt;/script&gt;`将转换为`<script>alert("Hello");</script>`，这是 100% 正确的行为，但如果将生成的纯文本按原样插入 HTML 页面，显然还不够。

规则并不难：*任何时候*你在 HTML 输出中插入一个纯文本字符串，*总是*HTML 转义它（使用[`html.escape(s)`](https://docs.python.org/3/library/html.html#html.escape)），即使你“知道”它不包含 HTML（例如，因为你剥离了 HTML 内容）。

但是，OP 询问是否将结果打印到*控制台*，在这种情况下不需要 HTML 转义。相反，您可能想要去除 ASCII 控制字符，因为它们会触发不需要的行为（尤其是在 Unix 系统上）：

```
import re
text = html_to_text(untrusted_html_input)
clean_text = re.sub(r'[\0-\x1f\x7f]+', '', text)
# Alternatively, if you want to allow newlines:
# clean_text = re.sub(r'[\0-\x09\x0b-\x1f\x7f]+', '', text)
print(clean_text) 
```

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2013-01-22T17:22:29.730

有一个简单的方法：

```
def remove_html_markup(s):
    tag = False
    quote = False
    out = ""

    for c in s:
        if c == '<' and not quote:
            tag = True
        elif c == '>' and not quote:
            tag = False
        elif (c == '"' or c == "'") and tag:
            quote = not quote
        elif not tag:
            out = out + c

    return out 
```

这个想法在这里解释：http: [//youtu.be/2tu9LTDujbw](http://youtu.be/2tu9LTDujbw)

你可以在这里看到它的工作：http: [//youtu.be/HPkNPcYed9M ?t=35s](http://youtu.be/HPkNPcYed9M?t=35s)

PS - 如果您对课程感兴趣（关于使用 python 进行智能调试），我给您一个链接：[http](http://www.udacity.com/overview/Course/cs259/CourseRev/1) ://www.udacity.com/overview/Course/cs259/CourseRev/1 。免费！

别客气！:)

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2012-12-04T13:25:42.427

如果您需要保留 HTML 实体（即），我在[Eloff 的回答](https://stackoverflow.com/a/925630/1094246)`&amp;`中添加了“handle_entityref”方法。

```
from HTMLParser import HTMLParser

class MLStripper(HTMLParser):
    def __init__(self):
        self.reset()
        self.fed = []
    def handle_data(self, d):
        self.fed.append(d)
    def handle_entityref(self, name):
        self.fed.append('&%s;' % name)
    def get_data(self):
        return ''.join(self.fed)

def html_to_text(html):
    s = MLStripper()
    s.feed(html)
    return s.get_data() 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2017-02-25T21:19:32.577

基于[lxml.html](http://lxml.de/lxmlhtml.html)的解决方案（lxml 是本机库，比纯 python 解决方案性能更高）。

要安装[`lxml`](https://lxml.de/)模块，请使用`pip install lxml`

### 删除所有标签

```
from lxml import html

## from file-like object or URL
tree = html.parse(file_like_object_or_url)

## from string
tree = html.fromstring('safe <script>unsafe</script> safe')

print(tree.text_content().strip())

### OUTPUT: 'safe unsafe safe' 
```

### 使用预清理 HTML 删除所有标签（删除一些标签）

```
from lxml import html
from lxml.html.clean import clean_html

tree = html.fromstring("""<script>dangerous</script><span class="item-summary">
                            Detailed answers to any questions you might have
                        </span>""")

## text only
print(clean_html(tree).text_content().strip())

### OUTPUT: 'Detailed answers to any questions you might have' 
```

> 另请参阅[http://lxml.de/lxmlhtml.html#cleaning-up-html](http://lxml.de/lxmlhtml.html#cleaning-up-html)了解 lxml.cleaner 的作用。

如果您需要更多地控制在转换为文本之前应该删除哪些标签，然后使用所需的[选项创建一个自定义](http://lxml.de/api/lxml.html.clean.Cleaner-class.html)[lxml Cleaner](http://lxml.de/api/lxml.html.clean.Cleaner-class.html)，例如：

```
cleaner = Cleaner(page_structure=True,
                  meta=True,
                  embedded=True,
                  links=True,
                  style=True,
                  processing_instructions=True,
                  inline_style=True,
                  scripts=True,
                  javascript=True,
                  comments=True,
                  frames=True,
                  forms=True,
                  annoying_tags=True,
                  remove_unknown_tags=True,
                  safe_attrs_only=True,
                  safe_attrs=frozenset(['src','color', 'href', 'title', 'class', 'name', 'id']),
                  remove_tags=('span', 'font', 'div')
                  )
sanitized_html = cleaner.clean_html(unsafe_html) 
```

要自定义如何生成纯文本，您可以使用[`lxml.etree.tostring`](https://lxml.de/api/lxml.etree-module.html#tostring)而不是`text_content()`：

```
plain_bytes = tostring(tree, method='text', encoding='utf-8')
print(plain.decode('utf-8')) 
```

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2019-11-28T17:20:01.430

这是一个简单的解决方案，它基于惊人的快速[`lxml`](http://lxml.de/lxmlhtml.html)库去除 HTML 标记并解码 HTML 实体：

```
from lxml import html

def strip_html(s):
    return str(html.fromstring(s).text_content())

strip_html('Ein <a href="">sch&ouml;ner</a> Text.')  # Output: Ein schöner Text. 
```

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2013-01-30T11:47:49.103

如果你想去除所有 HTML 标签，我发现最简单的方法是使用 BeautifulSoup：

```
from bs4 import BeautifulSoup  # Or from BeautifulSoup import BeautifulSoup

def stripHtmlTags(htmlTxt):
    if htmlTxt is None:
            return None
        else:
            return ''.join(BeautifulSoup(htmlTxt).findAll(text=True)) 
```

我尝试了接受答案的代码，但我得到了“RuntimeError：超出了最大递归深度”，上面的代码块没有发生这种情况。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2017-05-28T09:33:05.913

Beautiful Soup 套餐会立即为您完成这项工作。

```
from bs4 import BeautifulSoup

soup = BeautifulSoup(html)
text = soup.get_text()
print(text) 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2018-10-19T16:28:53.527

这是一个类似于当前接受的答案（[https://stackoverflow.com/a/925630/95989](https://stackoverflow.com/a/925630/95989)）的解决方案，除了它`HTMLParser`直接使用内部类（即没有子类化），从而使其更加简洁：

```
def strip_html（文本）：
    部分= []                                                                      
    解析器 = HTMLParser()                                                           
    parser.handle_data = part.append                                               
    parser.feed（文本）                                                               
    返回''.join（部分）

```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2019-02-18T13:05:57.603

这是我对 python 3 的解决方案。

```
import html
import re

def html_to_txt(html_text):
    ## unescape html
    txt = html.unescape(html_text)
    tags = re.findall("<[^>]+>",txt)
    print("found tags: ")
    print(tags)
    for tag in tags:
        txt=txt.replace(tag,'')
    return txt 
```

不确定它是否完美，但解决了我的用例并且看起来很简单。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-04-15T18:31:01.433

您可以使用不同的 HTML 解析器（[如 lxml](http://codespeak.net/lxml/)或[Beautiful Soup](http://www.crummy.com/software/BeautifulSoup/)）——一个提供仅提取文本的功能的解析器。或者，您可以在去除标签的行字符串上运行正则表达式。有关更多信息，请参阅[Python 文档](http://docs.python.org/howto/regex)。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-06-18T15:29:15.753

我已经成功地将 Eloff 的答案用于 Python 3.1 [非常感谢！]。

我升级到 Python 3.2.3，但遇到了错误。

感谢响应者 Thomas K[在此](https://stackoverflow.com/questions/11061058/using-htmlparser-in-python-3-2)提供的解决方案是插入`super().__init__()`以下代码：

```
def __init__(self):
    self.reset()
    self.fed = [] 
```

...为了使它看起来像这样：

```
def __init__(self):
    super().__init__()
    self.reset()
    self.fed = [] 
```

...它适用于 Python 3.2.3。

再次感谢 Thomas K 的修复以及上面提供的 Eloff 的原始代码！

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2014-01-24T12:58:15.850

使用 HTML-Parser 的解决方案都是易碎的，如果它们只运行一次：

```
html_to_text('<<b>script>alert("hacked")<</b>/script> 
```

结果是：

```
<script>alert("hacked")</script> 
```

你打算阻止什么。如果您使用 HTML 解析器，请计算标签，直到替换为零：

```
from HTMLParser import HTMLParser

class MLStripper(HTMLParser):
    def __init__(self):
        self.reset()
        self.fed = []
        self.containstags = False

    def handle_starttag(self, tag, attrs):
       self.containstags = True

    def handle_data(self, d):
        self.fed.append(d)

    def has_tags(self):
        return self.containstags

    def get_data(self):
        return ''.join(self.fed)

def strip_tags(html):
    must_filtered = True
    while ( must_filtered ):
        s = MLStripper()
        s.feed(html)
        html = s.get_data()
        must_filtered = s.has_tags()
    return html 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-08-07T03:45:42.133

这是一个快速修复，可以进一步优化，但它会正常工作。此代码将用“”替换所有非空标签，并从给定的输入文本中去除所有 html 标签。您可以使用 ./file.py 输入输出运行它

```
 #!/usr/bin/python
import sys

def replace(strng,replaceText):
    rpl = 0
    while rpl > -1:
        rpl = strng.find(replaceText)
        if rpl != -1:
            strng = strng[0:rpl] + strng[rpl + len(replaceText):]
    return strng

lessThanPos = -1
count = 0
listOf = []

try:
    #write File
    writeto = open(sys.argv[2],'w')

    #read file and store it in list
    f = open(sys.argv[1],'r')
    for readLine in f.readlines():
        listOf.append(readLine)         
    f.close()

    #remove all tags  
    for line in listOf:
        count = 0;  
        lessThanPos = -1  
        lineTemp =  line

            for char in lineTemp:

            if char == "<":
                lessThanPos = count
            if char == ">":
                if lessThanPos > -1:
                    if line[lessThanPos:count + 1] != '<>':
                        lineTemp = replace(lineTemp,line[lessThanPos:count + 1])
                        lessThanPos = -1
            count = count + 1
        lineTemp = lineTemp.replace("&lt","<")
        lineTemp = lineTemp.replace("&gt",">")                  
        writeto.write(lineTemp)  
    writeto.close() 
    print "Write To --- >" , sys.argv[2]
except:
    print "Help: invalid arguments or exception"
    print "Usage : ",sys.argv[0]," inputfile outputfile" 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-05-16T08:02:16.937

søren-løvborg 答案的 python 3 改编版

```
from html.parser import HTMLParser
from html.entities import html5

class HTMLTextExtractor(HTMLParser):
    """ Adaption of http://stackoverflow.com/a/7778368/196732 """
    def __init__(self):
        super().__init__()
        self.result = []

    def handle_data(self, d):
        self.result.append(d)

    def handle_charref(self, number):
        codepoint = int(number[1:], 16) if number[0] in (u'x', u'X') else int(number)
        self.result.append(unichr(codepoint))

    def handle_entityref(self, name):
        if name in html5:
            self.result.append(unichr(html5[name]))

    def get_text(self):
        return u''.join(self.result)

def html_to_text(html):
    s = HTMLTextExtractor()
    s.feed(html)
    return s.get_text() 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-01-15T12:52:41.220

对于一个项目，我需要剥离 HTML，还需要 css 和 js。因此，我对 Eloffs 的回答做了一个变体：

```
class MLStripper(HTMLParser):
    def __init__(self):
        self.reset()
        self.strict = False
        self.convert_charrefs= True
        self.fed = []
        self.css = False
    def handle_starttag(self, tag, attrs):
        if tag == "style" or tag=="script":
            self.css = True
    def handle_endtag(self, tag):
        if tag=="style" or tag=="script":
            self.css=False
    def handle_data(self, d):
        if not self.css:
            self.fed.append(d)
    def get_data(self):
        return ''.join(self.fed)

def strip_tags(html):
    s = MLStripper()
    s.feed(html)
    return s.get_data() 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-10-04T15:26:49.540

您可以编写自己的函数：

```
def StripTags(text):
     finished = 0
     while not finished:
         finished = 1
         start = text.find("<")
         if start >= 0:
             stop = text[start:].find(">")
             if stop >= 0:
                 text = text[:start] + text[start+stop+1:]
                 finished = 0
     return text 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2016-01-02T10:10:52.717

我正在解析 Github 自述文件，发现以下内容确实运行良好：

```
import re
import lxml.html

def strip_markdown(x):
    links_sub = re.sub(r'\[(.+)\]\([^\)]+\)', r'\1', x)
    bold_sub = re.sub(r'\*\*([^*]+)\*\*', r'\1', links_sub)
    emph_sub = re.sub(r'\*([^*]+)\*', r'\1', bold_sub)
    return emph_sub

def strip_html(x):
    return lxml.html.fromstring(x).text_content() if x else '' 
```

进而

```
readme = """<img src="https://raw.githubusercontent.com/kootenpv/sky/master/resources/skylogo.png" />

            sky is a web scraping framework, implemented with the latest python versions in mind (3.4+). 
            It uses the asynchronous `asyncio` framework, as well as many popular modules 
            and extensions.

            Most importantly, it aims for **next generation** web crawling where machine intelligence 
            is used to speed up the development/maintainance/reliability of crawling.

            It mainly does this by considering the user to be interested in content 
            from *domains*, not just a collection of *single pages*
            ([templating approach](#templating-approach))."""

strip_markdown(strip_html(readme)) 
```

正确删除所有降价和 html。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-12-27T14:41:49.913

使用 BeautifulSoup、html2text 或来自@Eloff 的代码，大多数时候，它仍然是一些 html 元素、javascript 代码......

因此，您可以使用这些库的组合并删除降价格式（Python 3）：

```
import re
import html2text
from bs4 import BeautifulSoup
def html2Text(html):
    def removeMarkdown(text):
        for current in ["^[ #*]{2,30}", "^[ ]{0,30}\d\\\.", "^[ ]{0,30}\d\."]:
            markdown = re.compile(current, flags=re.MULTILINE)
            text = markdown.sub(" ", text)
        return text
    def removeAngular(text):
        angular = re.compile("[{][|].{2,40}[|][}]|[{][*].{2,40}[*][}]|[{][{].{2,40}[}][}]|\[\[.{2,40}\]\]")
        text = angular.sub(" ", text)
        return text
    h = html2text.HTML2Text()
    h.images_to_alt = True
    h.ignore_links = True
    h.ignore_emphasis = False
    h.skip_internal_links = True
    text = h.handle(html)
    soup = BeautifulSoup(text, "html.parser")
    text = soup.text
    text = removeAngular(text)
    text = removeMarkdown(text)
    return text 
```

它对我来说很好，但它可以增强，当然......

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-04-08T09:45:24.373

简单的代码！这将删除其中的所有类型的标签和内容。

```
def rm(s):
    start=False
    end=False
    s=' '+s
    for i in range(len(s)-1):
        if i<len(s):
            if start!=False:
                if s[i]=='>':
                    end=i
                    s=s[:start]+s[end+1:]
                    start=end=False
            else:
                if s[i]=='<':
                    start=i
    if s.count('<')>0:
        self.rm(s)
    else:
        s=s.replace('&nbsp;', ' ')
        return s 
```

**但是如果文本中包含<>**符号，它不会给出完整的结果。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-12-08T10:35:11.777

```
# This is a regex solution.
import re
def removeHtml(html):
  if not html: return html
  # Remove comments first
  innerText = re.compile('<!--[\s\S]*?-->').sub('',html)
  while innerText.find('>')>=0: # Loop through nested Tags
    text = re.compile('<[^<>]+?>').sub('',innerText)
    if text == innerText:
      break
    innerText = text

  return innerText.strip() 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-08-19T08:43:26.983

**2020 更新**

使用[Mozilla Bleach 库](https://github.com/mozilla/bleach)，它确实可以让您自定义要保留的标签和要保留的属性，还可以根据值过滤掉属性

这里有2个案例来说明

**1) 不允许任何 HTML 标签或属性**

获取样本原始文本

```
raw_text = """
<p><img width="696" height="392" src="https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-768x432.jpg" class="attachment-medium_large size-medium_large wp-post-image" alt="Ethereum Classic 51% Attack: Okex Crypto Exchange Suffers $5.6 Million Loss, Contemplates Delisting ETC" style="float:left; margin:0 15px 15px 0;" srcset="https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-768x432.jpg 768w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-300x169.jpg 300w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-1024x576.jpg 1024w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-696x392.jpg 696w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-1068x601.jpg 1068w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-747x420.jpg 747w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-190x107.jpg 190w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-380x214.jpg 380w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-760x428.jpg 760w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc.jpg 1280w" sizes="(max-width: 696px) 100vw, 696px" />Cryptocurrency exchange Okex reveals it suffered the $5.6 million loss as a result of the double-spend carried out by the attacker(s) in Ethereum Classic 51% attack. Okex says it fully absorbed the loss as per its user-protection policy while insisting that the attack did not cause any loss to the platform&#8217;s users. Also as part [&#8230;]</p>
<p>The post <a rel="nofollow" href="https://news.bitcoin.com/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc/">Ethereum Classic 51% Attack: Okex Crypto Exchange Suffers $5.6 Million Loss, Contemplates Delisting ETC</a> appeared first on <a rel="nofollow" href="https://news.bitcoin.com">Bitcoin News</a>.</p> 
""" 
```

**2) 从原始文本中删除所有 HTML 标记和属性**

```
# DO NOT ALLOW any tags or any attributes
from bleach.sanitizer import Cleaner
cleaner = Cleaner(tags=[], attributes={}, styles=[], protocols=[], strip=True, strip_comments=True, filters=None)
print(cleaner.clean(raw_text)) 
```

**输出**

```
Cryptocurrency exchange Okex reveals it suffered the $5.6 million loss as a result of the double-spend carried out by the attacker(s) in Ethereum Classic 51% attack. Okex says it fully absorbed the loss as per its user-protection policy while insisting that the attack did not cause any loss to the platform&#8217;s users. Also as part [&#8230;]
The post Ethereum Classic 51% Attack: Okex Crypto Exchange Suffers $5.6 Million Loss, Contemplates Delisting ETC appeared first on Bitcoin News. 
```

**3 只允许带有 srcset 属性的 img 标签**

```
from bleach.sanitizer import Cleaner
# ALLOW ONLY img tags with src attribute
cleaner = Cleaner(tags=['img'], attributes={'img': ['srcset']}, styles=[], protocols=[], strip=True, strip_comments=True, filters=None)
print(cleaner.clean(raw_text)) 
```

**输出**

```
<img srcset="https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-768x432.jpg 768w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-300x169.jpg 300w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-1024x576.jpg 1024w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-696x392.jpg 696w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-1068x601.jpg 1068w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-747x420.jpg 747w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-190x107.jpg 190w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-380x214.jpg 380w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc-760x428.jpg 760w, https://news.bitcoin.com/wp-content/uploads/2020/08/ethereum-classic-51-attack-okex-crypto-exchange-suffers-5-6-million-loss-contemplates-delisting-etc.jpg 1280w">Cryptocurrency exchange Okex reveals it suffered the $5.6 million loss as a result of the double-spend carried out by the attacker(s) in Ethereum Classic 51% attack. Okex says it fully absorbed the loss as per its user-protection policy while insisting that the attack did not cause any loss to the platform&#8217;s users. Also as part [&#8230;]
The post Ethereum Classic 51% Attack: Okex Crypto Exchange Suffers $5.6 Million Loss, Contemplates Delisting ETC appeared first on Bitcoin News. 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-06-16T15:05:15.077

我就是这样做的，但我不知道我在做什么。我通过去除 HTML 标记从 HTML 表中获取数据。

这接受字符串“name”并返回不带 HTML 标记的字符串“name1”。

```
x = 0
anglebrackets = 0
name1 = ""
while x < len(name):

    if name[x] == "<":
        anglebrackets = anglebrackets + 1
    if name[x] == ">":
        anglebrackets = anglebrackets - 1
    if anglebrackets == 0:
        if name[x] != ">":
            name1 = name1 + name[x]
    x = x + 1 
```

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2011-02-02T01:23:05.147

这种方法对我来说完美无缺，不需要额外的安装：

```
import re
import htmlentitydefs

def convertentity(m):
    if m.group(1)=='#':
        try:
            return unichr(int(m.group(2)))
        except ValueError:
            return '&#%s;' % m.group(2)
        try:
            return htmlentitydefs.entitydefs[m.group(2)]
        except KeyError:
            return '&%s;' % m.group(2)

def converthtml(s):
    return re.sub(r'&(#?)(.+?);',convertentity,s)

html =  converthtml(html)
html.replace("&nbsp;", " ") ## Get rid of the remnants of certain formatting(subscript,superscript,etc). 
```

# css - Internet Explorer 不显示在 Visual Studio 设计器中设置样式的链接

> ID：753062
> 
> 赞同：0
> 
> 时间：2009-04-15T18:25:36.483
> 
> 标签：css, visual-studio, internet-explorer, designer

我使用母版页和主题。在发现样式在浏览器中无法正常工作后，我获取了渲染的 html 并在 Visual Studio 中创建了一个 html 页面，以便在设计器中查看所有内容。我发现风格在视觉工作室设计者中正确显示。当我试图在 IE 中查看页面时，样式再次不起作用。

这是样式：

```
#menu div.menu a
{
    display: block;
    color: #FFFF00;
    font-weight:bold;
} 
```

这是HTML代码：

```
<body>
<form name="aspnetForm" method="post" action="Welcome.aspx" id="aspnetForm">
<div>
    <input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUKMjA5MTQxNjgzNWRkziD2ncxUdFPJZHawenZNb39FJFc=" />
</div>

<div id="container">
    <div id="header">
        <h1>Site name</h1>
    </div> 
    <div id="mainnav"></div> 
    <div id="menu">
        <div class="menu">

            <a id="ctl00_cphRight1_LoginView1_hlLogin" href="Login.aspx">Login</a>

        </div>
    </div>
    <div id="contents">
    </div>
    <div id="footer">
    </div>
</div>
</form>
</body> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T18:33:54.950

该规则应适用于

```
#menu div.menu a 
```

你错过了领先的#

# ruby-on-rails - 如何从 Rails 中的 URL 查询中解析多值字段

> ID：753067
> 
> 赞同：8
> 
> 时间：2009-04-15T18:27:48.133
> 
> 标签：ruby-on-rails, ruby, http

我有一个形式的 URL`http://www.example.com?foo=one&foo=two`

我想获取 的值数组`['one', 'two']`，`foo`但`params[:foo]`只返回第一个值。

我知道如果我在 URL 中使用`foo[]`而不是，那么会给我所需的数组。`foo``params[:foo]`

但是，如果可能，我想避免更改 URL 的结构，因为它的形式是作为规范提供给客户端应用程序的。有没有一种在不更改参数名称的情况下获取所有值的好方法？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-15T19:33:07.617

您可以使用默认的 Ruby CGI 模块来解析 Rails 控制器中的查询字符串，如下所示：

```
params = CGI.parse(request.query_string) 
```

这将为您提供所需的内容，但请注意，您不会获得任何 Rails 其他扩展来查询字符串解析，例如 using `HashWithIndifferentAccess`，因此您将不得不使用 String 而不是 Symbol 键。

另外，我不相信你可以用一行来设置这样的参数并覆盖默认的 rails 参数内容。根据您希望此更改的广泛程度，您可能需要修改补丁或稍微修改内部结构。但是，如果您想要进行全局更改，那么快速的方法是将其放入 before 过滤器中`application.rb`并使用新的实例 var，例如`@raw_params`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T19:37:45.127

我喜欢另一个答案中提到的 CGI.parse(request.query_string) 解决方案。您可以这样做将自定义解析的查询字符串合并到参数中：

```
params.merge!(CGI.parse(request.query_string).symbolize_keys) 
```

# php - 如何在PHP中读取大文件之前获取总行数

> ID：753069
> 
> 赞同：3
> 
> 时间：2009-04-15T18:28:09.163
> 
> 标签：php, file-io

我已经在使用这个[如何在 PHP 中逐行读取大数据文件的示例](https://stackoverflow.com/questions/162176/reading-very-large-files-in-php/162263#162263)

现在，它想要做的是获取文件中的总行数，以便我可以显示完成百分比或至少显示总行数，以便我可以提供一些关于剩下多少处理的想法要完成。

有没有办法在不读取整个文件两次的情况下获得总行数？（一次计算行数，一次进行处理）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-15T18:30:20.950

穷人 回复:

不，但你可以估计。计算一个简单的平均读数（使用前 250 行）然后继续。

```
estNumOfLines = sizeOfFile / avgLineSize 
```

您可以在创建文件时存储文件中的行数...

***或者，您可以显示已处理的 KB 数，这将非常准确。***

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-15T18:33:10.490

您可以确定文件的大小，然后通过将读取的大小相加来衡量您的进度：

```
$fname = 'foofile.txt';
$fsize = filesize($fname);
$count = 0;
$handle = fopen($fname, "r") or die("Couldn't get handle");
if ($handle) {
  while (!feof($handle)) {
    $buffer = fgets($handle, 4096);
    // Process buffer here..
    $count++;
    echo ($count * 4096)/$fsize . " percent read.";
  }
  fclose($handle);
} 
```

注意：代码改编自[参考答案](https://stackoverflow.com/questions/162176/reading-very-large-files-in-php/162263#162263)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T18:33:58.570

有什么理由需要计算行数而不是字节数吗？如果您只想知道“完成百分比”，只需按读取的字节数/总字节数跟踪它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T21:29:36.120

使用 linux 命令`wc -l filename.txt` 这将输出文件中的行数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T18:32:21.087

如果不数一数，你怎么知道一本书的页数？
你会测量一页的宽度和书的宽度，然后除以另一个。

同样在这里，从前几行计算平均行长度，然后对文件大小进行相同的数学运算...

# windows - Windows 的 C# 登录自动化（XP、Vista 等）

> ID：753076
> 
> 赞同：0
> 
> 时间：2009-04-15T18:30:07.427
> 
> 标签：windows, windows-vista, windows-xp, login

我有一个身份验证密钥（USB 加密狗），我想用它来代替登录 Windows。加密狗不仅仅是一个简单的拇指驱动器，它还是一个专门用于软件认证的加密狗。

我已经看过有关如何使用 Phidg​​ets RFID 套件执行此操作的教程，但是我现在似乎无法在任何地方找到该教程。

基本上我需要在启动时寻找这个键的东西。我已经有了查找密钥的代码，我只需要能够真正告诉系统登录。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T19:27:32.280

我怀疑您是否想在 C# 中编写类似的内容，但[本文](http://msdn.microsoft.com/en-us/magazine/cc163489.aspx)概述了如何自定义登录体验的基础知识。请注意，机制在 XP 和 Vista 之间发生了变化，因此如果您想同时支持两者，您可能需要编写两个不同的组件。

# php - cURL 可以用来从 PHP 文件中读取 PHP 代码吗？

> ID：753081
> 
> 赞同：2
> 
> 时间：2009-04-15T18:30:27.627
> 
> 标签：php, security, curl

我真的不明白[cURL](http://en.wikipedia.org/wiki/CURL)是如何工作的。它可以从 PHP 文件中读取未解析的[PHP](http://en.wikipedia.org/wiki/PHP)代码吗？如果是这样，如何阻止一些黑客读取连接到我的数据库的脚本并窃取登录信息？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-15T18:33:42.860

否——无论何时发出任何类型的请求，服务器都会解析 PHP 代码。因此，如果您使用 cURL 从 Web 下载 PHP 文件，您将获得其解析后的 H​​TML 输出。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-15T18:33:48.400

不，它不能。cURL 所做的只是访问一个 URL，就像您使用浏览器访问它一样。如果您可以使用浏览器阅读 PHP 源代码，那么 cURL 也可以，如果不能，则不能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T19:25:56.870

通过 HTTP，cURL 应该只能读取其中一个，因此可以肯定地说，如果您在浏览器中看不到 php，cURL 也不会。

但是，如果由于某种原因 Apache 的配置非常糟糕，它只会回显源文件 (php) 的内容。还有一些方法可以有意地配置 Apache 以返回呈现的页面或 php 源，但不能在同一地址上提供两者。

所以总的来说，你的问题的答案是**否定**的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T18:58:28.170

对于 HTTP 请求，没有。但是，如果您对存储 PHP 文件的服务器具有 FTP 访问权限和足够的权限，则可以使用 cURL 通过 FTP 连接并下载未执行的 PHP 源代码，就像连接任何其他 FTP 客户端一样。我不记得它是否支持 SFTP 或 FTPS，但它可能支持。

# vim - GVIM可以有背景图片吗？

> ID：753082
> 
> 赞同：17
> 
> 时间：2009-04-15T18:30:37.503
> 
> 标签：vim

我想知道是否可以将背景图像放入 gVim。

这可以以编程方式完成吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-29T23:19:58.283

如果必须的话，我会建议以下内容：

1.  使用合成窗口管理器（例如 Linux、Windows Vista 和 Mac OS 上的 Compiz 可能有类似物）
2.  设置桌面背景
3.  让你的 gvim 窗口透明
4.  高兴，你的文字现在更难阅读了！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-15T18:39:19.290

根据对“gvim 背景图像”的简单谷歌搜索，答案是“否”。我基于Vim 邮件列表中的[这个线程](http://www.nabble.com/Background-image-watermark-for-gvim--td21947109.html)。看起来他们可能希望有人来实现这个功能，所以如果你自己问如何这样做，这将使这个问题与编程相关联:)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-06-02T12:08:10.247

从 2013 年开始就有可能：请参阅[vim-bgimg](http://www.vim.org/scripts/script.php?script_id=4585)插件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T18:50:26.847

就像 rmeador 所说，谷歌搜索和仔细阅读 vim 文档似乎暗示答案是否定的。但是，请放心，知道您并不孤单地渴望此功能。[这家伙](http://www.jbrowse.com/text/bmbk.shtml)想要相同的功能并实际实现了它，至少在 win32 和 vim 6.2 中是这样。如果你真的想这样做，我会先看看他的补丁，尽管我不知道 vim 代码库的这些部分在 6.2 和当前版本（7.2）之间有多少变化。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-29T23:09:23.393

不，[还没有](http://www.nabble.com/Background-image-watermark-for-gvim--td21947109.html)。

然而，在 win32 和 vim 6.2 上，[这个人](http://www.jbrowse.com/text/bmbk.shtml)实现了它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-01-08T17:23:51.513

如果你在那个操作系统上，[MacVim支持透明背景。](http://code.google.com/p/macvim/)

# xslt - 如何从元素中的文本末尾删除空格。(XSL)

> ID：753086
> 
> 赞同：3
> 
> 时间：2009-04-15T18:32:33.457
> 
> 标签：xslt

有谁知道什么 XSL 代码会删除元素中最后一个单词之后的尾随空格？

```
<p>This is my paragraph.  </p> 
```

谢谢！！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-15T18:52:43.190

查看[`normalize-space()`XPath](http://www.w3.org/TR/xpath#function-normalize-space)函数。

```
<xsl:template match="p">
  <p><xsl:value-of select="normalize-space()" /></p>
</xsl:template> 
```

请注意，有一个问题（可能与您相关，也可能与您无关）：

> [...] 函数返回带有空格的参数字符串，该字符串通过去除前导和尾随空格**并将空格字符序列替换为单个**空格来规范化。

这意味着它还会删除所有换行符、制表符和其他空格，并将它们变成一个空格。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T20:04:51.537

**编辑**：感谢 Tomalak 的提示，显着简化了代码。

**这是一个 XPath 2.0 / XSLT 2.0 解决方案**，它只删除尾随空格：

```
<xsl:stylesheet version="2.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:xs="http://www.w3.org/2001/XMLSchema"
 >
  <xsl:output method="text"/>

  <xsl:template match="text()">
    "<xsl:sequence select="replace(., '\s+$', '', 'm')"/>"
  </xsl:template>
</xsl:stylesheet> 
```

**当这应用于以下 XML 文档时**：

```
<someText>   This is    some text       </someText> 
```

**产生了想要的结果**：

```
"   This is    some text" 
```

[**您可以在这里看到使用**](http://www.biglist.com/lists/xsl-list/archives/200112/msg01067.html)[**FXSL 1.x**](http://fxsl.sf.net)的XSLT 1.0 解决方案（实现几乎相同的想法）：[](http://www.biglist.com/lists/xsl-list/archives/200112/msg01067.html)

 **[http://www.biglist.com/lists/xsl-list/archives/200112/msg01067.html](http://www.biglist.com/lists/xsl-list/archives/200112/msg01067.html)

# c# - C# 对静态对象使用块

> ID：753088
> 
> 赞同：0
> 
> 时间：2009-04-15T18:32:56.060
> 
> 标签：c#, using

我正在将一些代码添加到`using`C# 程序的块中。我正在填充我的应用程序，该应用程序以前是一个独立的现有代码体，所以我需要做一些混乱以使其正确适应。它最终的样子如下：

```
public class WrapperForMyOldApp
{

    public static ItemThatINeed item1;
    public static ItemThatINeed item2;

    public WrapperForMyOldApp () 
    {
        item1 = new ItemThatINeed();
        item2 = new ItemThatINeed();
    }

    public static go()
    {
        // some stuff that i need to do with items 1 and 2
    }
}

public class MainProgram 
{
    .
    .
    .

    public void MethodThatNeedsToMakeUseOfMyApp ()
    {
        ....
        using (WrapperForMyOldApp oldAPp = new WrapperForMyOldApp())
        {
            WrapperForMyOldApp.go();
        }
    }
} 
```

好的，所以这里的问题是：我现在是否削弱了 using 块的效果和/或创建了任何可能对 MainProgram 类产生不利影响的特殊副作用？我相信 Wrapper 对象及其内容将被 Disposed 并且执行将按预期继续，但是我需要注意什么我忽略了？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-15T18:37:53.413

您的包装类是否实现了 IDisposable 而您只是没有显示它？如果它不是一次性的，那么您根本不需要 using 语句。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-15T18:38:47.157

为了使其工作，您需要让 WrapperForMyOldApp 实现 IDisposable。

WrapperForMyOldApp 中的 Dispose() 调用将执行您的清理工作。

但是，静态对象通常用于生命周期超出单个对象的对象。通常，对于这种类型的使用，您可以使 ItemThatINeed 实例非静态，在 WrapperForMyOldApp 构造函数中生成它们，然后在 WrapperForMyOldApp.Dispose() 中清理它们。

使用静态对象，您可能会创建一个噩梦 - 您正在构建对象，然后说您要执行清理（在 using 块的末尾），因此您的 Dispose() 方法将清理静态对象。但是，如果它们再次被使用，会发生什么？如果在 2 个线程中创建两个 WrapperForMyOldApp 实例，正确的行为是什么？如果您想要确定性清理，我会考虑这些问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T18:39:42.817

好吧，如果`WrapperForMyOldApp`implements `IDisposable`，并且您的`Dispose()`实现可以确保摆脱任何资源，那么它应该可以工作......但可能会有其他副作用。代码可以更改全局（静态）状态，例如文化等。它可以产生线程。各种各样的事情。

这不是一个坏方法，但您需要知道您封装的代码是做*什么*的，才能知道是否`Dispose()`会做任何有用的事情。

# .net - 如何将 XMLSerializer 与包含 IList 的 Castle ActiveRecord 一起使用 成员

> ID：753099
> 
> 赞同：4
> 
> 时间：2009-04-15T18:34:33.017
> 
> 标签：.net, xml-serialization, castle-activerecord, generic-list

我正在尝试将 XMLSerializer 与如下所示的城堡活动记录类一起使用：

```
[ActiveRecord("Model")]
public class DataModel : ActiveRecordBase
{
    private IList<Document> documents;

    [XmlArray("Documents")]
    public virtual IList<Document> Documents
    {
        get { return documents; }
        set
        {
            documents = value;    
        }
    }
} 
```

但是，由于 IList 接口，XMLSerializer 遇到了麻烦。（引发异常：*无法序列化类型为“System.Collections.Generic.IList`1....”的成员“DataModel.Documents”*）

我在其他地方读到这是 XMLSerializer 的一个限制，推荐的解决方法是将其声明为`List<T>`接口。

因此，我尝试将其更改`IList<Document>`为`List<Document>`. 这会导致 ActiveRecord 引发异常： *属性 DataModel.Documents 的类型必须是一个接口（IList、ISet、IDictionary 或它们的通用计数器部分）。您不能使用 ArrayList 或 List 作为属性类型。*

所以，问题是：如何将 XMLSerializer 与包含 IList 成员的 Castle ActiveRecord 一起使用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T19:50:42.677

有趣...我能建议的最好的方法是使用`[XmlIgnore]`- `Documents`ActiveRecord 是否有类似的方式来忽略成员？您可以执行以下操作：

```
[XmlIgnore]
public virtual IList<Document> Documents
{
    get { return documents; }
    set
    {
        documents = value;    
    }
}

[Tell ActiveRecord to ignore this one...]
[XmlArray("Documents"), XmlArrayItem("Document")]
[Browsable(false), EditorBrowsable(EditorBrowsableState.Never)]
public Document[] DocumentsSerialization {
    get {
         if(Documents==null) return null;
         return Documents.ToArray(); // LINQ; or do the long way
    }
    set {
         if(value == null) { Documents = null;}
         else { Documents = new List<Document>(value); }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T22:35:24.450

[微软不会实现这个](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=105767)，所以你必须解决它。一种方法是使用非泛型`IList`：

```
[ActiveRecord("Model")]
public class DataModel : ActiveRecordBase<DataModel> {
    [XmlArray("Documents")]
    [HasMany(typeof(Document)]
    public virtual IList Documents {get;set;}
} 
```

[这](http://srtsolutions.com/blogs/billwagner/archive/2006/11/20/xml-serialization-and-generic-interfaces.aspx)是有关此错误的更多信息。

# visual-studio - 从 Visual Studio 2005 迁移到 2008 时要注意什么？

> ID：753100
> 
> 赞同：3
> 
> 时间：2009-04-15T18:34:44.090
> 
> 标签：visual-studio, visual-studio-2008, wcf, visual-studio-2005, wse

我们计划将我们的开发人员从 Visual Studio 2005 更新到 2008。在此过程中是否有任何常见的“陷阱”需要注意？

目前我主要担心的是我们使用 WSE 3.0 相当多（主要用于使用外部 .asmx Web 服务，但我们自己也托管一些）。自从 WSE 3.0 被 WCF 取代后，这会是一个问题吗？

附加背景信息：带有多个网站的 VB.NET 应用程序，而不是 Web 应用程序。目前使用 .NET 2.0，并计划尽快升级到 3.5。

还有什么我们应该关心的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T18:40:01.800

我认为您必须注意的主要问题是升级团队。升级到新版本的 Visual Studio 后，您也将被迫升级项目文件。升级完成后，该文件将不再与以前版本的 Visual Studio 兼容。这意味着你会破坏任何使用旧版本 VS 进行开发的人。最好的建议是升级整个团队。

解决此问题的最佳方法是保留项目文件的 2 个版本。一个用于以前版本的 Visual Studio，另一个用于当前版本。这显然有一些开销。并且一旦您真正开始使用新的语言功能，这将不再足够，因为新功能可能无法在旧版本的 Visual Studio 中编译。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T18:41:41.157

诸如 ASP.NET 项目（尤其是在样式元素方面）的可视化编辑器中的变化非常不同，一开始可能会令人难以置信的沮丧。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T18:51:52.630

我发现 VS05-08 迁移非常轻松。理论上，你应该可以在VS2008中简单地打开2005的解决方案，让它转换，一切正常。VS2008 允许您“定位”特定版本的 .NET，这里的默认设置是它继续以 .NET 2.0 为目标。也就是说，3.5 是一个附加更新，因此如果您更改为 3.5（这只是一个更改的下拉框），任何 .NET 2.0 代码都应该很少或没有重大更改。我很确定 WSE 的东西应该“正常工作”。

在实践中，项目模板、依赖项等可能是一个问题。仍然支持网站和 Web 应用程序，所以我认为这也不应该成为问题。

最后，只需将所有内容备份，然后在 VS2008 中打开，看看会发生什么。

# .net - Asp.net 中的另一个 OOP 问题

> ID：753111
> 
> 赞同：0
> 
> 时间：2009-04-15T18:39:30.257
> 
> 标签：.net, oop, architecture, inheritance, overriding

现在我希望以下是可能的，虽然我不完全确定它是这样的......

下面是我希望的设置（在 VB.net 中，请随意用 C# 回答，我应该能够解决）：

```
Public Class A

    Private _name As String
    Private _s As SearchA

    Public Property Name() As String
         Get
            Return _name
         End Get
         Set(ByVal Value As String)
            _name = Value
         End Set
    End Property
    Public Property S() As SearchA
         Get
            Return _s
         End Get
         Set(ByVal Value As SearchA)
            _s = Value
         End Set
    End Property

    Public Sub New(ByVal name As String)
         _name = name 
         _s = New SearchA()
    End Sub

    Public Function GetSearch() As String
         Return _s.Search
    End Sub

End Class 
```

和

```
Public Class SearchA

    Private _search As String

    Public Property Search () As String
         Get
            Return _search 
         End Get
         Set(ByVal Value As String
            _search = Value
         End Set
    End Property

    Public Sub New()
         _search = "Search using Base"
    End Sub
End Class 
```

和

```
Public Class B
    Inherits A

    Private Shadows _s As SearchB

    Public Shadows Property S() As SearchB
         Get
            Return _s
         End Get
         Set(ByVal Value As SearchB)
            _s = Value
         End Set
    End Property

    Public Sub New(ByVal name As String)
         Mybase.New(name)
         _s = New SearchB()
    End Sub

End Class 
```

最后

```
Public Class SearchB
    Inherits SearchA

    Private _superSearch As String

    Public Property SuperSearch  () As String
         Get
            Return _superSearch 
         End Get
         Set(ByVal Value As String
            _superSearch = Value
         End Set
    End Property

    Public Sub New()
        Mybase.New()
         _search = "Search using New"
         _superSearch = "With more options..."
    End Sub

End Class 
```

这是用法：

```
Dim oB As New B("hello")
Response.Write(oB.GetSearch()) 
```

我认为阴影可能会起作用并打印“使用新搜索”，但它没有，有什么想法吗？我无法覆盖，因为该属性具有与基类属性不同的返回类型。我想在基类中定义一组核心函数，我不必在每个子类中重写。或者这没有多大意义？

谢谢你的帮助！

史蒂夫

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T18:50:50.387

我认为您要做的是定义一个由 SearchA 和 SearchB 继承的抽象 Search 类。使 _s 成为受保护的 Search 类型，将其公开为公共属性，并在 A 类中将 SearchA 分配给它，在 B 类中将 SearchB 分配给它。然后 GetSearch() 将返回来自 A 的 SearchA 和来自 B 的 SearchB，尽管它们都将被键入作为搜索。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T11:46:35.447

我认为是因为GetSearch是在A中实现的，所以它使用了A中的字段。

一般来说，如果你在遗留代码中没有使用阴影，你应该问问自己你做错了什么。

因为它在这里，这种设计有一种气味。从 A 继承 B 和从 SearchA 继承 SearchB 这两种情况都是滥用继承。这有点像从狗那里继承猫，因为它“基本相同”。正如 Jamie Ide 已经说过的：你应该使用抽象基类。

考虑：

*   使用抽象基类并继承 A 和 B
*   使用由基类引用的 SearchA 和 SearchB 实现的接口 ISearch。这是一种经典的策略模式。
*   如果您需要对 SearchA 或 SearchB 的类型化引用，请使用泛型。你可能不需要它。
*   使用工厂把东西放在一起

# c# - 我的 C# 应用程序如何测试用户是否具有对网络共享的“读取”访问权限？

> ID：753120
> 
> 赞同：6
> 
> 时间：2009-04-15T18:44:14.147
> 
> 标签：c#, windows, acl, novell

我在一个胖客户端应用程序上工作，该应用程序经常在访问网络共享时遇到“问题”。在对服务器进行任何 IO 之前，我的应用程序会测试共享（通常形式为 \\server\share$）是否存在。这适用于检测客户端与服务器失去连接的情况，但仍然存在隐藏共享存在但用户无权从共享内读取的那些奇怪情况。有人可以分享（不是双关语）测试当前用户是否可以读取共享文件所需的 C# 代码吗？我应该查询共享的 ACL 还是共享中的文件？如果共享为空怎么办？如果用户是混合环境中的本地非管理员（XP Pro 工作站、Novell 网络上没有域的 Windows 2003 服务器）怎么办？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-15T19:20:57.333

最简单的方法就是这样做（例如，尝试读取文件）。正如 Jared 所提到的，没有办法确保您将来能够阅读（网络故障、权限更改等）。

就代码而言，您可以使用[DirectoryInfo](http://msdn.microsoft.com/en-us/library/system.io.directoryinfo.aspx)类来尝试一些答案：

```
 string remotePath = @"\\server\share$";
        bool haveAccess = false;

        DirectoryInfo di = new DirectoryInfo(remotePath);
        if (di.Exists)
        {
            try
            {
                // you could also call GetDirectories or GetFiles
                // to test them individually
                // this will throw an exception if you don't have 
                // rights to the directory, though
                var acl = di.GetAccessControl();
                haveAccess = true;
            }
            catch (UnauthorizedAccessException uae)
            {
                if (uae.Message.Contains("read-only"))
                {
                    // seems like it is just read-only
                    haveAccess = true;
                }
                // no access, sorry
                // do something else...
            }
        } 
```

上面的代码有很多缺点（比如硬编码的“只读”测试），但这只是一个例子，用来说明你可以做什么。DirectoryInfo 有一些其他帮助方法，可用于列出文件夹中的文件。如果您没有访问权限，这些方法将引发`UnauthorizedAccessException`异常，您可以使用该异常来测试访问失败的原因。查看[GetAccessControl](http://msdn.microsoft.com/en-us/library/t1h6d4k4.aspx)上的信息，了解有关它抛出的异常的更多详细信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T18:51:40.087

确定您是否曾经有权从共享中读取的#1 最可靠的**方法**是

1.  尝试从共享中读取
2.  处理读取时可能发生的错误，并认为尝试失败

不幸的是，尽管根据您的描述，您正在尝试确定您**是否拥有**对该共享的读取权限。没有办法可靠地确定这一点。

无论有多少 ACL、目录等……当您完成查看它们的那一刻，您可能会通过任何数量的机制失去对共享的访问权限。最明显的一个是网络份额下降。您所能确定的只是您**曾经拥有**该共享的权限。

# c - 定义数组时出错，即使它是通过常量设置的

> ID：753121
> 
> 赞同：1
> 
> 时间：2009-04-15T18:44:39.497
> 
> 标签：c, objective-c, arrays, constants

我知道这真的很基本，但它让我很难过......

在 Objective-C 中，我试图写：

```
const int BUF_SIZE = 3;

static char buffer[BUF_SIZE+1]; 
```

但是我得到缓冲区的存储大小不是恒定的。如何让 Xcode 意识到我将其设置为常数 + 1 ...？或者这不可能……？

谢谢...！

乔尔

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T18:51:17.127

我认为这是 C 的东西——如果我没记错的话，C 只允许你用文字表达式（没有任何符号）指定数组大小。我只是使用`#define`常量作为解决方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-19T06:30:01.893

您可以使用枚举：

```
enum
{
    BUF_SIZE = 3
}; 
```

或者宏

```
#define BUF_SIZE 3 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-03T06:52:03.117

发生在 gcc 中，例如：

```
#define LPBUFFER_LGTH ((int) (2*MS25)) 
```

也是。解决方法如上：硬编码你想要的常量。我认为问题在于“定义的定义”，即。两次。

# .net - ADO.NET 实体框架、Northwind 和 Employee.Orders > 0

> ID：753130
> 
> 赞同：0
> 
> 时间：2009-04-15T18:46:39.663
> 
> 标签：.net, entity-framework, ado.net, linq-to-entities

所以我正在尝试开发一个示例应用程序。试图深入研究 ADO.NET 实体框架。我使用这样的 LINQ 方法让员工回来：

```
 public IList<Employee> FindByLastName(string lastName)
    {
        IList<Employee> emps;
        var e = from emp in _ctx.Employees where emp.LastName == lastName select emp;
            emps = e.ToList<Employee>();
        return emps;
    } 
```

然后在我的一个单元测试中，我有**emps[0].Orders.Count > 0**并且返回错误。所以我的 Orders 属性没有加载。我究竟做错了什么？

**更新**：
关于如何将其合并到此 Load()/Include 内容到存储库模式中的任何想法？

我必须做一些蹩脚的事情吗

```
public IList<Employee> GetEmployeeById(int id, bool includeOrders)
{

} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T18:59:27.603

使用[Include](http://msdn.microsoft.com/en-us/library/bb738708.aspx)方法，您可能会更好地编写查询少 linq，例如：

```
public IList<Employee> FindByLastName(string lastName)    
{
    return _ctx.Employees
        .Include("Orders")
        .Where(emp => emp.LastName == lastName)
        .ToList();  
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T19:06:53.517

您还可以选择使用 Include 语句来加载您的订单。

```
public IList<Employee> FindByLastName(string lastName)
{
    IList<Employee> emps;
    var e = from emp in _ctx.Employees.Include("Orders") where emp.LastName == lastName select emp;
        emps = e.ToList<Employee>();
    return emps;
} 
```

这将导致在 SQL 端进行更复杂的连接，但它确实具有单次访问数据库的好处，并且记录范围比 Load() 示例返回的记录范围更小。我会尝试他们两个，看看什么最适合你。

# c# - 如何使用c#获取X，Y处像素的颜色？

> ID：753132
> 
> 赞同：27
> 
> 时间：2009-04-15T18:47:10.160
> 
> 标签：c#, api

如何使用 c# 在 X,Y 处获取像素的颜色？

至于结果，我可以将结果转换为我需要的颜色格式。我确信有一个 API 调用。

对于显示器上的任何给定 X、Y，我想获得该像素的颜色。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-15T18:51:59.510

要从**屏幕获取像素颜色，请使用**[Pinvoke.net](http://www.pinvoke.net/default.aspx/gdi32/GetPixel.html)的代码：

```
 using System;
  using System.Drawing;
  using System.Runtime.InteropServices;

  sealed class Win32
  {
      [DllImport("user32.dll")]
      static extern IntPtr GetDC(IntPtr hwnd);

      [DllImport("user32.dll")]
      static extern Int32 ReleaseDC(IntPtr hwnd, IntPtr hdc);

      [DllImport("gdi32.dll")]
      static extern uint GetPixel(IntPtr hdc, int nXPos, int nYPos);

      static public System.Drawing.Color GetPixelColor(int x, int y)
      {
       IntPtr hdc = GetDC(IntPtr.Zero);
       uint pixel = GetPixel(hdc, x, y);
       ReleaseDC(IntPtr.Zero, hdc);
       Color color = Color.FromArgb((int)(pixel & 0x000000FF),
                    (int)(pixel & 0x0000FF00) >> 8,
                    (int)(pixel & 0x00FF0000) >> 16);
       return color;
      }
   } 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-15T18:50:13.507

有[`Bitmap.GetPixel`](http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.getpixel.aspx)一个图像......这是你所追求的吗？如果不是，你能说出你的意思是哪个 x, y 值吗？在控制？

请注意，如果您*确实*是针对图像，并且想要获得*大量*像素，并且不介意使用不安全的代码，那么[`Bitmap.LockBits`](http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.lockbits.aspx)将比大量调用`GetPixel`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T18:54:14.777

除了 P/Invoke 解决方案之外，您还可以使用 Graphics.CopyFromScreen 将屏幕中的图像数据获取到 Graphics 对象中。但是，如果您不担心可移植性，我会推荐 P/Invoke 解决方案。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-09-19T13:30:39.283

对于 WPF 中的参考：（PointToScreen 的使用）

```
 System.Windows.Point position = Mouse.GetPosition(lightningChartUltimate1);

    if (lightningChartUltimate1.ViewXY.IsMouseOverGraphArea((int)position.X, (int)position.Y))
    {
        System.Windows.Point positionScreen = lightningChartUltimate1.PointToScreen(position);
        Color color = WindowHelper.GetPixelColor((int)positionScreen.X, (int)positionScreen.Y);
        Debug.Print(color.ToString());

      ...

      ...

public class WindowHelper
{
    // ******************************************************************
    [DllImport("user32.dll")]
    static extern IntPtr GetDC(IntPtr hwnd);

    [DllImport("user32.dll")]
    static extern Int32 ReleaseDC(IntPtr hwnd, IntPtr hdc);

    [DllImport("gdi32.dll")]
    static extern uint GetPixel(IntPtr hdc, int nXPos, int nYPos);

    static public System.Windows.Media.Color GetPixelColor(int x, int y)
    {
        IntPtr hdc = GetDC(IntPtr.Zero);
        uint pixel = GetPixel(hdc, x, y);
        ReleaseDC(IntPtr.Zero, hdc);
        Color color = Color.FromRgb(
            (byte)(pixel & 0x000000FF),
            (byte)((pixel & 0x0000FF00) >> 8),
            (byte)((pixel & 0x00FF0000) >> 16));
        return color;
    } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-01-27T05:07:13.513

如果有人遇到这个问题并且没有一个解决方案可以正常工作，就像我的情况一样，而你在 WPF 中，这就是我的工作方式:-)。

```
 [DllImport("user32.dll")]
        static extern IntPtr GetDC(IntPtr hwnd);
        [DllImport("user32.dll")]
        static extern Int32 ReleaseDC(IntPtr hwnd, IntPtr hdc);
        [DllImport("gdi32.dll")]
        static extern uint GetPixel(IntPtr hdc, int nXPos, int nYPos);

        public static void getColor()
        {
            IntPtr hdc = GetDC(IntPtr.Zero);
            uint pixel = GetPixel(hdc, Cursor.Position.X, Cursor.Position.Y);
            ReleaseDC(IntPtr.Zero, hdc);
            System.Drawing.Color color = System.Drawing.Color.FromArgb((int)pixel);
            Console.WriteLine("Color is {0}", color);
        } 
```

# delphi - 在 Delphi 中动态调整框架和表单的大小

> ID：753134
> 
> 赞同：0
> 
> 时间：2009-04-15T18:47:59.690
> 
> 标签：delphi, forms, frames

我有一个 TFrame 后代，上面有一个相当大的面板，它是一个第三方组件 (TLMDSimplePanel))。该面板上的大小效果很好，但我希望它包含的框架在用户更改面板大小时动态调整大小。（面板上有一个小拇指握把，用户可以用鼠标点击和拖动）。

该框架的代码如下：

```
unit SizeableFrame;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, TcmBaseFrameFrame, LMDCustomControl, LMDCustomPanel, LMDCustomBevelPanel,
  LMDSimplePanel, StdCtrls;

type
  TcmSizeableFrame = class(TcmBaseFrame)
    LMDSimplePanel1: TLMDSimplePanel;
    Memo1: TMemo;
    Memo2: TMemo;
    procedure LMDSimplePanel1Resize(Sender: TObject);
    procedure FrameCanResize(Sender: TObject; var NewWidth, NewHeight: Integer;
      var Resize: Boolean);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  cmSizeableFrame: TcmSizeableFrame;

implementation

{$R *.dfm}

procedure TcmSizeableFrame.FrameCanResize(Sender: TObject; var NewWidth,
  NewHeight: Integer; var Resize: Boolean);
begin
  inherited;
  Resize := True;
end;

procedure TcmSizeableFrame.LMDSimplePanel1Resize(Sender: TObject);
const
  ExpandByPixels = 60;
var
  MyFrame : TFrame;        
begin
  inherited;
  Self.Height := LMDSimplePanel1.Height + ExpandByPixels;
  Self.Width := LMDSimplePanel1.Width  +  ExpandByPixels;
end;

end. 
```

它的效果非常好，如果用户正在*缩小*框架的大小，但如果他们试图将其拉伸得比原来的范围更大，他们只能将其扩展至*看起来*是其原始大小 + ExpandByPixels，之后用户不能继续流畅地将其拖动到更大的尺寸。

如果他们停下来，然后再次单击并拖动尺寸夹点，他们可以将其拖动到更大的尺寸，但这同样受到同样的限制（当前尺寸 + ExpandByPixels = 外部边界）。他们可以无休止地重复这个循环，将框架扩展到任何大小，但不能在一次鼠标移动中流畅地进行，这正是我想要的。

我也针对 TForm 后代测试了同样的问题，并得到了相同的症状。

我在这里想念什么？

提前感谢您的任何帮助。:-)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T19:35:23.120

您是否尝试将 Frame.Autosize 设置为 true？
或者您需要在鼠标移动时调整框架的大小。这样包含的对象可以在保持在容器边界内的同时扩展。

更新：一些与常规 TPanel 一起使用以水平调整大小的简单代码...

```
type
  TFrame5 = class(TFrame)
    Panel1: TPanel;
    procedure Panel1MouseMove(Sender: TObject; Shift: TShiftState; X, Y: Integer);
    procedure Panel1Resize(Sender: TObject);
  end;

implementation

{$R *.dfm}

procedure TFrame5.Panel1MouseMove(Sender: TObject; Shift: TShiftState; X, Y: Integer);
begin
  with Sender as TPanel do
  if ssLeft in Shift then
  begin
    Width := X;
  end;
end;

procedure TFrame5.Panel1Resize(Sender: TObject);
begin
  with Sender as TPanel do
  begin
    (Parent as TFrame).Width := Width + 2*Left;
  end;
end; 
```

# iphone - 如何在 UINavigationBar 的底部画一条线？

> ID：753139
> 
> 赞同：0
> 
> 时间：2009-04-15T18:49:00.063
> 
> 标签：iphone, cocoa-touch

我正在开发的 iPhone 应用程序的设计要求导航栏底部有一条 1px 的红线。我知道如何用 Quartz 和 -drawRect 画一条线，但是如何访问 UINavigationBar 的视图？或者在应用程序的主视图中，在其他所有内容之上画线是否有效？

邓肯·威尔科克斯（Duncan Wilcox）在下面的回答有助于画线，但随后栏上的按钮变得无法按下。

如果我这样做 [self.navigationItem.titleView.superview sendSubviewToBack:titleView] 那么在 nib 文件中创建的按钮可以工作，但不是动态添加的按钮。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T13:53:59.617

我想答案取决于您想要红线的位置，作为导航栏的一部分或就在它下方。那将只有 1 个像素的差异，但现在设计师要求：)

如果您希望它位于导航栏下方，则必须将其放在需要该行的所有应用程序视图中。

有一种非常简单的方法可以改变导航栏的外观，我用它来为整个导航栏外观蒙皮，但如果你使图像部分透明，它甚至可能只适用于导航栏的某些部分。

基本上，我们希望对导航层次结构中`UINavigationItem`的 a进行皮肤处理。`UIViewController`

*   创建包含自定义导航栏外观的 320x44 图像
*   `UIImageView`在`XIB`其中添加`UINavigationItem`一个
*   `titleView`将 the 的属性链接`UINavigationItem`到`UIImageView`

这几乎可以工作，除了标题视图将以奇怪的方式调整大小。为了解决这个问题，我有一个`UIImageView`保持图像正确设置的子类：

```
@implementation TitleViewHack
- (void)setFrame:(CGRect)frame
{
    frame.size.width = 320;
    if(frame.origin.x > 0 && frame.origin.x < 20)
        frame.origin.x = 0;
    [super setFrame:frame];
}
@end 
```

`UIImageView`因此，您将使用此类，而不是使用上面的 a `TitleViewHack`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-26T17:51:08.500

这是我决定的：

```
// UINavigationBar subclass
- (void)drawRect:(CGRect)rect {
    UIImage *image = [UIImage imageNamed: @"background_navbar.png"];
    [image drawInRect:CGRectMake(0, 0, self.frame.size.width, self.frame.size.height)];
} 
```

# geometry - 如何确定两个凸多边形是否相交？

> ID：753140
> 
> 赞同：22
> 
> 时间：2009-04-15T18:49:42.167
> 
> 标签：geometry, polygon, convex

假设在一个平面上有许多凸多边形，也许是一张地图。这些多边形可以相互碰撞并共享一条边，但不能重叠。

![替代文字](https://i.stack.imgur.com/AkGPs.jpg)

要测试两个多边形**P**和**Q**是否重叠，首先我可以测试**P**中的每条边，看看它是否与**Q**中的任何边相交。如果找到一个交点，我声明**P**和**Q**相交。如果没有相交，那么我必须测试**P**完全被**Q**包含的情况，反之亦然。接下来，存在**P** == **Q**的情况。最后，有些情况共享一些边缘，但不是全部。（这最后两种情况可能被认为是相同的一般情况，但这可能并不重要。）

我有一个算法可以检测两条线段相交的位置。如果这两个线段是共线的，则出于我的目的，它们不被视为相交。

我是否正确列举了这些案例？对这些案例的测试有什么建议吗？

请注意，我不是要找到作为交叉点的新凸多边形，我只想知道是否存在交叉点。有许多有据可查的算法可以找到交叉点，但我不需要付出所有努力。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-15T18:59:44.967

您可以使用[这种碰撞算法](http://web.archive.org/web/20141127210836/http://content.gpwiki.org/index.php/Polygon_Collision)：

> 为了能够确定两个凸多边形是否相交（相互接触），我们可以使用分离轴定理。本质上：
> 
> *   如果两个凸多边形不相交，则存在一条穿过它们的线。
> *   仅当多边形之一的边之一形成这样的线时，才存在这样的线。
> 
> 第一个陈述很简单。由于多边形都是凸面的，因此您可以绘制一条线，其中一个多边形在一侧，另一个多边形在另一侧，除非它们相交。第二个不太直观。看图 1。除非多边形的最近边彼此平行，否则它们彼此最接近的点是一个多边形的角最接近另一个多边形的边的点。然后这一边将形成多边形之间的分离轴。如果边平行，则它们都是分离轴。
> 
> ![](https://i.stack.imgur.com/8YZ54.png)
> 
> 那么这具体如何帮助我们确定多边形 A 和 B 是否相交呢？好吧，我们只是遍历每个多边形的每一边并检查它是否形成了一个分离轴。为此，我们将使用一些基本的向量数学将两个多边形的所有点压缩到一条垂直于潜在分隔线的线上（见图 2）。现在整个问题方便地是一维的。我们可以确定每个多边形的点所在的区域，如果这些区域不重叠，则这条线是分离轴。
> 
> ![](https://i.stack.imgur.com/CNeSx.png)
> 
> 如果在检查两个多边形的每条线后，没有找到分离轴，则证明多边形相交并且必须对其进行处理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-15T18:57:53.567

*   如果多边形总是凸的，首先计算从多边形中心到中心绘制的线的角度。然后，您可以消除在与其他多边形相距 180 度的一半多边形中测试边缘段的需要。

*   要消除边缘，从左侧的多边形开始。从多边形中心取垂直于前一个子弹的线段的线段，并接触多边形的两侧。将此线段称为 p，顶点为 p1 和 p2。那么，对于所有的顶点，如果x坐标小于p1.x和p2.x，那个顶点就可以进入“安全桶”。

*   如果不是，您必须检查以确保它位于线路的“安全”一侧（也只需检查 y 坐标）

- 如果多边形中的线段在“安全桶”中具有所有顶点，则可以忽略它。

- 反转极性，以便您对第二个多边形“正确定向”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T19:16:52.633

[GJK](http://www.win.tue.nl/~gino/solid/jgt98convex.pdf) [碰撞](http://en.wikipedia.org/wiki/Gilbert-Johnson-Keerthi_distance_algorithm) [检测](http://ieeexplore.ieee.org/xpl/freeabs_all.jsp?&arnumber=2083) [应该可以](https://mollyrocket.com/forums/viewtopic.php?t=245) [工作](http://web.comlab.ox.ac.uk/people/Stephen.Cameron/distances/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-11-29T21:16:34.497

有几种方法可以检测凸多边形之间的交叉和/或包含。这完全取决于您希望算法的效率如何。考虑分别具有 r 和 b 个顶点的两个凸多边形 R 和 B：

1.  [基于扫描线](https://en.wikipedia.org/wiki/Sweep_line_algorithm)的算法。正如您所提到的，您可以执行扫描线程序并保持多边形与扫描线相交所产生的间隔。如果在任何时候间隔重叠，则多边形相交。复杂度是 O((r + b) log (r + b)) 时间。
2.  [基于旋转卡尺](https://en.wikipedia.org/wiki/Rotating_calipers)的算法。有关更多详细信息，请参见[此处](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.155.5671)和[此处](http://sdiwc.net/digital-library/web-admin/upload-pdf/00001036.pdf)。复杂度是 O(r + b) 时间。
3.  最有效的方法可以在[这里](https://dl.acm.org/citation.cfm?id=804662)和[这里](http://epubs.siam.org/doi/abs/10.1137/1.9781611973730.109)找到。这些算法需要 O(log r + log b) 时间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T18:57:03.617

您的测试用例应该可以工作，因为您正在检查多边形根本不相交（完全在外部或完全在内部）的情况，以及存在任何形式的部分相交的情况（如果有重叠，边总是相交） .

对于测试，我会确保测试每个潜在的组合。我看到的上面缺少的一个是共享的单个边缘，但另一个包含一个多边形。我还会为一些更复杂的多边形添加测试，从三面 -> 多面，作为预防措施。

此外，如果您有一个完全包围多边形但不重叠的 U 形多边形，我相信您的案例会处理这个问题，但我也会将其添加为检查。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-15T19:05:27.823

由于 altCognito 已经为您提供了解决方案，因此我只会指出一本您可能感兴趣[的关于计算几何的优秀书籍。](http://www.cs.uu.nl/geobook/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-15T19:15:24.120

这是一个想法：

*   找到每个多边形的中心点

*   找到每个多边形的最接近另一个中心点的两个点。它们将是凸多边形中的相邻点。这些定义了每个多边形的最近边，我们称点 {A, B} 和 {Y, Z}

*   找到线 AB 和 YZ 的交点。如果线段相交（AB 上的交点位于 A 和 B 之间），则您的多边形相交。如果 AB 和 XY 平行忽略此条件，下一步将捕获问题。

*   您还需要检查另一种情况，即多边形相交的程度足够大，以至于 AB 和 XY 完全相互越过并且实际上并不相交。要捕获这种情况，请计算 AB 和 XY 到每个多边形中心点的垂直距离。如果任一中心点更靠近对面多边形的线段，则您的多边形重叠严重。

# web-services - 从 .net 3.5 windows 服务调用 Web 服务

> ID：753141
> 
> 赞同：0
> 
> 时间：2009-04-15T18:49:43.137
> 
> 标签：web-services, .net-3.5, windows-services

我正在使用 .net 3.5 构建一个新的 Windows 服务，与 2.0 不同，您不能只添加对 Web 服务的 Web 引用。您可以从 .net 3.5 Windows 服务调用 .net 2.0 Web 服务吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T18:54:54.667

你是这个意思[吗？](http://www.techtoolblog.com/archives/add-web-references-to-visual-studio-2008)

# c# - 为什么 TabStop 停止工作？

> ID：753142
> 
> 赞同：0
> 
> 时间：2009-04-15T18:49:44.960
> 
> 标签：c#, winforms

我有一个使用一系列自动生成的用户控件实例的项目。用户控件本身存在，但我用一系列这些用户控件填充了一个面板，一个用于我的集合中的每个项目。

每个用户控件显示大量信息，但只有一个文本字段是可编辑的。所有其他字段都将 TabStop 设置为 false，并标记为 ReadOnly。

每个用户控件的 Tab 键顺序是在创建时设置的，以便 Tab 键从一个字段转到下一个字段（或者......它应该是）。

当我的用户控件上有两个字段的 TabStop 设置为 true 时，一切正常。但是，如果我只有一个 TabStop 为 true 的字段，则 tab 键将停止工作，我必须物理单击下一个用户控件才能获得焦点。

这是怎么回事？有没有其他人看到过这种行为？我像往常一样做傻事吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T18:56:35.023

如果只有一个控件`TabStop`是`true`，您将不会在任何东西之间循环。

# php - 解析位于 Internet 上的 xml 文档并转换为 json

> ID：753143
> 
> 赞同：0
> 
> 时间：2009-04-15T18:50:05.567
> 
> 标签：php, xml, json

我找到了[http://www.ibm.com/developerworks/xml/library/x-xml2jsonphp/](http://www.ibm.com/developerworks/xml/library/x-xml2jsonphp/)，但我不知道如何使用此代码从我的 Web 服务器获取 xml。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T18:53:02.567

最简单的方法是[`file_get_contents()`](http://www.php.net/file_get_contents)

```
$xmlString = file_get_contents('http://www...../file.xml'); 
```

如果你想要一个 SimpleXML 对象，你可以使用[`simplexml_load_file()`](http://www.php.net/simplexml_load_file)

```
$xml = simplexml_load_file('http://www...../file.xml'); 
```

这两种方法都需要[`allow_url_fopen`](http://www.php.net/manual/en/filesystem.configuration.php#ini.allow-url-fopen)启用。如果不是，您可以使用[curl](http://www.php.net/curl) - 这更复杂，但也为您提供了更大的灵活性。

```
$c = curl_init('http://www...../file.xml');
curl_setopt($c, CURLOPT_RETURNTRANSFER, true);

$xmlString = curl_exec($c);
$error = curl_error($c);
curl_close($c);

if ($error)
    die('Error: ' . $error); 
```

# cocoa - Xcode 调试：查看 NSNumber 的值？

> ID：753153
> 
> 赞同：1
> 
> 时间：2009-04-15T18:51:37.373
> 
> 标签：cocoa, xcode, debugging, nsnumber, data-formatters

是否可以在变量监视窗口的调试器数据提示中看到 NSNumber 的数值？

我将一个整数值存储在 NSNumber 中，并希望在调试期间查看该值。

我已经在调试器中尝试了一些数据格式化程序，但没有多大帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-15T20:01:23.133

打开 Debugger 视图并在 Summary 列中输入

```
{(int)[$VAR intValue]} 
```

或任何最适合您希望在调试器中看到的解释。

# css - css div id 每页只使用一次

> ID：753165
> 
> 赞同：3
> 
> 时间：2009-04-15T18:53:23.767
> 
> 标签：css

在使用 CSS 时，最好的做法是每页只使用一次 div id。我知道每个 id 必须是唯一的，但可以多次使用。与我的开发团队讨论后，有人认为您每页只能使用一次 div id 标签。

每页 1 个 id 的示例：

```
<page>
  <div id="test">Some Text</div>
  <div class="test12">More Text</div>
</page> 
```

每页多个 id 的示例：

```
<page>
  <div id="test">Some Text</div>
  <div id="test12">More Text</div>
</page> 
```

我希望这已经足够清楚了。如果不让我知道，我可以尝试更好地解释它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-15T18:56:18.253

您当然可以根据需要多次使用 id="" 属性，但属性的内容应该是唯一的。没有唯一值是 HTML 错误。

如果您需要多个项目具有相同的属性，那么您可以将它们设置为一个类。

更多信息在 W3C -[元素标识符：id 和类属性](http://www.w3.org/TR/html401/struct/global.html#h-7.5.2)（HTML 4.01 规范）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-15T18:58:34.080

首先，**标签**通常是指元素，如 div、a、img、body、...**属性**是标签内给出的值，如 id、class、href、...

可以为每个标签指定一次 id 属性，并限制没有两个标签共享相同的 id 值。

你的两个例子都是有效的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T18:56:17.487

id 应该是唯一的

见[HTML 规范](http://www.w3.org/TR/html401/struct/global.html#h-7.5.2)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T18:57:16.643

物理上可能每页有重复的 id，但你只想在 CSS 中每页使用一个 id 的原因是***CSS 选择器***。通过 id 进行 CSS 选择**预计**只会返回一个 DOM 项。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T18:57:31.650

ID 是页面上一个元素的唯一分配。

您可以多次使用“ID=”属性。您需要确保 ID="hi" 只使用一次，因为它应该是元素级别的唯一标识符。

支持文档链接： [http ://www.w3schools.com/tags/tag_DIV.asp](http://www.w3schools.com/tags/tag_DIV.asp)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-15T18:57:54.737

如果这就是您所要求的，您可以拥有许多带有 id(s) 的元素。例如，只需查看此页面的源代码，您就会看到许多 id。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-02T04:31:42.703

如果它只与 CSS 相关，那么我们也可以使用 Class 而不是 Id 作为 DIV 标签

# c# - lock(){} 是锁定一个资源，还是锁定一段代码？

> ID：753168
> 
> 赞同：17
> 
> 时间：2009-04-15T18:54:02.750
> 
> 标签：c#, multithreading, concurrency

我仍然很困惑......当我们写这样的东西时：

```
Object o = new Object();
var resource = new Dictionary<int , SomeclassReference>(); 
```

...并且有两个代码块`o`在访问时锁定`resource`...

```
//Code one
lock(o)
{
  // read from resource    
}

//Code two
lock(o)
{
  // write to resource
} 
```

现在，如果我有两个线程，一个线程执行读取的代码，`resource`另一个执行写入它的代码，我想锁定`resource`这样，当它被读取时，作者将不得不等待（反之亦然 - 如果它正在写到，读者将不得不等待）。锁结构会帮助我吗？...或者我应该使用其他东西吗？

（我在`Dictionary`这个例子中使用，但可以是任何东西）

我特别关注两种情况：

1.  两个线程试图执行同一行代码
2.  两个线程试图在同一个资源上工作

`lock`在这两种情况下都有帮助吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-15T19:14:29.643

大多数其他答案都针对您的代码示例，因此我将尝试在标题中回答您的问题。

锁实际上只是一个令牌。可以说，拥有令牌的人可以上台。因此，您锁定的对象与您尝试同步的资源没有显式连接。只要所有读者/作者都同意同一个令牌，它就可以是任何东西。

当试图锁定一个对象（即通过调用`Monitor.Enter`一个对象）时，运行时检查锁是否已经被线程持有。如果是这种情况，则试图锁定的线程被挂起，否则它获取锁并继续执行。

当持有锁的线程退出锁作用域（即调用`Monitor.Exit`）时，锁被释放，任何等待的线程现在都可以获取锁。

最后，关于锁要记住几点：

*   只要您需要就锁定，但不再锁定。
*   如果您使用`Monitor.Enter/Exit`而不是`lock`关键字，请确保将调用`Exit`放在一个`finally`块中，以便即使在出现异常的情况下也会释放锁。
*   将对象公开以锁定使得更难了解谁在锁定以及何时锁定。理想的同步操作应该被封装。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-15T19:00:22.487

是的，使用锁是正确的方法。您可以锁定任何对象，但正如其他答案中所述，锁定您的资源本身可能是最简单和最安全的。

但是，您可能希望使用读/写锁对而不是单个锁，以减少并发开销。

这样做的基本原理是，如果您只有一个线程写入，但有多个线程读取，您不希望读取操作阻塞另一个读取操作，而只有读取阻塞写入，反之亦然。

现在，我更像是一个 java 人，所以你将不得不更改语法并挖掘一些文档以在 C# 中应用它，但是[rw-locks](http://java.sun.com/javase/6/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html)是 Java 中标准并发包的一部分，所以你可以编写如下内容：

```
public class ThreadSafeResource<T> implements Resource<T> {
    private final Lock rlock;
    private final Lock wlock;
    private final Resource res;

    public ThreadSafeResource(Resource<T> res) {
        this.res = res;
        ReentrantReadWriteLock rwl = new ReentrantReadWriteLock();
        this.rlock = rwl.readLock();
        this.wlock = rwl.writeLock();
    }

    public T read() {
        rlock.lock();
        try { return res.read(); }
        finally { rlock.unlock(); }
    }

    public T write(T t) {
        wlock.lock();
        try { return res.write(t); }
        finally { wlock.unlock(); }
    }
} 
```

如果有人能想出一个 C# 代码示例......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T18:57:45.440

两个代码块都被锁定在这里。如果线程一锁定了第一个块，而线程二试图进入第二个块，则它必须等待。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T19:14:06.337

lock ( *o) { ... }*语句编译为：

```
Monitor.Enter(o)
try { ... }
finally { Monitor.Exit(o) } 
```

如果另一个线程已经调用了对 Monitor.Enter() 的调用，它将阻塞该线程。只有在其他线程在对象上调用 Monitor.Exit() 后，它才会被解除阻塞。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-15T19:29:44.957

> 锁定在这两种情况下都有帮助吗？是的。
> 
> lock(){} 是锁定一个资源，还是锁定一段代码？

```
lock(o)
{
  // read from resource    
} 
```

是语法糖

```
Monitor.Enter(o);
try
{
  // read from resource 
}
finally
{
  Monitor.Exit(o);
} 
```

**Monitor**类包含用于同步访问代码块的对象集合。对于每个同步对象，**Monitor**保留：

1.  对当前持有同步对象锁的线程的引用；即轮到该线程执行。
2.  “就绪”队列 - 阻塞的线程列表，直到它们获得此同步对象的锁定。
3.  **“等待”队列 - 在Monitor.Pulse()**或**Monitor.PulseAll()**将它们移动到“就绪”队列之前阻塞的线程列表。

因此，当一个线程调用 lock(o) 时，它会被放入 o 的就绪队列中，直到它被赋予 o 上的锁，此时它会继续执行其代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-15T18:57:21.963

假设您只涉及一个流程，这应该可以工作。如果您希望它在多个进程中工作，您将需要使用“互斥锁”。

哦，“o”对象应该是一个单例对象，或者在需要锁定的任何地方都具有作用域，因为真正被锁定的是该对象，如果您创建一个新对象，那么该新对象将不会被锁定。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-15T19:00:48.147

你实现它的方式是一种可接受的方式来做你需要做的事情。一种改进方法是在字典本身上使用 lock()，而不是用于同步字典的第二个对象。这样，资源本身就不会传递一个额外的对象，而是跟踪它自己的监视器上是否有锁。

在某些情况下使用单独的对象可能很有用，例如同步对外部资源的访问，但在这种情况下，它会产生开销。

# sql - 如何反转列中的单词

> ID：753172
> 
> 赞同：0
> 
> 时间：2009-04-15T18:54:32.593
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我有一个带有 varchar(128) 列的表，其中包含如下数据：

word1, word2, , word3, word4
word1, word2, word3, ,
word1,,,, ; word2
;word1 word2, word3

我必须更新这个表，使单词倒序：

word4, ,word3,,word2 ,word1
,,word3, ,word2, word1

您能帮我只使用单个 sql 查询吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T21:23:41.003

要完成此任务将需要一个 t-sql 函数和一个游标。fn_SplitList 将允许您基于分隔符进行拆分。拥有此功能后，您可以创建一个游标来针对更新每条记录的数据运行。我使用@table1 创建了一个示例。

功能

```
CREATE FUNCTION [dbo].[fn_SplitList]
(
    @RowData varchar(8000),
    @SplitOn varchar(5)
)  
RETURNS @RtnValue table 
(
    Id int identity(1,1),
    Data varchar(100)
) 
AS  
BEGIN 
    Declare @Cnt int
    Set @Cnt = 1

    While (Charindex(@SplitOn,@RowData)>0)
    Begin
        Insert Into @RtnValue (data)
        Select 
            Data = ltrim(rtrim(Substring(@RowData,1,Charindex(@SplitOn,@RowData)-1)))

        Set @RowData = Substring(@RowData,Charindex(@SplitOn,@RowData)+1,len(@RowData))
        Set @Cnt = @Cnt + 1
    End

    Insert Into @RtnValue (data)
    Select Data = ltrim(rtrim(@RowData))

    Return
END 
```

执行更新的代码

```
declare @table1 table(id int primary key
                     ,words varchar(max))
declare @id int
declare @words varchar(max)

insert into @table1 values(0, 'word1, word2, , word3, word4')
insert into @table1 values(1, 'word1, word2, word3, ,')
insert into @table1 values(2, 'word1,,,, ; word2')
insert into @table1 values(3, ';word1 word2, word3')

declare updateCursor cursor for
select id
      ,words
  from @table1

open updateCursor   
fetch next from updateCursor into @id, @words
while @@fetch_status = 0
begin
  declare @row varchar(255)

  select @row = coalesce(@row+', ', '') + data
    from dbo.fn_SplitList(@words, ',')
  order by id desc

  update @table1
     set words = @row
   where id = @id

  fetch next from updateCursor into @id, @words
end
close updateCursor   
deallocate updateCursor

select *
  from @table1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:03:30.617

最好的办法是永远不要以这种方式存储数据。如果这应该是在一个相关的表格中，那么您可以订购您的心满意足。就个人而言，至少将数据拆分为具有额外标识列的临时表或表变量，然后在该列上按降序排序可能是最快的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T21:17:03.203

我有一个想法，因为您受限于一个查询。您能否制作一个与我之前建议的临时表做同样事情的表值 UDF？加入其中并订购 desc。它不会是高性能的（当然，当结构设计得如此糟糕时，什么都不会）但它可能会完成这项工作，除非你有数百万条记录。

或者您可以制作一个存储过程并从您的 GUI 中调用它，这将允许您执行多个步骤。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T20:12:12.377

我认为您可以创建一个新表并将第一个表中的数据插入该表。

INSERT INTO TABLE2 SELECT * FROM TABLE1 ORDER BY COLUMN1 DESC

然后，删除 table2 并重命名 table1。

也许...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T21:03:38.617

谢谢你的回答

单词由空格、逗号和/或分号分隔，所有分隔符应保持原位

例如记录

'字1，字2；；；字3，'

评价为

'word3, word2;;;word1, '

由于现有系统的要求，必须使用单个查询来完成，

我试过了：

```
update t_desc set name = 
(select name
from
(select name,
case when wb is null then rname when wb >= we then stuff(rname, wb, 128, REVERSE        (substring(rname, wb, 128))) else
stuff(rname, wb, we-wb+1, REVERSE(substring(rname, wb, we-wb+1))) end rname,
case when wb is null or wb > we then null else PATINDEX('%[a-z0-9]%', SUBSTRING(rname, we+1, 128))+we end wb,
case when we is null or wb > we then null else PATINDEX('%[a-z0-9][^a-z0-9]%', SUBSTRING(rname, we+1, 128))+we end we
from
(select name,
case when wb is null then rname when wb >= we then stuff(rname, wb, 128, REVERSE    (substring(rname, wb, 128))) else
stuff(rname, wb, we-wb+1, REVERSE(substring(rname, wb, we-wb+1))) end rname,
case when wb is null or wb > we then null else PATINDEX('%[a-z0-9]%', SUBSTRING    (rname, we+1, 128))+we end wb,
case when we is null or wb > we then null else PATINDEX('%[a-z0-9][^a-z0-9]%',     SUBSTRING(rname, we+1, 128))+we end we
from
(select name,
case when wb is null then rname when wb >= we then stuff(rname, wb, 128, REVERSE        (substring(rname, wb, 128))) else
stuff(rname, wb, we-wb+1, REVERSE(substring(rname, wb, we-wb+1))) end rname,
case when wb is null or wb > we then null else PATINDEX('%[a-z0-9]%', SUBSTRING        (rname, we+1, 128))+we end wb,
case when we is null or wb > we then null else PATINDEX('%[a-z0-9][^a-z0-9]%',         SUBSTRING(rname, we+1, 128))+we end we
from
(select name, 
stuff(rname, wb, we-wb+1, REVERSE(substring(rname, wb, we-wb+1))) rname,
PATINDEX('%[a-z0-9]%', SUBSTRING(rname, we+1, 128))+we wb,
PATINDEX('%[a-z0-9][^a-z0-9]%', SUBSTRING(rname, we+1, 128))+we we 
from
(select name, rname, 
PATINDEX('%[a-z0-9]%', rname) wb,
PATINDEX('%[a-z0-9][^a-z0-9]%', rname) we
  from
(select t_desc.name, REVERSE(name) rname) t1) t2) t3) t4) t5) t6) 
```

和类似的想法，但它不能正常工作

编辑：除字母和数字外的所有内容都是分隔符

编辑2：不幸的是，我无法调用 ddl 语句，也无法直接访问数据库，我的公司使用旧的、封闭的软件——我们只能使用外部应用程序的控制台来选择或有时更新。我可以将我的更新添加到工作列表中——它将来每天都会执行。

表有大约 60k 行，列包含 2 到大约 20 个单词，不为空

对不起我的英语不好 ：）

# asp.net - 从 .Net 调用 SQL 的进度条

> ID：753173
> 
> 赞同：1
> 
> 时间：2009-04-15T18:54:35.667
> 
> 标签：asp.net, sql, progress-bar

我想知道是否有一种经过验证的/真实的方法可以将 .Net 应用程序的数据库调用进度报告给它的用户。我想知道是否甚至可以实际指示完成百分比，或者是最好/唯一的方法来简单地显示“加载”动画以指示正在发生的事情？

另外，SQL2008 是否有人知道这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T18:59:06.607

您必须确定性地加载内容。例如，如果您*知道*您将获取大量数据，例如，您可能会执行以下操作：

- 获取所有记录的计数 - 获取 500 条记录 - 报告状态为 500/total % - 再获取 500 条 -report status 为 1000/total % -... 继续直到您获得所有用户拥有的记录取消

这对于根本不需要时间的东西来说是非常浪费的，因为仅仅访问数据库这一事实就是开销的很大一部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T19:02:28.347

据我所知，没有办法做到这一点。我的建议是使用永远旋转的圆形进度条之一。Microsoft 在 SQL 和 Project 中的数据库操作中使用这些。

这是一篇关于 CodeProject 的文章，其中包含多种内容：

[http://www.codeproject.com/KB/vb/sql2005circularprogress.aspx?fid=324397&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2205952](http://www.codeproject.com/KB/vb/sql2005circularprogress.aspx?fid=324397&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2205952)

亚当·贝伦特

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-13T09:15:36.997

您可以使用带有 no wait 选项的 raiserror 将消息发送回远程调用方，而无需结束 sql 事务。当然，这将打破通常的 try/catch 约定，因此建议谨慎。

另一方面，“数据库调用”也可以指恢复或备份操作，在这种情况下，您可以简单地使用 SMO（服务器管理对象）库中的进度事件。

此外，可以使用诸如 Linq 之类的 ORM 解决方案来处理诸如批量更新操作之类的“数据库调用”。如果是这种情况，那么这个答案可能很有用： [如何获得 LINQ to SQL submitchanges 的百分比？](https://stackoverflow.com/questions/648379/how-can-i-get-a-percentage-of-linq-to-sql-submitchanges/4579447#4579447)

# c# - 转换为 .Net 3.5

> ID：753178
> 
> 赞同：4
> 
> 时间：2009-04-15T18:55:50.420
> 
> 标签：c#, .net

我最近开始维护一个 .Net 1.1 项目，并希望将其转换为 .Net 3.5。

有什么技巧可以分享通过使用新功能来减少代码吗？

作为第一次尝试，我想转换一堆静态辅助函数。

**更新**：我转换的主要原因是学习静态类、LINQ 等新功能。至少现在仅供我自己使用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T18:58:19.697

我建议首先迁移到 .NET 2.0 功能。

我的第一步是慢慢重构以将所有集合移动到通用集合。这将极大地帮助并简化向 .NET 3.5 功能的迁移，尤其是使用 LINQ。它还应该对您的性能产​​生很好的影响，因为任何值类型的集合都会表现得更好。

在将 HashTables 转换为 Dictionary<T,U> 时要小心，因为在某些情况下行为是不同的，但除此之外，ArrayList->List<T> 等都是简单而有用的转换。

在那之后，将助手移动到静态类和潜在的扩展方法，将是一个很好的下一步考虑。这可以使代码更具可读性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T18:57:29.980

您可以使用[静态类](http://msdn.microsoft.com/en-us/library/79b3xss3(VS.80).aspx)（C# 2.0 特性）来重写旧的辅助函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T19:02:29.983

如果你可以摆动它，我发现最简单的方法是使用**Visual Studio 2008**和**[ReSharper](http://www.jetbrains.com/resharper/)**。ReSharper 将通过一些友好的可见符号向您展示您可以在哪些地方改进您的代码。然后它会显示一个键盘快捷键 Alt+Enter 来“修复”你的代码。

ReSharper 还有一个名为“清理代码”的功能，它将为您进行一些重构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T19:03:35.317

为什么要转换，.Net 1.1 与 .Net 3.5 完全兼容，因此您在迁移时不应该发现任何重大更改。如果您需要重构一个区域，因为它有问题，或者您希望以某种方式扩展它，那么我会考虑迁移以使用更新的功能，但否则为什么要触摸它并冒着破坏它的风险呢？

**编辑**因为这是一个学习练习而不是更改生产代码，所以我会稍微修改一下我的观点；这可能是学习新方法的好方法。我当然会看看 LINQ。在旧代码迭代列表或操作 XML 或数据库中的数据的地方，看看您是否可以改用 LINQ 重写。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T19:01:06.867

如果您想从“转换 [ing] 一堆静态辅助函数”开始，那么您需要查看[**扩展方法**](http://msdn.microsoft.com/en-us/library/bb383977.aspx)。

您可能可以使用它们来使您的代码更简单、更易读。

# python - 在 Python 中以编程方式生成视频或动画 GIF？

> ID：753190
> 
> 赞同：306
> 
> 时间：2009-04-15T18:57:14.770
> 
> 标签：python, video, wxpython, animated-gif

我有一系列图像，我想从中创建视频。理想情况下，我可以为每一帧指定一个帧持续时间，但固定帧速率也可以。我在 wxPython 中执行此操作，因此我可以渲染到 wxDC，或者我可以将图像保存到文件中，例如 PNG。是否有 Python 库允许我从这些帧创建视频（AVI、MPG 等）或动画 GIF？

编辑：我已经尝试过 PIL，但它似乎不起作用。有人可以用这个结论纠正我或建议另一个工具包吗？这个链接似乎支持了我关于 PIL 的结论：http: [//www.somethinkodd.com/oddthinking/2005/12/06/python-imaging-library-pil-and-animated-gifs/](http://www.somethinkodd.com/oddthinking/2005/12/06/python-imaging-library-pil-and-animated-gifs/)

* * *

## 回答 #1

> 赞同：378
> 
> 时间：2016-03-11T15:19:07.520

我建议不要使用来自 visvis 的 images2gif，因为它在 PIL/Pillow 方面存在问题并且没有得到积极维护（我应该知道，因为我是作者）。

相反，请使用[imageio](http://imageio.github.io)，它是为解决这个问题而开发的，并打算留下来。

快速而肮脏的解决方案：

```
import imageio
images = []
for filename in filenames:
    images.append(imageio.imread(filename))
imageio.mimsave('/path/to/movie.gif', images) 
```

对于较长的电影，请使用流式传输方法：

```
import imageio
with imageio.get_writer('/path/to/movie.gif', mode='I') as writer:
    for filename in filenames:
        image = imageio.imread(filename)
        writer.append_data(image) 
```

* * *

## 回答 #2

> 赞同：146
> 
> 时间：2019-09-02T05:24:49.217

以下是仅使用**PIL**的方法（安装：） `pip install Pillow`：

```
import glob
from PIL import Image

# filepaths
fp_in = "/path/to/image_*.png"
fp_out = "/path/to/image.gif"

# https://pillow.readthedocs.io/en/stable/handbook/image-file-formats.html#gif
imgs = (Image.open(f) for f in sorted(glob.glob(fp_in)))
img = next(imgs)  # extract first image from iterator
img.save(fp=fp_out, format='GIF', append_images=imgs,
         save_all=True, duration=200, loop=0) 
```

请参阅文档：[https ://pillow.readthedocs.io/en/stable/handbook/image-file-formats.html#gif](https://pillow.readthedocs.io/en/stable/handbook/image-file-formats.html#gif)

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2009-04-15T21:34:42.333

好吧，现在我正在使用 ImageMagick。我将我的帧保存为 PNG 文件，然后从 Python 调用 ImageMagick 的 convert.exe 来创建动画 GIF。这种方法的好处是我可以单独为每个帧指定一个帧持续时间。不幸的是，这取决于机器上安装的 ImageMagick。他们有一个 Python 包装器，但它看起来很糟糕且不受支持。仍然对其他建议持开放态度。

* * *

## 回答 #4

> 赞同：42
> 
> 时间：2010-03-04T00:13:13.413

截至 2009 年 6 月，最初引用的博客文章[在评论中](http://www.somethinkodd.com/oddthinking/2005/12/06/python-imaging-library-pil-and-animated-gifs/#comment-197921)提供了一种创建动画 GIF 的方法。下载脚本[images2gif.py](https://pypi.python.org/pypi/images2gif)（以前为[images2gif.py](http://sites.google.com/site/almarklein/files-1/images2gif.py)，更新由 @geographika 提供）。

然后，要反转 gif 中的帧，例如：

```
#!/usr/bin/env python

from PIL import Image, ImageSequence
import sys, os
filename = sys.argv[1]
im = Image.open(filename)
original_duration = im.info['duration']
frames = [frame.copy() for frame in ImageSequence.Iterator(im)]    
frames.reverse()

from images2gif import writeGif
writeGif("reverse_" + os.path.basename(filename), frames, duration=original_duration/1000.0, dither=0) 
```

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2012-04-29T22:51:44.027

我使用了易于使用的[images2gif.py 。](http://sites.google.com/site/almarklein/files-1/images2gif.py)不过，它似乎确实使文件大小增加了一倍..

26 个 110kb 的 PNG 文件，我预计 26*110kb = 2860kb，但 my_gif.GIF 是 5.7mb

也因为 GIF 是 8 位的，漂亮的 png 在 GIF 中变得有点模糊

这是我使用的代码：

```
__author__ = 'Robert'
from images2gif import writeGif
from PIL import Image
import os

file_names = sorted((fn for fn in os.listdir('.') if fn.endswith('.png')))
#['animationframa.png', 'animationframb.png', 'animationframc.png', ...] "

images = [Image.open(fn) for fn in file_names]

print writeGif.__doc__
# writeGif(filename, images, duration=0.1, loops=0, dither=1)
#    Write an animated gif from the specified images.
#    images should be a list of numpy arrays of PIL images.
#    Numpy images of type float should have pixels between 0 and 1.
#    Numpy images of other types are expected to have values between 0 and 255.

#images.extend(reversed(images)) #infinit loop will go backwards and forwards.

filename = "my_gif.GIF"
writeGif(filename, images, duration=0.2)
#54 frames written
#
#Process finished with exit code 0 
```

以下是 26 帧中的 3 帧：

![这是 26 帧中的 3 帧](https://i.stack.imgur.com/4cZ7A.gif)

缩小图像减小了尺寸：

```
size = (150,150)
for im in images:
    im.thumbnail(size, Image.ANTIALIAS) 
```

![较小的 gif](https://i.stack.imgur.com/Sb15U.gif)

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2009-07-30T04:29:45.000

要创建视频，您可以使用[opencv](http://sourceforge.net/projects/opencvlibrary/)，

```
#load your frames
frames = ...
#create a video writer
writer = cvCreateVideoWriter(filename, -1, fps, frame_size, is_color=1)
#and write your frames in a loop if you want
cvWriteFrame(writer, frames[i]) 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2018-08-14T21:42:32.633

我遇到了这篇文章，但没有一个解决方案有效，所以这是我的**有效解决方案**

到目前为止，其他解决方案的问题：
**1)**没有关于如何修改持续时间的明确解决方案
**2)**没有解决乱序目录迭代的解决方案，这对于 GIF 来说是必不可少的
**3)**没有解释如何为 python 3 安装 imageio

**像这样安装 imageio：** python3 -m pip install imageio

**注意：**您需要确保您的帧在文件名中有某种索引，以便可以对其进行排序，否则您将无法知道 GIF 的开始或结束位置

```
import imageio
import os

path = '/Users/myusername/Desktop/Pics/' # on Mac: right click on a folder, hold down option, and click "copy as pathname"

image_folder = os.fsencode(path)

filenames = []

for file in os.listdir(image_folder):
    filename = os.fsdecode(file)
    if filename.endswith( ('.jpeg', '.png', '.gif') ):
        filenames.append(filename)

filenames.sort() # this iteration technique has no built in order, so sort the frames

images = list(map(lambda filename: imageio.imread(filename), filenames))

imageio.mimsave(os.path.join('movie.gif'), images, duration = 0.04) # modify duration as needed 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-06-11T00:46:10.173

正如沃伦*去年*所说，这是一个老问题。由于人们似乎仍在查看该页面，我想将他们重定向到更现代的解决方案。就像 blakev[在这里所说的那样，](https://stackoverflow.com/questions/24688802/saving-an-animated-gif-in-pillow) [github](https://github.com/python-pillow/pillow-scripts/blob/master/Scripts/gifmaker.py)上有一个 Pillow 示例。

```
 import ImageSequence
 import Image
 import gifmaker
 sequence = []

 im = Image.open(....)

 # im is your original image
 frames = [frame.copy() for frame in ImageSequence.Iterator(im)]

 # write GIF animation
 fp = open("out.gif", "wb")
 gifmaker.makedelta(fp, frames)
 fp.close() 
```

注意：这个例子已经过时了（`gifmaker`不是一个可导入的模块，只是一个脚本）。Pillow 有一个[GifImagePlugin](http://pillow.readthedocs.io/en/latest/reference/plugins.html?highlight=GifImagePlugin#module-PIL.GifImagePlugin)（其来源[在 GitHub 上](https://github.com/python-pillow/Pillow/blob/master/src/PIL/GifImagePlugin.py)），但[ImageSequence 上的文档](http://pillow.readthedocs.io/en/stable/handbook/tutorial.html#image-sequences)似乎表明支持有限（只读）

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2018-07-28T02:37:12.643

正如上面提到的一个成员，imageio 是一个很好的方法来做到这一点。imageio 还允许您设置帧速率，我实际上用 Python 编写了一个函数，允许您设置最后一帧的暂停。我将此功能用于科学动画，其中循环很有用，但立即重新启动没有用。这是链接和功能：

[如何使用 Python 制作 GIF](https://engineersportal.com/blog/2018/7/27/how-to-make-a-gif-using-python-an-application-with-the-united-states-wind-turbine-database)

```
import matplotlib.pyplot as plt
import os
import imageio

def gif_maker(gif_name,png_dir,gif_indx,num_gifs,dpi=90):
    # make png path if it doesn't exist already
    if not os.path.exists(png_dir):
        os.makedirs(png_dir)

    # save each .png for GIF
    # lower dpi gives a smaller, grainier GIF; higher dpi gives larger, clearer GIF
    plt.savefig(png_dir+'frame_'+str(gif_indx)+'_.png',dpi=dpi)
    plt.close('all') # comment this out if you're just updating the x,y data

    if gif_indx==num_gifs-1:
        # sort the .png files based on index used above
        images,image_file_names = [],[]
        for file_name in os.listdir(png_dir):
            if file_name.endswith('.png'):
                image_file_names.append(file_name)       
        sorted_files = sorted(image_file_names, key=lambda y: int(y.split('_')[1]))

        # define some GIF parameters

        frame_length = 0.5 # seconds between frames
        end_pause = 4 # seconds to stay on last frame
        # loop through files, join them to image array, and write to GIF called 'wind_turbine_dist.gif'
        for ii in range(0,len(sorted_files)):       
            file_path = os.path.join(png_dir, sorted_files[ii])
            if ii==len(sorted_files)-1:
                for jj in range(0,int(end_pause/frame_length)):
                    images.append(imageio.imread(file_path))
            else:
                images.append(imageio.imread(file_path))
        # the duration is the time spent on each image (1/duration is frame rate)
        imageio.mimsave(gif_name, images,'GIF',duration=frame_length) 
```

[![使用此方法的示例 GIF](https://i.stack.imgur.com/4LDO2.gif)](https://i.stack.imgur.com/4LDO2.gif)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-04-15T22:24:43.790

它不是 python 库，但 mencoder 可以做到这一点：[从多个输入图像文件编码](http://www.mplayerhq.hu/DOCS/HTML/en/menc-feat-enc-images.html)。您可以像这样从 python 执行 mencoder：

```
import os

os.system("mencoder ...") 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2015-10-06T19:55:45.917

老问题，很多很好的答案，但可能仍然对另一种选择感兴趣......

`numpngw`我最近在 github ( [https://github.com/WarrenWeckesser/numpngw](https://github.com/WarrenWeckesser/numpngw) ) 上发布的模块可以从 numpy 数组编写动画 PNG 文件。（*更新*：`numpngw`现在在 pypi 上：[https](https://pypi.python.org/pypi/numpngw) ://pypi.python.org/pypi/numpngw 。）

例如，这个脚本：

```
import numpy as np
import numpngw

img0 = np.zeros((64, 64, 3), dtype=np.uint8)
img0[:32, :32, :] = 255
img1 = np.zeros((64, 64, 3), dtype=np.uint8)
img1[32:, :32, 0] = 255
img2 = np.zeros((64, 64, 3), dtype=np.uint8)
img2[32:, 32:, 1] = 255
img3 = np.zeros((64, 64, 3), dtype=np.uint8)
img3[:32, 32:, 2] = 255
seq = [img0, img1, img2, img3]
for img in seq:
    img[16:-16, 16:-16] = 127
    img[0, :] = 127
    img[-1, :] = 127
    img[:, 0] = 127
    img[:, -1] = 127

numpngw.write_apng('foo.png', seq, delay=250, use_palette=True) 
```

创建：

[![动画png](https://i.stack.imgur.com/TKR5R.png)](https://i.stack.imgur.com/TKR5R.png)

您需要一个支持动画 PNG（直接或通过插件）的浏览器才能看到动画。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2020-11-02T06:45:22.743

```
from PIL import Image
import glob  #use it if you want to read all of the certain file type in the directory
imgs=[]
for i in range(596,691): 
    imgs.append("snap"+str(i)+'.png')
    print("scanned the image identified with",i) 
```

标识不同文件名的索引的开始和结束值+1

```
imgs = glob.glob("*.png") #do this if you want to read all files ending with .png 
```

我的文件是：snap596.png、snap597.png ...... snap690.png

```
frames = []
for i in imgs:
    new_frame = Image.open(i)
    frames.append(new_frame) 
```

保存到永远循环的 GIF 文件中

```
frames[0].save('fire3_PIL.gif', format='GIF',
    append_images=frames[1:],
    save_all=True,
    duration=300, loop=0) 
```

我发现 imageio 出现闪烁问题，这个方法修复了它。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-04-22T15:08:02.107

你试过[PyMedia](http://pymedia.org/)吗？我不是 100% 确定，但看起来[本教程示例](http://pymedia.org/tut/src/make_video.py.html)针对的是您的问题。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2016-01-01T12:02:05.900

使用 windows7、python2.7、opencv 3.0，以下对我有用：

```
import cv2
import os

vvw           =   cv2.VideoWriter('mymovie.avi',cv2.VideoWriter_fourcc('X','V','I','D'),24,(640,480))
frameslist    =   os.listdir('.\\frames')
howmanyframes =   len(frameslist)
print('Frames count: '+str(howmanyframes)) #just for debugging

for i in range(0,howmanyframes):
    print(i)
    theframe = cv2.imread('.\\frames\\'+frameslist[i])
    vvw.write(theframe) 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2017-05-15T17:07:25.607

使它对我有用的最简单的事情是在 Python 中调用 shell 命令。

如果您的图像存储为 dummy_image_1.png、dummy_image_2.png ... dummy_image_N.png，那么您可以使用该函数：

```
import subprocess
def grid2gif(image_str, output_gif):
    str1 = 'convert -delay 100 -loop 1 ' + image_str  + ' ' + output_gif
    subprocess.call(str1, shell=True) 
```

只需执行：

```
grid2gif("dummy_image*.png", "my_output.gif") 
```

这将构建您的 gif 文件 my_output.gif。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2020-09-13T14:38:38.173

安装

```
pip install imageio-ffmpeg
pip install imageio 
```

代码

```
import imageio
images = []
for filename in filenames:
    images.append(imageio.imread(filename))
imageio.mimsave('movie.mp4', images) 
```

当保存为 mp4 比 gif 时，质量提高并且大小从 8Mb 减少到 80Kb

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2015-02-02T10:07:11.883

该任务可以通过从与图片文件序列相同的文件夹中运行两行python脚本来完成。对于 png 格式的文件，脚本是 -

```
from scitools.std import movie
movie('*.png',fps=1,output_file='thisismygif.gif') 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2017-07-07T09:40:05.093

我正在寻找**单行代码**，并发现以下代码适用于我的应用程序。这是我所做的：

**第一步：** *从下面的链接安装 ImageMagick*

[https://www.imagemagick.org/script/download.php](https://www.imagemagick.org/script/download.php)

[![在此处输入图像描述](https://i.stack.imgur.com/wEM8X.png)](https://i.stack.imgur.com/wEM8X.png)

**第二步：** *将 cmd 行指向放置图像（在我的情况下为 .png 格式）的文件夹*

[![在此处输入图像描述](https://i.stack.imgur.com/2EDFL.png)](https://i.stack.imgur.com/2EDFL.png)

**第三步：** *输入以下命令*

```
magick -quality 100 *.png outvideo.mpeg 
```

[![在此处输入图像描述](https://i.stack.imgur.com/KAFnK.png)](https://i.stack.imgur.com/KAFnK.png)

感谢 FogleBird 的想法！

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2021-10-07T15:37:24.913

除了 Smart Manoj 答案：从文件夹中的所有图像制作 .mp4 电影

安装：

```
pip install imageio-ffmpeg
pip install imageio 
```

代码：

```
import os
import imageio

root = r'path_to_folder_with_images'

images = []    
for subdir, dirs, files in os.walk(root):
    for file in files:
        images.append(imageio.imread(os.path.join(root,file)))

savepath = r'path_to_save_folder'
imageio.mimsave(os.path.join(savepath,'movie.mp4'), images) 
```

PS：确保您的“文件”列表按您想要的方式排序，如果您已经相应地保存图像，您将节省一些时间

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-06-13T11:03:23.780

一个制作 GIF 的简单函数：

```
import imageio
import pathlib
from datetime import datetime

def make_gif(image_directory: pathlib.Path, frames_per_second: float, **kwargs):
    """
    Makes a .gif which shows many images at a given frame rate.
    All images should be in order (don't know how this works) in the image directory

    Only tested with .png images but may work with others.

    :param image_directory:
    :type image_directory: pathlib.Path
    :param frames_per_second:
    :type frames_per_second: float
    :param kwargs: image_type='png' or other
    :return: nothing
    """
    assert isinstance(image_directory, pathlib.Path), "input must be a pathlib object"
    image_type = kwargs.get('type', 'png')

    timestampStr = datetime.now().strftime("%y%m%d_%H%M%S")
    gif_dir = image_directory.joinpath(timestampStr + "_GIF.gif")

    print('Started making GIF')
    print('Please wait... ')

    images = []
    for file_name in image_directory.glob('*.' + image_type):
        images.append(imageio.imread(image_directory.joinpath(file_name)))
    imageio.mimsave(gif_dir.as_posix(), images, fps=frames_per_second)

    print('Finished making GIF!')
    print('GIF can be found at: ' + gif_dir.as_posix())

def main():
    fps = 2
    png_dir = pathlib.Path('C:/temp/my_images')
    make_gif(png_dir, fps)

if __name__ == "__main__":
    main() 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-02-24T20:10:04.907

我刚刚尝试了以下方法，非常有用：

首先将库下载`Figtodat`到`images2gif`您的本地目录。

其次收集数组中的数字并将它们转换为动画 gif：

```
import sys
sys.path.insert(0,"/path/to/your/local/directory")
import Figtodat
from images2gif import writeGif
import matplotlib.pyplot as plt
import numpy

figure = plt.figure()
plot   = figure.add_subplot (111)

plot.hold(False)
    # draw a cardinal sine plot
images=[]
y = numpy.random.randn(100,5)
for i in range(y.shape[1]):
    plot.plot (numpy.sin(y[:,i]))  
    plot.set_ylim(-3.0,3)
    plot.text(90,-2.5,str(i))
    im = Figtodat.fig2img(figure)
    images.append(im)

writeGif("images.gif",images,duration=0.3,dither=0) 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2018-04-27T07:57:20.377

我遇到了 PIL 的*ImageSequence*模块，它提供了更好（和更标准）的 GIF 动画。这次我也使用了 Tk 的*after()*方法，比*time.sleep()*更好。

```
from Tkinter import * 
from PIL import Image, ImageTk, ImageSequence

def stop(event):
  global play
  play = False
  exit() 

root = Tk()
root.bind("<Key>", stop) # Press any key to stop
GIFfile = {path_to_your_GIF_file}
im = Image.open(GIFfile); img = ImageTk.PhotoImage(im)
delay = im.info['duration'] # Delay used in the GIF file 
lbl = Label(image=img); lbl.pack() # Create a label where to display images
play = True;
while play:
  for frame in ImageSequence.Iterator(im):
    if not play: break 
    root.after(delay);
    img = ImageTk.PhotoImage(frame)
    lbl.config(image=img); root.update() # Show the new frame/image

root.mainloop() 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2018-04-16T11:46:48.927

真是不可思议……所有人都在提议一些特殊的 GIF 动画播放包，目前可以使用 Tkinter 和经典的 PIL 模块来完成！

这是我自己的GIF动画方法（我前一阵子创建的）。非常简单：

```
from Tkinter import * 
from PIL import Image, ImageTk
from time import sleep

def stop(event):
  global play
  play = False
  exit() 

root = Tk()
root.bind("<Key>", stop) # Press any key to stop
GIFfile = {path_to_your_GIF_file}    
im = Image.open(GIFfile); img = ImageTk.PhotoImage(im)
delay = float(im.info['duration'])/1000; # Delay used in the GIF file 
lbl = Label(image=img); lbl.pack() # Create a label where to display images
play = True; frame = 0
while play:
  sleep(delay);
  frame += 1
  try:
    im.seek(frame); img = ImageTk.PhotoImage(im)
    lbl.config(image=img); root.update() # Show the new frame/image
  except EOFError:
    frame = 0 # Restart

root.mainloop() 
```

您可以设置自己的方式来停止动画。如果您想获得带有播放/暂停/退出按钮的完整版本，请告诉我。

注意：我不确定是从内存还是从文件（磁盘）中读取连续帧。在第二种情况下，如果它们都同时读取并保存到数组（列表）中，效率会更高。（我不是很想知道！:)

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2019-12-03T04:17:53.090

我了解您询问有关将图像转换为 gif 的问题；但是，如果原始格式是 MP4，您可以使用[FFmpeg](https://www.ffmpeg.org/)：

```
ffmpeg -i input.mp4 output.gif 
```

# vb.net - 通过代理服务器访问 HTTPS 站点

> ID：753191
> 
> 赞同：1
> 
> 时间：2009-04-15T18:57:15.613
> 
> 标签：vb.net, proxy, https

我正在添加代码以使用代理服务器访问 Internet。该代码在从正常 (HTTP) 位置请求文件时工作正常，但在访问安全位置 (HTTPS) 时不起作用。

这是可以正常工作的代码：

```
URL = "http://UnSecureSite.net/file.xml"
Dim wr As HttpWebRequest = CType(WebRequest.Create(URL), HttpWebRequest)
Dim proxy As System.Net.IWebProxy
proxy = WebRequest.GetSystemWebProxy
wr.Proxy.Credentials = System.Net.CredentialCache.DefaultCredentials
Dim ws As HttpWebResponse = CType(wr.GetResponse(), HttpWebResponse)

// (more work here) 
```

一旦我将 URL 更改为 HTTPS，我就会收到一个 407 返回给我。

有人有想法么？

```
URL = "https://SecureSite.net/file.xml"
Dim wr As HttpWebRequest = CType(WebRequest.Create(URL), HttpWebRequest)
Dim proxy As System.Net.IWebProxy
proxy = WebRequest.GetSystemWebProxy
wr.Proxy.Credentials = System.Net.CredentialCache.DefaultCredentials
Dim myCache As New CredentialCache()
myCache.Add(New Uri("https://SecureSite.net"), "Basic", New NetworkCredential(UserName, Password))
wr.Credentials = myCache
Dim ws As HttpWebResponse = CType(wr.GetResponse(), HttpWebResponse)

// (more work here) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T07:38:03.677

通过 Web 代理的 HTTPS 请求与标准 HTTP 请求不同。常规 HTTP 请求将使用 GET 方法。但是，HTTPS 请求需要使用 CONNECT 方法。然后，代理将仅仅建立到服务器的隧道。后续消息将通过代理隧道直接在客户端和服务器之间发送。代理无法解释其间流动的数据。

正常情况下：

```
Client -+- [CONNECT] ---> Proxy --- [DIRECT TCP] -+-> Server
        |                   |                     |
        +-------------[ENCRYPTED TCP]-------------+ 
```

我对 VB 代码不够熟悉，不知道这是否正在发生。但是，我怀疑它不是。最简单的检查方法是拦截发送到代理的消息。确保它以“CONNECT ...”开头。

# c# - WPF 是否在 Windows 中使用已安装的颜色配置文件（ICC）？

> ID：753194
> 
> 赞同：3
> 
> 时间：2009-04-15T18:57:23.350
> 
> 标签：c#, wpf, windows, color-management

WPF 是否使用 Windows 中已安装的颜色配置文件来更正呈现的颜色？

我很确定旧表单/基于 gdi 的应用程序不会“自动”校正颜色，但我想知道 WPF 是否会（或可以自动）这样做？（我知道我可以在自己的 WPF 应用程序中手动执行此操作，方法是创建一个 gpu 着色器来进行颜色校正。）

我问的原因是因为现在越来越多的显示器是广色域的，这意味着在“旧”显示器上看起来“正常”的颜色在广色域显示器上看起来会更加鲜艳。一个例子是我的新显示器，它的红色和绿色比我的其他显示器强得多。我可以针对某些应用程序（firefox、photoshop、使用自定义着色器的媒体播放器等，我自己的使用 gpu 着色器的 wpf 应用程序......）在每个应用程序的基础上更正这个问题，但如果有办法让 WPF 为所有 WPF 应用程序自动执行此操作。这不是一个大问题，但它很烦人，我曾希望微软会利用 WPF 的机会在默认情况下引入颜色校正。

编辑：为后代澄清的问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-10T08:11:43.760

没有。您必须在您的应用程序中自己实现它。就像旧的表单/gdi 应用程序一样。

我认为这是一个相当大的问题！我唯一支持颜色配置文件的应用程序是 Photoshop，我几乎不使用它。在所有其他情况下，我的新广色域显示器比它所取代的 sRGB 显示器差得多。

在 92% 的色域中，颜色有点过饱和，但显示器不断推高，现在达到 110% 以上。他们推动的越远，这些显示器在非托管应用程序中的表现就越差。由于几乎没有托管应用程序，因此大多数情况下这些显示非常糟糕。

每个实现色彩管理支持的应用程序似乎都不现实。这需要在操作系统或驱动程序级别上完成。你提到你可以用 GPU 着色器来做到这一点，但我知道除了开源媒体播放器的非官方插件之外没有人这样做。

# c# - .Net 3.5 Windows 服务隐藏 WCF 服务主机

> ID：753207
> 
> 赞同：1
> 
> 时间：2009-04-15T18:58:41.430
> 
> 标签：c#, .net, wcf, .net-3.5, windows-services

我在我的开发机器（我制作的）上安装了一个 Windows 服务，我想与它进行交互。由于我不知道的原因，每次我启动客户端时，都会弹出一个 WCF 服务主机并说该地址已在使用中......这是真的......但我怎么能不启动那个 Windows 呢？

是因为我的两个项目（服务器和客户端）在同一个解决方案中吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T19:04:17.967

是的，因为它们在同一个解决方案中。右键单击您的 WCF 项目 > 属性 > WCF 选项 > 取消选中“在同一解决方案中调试另一个项目时启动 WCF 服务主机”。

# excel - 如何在没有附加软件的情况下将 SSIS 导出到 Microsoft Excel？

> ID：753211
> 
> 赞同：5
> 
> 时间：2009-04-15T18:59:26.763
> 
> 标签：excel, ssis, export, openrowset

这个问题很啰嗦，因为我很长时间以来一直在更新这个问题，试图让 SSIS 正确导出 Excel 数据。 **我设法解决了这个问题，虽然不正确**。除了有人提供正确答案之外，这个问题中列出的解决方案并不可怕。

我找到的唯一答案是为我的列创建一个足够宽的**名为 range 的单行。**在命名范围内**放置样本数据并将其隐藏**。 **SSIS 附加数据并从单行读取元数据**（足够接近它可以将内容放入其中）。 **数据采用隐藏单行的格式。** 这允许标题等。

哇，屁股好痛。需要 450 多天的出口才能弥补损失的时间。但是，我仍然喜欢 SSIS 并将继续使用它，因为它仍然比 Filemaker LOL 好得多。我的下一次尝试将在报表服务器中做同样的事情。

* * *

原始问题说明：

如果您在 Sql Server Integrations Services 设计器中，并且想要将数据导出到 Excel 文件，而不是从第一行开始，比如说第四行，您如何指定？

我尝试进入数据流的 Excel 目标，将 AccessMode 从变量更改为 OpenRowSet，然后将变量设置为“YPlatters$A4:I20000”这失败了，说它找不到工作表。该表称为 YPlatters。

我以为你可以指定 (Sheet$)(Starting Cell):(Ending Cell)？

> 更新
> 
> 显然，在 Excel 中，您可以选择一组单元格并使用名称框命名它们。这允许您选择名称而不是不带 $ 美元符号的工作表。奇怪的是，无论您指定什么范围，它都会将数据附加到范围之后的下一行。奇怪的是，当您添加数据时，它会增加命名选择的行数。

另一个奇怪的事情是数据采用指定范围的最后一行的格式。我的标题行是粗体的。如果我指定以标题行结尾的范围，则数据将附加到下面的行，并使所有条目变为粗体。如果您指定低一行，它会在标题行和数据之间放置一个空白行，但数据不是粗体。

> 另一个更新
> 
> 无论我尝试什么，SSIS 都会对文件的“第一行”进行采样，并根据找到的内容设置元数据。但是，如果您的样本数据的值为零但被格式化为第一行，它会将该列视为文本并插入前面带有单引号的数值 ('123.34)。我还尝试了不反映列数据类型的标题。我尝试更改 Excel 目标的元数据，但它总是在我运行项目时将其更改回来，然后失败说它会截断数据。如果我告诉它忽略错误，它会导入除该列之外的所有内容。

几天几小时后...

> 另一个更新
> 
> 我尝试了每一种组合。一个最有效的示例是创建从列标题开始的命名范围。格式化列标题，因为您希望数据看起来像数据采用这种格式。在我的示例中，这些存在于 A4 到 E4 之间，这是我定义的范围。SSIS 追加到定义范围之后的行，因此定义 A4 到 E68 追加从 A69 开始的行。您将 Connection 定义为第一行包含字段名称。它采用标题行的元数据，奇怪的是，不是第二行，它猜测数据类型，而不是列的格式化数据类型，即标题是文本，所以我所有的元数据都是文本。如果您的标题是粗体的，那么您的所有数据也是如此。
> 
> 我什至尝试制作示例数据行但没有成功......我认为没有人真正使用 Excel 和默认的 MS SSIS 导出。

如果您可以定义没有标题行的“插入范围”（A5 到 E5）并格式化这些列（货币、非粗体等）而不在 Excel 中跳过一行，这将非常有帮助。据我所知，没有人在没有第三方连接管理器的情况下使用 SSIS 导出 Excel。

关于如何正确设置以便正确格式化数据的任何想法，即从 Excel 读取的元数据适用于真实数据，并且格式继承自第一行数据，而不是 Excel 中的标题？

> 最后一次更新（2009 年 7 月 17 日）
> 
> 我让它工作得很好。我添加到 Excel 中的一件事是 Excel 连接字符串中的 IMEX=1：“Excel 8.0;HDR=Yes;IMEX=1”。这迫使 Excel（我认为）查看所有行以查看其中的数据类型。通常，这不会删除信息，例如，如果您有一个邮政编码，那么您有一个 zip+4 的大约 9 行，没有这个的 Excel 会完全空白该字段而不会出错。当 IMEX=1 时，它识别 Zip 实际上是一个字符字段而不是数字。
> 
> 当然，还有一次更新（2009 年 8 月 27 日）
> 
> IMEX=1 将成功导入前 8 行中缺少内容的数据，但将无法导出不存在数据的数据。所以，把它放在你的导入连接字符串上，而不是你的导出 Excel 连接字符串上。

我不得不说，经过这么多的摆弄，它工作得很好。

PS 如果您使用的是 x64 位版本，请确保从 C:\Program Files\Microsoft SQL Server\90\DTS.x86\Binn 调用 DTExec。它将加载 32 位 Excel 驱动程序并正常工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-17T07:42:52.783

在脚本任务中创建 Excel 工作簿，然后稍后在流程中选择它会更容易吗？

SSIS 的引擎部分很好，但与 Excel 的集成很糟糕

“将 SSIS 与 Excel 结合使用就像将热焦油倒入路锥中的 iHole”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T14:38:29.913

Zim 博士，我相信您是最初提出这个问题的人。我完全感受到你的痛苦。我总体上喜欢 SSIS，但我绝对讨厌 Excel 标准的有限工具。我想要做的只是在 Excel 中加粗标题或第 1 行记录，而不是加粗以下记录。我还没有找到一个很好的方法来做到这一点；授予我在没有脚本任务或自定义扩展的情况下处理此问题，但是您会认为这种简单的事情将是标准选项。看起来我可能被迫研究和编写一些花哨的东西来完成一项应该如此基础的任务。我自己已经为此花费了大量时间。有谁知道您是否可以将 Excel XML 与 Excel 版本一起使用：2000/XP/2003？谢谢。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-04-14T13:53:36.940

这是一个旧线程，但是如何使用平面文件连接并将数据作为格式化的 html 文档写入。将页眉中的 mime 类型设置为“application/excel”。当您将文档作为附件发送并且收件人打开附件时，它将打开一个浏览器会话，但应在其顶部弹出 Excel，其中包含根据页面中指定的样式 (CSS) 格式化的数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T16:06:08.913

您是否可以让 SSIS 将数据从 A1 开始写入 Excel 工作表，然后创建另一个工作表，按您喜欢的格式设置，引用 A1 处的另一个工作表，但将其显示为 A4？也就是说，在“漂亮”表上，A4 将引用 SSIS 表上的 A1。

这将允许 SSIS 做它有益的事情（操作基于表格的数据），但允许您根据需要对 Excel 进行格式化或操作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-23T16:15:12.380

当 excel 是 SSIS 中的目标或 SSRS 中的目标导出类型时，您对格式和指定最终文件的格式没有太多控制权。我曾经为 SSRS 编写过一个自定义的 excel 渲染引擎，因为我的客户对生成的最终 Excel 报告的格式非常严格。我使用“Excel xml”在我的自定义渲染器中完成工作。也许您可以使用 XML 输出并使用 XSLT 将其转换为 Excel XML。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-24T06:53:03.877

我了解您不希望使用脚本组件，因此也许您可以使用脚本包含的代码创建自己的[自定义任务](http://msdn.microsoft.com/en-us/library/ms345156.aspx)，以便其他人将来可以使用它。[在这里](http://www.thejoyofcode.com/SSIS_Custom_Logging_Task_for_Event_Handlers.aspx)查看一个例子。

如果这看起来可行，我使用的解决方案是[CarlosAg Excel Xml Writer Library](http://www.carlosag.net/Tools/ExcelXmlWriter/)。有了这个，您可以创建类似于使用 Interop 库但生成 xml 格式的 excel 的代码。这避免了使用有时会导致 excel 进程[挂起](http://www.craigmurphy.com/blog/?p=82)的 Interop 对象。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-06-23T10:39:31.730

与其使用迂回的方式来尝试将数据写入特定单元格、格式化单元格、设置样式，考虑到 SSIS 对 EXCEL 的支持，这确实是一项非常乏味的工作，我们可以去“模板”的方式来做到这一点。

假设我们需要在 so & so 单元格中写入数据，并在其上完成所有自定义格式。将所有格式设置在工作表中，例如“SheetActual”，而保存数据的单元格实际上将具有查找/引用/公式来引用 SSIS 在隐藏工作表中导出的原始数据，例如相同 Excel 的“SheetMasterHidden”联系。这个“SheetMasterHidden”本质上将以 SSIS 将数据写入 excel 的默认格式保存主数据。这样您就不必担心格式化数据运行时。

格式化 Excel 是一次性工作“如果”格式不经常更改。如果格式发生变化并且格式在运行时被确定，那么这个解决方案可能不会很顺利。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-23T03:24:57.033

答案就在问题中。随着时间的推移，它变成了一种进步状态。但是，如果您创建 TABLE 演示文稿，SSRS 将创建 Excel 文件。它也很好用。

# linq-to-sql - 使用 LinqtoSql 返回域映射列表

> ID：753223
> 
> 赞同：0
> 
> 时间：2009-04-15T19:02:17.723
> 
> 标签：linq-to-sql, domain-driven-design

我怎样才能做到这一点，即保持映射分开？

而不是这个：

```
var people= (from p in db.people select new Person{ 
                                              id=p.id,
                                              name=p.name
                                               }).ToList(); 
```

我想做这个：

```
 var people= (from p is db.people select new Person {
                                        ***MAPTODOMAIN(p)*** 
                                         }).ToList(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T19:36:08.343

假设您模型中的 Person 是不在 Linq2SQL 数据上下文中的域类，并将类 AppUser 替换为数据上下文中的类（为了清楚起见，因为您的示例中的名称非常相似），这样的事情会工作：

```
 var people = (from p in db.AppUsers select MapPerson(p)).ToList(); 
```

它在代码的其他地方使用与此类似的方法：

```
 private Person MapPerson(AppUser user)
 {
     return new Person {Id = user.Id, Name = user.Name};
 } 
```

# sql-server - MS SQL Server 2008 中的复制指南

> ID：753224
> 
> 赞同：13
> 
> 时间：2009-04-15T19:02:22.513
> 
> 标签：sql-server, sql-server-2008, replication

我想在运行的两台不同计算机之间设置复制`MS SQL Server 2008`，主计算机在 Windows Vista 上运行，从服务器将在`Windows XP`.

我以前在两个 MySQL 服务器之间做过这个。

问题：有人有指南`**Replication in MS SQL Server 2008**`吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2021-08-09T15:22:15.770

我发现这个站点对设置 Replication 很有帮助，您可能已经看过它，但如果您还没有：

[https://www.sqlshack.com/sql-replication-basic-setup-and-configuration/](https://www.sqlshack.com/sql-replication-basic-setup-and-configuration/)

# pdf - pdf段落或文本位置块

> ID：753225
> 
> 赞同：0
> 
> 时间：2009-04-15T19:02:26.317
> 
> 标签：pdf, itext

我想检索构成 PDF 页面中的段落和/或文本块的矩形。

我看过 iTextSharp 和 DataLogics。

我能做的最好的就是找到一个单独的单词。但是，我需要知道这些词是否在同一个文本块中。

我正在使用 C#。有人有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T06:38:30.450

除非它的结构化 PDF，否则它不会存在。PDF 是一组位于位置的 drawString 命令 - 没有段落或空格标记。您需要从文本位置解决此问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-05T11:57:56.567

提取页面上每个单词的所有坐标，然后尝试将它们组合在一起。

首先要做的是分组。为此，您需要遍历所有单词和所有顺序单词，并将 y0 小于另一个的 y1，而 y1 大于另一个的 y0 的那些组合在一起。这些是线条。

然后你需要将你的行分组为段落。行首的 x 位置应在另一行页面宽度的 1/25 以内。并且线的y坐标之间的距离应该小于线的高度。这些是段落。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T19:39:54.933

这是在 Java 中，但它处理从 pdf 获取内容，然后从内容中的索引获取值。

我不确定，但你也许可以在 C# 中实现类似的东西。获取内容并打印出来。

```
//create a new reader from the source file
PdfReader reader = new PdfReader(fileName);
//create the file array
RandomAccessFileOrArray raf = new RandomAccessFileOrArray(fileName);
//get the content of the pdf reader (which is the source file)
byte bContent [] = reader.getPageContent(1,raf);
ByteArrayOutputStream bs = new ByteArrayOutputStream();
bs.write(bContent);
//create a string of the contents of the page in order to get the data needed
String contentOf1099 = bs.toString();
if(debug)
{
    System.err.println("contentOf1099 = "+contentOf1099);
}
//get the value based off an index
String value = contentOf1099.substring(contentOf1099.indexOf((",contentOf1099.indexOf("155 664 Td"))+1,contentOf1099.indexOf("(",contentOf1099.indexOf("155 664 Td "))+12); 
```

# iphone - 在 iPhone 上更改 UITabBarItem 色调颜色

> ID：753233
> 
> 赞同：4
> 
> 时间：2009-04-15T19:04:22.430
> 
> 标签：iphone, objective-c, cocoa-touch

> **可能重复：**
> [UITabBar 中的自定义颜色](https://stackoverflow.com/questions/675433/custom-colors-in-uitabbar)

iPhone UITabBar 一般采用蓝灰色图标方案。但是，iPod Touch 附带了一个来自 Nike 的应用程序，该应用程序具有红色图标覆盖层，而不是蓝色覆盖层。这是一个屏幕截图：

[图片链接 http://1.bp.blogspot.com/_iTGXYFIkfkA/SMiXRtd8HsI/AAAAAAAAKJQ/5iwA9wcZZjw/s400/ipodtouch2_2.jpg](http://1.bp.blogspot.com/_iTGXYFIkfkA/SMiXRtd8HsI/AAAAAAAAKJQ/5iwA9wcZZjw/s400/ipodtouch2_2.jpg)

我怎么做？我是否在 UITabBarItem 中使用隐藏的 setSelectedImage 方法？如果是这样，我什么时候打电话给这个？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T23:17:06.113

如果没有自定义绘图，则没有支持的方法来做到这一点。标签栏项目甚至不使用图像中的颜色，只使用 alpha 通道。另请参阅：[更改 UITabBar 的色调/背景颜色](https://stackoverflow.com/questions/571028/changing-tint-background-color-of-uitabbar)。

# java - Java Collections.sort(nodes) 使用什么类型？

> ID：753237
> 
> 赞同：12
> 
> 时间：2009-04-15T19:05:28.417
> 
> 标签：java, collections, sorting, time-complexity, mergesort

我认为是 MergeSort，即 O(n log n)。

但是，以下输出不同意：

```
-1,0000000099000391,0000000099000427
1,0000000099000427,0000000099000346
5,0000000099000391,0000000099000346
1,0000000099000427,0000000099000345
5,0000000099000391,0000000099000345
1,0000000099000346,0000000099000345 
```

我正在按序列号对 4 个节点的节点列表进行排序，并且排序正在进行 6 次比较。我很困惑，因为 6 > (4 log(4))。谁可以给我解释一下这个？

[PS它是mergesort，但我仍然不明白我的结果。](http://www.uni-ulm.de/admin/doku/jdk1.5/docs/api/java/util/Collections.html#sort(java.util.List,%20java.util.Comparator))

谢谢大家的回答。谢谢汤姆纠正我的数学。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-15T19:08:17.863

O(n log n) 并不意味着比较次数将等于或小于 n log n，只是所花费的时间将与 n **log** n 成正比。尝试用 8 个节点、16 个节点或 32 个节点进行测试，并检查时间。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-15T19:19:08.603

你对四个节点进行了排序，所以你没有得到归并排序；排序切换到插入排序。

> 在 Java 中，Arrays.sort() 方法根据数据类型使用归并排序或经过调整的快速**排序，当排序的数组元素少于七个时，为了提高实现效率，切换到插入排序。**（维基百科，重点补充）

Arrays.sort 由 Collections 类间接使用。

最近接受的一个错误报告表明，Java 的 Sun 实现将在未来使用 Python 的[timsort ：](http://svn.python.org/projects/python/trunk/Objects/listsort.txt) [http ://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6804124](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6804124)

（上面链接的 timsort 专着非常值得一读。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T19:20:48.973

处理数据量 n 的算法 A(n) 在 O(f(n)) 中，对于某些函数 f，如果存在两个严格的正常数 C_inf 和 C_sup，使得：

C_inf 。f(n) < ExpectedValue(OperationCount(A(n))) < C_sup 。f(n)

有两点需要注意：

*   实际的常量 C 可以是任何东西，并且取决于操作的相对成本（取决于语言、VM、架构或您对操作的实际定义）*。*例如，在某些平台上，+ 和 * 具有相同的成本，而在另一些平台上，后者的成本要慢一个数量级。

*   基于您正在处理的数据的一些可能任意模型，归属为“in O(f(n))”的数量是*预期的操作计数。*例如，如果您的数据几乎完全排序，则合并排序算法将主要是 O(n)，而不是 O(n . Log(n))。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T19:51:29.460

我写了一些您可能对 Java 排序算法感兴趣的东西，[并对 Collections.sort() 进行了一些性能测量](http://www.javamex.com/tutorials/collections/sorting_java_algorithm_performance_2.shtml)。目前的算法是一个**带有插入排序**的合并排序，一旦你达到一定大小的子列表（**注意这个算法很可能会在 Java 7 中改变**）。

您真的应该将 Big O 表示法作为算法整体扩展方式的指示；对于特定的排序，精确的时间会偏离这个计算预测的时间（正如你将在我的图表上看到的那样，组合在一起的两种排序算法各自具有不同的性能特征，因此排序的总时间是有点复杂）。

也就是说，作为粗略的指导，每次将元素数量增加一倍，如果将预期时间乘以 2.2，就不会太远了。（不过，对于包含几个元素的非常小的列表，这样做并没有多大意义。）

# php - 从 PHP 应用程序中抽象数据库的最佳方法是什么？

> ID：753238
> 
> 赞同：8
> 
> 时间：2009-04-15T19:05:40.180
> 
> 标签：php, database, design-patterns, orm, abstraction

我的问题是如何从应用程序的模型层抽象数据库连接？主要关注的是能够轻松地从不同类型的数据库中进行更改。也许您从一个平面文件、逗号分隔的数据库开始。然后你想移动到一个 SQL 数据库。然后稍后您决定 LDAP 实现会更好。一个人怎么能轻易地计划这样的事情呢？

举个简单的例子，假设您有一个用户，他有名字、姓氏和电子邮件。一个非常简单的 PHP 类表示它可能看起来像这样（请忽略公共实例变量的问题）：

```
<?php

class User {
  public $first;
  public $last;
  public $email;
}

?> 
```

我经常看到人们有一个 DAO 类，其中嵌入了 SQL：

```
<?php

class UserDAO {
  public $id;
  public $fist;
  public $last;
  public $email;

  public function create( &$db ) {
    $sql = "INSERT INTO user VALUES( '$first', '$last', '$email' )";
    $db->query( $sql );
  }
}

?> 
```

我对此类策略的问题是，当您想要更改数据库时，您必须更改每个 DAO 类的创建、更新、加载、删除函数来处理您的新型数据库。即使您有一个程序可以为您自动生成它们（我不是特别喜欢），您也必须编辑该程序以使其现在可以工作。

你对如何处理这个问题有什么建议？

我目前的想法是为 DAO 对象创建一个超类，具有自己的创建、删除、更新、加载功能。但是，这些函数将采用 DAO 的属性数组并生成查询本身。这样，唯一的 SQL 就在 SuperDAO 类中，而不是分散在几个类中。然后，如果你想改变你的数据库层，你只需要改变 SuperDAO 类生成查询的方式。好处？缺点？可预见的问题？黄金三镖客？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-15T19:11:34.020

您可以使用各种框架，例如 PDO、PEAR::MDB2 或 Zend_Db，但老实说，在 12 年的 PHP 开发中，我从未需要从一种数据存储基础架构过渡到另一种。

甚至从 Sqlite 之类的非常相似的东西转到 MySQL 也是非常罕见的。如果你做的不止这些，那么无论如何你都会遇到更大的问题。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-15T19:11:19.853

使用[ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)通常是抽象数据库的首选方式。[Wikipedia](http://en.wikipedia.org/wiki/List_of_object-relational_mapping_software#PHP)上提供了 PHP 实现的不完整列表。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T19:21:38.940

最好的方法是使用 ORM（对象关系映射）库。PHP有很多。我个人使用过并且可以推荐[教义orm](http://www.doctrine-project.org/projects/orm.html)（我已经将它与silex结合使用，它是一个简约的php框架）。

这是一个关于 PHP ORM 的 StackOverflow 线程，如果您愿意，您可以在其中找到一些替代方案：[Good PHP ORM Library？](https://stackoverflow.com/questions/108699/good-php-orm-library)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-06-05T13:20:06.020

我想出了一个有趣的概念，它允许开发人员创建与**数据库无关的**代码，但与 ORM 不同的是**不会牺牲性能**：

*   易于使用（如 ORM）
*   db-agnostic：适用于 SQL、NoSQL、文件等
*   如果供应商允许，总是优化查询（sub-select，map-reduce）

结果是[敏捷数据 - 数据库访问框架](https://github.com/atk4/data)（详细解释请参见视频）。

## 使用与 DB 无关的代码和敏捷数据解决现实生活中的任务

1.  [从描述商业模式](https://github.com/atk4/data/wiki/README-Example-Support-Files)开始。
2.  创建持久性驱动程序`$db`（DB 连接的一个花哨的词），它可以是 CSV 文件、SQL 或 LDAP。
3.  关联模型`$db`并表达你的`Action`
4.  执行`Action`

此时，框架将根据数据库的能力确定最佳策略，映射您的字段声明，为您准备和执行查询，这样您就不必编写它们了。

## 代码示例

我的下一个代码片段解决了一个相当复杂的问题，即确定**我们所有 VIP 客户的当前总债务是多少**。架构：

[![在此处输入图像描述](https://i.stack.imgur.com/lIVqw.png)](https://i.stack.imgur.com/lIVqw.png)

接下来是与供应商无关的代码：

```
$clients = new Model_Client($db);
// Object representing all clients - DataSet

$clients -> addCondition('is_vip', true);
// Now DataSet is limited to VIP clients only

$vip_client_orders = $clients->refSet('Order');
// This DataSet will contain only orders placed by VIP clients

$vip_client_orders->addExpression('item_price')->set(function($model, $query){
    return $model->ref('item_id')->fieldQuery('price');
});
// Defines a new field for a model expressed through relation with Item

$vip_client_orders->addExpression('paid')
  ->set(function($model, $query){
    return $model->ref('Payment')->sum('amount');
});
// Defines another field as sum of related payments

$vip_client_orders->addExpression('due')->set(function($model, $query){
    return $query->expr('{item_price} * {qty} - {paid}');
});
// Defines third field for calculating due

$total_due_payment = $vip_client_orders->sum('due')->getOne();
// Defines and executes "sum" action on our expression across specified data-set 
```

结果查询 if`$db`是 SQL：

```
select sum(
  (select `price` from `item` where `item`.`id` = `order`.`item_id` )
  * `order`.`qty`
  - (select sum(`payment`.`amount`) `amount` 
     from `payment` where `payment`.`order_id` = `order`.`id` )
) `due` from `order` 
where `order`.`user_id` in (
  select `id` from `user` where `user`.`is_client` = 1 and `user`.`is_vip` = 1 
) 
```

对于其他数据源，执行策略可能会增加更多数据，但会始终如一地工作。

我认为我的方法是抽象数据库的好方法，我正在努力在 MIT 许可下实现它：

[https://github.com/atk4/data](https://github.com/atk4/data)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-15T19:10:00.763

您应该查看[PDO 库。](http://is.php.net/manual/en/intro.pdo.php)

> PDO 提供了一个数据访问抽象层，这意味着，无论您使用哪个数据库，您都可以使用相同的函数来发出查询和获取数据。
> 
> PDO 不提供数据库抽象；它不会重写 SQL 或模拟缺失的功能。如果您需要该功能，您应该使用成熟的抽象层。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-15T19:10:34.847

这在理论上听起来不错，但很可能是[YAGNI](http://en.wikipedia.org/wiki/You_Ain%27t_Gonna_Need_It)。

您最好使用诸如[PDO](http://www.php.net/pdo)之类的 SQL 库，并且在您到达那里之前不要担心 LDAP。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-15T19:20:40.707

一般来说，如果您在使用数据库时遇到了麻烦，那么您的应用程序将受益于使用特定于数据库“品牌”的功能，并且将成为一个更可靠的应用程序。

从一个数据库系统迁移到另一个数据库系统是非常罕见的。只有在编写某种松散耦合的系统或框架以供大众消费（如 Zend Framework 或 Django）时，您才可能真正考虑到值得实现的特性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-15T21:37:25.867

我一直喜欢使用 ADOdb。从我所见，它看起来能够在截然不同的平台之间切换。

[http://adodb.sf.net](http://adodb.sf.net)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-12-29T16:08:34.720

事实上解决方案“在哪里实现数据访问逻辑？” 并不复杂。您只需要记住，您的模型代码必须与数据访问代码分开。

像：

具有一些业务逻辑的模型层 User::name() 方法

```
class User 
{
  public $first;
  public $last;
  public $email;
  public function name ()
  {
      return $this->first." ".$this->last;
  }
} 
```

数据访问层：

```
class Link
{
    $this->connection;
    public function __construct ()
    {
        $this->connection = PDO_Some_Connect_Function();
    }
    public function query ($query)
    {
        PDO_Some_Query ($this->connection, $query);
    }

}

class Database
{
    public $link;
    public function __construct ()
    {
        $this->link = new Link();
    }
    public function query ($query)
    {
        $this->link->query ($query);
    }
}

class Users
{
    public $database;
    public function __construct (&$database)
    {
         $this->database = &$database;
    } 
    public save ($user)
    {
        $this->database->link->query ("INSERT INTO user VALUES( '$user->first', '$user->last', '$user->email' ))";
    } 
```

用法：

```
$database = new Database();

$users = new Users();

$users->save (new User()); 
```

在这个例子中，很明显你总是可以改变你的数据访问类 Link 它将在任何东西上运行查询（这意味着你可以在你改变链接时将你的用户保存在任何服务器上）。

同时你有干净的模型层代码，它独立存在，不知道谁在哪里保存它的对象。

此外，这里的数据库类似乎没有必要，但实际上它可以产生一些很棒的想法，例如在一个项目中为多个数据库连接收集多个链接一个实例。

还有一个名为[db.php](http://dbphp.net) ( [http://dbphp.net](http://dbphp.net) ) 的单一文件最简单和全能的框架，它建立在我在这里描述的模式之上，甚至可以自动创建表，能够完全控制其标准 sql 字段/表设置和同步每次您希望时将数据库结构添加到您的模型中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-08-23T08:21:48.073

[Axon ORM](http://fatfree.sourceforge.net#axon)会自动检测架构中的更改，而无需您重新构建代码。

# c# - 如何形成这个正则表达式

> ID：753247
> 
> 赞同：1
> 
> 时间：2009-04-15T19:08:45.727
> 
> 标签：c#, regex

假设字符串是：

```
string item = "t-ewrwerwerwerwer\r-rr\wrjkwlr"; 
```

我想全部替换 - 除非它前面有 r。

所以结果将是

```
string cleanItem = "tewrwerwerwerwer\r-rr\wrjkwlr"' 
```

可以使用什么正则表达式？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T19:23:22.413

我认为这个正则表达式更有效一点：

```
-(?<!r-) 
```

或者，如果您的语言不支持否定的后视断言，请使用以下表达式：

```
(^|[^r])- 
```

并将其替换为`\1`（第一个匹配组）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T19:12:27.573

`(?<!r)-`我认为用空字符串替换应该可以解决问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T19:16:00.140

```
(?<!r)- 
```

只要您的正则表达式风格支持零宽度后视，就是这样。

# emacs - 在 Emacs Lisp 中插入整月的日期

> ID：753248
> 
> 赞同：7
> 
> 时间：2009-04-15T19:09:03.587
> 
> 标签：emacs, elisp

我在 Emacs Lisp 中到处做一些编程，但我不完全确定如何去做某些事情。

我正在尝试插入一整月的日期，每个日期都在一个新行中，如下面的列表：

一月

09 年 1 月 1 日星期一：

2009 年 2 月 1 日星期二：

2009 年 3 月 1 日星期三：

ETC

我该怎么做呢？我已经找到了如何格式化日期，但我找不到如何循环某个日期范围（在这种情况下循环整个月并为该月的每一天打印一个日期）。

有没有人可以给我一些关于如何开始的指示？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-15T19:42:43.320

您想要的函数是`'encode-time`、`'format-time-string`和`'decode-time`。对于正确的文档，`C-h f function-name`或者将为您提供该函数的文档，或者可以在此处找到一般的 elisp 信息页面：`C-h i m elisp RET m time conversion RET`

这是那个片段：

```
(defun my-insert-dates ()
  "insert a bunch of dates"
  (interactive)
  (let* ((month 3)
         (day 1)
         (time (encode-time 1 1 0 day month 2009)))
    (while (= (nth 4 (decode-time time)) month)
      (insert (format-time-string "%D %a:\n" time))
      (setq day (1+ day))
      (setq time (encode-time 1 1 0 day month 2009))))) 
```

我找不到如何确定给定月份的天数（当然，您可以对其进行硬编码，但是您必须处理闰年）。幸运的是，`'encode-time`为你做了所有的加法，所以如果你通过它相当于“2 月 31 日”，它将返回“3 月 3 日”（假设 28 天）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-15T20:02:45.533

如果您不介意使用日历功能，我会做这样的事情......

```
(require 'calendar)
(defun display-a-month (day month year)
  (insert (format "%s\n" (calendar-date-string (list  month day year))))
  (if (< day 30)
    (display-a-month (+ day 1) month year))) 
```

您可以使用 describe-function 找到帮助（如前所述，Mx describe-function 或 Ch f）；Mx apropos 将为您提供与某事相关的功能列表，irc.freenode.org / #emacs 上更好的人将回答您所有的问题。

顺便说一句，问题是“插入一整个月”而不是“插入每个月的第一天”:) 取决于您是否阅读了 mm/dd/yyyy 的 dd/mm/yyyy

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T19:53:08.257

使用 dotimes 对 Trey 的回答略有不同：

```
(defun my-insert-dates ()
  "insert the first day of each month"
  (interactive)
  (dotimes (mo 12)
    (insert (format-time-string "%D %a:\n" (encode-time 1 1 0 1 (1+ mo) 2009))))) 
```

# c# - 是否可以在编译时（不是运行时）在 C# 中查询自定义属性

> ID：753255
> 
> 赞同：24
> 
> 时间：2009-04-15T19:10:16.860
> 
> 标签：c#, custom-attributes

换句话说，是否有可能创建程序集，如果每个类都没有（“必须”）自定义属性（例如 Author 和 Version），它甚至不会编译（假设检查代码没有被删除）？

这是我在运行时用于查询的代码：

```
using System;
using System.Reflection;
using System.Collections.Generic; 

namespace ForceMetaAttributes
{

    [System.AttributeUsage ( System.AttributeTargets.Method, AllowMultiple = true )]
    class TodoAttribute : System.Attribute
    {
        public TodoAttribute ( string message )
        {
            Message = message;
        }
        public readonly string Message;

    }

    [System.AttributeUsage ( System.AttributeTargets.Class |
        System.AttributeTargets.Struct, AllowMultiple = true )]
    public class AttributeClass : System.Attribute
    {
        public string Description { get; set; }
        public string MusHaveVersion { get; set; }

        public AttributeClass ( string description, string mustHaveVersion ) 
        {
            Description = description; 
            MusHaveVersion = mustHaveVersion ; 
        }

    } //eof class 

    [AttributeClass("AuthorName" , "1.0.0")]
    class ClassToDescribe
    {
        [Todo ( " A todo message " )]
        static void Method ()
        { }
    } //eof class 

    //how to get this one to fail on compile 
    class AnotherClassToDescribe
    { 

    } //eof class 

class QueryApp
{
        public static void Main()
        {

                Type type = typeof(ClassToDescribe);
                AttributeClass objAttributeClass;

                //Querying Class Attributes

                foreach (Attribute attr in type.GetCustomAttributes(true))
                {
                        objAttributeClass = attr as AttributeClass;
                        if (null != objAttributeClass)
                        {
                                Console.WriteLine("Description of AnyClass:\n{0}", 
                                                                    objAttributeClass.Description);
                        }
                }

                //Querying Class-Method Attributes  

                foreach(MethodInfo method in type.GetMethods())
                {
                        foreach (Attribute attr in method.GetCustomAttributes(true))
                        {
                                objAttributeClass = attr as AttributeClass;
                                if (null != objAttributeClass)
                                {
                                        Console.WriteLine("Description of {0}:\n{1}", 
                                                                            method.Name, 
                                                                            objAttributeClass.Description);
                                }
                        }
                }
                //Querying Class-Field (only public) Attributes

                foreach(FieldInfo field in type.GetFields())
                {
                        foreach (Attribute attr in field.GetCustomAttributes(true))
                        {
                                objAttributeClass= attr as AttributeClass;
                                if (null != objAttributeClass)
                                {
                                        Console.WriteLine("Description of {0}:\n{1}",
                                                                            field.Name,objAttributeClass.Description);
                                }
                        }
                }
                Console.WriteLine ( "hit Enter to exit " );
                Console.ReadLine ();
        } //eof Main 
} //eof class 

} //eof namespace 

//uncomment to check whether it works with external namespace 
//namespace TestNamespace {

//  class Class1 { }
//  class Class2 { }

//} 
```

编辑：只是为了证明我选择答案的合理性。我认为 casperOne 提供了该问题的正确答案。

然而，问这个问题的理由似乎很[薄弱](https://stackoverflow.com/questions/753255/is-it-possible-to-query-custom-attributes-in-c-during-compile-time-not-run-tim/753301#753301)。可能我应该开始使用一些外部工具，例如： [FinalBuilder](http://www.finalbuilder.com/Demos/FinalBuilder_basic_viewlet_swf.html) 或创建单元测试来检查这个“要求”，使用 Pex、Nunit 或其他单元测试框架......

**EDIT** I added a small [code snippet](https://stackoverflow.com/questions/753255/is-it-possible-to-query-custom-attributes-in-c-during-compile-time-not-run-tim/763010#763010) of a console program at the end of the answers that performs the check ... feel free to comment, criticize or suggest improvements
Once more I realized that this "requirement" should be implemented as part of the unit testing just before the "check in"

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-15T19:12:58.023

No, it is not possible to hook into the compilation of the assembly and check if it exists.

*However* you can hook into the build process, which is made up of more than just running the compiler. You could create a custom MSBUILD task (or NAnt, if you are using that) which checks the assembly through reflection after it is built and then fail the build if it doesn't have the required attributes.

Of course, you should probably *still* verify this in code as well. What you are trying to do is not a good substitute for a proper runtime check.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-15T19:17:03.850

You can run a post-build step that reflects on the DLL to do what you want.

You will have to write a command-line app that loads the DLL and reflects on the types. You then run that command-line app as a post-build step. I have done this in the past. It is not terribly difficult to do, assuming you understand the reflection API.

[PostSharp](http://www.postsharp.org/) does this to achieve aspect oriented programming. Pretty cool, actually.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T19:13:56.370

Attributes are run time only. However :

It would be possible to create a rule in FXCop (static analysis) that will fail if the attribute is not defined, and your build/checkin process could check that rule and fail appropriately.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T19:14:09.393

I'm not aware of any way to hook into the C# compilation process, but you may take a different approach and create a custom tool launched on the post build event which could load your assembly and reflects on that. Depending on what the tool returns the whole build process will result in a success or a failure, so you may just return an error with your tool and make the build fail, while providing more details about the failure writing to console.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T19:22:56.673

To me this seems more like a testing problem than a compilation problem. That is, you're asking "how do I know that my code is written correctly?" where "written correctly" has (among other things) the connotation that all classes are decorated with a particular attribute. I would consider writing unit tests that verify that your attribute inclusion rules are, in fact, followed. You could have your build (and/or checkin) process run this particular set of tests after the build (before the checkin) as a condition of a successful build (checkin). It won't break the compile, since that needs to complete in order for the tests to run, but it will break the build, so to speak.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-18T06:16:03.903

```
//PLEASE COMMENT IF YOU FIND BUGS OR SUGGEST IMPROVEMENTS

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Reflection;

namespace MustHaveAttributes
{
 [AttributeClass ( "Yordan Georgiev", "1.0.0" )] 
 class Program
 {

 static void Main ( string [] args )
 {
  bool flagFoundCustomAttrOfTypeAttributeClass = false; 
  Console.WriteLine ( " START " );

  // what is in the assembly
  Assembly a = Assembly.Load ( "MustHaveAttributes" );
  Type[] types = a.GetTypes ();
  foreach (Type t in types)
  {
   object[] arrCustomAttributes = t.GetCustomAttributes ( true );

   if (arrCustomAttributes == null || arrCustomAttributes.GetLength ( 0 ) == 0)
   {
    //DO NOT CHECK IN
    ExitProgram ( t, "Found class without CustomAttributes" );
   }

   foreach (object objCustomAttribute in arrCustomAttributes)
   {
    Console.WriteLine ( "CustomAttribute for type  is {0}", t );
    if (objCustomAttribute is AttributeClass)
     flagFoundCustomAttrOfTypeAttributeClass = true; 
   }

   if (flagFoundCustomAttrOfTypeAttributeClass == false)
   { //DO NOT CHECK IN 
    ExitProgram ( t, "Did not found custom attribute of type AttributeClass" );
   }
   Console.WriteLine ( "Type is {0}", t );
  }
  Console.WriteLine ("{0} types found", types.Length );

  //NOW REQUIREMENTS IS PASSED CHECK IN
  Console.WriteLine ( " HIT A KEY TO EXIT " );
  Console.ReadLine ();
  Console.WriteLine ( " END " );
 }

 static void ExitProgram ( Type t, string strExitMsg  )
 {

  Console.WriteLine ( strExitMsg );
  Console.WriteLine ( "Type is {0}", t );
  Console.WriteLine ( " HIT A KEY TO EXIT " );
  Console.ReadLine ();

  System.Environment.Exit ( 1 );

 }
} //eof Program

//This will fail even to compile since the constructor requires two params
//[AttributeClass("OnlyAuthor")]  
//class ClassOne
//{ 

//} //eof class 

////this will not check in since this class does not have required custom
////attribute
//class ClassWithoutAttrbute
//{ }

[AttributeClass("another author name " , "another version")]
class ClassTwo
{ 

} //eof class

[System.AttributeUsage ( System.AttributeTargets.Class |
 System.AttributeTargets.Struct, AllowMultiple = true )]
public class AttributeClass : System.Attribute
{

 public string MustHaveDescription { get; set; }
 public string MusHaveVersion { get; set; }

 public AttributeClass ( string mustHaveDescription, string mustHaveVersion )
 {
  MustHaveDescription = mustHaveDescription;
  MusHaveVersion = mustHaveVersion;
 }

} //eof class 
```

} //eof namespace

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-05-02T13:52:10.820

This is now fully possible using by writing a Roslyn analyzer. You could use either the syntax tree or the semantic model. (The latter is recommended, due to the complexities of how attribute names can be referenced, for example using `using` aliasing).

# javascript - 显示来自 AJAX 请求的内容结果文本

> ID：753265
> 
> 赞同：0
> 
> 时间：2009-04-15T19:13:43.997
> 
> 标签：javascript, asp.net-mvc, asp.net-ajax

我有一个`Ajax.Action`链接连接到我的控制器类中的一个 post 方法，该方法返回一个`ContentResult`. 在查看诸如 firebug 之类的工具时，我能够发出请求并获得响应，但我在尝试实际访问响应文本或对响应文本执行任何操作时遇到了问题。

基本上，我的控制器中有这样的东西：

```
public ContentResult RevertToDefault(int id, string default)
{
  /** Update the DB **/

  return Content(default);
} 
```

在我看来，这是：

```
<%= Ajax.ActionLink(
  "Revert",
  "RevertToDefault",
  new { id = Model.MyObject.ID, default = Model.MyObject.DefaultValue },
  new AjaxOptions { OnComplete = "function(r) { alert(r); }" })%> 
```

现在，警报刚刚返回`[object Object]`。更改是在数据库中进行的，我猜我可以访问`ContentResult`该对象中的某个位置`r`，但是我很难在网上找到好的示例/文档。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T19:22:29.687

据我所知，OnComplete 事件处理程序的参数是 ajaxContext，因此您可以尝试 ajaxContext.get_response() 并获取您的响应对象或 ajaxContext.get_data()，它应该返回作为响应发送的实际数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:04:30.163

是的，前面的答案是绝对正确的。只需这样做：

```
<%= Ajax.ActionLink(
  "Revert",
  "RevertToDefault",
  new { id = Model.MyObject.ID, default = Model.MyObject.DefaultValue },
  new AjaxOptions { OnComplete = "function(r) { alert(r.get_data()); }" })%> 
```

# web-services - 适合新手的实用 SOA

> ID：753273
> 
> 赞同：6
> 
> 时间：2009-04-15T19:15:46.973
> 
> 标签：web-services, service, scalability, soa, high-availability

我是 SOA 领域的新手。因此，我正在研究一些“SOA 框架/技术”，并试图了解如何利用它们来构建一个高度可扩展的（Facebook 类）网站。

我想在这里解决几个“痛点”：

1.  可组合性（+ 管理依赖项，Pub/Sub）
2.  服务的语言无关
3.  可扩展性和性能
4.  高可用性

我研究了一些可以回答上述标准子集的技术：

1.  [Thrift](http://incubator.apache.org/thrift/) - Facebook 的跨平台 RPC 平台
2.  [WCF](http://en.wikipedia.org/wiki/Windows_Communication_Foundation) - 支持 SOAP、JSON 和 REST，因此它可以被认为是语言互操作的。生成可用于生成 java 代理的[WSDL文件。](http://en.wikipedia.org/wiki/Web_Services_Description_Language)
3.  [Microsoft DSS](http://social.msdn.microsoft.com/Forums/en-US/roboticsdss/thread/babf3e90-8196-40b2-a4a1-5f2ecc4e9b47) - 只是将它包含在我的调查中，但它似乎并不相关，因为它是高度状态驱动的和特定于 .NET 的。
4.  网页服务

现在，我了解了如何从上述内容中获得可组合性和语言独立性的某些方面。但是，我还没有找到很多关于如何使用上述/其他工具来实现可扩展性和高可用性的具体信息（不是嗡嗡声）。所以最后我得到了我的问题：

**如何利用 SOA 技术来解决我上面定义的问题？**我在哪里可以找到这方面的技术指南？我寻找的不仅仅是系统图，而是实际的库、代码示例、APIS ......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T06:59:14.047

我认为这个问题更多地与所涉及的概念有关，而不是与工具有关。对项目的回答：

1.  理解和内化[有界上下文](http://domaindrivendesign.org/discussion/messageboardarchive/BoundedContext.html)。将不相关的部分分开对于在不同的服务上实现真正的重用非常重要。相关技术在这方面对您没有帮助，您可以在适当的上下文中分离应用程序，您可以将其适当地重用于不同的服务。
2.  基于已知协议的清晰通信端点允许使用不同的技术实现不同的部分
3.  让操作像基于不同协议的独立操作一样流动，为您提供了很多可以添加层的地方。是整个流程的一个特定子流程，使用大量资源，服务器不能再接受了，只需移动到单独的服务器。负载不断增长，并且该服务器不再使用它，添加额外的服务器和负载平衡。您还有更多机会使用缓存和连接池。
4.  有一个需要始终可用的关键子流程，添加一个服务器以便您可以进行故障转移。有一个需要始终“可用”的整体流程，将队列用于以后可以处理的部分。

你真的需要支持这种类型的负载吗？设置与特定场景相关的适当性能/负载/互操作性目标。如果你真的需要支持这种类型的负载，我建议你找一个已经处理过它的人加入。

如果最终可能是负载，请识别有界上下文并设计具有 SOA 思维方式的人之间的交互。剩下的就是保持代码干净，在代码库中使用 TDD、松散耦合、集中集成测试等。有了好的代码，如果您以后需要分离系统的各个部分，就会容易得多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-24T23:49:06.883

亚马逊的 CTO - Werner Vogels 谈到了关于服务和架构的有趣且相关的事情：

*   关于亚马逊技术平台[的采访](http://queue.acm.org/detail.cfm?id=1142065)
*   他博客上的一篇文章 - “[最终一致 - 重新](http://www.allthingsdistributed.com/2008/12/eventually_consistent.html)访问”
*   关于可用性和一致性的 50 分钟[演示](http://www.infoq.com/presentations/availability-consistency)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T05:55:06.200

IDesign.net 有[大量的 WCF 下载](http://idesign.net/idesign/DesktopDefault.aspx?tabindex=5&tabid=11)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T05:42:26.883

查看捆绑 CXF 服务堆栈的[Mule](http://www.mulesource.org)项目以及提供 RESTful 替代方案的 Mule REST 包。我想你会看到它解决了你所有的痛点，并且在文档和发行版中有很多例子。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-20T16:58:46.273

这里的所有建议都很好，但在你真正需要之前不要担心。

专注于构建人们真正喜欢的可用、实用的应用程序。当你开始遇到问题时，就开始处理瓶颈。

您永远无法预见应用程序将失败的每一种方式，那么您如何判断 [[insert tech here]] 是否是您的答案？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-15T19:23:03.163

值得一看： http: [//www.manning.com/davis/](http://www.manning.com/davis/)？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-18T21:34:14.740

我可以推荐这本书：Springer Verlag 出版的 Enterprise Service Oriented Architectures。

# c# - 将 GridView 的 DataSourceId 设置为“”，导致 GridView 丢失

> ID：753285
> 
> 赞同：0
> 
> 时间：2009-04-15T19:18:45.750
> 
> 标签：c#, .net, asp.net, gridview, viewstate

如果我将 GridView 绑定到 SqlDataSource，那么将创建第一个页面，GridView 将显示从数据源检索到的列。但是，如果在回发时我将 GridView.DataSourceID 设置为 null 或空字符串

```
 protected void Page_Load(object sender, EventArgs e)
    {
             ...
        if (IsPostBack)
            GridView1.DataSourceID = "";
             ...
    } 
```

, 那么 GridView 根本不会显示任何行。但这是为什么呢？

假设 GridView 将 EnableViewstate 设置为 true，那么它应该能够显示在第一次创建页面时从数据源检索到的行！我意识到有人可能会争辩说 Framework 注意到 DataSourceId 已更改并假设 GridView 不需要来自先前数据源的数据，但我假设 Framework 会意识到空字符串或空引用不指向任何数据源，因此不会删除从先前数据源检索到的任何数据 GridView？！

谢谢你

编辑：
你好，

> 基本上，一旦您将 DataSourceID 设置为 null 或空字符串，控件就会将此作为来自控件使用者的指示，即他们根本不希望绑定任何数据（甚至是 ViewState 数据）。控件在绑定之前检查 DataSourceID，如果它是一个空字符串，那么它不会在其 EnsureDataBound 方法中进行 DataBind。

因此，如果您在 Page_Load() 中将 DataSourceID 设置为 null，但 GridView 仅在绑定之前检查 DataSourceId （这发生在 Page_Load 之后很长时间），那么在检查 DataSourceId 之前，包含来自先前数据源的数据的 ViewState 应该仍然在 Page_Load() 中可用（并且仍然可用，例如，在订阅了导致回发的事件的事件处理程序中）？！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T19:32:49.210

如果您设置`DataSourceID`to`null`或空字符串，您的控件将不会重新绑定到 ViewState 数据。我在下面链接的文章对原因有很好的解释。

基本上，一旦您设置了`DataSourceID`to`null`或空字符串，控件就会将此作为控件使用者的指示，即他们根本不希望绑定任何数据（甚至是 ViewState 数据）。控件`DataSourceID`在绑定之前检查，如果它是一个空字符串，那么它不在`DataBind`它的`EnsureDataBound`方法中。

> [System.What?：数据源 VS。DataSourceID（内部）](http://blog.tylerholmes.com/2008/06/datasource-vs-datasourceid-internals.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T19:24:31.943

> 我假设框架会意识到空字符串或空引用不指向任何数据源，因此不会删除从先前数据源检索到的任何数据 GridView？

你为什么这么想，你重置了值，当然，girdview必须绑定你重置的新值。

# c# - 在exe中包含dll？

> ID：753292
> 
> 赞同：1
> 
> 时间：2009-04-15T19:21:13.433
> 
> 标签：c#, .net-3.5, dll

> **可能重复：**
> [.NET windows 应用程序，可以将其压缩为单个 .exe 吗？](https://stackoverflow.com/questions/126611/net-windows-application-can-it-be-compressed-into-a-single-exe)

我有一个依赖多个 dll 的项目，一旦我编译它，它要求我在与 dll 相同的文件夹中运行 .exe。我可以将它们打包在一起，这样我就不必这样做了吗？

作为参考，我使用的是 C#

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-15T19:23:48.933

您可以使用[ILMerge](http://www.microsoft.com/downloads/details.aspx?FamilyID=22914587-B4AD-4EAE-87CF-B14AE6A939B0&displaylang=en)将它们合并为一个。

# c# - 如何访问服务器上的 Jquery TreeView？

> ID：753293
> 
> 赞同：1
> 
> 时间：2009-04-15T19:21:28.020
> 
> 标签：c#, asp.net, jquery, treeview

如何在表单提交时访问 .aspx 文件中的 Jquery Treeview？另外，我可以即时将节点添加到 Jquery Treeview 吗？（在客户端）

我正在使用 asp.net 网络表单，c#

已编辑：有人在其中一个问题中提到了以下内容：“在提交表单时，有人将不得不在客户端编写代码以收集该数据并通过 Ajax 将其发送到服务器方法”

这是怎么做的？？？？？？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T08:31:33.763

好吧，我想我已经找到了你想要的东西。看看[这里](http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/)。

简而言之，您必须在服务器端定义一个 WebMethod，然后您可以使用 jQuery 轻松访问它。一个出色的工作示例在上面的链接下，在这里我将对其进行修改以展示如何传递参数。所以...

在您的页面代码隐藏 *.cs 中：

```
// We'll use this class to communicate
public class Dog
{
    public string Name { get; set; }
    public string Color { get; set; }
}

// This is your page, in my case Default.aspx
public partial class _Default : System.Web.UI.Page
{
    [WebMethod]
    public static string ProcessData(Dog myDog)
    {
        return "Your " + myDog.Color + " dog's name is " + myDog.Name + "!";
    }
} 
```

然后在您的 *.aspx 上：

```
<script src="jquery-1.3.2.min.js" type="text/javascript"></script>
<script src="json2.js" type="text/javascript"></script>

<script type="text/javascript">

    $(document).ready(function() {
        $("#btnProcess").click(function() {
            // This is what we want to send to the server
            var dogItem =
            {
                 Color: $("#txtColor").val(),
                 Name: $("#txtName").val()
            };

            // And this is how it should be sent - in serialized way
            var dogItemSerialized = JSON.stringify(dogItem);

            $.ajax({
                type: "POST",
                url: "Default.aspx/ProcessData",
                data: "{'myDog':" + dogItemSerialized + "}",    
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function(msg) {
                    $("#result").text(msg.d);
                }
            });
        });
    });

</script>
Color: <input id="txtColor" type="text" /><br />
Name: <input id="txtName" type="text" /><br />
<input id="btnProcess" type="button" value="Click Me" />
<div id="result"></div> 
```

因此，在这里您填写文本框，然后将您的数据发送到将其理解为 Dog 对象的服务器。注意参数传递，因为这是最令人困惑的部分。您应该以 JSON 格式传递它们，这有点“过于冗长”。所以我在这里使用 json2.js 脚本，它有助于将常用的 javascript 对象转换为 JSON 序列化字符串（JSON.stringify() 方法）。它可以[在这里找到](https://github.com/douglascrockford/JSON-js/blob/master/json2.js)。但它仍然相当难看 =) 我传递名为“myDog”的参数很重要，它的值是序列化的 dogItem。因为这正是服务器期望得到的（所以，例如，我不能更改参数名称，这是**行不通的**：

```
data: "{'someAnotherArgumentName':" + dogItemSerialized + "}" 
```

最后一件事。请注意以下行：

```
success: function(msg) {
            $("#result").text(msg.d);
         } 
```

如果您使用的是 3.5 之前的 ASP.NET（例如，ASP.NET 2.0），那么您只需编写 $("#result").text( **msg** ) 而不是**msg.d**。出于某种原因，只有 ASP.NET 3.5 封装了“d”成员下的所有数据......

无论如何，在上面的文章中你可以找到有用的链接（在文章内部和评论中），所以你可以阅读更多关于参数的信息，“msg.d”等等。

我希望这有帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T19:44:18.323

由于 jQuery Treeview 是一个客户端组件，因此您无法从服务器端访问它。因此，为了将任何数据从您的树传递到服务器，您必须编写客户端 javascript 代码（实际上是 jQuery 代码）。与动态添加节点到树视图相同：仅使用客户端 jQuery 代码。请记住，您在服务器端的 C# 不知道您的 TreeView。

jQuery 和 ASP.NET WebForms 之间的集成是相当有问题的并且“不是那么自然”，因为 ASP.NET 是建立在不同的概念之上的......所以如果你正在使用 ASP.NET WebForms，我建议你使用 server-侧组件（它可以是 Microsoft 自己的 ASP:TreeView 或其他 3rd-party WebForms 目标组件）。或者，您可以尝试新的 ASP.NET MVC 框架——它建立在更常见的（用于其他 Web 开发平台）概念之上，并且它与 jQuery 之间的集成很简单（实际上 jQuery 甚至附带它）。

不要误会我的意思……我并不是说 jQuery 和 ASP.NET WebForms 之间的集成是完全不可能的。有可能的。但是你需要做“不那么漂亮”的事情，并为每一个简单的操作而努力。如果您仍想使用 jQuery，则仅将其用于客户端动画...

更新：至于这句话——“在提交表单时，有人将不得不在客户端编写代码来收集数据并通过 Ajax 将其发送到服务器方法”——这正是我所说的。在客户端，您在提交表单时调用 javascript 方法（例如，通过在“提交”按钮上设置 onclick='mymethod();'）。这段代码完成了它需要做的事情，然后......它应该使用 jQuery nice 语法执行 AJAX 调用。但这不适用于 ASP.NET WebForms，正如我之前解释的那样。好吧，您可以阅读有关 Microsoft AJAX 客户端库的信息（此处：http: [//msdn.microsoft.com/en-us/magazine/cc163300.aspx](http://msdn.microsoft.com/en-us/magazine/cc163300.aspx))，也许这会有所帮助。但我仍然认为这种整合不会简单直接。将 jQuery 用于动画，将 ASP.NET 服务器端组件用于所有其他事物！

# windows - 在您自己的应用程序中直观地包含另一个应用程序

> ID：753294
> 
> 赞同：2
> 
> 时间：2009-04-15T19:21:37.707
> 
> 标签：windows, delphi, forms

我有四个用 Delphi (Win32) 编写的小型单一形式实用程序应用程序，每隔一段时间我想以一种让它们“感觉”就像它们都是一个应用程序的方式使用它们，主要是为了切换回来他们之间来回超级容易。例如，能够将它们作为容器插入 TabSheet 或类似的东西会很棒。

AppControls 制作了一个简洁的小组件，它与 TForm 后代执行类似的操作，允许将它们插入到 Delphi 应用程序中的另一个容器中（参见 acEmbeddedForm http://www.appcontrols.com/appcontrols/overview.html'>here），但是除非我在构建第五个应用程序时考虑到这个最终结果，并以原始四个应用程序的所有形式进行编译，否则我看不出有任何方法可以使用四个单独的应用程序来做到这一点。

我也可以想象想要“包含”或嵌入一些其他应用程序（例如，记事本）。

这在德尔福有可能吗？（一切皆有可能……<g>）……如果是这样，会不会超级困难，并且需要大量熟悉 Windows API 的底层知识？

我在想这些问题的答案可能是肯定的，肯定的，但希望答案是肯定的，否定的。以为我会问只是为了确定。<g>

如果我从编程的角度来这里做梦，这比它的价值要多得多；对于使在标准的三个或四个应用程序之间来回切换比通常在 Windows 中更简单的实用程序的任何建议？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-15T19:39:39.847

您可以将您的小型应用程序制作成 OLE 服务器并创建一个新应用程序，以一种主要形式托管它们。Delphi 很好地支持 OLE，因此它应该相当容易并且不需要太多的 API 摆弄。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T20:29:38.997

这个其他[SO question](https://stackoverflow.com/questions/459156/win32-is-it-possible-to-build-an-app-that-houses-other-apps)可以提供一些提示。基本上它声明您使用[SetParent](http://msdn.microsoft.com/en-us/library/ms633541(VS.85).aspx)。[您还可以使用FindWindow](http://msdn.microsoft.com/en-us/library/ms633499(VS.85).aspx)枚举现有窗口（例如 notepad.exe）并在它们上调用 SetParent 以在您自己的情况下重新设置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T20:04:26.030

关于嵌入您无法控制的程序：我怀疑您尝试做您所描述的事情会遇到很多麻烦，如果它甚至可能（我怀疑），它将依赖于大量的低级 API 调用和一般的讨厌。

如果你想对你的应用程序进行一些重构，你可以将你的四个程序变成插件，然后创建第五个“宿主”应用程序来加载它们中的任何一个或全部。

我建议您查看 JEDI 插件系统，可从[http://delphi-jedi.org](http://delphi-jedi.org)免费获得。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T07:55:25.320

当我将多个内部应用程序组合成一个应用程序时，我选择了“制作第五个应用程序”解决方案，并使用选项卡在它们之间进行选择。

```
frmShipRef := TfrmShipRef.Create(self);
frmShipRef.Parent := tabShipRef;
frmShipRef.BorderStyle := bsNone;
frmShipRef.Align := alClient;
frmShipRef.Show; 
```

我只是设置了一个带有选项卡的新表单，然后使用上面的代码创建了另一个表单。这运行良好，通过一点条件编译，我能够在左侧添加一个面板，该面板提供一种“元复制和粘贴”，允许他们在彼此之间传递数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T20:12:01.300

由于您的所有其他应用程序都是单一形式的，您可以将每个应用程序中的所有组件剪切/粘贴/保存到单独的“背景”面板上，另存为[Component Template](http://delphi.about.com/cs/howto/ht/htcomptempl.htm)。然后您可以将您的组件模板加载到它自己的 PageControl/Tab 上。

# iphone - 构建“按钮”的视觉网格

> ID：753297
> 
> 赞同：0
> 
> 时间：2009-04-15T19:22:01.293
> 
> 标签：iphone, objective-c, uiview, button

我正在尝试设计如何实现一个相对简单的应用程序。

我想创建一个覆盖整个屏幕的“正方形”网格。每个方块都应该有能力响应触摸事件，然后有一个开/关状态。例如，如果我触摸一个“关闭”方块，然后将手指拖过其他 10 个方块，我希望它们都打开。反之亦然。

我不确定仅仅创建一个包含 150 个按钮的网格的内存开销。据我所知，按钮也没有可设置的状态。我也在考虑继承 UIView 并实现 UIResponder 方法。感觉我应该创建一组按钮数组（或 UIView 的子类），但我不确定这是否可能。

我假设我可以通过从 UIResponder 方法获取 touchevent 的位置来判断我在哪个方格上。我是否需要通过子类化 UIView 创建我自己的 myButton 版本，并拥有一个开/关状态属性以及 UIResponder 方法，然后创建一个 myButtons 数组？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T19:30:10.057

UISwitch 是目前唯一这样做的东西，尽管有些人在使用 UISegmentedControl 方面也有很好的经验。

除此之外，您必须在代码中更改常规按钮或图像的样式/颜色，这是许多应用程序开发人员所做的，因此它的外观和反应完全按照他们想要的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T20:30:06.437

除非您需要更多 UIView 的事件处理内容，否则如果您使用单个视图并为其提供 -touchesBegan:withEvent、-touchesMoved 和 -touchesEnded 方法，您将获得最佳性能。然后使用自定义 drawRect 方法在开或关状态下绘制您的各个正方形。您也可以使用图层，但尝试布置 150 个视图是自找麻烦。

# jquery - 如何在 jQuery 的 load() 方法中捕获错误

> ID：753300
> 
> 赞同：56
> 
> 时间：2009-04-15T19:22:52.417
> 
> 标签：jquery, ajax, error-handling, load

`.load()`当用户单击按钮时，我正在使用 jQuery 的方法来检索一些数据。

加载成功完成后，我将结果显示在`<div>`.

`load()`问题是，有时在检索数据时会发生错误。

我怎样才能发现错误`load()`？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-04-15T19:35:20.623

[加载（）文档。](http://docs.jquery.com/Ajax/load)

只是关于如何发生加载错误的一点背景......

```
$("body").load("/someotherpath/feedsx.pxhp", {limit: 25}, 
    function (responseText, textStatus, req) {
        if (textStatus == "error") {
          return "oh noes!!!!";
        }
}); 
```

编辑：根据评论的要求添加了根路径以外的路径。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-15T19:34:28.380

除了按照 Ólafur Waage 的建议将回调传递给 load() 函数外，您还可以注册“全局”错误处理程序（全局与页面上所有 ajax 调用的全局一样）。

至少有两种注册全局 Ajax 错误处理程序的方法：

仅注册错误处理程序[`ajaxError()`](http://docs.jquery.com/Ajax/ajaxError#callback)：

```
$.ajaxError(function(event, request, settings) {
      alert("Oops!!");
}); 
```

或者，用于[`ajaxSetup()`](http://docs.jquery.com/Ajax/jQuery.ajaxSetup#options)同时设置错误处理程序和其他属性：

```
$.ajaxSetup({
    timeout: 5000,
    error: function(event, request, settings){
        alert("Oops!");
    }
}); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-15T19:27:08.910

load() 提供回调。

> 打回来。
> ajax 请求完成时调用的函数（不一定成功）。

这就是它完成 IIRC 的方式。（没有测试过）

```
$("#feeds").load("feeds.php", {limit: 25}, 
    function (responseText, textStatus, XMLHttpRequest) {
        // XMLHttpRequest.responseText has the error info you want.
        alert(XMLHttpRequest.responseText);
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T19:37:05.360

Electric toolbox 有一篇名为[“使用 jQuery AJAX 加载内容并处理故障”](http://www.electrictoolbox.com/load-content-jquery-ajax-dealing-with-failures/)的文章似乎可以回答您的问题。

显然，您指定的回调函数会传递响应、状态和 XmlHttpRequest 对象，从而允许您确定 ajax 请求的状态并相应地处理条件。

# c++ - 在函数中返回大对象

> ID：753312
> 
> 赞同：45
> 
> 时间：2009-04-15T19:25:48.727
> 
> 标签：c++

比较下面两段代码，第一段使用大对象的引用，第二段使用大对象作为返回值。对“大对象”的强调是指对象的重复副本不必要地浪费循环。

使用对大对象的引用：

```
void getObjData( LargeObj& a )
{
  a.reset() ;
  a.fillWithData() ;
}

int main()
{
  LargeObj a ;
  getObjData( a ) ;
} 
```

使用大对象作为返回值：

```
LargeObj getObjData()
{
  LargeObj a ;
  a.fillWithData() ;
  return a ;
}

int main()
{
  LargeObj a = getObjData() ;
} 
```

第一段代码不需要复制大对象。

在第二个片段中，对象是在函数内部创建的，因此通常在返回对象时需要一个副本。然而，在这种情况下，`main()`对象是被声明的。编译器会先创建一个默认构造的对象，然后复制返回的对象`getObjData()`，还是会像第一个片段一样高效？

我认为第二个片段更容易阅读，但恐怕效率较低。

**编辑：**通常，我认为案例`LargeObj`是通用容器类，为了论证，其中包含数千个对象。例如，

```
typedef std::vector<HugeObj> LargeObj ; 
```

所以直接修改/添加方法`LargeObj`不是一个直接可访问的解决方案。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-04-15T20:02:29.747

第二种方法更惯用，更具表现力。阅读代码时很明显，该函数对参数没有先决条件（它没有参数），并且它实际上会在内部创建一个对象。对于普通读者来说，第一种方法并不那么清楚。该调用意味着对象将被更改（通过引用传递），但尚不清楚传递的对象是否有任何先决条件。

关于副本。您发布的代码没有使用赋值运算符，而是使用复制构造。C++ 定义了在所有主要编译器中实现的[返回值优化。](http://en.wikipedia.org/wiki/Return_value_optimization)如果您不确定是否可以在编译器中运行以下代码段：

```
#include <iostream>
class X
{
public:
    X() { std::cout << "X::X()" << std::endl; }
    X( X const & ) { std::cout << "X::X( X const & )" << std::endl; }
    X& operator=( X const & ) { std::cout << "X::operator=(X const &)" << std::endl; }
};
X f() {
    X tmp;
    return tmp;
}
int main() {
    X x = f();
} 
```

使用 g++，您将得到一行*X::X()*。*编译器在堆栈中为x*对象保留空间，然后调用在 x 上构造tmp 的*函数**（*实际上*tmp***是***x*。*f()*中的操作直接应用于*x*，相当于您的第一个代码片段（通过引用传递）。

 *****如果您没有使用复制构造函数（您是否编写过：*X x; x = f();*），那么它将创建*x*和*tmp*并应用赋值运算符，产生三行输出：*X::X()* / *X::X()* / *X::operator=*。所以在某些情况下它的效率可能会低一些。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-15T19:39:29.817

使用第二种方法。这似乎效率较低，但 C++ 标准允许规避副本。这种优化称为[命名返回值优化](http://www.google.com/search?q=NRVO)，并在大多数当前编译器中实现。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T19:33:10.487

是的，在第二种情况下，它会复制对象，可能会复制两次——一次从函数返回值，再次将其分配给 main 中的本地副本。一些编译器会优化第二个副本，但通常您可以假设至少会发生一个副本。

但是，即使对象中的数据很大，您仍然可以使用第二种方法来清楚地说明，而不会牺牲性能并正确使用智能指针。查看 boost 中的智能指针类套件。这样内部数据只分配一次并且从不复制，即使外部对象是。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T19:40:51.857

避免**任何**复制的方法是提供一个特殊的构造函数。如果你可以重写你的代码，它看起来像：

```
LargeObj getObjData()
{
  return LargeObj( fillsomehow() );
} 
```

如果 fillsomehow() 返回数据（可能是一个“大字符串”，那么就有一个接受“大字符串”的构造函数。如果你有这样一个构造函数，那么编译器很可能会构造一个对象并且根本不制作任何副本执行返回当然，这在现实生活中是否有用取决于您的特定问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-15T21:27:28.497

一个有点惯用的解决方案是：

```
std::auto_ptr<LargeObj> getObjData()
{
  std::auto_ptr<LargeObj> a(new LargeObj);
  a->fillWithData();
  return a;
}

int main()
{
  std::auto_ptr<LargeObj> a(getObjData());
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-15T19:40:37.973

或者，您可以通过让对象获取自己的数据来避免这个问题，即通过`getObjData()`创建`LargeObj`. 根据您实际在做什么，这可能是一个不错的方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-15T19:44:32.880

根据对象的实际大小和操作发生的频率，当它没有明显的效果时，不要太拘泥于效率。只有在确定有必要时才应该以牺牲干净、可读的代码为代价进行优化。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-15T19:45:05.810

当您通过副本返回时，可能会浪费一些周期。是否值得担心取决于对象的实际大小以及调用此代码的频率。

但我想指出，如果`LargeObj`是一个大型且非平凡的类，那么无论如何它的空构造函数都应该将其初始化为已知状态：

```
LargeObj::LargeObj() :
 m_member1(),
 m_member2(),
 ...
{} 
```

这也浪费了几个周期。将代码重写为

```
LargeObj::LargeObj()
{
  // (The body of fillWithData should ideally be re-written into
  // the initializer list...)
  fillWithData() ;
}

int main()
{
  LargeObj a ;
} 
```

对您来说可能是双赢的：您可以将 LargeObj 实例初始化为已知且有用的状态，并且浪费的周期更少。

如果您不总是想`fillWithData()`在构造函数中使用，可以将标志作为参数传递给构造函数。

**更新**（来自您的编辑和评论）：语义上，如果值得为它创建一个 typedef `LargeObj`- 即，给它一个名称，而不是简单地引用它`typedef std::vector<HugeObj>`- 那么你已经在给它自己的道路上行为语义。例如，您可以将其定义为

```
class LargeObj : public std::vector<HugeObj> {
    // constructor that fills the object with data
    LargeObj() ; 
    // ... other standard methods ...
}; 
```

只有您可以确定这是否适合您的应用。我的观点是，即使`LargeObj`“主要”是一个容器，如果这样做适用于您的应用程序，您仍然可以为其赋予类行为。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-04-15T19:35:42.073

当您执行诸如在一个 DLL 中实现 getObjData()、从另一个 DLL 调用它，并且这两个 DLL 以不同语言或同一语言的不同编译器版本实现之类的操作时，您的第一个片段特别有用。原因是当它们在不同的编译器中编译时，它们通常使用不同的堆。您必须在同一个堆内分配和释放内存，否则会损坏内存。`</windows>`

但是，如果您不这样做，我通常会简单地将指针（或智能指针）返回到您的函数分配的内存：

```
LargeObj* getObjData()
{
  LargeObj* ret = new LargeObj;
  ret->fillWithData() ;
  return ret;
} 
```

...除非我有特定的理由不这样做。

# c# - Enumerable.Intersperse 的扩展方法？

> ID：753316
> 
> 赞同：11
> 
> 时间：2009-04-15T19:27:34.417
> 
> 标签：c#, ienumerable

我从 Haskell 中学习了[intersperse 函数](http://haskell.org/ghc/docs/latest/html/libraries/base/Data-List.html#v:intersperse)，并一直在寻找 c# 中的实现。

Intersperse 采用 2 个参数，一个 IEnumerable<T> 源和一个 T 元素。它返回一个 IEnumerable，其中元素插入源的每个元素之间。

一种可能的用例是将任意整数放在整数列表之间，例如：

```
// returns: {1, 0, 2, 0, 3}
(List<int>() {1, 2, 3}).Intersperse(0); 
```

这是 string.Join(...) 的一般情况。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-15T19:32:08.820

其他人错过的东西：如果你只希望它在项目之间，而不是在前面或后面，你需要做一个额外的检查：

```
public static IEnumerable<T> Intersperse<T>(this IEnumerable<T> source, T element)
{
    bool first = true;
    foreach (T value in source)
    {
        if (!first) yield return element;
        yield return value;
        first = false;
    }
} 
```

或者

```
public static IEnumerable<T> Intersperse<T>(this IEnumerable<T> source, T element)
{
    var e = source.GetEnumerator(); 
    bool b = e.MoveNext();
    if (b) yield return e.Current;

    while (e.MoveNext())
    {
        yield return element;
        yield return e.Current;
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-15T19:32:18.680

本着 Linq 解决方案的精神，我编写了一个懒惰的解决方案！我想出的其他解决方案涉及在返回数据之前遍历整个列表，然后返回结果列表。

其他一些答案对循环的每次迭代都有一个 if 检查。

```
public static IEnumerable<T> Intersperse<T>(this IEnumerable<T> source, T element)
{
    using (var enumerator = source.GetEnumerator()) {
        if (enumerator.MoveNext()) {
            yield return enumerator.Current;
            while (enumerator.MoveNext()) {
                yield return element;
                yield return enumerator.Current;
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T19:32:33.937

写起来很容易：

```
public static IEnumerable<T> Intersperse<T>(this IEnumerable<T> source, T value) {
    bool first = true;
    foreach(T item in source) {
         if(first) { first = false; }
         else { yield return value; }
         yield return item;
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-03-28T11:27:28.347

这是一个示例，可以更好地控制插入附加项目：

```
 public delegate T IntersperseFunc<T>(T prev, T next, int index);
public delegate T InterspersePrevNextFunc<T>(T prev, T next);
public delegate T IntersperseIndexFunc<out T>(int index);

public static IEnumerable<T> Intersperse<T>(this IEnumerable<T> source, IntersperseFunc<T> elementFunc)
{
    if (source == null) throw new ArgumentNullException(nameof(source));
    using (var enumerator = source.GetEnumerator())
    {
        if (enumerator.MoveNext())
        {
            var index = 0;
            var prev = enumerator.Current;
            yield return prev;
            while (enumerator.MoveNext())
            {
                var next = enumerator.Current;
                yield return elementFunc(prev, next, index++);
                yield return next;
                prev = next;
            }
        }
    }
}

public static IEnumerable<T> Intersperse<T>(this IEnumerable<T> source, InterspersePrevNextFunc<T> elementFunc)
    => Intersperse(source, (prev, next, index) => elementFunc(prev, next));

public static IEnumerable<T> Intersperse<T>(this IEnumerable<T> source, IntersperseIndexFunc<T> elementFunc)
    => Intersperse(source, (prev, next, index) => elementFunc(index));

public static IEnumerable<T> Intersperse<T>(this IEnumerable<T> source, Func<T> elementFunc)
    => Intersperse(source, (prev, next, index) => elementFunc());

public static IEnumerable<T> Intersperse<T>(this IEnumerable<T> source, T element)
    => Intersperse(source, (prev, next, index) => element); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-06-11T21:10:58.613

这里有一些其他的方法来做到这一点。它们都应该具有相当的性能，没有一个需要首先完整地遍历输入序列。它们都正确处理空输入和单项输入。

### 多选

我喜欢的方式是这样的：

```
public static IEnumerable<T> Intersperse <T> (this IEnumerable<T> source, T delimiter) =>
    source.SelectMany((item) => Enumerable.Empty<T>().Append(delimiter).Append(item)).Skip(1); 
```

或者，或者：

```
public static IEnumerable<T> Intersperse <T> (this IEnumerable<T> source, T delimiter) =>
    source.SelectMany((item) => new T[] { delimiter, item }).Skip(1); 
```

它们都是等效的：对于每个*item*，创建一个新序列*{ delimiter, item }*，并使用`SelectMany`将它们连接在一起。之后，跳过第一个分隔符——它只是一个额外的分隔符。与其他选项相比，我更喜欢这些选项的唯一原因是它们可以在紧要关头内联使用，而无需编写额外的函数。

以下是其他一些实现（注意我称它们为`Delimit`not `Intersperse`）：

### 总计的

`Aggregate`虽然我认为它很笨重，但它可以完成：

```
public static IEnumerable<T> Delimit2a <T> (this IEnumerable<T> source, T delimiter) =>
    source.Aggregate(Enumerable.Empty<T>(), (delimited, item) => delimited.Append(delimiter).Append(item)).Skip(1);

public static IEnumerable<T> Delimit2b <T> (this IEnumerable<T> source, T delimiter) =>
    source.Aggregate(null as IEnumerable<T>, (delimited, item) => (delimited?.Append(delimiter) ?? Enumerable.Empty<T>()).Append(item)) ?? Enumerable.Empty<T>(); 
```

2b 可能不值得考虑：它省略了`Skip(1)`但以大量额外的冗长和分支为代价。

### 收益回报

这些类似于其他`yield return`基于答案的答案，但处理第一个元素的方法不同（我认为更干净）：

```
public static IEnumerable<T> Delimit3a <T> (this IEnumerable<T> source, T delimiter) {
    foreach (T item in source.Take(1)) // protects agains empty source
        yield return item;
    foreach (T item in source.Skip(1)) {
        yield return delimiter;
        yield return item;
    }
}

public static IEnumerable<T> Delimit3b <T> (this IEnumerable<T> source, T delimiter) {
    static IEnumerable<U> Helper<U> (IEnumerable<U> source, U delimiter) {
        foreach (U item in source) {
            yield return delimiter;
            yield return item;
        }
    }
    return Helper(source, delimiter).Skip(1);
} 
```

* * *

### 测试代码/示例

[这里](https://dotnetfiddle.net/5SRm9a)有一个带有测试代码的可运行示例。测试部分：

```
public static void Main () {
    foreach (int count in new int[] { 11, 2, 1, 0 }) {
        p( Enumerable.Range(10, count).Delimit1a(-1) );
        p( Enumerable.Range(10, count).Delimit1b(-1) );
        p( Enumerable.Range(10, count).Delimit2a(-1) );
        p( Enumerable.Range(10, count).Delimit2b(-1) );
        p( Enumerable.Range(10, count).Delimit3a(-1) );
        p( Enumerable.Range(10, count).Delimit3b(-1) );
    }
}

static void p <T> (IEnumerable<T> e) =>
    Console.WriteLine($"[ {string.Join(", ", e)} ]"); 
```

输出以下内容：

```
[ 10, -1, 11, -1, 12, -1, 13, -1, 14, -1, 15, -1, 16, -1, 17, -1, 18, -1, 19, -1, 20 ]
[ 10, -1, 11, -1, 12, -1, 13, -1, 14, -1, 15, -1, 16, -1, 17, -1, 18, -1, 19, -1, 20 ]
[ 10, -1, 11, -1, 12, -1, 13, -1, 14, -1, 15, -1, 16, -1, 17, -1, 18, -1, 19, -1, 20 ]
[ 10, -1, 11, -1, 12, -1, 13, -1, 14, -1, 15, -1, 16, -1, 17, -1, 18, -1, 19, -1, 20 ]
[ 10, -1, 11, -1, 12, -1, 13, -1, 14, -1, 15, -1, 16, -1, 17, -1, 18, -1, 19, -1, 20 ]
[ 10, -1, 11, -1, 12, -1, 13, -1, 14, -1, 15, -1, 16, -1, 17, -1, 18, -1, 19, -1, 20 ]
[ 10, -1, 11 ]
[ 10, -1, 11 ]
[ 10, -1, 11 ]
[ 10, -1, 11 ]
[ 10, -1, 11 ]
[ 10, -1, 11 ]
[ 10 ]
[ 10 ]
[ 10 ]
[ 10 ]
[ 10 ]
[ 10 ]
[  ]
[  ]
[  ]
[  ]
[  ]
[  ] 
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-04-15T19:31:46.730

如果您想知道如何实现它，我会这样做：

```
public static IEnumerable<T> Intersperse<T>(this IEnumerable<T> collection, T value)
{
    foreach(T item in collection)
    {
        yield return item;
        yield return value;
    }

    yield break;
} 
```

# asp.net - 当 FormView 设置为插入模式时，控件在回发后不保留值

> ID：753318
> 
> 赞同：6
> 
> 时间：2009-04-15T19:28:15.040
> 
> 标签：asp.net, formview

我正在使用 Page_Load 事件中的 ChangeMode 方法将 FormView 的 CurrentMode 设置为插入模式，如下所示：

```
if(!Page.IsPostBack)
{
    MyFormView.ChangeMode(FormViewMode.Insert);
} 
```

在我的 FormView 的插入模板中，我有一个 DropDownList 控件，它的 AutoPostBack 属性设置为 true。我在插入模板中还有其他几个 DropDownList 和 TextBox 控件。

每当我更改 DropDownList 的选择并发生回发时，我都会丢失输入到控件中的所有值。奇怪的是，如果我在初始页面加载后的任何时间使用 ChangeMode 将 FormView 设置为插入模式，我就没有问题。我已经使用调试器逐步完成了代码，一切似乎都在正确地发生，但是在我的 DropDownList 事件处理程序运行后的某个时间，一切似乎都被重置了。

这里发生了什么？

更新：我注意到我的 FormView 位于带有 runat="server" 和 enableviewstate="false" 的 div 标签内。为容器 div 启用视图状态后，我开始看到稍微不同的行为。FormView 在第一次回发后仍然不保留值，但现在后续回发工作正常并且值被保留。

任何想法将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-04T14:09:54.163

Walter Wang [MSFT] 来自其他论坛的这个答案 - 2007 年 1 月 26 日 03:29 GMT

> 首先，问题似乎是数据源控件告诉 FormView 数据已更改，因此它应该重新绑定以获取新数据。这实际上不应该这样做，因为我们仍处于插入模式。我有一个解决方法供您参考：从 FormView 继承以创建您自己的 FormView 控件，如果我们处于插入模式，则覆盖 OnDataSourceViewChanged 并将 RequiresDataBinding 设置为 false：
> 
> ```
> public class MyFormView : FormView
>    {
>        protected override void OnDataSourceViewChanged(object sender,
> EventArgs e)
>        {
>            if (this.CurrentMode == FormViewMode.Insert)
>            {
>                this.RequiresDataBinding = false;
>            }
>            else
>            {
>                base.OnDataSourceViewChanged(sender, e);
>            }
>        }
>    } 
> ```

我已经对其进行了测试，它似乎工作正常。请试一试，让我知道结果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-02T20:23:21.917

FormView.ChangeMode(FormViewMode.Insert)

这必须有效，检查身份证并使用智能感知？

我的示例是添加项目表单视图..

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    AddNewItemFormView.ChangeMode(FormViewMode.Insert)
End Sub 
```

尝试在没有任何“if..then's”的情况下在页面加载时执行此操作，如果它有效，您会知道这不是表达式，而是 if 内容或构造。请记住使控件 ID 有意义，以便在您需要使用它们或通过智能感知调用它们时更容易并且不太可能出错。

好运。

:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T19:44:08.777

尝试

```
MyFormView.EnableViewState = true; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T15:35:03.897

ViewState 在 PageLoad 之前加载，我的猜测是通过更改 PageLoad 上的模式重新创建另一组控件，即 EditItemTemplate 中的控件。如果它默认设置为编辑模式，并且您在 PageLoad 上取消注释该行，它会保持这些值吗？如果您不切换模式，它应该。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-05T03:09:07.197

我在`EditItem`模板中没有保留类似的视图状态问题。设置`EnableViewState = true`也无济于事。

我所做的是得到`OnUpdated()`函数，在函数的最后，

```
e.KeepInEditMode = true; 
```

希望这可以帮助..

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-15T20:22:38.730

尝试更改 Page Init 或 Prerender 事件的模式

# c# - 如何使用 LINQ 将字典的键和值组合到一个列表中？

> ID：753321
> 
> 赞同：6
> 
> 时间：2009-04-15T19:28:55.147
> 
> 标签：c#, linq

我有一个字典，其中键是一个字符串，值是对应于该键的字符串列表。我想显示字典中的所有键，并在该键下方显示与该键关联的值。像这样的东西：

```
Key 1
    Value 1
    Value 2
    Value 3
Key 2
    Value 1
    Value 2 
```

在 C# 2.0 中，我会这样做（`values`是`Dictionary`）：

```
StringBuilder sb = new StringBuilder();
foreach(KeyValuePair<string, List<string>> pair in values)
{
    sb.AppendLine(pair.Key);
    foreach(string item in pair.Value)
    {
        sb.AppendLine('\t' + item);
    }
} 
```

我将如何使用 LINQ 进行等效操作？似乎应该是可能的，但是我不知道该怎么做。

如果我使用`values.SelectMany(p => p.Values)`，那么最终结果中只有值，而不是键。

我想到的任何其他解决方案都有类似的限制。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-15T20:43:08.010

## C# 中的解决方案

这是使用[聚合扩展方法](http://msdn.microsoft.com/en-us/library/bb549218.aspx)的解决方案：

```
string result = values.Aggregate("",
                  (keyString, pair) =>
                    keyString + "\n" + pair.Key + ":"
                      + pair.Value.Aggregate("",
                          (str, val) => str + "\n\t" + val)
                  ); 
```

C# 中的聚合子句没有 LINQ 语法（但显然[Visual Basic](http://msdn.microsoft.com/en-us/library/bb531251.aspx)中有一些预定义函数）。

此解决方案可能看起来有些复杂，但聚合方法非常有用。

## 聚合的工作原理

它的工作原理是这样的：如果你有一个`List<int>`，你可以将所有值组合成一个*聚合值*。

`Select`这与不修改列表长度的方法形成对比。或者`Where`方法，它确实缩小了列表，但它仍然是一个列表（而不是单个值）。

例如，如果您有一个列表`{1, 2, 3, 4}`，您可以将它们组合成一个值，如下所示：

```
int[] xs = {1, 2, 3, 4};
int sum = xs.Aggregate(0, (sumSoFar, x) => sumSoFar + x); 
```

所以你给这个`Aggregate`方法两个值；种子值和“组合器”功能：

*   您从单个种子值开始聚合（`0`在本例中）。
*   您的组合器函数会为列表中的每个值调用。
    第一个参数是到目前为止的计算结果（第一次为零，以后会有其他值），并将它与 value 结合起来`x`。

简而言之，该`Aggregate`方法是如何工作的`List<int>`。它在 上的工作方式相同`KeyValuePair<string, List<string>>`，但类型不同。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T19:39:00.630

我不确定你会如何在 LINQ 中做到这一点，但使用 lambdas 你可以执行以下操作：

```
string foo = string.Join(Environment.NewLine, 
    values.Select(k => k.Key + Environment.NewLine + 
        string.Join(Environment.NewLine, 
            k.Value.Select(v => "\t" + v).ToArray())).ToArray()); 
```

不过，这不是很可读。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T19:43:00.120

LINQ 中没有任何东西可以帮助您，因为您对值有一组单独的要求，而不是对键（您在值之间进行制表符）。

即使不是这种情况，LINQ 最多只能帮助您获得一个循环遍历的枚举源，无论如何您都必须有某种分区逻辑来指示您何时处理集合值与键。

归结为，您已经拥有的 Dictionary 为您提供了一个自然分组，除非您处理分组以外的操作（排序、投影、过滤），否则 LINQ 将无法再提供帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T19:55:50.417

如果你有这样的方法：

```
public IEnumerable<string> GetStrings
  (KeyValuePair<string, List<string>> kvp)
{
  List<string> result = new List<string>();
  result.Add(kvp.Key);
  result.AddRange(kvp.Value.Select(s => "\t" + s));
  return result;
} 
```

然后你可以这样做：

```
List<string> result = theDictionary
  .SelectMany(kvp => GetStrings(kvp)).ToList(); 
```

或者一般来说：

```
public static IEnumerable<T> GetFlattened<T, U>
  ( this KeyValuePair<T, List<U>> kvp,
    Func<U, T> ValueTransform
  )
{
  List<T> result = new List<T>();
  result.Add(kvp.Key);
  result.AddRange(kvp.Value.Select(v => ValueTransform(v)));
  return result;
}

List<string> result = theDictionary
  .SelectMany(kvp => kvp.GetFlattened(v => "\t" + v))
  .ToList(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T21:04:17.867

我会对值进行选择以逐项将事物放入初始列表中（使用 string.Join 作为值），然后将其弹出到字符串中（再次使用 string.Join）。

```
IEnumerable<string> items = values.Select(v => 
    string.Format("{0}{1}{2}", v.Key, Environment.NewLine + "\t", 
    string.Join(Environment.NewLine + "\t", v.Value.ToArray()));
string itemList = string.Join(Environment.NewLine, items.ToArray()); 
```

# c# - 为什么派生类应该在不附加委托的情况下处理事件？

> ID：753325
> 
> 赞同：0
> 
> 时间：2009-04-15T19:31:09.603
> 
> 标签：c#, asp.net, events

Q1：

“ListControl.OnSelectedIndexChanged 方法还允许派生类在不附加委托的情况下处理事件。这是在派生类中处理事件的首选技术。”</p>

A）如果我理解上面的引用，那么如果我们从 ListControl 派生一个类，我们应该不订阅 SelectedIndexChanged 事件，而是将 OnSelectedIndexChanged() 方法视为事件处理程序，从而将任何事件处理逻辑放入其中：

```
protected override void OnSelectedIndexChanged(
EventArgs e
{
   //event handling logic
} 
```

为什么这比通过 OnSelectedIndexChanged = ”name_of_event_handler” 订阅事件（在 .aspx 内）更好？

B）无论如何，在 ascx 文件中，我们使用 OnSelectedIndexChanged 属性将事件处理程序附加到事件。此属性的名称与 OnSelectedIndexChanged() 方法的名称相同。这是为什么？为什么不是这个属性的名称 SelectedIndexChanged：

```
 <asp:ListControl SelectedIndexChanged = ”name_of_event_handler” 
```

毕竟，属性是指一个事件，而不是调用该事件的方法（ OnSelectedIndexChanged() ）！

谢谢

编辑：

你好，

> 但是，请确保您调用 base.On[EventName] 否则事件不会触发！

假设您不希望其他人能够响应此事件，那么不调用 base.On[EventName] 是否完全可以，因为我认为不调用它除了不触发之外不会造成任何伤害一个事件（因此不会调用事件处理程序）？

我意识到需要触发一些事件才能让框架完成它的工作，但是不调用 base.On[SelectedIndexChanged] 怎么办？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T19:42:50.510

它“更好”在于：

*   在可能的情况下使用`virtual`（继承）更便宜 - 它消除了对一些额外对象（委托实例等）的需要
*   它允许覆盖代码知道它在序列中的位置 - 即如果多个调用者正在监听，它会先触发吗？第二？在中间？

第一点可以说对效率更重要，尤其是在具有稀疏事件处理程序的控件（即，类似`EventHandlerList`而不是类似字段的事件）之类的事物中。

我不太明白第二个问题，但猜测一下：约定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T19:42:49.233

一般来说，我更喜欢重写 On[EventName] 函数，以便我可以控制我的逻辑是在任何订阅者的逻辑之前还是之后发生。

但是，请确保您调用 base.On[EventName] 否则事件不会触发！

# c# - 从 WSE 3.0 客户端请求中删除 WS-Addressing/WS-Security 部分

> ID：753327
> 
> 赞同：5
> 
> 时间：2009-04-15T19:31:45.670
> 
> 标签：c#, web-services, wse3.0

我有一个使用 WSDL.exe 创建的简单 C# Web 服务代理类。我正在远程 Web 服务上调用一个方法，它包含一堆我不想要的 WS-Addressing 和 WS-Security 标头（并且服务器正在阻塞）。以下是 raw soap 请求的示例：

```
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope 
  xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
  xmlns:wsa="http://schemas.xmlsoap.org/ws/2004/08/addressing" 
  xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" 
  xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
  <soap:Header>
    <wsa:Action></wsa:Action>
    <wsa:MessageID>urn:uuid:22f12267-b162-4703-a451-2d1c5c5a619b</wsa:MessageID>
    <wsa:To>http://example.com/wstest</wsa:To>
    <wsse:Security>
      <wsu:Timestamp wsu:Id="Timestamp-5c9f0ef0-ab45-421d-a633-4c4fad26d945">
        <wsu:Created>2009-04-15T16:27:25Z</wsu:Created>
        <wsu:Expires>2009-04-15T16:32:25Z</wsu:Expires>
      </wsu:Timestamp>
    </wsse:Security>
  </soap:Header>
  <soap:Body>
    <Func1 xmlns="http://example.com">
      <arg_1 xmlns="">blah</arg_1>
      <arg_2 xmlns="">blah2</arg_2></arg_2>
    </Func1>
  </soap:Body>
</soap:Envelope> 
```

但**我不关心 WS-Addressing/WS-Security 的东西**。我没有做任何事情来包括它。.NET WSE 3.0 包似乎默认添加它们。有没有办法摆脱这些？我在代理对象上看不到允许我删除这些部分的属性。我试过了：

```
proxyObject.Addressing.Clear();
proxyObject.Security.Clear(); 
```

当我调用我的 Web 服务方法时，这些会导致空引用异常。

我希望 SOAP 请求看起来像这样：

```
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope 
  xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <soap:Header>
  </soap:Header>
  <soap:Body>
    <Func1 xmlns="http://example.com">
      <arg_1 xmlns="">blah</arg_1>
      <arg_2 xmlns="">blah2</arg_2></arg_2>
    </Func1>
  </soap:Body>
</soap:Envelope> 
```

提前致谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T21:43:57.100

好吧，我最终使用了我过去使用过的技术。我创建了实现**SoapFilter**和**PolicyAssertion**的类，它们允许我在发送 SOAP 请求之前修改它的原始 XML。下面是一个例子：

```
 public class MyPolicy : SoapFilter
    {
        public override SoapFilterResult ProcessMessage(SoapEnvelope envelope)
        {
            // Remove all WS-Addressing and WS-Security header info
            envelope.Header.RemoveAll();

            return SoapFilterResult.Continue;
        }
    }

    public class MyAssertion : PolicyAssertion
    {
        public override SoapFilter CreateClientInputFilter(FilterCreationContext context)
        {
            return null;
        }

        public override SoapFilter CreateClientOutputFilter(FilterCreationContext context)
        {
            return new MyPolicy();
        }

        public override SoapFilter CreateServiceInputFilter(FilterCreationContext context)
        {
            return null;
        }

        public override SoapFilter CreateServiceOutputFilter(FilterCreationContext context)
        {
            return null;
        }
    } 
```

然后在您的 Web 服务代理的构造器中应用该策略：

```
/// <remarks/>
    [System.CodeDom.Compiler.GeneratedCodeAttribute("System.Web.Services", "2.0.50727.1433")]
    [System.Diagnostics.DebuggerStepThroughAttribute()]
    [System.ComponentModel.DesignerCategoryAttribute("code")]       
 [System.Web.Services.WebServiceBindingAttribute(Name="MyBinding", Namespace="http://example.com")]
    public partial class MyWebClient : WebServicesClientProtocol {

        // ... member variables here

        /// <remarks/>
        public MyWebClient()
        {
            this.Url = "http://example.com";           
            if ((this.IsLocalFileSystemWebService(this.Url) == true)) {
                this.UseDefaultCredentials = true;
                this.useDefaultCredentialsSetExplicitly = false;
            }
            else {
                this.useDefaultCredentialsSetExplicitly = true;
            }

            // Apply policy here
            Policy policy = new Policy();
            policy.Assertions.Add(new MyAssertion());
            this.SetPolicy(policy); 
        }
  } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-06T15:52:12.783

要删除寻址标头，我在我的一个应用程序中使用了以下代码。

```
 public override void SecureMessage(SoapEnvelope envelope, Security security)
    {
       //remove addressing Header from envelope

        AddressingHeaders objAH = new AddressingHeaders(envelope);

        objAH.RemoveXml(envelope);

        //Add Wahtever security token you want to add.

        security.Tokens.Add(bla-bla-bla);

    } 
```

我使用**SecureMessage**函数是因为我想添加安全令牌，但可以在**ProcessMessage**函数中使用相同的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-27T10:14:02.510

我想知道您的问题是否也无法通过不使用 WSE 来解决？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-28T09:19:11.293

根据此页面中的答案，我添加了以下代码以从 XML 中递归删除特定标头（按标记名）。

```
Public Overrides Function ProcessMessage(ByVal envelope As SoapEnvelope) As SoapFilterResult
    ' Remove all WS-Addressing and WS-Security header info
    RemoveTag(envelope.DocumentElement, "wsa:Action")
    RemoveTag(envelope.DocumentElement, "wsa:MessageID")
    RemoveTag(envelope.DocumentElement, "wsa:To")
    Return SoapFilterResult.[Continue]
End Function

Private Sub RemoveTag(ByVal XE As System.Xml.XmlElement, ByVal TagName As String)
    For Each N As XmlNode In XE
        If N.ChildNodes.Count > 0 Then
            RemoveTag(N, TagName)
        End If
        If N.Name = TagName Then
            XE.RemoveChild(N)
        End If
    Next
End Sub 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-09-15T17:08:09.900

我发现删除这些寻址和安全标头的最简单方法是将 Web 服务配置更改为使用`BasicHttpBinding`而不是`WSHttp binding`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-09-20T07:58:24.080

楼上的答案是对的！（自定义策略和断言解决方案）。但您也可以选择通过修改 web.config 文件中的客户端绑定标头来解决此问题。

前任：

```
<system.serviceModel>
    <bindings>
      <basicHttpBinding>
        <binding name="AGSServiceSOAP"/>
      </basicHttpBinding>
    </bindings>
    <client>
      <endpoint address="http://tosweb101u.mersinport.com.tr:19050/GTOSServiceBus/CTCS/service"
        binding="basicHttpBinding" bindingConfiguration="AGSServiceSOAP"
        contract="CTCSService.AGSService" name="AGSServiceSOAP">
        <headers>
          <wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
            <wsse:UsernameToken>
              <wsse:Username>USERNAME</wsse:Username>
              <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">PASSWORD</wsse:Password>
            </wsse:UsernameToken>
          </wsse:Security>
        </headers>
      </endpoint>
    </client>
</system.serviceModel> 
```

# mysql - mysql存储过程语法错误

> ID：753331
> 
> 赞同：0
> 
> 时间：2009-04-15T19:32:14.017
> 
> 标签：mysql, stored-procedures

好的，这只是我编写的第二个存储过程。我想你会明白的，我正在尝试关闭信用额度，以及所有发票、费用、票据等。但我得到一个语法错误。目标是调用 close_account_proc(398985994)

```
DELIMITER $$

CREATE
    PROCEDURE `cc`.`close_account_proc`(cid INT)
    @uid_usr := uid_usr FROM credit_acc WHERE type_acc = 'init' AND credit_used_acc = cid;
    UPDATE credit_acc SET status_acc = 'closed', void_date_acc = NOW() WHERE credit_used_acc = cid;
    UPDATE payment_acc SET status_acc = 'voided', void_date_acc = NOW()  WHERE creditid_acc = cid;
    UPDATE sbal_sbl SET status_sbl = 'voided', void_date_sbl = NOW()  WHERE credit_used_acc = cid;
    INSERT INTO notes_not SET uid_usr = @uid_usr, initials_not = 'SYS',status_not = 'complete', date_not = NOW(), text_not = 'Closed credit line '.cid;
    UPDATE invoices_inv SET status_inv = 'voided', void_date_inv = NOW()  WHERE credit_used_acc = cid;
    BEGIN
    END$$

DELIMITER ; 
```

所以，无论如何，我得到了这个错误：你的 SQL 语法有错误；检查与您的 MySQL 服务器版本相对应的手册，以在第 5 行的 '@uid_usr := uid_usr from credit_acc where type_acc = 'init' and credit_used_acc '附近使用正确的语法。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T19:34:45.493

```
DELIMITER $$

CREATE PROCEDURE `cc`.`close_account_proc`(cid INT)
BEGIN
    /* Check that it's what you wanted */
    SELECT  uid_usr
    INTO    @uid_usr
    FROM    credit_acc
    WHERE   type_acc = 'init'
            AND credit_used_acc = cid;

    UPDATE credit_acc SET status_acc = 'closed', void_date_acc = NOW() WHERE credit_used_acc = cid;
    UPDATE payment_acc SET status_acc = 'voided', void_date_acc = NOW()  WHERE creditid_acc = cid;
    UPDATE sbal_sbl SET status_sbl = 'voided', void_date_sbl = NOW()  WHERE credit_used_acc = cid;

    /* Check that it's what you wanted */

    INSERT
    INTO    notes_not (uid_usr, initials_not, status_not, date_not, text_not)
    VALUES  (@uid_usr, 'SYS', 'complete', NOW(), CONCAT('Closed credit line ', cid));

    UPDATE invoices_inv SET status_inv = 'voided', void_date_inv = NOW()  WHERE credit_used_acc = cid;
END
$$

DELIMITER ; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T19:35:41.653

嗯，我不是存储过程方面的专家，但不是吗。

```
CREATE PROCEDURE `cc`.`close_account_proc`(cid INT)
    BEGIN
        // your stuff
    END$$ 
```

# vb.net - 是否可以在 VB.NET 中设置 PictureBox 的图像对齐方式？

> ID：753337
> 
> 赞同：3
> 
> 时间：2009-04-15T19:33:16.853
> 
> 标签：vb.net, picturebox

我有一个`PictureBox`停靠在表单左上角的。它包含在 a`SplitContainer`中，并且`PictureBox`设置为填充它所在的面板的一侧：

```
 SplitContainer:
 ___________________
|  _________        >   
| |         |       >
| | LogoBox |       >
| |_________|       >
|___________________> 
```

我将`SizeMode`设置设置为缩放，以便调整图像大小以适应`PictureBox`. 默认情况下，图像以 this 为中心`SizeMode`。我想知道是否可以强制图像左对齐而不是居中。

提前致谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T14:07:35.293

It seems to me that Zoom is always going to align the left and right sides with its container. I would suggest trying one of these workarounds:

1.  Create another panel within the left panel of your existing SplitContainer. The new one would be transparent an essentially used as a spacer. As long as this is at the lowest z-level (sent to back) this should not interfere with your other controls.

2.  Add a percentage of transparent pixels to the right of your image in your image editor relative to how much spacing you need after the zoom is done. In this case you would need to make sure you have the correct image format.

# javascript - 如何在纯JS中的一行之后插入一组表行

> ID：753344
> 
> 赞同：1
> 
> 时间：2009-04-15T19:34:06.803
> 
> 标签：javascript, dom, html-table

我有以下问题：我需要在 X 行之后插入 N 行。我需要插入的行集作为由 TR 元素组成的 HTML 块传递给我的函数。我还可以访问我需要插入的 TR。

这与我之前用另一个 TBODY 替换 TBODY 所做的略有不同。

我遇到的问题是`appendChild`需要一个元素，但我必须插入一个集合。

**编辑：**

这是**解决方案**：

```
function appendRows(node, html){ 
    var temp = document.createElement("div");
    var tbody = node.parentNode;
    var nextSib = node.nextSibling;

    temp.innerHTML = "<table><tbody>"+html;
    var rows = temp.firstChild.firstChild.childNodes;

    while(rows.length){
        tbody.insertBefore(rows[i], nextSib);
    }
} 
```

* * *

看看这个：

[http://programmingdrunk.com/test.htm](http://programmingdrunk.com/test.htm)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T19:42:44.943

altCognito 说的是，如果您想使用 innerHTML 一次替换所有内容，请注意[大的 innerHTML tbody 错误](http://www.ericvasilik.com/2006/07/code-karma.html)，因为您正在做很多这样的事情并且 DOM 操作变得太慢了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T19:43:25.207

IE 使用 innerHTML 插入行时出错，因此无法正常工作。直接从马嘴里：[http ://www.ericvasilik.com/2006/07/code-karma.html](http://www.ericvasilik.com/2006/07/code-karma.html)

我建议只更新 tbody，但将代码附加到新结构中它所属的位置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T19:53:20.300

使用您的表格对象，您可以在其中插入一个新行。

```
var tbl = document.getElementById(tableBodyId); 
var lastRow = tbl.rows.length; 
// if there's no header row in the table, then iteration = lastRow + 1 
var iteration = lastRow; 
var row = tbl.insertRow(lastRow); 
```

它将在表格的末尾插入一行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T20:57:10.020

```
if(node.nextSibling && node.nextSibling.nodeName.toLowerCase() === "tr") 
```

这是用来干嘛的？我不认为你需要它。如果 node.nextSibling 为空，那没关系。您可以将其传递给 insertBefore，它的作用与 appendChild 相同。

无论如何，在 tbody 中除了 'tr' 之外没有其他元素被允许。

```
for(var i = 0; i < rows.length; i++){
    tbody.insertBefore(rows[i], node.nextSibling); 
```

这不适用于多行。一旦你完成了一次 insertBefore，node.nextSibling 现在将指向你刚刚插入的行；您最终会以相反的顺序插入所有行。您需要记住原始的 nextSibling。

ETA：另外，如果 'rows' 是一个活动的 DOM NodeList，每次你将其中一行插入新的主体时，它都会从旧的主体中删除它！因此，您在迭代列表时正在破坏列表。这是“每隔一个”错误的常见原因：您处理列表的第 0 项，然后将其从列表中删除，将第 1 项向下移动到第 0 项所在的位置。接下来您访问新的项目 1，即原始项目 2，而原始项目 1 永远不会被看到。

要么在普通的非实时“数组”中复制列表，或者，如果您知道它将是一个实时列表，您实际上可以使用更简单的循环形式：

```
var parent= node.parentNode;
var next= node.nextSibling;
while (rows.length!=0)
    parent.insertBefore(rows[0], next); 
```

> 我必须插入一组。

通常，当您考虑一次插入一组元素时，您希望使用 DocumentFragment。但是，不幸的是，您不能在 DocumentFragment 上设置“innerHTML”，因此您必须像上面那样在表格上设置行，然后将它们一一移动到 DocumentFragment 中，然后在 documentFragment 之前插入。虽然这在理论上可能比附加到最终目标表中更快（由于更少的 childNodes 列表抨击），但在实践中，通过我的测试，它实际上并没有明显更快。

另一种方法是 insertAdjacentHTML，这是一种仅限 IE 的扩展方法。不幸的是，您无法在 tbody 的子项上调用 insertAdjacentHTML，就像由于 IE 错误而无法设置 tbody.innerHTML 一样。您*可以*在 DocumentFragment 中设置它：

```
var frag= document.createDocumentFragment();
var div= document.createElement(div);
frag.appendChild(div);
div.insertAdjacentHTML('afterEnd', html);
frag.removeChild(div);
node.parentNode.insertBefore(frag, node.nextSibling); 
```

不幸的是，由于某种神秘的原因，insertAdjacentHTML 在这种情况下工作得非常缓慢。上面的方法对我来说大约是一对一 insertBefore 的一半速度。:-(

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-06-25T21:20:10.940

当在最后一个位置以外的任何地方插入一行时，这对我来说效果更好，

`var rowNode = refTable.insertRow(0); var cellNode = rowNode.insertCell();`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-15T19:37:11.680

您需要一一附加它们。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-15T19:42:08.517

您需要确定第 X 行是否是最后一行...

```
//determine if lastRow...
//if not, determine row_after_row_x
for(i in n_rows){
  if(lastRow){
    tbodyObj.appendChild(row_i_of_n);
  } else {
    tbodyObj.insertBefore(row_i_of_n, row_after_row_x);
  }
} 
```

# perl - 如何为 Perl 的 localtime() 设置时区？

> ID：753346
> 
> 赞同：18
> 
> 时间：2009-04-15T19:34:31.187
> 
> 标签：perl

在 Perl 中，我想在特定时区查找本地时间。我一直在使用这种技术：

```
$ENV{TZ} = 'America/Los_Angeles';
my $now = scalar localtime;
print "It is now $now\n";
# WORKS: prints the current time in LA 
```

但是，这并不可靠——值得注意的是，如果我在设置 $ENV{TZ} 之前添加另一个 localtime() 调用，它会中断：

```
localtime();
$ENV{TZ} = 'America/Los_Angeles';
my $now = scalar localtime;
print "It is now $now\n";
# FAILS: prints the current time for here instead of LA 
```

有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-15T19:52:35.107

使用[POSIX::tzset](http://perldoc.perl.org/POSIX.html#tzset)。

```
use POSIX qw(tzset);

my $was = localtime;
print "It was      $was\n";

$ENV{TZ} = 'America/Los_Angeles';

$was = localtime;
print "It is still $was\n";

tzset;

my $now = localtime;
print "It is now   $now\n"; 
```

```
$ perl -v

这是为 x86_64-linux-thread-multi 构建的 perl v5.8.8

版权所有 1987-2006，拉里·沃尔

Perl 只能根据艺术许可或
GNU 通用公共许可证，可在 Perl 5 源工具包中找到。

Perl 的完整文档，包括常见问题列表，应该在
本系统使用“man perl”或“perldoc perl”。如果您有权访问
Internet，将您的浏览器指向 http://www.perl.org/，即 Perl 主页。

$ perl tzset-test.pl
2009 年 4 月 15 日星期三 15:58:10
仍然是 2009 年 4 月 15 日星期三 15:58:10
现在是 2009 年 4 月 15 日星期三 12:58:10

```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-15T19:56:08.263

我强烈建议使用模块来执行此操作。具体来说，我建议使用 DateTime（请参阅[Perl DateTime Wiki](http://datetime.perl.org/ "Perl 日期时间维基")或[CPAN](http://search.cpan.org/dist/DateTime/ "CPAN")

然后，您应该能够执行以下操作：

```
use strict;
use warnings;
use DateTime;
my $dt = DateTime->now(); # *your* local time assuming your system knows it!

my $clone1 = $dt->clone; # taking a copy.
$clone1->set_time_zone('America/Los_Angeles');

print "$clone1\n";   # output using ISO 8601 format (there a lot of choices)
print "$dt\n"; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-15T19:54:39.000

虽然您的代码在 Linux (Perl 5.10.0) 和 MacOS X (5.8.9) 上都适用于我，但有一个可能的解决方案。

Perl ( , 等) 使用的底层 C 函数`ctime()`在`localtime()`第`tzset()`一次调用时调用，但*不一定*在之后调用。通过自己调用它，您应该确保在对`$TZ`.

幸运的是，这很容易 - 该`tzset()`功能在`POSIX`模块中可用：

```
#!/usr/bin/perl -w
use POSIX qw[tzset];

$ENV{'TZ'} = 'Europe/London';
tzset();
print scalar localtime(); 
```

注意：一些 Google 搜索表明，只有 Perl 版本（包括 5.8.8）才需要这样做。以后的版本总是`tzset()`在每次调用之前自动调用`localtime()`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T19:53:17.523

```
use Time::Zone;

my $TZ = 'America/Los_Angeles';
my $now = scalar localtime time() + tz_offset($TZ);
print "It is now $now\n"; 
```

似乎在这里工作。（“标量”在这里是多余的，因为 $now 给了它标量上下文，但明确表示也很好。）

根据评论，我得到了原来的问题。这似乎为我解决了这个问题，但鉴于其他人没有遇到最初的问题，“似乎在这里工作”位旨在邀请这些人也尝试这个解决方案，以确保它不会破坏任何东西. （我想知道 alnitak 是否注意到我发布的内容与原始帖子之间的差异？）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-02-19T07:56:42.347

扩展 BrianP007 答案，您同时使用 TZ 和 _tzset

```
$was = localtime;
print "It was $was\n";
$ENV{TZ} = 'CST6CDT'; # America/Chicago
Time::Piece::_tzset(); # Local time is now Chicago Time
$was = localtime;
print "It is $was\n"; # Right now in Chicago 
```

诀窍是 TZ 从您的位置设置为 GMT。所以通常你会认为芝加哥是 UTC-6，但从芝加哥到 UTC 需要 6 小时，其中 = 'CST6'。

见[http://science.ksc.nasa.gov/software/winvn/userguide/3_1_4.htm](http://science.ksc.nasa.gov/software/winvn/userguide/3_1_4.htm)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2015-04-14T23:04:16.043

执行摘要：

设置 $ENV{TZ}='/*&+000000000005' 并调用 Time::Piece::_tzset() 修复 localtime() 以与windoz系统时钟一致。

血腥的细节：

在 Strawberry Perl，windoz 7/64 上，没有一个“标准”时区在 TZ 环境变量中工作以本地化 localtime()。'America/Chicago' 给出的时间与 'America/Los_Angeles' == 'CDT' == 'CST' == 'UTC' == '-01:00' 等完全相同。这个列表是无限的。

如果您在格林威治，我尝试过的[http://www.timeanddate.com/time/zones/](http://www.timeanddate.com/time/zones/)上的每个时区都会给出正确的时间。

每次来自：[http](http://en.wikipedia.org/wiki/List_of_tz_database_time_zones) ://en.wikipedia.org/wiki/List_of_tz_database_time_zones 也根本无法更改 localtime()。而且，没有明显的迹象。他们什么也不做，什么也不说。

windows 上没有 tzset()：POSIX::tzset 未在此架构上实现

甚至没有任何POSIX的概念？？？C:\bin>cpan install POSIX ... 警告：无法安装 POSIX，不知道它是什么。尝试命令 i /POSIX/

它似乎已融入 win8，并且有一些 dot NOT 库。

对于德克萨斯州奥斯汀，在中央星际时间的正中心，你正确的 $ENV{TZ} 给了我一个标量 localtime() ，它与 o/s 级别时间函数和windoz时钟一致：'/*& +5' !!! 是的 Slash-Star-Ampersand-Plus-5 有效！

P:\br1\sxsw.2015\sx-2015.0318\done>time 当前时间为：16:36:39.44 ... Time=Apr 14 16:36:42 2015, ENV->TZ=/*&+5

通过运行 for 循环并尝试来自各种帖子的随机值，对于带有已知时区错误的 Strawberry Perl uname='Win32 strawberry-perl 5.18.2.2...'，我尝试的任何 3 个字符（没有尝试 + 或 -）随后由 +/- 和一小部分工作。下面是一组文本值及其输出：

```
use Time::Piece;
@tz = ('', 'CDT+5', 'CST+5', 'FKU+5', 'XYZ+5', '+5', '+05', '+05.00', 
    'America/Chicago', 'America/Los_Angeles', 'CDT', 
    'CST', 'UTC', 'PDT', 'PST', '-01:00', '+01:00', '-05:00'.
    'ACDT', 'EASST', '5000', '+0500', '+5:00', '+05:00', 'SSS+1', 'SSS+0',
    'zzz-1', 'ZZ1+5', '123+5', '___+5', '/*&+5', , '/*&+05', '/*&+005',
    '/*&+000000000005');
foreach $tz (@tz)  {
    $ENV{TZ} = $tz         if $tz;
    Time::Piece::_tzset()  if $tz;
    printf("T%s, ENV->TZ=%s\n", scalar localtime, $ENV{TZ}  ||  'NoTZ');
} 
```

除了 XXX 之外，大多数人都尝试过。+|- 。integer 给出了 UTC，但许多人无缘无故地休息了一个小时（America/Los_Angeles 和 America/Chicago 给出了相同的值）。我几乎可以肯定我过去只使用 CDT 和 CST，可能在 Activestate 上（切换到 Strawberry 来编译我自己的 Perl 模块，而不是依赖 Activestate 来完成所有事情）。这是第一个主要的咆哮。

我从头开始重建 DateTime，它运行良好。DateTime::TimeZone::Local::Win32 “'Win32::TieRegistry' 失败”

这是上面尝试的区域的排序结果：

```
 P:\br1\sxsw.2015\sx-2015.0318\done>bb | sort
    Running c:/bin/bb.pl  Tue Apr 14 21:43:56 2015
    TTue Apr 14 16:43:56 2015, ENV->TZ=/*&+000000000005
    TTue Apr 14 16:43:56 2015, ENV->TZ=/*&+005
    TTue Apr 14 16:43:56 2015, ENV->TZ=/*&+05
    TTue Apr 14 16:43:56 2015, ENV->TZ=/*&+5
    TTue Apr 14 16:43:56 2015, ENV->TZ=___+5
    TTue Apr 14 16:43:56 2015, ENV->TZ=123+5
    TTue Apr 14 16:43:56 2015, ENV->TZ=CDT+5
    TTue Apr 14 16:43:56 2015, ENV->TZ=CST+5
    TTue Apr 14 16:43:56 2015, ENV->TZ=FKU+5
    TTue Apr 14 16:43:56 2015, ENV->TZ=XYZ+5
    TTue Apr 14 16:43:56 2015, ENV->TZ=ZZ1+5
    ABOVE ALL WORKED Below most failed with UTC or +1 hour???
    TTue Apr 14 20:43:56 2015, ENV->TZ=SSS+1
    TTue Apr 14 21:43:56 2015, ENV->TZ=-01:00
    TTue Apr 14 21:43:56 2015, ENV->TZ=+01:00
    TTue Apr 14 21:43:56 2015, ENV->TZ=+05
    TTue Apr 14 21:43:56 2015, ENV->TZ=+05:00
    TTue Apr 14 21:43:56 2015, ENV->TZ=+0500
    TTue Apr 14 21:43:56 2015, ENV->TZ=+5
    TTue Apr 14 21:43:56 2015, ENV->TZ=+5:00
    TTue Apr 14 21:43:56 2015, ENV->TZ=5000
    TTue Apr 14 21:43:56 2015, ENV->TZ=CDT
    TTue Apr 14 21:43:56 2015, ENV->TZ=CDT
    TTue Apr 14 21:43:56 2015, ENV->TZ=CST
    TTue Apr 14 21:43:56 2015, ENV->TZ=PDT
    TTue Apr 14 21:43:56 2015, ENV->TZ=PST
    TTue Apr 14 21:43:56 2015, ENV->TZ=SSS+0
    TTue Apr 14 21:43:56 2015, ENV->TZ=UTC
    TTue Apr 14 22:43:56 2015, ENV->TZ=-05:00ACDT
    TTue Apr 14 22:43:56 2015, ENV->TZ=+05.00
    TTue Apr 14 22:43:56 2015, ENV->TZ=America/Chicago
    TTue Apr 14 22:43:56 2015, ENV->TZ=America/Los_Angeles
    TTue Apr 14 22:43:56 2015, ENV->TZ=EASST
    TTue Apr 14 22:43:56 2015, ENV->TZ=zzz-1 
```

*   即使找到并安装了Olsen数据库的TzFile模块圣杯，它仍然被搞砸了，没有区别！

    安装 C:\bin\strawberry_perl_5_18\perl\site\lib\DateTime\TimeZone\Tzfile.pm ZEFRAM/DateTime-TimeZone-Tzfile-0.010.tar.gz C:\bin\strawberry_perl_5_18\perl\bin\perl.exe ./构建安装 --uninst 1 -- 确定

以下是在此平台上无任何作用的所有所谓时区：@atz = DateTime::TimeZone->all_names(); printf("所有 tz 名称 [%d] = %s\n", 标量 @atz, join(", ", @atz));

所有 tz 名称 [349] = Africa/Abidjan, Africa/Accra, Africa/Algiers, Africa/Bissau, Africa/Cairo, Africa/Cas​​ablanca, Africa/Ceuta, Africa/El_Aaiun, Africa/Johannesburg, Africa/Khartoum, Africa/Lagos , Africa/Maputo, Africa/Monrovia, Africa/Nairobi, Africa/Ndjamena, Africa/Tripoli, Africa/Tunis, Africa/Windhoek, America/Adak, America/Anchorage, America/Araguaina, America/Argentina/Buenos_Aires, America/Argentina /卡塔马卡，美国/阿根廷/科尔多瓦，美国/阿根廷/胡胡伊，美国/阿根廷/La_Rioja，美国/阿根廷/门多萨，美国/阿根廷/Rio_Gallegos，美国/阿根廷/萨尔塔，美国/阿根廷/圣胡安，美国/阿根廷/圣路易斯, America/Argentina/Tucuman, America/Argentina/Ushuaia, America/Asuncion, America/Atikokan, America/Bahia, America/Bahia_Banderas, America/Barbados, America/Belem, America/Belize, America/Blanc-Sablon,America/Boa_Vista, America/Bogota, America/Boise, America/Cambridge_Bay, America/Campo_Grande, America/Cancun, America/Caracas, America/Cayenne, America/Chicago, America/Chihuahua, America/Costa_Rica, America/Creston, America/ Cuiaba, America/Curacao, America/Danmarkshavn, America/Dawson, America/Dawson_Creek, America/Denver, America/Detroit, America/Edmonton, America/Eirunepe, America/El_Salvador, America/Fortaleza, America/Glace_Bay, America/Godthab, America/Goose_Bay, America/Grand_Turk, America/Guatemala, America/Guayaquil, America/Guyana, America/Halifax, America/Havana, America/Hermosillo, America/Indiana/Indianapolis, America/Indiana/Knox, America/Indiana/Marengo,美国/印第安纳州/圣彼得堡, 美国/印第安纳州/Tell_City, 美国/印第安纳州/Vevay, 美国/印第安纳州/文森斯, 美国/印第安纳州/Winamac, 美国/Inuvik, 美国/伊魁特, 美国/牙买加,America/Juneau, America/Kentucky/Louisville, America/Kentucky/Monticello, America/La_Paz, America/Lima, America/Los_Angeles, America/Maceio, America/Managua, America/Manaus, America/Martinique, America/Matamoros, America/ Mazatlan, America/Menominee, America/Merida, America/Metlakatla, America/Mexico_City, America/Miquelon, America/Moncton, America/Monterrey, America/Montevideo, America/Montreal, America/Nassau, America/New_York, America/Nipigon, America/Nome, America/Noronha, America/North_Dakota/Beulah, America/North_Dakota/Center, America/North_Dakota/New_Salem, America/Ojinaga, America/巴拿马, America/Pangnirtung, America/Paramaribo, America/Phoenix, America/Port- au-Prince, America/Port_of_Spain, America/Port_Velho, America/Puerto_Rico, America/Rainy_River, America/Rankin_Inlet, America/Recife, America/Regina, America/Resolute,America/Rio_Branco, America/Santa_Isabel, America/Santarem, America/Santiago, America/Santo_Domingo, America/Sao_Paulo, America/Scoresbysund, America/Sitka, America/St_Johns, America/Swift_Current, America/Tegucigalpa, America/Thule, America/ Thunder_Bay, America/Tijuana, America/Toronto, America/Vancouver, America/Whitehorse, America/Winnipeg, America/Yakutat, America/Yellowknife, Antarctica/Cas​​ey, Antarctica/Davis, Antarctica/DumontDUrville, Antarctica/Macquarie, Antarctica/Mawson, Antarctica/Palmer, Antarctica/Rothera, Antarctica/Syowa, Antarctica/Troll, Antarctica/Vostok, Asia/Almaty, Asia/Amman, Asia/Anadyr, Asia/Aqtau, Asia/Aqtobe, Asia/Ashgabat, Asia/Baghdad, Asia/巴库, 亚洲/曼谷, 亚洲/贝鲁特, 亚洲/比什凯克, 亚洲/文莱, 亚洲/赤塔, 亚洲/乔巴山, 亚洲/科伦坡, 亚洲/大马士革, 亚洲/达卡, 亚洲/帝力, 亚洲/迪拜, 亚洲/杜尚别,亚洲/加沙，Asia/Hebron, Asia/Ho_Chi_Minh, Asia/Hong_Kong, Asia/Hovd, Asia/Irkutsk, Asia/Jakarta, Asia/Jayapura, Asia/Jerusalem, Asia/Kabul, Asia/Kamchatka, Asia/Karachi, Asia/Kathmandu, Asia/ Khandyga, 亚洲/加尔各答, 亚洲/克拉斯诺亚尔斯克, 亚洲/吉隆坡, 亚洲/古晋, 亚洲/澳门, 亚洲/马加丹, 亚洲/望加锡, 亚洲/马尼拉, 亚洲/尼科西亚, 亚洲/新库兹涅茨克, 亚洲/新西伯利亚, 亚洲/鄂木斯克, Asia/Oral, Asia/Pontianak, Asia/Pyongyang, Asia/Qatar, Asia/Qyzylorda, Asia/Rangoon, Asia/Riyadh, Asia/Sakhalin, Asia/Samarkand, Asia/Seoul, Asia/Shanghai, Asia/Singapore, Asia/斯雷德涅科雷姆斯克，亚洲/台北，亚洲/塔什干，亚洲/第比利斯，亚洲/德黑兰，亚洲/廷布，亚洲/东京，亚洲/乌兰巴托，亚洲/乌鲁木齐，亚洲/乌斯季尼拉，亚洲/符拉迪沃斯托克，亚洲/雅库茨克，亚洲/叶卡捷琳堡，亚洲/埃里温，大西洋/亚速尔群岛，大西洋/百慕大，大西洋/加那利，大西洋/佛得角，大西洋/法罗，Atlantic/Madeira, Atlantic/Reykjavik, Atlantic/South_Georgia, Atlantic/Stanley, Australia/Adelaide, Australia/Brisbane, Australia/Broken_Hill, Australia/Currie, Australia/Darwin, Australia/Eucla, Australia/Hobart, Australia/Lindeman, Australia/ Lord_Howe，澳大利亚/墨尔本，澳大利亚/珀斯，澳大利亚/悉尼，CET，CST6CDT，EET，EST，EST5EDT，欧洲/阿姆斯特丹，欧洲/安道尔，欧洲/雅典，欧洲/贝尔格莱德，欧洲/柏林，欧洲/布鲁塞尔，欧洲/布加勒斯特，欧洲/布达佩斯，欧洲/基希讷乌，欧洲/哥本哈根，欧洲/都柏林，欧洲/直布罗陀，欧洲/赫尔辛基，欧洲/伊斯坦布尔，欧洲/加里宁格勒，欧洲/基辅，欧洲/里斯本，欧洲/伦敦，欧洲/卢森堡，欧洲/马德里, 欧洲/马耳他, 欧洲/明斯克, 欧洲/摩纳哥, 欧洲/莫斯科, 欧洲/奥斯陆, 欧洲/巴黎, 欧洲/布拉格, 欧洲/里加, 欧洲/罗马, 欧洲/萨马拉, 欧洲/辛菲罗波尔, 欧洲/苏菲亚，欧洲/斯德哥尔摩, 欧洲/塔林, 欧洲/地拉尼, 欧洲/乌日哥罗德, 欧洲/维也纳, 欧洲/维尔纽斯, 欧洲/伏尔加格勒, 欧洲/华沙, 欧洲/扎波罗热, 欧洲/苏黎世, HST, 印度/查戈斯, 印度/圣诞节, Indian/Cocos, Indian/Kerguelen, Indian/Mahe, Indian/Maldives, Indian/Mauritius, Indian/Reunion, MET, MST, MST7MDT, PST8PDT, Pacific/Apia, Pacific/Auckland, Pacific/Bougainville, Pacific/Chatham, Pacific/ Chuuk, Pacific/Easter, Pacific/Efate, Pacific/Enderbury, Pacific/Fakaofo, Pacific/Fiji, Pacific/Funafuti, Pacific/Galapagos, Pacific/Gambier, Pacific/Guadalcanal, Pacific/Guam, Pacific/Honolulu, Pacific/Kiritimati,太平洋/科斯雷, 太平洋/夸贾林, 太平洋/马朱罗, 太平洋/马克萨斯, 太平洋/瑙鲁, 太平洋/纽埃, 太平洋/诺福克, 太平洋/努美阿, 太平洋/Pago_Pago, 太平洋/帕劳, 太平洋/皮特凯恩, 太平洋/波纳佩, 太平洋/ Port_Moresby,太平洋/拉罗汤加、太平洋/大溪地、太平洋/塔拉瓦、太平洋/汤加塔布、太平洋/威克、太平洋/瓦利斯、UTC、WET

# java - 从 javabean 创建不可变对象

> ID：753375
> 
> 赞同：5
> 
> 时间：2009-04-15T19:41:16.367
> 
> 标签：java, immutability, javabeans

我参与了这个项目，我们正在构建大量遗留代码。我有一个关于必须通过网络传输的大型 java bean 对象的特殊情况。所以我的第一个想法是让它不可变和可序列化来做这个把戏。在这一点上，我面临着一些困难的选择：-

1.  理想情况下，我想要某种方法来自动生成此类的不可变、可序列化版本。我没有以任何方式重构或更改此类的范围，我真的很讨厌必须复制粘贴具有不同名称的类？

2.  假设我放弃了 1 即我实际上选择了复制 HUGE javabean 类的代码，我仍然会处于不得不编写一个带有 20-25 个参数的构造函数以使这个类不可变的糟糕情况。除了构造函数注入之外，使类不可变的更好方法是什么？

谢谢并恭祝安康，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T20:01:24.397

要使其真正不可变，您需要在构造时初始化成员。

一种方法（我不是说它很漂亮！）这样做并避免构造函数中的巨大参数列表是拥有一个具有相同属性的可变类型。通过“setters”一次设置一个可变类型的属性，然后将可变对象作为单个参数传递给不可变类型的构造函数。然后，不可变对象将属性从可变源复制到它自己的 ( `final`) 成员。

您也可以考虑“有效的不变性”。也就是说，即使系统没有强制执行不变性，您也可以使用将初始化阶段与使用阶段明确分开的编码实践。毕竟，序列化不需要不变性。

您可以更进一步，为不公开实现属性的接口创建实现隐藏包装器。包装器仅通过委托给“真实”实现来实现接口中的方法。实现中的 setter 和 getter 不存在于包装器中。这将阻止客户端简单地从接口向下转换到实现类并操作属性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-24T21:51:16.433

Joshua Bloch 的“Effective Java”说明了 Builder 模式，其中简单的 Builder 对象用于构造具有长构造函数参数列表的复杂对象。我会推荐它。

[http://www.drdobbs.com/java/208403883;jsessionid=PJWS41F5DJ4QRQE1GHRSKH4ATMY32JVN?pgno=2](http://www.drdobbs.com/java/208403883;jsessionid=PJWS41F5DJ4QRQE1GHRSKH4ATMY32JVN?pgno=2)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-24T21:59:53.233

包含 getter 的简单只读接口怎么样？

如果 bean 类是你自己的，让它简单地实现接口并在创建后只使用接口。

如果您无法控制 bean 类，您还可以创建一个 getter 接口并通过为该 getter 接口创建一个代理来实现它，该代理使用调用处理程序将所有方法调用委托给 bean。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T20:14:44.693

20-25 个属性对于一次性来说并不大，特别是如果您使用的是一个半体面的编辑器。

如果在构造不可变版本时已经有一个可变实例，只需将其传递给构造函数即可。

如果你想成为**真正邪恶的 hacky**，请使用为可变类或子类实现`java.beans`创建可序列化。或者，您可以使用XML 序列化（可以通过 Java 序列化发送的 XML ......）。`Map``Externalizable``java.beans`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T23:50:12.367

**第 1 步**：创建一个新类并为其提供与“大 Java bean 对象”的实例变量名称完全相同的实例变量。那个新类不应该有设置器（但只有获取器）以使其不可变。

**第 2 步**：使用 Apache Commons **BeanUtils.copyProperties**将所有属性（即实例变量）从“大 java bean 对象”复制到新对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T16:14:46.007

一些想法：

**受保护的 setter 和工厂方法** 您可以使用受保护的 setter 方法定义 bean，并在同一个包中定义一个工厂类，该工厂类接受所有参数并调用这些 setter。bean 在该包之外是不可变的。要强制执行此操作，请务必密封您的 jar，以便最终用户无法在同一个包中创建新类。

注意：您可以使用我的 JavaDude Bean 注释来简化创建： [http ://code.google.com/p/javadude/wiki/Annotations](http://code.google.com/p/javadude/wiki/Annotations)

例如：

```
@Bean(writer=Access.PROTECTED, // all setXXX methods will be protected
    properties={
        @Property(name="name"),
        @Property(name="age", type=int.class)
    })
public class Person extends PersonGen {
} 
```

**在eclipse中创建getter和构造函数**

Eclipse 有一些很好的工具可以使这个速度更快：

1.  创建 bean 类
2.  添加你想要的字段
3.  在编辑器窗口中单击鼠标右键
4.  选择 Source->Generate Getter and Setter
5.  按“选择吸气剂”按钮
6.  按确定
7.  在编辑器窗口中单击鼠标右键
8.  选择 Source->Generate Constructors from fields
9.  在构造函数中选择并排序您想要的字段
10.  按确定

**不变性装饰器**

另一个想法是用 getter 和 setter 定义你的 bean（你可以使用上述技术，但包括 setter），然后你可以为它创建一个只有 getter 的包装类。

# testing - 如何测试您的网络服务器速度？

> ID：753376
> 
> 赞同：1
> 
> 时间：2009-04-15T19:41:29.453
> 
> 标签：testing, shared-hosting, bandwidth

我们的网站似乎比以前慢，我该如何测试？有没有办法找到原因？（例如太多的访客）。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-15T19:45:03.547

有一个相当不错的 Web 服务器性能基准测试工具：[Jakarta Jmeter](http://jakarta.apache.org/jmeter/)，它是一个 Apache 项目，因此得到了很好的支持和测试。

能够查明原因的关键是定期进行基准测试，因此您实际上可以将基准测试结果的变化与服务器上的事件相匹配：升级、代码更改、访问者数量的变化......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T19:45:46.293

Firefox 的 Firebug 插件有一个 Net 选项卡，可用于调试问题和测试。Windows 上的 Fiddler 也不错。然后是检查服务器错误日志是否有任何问题的古老传统。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T19:47:09.517

一个好的第一步是确保您保留相当完整的服务器日志并将它们提供给日志分析器。这有助于让您大致了解事情需要多长时间以及哪些页面最慢。检查错误日志以确保工作正常也是一个好主意。

除此之外，事情变得更加复杂，因为您可能需要隔离您的网络服务器、代码和数据库，以查看其中之一是否是瓶颈。此外，Jeff 的博客，编码恐惧最近有一篇关于服务器优化的文章。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T19:50:55.187

使用谷歌分析随着时间的推移跟踪您网站的访问者，以了解您是否获得了更多流量。

您使用共享主机标记了您的问题 - 在共享主机上意味着其他人的代码与您在同一台机器上运行可能会影响您网站的性能。

我建议使用 Varkhan 和 apphacker 的建议，以确保您网站的代码相当快。使用分析来获取一些统计数据，并且可能，根据您获得的访问者数量和网站的速度，考虑远离共享主机。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-08-17T08:40:19.503

[在Bitcatcha.com](http://www.bitcatcha.com/)尝试服务器速度检查器。该工具 ping 您的网站服务器并记录获得响应所需的时间。它还从 8 个不同的节点 ping 到您的服务器。您至少可以查明是否是您的服务器在减慢您的网站速度。

# ruby-on-rails - 创建 ActiveRecord 对象时如何设置属性？

> ID：753379
> 
> 赞同：2
> 
> 时间：2009-04-15T19:42:27.500
> 
> 标签：ruby-on-rails, activerecord

我正在尝试在我正在创建的对象上设置一个属性。我觉得这应该工作：

```
 def create
    @album = Album.new(params[:album])
    @album.user = current_user

    if @album.save
       flash[:notice] = 'Album was successfully created for ' + current_user.login + '.'
       redirect_to albums_url 
    else
       render :action => "new"
    end
  end 
```

但它似乎忽略了对该`user`领域的分配。有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T19:50:54.843

假设您的模型关系设置正确*，最好这样做：

```
@album = current_user.albums.build(params[:album]) 
```

— 这将正确地`user_id`将新专辑的字段填充到当前用户的 ID。

* * *

*就像是：

```
class User < ActiveRecord::Base
  has_many :albums
  .
  .
  .
end

class Album < ActiveRecord::Base
  belongs_to :user
  .
  .
  .
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T19:47:46.647

您的相册迁移或您的相册模型是否引用了 user_id 或与用户的关系？

如果没有，即使您分配了该信息，数据库也不会保存该信息。

# ruby-on-rails - Rails 找不到 image_magick gem

> ID：753383
> 
> 赞同：1
> 
> 时间：2009-04-15T19:42:50.167
> 
> 标签：ruby-on-rails, image-processing, rubygems, imagemagick

我正在尝试使用 image_magick gem 来处理图像上传，但 rails 找不到它。

我已经使用以下方法成功安装了 gem：

```
gem install mini_magick-1.2.3.gem --local
gem update system
gem cleanup 
```

我的模型有

```
require 'rubygems'
require 'mini_magick' 
```

但是，我仍然收到错误：

```
no such file to load -- mini_magick 
```

我可以在 environment.rb 中添加一些东西以将导轨指向正确的位置吗？

环境信息：

```
Windows XP/InstantRails 2.0 
ruby 1.8.6 (2007-09-24 patchlevel 111) [i386-mswin32]
Rails 2.3.2 
```

谢谢您的帮助，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T19:46:41.313

健全性检查：是否`gem list mini_magick`显示已安装的 gem？

编辑：

刚刚注意到你有'我的模型有......'；将它们从模型中拉出，并将`require`线条放入 environment.rb 中。`require 'rubygems'`如果您使用的是 Ruby 1.9，则不需要。

# vba - 根据相邻单元格的条件解锁单元格

> ID：753397
> 
> 赞同：1
> 
> 时间：2009-04-15T19:47:28.923
> 
> 标签：vba, excel, excel-formula

我有两列，但我想要的代码是从一个单元格到另一个单元格进行评估。

第一列的单元格具有带有名称的下拉验证，第二列只有在选择相邻单元格中的某个名称时才会激活。

到目前为止，我只找到了这段代码，但它似乎不起作用：

```
Private Sub Worksheet_Change(ByVal Target As Range)
    If Range("A1").Value = "Car" Then
        Range("B1").Locked = False
    Else
        Range("B1").Locked = True
    End If
End Sub 
```

我需要这段代码来自（例如）A1:A10 和 B1:B10。

我希望我说得通。如果有办法在没有 VBA 的情况下做到这一点，那就太好了。

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T20:20:50.390

Target 参数告诉您正在更改的范围。

您需要执行以下操作：

```
Private Sub Worksheet_Change(ByVal Target As Range)
    Dim rng As Range

    Set rng = Intersect(Range("A1:A10"), Target)
    If rng Is Nothing Then
        ' Not updating the range we care about
        Exit Sub
    Else
        rng.Offset(0, 1).Locked = ... whatever ...
    End If
End Sub 
```

请注意，您的目标范围可以超过一个单元格（例如，使用复制/粘贴时），因此您需要处理和测试这种情况。

调用 Intersect 会返回目标范围和您有兴趣测试的范围的交集（本示例中的 A1:A10）。

然后，您可以使用 .Offset(0,1) 访问相应的相邻单元格

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T19:55:11.997

```
Private Sub Worksheet_Change(ByVal Target As Range)

If Range("A1").Value = "Car" Then
    Range("B1").Locked = False
    Me.Unprotect ("password")
Else
    Range("B1").Locked = True
    Me.Protect ("password")
End If

End Sub 
```

使用 Me.Protect 以便 .Locked 方法执行某些操作。不过，您可能应该解锁所有其他单元格。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T20:02:43.333

该代码片段非常适合我。

您是否将该代码放在正确的`WorkSheet`对象中？如果您只是将其放入 VBA 模块中，它将无法正常工作。当您在 Visual Basic 编辑器中时，在屏幕左侧查找标有“Microsoft Excel 对象”的目录。在该目录中应该是`WorkSheet`文件中每个工作表的对象。双击其中一个来编辑它的代码`WorkSheet`。这是您的代码片段应该去的地方。

# ios - 分层 TableView 内存从未释放

> ID：753401
> 
> 赞同：2
> 
> 时间：2009-04-15T19:48:55.240
> 
> 标签：ios, uitableview, memory-management

在非常好的书籍“Beginning iPhone Development”（Apress）的第 9 章中，他们解释了如何使用导航控制器和分层表视图构建应用程序。
如果您使用 Instrument/Activity 监视器启动应用程序，应用程序运行良好但有一个大问题：每次从表视图向下钻取到子表时，它会多占用 1Mo 内存！并且这个内存永远不会被释放，当然，最后应用程序会崩溃。对我来说问题来自“RootViewController.h”的以下方法：（
*原始源代码是这个[ZIP文件](http://iphonedevbook.com/BeginningiPhoneDev.121808.zip)的“09 Nav” ）*

```
- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    NSUInteger row = [indexPath row];
    SecondLevelViewController *nextController = [self.controllers objectAtIndex:row];

    NavAppDelegate *delegate = [[UIApplication sharedApplication] delegate];
    [delegate.navController pushViewController:nextController animated:YES];

} 
```

在这种方法中，“nextcontroller”永远不会被释放。为了使用命令[nextController release]；我做了以下修改：

```
- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    NSUInteger row = [indexPath row];
    SecondLevelViewController *nextController = [[SecondLevelViewController alloc] init ];
    nextController = [self.controllers objectAtIndex:row];
    NavAppDelegate *delegate = [[UIApplication sharedApplication] delegate];
    [delegate.navController pushViewController:nextController animated:YES];
    [nextController release];
} 
```

现在，如果你运行应用程序，内存就被很好地释放了！但是，如果您尝试在您已经“访问过”的子表中向下钻取，则应用程序会崩溃。

我们如何才能正确释放内存？
先感谢您。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T08:14:50.640

我不知道“Clang Checker”工具。谢谢你花时间测试它。“Clang Checker”似乎很强大，我试试看。

我完全同意你的观点 RootViewController:"nextController" 不是泄漏，而是内存消耗者。如果您使用 Instrument/Activity 监视器运行应用程序，一开始应用程序需要 7 Mo，每次进入子表时，它会多占用 1 Mo 内存：

*   10次​​后，应用需要17Mo，
*   20 次后，申请需要 27 Mo

所以最后应用程序崩溃（如果我没记错的话，一个应用程序不能超过 40Mo）并且这个应用程序在内存管理方面不遵循 Apple 规则。

通过我的修改，当你进入一个子表时，它会占用一个 1Mo 的内存，但是当你回到“根”表时，会释放 1Mo 的内存。你可以进入另一个子表，回来，内存被释放。“唯一”的问题是，如果您再次进入已经访问过的子表，应用程序就会崩溃。因此，我正在寻找一种解决方案来强制应用程序在访问子表后释放内存。

*为了检查仪器/活动监视器，我跟踪了 Apple 设置应用程序使用的内存（分层表视图应用程序也是）。当你进入子表时，它需要 1 Mo 的内存，但是当你来的时候返回，内存被释放。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T22:21:15.857

如果您使用 Clang 检查器 ( [http://clang.llvm.org/StaticAnalysis.html](http://clang.llvm.org/StaticAnalysis.html) ) 检查源代码，您将看到有 3 个泄漏：

1）PresidentDetailController.m，对象 NSIndexPath *newPath（第 75 行）永远不会释放 2）PresidentDetailController.m，对象 UITextField *textField（第 166 行）永远不会释放 3）PresidentsViewController.m，对象 PresidentDetailController *childController（第 86 行） ) 永远不会被释放

您建议的不是泄漏；您对源代码的更改是应用程序崩溃的原因。使用 Clang 检查器非常简单，看看

[http://clang.llvm.org/StaticAnalysisUsage.html#BasicUsage](http://clang.llvm.org/StaticAnalysisUsage.html#BasicUsage)

亲切的问候

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-18T13:52:31.907

控制器没有被释放，因为 self.controllers 保留了它（诸如 NSArray 之类的集合保留了放入其中的对象）。在第二个代码块中，您正在创建一个完全独立的对象，立即泄漏它，然后过度释放您从 self.controllers 中拉出的控制器（这会导致您的崩溃）。

看起来这段代码打算在程序的整个生命周期中保留它的控制器，所以这本身并没有错。您在内存中增长的事实表明您正在创建新对象。我会寻找对 +alloc、+copy 或 -retain 的调用，这些调用没有对 +autorelease 或 +release 的相应调用。在 Instruments 中，使用 ObjectAllocation 和 Leaks 工具来识别被过度保留的特定内存以及创建点。创建点并不能准确地告诉您错误在哪里，但通常这是一个很好的提示。

要了解您在此处实现的向下钻取模式，您应该学习[SimpleDrillDown](http://developer.apple.com/iphone/library/samplecode/SimpleDrillDown/)示例代码。

当然，所有 Cocoa 学生都应该牢记[内存管理规则](http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)。它们并不复杂，但绝对有必要理解。如果有帮助，我已经[对它们进行了总结。](http://robnapier.net/blog/three-magic-words-6)

# algorithm - 'O(N)' 类型的东西很好的进修课程？

> ID：753403
> 
> 赞同：4
> 
> 时间：2009-04-15T19:49:28.187
> 
> 标签：algorithm, computer-science, big-o

在大学里学习了所有关于计算算法成本的知识，但那是很久以前的事了，我都忘记了。有没有贯穿整个主题的演练？我觉得好像比我现在记得的要多。我想刷新我的一些核心技能。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T19:51:44.967

看看[Big-O 适合八岁的孩子吗？](https://stackoverflow.com/questions/107165/big-o-for-eight-year-olds)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T19:52:26.603

您应该能够通过搜索复杂性分析找到各种教程。

[维基百科（算法分析）](http://en.wikipedia.org/wiki/Analysis_of_algorithms)总是一个快速复习的好地方。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T19:57:11.133

这是一个很好的资源，有一些测试：

[复杂性和大 O 表示法](http://pages.cs.wisc.edu/~cs367-3/readings/Complexity/)

# c# - 针对 x86 和 x64 的设置？

> ID：753412
> 
> 赞同：19
> 
> 时间：2009-04-15T19:51:47.073
> 
> 标签：c#, installation, cpu-architecture

我有一个需要 x64 和 x86 dll 的程序（它会在运行时确定需要哪些），但是在尝试创建设置时，它会抱怨：

> 以“AMD64”为目标的文件 AlphaVSS.WinXP.x64.dll 与项目的目标平台“x86”
> 不兼容 以“AMD64”为目标的文件 AlphaVSS.Win2003.x64.dll 与项目的目标平台“x86”
> 文件不兼容.Win2008.x64.dll 以“AMD64”为目标与项目的目标平台“x86”不兼容

如何使我的设置像我的程序一样针对两个平台？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-15T20:35:24.783

安装项目（在 Visual Studio 中）创建的 MSI 一次只能针对一个平台。您的选择是制作 2 个 MSI，将它们合并在一起，然后制作一个自定义设置引导程序，在两者之间进行选择。有一些 3rd 方产品，例如[Advanced Installer](http://www.advancedinstaller.com)，可以为您执行此操作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-07-05T08:14:46.800

我也遇到了这个问题，并[写了一篇](http://darenatwork.blogspot.com/2011/05/adding-both-32-and-64-bit-versions-of.html)关于我的解决方案的博客文章：

*   使用 deflate.exe 对文件进行压缩，使用不同的扩展名（例如 .x64）对其进行命名
*   将其作为内容文件添加到您的主项目中
*   将自定义操作项目添加到您的解决方案
*   将自定义操作添加到设置项目“安装”自定义操作
*   使用自定义操作安装方法中的文件膨胀
*   System.IO.Compression.DeflateStream（见上面的代码）
*   绕着你的办公桌跳一段小舞，穿过大厅，越过你想惹恼的尽可能多的同事:)

该`deflate.exe`文件可以从谷歌代码的[存储库中下载。](http://code.google.com/p/deflate/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T19:58:02.487

.Net 有一个“任何 CPU”选项。很容易将其视为更多的“通用”选项，仅使用较少的 x86 功能，但实际上它允许每台机器上的 JIT 编译器为该机器选择合适的 cpu 类型。

唯一不应该使用它的情况是，如果您知道自己有不适合一种架构或另一种架构的依赖项或要求。例如：你知道你需要*很多*内存，你依赖于 32 位原生 dll，或者你想预编译应用程序。

这里存在危险，因为您具有特定于平台的 dll 依赖性。但是您对这两种类型都有 dll，听起来您知道如何在运行时选择正确的 dll。那么“任何 CPU”选项对您有用吗？

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2011-12-21T11:10:30.187

1.  打开一个部署项目。
2.  在解决方案资源管理器中，选择部署项目。
3.  在“属性”窗口中，选择 TargetPlatform 属性。
4.  为 Intel Itanium 64 位平台选择 Itanium，或为任何其他 64 位平台（例如 AMD64 和 EM64T 指令集）选择 x64。
5.  在安装时，如果目标计算机与指定平台不兼容，则会引发错误并停止安装。

# unix - 指向绝对路径的链接

> ID：753418
> 
> 赞同：2
> 
> 时间：2009-04-15T19:52:54.090
> 
> 标签：unix, path, symlink

链接应始终指向绝对路径而不是指向当前目录是一种好习惯吗？

我在谈论这个参考 - 我需要维护软件并且它的所有以前的版本应该总是指向最新版本。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T19:58:33.687

定义“良好实践”。链接是否指向绝对路径取决于文件之间的关系。

如果文件始终处于相同的相对位置，但可以四处移动（例如 中的别名`bin/`），则它们应该是相对的。如果实际文件位于已知位置（例如，您希望将默认配置文件链接到`~/.config`），则使用绝对路径。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:24:56.040

我不认为我可以同意这一概括。

在某些情况下，相对链接更有意义。例如，使用项目的目录树。如果项目被备份，或移动（甚至复制）到另一个地方，绝对链接可能会令人困惑和/或灾难性的。

即使您谈论的是系统范围的工具，也会有相对链接有意义的情况，而其他时候则不然。将链接到一个非常通用的工具（如 grep ）与位于同一主机上的 gnu 编译器工具的多个版本和目标风格进行比较。在后一种情况下，可能需要指向特定工具版本的绝对链接。

这一切都回到了你在每种情况下真正想做的事情。一般的答案是没有普遍的答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T20:03:55.563

取决于你想做什么。我的 Linux 系统有两种符号链接。

```
find /usr /bin /lib -type l -print0 | xargs -0 ls -ld | less 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T20:04:50.613

我不认为有一个“好的做法”。有不同的用例。

例如，如果我在 /home/.../application 中存储一个本地安装程序的树，我可能希望将“默认配置”符号链接到一些没有绝对路径的特定配置。这样，当我将整个树移动到 /home/.../application-other-instance 时，配置文件的链接保持正确。

另一方面，如果我想在本地目录中引用 /etc/... 中的某个全局文件，我将使用绝对路径符号链接来完成。这保证了我在移动的任何地方都指向同一个文件。

想想你想要实现什么，相对/绝对路径的决定要么是显而易见的，要么是不相关的。只有“从不这样做”的规则可能是：永远不要通过../../../../../../../xxx 链接到根目录/xxx 中的任何内容

# c# - WebRequest.创建异常

> ID：753434
> 
> 赞同：1
> 
> 时间：2009-04-15T19:57:06.170
> 
> 标签：c#, asp.net, windows

我最近刚开始在使用时遇到一个非常严重的问题

`WebRequest.Create(string url)`

我在共享服务器上，最近服务器公司宣布由于某些 Windows 安全问题，它必须在所有 Windows Web 服务器上将 IIS 中的信任级别从完全更改为中。

结果，当我尝试执行 WebRequest.Create(string url) - （我需要它来连接到 USPS 服务器以获取实时运费）我得到以下异常。

```
Request for the permission of type 'System.Net.WebPermission, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' failed 
```

堆栈跟踪将其缩小到 WebRequest.Create 方法。

我进行了几次搜索，发现 IIS 信任级别最有可能导致问题。

如果我的托管公司所做的这个 IIS 更改是对这个 Windows 安全问题的永久修复，有什么办法可以解决这个问题吗？由于我在共享服务器上，因此我实际上无法访问 IIS。我可以使用 WebRequest.Create 以外的其他方法从外部服务器获取数据吗？或者我可以在我的应用程序代码中使用权限/信任级别做一些事情吗？

提前致谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T20:00:05.883

将以下内容添加到您的 web.config（在 system.web 下）：

```
<trust level="Medium" originUrl=".*"/> 
```

这是有关[trust element](http://msdn.microsoft.com/en-us/library/tkscy493.aspx)的更多信息。

# c# - 为什么局部变量必须具有初始值？

> ID：753438
> 
> 赞同：7
> 
> 时间：2009-04-15T19:57:56.077
> 
> 标签：c#

为什么我必须在方法中初始化变量？

```
int test1; // Not initialized, but OK

public int Foo()
{
   int test2;                 // Not initialized

   int test3 = test1;         // OK
   int test4 = test2;         // An error
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-15T20:00:38.520

字段自动初始化为类型的逻辑零；这是隐含的。变量必须服从“明确赋值”，因此**必须**先赋值才能读取。

ECMA 334v4

> §17.4.4 字段初始化
> 
> 字段的初始值，无论是静态字段还是实例字段，都是字段类型的默认值（第 12.2 节）。在默认初始化发生之前不可能观察到字段的值，因此字段永远不会“未初始化”。

和

> §12。变量
> 
> ...在获得其值之前，应明确分配变量（第 12.3 节）。...

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-08-01T18:11:57.050

扩展 Mark 的回答，局部变量初始化也与**验证过程**有关。

CLI 要求在任何可验证代码（即，未使用[SecurityPermission](http://msdn.microsoft.com/en-us/library/system.security.permissions.securitypermissionattribute%28VS.80%29.aspx)属性中的 SkipVerfication 属性明确要求跳过验证过程的模块）中，所有局部变量都必须在使用前进行初始化。否则将导致抛出[VerficationException](http://msdn.microsoft.com/en-us/library/system.security.verificationexception.aspx)。

更有趣的是，编译器会自动`.locals init`在每个使用局部变量的方法上添加标志。此标志使 JIT 编译器生成将所有局部变量初始化为其默认值的代码。这意味着，即使您已经在自己的代码中初始化了它们，JIT 也会遵守该`.locals init`标志并生成正确的初始化代码。这种“重复初始化”不会影响性能，因为在允许优化的配置中，JIT 编译器会检测到重复并有效地将其视为“死代码”（自动生成的初始化例程不会出现在生成的汇编程序指令中）。

根据微软的说法（也由[Eric Lippert](https://stackoverflow.com/users/88656/eric-lippert)在他的博客上回答一个问题提供支持），在大多数情况下，当程序员不初始化他们的局部变量时，他们不会这样做，因为他们依赖于底层环境来初始化他们的变量到他们的默认值，但只是因为他们“忘记了”，因此，有时会导致虚幻的逻辑错误。

所以为了减少这种性质的错误出现在 C# 代码中的可能性，编译器仍然坚持你将初始化你的局部变量。即使它将`.locals init`标志添加到生成的[CIL](https://en.wikipedia.org/wiki/Common_Intermediate_Language)代码中。

可以在此处找到有关此主题的更全面的解释：[Behind The .locals init Flag](http://www.liranchen.com/2010/07/behind-locals-init-flag.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-15T20:00:51.233

其实不应该。您的错误应该在第二行，而不是第一行，并且应该是因为您在初始化它之前使用了它*。*

编译器在这里为您提供帮助。

所以不要将它们初始化为一种习惯。而是让编译器帮助你！

这样做的好处是它将为您进行路径检查。如果你有一个 switch 语句，其中三种情况都设置了值，但你忘记在“默认”中设置它，但之后使用它，它会警告你错过了一条路径。

如果您将变量初始化为`= 0`，您将失去该优势。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T20:29:20.447

正如 Marc 所指出的，这就是规范所说的。这是一件*好事*的原因是有一些正当的理由让一个成员未初始化而不是一个局部变量，其生命周期受它所在的方法的限制。大多数情况下，如果变量的初始化成本很高，只能在特定的使用场景下进行初始化。就我而言，我会避免未初始化的成员，直到我的背真正靠在墙上！

对于局部变量，检测是否所有代码路径都可能导致初始化也容易得多，而没有好的启发式方法可以确定整个程序中的所有代码路径是否保证在使用前进行初始化。正如所有计算机科学专业的学生都应该知道的那样，[在这两种情况下都不可能得到](http://en.wikipedia.org/wiki/Halting_problem)完全正确的答案。

# c++ - 网络数据包有效载荷数据是否应该在适当的边界上对齐？

> ID：753440
> 
> 赞同：4
> 
> 时间：2009-04-15T19:58:04.907
> 
> 标签：c++, c, network-programming, sockets, payload

如果您有以下类作为网络数据包有效负载：

类有效载荷 { char field0; 整数字段1；字符字段2；整数字段3；};

在通过套接字接收数据时，使用像 Payload 这样的类是否会使数据的接收者容易受到对齐问题的影响？我认为该类要么需要重新排序，要么需要添加填充以确保对齐。

重新排序：

```
class Payload
{
    int  field1;
    int  field3;
    char field0;
    char field2;
}; 
```

或添加填充：

```
class Payload
{
    char  field0;
    char  pad[3];
    int   field1;
    char  field2;
    char  pad[3];
    int   field3; 
}; 
```

如果由于某种原因重新排序没有意义，我认为添加填充将是首选，因为它可以避免对齐问题，即使它会增加类的大小。

您对网络数据中的此类对齐问题有何经验？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-15T20:00:11.187

正确、盲目地忽略对齐可能会导致问题。即使在同一个操作系统上，如果 2 个组件是用不同的编译器或不同的编译器版本编译的。

最好...
1）通过某种序列化过程传递您的数据。
2）或者单独传递每个原语，同时仍然注意字节顺序==字节[序](http://en.wikipedia.org/wiki/Endianness)

一个好的起点是[Boost Serialization](http://www.boost.org/doc/libs/1_38_0/libs/serialization/doc/index.html)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-15T20:24:26.683

您应该查看[Google protocol buffers](http://code.google.com/apis/protocolbuffers/docs/overview.html)或 Boost::serialize 就像另一位海报所说的那样。

如果你想自己动手，请做对。

如果您使用 stdint.h 中的类型（即：`uint32_t, int8_t,`等），并确保每个变量都具有“本机对齐”（这意味着它的地址可以被它的大小整除（`int8_t`s 在任何地方，`uint16_t`s 在偶数地址上，`uint32_t`s 在地址上可被 4 整除），您不必担心对齐或打包。

在之前的工作中，我们通过 XML 定义的数据总线（以太网或 CANbus 或 byteflight 或串行端口）发送所有结构。有一个解析器可以验证结构中变量的对齐方式（如果有人编写了错误的 XML，则会提醒您），然后为各种平台和语言生成头文件以发送和接收结构。这对我们来说*非常*有效，我们*从来没有*不必担心手写代码来进行消息解析或打包，并且可以保证所有平台都不会出现愚蠢的小编码错误。我们的一些数据链路层非常受带宽限制，因此我们实现了位域之类的东西，解析器为每个平台生成正确的代码。我们也有枚举，这非常好（你会惊讶于人类很容易在枚举上手动搞砸编码位域）。

除非您需要担心它在使用 C 的 8051 和 HC11 上运行，或者在带宽非常受限的数据链路层上运行，否则您不会想出比协议缓冲区更好的东西，您只会花费大量时间尝试与他们平起平坐。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-15T21:17:20.393

我们今天使用直接覆盖在内存中的二进制数据包上的打包结构，我为我决定这样做的那一天感到后悔。我们让它工作的唯一方法是：

1.  根据编译环境仔细定义位宽特定类型 ( `typedef unsigned int uint32_t`)
2.  插入适当的编译器特定的编译指示以指定结构成员的紧密封装
3.  要求一切都按一个字节顺序排列（使用网络或大端顺序）
4.  仔细编写服务器和客户端代码

如果您刚刚开始，我建议您跳过尝试用结构表示线路上的内容的整个混乱。只需分别序列化每个原始元素。如果您选择不使用 Boost Serialize 之类的现有库或 TibCo 之类的中间件，那么可以通过在二进制缓冲区周围编写一个隐藏序列化方法细节的抽象来省去很多麻烦。瞄准如下界面：

```
class ByteBuffer {
public:
    ByteBuffer(uint8_t *bytes, size_t numBytes) {
        buffer_.assign(&bytes[0], &bytes[numBytes]);
    }
    void encode8Bits(uint8_t n);
    void encode16Bits(uint16_t n);
    //...
    void overwrite8BitsAt(unsigned offset, uint8_t n);
    void overwrite16BitsAt(unsigned offset, uint16_t n);
    //...
    void encodeString(std::string const& s);
    void encodeString(std::wstring const& s);

    uint8_t decode8BitsFrom(unsigned offset) const;
    uint16_t decode16BitsFrom(unsigned offset) const;
    //...
private:
    std::vector<uint8_t> buffer_;
}; 
```

您的每个*数据包*类都有一个方法可以序列化为 a`ByteBuffer`或从 a`ByteBuffer`和偏移量反序列化。这是我绝对希望我能回到过去并纠正的事情之一。我无法计算由于忘记交换字节或未打包`struct`.

要避免的另一个陷阱是使用 a`union`表示字节或`memcpy`使用无符号字符缓冲区提取字节。如果您总是在线上使用 Big-Endian，那么您可以使用简单的代码将字节写入缓冲区，而不必担心这些`htonl`东西：

```
void ByteBuffer::encode8Bits(uint8_t n) {
    buffer_.push_back(n);
}
void ByteBuffer::encode16Bits(uint16_t n) {
    encode8Bits(uint8_t((n & 0xff00) >> 8));
    encode8Bits(uint8_t((n & 0x00ff)     ));
}
void ByteBuffer::encode32Bits(uint32_t n) {
    encode16Bits(uint16_t((n & 0xffff0000) >> 16));
    encode16Bits(uint16_t((n & 0x0000ffff)      ));
}
void ByteBuffer::encode64Bits(uint64_t n) {
    encode32Bits(uint32_t((n & 0xffffffff00000000) >> 32));
    encode32Bits(uint32_t((n & 0x00000000ffffffff)      ));
} 
```

这仍然很好地与平台无关，因为数字表示在逻辑上始终是 Big-Endian。这段代码也非常适合使用基于原始类型大小的模板（想想`encode<sizeof(val)>((unsigned char const*)&val)`）......不是那么漂亮，但非常非常容易编写和维护。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T20:05:59.130

我的经验是首选以下方法（按优先顺序）：

1.  使用高级框架，如 Tibco、CORBA、DCOM 或任何可以为您管理所有这些问题的框架。

2.  在连接的两端编写自己的库，这些库都知道打包、字节顺序和其他问题。

3.  仅使用字符串数据进行通信。

尝试在没有任何中介的情况下发送原始二进制数据几乎肯定会导致很多问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T20:08:56.783

如果您想要任何形式的可移植性，您实际上不能为此使用类或结构。在您的示例中，整数可能是 32 位或 64 位，具体取决于您的系统。您很可能使用的是小端机器，但较旧的 Apple mac 是大端机器。编译器也可以随意填充。

通常，在确保使用 n2hll、n2hl 或 n2hs 获得正确的字节顺序之后，您需要一种将每个字段一次写入缓冲区的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-15T21:58:03.587

如果结构中没有自然对齐，编译器通常会插入填充以使对齐正确。但是，如果您使用编译指示来“打包”结构（删除填充），则可能会产生非常有害的副作用。在 PowerPC 上，未对齐的浮点数会产生异常。如果您正在使用不处理该异常的嵌入式系统，您将获得重置。如果有*一个*例程来处理该中断，它可能会*大大*减慢您的代码，因为它将使用软件例程来解决未对齐问题，这会默默地削弱您的性能。

# iphone - 使用 ASP.NET MVC 的 iPhone 友好型网站

> ID：753444
> 
> 赞同：3
> 
> 时间：2009-04-15T19:59:42.687
> 
> 标签：iphone, iphone-web-app

是否有任何关于如何制作 iPhone 友好的 Web 应用程序的资源或指导？

具体就我而言，我想使用 ASP.NET MVC，但由于这一切都在服务器上运行，我知道这将归结为标记/css/javascript 考虑因素。

*编辑：*当我发现这里没有提到的其他资源时，我将更新问题文本:-)

*   [为 iPhone 设计的 CSS-Tricks ScreenCast](http://css-tricks.com/video-screencasts/38-basics-tips-on-designing-for-the-iphone/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T23:49:29.093

*   [Sitepoint 上](http://www.sitepoint.com/article/iphone-development-12-tips/)有一篇关于 iPhone 的文章（它有用地向您展示了如何在 iPhone 上定位样式表，同时将它们隐藏在 Internet Explorer 中——Apple 的文档没有这样做）。

*   克雷格·霍肯伯里 (Craig Hockenberry)在 A List Apart 中写了[把你的内容放在我的口袋里。](http://www.alistapart.com/articles/putyourcontentinmypocket)

*   一位 Flickr 开发人员发布了一些经验教训：[http ://code.flickr.com/blog/2008/10/27/lessons-learned-while-building-an-iphone-site/](http://code.flickr.com/blog/2008/10/27/lessons-learned-while-building-an-iphone-site/)

*   对于 Boot To The Head 提到的 Apple 文档的 +1 ——马的嘴和所有这些：它们在整洁的 CSS 属性上提供了非常全面的东西，这些属性只有 Safari 才能真正支持，例如[CSS 动画](http://webkit.org/blog/138/css-animation/)和[CSS 过渡](http://ejohn.org/blog/css-animations-and-javascript/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T20:12:04.730

Scot Hanselman 在 Mix 09 上做了精彩的演讲。点击这里[链接](http://www.hanselman.com/blog/MixMobileWebSitesWithASPNETMVCAndTheMobileBrowserDefinitionFile.aspx)。

另请查看 Mobile Device Browser File=> [LINK](http://mdbf.codeplex.com/)。它在 codeplex 是开源的。

“什么是移动设备浏览器定义文件？

移动设备浏览器定义文件包含单个移动设备和浏览器的功能定义。在运行时，ASP.NET 使用此 .browser 文件以及 HTTP 请求标头中的信息来确定发出请求的设备/浏览器的类型以及该设备的功能。此信息通过 Request.Browser 属性向开发人员公开，并允许他们定制网页的呈现方式以适应目标设备的功能。” - Codeplex

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T23:07:13.173

权威资源是 Apple 的[Safari 开发中心](https://developer.apple.com/safari/mobile.php)。

# c# - subQuery 中的 LINQ-to-SQL 和扩展方法

> ID：753453
> 
> 赞同：3
> 
> 时间：2009-04-15T20:00:51.280
> 
> 标签：c#, linq, linq-to-sql, extension-methods

我的扩展方法是：

```
public static IEnumerable<T> FilterCultureSubQuery<T>(this Table<T> t)
    where T : class
    {
      return t;
    } 
```

我试图在这个查询中使用它

```
var test = from p in t.Products
             select new
             {
               Allo = p,
               Allo2 = (from pl in t.ProductLocales.FilterCultureSubQuery()
                        select pl)
             }; 
```

我的方法扩展的签名应该是什么？我总是收到这个错误：

```
方法 'System.Collections.Generic.IEnumerable`1[ProductLocale] FilterCultureSubQuery[ProductLocale](System.Data.Linq.Table`1[ProductLocale])' 不支持对 SQL 的转换。

```

我也试过这个签名：

```
public static IQueryable<T> FilterCultureSubQuery<T>(this Table<T> t)
    where T : class
    {
      return t;
    } 
```

我得到了这个错误：

```
方法 'System.Linq.IQueryable`1[ProductLocale] FilterCultureSubQuery[ProductLocale](System.Data.Linq.Table`1[ProductLocale])' 不支持对 SQL 的转换。

```

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T20:10:30.740

您的方法的签名很好。问题是，如前所述，它“没有支持的 SQL 转换”。

LINQ 正在尝试将该语句转换为将发送到数据库的 SQL 行。该方法没有翻译。

我建议使用 Where 子句重写过滤器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T20:12:28.803

您的 Extension 方法没有任何问题。

您收到该异常是因为您尝试在 LINQ-To-SQL 查询中使用自定义方法，并且 LINQ-To-SQL 不知道您的方法的 SQL 转换。因此它无法从您的 LINQ 表达式构造 SQL 查询。

解决方案是首先获取数据，然后应用您的转换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T20:32:25.760

当我在一个简单的查询中使用我的扩展方法时，它可以工作，但是当我在子查询中使用它时，它就不起作用了。有什么解决办法吗？

在职的

```
var test = from pl in t.ProductLocales.FilterCultureSubQuery()  select pl; 
```

不工作

```
var test = from p in t.Products
           select new
           {
             Allo = p,
             Allo2 = (from pl in t.ProductLocales.FilterCultureSubQuery()
                      select pl)
           }; 
```

我创建了一个新的扩展方法并重写了查询的表达式树。

```
var test = (from p in t.Products
               select new
               {
                 Allo = p,
                 Allo2 = (from pl in t.ProductLocales.FilterCultureSubQuery()
                          select pl)
               }).ArrangeExpression(); 
```

LINQ-TO-SQL 难以在子查询中使用扩展方法。使用重写表达式扩展方法，一切正常。

还有其他解决方案吗？

# asp.net - FormView ConvertEmptyStringToNull 和绑定

> ID：753455
> 
> 赞同：5
> 
> 时间：2009-04-15T20:00:54.273
> 
> 标签：asp.net, data-binding, .net-3.5, objectdatasource, formview

我正在使用带有 ObjectDataSource 的 FormView 并使用 <%# Bind("WhateverProp") %> 进行绑定 - 我的所有可为空的列都返回了其中类型的默认值。

看起来 FormView 对象没有像其他绑定容器那样的 ConvertEmtpyStringToNull 属性。我发现文章表明这​​是 VS 2005 / .Net 2.0 中的一个错误 - 但没有看到任何说明解决方案是什么。

有没有人对我如何解决这个问题有任何建议，而无需重新捕获 ODS_Inserting 事件中的所有字段？我宁愿不必编写代码来重新绑定表单上的所有绑定字段，只是为了测试空值。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-09-25T19:42:04.910

也为此苦苦挣扎。对于下拉列表，我这样做：

```
AppendDataBoundItems="true"

<asp:ListItem Text="" Value=""></asp:ListItem> 
```

对于我的 ObjectDataSource，即使我的 UpdateMethod 采用单个参数实体，我也为实体的每个 Nullable 字段添加更新参数并转换为 NULL

```
<UpdateParameters>
    <asp:Parameter Name="No_Empl_Ferme" Type="Int32" ConvertEmptyStringToNull="true" />
</UpdateParameters> 
```

我对插入做同样的事情。

工作正常。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T13:37:49.813

我最终这样做了——一种霰弹枪的方法，但在这种情况下，我*所有*的空字符串值都应该是空值。我还考虑在代码中使用字符串数组来指定哪些值应该为空 - 然后可以循环遍历字符串数组而不是遍历所有值。

```
protected void RequestItemFormView_ItemInserting(object sender, FormViewInsertEventArgs e)
{
    for (int i = 0; i < e.Values.Count - 1; i++)
    {
        if (e.Values[i].ToString() == string.Empty)
        {
            e.Values[i] = null;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T15:34:09.567

在您的对象数据源中，您需要使用属性 ConvertEmtpyStringToNull="True" 为每个可为空的类型添加 InsertParameters ：

```
<InsertParameters>
   <asp:Parameter Name="NullableFieldName" Type="Int32" ConvertEmptyStringToNull="true"  />            
</InsertParameters> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-02T12:29:32.533

Quote: Tonio - 我没有使用单独的参数，而是使用 DataObjectTypeName。我的 insert 方法采用单个参数，这就是我想要保存回数据库的业务对象。——斯科特·艾维 5 月 1 日 12:57

我已经这样修复它：

```
 protected void FormViewSettings_ItemUpdating(object sender, FormViewUpdateEventArgs e)
  {
     OrderedDictionary values = e.NewValues as OrderedDictionary;

     var personID = values["PersonID"];

     if (string.IsNullOrEmpty(personID.ToString()))
     {
        values.Remove("PersonID");
        values.Add("PersonID", null);
     }
  } 
```

这是一个小技巧，但它工作正常。这样，您可以将对象属性设置为 null 而不是 string.empty，而无需使用 ConvertEmptyStringToNull 设置。

# emacs - Emacs：获得可读的键盘宏

> ID：753459
> 
> 赞同：14
> 
> 时间：2009-04-15T20:01:40.700
> 
> 标签：emacs, keyboard, macros, lisp

使用`insert-kbd-macro`保存命名键盘宏时，我得到“不可读”的 Lisp 代码，例如

```
(fset 'ppsql
   (lambda (&optional arg) "Keyboard macro." (interactive "p") (kmacro-exec-ring-item (quote ([134217788 134217765 44 return 44 17 10 return 33 134217765 102 102 backspace 114 111 109 return 17 10 102 111 109 backspace backspace 114 111 return 33] 0 "%d")) arg))) 
```

我宁愿有以下内容：

```
(fset 'move-line-down
      [?\C-a ?\C-k delete down ?\C-y return up]) 
```

IIRC 我使用相同的方法来记录、命名和插入两个键盘宏：`F3`, `F4`, `name-last-kbd-macro`.

是否可以获得可读格式的第一个宏？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-16T05:48:18.373

Emacs 中的键盘宏功能有两种模式：`macros`和`kmacros`. 前者以您喜欢的方式（符号形式）返回宏，后者提供 lambda 形式。所以，如果你调用，`name-last-kbd-macro`你会得到一个符号形式，如果你调用`kmacro-name-last-macro`，你会得到一个 lambda 形式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T18:07:35.137

感谢那！

那么宏的**命名决定了****插入**时的格式？

我进行了更多实验，并注意到这`M-x insert-kbd-macro RET RET`会给我“符号形式”。

而`M-x insert-kbd-macro RET pp2sql RET`给出“labmda-form”（用 命名后`name-last-kbd-macro`）。

现在我意识到我`name-last-kbd-macro`在之前的实验中一直使用的方式......？

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-04-15T20:58:27.053

我从未见过第一种形式。第二种形式是我习惯的。您是否尝试重新录制第一个宏以查看如果您确定录制，然后命名，然后插入会发生什么？

要尝试的另一件事是“CX（”，它调用 kmacro-start-macro 和“CX）” kmacro-end-macro，而不是 F3/F4，它们在保持计数器方面做一些无关紧要的事情。也许更简单的键盘宏命令会更直接地工作。

# domain-driven-design - 代码或查找表的最佳实践

> ID：753460
> 
> 赞同：3
> 
> 时间：2009-04-15T20:02:06.377
> 
> 标签：domain-driven-design, lookup, dbtable

[更新]选择的方法如下，作为对这个问题的回应

你好，

我一直在寻找这个主题，但我真的找不到我要找的东西...

对于代码表，我的意思是：诸如“婚姻状况”、性别、特定法律或社会状态之类的东西……更具体地说，这些类型只有设置属性，并且项目不会很快改变（但可以）。属性是 ID、名称和描述。

我想知道如何在以下技术中最好地处理这些：

*   在数据库中（多个表，一个具有不同代码键的表......？）

*   创建类（可能类似于使用 ICode.Name 和 ICode.Description 继承 ICode）

*   为此创建视图/演示者：应该有一个包含所有这些的屏幕，因此是类型列表（性别，婚姻状况......），然后是该类型的值列表，每个值都有名称和描述值列表中的项目。

这些是每个项目中都会出现的东西，所以必须有一些关于如何处理这些的最佳实践......

作为记录，我不太喜欢在这些情况下使用枚举......也欢迎在这里使用它们的任何论点。

[跟进]

好的，我得到了 CodeToGlory 和 Ahsteele 的一个很好的回答。让我们细化这个问题。

假设我们不是在谈论性别或婚姻状况，其价值肯定不会改变，而是关于具有名称和描述的“东西”，仅此而已。例如：社会地位、法律地位。

UI：我只想要一个屏幕。具有可能的 NameAndDescription 类型的列表框（我将称之为），具有所选 NameAndDescription 类型的可能值的列表框，然后是所选 NameAndDescription 类型项目的名称和描述字段。

在 View & Presenters 中如何处理？我在这里发现 NameAndDescription 类型需要从类名中提取的困难？

DB：多个查找表与单个查找表的优缺点是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T20:31:16.260

使用数据库驱动的代码表非常有用。你可以做一些事情，比如定义数据的生命周期（使用开始和结束日期），实时将数据添加到表中，这样你就不必部署代码，你可以允许用户（当然有正确的权限）通过管理屏幕添加数据。

我建议始终使用自动编号主键而不是代码或描述。这允许您在不同的时间段内使用多个代码（名称相同但描述不同）。另外，大多数 DBA（根据我的经验）宁愿使用自动编号而不是基于文本的主键。

我会为每个编码列表使用一个表。您可以将多个代码全部放入一个不相关的表中（使用某种矩阵），但这会变得混乱，我只发现了一些甚至有用的情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:19:37.910

这里有几件事：

1.  使用明确且不会更改的枚举。例如，婚姻状况、性别等。

2.  对上述未固定且可能随时间变化、增加/减少的项目使用查找表。

在数据库中有查找表是非常典型的。在您的业务层中定义一个可以与您的视图/演示文稿一起使用的键/值对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T22:55:54.650

我决定采用这种方法：

```
CodeKeyManager mgr = new CodeKeyManager();
CodeKey maritalStatuses = mgr.ReadByCodeName(Code.MaritalStatus); 
```

在哪里：

*   CodeKeyManager 可以从 DB 中检索 CodeKeys (CodeKey=MaritalStatus)
*   Code 是一个用常量填充的类，返回字符串所以 Code.MaritalStatus = "maritalStatus"。这些常量映射到 CodeKey 表 > CodeKeyName
*   在数据库中，我有 2 个表：
    *   带有 ID、CodeKeyName 的 CodeKey
    *   带有 CodeKeyId、ValueName、ValueDescription 的 CodeValue

D B：

[替代文字 http://lh3.ggpht.com/_cNmigBr3EkA/SeZnmHcgHZI/AAAAAAAAAFU/2OTzmtMNqFw/codetables_1.JPG](http://lh3.ggpht.com/_cNmigBr3EkA/SeZnmHcgHZI/AAAAAAAAAFU/2OTzmtMNqFw/codetables_1.JPG)

班级代码：

```
public class Code
{
    public const string Gender = "gender";
    public const string MaritalStatus = "maritalStatus";
} 
```

类代码键：

```
public class CodeKey
{
    public Guid Id { get; set; }
    public string CodeName { get; set; }

    public IList<CodeValue> CodeValues { get; set; }
} 
```

类代码值：

```
public class CodeValue
{
    public Guid Id { get; set; }

    public CodeKey Code { get; set; }

    public string Name { get; set; }
    public string Description { get; set; }

} 
```

我发现迄今为止最简单和最有效的方法：

*   所有代码数据都可以以相同的方式显示（在同一个视图/演示者中）
*   我不需要为即将到来的每个代码表创建表和类
*   但我仍然可以轻松地将它们从数据库中取出，并通过 CodeKey 常量轻松使用它们......
*   NHibernate 也可以轻松处理这个问题

我仍在考虑的唯一一件事是丢弃 GUID Id 并使用字符串 (nchar) 代码来提高业务逻辑的可用性。

感谢您的回答！如果对此方法有任何意见，请做！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T20:24:05.157

我倾向于对这种类型的数据使用表格表示。最终，如果您需要捕获数据，您将需要存储它。出于报告目的，最好有一个可以通过密钥从中提取数据的地方。出于规范化目的，我发现单用途查找表比多用途查找表更容易。

也就是说，枚举对于不会改变的事物（例如性别等）非常有效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-05T04:49:51.230

为什么大家都想把码表复杂化？是的，它们有很多，但它们很简单，所以保持这种方式。就像对待其他物体一样对待它们。你是领域的一部分，所以将它们建模为领域的一部分，没什么特别的。如果您在他们不可避免地需要更多属性或功能时不这样做，您将不得不撤消当前使用它的所有代码并重新编写它。

当然每个表（为了参考完整性，以便它们可用于报告）。

对于课程，当然还有一个，因为如果我编写一个方法来接收“性别”对象，我不希望能够不小心将它传递给“MarritalStatus”！让编译帮助您清除运行时错误，这就是它存在的原因。每个类都可以简单地继承或包含一个 CodeTable 类或其他任何东西，但这只是一个实现助手。

对于 UI，如果它确实使用继承的 CodeTable，我想您可以使用它来帮助您并在一个 UI 中维护它。

作为一项规则，不要搞乱数据库模型，不要搞乱业务模型，但你不想在 UI 模型中搞砸一点，这还不错。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-12-09T20:49:43.047

我想考虑进一步简化这种方法。而不是定义代码（代码、代码键和代码值）的 3 个表，而只有一个包含代码类型和代码值的表呢？毕竟所有代码类型只是另一个代码列表。

也许像这样的表定义：

```
CREATE TABLE [dbo].[Code](
    [CodeType] [int] NOT NULL,
    [Code] [int] NOT NULL,
    [CodeDescription] [nvarchar](40) NOT NULL,
    [CodeAbreviation] [nvarchar](10) NULL,
    [DateEffective] [datetime] NULL,
    [DateExpired] [datetime] NULL,
CONSTRAINT [PK_Code] PRIMARY KEY CLUSTERED 
(
    [CodeType] ASC,
    [Code] ASC
)
GO 
```

可能存在 CodeType=0, Code=0 的根记录，它表示 CodeType 的类型。所有 CodeType 记录的 CodeType=0 和 Code>=1。以下是一些可能有助于澄清事情的示例数据：

```
SELECT CodeType, Code, Description FROM Code

Results:

CodeType    Code    Description
--------    ----    -----------
0           0       Type
0           1       Gender
0           2       Hair Color
1           1       Male
1           2       Female
2           1       Blonde
2           2       Brunette
2           3       Redhead 
```

可以将检查约束添加到 Code 表中，以确保将有效的 CodeType 输入到表中：

```
ALTER TABLE [dbo].[Code] WITH CHECK ADD CONSTRAINT [CK_Code_CodeType]   
CHECK (([dbo].[IsValidCodeType]([CodeType])=(1)))
GO 
```

函数 IsValidCodeType 可以这样定义：

```
CREATE FUNCTION [dbo].[IsValidCodeType]
(
    @Code INT
)
RETURNS BIT
AS
BEGIN
    DECLARE @Result BIT
    IF EXISTS(SELECT * FROM dbo.Code WHERE CodeType = 0 AND Code = @Code)
        SET @Result = 1
    ELSE
        SET @Result = 0
    RETURN @Result
END
GO 
```

提出的一个问题是如何确保具有代码列的表具有该代码类型的正确值。这也可以通过使用函数的检查约束来强制执行。

这是一个 Person 表，它有一个性别列。最好的做法是使用代码类型的描述（在本例中为性别）后跟代码一词来命名所有代码列：

```
CREATE TABLE [dbo].[Person](   
    [PersonID] [int] IDENTITY(1,1) NOT NULL,
    [LastName] [nvarchar](40) NULL,
    [FirstName] [nvarchar](40) NULL,
    [GenderCode] [int] NULL,
CONSTRAINT [PK_Person] PRIMARY KEY CLUSTERED ([PersonID] ASC)
GO

ALTER TABLE [dbo].[Person] WITH CHECK ADD CONSTRAINT [CK_Person_GenderCode] 
CHECK (([dbo].[IsValidCode]('Gender',[Gendercode])=(1)))
GO 
```

IsValidCode 可以这样定义：

```
CREATE FUNCTION [dbo].[IsValidCode]
(
    @CodeTypeDescription NVARCHAR(40),
    @Code INT
)
RETURNS BIT
AS
BEGIN
    DECLARE @CodeType INT
    DECLARE @Result BIT

    SELECT @CodeType = Code
    FROM dbo.Code
    WHERE CodeType = 0 AND CodeDescription = @CodeTypeDescription

    IF (@CodeType IS NULL)
    BEGIN
        SET @Result = 0
    END
    ELSE
    BEGiN
    IF EXISTS(SELECT * FROM dbo.Code WHERE CodeType = @CodeType AND Code = @Code)
        SET @Result = 1
    ELSE
        SET @Result = 0
    END

    RETURN @Result
END
GO 
```

当查询具有代码列的表时，可以创建另一个函数来提供代码描述。以下是查询 Person 表的示例：

```
SELECT PersonID,
    LastName,
    FirstName,
    GetCodeDescription('Gender',GenderCode) AS Gender
FROM Person 
```

这都是从防止数据库中查找表的泛滥并提供一个查找表的角度考虑的。我不知道这种设计在实践中是否会表现良好。

# performance - 关于从方法/函数返回的性能/风格问题

> ID：753473
> 
> 赞同：1
> 
> 时间：2009-04-15T20:05:14.157
> 
> 标签：performance, language-agnostic, coding-style

我在我正在处理的项目中发现了一些这样的代码

```
public SqlDataReader SomeMethod(int someParam)
{
      // ... some code goes here
      SqlDataReader dataReader = m_command.ExecuteReader(CommandBehavior.CloseConnection);
      return dataReader;
} 
```

我想知道哪个更好，原始的或以下

```
public SqlDataReader SomeMethod(int someParam)
{
      // ... some code goes here
      return  m_command.ExecuteReader(CommandBehavior.CloseConnection);
} 
```

与仅返回创建的阅读器相比，创建变量然后返回它有什么好处吗？我认为没有，因为它只是一个参考。我给出的例子是我发现的，但它可以是任何变量类型。我能想到的一件事是在调试期间，查看变量中的内容可能会很好。

有人愿意贡献他们的 2 美分吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T20:07:20.703

调试可能是最好的理由。使用第一种方法，在返回之前检查是否`dataReader`是更容易。`null`

正如您所说，确实不应该有性能差异。如果经常调用此方法，JIT 编译器（如果启用）很可能会优化掉局部变量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:12:26.603

任何半体面的编译器都会优化第一个示例，以便不需要将 dataReader 存储在临时变量中。换句话说，两个示例应该具有完全相同的效率。

就个人而言，我更喜欢第二个（较短的）示例，因为将该行分成两行根本不会简化阅读。

# sqlite - SQLite - 范围内的值

> ID：753474
> 
> 赞同：0
> 
> 时间：2009-04-15T20:05:44.060
> 
> 标签：sqlite

我正在使用以下语句更新我的表：

```
UPDATE table SET percentage = percentage + ? WHERE id = ? 
```

传递给数据库的值也可能是正数和负数。

有没有办法确保百分比值在 0..100 范围内？希望仅使用 SQLite 来完成它。

如果它小于 0，我想将其设为 0；如果超过100，我想把它变成100。

我可以通过我的 C 代码完成，但最好通过 SQLite 完成。

先感谢您。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T20:08:14.413

```
UPDATE table SET percentage 
= case when percentage < 0 then 0 
  when percentage > 100 then 100 
  else percentage end
WHERE id = ?; 
```

如果您不使用该`where`子句，您将为整个表设置百分比，这可能是您想要的。

但是，大于 100 或小于零的百分比可能是合法的；我不知道你的问题域。

# sifr - sIFR 和 javascript 事件

> ID：753484
> 
> 赞同：0
> 
> 时间：2009-04-15T20:08:15.660
> 
> 标签：sifr

我在使用 sIFR 和 javascript 时遇到了一些麻烦：

[http://veda.onenw.org:8081/yes/yes/](http://veda.onenw.org:8081/yes/yes/)（本地实例）

如果您查看在两个图像之间循环的顶部蓝色特征框，您会看到“特征”一词采用 sIFR 样式，然后在触发 javascript 事件时丢失它。

有没有办法让 sIFR 与 Javascript 配合得很好？谢谢， - 吠陀

PS，这是来自 Joyent 论坛的副本。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T22:04:59.567

该示例当前已关闭，但我怀疑循环图像会更改包含“精选”的 HTML。听起来这会将其重置为 pre-sIFR 状态，因此`sIFR.replace()`再次运行调用以重新替换文本。

# c - 如何使用 C 中的系统调用创建 linux 等效的“nl”命令？

> ID：753491
> 
> 赞同：-2
> 
> 时间：2009-04-15T20:09:56.530
> 
> 标签：c, linux, system-calls

我有一个练习要做，我需要用 C 编写代码，命令相当于**cat**和**nl**，只使用系统调用。给我们的系统调用是 open()、close()、read() 和 write()。

我已经完成了等效的“cat”，它似乎运行良好，现在我需要做“nl”，但我无法逐行编写。

**这个想法是使用尽可能少的系统调用。**

我知道我需要在缓冲区中找到“\n”，我可以做一段时间循环遍历缓冲区并找到“\n”位置（我们称之为 X），然后将 X 个字节写入标准输出。

但是循环遍历缓冲区中的所有字符以搜索行尾对我来说感觉不对，但我不知道我还能怎么做......

**重要编辑：**
我认为你们中的一些人错过了我的问题的重点......我不需要解释如何做到这一点，这不是我的问题。我知道该怎么做（或者有一个很好的主意，我只是还没有尝试过）。“问题”是，逐个字符地遍历缓冲区、文件或其他内容以查找行尾（无论如何）是不*正确的。*我并不是说这不是答案，或者我不允许这样做那样做，我只是在谈论我的想法。这样做似乎是一种奇怪的方式，仅此而已......但如果是这样的话，那就是我问题的答案。

我感谢大家的帮助:)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-15T20:35:27.640

您将不得不在缓冲区中搜索`\n`，没有办法绕过它。不用担心性能，节目大部分时间都在`read`和`write`。

此外，请确保缓冲区足够大。不要打电话`read(file,&c,1)`，因为它会非常慢。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T20:32:46.913

找到“\n”的唯一方法是搜索它。如果您不能使用`strchr(3)`，则必须遍历缓冲区以找到您要查找的内容（阅读：实现它）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T20:18:40.160

一个非常粗略的大纲：

*   您可以替换`getc(file)`为`read(file,&c,1)`：只需编写一个接受文件作为参数并返回一个字符的函数。将字符读入本地变量并返回。

*   然后实现一个`getline(file)`：创建一个缓冲区，开始一次一个地读取字符，当你到达时停止`'\n'`（如果你用完了空间你会怎么做？），并返回一个指向缓冲区的指针（你如何分配缓冲这个工作？）。

*   用你`getline`一次读一行，然后写下行号和行。

*   循环直到文件用完...

* * *

减少系统调用：

一口气将整个文件读入一个大缓冲区——如果你有文件大小，这很容易——一次走一个字符来找到行的开始和结束（使用两个指针）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T20:20:37.910

如果您事先不知道行的长度，则没有找到 \n 位置的捷径。也就是说，除非您使用易于实现的函数来分割行，但这可能只会在某个地方做同样的事情。

也就是说，是的，您必须遍历字符:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T20:28:40.433

您实际上不需要知道 的位置`'\n'`来对行进行编号。您只需打印出行号（从 1 开始），然后读取字符，直到您点击换行符`'\n`'。使用 将每个字符复制回标准输出`write()`，如果该字符是换行符，则增加当前行数并将其打印出来。

# ruby-on-rails - Rails 应用程序/网络服务器基准测试

> ID：753492
> 
> 赞同：3
> 
> 时间：2009-04-15T20:09:59.930
> 
> 标签：ruby-on-rails, web-applications, benchmarking

有谁知道最好的轻量级 Rails 基准测试工具？

我需要获取网络服务器的性能统计数据并模拟每个会话的身份验证 + 页面导航。我一直在尝试使用 httperf，但在应用程序中遇到 TamperingWithCookie 异常。

理想情况下，我想将应用程序和数据库与网络服务器基准测试分开，但有兴趣查看这些组合的结果。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-16T13:33:40.603

您可以尝试使用 Erlang 编写的分布式负载测试工具[Tsung 。](http://tsung.erlang-projects.org/)它是一个通用工具，但可以很容易地与 Rails 应用程序一起使用。如果您需要模拟不同的用户行为场景作为一种集成测试，您也可以尝试[Webrat](http://github.com/brynary/webrat/tree/master)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T15:47:23.873

ruby-prof 可以很好地工作，您可以通过浏览器手动点击您的应用程序，或者它可以针对测试进行基准测试。

这是一篇关于如何使用它的精彩文章：http: [//cfis.savagexi.com/2007/07/18/making-rails-go-vroom](http://cfis.savagexi.com/2007/07/18/making-rails-go-vroom)

在这里你可以下载它：[http ://rubyforge.org/projects/ruby-prof/](http://rubyforge.org/projects/ruby-prof/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:13:03.957

It's not the best way, but using a web stress tool like [MS WAS](http://www.microsoft.com/downloads/details.aspx?FamilyID=e2c0585a-062a-439e-a67d-75a89aa36495) has worked in the past to show simple benchmarks.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-16T17:35:35.400

`ab` is an Apache tool for benchmarking. Probably won't take care of authentication for you but is dead-simple to use:

`ab -n 300 -c 20 http://website.com`

# exchange-server - Exchange 2007 主类别列表

> ID：753497
> 
> 赞同：2
> 
> 时间：2009-04-15T20:11:46.557
> 
> 标签：exchange-server, exchange-server-2007

我们正在构建一个将与 Exchange 2007 日历功能交互的应用程序。我们将使用 Outlook Redemption Objects dll。我们的设计依赖于 Outlook 2007 会议类别功能。我们希望确保特定邮箱具有一组标准的类别名称和颜色。

我们不能依赖用户来设置这些。我们也不能依赖运行交换客户端的用户，许多用户将在 MAC 上使用 OWA 来管理他们的日历。据我了解，主类别列表存储在每个用户邮箱中名为 IPM.Configuration.CategoryList 的隐藏消息中。我还没有找到任何关于如何设置它的参考。

我发现对我们有帮助的唯一事情是：

*   组策略对象：[http](http://technet.microsoft.com/en-us/library/cc179073.aspx) ://technet.microsoft.com/en-us/library/cc179073.aspx 据我了解，它不会管理颜色并依赖于交换客户端。
*   第三方工具 - [http://www.vboffice.net/product.html?id=2006063&cmd=detail&lang=en&pub=6](http://www.vboffice.net/product.html?id=2006063&cmd=detail&lang=en&pub=6) 企业版似乎可以满足我们的需求，但每个邮箱操作一次在 100 左右的成本很高邮箱。

基本上，我们首选的解决方案是能够生成一个接受邮箱名称并设置标准主类别列表的脚本。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T19:58:31.007

我们能够使用[http://gsexdev.blogspot.com/2007/08/adding-categories-to-master-categories.html上的代码完成我们的任务](http://gsexdev.blogspot.com/2007/08/adding-categories-to-master-categories.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T18:45:29.910

AFAIK，邮箱项目的类别存储在本地 Outlook 配置文件中，而不是交换服务器上。在 Ol 2K7 之前，这些存储在注册表中，所以我怀疑是否可以在 E2K7 上设置类别主列表。

# math - 多边形数学

> ID：753503
> 
> 赞同：3
> 
> 时间：2009-04-15T20:12:37.757
> 
> 标签：math, opengl, graphics, 3d

给定一个在 3d 空间中形成一个简单的 2d 多边形的点列表和该多边形的法线，确定哪些点是特定“角”点的好方法是什么？

例如，哪个点在左下角、右下角或最高点？多边形可能以任何 3d 方向定向，所以我很确定我需要对法线做一些事情，但我无法正确计算。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T20:34:26.473

您需要更多信息才能做出该决定。一组（共面）点和法线不足以为您提供“左下”或“右上”或任何此类相对标识的概念。

从法线方向查看多边形（使其显示为简单的 2D 形状）是一个好的开始，但该形状可以旋转到任意角度。

1.  3D 世界中是否有其他信息可用于获取坐标系参考？

2.  你想通过了解形状的极端角落来完成什么？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:15:39.747

您在寻找边界框吗？

我不确定正常情况与您的要求有什么关系。

要获得边界框，请保留 4 个变量：MinX、MaxX、MinY、MaxY

然后遍历所有点，对照 MaxX 和 MinX 检查 X 值，对照 MaxY 和 MinY 检查 Y 值，根据需要更新它们。

循环完成后，您的框定义为 MinX，MinY 为左上角，MinX，MaxY 为右上角，依此类推...

**回复您的评论：**

如果你想要你的盒子在投影后，你需要的是获得“转换”点。然后如上所述应用边界框循环。

转换通常意味着投影（场景渲染）之后的 2D 屏幕坐标，但它也可能意味着您投影到的任何平面上的 2D 点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T20:34:01.683

一种可能的算法是

1.  找到法线，您可以通过使用连接两对不同角的向量的叉积来完成

2.  创建一个变换矩阵来旋转多边形，使其在 XY 空间中是平面的（即沿 Z 轴法线对齐）

3.  计算边界框的坐标或您正在使用的任何其他角定义（因为多边形现在在 2D 空间中对齐，这是一个相当简单的问题）

4.  应用步骤 2 中使用的变换矩阵的逆矩阵将这些坐标变换回 3D 空间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T20:35:59.073

我相信你的问题需要一些额外的信息 - 即任何点都可以被认为是“最上面”或“最左边”的坐标系。

不要忘记，虽然法线告诉您多边形面向的方向，但它本身并不能告诉您“向上”的方向。*可以围绕*法线向量旋转（或“滚动”）并且仍然面向同一方向。

这就是为什么大多数 3D 渲染系统都有一个摄像头，它不仅包含“视图”向量，还包含“上”和“右”向量。对后两者的更改实现了相机围绕视图矢量“滚动”的效果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T20:25:15.793

将其投影到平面上并获得边界框。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-15T21:04:19.007

我有一个愚蠢的想法，但冒着获得负分的风险，我会试一试：

1.  从二维多边形上每个点的每个三维轴获取最小值/最大值。在每个点的值列表上使用循环/迭代器的单遍就足够了，只需随时替换最小值和最大值。最终结果是具有“最低”X、Y、Z 坐标和“最高”X、Y、Z 坐标的列表。
2.  遍历此最小值/最大值列表以创建对象周围“边界框”的每个点（“角”）。结果应该是一个始终包含对象的框，无论检查的轴或方向如何（多边形上的任何点都不会超过您收集的最大值或最小值）。
3.  然后得到每个“二维多边形”点到“边界框”上每个角位置的距离；点之间的距离越短，它离那个“角落”就越“近”。

远非最佳，当然很糟糕，但肯定很快。您可以在对象旋转期间通过简单地查找每个旋转的 x/y/z 值的最小值/最大值并提前保留这些值的列表来对它进行后捕获。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-15T21:58:49.437

如果您可以假设对形状有一些限制，那么您可能能够通过了解更少的信息而侥幸逃脱。例如，如果您的形状是由一个小正方形组成，一侧有一个细长的三角形（即简单的对称几何），那么您可以比较每个列表点到“质心”的距离。最大的距离将标识圆锥的尖端，第二大的将是距离圆锥尖端最远的两个点，依此类推...如果列表中有某种顺序，则点按逆时针顺序输入（大约正常），您可以识别所有点。这听起来像是一些计算，因此尝试在形状中包含一些额外信息可能是合理的，例如“质心”和位于“上方”的参考点 在 COM 上方（但不是沿着法线）。例如，这将为您提供一个“向上”向量，您可以与法线交叉以定义一些身体坐标。此外，法线可以通过点列表的排序来定义。如果您不能对形状做出任何假设（或者即使形状是对称的，例如），那么您将需要更多数据。这取决于你的约束。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-17T08:28:47.243

如果您知道 3D 中的多边形是“平坦的”，您可以使用法线将顶点的所有 3D 点转换为 2D 表示（相对于多边形所在的平面的点） - 但这仍然让你定义这个坐标系的原点（但这对你的问题并不重要）和至少一个轴的方向（如果你想要正交轴，你仍然可以围绕你选择的原点旋转它们) - 这就是麻烦开始的地方。我建议使用您的 3D 坐标系的 Y 轴，将其投影到您的平面上并将结果方向用作“向上” - 但是如果您的计划与 Y 轴正交（现在您可能希望将投影 Z 轴用作“向上”）。

数学相当简单（您可以使用内积（也称为标量积）投影到您的平面，并使用一些矩阵东西转换为 2D 坐标系 - 您可以通过谷歌搜索多边形的光线追踪器算法来获得所有这些。

# c# - Linq To SQL 并拥有

> ID：753509
> 
> 赞同：15
> 
> 时间：2009-04-15T20:14:46.770
> 
> 标签：c#, sql, linq, linq-to-sql, tsql

我对 Linq To SQL 相当陌生，但试图运行应该是一个相当简单的 SQL 查询，但不知道如何让它在 LINQ 中运行良好。

```
SELECT     Users.Id, Users.Id AS Expr1, Users.FirstName, Users.LastName, 
User_x_Territory.UserID
FROM         Users LEFT OUTER JOIN
             User_x_Territory ON User_x_Territory.UserID = Users.Id
GROUP BY Users.Id, Users.Id, Users.FirstName, Users.LastName, User_x_Territory.UserID
HAVING      (COUNT(User_x_Territory.UserID) = 0) 
```

只是试图让所有没有分配区域的用户，判断他们是否有区域的唯一方法是检查 user_x_territory gerrund。

我可以通过以下方式将所有用户从我的数据库中删除：

```
var users = from u in db.Users
            join uXt in db.User_x_Territories on u equals uXt.User into gerr
            from users in gerr.DefaultIfEmpty()
            select users; 
```

但是从那里我无法弄清楚如何通过/必须细化搜索结果以仅显示没有地区的用户来添加组。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-15T20:35:37.967

I suggest the following solution.

```
db.Users.Where(u => u.User_x_Territories.Count == 0) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:25:02.423

我不知道这有多有效（我猜不是很有效），但你可以尝试这样的事情：

```
var users = (from u in db.Users
             join uXt in db.User_x_Territories on u equals uXt.User into gerr
             from users in gerr.DefaultIfEmpty()
             select u).Where(u => u.User_x_Territories.Count == 0); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T20:33:37.050

编辑：嘿，猜猜有人打败了我:(

```
来自 db.Users 中的 t
在新的 { UserID = t.Id } 上将 t0 加入 db.User_x_Territory 等于 new { UserID = t0.UserID } 到 t0_join
从 t0 中的 t0_join.DefaultIfEmpty()
group new {t, t0} by new {
  t.Id,
  Column1 = t.Id,
  t.FirstName,
  t.LastName,
  t0.UserID
} into g
where   g.Count() == 0
select new {
  Id = g.Key.Id,
  Expr1 = g.Key.Id,
  g.Key.FirstName,
  g.Key.LastName,
  UserID = g.Key.UserID
}

```

# javascript - 如何动态加载 Google Analytics JavaScript？

> ID：753514
> 
> 赞同：16
> 
> 时间：2009-04-15T20:16:45.640
> 
> 标签：javascript, performance, google-analytics, tracking, web-traffic

**在不**使用任何其他 JS 框架（dojo、jquery 等）的情况下，**我将如何动态加载 Google Analytic 的 javascript 以用于网页跟踪？**

适合动态加载 JS 的典型做法是执行以下操作：

```
var gaJs = document.createElement("script");
gaJs.type = "text/javascript";
gaJs.src = "http://www.google-analytics.com/ga.js";
document.body.appendChild(gaJs);
var pageTracker = _gat._getTracker("UA-XXXXXXXXX");
pageTracker._initData();
pageTracker._trackPageview(); 
```

**但这不起作用。**

ga.js 文件未及时加载以使**_gat._getTracker**和**_initData/TrackPageview**正常工作。

关于如何正确动态加载 ga.js 的任何想法。

**更新**：似乎有人试图在以下链接中解决此问题。但是，它适用于旧版 Urchin 代码，而不适用于 Google Analytics。

关于如何让它与 ga.js 而不是 urchin.js 一起工作的任何想法？

[http://20y.hu/20070805/loading-google-analytics-dynamically-on-document-load.html](http://20y.hu/20070805/loading-google-analytics-dynamically-on-document-load.html)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2013-02-26T19:03:35.183

您可以使用[HTML5 Boilerplate](http://html5boilerplate.com/)中的这个片段。

```
<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
  var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-11T13:23:46.867

尝试使用 Google 提供的确切 JavaScript 代码，然后根据您的 UI 框架中的构造有条件地显示该代码部分。您没有说明它在哪个平台上运行，如果它是 ASP.NET，您可以将代码放在 PlaceHolder 或 UserControl 中，然后根据配置文件设置将 Visible 设置为 true 或 false（如果应该包含脚本）。我在多个站点上使用了这种方法来防止 Analytics 脚本被包含在预生产环境中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T21:56:05.777

我猜服务器端编程会更容易，但我前段时间发现[了](http://www.phpied.com/javascript-include/)[这一点](http://www.hunlock.com/blogs/Howto_Dynamically_Insert_Javascript_And_CSS) 。请注意，它专门将其设置为.`html head`

还要检查“通过 Ajax 添加 Javascript”的第一个链接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-05T14:26:28.047

```
函数加载GA（）
{
    if(typeof _gat == 'function') //已经加载
    {
        //初始化GA();
        // 你可能希望上面的行取消注释..
        // 我假设如果 _gat 对象存在
        // 你不会想要的。
        返回;
    }
    var 主机名 = 'google-analytics.com';
    var 协议 = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    js = document.createElement('script');
    js.setAttribute('type', 'text/javascript');
    js.setAttribute('src', 协议+主机名+'/ga.js');
    document.body.appendChild(js);
    //2种方法检测ga.js的负载
    //然而，一些浏览器同时使用两者
    加载=假；// 所以使用布尔值
    js.onreadystatechange = 函数 () {
        如果（js.readyState == '已加载'）
        {
            如果（！加载）
            {
                初始GA（）；
            }
            加载=真；
        }
    };
    js.onload = 函数（）
    {
        如果（！加载）
        {           
            初始GA（）；
        }
        加载=真；
    };
}

函数 innitGA()
{
    //var pageTracker = _gat._getTracker('GA_ACCOUNT/PROFILE_ID');
    //pageTracker._initData();
    //pageTracker._trackPageview();
    alert('哦，我可以看 plz 吗？');
}

```

只需调用 loadGA()... 在 IE6/7/8、FF3、Chrome 和 Opera 上测试

抱歉，如果我参加这个聚会有点晚了。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-08-11T10:49:58.977

我实际上只是把一些东西放在一起......使用jquery。诀窍是将加载事件添加到脚本标签中，其中包含跟踪代码。

```
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
var gaScript = document.createElement('script');
var loaded = false;
gaScript.src = gaJsHost + "google-analytics.com/ga.js";

$(gaScript).load(function(){
  loaded = true;
  var pageTracker = _gat._getTracker(Consts.google_analytics_uacct);
  pageTracker._initData();
  pageTracker._trackPageview();
});

document.body.appendChild(gaScript);

// And to make it work in ie7 & 8
gaInterval = setInterval(function() {
  if (!loaded && typeof _gat != 'undefined') {
    $(gaScript).load();
    clearInterval(gaInterval);
  }
},50); 
```

我正在努力解决的问题是......这是谷歌允许的。

# css - 如何以编程方式单击 Facebook 状态上的“喜欢”链接？

> ID：753518
> 
> 赞同：1
> 
> 时间：2009-04-15T20:19:24.357
> 
> 标签：css, facebook

好吧，我担心我可能会因为这不是一个“编程”问题而受到批评，但无论如何我都会问。我在 web 开发类型的东西上做的不多（OO 是我最坚持的），所以我不太热衷于这些 CSS、Javascript、SQL 等到底是如何工作的。

问题：我的朋友已经尝试戒烟一段时间了，但正如许多吸烟者所做的那样，他似乎只能做到这一点。他最近发布了一个状态更新，说如果他有精神上的支持，他可以做到。我只是想创建一个指向“喜欢”按钮的链接。然后我打算写一个脚本和简单的消息他所有的朋友的链接。这可能吗？

任何正确方向的提示将不胜感激。如何做到这一点的解释将是神圣的。对我为什么不能这样做的解释会得到一个皱着眉头的接受和感谢。

对于那些没有 facebook 的人，这里有一些 pastebins。你还需要什么我会尽力提供

我的 facebook.com/homepage 页面来源的 Pastebin：http: [//paste.uni.cc/19860](http://paste.uni.cc/19860)

我看到的他主页的 Pastebin 页面来源： http: [//paste.uni.cc/19860](http://paste.uni.cc/19860)

他更新到 ctrl+F 并查看周围的代码：“如果他有精神上的支持，他会戒烟。”

在我看来，“like”命令的 css 代码 [http://static.ak.fbcdn.net/rsrc.php/z2FUI/l/8fkujrwg/en_US/151675/css/like/like.css](http://static.ak.fbcdn.net/rsrc.php/z2FUI/l/8fkujrwg/en_US/151675/css/like/like.css)

这会阻止他吸烟吗？很可能不会，但它不会受到伤害。在最坏的情况下，他只会笑一笑，也许会觉得更倾向于放下香烟。

一如既往地欣赏它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-15T20:25:40.020

“Like 链接”是一个 Javascript 支持的元素，它调用对服务器的 AJAX 调用。它带有一个唯一的 ID，该 ID 与被“喜欢”的项目和拉下页面的用户（在本例中为您）相隔开，以确保不会意外提交重复的“喜欢”并且 UI 变得不同步数据库；并确保您不能代表其他用户“喜欢”某些内容。您所描述的案例与恶意尝试做同样的事情无关。

您可以向他们发送一条带有朋友页面链接的消息，并告诉他们自己“喜欢”该状态吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:25:22.343

为什么不编写一个 Facebook 应用程序并直接插入您自己的个人资料。您可以邀请他的朋友加入您的应用程序，这将允许他们支持您的朋友尝试戒烟，而无需编写“点击”Like 链接的脚本。黑客很容易被认为是恶意的。

# wpf - 如何在 Windows XP 上获得 WPF 小部件的“本机”外观？

> ID：753526
> 
> 赞同：1
> 
> 时间：2009-04-15T20:20:49.080
> 
> 标签：wpf, windows-xp, themes, native, look-and-feel

我刚刚开始玩WPF。

我注意到，虽然有些小部件会自动获取本机外观和感觉（例如，按钮、菜单），但有些则不会（例如，标签、面板和窗口具有白色背景）。

如何在 WPF 中默认使所有小部件看起来正常？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-19T04:45:40.657

这是在 PresentationFramework.Luna 程序集中定义模板的方式。您可以使用此处的 ShowMeTheTemplate 工具查看所有 6 个 Windows 主题的所有默认模板：[http ://www.sellsbrothers.com/tools/#ShowMeTheTemplate](http://www.sellsbrothers.com/tools/#ShowMeTheTemplate)

-乔恩

# delphi - delphi 的 TMonthCalendar - 禁用按钮

> ID：753528
> 
> 赞同：1
> 
> 时间：2009-04-15T20:21:47.000
> 
> 标签：delphi, user-interface, vcl

是否可以禁用更改 TMonthCalendar 上的日期的按钮（VCL 本机）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T20:35:07.703

日历控件不是本机 Delphi 控件，而是包装的 Windows 标准控件。因此，它只能使用[文档化的界面](http://msdn.microsoft.com/en-us/library/bb760917(VS.85).aspx)来访问。

特别是 Spy++ 显示它是一个单一的窗口，因此调用*EnableWindow()*来禁用导航按钮似乎是不可能的。您可以做的是将 VCL 控件的 MaxDate 和 MinDate 属性设置为有趣月份的第一天和最后一天，这样月份就无法更改。不幸的是，这会在单击按钮时产生烦人的声音。

# javascript - 从 onChange 事件填充 FilteringSelect 数据存储

> ID：753533
> 
> 赞同：2
> 
> 时间：2009-04-15T20:22:43.490
> 
> 标签：javascript, zend-framework, dojo

我正在尝试绑定一个`onChange`事件`FilteringSelect`来填充另一个`FilteringSelect`。

```
// View
dojo.addOnLoad(function () {
    dojo.connect(dijit.byId('filterselect1'), 'onChange', function () {
        dijit.byId('filterselect2').store = new dojo.data.ItemFileReadStore(
            { url: "/test/autocomplete/id/" + dijit.byId("filterselect1").value }
        );
    });
}); 
```

JSON 是根据我可以使用`autoCompleteDojo`帮助程序从 Zend 动作控制器正确判断的内容生成的。

```
// Action Controller
public function autocompleteAction()
{
    $id = $this->getRequest()->getParam('id');
    $select = $this->_table->select()
                           ->from($this->_table, array('id','description'))
                           ->where('id=?',$id);

    $data = new Zend_Dojo_Data('id', $this->_table->fetchAll($select)->toArray(), 'description');

    $this->_helper->autoCompleteDojo($data);
} 
```

我正确地从远程数据存储接收 JSON，但它没有填充第二个`FilteringSelect`. 我还需要做些什么来将 JSON 推送到`FilteringSelect`?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T00:08:58.943

我不敢相信这是导致问题的原因，但整个问题归结为这样一个事实，即 dojo ItemFileReadStore*要求*JSON 的标签属性为“名称”。最后，这就是将它们连接在一起所需的全部内容。

```
dojo.addOnLoad(function () {

    dijit.byId('filtering_select_2').store = new dojo.data.ItemFileReadStore({url: '/site/url'});

    dojo.connect(dijit.byId('filtering_select_1'), 'onChange', function (val) {
        dijit.byId('filtering_select_2').query.property_1 = val || "*";
    });
}); 
```

更新：Zend 形式中的属性自 ZF 1.8.4 起已修复

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T12:24:23.297

在事件中尝试 console.log() 以查看它是否已启动。更改商店应该可以工作，但是对于网格等其他小部件，您还必须调用刷新方法。

# python - 从装饰器访问拥有装饰方法的类

> ID：753537
> 
> 赞同：4
> 
> 时间：2009-04-15T20:23:35.983
> 
> 标签：python, decorator

我正在为必须检查父方法（我正在装饰的类的父级中的同名方法）的方法编写装饰器。

示例（来自[PEP 318](http://www.python.org/dev/peps/pep-0318/#examples "这里")的第四个示例）：

```
def returns(rtype):
    def check_returns(f):
        def new_f(*args, **kwds):
            result = f(*args, **kwds)
            assert isinstance(result, rtype), \
                   "return value %r does not match %s" % (result,rtype)
            return result
        new_f.func_name = f.func_name
        # here I want to reach the class owning the decorated method f,
        # it should give me the class A
        return new_f
    return check_returns

class A(object):
    @returns(int)
    def compute(self, value):
        return value * 3 
```

所以我正在寻找代码来代替**# 这里我想要...**

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-15T20:40:03.387

> 在这里，我想访问拥有装饰方法 f 的类

你不能，因为在装饰的时候，没有类拥有方法 f。

```
class A(object):
    @returns(int)
    def compute(self, value):
        return value * 3 
```

和说的一样：

```
class A(object):
    pass

@returns(int)
def compute(self, value):
    return value*3

A.compute= compute 
```

显然，`returns()`装饰器是在函数分配给所有者类之前构建的。

现在，当您将函数写入类（内联或显式这样）时，它变成了一个未绑定的方法对象。*现在*它有一个对其所有者类的引用，你可以这样说：

```
>>> A.compute.im_class
<class '__main__.A'> 
```

因此，您可以在“new_f”中读取 f.im_class，它在分配之后执行，但不能在装饰器本身中执行。

（即使那样，如果您不需要，依赖 CPython 实现细节也有点难看。我不太确定您要做什么，但是涉及“获取所有者类”的事情通常可以使用元类来实现.)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-15T22:51:32.133

正如[bobince 所说](https://stackoverflow.com/questions/753537/accessing-the-class-that-owns-a-decorated-method-from-the-decorator/753617#753617)，您无法访问周围的类，因为在调用装饰器时，该类还不存在。如果您需要访问类和基础的完整字典，您应该考虑使用[*元类*](http://docs.python.org/dev/reference/datamodel.html?highlight=metaclass#__metaclass__)：

> `__metaclass__`
> 
> 此变量可以是名称、基数和字典的任何可调用接受参数。在创建类时，使用可调用对象而不是内置的 type()。

基本上，我们将`returns`装饰器转换为只是告诉元类在类构造上做一些魔术的东西：

```
class CheckedReturnType(object):
    def __init__(self, meth, rtype):
        self.meth = meth
        self.rtype = rtype

def returns(rtype):
    def _inner(f):
        return CheckedReturnType(f, rtype)
    return _inner

class BaseInspector(type):
    def __new__(mcs, name, bases, dct):
        for obj_name, obj in dct.iteritems():
            if isinstance(obj, CheckedReturnType):
                # do your wrapping & checking here, base classes are in bases
                # reassign to dct
        return type.__new__(mcs, name, bases, dct)

class A(object):
    __metaclass__ = BaseInspector
    @returns(int)
    def compute(self, value):
        return value * 3 
```

请注意，我尚未测试此代码，如果我应该更新此代码，请留下评论。

有一些由强烈推荐的 David Mertz[撰写的关于元类的文章，](http://www.ibm.com/developerworks/linux/library/l-pymeta.html)在这种情况下您可能会发现这些文章很有趣。

# php - 最佳替代异常处理模型

> ID：753542
> 
> 赞同：2
> 
> 时间：2009-04-15T20:24:52.937
> 
> 标签：php, exception

可悲的是，我有一个遗留的 PHP4 系统，我需要不断地向它添加功能。看起来没有资源可以将 PHP5 移植到几个月甚至几年。在过去的几年里，困扰我的主要事情之一就是无法干净地抛出异常。正因为如此，各种错误检查代码不得不不断地中断正在发生的事情的流程。

那么问题来了：在没有异常模型的语言中，您所见过的模拟异常处理的简洁性的最佳策略是什么？

乔尔对答案中提到的异常有这样的说法：

[http://www.joelonsoftware.com/items/2003/10/13.html](http://www.joelonsoftware.com/items/2003/10/13.html)

> 它们为函数创建了太多可能的退出点。要编写正确的代码，您确实必须考虑通过您的函数的所有可能的代码路径。每次调用可能引发异常但没有立即捕获的函数时，都会为突然终止的函数、使数据处于不一致状态或其他代码路径导致的意外错误创造机会想一想。
> 
> 更好的选择是让您的函数在出现问题时返回错误值，并明确处理这些错误值，无论它可能多么冗长。确实，当您进行良好的错误检查时，应该是一个简单的 3 行程序通常会变成 48 行，但这就是生活，并且用异常将其覆盖并不会使您的程序更加健壮。我认为 C/C++/Java 风格语言的程序员被异常所吸引的原因仅仅是因为语法没有简洁的方法来调用返回多个值的函数，因此很难编写一个既能产生返回值的函数值或返回错误。

但是，一种语言中良好的异常模型会使被调用函数指定它实际上会抛出异常。这意味着函数退出的额外位置正好为零（代码只会返回 false 而不是抛出异常），但函数退出的位置正好是 1 个......调用函数。任何人都*可以*编写草率的代码，将所有异常向上传递以供其他人处理，但这并不意味着您*应该*拿走一个可以干净高效地使用的工具。

事实上，任何函数都可以返回一个超出调用代码预期返回值范围的值。一个好的程序员会处理所有可能的返回值，包括错误代码和条件。异常模型只是为他提供了一种干净利落的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T22:03:45.320

首先，有些人认为异常不是正确的错误模型，包括[本网站的创始人之一](http://www.joelonsoftware.com/items/2003/10/13.html)。

其次，是尝试盘点哪些错误处理函数可用于您的 PHP 次要版本。我的直接反应是建议花时间编写一个好的错误处理程序，并[注册它](http://us3.php.net/manual/en/function.set-error-handler.php)。

然后，在您通常会抛出异常的应用程序执行中，您可以改为[触发错误](http://us3.php.net/manual/en/function.trigger-error.php)。如果幸运的话，您将能够使用[debug_backtrace()](http://us3.php.net/debug_backtrace)。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T21:55:55.713

[延续传球风格](http://en.wikipedia.org/wiki/Continuation-passing_style)。事实上，我敢说它在“漂亮”方面击败了例外。融入 PHP 并不是最自然的事情，但您可以使用诸如访问者之类的对象和模式来做到这一点。

但实际上，从 PHP4 升级到 PHP5 不需要超过几个小时的工作 - 它主要是向后兼容的。

# .net - 为什么我看不到为服务器端控件生成的 ID？

> ID：753547
> 
> 赞同：3
> 
> 时间：2009-04-15T20:26:26.367
> 
> 标签：.net, asp.net, javascript, jquery, asp.net-3.5

我现在有点困惑。让我解释：

我见过人们谈论在 asp.net (3.5) 中向页面添加按钮或其他控件，当控件呈现时，它会更改该控件的 Id，例如。Button1 变成 Button1_somethingsomething 阻止他们使用 jQuery，他们最终使用的是诸如`<%controlId.ClientId %>`

所以我做了一个小测试

```
1\. I added a button on the page:
<form id="form1" runat="server">
<div>
<asp:Button ID="Button1" runat="server"  Text="Button" />
<div>

2\. Then I added a JavaScript and jQuery:
<script type="text/javascript">
                    $(document).ready(function() {
                    $("#Button1").click(function() {
                        alert("Hello world!");
                    });

                    });
                </script>

3\. The generated html is this:
<div>
  <input type="submit" name="Button1" value="Button" id="Button1" />
<div> 
```

现在，我没有看到 ASP.NET (asp.net 3.5) 更改了 ID。为什么我会看到不同的行为？

顺便提一句。当我按下按钮时，这确实有效！

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-15T20:29:57.247

ASP.NET 仅在控件位于[命名容器](http://msdn.microsoft.com/en-us/library/system.web.ui.inamingcontainer.aspx)内时更改 ID 。这可能包括某些用户控件、母版页中的 ContentPlaceHolders 和重复控件（Repeater、GridView 等）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:45:02.483

您可能并不总是需要使用 YourControl.ClientID，但这是一种很好的做法，这样当您的控件最终进入容器时，您就不必返回并修复它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T20:31:11.767

默认情况下，ASP.NET 不会更改 ID 名称，但在母版页的 ContentPlaceHolder 中使用它们时会更改它们。所以名称最终会变成类似于 ctl00_ContentPlaceHolderContent_Button1 的名称。在您的情况下，没有母版页，也没有进行任何更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T20:41:48.653

这是由于某些控件（例如用于母版页的 asp:content 控件）实现的 INamingContainer 接口。

来自[MSDN](http://msdn.microsoft.com/en-us/library/system.web.ui.inamingcontainer.aspx)：

> 任何实现此接口的控件都会创建一个新的命名空间，其中所有子控件 ID 属性都保证在整个应用程序中是唯一的。此接口提供的标记允许对支持数据绑定的 Web 服务器控件中动态生成的服务器控件实例进行唯一命名。这些控件包括 Repeater、DataGrid、DataList、CheckBoxList、ChangePassword、LoginView、Menu、SiteMapNodeItem 和 RadioButtonList 控件。

您的示例代码不使用任何这些控件。您不要将母版页与 ContentPlaceHolder 一起使用。您的 ID 不会因此而改变。

# .net - 在辅助显示器上全屏显示

> ID：753552
> 
> 赞同：27
> 
> 时间：2009-04-15T20:27:24.647
> 
> 标签：.net, wpf, windows, fullscreen, multiple-monitors

如何对 dotNet Windows（或 WPF）应用程序进行编程以使其在辅助监视器上全屏显示？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2011-10-09T22:27:17.253

将窗口最大化到辅助监视器（如果有）的扩展方法。不假定辅助监视器是 System.Windows.Forms.Screen.AllScreens[2];

```
using System.Linq;
using System.Windows;

namespace ExtendedControls
{
    static public class WindowExt
    {

        // NB : Best to call this function from the windows Loaded event or after showing the window
        // (otherwise window is just positioned to fill the secondary monitor rather than being maximised).
        public static void MaximizeToSecondaryMonitor(this Window window)
        {
            var secondaryScreen = System.Windows.Forms.Screen.AllScreens.Where(s => !s.Primary).FirstOrDefault();

            if (secondaryScreen != null)
            {
                if (!window.IsLoaded)
                    window.WindowStartupLocation = WindowStartupLocation.Manual;

                var workingArea = secondaryScreen.WorkingArea;
                window.Left = workingArea.Left;
                window.Top = workingArea.Top;
                window.Width = workingArea.Width;
                window.Height = workingArea.Height;
                // If window isn't loaded then maxmizing will result in the window displaying on the primary monitor
                if ( window.IsLoaded )
                    window.WindowState = WindowState.Maximized;
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-04-14T14:40:35.933

对于 WPF 应用程序，请查看[这篇文章](http://mostlytech.blogspot.com/2008/01/maximizing-wpf-window-to-second-monitor.html)。最终它取决于 WindowState 何时设置为最大化。如果您在 XAML 或窗口构造函数中设置它（即在加载窗口之前），它将始终在主显示器上最大化。另一方面，如果在加载窗口时将 WindowState 设置为 Maximized - 它将在之前最大化的屏幕上最大化。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2016-08-04T13:50:58.857

我注意到一个主张在 Loaded 事件中设置位置的答案，但是当窗口首先正常显示然后最大化时，这会导致闪烁。如果您在构造函数中订阅 SourceInitialized 事件并在其中设置位置，它将处理在辅助监视器上最大化而不会闪烁 - 我在这里假设 WPF

```
public MyWindow()
{
    SourceInitialized += MyWindow_SourceInitialized;
}

void MyWindow_SourceInitialized(object sender, EventArgs e)
{
    Left = 100;
    Top = 50;
    Width = 800;
    Height = 600;
    WindowState = WindowState.Maximized;
} 
```

替换辅助显示器上的任何坐标

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-15T20:38:39.083

请参阅[此代码项目文章。](http://www.codeproject.com/KB/cs/FullScreenDotNetApp.aspx)

那里的代码可以工作，但默认为您的主监视器。要更改这一点，您需要将对 GetSystemMetrics 的调用替换为对[GetMonitorInfo](http://msdn.microsoft.com/en-us/library/dd144901(VS.85).aspx)的调用。使用 GetMonitorInfo，您可以获得适当的 RECT 以传递给 SetWindowPos。

GetMonitorInfo 允许您获取任何监视器的 RECT。

有[一篇关于在多显示器设置](http://msdn.microsoft.com/en-us/library/dd162826(VS.85).aspx)中定位应用程序的 MSDN 文章可能有助于更好地解释事情。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-09-07T04:24:04.153

```
private void Form1_Load(object sender, EventArgs e)
{
   this.FormBorderStyle = FormBorderStyle.None;
   this.Bounds = GetSecondaryScreen().Bounds;
}

private Screen GetSecondaryScreen()
{
   foreach (Screen screen in Screen.AllScreens)
   {
      if (screen != Screen.PrimaryScreen)
         return screen;
   }
   return Screen.PrimaryScreen;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-09T05:55:56.920

从您的问题中不清楚您是否正在寻找一种将窗口移动到辅助监视器然后进入全屏的方法，或者您是否只是希望在窗口所在的任何监视器上支持全屏模式（可能是主要或次要的） ）。

如果是后者，对于 WPF 窗口，虽然与全屏模式不太一样，但您可以在最大化时移除边框，在未最大化时恢复边框。无需检查哪个监视器等。标题/标题栏的显示由边框状态控制。

```
 protected override void OnStateChanged(EventArgs e)
    {
        if (WindowState == WindowState.Maximized)
        {
            if (WindowStyle.None != WindowStyle)
                WindowStyle = WindowStyle.None;
        }
        else if (WindowStyle != WindowStyle.SingleBorderWindow)
            WindowStyle = WindowStyle.SingleBorderWindow;

        base.OnStateChanged(e);
    } 
```

感谢 Pavel 在当前问题中的基于表单的回答，以及 Nir ​​在[此问题](https://stackoverflow.com/questions/2175712/enable-maximize-minimize-and-restore-window-in-wpf-manual-resize-is-disable)中的回答。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-04-14T17:20:39.380

在 WPF 中：将 WindowState 属性设置为 Normal（不是 Maximixed）并创建事件 Loaded。在事件中编写此代码：

```
this.Left = SystemParameters.PrimaryScreenWidth + 100;
this.WindowState = System.Windows.WindowState.Maximized; 
```

# algorithm - How to convert UTM coordinates to Latitude and Longitude?

> ID：753560
> 
> 赞同：2
> 
> 时间：2009-04-15T20:29:39.883
> 
> 标签：algorithm, gis, latitude-longitude

### Duplicates:

*   [How do I convert coordinates to a Latitude & Longitude?](https://stackoverflow.com/questions/609379/)
*   [How to convert from UTM to LatLng in python or Javascript2](https://stackoverflow.com/questions/343865/)

My current project is interfacing with a central geocoding service published by the local city planning department. The service is designed primarily for surveying, and as such returns coordinates in a UTM X-Y format. My system stores coordinates as decimal latitude and longitude for integration with Google Earth and other mapping tools.

I'd like to come up with an algorithm for converting from X-Y to latitude and longitude for all cases. I have not been able to locate any texts describing the conversion; the most I've been able to find via Google is raw source code in the form of Excel Visual Basic and FORTRAN. I believe a useful general solution would be beneficial to the community at large.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T20:32:02.483

You need a map projection library to do this.

There are many libraries available that are open source. One of the most complete is [PROJ.4](http://trac.osgeo.org/proj/).

It is wrapped and used internally by many simpler libraries, such as [GDAL](http://gdal.org/).

This will allow you to go from UTM->LatLon (with many options), UTM->State Plane, or from any common projection to any other common projection.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:38:47.820

In Java, I would use the [OpenMap converter](http://openmap.bbn.com/doc/api/com/bbn/openmap/proj/coords/UTMPoint.html#toLatLonPoint()) from a point's expression in UTM to one using Latitude and Longitude (assuming a WGS-84 ellipsoid which is most commonly used in GPS).

OpenMap is open source and I would post a link to their download page but they have a short license script in the way. So, to avoid being rude, I won't deep link. Instead, head to [their homepage](http://openmap.bbn.com/) and [click Downloads](http://openmap.bbn.com/cgi-bin/license.cgi).

That should either solve your problem directly or at least point you towards a useful algorithm.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T21:03:10.803

you could try [http://www.gaia-gis.it/spatialite/](http://www.gaia-gis.it/spatialite/)

# c++ - 模板化命名空间和 typedef 是非法的——解决方法？

> ID：753564
> 
> 赞同：1
> 
> 时间：2009-04-15T20:30:38.243
> 
> 标签：c++, function, templates, namespaces, typedef

我有一个模板函数`fct`，它使用一些基于模板参数的复杂数据结构。它还调用了一些辅助函数（以相同类型为模板），它们位于单独的`helpers`命名空间中并使用相同的复杂数据结构。现在它变得非常丑陋，因为我们无法`typedef`为所有函数都可以访问的复杂类型制作一个：

```
namespace helpers {
  template<class T>
  void h1(const std::vector< std::vector< std::map<T, std::set<T> > > >& bar){
    // ...
  }
}

template<class T>
void fct(const std::vector< std::vector< std::map<T, std::set<T> > > >& bar){
  // ...
  helpers::h1(bar);
} 
```

现在我想通过使用一种所有函数都可以使用的 typedef 使它更漂亮。

模板化`typedef`会很好，但不允许这样做：

```
template<class T> 
typedef std::vector< std::vector< std::map<T, std::set<T> > > > Bar; 
```

我认为，另一种解决方案是将所有这些函数包装在一个模板`namespace`中，但这在 C++ 中也是不允许的（我听说它将在 `C++0x' 中......）。

我们当然有模板类，但请注意，我真的不希望用户必须构造一个对象并在其上调用成员函数。所以我最终使用的解决方法是使用一个模板类，其中所有成员函数都是`static`：

```
template<class T>
class All {

  typedef std::vector< std::vector< std::map<T, std::set<T> > > > Bar;

  static void fct(const Bar& bar){
    // ...
    h1(bar);
  }

private:
  static void h1(const Bar& bar){
    // ...
  }
}; 
```

我的问题是：如果我的大部分代码都是这样组织的，那可能有点好笑？毕竟有很多类只有静态成员函数有点不寻常？是否有其他解决方案/解决方法可以使“模板化 typedef”/“模板化命名空间”成为可能？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-15T20:43:24.937

> 是否有其他解决方案/解决方法可以使“模板化 typedef”/“模板化命名空间”成为可能？

[GOTW #79：模板类型定义](http://www.gotw.ca/gotw/079.htm)

[新的 C++ Typedef 模板](http://www.ddj.com/cpp/184403850)（参见第 1 节：问题和当前解决方法）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-03-14T20:40:23.723

对于在后 C++11 世界中阅读此问题的任何人：使用 C++11，有*一个* 模板化`typedef`的，它被称为“使用”（它实际上可以完全替换 typedef。在问题的上下文中，这里是什么我们的确是：

```
template<class T> 
using Bar = std::vector< std::vector< std::map<T, std::set<T> > > >;

namespace helpers {
template<class T>
void h1(const Bar<T>& bar){
    // ...
}
}

template<class T>
void fct(const Bar<T>& bar){
  // ...
  helpers::h1(bar);
} 
```

很好很简单。有点。

# jquery - 如何在 Eclipse 3.4 中使用 jQueryWTP？

> ID：753566
> 
> 赞同：2
> 
> 时间：2009-04-15T20:31:10.317
> 
> 标签：jquery, eclipse

如何在 Eclipse 3.4中使用[jQueryWTP ？](http://www.langtags.com/jquerywtp/)我已经修补了 jar 文件，并验证它包含 jQuery 信息，但是当我用`$(...)`. 根据我在寻找解决方案时发现的情况，这在 Eclipse 3.3 中有效，而其他人在 Eclipse 3.4 中遇到问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-10-10T23:43:28.543

不，该版本中的 JavaScript IDE 与 jQueryWTP 的用途完全不同。

# .net - 在 ClickOnce 下我可以将 log4net 日志文件写入哪里？

> ID：753568
> 
> 赞同：9
> 
> 时间：2009-04-15T20:31:11.783
> 
> 标签：.net, logging, permissions, clickonce, log4net

当我在本地运行我的应用程序时，它会将我的 log4net 日志写入我配置的位置（即，`<file value="${LOCALAPPDATA}\TEST\Logs\debug.log" />`），没有问题。但是，当我通过 ClickOnce 部署我的应用程序时，没有写入日志文件。

我知道 ClickOnce 应用程序在可以写入的位置方面受到限制，但我的印象是 LOCALAPPDATA（例如，C:\Users\me\AppData\Local）是公平的游戏。

有任何想法吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-25T17:36:48.890

使用 ClickOnce，文件夹规则与常规 Windows 应用程序有些不同。部署 ClickOnce 内容文件的数据文件夹位于 c:\Users\me\Local Settings\Apps\2.0\Data。该文件夹下面是几个子文件夹级别，具有相当神秘的标识符。

因此，最好使用[ApplicationDeployment](http://msdn.microsoft.com/en-us/library/system.deployment.application.applicationdeployment.aspx)类检索给定 ClickOnce 应用程序的实际数据文件夹。您还应该检查 IsNetworkDeployed 属性以查看您是否在部署模式下运行：

```
if (ApplicationDeployment.IsNetworkDeployed)
{
    var dataDirectory = ApplicationDeployment.CurrentDeployment.DataDirectory;
    ...
} 
```

由于 DataDirectory 由 ClickOnce 决定，因此您无法将该路径硬编码到 log4net 配置中。我的建议是在应用程序启动时以编程方式修改文件路径。

```
foreach(var appender in LogManager.GetRepository().GetAppenders())
{
    var fileAppender = appender as FileAppender;
    if (fileAppender != null)
    {
        fileAppender.File = 
            fileAppender.File.Replace("${LOCALAPPDATA}", dataDirectory);
        fileAppender.ActivateOptions();
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T20:33:34.023

[隔离存储。](http://blogs.msdn.com/shawnfa/archive/2006/01/18/514407.aspx)

# controls - 单击时文本框焦点跳转到下拉列表上方

> ID：753571
> 
> 赞同：1
> 
> 时间：2009-04-15T20:32:01.423
> 
> 标签：controls, textbox

我从来没有见过这个。

我点击我的文本框输入一个值，一旦我释放鼠标按钮焦点就会跳转到上面的下拉列表。这些项目上没有 javascript。

如果我按住鼠标按钮，我可以在文本框中输入一个值。

任何的想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-07-29T07:23:42.917

我错误地将我的文本框放在标签标签内 - 这就是焦点跳到我身上的原因

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:40:23.833

有人可能正在捕捉 mouseup 事件。

事件处理因浏览器而异，这可能解释了为什么它会在除 IE7 之外的所有浏览器中发生。

# java - Zip/Jar 文件中的二进制差异

> ID：753576
> 
> 赞同：10
> 
> 时间：2009-04-15T20:32:46.833
> 
> 标签：java, jar, zip

似乎从完全相同的源文件构建 jar 或 zip 总是会产生不同的文件。我使用 java jar 命令以及 ant 中的 jar 和 zip 任务都尝试了这个。

这似乎是由于新的 jars/zip 将时间戳设置为每个存储文件的当前时间。

有没有办法强制 zip 工具简单地使用文件系统上文件的时间戳来确保从完全相同的源构建的 jar 看起来完全相同？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-10-25T13:16:58.027

二进制差异是因为清单文件的时间戳。如果您让 jar 自己创建清单，它将动态创建清单并将创建的清单设置为 currentTimeMillis。

您可以通过以下方式解决它：
1\. 不要添加清单（如果您使用 ant，则必须使用 zip 而不是 jar）
2\. 像添加普通文件一样添加清单。（所以清单是文件系统上的一个文件，它不是动态创建的）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2018-11-08T20:17:14.267

使用 Java java.util.zip.ZipOutputStream 标准库实用程序，可以创建具有可重现内容的 zip 文件。

唯一的技巧是必须使用这个技巧来修复 zip 条目的时间戳：

```
ZipOutputStream zos=...;
ZipEntry ze=new ZipEntry("Filename");
zipEntry.setTime(0);
zos.putNextEntry(ze);
try
{
   zos.write(data);
}finally
{
  zos.closeEntry();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T22:00:09.823

我不认为有办法让 zip 做到这一点，但你当然可以在你创建之前将文件系统上文件的时间戳敲到一个已知的日期（在 unix 下使用'touch'命令 - 我不知道在 Windows 下是什么）罐子。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T10:58:47.150

我有一个类似的问题，正如 pjz 建议的那样，我在将文件添加到 jar 之前通过“触摸”文件来解决它（所以，它对我有用:-)）。如果需要，您可以在 GNU Windows Utilities、核心实用程序中找到 Windows 的触摸：http: [//gnuwin32.sourceforge.net/packages/coreutils.htm](http://gnuwin32.sourceforge.net/packages/coreutils.htm)，但它对于这个单一的包来说是一个大包（虽然您可能会喜欢许多其他有用的实用程序），或者下载类似[http://www.softpedia.com/progClean/Touch-for-Windows-Clean-41086.html](http://www.softpedia.com/progClean/Touch-for-Windows-Clean-41086.html)的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T21:26:51.193

好的，我和一位同事想出了一个适合我们的解决方案。

我们没有重新设计整个构建过程以不删除任何类或 jar 文件，而是使用以下过程：

1.  构建新的工件。
2.  使用 jardiff （[jnlp](http://java.sun.com/j2se/1.4.2/docs/guide/jws/downloadservletguide.html)的一部分）比较以前构建的更改。
3.  如果 jardiff 生成的 diff jar 没有更改，请从以前的构建中获取工件。

是的，我知道这听起来很笨拙，但它肯定优于重写构建脚本以考虑到这一点。此外，我们可以在新机器上进行完全干净的构建（在服务器故障的情况下），这个过程将确保只生成实际更新的 jar。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-03-17T22:54:29.970

这个答案是不够的。阅读我的另一个答案。我没有删除这个答案，因为它显示了非二进制兼容性的一些原因，但不是所有原因。

我有一个详尽的答案，但不幸的是德语：[https](https://www.vishia.org/SwEng/pdf/GenerateRepeatability_de.pdf) ://www.vishia.org/SwEng/pdf/GenerateRepeatability_de.pdf 简短介绍：

```
echo compile javac
$JAVAC_HOME/bin/javac -d $TMPJAVAC/binjar -cp $CLASSPATH -sourcepath $SRCPATH $FILE1SRC 
mkdir $TMPJAVAC/binjar/META-INF
##Note: create the manifest file manually, not with jar, because of time stamp
cp $MANIFEST $TMPJAVAC/binjar/META-INF/MANIFEST.MF  
echo touch timestams to $VERSION
find $TMPJAVAC/binjar -exec touch -d $VERSION {} \;
echo build jar
$JAVAC_HOME/bin/jar -cvfM $JARFILE -C $TMPJAVAC/binjar . > $TMPJAVAC/jar.txt
if ! test "$MD5FILE" = ""; then echo output MD5 checksum
  md5sum -b $JARFILE > $MD5FILE
fi  
echo ok $JARFILE 
```

它是由外部设置的脚本变量控制的通用 shell 脚本。它可以从另一个 shell 脚本或 gradle 调用。最重要的是清单的触摸命令和复制命令，以及 jar 的 M 选项（不是 m）。jar 文件中的二进制差异来自所包含文件的时间戳。哈特穆特·肖里格

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-03-25T20:42:17.860

不幸的是，我在 2020-03-17 的回答在所有情况下都不会产生可重现的 jar 文件（二进制兼容）。原因：jar 中文件的顺序取决于随机性。在另一台机器上生成，我使用过 Windows 和 Linux，在 jar/zip 文件中生成另一个文件顺序，从而产生另一个二进制内容。如果将 jar 文件逐个文件进行比较（解压缩后），它们是相同的。但是纯二进制jar不是这样的。我有一个解决方案，它不使用 JDK 中的 jar 命令，而是使用 JRE 功能的自己的 jar 算法。JRE 包含标准的 java.util.jar.* 和 java.util.zip.*。可以阅读[https://vishia.org/Java/html5/source+build/reproducibleJar.html](https://vishia.org/Java/html5/source+build/reproducibleJar.html)中的描述。你可以下载一个小[https://www.vishia.org/Java/Download/versionArchive/vishiaZipJar-2020-03-23.jar](https://www.vishia.org/Java/Download/versionArchive/vishiaZipJar-2020-03-23.jar)，带有给定的 MD5 校验和（访问此下载/versionArchive 页面）。文章包含示例。我用 Windows 和 Linux 测试了不同的 JDK 版本，结果是二进制兼容的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-07-02T23:48:57.107

fwiw，任何使用 gradle 构建系统的人都可以廉价/轻松地获得二进制稳定的 jar：

```
tasks.withType(Jar).configureEach {
    Jar jar ->
        jar.preserveFileTimestamps = false
        jar.reproducibleFileOrder = true
} 
```

这符合其他答案的建议：确保时间戳是稳定的，并确保 jar 中条目的顺序也是稳定的。我*相信*这里的大脑在`jar`命令本身之外，但我没有在这个问题上投入足够的精力来检查。

# tsql - 在 T-SQL 中实现和应用字符串拆分

> ID：753582
> 
> 赞同：0
> 
> 时间：2009-04-15T20:33:40.967
> 
> 标签：tsql, select, split

我在 T-SQL 中有这个语句。

```
SELECT Bay From TABLE where uid in (
    select B_Numbers from Info_Step WHERE uid = 'number'
) 
```

我`BAY`从`TABLE`它们`uid`等于一串数字的地方选择“多个”，如下所示：

```
B_Numbers = 1:45:34:98 
```

因此，我应该从中选择 4 个不同`BAY`的 s `TABLE`。我基本上需要将字符串`1:45:34:98`分成 4 个不同的数字。

我认为 Split() 会起作用，但它不起作用，我得到一个语法错误。来自 T-SQL 之神的任何想法都会很棒！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-20T19:21:46.337

这是一个拆分函数的实现，它以表格形式返回数字列表：

[http://rbgupta.blogspot.com/2007/03/split-function-tsql.html](http://rbgupta.blogspot.com/2007/03/split-function-tsql.html)

看起来这会让你上路……

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-04T04:20:04.503

这是一种使用辅助数字表来解析输入字符串的方法。可以轻松地将逻辑添加到返回表的函数中。然后可以连接该表以查找正确的行。

**第 1 步：创建 Numbers 表**

```
SET NOCOUNT ON
GO

IF EXISTS
(
    SELECT  1
    FROM    INFORMATION_SCHEMA.TABLES
    WHERE       TABLE_NAME  = 'Numbers'
            AND     TABLE_SCHEMA    = 'dbo'
            AND     TABLE_TYPE  = 'BASE TABLE'
)
BEGIN
    DROP TABLE dbo.Numbers
END
GO

CREATE TABLE dbo.Numbers
(
    Number smallint  IDENTITY(1, 1) PRIMARY KEY
)
GO

WHILE 1 = 1
BEGIN
    INSERT INTO dbo.Numbers DEFAULT VALUES

    IF SCOPE_IDENTITY() = 32767 
    BEGIN
        BREAK
    END
END
GO 
```

**第 2 步：解析输入字符串**

```
CREATE FUNCTION dbo.ParseString(@input_string varchar(8000), @delim varchar(8000) = " ")
RETURNS TABLE
AS RETURN
(
    SELECT Number 
    FROM dbo.Numbers
    WHERE CHARINDEX 
    ( 
        @delim + CONVERT(VARCHAR(12),Number) + @delim, 
        @delim + @input_string + @delim 
    ) > 0 
)
GO

**EXAMPLE**
SELECT * FROM dbo.ParseString('1:45:34:98',':') 
```

**第 3 步：使用您想要/需要的结果**

```
Number
------
1
34
45
98 
```

**端到端示例**

*创建返回适当 BNumber 的函数（当然将其更改为使用注释掉的 SQL）*

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION dbo.GetBNumber (@uid int)
RETURNS VARCHAR(8000) 
AS
BEGIN
    RETURN '1:45:34:98'
    --select B_Numbers from Info_Step WHERE uid = @uid
END
GO 
```

*使用使用函数返回所需的结果*

```
-- Using Test Data
SELECT N.Number FROM Numbers N
JOIN dbo.ParseString(dbo.GetBNumber(12345),':') Q ON Q.Number = N.Number

-- Using Your Data (Untested but should work.)
SELECT N.Bay
FROM TABLE N
JOIN dbo.ParseString(dbo.GetBNumber(ENTER YOU NUMBER HERE),':') Q ON Q.Number = N.uid 
```

*结果*

```
Number
------
1
34
45
98 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T20:41:24.333

您应该将数组保留为行，但如果我理解您的问题，我认为这会起作用。

```
SELECT 
    Bay 

From 
    TABLE
    join  Info_Step 
    on B_Numbers like '%'+ uid  +'%'

where 
    Info_Step.uid = 'number' 
```

由于 like 运算符，此查询将执行全表扫描。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-20T19:22:32.903

您可以做的是遍历条目并在将这些条目插入临时表时进行`B_Numbers`自己的拆分，然后执行查询。`:`

```
DECLARE @i             int
DECLARE @start         int
DECLARE @B_Numbers     nvarchar(20)
DECLARE @temp          table (
    number nvarchar(10)
)

-- SELECT B_Numbers FROM Info_Step WHERE uid = 'number'
SELECT @B_Numbers = '1:45:34:98'

SET @i = 0
SET @start = 0

-- Parse out characters delimited by ":";  
-- Would make a nice user defined function.
WHILE @i < len(@B_Numbers)
BEGIN
    IF substring(@B_Numbers, @i, 1) = ':'
    BEGIN
        INSERT INTO @temp
        VALUES (substring(@B_Numbers, @start, @i - @start))
        SET @start = @i + 1
    END

    SET @i = @i + 1
END

-- Insert last item
INSERT INTO @temp
VALUES (substring(@B_Numbers, @start, @i - @start + 1))

-- Do query with parsed values
SELECT Bay FROM TABLE WHERE uid in (SELECT * FROM @temp) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-27T10:16:03.347

你甚至可以试试这个

```
declare @str varchar(50)
set @str = '1:45:34:98'

;with numcte as(
select 1 as rn union all select rn+1 from numcte where rn<LEN(@str)),
getchars as(select 
ROW_NUMBER() over(order by rn) slno,
rn,chars from numcte 
cross apply(select SUBSTRING(@str,rn,1) chars)X where chars = ':') 

select top 1 
    Bay1 = SUBSTRING(@str,0,(select rn from getchars where slno = 1)) 
    ,Bay2 = SUBSTRING(@str,
            (select rn from getchars where slno = 1) + 1,
            (((select rn from getchars where slno = 2)-
            (select rn from getchars where slno = 1)
            )-1))
    ,Bay3 = SUBSTRING(@str,
            (select rn from getchars where slno = 2) + 1,
            (((select rn from getchars where slno = 3)-
            (select rn from getchars where slno = 2)
            )-1))
    ,Bay4 = SUBSTRING(@str,
            (select rn from getchars where slno = 3)+1,
            LEN(@str))
    from getchars 
```

**输出：**

```
Bay1    Bay2    Bay3    Bay4
1   45  34  98 
```

# operating-system - “目录视图”如何自动更新他们的文件列表？

> ID：753587
> 
> 赞同：0
> 
> 时间：2009-04-15T20:34:15.410
> 
> 标签：operating-system, views, refresh

我只是对此感到好奇。

我在一台计算机上打开了一个网络文件夹，查看文件夹中的文件。从另一台计算机上，我在网络上打开了相同的文件夹并删除了一个文件。在第一台计算机上，删除的文件立即从列表中消失。

我能想到的唯一方法是它不断检查打开文件夹的内容。但这听起来会浪费很多资源，但我想不出任何其他方式可以做到这一点。所以我只是想知道......这是如何工作的？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T20:51:14.170

这可能是一个推送通知。与客户端计算机不断检查不同，服务器在进行更改时向客户端发送消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:06:53.197

您从未指定您感兴趣的平台。通常，唯一可移植的是轮询以查看文件或目录何时更新。大约每秒轮询一次通常不会太昂贵，尽管在网络文件系统上它可能太多了。

各种平台提供了多种解决方案，以便在文件系统更改时得到通知。Linux 的现代版本提供[`inotify`](http://www.ibm.com/developerworks/linux/library/l-inotify.html). Mac OS X 提供[了 FSEvent 系统](http://developer.apple.com/documentation/Darwin/Conceptual/FSEvents_ProgGuide/Introduction/Introduction.html)。在 Windows 上有一个[目录更改通知系统](http://msdn.microsoft.com/en-us/library/aa365261(VS.85).aspx)。

# delphi - 在 Delphi 中禁用 ECO

> ID：753590
> 
> 赞同：2
> 
> 时间：2009-04-15T20:35:23.990
> 
> 标签：delphi, delphi.net

我如何在 delphi .Net 中禁用 ECO？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-15T21:24:48.020

将这两个注册表分支导出到一个文本文件，以便您以后可以在需要时重新启用 ECO。

```
HKCU\Software\Borland\BDS\4.0\Known IDE Packages\DelphiDotNet  
HKCU\Software\Borland\BDS\4.0\Known IDE Packages\CSharp 
```

在这两个分支中，您会找到名为

```
$(BDS)\Bin\Borland.Eco.Delphi.IDE100.bpl  
$(BDS)\Bin\Borland.Eco.CS.IDE100.bpl 
```

从注册表中删除这些键，然后启动 Delphi。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-15T21:07:38.047

不可以直接卸载吗？

# sql - 如何在多行上执行 UDF？

> ID：753594
> 
> 赞同：0
> 
> 时间：2009-04-15T20:35:57.420
> 
> 标签：sql, sql-server-2008, user-defined-functions

我在 SQL Server 中定义了一个用户定义的函数。我想创建一个能够在特定列中的所有行上执行该函数的单个选择语句。这可能吗？最好的方法是什么？

谢谢你

我看到了这个“在多行上执行表值函数”，但不相信它回答了我的问题。

[在多行上执行表值函数？](https://stackoverflow.com/questions/454945/execute-table-valued-function-on-multiple-rows)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T20:39:42.403

```
select dbo.YourFunc(column) as result
from table 
```

PS：停止思考程序！这是一种面向集合的语言:)

# windows-installer - 如何修复无法卸载的拙劣 MSI 安装程序

> ID：753598
> 
> 赞同：1
> 
> 时间：2009-04-15T20:36:10.477
> 
> 标签：windows-installer

作为[这个问题](https://stackoverflow.com/questions/748540/how-do-you-remove-an-advertised-shortcut-programmatically)的后续行动，并在阅读了从[这个答案](https://stackoverflow.com/questions/748540/how-do-you-remove-an-advertised-shortcut-programmatically/749570#749570)中引用的 Rob Mensching 的[博客文章之后](http://robmensching.com/blog/posts/2009/3/6/More-on-Haacks-Troubleshooting-Windows-MSI-Installers)，我尝试使用 msizap 的方式似乎是一个坏主意，我在测试中看到了一些问题。

在他的帖子中，他会做不同的事情，他说：

> 用数据构建解决方案。我希望可以构建一个新的 MSI 来解决这些问题。然后，您将修复和说明发送给所有有问题的人。它可能类似于重新缓存/重新安装（msiexec /fv，受支持的开关）在有问题的安装之上然后卸载。这样，机器就保持在已知状态，并且设置逐步改进。

如何构建这样的 MSI？我正在使用 WiX，问题是卸载过程在删除后尝试运行 exe，因为它是在 InstallFinalize 之后安排的。（忘记指定它应该只在安装而不是卸载时运行）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-01T12:34:08.363

根据您在卸载时遇到的问题类型以及如何部署它，完全可以编写脚本并部署它来编辑机器上缓存的 MSI 以解决问题。您可以遍历 C:\Windows\Installer\ 文件夹中的 MSI，以查找适合您产品的那个（例如，打开它们并阅读摘要信息）

一旦你找到了你需要的，你可以直接修改表格来修复你引入的任何问题（即禁用卸载时的自定义操作等），下次调用卸载时问题将不会发生。

资源：
[Windows Installer SQL 参考](http://msdn.microsoft.com/en-us/library/aa372021(VS.85).aspx)
[Windows Installer 自动化接口参考](http://msdn.microsoft.com/en-us/library/aa367810(VS.85).aspx)

包括一个示例脚本，我应该指出，这主要是为了说一个内部部署的应用程序并不是你可以作为修复发送给客户的东西，但它可以创建一个执行相同操作的二进制文件并将其包含在一个设置中.exe 二进制文件首先启动以清理并删除以前的卸载，然后放下新的卸载，或者只是发送二进制文件以修复卸载问题。

```
Option Explicit

Dim objFS, objShell
Dim objFolder, objFiles, objFile
Dim objInstaller
Dim installerPath, titleToFind
Dim queries

Const msiOpenDatabaseReadOnly = 0
Const msiOpenDatabaseTransact = 1

Set objInstaller = CreateObject("WindowsInstaller.Installer")

Set objShell = CreateObject("WScript.Shell")
installerPath = objShell.ExpandEnvironmentStrings("%SystemRoot%") & "\Installer\"

'Set the title you want to use for comparison
titleToFind = "Sample"
' Define the queries you wish to run against the database if found
queries = Array(    "UPDATE `InstallExecuteSequence` SET `Condition` = 'NOT Installed' WHERE `Action` = 'SampleAction'", _
                    "DELETE FROM `InstallExecuteSequence` WHERE `Action` = 'SampleAction'")

Set objFS = CreateObject("Scripting.FileSystemObject")
On Error Resume Next
If ( objFS.FolderExists(installerPath)) Then
    Set objFolder = objFS.GetFolder(installerPath) 
    Set objFiles = objFolder.Files

    For Each objFile in objFiles
        If ( StrComp ( Right(objFile.Name, 4), ".msi") = 0 ) Then
            If ( CheckMSI (installerPath & objFile.Name, titleToFind) ) Then
                UpdateMSI ( installerPath & objFile.name)
                Exit For
            End If
        End If
    Next
End If

Set objFS = Nothing
Set objShell = Nothing
Set objFile = Nothing
Set objFiles = Nothing
Set objFolder = Nothing
Set objInstaller = Nothing

' Check if the title in the MSI matches the one you are looking for
Function CheckMSI ( msiPath, title)
    Dim objDatabase, objSummary
    Dim msiTitle
    Set objDatabase = objInstaller.OpenDatabase ( msiPath, msiOpenDatabaseReadOnly ) : CheckError
    Set objSummary = objDatabase.SummaryInformation(0)

    msiTitle = objSummary.Property(2)

    If ( StrComp ( msiTitle, title) = 0 ) Then
        CheckMSI = true
    Else
        CheckMSI = false
    End If

    Set objSummary = Nothing
    Set objDatabase = Nothing
End Function

' Loop though the queries specified above and execute them against the MSI
Function UpdateMSI (msiPath)
    Dim objDatabase
    Dim objView
    Dim query

    Set objDatabase = objInstaller.OpenDatabase(msiPath, msiOpenDatabaseTransact) : CheckError
    For Each query in queries
        Set objView = objDatabase.OpenView (query) : CheckError
        objView.Execute : CheckError
    Next
    objDatabase.Commit

    Set objView = Nothing
    Set objDatabase = Nothing
End Function 

Sub CheckError
      Dim message, errRec
      If Err = 0 Then Exit Sub
      message = Err.Source & " " & Hex(Err) & ": " & Err.Description
      If Not installer Is Nothing Then
            Set errRec = installer.LastErrorRecord
            If Not errRec Is Nothing Then message = message & vbLf & errRec.FormatText
      End If
      Fail message
End Sub

Sub Fail ( message )
    WScript.Echo message
    WScript.Quit 2
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T20:39:36.677

如果 MSI 无法卸载，您可能只需要使用 MSI zap。它不会删除任何文件，但您可以使用 Orca 查看 MSI 中所有文件的列表并手动删除它们。

# wcf - 通过 WCF 实现 LINQ-to-SQL 事务

> ID：753599
> 
> 赞同：1
> 
> 时间：2009-04-15T20:36:32.677
> 
> 标签：wcf, web-services, linq-to-sql

我有一个 WCF 服务，用于向数据库添加投标，即 MS SQL Server 2005。WCF 使用 LINQ-to-SQL。

每个标书可以有很多文件和很多项目。客户可以在每次服务调用中添加一个对象。也就是说，做这样的事情：

```
TendersServiceClient service = new TenderServiceClient();
service.BeginTransaction();

// Adding a new tender
service.AddTender(TenderDTO tenderInfo);

// Adding tender's documents
foreach (DocumentDTO documentInfo in documents)
   service.AddTenderDocument(tenderInfo.TenderID, documentInfo);

// Adding tender's items
foreach (ItemDTO itemInfo in items)
   service.AddTenderItem(tenderInfo.TenderID, itemInfo);

service.CommitTransaction(); 
```

注意 BeginTransaction() 和 CommitTransaction()。也就是说，上述所有过程要么完全成功，要么完全回滚。例如，如果其中一项无法插入，则整个投标不应该存在......

所以问题是我如何实现这种交易。当然，问题在于 WCF 是无状态的。因此为每个服务调用创建新的 DataContext。如果我改用静态 DataContext，那么我将能够使用它的内置事务功能，但是我该如何处理其他可以尝试同时添加另一个投标的客户（当然，他们必须是，在此交易之外）？

所以请帮助我用某种设计模式来实现这一点。我可以随意更改服务和客户端的代码，所以请随意提出您的建议 =)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-26T16:58:14.427

你控制服务的接口吗？

如果是这样，那么优雅的解决方案肯定是让服务在单个方法中接受一个聚合的 Tender 对象，而不是使用您现在拥有的那种健谈的方法。然后，Tender 会将 Items 和 Documents 作为子集合，并且数据访问代码可以更轻松地处理单个事务中的所有更新。

除非我有误解，否则它似乎与 Order/OrderDetails 场景非常相似，同样的逻辑也适用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:47:03.213

首先，您必须在此处使用事务服务调用 - 因为您有一个“初始化”调用、一堆中间调用，然后可能有一个结束所有调用，我建议您看看“IsInitiating " 和方法的 OperationContract 上的 "IsTerminating" 属性 - 这将允许您指定一种方法来启动您的会话，并指定一种方法来完成它。

接下来，通过将“TransactionFlow”属性放在服务或所有操作上（无论您喜欢哪个），确保将您的服务配置为事务性服务。

在您的客户端代码中，您必须使用 System.Transactions 创建一个 TransactionScope，它将包装您的服务调用。这是一个轻量级或完全两阶段的分布式事务协调器 - 取决于您的调用详细执行的操作。

沿着这些思路：

1）将您的绑定标记为事务性：

```
<bindings>
  <wsHttpBinding>
    <binding name="TransactionalWsHttp" transactionFlow="true" />
  </wsHttpBinding>
</bindings> 
```

2) 服务合同：

```
[ServiceContract]
public interface ITenderService
{
  // method to start your submission process
  [OperationContract(IsInitiating=true, IsTerminating=false)]
  [TransactionFlow(TransactionFlowOption.Mandatory]
  public void StartTenderProcess();

  // all your other methods "in between"
  [OperationContract(IsInitiating=false, IsTerminating=false)]
  [TransactionFlow(TransactionFlowOption.Mandatory]
  public void AddTender()

  [OperationContract(IsInitiating=false, IsTerminating=false)]
  [TransactionFlow(TransactionFlowOption.Mandatory]
  public void AddTenderDocument()

  [OperationContract(IsInitiating=false, IsTerminating=false)]
  [TransactionFlow(TransactionFlowOption.Mandatory]
  public void AddTenderItem()

  ...

  // method to end your submission process
  [OperationContract(IsInitiating=false, IsTerminating=true)]
  [TransactionFlow(TransactionFlowOption.Mandatory]
  public void FinishTenderProcess();
} 
```

3）在您的客户端代码中：

```
using (TransactionScope ts = new TransactionScope())
{
   serviceClient.StartTenderProcess();

   ..... 

   serviceClient.FinishTenderProcess();

   ts.Complete();   // Transaction Commit 
} 
```

这对您暂时有帮助吗？

马克

# asp.net - Can't paste into web form

> ID：753611
> 
> 赞同：0
> 
> 时间：2009-04-15T20:39:30.360
> 
> 标签：asp.net, html, clipboard

A user complains they can't paste into one particular text box on a form and that this is a change in behavior that occurred three months ago. I can't reproduce the error. I've tried long text, short text, plain text, formatted text, everything works. I did fix some poorly formatted HTML, but it didn't change their problem.

The user and I are both using XP/IE7\. The application uses a proprietary MVC framework with C# on .NET 1.1\. The UI only works reliably in IE. (I tried Opera and the paste works, I can't get logged in with Firefox to get to the screen.)

Any ideas where to start?

Thanks!

Edit - here's dialog I had with the user that didn't bring to light any issues.

> You were actually on the right track in asking about the firewall, because you are trying to identify something that is different between me and you. Here's some other potential differences.
> 
> Maybe we aren't doing it the same way: Do you use keyboard shortcuts (Ctrl-C, Ctrl V) or the context menu (right mouse click and select copy/paste)?
> 
> Maybe our computers are different: What hardware (Windows/Mac), operating system (XP, Vista, etc.), and browser (IE, Firefox, etc.) are you using?
> 
> Maybe our understanding of the problem is different: Do you not see the text when you paste it in, or is it not being saved?
> 
> Maybe what we are copying from is different: I copied something from Bugzilla and something from notepad. Both are plain text. I need to try formatted text, like from a PDF and from Word. You need to try plain text.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T20:44:01.473

This may be actually a user training issue. If it were me, I'd use something like [crossloop](http://www.crossloop.com) to watch the user interact with the page. If you can see what they are actually doing (not what they SAY they are doing) then you have half a chance at reproduction of the issue. Based on your description, it is very likely not an issue with the software, but a [PEBKAC](http://en.wikipedia.org/wiki/PEBKAC) situation with your user.

## Notes on Crossloop

We use crossloop with our clients and our developers in training. Basically you install the software (very easy) on both your computer and the end user's computer. The end user then authorizes you to "see" his machine by sending you a connection code. Once connected, both you and the user can move the mouse/type/see the other person use the mouse.

It would be like a remote desktop or vnc session, but much easier to get up and running across firewalls and without too much setup/config headache.

**It is also a free download, and a free service** (the last time i used it anyway).

## Suggested course of action

1.  Install Crossloop on your machine and familiarize yourself with it. (maybe do a trial run connect with a co-worker)
2.  Call user and ask if they would be willing to show their issue to you directly via some screen sharing software.
3.  Walk them through the install and connect of Crossloop.
4.  Instruct them to show you the issue.
5.  Watch for glaring errors, etc.
6.  Hopefully see either what the user is doing wrong, or what conditions the bug manifests itself.

# xslt - 非常简单的 XSLT 字符串问题

> ID：753615
> 
> 赞同：1
> 
> 时间：2009-04-15T20:39:45.727
> 
> 标签：xslt

我将如何在 az 或 AZ 之间执行“substring(variable,1,1)”然后使用 XSLT 执行 X 否则执行 Y？我知道一种选择是使用正则表达式，但我希望会有一些不是那么矫枉过正的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T21:18:52.370

**一个简单的 XSLT 1.0 解决方案**：

这种转变：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output method="text"/>

 <xsl:variable name="vLetters"
  select="'ABCDEFGHIKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'"/>

  <xsl:variable name="vText" select="'1Text'"/>

    <xsl:template match="/">
      <xsl:choose>
        <xsl:when test=
          "contains($vLetters, substring($vText,1,1))">
            Letter
        </xsl:when>
        <xsl:otherwise>
          Not Letter
        </xsl:otherwise>
      </xsl:choose>
    </xsl:template>
</xsl:stylesheet> 
```

**当应用于任何 XML 文档（未使用）时，会产生想要的结果**：

```
 Not Letter 
```

根据具体情况，可以向指令的两个“子句”（`<xsl:when>`和`<xsl:otherwise>`）中的每一个添加任何必要的处理。`<xsl:choose>`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T21:27:17.920

对于 XSLT 2.0，您可以使用正则表达式函数`matches`：

```
<xsl:choose>
  <xsl:when test="matches($variable1, '^[a-zA-Z].*$')">
    Match
  </xsl:when>
  <xsl:otherwise>
   NoMatch
</xsl:otherwise>
</xsl:choose> 
```

# c# - 学习 .NET 3.5

> ID：753616
> 
> 赞同：2
> 
> 时间：2009-04-15T20:39:49.720
> 
> 标签：c#, .net, .net-3.5, c#-3.0

C#/.NET 2.0 开发人员学习 .NET 3.5 的最佳资源是什么？我正在努力学习 ASP.NET MVC，我觉得我的很多绊脚石都与没有明确研究过 3.5 有关。

注意：我知道已经有这些问题，但它们似乎都专注于 ASP.NET

*   [学习 C#、ASP.NET 3.5 - 我应该按什么顺序学习/跳过什么？](https://stackoverflow.com/questions/282086/learning-c-asp-net-3-5-what-order-should-i-learn-in-what-to-skip)
*   [https://stackoverflow.com/questions/276229/best-book-on-aspnet-35-c-programming](https://stackoverflow.com/questions/276229/best-book-on-aspnet-35-c-programming)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T20:48:13.193

如果您来自传统的 ASP.NET Web 窗体，MVC 确实改变了一切工作方式的游戏。我会推荐以下书籍：

*   [ASP.NET MVC 1.0 网站编程](https://rads.stackoverflow.com/amzn/click/com/0470410957)
*   [专业的 ASP.NET MVC 1.0](https://rads.stackoverflow.com/amzn/click/com/0470384611)
*   [ASP.NET 3.5 网站编程](https://rads.stackoverflow.com/amzn/click/com/0470187581)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T20:59:34.103

我强烈推荐阅读 Jon Skeet 的“C# in Depth”。虽然它的重点不是专门针对 .NET 框架，但它很好地概述了 C# 语言随时间的变化，并介绍了 C# 3 中的所有新内容（与 .NET 框架 3.5 重叠）。

注意：这里没有特定于 ASP.NET 的内容，但它再次为您提供了基础。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T20:50:13.907

您可以尝试从[What's New in the .NET Framework Version 3.5](http://msdn.microsoft.com/en-us/library/bb332048.aspx)浏览 MSDN 。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T20:55:50.117

![替代文字](https://weblogs.asp.net/blogs/scottgu/bookcover1_6CAECF94.png)

免费 PDF：[免费 ASP.NET MVC 电子书教程](http://weblogs.asp.net/scottgu/archive/2009/03/10/free-asp-net-mvc-ebook-tutorial.aspx)

来自作者：

> 我写了这本书的第一章——这是一个 185 页的端到端教程，它从头开始构建一个小而完整的 ASP.NET MVC 应用程序。我与 Wrox 达成的协议是，我将免费编写它，以换取他们也提供免费 PDF 下载。

至少应该让你开始

# visual-studio-2008 - VS2008 启动、环境、选项对话框丢失

> ID：753619
> 
> 赞同：1
> 
> 时间：2009-04-15T20:40:36.660
> 
> 标签：visual-studio-2008

我在 PC Rebuild 后重新安装了 VS2008，并且“启动”没有出现在：工具|选项|环境下。它在重建之前就在那里。任何想法为什么它会丢失以及如何让它出现？特别是我想让 VS 在启动时“加载最后加载​​的解决方案”。

内维尔[http://www.surfulater.com](http://www.surfulater.com)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T21:15:20.977

选中对话框左下角的“显示所有设置”复选框

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:38:10.047

它一直都在那里，我只见树木不见森林。对我们 Oz'ies 来说太早了。

# sql - 创建脚本的 SQL 错误

> ID：753621
> 
> 赞同：4
> 
> 时间：2009-04-15T20:40:58.733
> 
> 标签：sql, sql-server-2000, ssms

我在带有 Create Script to New 的表上使用了 SQL Server 管理工作室，并做了一些小的改动。给我一个错误“'('”附近的语法不正确，用于“WITH”之后的“(”)

```
/* EventType Table Creation */

CREATE TABLE [EventType]
(
 [pkEventID]  [int] IDENTITY(1,1) NOT NULL,
 [Description] [nvarchar](50) NOT NULL,
 [BeginDate]  [datetime] NOT NULL,
 [EndDate]  [datetime] NOT NULL,
 [Comments]  [nvarchar](500) NOT NULL,
 CONSTRAINT [PK_EventType] PRIMARY KEY 
 CLUSTERED 
 (
 [pkEventID] ASC
 )
 WITH 
 (
  PAD_INDEX = OFF, 
  STATISTICS_NORECOMPUTE = OFF, 
  IGNORE_DUP_KEY = OFF, 
  ALLOW_ROW_LOCKS = ON, 
  ALLOW_PAGE_LOCKS = ON
 ) 
 ON [PRIMARY]
)
ON [PRIMARY]
GO 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-15T20:54:47.687

您针对哪个版本的 Microsoft SQL Server 执行此`CREATE TABLE`语句？根据文档，MS SQL Server 2000 无法识别`WITH (...index options...)`. MS SQL Server 2005 及更高版本支持该语法。

即使您使用 SQL Managment Studio 2005，您也可能连接到 MS SQL Server 2000。要验证版本，请尝试以下查询：

```
SELECT  SERVERPROPERTY('productversion'), 
  SERVERPROPERTY ('productlevel'), 
  SERVERPROPERTY ('edition'); 
```

MS SQL Server 2000`productversion`是 8.x。

MS SQL Server 2005`productversion`是 9.x。

MS SQL Server 2008`productversion`是 10.x。

# http - 检测对长时间运行的 HTTP (SOAP) 请求的缺失响应

> ID：753623
> 
> 赞同：0
> 
> 时间：2009-04-15T20:41:28.827
> 
> 标签：http, soap

我需要一种方法来检测对长时间运行的 HTTP POST 请求的缺失响应。当网络基础设施（防火墙、代理、拔掉的电缆等）丢弃响应数据包时，就会出现此问题。服务器可能会检测到此故障，但客户端无法在 POST 之后发送额外的字节来探测 TCP 连接的状态。失败可能仅限于单个 TCP 连接。例如，我可能能够随后打开到服务器的新 TCP 连接。

我正在寻找一种仍然使用 HTTP POST 并且不会更改服务器端处理持续时间的解决方案。

我能想到的一些解决方案是：

1.  提供一个侧通道接口来检索请求和响应历史。如果历史记录将响应列为已发送（可能导致 TCP 错误），但我尚未在合理的时间内收到它，我可以生成本地错误。

2.  使用 X 标头请求服务器定期发送“虚假”100 Continue 临时响应。如果我没有看到预期的 100 Continue 或非临时响应，我可能会生成本地错误。

这个问题有最先进的解决方案吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-04T02:24:06.933

在我看来，您正在使用 Soap 做一些事情，使用状态连接或服务器端推送技术会更好。

# java - JUnit 测试用例 - 设置数据

> ID：753636
> 
> 赞同：3
> 
> 时间：2009-04-15T20:45:06.213
> 
> 标签：java, unit-testing, junit

我有一个简单的 CRUD 操作需要进行单元测试。这些测试用例是针对 DAO 层的——所以所有测试都是针对数据库的，因此不能被模拟。

所以我有一个测试用例用于创建另一个用于更新和另一个用于读取。

1.  我应该对 JUnit 类中的数据进行硬编码还是将其外部化？

2.  Read TestCase 显然需要数据库中的数据。我应该依靠创建测试用例来设置数据还是为此使用 SQL 语句？

这方面的最佳做法是什么？

如果您可以将我指向一个讨论此问题的互联网资源，那就太好了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-15T20:54:29.077

[Spring 对这类事情有很好的支持](http://static.springframework.org/spring/docs/2.5.x/reference/testing.html#junit38-legacy-tx)——您想要对“测试”数据库进行操作的单元测试，可以编写脚本以在每个单独的单元测试上重新创建。

最后一句话的后半部分是开发可重用和可扩展单元测试的关键——针对数据库的单元测试不应该被迫依赖于乐观地处于某种状态的数据，或者依赖于之前的单元测试首先运行 - 您需要为每个单元测试重新创建数据库，以便每个测试用例都获得数据的“干净”版本。

关于设置 Spring MVC 的分步教程实际上[有一个关于为数据库类设置单元测试的部分，](http://static.springframework.org/docs/Spring-MVC-step-by-step/part5.html)即使您不使用 Spring MVC，我认为这也是一个有价值的参考 - 您可以将其用作参考如何设置要从构建脚本创建/初始化的测试数据库，使用 Spring 容器在每次测试运行时重新加载数据等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-16T02:39:07.577

我建议使用[DBUnit](http://www.dbunit.org/)。允许您使用文件将数据库设置为已知状态，并与预期结果功能进行很好的比较。入门指南在[这里](http://www.dbunit.org/howto.html)。

最好不要在测试用例中执行任何提交，然后您可以在 tearDown() 上回滚。

# .net - 我应该如何为两个域之间的内部服务配置 WCF 安全性？

> ID：753639
> 
> 赞同：1
> 
> 时间：2009-04-15T20:45:43.107
> 
> 标签：.net, wcf, wcf-security

这是我的场景：

我计划在我们域之外的服务器上（在它自己的工作组中）运行 Windows 服务托管的 WCF 服务。我需要从我们域内的客户端安全地访问它。我们控制的两台机器之间有一个防火墙。

该服务不需要任何其他机器访问，实际上不应该接受来自指定机器以外的任何机器的连接。

通信需要加密。

我的问题是，为此目的最好的绑定、安全模式和身份验证方法是什么？我想使用 netTCPBinding 因为它是最有效的，但如果有另一个更适合这项工作，我愿意接受建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T14:05:14.520

很难给你一个明确的答案，我建议查看[CodePlex 安全指南](http://wcfsecurityguide.codeplex.com/Wiki/View.aspx?title=Home)的第 3 和第 4 部分。除了 basicHttpBinding 之外，大多数绑定都会加密您的消息。netTCPBinding 听起来很适合您的需求：[CodePlex Bindings](http://wcfsecurityguide.codeplex.com/Wiki/View.aspx?title=Ch%2008%20-%20WCF%20Bindings%20Fundamentals)。希望这会有所帮助！

Michelle LeRoux Bustamante也*学习 WCF - 很好的资源和*[她的网站](http://dasblonde.net/)

# python - python中的继承和覆盖__init__

> ID：753640
> 
> 赞同：137
> 
> 时间：2009-04-15T20:45:46.477
> 
> 标签：python, overriding, superclass

我正在阅读“潜入 Python”，并在关于类的章节中给出了这个例子：

```
class FileInfo(UserDict):
    "store file metadata"
    def __init__(self, filename=None):
        UserDict.__init__(self)
        self["name"] = filename 
```

然后作者说，如果要覆盖该方法，则必须使用正确的参数 `__init__`显式调用父级。`__init__`

1.  如果`FileInfo`该类有多个祖先类怎么办？
    *   我必须显式调用所有祖先类的`__init__`方法吗？
2.  另外，我是否必须对要覆盖的任何其他方法执行此操作？

* * *

## 回答 #1

> 赞同：172
> 
> 时间：2009-04-15T20:49:52.597

这本书在子类-超类调用方面有点过时了。关于子类化内置类也有点过时了。

现在看起来是这样的：

```
class FileInfo(dict):
    """store file metadata"""
    def __init__(self, filename=None):
        super(FileInfo, self).__init__()
        self["name"] = filename 
```

请注意以下事项：

1.  我们可以直接子类化内置类，如`dict`, `list`,`tuple`等。

2.  该`super`函数处理跟踪此类的超类并适当地调用它们中的函数。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-06-15T17:43:42.557

在您需要继承的每个类中，您可以在启动子类时运行每个需要初始化的类的循环......一个可以复制的示例可能会更好地理解......

```
class Female_Grandparent:
    def __init__(self):
        self.grandma_name = 'Grandma'

class Male_Grandparent:
    def __init__(self):
        self.grandpa_name = 'Grandpa'

class Parent(Female_Grandparent, Male_Grandparent):
    def __init__(self):
        Female_Grandparent.__init__(self)
        Male_Grandparent.__init__(self)

        self.parent_name = 'Parent Class'

class Child(Parent):
    def __init__(self):
        Parent.__init__(self)
#---------------------------------------------------------------------------------------#
        for cls in Parent.__bases__: # This block grabs the classes of the child
             cls.__init__(self)      # class (which is named 'Parent' in this case), 
                                     # and iterates through them, initiating each one.
                                     # The result is that each parent, of each child,
                                     # is automatically handled upon initiation of the 
                                     # dependent class. WOOT WOOT! :D
#---------------------------------------------------------------------------------------#

g = Female_Grandparent()
print g.grandma_name

p = Parent()
print p.grandma_name

child = Child()

print child.grandma_name 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-15T21:00:40.997

您实际上*不必*调用`__init__`基类的方法，但您通常*希望*这样做，因为基类将在那里进行一些重要的初始化，这些初始化是其余类方法工作所需的。

对于其他方法，这取决于您的意图。如果您只想在基类行为中添加一些内容，您将需要在您自己的代码中另外调用基类方法。如果您想从根本上改变行为，您可能不会调用基类的方法并直接在派生类中实现所有功能。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-15T20:49:08.247

如果 FileInfo 类有多个祖先类，那么您绝对应该调用它们的所有`__init__()`函数。您也应该对`__del__()`作为析构函数的函数执行相同的操作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-15T20:50:35.420

是的，您必须`__init__`为每个家长班级打电话。如果您要覆盖两个父项中都存在的函数，则函数也是如此。

# javascript - 分离 jQuery 并创建类/命名空间？（哎呀）

> ID：753643
> 
> 赞同：0
> 
> 时间：2009-04-15T20:46:20.373
> 
> 标签：javascript, jquery, oop, class, namespaces

我最近遇到了 DUI（Diggs 用户界面），它实现了 jquery 并让您能够使用 jQuery 等创建类。

我似乎找不到任何评论。我看到一个评论说这不是很多。

我想知道其他人在使用 jQuery 分离关注点方面都在使用什么。

您是否使用某种类、继承和命名空间的实现？

任何信息都非常感谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T22:04:59.467

我认为这是一种非常优雅的做事方式，还有比跟随 John Resig 更糟糕的方式：

*   [http://ejohn.org/blog/simple-javascript-inheritance/](http://ejohn.org/blog/simple-javascript-inheritance/)

至于命名空间和诸如此类的东西，我会保持平坦。一般来说，除非你试图挤进 $ 函数，否则你不会遇到很多碰撞。

# c# - 连接字符串配置错误

> ID：753644
> 
> 赞同：0
> 
> 时间：2009-04-15T20:46:31.763
> 
> 标签：c#, .net, asp.net, configuration

我正在尝试使用 asp.net、sql 和 xml 制作一个 RSS Feed。我收到一个错误

> 编译器错误消息：CS0103：名称 'MyConnString' 在当前上下文中不存在“第 22 行“SqlConnection objConnection = new SqlConnection("MyConnString");

我的网络配置包含

```
<connectionStrings>
    <add name="MyConnString" connectionString="
     providerName="System.Data.SqlClient" />
  </connectionStrings> 
```

这是代码

```
<%@ Page Language="C#" MasterPageFile="ContentMasterPage.master" Debug="true" %>

<%@ Import Namespace="System.Xml"%>
<%@ Import Namespace="System.Data" %>
<%@ Import Namespace="System.Data.SqlClient" %>

<script runat="server">
    void Page_load(object sender, System.EventArgs e)
    {
        Response.Clear();
        Response.ContentType = "text/xml";
        XmlTextWriter objX = new XmlTextWriter(Response.OutputStream, Encoding.UTF8);
        objX.WriteStartDocument();
        objX.WriteStartElement("rss");
        objX.WriteAttributeString("version", "2.0");
        objX.WriteElementString("title", "News");
        objX.WriteElementString("link", "http://news.ca/news.aspx");
        objX.WriteElementString("description", "The latest headlines");
        objX.WriteElementString("copyright", "(c)2009, News Club, All rights reserved.");
        objX.WriteElementString("ttl", "5");
        SqlConnection objConnection = new SqlConnection("MyConnString");
        objConnection.Open();
        string sql = "SELECT TOP 5 Title, Description, ArticleID, DatePulished FROM articles ORDER BY DatePublished DESC";
        SqlCommand objCommand = new SqlCommand(sql, objConnection);
        SqlDataReader objReader = objCommand.ExecuteReader();
        while (objReader.Read())
        {
            objX.WriteStartElement("item");
            objX.WriteElementString("title", objReader.GetString(0));
            objX.WriteElementString("description", objReader.GetString(1));
            objX.WriteElementString("link", ("http://news.ca/GetArticle.aspx?id=" + objReader.GetInt32(2).ToString()));
            objX.WriteElementString("pubDate", objReader.GetDateTime(3).ToString("R"));
            objX.WriteEndElement();
        }
        objReader.Close();
        objConnection.Close();
        objX.WriteEndElement();
        objX.WriteEndElement();
        objX.WriteEndDocument();
        objX.Flush();
        objX.Close();
        Response.End();
    }
</script> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T20:55:13.427

```
SqlConnection objConnection = new SqlConnection("MyConnString"); 
```

这是编译器遇到困难的那一行。您是否将实际连接字符串替换为“MyConnString”，或者 MyConnString 是否应该是页面上的字符串值？

我的应用程序中有类似的代码行：

```
SqlConnection oConn= new SqlConnection(_connString); 
```

您还可以从 Web.Config 获取此值

```
SqlConnection oConn = new SqlConnection(ConfigurationManager.ConnectionStrings["MyConnString"].ConnectionString); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T20:52:14.743

`SqlConnection`不接受 中`connectionString`的引用`web.config`。或仔细检查您的`web.config`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T20:59:04.917

正如例外所说，您在这一行有一个错误：

```
SqlConnection objConnection = new SqlConnection("MyConnString"); 
```

假设您在 connectionStings 部分的 web.config 中有连接字符串，您应该像这样设置连接字符串：

```
SqlConnection objConnection = new 
SqlConnection(ConfigurationManager.ConnectionStrings["MyConnString"]); 
```

顺便说一句，您应该添加**System.Configuration**作为对您的项目的引用，您可以使用 ConfigurationManager 类。

# c# - 如果 HTTP_X_FORWARDED_FOR 包含多个 IP 地址，我如何从它获取正确的 IP？

> ID：753645
> 
> 赞同：36
> 
> 时间：2009-04-15T20:46:58.783
> 
> 标签：c#

如果 Request.ServerVariables["HTTP_X_FORWARDED_FOR"] 返回多个 ip，我该拿哪一个，我将如何在 c# 中做到这一点？我的理解是，如果它是空白或 null，那么客户端计算机不会通过代理，我可以从 Request.ServerVariables [“REMOTE_ADDR”] 获取他们的 ip。这是一个正确的说法吗？

“我拿哪一个”，我的意思是我是拿列表中的第一个 IP 还是最后一个 IP，我所要做的就是把它分成一个数组，然后拿一个我想要的。我不太确定 HTTP_X_FORWARDED_FOR 是如何工作的。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-15T21:25:53.960

据此[，](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For) X-Forwarded-For HTTP 标头的格式为：

```
X-Forwarded-For: client1, proxy1, proxy2, ... 
```

所以你想要的客户端的IP地址应该是列表中的第一个

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-24T05:55:06.820

关于可靠性主题的进一步说明：

任何人都可以使用诸如 Firefox 插件“篡改数据”之类的工具或他们自己的本地代理（例如 Privoxy）来伪造 HTTP_X_FORWARDED_FOR。这意味着整个字符串可能是假的，而 REMOTE_ADDR 是实际的原始主机。这也可能意味着第一个“client1”地址是伪造的，然后客户端通过代理连接，导致 proxy1 是客户端的 IP 地址，而 REMOTE_ADDR 是使用的单个代理。

如果您希望基于 IP 拒绝访问，我建议检查 XFF 标头中的每个 IP 地址以及 REMOTE_ADDR。

如果您希望根据 IP 的区域授予访问权限，我建议仅在 XFF 为空白且 IP 来自正确区域时才允许访问。

然而，正如 Mastermind 已经指出的那样，有些代理会隐藏代理链。例如，Tor 网络将使请求看起来好像来自最终代理机器，而不是原始 IP。匿名代理通常会声称他们正在转发与 REMOTE_ADDR 中报告的 IP 相同的 IP。

基于 IP 的过滤通常是一种非常粗糙的、最后的访问控制机制。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T21:34:05.643

我前段时间问了一个非常相似的问题。

[获取客户端 IP 地址：REMOTE_ADDR、HTTP_X_FORWARDED_FOR，还有什么有用的？](https://stackoverflow.com/questions/527638/getting-the-client-ip-address-remoteaddr-httpxforwardedfor-what-else-could)

正如正确指出的那样，您可以将第一个值视为客户端的 IP 地址。但它也可能是公司网关 IP。

无论如何，匿名代理都会清除此标头中的信息，因此它很有用但不可靠。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-04-27T06:57:48.407

实际的客户端 IP 应该是标头值中最左侧的 IP 地址。您可以使用正则表达式将其提取到环境变量中：

```
SetEnvIf X-Forwarded-For "^(\d{1,3}+\.\d{1,3}+\.\d{1,3}+\.\d{1,3}+).*" XFFCLIENTIP=$1 
```

请注意使用**$1**来设置 XFFCLIENTIP 环境变量以保存正则表达式中第一组的内容（在括号中）。

作为使用此示例的示例，您可以定义使用该变量的日志格式：此示例是我们在 nearmap.com 内部使用的示例，因此它记录了额外的信息，但您想要的位是**%{XFFCLIENTIP}e**在开始。请注意行尾的**env=XFFCLIENTIP**，这意味着仅在设置了环境变量时才使用此格式。

```
CustomLog /var/log/apache2/access.log "%{XFFCLIENTIP}e \"%{session}C\" \"%{nearmapuid}C\" %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" env=XFFCLIENTIP 
```

# .net - 我可以使用 silverlight 在客户端的 PC 上写入文件吗

> ID：753646
> 
> 赞同：10
> 
> 时间：2009-04-15T20:47:01.590
> 
> 标签：.net, silverlight

我需要编写一个允许客户端从服务器下载文件的 Web 应用程序，到目前为止一切都很好，但是文件必须是某种编码的，所以我需要在客户端上对其进行解码并将其写入文件客户的电脑。

我可以使用 Silverlight 做到这一点吗？如何？

如果不可能，还有另一种方法吗？有什么建议么？

谢谢

编辑：正如 Brian Genisio 所公开的那样，我可以要求用户允许保存文件，所以我认为打开和保存对话框对于我的情况来说是可以的。但如果这还不够，有没有办法在有或没有用户交互的情况下将文件保存在隔离存储之外，例如为用户模拟新的下载？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-15T21:05:15.617

在 Silverlight 3.0 中，您将可以通过[OpenFileDialog](http://mtaulty.com/CommunityServer/blogs/mike_taultys_blog/archive/2009/03/18/a-quick-look-at-silverlight-3-save-file-dialog.aspx)读取和写入文件。在 Silverlight 2.0 中，您可以访问独立的 Sotrage，它可以让您保存到沙盒。但是，如果没有用户许可，您可能永远无法完全访问文件系统。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T20:52:25.260

为此，您可以使用 Silverlight 使用[IsolatedStorageFile类。](http://msdn.microsoft.com/en-us/library/system.io.isolatedstorage.isolatedstoragefile(VS.95).aspx)

另一个链接：[如何在独立存储中读写文件？](http://www.dotnetcurry.com/ShowArticle.aspx?ID=168&AspxAutoDetectCookieSupport=1)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T20:56:14.517

出于安全原因，您[不能这样做：](http://msdn.microsoft.com/en-us/library/system.io(VS.95).aspx)

> 基于 Silverlight 的应用程序不使用操作系统的文件系统，并且仅限于使用隔离存储来持久化和访问文件，因此此命名空间 [System.IO] 不提供任何附加功能。有关基于 Silverlight 的应用程序如何使用独立存储的详细信息，请参阅[独立存储](http://msdn.microsoft.com/en-us/library/bdts8hk0(VS.95).aspx)。

如果可能，您可能希望对其进行转换，以便服务器进行编码并以传统方式使文件可供下载。

如果您正在为隐私/安全进行编码，请考虑仅在安全协议（使用 SSL 的 HTTPS）上提供下载。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T18:57:44.157

另一种选择（不优雅但有效）可能是使用服务执行乒乓球：

*   从服务器获取文件。
*   在客户端执行您需要的编码/转换。
*   使用 WCF 服务再次将其发送到服务器，将其存储在会话中。
*   从 SL 调用一个 javascript 方法，该方法将向自定义 HTTP 处理程序发出请求。
*   该自定义 HTTP 处理程序会将会话中的文件作为附件返回（第一次出现来自 IE 的讨厌的栏......你要下载一些东西......）。

我的情况稍微简单一些，在我的应用程序中，我需要将 DB 图导出为 JPEG 并执行导出到 HTML 报告，我使用了这种方法（乒乓球:)）。

如果你想看看：

[http://www.dbschemaeditor.com](http://www.dbschemaeditor.com)

HTH布劳里奥

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-12T14:26:22.547

使用 Silverlight 4，您可以通过使用 AutomationFactory 自动化 FileSystemObject 以原始方式执行此操作。

见：http: [//justinangel.net/CuttingEdgeSilverlight4ComFeatures#BlogPost=CuttingEdgeSilverlight4ComFeat](http://justinangel.net/CuttingEdgeSilverlight4ComFeatures#BlogPost=CuttingEdgeSilverlight4ComFeat)

# opengl - 模拟沿轨道行驶的汽车

> ID：753653
> 
> 赞同：3
> 
> 时间：2009-04-15T20:48:55.767
> 
> 标签：opengl, simulation, motion

对于操作系统课程，我将编写一个名为“侏罗纪公园”的调度模拟器。

我的最终目标是让一系列汽车沿着固定的路径行驶，乘客在固定的位置排队等待这些汽车返回，这样他们就可以被接走并被带上游览。这将是一个简单的 2d、自上而下的轨道和沿轨道移动的汽车的视图。

虽然我可以轻松地编写代码，而无需直观地显示任何内容，但我不太确定实现汽车沿固定轨道移动的最佳方法是什么。

首先，我将简单地使用 OpenGL 将我的汽车绘制为矩形，但对于如何更新汽车的位置并确保它沿着模拟主题公园的设定路径移动，我仍然有点困惑。

我应该将轨道的顶点存储在一个列表中，并让每次调用都`update()`将汽车移近下一个顶点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T23:48:17.040

如果您想要曲线轨道，您可以使用样条曲线，它是由两个矢量端点指定的数学定义曲线。你扑通一声放下端点，然后求解它们之间的一条漂亮的曲线。搜索应该显示可以导出到源代码中的源代码或数学。这样做的好处是您可以准确地求解车辆的航向，并通过百分比计算获得路径上的下一个位置。困难的是，如果您不希望每组端点之间的步数相同，则必须进行曲线长度计算。

另一种方法是使用隐藏位图，其上绘制的路径为单像素宽曲线。您可以通过将当前位置周围的像素与行进方向矢量相匹配，然后在每一步使用 delta 函数更新矢量来找到路径中的下一个位置。我们将这种方法用于路径行驶原型，其中“车辆”正在使用操纵杆沿着各种路径“驱动”，并且在您遇到一些混淆矢量计算的交叉点之前它可以正常工作。但是，如果它是一个单向闭环，这将工作得很好，而且实现起来非常简单。您可以通过平均最后几个增量来平滑车辆的航向角。此外，每个像素都变成一个“步”，因此您的速度控制很容易。

在前一种情况下，您可以为开始/停止位置或兴趣点特别标记端点。在后者中，只需在路径上为特殊节点使用不同颜色的像素。在任何一种情况下，您显示的可能都不是基础路径数据，而是您的“公园”的一些美化表示。

只需选择最简单的方法，然后编写一个 tick() 函数，该函数将步进到下一个路径位置，并在汽车行驶时更新您的车辆方向。如果你真的很聪明，你可以做一些基于半径的碰撞处理，这样当赛道上前面的汽车停止时，汽车会自动停止。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T20:56:06.513

我会保持简单：

运行一个计时器（每 100 毫秒），并在每个计时器上绘制新位置的每辆汽车。该位置是从一个文件中读取的，该文件包含汽车的 2D 坐标（每辆汽车？）。

如果您将道路设计得非常长（比如说，30 秒），写 30*10 点将是……很难。那么如何在文件中存储每一整秒的位置呢？然后在这 2 个间隔之间，您将有 9 个盲点，只需以恒定速度（x += dx/9，y+= dy/9）移动汽车。

我想听听更好的方法:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T20:58:42.997

好吧，您可以按照您的描述使用一些路径，以太固定点路径或样条曲线。然后在这条路径上以固定的“速度”移动。如果汽车在直道上的移动与转弯的花费相同，这可能看起来很僵硬。

所以你可以为每个路径部分设置速度，但你需要许多速度设定点，或者混合速度，否则你会得到不平稳的速度变化。

或者您可以进行全车模拟，并使用 A* 来构建最佳路径。这已经结束了，*但非常酷*。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T20:59:36.753

如果只有前进和后退，而你知道你想前进，你可以看看你周围的单元格，找到那些是道路颜色的单元格，然后移动，这样你就可以留在道路的中心.

如果您假设您不会有突然的弯道，那么您可以假设道路就在您的正前方，然后向左和向右扫描以查看道路是否有点弯曲，保持在中心，减少关于加工。

还有其他方法可以奏效，但这种方法很简单，IMO，可以让您在道路上拥有平缓的曲线。

另一种方法是让它基于图块，因此您只需查看您面前的图块，并根据道路方向的变化使用不同的图块，这样您就知道如何转动汽车以保持在图块上。

这不会那么顺利，但也很容易做到。

# database - 侦听数据库更改的最兼容方式？

> ID：753656
> 
> 赞同：1
> 
> 时间：2009-04-15T20:49:24.267
> 
> 标签：database, events, triggers, listeners

我有一个读取原始数据并每隔几秒钟将其写入数据库的进程。

判断数据库是否已写入的最佳方法是什么？我知道 Oracle 和 MS-SQL 可以使用触发器或其他东西与其他服务进行通信，但我希望有一种技术可以与更多类型的 SQL 数据库（SQL lite、MySQL、PostGRES）一起使用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T22:15:12.890

你的问题缺乏一个好的答案所需的细节，但我会试一试。触发器非常适合定位表，但如果您对系统范围的写入感兴趣，那么您将需要一种更易于维护的更好方法。对于系统范围的写入，我会研究检测事务日志中更改的方法。不幸的是，每个供应商都以不同的方式实现这部分，因此不太可能采用一种适用于所有供应商的方法。也就是说，在数据库服务器中工作的方法是不可能的。但是在操作系统级别的服务器之外可能有更优雅的方式。例如，如果事务日志是磁盘上的文件，那么检测文件更改的某种简单脚本将指示数据库已写入。

请记住，您只要求检测数据库写入。如果您需要知道它是什么类型的写入，那么您需要进入事务日志以查看其中的内容。这肯定是特定于供应商的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:02:21.320

这取决于你想做什么。如果它是需要启动的数据库外部的东西，那么对数据库进行简单的轮询就可以了，否则数据库特定的触发器可能是最好的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T22:28:46.213

如果你想独立于数据库，轮询可以工作。它不是很有效或优雅。如果您被诅咒使用不支持触发器的数据库，它也可以工作。我们过去使用的一种解决方法是使用定时脚本（比如通过 cron）来执行`select MAX(primary_key_id) from saidTable`. 我假设你的主键是一个连续的整数并且被索引。

然后将其与您上次运行脚本时获得的值进行比较。如果它们匹配，则告诉脚本退出或休眠。如果没有，做你的事。

这种方法还有其他问题（即：如果脚本花费太长时间，则积压，或并发问题等）。当然，性能也可能成为问题！

# sqlite - SQLite 与 HSQLDB

> ID：753663
> 
> 赞同：37
> 
> 时间：2009-04-15T20:51:32.280
> 
> 标签：sqlite, hsqldb

**SQLite**和**HSQLDB**之间的主要区别是什么？有很多应用程序同时使用它们，但我看不出有什么重大区别。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-15T20:57:22.907

SQLite 用 C 实现，HSQL 用 Ja​​va 实现。

将 SQLite 与用 C 或 C++ 编写的应用程序项目集成应该更加无缝和容易，而我希望 HSQL 技术更容易与用 Java 编写的项目集成。

毫无疑问，这两个嵌入式数据库之间还有许多其他更细微的差异，但以上是最突出的差异。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2010-07-23T06:58:32.230

可以在[http://3rdstage.blogspot.com/2009/03/comparion-of-hsqldb-h2-sqlite.html找到 HSQLDB 和 SQLite 的良好比较](http://3rdstage.blogspot.com/2009/03/comparion-of-hsqldb-h2-sqlite.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-12-31T09:54:29.317

恕我直言*，*最大的区别是，与 HSQLDB 相比，SQLite 根本没有用户管理。

（这并不想对 SQLite 说任何坏话。SQlite 肯定有它的用例，它也被广泛使用。）

# fonts - 网络上的字体许可？

> ID：753664
> 
> 赞同：3
> 
> 时间：2009-04-15T20:51:51.203
> 
> 标签：fonts, sifr, typography

我想在网络上做漂亮的排版——也就是说，除了有限的“网络安全”字体集之外的字体。

合理的选择（考虑到可访问性和 SEO）似乎是 Cufón 或 sIFR 或 @font-face。

哪种方法得到了字体代工厂的支持？一些代工厂对网络更友好吗？我知道有免费的字体库，但我不知道一个好的免费字体目录。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-16T21:56:30.493

一般来说，字体链接（例如`@font-face`）会违反您使用的字体的 EULA，因为它基于重新分发字体文件。因此，你不能。当然，有些字体允许这样做。

Hoefler & Frere-Jones 在他们的常见问题解答中第 20 点下提到了 sIFR：[http](http://www.typography.com/ask/faq.php) ://www.typography.com/ask/faq.php 。总而言之，只要您采取一切可能的措施来防止 Flash 文件被轻易重复使用，他们就可以接受。我没有从其他代工厂看到这一点。也就是说，现在应该知道 Flash 嵌入，而 IFR/sIFR 大约有六年的历史，据我所知没有任何诉讼。

我不确定 Cufón，因为它很容易在不同的设置中重用 Cufón 字体文件。但请注意，我不希望将有关“竞争对手”的 FUD 散布到 sIFR，因此请随心所欲。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T00:10:18.170

sIFR 或 Cufón 都非常有用。@font-face 没有被浏览器广泛接受，所以你可能不会很成功。

如果您使用的是 sIFR 或 Cufón，我建议仅将其用于标题和子标题。两者都有脚本，可以用 flash 元素自动内联替换某些 html 标签（因此，更好的 SEO 和可用性）

至于许可，这两种方法都要求您嵌入字体，因此如果您已为字体付费，则必须确保您已为嵌入权利付费。Cufón 要求 embed 子句允许非 Flash 应用程序也嵌入它。

关于哪些字体支持它并不是一个容易回答的问题 - 这是由拥有该字体的人决定的每个字体。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-01T17:39:23.530

[Font Squirrel](http://www.fontsquirrel.com/)列出了一些优质的免费字体。[另请参阅此处](http://openfontlibrary.fontly.org/)和[此处](http://openfontlibrary.org/)的开放字体库。

至于许可，我同意[Mark Pilgrim](http://diveintomark.org/archives/2009/04/21/fuck-the-foundries)的观点，即代工厂应该意识到他们的商业模式存在荒谬的缺陷。像其他软件一样，字体希望是免费的（因为它们是设计作品，重新分发它们本质上是免费的），但开发专有软件供少数客户私人使用仍然是有意义的。字体的全部目的是可见的，即重新分配。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-21T00:41:19.133

这是一个老问题，但我相信现在答案已经改变了。我们现在有[http://www.google.com/webfonts](http://www.google.com/webfonts)和许多其他网站。

只是想我会让你知道。

# perl - 为什么我的 Perl 脚本在 cron 运行时无法加载模块？

> ID：753670
> 
> 赞同：3
> 
> 时间：2009-04-15T20:52:49.017
> 
> 标签：perl, cron

我有一堆 Perl 脚本，它们都运行良好，但需要在`use Plibdata;`最上面。

我设置了一个运行的 cron 作业（我从 root 收到确认电子邮件），它返回以下错误消息：

```
Can't locate Plibdata.pm in @INC (@INC contains: /install/lib /opt/perl58/lib/5.8.8/IA64.ARCHREV_0-thread-multi /opt/perl58/lib/5.8.8 /opt/perl58/lib/site_perl/5.8.8/IA64.ARCHREV_0-thread-multi /opt/perl58/lib/site_perl/5.8.8 /opt/perl58/lib/site_perl .) at ./x line 5.

BEGIN failed--compilation aborted at ./x line 5. 
```

第 5 行是……你猜对了……`use Plibdata;`

我也试图这样设置环境：

```
use lib "$ENV{CARSPATH}/install/lib"; 
```

所以也许如果我找到了这个 plibdata 的位置，我可以明确地指向它吗？

我的 cron 命令将使用`/usr/bin/sh`crontabs 执行...

有什么建议么？

该脚本从命令行工作。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-15T20:58:00.800

你没有说 Plibdata 是什么。您也没有说明这是否适用于您的命令提示符。我认为确实如此。

试试这个：

```
perl -MPlibdata -e 1 
```

假设不吐出相同的错误，试试这个：

```
perl -MPlibdata -le 'print $INC{"Plibdata.pm"}' 
```

那会告诉你在哪里。（如果可行，它可能在您的 PERL5LIB 环境变量中。）然后您可以将适当的“使用库”添加到 Plibdata.pm 所在的目录中。

此外，请确保您在两个位置使用相同的 perl - 命令行（“which perl”）和 cron 作业（尝试脚本顶部的“BEGIN { print $^X }”）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-15T20:59:46.880

登录时，Cron 使用的用户 env 与您的 env 不同。您可以从命令行运行脚本吗？如果是这样，只需在当前命令上方的 cron 中设置环境变量。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-15T21:57:24.433

显然，`Plibdata.pm`没有安装在系统上的默认模块路径中：

```
/install/lib /opt/perl58/lib/5.8.8/IA64.ARCHREV_0-thread-multi /opt/perl58/lib/5.8.8 /opt/perl58/lib/site_perl/5.8.8/IA64.ARCHREV_0-thread-multi /opt/perl58/lib/site_perl/5.8.8 /opt/perl58/lib/site_perl 
```

你有三个选择：

1.  安装`Plibdata.pm`在已知的 Perl 系统路径中（`site_perl`是经典选项）。

2.  使 PERL5LIB shell 环境（或`-I`Perl 的等效命令行选项）包含模块的安装路径。

3.  `use lib`在您的脚本中使用。请记住，该`use lib`操作是在编译时完成的，因此路径中的变量可能未初始化。尝试在这样的`BEGIN`块中使用变量：

    ```
    my $env;

    BEGIN {
      $env = $ENV{CARSPATH};
    }

    use lib "$env/install/lib"; 
    ```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T21:52:06.690

`cron`运行代码时不会为您设置环境，因此环境变量`$CARSPATH`不存在。我建议只从 cron 运行 shell 脚本，在 shell 脚本中设置环境，然后运行你真正想要运行的程序。

示例包装脚本：

```
#!/bin/bash

source ~username/.bash_profile
cd ~username
./script.pl 
```

如果您正在使用`ksh`，或者`sh`您可能需要说

```
#!/bin/sh

. ~username/.profile
cd ~username
./script.pl 
```

请记住将用户名替换为您在系统上的用户名。此外，如果脚本不在您的主目录中，您将希望使用它的路径执行它，而不是`./`.

你说`source`，或句号空间，在当前 shell 中加载给定的 shell 脚本。您将其加载到当前 shell 中，以便任何环境设置都保留在当前 shell 中。

`~/.bash_profile`, `~/.bashrc`, `~/.profile`,`/etc/profile`等都是通常保存您的环境设置的文件。您使用哪一个在很大程度上取决于您的操作系统和设置它的人。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-16T16:49:47.500

按照其他人的建议从包装脚本运行程序可能是我的首选方法，但可能还有其他一些解决方案：

如果您使用的是现代 cron，则可以在 crontab 条目中执行以下操作：

```
* * * * * CARSPATH=/opt/carsi x 
```

用适当的时间表指示符替换星号。

这将为 x 进程设置 CARSPATH 并允许传递环境变量的 use lib 语句工作。

您还可以根据您的 shell 和 cron 实现，将您的环境设置存储在一个文件中并执行以下操作：

```
* * * * * source specialenv.sh && x 
```

其中 specialenv.sh 包含类似 (for bash) 的行

```
export CARSPATH=/opt/carsi 
```

如果您选择这样做，您也可以直接在 crontab 中设置环境变量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T15:59:02.100

虽然它不是一个“答案”，但我通过使用 DBI 而不是 Plibdata 解决了这个问题。

这有点像乳白色，因为现在我将不得不更改几个脚本...

我还是要试试查。欧文斯回答看看是否有效

* * *

对我不起作用...“未找到解释器“/bin/bash””
也许它适用于拥有该解释器的人

* * *

* * *

* * *

```
* * * * * CARSPATH=/opt/carsi ./x 
```

作品

# vb.net - Excel 自动化 - 如何说不

> ID：753671
> 
> 赞同：7
> 
> 时间：2009-04-15T20:53:00.967
> 
> 标签：vb.net, excel, automation, interop, excel-interop

我正在开发一个 vb.net 控制台应用程序，它一个一个地打开许多电子表格，读取几个单元格并关闭文件。

一些电子表格具有 Excel 会在我打开文件时重新计算的公式，并且我收到一个对话框，询问我是否要在关闭电子表格时保存对电子表格的更改。

消息：“您想保存对 myfile.xls 的更改吗？Microsoft Office Excel 在打开由早期版本的 Excel 上次保存的文件时会重新计算公式”

如何自动拒绝该对话框？

```
 Dim newCBD As New CBD
            Dim xlApp As Excel.Application
            Dim xlWorkBook As Excel.Workbook
            Dim xlWorkSheet As Excel.Worksheet

            xlApp = New Excel.ApplicationClass
            xlWorkBook = xlApp.Workbooks.Open(myFile)
            xlWorkSheet = xlWorkBook.Worksheets(1)

            ...do a bunch of junk here

            xlWorkBook.Close()
            xlApp.Quit() 
```

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-15T20:58:22.687

您需要在 Close 方法上提供 False 参数

```
xlWorkBook.Close(False) 
```

从 Excel VBA 帮助：

> 应用于 Workbook 对象的 Close 方法。
> 
> 关闭对象。
> 
> expression.Close（SaveChanges，文件名，RouteWorkbook）
> 
> 表达式 必需。返回上述对象之一的表达式。
> 
> SaveChanges 可选变体。如果工作簿没有更改，则忽略此参数。如果工作簿发生更改并且工作簿出现在其他打开的窗口中，则忽略此参数。如果工作簿有更改，但工作簿未出现在任何其他打开的窗口中，则此参数指定是否应保存更改，如下表所示。
> 
> 值 操作 True 保存对工作簿的更改。如果还没有与工作簿关联的文件名，则使用 FileName。如果省略 FileName，则要求用户提供文件名。False 不保存对此文件的更改。省略 显示一个对话框，询问用户是否保存更改。
> 
> 文件名 可选变体。以该文件名保存更改。
> 
> RouteWorkbook 可选变体。如果工作簿不需要路由到下一个收件人（如果它没有路由单或已经路由），则忽略此参数。否则，Microsoft Excel 会如下表所示路由工作簿。
> 
> 值 含义 True 将工作簿发送给下一个收件人。False 不发送工作簿。省略 显示一个对话框，询问用户是否应该发送工作簿。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T20:59:33.680

根据此文档：http: [//msdn.microsoft.com/en-us/library/bb223560.aspx](http://msdn.microsoft.com/en-us/library/bb223560.aspx)

> 如果将工作簿的 Saved 属性设置为 True 而不将工作簿保存到磁盘，Microsoft Excel 将退出而不要求您保存工作簿。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-02T12:05:17.403

最好使用[Close()](http://msdn.microsoft.com/en-us/library/microsoft.office.tools.excel.workbook.close%28v=vs.80%29.aspx)来避免此错误消息，但如果您使用的是 v11.0 之类的版本，它的[close()](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.excel.workbooks.close%28v=office.11%29)不带参数，所以问题仍然无法解决这种情况。要处理这个问题，您可以使用 [Marshal.RealeaseCOMObject](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.releasecomobject.aspx)但请记住有一些[问题](http://blogs.msdn.com/b/visualstudio/archive/2010/03/01/marshal-releasecomobject-considered-dangerous.aspx)。

为了回应您的“如何说不”，您可以使用：

```
xlApp.DisplayAlerts= false;  // use just above the Close() method calls
xlApp.Workbooks.Close(); // here no arguments can be used. 
```

希望能帮助到你！

# vb.net - 在 Microsoft.Office.Interop.Word 中使用 Selection.Find 查找文档中的跟踪更改

> ID：753672
> 
> 赞同：0
> 
> 时间：2009-04-15T20:53:19.593
> 
> 标签：vb.net, ms-word, selection-object

我目前在 VB.Net 应用程序中使用下面的代码来查找 Word 文档中的特定文本。文本被 .Text 语句中的字符代码表示的符号包围。下面的代码工作正常。现在的问题是，有时文档中的所需文本已被标记为删除，并在文档中显示为跟踪更改。我只想找到未标记为删除的所需文本。有谁知道确定找到的文本是否是删除的方法？

```
 xSelection.MoveStart(Word.WdUnits.wdStory)
    xSelection.Find.ClearFormatting()
    xSelection.Find.Replacement.ClearFormatting()
    With xSelection.Find
        .Text = ChrW(65000) & "( \[*)" & ChrW(65001)
        .Replacement.Text = ""
        .Forward = True
        .Wrap = Word.WdFindWrap.wdFindContinue
        .Format = False
        .MatchCase = False
        .MatchWholeWord = False
        .MatchByte = False
        .MatchAllWordForms = False
        .MatchSoundsLike = False
        .MatchFuzzy = False
        .MatchWildcards = True
    End With
    xSelection.Find.Execute(Replace:=Word.WdReplace.wdReplaceNone)

    Do While xSelection.Find.Found
        ........Execute additional code here
    Loop 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-24T14:57:46.923

我最终循环遍历每个修订并更改已删除修订的字体颜色，以将它们与未删除的评论区分开来，如下所示：

```
 For Each xRevision In theDoc.Revisions
        If xRevision.Type = Word.WdRevisionType.wdRevisionDelete Then
            xRevision.Range.Font.Color = Word.WdColor.wdColorBlack
        End If
    Next 
```

然后我可以根据字体颜色进行查找并以不同方式处理找到的评论：

```
 xSelection.MoveStart(Word.WdUnits.wdStory)
    xSelection.Find.ClearFormatting()
    xSelection.Find.Replacement.ClearFormatting()
    With xSelection.Find
        .Text = ChrW(65000) & "( \[*)" & ChrW(65001)
        .Replacement.Text = ""
        .Forward = True
        .Wrap = Word.WdFindWrap.wdFindContinue
        .Format = False
        .MatchCase = False
        .MatchWholeWord = False
        .MatchByte = False
        .MatchAllWordForms = False
        .MatchSoundsLike = False
        .MatchFuzzy = False
        .MatchWildcards = True
    End With
    xSelection.Find.Execute(Replace:=Word.WdReplace.wdReplaceNone)

    Do While xSelection.Find.Found
        If xSelection.Font.Color = Word.WdColor.wdColorAutomatic Then
            .....
        End If
        xSelection.Find.Execute()
    Loop 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T14:26:53.170

对我来说，在搜索之前将修订视图设置为最终视图是可行的。然后只找到最终修订中可见的文本（您可以备份以前的值并在搜索完成后恢复视图）：

```
ActiveDocument.Windows(1).View.RevisionsView = wdRevisionsViewFinal 
```

完整代码：

```
' set view to show final document revision
' to prevent deleted text from being found
Word.WdRevisionsView revisionsView = xSelection.Document.Windows(1).View.RevisionsView
xSelection.Document.Windows(1).View.RevisionsView = Word.WdRevisionsView.wdRevisionsViewFinal

xSelection.MoveStart(Word.WdUnits.wdStory)
xSelection.Find.ClearFormatting()
xSelection.Find.Replacement.ClearFormatting()
With xSelection.Find
    .Text = ChrW(65000) & "( \[*)" & ChrW(65001)
    .Replacement.Text = ""
    .Forward = True
    .Wrap = Word.WdFindWrap.wdFindContinue
    .Format = False
    .MatchCase = False
    .MatchWholeWord = False
    .MatchByte = False
    .MatchAllWordForms = False
    .MatchSoundsLike = False
    .MatchFuzzy = False
    .MatchWildcards = True
End With
xSelection.Find.Execute(Replace:=Word.WdReplace.wdReplaceNone)

Do While xSelection.Find.Found
    ........Execute additional code here
Loop

' restore previous view
xSelection.Document.Windows(1).View.RevisionsView = revisionsView 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-09-09T17:02:54.287

在搜索或处理 Word 文档之前尝试关闭显示修订：

```
document.ShowRevisions = false; 
```

它会保留文档中的更改跟踪（如果存在），但让您仅查看和处理最新内容，而不会删除任何内容等。

# java - JBoss 配置

> ID：753684
> 
> 赞同：3
> 
> 时间：2009-04-15T20:57:00.363
> 
> 标签：java, linux, jboss

我的任务是设置一个服务器来运行 JBoss 大概是最新版本。我想知道是否有人对为 Linux（Red Hat）系统设置磁盘分区有任何建议？目前他们在一个分区上运行实验室，所有东西都在一个分区上，我想避免将其投入生产。具体来说，我想知道哪个分区应该获得大部分空间？

该系统是全新的，具有一个带有 6 x 150 GB 磁盘的 Raid5 控制器。

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T21:00:10.200

这与 JBoss 配置无关

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T22:16:55.447

默认情况下，JBoss 将文件放入：

```
%JBOSS_HOME%/server/default/data
%JBOSS_HOME%/server/default/log
%JBOSS_HOME%/server/default/tmp
%JBOSS_HOME%/server/default/work 
```

日志文件夹大小无限制。

我*认为*tmp 和 work 都受您部署的应用程序的大小/数量的限制。

我对数据一无所知。

# python - 您如何以与 Django 中对 QuerySet 的排序方式相同的方式对列表进行排序？

> ID：753687
> 
> 赞同：2
> 
> 时间：2009-04-15T20:57:34.887
> 
> 标签：python, django, django-models

我有一个模型，它的 Meta 类下有一个排序字段。当我执行查询并取回模型的 QuerySet 时，它按指定的顺序排列。但是，如果我在列表中有此模型的实例并在列表中执行排序方法，则顺序与我想要的不同。有没有办法对模型实例列表进行排序，使得顺序等于模型定义中指定的顺序？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T13:31:44.320

不是自动的，但需要做一些工作，是的。您需要定义一个比较器函数（或模型类上的**cmp**方法），该函数可以根据相关属性比较两个模型实例。例如：

```
class Dated(models.Model):
  ...
  created = models.DateTimeField(default=datetime.now)

  class Meta:
    ordering = ('created',)

  def __cmp__(self, other):
    try:
      return cmp(self.created, other.created)
    except AttributeError:
      return cmp(self.created, other) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T21:23:23.140

您的问题的答案在不同程度上是肯定的，但有一些手动要求。如果`list`你的意思是`queryset`由一些复杂的查询形成的，那么，当然：

```
queryset.order_by(ClassName.Meta.ordering) 
```

或者

```
queryset.order_by(instance._meta.ordering) 
```

或者

```
queryset.order_by("fieldname") #If you like being manual 
```

如果您不使用查询集，那么当然您仍然可以进行排序，就像任何人在 python 中对复杂对象进行排序一样：

*   比较器
*   指定键
*   装饰/排序/取消装饰

[有关这三个方面的详细说明，请参阅 python wiki。](http://wiki.python.org/moin/HowTo/Sorting)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T22:17:51.517

基于 Carl 的回答，您可以轻松添加使用所有排序字段的功能，甚至检测倒序字段。

```
class Person(models.Model):
  first_name = models.CharField(max_length=50)
  last_name = models.CharField(max_length=50)
  birthday = date = models.DateField()

  class Meta:
    ordering = ['last_name', 'first_name']

  def __cmp__(self, other):
    for order in self._meta.ordering:
      if order.startswith('-'):
        order = order[1:]
        mode = -1
      else:
        mode = 1
      if hasattr(self, order) and hasattr(other, order):
        result = mode * cmp(getattr(self, order), getattr(other, order))
        if result: return result
    return 0 
```

# asp.net-mvc - 如何创建无法直接访问但只能重定向到的视图？

> ID：753696
> 
> 赞同：1
> 
> 时间：2009-04-15T20:59:33.027
> 
> 标签：asp.net-mvc

我目前正在我的项目中进行用户注册。注册完成后，我希望向用户显示一些确认信息。我决定创建另一个视图。没关系。

现在，如果在注册后我只返回如下视图：

```
public class MyController : Controller
{
    [AcceptVerbs (HttpVerbs.Post), ValidateAntiForgeryToken]
    public ActionResult Registration (FormCollection form)
    {
        /* Some logic goes here */

        return View ("ConfirmationView");
    }
} 
```

一切都按预期工作。标题栏中没有更改的 url。但是...如果我单击刷新按钮，浏览器将再次从表单提交我不想要的数据。

然后我决定创建一个单独的操作，但这意味着它将在地址栏中生成一个新的 url。我不希望用户现在单击刷新，因为此视图将无法再次明智地显示确认信息。有什么方法可以使操作无法直接访问？或者至少有什么方法可以确定它是直接调用还是通过重定向调用？在后一种情况下，我只会将用户从该页面带到主页。

有什么办法可以做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T21:19:40.047

所以我自己找到了解决方案。

可以使用 TempData 来检测重复的或外部的操作调用。

```
public class MyController : Controller
{
    [AcceptVerbs (HttpVerbs.Post), ValidateAntiForgeryToken]
    public ActionResult Registration (FormCollection form)
    {
        /* Some logic goes here */

        TempData["RedirectCall"] = true;
        return RedirectToAction ("Confirmation");
    }

    [AcceptVerbs (HttpVerbs.Get)]
    public ActionResult Confirmation ()
    {
        if (TempData["RedirectCall"] == null)
            return RedirectToAction ("StartPage", "Home");

        return View ();
    }
} 
```

很好很简单。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:17:17.680

解决问题的一种方法是将 guid 或类似类型的“随机”数据附加到用户会话，并在请求页面时检查有效会话。如果没有，你重定向到一个页面，说这个 url 目前不可用，并且用户很快就会被重定向（然后使用 js 大约 5 秒后重定向到主页）。

大致它会像这样工作：

1.  当用户注册时，会创建一个会话 cookie，例如`GUID`. `GUID`也存储在数据库表中，其中一列用于主`UserID`键，一列用于`GUID`. 您还创建了一个身份验证 cookie，从而将用户登录到您的站点。

2.  当所有数据调用等完成后，用户已成功注册等，您重定向到确认页面。

3.  加载确认页面时，用户会自动登录（因为您在步骤 1 中创建了身份验证 cookie）。然后，您可以在 UserID-GUID 表中检查与登录用户相对应的行。

    a) 如果存在这样的行，则删除该行，并显示包含所有信息的确认页面。

    b) 如果没有这样的行，则显示错误消息并重定向。由于您在第一次显示消息时删除了该行，因此用户将无法再次访问确认页面。

* * *

注意：如果您使用这种方法（或使确认页面仅可用一次的其他方法），您应确保在确认页面上明确说明用户将无法再次访问该页面。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-05-27T00:00:57.037

```
if(Request.UrlReferrer == null)
{
    return RedirectToAction("Index");
} 
```

# django - 在保存时在 Django 的管理面板中操作数据

> ID：753704
> 
> 赞同：48
> 
> 时间：2009-04-15T21:00:30.933
> 
> 标签：django, django-admin, foreign-keys, save

好的，这是瘦的：

```
# models.py
class Article( models.Model ):
    title           = models.CharField( max_length = 255 )
    author          = models.ForeignKey( User )
    published_at    = models.DateTimeField( auto_now_add = True )
    body            = models.TextField( )

    def __unicode__( self ):
        return self.title

# admin.py
from hpccoe.news.models import Article
from django.contrib import admin
from django import forms
from django.forms import widgets

class ArticleAdminForm( forms.ModelForm ):    
    title   = forms.CharField( max_length = 255, required = True )
    body    = forms.CharField( required = True, widget = widgets.Textarea )

class ArticleAdmin( admin.ModelAdmin ):
    fields  = [ 'title', 'body' ]
    form    = ArticleAdminForm

admin.site.register( Article, ArticleAdmin ) 
```

如您所见，我在管理员表单中省略了作者字段。我想以某种方式在保存之前自动填充它。我该如何做到这一点？最近一个小时我一直在谷歌上，但无济于事。

提前致谢。

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-04-15T21:05:53.417

来自[Django 文档](https://docs.djangoproject.com/en/dev/ref/contrib/admin/#django.contrib.admin.ModelAdmin.save_model)：

```
ModelAdmin.save_model(self, request, obj, form, change) 
```

> 该`save_model`方法被赋予`HttpRequest`模型实例、`ModelForm`实例和布尔值，具体取决于它是添加还是更改对象。在这里您可以进行任何保存前或保存后的操作。
> 
> 例如`request.user`在保存之前附加到对象：

```
from django.contrib import admin

class ArticleAdmin(admin.ModelAdmin):
    def save_model(self, request, obj, form, change):
        obj.user = request.user
        super().save_model(request, obj, form, change) 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-15T21:03:30.660

```
class ArticleAdmin( admin.ModelAdmin ):
    fields  = [ 'title', 'body' ]
    form    = ArticleAdminForm

    def save_model(self, request, obj, form, change):
         obj.author = "name Here"
         obj.save() 
```

# javascript - 带 DOM 的 onClick 与硬编码的 onClick

> ID：753706
> 
> 赞同：1
> 
> 时间：2009-04-15T21:01:25.707
> 
> 标签：javascript, dom

在 javascript 中，在 DOM 和 HTML 本身中编码 onclick 事件的优缺点是什么？

如果有的话，哪个比另一个更好，为什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T21:08:21.757

当您提到“HTML 本身”时，您的问题几乎可以自行回答。

JavaScript 不是 HTML——将 HTML 和 JavaScript 保存在不同的位置本身就是一个好处。使（人工）阅读 HTML 变得更容易，并且将所有 JS 保存在同一位置可以更轻松地一次跟踪所有内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T21:10:49.583

正如 OtherMichael 所说，最好用 Javascript 编写 Javascript。使用正确的 DOM 事件 ( `addEventListener`and `attachEvent`) 而不是更好`on_____`，以避免冲突并允许同一事件的多个回调。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T21:10:38.257

将事件附加到 CSS 样式的 ID（或类），正如 Jquery 做得很好，这意味着如果您没有启用 JS，它将自动落入任何引用的链接。这是一种很好的做法，将有助于确保您的页面即使在非常简单的浏览器（例如某些手机）中也能正常工作。

将底层数据（HTML）、表示（CSS）和行为（Javascript）分层也是一种很好的做法。如果结构良好，更改各个层会容易得多。

# sql-server - SQL Server 2000 和 2005 的开源测试

> ID：753709
> 
> 赞同：2
> 
> 时间：2009-04-15T21:02:56.857
> 
> 标签：sql-server, stress-testing, stress

是否有任何开源测试工具可以测试 Sql Server 2000 的压力。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T04:37:21.927

Microsoft 提供了名为[SQLIOSim](http://support.microsoft.com/kb/231619)（原为 SQLIOSTress）的*免费实用程序来打击 IO 系统，并提供*[OSTRESS](http://support.microsoft.com/kb/887057)来重放跟踪文件。

鉴于您已经同意 MS SQL Server 许可证，它是否必须是开源的？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:06:08.033

有两个大型开源数据库服务器，[mysql](http://dev.mysql.com/)和[postgresql](http://www.postgresql.org/)。我认为这两个都有一些测试工具（尽管它们可能需要一些调整才能用于 ms sql server）。

# c# - 在 Media.Matrix 到 Drawing2D.Matrix 之间转换的最佳方法是什么

> ID：753717
> 
> 赞同：1
> 
> 时间：2009-04-15T21:04:54.947
> 
> 标签：c#, .net, wpf, winforms, geometry

我需要从 WPF Media.Matrix 转换为 Windows 窗体 Drawing2D.Matrix，因此我执行了以下操作：

```
 public static System.Drawing.Drawing2D.Matrix ConvertToDrawing2DMatrix( Matrix matrix)
  {
     return new System.Drawing.Drawing2D.Matrix((float)matrix.M11, 
                                                (float)matrix.M12, 
                                                (float)matrix.M21, 
                                                (float)matrix.M22,
                                                (float)matrix.OffsetX, 
                                                (float)matrix.OffsetY);
  } 
```

并且想知道这是否是最好的方法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T23:47:20.067

**如果您的代码工作正常，那么我会说这可能是您情况下的最佳方法。**我查看了整个谷歌，试图找到一种方法来做到这一点，除了第 3 方库之外，我似乎找不到方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-15T08:11:00.313

我会说这是最好的方法。该`System.Drawing`矩阵存储在非托管内存中，而 WPF 矩阵是托管堆栈上的一个结构，因此在进行块复制时的任何技巧都需要一些不安全的代码来实现非常小的性能改进（如果有的话）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-15T08:26:23.213

正如其他人所说，这可能是最好的方法。我只是想根据 .NET 版本和您的编码策略添加它，您可以考虑将“this”添加到方法签名中，并使其成为更易于访问的扩展方法，如下所示：

```
using Drawing2DMatrix = System.Drawing.Drawing2D.Matrix;
public static Drawing2DMatrix ConvertToDrawing2DMatrix(this Matrix matrix) {...} 
```

然后你可以这样称呼它：

```
Drawing2DMatrix newMatrix = myMediaMatrixInstance.ConvertToDrawing2DMatrix(); 
```

只是一个建议。

# c# - C#中的DES加密

> ID：753719
> 
> 赞同：3
> 
> 时间：2009-04-15T21:05:13.403
> 
> 标签：c#, encryption

采取以下代码：

```
DESCryptoServiceProvider des = new DESCryptoServiceProvider();
des.Key = new byte[] { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08};
ICryptoTransform encryptor = des.CreateEncryptor();
// encrypt
byte[] x = UTF8Encoding.UTF8.GetBytes("thisIsATEST");
byte[] enc = encryptor.TransformFinalBlock(x, 0, x.Length);
string savedValue = Convert.ToBase64String(enc);

DESCryptoServiceProvider des1 = new DESCryptoServiceProvider();
des1.Key = new byte[] { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08};
ICryptoTransform decryptor = des1.CreateDecryptor();
byte[] y = Convert.FromBase64String(savedValue);
// decrypt
byte[] originalAgain = decryptor.TransformFinalBlock(y, 0, y.Length);
System.Text.ASCIIEncoding e = new System.Text.ASCIIEncoding();
string str = e.GetString(originalAgain); 
```

现在这对解密不起作用但是如果**des1.CreateDecryptor();** 改为**des.CreateDecryptor()；**它工作正常，我不确定为什么我使用完全相同的密钥。

它没有抛出异常，只是没有正确转换字符串。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-15T21:10:56.290

除非您使用类似 ECB 模式的东西，否则解密器需要加密器使用的初始化向量。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-15T21:13:58.810

这是因为您没有设置初始化向量 (IV)，DESCryptoServiceProvider 会自动为您生成一个，并且由于您有 2 个单独的实例，它们将有所不同。

# iis - 如何使用 powershell 将多个 ServerBindings 添加到 IIS6？

> ID：753724
> 
> 赞同：0
> 
> 时间：2009-04-15T21:06:26.397
> 
> 标签：iis, powershell, iis-6

我在尝试使用 powershell 将多个服务器绑定添加到单个网站时遇到了实际问题！

目前我有以下代码：

```
 function UpdateMetaBaseProperties($dirEntry, $Properties)
    {
        foreach($Prop in $Properties)
        {
            $KeyValue = $Prop.Split('=');       
            $dirEntry.psbase.Invoke("Put", ($KeyValue[0], $KeyValue[1]));
            $dirEntry.psbase.Invoke("SetInfo");     
            Write-Host "Setting property: $KeyValue";
        }
    } 
```

这适用于单值属性，但我似乎无法弄清楚如何添加多个。

我试过了

1.  作为数组传递（抛出异常）
2.  作为逗号分隔的字符串传递（将所有字符串放入 1 个主机条目）
3.  作为分号分隔的字符串传递（将所有字符串放入 1 个主机条目）
4.  运行 put 两次（仅保存最后一个主机条目）

我一直在谷歌上搜索，但似乎没有任何效果！

请帮忙！！:(

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T08:01:40.203

干得好：

```
$site = [adsi]"IIS://localhost/w3svc/$siteid"
$site.ServerBindings.Insert($site.ServerBindings.Count, ":80:$hostheader")
$site.SetInfo() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T03:03:15.397

如果您从 www.iis.net ( [http://www.iis.net/1664/ItemPermalink.ashx](http://www.iis.net/1664/ItemPermalink.ashx) )安装 IIS powershell 提供程序，您将有更轻松的时间

```
[E] PS> add-pssnapin webadministration
[E] PS> new-webbinding -?

NAME
    New-WebBinding

SYNOPSIS
    Adds a new Web site binding to an existing Web site.

SYNTAX
    New-WebBinding [[-Name] <String>] [-Protocol <String>] [-Port <UInt32>] [-IPAddress <String>] [-HostHeader <String>
    ] [-Force] [-WarningAction <ActionPreference>] [-WarningVariable <String>] [<CommonParameters>]

DESCRIPTION
    Adds a new Web site binding to an existing Web site.

RELATED LINKS

REMARKS
    To see the examples, type: "get-help New-WebBinding -examples".
    For more information, type: "get-help New-WebBinding -detailed".
    For technical information, type: "get-help New-WebBinding -full". 
```

# c# - 添加自己的javascript进行验证

> ID：753729
> 
> 赞同：0
> 
> 时间：2009-04-15T21:08:27.623
> 
> 标签：c#, asp.net, javascript

我对c#不太了解。我正在更新由其他人构建的页面，并且我想将脚本添加到按钮 Web 控件。该表单正在使用 c# 的验证，当我从打开页面查看返回的标记时，已经有一个用于回发提交和验证的 onclick 事件处理程序。那么我如何添加自己的呢？谢谢你的帮助

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T21:11:52.590

这是[ASP.NET 验证控件](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx)的官方 ASP.NET 快速入门教程。顺便说一句，如果您正在寻找自定义验证，请检查[CustomValidator Control](http://www.4guysfromrolla.com/articles/073102-1.aspx)，特别是它的 ClientValidationFunction 属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T21:11:24.947

您可以使用按钮的`OnClientClick`属性来放置自定义客户端脚本。关于它的文档[here](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.button.onclientclick.aspx)。

# c# - 如何用 NHibernate 枚举列名？

> ID：753732
> 
> 赞同：4
> 
> 时间：2009-04-15T21:09:02.347
> 
> 标签：c#, nhibernate, inspection

我有一个带有一堆 [ColumnName("foo")] NHibernate 属性的类。有没有一种简单的方法可以让 NHibernate 列出给定类的所有 ColumnNames？

听起来应该很容易，但我只是没有在 NHibernate 文档中看到任何类型的检查（或者我今天可能只是瞎了眼）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-11T21:31:43.103

我遇到了同样的问题，但发现 IClassMetadata 没有任何列信息，只有属性类型、名称、标识符和表信息。

什么对我有用：

```
PersistentClass persistentClass = cfg.GetClassMapping(typeof(MyEntity));
Property property = persistentClass.GetProperty(propertyName);
property.ColumnIterator   // <-- the column(s) for the property 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-12-08T03:23:29.063

**如何获取 NHibernate 映射的实体的数据库列名：**

```
using System;
using System.Collections.Generic;
using NHibernate;
using NHibernate.Persister.Entity;

namespace Stackoverflow.Example
{
    /// <summary>
    /// NHibernate helper class
    /// </summary>
    /// <remarks>
    /// Assumes you are using NHibernate version 3.1.0.4000 or greater (Not tested on previous versions)
    /// </remarks>
    public class NHibernateHelper
    {
        /// <summary>
        /// Gets the list of database column names for an entity
        /// </summary>
        /// <param name="sessionFactory">NHibernate SessionFactory</param>
        /// <param name="entity">A mapped entity</param>
        /// <returns>List of column names</returns>
        public static IEnumerable<string> GetPropertyColumnNames(ISessionFactory sessionFactory, object entity)
        {
            Type entityType = entity == null ? null : entity.GetType();

            List<string> columnNameList = null;

            // This has some cool methods and properties so check it out
            var metaData = entityType == null ? null : sessionFactory.GetClassMetadata(entityType.ToString());

            //- metaData validity check ... will be null if provided type is not mapped
            if (metaData != null)
            {
                // This has some even cooler methods and properties so definitely check this out
                var entityPersister = (AbstractEntityPersister) metaData;

                //- how to get the entity's identifier
                //- string entityIdentifier = metaData.IdentifierPropertyName;

                //- Get the database identifier
                //- can have multiple in case of composite keys
                IEnumerable<string> dbIdentifierNameList = entityPersister.KeyColumnNames;

                var propertyNameList = entityPersister.PropertyNames;

                // Adding the database identifier first
                columnNameList = new List<string>(dbIdentifierNameList);
                //- then add properties column names
                foreach (var propertyName in propertyNameList)
                {
                    var columnNameArray = entityPersister.GetPropertyColumnNames(propertyName);
                    columnNameList.AddRange(columnNameArray.Where(columnName => dbIdentifierNameList.Contains(columnName) == false));
                }
            }

            return columnNameList;
        }
    }
} 
```

用法：

```
// Get your NHiberate SessionFactory wherever that is in your application
var sessionFactory = NHibernateHelper.SessionFactory;

// Get an entity that you know is mapped by NHibernate
var customer = new Customer();

// Get a list of the database column names for the entity
var columnNames = 
        Stackoverflow.Example.NHibernateHelper.GetPropertyColumnNames( sessionFactory, customer ); 
```

沉浸在这令人敬畏的荣耀中:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T21:20:24.177

使用 LINQ 和反射：

```
var columns = typeof(TheClass).GetProperties()
    .Where(property => property.GetCustomAttributes(typeof(ColumnNameAttribute), false).Count > 0)
    .Select(property => property.Name); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T12:15:52.833

**使用 NHibernate 的元数据**

```
// get an instance to the metadata 
IClassMetadata metadata = sessionfactory.GetClassMetadata(typeof(MyEntity));

// use properties and methods from the metadata:
// metadata.PropertyNames
// metadata.PropertyTypes
// metadata.GetIdentifier()
// and more

// or get the metadata for all classes at once
IDictionary allClassMetaData = factory.GetAllClassMetadata();
metadata = allClassMetaData[typeof(MyEntity)]; 
```

你得到了 NHibernate 实际知道的东西，与它是如何定义的无关；使用属性、xml 映射或[FluentNHibernate](http://fluentnhibernate.org/)。这使得它比你自己使用反射更稳定、更可靠。

# javascript - 数据过滤算法

> ID：753734
> 
> 赞同：2
> 
> 时间：2009-04-15T21:09:42.160
> 
> 标签：javascript, algorithm, filter, mootools

你能给我推荐一个过滤数据的算法吗？

我正在使用 javascript 并尝试编写一个过滤器函数来过滤一个数据数组。我有一个数据数组和一个过滤器数组，所以为了对每个数据应用每个过滤器，我编写了 2 个 for 循环

```
foreach(data)
{
  foreach(filter)
  {
   check data with filter
  }
} 
```

这不是正确的代码，但简而言之，我的功能是做什么的，问题是这需要大量时间，有人可以提出更好的方法。

我正在使用 Mootools 库，数据数组是 JSON 数组

数据和过滤器的详细信息

数据是让我们说用户的 JSON 数组，所以它将是

```
data = [{"name" : "first", "email" :  "first@first", "age" : "20"}.
        {"name" : "second", "email" :  "second@second", "age" : "21"}
        {"name" : "third", "email" :  "third@third", "age" : "22"}] 
```

过滤器数组基本上是针对不同数据字段的自定义类

```
alFilter[0] = filterName;
alFilter[1] = filterEmail;
alFilter[2] = filterAge; 
```

因此，当我进入第一个 for 循环时，在上述情况下，我得到了一个 JSON opbject（第一行）。当我进入第二个 for 循环（过滤器循环）时，我有一个过滤器类，它提取当前过滤器将在其上工作的确切字段，并使用数据的适当字段检查过滤器。

所以在我的例子中

```
foreach(data)
{
 foreach(filter)
{
  //loop one - filter name
 // loop two - filter email
 // loop three - filter age
}
} 
```

当第二个循环结束时，我设置一个标志，表示数据是否已被过滤，并根据它显示数据。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T21:20:01.510

您将不得不向我们提供有关数据和过滤器的确切结构的更多详细信息，才能真正为您提供帮助。过滤器是否用于选择数据子集或修改数据？过滤器在做什么？

也就是说，有一些一般性建议：

1.  **少做点工作**。有什么方法可以限制正在处理的数据量？一些可以快速运行并在您执行主循环之前将其减少的预过滤器？
2.  **尽快跳出内循环**。如果其中一个过滤器拒绝了一个数据，则跳出内部循环并继续前进到下一个数据。如果这是可能的，那么您还应该尝试将最具选择性的过滤器放在第一位。（这是假设您的过滤器被用于拒绝列表中的项目，而不是修改它们）
3.  **检查**过滤器执行的计算中的冗余。如果他们每个人都执行一些共享一些子程序的复杂计算，那么也许可以使用[记忆](http://en.wikipedia.org/wiki/Memoization)或[动态编程](http://en.wikipedia.org/wiki/Dynamic_programming)来避免冗余计算。

真的，这一切都归结为第一点，在代码的所有三个级别上**做更少的工作。**你可以通过限制外循环中的项目来减少工作量吗？通过在特定过滤器之后停止并首先执行最具选择性的过滤器来减少工作量？通过不在每个过滤器内部进行任何冗余计算来减少工作量？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T21:20:28.483

你应该这样做。诀窍是优化“使用过滤器检查数据”部分。您需要遍历所有数据并检查所有过滤器 - 您不会比这更快。

避免字符串比较，尽可能使用原生数据模型，尝试使用 减少每次传递的数据集`filter`，等等。

如果没有进一步的知识，很难为您优化它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T23:32:05.563

您应该对过滤器的应用程序进行排序，以便优化两件事：昂贵的检查应该排在最后，而消除大量数据的检查应该排在最前面。然后，您应该确保一旦出现“输出”结果，检查就被缩短了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-14T09:53:08.260

如果您的过滤器正在寻找特定值、范围或文本开头，那么 jOrder ( [http://github.com/danstocker/jorder](http://github.com/danstocker/jorder) ) 将适合您的问题。

您需要做的就是创建一个 jOrder 表，如下所示：

```
var table = jOrder(data)
    .index('name', ['name'], { grouped: true, ordered: true })
    .index('email', ['email'])
    .index('age', ['age'], { grouped: true, ordered: true, type: jOrder.number }); 
```

然后调用`table.where()`过滤表。

当您正在寻找完全匹配时：

```
filtered = table.where([{name: 'first'}, {name: 'second'}]); 
```

当您正在寻找某个字段的某个范围时：

```
filtered = table.where([{age: {lower: 20, upper: 21}}], {mode: jOrder.range}); 
```

或者，当您查找以给定字符串开头的值时：

```
filtered = table.where([{name: 'fir'}], {mode: jOrder.startof}); 
```

与嵌套循环相比，这种方式的过滤速度要快很多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T14:53:17.807

假设过滤器删除不匹配的数据，我建议您像这样切换两个循环：

```
foreach(filter) {
    foreach(data) {
        check data with filter
    }
} 
```

通过这样做，第二个过滤器不必处理所有数据，而只处理通过第一个过滤器的数据，依此类推。当然，上面的提示（比如最后做昂贵的检查）仍然是正确的，应该另外考虑。

# c# - 设计问题

> ID：753735
> 
> 赞同：1
> 
> 时间：2009-04-15T21:10:03.157
> 
> 标签：c#, asp.net

我有一个控件，我们根据某些业务规则显示一些指向不同站点的链接。目前构建链接列表的所有业务逻辑都在控制之中。我计划将业务逻辑从控件中移出。

什么是好的设计？我可以使用任何设计模式吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T21:12:35.490

[Model-View-Presenter](http://en.wikipedia.org/wiki/Model_View_Presenter)模式怎么样？

另一个不错的选择可能是[Mediator 模式](http://en.wikipedia.org/wiki/Mediator_pattern)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T22:06:47.310

你不应该太沉迷于思考模式。大多数时候，它们过于矫枉过正，增加了太多的复杂性。特别是像这样的微不足道的场景。

只要利用良好的面向对象实践，你就会没事的。将您的业务逻辑封装在另一个类中，并为您的控件提供公共属性以访问它。把事情简单化！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T22:20:23.457

你真的需要一个自定义控件吗？

[Model-View-Controller](http://en.wikipedia.org/wiki/Model-view-controller)建议您在控件中仅具有显示逻辑。

找到一个解决方案，允许您对内置控件 ( [ListView](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listview.aspx) ) 进行小幅更改，并在其他地方创建自定义数据集以传递给它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T21:50:57.600

我不确定您如何实施业务规则，但这是一个想法...

我会数据绑定您的 Web 表单列表控件。

```
public class YourLinks
{

   // You could do it by overloading the constructor...
   // Again not sure how you determine what links should be displayed...
   // If you had consistent types you could make your constructor internal
   // and then create a YourLinkBuilder see below...
   public YourLinks(User user, Region region)
   {

   }

   public YourLinks(City city)
   {

   }

   // Databind to this method...
   public IEnumerable<string> GetLinks()
   {
      // return your links...
   }

}

public class YourLinkBuilder
{
   public static YourLinks BuildPowerUserLinks()
   {
      return new YourLinks(new PowerUser(), new Region("Washington"));
   }

   public static YourLinks BuildVisitorLinks()
   {
      return new YourLinks(new VisitorUser(), new Region("Empty"));
   }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T21:54:18.340

鉴于提供的信息很少，我建议您创建一个仅包含链接（及其相关数据）的模型。这样您就可以将 LinksModel 传递给您的视图进行渲染。或者将您的 LinksModel 传递给您现有的模型（作为子模型）。

无论哪种方式，所有这些数据都被封装。因此，如果您以后想向其中添加数据，它不会更改您的方法签名（或一般合同）。如果你想从中删除数据，同样的优势。如果您想完全删除它，它只有一个对象并简化了删除。

您还可以构建链接视图渲染器，以便它并且只有它知道如何直观地显示 LinksModel。因此，在您的视图中，您可以将链接信息的视觉方面委托给此类渲染器，而不是在现有视图中使用逻辑。如果您想稍后更改链接视图的外观或想让用户能够选择不同的再现，您可以简单地使用不同的渲染器，而不是用“if”块来干扰整个代码。

杰奇！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-15T21:55:55.590

您肯定应该使用**Model-View-Presenter**。在视图中，您应该拥有自己的控制权。
控件的*职责*应该只是从用户那里获取输入，对其进行验证，并将该信息传递给演示者。然后演示者应该与存储您的业务规则的模型进行交互。

从模型中，您可能希望返回随后传递给控件以进行显示的链接，或者您可能希望返回一些传递给另一个系统以检索链接的元数据。

我要做的是在模型中使用**策略**模式，这样您就可以轻松地换入和换出不同版本的业务规则。

要抽象与后端数据源（如果有的话）的交互，请查看 Martin Fowler 的**网关**模式。

# gwt - 使用 GWT-RPC 分页 GWT-EXT 数据网格？

> ID：753743
> 
> 赞同：1
> 
> 时间：2009-04-15T21:12:12.497
> 
> 标签：gwt, gwt-rpc, gwt-ext

我需要在分页数据网格中显示来自 GWT-RPC 服务的数据。gwt-ext 展示没有提供结合 gwt-rpc 调用和数据网格的示例。这太糟糕了，因为原始的 javascript Ext 网格组件提供了分页和远程排序。如何利用 GWT 的这些特性？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T00:54:47.877

几周前我也想这样做，并且搜索了很长时间，但一无所获。最后，我编写了自己的支持 RPC/Sorting/Editing/Etc 的分页网格。

它是通用的，并且仍在进行中，但要使用它，您只需实现 TableSource 和 TableRenderer 接口，如下所示：

```
new PagedTable(new AssetTableSource(), new AssetTableRenderer(), 30); 
```

我在这里发布了代码：

[http://wiki.shiftyjelly.com/index.php/GWT#GWT_RPC_Paged_Table](http://wiki.shiftyjelly.com/index.php/GWT#GWT_RPC_Paged_Table)

随意将 PagingControl.java 中的按钮恢复为正常的 GWT 按钮。

# python - 需要构建（或以其他方式获得）python-devel 2.3 并添加到 LD_LIBRARY_PATH

> ID：753749
> 
> 赞同：2
> 
> 时间：2009-04-15T21:13:47.127
> 
> 标签：python, linux, build

我支持一个对 python-devel 2.3.7 有硬依赖的应用程序。应用程序运行嵌入的 python 解释器，尝试加载 libpython2.3.so - 但由于本地机器在 /usr/lib64 下有 libpython2.4.so，应用程序失败。

我看到有用于 python-devel 的 RPM（但不是 2.3.x 版）。另一个问题是我不想覆盖 /usr/lib 下的现有 python（反正我没有 su）。我想要做的是将某个地方放在我的主目录中（即/home/noahz/lib），并使用 PATH 和 LD_LIBRARY_PATH 指向此应用程序的旧版本。

我试图找出（但似乎无法制作正确的谷歌搜索）是​​：

1) 我在哪里下载 python-devel-2.3 或 libpython2.3.so.1.0 (如果有的话)

2a) 如果我无法下载 python-devel-2.3，我该如何从源代码构建 libpython2.3.so（已经下载了 Python-2.3.tgz 和

2b) 是从源代码构建 libpython2.3.so.1.0 并使用 LD_LIBRARY_PATH 指向它足够好，还是我会遇到其他问题（其他依赖项）

3）总的来说，我是否以正确的方式解决这个问题？

**附加信息：**

*   我试图将（ln -s）符号链接到更高版本。这导致应用程序静默失败。

*   发行版是 Red Hat Enterprise Linux 5 (RHEL5) - 适用于 x86_64

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T23:37:08.093

您可以使用从提到的 python 主页 ChristopheD 链接到的 python RPM。您可以使用 cpio 提取 RPM，因为它们只是专门的 cpio 档案。您将它们提取到主目录并设置 LD_LIBRARY_PATH 和 PATH 的方法应该有效；我一直使用它来手动构建我也安装的项目的较新版本。

不过不要专注于 -devel 包；你需要主包。您也可以解压缩 -devel 一个，但您实际使用的唯一内容是指向实际库的 libpython2.3.so 符号链接，您也可以手动创建它。

这是否是正确的方法取决于你想要做什么。如果您要做的只是让这个应用程序为您个人运行，那么这个 hack 听起来不错。

If you wanted to actually distribute something to other people for running this application, and you have no way of fixing the actual application, you should consider building an rpm of the older python version that doesn't conflict with the system-installed one.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:58:03.947

您可以使用这些 rpm 之一吗？你在哪个特定发行版上？

*   [http://www.python.org/download/releases/2.3.3/rpms/](http://www.python.org/download/releases/2.3.3/rpms/)
*   [http://rpm.pbone.net/index.php3/stat/4/idpl/3171326/com/python-devel-2.3-4.i586.rpm.html](http://rpm.pbone.net/index.php3/stat/4/idpl/3171326/com/python-devel-2.3-4.i586.rpm.html)

# dial-up - 有没有办法确定用户是使用宽带还是拨号上网

> ID：753750
> 
> 赞同：5
> 
> 时间：2009-04-15T21:13:48.687
> 
> 标签：dial-up, broadband

我们有一个客户的要求，即为宽带用户提供拨号和所有花里胡哨的“精简版”版本。

该解决方案将使用 Flex/Flash/Java EJB 和一些 jsp。

Web服务器有没有办法区分两者？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-15T21:18:52.123

你不关心用户的连接类型，你关心的是下载*速度*。

有一个小型的 Flash 应用程序，可以下载 Flash 的其余部分，并计算需要多长时间。或计算 Ajax 下载所需时间的 HTML 页面。

如果功能丰富的应用程序的下载时间过长，请将最初下载的存根页面/闪存重定向到慢速下载页面（或下载准系统闪存应用程序，或其他）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T21:18:04.730

最简单和最可靠的机制可能是让用户从下拉列表中选择他们的连接类型。很简单，我知道，但它可能会为你拯救一个悲伤的世界！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T21:20:23.490

没有办法区分宽带或拨号作为连接类型，但您可以通过连接速度做出有根据的猜测。

Gmail 会执行此操作，并在检测到时提供指向其服务的基本 HTML 版本的链接。

[![Gmail 加载基本 html 图片](https://i.stack.imgur.com/rpfoe.jpg)](https://i.stack.imgur.com/rpfoe.jpg)
[（来源：[nirmaltv.com](http://www.nirmaltv.com/wp-content/uploads/2008/05/loading-interface-for-gmail.jpg)）]

我的猜测是对 AJAX 请求进行了一些客户端 javascript 轮询。如果周转时间超过阈值，则会出现切换到“精简”的选项。

这个选项最好的部分是你**允许用户选择**他们是否想使用精简版而不是强制他们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T21:20:52.553

我认为典型的方法就是询问用户。如果您不相信您的用户会提供准确的答案，我怀疑您将不得不编写一个在客户端上运行速度测试的应用程序。通常这些记录客户端接收 x 个字节需要多长时间，并使用它来确定带宽。

Actionscript 3 有一个库可以帮助您完成这项任务，但我相信它需要您在 Flash Media Server 上部署您的 flex/flash 应用程序。有关详细信息，请参阅[ActionScript 3.0 本机带宽检测](http://www.adobe.com/livedocs/flashmediaserver/3.0/hpdocs/help.html?content=00000072.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T21:23:34.857

这是尝试类似操作的代码的简短代码片段。它在 C# 中，但很短，只是有趣的概念。

[确定客户端的连接速度](http://www.bryanavery.co.uk/post/2008/07/08/Determine-the-Connection-Speed-of-your-client.aspx)

当然，它们可能是暂时的速度问题，与您测试时的用户连接等无关。

几年前我遇到了类似的问题，只是让用户在高带宽和低带宽站点之间进行选择。我在页面上加载的第一件事就是这个选项，所以他们可以快速前进。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-15T23:44:44.877

@Apphacker（如果我有足够的声誉，我会发表评论而不是回答......）：

也不能保证反过来——我有 Earthlink 拨号，很快就会升级到 Earthlink DSL（这就是这里可用的......）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-15T21:18:24.680

您可以检查他们的 IP 并查看它是否解析/分配给拨号提供商，例如 AOL、Earthlink、NetZero。不能保证那些不解决此类提供商的人是宽带用户。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-15T21:19:04.850

你可以 ...

*   询问用户
*   执行速度测试并询问用户您找到的结果是否正确
*   进行速度测试，希望找到的结果是正确的

我认为速度测试应该足够了。

如果您只有一个小的知名用户组，有时可以通过 ip 确定连接速度。（一些提供商为拨号/宽带连接分配不同的子网）

# linq-to-sql - LinqToSql 实体 ID 何时分配？

> ID：753751
> 
> 赞同：0
> 
> 时间：2009-04-15T21:13:51.557
> 
> 标签：linq-to-sql

他们是在 SubmitChanges 分配的吗？或者当一个新对象被创建时？如果是后者，我想会有碰撞？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T21:17:39.597

如果 id 字段是自动生成的（身份/guid）字段，则在将记录插入数据库时​​分配 id。LINQToSQL 在插入后执行选择以获取分配的值并在对象中更新它。只要您不打开允许身份插入，使用身份列就不会发生冲突。如果 id 不是自动生成的，那么您将负责创建 id 并确保没有冲突。

# c# - C# 中是否有与 Groovy 等价的工具？

> ID：753753
> 
> 赞同：12
> 
> 时间：2009-04-15T21:14:45.143
> 
> 标签：c#, .net, dynamic, groovy

在 C# .net 世界中，最接近 groovy/java 组合的东西是什么？

如果我正在编写一个包含静态和动态部分的应用程序，那么 .NET 运行时上的 groovy 之类的动态部分是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-15T21:16:34.857

[Boo](http://boo.codehaus.org/)，[IronPython](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython)，[IronRuby](http://www.ironruby.net/)可能是选项。

还有其他[CLI](http://en.wikipedia.org/wiki/List_of_CLI_Languages)语言。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T21:17:30.003

Iron Python 或任何其他针对[DLR](http://en.wikipedia.org/wiki/Dynamic_Language_Runtime)的语言..

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T21:16:19.617

据我所知， [Boo](http://en.wikipedia.org/wiki/Boo_(programming_language))朝那个方向发展。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T22:05:07.097

我正在使用 Boo，它与其他 CLI 兼容代码 100% 互操作 - 在 Boo 中动态生成的代码与 c# 一起使用

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-22T15:22:45.000

您可以使用 IKVM 在 .net 中运行 Groovy

[http://groovy.codehaus.org/Running+Groovy+on+.NET+2.0+using+IKVM](http://groovy.codehaus.org/Running+Groovy+on+.NET+2.0+using+IKVM)

# objective-c - 使用常量 NSString 作为 NSUserDefaults 的键

> ID：753755
> 
> 赞同：86
> 
> 时间：2009-04-15T21:15:55.093
> 
> 标签：objective-c, cocoa, default-value

我正在使用 NSUSerDefaults 来存储用户首选项。我记得在某处读到将键设置为常量是一个好主意——我同意。以下代码是我目前拥有的：

```
[[NSUserDefaults standardUserDefaults]
        setObject:[NSNumber numberWithInt:polygon.numberOfSides] 
           forKey:@"polygonNumberOfSides"]; 
```

我尝试将其更改为：

```
@implementation Controller

NSString const *kPolygonNumberOfSides = @"polygonNumberOfSides";

-(void)savePolygonInfo {
    [[NSUserDefaults standardUserDefaults]
            setObject:[NSNumber numberWithInt:polygon.numberOfSides] 
               forKey:kPolygonNumberOfSides];
} 
```

虽然这确实有效，但它会产生“ `warning: passing argument 1 of 'objectForKey:' discards qualifiers from pointer target type`”。我热衷于让我的代码不受编译器警告的影响。我该如何解决这个警告？

* * *

## 回答 #1

> 赞同：211
> 
> 时间：2009-04-15T21:31:18.160

你应该使用：

```
NSString * const kPolygonNumberOfSides = @"..."; // const pointer 
```

代替：

```
NSString const * kPolygonNumberOfSides = @"..."; // pointer to const 
```

第一个是指向 NSString 对象的常量指针，而第二个是指向常量 NSString 对象的指针。

这是一个微妙的区别。发生编译器警告是因为`setObject:forKey:`声明如下：

```
- (void)setObject:(id)value forKey:(NSString *)defaultName; 
```

它期望`defaultName`参数是 type `NSString *`。当你传入一个指向常量的指针时，你给了它一些不同的东西。

***更新：***我想指出，这些常量应该被定义为`static`好像它们只会在单个文件中使用一样。我这样说是因为我自己也遇到过这个问题：如果你不将它们声明为静态，那么它们将存在于全局命名空间中，你将无法在另一个文件中使用同名的变量。有关详细信息，请参阅[Objective-C 中的常量。](https://stackoverflow.com/questions/538996/constants-in-objective-c)举例来说，这是我目前用于只需要在一个`.m`文件中使用的键的内容：

```
static NSString * const kSomeLabel = @"..."; 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-04-15T21:37:05.683

不要`const`与 Objective-C 对象一起使用，它们并不是真正设计用来使用它的。 `NSString`默认情况下，对象（以及许多其他对象）由于其设计而已经是不可变的，因此制作它们`const`是无用的。

正如[e.James 建议](https://stackoverflow.com/questions/753755/using-a-constant-nsstring-as-the-key-for-nsuserdefaults/753821#753821)的那样，您可以使用 an `NSString * const`，它是指向 an 的常量指针`NSString`。`const NSString *`这与 a (等价于)略有不同`NSString const *`，后者是一个指向常量的指针`NSString`。使用 a`NSString * const`可以防止您重新分配`kPoly`以指向新`NSString`对象。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2013-11-10T22:00:47.523

**对于其他类的访问：**

。H

```
extern NSString * const PolygonNumberOfSidesPrefsKey; 
```

.m

```
NSString * const PolygonNumberOfSidesPrefsKey = @"PolygonNumberOfSides" 
```

**仅在当前类内访问：**

.m

```
static NSString * const kPolygonNumberOfSidesPrefsKey = @"PolygonNumberOfSides" 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-18T12:14:14.383

我建议甚至使常数更具描述性。多边形边数的常数可以来自任何地方。作为一个建议，怎么样：

```
kDefaultsPolygonNumberOfSides; 
```

反而。

# ruby-on-rails - ActiveRecord 可以远程连接到 PostgreSQL 并保护数据库密码吗？

> ID：753759
> 
> 赞同：4
> 
> 时间：2009-04-15T21:17:05.607
> 
> 标签：ruby-on-rails, ruby, postgresql, activerecord

我在远程 VPS 服务器（CentOS 5）上有一个 PostgreSQL 数据库，我想连接一个 Rails 应用程序从我的本地 Mac 笔记本电脑连接到它。在我的笔记本电脑上，我安装了 ActiveRecord PostgreSQL 适配器—— `postgres (0.7.9.2008.01.28)`。

我在[PostgreSQL 文档](http://www.postgresql.org/docs/8.1/interactive/auth-methods.html)中读到：

> 基于密码的身份验证方法是 md5、crypt 和 password。除了通过连接发送密码的方式之外，这些方法的操作相似：分别是 MD5 散列、加密和明文。

[...]

> 如果您完全担心密码“嗅探”攻击，则首选 md5...应避免使用纯密码，尤其是对于通过开放 Internet 进行的连接（除非您使用 SSL、SSH 或其他围绕连接的通信安全包装器）。

在标准的 Rails`database.yml`中，对于 localhost 连接会有类似的东西......

```
development:
  adapter: postgresql
  database: journalapp_development
  username: xxx
  password: yyy
  host: localhost 
```

但是其中没有关于 PostgreSQL 文档中讨论的身份验证方法的内容。有没有像“ `auth_method: md5`”这样的选项？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-15T21:38:21.687

无论 Postgres 是否允许此功能，您都可以使用 SSH 隧道启用与远程数据库的安全连接。这是来自 Web 文档的免费 Stack Overflow 粘贴：

> 首先确保 SSH 服务器与 PostgreSQL 服务器在同一台机器上正常运行，并且您可以使用 ssh 作为某个用户登录。然后，您可以使用来自客户端计算机的以下命令建立安全隧道：
> 
> ssh -L 3333:foo.com:5432 joe@foo.com -L 参数中的第一个数字 3333 是您隧道一端的端口号；它可以自由选择。第二个数字 5432 是隧道的远端：您的服务器正在使用的端口号。端口号之间的名称或 IP 地址是您要连接的数据库服务器所在的主机。为了使用此隧道连接到数据库服务器，您连接到本地计算机上的端口 3333：
> 
> psql -h localhost -p 3333 postgres 对于数据库服务器，它看起来好像你真的是用户 joe@foo.com 并且它将使用为来自该用户和主机的连接配置的任何身份验证过程。请注意，服务器不会认为连接是 SSL 加密的，因为实际上它在 SSH 服务器和 PostgreSQL 服务器之间没有加密。只要它们在同一台机器上，这不应该带来任何额外的安全风险。

如果您想要更多，您可以通过搜索“SSL 隧道”或“postgres SSL 隧道”在线找到它。这是我得到上述信息的 Postgres 网站：

[http://www.postgresql.org/docs/current/static/ssh-tunnels.html](http://www.postgresql.org/docs/current/static/ssh-tunnels.html)

总结一下 Rails，您将执行以下操作：

1) 在终端窗口中，运行上面的第一个 ssh 命令来建立隧道。

2）像这样设置你的数据库道具：

```
development:
  adapter: postgresql
  database: journalapp_development
  username: xxx
  password: yyy
  host: localhost
  port: 3333 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T21:30:58.083

我在网上看了一下，似乎没有您要查找的选项，实际上客户端库[libpq](http://www.postgresql.org/docs/8.1/static/libpq.html)也没有提及这一点。

我的猜测是，这是在 libpq 中代表您协商的。无论如何，md5 很可能是默认的身份验证方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T01:42:15.280

如果您通过不安全的通道连接到 PostgreSQL 服务器，您**需要使用**[SSL](http://www.postgresql.org/docs/current/static/ssl-tcp.html)或（如 runako 解释的）[SSH Tunneling](http://www.postgresql.org/docs/current/static/ssh-tunnels.html)加密您的通信。

# c++ - 在 Vista 上清除 Listview 标题图像时出现问题

> ID：753764
> 
> 赞同：0
> 
> 时间：2009-04-15T21:17:46.167
> 
> 标签：c++, winapi, listview

我在使用 Listview 控件的 Vista 上遇到问题，特别是在标题上设置自定义图标。通常在 XP 或任何以前版本的 Windows 下，如果我添加了一个图标（在 C++ 中），我可以使用以下方法：

```
HeaderItem.mask     = HDI_FORMAT | HDI_IMAGE;
Header_GetItem(HeaderHWND, Column, &HeaderItem);

TurnOn(HeaderItem.fmt, HDF_IMAGE);
HeaderItem.iImage = Image;
if (Header_SetItem(HeaderHWND, Column, &HeaderItem) == 0)
    printf("Failed to set header [%d:%.8X]\n", GetLastError(), GetLastError()); 
```

然后要删除图像，在特定列上，我可以使用相同的过程，但不是打开 HDF_IMAGE 位，而是将其关闭。

然而，在 Vista 上，当我将其关闭时，它似乎并没有真正接受更改。所以，例如，当我开始我的 fmt 是：

0x4000（或者基本上是 HDF_STRING）

我打开图标，它变成：

0x5800（或者基本上是 HDF_STRING | HDF_IMAGE | HDF_BITMAP_ON_RIGHT）

然后我再次将其关闭，但结果是：

0x4800（或者基本上是 HDF_STRING | HDF_IMAGE）

我已经检查过了，我只将它设置为 HDF_STRING，但是一旦设置了 HDF_IMAGE，它似乎就无法删除。Header_SetImage 不返回任何错误，所以我不知道该怎么做。我也尝试从控件中删除 Imagelist，但它仍然留下空间，就好像那里仍然有图像一样。

在一天结束时，我需要能够从标题中添加和删除图标，当它们被删除时，我需要所有可用的标题空间再次可用（就像它们在显示之前一样。任何帮助将不胜感激 - 谢谢提前！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T03:33:55.857

如果您阅读文档[http://msdn.microsoft.com/en-us/library/bb775247(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb775247(VS.85).aspx)，如果您在掩码中指示 HDI_IMAGE 那么 iImage 应该是一个有效的索引，您必须将其设置为I_IMAGENONE 以删除它。

如果要删除图像，则必须执行以下操作：

```
HeaderItem.mask = HDI_FORMAT | HDI_IMAGE;
Header_GetItem(HeaderHWND, Column, &HeaderItem);
HeaderItem.fmt &= ~(HDF_IMAGE | HDF_BITMAP_ON_RIGHT);
HeaderItem.iImage = I_IMAGENONE;
Header_SetItem(HeaderHWND, Column, &HeaderItem); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:25:47.720

呃，我刚刚弄明白了——就传递的参数而言，它们现在的工作方式略有改变。

以前，当我删除 HDF_IMAGE 属性时，我总是将 iImage 设置为 0 - 但现在看起来如果你执行一个 Set，并且你的掩码包含 HDI_IMAGE，那么即使你明确地这样做，它也不会删除 HDF_IMAGE 位。

因此，解决方案是确保在尝试删除图像时不要发送任何与图像相关的内容。由于我在网上搜索并找不到任何关于此的信息，希望这篇文章现在可以帮助其他有类似问题的人。

# c# - C#：有没有办法将表达式用作变量/参数？

> ID：753773
> 
> 赞同：5
> 
> 时间：2009-04-15T21:19:59.780
> 
> 标签：c#

我想知道是否可以在 C# 中使用表达式作为变量/参数。我想做这样的事情：

```
int x = 0;
public void g()
{
   bool greaterThan = f("x>2");
   bool lessThan = f("x<2");
}
public bool f(Expression expression)
{
   if(expression)
       return true;
   else
       return false;
} 
```

这是我不想做的事情：

```
int x = 0;
public void g()
{
    bool greaterThan = f(x, '<', 2);
}

public bool f(int x, char c, int y)
{
    if(c == '<')
       return x < y;
    if(c == '>')
       return x > y;
} 
```

我真正得到的是一种使用开关或一系列 if 语句来解决每个问题的方法：< > <= >= == !=。有没有办法做到这一点？

编辑：假设表达式是一个字符串，比如“x < 2”。有没有一种方法可以在不使用条件的一系列 if 语句的情况下从字符串转到谓词？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-15T21:22:22.020

它很有可能，只是不是你所拥有的确切语法。

```
int x = 0;
public void g()
{
   bool greaterThan = f(i => i > 2, x);
   bool lessThan = f(i => i < 2, x);
}
public bool f(Func<int,bool> expression, int value)
{
   return expression(value);
} 
```

实际上，这应该更接近您想要的。

```
int x = 0;
public void g()
{
   bool greaterThan = f(() => x > 2);
   bool lessThan = f(() => x < 2);
}
public bool f(Func<bool> expression)
{
   return expression();
} 
```

* * *

回复编辑

如果你想能够说`f("x < 2")`，那几乎是不可能的。忽略解析它（这可能会变得讨厌），您必须捕获 x 的值，但它只是 的一个字符`f`，这使得它几乎不可能。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-15T21:23:16.213

如果你真的想为此传递代码，你需要一个谓词：

```
int x = 0;
public void g()
{
   bool greaterThan = f(i => i>2, x);
   bool lessThan = f(i => i<2, x);
}
public bool f(Predicate<int> expression, int value)
{
   return expression(value);
} 
```

否则，如果您只是在第一个示例中替换`bool`，`Expression`您的代码将编译得很好：

```
int x = 0;
public void g()
{
   bool greaterThan = f(x>2);
   bool lessThan = f(x<2);
}
public bool f(bool expression)
{
   if(expression)
       return true;
   else
       return false;
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-15T21:24:45.743

除非我遗漏了什么......你为什么不这样做：

```
bool greaterThan = x > 5;
bool lessThan = x < 5; 
```

布尔比较已经是一个表达式......

**编辑：**

因此，对于您的功能，只需传递一个`bool`：

```
public void f(bool expression) 
{
    // expression is either true or false...
}

f(x<5); // called like this 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T21:52:55.690

> 编辑：假设表达式是一个字符串，比如“x < 2”。有没有一种方法可以在不使用条件的一系列 if 语句的情况下从字符串转到谓词？

正如一些人已经提到的那样；如果您希望能够使用字符串，则需要解析。您真的不想编写自己的 C# 解析器，幸运的是，微软的一些人已经使用[Dynamic LINQ](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)做到了。

这是您的具体问题的解决方案：

```
public void g()
{
    int x = 0;

    bool greaterThan = f("x > 2", x);
    bool lessThan = f("x < 2", x);
}

public bool f(string expression, int x)
{
    ParameterExpression xExpr = Expression.Parameter(typeof(int), "x");

    LambdaExpression e = DynamicExpression.ParseLambda(
        new ParameterExpression[] { xExpr }, typeof(bool), expression);

    return (bool)e.Compile().DynamicInvoke(x);
} 
```

现在，很明显，这会因为字符串中最轻微的拼写错误而爆炸。你真的需要考虑你是否真的需要这个。但是如果你真的这样做了，你可以使用该`DynamicExpression.ParseLambda`方法将字符串解析为`LambdaExpression`s。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T21:25:28.253

> 编辑：假设表达式是一个字符串，比如“x < 2”。有没有一种方法可以在不使用条件的一系列 if 语句的情况下从字符串转到谓词？

您可以使用几种技巧将字符串转换为 .Net 中的代码：CodeDom、Reflection.Emit，甚至在 shell 中编写编译器脚本。然而，这些都不像`eval()`脚本语言那样简单，除非你真的知道你在做什么，否则这在 .Net 中通常是不受欢迎的。

相反，.Net 将`System.Addin`命名空间作为一种更安全的方式来允许用户扩展您的应用程序。

# sql-server - T-SQL 字段解析

> ID：753774
> 
> 赞同：0
> 
> 时间：2009-04-15T21:20:01.107
> 
> 标签：sql-server, tsql

3rd 方数据库中有一个字段，我需要对我正在编写的报告进行分组。该字段可以包含几种不同类型的数据。首先，它可以包含一个 3 位数字。我需要将它们分成诸如 101 到 200 和 201 到 300 之类的组。除此之外，该字段还可以以特定字母开头，例如 M 或 K，然后是一些数字。它被定义为 VARCHAR(8) 并且对于我如何处理可能以特定字母开头或落在数字范围内的这两种情况的任何帮助将不胜感激。如果我可以将其写为案例陈述并根据数值或第一个字母返回一个部门，那将是最好的，这样我就可以在我的报告中进行分组。

谢谢，史蒂文

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T21:25:17.613

> 如果我可以将其写为案例陈述并根据数值或第一个字母返回一个部门，那将是最好的，这样我就可以在我的报告中进行分组。

```
case when substring( field, 1, 1 ) = 'M' then ...
when substring( field, 1, 1 ) = 'K" then ...
else floor( (cast( field as int) - 1 ) / 100) end 

   select ....
   group by 
    case when substring( field, 1, 1 ) = 'M' then ...
    when substring( field, 1, 1 ) = 'K" then ...
    else floor( (cast( field as int) - 1 ) / 100) end 
```

马特汉密尔顿问，

> 为什么您选择使用 substring(field, 1, 1) 而不是简单的 left(field, 1)？我注意到@jms 在另一个答案中也这样做了。

我知道`substring`是在 ANSI-92 中指定的；我不知道那`left`是。无论如何，`left`它不是一个原始的，因为它可以用 来写`substring`，所以使用`substring`看起来更干净一些。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:27:36.687

```
select
CASE  (CASE WHEN substring(field,1,1) between 0 and 9 then 'N' Else 'C' END)
WHEN 'N' THEN
    CASE field
        WHEN ... THEN ...
        WHEN ... THEN ...
    END
WHEN 'C' THEN
    CASE field
        WHEN ... THEN ...
        WHEN ... THEN ...
    END
END 
```

# delphi - Delphi 中的 Turbo Power systools stExport 事件

> ID：753785
> 
> 赞同：0
> 
> 时间：2009-04-15T21:22:13.410
> 
> 标签：delphi, events, delphi-7, turbopower

我正在使用 systools 软件包中的 turbopower 的 stExport。使用它来导出数据集。这很好用。该类使 FOnExportProgress 可用。此类没有可视组件，因此没有对象检查器可以简单地双击并让 delphi 为我创建事件。谁能提供一个如何手动创建事件的简单示例？

对于大多数可视化组件，delphi 为您提供了这个。例子：

```
procedure TForm1.Button1Click(Sender: TObject);
begin
 //code here
end; 
```

如何手动创建它。

我在下面包含了一些与该事件相关的类。

```
type
  TStExportProgressEvent = procedure (Sender : TObject; Index : Integer;
    var Abort : Boolean) of object;

FOnExportProgress : TStExportProgressEvent;
    FOnQuoteField : TStOnQuoteFieldEvent;

if Assigned(FOnExportProgress) then
        FOnExportProgress(self, Count, Abort); 
```

如何手动分配 OnExportProgress。

请包括一个简单的例子！

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T21:43:42.187

假设这一切都发生在您的表单中

```
type
  TForm1 = class(TForm)
  published
    procedure FormCreate(Sender: TObject);
  private
    FMyExport : TStDBtoCSVExport;
    procedure TForm1.MyExportProgressHandler(Sender : TObject; Index : Integer;
                                             var Abort : Boolean);        
  end;

procedure TForm1.Create(inOwner);
begin
  FMyExport := TStDBtoCSVExport.Create;
  FMyExport.OnExportProgress := MyExportProgressHandler;
end;

procedure TForm1.MyExportProgressHandler(Sender : TObject; Index : Integer;
                                         var Abort : Boolean);
begin
  { anything you like }
end; 
```

# c# - SQL Server 2005 插入父/子 xml 数据

> ID：753789
> 
> 赞同：0
> 
> 时间：2009-04-15T21:23:23.610
> 
> 标签：c#, sql-server, xml, ado.net, bulkinsert

给定一个如下所示的 xml 文档：

```
 <parentRecords>
    <parentRecord field1="foo" field2="bar">
      <childRecord field1="test" field2="text" />
      <childRecord field1="test2" field2="text2" />
    </parentRecord>
    <parentRecord field1="foo2" field2="bar2">
      <childRecord field1="test3" field2="text3" />
      <childRecord field1="test4" field2="text4" />
    </parentRecord>
  </parentRecords> 
```

在 SQL Server 2005 中，将此文档传递到存储过程中的最快方法是什么，该存储过程会将父记录和子记录插入一组表中，其中父表具有标识列，子表通过以下方式引用父表外键？

```
ParentTable
-----------
ParentID identity PK int
Field1 nvarchar
Field2 nvarchar

ChildTable
----------
ChildID identity PK int
ParentID FK int
Field1 nvarchar
Field2 nvarchar 
```

我正在使用带有 C# 的 ADO.NET 和 .NET 3.5。我可以选择将数据作为 xml 参数类型或文本类型发送。我可以使用新奇的 sql 2005 XQuery 东西或老式的 SQL 2000 OPENXML 风格。或者，如果实际上可以使用 SqlBulkInsert 或类似的方法来完成这些插入，那么我对最快的方法感到失望（在这种情况下性能很重要。）感谢您的帮助！

* * *

**编辑：**

看起来插入父/子集确实像看起来一样困难。我无法尝试学习 LINQ to SQL 并将该框架集成到我的产品中（我们在这里处于开发周期！）并且我无法使用 Xml Bulk Insert 工具获得很大的吸引力，尽管它看起来可用于此目的。最后，我重组了表以在两个表上使用 GUID 主键，并在 API 中生成完整记录。然后我就可以使用 ADO 2.0 SqlBulkInsert 高速发送数据了。将答案授予 Daniel Miller，因为 SQL Server Bulk Load 在不完全重新构建我的应用程序的情况下获得了最大的成功机会。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-16T06:18:40.733

像这样的东西将提取父母，然后是具有父母字段的孩子

```
DECLARE @fooxml xml

SET @fooxml = N'<parentRecords>
    <parentRecord field1="foo" field2="bar">
      <childRecord field1="test" field2="text" />
      <childRecord field1="test2" field2="text2" />
    </parentRecord>
    <parentRecord field1="foo2" field2="bar2">
      <childRecord field1="test3" field2="text3" />
      <childRecord field1="test4" field2="text4" />
    </parentRecord>
  </parentRecords>'

SELECT
    x.item.value('@field1', 'varchar(100)') AS field1,
    x.item.value('@field2', 'varchar(100)') AS field2
FROM
    @fooxml.nodes('/parentRecords/parentRecord') x(item)

SELECT
    x.item.value('@field1', 'varchar(100)') AS field1,
    x.item.value('@field2', 'varchar(100)') AS field2,
    y.item.value('@field2', 'varchar(100)') AS childfield2,
    y.item.value('@field2', 'varchar(100)') AS childfield2
FROM
    @fooxml.nodes('/parentRecords/parentRecord') x(item)
    CROSS APPLY
    x.item.nodes('./childRecord') AS y(item) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-05-23T18:01:51.110

通过使用合并，我们可以同时插入父数据和子数据

```
Create table #Master
(
 Id int Identity(1,1),
 MasterName Varchar(100)
)

Create Table #Intermediate
(MasterId int,
 ChildData XML)

 Create Table #Child
 (
 ChildId int identity(1,1),
 MasterId int,
 ChildName Varchar(100)
 )

Declare @XML XML='<Record>
                     <MasterRecord>
                        <Master>Master1</Master>
                        <ChildRecord>
                            <Child>Child11</Child>
                            <Child>Child12</Child>
                        </ChildRecord>
                     </MasterRecord>
                     <MasterRecord>
                        <Master>Master2</Master>
                        <ChildRecord>
                            <Child>Child21</Child>
                            <Child>Child22</Child>
                        </ChildRecord>
                     </MasterRecord>
                  </Record>'

MERGE #Master _MTR
USING (Select x.value('Master[1]','varchar(255)') AS masterName ,
              x.query('ChildRecord/Child') AS ChildData          
              From @XML.nodes('/Record/MasterRecord') e(x)) AS _XML
ON 1=0
WHEN NOT MATCHED THEN
INSERT (MasterName)
VALUES(_XML.MasterName)
OUTPUT INSERTED.Id, _XML.ChildData
INTO #Intermediate(MasterId,ChildData);

Insert Into #Child(MasterId,ChildName) 
Select  mas.Id, _data.value('(text())[1]', 'varchar(100)') as ChildName
from #Intermediate intr Inner Join #Master Mas
     On intr.MasterId=Mas.Id
CROSS APPLY ChildData.nodes('/Child') AS _chd(_data)

Select * from #Master
Select * from #Intermediate
select * from #Child 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T01:49:37.540

听起来您需要[SQL Server XML 批量加载](http://msdn.microsoft.com/en-us/library/ms171769.aspx)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-15T21:25:20.623

考虑 LINQ to SQL。它实际上会简化你。

# java - 如何为 MyLocationOverlay 中的“你在这里”点使用自定义位图？

> ID：753793
> 
> 赞同：2
> 
> 时间：2009-04-15T21:24:38.957
> 
> 标签：java, android, bitmap, android-mapview, mylocationoverlay

我已经倾注了文档，但无法弄清楚这一点。甚至可能吗？

[请看这个](http://developer.android.com/reference/com/google/android/maps/MyLocationOverlay.html)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-15T21:40:00.417

看起来这样做的正确机制是扩展 MyLocationOverlay 然后覆盖 drawMyLocation() 受保护的方法。

以下使用箭头显示“你”在哪里以及“你”指向哪个方向：

 `````
package com.example;

import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.Canvas;
import android.graphics.Matrix;
import android.graphics.Point;
import android.location.Location;
import com.google.android.maps.GeoPoint;
import com.google.android.maps.MapView;
import com.google.android.maps.MyLocationOverlay;

public class MyCustomLocationOverlay extends MyLocationOverlay {
    private Context mContext;
    private float   mOrientation;

    public MyCustomLocationOverlay(Context context, MapView mapView) {
        super(context, mapView);
        mContext = context;
    }

    @Override 
    protected void drawMyLocation(Canvas canvas, MapView mapView, Location lastFix, GeoPoint myLocation, long when) {
        // translate the GeoPoint to screen pixels
        Point screenPts = mapView.getProjection().toPixels(myLocation, null);

        // create a rotated copy of the marker
        Bitmap arrowBitmap = BitmapFactory.decodeResource( mContext.getResources(), R.drawable.arrow_green);
        Matrix matrix = new Matrix();
        matrix.postRotate(mOrientation);
        Bitmap rotatedBmp = Bitmap.createBitmap(
            arrowBitmap, 
            0, 0, 
            arrowBitmap.getWidth(), 
            arrowBitmap.getHeight(), 
            matrix, 
            true
        );
        // add the rotated marker to the canvas
        canvas.drawBitmap(
            rotatedBmp, 
            screenPts.x - (rotatedBmp.getWidth()  / 2), 
            screenPts.y - (rotatedBmp.getHeight() / 2), 
            null
        );
    }

    public void setOrientation(float newOrientation) {
         mOrientation = newOrientation;
    }
} 
````  `* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-01T09:03:53.387

我对 previuos 代码进行了一些更改，以使其正常工作，因为箭头指向错误的方向并朝相反的方向旋转。

我变了

```
matrix.postRotate(mOrientation); 
```

为了

```
matrix.postRotate(this.getRotation()); 
```

并添加到最后：

```
mapView.postInvalidate(); 
```

当箭头改变时重绘箭头

# encryption - SHA 加密如何成为可能？

> ID：753801
> 
> 赞同：3
> 
> 时间：2009-04-15T21:25:28.580
> 
> 标签：encryption, hash

### 复制：

> [对哈希感到困惑](https://stackoverflow.com/questions/745549/confused-about-hashes)

* * *

当有 n 个可能的输入字符串但只有有限数量的 40 个字符散列时，SHA 加密如何为任何字符串创建唯一的 40 个字符散列？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-15T21:26:07.080

SHA 不是加密算法，它是一种加密散列算法。

[在 Wikipedia 上查看此参考资料](http://en.wikipedia.org/wiki/SHA_hash_functions)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-15T21:30:29.940

简单的答案是它不会为任何字符串创建唯一的 40 个字符的散列 - 不同的字符串不可避免地会有相同的散列。

它确实试图确保附近的字符串具有非常不同的哈希值。40 个字符是一个很长的散列，因此除非您使用荒谬的数量，否则冲突的可能性非常低。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-15T21:28:44.500

SHA 不会为任何字符串创建唯一的 40 字符散列。如果你创建了足够多的散列，你最终会发生冲突（两个输入散列到相同的输出）。使 SHA 和其他散列函数在密码学上有用的原因在于，没有简单的方法可以找到两个具有相同散列的文件。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-15T21:30:53.857

详细说明jdigital的答案：

由于它是哈希算法而不是加密算法，因此无需反转操作。反过来，这意味着结果不需要是唯一的；（理论上）有无数个字符串会产生相同的哈希值。但是，要找出那些是实际上是不可能的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-15T21:30:50.503

像 SHA-1 或 SHA-2 系列这样的散列算法被用作“单向”散列，以支持基于密码的身份验证。找到散列到给定值的消息（密码）在计算上是不可行的。因此，如果攻击者获得哈希密码列表，他们就无法确定原始密码。

你是对的，一般来说，有无限数量的消息散列到给定值。不过还是很难找到。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-15T21:32:07.160

它不保证两个字符串会有唯一的 40 个字符散列。它的作用是使两个字符串具有冲突哈希的可能性*极低，并且如果不随机尝试输入就**很难*创建两个冲突文档。

一般来说，发生坏事的概率足够低就可以保证它永远不会发生。只要彗星撞击它时世界更有可能终结，那么碰撞哈希的可能性通常不值得担心。

当然，安全哈希算法并不完美。因为它们被用于密码学，所以它们是非常有价值的尝试和破解的东西。例如，SHA-1[已被削弱](http://www.schneier.com/blog/archives/2005/02/cryptanalysis_o.html)（您可以在比随机猜测少 2000 倍的情况下发现碰撞）；MD5已被[彻底破解](http://www.rtfm.com/movabletype/archives/2004_08.html#001055)，安全研究人员实际上[创建了两个](http://www.win.tue.nl/hashclash/rogue-ca/)MD5和相同的证书，其中一个得到了证书颁发机构的签名，从而允许他们像使用证书颁发机构签名一样使用另一个证书. 你不应该盲目相信加密哈希；一旦一个被削弱（如 SHA-1），就该寻找新的哈希值了，这就是为什么目前[存在竞争](http://csrc.nist.gov/groups/ST/hash/sha-3/index.html)创建一个新的标准哈希算法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-15T21:47:58.947

该功能类似于：

```
hash1 = SHA1(plaintext1)
hash2 = SHA1(plaintext2) 
```

现在，hash1 和 hash2 在*技术上*可以是相同的。这是一个碰撞。不常见，但可能，而且不是问题。

真正的魔力在于不可能做到这一点：

```
plaintext1 = SHA1-REVERSE(hash1) 
```

所以你永远无法逆转它。如果您不想知道密码是什么，这很方便，只是用户两次都给了您相同的密码。想想看。你有 1024 字节的输入。你得到 40 位的输出。你怎么能从 40 个字节中重建那些 1024 个字节 - 你把信息扔掉了。这是不可能的（好吧，除非你设计算法允许它，我猜......）

此外，如果 40 位还不够，请使用 SHA256 或具有更大输出的东西。和盐它。盐很好。

哦，顺便说一句：任何通过电子邮件向您发送密码的网站都不会对其密码进行哈希处理。它要么以未加密的方式存储它们（运行，运行尖叫），要么使用 2 路加密（DES、AES、公私钥等 - 多信任它们*）*对它们进行加密

网站能够通过电子邮件向您发送密码或需要存储除哈希之外的任何内容的理由为零。/咆哮。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-15T21:31:04.887

很好的观察。简短的回答它不能并导致可以在[生日攻击](http://en.wikipedia.org/wiki/Birthday_attack)中利用的碰撞。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-15T22:13:19.213

简单的答案是：它不会创建唯一的哈希值。看看[Pidgeonhole 原理](http://en.wikipedia.org/wiki/Pigeonhole_principle)。发生没有人发现的碰撞的可能性很小。

# asp.net-mvc - ASP.NET MVC 和 jQuery - ajax 编码问题

> ID：753807
> 
> 赞同：0
> 
> 时间：2009-04-15T21:27:22.023
> 
> 标签：asp.net-mvc, jquery

我正在使用它来将一些数据保存到数据库：

```
$("#btnSave").click(function () {
    $.ajax({
        type: 'POST',
        contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        data: 'description=' + oEditor.GetXHTML(),
        url: '/SuperAdmin/ReceiveData/',
        success: function () {
            alert('news saved');
        }
    });
}); 
```

“oEditor.GetXHTML”取自 FCKEditor。而且，为了接收这些数据，我有一个 ASP.NET MVC 方法（ActionResult）：

```
public void ReceiveData(string description)
{
} 
```

关键是：例如，当我发送这句话时，**包括“JavaScript 集成模块”脚本**，ReceiveData 方法只会获取直到**包括**...之后的内容不会出现。

在上面调试我的 jQuery 函数时，我看到我试图传递给该方法的句子有 HTML 编码，带有 &, amp; 等等。并且**..."JavaScript 集成模块"...**的双引号被 ReceiveData 方法解释为参数，因为双引号在其编码中具有 '&'。

那么，如何在发送到 MVC 方法之前将此 '"e' 转换为 "？或者有没有办法让此方法将此 '"e' 识别为字符而不是参数？

谢谢！！！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T21:31:02.747

使用`escape(oEditor.GetXHTML())`.

# objective-c - 子视图未显示在 UIView 类中

> ID：753813
> 
> 赞同：0
> 
> 时间：2009-04-15T21:29:45.560
> 
> 标签：objective-c, uiview, subview

我正在尝试使用 addSubview 在代码中布置一些图像，但它们没有显示出来。

我创建了一个子类UIView的类（myUIView），然后将IB中的nib文件的类更改为myUIView。

然后我输入了以下代码，但仍然得到一个空白的灰色屏幕。

```
- (id)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) {
        // Initialization code
        [self setupSubviews];
    }
    return self;
}

- (void)setupSubviews
{
    self.backgroundColor = [UIColor blackColor];

    UIImageView *black = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"black.png"]];
    black.center = self.center;
    black.opaque = YES;

    [self addSubview:black];

    [black release];
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-11-13T12:57:16.493

是的，只需实现 initWithCoder。

当从代码动态创建 UIView 时调用 initWithFrame。从 .nib 文件加载的视图始终使用 initWithCoder 进行实例化，编码器负责从 .nib 文件中读取设置

我习惯在一个单独的方法中进行初始化，同时实现 initWithCode 和 initWithFrame （以及我自己的初始化方法，当需要时）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:33:18.297

尝试实施`initWithCoder:`有时我遇到了 IB 问题，并且`initWithFrame:`

或者至少添加一个日志调用以查看您的 init 方法是否已执行

# cocoa-touch - 在 navigationItem.titleView 中将浮雕添加到 UILabel（如 navigationItem.title 所示）

> ID：753822
> 
> 赞同：5
> 
> 时间：2009-04-15T21:31:36.240
> 
> 标签：cocoa-touch, user-interface, uikit

我正在尝试模仿自动应用于 navigationItem.title 以及许多其他 UIKit 控件的默认浮雕。

如此屏幕截图的标题（“表格单元格”）所示：

[浮雕标题 http://quicksnapper.com/files/3440/192219267049D92BB23DE74.png](http://quicksnapper.com/files/3440/192219267049D92BB23DE74.png)

我实际上是在尝试将 2 个 UILabel 添加到 navigationItem.titleView，但是 UILabel 只是显示为平面绘制，而且它真的感觉/看起来不正确：P

我曾考虑过使用阴影，但这只会在标签的一侧产生浮雕外观（即使是这样）。

任何想法都会很棒！

谢谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-16T01:57:08.397

耶谢谢！我刚刚想通了：

在 postTitle 设置为白色的地方，我只是添加了一个垂直偏移为 1px 的深灰色阴影。

`[postTitle setShadowColor:[UIColor darkGrayColor]];`

`[postTitle setShadowOffset:CGSizeMake(0, -1)];`

看起来与您放入 .title 中的任何内容一模一样 :)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-15T21:35:39.617

我认为 shadow 和 shadowOffset 是您要寻找的。在标签上设置这些属性，它应该做你想做的事。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-29T11:21:38.373

一个白色的阴影和一个加一而不是一个负一作为偏移量给出了压抑的浮雕外观。

# bash - 如何将 shell 命令应用于嵌套（且转义不佳）子目录中的许多文件？

> ID：753823
> 
> 赞同：6
> 
> 时间：2009-04-15T21:32:01.730
> 
> 标签：bash, shell, find, for-loop, escaping

我正在尝试执行以下操作：

```
for file in `find . *.foo`
do
somecommand $file
done 
```

但是该命令不起作用，因为 $file 非常奇怪。因为我的目录树有蹩脚的文件名（包括空格），我需要转义`find`命令。但似乎没有一个明显的转义符起作用： `-ls`给我以空格分隔的文件名片段 `-fprint`并没有更好的效果。

我也试过： `for file in "`找到 . *.foo -ls`"; do echo $file; done - but that gives all of the responses from find in one long line.`

有什么提示吗？我很高兴有任何解决方法，但很沮丧我无法弄清楚这一点。

谢谢，亚历克斯

（嗨，马特！）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-16T06:17:23.247

您有很多答案可以很好地解释如何做到这一点；但为了完整起见，我将重复并添加：

`xargs`仅对交互式使用有用（当您知道所有文件名都是普通的 - 没有空格或引号时）或与`-0`选项一起使用时。否则，它会破坏一切。

`find`是一个非常有用的工具；put 使用它来将文件名通过管道传输到`xargs`（即使使用`-0`）相当复杂，因为`find`它可以自己完成，`-exec command {} \;`或者`-exec command {} +`取决于你想要的：

```
find /path -name 'pattern' -exec somecommand {} \;
find /path -name 'pattern' -exec somecommand {} + 
```

前者在match 中递归地为每个文件`somecommand`运行**一个参数**。`/path``pattern`

后者在该 match中以递归方式一次在命令行上`somecommand`使用**尽可能多的参数**运行文件。`/path``pattern`

使用哪一个取决于`somecommand`. 如果它可以采用多个文件名参数（如`rm`,`grep`等），那么后一个选项会更快（因为你运行`somecommand`的频率要低得多）。如果`somecommand`只接受一个参数，那么您需要前一种解决方案。所以看看`somecommand`'s man page。

更多关于`find`：[http://mywiki.wooledge.org/UsingFind](http://mywiki.wooledge.org/UsingFind)

In `bash`,`for`是一个迭代**参数**的语句。如果你做这样的事情：

```
for foo in "$bar" 
```

你给了`for` **一个**参数来迭代（注意引号！）。如果你做这样的事情：

```
for foo in $bar 
```

您要求在有空格、制表符或换行符的地方（从技术上讲，任何字符在 中）都`bash`将其内容`bar`撕开，`IFS`并将该操作的各个部分用作 for 的参数。 **那不是文件名**。假设在一堆文件名中存在空格的地方将包含文件名的长字符串撕裂的结果是错误的。正如你刚刚注意到的那样。

答案是：不要使用`for`，这显然是错误的工具。上述`find`命令都假定它`somecommand`是`PATH`. 如果它是一个`bash`语句，则您将需要此构造（迭代`find`' 的输出，就像您尝试过的那样，但安全）：

```
while read -r -d ''; do
    somebashstatement "$REPLY"
done < <(find /path -name 'pattern' -print0) 
```

这使用一个`while-read`循环读取部分字符串`find`输出，直到它到达一个`NULL`字节（这是`-print0`用来分隔文件名的）。由于`NULL`字节不能是文件名的一部分（与空格、制表符和换行符不同），这是一个安全的操作。

如果您不需要`somebashstatement`成为脚本的一部分（例如，它不会通过保留计数器或设置变量等来更改脚本环境），那么您仍然可以使用`find`'s`-exec`来运行您的`bash`语句：

```
find /path -name 'pattern' -exec bash -c 'somebashstatement "$1"' -- {} \;
find /path -name 'pattern' -exec bash -c 'for file; do somebashstatement "$file"; done' -- {} + 
```

在这里，`-exec`执行`bash`带有三个或更多参数的命令。

1.  要执行的 bash 语句。
2.  一个`--`。 `bash`会把这个放进去`$0`，你可以把任何你喜欢的东西放在这里，真的。
3.  您的文件名或文件名（取决于您是否使用`{} \;`或`{} +`分别）。文件名以`$1`（当然，如果有多个文件名，还有`$2`, , ...）结束。`$3`

此处第一个命令中的`bash`语句以文件名作为参数运行。`find``somebashstatement`

这里第二个命令中的`bash`语句运行一个( **!** ) 循环，该循环遍历每个位置参数（这就是简化的语法 - - 所做的）并以文件名作为参数运行 a 。我展示的第一个语句之间的区别在于，我们只为大量文件名运行一个进程，但仍然为**每个**文件名运行一个进程。`find``for`**`for``for foo; do``somebashstatement``find``-exec {} +``bash``somebashstatement`**

 ****`UsingFind`所有这些在上面链接的页面中也得到了很好的解释。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-15T21:34:58.323

与其依靠 shell 来完成这项工作，不如依靠 find 来完成：

```
find . -name "*.foo" -exec somecommand "{}" \; 
```

然后文件名将被正确转义，并且永远不会被 shell 解释。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T21:35:57.480

```
find . -name '*.foo' -print0 | xargs -0 -n 1 somecommand 
```

但是，如果您需要在每个项目上运行多个 shell 命令，它确实会变得混乱。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T21:35:40.350

[xargs](http://en.wikipedia.org/wiki/Xargs)是你的朋友。您还需要使用它来研究 -0（零）选项。 `find`(with `-print0`) 将有助于生成列表。维基百科页面有一些很好的例子。

另一个有用的使用理由`xargs`是，如果你有很多文件（几十个或更多），xargs 会将它们拆分为单独的调用，然后调用任何 xargs 来运行（在第一个维基百科示例中，`rm`）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-16T01:49:14.110

```
find . -name '*.foo' -print0 | xargs -0 sh -c 'for F in "${@}"; do ...; done' "${0}" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T21:24:55.950

I had to do something similar some time ago, renaming files to allow them to live in Win32 environments:

```
#!/bin/bash
IFS=$'\n'
function RecurseDirs
{
for f in "$@"
do
  newf=`echo "${f}" | sed -e 's/[\\/:\*\?#"\|<>]/_/g'`
  if [ ${newf} != ${f} ]; then
    echo "${f}" "${newf}"
    mv "${f}" "${newf}"
    f="${newf}"
  fi
  if [[ -d "${f}" ]]; then
    cd "${f}"
    RecurseDirs $(ls -1 ".")
  fi
done
cd ..
}
RecurseDirs . 
```

This is probably a little simplistic, doesn't avoid name collisions, and I'm sure it could be done better -- but this does remove the need to use basename on the find results (in my case) before performing my sed replacement.

I might ask, what are you doing to the found files, exactly?

# c# - 微软 AJAX 部分回帖，是使用 webservice 的最佳实践吗？

> ID：753830
> 
> 赞同：0
> 
> 时间：2009-04-15T21:33:54.783
> 
> 标签：c#, asp.net, web-services, asp.net-ajax

我在这里真的很困惑，因为我阅读了很多地方，更新面板会回复完整的帖子，并且我以某种方式理解网络服务在性能方面要好得多，所以如果我正在开发我的网站，我应该使用网络服务还是正常功能像下面这样

```
 protected void Page_Load(object sender, EventArgs e)
{
  GetDate();
}
protected void Button1_Click(object sender, EventArgs e)
{

}
[WebMethod()]
protected DateTime GetDate()
{
    return DateTime.Now;
} 
```

*   我会使用回邮吗？
*   Web 服务的缺陷是什么，特别是在 AJAX 网站中？
*   您对使用 Microsoft AJAX 获得最佳性能有何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T21:46:10.933

Web 服务可以让您解决整个视图状态的混乱。
但是，是的，我认为使用 Web 服务作为在 Web 世界中获得最大收益的最佳实践。

尽可能避免回邮/回电。

陷阱：创建 Web 服务时，您必须通过 ViewState 传递通常拥有的所有数据。

我强烈推荐学习 JQuery。这将有很大帮助。

至于 Web 服务性能：使用 JSON (ScriptMethod) 而不是 XML 来回移动数据。

编辑：关于 ViewState 混乱。如果您不小心 ViewState（用于序列化控件，并且是页面上的隐藏字段）会很快变得非常大。每次回发时，此数据都会从浏览器发送到服务器——但不会用于 Web 服务。这可以使 Web 服务调用比回发快得多（对于具有大 ViewStates 的页面）。ViewState 并不邪恶，但您想密切关注它。

回发可以发生在带有 runat='server' 的 web 控件和在服务器上执行的代码之间的任何转换。例如：按钮点击事件导致回发。

Asp.Net 开发人员喜欢回发，因为它们易于实现（IDE 会为您连接它们）。
Web 服务稍微难一些，需要一些（少量）JavaScript 知识。

另一个简单的选择是使用 UpdatePanels。但是仍然使用 ViewState。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T21:45:03.947

就个人而言，我会考虑使用 jQuery 来调用 ASP.NET MVC 操作；更简单的管道，并且您确切地知道线路上下移动的是什么。

# c# - 将击键发送到 TextBox

> ID：753833
> 
> 赞同：0
> 
> 时间：2009-04-15T21:34:44.643
> 
> 标签：c#

我有一个派生的 TextBox，我在其中拦截用户输入以对其进行操作。但是我必须保留原始类型的输入。所以我的想法是在我的派生类中保存一个内部 TextBox，并在操作之前将用户的输入发送到该 TextBox。

采用这种方法的原因是我不想处理所有这些特殊操作，例如：输入某些内容、ctrl+a、[del]、输入其他内容、[退格] 等等......

但是我不知道如何将单个击键（keycode、ascii、char）发送到 TextBox。也许你有另一个没有内部 TextBox 的想法？谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T21:48:28.463

如果我理解正确，您可以让内部文本框获得键盘焦点并处理输入。然后你可以在你的容器类中处理它的[`KeyDown`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.keydown(loband).aspx)//事件来“拦截”输入[`KeyUp`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.keyup(loband).aspx)。[`KeyPress`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.keypress(loband).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T21:50:10.893

您可能不想使用键盘级别的操作，因为有一些方法可以在没有键盘的情况下更改文本（特别是使用复制、剪切和粘贴）。为什么不使用 Text 属性从原始文本框中获取文本然后保存呢？

# c# - 如何从 ThreadPool.QueueUserWorkItem 中捕获异常？

> ID：753841
> 
> 赞同：44
> 
> 时间：2009-04-15T21:37:31.377
> 
> 标签：c#, .net, multithreading, threadpool

我有以下引发异常的代码：

```
ThreadPool.QueueUserWorkItem(state => action()); 
```

当操作引发异常时，我的程序崩溃。处理这种情况的最佳做法是什么？

* * *

相关：[.Net ThreadPool 线程的异常](https://stackoverflow.com/questions/668265)

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-04-15T21:43:34.513

您可以像这样添加 try/catch：

```
 ThreadPool.QueueUserWorkItem(state =>
                                         {
                                             try
                                             {
                                                 action();
                                             }
                                             catch (Exception ex)
                                             {
                                                 OnException(ex);
                                             }
                                         }); 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-04-15T21:41:50.443

如果您有权访问`action`的源代码，请在该方法中插入一个 try/catch 块；否则，创建一个`tryAction`将调用包装`action`在 try/catch 块中的新方法。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2011-09-12T18:51:07.850

如果您使用的是 .Net 4.0，则可能值得研究[Task](http://msdn.microsoft.com/en-us/library/system.threading.tasks.task.aspx)类，因为它可以为您解决这个问题。

相当于您的原始代码，但使用任务，看起来像

```
Task.Factory.StartNew(state => action(), state); 
```

要处理异常，您可以向 StartNew 返回的任务添加延续。它可能看起来像这样：

```
var task = Task.Factory.StartNew(state => action(), state);
task.ContinueWith(t => 
     {
        var exception = t.Exception.InnerException;
        // handle the exception here
        // (note that we access InnerException, because tasks always wrap
        // exceptions in an AggregateException)
     }, 
     TaskContinuationOptions.OnlyOnFaulted); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-15T21:41:28.743

在另一个线程上，（在您“排队”的方法中，添加一个 try catch 子句......然后在 catch 中，将捕获的异常放入共享的异常变量中（对主线程可见）。

然后在您的主线程中，当所有排队的项目都完成时（为此使用等待句柄数组）检查是否某个线程用异常填充了该共享异常...如果确实如此，请重新抛出它或根据需要处理它...

这是我最近使用的一个项目中的一些示例代码...
HasException 是共享布尔值...

```
 private void CompleteAndQueuePayLoads(
           IEnumerable<UsagePayload> payLoads, string processId)
    {
        List<WaitHandle> waitHndls = new List<WaitHandle>();
        int defaultMaxwrkrThreads, defaultmaxIOThreads;
        ThreadPool.GetMaxThreads(out defaultMaxwrkrThreads, 
                                 out defaultmaxIOThreads);
        ThreadPool.SetMaxThreads(
            MDMImportConfig.MAXCONCURRENTIEEUSAGEREQUESTS, 
            defaultmaxIOThreads);
        int qryNo = 0;
        foreach (UsagePayload uPL in payLoads)
        {
            ManualResetEvent txEvnt = new ManualResetEvent(false);
            UsagePayload uPL1 = uPL;
            int qryNo1 = ++qryNo;
            ThreadPool.QueueUserWorkItem(
                delegate
                    {
                        try
                        {
                            Thread.CurrentThread.Name = processId + 
                                                      "." + qryNo1;
                            if (!HasException && !uPL1.IsComplete)
                                 IEEDAL.GetPayloadReadings(uPL1, 
                                                  processId, qryNo1);
                            if (!HasException) 
                                UsageCache.PersistPayload(uPL1);
                            if (!HasException) 
                                SavePayLoadToProcessQueueFolder(
                                             uPL1, processId, qryNo1);
                        }
                        catch (MeterUsageImportException iX)
                        {
                            log.Write(log.Level.Error,
                               "Delegate failed "   iX.Message, iX);
                            lock (locker)
                            {
                                HasException = true;
                                X = iX;
                                foreach (ManualResetEvent 
                                          txEvt in waitHndls)
                                    txEvt.Set();
                            }
                        }
                        finally { lock(locker) txEvnt.Set(); }
                    });
            waitHndls.Add(txEvnt);
        }
        util.WaitAll(waitHndls.ToArray());
        ThreadPool.SetMaxThreads(defaultMaxwrkrThreads, 
                                 defaultmaxIOThreads);

        lock (locker) if (X != null) throw X;
    } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-15T21:41:12.630

我通常做的是在 action() 方法中创建一个大的 try ... catch 块，然后将异常存储为私有变量，然后在主线程中处理它

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-06-18T05:20:39.997

简单代码：

```
public class Test
{
    private AutoResetEvent _eventWaitThread = new AutoResetEvent(false);

    private void Job()
    {
        Action act = () =>
        {
            try
            {
                // do work...
            }
            finally
            {
                _eventWaitThread.Set();
            }
        };
        ThreadPool.QueueUserWorkItem(x => act());
        _eventWaitThread.WaitOne(10 * 1000 * 60);
    }
} 
```

# windows-mobile - 如何自动更新 Windows Mobile 应用程序

> ID：753851
> 
> 赞同：8
> 
> 时间：2009-04-15T21:41:47.310
> 
> 标签：windows-mobile, compact-framework, installation, clickonce

我有一个 .net cf 3.5 Windows Mobile 应用程序，我的客户希望它具有自动更新功能。

这是我到目前为止所拥有的：

1.  使用智能设备 CAB 项目创建一个 CAB（这是否足够好，或者我应该在这里做其他事情）

2.获取应用版本号

```
Assembly.GetExecutingAssembly().GetName().Version.ToString(); 
```

3.  调用 WCF Web 服务进行版本号查找。
4.  下载新版本的 cab 文件。
5.  ？？？
6.  对 CAB 文件执行 WCELoad.exe
7.  利润

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-09-23T00:30:49.427

我刚刚发布了 WmAutoUpdate，这是一个 .NET c# 框架，它将在 Compact Framework 上进行自动更新。它在 Github 上免费提供：http: [//github.com/seboslaw/wmautoupdate](http://github.com/seboslaw/wmautoupdate)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-15T23:05:34.987

您的解决方案通常是正确的，但存在一些问题。

1.  你不能更新自己。您必须关闭并让一些 otehr 应用程序更新您以防止文件共享问题。这通常通过您启动的专用“更新程序”应用程序来处理。它可能是应用程序图标的目标，因此每次启动都会更新，或者它可能通过“检查更新”类型的菜单项启动。无论如何，您必须启动它并确保实际的应用程序没有运行。
2.  在安装损坏、中断的情况下提供某种形式的备份通常是个好主意
3.  CAB 更新将需要对所有内容进行大规模更新。这最终可能不是您想要的（您可能只想更新单个文件、程序集或其他任何东西），因此从下拉单个文件的逻辑开始将使您更具可扩展性。

一个旧的但仍然非常有效的资源是 Alex Feinman[关于创建自更新应用程序的 MSDN 文章](http://msdn.microsoft.com/en-us/library/aa446487.aspx)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-08-18T09:18:38.433

没有必要创建一个专门的应用程序来更新，至少不是在带有 .netcf 3.5 的 WM 6 上。我正在使用 web 服务下载 .cab 文件，然后启动一个新进程并调用 wceload 进行静默 cab 安装。这负责关闭我正在运行的应用程序，将其卸载，然后执行安装，如 [MSDN 文档中所述](http://msdn.microsoft.com/en-us/library/bb158700.aspx)

> 在 Windows Mobile 5.0 及更高版本中，当使用 Wceload.exe 重新安装 .cab 文件时，Wceload.exe 会在安装新版本之前卸载以前安装的 .cab 文件版本。在此过程的卸载部分，Wceload.exe 会根据文件名关闭使用 .cab 文件安装在目标设备上的所有当前运行的可执行文件。Wceload.exe 还会关闭任何作为文件操作目标的可执行文件，例如移动或复制。为了关闭可执行文件，Wceload.exe 将 WM_CLOSE 发送到进程拥有的所有顶级窗口。如果进程收到WM_CLOSE消息后没有及时退出，则Wceload.exe通过调用TerminateProcess将其强制关闭。Wceload.exe 不会尝试关闭目标设备上运行时映像中附带的可执行文件。

我还有一个 cesetup.dll 用于在卸载期间额外清理文件。

我遇到的最大问题是，在进行静默安装时，我无法更改应用程序的安装文件夹，并且它默认为 .inf 文件中的 %installDir% 属性。为每个想要更新的设备构建一个单独的 .cab 并不是一个很好的解决方案。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-15T21:53:27.950

我所在的一个团队通过在负责下载和运行 CAB 的移动设备上创建第二个移动应用程序（正在更新的应用程序之外）来实现这一点。

*   在每个扩展坞上，主应用程序确定是否需要通过 Web 服务调用进行更新。
*   如果它的版本过期，它会使用新版本的 URI 调用更新程序来安装，然后退出
*   更新程序应用程序将下载新的 CAB 并酌情执行安装/重新启动和注册表修改。

这对我们很有效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-17T15:44:16.943

你说的对。在 wM5, 6... WCEload 安装后，它只会停止应用程序，因此您无需手动停止它。但是您需要在静默模式下安装更新，因为如果不是，用户可以取消它，所以您需要静默 cab 安装程序。从下载

[http://cssoft.freehosting.net/website2/default.html](http://cssoft.freehosting.net/website2/default.html)

# php - 创建嵌套ul li的PHP函数？

> ID：753853
> 
> 赞同：0
> 
> 时间：2009-04-15T21:42:41.567
> 
> 标签：php, css, function

我正在尝试将一个小型 CMS 附加到我正在创建的网站上。但是我遇到了一个小问题。CMS 使用 PHP 函数插入菜单，这些 PHP 函数创建 HTML。我希望使用的特定功能（treemenu）创建了一个嵌套的 ul li，然后可以将其用于下拉菜单。然而嵌套的 ul li 的结构如下：

```
<li>Projects (Menu Level 1)</li>
    <ul>
        <li>Project 1 (Menu Level 2)</li>
        <li>Project 2 (Menu Level 2)</li>
        <li>Project 3 (Menu Level 2)</li>
    </ul>
<li>News (Menu Level 1)</li>
<li>Contact (Menu Level 1)</li> 
```

在 CSS 中创建下拉菜单时，我相信 Menu Level 1 li 应该像这样包装它的子级：

```
<li>Projects (Menu Level 1)
    <ul>
        <li>Project 1 (Menu Level 2)</li>
        <li>Project 2 (Menu Level 2)</li>
        <li>Project 3 (Menu Level 2)</li>
    </ul>
</li>
<li>News (Menu Level 1)</li>
<li>Contact (Menu Level 1)</li> 
```

我以前从未使用过 PHP，因此不知道如何更改函数以完成上述操作。我希望这将是一个简单的改变。下面是输出第一个示例结构的 PHP 函数：

```
function treemenu($generat=0) {
global $pagenum, $menu, $selected, $extension, $set;
$count=0;
$out="\n";
$intend=0;
while($menu[$count][0] != "") {
    if(strpos($menu[$count][3],"#") === false) {
    if($menu[$count][2]=="0" && $intend==2) {
        $intend--;
        $out.="</ul>\n";
    }
    if($menu[$count][1]=="0" && $intend==1) {
        $intend--;
        $out.="</ul>\n";
    }
    if($menu[$count][1]!="0" && $intend<1) {
        $intend=1;
        $out.="<ul>\n";
    }
    if($menu[$count][2]!="0" && $intend<2) {
        $intend=2;
        $out.="<ul>\n";
    }
    $out.="<li class=\"LNE_menu\"><a ";
    if($menu[$count][4]==$selected['name'])
        $out.= 'class="selected" ';
    if(strpos($menu[$count][3],"*"))
        $out.='href="'.str_replace("*", "",$menu[$count][3]).'">';
    elseif($generat)
        $out.='href="'.$menu[$count][3].".".$set['extension'].'">';
    else
        $out.='href="'.$set['indexfile'].'?page='.$menu[$count][3].'">';
    $out.=$menu[$count][4]."</a></li>\n";
    }
    $count++;
}
return $out;
} 
```

谁能指出我正确的方向，即如何使 1 级菜单项的结束 li 标记紧跟在第二个示例之后包装 ul ？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-15T21:52:23.210

这将是使用递归的一个很好的例子。一个数组（其中包含子数组）定义了每个级别，并且一个函数循环，每当找到要处理的新数组时都会调用自己。只要该功能适当地清理（关闭`</li> & </ol>`），它在很大程度上是自动的。

```
<?php
// I know which function I'd rather write....
$tree = array('Projects (Menu Level 1)',
              array('Project 1 (Menu Level 2)',
                    'Project 2 (Menu Level 2)',
                    'Project 3 (Menu Level 2)'),
              'News (Menu Level 1)',
              'Contact (Menu Level 1)');

// now quake beneath the power of this fully operational recursive function!
function olLiTree($tree)
{
    echo '<ul>';
    foreach($tree as $item) {
        if (is_array($item)) {
            olLiTree($item);
        } else {
            echo '<li>', $item, '</li>';
        }
    }
    echo '</ul>';
}
olLiTree($tree);  // kick off from the top level 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T22:11:29.640

看来 Topbit 已经击败了我，但我的*略有*不同，它不会将值直接回显到输出流，而是将其保存在一个变量中，您可以`echo`在方便时使用：

```
<?php

function GenerateMenu($arr)
{
    $output = "<ul>\n";
    foreach($arr as $val) {
        if (is_array($val)) {
            $output .= "<li>\n" . GenerateMenu($val, $output) . "</li>\n";
        }
        else {
            $output .= "<li>" . $val . "</li>\n";
        }
    }
    $output .= "</ul>\n";
    return $output;
}

$html = GenerateMenu($menu);

?> 
```

**编辑：**

感谢 Gumbo 和 Topbit，现在我在我的机器上安装了 PHP，我已经对其进行了测试，它工作正常。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T22:25:49.217

您只需要一个简单的功能。

```
function unorderedList($val)
{
    if (is_array($val)) {
        return '<ul><li>' . 
                implode('</li><li>', 
                    array_map('unorderedList', $val)) . 
            '</li></ul>';
    } else {
        return $val;
    }
} 
```

测试代码：

```
$menu = array('Projects (Menu Level 1)',
              array('Project 1 (Menu Level 2)',
                    'Project 2 (Menu Level 2)',
                    'Project 3 (Menu Level 2)'),
              'News (Menu Level 1)',
              'Contact (Menu Level 1)');

echo unorderedList($menu); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-06T07:57:06.687

我认为这会输出正确的 HTML 结构。

```
function GenerateMenu($arr)
{
foreach($arr as $val) {
    if (next($arr)) { $nextitem = current($arr); }
    if (is_array($val)) {
        $output .= "\n<ul>\n" . GenerateMenu($val, $output) . "</ul>\n</li>\n\n";
    }
    elseif (is_array($nextitem)) { $output .= "<li>" . $val; }
    else { $output .= "<li>" . $val . "</li>\n"; }
}
return $output;
}
$html = GenerateMenu($menu);
echo("<ul>\n" . $html . '</ul>'); 
```

与上面相同的测试代码：

```
$menu = array('Projects (Menu Level 1)',
          array('Project 1 (Menu Level 2)',
                'Project 2 (Menu Level 2)',
                'Project 3 (Menu Level 2)'),
          'News (Menu Level 1)',
          'Contact (Menu Level 1)'); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-06T00:42:08.377

我使用 PHP DOMDocument 类编写了这个。它将使用一个简单且易于遵循的循环创建与您提供的列表一样长和一样深的列表。如果您希望它有条理，只需首先向您的数据库询问按标题（或其他）排序的列表。它假设您的查询对象数据包含在 $menu_categories 中，并且它至少具有 ->id ->parent_id & ->title 的属性（根据您的需要更改）

```
$dom = new DOMDocument();
$dom->validateOnParse = true;
$dom->loadHTML("<html>");

$root = $dom->createElement('ul');
$root->setAttribute('class', 'menu');
$dom->appendChild($root);

foreach($menu_categories as $count => $category){
    $pid = $category->parent_id;
    $parent = $dom->getElementById('simple-li-'.$pid);

    if($parent != null){

        $ul = $dom->getElementById('simple-ul-'.$pid);

        if($ul == null){
            $ul = $dom->createElement('ul');
            $ul->setAttribute('id', 'simple-ul-'.$pid);
            $parent->appendChild($ul);
        }
        $target = $ul;

    }else{ 
        $target = $root;
    }   

    $li = $dom->createElement('li', $category->title);
    $li->setAttribute('id', 'simple-li-'.$category->id);
    $target->appendChild($li);
}

echo $dom->saveHTML($root);
return; 
```

这是评论版本...

```
/**
 * This is pure and simple PHP!
 * @author Jamin Szczesny - Mar 2014
 * Assuming you have a returned query list of related rows named... 
 *  $menu_categories (the list can be in any order)
 * and it has valid attributes of.. 
 * ->id (category id)
 * ->title  (category title\name)
 * ->parent_id (categories parent)
 * 
 */

$dom = new DOMDocument();//create a document
$dom->validateOnParse = true;//this is a must
$dom->loadHTML("<html>");//you must load some valid html

//add a root list to the dom
$root = $dom->createElement('ul');
$root->setAttribute('class', 'menu');
$dom->appendChild($root);

//loop through all of your category rows
foreach($menu_categories as $count => $category){
    $pid = $category->parent_id;
    $parent = $dom->getElementById('simple-li-'.$pid);

    //see if we found a parent
    if($parent != null){ //parent found...
        //look for a ul within the parent
        $ul = $dom->getElementById('simple-ul-'.$pid);

        //check to see if that ul exists
        if($ul == null){//ul not created yet so create one
            $ul = $dom->createElement('ul');
            $ul->setAttribute('id', 'simple-ul-'.$pid);
            $parent->appendChild($ul);
        }
        $target = $ul;

    }else{ //no parent found...
        $target = $root;
    }   
    //create this list item
    $li = $dom->createElement('li', $category->title);
    $li->setAttribute('id', 'simple-li-'.$category->id);
    $target->appendChild($li);
}
//output only the html from our list
echo $dom->saveHTML($root);
return; 
```

# iframe - 将“onclick”应用于 iFrame 中的所有元素

> ID：753863
> 
> 赞同：-1
> 
> 时间：2009-04-15T21:45:37.923
> 
> 标签：iframe, onclick

如何使用 JavaScript DOM 将`onclick`事件应用于`iframe`.

这是我正在尝试但不起作用的方法：

```
document.getElementById('myIframe').contentDocument.getElementsByTagName('a').onclick = function(); 
```

似乎没有抛出任何错误，并且我可以完全控制`iframe`.

这是一些代码来测试，看看我是否至少可以计算出`div`我的`iframe`.

```
// access body
var docBody = document.getElementsByTagName("body")[0];

// create and load iframe element
var embed_results = document.createElement('iframe');
embed_results.id = "myIframe";
embed_results.setAttribute("src", "http://www.mysite.com/syndication/php/embed.php");

// append to body
docBody.appendChild(embed_results);

// count the divs in iframe and alert   
alert(document.getElementById("myIframe").contentDocument.getElementsByTagName('div').length); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-15T21:59:26.847

iFrame 可以从不同域上的另一个网站获取内容。

能够访问其他域上的内容对用户来说是一个安全漏洞，因此不可能通过 Javascript 来做到这一点。

因此，您不能将页面中的事件附加到 iFrame 中的内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T22:09:59.957

getElementsByTagName 返回一个 NodeCollection，因此您必须遍历此集合并将 onclick 处理程序添加到该集合中的每个节点。下面的代码应该可以工作。

```
var links = document.getElementById('myIframe').contentDocument.getElementsByTagName('a');
for(var i=0;i<links.length;++i)links[i].onclick=function(){} 
```

还要确保在加载框架的内容后运行此代码

```
embed_results.onload=function(){
   // your code
} 
```

# c# - 404 上的 WebRequest 和 System.Net.WebException，慢吗？

> ID：753877
> 
> 赞同：1
> 
> 时间：2009-04-15T21:51:53.290
> 
> 标签：c#, httpwebrequest

我正在使用 WebRequest 来检查网页或媒体（图像）是否存在。在 GetResponse 上，我得到一个 System.Net.WebException 异常。我浏览了 100 个链接，感觉它的速度比它应该的要慢。有没有办法不得到这个异常或更优雅地处理这个？

```
 static public bool CheckExist(string url)
    {
        HttpWebRequest wreq = null;
        HttpWebResponse wresp = null;
        bool ret = false;
        try
        {
            wreq = (HttpWebRequest)WebRequest.Create(url);
            wreq.KeepAlive = true;
            wresp = (HttpWebResponse)wreq.GetResponse();
            ret = true;
        }
        catch (System.Net.WebException)
        {
        }
        finally
        {
            if (wresp != null)
                wresp.Close();
        }
        return ret;
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T21:59:30.357

尝试设置

```
wreq.Method = "Head"; 
```

在“KeepAlive”行之后。如果您调用的网络服务器足够聪明，那将告诉它不返回任何应该节省一些时间的正文内容。

# java - 将变量传递给事件调度线程

> ID：753884
> 
> 赞同：5
> 
> 时间：2009-04-15T21:53:16.657
> 
> 标签：java, multithreading, event-dispatch-thread

我的 GUI 被锁定，因为我需要通过 EDT 更新它，但是，我还需要传递一个正在使用 GUI 更新的变量：

```
while ((message = this.in.readLine()).startsWith("NUMPLAYERS"))
{
    numOfPlayers = Integer.parseInt(message.split(":")[1]);
    numPlayers.setText("There are currently " + numOfPlayers + " players in this game");
} 
```

这不起作用。我需要在 EDT 中设置文本，但我不能将 numOfPlayers 传递给它而不将其声明为最终的（我不想这样做，因为它随着新玩家加入服务器而改变）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-15T21:59:17.250

最简单的解决方案是使用`final`临时变量：

```
final int currentNumOfPlayers = numOfPlayers;
EventQueue.invokeLater(new Runnable() {
    public void run() {
       numPlayers.setText("There are currently " + 
               currentNumOfPlayers + " players in this game");
    }
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T22:24:03.090

您必须将其设为最终版本或将`Runnable`引用作为字段（类变量）。如果引用一个字段，请确保它是线程安全的（通过同步或易失性）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T22:35:35.963

这个怎么样：

```
while ((message = this.in.readLine()).startsWith("NUMPLAYERS")) {
    numOfPlayers = Integer.parseInt(message.split(":")[1]);
    final newText = "There are currently " + numOfPlayers + " players in this game";
    EventQueue.invokeLater(new Runnable() {
        public void run() {
            numPlayers.setText(newText);
        }
    });
} 
```

注意：我认为 OP 有充分的理由不将其标记`numOfPlayers`为最终版本，也许是稍后在与`while`问题无关的代码中的同一循环中对其进行了更改，因此未显示。因此，这`numOfPlayers`是在`while`循环之前声明的。

没有这个假设，我不会做额外的变量`newText`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T04:07:22.843

在您的方法之外定义此类：

```
public abstract class MyRunnable implements Runnable {
    protected int var;
    public MyRunnable (int var) {
        this.var = var;
    }
}

Now your code can look like this:
SwingUtilities.invokeAndWait(new MyRunnable(5) {
    @Override
    public void run() {
        //numPlayers.setText("There are currently " + var + " players in this game");
    }
}); 
```

（出于本示例的目的，我假设有充分的理由说明为什么使用局部范围的最终临时变量不起作用。不过，老实说，我想不出有任何限制的原因。）

# dns - 可以为 NFS 关闭反向 DNS 吗？

> ID：753889
> 
> 赞同：3
> 
> 时间：2009-04-15T21:54:27.077
> 
> 标签：dns, nfs

我们已经设置了 3 台虚拟机服务器机器，它们从 2 台其他存储机器上挂载虚拟机。我们从存储服务器挂载虚拟机，以便在移动虚拟机时移动更少的数据（在一台服务器上暂停、在新服务器上挂载、取消暂停），并便于快照和备份。

由于暴风雨，我们正处于长期停电的状态（运营团队忘记检查发电机中是否有燃料，并且不要每周对其进行测试tsk，tsk），因此我们关闭了所有设备。

给发电机加油后，我们开始把所有东西都装起来。大问题。

为了 NFS 挂载存储，NFS 想要进行反向 DNS 查找，但是 DNS 服务器是一个 VM，在存储被 NFS 挂载之前无法启动！

我们将 DNS 服务器 VM 复制到本地 VM 服务器之一并启动它，这样我们就可以启动所有内容。

我们想在没有反向查找的情况下运行 NFS（一切都在我们的内部网络上），但不知道如何关闭。

任何帮助表示赞赏

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T06:52:12.000

将 NFS 客户端的 IP 地址放入`/etc/hosts`NFS 服务器的文件中，并带有如下注释：

```
# 2009-04-17 Workaround a chicken and egg DNS resolution problem at boot
192.0.2.1 mynfsclient
192.0.2.2 anothernfsclient 
```

然后，将“更改机器的 IP 地址时，不要忘记更新 NFS 服务器的主机文件”添加到您的运行手册。

现在，要关闭 NFS 服务器中的这个愚蠢的 DNS 测试，这取决于服务器。您显然没有指明操作系统或服务器类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-11T14:32:35.163

I had a similar problem with an old Yellow Machine NAS box - I was having DNS/DHCP fights where the reverse lookups were not matching the forward lookups.

In our case, just putting dummy entries in the NAS box /etc/hosts for all the IPs solved the problem. I don't even need to have correct names for the IPs - just any name for an IP solved stopped mountd from complaining.

(Interesting side note - at least in the older version of Linux on the NAS box, there's a typo in the NFS error message: "DNS forward lookup does't match with reverse " )

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T22:03:21.033

你不能把有问题的服务器的 IP 地址放在 fstab 文件中，不需要 dns 查找。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-13T02:22:10.053

它是 NFS v4，问题在于所有访问请求都使用反向 DNS 查找来确定 NFS 域以用于访问/安全目的。

我认为您可以通过在 /etc/default/nfs 中添加一行来停止这种行为，其中包含：

```
NFSMAPID_DOMAIN=jrandom.dns.domain.com 
```

这需要在彼此共享/使用 NFS 的所有系统之间匹配。请参阅有关[设置 NFSMAPID_DOMAIN](http://docs.oracle.com/cd/E23823_01/html/816-5174/nfs-4.html#scrolltoc)的部分，该部分位于页面末尾，它解释了未设置时会发生什么。

NFSv4 - 比一袋黄鼠狼更有趣。

# iphone - 由我开发并由客户提交的 iPhone 应用程序？

> ID：753890
> 
> 赞同：3
> 
> 时间：2009-04-15T21:54:30.460
> 
> 标签：iphone, app-store

我正在为我的客户完成一个应用程序。他想亲自提交给苹果。

我必须做什么 ？

我应该给他未签名的应用程序吗？我应该问他一个配置文件吗？我应该加入他的团队和他的分发资料吗？

非常感谢你的帮助 ？

蒂埃里

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T22:09:05.747

让您的客户注册 iPhone 开发者计划，这样当您的客户将应用程序提交到 App Store 时，它​​将使用客户的公司名称。如果他们不知道如何做这些事情，您仍然可以为您的客户管理所有代码签名和配置。客户可以简单地让你访问他们的开发者帐户来处理所有这些东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T22:00:07.263

我只会给他源代码，除非您出于某种原因特别不想这样做。这样，他就可以自己编译了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-31T12:09:04.900

我为想要自己提交给 Apple 的客户做了什么：

*   客户必须创建（或者，如果他们向您提供登录信息，您可以为他们创建）应用程序的应用商店分发配置文件并将其发送给您。需要您和客户之间进行一些沟通，以确保他们使用正确的应用程序 ID 等。

*   （我认为您可能还需要客户的开发人员证书才能让他们“拥有”该应用程序——这不是 100% 确定的）

*   不要忘记获取私钥文件，因为没有它，证书签名将无法工作

*   我将客户端证书/应用商店 dist 配置文件设置到应用中并为应用商店构建应用。

*   将二进制文件交付给客户端。

*   客户端上传到 iTunes 连接。

# django - Django 中间件 + URL

> ID：753909
> 
> 赞同：3
> 
> 时间：2009-04-15T21:59:48.623
> 
> 标签：django, middleware

中间件是否可以检查 url 中是否有值，例如图像 id ("/image/152/")，如果是，则进行一些检查以确保当前用户有权查看该图像和如果不重定向到另一个网址？

我必须为我正在处理的这个网站滚动我自己的权限，我不想用相同的代码阻塞我为整个网站编写的几乎每个视图，所以我认为中间件会是一个好主意，但我不知道该怎么做。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-15T22:46:58.667

是的，这是可能的。[process_request](http://docs.djangoproject.com/en/dev/topics/http/middleware/#process-request)的 django中间件文档表明：

> def process_request（自我，请求）
> 
> request 是一个 HttpRequest 对象。在 Django 决定执行哪个视图之前，每个请求都会调用此方法。
> 
> process_request() 应该返回 None 或 HttpResponse 对象。如果它返回 None，Django 将继续处理这个请求，执行任何其他中间件，然后是适当的视图。如果它返回一个 HttpResponse 对象，Django 不会费心调用任何其他请求、视图或异常中间件或适当的视图；它会返回那个 HttpResponse。

该`HttpRequest`对象有一个`path`属性，可以为您提供所请求的 URL。

但是，如果您愿意，请注意，您还可以扩展 Django 的身份验证后端系统，以根据任意标准（例如您的手动权限方案）在请求中填充用户权限。这样，您可以利用默认的身份验证装饰器（`@permission_required`和`@user_passes_test`），其他应用程序/管理站点也将能够尊重您的权限。User 对象和创建的权限不需要驻留在 Django 的用户/权限表中，可以在登录时虚拟创建；我在这方面取得了相当大的成功。

如果这很有吸引力，请参阅[编写身份验证后端。](http://docs.djangoproject.com/en/dev/topics/auth/#writing-an-authentication-backend)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-25T12:05:26.823

如果你在中间件中实现授权（Permission system），你最终会得到两种选择：

1.  检查 URL 并允许访问
2.  检查 URL 并拒绝访问

If your requirement is that much simple, it is fine, since you don't have to touch views.

But in general, Permission system is much complex than that, for example:

1.  User can access FOO/show_all/
2.  But, he can't see or access foo instance, i.e, FOO/show/foo_1/
3.  Since, he can't access foo_1 instance, we should not show them in show_all (all foo instances)

If you want implement above 3 together, I suggest you [write your own custom authorization backend for Django](https://docs.djangoproject.com/en/3.1/topics/auth/customizing/#handling-authorization-in-custom-backends). All you need to do is implement few methods (your specific logic) and attach as backend.

# debugging - 运行 DOS 调试脚本

> ID：753915
> 
> 赞同：1
> 
> 时间：2009-04-15T22:01:05.420
> 
> 标签：debugging, dos

如果我在调试中逐行键入以下脚本，则它可以正常工作。当我将它复制到一个名为 script.txt 的文件时，它在“输入 3 个数字”后挂断。我像这样运行它：

D:>调试<script.txt

该文件是：

```
a
mov cx, 3
jmp 0119
db 0d,0a,"enter 3 numbers",0d,0a,"$"
mov dx, 0105
mov ah, 09
int 21h
mov ah, 01
int 21h
and al, 0f
add bl, al
mov dl, 0a
mov ah, 02
int 21h
loop 0120
jmp 013a
db 0d,0a,"sum: ","$"
mov dx,0132
mov ah, 09
int 21h
or bl, 30
mov dl, bl
mov ah, 02
int 21h
mov ax, 4c00
int 21h

g 
```

我究竟做错了什么？任何提示或链接表示赞赏。基思

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-15T22:07:54.390

您将输入重定向到调试来自脚本，而不是来自控制台，因此调试永远不会收到您的击键程序挂起，等待更多数据来自脚本。

如果您在脚本中的“g”之后放置 3 个数字，它应该会继续

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-15T22:07:01.430

您告诉 debug 从 script.txt 中获取所有输入，因此当您的程序尝试从标准输入中读取数字时，它是从文件中读取的，而不是从控制台中读取的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T22:20:26.547

很好的解释。 **谢谢迈克尔**，你的建议奏效了，但我想从控制台获取输入并仍然运行脚本，所以我不必输入整个代码来再次运行它。 **谢谢jdigital！**，这就是我正在寻找的答案。使用您的提示（在上面的评论中）我能够制作一个简单的工作脚本：

```
a
mov cx, 3
jmp 0119
db 0d,0a,"enter 3 numbers",0d,0a,"$"
mov dx, 0105
mov ah, 09
int 21h
mov ah, 0     ; for console input
int 16h       ; use int 16h function 0.
mov dl,al     ; echo input to screen
mov ah,02
int 21h
and al, 0f
add bl, al
mov dl, 0a
mov ah, 02
int 21h
loop 0120
jmp 0140
db 0d,0a,"sum: ","$"
mov dx,0138
mov ah, 09
int 21h
or bl, 30
mov dl, bl
mov ah, 02
int 21h
mov ax, 4c00
int 21h

g 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-22T22:35:08.927

```
enter 3 numbers 
```

9 7 9

总和：9

缝合你的程序不工作......也许需要使用堆栈，而不是 regs。

# asp.net - URL Querystring 安全问题 (ASP.NET)

> ID：753917
> 
> 赞同：2
> 
> 时间：2009-04-15T22:01:40.367
> 
> 标签：asp.net, security

如果用户单击发布帖子的按钮（假设它在帖子中有用户名和密码）并且这些凭据成功通过身份验证。如果我重定向到一个完全不同的应用程序（所以我不能进行会话等）并且我在查询字符串中使用带有用户名和密码的 GET（如果有帮助，我什至可以使用基本加密，但无论如何）然后当它到达页面，我检查以确保它来自我期望它来自的页面，从查询字符串中提取值，将它们放入会话变量中，然后重定向回同一页面（删除查询字符串值，因此用户无法查看）。这一切都发生在同一台服务器上的 SSL 上。

有人可以指出在这种情况下拦截用户名和密码的人的安全漏洞吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-15T22:05:36.300

如果您使用 SSL，则没有人可以拦截该请求。问题实际上出在客户端本身。将用户名和密码放入 GET 请求（甚至加密）中并不是一个好主意，因为：

1.  URL 可以很容易地复制并粘贴给其他人。
2.  如果用户单击外部链接，则 URL 将作为引荐来源网址发送。
3.  XSS 攻击可用于劫持 URL。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T22:12:18.267

Mehrdad 已经给出了一些问题，这里有一些其他问题：

*   在获取请求中使用时，用户名和密码将在用户浏览器的历史记录/缓存中清晰可见。
*   用户名/密码组合也可能会显示在您的服务器日志中。

另外：考虑使用“加盐”哈希作为密码，而不是仅仅存储明文（如果不是这样的话）。**补充**：正如 Mehrdad 正确评论的那样：......即使在加盐哈希的情况下，它仍然容易受到重放攻击......

**编辑：**

@EdenMachine：我认为您应该在谷歌上搜索“跨站点身份验证”之类的东西-这将“有点”难以实施，但（如果正确完成）会更安全（并且无缝）。示例链接：[http ://aspalliance.com/1513_Cross_Site_Authentication_and_Data_Transfer.all](http://aspalliance.com/1513_Cross_Site_Authentication_and_Data_Transfer.all)

# sharepoint - 如何使 SharePoint 2007 中 Web 部件的自定义属性排序到属性窗格的顶部？

> ID：753918
> 
> 赞同：2
> 
> 时间：2009-04-15T22:01:54.577
> 
> 标签：sharepoint, sharepoint-2007, web-parts

在 SharePoint 2007 中，是否可以以编程方式将您创建的自定义属性排序到属性窗格的顶部？因此，当有人编辑您的 webpart 时，它会默认显示在顶部，而不是底部，这样用户就不必滚动到底部？

这是我的代码，供参考：

```
 private string _strMainFolder = "Reports";

    [WebBrowsable(true)]
    [WebDisplayName("Reports SharePoint List Name")]
    [SPWebCategoryName("Report WebPart Configuration")]
    [WebPartStorage(Storage.Shared)]
    [WebDescription("Enter the SharePoint List's name that you want to use.")]
    [Personalizable(PersonalizationScope.Shared)]
    public string strMainFolder
    {
        get { return _strMainFolder; }
        set { _strMainFolder = value; }
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T22:28:00.800

将 CustomPropertyToolPart 添加到数组时，为其指定比 WebPartToolPart 更低的 (0) 索引。它应该按照将项目添加到数组中的顺序呈现。

[http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.webpartpages.webpart.gettoolparts.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.webpartpages.webpart.gettoolparts.aspx)

# ruby-on-rails - 运行单个迁移文件

> ID：753919
> 
> 赞同：286
> 
> 时间：2009-04-15T22:03:04.357
> 
> 标签：ruby-on-rails, ruby, migration

有没有一种简单的方法来运行一次迁移？我不想迁移到某个版本，我只想运行一个特定的版本。

* * *

## 回答 #1

> 赞同：484
> 
> 时间：2009-04-15T22:30:38.360

假设你总是可以运行相当新版本的 Rails：

```
rake db:migrate:up VERSION=20090408054532 
```

其中 version 是迁移文件名中的时间戳。

**编辑：在过去 8 年的某个时间点（我不确定是什么版本）Rails 添加了检查，以防止它在已经运行的情况下运行。这由表中的条目指示`schema_migrations`。要重新运行它，只需执行即可`rake db:migrate:redo VERSION=20090408054532`。**

* * *

## 回答 #2

> 赞同：265
> 
> 时间：2009-04-16T00:25:05.840

您可以直接从 ruby​​ 文件中运行代码：

```
rails console
>> require "db/migrate/20090408054532_add_foos.rb"
>> AddFoos.new.up 
```

注意：非常旧版本的 rails 可能需要`AddFoos.up`而不是`AddFoos.new.up`.

另一种方法（没有 IRB）依赖于 require 返回一个类名数组的事实：

```
script/runner 'require("db/migrate/20090408054532_add_foos.rb").first.constantize.up' 
```

请注意，如果您这样做，它不会更新`schema_migrations`表格，但无论如何这似乎就是您想要的。

此外，如果它找不到您可能需要使用`require("./db/..."`或尝试的文件，`require_relative`具体取决于您的工作目录

* * *

## 回答 #3

> 赞同：116
> 
> 时间：2013-06-07T11:03:31.037

如果要[运行特定迁移](http://guides.rubyonrails.org/migrations.html#running-specific-migrations)，请执行

```
$ rake db:migrate:up VERSION=20080906120000 
```

如果您想[多次](http://guides.rubyonrails.org/migrations.html#rolling-back)运行迁移，请执行

```
# use the STEP parameter if you need to go more than one version back
$ rake db:migrate:redo STEP=3 
```

如果要多次运行**单个****迁移**，请执行

 **```
# this is super useful
$ rake db:migrate:redo VERSION=20080906120000 
```

（您可以在迁移的文件名中找到版本号）

* * *

**编辑：**您也可以简单地重命名您的迁移文件，例如：

`20151013131830_my_migration.rb`->`20151013131831_my_migration.rb`

然后正常迁移，这会将迁移视为新迁移（如果您想在您控制较少的远程环境（例如登台）上迁移，这很有用。

**编辑 2**：您也可以只核对数据库中的迁移条目。例如：

```
rails_c> q = "delete from schema_migrations where version = '20151013131830'"
rails_c> ActiveRecord::Base.connection.execute(q) 
```

`rake db:migrate`然后将重新运行`up`nuked 迁移的方法。

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2013-07-24T21:20:16.157

如果你实现了`change`这样的方法：

```
class AddPartNumberToProducts < ActiveRecord::Migration
  def change
    add_column :products, :part_number, :string
  end
end 
```

您可以创建迁移实例并在实例上运行`migrate(:up)`或运行`migrate(:down)`，如下所示：

```
$ rails console
>> require "db/migrate/20090408054532_add_part_number_to_products.rb"
>> AddPartNumberToProducts.new.migrate(:down) 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2015-09-28T02:47:24.053

这是再次运行此迁移文件“20150927161307_create_users.rb”的步骤

1.  运行控制台模式。（导轨 c）
2.  将该文件中的类复制并粘贴到控制台。

    ```
    class CreateUsers < ActiveRecord::Migration
      def change
        create_table :users do |t|
          t.string :name
          t.string :email
          t.timestamps null: false   end
        end
      end
    end 
    ```

3.  创建类的一个实例`CreateUsers`：`c1 = CreateUsers.new`

4.  执行该`change`实例的方法：`c1.change`

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2016-09-20T13:05:40.470

至于`rails 5`你也可以使用`rails`而不是`rake`

**导轨 3 - 4**

```
# < rails-5.0
rake db:migrate:up VERSION=20160920130051 
```

**导轨 5**

```
# >= rails-5.0
rake db:migrate:up VERSION=20160920130051

# or

rails db:migrate:up VERSION=20160920130051 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2014-10-23T10:18:26.363

如果您在使用路径时遇到问题，可以使用

```
require Rails.root + 'db/migrate/20090408054532_add_foos.rb' 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2019-09-19T05:57:56.680

如果你想从控制台运行它，这就是你要找的：

```
$ rails console
irb(main)> require "#{Rails.root.to_s}/db/migrate/XXXXX_my_migration.rb"
irb(main)> AddFoo.migrate(:up) 
```

我尝试了其他答案，但要求`Rails.root`没有对我有用。

此外，`.migrate(:up)`部分强制迁移重新运行，无论它是否已经运行。当您已经运行迁移时，这很有用，通过弄乱数据库并想要一个快速的解决方案来重新启动它。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-05-26T08:41:55.760

方法一：

```
rake db:migrate:up VERSION=20080906120000 
```

方法二：

在 Rails 控制台中 1\. 在控制台中复制粘贴迁移类（比如 add_name_to_user.rb） 2\. 然后在控制台中，键入以下内容

```
Sharding.run_on_all_shards{AddNameToUser.up} 
```

完成了！！

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2012-02-26T02:27:52.177

请注意`script/runner`，您可能必须`rails runner`在新的 Rails 环境中使用，而不是 。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-04-10T07:57:45.087

看起来至少在最新的 Rails 版本（撰写本文时为 5.2）中，还有另一种过滤正在运行的迁移的方法。可以在环境变量中传递过滤器，`SCOPE`然后使用该过滤器选择迁移文件。

假设您有两个迁移文件`1_add_foos.rb`并`2_add_foos.run_this_one.rb`正在运行

```
SCOPE=run_this_one rails db:migrate:up 
```

只会选择并运行`2_add_foos.run_this_one.rb`。请记住，将运行与范围匹配的所有迁移文件。

# wpf - 多边形边界与具有 ScaleTransform 的画布上的视觉对象不匹配

> ID：753921
> 
> 赞同：2
> 
> 时间：2009-04-15T22:03:36.303
> 
> 标签：wpf

下面的 XAML 只是一个缩放 x2000 的画布上的多边形。当鼠标悬停在多边形上时，有一个触发器可以更改多边形的填充颜色。

为什么当您将鼠标悬停在多边形的上方和左侧时，框会改变颜色。

```
<Canvas Background="Black" Height="600" Width="600">
    <Canvas.RenderTransform>
        <ScaleTransform ScaleX="2000" ScaleY="2000" />
    </Canvas.RenderTransform>
    <Polygon>
        <Polygon.Resources>
            <Style TargetType="Polygon">
                <Setter Property="Fill" Value="HotPink"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="true">
                        <Setter Property="Fill" Value="LimeGreen"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
        </Polygon.Resources>
        <Polygon.Points>
            <PointCollection>
                <Point X="0.1" Y="0.1" />
                <Point X="0.2" Y="0.1" />
                <Point X="0.2" Y="0.2" />
                <Point X="0.1" Y="0.2" />
            </PointCollection>
        </Polygon.Points>
    </Polygon>
</Canvas> 
```

如果我用 TextBlock 替换 Polygon，则不会发生这种情况。我怎样才能避免这种情况发生？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-01T15:58:04.190

在我看来，这就像 Microsoft 的 Polygon 命中测试代码中的一个错误。但是，我能够通过在原点绘制多边形然后使用 Canvas.Top 和 Canvas.Bottom 对其进行翻译来停止它。希望这能解决您的问题。

```
<Canvas Background="Black" Height="600" Width="600">
    <Canvas.RenderTransform>
        <ScaleTransform ScaleX="2000" ScaleY="2000" />
    </Canvas.RenderTransform>
    <Polygon Canvas.Top="0.1" Canvas.Left="0.1">
        <Polygon.Resources>
            <Style TargetType="Polygon">
                <Setter Property="Fill" Value="HotPink"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="true">
                        <Setter Property="Fill" Value="LimeGreen"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
        </Polygon.Resources>
        <Polygon.Points>
            <PointCollection>
                <Point X="0.0" Y="0.0" />
                <Point X="0.1" Y="0.0" />
                <Point X="0.1" Y="0.1" />
                <Point X="0.0" Y="0.1" />
            </PointCollection>
        </Polygon.Points>
    </Polygon>
</Canvas> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T16:02:35.937

这是因为 Shape 元素（Polygon 对象派生自）布局。您的形状从 0,0 开始（而不是从 .1,.1 开始），因此在左侧进行了测试。要在 Canvas 上设置形状位置，您应该使用 Canvas.Left/Top 附加属性，因此您的代码看起来像这样并且行为正确

```
**<Polygon Canvas.Top=".1" Canvas.Left=".1">
<Polygon.Points> 
 <Point X="0" Y="0" /> 
 <Point X=".1" Y="0" />  
 <Point X=".1" Y=".1" /> 
 <Point X="0" Y=".1" />
</Polygon.Points>** 
```

# c# - 为什么更新面板会在更新面板之外重新加载控件

> ID：753934
> 
> 赞同：0
> 
> 时间：2009-04-15T22:08:43.157
> 
> 标签：c#, .net, asp.net, updatepanel

我在一个页面上有几个 UpdatePanel，它们已设置为 Conditional 模式。当 UpdatePanel 内发生事件时（比如单击按钮），我看到 UpdatePanels 外部的控件闪烁。

该页面不会回发，但用户会遇到“闪烁”。

知道这里可能会发生什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T22:20:44.063

我想你可能弄错了 UpdateMode。默认情况下，如果您将其更改为“有条件”，则它是“始终”，它应该可以解决您的问题

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T03:25:26.937

您是否有针对 UpdatePanel 内的控件的事件处理程序来更新 UpdatePanel 之外的控件？

您可以尝试有选择地评论事件处理程序，直到它停止闪烁以找到罪魁祸首。

我还发现 Firebug 在这些情况下很有用——您可以看到进入更新区域的确切 HTML。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-16T14:05:06.673

You don't say what the callback inside the UpdatePanel is doing.

If it is updating the contents of the panel itself, it could be be the browser is simply repainting the entire page layout to account for the new content just as it would if you resized the browser window.

# qt - PyQt4中的QTableView选定元素

> ID：753938
> 
> 赞同：0
> 
> 时间：2009-04-15T22:09:38.163
> 
> 标签：qt, pyqt4, qtableview

有什么方法可以读取`QTableView`用户选择了 Qt 小部件的哪一行？跟`QModelIndex`上课有关系吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T22:16:06.697

是的，您可以使用`QTableView::selectionModel()`（从 继承的函数`QAbstractItemView`）返回一个`QItemSelectionModel`. 然后你可以调用`QItemSelectionModel::selectedIndexes()`，它会返回一个`QModelIndex`es 列表。

供参考，请参阅[`QAbstractItemView::selectionModel()`](http://doc.trolltech.com/4.5/qabstractitemview.html#selectionModel)。

# javascript - 如何增加 Javascript 下拉菜单在屏幕上保留的时间？

> ID：753941
> 
> 赞同：0
> 
> 时间：2009-04-15T22:10:45.320
> 
> 标签：javascript, prototype

有什么方法可以增加创建的下拉菜单在屏幕上的停留时间？当我触摸光标时，下拉菜单会出现并消失。下拉菜单是使用原型创建的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-15T22:23:52.730

使用不同的下拉菜单：

这里有超过 25 种可能更适合您的需求：

*   [http://www.noupe.com/css/multilevel-drop-down-navigation-menus-examples-and-tutorials.html](http://www.noupe.com/css/multilevel-drop-down-navigation-menus-examples-and-tutorials.html)

或提及您正在使用的下拉菜单，以便我们至少可以为您发现选项！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T20:39:07.597

无论您附加到菜单滚动以使其消失的任何功能，将该代码添加到另一个函数并使用 setTimeout() 调用暂停一段时间，然后再删除菜单。

例子：

```
Old Code
var closeMenu = function() {
    $('menu').hide();
};

New Code
var hideMenu = function() {
    $('menu').hide();
};

var closeMenu = function() {
    setTimeout(hideMenu, 5000);
}; 
```

通过该更改，您现在将菜单的消失动作延迟了 5 秒。可能不想花那么长时间，但你明白了。

# c# - C#：如何将网站项目转换为 Web 项目

> ID：753943
> 
> 赞同：6
> 
> 时间：2009-04-15T22:11:32.637
> 
> 标签：c#, visual-studio, namespaces, code-behind

更新：所有这些问题都是为了将​​网站应用程序转换为 Visual Studio 中的 Web 项目。一旦我挖掘并找到了解决方案，我在下面标记为答案。

基本上，如果您想将网站项目升级/移动到 Web 项目，您会遇到许多错误。简短的操作方法在下面的答案中。谢谢大家的意见和帮助。

旧问题和标题如下：

如何将命名空间 xx {} 包装到所有类文件？

您如何将命名空间包装到 web 项目（或任何项目）中的所有代码隐藏文件？

```
namespace MyDomain
{
  // regular code here
} 
```

长话短说...

我一直在转换一个外包到海外的项目。对于这样一个简单的网站（摇头），仅“网络”项目中就有超过 20,000 个文件。它是在 vs2005 中使用 VB.NET 和 C# 编写的（是的，都是编译）。它最初是一个网站应用程序。我已将其转换为 Web 应用程序，主要是因为发布时生成了 8,000 个“临时”程序集。

好的，我正在转换为 VS2008。我已将所有代码转换为 C#。看起来不错。我已经将所有特殊的 App_Code/VB 和 C# 代码放入单独的程序集中。

现在，当我尝试再次编译时，我会收到大量错误警报。我通过将代码隐藏文件包装在命名空间中并更新用户控件以使用新命名空间来解决这些问题。

但是……还有 5000 多个错误……救命！

[替代文字 http://eduncan911.com/blog/thumbnail/4-15-2009.6-00-13.PM.png](http://eduncan911.com/blog/thumbnail/4-15-2009.6-00-13.PM.png)

也许还有另一种方式？以下是代码隐藏的示例片段：

```
public partial class MyHomepage_MyStuff_MyPosts : SecurePage
{ ... } 
```

注意类名 MyHomepage_MyStuff_MyPosts。这是 /MyHomepage/MyStuff/MyPosts.aspx 中文件所在位置的目录路径。

错误是代码隐藏文件找不到对正在使用的控件的引用。如：

```
ctl_website_rpt.RowCount = _totalCount; 
```

这是 ASPX 文件中称为“ctl_website_rpt”的控件（它们的命名约定）。aspx 页面在标题中有：

```
<%@ Page Title="My Posts" Language="C#" 
  MasterPageFile="~/MasterPages/Main.master" AutoEventWireup="true" 
  CodeFile="MyPosts.aspx.cs" 
  Inherits="MyHomepage_MyStuff_MyPosts" %> 
```

也许有一种方法可以让我在其他地方引用这个页面？无需将其更改为的命名空间？

```
namespace Website.MyHomepage.MyStuff
{
  public partial class MyPosts
  { ... }
}

<%@ Page Title="My Posts" Language="C#" 
  MasterPageFile="~/MasterPages/Main.master" AutoEventWireup="true" 
  CodeFile="MyPosts.aspx.cs" 
  Inherits="Website.MyHomepage.MyStuff.MyPosts" %> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-03T16:55:16.787

仅供参考，我找到了解决方案。这比你想象的要容易。

您只需右键单击您的新 Web 项目，就会出现“转换为 Web 应用程序”选项。这做了一些有趣的事情。首先，它会创建 [file].aspx.designer.cs 自动生成的文件。这消除了我 99% 的错误，因为这是因为代码隐藏找不到对控件的引用（请参阅上面我的问题中的屏幕截图）。

这也重写了您的 aspx 文件中的 <%@ Page %> 声明，以从新名称/命名空间后面的代码继承。

剩下的就是一些装配参考问题并完成！

方法是：

1) 创建一个新的 Web 项目，将旧网站项目中的所有文件复制到新的 Web 项目中。

2) 修复所有对您知道您需要的程序集的引用。

3) 右键单击​​ Web 应用程序并选择转换为 Web 应用程序。仔细检查错误和警告日志。修复后随意重新转换。

如果任何 aspx 或 ascx 文件没有 Designer.cs 文件，则该文件的转换失败。修复引用、命名空间等并重新转换。

**提示 #1**：确保在转换为 Web 应用程序之前添加了所有引用。有时会发生许多错误。

**提示 #2**：即使它看起来已经完成，在转换后查找错误。它会将您指向无法转换的文件，因此您需要处理它们。

**提示#3**：您可以多次重新转换任何子目录或任何文件。假设您正在修复的#2 中有多个错误，您可以多次重新转换该文件或目录，直到您修复它。重新转换不会损害现有应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T22:14:46.387

除了编写一个可以遍历所有文件并为您修改它们的小控制台应用程序之外，我想不出一个解决方案。

# sql - 使用 While 循环进行 SQL Server 更新

> ID：753947
> 
> 赞同：1
> 
> 时间：2009-04-15T22:12:49.183
> 
> 标签：sql, sql-server-2005, loops

我正在努力提高我的 SQL 编程效率。我正在尝试运行循环以对仅由数字后缀更改的字段名称重复更新命令。

例如，不是写 out ，而是`x_1, y_1`每次`x_2, y_2`更新：

```
DECLARE @a INT 
DECLARE @b VARCHAR 

SET @a = 1
WHILE @a < 30
set @b = @a
  BEGIN
       UPDATE source set h = h + "x_"+@b
           where "y_"+@b = 'Sold'
    SET @a = @a + 1
  END 
```

让我知道我是否可以澄清。我正在使用 SQL Server 2005。

感谢您的任何指导。

* * *

我正在尝试应用 Adams 的解决方案，并且需要了解以下 N' 的正确用法：

```
exec sp_executesql update source_temp set pmt_90_day = pmt_90_day + convert(money,'trans_total_'+@b'')
    where convert(datetime,'effective_date_'+@b) <= dateadd(day,90,ORSA_CHARGE_OFF_DATE)
    and DRC_FLAG_'+@b = 'C' 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-15T22:22:50.003

这实际上不起作用，因为您不能将列名放在引号中。您实际上所做的是让 SQL 比较两个总是不同的字符串，这意味着您永远不会执行更新。

如果你必须这样做，你必须有类似的东西......

```
DECLARE @a INT 
DECLARE @b VARCHAR 
SET @a = 1

WHILE @a < 30
BEGIN
set @b = @a  
exec sp_executesql N'UPDATE source set h = h + 'x_'+@b + N'
           where y_'+@b + N' = ''Sold'''   

SET @a = @a + 1
END 
```

但是，总的来说，我不鼓励这种做法。我不喜欢在另一个 SQL 语句中为任何类型的生产代码生成动态 SQL。对于完成一次性开发任务非常有用，但我不喜欢可以由用户执行的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T01:22:32.443

Adam 对这个问题本身进行了很多讨论，但我要提一下潜在的问题，这只是一个症状。你的数据模型几乎肯定是坏的。如果您打算进行大量（任何）SQL 开发，您应该阅读一些有关数据建模的介绍性书籍。规范化的首要规则之一是实体中不应包含重复组。例如，您不应该有名为“phone_1”、“phone_2”等的列。

这是模拟这种情况的更好方法：

```
CREATE TABLE Contacts (
     contact_id INT NOT NULL,
     contact_name VARCHAR(20) NOT NULL,
     contact_description VARCHAR(500) NULL,
     CONSTRAINT PK_Contacts PRIMARY KEY CLUSTERED (contact_id)
)

CREATE TABLE Contact_Phones (
     contact_id INT NOT NULL,
     phone_type VARCHAR(10) NOT NULL,
     phone_number VARCHAR(20) NOT NULL,
     CONSTRAINT PK_Contact_Phones PRIMARY KEY CLUSTERED (contact_id, phone_type),
     CONSTRAINT CK_Contact_Phones_phone_type CHECK (phone_type IN ('HOME', 'FAX', 'MOBILE'))
) 
```

现在，与其尝试连接一个字符串来处理不同的列，您可以将它们作为一个集合处理，并通过业务逻辑获取您想要的电话号码。（对不起，我没有使用你的例子，但它似乎有点过于笼统，难以理解）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-20T10:29:46.347

```
while @count < @countOfSession
begin
  if @day = 'Saturday' or @day = 'Tuesday'
  begin
    if @day='Saturday'
    begin
      select @date
      set @day='Tuesday'
      set @count=@count+1
      set @date=@date+3
    end
    else if @day='Tuesday'
    begin
      select @date
      set @day='Saturday'
      set @count=@count+1
      set @date=@date+4
    end
  end
end 
```

# c# - 为什么 C# 中的浮点运算不精确？

> ID：753948
> 
> 赞同：18
> 
> 时间：2009-04-15T22:12:57.763
> 
> 标签：c#, floating-point

为什么以下程序打印它打印的内容？

```
class Program
{
    static void Main(string[] args)
    {
        float f1 = 0.09f*100f;
        float f2 = 0.09f*99.999999f;

        Console.WriteLine(f1 > f2);
    }
} 
```

输出是

```
false 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-04-15T22:15:55.200

浮点数只有这么多位数的精度。如果您看到 f1 == f2，那是因为任何差异都需要比 32 位浮点数所能表示的更高的精度。

我建议阅读[每个计算机科学家都应该阅读的关于浮点的内容](http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2015-04-04T19:48:57.213

在这种特殊情况下，这是因为 .09 和 .999999 不能用二进制精确表示（类似地，1/3 不能用十进制精确表示）。例如，0.111111111111111111111111 IS 2 IS IS 0 0.999998672103818359375基础10.基础10.在先前的二进制值中添加1个，0.11111111111111111111111111基础2 IS 2 IS IS 0.9999999999904632568375基础10.没有一个0.9999999999999999999\. 浮点精度还受到分配用于存储指数和尾数小数部分的空间的限制。此外，与整数类型一样，浮点可以溢出其范围，尽管它的范围大于整数范围。

在 Xcode 调试器中运行这段 C++ 代码，

浮动 myFloat = 0.1;

显示 myFloat 的值为 0.100000001。它关闭了 0.000000001。不是很多，但如果计算有几个算术运算，不精确可能会更加复杂。

恕我直言，浮点数的一个很好的解释是在加州州立大学索诺玛分校的 Bob Plantz（退休*）*[http://bob.cs.sonoma.edu /getting_book.html](http://bob.cs.sonoma.edu/getting_book.html)。以下内容基于该章。

浮点数类似于科学记数法，其中一个值存储为大于或等于 1.0 且小于 2.0（尾数）的混合数，乘以另一个数的某个幂（指数）。浮点使用基数 2 而不是基数 10，但在 Plantz 给出的简单模型中，为了清楚起见，他使用基数 10。想象一个系统，其中两个存储位置用于尾数，一个位置用于指数*的符号（0 表示 +，1 表示 -），一个位置用于指数。现在添加 0.93 和 0.91。答案是 1.8，而不是 1.84。

9311 表示 0.93，即 -1 的 9.3 倍 10。

9111 表示 0.91，或 9.1 乘以 10 到 -1。

确切的答案是 1.84，或者 1.84 乘以 10 到 0，如果我们有 5 个位置，这将是 18400，但是，只有四个位置，答案是 1800，或者 1.8 乘以 10 到 0，或者 1.8。当然，浮点数据类型可以使用四个以上的存储位置，但是位置的数量还是有限的。

不仅精度受空间限制，而且“二进制小数值的精确表示仅限于 2 的逆幂之和。” (Plantz, op. cit.)。

0.11100110（二进制）= 0.89843750（十进制）

0.11100111（二进制）= 0.90234375（十进制）

二进制中没有十进制 0.9 的精确表示。即使将分数从更多位置取出也行不通，因为您会在右侧永远重复 1100。

> 初级程序员通常认为浮点运算比整数更准确。确实，即使添加两个非常大的整数也会导致溢出。乘法使结果更有可能非常大，因此溢出。当与两个整数一起使用时，C/C++ 中的 / 运算符会导致小数部分丢失。但是，...浮点表示有其自身的一组不准确之处。(Plantz, op. cit.)

*在浮点中，数字的符号和指数的符号都被表示。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-15T23:17:55.657

主要的是这不仅仅是.Net：它是[底层系统的一个限制，大多数语言都将用来表示](http://en.wikipedia.org/wiki/IEEE_floating_point)内存中的浮点数。精度只能到此为止。

当你考虑到它甚至不是以十为底的时候，你也可以用相对简单的数字来找点乐子。例如，0.1（1/10th）在以二进制表示时是重复的十进制，就像 1/3rd 在以十进制表示时一样。

# css - 使用 display:none 隐藏的 h1 标签是否被搜索引擎突出？

> ID：753951
> 
> 赞同：36
> 
> 时间：2009-04-15T22:14:54.857
> 
> 标签：css, seo

当内容被 CSS 隐藏时（显示：无），是由搜索引擎读取还是网站会因此受到惩罚？就我而言，由于某些 CMS 和其他原因，我需要为用户提供替代内容并使用 display:none 隐藏页面上的 H1 标签。我想知道搜索引擎是否仍会将 H1 标签与未隐藏时一样突出。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-15T22:20:14.423

这违反了 Google 的政策。这称为关键字填充，会让您从 Google 中除名，这意味着您的网站甚至不会再出现在 Google 上。一个好的经验法则是只向 googlebot 显示您网站的用户可以感知的显示内容。

如果您在某个时候向人们展示信息，那么您可能会争辩说您不是关键字堆砌，但 Google 会先将您除名，然后您必须提出上诉。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-15T22:22:45.167

我不相信谷歌会自动惩罚你（意思是没有人工审查），但这绝对是一种风险，特别是如果隐藏文本似乎只是为了 SEO 目的。

[Google 质量指南 - 隐藏的文字和链接](http://www.google.com/support/webmasters/bin/answer.py?answer=66353)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-15T22:32:02.180

搜索引擎构建者已经有大约 15 年的时间来学习人们用来获得更好的搜索引擎评级的每一个技巧，所以你可以确定机器人会注意到一些简单的东西，比如隐藏的文本。

如果页眉标签在页面上不可见，那么将它放在那里毫无意义。搜索引擎充其量会忽略该标签。在最坏的情况下，他们会忽略您的网站。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-15T22:22:15.463

搜索引擎在 CSS 技术方面变得越来越聪明，以隐藏信息以试图欺骗它们。但是，可能存在一个阈值，因此出于足够充分的理由，一两个这样的技术对您来说不会太成问题。如果可以的话，尽量避免它们，尤其是集体。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-16T02:20:45.033

没有理由不能隐藏 H1 标签——这不一定是坏事。使用屏幕阅读器阅读您网站的视障人士会发现隐藏的 H1 很有用，无论它是否隐藏（因为大多数屏幕阅读器阅读的是 HTML 而不是视觉页面）。此外，如果您在页面上有一个商业标志，然后有一个带有商业名称的隐藏 H1，这也很好。在这种情况下，H1 是 Logo 的替代品，因此纯粹出于语义原因它是可以的。

您还可以拥有可以通过用户交互“显示”的隐藏内容（例如单击“更多”链接）。这也很好。隐藏文本并没有错，前提是这样做有一个好的、可用性的理由。当然，关键字填充是错误的，永远不应该这样做——因此，单独的 SEO 原因永远不足以隐藏文本——肯定还有其他原因。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-16T15:04:03.880

如前所述，出于多种目的隐藏信息并不是一个好主意。

如果实际上，您真正想要的是为访问者提供一种替代媒体而不是纯文本，那么有很多方法可以做到这一点，请参阅[CSS 图像替换的九种技术以](http://css-tricks.com/nine-techniques-for-css-image-replacement/)获取更多详细信息，或[sIFR](http://www.mikeindustries.com/blog/sifr/)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-03-08T08:32:23.507

使用`.visuallyhidden`类可能是一个更好的主意，而不是旧的`display:none;`屏幕阅读器会`.visuallyhidden`像阅读纯文本一样阅读内容。

```
.visuallyhidden {
    border: 0 none;
    clip: rect(0px, 0px, 0px, 0px);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px; 
} 
```

我不确定谷歌是否会惩罚在`h1`标签中使用此类类。但无论如何我认为这是一个比使用更好的选择`display: none;`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-16T15:17:41.137

你最好不要这样做。

像谷歌这样的搜索引擎很聪明，他们会检查这种类型的东西，当你被抓到时，你会被标记，你的 SEO 毫无用处。

在系统内工作，不要试图欺骗它。谷歌为希望进行合法 SEO 的开发人员 提供了大量[工具。](http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=35291)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-05T20:04:28.027

它不是关于该搜索引擎的讨论是否应该考虑。这是一个关于搜索引擎会做什么的问题。这是您的答案 [http://support.google.com/webmasters/bin/answer.py?hl=en&answer=66353](http://support.google.com/webmasters/bin/answer.py?hl=en&answer=66353)

搜索引擎将丢弃它，并且它也违反了他们的使用条款，因此他们甚至有权从搜索结果中删除您的网站。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-07-29T22:28:14.030

您可以将背景设置为您希望人们看到的图像，然后将文本缩进为-9999px。

# artificial-intelligence - 如何为国际象棋编写神经网络？

> ID：753954
> 
> 赞同：28
> 
> 时间：2009-04-15T22:15:20.800
> 
> 标签：artificial-intelligence, neural-network, chess

我想编写一个国际象棋引擎，学习如何做出好的动作并战胜其他玩家。我已经编写了棋盘的表示和输出所有可能动作的函数。所以我只需要一个评估函数来说明董事会的给定情况有多好。因此，我想使用一个人工神经网络来评估给定的位置。输出应该是一个数值。该值越高，白棋玩家的位置就越好。

我的方法是建立一个由 385 个神经元组成的网络：棋盘上有 6 个独特的棋子和 64 个区域。因此，对于每个字段，我们需要 6 个神经元（每块 1 个）。如果有白棋，则输入值为 1。如果有黑棋，则值为 -1。如果该字段上没有这种类型的块，则值为 0。除此之外，还应该有 1 个神经元供玩家移动。如果轮到白方，则输入值为1，如果轮到黑方，则输入值为-1。

我认为神经网络的配置非常好。但是缺少主要部分：如何将这个神经网络实现为编码语言（例如 Delphi）？我认为每个神经元的权重在开始时应该是相同的。然后根据比赛结果调整权重。但是怎么做？我想我应该让 2 个电脑玩家（都使用我的引擎）互相对抗。如果白方赢了，黑方会得到它的权重不好的反馈。

因此，如果您能帮助我将神经网络实现为编码语言（最好是 Delphi，否则是伪代码），那就太好了。提前致谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2016-07-25T21:57:26.077

以防有人随机找到此页面。鉴于我们现在所知道的，OP 的提议几乎肯定是可能的。事实上，我们设法为具有更大状态空间的游戏——围棋（[https://deepmind.com/research/case-studies/alphago-the-story-so-far](https://deepmind.com/research/case-studies/alphago-the-story-so-far)）做到了这一点。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-05-16T19:33:27.947

如果您还使用 alpha-beta 修剪进行一些经典的 mini-max 前瞻，我不明白为什么不能为静态评估器使用神经网络。许多国际象棋引擎使用极小极大和脑死的静态评估器，它只是将棋子或其他东西相加；如果您有足够的极小极大水平，这并不重要。我不知道网络会带来多大的改进，但几乎没有什么可失去的。训练它会很棘手。我建议使用一个可以预见许多动作（并占用大量 CPU 等）的引擎来训练评估器以使用一个可以预见更少动作的引擎。这样，您最终会得到一个不占用太多 CPU 的引擎（希望如此）。

编辑：我在 2010 年写了以上内容，现在在 2020 年[Stockfish NNUE 已经完成了](https://blog.stockfishchess.org/post/625828091343896577/introducing-nnue-evaluation)。“该网络在中等搜索深度对数百万个位置的 [经典 Stockfish] 评估进行了优化和训练”，然后用作静态评估器，在初始测试中，当使用此静态评估器而不是他们以前的一个（或者，等效地，相同的 elo 具有更少的 CPU 时间）。所以是的，它确实有效，你甚至不必像我最初建议的那样以高搜索深度训练网络：中等搜索深度就足够了，但关键是使用数百万个位置。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-15T22:30:50.577

去过也做过。由于您的问题没有连续性（一个位置的值与另一个位置的关系并不密切，一个输入的值只有 1 个变化），因此 NN 工作的可能性很小。在我的实验中从未出现过。

我宁愿看到一个带有临时启发式（其中有很多）的模拟退火系统来评估位置的价值......

但是，如果您设置使用NN，则相对容易表示。一般的 NN 只是一个图，每个节点都是一个神经元。每个神经元都有一个当前激活值和一个转换公式，用于根据输入值计算下一个激活值，即与它有链接的所有节点的激活值。

一个更经典的 NN，即具有一个输入层、一个输出层、每一层的相同神经元，并且没有时间依赖性，因此可以由一个输入节点数组、一个输出节点数组和一个链接图来表示连接这些的节点。每个节点都拥有一个当前激活值，以及它转发到的节点列表。计算输出值只是将输入神经元的激活值设置为输入值，然后依次迭代每个后续层，使用转换公式计算前一层的激活值。当您到达最后一个（输出）层时，您就有了结果。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-02-28T19:14:08.217

这是可能的，但无论如何都不是微不足道的。

[https://erikbern.com/2014/11/29/deep-learning-for-chess/](https://erikbern.com/2014/11/29/deep-learning-for-chess/)

为了训练他的评估功能，他动用了大量的计算能力。

概括地说，您可以按如下方式进行。您的评估函数是前馈神经网络。让矩阵计算得出一个标量输出来评估移动的好坏。网络的输入向量是棋盘上所有棋子表示的棋盘状态，比如白兵是 1，白马是 2...，空白区域是 0。棋盘状态输入向量示例是简单的 0 序列-12 的。对于许多游戏，可以使用大师级游戏（例如在 fics 数据库中提供）对这种评估进行训练，从而最大限度地减少当前参数所说的最高估值与大师级移动（应该具有最高估值）之间的损失。这当然假设大师的动作是正确和最优的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-15T22:24:52.417

训练 ANN 所需的东西要么是[反向传播学习](http://en.wikipedia.org/wiki/Backpropagation)，要么是某种形式的[遗传算法](http://en.wikipedia.org/wiki/Genetic_algorithm)。但国际象棋是如此复杂的游戏，一个简单的人工神经网络不太可能学会下棋——如果学习过程是无监督的，情况就更糟了。

此外，您的问题没有说明层数。您想使用 385 个输入神经元对当前情况进行编码。但是你想如何决定做什么呢？每个场的神经元？最高激发获胜？但通常有不止一种可能的举动。

此外，您将需要几个隐藏层 - 可以用输入和没有隐藏层的输出层表示的功能实际上是有限的。

因此，我不想阻止您尝试它，但在一年左右的时间内成功实施和培训的机会几乎为零。

在我 16 岁左右的时候，我试图建立和训练一个人工神经网络来玩井字游戏……但我失败了。我建议先尝试这样一个简单的游戏。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-15T23:58:37.777

我在这里看到的主要问题是培训之一。你说你希望你的 ANN 占据当前的董事会位置并评估它对玩家有多好。（我假设你会为玩家采取所有可能的动作，将其应用于当前的棋盘状态，通过 ANN 进行评估，然后采用输出最高的一个 - 即：爬山）

在我看来，您的选择是：

*   开发一些启发式函数来评估棋盘状态并以此训练网络。但这引出了一个问题，即当您可以使用启发式算法时，为什么还要使用 ANN。

*   使用一些统计方法，例如“在这个棋盘配置中，白棋或黑棋赢了多少场比赛？”，这会给你一个介于白棋或黑棋之间的适应度值。困难在于您的问题空间大小所需的训练数据量。

使用第二个选项，您始终可以从大师游戏中为其提供棋盘序列，并希望有足够的覆盖范围供 ANN 开发解决方案。

由于问题的复杂性，我想尽可能地投入最大的网络（即：大量内部节点），而不会过多地减慢训练速度。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-06-24T00:23:56.210

你的输入算法是正确的——所有的位置、所有的棋子和两个玩家都被考虑在内。对于游戏板的每个过去状态，您可能需要一个输入层，以便将过去的事件再次用作输入。

输出层应该（以某种形式）给出要移动的部分，以及要移动到的位置。

使用包含所有神经元权重和突触强度的连接组编写遗传算法，并开始多个分离的基因库，每个基因库中都有大量连接组。

让他们互相玩，保留最好的少数，交叉和变异最好的连接组以重新填充池。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-07-22T15:18:10.457

阅读 blondie24：[http](http://www.amazon.co.uk/Blondie24-Playing-Kaufmann-Artificial-Intelligence/dp/1558607838) ://www.amazon.co.uk/Blondie24-Playing-Kaufmann-Artificial-Intelligence/dp/1558607838 。

它处理跳棋而不是国际象棋，但原理是相同的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-12-06T02:11:34.440

来这里说塞拉斯的话。使用极小极大算法，您可以预期能够向前看 N 步。使用 Alpha-beta 修剪，您可以将其扩展到理论上 2*N 的移动，但更实际的是 3*N/4 移动。神经网络在这里真的很合适。

也许虽然可以使用遗传算法。

# java - 即将推出的 Java 并发库：jsr166y 是什么？jsr166z？

> ID：753956
> 
> 赞同：9
> 
> 时间：2009-04-15T22:16:05.683
> 
> 标签：java, concurrency, java-7

根据[**这个网站**](http://tech.puredanger.com/java7/#jsr166)，我想玩弄即将包含在 Java 7 中的并发库。

它似乎被命名为**JSR166**。

在大多数地方，它的参考实现称为**jsr166y**，而很少有资源将其**称为 jsr166z**。

我为每个参考实现发现了两个完全**不同的 javadocs。**

*   [**jsr166y**](http://gee.cs.oswego.edu/dl/jsr166/dist/jsr166ydocs/)的文档[](http://gee.cs.oswego.edu/dl/jsr166/dist/jsr166ydocs/)
***   [**jsr166z**](http://www.javac.info/jsr166z/)的文档[](http://www.javac.info/jsr166z/)**

 ****现在，Java 7 中将包含哪个实现？

**编辑**
虽然回答的人建议 jsr166y 是 Java 7 的东西，但我从 JavaOne发现了[**这份**文档 (TS-5515) 。](http://developers.sun.com/learning/javaoneonline/j1sessn.jsp?sessn=TS-5515&yr=2008&track=javase)本文档引用了 Java 7，但提到了仅存在于 jsr166z javadocs 中的 LinkedAsyncAction。（困惑...）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-16T03:08:43.327

JSR 166 是 Java 5 的原始 Java 并发 jsr，它创建了 java.util.concurrent。他们在 Java 6 中进行了名为 JSR 166x 的维护修订。Java 7 维护版本是 JSR 166y。JSR 166z 是闭包原型版本。

目前计划包含在 JSR 166y 中的是：

*   Fork/join（但不是 ParallelArray 框架）
*   TransferQueue / LinkedTransferQueue 集合
*   移相器（类固醇上的 CyclicBarriers）

推送到 JDK 8（至少）：

*   Fences API（低级），试图删除不安全调用的使用
*   ConcurrentReferenceHashMap（变量强/弱引用，并发等）

欲了解更多信息，请[点击此处的 javadoc](http://gee.cs.oswego.edu/dl/jsr166/dist/jsr166ydocs/)或加入并发兴趣邮件列表：

*   [http://cs.oswego.edu/mailman/listinfo/concurrency-interest](http://cs.oswego.edu/mailman/listinfo/concurrency-interest)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T22:22:25.837

javac.info 站点 (jsr166z) 上的链接使用了 BGGA 闭包，它不会出现在 JDK7 中。

Doug Lea 网站 (jsr166y) 上的链接应该是最新的。Doug 是规格负责人。该 API 已被精简为基础，因为在实践中如何使用 fork-join 框架尚不清楚。据推测，库将在稍微更高的级别上可用，当事情稳定下来时，可以将更多的库添加到 JDK8。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-15T22:27:46.730

查看各种可用的参考资料（例如， Doug Lea 的[这封电子邮件](http://cs.oswego.edu/pipermail/concurrency-interest/2009-January/005727.html)），似乎很清楚当前用于 JDK7 并发添加的 JSR 是 jsr166y。此外，如果您访问[Java 编程语言的闭包（又名 BGGA）网页](http://www.javac.info/)并查看（目前是什么）第 4 个项目符号“Doug Lea 的 jsr166y fork-join 框架”，jsr166y 被描述为 fork-join 框架“没有函数类型”，而 jsr166z 被描述为“有函数类型”的 fork-join 框架。

看起来 jsr166z 是并发添加和 BGGA 之间的交叉。也许这提供了 BGGA 所需的并发实用程序？

# c# - 为什么调整png图像的大小会失去透明度？

> ID：753968
> 
> 赞同：10
> 
> 时间：2009-04-15T22:21:42.207
> 
> 标签：c#, image, resize, png, transparency

我正在尝试按如下方式调整图像大小。我将调整大小的图像返回，`byte[]`以便可以将其存储在数据库中。png 图像的透明度丢失。请帮助使这更好。

```
private byte[] GetThumbNail(string imageFile, Stream imageStream, 
  int imageLen)
{
  try
  {
    Image.GetThumbnailImageAbort imageCallBack = 
      new Image.GetThumbnailImageAbort(ThumbnailCallback);
    Bitmap getBitmap = new Bitmap(imageFile);
    byte[] returnByte = new byte[imageLen];
    Image getThumbnail = getBitmap.GetThumbnailImage(160, 59, 
      imageCallBack, IntPtr.Zero);
    using (Graphics g = Graphics.FromImage(getThumbnail))
    {
      g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;
      g.InterpolationMode = 
        System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
      g.DrawImage(getThumbnail, 0, 0, 160, 59);
    }
    using (MemoryStream ms = new MemoryStream())
    {
      getThumbnail.Save(ms, ImageFormat.Png);
      getThumbnail.Save("test.png", ImageFormat.Png);
      returnByte = ms.ToArray();
    }
    return returnByte;
  }
  catch (Exception)
  {
    throw;
  }
} 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-15T23:07:34.683

您的代码并没有完全按照您的想法执行...

您使用 GetThumbnailImage 来调整图像大小，然后将缩略图图像绘制到自身中，这是毫无意义的。您可能会在第一步中失去透明度。

而是创建一个空白位图，并通过在空白位图上绘制来调整源图像的大小。

```
private byte[] GetThumbNail(string imageFile) {
  try {
    byte[] result;
    using (Image thumbnail = new Bitmap(160, 59)) {
      using (Bitmap source = new Bitmap(imageFile)) {
        using (Graphics g = Graphics.FromImage(thumbnail)) {
          g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;
          g.InterpolationMode =  System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
          g.DrawImage(source, 0, 0, 160, 59);
        }
      }
      using (MemoryStream ms = new MemoryStream()) {
        thumbnail.Save(ms, ImageFormat.Png);
        thumbnail.Save("test.png", ImageFormat.Png);
        result = ms.ToArray();
      }
    }
    return result;
  } catch (Exception) {
    throw;
  }
} 
```

（我删除了一些从未用于与结果有任何关系的参数，例如仅用于创建从未使用过的字节数组的 imageLen 参数。）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-15T22:33:36.763

尝试`.MakeTransparent()`在您的位图对象上使用调用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-05T05:14:46.017

可能你应该做这样的事情，因为这对我有用：

```
String path = context.Server.MapPath("/images");
if (!path.EndsWith("\\"))
    path += "\\";
path += "none.png";

Image img = CreateThumbnail(Image.FromFile(path));

MemoryStream ms = new MemoryStream();
img.Save(ms, ImageFormat.Png);
ms.WriteTo(context.Response.OutputStream); 
```

* * *

```
private System.Drawing.Image CreateThumbnail(System.Drawing.Image i)
{
    int dWidth = i.Width;
    int dHeight = i.Height;
    int dMaxSize = 150;

    if (dWidth > dMaxSize)
    {
        dHeight = (dHeight * dMaxSize) / dWidth;
        dWidth = dMaxSize;
    }
    if (dHeight > dMaxSize)
    {
        dWidth = (dWidth * dMaxSize) / dHeight;
        dHeight = dMaxSize;
    }
    return i.GetThumbnailImage(dWidth, dHeight, delegate() { return false; }, IntPtr.Zero);
} 
```

# svn - 您建议我的网站使用什么版本控制系统？

> ID：753982
> 
> 赞同：5
> 
> 时间：2009-04-15T22:25:12.510
> 
> 标签：svn, backup, versioning

当涉及到颠覆和 SVN 时，我是一个绝对的新手（甚至不知道有什么区别）。当我正在开发一个相当大的网站时，我正在寻找一种方法来处理不同的版本（PHP、CSS、JavaScript 文件和 MySQL 数据库）并进行备份。我想使用基于 Web 的系统，所以我有一个外部备份。我没有在这个项目的团队中工作，因此不需要围绕此的功能。我正在使用 Windows Vista。此时我压缩我的文件并将它们上传到box.net。但我确信有更好的方法来实现这一点。有什么建议么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-15T22:28:52.483

颠覆（又名 SVN）和[http://tortoisesvn.net/](http://tortoisesvn.net/)

> TortoiseSVN 是一个易于使用的 SCM / 源代码控制软件，适用于 Microsoft Windows，并且可能是最好的独立 Subversion 客户端。它被实现为 Windows shell 扩展，使其无缝集成到 Windows 资源管理器中。由于它不是针对特定 IDE 的集成，因此您可以将它与您喜欢的任何开发工具一起使用。

您甚至不需要将 subversion 存储库放在您自己的机器上——尽管备份它更重要，因为您仍然依赖于自己硬盘驱动器的安全性。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-15T22:33:24.720

我推荐 git。

有人说这对新手来说很难，但我认为这根本不是真的。我只是按照[官方教程](http://www.kernel.org/pub/software/scm/git/docs/gittutorial.html)很快就掌握了它，而且在版本控制方面我真的是一个初学者。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-15T22:46:48.433

正如 Topbit 之前提到的，我自己使用 Subversion，使用[http://tortoisesvn.net/](http://tortoisesvn.net/)，因此您无需进入命令提示符即可提交/更新。

有很多颠覆主机，我推荐[http://www.unfuddle.com](http://www.unfuddle.com)。它对一个项目是免费的，并附带其他很酷的东西来帮助项目管理。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-15T22:48:34.870

我也推荐 svn，部分是因为它的文档。

[http://svnbook.red-bean.com/en/1.5/index.html](http://svnbook.red-bean.com/en/1.5/index.html)

你可以在完全不了解分支的情况下使用它，这对于 git 来说是不能说的。

Subversion 和 svn 是同一事物的不同名称。全称是subversion，但是命令行程序是svn，是常用的缩写。

您的虚拟主机可能提供了一个颠覆服务器——dreamhost 提供。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-15T23:03:23.650

我听说过有关[Beanstalk](http://www.beanstalkapp.com)的好消息，但我自己还没有机会使用它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-15T22:48:44.230

支付 github 或 bitbucket 帐户并使用 mercurial 或 git。

Mercurial 可能在 Windows 上工作得更好，而 bitbucket 确实允许我认为免费帐户上有 1 个私人回购。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-15T22:59:31.833

我喜欢[Mercurial](http://www.selenic.com/mercurial/wiki/)来完成这样的任务。

**好处：**

*   存储库只是一个 .hg 目录 - 您可以根据需要将其复制到任何地方，您不必处理分散在整个项目中的隐藏“CVS”或 .svn 目录等。
*   无需服务器设置 - 特别适合您自己使用它的情况。这对所有的[DVCS](http://en.wikipedia.org/wiki/Distributed_Version_Control_System)来说都是如此——实际上，上述观点也是如此。
*   在 Windows 中运行良好 - 无需 Cygwin
*   易于离线工作（尽管听起来这对您来说并不重要）

**（可能的）缺点：**

*   仅命令行（几乎）。我认为 CL 界面相当不错，但是如果没有 GUI，有些人会回避。有 TortoiseHg，但我不能保证。
*   ......我不知道......它真的很棒（：

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-15T23:15:02.827

[只是为了给你一些资源，这里是版本控制系统](http://en.wikipedia.org/wiki/Version_control_system)（VCS）的微观概述：

“传统” VCS 有一个服务器来保存存储库（更改历史记录）。在此方案中，客户端（您）从该存储库中获取文件的修订版，并将更改“签入”（即上传）到服务器。

这种类型的 VCS 的示例是：

*   CVS - 旧备用
*   SVN - 更现代的 CVS 替代品
*   Perforce - 专有的，但有一些漂亮的花里胡哨

然后是[分布式版本控制系统](http://en.wikipedia.org/wiki/Distributed_Version_Control_System)（DVCS），这是一个相当新的发展。在这里，没有服务器。每个客户（例如您）都有一个存储库的副本。人们制作存储库的副本，进行一些更改，然后将这些更改与其他存储库合并。

这些例子是：

*   Git - 最初用于 Linux 内核开发，但现在独立了
*   Mercurial - 用 Python 编写，可移植，我个人的最爱
*   集市 - 也是 Python

还有很多其他的 - Darcs、Monotone、Plastic SCM 等。

一些链接：

*   [http://en.wikipedia.org/wiki/Revision_control](http://en.wikipedia.org/wiki/Revision_control)
*   [http://www.smashingmagazine.com/2008/09/18/the-top-7-open-source-version-control-systems/](http://www.smashingmagazine.com/2008/09/18/the-top-7-open-source-version-control-systems/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-15T23:24:24.660

像大多数其他人一样，我建议使用 SVN - 暂时忽略“分支”之类的功能。使用 TortoiseSVN (Windows) 作为初学者。

看看[SlikSVN](http://www.sliksvn.com/en/download)，它是 SVN 存储库的主机服务（满足您的“外部”需求）——如果您没有自己的服务器，SlikSVN 非常适合入门（价格合理）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-15T23:59:58.210

同上@Kirschstein。我们使用[http://unfuddle.com](http://unfuddle.com)。超级容易上手，如果你使用 TortoiseSVN 作为 Windows 资源管理器插件，它再简单不过了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-15T22:32:51.883

对于备份使用外部硬盘驱动器。对于我所有的项目（网络/桌面开发），我使用 SVN。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-15T23:37:42.273

备份与源代码管理非常不同。有关（高级）源代码控制的介绍，请阅读以下“经典”文章：http: [//oreilly.com/catalog/practicalperforce/chapter/ch07.pdf](http://oreilly.com/catalog/practicalperforce/chapter/ch07.pdf)

# python - 有没有更 Pythonic 的方式来构建这本字典？

> ID：753986
> 
> 赞同：6
> 
> 时间：2009-04-15T22:26:44.220
> 
> 标签：python

什么是构建字典的“最 Pythonic”的方法，其中我有一个序列中的值，每个键都是它的值的函数？我目前正在使用以下内容，但我觉得我只是缺少一种更清洁的方式。注意：`values`是一个与任何字典都不相关的列表。

```
for value in values:
    new_dict[key_from_value(value)] = value 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-15T22:30:23.387

至少它更短：

```
dict((key_from_value(value), value) for value in values) 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-15T22:36:49.080

```
>>> l = [ 1, 2, 3, 4 ]
>>> dict( ( v, v**2 ) for v in l )
{1: 1, 2: 4, 3: 9, 4: 16} 
```

在 Python 3.0 中，您可以使用“dict comprehension”，它基本上是上述内容的简写：

```
{ v : v**2 for v in l } 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-16T08:42:09.000

Py3K：

```
{ key_for_value(value) : value for value in values } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-15T23:26:40.910

此方法避免了列表理解语法：

```
dict(zip(map(key_from_value, values), values)) 
```

我永远不会声称自己是“Pythonic”的权威，但这种方式感觉是个好方法。

# php - 使用二进制编码参数创建 PHP Web 服务？

> ID：753987
> 
> 赞同：0
> 
> 时间：2009-04-15T22:26:52.550
> 
> 标签：php, iphone, web-services, image

我正在尝试为我正在开发的 iPhone 项目构建 PHP 网络服务。我需要能够将图像（图片）发送到网络服务，然后我将其存储在数据库中。我还需要编写一个服务，当然，它会在请求时返回此数据。

我不知道从哪里开始。我已经“用谷歌搜索”了如何构建这样的网络服务，但找不到如何做到这一点的好例子。有没有人有可能有帮助的代码示例或教程的网址？

问候，

杰米。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T06:00:31.510

您需要做的是在您的网络服务器上创建一个表单处理脚本，它将接收来自 iphone 客户端的“POST”。[在http://www.w3schools.com/PHP/php_file_upload.asp](http://www.w3schools.com/PHP/php_file_upload.asp)上提供了一个使用纯 PHP的简单示例。

但是，由于您将 iphone 作为客户端，您可能希望使用 NSMutableURLRequest 对象将图像“发布”到您已经在服务器上设置的脚本。您没有指定图像的来源，但您可能想阅读以下内容：

[http://iphone.zcentric.com/2008/08/29/post-a-uiimage-to-the-web/](http://iphone.zcentric.com/2008/08/29/post-a-uiimage-to-the-web/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T06:59:46.500

正如烦恼所说，您需要使用 POST 表单中的图像数据构建 HTTP POST 请求。

我强烈推荐 All Seeing eye 的[ASIHTTPRequest](http://allseeing-i.com/ASIHTTPRequest/)框架来构建表单。具体来说，您想使用 ASIFormDataRequest 类。您可以使用（例如）从 UIImage 检索二进制信息，并通过向实例发送消息`NSData *UIImageJPEGRepresentation(UIImage *image, CGFloat compressionQuality);` 将其添加到 ASHFormDataRequest`-(void)setData:(NSData *)data forKey:(NSString *)key`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T22:45:29.463

我不知道 iPhone 的结局，但 XML Schema Definition 提供了对 Base64 编码数据（和 Hex 编码数据）的支持，这将允许您通过 Soap 协议传输图像信息。

*   [http://www.w3.org/TR/xmlschema11-2/#base64Binary](http://www.w3.org/TR/xmlschema11-2/#base64Binary)
*   [http://us2.php.net/manual/en/class.soapserver.php](http://us2.php.net/manual/en/class.soapserver.php)

# asp.net - L2Entity、存储过程和映射

> ID：753995
> 
> 赞同：1
> 
> 时间：2009-04-15T22:28:11.207
> 
> 标签：asp.net, sql, stored-procedures, linq-to-entities, mapping

最后检查了 L2E 框架并几乎立即遇到了问题。
是的，我知道...我应该先读一些书。

**情况：**

带有道具-> id 和名称的实体。
实体映射到具有 id 和 name 列的表。
sproc，它只返回 id 列。

**问题：**

```
ObjectResult<MyProp> result = _container.MyStoredProcedure(uberParameter); 
```

调用它会导致错误

[这里有罪的方法]抛出异常：System.Data.EntityCommandExecutionException：数据读取器与指定的'DataBase.MyPropTableObject'不兼容。类型的成员“名称”在数据读取器中没有同名的对应列。

**问题2：**

不能“只返回”该字段，因为该列具有 XML 数据类型，但 sproc 使用花哨的 select 语句，这会导致：

Msg 421, Level 16, State 1, Line 1 xml 数据类型不能选择为 DISTINCT，因为它不可比较。

**问题：**
是否可以仅针对这个 sproc 专门关闭此实体道具的映射？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-16T08:36:58.467

问题 1 是由于 proc 没有用于填充实体的列。如果您已经映射了表格，您实际上并不需要 proc，只需使用 linq 从中选择您想要的字段

```
var result = MyEntities.EntityIMapped.First(r => r.id = uberParameter).Name; 
```

将为您提供给定 id 表的 Name 列中的值。您不需要为此使用存储过程。

问题 2 听起来像是在 proc 中，我认为 xml 数据列上的 distinct 会产生很多结果，但我只是猜测，因为我不知道您的解决方案。

这不是您问题的直接答案，但希望它能为您指明正确的方向。

# php - CodeIgniter 中的 JSONP

> ID：753996
> 
> 赞同：9
> 
> 时间：2009-04-15T22:28:18.303
> 
> 标签：php, jquery, codeigniter, jsonp

`$.getJSON`我在 CodeIgniter 中使用 jQuery JSONP 方法时遇到问题。从中获取 JSON 的 URL 如下：

```
http://spinly.000space.com/index.php/admin/isloggedin 
```

问题是我有一个`demo.html`运行该`$.getJSON`方法的文件，并从上面提到的 URL 中获取数据。

**演示.html**：

```
<html>
<head>
  <script src="http://www.spinly.000space.com/public/js/jquery.js"></script>

  <script>
  $(document).ready(function(){
  var myurl = "http://spinly.000space.com/index.php/admin/isloggedin/&jsoncallback=?";

    //myurl = "http://com.lnk.bz/jsonp.php?sleep=3&jsoncallback=?";
    $.getJSON(myurl,function(adat) {
        alert(adat);
     //   clearTimeout(t);
    }); 

  });
  </script>
</head>
<body>
  <div id="images">
  </div>
</body>
</html> 
```

当我跑步时，`demo.html`什么也没有发生。如您所见，当我将 URL 更改为另一个不使用 CodeIgniter 作为框架的 URL 时，它应该提醒返回的数据。我让警报功能运行，但在这种情况下，使用 CodeIgniter 备份的 URL 时，它不起作用。有没有人可以解决我的问题？如果您能给我一些反馈，我将不胜感激。提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-15T22:56:58.033

您的网址中的＆符号是错误的：

```
loggedin/&jsoncallback=? 
```

它应该是类似的东西

```
loggedin/?jsoncallback=? 
```

运行我得到的响应

```
jsonp123( ... 
```

这意味着它会尝试调用 jsonp123 函数，此时您的代码中的 adat 部分从未使用过。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-01T14:43:32.343

默认情况下，CI 不允许查询字符串，那么您是否在 config.php 中启用**了 enable_query_strings**？

```
$config['enable_query_strings'] = TRUE; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-30T19:01:09.390

我认为您面临的问题是由于浏览器对不允许跨域请求的限制。我猜您是在其他域/子域上托管您的应用程序，这就是导致此问题的原因。

您需要使用的是 JSONP，即带填充的 Json。详情在这里：[http ://en.wikipedia.org/wiki/JSONP](http://en.wikipedia.org/wiki/JSONP)

在这里查看 jquerys ajax api 中的 jsonp：http://api.jquery.com/jQuery.ajax/[看看](http://api.jquery.com/jQuery.ajax/)是否能解决您的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-28T04:11:19.790

还要确保您已在 config.php中`$config['allow_get_array']`设置为。`TRUE`这将允许您使用

`$this->input->get();`

在您的控制器中。**********``*******