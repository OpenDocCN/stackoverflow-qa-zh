# StackOverflow 问答 000891000-000891999

# c# - C# 序列包

> ID：891005
> 
> 赞同：1
> 
> 时间：2009-05-21T01:13:21.463
> 
> 标签：c#, .net, networking

我已经做了一些研究，关于如何在 C# 中创建 SeqPacket 类型的套接字的信息很少（基本上没有）这样做会失败：
listenerSocket = new Socket(AddressFamily.InterNetwork, SocketType.Seqpacket, ProtocolType.Tcp) ;
我是网络新手，所以我可能正在做一些非常愚蠢的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T01:17:06.120

SocketType.Seqpacket 仅在 NetBIOS 中受支持。没有理由将它用于 TCP 连接。

有关详细信息，请参阅此[MSDN 线程](http://social.msdn.microsoft.com/forums/en-US/netfxnetcom/thread/5f15fb4a-e691-4805-bc61-53c3e6ffc55b)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T01:35:25.837

如果你是网络新手，那么我建议你远离像套接字这样的低级东西，除非这是家庭作业。请改用 WCF。

# asp.net - ASP.NET：是否可以遍历所有 Session 对象？

> ID：891016
> 
> 赞同：2
> 
> 时间：2009-05-21T01:20:18.893
> 
> 标签：asp.net, session, collections

在 ASP.NET 3.5 中，是否可以遍历所有会话对象（不是当前会话中的对象，而是所有用户的所有会话），以便可以操纵它们的集合内容（即从所有活动中删除一个集合项会话）？

如果是这样，这是否适用于 ASP.NET 状态服务（访问由共享相同状态服务的所有 Web 服务器创建的所有会话，全部来自一个 Web 服务器）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T01:30:05.113

[我询问](https://stackoverflow.com/questions/257843/can-i-abandon-an-inproc-asp-net-session-from-a-session-different-than-one-making)的有关从另一个会话中删除会话的问题的[答案](https://stackoverflow.com/questions/257843/can-i-abandon-an-inproc-asp-net-session-from-a-session-different-than-one-making/882702#882702)可能对您有所帮助。我没有尝试过，您需要扩展它，但似乎可以使用反射访问所有会话的容器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T17:08:21.377

我认为我想出的唯一答案是：如果您正在使用单个框，则可以将会话放入存储在 Application 集合中的集合中，并在每个会话结束时删除每个会话。但是为了对共享状态服务器进行全局会话更新，可以归功于 tvanfosson 在其他答案之一下的评论：除了使用通过网络套接字启用此功能的第三方或备用状态服务器之外，SQL Server 是唯一合理可行的选择.

# c# - 访问级别和修饰符（私有、密封等）是否在 C# 中用于安全目的？

> ID：891018
> 
> 赞同：11
> 
> 时间：2009-05-21T01:23:54.533
> 
> 标签：c#, security, sealed

我已经看到您可以[使用反射来操纵私有和内部成员](http://www.codeproject.com/KB/cs/testnonpublicmembers.aspx)。我还看到它说[“密封”类比非密封类更安全](http://www.allinterview.com/showanswers/4887.html)。

修饰符“public、protected、internal、private、abstract、sealed、readonly”是否仅仅是关于设计和 API 使用的君子协议，只要您可以访问反射就可以打破？如果黑客已经在运行调用你的 API 的代码，那么游戏就已经失败了，对吧？

以下是否比任何其他类更安全？

```
//private class
sealed class User
{
    private string _secret = "shazam";
    public readonly decimal YourSalary;
    public string YourOffice{get;};
    private DoPrivilegedAction()
    {
    }
} 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-05-21T16:09:01.400

首先，回答您的问题：安全系统旨在保护**好用户免受不良代码**的侵害；它显然不是为了保护**GOOD CODE 免受 BAD USERS**的影响。您的访问限制减轻了**部分受信任的恶意代码****对您的用户的攻击**。它们不会减轻**敌对用户****对您的代码**的攻击。如果威胁是恶意用户获取您的代码，那么您就有大问题了。安全系统根本无法减轻这种威胁。

 ******其次，要解决之前的一些答案：理解反射和安全之间的完整关系需要仔细注意细节并很好地理解 CAS 系统的细节。先前发布的答案指出，由于反射，安全性和访问之间没有联系，这是误导和错误的。

是的，反射允许您覆盖“可见性”限制（有时）。这并不意味着访问和安全之间没有联系。联系是使用反射覆盖访问限制的权利与CAS系统有多种方式的深度联系。

首先，为了*任意*这样做，代码必须获得 CAS 系统的私有反射权限。这通常只授予完全受信任的代码，毕竟这些代码已经可以做*任何事情了*。

其次，在新的 .NET 安全模型中，假设程序集 A 被 CAS 系统授予程序集 B 的授权集的超集。在这种情况下，程序集 A 中的代码可以使用反射来观察 B 的内部。

第三，当您将动态生成的代码加入其中时，事情变得非常复杂。解释“Skip Visibility”与“Restricted Skip Visibility”是如何工作的，以及它们如何改变反射、访问控制和安全系统之间的交互，在运行时代码被吐出的情况下，这将花费我比我更多的时间和空间有可用的。如果您需要详细信息，请参阅 Shawn Farkas 的博客。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-21T01:39:46.870

访问修饰符不是关于安全性，而是良好的设计。类和方法的适当访问级别驱动/实施良好的设计原则。理想情况下，反射应该只在使用它的便利性比违反（如果有的话）最佳设计实践的成本提供更多效用时使用。密封类仅用于防止开发人员扩展您的类并“破坏”它的功能。关于密封类的实用性有不同的看法，但由于我做 TDD 并且很难模拟密封类，所以我尽可能避免它。

如果您想要安全，您需要遵循防止坏人进入和/或保护机密信息不被检查的编码实践，即使发生入侵也是如此。入侵防御、入侵检测、加密、审计等是您需要使用的一些工具来保护您的应用程序。设置限制性访问修饰符和密封类与应用程序安全性无关，IMO。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-21T01:33:07.103

不，这些与安全无关。反射打破了它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T02:18:42.643

关于反射和安全性的评论 - 考虑到 mscorlib.dll 中有许多内部类型 + 成员调用本机 Windows 函数，如果恶意应用程序使用反射调用它们，可能会导致不良后果。这不一定是问题，因为不受信任的应用程序通常不会被运行时授予这些权限。这（以及一些声明性安全检查）是 mscorlib.dll 二进制文件如何将其类型公开给各种受信任和不受信任的代码，但不受信任的代码无法绕过公共 API。

这实际上只是触及了反射+安全问题的表面，但希望它足以引导您走上正确的道路。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-21T02:22:44.693

我总是试图将事情锁定在所需的最小访问权限内。就像 tvanfosson 所说，这实际上是关于设计而不是安全性。

例如，我将公开一个接口，以及我的内部实现，然后是一个公共工厂类/方法来获取实现。这几乎迫使消费者始终将其键入为接口，而不是实现。

话虽如此，开发人员可以使用反射来实际实例化实现类型的新实例。没有什么能阻止他/她。但是，我可以放心，因为我让违反设计至少有些困难。

# cocoa-touch - 绘制一条线的动画（Quartz 2D？）

> ID：891030
> 
> 赞同：0
> 
> 时间：2009-05-21T01:31:30.303
> 
> 标签：cocoa-touch, core-graphics, quartz-graphics

您将如何在 iPhone 上的 UIView 中为线条的绘制设置动画？这可能吗？它可以被绘制，但它可以很*容易地*被动画化，所以它看起来是手绘的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-12T12:25:34.560

没有内置的方法可以做到这一点。您必须反复重绘线，使用计时器回调在起点和终点之间进行插值，以使视图无效并触发重绘。当然，重绘必须绘制视图区域中的所有内容，这可能会很慢。

如果我想在一段时间内绘制一系列线条，我会做的是有两个子视图 - 它们将覆盖相同的区域，而顶部的将具有透明背景。让顶部仅绘制我当前正在制作动画的线条，完成后，在下部视图中绘制它的全长。然后重复，在顶视图中为下一行设置动画。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-18T20:54:33.367

使用新的 API，您可以使用`strokeEnd`CGPath 的属性轻松地做到这一点。

您可以在此处阅读更多详细信息：[为线条制作动画最简单的方法是什么？](https://stackoverflow.com/questions/6773185/whats-the-easiest-way-to-animate-a-line)

# java - 有没有一种方法可以在 Java 中计算阶乘？

> ID：891031
> 
> 赞同：111
> 
> 时间：2009-05-21T01:31:33.970
> 
> 标签：java

我还没找到呢 我错过了什么？我知道阶乘法是初学者的常见示例程序。但是，有一个标准的实现让这个实现重用不是很有用吗？我可以将这种方法与标准类型（例如 int、long ...）和 BigInteger / BigDecimal 一起使用。

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-05-21T03:30:50.050

[Apache Commons Math在](http://commons.apache.org/math/userguide/utilities.html)[MathUtils](http://commons.apache.org/proper/commons-math/apidocs/org/apache/commons/math4/util/MathUtils.html)类中有一些阶乘方法。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2011-10-24T17:43:35.133

```
public class UsefulMethods {
    public static long factorial(int number) {
        long result = 1;

        for (int factor = 2; factor <= number; factor++) {
            result *= factor;
        }

        return result;
    }
} 
```

[HoldOffHunger](https://stackoverflow.com/users/2430549/holdoffhunger)的 Big Numbers 版本：

```
public static BigInteger factorial(BigInteger number) {
    BigInteger result = BigInteger.valueOf(1);

    for (long factor = 2; factor <= number.longValue(); factor++) {
        result = result.multiply(BigInteger.valueOf(factor));
    }

    return result;
} 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-05-21T01:45:41.027

我认为拥有一个用于阶乘的库函数没有用处。对有效的阶乘实现进行了大量研究。[这是一些实现。](http://www.luschny.de/math/factorial/FastFactorialFunctions.htm)

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2009-05-21T01:52:15.037

在实践中很少需要裸露的阶乘。大多数情况下，您将需要以下其中一项：

1) 将一个阶乘除以另一个，或

2）近似浮点答案。

在这两种情况下，您最好使用简单的自定义解决方案。

在情况 (1) 中，假设 x = 90！/ 85!，那么你将计算结果就像 x = 86 * 87 * 88 * 89 * 90，而不需要保持 90！在记忆中 ：）

在情况（2）中，谷歌搜索“斯特林近似”。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2013-02-19T12:48:07.347

使用 Guava 的[`BigIntegerMath`](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/math/BigIntegerMath.html)方法如下：

```
BigInteger factorial = BigIntegerMath.factorial(n); 
```

（和的类似功能分别在`int`和`long`中可用。）[`IntMath`](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/math/IntMath.html)[`LongMath`](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/math/LongMath.html)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-05-21T01:34:15.387

尽管阶乘对于初学者来说是一个很好的练习，但在大多数情况下它们并不是很有*用*，而且每个人都知道如何编写阶乘函数，所以它们通常不在普通库中。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-05-21T11:04:24.870

Apache Commons Math 包有[一个阶乘方法](http://commons.apache.org/proper/commons-math/apidocs/org/apache/commons/math3/util/ArithmeticUtils.html#factorial%28int%29)，我想你可以使用它。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-05-22T13:00:27.780

简短的回答是：使用递归。

您可以创建一个方法并在同一方法中递归地调用该方法：

```
public class factorial {

    public static void main(String[] args) {
        System.out.println(calc(10));
    }

    public static long calc(long n) {
        if (n <= 1)
            return 1;
        else
            return n * calc(n - 1);
    }
} 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2013-07-20T07:22:31.937

我相信这将是最快的方式，通过查找表：

```
private static final long[] FACTORIAL_TABLE = initFactorialTable();
private static long[] initFactorialTable() {
    final long[] factorialTable = new long[21];
    factorialTable[0] = 1;
    for (int i=1; i<factorialTable.length; i++)
        factorialTable[i] = factorialTable[i-1] * i;
    return factorialTable;
}
/**
 * Actually, even for {@code long}, it works only until 20 inclusively.
 */
public static long factorial(final int n) {
    if ((n < 0) || (n > 20))
        throw new OutOfRangeException("n", 0, 20);
    return FACTORIAL_TABLE[n];
} 
```

对于原生类型`long`（8 字节），它最多只能容纳`20!`

```
20! = 2432902008176640000(10) = 0x 21C3 677C 82B4 0000 
```

显然，`21!`会造成溢出。

因此，对于 native type `long`，只`20!`允许最大的、有意义的和正确的。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2014-11-05T11:33:02.003

因为阶乘增长如此之快，如果使用递归，堆栈溢出不是问题。其实值20！是 Java long 中可以表示的最大长度。因此，如果 n 太大，以下方法将计算 factorial(n) 或抛出 IllegalArgumentException。

```
public long factorial(int n) {
    if (n > 20) throw new IllegalArgumentException(n + " is out of range");
    return (1 > n) ? 1 : n * factorial(n - 1);
} 
```

做同样事情的另一种（更酷）方法是使用 Java 8 的流库，如下所示：

```
public long factorial(int n) {
    if (n > 20) throw new IllegalArgumentException(n + " is out of range");        
    return LongStream.rangeClosed(1, n).reduce(1, (a, b) -> a * b);
} 
```

阅读有关[使用 Java 8 流的 Factorials 的更多信息](http://minborgsjavapot.blogspot.se/2014/11/compute-factorials-using-java-8-streams.html)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2015-04-09T22:39:47.250

试试这个

```
public static BigInteger factorial(int value){
    if(value < 0){
        throw new IllegalArgumentException("Value must be positive");
    }

    BigInteger result = BigInteger.ONE;
    for (int i = 2; i <= value; i++) {
        result = result.multiply(BigInteger.valueOf(i));
    }

    return result;
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-08-30T20:36:03.187

您可以使用递归。

```
public static int factorial(int n){    
      if (n == 0)    
        return 1;    
      else    
        return(n * factorial(n-1));    
     } 
```

然后在您创建上面的方法（函数）之后：

```
System.out.println(factorial(number of your choice));  
    //direct example
    System.out.println(factorial(3)); 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-01-15T18:54:43.837

我发现了一个惊人的技巧，可以在实际乘法的一半中找到阶乘。

请耐心等待，因为这是一个有点长的帖子。

**对于偶数：** 要将偶数乘法减半，您将得到 n/2 个因数。第一个因素将是您要对其进行阶乘的数字，然后是该数字加上该数字减去二。下一个数字将是前一个数字加上最后添加的数字减去二。**当您添加的最后一个数字是 2（即 2）时，您就完成了**。这可能没有多大意义，所以让我举个例子。

```
8! = 8 * (8 + 6 = 14) * (14 + 4 = 18) * (18 + 2 = 20)

8! = 8 * 14 * 18 * 20 which is **40320** 
```

请注意，我从 8 开始，然后我添加的第一个数字是 6，然后是 4，然后是 2，每个添加的数字都比之前添加的数字少 2。这种方法相当于将最小的数字与最大的数字相乘，只是乘法较少，如下所示：

```
8! = 1 * 2 * 3 * 4 * 5 * 6 * 7 * 
8! = (1 * 8) * (2 * 7) * (3 * 6) * (4 * 5)
8! = 8 * 14 * 18 * 20 
```

是不是很简单：）

**现在对于奇数：**如果数字是奇数，则加法是相同的，就像每次减去 2，但在 3 处停止。然而，因素的数量发生了变化。如果你将这个数字除以 2，你最终会得到一些以 0.5 结尾的数字。原因是，如果我们将两端相乘，剩下的就是中间的数字。基本上，这都可以通过求解等于数字除以二并向上取整的多个因子来解决。对于没有数学背景的人来说，这可能没有多大意义，所以让我举个例子：

```
9! = 9 * (9 + 7 = 16) * (16 + 5 = 21) * (21 + 3 = 24) * (roundUp(9/2) = 5)

9! = 9 * 16 * 21 * 24 * 5 = **362880** 
```

**注意：**如果您不喜欢这种方法，您也可以只取奇数之前的偶数的阶乘（在本例中为 8），然后乘以奇数（即 9！= 8！* 9）。

现在让我们用Java实现它：

```
public static int getFactorial(int num)
{
    int factorial=1;
    int diffrennceFromActualNum=0;
    int previousSum=num;

    if(num==0) //Returning  1 as factorial if number is 0 
        return 1;
    if(num%2==0)//  Checking if Number is odd or even
    { 
        while(num-diffrennceFromActualNum>=2)
        {
            if(!isFirst)
            {
                previousSum=previousSum+(num-diffrennceFromActualNum);  
            }
            isFirst=false;
            factorial*=previousSum;
            diffrennceFromActualNum+=2;
        }
    }
    else // In Odd Case (Number * getFactorial(Number-1))
    {
        factorial=num*getFactorial(num-1);
    }
    return factorial;
} 
```

`isFirst`是一个声明为静态的布尔变量；它用于第一种情况，我们不想更改之前的总和。

尝试偶数和奇数。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-05-21T01:56:30.847

我能想到的阶乘的唯一商业用途是 Erlang B 和 Erlang C 公式，并不是每个人都在呼叫中心或电话公司工作。一个特性对业务的有用性似乎经常决定一种语言中显示的内容——看看主要语言中的所有数据处理、XML 和 Web 功能。

为这样的事情保留一个阶乘片段或库函数很容易。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-11-18T19:10:33.317

一个非常简单的计算阶乘的方法：

```
private double FACT(double n) {
    double num = n;
    double total = 1;
    if(num != 0 | num != 1){
        total = num;
    }else if(num == 1 | num == 0){
        total = 1;
    }
    double num2;
    while(num > 1){
        num2 = num - 1;
        total = total * num2;
        num = num - 1;
    }
    return total;
} 
```

我使用了 double，因为它们可以容纳大量数字，但是您可以使用任何其他类型，例如 int、long、float 等。

PS这可能不是最好的解决方案，但我是编码新手，我花了很长时间才找到一个可以计算阶乘的简单代码，所以我不得不自己编写这个方法，但我把它放在这里，这样它可以帮助像我这样的其他人.

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-11-30T06:34:55.573

您也可以使用递归版本。

```
static int myFactorial(int i) {
    if(i == 1)
        return;
    else
        System.out.prinln(i * (myFactorial(--i)));
} 
```

由于必须推送和弹出递归，递归通常效率较低，因此迭代更快。另一方面，递归版本使用较少或不使用局部变量，这是一个优势。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2014-04-04T10:50:08.857

阶乘是高度增加的离散函数。所以我认为使用 BigInteger 比使用 int 更好。我已经实现了以下代码来计算非负整数的阶乘。我使用递归代替了循环。

```
public  BigInteger factorial(BigInteger x){     
    if(x.compareTo(new BigInteger("1"))==0||x.compareTo(new BigInteger("0"))==0)
        return new BigInteger("1");
    else return x.multiply(factorial(x.subtract(new BigInteger("1")))); 
} 
```

这里大整数的范围是

```
-2^Integer.MAX_VALUE (exclusive) to +2^Integer.MAX_VALUE,
where Integer.MAX_VALUE=2^31. 
```

然而，上面给出的阶乘方法的范围可以通过使用 unsigned BigInteger 扩展到两倍。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2016-01-28T21:49:58.750

我们只有一行来计算它：

```
Long factorialNumber = LongStream.rangeClosed(2, N).reduce(1, Math::multiplyExact); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2016-04-19T17:06:59.553

一个相当简单的方法

```
 for ( int i = 1; i < n ; i++ )
    {
            answer = answer * i;
    } 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2016-11-17T18:47:53.683

```
 /**
import java liberary class

*/
import java.util.Scanner;

/* class to find factorial of a number
*/

public class factorial
{
public static void main(String[] args)
{

// scanner method for read keayboard values

    Scanner factor= new Scanner(System.in);

    int n;
    double total = 1;
    double sum= 1;

    System.out.println("\nPlease enter an integer: ");
    n = factor.nextInt();

// evaluvate the integer is greater than zero and calculate factorial

if(n==0)

{
    System.out.println(" Factorial of 0 is 1");
}
else if (n>0)
{
    System.out.println("\nThe factorial of " + n + " is " );

    System.out.print(n);

    for(int i=1;i<n;i++)
    {
        do // do while loop for display each integer in the factorial
              {
                System.out.print("*"+(n-i) );
              }

        while ( n == 1);

      total = total * i;

    }

// calculate factorial
sum= total * n;

// display sum of factorial

    System.out.println("\n\nThe "+ n +" Factorial is : "+" "+ sum);
}

// display invalid entry, if enter a value less than zero

else

{
    System.out.println("\nInvalid entry!!");

}System.exit(0);
}
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-03-12T14:06:09.193

```
public static int fact(int i){
    if(i==0)
       return 0;
    if(i>1){
       i = i * fact(--i);
    }

   return i;
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-05-24T11:09:00.013

我们需要迭代地实现。如果我们递归实现，如果输入变得非常大（即20亿）就会导致StackOverflow。当阶乘数变得大于给定类型的最大数（即 int 为 20 亿）时，我们需要使用诸如 BigInteger 之类的未绑定大小数来避免算术溢出。在溢出之前，您可以将 int 用于最多 14 个阶乘，使用 long 用于最多 20 个阶乘。

```
public BigInteger getFactorialIteratively(BigInteger input) {
    if (input.compareTo(BigInteger.ZERO) <= 0) {
        throw new IllegalArgumentException("zero or negatives are not allowed");
    }

    BigInteger result = BigInteger.ONE;
    for (BigInteger i = BigInteger.ONE; i.compareTo(input) <= 0; i = i.add(BigInteger.ONE)) {
        result = result.multiply(i);
    }
    return result;
} 
```

如果不能使用 BigInteger，请添加错误检查。

```
public long getFactorialIteratively(long input) {
    if (input <= 0) {
        throw new IllegalArgumentException("zero or negatives are not allowed");
    } else if (input == 1) {
        return 1;
    }

    long prev = 1;
    long result = 0;
    for (long i = 2; i <= input; i++) {
        result = prev * i;
        if (result / prev != i) { // check if result holds the definition of factorial
            // arithmatic overflow, error out
            throw new RuntimeException("value "+i+" is too big to calculate a factorial, prev:"+prev+", current:"+result);
        }
        prev = result;
    }
    return result;
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-04-03T08:46:25.977

```
public int factorial(int num) {
        if (num == 1) return 1;
        return num * factorial(num - 1);
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2017-07-28T13:26:50.557

while 循环（用于小数字）

```
public class factorial {

public static void main(String[] args) {
    int counter=1, sum=1;

    while (counter<=10) {
        sum=sum*counter;
        counter++;
   }

    System.out.println("Factorial of 10 is " +sum);
   }
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2017-10-27T21:50:39.990

我从 EDX 得到这个，用它！它称为递归

```
 public static int factorial(int n) {
    if (n == 1) {
        return 1;
    } else {
        return n * factorial(n-1);
    }
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2018-02-21T06:35:19.553

递归：

```
public static int factorial(int n)
{
    if(n == 1)
    {
        return 1;
    }               
    return n * factorial(n-1);
} 
```

使用 while 循环：

```
public static int factorial1(int n)
{
    int fact=1;
    while(n>=1)
    {
        fact=fact*n;
        n--;
    }
    return fact;
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2020-07-18T08:25:10.497

使用递归是最简单的方法。如果我们想找到 N 的阶乘，我们必须考虑 N = 1 和 N>1 的两种情况，因为在阶乘中我们不断将 N,N-1, N-2,,,,, 相乘直到 1。如果我们转到N = 0，我们将得到0作为答案。为了阻止阶乘达到零，使用以下递归方法。在阶乘函数内部，当 N>1 时，返回值与另一个阶乘函数的初始化相乘。这将使代码递归调用 factorial() 直到它到达 N=1。对于 N=1 的情况，它返回 N(=1) 本身，并且所有先前建立的乘返回 N s 的结果都与 N 相乘=1。从而给出阶乘结果。

```
static int factorial(int N) {
    if(N > 1) { 
    return n * factorial(N - 1);
    }
    // Base Case N = 1
    else { 
    return N;
    } 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-09-28T17:51:57.940

```
 public static long factorial(int number) {
    if (number < 0) {
        throw new ArithmeticException(number + " is negative");
    }
    long fact = 1;
    for (int i = 1; i <= number; ++i) {
        fact *= i;
    }
    return fact;
} 
```

使用递归。

```
 public static long factorial(int number) {
    if (number < 0) {
        throw new ArithmeticException(number + " is negative");
    }
    return number == 0 || number == 1 ? 1 : number * factorial(number - 1);
} 
```

[来源](https://github.com/examplehub/Java/blob/master/src/main/java/com/examplehub/maths/Factorial.java)

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-04-08T20:44:37.827

使用 Java 9+，您可以使用此解决方案。这使用 BigInteger，非常适合保存大数。

```
...    
import java.math.BigInteger;
import java.util.stream.Stream;
...

String getFactorial(int n) {
    return Stream.iterate(BigInteger.ONE, i -> i.add(BigInteger.ONE)).parallel() 
            .limit(n).reduce(BigInteger.ONE, BigInteger::multiply).toString();
} 
```

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2019-07-12T11:53:35.537

**使用动态编程是有效的**

如果你想用它来一次又一次地计算（比如缓存）

Java代码：

```
int fact[]=new int[n+1]; //n is the required number you want to find factorial for.
int factorial(int num)
 {
    if(num==0){
     fact[num]=1;
     return fact[num];
       }
     else
       fact[num]=(num)*factorial(num-1);

     return fact[num];
 } 
```

# c# - 将带有按钮的用户控件列表添加到 PlaceHolder - 没有事件？

> ID：891053
> 
> 赞同：0
> 
> 时间：2009-05-21T01:40:11.223
> 
> 标签：c#, asp.net, user-controls, event-handling, loadcontrol

我想使用包含多个控件元素的“复杂”用户控件。这是我将在列表中重用的同一个控件，并且我已经有一个 PlaceHolder 控件。

我可以使用**LoadControl(path to .ascx)**添加控件- 没问题。

我也可以通过我的自定义属性获取/设置访问嵌入的标签，因此我可以完美地初始化每个控件。

但是在添加 LinkBut​​tons 时，我遇到了麻烦/问题。

当我单击按钮时，我确实得到了呈现控件的页面的“提交”；但是控件自己的按钮事件似乎没有触发（或者至少父页面上的 PageLoad 似乎首先触发？） - 我无法弄清楚我的事件去哪里或在哪里寻找名称/ID或参数按钮。

怎么会或我在这里做错了什么？

我现在通过在 URL 中使用带有 ID 的“硬编码 A HREF”的标签制作了一个“假按钮”，但我想了解我需要捕获什么事件以及在哪里或如何初始化按钮，因为我希望能够为这些用户控件使用“默认 ASP.NET”控件（希望没有太多的拼凑编码）......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T02:14:54.837

事件“丢失”的唯一原因是您的控件没有以 ASP.Net 可以在回发后将事件与控件相关联的方式重新创建。它通过使用 ID 属性来实现。

换句话说，你做错了三件事之一：

1）您在回发后的 Init 中的创建阶段以不同方式分配链接按钮的 ID

2）您正在使用代码动态创建链接按钮，但您是在页面生命周期的 Init 阶段之后进行的，因此您的控件不参与 ViewState。

3) 您在每次回发时重新绑定包含链接按钮的父控件的数据源。用于`if (!IsPostBack)`防止每次重新绑定。

不幸的是，在没有看到您的代码的情况下，我无法提供比这更具体的内容。

# c++ - 为什么静态链接时需要 *.obj 文件？

> ID：891054
> 
> 赞同：5
> 
> 时间：2009-05-21T01:40:22.143
> 
> 标签：c++, visual-studio-2008, static-linking

我不确定这是为什么。我正在跨多个项目分发一个静态 *.lib，但这个静态库会生成许多 *.obj 文件。似乎我还需要使用 *.lib 分发那些 *.obj 文件。否则，我会收到此错误：

```
1>LINK : fatal error LNK1181: cannot open input file 'nsglCore.obj' 
```

为什么是这样？有没有办法在 *.lib 的 *.obj 文件中包含数据？也许编译器中的开关？

这是我对静态库的配置：

**C/C++**

```
/Od /GT /D "WIN32" /D "NDEBUG" /D "_LIB" /D "_WINDOWS" /D "_UNICODE" /D "UNICODE" /Gm /EHsc /MD /Yu"stdafx.hpp" /Fp"e:\Development\Projects\nsGameLib\Source\Core\Intermediate\nsglCore-Win32-Release.pch" /Fo"e:\Development\Projects\nsGameLib\Source\Core\Intermediate\\" /Fd"e:\Development\Projects\nsGameLib\Source\Core\Intermediate\vc90-Release.pdb" /W3 /nologo /c /Zi /TP /errorReport:prompt 
```

**图书管理员**

```
/OUT:"e:\Development\Projects\nsGameLib\Source\Core\Output\nsglCore-Win32-Release.lib" /NOLOGO /LTCG 
```

这是我使用静态库的项目配置：

**C/C++**

```
/O2 /Oi /I "E:\Development\Projects\nsGameLib\Samples\\DummyEngine\\" /D "WIN32" /D "NDEBUG" /D "_WINDOWS" /D "_UNICODE" /D "UNICODE" /FD /EHsc /MD /Gy /Fo"e:\Development\Projects\nsGameLib\Samples\OnlyCore\Intermediate\\" /Fd"e:\Development\Projects\nsGameLib\Samples\OnlyCore\Intermediate\vc90-Release.pdb" /W3 /nologo /c /Zi /TP /errorReport:prompt 
```

**链接器**

```
/OUT:"e:\Development\Projects\nsGameLib\Samples\OnlyCore\Output\SampleOnlyCore-Win32-Release.exe" /INCREMENTAL:NO /NOLOGO /LIBPATH:"E:\Development\Projects\nsGameLib\Samples\..\Deployment\Libraries" /MANIFEST /MANIFESTFILE:"e:\Development\Projects\nsGameLib\Samples\OnlyCore\Intermediate\SampleOnlyCore-Win32-Release.exe.intermediate.manifest" /MANIFESTUAC:"level='asInvoker' uiAccess='false'" /DEBUG /PDB:"e:\Development\Projects\nsGameLib\Samples\OnlyCore\Intermediate\SampleOnlyCore-Win32-Release.pdb" /SUBSYSTEM:WINDOWS /OPT:REF /OPT:ICF /LTCG /DYNAMICBASE /NXCOMPAT /MACHINE:X86 /ERRORREPORT:PROMPT nsglCore  kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T03:49:05.153

我相信您的链接器行不正确。图书馆应该有一个`.lib`后缀。所以`nsglCore`应该是`nsglCore-Win32-Release.lib`或者可能`nsglCore-$(TargetPlatform)-$(ConfigurationName).lib`是正确的宏扩展是什么。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-21T02:12:10.037

通常，静态库*不*生成目标文件。您所做的是创建目标文件并将它们放在库中，然后链接器将在这些库中搜索目标文件。

我将从 UNIXy 命令行的角度进行解释，因为这更容易理解（我不知道 VS 在做基本工作之前做了什么）。

用于创建可执行文件的示例命令行是：

```
gcc -c -o prog.o prog.c
gcc -o prog prog.o -L/libdir -lstdc 
```

第一行只是从您的文件中创建一个目标`C`文件。第二行通过将目标文件拉到一起来创建可执行文件，通常遵循如下规则集：

*   `.o`明确列出的所有文件都是链接的。
*   完成后，您可以在库中搜索满足引用但未定义符号的其他对象。

例如，假设您`prog.c`包含该行`printf("hello\n");`。这将导致您的文件包含尚未满足`prog.o`的引用。`printf`

链接器将搜索您指定的库，直到满足该引用。在这种情况下，它将搜索以下形式的所有文件`/libdir/libstdc.ext`：

*   `/libdir`来自您的`-L`选择（在其中搜索库的路径）。
*   `/lib`是一个常数。
*   `stdc`是要搜索的库的名称（从`-l`）。
*   `ext`是一个或多个扩展名（`.a, .so, .sl`等）。

找到符号后，将链接该目标文件以对其进行解析。这可能会导致出现*更多*不满意的符号，例如`/libdir/libstdc.a(printf.o)`引用`/libdir/libstdc.a(putch.o)`.

您的特定问题可能是由于您尝试直接链接目标文件而不是搜索库而引起的。VS 应该有项目选项来指定目标文件、库搜索路径*和*库名称（我不确定最新版本的这一点，但我知道早期版本的 MSVC 确实如此）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-21T02:11:19.537

啊……Vis​​ual Studio 对你来说太聪明了

转到包含lib的项目，右键单击属性

转到配置属性 | 链接器

靠近底部：使用库依赖输入 - 设置为否

这是直接获取 .obj 文件而不是 .lib 文件的 Visual Studio 选项。我想这是为了避免链接步骤，从而加快编译速度。

通常，您应该将创建 lib 文件的项目设置为使用它的项目的依赖项（在该属性窗口的公共属性下）。然后打开链接库依赖项。这在大多数情况下都很有效。

# php - Google Docs 和 Zoho Writer 等网站使用什么来生成 MS Office 文档

> ID：891055
> 
> 赞同：6
> 
> 时间：2009-05-21T01:41:05.713
> 
> 标签：php, ms-office, documentation-generation

我意识到这可能只是猜测，但我会感谢任何对此有所了解的人的评论。诸如 MS Word COM 插件、OO 桥或自定义实现之类的东西。

我想知道的原因是我想为 php web 应用程序提供基本的在线文档编辑（真的很基本，基本上只是富文本）。我想我会将标记存储为 html 格式，然后转换为 rtf/doc 等以方便用户使用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T23:57:08.547

Apache POI 项目（用 Java 编写）为 MS Office 套件中的许多文件类型提供了一个接口。

您可以使用 PHP/Java 桥从 PHP 中运行 Java 代码。

我曾经将它用于必须在 Web 应用程序中索引 MS Word 文档的应用程序。我记得设置一切都很麻烦，但它运行得非常好并且相当快。（不幸的是，代码是用 PHP4 编写的，我不拥有它，所以我无法在这里为您提供任何片段。）

PS 因为我是新用户，所以我无法发布链接，所以谷歌搜索“Apache POI”和“PHP/Java 桥”以访问相应项目的主页。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-22T23:19:18.127

一种流行的方法是生成文件扩展名为 .doc 的 RTF。它适用于 Word 和其他编辑器，用户仍然很高兴它是“DOC 文件”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T01:45:49.607

[这门课](http://www.phpclasses.org/browse/package/388.html)可能会对你有所帮助。我从未使用过它，但这里有一些链接：

*   [在 PHP 中使用 COM 从 Word 文档中读取](http://drewd.com/2007/01/25/reading-from-a-word-document-with-com-in-php)
*   [创建一个word文档](http://www.programmershelp.co.uk/phpcreateword.php)
*   [在 Linux 中使用 PHP 创建 Word 文档](https://stackoverflow.com/questions/124959/create-word-document-using-php-in-linux)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T02:21:32.607

他们可能已经编写了自己的，可能从[wvWare](http://wvware.sourceforge.net/)或类似的东西开始。我注意到 Linux 上的 Google 桌面似乎使用 wvWare 来解析 MS Word 文档。

Word 文件格式的文档是可用的，但通读它会让您意识到这不是一件容易的事。

自动化 Word 或 OpenOffice 将是最简单的，但使用 Word 可能会出现许可问题，并且在 Web 服务器上使用它们中的任何一个都可能存在并发问题。

# cocoa - 在 Mac OS X 10.5 中用于网络流式传输、播放和查找音频文件的用户友好方法

> ID：891057
> 
> 赞同：2
> 
> 时间：2009-05-21T01:44:23.057
> 
> 标签：cocoa, macos, audio, networking, streaming

请建议结合服务器和客户端技术、工具和框架来实施满足以下要求的解决方案？

*   网络中的文件服务器拥有庞大的*mp3/aac/aiff/wav*音乐文件 库*   桌面 cocoa 应用程序使用 URL 访问音频文件：*rtmp、http、rtsp+rtp、ftp* — 如何做出选择？*   音频内容应该在不下载整个文件的情况下通过**搜索（这很重要）进行****流式传输**和播放： *QuckTime、AudioQueue、AudioFile、AudioStream、CFHTTP，所有这些？*——如何开发客户？ ***经过扎实的研究，我最终得到了无数的选择和文章。但看起来其中一半已经过时（2001-2005），另一半是关于 Mac OS X 和 iPhone OS 的通用代码（纯 C）。

    然而，这里的主要目标是为 Mac OS 10.5 编写一个桌面音乐播放器。
    我不敢相信所有这些原始的 C 编码都是必需的。
    没有包装？没有方便的图书馆？没有组件？

    PS Research 产生了以下组合：用于提示的[qt_tools](http://omino.com/sw/qt_tools/) +用于 RTSP 流媒体的[DSS](http://dss.macosforge.org/) +用于播放的[QTMovie +](http://developer.apple.com/documentation/QuickTime/Reference/QTKitFramework/Classes/QTMovie_Class/Reference/Reference.html) [setCurrentTime：](http://developer.apple.com/documentation/QuickTime/Reference/QTKitFramework/Classes/QTMovie_Class/Reference/Reference.html#//apple_ref/doc/uid/20002391-DontLinkElementID_3)用于搜索。此选择需要双倍空间来存储每个音乐文件的提示 .MOV 版本，但无论如何都可以使用。***  **** * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T01:52:44.257

我不确定，但我相信您可以使用`[QTMovie movieWithURL:url error:err]`从 URL 流式传输电影，然后将其传递给 QTMovieView 对象。QuickTime 将音频视为电影，因此它可以工作。或者它可能会尝试加载整个文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T02:23:05.800

查看[QuickTime 流媒体指南](http://developer.apple.com/documentation/QuickTime/RM/Streaming/StreamingClient/A-Intro/1Introduction.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T12:26:40.743

您是否将[VLC](http://www.videolan.org/vlc/streaming.html)视为流媒体解决方案？

# svn - Windows 上的 SVN

> ID：891063
> 
> 赞同：1
> 
> 时间：2009-05-21T01:47:07.933
> 
> 标签：svn, git, version-control

如果这还不够“那么”，请提前抱歉——

我有一个技术写作朋友正在研究她的 word 和 visio 文档的版本控制。我建议她检查 TortioseSVN 或任何 M$-flavor 的 Git 用于本地版本控制。但是，她担心如果文件损坏会发生什么……我显然不使用 Windows，并且在我的 OS X 或 Linux 机器上从未遇到过文件损坏的问题。有没有人遇到过使用 VC 和文件损坏的问题？

编辑：我应该澄清......我并不是说 VC 会导致损坏，只是想知道 VC 应用程序如何处理文件损坏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T01:54:38.793

我不确定我是否在关注你的担忧。

如果文件在签出和签入之间损坏，您显然会在差异中看到它，并且您仍然会有完整的历史记录。

怀疑您的文件是否已损坏不是 SVN 的工作 - 就 SVN 而言，损坏的定义是什么？

虽然可能存在特定于 Windows 的错误，但根据我的经验，它们都没有损坏文件，至少我从来没有损坏过文件。我经常遇到提交后问题，我必须通过 svn cleanup 或删除并重新签出目录来解决这些问题，但同样，它们都没有发生变异。

所有软件都有错误——问题是它们是否是未修补的严重错误。SVN 质量控制相当好，但你永远不知道。

顺便说一句，我强烈推荐 SmartSVN 用于客户端。它比 Tortoise 好得多，虽然速度有点慢，而且是用 Java 编写的。没有什么可以让我更好地控制我的存储库 - TortoiseSVN 甚至无法比较。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T01:58:09.503

我已经使用[SVN](http://subversion.tigris.org)几年了，从来没有文件损坏过。如果担心损坏，只需为存储库制定定期备份计划。也看看这个博客[http://newgeeks.blogspot.com/2006/08/word-document-management-using-svn.html](http://newgeeks.blogspot.com/2006/08/word-document-management-using-svn.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T02:05:29.330

我有颠覆腐败的回购协议。但是，我应该指出，这是 a) 在更早的版本中，并且 b) 我在 repos 上做了一些相当，呃，“有趣”的管理事情（试图将 repos 的一部分提取到新的 repos 中），所以这很可能是我的错。

也就是说，我认为它非常安全。我在我的回购中提交了很多重要的事情。

不过，要向她指出的一件事是，如果她担心，她也可以随时进行多次结账。如果她有第二个结账，她每天只更新一次，在确认她的主要结账没问题之后，如果真正的灾难发生并破坏了 repo 和她的工作结账，她在另一个结账中得到了一份很好的文档副本。

也就是说，出于多种原因，回购的每日备份是一件好事。

我还想指出，经过一些培训和支持，非技术人员通常不会遇到 Subversion 问题。我教过 Excel 遇到问题的人使用 Subversion，几周后他们很高兴自己使用它。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-05-21T01:57:32.937

使用 SVN 并定期提交是减轻文件损坏的好方法 - 如果您的文件损坏（虽然，我不知道如何），只需回滚到最后一个未损坏的修订版。

SVN 不能很好地处理二进制文件（如 word 文档），因为它保存了一个全新的副本而不是一个增量，但它不像你在谈论大量信息或任何东西，所以这很好。

SVN 有一点学习曲线，所以你可能不得不为她设置它。

# c++ - 为什么这种返回类型不起作用？(C++)

> ID：891066
> 
> 赞同：1
> 
> 时间：2009-05-21T01:48:19.833
> 
> 标签：c++, subclass, return-type

当我尝试使用我的迭代器类时

```
template<class T>
class list
{
public:
class iterator;
};

template<class T>
class list<T>::iterator
{
//stuff
}; 
```

作为运算符重载中的返回类型，

```
template<class T>
class list<T>::iterator
{
public:
iterator& operator++();
protected:
list* lstptr;
};

template<class T>
iterator& list<T>::iterator::operator++()
{
(this->lstptr)->current = ((this->lstptr)->current)->next;
return this;
} 
```

我收到这些错误：

```
s:\jeffrey_\my_freeware_games\o\resources\container class\container(spec- o)\container_def.h(213) : error C2143: syntax error : missing ';' before '&'
s:\jeffrey_\my_freeware_games\o\resources\container class\container(spec- o)\container_def.h(213) : error C4430: missing type specifier - int assumed. Note: C++ does not support default-int
s:\jeffrey_\my_freeware_games\o\resources\container class\container(spec- o)\container_def.h(213) : error C2065: 'T' : undeclared identifier
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(235) : error C2039: 'Yes' : is not a member of 'vc_attributes'
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(235) : error C2065: 'Yes' : undeclared identifier
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(236) : error C2039: 'No' : is not a member of 'vc_attributes'
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(236) : error C2065: 'No' : undeclared identifier
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(237) : error C2039: 'Maybe' : is not a member of 'vc_attributes'
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(237) : error C2065: 'Maybe' : undeclared identifier
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(240) : error C2039: 'NoAccess' : is not a member of 'vc_attributes'
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(240) : error C2065: 'NoAccess' : undeclared identifier
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(241) : error C2039: 'Read' : is not a member of 'vc_attributes'
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(241) : error C2065: 'Read' : undeclared identifier
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(242) : error C2039: 'Write' : is not a member of 'vc_attributes'
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(242) : error C2065: 'Write' : undeclared identifier
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(243) : error C2039: 'ReadWrite' : is not a member of 'vc_attributes'
c:\program files\microsoft visual studio 9.0\vc\include\codeanalysis\sourceannotations.h(243) : error C2065: 'ReadWrite' : undeclared identifier
c:\program files\microsoft visual studio 9.0\vc\include\crtdefs.h(582) : error C2146: syntax error : missing ';' before identifier 'time_t'
c:\program files\microsoft visual studio 9.0\vc\include\crtdefs.h(2047) : error C2143: syntax error : missing ';' before 'identifier'
c:\program files\microsoft visual studio 9.0\vc\include\crtdefs.h(2047) : warning C4091: 'typedef ' : ignored on left of 'localeinfo_struct' when no variable is declared
c:\program files\microsoft visual studio 9.0\vc\include\crtdefs.h(2047) : fatal error C1075: end of file found before the left brace '{' at 'c:\program files\microsoft visual studio 9.0\vc\include\crtdefs.h(174)' was matched 
```

注意：container_def.h 是我的列表和迭代器类的头文件，我不知道什么是 souceannotations 或 crtdefs。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T01:53:31.820

`iterator`那时还不知道。你需要告诉它它在`list<T>`课堂上：

```
template<class T>
typename list<T>::iterator& list<T>::iterator::operator++() {
    (this->lstptr)->current = ((this->lstptr)->current)->next;
    return *this; // *this here, since this is a pointer only
} 
```

请注意，这`typename`是必需的，因为`list<T>::iterator`它是一个以模板特化为前缀的类型，并且您需要告诉编译器这一点 - 尽管 Visual C++ 可能会接受没有放在`typename`它前面的代码。省略`typename`，编译器应该假定它不是一个类型，并且应该产生相同的错误消息。

您可以通过将代码直接放入类中来保护自己的麻烦：

```
template<class T>
class list<T>::iterator
{
public:
iterator& operator++() {
    (this->lstptr)->current = ((this->lstptr)->current)->next;
    return *this; // *this here, since this is a pointer only
}
protected:
    list* lstptr;
}; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T08:47:59.733

litb 已经完全[回答](https://stackoverflow.com/questions/891066/why-doesnt-this-return-type-work-c/891076#891076)了你的问题。我认为值得强调的是，为了使 C++ 更易于使用，C++ 委员会为函数声明添加了新语法。结果是您可以如下定义您的函数（[n2541](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2541.htm)），而无需额外的限定：

```
template<class T>
auto list<T>::iterator::operator++()->iterator& 
{
  // ...
} 
```

根据支持的特性[列表](http://gcc.gnu.org/projects/cxx0x.html)，GCC 4.4 已经有了这个特性。

# c++ - 什么会导致父窗口不知道它有一个子对话框？

> ID：891069
> 
> 赞同：0
> 
> 时间：2009-05-21T01:50:30.827
> 
> 标签：c++, windows, windows-mobile

在我的原生 Windows 移动应用程序中，我有一个创建对话框的窗口。可以说我的窗口句柄是`hMainWnd`.

我使用并作为对话框的父[`DialogBoxParam()`](http://msdn.microsoft.com/en-us/library/aa932921.aspx)级传入来创建对话框：`hMainWnd`

```
DialogBoxParam(_,_,hMainWnd,_,_); 
```

假设对话框的句柄是`hDlgWnd`. 在对话框中，按预期[`GetParent()`](http://msdn.microsoft.com/en-us/library/aa921830.aspx)返回：`hMainWnd`

```
//We're inside the dialog created above
HWND hParent = GetParent(hDlgWnd); //hParent == hMainWnd 
```

奇怪的是，调用[`GetWindow()`](http://msdn.microsoft.com/en-us/library/aa929220.aspx)来查找`hMainWnd`返回的孩子`NULL`，表示它没有孩子。我希望函数返回`hDlgWnd`

```
//We're inside the main window    
HWND hChild = GetWindow(hMainWnd, GW_CHILD); //hChild == NULL 
```

当父母不认识自己的孩子时，孩子怎么能认识父母呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T02:13:29.347

`GetWindow`with`GW_CHILD`显然不检索后代窗口，只检索子窗口。来自[MSDN](http://msdn.microsoft.com/en-us/library/ms633515.aspx)：

> 如果指定的窗口是父窗口，则检索到的句柄标识Z顺序顶部的子窗口；否则，检索到的句柄为 NULL。该函数仅检查指定窗口的子窗口。它不检查后代窗口

孩子和后代有什么区别？我不知道，但[`EnumChildWindows`](http://msdn.microsoft.com/en-us/library/ms633494.aspx)可能会给你你需要的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-09-16T18:17:32.417

Window 要么是子窗口（具有 WS_CHILD 样式），要么是顶级窗口。

顶级窗口没有父窗口，但它们可能有一个所有者窗口。子窗口有父窗口，但没有所有者。

GetParent() 函数返回子窗口的父级或顶级窗口的所有者。因此，它被错误命名——它应该被称为 GetParentOrOwner()。

所以发生的事情是，您从 GetParent() 获得了顶级窗口的所有者，但由于它实际上不是父窗口，因此 hDlgWnd 不是 hMainWnd 的子窗口。

# java - 具有类类型的 Java 反射 getDeclaredMethod()

> ID：891071
> 
> 赞同：22
> 
> 时间：2009-05-21T01:51:28.050
> 
> 标签：java, reflection

我正在尝试了解 Java 反射，并且在使用非整数设置器方法时遇到了困难。

例如，如何解决下面的“getDeclaredMethod()”调用？

```
import java.lang.reflect.*;

class Target {
    String value;

    public Target() { this.value = new String("."); }
    public void setValue(String value) { this.value = value; }
    public String getValue() { return this.value; }
}

class ReflectionTest {
    public static void main(String args[]) {
        try {
            Class myTarget = Class.forName("Target");

            Method myMethod;
            myMethod = myTarget.getDeclaredMethod("getValue");  // Works!
            System.out.println("Method Name: " + myMethod.toString());

            Class params[] = new Class[1];
            //params[0] = String.TYPE; // ?? What is the appropriate Class TYPE?
            myMethod = myTarget.getDeclaredMethod("setValue", params); // ? Help ?
            System.out.println("Method Name: " + myMethod.toString());

        } catch (Exception e) {
            System.out.println("ERROR");
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-21T01:56:45.713

```
params[0] = String.class; 
```

使用`class`on`String`将返回`Class<?>`与类关联的`String`。

# sql-server-2005 - SQL 2005 express 与 2008 express 兼容性

> ID：891077
> 
> 赞同：0
> 
> 时间：2009-05-21T01:53:51.943
> 
> 标签：sql-server-2005, sql-server-2008, windows-vista, installation, visual-studio-2008-sp1

我安装了没有 SQL 2005 的 VS 2008，然后我安装了 SQL 2008，然后我需要 2005 express，所以我重新安装了 VS 检查 SQL 功能。安装顺利，但是我仍然无法从 VS 打开 mdf 文件。我认为没有安装 2005v 实例。

当我在 VS 中 dbl-click 一个 mdf 文件时，我收到以下消息：连接到 SQL Server 文件 (*.mdf) 需要 SQL Server Express 2005 才能正常运行。请验证组件的安装或从 URL 下载：http:go.microsoft.com/fwlink/?linkID=49251。

**更新**

我试着附上它，它不起作用。当我尝试将其附加到 SQL 2008 时它不起作用，当我尝试将其附加到 VS 中的 SQL 时，我收到以下错误消息：建立与 SQL Server 的连接时发生网络相关或实例特定错误. 服务器未找到或无法访问。验证实例名称是否正确以及 SQL Server 是否配置为允许远程连接。（提供者：SQL 网络接口，错误：26 - 错误定位服务器/指定的实例） 我怀疑 SQL 2005 根本没有任何实例。我打开 SS 管理器并没有看到任何已安装的实例。

我不知道如何安装实例，或者如果有办法用2008打开，请告诉我。

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-21T03:20:53.313

您不只是在 Visual Studio 中“打开”一个 mdf 文件——您需要将该文件“附加”到您的 SQL Server 实例，然后通过从您的 VS 应用程序创建一个 SQLConnection (System.Data.SQLConnection) 来访问它。有关附加数据库的更多信息，请参见[此处](http://msdn.microsoft.com/en-us/library/ms176061.aspx)（请注意 FOR ATTACH 选项），[这里是](http://www.csharp-station.com/Tutorials/AdoDotNet/Lesson02.aspx)关于使用 SQLConnection 访问 SQL Server 数据的一个很好的介绍。

哦，如果你碰巧看到任何关于“用户实例”的东西，就假装你没有。它应该使自动附加数据库变得容易（事实上，附加数据库并不是那么难）。Microsoft 警告说，该功能将在 SQL Server 的后续版本中停止，因此您最好只学习“正确”的方法来做到这一点。

# privacy - 删除所有交换文件？

> ID：891084
> 
> 赞同：0
> 
> 时间：2009-05-21T01:57:27.490
> 
> 标签：privacy, swapfile

许多程序创建了大量的交换文件。他们惹恼了我，因为其中一些包含敏感信息。我应该如何处理它们？这个命令是个好主意吗：

```
find . -iname "*swp*" -exec rm '{}' \; 
```

好的程序应该如何处理它们的交换文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-16T04:10:17.463

如果文件因为包含敏感信息而“惹恼”您，那么您应该知道，简单地使用`rm`命令删除文件并不会真正擦除硬盘驱动器中的数据。

我不确定您的交换文件在哪里或创建它们的应用程序。通常，交换文件由操作系统在专门指定的目录中创建。例如，在我的 Mac 上：

```
$ ls /private/var/vm/
-rw------T  1 root  wheel  4294967296 Mar 15 19:41 sleepimage
-rw-------  1 root  wheel    67108864 Mar 15 21:10 swapfile0
$ 
```

如果要擦除交换文件中的信息，则确实需要覆盖它们。您可以使用 "dd" 执行此操作，但最好使用[srm](http://srm.sourceforge.net/)执行此操作。不幸的是，`srm`默认情况下覆盖每个文件 7 次，这比必要的要多 6 倍。（将它与 -s 选项一起使用以获得单个覆盖）。

因此，如果您想使用您的查找，请使用：

```
find . -iname "*swp*" -exec srm -s {} \; 
```

有道理？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T01:59:51.433

取决于它从哪里运行，但应该没问题，尽管我会将匹配修改为“*.swp”或“*swp”以获得更完美的匹配

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T01:59:52.993

如果它们以您的用户 ID 运行，则创建的文件可能无法被其他任何人读取。如果是，那么您将面临更深层次的安全问题。

# .net - iPhone / .NET WCF 互操作性

> ID：891090
> 
> 赞同：12
> 
> 时间：2009-05-21T02:00:11.120
> 
> 标签：.net, iphone, wcf

我正在构建一个 .NET “Web 服务”和一个将使用这些服务的 iPhone 应用程序。我很好奇是否有任何最佳实践来构建协议以在两者之间交换数据。对于 iPhone 应用程序，基于 SOAP 的 Web 服务对我来说太重了。也许是 REST、JSON、POX？当然，应用程序的细节在某种程度上决定了协议，但我很好奇其他人做了什么。

理想情况下，如果可能的话，我想利用 WCF（同样，可能是它的 REST、JSON 或 POX 支持），以便我可以保留我的选项，以便将来为其他客户端应用程序创建其他绑定。

任何建议将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-21T16:15:27.973

我们目前正在为我们的一个应用程序使用基于 WCF 的 REST/POX 服务。我建议坚持使用 REST/POX，因为 iPhone 上没有 Web 服务（我知道）的类生成器，就像您通过添加服务引用进入 .NET 世界一样。这将使解析变得更加简单，因为您不必担心所有额外的垃圾肥皂会添加到消息中。

基本上看一下 NSUrlConnection 和 NSXmlParser 并阅读“键值编码”（使 xml 解析更容易），您将拥有用最少的代码完成它所需的一切。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T18:24:25.717

我知道[用于 OS X 的 RemObjects SDK](http://www.remobjectssdk.com/osx.aspx)

我希望它对你有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-02T19:05:28.240

查看[这篇博文](http://avaimobile.com/blog/bid/21466/Creating-an-iPhone-friendly-web-service-in-NET-with-WCF)，快速了解如何为您的 iPhone 应用程序创建 WCF 服务。

# iphone - 如何使用 NSFetchedResultsController 重新启动查询

> ID：891091
> 
> 赞同：0
> 
> 时间：2009-05-21T02:00:29.967
> 
> 标签：iphone, cocoa-touch, core-data

我正在完成核心数据教程，它建议尝试转换为使用 NSFetchedResultsController。所以我得到了它，以便我可以查询现有数据，但是当我在开头添加一行时，tableView:cellForRowAtIndexPath 调用 NSFetchedResultsController.objectAtIndexPath，但这仍然返回旧的第零个对象而不是新的对象。我需要做些什么来刷新这些数据吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T03:18:01.540

还没有人回答，所以我会添加我的猜测。看起来[这个链接](http://macgeeks.cn/bbs/viewtopic.php?id=6446 "NSFetchedResultsController 更新讨论")可能是相关的。那里的建议是调用这两种方法中的任何一种都应该为您提供更新：

```
-[NSManagedObjectContext processPendingChanges]
-[NSManagedObjectContext save] 
```

也许[文档`NSManagedObjectContext`](http://developer.apple.com/documentation/Cocoa/Reference/CoreDataFramework/Classes/NSManagedObjectContext_Class/Reference/Reference.html)会很有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T11:45:45.147

Naaf 提供的链接中有一条线索。事实证明，在保存之后，我需要再次调用 -[NSFetchedResultsController performFetch]。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-03T03:43:24.273

您是否将视图控制器设置为获取结果控制器的委托并实现了[NSFetchedResultsControllerDelegate 协议](http://developer.apple.com/iphone/library/documentation/CoreData/Reference/NSFetchedResultsControllerDelegate_Protocol/Reference/Reference.html)？如果是这样，您不必再次执行提取，提取结果控制器将调用委托方法以响应更改。

（但请注意，[NSFetchedResultsController 文档](http://developer.apple.com/iphone/library/documentation/CoreData/Reference/NSFetchedResultsController_Class/Reference/Reference.html#//apple_ref/occ/cl/NSFetchedResultsController)中关于实现表视图数据源方法的警告。）

# c++ - C++ 中的“%lt”是什么意思？（不是模数，我知道那是做什么的）

> ID：891097
> 
> 赞同：7
> 
> 时间：2009-05-21T02:03:46.247
> 
> 标签：c++, operators

我曾经看过这行代码：

```
std::cout %lt;%lt; "Hello world!" %lt;%lt; std:: endl; 
```

我想知道是什么`%lt;%lt;`意思。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-05-21T02:06:47.190

你一定在网上看到过。有人上传了这一行：

```
std::cout << "Hello world!" << std::endl; 
```

被翻译成这个输出到html：

```
std::cout &lt;&lt; "Hello world!" &lt;&lt; std::endl; 
```

因为，当然，`&lt;`是 html 实体`<`。

最后，某处决定将与号更改为百分号，可能作为 url 编码方案的一部分。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-05-21T02:05:58.270

看起来像“%lt;” 应该为 http 传输进行转义。像：

```
%lt;%lt; 
```

应该是：

```
<< 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T02:34:02.910

我的第一个想法是，也许您看到了使用[C trigraphs](http://en.wikipedia.org/wiki/Digraph_(computing)#C)的代码。但是，似乎没有`<`or的三元组`>`。

C 三元组及其单字符等效项是：

```
??=  #
??/  \
??'  ^
??(  [
??)  ]
??!  |
??<  {
??>  }
??-  ~ 
```

# language-agnostic - 继承还是条件？

> ID：891104
> 
> 赞同：3
> 
> 时间：2009-05-21T02:06:43.243
> 
> 标签：language-agnostic, oop

我听说有人说好的设计涉及使用继承而不是用 if 块乱扔代码。在什么情况下我们应该使用继承，什么时候条件块就好了？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-21T02:13:44.387

像这样的一种重构称为[Replace Conditional With Polymorphism](http://www.refactoring.com/catalog/replaceConditionalWithPolymorphism.html)。

我们实际上更喜欢[组合而不是继承](http://c2.com/cgi/wiki?CompositionInsteadOfInheritance)，但是……这里讨论的话题实在是太宽泛了，但是[这本书](https://rads.stackoverflow.com/amzn/click/com/0201485672)值得一读，可以帮助你入门。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T02:16:40.043

通常，具有如下代码并不是好的面向对象编程实践：

```
var chioce = PAINT_SCREEN_BLUE

if (choice == PAINT_SCREEN_BLUE):
    paintScreen(blue)
else if (choice == PAINT_SCREEN_RED):
    paintScreen(red)
else if (choice == PAINT_SCREEN_GREEN):
    paintScreen(green) 
```

上面可以利用多态性来调用一些方法，这些方法将执行在具有共同祖先的相关类中抽象出来的操作：

```
interface ScreenPainter:
    function perform()

class BlueScreenPainter implements ScreenPainter:
    function perform():
        paintScreen(blue)

...

// The conditional block can be replaced with the following call:
var choice = PAINT_SCREEN_BLUE

ScreenPainter p = Painters.getPainter(choice)
p.perform() 
```

但是，这种做法绝对不应该适用于*所有*条件，但是，当涉及到长`switch`块或`if-elseif-else`块时，在许多情况下，使用继承将使您的代码更具可扩展性和更健壮。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-21T02:17:05.283

用于根据参数类型决定执行什么逻辑的 if 块（或 switch 块）应替换为多态性。

如果程序中的新特性会导致你添加额外的大小写，或者块使用多态性。

If 语句应该用于自然排序类型比较（<、>、== 等）或检查某些内容是否为空。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T02:25:07.107

这是其中一个问题，虽然其他人可以提供指导，但任何特定情况的最终答案始终是“这取决于情况”。

能够培养在任何特定情况下回答问题的能力的最佳方法是获得经验：即实验。尝试这两种方法，你可以合理地做到这一点。（显然，您不希望在必须更改一千行代码的情况下来回切换。）哪个效果更好？你觉得哪个更好？为什么？

做到这一点，你很快就会达到不再需要一般建议的专业水平，人们开始问你如何知道在任何特定情况下该做什么。（您将无法解释它；这是专业知识的一部分。有关更多详细信息，请参阅[Dreyfus 技能获取模型。](http://en.wikipedia.org/wiki/Dreyfus_model_of_skill_acquisition)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T02:11:02.440

这是我前几天遇到的东西

PHP 是我的首选语言

```
class Cache {

    public function __construct($resource) {

     // if statement to determine from type if it is a file, url or string. instead, change it to accept a string

    }

} 
```

或者......它可以延长

```
class cacheURL extends Cache {

    public function __construct($url) {

        $string = file_get_contents($url);

        parent::__construct($string);
    }

} 
```

粗略的例子，但我希望你能明白我的意思......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T02:11:25.873

在我看来，这两者并不相互排斥。当我有 2 个或更多具有共同功能的类时，我通常使用继承。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-21T02:13:56.210

[何时使用来自 Microsoft 的继承](http://msdn.microsoft.com/en-us/library/27db6csx(VS.80).aspx)

[Java 中的组合与继承](http://www.tiedyedfreaks.org/eric/CompositionVsInheritance.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-21T02:21:58.440

当某些条件正在检查您不断检查的对象的固有内容（例如状态或类型）时，继承会更好。在此示例中，它是数学表达式树的运算符。运算符，如加法，在加号（中[缀符号](http://en.wikipedia.org/wiki/Infix_notation)）之前和之后都有一个表达式，所以我称它们为左右，因为它表示为一棵树。还有一元运算符，例如否定值的连字符，但它只有一个子表达式。

使用继承意味着类型（简化为一元与二进制）被考虑到继承中：

```
class Operator
{
    abstract string ToString();
}
class UnaryOperator : Operator
{
    Expression Expression { get; }
    override string ToString() {...}
}
class BinaryOperator : Operator
{
    Expression LeftExpression { get; }
    Expression RightExpression { get; }
}
class AdditionOperator : BinaryOperator
{
    override string ToString()
    {
        return this.LeftExpression.ToString() + "+" + this.RightExpression.ToString();
    }
} 
```

相对于：

```
class Operator
{
    Expression LeftExpression { get; }
    Expression RightExpression { get; }

    OperatorType Type { get; }

    string ToString()
    {
        switch(this.Type)
        {
            case OperatorType.Addition:
                return this.LeftExpression.ToString() + "+" + this.RightExpression.ToString();
            case OperatorType.Negation:
                return "-" + this.LeftExpression.ToString();
            case ...:
        }
    }
}
enum OperatorType
{
    // Unary operators
    Negation,

    // Binary operators
    Addition,
    Subtraction,
    Multiplication
} 
```

在这里，您的一元运算符没有 Left 和 Right 表达式，只有一个表达式。这意味着您必须引入使用 Left 而 Right 为空的约定。ToString 必须检查 OperatorType；任何其他需要对它是什么运算符采取行动的方法也是如此。

后一种方法最常出现在 XML DOM 实现中，其中 XmlNode 几乎是任何 XML 节点可能包含的所有内容……永远。这会导致一些非常混乱的情况：

*   属性或文本节点如何具有 ChildNodes？
*   当一个文档只能有一个子节点时，它怎么能有子节点呢？（它不必是一个集合）
*   一个文档怎么会有一个 ParentNode？
*   文档如何具有价值？
*   等等。

# asp.net-mvc - 如何在没有 ViewData 的情况下绑定 Html.DropDownList（强类型视图）

> ID：891107
> 
> 赞同：3
> 
> 时间：2009-05-21T02:08:27.657
> 
> 标签：asp.net-mvc, drop-down-menu, strongly-typed-view

我似乎找不到一篇好的博客文章来展示如何在没有魔术字符串“ViewData”的情况下将模型绑定到视图（使用强类型视图是我尝试采用的方法）

有谁知道我需要在下面更改什么才能将其直接绑定到我的模型？

**看法**

```
<%@ Page Language="VB" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage(Of IEnumerable (Of MvcApplication1.Category))" %>
<asp:Content ID="aboutContent" ContentPlaceHolderID="MainContent" runat="server">
    <%=Html.DropDownList("CategoryList")%>
</asp:Content> 
```

**控制器**

```
Function Index() As ActionResult
    Dim list As New List(Of Category)
    list.Add(New Category With {.CategoryID = 1, .CategoryName = "Test1"})
    list.Add(New Category With {.CategoryID = 2, .CategoryName = "Test2"})

    Return View()
End Function 
```

**编辑**

VB中的最终解决方案如下图，感谢大家的大力响应！

**控制器**

```
Function Index() As ActionResult
    Dim id As Integer = 1
    Dim ProductObject As Product = mProductService.GetProductById(id)

    Return View(ProductObject)
End Function 
```

**看法**

```
<%=Html.DropDownList("Category", New SelectList(Model.Categories, "CategoryID", "CategoryName"))%> 
```

**产品类别（带有类别的 IEnumeralbe 属性）**

```
Public Class Product
    Public Sub New()

    End Sub

    Private mProductID As Integer
    Public Property ProductID() As Integer
        Get
            Return mProductID
        End Get
        Set(ByVal value As Integer)
            mProductID = value
        End Set
    End Property

    ReadOnly Property Categories() As IEnumerable(Of Category)
        Get
            Dim list As New List(Of Category)
            list.Add(New Category With {.CategoryID = 1, .CategoryName = "Test1"})
            list.Add(New Category With {.CategoryID = 2, .CategoryName = "Test2"})

            Return list
        End Get
    End Property

End Class 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T02:56:06.780

下拉列表助手接受一个`IEnumerable<SelectListItem>`，而不是一个`IEnumerable<Category>`。通常你所做的就是让你的页面有一个特定的模型。该模型包括从下拉列表中选择的值的属性，而不是集合。您通过 ViewData 提供要从中选择的集合。您可以拥有一个仅包含可供选择的属性和集合的视图模型，但这可能意味着类的激增。关于增殖类或魔术字符串是否是更糟糕的设计存在一些争论。

我对您的代码的看法类似于：

```
<%@ Page Language="VB" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage(Of Foo)" %>
<asp:Content ID="aboutContent" ContentPlaceHolderID="MainContent" runat="server">
    <%=Html.DropDownList("Category", ViewData("CategoryList"))%>
</asp:Content>

Function Index() As ActionResult
    Dim list As New List(Of SelectListItem)
    list.Add(New SelectListItem  With {.Value = 1, .Text = "Test1"})
    list.Add(New SelectListItem With {.Value = 2, .Text = "Test2"})
    ViewData("CategoryList") = list
    Return View()
End Function 
```

其中 Foo 是一个包含 int 类型的属性 Category 的类。

如果你想做一个强类型视图，那么让 Foo 有一个 SelectListItem 类型的属性 Categories，然后更改：

```
<%=Html.DropDownList("Category", ViewData("CategoryList"))%> 
```

到

```
<%=Html.DropDownList("Category", Foo.Categories )%> 
```

和

```
 ViewData("CategoryList") = list
    Return View() 
```

到

```
 Dim foo as New Foo
    foo.Categories = list
    Return View(foo) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T02:17:31.990

您可以为 Html.DropDownList 创建自己的帮助器方法重载，将模型直接映射到 DropDownList 帮助器。

话虽如此，您应该真正问问自己，您的视图应该包含多少领域特定的逻辑。ViewData 有助于将您的模型和域逻辑与您的视图分开。

例子：

我知道这不是“重载”，因为觉得这仍然需要一个名称，所以您需要另一种方法，它只需要一个字符串作为下拉列表的名称，但会自动将模型绑定到控件（假设它是IEnumerable）。这是 HtmlHelper 扩展方法的一个示例。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.Web.Mvc.Html;

namespace MvcApplication3.Helpers
{
    public static class ViewHelpers
    {
        public static string ModelDropDownList(this HtmlHelper htmlHelper, string name)
        {
            var model = htmlHelper.ViewData.Model as IEnumerable<SelectListItem>;
            if(model == null)
                return string.Empty;

            return htmlHelper.DropDownList(name, model);
        }
    }
} 
```

在您看来，这是您如何称呼它的方式

```
<%@ Page Title="" Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage<IEnumerable<SelectListItem>>" %>
<asp:Content ID="Content2" ContentPlaceHolderID="MainContent" runat="server">
    <%= Html.ModelDropDownList("Test") %>
</asp:Content> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T09:28:52.567

如果您想使用强类型方法，有一个 SelectList 对象，您可以将 IEnumerable 传递给该对象。您必须指定 T 的 Text Field 和 Value Field 属性，但这个 SelectList 对象可以直接分配给 Html.DropDownList 助手：

```
c#
IList<Category> categories = new IList<Category>()
    {
        new Category() { ID = 1, Name = "Category 1" },
        new Category { ID = 2, Name = "Category 2" }
    };

SelectList categoryDropDown = new SelectList(categories, "ID", "Name");

ViewData["categoryDropDown"] = categoryDropDown; 
```

然后做：

```
c#
<%=Html.DropDownList("CategoryID", ViewData("categoryDropDown"))%> 
```

这样你就可以从任何地方（服务层，控制器范围的方法）传入一个类别的 IList。

# nhibernate - NHibernate 版本冲突

> ID：891109
> 
> 赞同：2
> 
> 时间：2009-05-21T02:09:15.470
> 
> 标签：nhibernate

如果我想在 1 个项目中使用以下框架，是否需要创建自己的 nHibernate 和工具构建。

休眠

nHibernate 验证器

流畅的 NHibernate

xVal NHibernate 提供程序

nHibernate Linq

我收到“无法加载文件或程序集'NHibernate”错误，我认为这是因为每个框架都是针对不同版本的 nHibernate 构建的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T03:46:03.773

下载 2.0 版本的一切解决了这个问题。

傻我！

# c# - 如何根据检查项目动态激活/停用清单项目？

> ID：891110
> 
> 赞同：0
> 
> 时间：2009-05-21T02:10:47.323
> 
> 标签：c#, .net, asp.net, visual-studio-2008

我有一个`checkboxlist`包含从数据库表加载的服务列表。这些服务中的每一个都只能单独执行或与其他一些特定服务一起执行。例如，如果我选择“Transfer Property”，则无法同时选择“Register”。

我有一个表格，其中包含服务之间的关系以及可以与每个服务一起选择哪些服务（我解释对了吗？）。

我需要的是单击一项服务，然后禁用/禁止检查与该服务无关的所有服务，并在我取消选中父项时重新启用该项...

有没有好的方法来做到这一点？我的意思是，有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-21T02:26:29.057

```
 void ControlCheckBoxList(int selected, bool val)
    {
        switch (selected)
        {
            case 1:
            case 2:
            case 3:
                checkedListBox1.SetItemChecked(5, !val);
                break;
            case 6:
                checkedListBox1.SetItemChecked(1, true);
                break;
            default:
                checkedListBox1.ClearSelected();
                break;
        }
    }

    private void checkedListBox1_ItemCheck(object sender, ItemCheckEventArgs e)
    {
        ControlCheckBoxList(e.Index, e.NewValue == CheckState.Checked ? true : false);
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T02:28:07.413

1）强制您的复选框自动回发，然后在回发时检查选中/取消选中的值，然后根据需要启用/禁用其他复选框。

2) 尝试用 AJAX 做类似的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T02:31:32.337

好吧，javascript 可能最适合做这个客户端，否则你可以在代码中尝试这样的事情。

```
 List<Service> services = new List<Service>(); //get your services

        foreach (ListItem li in lstRoles.Items)
        {
            Predicate<Service> serviceIsAllowed = delegate (Service s) { return /*some expression using s and li.Value (or use a lambda expr) */; }

            li.Selected = services.Find(serviceIsAllowed) != null;
        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T02:44:31.407

首先，您的 CheckBoxList 需要将 AutoPostBack 设置为 true。

我相信你正在寻找的关键是

```
 CheckBoxList1.Items.FindByText(service).Enabled = false; 
```

或者这也有效

```
 CheckBoxList1.Items.FindByText(service).Attributes.Add("disabled", "disabled"); 
```

在上下文中，它可能看起来像这样：

```
 <asp:CheckBoxList ID="CheckBoxList1" runat="server" AutoPostBack="True" 
        onselectedindexchanged="CheckBoxList1_SelectedIndexChanged">        
    </asp:CheckBoxList>

    protected void CheckBoxList1_SelectedIndexChanged(object sender, EventArgs e)
    {

        //first reset all to enabled
        for (int i = 0; i < CheckBoxList1.Items.Count; i++)
        {
            CheckBoxList1.Items[i].Attributes.Remove("disabled", "disabled");
        }

        for (int i = 0; i < CheckBoxList1.Items.Count; i++)
        {

            if (CheckBoxList1.Items[i].Selected)
            {
                //get list of items to disable
                string selectedService = CheckBoxList1.Items[i].Text;
                List<string> servicesToDisable = getIncompatibleFor(selectedService);//this function is up to u
                foreach (string service in servicesToDisable)
                {
                    CheckBoxList1.Items.FindByText(service).Attributes.Add("disabled", "disabled");                                                
                }                   
            }
        }
    } 
```

# php - 如何将javascript变量返回给Ajax？

> ID：891111
> 
> 赞同：0
> 
> 时间：2009-05-21T02:10:48.323
> 
> 标签：php, ajax

有谁知道在我使用 ajax 调用 php.ini 时如何将 javascript 变量返回给 ajax 而不是字符串值。请参阅以下示例以获取更多详细信息：

阿贾克斯：

```
 //Ajax Param 
    var paramList = "Action=make_process";

    ajaxRequest = $.ajax({
            url: "admin.php",
            type: 'POST',
            data: paramList,
            error: function(){
                  //error message here
            },
            success: function(data){
                 //read return javascript variable here;
            }   
        }); 
```

PHP：

```
public function validationChk()
    {
        $error_msg['error_msg'][] = array("msg"=>"hello");
            $error_msg['error_msg'][] = array("msg"=>"hi");

        echo "var ErrorMapping = " . json_encode($error_msg). ";\n\n";          
        exit;
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T02:12:42.047

您想知道如何从 AJAX 响应中返回吗？

然后查看[这个 jQuery 常见问题解答。](http://docs.jquery.com/Frequently_Asked_Questions#How_do_I_get_and_use_the_server_response_from_an_AJAX_request.3F)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T02:44:30.767

你想要做的并不是什么好主意。**您可能想要的是从您的成功**回调中将 JSON 响应解码回一个对象，然后将**其**返回。

解码 JSON 字符串涉及通过 eval 对其进行管道传输，并希望您没有不良/恶意数据。执行此操作的安全方法是在 Javascript 中解析 JSON。如果你**必须**自己走这条路，那么至少尝试使用已经写好的东西。在 Google 代码中搜索“json-sans-eval”。

更好的选择是使用 jQuery 的内置功能：

```
jQuery.getJSON( url, [data], [callback] ) 
```

它为你做了所有困难的事情。花一些时间阅读 jQuery 的文档。那里有很多有用的东西。

# ruby - 如何更新到 Ruby 1.8.7

> ID：891120
> 
> 赞同：5
> 
> 时间：2009-05-21T02:13:38.207
> 
> 标签：ruby, macos

我是 Ruby 的新手，所以请耐心等待。我一直在尝试将我的 Ruby 更新到 1.8.7，但在我的 Mac OS X (10.5.7) 上遇到了很多问题。

所以真的，你如何更新到 Ruby 1.8.7？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-21T08:41:53.347

最简单的答案是“不要”。Ruby 1.8.7 试图在 1.8 和 1.9 之间创建桥接版本，社区的共识是这没有必要，因此在 1.9 最终确定之前几乎没有支持它。一般建议要么坚持使用 1.8（该版本随 OS X 10.5 提供），要么使用 Ruby 1.9。

[MacPorts](http://www.macports.org)有适用于 Ruby 1.8.7 和 Ruby 1.9 的软件包，因此这可能是获得更新版本的 Ruby 的最简单方法，而且不会有任何修改 OS X 本身的风险。

更新：正如 ajhit406 所指出的，[RVM](https://rvm.io/)现在是最好的选择，而不是 MacPorts。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-21T02:27:54.653

你试过[一键安装](http://rubyosx.rubyforge.org/)吗？

编辑：一键式安装程序看起来不再维护，请尝试[Rails Installer](http://railsinstaller.org/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-06-17T15:59:35.660

死灵法...

[http://rvm.io/](http://rvm.io/)

编辑（mpapis）：Ruby 团队不再维护 Ruby 1.8.7，不应再使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T02:31:36.720

下载并解压所需的 Ruby 版本。我们将调用目录 ruby​​_1.8.7 并假设它在您的主目录中。打开一个终端窗口。

```
sudo cp -r ruby_1.8.7 /System/Library/Frameworks/Ruby.framework/Versions/1.8.7
cd /System/Library/Frameworks/Ruby.framework/Versions
sudo ln -sfh 1.8.7 Current 
```

# javascript - 如何确保用户在任何时候都不能打开多个弹出窗口？

> ID：891124
> 
> 赞同：0
> 
> 时间：2009-05-21T02:13:49.050
> 
> 标签：javascript

我有一个页面列出上传的附件和每个附件旁边的图标，打开一个弹出窗口（单击时）以允许用户编辑每个附件的各种附件信息。

我的问题是：

1.  如何确保用户在任何时候只允许打开一个弹出窗口

2.  当用户试图打开另一个弹出窗口时，会弹出一个警告并告诉他/她他们不能打开多个窗口。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T02:25:35.220

打开它时给弹出窗口一个名称。这将强制任何后续点击在同一个弹出窗口中打开。然后，您可以实现 window.unload 事件以防止用户导航离开当前正在保存的页面。

如果您使用的是 jQuery，但我建议您使用 ui.dialog 来提供页面中的功能。然后，您还将强制用户一次编辑一个。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T10:58:58.297

创建新弹出窗口时，将变量设置为指向新窗口，然后检查它是否已关闭：

```
var currentPopup = null;

function openPopup(){

    //test that we have either not opened a popup or have closed it.
    //references to closed windows don't disapear, but have their closed property set to true.
    if(!currentPopup || currentPopup.closed){

        //set the new currentPopup variable to reference the new window.
        currentPopup = window.open(...);
     }
     else{
         //A window is open! Display error message.
         //for the best user experience use a nice way to display the message as opposed to using an alert();

    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-21T07:02:10.617

您可以对窗口使用“句柄”并检查它是否打开，这是一个示例：

```
var vWin = null;
var msWindowUsedMessage = "A previous action was not completed.\nClose the window and try again.";

function IsWindowUsed(oWindowToCheck) { 
    if (!oWindowToCheck.closed && oWindowToCheck.location) { 
        alert(msWindowUsedMessage); 
        oWindowToCheck.focus(); 
        return true;
    } 
    return false;
}
function Open_New_Window(sUrl, sTitle, sParams) {
    var winLeft = top.screenLeft + 50;
    var winTop = top.screenTop + 50;
    var oWindowHandle = window.open(sUrl, "", sParams + ",toolbar=no,top=" + winTop + ",left=" +  winLeft); 
    oWindowHandle.opener = self; 
    return oWindowHandle;
}

function Add() { 
    if (IsWindowUsed(vWin)){ 
        return;
    } 
    var sParams = "width=380,height=10,status=no,resizable=yes"; 
    var sUrl = "add.aspx";
    vWin = Open_New_Window(sUrl, 'Add', sParams);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T02:25:32.350

为什么不制作每个弹出模式，以便在与主页交互之前必须将其关闭。[使用jQuery Dialog 插件](http://docs.jquery.com/UI/API/1.7/Dialog)很容易做到这一点，但您也可以使用一些 javascript/css 魔术来制作自己的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T03:45:03.553

创建一个 cookie 或全局（基于您的需要的客户端或服务器端）标志，并在每次触发弹出窗口时检查它是否已设置。

# javascript - 如何避免mailto的烦恼？

> ID：891131
> 
> 赞同：4
> 
> 时间：2009-05-21T02:16:21.993
> 
> 标签：javascript, html, mailto

我正在开发一个网站，并希望我的用户能够尽可能轻松地提供反馈。我知道一种方法，但我一直讨厌它：

```
<a href="mailto:someone@somewhere.com">Click Here to be annoyed!</a> 
```

JavaScript 或 HTML 中有没有一种方法可以让我的用户给我发电子邮件而不必遇到很多麻烦？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-21T06:44:17.853

联系表格：

*   避免接收“mailtos”的垃圾邮件机器人
*   允许您验证表单用户是“人类”（可选验证码）
*   让您对数据格式进行全面的服务器端控制
*   允许您随时从服务器轻松更改您的电子邮件
*   向访问者/成员/站点用户隐藏您最喜欢的真实电子邮件
*   为您提供控制主题的选项（通过选择菜单等）
*   让您有机会让用户检查一些额外的东西
    *   例如，调查问题、订阅选择、对服务的兴趣、报价等。
*   让您有机会在提交后返回感谢（或销售页面）
*   给你另一个看起来专业的机会

毫无疑问，该链接最初是最简单的——只需点击一下；但是，考虑到所有因素，我全心全意地同意联系表格是大多数用途的方式，出于我上面列出的原因等等。

* * *

好吧，既然 Tom 向我提出了挑战，;) 这里有一些复制和粘贴的联系人小部件，您可以在一分钟左右的时间内完成并测试它们。

**一些可自定义的 Flash Contact/MailTo 小部件：**

*   [http://www.widgetbox.com/widget/contactify-widget-beta](http://www.widgetbox.com/widget/contactify-widget-beta)可定制的联系表格。风格是高度可定制的。

*   [http://www.widgetbox.com/widget/contact-emailer-version3-rajwidgetbox](http://www.widgetbox.com/widget/contact-emailer-version3-rajwidgetbox) 在您网站的联系页面中使用这个小工具。通过不在您的网站或博客中提供您的电子邮件地址来避免垃圾邮件。这个小工具是高度可定制的。这使用图像验证码功能。支持多种语言。第 3 版。3300 次下载

*   [http://www.widgetbox.com/widget/ultimate-antispam-email-link](http://www.widgetbox.com/widget/ultimate-antispam-email-link) 现在，如果您真的不想要一个表单，但想要一个垃圾邮件机器人无法获取的电子邮件链接，那么这里就是您的小部件。在自定义区域中，您定义您的聚会和邮寄地址。这是一个简单的 Flash 按钮，因此用户在打开邮件客户端之前不会看到它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-21T02:19:30.520

你描述的方式是我认为最简单的方式。

如果您希望在页面中像表单一样输入电子邮件，您可能需要创建一个[电子邮件/建议表单](http://www.tizag.com/htmlT/forms.php)或[替代](http://www.javascript-coder.com/html-form/html-form-email.phtml)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-21T02:21:38.300

您可以为评论和提交按钮提供多行文本框，将文本发布到您的服务器，然后在服务器上将其邮寄给您自己。这样一来，您的用户就不必去他们的邮件客户端，但代价是您无法获得一个合理可能有效的回复地址。

您甚至可以使用 AJAX 并让他们免于刷新屏幕。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-23T10:19:21.813

[Google Docs](http://docs.google.com/)提供创建可以轻松嵌入网站的网络表单。它收集在线电子表格中的所有数据，您可以随时以各种格式下载该电子表格。如果访客填写了您的联系表，您甚至可以设置电子邮件通知。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-21T02:59:56.880

我会创建一个用户可以提供反馈的表单，然后让您的服务器将其写入数据库。写入数据库可能会使您更有效地处理反馈。让用户填写表格而不是向您发送自由格式的电子邮件也有助于您对反馈或与反馈相关的元数据（错误/功能请求/评论等）实施某种结构。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-21T02:24:32.397

最可靠的方法是在一些服务器端处理的帮助下发送电子邮件。

你也可以在 action 属性的帮助下使用 HTML 表单：

```
<form action="mailto:user@example.com">
...
</form> 
```

但是这种方法可能对所有浏览器都不可靠。

# android - 是否可以以编程方式卸载 Android 中的软件包

> ID：891141
> 
> 赞同：39
> 
> 时间：2009-05-21T02:18:22.300
> 
> 标签：android

软件包可以自行卸载吗？如果它们共享相同的 userId 和签名，一个包可以卸载另一个包吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2015-07-13T11:55:25.177

```
Uri packageURI = Uri.parse("package:"+"your.packagename.here");
Intent uninstallIntent = new Intent(Intent.ACTION_DELETE, packageURI);
startActivity(uninstallIntent); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-03-08T18:30:58.430

第三方应用程序无法以编程方式安装或卸载任何其他软件包，这对 Android 来说是一个安全风险。但是，第 3 方应用程序可以*要求*Android 操作系统使用意图安装或卸载包，这个问题应该提供更完整的信息：

[以编程方式安装/卸载 APK（PackageManager 与 Intents）](https://stackoverflow.com/questions/6813322/install-uninstall-apks-programmatically-packagemanager-vs-intents)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-03-29T20:20:48.113

第三方应用程序无法静默卸载应用程序！

要么您需要成为系统应用程序才能获得**DELETE_PACKAGES**权限，否则您需要显示卸载弹出窗口（用户确认）

或者，您可以获取辅助功能权限，然后通过显示辅助功能覆盖，您可以告诉您的服务单击**卸载**按钮！但这将侵犯隐私。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-10-18T19:51:41.033

在 Kotlin 中，使用 API 14+，您可以调用以下命令：

```
startActivity(Intent(Intent.ACTION_UNINSTALL_PACKAGE).apply {
     data = Uri.parse("package:$packageName")
}) 
```

或使用 Android KTX：

```
startActivity(Intent(Intent.ACTION_UNINSTALL_PACKAGE).apply {
     data = "package:$packageName".toUri()
}) 
```

它将显示您的应用程序的卸载提示。如果需要，您可以更改`packageName`为另一个应用程序的任何包名称。

# java - 如何提交具有动态（未知）字段数的表单

> ID：891153
> 
> 赞同：1
> 
> 时间：2009-05-21T02:24:46.250
> 
> 标签：java, html

我正在尝试将表单提交给 servlet (java)。表单有一堆问题，每个问题都有 4 个单选按钮，用户选择其中一个。我不知道表格中的问题数量。它可能是 10、15、12...取决于其他一些标准。我的问题是检索用户为表单上的问题所做的选择列表的最佳方法是什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T02:47:01.010

您可以使用 HttpServletRequest.getParameterNames() 检索请求中所有表单元素名称的枚举。然后，您可以迭代枚举并使用 HttpServletRequest.getParameter(name) 为每个元素请求单独的值。

如果您的 HTML 包含选项单选按钮以外的其他 FORM 元素，请使用这些单选按钮的巧妙命名约定，以便在枚举参数名称时，您知道要请求什么。

一个例子。

如果您的表单包含两个带有以下选项的问题：

```
Question 1: 
<input type="radio" name="question1" value="option1">
<input type="radio" name="question1" value="option2">
<input type="radio" name="question1" value="option3"> 

Question 2:
<input type="radio" name="question2" value="option1">
<input type="radio" name="question2" value="option2">
<input type="radio" name="question2" value="option3"> 
```

在您的 servlet 中，

```
Enumeration e = request.getParameterValues();
while(e.hasMoreElements()){
     String name = (String)e.nextElement();
     if(name.startsWith("question"){
        String value = request.getParameter(name);
        //your logic here
     }

} 
```

另一个做同样的事情是：

在您的 servlet 中，

int maxQuestionNumber = Integer.parseInt(request.getParameter("maxQuestionNumber"));//这应该是 HTML 表单中的隐藏变量，表示表单中的最大问题。

```
for(int i=1;i<=maxQuestionNumber;i++){
     String value = request.getParameter("question"+i);
     //your logic here..
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T02:34:14.437

我想到的一个快速技巧是将所有字段命名为

```
"question_"+n 
```

并隐藏一个值为 n 的输入类型。如果表单有办法知道要呈现多少个问题，它应该有办法设置 n 的值。

稍后您只需检索该值并...

```
 n = new Integer( request.getParameter("number_of_question"));
 for( int i = 0 ; i < n ; i++ ) { 
      list.add( request.getParameter("question_"+i));
  } 
```

这是我想到的第一件事

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T03:36:51.777

我建议没有解决方法。ServletRequest.getParameterMap() 在这个场景中会派上用场。映射的键将是 String 类型，值将是 String[] 类型。

因此，您可以使用类似这样的 foreach 循环非常轻松地遍历地图，

```
for(Map.Entry<K, V> entry : map.entrySet()){
    ..
    if(entry.getValue().length > 1){
       //means the choices not the question
    }else{
       //means the question not the choices
    }
} 
```

我希望它会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T02:29:58.550

一种典型的技术是使用公共前缀命名字段，然后遍历它们：q000、q001、q002 等，直到找到不存在的字段。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T03:47:37.083

您可以只使用 JSON，然后将字符串传递给 servlet，如果您使用 POST，它可以处理很长的字符串。这样你就可以传递你想要的任何东西，即使参数很复杂。

# unix - 杀死同名进程

> ID：891154
> 
> 赞同：0
> 
> 时间：2009-05-21T02:24:58.747
> 
> 标签：unix

我想在一个同名的进程上使用killall，从该进程中执行killall，而不杀死产生killall的进程。

所以更详细地说，假设我有进程 foo，进程 foo 正在运行。我希望能够运行“foo -k”，并让新的 foo 杀死旧的 foo，而不会杀死自己。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T02:26:45.000

```
pgrep foo | grep -v $$ | xargs kill 
```

如果您没有`pgrep`，您将不得不想出一些其他方法来生成感兴趣的 PID 列表。一些选项是：

1.  使用 ps 和适当的选项，然后使用 grep、sed 和/或 awk 的某种组合来匹配进程并提取 PID。

2.  `killall`可以发送信号 0 而不是`SIGTERM`; 其标准语义是它不发送信号，而只是确定进程是否处于活动状态。也许您可以使用 killall 来选择进程列表并让它打印匹配的活跃进程的 PID。这也可能需要使用 sed 进行一些后期处理。

3.  可能有一些类似于 Linux`/proc`文件系统的东西，其中包含保存系统数据的伪文件，您可以通过这些伪文件。同样，grep/awk/sed 是您的朋友。

如果您确实需要有关如何执行此操作的特定详细信息，请发表评论或向我发送邮件，我将尝试更详细地扩展其中一些选项。

[编辑：为那些没有 pgrep 的人添加了更多选项。]

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T03:23:01.470

这似乎适用于 OS X：

```
killall -s foo | perl -ne 'system $_ unless /\b'$PPID'\b/' 
```

killall -s 列出它会做什么，一次一个 PID。做它会做的事，除了自杀。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T03:25:01.713

解决此问题的常用方法是`foo`将其进程 ID 写入文件，例如`/var/run/foo.pid`当它以*daemon mode*运行时。然后你可以让非守护程序版本从 PID 文件中读取 PID 并`kill(2)`直接调用它。这通常是 apache 等处理它的方式。当然，较新的 OSX 守护程序会通过`launchd(8)`，但仍有一些使用良好的老式信号。

# jquery - 使用 JQuery 防止重复数据

> ID：891167
> 
> 赞同：1
> 
> 时间：2009-05-21T02:30:19.797
> 
> 标签：jquery

我有一个愚蠢的客户，他似乎不理解警报中的英文文本，指示他的数据已成功保存。他不断地按下提交按钮并将新的一行数据插入到数据库中。任何人都可以提出解决方案来防止这种情况吗？我正在使用 jQuery 提交数据，所以没有刷新。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T02:35:23.297

您可以禁用提交按钮或图像，直到请求返回结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T02:34:35.903

在提交表单时将在隐藏字段中进行插入的页面上生成唯一令牌。将此令牌存储在数据库中的某处。处理包含该令牌的帖子时，如果尚未标记该令牌，则标记该令牌已被使用。如果看到带有已使用令牌的帖子，请拒绝处理它并向用户显示错误（或重定向到编辑/更新页面，以便他们进行更改）。

**编辑**：基于评论

如果您需要来自同一页面的多个插入，那么大概您有一些包含新数据的输入字段。当您提交数据时，请打开一个模式对话框，显示“请稍候，我正在更新您的数据”。这将阻止用户在更新发生时执行任何操作。当更新成功返回时，清除输入字段并关闭对话框。如果请求时间过长，请关闭对话框，显示错误，然后将数据保留在字段中以供重新提交。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T03:21:47.743

当您通过 AJAX 删除帖子时，Wordpress 有一个很棒的动画。也许您可以做一些类似的事情，除了在屏幕上添加新行（使用 JSON 来获取数据）并将其淡入，首先是绿色以帮助向最终用户显示它是绿色的。

至于不重置表单值，您可以在 jQuery 中执行类似的操作

```
$('#myForm input[type=text]').val(''); 
```

祝弗兰克好运！

**编辑** 我认为，如果您通过 AJAX 返回结果，然后在屏幕上更新某些内容，最终用户将不太可能认为他的输入尚未输入到数据库中。

您可以从 www.ajaxload.info 获得一个很酷的 ajax 加载器，并在 AJAX（我假设当您说用户没有离开页面时，这就是您所指的）正在处理时显示它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T02:35:48.007

您可以将该数据放在屏幕上，使用黄色淡入淡出效果在列表视图中的屏幕上突出显示它。当新数据插入到表格或列表元素的顶部时，暂时突出显示它，使用 jquery 的新实时方法添加通过 AJAX 删除行的能力。

此外，由于您刚刚获得数据，因此您不必等待将其添加到屏幕上，只需确保您检查数据库返回成功的结果，以便您可以删除它或使用占位符，直到数据库返回成功，然后添加成功的数据。

# macos - 为 Mac OS X 安装未处理的异常过滤器

> ID：891172
> 
> 赞同：3
> 
> 时间：2009-05-21T02:32:40.540
> 
> 标签：macos, exception-handling

Windows 具有 SetUnhandledExceptionFilter API 以使应用程序能够处理崩溃。Mac平台有类似的东西吗？我在 developer.apple.com 上没有找到类似的东西...

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T02:34:31.473

查看[Smart Crash Reports](http://smartcrashreports.com/)及其工作原理。请注意，这是一个真正的邪恶黑客。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T03:31:07.240

Cocoa/Foundation 等价物是[NSSetUncaughtExceptionHandler()](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Miscellaneous/Foundation_Functions/Reference/reference.html#//apple_ref/c/func/NSSetUncaughtExceptionHandler)函数。您还应该查看 Cocoa 异常处理指南的[控制程序对异常的响应](http://developer.apple.com/documentation/Cocoa/Conceptual/Exceptions/Tasks/ControllingAppResponse.html#//apple_ref/doc/uid/20000473)部分。它将解释一些默认更改，您可以在 NSApplication 对象想要以异常终止时让您的应用程序执行特定的、预定义的事情。

# spring - springdoclet的用法？

> ID：891174
> 
> 赞同：2
> 
> 时间：2009-05-21T02:33:33.347
> 
> 标签：spring, spring-mvc, spring-security, spring-roo

springdoclet 是用来生成 bean 定义 xml 文件的吗？servlet-config.xml..等？

我试图找出 springdoclet 与 spring roo 相比有什么不同

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-03-18T17:54:14.940

[Spring Roo](http://www.springsource.org/roo)是一个类似于 grails 的框架，但是是用 java 编写的。与 springdoclet 相比，它具有不同的目的。

另请参阅[roo 的用户指南](http://static.springsource.org/spring-roo/reference/html/intro.html)

# html - 使用 XSLT 将 XML 转换为 XML

> ID：891187
> 
> 赞同：2
> 
> 时间：2009-05-21T02:37:59.187
> 
> 标签：html, xml, xslt

我正在尝试使用 XSL 从现有文件创建一个新的 XML 文件。编写新文件时，我想屏蔽出现在 accountname 字段中的数据。

**这就是我的 XML 的样子：**

```
<?xml version="1.0" encoding="UTF-8"?>
<Sumit>
    <AccountName>Sumit</AccountName>
      <CCT_datasetT id="Table">
       <row>
         <CCTTitle2>Title</CCTTitle2>
       </row>
       </CCT_datasetT>
</Sumit> 
```

**这是我的 XSL 代码：**

```
<xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:output method="xml" encoding="UTF-8" indent="yes" omit-xml-declaration="no" />

  <xsl:template match="@*|node()">
    <xsl:copy>
        <xsl:apply-templates select="@*|node()"/>
    </xsl:copy>
</xsl:template>

  <xsl:template match="@*">
    <xsl:attribute namespace="{namespace-uri()}" name="{name()}"/>
  </xsl:template>

<xsl:template match="AccountName">
<AccountName>acc_no</AccountName>
</xsl:template>

</xsl:stylesheet> 
```

当我将 XSL 代码应用到我的 XML 时，我得到以下输出：

```
<?xml version="1.0" encoding="UTF-16"?>
<Sumit>
<AccountName>acc_no</AccountName>
<CCT_datasetT id="">
<row>
<CCTTitle2>Title</CCTTitle2>
</row>
</CCT_datasetT>
</Sumit> 
```

有以下问题：

1) 它使用 UTF-16 编码创建输出

2）第二行的输出是：

```
<CCT_datasetT id=""> 
```

缺少属性值（表）。

谁能告诉我如何摆脱这两个问题。非常感谢。

* * *

@埃文·伦茨：

这是javascript代码：

```
var oArgs = WScript.Arguments;

if (oArgs.length == 0)
{
   WScript.Echo ("Usage : cscript xslt.js xml xsl");
   WScript.Quit();
}
xmlFile = oArgs(0) + ".xml";
xslFile = oArgs(1) + ".xsl";

var xml = new ActiveXObject("Microsoft.XMLDOM")
xml.async = false
xml.load(xmlFile)

// Load the XSL
var xsl = new ActiveXObject("Microsoft.XMLDOM")
xsl.async = false
xsl.load(xslFile)

// Transform
var msg = xml.transformNode(xsl)

var fso = new ActiveXObject("Scripting.FileSystemObject");

// Open the text file at the specified location with write mode

var txtFile = fso.OpenTextFile("Output.xml", 2, false, 0);

txtFile.Write(msg);
txtFile.close(); 
```

它在一个新文件“Output.xml”中创建输出，但我不知道为什么编码会发生变化。我比较关心它，原因如下：

我的输入 XML 包含以下代码：

```
<Status></Status> 
```

在输出中它显示为

```
<Status>
</Section> 
```

为所有空标签引入回车。我不确定它是否与编码有关。请建议。

非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T05:11:49.800

删除您的第二个模板规则。第一个模板规则（身份规则）已经为您复制了属性。通过包含第二个（具有显式`<xsl:attribute>`指令），您正在创建一个冲突 - 一个错误条件，并且 XSLT 处理器正在通过选择稍后出现在样式表中的那个来恢复。“id”属性为空的原因是您的第二条规则是创建一个具有相同名称但没有值的新属性。但同样，第二条规则无论如何都是不必要的，所以你应该删除它。这将解决缺少属性值的问题。

至于输出编码，听起来您的 XSLT 处理器不遵守`<xsl:output>`您给它的指令，或者它是在编码由框架确定的上下文（例如服务器端框架？）中调用的，而不是比 XSLT 代码。您正在使用什么 XSLT 处理器以及如何调用它？

更新（重新：字符编码）：

保存方法（[DOMDocument）](http://msdn.microsoft.com/en-us/library/ms753769(VS.85).aspx)文档说：

> 字符编码基于 XML 声明中的 encoding 属性，例如`<?xml version="1.0" encoding="windows-1252"?>`. 未指定编码属性时，默认设置为 UTF-8。

我会尝试使用 transformNodeToObject() 和 save() 而不是输出到字符串。

我没有测试过这个，但你可能想要这样的东西：

```
var result = new ActiveXObject("Microsoft.XMLDOM")

// Transform
xml.transformNodeToObject(xsl, result);

result.save("Output.xml"); 
```

更新（回复：不需要的空格）：

如果您想最终控制结果中出现的空格，则不应在`<xsl:output>`元素上指定 indent="yes"。尝试删除它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T09:12:19.510

试试这个：

```
<xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:output method="xml" encoding="UTF-8" indent="yes" omit-xml-declaration="no" />

    <xsl:template match="@*|node()">
      <xsl:copy>
          <xsl:apply-templates select="@*|node()"/>
      </xsl:copy>
  </xsl:template>

    <!-- You don't actually need this template -->
    <!-- but I think this was what you were trying to do -->
    <xsl:template match="@*" priority="2">
      <xsl:attribute namespace="{namespace-uri()}" name="{name()}"><xsl:value-of select="."/></xsl:attribute>
    </xsl:template>

  <xsl:template match="AccountName" priority="2">
  <AccountName>acc_no</AccountName>
  </xsl:template>

</xsl:stylesheet> 
```

至于 UTF 问题，您正在做正确的事情。

来自 www.w3.org/TR/xslt： encoding 属性指定用于输出结果树的首选编码。XSLT 处理器需要遵守 UTF-8 和 UTF-16 的值。

# perl - 这种 Perl 行为可以用 switch/case 或 given/when 来模拟吗？

> ID：891188
> 
> 赞同：1
> 
> 时间：2009-05-21T02:39:17.720
> 
> 标签：perl

我想知道是否有人对改进以下代码（如果可能）有任何建议，以便它不需要重复（我的 @a = $time =~ ...），可能使用 case/switch 或 given/when 或我想念的其他想法？

```
my $time = '12:59pm';

if( my @a = $time =~ m/^(\d\d?)(am|pm)$/ )        { tell_time( $a[0], 0, $a[1] ) }
if( my @a = $time =~ m/^(\d\d?):(\d\d)(am|pm)$/ ) { tell_time( @a ) }
if( my @a = $time =~ m/^(\d\d?):(\d\d)$/ )        { tell_time( @a ) }

sub tell_time
{
    my $hour    = shift;
    my $minute  = shift || '00';
    my $ampm    = shift || ( $hour > 12 ) ? 'pm' : 'am';

    print "Hour: $hour, Minute: $minute, AMPM: $ampm\n";
} 
```

我尝试过使用 Switch 和 5.10 given/when，但似乎无法执行以下操作：

```
given( $time )
{
    when( /^(\d\d?)(am|pm)$/ )        { tell_time( $_[0], 0, $_[1] ) }
    when( /^(\d\d?):(\d\d)(am|pm)$/ ) { tell_time( @_ ) }
    when( /^(\d\d?):(\d\d)$/ )        { tell_time( @_ ) }
} 
```

这不会飞，因为@_ 似乎正在存储 $time。

*另请注意*，我对问题的语法比代码解决的问题更感兴趣。我很清楚我可以使用 Time::ParseDate 来找出格式为时间或日期的字符串的各个部分。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-21T02:57:19.647

您的正则表达式用于`()`提取匹配项，但您不必将它们存储在数组中。如果需要，它们将存储在`$1`、`$2`、`$3`等中。看：

```
given( $time )
{
    when( /^(\d\d?)(am|pm)$/ )        { tell_time( $1, 0, $2 ) }
    when( /^(\d\d?):(\d\d)(am|pm)$/ ) { tell_time( $1, $2, $3 ) }
    when( /^(\d\d?):(\d\d)$/ )        { tell_time( $1, $2 ) }
} 
```

做我认为你想做的事。

如果您想添加语法，我会写`tell_time()`简单地将时间作为字符串，并让函数自己解析结果，而不是让代码的用户自己解析它。或者，您可以将此`given()`块用作一个新函数的开始，该函数正是这样做的 - 解析时间字符串并将其正确传递给`tell_time()`. 但这只是我。我不知道你需要你的代码做什么，所以一定要去做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T03:01:00.217

好吧，不使用开关/大小写，我只使用一个正则表达式来捕获所有的变化......

```
#!/usr/bin/perl

tell_time ("12:59am");    # matches time format 1
tell_time ("2:59pm");     # matches time format 1
tell_time ("12am");       # matches time format 2
tell_time ("12:59");      # matches time format 3
tell_time ("14:59");      # matches time format 3
tell_time ("12:59:59am"); # produces no output, does not match any known time formats.

sub tell_time
{
    my $timearg = shift;

    # note: (?: ... ) creates a non-capturing group, which is not reflected in 
    # the returned array.
    my ($hour , $minute, $ampm) = ( $timearg =~ m/^(\d\d?)(?::(\d\d?))?(am|pm)?$/ ) ;

    # only continue if we captured all required fields (i.e. hour)
    if($hour)
    {
        # set default values for optional fields (i.e. minute, ampm) if necessary
        $minute ||=  '00';
        $ampm ||=  ( $hour > 12 ) ? 'pm' : 'am';

        print "Hour: $hour, Minute: $minute, AMPM: $ampm\n";
    }

} 
```

如有必要，我可以进一步解释，但我认为如果你能阅读 perl，它应该清楚它在做什么......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T03:16:06.397

由于您使用的是 5.10，因此您不妨在正则表达式中使用[命名捕获](http://perldoc.perl.org/perlre.html#%27(?%27NAME%27pattern)%27)：

```
#!/usr/bin/perl

use 5.010;
use strict;
use warnings;

my $hour24   = qr/(?<hour>[1-9]|1[0-9]|2[0-3])/;
my $hour12   = qr/(?<hour>[1-9]|1[0-2])/;
my $minute   = qr/(?<minute>[0-5][0-9])/;
my $meridiem = qr/(?<meridiem>am|AM|pm|PM)/;

for my $time (qw(5pm 10am 5:59pm 10:00pm 5:00 22:00 24:00)) {
    given($time) {
        when(/ ^ $hour12 $meridiem $ /x) { 
            my $hour = $+{hour};
            $hour += 12 if 'pm' eq lc $+{meridiem};
            tell_time($hour, "00") 
        }
        when(/ ^ $hour12 : $minute $meridiem $ /x) { 
            my $hour = $+{hour};
            $hour += 12 if 'pm' eq lc $+{meridiem};
            tell_time($hour, $+{minute}) 
        }
        when(/ ^ $hour24 : $minute $ /x) { 
            tell_time($+{hour}, $+{minute}) 
        }
        default {
            say "bad time: $time";
        }
    }
}

sub tell_time {
    my ($hour, $minute) = @_;
    say "it is $hour:$minute";
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T03:07:25.837

Chris Lutz 已经使用 Perl 5.10 介绍了 switch 语法。在 Perl 的 order 版本中，您可以使用循环别名来模拟一个：

```
for ($time) {
  /^(\d\d?)(am|pm)$/        && do { tell_time( $1, 0, $2 );  last };
  /^(\d\d?):(\d\d)(am|pm)$/ && do { tell_time( $1, $2, $3 ); last };
  /^(\d\d?):(\d\d)$/        && do { tell_time( $1, $2 );     last };
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T03:23:08.333

我不确定给定/何时方面在这里是否重要。我只是将可能的模式组合在一个正则表达式中。结合特殊变量 %+ 和定义或运算符，我们可以使代码更加简洁。

```
#!/usr/bin/perl

use strict;
use warnings;

my @times = qw( 12:59pm 12 1pm 13:11 11 11pm);

my $hour_pat   = '(?<hour>[0-9]{1,2})';
my $minute_pat = '(?<minute>[0-9]{2})';
my $ampm_pat   = '(?<ampm>am|pm)';

my $re = qr{
    \A
    (?:$hour_pat : $minute_pat $ampm_pat)
    |
    (?:$hour_pat : $minute_pat)
    |
    (?:$hour_pat $ampm_pat)
    |
    (?:$hour_pat)
    \z
}x;

for my $time ( @times ) {
    if ( $time =~ $re ) {
        tell_time( %+ );
    }
}

sub tell_time {
    my %time = @_;
    printf( "Hour: %2.2d, Minute: %2.2d, AMPM: %s\n",
        $time{hour},
        $time{minute} // 0,
        $time{ampm} // ( $time{hour} >= 12 ? 'pm' : 'am' ),
    );
    return;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T06:19:43.960

我创建带有块标签的开关，如下所示：

```
my $time = '12:59pm';
SWITCH: {
    $time =~ /^(\d\d?)(am|pm)$/ && do { 
        tell_time($1,0,$2);
        last SWITCH;
    };
    $time =~ /^(\d\d?):(\d\d)(am|pm)$/ && do {
        tell_time($1,$2,$3);
        last SWITCH;
    };
    $time =~ /^(\d\d?):(\d\d)$/ && do {
        tell_time($1,$2);
    };
} 
```

# filter - 在 Excel 2007 中编码文本过滤器

> ID：891189
> 
> 赞同：0
> 
> 时间：2009-05-21T02:39:48.607
> 
> 标签：filter, autofilter, excel, vba

我正在尝试使用代码根据当前日期动态过滤电子表格。

我将需要过滤的日期存储为“CurrDay”，并试图将存储的日期重新调用到我的过滤算法中。它不起作用，我需要弄清楚如何完成此代码。每次我运行代码时，它都会返回过滤器中的 CurrDay 名称，而不是存储在 CurrDay 变量下的日期。

我在这里遗漏了一些东西，我需要一些指导。任何帮助表示赞赏。

代码：

```
Sub Finishing_A59_Filter()
'
' Finishing_A59_Filter Macro

' This macro will activate the A59 and Filter it properly for standard orders
' 

'This macro does not include the VMI's and APS orders in the code
' 
'

Dim Currday As Date

    Currday = Date + 7
    UName = Application.UserName

    Workbooks.Open Filename:="G:\Copy Modified A59 5-19-2009.xlsm", UpdateLinks _
        :=0
    Range("M2").Select
    ActiveCell.Value = Currday

    Columns("Q:Q").Select
    Selection.NumberFormat = "mm/d/yyyy"

    ' Filter the sheet to remove VMI's and APS orders

    ActiveSheet.Range("$A$3:$AA$2941").AutoFilter Field:=23, Criteria1:=Array( _
        "01", "04", "06", "08", "09", "10", "15", "25", "="), Operator:=xlFilterValues

   ' Set the proper date range for the sheet - This needs to be seven days beyond the current date

    ActiveSheet.Range("$A$3:$AA$2941").AutoFilter Field:=17, Criteria1:= _
        "<=Currday", Operator:=xlAnd 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T02:59:54.760

您需要将变量与条件字符串连接起来。

```
ActiveSheet.UsedRange.AutoFilter Field:=17, Criteria1:= _
        "<=" & Currday, Operator:=xlAnd 
```

此外，最好使用“UsedRange”而不是组成一个大范围，因为如果您的数据超出您的任意范围，它就不起作用，如果不这样做，就会浪费资源。

# java - Servlet 过滤器和 OSGi HttpService

> ID：891199
> 
> 赞同：1
> 
> 时间：2009-05-21T02:44:44.510
> 
> 标签：java, http-headers, osgi, servlet-filters

我正在开发一个基于 OSGi 的应用程序，该应用程序`org.osgi.service.http.HttpService`不支持使用 Servlet 过滤器。

在我意识到我无法使用 Servlet 过滤器之前，我计划应用几个现有的过滤器。这些过滤器将适当的 HTTP 标头设置为：

*   防止缓存响应
*   `X-UA-Compatible`使用标题控制 IE8 中的呈现

我在这里有什么选择？我不想使用`meta`元素来控制缓存，因为[这种技术是不可靠的](http://www.mnot.net/cache_docs/#META)。使用`meta`元素来设置`X-UA-Compatible`标题可能是可以接受的，但我仍然对替代方法感兴趣。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-22T17:58:04.840

您可以使用 dm Server 将 WAR 文件直接部署到 OSGi 环境中。在 dm Server 中运行的 WAR 是完整的 WAR 和完整的捆绑包。

正在开展工作以标准化在 OSGi 上成为 WAR 的含义。该规范称为 OSGi Web 容器。工作进展非常顺利，我是一个很好的方法以及它的参考实现。我将在 4-5 天内提供 RI 的 alpha 代码以及详细说明用法的博客条目。关注 blog.springsource.com 上的 SpringSource 博客。

不幸的是，我无法链接到 dm 服务器，因为我是新用户 :(

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T03:05:36.510

这个[添加 servlet 过滤器支持的问题](https://bugs.eclipse.org/bugs/show_bug.cgi?id=128068)提供了一些潜在的解决方法。

还：

> [Pax Web](http://wiki.ops4j.org/display/paxweb/Pax+Web) [扩展] OSGi Http 服务，提供更好的 servlet 支持、过滤器、侦听器、错误页面和 JSP 等，以满足最新版本的 Servlet 规范。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-08-02T19:34:45.337

从 Eclipse 3.5 开始，您可以使用 `org.eclipse.equinox.http.registry.filters`扩展点定义过滤器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-26T17:38:43.743

Pax web 还不能在非 OSGI servlet 引擎（桥接模式）中工作。[Apache Felix 在http://felix.apache.org](http://felix.apache.org)上有一个很好的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-26T00:02:53.763

关于 Pax Web：

paxweb/Examples 页面上的示例不起作用。

例如，我输入以下命令：

pax-run scan-file:jar:mvn:org.ops4j.pax.web.samples/provision!/sample-helloworld-wc.bundles

而不是将我的浏览器指向：

[http://localhost:8080/helloworld/wc](http://localhost:8080/helloworld/wc)

结果：

未找到错误404

此外，从文档中我不清楚 Pax Web 是否可以在非 OSGI servlet 引擎（例如 WebLogic、WebSphere）中工作。

# php - 使用多个分隔符将文本拆分为修剪值数组

> ID：891204
> 
> 赞同：0
> 
> 时间：2009-05-21T02:47:34.677
> 
> 标签：php, arrays, string, preg-split, csv

我有一组字符串，我需要将它们分块成一个数组。字符串需要在`/`、`,`、`with`或上分割`&`。

不幸的是，一个字符串可能包含两个需要拆分的字符串，所以我不能使用`split()`or `explode()`。

例如，一个字符串可以说`first past/ going beyond & then turn`，所以我试图得到一个返回的数组：

```
array('first past', 'going beyond', 'then turn') 
```

我目前使用的代码是

```
$splittersArray=array('/', ',', ' with ','&');
foreach($splittersArray as $splitter){
    if(strpos($string, $splitter)){
        $splitString = split($splitter, $string);
        foreach($splitString as $split){ 
```

我似乎无法在 PHP 中找到允许我执行此操作的函数。`foreach()`我是否需要将绳子传回漏斗顶部，并在绳子一次又一次地分裂后继续穿过？

这似乎不是很有效。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-21T03:01:09.453

使用正则表达式和[preg_split](http://www.php.net/manual/en/function.preg-split.php)。

在您提到的情况下，您将获得拆分数组：

```
$splitString = preg_split('/(\/|\,| with |\&/)/', $string); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-03-10T14:57:50.850

为了简洁地编写模式，请为单字符分隔符使用字符类，并将`with`分隔符作为值添加到管道之后（正则表达式中的“或”字符）。在分隔符组的任一侧允许零个或多个空格，以便不需要修剪输出中的值。

我正在使用`PREG_SPLIT_NO_EMPTY`函数标志，以防分隔符出现在字符串的开头或结尾，并且您不希望生成任何空元素。

代码：（[演示](https://3v4l.org/TdHPY)）

```
$string = 'first past/ going beyond & then turn with everyone';

var_export(
    preg_split('~ ?([/,&]|with) ?~', $string, 0, PREG_SPLIT_NO_EMPTY)
); 
```

输出：

```
array (
  0 => 'first past',
  1 => 'going beyond',
  2 => 'then turn',
  3 => 'everyone',
) 
```

# c# - C# 中的异常有多昂贵？

> ID：891217
> 
> 赞同：82
> 
> 时间：2009-05-21T02:57:26.403
> 
> 标签：c#, exception

C# 中的异常有多昂贵？只要堆栈不深，它们似乎就不会非常昂贵。但是我读过相互矛盾的报告。

有没有没有被反驳的权威报告？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2011-01-10T14:47:33.980

读到异常在性能方面的代价很高后，我编写了一个简单的测量程序，与[Jon Skeet 几年前发表](http://yoda.arachsys.com/csharp/exceptions.html)的非常相似。我在这里提到这一点主要是为了提供更新的数字。

程序处理 100 万个异常用时不到 29914 毫秒，相当于**每毫秒 33 个异常**。这足以让异常成为大多数情况下返回代码的可行替代方案。

但是请注意，使用返回码而不是异常，相同的程序运行不到一毫秒，这意味着**异常至少比返回码慢 30,000 倍**。正如[Rico Mariani](http://blogs.msdn.com/b/ricom/archive/2006/09/25/771142.aspx)所强调的，这些数字也是最低数字。在实践中，抛出和捕获异常会花费更多时间。

在具有 Intel Core2 Duo T8100 @ 2,1 GHz 的笔记本电脑上测量，在发布版本中**未运行**.NET 4.0 （这会使其速度变慢）。

这是我的测试代码：

```
static void Main(string[] args)
{
    int iterations = 1000000;
    Console.WriteLine("Starting " + iterations.ToString() + " iterations...\n");

    var stopwatch = new Stopwatch();

    // Test exceptions
    stopwatch.Reset();
    stopwatch.Start();
    for (int i = 1; i <= iterations; i++)
    {
        try
        {
            TestExceptions();
        }
        catch (Exception)
        {
            // Do nothing
        }
    }
    stopwatch.Stop();
    Console.WriteLine("Exceptions: " + stopwatch.ElapsedMilliseconds.ToString() + " ms");

    // Test return codes
    stopwatch.Reset();
    stopwatch.Start();
    int retcode;
    for (int i = 1; i <= iterations; i++)
    {
        retcode = TestReturnCodes();
        if (retcode == 1)
        {
            // Do nothing
        }
    }
    stopwatch.Stop();
    Console.WriteLine("Return codes: " + stopwatch.ElapsedMilliseconds.ToString() + " ms");

    Console.WriteLine("\nFinished.");
    Console.ReadKey();
}

static void TestExceptions()
{
    throw new Exception("Failed");
}

static int TestReturnCodes()
{
    return 1;
} 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-05-21T03:01:25.537

我想我在阵营中，如果异常的性能影响您的应用程序，那么您将抛出***太多***异常。异常应该针对异常情况，而不是常规错误处理。

也就是说，我对如何处理异常的回忆基本上是在堆栈中查找与抛出的异常类型匹配的 catch 语句。因此，性能将受到您从 catch 的深度以及您拥有多少 catch 语句的最大影响。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-02-21T06:53:46.823

In my case, exceptions were *very* expensive. I rewrote this:

```
public BlockTemplate this[int x,int y, int z]
{
    get
    {
        try
        {
            return Data.BlockTemplate[World[Center.X + x, Center.Y + y, Center.Z + z]];
        }
        catch(IndexOutOfRangeException e)
        {
            return Data.BlockTemplate[BlockType.Air];
        }
    }
} 
```

Into this:

```
public BlockTemplate this[int x,int y, int z]
{
    get
    {
        int ix = Center.X + x;
        int iy = Center.Y + y;
        int iz = Center.Z + z;
        if (ix < 0 || ix >= World.GetLength(0)
            || iy < 0 || iy >= World.GetLength(1)
            || iz < 0 || iz >= World.GetLength(2)) 
            return Data.BlockTemplate[BlockType.Air];
        return Data.BlockTemplate[World[ix, iy, iz]];
    }
} 
```

And I noticed a good speed increase of about 30 seconds. This function gets called at least 32,000 times at startup. The code isn't as clear as to what the intention is, but the cost savings were huge.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-05-15T21:42:59.363

我进行了自己的测量，以了解异常影响的严重程度。我没有尝试测量抛出/捕获异常的绝对时间。我最感兴趣的是如果每次传递都抛出异常，循环会变慢多少。测量代码如下所示：

```
for(; ; ) {
   iValue = Level1(iValue);
   lCounter += 1;
   if(DateTime.Now >= sFinish)
       break;
} 
```

对比

```
for(; ; ) {
   try {
      iValue = Level3Throw(iValue);
   }
   catch(InvalidOperationException) {
      iValue += 3;
   }
   lCounter += 1;
   if(DateTime.Now >= sFinish)
       break;
} 
```

相差20倍。第二个片段慢了 20 倍。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-21T03:06:31.703

C# 中的准系统异常对象相当轻量级；`InnerException`当对象树变得太深时，通常是封装的能力使它变得沉重。

至于最终报告，我不知道有什么，尽管粗略的[dotTrace](https://en.wikipedia.org/wiki/JetBrains#ReSharper_Ultimate)配置文件（或任何其他分析器）用于内存消耗和速度将相当容易做到。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-09-17T14:46:41.157

仅提供我个人的经验：

我正在开发一个使用[Newtonsoft](https://www.newtonsoft.com/json) ( [Json.NET](https://www.newtonsoft.com/json/help/html/Introduction.htm) ) 解析 JSON 文件并从中提取数据的程序。

我重写了这个：

### 选项 1，有例外

```
try
{
    name = rawPropWithChildren.Value["title"].ToString();
}
catch(System.NullReferenceException)
{
    name = rawPropWithChildren.Name;
} 
```

对此：

### 选项 2，无一例外

```
if(rawPropWithChildren.Value["title"] == null)
{
    name = rawPropWithChildren.Name;
}
else
{
    name = rawPropWithChildren.Value["title"].ToString();
} 
```

当然，您并没有真正的上下文来判断它，但这是我的结果（*在调试模式下*）：

*   选项 1，有例外。 **38.50 秒**

*   选项 2，无一例外。 **06.48 秒**

为了提供一点上下文，我正在使用数千个可以为空的 JSON 属性。异常被抛出太多，比如可能在 15% 的执行时间内。嗯，不是很精确，但他们被扔了太多次。

我想解决这个问题，所以我改变了我的代码，我不明白为什么执行时间这么快。那是因为我的异常处理能力很差。

所以，我从中学到了什么：我只需要在特定情况下使用异常，并且对于无法用简单的条件语句进行测试的事情。它们也必须尽可能少地扔掉。

这对你来说是一个随机的故事，但我想从现在开始在我的代码中使用异常之前我肯定会三思而后行！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-21T03:18:31.633

异常对性能的影响似乎是在生成异常对象时（尽管在 90% 的情况下太小而不会引起任何关注）。因此，建议分析您的代码 - 如果异常**导致**性能下降，您编写一个不使用异常的新的高性能方法。（想到的一个例子是（引入 TryParse 以克服使用异常的 Parse 的性能问题）

也就是说，大多数情况下的异常在大多数情况下[不会导致显着的性能](http://www.codeproject.com/KB/exception/ExceptionPerformance.aspx)损失- 所以[MS 设计指南](http://blogs.msdn.com/kcwalina/archive/2005/03/16/396787.aspx)是通过抛出异常来报告失败

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-09-19T00:27:55.780

我最近在求和循环中测量了 C# 异常（抛出和捕获），每次加法都会引发算术溢出。在四核笔记本电脑上，算术溢出的抛出和捕获大约是 8.5 微秒 = 117 KiloExceptions/秒。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-07-20T22:11:36.050

**TLDR；**

以微秒为单位（但取决于堆栈深度）： [![在此处输入图像描述](https://i.stack.imgur.com/Cx0w8.png)](https://i.stack.imgur.com/Cx0w8.png) 本文中的图片，他发布了测试代码：[.Net 异常性能](https://gregit.wordpress.com/2015/10/04/net-exceptions-performance/)

*他们是免费的吗？* 不。

*你通常得到你付出的代价吗？* 大多数时候是的。

*他们慢吗？* 答案应该始终是“与什么相比？” 它们可能比任何连接的服务或数据呼叫快几个数量级。

**解释：**

我对这个问题的起源很感兴趣。据我所知，这是对微不足道的 c++ 异常的厌恶。.Net 异常包含丰富的信息，并允许整洁的代码，而无需过多检查成功和日志记录。[我在另一个答案](https://stackoverflow.com/a/46982339/852208)中解释了他们的大部分好处。

在 20 年的编程生涯中，我从来没有为了让事情变得更快而取消投掷或接球（并不是说我不能，只是说有较低的悬而未决的果实，之后没有人抱怨）。

有一个带有竞争答案的单独问题，一个是捕获异常（内置方法没有提供“尝试”方法），另一个是避免异常。

我决定对两者进行正面的性能比较，对于较少的列数，非异常版本更快，但异常版本的扩展性更好，最终优于避免异常的版本：

[![在此处输入图像描述](https://i.stack.imgur.com/o0nni.png)](https://i.stack.imgur.com/o0nni.png)

该测试的 linqpad 代码如下（包括图形渲染）。

不过，这里的重点是，“例外很慢”的想法*比什么慢*？如果一个深度堆栈异常花费 500 微秒，那么它是否响应一个独特的约束而发生，该约束需要 3000 微秒来创建数据库？无论如何，这表明出于性能原因而普遍避免异常不一定会产生更高性能的代码。

性能测试代码：

```
void Main()
{
    var loopResults = new List<Results>();
    var exceptionResults = new List<Results>();
    var totalRuns = 10000;
    for (var colCount = 1; colCount < 20; colCount++)
    {
        using (var conn = new SqlConnection(@"Data Source=(localdb)\MSSQLLocalDb;Initial Catalog=master;Integrated Security=True;"))
        {
            conn.Open();

            //create a dummy table where we can control the total columns
            var columns = String.Join(",",
                (new int[colCount]).Select((item, i) => $"'{i}' as col{i}")
            );
            var sql = $"select {columns} into #dummyTable";
            var cmd = new SqlCommand(sql,conn);
            cmd.ExecuteNonQuery();

            var cmd2 = new SqlCommand("select * from #dummyTable", conn);

            var reader = cmd2.ExecuteReader();
            reader.Read();

            Func<Func<IDataRecord, String, Boolean>, List<Results>> test = funcToTest =>
            {
                var results = new List<Results>();
                Random r = new Random();
                for (var faultRate = 0.1; faultRate <= 0.5; faultRate += 0.1)
                {
                    Stopwatch stopwatch = new Stopwatch();
                    stopwatch.Start();
                    var faultCount=0;
                    for (var testRun = 0; testRun < totalRuns; testRun++)
                    {
                        if (r.NextDouble() <= faultRate)
                        {
                            faultCount++;
                            if(funcToTest(reader, "colDNE"))
                                throw new ApplicationException("Should have thrown false");
                        }
                        else
                        {
                            for (var col = 0; col < colCount; col++)
                            {
                                if(!funcToTest(reader, $"col{col}"))
                                    throw new ApplicationException("Should have thrown true");
                            }
                        }
                    }
                    stopwatch.Stop();
                    results.Add(new UserQuery.Results{
                        ColumnCount = colCount,
                        TargetNotFoundRate = faultRate,
                        NotFoundRate = faultCount * 1.0f / totalRuns,
                        TotalTime=stopwatch.Elapsed
                    });
                }
                return results;
            };
            loopResults.AddRange(test(HasColumnLoop));

            exceptionResults.AddRange(test(HasColumnException));

        }

    }
    "Loop".Dump();
    loopResults.Dump();

    "Exception".Dump();
    exceptionResults.Dump();

    var combinedResults = loopResults.Join(exceptionResults,l => l.ResultKey, e=> e.ResultKey, (l, e) => new{ResultKey = l.ResultKey, LoopResult=l.TotalTime, ExceptionResult=e.TotalTime});
    combinedResults.Dump();
    combinedResults
        .Chart(r => r.ResultKey, r => r.LoopResult.Milliseconds * 1.0 / totalRuns, LINQPad.Util.SeriesType.Line)
        .AddYSeries(r => r.ExceptionResult.Milliseconds * 1.0 / totalRuns, LINQPad.Util.SeriesType.Line)
        .Dump();
}
public static bool HasColumnLoop(IDataRecord dr, string columnName)
{
    for (int i = 0; i < dr.FieldCount; i++)
    {
        if (dr.GetName(i).Equals(columnName, StringComparison.InvariantCultureIgnoreCase))
            return true;
    }
    return false;
}

public static bool HasColumnException(IDataRecord r, string columnName)
{
    try
    {
        return r.GetOrdinal(columnName) >= 0;
    }
    catch (IndexOutOfRangeException)
    {
        return false;
    }
}

public class Results
{
    public double NotFoundRate { get; set; }
    public double TargetNotFoundRate { get; set; }
    public int ColumnCount { get; set; }
    public double ResultKey {get => ColumnCount + TargetNotFoundRate;}
    public TimeSpan TotalTime { get; set; }

} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-10-25T09:46:27.740

异常很昂贵，但是*当*您想在*异常*和*返回*代码之间进行选择时，它还有更多。

从历史上讲，这个论点是：异常确保代码被迫处理这种情况，而返回代码可以被忽略。我从不赞成这些论点，因为没有程序员会故意忽略和破坏他们的代码——尤其是一个好的测试团队/或者一个写得很好的测试用例绝对不会忽略返回代码。

从现代编程实践的角度来看，管理异常不仅需要考虑成本，还需要考虑它们的可行性。

### 第一的

由于大多数前端将与引发异常的 API 断开连接。例如，使用[REST](https://en.wikipedia.org/wiki/Representational_state_transfer) API 的移动应用程序。相同的 API 也可用于基于[Angular](https://en.wikipedia.org/wiki/Angular_(web_framework))的 Web 前端。

任何一种情况都会更喜欢*返回码*而不是异常。

### 第二

如今，黑客随机尝试破坏所有网络实用程序。在这种情况下，如果他们不断攻击您的应用程序的登录 API，并且如果应用程序不断抛出异常，那么您最终将每天处理数千个异常。当然，许多人会说防火墙会处理此类攻击。然而，并非所有人都花钱来管理专用防火墙或昂贵的反垃圾邮件服务。最好为这些场景准备好您的代码。

# c# - 检测 XML 的更好方法？

> ID：891223
> 
> 赞同：24
> 
> 时间：2009-05-21T03:00:28.003
> 
> 标签：c#, xml, optimization, xml-parsing

目前，我有以下 c# 代码从文本中提取值。如果它是 XML，我想要其中的值 - 否则，如果它不是 XML，它可以只返回文本本身。

```
String data = "..."
try
{
    return XElement.Parse(data).Value;
}
catch (System.Xml.XmlException)
{
    return data;
} 
```

我知道异常在 C# 中很昂贵，所以我想知道是否有更好的方法来确定我正在处理的文本是否是 xml？

我想到了正则表达式测试，但我不认为这是一个更便宜的选择。请注意，我要求一种*更便宜*的方法来做到这一点。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-21T03:11:34.347

您可以对 < 进行初步检查，因为所有 XML 都必须以 1 开头，而大部分非 XML 不会以 1 开头。

（徒手书写。）

```
// Has to have length to be XML
if (!string.IsNullOrEmpty(data))
{
    // If it starts with a < after trimming then it probably is XML
    // Need to do an empty check again in case the string is all white space.
    var trimmedData = data.TrimStart();
    if (string.IsNullOrEmpty(trimmedData))
    {
       return data;
    }

    if (trimmedData[0] == '<')
    {
        try
        {
            return XElement.Parse(data).Value;
        }
        catch (System.Xml.XmlException)
        {
            return data;
        }
    }
}
else
{
    return data;
} 
```

我最初使用的是正则表达式，但 Trim()[0] 与该正则表达式的作用相同。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-21T04:35:51.603

下面给出的代码将匹配以下所有 xml 格式：

```
<text />                             
<text/>                              
<text   />                           
<text>xml data1</text>               
<text attr='2'>data2</text>");
<text attr='2' attr='4' >data3 </text>
<text attr>data4</text>              
<text attr1 attr2>data5</text> 
```

这是代码：

```
public class XmlExpresssion
{
    // EXPLANATION OF EXPRESSION
    // <        :   \<{1}
    // text     :   (?<xmlTag>\w+)  : xmlTag is a backreference so that the start and end tags match
    // >        :   >{1}
    // xml data :   (?<data>.*)     : data is a backreference used for the regex to return the element data      
    // </       :   <{1}/{1}
    // text     :   \k<xmlTag>
    // >        :   >{1}
    // (\w|\W)* :   Matches attributes if any

    // Sample match and pattern egs
    // Just to show how I incrementally made the patterns so that the final pattern is well-understood
    // <text>data</text>
    // @"^\<{1}(?<xmlTag>\w+)\>{1}.*\<{1}/{1}\k<xmlTag>\>{1}$";

    //<text />
    // @"^\<{1}(?<xmlTag>\w+)\s*/{1}\>{1}$";

    //<text>data</text> or <text />
    // @"^\<{1}(?<xmlTag>\w+)((\>{1}.*\<{1}/{1}\k<xmlTag>)|(\s*/{1}))\>{1}$";

    //<text>data</text> or <text /> or <text attr='2'>xml data</text> or <text attr='2' attr2 >data</text>
    // @"^\<{1}(?<xmlTag>\w+)(((\w|\W)*\>{1}(?<data>.*)\<{1}/{1}\k<xmlTag>)|(\s*/{1}))\>{1}$";

    private const string XML_PATTERN = @"^\<{1}(?<xmlTag>\w+)(((\w|\W)*\>{1}(?<data>.*)\<{1}/{1}\k<xmlTag>)|(\s*/{1}))\>{1}$";

    // Checks if the string is in xml format
    private static bool IsXml(string value)
    {
        return Regex.IsMatch(value, XML_PATTERN);
    }

    /// <summary>
    /// Assigns the element value to result if the string is xml
    /// </summary>
    /// <returns>true if success, false otherwise</returns>
    public static bool TryParse(string s, out string result)
    {
        if (XmlExpresssion.IsXml(s))
        {
            Regex r = new Regex(XML_PATTERN, RegexOptions.Compiled);
            result = r.Match(s).Result("${data}");
            return true;
        }
        else
        {
            result = null;
            return false;
        }
    }

} 
```

调用代码：

```
if (!XmlExpresssion.TryParse(s, out result)) 
    result = s;
Console.WriteLine(result); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-21T17:28:31.897

**更新：（**原帖在下面）科林有一个绝妙的主意，将正则表达式实例移到调用之外，以便它们只创建一次。继承人的新程序：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Xml.Linq;
using System.Diagnostics;
using System.Text.RegularExpressions;

namespace ConsoleApplication3
{
    delegate String xmltestFunc(String data);

    class Program
    {
        static readonly int iterations = 1000000;

        private static void benchmark(xmltestFunc func, String data, String expectedResult)
        {
            if (!func(data).Equals(expectedResult))
            {
                Console.WriteLine(data + ": fail");
                return;
            }
            Stopwatch sw = Stopwatch.StartNew();
            for (int i = 0; i < iterations; ++i)
                func(data);
            sw.Stop();
            Console.WriteLine(data + ": " + (float)((float)sw.ElapsedMilliseconds / 1000));
        }

        static void Main(string[] args)
        {
            benchmark(xmltest1, "<tag>base</tag>", "base");
            benchmark(xmltest1, " <tag>base</tag> ", "base");
            benchmark(xmltest1, "base", "base");
            benchmark(xmltest2, "<tag>ColinBurnett</tag>", "ColinBurnett");
            benchmark(xmltest2, " <tag>ColinBurnett</tag> ", "ColinBurnett");
            benchmark(xmltest2, "ColinBurnett", "ColinBurnett");
            benchmark(xmltest3, "<tag>Si</tag>", "Si");
            benchmark(xmltest3, " <tag>Si</tag> ", "Si" );
            benchmark(xmltest3, "Si", "Si");
            benchmark(xmltest4, "<tag>RashmiPandit</tag>", "RashmiPandit");
            benchmark(xmltest4, " <tag>RashmiPandit</tag> ", "RashmiPandit");
            benchmark(xmltest4, "RashmiPandit", "RashmiPandit");
            benchmark(xmltest5, "<tag>Custom</tag>", "Custom");
            benchmark(xmltest5, " <tag>Custom</tag> ", "Custom");
            benchmark(xmltest5, "Custom", "Custom");

            // "press any key to continue"
            Console.WriteLine("Done.");
            Console.ReadLine();
        }

        public static String xmltest1(String data)
        {
            try
            {
                return XElement.Parse(data).Value;
            }
            catch (System.Xml.XmlException)
            {
                return data;
            }
        }

        static Regex xmltest2regex = new Regex("^[ \t\r\n]*<");
        public static String xmltest2(String data)
        {
            // Has to have length to be XML
            if (!string.IsNullOrEmpty(data))
            {
                // If it starts with a < then it probably is XML
                // But also cover the case where there is indeterminate whitespace before the <
                if (data[0] == '<' || xmltest2regex.Match(data).Success)
                {
                    try
                    {
                        return XElement.Parse(data).Value;
                    }
                    catch (System.Xml.XmlException)
                    {
                        return data;
                    }
                }
            }
           return data;
        }

        static Regex xmltest3regex = new Regex(@"<(?<tag>\w*)>(?<text>.*)</\k<tag>>");
        public static String xmltest3(String data)
        {
            Match m = xmltest3regex.Match(data);
            if (m.Success)
            {
                GroupCollection gc = m.Groups;
                if (gc.Count > 0)
                {
                    return gc["text"].Value;
                }
            }
            return data;
        }

        public static String xmltest4(String data)
        {
            String result;
            if (!XmlExpresssion.TryParse(data, out result))
                result = data;

            return result;
        }

        static Regex xmltest5regex = new Regex("^[ \t\r\n]*<");
        public static String xmltest5(String data)
        {
            // Has to have length to be XML
            if (!string.IsNullOrEmpty(data))
            {
                // If it starts with a < then it probably is XML
                // But also cover the case where there is indeterminate whitespace before the <
                if (data[0] == '<' || data.Trim()[0] == '<' || xmltest5regex.Match(data).Success)
                {
                    try
                    {
                        return XElement.Parse(data).Value;
                    }
                    catch (System.Xml.XmlException)
                    {
                        return data;
                    }
                }
            }
            return data;
        }
    }

    public class XmlExpresssion
    {
        // EXPLANATION OF EXPRESSION
        // <        :   \<{1}
        // text     :   (?<xmlTag>\w+)  : xmlTag is a backreference so that the start and end tags match
        // >        :   >{1}
        // xml data :   (?<data>.*)     : data is a backreference used for the regex to return the element data      
        // </       :   <{1}/{1}
        // text     :   \k<xmlTag>
        // >        :   >{1}
        // (\w|\W)* :   Matches attributes if any

        // Sample match and pattern egs
        // Just to show how I incrementally made the patterns so that the final pattern is well-understood
        // <text>data</text>
        // @"^\<{1}(?<xmlTag>\w+)\>{1}.*\<{1}/{1}\k<xmlTag>\>{1}$";

        //<text />
        // @"^\<{1}(?<xmlTag>\w+)\s*/{1}\>{1}$";

        //<text>data</text> or <text />
        // @"^\<{1}(?<xmlTag>\w+)((\>{1}.*\<{1}/{1}\k<xmlTag>)|(\s*/{1}))\>{1}$";

        //<text>data</text> or <text /> or <text attr='2'>xml data</text> or <text attr='2' attr2 >data</text>
        // @"^\<{1}(?<xmlTag>\w+)(((\w|\W)*\>{1}(?<data>.*)\<{1}/{1}\k<xmlTag>)|(\s*/{1}))\>{1}$";

        private static string XML_PATTERN = @"^\<{1}(?<xmlTag>\w+)(((\w|\W)*\>{1}(?<data>.*)\<{1}/{1}\k<xmlTag>)|(\s*/{1}))\>{1}$";
        private static Regex regex = new Regex(XML_PATTERN, RegexOptions.Compiled);

        // Checks if the string is in xml format
        private static bool IsXml(string value)
        {
            return regex.IsMatch(value);
        }

        /// <summary>
        /// Assigns the element value to result if the string is xml
        /// </summary>
        /// <returns>true if success, false otherwise</returns>
        public static bool TryParse(string s, out string result)
        {
            if (XmlExpresssion.IsXml(s))
            {
                result = regex.Match(s).Result("${data}");
                return true;
            }
            else
            {
                result = null;
                return false;
            }
        }

    }

} 
```

以下是新结果：

```
<tag>base</tag>: 3.667
 <tag>base</tag> : 3.707
base: 40.737
<tag>ColinBurnett</tag>: 3.707
 <tag>ColinBurnett</tag> : 4.784
ColinBurnett: 0.413
<tag>Si</tag>: 2.016
 <tag>Si</tag> : 2.141
Si: 0.087
<tag>RashmiPandit</tag>: 12.305
 <tag>RashmiPandit</tag> : fail
RashmiPandit: 0.131
<tag>Custom</tag>: 3.761
 <tag>Custom</tag> : 3.866
Custom: 0.329
Done. 
```

你有它。预编译的正则表达式是要走的路，而且启动效率很高。

* * *

* * *

* * *

（原帖）

我拼凑了以下程序来对为此答案提供的代码示例进行基准测试，以演示我的帖子的推理以及评估私有答案的速度。

事不宜迟，程序如下。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Xml.Linq;
using System.Diagnostics;
using System.Text.RegularExpressions;

namespace ConsoleApplication3
{
    delegate String xmltestFunc(String data);

    class Program
    {
        static readonly int iterations = 1000000;

        private static void benchmark(xmltestFunc func, String data, String expectedResult)
        {
            if (!func(data).Equals(expectedResult))
            {
                Console.WriteLine(data + ": fail");
                return;
            }
            Stopwatch sw = Stopwatch.StartNew();
            for (int i = 0; i < iterations; ++i)
                func(data);
            sw.Stop();
            Console.WriteLine(data + ": " + (float)((float)sw.ElapsedMilliseconds / 1000));
        }

        static void Main(string[] args)
        {
            benchmark(xmltest1, "<tag>base</tag>", "base");
            benchmark(xmltest1, " <tag>base</tag> ", "base");
            benchmark(xmltest1, "base", "base");
            benchmark(xmltest2, "<tag>ColinBurnett</tag>", "ColinBurnett");
            benchmark(xmltest2, " <tag>ColinBurnett</tag> ", "ColinBurnett");
            benchmark(xmltest2, "ColinBurnett", "ColinBurnett");
            benchmark(xmltest3, "<tag>Si</tag>", "Si");
            benchmark(xmltest3, " <tag>Si</tag> ", "Si" );
            benchmark(xmltest3, "Si", "Si");
            benchmark(xmltest4, "<tag>RashmiPandit</tag>", "RashmiPandit");
            benchmark(xmltest4, " <tag>RashmiPandit</tag> ", "RashmiPandit");
            benchmark(xmltest4, "RashmiPandit", "RashmiPandit");

            // "press any key to continue"
            Console.WriteLine("Done.");
            Console.ReadLine();
        }

        public static String xmltest1(String data)
        {
            try
            {
                return XElement.Parse(data).Value;
            }
            catch (System.Xml.XmlException)
            {
                return data;
            }
        }

        public static String xmltest2(String data)
        {
            // Has to have length to be XML
            if (!string.IsNullOrEmpty(data))
            {
                // If it starts with a < then it probably is XML
                // But also cover the case where there is indeterminate whitespace before the <
                if (data[0] == '<' || new Regex("^[ \t\r\n]*<").Match(data).Success)
                {
                    try
                    {
                        return XElement.Parse(data).Value;
                    }
                    catch (System.Xml.XmlException)
                    {
                        return data;
                    }
                }
            }
           return data;
        }

        public static String xmltest3(String data)
        {
            Regex regex = new Regex(@"<(?<tag>\w*)>(?<text>.*)</\k<tag>>");
            Match m = regex.Match(data);
            if (m.Success)
            {
                GroupCollection gc = m.Groups;
                if (gc.Count > 0)
                {
                    return gc["text"].Value;
                }
            }
            return data;
        }

        public static String xmltest4(String data)
        {
            String result;
            if (!XmlExpresssion.TryParse(data, out result))
                result = data;

            return result;
        }

    }

    public class XmlExpresssion
    {
        // EXPLANATION OF EXPRESSION
        // <        :   \<{1}
        // text     :   (?<xmlTag>\w+)  : xmlTag is a backreference so that the start and end tags match
        // >        :   >{1}
        // xml data :   (?<data>.*)     : data is a backreference used for the regex to return the element data      
        // </       :   <{1}/{1}
        // text     :   \k<xmlTag>
        // >        :   >{1}
        // (\w|\W)* :   Matches attributes if any

        // Sample match and pattern egs
        // Just to show how I incrementally made the patterns so that the final pattern is well-understood
        // <text>data</text>
        // @"^\<{1}(?<xmlTag>\w+)\>{1}.*\<{1}/{1}\k<xmlTag>\>{1}$";

        //<text />
        // @"^\<{1}(?<xmlTag>\w+)\s*/{1}\>{1}$";

        //<text>data</text> or <text />
        // @"^\<{1}(?<xmlTag>\w+)((\>{1}.*\<{1}/{1}\k<xmlTag>)|(\s*/{1}))\>{1}$";

        //<text>data</text> or <text /> or <text attr='2'>xml data</text> or <text attr='2' attr2 >data</text>
        // @"^\<{1}(?<xmlTag>\w+)(((\w|\W)*\>{1}(?<data>.*)\<{1}/{1}\k<xmlTag>)|(\s*/{1}))\>{1}$";

        private const string XML_PATTERN = @"^\<{1}(?<xmlTag>\w+)(((\w|\W)*\>{1}(?<data>.*)\<{1}/{1}\k<xmlTag>)|(\s*/{1}))\>{1}$";

        // Checks if the string is in xml format
        private static bool IsXml(string value)
        {
            return Regex.IsMatch(value, XML_PATTERN);
        }

        /// <summary>
        /// Assigns the element value to result if the string is xml
        /// </summary>
        /// <returns>true if success, false otherwise</returns>
        public static bool TryParse(string s, out string result)
        {
            if (XmlExpresssion.IsXml(s))
            {
                Regex r = new Regex(XML_PATTERN, RegexOptions.Compiled);
                result = r.Match(s).Result("${data}");
                return true;
            }
            else
            {
                result = null;
                return false;
            }
        }

    }

} 
```

这是结果。每一个都被执行了 100 万次。

```
<tag>base</tag>: 3.531
 <tag>base</tag> : 3.624
base: 41.422
<tag>ColinBurnett</tag>: 3.622
 <tag>ColinBurnett</tag> : 16.467
ColinBurnett: 7.995
<tag>Si</tag>: 19.014
 <tag>Si</tag> : 19.201
Si: 15.567 
```

测试 4 耗时太长，因为 30 分钟后它被认为太慢了。为了证明它有多慢，这里是同一个测试只运行了 1000 次。

```
<tag>base</tag>: 0.004
 <tag>base</tag> : 0.004
base: 0.047
<tag>ColinBurnett</tag>: 0.003
 <tag>ColinBurnett</tag> : 0.016
ColinBurnett: 0.008
<tag>Si</tag>: 0.021
 <tag>Si</tag> : 0.017
Si: 0.014
<tag>RashmiPandit</tag>: 3.456
 <tag>RashmiPandit</tag> : fail
RashmiPandit: 0
Done. 
```

推断一百万次处决，将需要 3456 秒，或仅超过 57 分钟。

这是一个很好的例子，说明如果您正在寻找高效的代码，为什么复杂的正则表达式不是一个好主意。然而，它表明在某些情况下，简单的正则表达式仍然是一个很好的答案 - 即 colinBurnett 答案中 xml 的小“预测试”创建了一个可能更昂贵的基本案例，（正则表达式是在案例 2 中创建的）但也更短的 else通过避免异常的情况。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-21T03:12:03.237

我发现这是一种完全可以接受的处理您的情况的方式（这可能也是我处理它的方式）。我在 MSDN 中找不到任何类型的“XElement.TryParse(string)”，所以你拥有它的方式就可以了。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-21T08:02:11.650

除了执行 XElement.Parse 之类的操作之外，没有其他方法可以验证文本是否为 XML。例如，如果文本字段中缺少最后一个右尖括号，则它不是有效的 XML，并且您不太可能通过 RegEx 或文本解析发现这一点。RegEx 解析很可能会错过许多非法字符、非法序列等。

您所能做的就是缩短您的失败案例。

因此，如果您希望看到大量非 XML 数据并且不太预期的情况是 XML，那么使用 RegEx 或子字符串搜索来检测尖括号可能会为您节省一点时间，但我建议这仅在以下情况下**才有**用您正在紧密循环中批量处理大量数据。

相反，如果这是从 Web 表单或 winforms 应用程序解析用户输入的数据，那么我认为支付 Exception 的成本可能比花费开发和测试工作确保您的快捷代码不会产生误报更好/阴性结果。

目前尚不清楚您从哪里获取 XML（文件、流、文本框或其他地方），但请记住空格、注释、字节顺序标记和其他东西可能会妨碍简单的规则，例如“它必须以 < ”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-21T03:23:25.790

为什么正则表达式很贵？它不是用 1 块石头杀死 2 只鸟吗（匹配和解析）？

解析所有元素的简单示例，如果它只是一个元素，则更容易！

```
Regex regex = new Regex(@"<(?<tag>\w*)>(?<text>.*)</\k<tag>>");
MatchCollection matches = regex.Matches(data);
foreach (Match match in matches)
{
    GroupCollection groups = match.Groups;
    string name = groups["tag"].Value;
    string value = groups["text"].Value;
    ...
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-06-30T11:07:32.593

正如@JustEngland 在评论异常中所指出的那样，异常并不昂贵，调试器拦截它们可能需要时间，但通常它们表现良好且实践良好。请参阅[C# 中的异常有多昂贵？](https://stackoverflow.com/q/891217/350188).

更好的方法是滚动您自己的 TryParse 样式函数：

```
[System.Diagnostics.DebuggerNonUserCode]
static class MyXElement
{
    public static bool TryParse(string data, out XElement result)
    {
        try
        {
            result = XElement.Parse(data);
            return true;
        }
        catch (System.Xml.XmlException)
        {
            result = default(XElement);
            return false;
        }
    }
} 
```

DebuggerNonUserCode 属性使调试器跳过捕获的异常以简化您的调试体验。

像这样使用：

```
 static void Main()
    {
        var addressList = "line one~line two~line three~postcode";

        var address = new XElement("Address");
        var addressHtml = "<span>" + addressList.Replace("~", "<br />") + "</span>";

        XElement content;
        if (MyXElement.TryParse(addressHtml, out content))
            address.ReplaceAll(content);
        else
            address.SetValue(addressHtml);

        Console.WriteLine(address.ToString());
        Console.ReadKey();
    }
} 
```

我更愿意为 TryParse 创建一个扩展方法，但是您不能创建一个调用类型而不是实例的静态方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-21T03:12:04.737

线索——所有有效的 xml 必须以`"<?xml`"

您可能必须处理字符集差异，但检查纯 ASCII、utf-8 和 unicode 将覆盖 99.5% 的 xml。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-21T04:04:15.960

如果您将在大多数 xml 没有验证的循环中使用它，那么您建议的方式将会很昂贵，如果是验证 xml，您的代码将像没有异常处理一样工作......所以如果在大多数情况下您的xml 有效，或者您不在循环中使用它，您的代码将正常工作

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-21T07:45:16.253

如果您想知道它是否有效，为什么不使用内置的 .NetFX 对象而不是从头开始编写一个呢？

希望这可以帮助，

账单

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-21T17:58:23.287

Colin Burnett 技术的一种变体：您可以在开头做一个简单的正则表达式来查看文本是否以标签开头，然后尝试解析它。您将处理的以有效元素开头的字符串中可能有 >99% 是 XML。这样，您可以跳过对成熟的有效 XML 的正则表达式处理，也可以在几乎所有情况下跳过基于异常的处理。

类似的东西`^<[^>]+>`可能会奏效。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-06-09T07:29:31.070

我不确定您的要求是否考虑了文件格式，并且由于很久以前就问过这个问题并且我碰巧在搜索类似的东西，我希望您知道什么对我有用，所以如果有人来这里可能有帮助 ：）

我们可以使用 Path.GetExtension(filePath) 并检查它是否是 XML，然后使用它来做任何需要的事情

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2011-09-14T15:21:27.023

怎么样，把你的字符串或对象扔进一个新的 XDocument 或 XElement 中。一切都使用 ToString() 解决。

# ruby-on-rails - 帮助我了解带有 r/t 资产的 Rails 身份验证，例如 swfs

> ID：891227
> 
> 赞同：1
> 
> 时间：2009-05-21T03:01:40.560
> 
> 标签：ruby-on-rails, apache-flex, security, restful-authentication

我是个铁轨菜鸟。我在概念化资产如何在经过身份验证的系统中工作时遇到问题。

到目前为止，我看到的所有教程都谈到将您的 swfs 放入公共文件夹并将它们嵌入到您的视图中。但是，我使用的 swf 是一个 flex gui，只能由通过 restful-authentication 登录的用户使用。我想将 gui 放入公用文件夹将违背拥有身份验证系统的全部目的。

那么每个人都在做什么来限制对这种静态内容的访问呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T03:10:45.847

你要在这里小心一点。如果您的系统得到了适当的保护，拥有 Flex GUI 的未经身份验证的用户将无法使用它，对吗？他还必须登录。那么，有什么理由不让任何用户下载 SWF 文件？

如果仅拥有 SWF 文件就足以“验证”以使用该站点，那么您就有了安全漏洞。考虑

a) 用户可以将下载的 SWF 文件的副本提供给其他人，然后其他人可以使用它，即使他无法从您的站点下载它。

b) Flex GUI 使用 HTTP 与您的站点通信、检索数据和发送命令。任何人都可以编写程序或使用其他方式发送相同的 HTTP 请求，而无需使用 Flex GUI。

# class - C++ 类声明

> ID：891229
> 
> 赞同：-1
> 
> 时间：2009-05-21T03:02:59.870
> 
> 标签：class, declaration

为什么下面的程序给我一个声明错误？我不是在那个特定的行声明它吗？

```
#include <iostream>

#define MILLION 1000000

using namespace std;

class BitInt

{
  public:
    BigInt();

  private:
    int digit_array[MILLION];
    int length;
};

BigInt::BigInt()
{
    int length=0;
    for(int i=0; i<MILLION; i++)
        digit_array[i]=0;
}

int main()
{
    BigInt();

    return 0;
}

bigint.cpp:11: error: ISO C++ forbids declaration of ‘BigInt’ with no type
bigint.cpp:18: error: ‘BigInt’ has not been declared
bigint.cpp:18: error: ISO C++ forbids declaration of ‘BigInt’ with no type
bigint.cpp: In function ‘int BigInt()’:
bigint.cpp:22: error: ‘digit_array’ was not declared in this scope 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T03:05:31.473

您将“BitInt”拼错为“BigInt”：

```
class BitInt 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T03:06:36.400

当我认为它应该是“BigInt”时，该类被命名为“BitInt”。只是一个错字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T04:41:03.620

这是你的问题：

```
int main()
{
    BigInt();     // <--- makes no sense

    return 0;
} 
```

它应该是：

```
int main()
{
    BigInt bigint; // create object of a class

    return 0;
} 
```

你正在声明类**BitInt**并`main`使用**BigInt** - 有一个错字是 Bi **t**另一个 Bi **g**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-04T02:05:04.830

在不相关的注释中，将 MILLION 定义为 1000000 是没有意义的。使用命名常量的原因是为了明确数字的用途并允许您轻松更改它，而不仅仅是让您用文字而不是数字输入数字。

最好调用常量 BIGINT_DIGITS 什么的。

# php - Wordpress php：测试页面是否是父页面的子页面的方法？

> ID：891238
> 
> 赞同：2
> 
> 时间：2009-05-21T03:07:06.290
> 
> 标签：php, wordpress, parent, if-statement

在我的第一个 Wordpress 网站上工作，所以我确信这是一个非常基本的问题。我正在努力编写一个条件 php 语句，该语句在页面是父页面的子页面时执行特定操作。

例如，不只是指定一个页面，如下所示，我想指定所有以“关于我们”页面为父页面的页面：

```
<?php if (is_page('About Us')) echo 'Hello World!'; ?> 
```

我已经尝试过“child_of”函数，但它并不像我希望的那样简单。

当我使用以下内容时，出现语法错误 - 可能只是我不知道如何使用该函数：

```
<?php if (child_of('About Us')) echo 'Hello World!'; ?> 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-06-06T12:26:54.927

将以下函数添加到您的**functions.php**主题文件中：

```
function is_tree($pid) {      // $pid = The ID of the page we're looking for pages underneath
    global $post;         // load details about this page
    $anc = get_post_ancestors( $post->ID );
    foreach($anc as $ancestor) {
        if(is_page() && $ancestor == $pid) {
            return true;
        }
    }
    if(is_page()&&(is_page($pid))) 
               return true;   // we're at the page or at a sub page
    else 
               return false;  // we're elsewhere
}; 
```

然后，您可以使用以下内容：

```
if(is_tree('2')){ // 2 being the parent page id
   // Do something if the parent page of the current page has the id of two
} 
```

参考：[http ://codex.wordpress.org/Conditional_Tags](http://codex.wordpress.org/Conditional_Tags)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T03:24:26.317

您收到错误是因为`child_of()`WordPress 中没有函数之类的东西。

`child_of()`是一种使用 get_pages() 函数进行搜索的方法。

```
$pages = get_pages('child_of=##'); 
```

其中## 是“关于我们”页面的数字 ID（不是名称）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-12-11T08:21:44.140

您想从子页面链接到父页面的简单解决方案；$post->post_parent 保存页面父级的 ID（如果有 1），如果没有，则为 0：

```
<?php
if($post->post_parent !== 0){               
    print '<a href="'.get_permalink($post->post_parent).'">&larr; Back</a>';    
}
?> 
```

因此对于这种情况，您需要更改 if() 以检查 $post->post_parent == $id_of_about_page。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-07T09:18:06.640

这段代码为我解决了这个问题，以防有人想知道一个替代方案：

```
<?php
    global $post;
    if ($post->post_parent == 9) {

        echo 'blah blah';

}; ?> 
```

“9”是父页面的id。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T04:34:07.297

这是对我有用的最终代码 - 不确定这是否是做我想做的事情的正确方法，但会为了任何有我同样问题的人的利益而发布。

我有一组右侧列，每个列都特定于网站的一部分（每个父页面代表网站的一部分）。

我希望父页面和该父页面的所有子页面都拉出相同的特定右侧列。

这是我所做的：

```
<?php 

if (is_page('Page Name 1') || $post->post_parent == '##') {
include (TEMPLATEPATH . '/right-1.php');

} elseif (is_page('Page Name 2') || $post->post_parent == '##') {
include (TEMPLATEPATH . '/right-2.php');

} elseif (is_page('Page Name 3') || $post->post_parent == '##') {
include (TEMPLATEPATH . '/right-3.php');

} elseif (is_page('Page Name 4') || $post->post_parent == '##')
include (TEMPLATEPATH . '/right-4.php');

?> 
```

其中 ## 代表页面的 ID #。

# c++ - C++ CRTP 问题，MSVC 错误 C2039

> ID：891243
> 
> 赞同：4
> 
> 时间：2009-05-21T03:07:38.333
> 
> 标签：c++, crtp

MSVC 2008 不会编译此代码：

```
template <class Derived>
struct B
{
   typename Derived::type t;
};

struct D : B<D>
{
   typedef int type;
};

void main()
{
   D d;
} 
```

我得到的错误是“错误C2039：'type'：不是'D'的成员”。有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-21T03:19:54.970

因为 B 需要 D 的完整类型定义才能自己定义。

您可能期望的内容如下：

```
template <class Derived>
struct B
{
   B() {
     typename Derived::type t;
   }
};

struct D : B<D>
{
   typedef int type;
};

void main()
{
   D d;
} 
```

这是有效的，因为在实例化 D()（以及因此 B()）时，编译器具有类型的完整定义。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-21T03:13:38.803

g++ 给出了更多有用的错误信息：

> g++ -c -o /tmp/to /tmp/t.cpp
> /tmp/t.cpp: 在'B'的实例化中:
> /tmp/t.cpp:8: 从这里实例化
> /tmp/t.cpp:4:错误：无效使用不完整类型“struct D”<br>/tmp/t.cpp:7：错误：“struct D”前向声明<br>/tmp/t.cpp:12：错误：'::main ' 必须返回 'int'

# ajax - 在 cakePHP 中为 ajax 分配选项

> ID：891245
> 
> 赞同：0
> 
> 时间：2009-05-21T03:08:51.187
> 
> 标签：ajax, cakephp, autocomplete

我有一个使用 cakePHP 的 ajax->autoComplete 工作花花公子。现在我想在请求执行后添加我自己的javascript（最好是回调方法）。我知道有[与 ajaxHelper 相关的选项，](http://book.cakephp.org/view/209/AjaxHelper-Options)但我无法弄清楚如何将它们应用于 autoComplete 函数。

我可以`ajax->autoComplete('div', 'url', array('with'=> 'console.log("hello")'))`在第一次发生任何事情之前执行，但是与上述工作相关的其他选项都没有（我认为因为'with'将javascript直接放在地址中，所以很明显它会执行）。我还阅读了[autoComplete API](http://api.cakephp.org/class/ajax-helper#method-AjaxHelperautoComplete)并搜索了一下，但找不到任何有关如何应用选项的示例或文档。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T05:19:01.200

你是对的，有 AJAX 选项。然后，有这样的：

[http://api.cakephp.org/view_source/ajax-helper/#line-129](http://api.cakephp.org/view_source/ajax-helper/#line-129)

您可以使用“选项”数组中的任何选项。

# ruby-on-rails - 如果我将 Django 与 Python 一起使用，是否会更难找到托管公司？

> ID：891246
> 
> 赞同：0
> 
> 时间：2009-05-21T03:10:30.527
> 
> 标签：ruby-on-rails, django, hosting

我想用 Python 进入 Django，但似乎像[DreamHost](http://www.dreamhost.com/r.cgi?542295)、[Netfirms](http://affiliates.netfirms.com/e.asp?e=8&id=6738)这样的一些托管公司，它们都在基本托管包中提供 Ruby on Rails，但不提供 Django。他们只列出了 Python，但没有列出框架。那么这是否意味着如果我使用 Django，我将需要寻找支持 Django 的公司，或者我可以简单地将 Django 文件添加到我的目录中并且它可以在不使用任何其他支持的情况下工作？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-21T03:18:37.687

查看[Djangofriendly.com](http://www.Djangofriendly.com)以获得对设置 Django 友好的主机列表（当然，并不是说您不能与许多其他主机一起使用）。

就个人而言，我在[Webfaction](http://www.webfaction.com)上托管了一些 Django 应用程序，它们非常棒。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-21T03:16:26.130

[Dreamhost 确实支持 Django！](http://wiki.dreamhost.com/index.php/Django)

这是[支持 Django 的托管公司列表](http://code.djangoproject.com/wiki/DjangoFriendlyWebHosts)，正如您所见，大多数主要公司都支持它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-21T03:19:28.497

从某种意义上说，您拥有的选择数量会更小。但现实情况是，无论如何您只需要一台主机。

我强烈推荐[Webfaction](http://www.webfaction.com/)，因为我对他们的体验非常好。他们支持开箱即用的 Django，您只需进行很少的配置。

检查 Django 主机的这些列表：http: [//code.djangoproject.com/wiki/DjangoFriendlyWebHosts](http://code.djangoproject.com/wiki/DjangoFriendlyWebHosts) [http://djangohosting.org/](http://djangohosting.org/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-21T06:23:53.097

请注意，大多数共享托管包不适合 Django，因为每当您更改 python 代码时都需要重新启动服务器 - 大多数都不允许这样做。Webfaction 是一个明显的例外——我将它们用于几个 Django 项目，并且会支持上述建议。你几乎没有注意到它是一个共享主机。

但是您可能需要考虑虚拟主机。我还有一些在[Slicehost](http://www.slicehost.com/)托管的项目。价格与共享主机相当，您可以完全控制您的服务器。当然，这也意味着设置不是一键式的，尽管它们提供了很好的分步教程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-21T03:12:15.360

如果你想做 python web 开发，也许你可以看看[谷歌的应用引擎。](http://code.google.com/appengine/)他们可以为您处理所有托管。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-21T03:18:53.723

是的！

标准托管包是 Windows/ISS 或 Linux/php/perl/Mysql。

有一些专业的 Django/python 托管包，但是，你最好的选择是获得一个 Linux VPS（虚拟专用服务器）包，它可以让你获得 root 访问权限。

然后，您可以完全安装您需要的东西。基本的低带宽且磁盘空间不多的套餐的起价为每月 10 美元以下。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-21T03:15:50.063

这取决于与什么相比。如果将它与 Rails 相比，它会因为 Rails 周围的嗡嗡声而变得更难，而且很可能一个“基本”包会在 Django 之前包含 Rails，所以如果这个成本因素很重要，请注意它，但是有很多Django 托管的竞争，因此缺乏托管不是避免它的理由。

如果托管驱动技术决策，那么 PHP 在基础级别托管更受欢迎。

# assembly - 艾达和装配

> ID：891258
> 
> 赞同：5
> 
> 时间：2009-05-21T03:13:47.633
> 
> 标签：assembly, x86, ada

我正在考虑制作一个在裸 CPU (x86)、32 位保护模式和无操作系统上运行的硬件调试工具。由于时间限制，我不会全部在 x86 汇编中编写该工具。我喜欢 Ada 语言（但对它缺乏经验）并且认为在这个项目中使用 Ada 而不是 C 可能会很有趣。

使用 C 语言，可以使用内联汇编或调用用汇编编写的子程序来访问 BIOS 以进行键盘 I/O 或在屏幕上显示文本等基本操作。艾达有类似的能力吗？如果是这样，是否有人知道任何用于调用汇编方法并与它们链接的资源或教程？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T03:21:41.813

您可以在 Ada 中使用内联汇编代码。您需要使用`System.Machine_Code`提供（重载）`Asm`功能的包。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T12:32:57.173

GNAT 参考手册中有一个关于[机器代码插入](http://gcc.gnu.org/onlinedocs/gnat_rm/Machine-Code-Insertions.html#Machine-Code-Insertions)的部分，虽然它是 GNAT 特定的，但即使您使用不同的编译器，也应该能够大致了解它的工作原理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-02-17T21:04:46.000

Adacore 有一个部分包含我认为有用的示例。

[https://docs.adacore.com/gnat_ugn-docs/html/gnat_ugn/gnat_ugn/inline_assembler.html](https://docs.adacore.com/gnat_ugn-docs/html/gnat_ugn/gnat_ugn/inline_assembler.html)

注意：示例是针对 32 位架构的，使用“-m32”，（或稍微更改示例）

# version-control - 手机应用程序的最佳版本控制系统？

> ID：891276
> 
> 赞同：2
> 
> 时间：2009-05-21T03:21:16.293
> 
> 标签：version-control, mobile

我正在开发一个移动电话应用程序，该应用程序基于它们提供的功能针对许多移动设备。将有一个所有手机都应支持的基本功能集，然后会有取决于特定手机集的附加功能。

我如何在版本控制系统方面管理这样的代码库？

我有使用 CVS 和 VSS 的经验，但两者都不太适合我对这种应用程序的需求。我想做的最后一件事是为每个设备集分支代码。

让我通过一个例子来更清楚地说明这一点。假设我正在使用 MIDP 2.0 开发 J2ME 应用程序。这是我希望所有支持 MIDP 2.0 的手机都具备的基本功能集。最重要的是，我会使用他们的 SDK 将这个应用程序扩展到特定的手机组。例如。诺基亚 S40、诺基亚 S60、索尼爱立信、黑莓等。所有这些都提供了额外的功能，让您可以在基础应用程序之上构建更多功能，并且大多数情况下，这些功能会影响您从 UI 到核心逻辑的整个代码库。

实现此目的的一种方法是将构建系统与预处理器标志结合使用，并尝试将差异区分开来，以免产生太多依赖关系。这有时会变得相当复杂。我想知道是否有更简单的方法来使用智能源代码控制系统来处理这个问题......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T03:31:50.077

我会看看 Subversion 的[svn:externals](http://svnbook.red-bean.com/nightly/en/svn.advanced.externals.html)。

使用 svn 1.5，您可以对目录使用相对引用，并且 svn 1.6 支持基于文件的外部。

例如像这样的结构，

*   /电话1/基地
*   /电话 1/功能 1
*   /电话 1/功能 2
*   /电话2/基地
*   /电话 2/功能 1
*   /电话2/功能3

使用 svn:externals 很容易实现。

在 Subversion 中，您的存储库结构非常灵活，这是您可以布置的一种（多种方式）：

*   主干/功能/底座
*   主干/功能/功能1
*   主干/功能/功能2
*   主干/功能/功能2
*   trunk/Phones/Phone1（带有 svn:externals 到 Base、Feature1、...）
*   trunk/Phones/Phone2（带有 svn:externals 到 Base、Feature3、...）

不过有一个提示：确保为每个外部引用使用特定的 Subversion 版本，开始时它可能看起来并不重要，但 6 个月后它会:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T03:29:12.500

对于没有很多开发人员的项目，我喜欢[Subversion 。](http://subversion.tigris.org/)从您的问题陈述来看，在我看来，您应该能够通过良好的构建系统实现您想要的。所以我认为源代码控制本身不会有太大的不同。但我可能误解了你的问题。

赛义德·易卜拉欣·哈希米

我的书：[Microsoft Build Engine 内部：使用 MSBuild 和 Team Foundation Build](https://rads.stackoverflow.com/amzn/click/com/0735626286)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T04:02:41.573

我认为 VCS 不会解决您的问题。

您最好的选择可能是尽可能抽象出手机特定的功能和/或使用插件类型模型。

我只使用过 Subversion、CVS、Starteam 和 VSS。无论如何，分支都是一种痛苦……尤其是如果您有多个活动分支。您将无法进行持续的合并、分支比较以及尝试跟踪您是否对所有分支进行了更改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T03:41:04.530

如果您将代码组织成一些核心模块和一些依赖于核心模块的特定于手机的模块，那么您使用哪个 VCS 并不重要。无论如何，我都会推荐一个去中心化的 VCS（Mercurial、Bazaar、Git）。

您可以考虑描述您希望如何实现您想要的（具有不同功能集的不同应用版本）以获得更合理的建议

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T03:58:41.677

如果您使用 Perforce，您可以在软件仓库和工作空间之间使用不同的映射，并执行以下操作：

```
depot/
  common/
  platform1/
    someportedfile
  platform2/
    someportedfile 
```

并将其映射到您的工作区中：

```
platform1/
  someportedfile
  common/
platform2/
  somtportedfile
  common/ 
```

# c# - 在 WPF 中保存为 PDF

> ID：891277
> 
> 赞同：3
> 
> 时间：2009-05-21T03:21:17.493
> 
> 标签：c#, .net, wpf

我有一份报告，我使用 PrintVisual 打印它，现在我需要将其保存为 PDF 文件，但我不知道如何将其导出为 PDF。你知道我该怎么做吗？感谢您的关注。

很好的问候:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T03:33:11.400

我听说了有关[PDFsharp](http://www.pdfsharp.com/PDFsharp/)的好消息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T03:53:45.067

您也可以尝试[iTextSharp](http://itextsharp.sourceforge.net/)。

iTextSharp 的教程可[在此处](http://itextsharp.sourceforge.net/tutorial/)获得。

# sql - Oracle 表单生成器未从服务器获取值

> ID：891286
> 
> 赞同：0
> 
> 时间：2009-05-21T03:25:10.840
> 
> 标签：sql, oracle, platform-builder

我登录到一个 sql 服务器。当我通过 SQL *Plus 服务器插入值时，它们没有被表单生成器注册，但是当我使用表单生成器插入它们时，当我在 SQL* Plus 上搜索它们时它们会出现...

发生了什么事，我如何让表单生成器注册在 SQL*Plus 中输入的值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T03:44:26.580

我找到了答案....我不想在 sql plus 中使用提交：D

# .net - 在 .NET（使用 GDI+）中创建逼真的荧光笔的最佳方法是什么？

> ID：891289
> 
> 赞同：1
> 
> 时间：2009-05-21T03:27:05.127
> 
> 标签：.net, image, graphics, gdi+, image-manipulation

如何使用 GDI+ 在 .NET 中创建逼真的荧光笔（模拟真实世界的荧光笔）？它旨在用于图形对象而不是可选文本。

使用透明画笔（带 alpha 通道）无法完成这项工作，因为画笔覆盖区域下方的所有内容都变得“模糊”，我希望“前景”（主要是文本）保持清晰（保持颜色）。

仅对背景区域使用 ColorMap 可以工作，但这需要大量代码来确定背景区域和某个阈值（我可以从第一个像素或右上角像素或其他东西中选择背景）。

为区域着色的 ColorMatrix 似乎也是一种选择，但我看到与透明画笔解决方案相同的问题（我不是 ColorMatrices 方面的专家，所以我可能会忽略一些东西）。

我想我需要前景色和背景色的动态阈值，但这可能会降低荧光笔的可用性。

我可以同时使用填充“选定”区域的解决方案或类似刷子的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T03:58:43.580

这是一篇讨论如何在 GDI+ 中进行各种混合操作的文章。根据我的实验，Darken 或 Multiply 混合模式可以解决问题。

[http://www.codeproject.com/KB/GDI-plus/KVImageProcess.aspx](http://www.codeproject.com/KB/GDI-plus/KVImageProcess.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-12-09T19:09:28.737

黄色荧光笔让黄光通过，同时阻挡其他光。

在 RGB 颜色模型中，这意味着您让红色和绿色通过，而阻止蓝色。

我们可以使用示例图片来查看荧光笔（Microsoft 的 Snipping Tool）对通道的影响：

**原始图像**：

![在此处输入图像描述](https://i.stack.imgur.com/SpinH.png)

**突出显示**：

![在此处输入图像描述](https://i.stack.imgur.com/2thGB.png)

**颜色通道**：

![在此处输入图像描述](https://i.stack.imgur.com/SgKd4.png)

因此，您需要做的是将`blue`值设置为零，无论您希望荧光笔出现在哪里。

不幸的是，没有混合模式、图像属性或颜色矩阵可用于仅绘制**一种**颜色分量。在 GDI+ 中实现这一点的唯一方法是使用[`LockBits`](http://msdn.microsoft.com/en-us/library/windows/desktop/ms536298(v=vs.85).aspx).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T03:54:23.073

我在想一个给定宽度和高度的画笔，当它被拖过屏幕的一个区域时，它会抓住它下面的部分并分析它，将非文本颜色设置为黄色并单独保留文本颜色，然后放置更新部分回到屏幕上。它应该相对快速和容易地做到这一点，尽管你必须点击每个像素（并使用某种阈值来确定什么是文本，什么不是，正如你所提到的）。

# ruby-on-rails - 在 Rails 中实现简单排序/搜索的最佳方法

> ID：891292
> 
> 赞同：1
> 
> 时间：2009-05-21T03:29:30.083
> 
> 标签：ruby-on-rails, search, sorting, searchlogic

在 Rails 中实现这样的接口的最佳方法是什么？

![接口示例](https://i.stack.imgur.com/r39Jh.png)

目前我正在使用 Searchlogic，这有点痛苦。问题包括：

*   确保某些操作保持正交——例如，如果您选择“Short Posts”然后搜索，则您的搜索结果应仅限于短帖子。

*   确保正确的链接获得“选定”类。现在链接是`<a>`'s，所以在客户端维护这个状态是很棘手的。我通过让 AJAX 响应来破解它，比如说，排序返回一个新的排序链接部分，其中“选择”了正确的链接。使用单选按钮而不是`<a>`标签可以更轻松地维护状态客户端——也许我应该这样做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T04:06:22.203

我最近使用 named_scopes 和一些 ruby​​ 元编程解决了一个类似的问题，我将它们整合到一个名为[find_by_filter](http://github.com/tobyhede/acts_as_filter/tree/master)的插件中。

> **find_by_filter**接受范围名称和值的散列，并将它们链接到参数化的范围调用中。如果模型有一个与提供的名称匹配的named_scope，则调用它。如果没有找到named_scope，则创建一个匿名范围。

# javascript - 浏览器原生 JSON 支持 (window.JSON)

> ID：891299
> 
> 赞同：95
> 
> 时间：2009-05-21T03:33:58.107
> 
> 标签：javascript, json, browser

我已经看到一些浏览器本身支持通过`window.JSON`Object 安全有效地对对象进行 JSON 解析/序列化，但是很难获得详细信息。谁能指出正确的方向？这个 Object 暴露了哪些方法？它支持哪些浏览器？

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-05-21T03:40:06.790

所有现代浏览器都支持原生 JSON 编码/解码（Internet Explorer 8+、Firefox 3.1+、Safari 4+ 和 Chrome 3+）。基本上，`JSON.parse(str)`将解析 JSON 字符串`str`并返回一个对象，并将`JSON.stringify(obj)`返回该对象的 JSON 表示`obj`。

有关[MDN 文章](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_native_JSON)的更多详细信息。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2012-03-12T01:38:25.077

jQuery-1.7.1.js - 555 行...

```
parseJSON: function( data ) {
    if ( typeof data !== "string" || !data ) {
        return null;
    }

    // Make sure leading/trailing whitespace is removed (IE can't handle it)
    data = jQuery.trim( data );

    // Attempt to parse using the native JSON parser first
    if ( window.JSON && window.JSON.parse ) {
        return window.JSON.parse( data );
    }

    // Make sure the incoming data is actual JSON
    // Logic borrowed from http://json.org/json2.js
    if ( rvalidchars.test( data.replace( rvalidescape, "@" )
        .replace( rvalidtokens, "]" )
        .replace( rvalidbraces, "")) ) {

        return ( new Function( "return " + data ) )();

    }
    jQuery.error( "Invalid JSON: " + data );
}

rvalidchars = /^[\],:{}\s]*$/,

rvalidescape = /\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,

rvalidtokens = /"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,

rvalidbraces = /(?:^|:|,)(?:\s*\[)+/g, 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-08-05T14:35:14.027

使用 json2.js 的好处是它只会在浏览器还没有解析器的情况下安装解析器。您可以保持与旧浏览器的兼容性，但如果可用，请使用本机 JSON 解析器（更安全、更快）。

带有原生 JSON 的浏览器：

*   IE8+
*   火狐 3.1+
*   Safari 4.0.3+
*   歌剧 10.5+

G。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-10-20T23:23:09.787

[扩展[musicfreak](https://stackoverflow.com/users/104184/musicfreak)评论]

如果您使用的是 jQuery，请使用[parseJSON](http://api.jquery.com/jQuery.parseJSON/)

```
var obj = jQuery.parseJSON(data) 
```

它在内部检查浏览器是否支持 .JSON.parse，并（如果可用）调用本机 window.JSON.parse。

如果不是，则解析自身。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-11-18T07:53:34.940

为了任何遇到此线程的人的利益 - 有关支持 JSON 对象的最新、确定的浏览器列表，[请查看此处。](http://caniuse.com/json). 一个简短的通用答案 - 几乎所有在 2013+ 年真正重要的浏览器。

# hosting - 如何测试托管公司对我们的网页/网络应用程序的速度？

> ID：891312
> 
> 赞同：1
> 
> 时间：2009-05-21T03:41:34.967
> 
> 标签：hosting, performance, web-applications

在我们注册任何托管公司来托管我们的应用程序或页面之前，我认为最好了解一下速度，这样如果速度太慢，我们不妨多付一点钱来找到一个更好的地方来放置我们的应用程序或页面。应用程序。问题是，有没有办法找出托管公司托管的一些网站，以及测试网站速度的最佳方法是什么？（使用“ab”命令是最好的方法之一吗？）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T03:50:02.533

[Netcraft](http://uptime.netcraft.com/perf/reports/Hosters)监控托管服务提供商并可以提供此类信息，但我不确定它是否那么重要。如果您测试单个站点，则可能存在其他不一定会影响您的瓶颈。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T04:01:02.663

查看Joel 关于软件的博客[http://www.joelonsoftware.com/backIssues-2009-02.html关于](http://www.joelonsoftware.com/backIssues-2009-02.html)[http://www.akamai.com/](http://www.akamai.com/)

它详细说明了您的数据包被路由到 Akamai 节点，然后从那里进入快车道，到达终点前最近的 Akamai 出口。

我不认为您通常可以找出站点的速度，因为这是到您的站点的路线以及该路线的设置方式的函数。如果提供商在路由到下一个城镇之前有到托莱多的路由，即使他们正在运行最快的链接类型，速度也可能看起来很慢。

# python - .doc 文件的动态生成

> ID：891315
> 
> 赞同：1
> 
> 时间：2009-05-21T03:42:51.960
> 
> 标签：python, ajax, air, dynamic-data

如何使用 AJAX 动态生成 .doc 文件？Python？Adobe 空气？我正在考虑一种情况，在线程序/桌面应用程序以冰岛字符编码的文章形式（la wiki）接收用户反馈，然后在按下按钮时释放一个包含网页用户输入的 .doc 文件。任何解决方案/建议将不胜感激。

PS-我不想采用 C#/Java 的方式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T04:12:13.913

MS word 格式的问题`*.doc`是，它没有足够的文档记录，因此它不能有很好的支持，例如`PDF`，这是一个标准。

除了生成的问题之外`doc`，您的用户可能在读取`doc`文件时遇到问题。例如 linux 机器上的用户。

您应该考虑在服务器上生成 RTF。它更标准，因此更支持文档生成和之后的文档阅读。除非您需要非常特定的功能，否则它应该足以满足大多数文档类型，MS word 默认打开它，就像它打开自己的原生格式一样。

[PyRTF](http://pyrtf.sourceforge.net/)是一个可用于使用 python 生成 RTF 的项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T04:00:26.407

它不必对 ajax 做太多（从某种意义上说，ajax 通常用于动态客户端交互）

您需要一个服务器端脚本，它接受输入并将其转换为 doc。

如果它有一些接口，你可以使用 openoffice 和 python 之类的东西，请参见[http://wiki.services.openoffice.org/wiki/Python](http://wiki.services.openoffice.org/wiki/Python)

或者在 Windows 上，您可以直接使用 Word COM 对象使用 win32apis 创建文档，但 Windows 服务器服务 python 的可能性较小 :)

我认为更好的选择是生成更好更容易的 PDF。 [Reportlab](http://www.reportlab.org/downloads.html#reportlab)有一个很棒的 pdf 生成库，它就像 python 的魅力一样工作。一旦你有了 pdf，你可以使用一些 pdf 到 doc 转换器，但我认为 PDF 就足够了。

**编辑：文档生成** 再三考虑，如果您坚持使用 DOC，则可能有 Windows 服务器，在这种情况下，您可以使用 COM 对象生成 DOC、xls 或其他任何内容，请参见 [http://win32com.goermezer.de/content/view/173/ 284/](http://win32com.goermezer.de/content/view/173/284/)

# php - 如何使用 POST 将 javascript 对象数组传递给 php

> ID：891320
> 
> 赞同：5
> 
> 时间：2009-05-21T03:45:00.950
> 
> 标签：php, javascript, ajax

假设我有一个 javascript 对象数组，我正在尝试将这些对象传递给 php 页面以将它们保存到数据库中。我将变量传递给 php 并在该变量上使用 $_POST["entries"] 没有问题，但我不知道如何传递整个对象数组，因此我可以访问我的 objects.entryId 和 .mediaType 值在 php 页面上。

哦，在有人问之前，是的，我需要这样做的原因是因为我有一个 Flash 上传器，你猜对了.. 上传到 CDN 服务器（远程），远程服务器只回复这样的 js 对象。

感谢任何人都可以提供的任何帮助。

这是我的 JS 函数：

```
function test() {
        entriesObj1 = new Object();
        entriesObj1.entryId = "abc";
        entriesObj1.mediaType = 2;
        entriesObj2 = new Object();
        entriesObj2.entryId = "def";
        entriesObj2.mediaType = 1;

        var entries = new Array();

        entries[0] = entriesObj1;
        entries[1] = entriesObj2;
        var parameterString;

        for(var i = 0; i < entries.length; i++) {
            parameterString += (i > 0 ? "&" : "")
              + "test" + "="
              + encodeURI(entries[i].entryId);
        }

        xmlhttp.open("POST","ajax_entries.php",true);

        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlhttp.setRequestHeader("Content-length", parameterString.length);
        xmlhttp.setRequestHeader("Connection", "close");

        xmlhttp.onreadystatechange  = handleServerResponseTest;
        xmlhttp.send(parameterString);
    }
    function handleServerResponseTest() {
       if (xmlhttp.readyState == 4) {
         if(xmlhttp.status == 200) {
        alert(xmlhttp.responseText);
         }
         else {
            alert("Error during AJAX call. Please try again");
         }
       }
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T03:57:38.787

也许你需要看看 json 和 jQuery ajax 方法：

.- [http://blog.reindel.com/2007/10/02/parse-json-with-jquery-and-javascript/](http://blog.reindel.com/2007/10/02/parse-json-with-jquery-and-javascript/)

.- [http://us.php.net/json_decode](http://us.php.net/json_decode)

教程可能有点过时，因为 jQuery 最新版本是 1.3.x，但您会对此有所了解以及 PHP json 函数......如果您的服务器没有启用 json 扩展，您可以使用一些 php 类：

.- [http://google.com.co/search?rlz=1C1GPEA_enVE314VE314&sourceid=chrome&ie=UTF-8&q=php+json+class](http://google.com.co/search?rlz=1C1GPEA_enVE314VE314&sourceid=chrome&ie=UTF-8&q=php+json+class)

祝你好运！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-13T21:51:59.900

我也有同样的麻烦。但是谷歌搜索有帮助。

我试着自己调整和测试。我明白了。我正在使用`POST`方法。请用方法尝试这个想法`GET`。这是想法：

将方括号内的数组索引值附加到数组的 Post/Get 变量名称。对每个数组元素执行此操作。

以下脚本的一部分`var parameters="&Name[0]="+namevalue1+"&Name[1]="+namevalue2;`会给你一个提示。

这是我使用的测试 JS（再次使用`POST`方法不`GET`）：

```
 var xmlAJAXObject;

    function test() {
        xmlAJAXObject=GetxmlAJAXObject();
        if (xmlAJAXObject==null)    {
          alert ("Oops!! Browser does not support HTTP Request.");
          return  false;
        }
        var namevalue1=encodeURIComponent("Element 1");
        var namevalue2=encodeURIComponent("Element 1");

        var parameters="&Name[0]="+namevalue1+"&Name[1]="+namevalue2;

        xmlAJAXObject.open("POST", "test.php", true);   
        xmlAJAXObject.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlAJAXObject.setRequestHeader("Content-length", parameters.length);

        xmlAJAXObject.onreadystatechange=stateChanged;

        xmlAJAXObject.send(parameters);

    }

    function stateChanged() {

        if (xmlAJAXObject.readyState ==4)   {
            if (xmlAJAXObject.status == 200) {
                alert('Good Request is back');
                document.getElementById("show").innerHTML=xmlAJAXObject.responseText;
            }
        }
    }

    function GetxmlAJAXObject() {
        if (window.XMLHttpRequest)  {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            return new XMLHttpRequest();
        }
        if (window.ActiveXObject)  {
          // code for IE6, IE5
            return new ActiveXObject("Microsoft.Microsoft.XMLHTTP");
        }
        return null;
    } 
```

这对我有用。抱歉格式化和不完整的代码。我的意思是给一个方向。Google reault 网站无法提供解决方案。希望您觉得这个有帮助。

# xml - XSD key/keyref：分层密钥结构

> ID：891324
> 
> 赞同：14
> 
> 时间：2009-05-21T03:45:15.240
> 
> 标签：xml, schema, xsd

我正在尝试使用 xs:key 和 xs:keyref 定义在 XML 模式上定义一些外键约束。我希望文档的结构按以下方式分层：

```
<?xml version="1.0" encoding="UTF-8"?>
<tns:root xmlns:tns="http://www.example.org/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.example.org/ SampleSchema.xsd ">
  <parent parentKey="parent1">
    <child childKey="child1"/>
    <child childKey="child2"/>
  </parent>
  <parent parentKey="parent2">
    <child childKey="child1"/>
    <child childKey="child2"/>
  </parent>
  <referrer parentRef="parent1" childRef="child2"/>
</tns:root> 
```

每个父级都有一个（全局）唯一键，由 parentKey 定义。每个孩子都有由 childKey 定义的键，*但 childKey 仅在其包含的 parent 范围内是唯一的*。

然后有一个引用者列表，其中包含对特定父项和子项的外键引用。

我可以根据需要定义键，只需将它们放在正确的元素上：根元素上的 parentKey 约束和父元素上的 childKey 约束。我也可以毫无困难地将 keyref 定义为 parentKey。

尝试为 childKey 定义 keyref 时会出现问题。我尝试在 childKey 的根元素上定义一个简单的 keyref，但这不起作用，因为我看不到仅选择正确父子树下的子元素的方法。（至少，Eclipse 验证器总是简单地针对文档中*最后一个*父子树的内容进行验证......）。

然后我尝试定义一个复合键（在根上），其中：

*   选择器 = 父级
*   字段 = @parentKey
*   字段 = 孩子/@childKey

如果在父项下定义了多个子项，则会失败。这是基于[XSD 1.1 规范](http://www.w3.org/TR/xmlschema11-1/)，第 3.11.4 节，第 3 项的正确行为，其中指出键必须与每个字段定义最多匹配一个节点。

重申一下：如果我强制 childKeys 全局唯一，这很容易实现；困难在于引用*本地*唯一的 childKeys。

那里有任何 XSD 大师有想法吗？

作为参考，这里是一个示例 XSD，其中一个失败的 childKey keyref 被注释掉了：

```
<?xml version="1.0" encoding="UTF-8"?>
<schema xmlns="http://www.w3.org/2001/XMLSchema" targetNamespace="http://www.example.org/" xmlns:tns="http://www.example.org/" elementFormDefault="unqualified">

    <element name="root">
        <complexType>
            <sequence>
                <element name="parent" maxOccurs="unbounded" minOccurs="1">
                    <complexType>
                        <sequence>
                            <element name="child" maxOccurs="unbounded" minOccurs="1">
                                <complexType>
                                    <attribute name="childKey" type="string" use="required"/>
                                </complexType>
                            </element>
                        </sequence>
                        <attribute name="parentKey" type="string" use="required"/>
                    </complexType>
                    <key name="childKeyDef">
                        <selector xpath="child"/>
                        <field xpath="@childKey"/>
                    </key>
                </element>
                <element name="referrer" maxOccurs="unbounded" minOccurs="1">
                    <complexType>
                        <attribute name="parentRef" type="string"/>
                        <attribute name="childRef" type="string"/>
                    </complexType>
                </element>
            </sequence>
        </complexType>
        <key name="parentKeyDef">
            <selector xpath="parent"/>
            <field xpath="@parentKey"/>
        </key>
        <keyref name="parentKeyRef" refer="tns:parentKeyDef">
            <selector xpath="referrers"/>
            <field xpath="@parentRef"/>
        </keyref>
<!--        <keyref name="childKeyRef" refer="tns:childKeyDef">-->
<!--            <selector xpath="referrers"/>-->
<!--            <field xpath="@childRef"/>-->
<!--        </keyref>-->
    </element>
</schema> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T13:47:36.413

从孩子那里引用父母怎么样？即使有很多孩子，也只有一个父母，并且结合 (parent,child) 会创建一个全局唯一键，即使子键仅在其父键中是唯一的：

```
 <key name="childKeyDef">
    <selector xpath="child"/>
    <field xpath="@childKey"/>
    <field xpath="../@parentKey"/>
  </key> 
```

这在 xmllint 中不起作用，即使规范似乎没有明确禁止字段这样做 - 仅适用于选择器：[3.11.4](http://www.w3.org/TR/xmlschema-1/#d0e13819)， (2) 表示*选择器*不能是祖先（它只能是上下文节点或后代。）

啊，这是棺材中的钉子（查看特定语法）：允许的 XPath 表达式非常有限，根本不包括“..” [http://www.w3.org/TR/xmlschema-1/# c-fields-xpaths](http://www.w3.org/TR/xmlschema-1/#c-fields-xpaths)

所以，对不起，这不能回答你的问题，但也许它会给你一些想法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-22T08:38:12.220

一个丑陋的解决方案是更改您的 XML 格式，以便 parentKey 包含在每个孩子中，如下所示：

```
<parent>
  <child parentKey="parent1" childKey="child1"/>
  <child parentKey="parent1" childKey="child2"/>
</parent> 
```

我认为您的情况非常合理，我希望有办法做到这一点 - 为什么不尝试 xml-dev 邮件列表？上次我检查时它变得嘈杂，但一些 xml 的创建者仍然在那里闲逛。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-01T15:53:38.680

我有一个类似的问题：[XML Schema Key with multiple fields](https://stackoverflow.com/questions/1348753/xml-schema-key-with-multiple-fields)

我决定对我来说最好的方法是重新排序 XML 以允许范围由位置确定，而不是强制使用具有两个字段的键。

在您的场景中，如果您在父级内部移动引用者，这将允许将范围设置为引用适当的子级。然后，您将让引用者元素将外部范围引用到它需要引用的元素。

很难确定这是否是一个可接受的解决方案，因为您的问题似乎有点抽象。在我的问题中描述的问题中，我正在处理问题、答案和用户响应。我最初试图验证用户的回答是否真的是一个有效的答案；我的第一种方法涉及您正在使用的相同技术。我的最终解决方案涉及将响应移动到问题内部，然后引用用户。

我之前的 XML：

```
<?xml version="1.0" encoding="utf-8"?>
<survey>
  <user id="bob">
    <response questionIdRef="q101">yes</response>
    <response questionIdRef="q102">white</response>
  </user>
  <user id="jane">
    <response questionIdRef="q101">no</response>
    <response questionIdRef="q102">blue</response>
  </user>
  <question id="q101">
    <text>Do you like the color red?</text>
    <answer>yes</answer>
    <answer>no</answer>
  </question>
  <question id="q102">
    <text>What is your favorite color?</text>
    <answer>red</answer>
    <answer>blue</answer>
    <answer>white</answer>
    <answer>yellow</answer>
  </question>
</survey> 
```

我的 XML 之后：

```
<?xml version="1.0" encoding="utf-8"?>
<survey>
  <user id="bob" />
  <user id="jane" />
  <question id="q101">
    <text>Do you like the color red?</text>
    <answer>yes</answer>
    <answer>no</answer>
    <response userIdRef="bob">yes</response>
    <response userIdRef="jane">no</response>
  </question>
  <question id="q102">
    <text>What is your favorite color?</text>
    <answer>red</answer>
    <answer>blue</answer>
    <answer>white</answer>
    <answer>yellow</answer>
    <response userIdRef="bob">white</response>
    <response userIdRef="jane">blue</response>
  </question>
</survey> 
```

# java - 树图构造器

> ID：891327
> 
> 赞同：2
> 
> 时间：2009-05-21T03:46:51.420
> 
> 标签：java

我在使用 TreeMap 构造函数时遇到了一些问题。我有一堂课，`TreeMap<String, Client>`里面有 2 个。一棵按名称排序的树，另一棵按数字排序的树。（客户端类：字符串名称，整数，...）

```
private TreeMap<String, Client> nameTree;
private TreeMap<Integer, Client> numberTree; 
```

如何为此类构建构造函数？到目前为止，我写了这个：

```
public ManagerTreeMap(){
        nameTree = new TreeMap<String, Client>(new StringComparator()); 
        numberTree  = new TreeMap<Integer, Client>(new IntegerComparator()); 
    } 
```

我的主要问题是构造函数“TreeMap（Comparator c）”。我可以写两个比较器吗？如果不是，我该怎么办？

```
 public ManagerTreeMap(Comparator<String> cp){
       nameTree = new TreeMap<String, Client>(cp);          
    }

    public ManagerTreeMap(Comparator<Integer> cpt){
       nameTree = new TreeMap<Integer, Client>(cpt); 
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T04:16:21.527

看来您不需要自定义比较器。

```
public ManagerTreeMap(){
    nameTree = new TreeMap<String, Client>(); 
    numberTree  = new TreeMap<Integer, Client>(); 
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T04:01:46.657

也许

```
public ManagerTreeMap(Comparator<String> cs, Comparator<Integer> ci){
   nameTree = new TreeMap<String, Client>(cs);          
   numberTree  = new TreeMap<Integer, Client>(ci); 
} 
```

# cappuccino - 用卡布奇诺清除和重绘（目标-J）

> ID：891331
> 
> 赞同：3
> 
> 时间：2009-05-21T03:49:22.017
> 
> 标签：cappuccino, objective-j

基本上我有这个

```
@implementation MyView : CPView
{
  CPArray MyPanelArray;
}

// Populate the MyPanelArray and position each panel
- (void)initMyView
{
  ...
} 
```

MyPanels 几乎是图像的包装器。当一切都被初始化时，它画得很好。然后我有一个滑块来操纵图像的位置，我知道如何重绘所有内容的唯一方法是用新实例覆盖 MyView 并在主 contentView 中执行类似的操作

```
// Has the correct effect, but feels wrong
- (void)sliderAction:(id)sender
{
    var myNewView = [MyView initWithPositionValue:[sender value]];
    [_contentView replaceSubview:_myView with:myNewView];
    _myView = myNewView;
} 
```

它工作正常，但我怀疑那是“正确的方式”。

*我知道我可以使用 CPCollectionView 进行基本设置，但它不适用于我想要完成的工作。

提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T17:52:56.277

“重绘”是指实际执行 drawRect: 还是只是移动/调整图像视图的大小？如果是后者，那么您可以在 _myView 上调用 setFrame:。

# java - EJB 和同步

> ID：891333
> 
> 赞同：6
> 
> 时间：2009-05-21T03:50:14.000
> 
> 标签：java, jakarta-ee, synchronization, ejb

会话 Bean（无状态会话 bean、有状态会话 bean）是否同步？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-21T03:59:36.187

一次只有一个线程会访问您的 bean。由应用程序服务器来管理它。所以你不应该在你的 bean 中使用同步。这就是为什么像 EntityManager 这样的非线程安全可以是实例值并且没有同步问题的原因。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-05-12T11:17:39.230

**无状态 bean**：每个线程/请求都会从池中获取不同的 EJB 实例。SLB 不应该持有任何用户会话数据，任何状态。相同的代码可以并行执行。一个实例一次由一个线程访问。

**Statefull bean**为用户会话同步。每个用户都将获得自己的会话范围实例。第二个线程/请求将等到第一个线程完成。有状态的 EJB 可以保存用户特定的数据。一个用户不能并行执行相同的代码。不同的用户可以并行执行相同的代码。

如果访问不允许并行访问的资源，请使用**Singleton EJB**。顾名思义，只有一个实例。默认情况下，EJB Singleton 只能由一个线程访问（Container Managed Concurrency 和@Lock(WRITE)）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-06-21T22:23:07.463

无状态/有状态会话 bean 是线程安全的。因为每个请求都会得到一个专用的bean实例，所以不需要同步。

单例会话 bean 是共享的，需要由容器（Container Managed Concurrency - CMC）或用户（Bean Managed Concurrency - BMC）同步。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2013-04-15T10:16:58.350

关于 EJB bean 非常真实的一点是，一旦您创建了 EJB 3.0 bean，那么默认情况下，EJB 的方法是同步的。

例如

@Statelss 类 EJB 类 {

无效一些方法（）{}

}

现在，如果您将其设置为 someMethod Synchronize，它将显示错误，因为它已同步，因此无法在此级别进行同步。

EJB 3.0 Bean 很聪明，性能也很好。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2013-07-02T16:25:06.330

企业 Java bean 不同步。由于会话 bean 由 ejb 容器维护，因此您必须在应用程序级别实现同步逻辑。

# c# - asp：用户控件中的文字控件 null

> ID：891334
> 
> 赞同：5
> 
> 时间：2009-05-21T03:50:50.320
> 
> 标签：c#, asp.net, user-controls

我有一个包含 asp:Literal 的用户控件。

```
<div>
     <asp:Literal id="MenuContainer" runat="server" />
</div> 
```

代码隐藏页面中有一个初始化控件的方法：

```
internal void Setup(MyBusinessObject obj)
{
    MenuObject menu = MenuHelper.GetMenu(obj.State);

    if(obj == null)
        MenuContainer.Visible = false;

    //other code
} 
```

在使用控件的页面中，我在**LoadComplete事件处理程序中调用控件的****Setup**方法（我首先在*Load*事件中调用它）。无论*MyBusinessObject*为 null 还是不为 null，当我在用户控件上访问*Literal时，都会出现错误：*

 *****```
Object reference not set to an instance of an object. 
```

这是什么原因，有什么补救措施？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-07-13T07:16:02.183

这很简单。[正如Rick Sthral](http://www.west-wind.com/weblog)在他的一篇文章中所建议的那样，我在 web.config 的控制部分中添加了一些东西（:( 要了解这篇文章，你必须在他的页面上搜索）。

很好地允许我在不添加 @Register 标签的情况下添加控件，**但**缺点是我的控件上的子控件显示为空！所以我只是将**@Register**指令放在我的页面中，它就起作用了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-11-21T03:39:21.587

这取决于您*如何在 web.config 中包含控件。*如果您尝试在命名空间中包含所有控件，它将不起作用（尽管设计器会正确地向您显示控件列表）：

```
<add tagPrefix="prefix" namespace="example.ui.controls" assembly="example.ui" /> 
```

但是，如果您单独添加控件并指向它们的物理位置，它将按您的预期工作，而不必包含无穷无尽的`@Register`指令。

```
<add tagPrefix="prefix" tagName="Message" src="~/Controls/Message.ascx" /> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-23T09:58:24.437

感谢 TheVillageIdiot 发布您的问题的答案 - 我遇到了完全相同的误解。

通过添加控件

```
<add tagPrefix="user" namespace="Frontend.Web.UserControlsAccount" assembly="Frontend.Web" /> 
```

在 web.config 中还不足以实际使用它！我在页面上这样尝试过：

```
<user:ucLoginMessages runat="server" ID="Msgs" /> 
```

...但这会导致这样的现象，即 UserControl 内的任何控件都没有被初始化。只添加

```
<%@ Register Src="~/UserControlsAccount/LoginMessages.ascx" TagPrefix="user" TagName="Messages" %> 
```

到页面顶部解决了问题:-)

再次感谢！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T04:09:48.043

你确定`MenuContainer`是问题吗？您在函数`obj.State`的第一行引用。`Setup`如果那`obj`是空的，你会得到那个错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T04:36:42.540

正如[JerSchneid](https://stackoverflow.com/questions/891334/aspliteral-control-null-in-user-control/891370#891370)的回答中提到的，如果 obj 为空，您将收到该错误。所以，试着这样做 -

```
internal void Setup(MyBusinessObject obj)
{
    if(obj == null)
        MenuContainer.Visible = false;
    else
        MenuObject menu = MenuHelper.GetMenu(obj.State);
} 
```

编辑：我知道您在那条线上遇到了错误，但请尝试这样做。或者，否则，删除整个代码并保留该`MenuContainer.Visible = false;`行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T14:48:32.327

如果`MenuContainer`为null，可能与页面生命周期的时间线有关。您在`MenuContainer`链接之前调用该函数。您可以尝试调用`Setup`Page_Load 函数吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-21T14:57:08.473

您发布的代码如下：

```
internal void Setup(MyBusinessObject obj)
{    
    MenuObject menu = MenuHelper.GetMenu(obj.State);    

    if(obj == null)        
        MenuContainer.Visible = false;    //other code
} 
```

*   如果 obj 为 null，则在第一行取消引用 obj.State 将引发 NullReferenceException

*   如果 obj 不为 null，则不会执行 MenuContainer.Visible = false 行。

所以我认为您不会发布所有相关代码。

当您在调试此类事情时遇到困难时，请尝试使用调试器单步执行代码或在代码中添加一些断言，这将帮助您准确了解正在发生的事情：

```
internal void Setup(MyBusinessObject obj)
{    
    Debug.Assert(obj != null);
    MenuObject menu = MenuHelper.GetMenu(obj.State);    

    Debug.Assert(MenuContainer != null);
    if(obj == null)        
        MenuContainer.Visible = false;    //other code
} 
```

# php - PHP“”与“”

> ID：891335
> 
> 赞同：2
> 
> 时间：2009-05-21T03:51:51.117
> 
> 标签：php

我只是想知道什么更昂贵，例如：

```
echo "Hello world, my name is $name"; 
```

或者

```
echo 'Hello world, my name is '.$name; 
```

我知道在这种情况下它不会有太大的不同，但也许在这里它会：

```
for($i = 0; $i < 10000; $i++)
{
    echo 'Hello world, my name is '.$name;
} 
```

提前致谢！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-21T03:57:49.863

就个人而言，我会使用：

```
echo 'Hello ' , $name; 
```

[echo](http://php.net/echo)接受多个参数，因此不需要连接这样的东西。这是一个[基准](http://www.phpbench.com/)，显示了 ' 和 " （几乎没有）之间的区别。但是， " 允许转义序列（\n 等）和变量扩展。

这种类型的事情是一个微优化，你不应该担心它。请参阅以下有关优化的线程：

[优化有多重要？](https://stackoverflow.com/questions/710263/how-important-is-optimization) [https://stackoverflow.com/questions/127765/php-optimization-tips](https://stackoverflow.com/questions/127765/php-optimization-tips) [优化 PHP 字符串连接](https://stackoverflow.com/questions/416914/optimizing-php-string-concatenation)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T03:56:21.623

根据[PHP 的文档](http://us2.php.net/manual/en/language.types.string.php#language.types.string.syntax.single)：

> 与其他两种语法不同，特殊字符的变量和转义序列在出现在单引号字符串中时不会被扩展。

这意味着在循环中使用单引号可能会更快。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T03:58:40.520

在我的计算机上运行 1000000 次迭代需要 0.671s 的第一种情况和 0.494s 的第二种情况。

所以，'' 比 "" 快。

我在 pentium 4 2.4GHz 上使用 PHP 5.2.4-2ubuntu5.6

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T11:34:42.500

[请参阅PHP Benchmark](http://phpbench.com/)的“字符串输出”部分...

或者只是编写一些糟糕的微时间循环并自己测试它们。

```
ob_start();
$s = microtime(true);
for ($i=0; $i<10000; $i++)
    echo 'Hello world, my name is '.$i."\n";
$end = microtime(true) - $s;
ob_end_clean();
echo $end; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T16:34:58.900

除了使用单引号和连接的效率更高之外，我更喜欢这种风格，因为我的编辑器的语法突出显示效果更好。行的哪一部分是字符串文字，哪一部分是变量，这一点非常清楚。

你也可以在 Stack Overflow 的语法高亮中看到这一点。

# java-me - 如何使用 JSR 177 中的 APDU 访问 sim 卡？

> ID：891341
> 
> 赞同：1
> 
> 时间：2009-05-21T03:56:06.570
> 
> 标签：java-me, smartcard

J2ME 提供 JSR 177，它具有 API 以将 SIM 作为智能卡进行访问。我想对此进行更多探索，看看我能做些什么，但是，我找不到任何与此相关的文档。到目前为止，我发现的所有文档都非常通用，只提到了如何使用 APDU API 访问智能卡，而不是如何使用它在 SIM 上执行任何操作。

关于从哪里开始的任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T09:48:25.320

大多数情况下，JSR 177 应该用于提取 SIM 上的证书，以便您可以以您的 MNO 喜欢的方式加密/解密/签署数据。

查找文档的困难在于很少有手机制造商在他们的手机中包含完整的 JSR177 实现。

反过来，如果您不是密码学协议专家，那么在 JSR177 规范本身有意义之前，可能需要阅读和理解大量与安全相关的外部规范。

TCK 源代码和补充 Symbian/Nokia 测试代码将是一个很好的查看位置，但不幸的是，这些都还没有开源。

更改 SIM PIN 码等常见命令基本上需要了解二进制协议本身。如果 JSR177 实现本身是正确的，只需将正确的字节序列附加到 APDU GCF url 即可执行。

如果您只查看过 Sun JavaME SDK，您可能应该查看最新的 Series60 SDK 中的 APDU MIDlet 示例，并在诺基亚的 Java 开发人员库中添加了文档。

# c# - 获取特定应用程序的屏幕截图

> ID：891345
> 
> 赞同：55
> 
> 时间：2009-05-21T03:57:17.243
> 
> 标签：c#, winapi, screenshot

我知道我可以使用 Graphics.CopyFromScreen() 获取整个屏幕的屏幕截图。但是，如果我只想要特定应用程序的屏幕截图怎么办？

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2009-05-26T15:15:13.010

PrintWindow win32 api 将捕获窗口位图，即使窗口被其他窗口覆盖或不在屏幕上：

```
[DllImport("user32.dll")]
public static extern bool GetWindowRect(IntPtr hWnd, out RECT lpRect);
[DllImport("user32.dll")]
public static extern bool PrintWindow(IntPtr hWnd, IntPtr hdcBlt, int nFlags);

public static Bitmap PrintWindow(IntPtr hwnd)    
{       
    RECT rc;        
    GetWindowRect(hwnd, out rc);

    Bitmap bmp = new Bitmap(rc.Width, rc.Height, PixelFormat.Format32bppArgb);        
    Graphics gfxBmp = Graphics.FromImage(bmp);        
    IntPtr hdcBitmap = gfxBmp.GetHdc();        

    PrintWindow(hwnd, hdcBitmap, 0);  

    gfxBmp.ReleaseHdc(hdcBitmap);               
    gfxBmp.Dispose(); 

    return bmp;   
} 
```

上面对 RECT 的引用可以通过以下类来解决：

```
[StructLayout(LayoutKind.Sequential)]
public struct RECT
{
    private int _Left;
    private int _Top;
    private int _Right;
    private int _Bottom;

    public RECT(RECT Rectangle) : this(Rectangle.Left, Rectangle.Top, Rectangle.Right, Rectangle.Bottom)
    {
    }
    public RECT(int Left, int Top, int Right, int Bottom)
    {
        _Left = Left;
        _Top = Top;
        _Right = Right;
        _Bottom = Bottom;
    }

    public int X {
        get { return _Left; }
        set { _Left = value; }
    }
    public int Y {
        get { return _Top; }
        set { _Top = value; }
    }
    public int Left {
        get { return _Left; }
        set { _Left = value; }
    }
    public int Top {
        get { return _Top; }
        set { _Top = value; }
    }
    public int Right {
        get { return _Right; }
        set { _Right = value; }
    }
    public int Bottom {
        get { return _Bottom; }
        set { _Bottom = value; }
    }
    public int Height {
        get { return _Bottom - _Top; }
        set { _Bottom = value + _Top; }
    }
    public int Width {
        get { return _Right - _Left; }
        set { _Right = value + _Left; }
    }
    public Point Location {
        get { return new Point(Left, Top); }
        set {
            _Left = value.X;
            _Top = value.Y;
        }
    }
    public Size Size {
        get { return new Size(Width, Height); }
        set {
            _Right = value.Width + _Left;
            _Bottom = value.Height + _Top;
        }
    }

    public static implicit operator Rectangle(RECT Rectangle)
    {
        return new Rectangle(Rectangle.Left, Rectangle.Top, Rectangle.Width, Rectangle.Height);
    }
    public static implicit operator RECT(Rectangle Rectangle)
    {
        return new RECT(Rectangle.Left, Rectangle.Top, Rectangle.Right, Rectangle.Bottom);
    }
    public static bool operator ==(RECT Rectangle1, RECT Rectangle2)
    {
        return Rectangle1.Equals(Rectangle2);
    }
    public static bool operator !=(RECT Rectangle1, RECT Rectangle2)
    {
        return !Rectangle1.Equals(Rectangle2);
    }

    public override string ToString()
    {
        return "{Left: " + _Left + "; " + "Top: " + _Top + "; Right: " + _Right + "; Bottom: " + _Bottom + "}";
    }

    public override int GetHashCode()
    {
        return ToString().GetHashCode();
    }

    public bool Equals(RECT Rectangle)
    {
        return Rectangle.Left == _Left && Rectangle.Top == _Top && Rectangle.Right == _Right && Rectangle.Bottom == _Bottom;
    }

    public override bool Equals(object Object)
    {
        if (Object is RECT) {
            return Equals((RECT)Object);
        } else if (Object is Rectangle) {
            return Equals(new RECT((Rectangle)Object));
        }

        return false;
    }
} 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-05-21T05:24:37.950

这里有一些代码可以帮助您入门：

```
public void CaptureApplication(string procName)
{
    var proc = Process.GetProcessesByName(procName)[0];
    var rect = new User32.Rect();
    User32.GetWindowRect(proc.MainWindowHandle, ref rect);

    int width = rect.right - rect.left;
    int height = rect.bottom - rect.top;

    var bmp = new Bitmap(width, height, PixelFormat.Format32bppArgb);
    using (Graphics graphics = Graphics.FromImage(bmp))
    {
        graphics.CopyFromScreen(rect.left, rect.top, 0, 0, new Size(width, height), CopyPixelOperation.SourceCopy);
    }

    bmp.Save("c:\\tmp\\test.png", ImageFormat.Png);
}

private class User32
{
    [StructLayout(LayoutKind.Sequential)]
    public struct Rect
    {
        public int left;
        public int top;
        public int right;
        public int bottom;
    }

    [DllImport("user32.dll")]
    public static extern IntPtr GetWindowRect(IntPtr hWnd, ref Rect rect);
} 
```

它有效，但需要改进：

*   您可能希望使用不同的机制来获取进程句柄（或至少进行一些防御性编码）
*   如果您的目标窗口不在前景中，您最终会得到一个大小/位置正确的屏幕截图，但只会填充前景中的任何内容（您可能希望先将给定窗口拉到前景中)
*   您可能想要做的不仅仅是将 bmp 保存到临时目录

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-21T06:54:20.317

根据 Alconja 的回答，我做了一些改进：

```
[StructLayout(LayoutKind.Sequential)]
public struct Rect
{
    public int left;
    public int top;
    public int right;
    public int bottom;
}

[DllImport("user32.dll")]
private static extern int SetForegroundWindow(IntPtr hWnd);

private const int SW_RESTORE = 9;

[DllImport("user32.dll")]
private static extern IntPtr ShowWindow(IntPtr hWnd, int nCmdShow);

[DllImport("user32.dll")]
public static extern IntPtr GetWindowRect(IntPtr hWnd, ref Rect rect);

public Bitmap CaptureApplication(string procName)
{
    Process proc;

    // Cater for cases when the process can't be located.
    try
    {
        proc = Process.GetProcessesByName(procName)[0];
    }
    catch (IndexOutOfRangeException e)
    {
        return null;
    }

    // You need to focus on the application
    SetForegroundWindow(proc.MainWindowHandle);
    ShowWindow(proc.MainWindowHandle, SW_RESTORE);

    // You need some amount of delay, but 1 second may be overkill
    Thread.Sleep(1000);

    Rect rect = new Rect();
    IntPtr error = GetWindowRect(proc.MainWindowHandle, ref rect);

    // sometimes it gives error.
    while (error == (IntPtr)0)
    {
        error = GetWindowRect(proc.MainWindowHandle, ref rect);
    }

    int width = rect.right - rect.left;
    int height = rect.bottom - rect.top;

    Bitmap bmp = new Bitmap(width, height, PixelFormat.Format32bppArgb);
    Graphics.FromImage(bmp).CopyFromScreen(rect.left,
                                           rect.top,
                                           0,
                                           0,
                                           new Size(width, height),
                                           CopyPixelOperation.SourceCopy);

    return bmp;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T04:39:48.890

您可以查看[P/Invoking](http://www.pinvoke.net/) the win32 way of doing this，[一篇关于这种效果的文章](http://www.fengyuan.com/article/wmprint.html)......有点。

基本上，通过将 DC 设置为位图并将 WM_PRINT 发送到相关应用程序窗口的麻烦。总而言之，它非常讨厌，但可能对你有用。

您可能需要的函数：[SendMessage](http://msdn.microsoft.com/en-us/library/ms644950(VS.85).aspx)、[GetDC](http://msdn.microsoft.com/en-us/library/dd144871(VS.85).aspx)、[CreateCompatibleBitmp](http://msdn.microsoft.com/en-us/library/dd183488(VS.85).aspx)和[SelectObject](http://msdn.microsoft.com/en-us/library/dd162957(VS.85).aspx)。

我不能说我以前曾经这样做过，但这就是我解决问题的方式。（好吧，我可能会在纯 C 中这样做，但仍然；大致是我攻击它的方式）。

# ruby-on-rails - 如何在使用 remote_form_for 发起 AJAX 请求之前执行 JS 函数

> ID：891353
> 
> 赞同：1
> 
> 时间：2009-05-21T03:59:36.983
> 
> 标签：ruby-on-rails, ajax

在我的表单发起 AJAX 请求之前，我想调用一个函数。

我看到对于 link_to_remote 有方便的 :before 选项...“在请求启动之前调用。”

这是我的来源：

```
<% form_remote_for(@news, :url => {:action => 'create'}) do |f| %> 
```

在发起请求之前，我想调用 myFunction()

谢谢您的帮助 ：）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T04:27:38.663

我的错误 - :before 确实适用于 remote_form_for。我只是有一个愚蠢的语法错误。

# hibernate - 不使用拦截器的 getEntityName。休眠中的错误？

> ID：891360
> 
> 赞同：1
> 
> 时间：2009-05-21T04:03:12.573
> 
> 标签：hibernate

我在拦截器中实现了 getEntityName 方法。当我保存对象时，我期望 Hibernate 将调用该方法来解析（瞬态）对象的实体名称。但是，拦截器中的 getEntityName 方法未在以下场景中使用：

1) session.saveOrUpdate 被调用了一些实体名称值。预计实体名称将被拦截器覆盖。有趣的是，当我从保存方法调用中删除实体名称时，使用了拦截器的 getEntityName。看起来它仅在没有实体名称的情况下调用 save 时使用。

2) 集合中的对象以级联方式保存，集合映射的一对多关联使用实体名称作为对另一个类映射的引用。我相信这个关联的实体名称被用于级联保存，类似于场景 1。

有人可以告诉我这是 Hibernate 中的错误还是功能？

下面是我的映射。Hibernate 的版本是 3.3.1.GA。

```
<class name="User" table="HUBUSER">
<id name="id" type="integer">
  <column name="USERID"/>
  <generator class="sequence">
    <param name="sequence">USERID</param>
  </generator>
</id>
...
<map cascade="all" inverse="true" name="attributes">
  <key on-delete="cascade" update="false">
    <column name="USERID"/>
  </key>
  <map-key column="PROPERTYKEY" type="string"/>
  <one-to-many class="HBAttribute" entity-name="USERPROPERTY"/>
</map>
...
</class>

<class discriminator-value="HBAttribute" entity-name="USERPROPERTY" name="HBAttribute" table="USERPROPERTY">
<id name="id" type="integer">
  <column name="USERPROPERTYID"/>
  <generator class="sequence">
    <param name="sequence">USERPROPERTYID</param>
  </generator>
</id>
<discriminator column="PROPERTYKEY" type="string"/>
<property insert="false" name="propertyKey" not-null="false" type="string" update="false">
  <column name="PROPERTYKEY"/>
</property>
<many-to-one class="User" name="hubObject" not-null="true" update="false">
  <column name="USERID"/>
</many-to-one>
<!-- Subclass for USERNAME -->
<subclass discriminator-value="USERNAME" entity-name="USERPROPERTY_USERNAME" name="HBAttributeString">
  <property name="value" not-null="false" type="string">
    <column name="PROPVALCHAR"/>
  </property>
</subclass>
<!-- Subclass for TITL -->
<subclass discriminator-value="TITL" entity-name="USERPROPERTY_TITL" name="HBAttributeString">
  <property name="value" not-null="false" type="string">
    <column name="PROPVALCHAR"/>
  </property>
</subclass>
<!-- Subclass for EMAIL -->
<subclass discriminator-value="EMAIL" entity-name="USERPROPERTY_EMAIL" name="HBAttributeString">
  <property name="value" not-null="false" type="string">
    <column length="80" name="PROPVALCHAR"/>
  </property>
</subclass> 
```

您对此问题的回答/评论将非常受欢迎。

- - - - - - - - - - 更新 - - - - - - - - - - - - -

我想我知道问题是什么。

Hibernate 不使用拦截器来覆盖保存/保存或更新时的现有实体名称。

Hibernate 允许在类及其子类映射中使用鉴别器和实体名称。

当从数据库中获取数据库记录时，鉴别器用于识别子类或超类映射。然后据我了解，基于找到的子类映射，在持久上下文中创建持久条目（对象）。如果子类有自己的实体名称，则该实体名称将分配给持久条目。稍后，每当您更新持久对象时，此实体名称都会用作查找子类映射的键。

基于上述，据我了解，当将数据库行映射到 java 对象（持久对象）时，鉴别器在一个方向上工作。然而，当涉及到临时 java 对象到数据库行的映射时，只有对象的类名或提供给保存（或 saveOrUpdate）方法的实体名用于查找子类/超类映射。所以这里没有使用鉴别器（我想知道为什么？可能是因为它不是持久对象的一部分？）。

在我的场景中，HBAttribute 类映射具有“USERPROPERTY”实体名称，并且它的所有子类也有自己的实体名称（“USERPROPERTY_USERNAME”、“USERPROPERTY_TITL”和“USERPROPERTY_EMAIL”）。我为子类使用实体名称的原因是我需要重用子类映射的 java 类。

HBAttribute 类与 User 类 (User -> one-to-many -> HBAttribute) 具有双向关联。在用户类映射中，指定引用类映射的唯一方法是在用户集合的一对多关联中提供 HBAttribute 的“USERPROPERTY”实体名称。集合具有 cascade="all" ，因此所有操作都应该级联到集合的对象。

问题来了。我创建了 User 类的瞬态对象，然后将刚刚创建的 HBAttribute 类的瞬态对象放入集合中。所以所有的对象都是瞬态的。然后，当我通过 session.save(user) 方法保存用户对象时，属性集合中的对象会以级联方式保存。但是，由于一对多关联使用“USERPROPERTY”实体名称引用 HBAttribute 类映射，因此实体名称被传递给级联保存方法。“USERPROPERTY”实体是一个超类映射，但是有自己的实体名称的子类，Hibernate 不解析由实体名称标识的子类（这实际上在 Hibernate 的代码中注意到了。我猜 Hibernate 开发人员可以使用 Discriminator在这种情况下这样做）。这里拦截器'

我的想法是将子类实体名称存储在 HBAttribute 对象中，并使用interceptor.getEntityName 来提供从对象中获取的实体名称。

下面是 java.org.hibernate.impl.SessionImpl.getEntityPersister 的代码，它不允许拦截器覆盖原始的非空实体名称。

```
public EntityPersister getEntityPersister(final String entityName, final Object object) {
    errorIfClosed();
    if (entityName==null) {
        return factory.getEntityPersister( guessEntityName( object ) );
    }
    else {
        // try block is a hack around fact that currently tuplizers are not
        // given the opportunity to resolve a subclass entity name.  this
        // allows the (we assume custom) interceptor the ability to
        // influence this decision if we were not able to based on the
        // given entityName
        try {
            return factory.getEntityPersister( entityName )
                    .getSubclassEntityPersister( object, getFactory(), entityMode );
        }
        catch( HibernateException e ) {
            try {
                return getEntityPersister( null, object );
            }
            catch( HibernateException e2 ) {
                throw e;
            }
        }
    }
} 
```

这是我被黑的代码。

```
public EntityPersister getEntityPersister(final String entityName, final Object object) {
    errorIfClosed();
    if (entityName==null) {
        return factory.getEntityPersister( guessEntityName( object ) );
    }
    else {
        //even if the original entity-name is not null try to resolve
        //the entity-name via interceptor, if the returned entity-name
        // is null, then use original entity-name.
        String overwrittenEntityName = interceptor.getEntityName( object );
        if (overwrittenEntityName != null) {
            return factory.getEntityPersister( overwrittenEntityName );
        } else {
            // try block is a hack around fact that currently tuplizers are not
            // given the opportunity to resolve a subclass entity name.  this
            // allows the (we assume custom) interceptor the ability to
            // influence this decision if we were not able to based on the
            // given entityName
            try {
                return factory.getEntityPersister( entityName )
                        .getSubclassEntityPersister( object, getFactory(), entityMode );
            }
            catch( HibernateException e ) {
                try {
                    return getEntityPersister( null, object );
                }
                catch( HibernateException e2 ) {
                    throw e;
                }
            }
        }  
    }
} 
```

在 Hibernate 方面更有经验的人可以告诉我我的更改是否可以并且应该被提议包含在 Hibernate 中吗？

谢谢，安东

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-04T20:18:37.070

不错的收获。谢谢（你的）信息。小心使用这个 EntiyName 解析器，因为它有点错误......： [http ://opensource.atlassian.com/projects/hibernate/browse/HHH-4036](http://opensource.atlassian.com/projects/hibernate/browse/HHH-4036)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-09T08:57:57.530

在 Hibernate Core 3.3.2 中，子类实体名称的解析以比我修复时更好的方式实现。

现在在 Tuplizer 中有一个方法 determineConcreteSubclassEntityName(Object entityInstance, SessionFactoryImplementor factory) 在我的情况下我可以覆盖它。Tuplizer 类可以在类映射中注册。

还有 EntityNameResolver api，您可以在 tuplizer 中实现和注册。所以现在不需要使用实体拦截器来解析实体名称。

# logging - glib 中的默认日志处理程序是否可以传递多个日志级别？

> ID：891365
> 
> 赞同：0
> 
> 时间：2009-05-21T04:07:27.450
> 
> 标签：logging, glib

glib GLogLevelFlags 枚举定义为：

```
typedef enum
{
  /* log flags */
  G_LOG_FLAG_RECURSION          = 1 << 0,
  G_LOG_FLAG_FATAL              = 1 << 1,

  /* GLib log levels */
  G_LOG_LEVEL_ERROR             = 1 << 2,       /* always fatal */
  G_LOG_LEVEL_CRITICAL          = 1 << 3,
  G_LOG_LEVEL_WARNING           = 1 << 4,
  G_LOG_LEVEL_MESSAGE           = 1 << 5,
  G_LOG_LEVEL_INFO              = 1 << 6,
  G_LOG_LEVEL_DEBUG             = 1 << 7,

  G_LOG_LEVEL_MASK              = ~(G_LOG_FLAG_RECURSION | G_LOG_FLAG_FATAL)
} GLogLevelFlags; 
```

[默认处理程序](http://library.gnome.org/devel/glib/unstable/glib-Message-Logging.html#g-log-default-handler)是否可以接收例如 (G_LOG_LEVEL_ERROR | G_LOG_LEVEL_DEBUG) 作为其日志级别？根据 glib 的 API 保证，这是明确定义的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T04:24:49.333

是的。Seeing as`G_LOG_LEVEL_MASK`定义为除 0 和 1 之外的所有位的位掩码，并且

```
 g_log_set_handler ("GLib", G_LOG_LEVEL_MASK | G_LOG_FLAG_FATAL
                 | G_LOG_FLAG_RECURSION, my_log_handler, NULL); 
```

用作为来自 GLib 的所有消息添加日志处理程序的示例，组合日志级别很好。

另外，请考虑以下报价`g_log_set_handler`：

> 设置域的日志处理程序和一组日志级别

最后，请参阅[本教程](http://openbooks.sourceforge.net/books/wga/gtk-gnome-intro.html)，其中指出：

> GLogLevelFlags 参数是位标志的枚举，用于定义日志消息的字符和特定通道。您最有可能与日志处理程序一起使用的三个是`G_LOG_LEVEL_MESSAGE`、`G_LOG_LEVEL_WARNING`和`G_LOG_LEVEL_ERROR`。由于它们是位标志，因此您可以使用二元 OR 运算符将多个通道组合到单个处理程序中。

# ruby - 从 ruby 中的字符串中解析令牌的更清晰方法

> ID：891369
> 
> 赞同：1
> 
> 时间：2009-05-21T04:09:27.887
> 
> 标签：ruby, regex, openid

我正在尝试为它清理一些东西，并寻找一些更好的方法来解决它。这个想法是，我不想在我的规则中使用正则表达式来解析字符串，而是使用更接近路由语法“something/:searchitem/somethingelse”的东西，然后给出一个类似“/something/FOUNDIT/somethingelse”的字符串" 你会得到结果 "FOUNDIT"。

这是我正在重构的示例：给定一个输入字符串，例如“ [http://claimid.com/myusername](http://claimid.com/myusername) ”。我希望能够针对许多可能的匹配运行此字符串，然后为匹配的一个返回“myusername”。

运行它的数据可能如下所示：

```
PROVIDERS = [
  "http://openid.aol.com/:username",
  "http://:username.myopenid.com",
  "http://claimid.com/:username",
  "http://:username.livejournal.com"]

  something_here("http://claimid.com/myusername") # => "myusername" 
```

`http://claimid.com/myusername`将字符串与此列表匹配并理解结果的任何好方法？或者有什么技术可以让这样的事情变得更容易？我正在查看 rails 路由代码，因为它会执行类似的操作，但这不是最容易遵循的代码。

* * *

现在我只是用正则表达式来做这个，但上面的方法似乎更容易阅读

```
PROVIDERS = [
  /http:\/\/openid.aol.com\/(\w+)/,
  /http:\/\/(\w+).myopenid.com/,
  /http:\/\/(\w+).livejournal.com/,
  /http:\/\/flickr.com\/photos\/(\w+)/,
  /http:\/\/technorati.com\/people\/technorati\/(\w+)/,
  /http:\/\/(\w+).wordpress.com/,
  /http:\/\/(\w+).blogspot.com/,
  /http:\/\/(\w+).pip.verisignlabs.com/,
  /http:\/\/(\w+).myvidoop.com/,
  /http:\/\/(\w+).pip.verisignlabs.com/,
  /http:\/\/claimid.com\/(\w+)/]

url = "http://claimid.com/myusername"
username = PROVIDERS.collect { |provider|
  url[provider, 1]
}.compact.first 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T10:31:06.013

我认为您最好的选择是生成正则表达式，正如 Elazar 之前建议的那样。如果您只是匹配一个字段（：用户名），那么这样的事情会起作用：

```
PROVIDERS = [
   "http://openid.aol.com/:username/",
   "http://:username.myopenid.com/",
   "http://:username.livejournal.com/",
   "http://flickr.com/photos/:username/",
   "http://technorati.com/people/technorati/:username/",
   "http://:username.wordpress.com/",
   "http://:username.blogspot.com/",
   "http://:username.pip.verisignlabs.com/",
   "http://:username.myvidoop.com/",
   "http://:username.pip.verisignlabs.com/",
   "http://claimid.com/:username/"
]

MATCHERS = PROVIDERS.collect do |provider|
  parts = provider.split(":username")
  Regexp.new(Regexp.escape(parts[0]) + '(.*)' + Regexp.escape(parts[1] || ""))
end

def extract_username(url)
  MATCHERS.collect {|rx| url[rx, 1]}.compact.first
end 
```

它与您自己的代码非常相似，只是提供者列表更清晰，更易于维护和根据需要添加新的提供者。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T04:21:20.597

String `include?`or怎么样`index`？

```
url.include? "myuserid" 
```

或者你想要一些位置的东西？如果是这样，那么您可以`split`使用 URL。

是的，第三个想法：使用带有 :username 的输入表单，为每个这样的字符串构造和编译一个 Regexp，然后使用[Regexp#match](http://www.ruby-doc.org/core/classes/Regexp.html)返回一个[MatchData](http://www.ruby-doc.org/core/classes/MatchData.html)。如果您保留成对的正则表达式和 :username 字段的索引，则可以直接进行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T04:53:40.260

我仍然认为正则表达式可以成为这里的解决方案。但是，您需要编写一个代码，从类似路由的字符串中创建一个正则表达式。一个示例代码是：

```
class Router
    def initialize(routing_word)
        @routes = routing_word.scan /:\w+/
        @regex = routing_word
        @regex.gsub!('/','\\/')
        @regex = Regexp.escape(@regex)
        @regex.gsub!(/:\w+/,'(\w+)')
            @regex = '^'+@regex+'$'
        @regex = Regexp.new(@regex)
    end
    def match(url)
        matches = url.match @regex
        ar = matches.to_a[1..-1]
        h = {}
        @routes.zip(ar).each {|k,v| h[k] = v}
        return h
    end
end

r = Router.new('|:as|:sa')
puts r.match('|a|b').map {|k,v| "#{k} => #{v}\n"} 
```

为每个路由字符串使用一个路由器。它应该返回一个很好的哈希表，将 URL 冒号字符串与实际的 URL 组件相匹配。

为了识别给定的 URL，应该遍历所有路由器，并找出哪一个接受给定的 URL。

```
class OpenIDRoutes
    def initialize()
        routes = [
           "http://openid.aol.com/:username/",
           "http://:username.myopenid.com/",
           "http://:username.livejournal.com/",
           "http://flickr.com/photos/:username/",
           "http://technorati.com/people/technorati/:username/",
           "http://:username.wordpress.com/",
           "http://:username.blogspot.com/",
           "http://:username.pip.verisignlabs.com/",
           "http://:username.myvidoop.com/",
           "http://:username.pip.verisignlabs.com/",
           "http://claimid.com/:username/"
        ].map {|x| Router.new x}
    end

    #given a URL find out which route does it fit
    def route(url)
        for r in routes
            res = r.match url
            if res then return res
         end
    end

r = OpenIDRoutes.new
puts r.route("http://claimid.com/myusername") 
```

我认为这是大多数 Rails 路由的一个很好且简单的实现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T14:06:29.713

它有点特定于 URI，但标准库有 URI.split()：

```
require 'uri'

URI.split("http://claimid.com/myusername")[5] # => "/myusername" 
```

也许能够以某种方式使用它。

CJ

# c# - URI 中带有 HTML 字符的 WebClient.DownloadFile 404 错误？

> ID：891375
> 
> 赞同：1
> 
> 时间：2009-05-21T04:15:40.450
> 
> 标签：c#

我正在使用 WebClient 类从网站下载文件并且有几个问题。

1.  当 URI 在 URI 路径中包含 HTML 字符时（例如[http://foo.com/path1](http://foo.com/path1)`&amp;` path2.pdf），我会收到 404（未找到）错误。我怎样才能防止这种情况？我认为 HTML 字符是安全的？

2.  当 URI 代表一个目录（例如[http://foo.com/path](http://foo.com/path)）时，我得到 403（禁止）错误。我理解为什么会发生这种情况，但我如何测试我的 URI 以查看它是否代表没有索引页面的目录。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T04:23:23.060

1.  HTML 编码的字符对于 URL 是不安全的。您需要对它们进行 URL 编码。如果您的数据以 html 编码存储，您将需要使用[HttpUtility.HtmlDecode](http://msdn.microsoft.com/en-us/library/system.web.httputility.htmldecode.aspx)来获取格式正确的 URL（即`foo.com/page?foo=1&bar=2`。如果您有特殊字符必须进入 URL，例如不属于URL，你需要对它们进行 URL 编码。使用[HttpUtility.UrlEncode](http://msdn.microsoft.com/en-us/library/4fkewx0t.aspx)
2.  你不能。

# java - 实现 ActionListener 的 Java 匿名类？

> ID：891380
> 
> 赞同：5
> 
> 时间：2009-05-21T04:19:55.680
> 
> 标签：java, anonymous-class

我最近在做一个编程任务，要求我们在代码中实现一个由 UML 图指定的程序。有一次，该图指定我必须创建一个匿名 JButton，它显示一个计数（从 1 开始）并在每次单击时递减。JButton 及其 ActionListener 都必须是匿名的。

我想出了以下解决方案：

```
public static void main(String[] args) {
  JFrame f = new JFrame("frame");
  f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
  f.setSize(400, 400);

  f.getContentPane().add(new JButton() {

    public int counter;

    {
      this.counter = 1;
      this.setBackground(Color.ORANGE);
      this.setText(this.counter + "");

      this.addActionListener(new ActionListener() {
        public void actionPerformed(ActionEvent arg0) {
          counter --;
          setText(counter + "");
        }
      });

    }
  });

  f.setVisible(true);

}
```

这将添加一个匿名 JButton，然后添加另一个（内部）匿名 ActionListener 来处理事件并根据需要更新按钮的文本。有更好的解决方案吗？我很确定我不能声明匿名`JButton implements ActionListener ()`，但是还有另一种更优雅的方式来实现相同的结果吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-21T04:33:58.000

我通常是这样的：

```
JPanel panel = new JPanel();
panel.add(new JButton(new AbstractAction("name of button") {
    public void actionPerformed(ActionEvent e) {
        //do stuff here
    }
})); 
```

AbstractAction 实现了 ActionListener 所以这应该满足任务。

将这么多行代码压缩在一起可能是一种不好的做法，但是如果您习惯阅读它，那么它可能会非常优雅。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-21T10:59:12.213

这很丑陋，但您可以使用 ActionListener 方法和匿名类执行以下操作：

```
 f.getContentPane().add(new JButton(new AbstractAction("name of button") {
      private int counter = 0;

      public void actionPerformed(ActionEvent e) {
          ((JButton) e.getSource()).setText(Integer.toString(counter--));
      }
  }) {
      {
          setText("1");
      }
  }); 
```

为了更容易访问计数器，您可以将其移到类的顶层并从调用 setText 的两个位置访问它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-21T10:29:22.693

实现多种类型通常是一个坏主意。

很少需要扩展`JComponent`类，尽管很多糟糕的软件和教程都这样做了。最近流行的一个习惯用法/hack 是 Double Brace - 一个类只是子类，以便给它一个实例初始化器，它的作用就像`with`来自其他语言的语句。

在这种情况下，相关代码可以写成：

```
JButton button = new JButton();
button.addActionListener(new ActionListener() {
    int counter = 1;
    {
        updateText();
    }
    public void actionPerformed(ActionEvent arg0) {
        --counter;
        updateText();
    }
    private void updateText()
        setText(Integer.toString(counter));
    }
});
f.getContentPane(button); 
```

如果它变得更复杂，那么您可能想要创建一个外部类（不实现`ActionListener`或扩展`JButton`）来处理数据。

另请注意，您应该使用`EventQueue.invokeLater`样板文件来确保 Swing 组件只在 AWT EDT 上使用过。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T04:41:50.937

我不会在现实世界的程序中做这样的事情，但考虑到你的作业要求，你很难做得更好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-21T04:43:53.603

那么有一个更优雅的方式来做到这一点。

不幸的是，它不是核心 Java/Swing 方法。

您可以使用 Groovy 中的 SwingBuilder 来实现相同的结果，使用稍微简洁的语法，例如伪代码：

```
button(text: '' + counter,
         actionPerformed: {counter--; text = '' + counter + ''},
         constraints:BL.SOUTH) 
```

[ [http://groovy.codehaus.org/Swing+Builder][1]](http://groovy.codehaus.org/Swing+Builder][1])

不过，我不会在你的作业中使用它，我已经看到学生**真的**偏离了规范并因此被扣分，但至少你可以将它作为进一步调查的可能途径。

我认为你目前拥有的绝对没问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-05-04T16:16:49.373

这是仅在家庭作业中被迫完成的不良实践任务之一；-) 坏事：

*   使用 ActionListener 而不是本身不好的 Action
*   结果，范围界定问题冒了出来
    *   计数器的范围超出了必要的范围
    *   需要访问 actionPerformed 中的按钮（通过类型转换或访问周围对象的 api）
*   不可读（又名：不可维护）的代码

但是，那么..我们无法抗拒，我们可以吗 ;-) 这是一个使用 Action 的版本，对于前两个问题来说是干净的（或者我认为是这样的），与所有其他示例一样不可读（当然，我作弊了：首先实现匿名类，然后让 IDE 执行内联

```
 f.add(new JButton(new AbstractAction() {

        int counter = 1;
        { // constructor block of action
            updateName();
        }

        @Override
        public void actionPerformed(ActionEvent e) {
            counter--;
            updateName();
        }

        private void updateName() {
            putValue(Action.NAME, "" + counter);
        }

    })  { // subclass button 
          {  // constructor block button
            setBackground(Color.PINK);
        }}
    ); 
```

# c# - Excel 错误 HRESULT: 0x800A03EC 尝试使用单元格名称获取范围

> ID：891394
> 
> 赞同：25
> 
> 时间：2009-05-21T04:28:42.223
> 
> 标签：c#, excel, exception, vsto

我正在使用 Window Service 项目。必须按顺序将数据写入 Excel 文件中的工作表。

但有时，只是有时，服务在尝试使用单元格名称获取范围时抛出异常“HRESULT 中的异常：0x800A03EC”。

我已经把打开excel表的代码放在这里了。

*   操作系统：window server 2003 办公室：
*   微软办公软件 2003 sp2

1：打开excel表

```
m_WorkBook = m_WorkBooks.Open(this.FilePath, 0, false, 5,
     "", "", true, Excels.XlPlatform.xlWindows, ";",
     true, false, 0, true, 0, 0); 
```

2：让单元格写入

```
protected object m_MissingValue = System.Reflection.Missing.Value;
Range range = m_WorkSheet.get_Range(cell.CellName, m_MissingValue);
// error from this method, and cell name is string. 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2012-06-13T13:40:12.497

错误代码`0x800A03EC`（或 -2146827284）表示 NAME_NOT_FOUND；换句话说，你已经要求了一些东西，而 Excel 找不到它。

这是一个通用代码，它可以应用于许多它找不到的东西，例如使用当时无效的属性，比如`PivotItem.SourceNameStandard`当 PivotItem 没有应用过滤器时抛出这个。`Worksheets["BLAHBLAH"]`抛出这个，当工作表不存在等时。一般来说，你要求的是具有特定名称的东西，但它不存在。至于为什么，这将需要您进行一些挖掘。

检查您的工作表是否确实有您要求的范围，或者`.CellName`肯定会返回您要求的范围的名称。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2015-01-23T01:04:34.493

我遇到了这个错误，因为我试图将一个字符串写入一个以“=”开头的单元格。

解决方案是在等号之前放置一个“'”（撇号），这是一种告诉 excel 实际上您不是在尝试编写公式，而只是想打印等号的方法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-05-08T00:08:14.777

我收到了工作表名称中包含空格的错误：

```
using (var range = _excelApp.Range["Sheet Name Had Space!$A$1"].WithComCleanup()) 
```

我通过在带有空格的工作表名称周围加上单引号来修复它：

```
using (var range = _excelApp.Range["'Sheet Name Had Space'!$A$1"].WithComCleanup()) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-06-13T00:32:21.117

完全**未记录**的错误 800A03EC（微软感到羞耻！）的含义类似于“不支持操作”。

它可能会发生

*   当您打开包含由当前 Excel 版本不理解的较新 Excel 版本创建的内容的文档时。
*   当您将文档保存到您从中加载它的相同路径时（文件已经打开并锁定）

但大多数情况下，由于Excel中的严重**错误**，您会看到此错误。

*   例如 Microsoft.Office.Interop.Excel.Picture 有一个属性“已启用”。当您调用它时，您应该收到一个布尔值。但是，您会收到错误 800A03EC。这是一个错误。
*   在 Exel 2013 和 2016 中有一个非常大的错误：当你自动化一个 Excel 过程并设置`Application.Visible=true`然后`Application.WindowState = XlWindowState.xlMinimized`你会从不同的函数中得到数百个 800A03EC 错误（如 Range.Merge()、CheckBox.Text、Shape.TopLeftCell、Shape .Locked 等等）。Excel 2007 和 2010 中不存在此错误。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-22T07:39:54.247

我在这里找到了一个可能的解决方案：http: [//www.made4dotnet.com/Default.aspx?tabid=141 &aid=15](http://www.made4dotnet.com/Default.aspx?tabid=141&aid=15)

**编辑：**

如果您使用 Microsoft Visual Basic .NET、Microsoft Visual C# .NET 或 Microsoft Visual C++ 自动化 Microsoft Excel，则在调用某些方法时可能会收到以下错误，因为机器的语言环境设置为非美国英语（语言环境 ID 或LCID 1033）：

HRESULT 异常：0x800A03EC

和/或

旧格式或无效类型库

解决方案 1：

* * *

要解决此错误，您可以在执行与 Excel 相关的代码时将 CurrentCulture 设置为 en-US，并使用这 2 个函数重置回您的原始文件。

```
//declare a variable to hold the CurrentCulture
System.Globalization.CultureInfo oldCI;
//get the old CurrenCulture and set the new, en-US
void SetNewCurrentCulture()
{
  oldCI = System.Threading.Thread.CurrentThread.CurrentCulture;
  System.Threading.Thread.CurrentThread.CurrentCulture = new System.Globalization.CultureInfo("en-US");
}
//reset Current Culture back to the originale
void ResetCurrentCulture()
{
  System.Threading.Thread.CurrentThread.CurrentCulture = oldCI;
} 
```

解决方案 2：

* * *

另一种可行的解决方案，在 Microsoft Office\Office11（或您相应的 office 版本）下创建一个 1033 目录，将 excel.exe 复制到 1033 目录，并将其重命名为 xllex.dll。

尽管您可以使用其中一种解决方案来解决问题，但是当您在美国英语以外的语言环境中调用 Excel 对象模型时，Excel 对象模型的行为可能会有所不同，并且您的代码可能会以您可能没有想到的方式失败。例如，您可能有将范围的值设置为日期的代码：

yourRange.Value2 = "10/10/09"

根据区域设置，此代码的行为可能有所不同，从而导致 Excel 将以下任何值放入范围：

2009 年 10 月 10 日 2009 年 9 月 10 日 2010 年 10 月 9 日

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-08-21T20:11:49.767

我在尝试使用 range.AddComment() 函数时遇到了这个问题。在添加评论之前，我可以通过调用 range.ClearComment() 来解决这个问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-04-11T07:56:39.517

当我忘记取消保护工作簿或工作表时，我得到了这个。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-09-27T13:43:08.193

我在枚举名称和调用 worksheet.get_Range(name) 时遇到了这个错误代码。当名称不适用于范围时，似乎会发生这种情况，在我的情况下，它是宏的名称。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-10-31T20:44:59.433

使用多米尼克的回答，我发现我的问题的答案具体是源数据中的 DateTiime 在应用于范围之前无效。在数据库、.NET 和 Excel 之间的某个地方，日期转换默认为“1/1/1899 12:00:00 AM”。我必须检查它并将其转换为空字符串并为我修复它。

```
if (objectArray[row, col].ToString() == "1/1/1899 12:00:00 AM")
{
    objectArray[row, col] = string.Empty;
} 
```

这可能是一个非常具体的例子，但如果他们试图追踪一段无效数据，希望它能为其他人节省一些时间。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-06-06T17:33:20.583

我在 VBA 中运行 Excel 时遇到了类似的错误，我了解到，当我从 MSSQL 中提取数据，然后使用`get_range`并`.Value2`应用它超出范围时，任何类型`uniqueidentifier`(GUID) 的值都会导致此错误。只有当我将值转换为`nvarcahr(max)`它时才有效。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-10-27T15:47:08.000

有趣的是，在打开`.XLS?`文件格式不正确或需要修复时也会发生此错误。

一个很难找到的错误是 .xls（旧的 excel）文件上有很多行。

测试一下：用 excel desktop 手动打开受影响的文件。

我每天使用自动化处理数百个文件，当出现此错误时，我通过邮件通知所有者并将未处理的文件保存在临时位置。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-07-30T13:28:44.037

嗨，面临同样的问题

脚步

1.  确保您在尝试编辑和保存更改时正在访问 excel 文件，而不是处于只读模式（保护模式）。

2.  如果之后也发生这种情况，您可以转到 excel 文件--> 选项--> 公式并在此处禁用错误检查（这是几乎大多数 HRESULT 错误的原因）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-12-01T06:41:48.777

**Excel 范围索引为无零，从 1 开始。**
如果调用`sheet.Rows[0]`or`sheet.Columns[0]`或`sheet.Cells[0]`抛出异常，因为索引从 1 开始，0 是无效索引。

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2012-06-21T18:31:32.077

如果您可以复制整个异常，那就更好了，但是一旦我遇到此异常，这是因为从您的 dll 文件调用的函数（我猜是 Aspose.dll）没有得到很好的签名。我认为这可能是这个的[重复](https://stackoverflow.com/questions/10732717/c-sharp-aspose-cells-dll-installation-error)

仅供参考，为了确定您的 dll 是否没有被很好地签名，您应该右键单击它并转到签名处，它会告诉您它是否已被电子签名良好。

# jquery - 中止 (HTML) 图像下载

> ID：891399
> 
> 赞同：0
> 
> 时间：2009-05-21T04:34:09.107
> 
> 标签：jquery, html, ajax, image

我在网页上显示了各种图像集（例如每组 50 张图像）。用户可以从列表中选择要显示的集合，该列表通过 jQuery ajax 调用加载以删除旧的 img 标签并添加新标签。

我看到的是，对第一批陈旧图像的所有请求仍然从服务器中提取，从而延迟了新图像的加载并终止了 UX。所以我的问题是：是否可以从浏览器中清除对 DOM 中不再存在的第一组 img 的请求？这不是自动的吗？

这是该过程的示例 jQuery 片段：

```
updateImages = function(imageSetId) {
    // clear existing IMG set
    $("#imagesDiv").empty();

    $.post(
        "/GetImagesInSet",
        { imageSetId: imageSetId },
        function(data) {
            // add in new IMG set
            $("#imagesDiv").html(data);
        },
        "html"
    );
}; 
```

我的期望是对 $().empty() 的调用将阻止所有存在于其中的待处理图像从请求队列中删除。如果这是一个糟糕的设计，我会采取其他建议！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T14:36:17.970

值得一试：

```
$("img","#imagesDiv").attr("src",'');
$("#imagesDiv").empty(); 
```

我不确定您是否可以从队列中删除待处理的请求，但这肯定会阻止生成任何新请求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-06T18:28:46.957

我找到了一个更好的选择，即使用延迟加载技术，它只下载可见图像而不是所有图像（即那些滚动出视口的图像）。Bing.com 的图像搜索功能就是一个很好的例子。

这是一个提供类似功能的 jQuery 插件：[延迟加载](http://www.appelsiini.net/projects/lazyload)

查看源代码，只要元素的逻辑位置大于逻辑视图底部的位置，它就会加载图像。这样做的缺点是*所有*图像都在向下滚动时加载，即使图像实际上从未在视口内。例如，如果您快速滚动到页面底部，则会加载底部框架视图上方的一组图像，即使它们并不是真正需要的。

Bing 的实现更加健壮，并且仅在图像真正可见时才加载图像。我必须测试这个插件以确保，但源代码足够简单，如果需要，可能是“可修复的”。

# vb.net - linq 多个连接的更好方法？

> ID：891400
> 
> 赞同：0
> 
> 时间：2009-05-21T04:35:26.987
> 
> 标签：vb.net, linq, linq-to-sql

这是我正在尝试做的事情：

我有三个表，manifest，details 和 billingJournal

对于每个清单，都有详细信息，并且可能是 billingJournal 条目，如果有并且它具有字段 recordType = 1 那么 billingJournal.amount 是计费金额，我也需要它在我的网格中。

我目前正在做一个两步过程：

1.  使用普通连接将清单及其详细信息组合在一起，我将返回一个简单的数据网格视图，其中包含基于用户选择的日期范围的附加代码。

2.  然后我可以循环遍历数据网格。我将循环设置为检查数据网格的每一行，读取清单编号，然后在 billingJournal 表中执行 linq 查找。如果匹配，它会从 billingJournal 表中读取数据并获取值并将其存储在 datagrids 的当前行中。IE 在 billingJournal 中查找每个清单后，如果有一个 record_type 为 1（计费金额）的匹配清单，那么我可以做一个简单的替换，例如：

BillingReportDataGrid("金额", 1).Value = queryResult

我想知道的是，有没有办法在我的主要 linq 查询中完成所有这些操作？还是有比我现在做的更好的方法？

我正在使用一个名为 reportData 的类，因此我可以按名称访问列。

我试图玩弄左连接，但似乎不太明白。

谢谢 -

——乔

```
 Dim query = From detail In db.details _
                Where detail.InboundDate >= CType(MonthCalendar1.SelectionStart, DateTime) _
                And detail.InboundDate <= CType(MonthCalendar1.SelectionEnd, DateTime).AddHours(23).AddMinutes(59) _
                Join mainfest In db.Manifests On mainfest.ManifestID Equals detail.MainID _
                Select New reportData With {.Amount = Nothing, .ManifestID = mainfest.ManifestID, .InboundDate = detail.InboundDate} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-22T20:00:58.433

这是 Rick 在 LINQ 中模拟外连接所讨论的示例。我的 VB.Net 生锈了，但我知道这在 C# 中非常有效:)

```
Dim query = From detail In db.details _
                Where detail.InboundDate >= CType(MonthCalendar1.SelectionStart, DateTime) _
                And detail.InboundDate <= CType(MonthCalendar1.SelectionEnd, DateTime).AddHours(23).AddMinutes(59) _
                Join mainfest In db.Manifests On mainfest.ManifestID Equals detail.MainID into mainfestjoin _
                From submj in manifestjoin.DefaultIfEmpty()
                Select New reportData With { _
                                .Amount = Nothing, _
                                .ManifestID = If submj <> Nothing Then mainfest.ManifestID Else 0 EndIf, _
                                .InboundDate = detail.InboundDate} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-22T17:34:54.610

听起来您想要的基本上是对您的 billingJournal 表的外部联接。您所追求的是一个名为 DefaultIfEmpty 的运算符。我不能发布链接，但是如果您在 Google 上搜索“模拟外部连接 LINQ”，您应该很快就会看到一个示例（hookedonlinq 的布局非常清晰）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-27T00:55:37.257

解决方案：使用 Let 分配一个变量以及一个嵌入的 if 语句似乎可以解决问题（感谢 Experts Exchange 的 Fernado 提供的有用的产品......）

```
Dim query = From detail In db.details _
            Where detail.InboundDate >= CType(MonthCalendar1.SelectionStart, DateTime) _
            And detail.InboundDate <= CType(MonthCalendar1.SelectionEnd, DateTime).AddHours(23).AddMinutes(59) _
            Join mainfest In db.Manifests On mainfest.ManifestID Equals detail.MainID _
            Let BillingQuery = (From b In db.Billings _
                                Where b.ManifestID = mainfest.ManifestID _
                                Order By b.RecordCreationDate Descending _
                                Select b).First.Amount _
            Let BillingAmount = If(BillingQuery IsNot Nothing, Convert.ToDecimal(BillingQuery), Convert.ToDecimal(0.0)) _
            Select New reportData With {.olderDataExists = Nothing, _
                                        .Amount = Convert.ToDecimal(BillingAmount), _
                                        .ManifestID = mainfest.ManifestID, _
                                        .InboundDate = detail.InboundDate} 
```

# c# - VSTO：如何在单元格值更改时刷新公式

> ID：891418
> 
> 赞同：1
> 
> 时间：2009-05-21T04:49:31.433
> 
> 标签：c#, .net, excel, vsto

假设我有公式 =MyCustomFunction(D2)，其中 MyCustomFunction 是使用 C# 在 Excel 插件中编写的

我如何以明智的方式告诉我的公式在单元格 D2 更改时重新运行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T10:39:03.267

如果性能损失不是太大，即电子表格的计算量不大，那么你能不能简单地`Application.Volatile=True`在你的函数中设置？

# .net - 如何跟踪任何子控件何时获得或失去 WinForms 中的焦点？

> ID：891423
> 
> 赞同：2
> 
> 时间：2009-05-21T04:51:53.913
> 
> 标签：.net, winforms, focus

我有一个 Windows 窗体自定义控件，它的作用就像一个面板，它可以包含任意数量的子项。子控件的数量和类型是在运行时确定的，因此我需要在不知道可能存在或不存在的确切子控件的情况下以通用方式工作。

我想根据面板是否包含焦点来更改面板的背景颜色。因此，如果面板的子项（或面板的子项等...）成为焦点，我想知道这一点，以便我可以更新自定义面板的背景颜色。当焦点转移到不在子层次结构中的东西上时，我还需要知道，这样我才能恢复到原始背景颜色。

Control.ContainsFocus 非常适合告诉我面板是否包含子层次结构中的焦点，但我需要知道何时发生更改。目前我只能想出以下糟糕的机制。

我挂钩每个孩子的 GotFocus/LostFocus 和每个孩子的每个孩子等。我还必须挂钩 ControlAdded/ControlRemoved 以确保我与可能变化的孩子层次结构保持同步。正如您所看到的，这可能会导致很多事件挂钩，我怀疑必须有一种更简单的方法。有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-06-27T22:09:07.477

似乎使用**Enter**和**Leave**事件就是答案。GotFocus 只会被发送到获得焦点的特定控件，而 Enter 事件也将被发送到获得 GotFocus 事件的控件的父（和祖先）控件。

来自[http://msdn.microsoft.com/en-us/library/system.windows.forms.control.leave.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.leave.aspx)

> “Enter 和 Leave 事件是分层的，将在父链上下级联，直到到达适当的控件。例如，假设您有一个带有两个 GroupBox 控件的 Form，并且每个 GroupBox 控件都有一个 TextBox 控件。当插入符号为从一个 TextBox 移动到另一个，为 TextBox 和 GroupBox 引发 Leave 事件，为另一个 GroupBox 和 TextBox 引发 Enter 事件。”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T08:15:39.843

恐怕这是唯一的选择。Winforms 有时在其 api 中有一些烦人的漏洞。我还没有检查，但如果 ContainsFocus 只是对容器控件的控件树进行递归遍历以查看是否有任何控件具有焦点，我不会感到惊讶。

拥有很多事件处理程序并不是什么大问题，引发很多改变 UI 元素的事件是。您可以通过子类化可添加的控件来解决此问题（但我不确定您是否必须允许所有控件或仅允许子集）并将面板传递给添加的控件，以便控件本身在获取时调用面板/失去焦点。但这也是很多工作，并且在面板中包含代码的类似观察者的模式在恕我直言更容易做到。

# emacs - Emacs 无法加载其启动文件

> ID：891424
> 
> 赞同：6
> 
> 时间：2009-05-21T04:52:20.230
> 
> 标签：emacs, emacs23

我将远程终端上的 emacs 升级为 23-snapshot。因为我在那里没有root权限，所以我做了'make install'并将'prefix'设置为我的主目录中的一个文件夹。现在，当我启动 emacs 时，它给出了一个错误“无法打开加载文件：编码-kb”，它也无法运行 dired 或加载 cc-mode。我试着用'--no-site-file'、'-Q'、'-q'开始它，都有同样的问题。我的 .emacs 是空的。有什么建议么？

谢谢你的帮助。

问候，尼西斯

更新：这些是我尝试运行“emacs”无参数时收到的消息。

```
Warning: arch-dependent data dir (/usr/local/libexec/emacs/23.0.93/x86_64-unknown-linux-gnu/) does not exist.
Warning: Lisp directory `/usr/local/share/emacs/23.0.93/site-lisp' does not exist.
Warning: Lisp directory `/usr/local/share/emacs/site-lisp' does not exist.
Warning: Lisp directory `/usr/local/share/emacs/23.0.93/lisp' does not exist.
Warning: Lisp directory `/usr/local/share/emacs/23.0.93/leim' does not exist. 
```

它是一个 64 位系统。Emacs 源代码取自 cvs 使用

```
cvs -d:pserver:anonymous@cvs.sv.gnu.org:/sources/emacs co emacs 
```

update2：感谢查理和特雷的回答。我想我会跳过“make install”并暂时坚持使用 src/emacs。干杯。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-28T20:09:39.293

对我来说，当我没有更改`prefix`Makefile 中的变量时，这个错误消失了，而是：

```
./configure --prefix=/my_special_path/usr/local 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T04:59:53.830

“encoded-kb.el”在 EMACS lisp 目录中的标准国际化代码中，所以*有些东西*没有走上正确的道路。您的负载路径在某处被软管。makefile 中有一些钩子可以让你明确设置加载路径应该是什么来解决这个问题。

启动后尝试转储您的加载路径，说出`(pp load-path)`并查看它真正在看什么。要评估它，请键入

```
(pp load-path)^j 
```

在你的`*scratch*`缓冲区中。该缓冲区应该处于 lisp-interaction 模式。( `^j`Control-j, aka Cj) 说要评估它。并且`pp`将漂亮地打印列表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-21T05:04:07.917

`make install`如果您想在系统范围内安装软件包，则需要 AFAIK 。Prefix 只定义了系统范围安装的前缀路径，但它仍然需要正确的目录层次结构（bin/、/lib、/share 等）。如果您只是想使用 CVS Emacs，您可以在该`make`过程之后立即运行它。例如，我的 Emacs 源代码位于`~/src/emacs/`，我只需键入`~/src/emacs/src/emacs`即可运行 Emacs。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-08-05T17:40:17.383

就我而言，我的 MacOSX 只是指向旧版本的 Emacs，我不知道为什么。所以，当我在图形界面上打开它时，一切都很好，但是当我试图在终端上打开它时，我得到了那个错误。所以，我首先找到快捷方式指向的位置并固定`/usr/bin/emacs`路径，如下所示：

```
$ emacs --version
GNU Emacs 22.1.1
Copyright (C) 2007 Free Software Foundation, Inc.
GNU Emacs comes with ABSOLUTELY NO WARRANTY.
You may redistribute copies of Emacs
under the terms of the GNU General Public License.
For more information about these matters, see the file named COPYING.
$ whereis emacs
/usr/bin/emacs
$ sudo rm /usr/bin/emacs 
$ sudo ln -s /usr/local/Cellar/emacs/HEAD/bin/emacs /usr/bin/emacs
$ emacs --version
GNU Emacs 24.4.50.1
Copyright (C) 2014 Free Software Foundation, Inc.
GNU Emacs comes with ABSOLUTELY NO WARRANTY.
You may redistribute copies of Emacs
under the terms of the GNU General Public License.
For more information about these matters, see the file named COPYING. 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-21T17:27:28.027

我在 AIX 上构建 emacs 23.1 时遇到了同样的问题。就我而言，我想在我的目录中安装 emacs，因为我是唯一使用 emacs 的开发人员。该问题可以通过在运行 configure 之前修改 src/epaths.in 文件中的路径来解决。Configure 使用这个文件来创建 epaths.h。--prefix= 参数不会更改 epaths.in 文件中的路径。使用 --prefix= 并修改 epaths.in 文件解决了我的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-04-06T02:25:15.063

我在 Windows 7 上构建 emacs 25.0.92 时遇到了同样的问题。

```
D:\emacs\bin>emacs
Warning: arch-dependent data dir 'd:/emacs/libexec/emacs/24.5/x86_64-w64-mingw32/': Invalid argument
Warning: arch-independent data dir 'd:/emacs/share/emacs/24.5/etc/': Invalid argument
Warning: Lisp directory 'd:/emacs/share/emacs/24.5/site-lisp': Invalid argument
Warning: Lisp directory 'D:/emacs/share/emacs/24.5/lisp': Invalid argument 
```

我发现了问题。有一个系统注册表项：`HKEY_LOCAL_MACHINE\SOFTWARE\GNU\Emacs`，它定义了加载路径`EMACSLOADPATH`。

我只是删除注册表项来解决问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-05-11T02:13:03.153

还要检查您是否有一个名为`EMACSPATH`. Emacs 期望它是一个目录。

# vba - 如何向可能重定向到登录页面的页面发出 POST 请求

> ID：891427
> 
> 赞同：5
> 
> 时间：2009-05-21T04:53:06.113
> 
> 标签：vba, post, outlook, winhttp

我在 Outlook VBA 中使用宏通过 POST 将文件提交到 URL：

```
Set http = New WinHttp.WinHttpRequest
http.Open "POST", UrlToPostTo, False    'True                                          '
http.setRequestHeader "User-Agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)"
http.setRequestHeader "Content-Type", "multipart/form-data; "
http.Send data 
```

我的问题是接受请求的页面（在这种情况下是文件上传页面）受身份验证保护 - 上面的初始请求将返回登录页面而不是页面本身。

我试图检测登录页面是否出现，如果出现，则将用户名和密码作为表单变量发布（我希望这相当于人类在网络浏览器的页面中输入所述用户名和密码）。

所以步骤是：
* 请求 URL（包括文件和帖子）。
* 检查响应是否为登录页面。
* 如果是，那么在同一个http会话中，将用户名和密码提交给URL。
* 如果服务器现在处理原始帖子，很好，否则我可以再次发布。

代码如下所示：

```
' if the login page comes back, send credentials                                     '
If (InStr(http.ResponseText, "j_password") > 0) Then

    Dim loginData As String
    loginData = "j_username=theusername&j_password=thepassword"

    http.Open "POST", UrlToPostTo, False
    http.setRequestHeader "User-Agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)"
    http.setRequestHeader "Content-Type", "multipart/form-data; "
    http.Send loginData
End If 
```

但是当我这样做时， http.Responsetext 仍然只是登录页面（或再次？）。

知道我做错了什么吗？我的计划是否有效？

（这与试图解决[这个问题](https://stackoverflow.com/questions/851269/outlook-how-do-i-post-the-selected-message-to-a-web-server-using-vba)有关）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2015-04-04T00:59:54.413

我知道这个线程很古老，我意识到 OP 很久以前肯定会继续前进。我刚刚花了三个晚上的大部分时间都被这个完全相同的问题所困扰，当我停下来进行更多研究时，这个线程不断出现，所以我想我会为下一个出现的人做出贡献。

诀窍是：

*   使用[Option](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384108(v=vs.85).aspx)属性禁用重定向，以阻止它在没有您的情况下继续前进。（见下面的评论）
*   [在Status](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384108(v=vs.85).aspx)属性的输出上捕获重定向，并从那里处理。

我敢肯定还有其他方法，但这对我来说似乎很优雅，我发现了很多其他方法来使用它。

要使用 OPs 代码示例，您可以按计划提出请求，但有一个例外：EnableRedirects var，它必须在打开连接之后出现（在任何地方都没有读到，只是无法让它坚持关闭的连接） .

祝“下一个人”好运！

```
 Dim http As WinHttp.WinHttpRequest
    Dim UrlToPostTo As String, UrlRedirectedTo As String

    'Your initial request (assuming lots here)
    Set http = New WinHttp.WinHttpRequest
    http.Open "POST", UrlToPostTo, False
    'Stop it from redirecting automatically, so you can capture it
    http.Option(WinHttpRequestOption_EnableRedirects) = False 'You can also use the collection index instead of the pretty name
    http.setRequestHeader "User-Agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)"
    http.setRequestHeader "Content-Type", "multipart/form-data; "
    http.Send

    'Now if you have an active session, you should get your desired content
    'If it redirected you, you'll have a different status, header etc...    

    If http.status = "302" Then
        Dim loginData As String
        'Now lets find out where we're being pointed and POST there
        'This may not be the same url you see in your address bar 
        UrlRedirectedTo = http.GetResponseHeader("Location")
        'Also, you may have to do this again to arrive back at the intended resource    
        loginData = "j_username=theusername&j_password=thepassword"
        http.Open "POST", UrlRedirectedTo, False
        http.setRequestHeader "User-Agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)"
        http.setRequestHeader "Content-Type", "multipart/form-data; "
        http.Send loginData
    End If 
```

我在 MSDN 迷宫中发现了一些有用的信息。

[WinHttpRequest 选项 (MSDN)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384108(v=vs.85).aspx)

[WinHttpRequest 对象 (MSDN)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa384106(v=vs.85).aspx)

[Cookie 处理 WinHttp (MSDN)](https://msdn.microsoft.com/en-us/library/windows/desktop/aa383261(v=vs.85).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T17:49:04.273

登录页面的 URL 是否与您最初提交的页面相同？我没有看到任何更改的代码`urlToPostTo`

首次发送后，您可能需要查看`Status`请求的属性。请参阅[RFC](http://www.ietf.org/rfc/rfc2616.txt)了解每个状态代码的含义。它还可以帮助使用该`GetAllResponseHeaders`方法来准确地确定正在发生的事情。有关更多信息，请参见[MSDN](http://msdn.microsoft.com/en-us/library/aa384106(VS.85).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-27T11:14:59.750

您可以将用户名和密码存储在 cookie 中，这样您就可以直接访问您的页面。

```
 Dim doc As WinHttp.WinHttpRequest
    Set doc = New WinHttpRequest

    doc.Open "POST", url, False

    doc.SetRequestHeader "Cookie", "UserID=" & username
    doc.SetRequestHeader "Cookie", "Password=" & password 
```

您需要确认服务器上的变量名称。当您从浏览器访问页面时，您可以使用*ieHTTPHeaders*之类的工具来检查标头，以查看需要做什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-20T06:57:01.130

试试**SetCredentials——**它可能对你有用，例如：

```
http.Open "POST", UrlToPostTo, False
http.SetCredentials "YourUsername", "YourPassword", 0
http.Send 
```

来源：[http ://www.automateexcel.com/2005/02/11/excel_vba_winhttprequest_with_login_and/](http://www.automateexcel.com/2005/02/11/excel_vba_winhttprequest_with_login_and/)

# ios - UIScrollView 用于缩放图像

> ID：891432
> 
> 赞同：1
> 
> 时间：2009-05-21T04:54:49.560
> 
> 标签：ios, objective-c, iphone, uiscrollview, zooming

我正在使用 UIScrollView 来缩放图像。在缩小图像时，我希望它被双击。

所以我的问题是可以通过双击缩小缩放图像。（我能够检测到缩放视图上的双击）。

我们可以使用 Scroll View 的哪个属性。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T04:58:46.203

您可能想要使用 UIScrollView 方法`scrollRectToVisible:animated:`。您将传递它`CGRect`是滚动视图中包含的图像的框架。这将滚动（缩放）整个图像以在滚动视图中可见。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-11-08T08:16:01.330

文档中有一个示例 TapToZoom，请查看。这是一个很好的例子，肯定会回答你的问题。

要回答您的问题，就像我们必须使用的人一样

```
[scroller zoomToRect:zoomRect animated:YES]; 
```

其中 zoomToRect 是要缩放的矩形。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-04T13:17:25.657

我想你也可以使用

```
[yourScrollView setZoomScale:1.0 animated:YES]; 
```

用于缩小图像视图并将其设置为正常缩放。

# python - 在 Beautiful Soup 中使用 replaceWith 时动态指定标签

> ID：891434
> 
> 赞同：0
> 
> 时间：2009-05-21T04:55:46.610
> 
> 标签：python, xml, beautifulsoup

之前我问过[这个](https://stackoverflow.com/questions/886111/can-i-use-re-sub-or-regexobject-sub-to-replace-text-in-a-subgroup)问题，得到了这个 BeautifulSoup 示例代码，在当地咨询了一些之后，我决定继续使用。

```
>>> from BeautifulSoup import BeautifulStoneSoup
>>> html = """
... <config>
... <links>
... <link name="Link1" id="1">
...  <encapsulation>
...   <mode>ipsec</mode>
...  </encapsulation>
... </link>
... <link name="Link2" id="2">
...  <encapsulation>
...   <mode>udp</mode>
...  </encapsulation>
... </link>
... </links>
... </config>
... """
>>> soup = BeautifulStoneSoup(html)
>>> soup.find('link', id=1)
<link name="Link1" id="1">
<encapsulation>
<mode>ipsec</mode>
</encapsulation>
</link>
>>> soup.find('link', id=1).mode.contents[0].replaceWith('whatever')
>>> soup.find('link', id=1)
<link name="Link1" id="1">
<encapsulation>
<mode>whatever</mode>
</encapsulation>
</link> 
```

唯一的问题是该示例具有硬编码的标记值（在本例中为“模式”），并且我需要能够在指定的“链接”标记中指定任何标记。简单的变量替换似乎不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T05:09:18.820

试试`getattr(soup.find('link', id=1), sometag)`你现在有一个硬编码标签的地方`soup.find('link', id=1).mode`——`getattr`毕竟，这是获取名称作为字符串变量保存的属性的 Python 方法！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T15:28:31.857

无需使用`getattr`：

```
sometag = 'mode'
result = soup.find('link', id=1).find(sometag)
print result 
```

# asp.net - ASP.NET 下拉列表：为选项绑定更多价值

> ID：891436
> 
> 赞同：0
> 
> 时间：2009-05-21T04:56:02.193
> 
> 标签：asp.net, drop-down-menu

我有一个有 3 列的表`ID`，`Name`并且`shortname`. 我将此绑定到 ASP.NET dropdonwlist 控件。我指定`DataTextField`为`ID`，`DataValueField`为`Name`。

现在下拉列表正确呈现列表项，我可以选择所选选项的 ID。我也想使用 ID 的简称。有没有办法做到这一点？即我想从 ASP.NET 下拉列表的选定选项中读取 ID、短名称和名称

有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T05:52:15.943

```
public class SomeClass
{
    public int Id { get; set; }
    public string ShortName { get; set; }
    public string Name { get; set; }

    public string ShortNameWithId
    {
        get
        {
            return string.Format("{0} - {1}", Id, ShortName);
        }
    }
} 
```

现在使用 ShortNameWithId，而不是 Id。因此，这将作为某种（某个类的）集合（即 List、IEnumerable）数据绑定到列表框

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-14T09:15:20.763

```
Protected Function Fld(ByVal pos As Integer, ByVal mfld As String) As String
    Dim i, j, k As Integer
    For i = 1 To pos
        k = j + 1
        j = InStr(k, mfld, Chr(13))
        j = IIf(j = 0, Len(mfld) + 1, j)
    Next
    Return Mid(mfld, k, j - k)
End Function

Protected Sub DropDownList1_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs)
    Label1.Text = Fld(1, DropDownList1.SelectedItem.Value)
    Label2.Text = Fld(2, DropDownList1.SelectedItem.Value)
End Sub 
```

或者您可以使用：

```
Protected Sub DropDownList1_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs)
    Dim Fld As Array
    Fld = DropDownList1.SelectedItem.Value.Split(Chr(13))
    Label1.Text = Fld(0)
    Label2.Text = Fld(1)
End Sub 
```

您还可以在 DataValueField 中有更多列。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-06-02T09:14:26.953

```
 drp.Items.Clear();
    foreach (var item in sourceCollection)
    {
        drp.Items.Add(new ListItem(item.ID+ "," + item.Name + "," + item.ShortName, item.ID));
    }

    //read selected text or value like this:

    string txt = drp.SelectedItem.Text;
    string val = drp.SelectedItem.Value; 
```

# php - 在 PHP 中包含文件？

> ID：891437
> 
> 赞同：1
> 
> 时间：2009-05-21T04:56:27.467
> 
> 标签：php, optimization, include, performance

我正在开发一个应用程序，我需要包含多个文件，如下所示：

```
File1.php will include File2.php

File2.php will include File3.php

File3.php will include File4.php 
```

现在，什么是最好的和优化的方式来做这些。我尝试使用 include() 但我认为它会降低我的服务器速度，因为我的服务器负载图比正常服务器负载高约 3-5 倍。

这些所有文件都是`50 KB`每个文件的重要手段。所以任何人都可以请建议我包含这些文件的最佳选择是什么，这样它就不会影响网站的速度，

哪个会是最好的？

```
require()

require_once()

include()

include_once() 
```

或者，如果有人有其他选择，请告诉我，

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T05:02:47.683

include() 和 require() 之间的区别在于您是否收到警告或致命错误（分别）。PHP 文档没有提到任何性能差异。

如果您想避免重复包含文件的内容，使用 _once() 变体很有用。来自 include_once 的[PHP 文档](http://us2.php.net/manual/en/function.include-once.php)：

> include_once() 可用于在特定脚本执行期间可能多次包含和评估同一文件的情况，因此在这种情况下，它可能有助于避免诸如函数重新定义、变量值重新分配等问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T05:05:45.497

你应该重新组织你的文件。有一个包含所有需要文件的“common.php”文件。你不应该有这样的链条。

我真诚地怀疑一些包含会减慢您的服务器速度。大多数 Web 应用程序都有数十个甚至数百个 PHP 文件。没有 3 个额外的文件会使您的应用程序减慢那么多。

此外，您提到的功能之间的速度差异可以忽略不计，尽管您应该使用`include_once`/`require_once`而不是它们的对应功能，以确保您不会多次包含同一个文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-21T12:41:45.080

只需要一张便条就知道了。在我的一个项目中，我必须为很多类（大约 50 个）实现一种工厂。我为每个类创建了一个文件，并且包含它们非常慢。我决定将它们合并到一个文件中。这种增加的性能非常可观。

我认为当有很多条目时，它与文件系统速度下降有关......不知道为什么会这样，但事实是 - 包含 1 个大文件比 50 个小文件快得多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-12-10T18:55:49.103

Tech Your Universe 上的一篇文章讨论了[require 与 require_once 的问题](http://www.techyouruniverse.com/software/php-performance-tip-require-versus-require_once)。从本质上讲，当做**绝对路径** `require()`时肯定比`require_once()`而且`include()`肯定比`include_once()`. 当他们用 sans-once 调用替换 once 调用时，他们的确切主张：

> 首先，strace 显示有 2848 个系统调用来服务一个页面，低于 4782 个（-40%）。接下来我去 ab 进行更多测试，发现平均页面请求时间从 46.5ms (-22%) 下降到 36.5，服务器每秒能够处理 27.1 个请求，从 21.4 (+%22 ) .

根据[Konstantin Rozinov 在 php.net 上 require_once 页面上的评论 90017 ，](http://php.net/manual/en/function.require-once.php#90017)`require()`和之间的区别`require_once()`很小，仅对大型 Web 应用程序有影响。我个人喜欢大的定义，但我想我们明白了。评论员还声称“在使用 APC 操作码缓存时，两者的速度差异完全无关紧要”。关于 require 和 require_once 的实际实现：“这表明操作系统（在我的情况下是 Ubuntu Linux）或 Apache 正在“缓存”或知道先前 stat() 调用的结果，所以它不会重复它们。” 把它当作它的价值。

我的个人总结：

*   如果要使用`require_once`，请尝试使用绝对路径。
*   一定要使用某种操作码缓存。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T05:02:29.197

您的答案主要取决于您的需要。要记住的要点是：

1.  包括比要求快。
2.  如果文件被“包含”但未找到，则不会导致致命错误。该脚本将继续运行。
3.  如果“需要”文件但未找到，则脚本执行会立即停止。

但是，附带说明：如果您的应用程序在 file3 中包含 file4，在 file2 中包含 file3，在 file1 中包含 file2，那么我会说您应该重新考虑您的文件组织。我相信你可以想出一个更好的方法来组织你的代码到文件中。

补充： include 和 require 之间的速度差异非常小。但是，require_once() 比 require() 重得多。对于 include_once() 和 include() 也是如此。

干杯，

jrh

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T05:07:14.560

我更喜欢将所有内容拆分成尽可能多的文件以方便我开发，然后在将其上传到服务器之前将其全部拼合为一个文件。

PHP 字符串和正则表达式函数使得编写一个替换任何包含“somefile.php”的脚本变得非常容易；与该文件的实际内容（剥离 < ? ? > 如有必要）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-21T05:14:02.810

绝对选择`include()`或`require()`超过 ' `*_once()`' 变体。您可能需要某种[操作码缓存](https://stackoverflow.com/questions/512120/php-landmines-in-general/512160#512160)来提高性能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-21T12:56:20.963

我建议使用 xdebug PHP 扩展来对您的脚本进行基准测试和分析。它会告诉你每个函数执行的时间。您可以在此处找到有关如何安装它以及它可以做什么的更多信息：[http ://www.xdebug.org/](http://www.xdebug.org/)

# sql - 我们可以在一个表中有多个标识列吗？

> ID：891439
> 
> 赞同：0
> 
> 时间：2009-05-21T04:59:33.940
> 
> 标签：sql

我们可以在表中指定 2 个标识列。如果没有，为什么？如果是，为什么

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T05:02:53.003

“身份列”不是 SQL 概念。您必须记住一些具有自己的怪癖和扩展的特定实现，而不是您的标签断言的一般 SQL；请编辑并重新标记您的问题。（如果您碰巧指的是“Microsoft SQL Server”，答案是“不，因为 Microsoft 认为这没有意义 [而且这一次他们是对的！-)]”）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T05:12:03.153

取决于你所说的“身份”是什么意思

有几种特定于实现的构造，例如“rowid”“oid”等，其目的是使用 DBMS 生成的值来唯一地标识一行 - 在大多数 dbms 系统中，每行只有一个。

行的“身份”也可能意味着主键。ANSI sql 支持由许多列组成的主键，在大多数 DBMS 中，您可以在主键中包含任何或所有合适的列。身份然后由主键中所有列的组合组成——但这是一个很大的但逻辑上它仍然构成一个身份。

您可以在任何或所有合适的列上指定一个“唯一”约束***s*** 每个约束本身可以被视为一个“身份”，因此您的问题的答案可能是“是”——但我从未见过现实生活中的实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T05:54:55.847

其他人关于“身份”不是 SQL 标准中的类型的观点是正确的。

IBM Informix Dynamic Server (IDS) 支持 SERIAL、SERIAL8 和 BIGSERIAL 类型。这些是具有额外属性的整数类型，如果您在其中插入零（或者如果您没有指定要插入的值），则会应用下一个更高的先前未使用的值。这大致对应于其他 DBMS 所称的标识列。（IDS 也提供序列。）

一个好奇（怪癖）是允许您在单个表中同时拥有一个 SERIAL 列和一个 SERIAL8 或一个 BIGSERIAL 列。不建议这样做，也不明智；但是，它不是被禁止的。

大多数 DBMS 不允许单个表中有两个单独的“身份”列。

# asp.net - PostBackUrl 与 Response.Redirect

> ID：891441
> 
> 赞同：1
> 
> 时间：2009-05-21T05:00:57.513
> 
> 标签：asp.net

PostBackUrl、Response.Redirect 和 Server.Transfer 有什么区别？在什么情况下我们需要遵循什么方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T08:35:53.297

PostbackUrl 改变了表单的**action**属性，所以初始页面没有改变，但是当用户发布表单时，它的数据被发送到不同的页面。

Response.Redirect 导致[HTTP 302 Redirect](http://en.wikipedia.org/wiki/HTTP_302)。这是常见的重定向操作，与[301 重定向](http://en.wikipedia.org/wiki/HTTP_301)不同，当您想要完全永久地更改 url 时使用。

Server.Transfer 实际上不会激活任何 HTTP 请求并且对用户完全透明。通常它用于显示错误页面（例如 404 或 500 HTTP 状态），因为如果您使用重定向而不是 Server.Transfer，浏览器（如果它是搜索引擎爬虫则更重要）将不会收到原始 HTTP 状态（例如 404 ）。

# .net - 带有私有设置器的 XmlSerializer 和 Collection 属性

> ID：891449
> 
> 赞同：14
> 
> 时间：2009-05-21T05:02:59.883
> 
> 标签：.net, xml-serialization

说我有一个像这样的简单课程

```
[Serializeable]
public class MyClass
{
    public MyClass()
    {
       this.MyCollection = new List<int>();
    }

    public List<int> MyCollection { get; private set;}
} 
```

如果我尝试使用 XmlSerializer 对其进行反序列化，则会收到一条错误消息，指出 MyCollection 是只读的，无法分配给它。但是我不想公开设置器，因为如果类的用户分配给它，这可能会导致各种问题。FxCop 正确地警告这一点：[集合属性应该是只读的](http://msdn.microsoft.com/en-us/library/ms182327(VS.80).aspx)

然而，在社区页面底部添加的内容是这样的：

> XmlSerializer 了解只读集合 Collection 属性不必是读写的，XmlSerializer 也可以正确序列化和反序列化内容。XmlSerializer 将在实现 ICollection 或 IEnumerable 的集合属性上查找名为 Add 的方法，并在反序列化所有者类型的实例时使用该方法填充集合。

然而，情况似乎并非如此（因为我得到了 InvalidOperationException）。我能做什么来遵守保持属性设置器私有的最佳实践，同时仍然允许我使用 XmlSerializer？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-21T12:00:50.730

您的私人二传手导致了这个问题。XmlSerializer 类将与我在下面给出的类一起正常工作。XmlSerializer 类是在引入私有 setter 之前发明的，因此在使用反射扫描类类型时可能无法正确检查。也许您应该将此作为错误报告给 Microsoft。

```
public class MyClass
{
    private List<int> _myCollection;

    public MyClass()
    {
        _myCollection = new List<int>();
    }

    public List<int> MyCollection
    {
        get
        {
            return this._myCollection;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-04-24T12:10:42.790

您必须使用 [XmlIgnore] 属性

# android - Android-dismissDialog 不会关闭对话框

> ID：891451
> 
> 赞同：21
> 
> 时间：2009-05-21T05:04:04.030
> 
> 标签：android

我正在使用`showDialog()`and`dismissDialog()`在我的应用程序中显示进度对话框。从创建对话框并调用`show()`它移动到使用它以在更改方向时保存状态。

但是当我从纵向->横向->纵向更改方向时，`dismissDialog()`不再关闭对话框。对话框一直呆在那里，我需要按后退按钮让它消失。

有什么理由会这样吗？

**编辑**

为了克服这个问题，我尝试添加一个`removeDialog()`in`onDestroy()`以便对话框不会创建/显示两次，并且在方向更改之前，对话框被删除。尝试添加日志语句，看看会发生什么

```
05-21 12:35:14.064: DEBUG/MyClass(193): *************callingShowDialog
05-21 12:35:14.064: DEBUG/MyClass(193): *************onCreareDialog

05-21 12:35:15.385: DEBUG/MyClass(193): *************onSaveInstanceState
05-21 12:35:15.415: DEBUG/MyClass(193): *************onDestroy

05-21 12:35:15.585: DEBUG/MyClass(193): *************callingShowDialog
05-21 12:35:15.585: DEBUG/MyClass(193): *************onCreareDialog
05-21 12:35:15.715: DEBUG/MyClass(193): *************onCreareDialog
05-21 12:35:17.214: DEBUG/MyClass(193): *************onSaveInstanceState
05-21 12:35:17.214: DEBUG/MyClass(193): *************onDestroy

05-21 12:35:17.275: ERROR/WindowManager(193): android.view.WindowLeaked: Activity com.android.MyClass has leaked window com.android.internal.policy.impl.PhoneWindow$DecorView@43362088 that was originally added here

05-21 12:35:17.395: DEBUG/MyClass(193): *************callingShowDialog
05-21 12:35:17.395: DEBUG/MyClass(193): *************onCreareDialog
05-21 12:35:17.475: DEBUG/MyClass(193): *************onCreareDialog 
```

如果我们在这里看到，最初在显示活动时，onCreateDialog 被调用一次，在改变方向时，onSaveInstanceState 和 onDestroy 被调用。

但在那之后， onCreateDialog 被调用了两次（一次是通过调用 showDialog 我做的，但为什么是第二次呢？）每次我改变方向时都会发生这种情况。

知道为什么会这样吗？

再次感谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-12-06T15:55:26.497

对我来说最好的解决方案似乎是使用 removeDialog(id) 而不是 dismissDialog(); 这种方式重复使用较少，但更安全（不会抛出任何东西）并且在改变方向时没有问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-07-31T16:06:35.580

在 Activity 的 onCreate 覆盖中显示对话框时，我遇到了这个问题。尝试将导致对话框显示的代码移动到 onPostCreate 覆盖中。这似乎对我有用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-03-25T08:44:05.467

我在这样的问题上浪费了一天时间，在调用dismissDialog时对话框没有被关闭。它发生在我第一次屏幕旋转之后，之后再也没有工作过。我一直在使用一个外部 AsyncTask ，它显式地传递了对状态的引用。

最后，解决方案非常简单......`removeDialog(int)`而不是`dismissDialog(int)`.

我一直在向自己证明我正在对正确的活动进行解雇，并检查事情被调用的次数等，但这是由幕后的一些诡计造成的。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-09-25T13:51:55.137

我最近也遇到了这个问题。我有一个包含许多活动的应用程序，所有活动都需要访问全局对象（数据库连接、数据列表等），因此我覆盖了 Application 类。为此，我意识到我所需要的只是引用我用来关闭对话框的可运行文件中的进度对话框的最新实例。这就是我想出的，它优雅地在手机重新定向后幸存下来：

```
@Override
public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    addPreferencesFromResource(R.xml.preferences);

    mHandler = new Handler();
    mApplication = (MyApplication)getApplication();

    mFileStorage = (CheckBoxPreference)getPreferenceScreen().findPreference("fileStorage");

    mProgressDialog = new ProgressDialog(this);

    mProgressDialog.setTitle("Location Update");
    mProgressDialog.setMessage("Moving databases to new storage location.");
    mProgressDialog.setIndeterminate(true);
    mProgressDialog.setCancelable(false);
    mProgressDialog.setCanceledOnTouchOutside(false);

    mApplication.setProgressDialog(mProgressDialog);
}

@Override
protected void onResume() {
    super.onResume();

    mPreferences = PreferenceManager.getDefaultSharedPreferences(this);
    mPreferences.registerOnSharedPreferenceChangeListener(this);

    if (sUpdateThread != null && sUpdateThread.isAlive()) {
        mProgressDialog.show();
    }
}

@Override
protected void onPause() {
    super.onPause();

    mPreferences.unregisterOnSharedPreferenceChangeListener(this);

    if (sUpdateThread != null && sUpdateThread.isAlive()) {
        mProgressDialog.hide();
        mApplication.setProgressDialog(null);
    }
} 
```

....随机的东西在这里....

```
private Runnable showProgressRunnable = new Runnable() {
    public void run() {
        mProgressDialog.show();
    }
};

private Runnable hideProgressRunnable = new Runnable() {
    public void run() {
        if (mApplication.getProgressDialog() != null) {
            mApplication.getProgressDialog().dismiss();
        }
    }
}; 
```

我的线程在任务开始时执行 mHandler.post(showProgressRunnable)，然后在任务完成时执行 mHandler.post(hideProgressRunnable)。由于对最新 ProgressDialog 的引用现在存储在 Application 类中，因此我可以可靠地关闭它，因为我不再保留旧的对象引用。

后代链接：http: [//developer.android.com/reference/android/app/Application.html](http://developer.android.com/reference/android/app/Application.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-01-09T02:18:39.890

按下主页按钮并导航到应用程序 morelocal（更改设备语言）后，当我回到我的应用程序时，无法通过dismissDialog关闭新对话框（我从活动 onCreate 启动了对话框）。

解决方案是调用 removeDialog 而不是 dissmissDialog()。上面的哈里已经推荐了这一点，谢谢。

我创建了一个 Android 错误报告：

[13858](http://code.google.com/p/android/issues/detail?id=13858)

* * *

解决方案是使用 OnPostCreate 而不是 OnCreate 创建您的对话框。我将该信息添加到错误报告中，并建议改进[对话框文档](http://developer.android.com/guide/topics/ui/dialogs.html)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-23T17:34:13.227

请注意，每次更改方向时，都会创建您的`Activity`（以及您的`Dialog`via `onCreateDialog`）的新实例。您可以通过在任一构造函数中添加日志语句来验证这一点。

尽管如果不看一下您的代码就很难说，但我猜您正在调用`dismissDialog`您的`Activity`.

考虑以下内容，当单击按钮时`Activity`仅显示一个空白并在 10 秒后开始将其关闭：`Dialog``TimerTask`

```
public class Test extends Activity {

    private Dialog dialog;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);     
        setContentView(R.layout.test);
        Button btn = (Button) findViewById(R.id.testButton);
        btn.setOnClickListener(new OnClickListener() {
            public void onClick(View v) {
                new Timer().schedule(new TimerTask() {
                    @Override public void run() { dialog.dismiss(); }
                }, 10000);
                Test.this.showDialog(1);
            }
        });
    }

    @Override
    protected Dialog onCreateDialog(int id) {
        if(id == 1) {
            if(dialog == null) { dialog = new Dialog(this); }
            return dialog;
        }
        return super.onCreateDialog(id);
    }
} 
```

此代码存在与您所描述的类似的问题：如果 - 在 10 秒内 - 方向发生变化，`Dialog`则永远不会被解雇。*为什么？*因为在`TimerTask`is时，已经创建`run`了一组完全不同的`Test`and实例（在方向更改期间），并且的实例变量引用了一个与屏幕上当前活动的实例不同的实例。`Dialog``TimerTask``dialog``Test`

显然有几种方法可以解决这个问题（主要取决于您的应用程序），修复上述代码的一种快速（肮脏？）方法是简单地制作`dialog`字段`static`：

```
private static Dialog dialog;
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-22T17:17:47.753

在搜索了各种论坛之后，我只是做了以下事情：

我从我的处理程序的 handleMessage(myMessage) 方法中调用 showDialog(MyDialogID) AND dismissDialog(MyDialogId)。

在此之前，我在 onCreate()-Method 中调用了 showDialog，并试图在 handle-Message 中关闭对话框。为什么这解决了问题，我不知道。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-01-20T12:56:22.780

我正在尝试同样的问题。我在回调中创建了一个`AlertDialog`和一个，并从. 直接在（不使用）中创建这些对话框并在为我工作时将它们解散！基于[https://stackoverflow.com/a/5693467/955619](https://stackoverflow.com/a/5693467/955619)`ProgressDialog``onCreateDialog()``onCreate()``onCreate``onCreateDialog()``onPause()`

# oracle - 中止 PL/SQL 程序

> ID：891458
> 
> 赞同：25
> 
> 时间：2009-05-21T05:06:54.857
> 
> 标签：oracle, plsql

如何让 PL/SQL 程序中途结束？如果发生异常，我无法找到任何方式优雅地结束程序 - 如果我处理它，它会循环回到代码中。

基本上我想要做的是强制应用程序不在某些条件下运行。所以，我想在程序的顶部添加这样的内容：

```
BEGIN
    IF [condition]
        EXIT
    END IF
    [the rest of the program]
END 
```

建议的方法是抛出异常，但该块很可能是一个内部块 - 所以块外的程序会继续运行。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-05-21T05:50:11.860

您可以使用返回

```
MWATSON@> set serveroutput on
MWATSON@> !cat test.sql

BEGIN
 IF 1 = 1 THEN
    DBMS_OUTPUT.PUT_LINE('ABOUT TO EXIT');
    RETURN;
  END IF;
  DBMS_OUTPUT.PUT_LINE('DID NOT EXIT');
END;

MWATSON@> @test
  8  /
ABOUT TO EXIT

PL/SQL procedure successfully completed.

MWATSON@> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-04-18T14:22:50.390

我知道现在回复为时已晚，但我还有一种在前面的答案中没有提到的方法。

使用 RAISE_APPLICATION_ERROR 并在 EXCEPTION 部分捕获此异常。由于这会回滚未提交的事务，因此请确保在需要时明确提交它们。

这样你就可以优雅地从程序中返回，而不是在使用 RETURN 时在 IF 块中进行异常处理。

我用这个作为参考。 [http://www.plsql-tutorial.com/plsql-exception-handling.htm](http://www.plsql-tutorial.com/plsql-exception-handling.htm)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-21T05:56:44.113

如果您引发了该块未处理的异常，则该异常始终会引发给调用者。所以停止处理的最简单方法是引发一个在调用堆栈中任何地方都没有处理的异常。

例如

```
DECLARE
    e_halt_processing EXCEPTION;
BEGIN
    IF [condition] THEN
        RAISE e_halt_processing;
    END IF;
    [the rest of the program]
END; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T05:39:49.140

我不知道 PL/SQL 但你为什么不试试（用你的话）：

```
BEGIN
    IF [!condition]
        [the rest of the program]
    END IF
END 
```

只是想

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-03T19:53:33.113

只要您使用顺序（非嵌套）pl/sql 块和单独的异常处理，那么 RAISE 就可以很好地工作。如果您在嵌套块中 RAISE 异常，请注意竞争条件。

# visual-c++ - Microsoft Visual C++ 在构建项目时没有响应

> ID：891465
> 
> 赞同：0
> 
> 时间：2009-05-21T05:11:47.833
> 
> 标签：visual-c++, building

当我构建时，VC++ 6 将显示“正在链接...”并且程序永远不会被链接。我试过按 STOP 但没有用。我什至不能关闭 VC++，因为它说它仍在构建一个项目。

我该如何解决？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-22T04:26:19.577

在项目的属性中，在 Linker 选项卡下，设置 /VERBOSE 标志，它可能会帮助您查看正在加载的内容以及阻塞的位置。准备好终止任务（在开始之前将任务管理器放在前台会很聪明。）另外，请做好准备，因为 /VERBOSE 标志会导致很多事情！的输出。但你的答案可能就在某个地方。

其他要检查的事项：您可能锁定了输出文件。如果您尝试链接作为您已经在运行的程序的一部分的可执行文件，它可能会挂在您身上（尽管我认为它更有可能给您某种“无法删除”的错误。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T05:23:47.700

在任务管理器中，结束任务“cl.exe”和/或“link.exe”。

# c# - VSTO 中的 Excel 控件

> ID：891468
> 
> 赞同：3
> 
> 时间：2009-05-21T05:12:11.640
> 
> 标签：c#, .net, excel, vsto

我正在寻找与 Excel 中的用户定义函数控件相同的控件

因此，例如，当您单击“平均”时，会弹出一个控件，允许您在文本框中输入 2 个数字。在文本框的右侧有一个按钮，单击该按钮可让您在 excel 中选择一系列值，并在选择时填充文本框。

任何人都知道 VSTO 或任何其他这样做的控件，所以我不必自己编写代码？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-11-14T18:41:38.743

它**确实**存在，但与您在 Excel 中找到的并不完全相同。掌握 Application 对象并调用[InputBox](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.excel._application.inputbox.aspx)方法。此方法可以显示多个不同类型的模态输入对话框。类型 8 是范围选择类型，这种类型 8 对话框有一个大文本框、一个确定按钮和一个取消按钮（但它缺少通常的范围选择图标）。当用户单击确定时，所选范围被验证并且输入框框方法返回结果。就像在“真实范围对话框”中一样，用户只能在此模式对话框打开时选择范围。

**C＃**

```
Application.InputBox("Select a Range","title",Type.Missing,Type.Missing,
                              Type.Missing,Type.Missing,Type.Missing, 8); 
```

然后使用返回的范围在 TextBox 中显示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-01T23:51:07.017

这不存在。您必须使用 .net 用户控件自己构建它。为了获得正确的行为，您可能必须在模式和非模式对话框之间切换，以进行范围选择。

通过 VSTO 或 Excel 对象模型库无法使用 excel 函数、描述和选择窗口。

# c - 联合元素对齐

> ID：891471
> 
> 赞同：24
> 
> 时间：2009-05-21T05:14:06.633
> 
> 标签：c, alignment, unions

如果我有一个联合，C 标准保证联合本身将与最大元素的大小对齐。

```
union U {
    long l;
    int i;
    short s;
    char c[2];
} u; 
```

但是它对联合内部单个联合元素的对齐有什么看法呢？下面的表达式是否保证为真？

```
(&u.l == &u.i) && (&u.i == &u.s) && (&u.s == &u.c[0]) 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-05-21T05:16:10.470

每个元素的开头与联合本身的地址对齐。

~~因此，您询问的表达式中的单个比较是正确的，但整个表达式是错误的，除非联合位于地址 0x0001。~~

*删除的文本适用于以下比较*：

```
&u.l == &u.i == &u.s == &u.c[0] 
```

*修改后的版本比较了不同的指针类型——指针应该被转换为 void 指针。*

* * *

我被要求引用标准 - 或确定标准的部分。

C99 - 第 6.7.2.1 节结构和联合说明符（第 14 段）：

> 一个指向联合对象的指针，经过适当的转换，指向它的每个成员（或者如果一个成员是一个位域，那么指向它所在的单元），反之亦然。

# c# - 需要 .NET 串行端口帮助，主要是在多个“数据包”中接收到的数据

> ID：891475
> 
> 赞同：2
> 
> 时间：2009-05-21T05:17:03.120
> 
> 标签：c#, .net, serial-port

我对通过.net 通过串行端口发送数据非常陌生，在实现 TCP 对应项后，我注意到使用串行端口不会那么容易！

因此，从顶部开始，我的串行双向通信实现几乎就在那里，我只是陷入了一些问题：-

1.  我的读取被拆分为多条消息，或者通过 COM 端口作为碎片响应接收，我不知道我可能需要什么设置，或者我应该如何以不同的方式编写代码来解决这个问题。什么可能导致这种情况？我在断点检查消息`SerialPort_DataReceived.`

基本上数据应该被发送为：

```
01: LS|DA090521|TI111043|q
02: PS|RN102|PTC|TA1040000|P#0|DA090521|TI111429|j 
```

但它正在被拆分（在每个请求读取的随机位置）

```
01: LS|DA090521|TI111
02: 043|q
03: PS|RN102|PTC|TA1
04: 0000|P#0|DA090521|TI111429|j 
```

**- 问题 1 已得到解答，感谢 Chris W. 和其他人！我现在有了我希望从片段逐步构建的消息（寻找 STX、{msg body}、ETX），然后在消息完全构建时执行一个操作，并使用线程安全队列进行处理，非常高兴.**

. 2\. 我收到一个“|” 几乎每个周期都读取符号，这是由于我以某种方式错误设置的命令，串行通信的工件，还是设备发送给我的东西？（不过我不这么认为，因为超级终端的连接表明这个字符没有被连续发送。）

。3\. 你能确认我在各自的方法中正确地读写数据吗？

谢谢大家也看我的另外两个问题。

相关代码如下：

```
...
    //                          COM3,    9600,     None,   8,        One
    SerialPort = new SerialPort(comPort, baudRate, parity, dataBits, stopBits);
    if (SerialPort.IsOpen) SerialPort.Close();
    // SerialPort.RtsEnable = true; // Request-to-send
    // SerialPort.DtrEnable = true; // Data-terminal-ready
    SerialPort.ReadTimeout = 150; // tried this, but didn't help
    SerialPort.WriteTimeout = 150; // tried this, but didn't help
    SerialPort.Open();

    SerialPort.DataReceived += new SerialDataReceivedEventHandler(SerialPort_DataReceived);
}

void SerialPort_DataReceived(object sender, SerialDataReceivedEventArgs e)
{
    // Process received data
    SerialPort sp = (SerialPort)sender;
    byte[] buffer = new byte[sp.BytesToRead];
    int bytesRead = sp.Read(buffer, 0, buffer.Length);

    // message has successfully been received
    message = Encoding.ASCII.GetString(buffer, 0, bytesRead);
}

public bool SendMessage(string text)
{
    // Only send message if a client is connected
    if (SerialPort != null && SerialPort.IsOpen)
    {
        byte[] buffer = Encoding.ASCII.GetBytes(text);
        SerialPort.Write(buffer, 0, buffer.Length);
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T05:34:12.187

> 我的阅读被分成多条消息

这是正常的、预期的、不可避免的行为。它也可能发生在 TCP 上的数据上。对于串行接口来说，它只是无穷无尽的字节流。将这些字节重新打包成数据包是您的应用程序的责任。

如果数据包边界的位置很重要，并且如果您无法通过查看接收到的数据来判断数据包边界应该在哪里，那么您可能需要重新考虑数据的格式，以便您*可以*判断数据包的位置边界是。

> 我收到一个“|” 几乎每个周期都通过我的阅读符号

该字符的十六进制值是多少？查看是否将`Handshake`属性设置为`XOnXOff`或`RequestToSendXOnXOff`改善情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T05:37:18.533

在较低级别，串行端口可以决定何时触发数据接收事件。它可能会在“完整”数据包到达之前决定这样做。但是，看起来您的预期数据集中有一个终止符。如果是这样，您可以执行以下操作（请注意，我已更改您的 SerialPort 分配以避免语法混淆：

```
 p = new SerialPort(PortName, BaudRate, Prty, DataBits, SBits);
        p.NewLine = Terminator; 
```

其中 Terminator 是包含终止字符的字符串。然后你可以使用 SerialPort.ReadLine() （和 SerialPort.WriteLine() 如果适用）。这可能至少对您的第一个问题有所帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-21T06:17:40.093

我已经完成了很多 Win32 串行端口编程，但只使用了一点 .NET，所以请接受我的建议。

> 我的读取被拆分为多条消息，或者通过 COM 端口作为碎片响应接收，我不知道我可能需要什么设置，或者我应该如何以不同的方式编写代码来解决这个问题。

正如其他人所说，这是完全正常的。根据 DCE 端的设备类型，您可能需要自己重新包装。我不确定你连接的是什么类型的设备，所以我不能说更多。

如果您想获取更多数据，可以尝试以下方法：

*   调整 System.Int32 ReceivedBytesThreshold 属性
*   使用同步 I/O 并指定要读取的固定字节数，而不是基于事件的接收

> 我收到一个“|” 几乎每个周期都读取符号，这是由于我以某种方式错误设置的命令，串行通信的工件，还是设备发送给我的东西？（不过我不这么认为，因为超级终端连接表明这个字符没有被连续发送。）

如果您对线路上发生的事情感到好奇，请查看来自[SysInternals 的 PortMon](http://technet.microsoft.com/en-us/sysinternals/bb896644.aspx)，这是一个免费应用程序，可在您通过线路传输数据时窥探您的 com 端口。这似乎是技术性的，但实际上您只需要查看 IRP_MJ_WRITE 和 IRP_MJ_READ 命令，就可以看到以字节为单位的长度以及通过线路发送的数据。有了这个，您应该能够判断问题是 .NET SerialPort 对象还是设备实际上正在发送“|” 越线。

> 您能否确认我在各自的方法中正确读取和写入数据。

它看起来适合基于事件的数据接收方法。

# php - 基本的 php 正则表达式问题

> ID：891477
> 
> 赞同：2
> 
> 时间：2009-05-21T05:17:54.977
> 
> 标签：php, regex

我有一个 html 文件，我想在其中获取这两个标签中的所有文本：

```
<div class="articleTitle">
</div> 
```

我不完全确定如何执行 php 正则表达式。（我也知道div里面没有html标签，所以嵌套标签没问题）

更新：当我尝试给出的解决方案时，我得到这个：警告：preg_match（）[function.preg-match]：第29行的未知修饰符'd'

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T05:21:21.527

```
preg_match('/<div class="articleTitle">(.*?)<\/div>/i', $source, $matches);
print_r($matches); 
```

这是来自 RegexBuddy 的“解释”：

```
<div class="articleTitle">(.*?)</div>

Options: case insensitive

Match the characters “&lt;div class="articleTitle">” literally «<div class="articleTitle">»
Match the regular expression below and capture its match into backreference number 1 «(.*?)»
   Match any single character that is not a line break character «.*?»
      Between zero and unlimited times, as few times as possible, expanding as needed (lazy) «*?»
Match the characters “&lt;/div>” literally «</div>»

Created with RegexBuddy 
```

(.*?) 将捕获它之前的内容到之后的内容之间的所有内容，并将其放入 $matches 变量中。

我假设 HTML 将在 $source 变量中。

我建议您查看[RegexBuddy](http://www.regexbuddy.com/)，它是 39.95 (USD)，但值得每一分钱。它可以帮助构建您的 RegEx 与大多数主要的 RegEx 实现，它可以帮助您学习 RegEx

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T12:14:31.907

错误的答案！

```
preg_match('#<div\s+[^>]*class="articleTitle"[^>]*>(.*)</\s*div>#ims', $str, $matches); 
```

1.  DIV 可以为空，因此 (.+) 之类的模式是错误的。
2.  你应该使用“m”修饰符 - 内容可以是多行的。
3.  您应该使用“s”修饰符将点元字符匹配为换行符。
4.  只是想知道，如果 php 中的模式可以有任何分隔符，为什么要转义斜杠？在这种情况下，我通常使用 # 作为分隔符。
5.  DIV 可以有其他属性和/或空格字符（包括换行符）。

抱歉，没时间好好测试模式，但它似乎是正确的。这应该在任何情况下都有效。

PS：还有，GONeale，关于贪婪 - 模式必须是贪婪的，它是贪婪的，没有修饰符“U”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T05:20:41.823

这会更正确，因为其他解决方案会匹配 <div class="articleTitle"><div/> 本身，这可能是不可取的？

```
preg_match('<div class="articleTitle">(.+?)</div>', $test_string, $matches); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T05:23:12.490

```
'/<div class="articleTitle">(.*?)<\/div>/' 
```

通常会起作用；但是，如果您需要考虑 div 标签中的其他可能属性，它会稍微复杂一些。

# javascript - 如何让 jquery css 容器弹出让用户知道数据已成功输入？

> ID：891488
> 
> 赞同：0
> 
> 时间：2009-05-21T05:21:54.100
> 
> 标签：javascript, jquery, html, css

当用户将数据插入表单然后提交时，它会转到我的 php 脚本并插入数据。该脚本将返回一个值，让用户知道数据是否已插入。由于我使用的是 JQuery，所以我不知道该怎么做。有人可以指出我正确的方向吗？我在这里所追求的只是一个漂亮、整洁的 200 像素 x 25 像素容器，它将淡入，用户必须单击它以确认它。

现在想来，既然用户不是港湾里最亮的灯，那如果我不仅能展示这个css框让他们知道插入是否成功，还能告诉他们插入的客户，那真是太酷了以防他们忘记了他们离开的地方。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T05:42:01.353

我不会将此标记为重复，但您实际上是在询问使用 jQuery 显示通知的最佳方式。这已经被[问过](https://stackoverflow.com/questions/770038/best-ways-to-display-notifications-with-jquery)了。简而言之，在您的基本设置中，您需要做的就是显示一个 div 并将其淡入，但是有很多插件可以处理更多情况。

至于向他们展示插入的客户或其他内容，您所要做的就是从服务器返回 JSON 响应，并使用 AJAX 请求的成功回调来处理它。然后，您将有权访问从服务器传回的数据。

进一步解释一下：您似乎要求做的是如何使用 Ajax 向服务器发送请求，获得一切按预期进行的通知，然后根据发生的情况在网页中显示通知。如果这是正确的，我将继续进行这些假设。

让我们组合一个简单的表单来将新客户添加到一个虚构的网站。它可能看起来像这样：

```
<form action='add_customer.php' method='POST' id='add_customer_form'>
    First Name: <input type='text' name='first_name'><br>
    Last Name: <input type='text' name='last_name'><br>
    Email: <input type='text' name='email'><br>
    <input type='submit' value='Add Customer'>
</form> 
```

现在，我们处理表单提交（通过 AJAX）的**幼稚、不安全**的PHP 代码可能看起来像这样。我说幼稚和不安全是因为你会做更多的数据验证（因为你*从不*相信来自客户端的任何东西）并且肯定需要清理数据以防止 SQL 注入。但是，这是一个示例，因此它可能如下所示：

```
$first_name = $_POST['first_name'];
$last_name = $_POST['last_name'];
$email = $_POST['email'];
if(mysql_query("
    INSERT INTO customers
    (first_name, last_name, email)
    VALUES 
    ('$first_name','$last_name','$email')
   ")) {
    $success = 1;
    $message = 'Customer ' . $first_name . ' successfully added!';
} else {
    $success = 0;
    $message = 'Something went wrong while adding the customer!';
}
print json_encode(array('success' => $success, 'message' => $message)); 
```

然后，我们可以使用 jQuery 处理此表单的发送和从服务器接收数据，代码看起来像这样：

```
$(function() {
    $('#add_customer_form').submit(function() { // handle form submit
        var data = $(this).serialize(); // get form's data
        var url = $(this).attr('action'); // get form's action
        var method = $(this).attr('method'); // get form's method
        $.ajax({
            url: url, // where is this being sent to?
            type: method, // we're performing a POST
            data: data, // we're sending the form data
            dataType: 'json', // what will the server send back?
            success: function(data) { // the request succeeded, now what?
                // here data is a JSON object we received from the server
                // data.success will be 0 if something went wrong
                // and 1 if everything went well. data.message will have
                // the message we want to display to the user
                // at this point you would use one of the techniques I linked
                // to in order to display a fancy notification

                // the line below will dynamically create a new div element,
                // give it an ID of "message" (presumably for CSS purposes)
                // and insert the message returned by the server inside of it
                var $div = $('<div>').attr('id', 'message').html(data.message);

                if(data.success == 0) {
                    $div.addClass('error'); // to personalize the type of error
                } else {
                    $div.addClass('success'); // to personalize the type of error
                }
                $('body').append($div); // add the div to the document
            }
        });
        return false; // prevent non-ajax form submission.
    });
}); 
```

我没有测试过任何这段代码，但想法就在那里。您从服务器返回带有数据的格式 JSON，并处理请求完成时 jQuery 触发的成功回调，并向您的文档添加一个元素，您可以根据需要设置样式（`fadeIn()`如果需要，还可以显示）带有描述发生了什么的消息。您可能还需要捕获错误回调（如果您的服务器由于某种原因没有响应，则会触发该回调）并在这种情况下触发另一个警报。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T05:38:35.503

可以通过执行以下操作之一来实现[淡化效果：](http://docs.jquery.com/Effects)

```
jQuery(myDiv).fadeIn()
jQuery(myDiv).fadeOut()
jQuery(myDiv).fadeTo() 
```

我建议您首先创建这个 css 框 - 创建 html 和 css。然后你可以尝试淡入淡出——jQuery 允许你指定淡入淡出颜色、淡入淡出持续时间等参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T05:48:17.743

这里有一些工作......

您的 PHP 脚本会根据结果输出此内容

```
$json = array(
    'success' => $insertSuccess,
    'message' => $numRecords . ' records inserted in ' . $insertTime . 's'
);

echo json_encode($json); 
```

然后，在 JSON 的回调中，您通过解析 JSON 对象来确定插入是否成功。您的回调可能看起来像这样

```
function(data) {

    success = data.insertedSuccess;

    if (success) {
         $('#success').fadeIn(1000);
    } else {
         $('#failure').fadeIn(1000);
    }

} 
```

# asp.net - asp.net：在字典常量时间或 log2(n) 中按键搜索值的时间复杂度是多少？

> ID：891492
> 
> 赞同：1
> 
> 时间：2009-05-21T05:22:36.033
> 
> 标签：asp.net, search, data-structures, dictionary, time-complexity

我需要一个 dotnet 中的数据结构，我可以在恒定时间内搜索一个项目。这意味着数据结构应该在内部实现索引。字典用于此目的还是其他目的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T05:26:04.720

是的，使用 Dictionary<>（如果您使用的是旧版本的 .NET，则使用 Hashtable）。确保您在字典中填充的对象具有良好的哈希值（查看覆盖 GetHashCode() 和 Equals() 为您用作字典中的键的对象）。如果您的数据对象的哈希码较差，性能将开始下降。是的，要回答您的问题，在哈希表/字典中查找应该是相对恒定的时间（书籍通常说它是 O(1)，但这是有争议的）。查找性能将由许多因素决定：

1.  哈希函数（确定分布）
2.  表如何处理冲突？试探？桶？（大多数实现使用存储桶）。
3.  表可以调整大小吗？它如何调整大小？小增量？2的幂？质数？
4.  ETC...

# asp.net - 我可以使用 Visual Studio 2010 开发 asp.net 3.5/2.0 项目吗？

> ID：891507
> 
> 赞同：14
> 
> 时间：2009-05-21T05:27:45.047
> 
> 标签：asp.net, visual-studio-2010, .net-4.0, compatibility

我可以使用 Visual Studio 2010 开发 asp.net 3.5/2.0 项目吗？还是我会坚持使用 .Net Framework 4.0？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-21T06:21:43.507

![替代文字](https://lh3.ggpht.com/_uWueLlLrTdY/ShRBlgkISuI/AAAAAAAABss/f1lYs1Lccv0/NewProject_thumb%5B6%5D.png?imgmax=800)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-05-21T05:31:19.130

来自[MSDN VS 2010](http://msdn.microsoft.com/en-us/vstudio/dd441784.aspx)

> Visual Studio 的多目标功能允许您指定应用程序所需的 .NET Framework 版本或其配置文件。多目标的主要好处是您可以使用当前版本的 Visual Studio 创建和开发面向早期版本 .NET Framework 的项目。例如，您可以继续开发在 Visual Studio 2008 中创建的项目，而无需添加新的 .NET Framework 依赖项。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-21T05:45:25.310

是的，您可以使用 Visual Studio 2010 开发 2.0 和 3.5 ASP .NET 项目，以及其他许多其他类型的项目。当我们构建多目标支持时，我们对 Web 开发特别敏感，因为它不现实期望用户会立即升级他们的服务器。在许多情况下，这甚至是不可能的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-03T15:25:09.810

我有一个使用 VS 2008 在 3.5 版中开发的项目。我现在已经安装了 VS 2010，当我打开项目时，第一个屏幕显示“欢迎使用 Visual Studio 转换向导”，表示必须转换项目。所以看起来 Wally 是正确的——即使框架保持不变，文件也会有所不同。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-30T21:09:59.480

如果您使用单元测试，则不会。

![尝试重新定位该项目已被取消。 您不能更改测试项目的指定 .NET 框架版本或配置文件。](https://i.stack.imgur.com/TvJyQ.png)

是的，已安装 SP1： ![VS2010sp1的卸载入口](https://i.stack.imgur.com/OKNE9.png)

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2010-02-14T17:57:48.000

不，你不能。您可以定位框架版本，但项目/解决方案文件不同。VS 2008 抱怨。这是 MS 对开发人员不友好。

# project-management - 您如何跟踪花在项目上的时间？

> ID：891510
> 
> 赞同：1
> 
> 时间：2009-05-21T05:30:35.137
> 
> 标签：project-management, time

我不是在寻找任何复杂或企业的东西。我想知道是否存在一些简单的东西，我可以“打出”并说出我在做什么。我对我在不同项目上花费的时间以及我每天实际工作的时间都很感兴趣。命令行工具会更好，但请随意推荐任何您认为有用的东西。它必须在 Unix-line 操作系统上运行（至少 Linux、Mac 也可以，但并不重要）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-21T05:38:31.777

我仍然使用并且更喜欢大红皮书的时间监控方法。我从未设法找到任何与该方法一样可移植的应用程序。

它包括随身携带一本大红皮书（不，是认真的），然后写下你正在做的事情。

然后，如果它需要进入应用程序，我会在一天结束时这样做。这样一来，我就不会因为切换应用程序或必须确保随身携带笔记本电脑而烦恼。我的大红皮书仍然让超薄 Mac 在以下方面感到羞耻：

*   重量。
*   能源管理。
*   开机时间。
*   可靠性（始终携带备用笔）。

有时最好的应用程序是没有应用程序。这是我的观点，它对我有用，但其他人可能会有所不同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T06:53:18.387

[我在工作中使用名为FogBugz](http://www.fogcreek.com/FogBugz/)的错误跟踪软件。它允许我针对我添加到其中的案例记录时间。它也完全基于网络。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T05:32:34.497

你可能会喜欢这个：[时间日志](http://www.kloonigames.com/blog/general/timelog)。项目页面在[这里](http://timelog.sourceforge.net/wiki/index.php/Main_Page)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T05:45:50.693

和 Pax 一样，我使用一键式短信系统。我首选的工具是一个项目笔记本（每个项目/客户一个）和一支装满 Private Reserve Lake Placid Blue 墨水的钢笔。

我尝试过自动化系统、在线程序，并且曾经定制过一个 ASP.Net Starter Kit。我总是回到笔记本上。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-21T06:04:14.230

您可能想查看一个非常有趣的基于 Eclipse 的产品。它被称为[Tasktop](http://tasktop.com/)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-21T07:54:44.690

Eclipse 的 Mylyn。它与多个问题跟踪系统集成。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-21T06:55:45.370

我使用[小时守卫](http://www.nchsoftware.com/timesheet/index.html)。
特点：
1- 记录时间表。
2- 生成 PDF 或 CSV 格式的定期报告
3-**免费**

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-21T07:04:47.397

使用[redmine](http://www.redmine.org/)。您可以使用[bitnami 堆栈安装](http://bitnami.org/stack/redmine)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-21T07:28:14.340

我已经开始使用[番茄工作](http://www.pomodorotechnique.com/)法。25m 的时间盒使跟踪时间变得非常容易。在一天结束的时候，我只是简单地计算每个项目/任务等完成的时间框数量。

我实际上将我的一天记录在纸上（然后通读它们以进行高级审查），但是您可以轻松下载[PomodoroTimer](http://code.google.com/p/pomodorotimer/)的源代码并对其进行改进以将数据记录到文件等。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-21T07:53:51.527

有时我使用 Microsoft Office Outlook Journal 来查看我的时间都花在了哪里，但似乎 Journal 只自动记录 Office 文档。如果它可以使用 Visual Studio 记录花费的时间，那就太好了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-06-22T12:11:59.747

我开始使用名为[Toggl](https://www.toggl.com/)的免费时间跟踪服务，并且非常喜欢它，因此我获得了付费版本。

如果你正在寻找更复杂和正式的东西，你应该从软件工程学院的人那里研究[个人软件过程 (PSP) 。](http://www.processdash.com/download)它有很好的文档和培训指南，从长远来看会受益。

# sql-server - 是否可以将 SQL Server 2008 数据库的备份恢复到 SQL Server 2000 实例上？

> ID：891512
> 
> 赞同：2
> 
> 时间：2009-05-21T05:31:44.590
> 
> 标签：sql-server, backup, sql-server-administration

是否可以将 SQL Server 2008 数据库的备份恢复到 SQL Server 2000 实例上？

我需要处理数据库备份在 sql server 2008 中的示例应用程序。但是我将无法安装 2008。那么是否可以在 2000 中恢复该备份？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T05:51:43.543

无法将数据库从较新版本的 SQL Server 还原到较旧版本。您应该在 SQL Server 2000 实例中创建一个新数据库，然后使用导入或导出工具将数据从 2008 db 获取到 2000 db。一些谷歌搜索发现了这个： [http ://www.eggheadcafe.com/conversation.aspx?messageid=34399091&threadid=34399086](http://www.eggheadcafe.com/conversation.aspx?messageid=34399091&threadid=34399086)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T05:55:51.697

简答NO。再次长回答不！您可以从 SQL Server 2008 生成脚本并在 SQL Server 2000 上运行它们。在此处完成演练。 [http://www.devx.com/dbzone/Article/40531](http://www.devx.com/dbzone/Article/40531)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T08:24:49.217

不幸的是，正如其他海报所提到的，这是不可能的。

解决方法，而不是生成一堆脚本等。我建议您使用 SQL Server Integration Services (SSIS) 传输数据库任务。

[http://technet.microsoft.com/en-us/library/ms141204.aspx](http://technet.microsoft.com/en-us/library/ms141204.aspx)

# wpf - 文本框仅包含字母、数字和空格

> ID：891518
> 
> 赞同：3
> 
> 时间：2009-05-21T05:33:19.003
> 
> 标签：wpf

我可以确保用户只能在 WPF 中的 KeyDown 事件的文本框中输入字母数字和空格吗？不允许使用特殊字符。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-26T08:58:52.880

检查文本框的 keydown 事件并执行

```
 // If escape is presses, then close the window.
            if( Key.Escape == e.Key )
            {
                this.Close();
            }
            // Allow alphanumeric and space.
            if( e.Key >= Key.D0 && e.Key <= Key.D9 ||
                e.Key >= Key.NumPad0 && e.Key <= Key.NumPad9 ||
                e.Key >= Key.A && e.Key <= Key.Z ||
                e.Key == Key.Space )
            {
                e.Handled = false;
            }
            else
            {
                e.Handled = true;
            }

            // If tab is presses, then the focus must go to the
            // next control.
            if( e.Key == Key.Tab )
            {
                e.Handled = false;
            } 
```

希望这会有所帮助......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-05-27T11:40:25.293

您还可以使用文本框的 PreviewTextInput 事件。

```
<TextBox Name="txtName" PreviewTextInput="txtName_PreviewTextInput"/> 
```

并在后面的代码中添加以下内容：

```
private void txtName_PreviewTextInput(object sender, TextCompositionEventArgs e)
    {
        foreach (char c in e.Text)
        {
            if (!char.IsLetterOrDigit(c))
            {
                e.Handled = true;
                break;
            }
        }
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T13:03:34.100

KeyDown 事件处理程序可能不是执行此操作的最佳位置，因为该字符已添加到 TextBox。您可以响应 PreviewKeyDown 事件并阻止该事件继续，但这可能会产生未知的后果。

一种方法是将 ValidationRule 附加到 TextBox。虽然这不会阻止用户输入字符，但它会通知他们不允许输入。为此，您从 System.Windows.Controls.ValidationRule 派生以获得如下内容：

```
public class MyValidationRule : ValidationRule
{
    public override ValidationResult Validate(object value, CultureInfo cultureInfo)
    {
        // Logic to determine if the TextBox contains a valid string goes here
        // Maybe a reg ex that only matches alphanumerics and spaces
        if(isValidText)
        {
            return ValidationResult.ValidResult;
        }
        else
        {
            return new ValidationResult(false, "You should only enter an alphanumeric character or space");
        }
    }
} 
```

然后像这样在 XAML 中使用它：

```
<TextBox>
    <TextBox.Text>
        <Binding Path="MyString"
                 UpdateSourceTrigger="PropertyChanged">
            <Binding.ValidationRules>
                <myns:MyValidationRule />
            </Binding.ValidationRules>
        </Binding>
    </TextBox.Text>
</TextBox> 
```

每次用户输入无效字符时，他们都会收到错误消息。希望这有点用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-12-03T17:26:00.413

我认为使用 KeyDown 不是一个好习惯。缺点是您还必须处理 Backspace、delete 和 tab 键。

而是：处理 PreviewTextInput

```
private void OnPreviewTextInput(object sender, TextCompositionEventArgs e)
    {
        if (!IsMatch(e.Text)) e.Handled = true;
    }

    private bool IsMatch(string input)
    {
        return Regex.IsMatch(input, MyRegexString);
    } 
```

然后必须照顾PasteHandler：在构造函数中添加以下行。

```
DataObject.AddPastingHandler(TargetTextBoxName, PasteHandler);

   private void PasteHandler(object sender, DataObjectPastingEventArgs e)
        {
            if (!e.DataObject.GetDataPresent(typeof(string))) return;
            // Allow pasting only numeric
            var pasteText = e.DataObject.GetData(typeof(string)) as string;
            if (!IsMatch(pasteText))
            {
                e.CancelCommand(); 
            }
        } 
```

# string - hw 在索引字符串列表中搜索子字符串？

> ID：891519
> 
> 赞同：1
> 
> 时间：2009-05-21T05:33:51.827
> 
> 标签：string, dictionary, indexing

我正在实现字典，其中键是字符串关键字。假设我在字典中有以下键。

mat **hon** sat **hon** lat **hon**

现在，如果我搜索单个关键字，假设 mathon 它将在恒定时间内搜索它。但如果我要搜索，**我**希望在恒定时间或最短时间检索所有三个单词，就像在谷歌搜索的情况下一样。我的应该是什么方法？并且是字典正确的数据结构吗？

字典的值是我需要向用户显示的项目列表，搜索可以基于多个关键字。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T07:08:45.470

如[本文](http://www.ericsink.com/downloads/faster-scrabble-gordon.pdf)所述，gaddag可能是您最好的选择。它是 trie 的一种变体，可让您开始搜索单词中的任何位置，并且可以向前和向后移动。这不是 O(1) 查找，但它非常快并且具有合理的空间使用率。

编辑：对于多个关键字，您可以简单地单独搜索每个关键字，然后根据情况进行设置交集或联合。它可能比您想象的要快；至少值得作为最简单的算法实现，并且只有在分析时证明它是实际瓶颈时才丢弃。

# html - 为什么 emspace 或 enspace 会破坏 HTML 中的 CSS 字体行高？

> ID：891521
> 
> 赞同：0
> 
> 时间：2009-05-21T05:34:51.013
> 
> 标签：html, css, fonts, spaces

对浏览器 - 任何浏览器 - 因为它正在发生，如何计算 emspace 和 enspace 感到困惑。这就是发生的事情：我正在使用一种名为 Gentium 的免费字体。字体大小为 16px 行高为 19px

一切看起来都很好。不间断空格 -   不是问题 - 作为字符存在于字体中。薄空间  也工作正常。

但是如果我尝试使用：  (#8194) 或   (#8195)

浏览器确实创建了一个正确宽度的空间，但它似乎也有一个高度，尽管有 CSS 行高规则，但整行文本都会被向下推。有人知道发生了什么吗？字符 #8194 和 #8195 通常不包含在字体文件中。浏览器是如何计算的？（通常它工作正常。）如果字体文件中缺少字符，它会从哪里提取字符？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T05:40:29.573

对于浏览器来说，它肯定只是另一个字符......并且，从某个字体文件中提取......显然没有与您的 Gentium 字体相同的度量（例如行高）。

# artificial-intelligence - 编程中的预测逻辑？

> ID：891528
> 
> 赞同：1
> 
> 时间：2009-05-21T05:39:29.887
> 
> 标签：artificial-intelligence, logic, prediction, predict

我在想，在可能遥远的未来，很多人认为我们不会那么依赖物理输入（即键盘），因为可以使用读取脑电波的技术（在某种程度上已经存在）。有点吓到我了……不管怎样，当我做白日梦的时候，我突然想到：如果程序员可以在他们的代码中实现逻辑来准确预测用户的意图，然后无需执行预期的操作，那会怎样？用于人机交互。我不是在寻找任何具体的东西，我只是对任何人的想法有点好奇。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T06:08:41.540

当前完成的许多“预测”逻辑是通过统计技术完成的。

例如，在某些应用程序中，经常使用的菜单项可以突出显示，而较少使用的功能将被隐藏，直到用户明确要求查看所有可用功能。

但是，这并不意味着他们可以读懂你的想法。

为了使统计模型起作用，它们需要有某种训练期。这也有效，因为我们倾向于以模式执行操作。例如，如果您在过去 10 天中的 10 天都这样做，那么您明天早上起床、刷牙和喝咖啡的可能性就很大。

以下是一些可能感兴趣的主题：

*   [维特比算法](http://en.wikipedia.org/wiki/Viterbi_algorithm)
*   [隐马尔可夫模型](http://en.wikipedia.org/wiki/Hidden_Markov_model)

未来有没有办法预测一个人未来的想法？可能。但是会有一些困难，因为人类并不总是可以预测的。这就是为什么不需要太多思考的重复性任务可以由机器人自动化，而需要认知思考的任务（如编程）不能被机器取代。

这带来了另一个想法——如果有一个程序可以准确地预测程序员想要写什么？那么是否需要程序员？此外，这不是说程序实际上能够思考吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T05:41:19.200

如果只有计算机也可以回滚你的记忆，它似乎每次都能正确预测！

（见回溯）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T06:12:21.707

在更实际的方面，我的第一个想法是观察用户行为并通过网络连接以共享和汇总这些知识的程序，例如

“中止、重试还是取消？（10 个用户中有 9 个选择中止 - 按 Enter 执行相同操作）”

“预测”是一个词吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T06:28:36.630

我认为在这样的系统能够工作之前需要进行**大量的培训。**人工任务的推测执行并不容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T07:18:44.357

看一下[DWIM](http://catb.org/~esr/jargon/html/D/DWIM.html)（Do What I mean）的定义。

# ruby - 检测安装的 CPU 数量

> ID：891537
> 
> 赞同：41
> 
> 时间：2009-05-21T05:42:49.387
> 
> 标签：ruby

我已经通过 找到了“大多数 unixes”的解决方案`cat /proc/cpuinfo`，但是纯 Ruby 解决方案会更好。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2015-12-11T02:30:48.437

从 Ruby 版本 2.2.3 开始，[`etc`](http://ruby-doc.org/stdlib-2.2.3/libdoc/etc/rdoc/Etc.html)Ruby 的 stdlib 中的模块提供了一个[`nprocessors`](http://ruby-doc.org/stdlib-2.2.3/libdoc/etc/rdoc/Etc.html#method-c-nprocessors)返回处理器数量的方法。对此需要注意的是，如果 ruby​​ 被降级为 CPU 内核的子集，`Etc.nprocessors`则只会返回 Ruby 可以访问的内核数。此外，正如[seanlinsley 所](https://stackoverflow.com/users/2651774/seanlinsley)指出的，这只会返回虚拟内核而不是物理内核，这可能会导致预期值的差异。

```
require 'etc'
p Etc.nprocessors #=> 4 
```

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-05-21T08:23:30.467

编辑：现在 rails 附带了 concurrent-ruby 作为依赖项，所以它可能是最好的解决方案；

```
$ gem install concurrent-ruby
$ irb
irb(main):001:0> require 'concurrent'
=> true
irb(main):002:0> Concurrent.processor_count
=> 8
irb(main):003:0> Concurrent.physical_processor_count
=> 4 
```

有关更多信息，请参阅[http://ruby-concurrency.github.io/concurrent-ruby/master/Concurrent.html](http://ruby-concurrency.github.io/concurrent-ruby/master/Concurrent.html)。因为它同时具有物理和逻辑核心，所以它比内置的`Etc.nprocessors`.

这是以前的答案；

```
$ gem install facter
$ irb
irb(main):001:0> require 'facter'
=> true
irb(main):002:0> puts Facter.value('processors')['count']
4
=> nil
irb(main):003:0> 
```

如果您还想了解有关系统的其他事实，那么这个[facter gem](https://github.com/puppetlabs/facter)是最好的，它不是特定于平台的，并且旨在完成这个确切的事情。

更新：更新包括 Nathan Kleyn 关于 api 更改的提示。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2011-06-21T05:39:27.077

我目前正在使用它，它涵盖了所有操作系统。 [https://github.com/grosser/parallel/blob/master/lib/parallel.rb#L63](https://github.com/grosser/parallel/blob/master/lib/parallel.rb#L63)

```
 def self.processor_count
    case RbConfig::CONFIG['host_os']
    when /darwin9/
      `hwprefs cpu_count`.to_i
    when /darwin/
      ((`which hwprefs` != '') ? `hwprefs thread_count` : `sysctl -n hw.ncpu`).to_i
    when /linux/
      `cat /proc/cpuinfo | grep processor | wc -l`.to_i
    when /freebsd/
      `sysctl -n hw.ncpu`.to_i
    when /mswin|mingw/
      require 'win32ole'
      wmi = WIN32OLE.connect("winmgmts://")
      cpu = wmi.ExecQuery("select NumberOfCores from Win32_Processor") # TODO count hyper-threaded in this
      cpu.to_enum.first.NumberOfCores
    end
  end 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-05-21T06:39:07.783

使用 JRuby，您可以使用以下 Java 代码对其进行检查：

```
 Runtime runtime = Runtime.getRuntime();   
 int numberOfProcessors = runtime.availableProcessors(); 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2011-06-06T09:32:10.147

这是 Linux、OSX、Windows 和 BSD 的实现：[https ://gist.github.com/1009994](https://gist.github.com/1009994)

源代码：

```
module System
  extend self
  def cpu_count
    return Java::Java.lang.Runtime.getRuntime.availableProcessors if defined? Java::Java
    return File.read('/proc/cpuinfo').scan(/^processor\s*:/).size if File.exist? '/proc/cpuinfo'
    require 'win32ole'
    WIN32OLE.connect("winmgmts://").ExecQuery("select * from Win32_ComputerSystem").NumberOfProcessors
  rescue LoadError
    Integer `sysctl -n hw.ncpu 2>/dev/null` rescue 1
  end
end

System.cpu_count # => 2 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-05-21T05:46:02.940

当然，如果可以`cat`的话，您可以使用该语言的标准功能打开、读取和关闭它，而无需使用`system()`-type 调用。

您可能只需要动态检测您所在的平台以及：

*   使用`/proc/cpuinfo`Linux 的“文件”；或者
*   与 Windows 的 WMI 通信。

最后一行可以使用：

```
require 'win32ole'
wmi = WIN32OLE.connect("winmgmts://")
info = wmi.ExecQuery ("select * from Win32_ComputerSystem") 
```

然后使用 info 的[NumberOfProcessors](http://msdn.microsoft.com/en-us/library/aa394102.aspx)项。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-10-19T08:52:30.010

我尝试使用`Facter`但发现它有点慢。我尝试`system`了 gem，发现它要快得多。它也很容易使用：`System::CPU.count`.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-03-11T17:19:21.713

在 linux 中，您也可以使用`nproc`，这比此处的其他基于 subshel​​l 的解决方案更干净。我希望 vagrant 为虚拟机提供与主机相同数量的 CPU。我将此添加到`Vagrantfile`：

```
vb.cpus = `nproc`.to_i 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-31T23:19:38.230

在 Mac 上：

thiago-pradis-macbook:~ tchandy$ hwprefs cpu_count

2

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-07-07T14:46:13.140

@格罗斯：

```
当 /linux/  
  `grep -c 处理器 /proc/cpuinfo`.to_i

```

[http://www.partmaps.org/era/unix/award.html#cat](http://www.partmaps.org/era/unix/award.html#cat)
[http://www.partmaps.org/era/unix/award.html#wc](http://www.partmaps.org/era/unix/award.html#wc)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-05-09T17:48:13.947

我最近发现了一些可能需要考虑的事情。您可以停用处理器（使它们脱机），然后将处理器计数（加上上面的一些其他方法）给出错误的结果。您可以在 /proc/cpuinfo 中计算处理器行数，只要您操作正确。如果你只是用 procs 的索引号填充一个数组，如果你在 procs 中有间隙（如，procs 0,1,2,10,11,12 是活动的，所有其他到 20 的人都说是非活动的），它会自动弹出索引 3-9 存在（有点），在这种情况下，至少 Array#size 将报告 13。您必须执行 #compact 才能获得活动处理器的数量。但是，如果您想要总处理器，也许更好的是查看 /sys/devices/system/cpu[0-9]，然后计算它。这将为您提供处理器总数，

只是想一想。我试图通过一个补丁来添加一个 activeprocessorcount 和 totalprocessorcount 事实。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-01-08T14:22:59.660

结合@grosser 和@paxdiablo 的答案，因为在我的系统（winxp）上，win32_computersystem 没有任何处理器信息；这虽然有效：

```
require 'win32ole'
wmi = WIN32OLE.connect("winmgmts://")
info = wmi.ExecQuery ("select NumberOfCores from Win32_processor")
puts info.to_enum.first.NumberOfCores 
```

要查看系统上可用的内容，请从[powershell](http://technet.microsoft.com/en-us/scriptcenter/dd772288)运行它（在这种情况下我使用 1.0）：

```
Get-WmiObject -list 
```

（如果您安装了 cygwin，可能需要通过管道连接到 grep）

# c# - WPF：使用绑定属性自定义数据模板

> ID：891538
> 
> 赞同：0
> 
> 时间：2009-05-21T05:43:17.093
> 
> 标签：c#, .net, wpf, xaml, binding

我是 WPF 的新手。我有一个 ListBox，我想在其中设置一个项目的模板（我称之为 Person）。将使用 TextBlock。该人必须公开属性：“前景”和“IsOnline”。如果“IsOnline”为真，我将使用此人的“Foreground”属性，否则使用“Gray”。就这样。我的第一个模板是：

```
<DataTemplate x:Key="UnselectedPersonTemplate" DataType="{x:Type o:Person}">
    <TextBlock Text="{Binding Path=Name}" Foreground="{Binding Path=Foreground}" Margin="1">
        <DataTemplate.Triggers>
            <DataTrigger Binding="{Binding Path=IsOnline}" Value="False">
                <Setter Property="TextBlock.Foreground" Value="Gray" />
            </DataTrigger>
        </DataTemplate.Triggers>
</DataTemplate> 
```

当然，这是行不通的。也不例外，但也不是预期的结果。然后我尝试将触发器用于 TextBlock，但会有一个例外，我不能为此使用 DataTriggers（仅限 EventTriggers）。

感谢您的任何建议！:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T06:06:58.127

给你`TextBlock`一个名字，并将`TargetName`setter 的属性设置为该名称。

```
<DataTemplate x:Key="UnselectedPersonTemplate" DataType="{x:Type o:Person}">
    <TextBlock x:Name="tb" Text="{Binding Path=Name}" 
          Foreground="{Binding Path=Foreground}" Margin="1" />
    <DataTemplate.Triggers>
       <DataTrigger Binding="{Binding Path=IsOnline}" Value="False">
          <Setter TargetName="tb" Property="Foreground" Value="Gray" />
       </DataTrigger>
    </DataTemplate.Triggers>
</DataTemplate> 
```

# asp.net - 如何从 JavaScript 控制 ASP.NET Validator 控制客户端验证？

> ID：891540
> 
> 赞同：1
> 
> 时间：2009-05-21T05:44:50.820
> 
> 标签：asp.net, javascript

如何从 JavaScript 控制 ASP.NET Validator 控制客户端验证？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T16:39:43.320

如果您的意思是在客户端编写自定义验证函数，CustomValidator 完全支持。只需为其提供您要用于验证的 javascript 函数的名称，例如：

```
<script language="javascript">
function MyTextBoxValidation(source, args)
{
if (valid)
  args.IsValid = true;
else
  args.IsValid = false;
}
</script>

    <asp:CustomValidator ID="MyValidator" runat="server" 
ClientValidationFunction="MyTextBoxValidation" 
ControlToValidate="MyTextBox" /> 
```

但是，如果您只想触发现有的验证逻辑，则始终可以使用以下脚本：

```
if (Page_ClientValidate())
{
    // Do stuff, we're valid here.
} 
```

# reflection - F# 可变到不可变

> ID：891549
> 
> 赞同：4
> 
> 时间：2009-05-21T05:49:01.080
> 
> 标签：reflection, f#, immutability, mutable

全部，

我最近一直在涉足一些 F#，我想出了以下我从一些 C# 代码中移植的字符串生成器。它将对象转换为字符串，前提是它传递了属性中定义的正则表达式。对于手头的任务，它可能有点矫枉过正，但出于学习目的。

目前，BuildString 成员使用可变字符串变量 updatedTemplate。我一直在绞尽脑汁想办法在没有任何可变对象的情况下做到这一点，但无济于事。这让我想到了我的问题。

是否可以在没有任何可变对象的情况下实现 BuildString 成员函数？

干杯，

迈克尔

```
//The Validation Attribute
type public InputRegexAttribute public (format : string) as this =
    inherit Attribute()
    member self.Format with get() = format

//The class definition
type public Foo public (firstName, familyName) as this =
    [<InputRegex("^[a-zA-Z\s]+$")>]
    member self.FirstName with get() = firstName 

    [<InputRegex("^[a-zA-Z\s]+$")>]
    member self.FamilyName with get() = familyName 

module ObjectExtensions =
    type System.Object with
        member this.BuildString template =
            let mutable updatedTemplate : string  = template
            for prop in this.GetType().GetProperties() do
                for attribute in prop.GetCustomAttributes(typeof<InputRegexAttribute>,true).Cast<InputRegexAttribute>() do
                    let regex = new Regex(attribute.Format)
                    let value = prop.GetValue(this, null).ToString()
                    if regex.IsMatch(value) then
                        updatedTemplate <- updatedTemplate.Replace("{" + prop.Name + "}", value)
                    else
                        raise (new Exception "Regex Failed")
            updatedTemplate

open ObjectExtensions
try
    let foo = new Foo("Jane", "Doe")
    let out = foo.BuildInputString("Hello {FirstName} {FamilyName}! How Are you?")
    printf "%s" out
with | e -> printf "%s" e.Message 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T06:26:31.067

我没有时间把它写成代码，但是：

*   编写一个表示最里面部分的函数，获取一个字符串（到目前为止的结果）和一个属性和属性的元组，并返回替换后的字符串。
*   用于`seq.map_concat`从返回的属性数组`GetProperties()`到 (property, attribute) 元组序列。
*   `seq.fold`与前两位一起使用来完成整个转换，使用原始模板作为聚合的初始值。总体结果将是最终替换的字符串。

那有意义吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T07:03:17.773

我认为您始终可以将“仅具有一种效果（改变局部变量）的序列上的 for 循环”转换为摆脱可变的代码；这是一般转换的示例：

```
let inputSeq = [1;2;3]

// original mutable
let mutable x = ""
for n in inputSeq do
    let nStr = n.ToString()
    x <- x + nStr
printfn "result: '%s'" x

// immutable
let result = 
    inputSeq |> Seq.fold (fun x n ->
        // the 'loop' body, which returns
        // a new value rather than updating a mutable
        let nStr = n.ToString()
        x + nStr
    ) ""  // the initial value
printfn "result: '%s'" result 
```

您的特定示例具有嵌套循环，因此这是一个分两步显示相同类型机械变换的示例：

```
let inputSeq1 = [1;2;3]
let inputSeq2 = ["A";"B"]

let Original() = 
    let mutable x = ""
    for n in inputSeq1 do
        for s in inputSeq2 do
            let nStr = n.ToString()
            x <- x + nStr + s
    printfn "result: '%s'" x

let FirstTransformInnerLoopToFold() = 
    let mutable x = ""
    for n in inputSeq1 do
        x <- inputSeq2 |> Seq.fold (fun x2 s ->
            let nStr = n.ToString()
            x2 + nStr + s
        ) x
    printfn "result: '%s'" x

let NextTransformOuterLoopToFold() = 
    let result = 
        inputSeq1 |> Seq.fold (fun x3 n ->
            inputSeq2 |> Seq.fold (fun x2 s ->
                let nStr = n.ToString()
                x2 + nStr + s
            ) x3
        ) ""
    printfn "result: '%s'" result 
```

（在上面的代码中，我使用了名称 'x2' 和 'x3' 以使范围更明显，但您可以始终使用名称 'x'。）

尝试对您的示例代码进行相同的转换并发布您自己的答案可能是值得的。这不一定会产生最惯用的代码，但可以作为将 for 循环转换为 Seq.fold 调用的练习。

（也就是说，在这个例子中，整个目标主要是一个学术练习——带有可变变量的代码是“好的”。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-21T17:47:30.257

纯粹的功能方法：

```
module ObjectExtensions =
type System.Object with
    member this.BuildString template =
        let properties = Array.to_list (this.GetType().GetProperties())
        let rec updateFromProperties (pps : Reflection.PropertyInfo list) template =
            if pps = List.Empty then
                template
            else 
                let property = List.hd pps
                let attributes = Array.to_list (property.GetCustomAttributes(typeof<InputRegexAttribute>,true))
                let rec updateFromAttributes (ats : obj list) (prop : Reflection.PropertyInfo) (template : string) =
                    if ats = List.Empty then
                        template
                    else
                        let a = (List.hd ats) :?> InputRegexAttribute
                        let regex = new Regex(a.Format)
                        let value = prop.GetValue(this, null).ToString()
                        if regex.IsMatch(value) then
                            template.Replace("{" + prop.Name + "}", value)
                        else
                            raise (new Exception "Regex Failed\n")
                updateFromProperties(List.tl pps) (updateFromAttributes attributes property template)
        updateFromProperties properties template 
```

# sql - 基于最大值的唯一性，其中并非所有单元格都相同

> ID：891551
> 
> 赞同：1
> 
> 时间：2009-05-21T05:49:41.533
> 
> 标签：sql

假设我的 SQL 选择中有以下结果表：

```
DocumentId CreationDate InstanceId
美国广播公司 1 月 10 日 0c60f4e2-02fc-4244-9ec5-4d259ea5774d
美国广播公司 2168 年 1 月 11 日ab5d-d6ca-4db3-90f0-b621d72108b8
BCA 1 月 4 日 cb7cdf24-b50f-4bd9-b2b5-d58a14793dd8

```

请注意，`InstanceId`现在返回的每个都不同；它本质上是表的主键。

我将如何修改我的选择，以便我只返回一行`DocumentId`，选择“最新”（由 确定`CreationDate`），确保该`InstanceId`行是正确的。

因此，上面的示例结果将改为返回：

```
DocumentId CreationDate InstanceId
美国广播公司 2168 年 1 月 11 日ab5d-d6ca-4db3-90f0-b621d72108b8
BCA 1 月 4 日 cb7cdf24-b50f-4bd9-b2b5-d58a14793dd8

```

*（顺便说一句，对于可怕的问题标题感到抱歉，请随时将其更改为更合适的名称）*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T06:01:48.383

甲骨文的例子：

```
SELECT DISTINCT
       DocumentId,
       FIRST_VALUE(CreationDate)
          OVER (PARTITION BY DocumentId
                ORDER BY CreationDate DESC) AS CreationDate,
       FIRST_VALUE(InstanceId)
          OVER (PARTITION BY DocumentId
                ORDER BY CreationDate DESC) AS InstanceId
FROM   mytable; 
```

显然，如果存在具有完全相同 CreationDate 的重复文档，则结果将是不确定的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T08:25:33.320

这是 SQL Server 的版本。基本上，您通过按 DocumentId 列对行进行分组并获得 max(creationDate) 将表与表连接起来。使用这 2 列作为获取 Code 值的条件。基本上，所需选择的主键是 DocumentName 和 CreationDate。那些唯一（或应该唯一）标识您尝试选择的行。为了获得该键，我们创建了一个带有 select 和 groupBy 子句的 second(temp) 表。我们将该表与原始表连接起来，并使用该信息进行选择。

```
SELECT
     mt2.DocumentId
    ,mt2.CreationDate
    ,mt1.InstanceId
FROM
    myTable    mt1
    inner join (SELECT 
                     DocumentId  DocumentId
                    ,MAX(CreationDate)  CreationDate
             FROM       
                     myTable
             GROUP BY 
                     DocumentId
               )mt2  on  mt2.DocumentId = mt1.DocumentId 
                     and mt2.CreationDate = mt1.CreationDate
ORDER BY mt2.DocumentId 
```

每个 DocumentId 的 creationDate 应该是唯一的，这样查询才能完美运行。如果每个文档每天需要更多条目，可以考虑降低 CreationDate 粒度（例如添加时间组件）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T08:26:57.420

这应该适用于大多数数据库：

```
SELECT
    cur.DocumentId, cur.CreationDate, cur.InstanceId
FROM
    DocumentVersions cur
LEFT OUTER JOIN
    DocumentVersions next
    ON next.DocumentId = cur.DocumentId
    AND next.CreationDate > cur.CreationDate 
WHERE
    next.DocumentId is null 
```

它与自身连接 Document 表，搜索具有相同 id 和更高 CreationDate 的文档。where 语句表示不能找到具有较高日期的文档，有效地过滤每个 DocumentId 的最新文档。

如果可能有多个文档具有相同的创建日期，您可以选择具有最高 InstanceId 的文档，例如：

```
SELECT
    cur.DocumentId, cur.CreationDate, max(cur.InstanceId)
FROM
    DocumentVersions cur
LEFT OUTER JOIN
    DocumentVersions next
    ON next.DocumentId = cur.DocumentId
    AND next.CreationDate > cur.CreationDate 
WHERE
    next.DocumentId is null
GROUP BY
    cur.DocumentId, cur.CreationDate 
```

# iphone - UIScrollView 从界面生成器中消失？

> ID：891553
> 
> 赞同：1
> 
> 时间：2009-05-21T05:50:20.503
> 
> 标签：iphone, xcode, interface-builder

我有界面生成器 3.1，但我没有看到任何 UIScrollView 和 UIAlertView 那里缺少一些东西？我怎样才能在界面生成器中获取它们。我想要一个带有 50 个标签的视图，我想通过 Interface Builder 添加它们，而不是使用代码，请帮助...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-23T14:15:33.333

UIAlertView 是一个模态对话框，在代码中触发，因此在 Interface Builder 中设置它不会很有用。要创建警报，请使用类似于以下的代码：

```
UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"Error message" message:@"Error description" delegate:self cancelButtonTitle:@"OK" otherButtonTitles: nil];
[alert show];
[alert release]; 
```

UIScrollView 就在 Interface Builder 库中。我不知道你为什么看不到它。它的图标是一个空白的白色视图，右侧有一个灰色的滚动条。即使通过在界面中插入这样的视图，您仍然可能需要在代码中设置一些参数以使滚动正常工作。

作为一个概念性的评论，如果你想在滚动视图中有 50 个标签，我认为使用 UITableView 可能会更好。

# performance - AIX xlC 执行STL 明显比其他平台慢？

> ID：891554
> 
> 赞同：1
> 
> 时间：2009-05-21T05:50:33.187
> 
> 标签：performance, stl, aix

在 Linux 上运行需要 1 秒的东西在 AIX 上运行需要 45 秒。我没有直接深入研究该代码，但作为一个测试抓住了一个小应用程序，它从另一个 SO 问题中做的很少：

```
int main ( int argc, char **argv)
{
int i = 0;
std::vector<int> vec;
vec.push_back(6);
vec.push_back(-17);
vec.push_back(12);

for (i=0;i<100000;i++)
   vec.push_back(i);

vec.erase(vec.begin() + 1);
return 0;
} 
```

我有一个旧编译器（7.0.0.10），我无法相信代码运行速度与 g++ 4.2 上的相同代码相比要慢多少。

有没有人见过这个？升级编译器需要一些工作。在几乎没有负载的系统上，示例代码大约慢 20 倍（实时）。

更新要求的盒子规格：

```
    处理器数量：8
    处理器时钟速度：3504 MHz
    CPU 类型：64 位
    内核类型：64位
    内存大小：63232 MB
    良好的内存大小：63232 MB
    平台固件级别：EM340_041
    固件版本：IBM,EM340_041
    控制台登录：启用
    自动重启：真
    全核心：真

```

AIX 上的输出：

```
real    0m0.52s
user    0m0.51s
sys     0m0.00s 
```

Linux 上的输出：

```
 0.00s real     0.01s user     0.00s system 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T07:47:49.823

要么你的设置有严重问题，要么你没有发布真正的代码。在一台非常旧的 900Mhz Pentium 笔记本电脑上几乎可以立即执行以下操作，而且内存很少：

```
#include <iostream>
#include <vector>
#include <ctime>
using namespace std;;

int main ( int argc, char **argv) {

    time_t now1 = time(0);
    std::vector<int> vec;
    vec.push_back(6);
    vec.push_back(-17);
    vec.push_back(12);
    for ( int i = 0; i<10000; i++) {
      vec.push_back(i);
    }

    time_t now2 = time(0);
    vec.erase(vec.begin() + 1);

    time_t now3 = time(0);
    cout << (now2 - now1) << " " << (now3 - now2)  << endl;
} 
```

请通过两个编译器运行此代码并报告它输出的数字。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T05:58:25.093

一些缩小问题范围的建议：

*   在您的程序上使用时间并查看系统/用户时间，*而不是*经过的时间。这会给你一个更好的指示。
*   `system("date")`在三个初始 push_back 语句之前、for 循环之前、擦除之前和返回之前放置一个。这将显示导致问题的操作。
*   告诉我们您也在运行什么硬件。您可能有一个 286 级的 pSeries。

然后将硬数据返回给我们，我们可以提供更多帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T06:47:52.077

我怀疑一个次优的内存分配策略。如果添加会发生什么

```
vec.reserve(10000); 
```

在for循环之前？

# html - “选择”元素和数据的跨浏览器传输

> ID：891559
> 
> 赞同：1
> 
> 时间：2009-05-21T05:52:09.643
> 
> 标签：html, cross-browser

我一直在一个元素中`value="something"`为我`option`的元素提供一个`select`。

像这样

```
<select>
   <option value="true">True</option>
</select> 
```

现在我已经与国家建立了一个，那里有很多无关的数据。我很确定如果我没记错的话，如果 value 属性不存在，Firefox 将在标签之间发送文本。

我的问题是，这种行为是常态吗？如果省略 value 属性，我可以依靠所有浏览器发送选项元素的 innerHTML 吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T05:55:11.120

是的，这适用于所有浏览器。

[正如规范所说：](http://www.w3.org/TR/html401/interact/forms.html#edef-OPTION)

> ### 选项属性定义
> 
> `value = cdata [CS]`
>             此属性指定控件的初始值。如果未设置此属性，则将初始值设置为 OPTION 元素的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T05:57:27.513

从[W3C](http://www.w3.org/TR/html401/interact/forms.html#h-17.6)获取：

> value = cdata [CS] 此属性指定控件的初始值。如果未设置此属性，则将初始值设置为 OPTION 元素的内容。

有了这个，我认为每个符合主要标准的浏览器都应该采用“值”属性，如果它不存在，则采用该元素

# scala - 在 Scala 中映射子列表

> ID：891561
> 
> 赞同：6
> 
> 时间：2009-05-21T05:53:12.417
> 
> 标签：scala, functional-programming, list-manipulation

我知道 map 函数采用列表（序列）的每个元素并将函数应用于它。递归（并且不考虑终止条件等）

```
map(s, f) = f(s.head) :: map(s.tail, f) 
```

我正在寻找一个类似的功能

```
foo(s, f) = f(s) :: map(s.tail, f). 
```

所以一个“映射器”，其中映射函数在子列表而不是单个元素上被调用。在 lisp 术语中，我正在寻找地图列表，而不是地图车。是否存在这样的事情，还是我必须自己推出（或使用递归）？

或者，我将采用一个函数，该函数将一个序列作为输入并返回一个中端子序列序列，即

```
bar(s, f) = s :: bar(s.tail, f) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T14:43:07.143

/* 这种方法用另一种称为tails 的有用方法来定义mapList。和 Daniel 一样，我会将它放在 List 的隐式扩展中，但这纯粹是个人喜好问题 */

```
implicit def richerList[A](list : List[A]) = new { 
```

/* 这是一个名为 tails 的方法，它返回列表中每个可能的尾部。它是尾递归的，因此它不会在大型列表中爆炸。请注意，它与同名的 Haskell 函数略有不同。Haskell 版本总是在结果中添加一个空列表 */

```
 def tails : List[List[A]] = {
    def loop(ls : List[A], accum : List[List[A]]) : List[List[A]] = ls match {
      case _ :: tail => loop(tail, ls :: accum)
      case _ => accum
    }

    loop(list, Nil).reverse
  } 
```

/* 这是使用尾部的样子

```
scala> "abc".toList.tails
res0: List[List[Char]] = List(List(a, b, c), List(b, c), List(c)) 
```

*/

/* 现在我们可以根据tails定义mapList */

```
 def mapList[B](f : List[A] => B) = tails map f
} 
```

/* 这就是使用 mapList 的样子

```
scala> "abc".toList mapList (_.reverse.mkString)
res1: List[String] = List(cba, cb, c) 
```

*/

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T11:32:02.757

您基本上已经在伪代码中定义了您要查找的内容 - 因此使用隐式转换很容易将这样的方法添加到 Scala 列表中：

```
object ExtendedList{
  implicit def List2ExtendedList[A](l:List[A])=new ExtendedList(l)
}
class ExtendedList[A](l:List[A]){
  import ExtendedList._
  def mapList[B](f:List[A]=>B):List[B]=l.length match {
    case 0 => List()
    case _ => f(l)::l.tail.mapList(f)
  }
}

object Test extends Application{
  import ExtendedList._
  val test = List(5,4,3,2,1)
  assert(List(15,10,6,3,1)==test.mapList{l=>(0/:l){_+_}})
} 
```

这是你要找的吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T13:33:19.250

另一个答案很接近，但除非绝对必要，否则*永远不要*使用。`List#length`特别是，当问题本质上是*O(n)时，它使他的解决方案成为**O(n^2* ) 。这是一个清理后的版本：

 *```
implicit def addListSyntax[A](list: List[A]) = new {
  def mapList[B](f: List[A]=>B) = {
    // use inner function to avoid repeated conversions
    def loop(list: List[A]): List[B] = list match {
      case ls @ (_ :: tail) => f(ls) :: loop(tail)
      case Nil => Nil
    }

    loop(list)
  }
} 
```

而且，要回答您最初的问题：不，没有办法使用标准实用程序方法来做到这一点。我其实有点好奇为什么你会想要这样的东西......

# cocos2d-iphone - Cocos2d：在数组中添加精灵会导致应用程序因未捕获的异常而终止

> ID：891567
> 
> 赞同：1
> 
> 时间：2009-05-21T05:56:31.337
> 
> 标签：cocos2d-iphone, sprite

当我尝试将精灵添加到数组时，我遇到了一个未捕获的异常错误，对我来说一切都很好。我正在为这个 monoclestudios dot com/static/simplegame.zip 使用 MonocleStudios Simplegame 项目

代码应该是不言自明的：

`The .m file:`

```
@implementation GameScene

- (id) init {
    self = [super init];
        if (self != nil) {

        Sprite * bg = [Sprite spriteWithFile:@"game.png"];
        [bg setPosition:ccp(240, 60)];
        [self addChild:bg z:0];
        [self addChild:[GameLayer node] z:1];
        Sprite * bg1 = [Sprite spriteWithFile:@"game.png"];
        [bg1 setPosition:ccp(211, 260)];
        [self addChild:bg1 z:0];
        //the above works fine!
        Sprite * bgX[50];
        //if comment out the next 3 lines, everything runs but I get an "unused variable" warning
        bgX[0] = [Sprite spriteWithFile:@"mytree.png"];
        [bgX[0] setPosition:ccp(240,150)];
        [self addChild:bgX[0] z:0];  
    }
    return self;
}

@end 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-30T17:54:48.397

以下工作正常（Cocos2D 0.7.3，如果这对 2.1 SDK 很重要）：

```
Sprite *sprites[SPRITE_COUNT];
for(int i = 0; i < SPRITE_COUNT; i++) {
    sprites[i] = [Sprite spriteWithFile:@"file.png"];
    [sprites[i] setPosition: ccp(0, 0)];
    [self addChild: sprites[i] z:0];
} 
```

# iphone - 多少个 NSTimers 太多了？

> ID：891569
> 
> 赞同：5
> 
> 时间：2009-05-21T05:57:04.723
> 
> 标签：iphone, nstimer

在 iPhone OS 设备中，同时运行多少个 NSTimers 会太多？我有一堆例程被单个计时器每秒触发 25 次调用，而且事情非常不稳定，缓慢且沉重。我正在考虑添加一个或多个额外的 NSTimers 来稍微分配工作量，但我担心有多少可以使用。这可能在一定程度上取决于我意识到的每个计时器的触发率，所以让我们假设每秒 20~30 次的触发率。那么，多少个 NSTimers 是太多了？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T07:16:24.597

在内部，`NSTimers`都在单个硬件定时器上实现。操作系统为所有正在运行的应用程序保留一个中央计时器列表，并为最快的事件简单地安排一个硬件计时器。

添加计时器不会改变您的应用程序的行为。也就是说，就像将线程添加到本质上是单进程的应用程序使运行时管理更容易一样，添加计时器可以帮助您划分问题。

鉴于您引用的时间，我猜这个计时器是游戏或类似东西的帧更新同步。我会建议几件事：

1.  将您当前的绘图代码拆分为一个单独的线程并在其中运行您的（相同的）计时器代码。这应该给你更多的控制权。

2.  分析您的代码以查看在每个 1/25s 插槽中执行了多少处理 - 您可能（并且可能是）只需要优化您的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T06:30:05.973

听起来计时器的数量不是问题。与您在“一堆例程”中执行的加载相比，NSTimers 的开销基本上是微不足道的。暂时不用担心。根据需要使用尽可能多的计时器。之后打开鲨鱼/仪器，看看你在哪些方法上花费的时间最多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T06:02:33.967

1 在你的情况下。添加额外的计时器不会使您的应用程序运行得更快。

您必须使您的代码更高效或更少地触发计时器。

我不知道计时器的开销，但它可能是相当高的射速。计时器不是为此而设计的，我建议使用线程作为替代方案。

# php - php 5.1.* 的 date_parse 函数有什么替代方法吗？

> ID：891577
> 
> 赞同：6
> 
> 时间：2009-05-21T06:00:18.617
> 
> 标签：php

我必须使用 php 函数 date_parse 但它支持 5.2。*. 那么对于 php 5.1 的函数 date_parse 是否有任何替代方法。*.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-21T06:07:34.927

[strtotime](http://au.php.net/strtotime)，可能与[getdate](http://au.php.net/getdate)、[localtime](http://au.php.net/localtime)或[gmtime结合使用](http://au.php.net/gmtime)

```
getdate(strtotime("20 Jan 2009")); 
```

strtotime 接受一个字符串，并将其转换为 unix 时间戳，其他三个函数将 unix 时间戳转换为类似 date_parse 的数组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T06:06:41.807

尝试：

```
getdate(strtotime($datestr)) 
```

请注意，有些键略有不同（例如，'seconds' 而不是 'second' 和 'mday' 而不是 'day'）并且 getdate 不包含任何错误信息。 `getdate`也不支持几分之一秒。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T06:03:48.787

不知道您所说的替代品到底是什么意思，但请查看：

[php.net 获取日期（）](http://php.benscom.com/manual/en/function.getdate.php)

*提示：向左看你会看到相关的功能。*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T12:01:39.217

只是想知道为什么？

strtotime() 似乎是最接近的答案。使用时间戳（参见 time()、mktime() 等）来避免此类字符串解析。

# javascript - 如何使用 JavaScript 暂时禁用文本选择？

> ID：891581
> 
> 赞同：16
> 
> 时间：2009-05-21T06:02:07.103
> 
> 标签：javascript, html, drag-and-drop, behavior

这是一个具体的问题，所以我会直截了当。

我正在为 Web 应用程序的一部分开发一个简短的拖放例程，尽管拖放位工作正常，但该站点在操作过程中变得非常丑陋，因为浏览器仍然执行默认操作并且可以正常工作关于文本选择。

我尝试了一些解决方案，主要涉及从 mousedown 或 click 事件返回 false，虽然它们在某些浏览器中禁用了文本选择，但它们似乎也完全禁用了 mouseup 事件，破坏了脚本的“drop”位并留下了这个悬浮在鼠标周围的永久浮动图标——不好玩。

我真的不希望文本选择完全消失，我只是想建议浏览器......不要在拖动时这样做，如果这有意义的话。由于我知道受影响的区域（涉及 iframe），因此我可以轻松地将属性应用于受影响的元素等。如有必要，我可以发布代码，但我正在寻找更多通用解决方案。由于这只是美学问题，我正在寻找适用于大多数浏览器的修复程序，它并不是那么重要。

谢谢！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-21T06:24:43.110

在 W3C 浏览器中，您可以调用对象`preventDefault`上的方法`event`。IE 等效项是将 设置`returnValue`为`false`.

```
function stopDefault(e) {
    if (e && e.preventDefault) {
        e.preventDefault();
    }
    else {
        window.event.returnValue = false;
    }
    return false;
} 
```

编辑：只需重新阅读问题，您可能还希望在处理实际拖动的代码部分中阻止默认操作，而不仅仅是在初始鼠标按下或单击时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T06:13:04.857

据我所知，拖动的元素必须定位在鼠标指针下的其他元素上。如果它会随着鼠标指针移动，它会阻止页面上的任何选择。

# javascript - 我应该如何使用 jquery 的实时功能模拟 mouseenter 事件？

> ID：891584
> 
> 赞同：0
> 
> 时间：2009-05-21T06:03:38.643
> 
> 标签：javascript, jquery, events, mouse

我想为 mouseenter 事件使用 jQuery 的强大实时功能，但目前不受支持。下面是我第一次尝试解决方案，但它似乎不是最优的。建议？改进？

```
// mouseenter emulation
jQuery('.selector').live('mouseover',function (e) {
    // live sees all mouseover events within the selector
    // only concerned about events where the selector is the target
    if (this != e.target) return; 
    // examine relatedTarget's parents to see if target is a parent. 
    // if target is a parent, we're "leaving" not entering
    var entering = true;
    jQuery(e.relatedTarget).parents().each(function () {
            if (this == e.target) {
                entering = false;
                return false; // found; stop searching
            }
    });
    if (!entering) return;
    /*
     the rest of my code 
     */
}); 
```

我无法检查目标的子节点的相关目标 b/c 没有简单的方法来获取所有子节点。我无法直接检查目标的父母是否有相关的目标作为父母，因此“进入”目标，b/c 用于鼠标悬停，它可能是从相邻的兄弟而不是父母进入的。

此解决方案工作正常。我已经对其进行了测试，看起来还不错，但是我该如何改进呢？它还受到 DOM 布局方式的影响。选择器元素的某些部分必须暴露才能看到鼠标悬停事件，但这在我正在尝试的示例中很少出现问题。不过，如果有办法保证它会被看到，那就太好了。

我想我想知道我是否接近这个权利，如果没有，什么更好？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-12-05T00:21:56.770

我最终做了：

```
$("#id").delegate(".selector", "mouseover", function(){
 if(!$(this).hasClass("bound")){                            
  $(this).hover(function(){
   alert('entering');
  },
  function(){
   alert('leaving');
  }).mouseover().addClass("bound");
 }
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T07:52:38.117

现在已经有一段时间没有接受者了，所以我假设没有比这更好的了。

我现在在几个项目中使用它，所以我会把它从未回答的问题堆中拿出来。

希望其他人觉得它有用，如果您发现错误或想出更好的东西，请告诉我。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-22T19:43:53.303

刚刚遇到类似的事情。这是我的解决方案

HTML：

```
<div class="dropdown">
  <span>Options</span>
  <ul class="options">
    <li class="cart"><a href="http://amiestreet.com/saves/save/song/WGylTQo-A4Qx" rel="ui-lightbox"><span class="cart_drop">Add to cart</span></a></li>
    <li class="add-to-playlist"><a href="/playlist/create/add-song/WGylTQo-A4Qx" rel="ui-lightbox">Add to playlist</a>
        <ul class="playlists" style="display:none;">
            <li><a href="/playlist/create/add-song/WGylTQo-A4Qx" rel="ui-lightbox">Create New Playlist</a></li>
            <li class="add-song-to-playlist"><a href="/playlist/MD6Cp1F7Y24x/addSong/WGylTQo-A4Qx" rel="WGylTQo-A4Qx">Free Tracks (Copy)</a></li>
        </ul>
    </li>
    <li><a href="http://amiestreet.com/music/wiley/treddin-on-thin-ice/the-game">More info</a></li>
  </ul>
</div> 
```

JS

```
<script type="text/javascript">
  $(function(){
    $('.dropdown').live('mouseover', function(){
        $('.dropdown > .options:visible').hide();
        $(this).find('.options').show();
    });
    $('.dropdown').live('mouseout', function(e){
        if(!$(e.relatedTarget).is('ul.options') && $(e.relatedTarget).parents('ul.options').length==0){
            $(this).find('.options').hide();
        }
    });
  });
</script> 
```

# c# - 如何从 HttpWebResponse 中删除 \r \n \t 和为“=”附加的额外 \

> ID：891588
> 
> 赞同：1
> 
> 时间：2009-05-21T06:05:28.503
> 
> 标签：c#

我正在使用 HttpWebRequest 传递一个 URL，然后需要保存 HttpWebResponse 返回的 html。返回的响应有很多 \r、\n 和 \t，并且所有“=”（等于）都附加了反斜杠。我需要删除它们，以便返回的 tml 干净且可直接使用。

使用的代码是：

```
HttpWebRequest request = WebRequest.Create("http://noirimdev02:8080/cps/rde/xchg/rimvenezuela/hs.xsl/1351.htm?xsl=pearl_series_landingpage.xsl&catid=0651C91110FA48BEBFD7C05413185395&pid=F6794FC1CB244538BB592A47505062BC&count=2") as HttpWebRequest;
    // Get response               
    using (HttpWebResponse response = request.GetResponse() as HttpWebResponse)
    {
        // Get the response stream   

        StreamReader reader = new StreamReader(response.GetResponseStream());

        // Read the whole contents and return as a string   
        result = reader.ReadToEnd();
    }
    result = result.Replace("\n", " ");
    result = result.Replace("\r", " ");
    result = result.Replace("\t", " ");
    Console.WriteLine(result);
    Console.ReadLine(); 
```

尼米什

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T06:13:14.187

看起来您已经处理了 \n、\r 和 \t 情况，如果我理解正确，在等号之后留下尾随的 '\' 来解决？您可以使用与其他方法相同的方法来做到这一点：

```
result = result.Replace(@"=\", "="); 
```

或者，如果您想同时处理所有案例：

```
result = Regex.Replace(result, "[\n\r\t]|=\\\\", delegate(Match match)
{
    return match.Value == @"=\" ? "=" : " ";
}); 
```

# string - NSString 到 wchar_t*？

> ID：891594
> 
> 赞同：5
> 
> 时间：2009-05-21T06:08:04.600
> 
> 标签：string, macos, cocoa, nsstring

我似乎找不到将 NSString 转换为 wchar_t 的良好内置方法...有关如何执行此操作的任何提示？Apple 在 NSString 类上公开的任何内容都适用于 c-strings (char*) 或 unichars，但没有适用于 wchar*。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-21T06:26:37.213

```
[urString cStringUsingEncoding:NSUTF16LittleEndianStringEncoding] 
```

`wchar_t`是特定于编译器的。假设你想要 Win32 `wchar_t`，那么 UTF16 little ending encoding 就可以了。对于 Unix `wchar_t`，您可能需要 NSUTF32 编码系列，以及您选择的平台。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-10-08T12:50:33.820

以下代码对我有用：（不确定这是否也适用于 wchar_t）

```
NSString *pStr = [NSString stringWithFormat:@"%S", GetTCHARString()]; 
```

# java - JSF Richfaces 前端性能调优

> ID：891597
> 
> 赞同：4
> 
> 时间：2009-05-21T06:09:05.627
> 
> 标签：java, javascript, performance, jsf, richfaces

我使用 MyFaces 1.2.6 和 Richfaces 3.3.1GA（刚刚升级）开发了一个 Web 应用程序。尽管易于使用，但我发现 Richfaces 组件非常慢。

我还发现他们并没有真正利用浏览器缓存机制，他们在每次请求和其他事情时都会发送一些糟糕的 JS 文件。我真的很想应用“高性能网站”一书中描述的一些规则，但我无法更改生成的 js 和 HTML 代码。

有没有人有一些使用 Richfaces 进行前端性能调整的技巧？

谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-22T08:45:41.300

阅读[这篇文章](http://www.jsfcentral.com/articles/speed_up_your_jsf_app_1-3.html)。

您是否使用 Firebug + YSlow 来检查缓存中存储的内容？使用 web.xml`org.richfaces.LoadScriptStrategy`设置，您可以告诉 Richfaces：

*   将所有脚本加载到一个文件中。
*   不加载脚本（你自己做——例如，按照你的书规定的方式）。
*   需要时加载脚本（默认）。

但一些基本原则：

*   永远不要将逻辑放入您的吸气剂中。它们被多次调用，并且应该只返回已经由另一种方法填充的内容。例如，如果您将下拉列表链接在一起 `a4j:support`，则在第一个下拉列表上使用一个带有 action 属性的标签，该属性加载数据，然后在您重新渲染第二个下拉列表时检索该数据。

*   `ajaxSingle="true"`除非您真的想将整个表单发送回服务器，否则请使用。

*   如果您只需要一个普通的组件，请不要使用丰富的组件。例如，`rich:dataTable`除非您正在使用它所具有的某些功能，否则 不要使用它`h:dataTable`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-13T06:44:38.117

您可以使用：org.ajax4jsf.DEFAULT_EXPIRE 31536000

这样所有的js、css文件（由richfaces生成）在浏览器上缓存1年。这确实提高了我们项目的速度。

此外，我们不必担心如果我们更改richfaces 版本，因为当我们更改richfaces 版本时，它会生成不同的文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-08T07:51:29.490

要添加到Damo，您还可以添加一个小过滤器来缓存此类js或图像以提高性能。但是，如果要缓存的文件涉及频繁更新，请谨慎执行此操作。

```
private void cacheImages(HttpServletRequest request, 
        HttpServletResponse response) {
        try {
              String requestPath = request.getRequestURI();
              if (requestPath != null) {
                    if (requestPath.contains("/images/")
                                || requestPath.contains("/scripts/")
                                || requestPath.endsWith(".js")
                                || requestPath.endsWith(".gif")) {
                          response.setHeader("Cache-Control", "max-age=36000");
                    }
              }
        } catch (RuntimeException e) {
              // do nothing except log
              Log.error(this, e);
        }
  } 
```

# c# - c#生成的csv文件通过嵌入到lotus note中电子邮件底部的电子邮件发送

> ID：891598
> 
> 赞同：2
> 
> 时间：2009-05-21T06:11:14.533
> 
> 标签：c#, .net, email, csv, lotus-notes

我遇到了这个奇怪的问题，即使用 .NET SmtpClient 通过电子邮件发送的 CSV 附件出现在电子邮件的底部，而不是 Lotus Note 中的附件。我只是不知道如何弄清楚，而且我无法访问客户端计算机，这使得调试非常困难。我可以采取哪些可能的步骤以及我需要注意的可能问题？

代码如下：

```
var smtpClient = new SmtpClient
{
   Host = ConfigurationManager.AppSettings["smtpServer"],
   Port = Convert.ToInt32(ConfigurationManager.AppSettings["smtpPort"])
};
var mailMessage = new MailMessage();
mailMessage.Attachments.Add(new Attachment(attachment, contentType)); 

//ContentType = "text/csv";
//attachment is the temp file disk path 
```

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T13:24:13.263

这有点牵强，但您可能想要设置附件的内容处置。

```
var mailMessage = new MailMessage();
Attachment data = new Attachment(attachment, contentType); 
ContentDisposition disposition = data.ContentDisposition;
disposition.FileName = "message.csv";
mailMessage.Attachments.Add(data); 
```

改编自：http: [//msdn.microsoft.com/en-us/library/system.net.mail.attachment.contentdisposition.aspx](http://msdn.microsoft.com/en-us/library/system.net.mail.attachment.contentdisposition.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T07:51:01.470

在某些邮件客户端中，可以选择内联显示附件。

最明显的测试是从其他来源发送 .csv 文件附件，并查看有问题的客户端的结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T12:53:28.457

尝试不设置内容类型而只设置扩展名。如果 Windows 有扩展名，它应该能够处理它，并且它可能会强制它将其作为附件处理，而不是尝试内联显示它。

确保您附加的文件具有扩展名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-22T12:20:38.637

只是为了测试，尝试将内容类型设置为类似 "application/octet-stream" 。例如（在我脑海中）：

```
ContentType ct = new ContentType( "application/octet-stream" );
ct.Name = "message.csv";
data.ContentType = ct; 
```

# development-environment - 改变 Asp.net 2.0 32 位到 64 位的开发环境

> ID：891602
> 
> 赞同：0
> 
> 时间：2009-05-21T06:13:29.227
> 
> 标签：development-environment

我在 32 位机器上开发了一个 asp.net 2.0 应用程序，但现在我有相同应用程序的 64 位平台。我无法在 64 位机器上调试我的代码。

Ny1 请帮帮我

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-21T06:38:18.037

1）您是否重新编译了应用程序？

2) 如果您尝试更改“平台目标”，请在项目属性 -> 构建 -> 平台目标中更改为“任何 CPU”或“x64”。

3) 值得阅读有关将[32 位托管代码迁移到 64 位](http://msdn.microsoft.com/en-us/library/ms973190.aspx#64mig_topic6)的 MSDN 文章，以确保您没有任何互操作/序列化/等问题需要处理，以及 Scott 的有关该主题的[博客文章](http://www.hanselman.com/blog/BackToBasics32bitAnd64bitConfusionAroundX86AndX64AndTheNETFrameworkAndCLR.aspx)。

# asp.net-mvc - Html.BeginForm 使用 FormMethod.GET 丢失 routeValues

> ID：891603
> 
> 赞同：7
> 
> 时间：2009-05-21T06:13:54.170
> 
> 标签：asp.net-mvc, parameters, get-method

我注意到*Html.BeginForm()*方法将提供的*routeValues*编码为FORM 标签的**action**属性。这适用于 POST 方法。但是，如果方法是 GET，则操作 URL 中的所有参数都会被浏览器剥离（在 IE8 和 Firefox 3.0.7 上测试）。

例如，这段代码在视图中

```
<%
    using (Html.BeginForm("TestAction", "TestController", new { test = 123 }, 
        FormMethod.Get)) 
    {
        Response.Write("<input type='submit'>");
    };
%> 
```

给出这样的 HTML

```
<form action="/TestController/TestAction?test=123" method="get">
    <input type='submit'>
</form> 
```

但是在提交表单 URL 后变成**/TestController/TestAction**而不是**/TestController/TestAction?test=123**（参数丢失）。

现在我使用一组*Html.Hidden()*调用而不是*routeValues*参数，但我感兴趣是否有另一种解决方法？是否应该将其视为 MVC 中的错误，有时会被修复？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-10-27T15:11:02.520

如您所见，生成的 HTML 是“正确的”，并且具有您想要的语义，因此这不是服务器端问题，而是客户端问题。在这种情况下，浏览器会从操作 URL 中剥离查询部分，而您希望它附加到查询中。如果您阅读规范，则该操作不应该包含查询（它是 URI，而不是 URL），因此实际上您遇到了 HTTP 规范的“限制”。

您将被定向到没有查询的裸 url，因为在 HTML 中您没有要提交的内容。尝试为提交字段指定名称和值，或添加隐藏字段，您将看到参数在查询中传输。

在这种情况下，您绝对应该使用隐藏字段。

# visual-sourcesafe - 在 VSS 6.0 中如何启用多人处理单个文件

> ID：891607
> 
> 赞同：0
> 
> 时间：2009-05-21T06:19:46.427
> 
> 标签：visual-sourcesafe

在 VSS 中签出不同文件的两个人可以在 vss 上工作多少？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T06:28:38.190

在 VSS 管理中，转到工具 > 选项 > 启用多个签出。由[Vipul 的博客](http://msmvps.com/blogs/vipul/archive/2005/08/03/61328.aspx)提供。

另请阅读 Microsoft 关于[使用 VSS 进行团队开发](http://msdn.microsoft.com/en-us/library/ms998227.aspx)的指南。

# linq-to-sql - LINQ DeferredLoadingEnabled & DataLoadOptions 关系

> ID：891609
> 
> 赞同：2
> 
> 时间：2009-05-21T06:20:31.010
> 
> 标签：linq-to-sql

我遇到了一个障碍，它已经将自身级联到下面描述的情况。我对人们回答我以前的问题没有太多帮助，（我认为我必须学会更好地构建它们）但我希望有人至少可以向我解释这一点（我是 LINQ 的新手并且没有还没有机会详细阅读它）。

我正在使用存储库模型通过 LINQ-to-SQL 访问数据。我正在尝试使用声明为公共静态的 1 个数据上下文，以便我始终使用相同的上下文。

**问题 1：**网页在保存更改后立即加载缓存值。更改已传播到数据库，但数据上下文正在吐出对象的缓存副本。

**解决方法**：`ObjectTrackingEnabled = false`在数据上下文中设置。

**问题 2：**现在，对象不能延迟加载——当我在调试期间检查给定对象中的所有实体时，它们都是空的。

**解决方法：**在数据上下文上 设置`DeferredLoadingEnabled = false`。

**问题 3：** LINQ 不会自动为与给定对象关联的所有实体设置立即加载。

**解决方法：** 为数据上下文显式配置 LoadOptions 并通过设置`LoadWith<Object>(o => o.entity1)`, `LoadWith<Object>(o => o.entity2)`, ...,手动识别每个关联实体`LoadWith<Object>(o => o.entityN)`。

有些人可以帮助我解决缓存问题而无需处理其余问题吗？

如果没有，有人可以告诉我是否有另一种方法可以在数据上下文中设置 ImmediateLoadingEnabled （或类似的东西），这样我就不必明确说明与我的域中*所有*对象关联的*所有实体的加载选项？*

 *我真的很感激一些反馈。如果我在没有足够信息的情况下提问，或者您想要一个示例，请告诉我！

先感谢您！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T08:02:26.110

您不能对 Web 应用程序使用单个上下文，因为 Web 应用程序是多线程的（例如每个请求 1 个线程），这意味着多个线程正在使用相同的上下文。Iow：您应该使用一个系统，在该系统中，对于每个数据请求，您都创建一个新的上下文并将其用于执行查询，然后处置该上下文。

# c# - 如何通过 IDataReader 读取图像

> ID：891617
> 
> 赞同：1
> 
> 时间：2009-05-21T06:25:08.260
> 
> 标签：c#, .net

我在窗口 C# vs05 上工作。我想通过 IDataReader 读取图像....在 oledb....假设我想从数据库列名学生 ID 中读取 int 值，我该怎么做，然后我用下面的方式编写代码

```
private IDataReader _reader;

public int GetInt32(String sFieldName)
        {
            return (_reader[sFieldName]==DBNull.Value)? (Int32) 0 :Convert.ToInt32(_reader[sFieldName]);
        } 
```

为了保存图像，我使用下面的代码

```
 DataTable oTable = new DataTable();
                   oTable.Columns.Add("BoardImage");
                   DataRow oRow = oTable.NewRow();
                   oRow["BoardImage"] = oItem.BoardImage;
               SQL= Insert into table oRow["BoardImage"];

Now i want to read image BY Idatareader ......to do that i write bellow code but i get error message "Parameter is not valid."

    public Image GetImage(String sFieldName)
        {
            try
            {
                //MemoryStream stream = new MemoryStream();
                //stream.Write(image, 0, image.Length);
                //Bitmap bitmap = new Bitmap(stream);

                byte[] imageData = null;
                long byteSize = 0;
                byteSize = _reader.GetBytes(_reader.GetOrdinal(sFieldName), 0, null, 0, 0);  **//May be error occur here**

                imageData = new byte[byteSize];
                long bytesread = 0;
                int curpos = 0, chunkSize = 500;
                while (bytesread < byteSize)
                {
                    // chunkSize is an arbitrary application defined value 
                    bytesread += _reader.GetBytes(_reader.GetOrdinal(sFieldName), curpos, imageData, curpos, chunkSize);
                    curpos += chunkSize;
                }

                byte[] imgData = imageData;

                MemoryStream ms = new MemoryStream(imgData); **//May be error occur here**
                Image oImage = Image.FromStream((Stream)ms);
                return oImage;    

            }
            catch(Exception ex)
            {
                throw new Exception("Failed to get Image: " + ex.Message);
            }
        } 
```

任何人都可以帮助我吗？我的错误在哪里.....如何解决这个问题

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-22T04:56:33.030

尝试类似（确保阅读器处于顺序模式）：

```
using(MemoryStream ms = new MemoryStream()) {
    const int BUFFER_SIZE = 1024;
    byte[] buffer = new byte[BUFFER_SIZE];
    int col = reader.GetOrdinal(fieldName), bytesRead, offset = 0;
    while((bytesRead = (int)reader.GetBytes(col,offset,buffer,0,BUFFER_SIZE)) > 0) {
        ms.Write(buffer, 0, bytesRead);
        offset += bytesRead;
    }
    ms.Position = 0;
    return Image.FromStream(ms);
} 
```

我在原始代码中看到的最大问题是没有过多关注每次调用返回的字节数`GetBytes`（即假设你有一个完整的块）。

# django - 在 Django 管理页面中收集其他信息？

> ID：891621
> 
> 赞同：1
> 
> 时间：2009-05-21T06:26:39.660
> 
> 标签：django, django-admin, django-forms, django-urls

如果用户选择某个选项，则保存时我想将用户带到一个页面，他可以在该页面上再填写一个字段，然后重定向到管理员默认页面

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T06:45:10.100

[您可以简单地覆盖](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#adding-custom-validation-to-the-admin)创建和更新页面使用的表单，而不是重定向到新页面。这使您可以向模型表单添加其他字段，将所有表单处理保存在一个地方。

首先，您需要设置您的 ModelAdmin 以使用自定义表单：

**管理员.py**

```
from django.contrib import admin
from forms import BookAdminForm
from models import Book

class BookAdmin(admin.ModelAdmin):
    form = BookAdminForm

admin.site.register(Book, BookAdmin) 
```

**表格.py**

```
from django import forms

class BookAdminForm(forms.ModelForm):
    additional_field = forms.CharField(max_length=100)

    class Meta:
        model = Book 
```

接下来，您需要[重写 save 方法](http://docs.djangoproject.com/en/dev/topics/forms/modelforms/#the-save-method)以检查是否选择了“某些选项”，然后适当地处理额外的字段。在你的班级里，你需要这样的东西：

```
def save(self, *args, **kwargs):
    if self.cleaned_data['certain_field'].value == 'certain option':
        # process additional_field
    # don't forget to call super to save the rest of the form
    super(BookAdminForm, self).save(*arg, **kwargs) 
```

**注意：此代码未经测试，但它应该为您指明正确的方向。**

也可以[覆盖`save_model()`](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#django.contrib.admin.ModelAdmin.save_model)ModelAdmin 中的方法。

# javascript - javascript到jquery

> ID：891623
> 
> 赞同：0
> 
> 时间：2009-05-21T06:28:12.467
> 
> 标签：javascript, jquery

如何在 jQuery 的 javascript 中编写以下行？

```
var variablename = new functionname('some variable'); 
```

这是我的 js 代码：`var rt = new ResizeableTextbox('myRT');`

我需要在以下代码段中使用它：

```
 if($(this).text() =='String')
 {
    $("<label id=labelstr"+stringinc+" >"+label+"</label>").appendTo(".menu li");            
    $("<input id=inputstr"+stringinc+" type= 'text' ></input>").appendTo(".menu li");              
    //in place of this I need that javascript code.
 } 
```

我怎么做？Resizeable 函数在单独的 js 文件中定义。请帮帮我。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-21T06:30:33.117

我不认为你会......这是基本的 JavaScript 语法。jQuery 添加了抽象和实用程序等，但没有重写语言的核心部分。

这是 jQuery 的 JavaScript 代码示例

## 普通的 JavaScript

```
var myForm = document.getElementById('myForm'); 
```

## jQuery

```
var myForm = $('#myForm'); 
```

这两行基本上做同样的事情，标注一个名为“myForm”的变量，其中包含一个指向 id 为 的元素的指针（是正确的词吗？）`myForm`。在这个例子中使用 jQuery 的好处是语法更简洁，并且能够使用您*应该*已经知道的选择器系统 CSS。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-23T12:50:39.173

只要定义`ResizeableTextbox`函数的 JavaScript 文件包含在`<head>`页面部分中，`ResizeableTextbox`就可以在任何地方调用该函数，包括在您的 if 语句中......您可能需要编辑您的问题以更详细地描述您正在尝试的内容要做的事情和正在发生的事情，因为根据您的解释，它应该可以正常工作。

# algorithm - 计算 -ve、零和 +ve 域中的斜率

> ID：891628
> 
> 赞同：1
> 
> 时间：2009-05-21T06:29:24.010
> 
> 标签：algorithm, math, geometry

想象一个围绕零线振荡的正弦波。我的任务是使用相当粗糙的 x 轴刻度计算沿波浪的几个随机点的斜率。（是的，这有一个真正的应用程序）

当波浪在 +ve 区域（零线以上）时，斜率可以通过以下公式计算：

```
Slope = (y(n) / y(n-1)) - 1 
```

这会产生 +ve 斜率 vlaues 向上和 -ve 向下。

问题是当我们在 -ve 区域时必须切换它，然后当其中一个值为零时需要另外两个表达式，总共四个表达式必须使用条件语句以编程方式选择。

我想找到一个涵盖所有四个条件的表达式，因为这是一个重度旅行算法和时钟计数的中心！

我相信这对于数学天才来说是一个微不足道的解决方案，但对于这些疲惫的眼睛来说，它让我望而却步......

添加：

“正弦波”实际上是源自金融市场（随机）价格行为的 MACD 指标。一个例子在这里：

[http://stockcharts.com/school/doku.php?id=chart_school:technical_indicators:moving_average_conve](http://stockcharts.com/school/doku.php?id=chart_school:technical_indicators:moving_average_conve)

斜率（例如下图中的粗黑线）是我需要在这里计算的，简单地定义为向上或向下（向上是 +ve）

问题是 +ve 和 -ve 斜率都可能出现在零之上和之下。斜率计算也可以使用跨越零线和零线的增量进行。

找到一个不涉及大量 IF 语句的解决方案会很好……例如，将所有 y 值移动一个固定量，使它们变为 +ve，然后计算 +ve 区域中的斜率。我需要选择一个历史上 y 从未低于的数字，例如几个数量级（99），然后我可以执行偏移和一个斜率计算？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T06:56:53.807

你所说的“正弦波”是什么意思？您的意思是`y = a sin(bx)`通过样条曲线拟合某些实验点的数学生成图或平滑曲线，该曲线恰好类似于正弦波，因为它围绕 x 轴振荡？如果是前者，您可以在数学上区分它并在任何点获得精确的斜率。如果是后者，您正在寻找的公式是

```
slope(x) = (y(x-delta) - y(x+delta))/(2 * delta) 
```

尝试不同的 delta 值。不涉及条件；分子和分母的符号将自动确保您得到正确的斜率符号。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T15:58:42.920

坡度刚刚好

```
slope = y(n)-y(n-1) 
```

或者，如果您在 x 轴上有单位，则将其除以 x 轴步长（即 x(n)-x(n-1)）。

这个公式是一种定义，你在 x 轴的哪一边并不重要。（我在这里说“某种”，因为斜率是这个方程的极限，因为你的样本箱非常接近，所以这个方程是一个近似值，可以使用其他近似值。）

请记住，嘈杂数据的斜率看起来会更加嘈杂。

[我怀疑维基百科上斜率页面](http://en.wikipedia.org/wiki/Slope)的前几段会帮助你解决这个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T06:51:35.533

如果您正在寻找正弦波的斜率，它是通过标准微积分函数完成的。

线的斜率`f(x)=sin(x)`为`f'(x)=cos(x)`。

但是，根据您的公式，我不完全确定这就是您所追求的。也许你需要澄清一下。

但是，如果您想要问题中所示的方法，我认为您对性能的关注在这里是错误的。为了将此计算作为单个算术表达式进行，您将必须乘以 -1，具体取决于您是在 x 轴上方还是下方（以及您是否从 f(n -1) 到 f(n))。

一旦将其编译为机器语言，这可能比简单的 if 语句序列要慢（或至少不快）。

与所有优化一样，您应该首先选择最容易开发的方法，*然后*查看它是否存在性能问题。否则，您可能会在前期浪费大量精力来获得不必要的提升。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-05T19:41:07.167

你不需要斜坡；你可以这样做：

```
(iMACD(NULL,0,12,26,9,PRICE_CLOSE,MODE_SIGNAL,0) ) < 
iMACD(NULL,0,12,26,9,PRICE_CLOSE,MODE_SIGNAL,2) 
```

意味着减少。其他递增图，前提是：

```
(iMACD(NULL,0,12,26,9,PRICE_CLOSE,MODE_SIGNAL,0) ) >0 
```

# c# - byte[] 到字符串到字节数组的转换在 java 中不能正常工作

> ID：891636
> 
> 赞同：3
> 
> 时间：2009-05-21T06:33:23.130
> 
> 标签：c#, java, byte

我有一个这样初始化的字节数组：

```
public static byte[] tmpIV =  {0x43, (byte)0x6d, 0x22, (byte)0x9a, 0x22,
                         (byte)0xf8, (byte)0xcf, (byte)0xfe, 0x15, 0x21,
                         (byte)0x0b, 0x38, 0x01, (byte)0xa7, (byte)0xfc, 0x0e}; 
```

如果我打印它，它会给我

```
67   109    34      -102       34     -8          -49      -2      21      33
11    56    1       -89       -4      14 
```

然后我将整个字节数组转换为字符串并发送给我的朋友。

```
String str = new String(tmpIV); 
```

我的朋友是 C# 程序员

所以我的朋友得到了一些其他的数据。我的朋友将如何获得与我发送的相同数据。同样在Java中，如果我将上面的字符串重新转换为字节数组，我不会得到我发送的确切字符串：

```
 67     109        34        -17        -65      -67      34       -17     -65       -67
-17     -65        -67        -17         -65    -67      21       33    11     56      1
-17      -65      -67         -17       -65       -67 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-21T06:35:29.367

问题是您已将字节数组转换为平台默认编码中的字符串。

如果这是任意二进制数据（它似乎是），那么您不应该使用*任何*普通字符编码将其转换为字符串 - 改用 base64。

从 Java 中使用 base64 并不是*特别*容易（因为它不在标准库 AFAIK 中），但是您可以使用各种 3rd 方库，例如[Apache Commons Codec library 中的那个](http://commons.apache.org/codec/apidocs/org/apache/commons/codec/binary/Base64.html)。

在 C# 方面它会容易得多 - 只需使用：

```
byte[] data = Convert.FromBase64String(text); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-01-05T22:54:02.170

您必须确保您和您的朋友都使用相同的编码协议。因此，就 Java 而言，`String aString = new String(byteArray)`最好使用而不是使用`String aString = new String(byteArray, Charset.forName("UTF-8"))`（例如，如果你们都喜欢“UTF-8”）

PS：顺便说一句，您可能发现您朋友的字节数组多次出现以下模式“-17 -65 -67”。根据我的经验，这三个数字模式的意思是“？” UTF-8 中的字符

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2009-05-21T09:44:40.180

我同意之前的回答 - 您应该使用 base64 方法，但使用 base64 很容易；）。*只需使用sun.misc*包中的 base64 实用程序类：

```
import sun.misc.BASE64Decoder;
import sun.misc.BASE64Encoder;
import java.io.IOException;
import java.util.Arrays;
public class Base64Test {

    public static byte[] tmpIV = {0x43, (byte) 0x6d, 0x22, (byte) 0x9a, 0x22,
            (byte) 0xf8, (byte) 0xcf, (byte) 0xfe, 0x15, 0x21,
            (byte) 0x0b, 0x38, 0x01, (byte) 0xa7, (byte) 0xfc, 0x0e};

    public static void main(String[] args) {
        try {
            String encoded = new BASE64Encoder().encode(tmpIV);
            System.out.println(encoded);
            byte[] decoded = new BASE64Decoder().decodeBuffer(encoded);
            System.out.println(Arrays.equals(tmpIV,decoded));
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
} 
```

# c++ - 从单独的库调用 swprint 失败

> ID：891637
> 
> 赞同：2
> 
> 时间：2009-05-21T06:33:50.523
> 
> 标签：c++, c, unicode, variadic-functions, printf

我面临一个奇怪的问题。我根据构建定义使用 sprintf 或 swprintf 是否有 unicode。我已经将这些函数包装在我自己的函数中，如下所示：

```
int mysprintf( MCHAR* str,size_t size, const MCHAR* format, ... )
{
#ifdef MYUNICODE
    return swprintf( str, size, format);
#else
    return snprintf( str, format);
#endif
} 
```

这些函数位于 String 类中，该类是一个单独的项目，并被编译为 lib。我在另一个程序中使用它。现在如果我使用 mysprintf()

```
msprintf(str,10, _M("%d,%d"),height,width); 
```

我在字符串缓冲区中得到了一些垃圾值。但是，如果我直接从程序中调用 swprintf 函数，它就可以正常工作。我在构建中定义了 UNICODE，并且确实调用了函数 swprintf，但它填充了一些垃圾值。我不明白出了什么问题。

谢谢阿米特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T07:04:34.450

您需要将 mysprintf 函数中的 ... 参数传递给它包含的 prrintf 函数。为此，您应该使用 vprintf() 系列函数 - 有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/0zf95wk0%28VS.71%29.aspx](http://msdn.microsoft.com/en-us/library/0zf95wk0%28VS.71%29.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T09:25:39.453

问题确实在于您有自己的函数，其参数数量可变。您需要获取指向参数列表的指针并将其传递给被调用者。va_start 使您能够做到这一点，它需要参数列表中的最后一个指针指向您的函数。

```
 int mysprintf( MCHAR* str, size_t size, const MCHAR* format, ... )
    {
      va_list args;
      va_start(args, format);

      int result;

    #ifdef MYUNICODE
        result = vswprintf( str, size, format, args);
    #else
        result = ..
    #endif

      va_end(args);

      return result;
   } 
```

干杯！

# javascript - Extjs 培训

> ID：891638
> 
> 赞同：4
> 
> 时间：2009-05-21T06:34:35.357
> 
> 标签：javascript, ajax, extjs, frontend, javascript-framework

我们公司正在开始对其前端 Javascript 代码进行重大重构。我们决定使用 Extjs 作为框架，并希望为我们的几名员工进行一些培训。我们主要在寻找 Extjs 特定的材料，但一些高级架构不会受到伤害。我们很高兴让我们的员工飞到现场。问题是网络上有太多的选择。你甚至从哪里开始？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-10-19T19:09:40.297

无花果叶软件是一个可靠的替代品[http://training.figleaf.com/Courses/sencha.cfm](http://training.figleaf.com/Courses/sencha.cfm)您可以联系 Arya Heidari [arya atfigleaf dot com]，他们的培训选项非常灵活。

另一个可靠的选择是 Jay Garcia 的公司 Modus。他写了 Ext-JS in Action [http://moduscreate.com/offerings/training/extjs/](http://moduscreate.com/offerings/training/extjs/)

就像我在另一个答案中评论的那样，2000 美元/人/周末并不是那么高。你得到你所付出的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-01-18T18:04:37.887

如果您想使用最新的 Ext JS 4 版本，可以从 Ext JS 文档页面开始：[http ://docs.sencha.com/ext-js/4-0/#!/guide](http://docs.sencha.com/ext-js/4-0/#!/guide)

你可以在这里购买 Ext JS in Action，第二版，Meap 版：http: [//manning.com/garcia3/](http://manning.com/garcia3/)

这是我见过的最好的 Ext JS 书，Jesus Garcia 解释了 Ext JS 框架的每一个细节。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-21T10:44:26.267

Ext, LLC 是 ExtJs 的管理者，提供[企业培训](http://extjs.com/support/training/extjs/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-04-04T18:25:08.333

Extjs 是一个很好的快速前端开发框架。但是，4.0.7 中存在大量错误。其中许多在 4.1 中得到解决。我从对 Extjs 和 javascript 的零了解到能够在大约 1.5 个月内构建一个完整的网络应用程序。我是一个开发人员，请注意，所以我必须进行后端/前端编程。

你只需要对 javascript 和 css 有基本的了解。Extjs 文档中的示例非常好，这就是我能够如此快速地学习的原因。对我来说，使用 Extjs 最具挑战性的部分是让它与后端通信。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T22:18:01.890

你现在在哪里？有多少员工会参加培训？（你的后端技术是什么？）我之前一直在进行为期两天的培训（0.5 天 Javascript，0.5 天 Ext JS，1 天你最可能会使用的 Ext JS 部件/小部件的动手操作），我会很高兴为你做同样的事情！

您所说的“网络上有太多可用的选项”指的是什么？

我现在位于委内瑞拉的瓦伦西亚（距离阿鲁巴 40 分钟路程，如果你想对你的员工很好的话；）或者任何其他地方对我来说都可以。）

干杯，史蒂芬

Caprireleases dot com 的 s dot hiller

# twitter - Twitter 图像编码挑战

> ID：891643
> 
> 赞同：597
> 
> 时间：2009-05-21T06:37:52.093
> 
> 标签：twitter, unicode, compression

*如果一张图片值 1000 个字，那么 140 个字符可以容纳多少张图片？*

**注意**：就是这样，伙计们！赏金截止日期到了，经过深思熟虑后，我决定[Boojum 的参赛作品](https://stackoverflow.com/questions/891643/twitter-image-encoding-challenge/929360#929360)勉强超过了[Sam Hocevar 的](https://stackoverflow.com/questions/891643/twitter-image-encoding-challenge/904874#904874)参赛作品。一旦我有机会写出来，我会发布更详细的笔记。当然，每个人都应该随时继续提交解决方案并改进解决方案供人们投票。感谢所有提交和参赛的人；我很喜欢他们所有人。这对我来说很有趣，我希望对参赛者和观众来说都很有趣。

我遇到了一篇关于尝试将图像压缩到 Twitter 评论中的[有趣帖子，该帖子中的很多人（以及](http://www.flickr.com/photos/quasimondo/3518306770/in/set-72057594062596732/)[Reddit 上的一个帖子](http://www.reddit.com/r/programming/comments/8lwmw/guy_encodes_an_image_in_a_single_tweet140_chars/)）都对不同的方法提出了建议。所以，我认为这将是一个很好的编码挑战；让人们把钱放在嘴边，并展示他们关于编码的想法如何在您可用的有限空间中带来更多细节。

我挑战你想出一个通用系统，将图像编码为 140 个字符的 Twitter 消息，然后再次将它们解码为图像。您可以使用 Unicode 字符，因此每个字符可以获得超过 8 位。但是，即使允许使用 Unicode 字符，您也需要将图像压缩到非常小的空间中；这肯定是有损压缩，因此必须对每个结果看起来有多好进行主观判断。

以下是原作者[Quasimondo](http://www.flickr.com/photos/quasimondo/)从他的编码中得到的结果（图像是在[知识共享署名-非商业性许可](http://creativecommons.org/licenses/by-nc/2.0/deed.en)下获得许可的）： ![蒙娜丽莎](https://farm4.static.flickr.com/3346/3518306770_1de2bc2970.jpg?v=0)

你能做得更好吗？

### 规则

1.  你的程序必须有两种模式：**编码**和**解码**。
2.  **编码**时：
    1.  **您的程序必须将您选择的任何合理光栅**图形格式的图形作为输入。我们会说[ImageMagick](http://www.imagemagick.org/script/formats.php)支持的任何光栅格式都是合理的。
    2.  您的程序必须输出一条可以用 140 个或更少的 Unicode 代码点表示的消息；–<code>U+10FFFF范围内的 140 个代码点`U+0000`，不包括非字符 ( `U+FFFE`, `U+FFFF`, `U+`*n*`FFFE` , `U+`*n*`FFFF`其中*n*是`1`–<code>10 十六进制，范围`U+FDD0`–<code>U+FDEF) 和代理代码点 ( `U+D800`–<代码>U+DFFF）。它可以以您选择的任何合理编码输出；[GNU`iconv`](http://www.gnu.org/software/libiconv/)支持的任何编码都将被认为是合理的，您的平台本机编码或语言环境编码可能是一个不错的选择。有关更多详细信息，请参阅下面的**Unicode 注释**。
3.  **解码**时：
    1.  您的程序应将**编码**模式的输出作为输入。
    2.  您的程序必须以您选择的任何合理格式输出图像，如上所述，尽管输出矢量格式也可以。
    3.  图像输出应该是输入图像的近似值；离输入图像越近越好。
    4.  除了上面指定的输出之外，解码过程可能无法访问编码过程的任何其他输出；也就是说，您不能将图像上传到某处并输出 URL 以供解码过程下载，或者任何类似的愚蠢行为。
4.  为了用户界面的一致性，您的程序必须表现如下：

    1.  您的程序必须是可以在具有适当解释器的平台上设置为可执行的脚本，或者是可以编译为可执行文件的程序。
    2.  您的程序必须将`encode`或`decode`设置模式作为其第一个参数。
    3.  您的程序必须通过以下一种或多种方式获取输入（如果您实现了获取文件名的方式，如果缺少文件名，您也可以从 stdin 和 stdout 读取和写入）：

        1.  从标准输入获取输入并在标准输出上产生输出。

            ```
            my-program encode <input.png >output.txt
            my-program decode <output.txt >output.png 
            ```

        2.  从第二个参数命名的文件中获取输入，并在第三个参数命名的文件中产生输出。

            ```
            my-program encode input.png output.txt
            my-program decode output.txt output.png 
            ```

5.  对于您的解决方案，请发布：
    1.  您的完整代码和/或在其他地方托管的指向它的链接（如果它很长，或者需要很多文件来编译，或其他）。
    2.  如果代码不是很明显，或者代码很长并且人们会对摘要感兴趣，则说明它是如何工作的。
    3.  示例图像，包含原始图像、压缩后的文本和解码图像。
    4.  如果您正在建立其他人的想法，请归因于他们。尝试对别人的想法进行提炼是可以的，但你**必须**归因于他们。

### 指导方针

这些基本上是可能被打破的规则、建议或评分标准：

1.  审美很重要。我将根据以下内容进行判断，并建议其他人进行判断：
    1.  输出图像看起来有多好，它看起来与原始图像有多少相似之处。
    2.  文字看起来多好。如果你有一个非常聪明的压缩方案，完全随机的 gobbledigook 是可以的，但我也希望看到将图像变成多语言诗歌的答案，或者类似的聪明东西。请注意，原始解决方案的作者决定只使用汉字，因为这样看起来更好。
    3.  有趣的代码和聪明的算法总是好的。我喜欢简短、中肯、清晰的代码，但真正聪明的复杂算法也可以，只要它们能产生好的结果。
2.  速度也很重要，尽管不如压缩图像的工作好坏重要。我宁愿有一个可以在十分之一秒内转换图像的程序，而不是可以连续几天运行遗传算法的程序。
3.  我会更喜欢较短的解决方案而不是较长的解决方案，只要它们在质量上相当可比；简洁是一种美德。
4.  你的程序应该以一种可以在 Mac OS X、Linux 或 Windows 上免费使用的语言来实现。我希望能够运行这些程序，但如果你有一个很好的解决方案，只能在[MATLAB](http://en.wikipedia.org/wiki/MATLAB)或其他东西下运行，那很好。
5.  你的程序应该尽可能的通用；它应该适用于尽可能多的不同图像，尽管有些图像可能会产生比其他图像更好的结果。尤其：
    1.  将一些图像内置到程序中进行匹配并写入引用，然后在解码时生成匹配图像，这是相当蹩脚的，并且只会覆盖少数图像。
    2.  一个可以拍摄简单、平面、几何形状的图像并将它们分解为一些矢量基元的程序非常漂亮，但如果它在超过一定复杂度的图像上失败，它可能不够通用。
    3.  一个只能拍摄特定固定纵横比的图像但可以很好地处理它们的程序也可以，但并不理想。
    4.  您可能会发现，与彩色图像相比，黑白图像可以在更小的空间中获取更多信息。另一方面，这可能会限制它适用的图像类型；黑白相间的面孔效果很好，但抽象设计可能不太好。
    5.  如果输出图像小于输入图像，但比例大致相同，则完全没问题。如果您必须将图像放大以将其与原始图像进行比较，那也没关系；重要的是它的外观。
6.  你的程序应该产生实际上可以通过 Twitter 并且毫发无损的输出。这只是一个指导而不是规则，因为我找不到任何关于支持的精确字符集的文档，但你应该避免控制字符、时髦的不可见组合字符、私人使用字符等。

### 评分标准

作为在选择我接受的解决方案时我将如何对解决方案进行排名的一般指南，假设我可能会以 25 分来评估解决方案（这非常粗略，我不会直接评分任何东西，只是使用这是一个基本准则）：

*   **编码方案再现各种输入图像的能力为**15 分。**这是一种主观的、审美的判断

    *   0 表示它根本不起作用，它每次都返回相同的图像，或者什么
    *   5 意味着它可以编码一些图像，尽管解码后的版本看起来很难看，并且它可能根本无法处理更复杂的图像
    *   10 表示它适用于广泛的图像，并产生令人愉悦的图像，有时可能可以区分
    *   15 意味着它可以生成某些图像的完美复制品，甚至对于更大、更复杂的图像，也能提供可识别的东西。或者，也许它不会制作出非常容易辨认的图像，但会产生清晰地源自原始图像的精美图像。** 
***   **3分**巧妙使用Unicode字符集
    *   0 分用于简单地使用整个允许的字符集
    *   使用一组有限的字符可安全通过 Twitter 或在更广泛的情况下传输 1 分
    *   使用主题字符子集 2 分，例如仅汉字或仅从右到左的字符
    *   做一些非常整洁的事情得 3 分，比如生成可读的文本或使用看起来像相关图像的字符*   **聪明的算法方法和代码风格 **3 分**

    *   1000 行代码的 0 点仅用于缩小图像，将其视为每像素 1 位，然后 base64 对其进行编码
    *   使用标准编码技术且写得好且简短的东西得 1 分
    *   引入相对新颖的编码技术，或者令人惊讶的短而干净的东西，得 2 分
    *   实际产生良好结果或在图形编码中开辟新天地的单行线 3 分（如果这似乎是开辟新天地的低分，请记住，这种好结果可能会在美学方面获得高分以及）** ***   **速度2分**。在其他条件相同的情况下，越快越好，但以上标准都比速度更重要*   **在免费（开源）软件上运行得1 分**，因为我更喜欢免费软件（请注意，只要 C# 在 Mono 上运行，它仍然有资格获得这一点，同样，如果 MATLAB 代码在 GNU Octave 上运行，它也有资格）*   **实际遵守所有规则得1 分**。这些规则变得有点大和复杂，所以我可能会接受其他好的答案，但会错误地回答一个小细节，但我会为任何确实遵循所有规则的解决方案加分****

 ****### 参考图像

有些人要求提供一些参考图像。以下是一些您可以尝试的参考图像；此处嵌入了较小的版本，如果您需要，它们都链接到图像的较大版本：

[![莉娜](https://ephemera.continuation.org/stackoverflow/challenge/lena.png "莉娜")](http://www.cs.cmu.edu/~chuck/lennapg/lena_std.tif) [![蒙娜丽莎](https://ephemera.continuation.org/stackoverflow/challenge/mona-lisa.png "蒙娜丽莎")](http://upload.wikimedia.org/wikipedia/commons/6/6a/Mona_Lisa.jpg) [![康奈尔盒子](https://ephemera.continuation.org/stackoverflow/challenge/cornell-box.png "康奈尔盒子")](http://upload.wikimedia.org/wikipedia/commons/2/24/Cornell_box.png) [![StackOverflow 徽标](https://ephemera.continuation.org/stackoverflow/challenge/so-logo-small.png "StackOverflow 徽标")](http://ephemera.continuation.org/stackoverflow/challenge/so-logo.png)

### 奖

根据上述标准，我为我最喜欢的解决方案提供**500 个代表赏金**（加上 StackOverflow 启动的 50 个）。当然，我鼓励其他人也在这里投票选出他们最喜欢的解决方案。

### 截止日期注意事项

这场比赛将一直持续到赏金用完，大约在 5 月 30 日星期六下午 6 点左右。我不能说它结束的确切时间；它可能是下午 5 点到 7 点之间的任何时间。我保证我会查看下午 2 点之前提交的所有参赛作品，我会尽力查看所有下午 4 点之前提交的参赛作品；如果在那之后提交了解决方案，我可能没有机会在做出决定之前给他们一个公平的审视。此外，您越早提交，您就越有机会投票以帮助我选择最佳解决方案，因此请尝试尽早提交，而不是在截止日期前提交。

### Unicode 注释

对于究竟允许使用哪些 Unicode 字符，也存在一些混淆。可能的 Unicode 代码点的范围`U+0000`是`U+10FFFF`. 在任何开放的数据交换中，有些代码点永远不能用作 Unicode 字符；这些是非**字符**和**代理代码点**。非字符在[Unidode 标准 5.1.0 第 16.7 节](http://www.unicode.org/versions/Unicode5.0.0/ch16.pdf)中定义为值`U+FFFE`, `U+FFFF`, `U+`*n*`FFFE` , `U+`*n*`FFFF`其中*n*是`1`–<code>10 十六进制，范围`U+FDD0`–<代码>U+FDEF。这些值旨在用于特定于应用程序的内部使用，并且符合标准的应用程序可能会从它们处理的文本中去除这些字符。代理代码点，在[Unicode 标准 5.1.0 第 3.8 节](http://www.unicode.org/versions/Unicode5.0.0/ch03.pdf)中定义为`U+D800`–<code>U+DFFF，用于对 UTF-16 中基本多语言平面之外的字符进行编码；因此，不可能直接用 UTF-16 编码来表示这些代码点，并且用任何其他编码对它们进行编码都是无效的。因此，出于本次竞赛的目的，我将允许任何程序将图像编码为不超过 140 个 Unicode 代码点的序列，范围为`U+0000`–<code>U+10FFFF，不包括上面定义的所有非字符和代理对。

我会*更喜欢*只使用指定字符的解决方案，甚至更喜欢使用指定字符的聪明子集或使用他们使用的字符集做一些有趣的事情的更好的解决方案。有关分配字符的列表，请参阅[Unicode 字符数据库](http://unicode.org/Public/UNIDATA/UnicodeData.txt)；请注意，有些字符是直接列出的，而有些字符仅作为范围的开始和结束列出。另请注意，代理代码点已在数据库中列出，但如上所述是禁止的。如果您想利用字符的某些属性使输出的文本更有趣，可以使用[各种字符信息数据库](http://unicode.org/Public/UNIDATA/)，例如[命名代码块列表](http://unicode.org/Public/UNIDATA/Blocks.txt)和[各种字符属性](http://unicode.org/Public/UNIDATA/PropList.txt).

由于 Twitter 没有指定它们支持的确切字符集，因此我将对实际上不适用于 Twitter 的解决方案宽容，因为某些字符会额外计数或某些字符会被删除。最好但不要求所有编码输出都应该能够通过 Twitter 或其他微博服务（如[identi.ca](http://identi.ca/) ）不受损害地传输。我看过一些文档说明 Twitter 实体编码 <、> 和 &，因此分别将它们计为 4、4 和 5 个字符，但我自己没有测试过，他们的 JavaScript 字符计数器似乎没有以这种方式计算它们。

### 提示和链接

*   规则中有效 Unicode 字符的定义有点复杂。选择单个字符块，例如 CJK 统一表意文字 (U+4E00–U+9FCF) 可能更容易。
*   您可以使用现有的图像库，例如[ImageMagick](http://www.imagemagick.org/)或[Python Imaging Library](http://www.pythonware.com/products/pil/)来进行图像处理。
*   如果您在理解 Unicode 字符集及其各种编码方面需要帮助，请参阅[此快速指南](http://www.azillionmonkeys.com/qed/unicode.html)或[有关 Linux 和 Unix 中的 UTF-8 的详细常见问题解答](http://www.cl.cam.ac.uk/~mgk25/unicode.html)。
*   你越早得到你的解决方案，我（和其他投票的人）就会有越多的时间来研究它。如果您改进它，您可以编辑您的解决方案；当我最后一次浏览这些解决方案时，我会以最新版本为基础。
*   如果您想要一种简单的图像格式来解析和写入（并且不想只使用现有格式），我建议使用[PPM 格式](http://en.wikipedia.org/wiki/Netpbm_format)。它是一种基于文本的格式，非常易于使用，您可以使用[ImageMagick](http://www.imagemagick.org/)进行转换。

* * *

## 回答 #1

> 赞同：288
> 
> 时间：2009-05-28T09:31:35.517

[图像文件和 python 源](http://www.warriorhut.org/graphics/svg_to_unicode/)（版本 1 和 2）

**版本 1** 这是我的第一次尝试。我会随时更新。

我已将 SO 徽标缩减至 300 个字符，几乎无损。我的技术使用转换为 SVG 矢量艺术，因此它在线条艺术上效果最佳。它实际上是一个 SVG 压缩器，它仍然需要原始艺术经过矢量化阶段。

对于我的第一次尝试，我使用了 PNG 跟踪的[在线服务](http://vectormagic.com)，但是有许多免费和非免费工具可以处理这部分，包括[potrace](http://potrace.sourceforge.net/)（开源）。

这是结果

[原始 SO Logo http://www.warriorhut.org/graphics/svg_to_unicode/so-logo.png](http://www.warriorhut.org/graphics/svg_to_unicode/so-logo.png)原始 [解码 SO Logo http://www.warriorhut.org/graphics/svg_to_unicode/so-logo-decoded.png](http://www.warriorhut.org/graphics/svg_to_unicode/so-logo-decoded.png)编码后解码

**字符**: 300

**时间**：未测量但实际上是即时的（不包括矢量化/光栅化步骤）

下一阶段将在每个 unicode 字符中嵌入 4 个符号（SVG 路径点和命令）。目前，我的 python 构建没有广泛的字符支持 UCS4，这限制了我每个字符的分辨率。我还将最大范围限制在 unicode 保留范围 0xD800 的下限，但是一旦我构建了允许的字符列表和过滤器以避免它们，我理论上可以将所需的字符数推低至 70-100上面的标志。

目前这种方法的一个限制是输出大小不固定。它取决于矢量化后的矢量节点/点的数量。自动执行此限制将需要对图像进行像素化（这消除了矢量的主要好处）或通过简化阶段重复运行路径，直到达到所需的节点数（我目前在 Inkscape 中手动执行此操作）。

**版本 2**

**更新**：v2 现在有资格参加比赛。变化：

*   命令行控制输入/输出和调试
*   使用 XML 解析器 (lxml) 处理 SVG 而不是正则表达式
*   每个 unicode 符号包含 2 个路径段
*   文档和清理
*   支持 style="fill:color" 和 fill="color"
*   文档宽度/高度打包成单个字符
*   路径颜色打包成单个字符
*   颜色压缩是通过丢弃每种颜色的 4 位颜色数据，然后通过十六进制转换将其打包成一个字符来实现的。

**字符数**：**133**

**时间**：几秒钟

[v2解码 http://www.warriorhut.org/graphics/svg_to_unicode/so-logo-decoded-v2.png 编](http://www.warriorhut.org/graphics/svg_to_unicode/so-logo-decoded-v2.png)解码后（版本2）

正如你所看到的，这次有一些工件。这不是方法的限制，而是我转换中的某个错误。当点超出范围 0.0 - 127.0 时会出现伪影，而我限制它们的尝试取得了好坏参半的成功。解决方案只是缩小图像，但是我在缩放实际点而不是画板或组矩阵时遇到了麻烦，我现在太累了，无法关心。简而言之，如果您的积分在支持的范围内，它通常可以工作。

我相信中间的扭结是由于手柄移动到与之相连的手柄的另一侧。基本上，这些点一开始就太靠近了。在压缩源图像之前运行一个简化过滤器应该可以解决这个问题并去除一些不必要的字符。

**更新**：此方法适用于简单对象，因此我需要一种简化复杂路径并减少噪音的方法。我使用[Inkscape](http://www.inkscape.org/)来完成这项任务。我在使用 Inkscape 梳理出不必要的路径方面取得了一些运气，但没有时间尝试自动化它。我使用 Inkscape 的“简化”功能制作了一些示例 svg，以减少路径的数量。

简化工作正常，但有这么多路径可能会很慢。

[自动跟踪示例 http://www.warriorhut.org/graphics/svg_to_unicode/autotrace_16_color_manual_reduction.png](http://www.warriorhut.org/graphics/svg_to_unicode/autotrace_16_color_manual_reduction.png) [康奈尔盒子 http://www.warriorhut.com/graphics/svg_to_unicode/cornell_box_simplified.png](http://www.warriorhut.com/graphics/svg_to_unicode/cornell_box_simplified.png) [莉娜 http://www.warriorhut.com/graphics /svg_to_unicode/lena_std_washed_autotrace.png](http://www.warriorhut.com/graphics/svg_to_unicode/lena_std_washed_autotrace.png)

[追踪的缩略图 http://www.warriorhut.org/graphics/svg_to_unicode/competition_thumbnails_autotrace.png](http://www.warriorhut.org/graphics/svg_to_unicode/competition_thumbnails_autotrace.png)

这是一些超低分辨率的照片。这些将更接近 140 个字符的限制，尽管可能还需要一些巧妙的路径压缩。

[修饰 http://www.warriorhut.org/graphics/svg_to_unicode/competition_thumbnails_groomed.png](http://www.warriorhut.org/graphics/svg_to_unicode/competition_thumbnails_groomed.png) 简化和去斑。

[三角化 http://www.warriorhut.org/graphics/svg_to_unicode/competition_thumbnails_triangulated.png](http://www.warriorhut.org/graphics/svg_to_unicode/competition_thumbnails_triangulated.png) 简化、去斑和三角化。

```
autotrace --output-format svg --output-file cornell_box.svg --despeckle-level 20 --color-count 64 cornell_box.png 
```

[上图：使用autotrace](http://autotrace.sourceforge.net/)的简化路径。

不幸的是，我的解析器不处理自动跟踪输出，所以我不知道使用的点数或简化的程度，遗憾的是在截止日期之前几乎没有时间编写它。不过，它比inkscape 输出更容易解析。

* * *

## 回答 #2

> 赞同：244
> 
> 时间：2009-05-30T08:41:36.423

好的，这是我的：[nanocrunch.cpp](http://stackoverflow.pastebin.com/f30ea3d6f)和[CMakeLists.txt文件，以使用](http://stackoverflow.pastebin.com/f6c0164a4)[CMake](http://www.cmake.org/)构建它。它的大部分图像处理 依赖于[Magick++ ImageMagick API。](http://www.imagemagick.org/Magick++/)它的字符串编码还需要用于 bignum 算法的[GMP库。](http://gmplib.org/)

我的解决方案基于分形图像压缩，并带有一些独特的曲折。基本思想是拍摄图像，将副本缩小到 50%，然后在不同方向寻找与原始图像中的非重叠块相似的片段。这种搜索需要一种非常暴力的方法，但这只会让我更容易介绍我的修改。

第一个修改是，我的程序不仅考虑了 90 度的旋转和翻转，还考虑了 45 度的方向。每块多一位，但它极大地提高了图像质量。

另一件事是为每个块的每个颜色分量存储对比度/亮度调整太昂贵了。相反，我存储了一种高度量化的颜色（调色板只有 4 * 4 * 4 = 64 种颜色），它只是以某种比例混合在一起。从数学上讲，这相当于对每种颜色进行可变亮度和恒定对比度调整。不幸的是，这也意味着翻转颜色没有负面对比。

一旦计算出每个块的位置、方向和颜色，它就会将其编码为 UTF-8 字符串。首先，它生成一个非常大的 bignum 来表示块表中的数据和图像大小。解决这个问题的方法类似于 Sam Hocevar 的解决方案——一种带有随位置变化的基数的大数。

然后它将其转换为可用字符集大小的基础。默认情况下，它充分利用分配的 unicode 字符集，减去小于、大于、&、控制、组合、代理和私有字符。它不漂亮，但它有效。您还可以注释掉默认表并选择可打印的 7 位 ASCII（同样不包括 <、> 和 & 字符）或 CJK 统一表意文字。哪些字符代码可用的表存储了一个用无效和有效字符交替运行编码的游程长度。

无论如何，这里有一些图像和时间（在我的旧 3.0GHz P4 上测量），并在上述完整分配的 unicode 集中压缩为 140 个字符。总的来说，我对他们的结果感到相当满意。如果我有更多时间来解决这个问题，我可能会尝试减少解压缩图像的块状。尽管如此，我认为极端压缩比的结果还是相当不错的。解压缩后的图像有点印象派，但我发现比较容易看出位与原始图像的对应关系。

[Stack Overflow 徽标（编码 8.6 秒，解码 7.9 秒，485 字节）： http](http://i44.tinypic.com/2w7lok1.png) ://i44.tinypic.com/2w7lok1.png
![](https://ephemera.continuation.org/stackoverflow/challenge/so-logo.png)

Lena（编码 32.8s，解码 13.0s，477 字节）：[http ://i42.tinypic.com/2rr49wg.png](http://i40.tinypic.com/2rhxxyu.png)
[http://i40.tinypic.com/2rhxxyu.png](http://i42.tinypic.com/2rr49wg.png)

蒙娜丽莎（43.2s 编码，14.5s 解码，490 字节）：[http ://i41.tinypic.com/ekgwp3.png](http://i43.tinypic.com/ngsxep.png)
[http://i43.tinypic.com/ngsxep.png](http://i41.tinypic.com/ekgwp3.png)

**编辑：中日韩统一字符**

Sam 在评论中询问了如何将其与 CJK 一起使用。这是蒙娜丽莎的一个版本，从 CJK 统一字符集中压缩为 139 个字符：

[http://i43.tinypic.com/2yxgdfk.png](http://i43.tinypic.com/2yxgdfk.png) 咏璞驞凄脒鵚蛥鸂拗搚蛥鸂拗搚朖辿韩拗搽朖辿韩拗拜歪致畸聚栘璯瘍频蕜抱揎蓼蓼债鑡嗞靊孤柮嚛嚵籥隤慛絖渫矍昀掾撄掾撄蔍螎峬覧绌蹔绌蹔抆惫冧筇哜冧筇哜搀沄芯譶辍浍垝黟黟偞偞媄媄媄童佟鹆鹆鰬懆懇鐤杞鷍駫駫駫诬懇搤斞芍嚅鹆鹬谬爇搤斳垤珵揬谬氬愿秀氬笗瞛洞认珵笥笹熹熜珫珵珲狰珺熜珫珰珰珰珰珰珰珰珰珰珰珬珬珰珰珰珰珰杍呬珰搵珰珰珰杍埬搱笠珰珰珰杍呬珲笠珰珰杍呬珰珰珰珰杍呫擸萿</p>

我为此使用的程序顶部的调整参数是：19、19、4、4、3、10、11、1000、1000。我还注释掉了 number_assigned 和代码的第一个定义，并取消注释掉最后定义它们以选择 CJK 统一字符集。

* * *

## 回答 #3

> 赞同：199
> 
> 时间：2009-05-24T23:41:06.137

我的完整解决方案可以在[http://caca.zoy.org/wiki/img2twit](http://caca.zoy.org/wiki/img2twit)。它具有以下特点：

*   合理的压缩时间（高质量约 1 分钟）
*   快速减压（几分之一秒）
*   保持原始图像大小（不仅仅是纵横比）
*   体面的重建质量（恕我直言）
*   可以在运行时选择消息长度和字符集（ASCII、CJK、符号）
*   解压时自动检测消息长度和字符集
*   非常有效的信息打包

> [http://caca.zoy.org/raw-attachment/wiki/img2twit/so-logo.png](http://caca.zoy.org/raw-attachment/wiki/img2twit/so-logo.png) [http://caca.zoy.org/raw-attachment/wiki/img2twit/twitter4.png](http://caca.zoy.org/raw-attachment/wiki/img2twit/twitter4.png)
> 
> 蜥秓鋖筷聝诿缰咱幻腶漷庯祩靊谪獜岨寤厎趆脘搇梄踥桻理戂溥欇渹里軱骿苸髙骟市簶悦粭浧鳖岚捕弫衍蚙瀹玧霫鏓蓕戏债债人鼶襋躻弯袮足庭侅旍凼高峰驱动据莔倾诗籂施虐嶹婻模墤渽緛更当棫武凼驩缣珸齸陁杯飉珸齸陁飉珸齸陁掷掷篓蕥攩庁鰀干鰀干耓庁鰀寓箕稀肝亖弜弜寲诉蝞躐葌熲掩蛰曟暙吐媏嘝骕慸氤缰殾葑

以下是编码过程的粗略概述：

*   可用位的数量是根据所需的消息长度和可用字符集计算的
*   在可用位允许的情况下，源图像被分割成尽可能多的方形单元
*   固定数量的点（当前为 2）影响到每个单元格，具有初始坐标和颜色值
*   重复以下操作，直到满足质量条件：
    *   一个点是随机选择的
    *   在这一点上随机执行一个操作（将其移动到其单元格内，更改其颜色）
    *   如果生成的图像（见下面的解码过程）更接近源图像，则保持操作
*   图像大小和点列表以 UTF-8 编码

这是解码过程：

*   从 UTF-8 流中读取图像大小和点
*   对于目标图像中的每个像素：
    *   计算自然邻居列表
    *   像素的最终颜色设置为其自然邻居颜色的加权平均值

我认为该程序最原始的部分是比特流。我没有打包位对齐的值 ( `stream <<= shift; stream |= value`)，而是打包不在二次幂范围内的任意值 ( `stream *= range; stream += value`)。这需要 bignum 计算，当然速度要慢得多，但是当使用 20902 主要 CJK 字符时，它给了我 2009.18 位而不是 1960 位（我可以在数据中再输入三个点）。当使用 ASCII 时，它给了我 917.64 位而不是 840。

我决定反对一种需要重型武器（角检测、特征提取、颜色量化......）的初始图像计算方法，因为起初我不确定它是否真的有帮助。现在我意识到收敛速度很慢（1 分钟是可以接受的，但它仍然很慢），我可能会尝试改进它。

主要拟合循环的灵感来自 Direct Binary Seach 抖动算法（其中像素随机交换或翻转，直到获得更好的半色调）。能量计算是一个简单的均方根距离，但我首先对原始图像执行 5x5 中值滤波。高斯模糊可能会更好地代表人眼的行为，但我不想失去锐利的边缘。我还决定不使用模拟退火或其他难以调整的方法，因为我没有几个月的时间来校准这个过程。因此，“质量”标志仅表示在编码器结束之前在每个点上执行的迭代次数。

> [http://caca.zoy.org/raw-attachment/wiki/img2twit/Mona_Lisa_scaled.jpg](http://caca.zoy.org/raw-attachment/wiki/img2twit/Mona_Lisa_scaled.jpg) [http://caca.zoy.org/raw-attachment/wiki/img2twit/twitter2.png](http://caca.zoy.org/raw-attachment/wiki/img2twit/twitter2.png)
> 
> 苉扗任揣嶕繠剳腏篮湿茝霮墧蒆棣杚蓳缚樟赒赒蜌峂当砃燋朌峂釰霹燋朓峂釰霹雳陴讜犟掰霹喗讄荛砙矺敨鷾璎亨髎芟氲燰鸬嫫激躙怃邺甮槺骳佛愚猪駪惾嫥綖珏矫坼堭颽箽赭飉讷偁窂蹻熛漧众橼愀航玴毡裋頢垒瑥墎嬔鑹楄瑥鹣呍蕖抲鹣秓苾绒毡嵞脔婺污啰酼俵菛琪棺则辩曚鸸职铦蒝礭鱚蟺稿纡醾陴鳣尥蟀惘铝髚忩祤脤养况趯沅

尽管并非所有图像都可以很好地压缩，但我对结果感到惊讶，我真的想知道还有哪些其他方法可以将图像压缩到 250 字节。

我还有关于编码器状态[从随机初始状态](http://people.zoy.org/~sam/twitter-random.ogm)和[“良好”初始状态](http://people.zoy.org/~sam/twitter-good.ogm)演变的小电影。

**编辑**：这是压缩方法与 JPEG 的比较。左边，jamoes 的 536 字节以上的图片。在右边，蒙娜丽莎使用这里描述的方法压缩到 534 个字节（这里提到的字节是指数据字节，因此忽略使用 Unicode 字符浪费的位）：

> [http://caca.zoy.org/raw-attachment/wiki/img2twit/minimona.jpg](http://caca.zoy.org/raw-attachment/wiki/img2twit/minimona.jpg) [http://caca.zoy.org/raw-attachment/wiki/img2twit/minimona2.png](http://caca.zoy.org/raw-attachment/wiki/img2twit/minimona2.png)

**编辑**：刚刚用最新版本的图像替换了 CJK 文本。

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2009-05-29T05:46:37.247

以下不是正式提交，因为我的软件没有以任何方式针对指定的任务进行定制。 [DLI](http://sites.google.com/site/dlimagecomp/)可以被描述为一种优化的通用有损图像编解码器。它是图像压缩的 PSNR 和 MS-SSIM 记录保持者，我认为看看它在这项特定任务中的表现会很有趣。我使用提供的参考蒙娜丽莎图像并将其缩小到 100x150，然后使用 DLI 将其压缩到 344 字节。

[蒙娜丽莎 DLI http://i40.tinypic.com/2md5q4m.png](http://i40.tinypic.com/2md5q4m.png)

为了与 JPEG 和 IMG2TWIT 压缩样本进行比较，我也使用 DLI 将图像压缩到 534 字节。JPEG 为 536 字节，IMG2TWIT 为 534 字节。图像已按比例放大到大致相同的大小，以便于比较。JPEG 是左图，IMG2TWIT 是中心图，DLI 是右图。

[比较 http://i42.tinypic.com/302yjdg.png](http://i42.tinypic.com/302yjdg.png)

DLI 图像设法保留了一些面部特征，最著名的是著名的微笑:)。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-05-21T09:03:38.123

我的解决方案的一般概述是：

1.  我首先计算可以放入 140 个 utf8 字符的最大原始数据量。
    *   （我假设 utf8，这是原始[网站](http://www.flickr.com/photos/quasimondo/3518306770/in/photostream/)声称 twitter 将其消息存储在其中的内容。这与上面要求 utf16 的问题陈述不同。）
    *   使用[这个 utf8 faq](http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8)，我计算出您可以在单个 utf8 字符中编码的最大位数是 31 位。为此，我将使用 U-04000000 – U-7FFFFFFF 范围内的所有字符。（1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx，有 31 个 x，因此我最多可以编码 31 位）。
    *   31 位乘以 140 个字符等于 4340 位。将其除以 8 得到 524.5，然后将其四舍五入为**542 字节**。
    *   （如果我们将自己限制为 utf16，那么每个字符只能存储 2 个字节，相当于 280 个字节）。
2.  使用标准 jpg 压缩压缩图像。
    *   将图像大小调整为大约 50x50 像素，然后尝试以不同的压缩级别对其进行压缩，直到您的图像尽可能接近 542 字节，而不会超过。
    *   [这是一个](https://imgur.com/zikqe.jpg)将蒙娜丽莎压缩到 536 字节的示例。
3.  将压缩图像的原始位编码为 utf-8 字符。
    *   将以下字节中的每个 x 替换为图像中的位：1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx。
    *   这部分可能是需要编写大部分代码的部分，因为目前没有任何东西可以做到这一点。

我知道您在要求代码，但我真的不想花时间实际编写代码。我认为一个高效的设计至少可以激发其他人编写代码。

我认为我提出的解决方案的主要好处是它尽可能多地重用现有技术。尝试编写一个好的压缩算法可能很有趣，但肯定会有更好的算法，最有可能是由拥有高等数学学位的人编写的。

另一个重要的注意事项是，如果确定 utf16 是首选编码，那么这个解决方案就会失败。当压缩到 280 字节时，jpegs 并不能真正工作。虽然，对于这个特定的问题陈述，也许有比 jpg 更好的压缩算法。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2010-08-22T11:17:40.717

好吧，我迟到了，但我还是做了我的项目。

这是一种玩具遗传算法，它使用半透明的彩色圆圈来重新创建初始图像。

特征：

*   纯Lua。在 Lua 解释器运行的任何地方运行。
*   使用 netpbm P3 格式
*   带有一套全面的单元测试
*   保留原始图像大小

误区：

*   慢的
*   在这个空间限制下，它只保留了初始图像的基本配色方案和几个特征的大致轮廓。

下面是一个代表Lena的例子： 犭杨谷杌蒝螦界匘玑扝俄归刀客猘摈硰划萕码抱斢嘁蜁晃耂澹婊内簜偾砠偑婊内簜偾砠偑臀簜偾砠偑臀簜偾翈义倨裆凁梡岂戆耆耋斘爆耆耋攋斘爔戡蔋昸箔奡萋昸箔奡嬎廩栃兆塅嬎廩栃兆塅僘称赜千戞优称赜卐戞优杈杈赜蝈蝈杈杈芶蝽蝽杈杈赜綍蝈杈杈赜戣杈杈芶蝊猫扪昜昜压盩悡诟来眉屐搡诟来昜压籐悡诟来瘜压琛悡诟来眉屐昸皕嘜彍傩吆别虲兙罨縨炘排抠堃从弅芅芎熰标宑箫柢橙拃枀缩昔傥舭励癳冂堆积璟彝兠摔摔侑蒖孂埮槃姠哠榕眛嫡砠枀訜柬芠枀訜厇廪焛瀻严啘刱垫仔

![原来的莉娜](https://i.stack.imgur.com/6igP4.png) ![编码莉娜](https://i.stack.imgur.com/cCqy3.png)

该代码位于 bitbucket.org 的 Mercurial 存储库中。查看[http://bitbucket.org/tkadlubo/circles.lua](http://bitbucket.org/tkadlubo/circles.lua)

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2009-05-30T14:02:25.233

以下是我解决这个问题的方法，我必须承认这是一个非常有趣的项目，它绝对超出了我的正常工作范围，并且给了我一些新的东西来学习。

我的基本思想如下：

1.  对图像灰度进行下采样，使得总共有 16 种不同的色调
2.  在图像上预制 RLE
3.  将结果打包成 UTF-16 字符
4.  对打包结果执行 RLE 以删除任何重复的字符

事实证明，这确实有效，但只是在有限的范围内，正如您从下面的示例图像中看到的那样。在输出方面，下面是一条示例推文，专门针对示例中显示的 Lena 图像。

> 乤乤万乐唂伂倂倁企侬2企倁3企倁2伂8企伂3企伂5企倂倃伂倁3企俊2伂倃5企企倁3企倃4企倂企倁倁伂2企伂5企倁企伂쥹阹럆䧜椿籫릹韧욶옷뎷歩㰷伴鑹㞳鞷㽴獴鏙돗鍴獴鏙돗鍴祳㭾뤶殒焻乹䏋叇似</pp>

如您所见，我确实尝试对字符集进行了一些限制；但是，我在存储图像颜色数据时遇到了问题。此外，这种编码方案还倾向于浪费大量可用于附加图像信息的数据位。

在运行时间方面，对于小图像，代码非常快，提供的示例图像大约需要 55 毫秒，但随着图像的增大，时间确实会增加。对于 512x512 Lena 参考图像，运行时间为 1182 毫秒。我应该注意到，代码本身并没有针对性能进行优化的可能性很大（例如，所有内容都作为[Bitmap](http://msdn.microsoft.com/en-us/library/system.drawing.bitmap.aspx)使用），因此在进行一些重构后时间可能会下降一点。

请随时就我可以做得更好或代码可能有什么问题向我提供任何建议。运行时间和示例输出的完整列表可以在以下位置找到：[http ://code-zen.info/twitterimage/](http://code-zen.info/twitterimage/)

**更新一**

我更新了压缩推文字符串时使用的 RLE 代码以进行基本回顾，如果是这样，则将其用于输出。这仅适用于数字值对，但它确实保存了几个字符的数据。运行时间与图像质量或多或少相同，但推文往往要小一些。完成测试后，我将更新网站上的图表。以下是示例推文字符串之一，同样适用于小版本的 Lena：

> 乤乤万乐唂伂倂倁企侬2企倁3企倁ウ伂8企伂エ伂5企倂倃伂倁グ俊企2伂倃ガ倁ジ倃4企倂企倁企伂ツ伂ス倁伂쥹痗鞟鐾륶䦽阹럱䧜椿皫릹韧욶옷뎷歩㰷䴗鑹㞳鞷ぼ獴鏙돗鍴獴鏙돗鍴祳㭾涮焻乹Ꮛ叇䍼</p>

**更新二**

另一个小更新，但我修改了代码以将颜色阴影打包成三个而不是四个一组，这会占用更多空间，但除非我遗漏了什么，否则它应该意味着“奇数”字符不再出现在颜色的位置数据是。此外，我对压缩进行了更多更新，因此它现在可以作用于整个字符串，而不仅仅是颜色计数块。我仍在测试运行时间，但它们似乎在名义上有所改善；但是，图像质量仍然相同。以下是莉娜推文的最新版本：

> 2乤万乐唂伂倂倁企永2企倁3企倁ウ伂8企伂エ伂5企倂倃伂倁グ俊企2伂倃ガ倁ジ倃4企倂企倁企伂ツ伂ス倁伂坹坼坼坶坻刾啩容力吹婩媷劝圿奁婣妛啭奁婣冷咛啫涂奉奉宗宗坍塌似奎喳女媗决兴喓夽兴唹冷圶埫唓坤商嗉乃

[StackOverflow 徽标 http://code-zen.info/twitterimage/images/stackoverflow-logo.bmp](http://code-zen.info/twitterimage/images/stackoverflow-logo.bmp) [康奈尔盒子 http://code-zen.info/twitterimage/images/cornell-box.bmp](http://code-zen.info/twitterimage/images/cornell-box.bmp) [莉娜 http://code-zen .info/twitterimage/images/lena.bmp](http://code-zen.info/twitterimage/images/lena.bmp) [蒙娜丽莎 http://code-zen.info/twitterimage/images/mona-lisa.bmp](http://code-zen.info/twitterimage/images/mona-lisa.bmp)

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2009-05-21T09:52:12.473

Roger Alsing 编写的这种遗传算法具有良好的压缩比，但代价是压缩时间较长。可以使用有损或无损算法进一步压缩得到的顶点向量。

[http://rogeralsing.com/2008/12/07/genetic-programming-evolution-of-mona-lisa/](http://rogeralsing.com/2008/12/07/genetic-programming-evolution-of-mona-lisa/)

将是一个有趣的程序来实现，但我会错过它。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2009-05-22T11:41:20.590

在最初的挑战中，大小限制被定义为如果您将文本粘贴到他们的文本框中并按“更新”，Twitter 仍然允许您发送的内容。正如一些人正确地注意到的那样，这与您可以通过手机发送的 SMS 文本消息不同。

没有明确提及（但我个人的规则是）是您应该能够在浏览器中选择推文消息，将其复制到剪贴板并将其粘贴到解码器的文本输入字段中，以便它可以显示它。当然，您也可以自由地将消息保存为文本文件并将其读回或编写一个工具来访问 Twitter API 并过滤掉任何看起来像图像代码的消息（特殊标记任何人？*眨眼* *眨眼*）。但规则是消息必须先通过 Twitter，然后才能被允许对其进行解码。

祝你好运 350 字节 - 我怀疑你是否能够使用它们。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2009-05-22T13:21:57.983

发布单色或灰度图像应该会提高可以编码到该空间的图像的大小，因为您不关心颜色。

可能会增加上传三张图像的挑战，这些图像在重新组合时会为您提供全彩色图像，同时在每个单独的图像中仍保持单色版本。

在上面添加一些压缩，它可能开始看起来可行......

好的！！！现在你们引起了我的兴趣。剩下的时间不会做任何工作...

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2009-08-07T01:39:09.813

关于这个挑战的编码/解码部分。 [base16b.org](http://base16b.org)是我尝试指定一种标准方法，用于在更高的 Unicode 平面中安全有效地编码二进制数据。

一些特点：

*   仅使用 Unicode 的私有用户区
*   每个字符最多编码 17 位；效率是 Base64 的近三倍
*   提供了编码/解码的参考 Javascript 实现
*   包括一些示例编码，包括 Twitter 和 Wordpress

抱歉，这个答案对于最初的比赛来说来得太晚了。我独立于这篇文章开始了这个项目，我在这篇文章中发现了这篇文章。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2009-05-27T01:50:54.210

存储一堆参考图像的想法很有趣。存储 25Mb 的样本图像并让编码器尝试使用其中的一些位组成图像会不会有这么大的错误？有了这么小的管道，两端的机器必然会比通过的数据量大得多，那么 25Mb 的代码、1Mb 的代码和 24Mb 的图像数据有什么区别呢？

（请注意，原始指南排除了将输入限制为库中已有图像的可能性——我不建议这样做）。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2009-05-30T20:47:15.957

愚蠢的想法，但`sha1(my_image)`会导致任何图像的“完美”表示（忽略碰撞）。明显的问题是解码过程需要大量的暴力破解。

1 位单色会更容易一些。每个像素变成 1 或 0，因此对于 100*100 像素的图像，您将拥有 1000 位数据。由于 SHA1 哈希是 41 个字符，我们可以将三个信息合二为一，只需要暴力破解 2 组 3333 位和一组 3334 （尽管即使这样可能仍然是过度的）

这并不完全实用。即使使用固定长度的 1 位 100*100px 图像，也有..，假设我没有计算错误，49995000 个组合，或 16661667 拆分为三个。

```
def fact(maxu):
        ttl=1
        for i in range(1,maxu+1):
                ttl=ttl*i
        return ttl

def combi(setsize, length):
    return fact(length) / (fact(setsize)*fact(length-setsize))

print (combi(2, 3333)*2) + combi(2, 3334)
# 16661667L
print combi(2, 10000)
# 49995000L 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2009-07-19T18:27:59.953

这里的压缩很好。

[http://www.intuac.com/userport/john/apt/](http://www.intuac.com/userport/john/apt/)

[http://img86.imageshack.us/img86/4169/imagey.jpg http://img86.imageshack.us/img86/4169/imagey.jpg](http://img86.imageshack.us/img86/4169/imagey.jpg)

我使用了以下批处理文件：

```
capt mona-lisa-large.pnm out.cc 20
dapt out.cc image.pnm
Pause 
```

生成的文件大小为 559 字节。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-04-17T20:53:59.200

想法：你能用字体作为调色板吗？尝试将图像分解为一系列向量，尝试用向量集的组合来描述它们（每个字符本质上都是一组向量）。这是使用字体作为字典。例如，我可以将 al 用于垂直线，将 - 用于水平线？只是一个想法。

# sql-server - 什么会导致 SQL Server 提供不存在或访问被拒绝

> ID：891645
> 
> 赞同：0
> 
> 时间：2009-05-21T06:38:40.593
> 
> 标签：sql-server

我有一个 MSACCESS 数据库使用链接表访问的 SQL Server 2005 数据库。

有时我们会在大多数其他时间正常工作时收到 SQL Server 不会 esit 或访问拒绝消息。客户当然是这样。

我们可能是什么原因造成的？

马尔科姆

编辑：这实际上是一条 ODBC 消息。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-21T06:59:41.777

我们已经看到由距离和防火墙引起的*间歇性*错误，尤其是对于非默认实例。我说的距离是指纽约的客户，我们在瑞士。伦敦的问题更少，瑞士为零。

我们移至“server.domain.tld\instancename,port”，所有问题都消失了。这避免了额外的往返（到端口 1434）来查找实例端口

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T07:00:56.313

假设服务器确实存在并且被授予访问权限，这通常是由于网络问题或服务器负载太高而无法响应。

# c# - 扩展属性

> ID：891646
> 
> 赞同：0
> 
> 时间：2009-05-21T06:38:54.243
> 
> 标签：c#

嗨，我正在 Windows 应用程序中创建一个用户控件，其中包含带有 n 个节点
的 Treeview 节点数将在运行时决定。
我想在每个 TreeNode 上存储一些数据，当 TreeNode 被选中时我可以检索这些数据。
问题是某些节点将存储 custid,custname..
一些存储 studid,studname,,,,,,

我使用过扩展方法
static class Extension
{
static Dictionary m_Dictionary=new Dictionary();
public static void SetTags(this TreeNode p_TreeNode, Dictionary p_Dictionary)
{
m_Dictionary = p_Dictionary;
}
public static Dictionary GetTags(this TreeNode p_TreeNode)
{
return m_Dictionary;
}
}
但它无济于事，因为我只在最后一个节点上获取数据......
我怎么能做到这一点......
是否有类似 etension 属性的东西......或者是否有任何其他解决方案。
预先感谢，，，，，，，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T06:46:03.840

如果您想将简单的字符串数据添加到树节点使用属性，则不存在所谓的 etension`Tag`属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T06:44:55.653

不，没有 C# 3.0 这样的东西。

看看这个： [https ://stackoverflow.com/questions/138367/most-wanted-feature-for-c-4-0](https://stackoverflow.com/questions/138367/most-wanted-feature-for-c-4-0)

# java - 如何在 OGNL 中获取请求语言环境？

> ID：891658
> 
> 赞同：1
> 
> 时间：2009-05-21T06:48:15.787
> 
> 标签：java, struts2, ognl

我想知道如何在 OGNL 中获取请求语言环境？

现在我使用

```
<s:set var="locale" value='#session.WW_TRANS_I18N_LOCALE?#session.WW_TRANS_I18N_LOCALE.toString():"zh_CN"'/> 
```

这必须假设初始值为“zh_CN”。

所以我需要知道如何在 OGNL 中获取请求语言环境。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T12:11:11.397

```
#request.locale 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-26T13:59:49.430

`#request.locale`返回 java.util.Locale 对象

尝试

```
<s:if test="#request.locale.language=='en'">
  Current Locale is ENGLISH
</s:if>
<s:else test="#request.locale.language=='fr'">
  Current Locale is FRANCE
</s:else> 
```

# iphone - 如何在objective-c中实现/计算这个函数？

> ID：891659
> 
> 赞同：-3
> 
> 时间：2009-05-21T06:48:16.520
> 
> 标签：iphone, xcode, math

CUMIPMT（费率，付款次数，PresentValue，StartPeriod，EndPeriod，类型）。？请告诉我一步一步的指导这个公式是如何工作的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T07:10:43.203

我假设计算一个基本的复利公式。您可以在整个网络上阅读有关复利的更多信息，尤其是在[http://en.wikipedia.org/wiki/Compound_interest#Compound](http://en.wikipedia.org/wiki/Compound_interest#Compound)

他们给出的公式与上面的形式不完全相同，但概念相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T08:49:00.977

你可以看看[`get_cumipmt(..)`](http://www.koders.com/c/fidFF5D25C2282C5FAEE1D0AFE3220DA0A906D6D3D7.aspx?s=CUMIPMT#L271)或[`AnalysisAddIn::getCumipmt(..)`](http://www.koders.com/cpp/fid4B9ED60F6C035E346E7365383408FF0F340C282C.aspx?s=cumipmt#L174)@koders.com

请注意，如果您打算复制它，这些都在 LGPL 和 GPL 下，但是在制作自己的实现时可以很好地查看它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T08:32:32.947

这就是 MS Excel 复利公式 -

[参考这里](http://office.microsoft.com/en-us/excel/HP052090381033.aspx) 和这里是 [如何使用它的简短视频](http://www.tvlesson.com/video/6421_excel-finance-trick-18-cumipmt-function-for-interest.html)

至于它的实际实现，维基百科链接也是我发现的最好的指南。

# sql - SQL选择PostgreSQL列中所有值的中间三分之一

> ID：891663
> 
> 赞同：2
> 
> 时间：2009-05-21T06:50:10.060
> 
> 标签：sql, mysql, math, postgresql, select

假设我有一列高度——我如何才能选择所有且只选择既不在前 30% 值也不在后 30% 的高度值。

我想要 PostgreSQL 的答案（或者，如果失败了，MySQL ——我正在使用 Rails）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T07:01:12.210

```
WITH cte AS (
 SELECT *, NTILE(100) OVER (ORDER BY column) as rank
 FROM table)
SELECT * FROM cte WHERE rank BETWEEN 30 and 70 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T06:55:38.850

对于 SQL Server 2005 +

```
SELECT
    *
FROM
    MyTable M
EXCEPT
SELECT
    *
FROM
    (SELECT TOP 30 PERCENT
        *
    FROM
        MyTable M
    ORDER BY
        Height
    UNION ALL
    SELECT TOP 30 PERCENT
        *
    FROM
        MyTable M
    ORDER BY
        Height DESC) foo 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-21T07:00:44.003

对于 sql server 2005+，您应该为此使用[NTILE()](http://msdn.microsoft.com/en-us/library/ms175126.aspx)函数。

```
SELECT *
FROM   (
         SELECT ntile(3) over(order by AddressId) as Percentile, *
         FROM   (
                SELECT top 100 *
                FROM   Person.Address
           ) t
       ) t
where Percentile = 2 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T08:47:10.857

您要求 PostgresSQL，它不支持 NTITLE 或 TOP X PERCENT。

如果没有其中任何一个，我可以想到这样的查询来检索中间行：

```
select *
from MyTable
where height not in (
    select Height from MyTable order by Height desc 
    limit ((select count(*) from MyTable)*0.3)
    union
    select Height from MyTable order by Height
    limit ((select count(*) from MyTable)*0.3)
) 
```

现在，我不确定 PostgresSQL 是否支持在子查询中计算的限制，而且我附近没有 PostgresSQL 数据库可以尝试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-28T22:01:17.360

Postgres 只接受限制条款中的内容。所以上面的解决方案不起作用。

您的选择是这样的：

```
SELECT *
  FROM (SELECT T.HEIGHT, 
               -- this tells us the "ranking" of each row 
               -- by counting all the heights that are small than 
               -- height in the that row
               (SELECT COUNT(*) + 1
                  FROM <table> T1 
                 WHERE T1.HEIGHT < T.HEIGHT
               ) AS RANK,
               -- this tells us the count of rows in the table
               (SELECT COUNT(*) 
                  FROM <table> T1
               ) AS REC_COUNT
          FROM <table> T
         ORDER BY T.HEIGHT
       ) T
 -- now just list rows wich ranking is between (not top30) and (not bottom30)
 WHERE T.RANK BETWEEN (T.REC_COUNT*0.30) AND (T.REC_COUNT*0.70) 
```

这将适用于任何接受子选择（子查询）的数据库。

这不处理“高度”中的相等性，但可以使用主键来完成

```
SELECT COUNT(*) + 1
  FROM <table> T1 
 WHERE (T1.HEIGHT < T.HEIGHT)
    OR (T1.HEIGHT = T.HEIGHT and T1.PK_FIELD < T.PK_FIELD) 
```

问候。

# c# - 计算串行通信的块校验字符 (BCC)

> ID：891664
> 
> 赞同：4
> 
> 时间：2009-05-21T06:50:31.947
> 
> 标签：c#, .net, serial-port, serial-communication

我正在通过.NET 的 SerialPort 类通过串行与设备通信，并且根据第三方设备规范要求，我需要计算“块检查字符”。我被告知的唯一信息是它是**异或运算 (XOR)**，必须对所有字符执行。

因此，如果我有字符串“Bob,001”，如何计算密件抄送？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T07:09:07.873

最有可能是基于字符的 XOR。您需要获取它们的样本以进行验证，但大多数校验和通常最终为 0。

因此，对于 XOR 校验和，您将拥有以下数据包：

```
Bob,001X 
```

其中 X 是校验和，当你对所有这些字符进行异或运算时，你很可能得到 0。

因此，要计算出 X，您只需对“Bob,001”中的所有字符进行异或运算。这是因为对于任何 N，N xor N 始终为 0。

现在，如果您只允许拥有字母数字，那么 X 可能是两个十六进制字符。这就是为什么您需要样本数据（以便我们可以计算出来）或适当的规格（应由设备制造商提供）。

您指的实际设备是什么*？*网络上可能有显示如何操作的信息。

**基于更新：**

> 这是一款 Amadeus Hospitality PMS 设备。不，他们只是说它必须在所有字符上执行。不包括 STX 和 ETX。

您需要获取一些示例数据来确认，但它可能是一个数据流，例如：

```
 Running
Data     ChkSum
======  =======
STX 02
B   42     42
o   6f     2d
b   62     4f
,   2c     63
0   30     53
0   30     63
1   31     52
4   52     00
ETX 03 
```

校验和的位置可能会有所不同，实际上，它的计算也可能会有所不同，尽管这种可能性要小得多。如果没有样本数据或供应商提供的更多信息，我认为无法完成更多工作。在互联网上粗略搜索了一下，没有发现任何技术细节。

# c# - 我可以为图层使用什么图形格式？

> ID：891665
> 
> 赞同：0
> 
> 时间：2009-05-21T06:50:40.917
> 
> 标签：c#, image, pdf, layer, psd

我需要能够拍摄多张图像并将它们保存到一个文件中，然后该文件可以由 Photoshop 或 Illustrator 等图形程序读取并进行编辑。我需要能够在 C#/.Net 环境中执行此操作。看起来 PDF 具有图层功能，但我不确定 PDFSharp 等免费组件是否支持图层。能够直接写入 Photoshop 文件 (PSD) 会很好，但我还没有找到任何可以做到这一点的东西。还有其他建议吗？谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-21T07:36:39.050

这里有一个关于[阅读 PSD](https://stackoverflow.com/questions/414852/reading-psd-file-format)的问题，答案是使用[Paint.NET 开源 PSD 插件](http://frankblumenberg.de/doku/doku.php?id=paintnet:psdplugin#download)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T08:18:08.327

[ImageMagick](http://www.imagemagick.org/)应该对您的目标有用。

PSD 是 Photoshop 的格式，支持图层 XCF 也支持图层，适用于 GIMP

我知道 Fireworks 使用带有图层的 PNG，但我知道很多其他编辑器不支持它。

# asp.net - 显示来自不同数据库的两个字段

> ID：891677
> 
> 赞同：0
> 
> 时间：2009-05-21T06:57:36.710
> 
> 标签：asp.net

我正在创建一个需要用户管理的简单休假管理应用程序。

为此，我使用了 ASP.NET 配置工具并创建了角色、用户和权限。`ASPNETDB.mdf`下生成了一个数据库`App_Code`。接下来，我创建了几个 .aspx 页面，例如`login.aspx`、`register.aspx`、`changepassword.aspx`、`displayinfo.aspx`等。我在每个页面中放置了所需的登录控件。在`displayinfo.aspx`（在用户 login.aspx 之后）中，我放置了一个`LoginName`控件，该控件显示一条消息，例如“欢迎登录名控件（用户名）”。接下来，我创建了另一个名为“LMS”的数据库，用于维护员工休假信息，其中包含员工、部门、LeaveType、LeavePolicy 等表。

现在我的问题是当用户进行身份验证时，如何显示`EmployeeID`表`Employee`中的`display.aspx`以及与数据库`UserName`无关的`ASPNETDB.mdf`？

我想这可以通过 a 的数据关系概念来实现`DataSet`，但我不知道该怎么做。谁能为我提供带有正确代码的明确指南？我不确定何时使用 ASP.NET 配置工具以及在这种情况下它是否是正确的选择。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-23T12:30:47.350

如果两个数据库都在同一个实例上，您可以执行以下操作：

选择 database1.table1.column1 ， database2.table2.column2

如果不是，您应该有一些 DAL 并使用 DAL 的约定为其编写代码

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-23T12:49:26.847

> 现在我的问题是当用户登录时如何在 display.aspx 中显示 Employee 表的 EmployeeID 以及与“ASPNETDB.mdf”数据库无关的用户名。

您不必创建单独的 aspnetdb.mdf ，您只需对自己的数据库运行 asp_regsql 命令，然后将创建所有表/视图/存储过程供您使用内置 aspnet安全/会员功能。然后您可以轻松地在不同的表（您自己的表和 aspnet 表）之间创建外键关系。

HTH。

# linux - 什么是我在 Linux 上的 Delphi 应用程序的最佳解决方案 - Delphi+Wine 或 Lazarus？

> ID：891678
> 
> 赞同：10
> 
> 时间：2009-05-21T06:59:03.557
> 
> 标签：linux, delphi, lazarus, wine

我需要在 Linux 上提供我的 Delphi 解决方案，并且我已经在 Wine 和 Lazarus 上对它们进行了测试。从长远来看，我应该考虑哪些技术因素（编程、部署、维护等），以避免陷入维护噩梦。我保持我的 Windows 组件使用非常标准，以避免可能在跨平台上开发的复杂性。我正在寻找一些超越主观的确凿事实。我不想考虑 .Net/Mono，因为这会让我立即退缩（上市延迟巨大），这是我无法承受的。

我能想到一些：

1.  Lazaraus 可能需要一些（更改）编程来使代码工作。
2.  葡萄酒是一个更难以维持大量客户群的环境。

您对此的贡献将不胜感激。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-21T07:49:20.693

我想说那里没有黄金法则。这实际上取决于 Lazarus 支持多少您使用的组件。

我会开始用 lazarus 进行测试，并保留 Wine 作为备份，以防你绝望。

Codegear 的计划仍然非常模糊（他们只是在“查看”，但同时他们在两个完整版本上涂抹了 64 位的推出，所以即使取得了进展，这也可能需要相当长的时间）

快速的时间线让我觉得 Apple 版本会使用 QT，而不是原生 api。

**更新：**将近 4 年，仍然没有 Linux 支持。树长得更快。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-05-21T12:44:51.143

我必须不同意这里的其他人，并建议你使用 Wine。谷歌正在运送带有 Wine 安装的 Picassa，你也可以做同样的事情。他们不是依赖发行版安装的版本，而是在程序目录中有一个预先配置的副本，并且有一个可以测试的已知版本。

基本上你只需要问一下原生端口会提供什么葡萄酒包装器不会。对于大多数 Delphi 应用程序，答案可能是主题化，其他的很少。我们制作了一个本地端口，因此我们可以在较低级别访问文件系统，但在此之前，我们的产品在 Wine 上运行了多年几乎完美。

从经验来看，本地港口并不是在公园里散步：

*   Lazarus 可能不支持任何第三方组件。
*   除非您也将 Windows 版本切换到 Lazarus，否则您将需要维护并行的 .lfm 文件，如果您确实切换，您将失去 Delphi IDE。与 Lazarus 一样好，它在抛光和功能方面远远落后于最新的 Delphis。
*   如果您有一个完全独立的程序和不同的小部件集，则测试将需要更多的努力。在 Wine 上进行测试将更接近于在新的 Windows 版本上测试您现有的版本。
*   在 FPC 具有等效功能之前，您将无法使用 Delphi 编译器引入的任何新功能（泛型、匿名方法）。
*   大多数 64 位 Linux 安装不包括 32 位版本的 Gtk/Qt，安装它们可能很复杂且容易出错，因此您还需要编译 64 位版本的应用程序。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-21T07:17:56.387

我通常会推荐使用 Lazarus。如果您依赖 WINE，您也会受到 WINE 错误的摆布，这可能会影响您的产品质量。在 Windows 环境中使用 Lazarus + FPC 甚至可能很有用。

另一种方法是使用虚拟化，但这取决于您正在编写的应用程序的类型。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-21T07:41:55.887

查看 Codegear 的计划——在 DelphiLive 2009 上搜索一些路线图提示——在 Linux 和 Mac 上提供本机 Delphi，我现在会选择 Lazarus。您可以将自己从 Wine 管理中解放出来，以后可以将您的应用程序移植到本机。（正如有人所说：德尔福将像一个有企鹅、老虎、豹子和雪豹的大动物园。）

当然，移植将涉及退出一些工作。但是，如果您仔细查看 unicode 之类的问题并防止出现最常见的错误，那应该是相当容易的。

在[delphifeeds](http://delphifeeds.com)上搜索unicode 和路线图以获取更多提示。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-22T02:55:19.273

我认为 Wine 或 Lazarus 都可能适合您。我已经用 wine 测试了我们的一些相当大的 Delphi 应用程序（许多 3rd 方控件），它们运行得很好。有一些恼人的字体问题。真正失败的两件事主要是我使用 TWebBrowser 的地方（看起来它几乎可以工作，我认为它使用的是壁虎渲染引擎而不是 IE）。另一个是多层（Datasnap）服务器，它运行但我不知道如何连接。

我认为坚持 Mac/Linux 对 Delphi 的支持是错误的，他们可以为 OS/X 编译控制台“hello world”应用程序这一事实令人印象深刻——但我认为移植 VCL 是另一回事（除非你'我写了一个控制台应用程序）。

如果你已经有一个可以工作的应用程序，那么试试 wine - 测试不会有坏处。

要考虑的另一件事是您的用户是谁（以及有多少）？如果他们是 Linux 极客，那么配置和调整 wine 将毫无问题（尽管他们可能会发现使用本机 Windows 应用程序令人反感）。如果是一群祖母，那就另当别论了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-05T12:32:36.687

Free Pascal Compiler/Lazarus 不接近最新的 Delphi 功能，但它相当稳定，即使仍有 bug 需要查找。

此外，生成的可执行文件似乎更大，但肯定比使用 VM 或使用 Wine 本身部署要小。

但它做了 Delphi/Kylix 曾经尝试过的事情。[交叉构建](http://wiki.lazarus.freepascal.org/Cross_compiling)！通过使用它，您可以从一个平台编译到另一个平台。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-09-03T14:35:36.460

实际上，我们将 Wine 用于我们的 ShareTeam 产品......我们在 Lazarus 上有一个测试版本，这是一个很好的工具，有很多优势，但目前还不是很完整。如果工作不简单，我认为目前最好使用 wine，将 Delphi 应用程序转换为 Lazarus/FreePascal 并不简单。我个人希望 Embarcadero 做一个跨平台的 Delphi 版本，而不是像 Prism 那样与 Delphi 有很大的不同。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-09-03T01:51:12.723

首先，您应该尝试确保您的 GUI 代码和非 GUI 后端代码被干净地分离到 GUI 应用程序和库中（如果它们还没有的话）。这使得测试更容易，也更容易实现命令行界面、Web 界面等。这些库（带有对象和过程的单元文件）在大多数情况下应该可以在 FreePascal 上轻松编译，但是您应该检查和调试非 GUI 代码第一的。

一旦解决了这个问题，就该看看你的 GUI 了。如果您使用大量封闭源代码的第 3 方商业组件，那么您可能无法轻松转换 GUI。如果您主要使用库存组件和/或已移植到 Lazarus 的组件，那么您确实可以转换 GUI 并按原样使用它。

请注意，由于 Mac OS 和 Linux 程序通常*看起来*不同，您可能需要考虑这一点，具体取决于您的应用程序。可能的方法包括： 1\. 即使在 Windows 上也使用 Lazarus，并为所有平台使用相同的 GUI 代码。2\. 仅在 OS X 和 Linux 上使用 Lazarus，并自定义 GUI 在转换后看起来有点原生。3\. 为 OS X 编写本机 GUI（使用 Cocoa 和 XCode），然后链接到您的 Pascal 代码以进行非 GUI 处理。这种事情在 Linux 上不太必要，但是您可以选择用于 LCL (VCL) 后端的工具包。

每种方法都有强烈的支持者，但哪种方法正确取决于您的“情况”和您的目标。

如果您的主要兴趣是 OS X，请考虑加入 MacPascal 列表。

Wine 是一个巨大的矫枉过正，除非你需要在明天几乎不做任何修改的情况下推出一个 Linux/OS X 应用程序。（在这种情况下，为什么不直接使用 VMWare？）

# html - 如何使用 CSS 将内联文本替换为图像

> ID：891681
> 
> 赞同：0
> 
> 时间：2009-05-21T06:59:45.707
> 
> 标签：html, css, image, image-replacement

我想使用 CSS 将以下 HTML 中的文本（ *“Word 1 Word2 Word3 Word4” ）替换为图像。*我希望图像也像文本一样水平显示。

```
<div id="aSentence">
    <p>
        <span id="word1">Word1&nbsp </span>
        <span id="word2">Word2&nbsp </span>
        <span id="word3">Word3&nbsp </span>
        <span id="word4">Word4&nbsp </span>
    </p>                    
</div> 
```

我已经通读并尝试了[mezzoblue](http://www.mezzoblue.com/tests/revised-image-replacement/)和其他一些网站的一些技术，但我得出的结论是，这些技术似乎要求文本的跨度被一种或另一种元素类型包围，这将使单词不要水平排列。

关于如何实现这一目标的任何想法？我想（如果可能的话）使屏幕阅读器等可以“访问”该解决方案。

非常感谢，
普伦博。

PS：我尝试实现一些技术 - 它们都不能正常工作：TextReplacement.html

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
        <title>Text Replacement by Image using CSS</title>
        <style type="text/css" title="currentStyle" media="screen">
            @import "TextReplacement.css";
        </style>
    </head>

    <body id="bodyId">
        <div id="centerContainer">
            <h1><span>Comparison of Various Techniques</span></h1>
            <p class="noteText">(NOTE: only text "Word1" is being replaced by image)</p>
            <div id="mainBodyContainer">
                <div class="techniqueContainer">
                    <h2>Technique 1: FIR</h2>
                    <ul id="t1List">
                        <li id="t1w1"><span>Word1.&nbsp;</span></li>
                        <li id="t1w2"><span>Word2.&nbsp; </span></li>
                        <li id="t1w3"><span>Word3.&nbsp; </span></li>
                        <li id="t1w4"><span>Word4.&nbsp; </span></li>
                    </ul>                    
                    <p class="techniqueComment">Word 1 and corresponding image disappear completely.</p>
                </div>

                <div class="techniqueContainer">
                    <h2>Technique 2: Radu</h2>
                    <ul id="t2List">
                        <li id="t2w1"><span>Word1.&nbsp;</span></li>
                        <li id="t2w2"><span>Word2.&nbsp; </span></li>
                        <li id="t2w3"><span>Word3.&nbsp; </span></li>
                        <li id="t2w4"><span>Word4.&nbsp; </span></li>
                    </ul>                    
                    <p class="techniqueComment">All disapppear completely.</p>
                </div>                

                <div class="techniqueContainer">
                    <h2>Technique 3: Rundle</h2>
                    <ul id="t3List">
                        <li id="t3w1"><span>Word1.&nbsp;</span></li>
                        <li id="t3w2"><span>Word2.&nbsp; </span></li>
                        <li id="t3w3"><span>Word3.&nbsp; </span></li>
                        <li id="t3w4"><span>Word4.&nbsp; </span></li>
                    </ul>                    
                    <p class="techniqueComment">No effect - image and text visible.</p>
                </div>    

                <div class="techniqueContainer">
                    <h2>Technique 4: Leahy/Langridge</h2>
                    <ul id="t4List">
                        <li id="t4w1"><span>Word1.&nbsp;</span></li>
                        <li id="t4w2"><span>Word2.&nbsp; </span></li>
                        <li id="t4w3"><span>Word3.&nbsp; </span></li>
                        <li id="t4w4"><span>Word4.&nbsp; </span></li>
                    </ul>                    
                    <p class="techniqueComment">Image appears above Word1.</p>
                </div>    

                <div class="techniqueContainer">
                    <h2>Technique 5: Dwyer</h2>
                    <ul id="t5List">
                        <li id="t5w1"><span>Word1.&nbsp;</span></li>
                        <li id="t5w2"><span>Word2.&nbsp; </span></li>
                        <li id="t5w3"><span>Word3.&nbsp; </span></li>
                        <li id="t5w4"><span>Word4.&nbsp; </span></li>
                    </ul>                    
                    <p class="techniqueComment">Word 1 and corresponding image disappear completely.  Same as Technique 1.</p>
                </div>                        
                <div class="techniqueContainer">
                    <h2>Technique 6: Jason</h2>
                    <div id="t6List" class="borderContainer">
                        <span id="t6w1">Word1.&nbsp; </span>
                        <span id="t6w2">Word2.&nbsp; </span>
                        <span id="t6w3">Word3.&nbsp; </span>
                        <span id="t6w4">Word4.&nbsp; </span>
                    </div>                    
                    <p class="techniqueComment">Same as Technique 3 - Rundle.</p>
                </div>     
            </div>
        </div>
    </body>
</html> 
```

和 CSS 文件：TextReplacement.css

```
* {
    margin: 0;
    padding: 0;
}

body {
    margin: 0;
    padding: 0; 
    font-family: verdana, "trebuchet MS", helvetica, sans-serif; 
}

#centerContainer {
    margin-left: auto;     /* centres container */
    margin-right: auto; /* centres container */ 
    margin-top: 18px;
}

#mainBodyContainer {
    width: 900px;
    margin-left: auto; 
    margin-right: auto; 
    margin-bottom: 20px;
    font-size: 1.8em;
    font-weight: bold;    
}

#mainBodyContainer h2{
    font-size: 1.2em;
    font-weight: bold;    
    font-style: italic;    
    color: green;
}

div.techniqueContainer{
    text-align: center;
    margin-bottom: 30px;    
}

p.techniqueComment{
    font-size: 0.5em;
    font-weight: normal;    
    font-style: italic;    
    color: red;
}

p.noteText{
    font-size: 1em;
    font-weight: normal;    
    font-style: italic;    
    color: blue;
}

#mainBodyContainer ul{
    list-style: none;
    border: 1px solid #820000;
}

#mainBodyContainer ul li{
    display: inline;
}

/* TECHNIQUE 1: FIR */
li#t1w1 {
    width: 250px;
    height: 61px;
    background-image: url(http://stackoverflow.com/content/img/so/logo.png);
}

li#t1w1 span {
    display: none;
}

/* TECHNIQUE 2: Radu */
li#t2w1 {
    width: 2250px;
    height: 61px;
    background: url(http://stackoverflow.com/content/img/so/logo.png) top right;
    margin: 0 0 0 -2000px;
}

/* TECHNIQUE 3: Rundle */
li#t3w1 {
    width: 250px;
    height: 61px;
    background: url(http://stackoverflow.com/content/img/so/logo.png);
    text-indent: -9999px;
}

/*TECHNIQUE 4: Leahy/Langridge. */
li#t4w1 {
    width: 250px;
    padding: 61px 0 0 0;
    height: 0;
    background: url(http://stackoverflow.com/content/img/so/logo.png) no-repeat;
    overflow: hidden;
}

/*TECHNIQUE 5: Dwyer. */
#t5{

}

#t5List{
    list-style: none;
    border: 1px solid #820000;
}

#t5List li{
    display: inline;
}

li#t5w1 {
width: 250px;
    height: 61px;
    background-image: url(http://stackoverflow.com/content/img/so/logo.png);
}

li#t5w1 span{
    display: block;
    width: 0;
    height: 0;
    overflow: hidden;
}

/* TECHNIQUE 6: Jason */
li#t6w1 {

}

#t6w1{
    text-indent: -5000px; 
    background: url(http://stackoverflow.com/content/img/so/logo.png) no-repeat 0 0; 
    overflow: hidden;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T08:59:09.647

这简单：

```
span {text-indent: -5000px; background: url(../images/yourimage.jpg) no-repeat 0 0; overflow: hidden;} 
```

试试看。你会看到它有效。

无论你做什么，都不要使用 JAVASCRIPT 来实现这个效果。在 CSS 中太容易完成

您可能还想选择无序列表：

```
<ul>
  <li>word</li>
  ...
</ul> 
```

* * *

```
ul {list-style-type: none; margin: 0; padding: 0;}
li {list-style-type: none; float: left;} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-22T00:36:47.837

您的意思是保持 HTML 原样，但显示图像而不是文本？如果是这样，可以这样做：

```
#word1 {
   display:block;
   width:100px; /* width of image */
   height:80px; /* height of image */
   background:url(image.jpg) top left no-repeat; /* sets image as background of span */
   text-indent:-999999px; /* this hides the text so the image is not obstructed */
} 
```

现在文本仍然存在并且它对 SEO 友好，但它可以通过精美的图像看起来令人印象深刻。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-22T14:46:58.763

嗨，我在一年前就这个问题准备了一个[测试页](http://yaanno.googlepages.com/imagereplace.html)cca，但我链接这个只是为了感兴趣，因为它会导致标签汤加上可能面临“图像关闭”问题。它的纯 CSS。

更新：它是为重复图像而设计的，所以这不是一种单一的图像替换技术。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T07:11:33.047

你最初的想法是什么？你想达到什么目标？如果您想向访问者显示图像，只需`IMG`为此使用适当的标签并将文字附加到`ALT`属性上。

否则，如果这些图像真的不是内容图像而是表示层的一部分，那么恐怕你选择了错误的标记。`SPAN`s 没有语义。你宁愿选择一个你可以随意设计的无序列表。

**编辑**

好的，根据您的回复，您确实希望在表示层中有一个解决方案。您可以为阴影效果选择标准 CSS2 属性[`text-shadow`](http://www.quirksmode.org/css/textshadow.html)。它适用于 Safari、Opera 和 Konqueror，对于其余浏览器，您可以使用[一些 JavaScript](http://krijnhoetmer.nl/stuff/javascript/text-shadow/)。

（`SPAN`是一个简单的容器元素，您可以在其上应用样式。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-21T08:55:29.357

没有语义含义：跨度对内容没有任何意义（就像 div 一样），因此它们可能是用于您想要做的事情的正确元素。

使跨度显示为一个块并浮动它：

```
span {
  display: block;
  float: left;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-21T09:00:11.423

我使用的一种效果很好的技术是基本上将文本推出可显示区域。不确定它是否有名字，它总是需要剪裁，但本质上是：

```
height: {someHeight};
line-height: {someHeight x 3};
overflow: hidden;
letter-spacing: -1.1em; /* roughly */ 
```

第一行为元素留下一个高度，第二行将文本推到该高度之外（取决于字体大小，x3 只是一个很好的起点），第三行将其隐藏起来，最后一个核化了文本的宽度。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-11-20T16:59:55.703

我个人更喜欢 Rundle 文本缩进技术，因为它简单优雅，没有额外的标记。如果您**将显示更改为 inline-block**它将为您工作。对于不支持 inline-block 的浏览器，请使用以下技术之一：http: [//blog.mozilla.com/webdev/2009/02/20/cross-browser-inline-block/](http://blog.mozilla.com/webdev/2009/02/20/cross-browser-inline-block/)（也请查看评论，那里有一些更简单的建议）。我同意@Jason 的观点，为此设计一个复杂的解决方案只是为了覆盖启用 css 和禁用图像的人可能是矫枉过正。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-05-21T08:58:06.437

使用 jQuery 将相关元素的文本替换为图像。图像是内联的，因此它们会顺其自然。

# linq - 以编程方式将 SQL 查询转换回 Linq 表达式

> ID：891682
> 
> 赞同：2
> 
> 时间：2009-05-21T07:00:36.547
> 
> 标签：linq, linq-to-sql, expression-trees

是否有可能以某种方式以编程方式将 sql 查询转换为 linq 表达式树？sql 查询应该是由这个 linq 查询生成的，所以我认为它是一个穷人将 linq 查询序列化\反序列化为 t-sql 格式。

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T07:59:08.910

一切皆有可能，只需要一卡车的工作量。问题是您首先必须解析 SQL 查询，并解释 AST 以将其转换为 linq 表达式树。这不是微不足道的，因为 Linq 与 sql 不是 1:1 兼容：例如，在 linq 中，groupby 上的聚合是 groupby 外部的，而在 SQL 中它们是内部的：它们必须在相同的范围内作为 groupby 否则他们将无法工作。将 linq 查询转换为 SQL 查询需要这种信息，反之亦然。

所以为了存储查询，我选择了不同的路线，例如规范模式

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T07:08:32.787

我不相信 LINQ-to-SQL 中内置了任何东西。

理论上我敢说这是可能的（尽管它不能保证往返，因为有不同的方式来表达相同的查询） - 但很难做好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T07:25:24.533

什么可以帮助你 - LINQPad。我想，它不能将 SQL 转换为 LINQ 查询，但它可以将 LINQ 转换为 SQL。

一种选择是从 SQL 生成的 IL 代码中进行跟踪。例如：

```
SELECT TOP (50) [t0].[Id], [t0].[tralala]
FROM [pamparam] AS [t0] 
```

生成：

```
IL_0001:  ldarg.0     
IL_0002:  call        LINQPad.User.TypedDataContext.get_pamparam
IL_0007:  ldc.i4.s    32 
IL_0009:  call        System.Linq.Queryable.Take
IL_000E:  call        LINQPad.Extensions.Dump 
```

这样很明显，LINQ 查询看起来像：

```
pamparam.Take (50) 
```

# c# - 使用 dataSet.GetXml() 耗尽内存

> ID：891686
> 
> 赞同：3
> 
> 时间：2009-05-21T07:02:08.790
> 
> 标签：c#, xml, xpath

如果 dataSet 太大并且内存足够，我会收到错误“System.OutOfMemoryException”。文件“file1.xml”的大小约为 36 MB。

解决这个问题的方法是什么？提前致谢。

```
private XPathDocument GetXML(DataSet ds)
    {
        ds.WriteXml("file1.xml");
        ds.WriteXmlSchema("file1.xsd");

        XPathDocument doc = new XPathDocument(new StringReader(ds.GetXml()));

        return doc;
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T09:16:24.637

您可以尝试这种方法，它可能不那么敏感。

```
private XPathDocument GetXML(DataSet ds)
{
    ds.WriteXml("file1.xml");
    ds.WriteXmlSchema("file1.xsd");
    XmlDocument doc = new XmlDocument();
    doc.Load("file1.xml");

    return new XPathDocument(new XmlNodeReader(doc));
} 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-05-25T01:09:23.913

尝试使用 dataset.ReadXml("MyFilename");

这对我有用。我能够在具有 4GB RAM 的机器上读取 250 MB 的文件。

编辑：尝试在具有更多 RAM 的机器上。

高温高压

# python - 我可以更改 BeautifulSoup 将 XML 标记转换为小写的行为吗？

> ID：891690
> 
> 赞同：8
> 
> 时间：2009-05-21T07:03:24.187
> 
> 标签：python, xml, beautifulsoup

我正在编写代码来解析用 XML 编写的配置文件，其中 XML 标记是大小写混合的，并且大小写很重要。Beautiful Soup 似乎默认将 XML 标记转换为小写，我想更改此行为。

我不是第一个就这个主题提出问题的人[见[这里](https://stackoverflow.com/questions/567999/preventing-beautifulsoup-from-converting-my-xml-tags-to-lowercase)]。但是，我不明白该问题的答案，并且在 BeautifulSoup-3.1.0.1 BeautifulSoup.py 似乎不包含任何“ `encodedName`”或“ `Tag.__str__`”实例

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-22T05:09:46.813

```
import html5lib
from html5lib import treebuilders

f = open("mydocument.html")
parser = html5lib.XMLParser(tree=treebuilders.getTreeBuilder("beautifulsoup"))
document = parser.parse(f) 
```

'document' 现在是一个类似于 BeautifulSoup 的树，但保留了标签的大小写。有关文档和安装，请参见[html5lib](http://code.google.com/p/html5lib/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-24T23:30:54.847

根据 Beautiful Soup 的创建者|维护者 Leonard Richardson 的说法，你[不能](http://groups.google.com/group/beautifulsoup/browse_thread/thread/ff6910752566df78)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2020-03-17T09:57:33.657

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-03T15:35:17.803

[使用lxml](http://codespeak.net/lxml/)会好得多。它比 BeautifulSoup 快得多。如果您不想学习 lxml API，它也有适用于 BeautifulSoup 的兼容性 API。

[Ian Blicking 同意](http://blog.ianbicking.org/2008/12/10/lxml-an-underappreciated-web-scraping-library/)。

没有理由再使用 BeautifulSoup，除非您使用的是 Google App Engine 或其他任何不纯 Python 的东西。

它也更适合 XML。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T23:08:10.823

只需使用propper xml解析器而不是用于处理损坏文件的lib

我建议只看一下 xml.etree 或 lxml

# windows - 使用 ietd 从 iSCSI 目标引导的 Windows 故障转移

> ID：891692
> 
> 赞同：0
> 
> 时间：2009-05-21T07:04:31.377
> 
> 标签：windows, linux, failover, iscsi

Windows 端点通过 iSCSI 蓝屏启动，并在故障转移目标源出现后立即重新启动。到那时，Windows 似乎被“冻结”了。蓝屏代码有时是 0x00000f4，有时是 0x000007a。现在，在故障转移时，辅助节点保持相同的 iqn，并且 Windows 磁盘的源独立于 iSCSI 目标。现在，当网络因启动的 endoint 断开连接时，会发生相同的“冻结”，并且在重新插入网络时系统会恢复。但是当目标故障转移时，它不会恢复，而是蓝屏并重新启动。在 Ubuntu 8.10 上使用 ietd/iscsi-target 公开目标

任何想法为什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-04T15:38:22.947

windows主机硬件最有可能出现问题

# jquery - jQuery：限制文本框仅输入“数字”的最佳方法是什么？（允许小数点）

> ID：891696
> 
> 赞同：235
> 
> 时间：2009-05-21T07:04:48.677
> 
> 标签：jquery, validation, isnumeric

限制文本框仅输入“数字”的最佳方法是什么？

我正在寻找允许小数点的东西。

我看到很多例子。但尚未决定使用哪一个。

**来自 Praveen Jeganathan 的更新**

没有更多的插件，jQuery 在 v1.7 中实现了自己的`jQuery.isNumeric()`添加。请参阅：[https ://stackoverflow.com/a/20186188/66767](https://stackoverflow.com/a/20186188/66767)

* * *

## 回答 #1

> 赞同：291
> 
> 时间：2009-05-21T07:53:10.013

如果您想限制输入（而不是验证），您可以使用关键事件。像这样的东西：

```
<input type="text" class="numbersOnly" value="" /> 
```

和：

```
jQuery('.numbersOnly').keyup(function () { 
    this.value = this.value.replace(/[^0-9\.]/g,'');
}); 
```

这会立即让用户知道他们不能输入字母字符等，而不是稍后在验证阶段。

您仍然需要验证，因为输入可能通过使用鼠标剪切和粘贴来填充，或者可能通过可能不会触发关键事件的表单自动完成器来填充。

* * *

## 回答 #2

> 赞同：199
> 
> 时间：2009-05-21T07:20:01.110

# 更新

有一个新的非常简单的解决方案：

> 它允许您对文本使用**任何**类型的输入过滤器`<input>`，包括各种数字过滤器。这将正确处理复制+粘贴、拖放、键盘快捷键、上下文菜单操作、不可键入的键和所有键盘布局。

请参阅[此答案](https://stackoverflow.com/a/995193/1070129)或[在 JSFiddle 上自行](https://jsfiddle.net/emkey08/tvx5e7q3)尝试。

# jquery.numeric 插件

我已经使用[jquery.numeric](https://github.com/SamWM/jQuery-Plugins/blob/master/numeric/jquery.numeric.js)插件成功实现了许多表单。

```
$(document).ready(function(){
    $(".numeric").numeric();
}); 
```

此外，这也适用于 textareas！

但是，请注意 Ctrl+A、Copy+Paste（通过上下文菜单）和 Drag+Drop**不会**按预期工作。

# HTML 5

随着对 HTML 5 标准的更广泛支持，我们可以使用元素的`pattern`属性和`number`类型`input`来限制仅输入数字。在某些浏览器（尤其是 Google Chrome）中，它也可以限制粘贴非数字内容。有关更多信息`number`和其他较新的输入类型，请参见[此处](http://html5doctor.com/html5-forms-input-types/)。

* * *

## 回答 #3

> 赞同：102
> 
> 时间：2012-08-09T18:53:41.913

我认为最好的答案是上面的答案。

```
jQuery('.numbersOnly').keyup(function () {  
    this.value = this.value.replace(/[^0-9\.]/g,''); 
}); 
```

但我同意箭头键和删除按钮将光标捕捉到字符串的末尾有点痛苦（因此在测试中它被踢回了我）

我添加了一个简单的更改

```
$('.numbersOnly').keyup(function () {
    if (this.value != this.value.replace(/[^0-9\.]/g, '')) {
       this.value = this.value.replace(/[^0-9\.]/g, '');
    }
}); 
```

这样，如果有任何按钮不会导致文本被更改，请忽略它。有了这个，你可以点击箭头并删除而不跳到最后，但它会清除任何非数字文本。

* * *

## 回答 #4

> 赞同：54
> 
> 时间：2010-02-09T21:59:28.990

jquery.numeric 插件有一些我通知作者的错误。它允许在 Safari 和 Opera 中使用多个小数点，并且您不能在 Opera 中键入退格键、箭头键或其他几个控制字符。我需要正整数输入，所以最后我只写了自己的。

```
$(".numeric").keypress(function(event) {
  // Backspace, tab, enter, end, home, left, right
  // We don't support the del key in Opera because del == . == 46.
  var controlKeys = [8, 9, 13, 35, 36, 37, 39];
  // IE doesn't support indexOf
  var isControlKey = controlKeys.join(",").match(new RegExp(event.which));
  // Some browsers just don't raise events for control keys. Easy.
  // e.g. Safari backspace.
  if (!event.which || // Control keys in most browsers. e.g. Firefox tab is 0
      (49 <= event.which && event.which <= 57) || // Always 1 through 9
      (48 == event.which && $(this).attr("value")) || // No 0 first digit
      isControlKey) { // Opera assigns values for control keys.
    return;
  } else {
    event.preventDefault();
  }
}); 
```

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2013-11-25T06:38:08.177

没有更多的插件，**jQuery**已经实现了自己在 v1.7 中添加的[**jQuery.isNumeric()**](http://api.jquery.com/jQuery.isNumeric/)。

> **`jQuery.isNumeric( value )`**
> 
> 确定其参数是否为数字。

# 样品结果

```
$.isNumeric( "-10" );     // true
$.isNumeric( 16 );        // true
$.isNumeric( 0xFF );      // true
$.isNumeric( "0xFF" );    // true
$.isNumeric( "8e5" );     // true (exponential notation string)
$.isNumeric( 3.1415 );    // true
$.isNumeric( +10 );       // true
$.isNumeric( 0144 );      // true (octal integer literal)
$.isNumeric( "" );        // false
$.isNumeric({});          // false (empty object)
$.isNumeric( NaN );       // false
$.isNumeric( null );      // false
$.isNumeric( true );      // false
$.isNumeric( Infinity );  // false
$.isNumeric( undefined ); // false 
```

这是一个如何将 isNumeric() 与事件侦听器绑定的示例

```
$(document).on('keyup', '.numeric-only', function(event) {
   var v = this.value;
   if($.isNumeric(v) === false) {
        //chop off the last char entered
        this.value = this.value.slice(0,-1);
   }
}); 
```

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2013-09-10T12:20:34.013

上面提到的 numeric() 插件在 Opera 中不起作用（您不能退格、删除甚至使用后退或前进键）。

JQuery 或 Javascript 中的以下代码都可以完美运行（而且只有两行）。

查询：

```
$(document).ready(function() {
    $('.key-numeric').keypress(function(e) {
            var verified = (e.which == 8 || e.which == undefined || e.which == 0) ? null : String.fromCharCode(e.which).match(/[^0-9]/);
            if (verified) {e.preventDefault();}
    });
}); 
```

Javascript：

```
function isNumeric(e)
{
    var keynum = (!window.event) ? e.which : e.keyCode;
    return !((keynum == 8 || keynum == undefined || e.which == 0) ? null : String.fromCharCode(keynum).match(/[^0-9]/));
} 
```

当然，这仅适用于纯数字输入（加上退格、删除、前进/后退键），但可以轻松更改为包括点和减号字符。

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2009-05-21T07:14:38.827

您可以使用[Validation 插件](http://docs.jquery.com/Plugins/Validation/Methods)及其[number()](http://docs.jquery.com/Plugins/Validation/Methods/number)方法。

```
$("#myform").validate({
  rules: {
    field: {
      required: true,
      number: true
    }
  }
}); 
```

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2015-05-17T12:39:53.523

> 无需输入限制的长代码，只需尝试此代码即可。
> 
> 它还接受有效的 int 和 float 两个值。

## Javascript 方法

```
onload =function(){ 
  var ele = document.querySelectorAll('.number-only')[0];
  ele.onkeypress = function(e) {
     if(isNaN(this.value+""+String.fromCharCode(e.charCode)))
        return false;
  }
  ele.onpaste = function(e){
     e.preventDefault();
  }
}
```

```
<p> Input box that accepts only valid int and float values.</p>
<input class="number-only" type=text />
```

## jQuery 方法

```
$(function(){

  $('.number-only').keypress(function(e) {
	if(isNaN(this.value+""+String.fromCharCode(e.charCode))) return false;
  })
  .on("cut copy paste",function(e){
	e.preventDefault();
  });

});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<p> Input box that accepts only valid int and float values.</p>
<input class="number-only" type=text />
```

**更新**

以上答案适用于最常见的用例 - 将输入验证为数字。

> 但下面是特殊用例的代码片段

*   允许负数
*   在删除之前显示无效的击键。

```
$(function(){

  $('.number-only').keyup(function(e) {
        if(this.value!='-')
          while(isNaN(this.value))
            this.value = this.value.split('').reverse().join('').replace(/[\D]/i,'')
                                   .split('').reverse().join('');
    })
    .on("cut copy paste",function(e){
    	e.preventDefault();
    });

});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<p> Input box that accepts only valid int and float values.</p>
<input class="number-only" type=text />
```

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2012-10-26T10:15:15.817

下面是我用来从字面上阻止击键的内容。这只允许数字 0-9 和小数点。易于实现，不需要很多代码，并且像一个魅力一样工作：

```
<script>
function isNumberKey(evt) {
    var charCode = (evt.which) ? evt.which : event.keyCode;
    if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
        return false;
    } else {
        return true;
    }      
}
</script>

<input value="" onkeypress="return isNumberKey(event)"> 
```

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2012-08-01T16:47:12.600

作为[对这个建议](https://stackoverflow.com/a/891728/26510)的轻微改进，您可以使用[Validation 插件](http://docs.jquery.com/Plugins/Validation/Methods)及其[number()](http://docs.jquery.com/Plugins/Validation/Methods/number)、[digits](http://docs.jquery.com/Plugins/Validation/Methods/digits)和[range](http://docs.jquery.com/Plugins/Validation/Methods/range)方法。例如，以下内容可确保您获得 0 到 50 之间的正整数：

```
$("#myform").validate({
  rules: {
    field: {
      required: true,
      number: true,
      digits: true,
      range : [0, 50]
    }
  }
}); 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2013-05-15T22:51:45.733

你看不到字母神奇的外观和按键的消失。这也适用于鼠标粘贴。

```
$('#txtInt').bind('input propertychange', function () {
    $(this).val($(this).val().replace(/[^0-9]/g, ''));
}); 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2014-05-05T08:54:05.560

我首先尝试使用 jQuery 解决这个问题，但我对在 keyup 上删除之前实际上出现在输入字段中的不需要的字符（非数字）感到不满意。

寻找其他解决方案我发现了这个：

# 整数（非负数）

```
<script>
  function numbersOnly(oToCheckField, oKeyEvent) {
    return oKeyEvent.charCode === 0 ||
        /\d/.test(String.fromCharCode(oKeyEvent.charCode));
  }
</script>

<form name="myForm">
<p>Enter numbers only: <input type="text" name="myInput" 
    onkeypress="return numbersOnly(this, event);" 
    onpaste="return false;" /></p>
</form> 
```

来源：[https](https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers.onkeypress#Example) ://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers.onkeypress#Example 现场示例：http: [//jsfiddle.net/u8sZq/](http://jsfiddle.net/u8sZq/)

# 小数点（非负数）

要允许一个小数点，您可以执行以下操作：

```
<script>
  function numbersOnly(oToCheckField, oKeyEvent) {        
    var s = String.fromCharCode(oKeyEvent.charCode);
    var containsDecimalPoint = /\./.test(oToCheckField.value);
    return oKeyEvent.charCode === 0 || /\d/.test(s) || 
        /\./.test(s) && !containsDecimalPoint;
  }
</script> 
```

资料来源：刚刚写了这个。似乎正在工作。现场示例：http: [//jsfiddle.net/tjBsF/](http://jsfiddle.net/tjBsF/)

# 其他自定义

*   要允许输入更多符号，只需将这些符号添加到充当基本字符代码过滤器的正则表达式中。
*   要实现简单的上下文限制，请查看输入字段 (oToCheckField.value) 的当前内容（状态）

您可能有兴趣做的一些事情：

*   只允许一位小数
*   仅当位于字符串的开头时才允许减号。这将允许负数。

# 缺点

*   插入符号位置在函数内部不可用。这大大减少了您可以实现的上下文限制（例如，没有两个相等的连续符号）。不确定访问它的最佳方式是什么。

我知道标题要求 jQuery 解决方案，但希望无论如何有人会发现这很有用。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2011-08-05T12:09:06.167

感谢戴夫·亚伦·史密斯的帖子

我编辑了您的答案以接受数字部分的小数点和数字。这项工作非常适合我。

```
$(".numeric").keypress(function(event) {
  // Backspace, tab, enter, end, home, left, right,decimal(.)in number part, decimal(.) in alphabet
  // We don't support the del key in Opera because del == . == 46.
  var controlKeys = [8, 9, 13, 35, 36, 37, 39,110,190];
  // IE doesn't support indexOf
  var isControlKey = controlKeys.join(",").match(new RegExp(event.which));
  // Some browsers just don't raise events for control keys. Easy.
  // e.g. Safari backspace.
  if (!event.which || // Control keys in most browsers. e.g. Firefox tab is 0
      (49 <= event.which && event.which <= 57) || // Always 1 through 9
      (96 <= event.which && event.which <= 106) || // Always 1 through 9 from number section 
      (48 == event.which && $(this).attr("value")) || // No 0 first digit
      (96 == event.which && $(this).attr("value")) || // No 0 first digit from number section
      isControlKey) { // Opera assigns values for control keys.
    return;
  } else {
    event.preventDefault();
  }
}); 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2014-02-25T01:46:11.503

```
 window.jQuery.fn.ForceNumericOnly =
       function () {

           return this.each(function () {
               $(this).keydown(function (event) {
                   // Allow: backspace, delete, tab, escape, and enter
                   if (event.keyCode == 46 || event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 27 || event.keyCode == 13 ||
                       // Allow: Ctrl+A
                       (event.keyCode == 65 && event.ctrlKey === true) ||
                       // Allow: home, end, left, right
                       (event.keyCode >= 35 && event.keyCode <= 39)) {
                       // let it happen, don't do anything
                       return;
                   } else {
                       // Ensure that it is a number and stop the keypress
                       if (event.shiftKey || (event.keyCode < 48 || event.keyCode > 57) && (event.keyCode < 96 || event.keyCode > 105)) {
                           event.preventDefault();
                       }
                   }
               });
           });
       }; 
```

并将其应用于您想要的所有输入：

```
$('selector').ForceNumericOnly(); 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2012-01-17T20:46:38.987

这个函数做同样的事情，使用了上面的一些想法。

```
$field.keyup(function(){
    var val = $j(this).val();
    if(isNaN(val)){
         val = val.replace(/[^0-9\.]/g,'');
         if(val.split('.').length>2) val =val.replace(/\.+$/,"");
    }
    $j(this).val(val); 
}); 
```

*   显示视觉反馈（不正确的字母在消失之前出现）
*   允许小数
*   捕获多个“。”
*   左/右 del 等没有问题。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2012-06-18T12:28:53.580

/* 这是我的跨浏览器版本， [如何使用 jQuery 在 HTML 输入框中只允许数字 (0-9)？](https://stackoverflow.com/questions/995183/how-to-allow-only-numeric-0-9-in-html-inputbox-using-jquery/995193#995193)
*/

```
$("#inputPrice").keydown(function(e){
    var keyPressed;
    if (!e) var e = window.event;
    if (e.keyCode) keyPressed = e.keyCode;
    else if (e.which) keyPressed = e.which;
    var hasDecimalPoint = (($(this).val().split('.').length-1)>0);
    if ( keyPressed == 46 || keyPressed == 8 ||((keyPressed == 190||keyPressed == 110)&&(!hasDecimalPoint && !e.shiftKey)) || keyPressed == 9 || keyPressed == 27 || keyPressed == 13 ||
             // Allow: Ctrl+A
            (keyPressed == 65 && e.ctrlKey === true) ||
             // Allow: home, end, left, right
            (keyPressed >= 35 && keyPressed <= 39)) {
                 // let it happen, don't do anything
                 return;
        }
        else {
            // Ensure that it is a number and stop the keypress
            if (e.shiftKey || (keyPressed < 48 || keyPressed > 57) && (keyPressed < 96 || keyPressed > 105 )) {
                e.preventDefault();
            }
        }

  }); 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2015-10-06T15:25:26.290

根据 CanIUse 截至 2015 年 10 月，HTML5 支持全球浏览器支持 88%+ 的输入类型数字。

```
<input type="number" step="0.01" min="0" name="askedPrice" id="askedPrice" /> 
```

这不是 JQuery 相关的解决方案，但优点是手机上的 Android 键盘将针对输入数字进行优化。

或者，可以使用带有新参数“pattern”的输入类型文本。HTML5 规范中的更多细节。

我认为它比 jquery 解决方案更好，因为在这个问题中提供的 jquery 解决方案不支持千位​​分隔符。如果你可以使用html5。

JSFiddle： [https ://jsfiddle.net/p1ue8qxj/](https://jsfiddle.net/p1ue8qxj/)

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2009-05-21T07:58:07.663

只需通过 parseFloat() 运行内容。它将返回`NaN`无效输入。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2012-02-07T23:34:06.533

您可以使用[来自 decorplanit.com 的 autoNumeric](http://www.decorplanit.com/plugin/)。它们对数字以及货币、四舍五入等有很好的支持。

我在 IE6 环境中使用过，对 css 进行了一些调整，并且取得了相当大的成功。

例如，`numericInput`可以定义一个 css 类，它可以用来用数字输入掩码装饰您的字段。

*改编自 autoNumeric 网站：*

```
$('input.numericInput').autoNumeric({aSep: '.', aDec: ','}); // very flexible! 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2014-05-23T16:55:10.697

如果您使用的是 HTML5，则无需费力地执行验证。只需使用 -

```
<input type="number" step="any" /> 
```

step 属性允许小数点有效。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2014-12-18T05:26:58.497

我认为这是解决这个问题的好方法，而且非常简单：

```
$(function() {
    var pastValue, pastSelectionStart, pastSelectionEnd;

    $("input").on("keydown", function() {
        pastValue          = this.value;
        pastSelectionStart = this.selectionStart;
        pastSelectionEnd   = this.selectionEnd;
    }).on("input propertychange", function() {
        var regex = /^[0-9]+\.?[0-9]*$/;

        if (this.value.length > 0 && !regex.test(this.value)) {
            this.value          = pastValue;
            this.selectionStart = pastSelectionStart;
            this.selectionEnd   = pastSelectionEnd;
        }
    });
}); 
```

*示例：* [JSFiddle](http://jsfiddle.net/f1w38jw0/10/)

**涵盖的场景**

这里大多数类似的建议至少失败了其中一个，或者需要大量代码来涵盖所有这些场景。

1.  只允许 1 个小数点。
2.  允许`home`、`end`和`arrow`键。
3.  允许`delete`并`backspace`在任何索引处使用。
4.  允许在任何索引处进行编辑（只要输入与正则表达式匹配）。
5.  允许 ctrl+v 和 shift+insert 进行有效输入（与右键单击 + 粘贴相同）。
6.  不闪烁文本值，因为`keyup`未使用该事件。
7.  在无效输入后恢复选择。

**场景失败**

*   仅从零开始`0.5`并删除将不起作用。这可以通过更改正则表达式来解决`/^[0-9]*\.?[0-9]*$/`，然后添加一个模糊事件以`0`在文本框以小数点开头时添加 a （如果需要）。请参阅此[*高级方案*](http://jsfiddle.net/f1w38jw0/18/) ，以更好地了解如何解决此问题。

**插入**

我创建了这个简单的[jquery 插件](https://gist.github.com/dsherret/50d1a6ee93c8672da782)来简化它：

```
$("input").limitRegex(/^[0-9]+\.?[0-9]*$/); 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-05-21T07:17:30.600

最好的方法是在失去焦点时检查文本框的内容。

您可以使用正则表达式检查内容是否为“数字”。

或者您可以使用验证插件，它基本上会自动执行此操作。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2010-03-06T15:23:02.517

检查此查找代码以供数据库使用：

```
function numonly(root){
    >>var reet = root.value;
    var arr1 = reet.length;
    var ruut = reet.charAt(arr1-1);
    >>>if (reet.length > 0){
        var regex = /[0-9]|\./;
        if (!ruut.match(regex)){
            var reet = reet.slice(0, -1);
            $(root).val(reet);
        >>>>}
    }
}
//Then use the even handler onkeyup='numonly(this)' 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2010-11-08T15:26:54.727

这是我刚刚完成的一个片段（使用 Peter Mortensen / Keith Bentrup 的部分代码）对文本字段进行整数百分比验证（需要 jQuery）：

```
/* This validates that the value of the text box corresponds
 * to a percentage expressed as an integer between 1 and 100,
 * otherwise adjust the text box value for this condition is met. */
$("[id*='percent_textfield']").keyup(function(e){
    if (!isNaN(parseInt(this.value,10))) {
        this.value = parseInt(this.value);
    } else {
        this.value = 0;
    }
    this.value = this.value.replace(/[^0-9]/g, '');
    if (parseInt(this.value,10) > 100) {
        this.value = 100;
        return;
    }
}); 
```

这段代码：

*   允许使用主数字键和数字小键盘。
*   验证排除 Shift 数字字符（例如 #、$、% 等）
*   将 NaN 值替换为 0
*   替换为大于 100 的 100 个值

我希望这对有需要的人有所帮助。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2012-10-05T16:03:19.440

在这里找到了一个很好的解决方案[http://ajax911.com/numbers-numeric-field-jquery/](http://ajax911.com/numbers-numeric-field-jquery/)

我只是根据我的要求将“keyup”更改为“keydown”

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2016-04-01T18:04:45.280

将插入符号位置保留在输入上的其他方法：

```
$(document).ready(function() {
  $('.numbersOnly').on('input', function() {
    var position = this.selectionStart - 1;

    fixed = this.value.replace(/[^0-9\.]/g, '');  //remove all but number and .
    if(fixed.charAt(0) === '.')                  //can't start with .
      fixed = fixed.slice(1);

    var pos = fixed.indexOf(".") + 1;
    if(pos >= 0)
      fixed = fixed.substr(0,pos) + fixed.slice(pos).replace('.', '');  //avoid more than one .

    if (this.value !== fixed) {
      this.value = fixed;
      this.selectionStart = position;
      this.selectionEnd = position;
    }
  });
}); 
```

好处：

1.  用户可以使用箭头键、Backspace、Delete、...
2.  当你想粘贴数字时工作

Plunker：[演示工作](https://plnkr.co/edit/9QQKLATWzLVJYXqW1Rga?p=preview)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-10-10T03:38:26.200

我刚刚找到了一个更好的插件。给你更多的控制权。假设您有一个[DOB](http://en.wiktionary.org/wiki/date_of_birth)字段，您需要它是数字但也接受“/”或“-”字符。

效果很好！

[在http://itgroup.com.ph/alphanumeric/](http://itgroup.com.ph/alphanumeric/)上查看。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2010-07-12T05:53:41.980

```
 $(".numeric").keypress(function(event) {
  // Backspace, tab, enter, end, home, left, right
  // We don't support the del key in Opera because del == . == 46.
  var controlKeys = [8, 9, 13, 35, 36, 37, 39];
  // IE doesn't support indexOf
  var isControlKey = controlKeys.join(",").match(new RegExp(event.which));
  // Some browsers just don't raise events for control keys. Easy.
  // e.g. Safari backspace.
  if (!event.which || // Control keys in most browsers. e.g. Firefox tab is 0
      (49 <= event.which && event.which <= 57) || // Always 1 through 9
      (48 == event.which && $(this).attr("value")) || // No 0 first digit
      isControlKey) { // Opera assigns values for control keys.
    return;
  } else {
    event.preventDefault();
  }
}); 
```

这段代码对我来说效果很好，我只需要在 controlKeys 数组中添加 46 即可使用句点，尽管我认为这不是最好的方法；）

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2012-07-27T08:22:45.637

我用了这个，效果很好。。

```
ini=$("#id").val();
a=0;
$("#id").keyup(function(e){
    var charcode = (e.which) ? e.which : e.keyCode;
    // for decimal point
    if(!(charcode===190 || charcode===110))
    {           // for numeric keys andcontrol keys
        if (!((charcode>=33 && charcode<=57) || 
        // for numpad numeric keys
        (charcode>=96 && charcode<=105) 
        // for backspace
        || charcode==8)) 
        {
            alert("Sorry! Only numeric values allowed.");
            $("#id").val(ini);
        }
        // to include decimal point if first one has been deleted.
        if(charcode===8)
        {
            ini=ini.split("").reverse();
            if(ini[0]==".")
            a=0;                 
        }
    }
    else
    {
        if(a==1)
        {
            alert("Sorry! Second decimal point not allowed.");
            $("#id").val(ini);
        }
        a=1;
    }
    ini=$("#id").val();
});

find keycodes at http://www.cambiaresearch.com/articles/15/javascript-char-codes-key-codes 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2012-12-20T06:14:24.250

这很简单，我们已经有一个 javascript 内置函数“isNaN”。

```
$("#numeric").keydown(function(e){
  if (isNaN(String.fromCharCode(e.which))){ 
    return false; 
  }
}); 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2013-09-03T03:33:18.037

jquery.numeric插件也适用于我[。](http://www.texotela.co.uk/code/jquery/numeric/)

我唯一不喜欢的就是直觉。按键在没有任何反馈给用户的情况下被“禁止”，用户可能会变得偏执或怀疑他的键盘是否坏了。

我[向插件添加了第二个回调，以便](https://github.com/Tabbernaut/SamWM-jQuery-Plugins/commit/01c2cc69f2deb5deb9473aa94d7f67b421503915)对阻塞输入进行简单的反馈：

```
$('#someInput').numeric(
    null, // default config
    null, // no validation onblur callback
    function(){
        // for every blocked keypress:
        $(this).effect("pulsate", { times:2 }, 100);
    }
); 
```

当然，这只是一个示例（使用 jQuery UI）。任何简单的视觉反馈都会有所帮助。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2014-02-19T13:57:58.147

我使用该功能，它工作正常

```
$(document).ready(function () {
        $("#txt_Price").keypress(function (e) {
            //if the letter is not digit then display error and don't type anything
            //if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) 
            if ((e.which != 46 || $(this).val().indexOf('.') != -1) && (e.which < 48 || e.which > 57)) {
                //display error message
                $("#errmsg").html("Digits Only").show().fadeOut("slow");
                return false;
            }
        });
    }); 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2014-10-13T11:53:56.407

我使用了 James Nelli 的答案并添加了 onpaste="return false;" (Håvard Geithus) 确保仅在输入中输入整数。即使您尝试粘贴，它也不允许。

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2016-03-20T14:39:00.373

[有一个名为Jquery Mask Plugin](http://igorescobar.github.io/jQuery-Mask-Plugin/)的不错的 jquery 插件 ，它旨在为表单字段和 html 元素制作掩码，但您也可以使用它来简单地定义可以在字段内键入的数据类型：

```
$('.numeric-input').mask('0#'); 
```

现在，您的表单字段中只允许使用数字。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2016-09-27T17:27:43.920

使用按键事件

> 1.  数组法

```
var asciiCodeOfNumbers = [48, 49, 50, 51, 52, 53, 54, 54, 55, 56, 57]
$(".numbersOnly").keypress(function (e) {
        if ($.inArray(e.which, asciiCodeOfNumbers) == -1)
            e.preventDefault();
    }); 
```

> 2.  直接法

```
$(".numbersOnly").keypress(function (e) {
        if (e.which < 48 || 57 < e.which)
            e.preventDefault();
    }); 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2014-01-27T13:27:55.940

此代码属于限制文本框中的字母，必须在按键事件中输入唯一数字验证。希望对您有所帮助

HTML 标签：

```
<input id="txtPurchaseAmnt" style="width:103px" type="text" class="txt" maxlength="5" onkeypress="return isNumberKey(event);" /> 
```

函数只有数字（键）{

```
 var keycode = (key.which) ? key.which : key.keyCode

        if ((keycode > 47 && keycode < 58) || (keycode == 46 || keycode == 8) || (keycode == 9 || keycode == 13) || (keycode == 37 || keycode == 39)) {

            return true;
        }
        else {
            return false;
        }
    } 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2017-01-09T17:26:31.843

***也允许负数***

以下代码也接受负数

**HTML**

```
<input type="text" name="myText" /> 
```

**JS**

```
var pastValue, pastSelectionStart, pastSelectionEnd;

$("input").on("keydown", function() {
    pastValue          = this.value;
    pastSelectionStart = this.selectionStart;
    pastSelectionEnd   = this.selectionEnd;
}).on("input propertychange", function() {

    if ( this.value.length > 0 && $.isNumeric(this.value) == false && this.value != '-' ) {
        this.value          = pastValue;
        this.selectionStart = pastSelectionStart;
        this.selectionEnd   = pastSelectionEnd;
    }
}).on('blur', function(){
        if(this.value == '-')
            this.value = '';
}); 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2017-03-24T03:44:04.250

我有这段代码可以很好地完成这项工作。

```
 var prevVal = '';
$(".numericValue").on("input", function (evt) {
    var self = $(this);
    if (self.val().match(/^-?\d*(\.(?=\d*)\d*)?$/) !== null) {
        prevVal = self.val()
    } else {
        self.val(prevVal);
    }
    if ((evt.which != 46 || self.val().indexOf('.') != -1) && (evt.which < 48 || evt.which > 57) && (evt.which != 45 && self.val().indexOf("-") == 0)) {
        evt.preventDefault();
    }
}); 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2018-04-13T14:09:04.817

您可以通过添加模式对文本输入使用 HTML5 验证。无需使用 regex 或 keyCodes 手动验证。

```
<input type="text" pattern="[0-9.]+" />

$("input[type=text][pattern]").on("input", function () {
    if (!this.checkValidity())
        this.value = this.value.slice(0, -1);
}); 
```

有关输入 [type=number] 的解决方案，请[在此处查看我的完整答案](https://stackoverflow.com/a/49798755/3616841)

* * *

## 回答 #40

> 赞同：-4
> 
> 时间：2011-04-14T14:28:40.327

请在脚本底部添加：

```
if(this.value.length == 1 && this.value == 0)
 this.value = ""; 
```

# javascript - 使用 jQuery 绑定事件的正确方法

> ID：891699
> 
> 赞同：0
> 
> 时间：2009-05-21T07:06:09.547
> 
> 标签：javascript, jquery

我对 Javascript 有点陌生，但对 jQuery 来说更环保。我已经遇到了让我摸不着头脑的事情。

有什么区别：

```
$('.foo').click(function(){
//blah
}); 
```

和

```
$('.foo').onclick = function(){
//blah
} 
```

我更喜欢第二种方式，但它似乎不起作用。难道我做错了什么？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T07:12:40.673

你错过了 jQuery 的全部意义。您首选的方法不适用于 jQuery，因为 jQuery 不能对单个 DOM 元素进行操作。单个 DOM 元素具有 onclick 属性，因此如果您执行以下操作，它将起作用：

```
document.getElementById('bar').onclick = function() { // blah }; 
```

然而，jQuery 是关于*集合*的。例如，在您粘贴的代码中，您尝试将某些内容绑定到所有具有`foo`. 当做这样的事情时，你必须遵守 jQuery 的规则（这是一件好事！）。一个包装的集合，即，与我上面所做的那样直接获取一个 DOM 元素`$('.foo')`是*不一样的。*然而，它将包含一个由 jQuery 公开*的*所有找到的 DOM 元素组成的数组。因此，如果文档中有一个具有类的单个元素`foo`，您*可以*这样做：

```
$('.foo')[0].onclick = function() { // blah }; 
```

但是，不建议这样做，因为 jQuery 的全部意义在于抽象出所有这些特定的 Javascript 语法并让 jQuery 为您解决问题。您应该接受这一点，因为它会使您的代码更加简洁和可移植。因此，您应该使用`click`或`bind`函数：

```
$('.foo').click(function() {
    // will bind something to all elements with a class of foo
});

$('.foo').bind('click', function() {
    // functionally identical to the above, either is fine
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T07:12:29.393

使用`$('.foo')`，您正在与一个 jquery 包装器对象（不是 HTML 元素对象）进行交互，该对象不具有`onclick`您在第二个示例中尝试使用的属性。

第一个示例让 jquery 编组该函数如何连接到事件，尤其是将其应用于具有类“foo”的所有内容。

如果语法更舒适，您可以：

```
var myFunction = function() { /* blah */ };
$('.foo').click(myFunction); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T07:13:57.207

onclick 属性只能附加到 DOM 元素。$('.foo') 不是 DOM 元素。它是一个类似数组的 jQuery 对象。它可以引用一个或多个 DOM 元素。

```
$('.foo')[0].onclick = function() {} 
```

将起作用，但仅将事件附加到第一场比赛。

```
$('.foo').click(function(){}) 
```

将 onclick 事件附加到所有匹配的元素。当前元素可以由`this`事件处理程序内的对象引用。

使用 jQuery 的一个原因是为了避免像上面这样的非标准代码。尽管所有浏览器都支持 onclick，但它并不是 W3C 推荐的标准附加事件方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T07:14:15.957

是的，你做错了什么。这是什么：

在 jQuery 中，$ 是一个函数。为简单起见，假设它是“jQuery”类型的对象的工厂。

所以当你写

```
var temp = $('.foo'); 
```

您正在创建一个“jQuery”类型的对象，它基本上包含所有具有“foo”类的 DOM 节点的集合。

现在，每个对象都有自己定义良好的数据成员和方法集。

click() 是一种将函数作为参数的方法。但是，“jQuery”类型的对象没有名为“onclick”的成员。所以当你写：

```
$('.foo').onclick = function(){ //blah } 
```

这没用。

但是，正确的方法：

```
temp.click( function(){ alert("My id is = " + this.id); } ); 
```

将工作。

干杯!

jrh

# captcha - 验证码算法

> ID：891701
> 
> 赞同：0
> 
> 时间：2009-05-21T07:06:55.800
> 
> 标签：captcha, verification, interaction-design

我注意到 Stack Overflow 只是偶尔给我一个验证码。有谁知道它是否有一个很好的算法来感知我是否可能是一个机器人，或者它是否只是随机的。

减少对验证码的依赖显然是一件好事。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T07:14:01.637

Stackoverflow.com 使用[reCAPTCHA](http://recaptcha.net/ "重新验证码")。而且，我也注意到，当您尝试在几秒钟内多次编辑同一个问题时，它会显示验证码验证页面。

大多数验证码生成算法都足够强大。[本文](http://news.softpedia.com/news/How-Easy-Could-A-CAPTCHA-Be-Broken-80151.shtml)描述了影响 CAPTCHA 强度的因素。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T07:09:56.357

我的印象是 SO 会监控用户的活动并在出现可疑行为时显示验证码，例如在频繁发帖或评论的情况下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T07:09:40.397

当您多次发布（或编辑）同一条目或同一问题中的条目时，它会出现。当我在不到一分钟的时间内编辑两次时，它出现在我面前

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T07:13:22.467

我从来没有在 SO 遇到过验证码，因为我使用了一个谷歌账户，并且没有给它任何理由怀疑我是我猜的机器人。如果您不创建本地登录名，您可以省去验证码和存储密码的麻烦。

*编辑*我现在在网站上看到了几个验证码，真的不知道是什么触发了它们。

# vb.net - 实现复制、剪切和粘贴

> ID：891702
> 
> 赞同：2
> 
> 时间：2009-05-21T07:08:19.840
> 
> 标签：vb.net, graphics, copy, paste, cut

我想在我的绘图程序中实现复制、剪切和粘贴（复制所选图像的一部分）

我不知道如何开始

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-19T10:41:40.757

看到这个...

[http://www.wallpaperama.com/forums/javascript-copy-selected-text-box-select-all-highlight-text-form-copy-paste-t706.html](http://www.wallpaperama.com/forums/javascript-copy-selected-text-box-select-all-highlight-text-form-copy-paste-t706.html)

但对于 Firefox，它不起作用。我也在寻找类似的。如果我得到更多，会发布。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-23T19:59:58.733

1.  **使用系统范围的剪贴板**，以防万一用户在您的应用程序的一个实例中复制并粘贴到另一个实例中，或者如果用户关闭窗口并重新打开它，他可以将数据粘贴回来。
2.  **从实现复制和粘贴的基类**继承程序的所有形状。****
***   **对于复制**（或剪切），序列化对象并将其放置在系统剪贴板中。*   **对于 paste**，读取系统剪贴板并尝试反序列化回形状对象（如果转换失败，剪贴板内容不是您的应用程序的对象）*   **将**粘贴形状的位置稍微向左下方移动（让用户知道绘图中有一个新形状）**

 *** * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T07:23:28.607

复制：获取所选矩形，创建该大小的新图像，复制当前图像并将其放置在新矩形上，偏移所选矩形的左上角

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T07:51:26.290

总之有两种方式存在

1）您自己的剪贴板 2）系统范围的剪贴板

在第二种情况下，使用必须使用标准格式来存储您的数据。阅读 MSDN 以获取有关 Windows 剪贴板的更多信息

或者您可以维护两个剪贴板 - 自己的和系统的。然后在*您的*剪贴板中，您可以存储应用程序的特定信息，并在系统剪贴板中存储图像

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-21T11:13:35.443

以下是一些全球要点，它们将大大加快您将面临的问题。

尝试搜索可逆线/橡皮筋。在图片中进行选择。尝试在 VB .NET 中搜索 LockBits，以创建一种快速读取和写入像素的方法。尝试学习后台线程，并报告进度。对于需要很长时间的每像素操作。尝试制作MDI。有足够的状态栏来报告状态。将项目文件保存到磁盘时尝试序列化为 xml/binary（例如 psd）。这也很方便，用于创建撤消功能。

# oracle - 如何在 oracle 中删除外部用户？

> ID：891703
> 
> 赞同：0
> 
> 时间：2009-05-21T07:08:24.940
> 
> 标签：oracle

当我给..

> > 从 dba_users 中选择 *；它会给出用户列表。在该列表中有一个用户

用户名：first/dbgokul 密码：EXTERNAL

当然..这是我错误地创建的。（长回来）。

现在我不知道如何删除这个用户..

请给我打电话..如何从数据库中删除此用户..???

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T09:54:59.487

删除用户“first/dbgokul”级联；

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T07:18:54.827

```
drop user <username> CASCADE; 
```

如果用户不拥有任何对象，则可以省略 CASCADE。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T10:33:13.810

如果指定不带引号的 Oracle 对象名（包括用户名），Oracle 会搜索不带特殊字符的大写名称。因此，建议不要在 Oracle 对象的名称中使用混合名称或小写名称或特殊字符。如果您在名称周围指定引号，Oracle 可以接受小写/混合大小写名称和特殊字符。看这个例子：

```
SQL> create user "first/dbgokul" identified by foo
  2  /

Gebruiker is aangemaakt.

SQL> select username from dba_users where username like 'fi%'
  2  /

USERNAME
------------------------------
first/dbgokul

1 rij is geselecteerd.

SQL> drop user first/dbgokul
  2  /
drop user first/dbgokul
               *
FOUT in regel 1:
.ORA-00921: Onverwacht einde van SQL-opdracht.

SQL> drop user "first/dbgokul"
  2  /

Gebruiker is verwijderd. 
```

问候，罗布。

# c++ - 如何增加堆栈内存？

> ID：891711
> 
> 赞同：0
> 
> 时间：2009-05-21T07:10:13.500
> 
> 标签：c++, recursion, stack, overflow

[如何在大量递归中允许更多内存并避免堆栈溢出](https://stackoverflow.com/questions/743545/how-to-allow-more-memory-and-avoid-stack-overflow-on-lots-of-recursion)？

我正在编写一个分支定界算法，它通过递归函数具有至少 10000 个级别，但由于堆栈溢出错误，它不起作用。这是我的 C++ 程序的一个简单实例：

```
void f(int k)
{
   if(k==10000) return;
   f(k+1);
} 

void main()
{
   f(1);
   return;
} 
```

有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T07:14:24.007

这是一个链接器问题。您需要告诉链接器增加分配给堆栈的内存量。这对于不同的语言和编译器是不同的。它可以是命令行参数，也可以是配置文件，甚至可以在源代码中指定。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T07:18:12.190

如果您使用的是 Linux（也可能是 Mac？），您可以使用 ulimit 命令。

但是您可能想研究优化算法或研究尾递归。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-05T15:29:38.767

如果您使用 _beginthreadex，您可以指定堆栈大小。我相信默认值是 1MB。您可以分拆一个新线程来完成您的工作并指定您想要的任何堆栈大小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T07:16:51.600

任何递归算法都可以使用列表重写为非递归算法。通过这种方式，您将问题从堆栈大小转移到堆大小，堆通常（远）大于线程堆栈。还有堆栈大小链接器标志，取决于您的编译器/链接器和平台

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T07:17:06.327

或者您可以将递归重写为交互。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T08:07:24.557

除了您的主要问题之外，您还可以使用 Valgrind 及其工具 Massif 来分析您的堆栈消耗内存（默认情况下，Massif 配置文件堆，但如果打开选项，也可以配置堆栈）。

# c - 递归增量器

> ID：891715
> 
> 赞同：2
> 
> 时间：2009-05-21T07:11:42.890
> 
> 标签：c, recursion

我正在编写一个递归函数，它接受一个 char 数组，它表示一个数字，以及一个指向该数组中数字的指针。该函数的重点是增加数字，就像 ++ 运算符一样。但是，当我在号码“819”上尝试时。它不会将其增加到“820”，而是将其更改为“810”（它会增加最后一个数字，但不会执行我想要的递归）。有人可以帮我解决这个问题吗？谢谢。

```
#include <stdio.h>

char* inc(char *num, char* p)
{   
    if( *p>='0' && *p<='8' )
    {
        *p++;
    }
    else if ( *p=='9' )
    {
        *p = '0';
        inc(num, --p);
    }

    return num;
}

main()
{
    char x[] = "819";

    printf("%s\n", inc(x, x+strlen(x)-1) ); //pass the number and a pointer to the last digit
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-21T07:18:25.217

改变`*p++ to (*p)++`；您想增加 p 中包含的数字。

```
 char* inc(char *num, char* p)
    {   
        if( *p>='0' && *p<='8' )
        {
            (*p)++;       //==> change
        }
        else if ( *p=='9' )
        {
            *p = '0';
            inc(num, --p);
        }

        return num;
    } 
```

**编辑：**

`++`运算符的优先级高于`*`. 因此，

```
*p++ ==> *p then p++; // p's value before the increment. 
```

[请参阅此处](http://www.difranco.net/compsci/C_Operator_Precedence_Table.htm)的优先级表。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-21T07:22:10.340

这是因为`*p++`检索字符然后增加*指针*。您想要`(*p)++`增加该指针处的字符：

```
#include <stdio.h>

char *inc (char *num, char* p) {
    if (*p >= '0' && *p <= '8') {
        (*p)++;
    } else if (*p == '9') {
        *p = '0';
        inc(num, --p);
    }
    return num;
} 
```

在 9xxx 以上的字符串上运行它时应该非常小心，因为你必须确保为下一个数字留出空间（如果需要，用 0 预先填充它）。否则添加保护，例如下面的换行功能：

```
#include <stdio.h>

char *inc (char *num, char* p) {
    if (p < num)
        return num;
    if ((*p < '0') || (*p > '9'))
        return num;
    if (*p < '9') {
        (*p)++;
        return num;
    }
    *p = '0';
    return inc(num, --p);
}

int main (int argc, char *argv[]) {
    char x[] = "819";
    char y[] = "8999";
    char z[] = "9999";
    char a[] = "aaa72";
    char b[] = "aaa279";
    char c[] = "aaa9999";
    printf("%s\n", inc(x, x+strlen(x)-1) );
    printf("%s\n", inc(y, y+strlen(y)-1) );
    printf("%s\n", inc(z, z+strlen(z)-1) );
    printf("%s\n", inc(a, a+strlen(a)-1) );
    printf("%s\n", inc(b, b+strlen(b)-1) );
    printf("%s\n", inc(c, c+strlen(c)-1) );
    return 0;
} 
```

此代码导致：

```
820
9000
0000
aaa73
aaa280
aaa0000 
```

正如预期的那样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T07:47:37.780

在使用 C++ 编码时，我总是遵循一些有助于实现正确性的准则：

*   **不要在同一条指令中修改和获取任何内容的值。** ie`inc(num, --p);`被禁止是因为 inc 的第二个参数不是 const。
*   **永远不要取消引用指针并在同一行中对其进行处理。**即所有形式的 `(*p)++;`都被禁止。
*   始终**保证函数参数的 const 正确性**。
*   **命令/查询分离**：函数通常应该是 const 或 void。
*   **如果可以避免，请**不要使用递归，即始终首先寻找非递归替代方案。**（这个问题是一个可以避免的例子）。**
***   **按合同设计。**将前置条件添加到函数的开头，将后置条件添加到函数的末尾。**

 **将它们应用于您的函数可能有助于消除其中的错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T08:02:29.950

在 gcc 上编译的原始程序的副作用示例，（此副作用不会发生在 @Pax 程序上）

```
int
 main()
{
char x[] = "9";
char z[] = {57,57,57,57};

int t=0;
for(t=0;t<4;++t)
    printf("z == %d\n",z[t]);

inc(x, x+strlen(x)-1);

for(t=0;t<4;++t)
    printf("z == %d\n",z[t]); 
```

}

输出：z == 57 z == 57 z == 57 z == 57 z == 48 z == 48 z == 48 z == 48

# c - 用于创建列表的脚本： 对于特定的项目目录

> ID：891718
> 
> 赞同：1
> 
> 时间：2009-05-21T07:13:10.640
> 
> 标签：c, statistics, scripting

任何人都知道获取列表的脚本，该列表能够告诉我 C 项目中最常调用的函数吗？

方法1 391方法
2 23
方法3 12

更好的是可以自定义方法名称“get”中的关键字。

我试图不重新发明轮子并编写一个简单的脚本来自己做。使用 grep 或 awk 可能是一种简单的方法。我可以编写一个正则表达式来匹配函数调用名称。一个 Eclipse 插件将是理想的。

我不是在寻找分析器。我想要这种方法的原因是我需要为嵌入式项目优化程序空间。我倾向于用 getter 封装我的成员变量，但可能需要使用 externs 并直接访问最常用的成员以减少空间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T08:00:34.413

一种方法是在源代码库上运行[Doxygen](http://www.doxygen.org/)。您需要对其进行配置以提取所有函数和类，除非您已经在使用 Doxygen，因为默认情况下它会忽略未记录的实体。

如果您还安装了 AT&T [GraphViz](http://www.graphviz.org/)，您可以获得为每个函数绘制的漂亮调用图和调用者图。但我不认为有一个表格可以按通话次数来总结这一点。

但是，有几种非文档输出格式可供选择，包括 Perl 模块和 XML。应该可以解析其中一个来开发您想要的列表，并且解析该信息几乎肯定比将足够多的 C++ 前端组合在一起以通过蛮力获得正确答案更容易。

还有一个 GCC 的 XML 后端漂浮在某个地方，它基本上将语法树转储到 XML 中......我最近绊倒了它，但不记得具体在哪里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-27T05:16:53.257

这是一个简单的 java 脚本，它提供了我正在寻找的输出。通过自定义文件顶部的两个 REGEX，它也可以用于生成其他模式出现的统计信息。

```
import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.HashMap;
import java.util.Map;
import java.util.Set;
import java.util.regex.Pattern;

public class MethodCallCount {
    // This is the regex which is applied to each line to test if there is a method call on it.
    private static String REGEX_METHODCALL = "(?:\\s*)([a-zA-Z0-9_]+)\\((.*)"; 
    // Only looks in files with .c extention
    private static String REGEX_FILEEXTS = ".*.c";
    private static boolean VERBOSE_OUTPUT = false;
    private static Map<String,Integer> patternMap = new HashMap<String,Integer>();

    // Process all files and directories under dir
    public static void visitAllDirsAndFiles(File dir) {

        if( !dir.isDirectory()) {
            if( dir.getName().matches(REGEX_FILEEXTS) ) {
                if( VERBOSE_OUTPUT ) { System.out.println("Processing File: " + dir.getName() ); }
                processFile(dir);
            }
        }
        else if( !dir.getName().equals(".svn") ) {
            String[] children = dir.list();
            for (int i=0; i<children.length; i++) {
                visitAllDirsAndFiles(new File(dir, children[i]));
            }
        }
    }

    // Process only directories under dir
    public static void visitAllDirs(File dir) {
        if (dir.isDirectory()) {
            processFile(dir);

            String[] children = dir.list();
            for (int i=0; i<children.length; i++) {
                visitAllDirs(new File(dir, children[i]));
            }
        }
    }

    // Process only files under dir
    public static void visitAllFiles(File dir) {
        if (dir.isDirectory()) {
            String[] children = dir.list();
            for (int i=0; i<children.length; i++) {
                visitAllFiles(new File(dir, children[i]));
            }
        } else {
            processFile(dir);
        }
    }

    public static void processMethod( String pMethod ) {
        if( VERBOSE_OUTPUT ) { System.out.println("found: " + pMethod); }
        if( patternMap.containsKey( pMethod ) ) {
            Integer cnt = patternMap.get( pMethod );
            cnt = cnt + 1;
            patternMap.put(pMethod, cnt );
        }
        else {
            patternMap.put( pMethod.toString(), 1);
        }       
    }

    public static void processLine( String pLine ) {
        Pattern methodMatcher = Pattern.compile( REGEX_METHODCALL );
        java.util.regex.Matcher matcher = methodMatcher.matcher( pLine );

        if( matcher.matches() ) {
            if( VERBOSE_OUTPUT ) { System.out.println("processing " + matcher.group(1) ); }
            processMethod( matcher.group(1) );                  
            processLine( matcher.group(2) );
        }
    }

    public static void processFile( File pFile ) {
        BufferedReader fin;
        try {
            fin = new BufferedReader( new InputStreamReader( new FileInputStream(pFile) ) );
            String l = null;
            while( (l=fin.readLine()) != null ) {
                processLine( l );
            }
        } 
        catch (IOException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }       
    }

    /**
     * @param args[0] is the directory to run this on.  Otherwise current directory is used.
     */
    public static void main(String[] args) {

        String searchDirPath = System.getProperty("user.dir");
        if( args.length > 0 ) {
            searchDirPath = args[0];
        }
        else {
            System.out.println("No argument specified... searching for *.map in: " + searchDirPath );
        }

        File searchDir = new File( searchDirPath );
        visitAllDirsAndFiles(searchDir);

        // Print Stats.
        int callCnt = 0;
        Set<String> patternSet = patternMap.keySet();
        for( String p : patternSet ) {
            System.out.println( patternMap.get(p) + "\t" + p );
            callCnt += patternMap.get(p);
        }
        System.out.println("Unique Methods: " + patternMap.size());
        System.out.println("Calls Detected: " + callCnt );
        System.out.println("Copy and paste output above into excel and then sort columns");
        System.out.println("DONE.");
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-22T15:30:04.807

如果“最频繁”是指在某些程序运行中的实际调用次数，那么[DTrace](http://en.wikipedia.org/wiki/DTrace)可能是您正在寻找的工具，假设您有一个用于开发工作的 Solaris、FreeBSD 或 OSX 机器。有关 Doxygen 和 DTrace 的精彩描述，另请参阅[*Code Spelunking redux*](http://cacm.acm.org/magazines/2008/10/520-code-spelunking-redux/fulltext)。

# data-structures - 伙伴堆算法的数据结构或实现

> ID：891721
> 
> 赞同：0
> 
> 时间：2009-05-21T07:13:22.590
> 
> 标签：data-structures

我想知道伙伴堆算法是如何工作的，或者其中使用了什么数据结构。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T07:39:58.263

我猜你正在考虑[好友内存分配](http://en.wikipedia.org/wiki/Buddy_memory_allocation)？有指向维基百科页面的链接。它确实提到：

> 通常，伙伴内存分配系统使用二叉树来表示已使用或未使用的拆分内存块。

如果您难以理解 Wikipedia 条目，您能否更新您的问题以更具体地说明您遇到问题的部分？

# visual-c++ - 仅启动一个基于 MFC 对话框的应用程序实例

> ID：891729
> 
> 赞同：1
> 
> 时间：2009-05-21T07:16:06.687
> 
> 标签：visual-c++, mfc

我创建了一个基于 MFC 对话框的应用程序。

我启动了应用程序，它运行良好。现在，当它运行时，我再次启动应用程序，它启动了它的另一个实例。

但是，我不希望他的行为；如果应用程序已经在运行，我想阻止它的新实例被创建。

请给我代码。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-21T08:02:36.437

在调用应用程序对话框类之前，请尝试在 main 中调用以下函数。如果它返回 False 那么不要创建你的对话框而是退出。

```
BOOL init()
{
   HANDLE mutex = CreateMutex(NULL, FALSE, "mutexname");
   if(mutex == NULL)
   {
      return FALSE;
   }

   if (GetLastError() == ERROR_ALREADY_EXISTS)
   { 
       /* You only need the message box if you wish to notify the user 
          that the process is running*/
       MessageBox("Another instance is already running.");
       return FALSE;
   }

   return TRUE;
} 
```

确保 mutexname 是唯一的，使用 VS 生成 GUID 并将其以字符串形式用作 mutex 名称。

# netbeans - 任何人都可以向我展示如何制作复杂的 iReport 报告并将其导出到浏览器的好教程吗？

> ID：891733
> 
> 赞同：-1
> 
> 时间：2009-05-21T07:17:03.037
> 
> 标签：netbeans, jasper-reports, ireport

我正在netbeans **IDE中处理****iReport**。

 **我想制作可以在浏览器中以任何**pdf**或**excel**格式导出的报告。

任何人都可以向我展示一个好的教程或解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-29T07:45:39.820

Apress-iReport 权威指南是一本好书，我认为这是我开始制作报告时发现的唯一想法。也可以查询iReport论坛 iReport [论坛](http://jasperforge.org/plugins/espforum/view.php?group_id=83&forumid=101&topicid=6)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-22T20:33:28.420

我发现[这篇 Google knol 文章很有帮助](http://knol.google.com/k/nasir-qureshi/jasper-reports-working-with-beans-and/3az55pmbwf6s/3#)。但我买了“Jasper Reports Ultimate Guide”——这是一本 PDF 电子书，包含大量信息。然后我只是搜索特定主题的讨论。您会发现使用免费的 iReport 程序将帮助您构建报告并测试各种可能性。

我还发现，结合其他人的示例，[Jasper Reports API给了我一组相当不错的信息。](http://jasperreports.sourceforge.net/api/index.html)据我所知，您几乎可以将任何 Jasper 报告导出为任何格式。您可以在 iReport 中测试导出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-28T19:26:27.833

*   ***[JasperReport Ultimate Guide](http://jasperreports.sourceforge.net/JasperReports-Ultimate-Guide-3.pdf)***是非常有用的指南。

*   [这里有](http://jasperreports.sourceforge.net/sample.reference.html)很多示例如何设计和构建以及不同的报告。供应商的信息提供者。

*   *SO*上有很多样本和已解决的案例。恕我直言，Out 社区帮助成千上万的 IT 专家找到解决方案。您可以使用[jasper-reports](/questions/tagged/jasper-reports "显示标记为“jasper-reports”的问题")标签来查找有关*JasperReports*的信息。

*   *Jaspersoft*有自己的[社区](http://community.jaspersoft.com)，其中也包含大量有用的信息。

# c++ - 分区排序编程问题

> ID：891750
> 
> 赞同：3
> 
> 时间：2009-05-21T07:20:13.763
> 
> 标签：c++, sorting

我需要一个算法来选择第*k*个最大值或最小值。值将是整数。我的导师告诉我使用修改后的分区算法来找到第*k*个最大值或最小值。有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T08:10:40.040

下面是快速选择算法的描述。我会假设你想找到第*k*个最小值。

1.  获取数组的第一个元素。这将是你的支点。跟踪它的位置。

2.  基于此枢轴对数组进行分区。小于枢轴的元素在数组中的枢轴之前；更大，在你的枢轴之后。（此步骤将移动您的枢轴。跟踪其在阵列中的位置。）

3.  您现在知道您的枢轴大于`pivot_position`元素数。因此，您的枢轴是第 ( `pivot_position + 1`) 个最小的元素。

    *   如果*k*等于`pivot_position + 1`，那么您已经找到了您的第*k*个最小值。恭喜，返回`pivot_position`该值在数组中的位置。

    *   如果*k*小于`pivot_position + 1`，则您需要一些小于枢轴的值。在您的枢轴之前查看数组的第*k*个最小值。

    *   如果*k*大于`pivot_position + 1`，则您需要一些大于枢轴的值。`pivot_position`在 *k - ( + 1)*th 最小值的轴之后查看数组的一部分（因为数组的该部分不包括 ( `pivot_position`+ 1) 最小值）。

由于您使用的是 C++，因此您可能应该按如下方式实现您的函数：

```
int select(int *array, int left, int right, int k);
int partition(int *array, int left, int right, int pivot_position); 
```

`select`接受你的数组、左右边界和你的*k*。澄清一下，`array[left]`将是第一个元素；`array[right]`将是最后一个；`right - left + 1`将是数组的长度。`select`返回第*k*个最小元素的位置。

`partition`获取您的数组、左右边界以及枢轴的起始位置。`pivot_position`每次只传递 0 是安全的，这意味着您希望使用数组中的第一个元素作为枢轴。（在称为随机快速选择的变体中，您选择一个随机`pivot_position`。）`partition`在您完成移动物体后返回枢轴的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T07:32:29.400

STL 有一个`partial_sort`功能，可以对序列的前 k 个项目进行排序，并允许您通过简单的查找来获取该项目。

换句话说，寻找，`std::partial_sort`其余的将是显而易见的。

STL中还有一个`nth_element`函数。我相信你可以弄清楚如何使用它。

# visual-studio-2010 - VS2010 Beta 1 会升级到最终产品吗？

> ID：891754
> 
> 赞同：0
> 
> 时间：2009-05-21T07:21:30.967
> 
> 标签：visual-studio-2010

VS2010 Beta 1 会升级到最终产品吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T07:37:02.700

可能不是。我记得没有其他版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T07:41:16.653

+1 同意workmad3。非常非常不可能。正如他所说，没有其他版本有。

此外，在 Beta 期间发生了很多变化，事实上，有时从您的计算机上获取 Beta 版本以便为发布版本让路可能会很麻烦。

# asp.net - ASP.net MVC - 密码检索到哪里去了？

> ID：891766
> 
> 赞同：0
> 
> 时间：2009-05-21T07:25:28.480
> 
> 标签：asp.net, asp.net-mvc, password-retrieval

是我的想象还是早期版本的 ASP.net MVC 内置了密码检索功能？

我在 1.0 版中没有看到它

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-21T07:45:45.863

你是说控制吗？您可以使用标准的 ASP.NET 成员相关控件

并且不要忘记 [Authorize] 属性

# apache-flex - 如何在flex中将白色转换为图像的背景颜色？

> ID：891767
> 
> 赞同：1
> 
> 时间：2009-05-21T07:25:37.870
> 
> 标签：apache-flex

我有一张图片，我想从图片中删除白色。

去除颜色与其背景颜色相同。如果有人对此问题有任何想法，请回答？

我在 Flex 3 中的应用程序，所以请给我这个问题的动作脚本代码。谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-11-22T09:39:38.093

下面是为您提供预期功能的代码片段。

```
var sourceBitmap:BitmapData = new BitmapData(myChart.width, myChart.height,true,0x000000);
sourceBitmap.draw(myChart);  
//prev image is the "Image" variable name
prevImage.source = new Bitmap(sourceBitmap); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T07:48:29.540

1.  使用 infranview 将图像的背景从白色更改为透明（通过另存为 PNG）。
2.  像往常一样使用 flex
3.  利润！

# iphone - 我怎样才能只用类方法创建一个能够记住值的类？Core Animation 是如何做到这一点的？

> ID：891769
> 
> 赞同：0
> 
> 时间：2009-05-21T07:25:46.327
> 
> 标签：iphone, uikit, core-animation

我有一些有用的物理计算方法，比如加速/减速、速度等等。

它们中的大多数在时间上需要至少两次测量。所以每次我想使用它们时，我都必须在我的对象中实现一堆需要计算的实例变量，例如计算加速度。

例如，在我需要计算加速度的任何地方，我都会包含 SLPhysics.h 并在我的代码中编写：

```
double acceleration = [SLPhysics + calculateAccelerationForFirstMeasuredSpeed:v1 secondMeasuredSpeed:v2 firstMeasuredTime:t1 secondMeasuredTime:t2]; 
```

这工作正常。但我更喜欢一种行为类似于 Core Animation 的方式，其中大多数必须完成的操作的细节对类的用户是隐藏的。

因此，为了防止我让实例变量记住最后测量的值 v1 和 t1，我更喜欢这样一个易于处理的调用：

```
double acceleration = [SLPhysics + calculateAccelerationForMeasuredSpeed:v measuredTime:t context:self]; 
```

注意上下文参数。我认为这是要走的路。但目前我不知道这些类方法如何访问数据结构，例如 NSMutableDictionary。如果我要创建实例变量，则类方法将无权访问。如果我将其设为实例方法，则用法会很丑陋且难以阅读，并且用户会被内存管理和其他东西所困扰。此外，所有这些分配和初始化可能会花费太多（我认为）。我的意思是......看看核心动画。这太容易了！我想要同样的东西。但我猜他们也有这个问题。他们必须记住一些东西。动画持续时间、上下文等。

我想过将值写入文件，但这太贵了。我可以使用 SQLite。太昂贵的操作，可能。这些方法可用于每秒需要 5 到 100 次计算的地方。没有像“类变量”这样的东西吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T07:35:58.910

使用单例。您的类将所有“类变量”存储为单例变量。将单例实现为静态类方法：

```
@interface SLPhysics {
   int a;
   int b;
}

+(SLPhysics*)getSingleton;

+calculate;
@end

@implementation SLPhysics 

+(SLPhysics*)getSigleton {
 static SLPhysics* singleton;
 if (null == singleton) singleton = [[SLPhysics alloc] init];
 return singleton;
}

+calculate {
  SLPhysics* singleton = [SLPhysics getSingleton];
  // use singleton.a singleton.b here
}

@end 
```

如果需要，添加线程安全。

# javascript - 如何使用 javascript 在页面上获取包含特定单词的链接

> ID：891770
> 
> 赞同：2
> 
> 时间：2009-05-21T07:26:22.813
> 
> 标签：javascript, bookmarklet

我正在尝试获取包含页面上一个单词的链接并将它们刷新到另一个页面，在一个小书签中。

这是我没有为书签工作的代码：

```
 javascript:
        for (i=0; i < document.links.length; i++) {
     if(document.links[i].href.match('exampleword')) {
    location.href = 'http://google.com/exampleword'; 
}
} 
```

为什么这不起作用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T08:29:01.563

Greg 敏锐地发现你真的想要链接“*标签*”，而不是 href URL。但是我会使用***getElementsByTagName('A')***来获取所有元素。然后遍历它们的***firstChild***节点。

获取' ***firstChild*** '的' ***nodeValue*** '就像获取innerHTML或（innerText，有人提到，支持较少）一样容易。

 *这是一个最小的例子，寻找“word1”、“word2”和“word3”。

我将补充一点，如果您想将为此查看的链接限制为页面或站点上链接的子集，您可以通过将特定的 className 设置为您要搜索的链接来区分其他方式。检查您抓取的链接的类名只会使事情变得复杂一些。因此，一个简单的 A 节点迭代：

例子：

```
<html>
<head>
<title>JavaScript match link label</title>
<script type="text/javascript">
var keywords = ['word1','word2','word3'];
function linklabels() {
    var aels = document.getElementsByTagName && document.getElementsByTagName('A');
    var aelsCt = aels.length;
    var keywordsCt = keywords.length;
    for (var i = 0; i < aels.length; i++) {
        var v= aels[i].firstChild.nodeValue;
            //this is the link label, the text seen as the link
        for (var j=0; j < keywordsCt; j++) {
            var re = new RegExp(keywords[j]); 
            if (re.test(v)) {
                alert('refreshing to http://google.com/' + v);
                //window.location.href = "http://google.com/" + v;
            }
        }
    }
}
window.onload=linklabels;
</script>
</head>
<body>
<p><a href="#">word1</a> | <a href="#">word2</a> | <a href="#">word3</a>
<br /><a href="#">word1</a> | <a href="#">word2</a> | <a href="#">word3</a></p>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T07:30:42.400

您正在检查链接href 是否包含该单词-从您的问题来看，这听起来更像是您想要锚文本（即您单击的单词）。最简单的方法（虽然如果`<a>`包含其他标签则不是 100% 准确）是这样的：

```
if (document.links[i].innerHTML.match('exampleword')) 
```

# sql - 堆栈溢出相关问题算法

> ID：891772
> 
> 赞同：29
> 
> 时间：2009-05-21T07:26:47.337
> 
> 标签：sql, search, full-text-search, nlp

输入标题后出现的相关问题，以及在查看问题时出现在右侧栏中的问题，似乎都提出了非常贴切的问题。

Spolsky 在一次演讲中说，Stack Overflow 只对其进行 SQL 搜索，不使用特殊算法。

在这种情况下，存在哪些算法可以给出好的答案。在这种情况下如何进行数据库搜索？使标题可搜索并搜索关键字或搜索标签和那些在顶部有很多投票的问题？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-21T08:48:24.147

如果您收听[Stack Overflow 播客 32](https://blog.stackoverflow.com/2008/12/podcast-32/)（不幸的是，成绩单并没有太多内容），您可以听到 Jeff Atwood 谈及他是如何做到的。

看起来算法是这样的：

*   接受问题
*   删除英语中最常用的单词（从他从 google 获得的列表中）
*   向 SQL Server 2008 全文搜索引擎提交全文搜索

有关全文搜索的更多详细信息，请参见：http: [//msdn.microsoft.com/en-us/library/ms142571.aspx](http://msdn.microsoft.com/en-us/library/ms142571.aspx)

这现在可能已经过时了——他们正在谈论转向更好/更快的全文搜索，例如[Lucene](http://lucene.apache.org/java/docs/)，我隐约记得 Jeff 在播客中说这已经完成了。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-21T07:40:55.390

相关问题侧边栏将建立在每个问题的标签上（可能通过根据标签重叠对它们进行排名，因此 5 个共同标签 > 4 个共同标签等）。

其余的将建立在适用于自然语言处理的启发式和算法之上。这些在通用语言中通常不是很好，但是一旦词汇量减少到一个单一的技术领域，例如编程，它们中的大多数都非常好。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-21T08:11:05.390

如果您想了解“相关”算法，请查看 Porter stemming 的[词干算法。](http://en.wikipedia.org/wiki/Stemming)

> 例如，英语词干分析器应根据词根“cat”识别字符串“cats”（可能还有“catlike”、“catty”等），并将“stemmer”、“stemming”、“stemmed”识别为基于“干”。词干算法将单词“fishing”、“fished”、“fish”和“fisher”简化为词根“fish”。

处理完文档并对其进行词干提取后，您可以按计数索引词干词，然后与其他文档进行比较。这是解决这个问题的最基本的方法。

还要注意忽略[停用词](http://en.wikipedia.org/wiki/Stop_words)，如“the”、“an”、“of”等。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-21T07:34:23.967

这篇文章将帮助你[有没有一种算法可以告诉两个短语的语义相似度](https://stackoverflow.com/questions/62328/is-there-an-algorithm-that-tells-the-semantic-similarity-of-two-phrases)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-21T07:32:34.737

我不知道 SO 是如何实现的，但我的直觉是他们使用了[近似字符串匹配](http://en.wikipedia.org/wiki/Approximate_string_matching)的变体。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T08:46:42.137

通过制作词干词的“词袋”来解决这些问题。这基本上是一个字数向量。这些词被预处理（词干）并根据它们在句子中出现的概率加权（“the”的概率高于“probability”，因此应该减少加权）。然后，您可以将这个词袋视为欧几里得空间中的向量或概率密度的样本。

您可以将算法应用为最近邻搜索或语义散列。后者似乎是 SOTA（见[http://www.cs.toronto.edu/~rsalakhu/papers/semantic_final.pdf](http://www.cs.toronto.edu/~rsalakhu/papers/semantic_final.pdf)）。

# .htaccess - 需要 mod_rewrite URL 信息

> ID：891775
> 
> 赞同：1
> 
> 时间：2009-05-21T07:27:14.043
> 
> 标签：.htaccess, mod-rewrite, url-rewriting

我是这个 mod_rewrite 的新手。我已经成功地将 URL 改写 `http://mydomain.com/products/12`成这样：`http://mydomain.com/products.php?prodId=12`

但是当我`http://mydomain.com/products/12`在地址栏中给出时，css和js文件没有加载。

但是当我访问`http://mydomain.com/products.php?prodId=12`js 和 css 时会正确加载。如果我遗漏了什么，请告诉我。

我的 .htaccess 看起来像这样：

```
Options +FollowSymlinks
RewriteEngine on
RewriteRule ^products/([0-9][0-9])/$ /products.php?prodId=$1 [L] 
```

我的 css 和 js 文件夹也在同一个文件夹中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T07:33:56.293

您需要知道相对 URI（因此也是绝对和相对 URI 路径）是从一个基本 URI 解析的，该基本 URI（如果没有明确声明）是当前文档的 URI。

`/products/12`因此，如果您使用相对 URI引用外部资源`foo/bar`，它将被解析为`/products/foo/bar`.

要解决此问题，请使用绝对 URI 路径（以 开头`/`）或绝对 URI（以协议开头）或显式设置除当前之外的基本 URI（请参阅[`BASE`HTML 元素](http://www.w3.org/TR/html401/struct/links.html#edef-BASE)）。但请注意，更改基本 URI 会产生一些副作用，因为它会影响*每个*相关 URI。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T07:33:05.093

您必须使用指向脚本/css 文件的相对链接，如下所示：

```
<script src="my.js"></script> 
```

这适用于您的旧 URL，但在新 URL 上，它将在“产品”目录中查找，该目录当然不存在。您可以改用绝对网址：

```
<script src="/my.js"></script> 
```

# cocoa - 获取其他应用程序的窗口/文档名称的 API

> ID：891801
> 
> 赞同：1
> 
> 时间：2009-05-21T07:47:10.727
> 
> 标签：cocoa, xcode

可可中是否有一个 API，您可以在其中获取应用程序的窗口/文档名称？我已经`[[NSWorkspace sharedWorkspace] launchedApplication]`获取了所有可用的应用程序，所以我可以访问包名称或进程 ID。我应该查看什么以便我可以获得其他应用程序的窗口/文档名称。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T13:42:39.527

您假设应用程序只有一个窗口。这不是真的; 一个应用程序可以有许多窗口。

对于您自己的应用程序，用于`[NSApp windows]`获取它们的数组。对于文档窗口，[请询问文档控制器](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSDocumentController_Class/Reference/Reference.html#//apple_ref/occ/instm/NSDocumentController/documents)。

对于其他应用程序，使用[Accessibility](http://developer.apple.com/documentation/UserExperience/Accessibility-title.html)或 CGWindowList 来查看它们的窗口。没有简单的方法只请求文档窗口，因为并非所有应用程序都是基于文档的，也不是所有基于文档的应用程序都基于 NSDocument。

# vim - 如何在 Vim 中为不同语言设置不同的选项卡设置？

> ID：891805
> 
> 赞同：70
> 
> 时间：2009-05-21T07:48:06.747
> 
> 标签：vim

在我的[.vimrc](http://en.wikibooks.org/wiki/Learning_the_vi_Editor/Vim/Enhancing_Vim#The_.vimrc_file)中，我有两个空格的通用选项卡设置，我想在每种语言基础上覆盖它（即，四个用于 Python 等，否则使用默认值），但我有很难找到任何好的例子。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2012-08-26T22:51:35.240

这些其他答案似乎太复杂了。不要在 ~/.vim 树中弄乱更多目录和文件，只需将以下内容添加到 ~/.vimrc。

```
autocmd Filetype python setlocal expandtab tabstop=4 shiftwidth=4 softtabstop=4 
```

（您可以是 l33t 并将参数缩写为`et ts=4 sw=4 sts=4`）。我在 [通过文件类型设置 Vim 空白首选项中找到了这个](https://stackoverflow.com/questions/1562633/setting-vim-whitespace-preferences-by-filetype)

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-05-21T08:03:15.097

只需将设置放入文件类型插件文件 ~/.vim/ftplugin/LANGUAGE.vim 即可。我的 ~/.vim/ftplugin/perl.vim 包含以下行：

```
"
" ---------- tabulator / shiftwidth --------------------
"  Set tabulator and shift width to 4 (Perl Style Guide)
"
setlocal  tabstop=4
setlocal  shiftwidth=4
" 
```

这些设置将自动对文件类型为“perl”（新的或现有的）的每个文件生效。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-11-16T16:26:20.667

我的回答是基于VIM Wiki 上的[这个提示。](http://vim.wikia.com/wiki/Indenting_source_code#Different_settings_for_different_file_types)此答案使用“after”目录，因此您不必为不同的文件类型使用提供的插件文件。

例如，要为 Python 文件指定自定义设置，请创建一个名为`python.vim`保存 Python 设置的文件：

```
setlocal expandtab
setlocal shiftwidth=4
setlocal softtabstop=4 
```

将此文件放在

*   `~/.vim/after/ftplugin`(Linux)
*   `$HOME/vimfiles/after/ftplugin`（视窗）

最后，你必须在你的`.vimrc`(Linux) 或`_vimrc`(Windows) 中有这个：

```
filetype plugin indent on 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-05-21T07:54:53.537

通常，您所做的是设置一个特殊的 vimrc 类型文件，其中包含特定语言的设置，然后在必要时使用主 .vimrc 中的自动命令来执行特殊的 vimrc。这是我对 Haskell (`.hs`等) 文件的配置：

```
autocmd! BufNewFile,BufReadPre,FileReadPre  *.hs    so ~/.vim/haskell.vim
autocmd! BufNewFile,BufReadPre,FileReadPre  *.hsc   so ~/.vim/haskell.vim
autocmd! BufNewFile,BufReadPre,FileReadPre  *.lhs   so ~/.vim/haskell.vim
autocmd! BufNewFile,BufReadPre,FileReadPre  *.cabal so ~/.vim/haskell.vim 
```

我`~/.vim/haskell.vim`会使用“set expandtab”之类的东西来使用空格而不是制表符，以及各种其他用于格式化和类似事情的魔法。[您通常可以从http://vim.org](http://vim.org)和其他站点下载各种语言的良好版本。

请注意，您可以做的不仅仅是更改 vim 设置。例如，您可以在编辑前后通过过滤器运行文件：

```
" Edit gpg-encrypted ascii-armoured files
autocmd! BufReadPre,FileReadPre      *.asc  set bin
autocmd  BufReadPost,FileReadPost    *.asc  '[,']!gpg -q -d
autocmd  BufReadPost,FileReadPost    *.asc  set nobin
autocmd! BufWritePre,FileWritePre    *.asc  set bin
autocmd  BufWritePre,FileWritePre    *.asc  '[,']!gpg -e
autocmd  BufWritePost,FileWritePost  *.asc  undo
autocmd  BufWritePost,FileWritePost  *.asc  set nobin 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-02-15T11:01:05.803

我使用[编辑器配置](https://github.com/editorconfig/editorconfig-vim#readme)插件并将 .editorconfig 文件添加到我的所有项目中 - 它可以让您使用相同的编程语言为不同的项目定义不同的缩进设置，这很有用，因为同一语言的不同项目通常具有不同的编码标准。

您可以在此处查看可以设置的配置类型示例：http: [//editorconfig.org/](http://editorconfig.org/)

# algorithm - 识别鼠标移动的算法

> ID：891808
> 
> 赞同：3
> 
> 时间：2009-05-21T07:48:43.487
> 
> 标签：algorithm, language-agnostic, mouse, gestures

我想知道是否有任何研究/算法在识别诸如“？”之类的字符时指定鼠标的偏差量。使用鼠标绘制。某种光学字符识别，但可能是更简单的版本。是否有某种算法可以说用户绘制的问号实际上是一个问号，而不是其他具有一定准确性的东西。类似于 Windows 平板电脑软件允许的东西（使用平板电脑手写笔书写时）。

感谢您的时间。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T08:09:47.720

1.  [鼠标手势识别](http://www.codeproject.com/KB/system/gestureapp.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T09:03:22.603

[动态时间扭曲](http://en.wikipedia.org/wiki/Dynamic_time_warping)是一种商用手写识别系统的基础。基本上，这是一种为您提供从输入序列到存储模板的距离度量的方法。正确实现，例如基于数值导数，它可以是尺度和位置不变的。

# hibernate - 了解 Jasper Reports 和 Hibernate 以及参数

> ID：891810
> 
> 赞同：3
> 
> 时间：2009-05-21T07:49:26.277
> 
> 标签：hibernate, parameters, jasper-reports

对不起，这是一个有点糟糕的问题，因为我的问题是我只是不明白为此采取哪种方法。我有这个运行良好的休眠数据库，我想用它`JasperReports`来创建基于它的数据的报告。我`iReport`正在工作并连接到`hibernate`配置，并且能够从我的查询中读取字段并构建报告。

但是，我希望能够保存从我的应用程序运行的报告，并在某些对象上运行，在运行时决定。我需要能够在运行时将我的自定义持久对象传递给这些报告并以这种方式生成报告。所以他们自己真的不需要查询，他们只需要知道他们将获得什么样的对象。

我看到我可以给他们参数，但只能给原始对象，而且`iReport`我只能用简单的数据类型制作字段，但我的大部分值都在我的对象的 toString() 中呈现，所以我只想归还那些。

如果有人向我解释其中一些事情，我将非常感激。非常感谢！约书亚

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T08:17:34.457

我认为您可能需要查看 [http://jasperreports.sourceforge.net/api/net/sf/jasperreports/engine/data/JRBeanCollectionDataSource.html](http://jasperreports.sourceforge.net/api/net/sf/jasperreports/engine/data/JRBeanCollectionDataSource.html)

这是 bean 的数据源集合，因此您可以将自定义 bean 作为数据源加载到报告中

# java - 从Java中的抽象类调用子类构造函数

> ID：891824
> 
> 赞同：6
> 
> 时间：2009-05-21T07:58:37.180
> 
> 标签：java

```
public abstract class Parent {

    private Parent peer;

    public Parent() {
        peer = new ??????("to call overloaded constructor");
    }

    public Parent(String someString) {
    }

}

public class Child1 extends parent {

}

public class Child2 extends parent {

} 
```

当我构造一个 Child1 的实例时，我希望自动构造一个也是 Child1 类型的“对等体”，并将其存储在对等属性中。同样对于 Child2，具有 Child2 类型的对等体。

问题是，在父类中对等属性的分配。我不能通过调用来构造一个新的 Child 类，`new Child1()`因为它不适用于 Child2。我怎样才能做到这一点？有没有我可以使用的关键字来引用子类？像`new self()`什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-21T08:09:47.330

我不确定是否可以在不陷入循环的情况下做到这一点。我相信使用工厂方法而不是构造函数来编写它会更清晰。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T09:39:32.013

```
public abstract class Parent implements Clonable{

  private Object peer;

  // Example 1 
  public Parent() {
    try {
      peer = this.clone();
    } catch (CloneNotSupportedException e) {
      e.printStackTrace();
    }
  }

  // Example 2
  public Parent(String name) {
    try {
      peer = this.getClass().getConstructor(String.class).newInstance(name);
    } catch (Exception e) {
      e.printStackTrace();
    }
  }
  } 

  public <T extends Parent> T getPeer() {
    return (T)peer;
  }
}

public class Child01 extends Parent { }

public class Child02 extends Parent { } 
```

看起来代码可能更简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T10:11:36.053

我首先要说我认为这可能是一个非常糟糕的设计。而且类名也不好，但我会坚持下去。

但是，一种处理方法：

```
public abstract class Parent {
    interface PeerFactory {
        Parent create(Parent peer);
    }
    private final Parent peer;

    protected Parent(Parent peer) {
        super();
        this.peer = peer;
    }
    protected Parent(PeerFactory peerFactory) {
        super();
        this.peer = peerFactory.create(this);
    }
}

public class Child1 extends parent {
    private static final PeerFactory peerFactory = new PeerFactory {
        public Parent create(Parent peer) {
            return new Child1(peer);
         }
    };
    public Child1() {
        super(peerFactory);
    } 
    private Child1(Peer peer) {
        super(peer);
    }   
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T08:09:03.180

像这样的东西：

```
public class Peer {
    public static abstract class Parent {
            private Parent peer;

            protected Parent(boolean needPeer) {
                    if (needPeer) {
                            try {
                                    peer = getClass().newInstance();
                            }
                            catch (Throwable e) {
                                    System.err.println(e);
                            }
                    }
            }

            public String getPeerClass() {
                    return peer.getClass().toString();
            }
    }

    public static class Child1 extends Parent {
            public Child1() {
                    this(false);
            }
            public Child1(boolean needPeer) {
                    super(needPeer);
            }
    }

    public static class Child2 extends Parent {
            public Child2() {
                    this(false);
            }
            public Child2(boolean needPeer) {
                    super(needPeer);
            }
    }

    public static void main(String[] args) {
            Parent p1 = new Child1(true);
            Parent p2 = new Child2(true);

            System.out.println(p1.getPeerClass());
            System.out.println(p2.getPeerClass());
    }
} 
```

这适用于默认构造函数，如果您想使用非默认构造函数构造一个新的对等点，则涉及更多技巧。请参阅类的 javadoc。

编辑：修复了无限递归:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T09:51:23.893

请注意，如果没有父类中的访问器，您将无法获取对等对象（您无法实例化 Parent），因此这种设计仅作为概念证明才有意义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T13:48:53.713

我建议用工厂模式替换整个事情，您可以完全控制添加对等点的内容，而不必在构造函数中执行此操作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-07-01T10:24:59.047

回答[列昂尼德库斯科夫的回答](https://stackoverflow.com/users/110046/leonid-kuskov)

您的示例 2 将始终抛出 StackOverflowException。我稍微摆弄了一下代码，下面是正确的实现。虽然感谢你给我指点那个方向。

```
public class AbstractClassDemo {

    public static void main(String[] args) {
        Child1 c1 = new Child1();
        System.out.println(c1.getPeer().getClass().getName());
    }

}

abstract class Parent {
    private Object peer;

    public Parent() {

    }

    public Parent(String s) {
        try {
            setPeer(this.getClass().getConstructor(String.class)
                    .newInstance(""));
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public Object getPeer() {
        return peer;
    }

    public void setPeer(Object peer) {
        this.peer = peer;
    }
}

class Child1 extends Parent implements Cloneable {
    public Child1() {
        super("Child1");
    }

    public Child1(String child1) {
    }
}

class Child2 extends Parent implements Cloneable {
    public Child2() {
        super("Child2");
    }

    public Child2(String child2) {
    }
} 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2012-05-27T09:35:53.677

```
public abstract class Parent implements Clonable {
  private Object peer;

  // Example 1 
  public Parent() {
    try {
      peer = this.clone();
    } catch (CloneNotSupportedException e) {
      e.printStackTrace();
    }
  }

  // Example 2
  public Parent(String name) {
    try {
      peer = this.getClass().getConstructor(String.class).newInstance(name);
    } catch (Exception e) {
      e.printStackTrace();
    }
  }

} 

public <T extends Parent> T getPeer() {
 return (T)peer;
}

public class Child01 extends Parent { }

public class Child02 extends Parent { } 
```

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2009-05-21T08:03:35.733

```
public abstract class Parent {

    private Parent peer;

    public Parent(Parent peer) {
        this.peer = peer;
    }

    public Parent(String someString) {
    }

}

public class Child1 extends parent {
    public Child1() {
        super(new Child1())
    }
}

public class Child2 extends parent {
    public Child2() {
        super(new Child2())
    }
} 
```

这是我能想到的最简单的方法。不过，您可能可以使用一些 java 反射 API 在父类中执行此操作（所以询问“this”引用它是什么类并构造该类型的新类。它可能无法工作，具体取决于 java 构造函数的工作方式。在 C++ 中，构造函数中的“this”指针与构造函数类的类型相同）

# java - 如何在 Web 服务请求之间发送用户名？

> ID：891831
> 
> 赞同：1
> 
> 时间：2009-05-21T08:02:53.160
> 
> 标签：java, web-services, oc4j

基本上问题是这样的：
有一个存储数据库过程，它将用户名作为参数并根据它生成一些 XML 数据。它由不安全的 Web 服务（我们称该 Web 服务 WSA）中没有参数的方法调用。还有另一个应该称为 WSA 的 Web 服务（我们称之为 WSB）。在此设置中，WSA 只应由 WSB 调用，而不能由其他任何人调用。WSB 是用户所称的，它是他们获取所需 XML 数据的方式。Web 服务部署在 OC4J 上，并且启用了安全性。WSB 由 OC4J 保护，并通过提供 OC4J 用户的用户名和密码来访问。
在测试 Web 服务时，OC4J 为您提供了一个表单，您可以在其中输入登录信息，然后再调用 Web 服务。如果您选择在标题中包含安全信息并在调用服务之前预览消息，则用户名和密码在消息中。
我的问题是我无法获取安全信息（或至少是用户名）来访问存储过程的端点实现和调用。到目前为止，我已经创建了 WSA，创建了一个引用它的 Web 服务代理，并基于该代理创建了 WSB。
到目前为止我为获取用户名所做的尝试（以及为什么它不起作用）：

1.  有了 WSA 工具`javax.xml.rpc.server.ServiceLifecycle`。这为 WSA 提供了一个 的实例`javax.xml.rpc.server.ServletEndpointContext`，它为我提供了一个`java.security.Principal`. 但是，`Principal`如果`null`我调用 WSB（后者又调用 WSA）。如果我保护 WSA 并直接调用它，`Pricipal`则不是 null 并且包含用户（但它不能解决问题，因为我需要调用 WSB，而不是 WSA）。

2.  为这两个服务创建了处理程序（扩展`javax.xml.rpc.handler.GenericHandler`），它们应该能够处理消息。有一件事让我很困惑。处理程序方法被正确调用 - WSB 处理程序处理请求，然后 WSA 处理程序处理请求，然后 WSA 处理程序处理响应，最后 WSB 处理程序处理响应。但是当我尝试在每一步将消息打印到文件时，我发现即使在第一步（当 WSB 处理请求时），消息中也没有安全信息。没有用户名，什么都没有。实际上，在调用服务之前预览请求消息时，该消息与调用页面上显示的消息完全不同。

3.  `WebServiceContext`尝试使用注释注入一个实例`@Resource`，但显然 OC4J 不支持这一点。

如果有人可以阐明我可能做错了什么，我将非常感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T15:11:57.490

问题是“WSA 是由不安全的 Web 服务中没有参数的方法调用的”。因此，WSA 没有安全上下文来从...中获取用户 ID。

最简单的解决方法可能是更改 WSA API 以接受请求参数中的用户 ID。

HTH 汤姆

# sql - 计算sql查询中的持续时间总和

> ID：891833
> 
> 赞同：7
> 
> 时间：2009-05-21T08:03:34.533
> 
> 标签：sql, oracle

我有一个表，它有两列开始时间和结束时间。我能够计算每一行的持续时间，但我也想获得总持续时间。这该怎么做。

谢谢

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-21T09:47:33.387

您的列的数据类型为 TIMESTAMP，如下所示：

```
SQL> create table mytable (start_time,end_time)
  2  as
  3  select to_timestamp('2009-05-01 12:34:56','yyyy-mm-dd hh24:mi:ss')
  4       , to_timestamp('2009-05-01 23:45:01','yyyy-mm-dd hh24:mi:ss')
  5    from dual
  6   union all
  7  select to_timestamp('2009-05-01 23:45:01','yyyy-mm-dd hh24:mi:ss')
  8       , to_timestamp('2009-05-02 01:23:45','yyyy-mm-dd hh24:mi:ss')
  9    from dual
 10   union all
 11  select to_timestamp('2009-05-01 07:00:00','yyyy-mm-dd hh24:mi:ss')
 12       , to_timestamp('2009-05-01 08:00:00','yyyy-mm-dd hh24:mi:ss')
 13    from dual
 14  /

Tabel is aangemaakt. 
```

从另一个时间戳中减去一个时间戳，得到一个 INTERVAL 数据类型：

```
SQL> select start_time
  2       , end_time
  3       , end_time - start_time time_difference
  4    from mytable
  5  /

START_TIME                     END_TIME                       TIME_DIFFERENCE
------------------------------ ------------------------------ ------------------------------
01-05-09 12:34:56,000000000    01-05-09 23:45:01,000000000    +000000000 11:10:05.000000000
01-05-09 23:45:01,000000000    02-05-09 01:23:45,000000000    +000000000 01:38:44.000000000
01-05-09 07:00:00,000000000    01-05-09 08:00:00,000000000    +000000000 01:00:00.000000000

3 rijen zijn geselecteerd. 
```

并且 INTERVAL 数据类型不能相加。这是一个烦人的限制：

```
SQL> select sum(end_time - start_time)
  2    from mytable
  3  /
select sum(end_time - start_time)
                    *
FOUT in regel 1:
.ORA-00932: inconsistente gegevenstypen: NUMBER verwacht, INTERVAL DAY TO SECOND gekregen 
```

为了规避这个限制，您可以用秒数进行转换和计算，如下所示：

```
SQL> select start_time
  2       , end_time
  3       , trunc(end_time) - trunc(start_time) days_difference
  4       , to_number(to_char(end_time,'sssss')) - to_number(to_char(start_time,'sssss')) seconds_difference
  5    from mytable
  6  /

START_TIME                     END_TIME                       DAYS_DIFFERENCE SECONDS_DIFFERENCE
------------------------------ ------------------------------ --------------- ------------------
01-05-09 12:34:56,000000000    01-05-09 23:45:01,000000000                  0              40205
01-05-09 23:45:01,000000000    02-05-09 01:23:45,000000000                  1             -80476
01-05-09 07:00:00,000000000    01-05-09 08:00:00,000000000                  0               3600

3 rijen zijn geselecteerd. 
```

然后它们是可以相加的正常 NUMBER

```
SQL> select sum
  2         (  86400 * (trunc(end_time) - trunc(start_time))
  3          + to_number(to_char(end_time,'sssss')) - to_number(to_char(start_time,'sssss'))
  4         ) total_time_difference
  5    from mytable
  6  /

TOTAL_TIME_DIFFERENCE
---------------------
                49729

1 rij is geselecteerd. 
```

如果您愿意，可以将此数字转换回 INTERVAL：

```
SQL> select numtodsinterval
  2         ( sum
  3           (  86400 * (trunc(end_time) - trunc(start_time))
  4            + to_number(to_char(end_time,'sssss')) - to_number(to_char(start_time,'sssss'))
  5           )
  6         , 'second'
  7         ) time_difference
  8    from mytable
  9  /

TIME_DIFFERENCE
------------------------------
+000000000 13:48:49.000000000

1 rij is geselecteerd. 
```

问候，罗布。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-10-19T10:06:50.553

Oracle 的这种方法很简单，但有点 hack：

```
select sum((end_timestamp+0) - (start_timestamp+0)) 
from your_table 
```

结果是天数（小时，分钟的小数部分，你知道的）。

我不知道 timestamp + 0 到底是做什么的；也许 ANSI 时间戳被转换为 Oracle 早期允许简单算术的时间戳类型。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-21T08:17:47.547

编辑：根据 Rob van Wijk 的出色回复，在求和之前添加了 trunc()。

要查找每行的持续时间：

```
select 
    end_date-start_date as DurationDays, 
    (end_date-start_date)*24 as DurationHours, 
    (end_date-start_date)*24*60 as DurationMinutes, 
    (end_date-start_date)*24*60*60 as DurationSeconds
from your_table 
```

要查找总持续时间：

```
select 
    sum(trunc(end_date-start_date)) as TotalDurationDays
from your_table 
```

要在一个查询中执行这两项操作：

```
select 
    end_date-start_date as DurationDays, 
    (select sum(trunc(end_date-start_date)) from your_table) as TotalDurationDays
from your_table 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T08:08:27.987

您可以使用此查询（它至少适用于 Oracle 数据库）：

```
select sum(end_date - start_date) from your_table 
```

# c# - 为什么 System/mscorlib 代码这么快？特别是对于循环？

> ID：891835
> 
> 赞同：4
> 
> 时间：2009-05-21T08:04:40.287
> 
> 标签：c#, performance, file-io, for-loop, bytearray

这只是我一直在研究的一个个人项目。基本上，我使用 StreamReader 解析一个文本文件（比如从 2​​0mb 到大约 1gb）。性能非常稳定，但仍然......我一直很想看看如果我用二进制解析它会发生什么。不要误会，我并没有过早地优化。我绝对是为了“看”而故意进行微优化。

所以，我正在使用字节数组读取文本文件。来看看，新行可以是（Windows）标准的 CR/LF 或 CR 或 LF ......相当混乱。我曾希望能够在 CR 上使用 Array.IndexOf，然后跳过 LF。相反，我发现自己编写的代码与 IndexOf 非常相似，但会检查其中任何一个并根据需要返回一个数组。

所以症结所在：使用与 IndexOf 非常相似的代码，我的代码最终仍然非常慢。使用 800mb 文件来透视它：

*   使用 IndexOf 并寻找 CR：~320mb/s
*   使用 StreamReader 和 ReadLine：~180mb/s
*   for 循环复制 IndexOf：~150mb/s

这是带有 for 循环的代码（~150mb/s）：

```
IEnumerator<byte[]> IEnumerable<byte[]>.GetEnumerator() {
    using(FileStream fs = new FileStream(_path, FileMode.Open, FileAccess.Read, FileShare.ReadWrite, _bufferSize)) {
        byte[] buffer = new byte[_bufferSize];
        int bytesRead;
        int overflowCount = 0;
        while((bytesRead = fs.Read(buffer, overflowCount, buffer.Length - overflowCount)) > 0) {
            int bufferLength = bytesRead + overflowCount;
            int lastPos = 0;
            for(int i = 0; i < bufferLength; i++) {
                if(buffer[i] == 13 || buffer[i] == 10) {
                    int length = i - lastPos;
                    if(length > 0) {
                        byte[] line = new byte[length];
                        Array.Copy(buffer, lastPos, line, 0, length);
                        yield return line;
                    }
                    lastPos = i + 1;
                }
            }
            if(lastPos > 0) {
                overflowCount = bufferLength - lastPos;
                Array.Copy(buffer, lastPos, buffer, 0, overflowCount);
            }
        }
    }
} 
```

这是更快的代码块（~320mb/s）：

```
while((bytesRead = fs.Read(buffer, overflowCount, buffer.Length - overflowCount)) > 0) {
    int bufferLength = bytesRead + overflowCount;
    int pos = 0;
    int lastPos = 0;
    while(pos < bufferLength && (pos = Array.IndexOf<byte>(buffer, 13, pos)) != -1) {
        int length = pos - lastPos;
        if(length > 0) {
            byte[] line = new byte[length];
            Array.Copy(buffer, lastPos, line, 0, length);
            yield return line;
        }
        if(pos < bufferLength - 1 && buffer[pos + 1] == 10)
            pos++;
        lastPos = ++pos;

    }
    if(lastPos > 0) {
        overflowCount = bufferLength - lastPos;
        Array.Copy(buffer, lastPos, buffer, 0, overflowCount);
    }
} 
```

（不，它还没有准备好生产，某些情况下它会爆炸；我使用 128kb 大小的缓冲区来忽略其中的大部分。）

所以我的大问题是......为什么 Array.IndexOf 工作得这么快？它本质上是相同的，一个 for 循环遍历一个数组。mscorlib 代码的执行方式有什么问题吗？即使将上面的代码更改为真正复制 IndexOf 并仅查找 CR，然后像使用 IndexOf 没有帮助时那样跳过 LF。Errr ...我一直在经历各种排列，而且已经太晚了，也许我错过了一些明显的错误？

顺便说一句，我查看了 ReadLine 并注意到它使用 switch 块而不是 if 块......当我做类似的事情时，奇怪的是它确实将性能提高了大约 15mb/s。这是另一个问题（为什么 switch 比 if 更快？）但我想我会指出我确实看过它。

此外，我正在测试 VS 之外的发布版本，因此没有进行调试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T08:57:49.790

mscorlib 文件是在安装过程中生成的。尝试使用 Ngen.exe 实用程序（我想与 .NET 框架一起提供）对您的文件进行 ngen 处理......然后检查基准。可以稍微快一点。

为了使您的 .NET 代码以接近本机的速度运行，Microsoft 建议您在应用安装期间“Ngen”您的代码...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T09:31:02.797

这是个好问题。简短的版本是，这一切都归结为 IndexOf 将使用的 IEqualityComparer 的实现。让我们看看下面的一段代码：

```
using System;
using System.Collections.Generic;
using System.Diagnostics;

class Program {

    static int [] buffer = new int [1024];
    const byte mark = 42;
    const int iterations = 10000;

    static void Main ()
    {
        buffer [buffer.Length -1] = mark;

        Console.WriteLine (EqualityComparer<int>.Default.GetType ());

        Console.WriteLine ("Custom:  {0}", Time (CustomIndexOf));
        Console.WriteLine ("Builtin: {0}", Time (ArrayIndexOf));
    }

    static TimeSpan Time (Action action)
    {
        var watch = new Stopwatch ();
        watch.Start ();
        for (int i = 0; i < iterations; i++)
            action ();
        watch.Stop ();
        return watch.Elapsed;
    }

    static void CustomIndexOf ()
    {
        for (int i = 0; i < buffer.Length; i++)
            if (buffer [i] == mark)
                break;
    }

    static void ArrayIndexOf ()
    {
        Array.IndexOf (buffer, mark);
    }
} 
```

您需要使用*csc /optimize+*对其进行编译。

这是我的结果：

```
C:\Tmp>test
System.Collections.Generic.GenericEqualityComparer`1[System.Int32]
Custom:  00:00:00.0386403
Builtin: 00:00:00.0427903 
```

现在，将数组和 EqualityComparer 的类型更改为字节，这是我得到的结果：

```
C:\Tmp>test
System.Collections.Generic.ByteEqualityComparer
Custom:  00:00:00.0387158
Builtin: 00:00:00.0165881 
```

如您所见，字节数组是特殊情况的，它可能经过优化以在字节数组中查找一个字节。由于我无法反编译 .net 框架，所以我在这里停止了分析，但我想这是一个很好的线索。

# .net - Feed转换服务（版本问题）

> ID：891841
> 
> 赞同：1
> 
> 时间：2009-05-21T08:06:21.640
> 
> 标签：.net, rss, feed

**[我已经使用SyndicationFeed](http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication.syndicationfeed.aspx)**为订阅源阅读制作了一个应用程序（为我自己），问题是它只支持 Atom 1.0 和 RSS 2.0。

我有一堆 RSS 0.92 版本的提要，所以......

所以我的问题是：是否有任何服务可用于将 RSS 0.92 转换为 RSS 2.0 或 Atom 1.0。有人告诉我应该使用[**feedburner**](http://feedburner.google.com)，但我找不到如何做到这一点。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T09:19:07.390

你应该可以用[Yahoo Pipes](http://pipes.yahoo.com)做到这一点。使用像[http://pipes.yahoo.com/pipes/pipe.edit?_id=PicO8ejT3BG6sr1Uy6ky6g](http://pipes.yahoo.com/pipes/pipe.edit?_id=PicO8ejT3BG6sr1Uy6ky6g)这样的普通管道，除了您的源提要是 RSS 0.92。无论哪种方式，您只需将所有内容通过管道输出，然后使用类似[http://pipes.yahoo.com/pipes/pipe.run?_id=PicO8ejT3BG6sr1Uy6ky6g&_render=rss&atom_feed_url=http%3A%2F%2Fexample.com%2Fatomfeed](http://pipes.yahoo.com/pipes/pipe.run?_id=PicO8ejT3BG6sr1Uy6ky6g&_render=rss&atom_feed_url=http%3A%2F%2Fexample.com%2Fatomfeed)的 URL （注意render=rss) 将其序列化回 RSS 2（或 Atom，如果您选择）。

[编辑：实际上， FeedBurner](http://feedburner.com)看起来可以很好地转换为 Atom。转到[http://feedburner.google.com/fb/a/myfeeds](http://feedburner.google.com/fb/a/myfeeds)，登录，您应该会看到一个框，上面写着“立即刻录提要”。输入 RSS .92 URL，然后您必须选择 FeedBurner 代码，例如 foo/bar。最后，您可以使用 Atom 网址，例如[http://feeds2.feedburner.com/foo/bar?format=xml](http://feeds2.feedburner.com/foo/bar?format=xml)。我还没有弄清楚如何使用 FeedBurner 转换为 RSS 2。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T08:32:49.340

像[FeedKiller](http://www.feedkiller.com/)这样的东西对你有用吗？

# design-patterns - 你有多少次重复使用你有史以来最可重复使用的组件？（你的）

> ID：891844
> 
> 赞同：0
> 
> 时间：2009-05-21T08:07:20.860
> 
> 标签：design-patterns, oop

如果您设计了一个工具包、一个应用程序或一个框架，请提及您使用的最可重用的组件、它的可移植性、您重用了多少次、有多少程序员与您一起工作以及花费了多少时间你发货。以及您在开发时应用的模式的名称。（大约当然）。

**编辑：澄清：**
我说的是你自己设计的组件。在提及您重复使用它的次数时，请尝试使用数字。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T21:12:27.593

I have reused NUnit quite a few times since I wrote it. I gather that several other people have since used it also.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T21:26:15.473

我有一个通用的 Makefile，几乎用于所有项目。它还具有用于对网站进行 tar-ing 并将其 scp-ing 到远程服务器/暂存服务器的部署选项。Makefiles，love-em，hate-em。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T08:11:57.947

1.  很多次 ？项目到项目。
2.  很多时候我使用别人设计的框架来节省我的时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T08:17:09.280

去年夏天我写了一个 Ruby 类，此后我在大约 8 个独特的项目中使用了它，包括原来的项目。我自己写的。它有一个或两个小时的全部讲述。

# c# - c# 中枚举的数据结构，其中查找通常基于所存储对象的一个 属性

> ID：891848
> 
> 赞同：1
> 
> 时间：2009-05-21T08:08:32.573
> 
> 标签：c#, data-structures, hashtable, hashcode

我想知道人们会推荐什么数据结构来执行以下操作。我有一个具有三个主要属性的类，例如。

```
public class Example {

  public Object One { get; }
  public Object Two { get; }
  public Object Three { get; }
} 
```

另一个类包含这些对象的集合，并且经常需要枚举这些对象，我主要使用 LINQ。很多时候，虽然我只需要主要基于属性 One 的值来查找/枚举这些对象的子集，所以我想做的是将这些对象存储在基于该属性的有效数据结构中。我可以执行以下操作：

```
Dictionary<Object,List<Example>> 
```

但这让我觉得效率很低，我知道我需要某种哈希表，但以前从未在 C# 中使用过，我不确定有什么用。

其他一些要求/注意事项：

*   所有对象都是不可变的，并且具有固定的哈希码，这些哈希码是根据类在构造函数中实例化的值计算得出的
*   必须能够在数据结构的同一个“槽”中存储多个具有相同值（以及因此哈希码）的属性 One 的项目
*   必须能够从集合中自由添加和删除对象

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T08:12:44.250

[索引 LINQ](http://www.codeplex.com/i4o)可能可以在这里为您提供帮助。它提供了一个内存集合，但允许您将对象的属性属性为可索引，以便它可以针对它们创建有效的查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-12T09:27:52.733

PowerCollections ( [http://www.codeplex.com/PowerCollections](http://www.codeplex.com/PowerCollections) ) 有一个 MultiDictionary 容器——也许你可以试试？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T08:57:23.690

或混合字典

# java - 在 Java 中 File.canExecute() 究竟做了什么？

> ID：891857
> 
> 赞同：4
> 
> 时间：2009-05-21T08:12:42.440
> 
> 标签：java, file, permissions, io

我创建了一个没有执行权限的普通文件，但是当我使用该文件的路径/名称创建一个 Java File 对象然后调用 File.canExecute() 时，结果为真，而我希望此方法调用返回错误的。有人可以解释我在这里缺少什么吗？

索拉里斯：

```
$ touch /tmp/nonexecutable
$ ls -l /tmp/nonexecutable
-rw-r--r--   1 root     root           0 May 21 07:48 /tmp/nonexecutable 
```

爪哇：

```
String pathName = "/tmp/nonexecutable";
File myFile = new File(pathName);
if (!myFile.canExecute())
{
    String errorMessage = "The file is not executable.";
    log.error(errorMessage);
    throw new RuntimeException(errorMessage);
} 
```

在此先感谢您的帮助。

- 詹姆士

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T08:26:21.197

与Java无关-您以root身份运行，并且无论权限如何，都允许root进行一切操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T08:23:36.817

虽然我不是专家，这不会正确回答您的问题，但我想补充一点，这种行为并非特定于 Java。从我的 Ubuntu 8.10 安装上的 find (GNU findutils) 4.4.0 手册页中，关于`-executable`标志：

> 匹配可执行文件和可搜索目录（在文件名解析意义上）。这考虑了`-perm` 测试忽略的访问控制列表和其他权限伪影。该测试使用 [`access(2)`](http://linux.die.net/man/2/access)系统调用，因此可能会被执行 UID 映射（或根压缩）的 NFS 服务器所欺骗，因为许多系统 `access(2)` 在客户端内核中实现，因此无法使用服务器上保存的 UID 映射信息. 因为这个测试只基于 `access(2)`系统调用的结果，**所以不能保证这个测试成功的文件实际上可以被执行**。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-23T09:30:05.993

这是一个在 JDK 上打开的错误：

[http://bugs.sun.com/bugdatabase/view_bug.do;jsessionid=8b833c54cb93d6c9cf416667dc02?bug_id=6379654](http://bugs.sun.com/bugdatabase/view_bug.do;jsessionid=8b833c54cb93d6c9cf416667dc02?bug_id=6379654)

结论是 File.canExecute() 简单地转换为对 access(path, X_OK) 的本机 posix 调用。以 root 身份运行时，Linux 会为该调用返回 false，solaris 会返回 true。

最后，该错误被关闭为Wont Fix！:)

# java - 将 PHP 代码连接到 Java 后端

> ID：891871
> 
> 赞同：7
> 
> 时间：2009-05-21T08:17:53.927
> 
> 标签：java, php, service, native, daemon

我正在实现一个网站，前端使用 PHP，后端使用 Java 服务。两部分如下：

1.  PHP 前端监听 http 请求并与数据库交互。

2.  Java 后端持续运行并响应来自前端的调用。

更具体地说，后端是一个守护进程，它连接并维护与多个 IM 服务（AOL、MSN、Yahoo、Jabber...）的链接。

这两层将部署在同一个系统上（我想是 CentOS 机器），引入中间层（例如：使用 XML-RPC）会降低性能（资源也相当有限）。

问题：有没有办法直接链接两个层？（两者之间没有更多的网络服务）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-21T08:37:47.227

由于这是两个独立运行进程之间的通信，因此不可能进行“直接”调用（如在[JNI中）。](http://en.wikipedia.org/wiki/Java_Native_Interface)进行这种进程间通信的最简单方法可能是[命名管道](http://en.wikipedia.org/wiki/Named_pipe)和网络套接字。在这两种情况下，您都必须定义一个通信协议并在双方实现它。使用诸如 XML-RPC 之类的标准协议使这更容易，但并非绝对必要。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-21T12:29:18.630

应用程序集成通常有四种模式：

1.  通过文件系统，即。一个生产者将数据写入消费者监控的目录
2.  通过数据库，即。两个应用程序共享一个模式或表并使用它来交换数据
3.  通过 RMI/RPC/web 服务/任何阻塞，将调用从一个应用程序同步到另一个应用程序。对于 PHP 到 Java，您可以从上面列出的各种集成库中进行选择，或者使用一些 Web 服务标准，例如 SOAP。
4.  通过消息传递/任何非阻塞、异步操作，其中一个应用程序向另一个应用程序发送消息。

这些模式中的每一个都有优点和缺点，但一个好的经验法则是选择具有最松散耦合的模式，你可以摆脱它。例如，如果您选择#4，您的 Java 应用程序可能会崩溃，而不会同时关闭您的 PHP 应用程序。

在查看此处答案中列出的特定库或技术之前，我建议您为自己选择正确的模式，然后调查您的特定选项。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-21T09:06:26.637

我已经尝试过 PHP-Java 桥（php-java-bridge.sourceforge.net/pjb/），它工作得很好。基本上，我们需要运行一个 jar 文件（JavaBridge.jar）来监听端口（有几个可用的选项，如本地套接字、8080 端口等）。您的 java 类文件必须可用于类路径中的 JavaBridge。您需要在您的 php 中包含一个文件 Java.inc 并且您可以访问 Java 类。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-21T11:58:18.227

当然，有很多方法，但你说的资源有限......

恕我直言，定义您自己的轻量级类 RPC 协议并使用 TCP/IP 上的套接字进行通信。实际上，在这种情况下，不需要使用 RPC 等的全部优势......您只需要为这种特殊情况定义 API 并在双方都实现它。在这种情况下，您可以将数据包序列化为非常小的。您甚至可以为您的远程方法分配一种 GUID，并使用它们来节省流量并加速您的互通。

使用套接字的优点是您的解决方案将具有相当大的可扩展性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-29T22:52:17.463

我最近也面临这个问题。上面的 Resin 解决方案实际上是沿 JRuby、Jython 和 Rhino 的路线用 Java 完全重写 PHP。它被称为栎树。但我猜你和我一样，扔掉你的 Apache/PHP 设置并不是一个真正的选择。

此外，Quercus 还存在更多问题：免费版本是 GPL，如果您正在开发商业软件，这会很棘手（虽然不像 Resin 希望您相信的那样棘手（但 IANAL）），而且最重要的是免费版本不支持编译为字节码，所以它基本上是一个用 Java 编写的解释器。

我最终决定只是通过 HTTP 交换简单的消息。我使用 PHP 的`json_encode()`/`json_decode()`和 Java 的[json-lib](http://json-lib.sourceforge.net/)将消息编码为 JSON（简单、基于文本、非常适合数据模型）。

另一个有趣且轻量级的选项是让 Java 生成 PHP 代码，然后使用 PHP include() 指令通过 HTTP 获取并执行它。我还没有尝试过这个。

如果它是您关心的实际 HTTP 调用（出于性能考虑），那么这些解决方案都无济于事。我只能说我在同一个 LAN 上没有遇到 PHP 和 Java 的问题。我的感觉是，只要您保持您的 RPC 调用相当粗略（无论如何您都应该这样做），这对于绝大多数应用程序来说都不是问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-21T08:33:14.207

您可以尝试[PHP/Java 集成](http://www.php.net/manual/en/book.java.php)。

此外，如果通信是单向的（例如“发送 IM 邮件”），您可以将 PHP 请求写入文件并在 Java 应用程序中对其进行监控。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-21T12:34:47.217

抱歉，这是一个快速的回答，但是：我听说 Resin 应用服务器支持集成 java 和 PHP。

他们声称他们可以一起粉碎 php 和 java：http: [//www.caucho.com/resin-3.0/quercus/](http://www.caucho.com/resin-3.0/quercus/)

我使用resin 为J2ee 应用程序提供服务，但不是为了它的PHP 支持。

我很想听听这样的冒险。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-21T15:56:53.220

为什么不使用网络服务？

创建一个 Java 层并放置一个 ws 访问（Axis、SpringWS 等），然后 Php 使用一个 ws 客户端访问 Java 层。

我认为它简单而有用。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-05-21T08:38:41.200

我遇到了这个页面，它介绍了一种链接两个层的方法。但是，它仍然需要一个中间层（TCP/IP）。此外，其他服务也可以利用 Java 服务，因为它接受所有传入连接。

[http://www.devx.com/Java/Article/20509](http://www.devx.com/Java/Article/20509)

[研究中……]

# excel - 如何阅读 xml 电子表格

> ID：891873
> 
> 赞同：0
> 
> 时间：2009-05-21T08:19:06.577
> 
> 标签：excel, connection-string, jet, xml-spreadsheet

我有一个生成 xml 电子表格 (*.xls) 的第 3 方工具。我有另一个程序可以读取此电子表格并对其进行处理。生成的 xml 电子表格的内容是一个有 5 列的表，我的程序对它们运行选择查询。打开与生成的电子表格的连接时遇到问题。它说“{”外部表不是预期的格式。“}”。我的连接字符串是 "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + excelFileName + ";Extended Properties=\"Excel 8.0;HDR=YES;\""; 我需要对此字符串进行任何更改吗？我尝试使用数据集并调用 dataSet.ReadXml(excelFileName); 但数据集不包含我的表。关于如何读取 xml 电子表格的任何输入？

谢谢你的时间，CS

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T08:56:26.610

看起来您的连接字符串是为较旧的二进制格式 Excel 文件设置的。您需要一个不同的 XML 连接字符串。如果您正在谈论新的 Excel 2007 xml 文件，那么您需要这个[连接字符串](http://www.connectionstrings.com/excel-2007)：

```
Provider=Microsoft.ACE.OLEDB.12.0;Data Source=c:\myFolder\myExcel2007file.xlsx;Extended Properties="Excel 12.0 Xml;HDR=YES"; 
```

如果您谈论的是 Excel 2003 中的旧 xml 格式，那么我不确定是否存在连接字符串。在这种情况下，最好的办法是在 Excel 中打开，然后另存为 xls 文件，并使用您最初使用的连接字符串。

顺便说一句，[ConnectionStrings.com](http://www.connectionstrings.com)是查找访问所有不同类型数据可能需要的任何旧连接字符串的好地方。

另请注意，正如其他人所指出的，如果它是一个 xml 文件，它不应该有 xls 文件扩展名，它应该是 .xml 或 .xlsx。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-09T15:15:08.947

```
 Excel.Workbook wb1;

            Excel.Application wb2 = new Excel.Application();

            wb2.DisplayAlerts = false;
                           wb1 = (Excel.Workbook)wb2.Workbooks._Open(filename);

            if (wb1.FileFormat == Excel.XlFileFormat.xlXMLSpreadsheet)
            {
                                    wb1.SaveAs(filename, Excel.XlFileFormat.xlExcel12, Type.Missing, Type.Missing,
                        false, false, Excel.XlSaveAsAccessMode.xlNoChange,
                       Excel.XlSaveConflictResolution.xlOtherSessionChanges, false);
            }
            else
            {
                wb2.Workbooks.Close();

            } 
```

您可以将 Excel 电子表格转换为 2007 格式，然后使用 LinQ 使用任何开源提供程序或 OleDB 查询工作表。

# idatareader - idatareader 问题

> ID：891877
> 
> 赞同：0
> 
> 时间：2009-05-21T08:21:13.017
> 
> 标签：idatareader

为什么我的 idatareader 出错.....？

```
 byteSize = _reader.GetBytes(_reader.GetOrdinal(sFieldName), 0, null, 0, 0); 
```

我想从这里的数据库中检索图像**sFieldName**是数据库列名称......它告诉我**指定的转换无效。**消息......我在做什么？在 C# 窗口 vs05 上工作......

**sFieldName**是一个字符串 ....它是数据库的列名，列类型是**image** 我的数据库列名是“BoardImage”

sFieldName="BoardImage"

```
 oBoardDetail.BoardImage =oReader.GetImage("BoardImage"); 
```

这里**oBoardDetail**是一个类对象，**BoardImage**是一个类属性类型**Image**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-21T08:49:32.333

很可能， sFieldname 列不是 Image 或 VarBinary 列。

请更新有关数据库系统、表结构、选择语句的缺失信息。

# php - 居中 div 不能正常工作

> ID：891884
> 
> 赞同：1
> 
> 时间：2009-05-21T08:23:41.060
> 
> 标签：php, css, html

我一直在寻找解决方案，并尝试实施经常建议的内容，但我无法将一个 div 水平居中于另一个 div 中。

使用我的 CMS，我想在页面底部显示最多四个信息块。所以，我试图在两个容器 div 中放置零到四个 div。四个 div 的宽度分别为可用宽度的 19%、33% 或 49%，具体取决于页面上显示的 div 数量。内容器应该在外容器内水平居中。因此，最多四个 div 的组当然应该在水平中心结束。由于内部容器与主要内容的宽度相同，加上其上方的两列居中，因此它应该垂直排列。外部容器占据整个页面宽度并具有背景图像。

我的代码现在如下：

```
<!-- BEGIN USER MODULES -->
<tr>
  <td align="left" valign="top">

    <?php if ( $this->countModules( 'user1 and user2' ) || $this->countModules( 'user1 and user3' ) || $this->countModules( 'user1 and user4' ) || $this->countModules( 'user2 and user3' ) || $this->countModules( 'user2 and user4' ) || $this->countModules( 'user3 and user4' ) ) : ?>
        <style type="text/css">#user1, #user2, #user3, #user4 { width:49%; }</style>
    <?php endif; ?>
    <?php if ( $this->countModules( 'user1 and user2 and user3' ) || $this->countModules( 'user1 and user2 and user4' ) || $this->countModules( 'user1 and user3 and user4' ) || $this->countModules( 'user2 and user3 and user4' ) ) : ?>
        <style type="text/css">#user1, #user2, #user3, #user4 { width:33%; }</style>
    <?php endif; ?>
    <?php if ( $this->countModules( 'user1 and user2 and user3 and user4' ) ) : ?>
        <style type="text/css">#user1, #user2, #user3, #user4 { width:19%; }</style>
    <?php endif; ?>

    <?php if ($this->countModules( 'user1 or user2 or user3 or user4' )) : ?><div id="wrap1234"><div id="user1234">
        <?php if($this->countModules('user1')) : ?><div id="user1" class="module_bc"><jdoc:include type="modules" name="user1" style="xhtml" /></div><?php endif; ?>
        <?php if($this->countModules('user2')) : ?><div id="user2" class="module_bc"><jdoc:include type="modules" name="user2" style="xhtml" /></div><?php endif; ?>
        <?php if($this->countModules('user3')) : ?><div id="user3" class="module_bc"><jdoc:include type="modules" name="user3" style="xhtml" /></div><?php endif; ?>
        <?php if($this->countModules('user4')) : ?><div id="user4" class="module_bc"><jdoc:include type="modules" name="user4" style="xhtml" /></div><?php endif; ?>
    </div><div class="clear"></div></div><?php endif; ?>

    </td>
</tr> 
```

在我的样式表中，我有这个：

```
#wrap1234 { background:transparent url(images/header_bg.png) no-repeat scroll 0 0; border-bottom:1px solid #444444; border-top:1px solid #444444; margin:25px 0 10px; padding:5px 0; text-align:center; align:center;}

#user1234 { width:1420px; margin-left:auto; margin-right:auto; }

#user1, #user2, #user3, #user4 { float:left; margin:5px 0; padding:5px 0; text-align:left; } 
```

放置所有这些的表和正文如下所示，跳过了直接分层线之外的所有内容：

```
<body><div id="wrapper_main"><center><table border="0" cellpadding="0" cellspacing="0" width="<?php echo $this->params->get('width'); ?>" id="main_table"><tbody> 
```

正文和表格的CSS如下。使用 Firebug，我在其中找不到任何在关闭时会产生影响的东西。

```
html, body, form, fieldset{margin:0; padding:0;}
body {background:#222222 none repeat scroll 0 0; color:#777777; font-family:Helvetica,Tahoma,sans-serif; font-size:0.72em; height:100%; text-align:center;}
#wrapper_main {background:#FFFFFF url(images/wrapper_main_bg.gif) repeat-x scroll left top; border-bottom:2px solid #CCCCCC; padding-bottom:20px; position:relative; width:100%; z-index:1;}
td, div {font-size:100%;} 
```

实际页面可在我的开发站点 jldev dot joomlaloft.com 上找到。

正如你所看到的，我已经给内部容器一个固定的宽度以及左右边距自动，这通常被建议作为水平居中 div 的方式。但是，其中包含 div 的内部容器最终左对齐。

这可以工作吗？或者，我应该尝试替代方案，例如在最左边和最右边的信息块 div 上放置一个左右可变边距？

我已经看到 stackoverflow 上有很多非常好的答案，所以我希望有人能够告诉我哪里出错了。因为它是我没有灵感......在此先感谢您提供的任何帮助！

PS 顺便说一句，这一定是我见过的最直观、最实用的论坛之一！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T09:53:21.643

我不确定你为什么要使用 width:1420px 。请关注[这个](http://www.intensivstation.ch/en/templates/)或[这个](http://layouts.ironmyers.com/)站点以获取适当的 css 布局教程。另一种选择是使用[css grid](http://960.gs)。

我个人建议，将表格取出并切换到流体网格，这将最适合您的站点。它有一点学习曲线，但相信我，以后你会更快乐。在您的网站上完成了很多工作；尽管 CSS 可以改得更好。如果您需要即时帮助，CSS freenode 通常会提供很好的建议和批评。

还有一点，不建议在同一个标​​签中使用width和margin

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T11:55:11.757

内部居中的 div 不能比它包含的 div 更宽。在我的浏览器中，您的网站是 1200 像素宽，#user1234 是 1420 像素；

将#user1234 设置为宽度：90%；并且每个用户 div 到宽度：25%；当有 4 个 div 时。把溢出：隐藏；在#user1234 上清除浮动。

它看起来不像 #user1234 div 居中，因为 #user4 div 文本没有填充可用空间。放背景色：#c00; 在#user1234 上查看它的边界在哪里。（注意：你必须有 overflow:hidden 否则#user1234 没有高度，你不会看到背景颜色）。

回复：以前的评论 - 在同一标签上使用宽度和边距没有问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T08:45:37.053

当我想让一个 DIV 居中时，我所做的就是相对定位它。将 left 设置为 50% 并将 margin-left 设置为 div 宽度的 1/2 将使 div 在容器中完美居中。我过去使用过它，据我所知，它适用于大多数浏览器（IE6+ 和非 IE 浏览器）。尽管可能有更好的方法来做到这一点。

```
#user1234 { position: relative; 
            left: 50%;
            margin-left: -710px;
            width:1420px;} 
```

# iphone - 图像创建功能中的内存泄漏

> ID：891886
> 
> 赞同：2
> 
> 时间：2009-05-21T08:24:22.633
> 
> 标签：iphone, graphics, memory-leaks, uiimage

我目前正在开发一款 iPhone 游戏，需要即时创建一些动画。动画是基于多张图片，由于图片组合的范围太大，无法预先创建所有的序列，我希望能够在每次情况发生变化时重新计算一组图像。

该函数创建一系列图像，用作动画序列。我需要两件事的帮助：

1.  有几个大的内存泄漏我很难找到 - 我需要帮助来定位它们
2.  由于我是iPhone的新手，我想知道是否有更好的方法来做到这一点，如果您对如何编写它有更好的建议，请分享...

代码：

```
(void) updateImages:(int) smallPicID
{
    CGRect smallPicRect;
    smallPicRect.size = CGSizeMake(25.0f, 25.0f);

    //TODO: add smallPic location for every image. Currently the values only match the first image...
    static const CGPoint smallPicLocation[11][SMALLPIC_LOCATION_COUNT] = 
    {
        { {126.0f, 153.0f},{105.0f, 176.0f}, {115.0f, 205.0f}, {145.0f, 211.0f}, {166.0f, 188.0f}, {156.0f, 159.0f} },
        { {183.0f, 91.0f}, {201.0f, 97.0f}, {205.0f, 115.0f}, {191.0f, 127.0f}, {173.0f, 122.0f}, {169.0f, 124.0f} },
        { {183.0f, 91.0f}, {201.0f, 97.0f}, {205.0f, 115.0f}, {191.0f, 127.0f}, {173.0f, 122.0f}, {169.0f, 124.0f} },
        { {183.0f, 91.0f}, {201.0f, 97.0f}, {205.0f, 115.0f}, {191.0f, 127.0f}, {173.0f, 122.0f}, {169.0f, 124.0f} },
        { {183.0f, 91.0f}, {201.0f, 97.0f}, {205.0f, 115.0f}, {191.0f, 127.0f}, {173.0f, 122.0f}, {169.0f, 124.0f} },
        { {183.0f, 91.0f}, {201.0f, 97.0f}, {205.0f, 115.0f}, {191.0f, 127.0f}, {173.0f, 122.0f}, {169.0f, 124.0f} },
        { {183.0f, 91.0f}, {201.0f, 97.0f}, {205.0f, 115.0f}, {191.0f, 127.0f}, {173.0f, 122.0f}, {169.0f, 124.0f} },
        { {183.0f, 91.0f}, {201.0f, 97.0f}, {205.0f, 115.0f}, {191.0f, 127.0f}, {173.0f, 122.0f}, {169.0f, 124.0f} },
        { {183.0f, 91.0f}, {201.0f, 97.0f}, {205.0f, 115.0f}, {191.0f, 127.0f}, {173.0f, 122.0f}, {169.0f, 124.0f} },
        { {183.0f, 91.0f}, {201.0f, 97.0f}, {205.0f, 115.0f}, {191.0f, 127.0f}, {173.0f, 122.0f}, {169.0f, 124.0f} },
        { {183.0f, 91.0f}, {201.0f, 97.0f}, {205.0f, 115.0f}, {191.0f, 127.0f}, {173.0f, 122.0f}, {169.0f, 124.0f} }
    };

    for(int i = 0; i < self.m_finalImages.count; ++i)
    {
        // start with base image
        UIImage * baseImg = [self.m_finalImagesEmpty objectAtIndex:i];
        CGImageRef baseImgCtx = baseImg.CGImage;

        // Create the bitmap context that matches the baseImg parameters
        CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();
        CGContextRef newImgCtx = CGBitmapContextCreate(NULL, 
                                                       CGImageGetWidth(baseImgCtx), 
                                                       CGImageGetHeight(baseImgCtx), 
                                                       8, 0, colorSpace, 
                                                       (kCGBitmapByteOrder32Little | kCGImageAlphaPremultipliedFirst));
        CGColorSpaceRelease(colorSpace); 

        if (newImgCtx == NULL) 
        { 
            // error creating context
            assert(0);
            return;
        }

        // Get empty drum image width, height.
        size_t w = CGImageGetWidth(baseImgCtx);
        size_t h = CGImageGetHeight(baseImgCtx);
        CGRect rect = {{0,0},{w,h}}; 

        // Draw the image to the bitmap context.
        // newImgCtx now contains the full empty drum image.
        CGContextDrawImage(newImgCtx, rect, baseImgCtx); 

        CGContextSaveGState(newImgCtx);
        // translate & scale because of origin difference between UIKit and CG
        CGContextTranslateCTM(newImgCtx, 0, h);
        CGContextScaleCTM(newImgCtx, 1, -1);

        int startLocation = 0;
        int endLocation = SMALLPIC_LOCATION_COUNT;

        // for each location
        for(int j = startLocation; j < endLocation; j++)
        {
            // if its empty, nothing to do, move to next bullet
            if (m_locationStatus[j] == CY_EMPTY)
                continue;

            UIImage * srcImg;
            switch (m_locationStatus[j]) 
            {
                case CY_FULL: srcImg = [self.m_finalImagesLoaded objectAtIndex:i];  break;
                case CY_USED:  srcImg = [self.m_finalImagesSpent objectAtIndex:i];  break;
            }

            // create small image containing only the smallpic from the src img
            smallPicRect.origin = smallPicLocation[i][j];
            CGImageRef smallpicCGImg = CGImageCreateWithImageInRect(srcImg.CGImage, smallPicRect);

            // draw the smallpic into the new context
            CGContextDrawImage(newImgCtx, smallPicRect, smallpicCGImg);         

            CGImageRelease(smallpicCGImg);
        }

        CGContextRestoreGState(newImgCtx);

        // update the image from the context
        UIImage *baseImg = [self.m_finalImages objectAtIndex:i];
        CGImageRef imgref = CGBitmapContextCreateImage(newImgCtx);
        //[baseImg release];
        [baseImg initWithCGImage:imgref];

        CGContextRelease(newImgCtx);
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T13:13:39.867

我首先想到的是在末尾附近使用 CGBitmapContextCreateImage() 创建 imgref，但没有匹配的 CGImageRelease()，以及 baseImg initWithCGImage: 消息除了消耗内存什么都不做。我认为您想用以下内容替换以“从上下文更新图像”开头的部分：

```
CGImageRef imgref = CGBitmapContextCreateImage(newImgCtx);
UIImage *replacmentBaseImg = [[UIImage alloc] initWithCGImage:imgref];
CGImageRelease(imgref);

[self.m_finalImages replaceObjectAtIndex:i withObject:replacementBaseImg];
[replacementBaseImg release];

CGContextRelease(newImgCtx); 
```

这假设 m_finalImages 是一个 NSMutableArray 并且您已正确释放已插入该数组中的其他图像，因此当您替换它们时它们会被释放。

在更大的结构上，您可能希望将较小的子图像绘制到单独的 CALayer 中，然后在各个位置将这些层交换进出屏幕以完成动画。Quartz 绘图很昂贵，而 CALayers 是作为纹理存储在 GPU 上的缓存图像。其他人使用 CALayers 执行了这些基于精灵的动画，并取得了令人印象深刻的性能。

# javascript - Javascript 正则表达式 - 为什么它在 IE 上没有按预期工作？

> ID：891889
> 
> 赞同：1
> 
> 时间：2009-05-21T08:25:00.840
> 
> 标签：javascript, regex

在失去太多睡眠后，我仍然无法弄清楚：

下面的代码（它是对仅显示问题的较大代码的简化）在 FF 上标识了 Item1 和 Item2，但在 IE7 上没有。我一无所知。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
</head>

<body>
<table><tr>
<td><img src=imgs/site/trash.jpg border=1></td><td><font style="">Item1</font></td>
<td><img src=imgs/site/trash.jpg border=1></td><td><font style="">Item2</font></td>
</tr></table>

<script type="text/javascript">
    var _pattern =/trash.*?<font.*?>(.*)<\/font>/gim;
    alert (_pattern);

    var thtml = document.documentElement.innerHTML;
    alert (thtml);
    while ( _match =_pattern.exec(thtml)){
        alert (_match[1]);

    }

</script>

</body>
</html> 
```

注释： 1\. 我知道有更好的方法来获取 Item1 和 Item2。这个例子是为了以最简单的方式展示我面临的正则表达式问题。2.当我删除表格和 /table 标签时，它可以工作。

提前致谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-21T08:42:18.620

说真的，这太可怕了。基于 getElementById / getElementsByTagName 的解决方案将*更加*可靠和灵活。

至于实际问题，可能是因为**javascript 多行正则表达式支持不是 x 浏览器安全**的，尤其是 IE 存在问题。删除表声明可能会强制 IE 在内部将剩余的标记格式化为单行（=成功），在其中添加它会使 IE 添加回车等（=失败）。

我知道您确实说过您知道有更好的方法，但是您没有解释为什么要坚持这样做。依赖正则表达式并进一步依赖 DOM 的 IE 明文解释会让你陷入这样的问题。不要这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T09:03:39.030

问题是 JScripts 多行实现是错误的。它不允许任何 char 。匹配换行符。

请改用此正则表达式：-

```
 var _pattern = /trash[\s\S]*?<font[^>]*>([^<]*)<\/font>/gi; 
```

这消除了 . 总的来说，注意 [\s\S] 是等效的，但会匹配一个新行。

删除表格改变的原因是 IE 的 .innerHTML 实现不依赖于收到的原始标记。相反，标记是通过检查 DOM 动态创建的。当它看到一个表格元素时，它会将换行符放在输出中的不同位置，而不是表格丢失时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T08:54:49.047

结尾的 td 标记有一个需要转义的字符：/ 斜杠。我不知道这是否是 IE7 跳闸的原因。经过测试，Safari 没问题。

您可能需要考虑向表中添加一个 id。然后只遍历表的子节点。您将在更大的页面上浏览更少的 HTML，并且还可能节省内存。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-21T08:48:44.473

尝试使用 构建您的正则表达式`new RegExp("", "gim")`。它更便携。

# windows - 增加 Run MRU 列表中的项目数量

> ID：891894
> 
> 赞同：8
> 
> 时间：2009-05-21T08:28:01.707
> 
> 标签：windows, registry

我正在尝试增加 Run MRU 列表中显示的项目数。有问题的注册表项是

```
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU 
```

相关值是 MRUList。据我所知，最大值为 26，值为 az。

我尝试使用名称的符号和数字（例如 1、#、+）添加值，并将它们添加到 MRUList 值，但无济于事。

有任何想法吗？

（使用外部启动程序是不可能的）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T08:46:19.580

不，限制是固定的，您不能使用超过 26 个条目。您将不得不使用另一种方式，例如外部程序 - 那么为什么这对您来说是个坏主意呢？我敢肯定，您甚至可以将启动器插入到运行命令附近的开始菜单中，并且它们的外观几乎相同 - 如果没有，您可以随时编写自己的启动器。

# python - 字符串和文件

> ID：891895
> 
> 赞同：2
> 
> 时间：2009-05-21T08:28:20.303
> 
> 标签：python, string

假设这是我的语言列表。

```
aList = ['Python','C','C++','Java'] 
```

我如何写入文件，例如：

```
Python      : ...
C           : ...
C++         : ...
Java        : ... 
```

我已经使用 rjust() 来实现这一点。没有它我该怎么办？

在这里我已经手动完成了。我想**避免**这种情况，即；它应该**自动订购**。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T08:29:38.210

您可以使用[字符串格式化](http://www.python.org/doc/2.5.2/lib/typesseq-strings.html)运算符来做到这一点

```
f=open('filename.txt','w')
for item in aList:
    print >>f, "%-20s : ..." % item 
```

20 是字段宽度，而“-”表示左对齐。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-21T08:33:24.550

你是这个意思吗？

```
>>> languages = ['Python','C','C++','Java']
>>> f = open('myfile.txt', 'w')
>>> print('\n'.join('%-10s: ...' % l for l in languages), file=f)
>>> f.close()
>>> print(open('myfile.txt').read())
Python    : ...
C         : ...
C++       : ...
Java      : ... 
```

这使用[格式规范迷你语言](http://docs.python.org/3.0/library/string.html#format-specification-mini-language)。注意[print](http://docs.python.org/3.0/library/functions.html#print)语句使用 3.0 语法。（是的，自从[布赖恩的](https://stackoverflow.com/questions/891895/strings-and-file/891897#891897)回答链接到 2.5.2 文档后，我改变了这一点。只是为了对比。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T10:13:19.123

自动确定冒号位置（使用最大宽度）和语言顺序（按字母顺序排序）：

```
languages = ['Python','C','C++','Java']
maxlen = max(map(len, languages))
with open('langs.txt', 'w') as f:
    for L in sorted(languages):
        f.write('%-*s: ...\n'% (maxlen, L)) 

print open('langs.txt').read() 
```

输出：

```
C     : ...
C++   : ...
Java  : ...
Python: ... 
```

# reporting-services - SSRS 2008 中的动态子报表

> ID：891898
> 
> 赞同：1
> 
> 时间：2009-05-21T08:30:13.887
> 
> 标签：reporting-services, subreport

我想在 SSRS 中设置一个仪表板报告，其中包含一堆子报告，但显示的报告可以在运行时进行配置。

IE 可能有 4 个参数代表 4 个报告的名称。报告包含 4 个报告，每个子报告的名称应取自其中一个参数。

看起来我不能这样做，因为“将此报告用作子报告”属性是一个下拉列表，并且不提供将其配置为表达式的方法。

我对吗？

谢谢，丰富

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-15T13:51:28.193

我认为您的方案只是一次显示一个。我需要做几乎同样的事情。我有一个主报告，我希望在其中显示动态数量的不同子项。我是这样解决的：

*   带有包含子报表 (SubMain) 的 tablix 的主报表 (Main)，Main 的数据集传递 id、subid 和子类型。SubMain 没有数据集。
*   直接在 SubMain 中，我添加了所有具有自己数据集的子 (SubDetail)。然后我根据类型设置 SubDetails 的可见性。/埃里克

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T15:08:28.950

通常，您必须在主报表中定义每个子报表，然后设置可见性。或者使用钻取来模拟导航。

# c# - 有什么可以替换 AbsolutePath.Contains 的吗？

> ID：891899
> 
> 赞同：0
> 
> 时间：2009-05-21T08:30:20.360
> 
> 标签：c#, uri

我有一个 Uri，其中包含我放入 if 块的路径的一部分。它就像

```
if (absUri.AbsolutePath.Contains("W3C//DTD%20XHTML%201.1//EN")) 
```

我想用更可靠和健壮的东西替换 .Contains 部分，就好像在 //EN 之后有一段字符串，即使这样也能满足 if 块。整个路径是这样的：C:/Users/a/desktop/fol/W3C//DTD%20XHTML%201.1//EN。有什么方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T08:37:22.217

我想我正在寻找类似 .EndsWith 的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T08:33:13.850

好吧，“//EN”之后是否有内容无关紧要，因为字符串仍将包含您的搜索词。

您提到您想要更可靠和更强大的东西，那么您看到了什么问题？

正如您已经意识到的那样`.EndsWith`，如果在“//EN”之后有任何内容或者如果情况有所不同，则会失败，但我认为它不会比`.Contains`. 事实上，我希望它们彼此一样可靠。

# iphone - iPhone - 创建加载视图

> ID：891900
> 
> 赞同：2
> 
> 时间：2009-05-21T08:30:57.147
> 
> 标签：iphone, uiview, uiviewcontroller, uitabbarcontroller

当应用程序位于一个视图控制器中时，我想添加一个视图来模拟当我单击标签栏控制器以打开另一个视图控制器时正在加载数据。示例：当我的应用程序位于记录器视图中时，我希望它在更改为记录文件列表（可能需要一些时间才能加载）时显示加载视图（带有活动指示器的视图）。我已经尝试使用 viewWillDisappear 事件来操作它，但我无法让它工作 - 在 vi​​ewDidAppear 事件发生之后，之前没有添加视图。

有人对此有任何想法吗？谢谢

* * *

感谢你的回复。我试着按照你的建议做，但我仍然无法让它在我想要的时候显示出来。我尝试在 viewWillDisappear-event 中设置 hidden = NO，但在该视图控制器消失并且下一个出现之前它没有显示

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T08:54:33.883

现在听起来你有一个占据整个屏幕的 UITabBarController。我要做的是将加载视图放在 TabBarController 上方，并在不需要时将其隐藏。我会在您的标签栏控制器来自的同一个 xib 中创建 loadingViewController 的子类（或者如果您愿意，可以通过编程方式）并将其设置为 App Delegate 的 IBOutlet。

像这样的东西：

```
//In your App Delegate
- (void)applicationDidFinishLaunching:(UIApplication *)application {
    [window addSubview:tabBarController.view];
        loadingView.hidden = YES;
    [window insertSubview:loadingViewController.view aboveSubview:abBarController.view];
        [window makeKeyAndVisible];
}

//In your loading View Controller
- (void) setLoadingViewHidden:(BOOL)hidden {
        self.view.hidden = hidden;
        self.activityIndicator.animating = hidden;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-27T10:28:12.670

我过去这样做的方式是拥有一个内容视图，其中包含活动视图或适当的视图。

在视图控制器的 nib 中，不要将子视图添加到主视图，而是将其留空并为视图创建一个新视图（例如下面示例中的表格视图）。

还要创建一个活动视图（带有线程进度指示器或类似的）和“无结果”视图。

然后从以下内容派生您的控制器类：

```
//
//  ContainerViewController.h
//

#import <UIKit/UIKit.h>

@interface ContainerViewController : UIViewController
{
    UIView *myContainerView;

    UITableView *myTableView;
    UIView *mySearchActivityView;
    UIView *myZeroResultsView;

    UIView *myCurrentlyShowingView;
}

@property (retain, nonatomic) IBOutlet UIView *containerView;

@property (retain, nonatomic) IBOutlet UITableView *tableView;
@property (retain, nonatomic) IBOutlet UIView *searchActivityView;
@property (retain, nonatomic) IBOutlet UIView *zeroResultsView;

@property (assign) UIView *currentlyShowingView;

@end

//
//  ContainerViewController.m
//

#import "ContainerViewController.h"

@implementation ContainerViewController

@synthesize containerView = myContainerView;

@synthesize tableView = myTableView;
@synthesize searchActivityView = mySearchActivityView;
@synthesize zeroResultsView = myZeroResultsView;

- (void)dealloc
{
    [myContainerView release], myContainerView = nil;
    [myTableView release], myTableView = nil;
    [mySearchActivityView release], mySearchActivityView = nil;
    [myZeroResultsView release], myZeroResultsView = nil;

    myCurrentlyShowingView = nil;

    [super dealloc];
}

- (void)viewDidLoad
{
    [super viewDidLoad];
    self.currentlyShowingView = mySearchActivityView;
    mySearchActivityView.backgroundColor = [UIColor clearColor];
    myZeroResultsView.backgroundColor = [UIColor clearColor];
}

- (void)setCurrentlyShowingView:(UIView *)view
{
    [myCurrentlyShowingView removeFromSuperview];
    CGRect frame = view.frame;
    frame.size = myContainerView.frame.size;
    view.frame = frame;
    [myContainerView addSubview:view];
    myCurrentlyShowingView = view;
    if (view == myTableView)
        [myTableView reloadData];
}

- (UIView *)currentlyShowingView
{
    return myCurrentlyShowingView;
}

@end 
```

并在派生类的-viewDidLoad方法中，触发（异步）查询：

```
- (void)viewDidLoad
{
    [super viewDidLoad];

    myQueryLoader = [[QueryLoader alloc] initWithQuery:@"whatever" delegate:self];
    self.currentlyShowingView = mySearchActivityView;
} 
```

在委托回调中：

```
- (void)queryLoader:(QueryLoader *)queryLoader didEndWithResults:(id)results error:(NSError *)error
{
    myItems = [results retain];

    if (myItems)
        self.currentlyShowingView = myTableView;
    else
        self.currentlyShowingView = myZeroResultsView;
} 
```

希望这可以帮助！

# xslt - 使用 xpath/xslt 获取页面 url 的锚点部分

> ID：891906
> 
> 赞同：0
> 
> 时间：2009-05-21T08:33:15.813
> 
> 标签：xslt, url, xpath, anchor

我正在使用 xpath 1.0 在 xslt 中编写模板，并且需要从当前页面的 url 访问锚标记。例如，网址：

[http://localhost/destinations/london.aspx#accommodation](http://localhost/destinations/london.aspx#accommodation)

我需要能够获得#accommodation 并将其分配给一个变量。我意识到我在使用 xpath 1.0 时受到了一些限制 - 有没有人有这样做的经验？

谢谢，亚当

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T08:47:59.153

为什么这根本是一个 xpath 问题？URL 不是 XML 文档，因此 xpath 不适用。

XSLT 完全不知道页面位置等任何状态。猜测一下您正在尝试做什么，您可能最好从调用 XSLT 的层中的字符串操作或框架中获取#accomodation，并将值作为参数传递。

OTOH 也许这很荒谬，您的问题只需要澄清一下。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T08:56:50.667

正如@Annakata 所说，这不是 XPath 问题。这似乎也不是 XSLT 问题，尽管我可能弄错了。如果它与 XSLT 字符串解析有关，那么您需要的是类似于[这个问题所](https://stackoverflow.com/questions/569908/is-there-an-xsl-contains-directive)讨论的内容。

您*可能*需要的是 Javascript 来获取当前 URL ( `document.location`)，然后对其执行 Javascript 字符串解析。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T10:33:03.140

标准 XSLT 无法访问文档的 URL：[http ://www.dpawson.co.uk/xsl/sect2/nono.html#d1974e804](http://www.dpawson.co.uk/xsl/sect2/nono.html#d1974e804)

一些供应商可能会通过自定义属性提供此信息，但是您将依赖于 XSLT 处理器。

如果您已经设法以某种方式将 URL 导入 XSLT，那么我建议您必须借助简单的字符串操作来获取锚点。

# c++ - C++ std::vector 的指针删除和分段错误

> ID：891913
> 
> 赞同：5
> 
> 时间：2009-05-21T08:38:52.263
> 
> 标签：c++, pointers, memory-management, segmentation-fault

我有一个指向类的指针向量。我需要调用它们的析构函数并释放它们的内存。由于它们是指针向量 vector.clear() 不能完成这项工作。所以我继续手动进行，如下所示：

```
void Population::clearPool(std::vector<Chromosome*> a,int size)
{
    Chromosome* c;
    for(int j = 0 ;j < size-1;j++)
    {
       c = a.back();
       a.pop_back();
       delete c;
       printf("  %d \n\r",j);
       c = NULL;

    }

} 
```

那里的 printf 是因为我有一个会说话的析构函数来查看分段错误发生在哪个染色体中。当调用 clearPool() 并说我们的大小为 100 时，它可以在 0 到 100 之间的任何染色体中给出分段错误。

我不知道为什么会发生这种情况，也没有办法真正找到问题所在，因为在使用断点进行调试时，我所看到的只是它发生在随机染色体上。

我正在使用代码块 IDE 和 gdb 调试器。发生分段错误时的堆栈跟踪有 4 个内存地址和一个函数`wsncpy()`。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-21T08:43:40.053

```
void Population::clearPool( std::vector <Chromosome*> & a )
{
   for ( int i = 0; i < a.size(); i++ ) {
      delete a[i];
   }
   a.clear();
} 
```

请注意，向量是通过引用传递的。在您的代码中，使用了向量的副本，这意味着它在调用程序中没有改变。因为您删除了副本中的指针，所以原始指针现在全部无效 - 我怀疑您正在以某种方式使用这些无效指针，而这些指针未在您发布的代码中显示。

由于已经发布了几个使用 C++ 库算法的模板解决方案，您可能还需要考虑一个模板解决方案，它不：

```
template <class C> void FreeClear( C & cntr ) {
    for ( typename C::iterator it = cntr.begin(); 
              it != cntr.end(); ++it ) {
        delete * it;
    }
    cntr.clear();
} 
```

使用它，您可以释放任何动态分配对象的容器：

```
vector <Chromosome *> vc;
list <Chromosome *> lc;
// populate & use
FreeClear( lc );
FreeClear( vc ); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-21T08:52:20.223

与 (@1800 INFORMATION) 相比略有修改的版本。

```
 struct DeleteFromVector
    {
        template <class T>
        void operator() ( T* ptr) const
        {
            delete ptr;
        }
    };

std::for_each(aVec.begin(), aVec.end(), DeleteFromVector()); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-21T08:45:50.593

我不知道您为什么会崩溃，但我想一种可能性是向量的大小与您传入的大小不同。另外我注意到您正在从 0 迭代到 size-2，对吗不是说要一路走到尽头吗？

使用惯用 C++ 删除数组中所有项目的一种方法是这样的：

```
template<class T>
class deleter
{
  public:
    void operator()(const T* it) const
    {
      delete it;
    }
};

std::for_each(a.begin(), a.end(), deleter<Chromosome>()); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-21T09:31:07.150

顺便说一句，Boost lambda 已经有一个用于删除指针序列的函子：

```
std::for_each(a.begin(), a.end(), boost::lambda::delete_ptr()); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-21T08:45:20.487

您确定向量中的每个指针都指向不同的对象吗？（即两个指针并不都指向同一个对象，您尝试删除两次。

您确定在调用此方法之前不删除某些指针吗？（即您确定列表中的每个指针都指向一个有效对象吗？）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-21T09:35:11.430

最可能的原因是为同一个地址调用了两次*delete 。*如果您将一个对象多次添加到向量中，就会发生这种情况。要检测到这一点，请插入一些语句，该语句将输出您将*删除*的对象的地址。

```
printf( "will delete %d\n", (int)c );
delete c; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-21T09:56:38.377

我发现了问题。

它可能藏在最隐蔽的地方（只不过是愚蠢的老我）。

正如一些人可能已经猜到的那样，这是一个遗传算法程序。这是我正在制作的教程。我从我制作的轮盘赌功能中随机选择染色体的交叉点。嗯......在里面，有一个-1，不应该在那里。这实际上破坏了一切，并最终导致分段错误。

谢谢大家的帮助，我在这篇文章中看到了一些非常好的做法，我打算遵循

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-21T08:42:36.967

```
void Population::clearPool(std::vector<Chromosome*>& a)
{
    for(size_t i = 0; i < a.size(); i++) {
        delete a[i];
    }

    a.clear();
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-21T08:59:28.990

我建议使用智能指针（即：auto_ptr）而不是原始指针，并且只使用 vector::clear 方法，该方法将为每个元素调用析构函数

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-21T09:03:25.393

您的代码中的某些指针似乎没有引用正确的 Chromosome 对象。如果您由于代码而尝试两次删除某些对象，则可能会发生这种情况：

```
Population p;
vector<Chromosome*> chromosomes;
p.clearPool(chromosomes,chromosomes.size()); // You pass by value, so chromosomes is not changed
p.clearPool(chromosomes,chromosomes.size()); // Delete already deleted objects second time 
```

[您可能会从Boost Pointer Container Library](http://www.boost.org/doc/libs/1_39_0/libs/ptr_container/doc/ptr_container.html)中找到有用的 ptr_vector以避免类似的错误

# .net - DSL框架的选择

> ID：891916
> 
> 赞同：8
> 
> 时间：2009-05-21T08:40:19.827
> 
> 标签：.net, dsl

我正在做一个需要我定义 DSL 的项目。由于提出正确的 DSL 对我的项目至关重要，因此我决定评估有助于定义 DSL、解析它和生成代码（必须使用基于 .NET 的语言）的现有框架我考虑的框架是：

1.  Boo 语言具有可定制的编译器和 python 语法，非常适合定义 DSL。
2.  支持可扩展命令行开关的 Windows PowerShell。
3.  支持可视化建模的 Microsoft DSL 工具，但灵活性较差（在我看来）
4.  ANTLR 是经过验证的工具
5.  C# 流利的接口。（对此不太满意）
6.  Oslo 框架（在生产中使用是否成熟？）

上面提到的每个框架都有优缺点，我无法做出决定。如果在上述框架之间进行选择，你会选择哪一个，为什么？

是否有任何其他框架如此基础以至于我可能错过了？

任何帮助或指导将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-09-10T12:29:22.750

Xtext： http: [//www.eclipse.org/Xtext/](http://www.eclipse.org/Xtext/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T08:49:06.797

在[我](https://stackoverflow.com/questions/776265/c-how-to-parse-arbitrary-strings-into-expression-trees)的一个涉及 DSL 主题的问题中，有人建议我使用[Irony](http://irony.codeplex.com/)和[DLR](http://dlr.codeplex.com/)的组合。但是，我不知道它们是否稳定。Irony 是 Alpha，DLR 虽然稳定，但仍处于 v0.9 中。我的目标是在一两周内自己开始使用 Irony，这样我就可以提供一些反馈。然而，好的一面是——它们都是开源的，所以你可以自己修复错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-25T17:27:21.983

如果您计划实现外部 DSL，Spoofax ( [http://strategoxt.org/Spoofax](http://strategoxt.org/Spoofax) ) 是一个很好的语言工作台来执行此操作。它是一个基于解析器的文本语言工作台，它利用了多种最先进的技术，例如 SDF、Stratego。除了 DSL 实现之外，您还可以获得非常丰富的编辑器服务，例如代码完成、大纲视图、智能感知等。

它带有一个很好的示例 DSL 实现和 Java 代码生成。它也可以作为开始使用这些工具的起点。

以下有关此语言工作台用法的教程详细信息：http: [//strategoxt.org/Spoofax/Tour](http://strategoxt.org/Spoofax/Tour)。

希望能帮助到你！

编辑 -1 ：

[以下是使用此语言工作台实现的语言示例： http](http://mobl-lang.org/) ://mobl-lang.org/ 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-08T22:30:49.857

Jetbrains 有一个可视化工具来帮助语言开发，忘记了名字，但他们的首页上有它。我相信它是免费且部分开源的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-06T19:49:42.017

[DMS Software Reengineering Toolkit](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)是一套集成的工具，用于定义任意语言，包括 DSL，自动构建已定义语言的解析器、分析器和代码生成器。

# .net - ASP.NET 网格视图与列表视图

> ID：891918
> 
> 赞同：45
> 
> 时间：2009-05-21T08:41:54.377
> 
> 标签：.net, asp.net, listview, gridview

与gridview相比，使用listview有什么优势？我需要在视图中进行分页、编辑行、插入行和删除行。哪种控制最适合？似乎 GridView 不支持数据寻呼机。如果我将网格视图迁移到列表视图，我会牺牲什么？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-05-25T11:18:51.787

GridView 支持：

*   点击排序
*   寻呼
*   编辑
*   选择
*   基于模板的布局（在 内渲染`<table>`）

ListView 支持：

*   项目清单
*   分页（需要使用DataPager）
*   编辑
*   选择
*   单击排序（需要手动创建事件处理程序）
*   基于模板的布局（根据需要呈现 + 提供更多模板，例如 - GroupTemplate）

**使用 ListView 的原因是如果您需要一些特殊的布局**，例如，创建一个在同一行中放置多个项目的表格，或者完全摆脱基于表格的渲染） - 这对于 GridView 是不可能的.

**另一方面，**使用 GridView****更容易更快**，因此除非您需要特殊的布局来显示数据，否则请使用 GridView。**

 *** * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-22T21:59:12.500

[这篇文章](http://www.codeproject.com/Articles/667439/Comparing-ListView-with-GridView-DataList-and-Repe)对于比较特别有用。

对我来说，这是您可以呈现的 HTML 的原始灵活性。在我正在开发的一个项目中，我使用的是 GridView，但替换为 ListView，因为我想要 GridView 无法提供的非常具体的分页要求。我本可以使用 3rd 方 gridview 来提供分页要求，但我想尽量减少对 3rd 方代码的依赖。

在我看来，ListView 本身就是从 ASP.NET 2.0 迁移到 3.5 的一个很好的理由。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-21T09:27:56.563

它真正取决于/要求使用哪个控件的场景
Listview 完全是模板驱动的，并且支持插入记录，您可以使用常规的 html 表格并使用 CSS 对其进行样式化以呈现数据，您对设计布局有很大的控制权。
另一方面，GridView，您可以插入记录，但这可能涉及使用页脚和您的 objectdatasource_inserting 事件。您需要在 gridview 页脚中找到并捕获输入的数据，然后直接添加到 objectdatasource 的输入参数中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-21T08:58:47.603

ListView 让您可以更好地控制生成的 HTML 标记。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T14:02:33.920

Gridview 是最好的选择。您可以比任何其他控件更容易地完成您提到的所有事情。列表视图派生自 ListBox

ListView 控件支持以下功能：

*   支持绑定到 SqlDataSource、LinqDataSource 和 ObjectDataSource 等数据源控件。

    通过用户定义的模板和样式可定制外观。

    内置排序功能。

    内置更新和删除功能。

    内置插入功能。

    通过使用 DataPager 控件支持分页功能。

    内置项目选择功能。

    以编程方式访问 ListView 对象模型以动态设置属性、处理事件等。

    多个关键字段。

    * * *

    GridView 在表格中显示数据源的值，其中每列代表一个字段，每行代表一条记录。GridView 控件使您能够选择、排序和编辑这些项目。

GridView 控件用于在表中显示数据源的值。每列代表一个字段，而每一行代表一条记录。GridView 控件支持以下功能：

*   绑定到数据源控件，例如 SqlDataSource。

    内置排序功能。

    内置更新和删除功能。

    内置分页功能。

    内置行选择功能。

    以编程方式访问 GridView 对象模型以动态设置属性、处理事件等。

    多个关键字段。

    超链接列的多个数据字段。

    通过主题和样式可定制的外观。

    要了解 ASP.NET 中可用的其他数据绑定控件，请参阅 ASP.NET 数据绑定 Web 服务器控件概述。

# oracle - 如何使用 EXECUTE IMMEDIATE 获取记录？

> ID：891919
> 
> 赞同：2
> 
> 时间：2009-05-21T08:42:00.353
> 
> 标签：oracle, dynamic-sql

我有一堆带有签名的函数，例如：

```
FUNCTION func1 (par1 IN VARCHAR2, par2 IN NUMBER) RETURN my_rec; 
```

我有一个从这堆函数中检索数据的函数：

```
FUNCTION get_result (func_name IN VARCHAR2, par1 IN VARCHAR2, par2 IN NUMBER) RETURN my_rec;
IS
    rec1 my_rec;
BEGIN
    EXECUTE IMMEDIATE 'SELECT ' || func_name || '(:par1, :par2) FROM DUAL'
    INTO rec1
    USING IN par1, IN par2;

    RETURN rec1;
END; 
```

但此代码因 ORA-01007 '变量不在选择列表中'而失败。
我怎样才能重写语句？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T09:49:45.240

这对我来说一切正常（Oracle 10G），我更正了函数定义中的语法错误（第一行不需要的分号）：

```
SQL> create type my_rec is object (id integer, name varchar2(30))
  2  /

Type created.

SQL> create FUNCTION func1 (par1 IN VARCHAR2, par2 IN NUMBER) RETURN my_rec
  2  is
  3    l_rec my_rec := my_rec (1, 'x');
  4  begin
  5     return l_rec;
  6  end;
  7  /

Function created.

SQL> CREATE OR REPLACE
  2  FUNCTION get_result (func_name IN VARCHAR2, par1 IN VARCHAR2, par2 IN NUMBER) RETURN my_rec
  3  IS
  4      rec1 my_rec;
  5  BEGIN
  6      EXECUTE IMMEDIATE 'SELECT ' || func_name || '(:par1, :par2) FROM DUAL'
  7      INTO rec1
  8      USING IN par1, IN par2;
  9      RETURN rec1;
 10  END;
 11  /

Function created.

SQL> select get_result ('func1',1,2) from dual;

GET_RESULT('FUNC1',1,2)(ID, NAME)
-------------------------------------------------
MY_REC(1, 'x') 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T08:52:11.097

我认为您可以像使用*func_name*一样连接到查询。

# c# - 如何在 .NET 中以编程方式更改默认应用程序池设置属性

> ID：891922
> 
> 赞同：3
> 
> 时间：2009-05-21T08:42:36.670
> 
> 标签：c#, .net-1.1

我必须使用 C# 更改 IIS 6.0 的默认应用程序池中的一些属性，并且我被限制使用使用 .Net 1.1 框架的代码。我仅限于 .Net 1.1，因为我的代码必须使用使用 .Net 1.1 的网站构建。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T13:14:04.063

我发现实际上有一个由 IIS 提供的名为 adsutil 的命令行工具可以解决问题。我可以外壳命令并通过它的开关更改我拥有的属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T10:11:40.920

首先，如果这是一个配置 IIS 的工具，那么它真的依赖于用于运行特定网站的 .Net 版本吗？

其次，只是为了确保您知道可以为您创建的每个应用程序池运行不同版本的 IIS，因此即使其他网站需要 .Net 1.1，您也可以使用 .Net 2.0 编写网站。

最后，我认为没有使用 COM 互操作的简单方法可以做到这一点。您也许可以使用 ADSI/WMI 界面对其进行配置。有很多关于如何在 C# 中回收或停止应用程序池的 Web 帖子，您必须修改其中一个以编写正确的 WMI 属性来创建应用程序池。

# mysql - 如何在 MySQL 中插入大量行？

> ID：891930
> 
> 赞同：8
> 
> 时间：2009-05-21T08:45:42.170
> 
> 标签：mysql, insert

如何通过单个查询将例如 100 000 行插入 MySQL 表？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-21T17:06:18.540

```
insert into $table values (1, a, b), (2, c, d), (3, e, f); 
```

这将执行 3 行的插入。根据需要继续达到 100,000。在进行 ETL 工作时，我会以这种方式处理大约 1,000 个块。

如果您的数据静态位于文件中，则对其进行转换并使用*load data infile*将是最好的方法，但我猜您之所以问这个问题是因为您做了类似的事情。

另请注意其他人所说的关于限制查询长度的 max_allowed_pa​​cket 大小。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-21T14:54:47.260

您可以使用 INSERT 语句进行批量插入，但您的查询不能大于（略小于）max_allowed_pa​​cket。

对于 100k 行，根据行的大小，您可能会超过此值。

一种方法是将其分成几个块。无论如何，这可能是个好主意。

或者，您可以使用 LOAD DATA INFILE（或 LOAD DATA LOCAL INFILE）从制表符分隔（或其他分隔）文件加载。有关详细信息，请参阅文档。

LOAD DATA 不受 max_allowed_pa​​cket 限制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T18:40:58.803

尝试使用 LoadFile() 或将您的数据转换为 XML 文件，然后使用 Load 和 Extract() 函数将数据加载到 MySQL 数据库中。

这是一个查询和最快的选项，

即使我也在做同样的事情，如果 1.5 GB 大约有数百万行，我有文件。在我的情况下，我使用了两个选项。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-21T08:52:44.573

据我所知，你不能。您将需要一个循环。

# python - 萨奇莫捐赠

> ID：891934
> 
> 赞同：2
> 
> 时间：2009-05-21T08:46:17.833
> 
> 标签：python, django, e-commerce, satchmo

任何人都可以分享一些关于为 Satchmo 构建捐赠模块的建议吗？我很乐意定制 Satchmo 的产品模型等，但找不到与捐赠相关的任何内容

我意识到可以创建一个捐赠虚拟产品，但据我所知，这仍然需要预先设置金额（5 美元、10 美元等）。我希望用户能够捐赠任意数量

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-23T07:08:55.097

看起来*satchmo_cart_details_query*信号是执行此操作的方法。它允许您将价格变化值（在我的情况下为捐赠金额）添加到购物车项目

如果有人感兴趣，我会发布完整的解决方案

# python - 用字符串过滤什么都不返回

> ID：891935
> 
> 赞同：0
> 
> 时间：2009-05-21T08:46:18.130
> 
> 标签：python, google-app-engine

我遇到了跟​​随问题。我错过了什么吗？

```
Association.all().count()
1

Association.all().fetch(1)
[Association(**{'server_url': u'server-url', 'handle': u'handle2', 'secret': 'c2VjcmV0\n', 'issued': 1242892477L, 'lifetime': 200L, 'assoc_type': u'HMAC-SHA1'})]

Association.all().filter('server_url =', 'server-url').count()
0  # expect 1

Association.all().filter('server_url =', u'server-url').count()
0 # expect 1

Association.all().filter('issued >', 0).count()
1 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T11:28:19.643

“server_url”是什么属性？

如果它是 TextProperty，则不能在过滤器中使用。

> 与 StringProperty 不同，TextProperty 值的长度可以超过 500 个字节。但是，TextProperty 值未编入索引，并且不能用于过滤器或排序顺序。

[http://code.google.com/appengine/docs/python/datastore/typesandpropertyclasses.html#TextProperty](http://code.google.com/appengine/docs/python/datastore/typesandpropertyclasses.html#TextProperty)

# c# - 开发者笔记本配置

> ID：891938
> 
> 赞同：3
> 
> 时间：2009-05-21T08:46:59.563
> 
> 标签：c#, c++, visual-studio, configuration, hardware

我想买一个全新的笔记本在办公室外工作。我主要在大型项目（10 gb 构建）上使用 VC++（vs03）和 c#（vs08）进行开发。在办公室，我有一个 10.000 rpm 磁盘的四核至强。

根据您的经验，哪种硬件在价格/性能/重量方面最适合此类工作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T08:56:34.490

你多久会在路上？

我有一台用于 OOO 开发工作的 17 英寸戴尔笔记本电脑，老实说，拖来拖去非常麻烦，而且非常不便携。

也就是说，它是 1920 * 1200 res 屏幕、4Gb Ram、7200 RPM 磁盘。我曾尝试在小分辨率 (1280*720) 屏幕上使用 Visual Studio，但我只是讨厌这种体验和缺乏屏幕空间。

决定是否要使用 13" / 15" / 17" 并做一个专业人士和反对者的便携性与开发经验列表。

之后，将机器的 RAM/CPU/HD 速度最大化到您的预算所能承受的范围内。

**编辑** 只是为了重申其他一些好的评论。

如果 SSD 是一种存储选项，那就去吧，尽管这些往往是相当昂贵的附加组件。

4Gb 的 RAM 应该是标准配置。

为了进行比较，戴尔根据重量/便携性将其笔记本电脑分类为：

*   小于 2.2 公斤（轻）
*   介于 2.2 - 2.8 公斤（中）之间
*   超过 2.8 公斤（重）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T09:28:53.130

我不确定一种尺寸是否适合所有人...

你真的要在路上使用真正的大型建筑吗，多久一次。便携性重要吗，等等。

请记住 RAM、磁盘和电池通常是可以更换的。尺寸和重量、屏幕分辨率 GPU 和 CPU 都没有。

对于今天购买开发笔记本电脑，我会寻找一个好的 CPU 和一个像样的 GPU。显示尺寸为 15.4 宽屏或更大。（您必须决定在此屏幕上使用 1920*1280 是否是个好主意。我个人认为 1440*900 或 1680*1050 就足够了……我不会为更高的分辨率付费，然后还要戴眼镜它...）

对于 CPU 型号，请查看此图表： http: [//www.intel.com/consumer/rating.htm](http://www.intel.com/consumer/rating.htm)。对于 GPU，不要进行“集成”设置。我对 nvidia9400 很满意

磁盘便宜且易于更换，请记住 7200rpm 比 5400 或 4200 消耗更多的电池...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T08:56:49.823

如果您在笔记本电脑上进行大型复杂构建是 SSD 驱动器，我可以说的一件事是必须的。我的笔记本电脑刚买了一台，我的 ant 构建时间从 24 秒缩短到了 9 秒！

Think pad 始终坚如磐石！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T08:59:07.120

戴尔 M6400 不错……7200 硬盘、4g 内存和真正的高分辨率屏幕……

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-21T09:18:00.543

我肯定会投票给 DELL XPS Studio 16 ...它是一台出色的机器，速度为 2.93 Ghz，4GB 内存，可以选择添加高达 256GB 的 SSD 驱动器...最好的总线速度是 1067 Mhz，非常快

并且它的重量小于 17 英寸以提高便携性...

它非常适合开发和快速尖叫...

PS我不在戴尔工作；）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-21T09:31:18.957

我还使用具有 4GB RAM 和 2GHz Core Duo（不幸的是不是 Core 2 Duo）的 DELL（Latitude 620）。它工作得很好，但屏幕分辨率太小（1440x900）。另一方面，它非常便携（不要询问实际重量）！在办公室里，我使用了带两个 17 英寸显示器的笔记本电脑，在那种环境下它工作得很好。

还有两点需要优化：

*   SSD 将是一个不错的选择，但目前过于昂贵（我们的构建目前可能需要 20 分钟，因此如 Karl 所说，将其减少 2.6 倍会很棒！）
*   在双显示器和单显示器配置之间切换笔记本电脑时，Visual Studio 很痛苦，所以我希望 MS 能解决这个问题（Eclipse 更好，因为你可以配置多个视角）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-21T09:02:30.937

我也投票给戴尔，完全同意 Eoin

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-21T09:05:15.767

好吧，我不推荐任何供应商，但我建议您必须选择至少 4GB 的 RAM、Core 2 Duo 系统和最大 2KG 的重量，如果您碰巧一直拖着它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-21T12:32:58.950

我支持关于 SSD 的建议（如果可能，尝试获得 MLC 设备），我还想补充一点，我个人（具有讽刺意味的是）发现专门针对游戏玩家的笔记本电脑总体上是相当不错的开发平台。

# file - 如何在 Windows 上为复制/粘贴分配权限

> ID：891943
> 
> 赞同：0
> 
> 时间：2009-05-21T08:48:29.777
> 
> 标签：file, clipboard, copy-paste

好吧，众所周知，您无法在 Windows 平台上为文件的复制/粘贴分配权限。

我需要从中央文件服务器控制复制过程，以帮助我了解：

1.  哪个用户执行了复制
2.  复制了哪些文件
3.  他把它们贴在哪里
4.  复制数据的总大小
5.  复制操作时间
6.  如果用户超过了允许的“复制限制”，一个对话框会要求他输入管理凭据或拒绝他（因为它会被配置）
7.  将所有这些数据存储在文件中以供以后查看或通过电子邮件发送。

我需要通过在服务器本身上放置一个实用程序来收集这些数据，而无需在客户端计算机上进行任何其他安装。

我知道监控**Clipboard**，但它会是哪个剪贴板？用户的剪贴板还是服务器的剪贴板？甚至不通过剪贴板**的拖放**操作呢？是否知道**SystemFileWatcher**在这种情况下是否有用？

有任何想法吗 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-22T08:24:13.827

我不认为剪贴板与这里的事情有任何关系。在客户端执行“复制和粘贴”操作的结果是文件是从共享中复制的，对吗？实际上，您关心的不是“复制”行为，而是“粘贴”（文件的剪贴板副本在您将其粘贴到某处之前不会做任何事情）。

因此，我认为您应该一起忽略剪贴板，并寻找监视共享文件访问的方法。

本质上，您正在寻找文件共享审核。Windows 有一些内置的，但我不是专家。事实上，只要您在文件共享审计方面措辞，您可能会在 ServerFault.com（StackOverflow.com 的姊妹网站）上获得更多关注。哦，你没有在这里提到你的服务器的操作系统——如果你在 ServerFault.com 上发帖，你应该这样做。

# sql - 在 64 位 sqlserver2005 和 32 位 sql2000 之间使用链接服务器是否存在任何已知问题

> ID：891950
> 
> 赞同：0
> 
> 时间：2009-05-21T08:49:50.337
> 
> 标签：sql, sql-server, sql-server-2005

我似乎无法让链接服务器在运行 sql2000 32 位和 64 位 sql2005 的数据库/服务器之间进行查询。这是一个已知的错误？如果是这样，是否有解决方法或修复？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-22T05:15:58.307

嗯，有[这个](http://support.microsoft.com/kb/906954)问题。

> 若要解决此问题，请在 32 位 SQL Server 2000 服务器或 SQL Server 7.0 服务器上手动运行 SQL Server 2000 SP3 或 SP4 附带的 Instcat.sql 脚本。

# wcf - 在实体框架中卸载数据引用

> ID：891952
> 
> 赞同：4
> 
> 时间：2009-05-21T08:50:53.737
> 
> 标签：wcf, entity-framework

目前我正在努力解决实体框架问题。我有一个位于 ef 框架之上的 wcf 服务，并允许对框架进行查询。在某些时候，用户能够从框架请求文件。这些文件由解决方案条目引用，因此当您从解决方案请求文件时，将加载引用以访问文件存储。

这一切都很好，但是从那时起，每当您执行另一个返回该解决方案条目的查询时，整个文件都会附加到返回结果中。我需要一些分离或卸载引用的方法，这样结果条目将只包含对文件存储的卸载引用。

我试图创建一个新的上下文并查询该上下文以从中检索信息，但是当我这样做时，原始上下文中的实体也会发生变化。

我试图从原始上下文中分离实体，然后从新上下文中查询。那也不行。

我找到了一种方法。对于所有非文件下载查询，我分离结果实体，并通过网络发送。我不确定这是否是最好的方法。

我希望有人可以提供一些见解，感谢您的努力。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-02-09T14:11:01.607

您遇到的问题可能与默认情况下启用的**更改跟踪**有关。

**可能的解决方案：**

[使用MergeOption.NoTracking](http://msdn.microsoft.com/en-us/library/system.data.objects.mergeoption.aspx)禁用更改跟踪

```
using (MyEntities _context = new MyEntities())
{
    _context.Widgets.MergeOption = MergeOption.NoTracking;

    return _context.Widgets.ToList();

} 
```

如果上述解决方案不起作用，[本文](http://msdn.microsoft.com/en-us/library/ff407090.aspx)可能有助于为您指明如何处理此问题的正确方向。

我最近在一个类似的问题上苦苦挣扎。问题是上下文维护对我正在使用的对象的引用的结果（显然）。每次我对同一类型的对象进行更改时，即使是使用新的上下文（所以我认为）获得时，对象也会被更改。

在我的一位同行的帮助下，我们确定上下文是由于我在 IoC 容器中注册它的方式（每个 Web 请求的生活方式）而导致的。当我将生活方式更改为瞬态（最终提供了一个新实例）时，对相同类型对象的更改不受影响。

希望这可以帮助。

# c# - 在类库中嵌入二进制文件

> ID：891958
> 
> 赞同：14
> 
> 时间：2009-05-21T08:53:08.973
> 
> 标签：c#, binary, embedding

是否可以在 C# 类库中嵌入自定义二进制文件，然后在运行时使用二进制阅读器读取它？

我猜这可能是通过资源实现的。

非常感谢

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-21T09:28:56.107

您可以通过项目属性将文件添加到资源中来做到这一点。然后，Visual Studio 将为您提供一个方便的类来使用以下代码访问您的文件

```
byte[] theFile = myNamespace.Properties.Resources.theBinaryFile; 
```

其中资源名称是二进制文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-21T09:18:21.557

是的，这很容易：

将文件添加到您的项目中并将“构建操作”设置为“嵌入式资源”。

在你的程序中做

```
foreach (string name in Assembly.GetExecutingAssembly().GetManifestResourceNames())
{
  if (name.EndsWith("<name>", StringComparison.InvariantCultureIgnoreCase))
  {
    using (Stream stream = Assembly.GetExecutingAssembly().GetManifestResourceStream(name))
    {
      // ...
    }
    break;
  }
} 
```

找到正确的资源有点复杂，因为文件名前面有一些东西（命名空间等。在 if(...) 设置断点以查看真实的资源名称）。

# asp.net - ASP.NET：在 ObjectDataSource 中更新时将对象类型作为参数处理

> ID：891959
> 
> 赞同：2
> 
> 时间：2009-05-21T08:53:13.763
> 
> 标签：asp.net, objectdatasource, formview

你们是如何更新的，比如说一个带有 ObjectDataSource 源的 FormView。DataObjectTypeName 是一个我已经用 DataObject 属性标记的类。现在，我想自定义更新过程并在参数中添加一些自定义数据。我们需要做什么？

示例：我有一个 BLL 类，我们称之为“ProductsBLL”和一个数据类“Product”。

我声明了以下 ObjectDataSource 控件：

```
<asp:ObjectDataSource ID="ObjectDataSource1" runat="server" 
DataObjectTypeName="Product" OldValuesParameterFormatString="original_{0}"
SelectMethod="GetProduct" TypeName="Assembly.ProductsBLL" 
UpdateMethod="UpdateProduct">
  <UpdateParameters>
    <asp:Parameter Name="product" Type="Object" />
  </UpdateParameters>
  <SelectParameters>
    <asp:QueryStringParameter Name="productID" QueryStringField="ProdID" Type="Int32" />
  </SelectParameters>
</asp:ObjectDataSource> 
```

假设 ProductsBLL 类中的 Update 方法接受 Product 对象作为参数。现在，在更新发生之前，我想向 Product 参数添加一个自定义数据。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T09:10:17.580

我不确定您的问题到底是什么（您需要更具体），但一般流程如下：

*   您的 GridView 链接到 ObjectDataSource。

*   您的 ObjectDataSource 通过`TypeName`属性链接到 Biz Logic 层 - 这是将被实例化以执行数据操作的类。`ProductsBLL`（例如调用它）。

*   它还使用一个`DataObjectTypeName`属性，该属性是 BLL 正在检索/更新/删除的对象类型。（比如说，`Product`）

*   此外，它指定了在调用动作时调用的 BLL 中的方法（`UpdateMethod`、`SelectMethod`等）（例如`ProductsBLL.UpdateProducts`、`ProductsBLL.DeleteProducts`）

*   然后，您的 BLL 对象对从 ObjectDataSource 接收的数据执行自定义操作，例如验证逻辑，并调用您的 Datalayer 以从数据库执行实际更新/删除。（比如说，`ProductsDataLayer.UpdateProduct()`）

如果您需要更多信息，请编辑您的问题以更具体。

**编辑**（编辑原始问题后）：

* * *

在更新之前修改`Product`参数很简单：

```
// In Biz Logic Layer.
public int UpdateProduct(Product p)
{
  // Modify the ProductName and the Price properties of this Product.
  p.ProductName = "Product " + p.ProductName;
  p.Price = 0.95 * p.Price;

  // Call DataLayer.
  return ProductDL.UpdateProduct(p.ID, p.ProductName, p.Quantity, p.Price);
} 
```

`ProductDL.UpdateProduct` *可能*看起来像的地方：

```
public int UpdateProduct
  (
    string productID,
    string productName,
    int productQty,
    float productPrice
    ) 
```

等等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-18T15:41:59.160

在 ObjectDataSource 更新事件中，检查 e.InputParameters 集合，您的 Products 对象应存储在 e.InputParameters[0] 中。

# coldfusion - 无需访问 webroot 即可安装 Fusebox

> ID：891961
> 
> 赞同：2
> 
> 时间：2009-05-21T08:54:43.417
> 
> 标签：coldfusion, fusebox

以前（和本地）我将 fusebox5 目录放在 web 根目录中，然后树中任何位置的应用程序都可以访问它。我以前也使用 Application.cfm 而不是 .cfc。

在这种环境下，我无法访问 webroot，而且 FB 文件也不需要那么远，所以我计划将它们与应用程序一起存储。如果正在使用 Application.cfc，我是否认为 index.cfm 会被忽略（因此将 cfinclude 值更改为例如../fusebox5/ 没有意义）？如果是这样，如何在根目录或映射中不包含 Fusebox 的情况下包含框架？错误是：

```
Could not find the ColdFusion Component or Interface fusebox5.Application. 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T10:57:49.673

不，您的应用仍然需要 index.cfm。您需要的是 Application.cfc 中 Fusebox 的 cf 应用程序映射。查看 Ray Camden 的[Application.cfc 模板](http://www.coldfusionjedi.com/downloads/application.cfc.txt)以获取设置应用程序特定映射的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T18:52:39.963

您可以在应用根目录的子文件夹中运行 Fusebox 5+。让它发挥作用可能不是最明显的事情。

不幸的是，您无法为扩展 Application.cfc 创建动态映射，因为您的 Application.cfc 尚未实例化 - 您将获得鸡与蛋的场景。你不能创建到 Fusebox 的映射，因为你的 Application.cfc 没有启动，你不能启动你的 Application.cfc 因为它找不到它应该扩展的组件。

这是 COLDFUSION 8 中的一个错误。ColdFusion 应按以下顺序查找映射：

*   来自 CF 管理员的映射文件夹
*   当前目录之外的子目录
*   Web 根目录下的子目录称为

它在您使用 CreateObject() 时执行此操作，但在您使用 cfcomponent 上的 Extends 属性时不会执行此操作。

最简单的解决方案是像使用任何应用程序一样使用 Application.cfc，然后从 index.cfm 中包含 fusebox。您的文件夹结构如下所示：

```
/myapp/fusebox5/
/myapp/index.cfm
  -- consists of <cfinclude template="fusebox5/fusebox5.cfm" /> 
```

只要您不使用 Application.cfc 的 OnRequest 拦截请求，或者如果您使用 OnRequest，请确保包含预期的目标（无论如何几乎总是 index.cfm），您的 index.cfm 文件就不会被忽略。

如果您不想要求 index.cfm 执行包含，您可以让 Application.cfc 的 OnRequest 方法执行 cfinclude。

```
<cffunction name="onRequest">
    <cfinclude template="fusebox5/fusebox5.cfm">
</cffunction> 
```

您仍然可能需要 index.cfm，这样您的 Web 服务器就不会提供目录列表或 404，但如果文件为空也可以。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T17:19:07.937

在 Application.cfc 中：

```
<cfscript>
    this.mappings = {}; //create a new structure to store app-specific mappings
    this.mappings["Fusebox"] = expandPath('./Fusebox'); //add mapping
</cfscript> 
```

# objective-c - 在objective-c/cocoa-touch中有哪些对数函数/方法？

> ID：891963
> 
> 赞同：9
> 
> 时间：2009-05-21T08:55:25.113
> 
> 标签：objective-c, cocoa-touch, math, logarithm

我试过搜索对数+objective-c，但我得到的只是老师的数学测试页，或者对数是什么的解释；）

我有一些测量值，比如 83912.41234，其他测量值是 32.94232。我需要将这个巨大的频谱压缩到 0 到 100 之间，而 32.94232 至少应该大于 2，而 83912.41234 会接近 100。所以我认为对数函数将是我的朋友。

更新：我通过“快速打开”找到了 math.h 文件（Xcode 中非常好的命令：SHIFT + CMD + D），在那里，大吃一惊：

```
extern double log ( double );
extern float logf ( float );

extern double log10 ( double );
extern float log10f ( float );

extern double log2 ( double );
extern float log2f ( float );

extern double log1p ( double );
extern float log1pf ( float );

extern double logb ( double );
extern float logbf ( float ); 
```

但是：没有文字，没有评论。我不是那种数学狂。所以一些描述会很好，即什么情况下的对数，曲线的样子等等......所以任何伟大的链接都非常感谢！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-10-20T19:17:58.513

此外，得到一个任意底数的对数：

```
float logx(float value, float base) 
{
   return log10f(value) / log10f(base);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T09:16:44.743

math.h 是标准包含。维基[百科](http://en.wikipedia.org/wiki/Math.h)页面有一些文档。

另一种“压缩”值的方法是将您的值拟合成一条直线。以你为例：

直线方程

```
y = mx + c
y = 'squished' value.
x = The value you want to squish
m = Gradient of the line
c = intercept on the y axis 
```

对您的值进行快速计算会得出以下结果：

```
y = 1.17e-3 x + 1.96 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T09:10:31.620

拿一本关于 C 标准库函数的书怎么样？

否则，您可以尝试 man pages: `man 3 logf`，例如

# ruby-on-rails - 属于归属关联的 Group_by

> ID：891964
> 
> 赞同：3
> 
> 时间：2009-05-21T08:55:27.937
> 
> 标签：ruby-on-rails

我想使用 group_by 方法，而不是使用数据库中的列：

```
@posts.group_by(&:date) 
```

我想要类似的东西：

@posts.group_by(&:作者)

帖子属于作者的位置。

我只是不确定语法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T09:05:48.370

您可以在模型中编写：

```
def author_name
  self.author.name
end 
```

进而

```
@posts.group_by(&:author_name) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T10:40:16.353

在这种情况下，大概你实际上可以做

```
@posts.group_by(&:author_id) 
```

更一般地，您可以将一个块传递给 group_by，因此如果您需要对一些任意逻辑进行分组：

```
@posts.group_by { |post|
  ... some code returning a value to group this post by ...
} 
```

顺便说一句，我上次查看时，group_by 的实现保留了提供给它的数据的相对顺序，这有助于记住，因为它允许您对“平面”帖子列表中的数据进行排序，并且然后，当您对它们进行分组时，将在分组内维护顺序，而不是使用 group_by 输出的嵌套数据进行排序。

# java - 如何优化此方法以将字符串分成块？

> ID：891969
> 
> 赞同：2
> 
> 时间：2009-05-21T08:56:12.430
> 
> 标签：java, algorithm, optimization, string

这是方法。我想知道我是否违反了这里的任何最佳实践，或者就语言而言我是否做错了什么。

```
private List<String> breakStringInChunks(String text, int chunkSize) {
        List<String> chunks = new ArrayList<String>();
        String temporary = "";
        int numberOfChunks = text.length() / chunkSize;
        int beginIndex = 0;
        int endIndex = 0;

        // Add one iteration if numberOfChunks*chunkSize is less than the length of text.
        if ((numberOfChunks * chunkSize) < text.length()) {
            numberOfChunks++;
        }

        // Cut strings and add in the list.
        for (int i = 0; i < numberOfChunks; i++) {
            endIndex+=chunkSize;
            if ((i + 1) == numberOfChunks) {
                temporary = text.substring(beginIndex);
            }
            else {
                temporary = text.substring(beginIndex, endIndex);
            }
            beginIndex=endIndex;
            chunks.add(temporary);
        }

        return chunks;
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T09:27:16.080

更简洁，并避免结果列表的潜在调整大小。

```
private static List<String> breakStringInChunks(final String text, final int chunkSize) {
    final int numChunks = 0 == (text.length() % chunkSize) ? text.length() / chunkSize : 1 + (text.length() / chunkSize);
    final List<String> chunks = new ArrayList<String>(numChunks);
    for (int startIndex = 0; startIndex < text.length(); startIndex += chunkSize) {
        final int endIndex = Math.min(text.length(), startIndex + chunkSize);
        chunks.add(text.substring(startIndex, endIndex));
    }
    return chunks;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T09:05:41.333

这有点冗长，并且不需要`temporary`在方法的开头声明字符串，这可能会使垃圾收集速度变慢。以下内容会更简短：

```
private List<String> breakStringInChunks(String text, int chunkSize) {
    int nChunks = (int)Math.ceil(((double)text.length())/chunkSize));
    List<String> chunks = new ArrayList<String>(nChunks);
    // Cut strings and add in the list.
    for (int i = 0; i < text.length(); i+=chunkSize) {
        int endIndex=i+chunksize;
        if (endIndex >= text.length()) {
            chunks.add(text.substring(i));
        } else {
            chunks.add(text.substring(i, endIndex));
        }
    }
    return chunks;
} 
```

关于你的方法和上面的文本的一个好处是，因为你总是在原始字符串上调用 substring()，Java 只会引用原始字符数组，所以它会为你节省一些内存分配。

我认为这`} else {`是 Java 更常见的编码标准。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T09:18:06.707

除非我误解了你的意图，否则这似乎是一个巨大的矫枉过正，并且多次使用字符串创建，使得算法在 java 中效率很低，因为字符串是不可变的。

试试这个：

```
public List<String> breakStringsInChunks(String text,int chunkSize) {
    if (chunkSize<=1) {
        throw new IllegalArgumentException("Chunk size must be positive");
    }
    if (text==null || text.isEmpty()) {
        return Collections.emptyList();
    }

    List<String> chunks= new LinkedList<String>();

    int index=0;
    int len = text.length();

    //guaranteed to succeed at least once since 0 length strings we're taken care of
    do {
        chunks.add(text.substring(index, Math.min(index + chunkSize, len)));
        index+=chunkSize;
    } while (index<len);

    return chunks;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T09:36:39.197

```
public static final List<String> chunk(final String text, final int chunkSize) {
    // Figure out how many chunks we are going to make.
    final int textLength = text.length();
    final int numberOfChunks =
        textLength % chunkSize == 0
        ? textLength / chunkSize
        : textLength / chunkSize + 1;

    // Create an array list of just the right size.
    final ArrayList<String> chunks = new ArrayList<String>(numberOfChunks);

    // Do all the chunking but the last one - here we know that all chunks
    // are exactly chunkSize long.
    for (int i = 0; i < numberOfChunks - 1; i++) {
        chunks.add(text.substring(i * chunkSize, (i + 1) * chunkSize));
    }

    // Add final chunk, which may be shorter than chunkSize, so we use textLength
    // as the end index.
    chunks.add(text.substring((numberOfChunks - 1) * chunkSize, textLength));

    return chunks;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T09:45:13.563

这是我的解决方案。我试图实现这一点非常有效：

```
public static List<String> breakStringInChunks(String text, int chunkSize) {
    if (chunkSize < 2) {
        throw new IllegalArgumentException("Chunk size must be > 1");
    }
    if (null == text || text.isEmpty()) {
        return Collections.emptyList();
    }

    List<String> chunks = new ArrayList<String>(1 + (text.length() / chunkSize));

    int length = text.length() - (text.length() % chunkSize);

    for (int i = 0; i < length;) {
        chunks.add(text.substring(i, i += chunkSize));
    }
    if (length < text.length())
        chunks.add(text.substring(length));

    return chunks;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T10:50:31.060

这样的事情怎么样？

```
private List<String> breakStringInChunks(String text, int chunkSize)
{
    List<String> chunks = new ArrayList<String>();
    while (text.length() > 0)
    {
        if (chunkSize > text.length())
        {
            chunkSize = text.length();
        }
        chunks.add(text.substring(0, chunkSize));
        text = text.substring(chunkSize);
    }
    return chunks;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-21T16:03:13.723

这是我的。与其他一些答案没有太大区别，但测试驱动，fwiw。

```
public class ChunkTest extends TestCase {
    public void testEmpty() throws Exception {
        assertEquals(0, breakStringInChunks("", 1).size());
    }

    public void testOneChunk() throws Exception {
        String s = "abc";
        List<String> chunks = breakStringInChunks(s, s.length());
        assertEquals(s, chunks.get(0));
        assertEquals(1, chunks.size());
    }

    public void testPartialChunk() throws Exception {
        String s = "abc";
        List<String> chunks = breakStringInChunks(s, s.length() + 1);
        assertEquals(s, chunks.get(0));
        assertEquals(1, chunks.size());
    }

    public void testTwoChunks() throws Exception {
        String s = "abc";
        List<String> chunks = breakStringInChunks(s, 2);
        assertEquals("ab", chunks.get(0));
        assertEquals("c", chunks.get(1));
        assertEquals(2, chunks.size());
    }

    public void testTwoEvenChunks() throws Exception {
        String s = "abcd";
        List<String> chunks = breakStringInChunks(s, 2);
        assertEquals("ab", chunks.get(0));
        assertEquals("cd", chunks.get(1));
    }

    private List<String> breakStringInChunks(String text, int chunkSize) {
        if (text.isEmpty())
            return Collections.emptyList();
        int n = (text.length() + chunkSize - 1) / chunkSize;
        List<String> chunks = new ArrayList<String>(n);
        for (int i = 0; i < n; ++i)
            chunks.add(text.substring(i * chunkSize, Math.min((i + 1) * chunkSize, text.length())));
        return chunks;
    }
} 
```

# html - 元标记中的 html 实体会影响索引吗？

> ID：891977
> 
> 赞同：5
> 
> 时间：2009-05-21T08:57:17.060
> 
> 标签：html, seo

我想知道在元标记（如关键字和描述）中使用 HTML 实体是否是最好的方法？

它会影响搜索引擎的索引吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T09:10:09.313

元描述可以用作默认片段。

元关键字几乎完全被忽略了，但每个人仍然使用它们。

两者都不会对您的排名产生太大影响（如果有的话），但是好的元描述可以提高您的点击率。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-21T09:15:46.760

只要我的字符集允许字符，我就会将元标记内容放在没有实体的情况下。我研究了一下，我在[Google Webmasters/Site owner help](http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=79812)上找到了这个，示例包含**£9.24**不是**£9.24**也不是**£9.24**

确实，元标记并不是成功的重要因素，但它们可能是失败的因素。索引器机器人可能会通过使用无效的关键字或描述来检测欺骗它们的尝试。来自[维基百科](http://en.wikipedia.org/wiki/Search_engine_optimization)：

> 早期版本的搜索算法依赖于网站管理员提供的信息，例如关键字元标记，或 ALIWEB 等引擎中的索引文件。元标记为每个页面的内容提供指南。但是发现使用元数据来索引页面不太可靠，因为网站管理员在元标记中选择的关键字可能会不准确地表示网站的实际内容。元标记中不准确、不完整和不一致的数据可能而且确实会导致页面针对不相关的搜索进行排名。Web 内容提供商还操纵页面的 HTML 源代码中的许多属性，以试图在搜索引擎中获得良好的排名。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-21T23:57:01.160

实体仅在使用正则表达式完成的业余 HTML“解析器”中发挥作用。它们对谷歌来说不是问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T09:28:47.403

元标记不会被忽略。仍然有谷歌阅读，所以我认为，它们应该以正确的方式使用。谷歌喜欢以正确方式完成的页面，但请记住，元标记是机器人考虑的数百件事之一。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-16T17:46:43.923

如果有变音符号不要使用实体。我认为，谷歌将“bremsbeläge”这个词索引为“bremsbelaege”和“bremsbeläge”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-29T18:24:11.300

元标签“描述”确实对排名有影响。这是谷歌在列表中给出的描述，所以这是影响人们点击你的链接的最重要的部分。当更多的人点击您的链接时，Google 会认为它对搜索中的用户具有更高的价值，并将您提升。

# jquery - 允许用户更改网页中的字体大小

> ID：891980
> 
> 赞同：17
> 
> 时间：2009-05-21T08:57:50.290
> 
> 标签：jquery, html, css

我希望能够更改网页中文本的大小，我想可以使用 jQuery，但我没有使用 javascript 的经验。

还有一个问题是网页是phtml文件，使用了多个php echo命令。该页面由多个 phtml 文件组成。

编辑：我想为用户提供 3 种不同字体大小的选择。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-21T09:15:29.927

我将采取的方法是将字体大小百分比应用于 html 的正文标记

```
body
{
    font-size: 62.5%;
} 
```

然后为所有其他元素指定 ems 中的 font-size，它将大小生成为继承的 font-size 的放大百分比

```
h1
{
    font-size: 1.8em;
}

p
{
    font-size: 1.2em;
} 
```

我在正文上使用 62.5%，因为在指定其他字体大小时很容易将其转换为像素大小，例如 1.2em = 12px、1.8em = 18px 等等

然后以编程方式更改页面中的字体大小，您只需要更改正文上字体大小的值，页面的其余部分将相应地放大或缩小

您可以通过三个 div 来测试它

```
<div id="sizeUp">bigger text</div>
<div id="normal">normal text</div>
<div id="sizeDown">smaller text</div> 
```

在 JQuery 中我相信你可以做到

```
$(document).ready(function() {

    $("#sizeUp").click(function() {

        $("body").css("font-size","70%");

    });

    $("#normal").click(function() {

        $("body").css("font-size","62.5%");

    })

    $("#sizeDown").click(function() {

        $("body").css("font-size","55%");

    })
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-05-04T06:28:48.977

如何通过jquery增加和减少div内容的字体大小？

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<div class="data">

sghfhj jhkjik jhbjbjbh 
 </div>

 <div ><input type="button" value="increase" class="increaseFont"></input></div>
 <div><input type="button" value="decrease" class="decreaseFont"></input></div>

 <script type="text/javascript">
 $(document).ready(function(){
  $(".increaseFont,.decreaseFont").click(function(){
  var type=  $(this).val();
   var curFontSize = $('.data').css('font-size');
   alert(curFontSize);
   if(type=='increase'){
    $('.data').css('font-size', parseInt(curFontSize)+1);
    }
   else{
    $('.data').css('font-size', parseInt(curFontSize)-1);
   }
   alert($('.data').css('font-size'));

     });

 });
 </script> 
```

这是工作:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-07-01T12:56:50.680

我用这个，字体很棒：

```
Fontsize: 
<div class="fa fa-search-plus" id="sizeUp"></div>
<div class="fa fa-search" id="normal"></div>
<div class="fa fa-search-minus" id="sizeDown"></div> 
```

和脚本：

```
<script async type="text/javascript">
    $(document).ready(function() {
        $("#sizeUp").click(function(){
          var curFontSize = $('.ccm-page').css('font-size');
           $(".ccm-page").css("font-size",parseInt(curFontSize)+1);
         });

        $("#normal").click(function() {
            $(".ccm-page").css("font-size","15px");

        })

        $("#sizeDown").click(function() {
            var curFontSize = $('.ccm-page').css('font-size');
            $(".ccm-page").css("font-size",parseInt(curFontSize)-1);
        })
    });
  </script> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T09:15:47.103

更改文本大小的最简单方法是使用 css。如果您有权访问 css 文件，则可以使用以下命令更改页面上所有文本的大小：

```
* {
    font-size: 110%;
  } 
```

将其添加到您的 styles.css 文件的顶部，它会影响页面上的所有文本以及使用该 styles.css 文件的所有文本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-13T16:48:55.530

只需使用 jQuery 和 HTML，您就可以添加一个选项来增加/减少文本的字体大小。您必须使用类将内容包装在 div 中，`kickblogger`并以该 div 为目标以使用 jQuery 更改其字体大小。使用这个脚本。

```
<script src=" https://googledrive.com/host/0Bw5Ph-OwuTz6VkJhZmNlX1lJV0k/"> </script> 
```

有了这些按钮。

```
<input type="button" id="btnkickplus" value="A +" />
<input type="button" id="btnkickminus" value="A -" /> 
```

*   演示 - [http://jsfiddle.net/3N4Lf/](http://jsfiddle.net/3N4Lf/)
*   文章 - [http://www.howtokickblogger.com/2013/09/change-text-font-size-on-blogger-using-jquery.html](http://www.howtokickblogger.com/2013/09/change-text-font-size-on-blogger-using-jquery.html)

:)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-21T11:51:04.747

试试这个：

```
<p><a href="#" onclick="document.body.style.fontSize='x-small';">SMALL</a></p>
<p><a href="#" onclick="document.body.style.fontSize='medium';">MEDIUM</a></p>
<p><a href="#" onclick="document.body.style.fontSize='x-large';">BIG</a></p> 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-05-21T12:11:08.247

只需通过 CTRL-+ 和 CTRL-- 调整字体大小（在 Firefox 中，在其他浏览器中可能会有所不同）

# bash - 在 bash 中使用 grep 时将带有交互的命令的输出放入变量中

> ID：891988
> 
> 赞同：0
> 
> 时间：2009-05-21T09:01:10.063
> 
> 标签：bash, scripting, freebsd

我使用的这个程序在你运行它时有它自己的变量要设置，所以我想设置这些变量，然后对输出进行greping，然后将它存储在一个变量中。但是，我不知道如何以正确的方式解决这个问题。我的想法行不通。重点是第 7 行到第 14 行。

```
1  #!/usr/local/bin/bash
2  source /home/gempak/NAWIPS/Gemenviron.profile
3  FILENAME="$(date -u '+%Y%m%d')_sao.gem"
4  SFFILE="$GEMDATA/surface/$FILENAME"
5  echo -n "Enter the station ID: "
6  read -e STATION
7  OUTPUT=$(sflist << EOF
8  SFFILE = $SFFILE
9  AREA = @$STATION
10 DATTIM = all
11 SFPARM = TMPF;DWPF
12 run
13 exit
14 EOF)
15 echo $OUTPUT 
```

但我明白了：

```
./listweather: line 7: unexpected EOF while looking for matching `)'
./listweather: line 16: syntax error: unexpected end of file 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T10:00:29.553

把每个人的答案放在一起，我自己找到了一个可行的解决方案。这段代码对我有用：

```
#!/usr/local/bin/bash
source /home/gempak/NAWIPS/Gemenviron.profile
FILENAME="$(date -u '+%Y%m%d')_sao.gem"
SFFILE="$GEMDATA/surface/$FILENAME"
echo -n "Enter the station ID: "
read -e STATION

OUTPUT=$(sflist << EOF
SFFILE = $SFFILE
AREA = @$STATION
DATTIM = ALL
SFPARM = TMPF;DWPF
run
exit
EOF
)
echo $OUTPUT | grep $STATION 
```

谢谢大家！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-21T09:20:52.693

我会把你的程序放在一个单独的 .sh 脚本文件中运行，然后从你的第一个文件运行脚本，传递你想要作为命令行参数传递的参数。这样你就可以单独测试它们。

您也可以在函数中执行此操作，但我喜欢第二个脚本的模块化。我不完全理解您在上面尝试做的事情，但类似于：

```
runsflist.sh:
#!/bin/bash

FILENAME="$(date -u '+%Y%m%d')_sao.gem"
SFFILE="$GEMDATA/surface/$FILENAME"
AREA = @$STATION
DATTIM = all
SFPARM = TMPF;DWPF
grep $STATION | sflist

main.sh:
#!/bin/bash

echo -n "Enter the station ID: "
read -e STATION
OUTPUT=`runsflist.sh`
echo $OUTPUT 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T09:35:33.287

如果 sflist 需要交互，我会尝试这样的事情：

```
SFFILE=$(
  ( echo SFFILE = "$SFFILE"
    echo AREA = "@$STATION"
    echo DATTIM = all
    echo SFPARM = TMPF;DWPF
    echo run
    cat
  ) | sflist) 
```

不幸的是，您必须`exit`在交互过程中输入内容。

# javascript - JavaScript：添加一个 onClick 处理程序而不覆盖现有的处理程序

> ID：891989
> 
> 赞同：20
> 
> 时间：2009-05-21T09:01:46.863
> 
> 标签：javascript, jquery, onclick

我正在尝试修改页面上的所有链接，以便在单击它们时执行一些额外的工作。

一个简单的方法可能是这样的：

```
function adaptLinks()
{
    var links = document.getElementsByTagName('a');
    for(i = 0; i != links.length; i++)
    {
        links[i].onclick = function (e)
        {
            <do some work>
            return true;
        }
    }
} 
```

但是一些链接已经有一个应该保留的*onClick处理程序。*我尝试了以下方法：

```
function adaptLinks()
{
    var links = document.getElementsByTagName('a');
    for(i = 0; i != links.length; i++)
    {
        var oldOnClick = links[i].onclick;
        links[i].onclick = function (e)
        {
            if(oldOnClick != null && !oldOnClick())
            {
                return false;
            }
            <do some work>
            return true;
        }
    }
} 
```

但这不起作用，因为*oldOnClick*仅在调用处理程序时评估（它包含**最后一个**链接的值作为这一点）。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-21T09:18:00.483

不要直接分配给事件处理程序：改用订阅模型**addEventListener** / **attachEvent**（它们也有删除对！）。

很好的介绍[在这里](http://www.quirksmode.org/js/events_advanced.html)。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-05-21T16:39:32.777

您需要创建一个闭包来保留`onclick`每个链接的原始值：

```
<a href="#" onclick="alert('hi');return false;">Hi</a>
<a href="#" onclick="alert('there');return true;">There</a>
<script type="text/javascript">
function adaptLinks() {
    var links = document.getElementsByTagName('a');
    for (i = 0; i != links.length; i++) {
        links[i].onclick = (function () {
            var origOnClick = links[i].onclick;
            return function (e) {
                if (origOnClick != null && !origOnClick()) {
                    return false;
                }
                // do new onclick handling only if
                // original onclick returns true
                alert('some work');
                return true;
            }
        })();
    }
}
adaptLinks();
</script> 
```

请注意，如果原始 onclick 处理程序返回 true，则此实现仅执行新的 onclick 处理。如果这是您想要的，那很好，但请记住，如果您想执行新的 onclick 处理，即使原始处理程序返回 false，您也必须稍微修改代码。

在[comp.lang.javascript FAQ](http://www.jibbering.com/faq/faq_notes/closures.html)和[Douglas Crockford](http://www.crockford.com/javascript/private.html)中了解更多关于闭包的信息。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-21T09:18:18.330

[在addEventListener](https://developer.mozilla.org/En/DOM:element.addEventListener)（支持浏览器的 DOM）或[attachEvent](http://msdn.microsoft.com/en-us/library/ms536343(VS.85).aspx) (IE)周围使用包装器。

请注意，如果您想在变量中存储一个值而不覆盖旧值，您可以使用[闭包](http://www.jibbering.com/faq/faq_notes/closures.html)。

```
function chain(oldFunc, newFunc) {
  if (oldFunc) {
    return function() {
      oldFunc.call(this, arguments);
      newFunc.call(this, arguments);
    }
  } else {
    return newFunc;
  }
}

obj.method = chain(obj.method, newMethod); 
```

在[面向方面的编程](http://en.wikipedia.org/wiki/Aspect-oriented_programming)中，这被称为“[建议](http://en.wikipedia.org/wiki/Advice_in_aspect-oriented_programming)”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T09:19:28.873

设置怎么样`oldClick = links[i].onclick or an empty function`。像这样

```
var oldOnClick = links[i].onclick || function() { return true; };

links[i].onclick = function (e)
   {
       if (!oldOnClick())
           return false;
       //<do some work>
       return true;
   } 
```

或者你可以使用`attachEvent`和`addEventListener`其他人推荐的

```
function addEvent(obj, type, fn) {
        if (obj.addEventListener)
                obj.addEventListener(type, fn, false);
        else if (obj.attachEvent)
                obj.attachEvent('on' + type, function() { return fn.apply(obj, [window.event]);});
} 
```

并像这样使用

```
addEvent(links[i], 'click', [your function here]); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T11:14:52.213

使用 JQuery，以下代码有效：

```
function adaptLinks(table, sortableTable)
{
    $('a[href]').click(function (e)
    {
        if(!e.isDefaultPrevented())
        {
            <do some work>
        }
    });
} 
```

这需要使用额外的库，但可以避免 addEventListener/attachEvent 存在的一些问题（例如后者的[*this* references](http://www.quirksmode.org/js/events_advanced.html)问题）。

只有一个陷阱：如果原始的*onClick*处理程序是使用“普通”JavaScript 分配的，则该行

```
...
if(!e.isDefaultPrevented())
... 
```

将始终解析为**true**，即使原始处理程序通过返回 false 取消了事件。要解决此问题，原始处理程序也必须使用 JQuery。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-06T19:27:46.627

此功能应该可用（事件侦听器方法）：

```
function addEventListener(element, eventType, eventHandler, useCapture) {
    if (element.addEventListener) {
        element.addEventListener(eventType, eventHandler, useCapture);
        return true;
    } else if (element.attachEvent) {
        return element.attachEvent('on' + eventType, eventHandler);
    }
    element['on' + eventType] = eventHandler;
} 
```

或者您可以保存更多添加此函数的代码（如果您需要将相同的事件侦听器添加到许多元素）：

```
function addClickListener(element) {
    addEventListener(element, 'click', clickHandler, false);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-08T03:20:11.917

我在以简单的方式重载时遇到了问题 - 这个页面是一个很好的资源 [http://www.quirksmode.org/js/events_advanced.html](http://www.quirksmode.org/js/events_advanced.html)

# javascript - javascript到jquery

> ID：891990
> 
> 赞同：1
> 
> 时间：2009-05-21T09:02:08.207
> 
> 标签：javascript, jquery

这个函数调用 ResizeableTextbox('myRT'); 在 javascript 中运行良好（生成可调整大小的文本框），但在 jQuery 代码中不起作用。为什么？

这将产生可调整大小的文本框。

`<script type="text/javascript">`
ResizeableTextbox('myRT');
`</script>`

但是如果我在 jquery 代码中这样给出它，我不会得到可调整大小的文本框。

```
$(".select").change(function () {          
       $(".select"+increment+" option:selected").each(function ()    
       {              
         if($(this).text() =='String')
         {
           $("<label id=labelid >"+label+"</label>").appendTo(".menu li");    
           ResizeableTextbox('myRT');//this does not work.How else to code?
         }
       });
 }); 
```

jQuery中有没有函数调用的方法？

更新：

函数调用 ResizeableTextbox('myRT'); 在 jQuery 代码中的任何地方都不起作用。它只在内部起作用`<script>`。

这个函数调用怎么写？请有人帮帮我..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T09:06:05.750

您想将可调整大小的文本框附加到 .menu li 吗？你可以这样做：

```
var rt = new ResizeableTextbox('myRT'); //this is for making resizeable text box
$('.menu li').append(rt); 
```

但是我不太确定这是否是您不想要的。你的问题比较模糊。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T09:07:30.410

这很大程度上取决于 'rt' 将包含什么以及如何将其添加到 DOM 中。

如果它只包含 HTML，那么显然`$(parentSelector).html(rt)`可以解决问题。如果它返回一个 DOM 元素，那么`$(rt).appendTo(parentSelector);` 如果它是其他东西，或者被添加到`ResizeableTextbox`代码中的 DOM，那么我不可能猜到。

更新：如果您使用此处详述的可调整大小的文本框：[http](http://www.switchonthecode.com/tutorials/javascript-controls-resizeable-textbox) ://www.switchonthecode.com/tutorials/javascript-controls-resizeable-textbox那么您将使用以下代码：

```
$(document).ready(function() {
  var rt = new ResizeableTextbox();
  $('#resizable').append(rt.GetContainer());
  rt.StartListening();
}); 
```

# spring - 如何将 bean 属性绑定到另一个属性并观察 Spring Framework 中的变化

> ID：891998
> 
> 赞同：7
> 
> 时间：2009-05-21T09:03:51.337
> 
> 标签：spring, javabeans

我想知道是否有办法将spring bean的属性绑定到另一个bean的属性，所以如果在运行时绑定属性发生任何变化，我期望引用bean的属性也会发生变化。我会用一个小代码片段来解释更多。

```
<bean id="johnHome" class="example.Contact">
    <property name="电话" value="5551333" />
</豆>

<bean id="johnWork" class="example.Contact">
    <属性名称="电话">
        <util:property-path path="johnHome.phone" />
    </属性>
</豆>

```

好的。这适用于初始 bean 接线，但我真正想要的是绑定属性，因此如果属性在运行时发生更改，引用 bean 也会更改。如果我想用一个比喻来展示它会看起来像这样。

```
<bean id="johnHome" class="example.Contact">
    <property name="电话" value="5551333" />
</豆>

<bean id="johnWork" class="example.Contact">
    <属性名称="电话">
        <util:bind path="johnHome.phone" />
    </属性>
</豆>

```

我是否过多地超载了弹簧的概念，或者这是否可能没有很多技巧？

谢谢..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-01T21:48:17.213

最简单的方法 - 使该属性成为由其他两个 bean 引用的 bean，例如，对于 String 值具有 StringHolder 类：

```
public class StringHolder {
     private String value;

     // setter and getter elided due to author's lazyness

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-01T13:47:12.570

Spring 背后的整个想法是（曾经？）保持由普通的旧 java 对象组成的干净的面向对象设计，并使用 spring 框架来处理繁琐的对象创建。至于 AOP，这应该只处理横切关注点。我完全不相信这是 AOP 是一个好主意的情况之一。您的应用程序依赖于这些电话号码相互同步的行为，这是主要功能之一。因此，您的设计应该反映这一点。

处理此特定问题的最合乎逻辑的方法可能是将电话号码设为自己的类（如果您想区分不同类型的电话号码，这也很方便）。

如果您有一个将数字作为构造函数参数的 PhoneNumber 对象，则映射变得微不足道：

```
<bean id="johnFirstPhone" class="example.PhoneNumber">
  <constructor-arg value="5551333" />
</bean>

<bean id="johnHome" class="example.Contact">
  <property name="phone" ref="johnFirstPhone" />
</bean>

<bean id="johnWork" class="example.Contact">
  <property name="phone" ref="johnFirstPhone" />
</bean> 
```

当然，您是否将其映射到静态文件中是另一回事，但在这种情况下，您显然只需要一个引用/指针。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-21T15:01:30.587

我认为你在 Spring 2.5 中做的事情是不可能的。在Spring 3 中使用新的表达式语法*可能*是可能的，但我不这么认为。

即使是这样，我想也会令人困惑。最好将您的共享值粘贴到它自己的类中，并将该类的实例注入需要共享它的其他 bean。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-01T21:28:59.403

我能想到两种可能。

一个是（这是一种 hack），如果您没有很多 bean 需要像示例中的那样链接，您可以将 johnWork 注入 johnHome bean，并在 johnHome.setPhone 中更新johnWork 电话属性，例如：

```
public class Contact {
    private Contact myWorkContact;
    private String phone;

    public void setPhone(String phone) {
        this.phone = phone;
        if (this.myWorkContact != null) {
            this.myWorkContact.setPhone(phone);
        }
    }

    public void setWorkContact(Contact c) {
        this.myWorkContact = c;
    }
} 
```

或者您可以让 HomeContact 和 WorkContact 都扩展一个类 Contact 并对其进行相同的注入。

如果您有大量需要这个的bean（例如，如果您的应用程序实际上正在处理联系信息），那么使用AOP（对于给出的示例，您将需要AspectJ）我认为您可以做这样的事情（它将是如果您获得大量对象，则会占用大量内存，但您可以看到类似的东西是如何工作的）：

**警告：这实际上很快就变得复杂了，但我很确定在你解决了一些问题之后它会起作用**

```
public class Contact {
    ...

    private String phone;
    private String name;
    private Integer id;

    public Contact(Integer id, String name, String phone) {
        this.phone = phone;
        this.name = name;
        this.id = id;
    }

    public void setPhone(String phone) {
        this.phone = phone.
    }

    //Other getters, setters, etc

    ...
}

@Aspect
public class ContactPhoneSynchronizer {
    //there is probably a more efficient way to keep track of contact objects
    //but right now i can't think of one, because for things like a tree, we need to 
    //be able to identify objects with the same name (John Smith), but that
    //have different unique ids, since we only want one of each Contact object
    //in this cache.

    private List<Contact> contacts = Collections.synchronizedList(new ArrayList<Contact>());

    /**
        This method will execute every time someone makes a new Contact object.
        If it already exists, return it from the cache in this.contacts.  Otherwise,
        proceed with the object construction and put that object in the cache.
    **/

    @Around("call(public Contact.new(Integer,String,String)) && args(id,name,phone)")
    public Object cacheNewContact(ProceedingJoinPoint joinPoint, Integer id, String name, String phone) {
        Contact contact = null;

        for (Contact c : contacts) {
            if (id.equals(c.getId()) {
                contact = c;
                break;
            }
        }

        if (contact == null) {
            contact = (Contact) joinPoint.proceed();
            this.contacts.add(contact);            
        }

        return contact;
    }

    /**This should execute every time a setPhone() method is executed on 
        a contact object.  The method looks for all Contacts of the same
        name in the cache and then sets their phone number to the one being passed
        into the original target class.

        Because objects are passed by reference until you do a reassociation, 
        calling c.setPhone on the object in the cache should update the actual
        instance of the object in memory, so whoever has that reference will
        get the updated information.
    **/

    @After("execution(example.Contact.setPhone(String) && args(phone)")
    public void syncContact(JoinPoint joinPoint, String phone) {
        Contact contact = joinPoint.getTarget();

        for (Contact c : this.contacts) {
            if (c.getName().equals(contact.getName()) {
                c.setPhone(phone);
            }
        }
    }
} 
```

同样，可能有 100 种方法可以优化它，因为我是在脑海中输入它；也就是说，如果你一开始就想走这条路。理论上它应该可以工作，但我根本没有测试过。

总之，春节快乐！

# c# - 实体框架 + AutoMapper（实体到 DTO 和 DTO 到实体）

> ID：891999
> 
> 赞同：22
> 
> 时间：2009-05-21T09:03:53.630
> 
> 标签：c#, entity-framework, automapper, dto

我在使用带有 AutoMapper 的 EF 时遇到了一些问题。=/

例如 ：

我有 2 个相关实体（客户和订单），它们是 DTO 类：

```
 class CustomerDTO
{
   public string CustomerID {get;set;}
   public string CustomerName {get;set;}
   public IList< OrderDTO > Orders {get;set;}
}

class OrderDTO
{
   public string OrderID {get;set;}
   public string OrderDetails {get;set;}
   public CustomerDTO Customers {get;set;}
}

//when mapping Entity to DTO the code works
Customers cust = getCustomer(id);
Mapper.CreateMap< Customers, CustomerDTO >();
Mapper.CreateMap< Orders, OrderDTO >();
CustomerDTO custDTO = Mapper.Map(cust); `//but when i try to map back from DTO to Entity it fails with AutoMapperMappingException.
Mapper.Reset();
Mapper.CreateMap< CustomerDTO , Customers >();
Mapper.CreateMap< OrderDTO , Orders >();
Customers customerModel = Mapper.Map< CustomerDTO ,Customers >(custDTO); // exception is thrown here` 

```

难道我做错了什么？

提前致谢 ！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2010-05-28T17:59:19.400

The problem I had was related to updates to EntityCollection references. AutoMapper creates a new instance of the relation when mapping from the DTO to the Entity, and that doesn't please the EF.

What solved my problem was configuring AutoMapper to use the destination value for my EntityCollection properties. In your case:

```
Mapper.CreateMap< CustomerDTO , Customers >().ForMember(c => c.Orders, o => o.UseDestinationValue()); 
```

That way AM will not create a new EntityCollection instance, and will use that wich came with the original Customer entity.

I'm still working for a way to automate this, but for now it solves my problem.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-12-29T15:32:55.590

尝试映射到现有对象：

```
entity = Mapper.Map<MyDTO, NyEntity>(dto, entity); 
```

并保持 Ignore() 就位。

[http://groups.google.com/group/automapper-users/browse_thread/thread/24a90f22323a27bc?fwc=1&pli=1](http://groups.google.com/group/automapper-users/browse_thread/thread/24a90f22323a27bc?fwc=1&pli=1)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-11-05T14:54:34.167

您的问题是因为 Automapper 丢失了与记录关联的 EntityKey。由于 EntityFramework 默认情况下不处理 POCO（普通旧 CLR 对象）

Jay Zimmerman 有一个很好的例子来说明如何处理这个问题。gd /4NIcj 也来自 Jaroslaw Kowalski（我相信是 EF 团队的一部分）有这个在 EF 中使用 POCO 的示例，它可以很好地与 Automapper 一起使用（我还没有机会尝试）：[http：/ /blogs.msdn.com/jkowalski/archive/2008/09/09/persistence-ignorance-poco-adapter-for-entity-framework-v1.aspx](http://blogs.msdn.com/jkowalski/archive/2008/09/09/persistence-ignorance-poco-adapter-for-entity-framework-v1.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-21T09:21:22.567

我不确定你的问题是什么，但是 - 当我想使用 LINQToEntities（切换到 NHibernate）时，
我成功地使用了 automapper。

看一下代码：

```
public class SimpleMapper<TFrom, TTo>
{
    public static TTo Map(TFrom fromModel)
    {
        Mapper.CreateMap<TFrom, TTo>();
        return Mapper.Map<TFrom, TTo>(fromModel);
    }

    public static IList<TTo> MapList(IList<TFrom> fromModel)
    {
        Mapper.CreateMap<TFrom, TTo>();
        return Mapper.Map<IList<TFrom>, IList<TTo>>(fromModel);
    }
}

public class RepositoryBase<TModel, TLINQModel>
{
    public IList<TModel> Map<TCustom>(IList<TCustom> model)
    {
        return SimpleMapper<TCustom, TModel>.MapList(model);
    }

    public TModel Map(TLINQModel model)
    {
        return SimpleMapper<TLINQModel, TModel>.Map(model);
    }

    public TLINQModel Map(TModel model)
    {
        return SimpleMapper<TModel, TLINQModel>.Map(model);
    }

    public IList<TModel> Map(IList<TLINQModel> model)
    {
        return SimpleMapper<TLINQModel, TModel>.MapList(model);
    }

    public IList<TLINQModel> Map(IList<TModel> model)
    {
        return SimpleMapper<TModel, TLINQModel>.MapList(model);
    }
} 
```

它非常神秘，总是重新创建映射，但它确实有效。我希望它以某种方式有所帮助。:)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-02-03T11:47:23.210

现在，使用新版本的 AutoMapper，推荐的方法是使用[Queryable-Extensions](https://github.com/AutoMapper/AutoMapper/wiki/Queryable-Extensions)：

> 当使用诸如 NHibernate 或实体框架之类的 ORM 和 AutoMapper 的标准 Mapper.Map 函数时，您可能会注意到，当 AutoMapper 尝试将结果映射到目标类型时，ORM 将查询图**中所有对象的所有字段。**
> 
> 如果您的 ORM 公开 IQueryables，您可以使用 AutoMapper 的 QueryableExtensions 辅助方法来解决这个关键问题。
> 
> .ProjectTo() 将告诉 AutoMapper 的映射引擎向 IQueryable 发出一个选择子句，该子句将通知实体框架它只需要查询 Item 表的 Name 列，就像您手动将 IQueryable 投影到 OrderLineDTO 一样选择子句。

创建映射：

```
Mapper.CreateMap<Customer, CustomerDto>(); 
```

并将项目查询到 dto：

```
var customerDto = 
   session.Query<Customer>().Where(customer => customer.Id == id)
   .Project().To<CustomerDto>()
   .Single(); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-10-07T15:29:42.503

您应该忽略一些实体属性的映射，如下所示：

```
Mapper.CreateMap<CustomerDto, Customer>()
                .ForMember(dest => dest.EntityKey, opt => opt.Ignore())
                .ForMember(dest => dest.Licenses, opt => opt.Ignore())
                .ForMember(dest => dest.AccessCodes, opt => opt.Ignore()); 
```

如果您检查 Automapper 引发的异常的消息，您应该会看到无法映射的实体属性并如上所述忽略它们。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-10-18T17:09:50.327

AutoMapper 在映射错误方面非常有表现力。仔细阅读异常消息。

另一个重要的事情是记住调用 Mapper.AssertConfigurationIsValid(); 创建映射后。如果映射错误，它会给出错误，从而防止稍后在应用程序运行时出现异常。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-01-18T20:17:59.167

如您[在此处](http://visualstudiomagazine.com/blogs/tool-tracker/2013/11/updating--entities-with-automapper.aspx)阅读的，您需要执行以下操作

您可以使用 AutoMapper 更新实体。方法如下：将 DTO 和实体对象都传递给 AutoMapper 的 Map 方法。这就是这段代码的作用：

```
custExisting = Mapper.Map(Of CustomerDTO,  Customer)(custDTO, custExisting) 
```

[还要注意此处](http://www.codeproject.com/Articles/576393/Solutionplusto-3aplus-22Theplusoperationplusfailed)描述的映射问题

这些技巧对我有用。*****************************