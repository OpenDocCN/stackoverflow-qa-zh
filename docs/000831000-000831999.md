# StackOverflow 问答 000831000-000831999

# c - 从 FILE * 中确定（打开的）文件名

> ID：831004
> 
> 赞同：3
> 
> 时间：2009-05-06T18:28:09.097
> 
> 标签：c, stdio

给定一个 stdio`FILE *`指针，是否有一种方法可以让我发现（打开的）文件的名称？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T18:42:04.850

它看起来（从[这里](http://coding.derkeiler.com/Archive/C_CPP/comp.lang.c/2008-09/msg00751.html)）在 POSIX 系统上，您可以使用 fileno() 从 FILE* 获取文件描述符，然后使用 fstat 从文件描述符获取统计信息。stat结构包含设备号和inode号。您可以检查文件系统中与 inode 匹配的文件。对于一个充满东西的文件系统，这显然需要一些时间。

这实际上不可能的原因（如链接文章中所解释的）是，如果流是标准输入或标准输出之类的东西，或者它是已被删除的打开文件，则流可以没有文件名。由于硬链接，它也可以有多个名称。

链接的文章提到[了这个 comp.lang.c 常见问题解答](http://www.it.usyd.edu.au/~dasymond/mirror/c-faq/osdep/fdfilename.html)，它简要概述了这个问题的不可解决性。

编辑：感谢您的更正。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T18:31:30.803

不，没有。除此之外，FILE * 可能不引用命名文件。如果您的应用程序需要此功能，您将需要维护某种从打开的 FILE *s 到您用来打开它们的文件名的映射。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T18:38:45.077

没有标准定义的便携式解决方案。但是，您可以查看操作系统提供的 API 集。POSIX 系统有一个`fstat`函数，它接受一个描述符（不是 a `FILE *`）并返回一些信息。

# c# - 多参数线程

> ID：831009
> 
> 赞同：41
> 
> 时间：2009-05-06T18:29:07.673
> 
> 标签：c#, .net, multithreading, parameters, thread-safety

有谁知道如何将多个参数传递给 Thread.Start 例程？

我想过扩展这个类，但是 C# Thread 类是密封的。

这是我认为代码的样子：

```
...
    Thread standardTCPServerThread = new Thread(startSocketServerAsThread);

    standardServerThread.Start( orchestrator, initializeMemberBalance, arg, 60000);
...
}

static void startSocketServerAsThread(ServiceOrchestrator orchestrator, List<int> memberBalances, string arg, int port)
{
  startSocketServer(orchestrator, memberBalances, arg, port);
} 
```

顺便说一句，我用不同的编排器、平衡和端口启动了许多线程。请考虑线程安全。

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-05-06T18:32:18.273

尝试使用 lambda 表达式来捕获参数。

```
Thread standardTCPServerThread = 
  new Thread(
    unused => startSocketServerAsThread(initializeMemberBalance, arg, 60000)
  ); 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-04-10T04:01:55.433

这是一段代码，它使用了这里多次提到的对象数组方法。

```
 ...
    string p1 = "Yada yada.";
    long p2 = 4715821396025;
    int p3 = 4096;
    object args = new object[3] { p1, p2, p3 };
    Thread b1 = new Thread(new ParameterizedThreadStart(worker));
    b1.Start(args);
    ...
    private void worker(object args)
    {
      Array argArray = new object[3];
      argArray = (Array)args;
      string p1 = (string)argArray.GetValue(0);
      long p2 = (long)argArray.GetValue(1);
      int p3 = (int)argArray.GetValue(2);
      ...
    }> 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-05-06T18:31:35.030

您需要将它们包装成一个对象。

制作一个自定义类来传递您的参数是一种选择。您还可以使用数组或对象列表，并在其中设置所有参数。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-06T18:35:42.713

使用“任务”模式：

```
public class MyTask
{
   string _a;
   int _b;
   int _c;
   float _d;

   public event EventHandler Finished;

   public MyTask( string a, int b, int c, float d )
   {
      _a = a;
      _b = b;
      _c = c;
      _d = d;
   }

   public void DoWork()
   {
       Thread t = new Thread(new ThreadStart(DoWorkCore));
       t.Start();
   }

   private void DoWorkCore()
   {
      // do some stuff
      OnFinished();
   }

   protected virtual void OnFinished()
   {
      // raise finished in a threadsafe way 
   }
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-11-18T15:50:23.477

JaredPar 答案的 .NET 2 转换

```
Thread standardTCPServerThread = new Thread(delegate (object unused) {
        startSocketServerAsThread(initializeMemberBalance, arg, 60000);
    }); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-12-24T11:57:08.443

```
void RunFromHere()
{
    string param1 = "hello";
    int param2 = 42;

    Thread thread = new Thread(delegate()
    {
        MyParametrizedMethod(param1,param2);
    });
    thread.Start();
}

void MyParametrizedMethod(string p,int i)
{
// some code.
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-06T18:31:48.197

你不能。创建一个包含您需要的参数的对象，然后通过它。在线程函数中，将对象转换回其类型。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-08-06T12:16:41.720

我一直在阅读您的论坛以了解如何做到这一点，并且我以这种方式做到了 - 可能对某人有用。我在构造函数中传递参数，它为我创建将在其中执行我的方法的工作线程 - **execute()**方法。

```
 using System;

using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Diagnostics;
using System.Windows.Forms;
using System.IO;
using System.Threading;
namespace Haart_Trainer_App

{
    class ProcessRunner
    {
        private string process = "";
        private string args = "";
        private ListBox output = null;
        private Thread t = null;

    public ProcessRunner(string process, string args, ref ListBox output)
    {
        this.process = process;
        this.args = args;
        this.output = output;
        t = new Thread(new ThreadStart(this.execute));
        t.Start();

    }
    private void execute()
    {
        Process proc = new Process();
        proc.StartInfo.FileName = process;
        proc.StartInfo.Arguments = args;
        proc.StartInfo.UseShellExecute = false;
        proc.StartInfo.RedirectStandardOutput = true;
        proc.Start();
        string outmsg;
        try
        {
            StreamReader read = proc.StandardOutput;

        while ((outmsg = read.ReadLine()) != null)
        {

                lock (output)
                {
                    output.Items.Add(outmsg);
                }

        }
        }
        catch (Exception e) 
        {
            lock (output)
            {
                output.Items.Add(e.Message);
            }
        }
        proc.WaitForExit();
        var exitCode = proc.ExitCode;
        proc.Close();

    }
}
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-06T18:31:48.650

您可以获取 Object 数组并将其传递到线程中。经过

```
System.Threading.ParameterizedThreadStart(yourFunctionAddressWhichContailMultipleParameters) 
```

进入线程构造函数。

```
yourFunctionAddressWhichContailMultipleParameters(object[]) 
```

您已经在 objArray 中设置了所有值。

你需要`abcThread.Start(objectArray)`

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-06T18:33:37.693

您可以使用 lambda 表达式对“工作”函数进行 curry：

```
public void StartThread()
{
    // ...
    Thread standardTCPServerThread = new Thread(
        () => standardServerThread.Start(/* whatever arguments */));

    standardTCPServerThread.Start();
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-10-23T23:44:17.727

您需要传递一个对象，但如果定义自己的对象以供一次性使用太麻烦，您可以使用**Tuple**。

# c# - C# 使用 Exchange 打开带有附件的空白电子邮件

> ID：831012
> 
> 赞同：0
> 
> 时间：2009-05-06T18:30:00.790
> 
> 标签：c#, email, outlook, exchange-server

我是 C# 编程世界的新手，但希望有人能帮助我。

我正在尝试使用 C# 在 Outlook 中打开一封带有指定附件的空白电子邮件。
换句话说，打开电子邮件，TO: 和 SUBJECT: 字段是空白的，但电子邮件有我的代码中指定的附件。我希望我的用户能够修改电子邮件并发送给他/她指定的任何用户。我确定我们有 Exchange....所以有什么想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T18:52:25.823

我认为交换不会对您有太大帮助，您需要在用户机器上使用 Outlook。您可以添加对 Outlook 互操作程序集的引用，应该在添加引用对话框的 Com 选项卡中。

这里有一些链接可以帮助您快速入门。

[http://msdn.microsoft.com/en-us/library/microsoft.office.interop.outlook.aspx](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.outlook.aspx) [http://www.microeye.com/resources/res_tech_vsnet.htm](http://www.microeye.com/resources/res_tech_vsnet.htm)

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T19:21:29.950

有很多方法可以做到这一点。

创建一个 Outlook 插件，通过说一个新的工具栏按钮打开一封带有您想要的附件的新邮件。

在 Outlook VBA 宏中执行相同操作..

您也可以创建一个已经包含附件的新表单，然后只使用该表单。（但附件将被硬编码等）

附件有变化吗？还是每次都一样？你用的是什么outlook版本？你有什么编程能力？

76梅尔

# javascript - Dean Edwards 的 ie7-js 有多可行？

> ID：831016
> 
> 赞同：10
> 
> 时间：2009-05-06T18:30:58.277
> 
> 标签：javascript, internet-explorer, internet-explorer-6

我刚刚发现了 ie7-js ；

> IE7 是一个 JavaScript 库，用于使 Microsoft Internet Explorer 的行为类似于符合标准的浏览器。它修复了许多 HTML 和 CSS 问题，并使透明 PNG 在 IE5 和 IE6 下正常工作。

[http://code.google.com/p/ie7-js/](http://code.google.com/p/ie7-js/)

看起来真的很不错，但真的有效吗（当前的[问题列表](http://code.google.com/p/ie7-js/issues/list)看起来很吓人）？您是否已经成功使用它？

另一个问题是脚本在 IE 中制作网站的速度有多慢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T23:56:26.343

在静态页面中它工作得很好。如果您使用现代浏览器和标准设计了几个静态 html 页面，并希望它在 IE6 和 7 中正确显示，那么这个脚本会帮助您。

但是，这是一个很大的但是，如果你在菜谱中添加一点 javascript，这个方法就会显示出它的弱点。稍后添加到它们 DOM 的任何内容或之后触发的任何事件都不会受到此脚本的影响。

就是这样。我的一条建议是，如果您有简单而轻量的页面，请使用它。否则尝试通过查看根源来解决您的问题！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T19:06:00.503

我认为最好的答案是：在您的网站上尝试一下，看看它是否适用于您的特定代码。如果它有效，并且不影响速度，那很好，你就完成了。如果它不起作用，那么您将不得不花时间让您的网站在 IE 中运行。

# jquery - jQuery：悬停时交叉淡入淡出图像

> ID：831018
> 
> 赞同：2
> 
> 时间：2009-05-06T18:31:12.067
> 
> 标签：jquery, image, fade

我正在尝试实现会影响两个图像的“淡入”脚本：

```
<script type="text/javascript">

  $(document).ready(function(){

        $('img').mouseover( function() {

              $(this).fadeOut(200, function() {

                    $(this).attr({'src':'http://example/images/image.png'});

               if (this.complete) $(this).fadeIn(500);

              });
        });

  });

</script> 
```

这段 jQuery 给了我以下信息：

1 - 首先图像淡出并消失 2 - 然后，它从空白处出现新的。

所以我想改进脚本以获得真正的“淡入”效果。

到目前为止，我一直在探索两个很棒的资源：

*   [循环插件](http://malsup.com/jquery/cycle/)- 非常酷（我会尝试在悬停时获得循环效果）
*   [JQuery for Designers](http://jqueryfordesigners.com/image-cross-fade-transition/)很酷，但是我在 IE 上遇到了很多问题（fadeIn 上有一个奇怪的黑色像素化边框）。

如果有人能指出最终的额外解决方案，非常感谢。

简

**编辑**：这里的 CSS 技巧/解决方案[http://paragraphe.org/stackoverflowdemos/crossfade-images/](http://paragraphe.org/stackoverflowdemos/crossfade-images/)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T18:53:10.237

您调用第二个淡入淡出的方式，作为对原始淡入淡出的回调将保证它们一个接一个地执行。

可能会有更多的运气

```
$('img').mouseover( function() {
          $(this).fadeOut(200);
          $(this).attr({'src':'http://example/images/image.png'});
          if (this.complete) $(this).fadeIn(500);
        }); 
```

尽管您仍然会随心所欲地考虑第二张图片的加载时间，除非它被预加载到某个地方。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-01T13:13:03.850

最近我找到了一个以 CSS 为重点的解决方案：绝对将图像“放在”另一个图像上，在 Document 就绪时使用 jQuery 将其淡化为 0，并在鼠标悬停时淡入到完全/在 mouseout 时再次淡入到 0。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T18:58:08.743

这是一种冗长的修复，但这是我为获得平滑渐变所做的。我使用 Fadeout，然后作为回调，我使用 $.ajax 实际加载新图像，然后使用 success: 函数将其添加到 div（或 img），然后使用 complete: 函数将其淡化in. 这会导致平滑的淡出-新内容-淡入动作。

下面是一个加载php文件的例子，原理和图片一样：

```
$("#leftbar").fadeOut("normal", function() {
$.ajax({
    url: "bin/leftBar.php",
    cache: "false",
    success: function(data) {
        $("#leftbar").html(data);
    },
    complete: function() {
        $("#leftbar").fadeIn("normal");
    }
}); 
```

# .net - 适用于 .NET 的 UniData 数据访问产品

> ID：831019
> 
> 赞同：4
> 
> 时间：2009-05-06T18:31:26.030
> 
> 标签：.net, database, unidata, uniobjects

我正在研究如何从 .NET 代码访问 UniData 数据库中的数据。

根据我的发现，我可以将[UniObjects 用于 .NET](http://www-01.ibm.com/software/data/u2/middleware/index.html#uniobjects-n)和[U2.NET](http://www-01.ibm.com/software/data/u2/u2-net/)。我也找到[了这个信息](http://www.ibm.com/developerworks/data/library/techarticle/dm-0903linqentity/index.html?S_TACT=105AGX11&S_CMP=LP)，我认为使用 U2.NET 是可能的，但我不太确定。

我也不确定这些产品的成本，如果它们是免费的，如何下载它们。

谁能回答这些问题并指出它们之间的区别是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-06T15:06:06.540

UniObjects for .NET 是免费的，是[UniData](http://www.intl-spectrum.com/database/8/UniData.aspx) Client CD 的一部分。U2.NET 是一种付费产品，实际上是 BluFinity 的 MV.NET 重新包装并以 IBM 名义销售。

U2.NET 比 UniObjects for .NET 有更多的功能。UniObjects for .NET 基本上是将核心 UniData API 重铸为 .NET... 文件（表）打开、动态数组、读/写/删除记录、OCONV/ICONV、子程序调用、执行等

U2.NET 采用 UniObjects 提供的核心并对其进行扩展，以轻松使 DataSets 和 Class、SISS 和其他 .NET 功能更易于访问

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-14T02:05:40.070

看到[这个](https://stackoverflow.com/questions/1126574/where-to-get-uniobjects-for-net)问题：

如果您有 Unidata，您应该有 CD 的副本，或者至少有客户端工具的安装包。不过，您可能需要与系统管理员交谈才能找到它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T21:37:37.220

您可能想查看[jBase mv.NET](http://www.jbase.com/products/mvnet.html)。不久前，我们评估了它是否可以使用 ADO.NET 从 .NET 访问 IBM UniVerse 数据库。它在我们的测试中表现不错，但项目被取消了，所以我们从来没有使用过它。

# image - 在我的图像地图上显示点

> ID：831027
> 
> 赞同：0
> 
> 时间：2009-05-06T18:31:59.617
> 
> 标签：image, map

这是我的简要情况：

我正在制作一家餐馆的网站。

餐厅老板将上传他餐厅的平面图图像。（例如：[http](http://cache.smartdraw.com/examples/content/Examples/SmartDraw/Floor_Plans/Restaurant_Plans/Family_Restaurant_Plan_L.jpg) ://cache.smartdraw.com/examples/content/Examples/SmartDraw/Floor_Plans/Restaurant_Plans/Family_Restaurant_Plan_L.jpg ）然后他会在图像上标记是桌子可供预订的是。这些坐标将保存在我的数据库中。

另一方面，用户将能够点击这些点（表格）并预订一张桌子。图像地图坐标将根据餐厅老板提交的点数动态创建。**因此我不能有一个已经有图标的图像。**

有没有一种方法可以在坐标所在的图像地图上显示某种图标？为了使点对用户可见。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-12-26T17:08:57.340

我认为您可以在这种情况下使用 ItemizedOverlay 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T19:04:49.740

我能想到几个选择：

1.  在您的服务器上生成图像映射，使用 PHP 的 GD 之类的东西，并将图标放置在您想要的位置
2.  使用 Javascript/CSS 将图标定位在 HTML 页面中您想要的位置
3.  使用 Flash 动态生成图标

# mercurial - Mercurial：如何管理公共/共享代码

> ID：831028
> 
> 赞同：8
> 
> 时间：2009-05-06T18:32:10.333
> 
> 标签：mercurial

我将 Mercurial 用于个人用途，出于各种原因，我正在考虑将其用于一些分布式项目作为 SVN 的替代品。

我已经习惯了将它用于自包含项目，并且可以看到各种共享选项，但是我还没有找到任何关于管理公共库以包含在多个项目中的指南，其方式类似于 subversion 中的外部提供的方式。

最明显的共享代码块是错误处理和报告——我们希望这在所有项目中几乎相同（它发展得相当好）。还有实用程序代码、控制库和类似的东西，我们发现将它们作为每个解决方案构建的项目比作为编译类引入更好（尤其是因为它确保它们保持最新，持续集成帮助我们解决重大变化） .

想法（我讨厌开放式问题，但我想知道其他人在做什么，如果有的话）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-10T18:29:33.257

Mercurial 1.3 现在包括 [嵌套存储库支持](http://mercurial.selenic.com/wiki/NestedRepositories)，可用于表达依赖关系。另一种选择是让您的构建系统使用诸如 ivy 或 maven 之类的东西来处理依赖项的下载和跟踪，尽管它们更专注于提取已编译的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-07-26T12:44:24.190

自从我提出这个问题以来，世界已经发生了变化，而我现在使用的解决方案也不同了。

现在简单的答案是使用包（特别是像我使用 .NET 一样的 NuGet）来交付通用代码，而不是嵌套存储库并将项目包含在解决方案中。

因此，我将公共代码内置到 NuGet 包中并使用 TeamCity 托管，以前我会有一个外部并包含项目/源代码，我现在只需引用该包。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T18:44:26.233

使用它模拟 HG 的 svn 外部的[Forest Extension](http://www.selenic.com/mercurial/wiki/index.cgi/ForestExtension)，在某种程度上就是这样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-26T14:22:11.837

[子存储](https://bitbucket.org/selinc/guestrepo)库（有良好的[指导](http://mercurial.aragost.com/kick-start/en/subrepositories/)）或[Guestrepo](http://mercurial.selenic.com/wiki/Subrepository) “克服......限制”（子存储库）是今天与语言无关的答案

# javascript - 如何在 JavaScript 中获取“GET”请求参数？

> ID：831030
> 
> 赞同：86
> 
> 时间：2009-05-06T18:32:36.433
> 
> 标签：javascript

如何从 JavaScript 中的请求中获取“GET”变量？

jQuery 还是 YUI！有内置这个功能吗？

* * *

## 回答 #1

> 赞同：189
> 
> 时间：2009-05-06T18:38:38.697

**2021 年 6 月更新：**

[今天的浏览器具有用于处理 URL ( URL](https://developer.mozilla.org/en-US/docs/Web/API/URL) ) 和查询字符串 ( [URLSearchParams](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams) )的内置 API，这些应该是首选，除非您需要支持一些旧浏览器或 Opera mini ( [Browser support](https://caniuse.com/?search=URLSearchParams) )。

**原来的：**

所有数据均可在

```
window.location.search 
```

你必须解析字符串，例如。

```
function get(name){
   if(name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
      return decodeURIComponent(name[1]);
} 
```

只需使用 GET 变量名作为参数调用函数，例如。

```
get('foo'); 
```

如果变量没有值或不存在，此函数将返回变量值或未定义

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2011-01-04T21:23:54.930

你可以使用`jquery.url`I did like this：

```
var xyz = jQuery.url.param("param_in_url"); 
```

[检查源代码](https://github.com/allmarkedup/jQuery-URL-Parser/blob/master/jquery.url.js)

更新来源：[https ://github.com/allmarkedup/jQuery-URL-Parser](https://github.com/allmarkedup/jQuery-URL-Parser)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2017-09-14T05:47:38.930

试试下面的代码，它将帮助您从 url 获取 GET 参数。 [更多细节。](https://developers.google.com/web/updates/2016/01/urlsearchparams)

```
 var url_string = window.location.href; // www.test.com?filename=test
    var url = new URL(url_string);
    var paramValue = url.searchParams.get("filename");
    alert(paramValue) 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2013-03-28T09:54:13.723

如果您想要一个包含所有请求的对象，只需投入我的两分钱

```
function getRequests() {
    var s1 = location.search.substring(1, location.search.length).split('&'),
        r = {}, s2, i;
    for (i = 0; i < s1.length; i += 1) {
        s2 = s1[i].split('=');
        r[decodeURIComponent(s2[0]).toLowerCase()] = decodeURIComponent(s2[1]);
    }
    return r;
};

var QueryString = getRequests();

//if url === "index.html?test1=t1&test2=t2&test3=t3"
console.log(QueryString["test1"]); //logs t1
console.log(QueryString["test2"]); //logs t2
console.log(QueryString["test3"]); //logs t3 
```

请注意，每个 get 参数的键都设置为小写。所以，我做了一个辅助函数。所以现在它不区分大小写。

```
function Request(name){
    return QueryString[name.toLowerCase()];
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-06T18:35:43.307

您可以使用 URL 来获取 GET 变量。特别是，`window.location.search`在“？”之后（包括）给出所有内容。[您可以在此处](https://developer.mozilla.org/en/window.location)阅读有关 window.location的更多信息。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2020-10-25T13:57:40.950

与其他答案不同，该[`UrlSearchParams`](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams)对象可以避免使用正则表达式或其他字符串操作，并且适用于大多数现代浏览器：

```
var queryString = location.search
let params = new URLSearchParams(queryString)
// example of retrieving 'id' parameter
let id = parseInt(params.get("id"))
console.log(id) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-03-04T13:50:12.227

map-reduce 解决方案：

```
var urlParams = location.search.split(/[?&]/).slice(1).map(function(paramPair) {
        return paramPair.split(/=(.+)?/).slice(0, 2);
    }).reduce(function (obj, pairArray) {            
        obj[pairArray[0]] = pairArray[1];
        return obj;
    }, {}); 
```

用法：

```
For url: http://example.com?one=1&two=2
console.log(urlParams.one) // 1
console.log(urlParams.two) // 2 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-07-06T15:36:34.430

[今天我需要将页面的请求参数放入一个关联数组中，所以在朋友的](https://stackoverflow.com/a/520845)[帮助](https://stackoverflow.com/a/520845)下，[我](https://stackoverflow.com/a/432503) 整理了以下内容。它还处理没有as的参数。`=``true`

举个例子：

```
// URL: http://www.example.com/test.php?abc=123&def&xyz=&something%20else

var _GET = (function() {
    var _get = {};
    var re = /[?&]([^=&]+)(=?)([^&]*)/g;
    while (m = re.exec(location.search))
        _get[decodeURIComponent(m[1])] = (m[2] == '=' ? decodeURIComponent(m[3]) : true);
    return _get;
})();

console.log(_GET);
> Object {abc: "123", def: true, xyz: "", something else: true}
console.log(_GET['something else']);
> true
console.log(_GET.abc);
> 123 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-06T18:34:01.843

您可以通过解析当前页面的 URL 来获取 GET 参数。可以使用 找到该 URL `location.href`。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-06T18:55:22.133

如果您已经使用 jquery，则有一个 jquery 插件可以处理此问题：

[http://plugins.jquery.com/project/query-object](http://plugins.jquery.com/project/query-object)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-12-22T13:51:50.700

为我工作

网址：[http://localhost:8080/#/?access_token=111](http://localhost:8080/#/?access_token=111)

```
function get(name){
  const parts = window.location.href.split('?');
  if (parts.length > 1) {
    name = encodeURIComponent(name);
    const params = parts[1].split('&');
    const found = params.filter(el => (el.split('=')[0] === name) && el);
    if (found.length) return decodeURIComponent(found[0].split('=')[1]);
  }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-08-03T13:42:59.507

这里的函数按名称返回参数。通过微小的更改，您将能够返回基本 url、参数或锚点。

```
function getUrlParameter(name) {
    var urlOld          = window.location.href.split('?');
    urlOld[1]           = urlOld[1] || '';
    var urlBase         = urlOld[0];
    var urlQuery        = urlOld[1].split('#');
    urlQuery[1]         = urlQuery[1] || '';
    var parametersString = urlQuery[0].split('&');
    if (parametersString.length === 1 && parametersString[0] === '') {
        parametersString = [];
    }
    // console.log(parametersString);
    var anchor          = urlQuery[1] || '';

    var urlParameters = {};
    jQuery.each(parametersString, function (idx, parameterString) {
        paramName   = parameterString.split('=')[0];
        paramValue  = parameterString.split('=')[1];
        urlParameters[paramName] = paramValue;
    });
    return urlParameters[name];
} 
```

# sql-server - 当表 A 依赖于表 B 时如何向表 A 插入新记录，反之亦然

> ID：831031
> 
> 赞同：0
> 
> 时间：2009-05-06T18:32:37.993
> 
> 标签：sql-server, database-design

我不确定这是否设计得很好，如果不是，请告诉我如何做到这一点。

*   我正在使用 Sql Server 2008

我有：

```
TableA (TableA_ID int identity PK, Value varchar(10), TableB_ID PK not null)
TableB (TableB_ID int identity PK, Value varchar(10), TableA_ID PK not null) 
```

目标很简单：

*   只有在 TableB 中至少有 1 行与 TableA 关联时，TableA 才能有行；
*   并且对于TableB中的每一行，在TableA中必须有与之关联的行）；

TableA 是“父表”，TableB 是“子表”，就像一个父级应该有 1 个或多个子级，每个子级只能有 1 个父级。

这是正确的吗？

我遇到的问题是当我尝试执行 INSERT 语句时，如果这是正确的，我应该如何进行 INSERT？暂时禁用约束？

谢谢！

我遇到的问题是当我尝试插入

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T18:40:08.660

```
TableA (TableA_ID int identity PK, Value varchar(10))
TableB (TableB_ID int identity PK, Value varchar(10), TableA_ID not null) 
```

作为父表，表 a 不需要引用表 b，因为表 be 要求表 a 中有一个字段。这称为一对多关系。

所以在表a中你可能有这些值：

```
1 a
2 b
3 c 
```

在表 b 中你可以有这些：

```
1 asdf 1
2 sdfg 1
3 pof 2
4 dfgbsd 3 
```

现在您可以进行查询以显示表 a 中的数据：

```
select b.TableB_ID, b.Value, a.TableA_ID, a.Value
from TableB b
inner join TableA
on b.TableA_ID=a.TableA_ID 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-17T21:34:32.860

我会将插入内容放入 proc 中：禁用约束、插入数据、启用约束。您可能需要确保这是在禁用约束时唯一正在进行的事务。

这可以通过使隔离级别 SERIALIZABLE 来实现，但这反过来可能会影响您的并发性。

凯夫

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T18:34:31.857

父母不依赖孩子。您需要删除表 A 中对表 B 的引用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T18:37:25.797

你有一个循环依赖。这些对于声明式强制执行效果并不好，每次要插入时都必须禁用约束。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T18:49:03.197

这是一个不寻常的要求。如果我被它困住了（我真的会反击以确保它确实是一个要求），我会这样设计它：

使用父级和子级从表 a 到表 b 制作常规外键。

如果在插入表 a 记录时触发器不存在，则向表 a 添加一个触发器，该触发器将一条记录插入到表 b 中。如果表 b 中的最后一条相关记录被删除，则向表 b 添加另一个触发器，该触发器将删除表 a 记录。

或者，您可以将插入内容放入存储过程中的两个表中。除通过 proc 外，删除对表的所有插入权限。您仍然需要从表 a 到表 b 的外键关系以及表 b 上的触发器，以确保如果删除最后一条记录，则删除表中的一条记录。但在这种情况下，您可以取消表 a 上的触发器。

我将使用第一种情况，除非表 b 中存在无法从表 a 的触发器中找到的信息，例如一个或多个没有值的必填字段，您可以从表 a 中计算出。

# asp.net - 在 IIS7 中启用动态压缩是否值得？

> ID：831041
> 
> 赞同：14
> 
> 时间：2009-05-06T18:35:18.050
> 
> 标签：asp.net, iis-7, compression

我正在尝试寻找所有可能的方法来提高我的网站性能。我正在考虑在服务器级别启用动态压缩，但担心性能下降（压缩页面没有缓存 - 文件损坏 - 服务器上的开销）。我应该放弃 IIS 7 的动态压缩吗？有没有比内置压缩模块做得更好的模块？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-08-13T18:34:06.440

您应该几乎总是启用动态压缩（静态默认情况下启用）。动态压缩 == 过度的处理压力是一个有害的神话。这是[MSDN](http://technet.microsoft.com/en-us/magazine/2008.09.iis.aspx)：

> 尽管有一个常见的神话，但动态压缩通常不会产生过高的 CPU 开销。事实上，动态压缩在繁忙的服务器上通常会导致不到总 CPU 利用率的 5%。动态压缩可以稍微自由地部署，以最大程度地节省任何应用程序工作负载的带宽。

此外，您可以为 IIS7 中的压缩指定 CPU 限制。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-06T18:52:22.830

您绝对应该启用动态压缩。请参阅这篇[文章](http://technet.microsoft.com/en-us/magazine/cc745952.aspx)，了解 IIS 7 中的 10 大性能改进。

引用文章：

> **压缩带来的带宽减少**
> 
> 毫不奇怪，带宽成本是运行面向 Internet 的数据中心的最高成本之一。此外，交付请求的内容所需的带宽是应用程序感知响应能力的关键因素。
> 
> 减少传递应用程序响应所需带宽的最有效方法之一是使用 HTTP 压缩。这可以大大减少响应的大小，当应用于 HTML 等易于压缩的文本内容时，通常会减少 10 倍。最好的部分是几乎所有桌面浏览器都支持它，与发送较少数据所节省的延迟相比，桌面硬件的解压缩成本很小。由于压缩基于 HTTP 1.1 协议中定义的内容编码协商，因此对于不支持压缩的客户端启用它是安全的——这些客户端只是接收未压缩版本的内容。

# java - 是否可以使用 Java webstart 执行 .exe 或 dll？

> ID：831050
> 
> 赞同：5
> 
> 时间：2009-05-06T18:36:32.663
> 
> 标签：java, windows, dll, java-web-start

我知道 java webstart 在安全沙箱下运行。是否可以在 jar 中包含 .dll/.exe（或让 webstart 将其下载到本地计算机）然后执行它（使用 Runtime.exec 或进程等）

请指教。欢迎任何建议/评论！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T19:11:01.787

是的。您必须将其包装`.dll`在一个`.jar`文件中，并`.jnlp`使用`<nativelib>`

有关更详细的说明，请参见[此处。](http://www.velocityreviews.com/forums/t126704-java-webstart-and-jni.html)

如果你想运行一个可执行文件，那么最好的办法是将它`.jar`作为资源打包到你的文件中，将它分解到（比如说）一个临时目录，然后使用正常的进程/运行时机制运行它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T19:10:17.670

是的，只要用户授予您的应用程序权限（通过弹出的对话框），Java webstart 就可以访问文件系统，并有权使用 Runtime.exec。

# .net - MVP 中使用 WinForms 进行异步调用的最佳实践

> ID：831051
> 
> 赞同：8
> 
> 时间：2009-05-06T18:37:07.793
> 
> 标签：.net, winforms, multithreading, mvp

我在 WinForms 项目中使用 Model-View-Presenter 模式，我遇到的一个问题（在许多问题中）是当表单告诉演示者做某事，然后在演示者去做时没有反应。幸运的是，在我的项目中，让所有演示者调用异步都没有问题，问题是如何做到这一点？

是否应该将每个演示者调用都包含在一个新的线程创建中？*

```
new Thread(()=>_presenter.DoSomething()).Start(); 
```

这里的最佳实践是什么？如果用户按下“中止你正在做的事情”按钮怎么办？如何优雅地中止？

.* 实际上，我可能只是在演示者上使用某种代理来执行此操作，而不是将线程创建放在 WinForm 中

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-09-06T09:09:55.017

我通常将任何可能（实际上）花费一两秒以上的操作放入单独的任务中，例如：

```
public interface ITask
{
    void ExecuteTask (ITaskExecutionContext context);
    void AfterSuccess(ITaskExecutionContext context);
    void AfterFailure(ITaskExecutionContext context);
    void AfterAbortion(ITaskExecutionContext context);
} 
```

我还有一个用于运行此类任务的抽象：

```
public interface ITaskExecutor : IDisposable
{
    void BeginTask(ITask task);
    void TellTaskToStop();
} 
```

其中一种实现`ITaskExecutor`是使用`BackgroundWorker`：

```
public class BackgroundTaskExecutor : ITaskExecutor
{
    public void BeginTask(ITask task)
    {
        this.task = task;
        worker = new BackgroundWorker ();
        worker.DoWork += WorkerDoWork;
        worker.RunWorkerCompleted += WorkerRunWorkerCompleted;
        worker.WorkerSupportsCancellation = true;

        worker.RunWorkerAsync();
    }

    ...
} 
```

我严重依赖依赖注入和 IoC 将事物连接在一起。在演示者中，我只是调用如下内容：

```
GoAndDontReturnUntilYouBringMeALotOfMoneyTask task = new GoAndDontReturnUntilYouBringMeALotOfMoneyTask(parameters);
taskExecutor.BeginTask(task); 
```

然后连接取消/中止按钮，以便它们告诉任务执行器/任务中止。

它实际上比这里介绍的要复杂一些，但这是一般的想法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T19:31:49.363

我只能声称我已经考虑过这一点（在阅读您的问题之前；）。首先，我会安装这实际上很重要的地方；例如数据库访问阻塞点。如果在“UI”上下文中存在不应该执行的地方（您可以从[http://msdn.microsoft.com/en-us/library/system.threading.synchronizationcontext.current.aspx](http://msdn.microsoft.com/en-us/library/system.threading.synchronizationcontext.current.aspx)在 UI 线程中保存它然后稍后与非 UI 同步上下文进行比较）然后 Debug.BitchAndMoan() 关于它。任何更长的计算（“应该”在它们自己的流形中都清楚地分开，对;）应该断言。

我想你至少应该通过属性配置演示者函数的执行类型，然后由代理遵守。（以防万一您想以串行方式完成某些事情）。

取消任务实际上是演示者的问题，但您必须有一个参考对象，告诉您要停止什么。如果您采用代理方式，那么您可以使用 IAsyncResult 将创建的线程拾取到任务列表中，但是如果允许并行调用多次相同的操作，则决定取消哪个线程仍然是一个问题。因此，您必须在启动任务时为任务提供合适的特定于调用的名称；这意味着 View 方面的逻辑太多 - > Presenter 可能应该要求 View 询问用户应该处理哪一项任务。

我的经验是，这通常只是通过使用事件（SCSF 风格）来解决。如果从头开始做，我会选择代理方式，因为 SCSF 在很多方面都很痛苦，以至于我怀疑它的设计师的理智。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:09:30.557

为什么不让您使用的代理模式接受几个回调以返回结果或中止？

# c# - IQueryable<> 序列化 - C#-VS2008-WCF

> ID：831058
> 
> 赞同：2
> 
> 时间：2009-05-06T18:37:57.090
> 
> 标签：c#, wcf

我用所需的表构建了我的 *.dbml 文件，并生成了 1 对多的关系。

我的 WCF 服务库中的一种方法有这个查询

```
 IQueryable<Client>localClient = from c in db.Clients
              where c.ClientID.Equals(2612)
              select c;

 foreach(Client currentClient in localClient)
 {
    //Call serialize method here
 } 
```

客户具有一对多关系的表之一是客户 - 员工

使用“localClient”，我想将其序列化并返回给调用者。但是它告诉我无法形成 XML 文档。

这是 InnerException：在序列化 TestDB_Public.Employee 类型的对象时检测到循环引用。

我的序列化代码

```
 public string Serialize(object o, XmlSerializerNamespaces ns)
    {
        try
        {
            System.IO.MemoryStream m = new System.IO.MemoryStream();

            if (ns != null)
                serializer.Serialize(m, o, ns);
            else
                serializer.Serialize(m, o);

            m.Position = 0;
            byte[] b = new byte[m.Length];
            m.Read(b, 0, b.Length);

            return System.Text.UTF8Encoding.UTF8.GetString(b);
        }
        catch (Exception ex)
        {
            return "Ex = " + ex.ToString();
        }
    } 
```

IQueryable<> 的序列化与 1 到多个关系是不可能的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T16:31:09.640

您不能序列化具有循环关系的对象图：

```
class Employee
{
  Employee Manager;
  List<Employee> Employees;

}

var bossMan = new Employee();
var emp2 = new Employee{Manager = bossMan}
var bossMan.Employees.Add(emp2); 
```

如果您现在尝试序列化 bossman 或 emp2，您将得到异常。

看看[这篇文章](http://broloco.blogspot.com/2009/02/sending-domain-objects-across-wire.html)，检查循环对象图以获得解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T18:56:29.323

错误信息到底是什么？请注意，您必须序列化具体的东西，例如对象列表或数组（不是查询）。

如果您想通过网络进行查询，请查看执行此操作的 ADO.NET 数据服务。

另外 - 您是否在 dbml 设计器中将序列化模式设置为“单向”？只要没有循环，它应该可以正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T21:07:47.993

Marc：出于某种原因，它不允许我添加评论。

我添加了这个

```
[Table(Name="dbo.Client")]
[DataContract(IsReference=true)]
public partial class Client: INotifyPropertyChanging, INotifyPropertyChanged
{
  ..//
  private EntitySet<ClEmp> _ClEmp;

  [Association(N...)]
  [DataMember(Order=70, EmitDefaultValue=false)]
  public EntitySet<ClEmp> ClEmps
} 
```

我的序列化是这样的：

```
DataContractSerializer ser =
                    new DataContractSerializer(typeof(Client));
                var ms = new System.IO.MemoryStream();

                ser.WriteObject(ms, r);

                ms.Seek(0, System.IO.SeekOrigin.Begin);

                var sr = new System.IO.StreamReader(ms);

                var xml = sr.ReadToEnd(); 
```

当我查看 var xml 时，我没有得到我的实体集 ClEmp。

# c# - ASP .NET MVC：如何更改用户的角色？

> ID：831059
> 
> 赞同：6
> 
> 时间：2009-05-06T18:38:13.690
> 
> 标签：c#, asp.net-mvc

在我的应用程序中，我有一个管理员角色，这些用户可以更改用户的角色（客户、经理......）。我正在使用内置的会员资格提供程序。这是我试图做的......

```
 [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult EditRole(string usernameID, FormCollection formValues)
    {

        var db = new AppDataContext();
        var user = db.Users.SingleOrDefault(d => d.UserName == usernameID);
        string choosenRole = Request.Form["Roles"];                               

        var tuple = db.UsersInRoles.SingleOrDefault(d => d.UserId == user.UserId);
        var roleNameID = db.Roles.SingleOrDefault(d => d.RoleName == choosenRole).RoleId;
        tuple.RoleId = roleNameID;

        db.SubmitChanges();

        return RedirectToAction("Index");
    } 
```

但是，我得到了这个错误..

> “UsersInRole”类型对象的成员“RoleId”的值已更改。不能更改定义对象身份的成员。考虑添加一个具有新身份的新对象，然后删除现有对象。

我被困住了。有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T18:47:51.000

与其尝试直接从 db（数据上下文）访问成员资格表，不如使用那里的操作代码中提供的 、 和 static`User`类`Roles`。`Membership`

像这样：

```
System.Web.Security.Roles.AddUserToRole(usernameID, choosenRole); 
```

假设您的 usernameID 是您要更改的用户的字符串键，并且 choosenRole 包含您要将用户添加到的角色名称键：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult EditRole(string usernameID, FormCollection formValues)
{
    string choosenRole = Request.Form["Roles"];                               
    System.Web.Security.Roles.AddUserToRole(usernameID, choosenRole);

    return RedirectToAction("Index");
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T18:43:06.203

`UsersInRole.RoleId`是`UsersInRole`表的主键的一部分，因此不能更改。您应该按照错误消息给出的建议删除现有`UsersInRole`实例并创建一个新实例。

# sql-server - 用于 Oracle 开发人员/dba 的 SQL 服务器

> ID：831061
> 
> 赞同：2
> 
> 时间：2009-05-06T18:38:44.560
> 
> 标签：sql-server, database, sql-server-2005, oracle, query-optimization

我有几年使用 oracle 开发的经验，现在已经搬到他们使用 SQL Server (2005) 的地方。对于有我背景的人来说，哪里是学习 SQL Server 查询优化、基本 dba 内容和 sql server gotchas 之类的好地方。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T20:48:07.043

这本书非常有用，因为它同时包含 Oracle 和 T_sql 语法 SQL in a Nutshell 由 Kevin 和 Daniel Kline 由 O'Reilly 出版

对于具有 Oracle 背景的人来说，光标可能是个问题，因为据我了解，它们在 Oracle 中经常使用。SQL Server 不喜欢它们，它们是性能的大杀手。

有几本关于 SQL Server 性能调优的书籍。在亚马逊上快速上厕所应该会让你有很多

Red-gate 提供了用于比较数据库的好工具，并且还有许多您可能想要查看的好免费内容。[http://www.red-gate.com/](http://www.red-gate.com/)

这里有一些关于 SQL Server 的好内容，尤其是在 Wiki 区域。我认识许多作者，其中一些人在非常大的 SQL Server 环境中工作，并且是非常聪明的人。 [http://lessthandot.com/](http://lessthandot.com/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T21:46:29.570

我同意 hlgem。

我要补充一点，你会大吃一惊。SQL Server 的体系结构与 Oracle 有很大不同。您是从 DBA 的角度还是从开发人员的角度来看待这个问题的？

在你进入优化器之前，首先了解一下锁管理器和 SQL 中的锁升级。它与 Oracle 完全不同，您在 Oracle 时代可能怀有的大多数假设都会让您感到沮丧。最好从 biginning 中了解锁管理器的工作原理，从而限制您可以做的事情。至少那时您将知道如何在 SQL 中制定解决方案，而不是根据您的 Oracle 经验进行尝试，以后必须对其进行修改。

话虽如此，提炼出所有数据库系统的真实情况，并依赖于在 SQL 中工作。数据库技术的所有首要原则仍然适用于 SQL，并将帮助您进行开发、调优和故障排除。

祝你好运。

# asp.net - AspNetSqlMembershipProvider asp:PasswordRecovery: 如何设置密码复杂度？

> ID：831063
> 
> 赞同：2
> 
> 时间：2009-05-06T18:38:50.070
> 
> 标签：asp.net, sqlmembershipprovider

我们正在使用 AspNetSqlMembershipProvider 控件来生成新密码。

有没有办法降低生成密码的复杂性？默认情况下，它输出如下内容： *f.;tp{h|[hPCF

我意识到如果必须，我可以推出自己的密码恢复过程，但我想避免这种情况。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T18:45:13.097

您可以在 web.config 中完成这一切。查看这篇文章，[http://weblogs.asp.net/owscott/archive/2005/05/11/406550.aspx](http://weblogs.asp.net/owscott/archive/2005/05/11/406550.aspx)。

# eclipse - 为什么 Subclipse 只能在某些 Ecliplse 工作区中工作，而不能在其他工作区中工作？

> ID：831064
> 
> 赞同：1
> 
> 时间：2009-05-06T18:38:59.180
> 
> 标签：eclipse, svn, subclipse

我正在使用带有 Subclipse 的 Eclipse 进行一些 perl 开发。Subversion 存储库的设置如下：

*   /repos /repos/dev/
*   /repos/dev/crontabs
*   /repos/dev/crontabs/script1
*   /repos/dev/crontabs/script2
*   /repos/dev/守护进程
*   /repos/dev/daemons/script3
*   /repos/dev/daemons/script4
*   /repos/dev/工具
*   /repos/dev/tools/script5
*   /repos/dev/tools/script6

在文件系统上，我将整个 /repos/dev 树在本地检查到 ~/dev 并创建了三个 Eclipse 工作区，每个工作区位于“~/dev/crontabs”、“~/dev/daemons”和“~dev /工具”。

这就是事情变得奇怪的地方。在守护进程和工具工作区中，SVN 可以正常工作。我看不到 .svn 目录，我可以在 TEAM 对话框中执行所有各种 SVN 工作（例如提交、更新、清理）。但是，SVN 不能在“crontabs”工作区中工作。.svn 目录是可见的，并且没有任何 SVN 对话框选项可用。

在所有目录中，我都可以使用命令行 SVN 工具，一切正常。

这里有更多细节。

*   Mac OS X 10.5.6
*   Eclipse 平台 - 版本：3.4.2 - 内部版本号：M20090211-1700
*   SVNKit 库 1.2.2.5405
*   SVNKit 客户端适配器 1.5.6.1
*   子剪辑 1.4.8
*   史诗 0.5.46

我尝试删除 deameons .metadata 和 realted .profile 文件以尝试将其清除并开始一个新的工作区，但这没有用。

任何人之前都见过这种行为和/或知道如何让 SVN 命令在所有工作区中工作，而不仅仅是其中一些？

更新：我还应该提到 /dev 目录中还有很多其他我不使用 Eclipse 的资产。因此，我将命令行 SVN 工具与 Eclipse 中的 SVN 函数结合使用。最初使用命令行工具检查了所有内容，然后我只是使用 Eclipse 进行提交。让我吃惊的是为什么它在两个子目录中工作，而不是在命令行 100% 工作的第三个子目录中工作。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-07T14:33:55.287

我不确定我是否完全遵循这一切。而且 Subclipse 插件不如 CVS 插件精致。但是，如果您将项目复制到工作区并且它包含 Subversion 上下文（.svn 文件夹），正如 Bemose 所指出的，这对 Subclipse 没有意义。

理论上，当您使用 Team/Share 并收到警告消息时，您可以批准，它会破坏现有的 .svn 文件并构建正确的新文件。如果你幸运的话，它甚至会起作用。它与 CVS 一样，但是，正如我所说，Subclipse 可能是一个更大的问题。

最好的办法是使用 Eclipse subversion 透视图和“Check out as Eclipse Project”选项将项目签出到您的工作区中。

如果您绝对需要从命令行构建项目目录，请使用 Subversion*导出*命令，而不是 checkout 命令。导出会省略“.svn”目录，因此 Eclipse 可以不受干扰地完成它的工作。但是，您必须执行 Team/Share 才能将导出的项目连接到 subversion 存储库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T18:43:10.713

当您切换工作区时，其他工作区的所有设置等都将被忽略。

与其检出整个主干并创建 3 个与您的存储库结构一致的工作区，不如创建 3 个工作区，并将存储库的相关部分检出为每个工作区的项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:21:28.080

当您创建一个新项目并将文件导入其中时，Eclipse 不假定项目是受版本控制的。您必须使用 Project's Team -> Share Project... 对话框明确告诉它。

一旦您选择了正确的目录，Eclipse 应该会告诉您该项目已经在该位置共享，但无论如何都要在 Eclipse 中为其激活 SVN 命令。

# sharepoint - 控制 SharePoint 中自定义操作项的 ID

> ID：831070
> 
> 赞同：0
> 
> 时间：2009-05-06T18:39:57.273
> 
> 标签：sharepoint, action

我已向 CustomList 类型添加了一个自定义操作。出于测试目的，我想使用我们的测试工具来执行我的新自定义操作。不幸的是，我不知道如何为我的自定义菜单项生成 ID！

以下是“删除项目”内置菜单选项的示例（XPath 表达式）：

```
/body/div/div/table/tbody/tr[@id='mp10_0_2']/td/table/tbody/tr/td[@id='ID_DeleteItem']/label/div/span[1] 
```

我的自定义操作也是如此：

```
/body/div/div/table/tbody/tr[@id='mp13_0_6']/td/table/tbody/tr/td[@class='ms-MenuUILabel']/div/span[1] 
```

如您所见，在第二个示例（我的自定义操作）中包含一个@class 属性，但没有@id（我想在安装我的自定义操作时设置它）。

如何为我的自定义操作指定一个 id 属性（显示在 HTML 中）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T10:08:35.160

如果只是为了测试，您可能不想深入研究 SharePoint 内部来控制 id。您应该测试是否存在标有“删除项目”的项目，而不是测试具有特定 ID 的项目。

# ruby-on-rails - 如何将多个参数作为数组传递给 ruby 方法？

> ID：831077
> 
> 赞同：69
> 
> 时间：2009-05-06T18:41:51.090
> 
> 标签：ruby-on-rails, ruby, arrays, methods, arguments

我在这样的rails帮助文件中有一个方法

```
def table_for(collection, *args)
 options = args.extract_options!
 ...
end 
```

我希望能够像这样调用这个方法

```
args = [:name, :description, :start_date, :end_date]
table_for(@things, args) 
```

这样我就可以根据表单提交动态传递参数。我不能重写方法，因为我用的地方太多了，我该怎么做呢？

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-05-06T19:23:15.577

Ruby 可以很好地处理多个参数。

[这是](https://web.archive.org/web/20170113103604/http://www.misuse.org/science/2008/01/30/passing-multiple-arguments-in-ruby-is-your-friend)一个很好的例子。

```
def table_for(collection, *args)
  p collection: collection, args: args
end

table_for("one")
#=> {:collection=>"one", :args=>[]}

table_for("one", "two")
#=> {:collection=>"one", :args=>["two"]}

table_for "one", "two", "three"
#=> {:collection=>"one", :args=>["two", "three"]}

table_for("one", "two", "three")
#=> {:collection=>"one", :args=>["two", "three"]}

table_for("one", ["two", "three"])
#=> {:collection=>"one", :args=>[["two", "three"]]} 
```

（从 irb 剪切和粘贴的输出）

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2009-05-06T19:11:48.197

只需这样称呼它：

```
table_for(@things, *args) 
```

( `splat`)`*`运算符将完成这项工作，而无需修改方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-06-18T09:30:01.340

```
class Hello
  $i=0
  def read(*test)
    $tmp=test.length
    $tmp=$tmp-1
    while($i<=$tmp)
      puts "welcome #{test[$i]}"
      $i=$i+1
    end
  end
end

p Hello.new.read('johny','vasu','shukkoor')
# => welcome johny
# => welcome vasu
# => welcome shukkoor 
```

# iphone - 如何设置 UIScrollView 的滚动位置？

> ID：831080
> 
> 赞同：24
> 
> 时间：2009-05-06T18:42:40.730
> 
> 标签：iphone, cocoa-touch, uikit, uiscrollview

我见过 setContentOffset:animated: 方法。那会滚动到特定位置，还是“偏移”是什么意思？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-06T19:18:38.740

是的。从[苹果文档](https://developer.apple.com/library/ios/documentation/uikit/reference/UIScrollView_Class/Reference/UIScrollView.html#//apple_ref/occ/instm/UIScrollView/setContentOffset:animated:)：

`setContentOffset:animated:` 设置与接收者原点相对应的内容视图原点的偏移量。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-01-31T16:07:44.897

您可以使用控制动画

```
[UIView animateWithDuration:1.2 animations:^{_scrollView.contentOffset = CGPointMake(X, Y);}]; 
```

# php - 检测 FFmpeg 安装和版本

> ID：831081
> 
> 赞同：13
> 
> 时间：2009-05-06T18:43:05.800
> 
> 标签：php, ffmpeg, command, version

我正在编写一个 PHP 脚本，可以即时将上传的视频文件转换为 FLV，但我只希望它在用户在服务器上安装了 FFmpeg 时运行该部分脚本。

有没有办法提前检测到这一点？我可以运行一个 FFmpeg 命令并测试它是否返回“找不到命令”？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-03-31T17:55:19.873

尝试：

```
$ffmpeg = trim(shell_exec('which ffmpeg')); // or better yet:
$ffmpeg = trim(shell_exec('type -P ffmpeg')); 
```

如果返回空的 ffmpeg 不可用，否则它将保存可执行文件的绝对路径，您可以在实际的 ffmpeg 调用中使用它：

```
if (empty($ffmpeg))
{
    die('ffmpeg not available');
}

shell_exec($ffmpeg . ' -i ...'); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-25T17:32:46.403

函数的第三个参数`exec()`是执行程序的返回值。像这样使用它：

```
exec($cmd, $output, $returnvalue);
if ($returnvalue == 127) {
    # not available
}
else {
    #available
} 
```

这适用于我的 Ubuntu 盒子。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T18:44:47.293

你回答了你自己的问题，你可以运行命令，如果它返回否定，你知道它没有安装，或者你可以检查用户为可能的 ffmpeg 二进制文件设置的默认路径。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-28T07:56:04.377

嗨，我搜索了这个问题，我可以通过以下代码获取 ffmpeg 的版本：echo(shell_exec('/usr/bin/ffmpeg -version'));

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T22:33:52.740

你可以试试这个：

```
function commandExists($command) {
    $command = escapeshellarg($command);
    $exists = exec("man ".$command,$out);
    return sizeof($out);
}

if (commandExists("ffmpeg")>0) {
   // FFMPeg Exists on server
} else {
   // No FFMPeg
} 
```

也可重复用于其他功能 - 不确定安全问题。

# c++ - VS2005链接过程中合并元数据时忽略文件

> ID：831088
> 
> 赞同：0
> 
> 时间：2009-05-06T18:45:03.830
> 
> 标签：c++, visual-studio, clr, linker

我试图让我的项目使用公共语言运行时进行编译，当我尝试进行调试构建时，我突然遇到以下链接错误：

```
Main.obj : error LNK2022: metadata operation failed (8013118D) : Inconsistent layout information in duplicated types (IDirect3DVertexShader9): (0x0200056e).

Main.obj : error LNK2022: metadata operation failed (8013118D) : Inconsistent layout information in duplicated types (IDirect3DVertexDeclaration9): (0x0200056f).

Main.obj : error LNK2022: metadata operation failed (8013118D) : Inconsistent layout information in duplicated types (IDirect3DDevice9): (0x02000a2a).

Main.obj : error LNK2022: metadata operation failed (8013118D) : Inconsistent layout information in duplicated types (IDirect3DSwapChain9): (0x02000ab0).

Main.obj : error LNK2022: metadata operation failed (8013118D) : Inconsistent layout information in duplicated types (IDirect3DIndexBuffer9): (0x02000ace).

Main.obj : error LNK2022: metadata operation failed (8013118D) : Inconsistent layout information in duplicated types (IDirect3DVertexBuffer9): (0x02000b4e).

Main.obj : error LNK2022: metadata operation failed (8013118D) : Inconsistent layout information in duplicated types (IDirect3DTexture9): (0x02000bbd).

Main.obj : error LNK2022: metadata operation failed (8013118D) : Inconsistent layout information in duplicated types (IDirect3D9): (0x02000c0e).

LINK : fatal error LNK1255: link failed because of metadata errors 
```

我尝试重建整个解决方案，但仍然看到相同的错误。如果有人知道可能导致这种情况的原因，我想知道。我能看到的唯一解决方案是告诉调试器不要为重复类型构建调试信息。唯一的问题是我不知道如何做到这一点（或者实际上是否可能）。如果有人知道，我将不胜感激。

非常感谢您的所有帮助！

丹尼尔奥尔巴赫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T18:49:06.563

你有多个版本的`IDirect3D`库吗？例如：假设您有几个模块，一个您预先构建的 dll（依赖于某些未知版本`IDirect`）和一个您构建的模块，例如该库的最新版本。那会给你这样的错误。

请参阅[LNK 2022的 MSDN 文档](http://msdn.microsoft.com/en-us/library/zkf0dz41(VS.80).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-12T19:30:31.153

如果您在 C++/CLI 中转发声明类，然后在其他地方阅读完整声明，我会收到此错误：

```
// one.h
class CMyNewClass;

// two.h
class CMyNewClass
{
//...
};

//main.cpp
#include "one.h"
#include "two.h"
//... 
```

我认为这种组合是导致此问题的原因，但我现在手头没有 Visual Studio 来仔细检查它。

# sharepoint-2007 - 有没有办法在 Sharepoint 的数据表视图中创建链接？

> ID：831092
> 
> 赞同：1
> 
> 时间：2009-05-06T18:45:31.317
> 
> 标签：sharepoint-2007

我们正在使用 Sharepoint 来跟踪/控制我们的客户入职流程。基本上，有些项目列出了每个可交付成果及其截止日期，不同的小组需要每天检查该列表并确保他们的任务已完成并更新项目。

之前我们创建了一个数据表视图，它可以轻松查看我们的任务并对其进行更新。不幸的是，为了完成我们的任务，我们还需要查看另一个项目。在标准视图中，我们可以显示指向第二个项目的链接，但看起来您不能在数据表视图中这样做......这让我们不得不打开两个视图并来回进行设置。

有什么方法可以让我们将该链接放入数据表视图中？

编辑：显然我在这个问题上犯了一个错误。有问题的字段是 sharepoint 中另一个项目的查找字段。在标准视图中，它可以很好地链接到其他项目，但在数据表视图中，它只是作为文本出现。有没有办法让查找字段在数据表视图中显示为链接？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T06:28:41.380

可悲的是，您似乎不能在计算字段上使用查找字段，并且 Excel 视图不允许打开查找项 - 它会打开包含所有查找项的组合，但不会打开该项目。但是，有些选项似乎也适用于此。让我们假设您的表 Tasks 具有另一个表 Clients 的查找字段。

1.  如果客户端只有很少的列，这是一个不错的选择 - 向客户端添加包含所有数据的计算列，并将其用于查找。例如，如果客户有 和 列`Name`，则`Phone`创建另一列同时显示：`=[Name] & ", " & [Phone]`，这样您就可以在 excel 视图中查看所有数据（这样您就不需要链接）。
2.  向 Tasks 添加另一个整数字段，该字段仅包含客户端的 ID，并使用公式向 Tasks 添加一个计算字段`="http://yourserver/lists/clients/DispForm.aspx?ID=" & [ClientID]`。这将创建一个适用于 Excel 视图的 URL 字符串。因此，您必须填写 ClientID（我承认这不太舒服），或者在选择查找时使用 JavaScript 自动填写此列（实际上我已经做过类似的事情）。
3.  正如奥古斯特建议的那样，使用链接而不是查找。再次。这不如查找舒服，但这里是最简单的选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-19T22:42:54.313

我在数据表视图中这样做没有问题。我插入到单行文本列中的任何链接或电子邮件地址都会成为标准视图和数据表视图中的链接。

# asp.net - 在路由控制器中如何获取路由“名称”

> ID：831093
> 
> 赞同：0
> 
> 时间：2009-05-06T18:45:31.970
> 
> 标签：asp.net, asp.net-mvc-routing

我在 asp.net 中使用路由来获取漂亮的 URL

当我在 global.asax 中定义路由时，我创建了两个使用相同控制器 (c#) 的不同路由：

```
 // Setup code for route a...
        routes.Add("routeb", routea);

        // Setup code for route b...
        routes.Add("routeb", routeb); 
```

（如何）是否可以从控制器内部确定将用户引导到该控制器的“关键”值是什么？或者是使用模式错误 - 如果这是更合适的解决方案，则可以直接将控制器子类化（再次）以区分两者并保留通用代码。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-05-02T18:50:24.457

总是有路由调试器[http://haacked.com/archive/2008/03/13/url-routing-debugger.aspx](http://haacked.com/archive/2008/03/13/url-routing-debugger.aspx)。有时非常有帮助。

# svn - 有没有办法使用 TortoiseSVN 执行切换前/切换后的命令？

> ID：831094
> 
> 赞同：1
> 
> 时间：2009-05-06T18:45:39.210
> 
> 标签：svn, tortoisesvn

当使用 TortoiseSVN 从一个 Subversion 分支切换到另一个分支时，我们需要执行一些任务。有什么方法可以在切换之前和之后调用批处理文件？我唯一能找到的是更新前/更新后和提交钩子，但是在分支之间切换时这些钩子都不会被执行。

编辑：我正在寻找客户端挂钩。TortoiseSVN 有用于更新前/更新后和提交的客户端钩子脚本，但没有（我能找到）用于切换前/后的内容。最初，我认为在分支之间切换时会执行为客户端更新前/更新后添加挂钩，但情况似乎并非如此。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T21:56:37.643

挂钩发生在服务器端；切换分支本质上是客户端的一种花哨的更新方法。由于 Tortise 不是 SVN 服务器，我假设这篇文章准确地总结了你的情况：

[http://svn.haxx.se/users/archive-2004-06/0328.shtml](http://svn.haxx.se/users/archive-2004-06/0328.shtml)

完成您需要的批处理文件必须在本地执行，而不是使用 TortiseSVN，并且它必须根据需要在您的自定义代码之前或之后为您进行本地分支切换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-04-02T14:34:27.300

挣扎了一阵子，终于有办法解决了

只需使用更新后挂钩，但在 svn repo root 上执行，而不是在主干/分支级别，这对我很有用

# delphi - 在 Delphi 中优化类大小。有没有类似“打包类”的东西？

> ID：831099
> 
> 赞同：5
> 
> 时间：2009-05-06T18:46:42.593
> 
> 标签：delphi, optimization, memory

我正在尝试优化我的 Delphi 类的大小，以便它们占用尽可能少的内存，因为我正在创建大量它们。

问题是，这些课程本身很小，但并没有占据我所期望的空间。例如，如果我有

```
type MyClass = class
  private
    mMember1 : integer;
    mMember2 : boolean;
    mMember3 : byte;
end; 
```

我希望它使用 6 个字节，但是，由于对齐，它最终使用 12 个字节，这是布尔值使用 4 个字节而不是 1 个字节......字节字段也是如此......

对于记录，您可以使用 {$A1} 指令或将其声明为打包记录以使其仅使用所需的内存。

有没有办法用类做同样的事情？（也许一些关于如何正确覆盖 NewInstance 类方法的教程？）

**编辑：**好的，关于我在做什么的一点解释......

首先，真正的类大小大约是 40 字节，包括 VMT 和接口指针占用的空间。

这些类都继承自一个大小为 8 字节的基本 RefCounting 类（一个整数 FRefCount 和一些允许引用计数的方法），并且它们必须支持接口（因此根本不使用打包记录）。

这些对象被传递并被投射到几个东西上，而处理程序却不知道他们得到了什么。例如，我有一个接收 TItem 列表并执行以下操作的类：

```
if Supports(List[i], IValuable, IValInstance) then
  Eval(IValInstance.Value); 
```

然后另一个处理程序可能会检查其他接口

```
If Supports(List[i], IStringObject, IStringInstance) then
  Compose(IStringInstance.Value) 
```

这样每个处理程序都会对列表进行不同的处理......

关于如何获得类的总大小，我正在使用修改后的内存管理器，以便我可以跟踪“真实”内存管理器为类使用了多少内存。通过这种方式，我非常有信心实例没有被打包。

最后，这是在 Delphi 7 中。我尝试使用 {$A1} 预编译器指令，但没有成功，字段以任何方式对齐，我可能有数百万个实例作为最坏的情况，因此节省 6 个字节可能会导致几个MB 正在保存。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-07T00:54:11.647

您可以使用打包记录作为对象的字段：

```
type
  TMyRecord = packed record
    Member1 : integer;
    Member2 : boolean;
    Member3 : byte;
  end;

  TMyClass = class
  private
    FData : TMyRecord;
   function GetMember1 : Integer;
  public
    property Member1 : Integer read GetMember1;
    // Later versions of Delphi allow "read FData.Member1;", not sure when from
  end;

function TMyClass.GetMember1 : integer;
begin
  result := FData.Member1;
end; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T20:54:35.170

如果您非常担心几个字节（您提到了 6 对 12），那么您根本不应该使用类。改用记录。然后可以使用 packed 来消除对齐浪费；但是，请准备好承受性能损失，因为设置了默认的“非压缩”对齐方式是为了让 CPU 以最快的速度访问。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-06T19:01:31.247

为什么不一开始就使用打包记录呢？它会忽略从 TObject 下降引起的开销（轻微）......

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-06T19:08:09.593

绝对地。您可以打包集合、数组、记录、对象和文​​件类型。请注意，使用打包确实会导致访问数据时速度变慢，并且可能会导致一些类型兼容性问题。

我在 Delphi 2006 中对此进行了尝试。编辑器的语法检查将其标记为错误，但编译得很好。

根据 Delphi 文档，$A 开关适用于类类型和记录类型。

**更新：**

我也在 Delphi 6 中尝试过。它编译成功。如果打包类在 Delphi 7 中无法编译，您可能已经发现了一个错误。如果这是一个错误，Embarcadero 不太可能对此采取任何措施，除非它仍然出现在最新版本的 Delphi 中，但似乎并非如此。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-07T09:56:00.567

也许有点跑题了，但我之前（在 D2006 之前，所以没有记录）为某些 ORM 框架而苦苦挣扎。假设“类”的东西是一成不变的：

提示和提示：

1.  我通过为字段设置getter和setter来解决打包问题，将它们存储在类的字节数组中。甚至可以被位压缩。如果 setter/getter 是可内联的（那么对我来说不是一个选项，D6），它甚至可能相当便宜。
2.  尝试通过自己初始化一块内存、设置 VMT 并在其上调用构造函数来获取堆分配（管理开销和松弛空间）开销。IIRC 堆开销为 8 字节，旧 heapmgr 的分配粒度为 8 字节，fastmm 为 16 字节。如果根据大小对类进行排序，则可以使用位图作为分配结构
3.  如果您**特别**邪恶，请记住指针有 2 或 3 位松弛。我将这些位用作非常常用的分配类型的标识，节省了堆保留的 4 个字节来存储大小。
4.  注意你的索引。如果你有很多对象（我有大约 600 万个），你也必须小心你的索引类型。（请不要使用 tstringlist）
5.  始终将未混淆的内容保留在 ifdef 下，以便于调试测试 (*)
6.  永远不要使用字符串作为键。必要时散列。规范化结构不仅对数据库有好处

(*) 我后来在 64 位 FPC 下重新编译了“干净”版本，尽管第 1 点和第 2 点很丑陋，但它在一些小的 sizeof(pointer()) 之后仍然有效

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-07T01:01:12.863

**手动打包您的数据**。取每 4 个字节并将它们放在一个基数中。如果您有两个长度不是 4 的倍数的短刺，则将它们放入一个短字符串中，然后读出每个部分。

这将需要您进行更多的工程设计，手动排列所有内容，但是通过使用 getter 和 setter，行为将在类之外是透明的。您可以非常接近与编译器以这种方式打包它的结果相同的结果。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-07T12:41:55.427

如果您将拥有大量实例并希望避免与单独分配相关的开销，您可以使用打包记录并在类本身外部维护它们，例如通过一个或多个大型数组分配。

然后，在类中，您只能存储一两个字段用于索引到堆和偏移量中。如果您可以只使用一个大内存块，您可以将其减少到仅偏移量。

```
TPackedRecord = packed record ... end;
PPackedRecord = ^TPackedRecord;
TPackedRecordHeap = class
  ...
  function  Add: PPackedRecord;
  procedure Release( entry: PPackedRecord );
end;

TUsableClass = class
private
  heap: TPackedRecordHeap;
  data: PPackedRecord;
public
  constructor Create( heap: TPackedRecordHeap );
  ...
end; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-06T22:50:58.403

仅供参考，如果那是一条记录，它将是 8 个字节，以及 6 个字节作为打包记录。因此，您正在查看类指针的 4 字节开销（假设您在 2009 年之前的 Delphi 中），如果它被打包，则有可能回收 2 个字节。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-07T11:14:37.960

> 我希望它使用 6 个字节，但是由于对齐，它最终使用 12 个字节

即使你写“TMyClass = class end;” 该类将从具有虚拟方法的 TObject 继承。

这使得

```
 4 Bytes (VMT)
+ 4 Bytes (member1: Integer)
+ 1 Byte  (member2: Boolean)
+ 1 Byte  (member3: Byte);
+ 2 Bytes (alignment)
---------
 12 Bytes 
```

因此，如果您禁用对齐，您将只赢得 2 个字节。

通过按数据类型大小（在您提到的较大类中）对字段进行排序，可以消除一些对齐漏洞。并且 $A- (Delphi 5) 或 $A1 (更新) 不起作用。在 Delphi 7 和 Delphi 2009 中都没有。

顺便说一句：在 Delphi 2009 中，“Thread.Monitor”有额外的 4 字节，将总类大小增加到**16**字节。

# xml - 跨命名空间的 XSL 转换

> ID：831101
> 
> 赞同：1
> 
> 时间：2009-05-06T18:46:47.850
> 
> 标签：xml, xslt, namespaces

我有看起来像这样的 XML：

```
<Root xmlns="http://widgetspecA.com/ns">
  ...any...
  <WidgetBox>
    <A/>
    <B/>
    <SmallWidget> <!-- minOccurs='0' -->
      ...any...
    </SmallWidget>
    <Widgets> <!-- minOccurs='0' -->
      ...any...
    </Widgets>
    ...any...
  </WidgetBox>
  ...any...
</Root> 
```

我想把它变成这样：

```
<Root xmlns="http://widgetspecB/ns">
  ...any...
  <WidgetBox>
    <A/>
    <B/>
    <Widgets>
      <Atom>
        ...any...
      </Atom>
      <Molecule>
        ...any...
      </Molecule>
    </Widgets>
    ...any...
  </WidgetBox>
  ...any...
</Root> 
```

换句话说：

`<SmallWidget>`在 specA 中的含义与在 specB 中的含义相同`<Atom>`，因此只需重命名元素即可。

`<Widgets>`在 specA 中的含义与在 specB 中的含义相同`<Molecule>`，因此只需重命名元素即可。

`<Atom>`将and包裹`<Molecule>`在一个名为 的元素中`<Widgets>`，这意味着与 specA 不同的东西`<Widgets>`。

其他所有内容都按原样复制，但在新的命名空间中。

XSLT 会为此做什么？

解决方案？：最后我选择了这个：

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" 
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:old="http://widgetspecA.com/ns"
    xmlns="http://widgetspecB.com/ns"
    exclude-result-prefixes="old">

  <xsl:output method="xml"/>

  <xsl:template match="*">
    <xsl:element name="{name()}">
      <xsl:copy-of select="@*"/>
      <xsl:apply-templates/>
    </xsl:element>
  </xsl:template>

  <xsl:template match="old:SmallWidget" mode="single">
    <Atom>
      <xsl:apply-templates/>
    </Atom>
  </xsl:template>

  <xsl:template match="old:Widgets" mode="single">
      <Molecule>
        <xsl:apply-templates/>
      </Molecule>
  </xsl:template>

  <xsl:template match="old:SmallWidget[following-sibling::old:Widgets]">
      <Widgets>
       <xsl:apply-templates select="self::node()" mode="single"/>
       <xsl:apply-templates select="following-sibling::old:Widgets" mode="single"/>
      </Widgets>
  </xsl:template>

  <xsl:template match="old:Widgets[preceding-sibling::old:SmallWidget]"/>

  <xsl:template match="old:SmallWidget[not(following-sibling::old:Widgets)]">
      <Widgets>
       <xsl:apply-templates select="self::node()" mode="single"/>
      </Widgets>
  </xsl:template>

  <xsl:template match="old:Widgets[not(preceding-sibling::old:SmallWidget)]">
      <Widgets>
       <xsl:apply-templates select="self::node()" mode="single"/>
      </Widgets>
  </xsl:template>

</xsl:stylesheet> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T12:30:03.750

一个好的 XSLT 解决方案会将您的人类可读规则映射到简单的模板规则。用你的话来说，这里是规则：

1.  `<SmallWidget>`在 specA 中的含义与在 specB 中的含义相同`<Atom>`，因此只需重命名元素即可。
2.  `<Widgets>`在 specA 中的含义与在 specB 中的含义相同`<Molecule>`，因此只需重命名元素即可。
3.  `<Atom>`将and包裹`<Molecule>`在一个名为 的元素中`<Widgets>`，这意味着与 specA 不同的东西`<Widgets>`。
4.  其他所有内容都按原样复制，但在新的命名空间中。

让我们试一试：

```
<xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:in="http://widgetspecA.com/ns"
  xmlns="http://widgetspecB.com/ns"
  exclude-result-prefixes="in">

  <!-- 1\. Rename <SmallWidget> -->
  <xsl:template mode="rename" match="in:SmallWidget">Atom</xsl:template>

  <!-- 2\. Rename <Widgets> -->
  <xsl:template mode="rename" match="in:Widgets">Molecule</xsl:template>

  <!-- 3\. Wrap <Atom> & <Molecule> with <Widgets> -->
  <xsl:template match="in:SmallWidget">
    <!-- ASSUMPTION: in:Widgets immediately follows in:SmallWidget -->
    <Widgets>
      <xsl:apply-templates mode="convert" select="."/>
      <xsl:apply-templates mode="convert" select="following-sibling::in:Widgets"/>
    </Widgets>
  </xsl:template>

          <!-- Skip by this in regular processing;
               it gets explicitly converted inside <Widgets> (see above) -->
          <xsl:template match="in:Widgets"/>

          <!-- Also, don't copy whitespace appearing
               immediately before in:Widgets -->
          <xsl:template match="text()
                               [following-sibling::node()[1][self::in:Widgets]]"/>

  <!-- 4: Everything copied as is, but in the new namespace -->

    <!-- Copy non-element nodes as is -->
    <xsl:template match="@* | text() | comment() | processing-instruction()">
      <xsl:copy/>
    </xsl:template>

    <!-- By default, just convert elements to new namespace
         (exceptions under #3 above) -->
    <xsl:template match="*">
      <xsl:apply-templates mode="convert" select="."/>
    </xsl:template>

            <xsl:template mode="convert" match="*">
              <!-- Optionally rename the element -->
              <xsl:variable name="name">
                <xsl:apply-templates mode="rename" select="."/>
              </xsl:variable>
              <xsl:element name="{$name}">
                <xsl:apply-templates select="@* | node()"/>
              </xsl:element>
            </xsl:template>

                    <!-- By default, just use the same local
                         name as in the input document -->
                    <xsl:template mode="rename" match="*">
                      <xsl:value-of select="local-name()"/>
                    </xsl:template>

</xsl:stylesheet> 
```

请注意，使用`local-name()`函数而不是`name()`函数很重要。如果您使用`name()`，如果您的输入文档开始使用未在样式表中显式声明的命名空间前缀，则您的样式表将中断（除非您添加`namespace`属性 to`<xsl:element>`以强制命名空间，即使出现前缀）。但是，如果我们使用`local-name()`，我们是安全的；它永远不会包含前缀，因此结果元素将采用我们样式表的默认命名空间。

对您的示例输入文档运行上述样式表会产生您所要求的内容：

```
<Root xmlns="http://widgetspecB.com/ns">...any...<WidgetBox>...any...
  <Widgets><Atom>
    ...any...
  </Atom><Molecule>
    ...any...
  </Molecule></Widgets>...any...
</WidgetBox>...any...</Root> 
```

如果您有任何问题，请告诉我。XSLT 不是很强大！

PS如果我想像您的示例那样在复制空白时非常精确，我可以使用逐步的“链式”处理，其中我一次仅将模板应用于一个节点，并且每个模板规则负责继续处理到它的下一个兄弟姐妹上。但在这种情况下，这似乎有点矫枉过正。

更新：您发布的新解决方案非常合理。不过可以简化一些。我采用了您的新解决方案，并在下面进行了一些建议的更改，并附有说明我更改的内容以及我进行这些更改的原因的评论。

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:old="http://widgetspecA.com/ns"
    xmlns="http://widgetspecB.com/ns"
    exclude-result-prefixes="old">

  <!-- "xml" is the default; no real need for this
  <xsl:output method="xml"/>
  -->

  <!-- This works fine if you only want to copy elements, attributes,
       and text. Just be aware that comments and PIs will get
       effectively stripped out, because the default template rule
       for those is to do nothing.
  -->
  <xsl:template match="*">
    <xsl:element name="{name()}">
      <xsl:copy-of select="@*"/>
      <xsl:apply-templates/>
    </xsl:element>
  </xsl:template>

  <xsl:template match="old:SmallWidget" mode="single">
    <Atom>
      <xsl:apply-templates/>
    </Atom>
  </xsl:template>

  <xsl:template match="old:Widgets" mode="single">
      <Molecule>
        <xsl:apply-templates/>
      </Molecule>
  </xsl:template>

  <!-- You actually only need one rule for <old:SmallWidget>.
       Why? Because the behavior of this rule will always
       be exactly the same as the behavior of the other rule
       you supplied below.
  -->
  <xsl:template match="old:SmallWidget"> <!--[following-sibling::old:Widgets]">-->
      <Widgets>
                      <!-- "." means exactly the same thing as "self::node()" -->
       <xsl:apply-templates select="." mode="single"/>

       <!-- If the node-set is empty, then this will be a no-op anyway,
            so it's safe to have it here even for the case when
            <old:Widgets> is not present in the source tree. -->
                                    <!-- This XPath expression ensures
                                         that you only process the next
                                         sibling element - and then only
                                         if it's name is <old:Widgets>.
                                         Your schema might not allow it,
                                         but this is a clearer communication
                                         of your intention, and it will also
                                         work correctly if another
                                         old:SmallWidget/old:Widget pair
                                         appeared later in the document.
                                    -->
       <xsl:apply-templates select="following-sibling::*[1][self::old:Widgets]"
                            mode="single"/>
      </Widgets>
  </xsl:template>

                                  <!-- updated this predicate for the
                                       same reason as above. Answers the
                                       question: Is the element right before
                                       this one a SmallWidget? (as opposed to:
                                       Are there any SmallWidget elements
                                       before this one?) -->
  <xsl:template match="old:Widgets[preceding-sibling::*[1][self::old:SmallWidget]]"/>

  <!-- Removed, because this rule effectively has the same behavior as the other one above
  <xsl:template match="old:SmallWidget[not(following-sibling::old:Widgets)]">
      <Widgets>
       <xsl:apply-templates select="self::node()" mode="single"/>
      </Widgets>
  </xsl:template>
  -->

  <!-- no need for the predicate. The format of this pattern (just a name)
       causes this template rule's priority to be 0\. Your other rule
       for <old:Widgets> above has priority of .5, which means that it
       will override this one automatically. You don't need to repeat
       the constraint. Alternatively, you could keep this predicate
       and remove the other one. Either way it will work. (It's probably
       a good idea to place these rules next to each other though,
       so you can read it like an if/else statement) -->
  <xsl:template match="old:Widgets">  <!--[not(preceding-sibling::*[1][self::old:SmallWidget])]">-->
      <Widgets>
       <xsl:apply-templates select="." mode="single"/>
      </Widgets>
  </xsl:template>

</xsl:stylesheet> 
```

# c - VB6 中的 C/C++ '继续' 等效项

> ID：831102
> 
> 赞同：24
> 
> 时间：2009-05-06T18:46:58.723
> 
> 标签：c, vb6

是否有等效于 C/C++ 'continue' 关键字的 VB6？

在 C/C++ 中，命令“继续”开始循环的下一次迭代。

当然，还存在其他等价物。我可以将循环的剩余代码放在 if 语句中。或者，我可以使用 goto。（啊！）

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-06T18:54:23.510

在 VB6 中没有等效项，但后来的 VB 版本确实引入了这个关键字。这篇文章有更深入的解释：http: [//vbnotebookfor.net/2007/06/04/the-continue-statement/](http://vbnotebookfor.net/2007/06/04/the-continue-statement/)

也许您可以重组您的代码以添加一个 if 语句或让循环只调用一个您可以从中返回的函数。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-06T18:58:29.803

VB6 没有循环的 continue 语句。您必须使用 goto、if 或其他循环来模拟它。

```
//VB.net
do
    if condition then continue do
    ...
loop
//VB6 equivalent (goto)
do
    if condition then goto continue_do
    ...
continue_do:
loop
//VB6 equivalent (if)
do
    if not condition then
        ...
    endif
loop 
```

您不能在 VB6 中使用“exit while”。但是你可以使用 goto。

```
While condition

    if should_skip then goto mycontinue

    'code

    if should_break then goto outloop

   mycontinue:

Wend

outloop: 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-06T18:53:13.933

遗憾的是，如果 VB6 没有 Continue - 我相信这是 VB 2005 中的新功能。

我不会总是害怕 goto 语句——这实际上就是 Continue 的含义，但在循环之后不需要标记行。只要你的 goto 语句不跳得太远，它们总是可读的，它可能是解决这个问题的最优雅的解决方案。

在 for 循环中嵌套另一个 if/then/else 实际上比一个简单的 goto 更难阅读和维护（在 goto 行上注释说“' read as Continue For”）。

祝你好运！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T18:49:56.530

我是个白痴 :P 谢谢 MarkJ

```
 For index As Integer = 1 To 10
        If  index=9 Then
            Continue For
        End If
   'some cool code'
    Next 
```

仅对 .net 不抱歉。我认为您必须使用 goto，我知道使用 continue 看起来“更干净”，但是使用 if 路线并没有错。

错误的。

```
 Continue:
     For index As Integer = 1 To 10
                If index=9 Then
                  GoTo Continue
                End If
    'some cool code'
     Next 
```

更正（？）

```
 For index = 1 To 10
      If index=9 Then
       GoTo Continue 
      End If    
    'some cool code'
Continue:
     Next 
```

讨厌 vb

# .htaccess - .htaccess 与 GET 参数冲突

> ID：831104
> 
> 赞同：0
> 
> 时间：2009-05-06T18:47:13.950
> 
> 标签：.htaccess

这是我的 .htaccess 文件：

```
RewriteEngine on

RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule .* ?p=$0 
```

`mysite.com/?p=request`仅当`request`不是文件时才应重定向到。`http://mysite.com/auth.php?openid.ns=http%3A%2F`但是，由于`%2F`（auth.php 确实存在），它不正确地匹配请求。我不明白为什么这会把事情搞砸......想法？

**编辑：**伙计们，我强调`%2F`（顺便说一句，这是一个正斜杠），因为*当这个角色不在那里时它可以正常工作*

要清楚，

我得到这个页面的 404：`http://mysite.com/auth.php?openid.ns=http%3A%2F`

但不是这个页面：`http://mysite.com/auth.php?openid.ns=http%3A`

* * *

仅供参考，我真的把这个问题搞砸了。每当 %2F 出现在 URL 中时，就会发生 403 错误。我的应用程序捕捉到了这个错误并吐出了一个欺骗性的 404，这对最终用户来说可能不那么可怕。毕竟真的与 .htaccess 无关。我在下面的答案中提供了更多详细信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T22:54:31.280

是否可能需要启用[`AllowEncodedSlashes`](http://httpd.apache.org/docs/2.2/mod/core.html#allowencodedslashes)，默认情况下是关闭的？关闭此指令后，包含编码的正斜杠和反斜杠字符（即 %2F 和 %5C）的请求将被拒绝并返回 404。

我隐约记得在 MediaWiki 中看到过这个问题，在转义标题等时必须做各种有趣的事情，以避免在不同级别的请求处理中出现各种错误。事实证明，Apache 领域的很多事情都喜欢乱用 PATH_INFO 之类的东西，这给我们其他人带来了无尽的地狱。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T14:00:49.480

很高兴您与您的托管服务提供商一起解决了这个问题。您是否找到其他有效的斜线组合并与之对抗？;)

一个与 apache 无关的答案是根本不在参数中传递已知的“http://”字符串。将我的 stackoverflow 帐户页面视为 openID 示例，它甚至似乎根本没有存储“http://”，只是“me.yahoo.com/a/swxth ....”。

也许这才是真正的答案。如果您的应用程序希望在内部使用“http”URL 执行某些操作，它应该知道在最后负责的时刻将其添加到开头。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:37:03.377

这可能与您的正则表达式中没有括号因此不会发生捕获有关。以下对我有用：

```
RewriteEngine on
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)$ ?p=$1 [L,QSA] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T07:06:04.873

不是`AllowEncodedSlashes`问题。它达到了`mod_security`禁止`http://`在参数中防止文件注入的规则。他们为我将其列入白名单。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T18:59:46.057

你能确定你不是这个意思吗？

```
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} -f 
```

要测试变量的值是什么，请使用以下内容：

```
RewriteRule (.*) http://www.google.com/?test=%{REQUEST_FILENAME} [L] 
```

如果它没有您的 auth.php 文件的完整文件路径，它将找不到它。我在这里得到了这个信息：

[http://mail-archives.apache.org/mod_mbox/httpd-bugs/200812.mbox/](http://mail-archives.apache.org/mod_mbox/httpd-bugs/200812.mbox/)

# c - 如何更改处理器堆栈？

> ID：831107
> 
> 赞同：2
> 
> 时间：2009-05-06T18:47:35.647
> 
> 标签：c, assembly, x86, stack, stack-pointer

为什么这段代码不打印“测试”？

```
#include <stdio.h>
#include <stdlib.h>

void foo ( void ) {
   printf("test\n");
}

__declspec(naked)
void bar ( void ) {
   asm {
      push 0x000FFFFF
      call malloc
      pop ecx
      push eax
      add eax, 0x000EFFFF

      mov ecx, esp
      mov esp, eax
      push ecx

      call foo

      pop esp
      call free
      pop ecx
      ret
   }
}

int main(int argc, char* argv[])
{
   bar();
   return 0;
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-06T18:57:21.740

因为您新分配的堆栈不是 DWORD 对齐的。将代码更改为：

```
 push 0x00100000
  call malloc
  pop ecx
  push eax
  add eax, 0x000f0000 
```

...它会根据需要打印。

请务必添加 \n 以避免按照 Paul 的建议出现缓冲问题。

# c++ - 在 C++ 中解析字符串

> ID：831111
> 
> 赞同：1
> 
> 时间：2009-05-06T18:49:04.007
> 
> 标签：c++, string, parsing, casting, integer

我正在尝试为接受字符串作为参数并使用它来构建图形的图形类创建一个构造函数。

该字符串的格式如下：`|vertex list|Edges list|` 例如`|1,2,3,4,15|(1->2),(3->2),(4->15)|`

这个想法是构造函数将从字符串中获取值，然后知道执行以下操作（将顶点插入顶点列表，然后将边插入边缘列表）：

```
addVertex(1)  
addVertex(2)  
addVertex(3)  
addVertex(4)  
addVertex(15)  
addEdge(1,2)  
addEdge(3,2)  
addEdge(4,15) 
```

我会做几个“for”循环来扫描字符串，但我不知道如何处理双（或更多）数字。我开始想象各种非常复杂的 for 循环，我想知道这里是否有人可以与我分享任何更智能的方法来提取和使用这些数据。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T19:11:14.267

看着整件事，你似乎不知所措。把它分成几块……任务。您正在尝试做的似乎是这里的单独功能。

1.  标记化
2.  解析顶点
3.  解析边缘
4.  在顶点上执行
5.  边缘执行

那或多或少有5个功能。

您想要基于管道 (|) 进行标记化，因此基于管道获取子字符串并将每一侧传递给适当的解析器，解析逗号等等。

不会为你做这件事，但希望我能让你朝着正确的方向思考。学习编程不是关于任何特定的语言，而是关于改变你的思维方式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T18:51:58.943

我以前从未使用过它，但是有一个 Boost [tokenizer](http://www.boost.org/doc/libs/1_38_0/libs/tokenizer/tokenizer.htm)类。您可以让它轻松地将事物分解为您的组件，而无需所有 for 循环。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T18:52:39.473

您可以使用 a`stringstream`并使用流提取运算符来获取整数。

```
string s("12 34");
istringstream ss(s);
int x, y;
ss >> x >> y; 
```

由于这是家庭作业，我敦促您探索各种可能性并为自己找出完整的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T03:46:44.417

无需为您做功课，这将为您提供良好的开端。我已经给了你解析顶点列表的基本工作流程，你应该可以自己做边缘列表。我还将错误检查留给您，例如在 parseVertex() 中，您可能希望在遇到无效字符时给出错误。

```
void skipWhiteSpace(const char*& first , const char* last) {
    // do whatever need to be done to skip white space
}

// parse integer only, no error checking is performed
bool parseVertex(const char*& first , const char* last) {
    skipWhiteSpace(first, last);
    const char* numBegin = first;
    for (; first != last && ::isdigit(static_cast<unsigned char>(*first)); 
        ++first) {}
    if (numBegin != first) {
        std::cout << "addVertex(" << std::string(numBegin, first) << ")" << std::endl;
        return true;
    }

    return false;
}

bool parseComma(const char*& first , const char* last) {
    skipWhiteSpace(first, last);
    if (first != last && ',' == *first) {
        ++first;
        return true;
    }

    return false;
}

// VL := V (, VL)
// a vertex list (VL) is a vertex (V) followed by a comma than another vertex list
bool parseVertexList(const char*& first, const char* last) {
    if (parseVertex(first, last)) {
        parseComma(first, last) && parseVertexList(first, last);
        return true;
    }

    return false;
}
}

void test() {
    const char* str = "1,2,3,4,15";
    parseVertexList(str, str + sizeof("1,2,3,4,15"));
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T04:16:55.810

使用递归下降技术解析这种事情相当简单（虽然乏味）。这个想法是将被解析的语言分成逻辑单元，然后编写一个函数来解析每个单元。

如果我们在示例中计算“|1,2,3,4,15|(1->2),(3->2),(4->15)|" 如果整个字符串是一个“多边形”，我们将编写 parsePolygon()，它看起来像这样：

```
void parsePolygon (Buffer& b)
{
  parseVertices (b);
  parseEdges (b);
} 
```

让我们假设 Buffer 是一个贯穿您的字符串的类。您将需要两个基本操作：查看下一个字符而不使用它，然后使用下一个字符。

parseVertices 可能如下所示：

```
void parseVertices (Buffer& b)
{
  if (b.peek() != '|') { /* error */ }
  b.consume (); // burn the '|'
  parseVertexList (b);
  if (b.peek() != '|') { /* error */ }
  b.consume (); // burn the '|'
} 
```

显然，您希望更好地处理错误。如果流遇到任何错误，它需要将错误代码向上传递到调用堆栈或抛出异常。

另外两个示例... parseVertexList 和 parseNumber 可能如下所示：

```
void parseVertexList (Buffer& b)
{
  addVertex (parseNumber (b));
  while (b.peek() == ',')
  {
     b.consume (); // eat the comma
     addVertex (parseNumber (b));
  }
}

int parseNumber (Buffer& b)
{
  char accum[80] = { '0' };  // sensible default in case of failure
  int accumPos = 0;
  while (isDigit (b.peek())
  {
    accum[accumPos++] = b.consume();
  }
  return atoi(accum);
} 
```

这一切都非常快速和肮脏，但希望它能让您了解该技术的工作原理。您可以将您的处理与您的解析混合，如上所示，其中 parseVertexList 函数实际上为您执行 addVertex 调用。

我认为这确实是最简单的手动解析方法之一。理想情况下，我们总是能够使用生成的解析器，如 boost spirit、pyparsing 或 lex/yacc，但生活并不总是那么美好，尤其是对于家庭作业。

另外我认为值得注意的是，对于某些解析情况，上述技术可能会有些过大。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T03:51:26.963

我当然会以这个问题为借口来玩[boost精神](http://spirit.sourceforge.net/distrib/spirit_1_8_5/libs/spirit/index.html)！为这种小语言写一点语法应该很有趣。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T18:52:45.213

使用[`stringstream`](http://www.cplusplus.com/reference/iostream/istringstream/istringstream/). 请注意该页面上的示例，用于读取带有`istringstream`.

# apache-flex - Flex：通过组合应用样式？

> ID：831116
> 
> 赞同：1
> 
> 时间：2009-05-06T18:50:07.857
> 
> 标签：apache-flex

我有一个基于 HBox 的组件，其中包含多个标签。我希望能够在我的组件上设置所有样式属性，例如 fontSize、fontWeight、颜色等，并将它们应用于它包含的所有标签。最好的方法是什么？我试图让我的组件实现 Label 但没有 Label 接口。

谢谢。

PS 不确定这个问题的好标题是什么，所以如果你有更好的东西，请随时编辑它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T19:43:04.390

我能想到的两个选择：

1.  您可以为您的组件提供一个默认样式表 (default.css)，并为 Label.fontSize、Label.fontWeight 等使用自定义样式，这些样式将在整个过程中传播。

2.  您可以扩展 Label 以创建自定义组件并在其中定义默认样式。然后在您的自定义组件中使用您的自定义标签。

查看此文档以获取更多信息： http://livedocs.adobe.com/flex/3/html/help.html?content=
[ascomponents_8.html](http://livedocs.adobe.com/flex/3/html/help.html?content=ascomponents_8.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T19:44:52.797

我没有意识到这一点，但您已经可以在 HBox 上设置所有这些属性，并且其中的标签继承它们。:)

# apache - 对于使用 Apache 2.0 的 IE 8 浏览器，如何将 X-UA-Compatible 标头设置为 IE=EmulateIE7？

> ID：831119
> 
> 赞同：2
> 
> 时间：2009-05-06T18:50:32.257
> 
> 标签：apache, internet-explorer, browser, internet-explorer-8, internet-explorer-7

我可以设置这个标题

```
X-UA-Compatible "IE=EmulateIE7" 
```

在我的 Apache 2.0 httpd.conf 文件中使用以下指令：

```
<Location /mypath>
   Header set X-UA-Compatible "IE=EmulateIE7"
</Location> 
```

如何将 Apache 配置为仅为 IE 8 浏览器设置此标头？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T14:25:52.570

这是迄今为止我能想到的最好的。它*似乎*工作。如果有人有更好的方法，请告诉我。

```
BrowserMatch "^.*MSIE 8.*$" emulate_ie7

<Location /mypath>
   Header set X-UA-Compatible "IE=EmulateIE7" env=emulate_ie7
</Location> 
```

# c# - C# RegEx同时匹配字符串的开头和单词的开头

> ID：831121
> 
> 赞同：4
> 
> 时间：2009-05-06T18:51:11.583
> 
> 标签：c#, .net, regex

假设有六个字符串

1.  “abcd bbb ccc”
2.  “abce bbb ccc”
3.  “abcf bbb ccc”

4.  “aaa abcd ccc”

5.  “aaa abce ccc”
6.  “aaa abcf ccc”

用户输入表达式“ `<abc[!e]`”

这个表达式被翻译成下面的正则表达式“^abc[^e]”

翻译的正则表达式将成功匹配字符串 1 和 3

如果我想匹配字符串 4 和 6，则必须将表达式转换为 "\Wabc[^e]"（这也将匹配 abc 字符之前的空格 :(，这不好）

不幸的是，用户输入的表达式需要转换为匹配 1,3 和 4,6 字符串的正则表达式。

有没有办法将用户输入的表达式转换为结合“^abc[^e]”和“\Wabc[^e]”表达式的正则表达式（理想情况下，第二个表达式与第一个空格不匹配:)）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T19:24:50.380

Perl 知道零宽度字边界 \b：

```
\babc[^e] 
```

我认为它应该适用于大多数 Perl 风格的正则表达式引擎。

# batch-file - 将变量设置为批处理文件中“查找”的结果

> ID：831122
> 
> 赞同：10
> 
> 时间：2009-05-06T18:51:23.877
> 
> 标签：batch-file, find

我想根据文件中包含给定字符串的行数设置一个变量。

就像是：

```
set isComplete = 0
%isComplete% = find /c /i "Transfer Complete" "C:\ftp.LOG"
IF %isComplete% > 0 ECHO "Success" ELSE ECHO "Failure" 
```

或者：

```
set isComplete = 0
find /c /i "Transfer Complete" "C:\ftp.LOG" | %isComplete%
IF %isComplete% > 0 ECHO "Success" ELSE ECHO "Failure" 
```

显然，这些选项都不起作用。

谢谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-06T19:03:31.040

从命令行

```
for /f "tokens=3" %f in ('find /c /i "Transfer Complete" "C:\ftp.LOG"') do set isComplete=%f 
```

从批处理脚本

```
for /f "tokens=3" %%f in ('find /c /i "Transfer Complete" "C:\ftp.LOG"') do set isComplete=%%f 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-07T00:39:28.547

您不需要使用该`for`命令；`find`将根据结果将 设置`ERRORLEVEL`为这些值之一：

*   0，至少找到一个匹配项。
*   1，没有找到匹配项。
*   2 个或更多，发生错误。

由于看起来您只想查看传输是否完成，而不是字符串出现的总次数，您可以执行以下操作：

```
@echo OFF

@find /c /i "Transfer Complete" "C:\test path\ftp.LOG" > NUL
if %ERRORLEVEL% EQU 0 (
    @echo Success
) else (
    @echo Failure
) 
```

# asp.net - Javascript 与背后的 ASP.NET 代码一起使用

> ID：831134
> 
> 赞同：2
> 
> 时间：2009-05-06T18:53:45.070
> 
> 标签：asp.net, javascript, popup, code-behind, confirm

我必须为一个简单的 Intranet 论坛制作一个删除按钮。我希望在删除帖子时有一个 javascript 警报框（或等效项）要求确认。但是，我发现很难将 javascript 确认框的结果输入到代码隐藏中。这甚至可能吗？还是我必须使用另一种设计？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T18:56:18.920

如果用户点击取消，您只需阻止回调发生

编辑：正如乔什·斯托多拉所指出的

```
 <asp:Button runat="server" ID="Save" 
    OnClientClick="if (!confirm('Are you sure?')) return false;" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T18:58:58.583

你想做这样的事情：

```
 <asp:button runat="server" id="mybutton" 
OnClientClick="return confirm('delete?');" /> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T18:59:31.640

如果您想使用另一种设计，对于这样的确认框，我总是使用 ASP.NET AJAX 控件工具包中的 ModalPopup。这样我就不必触摸 javascript，并且可以更好地控制正在发生的事情，因为在模式弹出窗口中单击按钮会给我一个回发。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T19:00:48.207

你应该能够做这样的事情 - 如果他们选择是，它只会触发帖子：

```
<asp:Button ID="btnDelete" text="Delete" runat="server" 
OnClick="DoDeleteFunction();"  
OnClientClick="return confirm('Are you sure you want to delete?')">
</asp:Button> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T19:01:33.493

为什么要将响应发送到后面的代码？您可以做的是在您的按钮中，只需制作它，因此如果他们取消，它根本不会回发。

执行以下操作：

```
<asp:button id="mybutton" runat="server" 
 onclientclick="javascript:if(!confirm('Confirm delete?')) return false;" /> 
```

这是基本的想法。如果您确实需要它即使在取消后仍然回发，并通过确认响应，那么我个人会在表单中添加一个 asp:hidden，并让 javascript 适当地设置隐藏字段的值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T19:02:00.030

您可以像这样显示客户端确认对话框：

```
<asp:Button ID="btnDelete" runat="server"
   OnClientClick="return confirm('really delete?');"
   OnClick="btnDelete_Click" /> 
```

只有当用户用 Yes 回答确认对话框时，才会执行 PostBack。否则，不会发生回发，也不会调用服务器端处理程序 (btnDelete_Click)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T19:02:13.693

如果您有可用的 ASP.NET AJAX，请使用[ConfirmButtonExtender](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ConfirmButton/ConfirmButton.aspx)。

您照常连接删除按钮背后的代码。然后将确认扩展器附加到它。它会自动插入适当的 JavaScript 为您提供模态确认（使用 bling，而不是浏览器警报样式），并且将正常进行或根据用户的决定取消。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-06T19:21:10.980

我建议为此将标准按钮控件子类化，以便您将来可以再次重用代码。

```
namespace MyApp.Controls
{
    public class PromptButton
    {
        public string Prompt { get; set; }

        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);

            if (!string.IsNullOrEmpty(Prompt))
            {
                // Escape apostrophe's in the prompt message
                string safePrompt = Prompt.Replace("'", "\'");

                // Add the onClick to show the alert box when clicked
                Attributes.Add("onClick", string.Format("return confirm('{0}')", safePrompt));
            }
        }
    }
} 
```

完成此操作后，您可以在 ASPX 页面顶部或 web.config 中添加引用：

```
<%@ Register Assembly="MyAssembly" Namespace="MyApp.Controls" TagPrefix="app" %> 
```

在您的页面中，您将使用以下内容：

```
<app:PromptButton ID="PromptButton1" Prompt="Are you sure?" OnClick="PromptButton1_Click" runat="server" /> 
```

这将导致显示 Javascript 确认对话框，如果用户单击“确定”，则会发生回发。如果用户单击“取消”，则不会发生任何事情。

一开始需要做更多的工作，但代码的可重用性要高得多，甚至可以完全移入一个单独的库并在多个项目中使用。

# ruby-on-rails - 问题升级 Rails

> ID：831139
> 
> 赞同：1
> 
> 时间：2009-05-06T18:54:29.733
> 
> 标签：ruby-on-rails

我正在运行 Tiger 并且（愚蠢地）决定将 Rails 从 1.1.6 升级到 1.2.6。我运行了命令“sudo gem install rails --include-dependencies”，一切似乎都正常。但是，安装后，当我运行命令“rails -v”时，我得到了如下所示的错误。难道是1.2.6不兼容Tiger？我一直在互联网上搜索兼容性信息，但没有找到任何东西。顺便说一句，在绝望中，我试图回到 1.1.6，但我仍然遇到同样的错误，所以现在我被淹没了。任何人都可以帮忙吗？谢谢。

```
/usr/local/lib/ruby/gems/1.8/gems/activesupport-2.3.2/lib/active_support/dependencies.rb:55: uninitialized constant ActiveSupport::Dependencies::Mutex (NameError)
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:27:in `gem_original_require'
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:27:in `require'
    from /usr/local/lib/ruby/gems/1.8/gems/activesupport-2.3.2/lib/active_support.rb:56
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:27:in `gem_original_require'
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:27:in `require'
    from /usr/local/lib/ruby/gems/1.8/gems/activerecord-2.3.2/lib/active_record.rb:25
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:27:in `gem_original_require'
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:27:in `require'
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems.rb:229:in `activate'
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems.rb:228:in `each'
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems.rb:228:in `activate'
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems.rb:214:in `activate'
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems.rb:213:in `each'
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems.rb:213:in `activate'
    from /usr/local/lib/ruby/site_ruby/1.8/rubygems.rb:66:in `active_gem_with_options'
    from /usr/local/lib/ruby/site 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T19:05:57.977

通过你所做的，看起来你直接跳到了 rails 2.3.2。

我建议您现在做的是首先升级所有内容：

```
sudo gem update --system
sudo gem update 
```

然后也安装 1.2.6 版本。现在您将拥有 1.1.6、1.2.6 和 2.3.2

```
sudo gem install rails -v1.2.6 
```

而且，顺便说一句，您的 ruby​​ 版本是什么，您使用的是 Apple 提供的版本吗？特别是，如果您运行以下两个命令，您将获得所需的信息。（这肯定与我的不同）

```
$ ruby --version
ruby 1.8.7 (2009-04-08 patchlevel 160) [i686-darwin9]
$ which ruby
/opt/local/bin/ruby 
```

不，与 Tiger 没有不兼容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-30T00:43:46.613

当我（盲目地）遵循[HiveLogic](http://hivelogic.com/articles/ruby_rails_lighttpd_mysql_tiger)的 OS X RoR 安装说明时，我收到了这个错误。您会期望它们会没事，因为 Apple 链接到它们。 **但是**，本文档中包含的二进制路径已过时！！！

特别是，RubyGems 是 0.9 而不是 1.3。列表中的其他二进制文件已过期并带有死链接。

[要解决此问题，请遵循Ruby on Rails](http://rubyonrails.org/download)的当前指示。您将下载并安装正确版本的 RubyGems，然后一切顺利！

如果您遵循 HiveLogic 指示，您可能需要检查所有版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-30T00:51:04.677

您可以通过在 config/environment.rb 顶部设置 RAILS_GEM_VERSION 常量来指定所需的 Gem 版本，例如

```
RAILS_GEM_VERSION = '2.3.2' 
```

或者您可以将 Rails 冻结在 vendor/rails 中。当 Rails 从您的应用程序引导自身时，它会首先在 vendor/rails 中查找，因此您可以在其中冻结您想要的版本。但我自己更喜欢 RAILS_GEM_VERSION 方法。

# coding-style - 行业传播码格式化工具

> ID：831145
> 
> 赞同：1
> 
> 时间：2009-05-06T18:56:28.200
> 
> 标签：coding-style, code-formatting

业界最常使用哪些工具来格式化源代码，尤其是 C++，以便获得整个代码库的风格一致性？可能是允许用户选择应用哪种风格的工具（例如 BSD、GNU 等）？

我在网络上找不到很多关于此类工具的可靠、广泛使用的工具的参考资料，也许使用这些工具的公司是在内部构建的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T19:13:49.000

似乎没有一个单一的“标准”代码格式化工具。这是有充分理由的：重新格式化大量代码几乎总是一个坏主意(1)。如果不出意外，六个月后您将不得不合并来自另一个分支的更改，并且如果您重新格式化了您的分支，那么您注定要失败。更好地适应现有模块中的现有代码样式。

1）我会说“总是”，除了我遇到的一个例外：大约一千行评论，包含铁路轨道图。它们是已发布编程语言语法关键部分的唯一文档。以前的代码所有者使用 MASM 的编辑器进行了编辑，它对空白做了*非常*奇怪的事情——大量混合的空格和制表符。评论中提到的代码没有编译，我必须知道它应该做什么......我花了一周的时间重新格式化那些铁轨图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T19:04:14.190

除了您的 IDE（添加一小部分标准插件）为您提供格式化源代码的工具之外，我还没有看到一个特殊的工具。当然，可能有一些组织确实使用它们。

您似乎受到该`indent`工具的影响。唉，大多数组织倾向于有自己的格式标准，这些标准可能与您提到的一种风格有关/可能无关。它们可能更适合由自定义 .indent 文件表示。

# jquery - 从父窗口打印动态创建的 iframe 的内容

> ID：831147
> 
> 赞同：18
> 
> 时间：2009-05-06T18:56:47.513
> 
> 标签：jquery, iframe, printing

我有一个包含链接列表和 div 的页面，该 div 用作链接指向的页面的占位符。每次用户单击链接时，都会在 div 中创建一个 iframe，其 src 属性获取链接 href 属性的值 - 简单明了，类似于外部网页库。我遇到的问题是打印 iframe 的内容。为此，我使用以下代码：

```
函数 PrintIframe()  
{  
帧[“名称”].focus();  
帧[“名称”].print();  
}

```

问题似乎是 iframe 是由 JQuery 动态创建的 - 当我将 iframe 插入到 html 代码中时，浏览器会正常打印外部页面。但是对于 JavaScript 注入的相同代码，什么也没有发生。我尝试在“打印”链接上使用 JQ 1.3 'live' 事件，但没有成功。有没有办法克服这个问题？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2012-03-10T16:39:15.313

假设这是您的 iframe 的样子：

```
<iframe id='print-iframe' name='print-frame-name'></iframe> 
```

这是使用 jQuery 的方法：

```
$("#print-iframe").get(0).contentWindow.print(); 
```

这就是您使用本机 JavaScript 的方式：

```
document.getElementById("print-iframe").contentWindow.print(); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-06T20:19:33.930

我试过这个并且能够复制这个问题。我注意到的是，在调用打印功能时，iframe 尚未完成加载。我通过在调用 PrintIFrame() 时检查 innerHTML 的值来测试这一点。为了克服这个问题，您可以在 x 毫秒后使用 setTimeOut 再次调用该函数：

```
function PrintIframe() { 

        if (window.frames['myname'].innerHTML != "") {
            window.frames['myname'].focus();
            window.frames['myname'].print();
        } else {
            setTimeout(PrintIframe,1000);
        }    
    } 
```

这对我有用

**编辑** 奇怪 - 我的测试代码中有一个警报，这似乎使它工作。当我拿出它时，它没有工作。对不起 ：（

无论如何，这应该使用 jQuery 将加载事件处理程序附加到 iframe。我已经在 IE8 上测试过，它可以工作：

```
<html>
<head>
    <script language="javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript">
    function loadiFrame(src)
    {
        $("#iframeplaceholder").html("<iframe id='myiframe' name='myname' src='" + src + "' />");
    }

    $(function()
    {
        $("#printbutton").bind("click", 
            function() { 
                loadiFrame('test.aspx'); 
                $("#myiframe").load( 
                    function() {
                        window.frames['myname'].focus();
                        window.frames['myname'].print();
                    }
                 );
            }
        );
    });
    </script>    
</head>
<body>
    <input type="button" id="printbutton" value="Load iFrame" />
    <div id="iframeplaceholder"></div>
</body>
</html> 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-10-28T15:47:45.073

我在打印 iframe 的内容时遇到了问题。为了实现这一点，请使用以下代码：

例如，您有 iframe：

```
<iframe id='print-iframe' name='print-iframe'></iframe> 
```

然后 js 打印 iframe 的内容调用这个函数（在 ie 和其他浏览器中都有效）：

```
printIframe('print-iframe'); 
```

函数代码：

```
function printIframe(iFrameId) {
    var ua = window.navigator.userAgent;
    var msie = ua.indexOf ("MSIE ");
    var iframe = document.getElementById(printFrameId);

    if (msie !== 0) {
        iframe.contentWindow.document.execCommand('print', false, null);
    } else {
        iframe.contentWindow.print();
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T18:59:15.090

嗯，我做对了吗？你只需要改变IFrame通向哪里的来源？

```
$("#iframe").attr("src", "http://www.example.com"); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T19:21:06.753

也许同域限制会阻止您的 JavaScript 执行。如果 A 和 B 来自同一个域，则同域限制允许框架 A（或主窗口）中的 JavaScript 与框架 B 交互（例如 .print()）。检查您的 JavaScript 错误控制台。如果您收到类似安全异常/权限错误的信息，那么很可能是因为同域限制。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-08T21:00:59.933

```
var ifrm = document.createElement("iframe");
// ifrm.style.display = "none";
document.body.appendChild(ifrm);
setTimeout(function() {
    $(ifrm).contents().find("body").html("my html content");
}, 1);
ifrm.onload = function() {
    ifrm.contentWindow.print();
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-12-10T17:02:14.293

我在网上找到了这个

```
$('#preview-iframe').contents().find('html').html(data); 
```

并将其更改为

```
$('#preview-iframe').contents().find('html').html(data).after(function() {
    document.getElementById("preview-iframe").contentWindow.print();
}); 
```

[树枝技术提示](http://twigstechtips.blogspot.com/2011/02/jquery-set-content-of-empty-iframe.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-10-04T20:27:35.753

我知道这是一个非常古老的线程，但我有一个更可靠的解决方案。

它基于 [https://stackoverflow.com/a/9648159/3183069](https://stackoverflow.com/a/9648159/3183069)和[https://stackoverflow.com/a/831547/3183069](https://stackoverflow.com/a/831547/3183069)

我添加了 .one() 函数，因此如果取消打印，它不会无限循环！我也加载了一次 iframe。享受

```
var $body = $("body"),
  $iframe,
  loadiFrame = function(src) {
    if ($body.children('#full-prog').length == 0) {
      $body.append("<iframe id='full-prog' src='" + src + "' />");
      $iframe = $("#full-prog");
      $iframe.one('load', function() {
        $iframe.get(0).contentWindow.print();
      });
    } else {
      $iframe.get(0).contentWindow.print();
    }
  };

$("#printbutton").click(function() {
  loadiFrame('iframe source here');
});
```

```
#full-prog {
  overflow: hidden;
  position: absolute;
  width: 0;
  height: 0;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<input type="button" id="printbutton" value="Load iFrame" />
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-03-23T05:12:56.497

这是一个非常古老的线程，但我找到了一个可行的解决方案。

我在 jquery 中添加了 sleep，所以它不会打印空窗口，它需要几秒钟来重新加载新替换的内容。

```
$('#printiframe').attr('src', pdf_file_path);
setTimeout(function () {
     $("#printiframe").get(0).contentWindow.print();
}, 500); 
```

# php - PHP自动启动加载脚本

> ID：831149
> 
> 赞同：3
> 
> 时间：2009-05-06T18:57:06.640
> 
> 标签：php, autostart

是否有一个设置可以让我在 PHP 启动后自动加载/执行一些脚本，比如将一些常量放入全局内存中。

还有一个可以跨用户访问的全局内存吗？另外关于内存，是否没有所有用户都可以访问的内存？一个人设置另一个人访问它，或者我是否应该每次都必须读写文件才能共享某些东西，或者更确切地说是数据库临时表。

惊讶的 PHP 没有这个？

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T19:23:42.957

PHP 不提供跨脚本共享的全局缓存。您可以根据您的要求以不同的方式解决此问题。

如果您想设置计算成本不高的全局常量，您可以编写一个定义这些常量的脚本，然后自动让该脚本在请求的文件之前运行。这是使用 php.ini 中的[auto_prepend_file 选项](http://php.net/ini.core#ini.auto-prepend-file)完成的。

如果您正在计算昂贵的值，您可以使用[memcached](http://www.danga.com/memcached/)作为所有 PHP 脚本都可以访问的全局缓存。有[多个客户端 API](http://code.google.com/p/memcached/wiki/Clients)可以使用 PHP 连接到 memcached。

当然，如果这些值是每个用户的，您也可以在[用户会话中存储全局值。](http://php.net/manual/en/features.sessions.php)甚至使用 MySQL。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T19:43:29.930

如果我理解正确，您希望 PHP 在启动 Apache 时执行一些脚本，以存储一些全局共享值。如果我错了，请编辑/评论。

简短的回答是：不，你不能那样做。PHP 并不完全是一个等待客户端请求保持运行的服务器。它单独处理每个 HTTP 请求。

长答案是：嗯......你可以在每个请求上执行 auto_prepend_file 。您可以创建一些简单的 bash 脚本并使用它来启动 Apache，然后调用 PHP 脚本，但它不会在 Apache 中执行。

至于共享内存，有几种选择。使用平面文件、数据库或 memcached 可能是最可移植的。某些安装启用了[共享内存](http://us2.php.net/shmop)功能，但不能保证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:01:52.587

如果您使用某种 MVC 框架，您可以在那里定义变量并确保每次都加载该文件。您可以使用 $GLOBALS['var_name'] = $value; 并在该请求期间在其他文件中访问它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T19:29:38.480

每个正在运行的 PHP 脚本实例都有自己的全局变量、函数、常量等，无法将变量从一个正在运行的脚本实例直接复制到另一个。但是，也有一些间接方法，例如使用文件、数据库或 memcached。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-14T11:40:25.173

如果您使用某些子系统（如 APC 共享内存，甚至 memcached），您可以通过编辑它的启动脚本 ( `/etc/init.d/[apache2|httpd]`) 在 apache 启动时自动运行数据生成器脚本。例如，您可以在 start|restart 后立即将 curl 或 wget 请求添加到生成器脚本。

在第一个“外部”请求中存在未初始化状态的可能性很小，但我相信您可以处理。

# sql - SQL Server，where子句与不同类型和默认转换行为的比较

> ID：831150
> 
> 赞同：5
> 
> 时间：2009-05-06T18:57:07.200
> 
> 标签：sql, sql-server, casting, types

对...今天这个让我困惑了一段时间，所以也许你们中的一个 SQL Server 明亮的火花可以阐明这种行为。

我们有一张桌子`Phones`。在其中，电话号码存储为 nvarchars，它包含国际格式的数字，只有数字格式......所以美国号码`+1-(212)-999-9999`存储为`12129999999`

由于其他原因，我有人写了一个 SPROC，将电话号码作为 bigint，没有强制转换，做了一个简单的 where 子句 = 比较，这工作得非常好，直到一些垃圾数据进入 nvarchar 列导致它破裂的桌子。考虑以下测试脚本。

```
IF EXISTS (SELECT * FROM sys.tables WHERE name = 'Phones')
BEGIN
    DROP TABLE Phones
END
GO

CREATE TABLE [dbo].[Phones]
(
    [ID] [int] IDENTITY(1,1) NOT NULL,
    [Mobile] [nvarchar](50) NOT NULL,
    CONSTRAINT [PK_Phones] PRIMARY KEY CLUSTERED 
    ( [ID] ASC )
    WITH (
      PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, 
      IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, 
      ALLOW_PAGE_LOCKS = ON ) ON [PRIMARY]
) ON [PRIMARY]
GO

DECLARE @biMobile_1 bigint
DECLARE @biMobile_2 bigint
SET @biMobile_1 = 12121111111
SET @biMobile_2 = 12129999999

Print 'Inserting Phone Number'
INSERT INTO Phones (Mobile) VALUES ('12121111111')

Print 'Selecting Phone Number'
SELECT * FROM Phones WHERE Mobile = @biMobile_1 --Select #1

Print 'Inserting Junk Data'
INSERT INTO Phones (Mobile) VALUES ('JUNK DATA')
INSERT INTO Phones (Mobile) VALUES ('12129999999')

Print 'Selecting From Table Containing Junk'
SELECT * FROM Phones WHERE Mobile = @biMobile_1 -- Select #2
SELECT * FROM Phones WHERE Mobile = @biMobile_2 -- Select #3 
```

第一个选择（标记为#1）将起作用第二个选择（标记为#2）将起作用，但在第三个选择（标记为#3）后立即出错。

返回的错误是

```
Error converting data type nvarchar to bigint. 
```

现在这似乎完全是疯狂的行为。我认为会发生的是

1.  `WHERE`SQL在子句中实现其比较2种不同的数据类型
2.  它会尝试将@variable 转换为列的数据类型
3.  如果失败，抛出一个错误，它可以工作，太棒了！！！

实际上似乎正在发生的是

1.  `WHERE`SQL在子句中实现其比较2种不同的数据类型
2.  在逐行的基础上，它将列中的值转换为@variable 的数据类型
3.  对于每次成功的转换，它都会进行比较，并返回该行。
4.  如果它命中列中的一个值，它不能转换，它会轰炸，返回它到目前为止找到的任何数据，并且不会继续通过表。

**任何人都可以澄清这个逻辑背后的原因是什么，以及 SQL Server 在决定比较/转换什么时是否给数据类型提供了任何特定的优先顺序**

笔记。我在 SQL 2005 中做了这个测试，但它在 SQL2K 中也是可复制的行为。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T19:02:57.063

数据类型优先级定义明确 - [http://msdn.microsoft.com/en-us/library/ms190309.aspx](http://msdn.microsoft.com/en-us/library/ms190309.aspx)

编辑 - 澄清一下，并不是 sql 总是将列类型转换为参数类型。它只是遵循我给出的链接中的类型优先级。如果类型优先级要求，这可能意味着参数将转换为列类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T19:04:51.597

我不明白问题是什么。为什么 SQL 服务器会知道 #1000 中的 #232 记录会爆炸？直到它达到那个记录。

同时，它会在生成结果时将结果流式传输回客户端。这是为了帮助提高性能。

你还能期待什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T19:45:17.133

就个人而言，我不会将参数转换为正确的类型，而是将其声明为该类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T19:03:30.180

你完美地描述了正在发生的事情，所以我不明白你想知道什么你还不知道？

修复查询很容易，只需要求 Sql Server 将参数转换为 varchar，而不是将 varchar 列转换为 bigint：

```
SELECT * FROM Phones WHERE Mobile = cast(@biMobile_1 as varchar(50)) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T19:08:12.587

你的逻辑过程描述确实是正确的。

SQL Server 隐式地将 Cast/Convert*函数*应用于移动列（在本例中是从 nvarchar 到 bigint 的隐式转换）。函数当然是*逐行*应用的，因此是您所看到的行为，因此在强制转换函数失败之前，select 语句不会爆炸。

可以通过将正在搜索的单个数字变量 (@biMobile_2) 转换为 nvarchar 来避免该问题，而不是隐式地为所有行转换 Mobile 列。

例如：

```
SELECT * FROM Phones WHERE Mobile = convert(nvarchar,@biMobile_2) 
```

希望这可以帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T19:19:13.670

问题是从 nvarchar 到 bigint 的隐式转换仅在 nvarchar 的内容包含非数字字符时才无效。数据库引擎不会执行一次查询，只是检查*将*返回的每个值以查看您提交的查询是否对每一行都有效，然后转身再次执行查询以返回结果。

开始执行查询并返回数据，直到找到证明无效的比较。

# python - 为 SyncML 协议寻找一个纯 Python 库

> ID：831162
> 
> 赞同：1
> 
> 时间：2009-05-06T18:59:32.797
> 
> 标签：python, syncml

[我正在寻找一个支持SyncML](http://en.wikipedia.org/wiki/SyncML)协议的开源纯 Python 库，至少足以实现 SyncML 客户端。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-22T19:00:00.070

有[https://sourceforge.net/projects/pysyncml/](https://sourceforge.net/projects/pysyncml/)：“pysyncml 库是 SyncML 适配器框架和协议的纯 Python 实现。” 还没试过。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-05T10:19:19.080

我不知道任何纯 Python 实现，但是 C 库有 python 绑定：

*   pysyncml（谷歌，只能发布1个链接）和
*   管道项目使用的基于[ctypes 的包装器。](http://github.com/Jc2k/conduit/blob/8beabdb62bccda57a9d49917ead305e611203a26/conduit/modules/SyncmlModule/pysyncml.py)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-31T22:25:58.760

我可以跨ERP5项目使用的syncml实现它用于与移动设备同步 [链接文本](http://www.erp5.org/HowToUseERP5SyncMLWithAMobilePhone)

# gwt - 如何在 GWT 1.6 中向复合面板添加事件处理程序

> ID：831168
> 
> 赞同：4
> 
> 时间：2009-05-06T19:01:22.510
> 
> 标签：gwt, handlers, event-handling

这可能是一件非常简单的事情，但我不知道如何实现以下内容。

```
package mods.client.resultSelector;

import com.google.gwt.event.dom.client.MouseDownEvent;
import com.google.gwt.event.dom.client.MouseDownHandler;
import com.google.gwt.user.client.ui.AbsolutePanel;
import com.google.gwt.user.client.ui.Composite;

public class MousyAbsolutePanel extends Composite implements MouseDownHandler {

    AbsolutePanel abs = new AbsolutePanel();

    public MousyAbsolutePanel(int width){
        System.out.println("MousyAbsolutePanel being created with width:" + width);
        initWidget(abs);
        abs.setWidth(String.valueOf(width));
        abs.setHeight("100%");
        abs.setStyleName("mousyAbsolutePanel");
    }

    public void onMouseDown(MouseDownEvent event) {
        System.out.println("onMouseDown()");
    }

} 
```

我想拥有一个可以接受鼠标事件的有效绝对面板。但是，在 Composite 对象中，我不知道如何将我编写的处理程序（onMouseDown() 事物）与 abs 变量联系起来。简而言之，我希望 abs AbsolutePanel 在被点击时做出响应，但 AbsolutePanels 并不自然接受点击事件。我该怎么做呢？

如果这是愚蠢的简单，请提前道歉，但我只是不太知道如何实现这种行为，而且我没有在我所做的搜索中看到它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-21T15:47:04.130

在这种情况下，扩展 Composite 可能不是最好的主意，除非您故意阻止对您在构造函数中创建的 AbsolutePanel 的访问。如果您扩展 AbsolutePanel，您将能够重用代码来添加/删除小部件等。

以下是我建议您这样做的方法：

```
package mods.client.resultSelector;

import com.google.gwt.event.dom.client.MouseDownEvent;
import com.google.gwt.event.dom.client.MouseDownHandler;
import com.google.gwt.event.dom.client.HasMouseDownHandlers;
import com.google.gwt.user.client.ui.AbsolutePanel;

public class MousyAbsolutePanel extends AbsolutePanel implements
                         MouseDownHandler,HasMouseDownHandlers {

    public MousyAbsolutePanel(int width) {
        System.out.println("MousyAbsolutePanel being created with width:" + width);

        this.setWidth(String.valueOf(width));
        this.setHeight("100%");
        this.setStyleName("mousyAbsolutePanel");

        this.addMouseDownHandler(this);
    }

    /** 
     * MouseDownHandler
     */
    public void onMouseDown(MouseDownEvent event) {
        System.out.println("onMouseDown()");
    }

    /**
     * HasMouseDownHandlers - Code to add handlers to the panel
     */  
    public HandlerRegistration addMouseDownHandler(MouseDownHandler handler) {
         return addDomHandler(handler, MouseDownEvent.getType());
    }

} 
```

然后，您可以像访问 AbsolutePanel 一样访问 MousyAbsolutePanel，但使用额外的事件处理程序、样式等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-05T12:25:09.617

这是另一篇可能有帮助的帖子：

[将 ClickHandler 添加到包含许多其他小部件的 div](https://stackoverflow.com/questions/4303320/adding-clickhandler-to-div-which-contains-many-other-widget)

调用`sinkEvents(Event.ONCLICK)`然后添加`ClickHandler`using 仅对`addHandler`我有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T15:22:59.920

学习如何/做什么的最好的办法是看一个例子。例如，FocusWidget 类（它实现了 HasClickHandlers）。

具体来说，查看 addClickHandler() 方法，并跟踪它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T19:05:02.333

一旦您调用`initWidget(Widget)`，`Composite`将正确代理事件注册。所以，你可以只调用`MousyAbsolutePanel`'s dedicated `addDomHandler(...)`。

# html - IE 6 中的 height 属性表现得很奇怪

> ID：831174
> 
> 赞同：0
> 
> 时间：2009-05-06T19:02:31.790
> 
> 标签：html, internet-explorer-6

简单的问题（我希望）

我有一个 div：

用CSS：

.break{position:relative;height:1px;background-color:#555555;margin:5px 10px 10px 10px;}

这个 div 在 IE 6 中显示为大约 10-20px 厚的线？？？...在任何其他浏览器中都可以正常工作

任何提示将不胜感激，..谢谢..

安德鲁

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T19:16:12.507

环境

```
overflow: hidden; 
```

to .break 应该可以解决问题。

IE 只是为内容保留了最小的空间（保留的空间等于为此元素设置的 line-height 或 font-size - 不记得确切）。在所有其他浏览器中，如果没有足够的空间，内容就会流出容器。IE 拉伸容器。因此，将溢出设置为隐藏可以解决问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T19:22:33.537

如果没有看到完整的 HTML 标记，很难确定，但这很可能是由于 IE 6 在 quirks 模式下渲染盒子模型 [1]。为了让 IE 6 使用标准模式，请确保您在 HTML 页面的开头明确声明了一个文档类型：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
 "http://www.w3.org/TR/html4/loose.dtd"> 
```

如果您使用的是 XML 文档类型，请确保您不是从 XML 声明开始的。如果在 doctype 标头之前有 XML 声明，IE 6 将退回到 quirks 模式。如果您使用的是 XML 文档类型，则您的标题应如下所示：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
```

不是这个：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
```

[1] [http://en.wikipedia.org/wiki/Quirks_mode](http://en.wikipedia.org/wiki/Quirks_mode)

# sql-server - sql server 2005 xml更新查询汉字

> ID：831175
> 
> 赞同：3
> 
> 时间：2009-05-06T19:02:43.910
> 
> 标签：sql-server, xml, sql-server-2005, cjk

我正在尝试用中文字符更新标签的值。但是它不添加中文字符。相反，它添加了“？？？” . 例如 update table set col.modify('replace value of (/tag/text())[1] with "我"') where .. 非常感谢任何帮助

谢谢本

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T19:05:47.040

对于像这样的国际字符，您通常希望使用 N'this is my data' 来表示它是 unicode/nchar。否则它被视为 char，我假设 db 排序规则不支持您提交的字符。试着做

```
select 'my chars' 
```

看看你是否仍然得到问号，我会假设是这样。

编辑 - 这是一个证实我的建议有效的例子：

```
declare @x xml
set @x = N'<tag>abc</tag>'
set @x.modify (N'replace value of (/tag/text())[1] with "我"') 
select @x 
```

我在选择xml时看到了该符号，并且我验证了该字符之前和之后是0x1162（证明数据是完整的）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T19:06:39.800

你在使用 unicode 字符串吗？那些以大写 N 开头，例如：

```
update yourtable 
set yourvalue = N'your chinese characters' 
where id = yourid 
```

# email - 每个收件人的“邮件 ID”电子邮件标题是否唯一？

> ID：831183
> 
> 赞同：48
> 
> 时间：2009-05-06T19:04:26.480
> 
> 标签：email, rfc5322

电子邮件的 Message ID 标头有多独特？如果我将电子邮件发送给两个人，那么两个人的消息 ID 是否相同？或者他们会有所不同？

（这是假设没有人在做任何有趣的事情。我知道对于垃圾邮件，所有规则都消失了......）

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-05-06T19:18:32.953

根据[RFC2822 - Internet Message Format](http://www.faqs.org/rfcs/rfc2822.html)，简短的回答是“每个消息***实例*****的****消息 ID*应该*是唯一***的”；但是，MESSAGE-ID 字段被认为是*可选*的，如何创建 MESSAGE-ID 字段取决于服务器。引用如下：*

 *> “Message-ID：”字段提供了一个唯一的消息标识符，它引用了特定消息的特定版本。消息标识符的唯一性由生成它的主机保证（见下文）。此消息标识符旨在为机器可读且不一定对人类有意义。消息标识符恰好与特定消息的一个实例有关；对消息的后续修订都会收到新的消息标识符。注意：消息“更改”的情况很多，但这些更改并不构成该消息的新实例，因此该消息不会获得新的消息标识符。例如，当消息被引入传输系统时，它们通常带有附加的标头字段，例如跟踪字段（在第 3.6.7 节中描述）和重新发送字段（在第 3.6.6 节中描述）。添加此类标头字段不会更改消息的身份，因此保留原始的“Message-ID：”字段。在所有情况下，决定“Message-ID:”字段是否改变的是消息的发送者希望传达的含义（即，这是同一条消息还是不同的消息），而不是任何特定的句法消息中出现（或不出现）的差异。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-05-06T20:05:50.110

通常，所有收件人都会收到完全相同的消息，包括正文和标头，但在途中添加的标头除外（例如：“已接收”标头）。Message-ID 标头由发件人生成，因此所有收件人都应该看到相同的 Message-ID。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-06T20:24:19.487

对于群发邮件，最好是每封邮件都是唯一的，邮件 ID 可能是您从垃圾邮件通知或退回邮件中获得的唯一信息，因此对于每封邮件它应该是唯一的。

# oracle - 如何在oracle中创建一个接受参数数组的存储过程

> ID：831188
> 
> 赞同：9
> 
> 时间：2009-05-06T19:05:26.183
> 
> 标签：oracle, arrays, stored-procedures

谁能告诉我是否可以在 oracle 中创建一个接受数组作为输入参数的存储过程以及如何创建？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-06T22:19:06.390

是的。Oracle 称它们为集合，您可以使用多种集合。

使用 VARRAY 的简单数组示例。

```
 DECLARE
  TYPE Str_Array IS VARRAY(4) OF VARCHAR2(50);
  v_array  Str_Array;

  PROCEDURE PROCESS_ARRAY(v_str_array  Str_Array)
  AS
  BEGIN
    FOR i IN v_str_array.first .. v_str_array.last LOOP
      DBMS_OUTPUT.PUT_LINE('Hello '||v_str_array(i));
    END LOOP;
  END;

BEGIN

  v_array := Str_Array('John','Paul','Ringo','George');

  PROCESS_ARRAY(v_array);

  -- can also pass unbound Str_Array
  PROCESS_ARRAY(Str_Array('John','Paul','Ringo','George'));

END; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T21:51:53.223

如果我没记错的话，有一个名为 TABLE 的原生类型，它基本上是一个数组。但我上次使用它是 2001 年，所以也许现在有最强大的类型。

检查这个[http://www.developer.com/db/article.php/3379271](http://www.developer.com/db/article.php/3379271)

# css - CSS Sprites 浏览器渲染

> ID：831189
> 
> 赞同：12
> 
> 时间：2009-05-06T19:05:29.410
> 
> 标签：css, browser, sprite, css-sprites

我们都知道 CSS sprite 图片可以很好地减少请求量等，但是浏览器使用大图片作为背景渲染包含多个元素的页面的性能如何呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-22T10:38:06.393

在配备较旧浏览器（如 IE6/IE7）的较慢机器上，当您在一个页面上多次使用非常大的图像时，您会注意到性能显着下降。当您将精灵用于 :hover 状态时，情况会更加严重。

您必须控制将所有 sprite 推送到一张巨大图像的诱惑 - 考虑哪些元素是网站/webapp UI 的一部分并将它们放入一个 sprite 文件（这些将在浏览时一直显示）。然后尝试将其余的精灵分组到特定于网站部分的图像中，并根据需要使用它们。缺点是加载时间稍微延长（额外的 HTTP 请求），但查看/滚动页面时的用户体验会更高。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T19:11:40.317

你需要平衡事情。如果您正在谈论包含 1000 个精灵的图像，那么 CSS 将是巨大的。此外，无论如何您都极有可能在同一页面中使用所有这些精灵。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:08:27.593

我们可以从 YouTube 的经验判断，这没有什么大问题。

希望浏览器将图像缓存在内存中，然后在需要该图像的任何地方使用它来渲染输出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T19:11:45.043

通过将图像合并为一个或多个复合精灵并使用 CSS 有选择地在网页中显示部分精灵，您可以节省大量 HTTP 请求。现在主流浏览器已经发展到足以支持 CSS 背景和定位，更多的网站正在采用这种性能技术。事实上，Web 上一些最繁忙的站点使用 CSS sprites 来保存 HTTP 请求。

拥有数百万用户的 Yahoo! AOL 竭尽所能改善用户体验。AOL.com 和 Yahoo.com 都使用 CSS sprite 为其复杂的界面保存大量 HTTP 请求。这两个站点都使用 CSS sprite 在其服务目录中选择性地显示图标，而 Yahoo! 在其他地方也使用精灵。

CSS sprites 的另一个好处是组合图像的文件大小通常比单个图像小，尽管在图像之间添加了空白。较小尺寸的精灵是由于减少了多个颜色表的开销和单独图像所需的格式信息。为了最大限度地提高可访问性和可用性，CSS sprite 最适合用于图标或装饰效果。

# sql-server-2008 - 针对 SQL Server 2008 从 ADO 访问 XML 流

> ID：831199
> 
> 赞同：1
> 
> 时间：2009-05-06T19:07:29.157
> 
> 标签：sql-server-2008, asp-classic, msxml, sqlxml

我们正在迁移使用 ADO 连接到 SQL Server 2000 的 ASP 代码。在大多数情况下，代码在定义连接后顺利迁移到 SQL Server 2008，但是一种类型的查询引发了令我困惑的错误。

针对 SQL 2000，我们将使用如下代码：

```
set oCommand = Server.CreateObject("ADODB.Command")
oCommand.ActiveConnection = oConn 'already established
oCommand.CommandType = adCmdText 

'This is simplified over the real code, but the wrapper is what we use.
oCommand.CommandText = "<Root xmlns:sql='urn:schemas-microsoft-com:xml-sql'><sql:query>" 
+ Server.HTMLEncode(sql) 
+ "</sql:query></Root>" 

oCommand.Dialect = "{5D531CB2-E6ED-11D2-B252-00C04F681B71}" 'SQL Dialect GUID
oCommand.Properties("Output Stream").Value = oXMLDoc 'Already created
oCommand.Execute , , adExecuteStream 'The point of error 
```

SQL 是一个存储过程调用，在正常调用时工作。此代码继续针对 SQL 2000 工作，但针对 SQL 2008 它返回：

> ERR_OPENSQLXML XMLDB.openSQLXML 失败。错误“-2147217898”：“此提供程序不支持命令方言。”

我的第一个猜测是 SQL 2008 依赖于 MSXML 版本 6，我需要一个新的 guid。我的 MSDN 和 Google-Fu 让我失望了：我找到的所有结果都使用这个 GUID。

有新的 GUID 吗？有没有更好的办法？这是否比在 ASP.NET 中重新编码（许多页面的命运已经）更省事了。

编辑：我想知道使用 SQLNCLI10 客户端是否会阻止它工作？

```
configConnString = 
"Provider=SQLNCLI10;DataTypeCompatibility=80;Server=XYZZY;Database=ucpm;MARS Connection=True;Trusted_Connection=Yes;" 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T19:39:47.287

而不是专注于我没有看到记录为已更改的语言 - 从我上次检查的下一个版本的 Windows Server 中仍然支持 ASP.dll。

您能否检查您要连接的客户端是否安装了 MSSQL Native Client 10 而不是旧的 sql 2000 odbc/oledb 客户端。

# .net - 数据绑定和回发

> ID：831208
> 
> 赞同：6
> 
> 时间：2009-05-06T19:09:33.723
> 
> 标签：.net, data-binding, objectdatasource

这是 DataBind 如何工作的一般问题......

我有一个带有 GridView 的简单页面（在 aspx 代码中）绑定到 ObjectDataSource。

我可以查看由 ObjectDataSource 调用的 Select() 函数，以查看它在初始加载和每次回发时被调用。我有一些逻辑会在回发时发生，这会影响 GridView 的数据，我想稍后在回发中调用 GridView.DataBind()，在我进行了一些更改之后。

有没有办法防止每次回帖时发生的自动重新绑定？这是否意味着我不能为此控件使用 ObjectDataSource？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-06T19:17:06.107

您是正确的，因为您正在寻找的细粒度控制是不可能的，并且需要后面的代码。ASP.NET 的数据源对象不过是个痛点。你会发现，当你使用它们时，你会一次又一次地遇到这样的情况。

您会发现的一些问题是：

*   非强类型
*   不灵活（正如您所指出的）
*   混淆演示代码

我已经开始在后面的代码中进行所有数据访问，并且没有回头。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-06-10T14:48:43.347

我也与这种自动绑定进行了斗争，并认为我在这里发布了我的解决方案：

1.  从 ASPX 页面中删除“DataSourceID”，当它没有设置时，没有自动绑定
2.  仅在需要 DataBinding 时在 CodeBehind 中设置 DataSourceID：myGridView.DataSourceID = "MyDataSource";
3.  不要显式调用 myGridView.DataBind()，数据绑定会在 PreRender 自动发生

我花了一段时间才弄清楚这一点，但现在一切正常。

**语境**

我使用 ObjectDatasource，因为它会自动为我处理 Gridview 的所有**分页**和**排序**。我正在使用带有 Linq2SQL 的数据层，并使用它的 Skip() 和 Take() 方法仅加载填充一页 GridView 所需的数据量。

使用ObjectDataSource的**SelectMethod**和**SelectCountMethod**

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T19:15:36.407

是的。如果您想在数据绑定发生时进行这种控制，您需要在后面的代码中进行。

# gridview - Gridview 排序和更新面板

> ID：831214
> 
> 赞同：0
> 
> 时间：2009-05-06T19:11:13.970
> 
> 标签：gridview, updatepanel

我正在尝试将更新面板与 gridview 一起使用，但在对 gridview 进行排序时遇到了一些困难。我试图在这个[线程中关注@dfowler](https://stackoverflow.com/questions/213148/sort-columns-of-gridview-in-asp-net-c)

但是当我尝试排序时，在尝试对排序列表进行数据绑定时出现此错误：“数据源不支持服务器端数据分页。”

有人知道我做错了什么吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-25T01:43:32.113

当我使用 IEnumerable(Of SomeClass) 作为我的数据源时，我遇到了“数据源不支持服务器端数据分页”，因为我使用了“收益返回记录；” 构建这个 - 没有通常的 List(Of SomeClass) 作为基础对象。Linq 查询可能会导致相同的行为，如果是这种情况，请尝试 ToList()。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T19:30:27.963

我发现了错误。当我第一次将数据绑定到 gridview 时，我使用了一个列表，但是当我尝试重新绑定时，我使用了 IQueryable，所以一个简单的 .ToList() 工作:)

# python - 如何在 Python 中创建一个持久的 com 服务器

> ID：831217
> 
> 赞同：1
> 
> 时间：2009-05-06T19:11:41.533
> 
> 标签：python, com

我想创建一个可以在调用中保持状态的 COM 服务器。我的目标是拥有一个线程安全的内存数据库。并通过 COM 接口提供对它的访问。

那可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T20:59:03.720

[http://www.devshed.com/c/a/Python/Windows-Programming-in-Python-Creating-COM-Servers/](http://www.devshed.com/c/a/Python/Windows-Programming-in-Python-Creating-COM-Servers/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-09-11T12:42:26.573

鉴于 COM 不受欢迎，我最终提供了 XMLRPC 接口，至少我知道如果发生错误如何诊断错误。

# ajax - 回调窗格更新 DOM 后 IE 不更新显示

> ID：831223
> 
> 赞同：1
> 
> 时间：2009-05-06T19:12:14.857
> 
> 标签：ajax, internet-explorer, dom, updatepanel, callback

我在使用 .Net 3.5 的 ascx 页面中有一个更新面板。

用户输入数据，发起回调，ajax 更新 DOM。

通常一切都是笨拙的多莉。有时 DOM 会更新，IE 不会费心刷新显示。整个更新区域似乎是空白的。

一旦用户做了一些会触发刷新的事情，比如调整窗口大小，数据就会立即出现在屏幕上，但直到那时才会出现。

为什么是这样？什么可能导致它？如何修复？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-21T15:33:17.980

您可以通过切换到真正的浏览器来“修复”它:)

真的，您*也许*可以根据我[在此页面中](http://forums.asp.net/t/1419880.aspx)找到的技巧来修复它。

基本上，您需要做的是创建一个空节点并**在使用新内容更新 DOM 后在**本地将其删除：

```
var t = document.createTextNode('temp text');
element.appendChild(t); // Not sure if this is any element
                        // or one inside your new DOM nodes.
setTimeout(function() { t.parentNode.removeChild(t); }, 0); 
```

在该页面中，作者说：

> 即使使用我的“修复”，它也只有在用户将鼠标光标移出窗口并重新移入时才有效。

但我想这已经很好了......我认为 IE 可能不会触发刷新，除非浏览器窗口上有一些活动，以节省处理时间。

很长一段时间以来，这一直是 IE 中一个非常令人讨厌的错误，尽管我无法在任何地方找到它。事实上，即使是 Opera 也时不时出现这种错误。

此外，即使您使用该技巧解决了问题，也要检查每一段 HTML 是否有效。您可以在[http://validator.w3.org](http://validator.w3.org)中查看。如果某些代码是无效的，那么你不能责怪浏览器不理解你的意思。

# c# - C# WebBrowser.Navigate 问题

> ID：831234
> 
> 赞同：1
> 
> 时间：2009-05-06T19:14:49.140
> 
> 标签：c#, .net, webbrowser-control, directory

我有一个 XML 文件存储在我的应用程序 (BIN\DEBUG\File.xml) 的 BIN 文件夹内的 DEBUG 文件夹中

当我调用 WebBrowser1.Navigate("File.xml");

它不会使用文件的显示来更新视图。我知道这与由于文件夹位置不正确而找不到文件有关。必须从此文件夹位置访问该文件。

帮助表示赞赏

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T19:20:52.620

您是否将 WebBrowser1.AllowNavigation 设置为 true？你有没有尝试过：

```
WebBrowser1.Navigate(Path.Combine(Application.StartupPath, "File.xml")); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-23T19:54:51.593

```
webBrowser1.Navigate(Environment.CurrentDirectory + @"\File.xml"); 
```

这是我使用的，如果目录没有改变，当然。:)

# java - 从 UTF-8 文本文件中读取数据并标记化

> ID：831240
> 
> 赞同：2
> 
> 时间：2009-05-06T19:16:14.737
> 
> 标签：java, encoding, file-io

我正在尝试从文本文件中读取 UTF-8 并进行一些标记化，但我遇到了编码问题：

```
try {
    fis = new FileInputStream(fName);
} catch (FileNotFoundException ex) {
    //...
}

DataInputStream myInput = new DataInputStream(fis);
    try {
        while (thisLine = myInput.readLine()) != null) {
            StringTokenizer st = new StringTokenizer(thisLine, ";");
            while (st.hasMoreElements()) {
            // do something with st.nextToken();
    }
}
} catch (Exception e) {
//...
} 
```

并且 DataInputStream 没有任何参数来设置编码！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T19:27:21.043

让我引用这个方法的 Javadoc。

数据输入流.readLine()

> 已弃用。此方法不能正确地将字节转换为字符。从 JDK 1.1 开始，读取文本行的首选方法是通过 BufferedReader.readLine() 方法。使用 DataInputStream 类读取行的程序可以通过替换形式的代码转换为使用 BufferedReader 类：

```
 DataInputStream d = new DataInputStream(in); 
```

和：

```
 BufferedReader d
          = new BufferedReader(new InputStreamReader(in)); 
```

顺便说一句：JDK 1.1 于 1997 年 2 月问世，所以这对您来说应该不陌生。

试想一下，如果您阅读了 Javadoc，每个人都会节省多少时间。;)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T19:20:45.257

您可以使用 InputStreamReader：

```
BufferedReader br = new BufferedReader (new InputStreamReader (source, charset);
while (br.readLine () != null) { ... } 
```

您也可以尝试扫描仪，但我不确定它是否能正常工作

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T19:20:41.670

为什么不使用[InputStreamReader](http://java.sun.com/j2se/1.4.2/docs/api/java/io/InputStreamReader.html)并指定编码？然后，您可以使用[BufferedReader](http://java.sun.com/j2se/1.4.2/docs/api/java/io/BufferedReader.html)进行包装以提供 readLine() 功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T19:28:54.347

当您阅读文本（不是二进制数据）时，您应该使用 Reader（而不是 InputStream）。您可以通过执行 -Dfile.encoding=utf-8 来指定 vm 的编码。阅读器将自动使用此编码。因此，您甚至可以轻松切换编码。您可以在 FileReader 上使用 BufferedReader 来获得 readLine()。readLine() 方法仅在读取文本时才有意义，否则行尾只是字节

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T19:45:27.303

一种非常简单的方法：

```
File myFile = ...

String contents = Files.toString(myFile, Charsets.UTF_8);
for (String token : contents.split(";")) {
    // do something with token
} 
```

来自[番石榴](http://commons.apache.org/io/)的地点[`Files`](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/io/Files.html)和地点。或者，如果您需要逐行处理文件，请改为：[`Charsets`](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/base/Charsets.html)

```
List<String> lines = Files.readLines(myFile, Charsets.UTF_8); 
```

另请注意，[`split()`](http://docs.oracle.com/javase/7/docs/api/java/lang/String.html#split%28java.lang.String%29)这里使用起来比`StringTokenizer`.

正如我喜欢说的那样，*[了解和使用库。](https://stackoverflow.com/questions/822768/what-are-the-pitfalls-of-a-java-noob/826344#826344)*（当然，一次读取整个文件可能并不适合所有情况。）

**编辑**（2013 年）：将我的推荐从 Apache Commons IO 切换到 Guava，这是一个整体更清洁且维护更积极的库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T19:59:25.430

StringTokenizer 是一个非常简单的文本标记类，我只能将它推荐给不需要进一步识别标记（即使用字典查找）并且仅用于西方语言的任务。

对于有关西方语言的更高级案例，可以基于 unicode 字符类编写一个简单的标记器（这将选择多种空格、分隔字符等），然后使用正则表达式进行扩展以捕获特殊情况（如 'that's'、' C++'...）。

# asp.net - ASP.NET 网站管理工具安全选项卡显示错误 1802

> ID：831241
> 
> 赞同：0
> 
> 时间：2009-05-06T19:16:26.513
> 
> 标签：asp.net, asp.net-membership, access-denied

我正在关注这个演练： http: [//msdn.microsoft.com/en-us/library/879kf95c (VS.80).aspx](http://msdn.microsoft.com/en-us/library/879kf95c(VS.80).aspx)

在运行 vista Ultimate 的机器上，我安装了：

*   IIS
*   SQL Server 速成版 2005
*   视觉工作室 2005

我创建了一个新网站，我可以通过[http://127.0.0.1](http://127.0.0.1)访问它， 但我想学习创建登录并拥有用户会员资格。

当我进入教程步骤时：

> 创建会员用户
> 
> 1.  在网站菜单上，单击 ASP.NET 配置。
> 2.  选择安全选项卡，...

我收到此错误：

> 您选择的数据存储存在问题。这可能是由无效的服务器名称或凭据或权限不足引起的。这也可能是由于未启用角色管理器功能造成的。单击下面的按钮可重定向到您可以选择新数据存储的页面。
> 
> 以下消息可能有助于诊断问题：执行 SQL 文件“InstallCommon.sql”期间发生错误。SQL 错误号为 1802，SqlException 消息为：CREATE DATABASE failed。无法创建列出的某些文件名。检查相关错误。CREATE FILE 在尝试打开或创建物理文件“C:\INETPUB\WWWROOT\MEMBERSHIP\APP_DATA\ASPNETDB_TMP.MDF”时遇到操作系统错误 5（拒绝访问。）。创建 ASPNETDB_9b571c52c35b447ab7947888fa99b6b8 数据库...

为什么？我正在以管理员身份运行 Visual Studio。（右键单击“以管理员身份运行”选项）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T21:20:37.310

好的，这是修复它的方法：

1)

*   转到控制面板->程序和功能->打开或关闭Windows功能。

*   在这里检查“Windows身份验证”：

[![屏幕截图](https://i.stack.imgur.com/Seaca.png)](https://i.stack.imgur.com/Seaca.png)

2)

*   我去了控制面板->管理工具-> Internet信息服务（IIS）管理器

*   在左侧的树中选择了我的 webapp。

*   IIS下选择“身份验证”

*   启用“Windows 身份验证”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T19:26:53.633

也许 c:\inetpub\wwwroot\membership\app_data\ 是只读的

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-06T11:11:56.287

这个答案和其他研究帮助我完成了这项工作。我在这里详细总结了这些步骤[http://www.yart.com.au/Resources/Programming/ASP-NET-Security-Doesnt-Work.aspx](http://www.yart.com.au/Resources/Programming/ASP-NET-Security-Doesnt-Work.aspx)

# accessibility - 第 508 节和/或 WCAG 合规在您的网站中有多重要？您的网站合规吗？

> ID：831243
> 
> 赞同：0
> 
> 时间：2009-05-06T19:16:46.297
> 
> 标签：accessibility, section508, wcag

在开发网站时遵守各种可访问性指南有多重要，尤其是在您不知道谁将使用您的网站的情况下？

使用[HiSoftware Cynthia Says Portal](http://www.contentquality.com/)，我实际上检查了 StackOverflow 并发现只有少数警告符合第 508 节，所以我认为残疾人更容易使用 Stack Overflow（尽管我没有检查其他任何东西主页）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T19:21:27.907

我不了解商业部门，但政府部门需要。通常，任何软件项目都必须经过审查，以确保产品在发布之前符合 508 标准。

此外，当我进行软件演示时，观众的第一个问题几乎总是“您的产品是否符合 508 标准？”

因此，如果您计划与政府开展业务，请确保您的软件是合规的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-11T11:36:58.977

为可访问性而设计的网站通常具有更好的可用性和搜索引擎的喜爱。

# asp.net - 将值从其他控件发送到 .aspx 页面中的用户控件属性

> ID：831246
> 
> 赞同：1
> 
> 时间：2009-05-06T19:17:18.837
> 
> 标签：asp.net, user-controls, query-string

有没有办法使用标签本身中的属性而不是来自后面的代码将来自其他控件的值（例如“下拉列表的选定值”、“来自查询字符串的值”）传递给用户控件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T19:19:57.363

是的，你可以，你只需要`<% %>`在演示代码中使用。您的代码将如下所示：

```
<asp:DropDownList id="ddlFoo" runat="server">
    ...
</asp:DropDownList>
<asp:TextBox id="txtBar" runat="server" Text='<%# ddlFoo.SelectedValue %>' />

<%-- For query string --%>
<asp:TextBox id="txtBar" runat="server" 
    Text='<%# Request.QueryString["Key_Value"] %>' /> 
```

在 ASP.Net 中的 SO 帖子[，<%= 和 <%# 之间的区别是什么，](https://stackoverflow.com/questions/517721/in-asp-net-what-is-the-difference-between-and-closed)很好地列出了您可以使用的不同绑定机制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T19:23:15.000

是的。例如

```
 <uc1:CompetitionClassification ID="CompetitionClassification" runat="server" OnlyTopFive="True" /> 
```

在这种情况下，参数 OnylTopFive 在我的自定义控件的标记中传递。

然后在我控制的服务器端，我有：

```
private bool onlyTopFive;
  public bool OnlyTopFive
    {
        get
        {
            return this.onlyTopFive;
        }
        set
        {
            this.onlyTopFive = value;
        }
    } 
```

# unit-testing - 使用 Visual Studio 测试套件/NUnit 自动化集成测试 MSMQ 的最佳方法是什么？

> ID：831247
> 
> 赞同：4
> 
> 时间：2009-05-06T19:17:50.567
> 
> 标签：unit-testing, tdd, nunit, msmq, integration-testing

我想为我正在编写的 MSMQ 应用程序创建一系列自动化单元测试。在我看来，挑战在于如何适应测试方法中的事件处理程序。也就是说，我从测试方法发送了一条消息，并且需要将结果返回给该测试方法，表明该消息已被接收并处理。我不知道如何做到这一点，任何方向都将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T18:29:18.820

您是否正在寻找一种编写单元测试的方法，其中被测系统认为它正在从队列接收事件，但您不想在测试期间使用真正的队列？

查看[犀牛模拟](http://ayende.com/projects/rhino-mocks.aspx)。它允许您创建队列接口的模拟版本，然后在测试期间从中引发事件。一些用于测试 Requester.DoSomething() 方法的伪代码可能如下所示：

```
// SETUP
MockRepository mocks = new MockRepository();
IQueue mockQueue = mocks.StrictMock<IQueue>();

queue.Received+=null;//create an expectation that someone will subscribe to this event
LastCall.IgnoreArguments();// we don't care who is subscribing
IEventRaiser raiseReceivedEvent = LastCall.GetEventRaiser();//get event raiser for the last event, in this case, Received
Expect.Call(mockQueue.Send).Return(msgId);
mocks.ReplayAll();

// EXEC
Requester req = new Requester(mockQueue);

// We expect this method to send a request to the mock queue object.
req.DoSomething();
// Now we raise an event from the mock queue object.
raiseReceivedEvent.Raise(eventArgs);

// VERIFY
// we would probably also check some state in the Requester object
mocks.VerifyAll(); 
```

查看[Rhino mocks wiki](http://ayende.com/wiki/Rhino+Mocks+IEventRaiser.ashx)了解所有细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T19:42:28.823

通常，单元测试应该隔离被测试的方法。我不熟悉 MSMQ，但您通常会创建一个模拟对象并将其传递给您的生产方法。然后您可以感知该方法对模拟对象所做的操作，以验证其行为是否正确并发送预期的响应。生产方法不会知道区别。单元测试更多是为了确保您的方法在隔离时按预期运行。

听起来就像您要寻找的是集成测试。您仍然可以使用单元测试框架来完成此任务，但我不会将它们包含在自动构建中。我会将它们移到专用的测试机器上。单元测试通常会停止构建，因为它们指示行为不符合预期的类或方法。集成测试表明，方法或类没有按预期相互交互。

# c# - 在 C# 中解析文本文件并跳过一些内容

> ID：831248
> 
> 赞同：1
> 
> 时间：2009-05-06T19:17:51.130
> 
> 标签：c#, .net, file-io, text-parsing

我正在尝试解析具有标题和正文的文本文件。在该文件的标题中，有对正文部分的行号引用。例如：

```
SECTION_A 256
SECTION_B 344
SECTION_C 556 
```

这意味着 SECTION_A 从第 256 行开始。

将这个标题解析成字典然后在必要时阅读这些部分的最佳方法是什么。

典型的场景是：

1.  解析标题和只读部分 SECTION_B
2.  解析标题并阅读每个部分的第一段。

数据文件很大，我绝对不想全部加载到内存中再操作。

我会很感激你的建议。我的环境是 VS 2008 和 C# 3.5 SP1。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T19:54:57.373

你可以很容易地做到这一点。

问题分为三个部分。

1）如何找到文件中一行的开始位置。做到这一点的唯一方法是从文件中读取行，保留一个记录该行在文件中的开始位置的列表。例如

```
列表 lineMap = new List();
lineMap.Add(0); // 第 0 行从数据文件中的位置 0 开始（只是一个虚拟条目）
lineMap.Add(0); // 第 1 行从数据文件中的位置 0 开始

使用 (StreamReader sr = new StreamReader("DataFile.txt"))
{
    字符串线；
    int lineNumber = 1;
    而 ((line = sr.ReadLine()) != null)
        lineMap.Add(sr.BaseStream.Position);
}

```

2）读取索引文件并将其解析为字典。

```
字典索引 = new Dictionary();

使用 (StreamReader sr = new StreamReader("IndexFile.txt"))
{
    字符串线；
    而 ((line = sr.ReadLine()) != null)
    {
        string[] 部分 = line.Split(' '); // 将行分成名称和行号
        index.Add(parts[0], Convert.ToInt32(parts[1]));
    }
}

```

然后要在文件中查找一行，请使用：

```
int lineNumber = index["SECTION_B";]; // 将节名转换为行号
长 offsetInDataFile = lineMap[lineNumber]; // 将行号转换为文件偏移量

```

然后在 DataFile.txt 上打开一个新的 FileStream，Seek(offsetInDataFile, SeekOrigin.Begin) 移动到行的开头，并使用 StreamReader（如上）从中读取行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T19:22:35.767

好吧，显然您可以将名称 + 行号存储到字典中，但这对您没有任何好处。

好吧，当然，它会让您知道从哪一行开始读取，但问题是，该行在文件中的什么位置？唯一知道的方法是从头开始并开始计数。

最好的方法是编写一个包装器来解码文本内容（如果你有编码问题）并且可以给你一个行号到字节位置类型的映射，那么你可以取那个行号 256，然后在字典中查找要知道第 256 行从文件中的位置 10000 开始，然后从那里开始读取。

这是一次性处理的情况吗？如果没有，您是否考虑将整个文件填充到本地数据库中，例如 SQLite 数据库？这将允许您在行号与其内容之间进行直接映射。当然，该文件会比您的原始文件更大，并且您需要将数据从文本文件复制到数据库，因此无论哪种方式都有一些开销。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:36:40.320

假设您知道标题的位置，请阅读文件直到标题的末尾。拆分您存储在空格中的字符串，如下所示：

```
Dictionary<string, int> sectionIndex = new Dictionary<string, int>();
List<string> headers = new List<string>(); // fill these with readline

foreach(string header in headers) {
    var s = header.Split(new[]{' '});
    sectionIndex.Add(s[0], Int32.Parse(s[1]));
} 
```

找到您想要的字典条目，计算文件中读取的行数，然后循环直到您到达该行号，然后阅读直到您到达下一节的起始行。我不知道您是否可以保证字典中键的顺序，因此您可能需要当前和下一个部分的名称。

请务必进行一些错误检查，以确保您正在阅读的部分不在您正在阅读的部分之前，以及您能想到的任何其他错误情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T19:27:32.417

只需一次读取一行文件并忽略数据，直到找到所需的数据。您不会有任何内存问题，但性能可能不会很好。不过，您可以在后台线程中轻松完成此操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T19:50:06.730

您可以逐行阅读，直到所有标题信息都被捕获并停止（假设所有部分指针都在标题中）。您将获得用于稍后检索数据的部分和行号。

```
string dataRow = "";

try
{
    TextReader tr = new StreamReader("filename.txt");

    while (true)
    {
        dataRow = tr.ReadLine();
        if (dataRow.Substring(1, 8) != "SECTION_")
            break;
        else
            //Parse line for section code and line number and log values
            continue;
    }
    tr.Close();
}
catch (Exception ex)
{
    MessageBox.Show(ex.Message);
} 
```

# dependency-injection - What's the best way to handle circular dependencies amongst objects?

> ID：831259
> 
> 赞同：6
> 
> 时间：2009-05-06T19:19:30.500
> 
> 标签：dependency-injection, dependencies

In my code, I have the the following objects:

*   ErrorManager - controls how errors are logged in the application
*   ConfigManager - controls how the configuration information is obtained

On the project I'm working on, the ErrorManager needs to pull configuration information using the ConfigManager instance while the ConfigManager uses the ErrorManager incase an error occurs.

At the moment, I'm doing the following in code:

```
ErrorManager _errorManager = new CustomErrorManager();
ConfigManager _configManager = new CustomConfigManager(_errorManager);
_errorManager.SetConfigurationManager(_configManager); 
```

Is there a way for me to clean up this circular reference of dependencies?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T19:47:49.637

I would create the following:

```
ErrorConfig _errorConfig = ...; 
// ErrorConfig is a new config object containing only ErrorManager Configuration
ErrorManager _errorManager = new CustomErrorManager(_errorConfig);
ConfigManager _configManager = new CustomConfigManager(_errorManager); 
```

Now, the `ConfigManager` can can use the ready-to-run ErrorManager without a bootstrapping problem where the `ErrorManager` is not ready to handle errors.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T19:22:21.087

Circular references are usually best cleaned up by refactoring a third class that both depend on. For instance, you might have something like this:

```
BootstrapConfigManager _bcm = new BootstrapConfigManager();
ErrorManager _errorManager = new CustomErrorManager(_bcm);
ConfigManager _configManager = new CustomConfigManager(_bcm, _errorManager); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:23:29.650

Refactor your code. You can probably break up the classes to isolate a portion that you can initialize first and pass on to both the classes.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T19:28:12.133

I would create a extension methods for each called AddRelationship, passing in the other object as the parameter.

The object passed would add the relationship and then call the AddRelationship method of the other:

```
static void AddRelationship(this ConfigManager configMgr, ErrorManager errMgr)
{
    this.ErrorManager = errMgr;
    if (this != errMgr.ConfigManager)
        errMgr.AddRelationship(this);
}

static void AddRelationship(this ErrorManager errMgr, ConfigManager configMgr)
{
    this.ConfigManager = configMgr;
    if (this != configManager.errMgr)
        configMgr.AddRelationship(this);
} 
```

This means that you can add the relationship using either object.

```
ConfigManager cfg = new ConfigManager();
ErrorManager err = new ErrorManager();
//Assign using either:
err.AddRelationship(cfg);
//Or
cfg.AddRelationship(err); 
```

You should also create RemoveRelationship extensions.

```
static void RemoveRelationship(this ConfigManager configMgr, ErrorManager errMgr)
{
    if (this.errorManager == errMgr)
    {
        this.errorManager = null;
        if (errManager.configManager == this) 
            errMgr.RemoveRelationship(this);
    }
}

static void RemoveRelationship(this ErrorManager errMgr, ConfigManager cfgMgr)
{
    if (this.ConfigManager == cfgMgr)
    {
        this.configManager = null;
        if (cfgMgr.errorManager == this)
            cfgMgr.RemoveRelationship(this);
    }
} 
```

I don't know that circular references are a *particularly* good coding practice, but this should solve the question as asked.

# c# - 具有枚举键类型的 KeyedCollection 不会按 int 索引

> ID：831260
> 
> 赞同：4
> 
> 时间：2009-05-06T19:19:30.907
> 
> 标签：c#, .net

我有课

```
public class FooKeyedCollection : KeyedCollection<FooType,Foo>
{
}

public enum FooType
{
   FooType1,
   FooType2,
   FooType3
}

public Foo
{
   public FooType Type { get; set; }
   public string Value { get; set; }
} 
```

当我将项目添加到我的 FooKeyedCollection 时，我可以通过 FooType 对它们进行索引，但是当我尝试将它们索引为 int 时，int 被解释为 FooType 枚举。结果，它导致了一个令人困惑的错误，即

```
public static void main()
{
   FooKeyedCollection fkc = new FooKeyedCollection();

   Foo myFoo = new Foo();
   myFoo.Type = FooType.FooType3;
   myFoo.Value = "someValue";

   foo.Add( myFoo );

   Foo myFooByType = foo[FooType.FooType3];
   Foo myFooByIndex = foo[0]; // <-- exception thrown here
} 
```

尝试按整数索引检索项目时，执行此代码的结果是异常。我希望将 FooKeyedCollection 公开为公共 API 的一部分，并且我想保护此 API 的使用者免受此错误的影响。有什么方法可以修改 FooKeyedCollection 类以获得正确的行为？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T19:22:34.020

您可以考虑在此处使用“new”关键字：

```
public new Foo this[int index]
{
   get
   {
      IList<Foo> self = this;
      return self[index];
   }
   set
   {
       (IList<Foo>)[index] = value;
   }
} 
```

这将允许您按整数值进行索引。显式使用枚举将回退到 KeyedCollection 实现。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T19:28:34.583

这是一种有用的扩展方法，可以避免两个索引器重叠的这些情况——如果键是：它也有帮助`int`：

```
static class CollectionUtils
{
    public static TValue GetByIndex<TKey,TValue>
        (this KeyedCollection<TKey, TValue> collection, int index)
    {
        return collection[index];
    }
} 
```

然后打电话`fkc.GetByIndex(0)`，它会正常工作。在泛型方法内部，它*只能*解析`index`为`int`索引器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T19:24:31.737

问题是 0 可以隐式转换为`FooType`. 如果您使用任何其他号码，那就没问题了。如果您使用此代码，它也应该可以工作：

```
int index = 0;
Foo myFooByIndex = foo[index]; 
```

编辑：不幸的是，强制转换在这里没有帮助 - 编译器仍然将它识别为常量 0。

# c++ - 我需要一个不会弄乱我打开的窗口的消息泵

> ID：831265
> 
> 赞同：0
> 
> 时间：2009-05-06T19:20:50.950
> 
> 标签：c++, windows, multithreading, mfc, messages

我的应用程序（我正在处理的安装程序的引导应用程序需要启动一些其他应用程序（我的安装程序和第三方安装程序，用于我的安装程序的先决条件）并等待它们完成。为了允许 GUI 进行屏幕更新在等待应用程序完成时，我使用 Visual Studio 文档中关于空闲循环处理的“MFC 兼容”示例作为指导，在等待循环中放置了一个消息泵。我的代码（位于 CWinApp 的成员函数中-派生类）如下：

```
if (::CreateProcess(lpAppName, szCmdLineBuffer, NULL, NULL, TRUE, 0, NULL, NULL,
                    &StartupInfo, &ProcessInfo))
{
  ::GetExitCodeProcess(ProcessInfo.hProcess, &dwExitCode);
  if (bWait)
    while (dwExitCode == STILL_ACTIVE)
    {
      // In order to allow updates of the GUI to happen while we're waiting for
      // the application to finish, we must run a mini message pump here to
      // allow messages to go through and get processed.  This message pump
      // performs much like MFC's main message pump found in CWinThread::Run().
      MSG msg;
      while (::PeekMessage(&msg, NULL, 0, 0, PM_NOREMOVE))
      {
        if (!PumpMessage())
        {
          // a termination message (e.g. WM_DESTROY)
          // was processed, so we need to stop waiting
          dwExitCode = ERROR_CANT_WAIT;
          ::PostQuitMessage(0);
          break;
        }
      }

      // let MFC do its idle processing
      LONG nIdle = 0;
      while (OnIdle(nIdle++))
        ;

      if (dwExitCode == STILL_ACTIVE) // was a termination message processed?
      {
        // no; wait for .1 second to see if the application is finished
        ::WaitForSingleObject(ProcessInfo.hProcess, 100);
        ::GetExitCodeProcess(ProcessInfo.hProcess, &dwExitCode);
      }
    }
  ::CloseHandle(ProcessInfo.hProcess);
  ::CloseHandle(ProcessInfo.hThread);
}
else
  dwExitCode = ::GetLastError(); 
```

我遇到的问题是，在某些时候，此消息泵似乎释放了我在运行此代码时打开的窗口上的窗口和菜单句柄。我在调试器中进行了遍历，它从来没有进入 if (!PumpMessage()) 语句的主体，所以我不知道这里发生了什么导致窗口和菜单句柄消失南。如果我没有消息泵，一切正常，只是在等待循环运行时 GUI 无法自行更新。

有没有人对如何使这项工作有任何想法？或者，如果 bWait 为 TRUE，我想启动一个工作线程来启动第二个应用程序，但我以前从未对线程做过任何事情，所以我需要一些关于如何在不引入同步问题等的情况下做到这一点的建议.（无论哪种情况，代码示例都将不胜感激。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T16:42:23.227

我还在 Microsoft 论坛上发布了这个问题，感谢 Microsoft 的 Doug Harris 的帮助，我发现我的 HWND 和 HMENU 值的问题确实是由于过时的 CWwnd* 和 CMenu* 指针（使用获得GetMenu() 和 GetDialogItem() 调用。在启动第二个应用程序后再次获取指针解决了这个问题。此外，他向我指出了一个网站*，该网站显示了使用 MsgWaitForMultipleObjects() 进行循环的更好方法来控制它'不涉及等待一段时间并轮询进程以获取退出代码的繁忙工作。

我的循环现在看起来像这样：

```
if (bWait)
{
  // In order to allow updates of the GUI to happen while we're
  // waiting for the application to finish, we must run a message
  // pump here to allow messages to go through and get processed.
  LONG  nIdleCount = 0;
  for (;;)
  {
    MSG msg;
    if (::PeekMessage(&msg, NULL, 0, 0, PM_NOREMOVE))
      PumpMessage();
    else //if (!OnIdle(nIdleCount++))
    {
      nIdleCount = 0;
      if (!PeekMessage(&msg, NULL, 0, 0, PM_NOREMOVE))
      {
        DWORD nRes = ::MsgWaitForMultipleObjects(1, &ProcessInfo.hProcess,
                                                 FALSE, INFINITE, QS_ALLEVENTS);
        if (nRes == WAIT_OBJECT_0)
          break;
      }
    }
  }
}
::GetExitCodeProcess(ProcessInfo.hProcess, &dwExitCode); 
```

*如果您好奇，该网站是： http: [//members.cox.net/doug_web/threads.htm](http://members.cox.net/doug_web/threads.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T00:35:55.717

我认为你的问题在于`WaitForSingleObject`

在[MSDN](http://msdn.microsoft.com/en-us/library/ms687032.aspx)中你会看到这个

> 调用直接或间接创建窗口的等待函数和代码时要小心。如果线程创建任何窗口，它必须处理消息。消息广播被发送到系统中的所有窗口。使用没有超时间隔的等待函数的线程可能会导致系统死锁。间接创建窗口的两个代码示例是 DDE 和 CoInitialize 函数。因此，如果您有创建窗口的线程，请使用 MsgWaitForMultipleObjects 或 MsgWaitForMultipleObjectsEx，而不是 WaitForSingleObject。

在我的消息泵代码中使用 use `MsgWaitForMultipleObjects`( [doc](http://msdn.microsoft.com/en-us/library/ms684242(VS.85).aspx) )。

用一个电话这个电话。

```
MsgWaitForMultipleObjects(1, &ProcessInfo.hProcess, FALSE, 100, QS_ALLEVENTS); 
```

这应该可以解决资源消失的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T08:08:03.290

当您说窗口和菜单句柄似乎被释放时，您的意思是您的实际 HWND 和 HMENU 值似乎不再有效，还是您的 MFC CWnd* 和 CMenu* 变量失败？

如果是后者，问题很可能是您通过在某处调用 CWnd::FromHandle() （或 CMenu::FromHandle()）（或调用调用它们的东西）来获取 CWnd* 指针，而 OnIdle() 是丢弃它们。

根本原因是 MFC 维护了一个从窗口（或菜单等）句柄到系统中 CWnd* 对象的映射。当调用 CWnd::FromHandle() 时，它会在映射中查找匹配项：如果找到，则返回。如果不是，则创建一个新的临时 CWnd，将其添加到地图中并返回。OnIdle() 背后的想法是，当它被调用时，所有消息处理都已完成，因此 OnIdle() 丢弃任何仍然存在的临时 CWnd 对象。这就是为什么 CWnd::FromHandle() 文档警告返回的指针可能是临时的。

对此的“正确”解决方案是不要挂在从 CWnd::FromHandle() 返回的 CWnd* 指针上。鉴于您的应用程序的简单性，删除调用 OnIdle() 可能会更容易：这不会对安装程序产生任何负面影响。

当然，这全是猜测，但听起来似乎很合理……

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-08T08:32:08.413

There is a Windows function called DisableProcessWindowsGhosting (see [http://msdn.microsoft.com/en-us/library/ms648415(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/ms648415(v=vs.85).aspx)) that prevents Windows from 'ghosting' your window, and continue updating the window (your animation).

# vb.net - VB.net 2005 获取远程计算机的系统时间？

> ID：831273
> 
> 赞同：1
> 
> 时间：2009-05-06T19:21:45.893
> 
> 标签：vb.net, system-information

我正在尝试设置“AT”作业以在远程计算机上导出一些注册表项，问题是 DOS 命令需要一段时间才能运行。我想获取远程计算机的系统时间，以便我可以安排它从我发送命令的时间开始运行 1 分钟。

有没有办法用 VB.Net 代码获取远程计算机的系统时间？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T20:56:45.103

这就是我要做的工作，感谢您对 Jon B 的所有帮助。

```
 Dim p As New System.Diagnostics.Process
    Dim pinfo As New System.Diagnostics.ProcessStartInfo
    Dim pout As String
    pinfo.FileName = ("C:\WINDOWS\system32\net.exe")
    pinfo.Arguments = ("time \\computername")
    pinfo.RedirectStandardOutput = True
    pinfo.UseShellExecute = False
    pinfo.CreateNoWindow = True
    p = Diagnostics.Process.Start(pinfo)
    p.WaitForExit()
    pout = p.StandardOutput.ReadLine
    MsgBox(pout) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-28T09:51:54.250

..如果你使用，可能会做一点检查

```
 ...
    startInfo.RedirectStandardOutput = true;
    startInfo.RedirectStandardError = true;
    ...

    string shellOut = "";
    if (p.ExitCode == 0)
    {
        shellOut = p.StandardOutput.ReadToEnd();
        Console.WriteLine("Operation completed successfully.");
    }
    else
    {
        shellOut = p.StandardError.ReadToEnd();
        Console.WriteLine(shellOut);
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:24:33.063

您可以使用：

```
net time \\computer_name 
```

您只需要为此付出代价并解析结果。

* * *

这是一些示例代码。它在 C# 中，但应该很容易翻译。

```
 static DateTime GetRemoteDateTime(string machineName)
    {
        machineName = @"\\" + machineName;
        System.Diagnostics.ProcessStartInfo startInfo = new System.Diagnostics.ProcessStartInfo("net", "time " + machineName);
        startInfo.RedirectStandardOutput = true;
        startInfo.UseShellExecute = false;
        System.Diagnostics.Process p = System.Diagnostics.Process.Start(startInfo);
        p.WaitForExit();

        string output = p.StandardOutput.ReadLine();
        output = output.Replace("Current time at " + machineName + " is ", "");
        return DateTime.Parse(output);
    } 
```

我没有费心添加任何错误处理（如果找不到机器等） - 您可以添加任何您需要的内容以满足您的目的。

# c# - 我必须从 ConfigurationSection 派生以支持每个用户的设置吗？

> ID：831281
> 
> 赞同：3
> 
> 时间：2009-05-06T19:23:17.137
> 
> 标签：c#, .net, configuration, settings, configurationmanager

我正在玩弄 .NET 的配置支持（ConfigurationManager 类和相关的支持类）。我想编写一个应用程序，一旦安装：

*   在 foo.exe.config（在程序文件中）中有默认设置。
*   用户稍后可以使用应该保留的非默认值覆盖设置。
*   用户的偏好应该保留在用户的配置文件中，因为他不应该对 Program Files 目录具有写权限。

应用程序在设置时应使用用户的首选项，否则使用默认值。

看起来这应该很容易——这是一种非常常见的模式。但是我在这方面的尝试遇到了障碍，我想知道我是否采取了正确的方法。

以下代码产生运行时异常“ConfigurationSection 属性在锁定时无法编辑”。

```
using System;
using System.Configuration;

namespace DemoAppSettingsProblem
{
    class Program
    {
        static void Main(string[] args)
        {
            Configuration userConfig =
                ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.PerUserRoamingAndLocal);
            if ( userConfig.AppSettings.Settings["foo"] != null )
                userConfig.AppSettings.Settings.Remove("foo");

            userConfig.AppSettings.Settings.Add("foo", "The string is foo.");

            userConfig.Save(ConfigurationSaveMode.Modified);    // exception!
        }
    }
} 
```

问题是 .NET 定义的`<appSettings>`部分是用默认声明的`allowExeDefinition=MachineToApplication`（请参阅 Microsoft 的 Irena Kennedy 的这篇[好文章](http://blogs.msdn.com/irenak/archive/2006/03/01/541317.aspx)）。这禁止将该部分写入用户的配置文件（本地或漫游）。

所以，我假设我需要定义我自己的部分，使用`allowExeDefinition=MachineToLocalUser`. 但据我从 MSDN 文档中得知，这意味着我需要创建自己的配置类，从`ConfigurationSection`. 那里的例子让我的工作比我预期的要多，这通常会引发我做错事的警钟。

做到这一点真的有那么难吗？.NET 是否提供了一种简单的方法来支持这一点，还是我应该完全采用不同的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T20:34:56.250

我已经使用了设置功能，它会为您将用户设置写入应用程序配置......

[http://msdn.microsoft.com/en-us/library/aa730869(VS.80).aspx](http://msdn.microsoft.com/en-us/library/aa730869(VS.80).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T20:32:03.993

假设您使用的是 .NET 2.0 或更高版本，您是否检查过“设置”文件？这些存储在您的 app.config 中 - 应用程序设置`<applicationSettings>`分段，<userSettings> 中的用户可定义设置，顺便说一下`allowExeDefinition=MachineToLocalUser`您提到的设置。

也许这可能是一种方法？这些用户设置是一种已定义的类型，如果需要（“mySettings”），您绝对可以在不同的名称下重复使用。

马克

# python - 在 win32 上为 django 服务的生产就绪服务器

> ID：831288
> 
> 赞同：3
> 
> 时间：2009-05-06T19:25:46.507
> 
> 标签：python, windows, django

我想在 Windows XP/Vista 上提供 django 应用程序。该应用程序是 Windows 程序的临时 Web 界面，因此不会承受重负载（每秒大约 100 个请求）。

您知道任何可以轻松部署在 Windows 上以服务 django 应用程序的小型服务器吗？（IIS 不是一个选项，因为该应用程序应该适用于所有版本的 Windows）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T19:57:34.200

[cherrypy](http://cherrypy.org)包括一个很好的服务器。[这](http://lincolnloop.com/blog/2008/mar/25/serving-django-cherrypy/)是您如何设置它以使用 django 和一些基准。

[twisted.web](http://twistedmatrix.com/trac/wiki/TwistedWeb)具有[wsgi](http://wsgi.org)支持，可用于运行您的 django 应用程序。[这](http://blog.dreid.org/2009/03/twisted-django-it-wont-burn-down-your.html)是你如何做到的。

事实上，任何[wsgi](http://wsgi.org)服务器都可以。这里还有一个例子，这次使用[spawning](http://pypi.python.org/pypi/Spawning)：

```
$ spawn --factory=spawning.django_factory.config_factory mysite.settings 
```

对于使用[paste ，](http://pythonpaste.org/)[这里](http://pythonpaste.org/djangopaste/)收集了信息。

当然，您可以将 apache 与[mod_wsgi](http://code.google.com/p/modwsgi/)一起使用。它只是另一个 wsgi 服务器。[以下](http://code.google.com/p/modwsgi/wiki/IntegrationWithDjango)是设置说明。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T20:41:30.880

如果您想尝试一下 Apache，请查看[XAMPP](http://www.apachefriends.org/en/xampp.html)，看看它是否适合您。您可以进行轻量级（阅读：无需安装）“安装”。当然，您还需要安装[mod_python](http://www.modpython.org/)来运行 Django。[这篇](http://jyotirmaya.blogspot.com/2008/11/xampp-python-django.html)文章可能会帮助您设置所有内容。（注意：我自己没有将 python/Django 与 XAMPP 一起使用。）

编辑：在有人指出这一点之前，XAMPP 通常不是生产就绪工具。这只是查看 Apache 是否适合您的有用方法。另外，我看到您事后正在使用 SQLite。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:34:05.380

为什么不是阿帕奇？

诺基亚开发了一个缩小版的 apache 以在他们的手机上运行。它支持python。

[http://research.nokia.com/research/projects/mobile-web-server/](http://research.nokia.com/research/projects/mobile-web-server/)

您还需要其他任何东西，例如数据库支持等吗？

# c# - How does one convert a Visual Studio .NET 2008 solution to Visual Studio .NET 2005?

> ID：831289
> 
> 赞同：3
> 
> 时间：2009-05-06T19:25:50.063
> 
> 标签：c#, visual-studio-2008, visual-studio-2005, solution

Assume that a solution only contains classes and that those classes are all written to .NET 2.0 specifications. If that solution were to be opened, converted and saved in Visual Studio 2008, would it be possible to reopen the solution later in Visual Studio 2005 with some minimal modifications to the .SLN file?

How would one go about doing that?

Is there a tool that will "down convert" .SLN files from 2008 to 2005 if all of the classes contained within the solution are already written to .NET 2.0 specifications?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-06T19:29:28.043

Uusally, the only thing you need to do with .SLN files is to change the version number at the top of the file.

Your CS project files will also be almost OK, and if they're not, it's possible to tweak them so that they are OK with both 2005 and 2008.

We ran for a while with two solution files (05 and 08) sharing the same set of CS project files.

Be aware though, that you can't share VC project files between the two versions like this.

The 'tweak' for the project files is as follows:

CS Projects created on VS2008 will contain the line:

```
<Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" /> 
```

VS2005 will choke on this, and you need to change it to the following:

```
<Import Project="$(MSBuildBinPath)\Microsoft.CSharp.targets" /> 
```

The latter will work with both 2005 and 2008.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T19:28:39.607

If you're not using any "fancy" features in 2008, in my experience the only thing which changes is the version number in a couple of places. That can be manually edited (it's at the top of the file IIRC). It's at least worth a try. If you're used VS2008-specific features (designers etc) it may well not work but for simple class libraries I've had success doing this.

You may be interested in a [blog post about VS2005 and VS2008 co-existing](http://msmvps.com/blogs/jon_skeet/archive/2007/11/20/vs2005-and-vs2008-co-existence.aspx) that I wrote a while ago.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T19:31:49.160

Here there is a converter [http://www.emmet-gray.com/Articles/ProjectConverter.htm](http://www.emmet-gray.com/Articles/ProjectConverter.htm) (works with VS 2010 also).

There is also [http://www.dsmyth.net/wiki/Downloads_VS2008ToVS2005Patcher.ashx](http://www.dsmyth.net/wiki/Downloads_VS2008ToVS2005Patcher.ashx)
(link currently broken?).

I also found this [http://www.codeplex.com/Vs2008BackMigration](http://www.codeplex.com/Vs2008BackMigration) but I didn't test it.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T19:28:16.393

Yes, it is possible, if you "downgrade" the solution files.

No, there is no such tool that I know of, and I've looked.

You have three options:

1.  Not open the solution file in 2008, and thus never upgrade it
2.  Not mix client versions against the same files (ie. stick to 2005, or everyone upgrade)
3.  Keep separate solution files for 2005 and 2008, make sure all the same projects are present in both

Thanks to [@Will Dean](https://stackoverflow.com/users/987/will-dean) for reminding me that project files can indeed be shared. Note that they are touched by the 2008 editor, but they can be opened in 2005 afterwards.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T19:31:44.310

You could try this. YMMV

[http://www.emmet-gray.com/Articles/ProjectConverter.htm](http://www.emmet-gray.com/Articles/ProjectConverter.htm)

I remember it was posted on Jon Skeets blog a few months back and seemed to get a thumbs up from people

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-05-06T19:27:05.600

There's no direct way, and it's a tall order if you try. The simplest way would be to create a new 2005 project and add your classes.

For starters: these are the differences that you'd see:

.csproj files: (these are based on MSBuild schema)

(edit)

*   ToolsVersion
*   ProductVersion
*   ProjectVersion

(remove)

*   OldToolsVersion
*   TargetFramework

.sln files: (no schema)

*   Format Version 10.0

etc.

# c# - 使用 Reflection.Emit 和 xsd 文件从数据库表生成类会遇到什么陷阱？

> ID：831290
> 
> 赞同：0
> 
> 时间：2009-05-06T19:26:35.773
> 
> 标签：c#, code-generation, business-objects, reflection.emit

我正在玩类生成（表的一个类 - 继承等。暂时不考虑......）。所以我从[这里](http://codebetter.com/blogs/david.hayden/archive/2006/02/05/137569.aspx)无耻地复制了 Reflection.Emit 代码。将其重新设计为在给定数据库中的每个表中生成，并在项目的 bin 文件夹中使用以下批处理调用创建文件： for /f "tokens=*" %%i in ('dir *.xsd /b') do " C:\Program Files\Microsoft SDKs\Windows\v6.0A\bin\xsd.exe" -c -l:c# -n:BusinessObjects %i

到现在为止还挺好。这个想法是每次新的数据库版本到来时重新生成类并将它们复制到“真实项目”中（我不需要任何运行时生成）并且也想享受 Intellisense。这种方法可能会出现什么陷阱、困难和问题，对那些描述松散的需求有什么更好的建议吗？！

这是创建程序集的控制台应用程序的生成代码：

```
 using System;
    using System.Collections.Generic;
    using System.Text;
    using log4net;
    using log4net.Config;
    using System.Data;
    using System.Data.SqlClient;
    using System.Threading;
    using System.Reflection;
    using System.Reflection.Emit;

    namespace GenerateAssemblies
    {

      class Program
      {

        private static readonly ILog logger =
             LogManager.GetLogger ( typeof ( Program ) );

        static void Main ( string[] args )
        {
          DOMConfigurator.Configure();  //tis configures the logger 
          logger.Debug ( "APP START" );

          DataTable dtTables = Program.GetTablesFromDb ( "POC" ) ;
          foreach (DataRow dr in dtTables.Rows)
          {
            string strTableName = dr[0].ToString () ;
            CodeEmitGeneratingAssemblies.DllGenerator.WriteXmlAndTxtFileOutOfDataTableByName (  strTableName);
            CodeEmitGeneratingAssemblies.DllGenerator.CreateAssembly ( strTableName );
          }

          Console.WriteLine ( " Should have now all the dll's " );
          Console.ReadLine ();
        } //eof method 

        static DataTable GetTablesFromDb ( string strDbName )
        {

          DataTable dt = new DataTable ( "tables" );

          string connectionString = "Integrated Security=SSPI;Persist Security Info=False;Initial Catalog=" + strDbName + ";Data Source=ysg";

          using (SqlConnection connection = new SqlConnection ( connectionString ))
          {
            SqlCommand command = connection.CreateCommand ();

            command.CommandText = string.Format ( "SELECT name from sys.tables" );

            connection.Open ();
            dt.Load ( command.ExecuteReader ( CommandBehavior.CloseConnection ) );
          }
          return dt;
        } //eof method 

      } //eof class 

    namespace CodeEmitGeneratingAssemblies
    {
      public class DllGenerator
      {
        private static readonly ILog logger =
             LogManager.GetLogger ( typeof ( DllGenerator ) );

        public static void WriteXmlAndTxtFileOutOfDataTableByName (string strDataTableName)
        {
          DOMConfigurator.Configure ();  //tis configures the logger 
          DataTable tableData = new DataTable ( strDataTableName );

          string connectionString = "Integrated Security=SSPI;Persist Security Info=False;Initial Catalog=POC;Data Source=ysg";

          using (SqlConnection connection = new SqlConnection ( connectionString ))
          {
            SqlCommand command = connection.CreateCommand ();

            command.CommandText = string.Format ( "SELECT * FROM [" + strDataTableName + "]");
            logger.Debug ( "command.CommandText is " + command.CommandText );
            connection.Open ();
            tableData.Load ( command.ExecuteReader ( CommandBehavior.CloseConnection ) );
          }

          tableData.WriteXml ( strDataTableName + ".xml" );
          tableData.WriteXmlSchema ( strDataTableName + ".xsd" );
        } //eof method 

        public static void CreateAssembly ( string strDataTableName )
        {
          AppDomain currentDomain = Thread.GetDomain ();

          AssemblyName myAssemblyName = new AssemblyName ( );
          myAssemblyName.Name = strDataTableName;

          AssemblyBuilder builder = currentDomain.DefineDynamicAssembly (
                              myAssemblyName,
                              AssemblyBuilderAccess.RunAndSave );

          builder.AddResourceFile ( "TableXml", strDataTableName + ".xml" );
          builder.AddResourceFile ( "TableXsd", strDataTableName + ".xsd" );

          builder.Save ( strDataTableName + ".dll" );
        }

      } //eof class 
    } //eof namespace 

    } //eof namespace 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T19:38:19.007

您会遇到使用（关系）数据库驱动的 oo 设计的所有问题：

*   没有足够的抽象，没有继承，也没有构建 ADT；
*   职责太多的类；
*   在错误的地方行为；
*   没有可用的方法来处理时间方面。

我更喜欢反过来工作。从oo模型到数据库

[编辑] 你可以尝试让混合模型工作。应用程序的一部分从 DB 转到 OO，另一部分则相反。这使您可以慢慢重构并迁移到 OO->DB。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-28T05:58:28.180

Duh ... 带有 SubSonic 的 oneliner：

```
sonic generate /override /server HOMIE /db BlogEngine /userid OMMITED /password OMMITED /out C:\code\out /generatedNamespace BlogEngine.Core.Providers.SubSonic /stripTableText be_ 
```

# wpf - 以编程方式选择列表框中的项目/索引

> ID：831296
> 
> 赞同：16
> 
> 时间：2009-05-06T19:27:53.710
> 
> 标签：wpf, select, listbox

在 WPF 中，我想设置 System.Windows.Controls.ListBox 的选定索引

到目前为止，我发现的最好方法是从控件中删除所有项目，插入所选项目，调用 SelectAll()，然后插入其余项目，但是这种解决方案既不适用于我的情况，也不是很有效。

那么，如何以编程方式设置要选择的列表框中的项目？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-06-11T16:14:44.237

您可以使用 SelectedItems 集合将多个项目设置为选中状态。这不是按索引，而是按您绑定的内容：

```
foreach (var boundObject in objectsBoundToListBox)
{
    ListBox.SelectedItems.Add(boundObject);
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-06T19:34:37.360

您可以执行此操作的一种方法是将 Selected 字段添加到您的数据对象。然后，您需要覆盖默认的 listboxitem 样式并将 isselected 属性绑定到对象中的 Selected 属性。然后，您只需要浏览您的数据项并更新 Selected 值。

如果您不将该 Selected 属性实现为依赖项属性，则需要您的类实现 INotifyPropertyChanged 接口并在设置值时引发 propertychanged 事件。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-06T19:44:13.140

你必须这样做：

```
ListBoxObject.SelectedItem = ListBoxObject.Items.GetItemAt(itemIndex); 
```

itemIndex 将是您要选择的项目。如果要选择多个项目，则需要使用 ListBox.SelectedIndexCollection 属性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-07-25T20:57:37.213

您可以对多个部分执行此操作：

```
ListBoxObject.SelectedItems.Add(ListBoxObject.Items.GetItemAt(i)); 
```

其中 i 是项目索引。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-21T03:25:55.020

感谢 mdm20。我的案例实际上是`CheckBox`在 中检查 a `ListBox`，而这个依赖属性就像一个魅力。我必须继承我的自定义类`DependencyObject`并实现该属性

```
public class ProjectListItem : DependencyObject{ 

    public Boolean IsChecked
    {
        get { return (Boolean)this.GetValue(CheckedProperty); }
        set { this.SetValue(CheckedProperty, value); }
    }
    public static readonly DependencyProperty CheckedProperty =
        DependencyProperty.Register("IsChecked", typeof(Boolean), typeof(ProjectListItem), 
                                    new PropertyMetadata(false));
} 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-09-10T14:43:04.237

如何以编程方式在wpf的列表框中选择多个项目

```
foreach (var boundObject in objectsBoundToListBox)
{
    ListBox.SelectedItems.Add(boundObject);
} 
```

# php - 我可以在 PHP 中使用 Perl CGI::Sessions 数据吗？

> ID：831297
> 
> 赞同：0
> 
> 时间：2009-05-06T19:27:56.410
> 
> 标签：php, perl, cgi, session

我在MySQL 中使用 Perl 的[CGI::Session 。](http://search.cpan.org/dist/CGI-Session)那里没有问题。

我想合并一些其他语言，尤其是 PHP，以使用相同的会话 cookie。我该怎么做？

几乎整个站点都在 Perl 中，但我想使用免费的 PHP 东西，比如论坛和 mediawiki，并且仍然使用相同的会话 cookie。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T01:24:23.837

您可以使用[PHP::Session](http://search.cpan.org/~miyagawa/PHP-Session-0.27/lib/PHP/Session.pm)模块。查看[Using Perl Code from PHP](http://devzone.zend.com/node/view/id/1712)以获得其他想法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T19:44:31.410

我从未尝试过，但请参阅[session_set_save_handler](http://www.php.net/manual/en/function.session-set-save-handler.php)函数。一些框架（[如 CakePHP](https://trac.cakephp.org/browser/branches/1.2.x.x/cake/libs/session.php)）使用它来将会话存储在数据库中。也许您可以编写一些代码来使用与 perl 相同的会话，将此脚本添加到您的论坛、wiki 等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-30T01:23:05.360

如果您使用 CGI::Session，您可以将序列化程序更改为 YAML，然后使用 PHP 解析 YAML。

或者，如果您发现 YAML 解析困难，您可以为 CGI::Session 编写自己的序列化程序，例如使用 JSON，您可以更轻松地解析。比您在 PHP 中使用与在 Perl 中使用的会话 ID 相同的会话 ID。

# .net - .NET 中 XSLT 2.0 可用性的当前状态是什么

> ID：831300
> 
> 赞同：16
> 
> 时间：2009-05-06T19:28:18.607
> 
> 标签：.net, xml, xslt, xslt-2.0

我可以从网络和博客圈中找到的最新消息表明，Microsoft 的 XML 团队将[支持 XSLT 2.0（现在它已成为 W3C 的全面推荐）](http://blogs.msdn.com/xmlteam/archive/2007/01/29/xslt-2-0.aspx "来自 Microsoft XML 团队博客")。除此之外，我找不到任何东西。

目前的状态是什么？它在 .NET 3.5/4.0 中可用，还是他们坚持使用 XSLT 1.1 并推动 XQUERY 和 LINQ？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T19:33:45.320

微软不支持它，我知道没有任何公告。你从哪里听说的？

### 更新（在您添加到 XML 团队博客的链接之后）：

根据同年晚些时候对微软 XML 团队项目经理 Chris Lovett 的[采访](http://blogs.msdn.com/xmlteam/archive/2007/11/16/chris-lovett-interview.aspx)，微软似乎改变了他们的策略，所以这完全是关于 LINQ：

> 至于 XSLT 2.0——我们从客户那里听到并了解 XSLT 2.0 相对于 XSLT 1.0 的改进，但现在我们正处于对 LINQ 和 EDM 的重大战略投资中，以期我们的数据编程平台的未来think 将在针对所有类型数据的编程方面产生重大改进。但是我们一直在重新评估我们的技术投资，所以如果您的读者想要增加他们在 XSLT 2.0 上的数量，请让他们给我们留言并发表评论。

如果您想将 XSLT/XPath 2.0 与 .NET 一起使用，您可以使用[**Saxon.NET**](http://sourceforge.net/projects/saxondotnet/)。然而，这只是在 IKVM 中运行的 Java 版本的 Saxon。它的大小在 30 MB 范围内，当我尝试它时，它的性能似乎并没有压倒性的（尽管这是一个非常基本的测试，所以结果可能与典型的样式表不同）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-06T19:37:45.433

[XQSharp](http://www.xqsharp.com/)现在包括用于 .NET 的完整 XSLT 2.0 实现。它还没有编译为 MSIL，但正在准备中。

# django - 什么时候适合使用 Django 上下文处理器？

> ID：831301
> 
> 赞同：17
> 
> 时间：2009-05-06T19:28:25.190
> 
> 标签：django, django-templates

如果我大约一半的视图需要相同的数据集，是否适合使用上下文处理器使数据始终可用，或者是否有更好的方法来避免重复代码以跨多个视图获取数据而无需查询数据它不会在视图中使用？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-07T03:16:58.730

初始化程序将运行设置文件中列出的`RequestContext`任何上下文处理器，但它还需要运行其他处理器的列表。任何通用上下文处理器都可以放在 settings.py 中，并且可以根据具体`RequestContext`情况添加更具体的上下文处理器。

完全省略`RequestContext`不运行任何上下文处理器。

```
# want context processors listed in settings.py as well as some more specific ones
return render_to_response('template.html', {'foo':'bar'}, context_instance=RequestContext(request, processors = extra_processors))

# want only context processors listed in settings.py
return render_to_response('template.html', {'foo':'bar'}, context_instance=RequestContext(request))

# no context processors
return render_to_response('template.html', {'foo':'bar'}) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T20:00:44.537

您可以通过仅传递`RequestContext(request)`给需要它的视图来过滤掉哪些视图实际使用上下文处理器，例如：

```
# want context processors
return render_to_response('template.html', {'foo':'bar'}, context_instance=RequestContext(request))

# no context processors
return render_to_response('template.html', {'foo':'bar'}) 
```

# sql - 组织结构图的 SQL 查询？

> ID：831317
> 
> 赞同：2
> 
> 时间：2009-05-06T19:32:05.353
> 
> 标签：sql, database, hierarchy

我觉得这可能是一个常见问题，但从我的谷歌搜索中，我找不到与我的问题一样具体的解决方案。

我的数据库中有一个组织（表）列表，我需要能够根据它们的层次结构运行查询。例如，如果您查询最高组织，我想返回该组织下列出的所有组织的 ID。此外，如果我查询一个中等规模的组织，我只想要在该组织下列出的组织 ID。

a) 设置数据库模式和 b) 查询的最佳方法是什么？我只想发送最顶层的组织 ID，然后获取该组织下的 ID。

我认为这是有道理的，但如果有必要我可以澄清一下。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T21:14:14.907

正如我在评论中所承诺的，我挖了[一篇文章](http://www.sitepoint.com/article/hierarchical-data-database/2/)关于如何将层次结构存储在允许对任意子树进行恒定时间检索的数据库中。我认为它比当前标记为已接受的答案更适合您的需求，无论是在易用性还是访问速度方面。我可以发誓我最初在维基百科上看到过同样的概念，但我现在找不到了。它显然被称为“修改的前序树遍历”。它的要点是你对树中的每个节点进行两次编号，同时进行深度优先遍历，一次在向下的路上，一次在向上的路上（即，当你展开堆栈时，在递归实现中） . 这意味着给定节点的子节点的所有数字都在该节点的两个数字之间。在这些列上添加一个索引，您将获得非常快速的查找。我敢肯定这是一个糟糕的解释，

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T19:41:52.600

一种简单的方法是将组织的出身存储在文本字段中，例如：

销售-欧洲-北部

要搜索每个销售组织，您可以查询 SALES-%。对于每个欧洲销售组织，查询 SALES-EUROPE-%。

如果您重命名组织，请注意更新其子组织。

这使它保持简单，没有递归，但以一定的灵活性为代价。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T19:36:36.873

简单的方法是有一个 ParentID 列，它是同一个表中 ID 列的外键，根节点为 NULL。但是这种方法有一些缺点。

[嵌套集](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)是在关系数据库中存储树的有效方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T19:35:23.990

你可以让一个组织有一个 PK id 和一个对 id 的父 FK 引用。然后对于查询，使用（如果您的数据库后端支持它们）递归查询，即公用表表达式。

# java - 包含集合的 Web 应用程序域对象是否应该具有“添加”和“删除”项方法？

> ID：831319
> 
> 赞同：1
> 
> 时间：2009-05-06T19:33:17.910
> 
> 标签：java, dao, oop

假设我有一个包含 Dog 对象集合的 Person 类。这种关系是双向的。

```
public class Person {
  private List<Dog> dogs;
  // getter and setter for dogs
}

public class Dog {
  private Person person;
  // getter and setter for person
} 
```

好的，如果我只是在处理这些对象，我将在 Person 中有添加狗和删除狗的方法，这样客户端就不会直接使用集合。

```
public void removeDog(Dog dog) {
  dogs.remove(dog);
  dog.setPerson(null);
}

public void addDog(Dog dog) {
  dog.setPerson(this);
  dogs.add(dog);
} 
```

或类似的规定。

我的问题是在服务层中使用这些对象时出现的。我可以通过 addDog 向一个人添加一条新狗，然后简单地保存将自动保留新狗的人。但是，通过 removeDog 删除狗然后保存人不会自动从持久存储中删除狗......它只会将狗引用设置为 null。

所以我最终得到了类似的东西：

```
Dog dog = dogDAO.getDogById(int id);
dogDAO.remove(dog); 
```

因为这是一个 web 应用程序，并且 Persons 和 Dogs 不在内存中维护，所以它工作正常，我从未调用过 Person.removeDog()。下次我加载最初引用这条狗的人时，它不会包含这条狗，因为它已从存储中移除。同样的事情也适用于添加狗：

```
Person person = personDAO.getPersonById(int id);
Dog dog = new Dog();
dog.setPerson(person);
dogDAO.save(dog); 
```

同样，这甚至可以正常工作，而且我从未调用过 Person.addDog()。

那么在我的 Person 类中使用 addDog 和 removeDog 方法有什么意义吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T19:50:48.413

如果没有人工干预，这总是很难做到的。一旦您删除对象引用并拥有一个陈旧的对象。在另一个用例中，您只需删除一些其他对象指向的对象（列表）。这也应该是个问题。如果这被懒惰地接受，它将涵盖很多错误。

为简单起见，您可以将 dao remove 操作添加到 person removeDog() 中，但是这样的用例将狗从一个人身上移除并将其添加到另一个人身上是不可能的。如果您知道必须将其从持久性中移除，那么您将狗从人身上移除，然后将其从持久性中移除，有什么问题？你少走一步。所以归还被移除的狗会给你带来一个模式

```
dogDAO.remove(person.removeDog(dog)) 
```

亲自进行添加和删除使您不仅可以模仿列表行为，还可以拥有一些额外的功能。在你的情况下很难决定，因为它是一个简单的设置，它取决于 dao 东西的可访问性以及你喜欢把它放在哪里。

您至少应该对要支持的每个用例都有印象。然后需要定义强制和可选的对象链接和设置。有了一些实用主义（例如将持久性东西与对象耦合），我们必须有机会做一些更容易（因此更不容易出错）使用的面向对象的设置

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T21:07:26.717

如果从逻辑上讲，从人中添加和删除狗是如何完成的，那么就没有理由从狗中添加和删除人的方法。您的目标是您的数据模型始终处于一致状态。如果您允许从狗身上移除人，那么您必须让狗从人身上移除自己，以保持您的数据模型一致。然后你必须避免递归。

听起来你拥有它的方式很好、清晰、明确。如果您愿意，您可以随时向 Dog 类添加注释，以添加没有 addPerson 和 removePerson 方法是有目的的，并且应该通过从人中删除狗或将狗添加到人来完成。

代码中不需要完美的对称性或完美的正交性。目标不是为了那个，而是为了让你的数据模型以一种干净、易于理解的方式保持一致。

# version-control - 如何比较 2 个文件并忽略评论中的任何更改？

> ID：831323
> 
> 赞同：2
> 
> 时间：2009-05-06T19:34:28.953
> 
> 标签：version-control, merge, comments

我正在使用 C# 和 VB.NET。

我经常（每天......）向现有的源文件添加评论。当我签入这些文件时，我想让我的合并工具忽略对注释所做的任何更改——我只是想确保我没有更改代码。

我使用 WinMerge 和 Team Foundation Control Server（是的，没有机会：当我接受这份工作时，Subversion 不是一个选项：o）。它们都可以忽略空格，但不能忽略注释。结果：在签入之前，我必须仔细查看对每个文件所做的所有更改。这非常麻烦。

（好吧，因为我的大多数同事根本不发表评论——嘿，他们使用很长的命名空间/类/方法/属性/类型/常量名称来说明一切，伙计们！——这是很多工作。 )

有什么建议么 ？

一切顺利，西尔万。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T19:39:22.043

BeyondCompare 有一个过滤器用于忽略“不重要”的更改，默认情况下评论属于该类别。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-18T02:01:50.457

[Compare++](http://coodesoft.com)有一个选项“忽略评论更改”和“忽略纯格式更改”，应该满足您的要求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T19:48:19.590

您说您使用了 WinMerge - 它具有过滤掉评论的能力。

但是它只适用于单独一行的注释，例如：

```
int i; // comment 
```

将被检测为不同于

```
int i; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T19:53:19.687

听起来您正在使用注释作为工具来理解您使用的代码。这是一个有趣的想法，相当于突出一本书或做笔记。但是您需要确保在与他人合作之前删除所有这些临时评论。

在比较或推广之前，请通过去除评论的过滤程序运行您的源文件。这可能是一个单行 perl 脚本。

为了使它更容易，为您的非永久评论使用独特的模式，使它们更容易被过滤掉（并区分这些临时评论和您真正想留在源中的评论）。例如，如果您使用 C++ 编写，请始终使用

```
 //Sylvain: this is my comment here. 
```

或其他一些更容易 grep 的模式。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-06T19:42:26.903

如果评论的内容不是您关心的内容，也无所谓，为什么不删除它们呢？

如果可读性强且易于理解的文档化代码是您所创建内容的一部分，那么为什么不查看对元数据的更改呢？

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-05-06T20:56:42.077

给你的代码添加注释是你的代码难以阅读的味道，代码应该是自我描述的，就像有人说的那样，好的代码就像一个笑话，不需要解释。最好更改变量名，将部分代码放入子例程中。重构比评论更好。即使您找到了解决评论问题的工具，它也不能解决使您的代码易于理解的真正问题。

# c# - C# TabControl TabPage 更改

> ID：831330
> 
> 赞同：22
> 
> 时间：2009-05-06T19:35:43.147
> 
> 标签：c#, .net, tabcontrol, tabpage

如何以编程方式更改在我的选项卡控件中显示的选项卡页？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-05-06T19:39:17.990

通过 tabControl1.SelectedIndex，它是一个整数，或者如果您有对特定选项卡的引用，则 tabControl1.SelectedTab。

如果您想选择第一个：

```
tabControl1.SelectedIndex = 0; 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2014-08-07T17:46:10.083

已接受答案的其他替代方案：

```
tabControl1.SelectedTab = MyTabPage; 
```

或者 `tabControl1.SelectTab("NameOfTabToActivate");`

或者 `tabControl1.SelectTab(IndexOfTab);`

或者 `tabControl1.SelectTab(TabObject);`

（我从这篇文章中偷了这个答案：[Activate tabpage of TabControl](https://stackoverflow.com/questions/3921224/activate-tabpage-of-tabcontrol)）

# asp.net - ASP.NET 保存发送到浏览器的 HTML

> ID：831334
> 
> 赞同：1
> 
> 时间：2009-05-06T19:36:23.223
> 
> 标签：asp.net, savestate

我需要为某些交易保存发送到浏览器的完整且准确的 HTML（用于法律跟踪目的）。我怀疑我不确定是否有合适的钩子来执行此操作。有人知道吗？（顺便说一句，我知道还需要保存相关页面，如样式表和图像。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T19:42:11.010

您可以创建一个[http 模块](http://www.15seconds.com/Issue/020417.htm)并将输出流保存在某处。

您应该挂钩 PreSendRequestContent 事件...：

此事件在 ASP.NET 将响应内容发送到客户端之前引发。此事件允许我们在内容交付给客户端之前更改内容。我们可以使用此事件将所有页面中通用的内容添加到页面输出中。例如，常见的菜单、页眉或页脚。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T19:43:25.560

您可以附加到[PreSendRequestContent](http://msdn.microsoft.com/en-us/library/system.web.httpapplication.presendrequestcontent.aspx)。此事件在内容发送之前引发，让您有机会修改它，或者在您的情况下保存它。

[关于拦截模式的 P&P 文章](http://msdn.microsoft.com/en-us/library/ms998536.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T19:41:45.643

您可以实现响应过滤器。这是[一个处理 ASP.NET 生成的 HTML 的好示例](http://aspnetresources.com/articles/HttpFilters.aspx)。除了将 HTML 发送到客户端之外，您还应该能够将 HTML 写入数据库或其他合适的存储。

这是将过滤器挂接到您的应用程序中的另一种 IMO 更简单的方法：

在 Global.asax 中，将以下代码放在 Application_BeginRequest 处理程序中：

```
void Application_BeginRequest(object sender, EventArgs e)
{
    Response.Filter = new HtmlSavingFilter(Response.Filter);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-04T09:20:40.280

我想您只想为某些页面保存呈现的 html。如果是这样，我一直在我的一个应用程序中使用以下方法，该应用程序将呈现的 html 存储在磁盘上的某处以进行缓存。此方法只是覆盖页面的呈现事件。

```
protected override void Render(HtmlTextWriter writer)
{
    using (HtmlTextWriter htmlwriter = new HtmlTextWriter(new System.IO.StringWriter()))
    {
        base.Render(htmlwriter);
        string html = htmlwriter.InnerWriter.ToString();

        using (FileStream outputStream = new FileStream(@"C:\\temp.html", FileMode.OpenOrCreate))
        {
             outputStream.Write(html, 0, html.Length);
             outputStream.Close();
        }

        writer.Write(html);
    }
} 
```

真的很适合我。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T20:10:07.557

也有专门为此目的制造的硬件设备。我们使用了一种名为“ [PageVault](http://www.projectcomputing.com/products/pageVault/) ”的方法。

# svn - 是否有 SVN 命令来查找两个本地文件之间的差异？

> ID：831335
> 
> 赞同：11
> 
> 时间：2009-05-06T19:36:31.583
> 
> 标签：svn, diff

查找硬盘上两个文件（两者都不在存储库中）之间差异的 SVN 命令是什么？

查找某个文件是否在特定版本的 SVN 中的命令是什么？

您使用 SVN 命令做了哪些很酷的事情？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-06T19:45:38.253

您不使用 SVN 来区分不在存储库中的文件。如果您使用的是 linux，请使用以下命令：

```
diff file1 file2 
```

如果您使用的是 Windows，请尝试使用诸如win [merge 之类的工具](http://winmerge.org/)

要在存储库中查找有关文件的信息，请使用以下命令：

```
svn info file 
```

如果您想了解更多关于 SVN 的信息，请查看官方[教程](http://svnbook.red-bean.com/en/1.5/svn-book.html)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2014-02-04T03:03:11.063

svn diff --old foo.c --new bar.c

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-07T07:13:52.030

在 TortoiseSVN 中，您可以区分两个任意文件。只需选择它们并在 tortoiseSVN 的上下文菜单中选择**差异。**但是，它们必须在同一目录中，否则 TSVN 将不会显示 diff 命令。在这种情况下，您可以使用辅助工具**TortoiseIDiff.exe**和**TortoiseMerge.exe**，它们是 TortoiseSVN 的一部分，位于 TSVN_installation/bin 文件夹中

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T19:51:01.923

答案：

1.  没有，SVN 可以比较目标的存储库版本（即特定文件的第 1 版和第 3 版）或工作副本版本和最后签出版本之间，或工作副本和存储库版本之间

2.  取决于你的意思。如果文件已添加，您可以检查给定版本的文件的日志，如下所示：

    svn 日志文件名@revnumber

例如，检查版本 2 中的 TestFile.txt 的日志：

```
svn log TestFile.txt@2 
```

如果它输出一个日志，那么在版本 2 中有一个同名的文件，否则它不是。

但是，这不会告诉您当前工作副本中的文件是否与您检查日志的文件相同（即，如果您在较早的版本中删除了该文件，然后添加了一个新的具有相同名称的文件，它不是同一个文件，在生命周期方面，但它是在同一位置具有相同名称的文件）。

至于第三个问题，你能说得更具体一点吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-05-13T08:18:43.320

只是对@Richard Kirby 回答的补充，因为我无法评论低声誉。

“svn diff --old foo.c --new bar.c”

该命令非常适合在两个本地文件之间进行差异。除此之外，它还可以用于比较使用 SVN 颠覆 URL 指定的两个文件之间的差异。它将类似于： svn diff --old [https://repository/file1](https://repository/file1) --new [https://repository/file2](https://repository/file2)

# c# - input hidden 和 updatePanel（一个 ASP.NET AJAX 的故事）

> ID：831340
> 
> 赞同：0
> 
> 时间：2009-05-06T19:37:02.067
> 
> 标签：c#, asp.net-ajax, input

如何更新隐藏在 AsyncPostBack 上的 UpdatePanel 内的输入？

用户单击面板外的按钮。与点击事件关联的方法更新输入的值（它具有 runat="server" 属性）。

我无法更新此输入的值。

我需要存储一个值以在以下回发中使用。也许我可以使用 session 来存储这个值。

有什么建议吗？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T19:42:13.363

因为它是回发，您可能必须在回发事件中执行检查并执行更新。如果没有，您可能必须覆盖较早的事件。请参阅[http://msdn.microsoft.com/en-us/library/dct97kc3.aspx](http://msdn.microsoft.com/en-us/library/dct97kc3.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T19:53:44.273

如果您需要根据用户单击不在更新面板中的按钮来更新更新面板（及其内容），请在更新面板中添加一个部分，如下所示：

```
<asp:Button ID="btnOK" runat="server"/> 
<asp:UpdatePanel ID="pnlMyPanel" runat="server">
    <ContentTemplate>
        <!-- Content to get updated -->
    </ContentTemplate>
    <Triggers>
        <asp:AsyncPostBackTrigger ControlID="btnOK" />
    </Triggers> 
</asp:UpdatePanel> 
```

上面示例中的触发器部分告诉更新面板在单击按钮时进行更新。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:59:54.740

您可能想尝试一个`<asp:HiddenField>`而不是一个`<input type='hidden' runat='server'>`. 我认为 asp.net 版本更具回发意识。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T04:54:23.457

没门。更新输入的唯一方法是做一个完整的帖子。最好使用对象 Session。

# linq-to-sql - Linq sql数据绑定到winforms组合框

> ID：831345
> 
> 赞同：0
> 
> 时间：2009-05-06T19:38:01.173
> 
> 标签：linq-to-sql

我正在尝试将 ComboxBox 绑定到外键表。我知道 on 不能绑定到实际的外键 SomeTableClassFK （当 FK 已经有值时会导致 LinqSql 异常）。因此，我通过 ComboBox 的 SelectedItem 属性绑定到 FK 对象 SomeTable。

SomePrimaryTable
SomeTableClassFK ---> SomeTableClass.PK
SomeTable --------> SomeTableClass

this.aComboBox.DataBindings.Add(new System.Windows.Forms.Binding("SelectedItem", this.somePrimaryTableBindingSource, "PendingReason", false));

这是行不通的。ComboBox 总是将 FK 对象即时绑定到其列表中的第一项。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T22:53:04.810

我不确切知道在哪个帖子中，但我记得 scottgui 在 linq 系列中提出了解决这个问题的方法......也许试图找到它：

[http://weblogs.asp.net/scottgu/archive/2007/09/07/linq-to-sql-part-9-using-a-custom-linq-expression-with-the-lt-asp-linqdatasource- gt-control.aspx](http://weblogs.asp.net/scottgu/archive/2007/09/07/linq-to-sql-part-9-using-a-custom-linq-expression-with-the-lt-asp-linqdatasource-gt-control.aspx)

干杯

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T15:51:58.247

好的...问题被追溯到时髦的 winform 行为。显然，不能保证不会多次调用用户控件的 OnLoad。因此，所涉及的两个表（见上图）是从不同的 DataContext 加载的。啪！！

# ruby-on-rails - Rails：为什么 find(id) 会在 rails 中引发异常？

> ID：831347
> 
> 赞同：127
> 
> 时间：2009-05-06T19:39:03.590
> 
> 标签：ruby-on-rails, activerecord

> **可能重复：**
> [当 id 1 不存在时，Model.find(1) 给出 ActiveRecord 错误](https://stackoverflow.com/questions/4966430/model-find1-gives-activerecord-error-when-id-1-does-not-exist)

如果数据库中没有 id 为 1 的用户，尝试`User.find(1)`将引发异常。

为什么是这样？

* * *

## 回答 #1

> 赞同：230
> 
> 时间：2009-05-06T19:42:18.230

因为这是架构师希望 find(id) 工作的方式，如 RDoc 中所示：

> 按 id 查找 - 这可以是特定 id (1)、id 列表 (1, 5, 6) 或 id 数组 ([5, 6, 10])。如果无法找到所有列出的 id 的记录，则会引发 RecordNotFound。

如果您不希望引发异常，请使用 find_by_id，如果找不到具有指定 id 的对象，它将返回 nil。您的示例将是`User.find_by_id(1)`.

* * *

## 回答 #2

> 赞同：-8
> 
> 时间：2009-05-06T19:57:38.430

根据 runako 的解释，选择是否引发异常实际上非常有用。我正在开发一个博客应用程序，我想添加对查看下一个或上一个博客条目的支持。我能够向我的模型添加两个实例方法，当您在查看第一篇文章时尝试获取上一篇文章或查看最后一篇文章时尝试获取下一篇文章时，`Post`它们只会返回：`nil`

```
def next
  Post.find_by_id(id + 1)
end

def previous
  Post.find_by_id(id - 1)
end 
```

这避免了我的帮助代码，它有条件地生成上一篇文章/下一篇文章链接，而不必处理`RecordNotFound`异常，这会很糟糕，因为它将使用异常进行控制流。

# ms-access - VBA Trim() 函数奇怪地截断文本！

> ID：831350
> 
> 赞同：2
> 
> 时间：2009-05-06T19:39:24.260
> 
> 标签：ms-access, string, trim

我正在尝试在 MS Access 中的备注字段末尾修剪多余的空白。我尝试了多种方法：

1) 字段更新为 Trim([fieldname]) 的更新查询。出于某种原因，这没有任何作用。空白仍然存在。

2) 使用宏函数进行更新，其中字段内容作为字符串传递，然后使用 Trim() 函数进行处理并传回。这真的很奇怪，因为它似乎在完全随机的地方截断了字段中的文本（每条记录都不同）。有时是 366 个字符，有时是 312，有时是 280。

3) 与上述相同，但使用 RTrim()

我怎么可能把这么简单的功能搞砸了？！非常感谢任何帮助。想留着我的头发。

-山姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T20:43:53.683

根据这篇[文章](http://office.microsoft.com/en-us/access/HP051875211033.aspx)：

> Text 和 Memo 数据类型都只存储在字段中输入的字符；不存储字段中未使用位置的空格字符。

正如hypoxide所暗示的那样，它们实际上可能不是空间

**编辑**

我怀疑该字段中的最后一个字符是回车符或换行符。如果是这种情况，那么 Trim（或 Trim 的任何变体 - RTrim\LTrim）将不起作用，因为它们只会删除空格字符。正如评论中建议的“onedaywhen”，尝试使用 ASC 函数来确定备注字段中最后一个字符的实际字符代码。您可以在查询中使用类似以下的内容来执行此操作：

```
ASC(Right(MyFieldName,1)) 
```

将查询结果与字符集进行比较，以确定结束备注字段的实际字符。（空格 = 32，换行 = 10，回车 = 13）。

您可能必须测试最后一个字符，如果它是换行符或回车符，请删除该字符，然后将修剪功能应用于字符串的其余部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T19:42:43.957

这可能会让我过时，但 Access 对固定长度和可变长度有不同的字符类型吗？在 SQL 中，CHAR(10) 将始终为 10 个字符长，必要时进行填充，而 VARCHAR(10) 将“最大”大小为 10。截断 CHAR(10) 只会将空格放回去。

# httpbrowsercapabilities - HttpBrowserCapabilities 自定义浏览器文件解析

> ID：831352
> 
> 赞同：1
> 
> 时间：2009-05-06T19:39:37.770
> 
> 标签：httpbrowsercapabilities

如果我有一个自定义的 .browser 文件，并且我想评估如果给定一个特定的用户代理会发生什么，有没有办法通过 .NET API 做到这一点？

我试图使用 HttpBrowserCapabilites，但我不确定如何将自定义 .browser 文件加载到该类中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T00:02:45.640

通常，您不必显式加载 HttpBrowserCapabilities 类；只要您的 .browser 文件位于正确的位置（在 App_Browsers 中），ASP.NET 就会为您加载它。

但是，测试它将是另一个问题。您不能从 HttpApplication (global.asax) 或自定义 HttpModule 中修改“User-Agent”HTTP 标头。

这只剩下尴尬的技术，例如使用反射来强制值，或使用外部工具（如 Fiddler）。或者，如果您精通 C/C++，您可以举一个简单的 ISAPI 过滤器示例并对其进行修改，然后将其安装在 IIS 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-25T06:17:37.353

安装用户代理切换器 Firefox 扩展。它将让您调整浏览器发送到 Web 服务器的用户代理。

[http://chrispederick.com/work/user-agent-switcher/](http://chrispederick.com/work/user-agent-switcher/)

# resources - 术语：什么是强行移除分配给进程的资源？

> ID：831354
> 
> 赞同：1
> 
> 时间：2009-05-06T19:40:04.727
> 
> 标签：resources, operating-system, terminology

什么是强制（非自愿）移除分配给进程的资源？

我似乎不记得描述这个的名字了。我试过搜索，也没有找到关键词。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T19:54:00.403

撤销？失效？呸呸呸？

很确定它是“yoink”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T20:53:54.610

一般来说，资源撤销。特别是通过句柄管理的资源，句柄失效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T20:50:23.293

我知道锁被称为“打破锁”。我不知道适用于每种资源的通用术语。如果我真的必须想出一个，我想我会称之为“撤销资源”。

# php - Diggbar modrewrite - 他们如何通过 modrewrite 传递 URL？

> ID：831355
> 
> 赞同：4
> 
> 时间：2009-05-06T19:40:23.867
> 
> 标签：php, mod-rewrite

使用新的 Diggbar，您可以将`http://digg.com`您当前所在的任何 URL 放在前面，它会创建一个 Digg 短 URL。我只是假设他们通过 modrewrite 做到这一点（尽管我不确定，因为我是新手）。

这是怎么做到的？在我看来，当我在我正在开发的网站上尝试这个时，它会爆炸。

我希望能够做到以下几点：

```
http://example.com/http://stackoverflow.com/question/ask 
```

并有一个 modrewrite 允许这个去

```
http://example.com/index.php?url=http://stackoverflow.com/question/ask 
```

但是当我使用这个 modrewrite 时：

```
RewriteEngine on
RewriteRule ^([A-Za-z0-9]+)$ /message.php?id=$1 [L] 
```

它不起作用。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-15T14:27:37.697

您必须从[请求行](http://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html#sec5.1)中获取值，因为 Apache 会删除空路径段。最初请求的 URI 路径`/http://foobar/`变为`/http:/foobar/`. 但请求行 ( `THE_REQUEST`) 保持不变：

```
RewriteCond %{THE_REQUEST} ^GET\ /(https?://[^\s]+)
RewriteRule ^https?:/ index.php?url=%1 [L] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T19:48:37.437

您只是在该正则表达式中查找字母和数字，因此它不会拾取冒号和斜杠。您还在示例中使用 index.php 并在 htaccess 中使用 message.php ;)

你可能会想要这样的东西：

```
RewriteEngine on
RewriteRule ^http://(.+)$ /index.php?url=$1 [L] 
```

这样可以确保您只在此处捕获 URL，并且您仍然可以拥有常规页面！（想想如果你访问 example.com/index.php 会发生什么，你最终会陷入无限循环。）

# xml - Flash 使用 AJAX 或其他动态数据请求，目前的最新技术是什么？

> ID：831358
> 
> 赞同：0
> 
> 时间：2009-05-06T19:41:02.977
> 
> 标签：xml, ajax, flash, xmlhttprequest

我正在为一个主要使用 Flash 作为前端的站点的后端进行初始设计工作。我自己不是 Flash 开发人员，我不关心支持或反对 Flash 的一般评论。我想知道的是：

与服务器通信以使用动态内容的当前最新技术是什么？AJAX 是一种选择吗？首选哪些其他技术，例如获取远程 XML？杰森？有警告吗？谁能指出我的最佳实践指南？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T20:25:57.673

有许多不同的方法，包括您已经提到的所有方法。当然，您的选择将取决于后端使用的语言。

看看 AMF，ActionScript 自己的传输协议。该协议适用于大多数大型服务器平台，包括 Adob​​e 自己的 BlazeDS (Java)，以及大量成熟的第三方解决方案。有关更多信息，请参阅以下链接：

[http://theflashblog.com/?p=414](http://theflashblog.com/?p=414)
[http://en.wikipedia.org/wiki/Action_Message_Format](http://en.wikipedia.org/wiki/Action_Message_Format)

# php - 如何从 PHP 中的字符串中删除一个字符？

> ID：831362
> 
> 赞同：0
> 
> 时间：2009-05-06T19:41:56.093
> 
> 标签：php, string, character-encoding

如何从 PHP 中的字符串中删除一个字符？

$s = "waseem";

有没有像 delChar($s , 2); 这样的函数 ? 其中 2 是 Character 的索引，我搜索但没有找到任何东西。有任何想法吗 ？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T19:43:23.407

[substr_replace](http://ie2.php.net/manual/en/function.substr-replace.php)是你想要的。

```
$s = substr_replace($s, '', 2, 1); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T19:45:11.127

```
$s[2] = ''; 
```

# optimization - 对三种优化技术感到困惑

> ID：831363
> 
> 赞同：0
> 
> 时间：2009-05-06T19:41:58.747
> 
> 标签：optimization, compiler-construction

1.  你如何准确地执行“共同”？
2.  Kleene 不动点定理如何帮助优化？
3.  在用非函数式语言编写的程序中，如何从局部函数定义中消除自由变量？

编辑：这些不是我的作业问题。我在我的暑假。

EDIT2：嗯，我刚刚开始研究编译器优化并且没有我想要优化的特定代码。您能否告诉我可以使用上述三种优化技术的一般方法是什么，或者至少告诉我可以正确解释它们的资源？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T03:45:21.800

1.  共用是通过自下而上的散列来完成的。
2.  Kleene 定理允许编译器实现递归方程的迭代解决方案，以提供有关程序的事实。一个简单的事实示例是，在某个点上，变量`i`始终等于 0。
3.  如果您有一个局部函数，其中的自由变量在封闭函数中是 let-bound 或 lambda-bound，那么根据定义，您正在处理一种具有一流函数的语言。自由变量通常由闭包转换处理，尽管一些编译器使用 lambda-lifting。

推荐的搜索词：

*   自下而上的散列
*   公共子表达式消除
*   迭代数据流分析
*   数据流优化变得简单
*   延续传递，闭包传递风格
*   闭包转换
*   拉姆达提升

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T23:33:31.450

最后一个问题的答案： [http ://en.wikipedia.org/wiki/Lambda_lifting](http://en.wikipedia.org/wiki/Lambda_lifting)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T21:32:12.430

[http://groups.google.com/group/comp.lang.scheme/browse_thread/thread/ac55fd7d73a5fdb4#](http://groups.google.com/group/comp.lang.scheme/browse_thread/thread/ac55fd7d73a5fdb4#)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T20:16:06.653

这些是我在网上找到的，如果有人可以访问更多信息，请回复。

William Clinger 教授上述两种技术，并在他的课堂上研究更有趣的技术： [http ://www.ccis.neu.edu/home/will/csg262_fall2004/syllabus.html](http://www.ccis.neu.edu/home/will/csg262_fall2004/syllabus.html)

这些人正在使用 Kleene 代数进行数据流分析。我想我们可以用它来优化编译器：http://ieeexplore.ieee.org/Xplore/login.jsp?url=http: [//ieeexplore.ieee.org/iel5/4159639/4159640/04159673.pdf%3Fisnumber% 3D4159640%26prod%3DCNF%26arnumber%3D4159673%26arSt%3D201%26ared%3D210%26arAuthor%3DFernandes%252C%2BT.&authDecision=-203](http://ieeexplore.ieee.org/Xplore/login.jsp?url=http://ieeexplore.ieee.org/iel5/4159639/4159640/04159673.pdf%3Fisnumber%3D4159640%26prod%3DCNF%26arnumber%3D4159673%26arSt%3D201%26ared%3D210%26arAuthor%3DFernandes%252C%2BT.&authDecision=-203)

不幸的是，上述论文需要登录。

这是我发现的关于共享的（但没有多大帮助）： http: [//www.patentsurf.net/7,516,448](http://www.patentsurf.net/7,516,448)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T20:41:25.503

诺曼的好回答。（我只是希望你的教授不要混淆编译器可能做的优化和软件程序员可能做的优化。后者不是一个技术主题，所以没什么可说的，但在实际应用中它是数量级更重要。）

# ruby - Ruby 中的 class() 与 type()

> ID：831380
> 
> 赞同：41
> 
> 时间：2009-05-06T19:43:46.510
> 
> 标签：ruby, syntax

Ruby 中的类方法和类型方法有什么区别？我注意到 type 可以找到某些类的类型，但不能找到其他类的类型。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-05-06T19:48:09.950

主要区别在于`Object#type`已弃用。来自 Object#type 的 RDoc：

> 不推荐使用 Object#class 的同义词。

这就是您应该使用的原因`Object#class`：

> 返回 obj 的类，现在优先于 Object#type，因为 Ruby 中的对象类型仅松散地与该对象的类相关联。此方法必须始终使用显式接收器调用，因为 class 也是 Ruby 中的保留字。

实际上，`Object#respond_to?`在大多数情况下，您可能希望使用而不是检查对象的类。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-05-06T19:45:49.330

`#type`是 的同义词`#class`，但它在 ruby​​ 1.8 中已被弃用，并且显然已从 ruby​​ 1.9 中消失。`#class`随处使用。

```
# 对于红宝石 1.8

$ ri 对象#type
-------------------------------------------------- ---------- 对象#type
     obj.type => 类
-------------------------------------------------- ----------------------
     不推荐使用 Object#class 的同义词。

# 对于红宝石 1.9

$ ri1.9 对象#type
对 Object#type 一无所知

```

# unit-testing - 在单个测试中检查几个不同的示例输入？

> ID：831390
> 
> 赞同：24
> 
> 时间：2009-05-06T19:45:46.117
> 
> 标签：unit-testing, tdd, nunit

假设我想编写一个使用正则表达式验证电子邮件地址的函数。我写了一个小测试来检查我的功能并编写实际功能。让它通过。

但是，我可以想出一堆不同的方法来测试相同的功能（test@test.com；test234@test.com；test.test.com 等）。

我是否将需要检查的所有咒语放入具有多个 ASSERTS 的同一个测试中，还是为我能想到的每一件事编写一个新测试？

谢谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-06T19:49:34.750

大多数测试框架现在都支持某种基于数据的测试，让您可以在多个数据集上运行相同的测试。

请参阅 NUnit 中的[ValuesAttribute](http://www.nunit.org/index.php?p=values&r=2.5)。

xUnit.net、MBUnit 等也有类似的方法。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-09T01:39:20.547

通常我会创建许多不同的测试，并给每个测试起自己的名字。例如，假设有 3 个不同的正则表达式 {A、B 和 C} 用于匹配电子邮件地址。该函数检查传入的电子邮件是否匹配并接受找到的第一个匹配项。

我将进行以下测试。

*   ATypeEmailShouldMatchPatternA
*   BTypeEmailShouldMatchPatternB
*   CTypeEmailShouldMatchPatternC
*   BadEmailShouldNotMatchAnyPattern
*   电子邮件与模式 A 兼容且模式 B 应由 A 匹配
*   电子邮件与模式 A 和 CS 应由 A 匹配
*   电子邮件与模式 B 和 C 兼容应该由 B 匹配

通常我会在每个测试中放置一个断言。

*但是，有时，如果*断言都检查同一事物的不同部分，我会在测试中放置多个断言。例如，假设我有一个函数可以查找与模式 A 匹配的所有电子邮件。我的测试提供了一个电子邮件列表，但只有一个与模式 A 匹配。该函数返回一个列表，我希望该列表中只有一个元素它。所以我要断言两件事：

1.  列表中有一个元素。
2.  一个元素是与模式 A 匹配的电子邮件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-27T05:56:30.887

正如@Paul 提到的几个测试框架支持 RowTests。使用该功能，您可以编写像这样可怕的东西：

```
[TestCase ("test@test.com", true)]
[TestCase ("x!x@test.com", true)]
[TestCase ("x#x@test.com", true)]
[TestCase ("x$x@test.com", true)]
[TestCase ("x%x@test.com", true)]
[TestCase ("x&x@test.com", true)]
[TestCase ("x'x@test.com", true)]
[TestCase ("x*x@test.com", true)]
[TestCase ("x+x@test.com", true)]
[TestCase ("x-x@test.com", true)]
[TestCase ("x/x@test.com", true)]
[TestCase ("x=x@test.com", true)]
[TestCase ("x?x@test.com", true)]
[TestCase ("x^x@test.com", true)]
[TestCase ("x_x@test.com", true)]
[TestCase ("x`x@test.com", true)]
[TestCase ("x{x@test.com", true)]
[TestCase ("x{x@test.com", true)]
[TestCase ("x|x@test.com", true)]
[TestCase ("x}x@test.com", true)]
[TestCase ("x~x@test.com", true)]
[TestCase ("test", false)]
[TestCase ("", false)]
[TestCase (null, false)]
public void IsEmail_Should_Match_Valid_Email_Addresses(string target, bool result)
{
    Assert.AreEqual(result, target.IsEmail());
} 
```

或者你可以对一堆断言做同样的事情。在执行某些操作后，在一个对象上声明多个属性是很常见的。我认为上述解决方案更具可读性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T19:51:33.590

如果不同的咒语真的归结为同一件事，那不是问题。

但是，如果其中一个电子邮件地址突然破坏了测试，您将不得不调试以找出哪个案例出错了。所以这似乎是分手的一个很好的理由。

你最终会得到数百万个单元测试，这是正确的，因为它们毕竟是在测试你的应用程序的一个单元，但在实践中，如果失败的断言破坏测试的方式不会弄乱，则多个断言会起作用失败的意义。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-16T22:57:03.337

BDD 和/或上下文/规范框架[（如 SubSpec）恰好有一些突出的示例](http://haacked.com/archive/2008/08/24/introducing-subspec.aspx)通过将每批相关断言视为一个单独的观察块来管理这一点，一个单独的观察块给它一个名称或描述性标签。

这推动一个好的测试的关键要素是：

1.  您对每个阶段都有 AAA / GWT 分离 - 您被迫*真正*考虑哪个是哪个 [并且通常会很快意识到什么时候需要进一步分解]
2.  你最终得到了关于观察的好名字/描述（行测试通常给你留下[不太可维护的]评论）
3.  当 24 个测试中的 10 和 17 [与行测试一样] 时，您将获得每个测试的状态，以帮助您缩小解决方案的范围

在某些情况下，当您确实在做一个简单的基于表格或矩阵的事情时，行测试可能是合适的。

此外，xUnit.net 的 PropertyData 在某些情况下可能是强大且合适的，可以作为其他答案中的一些技巧的一种方式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T19:50:04.500

我认为您不应该为每个案例编写单独的测试，因为所有案例都与测试字符串是否正确的电子邮件地址有关。如果您使用 MbUnit 或 NUnit 运行测试，那么您可以使用 RowTest 和 Row 属性将不同的值传递给测试。另一种方法是将所有不同的电子邮件格式存储在一个数组中，然后遍历该数组并执行断言。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T19:52:07.817

如果您正在测试相同的功能，我会在同一个测试中使用多个断言检查它们，前提是您的测试足够简单。

有些人主张每个测试都必须只有一个断言，因为测试必须非常、非常、非常简单。

如果测试不简单，假设你有循环和 ifs，你需要对测试本身进行测试，以检查其逻辑是否正确，这是不好的。

如果您的测试有多个断言，但仍然很简单（没有循环，没有 ifs）**并且**多个断言正在测试同一件事，那么我不会那么*积极*地提倡“每个测试一个断言”。这是你的选择。

# graphics - 使用 .NET Compact Framework 交换图像中任何给定两种颜色的有效方法

> ID：831393
> 
> 赞同：0
> 
> 时间：2009-05-06T19:46:08.720
> 
> 标签：graphics, windows-mobile, compact-framework

有没有一种有效的方法来拍摄和成像，并能够使用 .NET Compact Framework 将给定颜色替换为另一种给定颜色？

例如，用黑色代替白色，反之亦然？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T07:24:56.327

使用 Imaging API，您可以获得 IBitmapImage、锁定图像数据位、通过 BitmapData* 循环位并更改您选择的像素。

编辑：我刚刚注意到 NETCF 标签，但我留下这个答案供参考。

# c++ - Visual C++ 2008 Express 项目的构建过程

> ID：831394
> 
> 赞同：0
> 
> 时间：2009-05-06T19:46:38.657
> 
> 标签：c++, visual-studio, visual-studio-2008, winapi

我有一个 VS 2008 C++ 项目，其中包含一个非常小且简单的代码文件。我需要编写一个应用程序来生成此文件并将项目构建到 Win32 DLL 中。我需要将免费的编译器等与应用程序一起提供给我的客户，所以我无法自动化 VS 来执行此操作。

我最好怎么做？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T20:11:22.640

VS 2008 Express 安装命令行编译器（实际上安装程序有一个选项，所以你只能得到命令行的东西）。所以得到一个免费的编译器是没有问题的。

如果您真的只需要将单个文件构建到 DLL 中，使用 '/LD' 选项的 cl 命令应该足以解决问题（尽管您可能至少需要几个其他选项）。

如果您想看中，我不确定 Express SKU 是否包含 nmake.exe（但我想它确实包含）。

# c# - 如何比较两个数据集是否相等

> ID：831395
> 
> 赞同：1
> 
> 时间：2009-05-06T19:47:09.233
> 
> 标签：c#, .net, ado.net

我有两个数据集，每个数据集都有一个从不同来源提取的数据表，我需要知道数据表中包含的数据是否有任何差异。我试图避免循环和比较每个单独的记录或列，尽管可能没有其他方法。我只需要知道数据是否有差异，我不需要知道任何差异的细节。

我已经尝试了下面的代码，但似乎 dataset.Merge 不会更新 rowstatus 所以 dataset.HasChanges() 总是返回 false。任何帮助表示赞赏：

```
var currentDataSet = GetSomeData();
var historicalDataSet = GetSomeHistoricalData();

historicalDataSet.Merge(currentDataSet);

if (historicalDataSet.HasChanges()) DoSomeStuff(); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T20:35:07.620

我不知道对此有任何内置支持，我也不指望它。所以你必须以某种方式自己做这件事。

最明显的方法是蛮力，逐表逐行的方法。

如果您可以依赖某些因素是相同的，即完全相同的命名、记录的顺序等，那么您可以测试是否将两者保存为 XML 并比较结果是否是一个有效的技巧。

# sql - 优化 SQL 存储过程

> ID：831397
> 
> 赞同：0
> 
> 时间：2009-05-06T19:47:41.713
> 
> 标签：sql, optimization, stored-procedures, select

在大型表上运行 SELECT 的存储过程超时。where 子句导致超时，因为我只选择另一个表中的城市。

```
AND city IN (SELECT DISTINCT city from tOH where clientId = @clientId)
AND state IN (SELECT DISTINCT state from tOH where clientId = @clientId) 
```

*注意几乎总是只返回一个状态

我正在尝试将城市放入表中，然后使用该表填充城市，但我收到一个错误，即未声明 @cities。

```
DECLARE @cities TABLE
(
city varchar(200)
);
INSERT INTO @cities (city) SELECT city FROM tOH WHERE clientId = @clientId GROUP BY city 
```

然后我的 where 子句更改为

```
AND city IN (SELECT city from @cities) 
```

谁能想出一个优化这个存储过程的好方法？

- - - - - - - - - - - - - - 更新 - - - - - - - - - - - ---------------

连接都太慢了。我认为带有临时表或表变量的解决方案会起作用。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T19:57:40.130

它不仅慢，而且*不正确。*

假设您的城市是“Evansville, WI”，但您的`tOH`表格中只有“Evansville, IN”和“Milwaukee, WI”的条目。您目前分别检查城市和州部分，因此您现有的查询将找到“Evansville”和“WI”的匹配项。它将允许那个城市，即使它真的不应该。

改为这样做：

```
INNER JOIN 
  ( 
    SELECT DISTINCT City AS tOHCity, State AS tOHState 
    FROM tOH 
    WHERE ClientID= @ClientID 
  ) cs ON cs.tOHCity = city AND cs.tOHState = state 
```

请注意，子查询基于这样的假设，即原始帖子中的 DISTINCT 是必要的，因为每个客户端的该表中可能有多个相同的城市。如果不是这种情况，您可以直接加入`tOH`表。

将此与适当的索引结合起来，您应该会很好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T19:51:38.443

我会在 tOH 表上尝试 JOIN 并通过 clientid 过滤整个查询。您还可以使用 SELECT INTO 将其放入临时表中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-06T19:54:19.060

来自 SQL 黑客：

> 当子查询不包含聚合函数时，您可能不需要子查询 - 您需要 JOIN。

因此，您应该将您的第一个子查询 (AND CITY IN) 转换为 JOIN。除非您向我们提供查询的其余部分，否则我们将无法准确向您展示如何操作，但其基础是将 City 添加为您在主查询中选择的表。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-06T20:14:13.613

我认为指出感知超时背后的原因可能是值得的。您的查询从原始表中选择每条记录，然后对于它选择的每条记录，它必须为每条记录一遍又一遍地子查询同一表中的 DISTINCT 城市列表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T19:52:46.147

您可能想考虑在 State 列上放置一个索引，但您应该对此进行一些基准测试。插入新行时，您必须权衡索引的好处与成本。

您可能还希望对 City 列执行相同的操作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-06T19:53:29.873

使用 EXISTS 而不是 IN

```
AND EXISTS(SELECT 1 FROM tOH WHERE tOH.city=main.city AND clientId=@clientId) 
```

您还需要确保该城市在两个表中都有索引。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-06T19:57:22.000

您可能已经尝试过，但我的第一反应是使用您的城市填充临时表。这可能是你正在做的，我只是不熟悉语法，但我一直使用：

```
Create Table #Cities(City varchar(200)) 
```

然后，您将填写临时表并从中查询，如您的示例（INSERT INTO... 和 AND city IN（SELECT city from #Cities））

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-06T20:47:53.783

我假设 tOH 上 DISTINCT 的原因是一个城市名称可能存在于多个州，同样，一个州也有多次出现，因为每个州都有多个城市。

如果每个城市和州的组合都是唯一的事件，那么删除 DISTINCT 并执行以下操作会更合适且更具成本效益：

```
select mytable.* 
from mytable m
inner join tOH t on  t.clientid = @clientId 
    and t.city = m.city and t.state = m.state 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-06T19:56:29.210

```
select ....
from ....
    inner join tOH ON ...city=tOH.city and ...state=tOH.state
where ... and tOH.clientId = @clientId 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-06T20:33:22.710

为了回答您为什么 @cities 作为表变量可能不起作用的问题，您没有展示 sp 的其余部分，但我会在某个地方构建动态 SQL 并执行它。这将超出先前存在的表变量的范围。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-06T20:34:28.637

您可以使用原始查询（没有连接），进行下一个更正：

1.  通过 clientID、城市、州在 TOH 上创建索引
2.  删除 DISTINCT 关键字 - 这允许优化器有效利用该索引

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-06T20:35:39.570

将您的 IN 过滤器更改为存在。所以而不是：

```
AND city IN (SELECT DISTINCT city from tOH where clientId = @clientId)
AND state IN (SELECT DISTINCT state from tOH where clientId = @clientId) 
```

将其更改为：

```
AND EXISTS ( 
      SELECT 0 FROM tOH t WHERE 
      ClientID = @clientId 
      and t.City = parent.ctiy 
      and t.state = parent.state 
) 
```

我做过性能测试，一直发现 EXISTS 的性能比 IN 快。此外，由于您在同一张桌子上做了两次，所以您受到了双重打击。

如果可能，您还应该在 tOH 中索引城市和州。索引是一个让步，因此请确保您了解添加它们的含义。

# django - Django 中的 ModelForms，其中底层模型依赖于另一个模型（通过 OneToOneField）

> ID：831410
> 
> 赞同：4
> 
> 时间：2009-05-06T19:50:11.880
> 
> 标签：django, django-models, django-forms, dependencies

我的 Django 应用程序中有两个模型，用于存储用于某些同源搜索程序的搜索参数：

```
# models.py
class Search(models.Model):
    """A class to represent search runs."""

    program = models.CharField(max_length=20)
    results_file = models.FileField(
        upload_to=(SEARCH_RESULTS_DIR)
    )
    timestamp = models.DateTimeField()

    def __unicode__(self):
        return u'%s %s' % (self.program, self.timestamp)

class FastaRun(models.Model):

    search = models.OneToOneField('Search', primary_key=True)
    # the user-input FASTA formatted protein sequence
    query_seq = models.TextField()
    # -b "Number of sequence scores to be shown on output."
    number_sequences = models.PositiveIntegerField(blank=True)
    # -E "Limit the number of scores and alignments shown based on the
    # expected number of scores." Overrides the expectation value.
    highest_e_value = models.FloatField(default=10.0,
            blank=True)
    # -F "Limit the number of scores and alignments shown based on the
    # expected number of scores." Sets the highest E-value shown.
    lowest_e_value = models.FloatField(blank=True)
    mfoptions = [
            ('P250', 'PAM250'),
            ('P120', 'PAM120'),
            ('BL50', 'BLOSUM50'),
            ('BL62', 'BLOSUM62'),
            ('BL80', 'BLOSUM80')
    ]
    matrix_file = models.CharField(
            max_length=4,
            choices=mfoptions,
            default='BL50'
    )
    database_option = models.CharField(
            max_length=25,
            choices=BLAST_DBS,
            default=INITIAL_DB_CHOICE
    )
    ktupoptions = [(1, 1), (2, 2)]
    ktup = models.PositiveIntegerField(
            choices=ktupoptions,
            default=2,
            blank=True
    ) 
```

注意这里`FastaRun`是一种`Search`. `FastaRun`扩展搜索，因为为 a 定义了更多参数`FastaRun`。A`FastaRun`必须有一个`Search`与之链接的实例，并且该`Search`实例是 的主键`FastaRun`。

我有一个`ModelForm`班级`FastaRun`。

```
# views.py
class FastaForm(forms.ModelForm):

    class Meta:
        model = models.FastaRun 
```

我有一个视图函数，我需要使用它来填充`FastaForm`和保存一个新`Search`实例以及`FastaRun`基于用户提交的表单的一个新实例。该表单不*包括*选择`Search`实例的选项。这是不可能的，因为该`Search`实例只有在用户实际提交此搜索后才能存在。

以下是该函数需要执行的操作的概述：

```
# also in views.py
def fasta(request, ...):
    # populate a FastaForm from the information POSTed by the user--but
    # how to do this when there's no Search information coming in from
    # the user's request. We need to create that Search instance, too,
    # but we also have to...

    # validate the FastaForm
    # ... before we can ...

    # create a Search instance and save() it

    # use this saved Search instance and give it to the FastaForm [how?]

    # save() the FastaForm [save the world]

    pass 
```

因为`Search`and `FastaRun`(and因此`FastaForm`) 交织在一起，我觉得我正在进入 Catch-22。我需要保存一个`Search`实例，其参数存储在 POST 请求中，但必须使用`FastaForm`'s 验证来验证其参数。但是，我认为在`FastaForm`实例化实例之前无法实例化`Search`。`Search`然而，在我使用...验证之前，我无法实例化 实例`FastaForm`。你明白了。

我在这里想念什么？必须有一种相当干净的方法来做到这一点，但我看不清楚。

另外，如果我错了，请纠正我，但是只要模型之间存在某种关系（例如，还有 for`ForeignKey`和`ManyToMany`字段），就可能发生同样的依赖情况。因此，肯定有人想到了这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T22:27:56.297

在这种情况下，我会使用继承来解决这个问题：

```
# models.py
class Search(models.Model):
    """A class to represent search runs."""
    ...

class FastaRun(Search):
    # one-to-one field has been removed
    .... 
```

现在，`FastaRun`根据定义实例化 a 也是实例化 a `Search`。Django 也正确处理了数据库方面的问题，方法`FastaRun`是为`Search`. 您的验证应该与表单按预期工作。如果您要对对象进行任何查询，您可能想要添加的唯一一件事就是`Search`添加一个类型字段，`Search`该字段被所有子类覆盖，因此您可以过滤掉这些结果。

# c# - 如何将 C# .NET TextReader 光标重置回起点？

> ID：831417
> 
> 赞同：25
> 
> 时间：2009-05-06T19:51:08.990
> 
> 标签：c#, .net, file

我有一个方法，它采用一个`StringReader`实例（从剪贴板读取）或一个`StreamReader`实例（从文件读取），目前，将其中一个转换为`TextReader`实例。

我需要它来“预读”一些源输入，然后将光标重置回起点。我不一定有原始文件名。我该怎么做？

提到了 of 的`Seek`方法，`System.IO.Stream`但这并没有在 中实现`TextReader`，尽管它是`StreamReader`通过`Basestream`属性实现的。但是`StringReader`没有`BaseStream`属性

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-06T19:54:46.970

这取决于`TextReader`. 如果是`StreamReader`，您可以使用：

```
sr.BaseStream.Position = 0;
sr.DiscardBufferedData(); 
```

（当然，假设底层流是可搜索的。）

的其他实现`TextReader`可能没有*“*倒带”的概念，同样的方式`IEnumerable<T>`没有。在很多方面你可以认为`TextReader`是荣耀的`IEnumerable<char>`。它具有一次读取整个数据块、读取行等的方法，但它基本上是一种“正向读取”类型。

编辑：我不相信`StringReader`支持任何形式的倒带 - 如果可以的话，你最好`StringReader`从原始字符串重新创建。如果这不可行，您总是可以创建自己的`TextReader`类来代理对 another 的所有“正常”调用`StringReader`，但在需要时重新创建该代理实例。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-06T19:55:27.013

如果它是 a `StreamReader`，并且*该*流支持查找，则：

```
 reader.BaseStream.Seek(0, SeekOrigin.Begin);
        reader.DiscardBufferedData(); 
```

`TextReader`但是，这在任意s上是不可能的。您也许可以将其全部读取为字符串，然后可以`StringReader`重复使用？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-04T13:49:46.660

我看到了你的帖子，很失望这是不可能的。我快速破解了一些可行的方法：完全避免使用字符串阅读器：

```
Stream stream = new MemoryStream((new System.Text.ASCIIEncoding().GetBytes(mystring)), false);
reader = new StreamReader(stream, new System.Text.ASCIIEncoding()); 
```

它不漂亮，而且它使用 ASCII（这正是我所需要的）。请注意，使用不同的编码这将不起作用，因为您将寻找不等于第 n 个字符的第 n 个字节。如果你确实需要，你可以做类似的事情

```
Stream stream = new MemoryStream((new System.Text.UTF32Encoding().GetBytes(mystring)), false);
reader = new StreamReader(stream, new System.Text.UTF32Encoding()); 
```

因为 UTF32 是唯一固定长度的 unicode 格式。

你现在可以做

```
reader.BaseStream.Position = wherever; // or wherever * 4 for the UTF32 variety,
                                       // in your case, the beginning of the string,
                                       // which is always 0 obviously
reader.DiscardBufferedData(); 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-05-06T19:52:51.340

寻找，你们就会找到。

```
Seek(0, SeekOrigin.Begin); 
```

`TextReader`源自`StreamReader`。 `StreamReader`包含一个`BaseStream`属性

# javascript - 如何使用 javascript 将相对 href 属性转换为绝对路径？

> ID：831418
> 
> 赞同：4
> 
> 时间：2009-05-06T19:51:33.420
> 
> 标签：javascript, jquery, html, url

我有一个从外部供应商那里截屏的模板，需要在导航中包含绝对路径，这样外部托管的内容才能正确链接回我们的网站。

现在页面/模板由我们的后端开发人员编写的全局菜单应用程序驱动......所以任何更新我们网站的人都会进入并更改菜单及其路径......

现在所有的链接都链接到返回根的相对路径。

例如

```
<a href="/">Home</a>
<a href="/news/">News</a>
<a href="/media/">Media</a>
<a href="/other/">Other</a> 
```

我需要一种简单的方法（最好使用 jquery）将“ [http://www.domain.com](http://www.domain.com) ”添加到每个链接。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T20:39:42.837

请注意，jQuery 对象 $("a").attr("href") 不等于 $("a").get(0).href ？

```
$("a").each(function() {
   alert(this.href);
   $(this).attr("href") = this.href;
}); 
```

在你的情况下，这可能对你没有帮助，因为你想要静态标记，javascript 生成动态内容。但在这种情况下，您似乎需要静态标记，它必须由服务器发出。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T20:09:09.820

```
$('a').attr('href', 'http://www.domain.com'+$(this).attr('href')); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T19:59:09.970

我不建议使用 javascript 来解决这个问题。这应该在页面模板中解决。但是，如果您仍然想要一个 jquery 解决方案，那么就可以了。假设这些链接具有将它们与内部链接区分开来的特定类：

```
$('a.external').each(function() {
    $(this).attr('href', domain_name + $(this).attr('href'));
}) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-13T08:12:50.170

这么简单的功能你不需要 jquery....

```
var elements = document.getElementsByTagName("a");
var eachLink;
for (eachLink in elements) {
 var relativeLink = eachLink.href;
 var absoluetLink = ["http://",domainName,"relativeLink"];
 eachLink.href = absoluteLink.join("");
} 
```

像这样的东西应该可以工作，它运行得更快，你不需要加载整个 jquery 库来运行 6 行代码：P

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-09-29T08:11:51.780

It's very simple:

```
$('a').each(function(){$(this).attr('href',this.href);}); 
```

When you read the href property of a [HTMLAnchorElement](http://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement), you get the absolute path, so you can overwrite it with attr() method of JQuery.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-07T21:41:18.887

I noticed that all the solutions here only work with href attributes that begin with a "/" character. If you want something more robust, you may want to try the [js-uri](http://code.google.com/p/js-uri/) library. It looks cool but I haven't tried it myself so I don't know how buggy it is.

# javascript - 使用正则表达式匹配图像标签

> ID：831435
> 
> 赞同：1
> 
> 时间：2009-05-06T19:54:42.880
> 
> 标签：javascript, regex, replace

我在使用这个正则表达式时遇到了一些问题：

```
<img(.+)src="_image/([0-9]*)/(.+)/> 
```

全局和不区分大小写的标志打开。

问题是它还抓取了 Image n （见下面的字符串），但我希望它只匹配字符串中的图像标签。

```
<p>Image 1:<img width="199" src="_image/12/label" alt=""/> Image 2: <img width="199" src="_image/12/label" alt=""/><img width="199" src="_image/12/label" alt=""/></p> 
```

如果我在 Image n 之前放一个换行符，它会起作用 :)

谁能为我指出我做错了什么？

提前谢谢鲍勃

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T19:59:22.277

使用非贪婪的正则表达式：

<img . *? src="_image/(\d+)/(.+?)/.* ?>

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T20:31:53.853

如果我正确解释您的正则表达式，看起来您在第一组中的目录名称和第二组中的文件路径之后？

```
<IMG.*?SRC="/_image/(\d+?)/([^"]*?)".*?/> 
```

不要忘记使用正则表达式选项 CaseInsensitive，它用 (?i:[regex]) 包装正则表达式

在第二组中，您正在解析所有不是结束引号的内容，现在您正在查找所有字符，实际上，您不需要搜索所有字符，您需要所有不是结束引号的内容在弦上。

另外，不要忘记关闭您丢失的 SRC 字符串，并且 SRC 属性可能不是标签中的最后一个 - 例如边框、宽度、高度等。此外，后面可能有任意数量的空格最后一个属性的闭包和标签 /> 的结束

从这个正则表达式中，您的第一个匹配组将保存子目录名称，第二个匹配组将保存子目录 / 之后的所有内容 - 包括嵌套子目录。如果你有嵌套的子目录，你可能需要稍微扩展一下：

```
<IMG.*?SRC="/_image/((\d+?)/)+?([^"]*?)".*?/> 
```

在这种情况下，每个前导组将保存每个嵌套目录名称，最后一组将保存文件名。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T19:56:56.543

您是否尝试过惰性评估？当我尝试类似的事情时，这曾经奏效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T20:02:09.370

正则表达式根本不擅长解析 HTML（请参阅[您能否提供一些示例，说明为什么用正则表达式解析 XML 和 HTML 很困难？](https://stackoverflow.com/questions/701166)为什么）。您需要的是一个 HTML 解析器。请参阅[您能否提供一个使用您最喜欢的解析器解析 HTML 的示例？](https://stackoverflow.com/questions/773340)对于使用各种解析器的示例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T20:06:38.767

您正在使用*贪婪*的量词 (+)，没有太多限制。一个贪婪的量词告诉正则表达式引擎：“抓住每一个符合条件的字符，只退到足以完成正则表达式的程度。” 这意味着它将从字符“image/ *nnnnnn* / *something* /”的第一个序列中获取。

# windows - 如何获取应用程序的活动子窗口？

> ID：831441
> 
> 赞同：1
> 
> 时间：2009-05-06T19:55:51.023
> 
> 标签：windows, keypress, sendmessage, childwindow

我有这个问题。我有一个特定应用程序主窗口的处理程序，我想模拟该应用程序上的按键...

我正在使用 sendMessage/postMessage api 调用来执行此操作。我不使用 .Net SendKeys 函数或 win32 api 的 keybd_event 的原因是它们在全局级别模拟按键。就我而言，我可能已将应用程序最小化，但仍希望模拟按键。

sendMessage 和 postMessage 的问题在于，您必须传递要按下键的确切子窗口的处理程序。例如，在记事本中，如果我将密钥发送到主窗口，没有任何反应，我必须将密钥发送到基本上由白色画布组成的子窗口，您可以在其中进行书写。

以 msPaint 为例，如果用户创建一个新文档，并在该绘图中打开一个文本框，并且我想在那里模拟按键，我必须获取主窗口的子窗口的子窗口才能使其工作。

所以我找到了一种似乎适用于所有情况的方法，基本上，我使用带有参数 GW_CHILD 的 getWindow 来获取具有最高 z 值的子窗口。然后我为子窗口再次执行此操作并继续执行此操作，直到某个 childWindow 没有更多 childWindows..

它似乎奏效了，我很高兴！

但是......我发现这不起作用的情况。火狐就是其中之一。Firefox 有 mainWindow，然后有一个与 mainWindow 几乎相同的 childWindow，然后它还有另一个 childWindow，即网站区域，即地址栏和菜单下方的区域。例如，如果我在 www.google.com 上，并且我想在焦点搜索框中模拟按键，它会起作用，因为获取子窗口的子窗口会给我正确的 childWindow。但是，例如，如果用户单击地址栏，getWindow 的工作方式不会发生任何变化。它最终仍然会得到地址栏下的子窗口，什么都不做，而不是模拟地址栏上的按键。

问题是我还没有找到获取某个应用程序的活动子窗口的方法。我只能使用GetWindow方法来获取某个窗口的子窗口，直到找到没有子窗口的子窗口。但是，正如您在 firefox 案例中看到的那样，活动窗口实际上是我最终得到的子窗口的父级。

我尝试过其他 api 调用，如 getTopWindow 但我没有运气..

任何人都可以对这个问题有所了解吗？谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T20:43:02.063

您可以使用它`GetGUIThreadInfo`来获取有关特定进程的 UI 的信息。

如果您有主窗口，则可以调用`GetWindowThreadProcessId`以获取进程线程 ID。然后您可以调用`GetGUIThreadInfo`以获取有关活动/聚焦窗口等的信息。

我还必须指出，一些应用程序只有一个窗口，并且它的所有控件都是无窗口的（如 Windows Live Messenger）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:25:24.367

如果应用程序违反了窗口的窗口规则，您将需要一个例外。

在 Mozilla 中，它是这样的（IIRC）：

*   有这个类的“上帝”窗口，`MozillaUIWindowClass`在其窗口文本中带有“-Mozilla Firefox”字符串。
*   如果您知道地址栏的位置，您可以使用以下函数：

并提供`HWND`“上帝”窗口的位置和地址栏的位置。

```
HWND ChildWindowFromPoint(HWND, POINT); 
```

可能有一个更好的解决方案，我想出了这个，因为我需要自动化鼠标，这是基于位置的。

如需更多信息，您可能需要查阅特定软件的[来源](https://developer.mozilla.org/En/Mozilla_Source_Code_(CVS))，或在 Spy+ 中度过一整天。:>

# c++ - c++，使用 get 和 >> for ifstream

> ID：831445
> 
> 赞同：0
> 
> 时间：2009-05-06T19:56:39.350
> 
> 标签：c++

我有一个要从中输入数据的文本文件，但我似乎无法正确输入。

这里以文本文件中的两行为例（这些不是真实的人不要担心）：

```
Michael    Davidson     153 Summer Avenue        Evanston        CO 80303
Ingrid     Johnson      2075 Woodland Road       Aurora          IL 60507 
```

这是我必须加载文本文件并将数据放入结构的代码。我还是 C++ 的新手（显然），我很难同时使用 get 和 >>。我在下面的代码可以正常工作，直到我进入“状态”然后出现问题。谢谢您的帮助！

```
//constants
const int FIRST_NAME_LEN = 11;
const int LAST_NAME_LEN = 13;
const int ADDRESS = 25;
const int CITY_NAME_LEN = 16;
const int STATE_LEN = 3;

//define struct data types
struct CustomerType {
    char firstName[FIRST_NAME_LEN];
    char lastName[LAST_NAME_LEN];
    char streetAddress[ADDRESS];
    char city[CITY_NAME_LEN];
    char state[STATE_LEN];
    int zipCode;
};

//prototype function
ifstream& getInfo(CustomerType& CT_Struct, ifstream& infile);

int main() {

    //declare struct objects
    CustomerType CT_Struct;

    ifstream infile("PGM951_customers.txt");
    if(!infile) {
        cerr << "Could not open the input file." << endl;
        exit(1); //terminates the program
    }

//call the function
getInfo(CT_Struct, infile);

return 0;
}

ifstream& getInfo(CustomerType& CT_Struct, ifstream& infile) {

    while(infile) {
        infile.get(CT_Struct.firstName, sizeof(CT_Struct.firstName));
        infile.get(CT_Struct.lastName, sizeof(CT_Struct.lastName));
        infile.get(CT_Struct.streetAddress, sizeof(CT_Struct.streetAddress));
        infile.get(CT_Struct.city, sizeof(CT_Struct.city));
        infile.get(CT_Struct.state, sizeof(CT_Struct.state));
        infile >> ws;
        infile >> CT_Struct.zipCode;    

        cout << CT_Struct.firstName << " | " << CT_Struct.lastName << " | " << CT_Struct.streetAddress  
            << " | " << CT_Struct.city << " | " << CT_Struct.state  << " | " << CT_Struct.zipCode << endl;
    }

return infile;

} 
```

=== 编辑 =========== 在 8 字符的状态下阅读只是我在胡闹，然后我忘了把它改回来......对不起。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T20:03:54.217

问题是其中有空格的`istream::get()`中断。`streetAddress`

一种方法是首先将输入行标记为 a `vector`of `strings`，然后根据标记的数量将它们转换为您的适当字段`CustomerType`：

```
vector<string> tokenize(string& line, char delim=' ') {
      vector<string> tokens;
      size_t spos = 0, epos = string::npos;
      while ((epos = line.find_first_of(delim)) != string::npos) {
          tokens.push_back(line.substr(spos, epos - spos));
          spos = epos; 
      }
      return tokens;     
} 
```

我宁愿使用流提取运算符`CustomerType`：

```
struct CustomerType  {
   friend istream& operator>>(istream& i, CustomerType& c);
   string firstName, lastName, ...;
   // ...
};

istream& operator>>(istream& i, CustomerType& c) {       
   i >> c.firstName >> c.lastName;
   string s1, s2, s3;
   i >> s1 >> s2 >> s3;
   c.streetAddress = s1 + s2 + s3;  
   i >> c.city >> c.state >> c.zipCode;
   return i;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T20:04:34.027

您将获得 8 个国家字符，其中包括您的所有邮政编码，并且大于您的字段。

使用运算符也很诱人`skipws`：

```
infile >> skipws >> CT_Struct.firstName
       >> CT_Struct.lastName 
       >> ... ; 
```

（更新：这就是我从记忆中得到的。这更接近正确。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T20:02:47.013

如果我是你，我会从头开始。我会：

*   为您的数据使用 std::strings 而不是字符数组
*   使用 std::getline 从文件中一次读取一行
*   使用字符串流解析队列
*   避免混合格式化和未格式化的输入

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T20:03:43.297

我对此的方法如下：

1) 将每一行读入一个空终止缓冲区。2) 使用你必须编写的 split() 函数。此函数应将字符串作为其输入并返回一个列表。它还应该带一个分隔符。在这种情况下，分隔符是 ' '。3）仔细遍历列表（从来没有中间名吗？） 1 个单词或 3 个单词的街道名称呢？由于这些列中的许多列的字数实际上是可变的，并且除了 whitspace 之外没有分隔符，因此这可能是一项相当艰巨的任务。如果你从来没有中间名，你可以假设前两列是名字和姓氏。你肯定知道最后两个是什么。它们之间的所有内容都可以分配给单个地址字段。

# c# - Response.OutputStream.Write 中的“远程主机关闭了连接”

> ID：831447
> 
> 赞同：24
> 
> 时间：2009-05-06T19:57:19.957
> 
> 标签：c#, asp.net, streaming

此代码将大文件流式传输给我们的用户：

```
 // Open the file.
            iStream = new System.IO.FileStream(filepath, System.IO.FileMode.Open,
                        System.IO.FileAccess.Read, System.IO.FileShare.Read);

            // Total bytes to read:
            dataToRead = iStream.Length;

            // Read the bytes.
            while (dataToRead > 0)
            {
                // Verify that the client is connected.
                if (Response.IsClientConnected)
                {
                    // Read the data in buffer.
                    length = iStream.Read(buffer, 0, 10000);

                    // Write the data to the current output stream.
                    Response.OutputStream.Write(buffer, 0, length);

                    // Flush the data to the HTML output.
                    Response.Flush();

                    buffer = new Byte[10000];
                    dataToRead = dataToRead - length;
                }
                else
                {
                    //prevent infinite loop if user disconnects
                    dataToRead = -1;
                }
            } 
```

每隔一段时间，我们就会收到这个异常：

```
The remote host closed the connection. The error code is 0x80072746 
```

这是完整的堆栈跟踪：

```
Stack Trace:
   at System.Web.Hosting.ISAPIWorkerRequestInProcForIIS6.FlushCore(Byte[] status, Byte[] header, Int32 keepConnected, Int32 totalBodySize, Int32 numBodyFragments, IntPtr[] bodyFragments, Int32[] bodyFragmentLengths, Int32 doneWithSession, Int32 finalStatus, Boolean& async)
   at System.Web.Hosting.ISAPIWorkerRequest.FlushCachedResponse(Boolean isFinal)
   at System.Web.Hosting.ISAPIWorkerRequest.FlushResponse(Boolean finalFlush)
   at System.Web.HttpResponse.Flush(Boolean finalFlush)
   at System.Web.HttpResponse.Flush()
   at System.Web.HttpWriter.WriteFromStream(Byte[] data, Int32 offset, Int32 size)
   at System.Web.HttpResponseStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at BIS.DocumentBus.Controls.DocumentViewer.StreamFile(String filepath) 
```

我们从未有证据表明用户在下载我们的文件时遇到问题，并计划简单地忽略此异常。

知道这个问题的根源是什么吗？忽略它是否安全？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-06T20:06:29.983

该异常意味着下载文件的客户端在文件完成下载之前断开了连接。即客户端导航到另一个页面，或者只是关闭了浏览器。

我可能会尝试`if (Response.IsClientConnected)`在您的`iStream.Read`. `OutputStream.Write`即使你这样做了，我认为如果在方法仍在工作时连接断开，我认为仍有可能收到此错误。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-09-16T22:42:05.683

这有几个不同的可能原因。我能想到三个：

一个是用接近 2GB 的数据填充缓冲区，但这里不应该是这种情况，因为您会定期刷新。

另一个确实是您之前接受的答案中描述的。它很难重现，所以我不认为它一定是错误的。

另一种可能的情况，我敢打赌的情况是，超过了 executionTimeout，这首先会导致 ThreadAbortException，但这反过来又会导致 Flush() 失败，这将变成异常

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-09-20T21:30:18.693

在 web.config 的 httpRuntime 元素中增加 executionTimeout。

如果用户在慢速连接上下载大文件，请求最终会超时。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-11-03T15:04:21.650

我发布这个答案是因为它可能会帮助其他人并节省一些重要的时间。

就我而言`Response.Buffer = true`，下载方法（在第一个语句中）解决了这个问题。

谢谢

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2022-02-25T19:35:03.210

我知道这是一个 C# 问题，但是在我的 iPad 上，当我将它连接到 Charles Proxy 时，我可以在触发网络呼叫时半一致地重现此问题，但随后会立即使应用程序后台运行。

我尽可能快地点击主页按钮来后台应用程序。我的总请求/响应时间大约需要 6 秒。

如果我在 1-2 秒内进行后台处理，响应通常会恢复正常。如果我在不到 0.5 秒内将应用程序后台化，那么请求通常会失败。我对 TCP 没有透彻的了解，但可能是 TCP 握手甚至没有完成，连接刚刚断开，因此出现错误消息。

这与[另一个答案](https://stackoverflow.com/a/5564892/5175709)相匹配：

> 我一直得到这个。这意味着用户开始下载文件，然后它要么失败，要么他们取消了它。

[![在此处输入图像描述](https://i.stack.imgur.com/1uasj.png)](https://i.stack.imgur.com/1uasj.png)

# nhibernate - 在 NHibernate / SQL Server 中自动截断字符串

> ID：831452
> 
> 赞同：4
> 
> 时间：2009-05-06T19:57:42.907
> 
> 标签：nhibernate

我在 SQL Server 2005 数据库中有一个 nvarchar(2000) 列，并将其映射到 NHibernate 为：

```
<property name="Query" column="`Query`" type="String" length="2000" not-null="false"/> 
```

DTO 类只提供一个字符串属性：

```
 public virtual string Query { get; set; } 
```

如果我将查询设置为超过 2000 个字符的字符串，我会从 SQL 服务器获得一个异常，其效果如下：

> “字符串或二进制数据将被截断。语句已终止。”

我想要的是让这种截断自动且无声地发生。我可以覆盖虚拟属性并强制截断属性集，但我觉得应该有一种方法可以默认获得这种行为，无论是通过 NHibernate 映射还是作为 SQL 服务器设置。

我错过了什么...我不想更改数据库架构以允许更长的字符串。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T20:03:39.583

创建一个自定义用户类型，如果字符串长度超过 2000 个字符，它会截断字符串。这是[创建用户类型的示例](http://www.lostechies.com/blogs/rhouston/archive/2008/03/23/mapping-strings-to-booleans-using-nhibernate-s-iusertype.aspx)

```
<property name="Query" type="Common.Nhibernate.Types.StringTruncType, Common" column="`Query`" type="String" length="2000" not-null="false"/> 
```

# vba - Excel VBA循环打开多个Word文件

> ID：831458
> 
> 赞同：0
> 
> 时间：2009-05-06T19:59:41.497
> 
> 标签：vba, excel, ms-word

对于新手问题，我提前道歉——我的大部分 VBA 经验都是在 Excel 或 Word 到 Excel 中。在这种情况下，我将从 Excel 转到 Word。我正在尝试从某些 Word 表单中捕获一些数据并将其存储在 Excel 文件中。

现在，我的代码适用于文件夹中的第一个文档，但在那之后，它会出现自动化错误“服务器引发异常”（哎呀！）

这是我的代码：

```
Dim objWordApp As Object

strCurFileName = Dir(strFilePath)

Set objWordApp = CreateObject("word.application")
objWordApp.Visible = True

Do While strCurFileName <> ""

    objWordApp.documents.Open strFilePath & strCurFileName
    objWordApp.activedocument.Unprotect password:="testcode"

    {EXCEL PROCESSING HERE}

    strCurFileName = Dir
    objWordApp.activedocument.Close 0

Loop

objWordApp.Quit
Set objWordApp = Nothing 
```

我注意到，如果我退出应用程序并在循环中设置 object = nothing，则代码可以正常工作。但是现在的方式是，它在“objWordApp.documents.Open strFilePath & strCurFileName”行的文件夹中的第二个文件上被炸毁。

我可以循环打开和关闭 Word 文档而不必一遍又一遍地创建对象吗？当我这样做时，它真的很慢。

* * *

谢谢你的帮助——我更喜欢你的方式。不幸的是，我得到了同样的结果。该程序第二次通过以下行中的循环死掉：

```
Set objWordDoc = objWordApp.Documents.Open(objFile.Path) 
```

我得到的错误是：

**运行时错误 -2147417851 (80010105) 自动化错误 服务器抛出异常。**

我在常规文字文档（不是我正在处理的文档）上尝试了您的代码，并且效果很好。我正在运行的文档有表单字段和宏——不确定这是否会有所不同。我已将 Word 中的宏安全性设置为“低”和“非常高”，以确保其他宏不会干扰。

我只是无法弄清楚为什么它适用于第一个文档，然后不适用于下一个文档。我什至克隆了第一个文档，但没有任何区别。

* * *

不过，仍然没有运气。我唯一能做的就是每次我想打开文件时完全擦除对象并重新创建它们。

```
Set objFolder = FSO.GetFolder(strFilePath)

For Each objFile In objFolder.Files

    Set objWordApp = CreateObject("word.application")
    objWordApp.Visible = True

    If Right(objFile.Name, 4) = ".doc" Then
        Set objWordDoc = objWordApp.documents.Open(Filename:=objFile.Path, ConfirmConversions:=False, _
            ReadOnly:=True, AddToRecentFiles:=False, PasswordDocument:="", _
            PasswordTemplate:="", Revert:=False, WritePasswordDocument:="", _
            WritePasswordTemplate:="", Format:=wdOpenFormatAuto)

        [Process DOC]

        objWordDoc.Close 0, 1
    End If

    Set objWordDoc = Nothing
    objWordApp.Quit
    Set objWordApp = Nothing

Next 
```

我不确定为什么会这样，为什么它不会以另一种方式工作。如果我必须走这条路，我可以——它看起来真的很慢而且效率很低。这是一个坏主意吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T20:56:49.690

我将 Dir 更改为 FileSystemObject（转到 Tools\References 并添加 Microsoft Scripting Runtime），我能够成功打开多个文件。如果您遇到问题，请描述您在调试器中看到的错误。此外，如果您需要递归到子目录，则需要对其进行重构。

```
Private mobjWordApp As Word.Application

Sub Test()
  ProcessDirectory "PathName"
End Sub

Property Get WordApp() As Word.Application
  If mobjWordApp Is Nothing Then
    Set mobjWordApp = CreateObject("Word.Application")
    mobjWordApp.Visible = True
  End If
  Set WordApp = mobjWordApp
End Property

Sub CloseWordApp()
  If Not (mobjWordApp Is Nothing) Then
    On Error Resume Next
    mobjWordApp.Quit
    Set mobjWordApp = Nothing
  End If
End Sub

Function GetWordDocument(FileName As String) As Word.Document
    On Error Resume Next
    Set GetWordDocument = WordApp.Documents.Open(FileName)
    If Err.Number = &H80010105 Then
      CloseWordApp
      On Error GoTo 0
      Set GetWordDocument = WordApp.Documents.Open(FileName)
    End If
End Function

Sub ProcessDirectory(PathName As String)
  Dim fso As New FileSystemObject
  Dim objFile As File
  Dim objFolder As Folder
  Dim objWordDoc As Object

  On Error Goto Err_Handler

  Set objFolder = fso.GetFolder(PathName)
  For Each objFile In objFolder.Files
    If StrComp(Right(objFile.Name, 4), ".doc", vbTextCompare) = 0 Then
      Set objWordDoc = GetWordDocument(objFile.Path)
      ' objWordDoc.Unprotect Password:="testcode" ' Need to check if it has Password?
      ProcessDocument objWordDoc
      objWordDoc.Close 0, 1
      Set objWordDoc = Nothing
    End If
  Next

Exit_Handler:
  CloseWordApp
  Exit Sub

Err_Handler:
  MsgBox "Error " & Err.Number & ": " & Err.Description
  Resume Exit_Handler
  'Resume Next ' or as above
End Sub

Sub ProcessDocument(objWordDoc As Document)
  '{EXCEL PROCESSING HERE}'
End Sub 
```

编辑：我添加了一些错误处理和一些重构，尽管可以进行更多重构。

您打开的文件一定有什么特别之处。您可以尝试使用不同的参数来打开文档，例如：

```
Set objWordDoc = objWordApp.Documents.Open( _
  FileName:=objFile.Path, ReadOnly:=True) 
```

您可能需要添加 Microsoft Word 作为参考，如果这样做，则开始使用 Word 常量（wdDoNotSaveChanges 等）。查看 Documents.Open 的帮助并测试不同的参数。

另外，在调试过程中使用上下文菜单中的“设置下一个语句”，可能会跳过第一个文档并直接打开第二个文档，看看是否有问题。

编辑：如果您遇到您描述的自动化错误，我已更改代码以关闭并重新打开 Word。您可能需要调整错误编号，或者在出现任何错误时直接关闭 Word（如果 Err.Number <> 0 Then ...）。

同样，您的文档必须有一些特别之处（宏、保护等），因为此代码适用于我尝试过的测试用例。您是否尝试过以与脚本相同的顺序在 Word 中手动打开文档，更新类似于您的流程脚本的信息，然后关闭文档以查看 Word 是否有任何异常？

关闭 Word.Application 不会伤害任何东西，但它显然会明显变慢。

# c# - NHibernate 和多个数据库

> ID：831459
> 
> 赞同：1
> 
> 时间：2009-05-06T19:59:50.887
> 
> 标签：c#, nhibernate

我正在尝试解决非常简单的问题。我想建立与 2 个完全不同的数据库（但都是 mysql ）的连接。现在我尝试通过创建多个配置文件然后创建多个会话来解决这个问题。一切正常，直到我建立关系。

我在 2 个数据库中有 2 个表：

db1 - 新闻

db2 - News_Authors

我将 News 添加到 db1 配置，将 News_Authors 添加到 db2 配置。当我尝试构建简单的一对一关系错误时，我收到：

```
An association from the table songs refers to an unmapped class: db1.News_Authors 
```

**新闻.hbm.xml**

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2">
  <class name="project.News, project" table="news" lazy="false">
    <id name="id" column="id" type="integer" length="11">
      <generator class="native" />
    </id>
    <property name="title" type="String" length="255" />
    <property name="authorid" type="integer" length="5" />

    <one-to-one name="NewsAuthor" cascade="all-delete-orphan" lazy="proxy" column="authorid" unique="true" />
  </class>     
</hibernate-mapping> 
```

**News_Authors.hbm.xml**

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2">
  <class name="project.News_Authors, project" table="news_authors" lazy="false">
    <id name="id" column="id" type="integer" length="11">
      <generator class="native" />
    </id>
    <property name="name" type="String" length="255" />
  </class>     
</hibernate-mapping> 
```

**config** 我添加了这个来启用映射。现在，如果我将两者都设置在一个配置文件中，一切正常...

```
<mapping resource="project.News.hbm.xml" assembly="project" /> 
```

那么我如何在创建会话期间也“通知”nhibernate 我有多个会话？还是我应该完全选择另一种方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T21:13:23.520

另一种可能的解决方案是在其中一个 sql server 数据库中创建视图以引用另一个中的表。视图映射就像表格一样，并且很容易创建一个返回如下内容的视图：

从 db2.News_Authors 中选择 *

在 db1 数据库中。

这样，您只需要一个映射到两个数据库之一的 .hbm.xml 文件。

希望这可以帮助，

-最大限度

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:10:41.360

您所追求的不是多个会话，而是多个会话工厂。有关更多详细信息，请参阅[此](http://www.codeproject.com/KB/aspnet/NHibernateMultipleDBs.aspx)内容。

这里的关键是您不必通过配置文件初始化会话工厂 - 您可以通过编程方式进行。拥有两个会话工厂只是一个步骤。

# asp.net - 从 xslt、编码问题、asp.net 创建 html 附件

> ID：831467
> 
> 赞同：0
> 
> 时间：2009-05-06T20:02:20.350
> 
> 标签：asp.net, string, encoding

我正在尝试通过 xsl 转换处理我的一些 xml 并将其发送到客户端来创建一个 html 附件。如果我单击“打开”，IE 会正确显示 html，但如果我保存附件然后在 Firefox 中打开它，每个地方都有一个“Â”字符。我觉得这与我们的编码有关。以下是相关代码：

```
 Response.Clear();
    Response.ContentEncoding = Encoding.UTF8;
    Response.ContentType = "text/html";
    Response.Charset = "utf-8";
    Response.AddHeader("Content-Disposition",
        String.Format("attachment; filename={0}; size={1}", filename, rgen.Output.Length));
    //Response.Flush();
    Response.Write(rgen.Output);
    Response.Flush();
    Response.End(); 
```

rgen.Output 是一个来自 stringwriter.tostring() 的字符串，其中包含转换后的 html。

似乎 xslt 总是将编码设置为 UTF-16，但我已将上面的代码更改为 utf-16，它也不起作用。有什么想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-30T14:53:33.700

您的 XSL 文档输出是什么样的？你在那里设置什么编码？

```
<xsl:output encoding="utf-8"  omit-xml-declaration="yes" method="html" indent="no" ></xsl:output> 
```

# wpf - 是否可以找出包含 DependencyObject 的程序集和文件？

> ID：831468
> 
> 赞同：2
> 
> 时间：2009-05-06T20:02:31.083
> 
> 标签：wpf, reflection, assemblies, dependencyobject

我目前正在为 WPF 开发一个小的本地化框架（甚至不要考虑将我指向 locBAML ......）并且想知道是否有可能找出指定 DependencyObject 的包含程序集。

例如：我在 Window1.xaml 文件中的 XAML 中有一个普通的窗口定义。该窗口包含一个 StackPanel，其中包含一个 TextBlock。

当只有对 TextBlock 的引用时，是否可以找出哪个程序集包含 Window1.xaml 文件？

是否也可以找出 xaml 文件的文件名（在这种情况下为“Window1.xaml”）？

在此先感谢并致以最诚挚的问候， 3Fox

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T20:35:24.547

我认为这样的事情会奏效。

```
Window window = Window.GetWindow(YourTextBox);
Assembly assembly = Assembly.GetAssembly(window.GetType()); 
```

# sql-server-2005 - MS Sql Server 2005 有空间数据功能吗？

> ID：831470
> 
> 赞同：3
> 
> 时间：2009-05-06T20:02:41.397
> 
> 标签：sql-server-2005, geometry, geospatial, spatial

我想知道是否有任何优化可以在不移动到 SQL SERVER 2008 的情况下实现更快的空间数据选择。对于 SQL Server 2005，本机或通过插件，以下任何功能？

1.  空间字段类型
2.  空间索引
3.  用于球体（地球）表面距离计算的 Arcsin 数学函数

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T20:07:47.360

有一些 GIS 功能可通过[http://www.codeplex.com/Wiki/View.aspx?ProjectName=MsSqlSpatial](http://www.codeplex.com/Wiki/View.aspx?ProjectName=MsSqlSpatial)但据我所知 SQL 2008 是要走的路

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T20:06:40.920

2005 年只有 3 个（[`ASIN`](http://msdn.microsoft.com/en-us/library/ms181581(SQL.90).aspx)）。空间的东西是[2008 年的新](http://www.microsoft.com/sqlserver/2008/en/us/spatial-data.aspx)东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T16:52:02.560

不是这样的。SQL Server 没有本机空间索引工具。许多人已经完成了在本地索引设施之上模拟空间索引的项目，但这些项目不如本地 R-tree 或其他空间索引高效。要获得对此的本机支持，您确实需要 SQL Server 2008 或其他直接支持空间索引的 DBMS，例如 PostGresSQL。

但是，其他海报链接到的解决方案之一可能会给您带来性能提升。

# c# - GridView 中禁用了动态添加的复选框列

> ID：831475
> 
> 赞同：0
> 
> 时间：2009-05-06T20:03:47.430
> 
> 标签：c#, dynamic, dataset, checkbox

我正在动态地将布尔列添加到数据集。DataSet 的表是 GridView 的 DataSource，它自动生成列。

问题：此动态生成的列的复选框全部被禁用。如何启用它们？

```
ds.Tables["Transactions"].Columns.Add("Retry", typeof(System.Boolean));
ds.Tables["Transactions"].Columns["Retry"].ReadOnly = false; 
```

换句话说，我如何控制 GridView 如何为布尔字段生成 CheckBoxes？（为什么将 ReadOnly 设置为 False 没有效果？）

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-04T21:13:47.677

您可能应该添加 CellContentClick 事件处理程序并否定单元格已有的值。喜欢：

```
private void dgvRaceDetails_CellContentClick(object sender, DataGridViewCellEventArgs e)
{
            if (e.ColumnIndex == 5)
            {
                dgvRaceDetails.Rows[e.RowIndex].Cells[5].Value =
                    !(Boolean)dgvRaceDetails.Rows[e.RowIndex].Cells[5].Value;
            }

            if (e.ColumnIndex == 6)
            {
                dgvRaceDetails.Rows[e.RowIndex].Cells[6].Value =
                    !(Boolean)dgvRaceDetails.Rows[e.RowIndex].Cells[6].Value;
            }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:09:42.907

我相信它们会被自动禁用，直到它们具有价值。

```
DataRow row = ds.Tables["Transactions"].NewRow();
row("Retry") = true;
ds.Tables["Transactions"].Rows.Add(row) 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2015-09-16T14:05:55.137

将布尔值设置为 true。它的默认值为假。我希望这有帮助。

# apache-flex - 水平列表控件的 Flex 拖放重新排序 - 查找 FROM 和 TO 索引？

> ID：831482
> 
> 赞同：0
> 
> 时间：2009-05-06T20:05:29.533
> 
> 标签：apache-flex, flex3, drag-and-drop

我有一个带有 2 个 Horizo​​ntalList 控件的 Flex3 项目；其中之一启用了拖放功能。两个控件将始终具有相同数量的项目，并且是相关的……第一个控件的索引 0 与第二个控件的索引 0 匹配，依此类推。

自然，当使用拖放对第二个控件重新排序时，我希望第一个控件中的项目反映相同的重新排序。我想我可以处理控件的实际更新，但我无法找到已通过拖放移动的项目的**from**和**to索引。**

使用`dragDrop`控件上允许拖放的方法，并在调试器中仔细阅读`event.currentTarget`（而不是`event.target` [因为文档这样说](http://livedocs.adobe.com/flex/3/langref/mx/core/UIComponent.html#event:dragDrop)）的内容，显示了一个名为的公共属性`selectedIndex`，它似乎确实保存了**from**索引，但我没有看到任何将告诉我**要**索引的属性。

我在俯瞰物业吗？我是否必须根据其他东西来推断它？有一个更好的方法吗？

**更新：**一个可接受的解决方案也可能是遍历 Horizo​​ntalList 的内容并将内部索引值保存到一个数组中，然后可以使用该数组对另一个列表的 dataProvider 进行重新排序；但我不知道如何迭代列表内容，所以我也被困住了。那里有什么帮助吗？

这是我的代码：

`main.mxml:`

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application 
    xmlns:mx="http://www.adobe.com/2006/mxml" 
    xmlns:com="components.*"
    layout="absolute" 
>
    <mx:Script>
        <![CDATA[
            import mx.events.DragEvent;
            import mx.controls.Alert;
            import mx.collections.ArrayCollection;

            //these two variables are junk data to represent 
            //what we will get back from our data services...
            [Bindable] 
            private var btnData:ArrayCollection = new ArrayCollection(
                [
                    {title:'title1', index:0},
                    {title:'title2', index:1},
                    {title:'title3', index:2},
                    {title:'title4', index:3}
                ]
            );
            [Bindable] 
            private var chainData:ArrayCollection = new ArrayCollection(
                [
                    {tmp:'testing 1'},
                    {tmp:'testing 2'},
                    {tmp:'testing 3'},
                    {tmp:'testing 4'}
                ]
            );

            //handle button re-ordering
            private function handleBtnReorder(event:DragEvent):void{
                Alert.show(event.action.toString());
            }
        ]]>
    </mx:Script>

    <mx:HorizontalList
        id="ChainView"
        dataProvider="{chainData}"
        itemRenderer="components.ItemRenderers.ChainLinkRenderer"
        left="20"
        right="20"
        top="20"
        height="300"
        rowHeight="300"
        columnWidth="500"
        rollOverColor="#ffffff"
        selectionColor="#eeeeee"
    />

    <mx:HorizontalList 
        id="btnList" 
        dataProvider="{btnData}"
        dragEnabled="true" 
        dropEnabled="true"
        dragMoveEnabled="true"
        dragDrop="handleBtnReorder(event)"
        itemRenderer="components.ItemRenderers.BtnListRenderer"
        horizontalCenter="true"
        left="20"
        right="20"
        top="320"
        height="50"
        rowHeight="35"
        rollOverColor="#ffffff"
        selectionColor="#ffffff"
    />

</mx:Application> 
```

没有显示任何有用的`Alert.show(...)`东西，我在该行设置了一个断点，以便我可以检查事件参数。

我认为自定义 itemRenderer 并不重要（它们的代码不多），所以为了简洁起见，我将它们排除在外。如果您认为它们*很*重要，请告诉我，我会在这里编辑它们。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T14:43:33.683

事实证明，解决方案是从使用`dragDrop`事件切换到`dragComplete`事件；此时，已更新绑定的 dataProvider 以反映重新排序。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2010-02-12T10:59:45.560

这就是为什么要使用模型定位器模式！

您必须将您的 dataProvider 移动到一个单例类（例如模型），而不是您的项目渲染器可以轻松访问它。您的项目没有属性 Index 因为它已经由 [ArrayCollection].getItemIndex(..)

# memory - 如何使用页表将虚拟地址转换为物理地址？

> ID：831494
> 
> 赞同：13
> 
> 时间：2009-05-06T20:08:59.417
> 
> 标签：memory, memory-management, paging, virtual-memory, memory-address

假设我有一个普通的页表：

**页表（页面大小 = 4k）**

```
 Page #:  0  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15          
Page Frame #:  3  x  1  x  0  x  2  x  5  x   7   4   6   x   x   x 
```

如何将任意逻辑地址（如 51996）转换为物理内存地址？

* * *

如果我取 log base 2 (4096)，我得到 12。我认为这是我应该使用多少位来偏移地址。

我只是不确定。51996 / 4096 = 12.69。那么这是否意味着它以一定的偏移量位于第 12 页上？

那我怎么把它变成“51996”的物理地址呢？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-06T21:04:06.507

要确定给定内存地址的页面，请取前 P 位（N 位）的编号。

P = lg2(numberOfPages)
在你的例子中， P=lg2(16)=4

所以给定内存地址的前 4 位将告诉我们页面。这意味着其余的应该是从该页面开始的偏移量。

您的示例地址 51996 是二进制的 1100101100011100。即 [1100:101100011100]。

1100（十进制的 12）是页码
101100011100（十进制的 2844）是偏移量

现在我们需要找到第 12 页在内存中的位置。
查看您的框架表，第 12 页似乎位于第 6 个框架中。在所有内存都是可分页的（即没有内存映射 IO）的系统中，第 6 页帧将位于**(entriesPerPage*frameNum)-1**

~~在这种情况下，4000*6-1 = 23999（需要“-1”，因为内存是 0 索引的。）~~

在这种情况下，**4096** *6-1 = 24575（需要“-1”，因为内存是 0 索引的。）

现在我们要做的就是添加偏移量，我们就有了物理内存地址：

~~23999 + 2844=26843 = 0x68DB~~

24575 + 2844 = 27419 = **0x6B1B**

完毕！

希望这个（编辑）有帮助 XD

编辑：感谢 Jel 发现我的错误 :) 感谢 user8 发现我的另一个错误！（frameNum 而不是 pageNum）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-10T19:36:43.690

这可能会有所帮助：

```
 import java.util.Arrays;
    import java.util.Scanner;

    public class Run {

        private static Scanner input = new Scanner(System.in);

        public static void main(String[] args) {

            System.out.println("////////// COMMANDS //////////");
            System.out.println("Snapshot: S(enter)r, S(enter)m, S(enter)x, S(enter)p, S(enter)d, S(enter)c");
            System.out.println("time: t");
            System.out.println("Terminate: T#");
            System.out.println("Kill: K#");
            System.out.println("Start process: A");
            System.out.println("Quit program: quit");
            System.out.println("Deletes device: delete");
            System.out.println ("//////////////////////////////");
            OS myComputer;
            int hdd, cdd, printer, cpu, mem, page;
            hdd = cdd = printer = cpu = 20;
            mem = 1;
            page = 1;
            System.out.println("");
            System.out.println("|||| SYS GEN ||||");
            System.out.println("");
            mem = 0;
            System.out.println("Number of Hard-Drives:");
            while (hdd > 10) {
                String inpt = input.next();
                while (Asset.isInt(inpt) == false)
                    inpt = input.next();
                hdd = Integer.parseInt(inpt);
                if (hdd > 10)
                    System.out.println("Try something smaller (less than 10)");

            }

            System.out.println("Number of CD-Drives: ");
            while (cdd > 10) {
                String inpt = input.next();
                while (Asset.isInt(inpt) == false)
                    inpt = input.next();
                cdd = Integer.parseInt(inpt);
                if (cdd > 10)
                    System.out.println("Try something smaller (less than 10)");
            }

            System.out.println("Number of Printers:");
            while (printer > 10) {
                String inpt = input.next();
                while (Asset.isInt(inpt) == false)
                    inpt = input.next();
                printer = Integer.parseInt(inpt);
                if (printer > 10)
                    System.out.println("Try something smaller (less than 10)");
            }

            System.out.println("Amount of Memory:");
            while (mem <= 0) {
                String inpt = input.next();
                if (Asset.isInt(inpt))
                    mem = Integer.parseInt(inpt);
                if (mem<=0)
                    System.out.println("The memory size must be greater than zero.");
                else
                    break;
            }

            Integer[] factors = Asset.factors(mem);
            System.out.println("Enter a page size: "+Arrays.toString(factors));
            while (true) {
                String inpt = input.next();
                while (Asset.isInt(inpt) == false)
                    inpt = input.next();
                if (Asset.inArray(factors, Integer.parseInt(inpt))) {
                    page = Integer.parseInt(inpt);
                    break;
                } else {
                    System.out.println("Page size must be one of these -> "+Arrays.toString(factors));
                }
            }

            System.out.println("Number of CPUs (max10):");
            while (cpu > 10) {
                String inpt = input.next();
                while (Asset.isInt(inpt) == false)
                    inpt = input.next();
                cpu = Integer.parseInt(inpt);
                if (cpu > 10)
                    System.out.println("Try something smaller (less than 10)");
            }
            myComputer = new OS(cpu, hdd, cdd, printer, mem, page);
            myComputer.Running();
        }

    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T20:31:38.470

如果我正确理解了您的问题（我可能没有正确理解），您想知道如何使用页表结构从虚拟地址中找到物理地址。在这种情况下，假装你是处理器。使用地址的最高 10 位在页目录（顶级页表）中查找页表。接下来的 10 位是页表（较低级别的页表）的索引。使用该页表条目中的地址来查找物理页地址。最后十位是进入页面的字节地址。

[顺便说一句，您可能会在OSDev](http://www.osdev.org/)等面向操作系统的站点上找到更多了解此类问题的人。我无法在这个答案中真正详细介绍，因为我已经很多年没有做过这类事情了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-05-30T10:22:38.450

**第一步**：51996 / 4000 = 12 -> p，剩余 = 3996 -> d（偏移量）。

现在看表 p(12) = 6

**第二步**：（6*4000）+3996：27996

*物理地址为 27996。*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-04T11:39:44.467

以下页表适用于具有 16 位虚拟和物理地址以及 4,096 字节页面的系统。当页面被引用时，引用位设置为 1。线程定期将参考位的所有值清零。页框的破折号表示该页不在内存中。页面替换算法是本地化的 LRU，所有数字都以十进制提供。

页 页帧参考位 0 9 0 1 1 0 2 14 0 3 10 0 4 - 0 5 13 0 6 8 0 7 15 0 8 0 0 9 - 0 10 5 0 11 4 0 12 - 0 13 3 0 14 - 0 15 2 0 一个。将以下虚拟地址（十六进制）转换为等效的物理地址（提供十六进制和十进制的答案）。还要为页表中的相应条目设置参考位。(3) 一世。0xBC2C 二。0x00ED 三。0xEA14 四。0x6901 诉 0x23A1 六。0xA999

# asp.net - 使用 WinDbg 和 ADPlus 帮助捕获 StackOverflowException

> ID：831499
> 
> 赞同：16
> 
> 时间：2009-05-06T20:09:32.080
> 
> 标签：asp.net, windbg, stack-overflow, adplus

**简洁版本**

我想要一个 ADPlus 脚本，它会在第一次出现 StackOverflowException 时执行完整的内存转储，然后再清理任何内容，并忽略所有其他异常类型。

**日志版本**

在发布新的 ASP.NET 代码后，我们开始出现间歇性 StackOverflowExceptions。我们已经在自上次已知良好安装后添加的修订版中寻找无限递归和所有常见的嫌疑人，但找不到任何东西。该网站将运行长达一个小时，然后崩溃。

我们使用了 WinDbg 和 SOS 并尝试使用 ADPlus 获取崩溃日志，使用以下命令：

```
adplus -crash -o D:\Crash -NoDumpOnFirst -iis 
```

-NoDumpOnFirst 的原因是我们只能在繁忙的服务器上在生产中重现此错误。为了对每个第一次机会异常（嘿，它发生）进行小型转储，调试器必须暂停 IIS 工作进程足够长的时间以写出 16 meg 文件，因此请求排队并且应用程序变得不稳定。因为错误可能需要长达一个小时才能抬起它丑陋的脑袋，所以这是有问题的。

因此，使用 -NoDumpOnFirst，我得到了一个转储文件，WinDbg 输出这些线程用于：

```
PDB symbol for mscorwks.dll not loaded
ThreadCount: 69
UnstartedThread: 0
BackgroundThread: 69
PendingThread: 0
DeadThread: 0
Hosted Runtime: no
                                      PreEmptive   GC Alloc           Lock
       ID OSID ThreadOBJ    State     GC       Context       Domain   Count APT Exception
XXXX    1  c6c 000fa758  11808221 Disabled 3b49ee4c:3b49efe8 00120888     1 Ukn (Threadpool Worker)
XXXX    2 1294 000fd258      b220 Enabled  00000000:00000000 000df4e0     0 Ukn (Finalizer)
XXXX    3 1eb0 0011cdd0    80a220 Enabled  00000000:00000000 000df4e0     0 Ukn (Threadpool Completion Port)
XXXX    4 1b3c 00120198      1220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX    5 1280 00138118   880a220 Enabled  2633de9c:2633ee08 000df4e0     0 Ukn (Threadpool Completion Port)
XXXX    6 1db8 00158a48  1180a221 Disabled 4b5a7e2c:4b5a82e8 00120888     1 Ukn (Threadpool Worker)
XXXX    9 141c 00162008   180a220 Enabled  00000000:00000000 000df4e0     0 Ukn (Threadpool Worker)
XXXX    7 1574 00174008   180a220 Enabled  4d46b6a8:4d46c158 00120888     2 Ukn (Threadpool Worker)
XXXX    c 16c8 0016b7a8   180a220 Enabled  00000000:00000000 000df4e0     0 Ukn (Threadpool Worker)
XXXX    8 1384 00162878   180a220 Enabled  284e26a4:284e45d8 000df4e0     0 Ukn (Threadpool Worker)
XXXX    b 1c10 0016b3d8   180a220 Enabled  3ed2dae0:3ed2dfe8 00120888     2 Ukn (Threadpool Worker)
XXXX    a 1814 0016b008   180a220 Disabled 28816384:28816638 00120888     1 Ukn (Threadpool Worker)
XXXX    d  1fc 1b4d1ff0       220 Enabled  319f89a4:319fa41c 000df4e0     0 Ukn
XXXX    e 1864 1b4e3d20   180b220 Enabled  4b2c5be0:4b2c6150 000df4e0     0 Ukn (Threadpool Worker)
XXXX    f 13bc 1b57caf8   200b220 Enabled  4cc71584:4cc73414 00120888     1 Ukn
XXXX   10  72c 1f5124a8   180b220 Enabled  3b4b3414:3b4b4fe8 00120888     2 Ukn (Threadpool Worker)
XXXX   11 1fd0 1f526398   180b220 Disabled 4d46f41c:4d470158 00120888     1 Ukn (Threadpool Worker)
XXXX   12 1f10 1f52f1c8   180b220 Enabled  28812c14:28814638 00120888     2 Ukn (Threadpool Worker)
XXXX   13 1b84 1f53a420       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   14 18a4 1f570978   180b220 Enabled  263e18b4:263e2e28 000df4e0     0 Ukn (Threadpool Worker)
XXXX   15 1a98 1f57f0a0   180b220 Enabled  00000000:00000000 000df4e0     0 Ukn (Threadpool Worker)
XXXX   16  1b4 1f583628   180b220 Enabled  495781ec:4957914c 00120888     2 Ukn (Threadpool Worker)
XXXX   17  b90 1f585dc8   180b220 Enabled  265cbe48:265ccba4 000df4e0     0 Ukn (Threadpool Worker)
XXXX   18 1590 1f613c60       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   19 1850 1f5fad90       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   1a  c78 1f60d3f0       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   1c 1bd8 2121f1b0       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   1d  494 1b4a8c10       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   1e  898 2120f120       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   1f 1820 21355ff8       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   20 15b0 3570e120       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   21 18b0 359ca008       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   22  75c 35a58948       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   25 1a18 213ac8f8   880b220 Disabled 3219a830:3219b450 00120888     1 Ukn (Threadpool Completion Port) System.StackOverflowException (0e3200a4)
XXXX   29 1b74 3598e620   180b220 Enabled  00000000:00000000 000df4e0     0 Ukn (Threadpool Worker)
XXXX   2a  9b8 3598dbe0   180b220 Enabled  2880ef2c:28810638 000df4e0     0 Ukn (Threadpool Worker)
XXXX   2b 1eac 1f6f6288   180b220 Enabled  00000000:00000000 000df4e0     0 Ukn (Threadpool Worker)
XXXX   2d  2f4 211759e8   180b220 Disabled 2634eacc:2634ee08 00120888     1 Ukn (Threadpool Worker)
XXXX   2e 1e3c 35c2eb60   880b220 Enabled  4b5a5758:4b5a62e8 000df4e0     0 Ukn (Threadpool Completion Port)
XXXX   30  394 35c394f8   180b220 Enabled  4cef7930:4cef90d4 000df4e0     0 Ukn (Threadpool Worker)
XXXX   31 1e64 35c39128   180b220 Disabled 288110b0:28812638 00120888     1 Ukn (Threadpool Worker)
XXXX   32 1af8 35a58578   180b220 Enabled  3b48e7cc:3b48efe8 000df4e0     0 Ukn (Threadpool Worker)
XXXX   34 1d44 1f6a6c88   180b220 Enabled  00000000:00000000 000df4e0     0 Ukn (Threadpool Worker)
XXXX   35 197c 212088e0   180b220 Enabled  49389ba8:4938af40 000df4e0     0 Ukn (Threadpool Worker)
XXXX   36 1e2c 35c1d980       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   38 1ddc 212d03d8       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   39  288 212d0008       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   3a 1694 212bf958       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   3b  be4 212ccc40       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   37  ccc 35c4d6d0       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   3c 14ec 35c55af0       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   41 1d94 35c38c08   180b220 Enabled  00000000:00000000 000df4e0     0 Ukn (Threadpool Worker)
XXXX   24  130 35746a50   180b220 Enabled  2670ae48:2670cc00 000df4e0     0 Ukn (Threadpool Worker)
XXXX   2f 1404 35c1d350   180b220 Enabled  00000000:00000000 000df4e0     0 Ukn (Threadpool Worker)
XXXX   43 1ae8 35c25cb8   180b220 Disabled 3b4c28e0:3b4c2fe8 00120888     1 Ukn (Threadpool Worker)
XXXX   44 18ac 212cc870   180b220 Disabled 4957e728:4957f14c 00120888     1 Ukn (Threadpool Worker)
XXXX   45 18b4 212bf588   180b220 Disabled 3b4c05dc:3b4c0fe8 00120888     1 Ukn (Threadpool Worker)
XXXX   46 1c0c 21239858       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   47  4fc 21188b68       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   48 1198 35caa2a8       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   49 1f9c 21147af8       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   4a 1adc 35cc6908       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   4b  ce8 35c60e30       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   4d  6f0 35d05aa0       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   4e 1ee8 35c1b6b0       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   42 1d7c 35d9a230       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   3d  7d8 212e1b28       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   23  c0c 503ea010       220 Enabled  00000000:00000000 000df4e0     0 Ukn
XXXX   27 1f44 503cdf08       220 Enabled  00000000:00000000 000df4e0     0 Ukn 
```

尝试打印异常表明没有堆栈跟踪，并且其他方法抱怨它是非托管代码。我的猜测是，由于转储是在进程死亡时创建的，因此所有线程都已被垃圾收集，并且没有信息可以获取。

我真的很想让调试器在 StackOverflowException 的第一次机会上执行完全转储并忽略所有其他异常类型。我知道 ADPlus 可以使用配置文件 - [http://msdn.microsoft.com/en-us/library/cc409304.aspx](http://msdn.microsoft.com/en-us/library/cc409304.aspx) - 但格式对我来说都是希腊语。谁能告诉我如何制作一个可以做到这一点的 ADPlus 脚本？

...当然，如果您查看上面的线程列表并且您确切地知道出了什么问题，或者如果我给您更多信息就可以弄清楚，您也可以告诉我。

**解决尝试 1**

谢谢 deemok 的回答，虽然不太正确，但这将我推向了正确的方向。Stack Overflow 的异常代码不正确（它是 sbo 不是 sov），（或者我当时认为，请参阅下面的 deemok 编辑）所以我尝试使用以下配置进行调试：

```
<ADPlus>
   <!-- Add log entry, log faulting thread stack and dump full on first chance StackOverflow -->
<Exceptions>
     <Config>
        <!-- This is for the StackOverflow exception -->
       <Code> sbo </Code>
       <Actions1> Log;Stack;FullDump </Actions1>
       <!-- Depending on what you intend - either stop the debugger (Q or QQ) or continue unhandled (GN) -->
       <ReturnAction1> GN </ReturnAction1>
     </Config>
  </Exceptions>
</ADPlus> 
```

并使用以下命令：

```
adplus -crash -o D:\Crash -NoDumpOnFirst -c D:\Crash\stackoverflow.cfg -iis 
```

我验证了输出的日志文件指示了正确的配置。诀窍是 adplus 的命令行参数按顺序执行，因此如果您从捕获第一次机会异常的配置开始，然后应用 -NoDumpOnFirst，则配置设置将被覆盖。如果最后使用 -c 应用配置，则其设置将胜出。

然而，最后，堆栈溢出被证明是无法捕获的。发生堆栈溢出，无法接收内存转储，然后在第二次机会进程结束事件上发生转储，再次所有内容都被垃圾收集，我无法获得任何有用的信息。

我试图短路进程结束异常，以防它参与并覆盖堆栈溢出，但随后发生了异常，我只是没有内存转储。

幸运的是，我通过检查代码偶然发现了答案。当然，这是一个循环方法调用的例子。

**实际分辨率**

这个问题早就解决了，但我很快就制作了一个会导致堆栈溢出的 ASP.NET 页面。（毕竟这并不难）并在下面尝试了 Axl 的回应。

XML 有点偏离 - Axl 只是忘记关闭`</ADPlus>`标签（或者可能在复制粘贴中丢失了它），但这很容易修复，adplus 很友好地告诉我到底出了什么问题。

我将该脚本设置为针对我的测试堆栈溢出引发程序，将结果加载到 windbg 中，当我调用 !clrstack 时，我得到了一个非常清晰（而且很长）的循环调用彼此的方法列表。这一下子就发现问题了！下次堆栈溢出来敲我的门时，我会保留此页面的书签。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-24T21:38:39.163

以防万一这可能对其他人有所帮助，下面是我想出的[ADPlus配置文件。](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx)现在看，我不确定 !runaway 有什么效果。当抛出 StackOverflowException 的 ASP.NET 应用程序运行时附加，这将在指定的 OutputDir 中生成“第一次机会 StackOverflow 已满”和“第一次机会进程关闭”.dmp 文件。[使用Windbg](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx)打开第一个文件，然后运行“.loadby sos mscorwks”，然后运行“!clrstack”，查看可能导致堆栈溢出的原因。

```
<ADPlus>
<Settings>
    <RunMode>CRASH</RunMode>
    <OutputDir>C:\Dumps</OutputDir>
    <ProcessName>w3wp.exe</ProcessName> 
</Settings>
<Exceptions>
    <Option>FullDumpOnFirstChance</Option>
    <Option>MiniDumpOnSecondChance</Option>
    <Option>NoDumpOnFirstChance</Option>
    <Option>NoDumpOnSecondChance</Option>
    <Config>
        <Code>AllExceptions</Code>
        <Actions1>Void</Actions1>
        <Actions2>Void</Actions2>
        <ReturnAction1>GN</ReturnAction1>
        <ReturnAction2>GN</ReturnAction2>
    </Config>       
    <Config>
        <!--
        av = AccessViolation
        ch = InvalidHandle
        ii = IllegalInstruction
        dz =  IntegerDivide
        c000008e = FloatingDivide
        iov = IntegerOverflow
        lsq = InvalidLockSequence
        sov = StackOverflowException
        eh = CPlusPlusEH
        * = UnknownException
        clr = NET_CLR
        bpe = CONTRL_C_OR_Debug_Break
        ld = DLL_Load
        ud = DLL_UnLoad
        epr = Process_Shut_Down
        sbo = Stack_buffer_overflow
        -->
        <Code>sov;sbo</Code>
        <Actions1>Log;Time;Stack;FullDump;EventLog</Actions1>
        <CustomActions1>!runaway</CustomActions1>
        <Actions2>Log;Time;Stack;FullDump;EventLog</Actions2>
        <CustomActions2>!runaway</CustomActions2>
        <!--
        G = go
        GN = go unhandled exception
        GH = go handled exception
        Q = quit
        QD = quit and detach
        -->
        <ReturnAction1>GN</ReturnAction1>
        <ReturnAction2>GN</ReturnAction2>
    </Config>
    <Config>
        <Code>clr</Code>
        <Actions1>Void</Actions1>
        <Actions2>Log;Time;Stack;FullDump;EventLog</Actions2>
        <ReturnAction1>GN</ReturnAction1>
        <ReturnAction2>GN</ReturnAction2>
    </Config>
    <Config>
        <Code>epr</Code>
        <Actions1>Log;Time;Stack;FullDump;EventLog</Actions1>
        <Actions2>Void</Actions2>
        <ReturnAction1>GN</ReturnAction1>
        <ReturnAction2>GN</ReturnAction2>
    </Config>
</Exceptions>
</ADPlus> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T07:40:54.620

```
<ADPlus>
   <!-- 添加日志条目，记录错误的线程堆栈并在第一次 StackOverflow 时转储满 -->
<例外>
     <配置>
        <!-- 这是堆栈缓冲区溢出异常-->
        <!-- 使用 sov 处理堆栈溢出异常 -->
       <代码> sbo </代码>
       <Actions1> 日志；堆栈；FullDump </Actions1>
       <!-- 取决于您的意图 - 停止调试器（Q 或 QQ）或继续未处理（GN）-->
       <ReturnAction1> GN </ReturnAction1>
     <配置>
  </例外>
</ADPlus>

```

将其保存在 stackoverflow.cfg
然后你可以去：

adplus -c stackoverflow.cfg

编辑：**sov**和**sbo**都是堆栈溢出异常。我想人们需要对两者进行试验，因为我不太清楚两者之间的区别是什么。（可能**sbo**表示无效的 alloca() 调用？）

# php - 在第一个循环的 while 循环内显示一次文本

> ID：831501
> 
> 赞同：4
> 
> 时间：2009-05-06T20:09:53.920
> 
> 标签：php, while-loop

```
<?php

$i = 0;

while(conditionals...) {

if($i == 0)
  print "<p>Show this once</p>";

print "<p>display everytime</p>";
$i++;
}
?> 
```

只要while循环通过，这是否只会在第一次和唯一一次显示“显示一次”，并显示“每次显示”？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-06T20:11:39.440

确实是的。

您还可以结合 if 和增量，这样您就不会忘记增量：

```
if (!$i++) echo "Show once."; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-06-04T13:01:15.747

与其在每次循环运行时递增它并浪费无用的资源，您可以做的是，如果该值第一次为 0，则打印该语句并将变量的值设为非零。就像一面旗帜。条件，您不会在某处的循环之间更改变量的值。像这样的东西：

```
<?php

   $i = 0;

   while(conditionals...) {

      if($i == 0){
        print "<p>Show this once</p>";
        $i=1;
      }

      print "<p>display everytime</p>";
   }
?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T20:12:37.923

是的，只要循环中没有任何内容将 $i 设置回 0

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T20:12:51.590

是的，除非条件从一开始就为假或 $i 在循环内设置为 0

# c# - Process.Kill() 相关的崩溃

> ID：831507
> 
> 赞同：2
> 
> 时间：2009-05-06T20:11:26.850
> 
> 标签：c#

或不！

我有一个相当简单的应用程序计时器程序。该程序将启动用户选择的（从文件对话框）可执行文件，然后在用户指定的分钟数后终止该过程。在测试过程中，我发现当我调用 Process.Kill() 方法并且应用程序被最小化到系统托盘时会发生崩溃。

有问题的可执行文件是我经常使用的 Frap.exe，这也是我首先编写应用程序计时器的原因。我总是尽量减少托盘的碎片，这就是崩溃发生的时候。

我对 Kill() 的使用非常简单......

```
while (true)
        {
            //keep checking if timer expired or app closed externally (ie. by user)
            if (dtEndTime <= DateTime.Now || p.HasExited)
            {
                if (!p.HasExited)
                    p.Kill();
                break;
            }
            System.Threading.Thread.Sleep(500);
        } 
```

在寻找以编程方式关闭外部应用程序的替代方法时，我发现只有 Close() 和 Kill() （CloseMainWindow 对我根本没有帮助）。我尝试使用 Close()，它可以在应用程序最小化托盘的情况下工作。如果应用程序被最小化， Close() 不会导致崩溃，但应用程序保持打开和活动状态。我在一些关于关闭外部应用程序的帖子中注意到的一件事是评论：“我个人会尝试找到一种更优雅的方式来关闭它。” 在堆栈流中找到的[这个](https://stackoverflow.com/questions/673031/process-close-is-not-terminating-created-process-c)线程中制作（对约翰没有冒犯）。问题是，我在一些网站上遇到过这样的评论，没有尝试过优雅或优雅（或无崩溃！！）的方法可能是什么。

有什么建议么？

经历的崩溃并不一致，我几乎无法提供细节。当我收到消息时，我无法使用 VS2008 进行调试 - 无法调试崩溃的应用程序（或类似的东西），并且取决于我当时运行的其他程序，当调用 Kill() 时，其中一些也会崩溃（还有程序仅在托盘中运行）所以我认为这是与系统托盘特别相关的某种问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T21:31:49.810

您的代码是否可能以某种方式执行，以至于有时会调用 Kill() 语句两次？在 Process.Kill() 的文档中，它说 Kill 异步执行。因此，当您调用 Kill() 时，会在您的主线程上继续执行。此外，文档指出，如果您在已经处于关闭过程中的应用程序上调用 Kill，它将引发 Win32Exception。文档声明您可以使用 WaitForExit() 等待进程退出。如果在调用 Kill() 之后立即调用 WaitForExit() 会发生什么。循环看起来不错（使用 break 语句）。您是否有可能让代码两次进入该循环？

如果这不是问题，也许还有另一种方法可以捕获该异常：尝试挂钩 AppDomain.CurrentDomain.UnhandledException 事件（currentDomain 是静态成员）

问题是 Kill 异步运行，所以如果它抛出异常，它就会发生在不同的线程上。这就是您的异常处理程序没有捕获它的原因。此外（我认为）未处理的异步异常（这是我相信您所拥有的）将导致您的应用程序立即卸载（这就是正在发生的事情）。

**编辑：挂钩 UnhandledExceptionEvent 的示例代码** 这是一个简单的控制台应用程序，它演示了 AppDomain.UnhandledException 的使用：

```
 using System;
public class MyClass
{
    public static void Main()
    {
        System.AppDomain.CurrentDomain.UnhandledException += MyExceptionHandler;
        System.Threading.ThreadPool.QueueUserWorkItem(DoWork);
        Console.ReadLine();
    }

    private static void DoWork(object state)
    {
        throw new ApplicationException("Test");
    }

    private static void MyExceptionHandler(object sender, System.UnhandledExceptionEventArgs e)
    {
        // get the message
        System.Exception exception = e.ExceptionObject as System.Exception;
        Console.WriteLine("Unhandled Exception Detected");
        if(exception != null)
            Console.WriteLine("Message: {0}", exception.Message);
        // for this console app, hold the window open until I press enter
        Console.ReadLine();
    }

}

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T20:32:28.733

我的第一个想法是在 Kill() 调用周围放置一个 try/catch 块，并记录你得到的异常，如果有的话。它可能会让你知道出了什么问题。就像是：

```
try 
{
    if(!p.HasExited)
    {
        p.Kill();
    }
    break;
}
catch(Exception ex)
{
    System.Diagnostics.Trace.WriteLine(String.Format("Could not kill process {0}, exception {1}", p.ToString(), ex.ToString()));
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T01:49:10.067

我认为我不应该声称这是“答案”，但它是一个不错的“解决方法”。将以下内容添加到代码行中...

```
p.WaitForInputIdle(10000);
am.hWnd = p.MainWindowHandle; 
```

...停止了崩溃问题。这些行紧跟在 Process.Start() 语句之后。两条线都是必需的，在使用它们时，我打开了其他一些问题的大门，我将在接下来的几天内调查这些问题。第一行只是等待启动的进程“空闲”（即完成启动）最多 10 秒。am.hWnd 是我的 IntPtr 类型的 AppManagement 类中的一个属性，这是分配双方的唯一用法。由于缺乏更好的解释，这两条线与去抖动方法是相似的。

我只稍微修改了 while 循环，以允许调用 CloseMainWindow()，这似乎是更好的选择 - 尽管如果失败，我会 Kill() 应用程序：

```
while (true)
{
   //keep checking if timer expired or app closed externally (ie. by user)
   if (dtEndTime <= DateTime.Now || p.HasExited)  {
      try {
          if (!p.HasExited)  // if the app hasn't already exitted...
          {
             if (!p.CloseMainWindow())  // did message get sent? 
             {
                if (!p.HasExited)  //has app closed yet?
                {
                   p.Kill();  // force app to exit
                   p.WaitForExit(2000);  // a few moments for app to shut down
                }
             }
             p.Close();  // free resources
          }                        
       }
      catch { // blah blah }
      break;
   }
   System.Threading.Thread.Sleep(500);
} 
```

我获取 MainWindowHandle 的最初目的是最大化/恢复应用程序（如果已最小化），我可能会在不久的将来实现它。我决定看看其他程序是否像 Fraps 一样运行（即，一个 UI，但主要在系统托盘中运行（如 Yahoo 等的 messanger 服务））。我用 XFire 进行了测试，但我无能为力地返回 MainWindowHandle 的值。无论如何，这是一个单独的问题，但我觉得很有趣。

PS。JMarsch 有点功劳，因为他的建议 RE: Win32Exception 实际上让我找到了这个工作 - 看起来不太可能。

# java - ByteArrayOutputStream 到 CharBuffer

> ID：831511
> 
> 赞同：0
> 
> 时间：2009-05-06T20:12:31.747
> 
> 标签：java, encoding, bytearrayoutputstream

我有一个输入 ByteArrayOutputStream，需要将其转换为 CharBuffer。

我试图避免创建一个新字符串。有没有办法做到这一点。

我正在尝试执行以下操作，但我没有字符串的编码，因此下面的代码将不起作用（无效输出）。

```
ByteBuffer byteBuffer = ByteBuffer.wrap(byteOutputStream.toByteArray());
CharBuffer document = byteBuffer.asCharBuffer(); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T20:16:41.283

您必须提供编码。班级应该如何知道如何转换。您不能在写入 ByteOutputStream 或完全避免流之前确定编码。如果不是，您必须做假设并且可能会失败

提供编码，您可以将字节缓冲区转换为字符缓冲区

```
Charset charset = Charset.forName("ISO-8859-1");
CharsetDecoder decoder = charset.newDecoder();
CharBuffer charBuffer = decoder.decode(yourByteBuffer); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T21:07:50.100

`ByteBuffer.asCharBuffer`给你一个非常字面`byte`的 s to `char`（大端或小端），更新反映在两个缓冲区中。

大概你想通过一些合理的编码从`byte`s 到s 。`char`有很多方法可以做到这一点。例如 [new String(byte[], String encoding)][1]。大多数情况下，它们会以某种形式通过[CharsetEncoder](http://file:///C:/Users/tackline/sun/docs/api/java/nio/charset/CharsetEncoder.html)。那么`CharBuffer`从那里得到一个应该很简单。

`CharBuffer`是一种相当低级的东西。你确定这真的是你想要的吗？

[1]: [http://file:///C:/Users/tackline/sun/docs/api/java/lang/String.html#String(byte[]](http://file:///C:/Users/tackline/sun/docs/api/java/lang/String.html#String(byte[]) , java.lang.String)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T21:11:28.050

`ByteBuffer.asCharBuffer()`假定字节为 UTF-16。（我在文档中找不到任何明确说明这一点的内容，但实现只是将字节对视为字符的低字节和高字节。）如果您需要另一种编码，则必须使用不同的方法。

最简单的方法是创建一个`String`：

```
CharBuffer document = CharBuffer.wrap(byteOutputStream.toString(encoding)); 
```

我知道您说您“试图避免创建新字符串”，但是您的代码片段无论如何都分配了一个单独的字节数组（`ByteArrayOutputStream.toByteArray()`根据文档“创建一个新分配的字节数组”）。因为`CharBuffer`支持随机访问并且许多编码（尤其是 UTF-8）是可变宽度的，所以最好还是先将整个内容转换为字符。

如果您真的只想对字符进行流式访问（而不是随机访问），那么可能`CharBuffer`不是底层代码接受的最佳接口。

# apache-flex - 在 Flex 中将 ImageSnapshot 转换为图像

> ID：831514
> 
> 赞同：3
> 
> 时间：2009-05-06T20:12:56.270
> 
> 标签：apache-flex, actionscript-3

使用 Flex 3，我想拍摄这样的图像快照：

```
var logoSnapshot:ImageSnapshot = ImageSnapshot.captureImage(logoContainer); 
```

并将其变成 Image 类可以使用的东西。我看到有一个名为“data”的属性，它包含一个 byteArray，所以我想我的问题是：如何获取存储为 byteArray 的图像并将其转换为 Image 类可以用来显示的东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T22:39:02.237

应该工作的更简单的实现：

```
var bm : Bitmap = new Bitmap(ImageSnapshot.captureBitmapData(logoContainer)); 
```

将“bm”设置为 Image 对象的来源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:21:08.700

BitmapData 类具有：

```
public function setPixels(rect:Rectangle, inputByteArray:ByteArray):void 
```

将矩形设置为图像的大小，然后发送 byteArray。

然后，您应该能够将 BitmapData 绘制到您的屏幕上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T22:21:35.837

这需要几步，但并不难。

1.  使用 将您的 ByteArray 绘制到 BitmapData 实例[`setPixels()`](http://livedocs.adobe.com/flex/3/langref/flash/display/BitmapData.html#setPixels())。

2.  创建一个新的 BitmapAsset 实例，并传入您的 BitmapData。

3.  将 BitmapAsset 传递给 Image 控件的[`source`](http://livedocs.adobe.com/flex/3/langref/mx/controls/SWFLoader.html#source)属性。

这假设您的 ByteArray 与`setPixels()`. 根据文档，它需要是一组代表 32 位 ARGB 值的无符号整数。如果 ByteArray 以另一种格式保存图像，则您必须找到不同的方式。如果幸运的话，它将被编码为 JPG、PNG 或 GIF，并且您可以将 ByteArray 直接传递给`source`Image，Flash Player 已经知道如何解释它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T13:12:36.787

实际上，您可以直接将 ByteArray 设置为当前 Flex SDK 中 Image 类的源属性。

# perl - 我可以在 glob 运算符中使用 Perl 常量吗？

> ID：831517
> 
> 赞同：2
> 
> 时间：2009-05-06T20:13:21.743
> 
> 标签：perl, constants, glob

我正在解析 XML 文件，例如：

```
while (<files/*.xml>) { ... } 
```

我想使用一个常量来“文件”，比如说

```
use constant FILES_PATH => 'files';
while (<FILES_PATH/*.xml>) { ... } 
```

我希望你理解这个想法，并且可以帮助我:)..

先感谢您。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T20:37:52.480

嗯，这是使用[Readonly](http://search.cpan.org/dist/Readonly/Readonly.pm)而不是常量的原因之一。您可以使用常量`&`的开头或`()`结尾来让 Perl 意识到它是子程序。让我检查一下。

不，但是您可以使用创建 arrayref 的经典技巧来取消引用：

```
#!/usr/bin/perl

use strict;
use warnings;

use constant DIR => "/tmp";

print map { "$_\n" } <${[DIR]}[0]/*>; 
```

但是因为与您可能喜欢`glob "*"`的相同：`<*>`

```
#!/usr/bin/perl

use strict;
use warnings;

use constant DIR => "/tmp";

print map { "$_\n" } glob DIR . "/*"; 
```

我可能会说

```
#!/usr/bin/perl

use strict;
use warnings;

use Readonly;

Readonly my $DIR => "/tmp";

print map { "$_\n" } <$DIR/*>; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T23:02:24.850

正如其他人所说，这都是关于字符串插值的。

常量 pragma 在插值上下文中失败，因此您必须使用可行的方法。

如前所述，Readonly 是一种选择。

您还可以使用旧的“将只读值分配给 typeglob 技巧”。

```
our $FILES_PATH; # declare FILES_PATH scalar to keep strict happy.
*FILES_PATH = \'files';  # Assign to typeglob so $FILES_PATH points to a string literal  

while( <$FILES_PATH/*.xml> ) {
    # read the files
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-06T20:27:08.903

在这种情况下，“/”肯定会被视为除法，而且不太可能去任何地方。我认为您可能需要退后一步，看看您还有哪些其他选择。我认为您正在尝试进行“文件通配”，尽管我不记得细节，但我似乎记得 perl 对此的支持。CPAN 中有一个“Glob”模块，您可能想查看它。就我个人而言，我会更加行人，只需使用 DirHandle 并使用“下一个 ... 除非 ...”行过滤掉非 xml 文件。

# asp.net-mvc - 将 ViewData 分配给嵌套母版页

> ID：831518
> 
> 赞同：7
> 
> 时间：2009-05-06T20:13:29.857
> 
> 标签：asp.net-mvc, master-pages, nested

有没有将 ViewData 分配给嵌套母版页的好方法？例如，在我的顶级母版页中，我可能有登录用户的信息。我还有一个嵌套母版页，当用户在任何部门页面上时会显示该母版页。我希望这些数据仅在部门页面上可用。

这就是它的外观：

```
Top Level Master Page - Includes ViewData["userData"]
    |
    |
    ---> Nested Master Page - Includes ViewData["departmentalData"] 
```

因此，每当我有一个使用嵌套母版页的视图时，它将同时包含 ViewData["userData"] 和 ViewData["departmentalData"]。但如果我只使用顶级母版页，那么我只有 ViewData["userData"]。这可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-18T06:17:46.657

如果您坚持使用 ViewData 作为母版页的数据载体（而不是使用我可能会使用的 MvcContrib 项目中的 Html.RenderAction(...)），那么如果您可以确定在哪些情况下嵌套母版页将是使用时，您可以设置一个 ActionFilter 将所需的数据输入到 ViewData["departmentalData"]。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:16:47.087

一种可能性是在 ViewPage 和 ViewMasterPage 上编写扩展方法来获取您需要的数据。我不确定，但我认为这就是 Rob Conery 在他的[Commerce.MVC](http://mvcsamples.codeplex.com/)包中所做的。看看那个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-05T20:21:07.107

我们遇到了同样的问题。到目前为止，我们提出了所有控制器的基类和生成 ViewData 的受保护方法。我们从使用此特定母版页的所有操作中调用它。

我一定会关注这个问题，看看其他人想出了什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-07T17:28:12.983

MVC 有一个子控制器的概念（我不确定这是否仍然存在并且会在 MVC 框架中出现）。您可以在 codeplex 上的 mvc contrib 项目中找到它。一些描述或博客文章可以在这里找到...

[http://mhinze.com/subcontrollers-in-aspnet-mvc/](http://mhinze.com/subcontrollers-in-aspnet-mvc/)

并在此处讨论将对象传递给该子控制器...

[http://mhinze.com/passing-objects-to-subcontrollers/](http://mhinze.com/passing-objects-to-subcontrollers/)

这不是基于母版页，但可以帮助您...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-11T17:52:06.423

只要您的控制器为将要查看的页面设置正确的 ViewData，那么使用多少母版页就无关紧要了。还是我错过了什么？

# c# - 使用 GROUP BY 功能在 ADO.NET 中聚合函数

> ID：831519
> 
> 赞同：2
> 
> 时间：2009-05-06T20:14:01.650
> 
> 标签：c#, ado.net, group-by, dataview, aggregate-functions

这是一个更直接的问题，源于[我之前提出的一个更普遍的问题，](https://stackoverflow.com/questions/828356/allowing-a-user-to-create-a-custom-query-of-a-table/)现在我花了更多时间研究 ADO.NET

我想使用 ADO.NET DataTable 并在某些列上使用聚合函数（例如 SUM）执行 SQL SELECT 查询，并为其余列设置 GROUP BY。然后我想获取结果并将其显示在 DataGrid 中。

我知道我可以创建包含过滤条件和聚合函数的 DataTable 的 DataView。但是[表达式上的 MSDN 页面](http://msdn.microsoft.com/en-us/library/system.data.datacolumn.expression.aspx)说

*“如果您使用单个表来创建聚合，则不会有分组功能。相反，所有行都会在列中显示相同的值。”*

如何在不将我的表写入单独的数据库并在那里运行查询的情况下从 ADO.NET 中获取 GROUP BY 类型功能？有没有办法通过创建或使用第二个表来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T20:55:55.183

您可以使用 LINQ 的分组功能来完成此操作。此外，您可以将 DataGrid 绑定到 LINQ 查询，但数据将是只读的。

对 LINQ 分组的 Web 搜索应该可以让您找到您要去的地方。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-05T13:41:21.017

以下是使用 .NET 3.x 及更高版本 (LINQ) 的方法：

[http://codecorner.galanter.net/2009/12/17/grouping-ado-net-datatable-using-linq/](http://codecorner.galanter.net/2009/12/17/grouping-ado-net-datatable-using-linq/)

这是使用 .NET 2.0 及更低版本（标准 ADP.NET）的方法

[http://codecorner.galanter.net/2009/04/20/group-by-and-aggregates-in-net-datatable/](http://codecorner.galanter.net/2009/04/20/group-by-and-aggregates-in-net-datatable/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T21:10:23.060

一种解决方法是使用反射将您的 linq 查询结果转换为 DataTable。这是一个例子。一旦你有了一个数据表，你将拥有完整的 groupby、paging 等......

```
 private static System.Data.DataTable ObjectArrayToDataTable(object[] data)
    {
        System.Data.DataTable dt = new System.Data.DataTable();
        // if data is empty, return an empty table
        if (data.Length == 0) return dt;

        Type t = data[0].GetType();
        System.Reflection.PropertyInfo[] piList = t.GetProperties();

        foreach (System.Reflection.PropertyInfo p in piList)
        {
            dt.Columns.Add(new System.Data.DataColumn(p.Name, p.PropertyType));
        }

        object[] row = new object[piList.Length];

        foreach (object obj in data)
        {
            int i = 0;
            foreach (System.Reflection.PropertyInfo pi in piList)
            {
                row[i++] = pi.GetValue(obj, null);
            }
            dt.Rows.Add(row);
        }

        return dt;
    }

    internal static DataTable GetAllStoredFileDetailsByUserID(int userID)
    {
        var db = GetDataContext();
        object[] result;
        try
        {
            result = (from files in db.Files
                      where files.OwnerUserID == userID && files.IsThumbnail == false
                      select new
                      {
                          FileID = files.FileID,
                          Name = files.Name,
                          DateCreated = files.DateCreated,
                          Size = files.Size,
                          FileHits = (from act in db.FileWebActivities where act.FileID == files.FileID select act).Count()
                      }).ToArray();
        }
        catch (Exception)
        {
           //omitted
        }
        return ObjectArrayToDataTable(result);
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-12T12:49:50.413

[http://weblogs.asp.net/fmarguerie/archive/2007/09/05/linq-support-on-net-2-0.aspx](http://weblogs.asp.net/fmarguerie/archive/2007/09/05/linq-support-on-net-2-0.aspx)

# ajax - 使用 SharedObject 进行客户端持久性？

> ID：831521
> 
> 赞同：2
> 
> 时间：2009-05-06T20:14:17.233
> 
> 标签：ajax, flash, actionscript-3

有没有人使用 Flash 的 SharedObject 机制进行客户端持久性？有大嘎查吗？尺寸限制？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T21:06:29.637

使用 AS3 的 SharedObjects 非常简单，但是有一些需要注意的地方。但没什么太严重的。

*   **尺寸限制**。是的，每个站点有 100kb 的限制。当达到此限制时，用户会收到一个小弹出窗口，要求仅增加您网站的限制。您可以通过右键单击嵌入的 SWF 并转到“*设置>本地存储*”来更改自己的限制。

*   **数据类型**。您可以存储在 Flash 中工作的任何数据类型。

*   **调试**。通常，查看共享对象中实际存储的内容对于调试很有用。有很多工具可以做到这一点，但我会推荐[来自 Sephiroth 的 SharedObject Reader](http://www.sephiroth.it/python/solreader.php)。FlashDevelop 还提供了一个版本。

*   **安全**。SharedObjects几乎没有“安全性”，它们*基本上*是一个没有加密的文本文件，所以不要用它们来存储用户名和密码。但请记住，只有创建 SharedObject 的站点才能访问它（以及具有文件系统访问权限的任何人/任何事物）。

*   **位置**。*您可以在“ C:/Documents and Settings/[USERNAME]/Application Data/Macromedia/Flash Player/#SharedObjects/* ”中找到实际的 .SOL 文件（在 Windows XP 上）

*   **重置**。我发现我的 SharedObject 经常会停止工作，因为在开发过程中，已经存储了损坏的数据。在这种情况下，最好的办法就是删除 .SOL 文件并重新开始。

希望这可以帮助。A 肯定会阅读[HOWTO: SharedObjects for Local Storage AS3](http://drawlogic.com/2008/01/10/howto-sharedobjects-for-local-storage-as3/)以获取有关如何实际使用 SharedObjects 的更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T20:27:18.310

关于[SharedObjects](http://learn.adobe.com/wiki/display/Flex/Shared+Objects)文档你应该记住的事情：

*   默认情况下，它们不会过期。
*   默认情况下，它们的大小限制为每个 100 KB。
*   它们可以存储简单的数据类型（如字符串、数组和日期）。
*   它们存储在应用程序指定的位置（在用户的主目录中）。
*   它们永远不会在客户端和服务器之间传输。
*   使用 getLocal() 创建共享对象。(SharedObject.getLocal("myTasks"); )
*   使用 flush() 将共享对象写入客户端文件。(sharedObj.flush())
*   使用 clear() 销毁共享对象 (sharedObj.clear())

另外，请注意，保存数据的位置取决于所使用的浏览器。

所以，是的，这对于存储简单数据绝对有好处。

# .net - TableLayoutPanel 控件 - 从水平滚动锁定列？

> ID：831525
> 
> 赞同：2
> 
> 时间：2009-05-06T20:15:00.120
> 
> 标签：.net, winforms, scroll, tablelayoutpanel

我在 Windows 窗体应用程序中使用 TableLayoutPanel 以类似网格的方式组织一组控件。我想锁定 TableLayoutPanel 的第一个控件列，以便在用户应用水平滚动条时它保持固定。任何指导表示赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-24T17:54:54.930

右键单击设计器中的 TableLayoutPanel 并选择“编辑行和列...”。然后将第一列设置为使用绝对宽度而不是百分比。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-29T17:12:55.570

我认为对于您想要做的事情，您需要创建一个两列 TableLayoutPanel，然后在每列中创建一个额外的 TableLayoutPanel。在您想要允许滚动的一侧，为其子 TableLayoutPanel 设置 AllowScroll = true，在您不想滚动的一侧，为其子 TableLayoutPanel 设置 AllowScroll = false。

# dynamic-language-runtime - Microsoft 在生产环境中是否支持 DLR 0.9

> ID：831526
> 
> 赞同：2
> 
> 时间：2009-05-06T20:15:12.053
> 
> 标签：dynamic-language-runtime, production-environment

我知道 DLR 将与 C# 4.0 一起发布，但我不知道什么时候会发布。同时，如果有人想在生产环境中使用 DLR（没有硬件实时系统），他/她是否应该考虑将其推迟到 C# 4.0 出现？

我要问的是：微软支持现有的 0.9 版吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-01T15:58:23.877

如果“支持”是指 Microsoft CSS（客户支持服务），那么不，不支持 DLR 0.9。[但是在CodePlex DLR](http://www.codeplex.com/dlr)站点以及 IronPython 和 IronRuby 邮件列表等地方有很好的社区支持——包括一些 DLR 开发人员的支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-26T19:44:36.687

我假设您将使用依赖 DLR 的语言。现在 IronPython 2.0 及更高版本 (2.6) 已准备好生产。IronRuby 正在达到 0.9 版本，很快就会达到 1.0。

无需等待 C# 4.0 可用。

与基于 DLR 的语言集成的托管 API 是可靠的。我们一直在生产环境中使用 DLR。

# .net - 只更新填写的属性

> ID：831527
> 
> 赞同：0
> 
> 时间：2009-05-06T20:15:55.780
> 
> 标签：.net, nhibernate

有没有办法让 NHibernate 只更新没有填写默认值的字段？假设我们有这个简单的类：

```
public class Person
{
    public int Id { get; set; }
    public string Name { get; set; }
    public int Age { get; set; }
} 
```

我们还有一个标准的 NHibernate 映射，它使用每个字段的属性和 Id 字段的 Id。

假设我们想要一个页面只更新名称，所以我们发送 Id，将其存储在隐藏字段中，并显示名称的文本框。用户修改名称并点击保存。我们 POST 回来，新建一个 Person 对象，并分配传入的 Id 和 Name。然后我们告诉 NHibernate 更新数据库。

问题是，年龄显然在数据库中被设置回 0，因为它没有从 POST 返回。最明显的解决方法是将 Age 值发送到页面，将其存储在隐藏字段中，然后在保存之前将其填回。直到您在对象上获得更多属性并且只想在屏幕上修改一个充满它们的手（或大量 Person 对象，这可能需要在隐藏字段中存储大量值）之前，这都可以正常工作。

回到问题的主题：有没有办法告诉 NHibernate 基本上忽略 Age 属性，因为它在更新之前有一个默认值 (0)，或者我是否坚持要保留大量隐藏字段现有的价值观？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T20:47:44.673

在回帖中，使用 Id 从存储库中检索持久化实体并仅更新名称并将其持久化。这样，您不需要维护隐藏字段中的值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:30:48.333

这听起来有点可疑。通常，当您编辑 Hibernate 实体时，您首先从数据库中加载它，对其进行更改，然后将其保存回数据库。您通常不会创建新对象，设置其 ID 和任何任意属性，然后保存新对象，因为正如您所说，任何未设置的属性很可能会设置为默认值。

通过从数据库中加载它，所有属性都被适当地填充，因此您不必担心自己维护这些状态。Hibernate 会话负责维护这些对象的状态，直到您将它们保存并刷新到数据库中。

有不同的策略来处理跨 Web 请求的休眠会话。查看这篇文章： [http](http://hibernatebp.blogspot.com/) ://hibernatebp.blogspot.com/ - 查看会话管理策略。“带有分离对象的每个请求的会话”在您的情况下可能很好。

# cocoa - 哪种检查 NSDictionary 是否包含特定键的方法更快？

> ID：831528
> 
> 赞同：32
> 
> 时间：2009-05-06T20:15:57.247
> 
> 标签：cocoa, performance, nsdictionary

我可以通过两种方式测试 NSDictionary 中是否存在键：

```
BOOL containsKey = [[dictionary allKeys] containsObject:foo];

BOOL containsKey = ([dictionary objectForKey:foo] != nil); 
```

哪种方法更快，为什么？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-05-06T20:36:58.007

一般来说，哈希查找应该比遍历所有字典键、从它们创建一个数组（内存分配相对昂贵）然后搜索数组（甚至不能是二进制搜索，因为数组没有排序）更快.

不过，为了科学起见，我制作了两个可执行文件，它们只执行每种样式 100 万次，并对它们进行计时。

使用 allKeys：

```
real    0m4.185s
user    0m3.890s
sys     0m0.252s 
```

使用 objectForKey：

```
real    0m0.396s
user    0m0.189s
sys     0m0.029s 
```

显然，各种因素都会影响这一点——字典的大小、缓存 allKeys 返回值等。不过，我不希望出现数组搜索比字典查找更快的情况。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-06T20:21:29.353

我看不出请求 allKeys 数组可能会更快，否则 NSDictionary 至少会在内部执行等效操作。

编辑：我想你可以构建一个`allKeys`方法更快的案例 - 例如，通过在你的密钥方法中花费很长时间`hash`，而不是在你的`isEqual:`方法中。你也可以在一个疯狂的实现`NSDictionary`中交换它们（因为`NSDictionary`是抽象的。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T21:27:38.663

在考虑这样的性能问题时，请记住，Foundation 数据类会根据您在其中存储的对象数量来交换其底层数据结构。例如，我认为一个小的 NSArray 实际上使用哈希表进行存储，直到它达到一定的大小。

# asynchronous - Lua 中的异步输入

> ID：831531
> 
> 赞同：1
> 
> 时间：2009-05-06T20:16:36.293
> 
> 标签：asynchronous, input, lua

[在一个相关问题中，我询问了如何通过 IUP 获取输入](https://stackoverflow.com/questions/821893/getting-input-with-iup-in-lua)。这工作得很好，除了它通过系统，并且受制于对游戏来说不是最佳的重复率。我真正想要的是在给定时间获得任何键的当前状态的能力。有没有办法做到这一点（通过 IUP 或其他方式）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T00:05:38.800

您可能需要包装对适当 Win32 API、DirectX 或 lua 模块中的任何内容的调用。在 IUP 中捕获击键事件需要通过“正常”Windows 消息机制将其传递到窗口或控件，并且可能不是游戏框架中的最佳方法。

您可以使用 IUP 计时器对象按计划运行重绘，但您仍然需要一种收集键盘状态的方法。如果您想使用游戏手柄、操纵杆或键盘和鼠标以外的任何 HID，那么 IUP 在任何情况下都不会直接提供帮助。

只需将少量 C 代码编译为 DLL，即可轻松完成此操作。

对于某些 API，使用[SWIG](http://www.swig.org/)可以很容易地完成它。其他人将进行足够的设置/拆卸工作，以使手工包装更容易。

还有 Lua 的[Alien](http://alien.luaforge.net/)模块，它允许从纯 Lua 直接调用任意 API。Alien 包含在[Lua for Windows](http://luaforwindows.luaforge.net/)中，以及通过其在 Luaforge 的项目页面。Alien 本身甚至可以跨平台移植，尽管你不会用它来调用它。

在您追求这条道路时，还有其他需要注意的是一个或多个现有的游戏引擎。通常，这些将事件循环隐藏在引擎内部（IUP 也是如此），但它们针对游戏构建而不是桌面应用程序进行了优化。

我在 Lua 邮件列表中听说过一些谣言。因为经常提到它而想到的一个是[LÖVE](http://love2d.org/)。

# perl - 是否有一个 Perl 模块来连接 Google Contacts API？

> ID：831535
> 
> 赞同：3
> 
> 时间：2009-05-06T20:17:13.950
> 
> 标签：perl, contact

我想编写一个命令行程序来将联系人添加到 GoogleMail。 [WWW::Contact::GoogleContact](http://search.cpan.org/dist/WWW-Contact-GoogleContactsAPI)似乎只能从 Google 获取内容。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T04:20:29.483

我认为您想要的是[Google Data API](http://code.google.com/apis/contacts/)。联系人 API 是只读的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-03T09:16:44.520

我刚刚在 WWW::Contact::GoogleContactsAPI 的输出中添加了加载更多字段，但正如 Brian 所说，它目前是只读的。我将尝试尽快发布此版本，然后我将考虑使其成为双向。

还有其他人在使用/使用这个模块吗？想要对我的代码进行 alpha 测试？

这个模块是通用联系人类的一个子类，尽管它是非常简约的。因此，我想找到一个好的“标准”数据模型，而不是仅仅以 Google 选择的形式提供数据。我发现的最好的是 [http://www.opensocial.org/Technical-Resources/draft/Social-Data.xml#Person](http://www.opensocial.org/Technical-Resources/draft/Social-Data.xml#Person) 虽然它可能太 Facebook 而不是 Outlook/Exchange。有人知道一个好的联系人数据模型吗？

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-06T20:21:09.213

你看过万维网：机械化吗？

# sql-server-2008 - 无法连接到 SQL Server 2008

> ID：831545
> 
> 赞同：4
> 
> 时间：2009-05-06T20:19:06.740
> 
> 标签：sql-server-2008

我正在开发一个用 VB6 编写的应用程序，但无法连接到我们办公室的服务器上设置的 SQL Server 2008 数据库。

以下是症状：

*   当我尝试在 VB6 中通过 ADO 使用连接字符串进行连接时，VB6 挂起，然后最终给我错误：“运行时错误 '-2147467259 (80004005)': [Microsoft][ODBC SQL Server Driver][DBNETLIB]SQL服务器不存在或访问被拒绝。”
*   如果我创建一个空白的 .udl 文件并双击它，在“数据链接属性”对话框的“连接”选项卡中，在“选择或输入服务器名称”的下拉列表中，如果我单击下拉列表查看列表或单击“刷新”按钮，它挂起。
*   当我尝试通过 SQL Server 2005 Management Studio 连接时（SQL Server 2005 安装在我正在处理 VB6 程序的客户端计算机上），当我尝试通过以下方式连接时：

    *   **TCP/IP**：我收到消息“此版本的 Microsoft SQL Server Management Studio 只能用于连接 SQL Server 2000 和 SQL Server 2005 服务器。(ConnectionDlg)”
    *   **共享内存**：我收到消息“在建立与 SQL Server 的连接时发生与网络相关或特定于实例的错误。未找到或无法访问服务器。验证实例名称是否正确以及 SQL Server 配置为允许远程连接。（提供程序：SQL 网络接口，错误：41 - 无法打开与远程 SQL 服务器的共享内存连接）（Microsoft SQL Server，错误：87）“
    *   **命名管道**：“在建立与 SQL Server 的连接时发生与网络相关或特定于实例的错误。找不到服务器或无法访问该服务器。验证实例名称是否正确以及 SQL Server 是否配置为允许远程连接。 （提供程序：命名管道提供程序，错误：40 - 无法打开与 SQL Server 的连接）（Microsoft SQL Server，错误：1326）"

以下是我在网上看到的一些我已经实施的常见建议解决方案（当然还没有解决这个问题）：

*   SQL Server 2008 中已启用远程连接
*   远程登录到端口 1433 给我一个空白屏幕（即，它连接，它没有给我一个错误）
*   服务器上的 netstat -a 显示 TCP 端口 1433 已打开
*   混合身份验证已在 SQL Server 2008 上设置，因此它可以接受 Windows 身份验证或 SQL Server 身份验证

我真的走到了尽头，不知道该去哪里，因为我不知道在哪里（甚至是否）有详细的日志可以浏览，这些日志会告诉我连接尝试何时开始，并且每一步会发生什么。我希望对此有一个简单的解决方法，但我的知识不够了解。

*更新*：以下是迄今为止提出的后续问题的答案：

*   操作系统：Vista 64 位，在客户端和服务器上
*   根据 SQL Server 配置管理器，SQL Browser Server 正在服务器上运行
*   连接字符串 - VB 程序中有问题的行是：fooSQL.Open "SERVER=SERVERNAME;DRIVER=SQL Server;DATABASE=DATABASENAME"，用户名，密码（其中 fooSQL 是 ADODB.Connection）
*   当防火墙在客户端或服务器（或两者）上关闭时仍然会发生

*回复：MDAC*

根据[这篇维基百科文章](http://en.wikipedia.org/wiki/Microsoft_Data_Access_Components#Which_Version_do_I_have.3F)，我检查了 HKEY_LOCAL_MACHINE\Software\Microsoft\DataAccess\FullInstallVer，值为“6.0.6001.18000”。我还运行了组件检查器，并在启动时单击“对您的机器进行分析并自动确定发布版本”，单击“确定”后收到以下消息：

“匹配了以下产品版本：

未知”

*更新：SQL 服务* 回复：gator 的评论，这里是在计算机管理 > 服务中的服务器上运行的 SQL 服务

*   SQL Active Directory 帮助程序服务
*   SQL 全文过滤器守护程序启动器 (MSSQLSERVER)
*   SQL 服务器 (MSSQLSERVER)
*   SQL Server 代理 (MSSQLSERVER)
*   SQL Server 分析服务 (MSSQLSERVER)
*   SQL Server 浏览器
*   SQL Server 集成服务 10.0
*   SQL Server 报告服务 (MSSQLSERVER)
*   SQL Server VSS 编写器

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T20:25:23.900

请确保以下几点：

*   Windows 防火墙未阻止端口 1433（或您为 SQL Server 设置的 TCP 端口）
*   SQL Browser 服务正在服务器上运行（参见：http: [//msdn.microsoft.com/en-us/library/ms181087.aspx](http://msdn.microsoft.com/en-us/library/ms181087.aspx)）

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-09-22T08:59:09.157

一个非常重要的问题与在 MSSQLSERVER 之后安装 Active Directory 相关！首先我要写的是，如果你想在Active Directory**之后安装它，你会收到一条来自 MS SQL 的消息！**所以你需要在AD之前安装MS SQL。

**检查常见问题后，例如：**

1-通过右键单击服务器名称并单击“属性”，然后从左侧菜单中选择“连接”，在“SQL Manager”中允许远程连接到该服务器。

2- 在“SQL Server 配置管理器”的“SQL Server 网络配置”中启用 TCP/IP。

3- 在“SQL Server 配置管理器”的“SQL Server 网络配置”中启用命名管道。

4- 确保在“SQL Server 配置管理器”的“SQL Server 服务”中启动了“SQL Server Browser”。

5- 在“本地计算机上具有高级安全性的 Windows 防火墙”中为 MSSQLSERVER 打开端口 1433（默认）

最后请确保 Active Directory 处于活动状态。

我的问题是，我删除了 Active Directory，但我忘记了用户仍在域空间中，所以我必须重新安装“Active Directory 域服务”。

最良好的问候

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-09-27T20:13:01.783

Jordan（或其他人在未来阅读此书），至少一个解决此类问题的方法是确保同时指定服务器名称和实例名称（即使各种工具，如迁移协助或连接字符串，如如上所示）只提示输入服务器名。

因此，例如，在您的情况下，它似乎应该是 serverfoo-pc\mssqlserver。或者一个正在运行的 Express 将使用 servername\sqlexpress，或者如果有人将实例名称更改为其他名称，请使用它。如果客户端工具与 SQL Server 在同一个盒子上，您可以使用 .\ 而不是 servername\，如 .\sqlexpress。

我认为这就是 Gator 的意思，但在你的来回中没有做出这种澄清。希望能帮助到你。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T20:24:31.920

尝试安装 sql 2008 management studio 并通过 TCPIP 从 vb6 机器连接。我也会尝试安装最新的 (2008) ODBC 驱动程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T21:09:16.667

SQL Server 2008 是作为默认实例还是命名实例安装的？如果它是一个命名实例，那么您需要稍微调整一下您的连接字符串才能与它对话。

当您 RDP 到盒子时，您可以使用客户端工具对本地 SQL Server 实例进行身份验证吗？

# dns - 未配置 DNS 缓存文件

> ID：831546
> 
> 赞同：1
> 
> 时间：2009-05-06T20:19:11.810
> 
> 标签：dns, debian, bind

我刚刚在 Debian 系统上安装了 bind9，我试图了解它是如何工作的以及它在做什么。

令我困惑的是缓存目录中没有创建缓存文件。好吧，实际上在一个层面上我完全理解。在所有的配置文件中，file 指令命名一个以“/etc/bind”开头的文件，即配置文件。有根提示文件和用于环回系统的文件。没有前导“/”就没有配置文件，因此我并不感到惊讶。它也没有被定义为任何域的从属。

因此，如果我理解正确，它会将所有查找缓存在内存中，而不是像我期望的那样缓存在文件中。

现在我想做的是使名称服务器对我的本地专用网络和环回系统具有权威性，但在文件系统上缓存所有其他响应。我可以看到如何做前者，但我看不到我将在哪里放置文件指令以使其缓存所有迭代查找响应。

我可以看到我可以让它成为我能想到的所有顶级域的公开权威服务器的奴隶——但这在很多方面似乎都是错误和脆弱的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T07:11:49.767

BIND never stores its cache on disk, there's simply no need.

It can however be told to dump the current contents to a file for debugging (`rndc dumpdb -cache`).

# javascript - 文本中间的省略号（Mac 风格）

> ID：831552
> 
> 赞同：54
> 
> 时间：2009-05-06T20:21:20.073
> 
> 标签：javascript, jquery, css, truncation

我需要`"..."`在可调整大小的元素内的文本中间实现省略号 ()。[这](http://i40.tinypic.com/29yqslf.jpg)是它可能的样子。所以，

```
"Lorem ipsum dolor sit amet. Ut ornare dignissim ligula sed commodo." 
```

变成

```
"Lorem ipsum dolor sit amet ... commodo." 
```

当元素被拉伸到文本的宽度时，我希望省略号消失。如何才能做到这一点？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-05-06T20:46:23.583

在 HTML 中，将完整值放入自定义 data-* 属性中，例如

```
<span data-original="your string here"></span> 
```

然后将事件侦听`load`器分配`resize`给一个 JavaScript 函数，该函数将读取原始数据属性并将其放置在`innerHTML`您的 span 标签中。以下是省略号函数的示例：

```
function start_and_end(str) {
  if (str.length > 35) {
    return str.substr(0, 20) + '...' + str.substr(str.length-10, str.length);
  }
  return str;
} 
```

调整值，或者如果可能的话，使它们动态化，如果需要的话，对于不同的对象。如果你有来自不同浏览器的用户，你可以在你的 dom 中以相同的字体和大小从文本中窃取参考宽度。然后插入适当数量的字符以供使用。

提示也是在 ... 或 who 消息上有一个缩写标签，以使用户能够获得带有完整字符串的工具提示。

```
<abbr title="simple tool tip">something</abbr> 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2016-04-07T08:15:27.257

我想提出解决这个问题的我的例子。

主要思想是将文本分成两个偶数部分（或者第一个更大，如果长度是奇数），其中一个最后有省略号，另一个右对齐`text-overflow: clip`。

因此，如果您想让 js 自动/通用，您需要做的就是拆分字符串并设置属性。

不过，它有一些缺点。

1.  没有很好的文字包装，甚至是字母（`text-overflow: ''`目前仅在 FF 中有效）
2.  如果单词之间发生分裂 - 空格应该在第一部分。否则，它会崩溃。
3.  字符串的结尾不应该有任何感叹号，因为`direction: rtl`- 它们将被移动到字符串的左侧。我认为，可以通过将单词的右侧部分放入标签中并将感叹号放入`::after`伪元素中来解决此问题。但我还没有让它正常工作。

但是，有了所有这些，它对我来说真的很酷，尤其是当你拖动浏览器的边框时，你可以在 jsfiddle 页面上轻松地做到这一点：[https](https://jsfiddle.net/extempl/93ymy3oL/) ://jsfiddle.net/extempl/93ymy3oL/ 。或者只运行下面固定最大宽度的代码段。

剧透下的GIF：

> [![动图](https://i.stack.imgur.com/usfEA.gif)](https://i.stack.imgur.com/usfEA.gif)

```
body {
  max-width: 400px;
}

span::before, span::after {
  display: inline-block;
  max-width: 50%;
  overflow: hidden;
  white-space: pre;
}

span::before {
  content: attr(data-content-start);
  text-overflow: ellipsis;
}

span::after {
  content: attr(data-content-end);
  text-overflow: '';
  direction: rtl;
}
```

```
<span data-content-start="Look deep into nature, and then you " 
      data-content-end=  "will understand everything better"></span>

<br>
<span data-content-start="https://www.google.com.ua/images/branding/g" 
      data-content-end=  "ooglelogo/2x/googlelogo_color_272x92dp.png"></span>
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2014-06-05T00:04:15.517

所以我的同事想出了一个不使用额外 dom 元素的解决方案。我们检查div是否溢出并添加最后n个字符的数据属性。其余的在 css 中完成。

这是一些HTML：

```
<div class="box">
    <div class="ellipsis" data-tail="some">This is my text it is awesome</div>
</div>
<div class="box">
    <div class="ellipsis">This is my text</div>
</div> 
```

和CSS：

```
.box {
    width: 200px;
}

.ellipsis:before {
    float: right;
    content: attr(data-tail);
}

.ellipsis {
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
} 
```

这是强制性的 jsfiddle：http: [//jsfiddle.net/r96vB/1/](http://jsfiddle.net/r96vB/1/)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-06T20:31:07.927

以下 Javascript 函数将执行中间截断，如 OS X：

```
function smartTrim(string, maxLength) {
    if (!string) return string;
    if (maxLength < 1) return string;
    if (string.length <= maxLength) return string;
    if (maxLength == 1) return string.substring(0,1) + '...';

    var midpoint = Math.ceil(string.length / 2);
    var toremove = string.length - maxLength;
    var lstrip = Math.ceil(toremove/2);
    var rstrip = toremove - lstrip;
    return string.substring(0, midpoint-lstrip) + '...' 
    + string.substring(midpoint+rstrip);
} 
```

它将用省略号替换中间的字符。我的单元测试显示：

```
var s = '1234567890';
assertEquals(smartTrim(s, -1), '1234567890');
assertEquals(smartTrim(s, 0), '1234567890');
assertEquals(smartTrim(s, 1), '1...');
assertEquals(smartTrim(s, 2), '1...0');
assertEquals(smartTrim(s, 3), '1...90');
assertEquals(smartTrim(s, 4), '12...90');
assertEquals(smartTrim(s, 5), '12...890');
assertEquals(smartTrim(s, 6), '123...890');
assertEquals(smartTrim(s, 7), '123...7890');
assertEquals(smartTrim(s, 8), '1234...7890');
assertEquals(smartTrim(s, 9), '1234...67890');
assertEquals(smartTrim(s, 10), '1234567890');
assertEquals(smartTrim(s, 11), '1234567890'); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-05-18T20:12:59.077

这可能有点晚了，但我一直在寻找解决方案，一位同事提出了一个非常优雅的解决方案，我将分享。它需要一些 JS，但不是很多。

想象一下`div`，您需要将标签放入以下尺寸：

```
<div style="width: 200px; overflow: hidden"></div> 
```

现在，您有一个函数，它将接受两个参数：一个带有标签的字符串和一个 DOM 元素（this `div`）以适应它：

```
function setEllipsisLabel(div, label) 
```

您要做的第一件事是`span`使用此标签创建一个，并将其放入`div`：

```
var span = document.createElement('span');
span.appendChild(document.createTextNode(label));
span.style.textOverflow = 'ellipsis';
span.style.display = 'inline-block';
div.appendChild(span); 
```

我们将该`text-overflow`属性设置为“省略号”，以便在文本被截断时，在末尾添加一个漂亮的“...”来说明这一点。我们还设置`display`为“inline-block”，以便这些元素具有我们以后可以操作的真实像素尺寸。到目前为止，没有什么是我们用纯 CSS 做不到的。

但是我们想要中间的省略号。首先，我们应该确定我们是否需要它......这可以通过比较`div.clientWidth`来完成 - 省略号仅在比 宽`span.clientWidth`时才需要。`span``div`

如果我们确实需要省略号，让我们首先说我们希望在单词末尾显示固定数量的字符 - 比如说 10。所以让我们创建一个仅包含标签最后 10 个字符的跨度，并将其粘贴到分区：

```
var endSpan = document.createElement('span');
endSpan.style.display = 'inline-block';
endspan.appendChild(document.createTextNode(label.substring(label.length - 10)));
div.appendChild(endSpan); 
```

现在，让我们覆盖原来的宽度`span`以适应新的宽度：

```
span.style.width = (div.clientWidth - endSpan.clientWidth) + 'px'; 
```

因此，我们现在有一个看起来像这样的 DOM 结构：

```
<div style="width: 200px; overflow: hidden">
   <span style="display: inline-block; text-overflow: ellipsis; width: 100px">
      A really long label is shown in this span
   </span>
   <span style="display: inline-block"> this span</span>
</div> 
```

因为第一个`span`已`text-overflow`设置为“省略号”，所以它会在末尾显示“...”，然后是第二个跨度的 10 个字符，导致省略号大约显示在`div`.

您也不需要对 endSpan 的 10 个字符长度进行硬编码：这可以通过计算' 的初始宽度与`span`' 的初始宽度的比率来近似`div`，从标签的长度中减去适当的比例并除以 2。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-06T20:46:05.503

你不能用 CSS 做到这一点。问题是 HTML 和 CSS 应该适用于各种浏览器和字体，几乎不可能以一致的方式计算字符串的宽度。这是一个可能对您有所帮助的[想法。](http://robrohan.com/2006/01/20/javascript-string-width-in-pixels/)但是，您需要多次这样做，直到找到具有适当宽度的字符串。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-06-09T09:51:59.447

在对 flex box 进行了一些研究之后，我发现了这个纯 CSS 解决方案，我认为它非常酷。

```
<div style="width:100%;border:1px solid green;display:inline-flex;flex-wrap:nowrap;">
   <div style="flex: 0 1 content;text-overflow: ellipsis;overflow:hidden;white-space:nowrap;"> Her comes very very very very very very very very very very very very very very very very very very very long </div>
   <div style="flex: 1 0 content;white-space:nowrap;"> &nbsp;but flexible line</div>
</div> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-10-05T21:35:14.873

这是我能找到的最短的位，它将中间的 3 个字符替换为 ....

```
function shorten(s, max) {
  return s.length > max ? s.substring(0, (max / 2) - 1) + '...' + s.substring(s.length - (max / 2) + 2, s.length) : s
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-11-10T05:43:09.497

我在这里看到的所有解决方案都没有考虑到不同的字符具有不同的宽度。我的解决方案考虑到了这一点。基本上，它会删除一个字符的文本，直到它适合，看看：

```
const span = document.getElementById("span");
const div = document.getElementById("div");
const originalText = span.textContent;
const textLength = originalText.length;
let part1 = originalText.substr(0, Math.floor(textLength/2));
let part2 = originalText.substr(Math.floor(textLength/2));
let trimPart1 = true;
while (span.clientWidth > div.clientWidth) {
    if (trimPart1) {
    part1 = part1.substr(0, part1.length - 1);
  } else {
    part2 = part2.substr(-1 * (part2.length - 1));
  }
    span.textContent = part1 + "..." + part2;
  trimPart1 = !trimPart1;
}
```

```
<div id="div" style="overflow: hidden; width: 200px; white-space: nowrap;">
  <span id="span" style="display: inline-block">this is a quite long text that has some words and I want it to be split in half</span>
</div>
```

[https://jsfiddle.net/maxim_mazurok/oujctpz8/56/](https://jsfiddle.net/maxim_mazurok/oujctpz8/56/)

Mac 的 Finder 以同样的方式工作，它首先尝试剥离左侧部分，然后是右侧部分。所以，它可能有`WWWW...WWWWW`，就像我的解决方案一样。

虽然它不是最有效的。也许，同样可以使用虚拟 DOM 或画布来更好地优化性能。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-05-17T09:04:18.243

该解决方案是上述解决方案的混合，并将最后一个完整的单词放在缩短文本的末尾。但是，如果最后一个单词长于可用空间的三分之一，它也会从左侧缩短。如果找到破折号（“-”），则将其从那里剪掉，如果没有，则将其剪掉。

```
function truncate(text, textLimit) {
    if (!text) return text;
    if (textLimit < 1) return string;
    if (text.length < textLimit) return text;
    if (textLimit === 1) return text.substring(0,1) + '...';
    /* extract the last word */
    var lastPart = text.slice( string.lastIndexOf(' ')+1 );
    /* if last word is longer then a third of the max available space
       cut it from the left */
    var lastPartLimit = Math.ceil(textLimit / 3);
    if(lastPart.length > lastPartLimit) {
        var truncatedLastPart = lastPart;
        /* Try to find a dash and cut the last word there */
        var lastDashPart = text.slice( text.lastIndexOf('-')+1 );
        if(lastDashPart.length < lastPartLimit){
            truncatedLastPart = lastDashPart;
        }
        /* If the last part is still to long or not available cut it anyway */
        if(truncatedLastPart.length > lastPartLimit) {
            var lastIndex = lastPart.length - lastPartLimit;
            truncatedLastPart = lastPart.substring( lastIndex );
        }
        lastPart = truncatedLastPart;
    }
    var dots = '... ';
    var firsPartLength = textLimit - lastPart.length - dots.length;
    return text.substring(0, firstPartLength) + dots + lastPart;
}

console.log( truncate("New York City", 10) ); // Ne... City (max of 10 characters)
console.log( truncate("New York Kindergarden", 14) ); // Ne...ergarden (max of 14 characters, last word gets cut from the left by a third)
console.log( truncate("New York Kinder-garden", 14) ); // Ne...garden (max of 14 characters, last word gets cut by the dash from the left) 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-07-16T10:14:53.587

这是我的看法——一个纯 CSS 的解决方案，遗憾的是现在只能在 Firefox 中使用：

```
div {
  width: 20em;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  text-overflow: " … is also your text.";
}
```

```
<div>Here's the long string of letters that accidentally is also your text.</div>
```

`text-overflow`如果需要动态文本，可以直接在元素上指定第二个声明。不支持这种语法的浏览器（Chrome，尤其是 :-）将回退到普通的旧省略号。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-10-30T08:36:10.363

我刚刚创建了一个可以在中间、nearEnd 和 End 修剪但尚未测试的函数，因为我最终在服务器端需要它

```
//position acceptable values : middle, end, closeEnd
function AddElipsis(input, maxChars, position) {
    if (typeof input === 'undefined') {
        return "";
    }
    else if (input.length <= maxChars) {
        return input;
    }
    else {
        if (position == 'middle') {
            var midPos = Math.floor(maxChars / 2) - 2;
            return input.substr(0, midPos) + '...' + input.substr(input.length - midPos, input.length);
        }
        else if (position == 'closeEnd') {
            var firstPart = Math.floor(maxChars * 0.80) - 2;
            var endPart = Math.floor(maxChars * 0.20) - 2;
            return input.substr(0, firstPart) + '...' + input.substr(input.length - endPart, input.length);
        }
        else {
            return input.substr(0, maxChars - 3) + '...';
        }
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-06-03T07:32:15.080

另一个刺：

```
function truncate( str, max, sep ) {
    max = max || 10;
    var len = str.length;
    if(len > max){
        sep = sep || "...";
        var seplen = sep.length;
        if(seplen > max) { return str.substr(len - max) }

        var n = -0.5 * (max - len - seplen);
        var center = len/2;
        return str.substr(0, center - n) + sep + str.substr(len - center + n);
    }
    return str;
}

console.log( truncate("123456789abcde") ); // 123...bcde (using built-in defaults) 
console.log( truncate("123456789abcde", 8) ); // 12...cde (max of 8 characters) 
console.log( truncate("123456789abcde", 12, "_") ); // 12345_9abcde (customize the separator) 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-08-26T18:40:10.857

这将使您对省略号和占位符文本的位置有更多的控制：

```
function ellipsis(str, maxLength, ellipsisLocationPercentage,placeholder) {
    /*
    ARGUMENTS:
    str - the string you want to maninpulate
    maxLength -  max number of characters allowed in return string
    ellipsisLocationPercentage (optional) - How far (percentage wise) into the return string you want the ellipses to be placed
        Examples:
        .85 : This is a very long string. This is a very long string. This is a very long string. This is a ver[...]very long string.
        .25 : This is a very long string. [...]g. This is a very long string. This is a very long string. This is a very long string.
    placeholder (optional) - this will be used to replace the removed substring. Suggestions : '...', '[..]', '[ ... ]', etc....
    */
    if(ellipsisLocationPercentage == null || isNaN(ellipsisLocationPercentage) || ellipsisLocationPercentage >= 1 || ellipsisLocationPercentage <= 0){
        //we've got null or bad data.. default to something fun, like 85% (that's fun, right??)
        ellipsisLocationPercentage = .85;
    }
    if(placeholder == null || placeholder ==""){
        placeholder = "[...]";
    }

    if (str.length > (maxLength-placeholder.length)) {
        //get the end of the string
        var beginning = str.substr(0, (maxLength - placeholder.length)*ellipsisLocationPercentage );
        var end = str.substr(str.length-(maxLength - placeholder.length) * (1-ellipsisLocationPercentage));
        return beginning + placeholder + end;
    }
    return str;
} 
```

你可以通过调用来调用这个函数：

```
ellipsis("This is a very long string. Be Scared!!!!", 8);//uses default values
ellipsis("This is a very long string. Be Scared!!!!", 8,.5);//puts ellipsis at half way point
ellipsis("This is a very long string. Be Scared!!!!", 8,.75,'<..>');//puts ellipsis at 75% of the way into the string and uses '<..>' as the placeholder 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-03-30T20:55:57.453

为了干净利落并在缩短文本的末尾有一个完整的单词，我使用了下面的函数。

```
function prepareText(text){
  var returnString = text;
  var textLimit = 35;
  if(text.length > textLimit){
    var lastWord = text.slice( text.lastIndexOf(' ')+1 );
    var indexFromEnd = lastWord.length;
    var ellipsis = '... ';

    returnString = text.slice(0, textLimit - indexFromEnd - ellipsis.length);
    returnString = returnString + ellipsis + lastWord;
  }
  return returnString;
}

$('#ex1Modified').html( prepareText( $('#ex1').html() ) );

$('#ex2Modified').html( prepareText( $('#ex2').html() ) );

$('#ex3Modified').html( prepareText( $('#ex3').html() ) );
```

```
body{color:#777; font-family: sans-serif;}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<h2>Shortened Quotes from Albert Einstein</h2>

<div id="ex1">"The true sign of intelligence is not knowledge but imagination."</div>
<div id="ex1Modified"></div>
<br>
<div id="ex2">"Look deep into nature, and then you will understand everything better."</div>
<div id="ex2Modified"></div>
<br>
<div id="ex3">"You can't blame gravity for falling in love."</div>
<div id="ex3Modified"></div>
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-09-13T19:09:30.197

这是一个优雅的解决方案：

```
function truncateMiddle(word) {
    const tooLongChars = 15; // arbitrary

    if (word.length < tooLongChars) {
        return word;
    }

    const ellipsis = '...';
    const charsOnEitherSide = Math.floor(tooLongChars / 2) - ellipsis.length;

    return word.slice(0, charsOnEitherSide) + ellipsis + word.slice(-charsOnEitherSide);
} 
```

# linq - 生成 12MB DataContext.cs 文件时，如何使用 SQLMetal 为大型数据库创建 LINQ To SQL 数据上下文？

> ID：831554
> 
> 赞同：2
> 
> 时间：2009-05-06T20:21:35.937
> 
> 标签：linq, linq-to-sql, sqlmetal

我的问题是这样的：

我们有一个非常大的 Legacy DB，其中包含许多 SPROC、视图和表。

设计师是尺寸的“NO GO”b/c。

我已经配置 SQL Metal 来构建数据上下文，但是生成的代码文件太大（12MB），Visual Studio 2008 无法打开它。

如果 SQLMetal 会为每个类类型（表、视图、SPROC_Result）生成一个新文件，我会没事的。

但由于它目前有效，我很高兴。

想法？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T14:33:02.750

事实证明有很多方法可以做到这一点：

1）建立自己的（1周为我：DBML上帝）[http://southernbits.com/index.php/2009/05/16/dbml-hell-legacy-db-sqlmetal-is-painful-when-migrating-来自-sql-designer/](http://southernbits.com/index.php/2009/05/16/dbml-hell-legacy-db-sqlmetal-is-painful-when-migrating-from-sql-designer/)

2）使用现有工具（这可能有效，但我还*没有*完全探索）[http://www.plinqo.com/](http://www.plinqo.com/)

3) 警惕 SQLMetal 和 SQL Designer 之间的差异。见博客：[http ://southernbits.com/index.php/2009/05/25/unfortunate-differences-between-linq-sqlmetal-and-sqldesigner/](http://southernbits.com/index.php/2009/05/25/unfortunate-differences-between-linq-sqlmetal-and-sqldesigner/)

最后，这花了我 1 周的时间探索（我没有发现 plinqo）。简单的解决方案并没有出现。考虑到 SQLMetal 和 SQLDesigner 之间的差异，我花了 1.5 周的时间来构建一个工具（DBMLGod），又花了 1 周的时间来重构/编译代码）。测试时间待定...

如果您*没有*使用 SQL Designer 构建的大型代码库，您可能不会遇到那么多问题。

我认为所有大型、凌乱的数据库（使用大量复杂的存储过程并拥有大量对象）都会很痛苦。

在 QuadCore 4GB 开发盒上，我们数据库的 SQLGeneration 时间是 15 分钟（哎呀）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T20:29:26.463

你可以这样做：

1.  运行 SQLMetal.exe 以创建 .dbml 文件。
2.  创建一个小脚本或应用程序来将 .dbml 文件（即 XML）解析为 3 个组件：表、存储过程和视图
3.  在每个新的 .dbml 文件上运行 SQLMetal.exe 以创建 3 个单独的 .cs 文件。

在您的过滤阶段（第 2 步），您还可以根据其他要求创建 .dbml 文件的其他任意部分。也许过滤掉一些不必要的表或视图。或者将表格分解为具有单独 DataContexts 的逻辑组件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T21:32:16.017

刚刚确定 Resharper 在非常大的 DataContext.cs 文件上使 VisualStudio 崩溃。但是Keltex的建议是非常好的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-09T14:14:26.877

我们正在使用[http://t4-editor.tangible-engineering.com/T4-Editor-Visual-T4-Editing.html](http://t4-editor.tangible-engineering.com/T4-Editor-Visual-T4-Editing.html)

然后，您可以将数据上下文拆分为 .tt 模板中的单独类文件，事实上，您喜欢它，它为扩展代码提供了充足的机会，并且有一个可以满足基本需求的免费版本。

问候

# php - PHP子类访问父变量问题

> ID：831555
> 
> 赞同：12
> 
> 时间：2009-05-06T20:21:42.240
> 
> 标签：php, oop

我得到了这个类：

```
Class Username {
protected $id;
protected $username;
protected $contact_information;

     private __construct($id) {
       $this->id = (int) $id; // Forces it to be a string
       $contact_information = new ContactInformation($this->id);
     }
}

Class ContactInformation extends Username {
    protected $mobile;
    protected $email;
    protected $nextel_id;
    .....
} 
```

我的问题是：我想访问 ContactInformation 上的 $id 和 $username（以及许多其他变量），但是 parent:: 或 $this-> 不起作用，看起来每次我执行“new ContactInformation ....” PHP 创建一个“新用户名”。有机会从用户名访问当前值吗？

谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-06T20:32:26.193

为什么用户名构造函数是私有的？如果您想让创建用户名成为不可能，请将用户名类抽象化。另外，不要从父类中创建新的联系信息。这是另一种说法：

```
abstract class Username {
   protected $id;
   protected $username;

   public __construct($id) {
      $this->id = (int) $id; // Forces it to be a string
   }
}

class ContactInformation extends Username {
    protected $mobile;
    protected $email;
    protected $nextel_id;
    public __construct($id, $mobile, $email, $nextel_id) {
       parent::__construct($id)
       $this->mobile = $mobile;
       ....
    }
} 
```

现在，不是直接实例化用户名（现在不可能），而是创建一个 ContactInformation。ContactInformation 然后在其自己的构造函数中调用 Username 构造函数。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-06T21:05:14.007

parent:: 方法仅用于访问您在子类中覆盖的父方法，或静态变量，例如：

```
class Base
{
    protected static $me;

    public function __construct ()
    {
        self::$me = 'the base';
    }

    public function who() {
        echo self::$me;
    }
}

class Child extends Base
{
    protected static $me;

    public function __construct ()
    {
        parent::__construct();
        self::$me = 'the child extends '.parent::$me;
    }

    // until PHP 5.3, will need to redeclare this
    public function who() {
        echo self::$me;
    }
}

$objA = new Base;
$objA->who(); // "the base"

$objB = new Child;
$objB->who(); // "the child extends the base" 
```

您可能需要一个适当的子类。不要在基类的构造函数中创建子类，这会颠倒各种 OOP 最佳实践（松散耦合等），同时还会创建无限循环。（new ContactInformation() 调用 Username 构造函数，该构造函数创建一个 new ContactInformation() ...）。

如果你想要一个子类，像这样：

```
/**
 * Stores basic user information
 */
class User
{
    protected $id;
    protected $username;

    // You could make this protected if you only wanted
    // the subclasses to be instantiated
    public function __construct ( $id )
    {
        $this->id = (int)$id; // cast to INT, not string

        // probably find the username, right?
    }
}

/**
 * Access to a user's contact information
 */
class ContactInformation extends User
{
    protected $mobile;
    protected $email;
    protected $nextel;

    // We're overriding the constructor...
    public function __construct ( $id )
    {
        // ... so we need to call the parent's
        // constructor.
        parent::__construct($id);

        // fetch the additional contact information
    }
} 
```

或者您可以使用委托，但 ContactInformation 方法将无法直接访问 Username 属性。

```
class Username
{
    protected $id;
    protected $contact_information;

    public function __construct($id)
    {
        $this->id = (int)$id;
        $this->contact_information = new ContactInformation($this->id);
    }
}

class ContactInformation // no inheritance here!
{
    protected $user_id;
    protected $mobile;

    public function __construct($id)
    {
        $this->user_id = (int)$id;
        // and so on
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T21:24:02.777

首先，当您创建一个 时`ContactInformation`，它还包含 的所有非私有属性和方法`Username`。您不需要单独的`Username`实例。

```
Class Username {
    protected $id;
    protected $username;

    protected __construct($id) {
        $this->id = (int) $id; // Forces it to be a string
    }
}

Class ContactInformation extends Username {
    protected $mobile;
    protected $email;
    protected $nextel_id;
    // Pretend that these are here because they're defined in my parent
    //protected $id;
    //protected $username;

    public __construct($id) {
        parent::__construct($id);
        echo $this->id; //Should echo 1
    }
} 
```

但是，由于所有字段都受到保护，因此这是行不通的：

```
$contact_information = new ContactInformation(1); // Works fine
echo $contact_information->id;
// Whoops, visibility error because id isn't public 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T21:13:50.197

如果我理解正确，您想从该对象中包含的对象访问该对象的属性吗？如果这是正确的，那么它是如何完成的：

```
class A {

  // These are the properties you want to access from the child object
  public $property_a;
  public $property_b;
  public $property_c;

  // This is the child object variable
  public $child_object;

  public function __construct( ) {

    // Pass 'this' into the child so that the child has a reference back to the parent
    $this->child_object = new B($this);
  }
}

class B {

  // Holds a reference to the parent object
  protected $parent_object;

  public function __construct( $object ) {

    // Remember the reference to the parent object
    $this->parent_object = $object;
  }

  // Just a Demonstration Method
  public print_parent_property_a()
  {
    // Reach into the referred parent object, and get it's property
    print $this->parent_object->property_a;
  }
} 
```

因此，如果您要这样做：

```
$my_object = new A();
$my_object->property_a = 'test_value';
$my_object->child_object->print_parent_property_a(); 
```

你会得到'test_value'

它与您的示例略有不同，因为您需要将父类属性公开，以便子类可以访问它们。

这一切都有效，因为在 PHP 中，对象总是通过引用传递，除非您明确克隆它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-08-04T03:49:51.390

```
<?php

 abstract class employee
{ 
    //create member variable in parent class

    protected $name;
    protected $id;
    protected $mobile;  

    //constructor of parent class 
    public function __construct($n , $i , $m)
    {
        $this->name=$n;
        $this->id=$i;
        $this->mobile=$m;
    }
    //create method will return name
    public function ShowFullName()
    {

        return $this->name;
    }
//create method will return contact
    public function ShowContact()
    {

        return $this->mobile;
    }

}

class FulltimeEmployee extends employee
{

    private $days;
    private $salary;

        //create child constructor 
    public function __construct($n , $i , $mo , $d , $s)
    {
        $this->days=$d;
        $this->salary=$s;

        //calling parent constructor now we can use parent class member while calling child class constructor
        parent::__construct($n , $i , $mo);
    }

    public function calculate()
    {

        return $this->salary * $this->days;

    }
}

//providing data to child class constructor including parent class values
$child = new FulltimeEmployee("james",120,9033474118 , 2 , 200);
echo $child->calculate();
echo $child->ShowFullName(); 
```

# java - Spring WS 调用 .net Web 服务

> ID：831562
> 
> 赞同：1
> 
> 时间：2009-05-06T20:24:36.117
> 
> 标签：java, web-services, spring

我必须称这个 webservices 是一个 .net web 服务（嗯.. WS 应该是相当独立于平台的，我猜）我附上了下面的 WSDL。

我正在使用 Spring WS 1.5.6。我不知道该在消息中添加什么。

我必须包含命名空间等吗？我是否需要指定方法名称等？

（第二个想法是，我最好使用 Axis2 吗？如果是，该怎么做？）

请告知提前谢谢

```
// send to the configured default URI
    public void simpleSendAndReceive() {
        StreamSource source = new StreamSource(new StringReader(MESSAGE));
        StreamResult result = new StreamResult(System.out);
        webServiceTemplate.sendSourceAndReceiveToResult(source, result);
    }

   <?xml version="1.0" encoding="UTF-8"?>
<?Siebel-Property-Set EscapeNames="false"?>
<definitions
 xmlns="http://schemas.xmlsoap.org/wsdl/"
 xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
 targetNamespace="http://extsup01/asi/"
 xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/"
 xmlns:xsd="http://www.w3.org/2001/XMLSchema"
 xmlns:tns="http://extsup01/asi/">
   <types></types>
   <message
 name="aPLServiceAttachmentWSsGetAttach_Input">
      <partname="sInput" type="xsd:string"></part>
   </message>
   <message name="aPLServiceAttachmentWSsGetAttach_Output">
      <part name="sOutput" type="xsd:string"></part>
   </message>
   <portType name="aPL_spcService_spcAttachment_spcWS">
      <operation name="aPLServiceAttachmentWSsGetAttach">
         <input message="tns:aPLServiceAttachmentWSsGetAttach_Input"></input>
         <output message="tns:aPLServiceAttachmentWSsGetAttach_Output"></output>
      </operation>
   </portType>
   <binding name="aPL_spcService_spcAttachment_spcWS" type="tns:aPL_spcService_spcAttachment_spcWS">
      <soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="rpc"></soap:binding>
      <operation name="aPLServiceAttachmentWSsGetAttach">
         <soap:operation soapAction="rpc/http://extsup01/asi/:aPLServiceAttachmentWSsGetAttach"></soap:operation>
         <input>
            <soap:body encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" namespace="http://extsup01/asi/" use="encoded"></soap:body>
         </input>
         <output>
            <soap:body encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" namespace="http://extsup01/asi/" use="encoded"></soap:body>
         </output>
      </operation>
   </binding>
   <service name="aPL_spcService_spcAttachment_spcWS">
      <port binding="tns:aPL_spcService_spcAttachment_spcWS" name="aPL_spcService_spcAttachment_spcWS">
         <soap:address location="http://extsup01/some_url"></soap:address>
      </port>
   </service>
</definitions> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T21:44:49.153

我建议您懒惰并下载[SOAP U](http://www.soapui.org/) I。给它 WSDL 并让它为您生成 XML 请求流。它将准确地向您显示请求中必须包含的内容，包括适当的命名空间。这就是我使用的。

IntelliJ 有一个非常不错的插件，它为我敲定了交易。如果您是 IntelliJ 用户，也可以使用它。

# tortoisesvn - Tortoise SVN 是否有 FogBugz 插件可以在提交时查询问题？

> ID：831566
> 
> 赞同：6
> 
> 时间：2009-05-06T20:25:48.157
> 
> 标签：tortoisesvn, fogbugz

当我从 TSVN 提交时，我希望能够从fogbugz 问题列表中进行选择——而不是记住问题编号。

类似于[gurtle](http://tortoisesvn.net/node/339)和[TracExplorer](http://tracexplorer.devjavu.com/)

请参阅此页面的最底部：

[http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-bugtracker.html](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-bugtracker.html)

如果不可用，也许我会尝试重新使用其他两个最好的代码（假设开源和体面的许可）来添加 FB。

如果其他人对此感兴趣，请告诉我。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T20:29:43.517

非常好...我不认为有这样的东西，但使用[FogBugz API应该很容易创建它](http://www.fogcreek.com/FogBugz/docs/60/topics/advanced/API.html)

[Fog Creek 在http://our.fogbugz.com/default.asp?W724](http://our.fogbugz.com/default.asp?W724)和[http://www.fogcreek.com/FogBugz/Ecology.html](http://www.fogcreek.com/FogBugz/Ecology.html)上发布了与 FogBugz 一起使用的 3rd 方工具列表

当您创建此类工具时，请在此处或生态页面发布链接。我有兴趣 ：-）

# c# - 我正在尝试学习如何将 IEnumerable LINQ 集合绑定到转发器

> ID：831568
> 
> 赞同：10
> 
> 时间：2009-05-06T20:26:52.710
> 
> 标签：c#, asp.net, linq

我使用 LINQ 从字符串数组创建了一个 IEnumerable 赛车手列表，如下所示：

```
string[] driverNames = {
                              "Lewis Hamilton", 
                              "Heikki Kovalainen",
                              "Felipe Massa",
                              "Kimi Raikkonen",
                              "Robert Kubica",
                              "Nick Heidfeld",
                              "Fernando Alonso",
                              "Nelson Piquet Jr",
                              "Jarno Trulli",
                              "Timo Glock",
                              "Sebastien Bourdais",
                              "Sebastien Buemi",
                              "Mark Webber",
                              "Sebastian Vettel",
                              "Nico Rosberg",
                              "Kazuki Nakajima",
                              "Adrian Sutil",
                              "Giancarlo Fisichella",
                              "Jenson Button",
                              "Rubens Barrichello"
                          };

IEnumerable<string> result = from driver in driverNames
                             orderby driver
                             select driver; 
```

我现在只是保持简单。

然后我将它绑定到一个 ASP.NET GridView，如下所示：

```
GV_CurrentF1Drivers.DataSource = result;
GV_CurrentF1Drivers.DataBind(); 
```

这工作正常。现在我想获取相同的输出（结果）并将其绑定到转发器，但无论我尝试什么，我都无法让转发器工作，我认为我缺少对 LINQ 以及它如何与 ASP.NET 一起使用的一些关键理解.

下面是完整的 aspx 页面，显示了我到目前为止的位置。请有人（如果可能的话，轻轻地）引导我回到这条路上吗？

```
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="Example1.aspx.cs" Inherits="Example1" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
</head>
<body>
    <form id="form1" runat="server">
    <div style="float: left;">
        <asp:GridView ID="GV_CurrentF1Drivers" runat="server" />
    </div>
    <div style="float: left;">
        <asp:Repeater ID="R_CurrentF1Drivers" runat="server">
            <ItemTemplate>
                <%# Eval("driver") %></ItemTemplate>
        </asp:Repeater>
    </div>
    </form>
</body>
</html> 
```

我使用以下代码将结果绑定到中继器：

```
R_CurrentF1Drivers.DataSource = result;
R_CurrentF1Drivers.DataBind(); 
```

当我尝试运行带有中继器的页面时出现以下错误：

**异常详细信息：** System.Web.HttpException：DataBinding：“System.String”不包含名为“driver”的属性。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-06T20:30:54.060

您将返回一个没有名称的可枚举字符串。如果您想使用属性名称驱动程序，您可以创建一个匿名类型并说：

```
var result = from driver in driverNames
             orderby driver
             select new { Driver = driver }; 
```

然后进行数据绑定。

我相信您也`Eval(".")`可以评估对象本身而不是属性。此外，正如多人在下面所说，您可以使用`<%# Container.DataItem %>`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T20:32:35.460

更改`<%# Eval("driver") %>`为

```
<%# Container.DataItem %> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T20:32:31.293

尝试

```
<%# Container.DataItem.ToString() %> 
```

eval 正在寻找一个名为 driver 的属性，但您将实际的驱动程序名称作为字符串。这就像调用“drivername”.DriverName。您的集合的枚举正在使用实际项目。如果您实际上有一个像 IList 驱动程序这样的集合，那么这将起作用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-17T14:30:51.223

我意识到这是一个老问题，但我想指出一个字符串数组已经存在`IEnumerable<string>`，您可以使用 Mehrdad 的回答将数组直接绑定到中继器：

```
<%# Container.DataItem %> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T20:32:18.283

因为字符串没有称为“驱动程序”的属性，并且您使用的是字符串列表，所以这不起作用。尝试用 Container.DataItem 替换 Eval 语句

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T20:38:34.260

你确定没有类型？因为代码看起来不错。

你也可以使用 select new { Driver = driver, DriverAge = driverage, etc..}

然后在您的 ASPX 页面中，您使用以下内容

```
<ItemTemplate>
<div class="Driver"><%# Eval("Driver") %></div>
<div class="DriverAge"><%# Eval("DriverAge ") %></div>   
</ItemTemplate> 
```

希望这可以帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-17T14:23:14.687

或者干脆`<%# Eval("result.Driver") %>`

# c# - 建立博客数据模型的最佳实践

> ID：831575
> 
> 赞同：1
> 
> 时间：2009-05-06T20:29:57.803
> 
> 标签：c#, asp.net, sql, blogs

我的博客数据模型有以下设置：

```
博客文章类别
----- -------- 1 ----------
ID \ 1 * ID /----- ID
名称 \------------ 博客 ID / 名称
业主姓名 * /      
                   类别 ID-/

```

我担心这个数据模型如何与博客的“最佳实践”相匹配。如果博客被删除，是否应该删除该博客的所有文章？如果一个类别被删除，文章应该怎么办？

有没有更好的办法？有什么我想念的吗？“最佳实践”建议做什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T20:38:03.060

这实际上取决于您的用例。许多博客应用程序使用具有多对多关系的标签而不是具有一对多关系的类别，因为将文章视为与（可能）许多标签相关比将文章视为“包含在一个类别中。

如果你博客的逻辑是一篇文章严格包含在一个类别中，那么一对多的关系是合理的。在某些情况下，级联删除也是合理的。毕竟，孤立的文章甚至会存在于哪里。

这只是您必须预测用户群直觉的情况。*他们*会认为是自然的。

顺便说一句，这是更多的工作，但如果是我，我不会做级联删除。我会将文章标记为孤立的并将它们隐藏在大多数视图中。我还将提供一些用于恢复孤立文章的界面。而且我会考虑提供一个脚本来删除任何被孤立超过一段时间的东西。这样，如果您对用户期望发生的事情有误，您可以解决问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T21:23:56.973

这篇[（较早的）帖子](http://www.pui.ch/phred/archives/2005/04/tags-database-schemas.html)介绍了一些与标签相关的数据库架构变体，包括详细讨论。也许这是一个很好的起点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T20:34:57.933

依靠。如果您的博客引擎不允许没有指定类别的条目，您可能应该通知用户后果并删除文章。否则，您可以使用 an`ON DELETE SET NULL`代替。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T20:35:49.553

如果您的关系设置正确，您应该无法在不先删除所有相关数据的情况下删除该类别。删除一个类别会删除一堆文章似乎很奇怪，但同时，如果一个类别不再有效，那么文章也不应该是。

也许可以选择将所有文章重新映射到新类别。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T20:37:29.080

几个问题。一篇文章可以有多个类别吗？您是否允许文章有 0 个与之关联的类别？不过，根据您的描述，我想说您不想删除这些文章。根据我在开发博客时的经验，这些类别通常与文章/帖子（描述多个帖子的多个类别）是多对多的关系。所以我不会删除它们，但这再次取决于您的业务逻辑以及您希望如何处理它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T20:34:32.397

好吧，将博客类别与博客文章相关联的外键（*应该*存在）不允许您这样做。如果您想保持您的文章和参考完整性，您应该考虑将您的文章的类别更改为不同的类别。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T20:50:09.503

忘记数据模型，使用对象模型，即数据是实现，对象是接口，更接近需求。

# java - 以嵌入式模式对 JSP 进行单元测试

> ID：831576
> 
> 赞同：3
> 
> 时间：2009-05-06T20:30:05.433
> 
> 标签：java, unit-testing, jsp, tomcat, jetty

我正在构建一个对 JSP 进行单元测试的小型框架。这些 JSP 有一些自定义标签，否则它们并没有什么特别之处。

尽管有许多可用的 Java 单元测试解决方案，但我不喜欢使用单独的完整 JSP 容器启动、应用程序部署和通过 TCP 连接收集结果的方法。这种情况的典型例子是 Apache Cactus、Selenium 等。理想情况下，我想要一个尽可能轻量级的嵌入式解决方案（不需要网络连接是一个好兆头）。我还查看了各种模拟框架，但在单元测试期间编译/执行 JSP 时，没有一个干净的工作示例。

我能找到的最接近的解决方案是在嵌入式模式下使用 Jetty，或者特别是它的 ServletTester 类，如[http://docs.codehaus.org/display/JETTY/ServletTester中所述](http://docs.codehaus.org/display/JETTY/ServletTester)

不幸的是，上述方法仅适用于 servlet，但没有提及 JSP。我认为有一种方法可以以编程方式将 Jasper servlet 挂接到其中，但不能为了让两者集成而花一周时间深入研究 Jetty/Jasper 内部结构。我不介意使用任何其他 JSP/Servlet 容器，只要它是免费且可灵活配置的。

如果有人有类似的设置并愿意分享经验，我将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-02-15T09:18:23.477

这是一个使用 jsps 运行 Jettys ServletTester 的示例项目。

[https://github.com/genthaler/jetty-jsp-unit-test-simple/](https://github.com/genthaler/jetty-jsp-unit-test-simple/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T21:48:40.953

看看 HttpUnit - [http://httpunit.sourceforge.net/](http://httpunit.sourceforge.net/)。它与 ServletUnit 捆绑在一起，这是一个处理 JSP 的内存 servlet 引擎。这通常应该只用于测试正确分解的 MVC 应用程序的视图部分或进行一些集成/验收测试。

应直接从 POJO 测试业务逻辑。

# sql-server-2000 - 查询以获取 SQL Server 2000 中的所有外键约束

> ID：831589
> 
> 赞同：5
> 
> 时间：2009-05-06T20:32:13.447
> 
> 标签：sql-server-2000, foreign-keys

我需要查询 SQL Server 2000 以获取所有外键的列表。

特别是指向特定列的所有外键。

如何编写此查询？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-06T20:35:02.363

```
select * from sysobjects
where xtype = 'F' 
```

我希望这应该可以解决问题并与 SQL Server 2000 兼容！

如果您还需要 SQL Server 2000 中的表和列信息，则涉及更多；您需要像这样加入`sysforeignkeys`和`syscolumns`目录视图：

```
select
  so.name 'foreign key name',
  OBJECT_NAME(parent_obj) 'table',
  OBJECT_NAME(sf.fkeyid) 'referencing table',
  sc1.name 'referencing column',
  OBJECT_NAME(sf.rkeyid) 'referenced table',
  sc2.name 'referenced column'
from sysobjects so
inner join sysforeignkeys sf on so.id = sf.constid
inner join syscolumns sc1 on sf.fkeyid = sc1.id and sf.fkey = sc1.colid
inner join syscolumns sc2 on sf.rkeyid = sc2.id and sf.fkey = sc2.colid
where so.xtype in ('F','PK') 
```

如果您想利用在 SQL Server 2000 中确实可用的 INFORMATION_SCHEMA 视图，请使用以下查询：

```
SELECT
    rc.CONSTRAINT_NAME,     
    rcu.TABLE_NAME 'Referencing Table', 
    rcu.COLUMN_NAME 'Referencing Column',
    rcu1.TABLE_NAME 'Referenced Table',
    rcu1.COLUMN_NAME 'Referenced Column'
FROM
    INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS rc
INNER JOIN 
    INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE rcu 
      ON rc.CONSTRAINT_CATALOG = rcu.CONSTRAINT_CATALOG 
         AND rc.CONSTRAINT_NAME = rcu.CONSTRAINT_NAME
INNER JOIN 
    INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE rcu1 
      ON rc.UNIQUE_CONSTRAINT_CATALOG = rcu1.CONSTRAINT_CATALOG 
         AND rc.UNIQUE_CONSTRAINT_NAME = rcu1.CONSTRAINT_NAME 
```

马克

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T20:37:33.840

```
select * from INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS 
```

如果您需要有关该键的更多信息，则可以将其加入 INFORMATION_SCHEMA.KEY_COLUMN_USAGE 视图，该视图包含该键引用的列。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T21:58:50.663

查看 sp_helpconstraint 的来源以获得更多想法，但这应该有效......

获取引用目标表和列的每个 FK

*   替换“你的表名”
*   取消注释最后一个“AND”并设置您的目标列名称

代码：

```
--list all tables & columns that refer to the given table
select
    k.name,pt.Name AS ParentTable,pc.name,c.constraint_column_id,ct.Name AS ReferedToTable,c.referenced_column_id,cc.Name
    from sys.foreign_keys                  k
        INNER JOIN sys.foreign_key_columns c ON k.parent_object_id=c.parent_object_id
        INNER JOIN sys.objects             pt ON c.parent_object_id=pt.object_ID
        INNER JOIN sys.objects             ct ON c.referenced_object_id=ct.object_ID
        INNER JOIN  sys.columns            pc ON c.parent_object_id=pc.object_ID AND c.parent_column_id=pc.column_id
        INNER JOIN  sys.columns            cc ON c.referenced_object_id=cc.object_ID AND c.referenced_column_id=cc.column_id
    where k.referenced_object_id = object_id('YourTableName')
        --AND pc.name='YourColumnName' --parent table column name
        --AND cc.name='YourColumnName' --referenced table's column name 
```

# .net - 在 Visual Studio 设计器中公开一组枚举（标志）

> ID：831612
> 
> 赞同：3
> 
> 时间：2009-05-06T20:36:57.647
> 
> 标签：.net, visual-studio, winforms

我有一个可能在 .NET Forms 控件中显示的数据类型的枚举，我想为控件的使用者提供一个接口来过滤某些类型（设置一些标志）。位字段似乎是执行此操作的合乎逻辑的方式，不幸的是，枚举从 0 而不是 1 (0, 1, 2, 4, 8, ...) 开始并且无法更改。

如何公开这组标志，以便可以通过编程方式或通过 Visual Studio 设计器轻松配置它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T20:39:41.230

您需要编写 a`UITypeEditor`来完成这项工作，并通过 将其与属性相关联`[EditorAttribute]`。

**现在用示例进行编辑**-恐怕是相当长的示例-但幸运的是，大多数代码都可以在类型之间共享。

由于为零，您不能使用单个复合枚举值 - 所以在这里我使用 a来保存选定的枚举 - 但是，如果您有 .NET 2.0/3.0，则`HashSet<T>`很容易重新工作。`List<T>`

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing.Design;
using System.Text;
using System.Windows.Forms;
using System.Windows.Forms.Design;

public class MyControl : UserControl
{
    public MyControl()
    {
        Values = new HashSet<MyEnum>();
    }
    [Editor(typeof(MyEnumSetEditor), typeof(UITypeEditor))]
    [TypeConverter(typeof(MyEnumSetConverter))]
    public HashSet<MyEnum> Values { get; set; }
}

public enum MyEnum
{  // numbers as per the question...
    A = 0, B = 1, C = 2, D = 4, E = 8
}
class MyEnumSetEditor : EnumSetEditor<MyEnum> { }
class MyEnumSetConverter : EnumSetConverter<MyEnum> { }

// from here down is shared between types
abstract class EnumSetConverter<T> : TypeConverter where T : struct
{
    public override bool CanConvertTo(ITypeDescriptorContext context, Type destinationType)
    {
        return destinationType == typeof(string) || base.CanConvertTo(context, destinationType);
    }
    public override object ConvertTo(ITypeDescriptorContext context, System.Globalization.CultureInfo culture, object value, Type destinationType)
    {
        if(destinationType == typeof(string))
        {
            HashSet<T> set = (HashSet<T>)value;
            if (set == null) return "(null)";

            StringBuilder sb = new StringBuilder();
            foreach (T item in Enum.GetValues(typeof(T)))
            {
                if (set.Contains(item))
                {
                    if (sb.Length > 0) sb.Append(", ");
                    sb.Append(item);
                }
            }
            return sb.ToString();
        }
        return base.ConvertTo(context, culture, value, destinationType);
    }
}

public abstract class EnumSetEditor<T> : UITypeEditor where T : struct
{
    public override UITypeEditorEditStyle GetEditStyle(ITypeDescriptorContext context)
    {
        return UITypeEditorEditStyle.DropDown;
    }
    public override bool IsDropDownResizable
    {
        get { return true; }
    }
    public override object EditValue(ITypeDescriptorContext context, IServiceProvider provider, object value)
    {
        IWindowsFormsEditorService svc = (IWindowsFormsEditorService)
            provider.GetService(typeof(IWindowsFormsEditorService));
        HashSet<T> set = value as HashSet<T>;
        if (svc != null && set != null)
        {
            UserControl ctrl = new UserControl();
            CheckedListBox clb = new CheckedListBox();
            clb.Dock = DockStyle.Fill;
            Button btn = new Button();
            btn.Dock = DockStyle.Bottom;
            foreach (T item in Enum.GetValues(typeof(T)))
            {
                clb.Items.Add(item, set.Contains(item));
            }
            ctrl.Controls.Add(clb);
            ctrl.Controls.Add(btn);
            btn.Text = "OK";
            btn.Click += delegate
            {
                set.Clear();
                foreach (T item in clb.CheckedItems)
                {
                    set.Add(item);
                }
                svc.CloseDropDown();
            };
            svc.DropDownControl(ctrl);
        }

        return value;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-04-24T12:22:01.843

我遇到了同样的问题：编辑器控件似乎可以工作，但值不会持续存在。基于马克的回答和一些进一步的研究，我现在已经开始运行了。[尽管我在 DesignTime 需要此功能来编辑我自己的控件，但在阅读了Microsoft](https://msdn.microsoft.com/en-us/library/ms171840.aspx)的以下引用后，我使用带有 PropertyGrid 控件的演示项目对其进行了测试：

> 当您开发自定义 UITypeEditor 时，建议您将构建号设置为随着每次构建而递增。这可以防止在设计环境中创建 UITypeEditor 的旧缓存版本。

我认为这实际上是在尝试实施 Marc 的解决方案时引起问题的问题。在单独的项目中进行测试也很有帮助，因为您可以使用逐步调试来查看控件、编辑器和转换器中发生的情况。

基本步骤是：

*   创建类型（此处：**MyFlags**）和属性（此处：**MyProperty**），为后者添加一些额外的属性。
*   实现要用于编辑的控件（此处为：**EnumEditorControl ）。**
*   实现一个`UITypeEditor`类（这里：**EnumEditor**）；这是使用属性连接到属性的`Editor`。它还创建和管理我们的*EnumEditorControl*的实例。
*   实现一个`TypeConverter`类（这里：**EnumConverter**）；这也使用属性 ( `TypeConverter`) 连接到属性，并处理将值转换为字符串以在属性网格中显示。

现在是相关代码片段的演练：

1.  `Enum`使用`Flags`属性定义一个。

    ```
    <Flags>
    Public Enum MyFlags
        Flag1 = 2 ^ 0
        Flag2 = 2 ^ 1
        Flag3 = 2 ^ 2
    End Enum 
    ```

2.  定义自定义控件的属性。

    ```
    Public Property MyProperty() As MyFlags
        ...
    End Property 
    ```

一旦我们创建了我们需要的其他组件（参见#6），这个属性稍后将添加属性。

3.  创建用于编辑属性的所需控件。

    ```
    Imports System.Windows.Forms.Design
    Public Class EnumEditorControl(Of T As Structure)
        Public Sub New(value As Long, editorService As IWindowsFormsEditorService)
            'This call is required by the Windows.Forms Form Designer.
            InitializeComponent()

            _value = value
            _editorService = editorService

            For Each item As Long In [Enum].GetValues(GetType(T))
                Me.CheckedListBox1.Items.Add([Enum].GetName(GetType(T), item), (_value And item) = item)
            Next

        End Sub

        Private _value As Long
        Public Property Value As Long
            Get
                Return _value
            End Get
            Set(value As Long)
                _value = value
            End Set
        End Property
        Private _editorService As IWindowsFormsEditorService

        Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
            Dim v As Long = 0
            For Each item As String In Me.CheckedListBox1.CheckedItems
                v = (v Or [Enum].Parse(GetType(T), item))
            Next
            _value = v
            Me._editorService.CloseDropDown()
        End Sub
    End Class 
    ```

以上是没有*designer.vb*部分的类代码。重要的部分是：一个带有`value`和`editorService`参数的构造函数，用当前选择的值填充控件（在构造函数中）并实现一个“提交动作”，其中`Value`控件的属性被更新（取决于所做的选择），最后调用`Me._editorService.CloseDropDown()`.

4.  定义一个通用的 UITypeEditor。

    ```
    Imports System.ComponentModel
    Imports System.Drawing.Design
    Imports System.Windows.Forms.Design

    Public Class EnumEditor(Of T As Structure)
        Inherits UITypeEditor

        Public Overrides Function GetEditStyle(context As ITypeDescriptorContext) As UITypeEditorEditStyle
            Return UITypeEditorEditStyle.DropDown
        End Function
        Public Overrides ReadOnly Property IsDropDownResizable() As Boolean
            Get
                Return True
            End Get
        End Property
        Public Overrides Function EditValue(context As ITypeDescriptorContext, provider As IServiceProvider, value As Object) As Object
            Dim svc As IWindowsFormsEditorService = DirectCast(provider.GetService(GetType(IWindowsFormsEditorService)), IWindowsFormsEditorService)
            Dim items As Long = CLng(value)
            If svc IsNot Nothing Then
                Dim c As New EnumEditorControl(Of T)(value, svc)

                svc.DropDownControl(c)

                value = c.Value
            End If

            Return CType(value, T)
        End Function
    End Class 
    ```

这里的核心部分是覆盖`EditValue`我们的编辑器控件的实例（参见#3）的创建和显示位置`svc.DropDownControl(c)`。最后，从控件的属性中检索选定的值并将其返回。

5.  定义用于将实际值转换为要在属性浏览器中使用的字符串表示形式的通用*TypeConverter 。*导入 System.ComponentModel 导入 System.Drawing.Design 导入 System.Text 导入 System.Windows.Forms.Design

    ```
    Class EnumConverter(Of T As Structure)
        Inherits TypeConverter

        Public Overrides Function CanConvertTo(context As ITypeDescriptorContext, destinationType As Type) As Boolean
            Return destinationType = GetType(String) OrElse MyBase.CanConvertTo(context, destinationType)
        End Function
        Public Overrides Function ConvertTo(context As ITypeDescriptorContext, culture As System.Globalization.CultureInfo, value As Object, destinationType As Type) As Object
            If destinationType = GetType(String) Then
                Dim items As Integer = CLng(value)

                If items = 0 Then
                    Return ""
                End If

                Dim values As New List(Of String)

                For Each item As Integer In [Enum].GetValues(GetType(T))
                    If (items And item) = item Then
                        values.Add([Enum].GetName(GetType(T), item))
                    End If
                Next
                Return String.Join(", ", values)
            End If

            Return MyBase.ConvertTo(context, culture, value, destinationType)
        End Function
    End Class 
    ```

6.  通过将以下属性添加到定义的属性（请参阅#2），将它们联系在一起。

    ```
    <Browsable(True),
    DefaultValue(MyFlags.Flag1),
    Editor(GetType(EnumEditor(Of MyFlags)), 
    GetType(System.Drawing.Design.UITypeEditor)),
    TypeConverter(GetType(EnumConverter(Of MyFlags)))
    >
    Public Property MyProperty() As MyFlags
        ...
    End Property 
    ```

注意：参考问题中提到的“零值”：此解决方案没有考虑到这一点，但可以很容易地对其进行修改。

# sql - 为什么我无法连接到此 SQL Server？

> ID：831617
> 
> 赞同：-1
> 
> 时间：2009-05-06T20:37:39.003
> 
> 标签：sql, sql-server

我们的 SQL Server 存在问题。每天大约有两次我们必须重新启动服务器，因为 SQL 对我们的 Web 应用程序没有响应。看起来我们对许多连接没有问题，因为一次活动的连接永远不会超过 20 个。

奇怪的是我只能从 MS SQL Enterprise Manager 8.0 访问 SQL。来自任何其他应用程序（ASP.NET 或 SQL Server Management Studio 05）的连接超时。

查询在企业管理器中工作正常，所以我认为这也不是锁的问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T20:58:49.403

*   任何环境变化，硬件或软件？
*   最后的变化是什么？

只是关于网络问题的经验..如果网络出现故障，它可能会导致网络连接的建立，您只能从性能监视器（perfmon）中的性能计数器中看到，所以这将是我会看的。

如果没有环境变化，也许数据库需要一些良好的维护，比如合并表和索引，将日志推送到备份或清除它们，以及 DBA 所做的任何清理工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:41:10.273

我之前在 MySQL 上遇到过类似的问题，空闲连接会被标记为过时并且会超时，最终我不得不重新启动应用程序。也许您的连接池上有一个可以使用的配置？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T20:47:53.143

如果 SQL Server 本身处于空闲状态并且没有发现任何阻塞，则可能是一些网络或防火墙或防病毒问题。或者只是一个服务器 RAID 阵列正在死亡。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T21:21:02.003

如果 SQL Server 日志是干净的并且（您可以在本地或远程连接到数据库）并且重新启动将您的应用程序恢复到已知状态，那么它表明存在池问题和/或网络问题

我们有一个类似的问题，通过升级到最新的服务包来解决没有明确的原因。我们的问题体现在保持底层网络连接打开而 Web 应用程序认为它们已关闭的框中，因此它会尝试恢复池，然后运行到最大连接数。您的问题表明您没有达到最大连接数，但您的症状相似。从操作系统级别查看网络连接。

您能否从托管您的 Web 应用程序的同一个机器进行连接，但使用另一个客户端应用程序，例如查询分析器，甚至是命令行中的 bcp 或 isql？

另一件要问的事情：如果您能够从网络应用程序框连接，您可以使用您的应用程序使用的数据库吗？如果是这样，您可以在那里做事吗？

Web App的连接池参数设置是什么？你试过调整这些吗？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-06T21:02:06.603

那个时候RAM内存发生了什么。也许你毁了内存

# mysql - 实施登录速度检查

> ID：831618
> 
> 赞同：1
> 
> 时间：2009-05-06T20:37:51.547
> 
> 标签：mysql, ruby, login, velocity

我需要为 Web 服务实现登录速度检查。该服务使用 ruby​​，数据库使用 MySql。

我可以想象一些不好的方法来做到这一点。例如，有一个表存储每次登录尝试的时间以及是否成功，并且每次用户尝试登录时，查询该表以获取最后*n*次登录尝试并对其运行一些简单的算法。不过，这显然非常低效。每次登录尝试都会在一个相当大的表上进行选择和插入，这会降低整个系统的速度。

更好的方法可能是说*n*的值被硬编码为 3 或其他值，并在用户表（存储密码验证器的地方）中添加*n*列，其中包含最近的*n*次登录尝试。这删除了额外的选择语句，并且用户表可能比登录尝试表短得多。但是，如果算法发生变化，它会丢失很多可能会很有趣的数据。

在这一点上，我倾向于对该结构进行变体，该结构将单个文本字段与密码验证器一起放入表中，并且该文本字段包含一个序列化对象，该对象是登录尝试记录的数组。在登录尝试时，该字段将被解析和重写。这解决了固定的*n*问题，同时避免了查询非常大的表。但是，从数据库中读取文本字段当然具有较差的磁盘访问特性，这最终也可能使其成为一个糟糕的解决方案。

最后，另一种可能性是使用 MySql 的日志文件支持的数据库（我不知道谁的名字），但我对此几乎一无所知，除了它应该在查询日志文件方面很有效。

我对 Stack Overflow 的问题是：登录速度检查通常如何在行业中实施？

**更新1：**

我应该定义速度检查。登录尝试的速度检查会跟踪连续失败的数量和发生连续失败的时间范围。第一个回复确实指向具有这些属性的解决方案。不过，我想知道它是否保留了足够的信息以允许速度检查的灵活性。由于从未构建过这样的系统，我担心的是我忽略了速度检查的重要方面，我希望在开始构建它时考虑这些方面......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T02:32:57.713

最后，我构建了类似于 John Boker 建议的东西。用于对用户进行身份验证的表有两个新列——`failed_login_count`它们`first_failed_login`是一个 DateTime 对象。每次用户成功登录时，将`failed_login_count`重置为 0，如果尚未登录，则`first_failed_login`重置为。`null`每次登录尝试失败时，`failed_login_count`都会增加。如果为 0，则`first_failed_login`获取当前时间。每次用户尝试登录时，都会在验证密码之前进行速度检查。如果`failed_login_count`大于 0，则除以当前时间和 之间的时间差`first_failed_login`。如果该值大于最大允许速度，则速度检查失败。

此外，我积极记录失败的登录尝试和失败的速度检查以供将来离线处理，以便我可以跟踪暴力破解帐户的尝试和禁用登录尝试失败次数过多的帐户，而无需跟踪数据库中这些计算所需的详细信息本身。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:42:41.253

我相信在 asp.net 默认会员提供程序中有一个名为 FailedPasswordAttemptCount 的用户表上的列，我确定它只是为每次失败的尝试增加，然后在成功时重置为 0。使用该列和 LastLoginAttemptTimestamp 列，您可以将用户锁定一段时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T23:10:04.083

> 我可以想象一些不好的方法来做到这一点。例如，有一个表存储每次登录尝试的时间以及它是否成功，并且每次用户尝试登录时，查询该表以获取最后 n 次登录尝试并对其运行一些简单的算法。不过，这显然非常低效。每次登录尝试都会在一个相当大的表上进行选择和插入，这会降低整个系统的速度。

如果您知道最大速度是多少，那么您可以轻松地定期清除“登录失败”表中的大量条目（除非您预计每天有数万次登录失败，否则每天就足够了）。

最好考虑一下您希望每天有多少登录和错误登录。

# c# - 为 Windows 上的其他应用程序创建长寿命服务器

> ID：831622
> 
> 赞同：0
> 
> 时间：2009-05-06T20:38:12.137
> 
> 标签：c#, .net, com, com+

我研究了 COM 服务器和 Windows 服务，但我不确定什么最适合我的目的或如何去做。我想要的是可以启动并运行无限时间的东西，它持有一个对象，以便其他进程或应用程序获取对该对象的引用（或向服务器发出请求）以修改或查询其状态。

服务器本质上是一个应用程序，它通过串行端口处理对设备的命令并维护设备的内部状态。

我现在有用 C# 编写的设备通信和持久性功能，它可以在每个进程的基础上创建和运行，但显然我希望它实例化一次并独立于其他进程运行。

我读过的 COM 教程只是让我感到困惑，因为我不完全确定这是否是我想要的，我希望有更多的 .Net 方式来做到这一点。

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T20:41:01.413

这似乎很适合 Windows 服务。我应该说我不是.net 程序员，但我知道您可以使用.net 创建服务。只要您知道可以使用 .net 操作串行端口，就可以了。

-大学教师

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T06:32:08.247

您的要求有点矛盾——如果服务器必须无限期运行，无论是否有客户端要服务，并且必须在所有客户端之间共享进程，无论它们在哪个会话中运行，Windows 服务都是要走的路。

如果您希望服务器仅在有客户端时运行，并且可能（或不）希望这些客户端共享相同的服务器进程，COM Out Of Process Servers 可以是一个选项。

如果是 COM，则必须使用 DCOM 与服务器进程进行通信。对于服务，您可以使用 DCOM、命名管道、RPC 或其他一些 IPC 机制。

但是，如果您希望用 C# 编写服务器代码，那么 DCOM 似乎有点奇怪——可以用 C# 创建 DCOM 服务器，但这确实很尴尬。正如 Kevin 所说，WCF/WAS/Remoting 可能是更容易的选择。但请记住，与本机 COM 服务器或服务相比，这样的解决方案几乎必然具有显着更高的内存消耗开销。如果这个软件要安装在客户端机器上，我因此更喜欢本机解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T21:21:49.627

您似乎在要求两件事-

1.  一种在 Windows 上托管长期运行的持久应用程序的方法，该应用程序将通过串行端口处理某些设备或其他设备。
2.  一种从其他应用程序与该应用程序通信的方式。

Windows 服务是第一个很好的解决方案。Windows 服务充当自定义逻辑的应用程序宿主。它通过通用 UI 和 API 为您提供启动/停止和轻量级监控和配置功能。在 C# 中构建 Windows 服务很容易。从命令行、从应用程序、从 GUI 工具启动和停止 Windows 服务很容易。

将 WCF 视为主要的通信接口。WCF 可用于构造 Windows Service 公开的外部接口。如果您想从 .NET 或 HTTP 客户端（REST 或 SOAP）连接到应用程序（服务），那么 WCF 将为您工作。

COM .... 您在 COM 适合的位置遇到的困惑是由于 COM 将接口机制（IDispatch、IUnknown 等）与托管 + 生命周期模型（本地服务器、Inproc 服务器、远程服务器、根据要求自动启动等）。COM 中的托管和生命周期的东西是有效的，但它总是很苗条。很难知道哪些服务启动了，持续了多长时间。难以按需启动和停止。

在这种情况下，COM 与 WCF 一样，主要用作通信接口。如果您想使用基于组件的接口连接到服务，COM 可能是 Windows 服务托管的一个很好的补充。

COM 和 WCF（REST 或 SOAP）并不相互排斥，事实上许多应用程序都公开了多个接口。你可以选择做一个，或另一个，或两者兼而有之。没有错误的答案，这取决于您的要求。

如果我这样做，我将使用 Windows 服务，并且我将从该服务公开一个 COM 接口，如此处[所述](http://blogs.msdn.com/adioltean/archive/2004/06/18/159479.aspx)。生命周期和托管内容由 Windows 服务负责。然后可以通过 COM 访问该服务，这意味着通过几乎任何编程或脚本语言/环境。Javascript、VB6、Excel 或 OFFICE、Python、Perl 等。

我还考虑从服务中公开 WCF 接口。这也将允许任何 REST 客户端进行连接。将 WCF 视为无线电话，将 COM 视为固定电话。有时你只想要一个。有时你想要两者。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T20:58:22.603

我会为此构建一个 Windows Communication Foundation (WCF) 服务，并使用许多可用的绑定之一来公开它。您可以通过 HTTP/SOAP、HTTP/REST、TCP/Binary、MSMQ 等从同一个服务公开它。如果您有 Windows 2008，则可以通过 Windows 激活服务 (WAS) 激活它。如果你有一些其他的 Windows 操作系统，你应该编写一个可以注册到服务控制管理器 (SCM) 的 Windows 服务。这里有很多选择，但我肯定倾向于使用 WCF 来创建您的服务。WCF 会为您处理很多“管道”。无需重新发明所有这些。希望这可以帮助。

# c# - 如何在后面的代码中获取 CSS 类属性值

> ID：831624
> 
> 赞同：0
> 
> 时间：2009-05-06T20:38:23.417
> 
> 标签：c#, asp.net, css, stylesheet

如何获取 CSS 类中定义的样式的值？

标记具有：

```
CssClass="grdTextBox" Text="aaaaaaaabbbbbbbccccccc" 
```

CSS 样式是：

```
.grdTextBox {FONT-SIZE: 12px; FONT-FAMILY: verdana; } 
```

.cs 文件具有：

```
string cssClass = txtComments.CssClass;
Response.Write(" cssClass is : " + cssClass); 
```

如何从后面的代码中找到字体大小或字体系列的值？

如果它们在样式标签中或者它们是文本框的属性，我可以找到它们。但是如果它们是在 CSS 类中定义的，你怎么能找到这些值呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T20:42:03.267

你没有。由于缺乏真正的解释，CSS 是一种客户端技术。.css 文件中的样式在浏览器呈现之前不会直接与 html 元素相关联。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-18T20:25:10.493

我面临同样的问题，我认为可以通过打开 .css 文件并手动搜索所请求的样式并返回其内容来找到一种解决方案。

它需要手动解析，也许你有多个 .css 文件，或者复杂的样式使这个解决方案有点可怕，但我认为它比“不可能”要好。

我很想听听更优雅的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-30T07:12:24.797

```
Me.Menu.Style("margin-top") = "170px" 
```

如果您想使用内联样式，您可以更改它，否则您可以编写自己的 CSS 类型对象来操作 CSS。

实际上，您可以建立一个这样的库，以便人们可以下载和贡献，只是说。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T20:56:52.403

你做不到。

您在 ASPX 中声明的样式已合并到输出中，但据我所知，它在后面的代码中不可见。

仅当您将其他样式添加到集合中时，例如 MyControl.Style.Add ("font-size", "12px") 才会有它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-08-17T19:28:38.973

您可以使用 HtmlAgilityPack 来完成。示例代码：

```
var doc = new HtmlAgilityPack.HtmlDocument();
doc.Load("PageUrl");

IList<HtmlNode> nodes = doc.QuerySelectorAll("div .my-class[data-attr=123] > ul li");
HtmlNode node = nodes.QuerySelector("p.with-this-class span[data-myattr]"); 
```

# .net - 我的单元测试是否足够？

> ID：831630
> 
> 赞同：1
> 
> 时间：2009-05-06T20:39:45.987
> 
> 标签：.net, unit-testing, email, mocking

我正在查看我为电子邮件服务（使用 SMTP）编写的单元测试，我想知道一个测试是否就足够了。这是我的电子邮件服务的片段：

```
[PluginFamily("EmailService")]
public interface IEmailService
{
    Boolean SendEmail( string toAddress, string fromAddress, string bccAddress,  string ccAddress, string subject,
                       string body, bool html );
}
[Pluggable("EmailService")]
public class EmailService : IEmailService
{
    private IConfigurationReader _configReader;
    public EmailService(IConfigurationReader configurationReader)
    {
        _configReader = configurationReader;
    }
    public bool SendEmail( string toAddress, string fromAddress, string bccAddress, string ccAddress, string subject, string body, bool isHtml )
    {
        MailMessage email = new MailMessage();

        try
        {
            if (_configReader.TestMode)
            {
                toAddress = _configReader.TestEmailAddress;
            }
        }

        //send email here
     }
} 
```

我正在嘲笑 IConfigurationReader（基本上是 ConfigurationManager 的包装器）并将测试模式设置为 true 以测试我是否可以在“测试模式”下发送电子邮件。所以我的单元测试看起来像这样（这是我对该方法的单元测试之一。我有 100% 的代码覆盖率）：

```
 [Test]
    public void Validate_Send_Email_In_Test_Mode()
    {
        bool result;
        MockRepository mockRepository = new MockRepository();
        var mockConfigReader = mockRepository.StrictMock<IConfigurationReader>();

        using (mockRepository.Record())
        {

            SetupResult.For(mockConfigReader.TestMode).Return(true);
            SetupResult.For(mockConfigReader.TestEmailAddress).Return("test@test.com");
            SetupResult.For(mockConfigReader.EmailContentLocation).Return("test");
            SetupResult.For( mockConfigReader.SmtpHost ).Return( "test.mail.com" );
        }

        ObjectFactory.InjectStub(typeof(IConfigurationReader), mockConfigReader);
        emailService = ObjectFactory.GetInstance<IEmailService>();

        using (mockRepository.Playback())
        {
            result = emailService.SendEmail( "testemail@test.com",
                                                  "test@test.com", "", "",
                                                  "this is a unit test - config in test mode", "body of unit test", true );

        }

        Assert.That( result, Is.True );
        ObjectFactory.ResetDefaults();

    } 
```

这足以进行单元测试吗？我能做些什么来改善它？

我担心仅检查我的方法是否返回 true 是不够的单元测试。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T20:43:00.707

提高您的[代码覆盖率](http://en.wikipedia.org/wiki/Code_coverage)（所有类型）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T20:48:46.073

我建议您还包括在满足各种可能的错误条件时“成功”的否定测试。例如，传入一个无效的电子邮件地址并验证是否返回了正确的错误代码和/或异常。

您可能还想模拟一个实际的 SMTP 服务器。虽然我没有做太多搜索，但我找到[了这个 SMTP 服务器模拟站点](http://geekswithblogs.net/imilovanovic/archive/2004/09/27/11783.aspx)。我在 Java 项目的电子邮件插件测试中使用了与此类似的方法。这样你就不用关心它是处于“测试模式”还是生产。唯一的区别是配置中的服务器/端口组合。这具有确保您不只是测试“测试代码”的额外好处。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T20:51:17.147

发送电子邮件会失败吗？如果可以，您至少有两个案例要测试，而您的单个测试是不够的。

由于您有一个布尔返回值，这会向我暗示您期待两个返回码之一，因此您再次没有测试所有可能性。

Not to mention that, when sending email, the return value is the least important of the results of the function: did the email get sent?

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T20:48:57.557

我会说这部分：

```
 {
        if (_configReader.TestMode)
        {
            toAddress = _configReader.TestEmailAddress;
        }
    } 
```

是代码气味。您应该传入 toe-mail 地址，并确保使用您作为参数传入方法的内容调用服务，并使用 mock 确保它被正确发送到电子邮件 api。换句话说，模拟电子邮件 api，不要将模拟本身用作测试主题。

它可能会帮助您尝试以另一种方式编写此代码，首先进行测试，只有在您可以进行证明编写它的测试时才会编写生产代码。

# perl - 在蛋白质序列中寻找基序？

> ID：831640
> 
> 赞同：3
> 
> 时间：2009-05-06T20:41:38.993
> 
> 标签：perl

我编写了以下脚本来搜索蛋白质序列（字符串）中的基序（子字符串）。我是初学者，写这篇文章对我来说很难。我对此有两个问题： **1\. 错误：以下脚本几乎没有错误。我已经有一段时间了，但还没有弄清楚是什么以及为什么？** 2\. 编写了以下脚本来搜索蛋白质序列（字符串）中的一个基序（子字符串）。我的下一个任务涉及在相同的蛋白质序列（字符串）中以特定顺序搜索多个基序（例如：motif1motif2motif 3motif4 此顺序不能更改）

```
 use strict;
        use warnings;

        my @file_data=();
        my $motif ='';
        my $protein_seq='';
        my $h= '[VLIM]';   
        my $s= '[AG]';
        my $x= '[ARNDCEQGHILKMFPSTWYV]';
        my $regexp = "($h){4}D($x){4}D"; #motif to be searched is hhhhDxxxxD
        my @locations=();

        @file_data= get_file_data("seq.txt");

        $protein_seq= extract_sequence(@file_data); 

    #searching for a motif hhhhDxxxxD in each protein sequence in the give file

        foreach my $line(@file_data){
        if ($motif=~ /$regexp/){
        print "found motif \n\n";
        }
        else {
        print "not found \n\n";
        }
        }
#recording the location/position of motif to be outputed

        @locations= match_position($regexp,$seq);
        if (@locations){ 
        print "Searching for motifs $regexp \n";
        print "Catalytic site is at location:\n";
        }
        else{
        print "motif not found \n\n";
        }
        exit;

        sub get_file_data{
        my ($filename)=@_;
        use strict;
        use warnings;
        my $sequence='';

        foreach my $line(@file_data){

        if ($line=~ /^\s*$/){
        next;
                }
        elsif ($line=~ /^\s*#/){
        next;
        }
        elsif ($line=~ /^>/){
        next;
        }
        else {
        $sequence.=$line;
        }
        }
        $sequence=~ s/\s//g;
        return $sequence;
        }

        sub(match_positions) {
        my ($regexp, $sequence)=@_;
        use strict;
        my @position=();
        while ($sequence=~ /$regexp/ig){
        push (@position, $-[0]);
        }
        return @position;
        } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T20:47:29.777

1.  首先，关键字是`elsif`，其次你不需要它。`get_file_data`您可以将循环中的代码压缩为：

    ```
    next if $line =~ /^\s*$|^>/; 
    $sequence .= $line; 
    ```

    只要你打算使用正则表达式——除非太笨拙——你不妨搜索所有你想忽略的情况。如果您发现实际的第二种情况，您可以将其添加为另一种*选择*。假设您想排除以 . 开头的行`#-`。然后你只需像这样添加它：`/^\s*$|^>|^#-/`

2.  另一件事是`my position=();`需要`@`在位置之前有印记，否则，perl 认为您正在尝试调用`position()`.

3.  您需要进行以下更改：

    ```
     my $h= '[VLIM]';   
     my $s= '[AG]';
     my $x= '[ARNDCEQGHILKMFPSTWYV]'; 
    ```

    否则，您只是分配给`$h`一个数组引用，其中一个插槽由*sub* `VLIM`返回的任何内容填充。

4.  第三，不要使用`$&`. 代替`pos($sequence)-length($&)+1`

    ```
    push @positions, $-[0]; 
    ```

    或者更好的是，使用[英语](http://search.cpan.org/perldoc?perlvar)：

    ```
    use English qw<-no_match_vars>;
    ...
    push @positions, $LAST_MATCH_START[0]; 
    ```

5.  我建议以下文件阅读：

    ```
    use IO::File;
    ...
    # Use real file handles
    my $fh = IO::File->new( "<seq.txt" );
    get_file_data( $fh ); # They can be passed
    ...
    sub get_file_data{
        my $file_handle = shift; 
        ...
        # while loop conserves resources
        while ( my $line = <$file_handle> ) { 
            next if $line =~ /^\s*$|^>/;
            $sequence .= $line;
        } 
    ```

6.  一个前进的建议——它对我有很大帮助：

    A. 安装[Smart::Comments](http://search.cpan.org/perldoc?Smart::Comments)

    B. 将其放在脚本的顶部：

    ```
     use Smart::Comments; 
    ```

    C. 每次你不确定你到目前为止得到了什么，比如如果你想查看当前的内容`$sequence`，在代码中放置以下内容：

    ```
    ### $sequence
    exit 0; 
    ```

    只需显示它并退出。当您获得太多打印输出时，请删除它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T21:02:08.507

*   使用“elsif”而不是“elseif”。
*   @file_data 和 @fasta_file_data 应该是同一个东西吗？

在`match_positions`：

*   删除子名称周围的括号。
*   将“我的职位”更改为“我的@职位”。
*   将模式从 /regexp/ig 更改为 /$regexp/ig。

# c# - SortedDictionary (C#) - 改变值

> ID：831643
> 
> 赞同：4
> 
> 时间：2009-05-06T20:42:47.523
> 
> 标签：c#, .net, collections, sorteddictionary

在 SortedDictionary 中是否可以*更改*项目的值？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-06T20:43:45.573

是的，为什么不？

```
sortedDictionary[key] = newValue; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T20:51:05.930

是的，只需像这样使用索引器（在 C# 中）：

```
using System;
using System.Collections.Generic;

class Program
{
    static void Main(string[] args)
    {
        SortedDictionary<int, string> map = 
            new SortedDictionary<int, string>();
        map[1] = "Kevin Hazzard";
        Console.WriteLine( map[1] );
        map[1] = "W. Kevin Hazzard";
        Console.WriteLine( map[1] );
        Console.ReadLine();
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-03-04T13:20:11.993

您可以更改值和键，按定义对键进行排序（添加时）

要更改密钥，请将值存储在临时文件中，删除密钥，然后使用临时值添加新密钥。

# search - 如何使用 Sphinx 在 CMS 中搜索多个模型？

> ID：831644
> 
> 赞同：1
> 
> 时间：2009-05-06T20:42:47.650
> 
> 标签：search, content-management-system, full-text-search, sphinx

我正在尝试在我的 CMS 中使用[Sphinx作为站点范围的搜索。](http://www.sphinxsearch.com)由于 CMS 中的每个模型都有不同的全文字段，因此我为每个模型创建了一个索引。但是，根据 Sphinx 的[论坛](http://sphinxsearch.com/forum/view.html?id=3504)，不支持搜索具有不同模式的多个索引。

你们 CMS 人员如何使用 Sphinx 进行一般网站搜索？对每个模型执行对 Sphinx 的调用并跟踪分页偏移量？使用每个模型/字段的索引字段创建一个巨大的索引？还有其他我没有想到的解决方案吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-12-01T17:32:18.143

您可能很久以前就解决了这个问题，但是...

您不能在一次调用 ->Query() 时覆盖具有不同 Schema 的多个索引，但**您可以[使用 AddQuery() 和 RunQueries() 执行多个查询](http://sphinxsearch.com/docs/current.html#api-func-addquery)**

所以，而不是打电话

```
->Query( 'keywords' , ( 'schemaA', 'schemaB', 'schemaC' ) ) 
```

你做：

```
->AddQuery('keywords' , ( 'schemaA') );
->AddQuery('keywords' , ( 'schemaB') );
->AddQuery('keywords' , ( 'schemaC') );
->RunQueries(); 
```

您将获得一组结果，每个查询一个。然后在您的搜索结果页面中，您可以显示按“类型”（或架构）分隔的结果，例如：

****___****结果页面*****_ *_* __ *_* _*******

 *****寻找“蓝色”...

--- 我们在汽车中找到 23 个结果 ----

*   车 1
*   车 2
*   3号车
*   ..

--- 我们在房屋中找到 2 个结果 ----

*   房子 1
*   房子 2
*   房子 3
*   ..

****_**（结束）结果页***_* __ *_* _****

 **# mercurial - 将 mercurial repo 克隆到远程主机

> ID：831645
> 
> 赞同：13
> 
> 时间：2009-05-06T20:43:00.503
> 
> 标签：mercurial

Mercurial 支持将存储库推送式克隆到远程主机，但是新克隆的存储库不包含工作副本。是否有任何“隐藏”选项可以对这些克隆的存储库进行反复调用更新？

这是一个例子：

1）hg初始化你好

2) hg 克隆你好 ssh://somehost/hello

ssh://somehost/hello 仅包含 .hg 目录，我必须在 shell 中执行以下命令才能填充工作副本：

3) ssh somehost 'cd hello && hg update'

有什么办法可以避免第 3 步）？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-07T21:40:32.837

您可以在接收端创建一个钩子。将以下部分添加到您的 repo/.hg/hgrc

```
[hooks]
changegroup = hg update 
```

那应该这样做。请注意，钩子不会被克隆。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-06T20:49:29.350

没有隐藏选项可以强制更新远程存储库。只有一个条件确定是否执行更新（例如，Mercurial 1.0.1 源代码中 hg.py 的第 239 行）：

```
if dest_repo.local(): 
```

如果你要在工作副本中做一些工作，无论如何你都要登录，此时运行“hg update”非常容易，因此没有太多动力放松当前对远程克隆的限制。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-09-14T21:59:37.330

我有同样的问题，不幸的是，没有简单的解决方案可以避免第 3 步。mercurial 不会像“git clone”那样远程检查工作副本，因此在**为**例如，**第一次。**

# mysql - mysql根据条件计算子表行

> ID：831665
> 
> 赞同：3
> 
> 时间：2009-05-06T20:48:04.127
> 
> 标签：mysql, count, conditional, left-join

我有两个表：“用户”->“订单”

**表：用户**

```
user_id
-----------
    u1
    u2 
```

**表：订单**

```
order_id | user_id | flag
-------------------------
    o1   |    u1   |  fA
    o2   |    u2   |  fB 
```

***Y 需要获取所有用户，计算有多少次带有标志'fA'的订单***

结果我需要什么：

```
user_id | orders
----------------
   u1   |   1
   u2   |   0 
```

**我尝试：**

```
SELECT
    u.user_id,
    COUNT(o.order_id) AS orders
FROM
    `user` AS u LEFT JOIN
    `order` AS o USING (user_id)
WHERE
    o.flag IS NULL OR
    o.flag IN ('fA')
GROUP BY
    u.user_id; 
```

但是，这个查询不包括**user=u2**因为他没有带有**fA**标志的订单；我需要**user=u2**出现**orders=0**

也许是这样的：

```
SELECT
    u.user_id,
    COUNT(o.order_id IF o.flag IN('fA')) OR 0 AS count ... 
```

**表格和数据：**

```
CREATE TABLE `user` (user_id VARCHAR(2) NULL);
CREATE TABLE `order` (order_id VARCHAR(2) NULL,user_id VARCHAR(2) NULL,flag VARCHAR(2) NULL);
INSERT INTO `user` VALUES ('u1'), ('u2');
INSERT INTO `order` VALUES ('o1','u1','fA'),('o2','u2','fB'); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-11-27T18:20:37.483

您可以尝试在“LEFT JOIN”的“ON”语句中使用条件，如下所示：

```
SELECT u.user_id, COUNT(o.user_id)
FROM user u
LEFT JOIN `order` o ON u.user_id = o.user_id AND o.flag = 'fA'
GROUP BY user_id 
```

[在 SQLFiddle 中运行示例](http://sqlfiddle.com/#!2/79b3b/4)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2019-02-07T05:29:18.527

至少有三种方法可以做到：

1.  只需使用依赖子查询。

    ```
    SELECT u.user_id, (SELECT count(user_id) FROM `order` o WHERE o.user_id = u.user_id AND o.flag = 'fA') count
    FROM `user` u; 
    ```

2.  `LEFT JOIN`在子查询上使用：

    ```
    SELECT u.user_id, count(o.user_id) count
    FROM `user` u
    LEFT JOIN (SELECT user_id FROM `order` WHERE flag = 'fA') o USING (user_id)
    GROUP BY u.user_id; 
    ```

3.  `LEFT JOIN`在组合条件下使用：

    ```
    SELECT u.user_id, count(o.user_id) count
    FROM `user` u
    LEFT JOIN `order` o ON o.user_id = u.user_id AND o.flag = 'fA'
    GROUP BY u.user_id; 
    ```

我认为最快的是最后一个，但它需要在足够大的数据上进行测试并查看执行计划。

[SQL小提琴](http://sqlfiddle.com/#!9/c55dd/35)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T20:56:18.507

您需要使用左外连接而不是左连接

```
SELECT
    u.user_id,
    COUNT(o.order_id) AS orders
FROM
    `user` AS u LEFT OUTER JOIN
    `order` AS o USING (user_id)
WHERE
    o.flag IS NULL OR
    o.flag IN ('fA')
GROUP BY
    u.user_id; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T21:04:25.537

您可以尝试使用 CASE 语句。我今天没有 MYSQL，所以我可以验证语法，但它应该接近这个：

```
 SELECT   u.user_id,
             CASE
                WHEN (SELECT COUNT (*)
                        FROM ORDER z
                       WHERE z.user_id = USER.user_id) > 0
                   THEN COUNT (*)
                ELSE 0
             END CASE AS cnt
        FROM USER
    GROUP BY USER.user_id; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T21:08:48.100

此查询将起作用：

```
SELECT
    u.user_id,
    COUNT(o.order_id) AS orders
FROM
    `user` AS u LEFT OUTER JOIN
    (SELECT user_id, order_id FROM `order` WHERE flag IS NULL OR flag IN ('fA')) as o
    USING (user_id)
GROUP BY
    u.user_id; 
```

# java - 如何创建匿名 Python telnet 连接？

> ID：831679
> 
> 赞同：1
> 
> 时间：2009-05-06T20:51:39.017
> 
> 标签：java, python, windows, telnet

我正在尝试在 Windows XP 上使用 Python 远程登录到服务器。我可以通过键入创建匿名连接的“telnet HOST PORT”成功连接。但是 Python 的 telnetlib.Telnet(HOST, PORT) 返回“连接被拒绝”。Java 中的 Telnet 也失败了。Spelunking 显示 Python 尝试创建匿名套接字连接。我的管理员说他不允许匿名连接。但是 Python 和 Java 都不允许在创建套接字连接期间传入身份验证参数（我找不到）。当 Python 和 Java 都失败时，为什么 Windows 的命令行 telnet 可以工作？有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T21:25:01.073

首先，消除 telnetlib 作为您的问题：

```
import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("remote.host", 23))
```

如果成功，则说明您对 的使用存在问题`telnetlib`，我们需要看一个示例。如果它失败了，那么你有一个基本的网络问题，Lance 提出的拔出 ethereal/wireshark 的建议是你的下一步。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T21:03:46.290

[使用wireshark](http://www.wireshark.org/)或类似的数据包跟踪工具跟踪连接尝试（失败案例和成功案例）以查看协议级别的差异是一个好主意。

# unix - 如何在'less'（GNU）中显示行号

> ID：831681
> 
> 赞同：759
> 
> 时间：2009-05-06T20:52:09.217
> 
> 标签：unix, gnu

在左栏中[减少](https://linux.die.net/man/1/less)显示行号的命令是什么？

* * *

## 回答 #1

> 赞同：1093
> 
> 时间：2009-05-06T20:56:49.473

从[手册](http://unixhelp.ed.ac.uk/CGI/man-cgi?less)：

> -N 或 --LINE-NUMBERS 使行号显示在显示中每行的开头。

您还可以通过键入来切换行号而无需退出 less `-N`。

可以通过这种方式切换任何less 的命令行选项。

* * *

## 回答 #2

> 赞同：156
> 
> 时间：2010-12-09T16:10:46.103

您也可以`=`在`less`打开时按下以仅显示（在屏幕底部）有关当前屏幕的信息，包括行号，格式为：

```
myfile.txt lines 20530-20585/1816468 byte 1098945/116097872 1%  (press RETURN) 
```

所以这里例如，屏幕当前显示行`20530-20585`，并且文件总共有`1816468`行。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2009-05-06T20:55:43.373

`cat -n`您可以在管道之前过滤文件`less`：

```
cat -n file.txt | less 
```

或者，如果您的版本`less`支持它，则`-N`选项：

```
less -N file.txt 
```

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2009-10-15T21:15:56.703

您可以设置环境变量以始终将这些选项应用于所有较少的文件：

```
export LESS='-RS#3NM~g' 
```

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2009-11-06T15:09:00.413

命令行标记`-N`或`--LINE-NUMBERS`导致在显示中每行的开头显示行号。

您还可以`less`通过键入来切换行号而不退出`-N<return>`。可以通过这种方式切换任何`less`命令行选项。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2013-10-26T00:29:49.150

如果您点击`=`并希望看到行号，但只看到字节数，那么行号将被关闭。点击`-n`打开它们，并确保`$LESS`不包含“n”。

默认情况下关闭行号（例如，设置`LESS=n`）可以加快在非常大的文件中的搜索。如果您经常搜索大文件，但通常不关心您在哪一行，这会很方便。

我通常运行`LESS=RSXin`（启用转义码，切掉长行，退出时不清除屏幕，忽略所有小写搜索的大小写，默认情况下不计算行号）并且仅根据需要使用`-n`or`-S`从内部`less`。

# sql-server - 可以在 SQL 2005 标准发布者和 SQL 2008 Web 订阅者之间设置复制吗

> ID：831682
> 
> 赞同：0
> 
> 时间：2009-05-06T20:52:26.160
> 
> 标签：sql-server, replication

我目前有一个 SQL 2005 服务器。我想复制到 SQL 2008 Web Edition 服务器。是否可以设置从 SQL 2005 标准版发布者到 SQL 2008 网络版订阅者的复制。复制类型的最佳选择是什么？这个设置有什么大问题吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T17:21:22.587

有没有可能。（[版本功能支持](http://msdn.microsoft.com/en-us/library/cc645993.aspx)）

复制类型实际上取决于您要将数据用于什么

如果它的双向实时数据发生变化，那么合并复制可能是最合适的。如果您需要更多数据用于报告目的，那么事务性或快照可能会更好。

MS在评估复制方面有一些很好的[msdn 页面。](http://msdn.microsoft.com/en-us/library/ms152531(SQL.90).aspx)从个人经验来看，如果预算允许它第一次获得顾问，特别是如果它的任务在短时间内很关键。事情可能会出错或以意想不到的方式表现（并且错误处理并不总是很明显。）

# .net - Oracle .Net 驱动程序的性能

> ID：831684
> 
> 赞同：-1
> 
> 时间：2009-05-06T20:52:36.580
> 
> 标签：.net, oracle

我目前正在比较 4 种不同的 Oracle .net 驱动程序的性能。ODP.Net、DataDirect、OraDirect 和 Microsoft .Net 驱动程序。

似乎 Microsoft 驱动程序最慢，其他驱动程序与 DataDirect 相当，比 OraDirect 快，而 OraDirect 又比 ODP.Net 快。

我的问题是这是否与其他人的经验一致。如果 DataDirect 是最快的，有什么问题吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-23T16:25:46.490

我唯一的答案是 DataDirect 似乎是最快的。

# css - CSS 中的 @import 会导致额外的 http 请求吗？

> ID：831685
> 
> 赞同：12
> 
> 时间：2009-05-06T20:53:00.073
> 
> 标签：css

我有一个电子商务网站，其中包含从标头链接的大约 8 个 CSS 文件 - 导致对服务器的 8 个单独的 http 请求。我将所有 CSS 文件合并为 1 个大文件，生成一个 67kb (!) 文件 - 将我们的 css 文件的 http 请求减少到 1 个。

鉴于我不断在网站上执行更新，我发现这个大小的 CSS 文件有点难以管理。我担心的是我的用户可能会在更新过程中发现我并在从一个页面移动到另一个页面时看到一个非样式的页面 - b/c 67kb 仍然需要 2-3 秒才能通过 FTP 成功放置在远程服务器上.

我的问题是：在这个大的 CSS 文件中使用 @import 将文件分解成更小更易于管理的大小（在那个 CSS 文件中）是否会让我们在页面加载时回到原来的 8 个 http-requests？还是 CSS 中的 @imports 以某种方式处理不同？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-06T20:57:34.947

是的，在使用@import 时，您将返回每个样式表的请求。

最好的办法是将 css 压缩并整合到一个文件中以进行部署。但是您仍然可以使用单独的文件进行开发。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-06-26T23:57:03.990

您可以通过将样式表与 .htaccess 组合来防止额外的 http 请求。该技术在[HTML5 Boilerplate](http://html5boilerplate.com) .htaccess 中进行了说明。它是这样工作的：

在 .htaccess 中：

```
<FilesMatch "\.combined\.(js|css)$">
    Options +Includes
    SetOutputFilter INCLUDES
</FilesMatch> 
```

在 style.combined.css 中：

```
<!--#include file="reset.css"-->
<!--#include file="style.css"--> 
```

您可以使用它来组合 .js（或您放在括号中的任何其他扩展名。）

Options +Includes 的文档在[这里](http://httpd.apache.org/docs/current/mod/core.html)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T20:59:27.470

浏览器必须以某种方式获取数据，那么它怎么可能不使用另一个 http 请求呢？;-)

但也有可能，如果您只更改一个文件而其他七个文件不变，您将从浏览器缓存中受益。

您可以尝试嗅探客户端和服务器之间的连接并查看它的请求。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T21:02:07.773

`@import`是的，每个报表都会发出单独的请求。

您可以通过快速测试来检查这一点；编写一段 HTML，包括一个导入第二个 CSS 文件的 CSS 文件。在 Firebug 的网络面板中查看结果会显示对每个 CSS 文件的两个单独的请求。那是我用来确认这个答案的测试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T21:03:03.887

CSS 导入的处理与页面上的任何其他“包含”没有任何不同，例如对外部 JavaScript 脚本的引用。但是，除了第一次访问您的站点外，浏览器缓存应该使这不是问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T21:11:03.947

如果你有一个 67 Kb 的 CSS 文件，那就有点奇怪了。请记住，CSS 中的 C 用于 CASCADING，这意味着您不必在每个类中定义该类中涉及的每个标签的所有属性。

例如，如果您将 <DIV id="maincontainer"> 定义为容器，您可以为其定义一个类

```
#maincontainer {font-face:Arial,helvetica,sans;} 
```

这意味着如果您为标签 <P> 创建它的子类，例如

```
#maincontainer P {color:darkgray;} 
```

DIV 主容器内的所有 <P> 标记都将使用字体 arial、helvetica、sanz。

还可以尝试创建 CSS 文件，以了解它们在页面中的使用方式。所有站点的唯一 CSS 文件可以加载许多不会在某些页面中使用的类。分而治之。

# javascript - 如何检测浏览器窗口是否聚焦？

> ID：831686
> 
> 赞同：7
> 
> 时间：2009-05-06T20:53:01.230
> 
> 标签：javascript

只有当窗口在后台时，我的页面才会发出通知声音。我可以跟踪`window.onfocus`和`window.onblur`事件以注意焦点状态何时发生变化。但是，我不知道窗口是否会加载焦点，因为它可能会加载到背景选项卡中，例如。

`onfocus`在收到/`onblur`事件之前如何决定是否播放声音？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T21:05:05.070

难道你不能假设它加载模糊，然后在收到任何类型的事件（keydown/mousemove）后立即将状态更改为集中？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T21:05:20.480

onfocus 事件应该在页面最初打开时触发（在前台）。至少它在 FF3/IE8 中。

因此，您最初可以打开声音，在触发 onfocus 时将其关闭，然后在触发 onblur 时将其重新打开。

# javascript - javascript浮点错误是否有明确的解决方案？

> ID：831687
> 
> 赞同：4
> 
> 时间：2009-05-06T20:53:36.187
> 
> 标签：javascript, floating-point

我编写业务应用程序。我想使用 Javascript 构建前端，并试图弄清楚如何为业务用户处理浮点错误（我从计算机科学的角度理解它们可能不被视为错误）。我已经阅读了很多关于这方面的内容，并看到了各种适用于给定示例但似乎容易意外崩溃的舍入技巧。有没有明确的方法在 javascript 中进行十进制数学运算？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T21:18:46.877

根据 Douglas Crockford 的说法，解决此问题的唯一方法是将您的值缩放为整数。`Math.round`通过使用缩放值确保它确实是一个整数。（DC 没有谈论舍入部分，但我发现它是必要`Math.round(1.1 *100))`的。例如，进行计算。当您完成数学比例回到原始精度时。请参阅*JavaScript：The Good Parts* “Floating Point”部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-08T00:46:26.213

一个答案是用十进制而不是二进制来计算。那么您就不必担心十进制 <=> 二进制转换错误。您可以将数字表示为数组或字符串中的二进制数字，并自己编写数学例程。

如果您不想麻烦，可以查看以下一些 bignumber 库：

[http://jsfromhell.com/classes/bignumber](http://jsfromhell.com/classes/bignumber)

[http://stz-ida.de/html/oss/js_bigdecimal.html.en](http://stz-ida.de/html/oss/js_bigdecimal.html.en)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T21:08:55.357

唯一确定的解决方案似乎是编写自己的任意精度数字类型，在内部处理字符串——这将是复杂且非常缓慢的。

# asp.net-mvc - MVC 中的 AJAX 超时问题

> ID：831692
> 
> 赞同：1
> 
> 时间：2009-05-06T20:54:20.930
> 
> 标签：asp.net-mvc, ajax, authentication

我有一个 ASP.Net MVC 应用程序。我在页面上使用 AJAX 请求，该请求需要用户身份验证才能在另一个控制器上触发操作，该控制器返回一个视图以更新页面上的表。AJAX 请求执行的操作也需要身份验证。当用户让他们的会话超时然后执行某些操作来触发 AJAX 请求时，就会出现此问题。整个页面不会重定向到登录页面。相反，返回给 AJAX 请求的视图是登录页面，然后将其填充到用于刷新数据表的 div 中。

有没有办法至少让请求返回错误消息而不是登录视图？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T06:47:22.377

当然，您可以创建自己的 Authorize 属性并检查是否 HttpContext.Current.Request.Headers["XMLHttpRequest"] 然后返回错误消息，否则重定向到登录页面

# c# - System.Web.Script.Serialization.JavaScriptSerializer 还是 System.Runtime.Serialization.Json.DataContractJsonSerializer？

> ID：831697
> 
> 赞同：28
> 
> 时间：2009-05-06T20:54:58.230
> 
> 标签：c#, .net, json

两者有什么区别？你为什么要使用一个而不是另一个？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-06T21:12:12.947

在这里找到：[http ://aaron-powell.spaces.live.com/blog/cns!91A824220E2BF369!150.entry](http://aaron-powell.spaces.live.com/blog/cns!91A824220E2BF369!150.entry)

**DataContractJsonSerializer DataContractJsonSerializer** 的主要目的是与 WCF 一起使用，因为一个序列化是 WCF 的一大焦点。此外，它还可以更好地处理只有某些属性可用于序列化的复杂类。这个类的类型更强，对它处理的类型有更多的了解，对格式错误的 JSON 有更好的错误处理。

**JavaScriptSerializer** 另一方面，这个类更适合快速序列化，它是一种更牛仔的方法。错误检查更少，对序列化的属性的控制更少。

更新

由于上面的链接已经失效，这里是另一个链接： http: [//kb.cnblogs.com/a/1454030](http://kb.cnblogs.com/a/1454030/)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-06T21:12:44.660

就个人而言，我会看[Json.NET](http://www.newtonsoft.com/json) - 这具有与 .NET 2.0 兼容的优势

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T21:03:25.447

JavaScriptSerializer 在框架 3.5 中被标记为已过时。你不应该因为这个原因使用它。但是，回到你的问题。JavaScriptSerializer 不需要将类标记为 [Serializable] 或 [DataContract]，但 DataContractJsonSerializer 需要。如果您编译了无法使用属性标记的类，则可能需要使用较旧的 JSON 序列化程序。

# jquery-plugins - jquery jqmodal窗口IE位置

> ID：831698
> 
> 赞同：0
> 
> 时间：2009-05-06T20:55:23.797
> 
> 标签：jquery-plugins

我使用 +position:absolute !important; 修复了内容被下推的方式 我发现的黑客。但是现在我的问题是无论我如何设置顶部的样式（在 IE 的 jqmWindow 中，它似乎仍然会在页面中间弹出窗口。但是在 FF 中，我已经让页面更靠近顶部。原因为什么我需要移动这个 jqm 窗口是因为 div (jqm) 上有更多信息然后将适合屏幕。有没有办法让窗口具有一定的大小并在侧面有滚动条如果内容是更大吗？感谢您的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T21:02:38.850

您应该能够将窗口的内容包装在 div 中并设置它的高度以及溢出

```
div.wrap{
   height:220px;
   overflow:scroll;
} 
```

# unix - 在 UNIX 机器上查找有关 CPU 信息的命令

> ID：831716
> 
> 赞同：36
> 
> 时间：2009-05-06T20:58:32.587
> 
> 标签：unix, cpu

你知道是否有一个 UNIX 命令可以告诉我 Sun OS UNIX 机器的 CPU 配置是什么？我也在尝试确定内存配置。有 UNIX 命令可以告诉我吗？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-05-06T21:01:32.330

没有标准的 Unix 命令，AFAIK。我没有使用过 Sun OS，但是在 Linux 上，你可以使用这个：

```
cat /proc/cpuinfo 
```

抱歉，它是 Linux，而不是 Sun OS。Sun OS 可能也有类似的东西。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2013-09-13T13:23:39.403

nproc 命令显示可用处理单元的数量：
$ nproc

示例输出：4

lscpu 以人类可读格式从 /proc/cpuinfon 收集 CPU 体系结构信息：
$ lscpu

示例输出：

体系结构：x86_64
CPU op-mode(s) : 32-bit, 64-bit
字节顺序: Little Endian
CPU(s): 8
On-line CPU(s) list: 0-7
Thread(s) per core: 1
Core(s) per socket: 4
CPU socket( s)：2
NUMA 节点：1
供应商 ID：GenuineIntel
CPU 系列：6
型号：15
步进：7
CPU MHz：1866.669
BogoMIPS：3732.83
虚拟化：VT-x
L1d 缓存：32K
L1i 缓存：32K
L2 缓存：4096K
NUMA 节点0 CPU：0-7

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-05-06T21:03:19.567

尝试[psrinfo](http://www.sunsolarisadmin.com/general/psrinfo-find-number-of-physical-virtual-processors-in-solaris-10/)查找处理器类型和系统上安装的物理处理器的数量。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-06T22:29:37.907

首先，它可能取决于您运行的 Solaris 版本，以及您拥有的硬件。

至少在 SPARC 上，您必须`psrinfo`向您显示处理器信息，它自己运行会显示`CPU`机器看到的 s 数量。`psrinfo -p`显示安装的物理处理器的数量。从中您可以推断出每个物理处理器的线程/内核数。

`prtdiag`将显示有关您机器中硬件的大量信息。看起来在 V240 上确实可以从 获取内存通道信息`prtdiag`，但在 T2000 上却没有。我猜这是 UltraSPARC IIIi 和 UltraSPARC T1 之间的架构问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T21:01:48.133

我认为您可以在许多 UNIX 上使用 prtdiag 或 prtconf

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T21:05:35.800

我最喜欢看启动信息。如果最近启动过，请尝试运行 /etc/dmesg。否则，在 /var/adm 或 /var 中的某个位置找到引导消息。

# matlab - 以快速、向量化的方式将二进制矩阵转换为最后一个非零索引的向量

> ID：831721
> 
> 赞同：9
> 
> 时间：2009-05-06T20:59:14.957
> 
> 标签：matlab, matrix, vector, vectorization

假设在 MATLAB 中，我有一个矩阵 A，其元素为 0 或 1。

如何以更快的向量化方式获取每列最后一个非零元素的索引向量？

我可以做

`[B, I] = max(cumsum(A));`

并使用`I`，但有更快的方法吗？（我假设 cumsum 即使将 0 和 1 相加也会花费一些时间）。

**编辑：**我想我矢量化的速度甚至超过了我需要的速度 - Fooz 先生的循环很棒，但 MATLAB 中的每个循环似乎都花费*了我*很多调试时间，即使它很快。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-06T21:52:53.067

快速是您应该担心的，不一定是全矢量化。最新版本的 Matlab 在有效处理循环方面要聪明*得多。*如果有一种紧凑的矢量化方式来表达某些东西，它通常会更快，但不应该（总是）像过去那样害怕循环。

```
clc

A = rand(5000)>0.5;
A(1,find(sum(A,1)==0)) = 1; % make sure there is at least one match

% Slow because it is doing too much work
tic;[B,I1]=max(cumsum(A));toc

% Fast because FIND is fast and it runs the inner loop
tic;
I3=zeros(1,5000);
for i=1:5000
  I3(i) = find(A(:,i),1,'last');
end
toc;
assert(all(I1==I3));

% Even faster because the JIT in Matlab is smart enough now
tic;
I2=zeros(1,5000);
for i=1:5000
  I2(i) = 0;
  for j=5000:-1:1
    if A(j,i)
      I2(i) = j;
      break;
    end
  end
end
toc;
assert(all(I1==I2)); 
```

在 R2008a、Windows、x64 上，cumsum 版本需要 0.9 秒。循环和查找版本需要 0.02 秒。双循环版本仅需 0.001 秒。

**编辑：**哪个最快取决于实际数据。当您将 0.5 更改为 0.999 时，双循环需要 0.05 秒（因为平均而言，它需要更长的时间来中断）。cumsum 和 loop&find 实现具有更一致的速度。

**编辑 2：** gnovice 的 Flipud 解决方案很聪明。不幸的是，在我的测试机器上它需要 0.1 秒，所以它比 cumsum 快得多，但比循环版本慢。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-06T22:17:16.923

正如[Fooz 先生](https://stackoverflow.com/questions/831721/turning-a-matlab-binary-matrix-into-a-vector-of-the-last-nonzero-index-in-a-fast/831964#831964)所展示的，对于新版本的 MATLAB，for 循环现在可以非常快。但是，如果您真的想要紧凑的矢量化代码，我建议您尝试以下操作：

```
[B,I] = max(flipud(A));
I = size(A,1)-I+1; 
```

这比您基于 CUMSUM 的答案要快，但仍不如 Fooz 先生的循环选项快。

需要考虑的另外两件事：

*   对于完全没有任何列的列，您希望得到什么结果？通过上面我给你的选项，我相信在这种情况下你会得到一个**size(A,1)的索引（即****A**中的行数）。对于您的选择，我相信在这种情况下您会得到 1，而 Fooz 先生的嵌套循环选项会给您 0。

*   这些不同选项的相对速度可能会根据**A**的大小和您期望它具有的非零数的数量而有所不同。

# svn - 在哪里可以找到适用于 Ubuntu（或 Debian）的 subversion 1.6 的预构建二进制文件？

> ID：831723
> 
> 赞同：9
> 
> 时间：2009-05-06T20:59:37.080
> 
> 标签：svn, ubuntu, debian

虽然我可以轻松找到最新版本的 subversion (1.6) 的二进制文件，但我找不到 Ubuntu（或 Debian）的二进制文件。

tigris.org的[下载页面建议使用以下命令：](http://subversion.tigris.org/getting.html#ubuntu)

```
apt-get install subversion 
```

但正如您所体验的那样，它将安装到 1.5.4 版本（在 2009 年 5 月 6 日撰写本文时）。

这不是一件好事，因为我与 Windows 共享的许多工作副本都由 TortoiseSVN 自动更新到 1.6。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-31T07:09:41.737

这是一个 APT 存储库，其中包含适用于 Ubuntu 8.04 到 9.10 的 Subversion 1.6 二进制包：[https ://launchpad.net/~anders-kaseorg/+archive/subversion-1.6](https://launchpad.net/~anders-kaseorg/+archive/subversion-1.6)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-09T11:57:13.727

我用这些存储库解决了它：

`deb http://ppa.launchpad.net/anders-kaseorg/subversion-1.6/ubuntu intrepid main`
`deb-src http://ppa.launchpad.net/anders-kaseorg/subversion-1.6/ubuntu intrepid main`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-06T22:06:18.603

[您可以在http://packages.debian.org/experimental/subversion](http://packages.debian.org/experimental/subversion)的 debian 实验存储库中找到 subversion 1.6 的 debian 软件包。

话虽如此，您可能可以使用 ubuntu 存储库中的 1.5.4 版本，但如果您使用的 svn 服务器未运行 1.6，您将无法在客户端中使用任何新功能。

如果我是你，我会先尝试在存储库中使用该版本，然后再从第三方安装它，因为你可能会发现它确实对你有用，而且从长远来看，它会让你在更新 subversion 时更轻松。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-05-24T09:16:12.577

将这两行添加到您的 /etc/apt/sources.list 中：

```
deb http://ppa.launchpad.net/anders-kaseorg/subversion-1.6/ubuntu hardy main 
deb-src http://ppa.launchpad.net/anders-kaseorg/subversion-1.6/ubuntu hardy main 
```

获取安德斯密钥：

```
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 413576CB 
```

更新：

```
sudo apt-get update 
```

升级或安装：

```
sudo apt-get upgrade
sudo apt-get install subversion 
```

（通过[GVS](http://growingventuresolutions.com/blog/installing-subversion-svn-1-6-ubuntu-8-04-lts-hardy)）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-19T17:27:18.150

解决了！这里的解决方案。

从 CollabNet 下载[页面](http://www.open.collab.net/downloads/subversion/redhat.html)下载 Red Hat 的二进制文件。然后使用外星人安装它，例如：

```
$ sudo apt-get install alien
$ sudo alien CollabNetSubversion-client-1.6.2-1.i386.rpm
$ sudo dpkg -i collabnetsubversion-client_1.6.2-2_i386.deb 
```

请注意，该命令安装在 /opt/CollabNet_Subversion/bin/svn 下而不是 /usr/bin/svn 下。所以在那之后只需把这一行放在你的`.bashrc`：

```
export PATH="/opt/CollabNet_Subversion/bin:$PATH" 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-24T08:56:32.693

您现在可以在这里找到经过认证的二进制文件：[http ://www.wandisco.com/subversion/os/downloads?type=ubuntu910](http://www.wandisco.com/subversion/os/downloads?type=ubuntu910)

该脚本将为您设置一个存储库，因此您将继续获取更新。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T22:22:05.570

您*不需要*1.6 版本来处理您的 Windows 工作副本。SVN 足够聪明，可以识别客户端提供的功能，并且只允许这些功能通过——因此您的 1.5.4 客户端可以毫无问题地连接到您的 1.6 服务器；您的 Windows 1.6 客户端也可以。

唯一遇到问题的情况是，如果您使用 2 个客户端和一个工作副本 - 即您的 Windows 和 Linux 客户端都提交和更新单个共享目录。无论如何，这样的安排是一个坏主意，即使不计算 EOL 差异，您也会遇到各种问题。如果您遇到这种情况，请检查一个新的 WC，这样您就有了一个用于 Linux 和另一个用于 Windows。

# iphone - 当 iPhone 进入睡眠模式时，socketpair() 似乎不起作用

> ID：831724
> 
> 赞同：1
> 
> 时间：2009-05-06T21:00:20.197
> 
> 标签：iphone

我正在开发一个 iPhone 应用程序，我使用 socketpair() 作为应用程序不同模块之间的通信方式。只要 iPhone 处于活动状态，它就可以正常工作。一旦它进入睡眠状态，几分钟（比如 10 分钟）后，到达套接字对一端的数据似乎并没有传递到另一端。一旦我唤醒它，所有数据都会立即到达（似乎它正在另一端累积）。

你能告诉我如何解决这个问题吗？我应该使用 pipe() 而不是 socketpair() 吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-03-01T12:47:12.333

我怀疑这样做是为了在 iPhone 处于睡眠模式时节省电量。

如果您愿意，可以使用[`idleTimerDisabled`UIApplication 的属性在](http://developer.apple.com/library/ios/#documentation/uikit/reference/UIApplication_Class/Reference/Reference.html)应用程序运行时禁用自动睡眠。

# c# - C# Decimal.Parse 逗号问题

> ID：831727
> 
> 赞同：22
> 
> 时间：2009-05-06T21:01:06.683
> 
> 标签：c#, parsing, decimal

这是我的问题（对于 en-US）：

`Decimal.Parse("1,2,3,4")`返回 1234，而不是抛出 InvalidFormatException。

大多数 Windows 应用程序 (Excel en-US) 不会删除千位分隔符，也不认为该值是十进制数。其他语言也会出现同样的问题（尽管字符不同）。

有没有其他十进制解析库可以解决这个问题？

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-06T21:08:44.437

它允许数千个，因为( )`NumberStyles`使用的默认值包括.`Decimal.Parse``NumberStyles.Number``NumberStyles.AllowThousands`

如果您想禁止千位分隔符，您可以删除该标志，如下所示：

```
Decimal.Parse("1,2,3,4", NumberStyles.Number ^ NumberStyles.AllowThousands) 
```

（上面的代码会抛出一个`InvalidFormatException`，这就是你想要的，对吧？）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-08T02:38:05.027

我最终不得不编写代码来手动验证货币。就个人而言，对于一个以内置所有全球化内容而自豪的框架，令人惊讶的是.NET 没有任何东西可以处理这个问题。

我的解决方案如下。它适用于框架中的所有语言环境。不过，正如 Orion 在下面指出的那样，它不支持负数。你们有什么感想？

```
 public static bool TryParseCurrency(string value, out decimal result)
    {
        result = 0;
        const int maxCount = 100;
        if (String.IsNullOrEmpty(value))
            return false;

        const string decimalNumberPattern = @"^\-?[0-9]{{1,{4}}}(\{0}[0-9]{{{2}}})*(\{0}[0-9]{{{3}}})*(\{1}[0-9]+)*$";

        NumberFormatInfo format = CultureInfo.CurrentCulture.NumberFormat;

        int secondaryGroupSize = format.CurrencyGroupSizes.Length > 1
                ? format.CurrencyGroupSizes[1]
                : format.CurrencyGroupSizes[0];

        var r = new Regex(String.Format(decimalNumberPattern
                                       , format.CurrencyGroupSeparator==" " ? "s" : format.CurrencyGroupSeparator
                                       , format.CurrencyDecimalSeparator
                                       , secondaryGroupSize
                                       , format.CurrencyGroupSizes[0]
                                       , maxCount), RegexOptions.Compiled | RegexOptions.CultureInvariant);
        return !r.IsMatch(value.Trim()) ? false : Decimal.TryParse(value, NumberStyles.Any, CultureInfo.CurrentCulture, out result);
    } 
```

这是一个显示它工作的测试（nUnit）：

```
 [Test]
    public void TestCurrencyStrictParsingInAllLocales()
    {
        var originalCulture = CultureInfo.CurrentCulture;
        var cultures = CultureInfo.GetCultures(CultureTypes.SpecificCultures);
        const decimal originalNumber = 12345678.98m;
        foreach(var culture in cultures)
        {
            var stringValue = originalNumber.ToCurrencyWithoutSymbolFormat();
            decimal resultNumber = 0;
            Assert.IsTrue(DecimalUtils.TryParseCurrency(stringValue, out resultNumber));
            Assert.AreEqual(originalNumber, resultNumber);
        }
        System.Threading.Thread.CurrentThread.CurrentCulture = originalCulture;

    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T21:20:10.617

您可以分两阶段进行。首先，您可以使用 中的信息验证千位分隔符，`CultureInfo.CurrentCulture.NumberFormat.NumberGroupSeparator`如果`CultureInfo.CurrentCulture.NumberFormat.NumberGroupSizes`未通过则抛出异常，然后将数字传递给`Decimal.Parse()`;

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-01-29T09:01:46.427

这是微软从未解决的常见问题。所以，我不明白为什么 1,2,3.00（例如英语文化）是有效的！如果测试未通过，您需要构建一个算法来检查组大小并返回错误/异常（如失败的 double.parse）。我在 mvc 应用程序中遇到了类似的问题，它内置的验证器不接受数千..所以我用自定义覆盖它，使用 double/decimal/float.parse，但添加了一个逻辑来验证组大小。

如果您想阅读我的解决方案（它用于我的 mvc 自定义验证器，但您可以使用它来获得更好的 double/decimal/float.parse 通用验证器）去这里 [https://stackoverflow.com/a/41916721/3930528](https://stackoverflow.com/a/41916721/3930528)

# java - 实现搜索文档（PDF、XML、HTML、MS Word）的最佳方法是什么？

> ID：831738
> 
> 赞同：1
> 
> 时间：2009-05-06T21:02:55.353
> 
> 标签：java, search, pdf, ms-word

编写用于在 Java Web 应用程序中搜索文档的搜索功能的好方法是什么？

“标记搜索”是否适合这种搜索功能？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T21:09:21.423

为什么要重新发明轮子？

查看[Apache Lucene](http://lucene.apache.org/java/docs/)。

此外，在 Stack Overflow 中搜索“全文搜索”，您会发现许多其他非常相似的问题。这是另一个，例如： [如何在网站中实现搜索功能？](https://stackoverflow.com/questions/34314/how-do-i-implement-search-functionality-in-a-website)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T00:48:58.180

您可以使用位于 Lucene 之上的[Solr ，它是一个真正的 Web 搜索引擎应用程序，而 Lucene 是一个库。](http://lucene.apache.org/solr/)然而，Solr 和 Lucene 都没有解析 Word 文档、pdf 等来提取元数据信息。有必要根据预定义的文档模式对文档进行索引。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T09:32:59.687

至于提取 Office 文档的文本内容（在提供给 Lucene 之前需要这样做），有 Apache Tika 项目，它支持[多种文件格式](http://lucene.apache.org/tika/formats.html)，包括微软的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-23T12:06:49.007

使用 Tika，从文件中获取文本的代码非常简单：

```
import org.apache.tika.exception.TikaException;
import org.apache.tika.metadata.Metadata;
import org.apache.tika.parser.AutoDetectParser;
import org.apache.tika.sax.BodyContentHandler;
import org.apache.tika.parser.Parser;

// exception handling not shown
Parser parser = new AutoDetectParser();
StringWriter textBuffer = new StringWriter();
InputStream input = new FileInputStream(file);
Metadata md = new Metadata();
md.set(Metadata.RESOURCE_NAME_KEY, file.getName());
parser.parse(input, new BodyContentHandler(textBuffer), md);
String text = textBuffer.toString() 
```

到目前为止，Tika 0.3 似乎运行良好。只需将任何文件扔给它，它就会为您返回对该格式最有意义的内容。到目前为止，我可以获取用于索引我已经抛出的任何内容的文本，包括 PDF 和新的 MS Office 文件。如果某些格式存在问题，我认为它们主要在于获取格式化的文本提取，而不仅仅是原始明文。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-26T12:37:41.267

只为更新

还有另一种替代 Solr 的替代方案，称为“ [ElasticSearch](http://www.elasticsearch.org/) ”，它是一个具有良好功能的项目，类似于 Solr，但无模式。

这两个项目都建立在 Lucene 之上。

# ruby-on-rails - 如何使 Rails 中的模型 ID 不可预测且随机

> ID：831746
> 
> 赞同：26
> 
> 时间：2009-05-06T21:04:11.437
> 
> 标签：ruby-on-rails, ruby-on-rails-plugins

我正在编写一个 Rails 应用程序，就其性质而言，它不能要求用户注册，因此不能使用身份验证作为保护记录的常用手段。（我知道，我知道...）这里的用户信息仅限于电子邮件地址。所以我确实需要一种方法来让我的模型 ID 不可预测，这样其他 ID 就不容易被猜到。（我知道我知道...）

我曾尝试使用像 uuidtools 这样的插件在创建记录时随机化 id，如下所示：

```
require 'uuidtools'
class Post < ActiveRecord::Base 
 def before_create() 
  self.id = OpenSSL::Digest.SHA1.hexdigest(UUID.timestamp_create()) 
 end 
end 
```

...起初看起来不错，但有趣的事情发生了。ActiveRecord 有时会尝试在 id 中插入 0 值，我会收到诸如“找不到 id=0 的帖子”等错误...

我已经没有想法了。任何人都可以帮忙吗？谢谢。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2012-12-03T10:03:20.883

在您的模型中，执行以下操作：

```
before_create :randomize_id

...

private
def randomize_id
  begin
    self.id = SecureRandom.random_number(1_000_000)
  end while Model.where(id: self.id).exists?
end 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2016-01-08T14:52:31.080

最好的方法是使用`SecureRandom.uuid`生成 V4 UUID（通用唯一标识符）。

它几乎是完全随机且唯一的（碰撞概率大约是数十万亿）： [https ://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_.28random.29](https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_4_.28random.29)

这应该可以完成工作：

```
class Post < ActiveRecord::Base
 before_create :generate_random_id

 private 
 def generate_random_id
   self.id = SecureRandom.uuid
 end 
end 
```

或者，如果您使用 Rails >= 4 和 PostgreSQL，您可以让它为您生成它们：

```
create_table :posts, id: :uuid do |t|
  ...
end 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-12T12:32:10.990

这里出错的是 self.id 需要一个 int 并且 OpenSSL::Digest.SHA1.hexdigest(UUID.timestamp_create()) 返回一个带有非数字字符的字符串，这将导致值 '0' 实际上是存储在数据库中

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T21:14:16.280

另一种方法是在记录创建期间在第二列中生成令牌或校验和或其他任何内容，并且在所有情况下，您的控制器查询对象，使用`Model.find_by_id_and_token`.

然后，您将始终生成包含并需要 id 和令牌的 URL。

# php - 在另一个字符串中扩展带引号的字符串

> ID：831749
> 
> 赞同：0
> 
> 时间：2009-05-06T21:05:06.567
> 
> 标签：php, javascript

我有两个包含一些 html 代码的变量，以及另一个包含 html 表单代码的变量。我试图在第二秒内扩展一个字符串以将其作为参数传递给函数，但这会导致一些错误。

我的制作弹出功能非常简单：

```
function popup(htmlcode){
child1 = window.open ("about:blank");
child1.document.write(htmlcode);
child1.document.close(); 
} 
```

使用上述函数的代码

```
<?php
$blah = "<h1>Well</h1>"; $test = "<h2>Done</h2>";
echo '<script type="text/javascript" src="fetchlayers.js"></script>';
$formcode = "<form action=\"process.php\" method=\"post\" enctype=\"multipart/form-data \">
<label for=\"file\">Filename:</label>
<input type=\"file\" name=\"file\" id=\"file\"/> 
<br />
<input type=\"submit\" name=\"submit\" value=\"Submit\" onclick=\"setTimeout(function() { sendInfo(\"".$blah."\", \"".$test."\"); } ),1250);\" />
</form>";

echo "<h1>hello</h1>
<div id='form'>
<a href='#' onclick=\"popup('" . htmlentities($formcode) . "'); return false;\">
click here</a>
</div>"; 
```

这会产生足够好的 html 代码，但是萤火虫给了我一个错误，我有一个未终止的字符串横向。我找不到这是哪里。我知道我这样做的方式并不理想，但我正在学习，目前不知道更好的方式。我很感激任何意见

编辑：好的，所以问题是我有未终止的字符串文字，它们是 \n 字符。我把字符串变成了一行，它正确地调用了函数。

不能将一个 echo 语句分成多行吗？

现在问题出在弹出窗口中生成的 html 上。有些代码实际上是打印到屏幕上的，这是为什么呢？

```
<form action="process.php" method="post" enctype="multipart/form-data "><label for="file">Filename:</label><input name="file" id="file" type="file"> <br><input name="submit" value="Submit" onclick="setTimeout(function() { sendInfo(" type="submit"><h1>Well</h1>", "<h2>Done</h2>"); },1250);" /></form> 
```

[在此处](http://i44.tinypic.com/14t22k9.jpg)查看图片：

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T23:04:00.913

如果您绝对必须保持弹出功能原样，我在[这个答案](https://stackoverflow.com/questions/97578/how-do-i-escape-a-string-inside-javascript-inside-an-onclick-handler/97804#97804)的帮助下找到了一个解决方案“[如何在 onClick 处理程序内的 javascript 中转义字符串？](https://stackoverflow.com/questions/97578/how-do-i-escape-a-string-inside-javascript-inside-an-onclick-handler) ”。

```
<?php
$blah = "<h1>Well</h1>"; $test = "<h2>Done</h2>";
echo '<script type="text/javascript" src="fetchlayers.js"></script>';
$formcode = '<form action="process.php" method="post" enctype="multipart/form-data ">
<label for="file">Filename:</label>
<input type="file" name="file" id="file"/> 
<br />
<input type="submit" name="submit" value="Submit" onclick="setTimeout(function() { sendInfo(\\x27'.$blah.'\\x27, \\x27'.$test.'\\x27); }, 1250);" />
</form>';

echo "<h1>hello</h1>
<div id='form'>
<a href='#' onclick='popup(\"" . addslashes(str_replace("\n", ' ', $formcode)) . "\"); return false;'>
click here</a>
</div>";
?> 
```

* * *

编辑前：

也许你可以做不同的事情。

Javascript函数：

```
function popup(id, params){
    var html = document.getElementById(id).innerHTML;

    if (params != undefined) {
        html = findAndReplaceStrings(html, params);
    }

    var child1 = window.open ("about:blank");
    child1.document.write(html);
    child1.document.close();
}

function findAndReplaceStrings(text, json) {
    for (var x in json) { 
        text = text.replace(x, json[x]);
    }
    return text;
} 
```

HTML隐藏代码：

```
<div style="display:none;" id="process">
<form action="process.php" method="post" enctype="multipart/form-data ">
<label for="file">Filename:</label>
<input type="file" name="file" id="file"/> 
<br />
<input id="submit" type="submit" name="submit" value="Submit" onclick="setTimeout(function() { sendInfo('{param1}', '{param2}'); } ), 1250);" />
</form>
</div> 
```

带有 json 的 HTML 链接：

```
<a href="#" onclick="popup('process', {'{param1}':'<h1>Well</h1>', '{param2}':'<h2>Done</h2>'}); return false;">
click here</a> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T21:18:39.623

一个更好的方法是打开一个已经包含表单代码的 HTML 或 PHP 页面，而不是`about:blank`动态地打开和传递它。

没有理由必须将 HTML 传递到 Javascript 函数中，以便可以直接将其写入文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T23:39:52.233

提交按钮有一个额外`)`的过早关闭 setTimeout 功能。具体地点在里面：

```
} ),1250 
```

您还应该考虑在 php 字符串中使用单引号以使其更易于阅读。而且因为您使用的是双引号，所以您不必断开字符串来插入变量 $blah 和 $test 的内容。

像这样的东西应该工作：

```
$formcode = "...
<input type='submit' name='submit' value='Submit' 
onclick='setTimeout(function() { sendInfo(\"$blah\", \"$test\"); },1250);' />
... 
```

";

编辑：

看起来它现在关闭 onclick 太早了。匹配这些作为开始和结束引号：

```
onclick=\"setTimeout(function() { sendInfo(\" 
```

我将 sendInfo 行更改为以下内容，运行它，看起来它正在工作。单引号在此处被转义，因此它不会过早关闭对 popup() 的调用。

```
sendInfo(\'".$blah."\', \'".$test."\'); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T21:14:13.347

您必须通过执行转义回车 (\n)

```
$formcode = str_replace("\n", "\\n", $formcode); 
```

您还必须转义引号

```
$formcode = str_replace("'", "\\'", $formcode); 
```

您可以将这两行合并为一行：

```
$formcode = str_replace(array("\n", "'"), array("\\n", "\\'"), $formcode); 
```

# c# - 搜索 .NET（和 ASP.NET）的标记系统

> ID：831758
> 
> 赞同：4
> 
> 时间：2009-05-06T21:07:21.787
> 
> 标签：c#, .net, asp.net

是否有一个很好的标签搜索系统可以在我的 C# .NET 原型中使用，它也可以在 ASP.NET 上运行？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-18T18:30:51.497

当您说“标签搜索系统”时，我假设您的意思是社交网络中允许您的用户标记内容的能力，从而通过标签云在您的网站中冒出最流行的内容。还允许您的用户通过标记的内容等方式进行导航？？

我喜欢创建一个 SystemObjects 表，它包含我系统中可能应用了标签（或评论或评级等）的各种表，从而允许我拥有一个可以跨越整个数据库的通用标签系统。然后我还会有一个 SystemObjectTags 表，该表将引用 SystemObjectID（告诉我哪个表有我感兴趣的记录）以及 SystemObjectRecordID（告诉我我感兴趣的特定记录）。从那里我有关于标签和标签内容的所有详细数据。然后，我想在 Tags 表中保留标签特定信息的运行列表，该表保留唯一标签（标签的字符串值）、TagID（SystemObjectTags 表引用）、整个系统中标签使用的计数（a所有用途的总和）等。

有了这个子系统，您就可以转向搜索功能。您拥有这三个表所需的所有数据，以便能够轻松地执行过滤、搜索等。但是，您可能会发现这里的数据太多，而且这些表非常通用，以至于您的搜索不如像更优化的表结构一样快。出于这个原因，我建议您使用 Lucene.NET 索引来保存所有可搜索的数据。Lucene.NET 提供了非常快的读取时间，并且在搜索算法方面提供了比 SQL Server 的自由文本内容更大的灵活性。

然后，这将允许您按标签过滤您的内容，按标签搜索内容，标签计数等。不过，Lucene.net 是一个可怕的话题！准备做一些阅读以了解基础知识。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T16:50:44.247

我们使用的一个选项是将我们的“标签”放在页面上的元关键字中，然后我们使用 Bing 进行搜索。

[http://msdn.microsoft.com/en-us/library/dd251056.aspx](http://msdn.microsoft.com/en-us/library/dd251056.aspx)

我们的建筑师说得最好。“让搜索引擎做他们最擅长的事情。搜索。”

您可以将搜索限制在您的站点，拉回结果并自己显示它们......在您自己的页面上使用您自己的格式。

唯一的缺点是，在您的网站上线并被索引之前，您无法完全测试您的搜索。

# java - 不运行在应用服务器中的单元测试应该如何设置数据源？

> ID：831760
> 
> 赞同：6
> 
> 时间：2009-05-06T21:07:33.003
> 
> 标签：java, jakarta-ee, jboss, containers, detect

感谢大家的帮助。你们中的许多人发布了（正如我应该预料到的）答案，表明我的整个方法是错误的，或者低级代码永远不必知道它是否在容器中运行。我倾向于同意。但是，我正在处理一个复杂的遗留应用程序，并且没有选择对当前问题进行重大重构。

让我退后一步，问这个问题，激发我最初的问题。

我有一个在 JBoss 下运行的遗留应用程序，并对较低级别的代码进行了一些修改。我为我的修改创建了一个单元测试。为了运行测试，我需要连接到数据库。

遗留代码以这种方式获取数据源：

（jndiName 是一个定义的字符串）

```
Context ctx = new InitialContext();
DataSource dataSource = (DataSource) ctx.lookup(jndiName); 
```

我的问题是，当我在单元测试下运行此代码时，上下文没有定义数据源。我对此的解决方案是尝试查看我是否在应用程序服务器下运行，如果没有，则创建测试数据源并返回它。如果我在应用服务器下运行，那么我使用上面的代码。

所以，我*真正的*问题是：这样做的正确方法是什么？单元测试是否可以设置上下文以返回适当的数据源，以便被测代码不需要知道它在哪里运行？

* * *

对于上下文：我的原始问题：

我有一些 Java 代码需要知道它是否在 JBoss 下运行。代码是否有一种规范的方式来判断它是否在容器中运行？

我的第一种方法是通过实验开发的，包括获取初始上下文并测试它是否可以查找某些值。

```
private boolean isRunningUnderJBoss(Context ctx) {
        boolean runningUnderJBoss = false;
        try {
            // The following invokes a naming exception when not running under
            // JBoss.
            ctx.getNameInNamespace();

            // The URL packages must contain the string "jboss".
            String urlPackages = (String) ctx.lookup("java.naming.factory.url.pkgs");
            if ((urlPackages != null) && (urlPackages.toUpperCase().contains("JBOSS"))) {
                runningUnderJBoss = true;
            }
        } catch (Exception e) {
            // If we get there, we are not under JBoss
            runningUnderJBoss = false;
        }
        return runningUnderJBoss;
    }

Context ctx = new InitialContext();
if (isRunningUnderJboss(ctx)
{
......... 
```

现在，这似乎可行，但感觉就像一个黑客。这样做的“正确”方法是什么？理想情况下，我想要一种可以与各种应用程序服务器一起工作的方法，而不仅仅是 JBoss。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T21:25:10.387

整个概念又回到了前面。较低级别的代码不应该进行这种测试。如果您需要不同的实现，请在相关点传递它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T21:56:48.970

依赖注入（无论是通过 Spring、配置文件还是程序参数）和工厂模式的某种组合通常效果最好。

作为一个例子，我将一个参数传递给我的 Ant 脚本，这些脚本根据耳朵或战争是否进入开发、测试或生产环境来设置配置文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T21:41:03.080

整个方法对我来说都是错误的。如果您的应用程序需要知道它在哪个容器中运行，那么您做错了。

当我使用 Spring 时，我可以在不更改任何内容的情况下从 Tomcat 移动到 WebLogic 并返回。我敢肯定，通过适当的配置，我也可以对 JBOSS 做同样的事情。这就是我要争取的目标。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T21:18:56.830

也许是这样的（丑陋但它可能有效）

```
 private void isRunningOn( String thatServerName ) { 

     String uniqueClassName = getSpecialClassNameFor( thatServerName );
     try { 
         Class.forName( uniqueClassName );
     } catch ( ClassNotFoudException cnfe ) { 
         return false;
     }
     return true;
 } 
```

getSpecialClassNameFor方法将返回一个对每个应用程序服务器都是唯一的类（并且在添加更多应用程序服务器时可能会返回新的类名*）*

然后你像这样使用它：

```
 if( isRunningOn("JBoss")) {
         createJBossStrategy....etcetc
  } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-06T21:21:58.383

有几种方法可以解决这个问题。一种是在单元测试时将 Context 对象传递给类。如果您无法更改方法签名，请将初始上下文的创建重构为受保护的方法，并通过覆盖该方法来测试返回模拟上下文对象的子类。这至少可以对类进行测试，以便您可以从那里重构为更好的替代方案。

下一个选项是使数据库连接成为一个工厂，可以判断它是否在容器中，并在每种情况下做适当的事情。

需要考虑的一件事是——一旦你从容器中获得了这个数据库连接，你将如何处理它？它更容易，但如果您必须携带整个数据访问层，它就不是一个单元测试。

为了进一步帮助在单元测试下移动遗留代码的方向，我建议您查看 Michael Feather 的[Working Effectively with Legacy Code](https://rads.stackoverflow.com/amzn/click/com/0131177052)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-06T22:44:10.900

> ```
> Context ctx = new InitialContext();
> DataSource dataSource = (DataSource) ctx.lookup(jndiName); 
> ```

谁构造了 InitialContext？它的构造必须在您尝试测试的代码之外，否则您将无法模拟上下文。

既然您说您正在处理遗留应用程序，请首先重构代码，以便您可以轻松地将上下文或数据源依赖注入到类中。然后，您可以更轻松地为该类编写测试。

您可以通过使用两个构造函数来转换遗留代码，如下面的代码所示，直到您重构了构造该类的代码。这样您可以更轻松地测试 Foo 并且可以保持使用 Foo 的代码不变。然后你可以慢慢重构代码，让旧的构造函数被完全移除，所有的依赖都被依赖注入。

```
public class Foo {
  private final DataSource dataSource;
  public Foo() { // production code calls this - no changes needed to callers
    Context ctx = new InitialContext();
    this.dataSource = (DataSource) ctx.lookup(jndiName);
  }
  public Foo(DataSource dataSource) { // test code calls this
    this.dataSource = dataSource;
  }
  // methods that use dataSource
} 
```

但是在你开始进行重构之前，你应该有一些集成测试来弥补你的后顾之忧。否则，您无法知道即使是简单的重构（例如将 DataSource 查找移动到构造函数）是否会破坏某些内容。然后当代码变得更好，更可测试时，您可以编写单元测试。（根据定义，如果测试涉及文件系统、网络或数据库，则它不是单元测试——它是集成测试。）

单元测试的好处是它们运行速度很快——每秒数百或数千次——并且非常专注于一次只测试一种行为。这使得它可以经常运行（如果您在更改一行后犹豫运行所有单元测试，它们运行得太慢），以便您获得快速反馈。而且因为他们非常专注，您只需查看失败测试的名称即可知道错误在生产代码中的确切位置。

集成测试的好处是它们确保所有部分都正确插入在一起。这也很重要，但你不能经常运行它们，因为像接触数据库这样的事情会使它们变得非常慢。但是你仍然应该每天至少在你的持续集成服务器上运行一次。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-05-06T21:19:25.503

一个干净的方法是在`web.xml`. 如果您愿意，这些可以设置全局标志。例如，您可以在您的和方法中定义一个[ServletContextListener](http://java.sun.com/products/servlet/2.3/javadoc/javax/servlet/ServletContextListener.html)，设置您在容器内运行的全局标志。如果未设置全局标志，则您没有在容器内运行。`web.xml``contextInitialized`

# javascript - 上传文件时如何显示加载图形？

> ID：831761
> 
> 赞同：2
> 
> 时间：2009-05-06T21:07:42.783
> 
> 标签：javascript, jquery, ajax, file-upload

该文件应通过 Ajax 或 Iframe 在后台上传。当上传完成时，我应该能够通过 javascript 进行检测，因此我可以隐藏加载图形并将用户重定向到新的 URL。使用 Jquery 很好。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T21:13:02.413

查看**[jQuery Uploadify](http://www.uploadify.com/demo/)**

**编辑：**还有一个类似的问题：[how-to-upload-file-jquery](https://stackoverflow.com/questions/166221/how-to-upload-file-jquery) - 您可以在单击上传按钮后显示图形并隐藏在成功/错误函数回调中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T21:15:22.297

jquery[表单插件](http://malsup.com/jquery/form/)能够进行 Ajax 上传（我相信使用 iframe）。它不会直接帮助您显示/隐藏加载图像，但它具有适当的事件，因此您知道上传开始和完成的时间。

# iphone - 为什么我的 UIScrollView 委托的 -scrollViewWillBeginDragging 方法会返回如此奇怪的 contentOffset 值？

> ID：831777
> 
> 赞同：1
> 
> 时间：2009-05-06T21:10:12.233
> 
> 标签：iphone, cocoa-touch, uikit, uiscrollview

问题解决了！我的代码中有愚蠢的错别字！

这是我的 UIScrollView 委托的方法：

```
- (void)scrollViewWillBeginDragging:(UIScrollView *)activeScrollView {
    NSLog(@"contentOffset: %f", activeScrollView.contentOffset);
} 
```

控制台中的输出如下：

```
2009-05-06 23:04:45.731 Demo[4851:20b] contentOffset: 21080643979530096233938944.000000 
```

当然我的 contentOffset 不是那么大；）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T21:14:42.940

因为 contentOffset 是一个 CGPoint。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T21:15:30.677

contentOffset 返回一个 CGPoint 结构，因此您希望使用`activeScrollView.contentOffset.y`而不是尝试将整个结构传递给 %f，它是双精度的格式说明符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-03T05:49:00.763

使用 NSLog(@"ContenfOffset : %@", NSStringFromCGPoint(activeScrollView.contentOffset));

# zend-framework - 我可以将数据库适配器设置为在 Zend_Db_Table_Abstract 类中永久使用吗？

> ID：831785
> 
> 赞同：3
> 
> 时间：2009-05-06T21:11:29.610
> 
> 标签：zend-framework, zend-db-table

我的站点使用了 2 个数据库，包括一个与其他站点特定数据库相关的中央用户数据库。

有时打电话就足够了`new User(array('db'=>'adapter1'));`（但从不方便）；但是，在其他时候，例如在不同数据库上声明表之间的关系时，没有办法做到这一点。

有谁知道在 Zend_Db_Table_Abstract 类中指定使用哪个数据库适配器的方法？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-09-23T07:24:58.983

很晚才回到这一点，但是这里的答案都没有对我有用。我的一些数据库模型需要使用“tdb”，并且将以下代码添加到每个类中以使其自动发生：

```
protected function _setupDatabaseAdapter()
{
    $this->_db = Zend_Registry::get('tdb');
    parent::_setupDatabaseAdapter();
} 
```

我感谢大家一路上的建议！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T03:17:37.857

Zend_Db_Table_Abstract 提供了一个静态方法来设置默认的数据库适配器。执行以下操作：

```
Zend_Db_Table_Abstract::setDefaultAdapter($adapter); 
```

现在，您的所有 Table 对象将默认使用您的适配器。

注意：在线文档有时并不明显，因此您检查的第二个最佳位置是此处的 API：http: [//framework.zend.com/apidoc/core/](http://framework.zend.com/apidoc/core/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T21:21:13.390

您可以在构造函数中将类变量 $_db 设置为正确的适配器。

```
global $adapter1; //There are better ways than using a global variable

$this->_db = $adapter1; 
```

假设可以在构造函数中引用适配器对象。这似乎不便携，但我相信它会工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-15T22:42:42.157

可以使用 init 函数，不使用它`Zend_Db_Adapter_Abstract,`可以在你的类中使用来设置需要做的任何事情。`_setAdapter`接受一个命名注册表项的字符串。

```
public function init()
{
    $this->_setAdapter('tdb');
} 
```

# linq - 用于 NHibernate 的 Linq 和预加载的 fetch 模式

> ID：831794
> 
> 赞同：45
> 
> 时间：2009-05-06T21:13:51.460
> 
> 标签：linq, nhibernate, fetch, eager

有没有办法使用 linq for nhibernate 将 fetchmode 设置为渴望多个对象。似乎有一种扩展方法，它只允许我设置一个对象。但是我需要为多个对象设置它。这可能吗？谢谢

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2010-08-06T11:22:07.893

新的 Linq 提供程序的做法略有不同：

```
var customers = session.Query<Customer>().Fetch(c => c.Orders).ToList(); 
```

更多信息：http: [//mikehadlow.blogspot.com/2010/08/nhibernate-linq-eager-fetching.html](http://mikehadlow.blogspot.com/2010/08/nhibernate-linq-eager-fetching.html)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-05-06T23:57:20.630

只需多次使用它。

```
IList<Entity> GetDataFromDatabase()
{
    var query = session.Linq<Entity>();
    query.Expand("Property1");
    query.Expand("Property2");
    return query.ToList();
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-09-20T20:23:24.967

据我所知，这并不等同：SetFetchMode 水合对象树，而 Expand 方法检索笛卡尔积。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-12-15T13:15:45.047

在继续`@Mike Hadlow`回答，获取下一个级别（孙子）你需要做：

`var customers = session.Query<Customer>() .FetchMany(c => c.Orders) .ThenFetchMany(o => o.OrderLines).ToList();`

# c# - Silverlight 中的点击编辑

> ID：831796
> 
> 赞同：5
> 
> 时间：2009-05-06T21:14:10.147
> 
> 标签：c#, wpf, silverlight, xaml

有没有办法在 Silverlight 中制作“点击编辑”控件？我有一些将显示在树视图控件中的项目，我希望标签可以直接在树视图中编辑。

有人知道怎么做吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-07T23:32:17.733

其实很容易。我已经用这种交换机制实现了许多表单。

您可以使用 Converter 执行此操作，并对绑定到 TreeView 的实体上存在的 IsEditable 属性执行简单的 BooleanToVisibility 转换。在您的 TreeView ItemTemplate 中，只需将 TextBlock 绑定为只要 IsEditable 属性为 true 时它就会折叠，并以当 IsEditable 属性为 false 时它会折叠的方式绑定 TextBox（反之亦然）。

如果您想构建自定义 ClickToEdit 控件，您需要执行以下操作：

1.  创建一个继承自 ContentControl 的类
2.  公开一个 DataTemplate 类型的新依赖属性：一个称为 EditableTemplate。
3.  在 OnApplyTemplate 中添加 MouseLeftButtonUp 事件处理程序以侦听单击。
4.  将活动内容模板更改为单击事件上的 EditableTemplate。
5.  当控件失去焦点时将模板改回来。

现在在 TreeView 中使用您的自定义控件：

1.  为您的 TreeView 覆盖您的 ItemTemplate
2.  将您的自定义 ClickToEdit 控件放在那里

实现自定义控件将允许您（或其他开发人员）轻松指定他们想要用作内容编辑器的控件。例如，他们可以指定 NumericUpDown 或 DateTimePicker，而不仅仅是使用 TextBox。

查看 Silverlight 3 中的 DataForm。它具有类似的功能，但可编辑与只读的切换不是通过单击完成的。

# objective-c - 持久化和重新排列核心数据记录的顺序

> ID：831801
> 
> 赞同：1
> 
> 时间：2009-05-06T21:14:23.580
> 
> 标签：objective-c, cocoa, macos, core-data

我遵循了核心数据教程

[http://macresearch.org/cocoa-scientists-part-xxiii-itunes-ifying-core-data-app](http://macresearch.org/cocoa-scientists-part-xxiii-itunes-ifying-core-data-app)

完成的应用程序在 NSTableView 中显示数据。数据的顺序是否也是持久的？有没有一种方法可以允许拖放重新排列到记录的顺序？我正在考虑类似于 iTunes 如何允许您通过拖放重新排列播放列表中的歌曲的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T21:25:11.307

Core Data 希望您使用 NSSortDescriptors 定义自己的排序，因此您必须添加自己的属性来跟踪用户可自定义的排序索引。在添加或删除新的关系对象时，我很幸运地在实体的关系键路径（从托管对象本身内部）上使用了 KVO，以便根据需要更改顺序。

要处理重新排列，您需要利用 NSTableView 的拖放方法并根据需要重置订单索引属性。NSTableView 文档应该很好地解释它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T21:20:55.687

您需要添加一个跟踪项目顺序的字段（可以是整数字段）。当您将对象放入表中时，您需要按该字段进行排序。

当您实现拖放时，您应该更新项目的顺序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-24T19:32:11.453

我不使用整数，而是使用创建的实际日期和时间（一种时间戳）。这将确保您的订单字段不重复。

然后，当我向上/向下移动一个项目时，我只是交换他们的订单字段。它的加工成本相对较低。

当我获取数据时，我只需按 am 字段的顺序选择项目。

# php - 如何使用 Joomla 分页显示此查询的结果？

> ID：831806
> 
> 赞同：0
> 
> 时间：2009-05-06T21:16:02.623
> 
> 标签：php, joomla, pagination

如何使用 Joomla 分页在前端显示此查询的结果？

```
<?php
  $database =& JFactory::getDBO();
  $sql = 'SELECT * FROM #__no_entreprise';
  $database->setQuery( $sql );
  $rows = $database->loadObjectList();
? 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T03:05:05.063

请参阅 Joomla 文档 -[在组件中使用 JPagination](http://docs.joomla.org/Using_JPagination_in_your_component)。简而言之，是这样的：

```
$pageNav = new JPagination( $database->loadResult(), $lim0, $lim );
echo $pageNav->getListFooter(); 
```

# eclipse - 如何在 Eclipse 中将任务标签限制为当前项目？

> ID：831807
> 
> 赞同：95
> 
> 时间：2009-05-06T21:16:05.417
> 
> 标签：eclipse

Eclipse 当前显示`// TODO`所有打开项目的任务标签 ( )。如果有人能指出偏好，我将不胜感激，我可以在其中限制显示的任务范围（例如，仅来自当前项目的任务）。

* * *

## 回答 #1

> 赞同：154
> 
> 时间：2010-07-30T17:19:17.173

在 Eclipse Helios (3.6) 中，您可以配置范围。

右上角的向下箭头 -> 配置内容：

[![配置内容 img](https://i.stack.imgur.com/29ZrS.png)](https://i.stack.imgur.com/29ZrS.png)

在左侧选择一个配置（或创建一个新配置），然后在“范围”部分的右侧选择“在同一项目中的任何元素上”。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-06T23:56:32.347

右上角应该有一个向下箭头，里面有几个选项。对于旧的 Eclipse，您需要的选项是 Filters... 而对于较新的 Eclipse，现在的选项是 Configure Contents。在配置内容对话框的顶部是一个范围选择，其中包含您想要的选项，我认为.. 如果没有检查首选项并搜索任务或范围。它应该在某个地方。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-06T21:23:18.440

关闭您不从事的项目。工作区的任何部分都会显示任务，因此请通过关闭操作删除您未处理的项目。（在项目资源管理器中右键单击项目，然后“关闭项目”）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-08T06:39:59.297

**配置内容...**可用于过滤工作集之类的内容（如果您尚未使用工作集，则应该使用），但另一种方法是使用**Mylyn**过滤掉与您的内容无关的任何 UI 元素目前正在工作。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2019-12-02T08:43:26.580

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-01-27T21:21:37.707

In Eclipse Juno 4.2.1, I found that it's possible to disable specific projects `TODO` tasks.

In the projects properties open: **Java Compiler > Task Tags**

From that page check the option "Enable project specific settings" and remove the `TODO` entry from the list below, after that the `TODO` comments from that project won't be shown in Tasks. You could also remove other tags from the list.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-02-06T21:10:47.210

只需关闭您不从事的项目即可。
您也可以将它们留在工作区中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-30T21:03:25.477

按工作集过滤工作正常，但我必须将包放入工作集中，而不是整个项目。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2009-05-06T21:18:39.590

AFAIK Eclipse 任务列表是基于工作区的，默认情况下不能真正被过滤。

# sql - SQL Server：在存储过程中检索自动递增的 ID？

> ID：831810
> 
> 赞同：6
> 
> 时间：2009-05-06T21:17:44.010
> 
> 标签：sql, sql-server, database, stored-procedures, auto-increment

我的数据库有一个带有自动递增主键标识“ID”的父表和一个普通的“TIMESTAMP 列”。我有一个外键引用父“ID”列的子表。

我想编写一个将新列插入父数据库和子数据库的存储过程。如何将子“ID”列设置为等于新的自动递增父“ID”列？这是否需要单独的：

```
SELECT TOP 1 * FROM PARENT_TABLE 
```

还是有其他方法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-06T21:19:03.520

您可以从 SCOPE_IDENTITY() 中检索它。例如：

```
declare @myid int
INSERT INTO table (field) VALUES ('value')
SELECT @myid = SCOPE_IDENTITY() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T21:19:59.633

选择范围身份（）；

# java - 在 JTree 中隐藏/过滤节点？

> ID：831813
> 
> 赞同：12
> 
> 时间：2009-05-06T21:18:23.447
> 
> 标签：java, swing, jtree

我有一个用 a 表示的数据对象`TreeModel`，我想在我的 -- 中只显示它的一部分，`JTree`为了争论，说叶子和他们的父母。如何隐藏/过滤不必要的节点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-07T19:10:33.197

我的最终实现：

*   有两个`TreeModel`，底层的和过滤的。
*   当底层发生变化时，从头开始`TreeModel`重建过滤器。`TreeModel`克隆每个应该可见的节点，并将其添加到过滤器中的第一个可见祖先`TreeModel`（如果不可见，则添加到根）。如果您好奇，请参阅下面的 codez。
*   这具有折叠用户打开的每条路径的不幸副作用。为了解决这个问题，我`TreeModelListener`在过滤后的`TreeModel`. 当模型发生变化时，我将展开的路径保存在`JTree`（使用`getExpandedDescendants()`）中，然后稍后重新展开（使用`SwingUtilities.invokeLater()`）。

    我必须在我正在使用`equals()`的`TreeNode`类中覆盖，以便新的克隆节点与旧的克隆节点相同。

* * *

```
 ...
  populateFilteredNode(unfilteredRoot, filteredRoot);
  ...

  void populateFilteredNode(TreeNode unfilteredNode, TreeNode filteredNode)
  {
    for (int i = 0; i < unfilteredNode.getChildCount(); i++)
    {
      TreeNode unfilteredChildNode = unfilteredNode.getChildAt(i);

      if (unfilteredChildNode.getType() == Type.INVISIBLE_FOLDER)
      {
        populateFilteredNode(unfilteredChildNode, filteredNode);
      }
      else
      {
        TreeNode filteredChildNode = unfilteredChildNode.clone();

        filteredNode.add(filteredChildNode);

        populateFilteredNode(unfilteredChildNode, filteredChildNode);
      }
    }
  } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-14T07:55:22.777

您应该知道[GlazedLists](http://www.publicobject.com/glazedlists/)。这是一个很棒的库，可以轻松进行复杂的表转换。它们也扩展到树木。可能需要对现有代码进行一些重构才能使其进入 GlazedLists 的工作方式。但请查看演示和网络广播，看看它有多强大。（在我看来，它是必不可少的 Swing 库之一，而且它是开源的。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T20:02:43.650

你试过[JXTree](http://swinglabs.org/)吗？（不幸的是，该网站现在已关闭，但您可以谷歌搜索镜像）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-12-14T10:07:37.090

看看这个实现：[http ://www.java2s.com/Code/Java/Swing-Components/InvisibleNodeTreeExample.htm](http://www.java2s.com/Code/Java/Swing-Components/InvisibleNodeTreeExample.htm)

它创建 DefaultMutableNode 的子类，添加“isVisible”属性，而不是实际从 TreeModel 中删除/添加节点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-10T18:32:42.200

如果您正在寻找商业解决方案，JideSoft 有一个可过滤的树模型。除此之外，SwingX 有一个过滤器 API，可用于 JXTable、JXTreeTable、JXTree 和 JXList。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T21:21:19.430

只要它仍然是您正在显示的树，那么`TreeModel`您现有的过滤器`TreeModel`应该足够简单。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T21:58:59.120

利用您用于构建 TreeNode 的代码并仅重建 TreeNode（包括您想要的元素）。使用过滤的根节点设置 TreeModel 上的根节点。

# vb.net - 在 VS 2005 中更改预构建命令的目标目录

> ID：831821
> 
> 赞同：1
> 
> 时间：2009-05-06T21:19:31.057
> 
> 标签：vb.net, visual-studio-2005, build-process

我正在使用 Visual Studio 2005 Professional 在 VB 中编程。

我有一个代码 munger perl 脚本，它生成一些我想要编译的 *.vb 文件。脚本和相关文件在我的项目目录中，当我从操作系统命令提示符运行脚本时，它会将文件写入同一目录中，这正是我想要的。

而不是这样做，我想调用 perl 脚本作为预构建事件。我已经让它工作了......几乎。现在唯一的问题是文件现在存放在 TargetDir (/bin/Release eg) 而不是 ProjectDir。我可以将 TargetDir 更改为 ProjectDir，但这似乎是我在自找麻烦。

有没有办法单独指定预构建命令的目标目录？或者将其更改为 ProjectDir，然后在我完成预构建后将其更改回来？或者也许我只需要编写一个将文件移回我想要的位置的命令？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T21:36:45.930

您可以简单地在命令前添加一个`cd`命令：

```
cd ProjectDir
do_my_stuff 
```

您的自定义构建步骤将由 Visual Studio 作为批处理文件写出并使用 cmd.exe 运行，因此`cd`命令可以正常工作。

# css - 为什么 CSS height:100% 在 IE6 中不起作用？

> ID：831828
> 
> 赞同：1
> 
> 时间：2009-05-06T21:21:00.257
> 
> 标签：css, internet-explorer-6

我有一个 IE6 绝对位置`div`，我想全屏（100% 宽度和高度）。在页面上加载数据时，它被用作“正在加载，请稍候”消息。

看来 ie6 无法识别`"height:100%"`.

有什么解决办法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T21:25:29.793

此外，在一些较旧的浏览器中，您还需要设置 html 标签的高度：

```
body, html {
    height: 100%;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T21:23:47.317

div 上的高度 100% 需要它的父级也具有在 IE6 中定义的高度。试试这个：

```
body{
  height:100%;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T21:35:46.273

此外，这可能有其自身的缺陷，您可以执行以下操作：

```
#fullScreenDiv {position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
} 
```

它可能会与嵌套组件及其浮动等一起使用，但它肯定会使用 doctype 使 div 全屏显示。

# project-management - 如何避免平台/框架决策瘫痪？

> ID：831833
> 
> 赞同：2
> 
> 时间：2009-05-06T21:22:07.070
> 
> 标签：project-management

所以，我有一个网站的想法。我可以开始使用我想要的任何平台和框架，但是几乎有太多的选择。

操作系统平台：Windows、*nix

Web 框架：Rails、ASP.NET、ASP.NET MVC、Django、Zend、Cake 等

主机：EC2、专用服务器、共享主机、VPS、App Engine、Azure 等

持久性：S3、MySql、PostreSql、Sql Server、SimpleDB、CouchDB 等

您如何避免决策瘫痪并开始工作？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T21:31:07.813

首先，您对框架语言的熟悉程度应该决定您选择哪个框架。不要在学习框架之上增加学习另一种语言的负担。

接下来，看看剩下的框架。他们有好的文档吗？社区呢。（一个好的社区可以在很大程度上弥补给定技术的任何缺点。）该框架是否解决了您需要解决的问题？

最后，潜入并尝试一些东西！选择对您最有意义的一个并开始编写代码。不要对你的决定做太多的纠结。如果很明显您做出了错误的选择，那么很早就应该很明显。从您迄今为止所取得的成就中学习，并考虑使用不同的技术重新开始。（在你做出这个决定之前不要花几个星期的时间！）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T21:27:05.560

我敢肯定你不会同样喜欢所有这些技术。选择一个你喜欢的框架并开始工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-06T22:04:04.257

这取决于您的应用程序将要做什么。您列出的少数技术是直接竞争对手（例如 Django 与 Rails），但有些技术是完全不同的做事方式（例如 MySQL 与 S3）。

开始之前要回答的问题：

近期内是否需要对应用进行水平分区？如果是这样，使用 EC2、Google App Engine 或 Azure 将是一个不错的选择。

您的应用程序是否符合 Google App Engine 的限制条件？如果是这样，与在裸机（无论是真实的还是虚拟的）上运行相比，它需要的麻烦要少得多。

您首选的 Web 框架是什么？如果你想要一个 MS 框架，你需要在支持它的主机上运行。

您的持久性和数据访问模式会是什么样子？这将决定是使用数据库还是更奇特的东西。

如果您在 EC2 上运行，其他 AWS 服务更具吸引力。同样，如果您使用 GAE，则只有一种持久性选项。如果你使用 Rails，不妨从 MySQL 入手。

在回答您如何减少选项数量的问题时，答案是要认识到许多选项是相关的，因此您没有第一次出现的那么多选择。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T23:26:30.487

听听框架的支持者如何评价其他框架的问题（谷歌：*X 框架 vs Y 框架*）。选择支持者最多的框架。如果它们同样响亮，请掷骰子做出决定。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-06T21:34:17.777

曾经给我的一些建议是，选择你的朋友（或同事）正在使用的东西。身边有可以分享想法和学习经验的人是非常宝贵的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-06T21:39:44.347

如果你想学习新的东西：我会跟着你的直觉开始。如果它很糟糕，那么切换到更熟悉的东西。

如果您没有太多时间：选择您所知道的，忘记其他选择。刚开始编码。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-06T21:43:41.903

优化幸福。选择你最喜欢的一个。或者最让你感兴趣的那个。

我曾在 Microsoft 商店、Ruby on Rails 以及拥有 Apache、Jetty 甚至 Mason 的本土商店工作过。

所有框架都有它们的缺点，它们的特性会让你一直熬到凌晨 3 点，它们的“部落知识”变幻莫测，完全无法导出到其他框架。（最后一点有时是设计使然，整个“平台设防”的商业策略）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-06T21:31:44.193

对我来说很简单。

我只知道 MS 堆栈，并且认为“检查”您提到的所有这些都没有意义。

不，实际上我曾经尝试使用 JSF，然后将其从我的列表中永久排除。

使用您的经验以及可以提高工作效率的地方。目标是让您的网站启动并运行。去吧。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-06T21:41:25.277

决定使用哪个平台/框架的最大因素之一是您的预算。您必须考虑许可成本、开发/维护网站所需的软件以及其他杂项成本。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-06T23:00:31.750

一次一个决定：

首先我会从语言类型开始：

脚本：PHP、Python，
严重：Java、.Net

该语言将限制您的操作系统、平台，并为您提供数据库决策的提示。数据库负载也很重要。而且，您想要 DDBB 中的逻辑吗？多少数据？

最后的建议。尝试经过充分测试的组合。LAMP、WAMP、带有 SQL Server 和 .NET 的 Windows。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-06T23:08:07.067

评估每个平台和技术的工具质量，以满足您的需求。例如，如果您对成本敏感，您会比昂贵的操作系统和工具更看重免费的操作系统和工具。如果您需要性能，您会重视提供高性能的工具，而不是那些不提供高性能的工具。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-06T23:49:27.483

这完全取决于你的情况。去年我花了几个月的时间为一个新的商业网站评估东西，很容易感到瘫痪。最后，它与几个做过类似事情的人交谈，当然还阅读了*很多*在线和亚马逊的东西。我选择了Java，因为我们的团队在这方面有丰富的经验，而且它有很好的性能和广泛的支持技术。Oracle 是我们的数据库，但我们使用了持久性管理器，以便以后轻松更改。我们使用了六个非常好的库来消除许多无聊和重复的编码（Restlet、iBatis、Freemarker、XStream、jQuery、SLF4J）。我们使用 Glassfish 作为我们的网络服务器。

你的听起来像是一个只有你才能完成的小项目。在这种情况下，选择一个完整的框架，而不是像我们那样选择一个大杂烩。选择一些有趣的工作，以及具有良好“简历回报”的东西。仔细研究一下 Ruby on Rails、Django（一种 Python on Rails）和 Groovy on Grails（Java 世界中的 Rails-wannabe）。在您的情况下，我会选择 Ruby on Rails，因为那里有一个庞大且不断发展的社区以及大量的书籍和教程。另外，Ruby 看起来是一门值得学习的语言。对于您的数据库，只需选择一个。这些框架使您以后很容易改变主意。除非你有另一个你更喜欢的，否则选择 MySQL。

正如其他海报所说，去做吧！;-)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-07T00:07:55.380

就像其他人说的那样，选择您和您的员工熟悉的东西。我高度怀疑您是否已接近为所有这些技术做好行业准备。

> 操作系统平台：Windows、*nix

除了 Windows 许可费用之外应该没关系，这可能是您花费中最少的。

> Web 框架：Rails、ASP.NET、ASP.NET MVC、Django、Zend、Cake 等

取决于你喜欢的语言

> 主机：EC2、专用服务器、共享主机、VPS、App Engine、Azure 等

您应该将您的产品设计为可移动的，这样您就可以在这些产品之间进行扩展。如果您确定自己会做大，那么就从 EC2 开始。App Engine 非常有限，例如。他们不允许您形成出站连接。

> 持久性：S3、MySql、PostreSql、Sql Server、SimpleDB、CouchDB 等

无论您的产品是否需要 RDBMS 或简单的键/值存储，您都需要自己进行研究，以及它们各自具有哪些功能。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-15T04:41:36.890

去吧！只要您做出合理的选择（Ruby + Rails、Python + Django、PHP + Cake/CodeIgniter），您的平台选择真的不是那么重要。任何这些都可以用来建立成功的网站。如果您的网站真的起飞，您将能够很好地扩展它。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-06T21:34:25.280

我建议您从自己构建的记分卡开始。也许你可以在网上找到不同的，但如果你这样做了，请修改它们以满足你的需要。堆栈中的每个级别都应该有一个记分卡（如您所述）。每个记分卡都应与其他记分卡共享某些方面来评分，但每个记分卡也会有其独特的方面。

构建完成后，根据您的需要对每个方面进行加权。

一旦你选择了重量，选择等级的尺度。

在这一点上向自己保证你不会弄乱重量或规模，然后开始收集堆栈中每个级别的选项数据。

您可能还想对收集期限设置时间限制。

根据记分卡的结果做出决定。

这种方法的美妙之处在于努力构建记分卡，而不是选项的循环论证。制作记分卡的工作与供应商无关，并且专注于期望的结果，而不是选项。因此，您可以避免瘫痪。

还有一件事，我最好的记分卡包括解决资源可用性和其他与人类相关的事情的部分。不要犯只看技术的错误。

祝你好运。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-05-06T21:37:29.437

去个人喜好。

# java - BlockingQueue - 阻塞的 drainTo() 方法

> ID：831834
> 
> 赞同：34
> 
> 时间：2009-05-06T21:22:24.013
> 
> 标签：java, concurrency

BlockingQueue 有一个叫做 drainTo() 的方法，但它没有被阻塞。我需要一个我想要阻止但也能够以单一方法检索排队对象的队列。

```
Object first = blockingQueue.take();

if ( blockingQueue.size() > 0 )
    blockingQueue.drainTo( list ); 
```

我想上面的代码会起作用，但我正在寻找一个优雅的解决方案。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-05-06T21:29:04.777

您是否指的是[JavaDoc](http://java.sun.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#drainTo(java.util.Collection))中的评论：

> 此外，如果在操作正在进行时修改了指定的集合，则此操作的行为是未定义的。

我相信这指的是`list`您示例中的集合：

```
blockingQueue.drainTo(list); 
```

这意味着您不能在`list`从. 但是，阻塞队列在内部是同步的，因此当被调用时，~~puts 和~~（见下面的注释）gets 会阻塞。如果它不这样做，那么它就不是真正的线程安全的。您可以查看源代码并验证阻塞队列本身是否是线程安全的。`blockingQueue``list``drainTo`~~`drainTo`~~

 ~~或者，你的意思是当你调用`drainTo`它时你希望它阻塞直到至少一个对象被添加到队列中？在这种情况下，除了：

```
list.add(blockingQueue.take());
blockingQueue.drainTo(list); 
```

阻塞直到添加了一个或多个项目，然后将整个队列排入集合`list`中。

注意：从 Java 7 开始，gets 和 puts 使用了单独的锁。现在允许在 drainTo （和许多其他 take 操作）期间进行 put 操作。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2015-06-23T11:29:10.590

如果您碰巧使用 Google Guava，有一个绝妙的[`Queues.drain()`](https://google.github.io/guava/releases/snapshot-jre/api/docs/com/google/common/collect/Queues.html#drain-java.util.concurrent.BlockingQueue-java.util.Collection-int-long-java.util.concurrent.TimeUnit-)方法。

> 排空队列`BlockingQueue.drainTo(Collection, int)`，但如果请求的`numElements`元素不可用，它将等待它们直到指定的超时。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-04-07T16:40:41.953

我发现这种模式很有用。

```
List<byte[]> blobs = new ArrayList<byte[]>();
if (queue.drainTo(blobs, batch) == 0) {
   blobs.add(queue.take());
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T21:31:25.113

有了可用的 API，我认为您不会变得更加优雅。除了你可以删除大小测试。

如果您想以原子方式检索连续的元素序列，即使另一个删除操作同时发生，我也不相信甚至可以`drainTo`保证这一点。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2012-04-16T18:13:30.183

源代码：

```
 596:     public int drainTo(Collection<? super E> c) {
              //arg. check
 603:         lock.lock();
 604:         try {
 608:             for (n = 0 ; n != count ; n++) {
 609:                 c.add(items[n]);
 613:             }
 614:             if (n > 0) {
 618:                 notFull.signalAll();
 619:             }
 620:             return n;
 621:         } finally {
 622:             lock.unlock();
 623:         }
 624:     } 
```

ArrayBlockingQueue 急于返回 0。顺便说一句，它可以在获取锁之前做到这一点。

# c# - 对象如何获得对位于不同（且未引用）程序集中的类的引用？

> ID：831835
> 
> 赞同：1
> 
> 时间：2009-05-06T21:22:34.887
> 
> 标签：c#, serialization, project-reference

我有两个项目：A/B。项目 A 是包含绑定到 B 中的对象（逻辑项）的所有 winform 的项目

A 有一个 A.Form 类型的对象

B 具有 B.Serializer B.Logic 类型的对象

现在，A 引用了 B（但 B 没有引用 A）并且 A.Form 包含 B.Logic 类型的成员变量。在某些时候，当所有数据都存储在 B.Logic 中时，我尝试通过调用 B.Serializer(B.Logic) 将此对象保存到磁盘。

此时我在序列化时出现错误，说 A.From 未标记为可序列化。

但是项目B根​​本没有引用A，即使它确实有一个成员引用A.Form，它甚至不应该编译。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T21:24:27.690

这里通常的罪魁祸首是事件（in `B.Logic`）或对外部对象的其他反向引用。您可以将字段标记为不用于序列化：

```
 [NonSerialized]
    private SomeType foo; 
```

或类似字段的事件：

```
 [field: NonSerialized]
    public event EventHandler Bar; 
```

顺便说一句 - 除了描述，我假设您正在使用`BinaryFormatter`; 就个人而言，我对此有所保留——它[非常脆弱](http://marcgravell.blogspot.com/2009/03/obfuscation-serialization-and.html)。我会建议一些非特定于实现的东西；`XmlSerializer`, [protobuf-net](http://code.google.com/p/protobuf-net/) , [Json.NET](http://www.codeplex.com/Json)等

# c# - 当查询返回匿名类型时，是否可以在 LINQ 中使用 Take？

> ID：831837
> 
> 赞同：3
> 
> 时间：2009-05-06T21:23:27.363
> 
> 标签：c#, linq, anonymous-types

我正在尝试从 LINQ 查询返回的匿名类型列表中获取第 n 个元素，其中 n 是从 0 到 100 的随机数。现在搞砸了一段时间，但我一无所获。我的代码（更改名称以保护 IP）：

```
var query = from Table1 t1 in theContext.Table1 
   join Table2 t2 in theContext.Table2
    on ... 
    where ... 
   select new 
   {
       partNum = t1.part_number, 
       partSource = t2.part_source
   }

int num = new Random().Next(0, 100); 

// here's where the code I've tried fails 
```

我可以以某种方式`Take<T>(100).ToList<T>()[num]`使用 partNum 和 partSource 获得一个匿名类型吗？我最终通过明确定义一个类型来解决这个问题，但似乎我在这里错过了一个更优雅的解决方案。我想要做的就是将 a 返回`Dictionary<string, string>`给调用者，所以我不想在这个方法之外定义一个类型。

**更新**： ElementAt 不适用于此。我尝试添加：

```
// get a random part from the parts list
int num = new Random().Next(0, query.Count() - 1 );
var nthElement = query.ElementAt(num); 
```

我有一个例外：`The query operator 'ElementAt' is not supported.`

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T21:30:49.047

您应该能够使用：

```
var item = query.Take(100).ToList()[num]; 
```

当然，这样做会更有效率：

```
var item = query.Skip(num).First(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T21:32:12.350

我相信你只想要[`ElementAt`](http://msdn.microsoft.com/en-us/library/bb299233.aspx)扩展方法：

```
var nthElement = query.ElementAt(num); 
```

无需搞乱`Take`查询等，当然不是`ToList`。

# javascript - Vista 上 IE8 中的 Javascript blur() 命令不起作用

> ID：831841
> 
> 赞同：3
> 
> 时间：2009-05-06T21:24:00.360
> 
> 标签：javascript, internet-explorer-8, focus, windows-vista

我有一个项目会弹出一个带有用户消息的窗口。它显示 10 秒，然后使用 javascript`self.blur()`命令发送到后台。我不想关闭它，因为它包含用户可能需要查看的信息。

这目前适用于 Windows XP 上的 IE7/IE8/FF2/FF3，但在 Vista 上它不适用于 IE8。我发现如果我在 Vista 上禁用 IE8 的“保护模式”，该`blur()`命令将正常工作并且窗口正确地将焦点返回到父窗口。

有谁知道为什么会发生这种情况以及可以做些什么来解决它？任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T01:00:01.883

你是怎么写到窗口的？窗口的初始来源是什么—— `about:blank`？这可能会有所作为。此外，如果您从 localhost 加载网页，请尝试从“真实”域运行它。

还有一个建议：尝试使用灯箱或其他形式的 DHTML“层”。使用当今可用的各种库很容易创建它们；这种策略不仅可以解决您遇到的问题，还可以改善体验。可能比您真正想要的更大的变化，但从长远来看会好得多。

# javascript - IE 操作中止 - 常规修复均无效

> ID：831844
> 
> 赞同：1
> 
> 时间：2009-05-06T21:24:57.937
> 
> 标签：javascript, jsp, internet-explorer

首先，我一直在研究这个“操作中止”错误/错误似乎已经有好几个星期了，所以如果你不熟悉的话，这里有几个相关的问题和好文章：

[为什么 ASP.NET 在 IE7 中会导致“操作中止”错误？](https://stackoverflow.com/questions/266585/operation-aborted-error-in-ie7)(so question)
[Detecting cause of IE's Operation Aborted Issue](https://stackoverflow.com/questions/778983/detecting-cause-of-ies-operation-aborted-issue) (so question)
[微软官方知识库](http://support.microsoft.com/kb/927917)
[IE 官方博客](http://blogs.msdn.com/ie/archive/2008/04/23/what-happened-to-operation-aborted.aspx)

**现在这是我的问题：**

首先，我尝试将所有 <script> 元素移动到 body 标签的末尾。没用。然后我将我所有的 js 函数重构为一个链接在 <head> 中的外部文件，我的所有 js 函数都是从 onclick 或 onkeypress 调用的。仍然收到错误。我的一个 .js 文件的最后一行是

```
document.onload = setTimeout("foo()",500); 
```

所以我把它移到 <body onload="setTimeout('foo()',500);">。我仍然收到此错误。我不知道该怎么办。我编辑 DOM 元素的唯一地方是 foo()。请帮忙！

**关于我的设置：**

Java、Hibernate、Struts、JSP ......我认为这就是所有相关的内容。

我在这里想念什么？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T21:48:28.037

这有几个原因。最常见的两个是：

1) 在文档完全加载之前尝试修改 DOM 的脚本

2)对象或数组声明中的[尾随逗号](http://www.pluralsight.com/community/blogs/fritz/archive/2007/06/19/47771.aspx)

第二个通常相对容易找到，而第一个则更难找到。通常，追踪 IE Javascript 问题的最佳方法是安装[Microsoft Script Debugger](http://www.microsoft.com/downloads/details.aspx?familyid=2f465be0-94fd-4569-b3c4-dffdf19ccd99&displaylang=en)，因此至少您可以看到导致问题的行。使用 Script Debugger，IE 将在浏览器中停止执行并将脚本踢到 Script Debugger 控制台，该控制台将显示问题行。比常规 IE 错误消息提供更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T00:38:06.180

请[在另一个线程中查看我对这个问题的回答](https://stackoverflow.com/questions/778983/detecting-cause-of-ies-operation-aborted-issue/779026#779026)。我喜欢这个小技巧，它从来没有让我失望过（当原因是在 IE 准备好之前进行 DOM 操作时，我的意思是）。正如所写，它不会影响兼容 DOM 的浏览器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T21:50:10.670

这个问题可能是一个大页面上的问题。除了您已经拥有的文章中的建议之外，我可以从这里唯一建议的是在开发环境中删除大量页面，直到问题消失。不断完善页面上的内容/不存在的内容，直到您知道是哪条内容导致了问题。

我实际上已经看到两个不相关的页面元素之间的汇合导致了这个问题。我不记得确切的原因，但上述方法虽然很辛苦，但仍然有效。

# sql - 选择正确的数据库：MySQL 与其他一切

> ID：831849
> 
> 赞同：20
> 
> 时间：2009-05-06T21:25:48.327
> 
> 标签：sql, mysql, oracle, postgresql, database

现在似乎每个人都只使用 MySQL，因为这正是每个人都使用的。我正在开发一个将处理大量传入数据的 Web 应用程序，我想知道我是否应该“只使用 MySQL”还是应该看看其他开源数据库甚至商业数据库？

编辑：应该提到，我正在寻找最佳性能，与在 debian 5 上运行的 ruby​​ + rails 集成，而且资金很紧，但如果从长远来看它会省钱，我会考虑投资更昂贵的东西。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-11T00:19:57.187

我以前发布过这个，但我没有理由改变这个建议：

MySQL 更容易开始使用。

更好的用户界面工具。更快，如果你不使用 ACID。对无效数据的容忍度更高。自动增量列就像键入自动增量一样简单。权限与文件系统和操作系统用户无关。在编写存储过程时，设置分隔符比使用 PG 的“美元符号引用”更容易。在 MySQL 中，您连接到所有数据库，而不是一次只连接一个。

Postgres (PG) 更符合标准，但它更丑陋、更复杂，尤其是从 UI 的角度来看。它过去需要手动清理，并且实际上强制执行引用完整性（这是一件很棒的事情，但可能会让人头疼）。自动增量更灵活，但需要序列（我可以通过使用序列来掩盖），等等，什么是 OID？

因此，如果您不太了解或不太关心数据库、数据有效性、ACID 合规性等，但您确实关心易用性和速度，那么您倾向于使用 MySQL。

太多（不是全部，而是很多）“web 程序员”对“web 2.0”或 PHP 或 Java 了解很多，但对数据库理论或实践知之甚少（“索引？那是什么？”）。他们倾向于将数据库视为一个花哨的哈希表或数据包，事实上，它不像哈希表那样可动态更改或容错。

对于这些人来说，MySQL——因为在 5.0 之前它还不是真正的 RDBMS，而且在许多方面仍然不是——是天赐之物。它比竞争对手“更快”，并且不会在 Web 程序员不想要、不理解或不看价值的“深奥”数据库上“浪费时间”。

另一方面，对于有数据库背景的人来说，MySQL 是一个雷区：应该工作的东西（复杂的视图、分组依据、分组依据中的排序依据）可能会起作用，或者如果你幸运地崩溃了服务器，或者如果你'很不幸，只是给出了错误数据的结果。

我花了好几天的时间来解决其中的一些问题，这些事情虽然不是特别复杂的视图和分组方式，但确实很复杂。

而且 MySQL 并不是真的更快。如果您将 InnoDb 表用于 ACID（或者仅仅因为超过 3000 万行，MyISAM 表往往会变得很糟糕），是的，直接单表选择可能比 PG 中更快。但是加入连接后，PG 突然变得更快了。（MySQL 在外连接方面尤其糟糕。）

总而言之：如果对您来说数据库是一个包，如果您从不打算进行数据挖掘或报告，如果您最感兴趣的是提供几乎没有关系或更新的大块文本 - 也就是说，如果您是使用数据库为博客提供动力，MySQL 是一个不错的选择。

但是如果你实际上是在管理数据，如果你理解数据比前端程序和中间层业务规则更长寿，对业务更有价值，如果你需要真实数据库的特性，那么使用 PG。

一个已经决定他的所有表结构都可以由 Hibernate（或其他一些 ORM）自动生成的“网络程序员”会说，“太复杂了”，“我打赌复杂意味着更多的成本和更慢的速度”，所以他与 MySQL 一起使用。

正如我所说，PG 要好得多，我讨厌处理 MySQL 的奇怪错误，而且我认为对于任何稍微复杂的查询，PG 的整体性能可能比 MySQL 更好。

但是 MySQL 使事情看起来（看似）简单，所以很多人并不真正了解数据库设计，认为 MySQL 是一个很好的选择。

使用 PG。它是一致的、可靠的、符合标准的，它在（甚至是中等程度的）复杂查询上速度更快，它不会因为奇怪的错误而完全打乱你的日程安排。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-05-06T21:37:39.983

我认为[PostgreSQL](http://www.postgresql.org/)是 MySQL 的一个非常可行的替代方案。它更像 Oracle。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-05-06T21:57:48.937

就个人而言，我尽量避免使用 MySQL，原因如下：

1.  **默认**存储引擎 MyISAM 缺少外[键](http://dev.mysql.com/doc/refman/5.1/en/myisam-storage-engine.html)支持。[Innodb](http://dev.mysql.com/doc/refman/5.1/en/innodb.html)支持，但是由于显而易见的原因，它不支持 MyISAM 表的外键。
2.  如果我尝试插入无效数据，MySQL 会很乐意为我更改它。
    1.  非法的 DateTime、Date 或 Timestamp 值被转换为“零”：[http ://dev.mysql.com/doc/refman/5.1/en/datetime.html](http://dev.mysql.com/doc/refman/5.1/en/datetime.html)
    2.  Varchar 和 Char 类型列：[http ://dev.mysql.com/doc/refman/5.1/en/char.html](http://dev.mysql.com/doc/refman/5.1/en/char.html)
    3.  取决于 SQL 严格模式的数值数据类型：http: [//dev.mysql.com/doc/refman/5.1/en/numeric-types.html](http://dev.mysql.com/doc/refman/5.1/en/numeric-types.html)

这些东西对某些人来说可能并不重要，但是当涉及到数据质量时，我宁愿使用其他东西。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-06T21:41:25.387

好吧，世界上的 RDBMS 之间可能存在差异。看看[http://en.wikipedia.org/wiki/Comparison_of_relational_database_management_systems#Fundamental_features](http://en.wikipedia.org/wiki/Comparison_of_relational_database_management_systems#Fundamental_features)

以此为指导，您应该能够大大缩小您的选择范围。

要记住几件事：

SQL Server 2005 Express 的文件大小限制为 4GB，但对 .NET 和 Java 语言具有出色的支持。

MySQL 将同时在 Windows 和 Linux 上运行，并且许多语言（包括 .NET 和 Java）都通过外部库支持它。

SQLite 受到每个操作系统的有效支持，并且可以作为应用程序的集成部分进行分发。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-06T22:06:02.550

[Firebird](http://www.firebirdsql.org/)是 Borland 的 Interbase 的开源和分支版本，非常好，它可以在大多数（所有？）Linux 风格上运行良好，并且性能非常好。我不是 RoR 的人，所以我不知道细节，但我在新西兰有一个朋友在他的所有 RoR 项目中使用 Firebird，它绝对适用于 RoR，并且效果很好。

**编辑：** [在此处](http://fireruby.rubyforge.org/)
找到指向 Firebird Rails 适配器的链接

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-10T23:34:39.693

请对可能有斧头的人提出的理想主义观点保持警惕。MySQL 是解决许多问题的强大、强大和可扩展的解决方案，但这通常不是开箱即用的，因为它的默认设置非常保守。与任何数据库产品一样，您需要花时间调整其安装以获得所需的性能。您还需要花一些时间来适应它的局限性，这对于您选择的任何数据库也是如此。

MySQL 的流行部分是自己产生的：很多托管服务提供商都提供它，所以很多人都在使用它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-06T21:37:45.333

Mysql很棒，mssql也很棒。我没用过别的。我会说，如果您完全处于观望状态，请使用您最强大的技术堆栈。我有大量的 c#、asp.net 和其他 Microsoft 堆栈经验，所以我专攻 mssql 是很自然的。如果您更熟悉 *nix、php 等，您可能更愿意坚持使用开源堆栈。你当然可以混合和匹配这两个堆栈，但坚持一个世界或另一个世界可以避免一些痛苦。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-08T08:47:33.343

像 duffymo 我也推荐 PostgreSQL。从开发人员的角度来看，这非常好：在许多平台（基于 unix 和 Windows）上工作，对我工作的任何语言/环境（Windows、Linux、Delphi、Java、Perl、Python）都有不同的稳定接口。存储过程语言：PLPGSQL 也简单而强大。用户支持（新闻组、列表、SO）很好而且很有帮助。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-06T21:40:51.957

“现在似乎每个人都只使用 MySQL，因为这正是每个人都使用的。” 如果 MySQL 是人们唯一使用的东西，那么为什么 Oracle 和 MSSQL 仍然存在呢？

关于选择哪个数据库引擎的争论可以一直讨论到奶牛们回家。我个人在选择数据库引擎时总是发现一个常数。您买得起的通常是您想要的。

如果您可以证明在数据库上花费 XXX 是合理的，那么您可能已经知道选择它的原因。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-08-02T12:38:24.190

MySQL 易于安装，无需特殊设置即可正常工作。通过适当的方法，MySQL 可以灵活地适应您的需求。但也有一些陷阱：在某些情况下，它可能会减慢您的项目，无论您对 DBMS 和数据结构进行了多么好的调整。

如果满足以下条件，MySQL 适合您：

*   您不想深入研究 DBMS 设置；
*   你从结构上思考；
*   与 MySQL 的集成是在任何编程语言、框架、CMS、CMF 等中；
*   您需要 DBMS 来管理小型结构数据（最多 1 或 2 GB）。

您提到，您处理大量传入数据。可能本[指南](https://softmedialab.com/blog/database-choice-for-large-data-volume/)会有所帮助

# database - 数据库表是否应该始终具有主键？

> ID：831850
> 
> 赞同：18
> 
> 时间：2009-05-06T21:25:49.340
> 
> 标签：database, primary-key, modeling

我的数据库表中是否应该始终有一个主键？

让我们采用 SO 标记。您可以在任何修订中看到标签，它可能位于带有 postID 和修订号的 tag_rev 表中。我需要为此进行PK吗？

另外，由于它在 rev 表中并且当前未使用标签应该是 tagID 的 blob，而不是多个 post_id tagid 对的多个条目？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-06T21:29:18.940

一个**表**应该有一个主键，以便您可以用它唯一地标识每一行。

从技术上讲，您**可以**拥有没有主键的表，但您将违反良好的数据库设计规则。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-06T21:32:29.993

您应该努力在您可能希望通过该键访问（或更新或删除）单个记录的任何重要表中拥有一个主键。主键可以由多列组成，正式地说，将是最短的可用超键；即，最短的可用列组，它们一起唯一标识任何行。

我不知道 Stack Overflow 数据库架构是什么样的（从我在 Jeff 的博客上读到的一些内容来看，我不想知道），但在你描述的情况下，完全有可能存在一个主要的跨帖子标识符、修订号和标签值的键；当然，这将是可用的最短（也是唯一）超级密钥。

关于您的第二点，虽然支持在存档表中聚合值可能是合理的，但它确实违反了表中每个行/列交集应该包含一个值的原则。虽然它可能会稍微简化开发，但没有理由不能使用带有版本化元数据的规范化表，即使对于像标签这样微不足道的东西也是如此。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-06T21:29:21.827

请参阅有关是否需要*整数*主键的相关问题。其中一个答案以标记为例：

[是否有充分的理由让数据库表没有整数主键](https://stackoverflow.com/questions/671773/are-there-any-good-reasons-to-have-a-database-table-without-an-integer-primary-ke)

有关标记和键的更多讨论，请参阅此问题：

[标签系统中标签的 ID](https://stackoverflow.com/questions/549292/id-for-tags-in-tag-systems)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-06T23:13:39.783

我倾向于同意大多数表应该有一个主键。我只能想到两次这样做没有意义。

1.  如果您有一个将键与其他键相关联的表。例如，要将 user_id 与 answer_id 关联起来，该表不需要主键。
2.  一个日志表，其唯一真正目的是创建审计跟踪。

基本上，如果您正在编写一个可能需要在外键关系中引用的表，那么主键很重要，如果您不能肯定它不会是，那么只需添加 PK。:)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-04-15T21:08:40.200

从 MySQL 5.5 参考手册第[13.1.17](https://dev.mysql.com/doc/refman/5.5/en/create-table.html)节：

> 如果您没有 PRIMARY KEY 并且应用程序要求您的表中的 PRIMARY KEY，则 MySQL 返回第一个没有 NULL 列的唯一索引作为 PRIMARY KEY。

所以，从技术上讲，答案是否定的。但是，正如其他人所说，在大多数情况下它非常有用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-06T21:55:02.640

我坚信每张表都应该有一种方法来唯一地标识一条记录。对于 99% 的表，这是主键。其余的你可能会得到一个唯一的索引（我在想一列在这里查找类型表）。每当我不得不使用无法唯一标识记录的表时，就会遇到麻烦。

我还相信，如果您使用代理键作为您的 PK，那么您应该尽可能在构成自然键的任何字段组合上拥有一个单独的唯一索引。我意识到有太多时候你没有真正的自然键（名称不是唯一的，或者使某些独特的东西可能分布在几个父子表中），但如果你有一个，请确保它具有唯一索引或创建为 PK。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T21:36:06.693

如果没有PK，你将如何更新或删除单行？这是不可能的！老实说，我使用过几次没有 PK 的表，例如存储活动日志，但即使在这种情况下，也建议使用一个，因为时间戳不够精细。临时表是另一个例子。但是根据关系理论，PK是强制性的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-06T21:42:25.057

有钥匙和关系很好。有很大帮助。但是，如果您的应用程序足以处理关系，那么您可能会跳过键（尽管我建议您拥有它们）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-06T21:45:46.623

由于我使用 Subsonic，我总是为我的所有表创建一个主键。许多数据库抽象库需要一个主键才能工作。

注意：这并不能回答您问题的“大统一理论”基调，但我只是说在实践中，有时您必须为每个表创建一个主键。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-06T23:15:43.350

如果它是一个连接表，那么我不会说你需要一个主键。例如，假设您有表 PERSONS、SICKPEOPLE 和 ILLNESSES。ILLNESSES 表有流感、感冒等，每个都有一个主键。PERSONS 有关于人的常用资料，每个资料也有一个主键。SICKPEOPLE 表中只有生病的人，它有两列，PERSONID 和 ILLNESSID，外键返回各自的表，没有主键。PERSONS 和 ILLNESSES 表包含实体，实体获取主键。SICKPEOPLE 表中的条目不是实体，也没有主键。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-05-06T21:30:57.830

数据库本身没有键，但它们的组成表可能。我想你的意思是，但以防万一......

无论如何，具有大量行的表绝对应该有主键；只有几行的表不一定需要它们，尽管它们不会受到伤害。这取决于表的用途和大小。纯粹主义者会将主键放在每个表中。这没有错；在小桌子上也没有省略 PK。

**编辑添加**了一个指向我关于这个问题的博客条目的链接，其中我讨论了一个数据库管理人员认为没有必要在特定表中包含主键的情况。我认为这充分说明了我的观点。

[Cyber​​herbalist 关于主键的博客文章](http://cyberherbalist.wordpress.com/2012/06/25/should-a-database-table-always-have-primary-keys/)

# windows-services - Windows 中服务的默认当前工作目录是什么？

> ID：831859
> 
> 赞同：1
> 
> 时间：2009-05-06T21:27:57.527
> 
> 标签：windows-services, directory

我正在调整一个程序以作为服务运行，它做的第一件事是打开一个本地配置文件，但它不存在，因为我不知道当前目录是什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T21:30:54.867

当前工作目录是服务的可执行文件的位置，除非使用 win32 API 调用修改`SetCurrentDirectory`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T22:20:49.550

`GetCurrentDirectory`在服务入口点调用返回“C:\WINDOWS\system32”。将其设置为可执行文件的目录后，`SetCurrentDirectory`一切都按预期工作。

# c# - 从 UIElement 生成 BitmapSource

> ID：831860
> 
> 赞同：3
> 
> 时间：2009-05-06T21:28:45.573
> 
> 标签：c#, wpf, bitmap, drawing, uielement

我正在尝试生成一个`BitmapFrame`基于`UIElement`. 这是我的功能：

```
private BitmapFrame RenderToBitmap2()
{
    RenderTargetBitmap renderBitmap = new RenderTargetBitmap(200, 200, 96, 96, PixelFormats.Pbgra32);

    DrawingVisual drawingVisual = new DrawingVisual();
    DrawingContext drawingContext = drawingVisual.RenderOpen();
    VisualBrush aVisualBrush = new VisualBrush(GenerateTestStackPanel());
    drawingContext.DrawRectangle(aVisualBrush, new Pen(Brushes.Green, 2), new Rect(new Size(150, 150)));

    drawingContext.Close();

    renderBitmap.Render(drawingVisual);

    return BitmapFrame.Create(renderBitmap);
} 
```

出于测试和调试目的，我使用了一个额外的函数来创建一个简单的 StackFrame，它*应该*创建一个可以表示的有效视觉元素：

```
private StackPanel GenerateTestStackPanel()
{
    // Create a red Ellipse.
    Ellipse myEllipse = new Ellipse();

    myEllipse.Fill = Brushes.Green;
    myEllipse.StrokeThickness = 2;
    myEllipse.Stroke = Brushes.Black;

    // Set the width and height of the Ellipse.
    myEllipse.Width = 200;
    myEllipse.Height = 200;
    // Add the Ellipse to the StackPanel.
    StackPanel myStackPanel = new StackPanel();
    myStackPanel.Children.Add(myEllipse);
    return myStackPanel;
} 
```

出于某种原因，VisualBrush 没有在 DrawRetangle(...) 函数中呈现。我可以看到绿色边框，但没有别的。此外，如果我用标准画笔换掉 VisualBrush，效果很好：

```
drawingContext.DrawRectangle(Brushes.Plum, new Pen(Brushes.Green, 2), new Rect(new Size(150, 150))); 
```

提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-18T23:27:56.760

看一下这个`BitmapSource`从 a创建 a 的另一种方法`UIElement`：

[MSDN 线程](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/fb84fbcb-fe36-45a7-bc1a-0dd0d0bb9fdb/)

我也一直试图让 VisualBrush 工作，但没有任何运气，这让我来到了这个线程。

```
public static BitmapSource CreateBitmapSourceFromVisual(
    Double width,
    Double height,
    Visual visualToRender,
    Boolean undoTransformation)
    {
        if (visualToRender == null)
        {
            return null;
        }
        RenderTargetBitmap bmp = new RenderTargetBitmap((Int32)Math.Ceiling(width),
            (Int32)Math.Ceiling(height), 96, 96, PixelFormats.Pbgra32);

        if (undoTransformation)
        {
            DrawingVisual dv = new DrawingVisual();
            using (DrawingContext dc = dv.RenderOpen())
            {
                VisualBrush vb = new VisualBrush(visualToRender);
                dc.DrawRectangle(vb, null, new Rect(new Point(), new Size(width, height)));
            }
            bmp.Render(dv);
        }
        else
        {
            bmp.Render(visualToRender);
        }
      return bmp;
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-11-25T13:59:55.873

我之前遇到过同样的问题，我想将 a 的内容复制`UIElement`到图像中，我在上面的答案中使用了相同的方法，它似乎工作正常，我唯一的问题是，我希望它能够实时工作，所以我不得不深入挖掘，我找到了一些关于使用 windows API 将元素的内容复制到位图的参考资料，然后必须将此位图转换为 a`BitmapSource`以便它可以在 WPF 中使用

到目前为止它工作正常，但它似乎泄漏内存（不确定这一点）。我将尝试重新使用`UIElement`hwnd 句柄和位图对象以获得更好的性能和内存泄漏（如果存在）

```
[DllImport("gdi32.dll")]
private static extern bool BitBlt(
  IntPtr hdcDest, // handle to destination DC
  int nXDest, // x-coord of destination upper-left corner
  int nYDest, // y-coord of destination upper-left corner
  int nWidth, // width of destination rectangle
  int nHeight, // height of destination rectangle
  IntPtr hdcSrc, // handle to source DC
  int nXSrc, // x-coordinate of source upper-left corner
  int nYSrc, // y-coordinate of source upper-left corner
  System.Int32 dwRop // raster operation code
);

[DllImport("User32.dll")]
public extern static System.IntPtr GetDC(System.IntPtr hWnd);

[DllImport("User32.dll")]
public extern static int ReleaseDC(System.IntPtr hWnd, System.IntPtr hDC); //modified to include hWnd

//[DllImport("gdi32.dll")]
//[return: MarshalAs(UnmanagedType.Bool)]
//internal static extern bool DeleteObject(IntPtr hObject);

private static Bitmap GetBitmapFromControl(Window element, int width, int height)
{
    HwndSource hWnd = (HwndSource)HwndSource.FromVisual(element);
    System.IntPtr srcDC = GetDC(hWnd.Handle);

    Bitmap bm = new Bitmap(width, height);
    Graphics g = Graphics.FromImage(bm);
    System.IntPtr bmDC = g.GetHdc();
    BitBlt(bmDC, 0, 0, bm.Width, bm.Height, srcDC, 0, 0, 0x00CC0020 /*SRCCOPY*/);
    ReleaseDC(hWnd.Handle, srcDC);
    g.ReleaseHdc(bmDC);
    g.Dispose();

    return bm;
}

public static BitmapSource ToWpfBitmap(this Bitmap bitmap)
{
    using (MemoryStream stream = new MemoryStream())
    {
        bitmap.Save(stream, ImageFormat.Bmp);

        stream.Position = 0;
        BitmapImage result = new BitmapImage();
        result.BeginInit();
        // According to MSDN, "The default OnDemand cache option retains access to the stream until the image is needed."
        // Force the bitmap to load right now so we can dispose the stream.
        result.CacheOption = BitmapCacheOption.OnLoad;
        result.StreamSource = stream;
        result.EndInit();
        result.Freeze();

        //DeleteObject(bitmap.GetHbitmap());
        bitmap.Dispose();

        return result;
    }
} 
```

# ruby-on-rails - 发现日程安排与 Ruby & Runt 重叠？

> ID：831864
> 
> 赞同：0
> 
> 时间：2009-05-06T21:29:37.070
> 
> 标签：ruby-on-rails, ruby

我正在使用 Ruby on Rails 构建一个简单的应用程序来跟踪商店的营业时间和关闭时间及其预约，但我在验证预约与商店日程中的关闭时遇到了一些麻烦。

我一直在使用[Runt](http://runt.rubyforge.org/)来编写时间表。例如，如果商店在周一早上 9 点到 12 点营业，午餐时间关闭一个小时，然后在下午营业到下午 5 点，它看起来像：

```
require 'runt'
include Runt

monday = DIWeek.new(Mon)
morning = REDay.new(9,00,12,00)
afternoon = REDAy.new(13,00,17,00)

expr = monday & morning & afternoon 
```

对于给定的约会（也是 Runt Temporal Expression），我如何确保约会与开放时间重叠并且**不****重叠**午餐时间（或开放时间之前或之后的其他时间）？

 **我收集到 Runt 有重叠？方法，但如果我这样做：

```
expr.overlaps?(DIWeek.new(Mon) & REDay.new(10,00,11,00)) # the appointment is from 10-11am on Monday and should overlap the morning opening time 
```

我收到此错误：

```
NoMethodError: undefined method `overlaps?' for #<Runt::Intersect:0x10483cc> 
```

谁能告诉我如何纠正此错误或解决此问题的另一种方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T06:19:22.380

重叠？方法仅在 Runt::Collection 和 Runt::DateRange 上定义。也许您可以从 expr 创建一个 DateRange 对象，然后运行重叠？在上面。

# java - 您推荐什么 Java XML 库（替换 dom4j）？

> ID：831865
> 
> 赞同：76
> 
> 时间：2009-05-06T21:29:54.667
> 
> 标签：java, xml, dom4j

我正在寻找类似 dom4j 的东西，但没有 dom4j 的缺陷，例如文档错误或缺失以及看似停滞的开发状态。

背景：我一直在使用[和](https://stackoverflow.com/questions/807418/simplest-way-to-query-xml-in-java/831595#831595) [提倡](https://stackoverflow.com/questions/729621/convert-string-xml-fragment-to-document-node-in-java/729979#729979)dom4j，但我觉得它并不完全正确，因为我知道该库远非最佳（例如：查看 XSLT 相关[样式表](http://www.dom4j.org/dom4j-1.6.1/apidocs/org/dom4j/rule/Stylesheet.html)类中的方法是如何记录的；你会传递什么来运行（ ) 作为`String mode`参数？)

要求：该库应该比[使用](https://stackoverflow.com/questions/729621/convert-string-xml-fragment-to-document-node-in-java/729668#729668) [纯 JDK](https://stackoverflow.com/questions/807418/simplest-way-to-query-xml-in-java/807508#807508)（[`javax.xml`](http://java.sun.com/javase/6/docs/api/index.html?javax/xml/package-summary.html)和[`org.w3c.dom`](http://java.sun.com/javase/6/docs/api/index.html?org/w3c/dom/package-summary.html)包）时更容易处理基本的 XML。像这样的事情：

*   将 XML 文档（从文件或字符串）读入对象，轻松遍历和操作 DOM，执行 XPath 查询并针对它运行 XSLT。
*   在您的 Java 代码中构建 XML 文档，添加元素和属性以及数据，最后将文档写入文件或字符串。

实际上，我真的很喜欢[dom4j 的承诺](http://www.dom4j.org/)：“*易于使用，开源库，用于处理 XML、XPath 和 XSLT [...]，完全支持 DOM、SAX 和 JAXP。* ”而即将推出的 dom4j 2.0 确实声称可以解决所有问题: 充分利用 Java 5 并添加缺失的文档。但不幸的是，如果你[仔细观察](http://www.dom4j.org/download.html)：

> 警告：dom4j 2.0 处于 pre-alpha 阶段。它可能无法编译。如果它可以随机编译，它很可能无法运行。如果它偶尔运行，它可能会突然爆炸。如果要使用 dom4j，则需要 1.6.1 版本。真的。

...而且该网站已经说了*很长时间*了。那么 dom4j 有什么好的替代品吗？请为您的首选库提供一些理由，而不仅仅是转储名称和链接。:-)

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-05-07T07:01:39.597

当然，[XOM](http://www.xom.nu) :-)

> XOM 旨在易于学习和使用。它的工作非常简单，并且学习曲线非常浅。假设您已经熟悉 XML，您应该能够很快地开始使用 XOM。

我使用 XOM 已经好几年了，我仍然非常喜欢它。易于使用，网络上有大量文档和文章，API 在版本之间不会改变。最近发布了1.2。

> XOM 是唯一不影响正确性的 XML API。XOM 只接受名称空间格式良好的 XML 文档，并且只允许您创建名称空间格式正确的 XML 文档。（事实上​​，它比这更严格一些：它实际上保证所有文档都是可往返的并且具有明确定义的 XML 信息集。）XOM 管理您的 XML，因此您不必这样做。使用 XOM，您可以专注于您的应用程序的独特价值，并相信 XOM 能够获得正确的 XML。

查看网页[http://www.xom.nu/](http://www.xom.nu/)以获取常见问题解答、食谱、设计原理等。如果一切都是用如此多的爱设计的 :-)

作者还写了关于[XML API 出了什么问题（以及如何修复它们）](http://www.xom.nu/whatswrong/whatswrong.html)的文章。（基本上，XOM首先存在的原因）

这里也是 Artima 对作者关于 XOM 的采访，由 5 部分组成，他们讨论[了 XML API 的问题](http://www.artima.com/intv/xmlapis.html)、[好的、坏的和 DOM](http://www.artima.com/intv/dom.html)，[JDOM 的设计回顾，](http://www.artima.com/intv/jdom.html)从 JDOM 中学到的[教训](http://www.artima.com/intv/learn.html)，最后是[设计原则和 XOM](http://www.artima.com/intv/xomdesign.html)。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-05-07T12:11:31.130

[内置于 JDK 中的](https://docs.oracle.com/javase/8/docs/api/org/w3c/dom/package-summary.html)一个……还有一些附加功能。

是的，使用起来很痛苦：它是按照委员会明确设计的 W3C 规范建模的。但是，它可以在任何地方使用，如果您选择它，就不会遇到来自第三方库的“我喜欢 Dom4J”、“我喜欢 JDOM”、“我喜欢 StringBuffer”等参数。特别是因为这些参数可以使用不同的库变成不同的代码片段......

但是，正如我所说，我确实做了些许改进：**[Practical XML](http://sourceforge.net/projects/practicalxml/)库是实用类的集合，可以更轻松地使用 DOM**。除了 XPath 包装器之外，这里没有什么复杂的东西，只是我发现自己为每项工作都重写了一堆例程。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-12-07T15:55:23.007

我一直在使用[XMLTool](https://github.com/mycila/xmltool "XML工具")来替换 Dom4j，它运行良好。

XML Tool 使用 Fluent Interface 模式来促进 XML 操作：

```
XMLTag tag = XMLDoc.newDocument(false)
   .addDefaultNamespace("http://www.w3.org/2002/06/xhtml2/")
   .addNamespace("wicket", "http://wicket.sourceforge.net/wicket-1.0")
   .addRoot("html")
   .addTag("wicket:border")
   .gotoRoot().addTag("head")
   .addNamespace("other", "http://other-ns.com")
   .gotoRoot().addTag("other:foo");
System.out.println(tag.toString()); 
```

它是为 Java 5 设计的，很容易在选定的元素上创建一个可迭代的对象：

```
for (XMLTag xmlTag : tag.getChilds()) {
   System.out.println(xmlTag.getCurrentTagName());
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-05-06T21:31:36.643

我一直很喜欢[jdom](http://www.jdom.org/)。它被写成比 DOM 解析更直观（而且 SAX 解析总是看起来很笨拙）。

从使命宣言：

> 没有令人信服的理由让 Java API 将 XML 操作为复杂、棘手、不直观或令人头疼的问题。JDOMTM 既以 Java 为中心，又针对 Java 进行了优化。它的行为类似于 Java，它使用 Java 集合，它是当前 Java 开发人员完全自然的 API，它为使用 XML 提供了一个低成本的入口点。

这几乎就是我的经验——节点树的相当直观的导航。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-06T21:56:24.773

我使用[XStream](http://x-stream.github.io/tutorial.html)，它是一个简单的库，可以将对象序列化为 XML 并再次返回。

它可以是[注解驱动的](http://x-stream.github.io/annotations-tutorial.html)（如 JAXB），但它的 api 非常简单易用，您甚至可以生成 JSON。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-06-11T10:32:13.003

在最近的一个项目中，我不得不做一些 XML 解析，最后使用了同事推荐的**[Simple Framework 。](http://simple.sourceforge.net/)**

最后我很满意。它使用基于注释的方法将 XML 元素和属性映射到 Java 类和字段。

```
<example>
  <a>
    <b>
      <x>foo</x>
    </b>
    <b>
      <y>bar</y>
    </b>
  </a>
</example> 
```

对应的Java代码：

```
@Root
public class Example {

   @Path("a/b[1]")
   @Element
   private String x;

   @Path("a/b[2]")
   @Element
   private String y;
} 
```

这与 dom4j 或 XOM 完全不同。您避免编写愚蠢的、样板化的 XML 处理代码，但一开始您可能会为了获得正确的注释而苦苦挣扎一段时间。

（是我在 4 年前提出了这个问题。虽然[XOM](https://stackoverflow.com/a/833241/56285)似乎是一个不错且非常受欢迎的 dom4j 替代品，但我还没有完全接受它。好奇这里没有人提到简单框架。我决定解决这个问题，因为我可能会再次使用它。）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-04-02T13:44:59.737

我将通过说为什么不是 JAXB 来添加@kdgregory 的内置答案？

使用一些注释可以很容易地对大多数 XML 文档进行建模。我的意思是你可能会解析这些东西并放入一个对象，对吗？

JAXB 2.0 内置于 JDK 1.6 中，与许多其他内置 javax 库不同，这个库非常好（Kohusuke 致力于它，所以你知道它很好）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-06T21:42:21.313

在我们的项目中，我们使用[http://www.castor.org/](http://www.castor.org/)，但仅用于小型 XML 文件。它真的很容易学习，只需要一个映射 XML 文件（或者如果 XML 标记与类属性完全匹配，则不需要）就可以了。它支持侦听器（如回调）来执行额外的处理。缺点：它不是像 JAXB 这样的 Java EE 标准。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-02-24T11:47:09.347

我有时会使用[Jericho](http://jericho.htmlparser.net/docs/index.html)，它主要是 HTML 解析器，但可以解析任何类似 XML 的结构。

当然，它只适用于最简单的 XML 操作，例如查找具有给定名称的标签、遍历结构、替换标签及其属性，但这不是最常见的用例吗？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-01-22T00:43:13.583

你可以试试 JAXB，它的注解非常方便和简单：[Java Architecture for XML Binding。](http://www.oracle.com/technetwork/articles/javase/index-140168.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-07-12T06:14:03.467

对于构建 XML 文档，我建议[使用 xmlenc](http://xmlenc.sourceforge.net/)。它用于[cassandra](http://cassandra.apache.org/)。

# xml - 使用财务信息搜索 WSDL 或更新的 xml

> ID：831873
> 
> 赞同：0
> 
> 时间：2009-05-06T21:31:28.187
> 
> 标签：xml, service, wsdl, finance

我必须创建一个包含财务信息的折线图，就像本网站[http://finance.yahoo.com/中的一样](http://finance.yahoo.com/)

但我需要所有国家/地区的信息 有没有可以将这些信息更新为 Web 服务或 xml 的地方？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T21:38:58.810

您指的是各个证券交易所的市场指数数据吗？（道指、TSE、纳斯达克等？）

无论如何，这可能是您搜索的良好开端。 [可编程网络](http://www.programmableweb.com/apis)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-18T23:15:56.483

[查看http://www.mergent.com/servius](http://www.mergent.com/servius)上的 Mergent 历史证券数据 API

# django - 使用 django，如何在模型中创建方法以返回查询数据

> ID：831875
> 
> 赞同：2
> 
> 时间：2009-05-06T21:31:33.600
> 
> 标签：django, orm

在下面的代码中，我想创建方法 show_pro 来显示所有适用于案例的参数。

我收到此错误：

```
>>> Case.objects.all()[0].show_pro()
Traceback (most recent call last):
  File "<console>", line 1, in <module>
  File "/home/john/mysite/../mysite/cases/models.py", line 23, in show_pro
    return self.objects.filter(argument__side__contains='p')
  File "/usr/lib/python2.5/site-packages/django/db/models/manager.py", line 151, in __get__
    raise AttributeError, "Manager isn't accessible via %s instances" % type.__name__
AttributeError: Manager isn't accessible via Case instances 
```

这是代码：

```
from django.db import models
from django.contrib.auth.models import User
import datetime

SIDE_CHOICES = (
        ('p', 'pro'),
        ('c', 'con'),
        ('u', 'undecided'),
    )

    class Case(models.Model):
        question = models.CharField(max_length=200)
        owner = models.ForeignKey(User)
        pub_date = models.DateTimeField('date published')
        rating = models.IntegerField()
        def __unicode__(self):
            return self.question
        def was_published_today(self):
            return self.put_date.date() == datetime.date.today()
        def show_pro(self):
            return self.objects.filter(argument__side__contains='p')

    class Argument(models.Model):
        case = models.ForeignKey(Case)
        reason = models.CharField(max_length=200)
        rating = models.IntegerField()
        owner = models.ForeignKey(User)
        side = models.CharField(max_length=1, choices=SIDE_CHOICES)
        def __unicode__(self):
            return self.reason 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-06T21:36:11.313

尝试：

```
def show_pro(self):
    return self.argument_set.filter(side='p') 
```

基本上，您需要对 ForeignKey 关系进行反向查找，然后对其进行过滤以获取具有`side='p'`.

在`show_pro`函数中，`self`不是 QuerySet——它指的是对象本身。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T19:01:29.367

您不能调用`self.objects`,`objects`是类成员，而不是实例上的字段。这样想，这样做是否有意义：

```
c0 = Case.objects.all()[0]
c1 = c0.objects.all()[1] 
```

并不真地。这就是 using 的`self`作用。

相反，您需要访问实例字段。正如泰森建议的那样：

```
class Case(models.Model):
    ...
    def show_pro(self):
        return self.argument_set.filter(side='p')
    ... 
```

# java - 如何使用 Socket 类在 Java 中进行 HTTP 1.1 发布？

> ID：831885
> 
> 赞同：1
> 
> 时间：2009-05-06T21:32:37.513
> 
> 标签：java

我正在运行一个带有一些虚拟主机的 Tomcat 服务器，我需要将一些数据从另一台服务器上的另一个 servlet 发布到该服务器上的一个 servlet。因为我要发布到的服务器使用虚拟主机，只是通过它的 IP 地址引用该主机会导致问题（它不知道我要与哪个虚拟主机通信）。

这是我运行 HTTP 1.0 POST 到“sub.example.com”的代码，但在本例中，“example.com”只知道将请求路由到正确的子域（如果它被配置为默认值）。这是因为要求向 Socket 传递 InetAddress 而不是主机名。

```
String host = "sub.example.com";
int port = 80;
String path = "/Servlet";
StringBuilder data = new StringBuilder();
data.append(URLEncoder.encode("NameA", "UTF-8")).append('=').append(URLEncoder.encode("ValueA", "UTF-8"));
data.append('&').append(URLEncoder.encode("NameB", "UTF-8")).append('=').append(URLEncoder.encode("NameB", "UTF-8"));

InetAddress addr = InetAddress.getByName(host);
Socket socket = new Socket(addr, port);
BufferedWriter wr = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream(), "UTF8"));

wr.write("POST "+path+" HTTP/1.0\r\n");
wr.write("Content-Length: "+data.length()+"\r\n");
wr.write("Content-Type: application/x-www-form-urlencoded\r\n");
wr.write("\r\n");
// Send data
wr.write(data.toString());
wr.flush();
wr.close(); 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T21:37:24.460

您可能需要考虑使用[Apache HttpClient](http://hc.apache.org/httpclient-3.x/)而不是执行原始套接字通信。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T21:36:15.867

您可能会考虑通过使用 Java 中可用的高级 HTTP 客户端之一来让自己的生活更轻松一些，例如[`HttpURLConnection`](http://java.sun.com/javase/6/docs/api/java/net/HttpURLConnection.html). 您仍然需要处理构建`multipart/form-encoded`请求正文，但它消除了构建格式良好的请求的大部分麻烦，并使您的代码更接近真实域。

# asp.net - 是否应避免使用动态 asp.net 控件

> ID：831886
> 
> 赞同：1
> 
> 时间：2009-05-06T21:32:42.507
> 
> 标签：asp.net, dynamic, controls

是否应该不惜一切代价避免动态 asp.net 控件？

在什么情况下应该使用它们？

你用什么来代替他们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T21:56:20.733

1.  不
2.  当您直到运行时才知道要实例化的控件时
3.  我不怕动态控制..

为了在回发时给它们补水，我使用[DynamicControlsPlaceholder](http://www.denisbauer.com/ASPNETControls/DynamicControlsPlaceholder.aspx)

当您想用它的视图状态恢复控件而不必在每个请求上自己重建它时，这很棒。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T21:41:34.090

如果需要回发，我通常会避免使用它们。重建它们是一种痛苦。如果可能，将它们构建在`<asp:repeater>`可以数据绑定的控件或其他控件中。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-06T21:34:42.783

1) 应始终避免不必要的复杂性。
2) 必要时。
3) 不太复杂的选项。

# c# - C# 中的自定义原语？

> ID：831888
> 
> 赞同：20
> 
> 时间：2009-05-06T21:32:52.117
> 
> 标签：c#, primitive

除了这个值得怀疑的有用性之外，我想问一下是否有可能按照这些思路做一些事情。

```
class MyPrimitive {
        String value;
        public String Value {
            get { return value; }
            set { this.value = value; }
        }
}

// Instead of doing this...
MyPrimitive a = new MyPrimitive();
a.Value = "test";
String b = a.Value;

// Isn't there a way to do something like this?
MyPrimitive a = "test";
String b = a; 
```

我喜欢使用属性将原始类型包装到自定义类中，以使`get`and`set`方法执行其他操作，例如验证。
因为我经常这样做，所以我认为最好有一个更简单的语法，比如标准原语。
不过，我怀疑这不仅不可行，而且在概念上也可能是错误的。任何见解都将受到欢迎，谢谢。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-06T21:35:21.860

使用值类型 ( ) 并在赋值右侧`struct`给它一个[隐式转换运算符。](http://msdn.microsoft.com/en-us/library/z5z9kes2.aspx)

```
struct MyPrimitive
{
    private readonly string value;

    public MyPrimitive(string value)
    {
        this.value = value;
    }

    public string Value { get { return value; } }

    public static implicit operator MyPrimitive(string s)
    {
        return new MyPrimitive(s);
    } 

    public static implicit operator string(MyPrimitive p)
    {
        return p.Value;
    }
} 
```

编辑：使结构不可变，因为 Marc Gravell 是绝对正确的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T21:36:27.957

您可以使用*隐式强制转换*。不推荐，但是：

```
public static implicit operator string(MyString a) {
    return a.Value;
}
public static implicit operator MyString(string a) {
    return new MyString { value = a; }
} 
```

再次，不好的做法。

# opengl - 对 OpenGL 纹理使用自己的 mipmap 创建算法是否有意义？

> ID：831893
> 
> 赞同：19
> 
> 时间：2009-05-06T21:34:45.467
> 
> 标签：opengl, textures, mipmaps

我想知道如果我使用自己的算法而不是内置的自动算法来预生成它们，纹理 mipmap 的质量是否会更好。我可能会使用缓慢但漂亮的算法，例如 Lanczos 重采样。

是否有意义？我会在现代显卡上获得**任何质量提升吗？**

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-06T23:45:05.993

有充分的理由生成自己的 mipmap。但是，下采样的质量不是其中之一。

游戏和图形程序员过去曾尝试过各种下采样算法。最后结果证明，非常简单的“平均四个像素”方法给出了最好的结果。此外，更高级的方法在理论上在数学上更正确，它们往往会从 mipmap 中获得很多清晰度。这给人一种扁平的外观（试试看！）。

出于某些（对我来说无法理解）原因，简单平均方法似乎在抗锯齿和保持 mipmap 清晰之间取得了最佳折衷。

但是，您可能希望使用 gamma 校正来计算 mipmap。OpenGL 不会自行执行此操作。这可以产生真正的视觉差异，尤其是对于较暗的纹理。

这样做很简单。而不是像这样平均四个值：

```
float average (float a, float b, float c, float d)
{
  return (a+b+c+d)/4
} 
```

做这个：

```
float GammaCorrectedAverage (float a, float b, float c, float d)
{
  // assume a gamma of 2.0 In this case we can just square
  // the components. 
  return sqrt ((a*a+b*b+c*c+d*d)/4)
} 
```

此代码假定您的颜色分量已标准化为 0 到 1 的范围内。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-10-10T05:38:18.760

As an addition to this question, I have found that some completely different mipmapping (rather than those simply trying to achieve best down-scaling quality, like Lanczos filtering) algorithms have good effects on certain textures.

For instance, on some textures that are supposed to represent high-frequency information, I have tried using an algorithm that simply takes one random pixel of the four that are being considered for each iteration. The results depend much on the texture and what it is supposed to convey, but I have found that it gives great effect on some; not least for ground textures.

Another one I've tried is taking the most deviating of the four pixels to preserve contrasts. It has even fewer uses, but they do exist.

As such, I've implemented the option to choose mipmapping algorithm per texture.

**EDIT**: I thought I might provide some examples of the differences in practice. Here's a piece of grass texture on the ground, the leftmost picture being with standard average mipmapping, and the rightmost being with randomized mipmapping:

[![Average mipmapping, trilinear filtering](https://i.stack.imgur.com/srA1Z.png)](https://i.stack.imgur.com/srA1Z.png) [![Random mipmapping, trilinear filtering](https://i.stack.imgur.com/UZ0CB.png)](https://i.stack.imgur.com/UZ0CB.png)

I hope the viewer can appreciate how much "apparent detail" is lost in the averaged mipmap, and how much flatter it looks for this kind of texture.

Also for reference, here are the same samples with 4× anisotropic filtering turned on (the above being tri-linear):

[![Average mipmapping, 4× anisotropic filtering](https://i.stack.imgur.com/9zovM.png)](https://i.stack.imgur.com/9zovM.png) [![Random mipmapping, 4× anisotropic filtering](https://i.stack.imgur.com/f58pW.png)](https://i.stack.imgur.com/f58pW.png)

Anisotropic filtering makes the difference less pronounced, but it's still there.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-07-16T12:33:47.163

这取决于您展示的资产类型。Lanczos 过滤器更接近理想的低通过滤器，如果您并排比较 mip 映射，结果会很明显。大多数人会将混叠误认为是锐度——这又取决于你的资产是否倾向于包含高频——我肯定见过箱式滤波器不是一个好选择的情况。但是由于无论如何都会对 mip 图进行线性插值，因此增益可能不会那么明显。还有一件事要提——大多数人使用箱式过滤器并将输出作为输入传递到下一个阶段——这样你会失去精度和视觉能量（尽管伽马会帮助这个）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T21:40:28.837

是什么促使你尝试？您当前的 mipmap 是否生成不佳？（即您看过吗？）请记住，无论如何，您的结果通常仍然是（三）线性插值的，因此在运动之间通常会急剧减少改进重采样的回报。

# python - Python 成像，调整 Turtle Graphics 窗口的大小

> ID：831894
> 
> 赞同：4
> 
> 时间：2009-05-06T21:34:58.990
> 
> 标签：python, turtle-graphics

我的图像对于海龟窗口来说太大了。我不得不放大图像，因为我在每个位置需要的文本重叠。

如何在python中调整窗口大小？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-06T21:48:15.917

听起来您已经绘制了图像，但它已经超出了窗口的边界，因此您需要将窗口放大以查看整个图像。

要调整窗口大小：

> 设置（宽度 = 200，高度 = 200，startx = 无，starty = 无）

这将使您的输出窗口为 200X200（这对您来说可能太小，因此您需要将这些数字变大。）

这是我找到此信息的 URL。 [海龟文档](https://docs.python.org/2/library/turtle.html#module-turtle)

# c++ - 如何将 ActiveX（webbrower 托管）项目转换为静态库项目？

> ID：831913
> 
> 赞同：0
> 
> 时间：2009-05-06T21:38:29.887
> 
> 标签：c++, mfc, activex, atl, static-libraries

我有一个 ActiveX 组件，它包含一个用于访问特定 URL 的控件（嵌入在复合控件对话框窗格中的 webbrowser 控件）。ActiveX 组件访问 URL 可用于其他 MFC 或 VB 项目。用法是注册 ActiveX 组件（使用 regsvr32 cmd），然后使用“插入 ActiveX 控件”将控件插入到对话框窗口中。

现在我打算将 ActiveX 组件转换为具有相同浏览器窗口和 Web 访问功能的静态库。我想知道怎么做？此外，如何在其他 MFC 项目中使用浏览器窗口（在静态库中）。是通过函数调用吗？是否有可用的示例项目？

我使用 Microsoft .Net 2003 作为开发工具。

非常感谢您提前。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-06T22:18:26.577

我有点不清楚您认为可以将所有这些都放在静态库中的程度。

这可能不会像你想象的那么简单。允许您在对话框中插入 ActiveX 控件的 VS/MFC/ATL 中的向导和代码为您做了很多工作。也就是说，它对 ActiveX 控件的站点性质做出了某些假设，例如消息泵如何工作、谁是所有者窗口、线程模型等等。在对话中，这些是已知的。在另一种情况下，它们不是。

做你正在做的事情的正确方法是将其保留为 ActiveX 控件。也许如果您通过将其放入静态库来说明您要解决的问题，我们可以提供其他选择。

WebBrowser ActiveX 控件实际上是 system32 文件夹中 shdocvw.dll 库的包装器。shdocvw.dll 是 IE 的核心和灵魂（并且，通过扩展，许多 Windows 资源管理器界面）。这一切都非常基于 COM，它有自己的加载库等规则。因此，站点（任何想要使用您的 ActiveX 控件的应用程序）确实需要对 ActiveX/COM 友好。

# puzzle - 代码高尔夫：自动机

> ID：831915
> 
> 赞同：19
> 
> 时间：2009-05-06T21:38:37.157
> 
> 标签：puzzle, code-golf, rosetta-stone, automata

我使用这些规则制作了终极笑声发生器。你能用你最喜欢的语言巧妙地实现它吗？

### 规则：

在每次迭代中，都会发生以下转换。

```
H   -> AH
A   -> HA
AA  -> HA
HH  -> AH
AAH -> HA
HAA -> AH 
```

```
n = 0 |  H
n = 1 |  AH
n = 2 |  HAAH
n = 3 |  AHAH
n = 4 |  HAAHHAAH
n = 5 |  AHAHHA
n = 6 |  HAAHHAAHHA
n = 7 |  AHAHHAAHHA
n = 8 |  HAAHHAAHHAAHHA
n = 9 |  AHAHHAAHAHHA
n = ... 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T06:01:53.420

## 莱克斯/柔性

69 个字符。在此处的文本中，我将制表符更改为 8 个空格，以便看起来正确，但所有这些连续的空格都应该是制表符，并且制表符很重要，所以它出现了 69 个字符。

```
 #include <stdio.h>
%%
HAA|HH|H        printf("AH");
AAH|AA|A        printf("HA"); 
```

对于它的价值，生成`lex.yy.c`的是 42736 个字符，但我认为这并不重要。我可以（并且很快会）编写一个更短的纯 C 版本并且做同样的事情，但我觉得这可能应该是一个单独的条目。

**编辑：**

这是一个更合法的 Lex/Flex 条目（302 个字符）：

```
 char*c,*t;
        #define s(a) t=c?realloc(c,strlen(c)+3):calloc(3,1);if(t)c=t,strcat(c,#a);
%%
        free(c);c=NULL;
HAA|HH|H        s(AH)
AAH|AA|A        s(HA)
%%
int main(void){c=calloc(2,1);if(!c)return 1;*c='H';for(int n=0;n<10;n++)printf("n = %d |  %s\n",n,c),yy_scan_string(c),yylex();return 0;}int yywrap(){return 1;} 
```

这会进行多次迭代（与上一次迭代不同，它只进行一次迭代，每次都必须手动播种，但产生了正确的结果），并且具有看起来非常可怕的代码的优势。我使用一个函数宏、字符串化运算符和两个全局变量。如果您想要一个甚至不检查`malloc()`失败的更混乱的版本，它看起来像这样（282 个字符）：

```
 char*c,*t;
        #define s(a) t=c?realloc(c,strlen(c)+3):calloc(3,1);c=t;strcat(c,#a);
%%
        free(c);c=NULL;
HAA|HH|H        s(AH)
AAH|AA|A        s(HA)
%%
int main(void){c=calloc(2,1);*c='H';for(int n=0;n<10;n++)printf("n = %d |  %s\n",n,c),yy_scan_string(c),yylex();return 0;}int yywrap(){return 1;} 
```

一个更糟糕的版本可能是在堆栈上的哪里`c`是数组，我们只是给它`MAX_BUFFER_SIZE`某种形式，但我觉得这太过分了。

...只是在开玩笑。207 个字符，如果我们采取“99 个字符就*足够*了”的心态：

```
 char c[99]="H";
%%
        c[0]=0;
HAA|HH|H    strcat(c, "AH");
AAH|AA|A    strcat(c, "HA");
%%
int main(void){for(int n=0;n<10;n++)printf("n = %d |  %s\n",n,c),yy_scan_string(c),yylex();return 0;}int yywrap(){return 1;} 
```

我偏爱效果最好的那个（即第一个可以迭代直到内存耗尽并检查其错误的那个），但这是代码高尔夫。

要编译第一个，请键入：

```
flex golf.l
gcc -ll lex.yy.c 
```

（如果你有`lex`而不是`flex`，只需更改`flex`为`lex`。它们应该是兼容的。）

要编译其他的，请键入：

```
flex golf.l
gcc -std=c99 lex.yy.c 
```

否则 GCC 会抱怨`‘for’ loop initial declaration used outside C99 mode`和其他废话。

纯C答案即将出现。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T00:44:47.100

Haskell 的简单翻译：

```
grammar = iterate step
    where
        step ('H':'A':'A':xs) = 'A':'H':step xs
        step ('A':'A':'H':xs) = 'H':'A':step xs
        step ('A':'A':xs) = 'H':'A':step xs
        step ('H':'H':xs) = 'A':'H':step xs
        step ('H':xs) = 'A':'H':step xs
        step ('A':xs) = 'H':'A':step xs
        step [] = [] 
```

还有一个更短的版本（122 个字符，优化为三个推导规则 + 基本情况）：

```
grammar=iterate s where{i 'H'='A';i 'A'='H';s(n:'A':m:x)|n/=m=m:n:s x;s(n:m:x)|n==m=(i n):n:s x;s(n:x)=(i n):n:s x;s[]=[]} 
```

以及对 C++ 的翻译（182 个字符，只进行一次迭代，在命令行上以初始状态调用）：

```
#include<cstdio>
#define o putchar
int main(int,char**v){char*p=v[1];while(*p){p[1]==65&&~*p&p[2]?o(p[2]),o(*p),p+=3:*p==p[1]?o(137-*p++),o(*p++),p:(o(137-*p),o(*p++),p);}return 0;} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-07T03:03:34.677

## MATLAB（v7.8.0）：

73 个字符（不包括用于使其看起来可读的格式化字符）

该脚本（“haha.m”）假设您已经定义了变量**n**：

```
s = 'H';
for i = 1:n,
  s = regexprep(s,'(H)(H|AA)?|(A)(AH)?','${[137-$1 $1]}');
end 
```

...这是单行版本：

```
s='H';for i=1:n,s = regexprep(s,'(H)(H|AA)?|(A)(AH)?','${[137-$1 $1]}');end 
```

**测试：**

```
>> for n=0:10, haha; disp([num2str(n) ': ' s]); end
0: H
1: AH
2: HAAH
3: AHAH
4: HAAHHAAH
5: AHAHHA
6: HAAHHAAHHA
7: AHAHHAAHHA
8: HAAHHAAHHAAHHA
9: AHAHHAAHAHHA
10: HAAHHAAHHAHAAHHA 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-07T14:46:43.863

## Javascript：

120 剥离空白，我现在不理会它！

```
function f(n,s){s='H';while(n--){s=s.replace(/HAA|AAH|HH?|AA?/g,function(a){return a.match(/^H/)?'AH':'HA'});};return s} 
```

扩展：

```
function f(n,s)
{
    s = 'H';
    while (n--)
    {
        s = s.replace(/HAA|AAH|HH?|AA?/g, function(a) { return a.match(/^H/) ? 'AH' : 'HA' } );
    };
    return s
} 
```

那个替代品很贵！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-11T20:32:24.770

这是一个 C# 示例，如果我将空格减少到每个项目之间的一个空格，则为 321 个字节。

*编辑*：作为对[@Johannes Rössel](https://stackoverflow.com/users/73070/johannes-rossel)评论的回应，我从解决方案中删除了泛型以获取更多字节。

*编辑*：另一个变化，摆脱了所有的临时变量。

```
public static String E(String i)
{
    return new Regex("HAA|AAH|HH|AA|A|H").Replace(i, 
        m => (String)new Hashtable {
            { "H", "AH" },
            { "A", "HA" },
            { "AA", "HA" },
            { "HH", "AH" },
            { "AAH", "HA" },
            { "HAA", "AH" }
        }[m.Value]);
} 
```

仍然可以编译的具有较少空格的重写解决方案是 158 个字符：

```
return new Regex("HAA|AAH|HH|AA|A|H").Replace(i,m =>(String)new Hashtable{{"H","AH"},{"A","HA"},{"AA","HA"},{"HH","AH"},{"AAH","HA"},{"HAA","AH"}}[m.Value]); 
```

对于 Visual Studio 2008 的完整源代码解决方案，下面提供了一个包含必要代码（包括单元测试）的 subversion 存储库。

[存储库在这里](https://vkarlsen.serveftp.com:8443/websvn/listing.php?repname=StackOverflow&path=/SO831915/)，用户名和密码都是'guest'，没有引号。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-07T05:32:48.827

# `Perl`168 个字符。

*（不包括不必要的换行符）*

```
perl -E'
($s,%m)=qw[H H AH A HA AA HA HH AH AAH HA HAA AH];
sub p{say qq[n = $_[0] |  $_[1]]};p(0,$s);
for(1..9){$s=~s/(H(AA|H)?|A(AH?)?)/$m{$1}/g;p($_,$s)}
say q[n = ...]' 
```

## 去混淆：

```
use strict;
use warnings;
use 5.010;

my $str = 'H';

my %map = (
    H => 'AH',
    A => 'HA',
   AA => 'HA',
   HH => 'AH',
  AAH => 'HA',
  HAA => 'AH'
);

sub prn{
 my( $n, $str ) = @_;
 say "n = $n |  $str"
}

prn( 0, $str );

for my $i ( 1..9 ){
  $str =~ s(
    (
      H(?:AA|H)? # HAA | HH | H
    |
      A(?:AH?)?  # AAH | AA | A
    )
  ){
    $map{$1}
  }xge;

  prn( $i, $str );
}

say 'n = ...'; 
```

# `Perl`150 个字符。

*（不包括不必要的换行符）*

```
perl -E'
$s="H";
sub p{say qq[n = $_[0] |  $_[1]]};p(0,$s);
for(1..9){$s=~s/(?|(H)(?:AA|H)?|(A)(?:AH?)?)/("H"eq$1?"A":"H").$1/eg;p($_,$s)}
say q[n = ...]' 
```

## 去混淆

```
#! /usr/bin/env perl
use strict;
use warnings;
use 5.010;

my $str = 'H';

sub prn{
 my( $n, $str ) = @_;
 say "n = $n |  $str"
}

prn( 0, $str );

for my $i ( 1..9 ){
  $str =~ s{(?|
        (H)(?:AA|H)? # HAA | HH | H
      |
        (A)(?:AH?)?  # AAH | AA | A
    )}{
      ( 'H' eq $1 ?'A' :'H' ).$1
    }egx;
  prn( $i, $str );
}

say 'n = ...'; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-06T00:04:22.990

## 红宝石

这段代码 Golf 没有很好地指定——我认为返回第*n*个迭代字符串的函数是解决它的最佳方法。它有 80 个字符。

```
def f n
a='h'
n.times{a.gsub!(/(h(h|aa)?)|(a(ah?)?)/){$1.nil?? "ha":"ah"}}
a
end 
```

打印出*n 个*第一个字符串（71 个字符）的代码：

```
a='h';n.times{puts a.gsub!(/(h(h|aa)?)|(a(ah?)?)/){$1.nil?? "ha":"ah"}} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-09T14:59:24.310

**二郎**

241 字节并准备运行：

```
> erl -noshell -s g i -s init stop
AHAHHAAHAHHA

-module(g).
-export([i/0]).
c("HAA"++T)->"AH"++c(T);
c("AAH"++T)->"HA"++c(T);
c("HH"++T)->"AH"++c(T);
c("AA"++T)->"HA"++c(T);
c("A"++T)->"HA"++c(T);
c("H"++T)->"AH"++c(T);
c([])->[].
i(0,L)->L;
i(N,L)->i(N-1,c(L)).
i()->io:format(i(9,"H")) 
```

应该可以改进。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-10-11T19:16:26.773

## Python（150 字节）

```
import re
N = 10
s = "H"
for n in range(N):
    print "n = %d |"% n, s
    s = re.sub("(HAA|HH|H)|AAH|AA|A", lambda m: m.group(1) and "AH" or "HA",s) 
```

### 输出

```
n = 0 | H
n = 1 | 啊
n = 2 | 哈哈
n = 3 | 啊啊
n = 4 | 哈哈哈
n = 5 | 啊哈哈
n = 6 | 哈哈哈哈
n = 7 | 啊啊啊啊
n = 8 | 哈哈哈哈哈哈
n = 9 | 啊啊啊啊啊

```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-06T23:55:58.527

这是一个非常简单的 C++ 版本：

```
#include <iostream>
#include <sstream>
using namespace std;

#define LINES 10

#define put(t) s << t; cout << t

#define r1(o,a,c0) \
    if(c[0]==c0) {put(o); s.unget(); s.unget(); a; continue;}
#define r2(o,a,c0,c1) \
    if(c[0]==c0 && c[1]==c1) {put(o); s.unget(); a; continue;}
#define r3(o,a,c0,c1,c2) \
    if(c[0]==c0 && c[1]==c1 && c[2]==c2) {put(o); a; continue;}

int main() {
    char c[3];
    stringstream s;
    put("H\n\n");
    for(int i=2;i<LINES*2;) {
        s.read(c,3);
        r3("AH",,'H','A','A');
        r3("HA",,'A','A','H');
        r2("AH",,'H','H');
        r2("HA",,'A','A');
        r1("HA",,'A');
        r1("AH",,'H');
        r1("\n",i++,'\n');
    }
} 
```

它不完全是代码高尔夫（它可以做得更短），但它确实有效。更改`LINES`为您想要打印的行数（注意：它不适用于`0`）。它将像这样打印输出：

```
H

AH

HAAH

AHAH

HAAHHAAH

AHAHHA

HAAHHAAHHA

AHAHHAAHHA

HAAHHAAHHAAHHA

AHAHHAAHAHHA 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-07T20:46:11.453

## ANSI C99

以残酷的 306 个字符出现：

```
#include <stdio.h>
#include <string.h>
char s[99]="H",t[99]={0};int main(){for(int n=0;n<10;n++){int i=0,j=strlen(s);printf("n = %u |  %s\n",n,s);strcpy(t,s);s[0]=0;for(;i<j;){if(t[i++]=='H'){t[i]=='H'?i++:t[i+1]=='A'?i+=2:1;strcat(s,"AH");}else{t[i]=='A'?i+=1+(t[i+1]=='H'):1;strcat(s,"HA");}}}return 0;} 
```

嵌套的 if 和条件运算符太多了，我无法通过宏有效地减少这种情况。相信我，我试过了。可读版本：

```
#include <stdio.h>
#include <string.h>
char s[99] = "H", t[99] = {0};
int main()
{
    for(int n = 0; n < 10; n++)
      {
        int i = 0, j = strlen(s);
        printf("n = %u |  %s\n", n, s);
        strcpy(t, s);
        s[0] = 0;
        /*
         * This was originally just a while() loop.
         * I tried to make it shorter by making it a for() loop.
         * I failed.
         * I kept the for() loop because it looked uglier than a while() loop.
         * This is code golf.
         */
        for(;i<j;)
          {
            if(t[i++] == 'H' )
              {
                // t[i] == 'H' ? i++ : t[i+1] == 'A' ? i+=2 : 1;
                // Oh, ternary ?:, how do I love thee?
                if(t[i] == 'H')
                    i++;
                else if(t[i+1] == 'A')
                    i+= 2;
                strcat(s, "AH");
              }
            else
              {
                // t[i] == 'A' ? i += 1 + (t[i + 1] == 'H') : 1;
                if(t[i] == 'A')
                    if(t[++i] == 'H')
                        i++;
                strcat(s, "HA");
              }
          }
      }
    return 0;
} 
```

我将来可能会制作一个更短的版本`strncmp()`，但谁知道呢？我们会看看会发生什么。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-06-05T12:52:18.130

在蟒蛇中：

```
def l(s):
 H=['HAA','HH','H','AAH','AA','A']
 L=['AH']*3+['HA']*3
 for i in [3,2,1]:
  if s[:i] in H: return L[H.index(s[:i])]+l(s[i:])
 return s

def a(n,s='H'):
 return s*(n<1)or a(n-1,l(s))

for i in xrange(0,10):
 print '%d: %s'%(i,a(i)) 
```

第一次尝试：198 个字符的代码，我相信它可以变得更小：D

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-10-15T04:51:30.417

REBOL，150 个字符。不幸的是，REBOL 不是一种有利于代码高尔夫的语言，但正如 Adam Sandler 所说，150 个字符并不算太简陋。

`m`这假设已经定义了循环变量。

```
s: "H" r: "" z:[一些[["HAA"|"HH"|"H"](追加 r "AH")|["AAH"|"AA"|"A"](追加r "HA")]to end]repeat nm[clear r parse sz print["n = n "|" s: 复制 r]]
```

这里有更好的布局：

```
s：“H”
r：“”
z：[
    一些 [
        [“哈哈”| “哈” | "H" ] (附加 r "AH")
    | [“啊”| “AA” | "A" ] (附加 r "HA")
    ]
    结束
]

重复纳米 [
    清除 r
    解析 sz
    打印 ["n = n "|" s: 复制 r]
]
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-10-16T01:36:40.797

**F#：184 个字符**

似乎很干净地映射到 F#：

```
type grammar = H | A
let rec laugh = function
    | 0,l -> l
    | n,l ->
        let rec loop = function
            |H::A::A::x|H::H::x|H::x->A::H::loop x
            |A::A::H::x|A::A::x|A::x->H::A::loop x
            |x->x
        laugh(n-1,loop l) 
```

这是 fsi 中的运行：

```
> [for a in 0 .. 9 -> a, laugh(a, [H])] |> Seq.iter (fun (a, b) -> printfn "n = %i: %A" a b);;
n = 0: [H]
n = 1: [A; H]
n = 2: [H; A; A; H]
n = 3: [A; H; A; H]
n = 4: [H; A; A; H; H; A; A; H]
n = 5: [A; H; A; H; H; A]
n = 6: [H; A; A; H; H; A; A; H; H; A]
n = 7: [A; H; A; H; H; A; A; H; H; A]
n = 8: [H; A; A; H; H; A; A; H; H; A; A; H; H; A]
n = 9: [A; H; A; H; H; A; A; H; A; H; H; A] 
```

# iphone - 用于 IIS windows 身份验证的 HTTP 身份验证标头

> ID：831926
> 
> 赞同：0
> 
> 时间：2009-05-06T21:41:35.557
> 
> 标签：iphone, iis, http-authentication

我有一个使用 Windows 身份验证托管在 IIS 上的网站。我正在尝试在我的一个 iPhone Web 应用程序中访问它。目前我正在使用此代码，但它不起作用。

NSString *authString = [[[NSString stringWithFormat:@"%@:%@", @"myusername", @"mypassword"]dataUsingEncoding:NSUTF8StringEncoding] base64Encoding];

```
authString = [NSString stringWithFormat: @"Basic %@", authString];

**[requestObj setValue:authString forHTTPHeaderField:@"Authorization"];** 
```

我的 Web 应用程序使用 Windows 身份验证托管。但在这里我使用的是基本的。任何人都可以发布什么是正确的 http 标头。

谢谢..

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T12:03:57.667

我认为主要区别在于您需要指定您正在验证的域以及用户名和密码。像这样的东西应该工作。为简洁起见，我使用了同步请求，理想情况下，您应该使用 ASINetworkQueue 或 NSOperationQueue 来执行请求。

```
NSString *username = @"test";
NSString *password = @"test";
NSString *domain = @"test";
NSURL *url = [NSURL URLWithString:@"http://myurl"];
ASIHTTPRequest *request = [[[ASIHTTPRequest alloc] initWithURL:url] autorelease];
[request setUseSessionPersistence:YES];
[request setUsername:username];
[request setPassword:password];
[request setDomain:domain];
[request start];
if ([request error]) {
    if ([[request error] code] == ASIAuthenticationErrorType) {
        //Authentication failed
    }
} else {
    NSLog([request responseString]);
} 
```

我无权访问 Windows 服务器来测试这个，但我过去测试过 NTLM，所以它应该可以工作...... :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T21:48:15.323

Windows 身份验证 (NTLM) 不像基本身份验证那么简单。NTLM 需要多个 web 请求来协商安全性，因此没有可以发送用于登录的静态 HTTP 标头。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T06:22:20.393

您可以使用第三方[ASIHTTPRequest 库](http://allseeing-i.com/ASIHTTPRequest/)来执行 NTLM over HTTP 身份验证。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T00:40:00.160

我不是 100% 确定它支持 NTLM 身份验证，但你调查`connection:didReceiveAuthenticationChallenge`过 NSUrlConnection 上的方法吗？

# python - 没有 Auth 应用程序的 Scaffold 或 django-admin

> ID：831934
> 
> 赞同：-2
> 
> 时间：2009-05-06T21:45:29.993
> 
> 标签：python, django, django-admin, scaffolding

我创建了自己的 Auth 应用程序，但现在 Admin 无法正常工作，您有什么建议？

现在的例外是：“用户”对象没有属性“is_authenticated”

我知道我的用户真的没有这种方法。所以我有两种方法： - 更改管理员 - 调整我的用户系统

我的问题是：是否有可能轻松关闭绑定到身份验证的管理员

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T10:21:29.693

查看文件 django/contrib/admin/views/decorators.py：

```
from django.contrib.auth.models import User
from django.contrib.auth import authenticate, login 
```

这些用于`staff_member_required`保护对管理应用程序的访问的装饰器。

管理应用程序需要`django.contrib.auth`- 您可能会尝试对其进行猴子补丁，但这是一个坏习惯（Django 不是 RoR，Python 不是 Ruby）。

# javascript - 使用 jQuery 连接事件的模式

> ID：831939
> 
> 赞同：1
> 
> 时间：2009-05-06T21:46:08.823
> 
> 标签：javascript, jquery

请查看最后的代码，了解我在 jQuery 代码中用于连接事件的方法。我更喜欢使用绑定，您也可以看到我不喜欢在我的事件处理程序中使用匿名函数。

由于以下两个原因，我正在使用命名函数：

1.  可读性
2.  多次调用我的 WireUpGlobalCommandClickEvents 不会将多个事件处理程序添加到单击我的链接。

这有一个副作用 - 我需要使用绑定的功能将数据传递给 OnAddNewSnippetClick，因为在 OnAddNewSnippetClick 中，这现在指的是导致事件触发的元素。

我一直将 JavaScript 视为二等公民，如您所见，我正在尝试将我在 ASP.NET MVC 应用程序中使用的约定也强制到我的 JavaScript 上。我对添加多个事件处理程序的偏执是否放错了位置？有没有更好的模式来使用 jQuery 连接事件处理程序？

```
SettingsController.prototype = {

    OnAddNewSnippetClick: function(event) {
        event.data.SettingsController.SettingsAjaxHelper.AddNewSnippet(event.data.Parameter, event.data.SettingsController);
    },

    WireUpGlobalCommandClickEvents: function(parameter) {
        $('#addSnippetLink').bind("click", { SettingsController: this, Parameter: parameter }, this.OnAddNewSnippetClick);
    }
}; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T21:55:37.367

如果您真的对绑定多个事件感到偏执，您可以使用 live，它会根据选择器自动连接事件。

```
 $(".stuff").live('click',function(){}); 
```

或者

```
$("#element").one('click',function(){}); 
```

或者

```
$("#element").unbind('click').bind('click',function(){}); 
```

但是，是的，看起来您正在尝试在 javascript 中执行 MVC，这可能是矫枉过正

[http://docs.jquery.com/Events/live#typefn](http://docs.jquery.com/Events/live#typefn)

# c# - 使用哈希集 在 C# Properties.Settings 中

> ID：831941
> 
> 赞同：1
> 
> 时间：2009-05-06T21:47:22.330
> 
> 标签：c#, visual-studio-2008, hashset

我正在为我正在开发的游戏创建一些 C# 工具，并且我正在添加“最近的文件->”下拉菜单。

问题是，我无法在 VS2008 中获得 C# 的“设置”页面来允许我添加类型化的 HashSet。只是没有选择这样做。

我得到了所有hackalicious并手动将“Settings.Designer.cs”文件编辑为：

```
 [global::System.Configuration.UserScopedSettingAttribute()]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    public global::System.Collections.Generic.HashSet<String> RecentLibs {
        get {
            return ((global::System.Collections.Generic.HashSet<String>)(this["RecentLibs"]));
        }
        set {
            this["RecentLibs"] = value;
        }
    } 
```

这似乎工作得很好。但是，我知道在某些时候它会使用代码生成器来消除这些更改。

这样做的正确方法是什么？C# 是否有一些我应该用于此功能的内置类型，而不仅仅是一个简单的 HashSet？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T21:56:27.160

不要这样做。VS 将核对 Settings.Designer.cs 中的任何代码。

相反，从 VS 打开设置编辑器（这将显示 Settings.settings 和 Settings.Designer.cs 文件的设计编辑器）。

然后，按 F7 以获取代码视图。VS 将自动创建一个名为 Settings.cs 的文件，该文件是与 Settings.Designer.cs 文件共享的部分类。您可以根据自己的喜好编辑此文件。

但是，您在 Settings.settings 文件中的 XML 条目可能会被烘烤。我会保留一份单独的副本以防万一。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T21:58:52.660

不确定执行此操作的“正确”方法，但您可以安全地将代码移动到部分 Settings.cs 类文件，而不必担心 Visual Studio 会覆盖它们。

# javascript - 我可以从 Javascript 方法中找出谁\哪个 DOM 元素调用了我吗？

> ID：831942
> 
> 赞同：16
> 
> 时间：2009-05-06T21:48:03.750
> 
> 标签：javascript, dom

```
<a onclick ="foo()" href="bar.html" >Link </a>

<script>

...
function foo(){
  //I want to know the href property of whoever called me.
  //something like this.caller.href ??
}

</script> 
```

我想我可以分配所有元素 ID，然后将我自己的 ID 传递给我正在调用的 JS 方法，但我正在寻找更好的方法。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-06T21:53:03.830

当浏览器调用一个函数作为 DOM 事件的结果时，JavaScript 将一个对象传递给该函数，其中包含有关该事件的信息。但它在 IE 中的工作方式与其他方式略有不同。要在所有浏览器中工作，`foo()`应该带一个参数*（我使用`e`）：

```
function foo(e) {
  var sender = (e && e.target) || (window.event && window.event.srcElement);
  //sender is the DOM element which was clicked
  alert(sender.href); //assumes the clicked element was an <a>
} 
```

第一行将为“sender”分配在所有浏览器中发起事件的元素的值。

现在，如果您`<a>` *包含*子元素（例如，图像）并且其中一个*是*实际点击的元素，那么该元素将成为“发送者”。如果这是可能的，您需要从发件人那里走上 DOM，直到找到您的链接：

```
function foo(e) {
  var sender = (e && e.target) || (window.event && window.event.srcElement);
  //sender is the DOM element which was clicked

  var myEle = sender;

  //find the parent node until we hit the <a>
  while(myEle.tagName.toUpperCase() != 'A') {
    myEle = myEle.parentNode;
  }

  //myEle is now the <a>. sender is still the originator.
  alert(myEle.href);
} 
```

`arguments[]`*您还可以使用数组访问传递给函数的任何参数，即使它们没有声明。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-06T21:51:53.287

```
<a onclick="foo(this)" href="bar.html">Link</a> 
```

那么你的 JavaScript 将是：

```
function foo(ob) {
    alert(ob.href); //or whatever you want to happen preferably pass an id 
} 
```

如果要将对象本身传递给函数，请使用“this”选择器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T21:53:48.167

这里的约定是*this*指的是调用处理程序的 DOM 元素。所以如果你想知道链接的href：

```
function foo () {
   // Inside foo this will refer to the DOM element if called as an event handler
   var href = this.href
} 
```

这应该够了吧。

编辑：如果 foo 从 DOM 中的 onclick-handler 显式调用，即

```
<a [...] onclick="foo()"> 
```

那么*this*的原始上下文将在 foo 中丢失。要解决这个问题，可以将函数调用绑定到原始上下文：

```
<a [...] onclick="foo.call(this)"> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-06T21:52:02.303

您可以`href`在调用时将属性的值传递给函数：

```
<a href="http://www.example.com" onclick="foo(this.href)">link</a> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T21:51:27.233

传递一个论点怎么样？

```
foo(id); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-06T21:53:38.027

您不需要将元素作为参数传递给您的函数。您可以使用

```
var a = event.srcElement;
alert(a.href); 
```

# html - 如何在 Web 浏览器输入字段中禁用字典查找？

> ID：831949
> 
> 赞同：4
> 
> 时间：2009-05-06T21:50:17.847
> 
> 标签：html, browser

当用户输入日期时，它带有红色下划线（因为它不在某处的字典中）。这肯定是 FF 中的一个问题，可能是大多数浏览器。有没有办法将输入字段标记为“这里不要指望英文单词？”

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T21:57:33.040

使用`spellcheck`属性。在 Firefox 3.0 中测试：

```
<html><body>
<textarea>Teh speling is checkd.</textarea>
<textarea spellcheck='false'>Teh speling is not checkd.</textarea>
</body></html> 
```

# c++ - 构造函数中的默认模板参数

> ID：831952
> 
> 赞同：2
> 
> 时间：2009-05-06T21:50:52.087
> 
> 标签：c++, constructor, templates, default, parameters

所以我有这段代码，为了方便起见，我希望它的构造函数的默认参数是 int 类型和 0。（我的项目的一个类中有更多参数，其中一个是可选的，我不想要两次编写构造函数，因为它很大）

```
class mama{
    public:
    template<typename x> mama(x i=int(0)){}
};

int main(){
    mama x;
} 
```

这不起作用，因为它说它找不到构造函数，所以还有另一种方法可以做到这一点吗？

```
error: no matching function for call to ‘mama::mama()'
note: candidates are: mama::mama(const mama&) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-06T21:57:08.733

请注意，函数模板不允许使用默认模板参数。为什么不创建一个类模板？

```
template <class T=int>
class mama{
    public:
    mama<T>(T i=0){}
};

int main(){
    mama<> x; // no argument based template parameter deduction possible
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T21:56:49.763

将您的构造函数重构为私有初始化函数和包装构造函数，然后添加默认值，如下所示：

```
class mama {
  private:
    template<typename x> void init(x i) { /* ... */ }
  public:
    template<typename x> mama(x i) { init(i); }
    mama() { init((int)0); }
}; 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-07T02:59:56.790

默认值就像重载一样工作，所以......

```
class mama{
public:
    template<typename x> mama(x i){}
    mama(int i = 0) {}
}; 
```

当您创建不带参数的 mama 时，具有默认 int 的构造会在任何模板化构造函数之前匹配。

# javascript - 使用 javascript 进行函数式 Web 编程的一个很好的例子是什么？

> ID：831967
> 
> 赞同：12
> 
> 时间：2009-05-06T21:53:04.983
> 
> 标签：javascript, functional-programming

我现在每天都在做javascript。我来自 OO 背景，我接触过的大部分代码都有些程序化/OO 风格。我正在寻找可以解决或多或少典型 Web 编程任务但以功能方式解决的好示例。

我对有任何看起来像功能的任意示例不感兴趣。我正在寻找一个示例，该示例可以展示如何使用功能能力比使用其他方法更好地解决问题。我知道这是一种主观/风格依赖，但不要让自己（我自己）太难。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-07T03:58:23.657

首先，您要了解函数式编程的含义；也就是说，核心概念是什么，以及语言如何让你坚持这些概念。对于 OOP，核心概念是封装、继承和多态性（或者只是用于 smalltalkers 的消息传递）。对于 FP 来说，中心原则是[参照透明](http://en.wikipedia.org/wiki/Referential_transparency)（这意味着无状态）。如果不是不可能的话，尝试用一种不支持函数式特性（例如，作为第一类对象的函数）的语言以函数式风格进行编程将会很尴尬。与使用不具有 OOP 功能的语言进行 OOP 编程相同。

幸运的是，Javascript 是多范式的，并且两者都支持。与其寻找“功能性”代码的示例，不如考虑确保引用透明性的所有方法，这*自然会*导致使用语言的 FP 特性，例如 lambda、闭包、高阶函数（例如map、reduce、filter)、currying 等。

说真的，这并不意味着没有答案。我真的认为这是最有动力和最有效的方法。

也就是说，这里有一些希望有用的链接。

1.  [JavaScript 中的 FP 编程](http://www.ibm.com/developerworks/library/wa-javascript.html)

2.  [大部分是足够的 FP 指南](https://github.com/MostlyAdequate/mostly-adequate-guide)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-07T00:39:57.173

Douglas Crockford从他的[JavaScript](http://javascript.crockford.com/)资源页面链接到[函数式 JavaScript 。](http://osteele.com/sources/javascript/functional/)这是该网站的一个片段：

> Functional 是一个用于 JavaScript 函数式编程的库。它定义了标准的高阶函数，例如 map、reduce（又名 foldl）和 select（又名 filter）。还为偏函数应用定义了curry、rcurry、partial等函数；以及 compose、guard 和 until 用于函数级编程。所有这些函数都接受字符串，例如 'x -> x+1'、'x+1' 或 '+1' 作为更详细函数 (x) {return x+1} 的同义词。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T22:16:21.713

我记得的一个例子是一个绑定到一个对象的函数，用于注册为事件处理程序

```
function bind(aHandler, aBind) {
    var handler = aHandler;
    var bind = aBind;
    return function(event) {
        return handler.call(bind, event);
    }
} 
```

它处理范围（currying）并且很方便。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T00:34:48.950

看看[jQuery](http://jquery.com/)。这个博客很好地证明了它的功能风格。 [http://importantshock.wordpress.com/2009/01/18/jquery-is-a-monad/](http://importantshock.wordpress.com/2009/01/18/jquery-is-a-monad/)

也就是说，JS 并不是真正的函数式语言 (IMO)，因此试图强迫它成为一种可能不是作为开发人员最有效的途径（使用螺丝刀作为锤子——仍然可以钉在墙上，但没那么快:)。再说一次，它是一种 lambda 语言。

# jquery - Intranet 开发人员制作面向公众的网站的安全注意事项？

> ID：831968
> 
> 赞同：2
> 
> 时间：2009-05-06T21:53:18.277
> 
> 标签：jquery, asp.net-mvc, security, subsonic

我有很多编写内部 Intranet 应用程序的经验，但在编写面向公众的 Web 应用程序时却很少，因为很可能有一定比例的人会尝试并且是恶意的。

该应用程序是用 MVC.net、JQuery 和 Subsonic 编写的。

我可以采取哪些步骤来规划我的应用程序，使其合理规划？

我已经做了一些事情：

*   服务器端和客户端的表单验证
*   强制密码复杂性
*   签入当前用户可以执行该操作的控制器操作。

对于查看我的表单的 html 源代码并查看表单发布的内容并使用它手动创建具有不同值的表单帖子来执行他们不应该执行的操作的人，一直非常偏执。这种妄想症是否有根据，我需要对 HttpVerb GET 和 POST 或仅 GET 归因的操作执行此操作吗？

我需要担心 ORM 的 SQL 注入吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T21:57:39.653

检查所有控制器操作的授权，包括 GET 和 POST。不是为会话授权，而是再次为每个请求授权。

服务器验证是必须的。还要在数据库级别强制执行一定数量的数据完整性。一旦发现一些异常情况就失败。不要试图恢复和处理所有可能的情况来取悦用户。

不要依赖用户标识，例如存储在 cookie 中的用户名。它可以更换。添加更多和独特的东西。Cookie 也可能被窃取并转移到另一台 PC。考虑检查 IP 地址的选项（例如），以确保您没有被欺骗。

限制单位时间的用户操作量。不允许在一分钟内提交 100 次。

所有用户输入都必须进行清理。是的，担心 SQL 注入。

不要以纯文本形式存储密码。哈希它们。如果有人闯入您的系统，他们可以通过假设用户具有相同的密码来访问他的电子邮件帐户、银行系统等来滥用密码。

另一个好主意可能是不要使用公共昵称、电子邮件或其他公开称为登录名的东西。允许用户使用登录名来执行登录操作，并使用不同的名称在网站上公开代表他们。

事实上，看看这个线程。它对这类知识进行了很好的总结。

[开发人员在建立公共网站*之前*应该知道什么？](https://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-web-site)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T21:58:48.043

*   几次失败后帐户锁定（30 分钟）以防止暴力破解。
*   考虑将 SSL 作为注册和登录页面的一个选项。
*   用户类上的 IsInRole 函数是一种管理用户操作安全性的简单方法。
*   为任何“记住我”功能使用令牌。确保此令牌的生成是加密安全的。
*   仅使用参数化查询，以防止注入。
*   加密 cookie。
*   [微软反 XSS](http://msdn.microsoft.com/en-us/library/aa973813.aspx)
*   多疑。

有很多考虑。与往常一样，这将是一项正在进行的工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-06T22:00:42.737

建立面向公众的网站时的偏执狂是你的朋友。

您的 cookie 是否加密？通过自定义 HttpModule 很容易完成。这是在普通 SSL 之上。

是的，您需要担心 sql 注入。并非所有的 ORM 都是一样的。我们最近发现 LINQ 在某些条件下存在 sql 注入问题。不要相信任何为您编写查询的东西。

如果这涉及敏感信息，请添加代码以防止重放攻击。基本上，假设离开服务器的所有内容都将被某人捕获。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T22:11:47.530

*   所有用户输入都将被视为会破坏您的服务器（XSS）
*   所有进出数据库的信息都是魔鬼，必须关闭（SQL 注入）
*   如果你不小心，饼干怪物会抓住你。
*   像关闭 Javascript 一样进行编程，但为打开它的用户提供功能

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-06T22:37:19.120

有关 Web 应用程序漏洞的详尽目录、最重要的解决方案以及有助于编写更安全代码的开发实践，请查看[OWASP](http://www.owasp.org/)和[CLASP。](http://www.owasp.org/index.php/Category:OWASP_CLASP_Project)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T00:00:10.670

*   清理客户端发送给您的任何输入。POST/GET 数据可能是最容易伪造的，但绝对不是全部。

*   不要仅仅依靠 JavaScript 来采取任何安全措施，因为它很容易被绕过。

*   确保您有一个安全的密码恢复策略（例如，不仅仅是一个“秘密问题”）

*   具有某种蛮力保护，例如 CAPTCHA

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T08:36:16.123

你对安全有多认真？

出于安全考虑，有一个 RFC 标准。

[http://www.faqs.org/rfcs/rfc3552.html](http://www.faqs.org/rfcs/rfc3552.html)

通读一遍（42 页左右）。它包含大多数安全注意事项。创建新的 RFC 时，您将使用此文档来指导您完成考虑。

# ruby - 是否存在红宝石“异常”会通过“救援对象”的情况？

> ID：831973
> 
> 赞同：5
> 
> 时间：2009-05-06T21:55:01.237
> 
> 标签：ruby, exception

有没有一种方法可以引发不源于 Exception 的异常？

我试图避免的是：

```
require 'timeout'
begin
  timeout(1) {sleep(50)}
rescue StandardError => e
  puts e.message
end 
```

我知道我可以用“rescue Exception”或更彻底的“rescue Object”来捕捉它，但这对我来说似乎有点奇怪。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-06T22:51:16.687

如果你试图引发一个不属于`Exception`该类的错误，你会得到一个`<TypeError: exception class/object expected>`.

# iphone - iPhone 应用程序键盘

> ID：831987
> 
> 赞同：-1
> 
> 时间：2009-05-06T21:58:00.213
> 
> 标签：iphone, cocoa-touch, uikit

当我在我的 iPhone 应用程序中填写一些文本字段时，我想添加上一个、下一个、完成、Go 等按钮。你能让我知道我该怎么做吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T23:22:09.107

iPhone 应用程序通常由多个 UIViewController 组成。

每个 UIViewController 管理数据和显示数据的视图。

UIViewControllers 可以按 UINavigationController 或 UITabController 分组，两者都添加导航元素以在不同的 UIViewControllers 之间导航。

例如，标签控制器在屏幕底部绘制标签，以便您可以在视图之间切换。导航控制器添加了“后退”按钮，因此您可以返回上一个屏幕，并且您可以添加额外的功能，例如在视图上操作的编辑/添加/删除按钮。

看看 UINavigationController、UIViewController 和 UITableView。

如果您解释一下您的表单是如何设计的以了解上一个/下一个按钮的用途，这将有所帮助，例如这是用于在同一表单的多个屏幕之间导航吗？我怀疑 UINavigationController 是你需要的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T05:34:53.393

如果这是您要问的问题，Safari 工具栏上方的“上一个”、“下一个”和“完成”按钮基本上只是位于`UIToolbar`键盘正上方。没有内置机制来执行这些按钮的操作，因此您必须自己编写它们。

“完成”应使该字段放弃其第一响应者状态；“上一个”和“下一个”应该改变哪个字段是第一响应者。您可以观察`UIKeyboardWillShowNotification`并`UIKeyboardWillHideNotification`确定何时显示和隐藏此工具栏以及将其放置在屏幕上的什么位置。

# sql - 在本机 sql 查询中使用 IN 子句

> ID：831990
> 
> 赞同：13
> 
> 时间：2009-05-06T21:58:47.640
> 
> 标签：sql, hibernate, jpa, in-operator, sql-in

我们正在尝试为原生 sql 查询动态生成 IN 子句以返回 JPA 实体。Hibernate 是我们的 JPA 提供者。我们的代码看起来像这样。

```
@NamedQuery(
    name="fooQuery",
    queryString="select f from Foo f where f.status in (?1)"
)

....

Query q = entityManager.createNamedQuery("fooQuery");
q.setParameter(1, "('NEW','OLD')");
return q.getResultList(); 
```

这不起作用，in 子句无法识别通过这种方式传入的任何值。有谁知道这个问题的解决方案？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-07T05:47:21.473

JPA 支持命名列表参数，在您的情况下：

```
@NamedQuery(
    name="fooQuery",
    queryString="select f from Foo f where f.status in (?1)"
)

Query q = entityManager.createNamedQuery("fooQuery");

List<String> listParameter = new ArrayList<>();
listParameter.add("NEW");
listParameter.add("OLD");

q.setParameter(1, listParameter); 
return q.getResultList(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T23:25:36.853

我建议不要为您的查询使用复合参数，而是将其单独拆分。不要指定`('NEW','OLD')`；`'NEW'`指定和的单独参数`'OLD'`。这可能会有所帮助。

当然，如果您的参数长度未定义，这可能会导致问题。

# asp.net - 为什么是 包含在以下示例中？

> ID：831994
> 
> 赞同：79
> 
> 时间：2009-05-06T21:58:55.500
> 
> 标签：asp.net, authentication, asp.net-membership, forms-authentication, authorization

`?`通配符代表未经身份验证的用户，而`*`代表所有用户，经过身份验证和未经身份验证。我的书展示了以下 URL 授权示例：

```
<authorization>
  <deny users="?" />
  <allow users="dan,matthew" />
  <deny users="*" />
</authorization> 
```

但是上面的代码是否与以下代码具有相同的效果：

```
<authorization>
  <allow users="dan,matthew" />
  <deny users="*" />
</authorization> 
```

`<deny users="?" />`或者作者是否出于某种原因也包括 规则？

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2009-05-06T22:14:49.223

ASP.NET 优先授予配置文件的访问权限。在潜在冲突的情况下，第一个发生的授权优先。所以，

```
deny user="?" 
```

拒绝匿名用户的访问。然后

```
allow users="dan,matthew" 
```

授予该用户访问权限。最后，它拒绝所有人访问。除了 dan,matthew 之外的所有人都被拒绝访问，这让所有人都震惊了。

编辑添加：正如@Deviant 指出的那样，拒绝未经身份验证的访问是没有意义的，因为最后一个条目也包括未经身份验证的内容。可以在以下位置找到讨论此主题的一个很好的博客条目：[Guru Sarkar 的博客](http://weblogs.asp.net/gurusarkar/archive/2008/09/29/setting-authorization-rules-for-a-particular-page-or-folder-in-web-config.aspx)

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-05-06T22:11:15.410

“在运行时，授权模块遍历允许和拒绝元素，从最本地的配置文件开始，直到授权模块找到适合特定用户帐户的第一个访问规则。然后，授权模块授予或拒绝访问一个 URL 资源，取决于找到的第一个访问规则是允许还是拒绝规则。默认授权规则是 。因此，默认情况下，除非另有配置，否则访问是允许的。

[MSDN](http://msdn.microsoft.com/en-us/library/8aeskccd(v=vs.100).aspx)上的文章

```
deny = * means deny everyone
deny = ? means deny unauthenticated users 
```

在您的第一个示例中，拒绝 * 不会影响 dan，matthew，因为前面的规则已经允许它们。

根据文档，您的 2 个规则集没有区别。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-06T22:13:07.247

示例 1 适用于使用表单身份验证的 asp.net 应用程序。这是 Internet 应用程序的常见做法，因为用户在针对某些安全模块进行身份验证之前是未经身份验证的。

示例 2 适用于使用 Windows 身份验证的 asp.net 应用程序。Windows 身份验证使用 Active Directory 对用户进行身份验证。这将阻止访问您的应用程序。我在 Intranet 应用程序上使用此功能。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-08-19T20:54:42.360

**看到这两个链接：**

**用于授权的拒绝元素（ASP.NET 设置架构）** [http://msdn.microsoft.com/en-us/library/vstudio/8aeskccd%28v=vs.100%29.aspx](http://msdn.microsoft.com/en-us/library/vstudio/8aeskccd%28v=vs.100%29.aspx)

**允许元素进行授权（ASP.NET 设置架构）：http:** [//msdn.microsoft.com/en-us/library/vstudio/acsd09b0%28v=vs.100%29.aspx](http://msdn.microsoft.com/en-us/library/vstudio/acsd09b0%28v=vs.100%29.aspx)

# windows-mobile - 如何在 Windows Mobile 上列出添加/删除程序

> ID：831995
> 
> 赞同：2
> 
> 时间：2009-05-06T21:58:56.903
> 
> 标签：windows-mobile

对于 Windows 桌面，添加/删除程序列表存在于注册表中（如此处所述 [）](https://stackoverflow.com/questions/802499/how-can-i-enumerate-list-all-installed-applications-in-windows-xp)。我想在 Windows Mobile (5+) 中列出相同的程序，但该位置似乎不存在注册表项。

搜索注册表没有产生任何积极的结果。

想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T06:51:24.223

看看[这里](http://windowsmobilepro.blogspot.com/2006/03/programmatically-find-out-all-programs.html)。对于较旧的平台，您可以查看注册表项：

```
\HKLM\SOFTWARE\Apps\Appname\ 
```

所有安装的应用程序都应该有“InstallDir”和“Instl”键。“Instl”的值必须为 1。

对于较新的平台，您需要使用[Configuration Service Provider](http://msdn.microsoft.com/en-us/library/ms889539.aspx)。

# oracle - 导入日期格式 mmddyyyy

> ID：831997
> 
> 赞同：1
> 
> 时间：2009-05-06T21:59:14.610
> 
> 标签：oracle, import, date, sql-loader

我必须使用这种格式将日期导入 oracle

03JUN2008

我之前见过的唯一一个例子是破折号，而这个没有。

我应该将它作为 varchar 引入并进行操作还是有其他方法？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T12:31:05.280

如果它是日期，则将其存储为日期，不要将其存储为 varchar 或任何类似的废话。

您计划如何“导入”数据？

如果您只是使用 sql 语句，则使用 TO_DATE

```
MWATSON@:> create table date_test ( x date );

Table created.

MWATSON@:> insert into date_test values ( to_date('03JUN2008','DDMONYYYY') );

1 row created.

MWATSON@:> select * from date_test;

X
-----------
03-Jun-2008

1 row selected.

MWATSON@DEV2:> 
```

如果您通过 SQL*Loader 导入，您可以在控制文件中指定日期格式

```
> cat date_test.ldr 
LOAD DATA
INFILE *
APPEND
INTO TABLE date_test
FIELDS TERMINATED BY '|'
(x DATE 'DDMONYYYY')
BEGINDATA
01JAN1999
> sqlldr mwatson control=date_test.ldr
....
Commit point reached - logical record count 1
> sqlplus 
....
MWATSON:> select * from date_test;

X
-----------
03-Jun-2008
01-Jan-1999

2 rows selected.

MWATSON@:> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-06T22:04:53.363

我不知道我是否完全明白你的意思，但我认为你可以简单地使用 TO_DATE、示例和详细信息来做到这一点

[http://www.techonthenet.com/oracle/functions/to_date.php](http://www.techonthenet.com/oracle/functions/to_date.php)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T20:31:31.453

为了得到一个好的答案，您必须提前考虑在 Oracle 如何在内部存储日期的背景下您将如何处理这些日期。

例如，如果你这样做

```
to_date('03JUN2008','DDMONYYYY') 
```

正如马修建议的那样，您真正得到的是：

```
03-JUN-2008 00:00:00 
```

为什么这会是个问题？假设您使用该日期针对一天结束进行测试，例如计算截至 2008 年 6 月 3 日（包括）提交的所有用户评论。如果您与上述日期进行比较，您最终将排除在该日期发表的所有评论，因为它们都将在 00:00 加时进行。

因此，在这种情况下，您将需要添加时间以使其真正结束一天，例如：

```
to_date('03JUN2008','DDMONYYYY')+0.999988425925926 
```

这会给你：

```
03-JUN-2008 23:59:59 
```

# coldfusion - ColdFusion 8.01 没有响应...如何调查问题所在？

> ID：831998
> 
> 赞同：4
> 
> 时间：2009-05-06T21:59:18.557
> 
> 标签：coldfusion, jrun

大约在 1 或 2 个月内，我在 Windows 2003 Server + IIS6 上的 32 位 CF8.01（带有累积修补程序 2）会不知何故冻结。

任务管理器报告 JRun 使用 ~600mb（远离 ~1.2gb 限制）。CPU 接近 0%。

我检查了/日志，最新更新的日志没有任何特别有趣的事情发生。

一旦我重新启动服务，一切都很好..

你会怎么做来调查什么是错的？

我在网上搜索，有人建议这是一种叫做 JRun 死锁的东西。我怎么知道我是否有其中之一？我该如何防止这样的问题？

谢谢！

**更新：** 我查看了 JRun 日志，它有很多以下条目：

> 无法从远程服务器初始化，JRun 服务器可能已关闭。返回连接超时的错误页面
> 
> jrISAPI 无法初始化 127.0.0.1:xxxxx 的代理
> 
> jrISAPI 无法从远程服务器初始化，JRun 服务器可能已关闭。

这是怎么回事！？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T22:14:43.857

你安装了[修补程序](http://kb2.adobe.com/cps/413/413aa6bb.html)吗？

```
 JRun engineering has fixed the JRun deadlock issue with the hot fix provided below. Follow the instructions to install the hot fix :

   1\. Download the hot fix JAR file (3K).
   2\. Copy the JAR file into the servers\lib directory (or "servers/lib" on Unix and Linux).
   3\. This hot fix is compatible with JRun4 Updater 6 (build 106363) and greater. You can verify your build number by one of the following options:
          * Open the JRun Management Console. Select Settings, then Version, to display the build number.
          * Run the following command at the command prompt:

            On Windows 2000, NT and Win9x:

            cd "{jrun-base-dir}\bin"
            jrun -info

            On Unix and Linux:

            cd $JRUN_HOME/bin
            jrun -info 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T23:48:44.287

伙计，先将您的jvm升级到最新版本。我知道我一直这么说，但我不能强调这一点。更新 jvm 可以修复错误和稳定的世界。我在这里概述了如何执行此操作，并提供了 cf 8 标准最新版本的链接。

[升级 ColdFusion 使用的 JRE](https://stackoverflow.com/questions/798491/upgrading-the-jre-used-by-coldfusion/798852#798852)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T19:47:33.670

您可能不想升级 JVM。这实际上取决于您的应用程序。cf 8.01 的默认 JRE 是 Java 1.6，但我们发现 1.5 对我们的应用程序运行效率更高，这是对象繁重的。垃圾收集机制更有效。

我们让 Mike Brunt 与我们一起解决这个问题，重置我们系统的活动线程数，更改 jrun 内存分配，并测试各种 JVM 以查看哪个更适合我们。

最新的 JVM 应该更擅长处理对象繁重的应用程序，但在我们的测试中，我们仍然发现 1.5 垃圾收集更适合我们的应用程序。

服务器调优有点像一门艺术，需要大量的反复试验，才能让您的环境适合您的应用程序。

（帖子太长，无法评论）**~~********