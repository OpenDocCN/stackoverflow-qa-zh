# StackOverflow 问答 000440000-000440999

# c# - Activator.CreateInstance 与私有密封类

> ID：440016
> 
> 赞同：12
> 
> 时间：2009-01-13T17:47:57.607
> 
> 标签：c#, reflection, ado.net

我正在尝试新建一个 LocalCommand 实例，它是 System.Data.SqlClient.SqlCommandSet 的私有类。我似乎能够很好地获取类型信息：

```
Assembly sysData = Assembly.Load("System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089");
localCmdType = sysData.GetType("System.Data.SqlClient.SqlCommandSet+LocalCommand"); 
```

但是当我尝试实例化它时 Activator.CreateInstance 会引发异常：

```
object item = Activator.CreateInstance(localCmdType,
  new object[] { commandText, parameters, num7, commandType }); 
```

System.MissingMethodException：找不到类型“System.Data.SqlClient.SqlCommandSet+LocalCommand”的构造函数。

构造函数参数与我在 Reflector 中看到的签名相匹配。新建一个带有内部 ctor 的私有类，支持不同的 CreateInstance 重载还是什么？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-13T17:55:40.710

我的第一个想法是获得`ConstructorInfo`using `ConstructorInfo constructorInfo = Type.GetConstructor()`，然后`constructorInfo.Invoke()`是。我怀疑这`Activator.CreateInstance`使得调用您通常无法访问的构造函数变得困难，尽管我不记得自己尝试过。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-13T19:52:31.380

我让它以这种方式工作：

```
using System;
using System.Reflection;

class Test
{
    public String X { get; set; }

    Test(String x)
    {
        this.X = x;
    }
}

class Program
{
    static void Main()
    {
        Type type = typeof(Test);

        ConstructorInfo c = type.GetConstructor(BindingFlags.NonPublic | BindingFlags.Instance, 
            null, new Type[] { typeof(String) }, null);

        Object o = c.Invoke(new Object[] { "foo" });
    }
} 
```

诀窍是专门使用构造函数`GetConstructor`而不是试图在`GetConstructors`. 去搞清楚。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-08-18T02:51:52.503

我可能回复得有点晚了，但我遇到了一个适合这个主题的类似问题。
我想使用`Activator.CreateInstance`并传递参数来实例化一个非公共构造函数。

```
public class Node
{
    string name;
    Node parent;

    protected Node(string name,Node parent)
    {
       this.name = name;
       this.parent = parent;
    }

    public static Node Create(string name,Node parent)
    {
       Node result = Activator.CreateInstance(
         type: typeof(Node),
         bindingAttr: BindingFlags.Instance  | BindingFlags.NonPublic,
         binder: null, //default binder
         args: new object[] { name, parent },
         culture: null);
       return (Node)result;
    }
} 
```

棘手的部分是绑定标志。

我的第一直觉是使用`BindingFlags.CreateInstance | BindingFlags.NonPublic`，但这导致抛出异常：*未找到类型“节点”的 MissingMethodException 构造函数。*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-03-21T17:13:27.463

诀窍是确保使用正确的`CreateInstance`重载：

```
// WRONG
... Activator.CreateInstance(
       type,
       BindingFlags.Instance
       | BindingFlags.NonPublic
    ); 
```

这将调用`params`重载，默认为`Instance | Public | CreateInstance`，并且您的绑定标志将作为参数传递给构造函数，给出 vague `MissingMethodException`。

此外，`Instance | Public | NonPublic`如果您不确定构造函数的可见性，请使用：

```
// right
... Activator.CreateInstance(
       type,
       BindingFlags.Instance
       | BindingFlags.Public
       | BindingFlags.NonPublic,
       null,
       new object[] { }, // or your actual constructor arguments
       null
    ); 
```

# c# - .NET 选项将视频文件流式传输为网络摄像头图像

> ID：440017
> 
> 赞同：3
> 
> 时间：2009-01-13T17:48:11.630
> 
> 标签：c#, .net, video-streaming, webcam, broadcast

我有兴趣开发一个应用程序，该应用程序允许我从 xml 构建视频列表（包含视频标题、持续时间等）并将该列表作为我的网络摄像头流播放。意思是，如果我要访问 ustream.tv，或在 live Messenger 上激活我的网络摄像头，我的视频播放列表将注册为我的活动网络摄像头。

有没有人在这方面有经验，也许有一些建议可以提供？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T12:57:22.373

如果您希望这样做，以便第三方应用程序将您的视频视为标准网络摄像头流（听起来非常像您），那么唯一的方法就是编写一个虚拟网络摄像头驱动程序。然后，您将能够“播放”您的视频内容作为网络摄像头的流输出。这将涉及编写代码来解码视频内容 - 可能使用 DirectShow - 然后将原始视频流复制到网络摄像头的输出流。您需要编写自定义 DirectShow 渲染器过滤器或使用示例采集器来访问原始的解码帧。

这当然是一个可以实现的目标，但考虑到 DirectShow 和驱动程序开发都有相当陡峭的学习曲线，这并不是特别容易。您可以为此使用多种不同的驱动程序模型，具体取决于您的目标。最简单的方法是创建一个 Video for Windows (VfW) 虚拟相机驱动程序。这种方法的巨大好处是驱动程序将完全是用户模式代码 - 通常更容易调试和编写。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T20:30:28.057

我在这方面没有太多经验，但我会首先查看[DirectShow API 的 MSDN 文档](http://msdn.microsoft.com/en-us/library/ms783323(VS.85).aspx)。

还存在几个 .NET 包装器库：

*   [托管 DirectShow](http://kristoffer.vinther.name/projects/managed-directshow/)
*   [DirectShow.NET](http://www.codeproject.com/KB/directx/directshownet.aspx)
*   [另一个 DirectShow.NET](http://directshownet.sourceforge.net/)

# java - 将 Java 包添加到 GWT

> ID：440018
> 
> 赞同：10
> 
> 时间：2009-01-13T17:48:14.627
> 
> 标签：java, gwt, packages

我已经尝试过搜索，但无法找到一个明确的方法来将您自己的包添加到 GWT 项目中。

我的树结构如下所示：

```
-com.mycompany
  -public
    MyApplication.html
  MyApplication.gwt.xml

-com.mycompany.client
  MyApp.java

-com.mycompany.gui
  TableLayout.java 
```

我在那里看到的答案说要添加相对于 gwt.xml 文件的根目录的包，如下所示：

```
<module>
  <inherits name="com.google.gwt.user.User" />
  <entry-point class="com.mycompany.client.MyApp" />
  <source path="client" />
  <source path="gui" />
</module> 
```

然后它抱怨：

```
Unable to find type 'com.technicon.client.MyApp'
   Hint: Previous compiler errors may have made this type unavailable
   Hint: Check the inheritance chain from your module; it may not be inheriting a required module or a module may not be adding its source path entries properly 
```

谁能告诉我我做错了什么以及如何解决这个问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-03-11T17:27:24.980

尽管正如@rustyshelf 指出的那样，gwt 会`client.*`自动转换所有内容，但有时您会希望将内容保留在客户端包之外（在多个项目中重用它们可能就是其中之一），为此解决方案仍然在于使用该`source`元素将其他包添加到流程中。

现在有一个技巧，您必须决定是要移动`gwt.xml`配置文件还是需要创建一个新配置文件。

特别是对于您的情况（两个包在包中共享一个根目录，com.mycompany），您可以将`<project_name>.gwt.xml`文件移动到最常见的包，然后将新包添加为源（并保留在`<source path="client"/>`那里）因此使您的文件看起来像：

```
<source path="client"/>
<source path="gui"/> 
```

另一方面，如果包不共享任何根，只需创建一个`*.gwt.xml`仅包含源元素的新文件，并将其放在要添加的子包的父包上，即：

```
<module>
   <source path=""/>
</module> 
```

请注意，如果您需要为嵌套的子包提供编译访问权限，请使用`/`类似的分隔符来分隔它们`"admin/client"`

希望这可以帮助您重回正轨并以最佳方式组织您的代码。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T21:19:57.287

您可以去掉两条源路径行，因为默认情况下，GWT 将拾取与根目录相关的任何内容，并且像您一样在客户端包中。您还需要将您的 gui 包移动到您的客户端包中，因此它将变为：

```
-com.mycompany
  -public
    MyApplication.html
  MyApplication.gwt.xml

-com.mycompany.client
  MyApp.java

-com.mycompany.client.gui
  TableLayout.java

<module>
  <inherits name="com.google.gwt.user.User" />
  <entry-point class="com.mycompany.client.MyApp" />
</module> 
```

假设您的 MyApp.java 是一个实际的入口点，那么这应该可以正常工作。

需要注意的另一件事是，您不能使用不属于 GWT JRE Emulation 库的 java 类，如果这样做，您的项目将无法编译。不过，您应该得到非常具体的错误。例如，如果没有模拟它们，则不能使用 java.math.BigDecimal 之类的库类。您创建的所有自己的类都可以使用。

# visual-studio - Visual Studio（使用 Team Foundation Server） - 如何返回“解决”屏幕？

> ID：440027
> 
> 赞同：0
> 
> 时间：2009-01-13T17:50:47.820
> 
> 标签：visual-studio, visual-studio-2005

我开始在合并中解决冲突，然后不得不退出进行设置。现在我看不到任何方法可以回到愚蠢的冲突解决窗口。如果我再次尝试合并，它只会给我一堆关于我已经拥有的待处理合并的警告？这是在 Visual Studio 2005 中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T21:25:00.507

如果您取消合并，合并将被回滚。您可以从 Visual Studio 命令行运行 tf merge 吗？

# java - 用越来越流行的语言重新创建线程和并发知识

> ID：440036
> 
> 赞同：7
> 
> 时间：2009-01-13T17:52:42.353
> 
> 标签：java, python, ruby, multithreading, concurrency

我主要是一名 Java 开发人员，并且一直在阅读大量有关线程和并发性的深入著作。许多非常聪明的人（Doug Lea、Brian Goetz 等）撰写了有关这些主题的书籍，并为 Java 的新并发库做出了贡献。

当我开始更多地了解 Python、Ruby 和其他语言时，我想知道：是否必须为这些语言重新创建所有这些工作？

是否会有“Python 的 Doug Lea”或“Ruby 的 Brian Goetz”对这些语言的并发特性做出同样强大的贡献？

**在 Java 中完成的所有这些并发工作是否必须为未来的语言重新创建？** 或者 Java 所做的工作是否会为未来的语言建立教训和指导？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T18:04:08.120

并发编程的基本原理在 Java 之前就已经存在，并且在您正在谈论的那些 Java 书籍中进行了总结。java.util.concurrent 库类似地衍生自先前关于并发编程的代码和研究论文。

但是，一些实现问题是 Java 特有的。它有一个指定的内存模型，Java 中的并发实用程序是根据它的具体情况量身定制的。通过一些修改，可以将它们移植到具有不同内存模型特征的其他语言/环境。

因此，您可能需要一本书来教您其他语言中并发工具的规范用法，但它不会重新发明轮子。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-14T08:12:45.737

Keep in mind that threads are just one of several possible models for dealing with "concurrency". Python, for example, has one of the most advanced asynchronous (event based) non-threaded models in [Twisted](http://twistedmatrix.com/trac/). Non-blocking models are quite powerful and are used as alternatives to threads in most of the highest scaling apps out there (eg. nginx, lighttpd).

Your assumption that other popular languages need threads may simply be a symptom of a java centric (and hence thread-centric) world view. Take a look at the [C10K](http://www.kegel.com/c10k.html) page for a slightly dated but highly informative look at several models for how to handle large volumes of concurrent requests.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-20T21:41:01.740

我认为答案是肯定的和否定的。Java 可以说具有最常用的命令式语言（Java、C++、Python、Ruby 等）中定义最明确的内存模型和执行语义。从某种意义上说，其他语言要么完全缺乏这一点，要么正在迎头赶上（如果考虑到线程模型的不成熟甚至有可能的话）。

C++ 可能是一个值得注意的例外——它一直在为 C++0x 走同样的路，并且在我的印象中可能已经超越了 Java 模型的当前状态。

我说不，因为社区不是孤立的。许多从事这方面工作的人（至少从指导的角度来看，如果不是从规范的直接角度来看的话）涉及一种以上的语言。因此，在从事 JMM 工作的人和从事 C++0x 规范工作的人之间存在很多串扰，因为他们本质上是使用许多相同的底层驱动程序解决相同的问题（来自底层的硬件人员和底层的用户）最佳）。而且我很确定 JVM / CLR 阵营之间在某种程度上也存在交叉对话。

正如其他人所提到的，还有其他的并发模型：Erlang 和 Scala 中的演员，Clojure 中的代理/STM，FP 在 F#、Scala、Haskell 中的崛起，CLR 领域中的 CCR 和 PLINQ 东西等等。这是一个激动人心的时刻吧现在！我认为我们可以使用尽可能多的并发专家...... :)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-14T08:47:34.280

This is not flame bait, but IMHO Java has one of the simpler and more restricted models for threading and concurrency available. That's not necessarily a bad thing, but at the level of granularity it offers it means that the perspective it gives you of what concurrency is and how to deal with it is inherently limited if you have a "java centric" view (as someone else put it).

If you're serious about concurrency, then it's worth exploring other languages precisely *because* different models and idioms exist.

Some of the hottest areas are lock-free programming (you'll see a lot of it, but often done badly, in C++) and functional programming (which has been around for a while but arguably, is becoming increasingly relevant. A prime example in the case of concurrency is probably Erlang).

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-20T18:15:45.590

[Kamaelia](http://www.kamaelia.org/Home)是一个项目（我开始并继续工作），它的具体目标是使并发成为您想要使用的工具，而不是使用起来很痛苦。实际上，这意味着它主要是具有消息传递模型的无共享模型（基于 Occam 和 Unix 管道的世界观）。

该目标的基础是希望使普通开发人员易于使用并发，从而使他们免受由多种并发方法引起的更严重的问题。（有很多关于幻灯片的演示文稿解释了为什么以及如何出现）

此外，它为您必须共享数据的情况提供了一个简单的软件事务内存模型，并使用了一个特意简单的 API。

Kamaelia 的主要实现是在 python 中，在 Ruby 和 C++ 中有一个玩具实现。其他人已将底层方法移植到 E 和 Java。（尽管 Java 人已经消失了）（玩具实现是健全性检查，如果需要重新转换为本地习语，这些想法可以在其他语言中工作）

也许您的问题不应该是“这些语言能学到什么”，而应该是“Java 社区可以从别处学到什么？”。许多学习 Python 的人都是从其他地方移民过来的语言，他们将他们对其他语言的知识带到了一起，所以从我所在的位置来看，Python 似乎已经从其他语言中寻找灵感。

选择一些具体的东西，例如，[这个说和写应用程序](http://www.kamaelia.org/SpeakAndWrite)——它是一种教小孩子读写的工具，基于笔输入、手写识别和语音合成——使用几十个并发子系统，以可接受的速度运行在单核机器上，很容易在多核机器上运行。然而，并发子系统数量的原因与“想让应用程序并行”无关，而更多地与“如何使应用程序更易于编写、扩展和维护？”有关。**它最终令人尴尬地平行的事实是次要的好处。**

有一个完整的教程 - [Pragmatic Concurrency](http://www.kamaelia.org/PragmaticConcurrency) - 从首页链接。（笔记、幻灯片、视频和代码包）

该模型可以改进，欢迎提出建议——如果我们都“停止”尝试制造更好的工具，生活会很无聊——但忽略已经存在的东西似乎有点……狭隘。如果这看起来有点苛刻，请看看[今天的呆伯特](http://www.dilbert.com/fast/2010-01-20/)。

# vba - 是否有允许复制范围和应用排序/过滤器的本机 excel 类？

> ID：440037
> 
> 赞同：1
> 
> 时间：2009-01-13T17:52:58.610
> 
> 标签：vba, excel

我有一个范围，我想使用 vba 任意排序和过滤。但是，我不希望它影响工作表。我想基本上将范围复制到一些支持过滤和排序的本机类中（所以我不必重新发明轮子）并使用该类将结果返回给调用代码。

我可以为此使用任何课程吗？ListObject 看起来最有希望，但它似乎需要绑定到工作表范围才能正常工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T00:35:58.500

您可以使用记录集。以下是一些注意事项：

```
'Reference: Microsost ActiveX n.n Object Library '

Dim rs As ADODB.Recordset
Dim cn As ADODB.Connection

'From: http://support.microsoft.com/kb/246335 '

strFile = Workbooks(1).FullName
strCon = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & strFile _
    & ";Extended Properties=""Excel 8.0;HDR=Yes;IMEX=1"";"

Set cn = CreateObject("ADODB.Connection")
Set rs = CreateObject("ADODB.Recordset")

cn.Open strCon

'Must have client-side cursor for sorting '
rs.CursorLocation = adUseClient

'Substitute a name range for [Sheet1$] '
'or include a range of cells : [Sheet1&A1:C7] '

strSQL = "SELECT * FROM [Sheet1$] " _
       & "WHERE TransID>2 ORDER BY MyTime"

rs.Open strSQL, cn, 3, 3

rs.Filter = "TransID=3"
rs.Sort = "Mytime"

'Write out to another sheet '
Worksheets(2).Cells(2, 1).CopyFromRecordset rs 
```

您可能会发现这个线程很有趣：[用 VBA 同步两个列表](https://stackoverflow.com/questions/226978/syncing-two-lists-with-vba)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T07:18:32.837

如果您想读取和解析复杂的数据集，您可以使用`Microsoft ActiveX Data Objects Recordset 2.8 Library`. 有了它，您可以将数据读入记录集，然后过滤、排序、追加、删除并将其传递给其他功能。

我经常使用它，因为我经常需要操作和显示大型数据集。如果它在记录集中，我可以一遍又一遍地使用相同的操作和演示程序。

有关将数据放入记录集中的示例，请参阅[合并 Excel 表格...。](https://stackoverflow.com/questions/228318/merge-excel-sheets-using-vba#228674)将数据放入记录集中后，请使用 r.filter = "ColumnA = 1" 或 r.sort = "ColumnC, ColumnA"。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T17:36:49.203

原来我可以创建一个记录集来做到这一点。与 Remou 的回答不同，尽管我们不必在工作表上调用重量级的 odbc 进程。

以下函数（改编自 Mark Nold 的回答）将从提供的范围创建一个记录集。它假定列标题位于所提供范围的第一行。这可以变得更强大，但它是一个很好的起点

```
Function CreateRecordSet(rSource As range) As Recordset
    ' Constants
    Const MAX_CHARS = 1200

    ' Declarations
    Dim rs As Recordset
    Dim c As Long
    Dim r As Long
    Dim colCount As Long
    Dim rowCount As Long
    Dim fldName As String

    colCount = rSource.Columns.Count
    rowCount = rSource.rows.Count

    ' Setup record set
    Set rs = New Recordset
    r = 1 ' assume first row contains headers
    For c = 1 To colCount
        fldName = rSource.Cells(r, c).Value
        rs.Fields.Append fldName, adVarChar, MAX_CHARS
    Next c

    ' Fill record set
    rs.Open
    r = 2 ' skip header row
    For r = 2 To rowCount
        rs.AddNew
        Debug.Print "row "; r & " of " & rowCount & " created"
        For c = 1 To colCount
            rs.Fields(c - 1) = CStr(rSource.Cells(r, c).Value)
            Debug.Print "-- row(" & r; "): added col " & c & " of " & colCount
        Next c
    Next r

    Set CreateRecordSet = rs
End Function
Sub TestCreateRecordSet()
    Dim r As range
    Dim rs As Recordset

    Set r = range("A1:B4")
    Set rs = CreateRecordSet(r)
End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T22:41:14.643

您想使用 Range 类（就像 CasperOne 所说的那样）。这是一些示例 VBA 代码

`Function SortAndFilter(rSource As Range) As Range`

 ````
Dim rResult As Range
Dim vaTemp As Variant
Dim wsTemp As Worksheet
Dim wbTemp As Workbook

vaTemp = rSource.Value

Set wbTemp = Workbooks.Add
Set wsTemp = wbTemp.Sheets(1)

Set rResult = wsTemp.Range("A1").Resize(UBound(vaTemp, 1), UBound(vaTemp, 2))
rResult.Value = vaTemp

rResult.Sort rResult.Cells(1), xlDescending

Set SortAndFilter = rResult 
```

End Function

Sub Testit()

```
Dim rTest As Range

Set rTest = SortAndFilter(Selection)

'Do stuff with your range object

rTest.Parent.Parent.Close False 'close temp workbook 
```` 

`End Sub`

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-13T18:05:51.377

为什么不将数据复制到一个新的隐藏工作表，在那里执行排序/过滤，然后在完成后将数据复制回来？

# .net - 是否可以重用 .NET WinForms Form 对象？

> ID：440051
> 
> 赞同：7
> 
> 时间：2009-01-13T17:56:19.803
> 
> 标签：.net, winforms

关闭窗口后，是否有可能并建议重用该窗口的 F​​orm 实例以再次显示同一窗口？或者，当您将显示一个窗口时，是否需要或建议始终创建一个全新的类实例。

这真正归结为是否在同一个对象上多次调用 Show() 或 ShowDialog() 是否是一个好主意，只要窗口在两者之间关闭。

如果不建议这样做，那么对根本原因的解释也将不胜感激。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T18:04:01.597

不，也不。

对 Close 的调用最终会调用 Dispose，并且该对象被视为已释放。

*隐藏*表单然后再次显示没有问题，但是关闭它是绝对不行的，因为状态在处理后是未定义的（好吧，状态被处理了，但是使用它就像使用某物一样那是未定义的）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T19:25:03.480

在我看来，这个想法违反了三个原则：（1）避免过早优化，（2）最小意外原则，以及（3）数据与用户界面的耦合过于紧密。

似乎您正在优化时间，但是多少时间？如果显示有问题的表单非常耗费时间或资源，那么，是的，按照您的建议去做可能不是一件坏事。但一般来说，当用户界面不再需要它可见时创建和销毁它的模式是经过时间考验的做法。此外，当一个窗口不可见时，它仍然会占用内存。如果该窗口依赖于文件句柄或数据库连接之类的东西，那就是潜在的错误来源。

*最小意外原则意味着以预期*的方式为系统的所有用户做事，包括最终用户、维护人员和开发人员。您所描述的模式是不寻常的，因此可能会导致比其价值更多的问题。

避免这种做法的另一个原因是它违反了广泛使用的模型-视图-控制器设计模式的精神，它将对象本身与显示或修改对象的任务分开。使用这种设计模式有很好的理由，即使你不这样做，它背后的理念也是好的。对象的存在通常不依赖于某个用户界面对象，因此应该与用户界面分开存在。例如，无论是否显示与该客户相关的窗口，都存在客户对象。将数据与用户界面对象过于紧密地耦合通常会导致代码脆弱、难以更改。

如果您确实决定实现这一点，我建议您不要创建太多这些可隐藏的窗口，并尽量将它们保持在最低限度，在这种情况下，Michael Buen 的代码似乎是解决问题的一个优雅的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-14T02:41:45.453

当您处理 Windows 窗体时，总是创建新实例。将大量隐藏状态打包到表单中并在第 2 次、第 3 次或第 N 次调用时突然创建不可预见的用户体验是非常容易的。根据我的经验，随着更多控件和演示代码添加到表单中，这种效果会显着增加。

将表单实例重用与纳粹级别的 MVC 分离相结合，您需要一个主要的 WTF 时刻，通常是在功能测试期间。

# datetime - 将 12 小时日期/时间转换为 24 小时日期/时间

> ID：440061
> 
> 赞同：11
> 
> 时间：2009-01-13T17:59:28.440
> 
> 标签：datetime, text-files

我有一个制表符分隔的文件，其中每条记录都有一个 12 小时格式的时间戳字段：

> mm/dd/yyyy hh:mm:ss [上午|下午]。

我需要快速将这些字段转换为 24 小时制：

> mm/dd/yyyy HH:mm:ss。

最好的方法是什么？我在 Windows 平台上运行，但除了常用的 Windows 工具之外，我还可以访问 sed、awk、perl、python 和 tcl。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-13T18:10:27.077

使用 Perl 和手工制作的正则表达式而不是 strptime 等工具：

```
#!/bin/perl -w
while (<>)
{
    # for date times that don't use leading zeroes, use this regex instead:
    # (?:\d{1,2}/\d{1,2}/\d{4} )(\d{1,2})(?::\d\d:\d\d) (AM|PM)
    while (m%(?:\d\d/\d\d/\d{4} )(\d\d)(?::\d\d:\d\d) (AM|PM)%)
    {
        my $hh = $1;
        $hh -= 12 if ($2 eq 'AM' && $hh == 12);
        $hh += 12 if ($2 eq 'PM' && $hh != 12);
        $hh = sprintf "%02d", $hh;
        # for date times that don't use leading zeroes, use this regex instead:
        # (\d{1,2}/\d{1,2}/\d{4} )(\d{1,2})(:\d\d:\d\d) (?:AM|PM)
        s%(\d\d/\d\d/\d{4} )(\d\d)(:\d\d:\d\d) (?:AM|PM)%$1$hh$3%;
    }
    print;
} 
```

这非常麻烦 - 但也可能每行转换多个时间戳。

请注意，将 AM/PM 转换为 24 小时制并非易事。

*   上午 12:01 --> 00:01
*   下午 12:01 --> 12:01
*   上午 01:30 --> 01:30
*   下午 1:30 --> 13:30

现在测试：

```
perl ampm-24hr.pl <<!
12/24/2005 12:01:00 AM
09/22/1999 12:00:00 PM
12/12/2005 01:15:00 PM
01/01/2009 01:56:45 AM
12/30/2009 10:00:00 PM
12/30/2009 10:00:00 AM
!

12/24/2005 00:01:00
09/22/1999 12:00:00
12/12/2005 13:15:00
01/01/2009 01:56:45
12/30/2009 22:00:00
12/30/2009 10:00:00 
```

* * *

*补充*：

在[什么是在 JavaScript 中转换 AM/PM 时间和 24 小时时间的简单方法中，为转换](https://stackoverflow.com/questions/508752/whats-a-simple-way-to-convert-between-an-am-pm-time-to-24-hour-time-in-javascrip)提供了另一种算法：

```
$hh = ($1 % 12) + (($2 eq 'AM') ? 0 : 12); 
```

只有一个测试......可能更整洁。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-12-08T16:04:40.380

这是python中的单行代码：

```
time.strftime('%H:%M:%S', time.strptime(x, '%I:%M %p')) 
```

例子：

```
>>> time.strftime('%H:%M:%S', time.strptime('08:01 AM', '%I:%M %p'))
'08:01:00'
>>> time.strftime('%H:%M:%S', time.strptime('12:01 AM', '%I:%M %p'))
'00:01:00' 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T18:07:30.140

以某种方式使用 Python 的 datetime 模块：

```
import datetime

infile = open('input.txt')
outfile = open('output.txt', 'w')
for line in infile.readlines():
  d = datetime.strptime(line, "input format string")
  outfile.write(d.strftime("output format string") 
```

未经测试的代码，没有错误检查。它还在开始之前读取内存中的整个输入文件。（我知道有很多改进的空间，比如声明......如果有人喜欢添加一些东西，我会将其设为社区 wiki 条目）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-23T05:36:43.243

要仅转换小时字段，在 python 中：

```
def to12(hour24):
    return (hour24 % 12) if (hour24 % 12) > 0 else 12

def IsPM(hour24):
    return hour24 > 11

def to24(hour12, isPm):
    return (hour12 % 12) + (12 if isPm else 0)

def IsPmString(pm):
    return "PM" if pm else "AM"

def TestTo12():    
    for x in range(24):
        print x, to12(x), IsPmString(IsPM(x))

def TestTo24():
    for pm in [False, True]:
        print 12, IsPmString(pm), to24(12, pm)
        for x in range(1, 12):
            print x, IsPmString(pm), to24(x, pm) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T18:34:22.253

这个想法可能太简单了，但是为什么不将其导入excel，选择整列并更改日期格式，然后重新导出为制表符分隔文件呢？（我没有对此进行测试，但这对我来说听起来很合乎逻辑:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T08:49:47.980

在这里，我已将 24 小时制转换为 12 小时制。尝试使用此方法解决您的问题。

```
 DateFormat fmt = new SimpleDateFormat("yyyyMMddHHssmm");

    try {
        Date date =fmt.parse("20090310232344");

        System.out.println(date.toString());
        fmt = new SimpleDateFormat("dd-MMMM-yyyy hh:mm:ss a ");
        String dateInString = fmt.format(date);
        System.out.println(dateInString);

    } catch (Exception e) {
        System.out.println(e.getMessage());
    } 

  RESULT:  
   Tue Mar 10 23:44:23 IST 2009   
   10-March-2009 11:44:23 PM 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-09-19T18:27:37.593

在 Python 中：将 12 小时时间转换为 24 小时时间

```
import re
time1=input().strip().split(':')
m=re.search('(..)(..)',time1[2])
sec=m.group(1)
tz=m.group(2)  
if(tz='PM'):
     time[0]=int(time1[0])+12
     if(time1[0]=24):
            time1[0]-=12
     time[2]=sec         
else:
     if(int(time1[0])=12):
            time1[0]-=12
     time[2]=sec

print(time1[0]+':'+time1[1]+':'+time1[2]) 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-13T18:04:33.843

由于您有多种语言，我将建议以下算法。

1 检查时间戳是否存在“PM”字符串。

2a 如果 PM 不存在，只需将时间戳转换为日期时间对象并继续。

2b 如果 PM 确实存在，则将时间戳转换为日期时间对象，加上 12 小时，然后继续。

# python - 使父函数返回 - 超级返回？

> ID：440063
> 
> 赞同：4
> 
> 时间：2009-01-13T17:59:40.953
> 
> 标签：python, class, function, return, parent

在函数中的每个后续步骤之后我需要执行检查，因此我想将该步骤定义为函数中的函数。

```
>>> def gs(a,b):
...   def ry():
...     if a==b:
...       return a
...
...   ry()
...
...   a += 1
...   ry()
...
...   b*=2
...   ry()
... 
>>> gs(1,2) # should return 2
>>> gs(1,1) # should return 1
>>> gs(5,3) # should return 6
>>> gs(2,3) # should return 3 
```

那么我如何让 gs 从 ry 中返回“a”？我想过使用 super 但认为这仅适用于课程。

谢谢

有点混乱......如果a == b，我只想返回a。如果 a!=b，那么我不希望 gs 返回任何东西。

**编辑**：我现在认为[装饰器](http://muharem.wordpress.com/2006/10/19/python-decorator-mini-study-part-2-of-3/)可能是最好的解决方案。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T18:02:06.750

你的意思是？

```
def gs(a,b):
    def ry():
        if a==b:
            return a
    return ry() 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T02:13:17.740

当您在函数中提到“步骤”时，您似乎想要一个生成器：

```
def gs(a,b):
  def ry():
    if a==b:
      yield a
  # If a != b, ry does not "generate" any output
  for i in ry():
    yield i
  # Continue doing stuff...
  yield 'some other value'
  # Do more stuff.
  yield 'yet another value' 
```

（从 Python 2.5 开始，生成器现在也可以充当协程，使用[新的 yield 语法](http://docs.python.org/reference/expressions.html#yield-expressions)。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T21:37:48.953

> 有点混乱......如果a == b，我只想返回a。如果 a!=b，那么我不希望 gs 返回任何东西。

然后检查：

```
def gs(a,b):
    def ry():
        if a==b:
            return a
    ret = ry()
    if ret: return ret
    # do other stuff 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-18T20:31:03.280

如果 a 和 b 最终相同，这应该允许您继续检查状态并从外部函数返回：

```
def gs(a,b):
    class SameEvent(Exception):
        pass
    def ry():
        if a==b:
            raise SameEvent(a)
    try:
        # Do stuff here, and call ry whenever you want to return if they are the same.
        ry()

        # It will now return 3.
        a = b = 3
        ry()

    except SameEvent as e:
        return e.args[0] 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T18:02:45.360

你显式地返回 ry() 而不是仅仅调用它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-28T16:58:32.473

我有一个类似的问题，但通过简单地改变调用顺序来解决它。

```
def ry ()
    if a==b 
        gs() 
```

在某些语言（如 javascript）中，您甚至可以将函数作为变量传递给函数：

```
function gs(a, b, callback) {
   if (a==b) callback();
}

gs(a, b, ry); 
```

# javascript - 是否有任何不显眼的方法可以连接到触发器的 jQuery 方法？

> ID：440068
> 
> 赞同：2
> 
> 时间：2009-01-13T18:01:22.213
> 
> 标签：javascript, jquery

我想知道是否有任何不显眼的方式来挂钩 attr、data、css 等方法并调用自定义触发器？

理想情况下，我可以这样做：

```
$(".friend a").bind("attr.changed", changed /* data */, function(e) {
    alert("The " + changed.attribute + " attribute changed from " + changed.from + " to " + changed.to + "!");
});

$(".friend").append(
  $("<a/>").
    attr("href", "#").
    html("Friend 1").
    click(function() { alert('I was clicked!'); }); // creates the element, doesn't execute since element didn't exist

$(".friends a").each(function() {
  var $this = $(this);
  $this.attr("rel", "friend"); // triggers "attr.changed"
}); 
```

理想情况下，这将能够在任何元素上触发，并将对象中的 attr 更改、from 和 to 传递给每个 jQuery 方法内部的触发器调用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T19:51:42.177

编写一个“钩子”函数非常容易：

```
function hook(original, wrapper) {
    return function() {
        wrapper.apply(this, arguments);
        return original.apply(this, arguments);
    }
} 
```

在调用原始函数本身之前，`wrapper`将使用与函数相同的参数调用您提供的函数。`original`

使用示例：

```
$.fn.attr = hook($.fn.attr, function(attribute, value) {
    alert('attribute: '+attribute+', value: '+value);
});
$('a.pie').attr('href', 'http://blueberry.pie');
// An alert says "attribute: href, value: http://blueberry.pie" 
```

（旁注：让您`wrapper`取消对`original`函数的调用也将是一个简单的扩展，但这比您想要的功能更多。）

您可以直接使用它来做您想做的事情，或者您可以使该`wrapper`函数仅触发您以标准 jquery 方式侦听的自定义 jquery 事件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T15:36:06.640

事实证明这个hack会起作用；我使用数据的内置 setData 触发器（以及前面提到的“挂钩”在 jQuery 的 attr 和 removeAttr 上添加功能）在 jQuery 对象上的数据对象中复制 attrs。虽然它有点脏，但我获得了挂钩数据、attr 以及跟踪键/值对的任何其他 jQuery 方法（如果已编写）的数据更改触发器的功能。

```
(function($) {
  var binder = function(e, dataKey, dataValue) {
    return (function(dataKey, dataValue, self) {
      var $this = $(self),
          oldValue = $this.data(dataKey),
          newValue = dataValue,
          passed = {
            attr: dataKey,
            from: oldValue,
            to:   newValue
          };

      var isAttribute = !!($this.data(dataKey + "-attribute"));

      if(oldValue !== newValue) { 
        var attrPrefix = isAttribute ? "attr-" : "";
        $this.trigger(attrPrefix + dataKey + "-changed", passed); 
        $this.trigger(attrPrefix + "data-changed", passed); 
      }
    })(dataKey, dataValue, this);
  };

  var hook = function(original, wrapper) {
    return function() {
      wrapper.apply(this, arguments);
      return original.apply(this, arguments);
    };
  };

  $.fn.attr = hook($.fn.attr, function(attr, val) {
    if(val) {
      $(this).data(attr + "-attribute", true);
      $(this).data(attr, val);
    }
  });

  $.fn.removeAttr = hook($.fn.removeAttr, function(attr) {
    $(this).removeData(attr + "-attribute");
    $(this).removeData(attr);
  });

  $.fn.observeData = function() {
    $(this).bind("setData", binder);
  };
})(jQuery); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T19:47:28.097

这是`attr()`对您所说的内容的修改。

```
(function(attr) {

    jQuery.attr = function(elem, name, value) {
        var current = attr(elem, name, undefined); // read current value
        var retval = current;

        if (value !== undefined) { // writing
            retval = attr(elem, name, value); // call original
            jQuery.event.trigger('attr.changed', {
                attribute: name,
                from: current,
                to: value
            }, elem)
        }

        return retval; // return original
    }

})(jQuery.attr); 
```

用法应该是：

```
$(".friend a").bind("attr.changed", function(e, changed) {
    alert("The " + changed.attribute + " attribute changed from " + changed.from + " to " + changed.to + "!");
});

$(".friends a").attr("class", "foo"); // triggers alert 
```

我不相信这`css()`是可能的，因为该`.style`属性不能触发事件。`data()`我不知道。

注意我不宽恕它的使用，这只是学术上的努力。`attr()`为了填充`from`事件参数的属性，您想要的内容会导致性能损失。我们必须在写入新值之前读取旧值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T18:33:29.183

jQuery 中目前没有此事件。

[livequery 插件](http://plugins.jquery.com/project/livequery)可能会提供您需要的东西，例如更改类。基本上选择器被保存，然后在 DOM 中改变选择器影响的任何更改然后调用传递的函数等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T18:48:36.267

为什么不使用最简单的方法：

```
jQuery.fn.changeAttr = function(attrName,attrValue) {
  return this.each(function(){
    this.attr(attrName,attrValue);
    alert('The att: '+attrName+ ' is now '+attrValue);
  });
}; 
```

然后只是：

```
$('.friends a').changeAttr('rel','friend') 
```

抱歉，如果它不起作用，我不记得确切的扩展 jQuery 的语法。

# c++ - C++ 的数据库访问库

> ID：440069
> 
> 赞同：8
> 
> 时间：2009-01-13T18:01:28.780
> 
> 标签：c++, windows, database, linux, unmanaged

## 背景：

我有一个用本机 C++ 编写的应用程序，它使用 wxWidgets 工具包的 wxODBC 数据库访问库，该库正在从所有未来版本的 wxWidgets中[删除。](http://wiki.wxwidgets.org/ODBC)我需要用另一种支持下面概述的假设和约束的数据库访问方法来替换它。我不要求替换使用本机 DBMS API 或 ODBC，但它必须满足下面列出的限制。

## 假设/约束

*图书馆必须：*

*   支持本机（即非托管）C++
*   32 位 Windows 2000/XP/2003
*   视觉工作室 2005
*   微软 SQL Server 2000 和 2005
*   甲骨文 9 和 10
*   运行时性能大于或等于 wxODBC
*   支持多个 DBMS 的单个程序员 API（例如，不想为使用不同的 DBMS 编写不同的代码）

*不错但可选：*

*   64 位 Windows 操作系统
*   32 位和/或 64 位 Linux 操作系统
*   微软 SQL 服务器 2008
*   甲骨文 11
*   MySQL
*   任何额外的 DBMS
*   视觉工作室 2008
*   开源
*   运行时性能接近或等于原生 DBMS API

## 问题：

**有哪些好的库（免费、开源或付费）可以从一个 API（包括 Oracle 和 Microsoft SQL Server）支持多个 DBMS，并且可以从本机 C++ 中使用？**

请描述您过去在给定库方面的任何经验 - 好的或坏的 - 以及您为什么推荐或反对给定库，特别是关于上述假设和限制。

## 也可以看看：

[https://stackoverflow.com/questions/74141/good-orm-for-c-solutions](https://stackoverflow.com/questions/74141/good-orm-for-c-solutions)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T18:20:14.403

我使用 SQLAPI++。很值得一看。

[http://www.sqlapi.com/](http://www.sqlapi.com/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T18:07:29.343

图书馆是[http://otl.sourceforge.net/](http://otl.sourceforge.net/)

我的一个雇主使用它。

我无法告诉您它的性能与 wxODBC 相比如何，但它可能符合您的要求。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-10-10T07:31:25.850

您可以使用 SOCI [http://soci.sourceforge.net](http://soci.sourceforge.net)或 Wt::Dbo、[http](http://www.webtoolkit.eu) ://www.webtoolkit.eu并查看 Wt::Dbo 组件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-15T12:42:26.110

您可以查看[Debea](http://debea.net) - SQL 数据库访问和 C++ 的 ORM。它内置了 wxWidgets 的 API。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-15T12:52:11.527

Qt 也是一种选择。它支持与您想要的服务器的连接，并且使用起来非常简单。

[http://doc.trolltech.com/4.4/sql-driver.html#supported-databases](http://doc.trolltech.com/4.4/sql-driver.html#supported-databases)

使用 Qt 时，您不需要针对所有 Qt 进行构建。例如，您可以只使用 SQL 部分，而将整个 GUI 部分留在外面。

由于它最近是 LGPL 版，因此您也可以将其用于专有应用程序。

# asp.net - 调试 ASP.NET MVC 应用程序时，如何才能显示对 Site.css 的更改？

> ID：440074
> 
> 赞同：0
> 
> 时间：2009-01-13T18:02:10.370
> 
> 标签：asp.net, asp.net-mvc, debugging

我在我的开发机器上调试，当我对 css 文件进行更改时，它们没有出现，我不知道为什么。我正在使用 firebug 并检查 css 并且更改不存在。我已经尝试过清除私人数据并首先构建项目然后运行它，但似乎没有任何效果。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T18:12:42.533

使用**CTL+F5**强制完全刷新——它将强制浏览器忽略缓存的任何内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T18:06:08.287

它可能正在缓存您的 css 文件。修改浏览器中的设置以停止缓存，或向 css 文件添加唯一标识符，如 Site.css?d=011509。

# f# - Seq.generate_using 是 MIA

> ID：440083
> 
> 赞同：1
> 
> 时间：2009-01-13T18:03:46.857
> 
> 标签：f#

我正在尝试使用该`Seq.generate_using`功能，但不幸的是，我似乎无法找到它。我以为它会住在这里：

```
Microsoft.FSharp.Collections.Seq.generate_using 
```

但事实并非如此。我收到下面列出的错误。

> C:\Users\Owner\Documents\Visual Studio 2008\Projects\fsharp1\Program.fs(54,63)：错误 FS0039：未定义值、构造函数、命名空间或类型“generate_using”。在 FSharp.PowerPack.dll 中找到了具有此名称的构造，其中包含一些在 F# 的某些先前版本中隐式引用的模块和类型。您可能需要添加对此 DLL 的显式引用才能编译此代码。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T18:59:41.220

根据[2008 年 9 月的 CTP 发行说明](http://blogs.msdn.com/dsyme/archive/2008/08/29/detailed-release-notes-for-the-f-september-2008-ctp-release.aspx)：

> F# 库分为两个组件。FSharp.Core.dll：包含核心 F# 库，将不经常进行稳定化和版本化。 **FSharp.PowerPack.dll**：包含其他有用的 F# 库和工具，它们将更频繁地进行版本更新，并允许在核心 F# 语言和库的基础上继续创新。

Seq 模块中的一些方法已移至 FSharp.PowerPack 程序集中，因此您只能通过执行以下操作来获取这些方法：

*   如果您使用的是 Visual Studio，请打开解决方案资源管理器，右键单击项目文件，选择“添加引用”，然后添加“FSharp.PowerPack.dll”。

*   如果您使用的是脚本文件或 fsi，请键入**`#r "FSharp.PowerPack";;`**以加载程序集。

现在您应该可以调用 Seq.generate_using。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-16T21:27:40.843

#r "FSharp.PowerPack";; 对我有用，但在我的解决方案中添加 PowerPack 不起作用。我正在尝试使用 HashSet<>。

# java - 使用 simple-xml 时转换点对象

> ID：440087
> 
> 赞同：3
> 
> 时间：2009-01-13T18:04:13.737
> 
> 标签：java, object, serialization, point, simple-framework

我正在使用 simple-xml ( [http://simple.sourceforge.net/](http://simple.sourceforge.net/) ) 序列化一个类，但是当我尝试在 Point 对象上使用 @Element 时出现错误，我该如何转换这个 Point 对象？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T18:20:36.743

你可以像这样创建一个变换

```
public class PointTransform implements Transform<Point> {

  public Point read(String value) {
     return fromString(value);
  }

  public String write(Point value)  {
     return toString(value);
  }

  // etc ...
} 
```

然后将 Matcher 传递给 Persister 构造函数，以便它可以在给定类的情况下解析您的 Transform。变换仅用于基元，如属性或文本值。它们不应该用于编写 XML，因为它只会在写入结果文档时被转义。最好使用这样的注释。

```
@Root
public class Point {

  @Attribute
  private int x;

  @Attribute
  private int y;

  public int getX() {
     return x;
  }

  public int getY() {
     return y;
  }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-19T18:15:03.647

您可以使用 Converter 来序列化需要完整 XML 元素（而不仅仅是具有文本表示）的对象。看：

[http://simple.sourceforge.net/download/stream/doc/tutorial/tutorial.php#converters](http://simple.sourceforge.net/download/stream/doc/tutorial/tutorial.php#converters)

# svn - 我们使用 Subversion，但我们的客户使用 SourceSafe。我有哪些选择？

> ID：440113
> 
> 赞同：4
> 
> 时间：2009-01-13T18:11:43.813
> 
> 标签：svn, version-control, visual-sourcesafe

我们即将开始一个新项目，我们客户的当前应用程序是 SourceSafe 中的 .NET 版本。但是，我们在内部使用 Subversion。这可能是一次“一次性”交付（完整的应用程序重写），因此他们可以轻松地从我们的存储库中进行检查，然后导出并导入到他们的 SourceSafe 存储库中。但是，我担心的是，如果我们进行一些编辑或进行未来的维护，它会变得更加难以管理。关于如何最好地处理这个问题的任何想法？

编辑：

我不确定它是否会有所作为，但客户进行更改的可能性很小。如果他们这样做了，那将是在我们 100% 完成之后，这样更容易管理。如果我们俩同时进行更改，那么我可能会建议我为他们的项目授予他们对我们的 repo 的写访问权限，并且我们以这种方式进行管理。不过，我正在努力向前思考，因为他们很有可能希望我们回来并与他们一起做更多的工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T18:46:42.293

另一种选择是为他们提供对您的 svn 存储库的访问权限（仅限他们的项目），并为他们提供支持、链接等。一旦他们看到光明，他们可能不想使用其他任何东西......

我想我会这样做，直到你必须做出关于安全的决定。也许在你必须做出决定之前，它就会消失。

我过去确实有过这方面的经验。出于某种原因，我们分包的公司在内部使用 CVS，但 SourceSafe 用于面向外部客户的东西。我接手了这个项目，并把它放到了svn中。承包商对此很满意。

编辑：

此外，可以设置主/从 svn 存储库。不确定这在这种情况下是否有帮助。

另一种可能性是询问他们是否会托管一个 svn 存储库，如果您首先设置并管理它。

总而言之，最好与客户交谈以解决此问题。看看你能想出什么主意。维护两个 ACTIVE 回购不是一个好主意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-17T16:06:42.950

我一直在研究 VSS->SVN 迁移工具，其中一项任务是为更新 SVN 存储库提供支持，其中包含在某个日期之后所做的任何更改（我必须这样做，因为我们有一个 16 gig VSS 数据库，迁移大约 300 万个单独的修订版本需要眨眼时间）

因此，我制作了 VSS DB 的快照副本，并使用它进行导入，然后一段时间后，我迁移了自拍摄快照以来所做的所有更改。看起来这对您很有用，因为您可以将客户所做的更改导入到他们的 VSS 数据库中。

该代码在 SVN 存储库中发布，但尚未构建为包，因为您必须从 SVN 存储库下载文件并进行构建。它基于 .NET，因此您应该对它感到满意。它还保留所有标签、作者和日期更改。

[它作为 VSS2SVN](http://www.codeplex.com/VSS2SVN)托管在CodePlex 上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T18:34:31.567

我想知道是否有任何方法可以使用分布式版本控制系统来管理两个存储库之间的交互。我知道 git 可以与 svn 一起使用，但我不确定 sourcesafe。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T18:35:29.943

客户是否也会对程序进行更改？如果是这样，我会说您认为最好的是：从颠覆中导出并将其放入源代码安全中。然后，无论何时他们希望您进行更改，您都可以导出（或签出或其他）他们所做的任何更改，并在 subversion 中对签出版本进行这些更改（实际上只是复制顶部）。它不漂亮，但你没有很多选择。您也可以尝试让他们向您发送他们所做的任何和所有更改。

为什么需要将代码保存在两个代码仓库中？

# sql-server - 如何确定 SQL 结果的数据类型？

> ID：440123
> 
> 赞同：14
> 
> 时间：2009-01-13T18:14:48.003
> 
> 标签：sql-server, ssms

我们有一个 SQL 查询，它从数据库的许多表/视图中提取大量字段。我们需要将规范放在一起以与第 3 方集成，编译结果集的数据类型的最快方法是什么？

说明：

*   涉及 25 个以上的表/视图，因此表级别的功能仍然很麻烦。
*   目前所有工作都在 Microsoft SQL Server Management Studio 中完成。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2013-12-04T01:41:29.627

您可能会使用一些快速 SQL 语句来查看结果列类型，使用临时表。

临时表比视图好一点，因为它们是连接本地范围，一旦断开连接就会被清除。

您只需要注入几个关键字，如下所示

```
SELECT
TOP 0 -- to speed up without access data
your,original,columns
INTO #T -- temp table magic
FROM originalTablesJoins
Order by anything
exec tempdb.sys.sp_columns #T
drop table #T 
```

或者;

```
SELECT TOP 0 *
INTO #T
FROM (
  select your,original,columns from originalTablesJoins -- remove order by if any
) x
exec tempdb.sys.sp_columns #T
drop table #T 
```

注意：受 [SQL Server Management Studio 中结果集视图架构的启发](https://stackoverflow.com/questions/6216602/view-schema-of-resultset-in-sql-server-management-studio)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-13T18:54:31.183

您可以使用 SET FMTONLY ON 运行查询，但这可能无法帮助您轻松确定返回的数据类型，因为您仅在 Management Studio 中工作。如果是我，我想我会临时创建一个与存储过程具有相同主体的视图（您可能必须为任何参数声明变量）。然后，您可以使用已经讨论过的 INFORMATION_SCHEMA 查询查看视图返回的列。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T18:20:22.407

如果您使用的是 SQL Server，则表中提供了来自各种表的元数据`information_schema`。例如，要获取表 Foo 的列元数据，请发出以下查询：

```
SELECT * FROM information_schema.columns WHERE table_name = 'Foo' 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T18:25:51.397

如果您使用的是 C#，则可以直接从 DataRow 对象中的字段访问它：

```
Type columnNameType = row["columnName"].GetType(); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T18:29:20.020

对于其他替代方案，您可以使用

```
sp_help  'Table_Name' 
```

**编辑：**此外， sp_help 可用于任何对象（即它会指示存储过程输入和输出变量的返回类型）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-05-05T15:33:47.937

这是一个，如果你可以`SELECT ... INTO #Temp`（记住`#Temp`最坏的情况是会话范围）从[https://stackoverflow.com/a/14328779/162273](https://stackoverflow.com/a/14328779/162273)窃取一些内容：

```
SELECT 
    c.name AS UsefulRawName,
    ',' + c.name + ' ' + UPPER(t.name) + 
        CASE 
            WHEN t.name IN ('char', 'nchar', 'varchar', 'nvarchar') THEN '(' + CAST(c.max_length AS VARCHAR(3) ) + ')'
            WHEN t.name IN ('decimal', 'numeric') THEN '(' + CAST(c.[precision] AS VARCHAR(3) ) + ', ' + CAST(c.[scale] AS VARCHAR(3) ) + ')'
            ELSE '' END + CASE WHEN c.Is_Nullable = 1 THEN ' NULL' ELSE ' NOT NULL' END AS SQLColumnType,
    'public ' + 
        CASE 
            WHEN t.name IN ('varchar', 'nvarchar', 'text', 'ntext', 'char', 'nchar', 'xml', 'sysname') THEN 'string'
            WHEN t.name IN ('binary', 'varbinary', 'image') THEN 'byte[]' + CASE WHEN c.Is_Nullable = 1 THEN '?' ELSE '' END
            WHEN t.name IN ('uniqueidentifier') THEN 'Guid' + CASE WHEN c.Is_Nullable = 1 THEN '?' ELSE '' END
            WHEN t.name IN ('datetimeoffset') THEN 'DateTimeOffset' + CASE WHEN c.Is_Nullable = 1 THEN '?' ELSE '' END
            WHEN t.name IN ('date', 'time', 'datetime2', 'smalldatetime', 'datetime') THEN 'DateTime' + CASE WHEN c.Is_Nullable = 1 THEN '?' ELSE '' END
            WHEN t.name IN ('numeric', 'decimal', 'real', 'money', 'smallmoney') THEN 'decimal' + CASE WHEN c.Is_Nullable = 1 THEN '?' ELSE '' END
            WHEN t.name IN ('float') THEN 'float' + CASE WHEN c.Is_Nullable = 1 THEN '?' ELSE '' END
            WHEN t.name IN ('tinyint', 'smallint') THEN 'short' + CASE WHEN c.Is_Nullable = 1 THEN '?' ELSE '' END
            WHEN t.name IN ('int') THEN 'int' + CASE WHEN c.Is_Nullable = 1 THEN '?' ELSE '' END
            WHEN t.name IN ('bit') THEN 'bool' + CASE WHEN c.Is_Nullable = 1 THEN '?' ELSE '' END
            WHEN t.name IN ('bigint') THEN 'long' + CASE WHEN c.Is_Nullable = 1 THEN '?' ELSE '' END
            WHEN t.name IN ('timestamp') THEN 'ulong'
            ELSE 'object' END + ' ' + c.name + ' { get; set; }' AS CSColumnType,
    c.name + ' = ' +
        CASE 
            WHEN t.name IN ('varchar', 'nvarchar', 'text', 'ntext', 'char', 'nchar', 'xml', 'sysname') THEN 'reader["' + c.name + '"] as string,'
            WHEN t.name IN ('binary', 'varbinary', 'image') THEN CASE 
                                                        WHEN c.Is_Nullable = 1 THEN 'reader["' + c.name + '"] as byte[]?,'
                                                        ELSE '(byte[])reader["' + c.name + '"],' END
            WHEN t.name IN ('uniqueidentifier') THEN CASE 
                                                        WHEN c.Is_Nullable = 1 THEN 'reader["' + c.name + '"] as Guid?,'
                                                        ELSE '(Guid)reader["' + c.name + '"],' END
            WHEN t.name IN ('datetimeoffset') THEN CASE 
                                                        WHEN c.Is_Nullable = 1 THEN 'reader["' + c.name + '"] as DateTimeOffset?,'
                                                        ELSE '(DateTimeOffset)reader["' + c.name + '"],' END
            WHEN t.name IN ('date', 'time', 'datetime2', 'smalldatetime', 'datetime') THEN CASE 
                                                        WHEN c.Is_Nullable = 1 THEN 'reader["' + c.name + '"] as DateTime?,'
                                                        ELSE '(DateTime)reader["' + c.name + '"],' END
            WHEN t.name IN ('numeric', 'decimal', 'real', 'money', 'smallmoney') THEN CASE 
                                                        WHEN c.Is_Nullable = 1 THEN 'reader["' + c.name + '"] as decimal?,'
                                                        ELSE '(decimal)reader["' + c.name + '"],' END
            WHEN t.name IN ('float') THEN CASE 
                                                        WHEN c.Is_Nullable = 1 THEN 'reader["' + c.name + '"] as float?,'
                                                        ELSE '(float)reader["' + c.name + '"],' END
            WHEN t.name IN ('tinyint', 'smallint') THEN CASE 
                                                        WHEN c.Is_Nullable = 1 THEN 'reader["' + c.name + '"] as short?,'
                                                        ELSE '(short)reader["' + c.name + '"],' END
            WHEN t.name IN ('int') THEN CASE 
                                                        WHEN c.Is_Nullable = 1 THEN 'reader["' + c.name + '"] as int?,'
                                                        ELSE '(int)reader["' + c.name + '"],' END
            WHEN t.name IN ('bit') THEN CASE 
                                                        WHEN c.Is_Nullable = 1 THEN 'reader["' + c.name + '"] as bool?,'
                                                        ELSE '(bool)reader["' + c.name + '"],' END
            WHEN t.name IN ('bigint') THEN CASE 
                                                        WHEN c.Is_Nullable = 1 THEN 'reader["' + c.name + '"] as long?,'
                                                        ELSE '(long)reader["' + c.name + '"],' END
            WHEN t.name IN ('timestamp') THEN '(ulong)reader["' + c.name + '"],'
            ELSE 'reader["' + c.name + '"] == DBNull.Value ? null : reader["' + c.name + '"],' END AS ReaderStatements
FROM tempDb.sys.columns c
INNER JOIN sys.types AS t ON c.system_type_id = t.system_type_id AND t.system_type_id   = t.user_type_id
WHERE [object_id] = OBJECT_ID('tempdb..#Temp')
ORDER BY column_id 
```

~~更有动力的人可以自动将类型更智能地映射到 .Net 等效项，但这还不错，并且可以保持片段简短。~~

手动转换这些类型已经够麻烦了，扩展脚本是值得的。不确定我的转换是否正确。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-08-05T17:29:53.967

一般来说，对于现有的表或视图，您希望使用系统目录或`INFORMATION_SCHEMA.COLUMNS`，但如果它是一个任意查询，您正在查看它会有点困难。

我会使用`sys.dm_exec_describe_first_result_set`动态管理视图。通常，最大的痛苦是必须用单引号转义您的查询。

```
DECLARE @tsql nvarchar(max) = N'SELECT YourFields FROM YourQuery';

SELECT *
FROM sys.dm_exec_describe_first_result_set(@tsql, null, 0); 
```

有关更多信息，请参阅[文档](https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-describe-first-result-set-transact-sql?view=sql-server-ver15)。

或者，您可以使用`sp_describe_first_result_set`存储过程并获得基本相同的结果。（动态管理视图很好，因为您可以更轻松地使用 WHERE 进行过滤或使用 ORDER BY 进行排序。）

```
DECLARE @tsql nvarchar(max) = N'SELECT YourFields FROM YourQuery';

EXEC sp_describe_first_result_set @tsql, null, 0; 
```

再次，请参阅[文档](https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-describe-first-result-set-transact-sql)以获取更多信息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T18:30:03.403

请注意，结果集元数据与表元数据不同，因为 SQL 查询可以包含表达式，其数据类型可能与它们查询的表中的数据类型不同。

许多 SQL 查询接口为您提供了一些功能来检索有关结果集元数据（数据类型等）的信息。

您需要使用的特定 API 函数取决于您使用的语言和查询界面。你没有说这个。

例如，如果您使用 ODBC，该[`SQLDescribeCol()`](http://msdn.microsoft.com/en-us/library/ms716289(VS.85).aspx)函数可以为您提供有关结果集元数据的信息。

# bug-tracking - 您对软件产品中的“组件”的定义是什么？

> ID：440128
> 
> 赞同：0
> 
> 时间：2009-01-13T18:15:44.273
> 
> 标签：bug-tracking

我们正在努力在所有项目中标准化我们的 Bugzilla 应用程序。默认安装将错误分组到具有**Components**和**Versions的****Products**中。

 ****我们对**Product**和**Version**的定义是一致的，但是对于什么构成**Component**仍然存在一些混淆/讨论/争论。

您如何定义与项目中的错误分类相关的**组件**？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T18:52:51.767

出于错误跟踪的目的，我将使用 Component 来表示不同开发人员倾向于处理的高级区域。对我来说，**Component [in bug tracking] == Area of​​ Concern**。

例如，对于一个虚构的 EventPlanner 应用程序，我会将我的组件列出为：

*   日历
*   用户界面
*   印刷

请注意，这***可能与***我作为开发人员通常认为的**软件组件**不同。例如，我的 EventPlanner 应用程序可能使用了日历 API，但“用户界面”和“打印”本身并不是软件组件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T18:48:06.127

组件是产品的细分，它提供产品功能的子集。

例如，如果 Stack Overflow 是产品，这里有一些潜在的组件：

*   问题
*   标签
*   徽章
*   简介

一些粘合逻辑应该将组件组合在一起以形成项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T18:18:41.630

我会定义类似于引用代码分支的组件，例如 Visual Studio 中的项目，它可以是类库、控制台应用程序、Windows 应用程序或网站/Web 应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T18:30:23.637

一个[很好的定义](https://rads.stackoverflow.com/amzn/click/com/0596102070)，将服务于您的目的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T18:20:02.393

任何作为“帮助”对象的东西，做一些小事以支持应用程序的更大功能的东西，并且**可以在其他 Products 中重用**。

例如，一个 EmailSender 类，或者一个 ErrorLogger 等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T18:29:01.423

无论您最感兴趣的是什么，都将您的产品分解为错误跟踪。根据某些并非特定于错误跟踪问题的概念，区分对您有用而不是“正确”更重要。

对我来说，您可以在不破坏其他部分的情况下更改实现的任何代码部分都可以称为组件。您可以明确指出并说：“这个错误就**在那里**，而其他地方都没有。”

如果您的产品是一个巨大的意大利面条代码球，您可能无法从组件中获得任何好处。如果你已经很好地解耦了，并且你有一个非常大的项目，你可能有数百个可以称为“组件”的东西，你可能必须对它们进行语义分组以防止区分比它更麻烦值得。

**编辑：**为了回应对另一个答案的评论，如果提交错误的人对问题有必要的知识来进行归档，则此模型效果最佳。我们总是审查（分类）报告的错误并自己归档。如果您将组件选择留给用户，那么这个想法对您来说效果不佳。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T18:46:36.160

伯克利大学的 A. Richard Newton 博士教授一门名为“基于组件的软件最新技术和经验教训”的课程，他将软件组件定义为

> 软件组件是仅具有合同规定的接口和明确的上下文依赖关系的组合单元。软件组件可以独立部署，并由第三方组成

我认为没有更好的定义。所以这里的错误可能在组件级别或接口级别，即组合级别。

# .net - 获取标准 Windows 注册表安全对象的独立于语言环境的方法

> ID：440130
> 
> 赞同：1
> 
> 时间：2009-01-13T18:15:56.253
> 
> 标签：.net, globalization

有没有办法以独立于语言环境的方式获取内置的“Everyone”注册表安全对象？我想制作一个 RegistryAccessRule 而无需将“每个人”翻译成每种语言。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T18:25:34.363

使用采用 WellKnownSidType 的 SecurityIdentifier 的构造函数并使用 WellKnownSidType.WorldSid。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T18:29:51.360

使用采用 WellknownSidType.WorldSid 的构造函数创建一个 SecurityIdentifier。域 SID 无关紧要。

# php - MySQL 插入：先测试？

> ID：440131
> 
> 赞同：6
> 
> 时间：2009-01-13T18:16:10.623
> 
> 标签：php, mysql, database

举个例子，当向具有唯一索引的表中插入一条记录时，最好先测试一下吗？*例如*，

```
$mysqli->query('SELECT email FROM tblUser WHERE email = 'foo@bar.org'); 
```

然后确保返回 0 行，*然后*插入？

```
$mysqli->query('INSERT INTO tblUser ...'); 
```

或者在有重复条目的情况下跳过测试并处理错误是否更好？

谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T18:23:40.733

最好插入和处理任何重复的键错误。

原因是如果您先测试，其他一些客户端仍然可以在您的测试和插入之间的短暂时刻插入该值。所以无论如何你都需要处理错误。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-13T18:44:19.147

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T18:29:58.333

如果您想忽略创建具有已存在于另一行的键值的行的插入，MySQL 支持插入忽略。

只需确保 tblUser 中的电子邮件有一个唯一索引并执行

```
$mysqli->query('INSERT IGNORE INTO tblUser ...'); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T18:27:55.340

这取决于您是否要确保插入的值不存在。如果您在文件上有一个唯一键，那么不要创建重复键（这将引发错误），这一点很重要。很多时候，您也想测试是否存在记录，如果存在则返回记录的主键，以便您可以更新记录，如果不存在则插入记录。

但是，如果您没有唯一键并且不关心信息是否在字段或字段组合中重复，则没有必要并且可以节省一点时间。这取决于情况。

高温高压

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T18:32:10.060

通常取决于适用于数据复制的规则。

在您的示例中，您的应用程序是否允许多个用户拥有相同的电子邮件地址？如果没有，那么您需要执行该检查。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T18:35:57.353

你肯定想先测试，你可能想测试一些东西，这样你就可以告诉用户出了什么问题。

例如，我刚刚完成了一项用户需要唯一用户名和唯一电子邮件地址的工作。

# c++ - 如何在 C++ 中创建随机字母数字字符串？

> ID：440133
> 
> 赞同：203
> 
> 时间：2009-01-13T18:16:30.373
> 
> 标签：c++, string, random

我想创建一个由字母数字字符组成的随机字符串。我希望能够指定字符串的长度。

我如何在 C++ 中做到这一点？

* * *

## 回答 #1

> 赞同：330
> 
> 时间：2009-01-13T18:41:30.260

Mehrdad Afshari 的[回答](https://stackoverflow.com/questions/440133/how-do-i-create-a-random-alpha-numeric-string-in-c#440147)可以解决问题，但我发现它对于这个简单的任务来说有点过于冗长。查找表有时可以创造奇迹：

```
#include <ctime>
#include <iostream>
#include <unistd.h>

std::string gen_random(const int len) {
    static const char alphanum[] =
        "0123456789"
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
        "abcdefghijklmnopqrstuvwxyz";
    std::string tmp_s;
    tmp_s.reserve(len);

    for (int i = 0; i < len; ++i) {
        tmp_s += alphanum[rand() % (sizeof(alphanum) - 1)];
    }

    return tmp_s;
}

int main(int argc, char *argv[]) {
    srand((unsigned)time(NULL) * getpid());     
    std::cout << gen_random(12) << "\n";        
    return 0;
} 
```

请注意，`rand` [生成质量差的随机数](https://stackoverflow.com/a/19666713/6243352)。

* * *

## 回答 #2

> 赞同：116
> 
> 时间：2012-09-17T22:46:42.107

Here's my adaptation of Ates Goral's answer using C++11\. I've added the lambda in here, but the principle is that you could pass it in and thereby control what characters your string contains:

```
std::string random_string( size_t length )
{
    auto randchar = []() -> char
    {
        const char charset[] =
        "0123456789"
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
        "abcdefghijklmnopqrstuvwxyz";
        const size_t max_index = (sizeof(charset) - 1);
        return charset[ rand() % max_index ];
    };
    std::string str(length,0);
    std::generate_n( str.begin(), length, randchar );
    return str;
} 
```

Here is an example of passing in a lambda to the random string function: [http://ideone.com/Ya8EKf](http://ideone.com/Ya8EKf)

Why would you use **C++11**?

1.  Because you can produce strings that follow a certain **probability distribution** (or distribution combination) for the character set you're interested in.
2.  Because it has built-in support for **non-deterministic random numbers**
3.  Because it supports unicode, so you could change this to an internationalized version.

For example:

```
#include <iostream>
#include <vector>
#include <random>
#include <functional> //for std::function
#include <algorithm>  //for std::generate_n

typedef std::vector<char> char_array;

char_array charset()
{
    //Change this to suit
    return char_array( 
    {'0','1','2','3','4',
    '5','6','7','8','9',
    'A','B','C','D','E','F',
    'G','H','I','J','K',
    'L','M','N','O','P',
    'Q','R','S','T','U',
    'V','W','X','Y','Z',
    'a','b','c','d','e','f',
    'g','h','i','j','k',
    'l','m','n','o','p',
    'q','r','s','t','u',
    'v','w','x','y','z'
    });
};    

// given a function that generates a random character,
// return a string of the requested length
std::string random_string( size_t length, std::function<char(void)> rand_char )
{
    std::string str(length,0);
    std::generate_n( str.begin(), length, rand_char );
    return str;
}

int main()
{
    //0) create the character set.
    //   yes, you can use an array here, 
    //   but a function is cleaner and more flexible
    const auto ch_set = charset();

    //1) create a non-deterministic random number generator      
    std::default_random_engine rng(std::random_device{}());

    //2) create a random number "shaper" that will give
    //   us uniformly distributed indices into the character set
    std::uniform_int_distribution<> dist(0, ch_set.size()-1);

    //3) create a function that ties them together, to get:
    //   a non-deterministic uniform distribution from the 
    //   character set of your choice.
    auto randchar = [ ch_set,&dist,&rng ](){return ch_set[ dist(rng) ];};

    //4) set the length of the string you want and profit!        
    auto length = 5;
    std::cout<<random_string(length,randchar)<<std::endl;
    return 0;
} 
```

[Sample output.](http://ideone.com/LxhX15)

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2014-07-05T12:47:26.113

My 2p solution:

```
#include <random>
#include <string>

std::string random_string(std::string::size_type length)
{
    static auto& chrs = "0123456789"
        "abcdefghijklmnopqrstuvwxyz"
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

    thread_local static std::mt19937 rg{std::random_device{}()};
    thread_local static std::uniform_int_distribution<std::string::size_type> pick(0, sizeof(chrs) - 2);

    std::string s;

    s.reserve(length);

    while(length--)
        s += chrs[pick(rg)];

    return s;
} 
```

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2009-01-14T20:53:37.560

与其手动循环，不如使用适当的[C++ 算法](https://en.cppreference.com/w/cpp/algorithm)，在这种情况下[`std::generate_n`](https://en.cppreference.com/w/cpp/algorithm/generate_n)，使用[适当的随机数生成器](https://en.cppreference.com/w/cpp/numeric/random)：

```
auto generate_random_alphanumeric_string(std::size_t len) -> std::string {
    static constexpr auto chars =
        "0123456789"
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
        "abcdefghijklmnopqrstuvwxyz";
    thread_local auto rng = random_generator<>();
    auto dist = std::uniform_int_distribution{{}, std::strlen(chars) - 1};
    auto result = std::string(len, '\0');
    std::generate_n(begin(result), len, [&]() { return chars[dist(rng)]; });
    return result;
} 
```

这接近于我称之为这个问题的“规范”解决方案。

Unfortunately, [correctly seeding a generic C++ random number generator (e.g. MT19937) is *really hard*](https://codereview.stackexchange.com/q/109260/308). The above code therefore uses a helper function template, `random_generator`:

```
template <typename T = std::mt19937>
auto random_generator() -> T {
    auto constexpr seed_bytes = sizeof(typename T::result_type) * T::state_size;
    auto constexpr seed_len = seed_bytes / sizeof(std::seed_seq::result_type);
    auto seed = std::array<std::seed_seq::result_type, seed_len>();
    auto dev = std::random_device();
    std::generate_n(begin(seed), seed_len, std::ref(dev));
    auto seed_seq = std::seed_seq(begin(seed), end(seed));
    return T{seed_seq};
} 
```

This is complex and relatively inefficient. Luckily it’s used to initialise a `thread_local` variable and is therefore only invoked once per thread.

Finally, the necessary includes for the above are:

```
#include <algorithm>
#include <array>
#include <cstring>
#include <functional>
#include <random>
#include <string> 
```

The above code uses [class template argument deduction](https://en.cppreference.com/w/cpp/language/class_template_argument_deduction) and thus requires C++17\. It can be trivially adapted for earlier versions by adding the required template arguments.

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-01-13T18:20:26.823

```
 void gen_random(char *s, size_t len) {
     for (size_t i = 0; i < len; ++i) {
         int randomChar = rand()%(26+26+10);
         if (randomChar < 26)
             s[i] = 'a' + randomChar;
         else if (randomChar < 26+26)
             s[i] = 'A' + randomChar - 26;
         else
             s[i] = '0' + randomChar - 26 - 26;
     }
     s[len] = 0;
 } 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-01-17T12:06:20.627

I just tested this, it works sweet and doesn't require a lookup table. rand_alnum() sort of forces out alphanumerics but because it selects 62 out of a possible 256 chars it isn't a big deal.

```
#include <cstdlib>   // for rand()
#include <cctype>    // for isalnum()   
#include <algorithm> // for back_inserter
#include <string>

char 
rand_alnum()
{
    char c;
    while (!std::isalnum(c = static_cast<char>(std::rand())))
        ;
    return c;
}

std::string 
rand_alnum_str (std::string::size_type sz)
{
    std::string s;
    s.reserve  (sz);
    generate_n (std::back_inserter(s), sz, rand_alnum);
    return s;
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2012-06-19T02:32:10.660

I hope this helps someone.

Tested at [https://www.codechef.com/ide](https://www.codechef.com/ide) with C++ 4.9.2

```
#include <iostream>
#include <string>
#include <stdlib.h>     /* srand, rand */

using namespace std;

string RandomString(int len)
{
   string str = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
   string newstr;
   int pos;
   while(newstr.size() != len) {
    pos = ((rand() % (str.size() - 1)));
    newstr += str.substr(pos,1);
   }
   return newstr;
}

int main()
{
   srand(time(0));
   string random_str = RandomString(100);
   cout << "random_str : " << random_str << endl;
} 
```

`Output: random_str : DNAT1LAmbJYO0GvVo4LGqYpNcyK3eZ6t0IN3dYpHtRfwheSYipoZOf04gK7OwFIwXg2BHsSBMB84rceaTTCtBC0uZ8JWPdVxKXBd`

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2017-07-22T00:46:26.100

Here's a funny one-liner. Needs ASCII.

```
void gen_random(char *s, int l) {
    for (int c; c=rand()%62, *s++ = (c+"07="[(c+16)/26])*(l-->0););
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2017-10-24T14:17:32.663

```
#include <iostream>
#include <string>
#include <random>

std::string generateRandomId(size_t length = 0)
{
    static const std::string allowed_chars {"123456789BCDFGHJKLMNPQRSTVWXZbcdfghjklmnpqrstvwxz"};

    static thread_local std::default_random_engine randomEngine(std::random_device{}());
    static thread_local std::uniform_int_distribution<int> randomDistribution(0, allowed_chars.size() - 1);

    std::string id(length ? length : 32, '\0');

    for (std::string::value_type& c : id) {
        c = allowed_chars[randomDistribution(randomEngine)];
    }

    return id;
}

int main()
{
    std::cout << generateRandomId() << std::endl;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-12-21T15:06:30.563

[Let's make random convenient again!](https://gist.github.com/VjGusev/e51429658c596672458137c57efb71e3)

I made up a nice C++11 header only solution. You could easily add one header file to your project and then add your tests or use random strings for another purposes.

That's a quick description, but you can follow the link to check full code. The main part of solution is in class Randomer:

```
class Randomer {
    // random seed by default
    std::mt19937 gen_;
    std::uniform_int_distribution<size_t> dist_;

public:
    /* ... some convenience ctors ... */

    Randomer(size_t min, size_t max, unsigned int seed = std::random_device{}())
        : gen_{seed}, dist_{min, max} {
    }

    // if you want predictable numbers
    void SetSeed(unsigned int seed) {
        gen_.seed(seed);
    }

    size_t operator()() {
        return dist_(gen_);
    }
}; 
```

`Randomer` incapsulates all random stuff and you can add your own functionality to it easily. After we have `Randomer`, it's very easy to generate strings:

```
std::string GenerateString(size_t len) {
    std::string str;
    auto rand_char = [](){ return alphabet[randomer()]; };
    std::generate_n(std::back_inserter(str), len, rand_char);
    return str;
} 
```

Write your suggestions for improvement below. [https://gist.github.com/VjGusev/e6da2cb4d4b0b531c1d009cd1f8904ad](https://gist.github.com/VjGusev/e6da2cb4d4b0b531c1d009cd1f8904ad)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-10-28T11:45:21.360

The most suitable function in standard library is [std::sample](https://en.cppreference.com/w/cpp/algorithm/sample):

```
#include <algorithm>
#include <iterator>
#include <random>
#include <string>
#include <iostream>

static const char charset[] = 
    "0123456789"
    "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    "abcdefghijklmnopqrstuvwxyz";

template<typename URBG>
std::string gen_string(std::size_t length, URBG&& g) {
    std::string result;
    result.resize(length);
    std::sample(std::cbegin(charset), 
                std::cend(charset),
                std::begin(result),
                std::intptr_t(length),
                std::forward<URBG>(g));
    return result;
}

int main() {
    std::mt19937 g;
    std::cout << gen_string(10, g) << std::endl;
    std::cout << gen_string(10, g) << std::endl;
} 
```

State of random number generator should be kept outside of the function between calls.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-01-22T13:11:10.380

Something even simpler and more basic in case you're happy for your string to contain any printable characters:

```
#include <time.h>   // we'll use time for the seed
#include <string.h> // this is for strcpy

void randomString(int size, char* output) // pass the destination size and the destination itself
{
    srand(time(NULL)); // seed with time

    char src[size];
    size = rand() % size; // this randomises the size (optional)

    src[size] = '\0'; // start with the end of the string...

    // ...and work your way backwards
    while(--size > -1)
        src[size] = (rand() % 94) + 32; // generate a string ranging from the space character to ~ (tilde)

    strcpy(output, src); // store the random string
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-09-08T06:33:04.277

Example for Qt use:)

```
QString random_string(int length=32, QString allow_symbols=QString("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789")) {
    QString result;
    qsrand(QTime::currentTime().msec());
    for (int i = 0; i < length; ++i) {            
        result.append(allow_symbols.at(qrand() % (allow_symbols.length())));
    }
    return result;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-06-16T21:40:14.533

Yet another adaptation because none of the answers would suffice for my needs.

First of all, if `rand()` is used to generate random numbers you will get the same output at each run. The seed for random number generator has to be some sort of random.

With C++11 you can include the `random` library and you can initialize the seed with `random_device` and `mt19937`. This seed will be supplied by the OS and it will be random enough for us (for example, clock). You can give a range boundaries to be included ([0,25] in my case`.

I only needed random string of lowercase letters so I utilized `char` addition. The pool of characters approach did not work out for me.

```
#include <random>    
void gen_random(char *s, const int len){
    static std::random_device rd;
    static std::mt19937 mt(rd());
    static std::uniform_int_distribution<int> dist(0, 25);
    for (int i = 0; i < len; ++i) {
        s[i] = 'a' + dist(mt);
    }
    s[len] = 0;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-09-11T09:38:01.543

You can use the random() method to generate a basic random string. The code below generates a random string composed of lowercase letters, uppercase letters and digits.

```
String randomStrGen(int numChars){
  String genStr="";
  int sizeStr=0;

  while(sizeStr<numChars){
    int asciiPos= random(48,122);
    if((asciiPos>57 && asciiPos<65) || (asciiPos>90 && asciiPos<97))
      continue;
    genStr+=(char) asciiPos;
    sizeStr++;
  }

  return genStr;
} 
```

if one needs a more secure random number generator, simply replace the random() function for a more secure one.

Also, one can also tweak the possible characters generated by changing the ASCII limits (48,122) to another custom values

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2016-02-01T11:58:58.880

Random string, every run file = different string

```
 auto randchar = []() -> char
    {
        const char charset[] =
            "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
            "abcdefghijklmnopqrstuvwxyz";

        const size_t max_index = (sizeof(charset) - 1);

        return charset[randomGenerator(0, max_index)];
    };
            std::string custom_string;
            size_t LENGTH_NAME = 6 // length of name
    generate_n(custom_string.begin(), LENGTH_NAME, randchar); 
```

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2015-06-16T08:55:40.813

Be ware when calling the function

```
string gen_random(const int len) {
static const char alphanum[] = "0123456789"
        "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

stringstream ss;

for (int i = 0; i < len; ++i) {
    ss << alphanum[rand() % (sizeof(alphanum) - 1)];
}
return ss.str();
} 
```

(adapted of [@Ates Goral](https://stackoverflow.com/a/440240/4767895)) it will result in the same character sequence every time. Use

```
srand(time(NULL)); 
```

before calling the function, although the rand() function is always seeded with 1 [@kjfletch](https://stackoverflow.com/a/1108789/4767895).

For Example:

```
void SerialNumberGenerator() {

    srand(time(NULL));
    for (int i = 0; i < 5; i++) {
        cout << gen_random(10) << endl;
    }
} 
```

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2018-10-28T21:23:45.863

```
#include <iostream>
#include <string>
#include <stdlib.h>
int main()
{
    int size;
    std::cout << "Enter size : ";
    std::cin >> size;
    std::string str;
    for (int i = 0; i < size; i++)
    {
        auto d = rand() % 26 + 'a';
        str.push_back(d);
    }
    for (int i = 0; i < size; i++)
    {
        std::cout << str[i] << '\t';
    }

    return 0;
} 
```

* * *

## 回答 #19

> 赞同：-2
> 
> 时间：2020-07-16T18:28:50.413

```
//C++ Simple Code
#include <bits/stdc++.h>
using namespace std;
int main() {
vector<char> alphanum =
    {'0','1','2','3','4',
'5','6','7','8','9',
'A','B','C','D','E','F',
'G','H','I','J','K',
'L','M','N','O','P',
'Q','R','S','T','U',
'V','W','X','Y','Z',
'a','b','c','d','e','f',
'g','h','i','j','k',
'l','m','n','o','p',
'q','r','s','t','u',
'v','w','x','y','z'
};
string s="";
int len=5;
srand(time(0)); 
for (int i = 0; i <len; i++) {
    int t=alphanum.size()-1;
    int idx=rand()%t;
    s+= alphanum[idx];
}
cout<<s<<" ";
return 0;
} 
```

* * *

## 回答 #20

> 赞同：-3
> 
> 时间：2015-01-30T13:21:17.760

```
void strGetRandomAlphaNum(char *sStr, unsigned int iLen)
{
  char Syms[] = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
  unsigned int Ind = 0;
  srand(time(NULL) + rand());
  while(Ind < iLen)
  {
    sStr[Ind++] = Syms[rand()%62];
  }
  sStr[iLen] = '\0';
} 
```

# oracle - 如何在 PL/SQL 块中捕获唯一约束错误？

> ID：440135
> 
> 赞同：41
> 
> 时间：2009-01-13T18:17:46.390
> 
> 标签：oracle, plsql

假设我有一个 Oracle PL/SQL 块，它将记录插入到表中，并且需要从唯一约束错误中恢复，如下所示：

```
begin
    insert into some_table ('some', 'values');
exception
    when ...
        update some_table set value = 'values' where key = 'some';
end; 
```

是否可以将省略号替换为某些内容以捕获唯一约束错误？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-01-13T18:22:36.770

```
EXCEPTION
      WHEN DUP_VAL_ON_INDEX
      THEN
         UPDATE 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-01-13T18:31:41.963

我相信你有你的理由，但以防万一......你还应该考虑使用“合并”查询：

```
begin
    merge into some_table st
    using (select 'some' name, 'values' value from dual) v
    on (st.name=v.name)
    when matched then update set st.value=v.value
    when not matched then insert (name, value) values (v.name, v.value);
end; 
```

（将上述修改为在开始/结束块中；显然您也可以独立于程序运行它）。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-01-13T18:22:34.370

我怀疑你正在寻找的条件是 [`DUP_VAL_ON_INDEX`](http://www.ordba.net/Tutorials/PLSQL/PLSQL~Error_Handling.htm)

```
EXCEPTION
    WHEN DUP_VAL_ON_INDEX THEN
        DBMS_OUTPUT.PUT_LINE('OH DEAR. I THINK IT IS TIME TO PANIC!') 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-10-06T19:47:46.580

作为显式捕获和处理异常的替代方法，您可以通过`/*+ hint */`在插入语句中包含 a 来告诉 Oracle 捕获并自动忽略异常。这比显式捕获异常然后阐明应该如何处理它要快一些。它也更容易设置。缺点是您没有从 Oracle 获得任何关于捕获到异常的反馈。

这是一个示例，我们将从另一个表或内部查询中进行选择，并将结果插入一个名为的表中，该表`TABLE_NAME`对名为 的列具有唯一约束`IDX_COL_NAME`。

```
INSERT /*+ ignore_row_on_dupkey_index(TABLE_NAME(IDX_COL_NAME)) */ 
INTO TABLE_NAME(
    INDEX_COL_NAME
  , col_1
  , col_2
  , col_3
  , ...
  , col_n)
SELECT 
    INDEX_COL_NAME
  , col_1
  , col_2
  , col_3
  , ...
  , col_n); 
```

如果您的目标是捕获和处理（即打印或更新违反约束的行），这不是一个很好的解决方案。但是，如果您只是想抓住它并忽略违规行，那么这应该可以完成工作。

# ruby-on-rails - Rails 中的服务器端推送

> ID：440140
> 
> 赞同：5
> 
> 时间：2009-01-13T18:18:29.993
> 
> 标签：ruby-on-rails, ajax, chat

我想使用 AJAX 在 Rails 中实现一个可扩展的聊天室。我从研究中知道，唯一的可扩展性发生在服务器端推送。

我的两个问题是：

1）在一个相当高效的聊天服务器中，轮询在什么时候变得令人望而却步？2）我真的不想用剑圣。我不太了解彗星的工作原理。我想我想知道使用 Javascript（创建客户端服务器/轮询器）和另一种语言（为防火墙后面的客户端提供有效的轮询以及与 CGI 的集成）构建这对我来说是否非常困难。和 3）（是的，在 2 中），我是否以正确的方式进行？

我希望得到的最简单的答案是量化的“是的，您将 5 行 Javascript 放入客户端，将 20 行 ruby​​ 放入 CGI 脚本，然后就这样结束了”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-04-01T11:23:11.050

我现在正在尝试做同样的事情。Juggernaut 运行良好，但不适用于 Rails 3，如果这不是必需的，那么我建议使用它，因为聊天非常容易。我的项目使用 Rails 3，每 3 秒轮询一次服务器（Campfire 也有 3 秒）。我正在使用 Rails Metal 使轮询速度超快。如果你想用剑圣，那就太好了，2行客户端js，1或2行服务器端。否则，开始工作！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T20:41:15.120

是的，您将 5 行 Javascript 代码放入客户端，将 20 行 ruby​​ 代码放入 CGI 脚本中，然后就收工了

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T23:37:30.553

如果这很容易做到，人们就不会建立这些技术。恕我直言，我认为民意调查始终是一种笨拙的方式。那说....

我不确定为什么 Juggernaut 不受欢迎 一个人用它建造了这个[64Squares](http://64squar.es/)的网站，效果很好。

[我知道WeeWar](http://weewar.com/)等其他网站使用轮询方法，并且他们有向上或 400 次请求。所以我认为缩放成为一个问题需要一段时间。

祝你好运

干杯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T08:32:23.467

COMET 通过保持与服务器的连接在 Javascript 中打开来工作（在 COMET 网站上有很多关于如何获取此异步数据的示例）。服务器基本上将数据写出并刷新，这可以在紧密循环中使用互斥锁来完成。您可能还需要一个消息队列。

从长远来看，了解[BOSH可能会更好。](http://en.wikipedia.org/wiki/BOSH "BOSH 文章")这是 COMET 的自然进展。

尽管剑圣有一个学习曲线（或者可能不是真的），但学习如何做 COMET 是一个更陡峭的曲线。即使只是异步推送也更难。不仅如此，你还需要考虑如何让它很好地扩展。我从未使用过 Juggernaut，但就 ROR 插件而言，我认为它是微不足道的。如果他们弄清楚如何让它更好地扩展，你就可以免费获得更快的性能。

轮询是另一种在技术上应该*更简单*的选项，但是，我热衷于不使用轮询，因为它可以杀死你的服务器 - 所以我不会在这里详细说明，因为我觉得轮询是懒惰的路线。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T09:01:11.287

营火呢？它每 5 秒轮询一次服务器。像梦一样工作。

# c# - ASP 到 ASP.NET 帮助函数

> ID：440142
> 
> 赞同：1
> 
> 时间：2009-01-13T18:19:29.057
> 
> 标签：c#, asp.net, asp-classic, vbscript

我正在考虑将网站从经典 ASP 转换为 ASP.NET。我正在考虑采用敏捷风格的方法并尽快提供可交付成果，因此我正在考虑进行逐行转换并创建“坏”的 ASP.NET，并将其全部保存在阶段 1 的 ASPX 文件中并得到它在职的。我认为，这将是最快和最安全的（即保留相同的功能）。下一阶段是将代码拆分为代码隐藏和多层。

我计划用 ASPX 文件中的 C# 替换 ASP 文件中的 VBScript。

因此，除了关于我打算做什么的一般评论（我欢迎）之外，我的具体问题是：是否有任何辅助函数可以将 VBScript 函数从 ASP 包装到某人已经完成的 C# 等价物？

所以我会寻找一个 C# 文件（库），它有如下包装：

```
string Mid(string txt,int start,int length)
{
  return txt.SubString(start, length); // or is it start - 1?
}
double Abs(double num)
{
  return Math.Abs(num);
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T18:24:30.323

查看 Microsoft.VisualBasic 命名空间以访问旧的 VBScript/VB6 函数。您可以直接从 C# 中使用它们。

此外，你会感到震惊。ASP.Net 使用不同的编译器模型，因此您在 Classic ASP 中所做的一些事情在 ASP.Net 中根本不允许。*包含文件是最重要的一个——必须*重新考虑所有支持代码（页面本身的 *.asp 文件之外的代码）以支持新模型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T18:24:48.593

我不认为逐行方法是一个好主意——你最终会得到一堆你仍然需要重构的糟糕代码。这对我来说也不是很敏捷。

我会尝试将站点在逻辑上分解为模块，然后尝试将特定页面或模块重写为 ASPX。例如，如果网站有一个管理部分，也许你可以重写管理部分。然后重复下一节。这可以为每个部分迭代地完成，直到你完成。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T19:12:56.920

I agree with the comment by Jason, and would like to also point out a higher level issue that you'd have to address, if you haven't thought about it already.

Does your classic ASP site make use of session variables to manage state between pages? If so, have you thought about how you're going to share session state between ASP and ASP.NET? Classic ASP and ASP.NET implement session state in different ways, so you will need methods to transfer between the two.

Smaller applications may be easier to "convert", but if you've got a large app that makes heavy use of session variables, you may want to think about other options.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T18:22:22.200

如果您可以选择使用 ASP.NET MVC，我会先看一下。我认为这比尝试从脚本语言转换为 WebForms 更容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T19:26:37.970

我不认为您通过在.Net 中按原样重做网站获得任何收益。正确实施它与您在 .Net 中开始使用的内容完全不同，以至于看起来像是在浪费精力。此外，如果您在 .aspx 页面中实现所有内容，甚至没有代码隐藏，那么编写单元测试将非常困难。

我的目标是进行 MVC 转换。如果您按原样移植它，至少调查母版页，那应该会为您省去一些麻烦。

# opengl - 在 OpenGL 中，有没有办法获取着色器程序使用的所有制服和属性的列表？

> ID：440144
> 
> 赞同：54
> 
> 时间：2009-01-13T18:20:03.047
> 
> 标签：opengl, 3d, shader, glsl

我想获取着色器程序对象使用的所有制服和属性的列表。 `glGetAttribLocation()`&`glGetUniformLocation()`可用于将字符串映射到某个位置，但我真正想要的是字符串列表，而无需解析 glsl 代码。

注意：在 OpenGL 2.0`glGetObjectParameteriv()`中被替换为`glGetProgramiv()`. 枚举是`GL_ACTIVE_UNIFORMS`& `GL_ACTIVE_ATTRIBUTES`。

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2009-01-14T12:44:55.487

*两个示例之间共享的变量：*

```
GLint i;
GLint count;

GLint size; // size of the variable
GLenum type; // type of the variable (float, vec3 or mat4, etc)

const GLsizei bufSize = 16; // maximum name length
GLchar name[bufSize]; // variable name in GLSL
GLsizei length; // name length 
```

## 属性

```
glGetProgramiv(program, GL_ACTIVE_ATTRIBUTES, &count);
printf("Active Attributes: %d\n", count);

for (i = 0; i < count; i++)
{
    glGetActiveAttrib(program, (GLuint)i, bufSize, &length, &size, &type, name);

    printf("Attribute #%d Type: %u Name: %s\n", i, type, name);
} 
```

## 制服

```
glGetProgramiv(program, GL_ACTIVE_UNIFORMS, &count);
printf("Active Uniforms: %d\n", count);

for (i = 0; i < count; i++)
{
    glGetActiveUniform(program, (GLuint)i, bufSize, &length, &size, &type, name);

    printf("Uniform #%d Type: %u Name: %s\n", i, type, name);
} 
```

### OpenGL 文档/变量类型

可以在文档中找到表示变量类型的各种宏。如`GL_FLOAT`, `GL_FLOAT_VEC3`,`GL_FLOAT_MAT4`等。

*   [glGetActiveAttrib](https://www.opengl.org/sdk/docs/man/html/glGetActiveAttrib.xhtml)
*   [glGetActiveUniform](https://www.opengl.org/sdk/docs/man/html/glGetActiveUniform.xhtml)

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2012-09-26T22:49:38.947

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2012-09-26T21:46:52.763

对于那些发现这个问题并希望在 WebGL 中执行此操作的任何人，这里是 WebGL 等价物：

```
var program = gl.createProgram();
// ...attach shaders, link...

var na = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);
console.log(na, 'attributes');
for (var i = 0; i < na; ++i) {
  var a = gl.getActiveAttrib(program, i);
  console.log(i, a.size, a.type, a.name);
}
var nu = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);
console.log(nu, 'uniforms');
for (var i = 0; i < nu; ++i) {
  var u = gl.getActiveUniform(program, i);
  console.log(i, u.size, u.type, u.name);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-05-17T02:49:39.273

Here is the corresponding code in python for getting the uniforms:

```
from OpenGL import GL
...
num_active_uniforms = GL.glGetProgramiv(program, GL.GL_ACTIVE_UNIFORMS)
for u in range(num_active_uniforms):
    name, size, type_ = GL.glGetActiveUniform(program, u)
    location = GL.glGetUniformLocation(program, name) 
```

Apparently the 'new way' mentioned by Nicol Bolas does not work in python.

# java - 使用 JavaScript 检测 Java 版本

> ID：440160
> 
> 赞同：15
> 
> 时间：2009-01-13T18:22:45.397
> 
> 标签：java, javascript, xhtml

是否有可靠的方法来检测使用 JavaScript 在客户端机器上安装的 Java 版本？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-08-05T15:03:46.470

根据我们用谷歌找到这个页面的事实，只是为了帮助下一个人找到这个。

## 是否安装了 Java？

```
navigator.javaEnabled() 
```

[http://www.w3schools.com/jsref/met_nav_javaenabled.asp](http://www.w3schools.com/jsref/met_nav_javaenabled.asp)

## 安装了哪个版本的 Java？

```
<script src="http://www.java.com/js/deployJava.js"></script>
<script>
var versions = deployJava.getJREs();
</script> 
```

[http://java.sun.com/javase/6/docs/technotes/guides/jweb/deployment_advice.html#deplToolkit](http://java.sun.com/javase/6/docs/technotes/guides/jweb/deployment_advice.html#deplToolkit)

这是我发现使用 JavaScript 查找 Java 版本的最佳方法，但要小心使用它，因为它的版本检测实际上取决于操作系统/浏览器，并且在旧浏览器版本或安装了旧 Java 的最新浏览器上，它不会像预期的。花点时间在生产中使用它之前进行真正的测试。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-13T18:38:44.650

查看[Java Deployment Toolkit](http://docs.oracle.com/javase/6/docs/technotes/guides/jweb/deployment_advice.html#deplToolkit)中的代码。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-13T18:39:18.080

谷歌搜索

`detect "java version" using javascript`

产生了几个结果，[这个](http://www.spiration.co.uk/post/1186/Java%20detect%20brower,%20JVM%20vendor,%20Java%20version%20etc)看起来可能有用。本质上，它会尝试加载 Java 小程序，然后 JavaScript 会询问小程序。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-13T18:39:18.203

您可以从这里使用 PluginDetect 库： [http ://www.pinlady.net/PluginDetect/](http://www.pinlady.net/PluginDetect/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-06-14T10:37:59.550

Java版本：

> ```
> /**
>  * @return NULL if not version found. Else return some things like: '1.6.0_31'
>  */
> var JavaVersion: function()
> {
>   var result = null;
>   // Walk through the full list of mime types.
>   for( var i=0,size=navigator.mimeTypes.length; i<size; i++ )
>   {
>       // The jpi-version is the plug-in version.  This is the best
>       // version to use.
>       if( (result = navigator.mimeTypes[i].type.match(/^application\/x-java-applet;jpi-version=(.*)$/)) !== null )
>           return result[1];
>   }
>   return null;
> } 
> ```

是 Java 并且是 Java 启用：

> ```
> var IsJava: function()
> {
>   return typeof(navigator.javaEnabled) !== 'undefined' && navigator.javaEnabled();
> } 
> ```

这些功能适用于 Opera、Firefox、Chrome。我没有IE。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-09-13T16:33:58.197

检测逻辑在 Windows7-64 上的 IE32 中不起作用。它无法检测到它之前安装的 java 版本。

好吧，在进一步阅读之后，Windows 上的 Java 部署工具包使用 ActiveX classid，这可能会将您的应用程序置于黑客面前（参见[http://www.kb.cert.org/vuls/id/886582](http://www.kb.cert.org/vuls/id/886582)）。我出去了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T18:57:58.353

如果您使用 Google Analytics，[这篇文章](http://cowwoc.blogspot.com/2008/12/tracking-java-versions-using-google.html)可能会有所帮助（有关详细信息，请参阅[论坛主题）。](http://forums.java.net/jive/thread.jspa?threadID=53140&tstart=15)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-12-12T04:39:30.750

我发现 Java Deployment Toolkit 提供的 JavaScript 解决方案给出了错误...“deployJava.do_initialize 不是函数”。

我多年来广泛使用的一种适用于所有浏览器的解决方案是**Java 版本显示小程序**。不幸的是，原作者的网站似乎消失了，但您可以在此处下载[Java 版本显示 Applet](http://www.artistscope.com/detect-java.asp)的副本。

# c++ - 编译器之间的 dll 兼容性

> ID：440161
> 
> 赞同：10
> 
> 时间：2009-01-13T18:23:03.930
> 
> 标签：c++, dll, compiler-construction, binary-compatibility

有什么方法可以使使用不同编译器构建的 c++ dll 相互兼容？这些类可以具有用于创建和销毁的工厂方法，因此每个编译器都可以使用自己的 new/delete（因为不同的运行时都有自己的堆）。

我尝试了以下代码，但它在第一个成员方法上崩溃了：

接口.h

```
#pragma once

class IRefCounted
{
public:
    virtual ~IRefCounted(){}
    virtual void AddRef()=0;
    virtual void Release()=0;
};
class IClass : public IRefCounted
{
public:
    virtual ~IClass(){}
    virtual void PrintSomething()=0;
}; 
```

用VC9编译的test.cpp，test.exe

```
#include "interface.h"

#include <iostream>
#include <windows.h>

int main()
{
    HMODULE dll;
    IClass* (*method)(void);
    IClass *dllclass;

    std::cout << "Loading a.dll\n";
    dll = LoadLibraryW(L"a.dll");
    method = (IClass* (*)(void))GetProcAddress(dll, "CreateClass");
    dllclass = method();//works
    dllclass->PrintSomething();//crash: Access violation writing location 0x00000004
    dllclass->Release();
    FreeLibrary(dll);

    std::cout << "Done, press enter to exit." << std::endl;
    std::cin.get();
    return 0;
} 
```

a.cpp 用 g++ 编译 g++.exe -shared c.cpp -o c.dll

```
#include "interface.h"
#include <iostream>

class A : public IClass
{
    unsigned refCnt;
public:
    A():refCnt(1){}
    virtual ~A()
    {
        if(refCnt)throw "Object deleted while refCnt non-zero!";
        std::cout << "Bye from A.\n";
    }
    virtual void AddRef()
    {
        ++refCnt;
    }
    virtual void Release()
    {
        if(!--refCnt)
            delete this;
    }

    virtual void PrintSomething()
    {
        std::cout << "Hello World from A!" << std::endl;
    }
};

extern "C" __declspec(dllexport) IClass* CreateClass()
{
    return new A();
} 
```

编辑：我在 GCC CreateClass 方法中添加了以下行，文本被正确打印到控制台，所以它的函数调用就是杀死它。

```
std::cout << "C.DLL Create Class" << std::endl; 
```

我想知道，COM 是如何设法保持跨语言的二进制兼容性的，因为它基本上所有类都具有继承（尽管只有单个），因此是虚函数。只要我可以维护基本的 OOP 内容（即类和单一继承），如果我不能重载运算符/函数，我就不会感到非常困扰。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T20:17:27.303

如果您降低期望并坚持使用简单的功能，您应该能够混合使用不同编译器构建的模块。

类和虚函数的行为方式由 C++ 标准定义，但实现方式取决于编译器。在这种情况下，我知道 VC++ 构建的对象具有虚函数，在对象的前 4 个字节（我假设是 32 位）中有一个“vtable”指针，它指向一个指向方法条目的指针表点。

所以行：`dllclass->PrintSomething();` 实际上相当于：

```
struct IClassVTable {
    void (*pfIClassDTOR)           (Class IClass * this) 
    void (*pfIRefCountedAddRef)    (Class IRefCounted * this);
    void (*pfIRefCountedRelease)   (Class IRefCounted * this);
    void (*pfIClassPrintSomething) (Class IClass * this);
    ...
};
struct IClass {
    IClassVTable * pVTab;
};
(((struct IClass *) dllclass)->pVTab->pfIClassPrintSomething) (dllclass); 
```

如果 g++ 编译器以任何不同于 MSFT VC++ 的方式实现虚函数表——因为它可以自由执行并且仍然符合 C++ 标准——这将像您所演示的那样崩溃。VC++ 代码期望函数指针位于内存中的特定位置（相对于对象指针）。

继承变得更加复杂，而多重继承和虚拟继承真的非常复杂。

Microsoft 一直非常公开 VC++ 实现类的方式，因此您可以编写依赖于它的代码。例如，许多由 MSFT 分发的 COM 对象标头在标头中都有 C 和 C++ 绑定。C 绑定暴露了它们的 vtable 结构，就像我上面的代码一样。

另一方面，GNU -- IIRC -- 保留了在不同版本中使用不同实现的选项，并且只保证使用它的编译器构建的程序（仅！）将符合标准行为，

简短的回答是坚持使用简单的 C 风格函数、POD 结构（Plain Old Data；即，没有虚函数）和指向不透明对象的指针。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T21:35:23.247

如果你这样做，你几乎肯定是在自找麻烦——虽然其他评论者认为 C++ ABI 在某些情况下可能是相同的，但两个库使用不同的 CRT、不同版本的 STL、不同的异常抛出语义、不同的优化……你正走向疯狂的道路。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-13T20:43:53.243

只要你只使用`extern "C"`函数就可以。

这是因为“C” [ABI](http://en.wikipedia.org/wiki/Application_binary_interface)定义良好，而 C++ ABI 故意没有定义。因此，每个编译器都可以定义自己的。

在某些编译器中，不同版本的编译器甚至具有不同标志的 C++ ABI 会生成不兼容的 ABI。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-13T22:08:29.857

您可能能够组织代码的一种方法是在应用程序和 dll 中使用类，但将两者之间的接口保留为外部“C”函数。这是我使用 C# 程序集使用的 C++ dll 完成的方法。导出的 DLL 函数用于操作可通过静态类* Instance() 方法访问的实例，如下所示：

```
__declspec(dllexport) void PrintSomething()
{
    (A::Instance())->PrintSometing();
} 
```

对于对象的多个实例，让 dll 函数创建实例并返回标识符，然后可以将其传递给 Instance() 方法以使用所需的特定对象。如果您需要在应用程序和 dll 之间进行继承，请在应用程序端创建一个类来包装导出的 dll 函数并从中派生其他类。像这样组织代码将使 DLL 接口在编译器和语言之间保持简单和可移植。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-13T21:18:01.067

我想你会发现[这篇 MSDN 文章很有用](http://msdn.microsoft.com/en-us/library/ms809983.aspx)

无论如何，快速浏览一下您的代码，我可以告诉您，您不应该在接口中声明虚拟析构函数。`delete this`相反，当引用计数降至零时，您需要在 A::Release() 中执行。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-13T20:08:44.000

您确实非常依赖 VC 和 GCC 之间兼容的 v-table 布局。这有点可能没问题。确保调用约定匹配是您应该检查的内容（COM：__stdcall，您：__thiscall）。

重要的是，您在写作方面获得了 AV。当您自己调用方法时没有写入任何内容，因此很可能 operator<< 正在执行轰炸。当使用 LoadLibrary() 加载 DLL 时，std::cout 是否可能被 GCC 运行时初始化？调试器应该告诉。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-02-19T04:26:47.330

导致崩溃的代码问题是接口定义中的虚拟析构函数：

```
virtual ~IRefCounted(){}
    ...
virtual ~IClass(){} 
```

删除它们，一切都会好起来的。问题是由虚函数表的组织方式引起的。MSVC 编译器忽略析构函数，但 GCC 将其作为第一个函数添加到表中。

看看 COM 接口。他们没有任何构造函数/析构函数。永远不要在接口中定义任何析构函数，它会好起来的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T18:58:45.433

有趣.. 如果你也在 VC++ 中编译 dll 会发生什么，如果你在 CreateClass() 中放入一些调试语句会怎样？

我会说您的 2 个不同运行时“版本”的 cout 可能会发生冲突，而不是您的方法调用 - 但我相信返回的函数指针/dllclass 不是 0x00000004？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-05-11T21:40:26.053

您的问题是维护 ABI。尽管编译器相同但版本不同，但您仍然希望维护 ABI。COM是解决它的一种方法。如果你真的想了解 COM 是如何解决这个问题的，那么请查看这篇文章[CPP to COM in msdn](http://msdn.microsoft.com/en-us/library/ms809983.aspx)，它描述了 COM 的本质。

除了 COM，还有其他（最古老的）方法可以解决 ABI，例如使用普通旧数据和不透明指针。[看看](http://techbase.kde.org/Policies/Binary_Compatibility_Issues_With_C++#Techniques_for_Library_Programmers)Qt/KDE 库开发者解决 ABI 的方法。

# wpf - textBoxEmployeeName 与 employeeNameTextBox

> ID：440163
> 
> 赞同：13
> 
> 时间：2009-01-13T18:23:18.673
> 
> 标签：wpf, winforms, naming-conventions, hungarian-notation

您使用哪种命名约定，为什么？

我喜欢使用employeeNameTextBox，因为：

*   从英语的角度来看，这似乎更自然。
*   我发现使用 Intellisense 查找起来更容易。
*   该约定类似于用于事件（MouseClickEvent、MouseClickEventHandler）和依赖属性（VisiblityProperty）的约定。

注意：我使用的是全名而不是缩写（例如“tb”），因为它符合 MS 的命名约定，即避免使用缩写。

[http://msdn.microsoft.com/en-us/library/ms229045.aspx](http://msdn.microsoft.com/en-us/library/ms229045.aspx)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-13T18:40:30.213

首先在名称中使用控件类型 (textBoxEmployeeName) 的唯一原因是为了便于使用 Intellisense 进行分组（然后所有文本框控件将一起显示）。除此之外，使用这种方式确实没有任何好处。我发现第二种方式（employeeNameTextBox）更具可读性并且个人更喜欢这种方式，但很多人仍然会首先使用控件类型，因为这是很长时间以来的方式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-14T13:20:52.653

命名变量非常重要。厚客户端视图约定似乎被赋予了短板。以下是我的想法：

1.  永远不要将实际业务价值的 getter 和 setter 放在您的视图中。不要这样做：

    ```
    public Name EmployeeName { get; set; } 
    ```

2.  要获取或设置 EmployeeName，您的有状态代码应显式调用方法。这样做是因为它表明状态不存储在视图上，但可以从视图派生或转置到视图：

    ```
    public void SetEmployeeName(Name employeeName);
    public Name GetEmployeeName(); 
    ```

3.  匈牙利符号是愚蠢的。它在语言 <= VB6 中很有用，因为它们使用了变量类型的后期绑定。您必须保护自己，因为类型不匹配是运行时错误，而不是编译时错误。仅`txtEmployeeName`当您也将使用`strEmployeeName`and时才使用`intEmployeeNumber`。

4.  如果模式名称的前缀与您的命名约定不一致，请不要为控件类型（表示模式）添加前缀。如果您不创建`commandNameFormatting`（而不是`nameFormattingComamnd`），则不要创建`textBoxEmployeeName`.

5.  您可能需要某种后缀，因为 EmployeeName 不能充分描述变量的用途。EmployeeName 文本框的目的是接收输入。`EmployeeNameTextBox`如果这让您感到舒适，您可以调用它，但调用它可能会更好`EmployeNameInput`。这有一个额外的好处，如果你有一个标签，很明显`EmployeeNamePrompt`（或`EmployeeNameLabel`）与文本框不同。如果没有某种描述性的后缀，您就没有很好的区分方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T19:48:43.540

我（几乎）总是使用 [controltype] [descriptive name]。当我查看代码时，我想立即知道我正在处理哪种类型的控件，如果我不记得名称，智能感知可以帮助我。

仅使用描述性名称 (EmplyeeName) 对我不起作用。什么类型的控制？它是标签、文本框还是组合框？还是字符串？还是文件？控件或变量的类型始终是其中的一部分，这一点非常重要。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T19:54:14.497

我通常尽量保持元素类型简短，后跟一个区别标签。我发现它可以快速传达元素的类型和用途：

```
txtEmployeeName;
lblEmployeeName; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-03-02T17:24:24.687

我提出第三种选择：uiEmployeName。原因：

1.  这不是匈牙利语。你提到的两种符号都只是匈牙利语的味道。
2.  如果您将员工姓名文本框更改为列表框，则无需重命名变量。
3.  一切都在智能感知中很好地分组，而不涉及对象的类型。
4.  对象的名称紧跟其功能。它是一个面向用户的对象，用于获取员工姓名。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-14T14:00:25.070

必读的是Jaime 发布的[XAML 指南：](http://blogs.msdn.com/jaimer/archive/2009/01/13/xaml-guidelines-part-3-draft.aspx)

[还在这里](http://dotnet.org.za/rudi/archive/2009/01/13/xaml-guidelines-released.aspx)阅读更多

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-14T00:11:52.167

当我阅读它时，问题中提到的文章中链接到的文章（即[Names of Resources](http://msdn.microsoft.com/en-us/library/ms229037.aspx)）确实在末尾使用了控件类型`FileMenu`（`ArgumentException`尽管它不是控件）。

我个人的看法是，这也更具可读性，因为它是员工姓名文本框，因此应该命名为`employeeNameTextBox`，就像按顺序读取“文件菜单”一词一样。（尽管为了简洁起见，我用“Edit”代替了“TextBox”——我可能应该改掉这种习惯，使用与环境名称一致的控件名称。）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T18:48:46.423

为什么不是员工姓名？说真的，当您的 IDE 已经提供了控件类型作为名称的一部分时，它如何帮助交付易于维护的代码？考虑[Ottenger 的变量和类命名规则](http://www.chris-lott.org/resources/cstyle/ottinger-naming.html)

ķ

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-03-02T17:49:44.720

**WPF 特定的答案：根本没有名字。**

为什么？因为如果您使用 WPF 进行开发，则不应命名您的控件。如果你是，你做错了什么。

WinForms 需要命名控件，因为它的数据绑定非常弱。WPF 解决了所有这些问题：控件本身可以指定其数据和行为，因此无需命名。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-08-19T08:59:52.657

我想最好遵循 Microsoft 的[对象命名约定](https://msdn.microsoft.com/en-us/library/aa263493(v=vs.60).aspx)，以便在 C# 和 Visual Basic 中命名您的控件。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-14T13:48:33.330

我已经使用了 txtEmployeeName 和 employeeNameTextbox。像许多所示的帖子一样，这有助于分组。一个按控件类型（txtEmployeeName，txtManagerName）分组，而另一个可以将不同的相关控件组合在一起（employeeNameTextbox，employeePhoneTextbox，managerNameTextBox，managerPhoneTextbox）。在许多情况下，我发现后者在编码时更有用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-14T14:06:39.470

你应该做任何使你的代码可读和自我记录的事情。遵循硬性规定总是一个错误，因为它们几乎从不涵盖需要完成的所有方面。有指导方针（例如不使用匈牙利符号）并没有错，但更重要的是，无论是什么命名约定，您都必须与您的命名约定保持一致和清晰，而不是遵循互联网上的一些规则。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-03-02T17:18:58.833

想法：

1.  避免编码/缩写。

2.  该名称应从相同范围内的相似名称中脱颖而出。使最独特的部分成为最左边的部分。我怀疑您有多个文本框，但只有一个是员工姓名。

3.  避免不必要的上下文。这个页面上的所有名字都是关于员工的吗？它是“员工”页面吗？那么 EmployeeName 是多余的。NameBox 或 NameControl 应该足够了。

4.  避免不必要的上下文：您有不是控件的名称吗？如果是这样，“Box”或“Control”很有用，否则就没那么多用了。

披露：我是“ottinger 命名规则”中的“ottinger”，也演变为“清洁代码”的第 2 章。[请参阅http://agileinaflash.blogspot.com/2009/02/meaningful-names.html](http://agileinaflash.blogspot.com/2009/02/meaningful-names.html)上的简短表格

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-13T20:00:48.040

我不推荐任何形式的匈牙利符号。textBoxEmployeeName 是匈牙利符号的一种形式。所以我支持使用employeeNameTextBox。

就我个人而言，我什至不费心使用 TextBox 这个词，因为这对变量来说并不重要。重要的是“员工”和“姓名”。添加单词 TextBox 不仅会将您锁定在某种类型中，而且还会使更改该类型变得更加困难，因为您需要更改名称以规范您的代码并使其正确。假设由于某种原因您将其作为 TextBox 开始，但后来您收到将其更改为 DropDownList 或其他类型的要求，现在您必须更新所有代码和 JavaScript 以使其显示为 DropDownList 而不是 TextBox。

忘记尝试键入变量名称并简单地命名它们要容易得多。您有智能感知和编译时错误检查是有原因的，为什么不使用它。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-13T18:46:47.923

我会选择**[controlType][DomainTerm]**，在这种情况下是***textBoxEmployeeName***。原因是，在为您背后的 C# 代码编码时，比域特定术语更关心 UI 控件。UI(View) 端编码我们需要更快地识别/识别控件类型，这比域重要一点View side 中的特定名称，并且由于我们从“***从左到右***”阅读此命名约定是相关的。我通常使用 txtEmployeeName 或 cmpEmployeeType ，但根据 MS 指南，首选 textBox 而不是 txt

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-12-02T03:45:08.517

在 VB 中，我实际上喜欢使用 [ControlName]_[ControlType]。我不记得我是如何开始这样做的，但我想这是因为它感觉像是一个合乎逻辑的顺序。它还稍微简化了编码，因为代码建议是按控件描述而不是控件类型分组的。

我在 C# 中以相同的方式命名控件，只是我遵循 C# 对 camelCase 的偏好：[controlName]_[controlType]。

我也倾向于使用我自己的控件类型的缩写，尽管它们并不含糊。

例子：

**VB：** `Save_Btn`和`NewFile_MItem`（菜单项）

**C#：** `save_btn`和`newFile_mItem`

它对我有用，但当然每个程序员都有自己的风格。

# c++ - C++ 文件处理（结构）

> ID：440167
> 
> 赞同：2
> 
> 时间：2009-01-13T18:23:57.457
> 
> 标签：c++, file, file-io, fstream

下面的代码，当用 g++ 编译和运行时，打印 '1' 两次，而我希望 '1' 只打印一次，因为我将单个结构转储到文件中，但是在回读时它似乎正在读取两个结构. 为什么？

```
#include <iostream.h>
#include <fstream.h>

int main(){
    struct student
    {
        int rollNo;
    };
    struct student stud1;
    stud1.rollNo = 1;

    ofstream fout;
    fout.open("stu1.dat");
    fout.write((char*)&stud1,sizeof(stud1));
    fout.close();

    ifstream filin("stu1.dat");
    struct student tmpStu;
    while(!filin.eof())
    {
          filin.read((char*)&tmpStu,sizeof(tmpStu));
      cout << tmpStu.rollNo << endl; 
    }
    filin.close();
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T18:29:07.147

`eof`仅在读取失败后设置，因此读取运行两次，第二次不修改缓冲区。

试试这个：

```
while(filin.read((char*)&tmpStu,sizeof(tmpStu)))
{
    cout << tmpStu.rollNo << endl; 
} 
```

或者

```
while(!filin.read((char*)&tmpStu,sizeof(tmpStu)).eof())
{
    cout << tmpStu.rollNo << endl; 
} 
```

Read 在调用时返回对 filin 的引用，如果流仍然良好，它将评估为 true。当 read 无法读取更多数据时，引用将评估为 false，这将阻止它进入循环。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T18:29:40.157

您的 while 循环执行了两次，因为 EOF 条件在第一次尝试读取文件末尾之后才为真。所以 cout 被执行了两次。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T18:33:51.460

由于确切的方式`eof`和`read`工作，这会打印 1 两次。如果您在文件的最后，`read`将失败，然后调用`eof` *返回*true。如果您没有尝试读取超过文件末尾的内容，`eof`则将返回 false，因为流未处于 EOF 状态，即使没有更多数据可供读取。

总而言之，您的调用如下所示：

```
eof - false (at beginning of file)
read (at beginning of file)
eof - false (now at end of file, but EOF not set)
read (at end of file. fails and sets EOF state internally)
eof - true (EOF state set) 
```

更好的策略是在通话`eof`后立即检查。`read`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T18:30:53.807

我相信这是因为您正在检查 filin.eof() 并且直到您第二次阅读才会如此。

见[这里](http://www.cplusplus.com/reference/iostream/istream/read.html)。它注意到 eofbit 设置为“......在读取 n 个字符之前到达字符源的末尾......”。在您的情况下，您不会在第二次阅读之前点击 EOF。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T19:11:23.943

凉爽的。另一种方式（由专家交流提供，我在那里问了同样的问题:-)）

```
while(filin.peek() != EOF)
{
    filin.read((char*)&tmpStu,sizeof(tmpStu));
    cout << tmpStu.rollNo << endl;
} 
```

# sql-server - 工作流/业务流程应用的数据模型

> ID：440172
> 
> 赞同：0
> 
> 时间：2009-01-13T18:25:45.533
> 
> 标签：sql-server, database, database-design, entity-attribute-value

工作流应用程序的数据模型应该是什么？目前，我们在 SQL Server 2000 中使用基于实体属性值的模型，用户能够创建动态表单（在 asp.net 上），但随着数据的增长，性能正在下降，难以生成报告，如果太多，情况会更糟用户同时查询数据（EAV）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T14:13:49.707

您可能已经意识到，EAV 模型的问题在于表会变得非常大，而查询会很快变得非常复杂。例如，基于 EAV 的查询通常需要大量子查询才能获取相同的数据，如果您使用的是更传统的结构化表，那么选择这些数据将是微不足道的。

不幸的是，在迁移到传统结构的关系模型的*同时让旧的形式可以修改是相当困难的。*

**因此，我的建议是：**考虑*关闭*对成熟表格的更改并将其数据移动到标准的规范化表格中。例如，如果您有一组不太可能更改的运输表格（或者您可以通过更改应用程序来管理其更改，因为它很少发生），那么您可以创建一个固定表，然后将现有数据复制出您的 EAV 表。这将 A) 提高您进行报告的能力，B) 减少现有 EAV 表中的数据量和 C) 提高您支持并发用户的能力/提高性能，因为您可以在数据中构建更合适的索引。

简而言之，将基于 EAV 的动态系统视为收集用户需求的一种方式（他们通过构建表单来告诉您）而不是永久存储。随着表格演变为最终形式，您将转换为固定表格以获得上述好处。

最后一件事。如果所有这些都不可能，您是否考虑过将您的 EAV 表分割成多个特定类别的表？例如，将所有运输表格放在一张表中，将人员表格放在一张表中，等等。它不会解决查询结构问题（需要子查询），但有助于缩小表格并提高性能。

我希望这会有所帮助——我对你的困境表示同情，因为我自己也遇到过类似的情况！

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-14T13:51:28.987

尝试使用数据的关系模型。有用。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-13T18:52:19.737

通常，当您的数据库架构变得非常大并且多个用户试图以多种不同方式访问相同的信息时，会应用[数据仓库](http://en.wikipedia.org/wiki/Data_warehousing "数据仓库")来减少数据库服务器上的主要负载。与您很可能使用规范化来保持数据完整性的传统模式不同，数据仓库针对速度进行了优化，并且存储了多个数据副本。

# linux - linux c/c++编程telnet连接io重定向

> ID：440175
> 
> 赞同：0
> 
> 时间：2009-01-13T18:25:58.590
> 
> 标签：linux, redirect, io, telnet

我有一台计算机（比如计算机 A），只要计算机 A 通过特定的 telnet 端口建立连接，它就会启动一个程序。

计算机 A 上的这个程序处理登录、身份验证等。它可以做的工作之一是接收文件。它通过启动 gKermit 来处理这个问题。

```
`/usr/local/bin/gkermit -e 8000 -w -a /location/x/ -ir`
```

`我在计算机 B 上有第二个程序。第二个程序将连接到计算机 A`

 ````
`mPid = forkpty(&mPort, buffer, &mCurrTermattr, NULL);
...
if child
{
    execl("/usr/bin/telnet", "telnet", mComPort.name.c_str(), NULL);
}`
```

`现在程序的父进程可以使用文件描述符mPort来发送接收数据了。（即像登录计算机 A，并告诉它接收文件）`

 `问题是当计算机 B 启动 gKermit 发送文件时，它无法与计算机 A gKermit 通信。

```
`system(gkermit -d gkermit.txt -X -e 8000 -i -s testfile.txt)`
```

`有人会认为，如果我们正在使用 mPort 进行交谈，我们可以通过执行以下操作重定向计算机 B 系统调用 stdio 以使用该 mPort：`

 ````
`dup2(mPort, STDIN_FILENO)`
```

`然而这并不能解决问题。任何帮助，将不胜感激。`

 `* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-14T10:52:51.343

我可能错了，但是您需要重定向标准输出（如果 kermit 通信是双向的，则可能需要重定向标准输入）。另外，我有点好奇什么是 mPort，一个管道？你读和写它吗？通常，您有两个文件描述符，一个用于读取，一个用于写入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T20:42:28.923

感谢 jpalecek 的回复，

似乎添加：

```
dup2(mPort, STDOUT_FILENO)
```

现在允许 gKermint 双向通信。这当然是有道理的。啊

# svn - 每晚将 TFS 同步到 SVN

> ID：440178
> 
> 赞同：5
> 
> 时间：2009-01-13T18:27:52.453
> 
> 标签：svn, tfs

我们的开发部门将在我们的项目中使用 Team Foundation Server，但我们需要每晚与公司标准 SVN 服务器同步。有什么好的方法可以同步它们（TFS 到 SVN），比如运行 SVN 添加、删除和提交的夜间计划任务？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T18:31:11.030

你看过[tfs2svn](http://sourceforge.net/projects/tfs2svn/)吗？

还有[SvnBridge](http://www.codeplex.com/SvnBridge)项目。我想你可以对 SvnBridge 使用 svnsync 但我还没有尝试过。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T19:02:47.487

你可以试试[svnbridge](http://www.codeplex.com/SvnBridge)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T17:38:11.023

您是否有可能只使用 TFS 上的构建任务每晚“获取最新”到特定网络位置，然后有另一个任务将其提交到中央存储库？

更好的是，您能否设置一些在每次签入 TFS 时执行相同操作的东西？这样，您可以确保两个存储库具有相同的 VC 历史记录，而您建议的解决方案（以及我的第一个）只为您提供当天正确的版本历史记录，而不是签入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T18:35:29.880

是的，我看过 tfs2svn ，这似乎是另一种方式，主要使用 SVN 并将其存储在 TFS 存储库中。我正在寻找的是一种主要在 TFS 中工作并推送到 SVN 存储库的方法。

# c++ - 如何在 C++ 中创建强密码字符串？

> ID：440200
> 
> 赞同：1
> 
> 时间：2009-01-13T18:32:34.380
> 
> 标签：c++, string, passwords

想用 C++ 创建一个强密码。有什么建议么？

*   我认为它应该使用字母（大写和小写）、数字、特殊字符。

*   能够指定最小长度会很好。

*   最好避免使用难以在视觉上区分的字符，例如“O”和“O”

*   将所有相同的字符、字典单词、颠倒的单词、名称都作废会很棒。

还有其他提示吗？我在哪里可以找到这样的代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T18:39:31.167

有几种方法。简单的不一定是最好的

创建一个代表您要定义的所有字符的字符串（意思是没有 O 或 0，等等），然后用该集合中的随机字符填充一个随机长度的字符串。

下一步是继续生成，直到您通过所有断言。也就是说，检查字典单词、反向名称等。

有时生成所需的时间比预期的要长，但仍应该比您注意到的要快。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T19:01:45.163

您可以使用[OpenSSL 的随机生成器](http://www.tech-recipes.com/rx/1264/generate-passwords-with-openssl/)，然后对其进行 base64 编码。（不会得到各种随机字符，但会得到很多。）。遗憾的是，它也不会执行类似的字符密码位。我最喜欢的生成器在[这里](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fwww.pctools.com%2Fguides%2Fpassword%2F&ei=D-VsSfDVCozAMcvk2egM&usg=AFQjCNEeees-AWn2siyPdmTGuNJNbHa3bQ&sig2=upiKOPd3YnGxmLsSNBWBEg)，它提供了您正在谈论的功能。（遗憾的是，仅限网络）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T19:09:33.353

[APG](http://www.adel.nursat.kz/apg/download.shtml)（自动密码生成器）实现了除您的最后一个要求之外的所有要求（没有字典单词/用户名/重复字符）。它包括可发音和完全随机的密码生成算法。可发音的密码如下所示：

```
耶夫盖伊拉
克利沙霍普
犹太人Ams8
RacMevOm
杜赫姆奇&
雷克桑~
```

它是用 C 语言编写的，可以在类似 BSD 的许可证下使用。

从密码学上讲，我不确定您的最后一个要求是否有效......？如果密码生成是真正随机的，那么密码 的`aaaaaaaa`可能性与密码的 相同`6-n&1jIK`，并且如果您的攻击者知道您的算法，那么通过禁止密码之类`aaaaaaaa`的，您正在减少攻击者的搜索空间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T18:37:22.357

您可以尝试使用[TRNG](http://en.wikipedia.org/wiki/TRNG)设备加上一些[众所周知的算法](http://en.wikipedia.org/wiki/Message_digest)，这是最好的方法；）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T19:10:26.487

有几个来源使用的书面要求，例如[FIPS 181](http://www.itl.nist.gov/fipspubs/fip181.htm)。

我建议查看流行的[自动密码生成器](http://www.adel.nursat.kz/apg/)实用程序的文档。查看它提供的选项和功能可能对您有很大帮助。

此外，请[检查](http://en.wikipedia.org/wiki/Password_strength)您生成的密码，使其符合您的应用程序的阈值。

维基百科还列出了一些[现有的设计](http://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator)和标准。

# c - floor() 是否返回完全可表示的东西？

> ID：440204
> 
> 赞同：10
> 
> 时间：2009-01-13T18:33:26.797
> 
> 标签：c, floating-point, ieee-754, c89, floor

在 C89 中， floor() 返回一个双精度值。以下是否保证工作？

```
double d = floor(3.0 + 0.5);
int x = (int) d;
assert(x == 3); 
```

我担心的是 floor 的结果在 IEEE 754 中可能无法完全表示。所以 d 得到类似 2.99999 的结果，x 最终为 2。

对于这个问题的答案是肯定的，一个 int 范围内的所有整数都必须可以精确地表示为双精度数，并且 floor 必须始终返回该精确表示的值。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-13T18:37:08.257

如果您的浮点类型支持所需的尾数位，则所有整数都可以具有精确的浮点表示。由于尾数使用 53 位，因此可以准确`double`存储所有 32 位。`int`毕竟，您可以将值设置为指数为零的尾数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T18:41:27.623

如果 floor() 的结果不能完全表示，您期望 d 的值是多少？当然，如果您在变量中*获得*了浮点数的表示，那么根据定义，它是完全可表示的，不是吗？你*有*代表在d ...

（此外，Mehrdad 的答案对于 32 位整数是正确的。在具有 64 位双精度*和*64 位整数的编译器中，您当然会遇到更多问题......）

编辑：也许您的意思是“ floor() 的理论结果，即小于或等于参数的最大整数值，可能无法表示为 int”。这当然是真的。在 int 为 32 位的系统中显示这一点的简单方法：

```
int max = 0x7fffffff;
double number = max;
number += 10.0;
double f = floor(number);
int oops = (int) f; 
```

我不记得当从浮点转换为整数溢出时 C 做了什么……但它会在这里发生。

编辑：还有其他有趣的情况需要考虑。这是一些 C# 代码和结果 - 我想至少在 C 中会发生*类似*的事情。在 C# 中，`double`定义为 64 位，`long`.

```
using System;
class Test
{
    static void Main()
    {
        FloorSameInteger(long.MaxValue/2);
        FloorSameInteger(long.MaxValue-2);
    }

    static void FloorSameInteger(long original)
    {
        double convertedToDouble = original;
        double flooredToDouble = Math.Floor(convertedToDouble);
        long flooredToLong = (long) flooredToDouble;

        Console.WriteLine("Original value: {0}", original);
        Console.WriteLine("Converted to double: {0}", convertedToDouble);
        Console.WriteLine("Floored (as double): {0}", flooredToDouble);
        Console.WriteLine("Converted back to long: {0}", flooredToLong);
        Console.WriteLine();
    }
} 
```

结果：

> 原始值：4611686018427387903
> 转换为双倍：4.61168601842739E + 18
> 楼层（如双）：4.61168601842739E + 18
> 转换回长达：4611686018427387904
> 
> 原装值：9223372036854775805
> 转换为双倍：9.22337203685478e + 18
> 楼层（如双）：9.22337203685478e + 18
> 转换回长：-9223372036854775808

换句话说：

```
(long) floor((double) original) 
```

并不总是相同`original`。这应该不足为奇 - long 值比双精度值（给定 NaN 值）更多，并且大量双精度值不是整数，因此我们不能期望每个 long 都可以精确表示。但是，所有 32 位整数*都可以*表示为双精度数。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-11T09:30:07.157

我认为您对要问的内容有些困惑。`floor(3 + 0.5)`这不是一个很好的例子，因为 3、0.5 和它们的总和都可以在任何现实世界的浮点格式中精确表示。`floor(0.1 + 0.9)`将是一个更好的例子，这里真正的问题不是结果`floor`是否完全可表示，而是如果所有数字都是准确的，调用*之前*`floor`数字的不准确是否会导致返回值与您期望的不同。在这种情况下，我相信答案是肯定的，但这在很大程度上取决于您的特定数字。

`(1.0+0x1p-52)`如果它不好，我邀请其他人批评这种方法，但一种可能的解决方法可能是在调用之前将您的号码乘以或类似的东西`floor`（也许使用`nextafter`会更好）。这可以补偿数字的最后一个二进制位中的错误导致它刚好低于而不是正好落在整数值的情况，但它不会考虑在多次操作中累积的错误。如果您需要那种级别的数值稳定性/精确性，您需要进行一些深入分析或使用可以正确处理您的数字的任意精度或精确数学库。

# java - 如何将 Enter 指定为 Java 应用程序中所有 JButton 的触发键？

> ID：440209
> 
> 赞同：12
> 
> 时间：2009-01-13T18:34:07.107
> 
> 标签：java, swing, events, jbutton

我正在使用 Metal 外观编写 Java Swing 应用程序。每次在我的应用程序中有一个 JButton 时，用户使用 Tab 键将焦点移到按钮上，然后按 Enter 键。没发生什么事！如果他按下 Space 键，则触发按钮事件。如何分配 Enter 键来触发与 Space 键相同的事件？感谢您的帮助。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-13T19:57:17.687

我发现了以下内容：

[http://tips4java.wordpress.com/2008/10/25/enter-key-and-button/](http://tips4java.wordpress.com/2008/10/25/enter-key-and-button/)

Rob Camick 写道，在使用 JDK5 及更高版本时，您只需添加...

```
UIManager.put("Button.defaultButtonFollowsFocus", Boolean.TRUE); 
```

...到应用程序来解决问题。这对我有用！我无法想象任何更简单的事情。但是，当使用较旧版本的 Java 时，您将不得不像 Richard 和 Peter 在他们对这个问题的回答中所描述的那样做一些事情。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T19:34:33.803

这是完整的例子。Richard 很接近，但您还需要将按下的 ENTER 映射到操作，而不仅仅是释放。为了使其适用于所有按钮，我已将此映射设置为按钮的默认输入映射。添加导入，它应该是可运行的。

* * *

```
public class Main implements Runnable {
    public static void main(String[] args) {
        SwingUtilities.invokeLater(new Main());
    }

    @Override
    public void run() {
        setupEnterActionForAllButtons();

        JFrame frame = new JFrame("Button test");
        frame.getContentPane().add(createButton(), BorderLayout.NORTH);
        frame.getContentPane().add(createButton(), BorderLayout.SOUTH);
        frame.pack();
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        frame.setVisible(true);
    }

    private void setupEnterActionForAllButtons() {
        InputMap im = (InputMap) UIManager.getDefaults().get("Button.focusInputMap");
        Object pressedAction = im.get(KeyStroke.getKeyStroke("pressed SPACE"));
        Object releasedAction = im.get(KeyStroke.getKeyStroke("released SPACE"));

        im.put(KeyStroke.getKeyStroke("pressed ENTER"), pressedAction);
        im.put(KeyStroke.getKeyStroke("released ENTER"), releasedAction);
    }

    private JButton createButton() {
        JButton b = new JButton("press enter");
        b.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                System.out.println("Pressed");
            }
        });

        return b;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-14T02:46:41.713

实际上，这是一个外观问题。哪个键触发聚焦按钮取决于（并且应该）外观和感觉。

“默认按钮”解决方法有效，因为您使用的 L&F 使用 enter 作为默认按钮。

Peter 的解决方法明确更改了 L&F 默认的“焦点操作”键——如果你问我，这更有说服力。

我要补充一点，我认为很多用户不会想按到按钮然后按 Enter 键（大多数人甚至不会注意到焦点指示器）——他们希望默认操作是“正确”的操作，并且在他们按下的任何地方都可以工作进入。正如理查德建议的那样，这只能通过输入映射来完成。

我当然建议在全局更改任何内容之前，清楚地了解用户的实际需求和期望（最好参考他们使用的其他应用程序）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T18:55:08.593

您可以通过为 Enter 键分配输入/操作映射来完成此操作。类似于以下内容：

```
// save the command mapping for space
Object spaceMap = button.getInputMap.get(KeyStroke.getKeyStroke(KeyEvent.VK_SPACE, 0, true));
// add a mapping from enter to the same command.
button.getInputMap().put(KeyStroke.getKeyStroke(KeyEvent.VK_ENTER, 0, true),spaceMap); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T19:18:34.710

您还可以将“默认按钮”设置为最近关注的按钮。

我在一个应用程序上这样做了，所有这样做的方法都是维护和调试的噩梦。事实是，这显然不是 Swing 的设计者想要实现的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-09-15T13:33:52.067

对上述答案的扩展与无线电、复选框相同。在创建组件之前调用它

```
void setupEnterAction(String componentName){
    String keyName = componentName + ".focusInputMap";
    InputMap im = (InputMap) UIManager.getDefaults().get(keyName);
    Object pressedAction = im.get(KeyStroke.getKeyStroke("pressed SPACE"));
    Object releasedAction = im.get(KeyStroke.getKeyStroke("released SPACE"));
    im.put(KeyStroke.getKeyStroke("pressed ENTER"), pressedAction);
    im.put(KeyStroke.getKeyStroke("released ENTER"), releasedAction);
}

public void setEnterEvent(){
    setupEnterAction("Button");
    setupEnterAction("RadioButton");
    setupEnterAction("CheckBox");
} 
```

# latex - 如何在乳胶表中连续组合单元格？

> ID：440228
> 
> 赞同：19
> 
> 时间：2009-01-13T18:38:57.940
> 
> 标签：latex, tex

在一个表中，我想组合一些列，但不是在所有行中。我怎样才能用 LaTeX 实现这一点？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-01-13T18:44:01.347

`\multicolumn{<number>}{<formatting>}{<contents>}`

论据在哪里

1.  要合并的列数
2.  对齐和格式化字符串（就像您在表头中使用的一样，即“ `|c|`”等）
3.  要放入合并列的内容

此命令仅替换`<number>`列并内联使用。

* * *

**加法：**这也是您更改表格仅一行中单个字段格式的方式。只需使用`\multicolumn{1}{<new format>}{<contents>}`.

# .net - 到 PerformanceCounter 还是编写自定义监控？

> ID：440232
> 
> 赞同：4
> 
> 时间：2009-01-13T18:39:24.663
> 
> 标签：.net, monitoring, performancecounter

我有一个 Windows 服务，它跨多个线程运行框架的实现。每个正在运行的实例都有几个共同点，我需要跟踪它们，例如，处理的项目数量、上次处理项目的时间等。在此基础监控数据之上，我想在框架以允许实现动态添加自己的监控数据。

我以前使用过 PerformanceCounters，虽然它们提供了不错的功能，但我发现创建和维护它们的代码非常繁琐，并且加载了与实例相关的陷阱的可能性（即硬编码计数器实例名称、类别名称和计数器类型）。此外，我不确定是否可以在不编写大量代码的情况下提供简单的基本功能动态计数器创建。

有没有人使用 PerformanceCounters 实现过类似的东西？如果是这样，你会推荐它吗？如果没有，是否有人建议我可以轻松地将性能/健康监控数据写入不会引入 1）很多减速和 2）另一个故障点的介质？

谢谢，如有必要，我很乐意补充说明，因为我知道这有点含糊。

**结论：**

我最终实现了性能计数器。这有点像 PITA（呵呵），但我的老板真的很喜欢这个想法，现在我已经想通了，还不错。我希望通过一种更简单的方式来呈现分层数据，从而更容易配置一些东西。但这很好用，而且很难与内置界面争论。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T18:53:24.290

同意，将利用性能计数器的代码放在一起可能需要一些时间。但是，上次我这样做时，我将它全部封装在一个很好的可重用类中。它使我在整个代码库中使用性能计数器变得更加简单，并且摩擦最小。

最终结果对我来说非常值得，因为存在于 perf 计数器之上的工具（perfmon 是一大福音）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T22:08:58.670

您是否考虑过使用 Enterprise Library 中的 Instrumentation 类？不能说任何赞成/反对 EntLib 的东西，但它似乎越来越受欢迎，而且微软似乎还在继续投资它......

[http://msdn.microsoft.com/en-us/library/dd203352.aspx](http://msdn.microsoft.com/en-us/library/dd203352.aspx)

# regex - Vim 大小写无关的正则表达式

> ID：440258
> 
> 赞同：10
> 
> 时间：2009-01-13T18:49:23.597
> 
> 标签：regex, vim

我曾多次遇到以下情况，我想知道在 Vim 中是否有一种快速的方法来处理它。

我将有一个如下的源文件：

```
#ifndef _FOO_H_
#define _FOO_H_

class Foo {
    Foo(int foo);
};
#endif 
```

我想将其转换为以下内容：

```
#ifndef _BAR_H_
#define _BAR_H_

class Bar {
    Bar(int bar);
};
#endif 
```

所以，我想要所有的 foo -> bar，但要保持原来的大小写。现在，我一直在用 3 或 4 个不同的正则表达式来做这件事，但似乎应该有更好的方法。有任何想法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T18:57:06.280

[此脚本](http://www.vim.org/scripts/script.php?script_id=6)将执行保留大小写的搜索/替换。

将脚本复制到插件目录 ( `~/.vim/plugin`)，然后执行

```
:set ic
:%s/foo/\=KeepCaseSameLen(submatch(0), 'bar')/g 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-26T02:15:30.290

Tim Pope 的[Vim Abolish](https://github.com/tpope/vim-abolish)插件可以做到这一点，甚至更多。`:%Subvert/string/new string/g`将保留大小写、大小写等，并且该插件还支持使用`{var1,var2}`语法的单词变体。很有用。

# java - Java 泛型：列表 > = 新的链表 >() 被禁止？

> ID：440262
> 
> 赞同：11
> 
> 时间：2009-01-13T18:51:44.793
> 
> 标签：java, generics

为什么，在Java中，我可以写

```
List<?> list = new LinkedList<Double>(); 
```

但不是

```
List<Container<?>> list = new LinkedList<Container<Double>>(); 
```

Container 就像

```
public class Container<T> { ... } 
```

这是因为我有一个接受 a 的方法`List<Container<?>>`，并且我想使用 Arrays.asList 将参数传递给它：

```
process(Arrays.asList(new Container<Double>(), new Container<Double>())); 
```

但是语言不允许这样做，因为它推断出的类型`Arrays.asList`是`List<Container<Double>>`，而那是不可分配给的`List<Container<?>>`。

如果我在调用中添加一个字符串参数化的容器，

```
process(Arrays.asList(new Container<Double>(), new Container<String>())); 
```

它仍然不起作用，因为它推断出`List<Container<? extends Serializable & Comparable<?>>>`Arrays.asList 的类型。只有当我传入既不是 Comparable 也不是 Serializable 的东西时，它才能正常工作。

当然，我可以进行强制转换并让编译器闭嘴，但我想知道我是否在这里做错了什么。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-13T19:03:37.577

每个参数化都必须使用通配符：

```
List<? extends Container<?>> list = new LinkedList<Container<Double>>(); 
```

编辑：我在[Angelika Langer 的常见问题解答](http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html)中搜索解释，但没有找到（它可能在那里，但隐藏在 500 页的某个地方）。

考虑这一点的方法是每个参数化都是独立的，除非您明确说明，否则编译器不会推断有关参数化的信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T20:21:04.223

> 编辑：我在 Angelika Langer 的常见问题解答中搜索解释，但没有找到（它可能在那里，但隐藏在 500 页的某个地方）。

非常感谢您的回答。我在常见问题解答中找到了一个解释，经过一番斜视之后，我想我明白了。

[http://www.angelikalanger.com/GenericsFAQ/FAQSections/TypeArguments.html#What%20do%20multilevel%20wildcards%20mean](http://www.angelikalanger.com/GenericsFAQ/FAQSections/TypeArguments.html#What%20do%20multilevel%20wildcards%20mean)？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T17:07:20.347

想想如果可以的话会发生什么。

```
List<Container<Double>> list1 = new LinkedList<Container<Double>>();
List<Container<?>> list2 = list1; // this shouldn't be allowed, because of the below
Container<String> foo = new Container<String>();
foo.add("hi");
list2.add(foo); // legal, because Container<String> is a subtype of Container<?>
Container<Double> bar = list1.get(0);
Double x = bar.get(0); // type error; it is actually a String object
                       // this indicates that type safety was violated 
```

但是， using`List<? extends Container<?>>`没有这个问题，因为您不能将任何东西（除了`null`）放入这种类型的列表中（因为没有类型可以保证是“ `? extends Container<?>`”的子类型）。

# .net - 如何异步获取文本框的自动完成数据？

> ID：440277
> 
> 赞同：8
> 
> 时间：2009-01-13T18:56:14.520
> 
> 标签：.net, winforms, autocomplete

我们的**WinForms**应用程序会延迟加载数据以自动完成文本框。其伪代码如下；

1.  TextBox 中的用户类型
2.  在输入 pause 时，确定我们是否需要获取自动完成数据
3.  在工作线程中，联系服务器并获取数据
4.  调用回 UI 线程
5.  放`textBox.AutoCompleteCustomSource = fetchedAutoCompleteStringCollection;`
6.  强制文本框下拉它的自动完成下拉菜单。

我目前在使用#6 时遇到问题。作为 hack，我执行以下操作来模拟有效的按键，但它并非在所有情况下都有效。

```
 // This is a hack, but the only way that I have found to get the autocomplete
     // to drop down once the data is returned.
     textBox.SelectionStart = textBox.Text.Length;
     textBox.SelectionLength = 0;
     SendKeys.Send( " {BACKSPACE}" ); 
```

肯定有更好的办法。我不敢相信我是唯一一个异步获取自动完成数据的人。我应该怎么做？

**编辑：** Win32 调用导致自动完成下拉是可以接受的。如果必须，我不介意 PInvoking。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-12-01T15:56:24.850

我只使用托管代码为 TextBox 编写了一个异步自动完成类。希望能帮助到你。

```
using System;
using System.Windows.Forms;
using System.Collections.Generic;
using System.Text;
using System.ComponentModel;

namespace TextboxAutocomplete
{
    public abstract class AutoCompleteSource
    {
        private TextBox mTextBox;
        private AutoCompleteMode mAutoCompleteMode;

        public AutoCompleteSource(TextBox textbox) :
            this(textbox, AutoCompleteMode.Suggest) { }

        public AutoCompleteSource(TextBox textbox, AutoCompleteMode mode)
        {
            if (textbox == null)
                throw new ArgumentNullException("textbox");

            if (textbox.IsDisposed)
                throw new ArgumentException("textbox");

            mTextBox = textbox;
            mAutoCompleteMode = mode;

            mTextBox.AutoCompleteSource = System.Windows.Forms.AutoCompleteSource.None;

            BackgroundWorker autoCompleteLoader = new BackgroundWorker();
            autoCompleteLoader.DoWork += new DoWorkEventHandler(autoCompleteLoader_DoWork);
            autoCompleteLoader.RunWorkerCompleted += new RunWorkerCompletedEventHandler(autoCompleteLoader_RunWorkerCompleted);
            autoCompleteLoader.RunWorkerAsync();
        }

        void autoCompleteLoader_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
        {
            AutoCompleteStringCollection collection = e.Result as AutoCompleteStringCollection;
            if (collection == null) return;

            if (mTextBox.InvokeRequired)
            {
                mTextBox.Invoke(new SetAutocompleteSource(DoSetAutoCompleteSource), new object[] { collection });
            }
            else
            {
                DoSetAutoCompleteSource(collection);
            }
        }

        protected void DoSetAutoCompleteSource(AutoCompleteStringCollection collection)
        {
            if (mTextBox.IsDisposed) return;

            mTextBox.AutoCompleteMode = mAutoCompleteMode;
            mTextBox.AutoCompleteSource = System.Windows.Forms.AutoCompleteSource.CustomSource;
            mTextBox.AutoCompleteCustomSource = collection;
        }

        void autoCompleteLoader_DoWork(object sender, DoWorkEventArgs e)
        {
            List<string> autoCompleteItems = GetAutocompleteItems();
            if (autoCompleteItems == null) return;
            AutoCompleteStringCollection collection = new AutoCompleteStringCollection();
            collection.AddRange(GetAutocompleteItems().ToArray());
            e.Result = collection;
        }

        protected abstract List<string> GetAutocompleteItems();
    }

    internal delegate void SetAutocompleteSource(AutoCompleteStringCollection collection);
} 
```

示例实现：

```
using System;
using System.Windows.Forms;
using System.Collections.Generic;
using System.Text;

namespace TextboxAutocomplete
{
    class MockAutoCompleteSource : AutoCompleteSource
    {
        public MockAutoCompleteSource(TextBox textbox)
            : base(textbox)
        {

        }

        protected override List<string> GetAutocompleteItems()
        {
            List<string> result = new List<string>();
            for (int i = 0; i < 2500; i++)
            {
                result.Add(Guid.NewGuid().ToString());
            }

            return result;
        }
    }
} 
```

如何使用它：

```
 ...
 TextBox myTextbox = new TextBox();
 MockAutoCompleteSource autoComplete =
      new MockAutoCompleteSource(myTextbox);
 ... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T21:10:32.313

通常，您将使用 COM 互操作并访问[`IAutoComplete`](http://msdn.microsoft.com/en-us/library/windows/desktop/bb776292%28v=vs.85%29.aspx)、[`IAutoComplete2`](http://msdn.microsoft.com/en-us/library/windows/desktop/bb776288%28v=vs.85%29.aspx)或[`IAutoCompleteDropDown`](http://msdn.microsoft.com/en-us/library/windows/desktop/bb776286%28v=vs.85%29.aspx)接口。不幸的是，这些都没有强制自动完成下拉的方法。

您可能想要使用 Spy++ 并查看自动完成显示时发送到控件的 Windows 消息。您可能会找到将激活它的命令消息。当然，这是一个实现细节，但它可能是唯一的方法。

# sql-server - 如何存储 XP_SMTP 邮件结果代码消息？

> ID：440282
> 
> 赞同：0
> 
> 时间：2009-01-13T18:57:54.797
> 
> 标签：sql-server, sql-server-2000

我正在尝试记录通过 xp_smtp 邮件组件发送的所有电子邮件，但我不知道如何存储邮件。因为失败而存储 1 对我没有多大好处。

```
DECLARE @rc INT
EXEC @rc = master.dbo.xp_smtp_sendmail...

--Once the email is sent put the results (pass or fail) into another table:
EXEC pr_InsertEmailLog  @Body, @From, @Subject, @To, @rc, 'Error MESSAGE here' 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T20:11:23.557

[文档](http://sqldev.net/xp/xpsmtp.htm#Return_codes)说它只返回 0 或 1 。

然而，它[进一步](http://sqldev.net/xp/xpsmtp.htm#Planned_functionality_enhancements)提到了使用输出消息参数的计划工作

> 添加一个包含错误消息的输出参数 (@errmsg OUTPUT)，以防万一无法更好地控制执行并使 XP 能够在完全静默模式下工作。如果 XP 的返回码不等于 0（零），则该参数将仅包含数据，表明某种故障。

YMMV，但某些善良的灵魂可能会在此版本之后进一步开发它。

# sql-server - MS SQL Server - 通过网络批量插入

> ID：440289
> 
> 赞同：5
> 
> 时间：2009-01-13T18:59:13.327
> 
> 标签：sql-server, database, import, networking, bulk

我有一个使用 MS SQL Server 的应用程序，我需要从文件中进行批量插入。症结在于数据库和我的应用程序将托管在不同的服务器上。通过网络进行批量插入的最佳方法是什么？到目前为止，我提出了两个想法：

1.  从应用服务器共享数据库服务器可以找到的目录，并使用远程文件中的批量插入语句进行导入

2.  从 db 服务器运行 FTP 服务器 - 执行导入时，只需将文件 ftp 到 db 服务器并使用本地文件的批量插入进行导入（我倾向于此选项）。

谁能告诉我是否有更好的方法来做到这一点，或者如果没有，哪一个最有意义，为什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T19:04:07.327

我以前做过，并尝试了两种选择。

最后，我做了与选择1相反的事情。在数据库服务器上共享一个应用程序可以找到的目录。您不必在批量插入期间处理带宽问题。

如果您特别关注安全性或可传输性，则 FTP 服务器选项会起作用。

最后一个选择（非常小心）是使用带有本地化 SQL 服务器的 DTS。它可能更安全。如果你做错了，效率会低得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-21T18:14:11.530

我仍在寻找一种在 MS SQL 中执行此操作的方法，但我在 MySQL 中所做的是将 CSV 作为 BLOB 保存在临时表中，在数据库服务器本地的目录中运行 SELECT ... INTO DUMPFILE，然后在该本地文件上运行常规的 LOAD DATA 语句（编辑：我觉得我应该指出，这是在 LOAD DATA LOCAL 可用之前）。

我认为[spWriteStringToFile](http://www.simple-talk.com/code/WorkingWithFiles/spWriteStringTofile.txt "spWriteStringTofile")会做到这一点。

编辑：我正在做某事。

```
comm.CommandText = @"EXEC spWriteStringToFile @data, 'c:\datadumps', 'data.csv';
    BULK INSERT my_table FROM 'c:\datadumps\data.csv';";
comm.Parameters.AddWithValue("data", File.ReadAllText(path));
comm.ExecuteNonQuery(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T19:10:35.847

I am not sure about 2k08 as there are some additional utilities to copy files between servers. FTP will be the faster of the two, because it doesn't use the window's file system to transfer the file. (there is overhead, but unless the file is large it might be negligible). There are other advantages to not using a share, such as the remote server with the file crashing mid-access.

I disagree with cmartin about adding an open share to the db server. Generally you don't want to open file shares to the db server as it is generally considered a security risk, and a lot of places won't allow it. That being said it would negate you having transfer the file to another location to use the bulk import.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T19:02:24.350

如果文件足够小，则 ftp 选项可能会起作用（您的数据库框中将有一个副本）。但是，如果您在两者之间有一个单跳千兆网络，那么我认为选项 1 没有太大问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-30T03:45:08.027

实际上，您可以将文件放在应用程序和数据库服务器上。

两个文件必须是相同的路径。从应用程序服务器，目的仅用于选择。数据库服务器用于批量插入。

这就是我为我的客户所做的，他们也同意这个简单的技巧。

# c# - 实现“LazyProperty”类 - 这是个好主意吗？

> ID：440290
> 
> 赞同：7
> 
> 时间：2009-01-13T18:59:13.530
> 
> 标签：c#, .net, lazy-evaluation

我经常发现自己编写了一个懒惰地评估的属性。就像是：

```
if (backingField == null) 
  backingField = SomeOperation();
return backingField; 
```

它的代码不多，但如果你有很多属性，它确实会重复很多。

我正在考虑定义一个名为 LazyProperty 的类：

```
public class LazyProperty<T>
    {
    private readonly Func<T> getter;

    public LazyProperty(Func<T> getter)
    {
        this.getter = getter;
    }

    private bool loaded = false;
    private T propertyValue;

    public T Value
    {
        get
        {
            if (!loaded)
            {
                propertyValue = getter();
                loaded = true;
            }
            return propertyValue;
        }
    }

    public static implicit operator T(LazyProperty<T> rhs)
    {
        return rhs.Value;
    }
} 
```

这将使我能够像这样初始化一个字段：

```
first = new LazyProperty<HeavyObject>(() => new HeavyObject { MyProperty = Value }); 
```

然后属性的主体可以简化为：

```
public HeavyObject First { get { return first; } } 
```

这将被公司的大多数人使用，因为它将进入我们大多数产品共享的公共类库中。

我无法决定这是否是一个好主意。我认为这些解决方案有一些优点，例如：

*   更少的代码
*   更漂亮的代码

不利的一面是，查看代码并准确确定发生了什么会更加困难——尤其是在开发人员不熟悉 LazyProperty 类的情况下。

你怎么看 ？这是一个好主意还是我应该放弃它？此外，隐式运算符是一个好主意，还是如果您应该使用此类，您是否更愿意显式使用 Value 属性？

欢迎提出意见和建议:-)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T19:24:56.363

只是过于迂腐：

您建议的避免重复代码的解决方案：

```
private LazyProperty<HeavyObject> first = 
  new LazyProperty<HeavyObject>(() => new HeavyObject { MyProperty = Value });
public HeavyObject First { 
  get { 
    return first; 
  } 
} 
```

实际上是比您不想重复的代码更多的字符：

```
private HeavyObject first;
public HeavyObject First { 
  get {
    if (first == null) first = new HeavyObject { MyProperty = Value };
    return first;
  }
} 
```

除此之外，我认为隐式转换使代码非常难以理解。我不会猜到一个简单地首先返回的方法，实际上最终会创建一个 HeavyObject。我至少会放弃隐式转换并从属性中返回 first.Value 。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T19:27:28.293

**根本不要这样做。**

通常，在一种情况下，使用这种惰性初始化属性是一种有效的设计选择：何时`SomeOperation();`是一项昂贵的操作（就 I/O 而言，例如当它需要 DB 命中或计算时）并且当您确定您通常不会需要访问它。

也就是说，默认情况下您应该进行急切初始化，当分析器说这是您的瓶颈时，将其更改为延迟初始化。

如果你有创造这种抽象的冲动，那就是一种气味。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T19:07:17.867

当然，您至少希望`LazyPropery<T>`成为值类型，否则您已经为系统中的每个“延迟加载”属性添加了内存和 GC 压力。

另外，多线程场景呢？考虑同时请求该属性的两个线程。如果没有锁定，您可能会创建基础属性的两个实例。为了避免在常见情况下锁定，您需要进行双重检查锁定。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T19:04:12.460

我更喜欢第一个代码，因为a）它是一种具有属性的常见模式，我立即理解它，并且b）你提出的观点：没有隐藏的魔法，你必须去查找以了解何时何地正在获得价值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T19:03:09.747

我喜欢这样的想法，因为它的代码更少，更优雅，但我会非常担心这样一个事实，即很难查看它并说出正在发生的事情。我认为它的唯一方法是使用“惰性”方式设置变量的约定，并在使用它的任何地方进行评论。现在不会有编译器或任何可以强制执行这些规则的东西，所以仍然是 YMMV。

最后，对我来说，像这样的决定归结为谁将看它以及这些程序员的质量。如果你可以相信你的开发者伙伴会正确使用它并很好地评论，那么就去做吧，但如果不是，你最好以一种易于理解和遵循的方式来做。/我的 2 美分

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T19:06:43.267

我不认为担心开发人员不理解是反对做这样的事情的一个很好的论据......

如果你这么想，那么你什么也做不了，因为害怕别人不理解你做了什么

您可以在中央存储库中编写教程或其他内容，我们这里有一个用于此类笔记的 wiki

总的来说，我认为这是一个很好的实现想法（不想开始争论延迟加载是否是一个好主意）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T19:22:42.563

在这种情况下，我要做的是创建一个[Visual Studio 代码片段](http://msdn.microsoft.com/en-us/library/ms165393(vs.80).aspx)。我认为这才是你真正应该做的。

例如，当我创建 ASP.NET 控件时，我经常有很多数据存储在 ViewState 中，因此我创建了如下代码片段：

```
public Type Value
{
    get
    {
        if(ViewState["key"] == null)
            ViewState["key"] = someDefaultValue;
        return (Type)ViewState["key"];
    }
    set{ ViewState["key"] = value; }
} 
```

这样，只需少量工作（定义类型、键、名称和默认值）即可轻松创建代码。它是可重用的，但您没有其他开发人员可能无法理解的复杂代码的缺点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T19:06:48.430

我喜欢您的解决方案，因为它非常聪明，但我认为您使用它并不会赢得太多。在公共属性中延迟加载私有字段绝对是可以复制代码的地方。然而，这总是让我觉得这是一种使用模式，而不是需要重构到一个通用位置的代码。

如果您进行任何序列化，您的方法将来可能会成为一个问题。此外，最初了解您使用自定义类型所做的事情也更加令人困惑。

总的来说，我赞赏你的尝试并欣赏它的聪明，但出于上述原因，我建议你恢复原来的解决方案。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-13T19:23:57.537

就个人而言，我不认为 LazyProperty 类本身提供了足够的价值来证明使用它是合理的，特别是考虑到将它用于值类型的缺点（如 Kent 所述）。如果您需要其他功能（例如使其成为多线程），则可以将其视为 ThreadSafeLazyProperty 类。

关于隐式属性，我更喜欢“值”属性。打字要多一点，但对我来说更清楚。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-13T19:43:18.043

我认为这是一个有趣的想法。首先，我建议您从调用代码中隐藏惰性属性，您不想泄漏到您的域模型中，因为它是惰性的。你用隐式运算符做什么，所以保留它。

例如，我喜欢你如何使用这种方法来处理和抽象出锁定的细节。如果你这样做，那么我认为有价值和优点。如果您确实添加了锁定，请注意双重锁定模式，很容易出错。

# windows-mobile - Windows Mobile 文件时间

> ID：440295
> 
> 赞同：0
> 
> 时间：2009-01-13T19:00:21.407
> 
> 标签：windows-mobile, file

在 Windows Mobile 中，我使用 FindFirstFile/FindNextFile 来搜索一些文件。作为结果的一部分，我得到一个包含一个搜索结果的 WIN32_FIND_DATA 结构。此结构包含 3 个 FILETIME 结构，用于文件创建、上次写入和上次访问时间。

然后我使用 FileTimeToSystemTime 函数将这些结构转换为 SYSTEMTIME。我的问题从这里开始。在 SYSTEMTIME 结构中，小时字段与时间的实际小时字段不匹配。我发现 WM 正在根据时区和夏令时进行调整。

例如，如果在 5:44:30 创建时间并且我在 GMT +1，则 SYSTEMTIME 结构报告 4:44:30。

我想知道是否有人知道如何在此调整之前获得实时值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T19:20:16.983

您获得的 FileTime 是 UTC，在将其转换为 SYSTEMTIME 之前使用[FileTimeToLocalFileTime 。](http://msdn.microsoft.com/en-us/library/aa908762.aspx)

编辑：固定链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T19:22:28.023

我不清楚你认为确切的问题是什么。FindFirst/Next 正在返回文件的文件信息，因此时间是正确的 - 它是与文件一起存储的内容。您是说您希望它采用 UTC/zulu 时间（与 SYSTEMTIME 结构不同），而不是像本地时间这样的偏移格式？还是反过来？无论如何，文件系统显然不同意该假设，并且存储的时间与您认为的相反。如果要调整与文件关联的时间，则必须使用从[GetTimezoneInformation](http://msdn.microsoft.com/en-us/library/ms885646.aspx)返回的信息或调用 FileTimeToLocalFileTime 进行手动计算。您可能想要查看所有[CE 时间函数](http://msdn.microsoft.com/en-us/library/ms725473(VS.85).aspx)。

# javascript - 如何将 Java 源代码交叉编译为 JavaScript？

> ID：440302
> 
> 赞同：53
> 
> 时间：2009-01-13T19:01:16.133
> 
> 标签：javascript, java, code-translation

给定一组 Java 源代码文件，我如何将它们编译成一个或多个可与手工制作的 JavaScript 一起使用的 JavaScript 文件？

[GWT](http://code.google.com/webtoolkit/)是一种选择，但到目前为止我看到的每个示例都旨在构建精美的网站。仅将 Java 源代码转换为可与手工制作的 JavaScript 一起使用的 Javascript 的简单用例[尚未得到详细记录](http://depth-first.com/articles/2009/01/06/javascript-for-cheminformatics-cross-compiling-java-to-javascript-with-gwt-revisited#comments)。

我[在 GWT 邮件列表](http://groups.google.com/group/Google-Web-Toolkit/browse_thread/thread/d9ae879cc249d2cb/b4799e0774a14c50)上开始了一个关于这个主题的线程，但对于这是否可行，意见似乎不一。

一个人给出了一个非常有用的提示，那就是查看[GWT-Exporter](http://code.google.com/p/gwt-exporter/)。问题是源代码和文档都不是现成的，尽管有[this](http://groups.google.com/group/Google-Web-Toolkit/browse_thread/thread/201528f512c546f3)和[this](http://timepedia.blogspot.com/2008/06/gwt-exporterthe-next-generation.html)。

编辑：GWT-Exporter 源代码在[这里](http://code.google.com/p/gwt-exporter/source/browse/)

我也看过[Java2Script](http://j2s.sourceforge.net/index.html)。但同样，我无法找到如何解决我的简单用例的示例。

解决这个问题的最佳方法是什么？我还缺少什么更好的东西吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-13T19:47:24.587

当您使用 GWT 时，您基本上是将 UI 部分转换为 Javascript（并且假定您使用编写 Java 时提供的 UI 小部件）。在 Javascript 中只能访问一些 Java 库。通常在 GWT 应用程序中，任何大量使用 Java 库的东西都将在服务器端运行并作为 AJAX 连接到 Javascript（GWT 会为您处理）。因此，GWT 不一定将您的完整应用程序转换为 Javascript（尽管如果您愿意限制对 Java 库和某些功能的使用，它可以）。

无论如何，如果这种方法（从 Javascript 中调用在服务器上运行的 Java）对您有吸引力，一个不错的选择是[DWR](http://directwebremoting.org/)，它基本上允许您的 Javascript 直接调用在服务器上运行的 Java 类中的方法（无需您构建 Web 服务或其他前端）。不是你问的，我知道。

更相关的是，看起来有一个[示例应用程序的源代码演示了 gwt-exporter 的使用](https://code.google.com/p/gwt-exporter/source/browse/samples/exporterdemo/src/main/java/exporterdemo/public/ExporterDemo.html)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2015-12-16T09:57:26.833

我不确定它是否适合您的用例，但如果您同意放弃 Java API 并使用 Java 中的 JavaScript API，那么您可以使用[JSweet](http://www.jsweet.org)，这是一个构建在 TypeScript 之上的 Java 到 JavaScript 转译器。它使您可以访问数百个类型良好的 JavaScript API（DOM、jQuery、下划线、angularjs 等）。它生成 JavaScript 代码，您可以将其与旧版 JavaScript 和 TypeScript 代码混合使用。

注意：JSweet*不适*用于遗留 Java 代码和遗留 Java API，但您的用例没有提到重用遗留代码。

[更新] 从 1.1 版本开始，JSweet 现在还支持一些 Java API，例如 Collections (java.util)。因此，在一定程度上重用遗留 Java 代码是可能的。添加您自己对 Java API 的支持也非常简单。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2015-11-17T17:14:34.003

虽然问题是关于将 Java 源代码编译为 JavaScript，但我认为值得一提的是[TeaVM](https://github.com/konsoletyper/teavm "茶VM")可以将 Java 字节码编译为 JavaScript。我从未尝试过，但它似乎很有希望。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2018-07-15T15:11:03.783

> 给定一组 Java 源代码文件，我如何将它们编译成一个或多个可与手工制作的 JavaScript 一起使用的 JavaScript 文件？

尽管有许多[将 Java 应用程序转换为 Javascript](https://github.com/jashkenas/coffeescript/wiki/List-of-languages-that-compile-to-JS#javajvm)的解决方案，但您对新的 javascript 代码可以与生成的代码交互的解决方案感兴趣。这是其他答案的更新（如 2018 年）。

有不同类型的工具。例如，您可能会找到允许您 (1) 将 java 代码转换为 javascript 的工具；(2) 将字节码转换为 javascript、asm.js 或 webassembly；(3) 直接在浏览器中执行 java 应用程序和 (4) 创建结合 java 和 javascript 的解决方案。您必须根据自己的要求选择要使用的解决方案。

* * *

**将 Java 源代码转换为 Javascript**

一些解决方案采用 java 源代码并生成 javascript 等效版本。通常，这些解决方案将 Java 转换为 Javascript，但并不支持 Java 运行时的所有行为和库。生成的代码可能不支持某些 java 标准库。通常，它们用于使用 Java 创建 HTML 应用程序，但不用于迁移代码。**优点：**生成的解决方案可能包含非常小的文件。您可以使用它来重用您自己的业务逻辑类，而无需考虑 GUI 或特定于平台的库。**缺点：**您可能无法使用 Java 平台的某些功能。它需要访问源代码。

*   [JSweet](http://www.jsweet.org/)将 Java 转换为 javascript。它包括 1000 多个 javascript 库的 API 绑定。您可以编写使用这些库的 java 代码。
    *   它将 java 转换为 typescript，然后使用 typescript 编译器创建相应的 javascript。
    *   它可以生成[多种类型的 javascript 模块和 typescript 定义](http://www.jsweet.org/getting-started/#Transpiler_options)。您可以非常轻松地在 javascript 中使用生成的代码。
*   [j2s](http://j2s.sourceforge.net/)是 Eclipse RAP 平台用于将 java 代码转换为 javascript 的编译器。它用于将 SWT (GUI) 小部件转换为 javascript 和 HTML。它不支持所有的 Java 标准库
    *   它可以[转换简单的 Java 类](http://j2s.sourceforge.net/document.html)以在 javascript 中使用。考虑到j2s 执行的[OO Java-Javascript 模拟](http://j2s.sourceforge.net/articles/oop-in-js-by-j2s.html)，您必须使用这些类。

* * *

**将 Javascript 字节码转换为 javascript**

这些解决方案采用编译后的 java 代码（.class 文件）并在 javascript、asm.js 或 webassembly 中生成等效代码。考虑到 java 代码可能依赖于 java 标准库（即 JRE），这些解决方案通常包括移植和预编译的库。**优点：**您不需要更改代码中的任何内容。您也不需要源代码。**缺点：**生成的解决方案可能需要加载大量文件。

*   [Bck2Brwsr](http://wiki.apidesign.org/wiki/Bck2Brwsr)，一个 Java 虚拟机，可以提前将 java 字节码编译为 javascript。它为每个 .jar 文件生成一个 javascript 文件。
    *   您可以使用`vm`javascript 对象将类加载到 javascript 中并执行静态方法（使用`vm.loadClass(.., function(class){..}}`）。[gradle plugin](https://github.com/jtulach/bck2brwsr/blob/master/docs/GRADLE.md)和[maven task](https://github.com/jtulach/bck2brwsr/blob/master/docs/MAVEN.md)的文档中有一个示例。
*   [TeaVM](http://teavm.org/)是另一个 Java VM，可以提前将代码转换为 javascript。与 Bck2Brwsr 相比，它支持线程，为所有类生成单个文件并提供更好的调试支持。
    *   您可以使用该方法[从 javascript 调用 java 。](http://teavm.org/docs/runtime/jso.html)`javaMethods.get(..).invoke(...)`
*   [DukeScript](http://www.dukescript.com/)，使用 Bck2Brwsr 或 TeaVM 将 java 代码和字节码转换为 javascript。
    *   它提供[maven 任务来编译 java 代码](http://www.dukescript.com/best/practices/2017/06/30/TranspilePlainJavaIntoJavaScript.html)。生成的代码（以及从 javascript 调用 java 的技术）取决于使用的转译器。
*   [Dragome](http://www.dragome.com/)，将 java 字节码转换为 javascript。
    *   您可以[在 Java 中注释静态方法并在 Javascript 中使用它](https://groups.google.com/forum/#!topic/dragome/Yss0tRAjy_Y)：例如，您可以使用注释方法`@MethodAlias(alias="windows.method1")`并从 javascript 中调用它`window.method1()`
*   [CheerpJ](https://www.leaningtech.com/cheerpj/) *（一种商业产品）*可以使用 Swing 和 AWT 运行完整的 java 应用程序。它提供了一个非常完整的 JavaScript 环境，支持操作系统、线程和网络功能。
    *   它提供了完整的[运行时 API](https://github.com/leaningtech/cheerpj-meta/wiki/Runtime-API)。您可以`main`使用`cheerpjRunMain( <class>, <jar> )`. 您可以使用创建对象`cjNew( <class>, <params>...)`并使用调用静态方法`cjCall( <class>,<method>,<params>...)`。您可以考虑许多其他方法。

* * *

**在 Javascript 中运行 Java 代码**

DoppioJVM 是一个用 Typescript 编写的完整 JVM。**优点：**它模拟了操作系统的许多元素，包括文件系统、TTY 控制台和线程。**缺点：**考虑到它是一个解释器，它可能会比其他解决方案慢。（我没有测试过）

*   [DoppioJVM](https://plasma-umass.org/doppio-demo/)是一个用 Typescript 编写的 JVM
    *   该[文档](https://github.com/plasma-umass/doppio/tree/master/docs)包括用于加载和运行类的代码片段。您可以使用`jvm.runClass( <class>, [ <args>...], function(response){..})`. 您可以运行 Jar 文件并执行许多其他任务。

* * *

**创建结合 Java 和 Javascript 的应用程序**

其他一些解决方案不仅提供编译代码的工具，还提供创建 java 和 javascript 解决方案的框架和解决方案。例如，CheerpJ 具有用于图形用户界面的完整版本的 Swing 和 AWT 库，但它们可能会导致非常慢。您可以使用在浏览器上运行速度更快的新 HTML 版本来替换用户界面。**优点：**您可以重用现有代码而无需更改，主要是一些库和业务逻辑。您可以从您的解决方案库中删除在浏览器中运行效率不高的解决方案库。**缺点：**如果你想继续维护你的 java 桌面版本，你必须为浏览器处理不同的代码。

*   [GWT](http://www.gwtproject.org/)将 Java 代码转换为 javascript，但使用一组不同的库用于用户界面和客户端到服务器的通信。
    *   该文档维护[与 JRE 的差异信息](http://www.gwtproject.org/doc/latest/DevGuideCodingBasicsCompatibility.html)
    *   您可以[导出 Java 类](http://www.gwtproject.org/doc/latest/DevGuideCodingBasicsJsInterop.html)以供 Javascript 代码使用。
*   [Dukescript](http://www.dukescript.com/)使用前面提到的转换工具。
    *   它提供了一个[Knockout4j](http://www.dukescript.com/knockout4j.html)库，可以轻松地与 HTM、DOM 和其他 javascript 代码交互。
*   [Dragome](http://www.dragome.com/)不仅转换 java 代码，还包括与 HTML/DOM 交互的方法
    *   您可以使用注解[将 java 对象绑定到 HTML 元素](http://fpetrola.github.io/dragome-website/simple-examples.html)并[处理 DOM](http://fpetrola.github.io/dragome-website/html-dom-tutorial.html)
*   [HTML/Java API](https://github.com/apache/incubator-netbeans-html4j)是一个 Apache 项目，用于标准化从转译代码对 HTML/DOM/javascript 的访问
    *   它是由[Dukescript](http://www.dukescript.com/update/2017/11/21/ApacheHtmlJava.html)和其他工具提供商捐赠的。

* * *

**推荐**

*   如果你想重用自己创建的几个类，你可以试试[JSweet](http://www.jsweet.org/)。您可以创建可以轻松与 javascript 和 typescript 一起使用的 javascript 模块（库）。
*   如果您想重用依赖多个 java 库的中型到大型代码库，您可以尝试[CheerpJ](https://www.leaningtech.com/cheerpj/)、[Dukescript](http://www.dukescript.com/)或[Dragome](http://www.dragome.com/)。您可以重用大部分代码，并使用对浏览器更友好的技术（逐渐）创建用户界面和客户端到服务器的通信。
*   如果您想运行完整的 Java 应用程序而无需更改，您可以尝试[CheerpJ](https://www.leaningtech.com/cheerpj/)。它可以运行 Swing 和 AWT 用户界面。它还提供了一个[Applet 运行器](https://chrome.google.com/webstore/detail/cheerpj-applet-runner/bbmolahhldcbngedljfadjlognfaaein)。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-02-13T02:04:49.523

这是另外两个选择，需要研究的事情和第三种选择不转换，只是住在一起。

1.  **[Java2Javascript](http://j2s.sourceforge.net/)**

我一直想试试这个——看起来更接近所要求的。引用网页：

> 一个 Eclipse Java 到 JavaScript 编译器插件和一个 JavaScript 版本的 Eclipse Standard Widget Toolkit (SWT) 与其他常用实用程序，例如 java.lang.* 和 java.util.*。您可以通过 Java2Script Pacemaker 将基于 SWT 的富客户端平台 (RCP) 转换为富 Internet 应用程序 (RIA)。

Javascript 经验有限的 Java - 您需要移植必要的依赖项或通过 jQuery 等工具找到替代方案。

2.  **[杜克脚本](http://www.dukescript.com/)**

在我查看 DukeScript 时，它编译了一些前端 Javascript，并从浏览器的 Javascript 中调用 Java。它似乎或多或少是一种混合方法，因此您可以使用来自 Javascript 的大量 Java 库。我将违反 Java 的浏览器安全策略。

利用 Java 运行时的更完整的 Java 体验。如果我想在浏览器环境之外使用它，我会在 Java 上使用 Javascript。

3.  [纳什霍恩](http://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/shell.html)

将此视为使用 Java 资源作为 Javascript 基础的示例：**[Nashorn 和 JavaFX](http://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/javafx.html)**，作为富 Javascript 操作客户端的示例。无论如何，使用 Java 中的 Javascript 引擎，您不需要在 Javascript-VM 到对象代码到 Java-VM 之间进行太多转换。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-09-03T12:31:53.370

不完全是主题，但[Kotlin](http://kotlinlang.org)是一种 100% 与 Java 兼容的语言，可以编译为 JavaScript。

IntelliJ IDEA 可以自动将 Java 转换为 Kotlin 并编译它以在 Node 或浏览器上运行。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-10-05T21:12:00.997

> 给定一组 Java 源代码文件，我如何将它们编译成一个或多个可与手工制作的 JavaScript 一起使用的 JavaScript 文件？

内置 Java API 和 Java 语言功能与 JavaScript 之间没有直接关联。因此，任何创建“转换器”的尝试都是不完整的。作为一个基本示例，Java 类没有直接对应的 JavaScript 习惯用法。

如果没有源代码，就不可能知道不完整的转换工具是否适用于您的用例。

* * *

也就是说，我对解决您的问题的建议是首先尝试使用[GWT](http://www.gwtproject.org/)：设置一个演示项目，放入库的源代码并从 JavaScript 端调用它，然后查看 GWT 在它的 .js 文件中输出什么。此处其他海报建议的其他一些工具也绝对值得一试。

如果这是卓有成效的，并让您参与其中，那就太好了。

从那里，您需要/想要手动完成剩余的转换。毕竟，假设您希望代码实际正常运行，那么手动审查肯定是合适的。一些与它一起转换的单元测试也是理想的。

你没有说明你的项目的源代码有多大，但如果它很小（比如说不到一千行代码），即使是完全手动的转换也不应该是非常困难的。如果它比这大得多，我建议您检查一下您是否真的想要它作为 JavaScript 代码。

# sql-server - tsql 从函数或存储过程返回表

> ID：440308
> 
> 赞同：58
> 
> 时间：2009-01-13T19:03:19.047
> 
> 标签：sql-server, tsql

这更像是一个语法问题，我正在尝试编写可以嵌入到查询中的存储过程或函数，例如：

```
select * from MyBigProcOrFunction 
```

我正在尝试定义一个表格函数，但我不明白如何去做，因为我构建了 tmp 表来计算数据，然后才最终在 endtable 中返回。我对代码的标记是：

```
create function FnGetCompanyIdWithCategories()
returns table
as 
return 
(
select * into a #tempTable from stuff
'
etc
'
select companyid,Company_MarketSector from #tempTables 'the returning table data
) 
```

如果我定义一个函数，我如何将它作为一个表返回？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2009-01-13T19:13:35.390

您不能从 SQL 函数中访问临时表。您将需要使用表变量，因此本质上是：

```
ALTER FUNCTION FnGetCompanyIdWithCategories()
RETURNS  @rtnTable TABLE 
(
    -- columns returned by the function
    ID UNIQUEIDENTIFIER NOT NULL,
    Name nvarchar(255) NOT NULL
)
AS
BEGIN
DECLARE @TempTable table (id uniqueidentifier, name nvarchar(255)....)

insert into @myTable 
select from your stuff

--This select returns data
insert into @rtnTable
SELECT ID, name FROM @mytable 
return
END 
```

# 编辑

根据对此问题的评论，这是我的建议。您想在另一个查询中加入过程或表值函数的结果。我将向您展示如何做到这一点，然后您选择您喜欢的那个。我将使用我的一个模式中的示例代码，但你应该能够适应它。两者都是首先使用存储过程的可行解决方案。

```
declare @table as table (id int, name nvarchar(50),templateid int,account nvarchar(50))

insert into @table
execute industry_getall

select * 
from @table 
inner join [user] 
    on account=[user].loginname 
```

在这种情况下，您必须声明一个临时表或表变量来存储过程的结果。现在让我们看看如果您使用的是 UDF，您将如何做到这一点

```
select *
from fn_Industry_GetAll()
inner join [user] 
    on account=[user].loginname 
```

如您所见，UDF 更加简洁易读，并且由于您没有使用辅助临时表（性能完全是我的猜测），因此性能可能会更好一些。

如果您要在许多其他地方重用您的函数/过程，我认为 UDF 是您的最佳选择。唯一的问题是您将不得不停止使用#Temp 表并使用表变量。除非您正在索引临时表，否则应该没有问题，并且您将使用 tempDb 较少，因为表变量保存在内存中。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-13T19:05:23.627

将此用作模板

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      <Author,,Name>
-- Create date: <Create Date,,>
-- Description: <Description,,>
-- =============================================
CREATE FUNCTION <Table_Function_Name, sysname, FunctionName> 
(
    -- Add the parameters for the function here
    <@param1, sysname, @p1> <data_type_for_param1, , int>, 
    <@param2, sysname, @p2> <data_type_for_param2, , char>
)
RETURNS 
<@Table_Variable_Name, sysname, @Table_Var> TABLE 
(
    -- Add the column definitions for the TABLE variable here
    <Column_1, sysname, c1> <Data_Type_For_Column1, , int>, 
    <Column_2, sysname, c2> <Data_Type_For_Column2, , int>
)
AS
BEGIN
    -- Fill the table variable with the rows for your result set

    RETURN 
END
GO 
```

这将定义您的功能。然后，您只需将其用作任何其他表：

```
Select * from MyFunction(Param1, Param2, etc.) 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-13T19:04:45.173

您需要一种特殊类型的函数，称为[表值函数。](http://msdn.microsoft.com/en-us/library/ms191165.aspx) 下面是一个为数据仓库构建日期维度的冗长示例。请注意`returns`定义表结构的子句。您可以在表变量（在本例中）中插入`@DateHierarchy`您想要的任何内容，包括构建一个临时表并将内容复制到其中。

```
if object_id ('ods.uf_DateHierarchy') is not null
    drop function ods.uf_DateHierarchy
go

create function ods.uf_DateHierarchy (
       @DateFrom datetime
      ,@DateTo   datetime
) returns @DateHierarchy table (
        DateKey           datetime
       ,DisplayDate       varchar (20)
       ,SemanticDate      datetime
       ,MonthKey          int     
       ,DisplayMonth      varchar (10)
       ,FirstDayOfMonth   datetime
       ,QuarterKey        int
       ,DisplayQuarter    varchar (10)
       ,FirstDayOfQuarter datetime
       ,YearKey           int
       ,DisplayYear       varchar (10)
       ,FirstDayOfYear    datetime
) as begin
    declare @year            int
           ,@quarter         int
           ,@month           int
           ,@day             int
           ,@m1ofqtr         int
           ,@DisplayDate     varchar (20)
           ,@DisplayQuarter  varchar (10)
           ,@DisplayMonth    varchar (10)
           ,@DisplayYear     varchar (10)
           ,@today           datetime
           ,@MonthKey        int
           ,@QuarterKey      int
           ,@YearKey         int
           ,@SemanticDate    datetime
           ,@FirstOfMonth    datetime
           ,@FirstOfQuarter  datetime
           ,@FirstOfYear     datetime
           ,@MStr            varchar (2)
           ,@QStr            varchar (2)
           ,@Ystr            varchar (4)
           ,@DStr            varchar (2)
           ,@DateStr         varchar (10)

    -- === Previous ===================================================
    -- Special placeholder date of 1/1/1800 used to denote 'previous'
    -- so that naive date calculations sort and compare in a sensible
    -- order.
    --
    insert @DateHierarchy (
         DateKey
        ,DisplayDate
        ,SemanticDate
        ,MonthKey
        ,DisplayMonth
        ,FirstDayOfMonth
        ,QuarterKey
        ,DisplayQuarter
        ,FirstDayOfQuarter
        ,YearKey
        ,DisplayYear
        ,FirstDayOfYear
    ) values (
         '1800-01-01'
        ,'Previous'
        ,'1800-01-01'
        ,180001
        ,'Prev'
        ,'1800-01-01'
        ,18001
        ,'Prev'
        ,'1800-01-01'
        ,1800
        ,'Prev'
        ,'1800-01-01'
    )

    -- === Calendar Dates =============================================
    -- These are generated from the date range specified in the input
    -- parameters.
    --
    set @today = @Datefrom
    while @today <= @DateTo begin

        set @year = datepart (yyyy, @today)
        set @month = datepart (mm, @today)
        set @day = datepart (dd, @today)
        set @quarter = case when @month in (1,2,3) then 1
                            when @month in (4,5,6) then 2
                            when @month in (7,8,9) then 3
                            when @month in (10,11,12) then 4
                        end
        set @m1ofqtr = @quarter * 3 - 2 

        set @DisplayDate = left (convert (varchar, @today, 113), 11)
        set @SemanticDate = @today
        set @MonthKey = @year * 100 + @month
        set @DisplayMonth = substring (convert (varchar, @today, 113), 4, 8)
        set @Mstr = right ('0' + convert (varchar, @month), 2)
        set @Dstr = right ('0' + convert (varchar, @day), 2)
        set @Ystr = convert (varchar, @year)
        set @DateStr = @Ystr + '-' + @Mstr + '-01'
        set @FirstOfMonth = convert (datetime, @DateStr, 120)
        set @QuarterKey = @year * 10 + @quarter
        set @DisplayQuarter = 'Q' + convert (varchar, @quarter) + ' ' +
                                    convert (varchar, @year)
        set @QStr = right ('0' + convert (varchar, @m1ofqtr), 2)   
        set @DateStr = @Ystr + '-' + @Qstr + '-01' 
        set @FirstOfQuarter = convert (datetime, @DateStr, 120)
        set @YearKey = @year
        set @DisplayYear = convert (varchar, @year)
        set @DateStr = @Ystr + '-01-01'
        set @FirstOfYear = convert (datetime, @DateStr)

        insert @DateHierarchy (
             DateKey
            ,DisplayDate
            ,SemanticDate
            ,MonthKey
            ,DisplayMonth
            ,FirstDayOfMonth
            ,QuarterKey
            ,DisplayQuarter
            ,FirstDayOfQuarter
            ,YearKey
            ,DisplayYear
            ,FirstDayOfYear
        ) values (
             @today
            ,@DisplayDate
            ,@SemanticDate
            ,@Monthkey
            ,@DisplayMonth
            ,@FirstOfMonth
            ,@QuarterKey
            ,@DisplayQuarter
            ,@FirstOfQuarter
            ,@YearKey
            ,@DisplayYear
            ,@FirstOfYear
        )

        set @today = dateadd (dd, 1, @today)
    end

    -- === Specials ===================================================
    -- 'Ongoing', 'Error' and 'Not Recorded' set two years apart to
    -- avoid accidental collisions on 'Next Year' calculations.
    --
    insert @DateHierarchy (
         DateKey
        ,DisplayDate
        ,SemanticDate
        ,MonthKey
        ,DisplayMonth
        ,FirstDayOfMonth
        ,QuarterKey
        ,DisplayQuarter
        ,FirstDayOfQuarter
        ,YearKey
        ,DisplayYear
        ,FirstDayOfYear
    ) values (
         '9000-01-01'
        ,'Ongoing'
        ,'9000-01-01'
        ,900001
        ,'Ong.'
        ,'9000-01-01'
        ,90001
        ,'Ong.'
        ,'9000-01-01'
        ,9000
        ,'Ong.'
        ,'9000-01-01'
    )

    insert @DateHierarchy (
         DateKey
        ,DisplayDate
        ,SemanticDate
        ,MonthKey
        ,DisplayMonth
        ,FirstDayOfMonth
        ,QuarterKey
        ,DisplayQuarter
        ,FirstDayOfQuarter
        ,YearKey
        ,DisplayYear
        ,FirstDayOfYear
    ) values (
         '9100-01-01'
        ,'Error'
        ,null
        ,910001
        ,'Error'
        ,null
        ,91001
        ,'Error'
        ,null
        ,9100
        ,'Err'
        ,null
    )

    insert @DateHierarchy (
         DateKey
        ,DisplayDate
        ,SemanticDate
        ,MonthKey
        ,DisplayMonth
        ,FirstDayOfMonth
        ,QuarterKey
        ,DisplayQuarter
        ,FirstDayOfQuarter
        ,YearKey
        ,DisplayYear
        ,FirstDayOfYear
    ) values (
         '9200-01-01'
        ,'Not Recorded'
        ,null
        ,920001
        ,'N/R'
        ,null
        ,92001
        ,'N/R'
        ,null
        ,9200
        ,'N/R'
        ,null
    )

    return
end

go 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T19:08:07.570

据我所知，您不需要（不应该使用）功能。存储过程将从您包含的返回表格数据的任何 SELECT 语句返回表格数据。

存储过程不使用 RETURN 语句。

```
 CREATE PROCEDURE name
 AS

 SELECT stuff INTO #temptbl1

 .......

 SELECT columns FROM #temptbln 
```

# python - unicode() 与 str.decode() 用于 utf8 编码的字节字符串（python 2.x）

> ID：440320
> 
> 赞同：27
> 
> 时间：2009-01-13T19:06:16.217
> 
> 标签：python, unicode, utf-8

有什么理由更喜欢`unicode(somestring, 'utf8')`而不是`somestring.decode('utf8')`？

我唯一的想法是这`.decode()`是一种绑定方法，因此 python 可能能够更有效地解决它，但如果我错了，请纠正我。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-13T19:36:52.643

我更喜欢`'something'.decode(...)`该`unicode`类型，因为 Python 3.0 中不再存在该类型，但`text = b'binarydata'.decode(encoding)`仍然有效。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-01-13T19:32:49.033

对其进行基准测试很容易：

```
>>> from timeit import Timer
>>> ts = Timer("s.decode('utf-8')", "s = 'ééé'")
>>> ts.timeit()
8.9185450077056885
>>> tu = Timer("unicode(s, 'utf-8')", "s = 'ééé'") 
>>> tu.timeit()
2.7656929492950439
>>> 
```

显然，`unicode()`速度更快。

FWIW，我不知道您从哪里得到方法会更快的印象-恰恰相反。

# linq - 带有子查询/分组依据/加入的 LINQ

> ID：440324
> 
> 赞同：3
> 
> 时间：2009-01-13T19:06:51.033
> 
> 标签：linq

LINQ 的新手，并尝试编写以下查询...

```
select 
  f.Section_ID, 
  f.Page_ID, 
  f.SortOrder, 
  f.Type
from 
(
  select 
    Section_ID, 
    min(SortOrder) as minSortOrder
  from 
    ContentPages 
  group by 
    Section_ID
) as x 
inner join 
  ContentPages as f on 
    f.Section_ID = x.Section_ID and 
    f.SortOrder = x.minSortOrder; 
```

笔记：

*   'Section' 有许多 'ContentPages'
*   部分按“SortOrder”字段排序
*   ContentPages 也按“SortOrder”字段排序

表：Section
Section_ID....Name........SortOrder
....1..........一个..........1
....... ...2............两个............3............
3............三个...... ....2......

表：ContentPage
Page_ID.......Section_ID.......Title.......SortOrder
....11.......... ...1........第一页............1............
12...... ....1........第二页............3............
13....... ......2............第三页............2............
16....... ......2........第四页............4............
17....... ……2…………第八页…………5…………
18………… ......1............第 10 页............6

上面的查询可能会以另一种方式编写，所以这就是我想要做的：

*   我需要返回每个部分中第一个 ContentPage 的列表（按 ContentPage.SortOrder 排序时）
*   按 Section.SortOrder 对结果进行排序
*   在结果中也显示 Section.Name（加入 Section_ID？）

最后两点没有被上面的 sql 查询覆盖，更像是一个“很高兴拥有”......

期望的结果
Page_ID.......Section_ID...SectionName.......Title........SortOrder
....11.......... ....1.........一个............第一个............1
...... 13........2........二.............第三页............2\. ......

任何帮助表示赞赏。谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-13T20:07:12.927

这是我的第一次尝试：

```
from sectionPage in pages
group sectionPage by sectionPage.Section_ID into sectionGroup
join page in pages on sectionGroup.Key equals page.Section_ID
where page.SortOrder == sectionGroup.Min(p => p.SortOrder)
orderby page.SortOrder
select page; 
```

发生的事情是首先我们在部分 id 上创建一个组，以便我们稍后可以获得最小排序顺序。接下来，我们在节 id 上加入对页面的新引用，并通过 SortOrder 作为节组中的最小值进行过滤。请注意，对于像 Min() 调用这样的简单表达式，我更喜欢内联 lambda 表达式而不是另一个查询。

最后，我们添加一个 orderby 来对页面进行排序，然后我们返回页面（请注意，如果您愿意，可以将其更改为某些字段）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T20:08:33.937

我想这就是你要找的...

```
 internal class Section
    {
        public int SectionId { get; set; }
        public string Name { get; set; }
        public int SortOrder { get; set; }
    }

    internal class ContentPage
    {
        public int PageId { get; set; }
        public int SectionId { get; set; }
        public string Title { get; set; }
        public int SortOrder { get; set; }
    }

    static void Main(string[] args)
    {
        List<Section> sections = new List<Section>();
        sections.Add(new Section() { SectionId = 1, Name = "One", SortOrder = 1 });
        sections.Add(new Section() { SectionId = 2, Name = "Two", SortOrder = 3 });
        sections.Add(new Section() { SectionId = 3, Name = "Three", SortOrder = 2 });

        List<ContentPage> contentPages = new List<ContentPage>();
        contentPages.Add(new ContentPage() { PageId = 11, SectionId = 1, Title = "Page One",   SortOrder = 1 });
        contentPages.Add(new ContentPage() { PageId = 12, SectionId = 1, Title = "Page Two",   SortOrder = 3 });
        contentPages.Add(new ContentPage() { PageId = 13, SectionId = 2, Title = "Page Three", SortOrder = 2 });
        contentPages.Add(new ContentPage() { PageId = 16, SectionId = 2, Title = "Page Four",  SortOrder = 4 });
        contentPages.Add(new ContentPage() { PageId = 17, SectionId = 2, Title = "Page Eight", SortOrder = 5 });
        contentPages.Add(new ContentPage() { PageId = 18, SectionId = 1, Title = "Page Ten",   SortOrder = 6 });

        var items = from section in sections
                     orderby section.SortOrder
                     join contentPage in
                         (from contentPage in contentPages
                          orderby contentPage.SortOrder
                          group contentPage by contentPage.SectionId into grp
                          select grp.FirstOrDefault())
                     on section.SectionId equals contentPage.SectionId
                     select new
                     {
                         PageId = contentPage.PageId,
                         SectionId = section.SectionId,
                         SectionName = section.Name,
                         Title = contentPage.Title,
                         SortOrder = section.SortOrder
                     };

        foreach (var newItem in items)
        {
            Console.WriteLine(string.Format("{0}\t{1}\t{2}\t{3}\t{4}", newItem.PageId, newItem.SectionId, newItem.SectionName, newItem.Title, newItem.SortOrder));
        }
    } 
```

请注意，您提供的示例数据显示第 2 部分的排序顺序为 3，但您的示例结果将其排序顺序列为 2。

# c - 为什么我可以更改 const char* 变量的值？

> ID：440331
> 
> 赞同：30
> 
> 时间：2009-01-13T19:09:30.593
> 
> 标签：c, pointers, constants

为什么 C 中的以下代码有效？

```
const char* str = NULL;
str = "test";
str = "test2"; 
```

既然 str 是一个指向常量字符的指针，为什么我们可以给它分配不同的字符串字面量呢？此外，我们如何保护 str 不被修改？例如，如果我们后来将 str 分配给一个更长的字符串，该字符串最终覆盖了另一部分内存，这似乎是一个问题。

我应该在我的测试中补充一点，我在每次分配之前和之后打印出 str 的内存地址，它从未改变过。因此，尽管 str 是一个指向 const char 的指针，但实际上内存正在被修改。我想知道这是否可能是 C 的遗留问题？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-01-13T19:13:08.277

您正在更改不是 const 的指针（它指向的是 const）。

如果您希望指针本身为 const，则声明如下所示：

```
char * const str = "something"; 
```

或者

```
char const * const str = "something";  // a const pointer to const char
const char * const str = "something";  //    same thing 
```

指向非常量数据的 const 指针通常不如指向 const 的指针有用。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-13T19:21:28.477

> 此外，我们如何保护 str 不被修改？

```
char * const str1; // str1 cannot be modified, but the character pointed to can
const char * str2; // str2 can be modified, but the character pointed to cannot
const char * const str3 // neither str3 nor the character pointed to can be modified. 
```

最简单的阅读方法是从变量名开始向左阅读：

*   **str1**是一个指向**字符**的**const** ant**指针**
***   **str2**是**指向****字符**const ant的**指针***   **str3**是一个**const** ant**指针，****指向**一个**字符**const ant**

 ****注意：从右到左的阅读在一般情况下不起作用，但对于简单的声明，这是一种简单的方法。我发现了一个基于“The C Programming Language”中的代码的[java 小程序](http://www.muquit.com/muquit/software/cdcl/cdcl.html)，它可以破译声明并完整解释如何做到这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T22:02:21.743

在相关说明中，请务必查看“ [const 指针与指向 const 的指针](http://blog.voidnish.com/?p=37 "const 指针与指向 const 的指针")”。它有助于一些人所说的*const 正确性*。我把它放在我的书签里，这样我可以不时地参考它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T19:12:01.413

字符串文字的内存是在堆栈上分配的，您所做的所有分配都是将`str`指针更改为指向这些内存地址。它最初指向的常量字符根本没有改变。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T19:18:06.863

您正在寻找的可能是语法...

```
const char* const str = NULL;
str = "test";
str = "test2"; 
```

请注意 char* 后面的“const”，它在尝试编译/构建时会产生编译器错误。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T19:41:51.323

此外，将变量声明为 const 意味着该变量是只读的；这并不意味着该值是恒定的！

# javascript - 如何确定何时加载嵌入式 Flash 对象？

> ID：440338
> 
> 赞同：2
> 
> 时间：2009-01-13T19:10:34.757
> 
> 标签：javascript, jquery, flash

嵌入 Flash 对象时，有没有办法确定它何时完全加载？

这是我的基本问题，但对于任何对其背后的细节感兴趣的人：

我正在使用（[DOMWindow](http://swip.codylindley.com/DOMWindowDemo.html)）jQuery 插件。对于那些不熟悉的人来说，这是一个基本的覆盖，出现在页面的中心，高于所有其他变暗的内容。

在 DOMWindow 内部，我嵌入了一个 YouTube 视频。用于嵌入视频的标记是 AJAX 注入的。

DOMWindow 有一个内置的加载图形，但我遇到的问题是 AJAX GET 请求几乎立即完成，3-5 秒，我在等待 YouTube 视频加载时一直盯着一个白色矩形.

如果我能弄清楚如何确定它何时完成加载，我可以在 DOMWindow 内编写一个更优雅的加载方案（使用动画微调器）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T19:38:51.063

你应该看看这个页面[Youtube Player Javascript API](http://code.google.com/apis/youtube/js_api_reference.html)。订阅 onStateChange 事件并寻找它返回 5 似乎是您想要做的。

我会留下我原来的答案，以防它仍然很方便。它在下面。

您可能想查看此[博客条目](http://coderaptor.wordpress.com/2007/09/10/using-javascript-to-handle-flash-actionscript-events/)。他正在将 Flash 事件传递给 javascript 以监视视频。他特别提到等待电影下载并附加到播放器。我不确定这些技术是否适用于 youtube 播放器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T23:58:02.930

如果您正在寻找更通用的 Flash 参考，Flash 可将 OnProgress、OnReadyStateChange 和 PercentLoaded 用作 OBJECT 或 EMBED 元素的 Javascript 属性。[http://www.adobe.com/support/flash/publishexport/scriptingwithflash/scriptingwithflash_03.html](http://www.adobe.com/support/flash/publishexport/scriptingwithflash/scriptingwithflash_03.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T05:18:12.470

完成此操作的最终方法是从 Flash 中获得某种确认它已准备好显示（在本例中为 YouTube API）。

除此之外，Flash 电影加载完成时没有目标点。加载第一帧后，它可以在加载后续内容时显示初始内容，即使加载了根 SWF 文件，它也可能需要加载更多外部内容才能显示任何内容。（YouTube 可能属于后一类，内容由容器 SWF 加载的任何服务也可能属于后者。）

# c++builder - Is it possible to convert an OCX file to a TLB file?

> ID：440344
> 
> 赞同：0
> 
> 时间：2009-01-13T19:12:02.147
> 
> 标签：c++builder, ocx

I'm trying to automate a build, but the instructions require openning an OCX in Borland C++ Builder and saving it as a TLB. How can I reproduce this process through the command line?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-05T15:34:26.370

使用 Delphi/C++Builder 2009，您可以使用 TLIBIMP 和 GENTLB 命令行工具：

1.  1.`tlibimp -I comdlg32.ocx -Ftcomdlg32`
    这会生成一个comdlg32.ridl文件（RIDL是微软IDL的变种）。
2.  2.`gentlb comdlg32.ridl`
    这将生成 comdlg32.tlb 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T21:07:03.163

如果我记得，您可以使用 tlbimport。我承认这已经很久了，而且 tlbimport 可能是 VC++ redist 的一部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T17:01:55.670

这不是最好的解决方案，但它是我能找到的唯一一个可以自动工作的解决方案。我下载了一个名为 AutoHotkey 的免费程序来模拟在 BCB5 中打开 ocx 文件的击键，选中“标志”选项卡下的“可以创建”复选框并将文件保存为 tlb。它也有助于解决烦人的翻译警告！

# sql-server - 如何处理 ETL 任务？

> ID：440346
> 
> 赞同：5
> 
> 时间：2009-01-13T19:12:22.600
> 
> 标签：sql-server, sql-server-2005, ssis, etl

我应该执行 ETL，其中源是一个大型且设计糟糕的 sql 2k 数据库和一个设计更好的 sql 2k5 数据库。我认为SSIS是要走的路。谁能建议一个待办事项清单或清单或需要注意的事情，这样我就不会忘记任何事情？我应该如何处理这个问题，这样它就不会在后面咬我。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-13T19:33:38.267

**一些通用的 ETL 技巧**

1.  考虑按目的地组织它（例如，生成客户维度的所有代码都位于同一个模块中，无论来源如何）。这有时被称为面向主题的 ETL。它使查找内容变得更加容易，并将增加代码的可维护性。

2.  如果 SQL2000 数据库一团糟，您可能会发现 SSIS 数据流是一种笨拙的处理数据的方式。通常，ETL 工具的扩展性很差，而且很复杂。金融公司中的所有数据仓库项目中，有一半是使用存储过程代码作为明确的架构决策来完成的——正是出于这个原因。如果必须将大量代码放入 sprocs 中，请考虑将*所有*代码放入 sprocs 中。

    对于涉及大量复杂清理或转换的系统，100% 存储过程方法更易于维护，因为它是将所有转换和业务逻辑放在一个地方的唯一可行方法。使用混合 ETL/sproc 系统，您必须查看多个位置以跟踪、排除故障、调试或更改整个转换。

3.  ETL 工具的最佳点是在您拥有大量数据源且转换相对简单的系统上。

4.  使代码可测试，这样您就可以分离组件并单独测试。只能在 ETL 工具的复杂数据流中间执行的代码更难测试。

5.  使数据提取哑，没有业务逻辑，并复制到暂存区。如果您的业务逻辑分布在提取和转换层中，您将拥有无法单独测试的转换，并且难以追踪错误。如果转换是从暂存区域运行的，则可以减少对源系统的硬依赖，从而再次增强可测试性。这是基于 sproc 的架构的一个特别胜利，因为它允许几乎完全同质的代码库。

6.  构建一个通用的缓慢变化的尺寸处理程序或使用现成的（如果有）。这使得对这个功能进行单元测试变得更容易。如果这可以进行单元测试，则系统测试不必测试所有极端情况，只需测试提供给它的数据是否正确。这并不像听起来那么复杂——我写的最后一个是大约 600 或 700 行 T-SQL 代码。任何通用擦洗功能也是如此。

7.  如果可能，增量加载。

8.  检测您的代码 - 让它生成日志条目，可能会记录诊断信息，例如检查总数或计数。没有这个，故障排除几乎是不可能的。此外，断言检查是一种考虑错误处理的好方法（在 b 中的行数是否相等，A:B 关系真的是 1:1）。

9.  使用合成密钥。使用来自源系统的自然键将您的系统与数据源联系起来，并且难以添加额外的源。系统中的键和关系应始终对齐 - 没有空值。对于错误，“未记录”，在维度表中创建特定的“错误”或“未记录”条目并与之匹配。

10.  如果您构建操作数据存储（许多宗教战争的主题），请不要回收星型模式中的 ODS 密钥。一定要加入 ODS 键来构造维度，但要匹配自然键。这允许您任意删除和重新创建 ODS - 可能会更改其结构 - 而不会干扰星型模式。拥有此功能是真正的维护胜利，因为您可以随时更改 ODS 结构或强力重新部署 ODS。

第 1-2 点和第 4-5 点意味着您可以构建一个系统，其中任何给定子系统（例如单个维度或事实表）的*所有代码都位于系统中的一个且仅一个位置。*这种类型的架构也更适合大量数据源。

第 3 点与第 2 点相对。基本上，SQL 和 ETL 工具之间的选择是转换复杂性和源系统数量的函数。数据越简单，数据源的数量越多，基于工具的方法就越有说服力。数据越复杂，迁移到基于存储过程的体系结构的理由就越充分。一般来说，最好只使用或几乎完全使用其中之一，但不能同时使用两者。

第 6 点使您的系统更易于测试。测试 SCD 或任何基于更改的功能非常繁琐，因为您必须能够向系统提供多个版本的源数据。如果您将变更管理功能移动到基础架构代码中，您可以使用测试数据集对其进行单独测试。这是测试的胜利，因为它降低了系统测试要求的复杂性。

第 7 点是大数据量时需要观察的一般性能提示。请注意，您可能只需要对系统的某些部分进行增量加载；对于较小的参考表和尺寸，您可能不需要它。

第 8 点与任何无头进程密切相关。如果它在夜间出现问题，您希望有一些战斗机会，看看第二天出了什么问题。如果代码没有正确记录发生的事情并捕获错误，那么您将很难进行故障排除。

第 9 点赋予了数据仓库自己的生命。当仓库拥有自己的密钥时，您可以轻松地添加和删除源系统。仓库键也是实现渐变维度所必需的。

第 10 点是维护和部署的胜利，因为如果您需要添加新系统或更改记录的基数，可以重新构建 ODS。这也意味着可以从 ODS 中的多个位置加载一个维度（想想：添加手动会计调整），而不依赖于 ODS 键。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T19:33:33.413

我拥有每天、每周、每月和每年将数据从 200 多个分布式数据库中提取到中央数据库的 ETL 流程经验。这是大量的数据，我们遇到了许多针对我们情况的问题。但在我看来，无论情况如何，都需要考虑几项：

*   确保在源端和目标端都考虑文件锁定。确保其他进程没有锁定文件（并在必要时删除这些锁定并且有意义）很重要。

*   为自己锁定文件。确保，尤其是在提取数据时锁定文件的源，这样您就不会获得中途更新的数据。

*   如果可能，请提取增量，而不是所有数据。获取数据的副本，然后只提取已更改的行而不是所有内容。您的数据集越大，这一点就越重要。如果必须，请查看期刊和触发器，但随着在特定基础上拥有这些数据变得越来越重要，这可能是我给你的第一条建议。即使它为项目增加了大量时间。

*   执行日志。确保你知道它什么时候工作，什么时候没有，并且在这个过程中抛出特定的错误可以真正帮助调试。

*   文件，文件，文件。如果你建立了这个权利，你将建立它，然后很长一段时间都不会考虑它。但是可以保证，您或其他人将需要在某个时候重新使用它以增强它或进行错误修复。在这些情况下，文档是关键。

HTH，如果我想到别的，我会更新这个。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T19:34:32.883

好吧，我正在为我所在的公司开发 ETL。

我们正在与 SSIS 合作。使用 api 生成和构建我们自己的 dtsx 包。

SSIS 对管理错误并不友好。有时你会得到一个“OleDb 错误”，它可能有很多不同的含义，具体取决于上下文。

阅读 API 文档（他们没有说太多）。

一些链接可以帮助您从那里开始： [http ://technet.microsoft.com/de-de/library/ms135932(SQL.90).aspx](http://technet.microsoft.com/de-de/library/ms135932(SQL.90).aspx)

[http://msdn.microsoft.com/en-us/library/ms345167.aspx](http://msdn.microsoft.com/en-us/library/ms345167.aspx)

[http://msdn.microsoft.com/en-us/library/ms403356.aspx](http://msdn.microsoft.com/en-us/library/ms403356.aspx)

[http://www.codeproject.com/KB/database/SSISProgramming.aspx?display=PrintAll&fid=382208&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=26&select=2551674](http://www.codeproject.com/KB/database/SSISProgramming.aspx?display=PrintAll&fid=382208&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=26&select=2551674)

[http://www.codeproject.com/KB/database/foreachadossis.aspx](http://www.codeproject.com/KB/database/foreachadossis.aspx)

[http://wiki.sqlis.com/default.aspx/SQLISWiki/ComponentErrorCodes.html](http://wiki.sqlis.com/default.aspx/SQLISWiki/ComponentErrorCodes.html)

[http://www.new.facebook.com/inbox/readmessage.php?t=1041904880323#/home.php?ref=logo](http://www.new.facebook.com/inbox/readmessage.php?t=1041904880323#/home.php?ref=logo)

[http://technet.microsoft.com/en-us/library/ms187670.aspx](http://technet.microsoft.com/en-us/library/ms187670.aspx)

[http://msdn.microsoft.com/ja-jp/library/microsoft.sqlserver.dts.runtime.foreachloop.foreachnumerator.aspx](http://msdn.microsoft.com/ja-jp/library/microsoft.sqlserver.dts.runtime.foreachloop.foreachenumerator.aspx)

[http://www.sqlis.com/post/Handling-different-row-types-in-the-same-file.aspx](http://www.sqlis.com/post/Handling-different-row-types-in-the-same-file.aspx)

[http://technet.microsoft.com/en-us/library/ms135967(SQL.90).aspx](http://technet.microsoft.com/en-us/library/ms135967(SQL.90).aspx)

[http://msdn.microsoft.com/en-us/library/ms137709(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms137709(SQL.90).aspx)

[http://msdn.microsoft.com/en-us/library/ms345164(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms345164(SQL.90).aspx)

[http://msdn.microsoft.com/en-us/library/ms141232.aspx](http://msdn.microsoft.com/en-us/library/ms141232.aspx)

[http://www.microsoft.com/technet/prodtechnol/sql/2005/ssisperf.mspx](http://www.microsoft.com/technet/prodtechnol/sql/2005/ssisperf.mspx)

[http://www.ivolva.com/ssis_code_generator.html](http://www.ivolva.com/ssis_code_generator.html)

[http://www.ivolva.com/ssis_wizards.html](http://www.ivolva.com/ssis_wizards.html)

[http://www.codeplex.com/MSFTISProdSamples](http://www.codeplex.com/MSFTISProdSamples)

[http://www.experts-exchange.com/Microsoft/Development/MS-SQL-Server/SSIS/Q_23972361.html](http://www.experts-exchange.com/Microsoft/Development/MS-SQL-Server/SSIS/Q_23972361.html)

[http://forums.microsoft.com/MSDN/MigratedForum.aspx?siteid=1&PostID=1404157](http://forums.microsoft.com/MSDN/MigratedForum.aspx?siteid=1&PostID=1404157)

[http://msdn.microsoft.com/en-us/library/aa719592(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa719592(VS.71).aspx)

[http://forums.microsoft.com/MSDN/MigratedForum.aspx?siteid=1&ForumID=80](http://forums.microsoft.com/MSDN/MigratedForum.aspx?siteid=1&ForumID=80)

[http://blogs.conchango.com/jamiethomson/archive/2005/06/11/SSIS_3A00_-Custom-Logging-Using-Event-Handlers.aspx](http://blogs.conchango.com/jamiethomson/archive/2005/06/11/SSIS_3A00_-Custom-Logging-Using-Event-Handlers.aspx)

[http://blogs.conchango.com/jamiethomson/archive/2007/03/13/SSIS_3A00_-Property-Paths-syntax.aspx](http://blogs.conchango.com/jamiethomson/archive/2007/03/13/SSIS_3A00_-Property-Paths-syntax.aspx)

[http://search.live.com/results.aspx?q=%s&go=Buscar&form=QBJK&q1=macro%3Ajamiet.ssis](http://search.live.com/results.aspx?q=%s&go=Buscar&form=QBJK&q1=macro%3Ajamiet.ssis)

[http://toddmcdermid.blogspot.com/2008/09/using-performupgrade.html?showComment=1224715020000](http://toddmcdermid.blogspot.com/2008/09/using-performupgrade.html?showComment=1224715020000)

[http://msdn.microsoft.com/en-us/library/ms136082.aspx](http://msdn.microsoft.com/en-us/library/ms136082.aspx)

[http://support.microsoft.com/kb/839279/en-us](http://support.microsoft.com/kb/839279/en-us)

对不起“垃圾邮件”，但它们对我非常有用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T19:30:18.337

我们正在做一个*巨大*的ETL（将客户端从旧版 AS400 应用程序迁移到 Oracle EBS），实际上我们有一个流程（经过修改）我可以推荐：

1.  识别关键目标表/字段。
2.  识别关键源表/字段。
3.  与业务用户一起将源映射到目标。
4.  分析质量问题的源数据。
5.  确定谁对已识别的数据质量问题负责。
6.  让责任方清理源中的数据。
7.  根据步骤 1 - 3 中的信息开发实际的 ETL。

根据我的经验，最棘手的步骤是第 2 步和第 3 步——有时很难让业务用户一次性正确识别他们需要的所有位，并且更难正确识别数据的确切来源（尽管这可能与我看到的神秘文件和字段名称有关！）。但是，此过程应该可以帮助您避免重大失误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-19T14:40:57.857

该线程很旧，但我想提请您注意 ConcernedOfTunbridgeWells 的回答。这是非常好的建议，在所有方面。我可以重申一些，但这会减少其余部分，它们都值得仔细研究。

# c++ - How to debug a Visual C++ Runtime Error

> ID：440355
> 
> 赞同：5
> 
> 时间：2009-01-13T19:14:17.883
> 
> 标签：c++, visual-studio, debugging

I am writing a C++ COM object in Visual Studio 2008 that is an Internet Explorer Browser Helper Object. Recently, when running in IE, IE has started frequently popping up a dialog titled "Microsoft Visual C++ Runtime Library" with an error message "Runtime Error!" and going on to say that "The application has requested the Runtime to terminate it in an unusual way. Please contact the application's support team for more information." Unlike usual, this dialog only has an OK button but no debug button, so IE then terminates and I'm not left with so much as a stack trace or even a hint of what part of my code could have been so buggy. I'm not sure *where* in my code it is crashing.

How does one troubleshoot a "Runtime error" problem? What are possible causes of a runtime error? (memory related bugs perhaps?) What sort of problems should I be checking my code for to attempt to eliminate this sort of crash? I need some ideas on how to troubleshoot this one, its a bit elusive.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T19:19:56.873

When you see that dialog, start VS2008 with your COM object project. Then use the menu Debug->Attach to process to attach the debugger to the IE process which has your COM object loaded. Then break into the process (Debug->break all) and you get the stack trace.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T19:52:36.573

由于未处理的异常，它会爆炸。这使您有机会使调试器在第一次机会异常时停止，就在它被引发的地方。打开你的项目，使 iexplorer.exe 成为启动程序。Debug + Exceptions，检查非托管异常上的 Thrown 标志。让它崩溃以获得断点。

# python - 从 Outlook 电子邮件中提取嵌入的图像

> ID：440356
> 
> 赞同：4
> 
> 时间：2009-01-13T19:15:03.077
> 
> 标签：python, email, outlook, cdo.message

我正在使用 Microsoft 的 CDO（协作数据对象）以编程方式从 Outlook 邮箱中读取邮件并保存嵌入的图像附件。我正在尝试使用 Win32 扩展从 Python 执行此操作，但是使用 CDO 的任何语言的示例都会有所帮助。

到目前为止，我在这里...

以下 Python 代码将读取我邮箱中的最后一封电子邮件，打印附件名称，并打印邮件正文：

```
from win32com.client import Dispatch

session = Dispatch('MAPI.session')
session.Logon('','',0,1,0,0,'exchange.foo.com\nbar');
inbox = session.Inbox
message = inbox.Messages.Item(inbox.Messages.Count)

for attachment in message.Attachments:
    print attachment

print message.Text

session.Logoff() 
```

但是，附件名称类似于：“zesjvqeqcb_chart_0”。在电子邮件源中，我看到这样的图像源链接： <IMG src="cid:zesjvqeqcb_chart_0">

那么，是否可以使用此 CID URL（或其他任何内容）来提取实际图像并将其保存在本地？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T20:08:27.620

OS/Outlook/CDO 版本的差异可能是造成混淆的原因，因此以下是使其在 WinXP/Outlook 2007/CDO 1.21 上运行的步骤：

*   安装[CDO 1.21](http://www.microsoft.com/downloads/details.aspx?familyid=2714320d-c997-4de1-986f-24f081725d36&displaylang=en)
*   安装 win32com.client
*   转到 C:\Python25\Lib\site-packages\win32com\client\ 目录运行以下命令：

```
蟒蛇makepy.py
```

*   从列表中选择“Microsoft CDO 1.21 Library (1.21)”，点击确定

```
C:\Python25\Lib\site-packages\win32com\client>python makepy.py
生成到 C:\Python25\lib\site-packages\win32com\gen_py\3FA7DEA7-6438-101B-ACC1-00AA00423326x0x1x33.py
从类型库构建定义...
生成...
导入模块
```

*   检查刚刚生成的文件 3FA7DEA7-6438-101B-ACC1-00AA00423326x0x1x33.py，您将了解哪些类、方法、属性和常量可用。

现在我们完成了无聊的步骤，这是有趣的部分：

```
import win32com.client
from win32com.client import Dispatch

session = Dispatch('MAPI.session')
session.Logon ('Outlook') # this is profile name
inbox = session.Inbox
messages = session.Inbox.Messages 
message = inbox.Messages.GetFirst()

if(message):
    attachments = message.Attachments
    for i in range(attachments.Count):
        attachment = attachments.Item(i + 1) # yep, indexes are 1 based

        filename = "c:\\tmpfile" + str(i)
        attachment.WriteToFile(FileName=filename)
session.Logoff() 
```

如果您有旧版本的 CDO（win2k 的 CDO），同样的通用方法也可以使用

# winapi - How can Windows API calls to an application/service be monitored?

> ID：440360
> 
> 赞同：2
> 
> 时间：2009-01-13T19:15:26.150
> 
> 标签：winapi, monitoring

My company is looking at implementing a new VPN solution, but require that the connection be maintained programatically by our software. The VPN solution consists of a background service that seems to manage the physical connection and a command line/GUI utilty that initiates the request to connect/disconnect. I am looking for a way to "spy" on the API calls between the front-end utilty and back-end service so that our software can make the same calls to the service. Are there any recommended software solutions or methods to do this?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T19:26:37.140

我不明白您为什么要替换该实用程序，而不是简单地从您的应用程序运行该实用程序。

无论如何，您可以运行“dumpbin /imports *whatevertheutilitynameis* .exe”来查看该实用程序链接到的 API 函数名称的静态列表；这不显示调用它们的顺序，也不显示参数值。

然后，您可以使用系统调试器（例如 Winice 或其他更现代的等价物）在这些 API 上设置断点，以便在实用程序调用这些 API 时中断调试器（然后可以检查参数值）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T19:28:31.943

您也许可以使用[Spy++](http://msdn.microsoft.com/en-us/library/aa242713(VS.60).aspx)等工具收集一些信息来查看 Windows 消息。调试/跟踪工具（[Windbg](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)等）可以让您查看正在进行的 API 调用。[Sysinternals](http://technet.microsoft.com/en-us/sysinternals/default.aspx)工具可以在一定程度上向您显示系统信息的使用细节。

尽管我在很大程度上建议不要这样做——是否可以联系解决方案提供商并获取文档？其中一个原因是脆弱性——如果供应商不希望用户使用界面的这一方面，他们更有可能在不通知的情况下更改它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T19:20:27.623

Typically, communications between a front-end application and back-end service are done through some form of IPC (sockets, named pipes, etc.) or through custom messages sent through the Service Control Manager. You'll probably need to find out which method this solution uses, and work from there - though if it's encrypted communication over a socket, this could be difficult.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T19:24:52.527

就像 Harper Shelby 所说，这可能非常困难，但是您可以从[filemon](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)开始，它可以告诉您某些进程何时创建或写入文件，[regmon](http://technet.microsoft.com/en-us/sysinternals/bb896652.aspx)可以对注册表的写入和读取执行相同的操作，而[wireshark](http://www.wireshark.org/)可以监控网络交通。这可以为您提供一些数据，但即使有数据，也可能很难以允许您进行相同调用的方式进行解释。

# delphi - Is possible to include files (linking) based on a component property?

> ID：440364
> 
> 赞同：2
> 
> 时间：2009-01-13T19:17:27.097
> 
> 标签：delphi, pascal, conditional-compilation

Delphi 2007/2009 odd question here:

It's possible, based on a component property defined in design-time, to include files in linking or leave them ?

Example: If I leave SomeProperty true, when compiling, the unit SomeUnit will be included into my project. Otherwise it will not be included.

My second approach to this problem is to deploy a second component, which when dropped in the form (or not) will include the unit in uses clause. But if it can be done with a property, that'll be better.

I want to avoid conditional compilation via IFDEF because that forces the component to be built every time the projects are built. Or not?

I am trying to achieve an easy way of including some units in project, and then those units will provide support for specific databases. Having these into an option, at the connection component, will be ideally easy: Check support and that's done. Uncheck, and get some less KBs in your compiled APP.

edit: I'll stay with the component way for instance. I knew the IFDEF method and things, but that forces the component to be built everytime the projects are built. Or not?

I was trying to achieve an easy way of including some units in project, and then that units will provide support for specific databases. Having these into an option, at the connection component, will be ideally easy: Check support and that's done. Uncheck, and get some less KBs in your compiled APP.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T19:53:54.373

不。

你想解决什么问题？

您可以添加一个后编译步骤，该步骤可以选择包含一些基于组件属性的资源 - 但您必须进行一些编码才能实现这样的功能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T20:08:36.247

您可以使用 {$IFDEF youridentifier} 可选代码 {$ENDIF} 方法有条件地将数据编译到您的应用程序中，然后启用它只需转到您的项目选项并在适当的选项字段中输入 youridentifier。另一种方法是将以下内容添加到单元顶部（或包含文件中）：

{$DEFINE youridentifier}

这将强制你的标识符。要禁用，只需在 $ 之前放置一个句点：

{.$DEFINE youridentifier}

使用这些技术很容易在每次编译时有条件地引入代码或替换代码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T19:58:21.883

编写一个 IDE 插件。处理“编译前”通知并检查项目中是否有任何表单或数据模块具有您感兴趣的类型的组件，然后检查它们的属性。根据您在那里找到的内容，您可以尝试修改一个单元的内容以使用您选择的另一个单元。这听起来当然不容易，但似乎有可能。

你的第二个想法很容易。例如，这正是`TXPManifest`组件所做的。请注意，从表单中删除此类组件*不会*“取消使用”关联的单元。

要有条件地添加对不同数据库的支持，您可以考虑使用运行时包。（毕竟，这就是 IDE 设法支持这么多不同类型的组件的方式。）将每个数据库的自定义代码放入不同的包中。然后，您支持的数据库只是在运行时具有可用包的数据库。无需编译时或设计时配置。然而，这样做的障碍是管理哪些软件包可用，并确定其中哪些是提供数据库支持的软件包。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T16:15:51.107

没有办法按照您的要求进行操作，但您可能不知道的是，包含在您的使用列表中但从未被引用的单元将对您的可执行文件的大小产生最小的影响。Delphi 中的智能链接器在删除从未使用过的代码方面做得非常好。如果您对组件引用的“可选单元”很小心，并且其中没有任何全局执行的代码（所有内容都包含在一个或多个类中），那么它是否无关紧要在uses子句中并且没有使用，或者根本不在uses子句中。

这将很容易让您做我认为您想做的事情，即在表单上放置一个组件，该表单包含一个单元，然后可以链接到您的应用程序。删除该组件将具有不在单元中链接的效果。但是，我相信，已使用单元中的任何资源（例如 $R 指令包含的表单或其他项目）仍将包含在可执行文件中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-14T16:55:37.447

您的第二种方法不一定会按照您希望的方式工作。当您将组件拖放到表单上时，Delphi 将有助于将必要的单元添加到您的使用列表中，但在您删除组件时它不会删除该单元。即使您不使用组件或从该单元导出的任何其他实体，当单元的**初始化**或**完成**部分中有代码时，该单元也可能会链接到您的应用程序。不幸的是，这种情况经常发生，即使可以按需初始化东西。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-10T01:03:21.370

您可以使用 DesignIntf​​.RegisterSelectionEditor 注册选择编辑器（请参阅 Delphi 源代码中有关 ISelectionEditor 的注释），然后使用 RequiresUnits 过程在 uses 子句中包含额外的单位。

```
TMySelectionEditor = class(TSelectionEditor)
public
  procedure RequiresUnits(Proc: TGetStrProc); override;
end;

procedure Register;

implementation

procedure TMySelectionEditor.RequiresUnits(Proc: TGetStrProc);
var
  comp: TMyComponent;
  I: Integer;
begin
  inherited RequiresUnits(Proc);
  Proc('ExtraUnit');  
  // might be a better way of doing the code from here onwards?
  if (Designer=nil)or(Designer.Root=nil) then Exit;

  for I := 0 to Designer.Root.ComponentCount - 1 do
  begin
      if (Designer.Root.Components[i] is TMyComponent) then
      begin
        comp := TMyComponent(Designer.Root.Components[i]);
        if comp.SampleProperty = True then
            Proc('ExtraUnit2');
        Proc(comp.ObjProperty.UnitName);
      end;
  end;
end;

procedure Register;
begin
  RegisterSelectionEditor(TMyComponent, TMySelectionEditor);
end; 
```

# emacs - blogging from within emacs

> ID：440371
> 
> 赞同：5
> 
> 时间：2009-01-13T19:18:41.620
> 
> 标签：emacs, blogs

I would like to know what packages and tools to use to write blogs from within emacs. I mean packages to write and publish. I 've seen a demo of that in textmate : [http://blog.macromates.com/2006/blogging-from-textmate/](http://blog.macromates.com/2006/blogging-from-textmate/)

Is it possible to do the same in emacs?

Thank you very much.

Edit: I found a package in google code that serve blogging form emacs [e-blog](http://code.google.com/p/e-blog/)

I still don't get it why this thread is closed !!!! Not related to development!!???

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T19:32:58.143

emacspeak 有[一个连接到 Blogspot 的模块](http://emacspeak.blogspot.com/2007/03/emacs-client-for-google-services.html)，但我无法让它用于编辑帖子。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T19:34:29.060

[EmacsWikiBlog](http://www.sfu.ca/~gswamina/EmacsWikiBlog.html)可能适合您的目的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T19:38:28.273

您可以使用[Planner 模式](http://www.emacswiki.org/emacs/PlannerMode)[完成类似博客的工作](http://www.emacswiki.org/emacs/?action=browse;oldid=PlannerRecipes;id=PlannerModeMethods#toc7)。

* * *

## 回答 #4

> 赞同：-7
> 
> 时间：2009-01-13T19:22:03.780

I don't think emacs is the right tool for this job.

Perhaps you should check out [Blogger](https://www.blogger.com/start) or if you have hosting and want to start a blog maybe try [Wordpress](http://wordpress.org/).

# version-control - Why are check-in/commit comments a required field in some source control systems?

> ID：440375
> 
> 赞同：4
> 
> 时间：2009-01-13T19:20:04.283
> 
> 标签：version-control

In Perforce (atleast the GUI) a check-in/commit comment is required. (I don't believe they are required in Git or Subversion.) Most developers that work with me just fill it in with latest/updated/etc. I used to write meaningful descriptions, but at about 20 comments a day with stuff like 'replace an image.' 'Changed spelling of 'franhcise' gets really annoying. Furthermore most changes can be quickly seen in a Diff.

At first I thought I was just being lazy, but I tend not to even look at them when reviewing other peoples code. I'd rather go right to the Diff. Am I alone? Are required comments a good idea?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T19:22:25.310

You should always leave good comments. Not necessarily describing *what* you changed, unless it is a large changeset with too many distracting little details... but always, **always**, describe *why* you made the change (maybe link to a bug tracker item if there is one).

When i'm looking at your diff a year later, after realizing that it introduced a subtle bug, i need to know why the change was made - if i can't find a good reason, i'm just going to roll it back and curse your lazy ways... ;-)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-13T19:27:46.530

有意义的评论有几个目的：

*   如果您正在查找版本历史记录中的特定更改，它们可以让您快速浏览文件的历史记录（例如：“嘿，我知道我们在去年 3 月的某个时候修复了有关此小部件闪烁的错误。你还记得解决方法是什么？”）。

*   他们鼓励您进行原子化提交。如果您最终使用通用注释进行签到，那可能意味着您一次做的事情太多。

*   如前所述，它们让您知道事情发生变化的原因。当然，差异可以告诉您，例如，税款计算如何针对某某项目发生变化。但它不会告诉你这是因为税收的 XYZ 法发生了变化。

*   它们使编写发行说明或等效文档变得更加容易。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-13T19:27:09.480

也许有点不同的观点：

如果您想查看一年内或自上次发布以来的所有更改 - 您想查看所有差异，还是想查看良好的提交评论和指向缺陷/问题项的链接？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T20:20:50.557

正如对[Shog9 的回答的评论中所讨论的那样，](https://stackoverflow.com/questions/440375/why-are-check-in-commit-comments-a-required-field-in-some-source-control-systems#440387)*在工具级别*强制执行评论并不一定有助于让懒惰的人保持一致，因为要求太容易规避（正如问题中已经提到的那样：只需输入“最新"/"updated"/etc，甚至是 "sfakjs;d"，这可能比空行更有害）。

但是，该工具需要它这一事实*可能会*提醒通常勤奋的开发人员，他们会在没有任何解释的情况下意外提交。如果它只这样做一次，那么我们是有利的（即，要求是有益的），因为通常功能没有任何区别 - 好人无论如何都会写评论，而坏女孩总是可以绕过要求，无论您设置什么技术障碍。（当然，你是否想让他们继续工作是另一个问题。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T19:30:06.683

如果您每天进行 20 次签到，那么您可能签到太频繁了。将所有小的拼写错误修复分组到一个签入中，并带有“修复了各种拼写错误”的评论。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-13T20:01:11.440

写一个有意义的评论大约需要 30 秒，所以请克服它并去做。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-01-13T19:24:23.823

Mostly because they are not meant to be used for making commits after changing a css attribute etc., but rather after making a more meaningful change/bugfix. But comments are very useful anyways.

# java - 反射运行时性能 - Java 与 CLR

> ID：440390
> 
> 赞同：2
> 
> 时间：2009-01-13T19:22:43.123
> 
> 标签：java, reflection, clr, performance

一个相关的帖子[在这里](https://stackoverflow.com/questions/435553/java-reflection-performance)几乎确立了在 Java 中作为性能猪的反映。这也适用于 CLR 吗？（C#、VB.NET 等）。

***编辑***：在反射方面，CLR 与 Java 相比如何？有没有做过基准测试？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T19:50:58.293

我并不真正关心使用反射本身的对象的实例化性能，而是方法的实际性能等等，因为无论如何我都会从类中使用这些。

当然，实例化需要很多时间，如链接的帖子中所示，但由于您很可能使用对象的方法而不是仅实例化它，因此您不必太担心反射性能 - 只要您是不通过调用反射`Method`对象来进行方法调用！

此外，您只需要对象的一个​​反射实例，`.clone()`如果您需要创建更多副本，请使用和其他巧妙的技巧。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T19:24:20.330

是的，.NET 中的反射也是一项性能密集型操作，因为它需要查询程序集中的元数据表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T19:31:45.073

值类型的 Equals 的默认实现是使用反射实现的。它可以工作，但是速度很慢，并且很容易实现特定版本，这要快得多（问题是您还必须实现 GetHashCode）。当然，快多少取决于实际的价值类型，但我在这里看到了一些巨大的提升。

# html - 如何告诉 Web 浏览器关于 Atom 提要

> ID：440391
> 
> 赞同：17
> 
> 时间：2009-01-13T19:23:03.450
> 
> 标签：html, feed, atom-feed

我的网站有一个 Atom 提要，我想让订阅它变得更容易。我看到许多站点（例如 StackOverflow）在 Firefox 3 的位置栏中都有 Atom 图标。但是，我还没有弄清楚如何做。

我假设需要一些 HTML - 但是哪些标签指定页面具有提要的浏览器？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-13T19:36:14.097

虽然（全部！）其他答案中提供的代码是绝对正确的，但如果使用的格式实际上是 Atom ，我建议*不要为您的提要提供“RSS”标题。*当然，RSS 指的是一种完全独立的供稿和联合格式，普通民众对它们之间的差异有足够的混淆，因此我不建议火上浇油。:-)

相反，请根据您的内容为您的提要提供更具描述性的标题（例如“新闻提要”、“博客提要”、“漫画”等）。此外，如果您有不止一种类型的内容，您绝对可以在同一页面中包含多个提要链接！

```
<link rel="alternate" type="application/atom+xml" title="News" href="/atom.xml?type=news" />
<link rel="alternate" type="application/atom+xml" title="Blog" href="/atom.xml?type=blog" />
<link rel="alternate" type="application/atom+xml" title="Comics" href="/atom.xml?type=comics" /> 
```

# iis - 在 iis6 中刷新缓存

> ID：440406
> 
> 赞同：3
> 
> 时间：2009-01-13T19:25:21.763
> 
> 标签：iis, caching, iis-6

出于某种神奇的原因，ii6 开始在服务器上缓存页面。即使我删除了页面，它仍然会显示。我试图遵循几个建议，但没有运气。这就是我到目前为止所做的：

1.  已删除 \WINDOWS\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET Files
2.  在 IIS 配置中未选中“缓存 ISAPI 扩展”。
3.  向属性中的 HTTP 标头添加了“Cache-Control no-cache”。
4.  试图创建清除缓存的页面[http://www.dotnet247.com/247reference/msgs/13/67641.aspx](http://www.dotnet247.com/247reference/msgs/13/67641.aspx)

更新：还尝试禁用asp缓存 [IIS ASP缓存](https://stackoverflow.com/questions/103158/iis-asp-caching) 但是v2.0.50727\Temporary ASP.NET Files中的文件仍然被创建

如果有人有其他建议，请分享。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-11-23T12:47:23.380

请授予 IIS 用户对以下文件夹的删除权限。这些文件将被 IIS 自动删除

对于 64 位操作系统文件夹路径：\WINDOWS\Microsoft.NET\Framework64\v2.0.50727\Temporary ASP.NET Files

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-12-13T02:31:51.220

我的经典 ASP 页面不会从任何浏览器刷新。最后，停止和启动 IIS 服务 (IIS6) 解决了这个问题。

你也可以像我一样发疯。只需让 IIS 开始发出陈旧的页面！便宜一半的价格！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T19:33:34.740

您是否尝试重新启动 IIS 服务器以查看是否停止显示？如果没有，那么它可能不是缓存问题。

我相信重新启动服务器应该清除缓存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T20:46:46.950

也许问题不在于 IIS，而在于浏览器和缓存页面的 Web 服务器之间的 Web 代理？

还是指向另一个拥有该网页/页面副本的服务器的错误 DNS 设置？如果配置了另一个 Web 并且主机标头混淆了，您也可以在同一个 IIS 上查看，从而使您在错误的 Web 上进行测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T01:55:37.823

我可能只是在这里说显而易见的，但是您是否尝试过回收应用程序池？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T16:59:23.127

谢谢大家的回复。

我发现这不是缓存问题。我没有清除 Bin 文件夹，并且扩展名为 .compiled 的页面的编译版本一直都在那里。这次我没有改变什么，但我遵循了 100 次之前的相同过程，并在没有清除 Bin 的情况下将文件复制到顶部。

我应该对这些事情更准确。

# netbeans - 使用 JNI 的 NetBeans 库

> ID：440407
> 
> 赞同：8
> 
> 时间：2009-01-13T19:25:21.823
> 
> 标签：netbeans, java-native-interface

## 我可以定义一个在 NetBeans 中使用 JNI 的库吗？

似乎库定义只允许罐子或文件夹。

构建应用程序时，如何确保 DLL 遵循 jar 文件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-01-06T02:19:33.033

假设您指的是构建 NetBeans 平台应用程序（或模块），那么您可以将 DLL 放在“release/modules/lib/”文件夹中。这是每个平台常见问题解答：

*   [http://wiki.netbeans.org/DevFaqNativeLibraries](http://wiki.netbeans.org/DevFaqNativeLibraries)

此处的附加信息：

*   [http://bits.netbeans.org/dev/javadoc/org-openide-modules/org/openide/modules/doc-files/api.html#jni](http://bits.netbeans.org/dev/javadoc/org-openide-modules/org/openide/modules/doc-files/api.html#jni)

如果您问得更笼统，那么我认为大多数人将 DLL 打包在 jar 中，然后在应用程序启动时将其提取到临时位置。例如

*   [如何制作包含 DLL 文件的 JAR 文件？](https://stackoverflow.com/questions/1611357/how-to-make-a-jar-file-that-include-dll-files)

如果这不是您要查找的内容，那么您需要提供有关您要执行的操作的更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-11T13:39:56.067

netbeans 不会自己做，但由于它在幕后使用 ant，所以有一种解决方法。

`jni`你应该在你的项目目录中创建一个名为的子目录`c:\path\to\mynetbeansproject\jni`（标签`build.xml`：`</project>`

```
<target name="-post-compile">
    <copy todir="${dist.dir}/lib">
        <fileset dir="jni" />
    </copy>
</target> 
```

然后像往常一样将 jar 文件添加到您的项目中。:)

当您从 netbeans（或从命令行）调用“Clean and Build”时，您插入的代码片段`build.xml`将确保本机库遵循文件夹中的 jar 文件；jvm 将在与加载它们的 .jar 相同的目录中查找 .dll（.so、.jnilib）文件，因此它可以工作。`dist/lib``ant`

请注意，这不会让您的项目在 netbeans 中运行，因为……我不太确定发生了什么，但看起来库路径 ( `LD_LIBRARY_PATH`) 不包括您的项目的库，而且我无法知道从netbeans中改变它。只需将您的本机库`/Library/Java/Extensions`放在 mac os x 上，或者将它们存放`c:\windows\system32`在 windows 下。如果您使用 64 位 jvm 运行 64 位 Windows，我不知道；如果您正在运行 linux，您可能知道将它们存放在哪里，但这`/usr/lib/java`可能是一个不错的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-18T19:36:45.793

我在使用 NetBeans 7.0.1 时测试了以下解决方案并且它有效，但我不知道它是否也适用于早期版本。

该解决方案很简单，并且适用于每个 NetBeans 模块。因此，如果您有一个套件，请不要将其 JNI 文件放入套件项目中，而是将您想要的 JNI 文件放入模块本身中。做：

1.  找到您想要（或需要或认为）放置 JNI 库（扩展名为 .DLL、.so 和 .jnilib，例如）的 NetBeans 模块项目；
2.  在项目中，右键单击模块节点，单击属性菜单；
3.  在 Project Properties 对话框中，单击 Libraries and Wrapped JARs。您必须在那里添加任何外部库。我添加了 RxTX jar 库。添加外部库后，Netbeans Ant 脚本将在您构建解决方案时将目录 your_project_dir/release 中的所有文件/文件夹复制到正确的位置。
4.  因此，将您的本机库放在**your_project_dir/release/lib**中。如果需要，您可以为所需的每个目标平台创建子目录，例如：**your_project_dir/release/lib/amd64**、 your_project_dir/release/lib/sparc32

    要了解更多信息，请阅读： [http ://bits.netbeans.org/dev/javadoc/org-openide-modules/org/openide/modules/doc-files/api.html#jni](http://bits.netbeans.org/dev/javadoc/org-openide-modules/org/openide/modules/doc-files/api.html#jni)

    问候， marciowb.info

# java - 默认在哪里安装本地 Java 库？

> ID：440408
> 
> 赞同：2
> 
> 时间：2009-01-13T19:25:47.813
> 
> 标签：java, installation, java-native-interface, shared-libraries, autotools

我正在将 JNI 绑定与 C++ 库集成。

该库遵循通常的约定：`/usr/local`默认情况下安装根目录，并且可以使用`--prefix`参数修改为`./configure`; `.a`或`.so`文件进入`${prefix}/lib`；等等

JNI 绑定生成两个新库，`libfoojni.so`（本机部分）和`libfoo.jar`（Java 部分）。

在这种方案下，放置这些文件（例如`${prefix}/java`）的常规位置是什么？

允许用户提供一个单独的 Java 根目录（例如`/usr/share/java`）是否更可取？

应该`libfoojni.so`进入`${prefix}/lib`或进入一些特定于 Java 的子目录？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T10:12:14.950

过去在 Linux 上完成 JNI 时，我将 .so 文件与应用程序捆绑在 JNI 库的特定目录中。然后将其添加到运行应用程序的 JVM 实例的 LD_LIBRARY_PATH 环境变量中。

所以我想说这方面并没有真正的约定（除了用于系统范围的东西的 Linux lib 目录）。

希望有帮助。

# version-control - 您如何使用托管内容对应用程序进行 CM

> ID：440409
> 
> 赞同：2
> 
> 时间：2009-01-13T19:26:04.523
> 
> 标签：version-control, web-applications, content-management-system

我们有一个 Web 应用程序，其中包含系统操作员可以更改的一堆内容（例如新闻和事件）。有时我们会发布软件的新版本。该软件被标记并存储在颠覆中。但是，对于如何最好地控制可能独立更改的内容，我有点担心。人们使用哪些机制来确保以可以重新创建站点或至少受版本控制的方式存储和版本化内容？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T07:29:36.213

当您确定两组具有自己生命周期的文件（一方面是软件文件，另一方面是“新闻和事件”）时，您就会知道：

*   您不能同时对它们进行版本控制
*   你不应该贴上相同的标签

您需要单独保存“新闻和事件”文件（在 VCS 或 Ian Jacobs 建议的数据库中，或在 CMS - 内容管理系统中），并找到将拖链链接在一起的方法（一个 id、一个时间戳，元标签，...）

不要忘记，您不仅在谈论生命周期方面的两组不同文件，而且还谈论不同性质的文件集：

考虑 S.Lott 在这个 SO 问题“[资产管理是源代码控制的超集](https://stackoverflow.com/questions/438969)”中引入的[术语](https://stackoverflow.com/users/10661/s-lott)

*   软件文件：**基础设施信息**，即“代表企业信息资产的处理”。您的代码是该资产的一部分，并由 VCS（版本控制系统）管理，作为配置管理规程的一部分。
*   “新闻和事件”：**企业信息**，即数据（未处理）；这通常分为内容管理器和关系数据库。

所以不是所有的东西都应该在 Subversion 中结束。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T19:29:04.267

将所有内容保存在 DB 中，并为 DB 的每个事务提供时间戳。这样，您就可以保留标准数据库备份，并在最坏的情况发生时在您想要的任何日期加载站点内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-18T10:17:23.187

我想部分答案取决于您使用的 CMS 以及您的网络应用程序的设计方式，但总的来说，我会将新闻项目或事件等数据视为“内容”。换句话说，它不是您的应用程序的一部分——它是您的应用程序处理的数据。

当然，您的 CMS 代码和应用程​​序代码之间会有版本控制问题。您可以通过定义两者之间的接口来管理它。就个人而言，我会将数据作为 XML 发布到 Web 应用程序，这使您可以使用 XML 模式来准确定义 CMS 需要生成什么，以及 Web 应用程序应该期望处理什么。

这应该意味着 Web 应用程序中的大多数更改都可以在不对数据呈现进行相应更改的情况下进行。当功能更改需要这样做时，您可以创建架构的新版本并继续取得进展。在这种情况下，我将使用 Web 应用程序代码检查架构，但使用 YMMV。

这并不容易，如果您需要 CMS 中的其他数据字段，它会再次变得更加复杂。期望计划一个相当复杂的发布过程（也取决于您的开发-测试-验收-生产场景的复杂程度。）

如果您没有使用 CMS，那么您应该考虑一下。（当然，如果操作非常小，它可能仍然属于可以接受手工操作的类别。）简单地将原始数据放入版本控制系统并不能解决问题 - 您需要能够控制将数据发布到 Web 应用程序的格式。几乎可以肯定，这种格式应该是供软件使用的，因此通常不适合编写新闻或事件的那种人手动编辑。

# open-source - 如何跨多个开源代码存储库查找项目？

> ID：440412
> 
> 赞同：2
> 
> 时间：2009-01-13T19:26:54.443
> 
> 标签：open-source, code-search-engine

有很多开源代码存储库[——SourceForge](http://www.sourceforge.net)、[Google Code](http://code.google.com/)、[Project Kenai](http://projectkenai.com)等。

是否有一个一站式的地方可以让我在所有这些存储库中找到、发现或搜索开源项目？还是我必须访问所有这些才能找到我感兴趣的东西？

**编辑：**我应该指定我对搜索项目描述感兴趣，而不仅仅是代码行。我想回答：“有没有现成的 X 工具？” - 它是否被积极维护，以及其他类似的更高级别的问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T19:44:57.883

[Krugle](http://opensearch.krugle.org)允许您搜索开源代码、开源项目甚至 SCM 签入注释。不去爱的种种？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T19:43:38.200

你试过[freshmeat.net](http://freshmeat.net/)吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T20:34:17.160

开源软件有几个目录，例如：

*   [http://www.opensourcesoftwaredirectory.com/](http://www.opensourcesoftwaredirectory.com/)
*   [http://osload.com/](http://osload.com/)

在谷歌搜索“开源目录”以找到其他人。

# java - 非 GUI Java 应用程序的正确后台进程行为是什么？

> ID：440417
> 
> 赞同：3
> 
> 时间：2009-01-13T19:28:26.607
> 
> 标签：java, background

Java 命令行应用程序在不占用资源的情况下进行后台工作的正确方法是什么？它应该在循环中使用 sleep() 还是有更优雅/有效的方式？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T19:54:51.373

一些启发式：

*   不要试图在您的应用程序中做出调度决定。操作系统的调度程序比你的要好得多。让它完成它的工作。
*   如果没有必要，请不要投票。例如，不是睡*n*秒，然后醒来检查一个未阻塞的套接字，而是阻塞套接字。第二种策略与操作系统的调度程序配合得更好。
*   如果没有必要，不要使用巨大的堆，并且尽量不要一次分配巨大的内存块。抖动应用程序往往会对系统性能产生负面影响。
*   使用缓冲 I/O。总是。如果您认为您需要非缓冲 I/O，请确保您是对的。（你可能错了。）
*   不要产生很多线程。线程非常昂贵；超过某个点，更多线程会*降低*应用程序的性能。如果您同时有很多工作要做，请学习和使用`java.util.concurrent`.

当然，这只是一个入门列表......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T19:41:12.650

如果没有工作要做，我只会使用 sleep() 。例如，如果您正在执行诸如定期轮询任务队列之类的事情并且那里没有任何内容，请睡眠一段时间然后再次检查，等等。

如果您只是想确保不占用 CPU，但您仍在做实际工作，您可以定期调用 Thread.yield()。这将放弃对 CPU 的控制并让其他线程运行，但不会让您进入睡眠状态。如果其他进程不需要 CPU，您将获得控制权并继续工作。

您还可以将线程设置为低优先级： myThread.setPriority(Thread.MIN_PRIORITY);

正如以实玛利所说，不要在你的主线程中这样做。而是创建一个“工作线程”。这样您的 UI（GUI 或 CLI）仍然会响应。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T20:07:53.830

有几种方法。我会使用 ExecutorService... 例如：

```
ExecutorService service = Executors.newCachedThreadPool();

Callable<Result> task = new Callable<Result>() {
    public Result call() throws Exception {
        // code which will be run on background thread
    }
};

Future<Result> future = service.submit(task);

// Next line wait until background task is complete
// without killing CPU. Of course, you can do something
// different here and check your 'future' later.
//
// Note also that future.get() may throw various exceptions too,
// you'll need to handle them properly

Result resultFromBackgroundThread = future.get(); 
```

这是 Java 5 代码，ExecutorService、Callable、Future 等都在`java.util.concurrent`包中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T19:33:49.530

一个起点是确保只使用那些资源而没有其他对象（以便它们成为垃圾收集器）。

将 sleep() 放在单线程应用程序中只会停止当前线程。如果您尝试完成在后台处理的数据，而信息仍需要呈现给用户，那么最好将后台进程放在单独的线程中。

# linux - Linux 的 SSH“登录监视器”

> ID：440427
> 
> 赞同：9
> 
> 时间：2009-01-13T19:31:38.053
> 
> 标签：linux, ssh

我正在尝试编写一个脚本，当有人通过 ssh 登录机器时通知用户。

我目前的想法是在间隔中使用 grep 解析“w”的输出。

但这既不优雅也不高效。有没有人更好地了解如何实施这样的程序？

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-13T20:02:07.147

Paul Tomblin 的建议是正确的。

在您的 sshd_config 中设置日志记录以指向您可以单独记录的系统日志工具：

=> 查看 man 3 syslog 了解更多功能。选择一个，例如

```
# Logging
SyslogFacility local5
LogLevel INFO 
```

然后像这样设置你的 syslog.conf：

```
local5.info    |/var/run/mysshwatcher.pipe 
```

将您要写入的脚本添加到 /etc/inittab 以使其继续运行：

```
sw0:2345:respawn:/usr/local/bin/mysshwatcher.sh 
```

然后写你的脚本：

```
#!/bin/sh

P=/var/run/mysshwatcher.pipe
test -p $P || mkfifo $P

while read x <$P; do
  # ... whatever, e.g.:
  echo "ssh info: $x" | wall
done; 
```

最后，重新启动您的 syslogd 并重新加载您的 inittab (init q)，它应该可以工作。如果使用这些服务的其他变体，则需要相应地进行配置（例如 newsyslogd => /etc/newsyslog.conf；Ubuntu：/etc/event.d 而不是 inittab）

这是非常基本的和缺乏的，但应该足以让你开始......

更多信息：man sshd_config 以获得更多日志记录选项/详细信息。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-13T19:46:25.400

在 Ubuntu 上（我猜所有其他 Debian 发行版，如果不是所有的 Linuces 的话），文件 /var/log/auth.log 记录成功（和不成功）的登录尝试：

```
sshd[XXX]: pam_unix(sshd:session): session opened for user XXX 
```

您可以使用此命令设置一个非常简单的监视器（请注意，您必须是 root 才能查看身份验证日志）：

```
sudo tail -F /var/log/auth.log | grep sshd 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-18T20:54:58.243

如果您不关心他们是如何登录的（telnet/ssh），“last”Unix 命令行实用程序会向您显示机器上的最后几次登录。远程用户将显示 IP 地址

[root@ex02 www]# last foo pts/1 81.31.xy Sun Jan 18 07:25 仍然登录
foo pts/0 81.31.xy Sun Jan 18 01:51 仍然登录
foo pts/0 81.31.xy Sat Jan 17 03:51 - 07:52 (04:00)
bar pts/5 199.146.xy 1 月 16 日星期五 08:57 - 13:29 (04:32)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-13T19:36:34.000

设置一个命名管道，并设置一个日志文件解析器来监听它，并将 ssh 消息发送给它。日志文件解析器可以做你想做的事，或者发信号给一个守护进程去做。

重定向日志文件是在 /etc/ 中的配置文件中完成的，其名称现在让我无法理解。/etc/syslog.conf，我想。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-03-07T08:12:23.740

我制作了一个程序（我称之为身份验证监视器）来解决问题中描述的任务。

如果您愿意，非常欢迎您下载它来研究我如何解决这个问题（使用日志文件）。

您可以在这里免费找到身份验证监视器：[http ://bwyan.dk/?p=1744](http://bwyan.dk/?p=1744)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-05-22T14:47:45.510

我们遇到了同样的问题，所以我们编写了自己的脚本。它可以从[github](https://github.com/IntellexApps/ssh_notify)下载。

希望能帮助到你 ：）

干杯！伊万

# ant - InstallAnywhere 安装程序的 Ant 自动化 - 控制台模式

> ID：440429
> 
> 赞同：1
> 
> 时间：2009-01-13T19:32:01.983
> 
> 标签：ant, installation, 7zip

我的问题是创建一个 ant 目标来自动化我们在控制台模式下运行的安装程序。

安装程序是使用 InstallAnywhere 2008 创建的，UniversalExtractor 将其识别为 7-zip 存档。解压存档后，该任务似乎可以使用输入文件来驱动控制台（至少，发出退出似乎可以正确关闭所有内容，并捕获输出）。

所以在我看来，我似乎拥有证明这个想法所需的所有东西，除了一种干净的方式来执行-自提取-然后-停止。搜索停止自动执行的命令行参数并没有产生一个可能的候选者，而且我发现的唯一合适的 ant 任务 ( [http://www.pharmasoft.be/7z/](http://www.pharmasoft.be/7z/) ) 并没有那么清楚地记录在案我对它很有信心。

完成后预计将在 Windows、Linux 和少数其他 Unix 环境中工作。

在这里使用的最佳做法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T14:50:00.463

由于您控制安装程序的创建，您是否可以在您的机器上运行自解压步骤，在安装程序启动之前将结果打包为 ZIP 文件等，并使用它而不是单个文件可执行文件？不是很优雅，但它可能会起作用。

另外，我有点犹豫是否要公然宣传我的项目 :) 但是自从您提出这个问题以来已经有一段时间没有人回答了，您是否考虑过替代方案？我们的项目[InstallBuilder](http://installbuilder.bitrock.com)允许您直接在无人值守模式下安装，而无需自动提取内容。只需使用 --mode unattended 调用可执行文件，从命令行或外部文件传递您可能需要的任何其他选项，您就可以开始了。我们有很多前 InstallAnywhere 客户 :)

# java - Java 按扩展名对文件名的字符串数组进行排序

> ID：440430
> 
> 赞同：5
> 
> 时间：2009-01-13T19:32:20.983
> 
> 标签：java, arrays, file, sorting, filenames

我有一个文件名数组，需要按文件名的扩展名对该数组进行排序。是否有捷径可寻？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-13T19:39:17.303

```
Arrays.sort(filenames, new Comparator<String>() {
    @Override
    public int compare(String s1, String s2) {
        // the +1 is to avoid including the '.' in the extension and to avoid exceptions
        // EDIT:
        // We first need to make sure that either both files or neither file
        // has an extension (otherwise we'll end up comparing the extension of one
        // to the start of the other, or else throwing an exception)
        final int s1Dot = s1.lastIndexOf('.');
        final int s2Dot = s2.lastIndexOf('.');
        if ((s1Dot == -1) == (s2Dot == -1)) { // both or neither
            s1 = s1.substring(s1Dot + 1);
            s2 = s2.substring(s2Dot + 1);
            return s1.compareTo(s2);
        } else if (s1Dot == -1) { // only s2 has an extension, so s1 goes first
            return -1;
        } else { // only s1 has an extension, so s1 goes second
            return 1;
        }
    }
}); 
```

为了完整性：[`java.util.Arrays`](http://java.sun.com/javase/6/docs/api/java/util/Arrays.html)和[`java.util.Comparator`](http://java.sun.com/javase/6/docs/api/java/util/Comparator.html)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T19:35:06.953

如果我没记错的话， Arrays.sort(...) 需要一个 Comparator<> ，它将用于进行排序。您可以提供一个查看字符串扩展部分的实现。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-13T19:35:26.670

您可以实现自定义的字符串[比较器。](http://java.sun.com/javase/6/docs/api/java/util/Comparator.html)使其按`'.'`. 然后将比较器和您的数组传入

```
Arrays.sort(stringArray, yourComparator);

//  An implementation of the compare method
public int compare(String o1, String o2) {
    return o1.substring(o1.lastIndexOf('.')).compareTo(o2.substring(o2.lastIndexOf('.'));
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T22:44:16.570

比较器通常很难完全正确，并且必须为每个比较生成比较键，对于大多数排序算法来说，这意味着 O(n log n)。另一种方法是为您需要排序的每个项目创建（键，值）对，将它们放在 TreeMap 中，然后询问值，因为这些值是根据键排序的。

例如

```
import java.util.Arrays;
import java.util.TreeMap;

public class Bar {

    public static void main(String[] args) {
        TreeMap<String, String> m2 = new TreeMap<String, String>();
        for (String string : Arrays.asList(new String[] { "#3", "#2", "#1" })) {
            String key = string.substring(string.length() - 1);
            String value = string;
            m2.put(key, value);
        }
        System.out.println(m2.values());
    }
} 
```

打印出来

```
[#1、#2、#3]

```

您应该能够轻松地使关键计算适应您的问题。

每个条目只计算一次密钥，因此 O(n) - （但排序仍然是 O(n log n)）。如果密钥计算很昂贵或 n 很大，这可能是相当可衡量的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T19:36:10.977

创建一个比较器并比较字符串扩展名。看看以下

[http://java.sun.com/j2se/1.4.2/docs/api/java/util/Comparator.html](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Comparator.html)

然后将您的字符串列表传递给 Arrays.sort(List, Comparator)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T19:36:14.703

创建您自己的[比较器](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Comparator.html)，将字符串视为文件名并根据扩展名进行比较。然后将[Arrays.sort](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Arrays.html)与 Comparator 参数一起使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-10-17T23:25:49.667

```
 String DELIMETER = File.separator + ".";
    List<String> orginalList = new CopyOnWriteArrayList<>(Arrays.asList(listOfFileNames));
    Set<String> setOfuniqueExtension = new TreeSet<>();

    for (String item : listOfFileNames) {
        if (item.contains(".")) {
            String[] split = item.split(DELIMETER);
            String temp = "." + split[split.length - 1];
            setOfuniqueExtension.add(temp);
        }
    }

    List<String> finalListOfAllFiles = new LinkedList<>();
    setOfuniqueExtension.stream().forEach((s1) -> {
        for (int i = 0; i < orginalList.size(); i++) {
            if (orginalList.get(i).contains(s1)) {
                finalListOfAllFiles.add(orginalList.get(i));
                orginalList.remove(orginalList.get(i));
                i--;
            }
        }
    });

    orginalList.stream().filter((s1) -> (!finalListOfAllFiles.contains(s1))).forEach((s1) -> {
        finalListOfAllFiles.add(s1);
    });

    return finalListOfAllFiles; 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-13T21:13:34.103

如果您只想按扩展名对文件进行分组而不关心实际的字母顺序，您可以使用以下命令：

我认为当文件名没有“。”时，您可以做的最简单的事情也适用。只是颠倒名称并比较它们。

```
Arrays.sort(ary, new Comparator<String>() {
    @Override
    public int compare(String o1, String o2) {
        String r1 = new StringBuffer(o1).reverse().toString();
        String r2 = new StringBuffer(o2).reverse().toString();
        return r1.compareTo(r2);
    }
}); 
```

可惜java的字符串甚至没有reverse()。

# java - 1.5.x JDK 源代码的位置

> ID：440441
> 
> 赞同：4
> 
> 时间：2009-01-13T19:34:05.347
> 
> 标签：java, jdk1.5

我已经在 Mac OS X 上安装了 Eclipse 3.3，它不包含我习惯于在 Windows 和 Linux 安装中看到的 src.zip 文件。在哪里可以下载 Java 1.5 JDK 的完整源代码（必须是特定版本）。

我已经能够找到完整的源代码，但是它包含未生成的 Buffer 实现，因此无法导航 NIO 代码。

**寻找通常在 JDK src.zip 中找到的 Java 源代码，而不是 VM 源代码。**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T19:42:21.243

您可以获得包含源代码的[Developer Documentation 。](http://developer.apple.com/java/download/)下载需要您拥有 ADC 帐户。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T20:26:27.880

Brian Clapper 已经在评论中提到了它，但是从 Sun 下载的 JDK 包括 src.zip。我不知道除了安装在目标平台上之外是否有其他方法可以获取它，但是您可以将它安装在 Windows 或 Linux（虚拟）机器上并从那里获取 src.zip。

专门针对 Java 1.5，下载地址在[这里](http://java.sun.com/javase/downloads/index_jdk5.jsp)

**[更新]** 此外，JDK 的源代码发行版可从 Sun获得[。](http://java.sun.com/j2se/1.5.0/source_license.html)看起来 SCSL 链接搞砸了，让你陷入循环，但 JRL 仍然有效（如果你不介意通过它）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-04T05:56:11.710

/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Home/src.jar

更多详情： [http ://confluence.concord.org/display/CCTR/Get+local+copies+of+Mac+OS+X+Java+source+code+and+Javadoc](http://confluence.concord.org/display/CCTR/Get+local+copies+of+Mac+OS+X+Java+source+code+and+Javadoc)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T21:32:19.010

它位于

/System/Library/Frameworks/JavaVM.framework/Versions.1.5.0/Home/src.jar

我确实在 Mac 附带的安装磁盘上安装了 XCode 的东西，所以我不知道源代码是否出现在 OSX 的标准 Mac 安装中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T19:37:46.200

不清楚这是否可能，因为据我所知，Mac JDK 不是开源的。它是由 Apple 而不是 Sun 创建的。

# vb.net - Silverlight 按钮点击事件

> ID：440450
> 
> 赞同：1
> 
> 时间：2009-01-13T19:35:26.703
> 
> 标签：vb.net, silverlight, silverlight-2.0

我有一个带有文本块和按钮的 silverlight 页面。像这样：

```
<TextBlock x:Name="txbNote" Margin="50,50" Text="Hello"/>        
<Button x:Name="btnCheck" Height="40"  Click="btnCheck_Click" ClickMode="Press" Margin="50,50,50,50" Content="Check Service"/> 
```

这是单击事件的处理程序：

```
Private Sub btnCheck_Click(ByVal sender As Object, ByVal e As EventArgs) 'Handles btnCheck.Click
  txbNote.Text = "I Was Clicked"
End Sub 
```

它有效......但是......为什么这不起作用？

```
<Button x:Name="btnCheck" Height="40"  Click="btnCheck_Click" ClickMode="Press" Margin="50,50,50,50" Content="Check Service"/>
<TextBlock x:Name="txbNote" Margin="50,50" Text="Hello"/> 
```

唯一的变化是文本块和按钮的相对位置。除非文本块在 xaml 中的按钮之前，否则按钮的单击事件（以及我尝试过的所有其他事件）不会触发。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T21:22:53.710

您可能需要发布更多代码，因为这可能是周围标签的问题，例如这些控件所在的容器。

如果您无法将其全部粘贴到 StackOverflow，请使用[www.dpaste.com](http://www.dpaste.com)或[www.pastebin.com](http://www.pastebin.com)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T19:51:05.347

如果将这些元素放置在 Panel 而不是 Grid 中，它就会开始工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T12:37:18.827

正如您提到的网格，如果您在网格中放置了两个项目，最后一个项目在层次结构的顶部，所有顶级事件都由 TextBlock 接收，您应该在网格中创建两列并将项目放在各个列中。

# .net - 为什么我要在商业应用程序中使用反射？

> ID：440456
> 
> 赞同：6
> 
> 时间：2009-01-13T19:36:22.020
> 
> 标签：.net, reflection

我知道反射是什么，但为什么我需要在典型的业务线 Winforms 应用程序中使用它？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T19:37:53.687

一种常见的情况是通过程序集进行反射，以查找、加载和使用应用程序的插件。

我们还在工厂模式中广泛使用反射。对象创建方法可以用属性标记，用反射找到，然后由我们的工厂创建。

事实上，任何属性的使用都会用到反射。如果您创建自己的属性，您将使用反射在您的代码中找到它们。

我们还使用反射来生成代码。我们有一个使用 .NET 远程处理的客户端/服务器应用程序。我们用我们自己的属性将调用标记到我们的服务器中，然后使用反射来找到它们并生成我们所有的通信代码，一个用于服务器的程序集，一个用于客户端的程序集。它省去了在各处手动添加相同的日志记录、计时和远程处理代码的所有死记硬背的工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T19:47:18.987

反射可以帮助您编写更多可维护的代码并减少某些特定任务的代码量。

即，您可以通过使用大量**if**语句来匹配命令来编写一个简单的 shell，或者使用反射生成一个字典，其中包含对标有特定自定义属性的方法的委托，以将其公开给用户。使用反射方法，只需在一个地方添加这种方法，其余的由反射来处理。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T19:43:14.783

这是一个加载的问题，但我想到了一些原因：

*   在单元测试中测试私有方法。

*   当只有一个可用的属性名称时，使用它与 linq 动态排序。

*   动态填充对象的属性。可能是因为您将属性与数据行列名称或可能与 xml 元素匹配。（可能是过时的用途）

*   即时创建一个类。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T19:54:42.717

反射的另一个常见用途是序列化。.Net 在序列化对象时使用反射来查找类型信息。业务线应用程序可能希望提供自定义数据导入/导出功能，而通过反射进行序列化是实现此目的的一种方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T19:57:23.633

我已经为我的枚举定义了一个 DisplayName 属性，所以你以：

枚举 { [DisplayName("Opened") open, [DisplayName("Request for Quote") RFQ

}

现在我可以使用反射来拉出正确的标签。这对于数据驱动的应用程序很方便。您还可以在其中放置一个资源密钥，以便对其进行本地化。

如果我想根据它的类型处理某些东西，我将使用反射。因此，如果我通过了 A 类，则向左走，否则向右走。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T20:52:20.540

假设“业务线应用程序”的意思是“一个简单的 CRUD 应用程序”，那么您已经将范围定义得足够窄，以至于您可能不需要反射来使其工作 - 甚至使它变得更好

反射使语言“封闭”，因为语言中的运算符可用于研究语言中的运算符；将此与没有反射的 C 语言进行对比。想在 C 中按名称调用函数吗？做不到，没有反思。

典型的 C 应用程序是否需要这样做？没有，或者很少。

同样，根据您的问题“我为什么要在业务应用程序中使用反射？” 答案是*你*可能不会，而其他人*可能*会巧妙地使用它，但实际上对于基本的 CRUD 应用程序来说，它不是“必要的”。

这并不意味着你不应该理解它；如果您遇到比“业务线应用程序”更困难或更复杂的事情，了解它是什么以及它可以做什么可能意味着编写大量脆弱代码或编写一些优雅的反射代码之间的区别;-)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T21:17:16.543

这里只是众多示例中的一部分：

*   ***在我们与.NET 反射*一起使用的 .NET Inversion of Control 容器中**自动发现和加载组件和服务****
****   **[使用基于 Cecil 的反射（示例](http://rabdullin.com/journal/2008/10/14/writing-net-code-analysis-rules-as-unit-tests.html)）**对代码实施设计约束**（即“模型命名空间中的所有类都必须是不可变和可序列化的” ）*****   **[使用基于 IL 的反射 ( sample](http://rabdullin.com/journal/2008/12/19/how-to-get-parameter-name-and-argument-value-from-c-lambda-v.html#comment2686418) )实现的帮助器，向代码**添加完整性和验证检查**，使其更加稳定。*****   **使用基于 Linq 表达式的 .NET 反射**将 UI 控件和错误提供程序绑定到业务对象和业务规则（**[示例](http://rabdullin.com/journal/2008/12/18/development-compromises-around-lambda-expressions.html)）。*********

 ****** * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T19:39:36.880

如果您碰巧使用它们，您可以根据您的 DTO 动态构建用户界面。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-13T20:04:23.447

它使工厂模式真正易于扩展，因为您可以将信息放入配置文件或数据库中（工厂本身成为您永远不必接触的代码）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-13T21:18:16.510

可能用途：

*   手动[创建 LINQ 表达式](http://marcgravell.blogspot.com/2008/10/express-yourself.html)
*   序列化，内置或[定制](http://code.google.com/p/protobuf-net/)
*   数据绑定
*   数据导入/导出，例如通过[`HyperDescriptor`](http://www.codeproject.com/KB/cs/HyperPropertyDescriptor.aspx)
*   动态代码生成 ( `Reflection.Emit`)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-13T21:23:30.917

如果您想实现工厂模式并避免每次在工厂中添加新组件时都必须重新编译代码，那么反射可能是唯一的选择。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-13T21:56:50.037

我们在很多地方都使用反射，包括：

*   实现依赖注入和工厂模式
*   序列化
*   通过类属性控制行为

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-13T22:08:29.623

我们使用反射能够将 UI 层的控件直接映射到数据层中业务对象的属性。这使您可以在 baseForm 上使用 UI 数据“自动填充”BO 的“通用”函数，反之亦然，而无需为表单和对象上的每个控件和属性编写代码。

# xml - Microsoft.XMLHTTP 和 CDATA

> ID：440457
> 
> 赞同：1
> 
> 时间：2009-01-13T19:36:24.407
> 
> 标签：xml, hosting

我在通过 ASP（不是 .NET）中的 Microsoft.XMLHTTP 对象发送 XML 时遇到问题。我在一些 XML 节点中有 CDATA 元素，在尝试发送时出现此错误。

msxml3.dll 错误“80070005”访问被拒绝。

首先，这仅与 CDATA 一起出现。如果我删除它，一切都会发送。我做了一点谷歌搜索，发现我需要创建一个 MSXML2.ServerXMLHTTP 对象但托管服务器似乎不支持这个，我收到无效请求错误...

这是 ASP 发送代码：

```
Set xmlhttp = Server.CreateObject("Microsoft.XMLHTTP")      
xmlhttp.Open "POST", m_sURL, False
xmlhttp.Send m_sXMLString 
```

那么，有没有使用 Microsoft.XMLHTTP 发送带有 CDATA 的 XML？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T19:58:27.967

首先，您不应该在 ASP 中使用 Microsoft.XMLHTTP。它不是线程安全的，如果您在共享平台上，*会导致您的应用程序和其他客户站点神秘地失败。*

您应该改用 MSXML2.ServerXMLHTTP。

您还应该设置内容类型标头：

```
Set xmlhttp = Server.CreateObject("MSXML2.ServerXMLHTTP")
xmlhttp.setRequestHeader "Content-Type", "text/xml" 
xmlhttp.Open "POST", m_sURL, False
xmlhttp.Send m_sXMLString 
```

最后一件事，不要为您发布到远程服务器的内容使用名称值对。只需发送 XML 本身。

请您发布您遇到的错误，记得在浏览器中关闭友好的 HTTP 错误消息（如果 IE 工具 -> 选项 -> 高级 -> 显示友好的 HTTP 错误消息 [取消选中]）

凯夫

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T20:11:45.570

谢谢回答。您究竟需要哪个错误？

如果使用 Microsoft.XMLHTTP，那么我得到

```
msxml3.dll error '80070005'
Access is denied 
```

在这条线上：

```
xmlhttp.Send m_sXMLString    ' XML contains CDATA 
```

如果我使用 MSXML2.ServerXMLHTTP，那么我会在这里收到内部服务器错误 (500)：

```
Set xmlhttp = Server.CreateObject("MSXML2.ServerXMLHTTP") 
```

哦，我确实有标题。我只是没有在这里发布。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-20T14:52:06.050

这可能会有所帮助...

```
Dim xml, textResponse

Set xml = Server.CreateObject("MSXML2.ServerXMLHTTP")  
'Server.CreateObject("Microsoft.XMLHTTP")
      xml.setOption 2, 13056 ' Say bye to SSL error
      xml.setTimeouts 30000, 30000, 30000, 30000 ' milliseconds
      xml.Open "POST", "http://www.pathtoyourfile/send", False
      xml.setRequestHeader "Content-Type", "application/x-www-form-urlencoded"
       xml.Send "user=bloggs"

      textResponse = xml.responseText   'Parse the response if you want         
       Set xml = Nothing   'Clean up 
```

此外，如果您需要安全查看这里 >

[http://objectmix.com/xml-soap/87408-sending-post-variables-using-msxml2-serverxmlhttp-3-0-a.html](http://objectmix.com/xml-soap/87408-sending-post-variables-using-msxml2-serverxmlhttp-3-0-a.html)

# eclipse-plugin - 如何最好地维护 Eclipse RCP 插件目标？

> ID：440458
> 
> 赞同：2
> 
> 时间：2009-01-13T19:36:27.170
> 
> 标签：eclipse-plugin, eclipse-rcp, birt

我有一个使用 BIRT 的 RCP 应用程序插件。我有一个构建我的应用程序的目标，它只包含所需的插件/功能。我最近在我的 IDE 中更新了 BIRT 插件版本，这导致设计文件与以前版本的 BIRT 不兼容。我的目标中有旧版本的 BIRT，需要更新到较新的插件。

过去我手动更新了目标中的插件 jar，但 BIRT 是一个复杂的平台，依赖于 wazoo。是否有任何实用程序或方法可以以不同的方式组织我的目标，以便将来更容易控制？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-26T01:08:39.453

我建议将所有组件分开保存，不要将它们复制到单个文件夹中。您可以使用目标定义编辑器（请参阅文件/新建/其他.../目标定义）。因此，在下载所有部分后，您可以在本地解压缩它们并使用目标定义编辑器组装您的目标平台。

您也可以使用 Window / Preferences / Plugin Development / Target Platform 首选项页面来做同样的事情。您可以在此处选择先前创建的目标定义或指定基本 Eclipse 安装，然后使用“添加...”按钮从本地文件夹或远程站点添加其他组件。

另外，据我所知，PDE 团队目前正致力于在 Eclipse 3.5 中扩展 Target 平台支持。我认为他们计划允许在每个启动配置和每个项目中选择目标定义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T13:02:08.417

我不确定我是否理解你的正确，所以如果不是，请告诉我。

当我使用第三方库时，我会为每个库创建一个插件。

例子：

xstream 库：

*   导入罐子（也是源代码）
*   将 jars 添加到 MANIFEST Bundle-ClassPath
*   将所有 xtream 包添加到 MANIFEST Export-Package

当插件需要 xstream 库的代码时，它必须依赖于 xtream 插件。因为包是公开的，所以每个插件都可以使用它的源代码。

当新版本的 xtream 即将推出时，您只需更新 jar 而无需更新依赖插件。有时您必须更新第三方插件的导出包。

您不必更改所有依赖的插件。

# c# - SFTP 和“通过 SSH 的 FTP”之间的区别

> ID：440463
> 
> 赞同：58
> 
> 时间：2009-01-13T19:37:24.343
> 
> 标签：c#, ftp, ssh, sftp

在寻找 C# SSH 文件传输协议 (SFTP) 中的 SFTP 客户端时，我遇到了这两个合适的项目 -[一](http://sourceforge.net/projects/sharpssh)和[二](http://granados.sourceforge.net/)。

在尝试了解基础知识时，我遇到了这篇令人困惑的[Wikipedia 文章](http://en.wikipedia.org/wiki/FTP_over_SSH#FTP_over_SSH_.28not_SFTP.29)。通过 SSH 的 SFTP 和 FTP 有什么区别？如果不同，似乎没有库支持“通过 SSH 的 FTP”。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-01-13T19:45:00.413

这是区别：

*   [SFTP](http://en.wikipedia.org/wiki/SSH_File_Transfer_Protocol)（SSH 文件传输协议）是一种提供文件传输和操作能力的协议。它可以处理任何可靠的数据流，但通常与 SSH 一起使用
*   “FTP over SSH”使用常规的旧 FTP 协议，但在客户端和服务器之间放置了一个[SSH 隧道。](http://en.wikipedia.org/wiki/Tunneling_protocol#SSH_tunneling)

您可能找不到“FTP over SSH”的库，因为通常隧道是通过运行 SSH 命令设置的，一旦设置好，客户端和服务器就不需要知道隧道；他们只是打开端口并以没有隧道的方式传输数据。

顺便说一句，您的另一个选择可能是[FTP over SSL (FTPS)](http://en.wikipedia.org/wiki/FTPS)，它受 .NET 支持。（参见[http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest.enablessl.aspx](http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest.enablessl.aspx)。）

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-09-24T00:31:47.500

基本上，有以下文件传输协议：

*   FTP – 自 1970 年代以来一直存在的普通旧 FTP 协议。首字母缩写词代表“文件传输协议”。它通常在 TCP 端口 21 上运行。

*   SFTP – 另一种完全不同的文件传输协议，与 FTP 无关。SFTP 通过 SSH 会话运行，通常在 TCP 端口 22 上运行。它自 1990 年代后期就已存在。该首字母缩写词实际上代表“SSH 文件传输协议”。

*   SSH 上的 FTP - 1) 可能，但通过 SSH 通道隧道传输的 FTP 协议的例子极为罕见 2) 错误命名的 SFTP

（有关详细信息，请参阅 Rebex 的“[安全](http://www.rebex.net)[FTP、FTP/SSL、SFTP、FTPS、FTP、SCP...有什么区别？](https://www.rebex.net/kb/secure-ftp/) ”页面）

免责声明：我为 Rebex 工作

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-19T02:36:15.173

SFTP 实际上是另一种通过 SSH 运行的协议 - 如果您愿意，它是 SSH 的扩展。人们倾向于使用 SFTP，而不是通过 SSH 隧道传输 FTP。

要在 .NET 中获得全面的 SFTP 支持，请尝试[edtFTPnet/PRO](http://www.enterprisedt.com/products/edtftpnetpro/overview.html)。支持许多不同的 SFTP 服务器已经存在很长时间了。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-01-13T17:34:54.570

这里有一个简单的解释：

*   FTPS = FTP + SSL
*   SFTP = 使用 FTP 程序的 SSH

[https://www.webstix.com/knowledgebase/general/how-to-connect-using-sftp/](https://www.webstix.com/knowledgebase/general/how-to-connect-using-sftp/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T19:41:48.657

SFTP 是它自己的协议。通过 SSH 连接后，通过 SSH 的 FTP 将使用 FTP。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-07-10T08:25:05.363

*   SFTP 代表 SSH 文件传输协议。它不是基于 SSL 的 FTP，也不是基于 SSH 的 FTP。SFTP 在 RFC 4253 中标准化。
*   FTP 代表文件传输协议，它由 RFC 959 和后来的补充定义。FTP 非常流行，但并不安全。因此引入了基于 SSL 的 FTP，它被称为 FTPS 或 FTP/SSL。

对于身份验证，SFTP 使用 SSH 密钥，而 FTPS 使用 X.509 证书。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T19:40:26.613

SSH 上的 FTP 是通过 SSH 建立隧道的普通 FTP 协议。SFTP 是 SSH 提供的文件传输机制，它是一个完全不同的协议。我还没有看到有人通过 SSH 使用 FTP。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-09-28T21:27:54.817

SFTP（SSH 文件传输协议）可能是在 SSH 协议上运行的安全文件传输协议。它保护 SSH 的执行和身份验证。

这进一步的保护层通过证书保证从属关系是真实的，以便购物者和服务器将形成稳定可靠的连接。这提供了一种廉价的安全性，因为可接受的证书是有序的。

它不断建议您在您的网站上有一个证书来告诉客人其有效性并确保连接，但是如果这不切实际，例如，如果您将文件上传到您刚刚的全新网站目前正在运行，SFTP 可能是最简单的替代方案 如果您在多年一直是忠实的 FTP 用户的情况下连接使用 SFTP 的服务器，那么与您现在相比，速度下降会稍微令人震惊习惯了。

这可能是因为在整个 SFTP 传输过程中存在大量额外的数据包和密码学下降，这不是礼物，而是滥用 FTP。有些东西会为了速度而牺牲价格，但安全性可能不是其中之一。

我使用此来源作为答案：[Difference_Between_FTP_and_SFTP](https://www.routerhosting.com/what-is-ftp-in-wordpress/#Difference_Between_FTP_and_SFTP)

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2010-04-23T00:51:21.383

我刚刚创建了一个[.NET SFTP 库](http://www.kellermansoftware.com/p-41-net-sftp-library.aspx)。我在这个过程中学到的一件事是 FTP 与 SFTP 有多么不同。您实际上是在与 SSH 服务器而不是 FTP 服务器进行通信。不仅仅是协议，您发送到 SSH 服务器的命令也完全不同。

这是我的图书馆的[链接。](http://www.kellermansoftware.com/p-41-net-sftp-library.aspx)

# c# - 我可以制作一个接受多个表和泛型类型的泛型 CompiledQuery 吗？

> ID：440474
> 
> 赞同：2
> 
> 时间：2009-01-13T19:39:50.517
> 
> 标签：c#, linq, linq-to-sql, c#-3.0

我有多个带有“id”组件的表。我想使用 LINQ 从这些表之一中获取具有正确 LINQ-To-SQL 类型的项目，但仅使用一个 CompiledQuery。

这是一个当前有效的示例。假设在 DBML 中定义的对象类型是“myitem”，它的表是“myitems”。

```
 var getOneItem = CompiledQuery.Compile(
        (MyDataContext db, long id) => ((from i in db.myitems
                                              where i.id == id
                                              select i).SingleOrDefault())); 
```

我想做这个，类型可以是“myitem”、“myitems2”，或者我可能感兴趣的任何表和对象类型。

```
 var getOneItemAnyTable = CompiledQuery.Compile(
        (Table tab, Type T long id) => ((from anItem in tab<T>
                                              where anItem.id == id
                                              select anItem).SingleOrDefault())); 
```

我编造了这个语法，因为我不确定这里的语法应该是什么样子。如果可能的话，有什么想法吗？我是否必须使用 DBML 为所涉及的类型创建某种超类？

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T20:34:36.240

不要这样做，而是从在您的实体中具有共同属性（如 Id）的基本实体派生所有实体。使用 POCO 实现这些层将对您有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T20:15:22.597

我很确定你不能让一个编译查询跨越多个表（如果这就是你的意思）；它怎么知道去哪里看？EF 支持这样的继承（和多个表），但即使继承 LINQ-to-SQL 也只支持**单表**区分继承。

这个问题的核心与今天早些时候的[这个](https://stackoverflow.com/questions/439086/get-entity-from-table-using-reflection-from-abstract-type)问题基本相同。棘手的一点是主键，因为它很难抽象地定义。其余的只是`GetTable<T>`（至少使用 LINQ-to-SQL）。

在这种情况下，您不需要超类 - 只是一种获取主键的方法。幸运的是，我似乎记得 LINQ-to-SQL 提供了一种方法来做到这一点（不需要使用属性，这不是 LINQ-to-SQL 的先决条件）；以下内容没有预编译（并且未经测试），但应该相当接近：

（**更新已**修复并经过测试）

用法先：

```
Foo foo = ctx.Get<Foo>(fooid);
Bar bar = ctx.Get<Bar>(barid); 
```

代码：

```
 public static TItem Get<TItem, TKey>(
        this DataContext ctx, TKey key)
        where TItem : class
    {
        var table = ctx.GetTable<TItem>();
        var primaryKey = ctx.Mapping.GetMetaType(typeof(TItem))
                .DataMembers.Where(
            member => member.IsPrimaryKey).Single().Member.Name;

        var item = Expression.Parameter(typeof(TItem), "item");
        var lambda = Expression.Lambda<Func<TItem, bool>>(
            Expression.Equal(
                Expression.PropertyOrField(item, primaryKey),
                Expression.Constant(key, typeof(TKey))),
                item);
        return table.Single(lambda);
    }
    public static TItem Get<TItem>( // common case
        this DataContext ctx, int key)
        where TItem : class
    {
        return Get<TItem, int>(ctx, key);
    }
    public static TItem Get<TItem>( // common case
       this DataContext ctx, string key)
       where TItem : class
    {
        return Get<TItem, string>(ctx, key);
    } 
```

我会看看我是否能找到一种预编译它的方法......

# asp.net - “内容页面”可以将简单的“属性”发送到“母版页”吗？

> ID：440479
> 
> 赞同：1
> 
> 时间：2009-01-13T19:41:26.223
> 
> 标签：asp.net, master-pages

母版页的基本思想很简单——您有一块内容要“注入”到母版页中的某个位置。

甚至无需阅读有关母版页的文档（我承认没有阅读过！），就很容易弄清楚这一点。

我想要做的是将“属性”从其子级传递到母版页。例如，我可能有一个主内容面板，我想在子页面中设置以像素为单位的填充。我可能希望母版页可以使用其他简单的“原始类型”来呈现其子级。我想尽可能避免弄乱样式表——否则我最终会得到大量类似名称的项目。

有没有首选的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T19:46:53.467

在您的母版页中创建某种类型的钩子（属性或方法），允许某些代码以您想要的任何方式操作母版页。然后在各个页面上执行以下操作：

```
YourMasterPageType masterPage = (YourMasterPageType)Page.Master;
masterPage.YourHook(); 
```

无论您做什么，都不要反其道而行之（在母版页中创建特殊情况，在页面中搜索一些神奇的值）。您想提供一个*界面*来操作母版页，否则您最终会得到非常混乱的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T19:45:25.293

是的，但反过来。

如果设置内容页的 MasterPageType 属性，则可以使用 Master.PropertyName 语法访问母版页的所有公共属性。

因此，您的子页面可以获取和设置母版页的属性值。

# command-line - 如何从命令行为 Borland C++ Builder 5 构建项目文件和包？

> ID：440490
> 
> 赞同：2
> 
> 时间：2009-01-13T19:44:35.327
> 
> 标签：command-line, c++builder

如何从命令行构建 Borland C++ 项目文件 (bpr) 和包文件 (bpk)？项目组 (bpg) 显然是 make 文件，可以使用 make 进行编译。但是 bpks 和 bprs 是基于 xml 的，并且 Export to Makefile 不能用 make 编译。如果我将一个项目放在 bpg 中，make 似乎找不到 bpg 中指定的任何文件，因为它们似乎都是相对引用。我更改了对绝对值的引用并生成报告：致命：无法打开生成文件

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T22:31:30.233

您不需要直接编译 bpr。只需创建一个只包含该单个 bpr 的 bpk，您就可以使用 make 来编译它。

```
"c:\program files\borland\cbuilder5\bin\make" -B -s -fabc.bpg 
```

如果您还安装了其他 borland 编译器，请不要从其他编译器调用 make.exe。

编辑：在 bpg 和 bpr 所在的目录中执行 make 命令。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T11:35:29.997

使用 bpr2mak 和 make 为我工作就好了，所以正如 Roger 所说，您需要详细说明您遇到的错误。BPK 文件也可以使用 bpr2mak 进行处理。我正在使用这种方法编译一个包含许多组件的大型项目，没有任何困难。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T20:24:11.877

也许您可以提供有关“不会编译”的更多信息。即你得到什么错误信息。

make 提出的一个常见问题在下面得到解决

[http://www.delphigroups.info/3/8/36427.html](http://www.delphigroups.info/3/8/36427.html)

# php - 在 PHP 和 JavaScript 之间共享常量

> ID：440494
> 
> 赞同：12
> 
> 时间：2009-01-13T19:45:00.490
> 
> 标签：php, javascript, code-generation, dry

> **可能重复：**
> [将 PHP 字符串传递给 Javascript 变量（并转义换行符）](https://stackoverflow.com/questions/168214/pass-a-php-string-to-a-javascript-variable-and-escape-newlines)

我正在开发的 PHP 应用程序中有几个常量。我定义了一个常量类，并将常量定义为 const VAR_NAME = value; 在这堂课中。我想在我的 JavaScript 和 PHP 代码之间共享这些常量。是否有一个 DRY（不要重复自己）机制来分享它们？

```
class Constants {
    const RESOURCE_TYPE_REGSITER = 2;
    const RESOURCE_TYPE_INFO = 1;
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-13T19:51:22.990

我会用`json_encode`. 您必须首先将类转换为关联数组。

```
$constants = array("RESOURCE_TYPE_REGISTER"=>2, "RESOURCE_TYPE_INFO"=>2);
echo json_encode($constants); 
```

如果您更喜欢使用类，也可以使用反射将类转换为关联数组。

```
function get_class_consts($class_name)
{
    $c = new ReflectionClass($class_name);
    return ($c->getConstants());
}

class Constants {
    const RESOURCE_TYPE_REGSITER = 2;
    const RESOURCE_TYPE_INFO = 1;
}

echo json_encode(get_class_consts("Constants")); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-25T15:37:12.840

在“client_server_shared.js”中放置 JavaScript 和 PHP 通用的常量列表。

'var' 在 JavaScript 中是必需的，如果在类中，则在 PHP 中是合法的（尽管已弃用）。'$' 开始变量名在 PHP 中是必需的，在 JavaScript 中是合法的。

```
var $shared_CONSTANT1 = 100;
var $shared_CONSTANT2 = 'hey'; 
```

PHP代码：

```
eval('class Client_server_shared{'                   ."\n"
.     file_get_contents( 'client_server_shared.js' ) ."\n"
.    '}'
.    '$client_server = new Client_server_shared();'
);

echo $client_server->shared_CONSTANT1;   // Proof it works in PHP.
echo $client_server->shared_CONSTANT2; 
```

JavaScript 代码：

```
alert( $shared_CONSTANT1 );              // Proof it works in JavaScript.
alert( $shared_CONSTANT2 ); 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-13T19:51:39.010

您可以共享常量的唯一方法是让 php 端通知 javascript。例如：

```
echo "<script> var CONSTANT1 =".$constant_instance->CONSTANT_NAME.";</script>"; 
```

或者使用 ajax，您还可以编写一个小脚本，将常量作为 JSON/whatever 返回。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-13T20:08:27.433

有点丑陋的黑客，但在这里：

**常量.js**

```
//<?php
$const1 = 42;
$const2 = "你好";
//?>

```

**constants.html**（在 JavaScript 中使用）

```
<script type="text/javascript" src="constants.js"></script>
<script type="text/javascript">document.write($const1);</script> 
```

**constants.php**（在 PHP 中使用）

```
<?php
ob_start(); // start buffering the "//"
require "constants.js";
ob_end_clean(); // discard the buffered "//"

echo $const1;
?> 
```

# windows - 串口，相当于“全双工”流量控制？

> ID：440515
> 
> 赞同：0
> 
> 时间：2009-01-13T19:51:27.590
> 
> 标签：windows, serial-port

我有一个文档，其中包含通过串行端口连接到设备的信息。它指定“全双工”作为流量控制的设置。在 Windows 下，我有以下用于设置流控制的选项：

*   Xon/Xoff
*   硬件
*   没有任何

上面列表中“全双工”的等价物是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T20:02:59.517

“xon/xoff”是“软件流控制”的同义词（与“硬件流控制”相对）。

“全双工”是指“双向”；从理论上讲，您可以仅在一个方向（即“半双工”）或两个方向（“全双工”）启用软件流量控制**或硬件流量控制......所以没有足够的信息来回答这个问题。**

它是什么类型的设备？如果我不得不猜测，我的第一个猜测是“硬件”流控制，因为“软件流控制”在传输二进制数据方面不如“硬件流控制”兼容。

# shell - SSH - 一种无需打开单独的 SFTP 会话即可传输文件的方法？

> ID：440524
> 
> 赞同：14
> 
> 时间：2009-01-13T19:53:03.423
> 
> 标签：shell, ftp, ssh, sftp, openssh

不是真正的编程问题，但与许多程序员相关......

假设我打开了与另一台计算机的 SSH 会话。

> 远程：html avalys$ ls
> welcome.msg index.html readme.txt
> 远程：html avalys$

有没有我可以在我的远程 shell 中输入的命令，它会立即将当前目录中的一个文件（例如welcome.msg）传输到我的本地计算机，即

> remote:html avalys$ stransfer welcome.msg
> 获取 /home/avalys/html/welcome.msg 到 welcome.msg
> /home/avalys/html/welcome.msg 100% 23KB 23.3KB/s 00:00
> remote:html avalys$

我知道的唯一方法是在 SSH 会话中打开一个并行 SFTP 会话和 CD 到我的当前目录，当远程管理服务器时，这是一个真正的 PITA。

编辑：我知道使用反向 sftp/scp 连接的可能性，但这涉及更多的输入。如果我可以只输入某个命令的名称（例如“stransfer”）和我想要传输的文件，并让它正常工作，那就太好了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-13T20:00:20.287

您可以设置这样的反向传输连接 w/

```
ssh -Rport:127.0.0.1:22 user@host 
```

回来`scp`。

用于`scp user@host:port`访问它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-04-23T17:03:52.027

在对此进行研究时，我发现了一个可以替代 openssh 客户端 zssh 的程序。

```
sudo apt-get install zssh
zssh user@remote
sudo apt-get install zssh
sz file.name
<ctrl>+<space>
rz 
```

奇迹般有效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-09T18:16:12.683

这是我对这个问题的首选解决方案[在我提出的[重复问题](https://stackoverflow.com/questions/49896/)中给出]。在创建 ssh 会话时设置反向 ssh 隧道。这通过两个 bash 函数变得容易：grabfrom() 需要在本地主机上定义，而 grab() 应该在远程主机上定义。您可以添加您认为合适的任何其他 ssh 变量（例如 -X 或 -Y）。

```
function grabfrom() { ssh -R 2202:127.0.0.1:22 ${@}; };
function grab() { scp -P 2202 $@ localuser@127.0.0.1:~; }; 
```

用法：

```
localhost% grabfrom remoteuser@remotehost
password: <remote password goes here>
remotehost% grab somefile1 somefile2 *.txt
password: <local password goes here> 
```

正面：

*   除了 OpenSSH 之外，它无需特殊软件即可在任一主机上运行
*   它在本地主机位于 NAT 路由器后面时工作
*   它可以实现为一对两个单行 bash 函数

负面：

*   它使用固定的端口号，因此：
    *   不适用于与远程主机的多个连接
    *   可能与在远程主机上使用该端口的进程冲突
*   它需要 localhost 接受 ssh 连接
*   它需要在启动会话时使用特殊命令
*   它不会隐式处理对本地主机的身份验证
*   它不允许在 localhost 上指定目标目录
*   如果您从多个 localhost 抓取到同一个远程主机，ssh 不会喜欢更改密钥

未来的工作：这仍然很笨拙。显然，可以通过适当地设置 ssh 密钥来处理身份验证问题，并且通过向 grab() 添加参数来允许指定远程目录更加容易

更困难的是解决其他负面因素。选择一个动态端口会很好，但据我所知，没有优雅的方法可以将该端口传递给远程主机上的 shell；据我所知，OpenSSH 不允许您在远程主机上设置任意环境变量，而 bash 不能从命令行参数中获取环境变量。即使您可以选择一个动态端口，也无法确保在没有先连接的情况下不会在远程主机上使用它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-08-24T15:49:31.453

您可以使用 sshfs 挂载 ssh 连接。这样您就可以在同一个 ssh 连接中传输文件，同时使用您最喜欢的任何 ssh 客户端。如果您愿意，您甚至可以将其设置为自动挂载。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T20:05:54.690

如果您正在修补东西（恕我直言不应该修补），请查看[ssh-xfer](http://matt.ucc.asn.au/ssh-xfer/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T20:19:20.373

您可以编写一个名为 stransfer 的 bash 脚本，它接受一个文件名参数，然后它会在 scp 命令中插入文件名，假设服务器和服务器上文件的路径没有改变。

或者，如果文件始终相同，您可以在 ~/.bashrc 文件中创建别名。

别名 getwelcome='scp avalys@remotehost:/home/avalys/html/welcome.msg。'

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-14T00:55:10.880

我的想法与 Paul Tomblin 在对该问题的评论中所写的想法相同。旧的终端会话过去常常使用 x-、y- 和 z-modem 协议和工具（`sz`以及`rz`z-modem 变体）来实现类似的功能。我不确定这些是否适用于 ssh 会话，但可能值得一试。

[Fink](http://www.finkproject.org/)`lrzsz`在 Mac OS X 上为这些工具提供了一个软件包。

把它变成一个社区维基，因为在保罗第一次到达那里之后我会因为获得代表而感到难过......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T19:56:10.903

在学校，如果我将文件从一个 linux 系统传输到另一个系统，我通常使用 ssh 远程，然后使用 scp 将文件从远程系统传输回我的计算机。不确定这是否是您正在寻找的内容，或者这是否适用于您的情况，但这通常是我不得不打开另一个终端窗口的方式。

只是为了澄清您是否不熟悉 scp 您仍然需要指定您希望将文件放在计算机上的位置，但无论如何对我来说，这通常比远程文件的位置更容易记住电脑。这是一个可能有用的链接：http: [//www.computerhope.com/unix/scp.htm](http://www.computerhope.com/unix/scp.htm)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-06-05T00:45:29.663

[https://superuser.com/questions/259481/reverse-scp-over-ssh-connection](https://superuser.com/questions/259481/reverse-scp-over-ssh-connection)

```
sftp server
get file.txt 
```

显然，您还可以在 sftp 控制台中浏览 n 个内容，并`get`获取完整的文件路径。复制到您从中运行的目录`sftp`。

# python - python, sorting a list by a key that's a substring of each element

> ID：440541
> 
> 赞同：10
> 
> 时间：2009-01-13T19:58:28.653
> 
> 标签：python, list, sorting

Part of a programme builds this list,

```
[u'1 x Affinity for war', u'1 x Intellect', u'2 x Charisma', u'2 x Perception', u'3 x Population growth', u'4 x Affinity for the land', u'5 x Morale'] 
```

I'm currently trying to sort it alphabetically by the name of the evolution rather than by the number. Is there any way I can do this without just changing the order the two things appear in the list (as in 'intellect x 1)?

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-13T20:04:35.753

You have to get the "key" from the string.

```
def myKeyFunc( aString ):
    stuff, x, label = aString.partition(' x ')
    return label

aList.sort( key= myKeyFunc ) 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-13T20:12:33.460

How about:

```
lst.sort(key=lamdba s: s.split(' x ')[1]) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T20:09:50.690

Not knowing if your items are standardized at 1 digit, 1 space, 1 'x', 1 space, multiple words I wrote this up:

```
mylist = [u'1 x Affinity for war', u'1 x Intellect', u'2 x Charisma', u'2 x Perception', u'3 x Population growth', u'4 x Affinity for the land', u'5 x Morale']
def sort(a, b):
  return cmp(" ".join(a.split()[2:]), " ".join(b.split()[2:]))

mylist.sort(sort)

```

You can edit the parsing inside the `sort` method but you probably get the idea.

Cheers, Patrick

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T20:15:31.147

To do so, you need to implement a custom compare:

```
def myCompare(x, y):
   x_name = " ".join(x.split()[2:])
   y_name = " ".join(y.split()[2:])
   return cmp(x_name, y_name) 
```

Then you use that compare definition as the input to your sort function:

```
myList.sort(myCompare) 
```

* * *

## 回答 #5

> 赞同：-10
> 
> 时间：2009-01-13T20:03:30.280

As you are trying to sort what is essentially custom data, I'd go with a custom sort.

[Merge sort](http://en.literateprograms.org/Merge_sort_(Python))
[Bubble sort](http://www.codecodex.com/wiki/index.php?title=Bubble_sort#Python)
[Quicksort](http://en.literateprograms.org/Quicksort_(Python,_arrays))

# sql-server-2000 - 有人知道 T-SQl 查询来获取 SQL Server 用户及其数据库关联和权限吗？

> ID：440542
> 
> 赞同：0
> 
> 时间：2009-01-13T19:58:32.147
> 
> 标签：sql-server-2000

有人知道是否可以构建一个 T-SQL 查询来获取 SQL Server 用户、他们的数据库关联和权限？

**这是在 SQL Server 2000 中**

我会感激的！！

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T20:08:33.657

sp_helplogins 怎么样？

# dynamic - .NET 4.0 - “动态”关键字

> ID：440543
> 
> 赞同：2
> 
> 时间：2009-01-13T19:58:43.223
> 
> 标签：dynamic, .net-4.0

在他的 PDC 演讲中，Anders 说 dynamic 关键字将调度在运行时对其进行的任何函数调用。

然后他接着说“动态”关键字本身是在编译时进行静态类型检查的。

现在，如果您要调用“动态”类型上不存在的方法 - 这不会导致运行时错误吗？

将 C# 4.0 语言称为静态类型检查语言是否正确？

还是我只是不明白安德烈斯在这个演示文稿中所说的内容？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T20:02:08.787

C# 仍然有静态类型检查，但是说引用的静态类型是“动态的”有点好笑。IIRC 动态的实际类型是对象，带有一个特殊的 IL 标志来指示它是动态解析的。当然，如果实际类型不支持给定操作，则会引发异常。

# python - 在 Cygwin 上安装 Python 3.0

> ID：440547
> 
> 赞同：16
> 
> 时间：2009-01-13T20:00:20.927
> 
> 标签：python, windows, cygwin

### 问题

使用 Cygwin 将 Python 3.0 与 Python 2.x 一起安装的正确方法是什么？

### 笔记

我已经有一个 Cygwin 的工作副本，并且 Python 2.x 安装在 Cygwin ( `/lib/python2.x`， not `c:\python2.x`) 中。

此外，我希望能够通过保留`python`指向 Python 2.x 来单独（并且只是有意地）调用 python 3 以保留现有的依赖项。我想使用`python30`或一些替代方案。

任何指向该主题指南的指针将不胜感激。我似乎在 cygwin 站点或 python.org 上都找不到。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-07-26T09:59:15.370

截至昨天（2012 年 7 月 25 日星期三），[Python 3.2.3 已包含在标准 Cygwin 安装程序](http://cygwin.com/ml/cygwin/2012-07/msg00553.html)中。只需再次运行 Cygwin `setup.exe`（如果需要，请再次从[cygwin.com](http://www.cygwin.com)下载），您应该能够像任何其他软件包一样选择和安装它。

这将安装为`python3`，保留任何现有的 2.x 安装：

```
$ python -V
Python 2.6.8
$ python3 -V
Python 3.2.3
$ ls -l $(which python) $(which python3)
lrwxrwxrwx 1 me Domain Users 13 Jun 21 15:12 /usr/bin/python -> python2.6.exe
lrwxrwxrwx 1 me root         14 Jul 26 10:56 /usr/bin/python3 -> python3.2m.exe 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-13T21:55:50.477

Python 3.0 源的标准`make install`目标不安装 python 二进制文件。相反，请在最后进行安装打印

```
* Note: not installed as 'python'.
* Use 'make fullinstall' to install as 'python'.
* However, 'make fullinstall' is discouraged,
* as it will clobber your Python 2.x installation. 
```

所以不用担心。

如果您想轻松删除整个安装，请执行以下操作`configure --prefix=/usr/local/py3`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-07-19T12:51:03.893

要以非侵入性方式使用 Python 3，如果您还没有，请在您的用户主目录中创建一个名为“.bash_profile”的文件。

设置一个指向您的 Python 3 安装的别名。在我的 Windows 机器上，它看起来像这样：

```
alias python3=/cygdrive/d/apps/Python31/python
export python3 
```

根据您的安装位置调整路径，如果在 Windows 上，请注意确保您使用的是 UNIX 换行符，否则您将收到诸如“bash: $'\r': command not found”之类的消息。

您现在应该可以使用“python3”命令了，而且您还没有修改 Cygwin 附带的 Python 版本。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-05T17:34:14.643

在 Perl 世界中，我总是安装自己的，带有前缀：

```
./configure --prefix=/usr/local/perl/5.10.0 
```

我从不想处理我的操作系统附带的任何 perl，因为我不想为它安装库并且可能会弄乱在操作系统中编写的脚本。

我为 Cygwin 做同样的事情，因为能够安装我自己的模块而不用担心 Cygwin 更新会破坏它们对我来说更好。

如果并且当我学习 Python（我想）时，我打算做同样的事情。

这样我就可以独立地将单个应用程序从一个版本升级到另一个版本。

对于真正严肃的应用程序（比如一个主要的网络应用程序），我什至可能会进行一个独立的安装，该安装由一个专用于该应用程序的用户拥有。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-05-07T03:03:12.343

而不是从命令行调用 python 只是调用 python3 像这样：

```
python3 script1.py 
```

# wpf - 如何从糟糕的 OOP 设计转变为优秀的 OOP 设计？

> ID：440554
> 
> 赞同：5
> 
> 时间：2009-01-13T20:02:25.277
> 
> 标签：wpf, oop, xaml, single-responsibility-principle

我正在阅读很多关于 OOP 设计中好的和坏的做法。很高兴知道您的设计是坏的还是好的。但是你如何从糟糕的设计变成优秀的设计呢？我已将接口 (xaml) 和代码隐藏从主要的业务逻辑类中分离出来。最后一堂课越来越大了。我试过把它分成更小的班级，但我现在卡住了。关于如何拆分大班的任何想法？主类有 1 个不同类型的数据列表。我正在对总数进行计算，但也在对个别类型进行计算。我有方法来执行这些计算，这些计算是从代码隐藏中处理的事件中调用的。有什么想法可以从这里开始吗？

**附加信息：**

我们已经进入这个项目大约 6 个月了。我多年来一直使用面向对象的语言（首先是 c++、java，现在是 c#），但从未参与过像这样的大型项目。我相信我们一开始就犯了一些错误，我认为我们需要纠正这些。目前我无法具体说明这个项目的任何细节。我要订一两本关于设计的书。如果我将所有课程分开，我如何将它们重新组合在一起？也许以这种方式继续到第一个版本并在此之后重建部分以进行第二个版本会更好？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T20:05:44.973

练习和阅读。重复 ：）

一些推荐书籍：

*   罗伯特 C 马丁的清洁代码
*   GoF 设计模式
*   Martin Fowler 重构

我个人也喜欢 Head First Design Patterns，但这种风格可能并不适合所有人。有一本类似的书称为 C# 3.0 Design Patterns（请参阅 ora.com）。它有很多相同的东西，但以更传统的方式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T20:06:36.967

我强烈建议选择[Code Complete](https://rads.stackoverflow.com/amzn/click/com/0735619670)。这是一本很棒的书，为您提出的问题提供了大量的好建议。

为了让您快速回答有关如何拆分大型班级的问题，这里有一个很好的经验法则：让您的班级负责一件事，并且只负责一件事。当您开始这样思考时，您可以快速识别不属于的代码。如果某些东西不属于，请将其分解到一个新类中，并从您的原始类中使用它。

编辑：也将这种想法降低到“方法”级别——让你的方法对一件事负责，而且只对一件事负责。帮助将大型（>50 行）方法快速分解为可重用的代码块。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T20:12:12.633

改变你对物体的看法。每个对象都应该有一个非常具体的职责。如果您有一个名为通用类的类，例如“MainBusinessLogic”，那么您可能做错了什么。

很好的起点：阅读 David West 的*Object Thinking*。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T20:30:47.417

> 主类有 1 个不同类型的数据列表。我正在对总数进行计算，但也在对个别类型进行计算。我有方法来执行这些计算，这些计算是从代码隐藏中处理的事件中调用的。有什么想法可以从这里开始吗？

如果有很多基于列表内容的计算，您是否考虑过将操作移动到自定义列表类中？对特定类型的操作也是如此，也许它们可以存在于类型中？

在对不同类型执行相似但不同的操作方面，请考虑使用[状态模式](http://en.wikipedia.org/wiki/State_pattern)（将其视为 switch 语句的替代），它使您能够以统一的方式处理实体。

许多 OOP 是关于抛弃“自上而下”/微观管理方法并考虑“自下而上”/自给自足的方法。值得记住的是，这两种方法都不是孤立的“正确”。创建可维护的代码是为了找到一个合理的平衡点，这需要大量的思考并且通常通过经验来发展。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-13T21:03:14.840

这只是这里一些好书建议的附录。

我在 OO 上做得越好，我似乎就越能减小对象大小。这不像我要小对象大小或任何东西，但它似乎正在发生。

让它们保持小规模、单一职责、易于使用和理解——所有这些都至关重要。每个对象都应该尽可能地接近防弹，检查你的参数并且永远不要让你的对象进入无效状态。在文档中明确定义所有有效状态。

任何时候你创建一个类，为那个类创建一个测试。它不仅测试您的代码，而且迫使您使用自己的设计。始终从“外部视图”考虑您的班级。确保您没有对使用您的班级的人提出太多要求，并且您对他提出的任何要求都应记录在界面中。如果没有可用的测试框架，我通常只是将一个快速的 main 放入一个类中——它在同一个文件中放置了一个如何使用您的代码的示例。

在编码中，我几乎所有的时间都花在试图弄清楚别人做了什么上。如果我能够使用已知或有据可查的 API 发布代码，那么我的工作将变得微不足道，并且日程安排会大大缩短。

设计优先可能很难。将编码能力视为类似于运动能力。我们中的大多数人在我们的车道上比赛，少数人在当地的运动队比赛。在一个复杂的项目上做好前期设计是一个全国联赛球员的任务，他们是百万分之一。接受这一点并计划改变——迭代是你的朋友。（顺便说一句，我们大多数人认为我们很容易处于州一级。我们不是）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-13T21:57:59.957

除了 Brian 对*Robert C Martin 的 Clean Code*的推荐之外，您可能还想阅读“Uncle Bob 的”[面向对象设计的 SOLID 原则](http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod)。

你可以听到他在[Hanselminutes Podcast 145上谈论 SOLID 原则，在](http://www.hanselman.com/blog/HanselminutesPodcast145SOLIDPrinciplesWithUncleBobRobertCMartin.aspx)[.NET Rocks](http://www.dotnetrocks.com/default.aspx?showNum=388)上谈论干净的代码！[显示 #388](http://www.dotnetrocks.com/default.aspx?showNum=388)。[他在.NET Rocks](http://www.dotnetrocks.com/default.aspx?showNum=410)上还有更多内容！[显示 #410](http://www.dotnetrocks.com/default.aspx?showNum=410)，但他所说的与你的问题并没有真正的关系，我只是把它包括在内，以防你喜欢前两个。

在三个播客中，我更喜欢 Hanselminutes。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-13T20:11:21.513

[Martin Fowler 的《重构](https://rads.stackoverflow.com/amzn/click/com/0201485672)》是一本关于如何在不破坏软件设计的情况下更改软件设计的优秀书籍。

[设计模式](https://rads.stackoverflow.com/amzn/click/com/0201633612)的工作原理与算法类似，但会告诉您如何组合对象以执行各种有用的任务。

最后， [Martin Fowler](http://martinfowler.com/articles/enterprisePatterns.html)为应用程序提供了多种有用的设计模式。例如[被动视图](http://martinfowler.com/eaaDev/PassiveScreen.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T20:11:49.297

Michael Feathers 的[“Working Effectively with Legacy Code”](https://rads.stackoverflow.com/amzn/click/com/0131177052)应该很好，但我承认我自己没有读过。

“[重构为模式](https://rads.stackoverflow.com/amzn/click/com/0321213351)”也是如此。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-13T20:11:57.127

我发现在没有帮助的情况下完成一项复杂的“任务”，然后看看其他人是如何完成的，这对我来说是一次重要的学习经历。

一项特别的任务是创建一个类似于银行的程序，我们必须在其中跟踪交易并能够计算所赚取的利息等。这确实是我的第一个 OOP 程序，而且由于它的复杂性而非常棒。（对于初学者来说）以线性方式执行它而不会出错，这太令人困惑了。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-13T22:48:04.147

我只能说什么对我有用，我还没有真正找到任何人以同样的方式工作，所以我不确定它是否会对你有很大帮助。

基本上，我的方法是尽可能少的类，但不会更少。

首先，您需要保存信息的唯一时间是，如果您在时间 A 收到它并在稍后的时间 B 需要它。如果您同时获得并处理它，则可能不需要存储它.

其次，你用它做什么？如果您打算以某些简化的方式迭代它，您可以将其视为指令集，并将在其上运行的程序视为指令集的解释器。在这种情况下，您可能希望实际设计一个带有解释器的字节码指令集，并将您的信息编码到该指令集中。

第三，信息多久变化一次？如果某些信息很少更改，您也许可以使用部分评估（即代码生成）。也就是说，您获取不经常更改的信息并使用它来生成一个临时程序，该程序执行您的整个程序将使用该信息执行的操作，但速度要快得多。代码生成器很容易编写，因为它只处理输入信息的一部分，变化缓慢的部分。

我现在看到的大部分数据结构都是为了支持 UI。这显然不是持有用户关心的对象，理想情况下你也不应该关心。所以我为 UI 构建了一个 DSL，它隐藏了所有这些 hoo-haw。

如果可能，请远离事件和通知，因为它们发生在时间点上，因此代表状态的增量变化。您将不得不非常担心它们可能会被丢弃、复制或排序错误。通常它们被用于简单的轮询方式会“效率较低”的理论，而实际上相反的情况经常发生。

所以当我看到人们全神贯注于类等技术时，通常是因为他们做了太多的数据结构。

只是我的downvote诱饵...

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-14T00:10:56.023

我推荐 Feather 的*Working Effectively with Legacy Code ，在*[Safari](http://my.safaribooksonline.com/0131177052)上可用且可搜索，而不是[Refactoring](http://my.safaribooksonline.com/0201485672)。它充满了有用和善解人意的章节，比如*我没有太多时间，我必须改变它*，*我的应用程序没有结构。*

需要考虑的观点：

1.  自动化设计质量测试——寻找提供设计质量指标的工具，作为对设计决策的交叉检查。
2.  代码可测试性——你的重构是否有助于或阻碍测试驱动的开发、编写单元测试或编写功能测试？集成后测试大型架构的难度有多大？
3.  理由 - 你如何捍卫这些决定，从愤世嫉俗的 CYA 到管理层，更重要的是，让你的团队相信重新设计。您能否轻松且始终如一地解释*为什么要*进行更改，并且在 6 个月内是否容易找到该解释？

设计中的个人偏好，尤其是重构：

1.  *概念的类*——当有疑问时，如果有一个明确的概念，它应该被包装在一个类中，而不是作为一个或多个方法中的一种行为。
2.  *许多与责任沟通的小事*更容易思考和审核。如果对设计如何映射到现实世界有疑问，请回到旧的[责任驱动设计](http://www.wirfs-brock.com/Design.html)方法，即写下每个类的职责。如果你觉得这很难，那么你对每个班级所做的事情的概念可能会很混乱，或者他们做得太多。
3.  如果它们是常规的，不要被大的东西吓到。有时，例如：GUI 上的许多事件处理程序，您将合法地拥有比指标推荐的方法或属性多得多的类。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-14T00:16:04.890

尝试编写更多可测试的代码，仅此一项就迫使我研究和实施改进的 OOP 实践/设计概念。

# .net - 移动单个 DLL 时检查方法签名

> ID：440556
> 
> 赞同：0
> 
> 时间：2009-01-13T20:02:57.897
> 
> 标签：.net

有没有办法检查一堆 .NET dll 的方法签名是否相互“排列”？基本上编译器在编译期间所做的事情，但它会试图让我尝试向上移动一个 dll 而不是整个 20 个 dll 组来解决问题。

例如，您有一个位于 AssemblyB.dll 中的函数

```
function foo(strMyValue as string, objObject as IObject) 
```

几个月后变成这样

```
function foo(strMyValue as string, objObject as IObject2) 
```

并且您想移动从 AssemblyB.dll 调用函数 foo 的 AssemblyC。如果一次移动所有 dll，则没有问题，因为 AssemblyC 具有来自 AssembleyB 的新方法签名并传入新类型。但是假设发生紧急情况，您只需将 AssemblyC 向上移动即可解决问题。我知道的唯一方法是实际命中将调用该方法的代码行。

要考虑的事情我没有分支。我希望我做到了，但我不在系统的开始，在系统的尾端，我们没有办法到达那里。

我可以移动我所有的 dll，但随之而来的是数百个未记录的更改。该系统目前有 400 万行代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T20:28:25.800

我假设您指的是这样一个事实，即您已经进行了一系列更改，您不一定准备好进行实时迁移，但需要在紧急情况下移动构建。

而不是转动

```
function foo(strMyValue as string, objObject as IObject) 
```

进入

```
function foo(strMyValue as string, objObject as IObject2) 
```

您不能重载 foo 以在 AssemblyB 中同时拥有两个方法签名吗？废弃第一个函数，以便人们至少会被告知他们不应该使用它，然后在您准备好对其进行更改时上传 AssemblyC？在那之后，一旦你确定你已经完全切换，你可以删除原来的方法签名。

如果您从不更改方法签名，那么您永远不会遇到这样的问题。

但是，在我看来……我会让自己启动并运行某种源代码控制。

# wordpress - 在 Wordpress 插件开发中过滤自定义字段

> ID：440558
> 
> 赞同：0
> 
> 时间：2009-01-13T20:03:14.947
> 
> 标签：wordpress

我想知道是否可以在帖子中的自定义字段上添加过滤器和操作？

我有一个插件，可以提取所有`<a>`标签并将它们转换为可跟踪的对象。这对内容和摘录很有用，但我不知道如何过滤自定义字段。

我试过打电话给以下：

```
add_filter('the_meta', 'function_name', $priority) 
```

我读到的应该可以，但它似乎没有任何作用。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T17:21:49.587

您显示的代码将过滤器添加到默认安装的 wordpress 中不存在的挂钩。您是否试图让您的`the_meta`函数在 wp-includes/post-template.php 中的函数内执行？如果是这样，那么您需要将过滤器连接到`the_meta_key`挂钩上。然后您的代码应为：

```
add_filter('the_meta_key', 'function_name', $priority) 
```

如果这不是您想要的功能，那么您必须添加一个`apply_filters`函数调用来运行您的自定义过滤器。

# c# - 通过拨号连接批量复制 SQL 数据的最佳方法是什么？

> ID：440566
> 
> 赞同：0
> 
> 时间：2009-01-13T20:05:29.060
> 
> 标签：c#, sql-server, ras

我有一些远程 SQL 服务器，我需要定期从中提取大量数据（例如每台服务器 5,000,000 行）。此数据还需要格式化并通过 FTP 传输到另一台服务器。拨号部分没问题，我可以和服务器连接和通信，但有时连接很慢，可能只有19Kbps。

连接后，我尝试使用 System.Data.SqlClient.SqlBulkCopy，但它只会引发超时错误。我已将大容量复制的超时设置为 7200 秒，将每个数据库的连接字符串的超时设置为 900 秒，但它仍然在 30 秒左右超时。

我尝试使用 DataReader 并运行 SqlCommand.ExecuteNonQuery() 来插入每一行，这可以正常工作，但是速度很慢，有时连接会丢失。

我还尝试在远程服务器上设置 DTS 包，安排它们将我需要的数据转储为文本，然后尝试下载文件。但是，它们可能是几百 MB（在某些服务器上甚至可能是 GB），并且拨号连接通常会在某个时候断开。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T20:09:35.153

如果可以选择，请将其拉​​上拉链，ftp 并在您身边进行批量插入。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T20:07:57.557

它有多少英里远？你能打出 DVD 吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T20:17:29.550

关于这个话题的一些想法：

*   从源头构建例程以提取数据并将其分割成几个较小的文件。单独 FTP 文件并进行一些检查机制以确保它们都已到达。

*   如果您可以从源头识别更改的或新的数据，请在源头放置某种更改的数据捕获功能，并且只发送增量（如果您已经这样做了，请道歉）。

*   压缩分块文件以减少要发送的数据大小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T20:09:19.443

使用 ZIP 格式压缩数据，它内置在 .NET 中

[http://www.windowsdevcenter.com/pub/a/windows/2006/09/12/using-data-compression-in-net-20.html](http://www.windowsdevcenter.com/pub/a/windows/2006/09/12/using-data-compression-in-net-20.html)

如果数据仍然太大，您可以尝试使用外部库/可执行文件对 RAR 或 7Zip 数据进行压缩，因为这将是 ZIP 副本大小的一半。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T20:46:05.547

[bcp.exe](http://msdn.microsoft.com/en-us/library/ms162802.aspx)支持“out”参数，允许您将 SQL 语句的输出转储到纯文本文件。

*   在源端：转储、压缩并将文件拆分成更小的部分，上传
*   在目标端：下载、解压缩并重新加入所有文件，然后 bcp in。

这不是一个优雅的解决方案。如果您想以编程方式执行此操作，您将进行流程调用。但是，它确实完成了工作。

但是，您可能想问的问题是，围绕没有宽带连接与获得宽带连接（如果可能）的限制创建解决方案的成本效益如何。我希望无论您决定采用何种解决方案，使用拨号都会遇到持续的维护问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-14T00:33:09.613

您可能希望使用组合方法。

*   BCP 以本机格式输出表。

*   使用将生成一系列文件的工具压缩文件。

*   ftp 单个文件。您将能够继续传输。

我发现 7Zip（免费开源）具有最好的压缩率，并且会生成一系列您指定大小的编号文件。我相信它可以从命令行运行。

HTH安迪

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-14T16:15:58.697

我最终做的是在 C 中创建一个小应用程序（其中一些是 WINNT，这是最简单的方法，它还允许其他人在必要时手动检索数据而无需更改源），它需要一些参数构建我需要的查询。然后它运行查询并以所需的 CSV 格式转储结果。然后它调用具有最高压缩级别的 7zip 来压缩尽可能小的数据（这会将 500MB 的文件减少到大约 20MB）。

因为我必须先将数据带回给我，然后才能将其 FTP 到必要的位置，并且远程服务器没有任何 Internet 访问权限，所以我仍然只是将文件复制到 Windows 共享，然后在本地解压缩并将未压缩的数据（按要求）通过 FTP 传输到其目的地。

这可能不是最好的方法，但它正在工作。谢谢

# asp.net - 为什么要使用 ASP.NET Membership 安全模型？

> ID：440568
> 
> 赞同：27
> 
> 时间：2009-01-13T20:05:49.857
> 
> 标签：asp.net, security, membership

我现在正在更新我的网站，并认为如果我要更新我的登录/安全模式，现在是个好时机。

我已经查看了包含在 ASP.NET 中的 Membership 模型，但我不相信它会提供除了其他 .NET 开发人员熟悉之外的任何好处。

似乎有相当多的文档，但很少讨论为什么值得付出努力。

任何人都可以对此有所了解吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-04-17T01:05:59.253

我认为在大型网站上使用会员资格几乎没有什么好处。这已作为 ASP.Net 身份验证的“最佳”解决方案推向市场。然而，看起来微软只是试图将旧的会员服务器产品定位为每个人突然需要的东西。

大约 10 年前，我在 Msft 的 Membership Server 工作。也是 shop.microsoft.com 的首席开发人员，我可以告诉你，我们在该站点上没有使用任何内部服务器产品——不是商业服务器，也不是会员服务器。不知道他们现在是怎么做的——但我认为当时的普遍共识是，这些类型的软件包通常会妨碍我们尝试做的事情。

它可能对较小的站点很有用，或者如果您的资源有限……例如，对于一个部门或小型公司的 Intranet，有几百个用户，您不想在其中投入太多时间或资源。我看的越多，它似乎就越不适合更大的自定义网站。

我真正不明白的是，几乎每一本 ASP.Net 书籍似乎都将其作为唯一的方法，而不是一种方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-04-17T01:44:44.043

在阅读了 ASP.NET Membership 提供程序中的所有存储过程后，我编写了自己的代码。这并不难，而且您在一天结束时拥有更多的控制权。

如果您喜欢 XML 配置、角色的弱类型字符串、默认情况下不安全、随机 web.config 文件散布在您的目录中，而不是在您的页面类上使用干净的标记界面来表示“不需要帐户”，一个单一的多个数据库命中登录，未从您当前的 ObjectContext/DataContext 加载的用户对象以及动态更改提供程序的能力（哇哦，谁使用它？！）去内置的。

如果没有，请自己构建，但如果这样做，请确保存储密码的加密/加盐*哈希*，并请执行适当的加密 cookie。

*[更新以反映评论中的反馈]*

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-13T20:15:26.403

除非你是唯一一个在这个特定站点上工作的人，否则我认为 .NET 开发人员熟悉它的事实是采用内置成员资格路线的一个很好的理由。其他具有 ASP.NET 经验的开发人员可以加入该项目并快速掌握您网站的身份验证/授权模型。

我们在我们的站点上使用了内置的 Membership 和 Role 提供程序模型，它工作得非常好......我们必须编写自己的 Provider 类，因为我们对数据使用不同的后备存储（我们使用 Microsoft Dynamics CRM），但是这些类非常简单且有据可查。通过预先完成这些工作，我们现在可以在代码中使用 Membership 和 Roles 类，以及页面上各种与登录相关的服务器控件。

您是否正在考虑另一种选择？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T22:10:21.460

我真正讨厌 .Net 附带的 MembershipProvider 的唯一一件事是用户 ID 是 GUID 而不是自动递增标识。我知道使用 GUID 有好处，但将其集成到预先存在的系统或模块中可能会很痛苦。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T20:14:18.107

它的存在只是为了让您不必自己动手。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-04T20:48:52.957

我认为 ASP.NET Membership、Role 和 Profile 的一个引人注目的特性是它使用了提供者模型。如果你对它的现状不满意，从基类中推出你自己的并不难。如果您查看 codeplex.com，您可能会发现人们编写的十几个或更多自定义提供程序。几年前我为 SQLite 数据库写了一个。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T22:04:01.160

如果您想将您的站点迁移到任何类型的已经制作好的门户软件——例如 Community Server 或 DotNetNuke，使用会员提供程序可以轻松迁移。您甚至可以使用现有的数据库，而不必实施新的数据库。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T20:15:04.297

它的价值在于它是一个易于使用的现成的基于角色的安全框架。如果您已经构建了自己的框架并且迁移不是微不足道的，那么它可能不值得。但是迁移的一个好处是您可以消除大量应用程序代码并替换为框架代码。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-02-11T15:12:57.320

会员制路线运作良好，但有一个致命缺陷，我不怪微软。

Internet Explorer 是唯一正确处理身份验证缓存的浏览器。

您可以关闭 Firefox 浏览器，打开它，然后恢复上次会话，然后无需登录即可直接返回“安全”网站。Chrome 也有类似的问题，Mac 也有类似的问题。

IE 有一个 javascript 调用可以正确处理这个问题： document.execCommand("ClearAuthenticationCache", "false");

它不适用于任何其他浏览器。如果你使用它，你需要强制用户使用 IE。

# c# - 如何检测 jQuery 是否在 WinForm WebBrowser 控件中导航到的文档中？

> ID：440570
> 
> 赞同：0
> 
> 时间：2009-01-13T20:06:02.960
> 
> 标签：c#, jquery, winforms, dom, webbrowser-control

我在 C#/Visual Studio 2008 中有一个带有 IE WebBrowser 控件的 Windows 窗体应用程序。在 DocumentCompleted 事件中，我想搜索 WebBrowser.Document 或 WebBrowser.DomDocument 以查看页面中是否已经存在 jQuery。

有什么好方法可以做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T20:21:08.263

你试过了吗：

```
bool hasjQuery = webBrowser1.Document.InvokeScript("jQuery") != null; 
```

# ruby-on-rails - 如何在 Rails 中测试助手？

> ID：440571
> 
> 赞同：42
> 
> 时间：2009-01-13T20:06:32.083
> 
> 标签：ruby-on-rails, ruby, helpers

我正在尝试构建一些单元测试来测试我的 Rails 助手，但我永远不记得如何访问它们。恼人的。建议？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2011-04-07T13:18:17.940

在 rails 3 你可以这样做（实际上它是生成器创建的）：

```
require 'test_helper'

class YourHelperTest < ActionView::TestCase
  test "should work" do
    assert_equal "result", your_helper_method
  end
end 
```

当然[，Matt Darby 的 rspec 变体](https://stackoverflow.com/a/441298/1152564)也适用于 rails 3

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-01-13T23:25:28.097

您可以在 RSpec 中执行以下操作：

```
require File.dirname(__FILE__) + '/../spec_helper'

describe FoosHelper do

  it "should do something" do
    helper.some_helper_method.should == @something
  end

end 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-13T20:07:07.433

从这里被盗：http: [//joakimandersson.se/archives/2006/10/05/test-your-rails-helpers/](http://joakimandersson.se/archives/2006/10/05/test-your-rails-helpers/)

```
require File.dirname(__FILE__) + ‘/../test_helper’
require ‘user_helper’

class UserHelperTest < Test::Unit::TestCase

include UserHelper

def test_a_user_helper_method_here
end

end 
```

[从 Matt Darby 那里偷来的，他也在这个线程中写道。]你可以在 RSpec 中做同样的事情：

```
require File.dirname(__FILE__) + '/../spec_helper'

describe FoosHelper do

  it "should do something" do
    helper.some_helper_method.should == @something
  end

end 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-03-13T15:41:50.187

这个线程有点旧，但我想我会用我使用的东西来回复：

```
# encoding: UTF-8

require 'spec_helper'

describe AuthHelper do

  include AuthHelper # has methods #login and #logout that modify the session

  describe "#login & #logout" do
    it "logs in & out a user" do
      user = User.new :username => "AnnOnymous"

      login user
      expect(session[:user]).to eq(user)

      logout
      expect(session[:user]).to be_nil
    end
  end

end 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-08T21:35:17.667

我刚刚在另一个帖子上发布了这个答案，问了同样的问题。我在我的项目中做了以下事情。

```
require_relative '../../app/helpers/import_helper' 
```

# linq - 什么是 LINQ 中的表达式树？

> ID：440575
> 
> 赞同：6
> 
> 时间：2009-01-13T20:07:34.733
> 
> 标签：linq

什么是 LINQ 中的表达式树？有人可以给我指出一个有代码和解释的资源吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2014-06-25T04:35:10.393

表达式树是所有节点都是 [`Expression`](http://msdn.microsoft.com/en-us/library/system.linq.expressions.expression.aspx)s 的树（请耐心等待）。

我不完全确定您是否在询问表达式树的特定应用程序，所以这有点冗长，但应该给出可以使用它们的一般方式的想法。MSDN 有一些[关于表达式树的通用编程概念文档，](http://msdn.microsoft.com/en-us/library/bb397951.aspx)并且在 ) 中总是有实际类的文档[`System.Linq.Expressions`](http://msdn.microsoft.com/en-us/library/system.linq.expressions(v=vs.110).aspx)。我相信当我第一次查看 Expressions 时，我发现[这些 Microsoft 提供的示例](http://msdn.microsoft.com/en-us/library/bb397980(v=vs.100).aspx)很有用，但我记不太清了。

您可能熟悉语法树的概念。例如，`2 + 2`通常会在视觉上描述具有语法树：

```
 +
 / \
2   2 
```

表达式树在概念上非常相似。这是一棵相似的树，其中所有节点都是一个表达式。表达式`2 + 2`将由代码表示

```
Expression.Add(Expression.Constant(2), Expression.Constant(2)) 
```

它返回 a`BinaryExpression`并且是一个表达式树。

* * *

## Lambda 表达式

表达式也经常被 Lambda 表达式使用（当它们被使用时）。

这是一个 lambda 语句或 lambda 块：

```
i => {return i * 2;} 
```

这是一个 lambda 表达式：

```
i => i * 2 
```

您可能习惯于看到上面的代码接下来具有以下类型`Func`：

```
Func<int, int> timesTwo = i => i * 2; 
```

但是，这样做也是有效的：

```
 Expression<Func<int, int>> timesTwoExpression = i => i * 2; 
```

在这种情况下，编译器将为表达式而不是委托发出表达式树。您可以稍后调用`Compile()`它来获取委托。

```
Func<int, int> timesTwo = timesTwoExpression.Compile() 
```

但是，由于表达式尚未编译，因此可以对其进行检查和/或操作。例如，我可以检查表达式的主体并确认乘法常数实际上是 2。

```
Expression<Func<int, int>> timesTwoExpression = i => i*2;
Assert.True(timesTwoExpression.Body.NodeType == ExpressionType.Multiply);
Expression right = ((BinaryExpression) timesTwoExpression.Body).Right;
Assert.True( right.NodeType == ExpressionType.Constant);
Assert.AreEqual( ((ConstantExpression) right).Value, 2); 
```

我个人使用它[来获取属性/方法名称](https://stackoverflow.com/questions/671968/retrieving-property-name-from-lambda-expression)，[为链接成员调用提供空提升运算符](https://stackoverflow.com/questions/11108254/how-do-i-break-down-a-chain-of-member-access-expressions)，并在仅在运行时知道类型时在泛型类型上指定类型参数。注意：我不能保证这些链接问题的特定答案，我没有根据我编写的代码检查它们；我提供它们仅供参考和示例。

这仅允许访问 Expression API 的有限部分（您只能将其与 Lambda 表达式一起使用，而不能与 Lambda 语句一起使用），但它仍然非常有用。但是，它是一项高级功能，您的所有团队可能都不理解它，因此请负责任地使用它。

* * *

## LINQ 查询的表达式

表达式是 LINQ 的一部分。但是 LINQ 包含很多 C# 功能，包括查询语法、lambda、泛型委托和表达式。

LINQ 查询在幕后使用表达式来提供一些与`IQueryable.` 这相关的行为，例如，C# 代码（表达式）被重写并作为 SQL 执行。您可以从[How to: Use Expression Trees to Build Dynamic Queries](http://msdn.microsoft.com/en-us/library/bb882637.aspx)和[Walkthrough: Creating an IQueryable LINQ Provider](http://msdn.microsoft.com/en-us/library/bb546158.aspx)开始，但这涉及到相当多的内容。

* * *

## 动态代码/语言实现的表达式

我知道 Expression API 最终足够强大，可以代表大多数语言结构，并作为实现动态/解释语言的基础；尽管我从未以这种身份使用过它。[您可以在与动态语言运行时](http://msdn.microsoft.com/en-us/library/dd233052.aspx)相关的材料中找到有关此用途的更多信息。

# c++ - 构建 Boost BCP

> ID：440585
> 
> 赞同：52
> 
> 时间：2009-01-13T20:09:22.407
> 
> 标签：c++, boost

在过去的两个小时里，我一直在尝试构建[Boost C++ 库](http://en.wikipedia.org/wiki/Boost_C%2B%2B_Libraries)，但没有任何结果就停止了。由于我是 C++ 新手，因此无法正确构建。如何使用 Visual Studio 2008 正确构建它？

我需要使用 BCP 工具来提取库的一个子集。所以我需要先建立BCP，对吧？这该怎么做？当我尝试构建它时，出现以下错误

> *致命错误 LNK1104：无法打开文件“libboost_filesystem-vc90-mt-gd-1_37.lib”。*

我在哪里可以获得上述给定的库文件？

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2012-07-18T14:50:24.883

当前版本的 Boost (1.50.0) 使用 Boost.Build。构建 bcp 的新工作流程如下：

从 Boost 根目录中，键入：

```
bootstrap.bat 
```

然后，一旦构建了 Boost.Build，输入：

```
b2 tools/bcp 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-01-13T20:24:59.287

首先，您需要在命令 shell 中有正确的 PATH、INCLUDE 和 LIB 环境变量。为此，`vcvarsall.bat`使用参数调用文件“”（或类似文件）：

```
vcvarsall.bat x86 
```

接下来您必须构建 bjam（您也可以从 Boost 页面下载它，但它几乎一样快）。转到`tools\jam\src`Boost 中的文件夹并键入：

```
build.bat 
```

它应该生成一个`bin.ntx86`包含 bjam.exe 的子文件夹。为方便起见，请将其复制到 Boost 主文件夹。接下来，您可以构建 bcp。进入`tools\bcp`文件夹并输入：

```
..\..\bjam.exe --toolset=msvc 
```

回到 Boost 主文件夹，您可以构建任何您想要的库：

```
bjam toolset=msvc –-with-{library} 
```

`{library}`要构建的库之一在哪里。所有可构建的库都可以显示为：

```
bjam –-show-libraries 
```

还有更多的 bjam 构建参数。您可以指定的带有关键字的一些参数是：

```
variant=debug|release
link=shared|static
threading=multi|single 
```

一个例子是：

```
bjam toolset=msvc –-with-filesystem threading=multi variant=debug stage 
```

有关更多信息，请访问[Boost 文档页面](http://www.boost.org/doc/libs)。

编辑：更新了指向最新 Boost 文档的链接

编辑：更正选项 --with-{library} 和 --show-libraries

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-11-21T04:48:21.073

我提取了源代码：[https](https://github.com/district10/cmake-bcp) ://github.com/district10/cmake-bcp （您不需要配置 BOOST，因为已经包含所有源代码）。

在 Linux 上，`cmake`+`make`构建：

```
# cd source_dir
mkdir build && cd build
cmake ..
make 
```

在 Windows 上：构建 CMake-GUI + Visual Studio。需要帮忙？请参阅[HOWTO：Win + CMake + Visual Studio 2010](https://github.com/district10/cmake-templates/issues/1)。

我的可执行文件：

*   Windows：[http](http://whudoc.qiniudn.com/2016/bcp_standalone.exe) ://whudoc.qiniudn.com/2016/bcp_standalone.exe (561 KB)
*   Linux：[http](http://whudoc.qiniudn.com/2016/bcp_standalone_linux) ://whudoc.qiniudn.com/2016/bcp_standalone_linux (917 KB)
*   macOS：[https](https://github.com/district10/cmake-bcp/releases/download/1.0/macOS_bcp) ://github.com/district10/cmake-bcp/releases/download/1.0/macOS_bcp (801 KB)

* * *

提示：如果您在使用 Boost 时在 Windows 上遇到链接问题，请查看`boost/config/auto_link.hpp`并了解。要解决此问题，您只需注释掉整个文件即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-12T20:14:53.100

请注意，您不需要从源代码构建 Windows 版本的 bcp - 您也可以从[http://www.boostpro.com/download](http://www.boostpro.com/download)下载二进制版本，然后跳过所有这些步骤。

（或者，至少理论上是这样——我还没有尝试过；我只是在寻找预构建的 Linux 版本时找到了那个页面和这个页面。）

# .net - 如何从表单中获取所有字符串以进行本地化？

> ID：440588
> 
> 赞同：0
> 
> 时间：2009-01-13T20:11:04.180
> 
> 标签：.net, winforms, localization

我读过的所有关于 WinForms 应用程序本地化的文章都假定我已经翻译了所有字符串。根据文章，我应该将 Localizable 属性设置为 true 并编辑所有控件。

但是如何从表单中获取所有原始（英文）字符串？假设我有一个完整的应用程序，到目前为止还没有本地化。我应该以某种方式手动解析 Designer 文件中的字符串，还是有其他更简单的方法？

我需要将字符串发送给 Excel 或 Word 中的翻译人员。由于翻译人员对资源没有任何经验，我最终会将所有翻译后的字符串移回我的表单，并在需要时更改控件的大小、位置等。

编辑：感谢 Rob 的回答和评论，解决方案首先将 Localizable 属性设置为 true。然后，我可以轻松地从属于表单的 resx 文件中复制所有字符串。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T20:21:05.737

我正在以与我相同的方式进行本地化，您只需进入项目的 Properties 目录并在文本编辑器中打开**Resources.resx文件。**其中，字符串位于 XML 节点中，如下所示；

```
<data name="ErrorLaunching" xml:space="preserve">
  <value>Error launching Ivara</value>
  <comment>MessageBox text in LogonForm</comment>
</data> 
```

翻译完成后，它们会进入名称相似的文件中，例如用于法语的**Resources.fr.resx 。**

您还可以在 Visual Studio 中打开**Resources.resx ，选择字符串并复制/粘贴到 Excel 中。**

或者，根据您的描述，您可能正在按表单进行本地化。在这种情况下，上述内容适用，但您感兴趣的是您的表单的 Resx 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T20:25:24.213

Rob，在 Resources.resx 文件中，我只有在 MessageBoxes 等中手动显示的字符串。这些字符串可以毫无问题地复制到 Excel。

但是如果我打开属于一个表单的MyForm.resx，这个文件是空的（其实所有表单的所有resx文件都是空的）。如何访问表单的字符串表？

如果这有什么不同，我会使用 VS2008。

# flash - Flash 视频播放器：人们真的使用音量控制吗？

> ID：440610
> 
> 赞同：1
> 
> 时间：2009-01-13T20:15:28.400
> 
> 标签：flash, video, audio, volume

我想知道是否有人对此主题有任何意见？我正在构建一个 Flash 视频播放器，并且我添加了一个静音音量图标，但我想知道每个人对添加音量控制的想法是什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-13T20:19:56.160

我认为音量控制是绝对要求。您对“正常水平”的看法可能与我的完全不同。此外，您可能希望听到一些呻吟和尖叫声，而不是与您的立方体农场中的其他人分享。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T20:19:39.937

当嵌入的视频声音太大时，我个人讨厌它，而且我没有直接的方法来控制源的输出。

我猜你给用户的控制越多，你可能面临的问题就越多......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T20:20:23.493

静音是我在其中一件事情上使用过的唯一音量控制。也就是说，除非您有意尝试创新和与众不同，否则我也会提供常规音量控制，即使它可能不会被太多使用。到目前为止，它实际上是对其中一个玩家的一种标准的、预期的控制，颠覆用户的期望从来都不是一个好主意。没有理由惹恼那些可能真正想要使用它的少数人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T21:57:31.127

举个例子，我用一根数字音频线从我的 MacBook Pro 连接到我的接收器，所以我没有系统范围的音量控制。有时我会为了看电影而将音量设置得很大，虽然接收器不远，但更改应用程序的音量设置仍然更容易。

# vb.net - Linq to SQL：询问日期是否为空

> ID：440613
> 
> 赞同：1
> 
> 时间：2009-01-13T20:16:03.983
> 
> 标签：vb.net, linq-to-sql

我在 Linq DBML 中有一个对象的新实例，但不知道日期字段是否为空的测试。

我试过了：

```
If d Is Nothing OrElse IsDBNull(d) OrElse d <= Date.MinValue Then
   TextValue = "nada"
Else
   TextValue = FormatDateTime(d)
End If 
```

但结果是“12:00:00 am”

编辑：更改变量名 d
编辑：请注意 SQL 字段可以为空

**编辑二：对不起，错误出现在代码的其他部分。无计可施才是解决之道**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T21:12:33.997

你想要的代码是（希望）..

```
If MyNullableDateObject.HasValue Then
   TextValue = FormatDateTime(MyNullableDateObject.Value)
Else
   TextValue = "nada"
End If 
```

如果 SQL 字段接受 Null，则 Linq to SQL 设计器将其映射到 .net Nullable 类型，例如 SQL DateTime 将映射到名为 Date? 的类型。如果您查看 Linq to SQL 设计器中字段的属性，它应该有一个属性“Nullable”，如果 SQL 模式允许该字段中的 NULL，则该属性将设置为 true。

不可为空的（即普通）日期类型是值类型而不是对象类型，因此“什么都没有”没有帮助。IsDBNull 适用于 System.Data.SqlTypes 下的类型，但 Linq to SQL 映射到“本机”.Net 类型，因此这也无济于事。

请参阅 -[可空类型](http://msdn.microsoft.com/en-us/library/ms235245.aspx)

* * *

编辑

您可能会考虑将变量 Value 重命名为其他名称（正如我在上面所做的那样），因为它当然不是 Value 类型，Value 是一个坏名字。

另请注意，在 VB 中可以用两种等效方式声明 Nullable 类型

```
Dim d As Date?
Dim d As Nullable(Of Date) 
```

希望这是有道理的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T21:45:19.763

我不确定这是否可行，但您可能想与 Empty（或调用 IsEmpty）进行比较，因为 12:00 am 不是空值。

# sql - 检查 SQL 数据库列中是否存在项目列表的最佳方法？

> ID：440615
> 
> 赞同：7
> 
> 时间：2009-01-13T20:16:17.667
> 
> 标签：sql, list, exists

如果我有物品清单，请说

```
apples
pairs
pomegranites 
```

并且我想识别 SQL DB 表的“水果”列中不存在的任何内容。

*   快速性能是主要问题。
*   需要可移植到不同的 SQL 实现。
*   输入列表可以包含任意数量的条目。

我可以想到几种方法来做到这一点，我想我会把它扔在那里，看看你们的想法。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-13T20:30:32.847

由于您选择的水果列表可以任意长，我建议如下：

```
create table FruitList (FruitName char(30))
insert into FruitList values ('apples'), ('pears'), ('oranges')

select * from FruitList left outer join AllFruits on AllFruits.fruit = FruitList.FruitName
where AllFruits.fruit is null 
```

左外连接应该比“不在”或其他类型的查询快得多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T20:24:03.500

将搜索列表变成一个类似于 '|fruit1|fruit2|...fruitn|' 的字符串 并制作你的 where 子句：

```
where
  @FruitListString not like '%|' + fruit + '|%' 
```

或者，将上述字符串解析为临时表或表变量，然后执行`where not in (select fruit from temptable)`. 根据您正在搜索的项目数和正在搜索的项目数，此方法可能会更快。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T20:21:11.540

```
if exists(select top 1 name from fruit where name in ('apples', 'pairs', 'pomegranates'))
  PRINT 'one exists' 
```

# .net - 从数组中获取数据到 SQLServer 数据库的最快方法？

> ID：440638
> 
> 赞同：3
> 
> 时间：2009-01-13T20:21:25.533
> 
> 标签：.net, sql-server

问题：如何最有效地将数据从数组移动到 SQL Server 表中。

详细信息：我在 WinForms 应用程序的内存中创建了一个包含许多行（通常约为 100,000）和许多列（约 40）的数组。我需要以最快的方式将此数组放入相应的 SQL Server 表中。现在，我正在创建一个 SqlCommand 对象，循环遍历数组中的 100,000 行，并为每一行分配命令对象的 40 个参数，然后调用 ExecuteCommand。它可以工作，但速度很慢，而且肯定不是最有效的方法。我是否应该将数组中的所有数据放入 DataTable 中，然后以某种方式一次发送所有数据表（我不知道该怎么做）？还是其他什么技术？写出一个文件并使用 bcp （似乎不会更快，我没有尝试过）。任何建议表示赞赏！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T20:30:30.600

[SqlBulkCopy](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.aspx)。如果您可以将这些内容作为 a 存储在内存中会更好，`DataTable`因为该方法的重载之一`WriteToServer()`需要一个。

编辑：这是如何使用 API[的示例。](https://stackoverflow.com/questions/287708/best-practices-for-uploading-files-to-database#287749)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T20:31:45.480

我们将 xml 用于大数据批次。将 xml 字符串传递到存储过程中，并让 sp 将 xml 分解为表。然后从临时表中选择您的数据库。似乎对我们来说工作得很好。

编辑：如以下评论中所述，将 xml 转换为表格的过程是`sp_xml_preparedocument`.

```
declare @idoc int
exec sp_xml_preparedocument @idoc output, @input_xml
-- select into a tmp table from openxml(@idoc, 'xpath_to_your_data')
exec sp_xml_removedocument @idoc 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T20:51:01.963

Pinal Dave 有一种[奇怪的方法来执行](http://blog.sqlauthority.com/2007/06/08/sql-server-insert-multiple-records-using-one-insert-statement-use-of-union-all/)我前几天读到的批量插入：

```
INSERT INTO MyTable  (FirstCol, SecondCol)
    SELECT  'First' ,1
    UNION ALL
SELECT  'Second' ,2
    UNION ALL
SELECT  'Third' ,3
... 
```

考虑到您的大型数据集，可能会尝试看看会发生什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T21:31:48.837

*   在 winforms 应用程序的数据表中显示数据。
*   将数据复制到 Excel（或 OpenOffice Calc）中。
*   保存存档。
*   使用数据导入工具将数据拉入并映射字段。

您将在 15 分钟内完成。

编辑：呃，这可能不适用于 100k 行。但在您进行更复杂的操作之前，它快速、简单且值得一试。

# sql - XPath 在序列中搜索元素

> ID：440644
> 
> 赞同：0
> 
> 时间：2009-01-13T20:23:09.540
> 
> 标签：sql, xml, postgresql

使用像这样的xml：

```
<a>
  <b>
   <c>1</c>
   <c>2</c>
   </c>3</c>
  </b> 
```

我正在尝试创建一个 xpath 表达式（用于 postgresql 查询），它将返回 if 是一个特定的值，而不是所有三个值。我目前拥有的（不起作用）是：

```
select * from someTable where xpath ('//uim:a/text()', job, ARRAY[ ARRAY['uim','http://www.cmpy.com/uim'] ])::text[] IN (ARRAY['1','3']); 
```

如果我尝试使用 ARRAY['1'] 这将不会返回任何值，但使用 ARRAY['1','2','3'] 它将返回所有三个值。

如何根据序列中的单个元素进行选择？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-17T18:47:54.783

如果您询问如何在 XML 段中获取 1 个或多个 XML 元素的值，最简单的方法可能是简单地利用自定义 SQL CLR 库和其中的 XPath 分析来组合并返回您想要的任何信息。至少那将是我的方法。

# javascript - 如何将 JavaScript 代码转换为一个大的 Java 字符串

> ID：440645
> 
> 赞同：3
> 
> 时间：2009-01-13T20:23:10.100
> 
> 标签：javascript, string, escaping, server-side, quotes

所以我有 1000 行 javascript。我需要将其转换为 Java 字符串，以便我可以输出（通过`System.out.println`或其他方式）。

我正在寻找一个***在线工具来逃避所有的引号***......适合我的特定需求的东西会很好，因为我不希望改变其他特殊字符。像这样的行：

```
var rgx = /(\d+)(\d{3})/; 
```

需要保持原样。

这种情况要求将 JavaScript 放入字符串中，因此请不要使用变通方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T21:20:59.703

这是一个链接，其中包含[Crockford 的`quote()`函数](http://javascript.crockford.com/remedial.html)实现。使用它来构建您自己的 JavaScript 转换器。

**编辑：**我还[稍微修改了函数](http://mercurial.intuxication.org/hg/js-hacks/raw-file/a243b3e46ddb/quote.js)以默认输出一个 ascii 安全字符串。

**Edit2：**只是一个建议：将 JavaScript 保存在外部文件中并在运行时读取它而不是硬编码它可能更聪明......

**Edit3：**这是一个功能齐全的解决方案 - 只需复制到`.html`文件并替换虚拟脚本：

```
<script src="quote.js"></script>
<script>
// this is the JavaScript to be converted:
var foo = 'bar';
var spam = 'eggs';

function fancyFunction() {
    return 'cool';
}
</script>
<pre><script>
document.writeln(quote(
    document.getElementsByTagName('script')[1].firstChild.nodeValue, true));
</script></pre> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T20:27:33.400

您可以使用其中一种可用工具压缩文件以实现此效果：

[YUI 压缩机在线](http://yui.2clics.net/)

[迪恩·爱德华的包装工](http://dean.edwards.name/packer/)

[道格拉斯·克罗克福德的 JSMIN](http://www.crockford.com/javascript/jsmin.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T20:27:56.863

您可以使用[jsmin](http://www.crockford.com/javascript/jsmin.html)工具将 Javascript 压缩为一行（希望如此），但它不会转义引号。这可以通过在编辑器或使用的服务器端脚本语言中搜索/替换来完成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T22:45:52.590

所以我尝试的一切最终都破坏了javascript。我终于通过执行以下操作使其工作：

使用记事本++：

1.  多次按 Shift + Tab 以取消缩进每一行

2.  查看 -> 显示行尾

3.  突出显示 LF 字符并执行 Replace All 以替换为空字符串
4.  重复 CR 字符

5.  突出显示一个“（引号字符）并用\”（转义引号）执行全部替换......只是在替换提示中输入引号字符只是出于某种原因抓住了一些引号。

6.  现在你有 1 条非常长的行...我最终不得不将 1 个字符串分成大约 2000 个字符长的行...。疯狂的长行正在杀死 IE 和/或打破 Java 字符串限制。

# .net - Windows 窗体数据绑定 DisplayMember 自定义类的子属性

> ID：440651
> 
> 赞同：4
> 
> 时间：2009-01-13T20:24:37.523
> 
> 标签：.net, winforms, data-binding

我正在尝试将 Windows 窗体项目中我的 ListBox 的 DisplayMember 属性设置为我绑定到的通用列表内的嵌套类的属性。

这是一个简单的例子：

```
 public class Security
{
    public int SecurityId { get; set;}
    public SecurityInfo Info { get; set;}
}
public class SecurityInfo
{        
    public string Description { get; set;}
}
//........//
public void DoIt()
{
    List<Security> securities = new List<Security>();
    //add securities to list
    lstSecurities.DataSource = securities;
    lstSecurities.DisplayMember = "Info.Description";
} 
```

这可以通过一个简单的 ListBox 实现，还是我必须创建一个子类 ListBox 来处理这个？

编辑：

我试图不修改这些类，因为它们是通过 WSDL 文档生成的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T21:10:40.333

不，大多数 winforms 绑定不支持这样的子属性。

您可以直接使用自定义类型描述符来完成此操作，但这需要*大量*工作且不值得。

检查生成的代码；它应该（使用任何最新版本的工具）是`partial class`; 这意味着您可以在**第二个**类文件中添加额外的成员，因此您不会破坏 wsdl 生成的代码 - 即

```
namespace MyWsdlNamespace {
    partial class MyClass {
        public string InfoDescription {
            get { return Info.Description; }
            // and a set if you want
        }
    }
} 
```

您现在应该能够相当容易地绑定到“InfoDescription”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T20:35:52.180

您可以添加一个映射到 Info.Description 的新属性。

像这样的东西：

```
public string InfoDescription
{
  get { return Info.Description; }
  set { Info.Description = value; }
} 
```

这将起作用。但我认为你的例子也应该有效

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-19T15:23:12.517

我知道已经发布了几个可能对您有用的答案，并且这个问题已有 3 年历史，但我想添加另一个选项，因为我在与实体框架中的对象进行数据绑定时遇到了这个问题。

我绑定到一个 ListBox，但想显示来自子对象的文本。我所做的只是处理`ListBox.Format`事件，并更改`ListControlConvertEventArgs.Value`. 我可以获取我的子对象，因为我为 ListBox 选择的 DisplayMember 是父对象本身，并且可以在事件中通过`ListControlConvertEventArgs.ListItem`.

例如，ListBox 数据绑定到具有 objA 列表的绑定源。objA 具有子对象 objB 的属性。ListBox 的 DisplayMember（在设计时设置）是 objB。但是，由于该`ToString()`方法没有返回我想要的 objB，我处理 ListBox 的 Format 事件并将`e.Value`（`e`作为`ListControlConvertEventArgs`）设置为我正在寻找的对象：

```
CType(e.ListItem, objA).objB.DisplayText 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T20:27:42.277

只需覆盖 SecurityInfo ToString 方法以返回 Description 并执行以下操作：

```
lstSecurities.DisplayMember = "Info"; 
```

如果您无法修改类，最好的选择是使用 ViewModel。一个接受 Security 并公开您要查看的属性的类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-08T23:06:31.423

值得一看的是

[http://www.mail-archive.com/advanced-dotnet@discuss.develop.com/msg06383.html](http://www.mail-archive.com/advanced-dotnet@discuss.develop.com/msg06383.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-07-31T23:56:09.767

是的，可以通过 BindingSource 绑定到嵌套属性。Dan 在 1 月 25 日的评论显示了如何为“简单绑定”完成此操作，即绑定到单个对象的嵌套属性。对于集合的“复杂绑定”，它应该是这样的：

```
public void DoIt()
{
    List<Security> securities = new List<Security>();

    var securitiesBindingSource = new BindingSource();
    securitiesBindingSource.DataSource = securities;

    //add securities to list
    lstSecurities.DataSource = securitiesBindingSource;
    lstSecurities.DisplayMember = "Info.Description";
} 
```

微妙的警告：集合的对象应该是同一类型的后代，因此 Info 应该是同一类型。当 Info 属性依赖于类型参数时，即使它是协变的，接口协变也不会欺骗它工作，因为这将使 Info 成为协变但不同的类型，例如 when`Info`是 type `Information<out P>`。

# java - 你如何让一个类监听由其他类引起的 PropertyChangeEvents，而不是这个类？

> ID：440672
> 
> 赞同：0
> 
> 时间：2009-01-13T20:30:54.267
> 
> 标签：java, model-view-controller

[如另一个问题中所述](https://stackoverflow.com/questions/371708/how-to-construct-two-objects-with-each-other-as-a-parameter-member)，我有一组模型对象和一组关联的面板对象，它们允许用户访问模型对象中的数据。面板注册为模型的 PropertyChangeListeners，这样如果有其他东西更新模型中的值，它就会触发 PropertyChangeEvent，面板接收它并知道从模型中重新同步其值。（目前我只是天真地更新所有值，但这可以更智能地只提取更改的属性。）

当模型被某个任意的未知来源更新时，所有这些都是有意义的，这确实发生在我的应用程序中。但是，大多数情况下，模型的属性是由面板本身设置的。在这种情况下，既然我已经将面板作为模型的 PropertyChangeListeners 连接起来，我的代码正在做一些没有意义的事情：在面板更新模型之后，面板从模型接收一个 PropertyChangeEvent 并从中提取相同的值它最初发送给模型的模型。不需要进行更新，并且发生这种情况在设计上没有意义。

那么我如何将某些东西注册为 PropertyChangeListener 但然后说“当我是它们的来源时不要通知我 PropertyChangeEvents？” （请注意，我无法通过调用 PropertyChangeEvent.getSource() 来回答这个问题；它会给我我的模型，而不是首先发送值的面板；没有办法查看这个并判断是什么改变了属性.)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T20:41:17.600

实际上，您是否真的在乎是否让该事件向您发起反击？它允许您处理任何时候在面板之外更改模型，并且在检查您是否真的需要更新值时确实没有太多开销。

PropertyChangeEvent 保存正在更改的属性以及旧值和新值。您可以检查每个传入事件以查看 Panel 中的值是否与新值相同，如果是则丢弃该事件。每次模型发生变化时，模型都应该告诉正在监听它的每个人的 PropertyChangeEvents，否则它需要了解太多关于正在监听它的对象的信息。

无论您做什么，都**不要**创建属性更改事件侦听器循环。如果您不是很小心，您最终会遇到很容易以无限循环结束的情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T21:20:13.217

我认为运行时不必要的重绘不会有任何可衡量的损害。所以从这个角度来看，没有必要更改代码。在这种情况下，您应该根据设计/架构来决定。你说：

> ...发生这种情况没有设计意义...

，但确实如此！如果要避免重绘，则必须将源（面板）添加到更改模型的方法的参数中，将其放入更改事件中，并在再次评估事件时考虑该参数，这使您的代码更加复杂。想想你还需要做什么，如果同一个面板有两个实例，一个更改模型，一个在收到事件后必须更改...将 object-ids 添加到方法调用...如果以后更改模型的设计或查看编辑面板的一个字段导致模型更改显示在面板的另一部分的方式 - 再次进行其他更改......等等。

此外，如果你按照描述的那样做，你将打破模型和视图的解耦，这绝不是一个好主意。

如果您想保持简单，请保持原样。编写复杂代码的唯一原因是运行时结果不好，我认为你不会明白的。

# c# - 在预编译的 ASP.NET 2.0 站点上编译错误 CS0433

> ID：440675
> 
> 赞同：8
> 
> 时间：2009-01-13T20:31:38.587
> 
> 标签：c#, asp.net, compiler-construction, asp.net-2.0, telerik

当我启动调试器来调试我的网站时，我总是经常收到这个错误。我正在使用 Telerik 控件，通常错误出现在我的标签条中。这是我现在正在查看的错误示例：

```
Compiler Error Message: CS0433: The type 'ASP.controls_motorvehiclegeneral_ascx' exists in both 'c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\App_Web_6wlqh1iy.dll' and 'c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\App_Web_ro_sgchs.dll'

Source Error:

Line 48:     </telerik:RadTabStrip>
Line 49:     <telerik:RadMultiPage ID="RadMultiPageControls" Runat="server" SelectedIndex="0">
Line 50:     <telerik:RadPageView ID="PageGeneral" runat="server"><uc1:General ID="GeneralControl" runat="server" /></telerik:RadPageView>
Line 51:     <telerik:RadPageView ID="PageVehicle" runat="server"><uc1:VehicleList ID="VehicleList" runat="server" /></telerik:RadPageView>
Line 52:     <telerik:RadPageView ID="PagePerson" runat="server"><uc1:PersonList ID="PersonList" runat="server" /></telerik:RadPageView> 
```

最困扰我的是，如果我一直按 F5，页面将刷新并正常工作。有时需要多次刷新才能做到这一点，而另一些则发生得很快。我无法在网上找到解决方案，因为大多数出现此错误的人正在从 VS2005 升级到 Web 应用程序，因此修复似乎是“删除您的 app_code 目录，并将 CodeFile= 更改为 CodeBehind= . 但是，CodeBehind 是旧的，不再使用了。

在这种情况下，我的“常规”选项卡上出现了错误，但是当它确实发生时，我的任何用户控件都可能发生这种情况。

有没有其他人在预编译页面上看到过这个？我正在使用 VS2008 SP1。

我看到的与此相关的另一个效果是，当我有一个带有数据源的 GridView 设置时，数据源发生了变化，但页面直到其他几个操作才更新，然后所有数据都被一次性填充...这让我觉得有某种缓存问题，或编译时，超时或什么的......

我正在使用 site.master 页面，并检查了 @Page 和 @Master 指令......只是为了论证，这里是它使用的编译器选项......

```
C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE> "c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\csc.exe" /t:library /utf8output /R:"c:\WINDOWS\ Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\assembly\dl3\6614ff9a\005164fc_423cc801\PetersDatePackage.DLL" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.IdentityModel \3.0.0.0__b77a5c561934e089\System.IdentityModel.dll" /R:"c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\mscorlib.dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\Microsoft. ReportViewer.Common\9.0.0.0__b03f5f7f11d50a3a\Microsoft.ReportViewer.Common.dll" /R:"C:\WINDOWS\assembly\GAC_32\System.EnterpriseServices\2.0.0.0__b03f5f7f11d50a3a\System.EnterpriseServices.dll" /R:"c :\WINDOWS\Microsoft.NET\Framework\v2.0.50727\临时 ASP。NET 文件\statisticsweb\30c716d3\eebad209\App_Web_0-em44qa.dll" /R:"c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\App_Web_6wlqh1iy.dll" /R:"c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\App_Web_ro_sgchs.dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\Microsoft. Build.Utilities\2.0.0.0__b03f5f7f11d50a3a\Microsoft.Build.Utilities.dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.ServiceModel\3.0.0.0__b77a5c561934e089\System.ServiceModel.dll" /R:"c :\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\assembly\dl3\6fe979bb\0056bc44_4b94c701\Microsoft.Practices.EnterpriseLibrary.Common.DLL" /R:"C: \WINDOWS\assembly\GAC_32\System.Web\2.0.0。0__b03f5f7f11d50a3a\System.Web.dll" /R:"c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\assembly\dl3\ad70f8ed\0010f920_4b94c701\Microsoft.Practices .EnterpriseLibrary.Data.DLL" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.ServiceModel.Web\3.5.0.0__31bf3856ad364e35\System.ServiceModel.Web.dll" /R:"c:\WINDOWS\Microsoft. NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\assembly\dl3\d61e8194\009ae0bd_854ec901\Telerik.Web.UI.DLL" /R:"c:\WINDOWS\Microsoft.NET\Framework \v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\assembly\dl3\98ba2ae7\211fb135_e674c901\CoreAPI.DLL" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.Web.Extensions\1.0\. 61025.0__31bf3856ad364e35\System.Web.Extensions.dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.Management\2.0.0.0__b03f5f7f11d50a3a\System.Management.dll" /R:"c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3 \eebad209\assembly\dl3\62fa267e\9888875e_bb5cc901\AjaxControlToolkit.DLL" /R:"C:\WINDOWS\assembly\GAC_MSIL\Microsoft.Build.Framework\2.0.0.0__b03f5f7f11d50a3a\Microsoft.Build.Framework.dll" /R: "C:\WINDOWS\assembly\GAC_MSIL\System.Drawing\2.0.0.0__b03f5f7f11d50a3a\System.Drawing.dll" /R:"c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\ statisticsweb\30c716d3\eebad209\App_Code.nufffrfb.dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.Web.Services\2.0.0.0__b03f5f7f11d50a3a\System.Web.Services.dll" /R:"c: \WINDOWS\Microsoft.NET\Framework\v2.0.50727\临时 ASP。NET 文件\statisticsweb\30c716d3\eebad209\assembly\dl3\52f6447d\f90fd1c8_b475c901\StatisticsAPI.DLL" /R:"C:\WINDOWS\assembly\GAC_MSIL\System\2.0.0.0__b77a5c561934e089\System.dll" /R:"c :\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\assembly\dl3\955f38e7\982cdc0f_bc5cc901\Validators.DLL" /R:"C:\WINDOWS\assembly\GAC_MSIL \Microsoft.ReportViewer.WebForms\9.0.0.0__b03f5f7f11d50a3a\Microsoft.ReportViewer.WebForms.dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.Runtime.Serialization\3.0.0.0__b77a5c561934e089\System.Runtime.Serialization。 dll" /R:"c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\App_Web_nv7t8gs_.dll" /R:"C:\WINDOWS\assembly\GAC_32\ System.Data\2.0.0.0__b77a5c561934e089\System.Data。dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.Configuration\2.0.0.0__b03f5f7f11d50a3a\System.Configuration.dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.Design\2.0.0.0 __b03f5f7f11d50a3a\System.Design.dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.WorkflowServices\3.5.0.0__31bf3856ad364e35\System.WorkflowServices.dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\System .Web.Mobile\2.0.0.0__b03f5f7f11d50a3a\System.Web.Mobile.dll" /R:"c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\assembly \dl3\a5daf5e0\0071b5e7_909cc701\Microsoft.Practices.ObjectBuilder.DLL" /R:"C:\WINDOWS\assembly\GAC_MSIL\Microsoft.ReportViewer.ProcessingObjectModel\9.0.0.0__b03f5f7f11d50a3a\Microsoft.ReportViewer.ProcessingObjectModel.dll" /R: "c:\WINDOWS\微软。NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\App_Web_atcckswk.dll" /R:"C:\WINDOWS\assembly\GAC_MSIL\System.Xml\2.0.0.0__b77a5c561934e089\System.Xml。 dll" /out:"c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\App_Web_zva2jsmk.dll" /D:DEBUG /debug+ /optimize- /win32res:" c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\zva2jsmk.res" /nowarn:1659;1699;1701 /d:DBCONVERTPUBLIC;CRYSTALSUPPORT "c:\WINDOWS \Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\App_Web_zva2jsmk.0.cs" "c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files \statisticsweb\30c716d3\eebad209\App_Web_zva2jsmk.1.cs" "c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\statisticsweb\30c716d3\eebad209\App_Web_zva2jsmk.2.cs"

```

有人有什么想法我什至可以开始寻找吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-05-20T22:47:52.063

如上所述杀死卡西尼实例对我不起作用。 [ScottGu 发布了有关此问题的信息](http://weblogs.asp.net/scottgu/public-hotfix-patch-available-for-asp-net-compilation-issues)

在 web.config 的编译部分设置 batch="false" 属性对我有用。

```
<configuration>

   <system.web>
       <compilation debug="false" batch="false"></compilation>
   </system.web>

</configuration> 
```

> 这告诉 ASP.NET 将各个 .aspx/.ascx 文件动态编译成单独的程序集。这避免了触发异常的循环引用问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T13:42:05.060

对我来说，关闭 IDE，关闭网站（IIS 或 Cassini），删除我所有的临时 asp.net 文件，启动 IDE 并进行完整编译就可以了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-02T16:18:01.837

在 IIS 中，您需要通过打开命令提示符并键入`iisreset`然后按 Enter 来重新启动它，但是如果您使用 Visual Studio Web 服务器（Cassini）中的构建，那么这不会解决您的问题。您可以通过键入（完全像这样，因为它的大小写敏感）来终止所有正在运行的 Cassini 实例：`taskkill /f /im "WebDev.WebServer.exe"`然后按 Enter。然后您将看到以下消息：`SUCCESS: The Process "WebDev.WebServer.EXE" with PID <some #> has been terminated.`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-15T14:23:25.930

如果您有 VS2008 和 WEB 应用程序（不是 WEB 站点），则不能有名为 App_Code 的目录（您必须从中删除所有文件并将其移至根文件夹）并从项目中删除/排除该文件夹（App_Code）。App_Code 中的每个文件都将在调试/发布期间进行编译。- 这解决了我的 CS0433 问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-12-08T00:28:57.323

我最近修复了这个错误。原因是项目中有一些文件或类声明了不止一次。就我而言，

```
error CS0433: The type 'usercontrol_ucManageNews' exists in both 
'c:\Users\DangLe\AppData\Local\Temp\Temporary ASP.NET Files\working\ed64f624\95e2038d\App_Web_kc2c2twy.dll' and 'c:\Users\DangLe\AppData\Local\Temp\Temporary ASP.NET Files\working\ed64f624\95e2038d\App_Web_0ywfoitp.dll' 
```

因为在我的项目中有两个文件夹包含文件 ucManageNews.ascx

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T14:45:38.547

原因可能是您正在引用的其他一些 DLL 可能正在引用指定程序集的旧/新版本。所以应用程序的不同部分引用了不同版本的程序集。我也遇到了这样的问题。为了解决它，我强制应用使用新版本：

我将 web.config 中的所有引用都更改为指向较新的版本。就我而言，是 System.Web.Extensions 程序集导致了问题。 **我将它们全部从 1.0.60125.0 更改为 3.5.0.0**

接下来，**我将这些行添加到我的 web.config**中，这基本上告诉您的应用程序将对旧版本程序集的所有引用“转发”到新版本：

```
<runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <probing privatePath="bin;sitefinity\admin\bin" />
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Extensions" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="3.5.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Extensions.Design" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="1.0.0.0-1.1.0.0" newVersion="3.5.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Telerik.Security" publicKeyToken="dfeaee0e3978ac79" />
        <bindingRedirect oldVersion="3.2.1598.2" newVersion="3.5.1747.2" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Telerik.Cms.Web.UI" publicKeyToken="dfeaee0e3978ac79" />
        <bindingRedirect oldVersion="3.2.1598.2" newVersion="3.5.1747.2" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="Telerik.Web.UI" publicKeyToken="121fae78165ba3d4" />
        <bindingRedirect oldVersion="2008.1.515.20" newVersion="2008.2.1001.20" />
      </dependentAssembly>
    </assemblyBinding>
  </runtime> 
```

**我没有想出这个解决方案，但在我不记得的地方找到了它。但是，我认为我从来没有看到过为什么会发生这种情况的解释！**

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-31T20:54:06.733

要修复这个错误，它相当简单，但需要一些很少使用的声明（困难的部分是挖掘正确的文档；）。

请参阅**ECMA-334**的第**16.3**节“**外部别名指令**”

如果您控制“您的”源并链接到另一个程序集“他们的”二进制文件，但您不能更改（或不想改变太多：）命名空间/类型说明符（例如，你们**俩**都声明**System**）。实际上，我最近遇到了很多这样的问题，随着 CLR/DLR 的所有 Beta/Alpha/Version 更新，MS 在他们发布的命名空间中已经搅动了很多。

当您导入程序集“他们的”时，通常编译器会将其设置到全局（保留）命名空间中。在 MSVC 中，您转到程序集引用上的属性，转到它所说的“**别名**”，然后您可以指定一个新名称，*而*不是全局名称。或者实际上是几个名字。

假设您使用“ **global2** ”这个富有想象力的名称。

然后，您转到您的源文件并在任何命名空间声明*之前的***顶部** 放置；

 *```
extern alias global2;
using global2::System; 
```

然后，您的代码可以使用 global2 中的类型，例如“Int32”或其他类型，您仍然可以通过以下方式重命名它；

```
extern alias global2;
using global2::System;
using orig = System; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-21T06:51:39.120

我刚遇到这个问题。事实证明，我不小心将文件从一个项目拖放到另一个项目，从而创建了一个副本。我花了一段时间才找到问题，因为这些文件隐藏在 Properties 文件夹中（我从不查看）。

无论如何，帮助我解决问题的是进入引发错误的文件，在错误的行上单击并“进行定义”。在定义中，您可以看到您正在查看的物理文件。如果它不是它应该是的，那么你就发现了你的问题。

我知道这是微不足道的，但它浪费了我大约 1 小时的时间，所以希望这些信息对任何人都有用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-05-20T22:51:56.517

顺便说一句，`CodeBehind`不老也不用！

`CodeBehind=`适用于 Web 应用程序中的页面（带有`.Designer.cs`文件），`CodeFile=`适用于网站中的页面（动态编译的程序集，因此没有`.Designer.cs`文件）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-04-02T13:00:53.683

我今天在使用 Web 用户控件时遇到了这个问题，但发现将 CodeBehind="..." 更改为 Src="..." 是导致错误的原因。[链接]http://stevenoderayi.blogspot.com/2011/04/resolved-cs0433-type-user-control.html[/link]

# python - 来自 for 循环的 Python 类

> ID：440676
> 
> 赞同：2
> 
> 时间：2009-01-13T20:31:45.090
> 
> 标签：python, class, for-loop

我有一段代码，其中包含一个用于从 XML 文件中绘制内容的 for 循环；

```
 for evoNode in node.getElementsByTagName('evolution'):
      evoName    = getText(evoNode.getElementsByTagName(        "type")[0].childNodes)
      evoId      = getText(evoNode.getElementsByTagName(      "typeid")[0].childNodes)
      evoLevel   = getText(evoNode.getElementsByTagName(       "level")[0].childNodes)
      evoCost    = getText(evoNode.getElementsByTagName("costperlevel")[0].childNodes)

      evolutions.append("%s x %s" % (evoLevel, evoName)) 
```

目前它输出到一个列表中`evolutions`，正如它在该代码的最后一行中所说的那样，对于这个和其他几个具有非常相似功能的函数，我需要它输出到一个类中。

```
class evolutions:
    def __init__(self, evoName, evoId, evoLevel, evoCost)
        self.evoName = evoName
        self.evoId = evoId
        self.evoLevel = evoLevel
        self.evoCost = evoCost 
```

如何创建这个类的一系列实例，每个实例都是那个for函数的响应？或者什么是核心实用解决方案？这个并不真正需要课程，但其他一个确实需要。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T20:51:11.073

列表理解可能会更简洁一些。我还将解析逻辑移动到构造函数以清理实现：

```
class Evolution:
    def __init__(self, node):
        self.node = node
        self.type = property("type")
        self.typeid = property("typeid")
        self.level = property("level")
        self.costperlevel = property("costperlevel")
    def property(self, prop):
        return getText(self.node.getElementsByTagName(prop)[0].childNodes)

evolutionList = [Evolution(evoNode) for evoNode in node.getElementsByTagName('evolution')] 
```

或者，您可以使用地图：

```
evolutionList = map(Evolution, node.getElementsByTagName('evolution')) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T20:35:25.723

```
for evoNode in node.getElementsByTagName('evolution'):
  evoName      = getText(evoNode.getElementsByTagName("type")[0].childNodes)
  evoId      = getText(evoNode.getElementsByTagName("typeid")[0].childNodes)
  evoLevel   = getText(evoNode.getElementsByTagName("level")[0].childNodes)
  evoCost      = getText(evoNode.getElementsByTagName("costperlevel")[0].childNodes)

  temporaryEvo = Evolutions(evoName, evoId, evoLevel, evoCost)
  evolutionList.append(temporaryEvo)

  # Or you can go with the 1 liner
  evolutionList.append(Evolutions(evoName, evoId, evoLevel, evoCost)) 
```

我重命名了您的列表，因为它与您的班级同名并且令人困惑。

# html - ASP.NET 2.0 HtmlTable Rows - 隐藏而不隐藏

> ID：440685
> 
> 赞同：2
> 
> 时间：2009-01-13T20:33:56.133
> 
> 标签：html, asp.net, html-table

我需要找到一种方法来隐藏 HTML 行（或表）而不阻止它们被呈现。设置 this.myTable.Visible = false 似乎是向用户隐藏表格的最简单方法，但它会阻止将 HTML 表格发送到浏览器，这会导致问题，因为我正在使用验证器并且需要确保验证不可见的元素（由于页面导航逻辑，一次只有一些元素对用户可见）。

我试图更改 Style 属性，但 asp.net 说它是只读的，所以我不能使用 CSS 使其不可见。我也不想使用 Javascript，但如果有一个简单的 JS 解决方案就可以了。

任何帮助是极大的赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T20:41:06.430

您可以通过向样式集合添加显示属性来设置此服务器端。样式集合属性本身是只读的（您不能替换它），但您可以为其添加一个元素以反映设置该样式属性。

```
 table.Style.Add("display","none") 
```

或者

```
 table.Style["display"] = "none"; 
```

表格行也是如此，因为 Style 集合是从 HtmlGenericControl 继承的。

**编辑**：HTML 控件需要 runat="server" 才能工作，我假设你的控件是因为你能够设置 Visible 属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T20:41:24.323

您可以制作`<tr`>s**服务器标签**。为此，请更改您的行

```
<tr id="rowID" runat="server"> 
```

这样您就可以访问它们的属性，例如`rowID.style`或`class`属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T20:40:20.177

要隐藏一个完整的表格（但仍将其呈现给客户端），请将其包装在 style="display:none" 的 div 中：

```
<div style="display:none;">
 asp.net table goes here
</div> 
```

虽然，对于单行，这不起作用。您可能不得不使用一些 javascript（例如 jquery，正如另一位用户推荐的那样）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T20:45:43.440

除了使用 style 属性之外，您始终可以将样式放在元素上，或者直接放在标签本身上，也可以通过`element.Attributes["style"] = "display: none;";`. 要在代码中执行此操作，您需要通过添加`runat="server"`和设置 ID 使它们成为服务器控件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T22:03:40.583

感谢您提供有用的信息。我实际上能够结合两个较早的答案来提出一个很好的解决方案。供参考，这里是：

我在要显示和隐藏的表格周围使用了 div 标签，例如：

```
<div style="display:none;" id="tblHideItems1" runat="server"> 
```

我在代码隐藏中引用了这些，如下所示：

```
Definition:
    protected System.Web.UI.HtmlControls.HtmlGenericControl tblHideItems1;

To show:
this.tblHideItems1.Style.Add("display", "inline");

To hide:
this.tblHideItems1.Style.Add("display", "none"); 
```

这使我可以显示或隐藏表格，而不会在隐藏时占用页面上的空白空间，但仍会渲染它们，以便它们在隐藏或显示时与验证控件（这是我的最终目标）一起使用。定义中的样式标签可能不是必需的，但由于它现在可以正常工作，我可能会留下它，因为它是在运行时修改的。

再次感谢您的洞察力！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-16T13:04:31.253

伙计们甚至 table.Visible = False 作品前提是你已经为当然表设置了 runat="server"

# api - 语言无关 API

> ID：440688
> 
> 赞同：11
> 
> 时间：2009-01-13T20:35:47.970
> 
> 标签：api

我正计划建立一个网络服务，或通过互联网公开的一些其他服务。我想为应用程序创建一个 API 以与此服务交互。我希望 API 可以在不同的语言中使用，例如 Java、C++、C# 或 PHP。如何为我的 API 维护一个代码库，同时为所有这些语言分发漂亮的打包二进制文件？另外，我可能想考虑这也可能是跨平台的。

**更新 1**

> 我是 Web 服务的早期阶段，但我认为关键点之一是许多工具支持基于 WDSL 等服务描述的客户端实现。我所做的任何事情都没有交付任何客户端软件，我希望任何用户都能够构建适合他们需求的自己的客户端。——布拉布斯特的回答

我不反对将其作为一个直接的 Web 服务，然后提供一个 WSDL 文件。但是如果我想让客户端 API 做一些逻辑、加密、错误检查等等呢？

**更新 2**

> 至于期望使用您的 API 做任何事情的客户端，您不能！您无法做任何事情来确保 API 的使用者会做任何正确的事情。这就是强大的错误处理如此重要的原因。您必须检查并仔细检查来自客户的所有内容。你必须始终怀疑它，甚至假设它是恶意的。这个事实真的没有什么好的办法。——瑞安·吉尔的回答

我最初的想法是在 .NET 中创建一个 DLL 或程序集，然后客户端正在调用运行客户端的这段代码。此代码可以通过任何通信协议与服务器通信，但我的 API 将在他们的机器上运行。我猜 REST 并没有真正做到这一点。似乎在 REST 中，一切仍然是 HTTP 帖子。它几乎是没有肥皂的网络服务。

**更新 3**

我已经接受了 Ryan Guill 的回答。我认为一般的想法是我需要公开某种网络服务，对客户端的障碍最低。这样任何人都可以连接。然后让我的所有代码在服务器上运行。这似乎被认为是真正实现我所追求的平台和语言独立性的唯一愿望。

感谢所有的投入。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-13T20:39:57.603

我会使用 REST API，类似于 Flickr 的 API 的工作方式：http: [//flickr.com/services/api/](http://flickr.com/services/api/)

它的创建和维护相当简单，最大的缺点是它需要大量的文档（但几乎任何你使用 API 的方式都会遇到这个问题），并且强大的错误处理是必须的。

但在我看来，这是创建最接近跨平台/跨语言的 API 的最佳方式。

更多信息在这里：[http ://www.xfront.com/REST-Web-Services.html](http://www.xfront.com/REST-Web-Services.html)

**更新**：提交者在帖子中添加了以下内容：

> 我不反对将其作为一个直接的 Web 服务，然后提供一个 WSDL 文件。但是如果我想让客户端 API 做一些逻辑、加密、错误检查等等呢？

我个人不喜欢使用 SOAP（使用 WSDL）。在服务器和客户端上使用 SOAP 有很多固有的开销。我认为这就是为什么你会看到越来越多的公共 API 是使用 REST 编写的。它确实降低了进入最低公分母的障碍，允许任何可以使用基本 HTTP（GET 和 POST（还有 PUT 和 DELETE 表示“正确”的方式））使用 API。

更多使用 REST 编写的公共 API 示例：[twitter](http://apiwiki.twitter.com/)、[vimeo](http://vimeo.com/api)、[Google](http://googlesystem.blogspot.com/2008/04/google-search-rest-api.html)

至于期望使用您的 API 做任何事情的客户端，您不能！您无法做任何事情来确保 API 的使用者会做任何正确的事情。这就是强大的错误处理如此重要的原因。您必须检查并仔细检查来自客户的所有内容。你必须始终怀疑它，甚至假设它是恶意的。这个事实真的没有什么好的办法。

**更新 2：**提交者在帖子中添加了以下内容：

> 我最初的想法是在 .NET 中创建一个 DLL 或程序集，然后客户端正在调用运行客户端的这段代码。此代码可以通过任何通信协议与服务器通信，但我的 API 将在他们的机器上运行。我猜 REST 并没有真正做到这一点。似乎在 REST 中，一切仍然是 HTTP 帖子。它几乎是没有肥皂的网络服务。

您当然可以这样做，但这仅适用于 .NET 语言，这意味着您的跨平台和跨语言优势是遥不可及的。而且，最后，你真的在​​阻止任何事情吗？开发人员将使用您的远程 API，或者您的本地 DLL 或程序集。无论哪种方式，他都必须知道如何使用它并正确使用它，否则您将抛出错误。您真正要做的就是更改引发错误的位置。这对您来说可能很重要（如果是，请说明原因），但实际上并没有改变等式中的任何内容。

但是您说 REST 有点像没有 SOAP 的 Web 服务有点正确。从技术上讲，REST 也是 Web 服务，只是 Web 服务通常意味着 SOAP。这确实是实现相同目标的不同方式。最大的区别在于，虽然它需要更多的编程和思考（可能在客户端需要更多的编程），但是你用它来换取健壮性、消费者和服务器的开销更少，以及 API 的尽可能广泛的受众. 它确实是最小的公分母。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T20:39:53.017

我是 Web 服务的早期阶段，但我认为关键点之一是许多工具支持基于 WDSL 等服务描述的客户端实现。

我所做的任何事情都没有交付任何客户端软件，我希望任何用户都能够构建适合他们需求的自己的客户端。

如果您按照其他答案之一的建议查看 flickr API，我认为他们不提供客户端代码，其他人已经构建并贡献了客户端的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-11T01:32:20.353

我建议用 Haxe 编程语言编写 API，以便源代码可以直接翻译成你提到的所有编程语言。Haxe 编程语言可以翻译（或“反编译”）为您在原始帖子中提到的所有编程语言，以及其他一些语言。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T20:40:23.560

简单的回答，不。

复杂的答案：创建一个 API 并将其编译为 COM dll。然后，只需为无法处理的语言构建包装代码。

简单的答案＃2，使原始服务如此微不足道，或者如此普遍接受，以至于不需要API（我通常通过服务器端数据库轮询来实现这一点。丑陋但任何可以访问数据库的语言都可以使用该程序）。

# ruby-on-rails - 构建插件或宝石？

> ID：440692
> 
> 赞同：6
> 
> 时间：2009-01-13T20:37:44.563
> 
> 标签：ruby-on-rails, plugins, gem

通常，当我知道我将在其他项目中再次需要一个模块时，我会创建一个插件，但是，它们也可以打包为 gem。

我应该什么时候构建一个 gem 而不是创建一个插件？拨打电话有任何标准吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T23:22:01.113

现在插件已经过时了，因为您可以通过 environment.rb 中的“config.gem”语句来管理 gem。Gems 在系统范围内可用（不仅仅是在一个应用程序中），并且与插件不同的是版本控制。

我最近将所有[插件](http://github.com/mdarby)都转换为 gems。[很容易做](http://www.mbleigh.com/2008/6/11/gemplugins-a-brief-introduction-to-the-future-of-rails-plugins/)，很值得。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-14T07:47:14.633

Rails 似乎正在朝着 gem 方向发展。我现在已经将我的大部分插件转换为 gems。Gems 更易于管理并且更适合 Ruby 生态系统。为什么我们仍然需要两个独立的系统？

然而，gem 仍然存在一个问题：无法从 gem 向 Rails 应用程序添加 rake 任务。发电机可能同样适用，尽管我不确定。如果您在插件中使用这些，则尚无法迁移到 gem。希望这很快得到解决。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T20:27:43.567

您可以通过 gems 将生成器添加到 rails。这实际上非常简单，您只需将 rails_generators 目录添加到您的 gem。（我认为其他目录名称也可以使用——我不确定 rails 搜索的是什么）。示例：http: [//github.com/remi/rackbox/tree/a21c21667c68d5fd51357e28f0742171e9161e9b/rails_generators](http://github.com/remi/rackbox/tree/a21c21667c68d5fd51357e28f0742171e9161e9b/rails_generators)

至于添加 rake 任务......我还没有弄清楚如何做到这一点：/

现在，我让我的生成器添加`require 'myproject/rails/tasks'`（或其他东西）到项目的 Rakefile 中，作为将 rake 任务从 gem 添加到 rails 的一种方式。

许多宝石要求您将它们“引导”到您的 Rails 项目中，例如。sudo gem install cucumber cd rails_app ./script/generate cucumber # bootstrap cucumber into your app

# .net - 我将如何在家练习 .NET（免费）？

> ID：440693
> 
> 赞同：8
> 
> 时间：2009-01-13T20:38:58.510
> 
> 标签：.net

在没有能力或意愿为所有需要的软件付费的情况下，您如何设法使用和实践 Microsoft 技术？

是否有 Visual Studio、SQL Server 和插件的免费版本？是否有关于如何在本地服务器上设置 ASP.NET 开发的教程？在我自己的机器上开发和测试是否可行？

关于托管，使用面向 Microsoft 的技术是否昂贵？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-13T20:43:18.203

[Visual Studio 和 SQL Server 2005/2008](http://www.microsoft.com/express/)有（免费）速成版。而且您不需要任何服务器来开发 ASP.NET 应用程序 - 您也可以在 XP/Vista 上执行此操作。

如果您想让应用程序公开可用，您只需要为托管服务商付费。

还请查看以下问题以获取一些类似信息：[学习 C#/.NET 是否需要 MSDN 订阅？](https://stackoverflow.com/questions/409933/does-learning-c-net-require-an-msdn-subscription#409936)

**更新**：作为商业主机的替代方案（例如，暂时让您的一个应用程序可供他人使用），您可以将它们托管在您的 PC 上并使用动态 DNS 服务（例如[DynDNS](http://www.dyndns.com/)）使您的 PC 可以从 Internet 访问。虽然（正如 Robert 在他的评论中提到的），以这种方式永久托管 Web 应用程序可能违反您与 ISP 的协议。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-13T20:48:27.367

就我个人而言，我的家用电脑足以运行游戏，我发现我可以很容易地创建一些虚拟机。微软对几乎所有东西都有 90 天的试用期，如果我只是创建一次性服务器和学习项目，这是完美的。在试用期结束后，我会杀死虚拟服务器并从头开始重建它。

但是从那时起，Express 版本已经发布，如果您只是为了学习而这样做，它们会处理您真正需要的一切。当我教书的时候，我会杀了这样的东西，因为人们学习的价格太高了。它们拥有您真正掌握 .NET 和 Windows 开发的重要方面所需的一切。他们可能没有一些花哨的花里胡哨，但我想大多数人都会同意，没有这些工具只会让你成为更好的开发人员。一旦您了解幕后发生的事情，它们就会为您节省时间，如果您担心它，真的不需要太多时间来学习。

最终我只是购买了 MSDN 订阅。我在家里建造了足够的东西来保证这笔费用。但除非你能负担得起并证明成本合理，否则你真的不需要它，所以我不会担心。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-13T21:44:42.777

有人必须建议[MONO](http://www.mono-project.com/Main_Page)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-13T20:56:06.867

Visual Studio 速成版的功能实际上比我想象的要多。我能够用他们做我需要的一切（建立个人网站，偶尔参与开源项目等）。我还在家用 PC 上安装了 SQL Server 2005 Express，它运行良好。因为我有 Windows XP Home（没有 IIS 标准），所以我只使用 Visual Studio 中内置的 ASP.NET 开发服务器。

对于托管，我发现最好的交易是 1&1 Virtual Private Server 托管。我每月支付 30 美元，获得了自己的 Windows Server 2003 服务器，我是该服务器的管理员并且可以远程桌面进入。我还在上面加载了 SQL Server 2005 Express，没有任何问题。要添加我的站点，我只是直接通过 IIS 工作。总体而言，它比共享主机要容易得多，并且具有更大的灵活性。我运行了大约 8 个小型站点，没有任何问题。您甚至可以与想要运行网站的朋友分摊托管费用，并且每个人都可以拥有自己的服务器登录名。

希望这会有所帮助，祝你好运！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-13T21:10:55.870

Visual Studio Express 还不错，[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/)出奇的好（IMO 甚至比 express 好）

我以每月 9.99 美元的价格使用[Lunarpages ，重要的是它们支持最新版本的 .NET，因此您可以访问所有 .NET 3.5 好东西 :-) 加上无限的 SQL Server 和 MySQL](http://www.lunarpages.com/windows-hosting/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-13T22:27:35.140

只是为了让人们知道，如果您是学生，您可能有资格获得免费的专业版开发软件，这要归功于[Dreamspark](https://www.dreamspark.com/default.aspx "梦想火花")。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-13T20:42:19.110

我的托管服务器每月花费 40 美元，但我*不需要*它来进行开发。VS2008 的专业版并没有那么贵（几百美元，除非你去参加一个启动活动并免费获得它），而且 SQL Server 2008 Express 是免费的。与为他的工具支付数千美元的机械师相比，我觉得我相对毫发无损。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-13T20:43:52.010

首先，就像您说的那样，他们拥有您在家进行开发*所需的所有东西的 Express 版本。*如果您发现您绝对必须拥有非免费版本的功能，那么也许是时候尝试找钱来获得它们了。它们绝对值得拥有。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-13T20:45:09.277

我的经验是，Visual Studio 的 Express 版本（以及 SQL Server，就此而言）将提供大约 80-90% 的最常用的功能，并且可以在简单的硬件上运行。

至于托管，GoDaddy 提供支持 ASP.NET 的网络托管计划[，每月只需 5 美元](http://www.godaddy.com/gdshop/hosting/shared.asp?ci=9009)。GoDaddy 不是最好的，但它们对于玩具或个人项目来说绰绰有余。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-13T21:31:19.840

虽然我讨厌这是您参加本地 .NET 用户组、Alt.NET 会议或任何具有当地特色的会议的原因。保持相关性并参与 .NET 社区内部是一个附带好处，Door Prizes:-)！

他们希望您在家中编码时使用他们的技术，因此您可以在编码@工作时推荐它，他们将支付费用。就个人而言，在我的工作中，我们唯一支付的费用就是 Visual Studio。几乎所有其他东西都有一个相同或更好的开源解决方案。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-13T21:11:40.597

最好的选择是获得雇主赞助的 MSDN 订阅。如果您是独立承包商，IMO，您必须投资工具以获得您想要的回报。

当然有免费/轻量版的工具，但这些可能没有您希望向潜在客户展示的功能或您想磨练技能的功能。例如，我不确定 SQL Server 2005/2008 Express 是否具有您可能需要的基于多维数据集的报告的 Analysis Services、Reporting Services 组件。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-13T21:37:59.717

您所要做的就是安装 Visual Studio 和 MS SQL Express，您的工作站将成为一个自容器开发服务器。这是首选的模型。开发人员在本地环境中创建和测试他们的代码，当所有错误都得到修复后，应该将其部署到问答环境中。在那里，应用程序得到了进一步的审查和功能测试。

我完全喜欢这种方法。我可以在任何地方，没有互联网访问，仍然能够编码。

# c++ - for(;true;) 与 while(true) 不同吗？

> ID：440694
> 
> 赞同：10
> 
> 时间：2009-01-13T20:39:14.420
> 
> 标签：c++, c

如果我的理解是正确的，他们会做同样的事情。为什么有人会使用“for”变体？只是味道吗？

**编辑：**我想我也在考虑 for (;;)。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-01-13T20:43:32.213

```
for (;;) 
```

通常用于防止编译器警告：

```
while(1) 
```

或者

```
while(true) 
```

通常会引发关于条件表达式为常量的编译器警告（至少在最高警告级别）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-13T20:40:43.373

是的，这只是味道。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-13T20:41:20.080

我从来没有见过`for (;true;)`。我*见过*，`for (;;)`唯一的区别似乎是品味之一。我发现 C 程序员稍微偏爱`for (;;)`，`while (1)`但它仍然只是偏好。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-13T22:06:40.563

不是答案，而是注释：有时记住 for(;x;) 与 while(x) 相同（换句话说，当我检查 if 条件的中心表达式时只说“while”）有助于我分析讨厌的语句...
例如，很明显，中心表达式总是在循环的第一遍开始时进行评估，您可能会忘记这一点，但是当您以 while() 格式查看它时，它是完全明确的。

有时记住这一点也很方便

```
a;
while(b) {
   ...
   c;
} 
```

几乎（见评论）与

```
for(a;b;c) {
    ...
} 
```

我知道这很明显，但是积极了解这种关系确实可以帮助您在一种形式和另一种形式之间快速转换，以澄清令人困惑的代码。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-13T20:43:20.870

一些编译器（警告一直向上）会抱怨这`while(true)`是一个永远不会失败的条件语句，而他们对`for (;;)`.

出于这个原因，我更喜欢使用`for (;;)`作为无限循环的习惯用法，但不要认为这有什么大不了的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T20:42:00.327

以防他们计划稍后使用真正的 for() 循环。如果您看到 for(;true;)，它可能是要调试的代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T22:57:25.110

优化编译器应该为它们生成相同的程序集——一个无限循环。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-14T13:53:44.147

编译器警告已经讨论过了，所以我将从语义的角度来处理它。我使用 while(TRUE) 而不是 for(;;)，因为在我看来，while(TRUE) 听起来比 for(;;) 更有意义。我将 while(TRUE) 读为“而 TRUE 始终为 TRUE”。就个人而言，这是对代码可读性的改进。

因此，Zeus 禁止我不记录我的代码（当然，这-永远不会发生）它比替代方案更具可读性。

但是，总的来说，这是一件非常挑剔的事情，以至于 99% 的时间都归结为个人喜好。

# sql - 如何用另一个表中的字段更新一个表中的字段？(SQL)

> ID：440702
> 
> 赞同：1
> 
> 时间：2009-01-13T20:40:49.003
> 
> 标签：sql, sql-update

两个表：

***`COURSE_ROSTER`***- 包含

*   `COURSE_ID`作为外键`COURSES`
*   `USER_ID`作为我需要插入的字段`COURSES`

***`COURSES`***- 包含

*   `COURSE_ID`作为主键
*   `INSTRUCTOR_ID`作为需要使用字段更新的`USER_ID`字段`COURSE_ROSTER`

`UPDATE`sql语法是什么？我正在尝试这个，但没有用......我错过了一些东西，我无法在网上找到它。

```
UPDATE COURSES 
SET COURSES.INSTRUCTOR_ID = COURSE_ROSTER.USER_ID 
WHERE COURSE_ROSTER.COURSE_ID = COURSES.COURSE_ID 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T20:45:57.043

```
 Update Courses
    SET Courses.Instructor_ID = Course_Roster.User_ID
    from Courses Inner Join Course_Roster 
    On Course_Roster.CourseID = Courses.Course_ID 
```

这是假设您的 DBMS 允许连接更新查询。SQL Server 绝对允许这样做。如果你不能做这样的事情，你需要考虑使用子查询。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T20:48:21.143

并非所有数据库供应商（SQL Server、Oracle 等）都以相同的方式实现 Update 语法……您可以在 SQL Server 中使用连接，但 Oracle 不喜欢这样。我相信几乎所有人都会接受相关的子查询

```
 Update Courses C  
   SET Instructor_ID = 
          (Select User_ID from Course_Roster
           Where CourseID = C.Course_ID) 
```

注意： Course_Roster 中的 User_ID 列最好命名为 InstructorId（或 Instructor_Id）以避免混淆

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T20:47:34.950

```
UPDATE COURSES 
SET COURSES.INSTRUCTOR_ID = COURSE_ROSTER.USER_ID 
FROM COURSES
INNER JOIN COURSE_ROSTER
    ON COURSE_ROSTER.COURSE_ID = COURSES.COURSE_ID 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T20:47:57.460

如果你用 COURSE_ROSTER.user_id 填充它，为什么需要列 course.instructor_id？不是冗余存储吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T21:56:23.407

```
UPDATE COURSES 
SET INSTRUCTOR_ID = CR.USER_ID 
FROM COURSES C
INNER JOIN COURSE_ROSTER CR   
   ON CR.COURSE_ID = C.COURSE_ID 
```

# php - 在发送电子邮件之前将变量设置为 HTML 格式

> ID：440711
> 
> 赞同：0
> 
> 时间：2009-01-13T20:41:43.510
> 
> 标签：php, html, email

我正在发送一封电子邮件，消息 ($message) 是 HTML

我之前使用了一个不同的脚本（HTML MIME MAIL），我只是通过这样做将它设置为 HTML：setHTML($message)。

使用此脚本，我不确定如何将 $message 设置为在电子邮件中输出为 HTML。

```
require_once "Mail.php";

$from = "noreply@domain.com";
$host = "mail.domain.com";
$username = "username";
$password = "password";

$headers = array ('From' => $from,
'To' => $emailto,
'Subject' => $subject);
$smtp = Mail::factory('smtp',
array ('host' => $host,
'auth' => true,
'username' => $username,
'password' => $password));

$mail = $smtp->send($emailto, $headers, $message);

if (PEAR::isError($mail)) {
    echo("<p>" . $mail->getMessage() . "</p>");
} else {
    echo("<p>Message successfully sent!</p>");
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T20:46:16.810

你错过了说它是 html 的标题，试试这个：

```
$headers = array ('From' => $from,
'To' => $emailto,
'Subject' => $subject,
'MIME-Version' => '1.0',
'Content-type' => 'text/html; charset=iso-8859-1'); 
```

# php - 存储全局变量的最佳方式

> ID：440725
> 
> 赞同：6
> 
> 时间：2009-01-13T20:45:48.853
> 
> 标签：php, mysql

我正在用 PHP 编写一个应用程序，它使用了整个脚本中使用的大量全局变量。现在，我有一个配置文件，其中存储了使用该`define()`函数创建的一堆全局变量，但是由于我将有这么多，最好在数据库中创建一个只包含变量名的表和值，并访问这些具有查询数据库，查找变量，返回值并缓存值以供将来使用的函数。

我也欢迎其他存储全局变量的想法。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-13T20:59:53.787

该`define()`函数创建常量，而不是全局变量。全局变量应该谨慎使用，因为它们可能会被意外（或恶意！）损坏，但是常量是完全安全的。

我发现只有一个名为“config.php”的文件来设置所有常量是最简单的，它更快更简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T21:01:04.737

好吧，这取决于您的应用程序的结构。如果在给定的页面加载中，您实际上只需要数百个变量中的一个或两个，那么基准测试可能会表明查询数据库可能比包含大量配置文件更快。但是，每次用户想要做任何事情时，您都需要警惕过多的查询使您的数据库陷入困境。缓存可以减少冗余请求所增加的开销，但这就是它的使用范围。

如果这些变量主要是短字符串或布尔标志，我认为您的答案将很大程度上取决于您能够很好地维护什么。如果这些变量很少更改并且总是手动更改，那么结构良好的 .ini 文件将比大型数据库更容易维护。如果这些变量不断变化并且从不手动更改，那么将所有变量加载到数据库中可能会更聪明。

就个人而言，我发现自己在这两种情况下都相应地使用了这两种方法。如果你真的优柔寡断，你总是可以做一些基准测试。为从数据库中提取配置信息的页面加载计时，然后使用 .ini 文件（或充满`define()`s 的 .php 文件）为页面加载计时。

*（而且迂腐地说，`define()`在全局范围内创建常量，而不是全局变量。）*

# javascript - 对象/函数/类声明周围的括号是什么意思？

> ID：440739
> 
> 赞同：307
> 
> 时间：2009-01-13T20:48:07.257
> 
> 标签：javascript, syntax

我是 JavaScript 和[YUI](http://developer.yahoo.com/yui/)的新手。在 YUI 库示例中，您可以找到此构造的许多用途：

```
(function() {
    var Dom = YAHOO.util.Dom,
    Event = YAHOO.util.Event,
    layout = null,
        ...
})(); 
```

我认为最后几个括号是在声明之后执行函数。

...但是前面的一组围绕函数声明的括号呢？

我认为这是一个范围问题；那是将内部变量隐藏到外部函数和可能的全局对象中。是吗？更一般地说，这些括号的机制是什么？

* * *

## 回答 #1

> 赞同：236
> 
> 时间：2009-01-13T20:58:25.367

它是一个自动执行的匿名函数。第一组括号包含要执行的表达式，第二组括号执行这些表达式。

当试图从父命名空间隐藏变量时，这是一个有用的结构。函数内的所有代码都包含在函数的私有范围内，这意味着它根本无法从函数外部访问，使其真正成为私有的。

看：

[http://en.wikipedia.org/wiki/Closure_%28computer_science%29](http://en.wikipedia.org/wiki/Closure_%28computer_science%29)

[http://peter.michaux.ca/articles/javascript-namespacing](http://peter.michaux.ca/articles/javascript-namespacing)

* * *

## 回答 #2

> 赞同：150
> 
> 时间：2009-01-14T00:47:27.743

Andy Hume 几乎[给出](https://stackoverflow.com/questions/440739/what-do-parentheses-surrounding-a-javascript-objectfunctionclass-declaration#440772)了答案，我只想添加更多细节。

使用此构造，您将创建一个具有自己的评估环境或闭包的匿名函数，然后立即评估它。这样做的好处是您可以访问在匿名函数之前声明的变量，并且您可以在此函数中使用**局部变量**而不会意外覆盖现有变量。

*var*关键字的使用非常重要，因为在 JavaScript 中，默认情况下每个变量都是全局变量，但是使用该关键字可以创建一个新的、*词法范围*的变量，也就是说，它**在两个大括号之间的**代码中是可见的。在您的示例中，您实际上是在为 YUI 库中的对象创建短别名，但它具有更强大的用途。

我不想让你没有代码示例，所以我将在这里放一个简单的示例来说明闭包：

```
var add_gen = function(n) {
  return function(x) {
    return n + x;
  };
};
var add2 = add_gen(2);
add2(3); // result is 5 
```

这里发生了什么？在函数*add_gen*中，您正在创建另一个函数，它将简单地将数字*n*添加到其参数中。诀窍是在函数参数列表中定义的变量中充当词法范围的变量，就像用*var*定义的变量一样。

返回的函数**定义在 add_gen 函数的大括号之间，***因此*即使在 add_gen 函数执行完成后它也可以访问*n*的值，这就是为什么在执行示例的最后一行时会得到 5 的原因。

借助词法范围的函数参数，您可以解决在匿名函数中使用循环变量所产生的“问题”。举个简单的例子：

```
for(var i=0; i<5; i++) {
  setTimeout(function(){alert(i)}, 10);
} 
```

“预期”结果可能是从零到四的数字，但您会得到四个五的实例。发生这种情况是因为 setTimeout 和 for 循环中的匿名函数使用的**是相同的** *i*变量，所以当函数被评估时，*i*将是 5。

您可以通过使用问题中的技术以及函数参数是词法范围的事实来获得天真的预期结果。（我在[另一个答案](https://stackoverflow.com/questions/400989/iterating-through-an-array-while-performing-a-request-for-each-entry#401042)中使用了这种方法）

```
for(var i=0; i<5; i++) {
  setTimeout(
     (function(j) {
       return function(){alert(j)};
     })(i), 10);
} 
```

通过立即评估外部函数，您将在每次迭代中创建一个名为*j的完全独立变量，并且**i*的当前值将被**复制**到该变量中，因此您将得到第一次尝试时天真预期的结果。

我建议您尝试了解[http://ejohn.org/apps/learn/](http://ejohn.org/apps/learn/)上的优秀教程，以更好地了解闭包，这是我学到非常非常多的地方。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2009-01-14T09:36:38.360

> ...但是围绕所有函数声明的前一轮 parenteses 呢？

具体来说，它使 JavaScript 将 'function() {...}' 构造解释为内联匿名函数表达式。如果省略括号：

```
function() {
    alert('hello');
}(); 
```

你会得到一个语法错误，因为 JS 解析器会看到 'function' 关键字并假设你正在启动一个如下形式的函数*语句*：

```
function doSomething() {
} 
```

...而且你不能有一个没有函数名的函数语句。

函数表达式和函数语句是两种不同的结构，它们的处理方式非常不同。不幸的是，语法几乎相同，所以它不仅让程序员感到困惑，甚至解析器也很难分辨出你的意思！

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2013-07-25T14:37:34.450

继续跟进 Andy Hume 和其他人所说的话：

围绕匿名函数的“（）”是 ECMA 规范第 11.1.6 节中定义的“分组运算符”：http: [//www.ecma-international.org/publications/files/ECMA-ST/Ecma-262 .pdf](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf)。

从文档中逐字记录：

11.1.6 分组运算符

产生*式 PrimaryExpression* : ( *Expression* ) 的评估如下：

1.  返回计算*Expression*的结果。这可能是参考类型。

在这种情况下，函数被视为表达式。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-10-20T21:56:29.583

关于这个问题的一些考虑：

*   括号：

    浏览器（引擎/解析器）将关键字函数与

    ```
    [optional name]([optional parameters]){...code...} 
    ```

    所以在像 function(){}() 这样的表达式中，最后一个括号没有意义。

    现在想想

    ```
    name=function(){} ; name() !? 
    ```

是的，第一对括号强制匿名函数变成一个变量（存储表达式），第二个启动评估/执行，所以**(** function(){} **)()**是有意义的。

*   实用程序： ?

    1.  用于在加载时执行一些代码并将使用的变量与页面的其余部分隔离，尤其是在可能发生名称冲突时；

    2.  将 eval("string") 替换为

        （新函数（“字符串”））（）

    3.  **为“ =?:** ”运算符包装长代码， 如：

        结果 = exp_to_test ？(function(){... long_code ...})() : (function(){...})();

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-13T20:53:35.297

如果您愿意，第一个括号用于操作顺序。围绕函数定义的一组括号的“结果”是函数本身，实际上，第二组括号执行。

至于它为什么有用，我还不够 JavaScript 向导有任何想法。:P

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-09-16T22:10:04.697

看到[这个问题](https://stackoverflow.com/q/3720283/393280)。如果您使用函数名称，则第一组括号不是必需的，但无名函数需要此构造，并且括号用于编码人员在浏览代码时意识到他们正在查看自调用函数（请参阅一位博主的[最佳- 实践建议](http://peter.michaux.ca/articles/an-important-pair-of-parens)）。

# image - IE7 不打印完整图像？

> ID：440743
> 
> 赞同：0
> 
> 时间：2009-01-13T20:49:04.697
> 
> 标签：image, printing, internet-explorer-7

我有一个高度大于普通 8.5x11 纸的 jpg（高度约为 2000 像素）

这是链接 [http://i39.tinypic.com/121d7ur.jpg](http://i39.tinypic.com/121d7ur.jpg)

所以很明显，当你尝试打印这张照片时，它会打印在一张以上的纸上……但是当我尝试打印页面（甚至去打印预览）时……它只显示一半的图像第一页....但是没有第二页？...应该有第二页来显示其余部分（甚至是第 3 页）

如果我使用 FF 就没有问题...它打印在 3 页上...但是使用 IE 7 我仅限于打印 1 张纸。

我在 IE7 中右键单击图像本身并单击“打印此图像”，但仍然没有运气。

有人对此有解决方案吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T20:55:48.380

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Blank XHTML 1 Transitional Page</title>
<style>
@media print {
    html { height: 100%; }
    img { height: 100%; }
}
</style>
</head>
<body>
    <img src="bigimage.jpg" />
</body>
</html> 
```

**编辑**：抱歉，最初并没有意识到您的图像太高而不是太宽。要在保持纵横比的同时降低图像高度，请使用 CSS 将 HTML 和 IMG 设置为 100% 的高度 - 请参阅修改后的示例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T20:51:51.820

我知道这可能不是您真正想要的答案，但如果您打算让用户打印图像，我会考虑将其放入 PDF 中。这样，每个人每次都会打印相同的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-16T20:11:52.220

尝试将图像包装在 div 中，在 div css 中应用以下内容：

# image_wrapper {*高度：1%; 位置：相对}

star/* 选择器应该限制在 IE 中，这是 holly hack 的一种变体。

# wcf - WCF REST ATOM 提要中的特殊字符

> ID：440744
> 
> 赞同：1
> 
> 时间：2009-01-13T20:49:21.843
> 
> 标签：wcf, rest

我有一个使用 WCF REST 工具包和以下 UriTemplate 的 WCF ATOM Feed 服务

```
[WebGet(UriTemplate = "{category}/?numItems={numItems}")]
public Atom10FeedFormatter GetFeedByCategory(string category, int numItems) 
```

大多数情况下都有效，边缘是当我尝试根据带有# 符号的类别加载提要时。我正在为 category='C#' 加载课程，而所有看到的服务都是'C'。这两个链接都在这样做。有谁知道是否有一些特殊的方法可以在 WCF 中转义这个角色？

*   [http://myservice.uri/Service.svc/C#/?numItems=5](http://myservice.uri/Service.svc/C#/?numItems=5)
*   [http://myservice.uri/Service.svc/C%23/?numItems=5](http://myservice.uri/Service.svc/C%23/?numItems=5)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T03:39:21.470

在 MSDN 论坛上回答[http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/d03c8331-1e98-4d5d-82a7-390942a93012/](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/d03c8331-1e98-4d5d-82a7-390942a93012/)

# java - 带有标题的 JSeparator

> ID：440745
> 
> 赞同：4
> 
> 时间：2009-01-13T20:49:31.233
> 
> 标签：java, swing

如何在 Java Swing 中创建带有标题标签的水平 JSeparator？

像这样的东西：

```
--- Title XYZ -------------------- 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-13T21:55:55.687

我找到了一个解决方案：[SwingX JXTitledSeparator](http://javadesktop.org/swinglabs/build/weekly/latest/swingx-HEAD/javadoc/org/jdesktop/swingx/JXTitledSeparator.html)。我们已经在我们的项目中使用了 SwingX。我不知道 SwingX 提供了标题分隔符。

**@Bombe**谢谢你的帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T21:00:49.183

嗯......没有任何测试，完全来自我的脑海：

```
JPanel panel = new JPanel();
panel.setBorder(new TitledBorder("Title"));
menu.add(panel); 
```

大多数 Swing 容器可以吃任何东西，这样甚至可以工作。

另一种方法是创建一个自定义组件（可能带有水平 BoxLayout）并向其添加一个 JSeparator、一个 JLabel 和另一个 JSeparator，然后将其添加到菜单中。

# sharepoint - 如何摆脱 SharePoint 中的“关闭”按钮？

> ID：440746
> 
> 赞同：0
> 
> 时间：2009-01-13T20:49:54.290
> 
> 标签：sharepoint

我需要授予用户访问某些报告历史记录（Reporting Services 快照列表，位于[http://SEVERNAME//Reports/_layouts/ReportServer/ReportHistory.aspx?list=](http://SEVERNAME//Reports/_layouts/ReportServer/ReportHistory.aspx?list=) {REPORTID} 下）的权限，但他们不应访问和导航报告图书馆这样做。链接列表可以将用户定向到报告及其报告历史记录，当他们点击“报告历史记录”页面中的“关闭”按钮时出现问题：它重定向到上层（报告库用户被'不应该看到......）有什么办法可以摆脱“关闭”（或改变它的功能）？提前谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T21:38:17.187

您可以采取的一种方法是进入 12\TEMPLATE\LAYOUTS\ReportServer 并尝试编辑 ReportHistory.aspx 以摆脱关闭链接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-17T11:02:05.827

尝试找到包含它的关闭按钮或表格单元格的唯一标识符，并添加“可见性：隐藏；” 对它隐藏用户。

不要去编辑来自 Microsoft 的开箱即用文件，否则您的共享点将处于不受支持的状态，您将面临灾难！

# c# - XslCompiledTransform 与 XslTransform 以及如何更好地衡量 OOM？

> ID：440755
> 
> 赞同：2
> 
> 时间：2009-01-13T20:51:54.847
> 
> 标签：c#, xslt, xslcompiledtransform

所以有一段时间我一直在使用 XslCompiledTransform，因为这是微软告诉我需要使用的，因为 XslTransform 已被弃用。最近我不得不将它与具有近 100,000 行的转换一起使用（当然是生成的 xsl）。当我使用我的应用程序时，我很震惊地看到一个 OOM 弹出。不管我做了什么 - OOM 就是我得到的一切......为了咯咯笑，我回到 XslTransform...... 将 XslCompiledTransform 更改为 XslTransform 的完全相同的代码，它工作正常......

谁能告诉我如何解决 OOM - XslCompiledTransform 上是否有一些“swtich”？我不知道您将如何复制确切的问题，但如果有人有任何答案，他们将不胜感激。

谢谢 - 下面的代码：

作品：

```
XslTransform myXslTransform = new XslTransform();
myXslTransform.Load(xslWith100ThousandLines);
MemoryStream m = new MemoryStream();
myXslTransform.Transform(myXPathDocument, null, m);
m.Flush();
m.Close(); 
```

OOM 失败

```
XslCompiledTransform cxslt = new XslCompiledTransform();
cxslt.Load(xslWith100ThousandLines);
MemoryStream m = new MemoryStream();
cxslt.Transform(myXPathDocument, null, m);
m.Flush();
m.Close(); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-14T13:22:27.953

好的，所以现在我想，也许这更像是“微软成为微软”……我预感将目标平台改回“任何 CPU”，关闭我所有打开的 Visual Studio 实例并重新打开我的项目……然后清理，重新编译并重新运行，我再次得到 OOM ......

然后我将目标平台设置回 x86 和低，并没有更多的 OOM！我有很多像这样的 x64 相关问题，将来我一定会在任何帖子中包含它们……通常是由于 x64 造成的……

奇怪......但问题'解决'......：S

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T20:56:53.917

起初，我认为您应该将它作为一个错误提交到 Microsoft Connect，但现在想一想，这并不是一个真正的错误。对于这么大的 XSL 文档，您很可能确实遇到了 OOM 异常。

我仍然会在那里发布它，只是因为我不希望新的 XslCompiledTransform 在 XslTransform 没有失败时失败。

如果结果文档很大，也许可以将文档保存到磁盘上的临时 FileStream 中，然后在处理文档时使用它？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T08:22:16.030

令人惊讶的是，我的印象是旧的 XslTransform 只是链接到新的 XslCompiledTransoform。

您第一次使用时收到 OOM 吗？请记住，任何已编译的内容（XslCompiledTransoform、XmlSerializer、带有 RegexOptions.Compiled 的 Regex）都会将程序集加载到您的 AppDomain 中。程序集一旦添加到 AppDomain 就无法删除。你有几个选择：

1.  将程序集加载到另一个 AppDomain 并在完成后删除该 AppDomain。这是相当复杂和困难的。这样做将允许您的应用程序释放已使用的内存。
2.  创建 XslCompiledTransforms 的缓存。永远不要再次创建转换。这种方式将允许您的应用程序抑制内存使用量的增长。您可能希望事先对 XSL 进行 (hash+base64)/校验和，并将该字符串用作字典中的键。

如果您在设计时生成该 XSLT 文件，那么检索由它创建的程序集并将其与您的应用程序而不是 XSLT 一起打包可能是值得的。如果是在运行时，您将不得不使用上面的选项 (1)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T13:16:45.517

好吧...在Windows世界中编程总是一个谜...

我感谢你们俩的回答，但是今天-在尝试复制问题时（在消失了大约 14 小时后），问题已经完全消失了……

我做的唯一不同的事情是将编译器设置为 x86 而不是 x64，现在代码完全按照我预期的方式工作，我比以往任何时候都更加困惑......

让每个人都知道我没疯，这是任务管理器连续两次运行的快照：![替代文字](https://i420.photobucket.com/albums/pp286/dovh/mem-spike.jpg)

我不确定如何或为什么...但就是这样...

# linux - 如何在linux中找到处理器队列长度

> ID：440756
> 
> 赞同：8
> 
> 时间：2009-01-13T20:52:00.027
> 
> 标签：linux, queue

尝试确定 linux 机器上的处理器队列长度（准备运行但当前未运行的进程数）。Windows 中有一个针对此指标的 WMI 调用，但对 linux 了解不多，我正在尝试挖掘 /proc 和“top”以获取信息。有没有办法确定cpu的队列长度？

编辑添加：微软关于他们的指标的话：“一个或多个准备好但由于当前正在运行的另一个活动线程而无法在处理器上运行的线程的集合称为处理器队列。”

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-13T22:39:34.880

`sar -q`将报告队列长度、任务列表长度和三个平均负载。

例子：

```
matli@tornado:~$ sar -q 1 0
Linux 2.6.27-9-generic (tornado)    01/13/2009  _i686_

11:38:32 PM   runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15
11:38:33 PM         0       305      1.26      0.95      0.54
11:38:34 PM         4       305      1.26      0.95      0.54
11:38:35 PM         1       306      1.26      0.95      0.54
11:38:36 PM         1       306      1.26      0.95      0.54
^C 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T20:57:34.697

vmstat

```
procs -----------memory---------- ---swap-- -----io---- -system-- ----cpu----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa
 2  0 256368  53764  75980 220564    2   28    60    54  774 1343 15  4 78  2 
```

第一列 (r) 是运行队列 - 我的机器上现在是 2

编辑：很惊讶没有办法只得到号码

获取数字的快速“n”脏方法（在不同的机器上可能会有所不同）：

```
 vmstat|tail -1|cut -d" " -f2 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2019-06-20T22:20:26.290

您寻求的指标存在于`/proc/schedstat`.

该文件的格式[在内核源代码中的 sched-stats.txt 中进行了描述。](https://github.com/torvalds/linux/blob/master/Documentation/scheduler/sched-stats.txt)具体来说，这些`cpu<N>`行是您想要的：

```
CPU statistics
--------------
cpu<N> 1 2 3 4 5 6 7 8 9

First field is a sched_yield() statistic:
     1) # of times sched_yield() was called

Next three are schedule() statistics:
     2) This field is a legacy array expiration count field used in the O(1)
    scheduler. We kept it for ABI compatibility, but it is always set to zero.
     3) # of times schedule() was called
     4) # of times schedule() left the processor idle

Next two are try_to_wake_up() statistics:
     5) # of times try_to_wake_up() was called
     6) # of times try_to_wake_up() was called to wake up the local cpu

Next three are statistics describing scheduling latency:
     7) sum of all time spent running by tasks on this processor (in jiffies)
     8) sum of all time spent waiting to run by tasks on this processor (in
        jiffies)
     9) # of timeslices run on this cpu 
```

特别是字段 8。要查找运行队列长度，您将：

1.  观察每个 CPU 的字段 8 并记录值。
2.  等待一段时间。
3.  再次观察每个 CPU 的字段 8，并计算该值增加了多少。
4.  [根据Little's Law](https://en.wikipedia.org/wiki/Little%27s_law) ，将该差异除以等待的时间间隔的长度（文档说它以 jiffies 为单位，但[实际上是自添加 CFS 以来以纳秒为单位](https://unix.stackexchange.com/q/418773/33203)），得出调度程序运行队列在该时间间隔内的平均长度。

不幸的是，我不知道有任何实用程序可以自动执行此过程，这些实用程序通常安装甚至打包在 Linux 发行版中。我没有使用它，但内核文档建议[http://eaglet.rain.com/rick/linux/schedstat/v12/latency.c](http://eaglet.rain.com/rick/linux/schedstat/v12/latency.c)，不幸的是它指的是一个不再可解析的域。幸运的是，它[在返程机](https://web.archive.org/web/20161013145518/http://eaglet.rain.com/rick/linux/schedstat/v12/latency.c)上可用。

* * *

为什么不呢`sar`？`vmstat`

这些工具报告当前可运行进程的数量。当然，如果这个数字大于 CPU 的数量，它们中的一些肯定在等待。但是，即使进程数少于 CPU 数，进程仍可能处于等待状态，原因有很多：

*   一个进程可能被固定到一个特定的 CPU。
*   调度程序可能决定在特定 CPU 上调度进程以更好地利用缓存，或者出于 NUMA 优化的原因。
*   调度程序可能故意让 CPU 空闲，以便为另一个共享相同执行核心的 CPU 上的竞争、更高优先级进程留出更多时间（超线程优化）。
*   由于各种硬件和软件原因，硬件中断可能只能在特定 CPU 上处理。

此外，可运行进程的数量仅在瞬间采样。在许多情况下，这个数字可能会迅速波动，并且在度量被采样的时间之间可能会发生争用。

这些东西意味着可运行进程的数量减去 CPU 的数量并不是 CPU 争用的可靠指标。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T20:55:36.680

`uptime`将为您提供最近的平均负载，这大约是活动进程的平均数。`uptime`报告过去 1、5 和 15 分钟的平均负载。这是每个系统的测量，而不是每个 CPU。

不确定 Windows 中的处理器队列长度是多少，希望它足够接近这个吗？

# asp.net-mvc - 存储库模式 - MVC 店面

> ID：440757
> 
> 赞同：5
> 
> 时间：2009-01-13T20:52:03.227
> 
> 标签：asp.net-mvc, linq, repository-pattern

一直在查看 MVC 店面，发现 IQueryable 是从存储库类返回的。想知道您是否不使用 LINQ，返回该对象是否有意义？在 LINQ 的情况下，由于延迟执行，因此在服务层中添加过滤是有意义的，但如果您不使用 LINQ，则在许多情况下您会希望在 DB 中进行过滤。在这种情况下，我是否只需将执行过滤的方法添加到存储库？如果我这样做了，服务层真的有用吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T20:56:18.413

任何一种方式都可以进行论证，请参阅最近的博客文章：[我的存储库是否应该公开 IQueryable？](http://mikehadlow.blogspot.com/2009/01/should-my-repository-expose-iqueryable.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T21:20:23.807

Rob Conery 放入 MVC Storefront 的 IQueryable 内容是创新的，但在创建存储库时绝不是标准。通常，存储库负责将您的域映射到数据库和从数据库映射。返回 IQueryable 并不真正执行任何映射，而是依赖服务层来执行此操作。这有其优点和缺点，但足以说明这不是唯一的方法。

但是，您会注意到，由于所有重复的代码，您的服务最终会变得有点臭。例如，如果您只想获取数据库中所有用户的列表，则必须在存储库和服务层中定义该函数。然而，服务层的亮点在于一个操作需要多个进出数据库的事务。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-13T21:30:52.117

将 IQueryable 暴露给服务层时我遇到的问题是，如果您想在不破坏服务层代码的情况下将存储库层包装在 Web 服务后面，那么您就不能，如果不使用[ADO.NET 数据服务](http://msdn.microsoft.com/en-us/data/bb931106.aspx)，那么您的所有存储库代码本质上将变得多余。

虽然我认为它对于小型应用程序可能非常有效，但当您开始考虑扩展和分发时，它的弊大于利。

# encryption - openssl 命令行问题

> ID：440762
> 
> 赞同：5
> 
> 时间：2009-01-13T20:55:13.843
> 
> 标签：encryption, outlook, openssl

编辑：还没有解决我的问题，但我已经转向新的更令人兴奋的问题。
把这个留在这里，以防有人有洞察力，这将有助于将来偶然发现这个问题的人。

嗨，我正在尝试将加密的电子邮件从 php 发送到 Outlook。因此，我需要生成一个证书以导入到 Outlook 中。我使用 openssl 和附带的 CA.pl 脚本生成一组密钥没有问题，但是当我尝试运行命令生成 PKCS12 文件以导入到 Outlook 中时，它抱怨缺少“demoCA”目录。看来这个目录是openssl的一部分，并在openssl配置中被引用......但我不知道它在哪里。我已经以多种方式搜索了驱动器，从 grep 到聚光灯（在 os x 上，虽然我真的没想到聚光灯能找到任何东西），但什么也想不出来。

我试图运行的命令是：

```
$ openssl ca -cert newcert.pem -ss_cert newcert.pem
Using configuration from /sw/etc/ssl/openssl.cnf
./demoCA/private/cakey.pem: No such file or directory trying to load CA private key
19918:error:02001002:system library:fopen:No such file or directory:bss_file.c:245:fopen('./demoCA/private/cakey.pem','r')
19918:error:20074002:BIO routines:FILE_CTRL:system lib:bss_file.c:247: 
```

在加密/ SSL 方面我有点菜鸟，所以我可能会遗漏一些愚蠢的东西（我敢肯定，哈哈）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T21:33:00.973

您应该通过提供的脚本创建一个新的 CA，这比处理所有 openssl 选项更容易。您可以通过在 Windows 本身中与 Cygwin 捆绑的 openssl 或使用您最喜欢的 Unix 发行版来做到这一点。我将向您展示如何使用 bash 脚本（但 perl 脚本应该相同）。

```
$ ./CA.sh -newca 
```

这将创建 demoCA 目录，其中包含 CA 证书。当您调用上述命令时，您将收到有关 CA 证书（CN、OU 等）和 CA 私钥密码的字段的提示。

现在您可以从证书请求创建证书请求或证书。

```
$ ./CA.sh -newreq 
```

这会提示输入新的证书请求字段和密码来加密生成的私钥。默认情况下，请求保留在与 CA.sh (newreq.pem) 相同的目录中。使用您拥有的电子邮件地址作为 CN（通用名称）非常重要。

现在您只需要签署它，您就拥有了完整的证书。

```
$ ./CA.sh -sign 
```

这将生成 newcert.pem 这是签名的证书请求。您拥有证书，只需将证书和私钥打包到 Microsoft CSP 可识别的 PFX 或 P12 文件中。

然后将 newreq.pem 和 newcert.pem 的内容复制到一个文件中。

```
$ cat newreq.pem > keypair.pem
$ cat newcert.pem >> keypair.pem 
```

现在通过 openssl shell 生成 P12 文件（这次我们没有任何脚本的帮助）。它将提示您输入生成请求时使用的密码，然后是导出密码（用于加密 p12 文件中的私钥）。

```
$ openssl pkcs12 -export -in keypair.pem  -out mykeypair.p12
Enter pass phrase for keypair.pem:
Enter Export Password:
Verifying - Enter Export Password: 
```

等等瞧。您有一个 PKCS#12 文件，您可以在 Windows 中双击该文件并将其导入您的密钥库并将其用作邮件签名证书（我不记得默认选项是否足够，或者您在创建证书，以便 Outlook 将其识别为电子邮件签名证书）。您还需要将 CA 证书作为受信任的 CA 导入（将 cacert.pem 复制到 demoCA 目录中的 cacert.cer 并双击它以导入）。

# movabletype - 我怎样才能删除活字的侧边栏？

> ID：440770
> 
> 赞同：1
> 
> 时间：2009-01-13T20:58:10.373
> 
> 标签：movabletype

我正在用活字建造一个新的一面。我想删除几页的侧边栏，但不是所有页面。

任何的想法？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T21:04:18.443

在存档模板 -> 页面中

`<mt:Var name="hide_sidebar" value="1">`

谢谢

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-21T01:25:49.573

更深入的回答......

此代码将变量设置`hide_sidebar`为`1`：

```
<mt:Var name="hide_sidebar" value="1"> 
```

经典博客模板集中的侧边栏包含在以下条件代码中，如果`hide_sidebar`设置为则没有输出`1`：

```
<mt:Unless name="hide_sidebar">
    <!-- sidebar code here -->
</mt:Unless> 
```

此解决方案可以手动添加到任何模板集中，但此代码可以在 MT 4.x 附带的 Classic Blog 模板集中找到。

更多关于[MT If 条件](http://movabletype.org/tag/if)以及与 unless 条件相关的信息

（我无法链接到任何其他资源，因为我需要更多的声望点。）

# sql - 在 T-SQL 中，数字而不是 int 有什么理由吗？

> ID：440779
> 
> 赞同：16
> 
> 时间：2009-01-13T21:01:02.177
> 
> 标签：sql, database, oracle, tsql, types

为什么有人会对简单的整数 ID 列使用 numeric(12, 0) 数据类型？如果你有一个比 int 或 bigint 更好的理由，我想听听。

我们没有对此列进行任何数学运算，它只是一个用于外键链接的 ID。

我正在编制一份关于产品的编程错误和性能问题的列表，我想确定他们没有出于某种逻辑原因这样做。如果您点击此链接：http: [//msdn.microsoft.com/en-us/library/ms187746.aspx](http://msdn.microsoft.com/en-us/library/ms187746.aspx)

...您可以看到 numeric(12, 0) 使用 9 个字节的存储空间并限制为 12 位数字，如果包含负数，则总共有 2 万亿个数字。当一个人可以使用 bigint 并获得 1000 万倍的数字而少一个字节的存储空间时，为什么还要使用它。此外，由于它被用作产品 ID，因此标准 int 的 40 亿个数字已经绰绰有余。

所以在我拿起火炬和音叉之前——告诉我他们会说些什么来为他们辩护？

不，我不是无中生有，软件中有数百个这样的问题，这一切都导致了巨大的性能问题并在数据库中占用了太多空间。我们为这个废话支付了超过一百万美元......所以我很认真地对待它。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-14T01:32:28.073

也许他们习惯与 Oracle 合作？

包括整数在内的所有数字类型都被规范化为所有平台之间的标准单一表示。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-13T21:10:46.120

使用数字有很多原因 - 例如 - 财务数据和其他需要精确到某些小数位的东西。但是，对于您上面引用的示例，一个简单的 int 就可以了。

也许是不知道如何设计数据库的马虎程序员？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T21:17:34.827

在您太认真之前，该项目的每行或每行集的数据存储要求是什么？

您的观察是正确的，但是如果您将存储空间从 5000 字节减少到 4090 字节，您可能不想过于强烈地呈现它。

您不想通过提出这一点并让他们指出任何可衡量的节省都可以忽略不计来破坏您的信誉。（“当然，我们许多经验不足的员工也犯了同样的错误。”）

你能填补这些空白吗？

```
with the data type change, we use
    ____ bytes of disk space instead of ____
    ____ ms per query instead of ____
    ____ network bandwidth instead of ____
    ____ network latency instead of ____ 
```

那种东西会给你带来可信度。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-13T21:45:34.130

您正在研究的这个应用程序有多长时间了？

在 SQL Server 2000 之前没有 bigint。也许它只是让它从发布到发布多年而没有被更改的东西，或者数据库模式是从这么旧的应用程序中复制的？！？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T21:02:42.987

在您的示例中，我想不出您不使用 INT 的任何合乎逻辑的原因。我知道数字的其他用途可能有原因，但在这种情况下不是。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T21:10:15.200

根据：[http ://doc.ddart.net/mssql/sql70/da-db_1.htm](http://doc.ddart.net/mssql/sql70/da-db_1.htm)

> **十进制**
> 
> 修复了从 -10^38 -1 到 10^38 -1 的精度和刻度数字数据。
> 
> **数字**
> 
> 十进制的同义词。
> 
> **整数**
> 
> 从 -2^31 (-2,147,483,648) 到 2^31 - 1 (2,147,483,647) 的整数（整数）数据。

不可能知道他们是否有理由使用十进制，因为我们没有代码可以查看。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-13T21:11:32.873

在某些数据库中，使用小数（10,0）会创建一个占用较少空间的压缩字段。我知道我的工作周围有很多桌子都在使用它。他们可能在这里有同样的想法，但是您已经查看了文档并证明这是不正确的。很有可能，我会说它会归结为“我们一直这样做的方式，因为有人曾经说过它更好”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-13T21:32:26.857

他们可能会在 MS Access 中花费大量时间并经常看到“数字”并且只是想通了，它是一个数字，为​​什么不使用数字呢？

根据您的发现，听起来他们不是优化专家，只是不知道。我想知道他们是否使用了模式生成工具并且过于依赖它们。

我想知道与纯整数值相比，主键的十进制值索引（即使设置了 0 刻度）的效率如何。

就像 Mark H. 所说，除了索引因素之外，这种特殊情况可能不会使数据库增长太多，但是如果您正在寻找弹药，我认为您确实找到了一些可以贬低它们的东西。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-25T20:03:48.127

在您的引文中，小数点显示 1-9 的精度为使用 5 个字节。您的列显然有 12,0 - 使用 4 个字节的存储空间 - 与整数相同。

此外，INT，数据类型可以达到 31 的幂：-2^31 (-2,147,483,648) 到 2^31-1 (2,147,483,647)

虽然小数比 38 大得多： - 10^38 +1 到 10^38 - 1

因此，软件创建者实际上在使用相同数量的存储空间时提供了更多。

现在，在排除了基础知识之后，软件创建者实际上将自己限制为 12 个数字或 123,456,789,012（只是占位符的示例，不是最大数字）。如果他们使用 INT，他们将无法缩放此列 - 它将上升到完整的 31 位数字。也许出于商业原因将此列和相关列限制为 12 位。

INT 是 INT，而 DECIMAL 是标量。

希望这可以帮助。

PS：整数参数是：A）整数是 0..infinity B）计数（自然）数字是 1..infinity C）整数是无穷大（负）..无穷大（正） D）我不会引用 WikiANYTHING为了任何东西。来吧，使用真实的来源！也可以是[http://MyPersonalMathCite.com](http://MyPersonalMathCite.com)

# java - junit & java : 测试非公共方法

> ID：440786
> 
> 赞同：108
> 
> 时间：2009-01-13T21:03:25.090
> 
> 标签：java, unit-testing, testing, junit

JUnit 只会测试我的类中那些公开的方法。我如何对那些不受保护的（即私有的、受保护的）进行junit测试？

我可以不使用 junit 来测试它们，但我想知道 junit 标准方法是什么。

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-01-13T21:09:28.527

一种关于单元测试的思想流派说，您应该只能测试公共方法，因为您应该只对公共 API 进行单元测试，并且通过这样做，您应该覆盖非公共方法中的代码。你的旅费可能会改变; 我发现有时是这样，有时不是。

话虽如此，有几种方法可以测试非公共方法：

*   您可以通过将单元测试与它们正在测试的类放在同一个包中来测试受保护的和包范围的方法。这是一种相当普遍的做法。
*   您可以通过创建被测类的子类来测试另一个包中的单元测试中的受保护方法，该子类将您要测试的方法覆盖为公共方法，并让这些被覆盖的方法使用 super 关键字调用原始方法。通常，这个“测试子类”将是执行测试的 JUnit TestCase 类中的一个内部类。在我看来，这有点 hacky，但我已经做到了。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-01-13T21:09:32.910

与许多单元测试问题一样，测试私有方法实际上是变相的设计问题。与其尝试做任何棘手的事情来测试私有方法，当我发现自己希望为私有方法编写测试时，我会花一点时间问自己，“我需要如何设计它，以便我可以通过公共方法彻底测试它？”

如果这不起作用，JUnitX 允许测试私有方法，尽管我相信它仅适用于 JUnit 3.8。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-01-13T21:42:20.083

当您编写 JUnit 测试时，您必须做一个微妙的思维转变：“我现在是我自己班级的客户。” 这意味着私有是私有的，您只测试客户端看到的行为。

如果该方法真的应该是私有的，我会认为它是一个设计缺陷，只是为了测试而使其可见。您必须能够根据客户看到的情况推断其正确操作。

自从我最初写这篇文章以来的三年里，我开始使用 Java 反射稍微不同地处理这个问题。

肮脏的小秘密是，您可以使用反射在 JUnit 中测试私有方法，就像测试公共方法一样。您可以随心所欲地进行测试，但仍然不会将它们公开给客户。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-13T21:07:17.983

最简单的解决方案是将 JUnit 测试放在同一个包（但不同的目录）中，并对方法使用默认（即包私有）可见性。

另一种更复杂的方法是使用反射来访问私有方法。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-13T21:12:05.993

如果您在相对较少的“公共”入口点下隐藏了大量逻辑，那么您可能违反了[单一职责原则](http://en.wikipedia.org/wiki/Single_responsibility_principle)。如果可能，您将希望将代码重构为多个类，最终导致更多的“公共”方法可供测试。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-01-13T22:22:56.833

这是其他人一直在抱怨你的“可能不应该这样做”的方法。不过，我认为这样做肯定是有理由的。以下代码将访问私有字段，但私有方法的代码几乎相同。

```
public void testPrivateField() throws InterruptedException {
    Class<ClassWPrivateField> clazz = ClassWPrivateField.class;
    try {
        Field privateField = clazz.getDeclaredField("nameOfPrivateField");
        privateField.setAccessible(true); // This is the line
        // do stuff
    } catch(NoSuchFieldException nsfe) {
        nsfe.printStackTrace();
        fail();
    } catch(IllegalAccessException iae) {
        iae.printStackTrace();
        fail();
    }

} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-13T21:31:16.873

我几乎总是在我的 Java 项目中使用 Spring，因此，我的对象是为依赖注入而构建的。它们往往是在应用程序上下文中组装的公共接口的相当精细的实现。因此，我很少（如果有的话）需要测试私有方法，因为类本身足够小，根本不是问题。

即使我不使用 Spring，我也倾向于采用相同的做法，将小而简单的对象组装成越来越大的抽象，每个抽象都相对简单，但由于聚合对象而变得复杂。

根据我的经验，需要对私有方法进行单元测试表明您正在测试的内容可以（并且应该）被简化。

也就是说，如果你仍然真的觉得有必要：

*   受保护的方法可以通过子类进行测试；
*   包私有方法可以通过将单元测试放在同一个包中进行测试；和
*   私有方法可以通过提供例如包私有工厂代理方法进行单元测试。不理想，但私人确实意味着私人。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-13T21:41:05.077

您通常不测试私有方法，因为它们只能（通常）通过另一个公共方法间接测试。当您测试驾驶并制作私有方法时，它们通常是“提取方法”重构的结果，并且已经间接测试过。

如果您担心使用大量逻辑测试私有方法，那么您可以做的最聪明的事情就是将该代码移动到公共方法中的另一个类中。完成此操作后，使用此代码的先前方法可以通过存根或模拟提供的功能来简化测试。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-13T22:18:16.687

我遇到了同样的问题，并且“如果它需要私有，它可能应该被重构”并不适合我。

假设您有某种功能要以某种方式在类内部分离出来。例如，假设我有这样的事情：

```
public class HolderOfSomeStrings{

    private List<String> internal_values;

    public List<String> get()
    {
       List<String> out = new ArrayList<String>();
       for (String s:internal_values)
       { 
           out.add(process(s));
       }
      return get;
    }

   private static String process(String input)
   {
     //do something complicated here that other classes shouldn't be interested in
    }

} 
```

这里的重点是 junit 迫使我公开进程，或者至少是受保护的，或者把它放在它自己的实用程序类中。但是，如果它是 HolderOfSomeStrings 的某种内部逻辑，我根本不清楚这是正确的——在我看来，这应该是私有的，并且以某种方式使其更明显会混淆代码。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-14T06:12:35.950

借用 Andy Hunt 的想法，即使您的私有方法也必须有一些您感兴趣的副作用。换句话说，它们必须从某个公共方法调用并执行一个有趣的任务，从而导致您的对象状态发生变化. 测试该状态变化。

假设您有公共方法 pubMethod 和私有方法 privMethod。当您调用 pubMethod 时，它会依次调用 privMethod 来执行任务（可能解析字符串）。pubMethod 然后使用这个解析的字符串以某种方式设置成员变量的值或影响它自己的返回值。通过观察对 pubMethod 的返回值或成员变量（可能通过使用访问器获取它们）的预期效果进行测试。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-08-26T06:18:27.600

> DP4j 罐子

为了测试私有方法，我们需要使用反射及其在所有答案中的指向。

现在这个任务在 [Dp4j](http://www.dp4j.com/) jar 的帮助下得到了简化。

*   Dp4j 分析您的代码并自动为您生成反射 API 代码。

*   只需将 dp4j.jar 添加到您的 CLASSPATH。

*   Dp4j.jar 包含注释处理器，它们将在您的代码中查找使用 @Test JUnit 注释进行注释的方法。

*   dp4j 分析这些方法的代码，如果发现您非法访问私有方法，它将用使用 Java 反射 API 的等效代码替换您无效的私有方法引用。

[在此处](http://www.dp4j.com/testscript.html)获取更多详细信息

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-08-18T14:41:33.017

您可以使用 TestNG 而不是 JUnit，它不关心方法是私有的还是公共的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-04-11T08:08:36.133

如上所述使用反射来测试私有方法。如果我们遵循 TDD，我们应该测试私有方法，因为 TDD 意味着以后不会有意外。所以一个人不应该等待完成他的公共方法来测试私人。这有助于在重构时进行更细粒度的回归测试。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-13T21:05:41.077

寻找“PrivateAccessor.invoke”。我的代码从“junitx.util”导入它，但我不知道它来自哪里。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-13T22:13:45.883

几乎同意每一篇文章——你可能应该重构并且可能不测试私有，除非通过公共，只是想添加一种不同的方式来思考它......

将您的类本身视为“单元”，而不是方法。您正在测试该类，并且无论如何调用它的公共方法，它都可以保持有效状态。

调用私有方法会破坏封装并实际上使测试无效。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-09-03T20:11:28.840

作为这种情况的一种分支，我不确定每个人都对整个“多语言编程”问题的看法，但是 Groovy 测试可以在 Junit 中运行，并且忽略整个公共/非公共问题。旁注，它被官方归类为“错误”，但当他们试图修复它时，掀起了一场风暴，以至于它被放回了原来的样子。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-05-28T00:57:48.047

我完全同意@duffymo 的观点，即应该从客户的角度来测试代码（尽管他说他不再这么想了）。但是，从这个角度来看，private vs others 有不同的含义。私有方法的客户端是类本身，所以我更喜欢通过外部（公共/包保护）API 测试它们。但是，受保护的和受包保护的成员是为外部客户端而存在的，所以我用继承自有类或驻留在同一个包中的假货来测试它们。

# asp.net - linq2sql 可以在没有大量自定义代码的情况下做到这一点吗？

> ID：440788
> 
> 赞同：2
> 
> 时间：2009-01-13T21:04:12.763
> 
> 标签：asp.net, vb.net, linq-to-sql, orm

在多年滚动我自己的 SQL Server DB 访问例程之后，我只是将我的脚趾浸入 Linq2sql 项目。

在我花太多时间弄清楚如何使 linq2sql 表现得像我以前的自定义代码之前，我想检查以确保它不是已经“内置”的行为，我可以通过在其中设置关系来使用它设计师...

非常简单的例子：

我有两个表：Person 和 Notes，具有一对多关系（1 Person，许多笔记），由 Person.ID->Note.PersonID 链接。

我有一个存储过程（所有数据访问都是通过 SP 完成的，我计划继续这样做），这使 Link2SQL 对我来说更有用。

**sp_PersonGet(@ID int)**返回人员记录，**sp_PersonNotesGet(@PersonID)**返回此人员的一组相关注释。

到目前为止一切顺利，我有一个目标：

```
Dim myPerson As Person = db.PersonGet(pnID).Single

```

我可以访问我的字段：myPerson.Name、myPerson.Phone 等。

我也可以做一个

```
将 myNotes 调暗为 Notes = db.PersonNotesGet(pnID) 

```

得到一组笔记，我可以遍历这个列表，比如：

```
对于 myNotes 中的每个 N 作为注释
  （ 做点什么）
下一个

```

这一切都很好......但是......我更喜欢的是，如果我打电话：

```
  myPerson = db.PersonGet(pnID)

```

我也最终得到了一个 myPerson.Notes 集合，我可以遍历它。

```
对于 myPerson.Notes 中的每个 N 作为注释
  （ 做点什么）
下一个

```

基本上，每次创建 Person 记录时，Linq2SQl 都需要调用 2 个存储过程......

这是可行的“开箱即用”，还是我需要自己编写代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T21:10:19.070

这通常是我们所说的子集合，它们可以是预先加载或延迟加载的。阅读这些：

[http://davidhayden.com/blog/dave/archive/2009/01/08/QuickExamplesLINQToSQLPerformanceTuningPerformanceProfilingORMapper.aspx](http://davidhayden.com/blog/dave/archive/2009/01/08/QuickExamplesLINQToSQLPerformanceTuningPerformanceProfilingORMapper.aspx)

[http://www.thinqlinq.com/default/Fetching-child-records-using-Stored-Procedures-with-LINQ-to-SQL.aspx](http://www.thinqlinq.com/default/Fetching-child-records-using-Stored-Procedures-with-LINQ-to-SQL.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T21:12:50.703

它使用部分类。您可以将自己的“Notes”属性添加到您的 Person 类中，并在它的 GETter 函数中对其进行初始化。这比每次加载人员记录时都填充注释要好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T21:13:59.093

我相信你可以或多或少地做到这一点，虽然我没有尝试过——我不使用 LINQ 的存储过程。您需要做的是将插入/删除/更新方法从使用运行时更改为使用存储过程。然后，您将在两个实体表之间创建关联，该关联将在 Person 类上创建 Notes 的 EntitySet，在 Notes 类上创建 Person 的 EntityRef。您可以将其设置为自动加载或使用延迟加载。

据我所知，唯一棘手的一点是从使用运行时生成的方法到使用存储过程的变化。我相信您必须将它们作为方法添加到数据上下文中（通过将其从设计器中的服务器资源管理器中拖放到您的表中），然后才能使用它。

# html - 验证 HTML

> ID：440797
> 
> 赞同：0
> 
> 时间：2009-01-13T21:07:54.707
> 
> 标签：html, w3c-validation

我是 HTML 和 CSS 的初学者。我刚刚设计了网站并尝试验证，但我的 HTML 最终有一些“geovisit();” 它不会验证。我不知道如何摆脱它。帮我？谢谢客人

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-13T21:17:23.377

在 Google 上快速[搜索 geovisit](http://www.google.com/search?q=geovisit)表明您的托管服务提供商正在添加非验证代码。看起来这个问题实际上可能是特定于 Yahoo! 的，它有一个禁用该“功能”的选项。我建议你阅读[这个关于这个问题的论坛帖子](http://www.velocityreviews.com/forums/t162467-yahoo-server-generated-code-wont-validate.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-25T07:49:46.140

这通常是雅虎（或其他托管服务提供商）在您不知情的情况下将 javascript 粘贴在您的页面上。在雅虎的情况下，如果您仔细研究设置，您应该能够将其关闭。

# mysql - 我如何知道 Perl DBI 查询返回多少行？

> ID：440799
> 
> 赞同：20
> 
> 时间：2009-01-13T21:08:53.940
> 
> 标签：mysql, perl, dbi

我正在尝试使用 Perl 基本上在数据库中进行搜索，以判断是否存在具有特定 ID 的项目。此搜索可以不返回任何行，但也可以返回一个。

我有以下代码：

```
my $th = $dbh->prepare(qq{SELECT bi_exim_id FROM bounce_info WHERE bi_exim_id = '$exid'});
$th->execute();
if ($th->fetch()->[0] != $exid) {
        ... 
```

基本上，这会尝试查看是否返回了 ID，如果没有返回，则继续执行脚本。但它在这个`$th->fetch()->[0]`东西上抛出了一个空数组引用错误。我怎样才能简单地检查它是否返回行或现在？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-01-13T21:44:42.260

[DBD::mysql](http://search.cpan.org/dist/DBD-mysql)驱动程序有一个可以返回结果计数的`rows()`方法：

```
$sth = $dbh->prepare( ... );
$sth->execute;
$rows = $sth->rows; 
```

这是特定于数据库驱动程序的，因此它可能在其他驱动程序中不起作用，或者在其他驱动程序中可能会有所不同。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-13T21:12:49.533

```
my $th = $dbh->prepare(qq{SELECT bi_exim_id FROM bounce_info WHERE bi_exim_id = '$exid'});
$th->execute();
my $found = 0;
while ($th->fetch()) 
{
   $found = 1;
} 
```

如果该行不存在，您的查询将不会返回任何内容，因此您无法取消引用该提取。

**更新**：您可能想将其重写为

```
my $found = $th->fetch(); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-13T23:45:48.507

你为什么不只是“选择计数（*）......”？

```
my ($got_id) = $dbh->selectrow_array("SELECT count(*) from FROM bounce_info WHERE bi_exim_id = '$exid'"); 
```

或阻止[Little Bobby Tables](http://xkcd.com/327/)：

```
my $q_exid = $dbh->quote($exid);
my ($got_id) = $dbh->selectrow_array("SELECT count(*) from FROM bounce_info WHERE bi_exim_id = $q_exid"); 
```

或者，如果您要经常执行此操作：

```
my $sth = $dbh->prepare("SELECT count(*) from FROM bounce_info WHERE bi_exim_id = ?");
....save $sth (or use prepare_cached()) and then later
my ($got_id) = $dbh->selectrow_array($sth, undef, $exid); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-13T21:24:26.203

更改选择以始终返回某些内容？这应该在 Sybase 中工作，不知道其他数据库。

```
my $th = $dbh->prepare(qq{SELECT count(*) FROM bounce_info WHERE bi_exim_id = '$exid'});
$th->execute();
if ($th->fetch()->[0]) {
....
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-13T21:59:21.467

总的来说，我不确定为什么人们如此害怕例外。你抓住他们并继续前进。

```
my $sth = prepare ...
$sth->execute;
my $result = eval { $sth->fetchrow_arrayref->[1] };

if($result){ say "OH HAI. YOU HAVE A RESULT." }
else       { say "0 row(s) returned."         } 
```

不过，在这种情况下，保罗的回答是最好的。

此外，`$sth->rows`在您获取每一行之前通常不会工作。如果您想知道有多少行匹配，那么您必须实际向数据库引擎询问您想知道答案的问题；即`select count(1) from foo where bar='baz'`.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T22:37:10.487

找出 SELECT 查询返回多少行的唯一可靠方法是全部获取并计算它们。如[DBI 文档中所述](http://search.cpan.org/~timb/DBI-1.607/DBI.pm#rows)：

> *通常，您只能在非 SELECT 执行（对于某些特定操作，如 UPDATE 和 DELETE）或获取 SELECT 语句的所有行之后依赖行计数。*
> 
> *对于 SELECT 语句，通常不可能知道将返回多少行，除非全部获取它们。一些驱动程序将返回应用程序到目前为止已获取的行数，但其他驱动程序可能会返回 -1，直到所有行都已获取。因此不推荐使用带有 SELECT 语句的 rows 方法或 $DBI::rows。*

然而，当你开始着手时，无论如何你几乎不需要提前知道这一点。只需循环`while ($sth->fetch)`处理每一行，或者对于只返回零或一行的查询的特殊情况，

```
if ($sth->fetch) {
  # do stuff for one row returned
} else {
  # do stuff for no rows returned
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-11-07T10:33:04.643

本文可能对 MySQL 8 之前版本的用户：

[http://www.arraystudio.com/as-workshop/mysql-get-total-number-of-rows-when-using-limit.html](http://www.arraystudio.com/as-workshop/mysql-get-total-number-of-rows-when-using-limit.html)

> 幸运的是，从 MySQL 4.0.0 开始，您可以在查询中使用 SQL_CALC_FOUND_ROWS 选项，这将告诉 MySQL 计算不考虑 LIMIT 子句的总行数。您仍然需要执行第二个查询才能检索行数，但它是一个简单的查询，并不像检索数据的查询那么复杂。
> 
> 用法很简单。在主查询中，您需要在 SELECT 之后添加 SQL_CALC_FOUND_ROWS 选项，在第二个查询中，您需要使用 FOUND_ROWS() 函数来获取总行数。查询将如下所示：
> 
> SELECT SQL_CALC_FOUND_ROWS 名称，来自用户的电子邮件 WHERE name LIKE 'a%' LIMIT 10;
> 
> 选择 FOUND_ROWS();
> 
> 唯一的限制是您必须在第一个查询之后立即调用第二个查询，因为 SQL_CALC_FOUND_ROWS 不会在任何地方保存行数。
> 
> 尽管此解决方案还需要两个查询，但它的速度要快得多，因为您只需执行一次主查询。
> 
> 您可以在 MySQL 文档中阅读有关 SQL_CALC_FOUND_ROWS 和 FOUND_ROWS() 的更多信息。

可悲的是，从 8.0.17 开始：

> SQL_CALC_FOUND_ROWS 查询修饰符和随附的 FOUND_ROWS() 函数自 MySQL 8.0.17 起已弃用...

详情[在这里](https://dev.mysql.com/doc/refman/8.0/en/information-functions.html)。

# apache-flex - 在 flex 数据网格中“冻结”一列

> ID：440804
> 
> 赞同：2
> 
> 时间：2009-01-13T21:10:12.283
> 
> 标签：apache-flex, datagrid, adobe, freeze, datagridcolumn

我正在使用数据网格来显示一列日期范围和几列数据。我想让第一列（日期范围）固定；即当用户滚动其他列时，该列保持原位。这样，当用户滚动浏览许多数据列时，日期列将始终可见。我没有看到这个的 datagrid 属性；有人有解决方案吗？TIA

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-13T21:13:15.023

lockedColumnCount（和lockedRowCount）很可能是您正在寻找的。

[http://livedocs.adobe.com/flex/3/langref/index.html](http://livedocs.adobe.com/flex/3/langref/index.html)

您可能没有看到它的原因是它是 DataGridBase 的一部分，而不是 DataGrid 类本身的一部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-06-29T11:07:07.717

使用锁定的列计数属性

lockedColumnCount=”1″ height=”96″ Horizo​​ntalScrollPolicy=”on”</p>

verticalScrollPolicy=”on” 宽度=”397″>

# c++ - 编写简单的 WSO2/C++ Web 服务客户端时崩溃

> ID：440827
> 
> 赞同：2
> 
> 时间：2009-01-13T21:16:30.977
> 
> 标签：c++, web-services, wso2, wso2carbon

[使用WSO2/C++ Web](http://wso2.org/projects/wsf/cpp)服务包的客户端是否能够成功运行？我已经尝试了几乎所有我能想到的东西，但每次我尝试运行一个非常简单的客户端时，我都会崩溃。这是他们的示例程序之一的一些示例代码...

```
#include <stdio.h>
#include <WSRESTClient.h>
#include <OMElement.h>
#include <iostream>
#include <AxisFault.h>
using namespace std;
using namespace wso2wsf;

int _tmain(int argc, _TCHAR* argv[])
{
 WSRESTClient * sc = new WSRESTClient("http://localhost:9090/axis2/services/echo/echoString");
    try 
    {   
        sc->initializeClient("echo_rest.log", AXIS2_LOG_LEVEL_TRACE);
    }   
    catch (AxisFault & e)
    {   
        cout << endl << "Error: " << e << endl;
        return 0;
    }
    Options * op = sc->getOptions();
    op->setHTTPMethod(AXIS2_HTTP_GET);
    sc->setOptions(op);
    {
        OMNamespace * ns = new OMNamespace("http://ws.apache.org/axis2/services/echo", "ns1");
        OMElement * payload = new OMElement(NULL,"echoString", ns);
        OMElement * child = new OMElement(payload,"text", NULL);
        child->setText("Hello World!");
        cout << endl << "Request: " << payload << endl;
        OMElement * response;
        try
        {
            response = sc->request(payload, "http://ws.apache.org/axis2/c/samples/echo/soap_action");
            if (response)
            {
                cout << endl << "Response: " << response << endl;
            }
        }
        catch (AxisFault & e)
        {
            cout << endl << "Error: " << e << endl;
        }
        delete payload;
    }
    delete sc;

    return 0;
} 
```

每次在 WRESTClient 对象构造时都会崩溃。这似乎是 WSO2 代码中某处的问题，但我没有收到任何错误消息表明确切的问题是什么。我的下一步将是针对 WSO2 的源代码进行构建，并逐步执行崩溃的代码，但我希望有人之前遇到过这个问题并有一些即时反馈。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T21:21:46.347

您是否考虑过在 WRESTClient 对象构造周围放置一个 try/catch-all 块？如果您在这条线上进行核心转储，那么它很可能会引发异常，如果您捕获它，那么您可能能够从该异常中获得更多有用的错误信息。

除此之外，是时候按照您的建议打破调试器了。

# sharepoint - 控制台应用程序 - 对象模型 - 数据库权限

> ID：440847
> 
> 赞同：1
> 
> 时间：2009-01-13T21:23:37.483
> 
> 标签：sharepoint

我正在尝试运行使用 SharePoint 对象模型的控制台应用程序。

我收到错误无法打开登录请求的数据库“dbname”。登录失败。用户 'DOMAIN\userid' 登录失败。

我读过的某个地方说用户必须拥有对内容数据库的权限。

我找不到解释要设置哪些权限的文章。我需要这个作为弹药去我的系统管理员那里获得权限设置。

哪里有文章可以解释？我搜索了谷歌，但没有运气。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T22:15:26.223

您是否在服务器本身上运行控制台应用程序？我假设是这样。

在这种情况下，很可能是您在服务器上使用的帐户（RDP？）的权限问题。事情的数据库错误方面可能会产生误导，因为您需要在 SharePoint 本身内获得许可，然后才会授予数据库权限。

我会让您的系统管理员创建一个服务帐户供您使用，该帐户可以被授予正确的权限。（通常需要网站集管理员，但这取决于控制台应用程序中的代码。虽然大多数都假定网站集管理员权限）。您可以通过查看应用程序说明获得更多信息（或者如果它是您自己的代码，请前往网站集管理员）

不过，运行控制台应用程序有点重要，因此如果您向系统管理员提供要运行的应用程序和说明，您可能会有更好的运气……尽管我怀疑您是否在产品盒上运行它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-14T08:48:41.920

您的用户可能没有访问这些列表或网站的权限。您可以使用提升的权限运行您的代码，但它有时会给您带来意想不到的结果。可以在[此处找到如何使用提升权限的示例](http://msdn.microsoft.com/en-us/library/bb466220.aspx)

或者，您可以设置帐户控制台应用程序以网站集管理员身份运行的用户 unser。

您更新后的代码以提升的权限运行，如下所示：

```
private static void DisplayAllLists(string site, string webToOpen)
{
    try
    {
       SPSecurity.RunWithElevatedPrivileges(delegate() 
       {

          using ( SPSite siteCollection = new SPSite(site) )
          {
            try
            {
                using (SPWeb web = siteCollection.OpenWeb(webToOpen))
                {
                    SPListCollection lists = web.Lists;
                    foreach (SPList list in lists)
                    {
                        Console.WriteLine(string.Format("List Title: {0}", list.Title));
                    }
                }
             }
           }
           finally
            {
                siteCollection.RootWeb.Dispose();
                Console.ReadLine();
            }
        }

    }
    catch (Exception ex)
    {
        Console.WriteLine("Exception: "+ex.Message);
    }
} 
```

注意：此代码是从我的头顶编写的，所以可能缺少某些内容..您必须尝试一下

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-19T03:06:20.773

RunWithElevatedPrivileges 没有帮助，因为它只是将线程用户更改为进程标识 - 在控制台应用程序中，这没有任何效果，因为它们是相同的。模拟 Web 上下文中的“提升”有效，因为进程身份是应用程序池帐户，其内容数据库上有 db_owner。

> 如果我要求在 Web 应用程序的策略下为我正在使用的帐户授予完全控制权，这是否可行？

根据 Ishai Sagi 的说法：[对象模型代码和 stsadm 因 "Access Denied" 而失败](http://www.sharepoint-tips.com/2007/03/object-model-code-and-stsadm-fail-with.html)。简而言之，用户在没有 Web 上下文的情况下运行对象模型代码（包括 STSADM）似乎需要内容数据库的 db_owner 权限。

# c# - 比较 Telerik 的 NHibernate 和 OpenAccess

> ID：440853
> 
> 赞同：10
> 
> 时间：2009-01-13T21:25:49.490
> 
> 标签：c#, .net, nhibernate, orm, openaccess

你用过[Telerik 的 OpenAccess ORM](http://www.telerik.com/products/orm.aspx)吗？它与 NHibernate 相比如何？我什么时候应该考虑在 NHibernate 上使用它？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-30T05:07:25.827

我自己也在想同样的事情。一方面，NH 有其免费、开源的自我，但支持选项有限。另一方面，是著名工具提供商 OA 的一个相当新的补充。

OA 需要花钱，但你会得到支持。NH 是免费的，但至少在我短暂的经验中，我们知道支持是有限的，而且进展缓慢。

我认为两者都可能是优质产品。我决定尝试 OA，因为我已经是 Telerik 工具的用户。无论如何，OA 及其支持都是有偿的。

NH 使用纯类和对象，对类属性没有任何修饰。OA 需要装饰（由 OA Visual Studio GUI 很好地生成）。

NH 需要一个“会话”来处理数据库的一个工作单元；OA 称之为“范围”。两者都使用“交易”。

OA 与 Visual Studio 集成，可以正向和反向映射到数据库。正向映射是为了让您可以设计您的类，然后将它们“推送”到数据库中以实现持久性。“反向”适用于您的“域模型”开发人员，这是我更喜欢的。

OA 肯定正在经历一些重大更新，因为 Telerik 最近收购和发布了以前由 Vanatec（德国以外）拥有的 OpenAccess，它正在“迎头赶上”。

就“易用性”和“性能/可扩展性”的观点而言，我希望我知道它们各自的立场。我敢肯定，有人可以在两者之间进行诚实的测试并做出决定。

我喜欢 NH 的一件事是可用模板生成所需的代码，不仅为“哑”业务对象（现在所有 OA 都生成），而且为 BLL 和 DLL。在与 Telerik 多次交谈后，我的印象是他们计划提供更多代码生成选项，因此 OA 开箱即用更有用。

希望这可以帮助！有人请尝试获取有关性能问题的一些统计信息。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-13T21:37:16.910

我没有使用过它，但对我来说明显的一个好处是 Telerik 支持 OpenAccess，而社区支持 nHibernate。根据您的公司，如果您准备好接受没有支持保证的开源解决方案，这可能是一个决定性因素。

# 编辑

郑重声明，我是 nHibernate 的大力支持者，并且总体上是开源的。在过去的六个月里，我一直在使用 nHibernate，将它用于我们 Web 应用程序中的所有新工作。对于我现在的公司来说，这是一个很好的选择（初创公司喜欢免费）。

但是，我以前的雇员将很难接受社区支持的组件作为其基础架构的核心部分。这是完全合理的，因为这些公司的网站是他们唯一的收入来源。您是否想将您的整个业务都押在没有相关责任的软件上？有些人不想冒这个险。

我个人发现对 nHibernate 的支持与一些商业供应商相当，甚至更好。

我的意思不是抨击 OSS，而是强调使用具有企业支持的软件的一个好处，该软件具有配备齐全的专用支持渠道。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-08-13T04:38:25.540

还有一个原因：目前OpenAccess具有更好的性能特性，如果您的项目需要快速的ORM，它将是一个更好的选择。有关详细信息，请参阅[ORM 基准](http://ormbattle.net)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T22:28:24.623

我会说 nHibernate 是免费的，而 OpenAccess 是 399 美元。尽管如果您希望 nHibernate 轻松自动化，带有 nHibernate 模板的 CodeSmith 价格为 99-399 美元。看起来 OpenAccess 在数据层中具有更高的透明度，并且可能更易于维护。但是，如果你使用像 Spring.Net 这样的东西，你不仅会让 nHibernate 自动化数据，而且服务层也会自动化。尽管对此持保留态度，因为 nHibernate 和 Spring.Net 是另一批需要维护的配置文件。我敢打赌 OpenAccess 是 GUI 友好的。任何一个都可以，但是关于 nHibernate 有更多的信息。

# asp.net - ASP.net：动态加载网页用户控件

> ID：440854
> 
> 赞同：1
> 
> 时间：2009-01-13T21:27:00.097
> 
> 标签：asp.net

当用户从菜单中选择一个项目时，我有一个带有占位符控件和菜单控件的 asp.net 网页。它将根据菜单项的值动态加载控件。

我加载了控件，但是如果我单击链接按钮或 Web 用户控件 (.ascx) 上的任何内容，则 Web 用户控件 (.ascx) 将消失。我不知道是什么原因造成的。有人可以看看我的代码，看看我缺少什么吗？

```
Protected Sub Menu1_Click(ByVal sender As Object, ByVal e As EventArgs)

    Select Case Me.Menu1.SelectedValue
        Case "CustMasterMain"
            Dim ccCustMasterMaint As UserControl = CType(Page.LoadControl("~/Controls/Franchise/CustMasterMaintControl.ascx"), UserControl)
            Me.phHolder1.Controls.Add(ccCustMasterMaint)
        Case "AcctRecInq"
            Dim ccAcctRecInq As UserControl = CType(Page.LoadControl("~/Controls/Franchise/custAccountsReceivableInquiry.ascx"), UserControl)
            Me.phHolder1.Controls.Add(ccAcctRecInq)
    End Select

End Sub 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T21:32:11.053

请记住，每次进行回发时，您都在使用页面类的全新实例。如果您将控件添加到页面类的先前实例的控件集合中，*则需要为随后的每个回发再次添加它。*

此外，如果您希望为控件恢复 ViewState，则需要在 Load 事件*之前将其添加到页面中。*这意味着在 Init 或 PreInit 期间添加控件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T21:35:57.973

Joel 是正确的，您需要在每次回发时添加控件，因此您需要一种方法来跟踪页面上存储的控件。

[动态控件占位符](http://www.denisbauer.com/ASPNETControls/DynamicControlsPlaceholder.aspx)是一个出色的控件，可帮助管理跨回发页面上的动态控件。我建议您检查一下，因为我在许多项目中都使用过它，它让我的生活变得更轻松。

# user-interface - 理想的按钮尺寸

> ID：440855
> 
> 赞同：8
> 
> 时间：2009-01-13T21:27:31.733
> 
> 标签：user-interface

我和我的同事经常争论按钮的大小。我喜欢有固定大小的按钮（即，如果最小化/最大化按钮大小不会改变，其他控件可能但不是按钮），宽度=其中的文本，高度=27 -30 像素。

我的同事更喜欢高度只有 20 像素的按钮，并且宽度会随着屏幕大小的调整而变化。也就是说，当屏幕最大化时，按钮会自行拉长。

就个人而言，我不喜欢调整大小的按钮。我想知道是否还有其他人想加入这个 UI 论点？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-13T21:39:12.380

值得一提的是，根据[Vista UX 指南](http://msdn.microsoft.com/en-us/library/aa511258.aspx)，默认按钮大小应为 14 x 50“对话框单位”（在 96dpi 显示器上约为 28 像素 x 100 像素），边距约为 11 像素。

不管你对微软公司的看法如何，我认为他们在统一的 UI 方面做得很好。如果您正在使用 Windows 应用程序，那么我认为必须遵循此指南。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-13T21:30:28.017

我投票支持不会随着表单变宽而变宽的按钮。就个人而言，我认为它只是丑陋并且使按钮更难使用，因为您的眼睛不再被其中的文本所吸引。

此外，随着 16:9 和 16:10 比例显示器的流行，这些按钮将异常宽大；）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-13T21:30:49.730

请不要调整按钮大小...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T21:32:17.887

我认为这将取决于您的应用程序中发生的其他事情。如果其他所有内容都水平调整大小，也许会有意义？

唯一确定的方法是可用性测试。让真正的用户坐下来，让他们试一试，看看他们的想法，以及他们是否感到困惑（或生气）。询问一堆开发人员和设计师只能让你到目前为止。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T21:31:34.627

重要的不是按钮的大小，而是您对按钮的操作。

如果按钮保持成比例并且它们仍然需要有一个上限，那么根据屏幕调整按钮大小就可以了 - 这通常在启动表单时完成，而不是在任何调整大小期间完成。但是，在窗口调整大小时调整按钮的大小 - 这是一个禁忌。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T21:47:41.100

在考虑需要文本标题（即不是图标类型的按钮）的按钮大小时，如果您希望对应用程序进行本地化，至少允许额外 60% 用于非英文文本总是好的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T21:49:34.857

我同意某些需要本地化应用程序的场景需要您考虑按钮大小。但是，这仍然不需要按钮宽度可以拉伸到屏幕的 75%（高度保持不变）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T22:25:22.867

可用性方面，我认为将按钮保持在一致的大小和位置是很重要的。

该按钮应该被锚定，用户不应该去寻找它。用户不应该有“哇，为什么按钮现在这么大”的时刻。记住“不要让我思考”

对我来说，这听起来像是开发人员想要调整按钮大小的时候之一，因为他们可以，而且代码很酷，而不是因为它会带来更好的用户体验。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-13T21:28:45.477

调整大小的按钮会惹恼我。

我不是设计师，但这听起来不对。

事实上，那会让我发疯，让我对你很生气。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-13T21:32:48.620

调整大小不好，IMO，但请务必将按钮锚定到适当的角落。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-13T21:33:24.140

出于各种原因，按钮不应调整大小。首先，设计和实现可调整大小的按钮将是一项艰巨的任务。对他们进行 QA 可能是一场噩梦。

其次，大部分可用性是基于模式识别的。人们在寻找信息时会寻找熟悉的概念。当您向用户展示一堆不同大小的按钮时，您可能会混淆它们；他们可能认为某些按钮比其他按钮更重要。

不过，我并不反对带有大量文本的流动按钮。有时，按钮只需要稍宽一点即可容纳文本。

话虽如此，按钮内的文本应该清晰、简洁且切中要害。如果您必须创建超宽的按钮以容纳您放入其中的句子，您需要将标签缩减为用户可以快速理解的一两个单词。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-13T21:45:02.947

如果您创建按钮，请确保文本有足够的空间。因为如果您想将文本翻译成其他语言（而非英语），您可能需要更多空间。

我们使用固定大小的按钮，但也有一些例外（只是因为我们的软件必须翻译成多种语言。），

# asp.net - ASP.NET MVC - 复杂对象和表单

> ID：440879
> 
> 赞同：3
> 
> 时间：2009-01-13T21:34:16.290
> 
> 标签：asp.net, html, asp.net-mvc, domain-driven-design

所以假设我们有一个域对象，如下所示

```
public class Person
{
   public string Name { get; set; }
   public IList<PhoneNumber> PhoneNumbers {get; set; }
   public IList<Address> Addresses { get; set; }
} 
```

在输入姓名、电话号码和地址之前，此人无效。你们如何使用 ASP.NET MVC 和表单来处理这个问题......

我在想你可以将 Person 序列化到 session 并有多个视图来编辑 Name、添加电话号码、添加地址 - 控制器操作将修改 session 中的人，最终 Save 操作将推送到数据库。

我真的不喜欢拥有多个视图和使用会话。另一种选择是拥有一个非常复杂的表单，该表单可以具有元素的“动态”部分，用于在发布到保存操作之前在浏览器中添加/删除电话号码、地址。

每个人都在用复杂的对象做什么并通过表单进行编辑？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T21:39:48.167

我通常会使用“动态部分”路线。

但是，我不会让您的验证如此严格，以至于用户无法保存正在进行的工作。电话号码、地址等列表可能需要很长时间才能输入。最终用户能够不时保存他们的工作，以防他们失去互联网连接或其他东西，这对最终用户是有益的。如果您的数据输入表单很大，不时通过 AJAX 自动保存记录可能是个好主意。（如 Gmail。）因此，您的模型应该允许他们不时保存未完成的工作，并仅在他们说“完成”时运行整个验证。

# excel - 如何从经典 ASP 输出 Excel *.xls 文件

> ID：440892
> 
> 赞同：10
> 
> 时间：2009-01-13T21:38:40.183
> 
> 标签：excel, web-applications, asp-classic

我有许多生成的 html 表，我需要将它们输出为 Excel 文件。该网站是用经典的 ASP 编码的。这可能吗？可以通过某种方式使用 Open Office 库来完成吗？

* * *

编辑：到目前为止，我已经尝试了一些建议，但似乎失败了。理想情况下，我希望用户能够单击将开始下载 .xls 文件的链接。这段代码：

```
<%@ Language=VBScript %>
<%  option explicit

Response.ContentType = "application/vnd.ms-excel"
Response.AppendHeader "content-disposition", " filename=excelTest.xls"
%>
<table>
    <tr>
        <th>Test Col 1</th>
        <th>Test Col 2</th>
        <th>Test Col 3</th>
        <th colspan="2">Test Col 4</th>
        <th>Test Col 6</th>
        <th>Test Col 7</th>
    </tr>
    <tr>
        <td>Data</td>
        <td>Data</td>
        <td>Data</td>
        <td>Data</td>
        <td>Data</td>
        <td>Data</td>
        <td>Data</td>
    </tr>
</table> 
```

使用 IE7 获取页面时似乎失败。IE 说它“无法下载 excelTest.asp”并且“请求的站点不可用或找不到”。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-27T14:17:47.910

它是 AddHeader，而不是 AppendHeader。

```
<%@ Language=VBScript %>
<%  Option Explicit

Response.ContentType = "application/vnd.ms-excel"
Response.AddHeader "Content-Disposition", "attachment; filename=excelTest.xls"
%>
<table>
    <tr>
        <td>Test</td>
    </tr>
</table> 
```

**更新：** 我写了一篇关于如何[在 ASP Classic 中生成 Excel 文件](http://www.crydust.be/blog/2009/03/02/generate-excel-files-in-asp-classic/)的博文。它包含一段相当有用的代码来生成 xls 和 csv 文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-20T21:10:07.850

MS 制作了一个名为 Office Web Components 的 COM 库来执行此操作。MSOWC.dll 需要在服务器上注册。它可以创建和操作办公文档文件。

[如何在 Visual Basic 中使用电子表格 Web 组件](http://support.microsoft.com/kb/235883/EN-US/)

[使用 Office Web 组件](http://msdn.microsoft.com/en-us/library/aa198515(office.10).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T21:48:02.393

您始终可以将 HTML 表格导出到 XLS 文档。Excel 在理解 HTML 表格方面做得很好。

另一种可能是将 HTML 表导出为 CSV 或 TSV 文件，但您需要在代码中设置格式。这并不太难实现。

Microsoft.Office.Interop 中有一些类允许您以编程方式创建 Excel 文件，但我一直发现它们有点笨拙。[您可以在此处找到创建电子表格](http://www.dynamicajax.com/fr/Creating_Excel_From_VB_DOT_NET-197_209_329.html)的 .NET 版本，对于经典 ASP，它应该很容易修改。

至于 .NET，我一直很喜欢[CarlosAG 的 Excel XML Writer Library](http://www.carlosag.net/Tools/ExcelXmlWriter/)。它有一个很好的生成器，因此您可以设置您的 Excel 文件，将其保存为 XML 电子表格，它会生成代码来执行所有格式设置和所有操作。我知道这不是经典的 ASP，但我想我会把它扔掉。

* * *

使用您在上面尝试的内容，尝试添加标题：

```
"Content-Disposition", "attachment; filename=excelTest.xls" 
```

看看这是否有效。此外，我总是将其用于内容类型：

```
 Response.ContentType = "application/octet-stream"
    Response.ContentType = "application/vnd.ms-excel" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T23:33:26.347

我用过一个“便宜又肮脏”的把戏……嘘，别告诉任何人。如果您输出制表符分隔的文本并将文件名设为 *.xls，则 Excel 将打开它而不会提出异议、问题或警告。因此，只需将数据转换为带有制表符分隔的文本文件，您就可以使用 Excel 或 Open Office 打开它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T16:49:37.737

您必须在 http 标头中指定客户端要下载的文件（附件）：

```
Response.ContentType = "application/vnd.ms-excel"
Response.AppendHeader "content-disposition", "attachment: filename=excelTest.xls" 
```

[http://classicasp.aspfaq.com/general/how-do-i-prompt-a-save-as-dialog-for-an-accepted-mime-type.html](http://classicasp.aspfaq.com/general/how-do-i-prompt-a-save-as-dialog-for-an-accepted-mime-type.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-15T01:51:15.673

在添加 Response.Buffer = False 之前，我遇到了同样的问题。尝试将代码更改为以下内容。

Response.Buffer = False Response.ContentType = "application/vnd.ms-excel" Response.AddHeader "Content-Disposition", "attachment; filename=excelTest.xls"

我现在唯一的问题是，当 Excel 打开文件时，我收到以下消息。

您尝试打开的文件“FileName[1].xls”与文件扩展名指定的格式不同。在打开文件之前，请确认文件没有损坏并且来自受信任的来源。您现在要打开文件吗？

当您打开文件时，数据全部显示在单独的列中，但电子表格全为白色，单元格之间没有边框。

希望有帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-05-07T14:13:08.317

XLS 文件不是真正的 Excel 文件。该代码创建一个扩展名为 .an xls 的 HTML 文件。当您尝试使用记事本打开 XLS 文件时，您可以看到 HTML 代码。

# .net - .NET - 如何获取有关程序错误的更多信息？错误：“线程 0x566967f6 已退出，代码为 0 (0x0)”

> ID：440896
> 
> 赞同：0
> 
> 时间：2009-01-13T21:39:20.603
> 
> 标签：.net, email, sockets, windows-mobile, compact-framework

也许你能帮我...

我正在 Windows Mobile 中编写一个连接到邮件服务器并从 POP3 服务器检索数据的程序。[我正在使用可从此处](http://www.udaparts.com/document/articles/demome.htm)获得的第三方（免费）套接字。我正在使用 VS 2008（在 VB.NET 中）和设备模拟器。

我可以毫无问题地连接并执行我的各种命令（例如登录、STAT、LIST、TOP）。但是，当我使用 RETR 命令下载电子邮件时，我会在一段时间后收到一个我无法追踪的错误。如果我检索一封简短的电子邮件，它通常会毫无问题地下载数据。但是，如果我尝试检索带有附件（需要传输更多字节）的电子邮件，我通常会收到一个接近 70-80,000 字节的“错误”。但是，在我的真实设备上运行应用程序时，我仍然会收到错误，但通常会接近 400-500,000，尽管有时会更早。

在桌面上运行此应用程序（相同的第三方套接字但另一个 .dll）可以正常工作。我可以轻松下载巨大的附件。我怀疑它与网络问题有关——例如，使用 Pocket Outlook 从同一邮件服务器下载带有附件的电子邮件。

该错误不会在调试模式下显示 - 我的意思是代码不会在某一行停止。我在我的代码中也插入了一个 Try-Catch，但没有显示错误。但是，使用调试输出窗口，我注意到过了一会儿出现了一行，上面写着：“线程 0x566967f6 已退出，代码为 0 (0x0)”。

我相信这个问题与 DLL 库（这是一个基于 ATL 的 COM 库）有关，或者更可能是我对这个库的编码方式，但在写给他们之前，我想看看我是否可以找到这个库的问题以及为什么它可能会导致我的错误/问题。这样，当我写信给他们时，我可以提供更多的信息。所以，我只是想知道在 VS 2008 中是否有办法让我获得有关我的问题/错误的更多信息？谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T21:53:34.753

退出代码 0 表示没有发生错误并且线程正常终止。如果它不应该终止，请尝试找出它可以在什么条件下终止，并找出哪个条件允许线程过早退出。

我能想到为什么这可能发生在移动设备而不是桌面上的唯一原因与缓冲区有关。我的猜测是，更小、更慢的设备难以跟上传入数据的速度，因此缓冲区被覆盖。

# c# - 如何让我的 .net 程序在运行时编译 C# 代码？

> ID：440897
> 
> 赞同：4
> 
> 时间：2009-01-13T21:39:20.853
> 
> 标签：c#, .net, compiler-construction, runtime

我见过几个 .net 应用程序，它们允许您选择 C# .cs 源文件，程序本身将编译并运行此代码。

这是怎么做到的？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-13T21:42:19.740

它可能使用 Microsoft.CSharp 命名空间中的 CSharpCodeProvider 类。您可能希望查看以下编译代码的方法：

```
CompileAssemblyFromDom
CompileAssemblyFromFile
CompileAssemblyFromSource 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-13T21:44:27.347

[CodeDOM](http://msdn.microsoft.com/en-us/library/650ax5cx.aspx)是你的朋友

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T21:44:04.743

MSDN 有很多文章解释了这一点......

[http://msdn.microsoft.com/en-us/library/650ax5cx.aspx](http://msdn.microsoft.com/en-us/library/650ax5cx.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T21:42:42.187

我的猜测是通过显式调用 csc.exe 编译器。请记住，这和任何依赖项都必须包含在您的部署中。

您可以查看解释 C# 文件的[CS-Script 。](http://www.csscript.net/)它虽然免费但不是开源的......

# pdf - 如何在经典 ASP 中创建 PDF 文件？

> ID：440905
> 
> 赞同：6
> 
> 时间：2009-01-13T21:42:17.367
> 
> 标签：pdf, web-applications, asp-classic, pdf-generation

有没有办法从经典的 ASP 生成 PDF 文件？我有一堆用户输入的数据需要转换成用户可以下载的 PDF。我怎样才能做到这一点？OpenOffice 允许将文档导出为 PDF，那么可以以某种方式利用它吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-13T21:43:58.317

我玩了一下这个（Persits ASPPDF）：[http ://www.asppdf.com/](http://www.asppdf.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T21:47:41.960

也许运行一个可以使用 CrystalReports 的外部应用程序......而您只是将它作为 xml 传递？

这就是我会做的......（懒惰模式）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-14T16:44:06.470

在此处查看 PDF 组件的完整列表：[http](http://www.aspin.com/home/components/document/pdf) ://www.aspin.com/home/components/document/pdf其中许多是免费的。

也可以使用 XSLT 输出 PDF，但我不确定 Microsoft XML Parser 是否支持。我记得 3-4 年前当我尝试这样做时，有一些事情阻止了我。根据您作为来源的数据类型，可能值得一试。

但是，如果这些是静态文件或一次性工作，请考虑在您的计算机上使用 PDF 转换器并将文件上传到服务器。有很多工具可以做到这一点，包括 Adob​​e Acrobat。

# windows - 您可以从 Mac 上运行的 Ruby 连接到 MS Access 数据库吗？

> ID：440908
> 
> 赞同：2
> 
> 时间：2009-01-13T21:42:35.463
> 
> 标签：windows, ruby, database, ms-access, migration

我很确定答案是否定的，但我想我会检查一下。

背景：

*   我在 Access 中有一些遗留数据，需要将其导入 MySQL，这将是使用这些遗留数据的 Ruby 应用程序的数据库服务器。

*   必须处理和转换数据。Access 和 MySQL 模式是完全不同的。我想在 Ruby 中编写一个 rake 任务来进行迁移。

*   我计划使用这篇博文中概述的技术：[使用 Ruby 和 ADO 处理 Access 数据库](http://rubyonwindows.blogspot.com/2007/06/using-ruby-ado-to-work-with-ms-access.html)。但如果能解决问题，我可以使用不同的技术。

*   我很乐意在 Mac 等类 Unix 计算机上工作。我避免在 Windows 中工作，因为它让我充满了存在主义的恐惧。

有没有一种实用的方法可以让我在我的 Mac 上编写和运行我的 rake 任务，并让它通过网络到达我的 Windows 盒子咕噜咕噜的魔多，并像一队突击队营救一群人质一样巧妙地提取数据？还是我必须写这个并在 Windows 上运行它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T22:51:46.277

为什么不将其从 MS-Access 导出到 Excel 或 CSV 文件中，然后将其导入到单独的 MySQL 数据库中？然后你就可以尽情享受新的了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T22:57:07.140

打开 Access 数据库的 Mac ODBC 驱动程序的售价约为 30.00 美元

[http://www.actualtechnologies.com/product_access.php](http://www.actualtechnologies.com/product_access.php) 就是其中之一。我只是在我的 Mac 上的 vmware 中运行访问，并按照 CodeSlave 提到的那样导出到 csv/excel。

如果您想使用访问数据库进行更直接的传输，ODBC 可能会很方便。

希望有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T21:47:41.740

我有一个类似的问题，我想将 ruby​​ 与 sql server 一起使用。我发现的最佳解决方案是使用带有 java jdbc 驱动程序的 jruby。我猜这也适用于访问，但我对访问一无所知

# java - 对于一个实际的开发项目来说，有多少多个“Eclipse 项目”被认为是过多的？

> ID：440931
> 
> 赞同：8
> 
> 时间：2009-01-13T21:46:24.567
> 
> 标签：java, eclipse

我目前正在开发一个项目，该项目包含许多不同的 Eclipse 项目，这些项目相互引用以组成一个大型项目。开发人员是否应该问自己是否应该重新考虑他们的开发项目的结构方式？

**注意：**我的项目目前包含 25+ 个不同的 Eclipse 项目。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-13T21:52:34.507

我的一般经验法则是，我将为每个可重用组件创建一个新项目。因此，例如，如果我有一些可以打包为 jar 的独立功能，我将创建一个新项目，以便我可以独立构建、打包和分发组件。

此外，如果您不需要频繁更改某些项目，您可以仅在需要时构建它们并在 eclipse 中保持它们“关闭”以节省索引等时间。即使您认为某个组件是不可重用，只要它在逻辑/关注方面与代码库的其余部分分开，只需将其分开就可以得到很好的服务。有时，看似特定的代码可能可以在另一个项目或同一项目的未来版本中重用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-13T22:03:11.053

编译时，项目通常会生成一个 jar。因此，如果您的应用程序包含潜在的可重用组件，则可以为每个组件使用一个项目。

我是使用大量项目的忠实粉丝，我觉得这“分解”了我无法用包做的大事情，并帮助我定位和导航。

当然，如果您正在开发 Eclipse 插件，那么无论如何，一切都是一个项目。

我唯一要注意的就是你的源代码控制和它处理项目之间文件移动的能力。Subclipse 一直给我带来麻烦，或者可能是我的 SVN 服务器造成的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-14T12:26:26.380

如果您的项目有*很多*子项目或模块，需要实际组成您的最终工件，那么是时候考虑使用 Maven 之类的东西并设置一个多模块项目了。它将 a) 允许您独立处理每个模块而无需担心 IDE，并允许通过`mvn eclipse:eclipse`目标在您的 IDE（和其他人的 IDE）中轻松设置。此外，在构建整个顶级项目时，maven 将能够从您描述的依赖项列表中派生出哪些模块需要以什么顺序构建。

[这是通过 google](http://docs.codehaus.org/display/MAVENUSER/Multi-modules+projects)和alink 链接[到书 Maven: The Definitive Guide](http://books.sonatype.com/maven-book/reference/multimodule-sect-simple-weather.html)的快速链接，它将在第 6 章中更详细地解释事情（一旦你掌握了基础知识）。

这也将强制您的项目不明确地绑定到 Eclipse。能够独立于 ide 构建意味着任何 Joe Schmoe 都可以使用他/她需要的任何工具轻松使用您的代码库。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T22:02:07.797

为您不经常工作的项目创建 jars。这应该会大大减少混乱。如果您经常处理所有项目，那么您可以将目标添加到您的构建中，这将为您构建相应的项目，这会将所有内容压缩到一个文件中，然后您可以将其包含在类路径中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-15T02:44:13.873

另一种方法是创建许多不同的工作区。单独工作区的好处是您可以消除拥有大量项目的一些视觉混乱/性能开销。您可以使用目标来打包所有项目并将它们放在存储库中，以便您可以在每个工作区中引用它们。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-13T21:58:10.003

在以前的工作中，整个应用程序是 +170 多个项目。虽然很少需要在本地检查所有项目，但即使是我们范围内的 30-40 个项目也使得重新索引等变得非常缓慢。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-13T21:58:18.317

是的。每个项目一个项目。如果您使用的是可重用项目，请看在天上将它们变成图书馆。将不可重用的项目分解成包，这就是它们的用途。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-10-01T10:02:48.237

这是一个很难回答的问题，从根本没有一个 Eclipse 项目到每个班级都有一个 Eclipse 项目。

我的底线：

1.  你可以有太少的项目，但永远不会太多（当然使用自动化，例如 mvn eclipse:eclipse）
2.  使用maven切换工作区模式时使用-Declipse.useProjectReferences=true/false btw jar和项目依赖
3.  使用 mvn release 插件生成连续发布（自动增加版本）
4.  多个项目为您提供了 ***非常***重要的独立版本控制。例如，一个开发人员可能在一个新版本的模块上工作，而您仍然依赖于前一个，并且您在某个时候决定升级到较新的版本（可能通过在 pom.xml 依赖项部分增加其版本）。或者在其他情况下，如果一个项目包含您降级到其先前版本的错误。
5.  与只有包相比，多个项目让您更多地考虑架构。
6.  与只有一个项目相比，多个项目通常会使架构问题更加明显。有人想对此发表评论吗？
7.  您永远不知道您的项目是否演变为需要分离的 OSGI/SOA/EDA。
8.  即使您 100% 确定您的项目将在单个 jvm 中以旧方式部署为一个 jar，但为逻辑独立的代码片段提供多个 eclipse 项目仍然没有什么坏处（mvn 程序集插件）

顺便说一句，我从事的项目分为 24 个 eclipse 项目。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-15T02:28:26.277

见鬼，我们有 100 多个。项目不需要任何成本。

# python - 读取另一个进程的命令行参数（Win32 C 代码）

> ID：440932
> 
> 赞同：9
> 
> 时间：2009-01-13T21:46:40.103
> 
> 标签：python, c, winapi

我需要能够列出传递给其他正在运行的进程的命令行参数（如果有的话）。我已经有了系统上正在运行的进程的 PID，所以基本上我需要确定传递给具有给定 PID *XXX*的进程的参数。

我正在研究[用于管理流程的 Python 模块](http://code.google.com/p/psutil/)的核心部分。该代码以 C 语言编写为 Python 扩展，并将由更高级别的 Python 库包装。该项目的目标是避免依赖第三方库，例如 pywin32 扩展，或在命令行上调用“ps”或 taskkill 等丑陋的 hack，因此我正在寻找一种在 C 代码中执行此操作的方法。

我在谷歌上搜索了一下，发现了一些使用[CreateRemoteThread()](http://msdn.microsoft.com/en-us/library/ms682437(VS.85).aspx)将自己注入另一个进程的简短建议，然后运行[​​GetCommandLine()](http://msdn.microsoft.com/en-us/library/ms683156(VS.85).aspx)但我希望有人可能有一些工作代码示例和/或更好的建议。

**更新**：我在 CodeProject 上找到了完整的工作演示代码和使用 NtQueryProcessInformation 的解决方案：http: [//www.codeproject.com/KB/threads/GetNtProcessInfo.aspx](http://www.codeproject.com/KB/threads/GetNtProcessInfo.aspx) - 这并不理想，因为它“不支持”直接从中剔除信息NTDLL 结构，但我会接受它。感谢大家的建议。

**更新 2**：我通过更多的谷歌搜索来挖掘一个不使用 C++ 代码的 C 版本，并且更直接/简洁地指出了这个问题。有关详细信息，请参阅[http://wj32.wordpress.com/2009/01/24/howto-get-the-command-line-of-processes/](http://wj32.wordpress.com/2009/01/24/howto-get-the-command-line-of-processes/)。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T18:34:51.207

为了回答我自己的问题，我终于找到了一个完全符合我要求的 CodeProject 解决方案：

[http://www.codeproject.com/KB/threads/GetNtProcessInfo.aspx](http://www.codeproject.com/KB/threads/GetNtProcessInfo.aspx)

正如@Reuben 已经指出的那样，您可以使用[NtQueryProcessInformation](http://msdn.microsoft.com/en-us/library/ms684280(VS.85).aspx)来检索此信息。不幸的是，这不是推荐的方法，但鉴于唯一的其他解决方案似乎是产生 WMI 查询的开销，我认为我们现在将采用这种方法。

请注意，如果在 64 位 Windows 操作系统上使用从 32 位 Windows 编译的代码，这似乎不起作用，但由于我们的模块是从目标上的源代码编译的，因此对于我们的目的来说应该没问题。我宁愿使用这个现有的代码，如果它在 Windows 7 或更高版本中中断，我们可以再次查看使用 WMI。感谢您的回复！

**更新**：此处说明了相同技术的更简洁且仅 C（相对于 C++）版本：

[http://wj32.wordpress.com/2009/01/24/howto-get-the-command-line-of-processes/](http://wj32.wordpress.com/2009/01/24/howto-get-the-command-line-of-processes/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-13T21:50:42.810

缓存解决方案：http://74.125.45.132/search?q=cache: [-wPkE2PbsGwJ :windowsxp.mvps.org/listproc.htm+running+process+command+line&hl=es&ct=clnk&cd=1&gl=ar&client=firefox-a](http://74.125.45.132/search?q=cache:-wPkE2PbsGwJ:windowsxp.mvps.org/listproc.htm+running+process+command+line&hl=es&ct=clnk&cd=1&gl=ar&client=firefox-a)

```
in CMD
WMIC /OUTPUT:C:\ProcessList.txt PROCESS get Caption,Commandline,Processid

or

WMIC /OUTPUT:C:\ProcessList.txt path win32_process get Caption,Processid,Commandline 
```

另外： http: [//mail.python.org/pipermail/python-win32/2007-December/006498.html](http://mail.python.org/pipermail/python-win32/2007-December/006498.html)

```
http://tgolden.sc.sabren.com/python/wmi_cookbook.html#running_processes 
seems to do the trick:

import wmi
c = wmi.WMI ()
for process in c.Win32_Process ():
  print process.CommandLine 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-19T22:00:34.430

通过使用 psutil ( [https://github.com/giampaolo/psutil](https://github.com/giampaolo/psutil) )：

```
>>> import psutil, os
>>> psutil.Process(os.getpid()).cmdline()
['C:\\Python26\\python.exe', '-O']
>>> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-14T05:44:43.073

在另一个响应中提到的 WMI 方法可能是最*可靠*的方法。浏览 MSDN，我发现了另一种可能的方法；它已记录在案，但尚不清楚它是否得到完全支持。在 MSDN 的语言中，它——

> 在 Windows 的未来版本中可能会更改或不可用...

无论如何，只要您的进程具有正确的权限，您应该可以[`NtQueryProcessInformation`](http://msdn.microsoft.com/en-us/library/ms684280%28VS.85%29.aspx)使用`ProcessInformationClass`of调用`ProcessBasicInformation`。在返回的`PROCESS_BASIC_INFORMATION`结构中，您应该返回一个指向目标进程的[进程执行块](http://msdn.microsoft.com/en-us/library/aa813706%28VS.85%29.aspx)的指针（作为 field `PebBaseAddress`）。PEB的`ProcessParameters`字段将为您提供指向[`RTL_USER_PROCESS_PARAMETERS`](http://msdn.microsoft.com/en-us/library/aa813741%28VS.85%29.aspx)结构的指针。该`CommandLine`结构的字段将是一个[`UNICODE_STRING`](http://msdn.microsoft.com/en-us/library/aa492030.aspx)结构。（注意不要对字符串做太多假设；不能保证它会以 NULL 结尾，并且不清楚是否需要从开头剥离已执行应用程序的名称命令行。）

我还没有尝试过这种方法——正如我上面提到的，它似乎有点……不确定（阅读：非便携式）——但它可能值得一试。祝你好运...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-13T21:50:05.293

如果您不是这些进程的父进程，那么使用记录的函数是不可能的 :( 现在，如果您是父进程，您可以执行 CreateRemoteThread 技巧，否则您几乎肯定会被拒绝访问，除非您的应用程序有管理员权限。

# c# - 我们如何让 DynamicData 与 EFPocoAdapter 一起工作？

> ID：440943
> 
> 赞同：2
> 
> 时间：2009-01-13T21:48:49.210
> 
> 标签：c#, asp.net, entity-framework, dynamic-data, poco

我的团队希望使用 EFPocoAdapter，但也希望使用 DynamicData 工具，但遇到了一些问题。

我们基本上在 EFPocoAdapter Northwind 示例解决方案（我使用的是最新版本，1.03）中添加了一个“动态数据实体 Web 应用程序”项目，引用了所需的程序集，然后取消注释并编辑 Global.asax.cs 文件中注册的行MetaModel 的上下文如下所示：

```
model.RegisterContext(typeof(NorthwindEF.NorthwindEntities), 
      new ContextConfiguration() { ScaffoldAllTables = true }); 
```

我们收到此错误：“不支持上下文类型 'NorthwindEF.NorthwindEntities'。”

我们的问题是，我们怎样才能使它成为一个有效的上下文，或者我们怎样才能破解一些东西来使它为我们工作？

任何指针表示赞赏，谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-04-09T15:24:55.040

您需要添加可从 Nuget 获得的 DynamicData.EFCodeFirstProvider，只需搜索 EFCodeFirstProvider。然后你使用：

```
DefaultModel.RegisterContext(
            new EFCodeFirstDataModelProvider(() => new NorthwindEF.NorthwindEntities()),
            new ContextConfiguration() { ScaffoldAllTables = true }); 
```

# sql-server - SQL Server：查询快，但过程慢

> ID：440944
> 
> 赞同：297
> 
> 时间：2009-01-13T21:49:11.097
> 
> 标签：sql-server, performance, stored-procedures

查询运行速度很快：

```
DECLARE @SessionGUID uniqueidentifier
SET @SessionGUID = 'BCBA333C-B6A1-4155-9833-C495F22EA908'

SELECT *
FROM Report_Opener
WHERE SessionGUID = @SessionGUID
ORDER BY CurrencyTypeOrder, Rank 
```

**子树成本：0.502**

但是将相同的 SQL 放在存储过程中运行速度很慢，并且执行计划完全不同

```
CREATE PROCEDURE dbo.ViewOpener @SessionGUID uniqueidentifier AS
SELECT *
FROM Report_Opener
WHERE SessionGUID = @SessionGUID
ORDER BY CurrencyTypeOrder, Rank

EXECUTE ViewOpener @SessionGUID 
```

**子树成本：19.2**

我跑了

```
sp_recompile ViewOpener 
```

而且它仍然运行相同（很糟糕），我还将存储过程更改为

```
CREATE PROCEDURE dbo.ViewOpener @SessionGUID uniqueidentifier AS
SELECT *, 'recompile please'
FROM Report_Opener
WHERE SessionGUID = @SessionGUID
ORDER BY CurrencyTypeOrder, Rank 
```

再回来，试图真正欺骗它重新编译。

我已经删除并重新创建了存储过程，以便让它生成一个新计划。

我尝试通过使用诱饵变量强制重新编译**并防止参数嗅探**：

```
CREATE PROCEDURE dbo.ViewOpener @SessionGUID uniqueidentifier AS

DECLARE @SessionGUIDbitch uniqueidentifier
SET @SessionGUIDbitch = @SessionGUID

SELECT *
FROM Report_Opener
WHERE SessionGUID = @SessionGUIDbitch
ORDER BY CurrencyTypeOrder, Rank 
```

我也尝试过定义存储过程**`WITH RECOMPILE`**：

```
CREATE PROCEDURE dbo.ViewOpener @SessionGUID uniqueidentifier 
WITH RECOMPILE
AS
SELECT *
FROM Report_Opener
WHERE SessionGUID = @SessionGUID
ORDER BY CurrencyTypeOrder, Rank 
```

所以它的计划永远不会被缓存，我尝试在执行时强制重新编译：

```
EXECUTE ViewOpener @SessionGUID WITH RECOMPILE 
```

这没有帮助。

我尝试将过程转换为动态 SQL：

```
CREATE PROCEDURE dbo.ViewOpener @SessionGUID uniqueidentifier 
WITH RECOMPILE AS
DECLARE @SQLString NVARCHAR(500)

SET @SQLString = N'SELECT *
   FROM Report_OpenerTest
   WHERE SessionGUID = @SessionGUID
   ORDER BY CurrencyTypeOrder, Rank'

EXECUTE sp_executesql @SQLString,
N'@SessionGUID uniqueidentifier',
@SessionGUID 
```

这没有帮助。

实体“ `Report_Opener`”是一个视图，它没有被索引。该视图仅引用基础表。没有表包含计算列，索引或其他。

对于它的地狱，我尝试创建视图

```
SET ANSI_NULLS ON
SET QUOTED_IDENTIFER ON 
```

那并没有解决它。

这是怎么回事

*   查询速度很快
*   将查询移动到视图中，从视图中选择很快
*   从存储过程的视图中选择慢 40 倍？

我尝试将视图的定义直接移动到存储过程中（违反了 3 条业务规则，并破坏了一个重要的封装），这使得它只慢了大约 6 倍。

为什么存储过程版本这么慢？SQL Server 运行 ad-hoc SQL 比其他类型的 ad-hoc SQL 更快的原因是什么？

我真的不想

*   在代码中嵌入 SQL
*   完全改变代码

    ```
    Microsoft SQL Server  2000 - 8.00.2050 (Intel X86)
    Mar  7 2008 21:29:56
    Copyright (c) 1988-2003 Microsoft Corporation
    Standard Edition on Windows NT 5.2 (Build 3790: Service Pack 2) 
    ```

但是，如果不是参数嗅探，SQL Server 无法像 SQL Sever 运行查询一样快速运行的原因是什么。

* * *

我的下一次尝试是`StoredProcedureA`调用`StoredProcedureB`调用`StoredProcedureC`调用`StoredProcedureD`来查询视图。

如果做不到这一点，让存储过程调用存储过程，调用 UDF，调用 UDF，调用存储过程，调用 UDF 来查询视图。

* * *

总而言之，以下内容在 QA 中运行得很快，但在放入存储过程时速度很慢：

原本的：

```
--Runs fine outside of a stored procedure
SELECT *
FROM Report_OpenerTest
WHERE SessionGUID = @SessionGUID
ORDER BY CurrencyTypeOrder, Rank 
```

`sp_executesql`：

```
--Runs fine outside of a stored procedure
DECLARE @SQLString NVARCHAR(500)
SET @SQLString = N'SELECT *
FROM Report_OpenerTest
WHERE SessionGUID = @SessionGUID
ORDER BY CurrencyTypeOrder, Rank'

EXECUTE sp_executesql @SQLString,
        N'@SessionGUID uniqueidentifier',
        @SessionGUID 
```

`EXEC(@sql)`：

```
--Runs fine outside of a stored procedure
DECLARE @sql NVARCHAR(500)
SET @sql = N'SELECT *
FROM Report_OpenerTest
WHERE SessionGUID = '''+CAST(@SessionGUID AS varchar(50))+'''
ORDER BY CurrencyTypeOrder, Rank'

EXEC(@sql) 
```

* * *

执行计划

**好**计划：

```
 |--Sort(ORDER BY:([Expr1020] ASC, [Currencies].[Rank] ASC))
           |--Compute Scalar(DEFINE:([Expr1020]=If ([Currencies].[CurrencyType]='ctCanadianCash') then 1 else If ([Currencies].[CurrencyType]='ctMiscellaneous') then 2 else If ([Currencies].[CurrencyType]='ctTokens') then 3 else If ([Currencies].[CurrencyType]
                |--Nested Loops(Left Outer Join, OUTER REFERENCES:([Openers].[OpenerGUID]))
                     |--Filter(WHERE:((([Currencies].[IsActive]<>0 AND [Currencies].[OnOpener]<>0) AND ((((((([Currencies].[CurrencyType]='ctUSCoin' OR [Currencies].[CurrencyType]='ctMiscellaneousUS') OR [Currencies].[CurrencyType]='ctUSCash') OR [Currencies].
                     |    |--Nested Loops(Left Outer Join, OUTER REFERENCES:([Currencies].[CurrencyGUID], [Openers].[OpenerGUID]) WITH PREFETCH)
                     |         |--Nested Loops(Left Outer Join)
                     |         |    |--Bookmark Lookup(BOOKMARK:([Bmk1016]), OBJECT:([GrobManagementSystemLive].[dbo].[Windows]))
                     |         |    |    |--Nested Loops(Inner Join, OUTER REFERENCES:([Openers].[WindowGUID]))
                     |         |    |         |--Bookmark Lookup(BOOKMARK:([Bmk1014]), OBJECT:([GrobManagementSystemLive].[dbo].[Openers]))
                     |         |    |         |    |--Index Seek(OBJECT:([GrobManagementSystemLive].[dbo].[Openers].[IX_Openers_SessionGUID]), SEEK:([Openers].[SessionGUID]=[@SessionGUID]) ORDERED FORWARD)
                     |         |    |         |--Index Seek(OBJECT:([GrobManagementSystemLive].[dbo].[Windows].[IX_Windows]), SEEK:([Windows].[WindowGUID]=[Openers].[WindowGUID]) ORDERED FORWARD)
                     |         |    |--Clustered Index Scan(OBJECT:([GrobManagementSystemLive].[dbo].[Currencies].[IX_Currencies_CurrencyType]))
                     |         |--Clustered Index Seek(OBJECT:([GrobManagementSystemLive].[dbo].[OpenerDetails].[IX_OpenerDetails_OpenerGUIDCurrencyGUID]), SEEK:([OpenerDetails].[OpenerGUID]=[Openers].[OpenerGUID] AND [OpenerDetails].[CurrencyGUID]=[Currenc
                     |--Hash Match(Cache, HASH:([Openers].[OpenerGUID]), RESIDUAL:([Openers].[OpenerGUID]=[Openers].[OpenerGUID]))
                          |--Stream Aggregate(DEFINE:([Expr1006]=SUM(If (((([Currencies].[CurrencyType]='ctMiscellaneous' OR [Currencies].[CurrencyType]='ctTokens') OR [Currencies].[CurrencyType]='ctChips') OR [Currencies].[CurrencyType]='ctCanadianCoin') OR [
                               |--Nested Loops(Inner Join, OUTER REFERENCES:([OpenerDetails].[CurrencyGUID]) WITH PREFETCH)
                                    |--Nested Loops(Inner Join)
                                    |    |--Index Seek(OBJECT:([GrobManagementSystemLive].[dbo].[Openers].[IX_Openers_OneOpenerPerSession]), SEEK:([Openers].[OpenerGUID]=[Openers].[OpenerGUID]) ORDERED FORWARD)
                                    |    |--Clustered Index Seek(OBJECT:([GrobManagementSystemLive].[dbo].[OpenerDetails].[IX_OpenerDetails_OpenerGUIDCurrencyGUID]), SEEK:([OpenerDetails].[OpenerGUID]=[Openers].[OpenerGUID]) ORDERED FORWARD)
                                    |--Index Seek(OBJECT:([GrobManagementSystemLive].[dbo].[Currencies].[PK_Currencies_CurrencyGUID]), SEEK:([Currencies].[CurrencyGUID]=[OpenerDetails].[CurrencyGUID]) ORDERED FORWARD) 
```

**糟糕**的计划

```
 |--Sort(ORDER BY:([Expr1020] ASC, [Currencies].[Rank] ASC))
            |--Compute Scalar(DEFINE:([Expr1020]=If ([Currencies].[CurrencyType]='ctCanadianCash') then 1 else If ([Currencies].[CurrencyType]='ctMiscellaneous') then 2 else If ([Currencies].[CurrencyType]='ctTokens') then 3 else If ([Currencies].[Currency
                 |--Nested Loops(Left Outer Join, OUTER REFERENCES:([Openers].[OpenerGUID]))
                      |--Filter(WHERE:((([Currencies].[IsActive]<>0 AND [Currencies].[OnOpener]<>0) AND ((((((([Currencies].[CurrencyType]='ctUSCoin' OR [Currencies].[CurrencyType]='ctMiscellaneousUS') OR [Currencies].[CurrencyType]='ctUSCash') OR [Currenc
                      |    |--Nested Loops(Left Outer Join, OUTER REFERENCES:([Currencies].[CurrencyGUID], [Openers].[OpenerGUID]) WITH PREFETCH)
                      |         |--Filter(WHERE:([Openers].[SessionGUID]=[@SessionGUID]))
                      |         |    |--Concatenation
                      |         |         |--Nested Loops(Left Outer Join)
                      |         |         |    |--Table Spool
                      |         |         |    |    |--Hash Match(Inner Join, HASH:([Windows].[WindowGUID])=([Openers].[WindowGUID]), RESIDUAL:([Windows].[WindowGUID]=[Openers].[WindowGUID]))
                      |         |         |    |         |--Clustered Index Scan(OBJECT:([GrobManagementSystemLive].[dbo].[Windows].[IX_Windows_CageGUID]))
                      |         |         |    |         |--Table Scan(OBJECT:([GrobManagementSystemLive].[dbo].[Openers]))
                      |         |         |    |--Table Spool
                      |         |         |         |--Clustered Index Scan(OBJECT:([GrobManagementSystemLive].[dbo].[Currencies].[IX_Currencies_CurrencyType]))
                      |         |         |--Compute Scalar(DEFINE:([Openers].[OpenerGUID]=NULL, [Openers].[SessionGUID]=NULL, [Windows].[UseChipDenominations]=NULL))
                      |         |              |--Nested Loops(Left Anti Semi Join)
                      |         |                   |--Clustered Index Scan(OBJECT:([GrobManagementSystemLive].[dbo].[Currencies].[IX_Currencies_CurrencyType]))
                      |         |                   |--Row Count Spool
                      |         |                        |--Table Spool
                      |         |--Clustered Index Seek(OBJECT:([GrobManagementSystemLive].[dbo].[OpenerDetails].[IX_OpenerDetails_OpenerGUIDCurrencyGUID]), SEEK:([OpenerDetails].[OpenerGUID]=[Openers].[OpenerGUID] AND [OpenerDetails].[CurrencyGUID]=[Cu
                      |--Hash Match(Cache, HASH:([Openers].[OpenerGUID]), RESIDUAL:([Openers].[OpenerGUID]=[Openers].[OpenerGUID]))
                           |--Stream Aggregate(DEFINE:([Expr1006]=SUM([partialagg1034]), [Expr1007]=SUM([partialagg1035]), [Expr1008]=SUM([partialagg1036]), [Expr1009]=SUM([partialagg1037]), [Expr1010]=SUM([partialagg1038]), [Expr1011]=SUM([partialagg1039]
                                |--Nested Loops(Inner Join)
                                     |--Stream Aggregate(DEFINE:([partialagg1034]=SUM(If (((([Currencies].[CurrencyType]='ctMiscellaneous' OR [Currencies].[CurrencyType]='ctTokens') OR [Currencies].[CurrencyType]='ctChips') OR [Currencies].[CurrencyType]='
                                     |    |--Nested Loops(Inner Join, OUTER REFERENCES:([OpenerDetails].[CurrencyGUID]) WITH PREFETCH)
                                     |         |--Clustered Index Seek(OBJECT:([GrobManagementSystemLive].[dbo].[OpenerDetails].[IX_OpenerDetails_OpenerGUIDCurrencyGUID]), SEEK:([OpenerDetails].[OpenerGUID]=[Openers].[OpenerGUID]) ORDERED FORWARD)
                                     |         |--Index Seek(OBJECT:([GrobManagementSystemLive].[dbo].[Currencies].[PK_Currencies_CurrencyGUID]), SEEK:([Currencies].[CurrencyGUID]=[OpenerDetails].[CurrencyGUID]) ORDERED FORWARD)
                                     |--Index Seek(OBJECT:([GrobManagementSystemLive].[dbo].[Openers].[IX_Openers_OneOpenerPerSession]), SEEK:([Openers].[OpenerGUID]=[Openers].[OpenerGUID]) ORDERED FORWARD) 
```

不好的是急切地绕制 600 万行；另一个不是。

> **注意：**这不是关于调整查询的问题。我有一个快速运行的查询。我只希望 SQL Server 从存储过程中快速运行。

* * *

## 回答 #1

> 赞同：470
> 
> 时间：2009-07-08T02:26:15.303

我遇到了与原始海报相同的问题，但引用的答案并没有为我解决问题。从存储过程中查询仍然运行得很慢。

我在这里找到了另一个答案[“参数嗅探”](http://omnibuzz-sql.blogspot.com/2006/11/parameter-sniffing-stored-procedures.html "参数嗅探")，谢谢 Omnibuzz。归结为在存储过程查询中使用“局部变量”，但请阅读原文以获得更多理解，这是一篇很棒的文章。例如

**慢方式：**

```
CREATE PROCEDURE GetOrderForCustomers(@CustID varchar(20))
AS
BEGIN
    SELECT * 
    FROM orders
    WHERE customerid = @CustID
END 
```

**快捷方式：**

```
CREATE PROCEDURE GetOrderForCustomersWithoutPS(@CustID varchar(20))
AS
BEGIN
    DECLARE @LocCustID varchar(20)
    SET @LocCustID = @CustID

    SELECT * 
    FROM orders
    WHERE customerid = @LocCustID
END 
```

这样做将我的执行时间从 5 多分钟减少到大约 6-7 秒。

* * *

## 回答 #2

> 赞同：136
> 
> 时间：2009-01-14T15:27:01.617

我发现了问题，这里是存储过程的慢版本和快版本的脚本：

**`dbo.ViewOpener__RenamedForCruachan__Slow.PRC`**

```
SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS OFF 
GO

CREATE PROCEDURE dbo.ViewOpener_RenamedForCruachan_Slow
    @SessionGUID uniqueidentifier
AS

SELECT *
FROM Report_Opener_RenamedForCruachan
WHERE SessionGUID = @SessionGUID
ORDER BY CurrencyTypeOrder, Rank
GO

SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS ON 
GO 
```

**`dbo.ViewOpener__RenamedForCruachan__Fast.PRC`**

```
SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS ON 
GO

CREATE PROCEDURE dbo.ViewOpener_RenamedForCruachan_Fast
    @SessionGUID uniqueidentifier 
AS

SELECT *
FROM Report_Opener_RenamedForCruachan
WHERE SessionGUID = @SessionGUID
ORDER BY CurrencyTypeOrder, Rank
GO

SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS ON 
GO 
```

如果你没有发现差异，我不怪你。区别根本不在于存储过程。将 0.5 成本的快速查询转变为执行 600 万行的急切假脱机的区别：

**慢的：** `SET ANSI_NULLS OFF`

**快速地：** `SET ANSI_NULLS ON`

* * *

这个答案也可以说得通，因为视图确实有一个 join 子句，上面写着：

```
(table.column IS NOT NULL) 
```

所以有一些`NULL`s 涉及。

* * *

通过返回 Query Analizer 并运行进一步证明了解释

```
SET ANSI_NULLS OFF 
```

.

```
DECLARE @SessionGUID uniqueidentifier
SET @SessionGUID = 'BCBA333C-B6A1-4155-9833-C495F22EA908' 
```

.

```
SELECT *
FROM Report_Opener_RenamedForCruachan
WHERE SessionGUID = @SessionGUID
ORDER BY CurrencyTypeOrder, Rank 
```

而且查询很慢。

* * *

所以问题**不是**因为查询是从存储过程运行的。问题是 Enterprise Manager 的连接默认选项是`ANSI_NULLS off`，而不是`ANSI_NULLS on`QA 的默认选项。

Microsoft 在[KB296769](http://support.microsoft.com/kb/296769)中承认了这一事实（错误：无法使用 SQL 企业管理器创建包含链接服务器对象的存储过程）。解决方法是在存储过程对话框中包含该`ANSI_NULLS`选项：

```
Set ANSI_NULLS ON
Go
Create Proc spXXXX as
.... 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2017-05-31T15:58:13.530

我遇到了同样的问题，这篇文章对我很有帮助，但没有一个发布的答案解决了我的具体问题。我想发布对我有用的解决方案，希望它可以帮助其他人。

[https://stackoverflow.com/a/24016676/814299](https://stackoverflow.com/a/24016676/814299)

> 在查询结束时，添加 OPTION (OPTIMIZE FOR (@now UNKNOWN))

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-12-04T21:34:50.850

为您的数据库执行此操作。我有同样的问题 - 它在一个数据库中运行良好，但是当我使用 SSIS 导入（不是通常的还原）将此数据库复制到另一个数据库时，我的大多数存储过程都会出现这个问题。所以在谷歌搜索了一些之后，我找到了[Pinal Dave 的博客（顺便说一句，我遇到了他的大部分帖子，并且确实帮助了我很多，所以感谢 Pinal Dave）](http://blog.sqlauthority.com/2007/01/31/sql-server-reindexing-database-tables-and-update-statistics-on-tables/)。

我在我的数据库上执行以下查询，它纠正了我的问题：

```
EXEC sp_MSforeachtable @command1="print '?' DBCC DBREINDEX ('?', ' ', 80)"
GO
EXEC sp_updatestats
GO 
```

希望这可以帮助。只是传递帮助我的其他人的帮助。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-03-06T08:54:59.417

我遇到了这个问题。我的查询看起来像：

```
select a, b, c from sometable where date > '20140101' 
```

我的存储过程定义如下：

```
create procedure my_procedure (@dtFrom date)
as
select a, b, c from sometable where date > @dtFrom 
```

我将数据类型更改为日期时间，瞧！从30分钟到1分钟！

```
create procedure my_procedure (@dtFrom datetime)
as
select a, b, c from sometable where date > @dtFrom 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-07-08T02:37:48.343

这次你发现了你的问题。如果下次你运气不好并且无法弄清楚，你可以使用[计划冻结](http://pratchev.blogspot.com/2009/06/plan-freezing.html)，不用担心错误的执行计划。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-13T21:57:54.810

您是否尝试过重建 Report_Opener 表上的统计信息和/或索引。如果统计数据仍然显示数据库首次启用时的数据，那么 SP 的所有重新编译都将毫无价值。

初始查询本身运行很快，因为优化器可以看到参数永远不会为空。在 SP 的情况下，优化器无法确定参数永远不会为空。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-13T21:57:14.513

尽管我通常反对它（尽管在这种情况下，您似乎有真正的理由），但您是否尝试过在查询的 SP 版本上提供任何查询提示？如果 SQL Server 在这两个实例中准备不同的执行计划，您能否使用提示告诉它使用什么索引，以便该计划与第一个匹配？

对于一些例子，[你可以去这里](http://msdn.microsoft.com/en-us/library/aa258869.aspx)。

编辑：如果您可以在此处发布您的查询计划，也许我们可以确定计划之间的一些差异。

第二：将链接更新为特定于 SQL-2000。您必须向下滚动一条路径，但还有第二个标题为“表格提示”，这就是您要寻找的。

第三：“坏”查询似乎忽略了“Openers”表上的 [IX_Openers_SessionGUID] - 添加 INDEX 提示以强制它使用该索引会改变事情吗？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-14T09:57:32.127

这可能不太可能，但鉴于您观察到的行为不寻常，需要检查它并且没有其他人提到它。

*您是否**绝对**确定所有对象都归 dbo 所有，并且您没有自己或其他用户拥有的恶意副本？*

只是偶尔，当我看到奇怪的行为时，这是因为实际上有一个对象的两个副本，而您获得的副本取决于指定的内容以及您的登录身份。例如，完全有可能拥有同名但由不同所有者拥有的视图或过程的两个副本 - 当您没有以 dbo 身份登录到数据库并且忘记将 dbo 指定为对象所有者时，可能会出现这种情况您创建对象。

请注意，在文本中您正在运行一些没有指定所有者的事情，例如

```
sp_recompile ViewOpener

```

例如，如果存在 dbo 和 [某个其他用户] 拥有的 viewOpener 的两个副本，那么如果您未指定，您实际重新编译的副本取决于具体情况。Report_Opener 视图同上——如果有两个副本（并且它们的规范或执行计划可能不同），那么使用的内容取决于具体情况——并且由于您没有指定所有者，您的临时查询很可能使用一个并且编译过程可能会使用其他。

正如我所说，这可能不太可能，但它是可能的并且应该检查，因为您的问题可能是您只是在错误的地方寻找错误。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-08-27T17:02:25.520

-- 解决方法如下：

```
create procedure GetOrderForCustomers(@CustID varchar(20))

as

begin

select * from orders

where customerid = ISNULL(@CustID, '')

end 
```

- 就是这样

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-07-15T16:45:43.120

这听起来很傻，从 SessionGUID 的名称来看似乎很明显，但是该列是 Report_Opener 上的唯一标识符吗？如果没有，您可能想尝试将其转换为正确的类型并试一试或将您的变量声明为正确的类型。

作为 sproc 的一部分创建的计划可能会不直观地工作，并且会在一张大桌子上进行内部转换。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-13T23:15:57.757

我有另一个想法。如果您创建这个基于表的函数会怎样：

```
CREATE FUNCTION tbfSelectFromView
(   
    -- Add the parameters for the function here
    @SessionGUID UNIQUEIDENTIFIER
)
RETURNS TABLE 
AS
RETURN 
(
    SELECT *
    FROM Report_Opener
    WHERE SessionGUID = @SessionGUID
    ORDER BY CurrencyTypeOrder, Rank
)
GO 
```

然后使用以下语句从中选择（甚至将其放入您的 SP）：

```
SELECT *
FROM tbfSelectFromView(@SessionGUID) 
```

看起来正在发生的事情（每个人都已经评论过）是 SQL Server 只是在某个错误的地方做了一个假设，也许这会迫使它纠正这个假设。我讨厌添加额外的步骤，但我不确定还有什么可能导致它。

# nhibernate - 使用 NHibernate 进行复杂搜索

> ID：440947
> 
> 赞同：4
> 
> 时间：2009-01-13T21:50:11.453
> 
> 标签：nhibernate, search

我很好奇您使用 NHibernate 进行复杂搜索的方法是什么？

我正在使用[Ayende 的](http://ayende.com/Blog/2006/12/07/ComplexSearchingQueryingWithNHibernate.aspx)

你的是什么？感谢您的建议和回答。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T11:35:08.123

我几乎使用了 Ayende 的东西，只是有点复杂，你想做什么你不能用它做什么？

基本上我们添加的是我们有一个界面，我们在其中定义了我们想要搜索的所有字段，当我们即将进行搜索时我们调用它，这意味着我们可以轻松地更改我们正在搜索的内容。

此外，我们在项目中使用了 Active Record（在 Hibernate 之上），这很酷，大量的任务得到了简化，你缺少文档有时确实会伤害 Cheer

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T21:59:52.900

如果我们有一个复杂的动态搜索，我们通常会构造一个 SearchParameter 对象，然后将它传递给一个方法，该方法将为我们构建我们的标准。

例如，如果我们正在搜索一个人，我们可能有一个如下所示的搜索对象：

```
public class PersonSearchParameters
{
    public string FirstName {get; set;}
    public string LastName {get; set;}

    public ICriteria GetSearchCriteria()
    {
        DetachedCriteria query = DetachedCriteria.For(typeof (Person));
        //Add query parameters
        Return query;
    }
} 
```

然后对于每种类型的搜索，我们将能够从类中创建单个条件，或者我们可以有多个搜索参数类并将它们链接在一起

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T22:04:57.760

我们使用 HQL，但我们仍在尝试围绕 Criteria API 进行复杂查询。使用 HQL 时，我们必须管理大量重复。

# c# - C# 并发、锁定和字典对象

> ID：440957
> 
> 赞同：0
> 
> 时间：2009-01-13T21:52:48.673
> 
> 标签：c#, concurrency, dictionary, locking

我有一堆加载到数据库对象中的数据库实体。同一个 DB 实体可能被加载到多个 DB 对象中。数据库实体会定期需要特殊处理。该处理必须由一个线程一次执行。锁定在这里是有序的。

编辑：重要提示：该过程调用慢速网络服务。这就是我试图防止并发的原因。我不明白如何在没有锁的情况下安全地完成这项工作。

因此，我创建了一个“挂锁”对象，数据库对象将引用该对象进行锁定。挂锁对象是基于实体的，因此同一实体的两个或多个 DB 对象将使用相同的挂锁对象。我使用数据库实体的 ID 作为键将这些挂锁存储在字典对象中。挂锁对象也只是一个简单的字符串对象。这是正确的方法吗？我在想我要么过度工程化，要么简化了这个。如果方法是正确的，这段代码看起来如何？它可以工作，但我还没有在负载下测试它。

谢谢 ：）

```
public static func(CustomObject o)
{
    if (ReadyForUpdate(o))
    {
        lock (LookupPadLockByID(object.ID)
        {
            if (ReadyForUpdate(o))
            {
                PerformUpdate(object);
            }
        }
    }
}

private static readonly object padlockLock = new object();
private static readonly Dictionary<int, string> padLocks = new Dictionary<int,string>();
private static object LookupPadLockByID(int uniqueID)
{
    lock (padlockLock)
    {
        if (!padLocks.ContainsKey(uniqueID))
        {
            padLocks.Add(uniqueID, uniqueID + " is locked");
        }
    }

    return padLocks[uniqueID];
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-13T21:59:18.817

好吧，你最终锁定了一个字符串，这不是一个好主意（尽管连接意味着实习不应该是一个大问题）。更大的问题是：

*   您似乎没有从中删除锁`padLocks`-这是一个问题吗？
*   `padlockLock`您在;之外访问字典 `return`应该在里面`lock`

对于这一秒，这会更简单：

```
object itemLock;
if (!padLocks.TryGetValue(uniqueID, out itemLock)) {
    itemLock = new object();
    padLocks.Add(uniqueID, itemLock);
}
return itemLock; 
```

如果此代码是相当本地的（即您的对象尚未转义），您可能只是`lock`记录本身？简单很多...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T23:41:21.107

锁定字符串不是一个好主意。我建议两种选择：

1.  使用 a`Dictionary<int,object>`作为 padLocks 的类型，并将 a`new object();`作为值。
2.  创建一个只保存 id 的类；如果您想在调试时查看 LockPad 类，这会更好地提高可读性。

锁垫类：

```
class LockPad {
    public int Id { get; private set; }

    public LockPad(int id) {
        this.Id = id;
    }

    public override string ToString() {
        return "lock of " + id.ToString();
    }
} 
```

然后，锁定该类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T22:05:00.893

我认为你过度工程。如果您只需要保护您的数据库实体（我假设在您的代码中由“对象”表示，我将其更改为“实体”），您可以将其用作您的锁。任何引用对象都可以用作锁：

```
public static func(CustomObject o)
{
    if (ReadyForUpdate(o))
    {
        lock (entity)
        {
                if (ReadyForUpdate(o))
                {
                        PerformUpdate(entity);
                }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T22:10:06.517

如果您使用任何类型的标准数据库，我建议完全转储这些客户端锁以支持事务和表/行锁。

# sql - 执行 LIKE 条件时，参数化查询会中断。为什么？

> ID：440962
> 
> 赞同：0
> 
> 时间：2009-01-13T21:53:54.113
> 
> 标签：sql, .net, parameters, sql-like

所以，我有一个执行参数化 LIKE 查询的方法。该方法接受搜索参数/值，然后将其添加到准备好查询的命令中。

它不工作。它应该可以工作，当我将要搜索的值直接编码到 SQL 字符串中时，没有参数化，它确实有效！当我将它作为参数时，没有！有任何想法吗。

这是一些（假的，我已更改名称）示例代码。

```
myDataReader = SQLExecute("SELECT * FROM TableOfAwesomeness WHERE BestTVShow LIKE 'Arrested Development%'") 
```

会工作。然而

```
Function MethodOfReturningHorror(ByVal TVShow as String) as SqlDataReader
{
dim command as new SQLCommand
command.connection = sqlconnection
command.CommandText = "SELECT * FROM TableOfAwesomeness WHERE BestTVShow LIKE '@tvShow%'"
command.Parameters.Add("tvShow",TVShow)

return command.ExecuteReader()
} 
```

为了懒惰/简洁，我错过了与问题无关的代码。所以忽略返回位和其他东西，重要的是数据读取器不包含任何内容，而它在第一个示例中包含。我确信这与 LIKE 子句的参数化有关。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-13T21:55:34.267

试试这个：

```
command.CommandText = "SELECT * FROM TableOfAwesomeness WHERE BestTVShow LIKE @tvShow + '%'" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-13T21:56:29.540

尝试将“%”附加到参数字符串的末尾，而不是将其嵌入到 sql 中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T22:07:13.637

试试这个，以确保您检查的值是 varchar 值，而不是整数类型：

```
command.CommandText = "SELECT * FROM TableOfAwesomeness WHERE BestTVShow LIKE convert(varchar(100), @tvShow) + '%'" 
```

当 T-SQL 进行本机类型转换和字符串连接时，我遇到了一些问题。

（显然将“varchar（100）”更改为在您的实例中有效的任何内容：您的数据类型，您的预期长度）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-13T22:00:15.943

`@tvShow`是一个变量，您在字符串中使用它。这将相当于 C# 中的 this：

```
var tvShow = "5th Wheel";
var netwokAndShow = "Fox tvShow";
Console.WriteLine(networkAndShow); // Prints 'Fox tvShow', not 'Fox 5th Wheel' 
```

你希望它看起来像：

```
LIKE @tvShow + '%' 
```

# java - REST Web 服务使用 Restlet 接受 POST - 最佳实践

> ID：440989
> 
> 赞同：2
> 
> 时间：2009-01-13T21:58:53.950
> 
> 标签：java, web-services, rest, post, restlet

我有我的资源，它们是处理 POST 请求的典型重写方法。

```
public void acceptRepresentation(Representation rep) {

  if (MediaType.APPLICATION_XML.equals(rep.getMediaType())) {
      //Do stuff here
  }
  else {
      //complain!
  }
} 
```

我想知道的是处理我的 XML 数据包的最佳实践。我看到很多使用 Form 的例子——但肯定有一种方法可以使用 Representation 对象本身或将其转换为一些有用的 XML 对象？？？

非常感谢您对如何解析资源中的传入 XML 的任何帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-14T15:24:01.967

这更像是我正在寻找的那种回应。感谢[Thierry Boileau](http://restlet.tigris.org/ds/viewMessage.do?dsForumId=4447&dsMessageId=1024110)的回答：

> 您可以使用两种“XML 表示”：DomRepresentation 和 SaxRepresentation。您可以使用发布的表示来实例化它们。例如：DomRepresentation xmlRep = new DomRepresentation(rep);
> 
> DomRepresentation 使您可以访问 Dom 文档。SaxRepresentation 允许您使用自己的 contentHandler 解析 XML 文档。请参阅此处 1 和此处 2 的 javadocs。
> 
> 1.  [http://www.restlet.org/documentation/1.1/api/org/restlet/res​ource/DomRepresentat​ion.html](http://www.restlet.org/documentation/1.1/api/org/restlet/res%E2%80%8Bource/DomRepresentat%E2%80%8Bion.html)
>     
>     
> 2.  [http://www.restlet.o​rg/documentation/1.1​/api/org/restlet/res​ource/SaxRepresentat​ion.html](http://www.restlet.o%E2%80%8Brg/documentation/1.1%E2%80%8B/api/org/restlet/res%E2%80%8Bource/SaxRepresentat%E2%80%8Bion.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T22:06:42.467

我们目前使用 RESTeasy 执行此操作，这是一种替代的 JAX-RS 实现。我们使用 JAXB 绑定（注释）在 XML 和我们的模型 POJO 之间进行映射，并为 JAX-RS 指定一个*JAXB 提供程序*，以便它知道如何操作。这在我们的[带有 RESTEasy (JAX-RS) 的 Java EE 中的 RESTful Web 服务一文中](http://www.lunatech-research.com/archives/2008/03/20/restful-web-sevices-resteasy-jax-rs)进行了描述，这可能会有所帮助。

更新：对于 Restlet，[JAXB 扩展](http://wiki.restlet.org/docs_1.1/13-restlet/28-restlet/67-restlet.html)可能是您所需要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-13T22:05:46.447

通过该`representation.getText()`方法，您可以获得一个可以输入到 SAX 解析器或 dom 读取器的字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T17:06:46.663

@西蒙·E

我不明白：您使用的是哪种 Java REST 实现？

所以，我只是给你一个使用 JAX-RS（Jersey 实现）的例子

**服务器部分**（一些 REST 类的方法）：

```
@POST
@Path("/upload")
@Consumes(MediaType.APPLICATION_FORM_URLENCODED)
@Produces(MediaType.TEXT_PLAIN)
public static Response upload(
        @FormParam("name") String name,
        @FormParam("content") String content)
        throws Exception {

    // NOTE: you get your content as String
    // (do something here)

    return Response.ok().build();
} 
```

**客户端部分**（一些 JUnit 测试的方法）：

```
@Test
public void uploadFile()
        throws Exception {

    String address = "http://0.0.0.0:8000/r/upload";

    WebResource r = Client.create().resource(address);
    Form form = new Form();
    form.add("name", "test");
    form.add("content", "SOME CONTENT GOES HERE");
    String s = r.post(String.class, form);

    System.out.println(s);
} 
```

就是这样 ！！！

如果您在导入时遇到问题：
服务器需要 javax.ws.rs.* 和 javax.ws.rs.core.*
客户端需要 com.sun.jersey.api.client.* 和 com.sun.jersey.api.representation .*

无论如何，我都会建议您使用 JAX-RS 而不是替代实现，因为 JAX-RS 将成为即将到来的**Java EE 6的一部分**

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-07T14:19:16.177

即使在restlet 2.0中，这也是相同的程序吗？

我使用restlet 2.0m6，这是我使用的代码片段 -

@邮政

公共代表过程（代表实体）

{

尝试

{

DomRepresentation dom = new DomRepresentation(entity);

文档 d = dom.getDocument();

.

.

} 捕捉（异常 e）

{ e.printStackTrace(); }

它会在 dom.getDocument() 行引发空指针异常。这意味着实际上没有数据到达。

我的弹性位看起来像这样 - var service : HTTPService = new HTTPService(); service.method="POST"; service.contentType="应用程序/xml" service.url=url; var token :AsyncToken = service.send(params);

其中 params 是一个 XML 对象。

# c# - AddWithValue 方法 (C#) 什么都不做

> ID：440999
> 
> 赞同：2
> 
> 时间：2009-01-13T22:01:10.840
> 
> 标签：c#, sql, ado.net

我目前正在编写一个类来处理我的应用程序中的所有数据库活动，所以我来到了执行更新查询的方法。

截至目前，我正在返回并显示命令文本的内容以进行检查，看起来还不错：

```
UPDATE news SET title = @title, newsContent = @newsContent, excerpt = @excerpt, date = @date, urlTitle = @urlTitle, isPublished = @isPublished WHERE (id = @id); 
```

所以，换句话说，很好。下一步是用实际值替换所有@values - 这就是我遇到问题的地方。没发生什么事。AddWithValue 方法似乎没有做任何事情，我找不到这样做的理由。

```
public string updateQuery(string table, string[] fields, object[] values, string conditionField, object conditionValue)
{
    try
    {
        StringBuilder cmd = new StringBuilder("UPDATE " + table + " SET ");

        int i = 1;
        foreach (string s in fields)
        {
            if (i == fields.Length)
            {
                cmd.Append(s + " = @" + s + " ");
            }
            else
            {
                cmd.Append(s + " = @" + s + ", ");
            }

            i++;
        }

        cmd.Append("WHERE (" + conditionField + " = @" + conditionField + ");");
        command.CommandText = cmd.ToString();

        int j = 0;
        foreach (object o in values)
        {
            command.Parameters.AddWithValue("@" + fields[j], o);
            j++;
        }
        command.Parameters.AddWithValue("@" + conditionField, conditionValue);

        command.ExecuteNonQuery();
        connection.Close();

        return command.CommandText;
    }
    catch (Exception ex)
    {
        throw ex;
    }
} 
```

任何人？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-13T22:08:20.450

“它什么都不做”是什么意思？您的意思是执行命令时参数没有值吗？或者命令文本保持不变？

如果是后者，那么这是意料之中的。该命令不会更改查询文本，它会将查询文本与参数值一起发送到服务器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-14T01:29:01.480

感谢 Joel Coehoorn 的建议，我会调查的。

不过，我想让我的东西正常工作：p

刚刚注意到日期字段实际上一直在更新自己。不过，其他领域都没有。我越看越没意思。也许在早上尝试比在午夜尝试更好。

编辑：找出问题所在，它比我预期的要简单得多。我忘记检查页面是否是回发，所以每次我更新数据库时，在调用提交方法之前，这些字段都填充了来自数据库的数据。因此，更新方法一直有效。*脸红*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-13T22:06:50.720

arg-value 是否可能为空？如果是这样，将不会添加参数。对于空值，您需要使用`DBNull.Value`; 例如（不是唯一的方法）：

```
cmd.Parameters.AddWithValue(argName, (object)argValue ?? DBNull.Value); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T22:09:52.320

您提供的 ID 值可能与您正在更新的表中的条目不匹配。

顺便说一句，放弃 try..catch 它没有任何用途。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-13T22:15:03.277

如果您期望更新字符串，您将感到失望。使用参数化查询的一大特点是值永远不会直接替换到命令字符串中，因此您可以免受这种安全漏洞的影响。相反，数据是单独传输到服务器的。

让我建议这个新的函数签名：

```
public string updateQuery(string table, IEnumerable<KeyValuePair<string, object>> values, KeyValuePair<string, object> condition) 
```

这将在您的参数名称和值之间创建强关联，并且还使您可以灵活地使用数组以外的构造（尽管数组当然也可以接受）。然后代码将如下所示：

```
public string updateQuery(string table, IEnumerable<KeyValuePair<string, object>> values, KeyValuePair<string, object> condition)
{
    using (StringBuilder cmd = new StringBuilder("UPDATE [" + table + "]\nSET "))
    {
        string delimiter = "";
        foreach (KeyValuePair<string, object> item in values)
        {
           cmd.AppendFormat("{0}[{1}]=@{1}", delimiter, item.Key);
           delimiter = ",\n";
        }
        cmd.AppendFormat("\nWHERE [{0}]= @{0};", condition.Key);

        command.CommandText = cmd.ToString();
    }

    foreach (KeyValuePair<string, object> item in values)
    {
        command.Parameters.AddWithValue("@" + item.Key, (object)item.Value ?? DBNull.Value);
    }
    command.Parameters.AddWithValue("@" + condition.Key, condition.Value);

    // you didn't show where the connection was created or opened
    command.ExecuteNonQuery();    
    connection.Close();

    return command.CommandText;
} 
```

`IEnumerable<SqlParameter>`如果您可以使用可以创建强类型数据库参数的东西（例如 ），那就更好了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-13T23:32:56.723

我想我也会发布其余的代码。首先是传递值的方法：

```
public void updatePost(int postId)
{
    DbConnection d = new DbConnection();

    string[] fields = {
                          "title",
                          "newsContent",
                          "excerpt",
                          "date",
                          "urlTitle",
                          "isPublished" 
                      };

    object[] values = {
                          this.title,
                          this.content,
                          this.excerpt,
                          this.date,
                          this.urlTitle,
                          this.isPublished,
                      };

    d.updateQuery("news",fields,values,"id",postId);
} 
```

连接数据库的构造方法：

```
public DbConnection()
{        
    connection = new SqlConnection("Data Source=****; User Id=****; Password=*****;");
    connection.Open();
    command = connection.CreateCommand();
} 
```

我还没有发现问题，但我真的很感谢我得到的所有帮助。:-)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-14T00:39:17.323

使用我的其他代码，您的新 updatePost 方法将如下所示。

```
using DBParam = KeyValuePair<string, object>; // reduce need to keep re-typing this

public void updatePost(int postId)
{   
    List<DBParam> values = new List<DBParam>();

    values.Add(new DBParam("title", this.title));
    values.Add(new DBParam("newsContent", this.content));
    values.Add(new DBParam("excerpt", this.excerpt));
    values.Add(new DBParam("date", this.date));
    values.Add(new DBParam("urlTitle", this.urlTitle));
    values.Add(new DBParam("isPublished", this.isPublished));

    new DbConnection().updateQuery("news", values, new DBParam("id", postid));
} 
```**********````****