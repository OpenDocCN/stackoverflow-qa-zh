# StackOverflow 问答 000724000-000724999

# windows - Nehalem Xeon 在 32 位操作系统、XP 与 2003 上的性能

> ID：724014
> 
> 赞同：1
> 
> 时间：2009-04-07T02:53:13.607
> 
> 标签：windows, memory, 32-bit, numa, nehalem

我必须在 WinXP 或 Win2003 上运行 32 位代码。Nehalem Xeons（5500 系列）应该是最快的，但我不确定内存安排会发生什么。我不确定两个部分：

1.  为了获得最大速度的内存设置，我需要安装至少 6gb 的 RAM（让每个 CPU 3 块都可以使用）。内存交错的方式是否可以让 32 位操作系统（WinXP 或 2003）从中获得最大性能？（我很好浪费了几 GB 的 RAM）。
2.  Win2003 的 NUMA 支持是否适用于 Xeon 5500s？（如果是这样，我想我应该使用 Win2003 而不是 WinXP？）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T04:18:59.093

为什么要限制您的系统使用 32 位操作系统？您可以在 64 位操作系统上很好地运行 32 位代码，而 64 位 Server 2003 将在您描述的这种系统上运行得非常好。我个人会选择 2008 或 Linux。

无论如何，没有任何理由在双 Nehalem Xeon 上运行 32 位操作系统。因此，请获得 64 位操作系统和**12 GB** RAM。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T04:08:08.463

**您似乎将 ram 的数量与 ram 的速度混淆了。**

通常，您希望使用质量更高的更少数量的 ram，而不是 ram 的数量（假设您有足够的 ram 总数）。

更重要**的是...您如何使用 4GB 的 RAM？！**

如果您正在运行的所有应用程序总共需要超过 4 GB，您可能需要重新考虑您的方法......但是再次达到如此多的内存使用量意味着您已经花费了大量时间......

* * *

稍微无关，关于 Windows XP 32 位和内存限制：

[Windows XP 32 位限制为 4GB](http://en.wikipedia.org/wiki/Physical_Address_Extension#Microsoft_Windows)（大概是因为它忽略了所有新计算机附带的 4 个附加地址位，请参阅[Physical-address-extension](http://en.wikipedia.org/wiki/Physical_Address_Extension)）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-13T00:47:04.683

是的，Server 2003 Enterprise 支持 NUMA 并支持真正的 36 位 PAE 寻址，可寻址高达 64GB（在 SP1 和更高版本中）。所以这是最好的使用方法。

# objective-c - 在 UIWindow 中添加子视图之前设置 UILabel 失败

> ID：724016
> 
> 赞同：0
> 
> 时间：2009-04-07T02:55:15.910
> 
> 标签：objective-c, iphone

属性**标签**是**UILabel**类型，是**UIViewController**中的一个出口。

为什么以下工作： -

```
[window addSubview:viewController.view];
[viewController.label setText:@"New Label"] ; 
```

并且语句的反向序列不会更改标签中的默认文本：

```
[viewController.label setText:@"New Label"] ;
[window addSubview:viewController.view]; 
```

视图不是从附加到 UIViewController 的 UI 元素加载的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T03:12:37.583

视图控制器在第一次被请求时创建或加载它的视图，无论是从 NIB 还是通过`loadView`方法。而且在大多数情况下，关联的子视图也仅在加载主视图时创建。`viewController.label`这意味着`nil`直到您第一次尝试访问`viewController.view`.

因此，如果您尝试先设置标签文本，您实际上只是将该消息发送到`nil`，这就是它似乎没有生效的原因。

# sql - 条件插入 SQL

> ID：724019
> 
> 赞同：0
> 
> 时间：2009-04-07T02:57:52.847
> 
> 标签：sql, ms-access

我有以下表架构：

```
create table SerialNo2(
IncarnationID_UID counter primary key,
Mark integer
); 
```

现在我想在表中添加一个新列，我们称之为`degree`. 鉴于我想对生产表应用更新，我将不得不根据表中所有现有数据的值填充该`degree`列。规则是`Mark``SerialNo2`

```
if Mark>90 then degree='A',
else degree='B' 
```

如何编写将完成上述功能的条件 SQL 插入？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T03:05:29.223

像这样的东西：

```
UPDATE SerialNo2 SET SerialNo2.Degree = IIf([Mark]>90,"A","B") 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T03:01:28.077

首先将 degree 列定义为可为空，然后执行 UPDATE：

```
UPDATE SerialNo2
SET Degree = CASE WHEN Mark > 90 THEN 'A' ELSE 'B' END 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T08:26:48.653

首先创建新列（ANSI-92 查询模式语法）：

```
ALTER TABLE SerialNo2 ADD 
   Degree CHAR(1) DEFAULT 'B' NOT NULL; 
```

如果您立即查询表，您将`NULL`在新列中...这是引擎 IMO 中的一个主要错误，即它应该`DEFAULT`为每一行设置值但是我们现在有一个`NOT NULL`包含`NULL`s 的列！

所以我们必须`SET`为每一行的值

```
UPDATE SerialNo2 
   SET Degree = IIF(Mark > 90, 'A', 'B'); 
```

顺便说一句，如果您有多个值要测试，而不是嵌套`IIF`的 s，您可以使用 SWITCH 关键字，将 TRUE valeu 用于“case else”子句，例如

```
UPDATE SerialNo2 
   SET Degree = SWICTH(
                       Mark > 90, 'A', 
                       Mark <= 0, 'X', 
                       TRUE, 'B'
                      ); 
```

# javascript - SWFObject Flash Player 脚本：Wode = 透明？

> ID：724028
> 
> 赞同：0
> 
> 时间：2009-04-07T03:06:26.523
> 
> 标签：javascript, html, flash, swfobject

我正在使用 SWFObject 脚本 ( [http://blog.deconcept.com/swfobject](http://blog.deconcept.com/swfobject) ) 将 Flash 对象嵌入到以下页面中：[http://parramatta.pjgallaghers.com.au/_flashvr/test](http://parramatta.pjgallaghers.com.au/_flashvr/test)

闪存来自外部供应商，除了嵌入脚本之外，我对它没有太多控制权。由于某种原因，一旦 Flash 完成加载网站的主菜单下拉菜单停止出现 - 如果您在加载 Flash 之前和同时将鼠标悬停在不同的菜单选项上，您会看到它是正常的下拉行为..

有谁知道是什么原因造成的？
（这是一个老网站，请原谅马虎的代码..）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-17T05:58:57.577

使用 wmode opaque 让堆叠顺序与您的菜单一起使用，同时最大限度地减少 CPU 使用率（由于已知错误和大量资源占用，应尽可能避免使用 wmode transparent）。示例可以在[这里找到](http://pipwerks.com/lab/swfobject/z-index/2.0/index.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T03:37:37.757

我在 Mozilla Firefox 3.1 beta 3、Internet Explorer 8 和 Google Chrome 2 beta 中测试了您的网站，并且菜单正常工作。我注意到的是，一旦你的闪存完成加载，我的 CPU 使用率（Core 2 Duo）就会飙升至 80%。

您的页面源代码很难阅读，您有更好的缩进吗？

# sql - SQL查询按时间计算特定列

> ID：724039
> 
> 赞同：0
> 
> 时间：2009-04-07T03:25:23.747
> 
> 标签：sql, sql-server

好的，我正在使用 MS SQL，并且我有一个包含如下值的表：

```
ID     Date     Radio     Time
111    4/1/09    1        3:00:00
111    4/1/09    2        4:00:00
111    4/1/09    3       14:00:00
111    4/1/09    1       15:00:00
111    4/1/09    3       16:00:00
222    4/1/09    2        2:00:00
222    4/1/09    1        5:00:00
222    4/1/09    1       19:00:00
333    4/1/09    1        3:00:00
333    4/1/09    2        5:00:00
333    4/1/09    2        13:00:00
333    4/1/09    3        17:00:00 
```

好的，所以我需要一个查询：

```
window 1 < 12:00
13 < window 2 < 15:00
window 3 > 16:00 
```

返回总和：

```
 Window1     Window2    Window3  
Radio 1:     3           0          2
Radio 2:     3           1          0
Radio 3:     0           1          2 
```

我试过使用 count() 但我无法让这些正确加入正确的“收音机”有什么建议吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T03:32:18.177

```
SELECT [Radio],
    SUM(CASE WHEN [Time] < 12 THEN 1 ELSE 0 END) AS Window1,
    SUM(CASE WHEN [Time] >= 12 AND [TIME] < 15 THEN 1 ELSE 0 END) AS Window2,
    SUM(CASE WHEN [Time] >= 16 THEN 1 ELSE 0 END) AS Window3
FROM [Table]
GROUP BY [Radio] 
```

酌情调整<=/<和>=/>；你在这一点上不是很具体。

另外，您的第一个条件是`window 1 > 12`. 我假设你的意思是`window 1 < 12`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T03:43:31.083

我可能已经欺骗并使用了 SQL Server 2008，它使用 [time(7)] 数据类型作为时间列，我称之为“时间”。这将为您提供与您要求的相同的结果。

```
select radio, SUM(case when thetime <= '12:00:00' then 1 else 0 end) Window1
    , SUM(case when thetime between '13:00:00' and '15:59:59' then 1 else 0 end) Window2
    , SUM(case when thetime >= '15:00:00' then 1 else 0 end) Window3
from stackoverflow
GROUP BY radio
ORDER BY radio 
```

希望有帮助，

卡尔文

# java - Java中的HTTP URL地址编码

> ID：724043
> 
> 赞同：383
> 
> 时间：2009-04-07T03:28:22.647
> 
> 标签：java, http, urlencode

我的 Java 独立应用程序从用户那里获得了一个 URL（它指向一个文件），我需要点击它并下载它。我面临的问题是我无法正确编码 HTTP URL 地址......

例子：

```
URL:  http://search.barnesandnoble.com/booksearch/first book.pdf

java.net.URLEncoder.encode(url.toString(), "ISO-8859-1"); 
```

返回我：

```
http%3A%2F%2Fsearch.barnesandnoble.com%2Fbooksearch%2Ffirst+book.pdf 
```

但是，我想要的是

```
http://search.barnesandnoble.com/booksearch/first%20book.pdf 
```

（空格替换为 %20）

我猜`URLEncoder`它不是为编码 HTTP URL 而设计的……JavaDoc 说“用于 HTML 表单编码的实用程序类”……还有其他方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：316
> 
> 时间：2009-04-07T09:12:13.867

[java.net.URI](http://java.sun.com/javase/6/docs/api/java/net/URI.html)类可以提供帮助；在您找到的 URL 文档中

> 请注意，URI 类在某些情况下会执行其组件字段的转义。管理 URL 编码和解码的推荐方法是使用 URI

使用具有多个参数的构造函数之一，例如：

```
URI uri = new URI(
    "http", 
    "search.barnesandnoble.com", 
    "/booksearch/first book.pdf",
    null);
URL url = uri.toURL();
//or String request = uri.toString(); 
```

*（URI 的单参数构造函数不会转义非法字符）*

* * *

只有非法字符会被上面的代码转义——它不会转义非 ASCII 字符（参见 fatih 的评论）。
该`toASCIIString`方法可用于获取仅包含 US-ASCII 字符的字符串：

```
URI uri = new URI(
    "http", 
    "search.barnesandnoble.com", 
    "/booksearch/é",
    null);
String request = uri.toASCIIString(); 
```

* * *

对于带有类似查询的 URL `http://www.google.com/ig/api?weather=São Paulo`，请使用 5 参数版本的构造函数：

```
URI uri = new URI(
        "http", 
        "www.google.com", 
        "/ig/api",
        "weather=São Paulo",
        null);
String request = uri.toASCIIString(); 
```

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2010-04-07T21:01:40.700

请注意，上面的大多数答案都是不正确的。

这个`URLEncoder`类，尽管是名字，不是这里需要的。不幸的是，Sun 如此讨厌地命名这个类。 `URLEncoder`用于将数据作为参数传递，而不是用于对 URL 本身进行编码。

换句话说，`"http://search.barnesandnoble.com/booksearch/first book.pdf"`就是 URL。例如，参数将是`"http://search.barnesandnoble.com/booksearch/first book.pdf?parameter1=this&param2=that"`. 参数是您将使用`URLEncoder`的。

以下两个示例突出了两者之间的差异。

根据 HTTP 标准，以下生成错误的参数。请注意与号 (&) 和加号 (+) 的编码不正确。

```
uri = new URI("http", null, "www.google.com", 80, 
"/help/me/book name+me/", "MY CRZY QUERY! +&+ :)", null);

// URI: http://www.google.com:80/help/me/book%20name+me/?MY%20CRZY%20QUERY!%20+&+%20:) 
```

以下将生成正确的参数，并正确编码查询。注意空格、& 和加号。

```
uri = new URI("http", null, "www.google.com", 80, "/help/me/book name+me/", URLEncoder.encode("MY CRZY QUERY! +&+ :)", "UTF-8"), null);

// URI: http://www.google.com:80/help/me/book%20name+me/?MY+CRZY+QUERY%2521+%252B%2526%252B+%253A%2529 
```

* * *

## 回答 #3

> 赞同：88
> 
> 时间：2012-01-22T17:04:01.840

我将在这里添加一个针对 Android 用户的建议。您可以这样做，以避免必须获取任何外部库。此外，上述某些答案中建议的所有搜索/替换字符解决方案都是危险的，应该避免。

试试这个：

```
String urlStr = "http://abc.dev.domain.com/0007AC/ads/800x480 15sec h.264.mp4";
URL url = new URL(urlStr);
URI uri = new URI(url.getProtocol(), url.getUserInfo(), url.getHost(), url.getPort(), url.getPath(), url.getQuery(), url.getRef());
url = uri.toURL(); 
```

您可以看到，在这个特定的 URL 中，我需要对这些空格进行编码，以便我可以将其用于请求。

这利用了 Android 类中提供给您的几个功能。首先，URL 类可以将 url 分解为其适当的组件，因此您无需进行任何字符串搜索/替换工作。其次，当您通过组件而不是从单个字符串构造 URI 时，这种方法利用了正确转义组件的 URI 类特性。

这种方法的美妙之处在于，您可以获取任何有效的 url 字符串并使其工作，而无需自己掌握任何特殊知识。

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2011-01-05T15:28:36.307

我开发的一个解决方案比任何其他解决方案都更稳定：

```
public class URLParamEncoder {

    public static String encode(String input) {
        StringBuilder resultStr = new StringBuilder();
        for (char ch : input.toCharArray()) {
            if (isUnsafe(ch)) {
                resultStr.append('%');
                resultStr.append(toHex(ch / 16));
                resultStr.append(toHex(ch % 16));
            } else {
                resultStr.append(ch);
            }
        }
        return resultStr.toString();
    }

    private static char toHex(int ch) {
        return (char) (ch < 10 ? '0' + ch : 'A' + ch - 10);
    }

    private static boolean isUnsafe(char ch) {
        if (ch > 128 || ch < 0)
            return true;
        return " %$&+,/:;=?@<>#%".indexOf(ch) >= 0;
    }

} 
```

* * *

## 回答 #5

> 赞同：39
> 
> 时间：2012-03-03T02:12:46.413

如果你有一个 URL，你可以将 url.toString() 传递给这个方法。首先解码，避免双重编码（例如，编码空格会导致 %20，编码百分号会导致 %25，所以双重编码会将空格变成 %2520）。然后，使用上面解释的 URI，添加 URL 的所有部分（这样您就不会删除查询参数）。

```
public URL convertToURLEscapingIllegalCharacters(String string){
    try {
        String decodedURL = URLDecoder.decode(string, "UTF-8");
        URL url = new URL(decodedURL);
        URI uri = new URI(url.getProtocol(), url.getUserInfo(), url.getHost(), url.getPort(), url.getPath(), url.getQuery(), url.getRef()); 
        return uri.toURL(); 
    } catch (Exception ex) {
        ex.printStackTrace();
        return null;
    }
} 
```

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2009-04-07T03:34:45.953

是的，URL 编码将对该字符串进行编码，以便将其在 url 中正确传递到最终目的地。例如，您不能拥有[http://stackoverflow.com?url=http://yyy.com](http://stackoverflow.com?url=http://yyy.com)。UrlEncoding 参数将修复该参数值。

所以我有两个选择给你：

1.  您是否有权访问与域分开的路径？如果是这样，您可以简单地对路径进行 UrlEncode。但是，如果不是这种情况，那么选项 2 可能适合您。

2.  获取 commons-httpclient-3.1。这有一个类 URIUtil：

    System.out.println(URIUtil.encodePath(" [http://example.com/x](http://example.com/x) y", "ISO-8859-1"));

这将准确地输出您要查找的内容，因为它只会对 URI 的路径部分进行编码。

仅供参考，您需要 commons-codec 和 commons-logging 才能使此方法在运行时工作。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2017-05-19T18:32:12.943

如果有人不想在他们的项目中添加依赖项，这些功能可能会有所帮助。

我们将 URL 的“路径”部分传递到此处。您可能不想将完整的 URL 作为参数传递（查询字符串需要不同的转义等）。

```
/**
 * Percent-encodes a string so it's suitable for use in a URL Path (not a query string / form encode, which uses + for spaces, etc)
 */
public static String percentEncode(String encodeMe) {
    if (encodeMe == null) {
        return "";
    }
    String encoded = encodeMe.replace("%", "%25");
    encoded = encoded.replace(" ", "%20");
    encoded = encoded.replace("!", "%21");
    encoded = encoded.replace("#", "%23");
    encoded = encoded.replace("$", "%24");
    encoded = encoded.replace("&", "%26");
    encoded = encoded.replace("'", "%27");
    encoded = encoded.replace("(", "%28");
    encoded = encoded.replace(")", "%29");
    encoded = encoded.replace("*", "%2A");
    encoded = encoded.replace("+", "%2B");
    encoded = encoded.replace(",", "%2C");
    encoded = encoded.replace("/", "%2F");
    encoded = encoded.replace(":", "%3A");
    encoded = encoded.replace(";", "%3B");
    encoded = encoded.replace("=", "%3D");
    encoded = encoded.replace("?", "%3F");
    encoded = encoded.replace("@", "%40");
    encoded = encoded.replace("[", "%5B");
    encoded = encoded.replace("]", "%5D");
    return encoded;
}

/**
 * Percent-decodes a string, such as used in a URL Path (not a query string / form encode, which uses + for spaces, etc)
 */
public static String percentDecode(String encodeMe) {
    if (encodeMe == null) {
        return "";
    }
    String decoded = encodeMe.replace("%21", "!");
    decoded = decoded.replace("%20", " ");
    decoded = decoded.replace("%23", "#");
    decoded = decoded.replace("%24", "$");
    decoded = decoded.replace("%26", "&");
    decoded = decoded.replace("%27", "'");
    decoded = decoded.replace("%28", "(");
    decoded = decoded.replace("%29", ")");
    decoded = decoded.replace("%2A", "*");
    decoded = decoded.replace("%2B", "+");
    decoded = decoded.replace("%2C", ",");
    decoded = decoded.replace("%2F", "/");
    decoded = decoded.replace("%3A", ":");
    decoded = decoded.replace("%3B", ";");
    decoded = decoded.replace("%3D", "=");
    decoded = decoded.replace("%3F", "?");
    decoded = decoded.replace("%40", "@");
    decoded = decoded.replace("%5B", "[");
    decoded = decoded.replace("%5D", "]");
    decoded = decoded.replace("%25", "%");
    return decoded;
} 
```

和测试：

```
@Test
public void testPercentEncode_Decode() {
    assertEquals("", percentDecode(percentEncode(null)));
    assertEquals("", percentDecode(percentEncode("")));

    assertEquals("!", percentDecode(percentEncode("!")));
    assertEquals("#", percentDecode(percentEncode("#")));
    assertEquals("$", percentDecode(percentEncode("$")));
    assertEquals("@", percentDecode(percentEncode("@")));
    assertEquals("&", percentDecode(percentEncode("&")));
    assertEquals("'", percentDecode(percentEncode("'")));
    assertEquals("(", percentDecode(percentEncode("(")));
    assertEquals(")", percentDecode(percentEncode(")")));
    assertEquals("*", percentDecode(percentEncode("*")));
    assertEquals("+", percentDecode(percentEncode("+")));
    assertEquals(",", percentDecode(percentEncode(",")));
    assertEquals("/", percentDecode(percentEncode("/")));
    assertEquals(":", percentDecode(percentEncode(":")));
    assertEquals(";", percentDecode(percentEncode(";")));

    assertEquals("=", percentDecode(percentEncode("=")));
    assertEquals("?", percentDecode(percentEncode("?")));
    assertEquals("@", percentDecode(percentEncode("@")));
    assertEquals("[", percentDecode(percentEncode("[")));
    assertEquals("]", percentDecode(percentEncode("]")));
    assertEquals(" ", percentDecode(percentEncode(" ")));

    // Get a little complex
    assertEquals("[]]", percentDecode(percentEncode("[]]")));
    assertEquals("a=d%*", percentDecode(percentEncode("a=d%*")));
    assertEquals(")  (", percentDecode(percentEncode(")  (")));
    assertEquals("%21%20%2A%20%27%20%28%20%25%20%29%20%3B%20%3A%20%40%20%26%20%3D%20%2B%20%24%20%2C%20%2F%20%3F%20%23%20%5B%20%5D%20%25",
                    percentEncode("! * ' ( % ) ; : @ & = + $ , / ? # [ ] %"));
    assertEquals("! * ' ( % ) ; : @ & = + $ , / ? # [ ] %", percentDecode(
                    "%21%20%2A%20%27%20%28%20%25%20%29%20%3B%20%3A%20%40%20%26%20%3D%20%2B%20%24%20%2C%20%2F%20%3F%20%23%20%5B%20%5D%20%25"));

    assertEquals("%23456", percentDecode(percentEncode("%23456")));

} 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2011-06-30T06:29:43.323

不幸的是，`org.apache.commons.httpclient.util.URIUtil`已弃用，并且`replacement org.apache.commons.codec.net.URLCodec`确实编码适合表单帖子，而不是实际的 URL。所以我必须编写自己的函数，它只做一个组件（不适合具有？和 & 的整个查询字符串）

```
public static String encodeURLComponent(final String s)
{
  if (s == null)
  {
    return "";
  }

  final StringBuilder sb = new StringBuilder();

  try
  {
    for (int i = 0; i < s.length(); i++)
    {
      final char c = s.charAt(i);

      if (((c >= 'A') && (c <= 'Z')) || ((c >= 'a') && (c <= 'z')) ||
          ((c >= '0') && (c <= '9')) ||
          (c == '-') ||  (c == '.')  || (c == '_') || (c == '~'))
      {
        sb.append(c);
      }
      else
      {
        final byte[] bytes = ("" + c).getBytes("UTF-8");

        for (byte b : bytes)
        {
          sb.append('%');

          int upper = (((int) b) >> 4) & 0xf;
          sb.append(Integer.toHexString(upper).toUpperCase(Locale.US));

          int lower = ((int) b) & 0xf;
          sb.append(Integer.toHexString(lower).toUpperCase(Locale.US));
        }
      }
    }

    return sb.toString();
  }
  catch (UnsupportedEncodingException uee)
  {
    throw new RuntimeException("UTF-8 unsupported!?", uee);
  }
} 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2009-04-07T03:46:16.457

正如您不幸发现的那样，URLEncoding 可以很好地编码 HTTP URL。您传入的字符串“ [http://search.barnesandnoble.com/booksearch/first](http://search.barnesandnoble.com/booksearch/first) book.pdf”已正确且完整地编码为 URL 编码形式。您可以将返回的整个 gobbledigook 长字符串作为 URL 中的参数传递，并且可以将其解码回您传入的字符串。

听起来您想做一些不同于将整个 URL 作为参数传递的事情。根据我收集的信息，您正在尝试创建一个类似于“ [http://search.barnesandnoble.com/booksearch/whateverTheUserPassesIn](http://search.barnesandnoble.com/booksearch/whateverTheUserPassesIn) ”的搜索 URL。您唯一需要编码的是“whateverTheUserPassesIn”位，所以也许您需要做的就是这样的：

```
String url = "http://search.barnesandnoble.com/booksearch/" + 
       URLEncoder.encode(userInput,"UTF-8"); 
```

那应该会产生对您更有效的东西。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2015-06-04T10:02:20.380

我阅读了以前的答案来编写自己的方法，因为使用以前的答案的解决方案无法正常工作，这对我来说看起来不错，但是如果您能找到不适用于此的 URL，请告诉我。

```
public static URL convertToURLEscapingIllegalCharacters(String toEscape) throws MalformedURLException, URISyntaxException {
            URL url = new URL(toEscape);
            URI uri = new URI(url.getProtocol(), url.getUserInfo(), url.getHost(), url.getPort(), url.getPath(), url.getQuery(), url.getRef());
            //if a % is included in the toEscape string, it will be re-encoded to %25 and we don't want re-encoding, just encoding
            return new URL(uri.toString().replace("%25", "%"));
} 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2010-09-28T07:33:51.397

如果您的 URL 中有编码的“/” (%2F)，仍然存在问题。

RFC 3986 - 第 2.2 节说：“如果 URI 组件的数据与保留字符作为分隔符的用途发生冲突，则冲突数据必须在 URI 形成之前进行百分比编码。” （RFC 3986 - 第 2.2 节）

但是Tomcat有一个问题：

> [http://tomcat.apache.org/security-6.html](http://tomcat.apache.org/security-6.html) - 在 Apache Tomcat 6.0.10 中修复
> 
> 重要：目录遍历 CVE-2007-0450
> 
> Tomcat 允许 '\'、'%2F' 和 '%5C' [...]。
> 
> 以下 Java 系统属性已添加到 Tomcat，以提供对 URL 中路径分隔符处理的额外控制（这两个选项默认为 false）：
> 
> *   org.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH：真|假
> *   org.apache.catalina.connector.CoyoteAdapter.ALLOW_BACKSLASH：真|假
> 
> 由于无法保证所有 URL 都由 Tomcat 处理，就像它们在代理服务器中一样，所以 Tomcat 应该始终受到保护，就好像没有使用限制上下文访问的代理一样。
> 
> 影响：6.0.0-6.0.9

因此，如果您有一个带有 %2F 字符的 URL，Tomcat 会返回：“400 Invalid URI: noSlash”

您可以在 Tomcat 启动脚本中切换错误修复：

```
set JAVA_OPTS=%JAVA_OPTS% %LOGGING_CONFIG%   -Dorg.apache.tomcat.util.buf.UDecoder.ALLOW_ENCODED_SLASH=true 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2011-06-04T14:03:06.277

我同意马特的观点。确实，我从来没有在教程中看到过很好的解释，但是一个问题是如何对 URL 路径进行编码，而一个非常不同的问题是如何对附加到 URL 的参数进行编码（查询部分，在 "? “ 象征）。它们使用相似的编码，但不一样。

专门用于空白字符的编码。URL 路径需要将其编码为 %20，而查询部分允许使用 %20 以及“+”号。最好的办法是我们自己使用 Web 浏览器针对我们的 Web 服务器对其进行测试。

对于这两种情况，我**总是**会编码**COMPONENT BY COMPONENT**，而不是整个字符串。确实 URLEncoder 允许查询部分。对于路径部分，您可以使用类 URI，尽管在这种情况下它要求提供整个字符串，而不是单个组件。

无论如何，我相信**避免这些问题的最好方法是使用个人非冲突设计。**如何？例如，我绝不会使用 aZ、AZ、0-9 和 _ 以外的其他字符来命名目录或参数。这样，唯一需要对每个参数的值进行编码，因为它可能来自用户输入并且使用的字符是未知的。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2013-03-14T06:49:50.420

也许可以在 org.springframework.web.util中尝试[UriUtils](http://static.springsource.org/spring/docs/3.0.x/api/org/springframework/web/util/UriUtils.html#encodeUri%28java.lang.String,%20java.lang.String%29)

```
UriUtils.encodeUri(input, "UTF-8") 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2016-05-18T11:54:16.020

您还可以使用`GUAVA`路径转义器： `UrlEscapers.urlFragmentEscaper().escape(relativePath)`

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2011-07-29T13:20:53.443

除了 Carlos Heuberger 的回复：如果需要不同于默认值 (80)，则应使用 7 参数构造函数：

```
URI uri = new URI(
        "http",
        null, // this is for userInfo
        "www.google.com",
        8080, // port number as int
        "/ig/api",
        "weather=São Paulo",
        null);
String request = uri.toASCIIString(); 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2018-04-12T13:07:40.920

使用以下标准 Java 解决方案（通过[Web Platform Tests](https://github.com/web-platform-tests/wpt/blob/master/url/resources/urltestdata.json)提供的大约 100 个测试用例）：

**0.** [测试 URL 是否已经编码](https://stackoverflow.com/a/53776285/1485527)。

**1.**将 URL 拆分为结构部分。`java.net.URL` 为之使用。

**2.** 正确编码每个结构部分！

**3.**使用[Punycode](https://en.wikipedia.org/wiki/Punycode)对主机名进行编码`IDN.toASCII(putDomainNameHere)`！

**4.**用于`java.net.URI.toASCIIString()`百分比编码，NFC 编码的 unicode -（最好是 NFKC！）。

在此处查找更多信息：[https ://stackoverflow.com/a/49796882/1485527](https://stackoverflow.com/a/49796882/1485527)

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2018-08-08T19:41:51.027

我把上面的内容做了一些改动。我首先喜欢积极的逻辑，我认为 HashSet 可能比其他一些选项提供更好的性能，比如搜索字符串。虽然，我不确定自动装箱惩罚是否值得，但如果编译器针对 ASCII 字符进行优化，那么装箱成本会很低。

```
/***
 * Replaces any character not specifically unreserved to an equivalent 
 * percent sequence.
 * @param s
 * @return
 */
public static String encodeURIcomponent(String s)
{
    StringBuilder o = new StringBuilder();
    for (char ch : s.toCharArray()) {
        if (isSafe(ch)) {
            o.append(ch);
        }
        else {
            o.append('%');
            o.append(toHex(ch / 16));
            o.append(toHex(ch % 16));
        }
    }
    return o.toString();
}

private static char toHex(int ch)
{
    return (char)(ch < 10 ? '0' + ch : 'A' + ch - 10);
}

// https://tools.ietf.org/html/rfc3986#section-2.3
public static final HashSet<Character> UnreservedChars = new HashSet<Character>(Arrays.asList(
        'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z',
        'a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z',
        '0','1','2','3','4','5','6','7','8','9',
        '-','_','.','~'));
public static boolean isSafe(char ch)
{
    return UnreservedChars.contains(ch);
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-07-26T06:45:36.157

如果你用的是spring，你可以试试 `org.springframework.web.util.UriUtils#encodePath`

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-01-15T05:00:00.093

我创建了一个新项目来帮助构建 HTTP URL。该库将自动对路径段和查询参数进行 URL 编码。

[您可以在https://github.com/Widen/urlbuilder](https://github.com/Widen/urlbuilder)查看源代码并下载二进制文件

此问题中的示例 URL：

```
new UrlBuilder("search.barnesandnoble.com", "booksearch/first book.pdf").toString() 
```

生产

`http://search.barnesandnoble.com/booksearch/first%20book.pdf`

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-04-03T09:55:32.027

我有同样的问题。通过取消解决这个问题：

```
android.net.Uri.encode(urlString, ":/"); 
```

它对字符串进行编码，但跳过“：”和“/”。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2014-03-18T14:57:01.053

我开发了一个用于此目的的库：[galimatias](https://github.com/smola/galimatias)。它解析 URL 的方式与 Web 浏览器相同。也就是说，如果一个 URL 在浏览器中工作，它会被[galimatias](https://github.com/smola/galimatias)正确解析。

在这种情况下：

```
// Parse
io.mola.galimatias.URL.parse(
    "http://search.barnesandnoble.com/booksearch/first book.pdf"
).toString() 
```

会给你：`http://search.barnesandnoble.com/booksearch/first%20book.pdf`。当然，这是最简单的情况，但它适用于任何东西，远远超出`java.net.URI`.

您可以在以下位置查看：[https ://github.com/smola/galimatias](https://github.com/smola/galimatias)

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2019-09-16T11:41:22.427

我用这个

```
org.apache.commons.text.StringEscapeUtils.escapeHtml4("my text % & < >"); 
```

添加此依赖项

```
 <dependency>
        <groupId>org.apache.commons</groupId>
        <artifactId>commons-text</artifactId>
        <version>1.8</version>
    </dependency> 
```

* * *

## 回答 #23

> 赞同：-3
> 
> 时间：2014-08-22T23:13:12.767

您可以使用这样的功能。根据您的需要完成并修改它：

```
/**
     * Encode URL (except :, /, ?, &, =, ... characters)
     * @param url to encode
     * @param encodingCharset url encoding charset
     * @return encoded URL
     * @throws UnsupportedEncodingException
     */
    public static String encodeUrl (String url, String encodingCharset) throws UnsupportedEncodingException{
            return new URLCodec().encode(url, encodingCharset).replace("%3A", ":").replace("%2F", "/").replace("%3F", "?").replace("%3D", "=").replace("%26", "&");
    } 
```

使用示例：

```
String urlToEncode = ""http://www.growup.com/folder/intérieur-à_vendre?o=4";
Utils.encodeUrl (urlToEncode , "UTF-8") 
```

结果是：[http ://www.growup.com/folder/int%C3%A9rieur-%C3%A0_vendre?o=4](http://www.growup.com/folder/int%C3%A9rieur-%C3%A0_vendre?o=4)

* * *

## 回答 #24

> 赞同：-7
> 
> 时间：2012-03-20T01:11:54.883

怎么样：

公共字符串 UrlEncode（字符串 in_）{

```
String retVal = "";

try {
    retVal = URLEncoder.encode(in_, "UTF8");
} catch (UnsupportedEncodingException ex) {
    Log.get().exception(Log.Level.Error, "urlEncode ", ex);
}

return retVal; 
```

}

# ruby-on-rails - 是否可以只在部分中放置一个rails表单元素？

> ID：724045
> 
> 赞同：6
> 
> 时间：2009-04-07T03:31:41.437
> 
> 标签：ruby-on-rails, ruby, forms, renderpartial, partials

我的应用程序有一个选择框供用户选择“地点”。如您所料，此选择框是一个表单。我在页面上的某处也有一个动作，它通过 AJAX 创建一个新的场地。创建新场地后，我想更新场地选择框以反映这一点。

我的解决方案是将选择框放在部分中，并从控制器中的创建操作中呈现部分。

```
 <div id="venue_select" style="clear: both;">
    <%= render :partial => 'venue/venue_select_box' %>
 </div> 
```

部分看起来像这样：

```
<%= f.collection_select :venue_id, @user_venues, :id, :name, :prompt => 'Select a venue' %> 
```

其中 f 是表单引用：

```
<% form_for :shows do |f| %> 
```

问题是 f 在部分中未定义，因此出现错误。一种解决方案是包含整个表单，但我觉得这不是必需的，因为我没有更新整个表单。关于如何解决这个问题的任何想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T03:36:46.370

您可以像这样将变量传递给部分：

```
 <%= render :partial => 'venue/venue_select_box', :locals => { :f => f } %> 
```

对于这样的东西，看看[文档](http://api.rubyonrails.org/classes/ActionController/Base.html#M000633)总是好的。

编辑：要使用带有 AJAX 请求的部分，您需要在 .rjs 模板中“重新创建”表单。因此，在您的控制器中，您需要再次找到该对象。

```
 def venue_select
    @venue = Venue.find(params[:id])
    respond_to do |format|
      format.html
      format.js
    end
 end 
```

然后在您的场地/venue_select.rjs 文件中：

```
 form_for @venue do |f|
   page[:element].replace_html :partial => 'venue/venue_select_box', :locals => { :f => f }
 end 
```

`:element`您要替换的选择菜单的 id 在哪里。基本上，您只需重新创建 form_for，然后使用它来更新选择字段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T18:13:38.057

使用 Javascript 将场地添加到选择框可能更容易，作为`onComplete`AJAX 添加的挂钩。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T12:50:24.597

我同意 Sarah Mei 的观点，如果您的 AJAX 调用返回已添加场地的 JSON 表示，然后创建一个新选项并将其添加到选择元素中。

一些用于添加选择选项的通用 JS 代码：

```
var newOption = new Option("Text", "Value");
selectElement.options[selectElement.options.length] = newOption; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T16:16:46.287

这些都是不错的选择，但我认为我找到了最简单的。基本上，我只是在 collection_select 中硬编码了名称，所以我不需要“f”变量：

```
<%= collection_select 'shows[venue_id]', :venue_id, @user_venues, :id, :name, { :prompt => 'Select one of your previous venues' } %> 
```

那么我的VenueController如下：

```
class VenueController < ApplicationController
  layout 'main'
  before_filter :login_required, :get_user

  def create
    begin
      venue = @user.venues.create(params[:venue])
      @user_venues = @user.venues
      render :partial => 'venue_select_box', :success => true, :status => :ok
    rescue ActiveRecord::RecordInvalid => invalid
      flash[:errors] = invalid.record.errors
      render :text => '', :success => false, :status => :unprocessable_entity
    end
  end

end 
```

如果由于某种原因这种方法是不好的做法，请告诉我，我很乐意为您提供答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-11-19T23:10:30.417

我认为您的解决方案还不错，但是如果您尝试以另一种形式使用此部分，则生成的字段名称会出现问题。

为避免这种情况，您可以在 ajax 调用中提交 f.object_name 的内容。在您的情况下，它将是“shows”，因为方法是：venue_id，所以生成的名称将是“shows[venue_id]”。

# linux - 在哪里可以找到 i486-linux-gnu 指令集的中断列表？

> ID：724048
> 
> 赞同：0
> 
> 时间：2009-04-07T03:33:28.547
> 
> 标签：linux, assembly, gnu, compiler-construction, gnu-assembler

我正在为我在学校的高级项目开发一个编译器，并且我正在使用 AS (GNU Assembler) 进行汇编。我所有的测试都相当成功，但我所见过的中断列表似乎没有工作或与我的测试代码匹配。

该版本AS的相关信息：

*GNU assembler 2.17 Debian GNU/Linux 版权所有 2005 Free Software Foundation, Inc。您可以根据 GNU 通用公共许可证的条款重新分发它。该程序绝对没有任何保证。这个汇编器是为“i486-linux-gnu”的目标配置的。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-01-06T02:53:34.480

在 linux 中，您使用一个中断：80h。该中断对应的系统调用可在[此表](http://bluemaster.iu.hio.no/edu/dark/lin-asm/syscalls.html)中找到。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T08:43:49.643

Linux 不像 DOS 那样使用中断来进行系统调用。它使用与体系结构相关的方法进行系统调用，在 x86 上可以是 int 0x80，但现代 (Pentium+) CPU 应该使用 SYSENTER 指令。不使用其他软件中断。

通常您不必担心这一点，因为即使在汇编语言中，您可能仍想使用包装这些的 C 库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T04:30:05.777

恕我直言，连接中断的方式是特定于硬件的。查看 Linux 内核如何处理目标硬件上的中断可能具有教育意义。

# css - 如何管理子组件的样式？

> ID：724054
> 
> 赞同：1
> 
> 时间：2009-04-07T03:38:00.783
> 
> 标签：css, apache-flex, styles

[如何为自定义 Flex 组件定义默认样式？](https://stackoverflow.com/questions/497359)是一个好的开始，但我想为包含其他组件的自定义组件创建自定义样式。

自定义组件是 Canvas。它包含其他画布、按钮、列表等。我不想让子组件使用与父组件相同的值，并且我想让一些样式值“跳转”父组件并且只影响特定的子组件（不是所有的人）。

我想有一个单一的 CSS 定义，其中包含父组件和每个子组件的值，而不是每个单独的样式。

我可以在 CSS 文件中包含实际上不是标准 CSS 的样式值（例如 buttonCornerRadius、mainPaneBackgroundColor、actionBitmap）吗？

我应该在哪里将样式传播到子组件？this.updateDisplayList() ？

我怎么知道值是通过 setStyle 更改还是加载新的 CSS 文件（因为 StyleManager 没有事件）？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T14:17:00.717

更细化的方法是为每个孩子添加 CSS，但这是维护和可读性的噩梦。

```
<mx:List dataProvider="{companies}" dropShadowEnabled="true" paddingTop="10" paddingBottom="10" paddingRight="5" paddingLeft="15" backgroundColor="0xDFE8FF"/> 
```

一种不那么细化的方法是将每个孩子创建为一个类，并将 CSS 添加到每个类文件中，但这仍然不是很好。

您还可以在主 CSS 中为每种类型的子组件（列表、组合框、按钮等）设置样式：

```
List {
    dropShadowEnabled: true;
    paddingTop: 10;
} 
```

但是，如果您对同一类型的组件有不同的样式，您有几个选择。

您可以给每个孩子一个 styleName，然后在主 CSS 中设置样式：

```
CustomerSelectionForm.mxml:

<?xml version="1.0" encoding="utf-8"?>
<mx:Form xmlns:mx="http://www.adobe.com/2006/mxml">
    <mx:List styleName="customerList" dataProvider="{customers}" />
</mx:Form>

CompanySelectionForm.mxml:

<?xml version="1.0" encoding="utf-8"?>
<mx:Form xmlns:mx="http://www.adobe.com/2006/mxml">
    <mx:List styleName="companyList" dataProvider="{companies}" />
</mx:Form>

styles.css:

.customerList {
    backgroundColor: "0xDFE8FF";
}

.companyList {
    backgroundColor: "0x74ADE7";
} 
```

或者，您可以将每个子类创建为自定义类，然后在主 CSS 中引用该类。

```
CustomerList.mxml:

<?xml version="1.0" encoding="utf-8"?>
<mx:List xmlns:mx="http://www.adobe.com/2006/mxml">
</mx:List>

CompanyList.mxml:

<?xml version="1.0" encoding="utf-8"?>
<mx:List xmlns:mx="http://www.adobe.com/2006/mxml">
</mx:List>

styles.css:

CustomerList {
    backgroundColor: "0xDFE8FF";
}

CompanyList {
    backgroundColor: "0x74ADE7";
} 
```

如果您动态构建组件或重用特定类型的组件，此方法特别有用。我经常使用这种方法，特别是因为这些自定义类也可以包含特定于类的业务逻辑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T20:38:21.560

作为一名 Flex 组件开发人员，我尝试做 Flex 团队在框架中所做的事情：为您想要单独设置样式的每个子项公开 styleName 样式。您甚至可以将它们链接在一起。作为直接来自框架的示例，`ComboBox`具有`dropdownStyleName`下拉列表的样式，并`List`具有`verticalScrollBarStyleName`用于其垂直滚动条的样式。

```
ComboBox
{
    dropdownStyleName: myComboDropdownStyles;
}

.myComboDropdownStyles
{
    backgroundColor: #c4c4ff;
    verticalScrollBarStyleName: myVScrollBarStyles;
}

.myVScrollBarStyles
{
    borderColor: #8686a4;
} 
```

# php - 从文件夹中获取图像输入，并在调整大小后将其存储到输出文件夹

> ID：724057
> 
> 赞同：0
> 
> 时间：2009-04-07T03:42:18.527
> 
> 标签：php, image-processing

我需要从文件夹中获取图像序列作为输入，调整大小后，调整大小的图像应存储在输出文件夹中。我写了代码。但是在我调整图像大小后的代码中，输出文件夹只有一个黑色图像。

要调试此代码，请创建输入和输出文件夹并将一些 gif 图像放在输入文件夹上，然后在输出文件夹上查看输出。请帮忙。

```
<?php
$dir = opendir("input/");
$i   = 0;
while ($imgfile = readdir($dir))
  {
    if ($imgfile != "." && $imgfile != "..")
      {
        $imgarray[$i] = $imgfile;
        $newwidth     = 240; //new width
        $newheight    = 320; //new height
        $uploadedfile = $imgarray[$i];
        $src          = imagecreatefromgif($uploadedfile);
        list($width, $height) = getimagesize($uploadedfile);
        $tmp = imagecreatetruecolor($newwidth, $newheight);
        imagecopyresampled($tmp, $src, 0, 0, 0, 0, $newwidth, $newheight, $width, $height);
        $filename = "output/" . $imgarray[$i];
        imagegif($tmp, $filename, 100);
        imagedestroy($src);
        imagedestroy($tmp);
        $i++;
      }
  }
closedir($dir);
?> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T03:53:34.707

您的错误在这一行：

```
$uploadedfile = $imgarray[$i]; 
```

您的图像位于输入文件夹中，但这会将变量设置为仅图像名称，因此当您尝试调用`imagecreatefromgif`并且`getimagesize`找不到图像时，会导致您得到黑色输出。要修复，只需在名称前添加正确的目录：

```
$uploadedfile = "input/" . $imgarray[$i]; 
```

对此更改进行了测试，并且可以正常工作。

附带说明一下，通过启用 error_reporting ，我能够*快速找到您的代码有什么问题：*

```
error_reporting(E_ALL);
ini_set('display_errors', 1); 
```

通过这样做，您将收到警告消息，并且您可能看不到其他消息。这些可能是快速修复和数小时撕掉头发之间的区别。调试时使用它。

# makefile - 创建嵌套的makefile

> ID：724058
> 
> 赞同：12
> 
> 时间：2009-04-07T03:42:22.130
> 
> 标签：makefile, nested

我正在学习*makefile*，我知道如何创建一个简单的makefile。我将继续使用嵌套的 makefile。这是我的目录结构

```
/src
...makefile
...main.cpp
...foo
......makefile
......foo.cpp
......foo.h 
```

当调用 root *makefile*时，它​​会调用目录*foo*中的 makefile 。这是我的问题

1.  我应该使用哪个*makefile*来编写链接所有目标文件的代码？如果它在根 makefile 中，我是否需要在那里指定所有目标文件名？
2.  这是嵌套生成文件的最佳实践吗？还是只有一个根目录下的 makefile 好？

任何帮助都会很棒！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-07T03:46:14.663

**不**这样做有很多话要说。阅读[Recursive Make Considered Harmful](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fmiller.emu.id.au%2Fpmiller%2Fbooks%2Frmch%2F&ei=eMzaScjUEoHNlQfmt4T6Bw&usg=AFQjCNGdTjj65VE-XOzS-Shg765NjGjUOw)。也是[PDF 格式](http://www.google.com/url?sa=t&source=web&ct=res&cd=2&url=http%3A%2F%2Faegis.sourceforge.net%2Fauug97.pdf&ei=eMzaScjUEoHNlQfmt4T6Bw&usg=AFQjCNHNpBwPrZj4wjVZcyFfqmagq0M2JQ)。

简短的版本是递归 make 有效地构建了几个不相交但可能重叠的依赖树，并且不能保证正确或最大效率的构建。如果您希望并行构建，问题会变得更糟。

为了解决这个问题，你安排了一个单一的、非递归的 make 来构建一个单一的全跨依赖树，它允许 make 解决上述所有问题。

非递归构造的示例结构和编写它们时出现的几个棘手问题的解决方案可以在原始论文和以下答案中找到：

*   [你对非递归make有什么经验？](https://stackoverflow.com/questions/559216/what-is-your-experience-with-non-recursive-make)
*   [递归Make - 朋友还是敌人？](https://stackoverflow.com/questions/319764/recursive-make-friend-or-foe)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T03:48:02.817

递归 make 通常被认为是有害的。

如果您真的希望能够在根目录中键入“make”并让它仅使用 POSIX makefile 构建所有内容，那么这是唯一的方法。在这种情况下，将子项目链接到它们自己的目录中，并将最终的东西放在根目录中。

如果您愿意使用 gmake 语法，请查看此处的 Makefile：http: [//github.com/singpolyma/theveeb-ecosystem](http://github.com/singpolyma/theveeb-ecosystem)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T04:02:37.697

有更现代的构建系统，例如[SCons](http://www.scons.org/)，它们的语法比 make 更简单，并且避免了许多 make 的陷阱。例如 SCons 扫描源文件以确定它自己的依赖关系，而对于 make 需要手动指定依赖关系。例如，如果你在一个实现文件中添加一个新的#include 语句，那么如果头发生变化，make 将不会重新编译那个实现文件（除非你添加了新的依赖项）。SCons 将自动检测新的依赖项并重新编译任何必要的内容。

# c++ - 如何在 OpenGL 中将文本渲染到正方形（4 个顶点）？

> ID：724060
> 
> 赞同：1
> 
> 时间：2009-04-07T03:43:34.403
> 
> 标签：c++, opengl, textures

我正在使用 Linux 和 GLUT。我有一个正方形如下：

```
glVertex3f(-1.0, +1.0, 0.0); // top left
glVertex3f(-1.0, -1.0, 0.0); // bottom left
glVertex3f(+1.0, -1.0, 0.0); // bottom right
glVertex3f(+1.0, +1.0, 0.0); // top right 
```

我想我不能使用`glutBitmapCharacter`，因为这[仅适用于 2D Ortho](https://stackoverflow.com/questions/14318/using-glut-bitmap-fonts)。

很简单，我想渲染“Hello world！” 在所述广场上的任何地方。我应该创建一个纹理，然后使用它应用到顶点`glTexCoord2f`吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T16:15:09.777

最简单的方法是从图像加载字体映射，例如由[位图字体生成器](http://www.lmnopc.com/bitmapfontbuilder/)生成的字体映射（我知道它是 windows，但我找不到适用于 linux 的字体映射），例如：

![位图字体示例](https://i.stack.imgur.com/VFKM2.gif)

该示例是 256x256 的 gif，尽管您可以将其转换为 png/tga/bmp。它是完整的 ASCII 映射网格，16x16 个字符。加载纹理并使用 glTexCoord2f 将其排列在您的四边形上，您应该一切顺利。

这是使用上述位图的示例：

```
unsigned texture = 0;

void LoadTexture()
{
    // load 24-bit bitmap texture
    unsigned offset, width, height, size;
    char *buffer;
    FILE *file = fopen("text.bmp", "rb");
    if (file == NULL)
        return;
    fseek(file, 10, SEEK_SET);
    fread(&offset, 4, 1, file);
    fseek(file, 18, SEEK_SET);
    fread(&width, 1, 4, file);
    fread(&height, 1, 4, file);

    size = width * height * 3; 
    buffer = new char[size];

    fseek(file, offset, SEEK_SET);
    fread(buffer, 1, size, file);

    glEnable(GL_TEXTURE_2D);
    glGenTextures(1, &texture);
    glBindTexture(GL_TEXTURE_2D, texture);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, buffer);

    fclose(file);
    printf("Loaded\n");
}

void DrawCharacter(char c)
{
    int column = c % 16, row = c / 16;
    float x, y, inc = 1.f / 16.f;
    x = column * inc;
    y = 1 - (row * inc) - inc;

    glBegin(GL_QUADS);
      glTexCoord2f( x,       y);       glVertex3f( 0.f, 0.f, 0.f);
      glTexCoord2f( x,       y + inc); glVertex3f( 0.f, 1.f, 0.f);
      glTexCoord2f( x + inc, y + inc); glVertex3f( 1.f, 1.f, 0.f);
      glTexCoord2f( x + inc, y);       glVertex3f( 1.f, 0.f, 0.f);
    glEnd();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T10:51:20.477

事实上，渲染到位图是一种解决方案。在 GameDev上有一个关于如何做到这一点的不错的[教程](http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=43)。

# forms - 提交到 Web 服务的 InfoPath 浏览器表单中的中文字符显示为问号

> ID：724069
> 
> 赞同：0
> 
> 时间：2009-04-07T03:46:15.833
> 
> 标签：forms, browser, character-encoding, infopath, cjk

我有一个将 InfoPath 表单提交到工作流的 Web 服务。当我从浏览器提交表单时，输入到文本框或富文本框中的中文字符会作为问号传递给服务。该服务公开了两种方法：一种将表单作为 XML 字符串，另一种将其作为 XML 文档。两者都会出现问题。从 InfoPath 应用程序提交表单时不会出现问题；如果我使用浏览器手动创建表单并将其保存到 SharePoint 库，也不会发生这种情况。任何帮助将非常感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T11:43:01.927

您没有提供足够的详细信息来正确诊断，但显然您遇到了使用错误编码的问题。检查浏览器表单页面的编码；它应该与接收脚本预期的编码相匹配。如果您想支持中文和其他字符，则该编码需要是传统的中文编码之一，或者（更好的主意）UTF-8。

# oracle - 哪种表结构更好

> ID：724076
> 
> 赞同：0
> 
> 时间：2009-04-07T03:50:45.447
> 
> 标签：oracle, database-design

为了在 Oracle 中进行报告，我们必须创建几个表。

选项1

**应收账款表**

*   参考编号
*   日期
*   TrnType eg:Tax, Fee, Premium
*   数量

选项 2

**应收账款表**

*   参考编号
*   日期
*   税
*   费用
*   优质的

注意：对于给定的 RefNo，可以存在所有类型的 Tax、Fee 和 Premium 或它们的子集。

什么是最佳结构（表将有超过 10 万条记录）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-07T03:56:27.463

这两个实际上都不是最好的（就 DBA 的想法而言）。最好的是（假设 RefNo 是唯一的，因此是主键）：

```
Receivables:
    RefNo
    Date
ReceivableDollarVals:
    RefNo
    Type
    Amount 
```

如果 RefNo/Date 是主键，则也将日期添加到第二个表中。

这使您可以最小化那些不具有所有三种类型的行的存储空间（尽管节省的空间很小）。然后，您使用`WHERE`组合两个表（或 s）的子句`JOIN`来进行查询。

它还允许您在不重组数据库的情况下随意添加其他类型。

但是，您需要记住，第三范式是理想的。只要您了解其中的含义，违反规则以获得性能是完全可以接受的。

100,000 条记录实际上很小，因此，除非您认为您将在不久的将来添加更多类型，否则我会选择您的选项 2，并对那些不存在的值使用零。NULL 很可能会使您的查询更复杂一些。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T03:53:44.163

如果您的事务类型是明确定义的并且不太可能被稀疏填充（即，大多数记录将具有所有 3 的值），那么后者更有可能是您的最佳选择。它还以更接近您在现实中的想法的格式表示数据。

即使值可以稀疏，“直觉”让我仍然倾向于基于列的方法而不是基于行的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T13:11:19.733

第一个答案中完全规范化版本的真正优势在于需求发生变化——当有人更改规范时，您必须添加超出您确定的 3 种类型的类型。

比如折扣、退款等等。这些变化确实发生了。

规范化结构应该让您更轻松地做到这一点，而无需更改表结构或大多数使用数据的程序。

但是规范化的结构在开始时确实需要更多的投资——每个新事务都涉及插入到 2 个表中，您需要有一个检查约束来控制类型等。

一般来说，从长远来看，使用标准化结构你会做得更好。但是，对于像这样的简单案例，您有时可以在没有正常化的情况下逃脱并且不必承担后果（至少，在您早已离开之前没有人需要支付费用，这是其他人的问题）。

从专业上讲，合理的标准化水平应该是您的标准策略，并且您应该要求自己有充分的理由进行非标准化。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-14T05:32:01.487

如果表将有超过 10 万条记录。那么选项2是不错的选择。Bcz 选项 1 减慢数据的访问速度。

# powershell - Unix 换行符到 Windows 换行符（在 Windows 上）

> ID：724083
> 
> 赞同：35
> 
> 时间：2009-04-07T03:57:30.143
> 
> 标签：powershell, newline, line-breaks

Windows 中是否有一种方法（比如 PowerShell 或工具）可以递归目录并将任何 Unix 文件转换为 Windows 文件。

我会对 PowerShell 中至少检测 Unix 文件的方法感到非常满意。

对单个文件执行此操作很容易，但我追求的是更具可扩展性的东西（因此倾向于 PowerShellish 解决方案）。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-07T20:02:40.837

如果您有兴趣，这里是纯 PowerShell 方式。

查找至少有一个 Unix 行结尾的文件 (PowerShell v1)：

```
dir * -inc *.txt | %{ if (gc $_.FullName -delim "`0" | Select-String "[^`r]`n") {$_} } 
```

这是您如何找到并将 Unix 行尾转换为 Windows 行尾的方法。需要注意的重要一点是，如果文件末尾还没有结束行，则会在文件末尾添加一个额外的行结束符 (\r\n)。如果你真的不想这样，我会发布一个如何避免它的例子（它有点复杂）。

```
Get-ChildItem * -Include *.txt | ForEach-Object {
    ## If contains UNIX line endings, replace with Windows line endings
    if (Get-Content $_.FullName -Delimiter "`0" | Select-String "[^`r]`n")
    {
        $content = Get-Content $_.FullName
        $content | Set-Content $_.FullName
    }
} 
```

上述工作是因为 PowerShell 将自动拆分 \n 上的内容（如果存在则删除 \r），然后在将每个内容（在本例中为一行）写入文件时添加 \r\n。这就是为什么你总是在文件末尾结束一行。

另外，我编写了上面的代码，以便它只修改它需要的文件。如果您不在乎，可以删除该`if`声明。哦，确保只有文件到达[ForEach-Object](https://docs.microsoft.com/en-us/powershell/module/Microsoft.PowerShell.Core/ForEach-Object)。除此之外，您可以在该管道开始时进行任何您想要的过滤。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-07T04:05:04.713

[Cygwin](http://cygwin.com/)中有 dos2unix 和 unix2dos 。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2016-09-19T14:26:35.693

这似乎对我有用。

```
Get-Content Unix.txt | Out-File Dos.txt 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-07T04:31:25.833

下载[Vim](http://www.vim.org/download.php#pc)，打开你的文件，然后发出

```
:se fileformat=dos|up 
```

批处理多个文件（C:\tmp 中的所有 *.txt 文件 - 递归）：

```
:args C:\tmp\**\*.txt
:argdo se fileformat=dos|up 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T04:35:11.630

您可以使用[Visual Studio](https://en.wikipedia.org/wiki/Microsoft_Visual_Studio)。菜单*文件*→*高级保存选项*...。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T04:13:04.037

*如果 Cygwin 不适合您，那么如果您在 google 周围搜索，有许多适用于 Windows 下的unix2dos*的独立可执行文件，或者您可以自己编写一个。[在此处](https://stackoverflow.com/questions/313178/whats-the-best-way-of-doing-dos2unix-on-a-500k-line-file-in-windows)查看我的类似（转换的相反方向）问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-08-01T01:21:59.047

在包含 10,000 个文件的循环中测试先前答案中给出的代码的结果，其中许多文件的大小超过 50 KB：

底线是 PowerShell 代码对于大文件和大量文件非常低效/缓慢/无法使用。它也不保留[BOM](https://en.wikipedia.org/wiki/Byte_order_mark)字节。我发现 unix2dos 7.2.3 是最快和最实用的解决方案。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-10-01T14:21:57.107

转换为 Windows 文本可能很简单：

```
(Get-Content file) | Set-Content file 
```

使用以下内容（带有消极的后视）。如果没有`-nonewline`， set-content 会在底部添加一个额外的 `r`n。使用括号，您可以修改同一个文件。这对于意外对同一个文件执行两次应该是安全的。

```
function unix2dos ($infile, $outfile) {
    (Get-Content -raw $infile) -replace "(?<!`r)`n","`r`n" |
    Set-Content -nonewline $outfile
} 
```

反过来是这样，Windows 到 Unix 文本：

```
function dos2unix ($infile, $outfile) {
    (Get-Content -raw $infile) -replace "`r`n","`n" |
    Set-Content -nonewline $outfile
} 
```

这是另一个用于无法放入内存的大文件的版本。但是输出文件必须不同。

```
Function Dos2Unix ($infile, $outfile) {
  Get-Content $infile -ReadCount 1000 | % { $_ -replace '$',"`n" } |
  Set-Content -NoNewline $outfile
} 
```

示例（输入和输出文件可以相同）：

```
dos2unix dos.txt unix.txt
unix2dos unix.txt dos.txt
unix2dos file.txt file.txt 
```

如果你有 Emacs，你可以用`esc-x hexl-mode`. 记事本无法正确显示 Unix 文本；都将在同一条线上。我必须为 指定路径`set-content`，因为`-replace`会删除该`pspath`属性。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-12-05T23:14:17.620

[在写字板](https://en.wikipedia.org/wiki/WordPad)中打开一个以 Unix 行结尾的文件并保存它会将所有行结尾重写为 DOS。对于大量文件来说有点费力，但对于偶尔的几个文件来说效果很好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-11-13T01:44:27.040

这个对我有用：

```
 Get-ChildItem -Recurse -File | % { $tmp = Get-Content $_; $tmp | Out-File "$_" -Encoding UTF8 } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-04-22T10:44:31.350

基于[js2010 的回答](https://stackoverflow.com/questions/724083/unix-newlines-to-windows-newlines-on-windows/52593215#52593215)，我创建了这个脚本：

```
$excludeFolders = "node_modules|dist|.vs";
$excludeFiles = ".*\.map.*|.*\.zip|.*\.png|.*\.ps1"

Function Dos2Unix {
    [CmdletBinding()]
    Param([Parameter(ValueFromPipeline)] $fileName)

    Write-Host -Nonewline "."

    $fileContents = Get-Content -raw $fileName
    $containsCrLf = $fileContents | %{$_ -match "\r\n"}
    If($containsCrLf -contains $true)
    {
        Write-Host "`r`nCleaing file: $fileName"
        Set-Content -Nonewline -Encoding utf8 $fileName ($fileContents -replace "`r`n","`n")
    }
}

Get-Childitem -File "." -Recurse |
  Where-Object {$_.PSParentPath -notmatch $excludeFolders} |
  Where-Object {$_.PSPath -notmatch $excludeFiles} |
  foreach { $_.PSPath | Dos2Unix } 
```

# c++ - 如何将 -I 合并到 makefile

> ID：724084
> 
> 赞同：1
> 
> 时间：2009-04-07T03:58:30.233
> 
> 标签：c++, boost, makefile

我通过以下方式编译特定代码没有问题：

```
g++ -I /opt/local/include Code1.cc -o Code1 
```

但是，当我尝试在 makefile 中执行此操作时：

```
CXX = g++ -Wall -Werror -gstabs -pedantic -O2 -g

all: Code3 Code2 Code1

Code3: Code3.cc Tools.cc
    $(CXX)   $^ -o $@

Code2: Code2.cc Tools.cc
    $(CXX)   $^ -o $@

Code1: Code1.cc Tools.cc
    $(CXX) -I /opt/local/include $^ -o $@ 
```

它抱怨。正确的方法是什么？请注意，只有 Code1.cc 需要外部库作为包含。

Code1.cc 的标头如下所示：

```
#include <iostream>      
#include <vector>        
#include <fstream>       
#include <sstream>       
#include <iomanip>       
#include <boost/math/distributions/chi_squared.hpp>
using namespace std;     
using boost::math::chi_squared; 
using boost::math::quantile; 
```

我得到的错误如下：

```
g++ -Wall -Werror -gstabs -pedantic -O2 -g -I/opt/local/include Code1.cc Tools.cc -o EstimateErrorMean
In file included from /opt/local/include/boost/detail/lcast_precision.hpp:16,
                 from /opt/local/include/boost/lexical_cast.hpp:31,
                 from /opt/local/include/boost/math/special_functions/gamma.hpp:23,
                 from /opt/local/include/boost/math/distributions/chi_squared.hpp:13,
                 from EstimateErrorMean.cc:19:
/opt/local/include/boost/integer_traits.hpp:164:66: error: use of C99 long long integer constant
/opt/local/include/boost/integer_traits.hpp:164:77: error: use of C99 long long integer constant
/opt/local/include/boost/integer_traits.hpp:170:70: error: use of C99 long long integer constant 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T04:08:51.847

在 GNU Make makefile 中，约定`CXXFLAGS`用于 C++ 编译器标志，并且要为特定目标添加标志，您可以使用目标特定变量。例如：

```
CXX=g++

# Set CXXFLAGS to include the base set of flags

CXXFLAGS=-Wall -Werror -gstabs -pedantic -O2 -g

all: Code3 Code2 Code1

Code3: Code3.cc Tools.cc
        $(CXX) $(CXXFLAGS) $^ -o $@

Code2: Code2.cc Tools.cc
        $(CXX) $(CXXFLAGS) $^ -o $@

# Add a target-specific addition to CXXFLAGS for Code1:

Code1: CXXFLAGS += -I/opt/local/include

Code1: Code1.cc Tools.cc
        $(CXX) $(CXXFLAGS) $^ -o $@ 
```

请注意，您可能还想切换到使用模式规则，而不是为所有（非常相似的）目标显式声明规则。例如，您可以将 Code1、Code2 和 Code3 规则替换为：

```
%: %.cc Tools.cc
        $(CXX) $(CXXFLAGS) $^ -o $@ 
```

**编辑**：作为对有关所见特定错误的更新帖子的回应：看起来您可能会被烧毁，因为您`-Wall -Werror`在使用 Makefile 时包含在标志中，而不是在命令行中。 `-Wall`导致 g++ 对语法更加挑剔；`-Werror`导致 g++ 将通常只是警告的事情提升为全面的错误。由于错误是针对第三方库中的代码报告的，也许您可​​以使用不那么严格的警告选项（即 remove `-Wall`）；或者您可能需要切换到可以处理构造而不会抱怨的更新版本的编译器；或者您可能只需要明确指定`-std=c99`以提醒编译器您想要 C99 支持。

希望有帮助，

埃里克·梅尔斯基

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T04:23:52.903

-pedantic 导致报告所有必需的警告，而 -Werror 导致将警告报告为错误。由于 C++ 没有定义“ULL”长整型常量语法（C99 有），这可能会被报告，然后被 g++ 提升为完全错误状态。

尝试删除 -pedantic。

[或者尝试#include <boost/cstdint.hpp>。](http://www.boost.org/doc/libs/1_38_0/libs/integer/index.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T04:02:02.723

了解投诉内容会很有帮助——但请尝试去掉`-I`and之间的空格`/opt/local/include`：

```
 -I/opt/local/include $^ -o $@ 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T04:07:38.607

如果您使用的是 GNU make，您可能会考虑这样的结构：

```
CXXFLAGS += -Wall -Werror -gstabs -pedantic -O2 -g
CXXFLGAS += -I/opt/local/include

SRCS:=Code1.cc Code2.cc Code3.cc
OBJS:=$(subst .cc,.o,$(SRCS))
EXES:=$(subst .o,,$(OBJS))

all: $(EXES) 
```

您依靠内置规则来管理从`.cc`文件到`.o`文件到可执行文件的编译。

请注意，您可能还必须定义链接器标志

```
LDFLAGS:=-g 
```

之类的...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T04:25:38.610

```
INCLUDE_PATH = -I/opt/local/include
LINK_PATH = -L <Library paths>
LIBS = -l<libraryname>

OBJECTS = Code1.o\
          Code2.o\
          Code3.o\

CXXFLAGS += $(INCLUDE_PATH)

Code1 : $(OBJECTS)
          $(CXX) $(LINK_PATH) -o$@ $(OBJECTS) $(LIBS) 
```

这可能有效...

# c# - 事件 - 命名约定和样式

> ID：724085
> 
> 赞同：67
> 
> 时间：2009-04-07T03:59:02.060
> 
> 标签：c#, events, delegates

我正在学习 C# 中的事件/代表。我能否询问您对我选择的命名/编码风格的意见（取自 Head First C# 书）？

明天我正在教一个朋友这个问题，并试图想出最优雅的方式来解释这些概念。（认为​​理解一门学科的最佳方法是尝试教授它！）

```
class Program
    {
        static void Main()
        {
            // setup the metronome and make sure the EventHandler delegate is ready
            Metronome metronome = new Metronome();

            // wires up the metronome_Tick method to the EventHandler delegate
            Listener listener = new Listener(metronome);
            metronome.OnTick();
        }
    } 
```

* * *

```
public class Metronome
    {
        // a delegate
        // so every time Tick is called, the runtime calls another method
        // in this case Listener.metronome_Tick
        public event EventHandler Tick;

        public void OnTick()
        {
            while (true)
            {
                Thread.Sleep(2000);
                // because using EventHandler delegate, need to include the sending object and eventargs 
                // although we are not using them
                Tick(this, EventArgs.Empty);
            }
        }
    } 
```

* * *

```
public class Listener
    {
        public Listener(Metronome metronome)
        {
            metronome.Tick += new EventHandler(metronome_Tick);
        }

        private void metronome_Tick(object sender, EventArgs e)
        {
            Console.WriteLine("Heard it");
        }
    } 
```

nb 代码重构自[http://www.codeproject.com/KB/cs/simplesteventexample.aspx](http://www.codeproject.com/KB/cs/simplesteventexample.aspx)

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2009-04-07T06:41:29.983

Microsoft 实际上已经编写了大量的命名指南并将其放入 MSDN 库中。您可以在此处找到文章：[命名指南](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/naming-guidelines)

除了一般的大写指南外，以下是“[类型成员名称](https://docs.microsoft.com/en-us/dotnet/standard/design-guidelines/names-of-type-members#names-of-events)”页面上“事件”的内容：

> ✔️ DO 用动词或动词短语命名事件。
> 
> 示例包括`Clicked`、`Painting`、`DroppedDown`等。
> 
> ✔️ 使用现在时和过去时给事件命名之前和之后的概念。
> 
> 例如，在窗口关闭之前引发的关闭事件将被调用`Closing`，在窗口关闭之后引发的事件将被调用`Closed`。
> 
> ❌ 不要使用“之前”或“之后”前缀或后缀来表示前后事件。使用刚才描述的现在时和过去时。
> 
> ✔️ DO 使用“EventHandler”后缀命名事件处理程序（用作事件类型的委托），如下例所示：
> 
> ```
> public delegate void ClickedEventHandler(object sender, ClickedEventArgs e); 
> ```
> 
> ✔️ 请务必在事件处理程序中使用名为`sender`和的两个参数。`e`
> 
> sender 参数表示引发事件的对象。sender 参数通常是 type `object`，即使可以使用更具体的类型。
> 
> ✔️ 使用“EventArgs”后缀命名事件参数类。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-04-07T04:10:30.347

有几点我要提一下：

Metronome.OnTick 似乎没有正确命名。从语义上讲，“OnTick”告诉我当它“Tick”时它会被调用，但这并不是真正发生的事情。我会称之为“Go”。

然而，通常接受的模型是执行以下操作。`OnTick`是引发事件的虚拟方法。这样，您可以轻松地覆盖继承类中的默认行为，并调用基类来引发事件。

```
class Metronome
{
    public event EventHandler Tick;

    protected virtual void OnTick(EventArgs e)
    {
        //Raise the Tick event (see below for an explanation of this)
        var tickEvent = Tick;
        if(tickEvent != null)
            tickEvent(this, e);
    }

    public void Go()
    {
        while(true)
        {
            Thread.Sleep(2000);
            OnTick(EventArgs.Empty); //Raises the Tick event
        }
    }
} 
```

* * *

另外，我知道这是一个简单的示例，但是如果没有附加侦听器，您的代码将抛出`Tick(this, EventArgs.Empty)`. 您至少应该包含一个空警卫来检查侦听器：

```
if(Tick != null)
    Tick(this, EventArgs.Empty); 
```

但是，如果侦听器在警卫和调用之间未注册，这在多线程环境中仍然容易受到攻击。最好的办法是先捕获当前的听众并给他们打电话：

```
var tickEvent = Tick;
if(tickEvent != null)
    tickEvent(this, EventArgs.Empty); 
```

我知道这是一个旧答案，但由于它仍在收集赞成票，这是 C# 6 的做事方式。整个“守卫”概念可以替换为条件方法调用，并且编译器在捕获侦听器方面确实做了正确的事情（TM）：

```
Tick?.Invoke(this, EventArgs.Empty); 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-06-11T10:22:36.720

我想说一般事件的最佳指南，包括命名约定，在[这里](http://www.codeproject.com/KB/cs/event_fundamentals.aspx)。

这是我采用的约定，简要地说：

*   事件名称通常以动词结尾，以 -ing 或 -ed 结尾（Closing/Closed，Loading/Loaded）
*   声明事件的类应该有一个受保护的虚拟 On[EventName]，该类的其余部分应该使用它来引发事件。子类也可以使用此方法引发事件，也可以重载以修改事件引发逻辑。
*   'Handler' 的使用经常会引起混淆——为了连贯性，所有的委托都应该以 Handler 为后缀，尽量避免调用实现 Handler 'handlers' 的方法
*   实现处理程序的方法的默认 VS 命名约定是 EventPublisherName_EventName。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-07-16T10:20:59.333

有趣的是，微软似乎如何使用 Visual Studio 生成的事件处理程序名称来打破自己的命名约定。

请参阅：[事件命名准则 (.NET Framework 1.1)](http://msdn.microsoft.com/en-us/library/h0eyck3s%28VS.71%29.aspx)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-07T04:17:33.247

我在 .Net 中使用事件多年后发现的一点是，在每次调用时重复需要检查事件是否有空处理程序。我还没有看到一段实时代码可以执行任何操作，但如果它为空则不调用该事件。

我开始做的是在我创建的每个事件上放置一个虚拟处理程序，以节省进行空值检查的需要。

```
public class Metronome
{
    public event EventHandler Tick += (s,e) => {};

    protected virtual void OnTick(EventArgs e)
    {
        Tick(this, e);  // now it's safe to call without the null check.
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-07T04:08:34.127

看起来不错，除了`OnTick`不遵循典型的事件调用模型。通常，`On[EventName]`会引发一次事件，例如

```
protected virtual void OnTick(EventArgs e)
{
    if(Tick != null) Tick(this, e);
} 
```

考虑创建此方法，并将现有的“ `OnTick`”方法重命名为“ `StartTick`”，而不是`Tick`直接调用 from `StartTick`，而是`OnTick(EventArgs.Empty)`从该`StartTick`方法调用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-07-24T09:03:52.580

在您的情况下，它可能是：

```
class Metronome {
  event Action Ticked;

  internalMethod() {
    // bla bla
    Ticked();
  }
} 
```

* * *

以上示例使用低于约定，自我描述；]

事件来源：

```
class Door {

  // case1: property change, pattern: xxxChanged
  public event Action<bool> LockStateChanged;

  // case2: pure action, pattern: "past verb"
  public event Action<bool> Opened;

  internalMethodGeneratingEvents() {
    // bla bla ...

    Opened(true);
    LockStateChanged(false);
  }

} 
```

顺便提一句。关键字`event`是可选的，但可以区分“事件”和“回调”

事件监听器：

```
class AlarmManager {

  // pattern: NotifyXxx
  public NotifyLockStateChanged(bool state) {
    // ...
  }

  // pattern: [as above]      
  public NotifyOpened(bool opened) {
  // OR
  public NotifyDoorOpened(bool opened) {
    // ...
  }

} 
```

和绑定[代码看起来很人性化]

```
door.LockStateChanged += alarmManager.NotifyLockStateChanged;
door.Moved += alarmManager.NotifyDoorOpened; 
```

即使手动发送事件也是“人类可读的”。

```
alarmManager.NotifyDoorOpened(true); 
```

有时更有表现力的可以是“动词+ing”

```
dataGenerator.DataWaiting += dataGenerator.NotifyDataWaiting; 
```

无论您选择哪种约定，都要与之保持一致。

# iphone - 如何在 iPhone 中将 NSData 转换为字节数组？

> ID：724086
> 
> 赞同：49
> 
> 时间：2009-04-07T03:59:19.140
> 
> 标签：iphone, objective-c, bytearray, type-conversion

我想转换`NSData`为字节数组，所以我写了以下代码：

```
NSData *data = [NSData dataWithContentsOfFile:filePath];
int len = [data length];
Byte byteData[len];
byteData = [data bytes]; 
```

但是最后一行代码弹出一个错误，说“分配中的类型不兼容”。那么将数据转换为字节数组的正确方法是什么？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-04-07T06:39:04.717

您不能使用变量声明数组，因此`Byte byteData[len];`无法使用。如果要从指针复制数据，还需要memcpy（它将遍历指针指向的数据并将每个字节复制到指定长度）。

尝试：

```
NSData *data = [NSData dataWithContentsOfFile:filePath];
NSUInteger len = [data length];
Byte *byteData = (Byte*)malloc(len);
memcpy(byteData, [data bytes], len); 
```

此代码将动态地将数组分配到正确的大小（完成后必须`free(byteData)`这样做）并将字节复制到其中。

`getBytes:length:`如果您想使用固定长度的数组，您也可以按照其他人的指示使用。这避免了 malloc/free，但扩展性较差，更容易出现缓冲区溢出问题，所以我很少使用它。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2010-12-03T20:09:26.870

您也可以只使用它们所在的字节，将它们转换为您需要的类型。

```
unsigned char *bytePtr = (unsigned char *)[data bytes]; 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2014-04-21T19:03:48.340

已经回答，但概括一下以帮助其他读者：

```
 //Here:   NSData * fileData;
    uint8_t * bytePtr = (uint8_t  * )[fileData bytes];

    // Here, For getting individual bytes from fileData, uint8_t is used.
    // You may choose any other data type per your need, eg. uint16, int32, char, uchar, ... .
    // Make sure, fileData has atleast number of bytes that a single byte chunk would need. eg. for int32, fileData length must be > 4 bytes. Makes sense ?

    // Now, if you want to access whole data (fileData) as an array of uint8_t
    NSInteger totalData = [fileData length] / sizeof(uint8_t);

    for (int i = 0 ; i < totalData; i ++)
    {
        NSLog(@"data byte chunk : %x", bytePtr[i]);
    } 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-07T04:05:41.077

的签名`-[NSData bytes]`是`- (const void *)bytes`。您不能将指针分配给堆栈上的数组。如果要将`NSData`对象管理的缓冲区复制到数组中，请使用`-[NSData getBytes:]`. 如果您想在不复制的情况下进行操作，则不要分配数组；只需声明一个指针变量并让`NSData`您管理内存。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T04:07:03.677

这是因为 [data bytes] 的返回类型是 void* c 样式数组，而不是 Uint8（这是 Byte 的 typedef）。

错误是因为您试图在返回是指针类型时设置分配的数组，您正在寻找的是 getBytes:length: 调用，它看起来像：

```
[data getBytes:&byteData length:len]; 
```

它用来自 NSData 对象的数据填充您分配的数组。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-01T16:51:07.760

这是我认为的 Swift 等价物：

```
if let data = NSData(contentsOfFile: filePath) {
   let length = data.length
   let byteData = malloc(length)
   memcmp(byteData, data.bytes, length)
} 
```

# asp.net - 如何获取当前登录用户的角色列表

> ID：724087
> 
> 赞同：39
> 
> 时间：2009-04-07T03:59:48.470
> 
> 标签：asp.net, asp.net-membership

我想知道登录用户属于哪些角色，而不必针对所有可能的角色检查用户（即使用 Page.User.IsInRole()）

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2009-04-07T04:00:38.343

[`using System.Web.Security;`](http://msdn.microsoft.com/en-us/library/system.web.security.aspx)

```
Roles.GetRolesForUser() 
```

或者

`Roles.GetRolesForUser(String)`如果不针对当前登录的用户。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-11-26T07:37:44.203

如果您想检查当前登录用户的特定角色，请尝试此操作：

```
Roles.IsUserInRole("Admin") 
```

# iphone - UIImagePickerController 编辑允许将 UIImage 锁定为 320x320 的最大尺寸

> ID：724092
> 
> 赞同：8
> 
> 时间：2009-04-07T04:03:18.977
> 
> 标签：iphone, cocoa-touch, uiimagepickercontroller

更新：

在 iPhone OS 3.0+ 中，整个 UIImagePickerController API 发生了变化。这个问题和答案应该考虑2.2。遗留代码。

* * *

当使用 UIImagePickerController 并且您允许编辑图像时。iPhone 允许用户调整和平移图像。但是，已编辑图像的最大尺寸上限为 320x320。

例如，我截取了一张 iPhone 屏幕截图并将其放入照片库中，即 480x320 png。当我使用 UIImagePickerController 选择该图像时，即使我不缩放或平移图像，它也会在从 UIImagePickerController 返回之前被裁剪为 320x320。但是，如果我关闭编辑，图像将返回正确的 480x320 尺寸。

我的理论：非常巧妙的是，iPhone 显示了 2 个覆盖在图像上的非标准半透明工具栏。这些工具栏在照片上留下一个无害的 320x320“窗口”。在我看来，这个窗口有效地剪辑了底层照片。

注意：回调还返回一个带有原始图像和剪辑矩形的编辑字典，但当然矩形也是最大 320x320。

关于如何允许缩放和平移大于 320x320 的图像的任何想法？

一些代码：

```
- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingImage:(UIImage *)img editingInfo:(NSDictionary *)editInfo {

        self.myImageView.userInteractionEnabled=YES;
        CGRect imageFrame = myImageView.frame;
        CGPoint imageCenter = myImageView.center;
        imageFrame.size = img.size;
        myImageView.frame = imageFrame;
        self.myImageView.image = img;
        myImageView.center = imageCenter;

        [self dismissModalViewControllerAnimated:YES];
        [self performSelector:@selector(hideToolBars) withObject:nil afterDelay:2.0];
    } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-11T17:59:16.910

正如克雷格所说，这是开发论坛和苹果定期讨论板中的一个问题。但是，我确实找到了解决方法。我正在使用以下代码：

[苹果开发者论坛](https://devforums.apple.com/message/2437#2437%232437)

这包括您需要的大部分内容，并处理所有相机方向问题。我添加了以下内容，这些内容将接收编辑信息并使用它来获取原始裁剪矩形：

```
- (UIImage*)scaleImage:(UIImage*)anImage withEditingInfo:(NSDictionary*)editInfo{

    UIImage *newImage;

    UIImage *originalImage = [editInfo valueForKey:@"UIImagePickerControllerOriginalImage"];
    CGSize originalSize = CGSizeMake(originalImage.size.width, originalImage.size.height);
    CGRect originalFrame;
    originalFrame.origin = CGPointMake(0,0);
    originalFrame.size = originalSize;

    CGRect croppingRect = [[editInfo valueForKey:@"UIImagePickerControllerCropRect"] CGRectValue];
    CGSize croppingRectSize = CGSizeMake(croppingRect.size.width, croppingRect.size.height);

    CGSize croppedScaledImageSize = anImage.size;

    float scaledBarClipHeight = 80;

    CGSize scaledImageSize;
    float scale;

    if(!CGSizeEqualToSize(croppedScaledImageSize, originalSize)){

        scale = croppedScaledImageSize.width/croppingRectSize.width;
        float barClipHeight = scaledBarClipHeight/scale;

        croppingRect.origin.y -= barClipHeight;
        croppingRect.size.height += (2*barClipHeight);

        if(croppingRect.origin.y<=0){
            croppingRect.size.height += croppingRect.origin.y;
            croppingRect.origin.y=0;
        }

        if(croppingRect.size.height > (originalSize.height - croppingRect.origin.y)){
            croppingRect.size.height = (originalSize.height - croppingRect.origin.y);
        }

        scaledImageSize = croppingRect.size;
        scaledImageSize.width *= scale;
        scaledImageSize.height *= scale;

        newImage =  [self cropImage:originalImage to:croppingRect andScaleTo:scaledImageSize];

    }else{

        newImage = originalImage;

    }

    return newImage;
} 
```

我将开发论坛帖子中的回调方法更新为以下内容：

```
- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingImage:(UIImage *)img editingInfo:(NSDictionary *)editInfo {

    [self dismissModalViewControllerAnimated:YES];
    self.myImageView.userInteractionEnabled=YES;
    CGRect imageFrame = myImageView.frame;
    CGPoint imageCenter = myImageView.center;
    UIImage *croppedImage;

    NSMutableDictionary *imageDescriptor = [editInfo mutableCopy];

    // CGFloat scaleSize = 400.0f;
    CGFloat scaleSize = 640.0f;
    switch ([picker sourceType]) {
            //done
        case UIImagePickerControllerSourceTypePhotoLibrary:
            croppedImage = [self scaleImage:img withEditingInfo:editInfo];
            [imageDescriptor setObject:croppedImage forKey:@"croppedImage"];
            break;

        case UIImagePickerControllerSourceTypeCamera: {
            UIImageOrientation originalOrientation = [[editInfo objectForKey:UIImagePickerControllerOriginalImage] imageOrientation];
            if (originalOrientation != UIImageOrientationUp) {
                NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
                CGRect origRect;
                [[editInfo objectForKey:UIImagePickerControllerCropRect] getValue:&origRect];
                UIImage *rotatedImage = straightenAndScaleImage([editInfo objectForKey:UIImagePickerControllerOriginalImage], scaleSize);
                CGFloat scale = scaleSize/1600.0f;
                origRect.origin.x *= scale;
                origRect.origin.y *= scale;
                origRect.size.width *= scale;
                origRect.size.height *= scale;
                croppedImage = [self cropImage:rotatedImage to:origRect andScaleTo:CGSizeMake(320, 480)];
                [imageDescriptor setObject:croppedImage forKey:@"croppedImage"];
                [pool drain];
            }
            else {
                croppedImage = [self scaleImage:img withEditingInfo:editInfo];
                [imageDescriptor setObject:croppedImage forKey:@"croppedImage"];
            }
        }
            break;

        case UIImagePickerControllerSourceTypeSavedPhotosAlbum: {
            UIImageOrientation originalOrientation = [[editInfo objectForKey:UIImagePickerControllerOriginalImage] imageOrientation];
            if (originalOrientation != UIImageOrientationUp) {
                NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
                CGRect origRect;
                [[editInfo objectForKey:UIImagePickerControllerCropRect] getValue:&origRect];
                UIImage *rotatedImage = straightenAndScaleImage([editInfo objectForKey:UIImagePickerControllerOriginalImage], scaleSize);
                CGFloat scale = scaleSize/640.0f;
                origRect.origin.x *= scale;
                origRect.origin.y *= scale;
                origRect.size.width *= scale;
                origRect.size.height *= scale;
                croppedImage = [self cropImage:rotatedImage to:origRect andScaleTo:CGSizeMake(320, 480)];
                [imageDescriptor setObject:croppedImage forKey:@"croppedImage"];
                [pool drain];
            }
            else {
                croppedImage = [self scaleImage:img withEditingInfo:editInfo];
                [imageDescriptor setObject:croppedImage forKey:@"croppedImage"];
            }
        }
            break;
        default:
            break;
    }

    imageFrame.size = croppedImage.size;
    myImageView.frame = imageFrame;
    myImageView.image = [imageDescriptor objectForKey:@"croppedImage"];
    myImageView.center = imageCenter;

} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-02-28T16:32:36.940

我回答这个问题肯定为时已晚，但我有更好的方法来完成这项工作。

```
static inline double radians (double degrees) {return degrees * M_PI/180;}

+(UIImage*)editedImageFromMediaWithInfo:(NSDictionary*)info{
    if(![info   objectForKey:UIImagePickerControllerCropRect])return nil;
    if(![info   objectForKey:UIImagePickerControllerOriginalImage])return nil;

    UIImage *originalImage=[info objectForKey:UIImagePickerControllerOriginalImage];
    CGRect rect=[[info objectForKey:UIImagePickerControllerCropRect] CGRectValue];

    CGImageRef imageRef = CGImageCreateWithImageInRect([originalImage CGImage], rect);

    CGBitmapInfo bitmapInfo = CGImageGetBitmapInfo(imageRef);
    CGColorSpaceRef colorSpaceInfo = CGImageGetColorSpace(imageRef);
    CGContextRef bitmap = CGBitmapContextCreate(NULL, rect.size.width, rect.size.height, CGImageGetBitsPerComponent(imageRef), CGImageGetBytesPerRow(imageRef), colorSpaceInfo, bitmapInfo);

    if (originalImage.imageOrientation == UIImageOrientationLeft) {
        CGContextRotateCTM (bitmap, radians(90));
        CGContextTranslateCTM (bitmap, 0, -rect.size.height);

    } else if (originalImage.imageOrientation == UIImageOrientationRight) {
        CGContextRotateCTM (bitmap, radians(-90));
        CGContextTranslateCTM (bitmap, -rect.size.width, 0);

    } else if (originalImage.imageOrientation == UIImageOrientationUp) {
        // NOTHING
    } else if (originalImage.imageOrientation == UIImageOrientationDown) {
        CGContextTranslateCTM (bitmap, rect.size.width, rect.size.height);
        CGContextRotateCTM (bitmap, radians(-180.));
    }

    CGContextDrawImage(bitmap, CGRectMake(0, 0, rect.size.width, rect.size.height), imageRef);
    CGImageRef ref = CGBitmapContextCreateImage(bitmap);

    UIImage *resultImage=[UIImage imageWithCGImage:ref];
    CGImageRelease(imageRef);
    CGContextRelease(bitmap);
    CGImageRelease(ref);

    return resultImage;
} 
```

它只用相对的 CropRect 裁剪原始图像，虽然这种方法不会缩放图像，但对我来说它是简短而甜蜜的。仅供参考：）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-18T03:28:00.483

迟到总比没有好：这是`orientationTransformForImage`函数的来源

```
CGAffineTransformorientationTransformForImage(UIImage *image, CGSize *newSize) {
    CGImageRef img = [图像 CGImage];
    CGFloat 宽度 = CGImageGetWidth(img);
    CGFloat 高度 = CGImageGetHeight(img);
    CGSize 大小 = CGSizeMake(宽度, 高度);
    CGAffineTransform 变换 = CGAffineTransformIdentity;
    CGFloat origHeight = size.height;
    UIImageOrientation 方向 = image.imageOrientation;
    switch(orient) { /* EXIF 1 到 8 */
        案例 UIImageOrientationUp：
            休息;
        案例 UIImageOrientationUpMirrored：
            变换 = CGAffineTransformMakeTranslation(宽度, 0.0f);
            变换 = CGAffineTransformScale（变换，-1.0f，1.0f）；
            休息;
        案例 UIImageOrientationDown：
            变换 = CGAffineTransformMakeTranslation（宽度，高度）；
            变换 = CGAffineTransformRotate（变换，M_PI）；
            休息;
        案例 UIImageOrientationDownMirrored：
            变换 = CGAffineTransformMakeTranslation(0.0f, 高度);
            变换 = CGAffineTransformScale（变换，1.0f，-1.0f）；
            休息;
        案例 UIImageOrientationLeftMirrored：
            尺寸.高度 = 尺寸.宽度；
            size.width = origHeight;
            变换 = CGAffineTransformMakeTranslation（高度，宽度）；
            变换 = CGAffineTransformScale（变换，-1.0f，1.0f）；
            变换 = CGAffineTransformRotate(变换，3.0f * M_PI / 2.0f);
            休息;
        案例 UIImageOrientationLeft：
            尺寸.高度 = 尺寸.宽度；
            size.width = origHeight;
            变换 = CGAffineTransformMakeTranslation(0.0f, 宽度);
            变换 = CGAffineTransformRotate(变换，3.0f * M_PI / 2.0f);
            休息;
        案例 UIImageOrientationRightMirrored：
            尺寸.高度 = 尺寸.宽度；
            size.width = origHeight;
            变换 = CGAffineTransformMakeScale(-1.0f, 1.0f);
            变换 = CGAffineTransformRotate(变换，M_PI / 2.0f);
            休息;
        案例 UIImageOrientationRight：
            尺寸.高度 = 尺寸.宽度；
            size.width = origHeight;
            变换 = CGAffineTransformMakeTranslation（高度，0.0f）；
            变换 = CGAffineTransformRotate(变换，M_PI / 2.0f);
            休息;
        默认：
            ;
    }
    *newSize = 大小；
    返回变换；
}

```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-16T07:57:16.223

> 在 iPhone OS 3.0+ 中，整个 UIImagePickerController API 发生了变化。这个问题和答案应该考虑2.2。遗留代码。

尽管有你的警告，我还是花了宝贵的开发时间才意识到 iOS 3.0+ 给了我们 UIImagePickerControllerEditedImage ，这使得手动裁剪到用户的捏/缩放和处理方向变得不必要。

这是为了防止有人仍在使用 UIImagePickerControllerOriginalImage 并试图找出如何最好地通过 UIImagePickerControllerCropRect 等应用裁剪。不再需要。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T18:35:36.880

这似乎是 SDK 的一个障碍，至少在图像选择器上将 allowImageEditing 设置为 TRUE 时是如此。在 Apple 论坛中有一些关于此主题的讨论：

[http://discussions.apple.com/message.jspa?messageID=7841993](http://discussions.apple.com/message.jspa?messageID=7841993)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-04-03T18:33:19.987

我[在 UIImage 上](https://github.com/frankus/UIImage-ImagePickerCrop)写了一个提供全分辨率裁剪的类别。最简单的安装方法是使用[CocoaPods](http://cocoapods.org)，将 UIImage-ImagePickerCrop 添加到您的 podfile 中。

```
#import <UIImage+ImagePickerCrop.h>

...

- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo: (NSDictionary *)info {
    [self dismissViewControllerAnimated:YES completion:nil];

    UIImage *croppedImage = [UIImage croppedImageWithImagePickerInfo:info];
    ...
} 
```

# c++ - 基于磁盘的动态内存分配

> ID：724096
> 
> 赞同：12
> 
> 时间：2009-04-07T04:04:58.067
> 
> 标签：c++, memory-management

我有一个程序，我希望能够在磁盘上存储某些数据（动态分配的块），以减少内存使用和持久性。

我的第一个想法是编写自己的自定义分配器来管理磁盘上文件的内容，但我也想看看还有哪些替代方案。

我研究了自定义内存分配器和有关对象序列化的主题，但是在将这些原则应用于管理文件的地址空间时，存在细微的差异，无论好坏。

在这个情况下：

1.  内存只能通过 IO（读/写）函数访问，而不是直接访问

2.  不存储对象（方法/指针），只存储数据。

3.  文件的大小不是静态的，因此它应该在需要时增长，而不是大而静态

4.  对于我的使用，碎片整理后重新映射现有指针是可以接受的

因为数据不是固定大小的，所以大多数数据库实现似乎不太适合。

我问，解决这个问题的最佳方法是什么？我应该实现一个将文件视为堆的简单内存分配器吗？

作为参考，我在嵌入式设备上使用 C++。

* * *

编辑：我已经实现了我自己的内存管理器，它使用伙伴内存分配和块大小的二次幂。我很满意它是正确的并且不会泄漏，合并空闲块，并且可以进行“停止世界”碎片整理。

正如预期的那样，问题是存在相当多的内部和外部碎片。我不是这个领域的专家，虽然我觉得它很吸引人（我还是个学生），但我想知道是否有其他实现做过相同或类似的事情？确定我不能是唯一的吗？

* * *

一些有用但迄今为止不兼容的主题是：

[mmap](http://en.wikipedia.org/wiki/Mmap) tbh 我没用过 mmap 但是，它解决的是文件 IO，而不是文件地址空间的管理。

[BOOST：序列化](http://www.boost.org/doc/libs/1_38_0/libs/serialization/doc/index.html)我目前（可能是不合理的）不愿意使用 boost 库。

[STXXL](http://stxxl.sourceforge.net/)有趣但没有解决可变大小的内存分配

[Doug Lea 内存分配器](http://g.oswego.edu/dl/html/malloc.html)对内存分配器的问题有很好的洞察力，但我无法尝试自己实现

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-14T19:16:10.473

> 我已经实现了自己的内存管理器，它使用伙伴内存分配和块大小的 2 次方。我很满意它是正确的并且没有泄漏，合并空闲块并且可以进行“停止世界”碎片整理。

这是伟大的第一步。一旦你有一个工作的自定义内存分配器，你当然可以做得更好！

> 问题是，正如预期的那样，存在相当多的内部（2 个块的功率）和外部碎片。我不是这个领域的专家，虽然我觉得它很有趣（我还是个学生），但我想知道是否有其他实现做过相同或类似的事情？确定我不能是唯一的吗？

二的幂是一种通用方法。但是，请注意，这可能不是最好的，因为您的分配模式可能不会遵循相同的几何级数。在这种情况下，最好尽可能多地测试并查看分配最多的块大小并进行相应优化。

我还想推荐一篇 Andrei Alexandrescu 和 Emery Berger 撰写的关于内存分配主题的精彩文章：[基于策略的内存分配](http://www.ddj.com/cpp/184402039)，尤其是后者的工作：[囤积内存分配器](http://www.cs.umass.edu/~emery/hoard/)。

如果可能，请阅读该文章末尾提到的参考资料。他们也可以提供额外的见解。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-16T22:02:39.447

您的两个目标是减少内存使用和持久化数据。这听起来绝对像是**数据库**的工作。但是你说

> 因为数据不是固定大小的，所以大多数数据库实现似乎不太适合。

我想你会对[SQLite 的这个独特的特性](http://www.sqlite.org/different.html)感兴趣（一个非常轻量级的跨平台数据库，带有公共域源代码）：

> **可变长度记录**
> 
> ...
> 
> 相反，SQLite 仅使用实际需要的磁盘空间量来连续存储信息。如果将单个字符存储在 VARCHAR(100) 列中，则仅消耗单个字节的磁盘空间。（实际上是两个字节 - 每列的开头有一些开销来记录其数据类型和长度。）

它也是[嵌入式开发的不错选择](http://www.sqlite.org/whentouse.html)：

> **嵌入式设备和应用程序**
> 
> 由于 SQLite 数据库需要很少或不需要管理，因此对于必须在无人值守且无需人工支持的情况下工作的设备或服务而言，SQLite 是一个不错的选择。SQLite 非常适合在手机、PDA、机顶盒和/或电器中使用。它还可以作为可下载消费者应用程序中的嵌入式数据库。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-20T16:25:27.273

您最好的选择是快速[**键值存储**](http://www.metabrew.com/article/anti-rdbms-a-list-of-distributed-key-value-stores/)。与 RDBMS 相比的优势在于您不需要数据库的所有开销。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T02:05:45.860

我最近为我遇到的高内存使用问题编写了一个虚拟堆类。该代码经过 LGPL 认证，托管在 code.google.com 上：

[http://code.google.com/p/kgui/source/browse/trunk/vheap.cpp](http://code.google.com/p/kgui/source/browse/trunk/vheap.cpp)

[http://code.google.com/p/kgui/source/browse/trunk/vheap.h](http://code.google.com/p/kgui/source/browse/trunk/vheap.h)

**本质上它的工作原理如下：**

1) 定义要留在内存中的块大小和块数，以及用于缓存到文件系统的文件名。在我的使用案例中，我随时都有 200 个 1MB 的内存块。

2）然后调用 Allocate 来保留一块“虚拟内存”。您将返回一个 8 字节的“句柄”到内存。如果需要，您可以分配大于块大小的块。

3）要写入“虚拟堆”，有一个写入函数，您可以在其中传递“句柄”、指向数据的指针和数据的大小。

4）要从“虚拟堆”中读取，有一个读取函数，您可以在其中传递“句柄”、指向目标的指针和要读取的数据的大小。

该代码自动处理内存中的内容和磁盘上存储的内容之间的交换。其实很简单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T05:51:53.380

对于嵌入式设备，我当然会做一个简单的实现而不是使用数据库。直接文件 IO 避免了数据库的一些开销。嵌入式环境中的资源通常是有限的。

您编写内存分配器的想法可能是最好的方法。它应该提供某种 API 层，尽可能地将基于文件的内存管理与应用程序的其余部分隔离开来。这样，以后应该很容易换出（没有双关语）以换取不同的实现，因此可以在需要时进行优化。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-14T19:05:43.823

我肯定会为 I/O 使用 mmap。这将使直接访问数据并在需要时刷新到磁盘变得容易。您唯一需要控制的是文件在地址空间中的映射位置，因此您可以移动它。

内存管理的一种可能性是为每个对象创建一个不同的文件，并使用文件系统级别的碎片整理而不是自己实现它。你从来没有提到你正在使用什么操作系统/文件系统，但如果它已经有在线碎片整理，我会使用它。如果您使用的是 Linux 并且可以使用 XFS，则可以使用`xfs_fsr`. 我希望文件系统碎片整理能够得到高度优化，并且比在一个大文件中自己实现要少得多。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-14T21:41:55.710

据我了解，您需要一个文件系统而不是内存分配系统。起初，在嵌入式系统中，磁盘中的动态内存分配是一个矛盾的术语。用于持久存储的磁盘（硬盘或闪存设备）与内存有很大不同。这不仅是您访问它的方式，而且磁盘存储并非 100% 可靠这一事实。写入磁盘时，您需要有一种算法来避免坏扇区。您是否考虑过这一点，或者您可以认为您的磁盘没有故障？

文件系统将同时处理空间分配和坏扇区问题。[FAT](http://en.wikipedia.org/wiki/File_Allocation_Table)通常用于嵌入式设备。尽管 FAT 的分片性能相当差，但这并不妨碍它在许多嵌入式设备中使用。大多数基于闪存的设备实际上都使用 FAT。

无论如何，我建议从你现在拥有的东西开始：你的操作系统（如果你使用的话）和你的磁盘驱动程序。调查这些是否已经支持合适的解决方案。另请记住，嵌入式设备更难调试 - 如果您设置实现自己的算法，预计开发时间会更长。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-20T18:57:07.207

看看 HDF5 [http://www.hdfgroup.org/HDF5/whatishdf5.html](http://www.hdfgroup.org/HDF5/whatishdf5.html)

这应该符合您的目的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-14T23:31:37.520

我认为使用简单的堆分配器可以减少内部碎片。您只需分配实际使用的内存量（加上标头的开销）。如果您已经习惯于进行 stop-the-world 压缩，您可以将其与新的 arena 分配相结合，并分配一个新的（更大的）arena 并将所有活动块复制到新的 arena。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-20T20:39:32.373

我要回应[kgiannakakis](https://stackoverflow.com/questions/724096/disk-based-dynamic-memory-allocation/749485#749485) - 您所描述的是文件系统，而不是内存管理系统。

由于您的所有访问都是通过 I/O 函数进行的，因此您的对象不必在磁盘上是连续的。不是将每个对象放入一个动态大小的块中，而是将对象分成多个固定大小的块。这些块可以位于任何地方，您所需要的只是一种将它们链接在一起的方法。您的 I/O 函数将根据需要分解和合并块。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-20T20:56:11.697

嗯。这听起来像是[BDB](http://en.wikipedia.org/wiki/Berkeley_DB) (Berkeley DB) 的一个非常常见的用例。它是一个高效的生产质量库，可以执行键值持久“数据库”（~= 带有其他数据库的表）、开源等。

我认为关系（SQL）数据库没有多大意义，但 bdb 等人（gnu db，我相信还有其他人）当然可以。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-01-22T12:40:25.637

您可能想查看[Boost.Interprocess](http://www.boost.org/doc/libs/1_52_0/doc/html/interprocess.html)提供的设施，特别是查看托管内存映射文件设施。

# javascript - 如何使用 JavaScript 创建模式弹出窗口？

> ID：724103
> 
> 赞同：-5
> 
> 时间：2009-04-07T04:06:43.100
> 
> 标签：javascript, html, dhtml

如何使用 JavaScript 和 CSS 创建带有灰色背景的模态弹出窗口？

谁能给我一个例子？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T04:08:44.657

我会推荐jQuery的...

[http://jqueryui.com/demos/dialog/](http://jqueryui.com/demos/dialog/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T04:10:40.190

您可以研究创建一个[JQuery 对话框](http://docs.jquery.com/UI/Dialog)；我相信这会给你你正在寻找的方式。我不认为实际的弹出窗口是您想要的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T04:08:48.243

嗨，您可以为此使用两个 div。第一个 div 包含您所有的主页内容，第二个用于禁用内容。当您触发事件时，使第二个 div 填充所有 UI，并且它应该位于第一个的顶部。如果您在第一个 div 中有任何组合框，那么您必须禁用它或使其不可见，否则它将从第一个 div 中弹出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-01-23T13:48:53.690

你可以使用我的 JS 库 [http://www.cristianizzo.com/DEV/Qpass/index.php?r=JS&v=modal](http://www.cristianizzo.com/DEV/Qpass/index.php?r=JS&v=modal)

这是一个例子

```
<!-- Button trigger modal --> 
<a href="#" modal="Modal" modal-Id="modalDialog">Modal Standard</a>  

<!-- Modal --> 
<div id="modalDialog" class="modal_hidden"> //content </div> 
```

您可以传递回调函数或扩展模式推送其他内容

```
<!-- Button trigger modal --> 
<a href="#" modal="Modal" modal-Id="modalFunction" modal-Size="small" modal-Fn="fnTest">Modal Fn</a>  

<!-- Modal --> 
<div id="modalFunction" class="modal_hidden"> 
//Content 
<a href="#" onclick="Modal.extendModal('idDiv', fnName); return false;"></a>
</div>  

<!-- Second Modal --> 
<div id="idDiv" class="modal_hidden"> 
//Content 
</div>

<!-- JS --> 
function fnTest(){ 
alert('execute new function'); 
}

<!-- JS --> 
function fnName(){ 
alert('execute new function'); 
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2017-07-04T18:52:50.390

看看 getbootstrap.com -> modal

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-07T04:10:12.983

它被称为“灯箱”，[之前已经讨论过数十次](https://stackoverflow.com/search?q=lightbox)。

# php - 在 PHP 中使用 CURL 或 fsockopen 的 Wordpress 自动登录

> ID：724107
> 
> 赞同：3
> 
> 时间：2009-04-07T04:08:14.080
> 
> 标签：php, curl, fsockopen

客户想要单击链接并自动登录到 Wordpress 后端管理部分。

我尝试使用 fsockopen，代码如下。没用。

```
$post_data['user_login'] = 'admin';
$post_data['user_pass'] = 'password';
$post_data['wp-submit'] = 'Log In';
$post_data['redirect_to'] = 'http://example.com/wp-admin/';

//traverse array and prepare data for posting (key1=value1)
foreach ( $post_data as $key => $value) {
$post_items[] = $key . '=' . $value;
}

//create the final string to be posted using implode()
$post_string = implode ('&', $post_items);

//we also need to add a question mark at the beginning of the string
$post_string = '?' . $post_string;

$data_length = strlen($post_string);

$connection = fsockopen('www.example.com', 80);

fputs($connection, "POST /wp-login.php HTTP/1.1\r\n");
fputs($connection, "Host: www.example.com \r\n");
fputs($connection, "Content-Type: application/x-www-form-urlencoded\r\n");
fputs($connection, "Content-Length: $data_length\r\n");
fputs($connection, "Connection: close\r\n\r\n");
fputs($connection, $post_string);

fclose($connection); 
```

也试过卷曲

```
$ch = curl_init('http://example.com/wp-login.php');

$post_data['user_login'] = 'admin';
$post_data['user_pass'] = 'password';
$post_data['wp-submit'] = 'Log In';
$post_data['redirect_to'] = 'http://example.com/wp-admin/';
//$post_data['testcookie'] = '0';
//$post_data['rememberme'] = 'forever';

foreach ( $post_data as $key => $value) {
$post_items[] = $key . '=' . $value;
}

//create the final string to be posted using implode()
$post_string = implode ('&', $post_items);

curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, $post_string);
curl_exec ($ch);
curl_close ($ch); 
```

任何人都有如何使这项工作的想法？

它是一个Linux操作系统。运行php5。

我之前使用 javascript 完成了此操作，只是在页面加载时提交了一个包含所有隐藏输入的表单。客户不想要 javascript

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T11:12:59.130

这对我有用：

```
$username="admin";
$password="admin";
$url="http://www.yourdomain.com/";
$cookie="cookie.txt";

$postdata = "log=". $username ."&pwd=". $password ."&wp-submit=Log%20In&redirect_to=". $url ."wp-admin/&testcookie=1";
$ch = curl_init();
curl_setopt ($ch, CURLOPT_URL, $url . "wp-login.php");
curl_setopt ($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt ($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.6) Gecko/20070725 Firefox/2.0.0.6");
curl_setopt ($ch, CURLOPT_TIMEOUT, 60);
curl_setopt ($ch, CURLOPT_FOLLOWLOCATION, 1);
curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1);
curl_setopt ($ch, CURLOPT_COOKIEJAR, $cookie);
curl_setopt ($ch, CURLOPT_REFERER, $url . "wp-admin/");
curl_setopt ($ch, CURLOPT_POSTFIELDS, $postdata);
curl_setopt ($ch, CURLOPT_POST, 1);
$result = curl_exec ($ch);
curl_close($ch);
echo $result;
exit; 
```

# database-design - 医疗价值：1 个超级检查表或许多检查表

> ID：724116
> 
> 赞同：0
> 
> 时间：2009-04-07T04:11:27.317
> 
> 标签：database-design

在医学领域，患者有大量的检查（HbA1C、脂质、肾脏等），它们基本上都遵循 ExamX(ID, ID_Patient, Date, Value) 的格式

但是您可以使用 SuperExam(ID, ID_Patient, ExamType, Date, Value) 从多张表转到一张表

请注意，第二个表中的值不会是离散的。有些考试有多个值，因此需要对它们进行分隔。防爆值 = .9,105,108,.4

我通常使用第一种格式，但我也多次看到第二种结构。我猜想使用第二个版本，您的数据将拥有更大的灵活性，而无需更改数据库架构，但报告似乎将是一场噩梦。

哪个设计更好？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T04:32:44.600

请注意，将单个字段与多个值打包（例如，逗号分隔的列表）违反了第一范式规则（特别是它不是没有重复组）。

任何不是第一范式的数据库设计都是非常值得怀疑的。一般来说，经验法则是通过非规范化设计规范形式，优化性能，偶尔方便。

有一个共同的表 Exams (ExamId, ExamType, PatientId, OccurredOn)，然后是特定的相关表 RenalExamination (ExamId, Rate, Hue), LipidExamination (ExamId, LCount, YCount) 等，可能是更好的选择。

这真的取决于你在做什么。如果这是医学实验室应用程序的核心，则需要更多的设计工作。当然，我的目标是标准化数据库，然后“向后工作”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T04:40:20.197

哎哟。另一个新的从头开始的体检数据库设计。

根据经验，比您描述的要微妙和复杂得多。

示例：仅血压有两个测量值（至少），收缩压和舒张压。

示例：许多测试通常同时进行；它们的含义来自测量之间的相互关系（以及上下文信息和文本解释）。

请做一些研究并找到一个你至少可以开始的现有设计。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T16:50:58.023

您很可能必须采用 EAV 方法（如另一个答案中所述）并创建一个数据字典。然后，您不仅会存储考试的特定数据，还会有一个表结构来存储定义考试中数据的数据（考试模板、值之间的关系等）。您基本上是在使用 RDBMS 的关系方面来创建自己的关系系统。

这听起来很复杂——在某种程度上，虽然不像看起来那么复杂——但如果你打算让这个医疗系统具有可扩展性和可维护性，从长远来看它是值得的。

不要在一列中存储多个值。曾经。出于任何原因。

这是一个简单的例子......

```
exam:
    exam id,
    date,
    patient id,
    ...other miscellaneous scalar data thats 1-1 with an exam

exam value:
    exam value id,
    exam id,
    value id,
    value 
```

这是用于存储考试数据的 BASIC 结构。那么你有...

```
value:
    value id,
    description

group:
    group id,
    description

group value:
    group value id,
    group id,
    value id,
    sort order 
```

再一次，非常基本和初级，但希望它能让你一瞥我在说什么。您可能希望更进一步，定义具有特定组的特定考试类型，然后为考试分配考试类型，但我将由您决定。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T04:18:24.570

我会说＃2。您可以通过添加“where ExamType=X”条件将其转换为#1，并且更容易进行跨越多个检查的查询（例如，“显示患者 Bob 的所有检查”），否则需要一堆工会（你已经提到了灵活性）

编辑：哎呀，我误读了这个问题。不要做逗号分隔值之类的事情。（“我不必创建 2 个表，因为 JOINS 很昂贵”不是一个正当理由。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T04:24:39.970

第二种形式实际上更灵活，因为您不必为新类型的考试创建新表；相反，您只需在 Exams 表中添加另一行。

也就是说，您仍然会遇到来自一次考试的多个值的问题。您可以将 SuperExam 表拆分为两份，而不是使用分隔值：一份用于将患者与特定日期的检查联系起来，第二份用于提供每个事件的所有值，每行一个。这称为“标准化”。对于临时查询，您可以使用`JOIN`子句将其重新组合在一起。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T07:25:08.927

你的直觉是对的。“SuperExam 表”称为实体-属性-值数据库，通常用于临床记录，其中稀疏数据与单个实体相关联。

EAV 表很容易搜索。问题不是查找行，而是查找相关行。

为不同的实体提供不同的表提供了域建模，但它们也提供了一种弱形式的元数据。在 EAV 中没有这样的抽象。（Java 与 EAV 的类比是声明所有函数的形式参数都是 Object 类型——所以你不会得到类型检查。）

我们可以很容易地查找属性键，但没有任何东西对这些属性键进行分组。没有办法将所有血液测试联系在一起，或者将血液测试与体重区分开来。

一种折衷方案是使用 EAV，并使考试类型成为另一个表的外键，该表提供更多关于考试类型和/或考试类型分组的数据。

Wikipedia 上有一篇关于 EAV 的非常好的文章，但现在就阅读它——它主要是一位作者的作品，并且计划进行“改进”。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-07T04:28:33.267

我可以建议一些＃3 ...它需要＃2并扩展它...

带上您的 SuperExamTable 并使用 ExamType 和 Value。创建一个名为 ExamDetail 的新表，该表具有以下值：ExamDetailId、SuperExamId、ExamType 和 Value

这将允许患者在可以有多种检查类型和值的特定日期进行检查。

# plugins - Outlook Web Access 插件开发

> ID：724117
> 
> 赞同：5
> 
> 时间：2009-04-07T04:12:27.377
> 
> 标签：plugins, outlook, exchange-server

有人写过outlook web access的插件吗？是否有任何资源可以指点我或您可以传递的提示？我可能对 OWA 2007 比对 2003 更感兴趣，但无论你拥有什么都会很棒。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-20T22:27:42.470

是的，您可以在一定程度上进行自定义（第一个链接列出了支持的内容），围绕使用客户端脚本有一些技巧。您还可以从 OWA 中提取部分并将它们集成到您自己的页面中，这有时更容易开始。

微软支持的东西
[http://msdn.microsoft.com/en-us/library/bb891803.aspx](http://msdn.microsoft.com/en-us/library/bb891803.aspx)
[http://technet.microsoft.com/en-us/library/aa996029.aspx](http://technet.microsoft.com/en-us/library/aa996029.aspx)
[http://technet.microsoft.com /en-us/library/aa996007.aspx](http://technet.microsoft.com/en-us/library/aa996007.aspx)

# javascript - 使用 Prototype 时，如何防止我的 Ajax 调用回发到服务器？

> ID：724120
> 
> 赞同：0
> 
> 时间：2009-04-07T04:16:28.147
> 
> 标签：javascript, ajax, hyperlink, prototypejs

我试图在使用[Prototype时阻止我的](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)调用回发到服务器。

### 代码：

```
echo " <a href='my.php?action=show&amp;id=".$fid."'
onclick=\"return  display('".$fid."');\"> ";  
echo "" .$fname."</a> "; 
```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T04:19:54.363

您的`display()`功能应该`return false;`防止发生默认链接操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T12:15:02.303

这很容易做到（尽管我鼓励你通过[http://prototypejs.org/api/event](http://prototypejs.org/api/event)`Event.observe()`中解释的模式不显眼地做到这一点）。

这是一个不遵循我刚刚给出的鼓励的解决方案（为了不更改您的大部分代码并让您轻松查看它在做什么。）。

```
echo " <a href='my.php?action=show&amp;id=".$fid."'
        onclick=\"Ajax.Request(this.href); return false;\"> ";
echo "" .$fname."</a> "; 
```

* * *

更好的方法是向该链接添加一个类，例如“xhr”，然后不显眼地找到所有带有 xhr 类的链接并观察点击，然后触发[XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest)请求。这是我的做法。

因此，在您的正文中，将链接元素更改为：

```
echo '<a href="my.php?action=show&amp;id=' . $fid .'" class="xhr">' . $fname . '</a> '; 
```

现在您的脚本区域执行以下操作：

```
<script type="text/javascript" charset="utf-8">
    ....
    // Wait for the DOM to be loaded (http://prototypejs.org/api/document/observe)
    document.observe('dom:loaded',function(){
       // Use Prototype's $$ utility method to find all the link's
       // with class xhr (http://prototypejs.org/api/utility/dollar-dollar)
       $$('a.xhr').each(function(link_element){
           // Iterate through each of these links and attach the following observer.
           link_element.observe('click', function(click_event){
               Ajax.Request(link_element.href);
               // stop() will cancel the click-event from "doing" anything else
               // http://prototypejs.org/api/event/stop
               click_event.stop();
           });
       });
    });
</script> 
```

现在发生的情况是，在[DOM](http://en.wikipedia.org/wiki/Document_Object_Model)加载之后（但在页面显示之前），您的 click-observer 将附加到所有带有类 'xhr' 的链接元素。它捕获点击事件，触发一个 XMLHttpRequest 请求，并通过调用[stop()](http://prototypejs.org/api/event/stop)方法阻止该事件执行默认操作（在这种情况下，跟随到另一个页面的链接）。

# iphone - App Store 的艺术家页面或搜索页面的 URL？

> ID：724121
> 
> 赞同：2
> 
> 时间：2009-04-07T04:16:42.017
> 
> 标签：iphone, cocoa-touch

我正在创建一个 iPhone 游戏。我想在我的游戏中有一个按钮，可以将人们带到我的其他游戏中。我从 iTunes 中获取 URL（复制 URL），如下所示：

[http://itunes.apple.com/WebObjects/MZStore.woa/wa/viewArtist?id=307450671](http://itunes.apple.com/WebObjects/MZStore.woa/wa/viewArtist?id=307450671)

但是当我在 iphone 中打开这个 URL 时，它会将我带到 iTunes，而不是 App Store。我也试过[http://phobos](http://phobos) ....，也没有工作。

有任何想法吗？应用商店的艺人页面或搜索页面的 URL Scheme 是什么？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-20T07:23:46.377

好的，我得到了那个链接：

[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@" [http://phobos.apple.com/WebObjects/MZSearch.woa/wa/search?submit=seeAllLockups&media=software&entity=software&term=CloudWonder](http://phobos.apple.com/WebObjects/MZSearch.woa/wa/search?submit=seeAllLockups&media=software&entity=software&term=CloudWonder) "]];

用我的搜索关键字替换该术语将使它起作用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T14:01:09.490

您应该能够像这样链接到您的公司：

[http://itunes.com/MyCompanyName](http://itunes.com/MyCompanyName)

至少我知道它对我有用：

[http://itunes.com/Rebisoft](http://itunes.com/Rebisoft)

您可以为应用程序执行类似的操作：

[http://itunes.com/app/Scr​​ibattle](http://itunes.com/app/Scribattle)

# java - 如何使用 Java 测量网络的响应时间？

> ID：724124
> 
> 赞同：4
> 
> 时间：2009-04-07T04:17:57.317
> 
> 标签：java, networking, response-time

我们有一个客户端和一个服务器。我想测量它们之间网络的响应时间。当我向服务器发送请求时，它应该立即响应我的请求，它应该像一个 ping 请求，这样服务器就没有处理时间。

我怎样才能在 Java 中做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T04:20:36.500

我通过从客户端向服务器发送一个带有时间戳的数据包，然后让服务器返回相同的时间戳来做到这一点。当服务器收到时间戳时，它可以与当前时间戳进行比较以测量往返时间。

显然有一种方法可以在 Java 5 及更高版本中生成[ICMP ping 。](http://blog.taragana.com/index.php/archive/how-to-do-icmp-ping-in-java-jdk-15-and-above/)如果要测量网络速度，只需抓取`System.nanoTime()`前后对比即可。请注意，如果您的程序运行时没有足够的权限来执行 ICMP ping，那么 Java 将求助于对端口 7 使用 TCP 回显请求，这仍然可以满足您的需要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T04:29:29.350

为确保服务器尽快响应，您应该

1.  有第二个连接到不同的端口 - 如果您想测试到服务器的路由（即电线），这很有用 - 或
2.  所有传入数据包的公共线程，它将决定传入数据包是否是 ping 请求并立即响应 - 如果您想测试当前连接（考虑该连接上的其他数据包），这很有用。

无论哪种方式，侦听部分（服务器）都应该有自己的线程，否则在处理其他数据包时请求的处理可能会过时。

请注意，无论您如何测量连接速度，都不会得到可靠的值。但是，如果你取几个这样的 ping 的平均值，你应该有一个可以接受的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T10:10:37.767

我认为您需要区分服务器（机器）花费的时间和服务器端进程处理此问题的时间。例如，ping 将简单地测量 ICMP 响应时间，这是一个低级网络协议返回。如果考虑到TCP栈，再由服务器进行后续处理，那个时间段会更大。

从您的问题来看，听起来 ping (ICMP) 是您想要的。在 JDK 5 及更高版本中，您可以执行以下操作：

```
String host = "192.168.0.1"
int timeOut = 5000; 
boolean status = InetAddress.getByName(host).isReachable(timeOut) 
```

并且您需要使用`System.nano()`或类似的时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-02T14:58:49.350

使用 ping 应该就足够了，或者[wget](http://www.gnu.org/s/wget/)跟踪传输率。您可以使用[justniffer](http://justniffer.sourceforge.net/)来嗅探“生产”运行服务器的响应时间。

# c# - WinForm ListBox 设置背景

> ID：724132
> 
> 赞同：3
> 
> 时间：2009-04-07T04:22:45.700
> 
> 标签：c#, .net, winforms

有谁知道将背景中的图像插入 WinForms C# 中的 ListBox 的方法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T04:58:31.447

那么，您必须从 ListBox 继承一个新控件。为此，请在您的解决方案中创建一个“Windows 控件库”类型的新项目，并在文件控件的源代码文件中使用以下代码：

```
public partial class ListBoxWithBg : ListBox
{
   Image image;
   Brush brush, selectedBrush;

   public ListBoxWithBg()
   {
       InitializeComponent();

       this.DrawMode = DrawMode.OwnerDrawVariable;
       this.DrawItem += new DrawItemEventHandler(ListBoxWithBg_DrawItem);
       this.image = Image.FromFile("C:\\some-image.bmp");
       this.brush = new SolidBrush(Color.Black);
       this.selectedBrush = new SolidBrush(Color.White);
   }

   void ListBoxWithBg_DrawItem(object sender, DrawItemEventArgs e)
   {
       e.DrawBackground();
       e.DrawFocusRectangle();
       /* HACK WARNING: draw the last item with the entire image at (0,0) 
        * to fill the whole ListBox. Really, there's many better ways to do this,
        * just none quite so brief */
       if (e.Index == this.Items.Count - 1)
       {
           e.Graphics.DrawImage(this.image, new Point(0, 0));
       }
       else
       {
           e.Graphics.DrawImage(this.image, e.Bounds, e.Bounds, GraphicsUnit.Pixel);
       }
       Brush drawBrush = 
           ((e.State & DrawItemState.Selected) == DrawItemState.Selected) 
           ? this.selectedBrush : this.brush;
       e.Graphics.DrawString(this.Items[e.Index].ToString(), this.Font, drawBrush, e.Bounds);
   }
} 
```

为简洁起见，我省略了所有设计器代码等，但您必须记住控件方法中`Dispose`的图像和画笔。`Dispose`

# wpf - Path 的笔画粗细不变，与比例无关

> ID：724139
> 
> 赞同：23
> 
> 时间：2009-04-07T04:27:27.717
> 
> 标签：wpf, path

我们正在使用 wpf 开发类似 cad 的应用程序，其中使用 Path 对象将绘图放置在画布上。我只是遇到了一个小问题，即当我缩放/缩放画布时，画布中的所有元素都会缩放，这是我想要的行为，但这也会增加路径的笔触厚度。

有没有一种方法可以增加/缩放/缩放对象，但我仍然保持路径的相同笔触厚度。

这方面的任何帮助对我来说都非常有用。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-21T08:59:01.503

更好的解决方案是使用一个或多个 System.Windows.Media.Geometry 对象来存储您的路径、点等。

这个几何图形可以用钢笔绘制，所以你确实可以在缩放时改变笔画粗细，但更灵活的是使用 Transform 属性。

使用转换，您可以“缩放”几何表示的实际坐标，而不是可视化 - 所以当您绘制它时，您不需要摆弄渲染转换。

为了计算变换，我使用如下代码：

```
public static Matrix TransformShape(Rect fromPosition, Rect toPosition, bool flipVertical) {
    Matrix translateThenScale = Matrix.Identity;
    //we first translate to origin since that's just easier
    translateThenScale.Translate(-fromPosition.X, -fromPosition.Y);
    //now we scale the graph to the appropriate dimensions
    translateThenScale.Scale(toPosition.Width / fromPosition.Width, toPosition.Height / fromPosition.Height);
    //then we flip the graph vertically around the viewport middle since in our graph positive is up, not down.
    if (flipVertical)
        translateThenScale.ScaleAt(1.0, -1.0, 0.0, toPosition.Height / 2.0);
    //now we push the graph to the right spot, which will usually simply be 0,0.
    translateThenScale.Translate(toPosition.X, toPosition.Y);

    return translateThenScale;
} 
```

其中 fromPosition Rect 应包含未转换的边界，而 toPosition Rect 应包含已转换的边界。这也允许单独缩放 X 和 Y，这通常是绘图所必需的。

计算几何的边界很容易：

```
Geometry graphGeom;
//[...]   
//the bounds are modified by the transform, so we want no transform!    
graphGeom.Transform = Transform.Identity; 
Rect graphBounds = graphGeom.Bounds;
//then set the transform again

//or, if the transform is axis-aligned, the following _should_ work:
Rect graphBoundsAlt = graphGeom.Transform.Inverse.TransformBounds(graphGeom.Bounds); 
```

当然，如果有必要，WPF 可以告诉您需要渲染到哪些边界。把它放在一起，你可以做类似的事情

```
public void RecomputeTransform(Rect targetRect, bool flipVertical) {
    graphGeom.Transform = Transform.Identity; 
    Rect graphBounds = graphGeom.Bounds;
    Matrix transMat = TransformShape(graphBounds,targetRect,flipVertical);
    graphGeom.Transform = new MatrixTransform(transMat);
} 
```

使用此解决方案的优点是您不需要弄乱 RenderTransforms，您可以自由使用独立剪切和/或缩放 X 和 Y 的变换，而不会在线条中产生奇怪的扭曲，并且您可以将 Pen 视为一个不透明的对象（即更容易从 UI 自定义 - 如果您选择 Pen width 等，则无需进一步修正）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-08T04:24:59.350

最后我得到了上述解决方案的解决方法。我通过将`StrokeThickness`的`Path`相对于 的缩放来做到这一点`Canvas`。

像这样：

```
// scale = scaling factor applied to the canvas
path.StrokeThickness = 1.0 / scale; 
```

这仅在`ScaleX`并且`ScaleY`是统一的情况下才有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-03-26T22:55:44.570

有同样的问题，解决方案非常简单。

1.  使用几何来定义你想要创建的图形
2.  让路径形状渲染您的几何图形
3.  将变换应用于您的几何图形，路径形状将自动更新

例如：

```
// Create your geometry
var rectGeometry = new RectangleGeometry(new Rect(0, 0, 200, 200));
// Let the Path Shape paint your geometry
var path = new Path();
path.Data = rectGeometry;
path.StrokeThickness = 2;
// Modify your geometry, NOT the Path shape
var scaleTransform = new ScaleTransform();
rectGeometry.Transform = scaleTransform;
scaleTransform.ScaleX = 2;
scaleTransform.ScaleY = 1.5; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2019-09-19T00:29:47.953

我认为你需要`YourPathObject.RenderedGeometry.Transform`财产

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2017-04-28T05:12:45.460

我已经回到这里好几次了，但是我突然想到了这个想法，将它包装在 Viewbox 中怎么样？

你可以试试这个：弄乱高度/宽度不应该改变厚度与大小的比率。也许它会做其他我还没有发现的坏事......

```
<Viewbox Height="50" Width="50">
    <Path Stroke="Black" Fill="Black" StrokeThickness="0.8" Stretch="Uniform" 
                 Data="M0,0 20,20" />
</Viewbox> 
```

# c# - 如何为 .NET 属性创建委托？

> ID：724143
> 
> 赞同：23
> 
> 时间：2009-04-07T04:30:36.413
> 
> 标签：c#, vb.net, delegates

我正在尝试为以下内容创建一个委托（作为测试）：

```
Public Overridable ReadOnly Property PropertyName() As String 
```

我的直觉尝试是这样声明委托：

```
Public Delegate Function Test() As String 
```

并像这样实例化：

```
Dim t As Test = AddressOf e.PropertyName 
```

但这会引发错误：

> 方法“Public Overridable ReadOnly Property PropertyName() As String”没有与委托“Delegate Function Test() As String”兼容的签名。

所以因为我正在处理一个属性，所以我尝试了这个：

```
Public Delegate Property Test() As String 
```

但这会引发编译器错误。

所以问题是，我如何为一个属性指定一个代表？

* * *

请参阅此链接：

[http://peisker.net/dotnet/propertydelegates.htm](http://peisker.net/dotnet/propertydelegates.htm)

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-07T07:06:43.480

使用 AddressOf 解决问题 - 如果您在编译时知道 prop-name，则可以（至少在 C# 中）使用 anon-method / lambda：

```
Test t = delegate { return e.PropertyName; }; // C# 2.0
Test t = () => e.PropertyName; // C# 3.0 
```

我不是 VB 专家，但反射器声称这与以下内容相同：

```
Dim t As Test = Function 
    Return e.PropertyName
End Function 
```

那样有用吗？

* * *

原答案：

`Delegate.CreateDelegate`您使用;为属性创建委托 这可以对任何类型的实例打开，对于单个实例是固定的 - 并且可以用于 getter 或 setter；我将在 C# 中给出一个示例...

```
using System;
using System.Reflection;
class Foo
{
    public string Bar { get; set; }
}
class Program
{
    static void Main()
    {
        PropertyInfo prop = typeof(Foo).GetProperty("Bar");
        Foo foo = new Foo();

        // create an open "getter" delegate
        Func<Foo, string> getForAnyFoo = (Func<Foo, string>)
            Delegate.CreateDelegate(typeof(Func<Foo, string>), null,
                prop.GetGetMethod());

        Func<string> getForFixedFoo = (Func<string>)
            Delegate.CreateDelegate(typeof(Func<string>), foo,
                prop.GetGetMethod());

        Action<Foo,string> setForAnyFoo = (Action<Foo,string>)
            Delegate.CreateDelegate(typeof(Action<Foo, string>), null,
                prop.GetSetMethod());

        Action<string> setForFixedFoo = (Action<string>)
            Delegate.CreateDelegate(typeof(Action<string>), foo,
                prop.GetSetMethod());

        setForAnyFoo(foo, "abc");
        Console.WriteLine(getForAnyFoo(foo));
        setForFixedFoo("def");
        Console.WriteLine(getForFixedFoo());
    }
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-10-17T10:13:26.140

我只是创建了一个性能相当不错的助手：http: [//thibaud60.blogspot.com/2010/10/fast-property-accessor-without-dynamic.html](http://thibaud60.blogspot.com/2010/10/fast-property-accessor-without-dynamic.html) 它不使用 IL / Emit 方法，而且速度非常快！

**由 oscilatingcretin 编辑 2015/10/23**

`=""`源包含一些必须删除的外壳问题和特殊性。在链接腐烂设置之前，我想我会发布一个清理版本的源代码以便轻松复制意大利面，以及如何使用它的示例。

**修改后的来源**

```
using System;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Reflection;

namespace Tools.Reflection
{
    public interface IPropertyAccessor
    {
        PropertyInfo PropertyInfo { get; }
        object GetValue(object source);
        void SetValue(object source, object value);
    }

    public static class PropertyInfoHelper
    {
        private static ConcurrentDictionary<PropertyInfo, IPropertyAccessor> _cache =
            new ConcurrentDictionary<PropertyInfo, IPropertyAccessor>();

        public static IPropertyAccessor GetAccessor(PropertyInfo propertyInfo)
        {
            IPropertyAccessor result = null;
            if (!_cache.TryGetValue(propertyInfo, out result))
            {
                result = CreateAccessor(propertyInfo);
                _cache.TryAdd(propertyInfo, result); ;
            }
            return result;
        }

        public static IPropertyAccessor CreateAccessor(PropertyInfo PropertyInfo)
        {
            var GenType = typeof(PropertyWrapper<,>)
                .MakeGenericType(PropertyInfo.DeclaringType, PropertyInfo.PropertyType);
            return (IPropertyAccessor)Activator.CreateInstance(GenType, PropertyInfo);
        }
    }

    internal class PropertyWrapper<TObject, TValue> : IPropertyAccessor where TObject : class
    {
        private Func<TObject, TValue> Getter;
        private Action<TObject, TValue> Setter;

        public PropertyWrapper(PropertyInfo PropertyInfo)
        {
            this.PropertyInfo = PropertyInfo;

            MethodInfo GetterInfo = PropertyInfo.GetGetMethod(true);
            MethodInfo SetterInfo = PropertyInfo.GetSetMethod(true);

            Getter = (Func<TObject, TValue>)Delegate.CreateDelegate
                    (typeof(Func<TObject, TValue>), GetterInfo);
            Setter = (Action<TObject, TValue>)Delegate.CreateDelegate
                    (typeof(Action<TObject, TValue>), SetterInfo);
        }

        object IPropertyAccessor.GetValue(object source)
        {
            return Getter(source as TObject);
        }

        void IPropertyAccessor.SetValue(object source, object value)
        {
            Setter(source as TObject, (TValue)value);
        }

        public PropertyInfo PropertyInfo { get; private set; }
    }
} 
```

**像这样使用它：**

```
public class MyClass
{
    public int Id { get; set; }
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public int Age { get; set; }
}

MyClass e = new MyClass();
IPropertyAccessor[] Accessors = e.GetType().GetProperties()
    .Select(pi => PropertyInfoHelper.CreateAccessor(pi)).ToArray();

foreach (var Accessor in Accessors)
{
    Type pt = Accessor.PropertyInfo.PropertyType;
    if (pt == typeof(string))
        Accessor.SetValue(e, Guid.NewGuid().ToString("n").Substring(0, 9));
    else if (pt == typeof(int))
        Accessor.SetValue(e, new Random().Next(0, int.MaxValue));

    Console.WriteLine(string.Format("{0}:{1}",
        Accessor.PropertyInfo.Name, Accessor.GetValue(e)));
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-10-15T21:54:11.453

这是[Marc Gravell 响应](https://stackoverflow.com/questions/724143/how-do-i-create-a-delegate-for-a-net-property/724427#724427)的 C#/.NET 2.0 版本：

```
using System;
using System.Reflection;

class Program
{
 private delegate void SetValue<T>(T value);
 private delegate T GetValue<T>();

 private class Foo
 {
  private string _bar;

  public string Bar
  {
   get { return _bar; }
   set { _bar = value; }
  }
 }

 static void Main()
 {
  Foo foo = new Foo();
  Type type = typeof (Foo);
  PropertyInfo property = type.GetProperty("Bar");

  // setter
  MethodInfo methodInfo = property.GetSetMethod();
  SetValue<string> setValue =
   (SetValue<string>) Delegate.CreateDelegate(typeof (SetValue<string>), foo, methodInfo);
  setValue("abc");

  // getter
  methodInfo = property.GetGetMethod();
  GetValue<string> getValue =
   (GetValue<string>) Delegate.CreateDelegate(typeof (GetValue<string>), foo, methodInfo);
  string myValue = getValue();

  // output results
  Console.WriteLine(myValue);
 }
} 
```

同样，“ **Delegate.CreateDelegate** ”是本示例的基础。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-01-24T09:31:32.740

这是个好主意

```
Test t = () => e.PropertyName; // C# 3.0 
```

但要小心，如果你正在做这样的事情：

```
List<Func<int>> funcs = new List<Func<int>>();
foreach (var e in Collection)
   funcs.Add(new Func<int>(() => e.Property)); 
```

调用这个：

```
foreach(var f in funcs)
   f(); 
```

将始终返回Collection中**最后一个对象的属性值**

在这种情况下，您应该调用方法：

```
foreach (var e in Collection)
   funcs.Add(new Func<int>(e.GetPropValue)); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T05:15:07.040

这是一个 C# 示例，但所有类型都相同：

首先创建接口（委托）。请记住，附加到委托的方法必须返回相同的类型，并采用与委托声明相同的参数。不要在与您的事件相同的范围内定义您的委托。

```
public delegate void delgJournalBaseModified(); 
```

根据委托进行事件：

```
public static class JournalBase {
    public static event delgJournalBaseModified evntJournalModified;
}; 
```

定义一个可以绑定到您的事件的方法，该方法具有与委托相同的接口。

```
void UpdateEntryList()
{
} 
```

将方法与事件联系起来。触发事件时调用该方法。您可以将尽可能多的方法与您的事件联系起来。我不知道极限。这可能是一件很疯狂的事情。

```
 JournalBase.evntJournalModified += new delgJournalBaseModified(UpdateEntryList); 
```

这里发生的是该方法被添加为您的事件的回调。触发事件时，将调用您的方法。

接下来我们创建一个在调用时触发事件的方法：

```
public static class JournalBase {
    public static  void JournalBase_Modified()
    {
    if (evntJournalModified != null)
        evntJournalModified();
    }
}; 
```

然后，您只需在代码中的某处调用方法——JournalBase_Modified()，所有与事件相关的方法也会一个接一个地被调用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-01-21T05:15:50.690

VB版：

```
Dim prop As PropertyInfo = GetType(foo).GetProperty("bar")
Dim foo1 As New foo

Dim getForAnyFoo As Func(Of foo, String) = TryCast([Delegate].CreateDelegate(GetType(Func(Of foo, String)), Nothing, prop.GetGetMethod()), Func(Of foo, String))

Dim setForAnyFoo As Action(Of foo, String) = TryCast([Delegate].CreateDelegate(GetType(Action(Of foo, String)), Nothing, prop.GetSetMethod()), Action(Of foo, String))

Dim getForFixedFoo As Func(Of String) = TryCast([Delegate].CreateDelegate(GetType(Func(Of String)), foo1, prop.GetGetMethod()), Func(Of String))

Dim setForFixedFoo As Action(Of String) = TryCast([Delegate].CreateDelegate(GetType(Action(Of String)), foo1, prop.GetSetMethod()), Action(Of String))

    setForAnyFoo(foo1, "abc")
    Debug.WriteLine(getForAnyFoo(foo1))

    setForFixedFoo("def")
    Debug.WriteLine(getForFixedFoo()) 
```

# vb.net - 从 DataGridView 选定单元格中获取文本

> ID：724146
> 
> 赞同：7
> 
> 时间：2009-04-07T04:32:34.270
> 
> 标签：vb.net, datagridview, textbox, tostring

我有一个 DataGridView，其中包含来自包含数据的数据库文件的单元格。基本上，我想从 DataGridView 中的**选定**单元格中获取文本，并在单击按钮时将其显示在文本框中。按钮点击事件的代码是：

```
Private Sub Button1_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles Button1.Click
    Dim SelectedThings As String = DataGridView1.SelectedCells.ToString
    TextBox1.Text = SelectedThings
End Sub 
```

但是在**TextBox1**我得到：

> System.Windows.Forms.DataGridViewSelectedCellCollection

我想这并不像看起来那么简单。我是一名刚刚学习 VB.NET 的 C 开发人员。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T04:37:08.630

[`DataGridView.SelectedCells`](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.selectedcells.aspx)是单元格的集合，所以并不像调用`ToString()`它那么简单。您必须遍历集合中的每个单元格并获取每个单元格的值。

以下将创建所有选定单元格值的逗号分隔列表。

**C＃**

```
TextBox1.Text = "";
bool FirstValue = true;
foreach(DataGridViewCell cell in DataGridView1.SelectedCells)
{
    if(!FirstValue)
    {
        TextBox1.Text += ", ";
    }
    TextBox1.Text += cell.Value.ToString();
    FirstValue = false;
} 
```

**VB.NET**（从上面的代码[翻译）](http://www.kamalpatel.net/ConvertCSharp2VB.aspx)

```
TextBox1.Text = ""
Dim FirstValue As Boolean =  True 
Dim cell As DataGridViewCell
For Each cell In DataGridView1.SelectedCells
    If Not FirstValue Then
        TextBox1.Text += ", "
    End If
    TextBox1.Text += cell.Value.ToString()
    FirstValue = False
Next 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-02-21T11:16:00.380

试试这个：

```
Dim i = Datagridview1.currentrow.index
textbox1.text = datagridview1.item(columnindex, i).value 
```

它应该工作:)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-05-15T06:35:32.667

简单地

```
MsgBox(GridView1.CurrentCell.Value.ToString) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-08-07T20:11:07.037

```
Private Sub DataGridView1_CellClick(ByVal sender As System.Object, _
                                    ByVal e As DataGridViewCellEventArgs) _
                                    Handles DataGridView1.CellClick
    MsgBox(DataGridView1.Rows(e.RowIndex).Cells(e.ColumnIndex).Value)
End Sub 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-23T09:14:04.447

或者，我们可以使用这样的东西

```
dim i = dgv1.CurrentCellAddress.X
dim j = dgv1.CurrentCellAddress.Y
MsgBox(dgv1.Item(i,j).Value.ToString()) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-03-12T20:55:17.690

此页面上的许多答案仅适用于单个单元格，并且 OP 要求**所有**选定的单元格。

如果您想要的只是单元格内容，并且您不关心对所选实际单元格的引用，您可以这样做：

```
Private Sub Button1_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles Button1.Click
    Dim SelectedThings As String = DataGridView1.GetClipboardContent().GetText().Replace(ChrW(9), ",")
    TextBox1.Text = SelectedThings
End Sub 
```

单击时`Button1`，将填充`TextBox1`所选单元格的逗号分隔值。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T04:56:04.637

在这种特定情况下，ToString() 将返回由 SelectedCell 属性返回的对象的名称。（当前选定单元格的集合）。

当对象没有针对 ToString() 方法的特定实现时，会发生此行为。

在我们的例子中，您所要做的就是迭代单元格的集合并将其值累积到一个字符串中。然后将此字符串推送到文本框。

看看这里如何实现迭代：

[微软](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.selectedcells.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T04:59:21.213

或者，如果您只需要第一个选定的卖出值（或者如果选择了一个，则只需要一个选定的单元格）

```
TextBox1.Text = SelectedCells[0].Value.ToString(); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-04-09T15:25:29.010

两全其美的.....

```
Private Sub tsbSendNewsLetter_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles tsbSendNewsLetter.Click
        Dim tmpstr As String = ""
        Dim cnt As Integer = 0
        Dim virgin As Boolean = True
        For cnt = 0 To (dgvDetails.Rows.Count - 1)
            If Not dgvContacts.Rows(cnt).Cells(9).Value.ToString() Is Nothing Then
                If Not dgvContacts.Rows(cnt).Cells(9).Value.ToString().Length = 0 Then
                    If Not virgin Then
                        tmpstr += ", "
                    End If
                    tmpstr += dgvContacts.Rows(cnt).Cells(9).Value.ToString()
                    virgin = False
                    'MsgBox(tmpstr)
                End If
            End If
        Next
        Dim email As New qkuantusMailer()
        email.txtMailTo.Text = tmpstr
        email.Show()
    End Sub 
```

# c# - 有没有更快的方法在 .NET 中递归地扫描目录？

> ID：724148
> 
> 赞同：30
> 
> 时间：2009-04-07T04:33:23.037
> 
> 标签：c#, .net, filesystems

我正在.NET 中编写目录扫描器。

对于每个文件/目录，我需要以下信息。

```
 class Info {
        public bool IsDirectory;
        public string Path;
        public DateTime ModifiedDate;
        public DateTime CreatedDate;
    } 
```

我有这个功能：

```
 static List<Info> RecursiveMovieFolderScan(string path){

        var info = new List<Info>();
        var dirInfo = new DirectoryInfo(path);
        foreach (var dir in dirInfo.GetDirectories()) {
            info.Add(new Info() {
                IsDirectory = true,
                CreatedDate = dir.CreationTimeUtc,
                ModifiedDate = dir.LastWriteTimeUtc,
                Path = dir.FullName
            });

            info.AddRange(RecursiveMovieFolderScan(dir.FullName));
        }

        foreach (var file in dirInfo.GetFiles()) {
            info.Add(new Info()
            {
                IsDirectory = false,
                CreatedDate = file.CreationTimeUtc,
                ModifiedDate = file.LastWriteTimeUtc,
                Path = file.FullName
            });
        }

        return info; 
    } 
```

事实证明这个实现非常慢。有什么办法可以加快这个速度吗？我正在考虑使用 FindFirstFileW 手动编码，但如果有更快的内置方式，我想避免这种情况。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-04-07T05:00:57.760

这种需要稍作调整的实现速度提高了 5-10 倍。

```
 static List<Info> RecursiveScan2(string directory) {
        IntPtr INVALID_HANDLE_VALUE = new IntPtr(-1);
        WIN32_FIND_DATAW findData;
        IntPtr findHandle = INVALID_HANDLE_VALUE;

        var info = new List<Info>();
        try {
            findHandle = FindFirstFileW(directory + @"\*", out findData);
            if (findHandle != INVALID_HANDLE_VALUE) {

                do {
                    if (findData.cFileName == "." || findData.cFileName == "..") continue;

                    string fullpath = directory + (directory.EndsWith("\\") ? "" : "\\") + findData.cFileName;

                    bool isDir = false;

                    if ((findData.dwFileAttributes & FileAttributes.Directory) != 0) {
                        isDir = true;
                        info.AddRange(RecursiveScan2(fullpath));
                    }

                    info.Add(new Info()
                    {
                        CreatedDate = findData.ftCreationTime.ToDateTime(),
                        ModifiedDate = findData.ftLastWriteTime.ToDateTime(),
                        IsDirectory = isDir,
                        Path = fullpath
                    });
                }
                while (FindNextFile(findHandle, out findData));

            }
        } finally {
            if (findHandle != INVALID_HANDLE_VALUE) FindClose(findHandle);
        }
        return info;
    } 
```

扩展方法：

```
 public static class FILETIMEExtensions {
        public static DateTime ToDateTime(this System.Runtime.InteropServices.ComTypes.FILETIME filetime ) {
            long highBits = filetime.dwHighDateTime;
            highBits = highBits << 32;
            return DateTime.FromFileTimeUtc(highBits + (long)filetime.dwLowDateTime);
        }
    } 
```

互操作定义为：

```
 [DllImport("kernel32.dll", CharSet = CharSet.Unicode, SetLastError = true)]
    public static extern IntPtr FindFirstFileW(string lpFileName, out WIN32_FIND_DATAW lpFindFileData);

    [DllImport("kernel32.dll", CharSet = CharSet.Unicode)]
    public static extern bool FindNextFile(IntPtr hFindFile, out WIN32_FIND_DATAW lpFindFileData);

    [DllImport("kernel32.dll")]
    public static extern bool FindClose(IntPtr hFindFile);

    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    public struct WIN32_FIND_DATAW {
        public FileAttributes dwFileAttributes;
        internal System.Runtime.InteropServices.ComTypes.FILETIME ftCreationTime;
        internal System.Runtime.InteropServices.ComTypes.FILETIME ftLastAccessTime;
        internal System.Runtime.InteropServices.ComTypes.FILETIME ftLastWriteTime;
        public int nFileSizeHigh;
        public int nFileSizeLow;
        public int dwReserved0;
        public int dwReserved1;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 260)]
        public string cFileName;
        [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 14)]
        public string cAlternateFileName;
    } 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-09-17T18:01:19.603

.NET 文件枚举方法缓慢的历史由来已久。问题是没有一种即时的方式来枚举大型目录结构。即使这里接受的答案也存在 GC 分配的问题。

我能做的最好的事情就是包装在我的库中，并作为[CSharpTest.Net.IO 命名空间中的](http://help.csharptest.net/?CSharpTest.Net.Library~CSharpTest.Net.IO_namespace.html)[FileFile](http://help.csharptest.net/?CSharpTest.Net.Library~CSharpTest.Net.IO.FindFile_members.html) ( [source](http://code.google.com/p/csharptest-net/source/browse/src/Library/IO/FindFile.cs) ) 类公开。此类可以枚举文件和文件夹，而无需进行不必要的 GC 分配和字符串封送处理。

用法很简单，RaiseOnAccessDenied 属性会跳过用户无权访问的目录和文件：

```
 private static long SizeOf(string directory)
    {
        var fcounter = new CSharpTest.Net.IO.FindFile(directory, "*", true, true, true);
        fcounter.RaiseOnAccessDenied = false;

        long size = 0, total = 0;
        fcounter.FileFound +=
            (o, e) =>
            {
                if (!e.IsDirectory)
                {
                    Interlocked.Increment(ref total);
                    size += e.Length;
                }
            };

        Stopwatch sw = Stopwatch.StartNew();
        fcounter.Find();
        Console.WriteLine("Enumerated {0:n0} files totaling {1:n0} bytes in {2:n3} seconds.",
                          total, size, sw.Elapsed.TotalSeconds);
        return size;
    } 
```

对于我的本地 C:\ 驱动器，此输出如下：

> 在 232.876 秒内枚举了 810,046 个文件，总计 307,707,792,662 个字节。

您的里程可能会因驱动速度而异，但这是我发现的在托管代码中枚举文件的最快方法。[event 参数是FindFile.FileFoundEventArgs](http://code.google.com/p/csharptest-net/source/browse/src/Library/IO/FindFile.cs)类型的变异类，因此请确保不要保留对它的引用，因为它的值会随着每个引发的事件而改变。

您可能还注意到 DateTime 的公开时间仅以 UTC 表示。原因是转换为本地时间是半昂贵的。您可能会考虑使用 UTC 时间来提高性能，而不是将这些时间转换为本地时间。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-07T04:50:31.903

根据您尝试减少函数的时间，直接调用 Win32 API 函数可能是值得的，因为现有 API 会进行大量额外处理来检查您可能不感兴趣的内容。

如果您还没有这样做，并且假设您不打算为 Mono 项目做出贡献，我强烈建议您下载[Reflector](http://www.red-gate.com/products/reflector/)并查看 Microsoft 如何实现您当前使用的 API 调用。这将使您了解需要调用的内容以及可以省略的内容。

例如，您可能会选择创建一个包含`yield`目录名称的迭代器，而不是一个返回列表的函数，这样您就不会在所有不同级别的代码中对同一个名称列表进行两次或三次迭代.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-04-20T00:01:39.387

我刚遇到这个。本机版本的良好实现。

这个版本虽然仍然比使用`FindFirst`and的版本慢，但比`FindNext`原来的 .NET 版本快很多。

```
 static List<Info> RecursiveMovieFolderScan(string path)
    {
        var info = new List<Info>();
        var dirInfo = new DirectoryInfo(path);
        foreach (var entry in dirInfo.GetFileSystemInfos())
        {
            bool isDir = (entry.Attributes & FileAttributes.Directory) != 0;
            if (isDir)
            {
                info.AddRange(RecursiveMovieFolderScan(entry.FullName));
            }
            info.Add(new Info()
            {
                IsDirectory = isDir,
                CreatedDate = entry.CreationTimeUtc,
                ModifiedDate = entry.LastWriteTimeUtc,
                Path = entry.FullName
            });
        }
        return info;
    } 
```

它应该产生与您的本机版本相同的输出。我的测试表明，这个版本大约是使用`FindFirst`和的版本的 1.7 倍`FindNext`。在没有附加调试器的情况下在发布模式下获得的计时。

奇怪的是，在我的测试中将 更改`GetFileSystemInfos`为`EnumerateFileSystemInfos`增加了大约 5% 的运行时间。我宁愿希望它以相同的速度运行，或者可能更快，因为它不必创建`FileSystemInfo`对象数组。

下面的代码更短，因为它让框架负责递归。但它比上面的版本慢了 15% 到 20%。

```
 static List<Info> RecursiveScan3(string path)
    {
        var info = new List<Info>();

        var dirInfo = new DirectoryInfo(path);
        foreach (var entry in dirInfo.EnumerateFileSystemInfos("*", SearchOption.AllDirectories))
        {
            info.Add(new Info()
            {
                IsDirectory = (entry.Attributes & FileAttributes.Directory) != 0,
                CreatedDate = entry.CreationTimeUtc,
                ModifiedDate = entry.LastWriteTimeUtc,
                Path = entry.FullName
            });
        }
        return info;
    } 
```

同样，如果您将其更改为`GetFileSystemInfos`，它会稍微（但只是稍微）快一些。

就我的目的而言，上面的第一个解决方案已经足够快了。本机版本运行时间约为 1.6 秒。使用的版本`DirectoryInfo`运行时间约为 2.9 秒。我想如果我经常运行这些扫描，我会改变主意。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T21:59:15.457

> 它非常浅，有 371 个目录，每个目录中平均有 10 个文件。一些目录包含其他子目录

这只是一个评论，但你的数字似乎确实很高。我使用与您使用的基本相同的递归方法运行以下内容，尽管创建了字符串输出，但我的时间要短得多。

```
 public void RecurseTest(DirectoryInfo dirInfo, 
                            StringBuilder sb, 
                            int depth)
    {
        _dirCounter++;
        if (depth > _maxDepth)
            _maxDepth = depth;

        var array = dirInfo.GetFileSystemInfos();
        foreach (var item in array)
        {
            sb.Append(item.FullName);
            if (item is DirectoryInfo)
            {
                sb.Append(" (D)");
                sb.AppendLine();

                RecurseTest(item as DirectoryInfo, sb, depth+1);
            }
            else
            { _fileCounter++; }

            sb.AppendLine();
        }
    } 
```

我在许多不同的目录上运行了上面的代码。在我的机器上，由于运行时或文件系统的缓存，第二次扫描目录树的调用通常更快。请注意，这个系统并没有什么特别之处，只是一个使用了 1 年的开发工作站。

```
// 缓存调用
目录 = 150，文件 = 420，最大深度 = 5
所用时间 = 53 毫秒

// 缓存调用
目录 = 1117，文件 = 9076，最大深度 = 11
所用时间 = 433 毫秒

// 第一次调用
目录 = 1052，文件 = 5903，最大深度 = 12
所用时间 = 11921 毫秒

// 第一次调用
目录 = 793，文件 = 10748，最大深度 = 10
所用时间 = 5433 毫秒（第二次运行 363 毫秒）

```

担心我没有得到创建和修改日期，代码被修改为在以下时间也输出这个。

```
// 现在获取上次更新和创建时间。
目录 = 150，文件 = 420，最大深度 = 5
所用时间 = 103 毫秒（第二次运行 93 毫秒）

目录 = 1117，文件 = 9076，最大深度 = 11
所用时间 = 992 毫秒（第二次运行 984 毫秒）

目录 = 793，文件 = 10748，最大深度 = 10
所用时间 = 1382 毫秒（第二次运行 735 毫秒）

目录 = 1052，文件 = 5903，最大深度 = 12
所用时间 = 936 毫秒（第二次运行 595 毫秒）

```

注意：System.Diagnostics.StopWatch 类用于计时。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T05:49:19.767

我会使用或基于这个多线程库： http: [//www.codeproject.com/KB/files/FileFind.aspx](http://www.codeproject.com/KB/files/FileFind.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-04-16T17:32:52.913

我最近（2020 年）发现了这篇文章，因为需要计算慢速连接中的文件和目录，这是我能想到的最快的实现。.NET 枚举方法（GetFiles()、GetDirectories()）执行了大量的底层工作，相比之下大大减慢了它们的速度。

该解决方案利用 Win32 API 和 .NET 的 Parallel.ForEach() 来利用线程池来最大化性能。

P/调用：

```
/// <summary>
/// https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findfirstfilew
/// </summary>
[DllImport("kernel32.dll", SetLastError = true)]
public static extern IntPtr FindFirstFile(
    string lpFileName,
    ref WIN32_FIND_DATA lpFindFileData
    );

/// <summary>
/// https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findnextfilew
/// </summary>
[DllImport("kernel32.dll", SetLastError = true)]
public static extern bool FindNextFile(
    IntPtr hFindFile,
    ref WIN32_FIND_DATA lpFindFileData
    );

/// <summary>
/// https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findclose
/// </summary>
[DllImport("kernel32.dll", SetLastError = true)]
public static extern bool FindClose(
    IntPtr hFindFile
    ); 
```

方法：

```
public static Tuple<long, long> CountFilesDirectories(
    string path,
    CancellationToken token
    )
{
    if (String.IsNullOrWhiteSpace(path))
        throw new ArgumentNullException("path", "The provided path is NULL or empty.");

    // If the provided path doesn't end in a backslash, append one.
    if (path.Last() != '\\')
        path += '\\';

    IntPtr hFile = IntPtr.Zero;
    Win32.Kernel32.WIN32_FIND_DATA fd = new Win32.Kernel32.WIN32_FIND_DATA();

    long files = 0;
    long dirs = 0;

    try
    {
        hFile = Win32.Kernel32.FindFirstFile(
            path + "*", // Discover all files/folders by ending a directory with "*", e.g. "X:\*".
            ref fd
            );

        // If we encounter an error, or there are no files/directories, we return no entries.
        if (hFile.ToInt64() == -1)
            return Tuple.Create<long, long>(0, 0);

        //
        // Find (and count) each file/directory, then iterate through each directory in parallel to maximize performance.
        //

        List<string> directories = new List<string>();

        do
        {
            // If a directory (and not a Reparse Point), and the name is not "." or ".." which exist as concepts in the file system,
            // count the directory and add it to a list so we can iterate over it in parallel later on to maximize performance.
            if ((fd.dwFileAttributes & FileAttributes.Directory) != 0 &&
                (fd.dwFileAttributes & FileAttributes.ReparsePoint) == 0 &&
                fd.cFileName != "." && fd.cFileName != "..")
            {
                directories.Add(System.IO.Path.Combine(path, fd.cFileName));
                dirs++;
            }
            // Otherwise, if this is a file ("archive"), increment the file count.
            else if ((fd.dwFileAttributes & FileAttributes.Archive) != 0)
            {
                files++;
            }
        }
        while (Win32.Kernel32.FindNextFile(hFile, ref fd));

        // Iterate over each discovered directory in parallel to maximize file/directory counting performance,
        // calling itself recursively to traverse each directory completely.
        Parallel.ForEach(
            directories,
            new ParallelOptions()
            {
                CancellationToken = token
            },
            directory =>
            {
                var count = CountFilesDirectories(
                    directory,
                    token
                    );

                lock (directories)
                {
                    files += count.Item1;
                    dirs += count.Item2;
                }
            });
    }
    catch (Exception)
    {
        // Handle as desired.
    }
    finally
    {
        if (hFile.ToInt64() != 0)
            Win32.Kernel32.FindClose(hFile);
    }

    return Tuple.Create<long, long>(files, dirs);
} 
```

在我的本地系统上，GetFiles()/GetDirectories() 的性能可以接近这个，但是在较慢的连接（VPN 等）上，我发现这要快得多——访问远程目录需要 45 分钟和 90 秒约 40k 个文件，大小约 40 GB。

这也可以很容易地修改以包含其他数据，例如计算的所有文件的总文件大小，或者从最远的分支开始快速递归并删除空目录。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T04:41:32.613

试试这个（即先进行初始化，然后重用你的列表和你的 directoryInfo 对象）：

```
 static List<Info> RecursiveMovieFolderScan1() {
      var info = new List<Info>();
      var dirInfo = new DirectoryInfo(path);
      RecursiveMovieFolderScan(dirInfo, info);
      return info;
  } 

  static List<Info> RecursiveMovieFolderScan(DirectoryInfo dirInfo, List<Info> info){

    foreach (var dir in dirInfo.GetDirectories()) {

        info.Add(new Info() {
            IsDirectory = true,
            CreatedDate = dir.CreationTimeUtc,
            ModifiedDate = dir.LastWriteTimeUtc,
            Path = dir.FullName
        });

        RecursiveMovieFolderScan(dir, info);
    }

    foreach (var file in dirInfo.GetFiles()) {
        info.Add(new Info()
        {
            IsDirectory = false,
            CreatedDate = file.CreationTimeUtc,
            ModifiedDate = file.LastWriteTimeUtc,
            Path = file.FullName
        });
    }

    return info; 
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-08-07T14:13:46.857

最近我也有同样的问题，我觉得把所有的文件夹和文件都输出成一个文本文件，然后用streamreader读取文本文件，多线程做你想做的事情也不错。

```
cmd.exe /u /c dir "M:\" /s /b >"c:\flist1.txt" 
```

[更新]嗨，Moby，你是对的。由于读取输出文本文件的开销，我的方法较慢。实际上，我花了一些时间来测试 200 万个文件的最佳答案和 cmd.exe。

```
The top answer: 2010100 files, time: 53023
cmd.exe method: 2010100 files, cmd time: 64907, scan output file time: 19832. 
```

最佳答案方法（53023）比cmd.exe（64907）快，更不用说如何改进读取输出文本文件了。虽然我的原意是提供一个不错的答案，但还是觉得很抱歉，哈。

# asp.net-mvc - 如何在 ASP.NET MVC 中构造没有 ViewContext 的路由？

> ID：724153
> 
> 赞同：7
> 
> 时间：2009-04-07T04:37:01.093
> 
> 标签：asp.net-mvc, routing

我想从一个无权访问 ViewContext 的实用程序类创建一个路由。

这可能吗？似乎没有任何等价物`ViewContext.Current`

我已经尝试在 Routing 和 HttpContext 的所有构造函数中四处寻找，但不能完全达到我想要的。

这就是我正在寻找的 - 虽然这不起作用，因为`RouteTable.Routes`它是 type`RouteCollection`而不是`RouteData`. 如此接近 - 但到目前为止:-)

```
 RequestContext requestContext = new RequestContext(HttpContext.Current, RouteTable.Routes);
        UrlHelper url = new UrlHelper(requestContext);
        var urlString = url.RouteUrl(new {controller="DynamicImage", action="Button", text="Hello World"}); 
```

注意：RequestContest 的类型是 System.Web.Routing.RequestContext 而不是 HttpContext

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-07T15:31:32.813

尝试这个：

```
var httpContext = new HttpContextWrapper(HttpContext.Current);
var requestContext = new RequestContext(httpContext);
var urlHelper = new UrlHelper(requestContext, new RouteData())); 
```

希望这可以帮助

**更新：**

前一个是不正确的（我从记忆中发布了它）。试试这个（它适用于我的一个项目）：

```
var httpContext = new HttpContextWrapper(HttpContext.Current);
var requestContext = new RequestContext(httpContext, new RouteData());
var urlHelper = new UrlHelper(requestContext); 
```

`new RouteData()`仅用于`RequestContext`初始化并`new UrlHelper(requestContext)`实际调用`new UrlHelper(requestContext, RouteTable.Routes)`

# c++ - 按住时键盘输入犹豫？

> ID：724156
> 
> 赞同：2
> 
> 时间：2009-04-07T04:37:27.833
> 
> 标签：c++, windows, opengl, input, messages

有谁知道为什么当您按住键盘键并尝试处理它时会有些犹豫？我在我的 WinProc(...) 中调用一个函数，当按下一个键时，它将在屏幕上移动一个图像 (OpenGL)。我按下它并得到一个响应，然后大约 0.5 秒没有任何反应，然后它表现正常（每个 WinMain 循环移动 1 个像素）。

我想知道Windows消息是否由于我需要禁用的某些功能而被延迟？？？

这是我的代码：

```
int WINAPI WinMain(HINSTANCE hinstance, HINSTANCE hprevinstance, LPSTR lpcmdline, int nshowcmd)
{
    bool quit = false;
    MSG msg;

    createWindow(hinstance, SCRW, SCRH, SCRD, WINDOWED);

    // Main loop
    while (!quit)
    {       
        if (PeekMessage(&msg, NULL, NULL, NULL, PM_REMOVE))
        {
            if (msg.message == WM_QUIT)
                quit = true;

            TranslateMessage(&msg);
            DispatchMessage(&msg);
        }

        renderFrame();        // processes graphics
        SwapBuffers(hdc);
    }
    return msg.lParam;
} 
```

和 WinProc （有更多的情况，但同样的事情......）：

```
 LRESULT CALLBACK WinProc(HWND hwnd, UINT msg, WPARAM wparam, LPARAM lparam)
    {
        switch(msg)
        {
            case WM_KEYDOWN:
                switch ( wparam )
                {
                    case VK_RIGHT:
                        key_RIGHT();
                        return 0;
                }
                return 0;
}
} 
```

和 key_RIGHT：

```
void key_RIGHT()
{
    MoveObjectRight1Pixel();
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T04:44:15.243

这是一个相当标准的键盘设置，在按下键和生成重复消息之间有一个小的延迟。

除了在 Windows 消息处理程序中处理键盘输入之外，您还可以保留一个 256 位的数组来指示键盘的当前状态。当您收到`WM_KEYDOWN`or`WM_KEYUP`时，您会更新相应密钥的位。然后，在您的主循环中，检查键的当前状态和键的先前状态（通过保留第二个 256 位数组，将其复制到每一帧）。

如果键当前向下但在前一帧中未向下，则相应地移动对象。

另一种选择是使用该[`GetAsyncKeyState()`](http://msdn.microsoft.com/en-us/library/ms646293(VS.85).aspx)功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T04:43:36.367

好吧，我认为您在这里处理的是标准的 Windows 功能。当按键被抑制时，Windows 通常会在触发重复击键事件之前有一个延迟。

我不知道其他方法，但是在第一次按键时，您可以激活一个计时器，该计时器每隔几毫秒检查一次按键是否被抑制，然后相应地处理您的代码。

我认为这将解决您遇到的问题。

# php - 安装 Html Tidy

> ID：724165
> 
> 赞同：2
> 
> 时间：2009-04-07T04:44:03.260
> 
> 标签：php, tidy, htmltidy

我正在使用 Apache/2.0.59 (Unix) PHP/5.2.5 DAV/2 运行 Mac OS X。我以前从未管理过 Apache 或 PHP，所以对我来说有些事情并不是那么明显。

我试图让 PHP Tidy 像这里提到的那样运行[http://th.php.net/manual/en/tidy.installation.php](http://th.php.net/manual/en/tidy.installation.php)

它说我需要“在 PHP 5 中，您只需要使用 --with-tidy 选项进行编译。” 但我只是不明白如何做到这一点，这是在尝试谷歌搜索 1 小时之后！

请帮忙！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T07:50:52.453

去这里开始[http://us.php.net/manual/en/install.php](http://us.php.net/manual/en/install.php)。还要考虑[这个](http://imthi.com/blog/linux/compile-and-install-php-528-on-mac-os-x-1056-leopard.php)，[这个](http://papelipe.no/tags/php/compiling_apache_and_php_on_mac_os_x)和[这个](http://www.gigoblog.com/2008/10/08/install-gd-for-php-on-mac-os-x-105-leopard/)。

您将需要阅读如何编译 PHP。它是从命令行完成的，所以如果您对此不满意，请小心。另请注意，在 Mac 上编译的细节非常详细，一个微小的失误会导致安装软管。

由于您使用的是 Mac，请查看[Marc Liyanage 的软件包](http://www.entropy.ch/software/macosx/php/)（尽管我不知道他们是否配置了 Tidy）。还可以考虑使用 MacPorts 来完成所有这些工作（对于确保安装所有依赖项特别有用）。如果您必须从头开始，请理解您**确实**需要知道自己在做什么。

不碍事的：

基本流程是配置、制作、制作安装。

以下是一些示例配置（不要使用这些。路径是特定于某些安装的，您会有不同的。这只是为了向您展示配置的外观）：

`./configure --with-mysql=/Applications/MAMP/Library --with-apxs2=/Applications/MAMP/Library/bin/apxs --with-gd --with-jpeg-dir=/Applications/MAMP/Library`

`./configure --prefix=/usr/local/apache2/php --with-zlib --with-xml --with-apxs2=/usr/local/apache2/bin/apxs --with-mysql=/usr/local/mysql`

因此，您需要将[需要/想要的任何其他配置选项](http://www.php.net/manual/en/configure.about.php)`--with-tidy`添加到该列表中。

这是另一个显示 make 和 make install`--with-tidy`的示例（最后请注意）：

`./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var --mandir=/usr/share/man --infodir=/usr/share/info --with-apxs2=/usr/sbin/apxs --with-curl --with-gd --enable-exif --enable-fastcgi --enable-zip --with-ldap=/usr --with-kerberos=/usr --with-zlib=/usr --enable-ftp --enable-sockets --with-iodbc=/usr --with-config-file-path=/etc --with-openssl --with-xmlrpc --with-xsl=/usr --with-tidy=/usr/bin/tidy`

`make`

`sudo make install`

阅读此内容并准备好几次才能正确完成（整个过程也需要一段时间）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-29T03:55:48.320

您还可以考虑为 OS X 使用预编译的 php-tidy 模块。它与 Zend IDE 等项目打包在一起。
如果您无法访问此类项目，请从此处下载：[http ://projectbee.org/blog/archive/download-php-tidy-extension-for-mac-os-x/](http://projectbee.org/blog/archive/download-php-tidy-extension-for-mac-os-x/)

# email - 如何在不将文件保存到磁盘的情况下通过电子邮件发送文件？

> ID：724175
> 
> 赞同：-1
> 
> 时间：2009-04-07T04:53:50.663
> 
> 标签：email, attachment

我需要通过电子邮件发送一个 vcal 文件。我想发送文件而不在磁盘上创建它。我有字符串格式的文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T06:10:43.943

这就是我认为您在 C# 中寻找的内容

```
 System.IO.StringReader stream = new System.IO.StringReader("xyz");
 Attachment attach = new Attachment(stream);
 MailMessage msg = new MailMessage();
 msg.Attachments.Add(attach);
 SmtpClient client = new SmtpClient();
 client.Send(msg); 
```

“xyz”应替换为附件的字符串。上面的代码将允许您向 MailMessage 对象添加附件，而无需从磁盘中检索该对象的数据，这就是我认为您的意思，而不是“内存”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T05:18:17.517

可能您能做的最好的事情（如果您使用的是图形电子邮件程序）就是将`.vcal`文件保存到一个临时目录，然后将该路径传递给邮件程序。

您可以使用诸如[`mktemp`](http://linux.die.net/man/3/mktemp).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T05:32:33.253

我不确定您所说的不“创建内存”是什么意思。操作系统通过将任何文件从磁盘读取到内存缓冲区来工作。因此，该文件很有可能在某个时候仍会驻留在内存中。此外，当您将文件传递给将要分派它的程序或工具时，它也会通过一些内存缓冲区。

# c++ - 编译zthreads

> ID：724178
> 
> 赞同：0
> 
> 时间：2009-04-07T04:55:24.950
> 
> 标签：c++, makefile

我下载了 zthreads（在这里找到：http: [//zthread.sourceforge.net/](http://zthread.sourceforge.net/)）并尝试编译，但我从 make 中得到这个错误：

```
MutexImpl.h:156: error: there are no arguments to 'ownerAcquired' that depend on a      template parameter, so a declaration of 'ownerAcquired' must be available 
```

MutexImpl.h:156: 错误：（如果你使用'-fpermissive'，G++ 将接受你的代码，但不允许使用未声明的名称）

然后对于该源文件中的每个函数，我都会收到这种错误：

```
MutexImpl.h:167: error: there are no arguments to 'function' that depend on a template parameter, so a declaration of 'function' must be available 
```

所以我猜这是一个makefile错误，但我不确定如何告诉make告诉g ++用-fpermissive编译文件。有谁知道如何将它放入makefile（如果这是问题）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T05:29:37.817

CXXFLAGS += -fpermissive

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T06:30:32.023

标准 gmake 约定是使用`CXXFLAGS`变量将选项传递给 C++ 编译器。您可以利用这一事实以及称为“命令行覆盖”的功能，通过以这种方式调用 gmake，将您的额外标志附加到传递给 g++ 的标志上：

```
make CXXFLAGS+=-fpermissive 
```

我自己下载了源代码以验证它是否有效，并发现它确实有效，尽管仍然发出了许多其他警告。如果您打算继续使用该库，您可能希望记录这些问题的错误。

希望这可以帮助，

埃里克·梅尔斯基

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-14T20:06:01.617

我摆脱了更改代码的所有这些错误：对于有该错误的每一行，将 this-> 添加到引发错误的函数中。在您引用的行中：

ownerAcquired 必须由 this->ownerAcquired 更改

我希望这有帮助

# windows-mobile - 代码签名 Windows Mobile 应用程序 - 建议？

> ID：724180
> 
> 赞同：1
> 
> 时间：2009-04-07T04:57:26.520
> 
> 标签：windows-mobile, code-signing, certificate-authority

我的任务是获取代码签名证书。我们的应用程序实际上由两个互补的组件组成：一个桌面应用程序和一个设计用于在 PDA 上运行的 Windows Mobile 应用程序。目前我们的移动安装（通过 CAB 文件）会触发 Windows Mobile 6 中的安全提示，这让我们的用户感到困惑。我们希望消除这些安全警告。

找到证书来签署桌面应用程序似乎很容易——我们也需要它——但我不太清楚这样的代码签名证书是否会解决我们的 Windows Mobile 问题。我理想的解决方案是 1 个可以同时签署桌面和移动应用程序的证书。

我读到的关于移动应用程序签名的很多内容都围绕着 Mobile2Market 和疯狂的多步签名程序——甚至发送你的可执行文件让它们签名并返回。我认为这主要针对手机市场，在手机市场上，手机供应商已经严格锁定手机，禁止使用未签名的应用程序。

我们的设备主要是预配置了一层安全性的 Windows Mobile 6 PDA (iPAQ 210)。我们不想提供设备、安装证书等（除非绝对必要）。我们只想签署文件并忘记它。

有没有人做过类似的事情并有任何建议？我对不需要向 Verisign 支付大量资金的低成本解决方案特别感兴趣——也许像 Comodo 这样的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T12:41:12.473

您可以对二进制文件进行自签名，但最终用户必须将您的证书安装到设备存储中，这可能会比仅仅获得真正的签名更痛苦，而且支持成本更高。

您需要的是[从 Verisign 购买 M2M 证书](http://www.verisign.com/code-signing/content-signing-accounts/microsoft-windows-mobile/index.html)。他们将向您发送一个包含某种密钥材料的 USB 密钥，您将使用它和他们的应用程序来签署您的二进制文件。

[此处概述](http://msdn.microsoft.com/en-us/library/ms839681.aspx)了什么级别的安全性给出什么提示。

# wpf - 任何人都知道用于调整跨单元格的网格列大小的算法吗？(WPF)

> ID：724187
> 
> 赞同：2
> 
> 时间：2009-04-07T05:01:48.147
> 
> 标签：wpf, grid

当您的子元素始终包含在单个网格单元中（即没有列/行跨度）时，使用 WPF 网格控件很容易。固定宽度的列保持请求的固定宽度，自动列确实会将自身调整为与列中最宽的单元格一样宽。星列根据它们的相对星值共享任何剩余空间。世界上一切都很简单。

但是一旦你有一个跨越两列或更多列的单元格，列的宽度计算起来就会变得更加复杂，而且确实看起来违反直觉。这是我的意思的一个简单的例子。我们可以定义两列，第一列为自动，第二列固定为 30 像素。

```
<Grid.ColumnDefinitions>
    <ColumnDefinition Width="Auto"/>
    <ColumnDefinition Width="30"/>
</Grid.ColumnDefinitions> 
```

现在我们定义一个跨越两列的按钮，并且恰好测量为 80 像素宽。（在我的机器上使用我的字体和主题设置等......）

```
<Button Grid.ColumnSpan="2" Content="QWERTYUIOP"/> 
```

我们需要在两个跨列中分配按钮的 80 像素宽度。鉴于第二列固定为 30，我希望为该列分配 30 个，其余 50 个分配给第一列。因为第一列是自动的，所以这似乎是显而易见的事情。

但不是。如果您在实践中尝试这样做，您会发现第一列是 0 像素，而第二列已经变成了完整的 80。即使第二列被定义为固定的，因此不应该变得更大，它被拉伸到全宽的按钮。也许我在这里遗漏了一些东西，但这对我来说似乎不太合乎逻辑。

所以对于我的实际问题。是否有完整描述网格控件用于执行此计算的逻辑，以便我可以完全理解它是如何工作的？我搜索了 MSDN 和 Google 并没有找到任何描述跨越元素如何影响列宽的内容。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T20:03:10.003

老实说，当我读到这篇文章时我不相信你，所以我不得不自己去测试它，你确实是对的。不过，我认为您不会有任何运气找到规则，因为进一步的调查使我相信这是 WPF 网格中的错误。我进行了许多测试，看看我是否能弄清楚这种行为，但如果你只是想知道最终结论，请随意翻阅以下谩骂。

抱歉，如果结果不清楚，它们就是我将它们写成作品的方式。前三个数字是我为每列输入的尺寸值，其余的是结果尺寸。

测试1：

```
<Grid Height="300" Width="300">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="..."/>
        <ColumnDefinition Width="..."/>
        <ColumnDefinition Width="..."/>
    </Grid.ColumnDefinitions>
    <Button Grid.ColumnSpan="2" Content="QWERTYUIOP"/>
</Grid> 
```

网格 300 X 300 托管 80 像素宽的控制。网格有三列，控件跨越第 0 列和第 1 列：

```
30  , auto, *    - column 0 - 80,  column 1 - 0,  column 2 - 220
auto, auto, *    - column 0 - 40,  column 1 - 40, column 2 - 220
auto, 30  , *    - column 0 - 0,   column 1 - 80, column 2 - 220
*   , 30  , *    - column 0 - 135, column 1 - 30, column 2 - 135
*   , 30  , 26*  - column 0 - 10,  column 1 - 30, column 2 - 260
*   , auto, *    - column 0 - 150, column 1 - 0,  column 2 - 150
*   , auto, 30*  - column 0 - 10,  column 1 - 0,  column 2 - 290
30  , 30  , *    - column 0 - 30,  column 1 - 30, column 2 - 240
*   , *   , 28*  - column 0 - 10,  column 1 - 10, column 2 - 280 
```

所以从这里我可以想出一些规则：

1.  如果一个元素跨越一个自动调整大小的单元格和一个非自动调整大小的单元格，则自动调整大小的单元格将被调整为 0
2.  如果一个元素跨越一个固定单元格和一个自动单元格，那么固定单元格的宽度将增加到可以包含整个对象的最小值
3.  如果一个元素跨越一个 * 大小的单元格和一个自动大小的单元格，则 * 大小的单元格将具有其预期大小
4.  如果一个元素跨越两个自动调整大小的单元格，它们将扩展以适合对象并且宽度相等
5.  如果一个元素跨越不包含自动单元格的单元格，则单元格将具有其预期大小

测试 2：

```
<Grid ShowGridLines="True" Height="300" Width="300">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="..."/>
        <ColumnDefinition Width="..."/>
        <ColumnDefinition Width="..."/>
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <RowDefinition Height="*"/>
    </Grid.RowDefinitions>
    <Button Grid.ColumnSpan="2" Content="QWERTYUIOP"/>
    <Button Grid.Row="1" Grid.Column="1" Content="QWERTYUIOP"/>
</Grid> 
```

网格 300 X 300，3 列托管一个 80 像素宽的控件，跨越第 0 行的第 0 列和第 2 列，第二个控件 80 像素宽，仅位于第 1 行的第 1 列

```
30  , auto, *    - column 0 - 30,  column 1 - 80, column 2 - 190
auto, auto, *    - column 0 - 0,   column 1 - 80, column 2 - 220
auto, 30  , *    - column 0 - 0,   column 1 - 80, column 2 - 220 (*)
*   , 30  , *    - column 0 - 135, column 1 - 30, column 2 - 135
*   , 30  , 26*  - column 0 - 10,  column 1 - 30, column 2 - 260
*   , auto, *    - column 0 - 110, column 1 - 80, column 2 - 110
*   , auto, 30*  - column 0 - 7,   column 1 - 80, column 2 - 213
30  , 30  , *    - column 0 - 30,  column 1 - 30, column 2 - 240
*   , *   , 28*  - column 0 - 10,  column 1 - 10, column 2 - 280 
```

(*) 这并不是真正发生的事情。第 1 列的大小设置为 80，但仅绘制非跨越元素的一部分。我使用按钮作为我的元素，非跨区按钮的镶边填充了 80 像素宽的第一列，但文本被修剪为 30 像素的大小。基本上它完全被搞砸了。

从这个测试中，我可以添加另外两个规则：

1.  如果在跨度中使用自动列*并且*可以从某处获取其大小，它将按预期运行
2.  如果在跨度中使用自动列并且无法从其他地方获取它的大小，则测量系统将中断并可能导致图形损坏。

所以，我想我们可以将这些规则组合成一个过度的哲学：

如果一个元素跨越多个列，并且这些列中的至少一个（但不是全部）是自动调整大小的，则必须有另一个不跨越为自动调整大小的列提供大小。否则，该行为充其量是出乎意料的，最坏的情况是破坏性的。

随意向 Microsoft 提出一个错误，但由于现在这是网格控件的定义行为，我想我们在 WPF 的整个生命周期中都会坚持使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-01T00:58:04.060

这是如何完成的：

*   如果 requestedSize (childelement.DesiredSize) 适合范围 (span) 的首选大小。RequestedSize 按照如下逻辑分布：

    *   自动定义不会参与分发；如果设置，它们只会变得最小。
    *   对于所有非自动定义，请求的大小在它们之间平均分配；不超过每个的首选大小。
*   如果 requestedSize 大于首选大小，但适合范围的最大大小。RequestedSize 按照如下逻辑分布：

    *   对于所有非自动定义，请求的大小在它们之间平均分配；不超过每个的最大尺寸。

    *   然后，上述步骤的剩余大小在自动定义之间平均分配。

*   如果 requestedSize 大于范围的最大大小。RequestedSize 按以下方式在所有定义之间平均分配：

    *   如果 equi-size 小于 maxSizes 的最大值。

        *   在这种情况下，大小的分布方式使得较小的定义比较大的定义增长得更快。

            *   如果 equi-size 大于或等于最大尺寸的最大值。
        *   所有定义都将收到 equalSize 作为它们的最小尺寸。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-07T09:09:21.517

我不知道互联网上某处是否有完整的描述..

我知道，自动意味着它会询问孩子控制他们希望有多大。星号 (*) 表示它将占用它剩下的所有空间......

**编辑：即时更新..** 宽度（ColumnDefinition）和高度（RowDefinition）是 GridLength 结构：

[MSDN 上的 GridLength](http://msdn.microsoft.com/en-us/library/system.windows.gridlength.aspx)

# macos - 在 OS X 的 Ruby 脚本中使用用户名/密码身份验证的最佳方法是什么？

> ID：724195
> 
> 赞同：0
> 
> 时间：2009-04-07T05:07:44.437
> 
> 标签：macos, authentication, scripting, passwords

我正在开发一个自动备份脚本。此脚本需要使用用户名和密码下载 HTTP 资源。目前，身份验证凭据是明文形式，从安全角度来看，这显然并不理想。[阅读这篇](http://www.dribin.org/dave/blog/archives/2006/01/16/keychain_cli/)博文后，我最近`security`在 OS X 上发现了该实用程序。使您可以从命令行访问钥匙串。OS X Keychain 允许您指定允许访问特定密码的应用程序，但事实证明，如果它轮流调用，则您无法授予访问权限，您必须 put ，这基本上可以访问机器上的任何人。`security``myscript``security``security`

除了创建一个纯粹用于运行此脚本的用户（例如“备份”）并赋予脚本 700 权限之外，在 OS X 10.5 中是否有更好的方法来解决此问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T05:20:37.493

基本上，确定的用户可以访问您以程序可以访问的方式存储的任何内容，而无需用户输入。如果我是你，我只会将凭据存储在`0700`-permissions 文件中，以确保只有合适的人才能看到它。

如果您想知道为什么不混淆密码，您可能需要查看 Pidgin 的相关政策：[纯文本密码](http://developer.pidgin.im/wiki/PlainTextPasswords)。

# c# - 如何使用 C#.net 更改热敏打印 (lipi lwt 150) 中的字体大小

> ID：724197
> 
> 赞同：0
> 
> 时间：2009-04-07T05:09:30.237
> 
> 标签：c#, .net, printing, thermal-printer

我正在使用 C#.net 和 GDI 打印代码打印到热敏打印机 LIPI LWT 150。但是，我无法更改字体大小。我使用的是 Arial 9pt 和 5pt，但它以默认大小显示。有人对此有任何想法吗？

我正在使用这样的 C# 代码：

```
 public frmSale()
        {
            InitializeComponent();
            printingDoc.PrintPage += new PrintPageEventHandler(Form_PrintPage);
        }

//initalizing print document
private void PrintSettings()
{

    printingDoc.DefaultPageSettings.Margins = new Margins(3, 3, 3, 3);
    PaperSize pSize = new PaperSize();
    pSize.Width = 275;
    printingDoc.DefaultPageSettings.PaperSize = pSize;

    // Claculating the PageWidth and the PageHeight
    PageHeight = printingDoc.DefaultPageSettings.PaperSize.Height;
    PageWidth = printingDoc.DefaultPageSettings.PaperSize.Width;
    // Claculating the page margins
    LeftMargin = printingDoc.DefaultPageSettings.Margins.Left;
    TopMargin = printingDoc.DefaultPageSettings.Margins.Top;
    RightMargin = printingDoc.DefaultPageSettings.Margins.Right;
    BottomMargin = printingDoc.DefaultPageSettings.Margins.Bottom;
    printAreaWidth = PageWidth - RightMargin - LeftMargin;

}

private void Form_PrintPage(object o, PrintPageEventArgs e)
//Here we Begin All the printing Process... 
{

       PrintSettings();
       CurrentY = (float)printingDoc.DefaultPageSettings.Margins.Top;//0;
       PrintEstHeader(e.Graphics);
        DrawEstGridData(e);

}

//Printing Function
private void PrintEstData(Graphics g, string stringData, StringAlignment alignment, Font fnt, Color clr, bool newLine)//,int starting,int maxWidth)
{
    StringFormat stringFormat = new StringFormat();
    stringFormat.Trimming = StringTrimming.Word;
    stringFormat.FormatFlags = StringFormatFlags.NoWrap |
        StringFormatFlags.LineLimit | StringFormatFlags.NoClip;

    stringFormat.Alignment = alignment;

    RectangleF Rect = new RectangleF((float)LeftMargin, CurrentY,
                      (float)PageWidth - (float)RightMargin - (float)LeftMargin,
                      g.MeasureString(stringData, fnt).Height);

    g.DrawString(stringData, fnt,
       new SolidBrush(clr),
       Rect, stringFormat);

    CurrentY += newLine ? g.MeasureString(stringData, fnt).Height : 0;
 }

private void PrintEstHeader(Graphics g)
{

    PrintEstData(g, "----------------------------------------------", StringAlignment.Near, new Font("Arial", 9), Color.Black, true);//,LeftMargin,printAreaWidth);

    PrintEstData(g, "Estimate" + "    " + "Rate  :" + ncRate.Value.ToString("0.00"), StringAlignment.Near, new Font("Arial", 9, FontStyle.Bold), Color.Black, true);//, LeftMargin, 76);

    PrintEstData(g, "----------------------------------------------", StringAlignment.Near, new Font("Arial", 9), Color.Black, true);//, LeftMargin, printAreaWidth);
    PrintEstData(g,"|ITEM |"+"WEIGHT|"+ "STN WT|"+"M.C. %|"+"Total|", StringAlignment.Near, new Font("Arial", 5), Color.Black, true);//,LeftMargin,42);
    PrintEstData(g, "----------------------------------------------", StringAlignment.Near, new Font("Arial", 9), Color.Black, true);//, LeftMargin, printAreaWidth);
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T11:04:29.807

根据[打印机规范](http://www.lipidata.com/prod_specs/pos_lwt150.htm)，它看起来不支持任意字体，但仅支持两种内置的固定宽度字体。除非您可以将位图打印到打印机或创建用户字符，否则我怀疑您是否能够做的不仅仅是选择字体 A 或字体 B。

# java - 是否应该使用 Java 方法参数来返回多个值？

> ID：724199
> 
> 赞同：26
> 
> 时间：2009-04-07T05:10:46.147
> 
> 标签：java, reference, arguments, return-value

由于在 Java 中发送给方法的参数指向调用者方法中的原始数据结构，因此其设计者是否打算让它们用于返回多个值，就像 C 等其他语言中的规范一样？

或者这是对 Java 的一般属性的危险滥用，即变量是指针？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-07T05:40:40.100

很久以前，我与 Ken Arnold（曾经是 Java 团队的成员）进行了一次对话，这可能是在 1996 年的第一次 Java One 会议上。他说他们正在考虑添加多个返回值，这样你就可以写类似：

```
x, y = foo(); 
```

当时和现在推荐的做法是创建一个具有多个数据成员的类并返回它。

基于此，以及从事 Java 工作的人的其他评论，我会说意图是/是您返回一个类的实例，而不是修改传入的参数。

这是常见的做法（正如 C 程序员修改参数的愿望......最终他们通常会看到 Java 的做法。只要把它想象成返回一个结构。:-)

（根据以下评论进行编辑）

> 我正在读取一个文件并从中生成两个类型为 String 和 int 的数组，从每一行中为两者选择一个元素。我想将它们都返回到任何调用它的函数，以这种方式拆分文件。

我想，如果我理解正确的话，我可能会这样做：

```
// could go with the Pair idea from another post, but I personally don't like that way
class Line
{
    // would use appropriate names
    private final int intVal;
    private final String stringVal;

    public Line(final int iVal, final String sVal)
    {
        intVal    = iVal;
        stringVal = sVal;
    }

    public int getIntVal()
    {
        return (intVal);
    }

    public String getStringVal()
    {
        return (stringVal);
    }

    // equals/hashCode/etc... as appropriate
} 
```

然后让你的方法是这样的：

```
public void foo(final File file, final List<Line> lines)
{
    // add to the List.
} 
```

然后这样称呼它：

```
{
    final List<Line> lines;

    lines = new ArrayList<Line>();
    foo(file, lines);
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-07T08:54:56.467

在我看来，如果我们谈论的是公共方法，您应该创建一个单独的类来表示返回值。当您有单独的课程时：

*   它用作抽象（即一个`Point`类而不是两个长数组）
*   每个字段都有一个名称
*   可以变得不可变
*   使 API 的演变更容易（即返回 3 而不是 2 值，更改某些字段的类型等）

我总是选择返回一个新实例，而不是实际修改传入的值。这对我来说似乎更清楚，并且有利于不变性。

另一方面，如果它是一种内部方法，我想可能会使用以下任何一种方法：

*   一个数组 ( `new Object[] { "str", longValue }`)
*   一个列表（`Arrays.asList(...)`返回不可变列表）
*   对/元组类，例如[这个](http://javatuple.com/)
*   静态内部类，带有公共字段

不过，我更喜欢最后一个选项，配备合适的构造函数。如果您发现自己从多个地方返回相同的元组，则尤其如此。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-07T05:18:27.140

请参阅 1999 年推出的 RFE：

[http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4222792](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4222792)

我不认为打算在 Java 语言中允许它，如果您需要返回多个值，则需要将它们封装在一个对象中。

使用像 Scala 这样的语言，但是您可以返回元组，请参阅：

[http://www.artima.com/scalazine/articles/steps.html](http://www.artima.com/scalazine/articles/steps.html)

您还可以在 Java 中使用泛型返回一对对象，但这就是 AFAIK。

编辑：元组

只是为了补充一些。由于JDK内部缺乏，我以前在项目中实现了Pair。我的实现链接在这里：

[http://pbin.oogly.co.uk/listings/viewlistingdetail/5003504425055b47d857490ff73ab9](http://pbin.oogly.co.uk/listings/viewlistingdetail/5003504425055b47d857490ff73ab9)

请注意，这没有哈希码或等号，可能应该添加。

我在对提供元组功能的这个问题进行一些研究时也遇到了这个问题：

[http://javatuple.com/](http://javatuple.com/)

它允许您创建包含其他类型元组的 Pair。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-07T06:33:21.843

我真希望`Pair<E,F>`JDK 中有一个类，主要是因为这个原因。有`Map<K,V>.Entry`，但是创建一个实例总是很痛苦。

现在我`com.google.common.collect.Maps.immutableEntry`在需要时使用`Pair`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T05:16:29.797

您不能真正返回多个值，但您**可以**将对象传递给方法并让方法改变这些值。这是完全合法的。请注意，您不能将对象传入并让对象本身成为不同的对象。那是：

```
private void myFunc(Object a) {
    a = new Object();
} 
```

将导致*临时*和*本地*更改 的值`a`，但这不会更改调用者的值，例如，从：

```
Object test = new Object();
myFunc(test); 
```

myFunc 返回后，您将拥有*旧*的Object 而不是新的。

合法的（并且经常不鼓励）是这样的：

```
private void changeDate(final Date date) {
    date.setTime(1234567890L);
} 
```

我选择`Date`是有原因的。这是一个人们普遍认为不应该是可变的类。上面的方法*将*`Date`改变你传递给它的任何对象的内部值。当方法很明显会变异或配置或修改传入的内容时，这种代码是合法的。

注意：通常，据说一个方法应该做以下事情之一：

*   返回 void 并改变其传入的对象（如`Collections.sort()`），或
*   返回一些计算并且根本不改变传入的对象（例如`Collections.min()`），或者
*   返回传入对象的“视图”，但不修改传入对象（如`Collections.checkedList()`或`Collections.singleton()`）
*   变异一个传入的对象并返回它（`Collections`没有示例，但是`StringBuilder.append()`是一个很好的示例）。

改变传入对象*并*返回单独返回值的方法通常会做太多事情。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T05:29:12.840

当然有一些方法可以修改作为参数传入的对象（[参见 java.io.Reader.read(byte[] buffer](http://java.sun.com/j2se/1.4.2/docs/api/java/io/Reader.html#read(char[]))为例），但我还没有看到参数用作返回值的替代方案，特别是对于多个参数。它在技术上可能有效，但它是非标准的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T06:03:21.370

通常认为这不是非常好的做法，但在 JDK 中偶尔会出现这种情况。查看 View.getNextVisualPositionFrom() 的 'biasRet' 参数和相关方法，例如：它实际上是一个填充有“额外返回值”的一维数组。

那么为什么要这样做呢？好吧，只是为了让您不必为“偶尔的额外返回值”创建一个额外的类定义。它是凌乱、不雅、糟糕的设计、非面向对象的，等等。而且我们都时不时地这样做...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-07T22:04:10.233

一般是 Eddie 所说的，但我想再补充一句：

*   改变一个传入的对象，并返回一个状态码。这通常应该只用于显式缓冲区的参数，例如 Reader.read(char[] cbuf)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-17T20:11:57.437

我有一个 Result 对象，它通过一系列验证 void 方法作为方法参数级联。这些验证 void 方法中的每一个都会改变结果参数对象以添加验证结果。

但是这是不可能测试的，因为现在我不能存根 void 方法来返回存根值以在 Result 对象中进行验证。

因此，从测试的角度来看，似乎应该倾向于返回一个对象而不是改变方法参数。

# c# - 与串口设备通信时如何正确超时？

> ID：724201
> 
> 赞同：0
> 
> 时间：2009-04-07T05:14:56.337
> 
> 标签：c#, timeout, serial-port

我正在使用串行端口通信 C# windows 应用程序。我编写了一个程序来从端口获取数据，对其进行操作并通过串行端口进行写入。

我的问题是，万一设备没上电，电源断开，或者设备长时间不响应命令，我怎么知道？在我的程序中，我编写了正常的执行流程。但是如果长时间没有响应，程序会一直等待很长时间。我用了一个计时器，但它不能正常工作。

任何人都可以帮助我吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T05:41:57.380

如果您在 C# 中使用“SerialPort”对象，则可以使用 ReadTimeOut 和 WriteTimeOut 属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T05:21:39.520

你有两个选择：

1.  如果您有一个应该生成数据的设备，您可以在串行端口上监听数据，如果在一段时间内没有收到任何数据，您可以假设它处于脱机状态，

2.  定期通过串行端口向您的设备发送数据，如果您遇到异常，那么您将知道您的设备处于离线状态。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T18:10:13.823

可能有帮助的一件事是，如果您使用的电缆与 DTR / DSR 交叉连接，这意味着当您的程序启动时，您会提高 DTR，而另一个设备会看到 DSR 变高，进而提高 DTR，这会提高您的 DSR。

如果您使用未知电缆并与您无法控制的设备进行通信，那么您将不得不使用 .Timeout。

# tdd - NUnit 最佳实践

> ID：724209
> 
> 赞同：4
> 
> 时间：2009-04-07T05:18:02.493
> 
> 标签：tdd, nunit

*环境：（Visual Studio Professional 2008 中的 C# WinForms 应用程序）*

我一直在挖掘有关 NUnit 最佳实践的指导。作为在相对孤立的环境中工作的独立程序员，我希望这里的集体智慧可以帮助我。

斯科特怀特[在这里](http://scottwhite.blogspot.com/2008/05/nunit-best-practices.html)有几个很好的起点，但我不确定我是否完全同意他所说的一切——尤其是第 2 点。我的直觉告诉我，测试越接近被测试的代码，你得到的可能性就越大完整的测试覆盖率。在 Scott 的博客帖子的评论中，有人认为仅测试公共接口是最佳实践，但我认为测试框架不是典型的类消费者。

您可以推荐什么作为 NUnit 的最佳实践？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T05:39:41.520

如果第 2 点，你的意思是“每个解决方案的 bin 文件夹”——我明白你的意思。就个人而言，我会简单地添加对每个测试项目的引用。另一方面，如果您的意思是（1b）“不要将您的测试与您的代码放在同一个程序集中”，我衷心同意他的观点，但不同意您的观点。您的测试应该与您的生产代码不同，以提高代码的清晰度和组织性。保持你的测试类分开有助于下一个程序员更容易理解它。如果您需要在您的测试中访问内部——并且您可能因为内部方法对程序集是“公共的”，您可以使用 Assembly.cs 文件中的 InternalsVisibleTo 构造。

我也建议，一般来说，只对代码的公共接口进行单元测试就足够了。正确完成（使用 TDD），您的代码的私有方法将只是对先前公共代码的重构，并且将通过公共方法具有足够的测试覆盖率。当然，这是一个指导方针而不是法律，因此有时您可能想要测试私有方法。在这些情况下，您可以创建访问器并使用反射来调用私有方法。

我要提出的另一个建议是同时使用单元测试和代码覆盖率。代码覆盖率可以作为一种有用的启发式方法来确定何时需要更多测试。应使用缺乏覆盖作为指导，以指示可能需要更多测试的地方。这并不是说您需要 100% 的覆盖率——某些代码可能足够简单，不需要进行单元测试（例如自动属性），并且您现有的测试可能不会触及它们。

我对这篇文章有几个问题。最大的可能是缺乏对单元测试数据库的抽象。可能有一些集成测试需要针对数据库进行 - 如果您无法说服自己相信它们的正确性，则可能是在测试触发器或约束功能时。不过，总的来说，我认为您应该将数据访问实现为接口，然后在单元测试中模拟出实际的实现，这样就不需要实际连接到数据库。我发现我的测试运行得更快，因此当我这样做时我会更频繁地运行它们。构建“假”数据库接口可能需要一点时间，但只要您坚持使用相同的数据访问设计模式，就可以重复使用。

最后，我建议将 nUnit 与[TestDriven.Net](http://testdriven.net/)一起使用- 无论您是在使用 nUnit 还是 MSTest，这都是一个非常有用的插件。使用右键单击上下文菜单可以非常方便地运行或调试测试。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-07T05:51:11.540

> 我的直觉告诉我，测试越接近被测试的代码，你就越有可能获得完整的测试覆盖率。在 Scott 的博客帖子的评论中，有人认为仅测试公共接口是最佳实践，但我认为测试框架不是典型的类消费者。

如果您的代码不能仅使用公共入口点进行测试，那么您就有了设计问题。您应该阅读更多关于 TDD 和[SOLID 原则](http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod)（尤其是单一职责原则和依赖倒置）的信息。然后你就会明白，遵循 TDD 方法将帮助你编写更可测试、更灵活和可维护的代码，而无需使用诸如测试类的私有部分之类的“hacks”。

我还强烈推荐阅读[Miško Hevery 撰写的 Google 可测试性指南](http://misko.hevery.com/code-reviewers-guide/)，其中包含大量涵盖这些主题的代码示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T05:24:09.670

我的情况非常相似，这个问题描述了我所做[的 keep-your-source-close-and-your-unit-tests-closer](https://stackoverflow.com/questions/653545/keep-your-source-close-and-your-unit-tests-closer)。没有太多其他人迷恋我的方法，但它对我来说非常有效。

# python - 如何在 Django 中处理未知编码的 unicode？

> ID：724212
> 
> 赞同：1
> 
> 时间：2009-04-07T05:18:27.360
> 
> 标签：python, django, unicode

我想使用 Django ORM 包装器将一些文本保存到数据库中。问题是，这个文本是通过抓取外部网站生成的，而且很多时候它们似乎以错误的编码列出。我想存储原始字节，以便随着时间的推移改进我的编码检测，而无需重做刮擦。但 Django 似乎希望所有内容都存储为 unicode。我能以某种方式解决这个问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T10:18:10.743

例如，您可以存储编码为 base64 的数据。或者尝试从浏览器分析 HTTP 标头，从那里获得正确的编码可能更简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T10:20:20.503

用数据创建一个文件。使用 Django`models.FileField`保存对文件的引用。

不，它不涉及大量 I/O。如果您的文件很小，它会添加 2 或 3 个 I/O（读取目录、读取 iNode 和读取数据。）

# javascript - 只允许输入数字

> ID：724217
> 
> 赞同：2
> 
> 时间：2009-04-07T05:22:03.950
> 
> 标签：javascript, parsing

我正在尝试实现一个 javacript 函数，该函数不允许用户输入除浮点数（数字）以外的任何内容

这是我的方法，但我不知道如何改进它以允许提交负数（允许'-'键）并在 IE 上工作。

```
function digits_only(evt, form) {
    var evt = evt || window.event,
        targ = evt.target || evt.srcElement,
        charCode = evt.which || evt.keyCode,
        keyChar = String.fromCharCode(charCode),
        isValid = true;
    if (charCode > 13) {
        isValid = /[0-9.]/.test(keyChar);
        //if a dolt is already in input
        if (keyChar === '.' && /\./.test(targ.value)) {
            isValid = false;
        }
    }
    return isValid;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T07:21:07.907

我认为您正在寻找所谓的“输入掩码”。它们比只允许数字更强大。但是你可以直接使用它们。谷歌“javascript 输入掩码”或查看[这个 jQuery 插件](http://digitalbush.com/projects/masked-input-plugin/)。

编辑：似乎链接的插件只支持固定长度的掩码，但该术语可能是一个很好的起点......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T05:25:21.743

这是在 ASP.NET Web 应用程序上吗？您可以使用 AjaxControlToolkits MaskEditExtender。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T05:30:25.397

我在这里问过类似的问题：
[restrict user input using javascript](https://stackoverflow.com/questions/657492/restrict-user-input-using-javascript)

但是没有人给出这个问题的确切答案，所以让我们等到 WebForms 2.0 发布

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-08-13T14:20:20.367

您可以订阅“InputEvent”，然后获取“数据”道具。例如

```
input.addEventListener('beforeinput', (event) => {
    const data = event.data;

    // if "data" is present - user enter some character
    // if "data" is NOT present - user tap non character key (e.g. delete, shift and other)
    if(data) {
        // check if data is number or "."
        const isAllow = /\d|\./.test(data);

        if(!isAllow) {
            e.preventDefault();
        }
    }
}) 
```

更多信息

1.  event.data - [https://developer.mozilla.org/en-US/docs/Web/API/InputEvent/data](https://developer.mozilla.org/en-US/docs/Web/API/InputEvent/data)
2.  beforeinput 事件 - [https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/beforeinput_event](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/beforeinput_event)

# php - 运行 showdown.js 服务器端将 Markdown 转换为 HTML（在 PHP 中）

> ID：724218
> 
> 赞同：1
> 
> 时间：2009-04-07T05:22:23.763
> 
> 标签：php, html, markdown, wmd

我正在尝试在我的网站上实现 WMD，并且想知道如何运行 showdown.js 服务器端以将 Markdown 转换为 HTML？（为了将两者都存储在数据库中）

我正在使用 PHP ...任何提示都会有所帮助（以前从未从 php 运行过任何类型的 js）

谢谢，安德鲁

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T20:15:45.673

您可以使用[PHP Markdown](http://michelf.com/projects/php-markdown/) ，它是John Gruber 编写的[Markdown](http://daringfireball.net/projects/markdown/)程序的一个端口。

这是一个如何在代码中使用 PHP Markdown 的示例。

```
include_once "markdown.php";
$my_html = Markdown($my_text); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T05:31:28.733

如果您要运行降价转换器，为什么要运行 javascript 端口？是不是有点倒退了？

Markdown 最初设计用于在服务器端运行，showdown 是一个允许在 javascript 中进行转换的端口。

[这是你开始的地方](http://daringfireball.net/projects/markdown/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T11:17:14.843

WMD 处理标记的客户端实现。它允许用户在提交之前查看其输入的富文本版本。

一旦用户满意，他们就会使用表单将输入发送到服务器。

此时，您将使用您的 PHP 脚本来获取输入并对其进行清理。您将需要删除所有可能的 XSS 漏洞以及您不想存储在数据库中的任何 HTML 标签。

# java - 如何将 3D 点转换为 2D 透视投影？

> ID：724219
> 
> 赞同：65
> 
> 时间：2009-04-07T05:23:05.197
> 
> 标签：java, graphics, 3d, bezier

我目前正在使用贝塞尔曲线和曲面来绘制著名的犹他茶壶。使用 16 个控制点的 Bezier 补丁，我已经能够绘制茶壶并使用“世界到相机”功能显示它，该功能可以旋转生成的茶壶，目前正在使用正交投影。

结果是我有一个“扁平”茶壶，这是预期的，因为正交投影的目的是保留平行线。

但是，我想使用透视投影来给茶壶深度。我的问题是，如何获取从“世界到相机”函数返回的 3D xyz 顶点，并将其转换为 2D 坐标。我想在 z=0 处使用投影平面，并允许用户使用键盘上的箭头键确定焦距和图像大小。

我正在用java编程并设置了所有输入事件处理程序，并且还编写了一个处理基本矩阵乘法的矩阵类。我已经阅读了一段时间的维基百科和其他资源，但我不太了解如何执行这种转换。

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2009-05-15T02:26:19.290

我看到这个问题有点老了，但我还是决定给那些通过搜索找到这个问题的人一个答案。
现在表示 2D/3D 变换的标准方法是使用**齐次坐标**。*[x,y,w]*用于 2D，*[x,y,z,w]*用于 3D。由于您在 3D 和平移中都有三个轴，因此该信息完全适合 4x4 变换矩阵。在本说明中，我将使用列主矩阵表示法。除非另有说明，否则所有矩阵都是 4x4。
从 3D 点到光栅化点、线或多边形的阶段如下所示：

1.  使用逆相机矩阵变换您的 3D 点，然后进行所需的任何变换。如果您有表面法线，也可以转换它们，但将 w 设置为零，因为您不想转换法线。您转换法线的矩阵必须是*各向同性*的；缩放和剪切会使法线变形。
2.  用裁剪空间矩阵变换点。该矩阵使用视场和纵横比缩放 x 和 y，通过近和远剪切平面缩放 z，并将“旧”z 插入 w。转换后，您应该将 x、y 和 z 除以 w。这称为*透视划分*。
3.  现在您的顶点在剪辑空间中，并且您想要执行剪辑，这样您就不会在视口边界之外渲染任何像素。**Sutherland-Hodgeman 裁剪**是使用最广泛的裁剪算法。
4.  相对于 w 以及半宽和半高变换 x 和 y。您的 x 和 y 坐标现在位于视口坐标中。w 被丢弃，但 1/w 和 z 通常被保存，因为 1/w 需要在多边形表面上进行透视正确插值，并且 z 存储在 z 缓冲区中并用于深度测试。

这个阶段是实际的投影，因为 z 不再用作位置中的组件。

## 算法：

### 视野计算

这将计算视野。tan 采用弧度还是度数无关紧要，但*角度*必须匹配。*请注意，当角度*接近 180 度时，结果会达到无穷大。这是一个奇点，因为不可能有这么宽的焦点。如果您想要数值稳定性，请保持*角度*小于或等于 179 度。

```
fov = 1.0 / tan(angle/2.0) 
```

还要注意 1.0 / tan(45) = 1。这里的其他人建议只除以 z。这里的结果很清楚。您将获得 90 度的 FOV 和 1:1 的纵横比。像这样使用齐次坐标还有其他几个优点；例如，我们可以对近平面和远平面执行裁剪，而不将其视为特殊情况。

### 裁剪矩阵的计算

这是剪辑矩阵的布局。*aspectRatio*是宽度/高度。因此，x 分量的 FOV 根据 y 的 FOV 进行缩放。Far 和 near 是系数，它们是近和远裁剪平面的距离。

```
[fov * aspectRatio][        0        ][        0              ][        0       ]
[        0        ][       fov       ][        0              ][        0       ]
[        0        ][        0        ][(far+near)/(far-near)  ][        1       ]
[        0        ][        0        ][(2*near*far)/(near-far)][        0       ] 
```

### 屏幕投影

裁剪后，这是获得屏幕坐标的最终转换。

```
new_x = (x * Width ) / (2.0 * w) + halfWidth;
new_y = (y * Height) / (2.0 * w) + halfHeight; 
```

## C++ 中的简单示例实现

```
#include <vector>
#include <cmath>
#include <stdexcept>
#include <algorithm>

struct Vector
{
    Vector() : x(0),y(0),z(0),w(1){}
    Vector(float a, float b, float c) : x(a),y(b),z(c),w(1){}

    /* Assume proper operator overloads here, with vectors and scalars */
    float Length() const
    {
        return std::sqrt(x*x + y*y + z*z);
    }

    Vector Unit() const
    {
        const float epsilon = 1e-6;
        float mag = Length();
        if(mag < epsilon){
            std::out_of_range e("");
            throw e;
        }
        return *this / mag;
    }
};

inline float Dot(const Vector& v1, const Vector& v2)
{
    return v1.x*v2.x + v1.y*v2.y + v1.z*v2.z;
}

class Matrix
{
    public:
    Matrix() : data(16)
    {
        Identity();
    }
    void Identity()
    {
        std::fill(data.begin(), data.end(), float(0));
        data[0] = data[5] = data[10] = data[15] = 1.0f;
    }
    float& operator[](size_t index)
    {
        if(index >= 16){
            std::out_of_range e("");
            throw e;
        }
        return data[index];
    }
    Matrix operator*(const Matrix& m) const
    {
        Matrix dst;
        int col;
        for(int y=0; y<4; ++y){
            col = y*4;
            for(int x=0; x<4; ++x){
                for(int i=0; i<4; ++i){
                    dst[x+col] += m[i+col]*data[x+i*4];
                }
            }
        }
        return dst;
    }
    Matrix& operator*=(const Matrix& m)
    {
        *this = (*this) * m;
        return *this;
    }

    /* The interesting stuff */
    void SetupClipMatrix(float fov, float aspectRatio, float near, float far)
    {
        Identity();
        float f = 1.0f / std::tan(fov * 0.5f);
        data[0] = f*aspectRatio;
        data[5] = f;
        data[10] = (far+near) / (far-near);
        data[11] = 1.0f; /* this 'plugs' the old z into w */
        data[14] = (2.0f*near*far) / (near-far);
        data[15] = 0.0f;
    }

    std::vector<float> data;
};

inline Vector operator*(const Vector& v, const Matrix& m)
{
    Vector dst;
    dst.x = v.x*m[0] + v.y*m[4] + v.z*m[8 ] + v.w*m[12];
    dst.y = v.x*m[1] + v.y*m[5] + v.z*m[9 ] + v.w*m[13];
    dst.z = v.x*m[2] + v.y*m[6] + v.z*m[10] + v.w*m[14];
    dst.w = v.x*m[3] + v.y*m[7] + v.z*m[11] + v.w*m[15];
    return dst;
}

typedef std::vector<Vector> VecArr;
VecArr ProjectAndClip(int width, int height, float near, float far, const VecArr& vertex)
{
    float halfWidth = (float)width * 0.5f;
    float halfHeight = (float)height * 0.5f;
    float aspect = (float)width / (float)height;
    Vector v;
    Matrix clipMatrix;
    VecArr dst;
    clipMatrix.SetupClipMatrix(60.0f * (M_PI / 180.0f), aspect, near, far);
    /*  Here, after the perspective divide, you perform Sutherland-Hodgeman clipping 
        by checking if the x, y and z components are inside the range of [-w, w].
        One checks each vector component seperately against each plane. Per-vertex
        data like colours, normals and texture coordinates need to be linearly
        interpolated for clipped edges to reflect the change. If the edge (v0,v1)
        is tested against the positive x plane, and v1 is outside, the interpolant
        becomes: (v1.x - w) / (v1.x - v0.x)
        I skip this stage all together to be brief.
    */
    for(VecArr::iterator i=vertex.begin(); i!=vertex.end(); ++i){
        v = (*i) * clipMatrix;
        v /= v.w; /* Don't get confused here. I assume the divide leaves v.w alone.*/
        dst.push_back(v);
    }

    /* TODO: Clipping here */

    for(VecArr::iterator i=dst.begin(); i!=dst.end(); ++i){
        i->x = (i->x * (float)width) / (2.0f * i->w) + halfWidth;
        i->y = (i->y * (float)height) / (2.0f * i->w) + halfHeight;
    }
    return dst;
} 
```

如果你还在思考这个问题，OpenGL 规范对于所涉及的数学来说是一个非常好的参考。[http://www.devmaster.net/](http://www.devmaster.net/)上的 DevMaster 论坛也有很多与软件光栅化器相关的好文章。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-04-07T05:33:06.077

我想[这](https://stackoverflow.com/questions/701504/perspective-projection-help-a-noob/701978#701978)可能会回答你的问题。这是我在那里写的：

> 这是一个非常笼统的答案。假设相机在 (Xc, Yc, Zc) 并且您要投影的点是 P = (X, Y, Z)。从相机到您要投影到的 2D 平面的距离为 F（因此平面方程为 Z-Zc=F）。P 投影到平面上的二维坐标为 (X', Y')。
> 
> 然后，非常简单：
> 
> X' =​​ ((X - Xc) * (F/Z)) + Xc
> 
> Y' = ((Y - Yc) * (F/Z)) + Yc
> 
> 如果您的相机是原点，那么这将简化为：
> 
> X' =​​ X * (F/Z)
> 
> Y' = Y * (F/Z)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-07T05:33:20.553

要获得透视校正的坐标，只需除以`z`坐标：

```
xc = x / z
yc = y / z 
```

上面的工作假设相机在`(0, 0, 0)`并且你正在投影到平面上`z = 1`- 你需要翻译相对于相机的坐标。

曲线有一些复杂性，因为投影 3D 贝塞尔曲线的点通常不会为您提供与通过投影点绘制 2D 贝塞尔曲线相同的点。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-04-19T16:26:59.037

您可以使用以下方法在 2D 中投影 3D 点： Commons Math：只有两个类[的 Apache Commons 数学库。](http://commons.apache.org/proper/commons-math/)

Java Swing 的示例。

```
import org.apache.commons.math3.geometry.euclidean.threed.Plane;
import org.apache.commons.math3.geometry.euclidean.threed.Vector3D;

Plane planeX = new Plane(new Vector3D(1, 0, 0));
Plane planeY = new Plane(new Vector3D(0, 1, 0)); // Must be orthogonal plane of planeX

void drawPoint(Graphics2D g2, Vector3D v) {
    g2.drawLine(0, 0,
            (int) (world.unit * planeX.getOffset(v)),
            (int) (world.unit * planeY.getOffset(v)));
}

protected void paintComponent(Graphics g) {
    super.paintComponent(g);

    drawPoint(g2, new Vector3D(2, 1, 0));
    drawPoint(g2, new Vector3D(0, 2, 0));
    drawPoint(g2, new Vector3D(0, 0, 2));
    drawPoint(g2, new Vector3D(1, 1, 1));
} 
```

现在你只需要更新`planeX`和`planeY`来改变透视投影，得到这样的东西：

![在此处输入图像描述](https://i.stack.imgur.com/7oZPC.png)![在此处输入图像描述](https://i.stack.imgur.com/kvcle.png)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2016-08-17T20:17:31.577

[![在此处输入图像描述](https://i.stack.imgur.com/bBsXt.jpg)](https://i.stack.imgur.com/bBsXt.jpg)

从顶部看屏幕，您会得到 x 和 z 轴。
从侧面看屏幕，你会得到 y 和 z 轴。

使用三角函数计算顶视图和侧视图的焦距，即眼睛到屏幕中间的距离，由屏幕的视野决定。这使得两个直角三角形的形状背靠背。

hw = screen_width / 2

hh = screen_height / 2

fl_top = hw / tan(θ/2)

fl_side = hh / tan(θ/2)

然后取平均焦距。

fl_average = (fl_top + fl_side) / 2

现在用基本算术计算新的 x 和新的 y，因为由 3d 点和眼点构成的较大直角三角形与由 2d 点和眼点构成的较小三角形全等。

x' = (x * fl_top) / (z + fl_top)

y' = (y * fl_top) / (z + fl_top)

或者你可以简单地设置

x' = x / (z + 1)

和

y' = y / (z + 1)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-07T05:34:25.403

我不确定你在哪个级别问这个问题。听起来您好像在网上找到了公式，只是想了解它的作用。在阅读您的问题时，我提供：

*   想象一条来自观察者的光线（在点 V）直接朝向投影平面的中心（称为 C）。
*   想象从观察者到图像中的点 (P) 的第二条射线，该点也与投影平面在某个点 (Q) 相交
*   观察者与视平面上的两个交点形成一个三角形（VCQ）；边是两条射线和平面中点之间的线。
*   公式使用这个三角形来找到 Q 的坐标，这是投影像素的位置

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-05-08T02:30:40.470

所有答案都解决*了标题中*提出的问题。但是，我想添加一个隐含*在文本中*的警告。贝塞尔面片用于表示表面，但您不能只变换面片的点并将面片细分为多边形，因为这会导致几何变形。但是，您可以先使用转换的屏幕容差将面片细分为多边形，然后再转换多边形，或者您可以将贝塞尔面片转换为有理的贝塞尔面片，然后使用屏幕空间容差进行面片细分。前者更容易，但后者更适合生产系统。

我怀疑你想要更简单的方法。为此，您将通过反透视变换的雅可比行列式的范数缩放屏幕容差，并使用它来确定模型空间中所需的镶嵌量（计算前向雅可比行列式可能更容易，然后将其反转，然后采取规范）。请注意，此规范与位置有关，您可能希望根据视角在多个位置对其进行评估。还要记住，由于射影变换是有理的，因此您需要应用商规则来计算导数。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-04-29T23:56:22.373

感谢@Mads Elvenheim 提供了正确的示例代码。我已经修复了代码中的小语法错误（只是一些*const*问题和明显缺少的运算符）。此外，*near*和*far*在 vs. 中的含义也大不相同。

为了您的愉快，这里是可编译的（MSVC2013）版本。玩得开心。请注意，我已使 NEAR_Z 和 FAR_Z 保持不变。你可能不希望这样。

```
#include <vector>
#include <cmath>
#include <stdexcept>
#include <algorithm>

#define M_PI 3.14159

#define NEAR_Z 0.5
#define FAR_Z 2.5

struct Vector
{
    float x;
    float y;
    float z;
    float w;

    Vector() : x( 0 ), y( 0 ), z( 0 ), w( 1 ) {}
    Vector( float a, float b, float c ) : x( a ), y( b ), z( c ), w( 1 ) {}

    /* Assume proper operator overloads here, with vectors and scalars */
    float Length() const
    {
        return std::sqrt( x*x + y*y + z*z );
    }
    Vector& operator*=(float fac) noexcept
    {
        x *= fac;
        y *= fac;
        z *= fac;
        return *this;
    }
    Vector  operator*(float fac) const noexcept
    {
        return Vector(*this)*=fac;
    }
    Vector& operator/=(float div) noexcept
    {
        return operator*=(1/div);   // avoid divisions: they are much
                                    // more costly than multiplications
    }

    Vector Unit() const
    {
        const float epsilon = 1e-6;
        float mag = Length();
        if (mag < epsilon) {
            std::out_of_range e( "" );
            throw e;
        }
        return Vector(*this)/=mag;
    }
};

inline float Dot( const Vector& v1, const Vector& v2 )
{
    return v1.x*v2.x + v1.y*v2.y + v1.z*v2.z;
}

class Matrix
{
public:
    Matrix() : data( 16 )
    {
        Identity();
    }
    void Identity()
    {
        std::fill( data.begin(), data.end(), float( 0 ) );
        data[0] = data[5] = data[10] = data[15] = 1.0f;
    }
    float& operator[]( size_t index )
    {
        if (index >= 16) {
            std::out_of_range e( "" );
            throw e;
        }
        return data[index];
    }
    const float& operator[]( size_t index ) const
    {
        if (index >= 16) {
            std::out_of_range e( "" );
            throw e;
        }
        return data[index];
    }
    Matrix operator*( const Matrix& m ) const
    {
        Matrix dst;
        int col;
        for (int y = 0; y<4; ++y) {
            col = y * 4;
            for (int x = 0; x<4; ++x) {
                for (int i = 0; i<4; ++i) {
                    dst[x + col] += m[i + col] * data[x + i * 4];
                }
            }
        }
        return dst;
    }
    Matrix& operator*=( const Matrix& m )
    {
        *this = (*this) * m;
        return *this;
    }

    /* The interesting stuff */
    void SetupClipMatrix( float fov, float aspectRatio )
    {
        Identity();
        float f = 1.0f / std::tan( fov * 0.5f );
        data[0] = f*aspectRatio;
        data[5] = f;
        data[10] = (FAR_Z + NEAR_Z) / (FAR_Z- NEAR_Z);
        data[11] = 1.0f; /* this 'plugs' the old z into w */
        data[14] = (2.0f*NEAR_Z*FAR_Z) / (NEAR_Z - FAR_Z);
        data[15] = 0.0f;
    }

    std::vector<float> data;
};

inline Vector operator*( const Vector& v, Matrix& m )
{
    Vector dst;
    dst.x = v.x*m[0] + v.y*m[4] + v.z*m[8] + v.w*m[12];
    dst.y = v.x*m[1] + v.y*m[5] + v.z*m[9] + v.w*m[13];
    dst.z = v.x*m[2] + v.y*m[6] + v.z*m[10] + v.w*m[14];
    dst.w = v.x*m[3] + v.y*m[7] + v.z*m[11] + v.w*m[15];
    return dst;
}

typedef std::vector<Vector> VecArr;
VecArr ProjectAndClip( int width, int height, const VecArr& vertex )
{
    float halfWidth = (float)width * 0.5f;
    float halfHeight = (float)height * 0.5f;
    float aspect = (float)width / (float)height;
    Vector v;
    Matrix clipMatrix;
    VecArr dst;
    clipMatrix.SetupClipMatrix( 60.0f * (M_PI / 180.0f), aspect);
    /*  Here, after the perspective divide, you perform Sutherland-Hodgeman clipping
    by checking if the x, y and z components are inside the range of [-w, w].
    One checks each vector component seperately against each plane. Per-vertex
    data like colours, normals and texture coordinates need to be linearly
    interpolated for clipped edges to reflect the change. If the edge (v0,v1)
    is tested against the positive x plane, and v1 is outside, the interpolant
    becomes: (v1.x - w) / (v1.x - v0.x)
    I skip this stage all together to be brief.
    */
    for (VecArr::const_iterator i = vertex.begin(); i != vertex.end(); ++i) {
        v = (*i) * clipMatrix;
        v /= v.w; /* Don't get confused here. I assume the divide leaves v.w alone.*/
        dst.push_back( v );
    }

    /* TODO: Clipping here */

    for (VecArr::iterator i = dst.begin(); i != dst.end(); ++i) {
        i->x = (i->x * (float)width) / (2.0f * i->w) + halfWidth;
        i->y = (i->y * (float)height) / (2.0f * i->w) + halfHeight;
    }
    return dst;
}
#pragma once 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-22T08:29:46.310

我知道这是一个老话题，但你的插图不正确，源代码正确设置了剪辑矩阵。

```
[fov * aspectRatio][        0        ][        0              ][        0       ]
[        0        ][       fov       ][        0              ][        0       ]
[        0        ][        0        ][(far+near)/(far-near)  ][(2*near*far)/(near-far)]
[        0        ][        0        ][        1              ][        0       ] 
```

你的东西的一些补充：

如果要添加相机移动和旋转，此剪辑矩阵仅适用于在静态 2D 平面上投影：

```
viewMatrix = clipMatrix * cameraTranslationMatrix4x4 * cameraRotationMatrix4x4; 
```

这使您可以旋转 2D 平面并移动它..-

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-01-28T21:12:03.883

您可能希望使用球体调试系统以确定您是否具有良好的视野。如果它太宽，屏幕边缘的球体会变形为指向框架中心的更多椭圆形。这个问题的解决方案是放大框架，通过将 3 维点的 x 和 y 坐标乘以一个标量，然后将您的对象或世界缩小一个类似的因子。然后你会在整个框架上得到漂亮的均匀圆形球体。

我几乎很尴尬，我花了一整天的时间才弄清楚这一点，我几乎确信这里发生了一些令人毛骨悚然的神秘几何现象，需要一种不同的方法。

然而，通过渲染球体来校准缩放视图系数的重要性怎么强调都不为过。如果你不知道你的宇宙的“宜居带”在哪里，你最终会走在太阳上，放弃这个项目。您希望能够在您的视图中的任何位置渲染一个球体并让它看起来是圆形的。在我的项目中，与我所描述的区域相比，单位球体是巨大的。

此外，必填的维基百科条目： [球坐标系](http://en.wikipedia.org/wiki/Spherical_coordinate_system)

# sql-server - 数据库镜像/复制，SQL Server 2005

> ID：724222
> 
> 赞同：4
> 
> 时间：2009-04-07T05:24:51.040
> 
> 标签：sql-server, database, sql-server-2005, mirroring, backup-strategies

我有两台运行 SQL Server 2005 Enterprise 的数据库服务器，我想将其中一台用作镜像数据库服务器。

我需要的是；在镜像服务器上从主服务器创建一个精确的副本数据库，因此当主服务器关闭时，我们可以将应用程序上的数据库 IP 切换为使用镜像服务器。

我检查了 SQL Server 2005 上的“镜像”功能，并基于这篇文章：
[http ://aspalliance.com/1388_Database_Mirroring_in_Microsoft_SQL_Server_2005.all](http://aspalliance.com/1388_Database_Mirroring_in_Microsoft_SQL_Server_2005.all)

> 不能直接访问镜像数据库；但是，可以为只读目的拍摄镜像数据库的快照。（先决条件 4）

那么当主服务器关闭时我无法访问它时，它有什么用处呢？

我一直在考虑在主服务器上创建一个定期备份，并每小时在镜像服务器上恢复它，但这非常低效（慢），特别是如果我想要一个精确的副本（因为每分钟添加一次数百个数据）。

还有什么建议吗？

**编辑：**
也许我的意思是复制的东西，而不是镜子（感谢 JP 的评论）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T19:49:55.193

他们指的是您无法对镜像副本执行查询这一事实，但您可以通过创建镜像数据库的快照来绕过该限制。通常这样做是为了创建用于报告用途的只读数据库副本。如果主服务器发生故障，您将拥有镜像的完全访问权限，但它不会自动进行故障转移。

日志传送是另一种选择，它允许您查询（只读）备用数据库，而无需创建快照。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T06:10:33.537

如果我正确理解你的问题，你不应该这样做。您可以使用多种[角色切换表格](http://msdn.microsoft.com/en-us/library/ms189852.aspx)来让您的镜像接管为主。您无需在应用程序级别更改 IP 地址，集群本身有一个虚拟 IP 地址，允许在任何给定时间访问数据（给定从主故障切换到镜像的合理时间） . 镜子会自行保持同步。:)[这里](http://www.dell.com/downloads/global/solutions/public/white_papers/sql2005_clustering_wp.pdf)和[这里](http://www.sql-server-performance.com/articles/clustering/cluster_infrastructure_p1.aspx)都有关于集群的好文章。

编辑：好的，根据评论，检查[复制](http://msdn.microsoft.com/en-us/library/ms151198.aspx)的各种选项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-14T12:41:20.347

您的困惑很常见 - 有很多方法可以使用 SQL Server 进行灾难恢复计划。我录制了一个[10 分钟的 SQL Server 灾难恢复选项视频教程，](http://sqlserverpedia.com/wiki/Backup_%26_Restore#SQL_Server_Disaster_Recovery_Options_Tutorial)包括日志传送、镜像、复制等。如果你喜欢那个，我们在 Quest 有一个更长的，叫做[灾难恢复技术](http://www.quest.com/events/listdetails.aspx?contentid=9185&technology=34&prod=&prodfamily=&loc=)，但是那个需要注册。

您可能想要做的是告诉我们您的需求是什么，而不是在这里研究特定技术，然后我们可以帮助您找出适合您的选项。这些视频将让您了解在选择特定解决方案之前需要了解哪些类型的信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T15:58:25.303

仅使用两个 SQL Server 时，您需要手动进行故障转移。完成两件事后，“备份”数据库将可用；

1.  禁用镜像
2.  使用 RECOVERY 恢复数据库（但没有备份文件，这将使数据库可用）。

因此以这种方式镜像**确实可以**，但是很难维护；

从备份数据库移回主数据库是一种“痛苦”，因为您必须使用冗余服务器的备份再次设置完整的镜像。这是使主备份恢复速度所必需的。

我的建议是让第三个 SQL Server 加入到可以充当见证人的画面中。见证人将监控镜像数据库的状态。您的奖金；您将获得自动故障转移，并且不会出现故障转移（以及故障转移后）问题。

如果我没记错的话，见证服务器可以运行 SQL Express，所以这三个服务器上都不需要企业版——只有两个会发生实际镜像。

让我知道您是否需要 Transact SQL 以在两个服务器方案中执行故障转移和“反故障转移”命令，我可以将它们挖掘出来。

# nhibernate - 如何让 NHibernate 聚合函数 sum() 返回十进制？

> ID：724230
> 
> 赞同：3
> 
> 时间：2009-04-07T05:28:05.247
> 
> 标签：nhibernate, function, aggregate

我无法让 sum() 返回小数，它总是返回 int64 截断小数。我已经用谷歌搜索了一整天，但仍然找不到真正的工作。我有一个名为 ProductPurchase 的数据库表

QtyPurchased(int) 和 UnitPurchasePrice(money) 列，

这些使用 NHibernate 映射到 C# POCO 对象，其中 QtyPurchase 是一个 int 并且 UnitPurchasePrice 是一个小数属性。

我有以下 HQL 查询，我想在其中获取给定日期的总购买金额：

select sum(detail.QtyPurchased * detail.UnitPurchasePrice) from Domain.Entities.ProductPurchase AS detail where datediff("day", detail.PurchaseDate, :trading_date) = 0

现在无论出于什么原因，query.UniqueResult 总是返回一个 Int64 整数，截断小数，而生成的 SQL 显然返回正确的数字，并带有小数。有人可以解释一下如何让它返回十进制吗？

我注意到如果我使用 SQL（即 CreateSqlQuery），我可以得到小数点。这是 Nhibernate 的错误吗？

非常感谢

史蒂文·郭

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T07:08:52.447

反转因素的顺序对我来说是：（价格*数量）而不是（数量*价格）。

我想它必须只检查第一个参数类型，如果此解决方法对您有用，请填写[JIRA 问题。](http://nhjira.koah.net/secure/Dashboard.jspa)

# jquery - 在表单提交上创建 jquery cookie，然后将其显示在下一页上？

> ID：724233
> 
> 赞同：0
> 
> 时间：2009-04-07T05:29:36.817
> 
> 标签：jquery, jquery-plugins

我正在寻找一些执行此操作的示例代码，但运气不佳。

我将不胜感激任何帮助。

谢谢！！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T05:38:15.813

[这是一个用于 cookie 的 jquery 插件](http://plugins.jquery.com/files/jquery.cookie.js.txt)，但是我认为仅使用 javascript 本身会更容易（我的意思是不使用 jquery 库）

# nunit - 编写 NUnit 测试代码

> ID：724240
> 
> 赞同：0
> 
> 时间：2009-04-07T05:31:58.247
> 
> 标签：nunit

如何为以下方法编写代码以便可以在 NUnit 中进行测试？怎么处理`Hashtable`？

```
public DataSet MySampleMethod(int param1, string param2, Hashtable ht)
{
    if(ht==null)
    {
        ht = new Hashtable();
    }
    ht.Add("testKey","testData");

    DataSet ds = new DataSet();
    ds.Tables.Add();
    ds.Tables[0].Columns.Add("Column1");
    ds.Tables[0].Columns.Add("Column2");
    ds.Tables[0].Columns.Add("Column3");

    DataRow dr = ds.Tables[0].NewRow();
    dr["Column1"] = "My column 1";
    dr["Column2"] = "My column 2";
    dr["Column3"] = "My column 3";
    ds.Tables[0].Rows.Add(dr);

    DataRow dr1 = ds.Tables[0].NewRow();
    dr1["Column1"] = param1.ToString();
    dr1["Column2"] = param2;
    dr1["Column3"] = ht["testKey"].ToString();
    ds.Tables[0].Rows.Add(dr1);

    return ds;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-07T05:42:50.483

第一个要问的问题是：为什么我需要编写这个方法？它对我有什么用？

给该方法起一个更人性化的名称。据我所知，该方法接受一个整数、一个字符串和一个哈希表。然后，该方法应返回一个数据集，其中包含一个具有 3 列的单独表，

*   第一行包含像 {"My Column {ColumnNo}"..}
*   其中第二行包含 [ intParam.ToString(), stringParam, hashtable["testKey"] ]

测试这个方法应该很简单，Test#1：

1.  安排：创建已知输入（一个 int I、字符串 S、带有一些“testData”=> Y 的哈希表）
2.  Act : 调用方法并获取结果数据集
3.  Assert ：查询数据集以查看它是否具有包含 2 条记录的单个表。检查表中记录的内容，看它们是否包含标题行和带有 [I, S, Y] 的行。

测试#2：类似于上面的测试，除了你为 hashtable 参数传入 null。

根据您发布的片段，我只能看到这些。高温高压

**更新**：不确定“处理哈希表”或“为哈希表编写测试夹具代码”是什么意思？哈希表只是你的函数的一个参数..所以我认为测试看起来像这样（原谅糟糕的命名和缺少常量......除非我知道这个函数在现实生活中的用途，否则无法命名它们)

```
[Test]
public void Test_NeedsABetterName()
{
  int intVal = 101; string stringVal = "MyString"; string expectedHashValue = "expectedValue";
  Hashtable ht = new Hashtable();
  ht.Add("testKey", expectedHashValue);

  Dataset ds = MySampleMethod(intVal, stringVal, ht);

  Assert.AreEqual(1, ds.Tables.Count);
  Assert.AreEqual(2, ds.Tables[0].Rows.Count);
  // check header Row1.. similar to Row2 as shown below
  DataRow row2 = ds.Tables[0].Rows[1];
  Assert.AreEqual(intVal.ToString(), row2["Column1"]);
  Assert.AreEqual(stringVal,         row2["Column2"]);
  Assert.AreEqual(expectedHashValue, row2["Column3"])
} 
```

I'd recommend getting a good book like Pragmatic Unit Testing in C# with NUnit or one from the list [here](https://stackoverflow.com/questions/31837/best-books-about-tdd) to speed you up here.

# build - Apache Ant Build 命令“拒绝访问”

> ID：724244
> 
> 赞同：1
> 
> 时间：2009-04-07T05:33:12.003
> 
> 标签：build, installation, ant

嘿！我正在尝试安装 ant 并且实际上已经按照[此说明](http://ant.apache.org/manual/install.html#installing)进行了操作，但是，我收到此错误：

```
Buildfile: build.xml does not exist!
Build failed 
```

它说在那里我可能会得到，所以我只是尝试执行它说我应该执行的下一个命令（因为我在 Windows 下是这个）：

```
build -Ddist.dir=<C:\Ant> dist 
```

无论如何，当我按下回车键时我得到“访问被拒绝”，我不知道为什么。我也试过

```
build install 
```

和

```
build install-lite 
```

但我总是收到该消息=/任何想法为什么？或者我做错了什么？

* * *

**编辑**

没有 < > 我得到：

> 'build' 不是内部或外部命令、可运行程序或批处理文件。

* * *

**Edit2** 好吧，我的 ANT_HOME 在 C:\Ant 中，我试图运行命令，同时将自己放在该文件夹中，不是吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T05:39:08.230

您将 < 和 > 符号从字面上理解。把他们赶走。

有点像`C:\Users\<Your ID>`符号是占位符。

您在正确的目录中吗？您的路径中是否还有其他称为 build 的东西可能会取代您尝试调用的构建。您可以在该目录中创建一个文件吗？

```
PROMPT> copy con foo.txt
asdf
asdf
sdf
CONTROL-D 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T05:58:30.523

如果你得到这个，Ant 已经正确安装了：

```
Buildfile: build.xml does not exist!
Build failed 
```

您接下来尝试的“构建”命令仅用于从源代码构建 Ant。您不需要这样做，因为 Ant 已经安装。

一般来说，“'XXXX' 无法识别......”意味着 XXXX 不是命令/可执行文件，或者它不在您的 PATH 上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T05:37:32.057

不确定这是否有帮助，但首先想到的问题是“您对文件有适当的权限”吗？

# java - 如何使用java存储过程打开文件

> ID：724246
> 
> 赞同：0
> 
> 时间：2009-04-07T05:33:51.643
> 
> 标签：java, stored-procedures, oracle10g, oracle-apex

我正在使用 oracle 数据库 10g。我必须编写一个 java stroed 过程，通过它我可以在服务器上调用一个文件并将其本地存储在用户机器上。我正在使用 oracle Apex 3.1.1。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T15:02:34.133

如果您谈论的是真正的 Oracle Java 存储过程，我认为您无法做到这一点。请记住，Java 过程是在数据库中的 Oracle JVM 下运行的，这意味着它只能“看到”数据库主机文件系统。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T19:03:24.910

既然您使用的是 APEX 3.1，那么您是否有理由简单地通过 APEX（因此是 Web 服务器）在服务器上创建指向文件的链接来下载文件？

您也可以通过 UTL_FILE 包执行此操作，只是不要忘记运行 CREATE DIRECTORY 并首先在目录上授予 READ 权限。

我认为您也可以通过 java 打开文件，但前提是您首先进行授权以允许 Oracle 进程访问系统上的目录。这似乎是最复杂的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T05:52:14.970

有什么理由必须是java吗？PL/SQL 中的 DBMS_FILE 通常应该可以正常工作。

否则，我认为（我很久没有做过 java 存储过程了）你应该能够像在 java 中一样打开一个 IO 流。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-09T07:35:28.360

为什么是 Java 存储过程？仅仅因为你认为它不能在 PL/SQL 中完成？

PL/SQL 中有几个 FTP 实现。 [Sourceforge 有一个](http://www.oracle-base.com/articles/misc/FTPFromPLSQL.php "来自 PL/SQL 的 FTP"). [Tim Hall 在他的 Oracle-Base 站点](http://www.oracle-base.com/articles/misc/FTPFromPLSQL.php "来自 PL/SQL 的 FTP")上发表了一篇文章。

[1](http://www.oracle-base.com/articles/misc/FTPFromPLSQL.php "来自 PL/SQL 的 FTP")： http: [//sourceforge.net/projects/plsqlftp/](http://sourceforge.net/projects/plsqlftp/) “UTL_FTP项目

# unicode - 多字节字符集中的换行控制字符

> ID：724247
> 
> 赞同：5
> 
> 时间：2009-04-07T05:33:53.220
> 
> 标签：unicode, character-encoding, newline, cjk

我有一些 Perl 代码可以将换行符和换行符转换为规范化形式。输入文本是日文，所以会有多字节字符。

是否仍然可以逐字节地进行这种转换（我认为目前可以），还是我必须检测字符集并启用 Unicode 支持？换句话说，流行的编码（Shift-JIS、EUC-JP、UTF-8、ISO-2022-JP）是否使用字节作为其字符集的一部分，可能会被误认为是 ASCII 控制字符？

我只需要 CR 和 LF 就可以工作。

**更新：**添加了 ISO-2022-JP。那是它的时髦转义序列看起来最麻烦的一个......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T19:47:18.120

您提到的 4 种编码（Shift-JIS、UTF-8、EUC-JP、ISO-2022-JP）都没有在日文字符中使用 CR 或 LF 字符。对于 UTF-8 和 EUC-JP，低 ascii 字符和日语字符中的字节之间没有任何重叠。但是，对于 Shift-JIS 和 ISO-2022-JP，存在重叠，但不在您找到 CR 和 LF 的范围内。

```
For ISO-2022-JP,
First-byte range: 0x21 - 0x7E
Second-byte range: 0x21 - 0x7E 
```

而在各种字符集之间来回切换的转义序列字符有：

```
0x1B, 0x28, 0x24, 0x40, 0x42, and 0x4A 
```

如您所见，ISO-2022-JP 中用于对日文字符进行编码的字符都没有与 CR 或 LF 重叠。

```
For Shift-JIS,
First-byte range: 0x81 - 0x9F, 0xE0 - 0xEF
Second-byte range: 0x40 - 0x7E, 0x80 - 0xFC
Half-width katakana: 0xA1 - 0xDF 
```

同样，CR 和 LF 没有重叠。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-07T06:37:00.650

对于前 128 个代码点，所有这些字符集都与 ASCII 相同——也就是说，它们只使用一个字节来编码 ASCII 字符，包括 CR (0x0D) 和 LF (0x0A)。你不应该有任何问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T14:11:43.740

ISO-2022-JP 使用 Shift-In/Shift-Out 为 94 个可打印的 ASCII 字符分配不同的含义，使包括 CR 和 LF 在内的控制字符保持不变。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-01-30T18:21:28.820

以下是 UTF-8 编码的（规范）细节：«[...] 值 0x00..0x7F 不会出现在任何字节中，以表示任何其他 Unicode 代码点 [...]。» — 来自 «Unicode® 标准 — 版本 11.0 — 核心规范» — 2018 年 6 月 — [https://www.unicode.org/versions/Unicode11.0.0/UnicodeStandard-11.0.pdf](https://www.unicode.org/versions/Unicode11.0.0/UnicodeStandard-11.0.pdf)

# api - F#：去流畅化 API 的最佳方式？

> ID：724249
> 
> 赞同：3
> 
> 时间：2009-04-07T05:34:38.507
> 
> 标签：api, fluent-nhibernate, f#, fluent-interface

我正在扩展 Fluent NHibernate 以便更好地与 F# 一起使用（即报价支持），并希望得到一些关于去流化 API 的反馈。F# 要求使用返回值，除非它们是类型单位。所以这最终以“|> ignore”终止每一行：

```
type ProductMap() as m = inherit QClassMap<Product>() do
    let x = Unchecked.defaultof<Product> 
    m.Id <@ x.Id @> |> ignore
    m.Map <@ x.Name @> |> ignore
    m.Map <@ x.Price @> |> ignore
    (m.HasManyToMany <@ seq x.StoresStockedIn @>)
        .Cascade.All()
        .Inverse()
        .WithTableName("StoreProduct") |> ignore 
```

我的第一反应是向基类添加更多方法，以便它们返回单位。例如，“IdI”和“MapI”：

```
...
m.IdI <@ x.Id @>
m.MapI <@ x.Name @> 
m.MapI <@ x.Price @> 
... 
```

但这需要在这里和那里进行特定的重载，并且长链仍然需要 |> Ignore。我还考虑过使用 Done 属性扩展对象：

```
(m.Id <@ x.Id @>).Done
(m.Map <@ x.Name @>).Done
(m.Map <@ x.Price @>).Done
(m.HasManyToMany <@ seq x.StoresStockedIn @>)
    .Cascade.All()
    .Inverse()
    .WithTableName("StoreProduct").Done 
```

你怎么看？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T06:25:39.833

IMHO a better approach would be to start from scratch *thinking in F#* (e.g function piping, currying, combinators) instead of wrapping fluent nhibernate, **but** using what fluent nhibernate has used to generate the mappings. That is, building a "parallel fluent nhibernate" for exclusive use of F#.

I've [recently posted](http://bugsquash.blogspot.com/2009/04/using-windsor-in-f.html) about a similar issue with Windsor's fluent interface in F#. My conclusion is that many DSLs / fluent interfaces built for C# / VB.NET will break in F# so I think it's best to build specific fluent interfaces that suit the F# way.

# ajax - 拖放支持的最佳 ajax 框架

> ID：724251
> 
> 赞同：3
> 
> 时间：2009-04-07T05:35:57.147
> 
> 标签：ajax, drag-and-drop

我必须构建一个应用程序，拖放功能似乎是最繁重的部分。根据以下一项或多项参数，拖放的最佳 Ajax 框架是什么：

1.  学习曲线
2.  代码大小
3.  浏览器兼容性

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T05:47:12.640

我的选择是[jQuery UI](http://jqueryui.com/home)。

1.  学习曲线很短。我自己是 javascript 框架的新手，我发现它很容易学习。把你的头脑放在选择器上，你就被排序了。当前版本的 jQuery UI 具有特定的[拖放](http://jqueryui.com/demos/draggable/)[功能](http://jqueryui.com/demos/droppable/)。

2.  jQuery UI 允许您自定义您的包，因此您只包含您正在使用的组件（以及核心）。当然，它已被最小化，因此您想要的总大小可以低至 135kb 标记。

3.  您可能不会发现这里的框架之间有太大区别。根据 jQuery 网站，它已经过*“在 IE 6.0+、FF 2+、Safari 3.1+、Opera 9.0+ 和 Google Chrome 中的兼容性”测试。*

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T05:51:05.127

我最近做了一个类似的研究，我得出结论认为**JQuery**是要走的路。仅仅因为我发现了最多的可用和可理解的（对我来说就是）代码示例......我在这里发布了其中一个（我忘记了我从哪里剪下来的）。

```
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; utf-8" />
<title>Sortables demo - Interface plugin for jQuery</title>
        <script type="text/javascript" src="/jquery/jquery.js"></script>
        <script type="text/javascript" src="/interface/interface.js"></script>
<style type="text/css" media="all">
html
{
    height: 100%;
}
img{
    border: none;
}
body
{
    background: #fff;
    height: 100%;
    font-family: Arial, Helvetica, sans-serif;
    font-size: 11px;
}
.groupWrapper
{
    width: 32%;
    float: left;
    margin-right: 1%;
    min-height: 400px;
}
.serializer
{
    clear: both;
}
.groupItem
{
    margin-bottom: 20px;
}
.groupItem .itemHeader
{
    line-height: 28px;
    background-color: #DAFF9F;
    border-top: 2px solid #B5EF59;
    color: #000;
    padding: 0 10px;
    cursor: move;
    font-weight: bold;
    font-size: 16px;
    height: 28px;
    position: relative;
}

.groupItem .itemHeader a
{
    position: absolute;
    right: 10px;
    top: 0px;
    font-weight: normal;
    font-size: 11px;
    text-decoration: none;
}
.sortHelper
{
    border: 3px dashed #666;
    width: auto !important;
}
.groupWrapper p
{
    height: 1px;
    overflow: hidden;
    margin: 0;
    padding: 0;
}
</style>
</head>
<body>
<div id="sort1" class="groupWrapper">
    <div id="newsFeeder" class="groupItem">

        <div class="itemHeader">Feeds<a href="#" class="closeEl">[-]</a></div>
        <div class="itemContent">
            <ul>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>

                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
            </ul>
        </div>
    </div>
    <div id="news" class="groupItem">
        <div class="itemHeader">News<a href="#" class="closeEl">[-]</a></div>
        <div class="itemContent">

            <ul>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
            </ul>
        </div>

    </div>
    <p>&nbsp;</p>
</div>
<div id="sort2" class="groupWrapper">
    <div id="shop" class="groupItem">
        <div class="itemHeader">Shopping<a href="#" class="closeEl">[-]</a></div>
        <div class="itemContent">
            <ul>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>

                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
            </ul>
        </div>
    </div>
    <p>&nbsp;</p>

</div>
<div id="sort3" class="groupWrapper">
    <div id="links" class="groupItem">
        <div class="itemHeader">Links<a href="#" class="closeEl">[-]</a></div>
        <div class="itemContent">
            <ul>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>

                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
            </ul>
        </div>
    </div>
    <div id="images" class="groupItem">
        <div class="itemHeader">Images<a href="#" class="closeEl">[-]</a></div>

        <div class="itemContent">
            <ul>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
                <li>orem ipsum dolor sit amet, consectetuer adipiscing elit</li>
            </ul>

        </div>
    </div>
    <p>&nbsp;</p>
</div>
<script type="text/javascript">
$(document).ready(
    function () {
        $('a.closeEl').bind('click', toggleContent);
        $('div.groupWrapper').Sortable(
            {
                accept: 'groupItem',
                helperclass: 'sortHelper',
                activeclass :   'sortableactive',
                hoverclass :    'sortablehover',
                handle: 'div.itemHeader',
                tolerance: 'pointer',
                onChange : function(ser)
                {
                },
                onStart : function()
                {
                    $.iAutoscroller.start(this, document.getElementsByTagName('body'));
                },
                onStop : function()
                {
                    $.iAutoscroller.stop();
                }
            }
        );
    }
);
var toggleContent = function(e)
{
    var targetContent = $('div.itemContent', this.parentNode.parentNode);
    if (targetContent.css('display') == 'none') {
        targetContent.slideDown(300);
        $(this).html('[-]');
    } else {
        targetContent.slideUp(300);
        $(this).html('[+]');
    }
    return false;
};
function serialize(s)
{
    serial = $.SortSerialize(s);
    alert(serial.hash);
};
</script>
<div  class="serializer">
<a href="#" onClick="serialize(); return false;" >serialize all lists</a>
<a href="#" onClick="serialize('sort1'); return false;" >serialize list 1</a>
<a href="#" onClick="serialize('sort2'); return false;" >serialize list 2</a>
<a href="#" onClick="serialize('sort3'); return false;" >serialize list 3</a>

<a href="#" onClick="serialize(['sort1', 'sort3']); return false;" >serialize lists 2 and 3</a>
</div>
        <script language="JavaScript" type="text/javascript">var client_id = 1;</script>
        <script language="JavaScript" src="http://stats.byspirit.ro/track.js" type="text/javascript"></script>
        <noscript>
        <p><img alt="" src="http://stats.byspirit.ro/image.php?client_id=1" width="1" height="1" /></p>
        </noscript>
</body>
</html> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T06:17:50.057

我同意你们所有人对 jQuery 的看法，但我想告诉你们**script.aculo.us**作为替代方案。

1）学习曲线真的很短

2）它有点重，因为你需要prototype.js（993kb）加上dragdrop.js（31kb）和scriptaculous.js（2kb）

3) 完全支持 IE6+、Firefox（我肯定说 1.5+、2+）和 Safari（肯定是 2+，也许是 1.3+）

链接： [Script.aculo.us 在 GitHub](http://wiki.github.com/madrobby/scriptaculous/droppables) [Script.aculo.us 主页](http://script.aculo.us/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T05:53:19.367

**jQuery**似乎是目前的市场领导者。它是轻量级的 (19kb) 并且有大量可从社区获得的插件。

（*请注意 - 文件大小仅在压缩和 GZipped 时。添加 UI 会增加文件大小*）

最常用的插件之一是与改进用户界面相关的插件，称为**UI**，包括可拖动和可放置功能。

jQuery UI 的主页位于[http://docs.jquery.com/UI](http://docs.jquery.com/UI)

与“拖放”相关的其他插件列表位于[http://plugins.jquery.com/project/Plugins/category/45](http://plugins.jquery.com/project/Plugins/category/45)

# c# - 为 Web 服务生成特定于客户端的验证码

> ID：724257
> 
> 赞同：1
> 
> 时间：2009-04-07T05:38:23.130
> 
> 标签：c#, security, encryption, hash, checksum

我有一个面向外部的 Web 服务，但是我需要生成一个验证系统以确保请求来自有效的客户端。

假设原始 Web 服务定义如下：

```
[OperationContract]
public void Service.RequestMethod (string clientId, int reqNumber,
    string reqText)
{
    // do stuff with the parameters
} 
```

我想确保请求实际上来自`clientId`参数指定的客户端。

我目前的计划是在方法签名中添加另一个参数，给出各种校验和。

```
[OperationContract]
public void Service.RequestMethod (string clientId, int reqNumber,
    string reqText, string reqChecksum)
{
    // verify reqChecksum, then
    // do stuff with the parameters
} 
```

我需要一个函数来验证校验和是否由批准​​的客户端计算。它应该根据`reqNumber`和`reqText`参数以及客户端和服务器都知道的特定于客户端的“密码”来计算。

实际上，它应该是：

```
private bool VerifyChecksum(int reqNumber, string reqText,
    string clientPassword, string reqChecksum)
{
    // hash reqNumber, reqTxt, and clientPassword
    // ensure it matches reqChecksum
} 
```

有人对这个散列函数或整个模型有什么建议吗？

它需要特定于消息、特定于客户端且难以猜测（高熵）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T05:44:01.120

您可能正在寻找某种[MAC](http://en.wikipedia.org/wiki/Message_authentication_code)。像 MD5 这样的哈希值。MD5 的整个想法是将其应用于“一些”数据并获得一个值。只要“一些数据”部分不为所有人所知，那么价值的再现几乎是不可能的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T14:27:11.153

为什么不使用标准 Web 服务身份验证方法之一？您可以选择知名且广泛实施的解决方案，并且不会因为尝试同时传递参数和身份验证信息而弄乱您的界面。

You might still have an authorization problem if an authenticated client can pass more than one 'clientId', but again there are plenty of known solutions to this and it's entirely on your side. E.g., you could go as far as an ACL implementation that lists all acceptable (userId, clientId, methodname) combinations and forbids everything else.

# c - C 中的联合与结构

> ID：724261
> 
> 赞同：10
> 
> 时间：2009-04-07T05:39:50.553
> 
> 标签：c, unions

这个问题背后的想法是理解使用联合的更深层次的概念并以不同的方式使用它以节省内存。我对所有人的问题是 -

假设有一个结构

```
struct strt
{
   float f;
   char c;
   int a;
} 
```

和 union 中表示的相同结构

```
union unin
{
   float f;
   char c;
   int a;
} 
```

如果我一个接一个地为结构成员分配值然后打印它们，它就会被打印出来。但是在联合的情况下它不会发生，一些覆盖正在完成..

所以我需要找到一种可以使用 union 存储 f、c、a 值的方法，然后我可以打印出来。（应用任何操作或任何东西..）但我正在寻找这种技术..那里的任何人都可以指导我或给我任何想法吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-04-07T06:05:41.037

如果您要查看结构如何存储其值，它会是这样的：

```
|0---1---2---3---|4---|5---6---7---8---|
|ffffffffffffffff|    |                | <- f: Where your float is stored
|                |cccc|                | <- c: Where your char is stored
|                |    |aaaaaaaaaaaaaaaa| <- a: Where your int is stored 
```

因此，当您更改 f 的值时，实际上是在更改字节 0-3。当您更改 char 时，实际上是在更改字节 4。当您更改 int 时，实际上是在更改字节 5-8。

如果你现在看看联合是如何存储它的值的​​，它会是这样的：

```
|0---1---2---3---|
|ffffffffffffffff| <- f: where your float is stored
|cccc------------| <- c: where your char is stored
|aaaaaaaaaaaaaaaa| <- a: where your int is stored 
```

所以现在，当我改变 f 的值时，我正在改变字节 0-3。由于 c 存储在字节 0 中，所以当您更改 f 时，您也更改了 c 和 a！当你改变 c 时，你改变了 f 和 a 的一部分——当你改变 a 时，你改变了 c 和 f。这就是你的“覆盖”发生的地方。当您将 3 个值打包到一个内存地址中时，您根本没有“节省空间”；您只是创建了 3 种不同的方式来查看和更改相同的数据。在那个联合中你并没有真正的 int、float 和 char——在物理层面上，你只有 32 位，可以被视为 int、float 或 char。改变一个*意味着*改变另一个。如果您不希望它们相互更改，请使用结构。

这就是为什么 gcc 告诉你你的 struct 是 9 个字节长，而你的 union 只有 4 个字节——它没有节省空间——只是 struct 和 union 不是一回事。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-04-07T05:44:16.393

我认为您误解了 a 的目的`union`。

`union`顾名思义，A定义了一个结构，其中**所有成员都占用相同的内存空间**。而 a`struct`将其每个成员放在单独的内存中，位于单个连续区域中。

与你的工会一起，当你写：

```
union foo;
foo.c = 3; 
```

然后`foo.a`和`foo.f`都将被改变。这是因为`.a`,`.c`和`.f`存储*在同一个内存位置*。因此，联合的每个成员都是同一内存的不同“视图”。a 不会发生这种情况，`struct`因为所有成员都是不同的并且彼此分开。

没有办法解决这种行为*，因为它是故意的。*

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-07T06:20:00.160

我认为你误解了工会。

> 使用联合背后的想法是节省内存......

是的，这是一个原因

> ...并获得与结构等效的结果...

不

它不等价。它们在源代码中看起来很相似，但它是完全不同的东西。像苹果和飞机。

联合是一个非常非常低级的结构，它允许您查看一块内存，就像存储它的任何“成员”一样，但您一次只能使用**一个**。甚至使用“成员”这个词也极具误导性。它们应该被称为“视图”或其他东西，而不是成员。

当你写：

```
union ABCunion
{
    int a;
    double b;
    char c;
} myAbc; 
```

你是说：“取一块足够大的内存来容纳 int、char 和 double 中最大的内存，我们称之为*myAbc*。

在该内存中，现在您可以存储**int**、**double**或**char**。如果你存储一个 int，然后存储一个 double，这个 int 就永远消失了。

 **那有什么意义呢？

联合有两个主要用途。

a) 区分存储

这就是我们上面所做的。我选择一段记忆，并根据上下文赋予它不同的含义。有时上下文是显式的（您保留一些变量来指示您存储的变量的“种类”），有时它可能是隐式的（根据代码部分，您可以判断必须使用哪个变量）。无论哪种方式，代码都需要能够弄清楚，否则您将无法对变量执行任何明智的操作。

一个典型的（显式）示例是：

```
struct MyVariantType
{
    int typeIndicator ;  // type=1 -> It's an int, 
                         // type=2 -> It's a  double, 
                         // type=3 -> It's a  char
    ABCunion body;
}; 
```

例如，VB6 的“变体”是与上述不同的联合（但更复杂）。

b) 拆分表示 当您需要能够将变量视为“整体”或部分组合时，这有时很有用。用一个例子更容易解释：

```
union DOUBLEBYTE
{
    struct
    {
        unsigned char a;
        unsigned char b;
    } bytes;
    short Integer;        
} myVar; 
```

这是一个带有一对字节的短整数“联合”。现在，您可以查看与短整数 (myVar.Integer) 相同的值，也可以轻松研究构成该值一部分的各个字节（myVar.bytes.a 和 myVar.bytes.b）。

请注意，第二次使用是不可移植的（我很确定）；这意味着它不能保证在不同的机器架构上工作；但是这种使用对于 C 设计的任务类型（操作系统实现）是绝对必要的。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-07T05:44:54.783

联合包含一组**互斥**数据。

在您的特定示例中，您可以将 float ( *f* )、char ( *c* ) 或 int ( *a* ) 存储在联合中。但是，只会为联合中*最大的项目*分配内存。联合中的所有项目将共享相同**的内存部分**。换句话说，将一个值写入联合，然后再写入另一个值将导致第一个值被覆盖。

你需要回去问问自己**你在建模什么**：

*   您是否真的希望*f*、*c*和*a*的值互斥（即一次只能存在一个值）？如果是这样，请考虑将联合与枚举值（存储在联合之外）结合使用，以指示联合中的哪个成员在任何特定时间点是“活动的”成员。这将允许您以更危险的代码为代价获得使用联合的内存优势（因为任何维护它的人都需要知道这些值是互斥的 - 即它确实是一个联合）。 *仅当您要创建许多这些联合并且内存保护至关重要（例如在嵌入式 CPU 上）时才考虑此选项。您甚至可能最终不会节省内存，因为您需要在堆栈上创建枚举变量，这也会占用内存。*

*   您是否希望这些值同时处于活动状态且不会相互干扰？如果是这样，您将需要使用结构来代替（正如您在第一个示例中所说的那样）。这将使用更多内存 - 当您实例化一个结构时，分配的内存是所有成员的总和（加上一些填充到最近的单词边界）。 *除非内存保护是最重要的（参见前面的示例），否则我会赞成这种方法。*

**编辑：**

（非常简单）如何将枚举与联合一起使用的示例：

```
typedef union
{
    float f;
    char c;
    int a;
} floatCharIntUnion;

typedef enum
{
    usingFloat,
    usingChar,
    usingInt
} unionSelection;

int main()
{
    floatCharIntUnion myUnion;
    unionSelection selection;

    myUnion.f = 3.1415;
    selection = usingFloat;
    processUnion(&myUnion, selection);

    myUnion.c = 'a';
    selection = usingChar;
    processUnion(&myUnion, selection);

    myUnion.a = 22;
    selection = usingInt;
    processUnion(&myUnion, selection);
}

void processUnion(floatCharIntUnion* myUnion, unionSelection selection)
{

    switch (selection)
    {
    case usingFloat:
        // Process myUnion->f
        break;
    case usingChar:
        // Process myUnion->c
        break;
    case usingInt:
        // Process myUnion->a
        break;
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T06:09:29.390

这是一个使用联合来存储数据的经典示例，具体取决于外部标记。

int、float 和 char * 都在联合中占据相同的位置，它们不是连续的，所以如果你需要将它们全部存储，它是你正在寻找的结构，而不是联合。

结构是联合中最大事物的大小加上类型的大小，因为它在联合之外。

```
#define TYP_INT 0
#define TYP_FLT 1
#define TYP_STR 2

typedef struct {
    int type;
    union data {
        int a;
        float b;
        char *c;
    }
} tMyType;

static void printMyType (tMyType * x) {
    if (x.type == TYP_INT) {
        printf ("%d\n", x.data.a;
        return;
    }
    if (x.type == TYP_FLT) {
        printf ("%f\n", x.data.b;
        return;
    }
    if (x.type == TYP_STR) {
        printf ("%s\n", x.data.c;
        return;
    }
} 
```

printMyType 函数将正确检测结构中存储的内容（除非您对其撒谎）并打印出相关值。

当您填充其中之一时，您必须执行以下操作：

```
x.type = TYP_INT;
x.data.a = 7; 
```

或者

```
x.type = TYP_STR;
x.data.c = "Hello"; 
```

一个给定`x`的一次只能是一件事。

任何尝试的人都有祸了：

```
x.type = TYP_STR;
x.data.a = 7; 
```

他们是在自找麻烦。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T05:48:17.787

当在任何给定时间点仅将以下其中一项存储在实例中时，通常会使用联合。即，您可以随时存储浮点数、字符或整数。这是为了节省内存 - 当您打算使用它来存储字符时，不为浮点数和整数分配额外/不同的内存。分配的内存量 = union 中最大的类型。

```
union unin
{
   float f;
   char c;
   int a;
} 
```

union 的另一个用途是当您想要存储具有部分的东西时，让 sat 您可能希望将寄存器建模为包含高字节、低字节和复合值的联合。因此，您可以将复合值存储到联合中，并使用成员通过其他成员获取片段。

# javascript - 设置确认提示框的标题

> ID：724271
> 
> 赞同：5
> 
> 时间：2009-04-07T05:44:59.107
> 
> 标签：javascript

有什么方法可以设置确认提示（javascript中的confirm（））框的标题？目前如果在IE中运行，会显示确认提示框的标题为“Windows Internet Explorer”，在Firefox中显示“http://...处的页面：”。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-07T05:47:09.897

[如链接规范中所示， Mozilla](https://developer.mozilla.org/en/DOM/window.confirm)和[IE](http://msdn.microsoft.com/en-us/library/ms536376(VS.85).aspx)都不支持设置标题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-07T06:05:52.237

根据规格是不可能的。我可以建议您改用[JavaScript 模态框](http://www.google.com.pk/search?q=javascript+modal+box)。

我使用过[Wildbit Labs 的 Modalbox](http://www.wildbit.com/labs/modalbox/)，效果很好。

# emacs - 删除 Emacs 中的选项卡不一致

> ID：724281
> 
> 赞同：0
> 
> 时间：2009-04-07T05:49:58.487
> 
> 标签：emacs

要在 emacs 中设置选项卡，我的 .emacs 中有这一行：

```
(global-set-key (kbd "TAB") 'tab-to-tab-stop) 
```

我正在寻找某种方法使所有模式在 emacs 中将制表符显示为 4 个空格，并让 emacs 将制表符保存为制表符（而不是将它们保存为空格）。

如果我使用的是 c 模式，那么 .emacs 行将使制表符看起来像 8 个空格并将它们保存为制表符。但是在 ada-mode enter 将自动缩进（我可以接受），它会在 emacs 中显示为 4 个空格并保存为 4 个空格。

有谁知道如何在按下 tab 键时通用设置选项卡以插入一个选项卡（并且没有空格）并让它在 emacs 上显示为四个空格？

我也试过：

```
(setq tab-width 4) 
```

但我仍然对 ada-mode 有同样的问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T06:35:30.013

由于存在特定于模式的缩进变量，因此您不能真正为所有模式执行此操作，但您可以为您关心的所有语言设置它。对于 C，您的 .emacs 中类似于以下内容的内容应该适用于您所描述的内容：

```
（添加钩子'c-mode-common-hook'
    （拉姆达（）
        (setq c-basic-offset 4)
        (setq tab-width 4)
        (setq 标准缩进 4)
        (setq c-tab-always-indent t)
    )
)

```

这将在 4 个字符处设置制表位，并使 4 成为所有 C 样式模式的默认缩进级别。对于其他语言及其各自的模式，您必须查找它们的缩进变量并在该模式的通用挂钩中相应地设置它们。一些示例包括 'sh-indentation、'tcl-indent-level 和 'perl-indent-level。找出需要设置的最简单的方法是运行：

```
Mx 描述键 [TAB]

```

那应该会让你掉进兔子洞。

干杯!
肖恩

# java - 如何使用 struts 2 将组合框值获取到我的 DAO 中？

> ID：724289
> 
> 赞同：1
> 
> 时间：2009-04-07T05:54:07.757
> 
> 标签：java, jsp, struts2

我有一个简单的用户注册表单。它包括姓名、年龄、性别和城市。但是这里的城市来自城市主表并将用户显示为组合框。但是当我试图通过我的 UserDAO 存储完整的用户注册信息时，我如何访问当前选定的城市值？我的用户注册 jsp 表单包含：

```
<s:form action="UserAction" >
            <s:textfield name="name" label="User Name" />
            <s:textfield name="age" label="Age" />
            <s:radio name="sex" label="Sex" list="{'M','F'}" />

            <s:select list="cities" key="cities.name"  listValue="name">
            </s:select>

        <s:submit />
</s:form> 
```

现在我正在调用 UserAction 的 execute() 方法。它包含 ：

```
public String execute() throws Exception {
        UserDAO.insert(user);
        return SUCCESS;
    } 
```

我的 DAO 的插入方法有以下代码：

```
 public static void insert(UserBean daoUb) throws Exception {
        Connection daoConn = null;
        CityBean cb=new CityBean();
        cb=daoUb.getCity();
        System.out.println("cb = "+cb);
        daoConn = connectionUtil.getConnection();

        Statement daoSt = daoConn.createStatement();
        String str = "INSERT user (name,age,sex,city) VALUES('" + daoUb.getName() + "'," + daoUb.getAge() + ",'" + daoUb.getSex() + "','"+cb.getName()+"')";
        daoSt.executeUpdate(str);
        //daoConn.close();
    } 
```

如果有人有任何建议，请建议我。我被这个问题困住了......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T06:33:38.753

您可以使用与其他字段类似的方法来获得它。您唯一需要做的就是为该字段命名。

为您的列表提供您在 bean 中的确切名称，在您的情况下为**city**。它现在应该开始工作了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T20:01:57.663

Vinegar 的建议是像这样修改你的 jsp

```
<s:select name="city" list="cities" key="cities.name"  listValue="name">
            </s:select> 
```

这假定您的 bean 具有您已经实现的城市属性的 getter 和 setter。

# maven-2 - 使用 exec 插件执行应用程序时如何添加类路径条目

> ID：724290
> 
> 赞同：3
> 
> 时间：2009-04-07T05:55:19.847
> 
> 标签：maven-2

其中一个组件是使用 java.class.path 系统属性查找 persistence.xml。希望将此文件与 /conf 文件夹中的 jar 分开保存。

使用 exec:exec 运行应用程序时，类路径由主 jar 的路径加上每个依赖项的路径组成。我似乎无法弄清楚如何将 /conf 条目添加到类路径中。

我的命令行如下所示：

mvn exec:exec -Dexec.executable="java" -Dexec.args="-classpath %classpath com.testjar.App"

我尝试了“arguments”参数，但如果我尝试将任何内容附加到 %classpath，则执行失败。我还尝试通过指定将 Class-Path 条目添加到清单中

```
<manifestEntries>
  <Class-Path>/conf</Class-Path>
</manifestEntries> 
```

在 maven-jar-plugin 的配置中，但清单中的条目对 java.class.path 属性的值没有影响。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T08:07:11.790

您可以在 POM 文件的“构建”部分中使用元素“资源”。例如

```
<build>
 <resources>
  <resource>
   <directory>src/main/resources/config</directory>
   <includes>
    <include>persistence.xml</include>
   </includes>
   <targetPath>/</targetPath>
  </resource>
 </resources>
 ...
</build> 
```

这会将persistence.xml 复制到构建输出目录中，即将persistence.xml 放在类路径中。

# vb.net - vb.net 代码使图像透明

> ID：724292
> 
> 赞同：0
> 
> 时间：2009-04-07T05:58:26.390
> 
> 标签：vb.net, image-processing, transparency

我希望使用 VB.NET 代码使位图图像 (.bmp) 透明。请帮助我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-06-03T16:41:05.123

对比 2012

Dim watermark_bm2 As Bitmap = 'someimage(来自文件或全局资源)

watermark_bm2.MakeTransparent()

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-08T03:26:12.427

我发现关键是使用`imageAttributes`类。基本上将颜色键设置为您用来表示透明区域的颜色，并使用`drawImage`接受`imageAttribute`参数的调用之一...

```
Imports System.Drawing.Imaging

' and in a sub somewhere:

Private mImageAttributes As New ImageAttributes
mImageAttributes.SetColorKey(Color.FromArgb(0, 220, 20, 255), 
Color.FromArgb(0, 220, 20, 255))

Dim imageRectangle As New Rectangle(pX, pY, pBitmap.Width, pBitmap.Height)
e.Graphics.DrawImage(pBitmap, imageRectangle, 0, 0, pBitmap.Width, pBitmap.Height,
GraphicsUnit.Pixel, mImageAttributes) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T06:09:27.317

这篇 msdn 文章提供了有关[如何执行此操作的完整详细信息](http://msdn.microsoft.com/en-us/library/ms172507.aspx)

这是[另一篇文章，但代码示例在 c# 中](http://www.c-sharpcorner.com/UploadFile/mahesh/DrawTransparentImageUsingAB10102005010514AM/DrawTransparentImageUsingAB.aspx)

# c# - 从 Gridview 更新 DOB 值的问题

> ID：724295
> 
> 赞同：0
> 
> 时间：2009-04-07T05:59:37.697
> 
> 标签：c#, .net, gridview

我在从 gridview 更新出生日期值时遇到问题。

在我的数据库表中，我将人的出生日期存储在...日、月、年等字段中。存储后，我使用此查询在名为 DateOfBirth 的单个字段下的 gridview 中显示了这些值。

```
SELECT Id, Name, Address, Day + '-' + Month + '-' + Year AS DateOfBirth, 
    Phone, EmergencyContact, DateOfRegistration FROM Patient 
```

它工作正常，以 DOB 格式显示 DateOfBirth。但是，当我尝试从 gridview 更新 DateOfBirth Contains 时，它不会更新表中其他字段正确更新的位置。

这是我的代码：

```
<Columns>
    <asp:BoundField DataField="DateOfBirth" HeaderText="DateOfBirth" 
        SortExpression="DateOfBirth" /> 
</Columns>
<asp:SqlDataSource>
    InsertCommand="INSERT INTO [Patient] ([Name], [Address], [Day],[Month],
         [Year], [Phone], [EmergencyContact], [DateOfRegistration]) 
         VALUES (@Name, @Address, @Day, @Month, @Year, @Phone, 
         @EmergencyContact, @DateOfRegistration)
    ProviderName="<%$ ConnectionStrings:ConnectionString.ProviderName %>"
    SelectCommand="SELECT Id, Name, Address, Day + '-' + Month + '-' + 
          Year AS DateOfBirth, Phone, EmergencyContact, DateOfRegistration
          FROM Patient
    UpdateCommand="UPDATE [Patient] SET [Name] = @Name, [Address] = @Address,
         [Day] = @Day, [Month]=@Month, [Year]= @Year, [Phone]=@Phone,
         [EmergencyContact]=@EmergencyContact, 
         [DateOfRegistration]=@DateOfRegistration 
         WHERE [Id] = @Id">
    <InsertParameters>
        <asp:Parameter Name="Day" Type="String" />
        <asp:Parameter Name="Month" Type="String" />
        <asp:Parameter Name="Year" Type="String" />
    </InsertParameters>
    <UpdateParameters>
        <asp:Parameter Name="Day" Type="String" />
        <asp:Parameter Name="Month" Type="String" />
        <asp:Parameter Name="Year" Type="String" />
    </UpdateParameters>
</asp:SqlDataSource> 
```

我的第二个问题是，当我从日历控件中选择日期并将其放入 TextBox 中然后保存时。之后，当我在 gridview 中显示日期时，日期显示正确，但与所有日期一起，时间是上午 12:00:00 . 对于表和 StoredProcedure 的注册日期类型，都采用 DatTime。这是我的代码：

```
protected void 
CalendarRegistrationDate_SelectionChanged(object sender, EventArgs e)
{
    TxtRegistrationDate.Text = 
        CalendarRegistrationDate.SelectedDate.ToShortDateString();
    CalendarRegistrationDate.Visible = false;
}   

protected void BtnCalender_Click(object sender, EventArgs e)
{
    CalendarRegistrationDate.Visible = true;        
}

DateTime registrationdate = Convert.ToDateTime(TxtRegistrationDate.Text); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T13:40:09.807

一世。将出生日期存储在数据库中的一个好习惯是以日期时间格式存储它。当您绑定到 GridView Column 时，您可以指定要以您希望的方式显示的格式。

您需要设置的属性是

DataFormatString = "dd-MMM-yyyy"

上面将以您想要的格式显示日期。修改您的插入/更新/选择查询，以便 DateofBirth 字段是日期时间类型的单个字段。

ii. 无论您想在哪里显示日期，都可以按照您想显示的方式进行格式化。

例如：字符串日期 = DateTime.Now.ToString("dd-MMM-yyyy")

# c# - 在互操作对象上调用方法，VB 与 C#

> ID：724298
> 
> 赞同：0
> 
> 时间：2009-04-07T06:02:03.510
> 
> 标签：c#, vb.net, interop

在 C# 中，我在互操作类（**Connection**，用 VB6 编写）上调用一个函数，它本身返回一个普通对象（**System**）。然后我还调用了该对象（**InitialiseData**）上的一个函数（即使编译器不知道它）。

```
var isInitialised = Connection.System.InitialiseData(path); 
```

问题是，因为该 System object 仅返回一个 Object，所以我收到编译错误“无法解析符号”。我明白为什么，但同样的事情在 VB.NET 中也能正常工作：

```
Dim isInitialised As Boolean = Connection.System.InitialiseData(path) 
```

大概 VB.NET 在后台做了一些允许一种隐式后期绑定的事情，而 C# 没有？有没有办法让 C# 以同样无知的方式编译？

事实上，在这种情况下，我似乎可以通过首先将 Object 转换为显式互操作类型来解决它：

```
var system = (QLO.System)Connection.System;
var isInitialised = system.InitialiseData(path); 
```

但是我仍然对无法转换为类型但仍想在其上调用函数的情况的答案*感兴趣*。如果这是一个愚蠢的问题，请原谅我，我才刚刚开始从 VB.NET 迁移到 C#...谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T06:07:44.730

后期绑定将在 4.0 中加入 C#。同时你可以做的是将函数包装在VB.NET中并使用C#调用调用VB6方法的VB.NET方法。

由于将其转换为正确的类型在 C# 中有效，这是否意味着 VB.NET 看到正确的类型而 C# 将其视为 Object？

# sql-server - SQL Server 事务

> ID：724301
> 
> 赞同：0
> 
> 时间：2009-04-07T06:03:28.657
> 
> 标签：sql-server, ado.net, transactions

何时使用 ado.net 和 SQL Server 事务？

当只有一个 SP 或针对该事务中的数据库触发查询时，是否有任何理由选择使用 ado.net 事务而不是 SQL Server 事务。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T06:21:29.377

如果您有多个资源参与事务，然后使用 ADO.NET（并让 DTC/Enterprise Services 为您管理它）怎么办，否则可以使用来自 SP 的 mssql 事务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T06:47:15.167

如果对一个执行一次查询的存储过程进行一次调用，我将不会使用 ADO.NET 事务。ADO.NET 事务的目的是将多个调用的执行包装到单个事务中。您的案例不符合该标准。

# .net - 使用 .NET 3.5 创建什么？Web 服务或 Windows 服务

> ID：724302
> 
> 赞同：2
> 
> 时间：2009-04-07T06:04:09.387
> 
> 标签：.net, wcf, web-services

我必须创建一个可以为大约 100,000 个客户提供服务的 Web 服务。我一直在创建 Windows 服务并在其中使用 WCF 绑定。Windows 服务使用 HTTP 绑定并提供可供任何可以使用 SOAP 交谈的客户端使用的 http 端点。我有点困惑是应该创建 ASP.NET Web 服务还是 Windows 服务，因为它们都将提供 HTTP 端点。我认为在 WCF 出现之前，Web 服务用于享受 HTTP 绑定，而 Windows 服务用于远程处理等。

如果两者都提供相同的 HTTP 端点，那么决定服务类型的标准应该是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T06:23:07.860

如果您正在构建一个需要为 100k 客户端提供服务的大容量应用程序，那么您应该选择 IIS。IIS 内置了许多设施来处理高负载以及身份验证和 SSL 证书等企业功能。如果您使用 Windows 服务，您将不得不自己推出很多服务。

您可以将 WCF 与其中任何一种一起使用，因此它决定了哪种应用程序类型更适合您，并且听起来绝对像 IIS。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T06:28:41.870

您的服务所在的端点和 WCF 与 ASP.NET 服务是两个不同的东西。 这是一篇关于 WCF 和 ASP.NET 服务之间差异[的不错的文章。](http://msdn.microsoft.com/en-us/library/aa738737.aspx)由于您正在寻找高可扩展性，因此托管端点的位置对您来说很重要。在可扩展性和可靠性方面，您应该利用 IIS7 中内置的所有出色功能来托管您的端点。我认为没有充分的理由在您自己的流程中托管它。开发可以像 IIS7 一样容易水平扩展的东西将是很多工作。这是[一篇](http://msdn.microsoft.com/en-us/library/ms733766.aspx)关于如何在 IIS 中托管 WCF 服务的小文章。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T06:44:02.053

你应该结合所有的答案。

WCF 服务既可以作为 Windows 服务托管，也可以在 IIS 中托管。IIS 为您提供了更多工具来扩展和处理大量请求。由于您的目标是网络，并且有可用的 IIS，因此请使用 IIS。

JP 的答案包含有关如何在 IIS 中托管 WCF 的[链接](http://msdn.microsoft.com/en-us/library/ms733766.aspx)，这应该可以解决您在 sipwiz 的答案中遇到的问题。

所以继续创建一个 ASP.NET Web 应用程序。并在那里创建一个 WCF 服务（或将一个 WCF 服务库项目添加到您的解决方案中，并在您的 ASP.NET Web 应用程序中引用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T06:12:48.117

鉴于您正在做的事情的规模，您可能希望坚持使用 WCF。配置不同协议和其他框架功能（例如内置日志记录）的便利性应该可以很好地为您服务。

使用 asmx 服务的一个优点是它很容易集成到网站项目中。如果您在具有共享主机的小型站点上，您可能无法运行 WCF 服务，但您将能够运行 asmx 服务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T06:15:26.990

您应该在这里明确地考虑可伸缩性。例如：如果您的系统必须使用 Web 场进行扩展，会发生什么情况？Win 服务场景如何适应这种情况？

# asp.net-mvc - 在 MVC 中使用 Ajax 创建三个级联下拉列表

> ID：724304
> 
> 赞同：1
> 
> 时间：2009-04-07T06:05:25.623
> 
> 标签：asp.net-mvc

我有**三个**下拉列表，每个都依赖于前一个。

使用 MicrosoftAjax 和 Web 服务如何实现？

我还想在编辑视图中选择值。

我看过stephen walther 的[tip41](http://stephenwalther.com/blog/archive/2008/09/07/asp-net-mvc-tip-41-creating-cascading-dropdown-lists-with-ajax.aspx)。

但是我在每个视图上都有错误，即

```
 <%= Html.DropDownList("--Select Make--", "Makes") %> 
```

CS1061: 'System.Web.Mvc.HtmlHelper' 不包含'DropDownList' 的定义并且没有扩展方法'DropDownList' 接受'System.Web.Mvc.HtmlHelper' 类型的第一个参数可以找到（你错过using 指令或程序集引用？）

那么会是什么原因呢？我正在使用 MVC 1.0。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T06:27:51.123

我认为您已将名称/选项标签转过来。您可能还想尝试使用带有 value 参数的签名。但是，我不确定您为什么会遇到编译问题，因为有一个扩展版本需要两个字符串参数。 [文档](http://msdn.microsoft.com/en-us/library/system.web.mvc.html.selectextensions.dropdownlist.aspx)可以在 MSDN 上找到。

```
<%= Html.DropDownList( "Makes",
                       "--Select Make--" ) %> 
```

或者

```
<%= Html.DropDownList( "Makes",
                       (IEnumerable<SelectListItem>)ViewData["Makes"],
                       "--Select Make--" ) %> 
```

对于级联下拉菜单，您可能希望改用 jQuery，并根据第一个菜单中的选择为下一个菜单获取 JSON 键值对。将 onChange 处理程序添加到选择并执行 AJAX 获取/发布到控制器中的操作以获取新值。我构造了一个键值对列表并在 JsonResult 中返回它。在 ajax 查询的成功处理程序中，我获取该结果并使用返回的 JSON 将相应选择的内容替换为新选项。

# actionscript-3 - Adobe AIR 更新框架：如何在安装 AIR 应用程序时检查更新？

> ID：724312
> 
> 赞同：1
> 
> 时间：2009-04-07T06:09:28.173
> 
> 标签：actionscript-3, air, flashdevelop

## -如何在安装时检查我的应用程序的新版本？

我觉得我记得安装了一个 AIR 应用程序，并且在安装过程中被提醒有一个新版本，并提示我是否要更新。

## -如何通过文本字段提醒用户应用程序有更新并运行“检查更新”选项？

我不想强制检查更新，ApplicationUpdaterUI，我想通知用户有新版本，然后允许然后调出 ApplicationUpdaterUI。

目前，在初始化时，应用程序会弹出“检查更新”对话框。对于这两个问题中的任何一个，我将不胜感激。

*我想指出，我正在使用包含 AIR SDK 和 AIR 更新框架的 FlashDevelop3 RC2 和 Flex 3 SDK 进行开发。*

Brian Hodge
[blog.hodgedev.com](http://blog.hodgedev.com)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T07:19:41.890

我认为您无法在安装过程中检查更新。您可以做的是安装一个基本的 shell 应用程序，该应用程序始终作为 swf 文件加载到实际应用程序中。您甚至可以在应用程序第一次运行时下载此 swf 文件。之后，您可以随时检查应用程序的新版本 (swf) 并相应地下载/更新。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T07:24:03.903

希望这会有所帮助......在安装过程中 - 不 - 如果您使用标准 AIR 安装程序，您真的无法运行任何东西。您可以迁移到自定义安装程序 - 但这需要更多的工作。

但是，当您第一次被调用时 - 当您的应用程序启动时 - 您可以在那时进行检查（并且您可以在此后尽可能频繁地检查）。

你想看到的人是 ApplicationUpdater 而不是 ApplicationUpdaterUI。使用 ApplicationUpdater，您可以获得所有的检查/下载/等...但是然后显示任何或没有您自己的 UI。

例如 - 您可以检查更新、下载它们以确定是否需要它们，并且在您的应用程序的下一次“启动”时 - 您可以在不询问用户的情况下直接“安装”所有内容。

我不推荐这个......但这是可能的。

适合您上面询问的场景 - 您可以检查更新，确定是否需要更新（比较版本或其他），然后以您想要的任何方式通知用户 - 尽可能微妙 - 要求用户更新。

您也可以使用 ApplicationUpdaterUI 执行此操作 - 您只需关闭所有 UI 内容（这有点违背了使用 UI 人员的目的）并捕获事件并显示您自己的 UI --- 例如：

_applicationUpdater.isCheckForUpdateVisible = false; _applicationUpdater.isDownloadUpdateVisible = false; _applicationUpdater.isDownloadProgressVisible = false;

希望有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-26T01:12:40.133

我认为你最好的选择是：

a) 确保人们正在安装的 .air 包始终是最新版本（如果您在 CD 等实体媒体上分发应用程序，则可能无法做到这一点）

b) 使更新过程成为应用程序中发生的第一件事（即在您检查更新版本/向他们显示更新 UI 之前不要显示您的主 UI）

但是，如果您联系 Adob​​e，您可以获得使用捆绑安装程序的许可，该安装程序可以以非标准方式（例如通过 InstallShield）安装 AIR 和您的应用程序。使用这种方法，您可以在安装应用程序时做任何您想做的事情，包括运行一个简单的脚本来检查它们是否具有最新版本。

您可以查看[http://www.adobe.com/devnet/air/articles/distributing_air_in_enterprise_02.html](http://www.adobe.com/devnet/air/articles/distributing_air_in_enterprise_02.html)了解有关捆绑安装的更多信息。

# algorithm - stackoverflow 社区是无标度网络还是小世界网络？

> ID：724319
> 
> 赞同：0
> 
> 时间：2009-04-07T06:13:33.467
> 
> 标签：algorithm, graph, social-networking

我是图形/网络爱好者，这只是出于我的好奇心 :)

我正在尝试将 StackOverflow 社区建模为图形/网络。假设 SO 社区中的人是节点，并且对任何问题的回答都建立了这些节点之间的关系。可以假设关系是有向的（来自答案的链接 -> 问题）或无向的。该图可以加权，并且节点的权重可以表示投票赞成/反对的数量（在 0 到 1 的范围内标准化）。

在任何给定的时间快照中，最终会得到什么样的图/网络？它是无标度的吗？是小世界吗？该图在一段时间内不断发展，我想了解它的结构和动态。

有没有一种方法可以从中检索此关系数据 - 可能是 SO API 或来自 SO 的某个 API 可以帮助我处理（样本）数据？

澄清编辑：无标度网络：度分布渐近遵循幂律的网络 小世界：具有子网络的网络，其特征是其中几乎任何两个节点之间存在连接，并且大多数节点对通过以下方式连接至少一条短路径。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T06:39:33.203

对于你问题的第二部分：

> 有没有一种方法可以从中检索此关系数据 - 可能是 SO API 或来自 SO 的某个 API 可以帮助我处理（样本）数据？

试试这些问题。有很多计划来实现一个 API 来访问 SO 数据。有些事情正在发生变化，但有可能通过屏幕抓取数据或通过 JSON (afaik) 访问它们。

*   [是否有以编程方式访问 StackOverflow 数据的指南？](https://stackoverflow.com/questions/282179/is-there-a-guide-to-accessing-stackoverflow-data-programmatically)
*   [你想在 StackOverflow API 中看到什么？](https://stackoverflow.com/questions/350248/what-would-you-want-to-see-in-a-stackoverflow-api)
*   [是否有 StackOverflow API 的计划？](https://stackoverflow.com/questions/231847/are-there-plans-for-a-stackoverflow-api)

试试看。祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T09:42:28.537

> 在任何给定的时间快照中，最终会得到什么样的图/网络？它是无标度的吗？是小世界吗？该图在一段时间内不断发展，我想了解它的结构和动态。

将一个随机网络变成一个小世界网络只需要远程集群之间的几个链接，所以它很可能是一个小世界。

至于它是否是无标度的，那就需要有一些海报上有很多答案，而很多海报只有一两个。我似乎记得 Jeff 说过，其中一个播客中只有一个问题。您最好在那里而不是在这里问问题，因为他将拥有数据。

# c# - 水晶报表——关闭数据库连接

> ID：724323
> 
> 赞同：6
> 
> 时间：2009-04-07T06:17:24.533
> 
> 标签：c#, sql-server, crystal-reports, report

这是在 C#、Visual Studio 2008、VS2008 附带的水晶报表中

我有一个位于 DLL 中的水晶报表查看器表单。DLL 负责加载水晶报表（基于报表文件名），并在窗体上显示报表。

当我完成水晶报表时，我在加载的报表文档对象上调用 dispose。但是，数据库连接仍然存在。

Crystal 似乎检测到有其他连接（从我的主应用程序）到同一个数据库，并保持其连接打开。当主应用程序数据库连接关闭时，水晶连接关闭。

有没有办法强制水晶关闭其连接，而不关闭主应用程序数据库连接？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-08T11:15:52.717

标记代码似乎在某种程度上缓解了这种情况，虽然它有点倒退，应该是这样的：

```
ReportDocument rd = (ReportDocument) viewer.ReportSource;
foreach (Table table in rd.Database.Tables)
    table.Dispose();
viewer.ReportSource = null;
rd.Database.Dispose();
rd.Close();
rd.Dispose();
rd = (ReportDocument) viewer.ReportSource;  
GC.Collect(); 
```

这并没有完全为我堵住泄漏，但肯定有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T16:43:16.117

您是如何连接到数据库的，通过设置身份验证在运行时创建自己的连接，还是让 Crystal 通过报表中存储的连接进行连接？如果您正在以任何方式、形状或形式进行自己的连接，则必须手动关闭连接并在处理报告之前调用 dispose。

这很可能是内存泄漏。我以前经历过这些。Crystal Reports 还有一个内存泄漏问题，在他们的论坛上讨论了很多，但几年前我使用它时没有发布修复。我放弃了水晶以寻求其他选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-19T15:13:59.577

我有同样的问题，除了我使用的是 Sybase。不久前，当我看到一个错误时，我发布了我编写的用于处理连接的代码（这不起作用）！我修复了错误，并且，交叉手指，现在它似乎工作了。我已经打开了近 100 份报告，而之前我无法打开 10 份。如果你尝试这个，请让我知道它是否适合你。

这是我在关闭包含 Crystal Reports 查看器的窗口之前正在做的事情：

```
var rd = (ReportDocument)crystalReportViewer1.ReportSource;
foreach (Table table in rd.Database.Tables)
   table.Dispose();
rd.Database.Dispose();
rd.Close();
rd.Dispose();
GC.Collect(); 
```

标记

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T07:19:41.997

我对 Crystal Reports 不太熟悉，但是由于包含 IDisposable 接口的继承链，许多对象具有无用的 Dispose() 方法。如果您在服务器上没有看到任何性能问题，请不要担心。GC 准备好后会处理客户端上的连接。你不应该试图比GC更聪明，你只会让自己更头疼。

并且，始终在可用时调用 Dispose()（或使用{}）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-08-07T07:22:07.067

```
connectDB();

ReportDocument cryRpt = new ReportDocument();
DataSet ds;
cmd = new SqlCommand("Select * from LeaveJO where IDno = '" + textBox1.Text + "'", conn);

da = new SqlDataAdapter(cmd);
ds = new DataSet();
da.Fill(ds, "LeaveJO");
            cryRpt.Load(@"JOleave.rpt");
            cryRpt.SetDataSource(ds);

            TableLogOnInfos crtableLogoninfos = new TableLogOnInfos();
TableLogOnInfo crtableLogoninfo = new TableLogOnInfo();
ConnectionInfo crConnectionInfo = new ConnectionInfo();
Tables CrTables;

crConnectionInfo.ServerName = cs.serverName;
crConnectionInfo.DatabaseName = cs.dbName;
crConnectionInfo.UserID = cs.userID;
crConnectionInfo.Password = cs.password;

CrTables = cryRpt.Database.Tables;
foreach (CrystalDecisions.CrystalReports.Engine.Table CrTable in CrTables)
{
    crtableLogoninfo = CrTable.LogOnInfo;
    crtableLogoninfo.ConnectionInfo = crConnectionInfo;
    CrTable.ApplyLogOnInfo(crtableLogoninfo);
}

cryRpt.Refresh();
//  cryRpt.PrintToPrinter(2, true, 1, 2);
crystalReportViewer1.ReportSource = cryRpt;
crystalReportViewer1.Visible = true;
cryRpt.Dispose();
conn.Dispose(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-02-18T11:15:09.727

您可以更改 CRConfig.xml 中的 timout 选项，以便自动关闭连接。

# java - struts2 标签

> ID：724325
> 
> 赞同：1
> 
> 时间：2009-04-07T06:18:38.137
> 
> 标签：java, struts2

我有简单的用户注册表单。我在其中将城市作为标签。这里的下拉框值来自 mysql 数据库中的城市主表。

但是当我存储整个用户注册值时，我无法获取当前选择的城市值。谁能帮我...？我的用户注册表包含：

```
<s:form action="UserAction" >
        <s:textfield name="name" label="User Name" />
        <s:textfield name="age" label="Age" />

        <s:radio name="sex" label="Sex" list="{'M','F'}" />

        <s:select list="cities" key="cities.name"  listValue="name">
        </s:select>

        <s:submit />
    </s:form> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T06:25:43.437

为您的列表提供您在 bean 中的确切名称，在您的情况下为**city**。它现在应该开始工作了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T12:14:23.460

编写以下代码后终于得到了解决方案：

```
 <s:select list="cities" name="city">
            <s:iterator value="cities">
            </s:iterator>
        </s:select> 
```

并且在通过 DAO 插入的时候，它会自动从 bean 中获取所有的值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-21T14:25:14.983

在您的操作类中，您可能有一个基于 select 标记的属性。当您设置此值时，请在方法签名上方添加注释。

就像是：

```
@RequiredStringValidator(type = ValidatorType.SIMPLE, message = "Please select a value", fieldName = "select") 
```

这应该可以解决您的问题。这也可以在 struts.xml 文件中以非常相似的方式完成。

干杯内森

# sql - 如何在 MS Access 中获取一个表中不在另一个表中的所有行？

> ID：724341
> 
> 赞同：9
> 
> 时间：2009-04-07T06:26:53.047
> 
> 标签：sql, ms-access

我尝试了很多不同的东西，但总是遇到语法错误。

我有两个表 - tableA 和 tableB。它们都有一个 con_number 字段作为唯一 ID。我想选择 tableB 中不存在于 tableA 中的所有行。

谁能给我这个查询，就像在 MS Access 中一样？

我知道在这种情况下使用 NOT IN 效率很低，所以如果有更好的方法那就太好了。

谢谢。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-07T06:35:34.773

```
SELECT TableB.con_number
FROM TableB
WHERE NOT EXISTS (SELECT 1 
                  FROM TableA 
                  WHERE TableA.con_number = TableB.con_number); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T06:39:01.910

不在版本中（缓慢但肯定）：

```
SELECT con_number
FROM TableB
WHERE con_number NOT IN (SELECT con_number FROM tableA); 
```

实验版（不知道是不是更快，试试看）：

```
SELECT B.con_number, MAX(A.con_number) AS check
FROM tableB B LEFT JOIN tableA A ON B.con_number = A.con_number
GROUP BY B.con_number
HAVING check IS NULL; 
```

注意：两者都应该是相当标准的 SQL，我不知道任何 ms-access 特定功能

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T14:57:23.567

有一个 Find Unmatched 向导可以进行设置。SQL 是：

```
SELECT TableB.con_number
FROM TableB LEFT JOIN TableA 
ON TableB.con_number = TableA.con_number
WHERE TableA.con_number Is Null 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T11:08:50.933

我记得这样一个：

```
SELECT * FROM TableA.* LEFT JOIN TableB _
    ON TableA.con_number = TableB.con_number WHERE 'criteria' 
```

但我不记得使用哪个“标准”

```
... TableA.con_number <> TableB.con_Number
... TableB.con_number IS NULL
... TableA.con_number NOT like TableB.con_Number 
```

# iphone - 你如何覆盖 UIView 的 +(id)layer；类方法？

> ID：724342
> 
> 赞同：2
> 
> 时间：2009-04-07T06:27:15.900
> 
> 标签：iphone, core-animation

我在文档中读到 UIView 的“层”属性是只读的，您必须覆盖 UIView 的

```
+ (id)layer; 
```

类方法来访问图层的样式属性。

是否有任何示例覆盖此方法以返回已应用样式属性的图层/视图？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-07T17:13:25.050

如果您只想在分配给 UIView 的默认 CALayer 上设置诸如 backgroundColor、opacity 等属性，您可以随时使用以下内容在 UIView 的图层上设置这些属性：

```
view.layer.opacity = 0.0f; 
```

唯一需要覆盖 - (CALayer)layer 方法的情况是，如果您想返回自定义 CALayer 子类。我相信在 iPhone 上，Apple 建议您改写类方法 layerClass。这将返回初始化自定义视图时要创建的 CALayer 子类。例如，

```
+ (Class) layerClass 
{
    return [CAEAGLLayer class];
} 
```

导致您的 UIView 子类使用 OpenGL 层作为其支持。

# ruby-on-rails - 无法从 rake 任务中保存模型

> ID：724345
> 
> 赞同：0
> 
> 时间：2009-04-07T06:28:05.727
> 
> 标签：ruby-on-rails, ruby, redmine

我正在编写一个 rake 任务，该任务将连接到旧版 ORACLE 数据库，从帮助台应用程序获取一些“问题”记录，应用一些转换并将其存储在另一个数据库 (Redmine) 中。

问题是，即使该脚本在 Windows 上运行顺利，它也无法在 RHEL 5 上运行。库文件都安装在 RHEL 5 上，因此没有连接错误。脚本在 '_issue.save' 行失败（其中 _issue 是 Issue 0n Redmine 类型的模型）！！没有错误（只是 _issue.save 返回 false）。在过去的两天里，我一直被困在这个问题上。

任何建议都会非常有帮助。

我正在使用 Rails 2.1.2、Ruby 1.8.6（补丁级别 111）和 Rake 0.8.1

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T20:29:21.477

没有错误，但 save 返回 false 意味着验证可能失败。您可以像这样输出验证错误：

```
_issue.errors.each_full { |msg| puts msg } 
```

[这是有关each_full](http://api.rubyonrails.org/classes/ActiveRecord/Errors.html#M002156)方法的更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T12:10:20.363

我会创建一些测试并在 RHEL 服务器上运行它们以查看问题出在哪里。我会使用 RSPEC，但测试/单元也可以让你到达那里。

# c++ - 在CFile对象的写入或读取过程中文件指针可以改变吗

> ID：724347
> 
> 赞同：1
> 
> 时间：2009-04-07T06:29:25.067
> 
> 标签：c++, thread-safety, cfile

我有一个 CFile 对象，它可以被多个线程访问。有可能一个线程正在向该文件写入数据，而另一个线程正在从该文件中读取数据。我想知道这个政策有什么不安全的地方吗？文件指针可以在写入或读取过程完成之前更改吗？答案是肯定的，如何避免可以同时读写的多线程的不安全性？

非常感谢你！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T06:51:09.617

`CFile`对象不是线程安全的。如果您需要从多个线程访问它们，则需要执行自己的同步。

来自[http://msdn.microsoft.com/en-us/library/aa270950.aspx](http://msdn.microsoft.com/en-us/library/aa270950.aspx)：

> **从多个线程访问对象**
> 
> 出于大小和性能的原因，MFC 对象在对象级别不是线程安全的，仅在类级别是线程安全的。这意味着您可以让两个单独的线程操作两个不同的 CString 对象，但不能让两个线程操作同一个 CString 对象。如果您绝对必须让多个线程操作同一个对象，请使用适当的 Win32 同步机制（例如临界区）保护此类访问。有关临界区和其他相关对象的详细信息，请参阅 Win32 SDK。
> 
> 类库在内部使用临界区来保护全局数据结构，例如调试内存分配使用的那些。

# ruby-on-rails - 如何从 Rails 中重新启动 Rails？

> ID：724348
> 
> 赞同：7
> 
> 时间：2009-04-07T06:30:15.597
> 
> 标签：ruby-on-rails, ruby, mongrel

好的，所以我想在 Rails 中创建一个动作来重新启动。我做了一点搜索，发现：

[http://snippets.dzone.com/posts/show/5002](http://snippets.dzone.com/posts/show/5002)

这建议 2 个命令，一个停止，另一个重新启动。以下杀戮：

```
ps -a|grep "/usr/local/bin/ruby script/server"|grep -v "grep /usr"|cut -d " " -f1|xargs -n 1 kill -KILL $1 
```

-HUP 信号不会为我重新启动，所以我尝试破坏上述命令（调整后该命令与我在 Ubuntu 下启动服务器的方式正常工作）：

```
ps -eaf|grep "ruby script/server"|grep -v grep|cut -d " " -f3|xargs -n 1 kill -KILL $1;script/server 
```

这在我的环境中运行良好，所以我尝试设置一个操作来执行它：

```
def restart
  fork { exec "ps -eaf|grep \"ruby script/server\"|grep -v grep|cut -d \" \" -f3|xargs -n 1 kill -KILL $1;script/server" }
  redirect_to "/server_maintenance"
end 
```

该操作很好地杀死了服务器，但实际上并没有启动服务器备份：

```
=> Booting Mongrel
=> Rails 2.3.2 application starting on http://0.0.0.0:3000
=> Call with -d to detach
=> Ctrl-C to shutdown server
Exiting
/usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel/tcphack.rb:12:in `initialize_without_backlog': Address already in use - bind(2) (Errno::EADDRINUSE)
    from /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel/tcphack.rb:12:in `initialize'
    from /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:93:in `new'
    from /usr/lib/ruby/gems/1.8/gems/mongrel-1.1.5/lib/mongrel.rb:93:in `initialize'
    from /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/handler/mongrel.rb:10:in `new'
    from /usr/lib/ruby/gems/1.8/gems/actionpack-2.3.2/lib/action_controller/vendor/rack-1.0/rack/handler/mongrel.rb:10:in `run'
    from /usr/lib/ruby/gems/1.8/gems/rails-2.3.2/lib/commands/server.rb:111
    from /usr/local/lib/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require'
    from /usr/local/lib/site_ruby/1.8/rubygems/custom_require.rb:31:in `require'
    from script/server:3 
```

我不太明白为什么当 Mongrel 似乎刚刚退出时该地址已经在使用中。

我发现了这个问题：

[如何在 Mongrel 下重启 Rails，而不停止和启动 Mongrel](https://stackoverflow.com/questions/74218/how-do-you-restart-rails-under-mongrel-without-stopping-and-starting-mongrel)

但信号不会导致我的环境重新启动，它们最终会终止进程。

有人对什么可能有用有任何想法吗？关于我的环境的一些说明：我从新版本的 RubyGems 和 Mongrel 安装了 Rails。我使用脚本/服务器来启动服务器，当然使用 Mongrel。我在 Ubuntu Hardy Heron 上。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T07:05:35.213

如果您不介意切换到 mod_rails，您可以通过创建 $RAILS_ROOT/tmp/restart.txt 重新启动服务器，这只会导致您关心的 Rails 实例重新启动。

您的 PS 命令看起来（粗略一瞥）就像它会杀死您盒子上的所有 rails 进程。如果您是机器上唯一的 Rails 应用程序，那很好，但如果有几个以同一用户身份运行，或者您以 root 身份运行，您将把它们全部杀死。形式不好！

[这](http://wiki.ocssolutions.com/Managing_Your_Mongrel)为杂种动物指出了这一点。有你想尝试的方式。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T07:07:16.647

好的，我找到了解决方法...我将启动 rails 的方式更改为：

```
mongrel_rails start -d 
```

现在将执行以下操作：

```
def restart
  fork { exec "mongrel_rails restart" }
  redirect_to "/server_maintenance"
end 
```

作为警告，redirect_to 将导致加载失败，因为服务器将关闭......但是暂停后重新加载将显示重新启动成功。这可以通过将重新启动更改为使用 AJAX 完成，然后重新加载 javascript 来解决......但我将把它作为练习留给读者。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T13:54:24.747

在咨询在 Rails 上运行其网站的初创公司时，我们使用了两种方法来管理混合进程。

首先，是我们编写的自定义 gem，名为[mongrel_runit](http://wiki.github.com/adamhjk/mongrel_runit)。这将 mongrel 设置为 runit 中的[服务](http://smarden.org/runit/)。

其次，我们使用[god](http://god.rubyforge.org/)来监控mongrel进程。这适用于 mongrel_runit 或“正常”的 mongrel 配置。

# windows-mobile - 如何在 Windows Mobile 和 Windows CE 上测量我的应用程序的能耗？

> ID：724349
> 
> 赞同：1
> 
> 时间：2009-04-07T06:30:30.620
> 
> 标签：windows-mobile, windows-ce, energy

我想测量能源消耗

*   我自己的应用程序（我可以修改）
*   3rd 方应用程序（我无法修改）

在

*   视窗 CE 5.0
*   视窗手机 5/6

是否有某种API？

如果没有，我可以测量其他可以用来估算能耗的值吗？

我不需要一个确切的值，比如`20 mAh`（虽然那很好）一个相对值就足够了，比如：“从 100% 到 0% 的充电状态，这个应用程序使用了大约 20% 的完全充电电池”

另一方面，测量特定于单个应用程序非常重要，即我不希望对一组应用程序进行聚合测量，例如“这三个应用程序一起消耗......”

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T07:02:48.200

这似乎是一件很难衡量的事情，因为您无法真正隔离单个进程以使其自行运行。事实上，如果你试图这样做，你会在定义什么构成“单一进程”时遇到困难——它只是属于该程序的用户空间代码吗？或者你是否也包括代表程序执行的内核代码？如果操作系统优化内核代码，以便一起处理来自不同程序的类似请求，使用几乎恒定的能量会怎样？然后，您甚至无法按程序分离出能源使用情况。

在这种情况下，我倾向于测量期望值，本质上是应用程序使用的平均能量。理想情况下，您会从大量系统开始，除了其中一半运行应用程序而另一半没有运行之外，所有系统都相同。让每个系统在您想要测试的任何操作条件下运行（当然，所有设备都在相同的条件下运行，除了其中一半正在运行应用程序而另一半没有），然后测量能量率使用标准 API 消耗，或者让电池耗尽并测量每个单元耗尽其电池所需的时间。然后将运行应用程序的设备的平均结果与未运行应用程序的设备的平均结果进行比较，

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T11:58:34.653

有一个 API 用于获取有关功耗的信息，但此 API 返回的信息的准确性取决于 OEM（一些 OEM 根本不提供该信息）。有关此 API 示例代码的更多信息，[请访问 http://www.codeproject.com/kb/mobile/Wimopower1.aspx](http://www.codeproject.com/kb/mobile/Wimopower1.aspx)（以下示例程序的屏幕截图）。正如您从屏幕截图中看到的那样，您可以了解电池的电压、电流拉动、电池类型等。瞬时功耗的准确测量需要外部硬件（我假设您不想进行硬件投资来进行测量）。

采取任何你得到的相对测量，因为它们可能不能代表你在不同设备上运行程序时观察到的结果。

[示例程序截图 http://www.codeproject.com/kb/mobile/WiMoPower1/TitleImage.png](http://www.codeproject.com/kb/mobile/WiMoPower1/TitleImage.png)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T06:58:25.480

如果您真的想自己调用 api，我不知道该调用哪个，但如果您只想知道运行某些应用程序时的功耗情况，您可以使用[acbPowerMeter](http://www.acbpocketsoft.com/Products/acbPowerMeter/acbPowerMeter-Overview-2.html)应用程序。

> acbPowerMeter 图表显示您设备的实时电源使用情况。该实用程序非常轻巧，可以对您的电池使用情况进行基准测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-07-17T11:00:41.570

[加上我的两分钱，有几个库可以使用INTEL RALP 架构](https://software.intel.com/en-us/articles/measuring-power-on-intel-xeon-phi-product-family-devices)测量能耗：

有[PAPI](http://icl.cs.utk.edu/papi/index.html)和[jRALP](http://kliu20.github.io/jRAPL/)。

jRALP 的使用似乎很简单：

```
 double beginning = EnergyCheck.statCheck();
  doWork();
  double end = EnergyCheck.statCheck(); 
```

不幸的是，对于 OP，它们似乎（我不确定）不是 Windows 就绪的，它们仅适用于某些英特尔处理器。

# wpf - 用于查看 Office 文档的 WPF 控件

> ID：724351
> 
> 赞同：2
> 
> 时间：2009-04-07T06:31:23.957
> 
> 标签：wpf, ms-office

我正在寻找一种在 WPF 应用程序中查看 Microsoft Office 和 PDF 文档的方法。有人知道在 WPF 中运行良好的 Office 查看器控件吗？

谢谢

周杰伦

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T07:02:45.127

你[想做这样的事情吗？](http://www.drwpf.com/blog/Home/tabid/36/EntryID/3/Default.aspx) 如果是这样，这是[之前的讨论](https://stackoverflow.com/questions/594052/powerpoint-and-wpf)，但不幸的是我认为他们还没有找到一个好的答案。

# asp.net - 在 chrome 和 safari 中附加 onload 事件时 window.open 不起作用

> ID：724355
> 
> 赞同：4
> 
> 时间：2009-04-07T06:33:39.613
> 
> 标签：asp.net, javascript

我在表单的 onload 事件上附加了一些 javascript。此脚本包含 window.open。尽管这在所有浏览器中都可以正常工作 window.open 不会打开新窗口，也不会在 google chrome 和 firefox 中给出错误消息。

我想首先检查屏幕分辨率是否小于 1024，然后我会在没有菜单、工具栏等的新窗口中打开它，以便用户有更多的工作空间。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-07T06:36:59.947

这是一个功能，而不是一个错误！:)

还记得上世纪 90 年代，弹出式窗口惹恼了所有人吗？好吧，由于这种**JavaScript**行为的大量滥用，现在打开窗口的唯一方法是直接用户交互；就像点击一样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T07:23:08.620

如果您有正当理由打开另一个窗口，请将`click`事件附加到`button`标签上，以便正确指示您将打开一个窗口。如果您的用户想要打开窗口，他们会这样做，并且它会正确地通过除最愚蠢的弹出窗口拦截器之外的任何窗口。如果他们不想，你一开始就不应该打开窗户。

# prolog - prolog 的独特结果

> ID：724358
> 
> 赞同：5
> 
> 时间：2009-04-07T06:35:44.133
> 
> 标签：prolog

有没有一种简单的方法可以在 prolog 中进行查询，每个结果只返回一次？

例如我正在尝试类似的东西：

```
deadly(Xn) :- scary(X), Xn is X - 1, Xp is X + 1, not(safe(Xn)), safe(Xp).
deadly(Xp) :- scary(X), Xn is X - 1, Xp is X + 1, not(safe(Xp)), safe(Xn).

deadly(X). 
```

并得到

```
X = 5

X = 5

X = 5

X = 5

.... 
```

对我没用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T12:43:48.397

您可以做的一件事是应用于`setof/3`生成解决方案的谓词。但请注意，这`setof/3`是通过应用于`sort/2`传递的结果来实现的`bagof/3`（至少在 SWI-Prolog 中是这种情况）。因此，如果您的解决方案生成器永远存在，那么`setof/3`将永远不会被应用......

所以我会说尝试编程以便不生成重复项，即在有意义的地方使用剪切（！）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T08:34:33.347

If I remember correctly there is a predicate solutions (or similar, it's been a while since I programmed Prolog) which collects unique solutions in a list.

**Edit:** `setof/3` is the one I was thinking of. Thanks, Kaarel.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T13:22:34.997

另一种方法是记忆解决方案。

```
:- dynamic seen/1.

% Call this always before calling deadly_wrapper/1
clear_seen :-
    retractall(seen(_)).

% This wrapper calls deadly/1 but remembers
% the solution using assert/1, and fails
% if the solution has been "seen" before.
deadly_wrapper(X) :-
    deadly(X),
    (
        seen(X)
    ->  
        fail
    ;
        assert(seen(X))
    ).  

% This is for testing.
deadly(1).
deadly(1).
deadly(1).
deadly(5).
deadly(1).
deadly(1). 
```

如果您的 Prolog 支持表格，那么它会变得更加简单。示例文件：

```
:- table deadly/1.

deadly(1).
deadly(1).
deadly(5).
deadly(1).
deadly(5). 
```

[使用XSB](http://xsb.sourceforge.net/)执行示例：

```
$ xsb
[xsb_configuration loaded]
[sysinitrc loaded]

XSB Version 3.2 (Kopi Lewak) of March 15, 2009
[x86_64-unknown-linux-gnu; mode: optimal; engine: slg-wam;
 scheduling: local; word size: 64]

| ?- [deadly_tab].
[Compiling ./deadly_tab]
[deadly_tab compiled, cpu time used: 0.0100 seconds]
[deadly_tab loaded]

yes
| ?- deadly(X).

X = 5;

X = 1;

no
| ?- 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T06:39:28.227

没有更多代码很难说，但您可能正在寻找剪切运算符 ( `!`)。如果您想发布 的*定义*，`foo`我（或跟随的其他人）也许能够给出详细/具体的答案。

# html - HTML 布局问题

> ID：724367
> 
> 赞同：0
> 
> 时间：2009-04-07T06:39:24.637
> 
> 标签：html, css, layout

我在 HTML 中划分多列布局时遇到问题。我将页面分为两列：

### `inner1`

*   两排。
*   another_top1：固定宽度，固定高度
*   响应：固定宽度，可变高度

### `inner2`

*   两排。
*   another_top2：固定宽度，可变高度
*   another_below：固定宽度，固定高度

### 问题：

当我尝试`inner1`如下分成两列时，它工作正常。

1.  内部1
2.  内部1_2

* * *

我的`inner2`列`another_top2`数据，附加在浮动下方`inner1_2`。

* * *

### CSS：

```
#another_top1{
    width: 500px;
    height: 200px;
}

#another_top2 {
    float: right;
    display: inline;
    width: 350px;
    padding: 0 0 10px 10px;
    margin-bottom: 10px;
    color: #fff;
}

#outer{
    background-color: #FFFF99;
}

#inner1{
    float: left;
}

#inner1_2 {
    float: left;
    margin-top: 200px;
}
.twoColumn #inner1 { width: 62%; }
.twoColumn #inner1_2 { display: none; }
.threeColumn #inner1 { width: 41%; }
.threeColumn #inner1_2 { width: 21%; }

#inner2{
    float: right;
    width: 39%;
} 
```

我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T09:06:36.483

我觉得这个bug是因为左列的浮动比列宽，把右列的内容往下推。确保 inner1_2 的边距或填充不会使框比左列宽。

我还建议将#inner2 设为固定宽度，即至少是两列的宽度。这样，您可以确保两列适合。

此外，请检查您的文档类型 ( [http://www.alistapart.com/articles/doctype/](http://www.alistapart.com/articles/doctype/) ) 以确保您处于标准模式，或者纠正在怪异模式下可能出现的盒子模型问题。

最后，您可以使用 Firebug ( [https://addons.mozilla.org/en-US/firefox/addon/1843](https://addons.mozilla.org/en-US/firefox/addon/1843) ) 或 Xray ( [http://www.westciv.com/xray/](http://www.westciv.com/xray/) ) 检查 div 的尺寸，然后看看它是否超出了左列。

# c# - 使用 SharePoint 和 SOAP 传输带有版本控制的文件

> ID：724372
> 
> 赞同：2
> 
> 时间：2009-04-07T06:40:39.503
> 
> 标签：c#, sharepoint, soap

我正在编写一个 .Net C# 应用程序，它将根据来自另一个 SQL 数据库的某些触发器对配置的 SharePoint 数据库进行 SOAP 调用。

我有一个问题，我需要将文档从列表中的文件夹传输到不同列表中的另一个文件夹。每个文档都将启用版本历史记录，我需要在传输过程中不要丢失。

SOAP 是我与 SharePoint 交互的最佳方式，但如果它可以通过我的 C# 环境中的另一种方法轻松完成，我愿意研究它。

如果有人有办法将整个文件夹和内容从一个列表移动到另一个列表，而不会丢失文档历史记录等，则可以加分。

谢谢

* * *

编辑：

我查看了[Copy](http://msdn.microsoft.com/en-us/library/copy.aspx) webservice，并且可以在支持版本控制的列表之间单独移动文件，但不幸的是源文件的版本控制没有被复制。下面的代码，如果有人感兴趣

```
CopyWebReference.Copy copyservice = new CopyWebReference.Copy();
copyservice.Credentials = System.Net.CredentialCache.DefaultCredentials;

CopyWebReference.CopyResult[] results = { new CopyWebReference.CopyResult() };

uint ret = copyservice.CopyIntoItemsLocal(source, new string[] { dest }, out results); 
```

我目前正在研究使用 Sites.ExportWeb 和 ImportWeb 重新设置整个文件夹的父级，我在其他地方问过另一个问题，有没有人用这两种方法取得成功？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-12T07:28:38.737

您是否考虑过使用[WebDAV](http://msdn.microsoft.com/en-us/library/ms879464.aspx)？应该是用 MOVE 命令进行的简单操作

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T07:06:39.877

[http://www.sharepointproducts.com/products/default.aspx](http://www.sharepointproducts.com/products/default.aspx)对复制和移动具有完整的 Web 服务 API 支持。对 WSS、MOSS 和 CopyMove 产品可以做什么也有很好的概述。

# asp.net-mvc - 在虚拟目录中运行时的 MVC MasterPage 设计时支持

> ID：724373
> 
> 赞同：1
> 
> 时间：2009-04-07T06:40:40.330
> 
> 标签：asp.net-mvc

从虚拟目录运行 MVC 应用程序时，为母版页获得正确设计时支持的首选方法是什么？

例如，给定母版页中的以下图像标记：

```
<img src="../../Content/Images/myimage.jpg" alt="image" /> 
```

这将在母版页和使用母版页的所有视图中提供完整的设计时支持，但是从[http://localhost/MyApp/](http://localhost/MyApp/)运行应用程序时，当然不会找到图像（浏览器正在寻找[http: //localhost/Content/Images/Banner.png](http://localhost/Content/Images/Banner.png) )。

将图像更改为：

```
<img src="<%=Url.Content("~/Content/Images/myimage.jpg")%>" alt="image" /> 
```

将修复运行时显示，但会破坏母版页和视图中的设计时支持。

第三种选择是将图像标签更改为 runat=server，如下所示：

```
<img runat="server" src="../../Content/Images/myimage.jpg" alt="image" /> 
```

这适用于运行时和设计时，但必须指定 runat="server" 似乎有点像 hack。

有没有更好的方法来处理这个？

编辑：cagdas 提议的选项将在设计时起作用，但在运行时不起作用：

```
<img src="/Content/Images/myimage.jpg" alt="image" /> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T00:08:20.247

如果您需要设计时支持和 if false hack，您可以将这两种方式结合起来。与 runat="server" 方法相比，此方法更像是一种 hack，但在少数情况下它很有用。我将此方法用于 css 类智能感知和 jQuery vsdoc 文件。

```
<% // design-time use only %>
<% if (false) { %>
<img src="../../Content/Images/myimage.jpg" alt="image" />
<% } %>
<% // run-time %>
<img src="<%=Url.Content("~/Content/Images/myimage.jpg")%>" alt="image" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T07:07:20.157

如果 Content 文件夹位于应用程序的根目录（我假设它是，因为这是默认设置）。你可以这样做：

```
<img src="/Content/Images/myimage.jpg" alt="image" /> 
```

它将在应用程序的根目录上查找内容文件夹。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T07:37:06.620

我更喜欢用你的第二个例子：

```
<img src="<%=Url.Content("~/Content/Images/myimage.jpg")%>" alt="image" /> 
```

..但就像你说的，它不会给你设计支持。我认为在 MVC 环境中您应该使用 VS 设计器。我只是让开发服务器从 VS 运行，并在 VS 旁边的我最喜欢的浏览器中打开我的页面 - 这比设计视图更好 - 它是一个实际的浏览器。

此外，您不想牺牲使用该`Url.Content`方法的良好设计理念，只是为了让一些图像出现在设计师身上。从长远来看，通过`Url.Content`到处使用来保持一致的方法会给你带来更多好处。

# xsd - DTD 和 XMLSchema 的等价性

> ID：724374
> 
> 赞同：1
> 
> 时间：2009-04-07T06:40:49.533
> 
> 标签：xsd, dtd

我一直认为 XMLSchema 和 DTD 是等价的，但后者在建模复杂关系（如继承）时使用起来更麻烦。

最近我想构建一个模式来验证具有如下结构的文档：

```
<data>
 <array>
   <int></int>
   <int></int>
 </array>
 </array>
   <float></float>
   <float></float>
 </array>
 <int><int>
 <float></float>
</data> 
```

<data> 中的元素可以按任何顺序出现，每个元素的基数为 0..* 使用 XMLSchema，如果我使用 <xs:all> 定义复杂类型，我可以让元素乱序，但最大基数为 1。 < xs:sequence > 和 < xs:choice > 是其他明显的候选者，但它们比我想要的更严格。

然后我注意到 DTD 似乎能够像这样实现这一点：

```
<!ELEMENT data (array | float | int)*> 
```

有什么方法可以构建一个等效的模式，还是我必须在这里使用 DTD？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T07:32:54.587

如果您保持元素的顺序，则只能通过 XSD 实现（因此您可以使用*xs:sequence*）。我的意思是，*浮点数*总是会出现在*数组*（如果有）之后，而*int*总是会出现在*浮点数*（如果有）之后，考虑到您可以根据需要对每种类型重复尽可能多的事件（或省略他们完全）。

原因是 XSD *xs:all*复杂类型不支持其任何内容类型（元素、其他嵌套组类型等）的*无界属性。*其他更“宽松”的模式将允许您这样做，例如您所说的 DTD，或例如 RelaxNG。

这是适合您的 XML 文件的示例 XSD：

```
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" elementFormDefault="qualified" attributeFormDefault="unqualified">
    <xs:complexType name="arrayType">
            <xs:sequence>
                <xs:element name="array" type="arrayType" minOccurs="0" maxOccurs="unbounded"/>
                <xs:element name="int" minOccurs="0" maxOccurs="unbounded"/>
                <xs:element name="float" minOccurs="0" maxOccurs="unbounded"/>
            </xs:sequence>
    </xs:complexType>
    <xs:element name="data" type="arrayType"/>
</xs:schema> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T01:21:17.823

我想我会回到这个，因为之前的答案是不正确的。事实上，使用 XML Schema 可以解决原来的问题。

正确的方法是定义一个组元素，它包含所有各种选项（整数、浮点数、数组）之间的选择，并且每个选项的基数为 0..*。

```
<xs:group name="dataTypesGroup">
    <xs:choice>
        <xs:element name="int" type="intType"/>
        <xs:element name="float" type="floatType"/>
        <xs:element name="array">
            <xs:complexType>
                <xs:choice>
                    <xs:element name="int" type="xs:integer" minOccurs="0" maxOccurs="unbounded"/>
                    <xs:element name="float" type="xs:float" minOccurs="0" maxOccurs="unbounded"/>
                </xs:choice>
                <xs:attribute name="id" use="required"></xs:attribute>
            </xs:complexType>    
        </xs:element>
    </xs:choice>
</xs:group> 
```

从这里开始，仍然需要在 complexType 定义中引用组并将组的基数设置为 0..*

```
<xs:element name="data" minOccurs="0" maxOccurs="unbounded">
    <xs:complexType>
        <xs:group ref="dataTypesGroup" minOccurs="0" maxOccurs="unbounded"/>
    </xs:complexType>
</xs:element> 
```

等等。有点冗长（尤其是与 RelaxNG 的语法相比），但好处是 XML Schema 得到了更好的支持。我已经制作了一个基于 RelaxNG 的解析器来解决原始问题，但是可用的验证器（如 JING）比使用 Java 等附带的基于 XML Schema 的工具要笨重得多。

# sql - 序言到 SQL 转换器

> ID：724377
> 
> 赞同：17
> 
> 时间：2009-04-07T06:42:08.577
> 
> 标签：sql, prolog, transpiler

不用多想，在我看来，一大组 Prolog 的功能可以实现为关系演算（又名 SQL）。

有没有人听说过任何工具可以自动将 Prolog 转换为 SQL？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-11-05T18:12:27.550

是的当然。

怀疑论者的前提：任何关于数据库理论的半体面的书都提到[Datalog](http://en.wikipedia.org/wiki/Datalog)（类似于 Prolog）和证明可以将其转换为关系代数（RA）的定理（在特定限制下）。

SQL 不忠实于 RA 或关系演算，但足以支持 Prolog：

*   [Christoph Draxler](http://www.phonetik.uni-muenchen.de/institut/mitarbeiter/draxler/draxler.html)为他的论文开发了一个 Prolog 到 SQL 编译器 (PL2SQL)，[可供下载](http://www.phonetik.uni-muenchen.de/institut/mitarbeiter/draxler/prolog_sql.tgz)(.tgz) - 也可以在[CMU 人工智能存储库](https://www.cs.cmu.edu/afs/cs/project/ai-repository/ai/lang/prolog/code/io/pl2sql/0.html)中找到（它被改编并至少包含在：[Ciao Prolog](http://clip.dia.fi.upm.es/Software/Ciao/ciao_html/ciao_152.html)和[SWI-Prolog](http://www.berkeleybop.org/blipdoc/doc/users/cjm/cvs/blipkit/packages/blip/sql/sql_compiler.pro) via [Blipkit -生物医学逻辑编程知识集成套件](http://www.blipkit.org/)）；
*   Igor Wojnicki 为他的博士学位（[基于规则的推理引擎，扩展了关系数据库管理系统的知识处理能力](http://home.agh.edu.pl/~wojnicki/phd/)）开发了一个原型系统，实现了他的[Jelly View 技术](http://portal.acm.org/citation.cfm?id=1066822)，称为**ReDaReS**，但似乎无法下载；
*   [关系抽象机 (RAM)](http://babel.ls.fi.upm.es/research/ram/)将 Prolog 转换为关系代数，但它似乎没有 SQL 后端；
*   Walter D. Potter 有[几篇](http://pages.citebite.com/j1m9o0t1t3vqu)关于 Prolog/RDBMS 集成的论文；
*   Kevin Boone 关于[使用 SQL 和 Prolog 提高大型数据库性能](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.31.6333)的论文也很有趣；
*   [等等](http://www.google.com/search?q=Prolog+to+SQL+compiler)……

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-07-18T17:47:28.067

推荐：

[https://www.cs.cmu.edu/afs/cs/project/ai-repository/ai/lang/prolog/code/io/pl2sql/0.html](https://www.cs.cmu.edu/afs/cs/project/ai-repository/ai/lang/prolog/code/io/pl2sql/0.html)

我的建议 - 使用 Eclipse prolog (http://www.eclipseclp.org/)（不要（这里）与 Eclipse IDE 中的 prolog 混淆）。

我花了几个小时试图让代码在其他 4 个 prologs（！）中编译，并在 eclipse 中编译 4 分钟。

当它起作用时，它是一件美丽的事情。

当然要归功于 Draxler 先生

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T06:56:02.523

映射不是很好。例如，SQL 不执行回溯、统一、列表或临时嵌套结构。

Prolog 不能很好地处理复合对象、索引等。

我会说这是不行的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-06T13:13:38.907

从 prolog 执行 sql 查询更有意义，然后可以将其转换为 prolog 事实。例如[Prolog ODBC 库](http://www.swi-prolog.org/pldoc/package/odbc.html)

这消除了所有限制并将两种语言保持在适当的位置。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-09-02T00:32:42.867

我[编写了一个翻译器](https://jarble.github.io/transpiler/javascript/js_transpiler/test_parser.html#%7B%22inputText%22%3A%22%5Cnis_between(A%2CB%2CC)%20%3A-%20%5Cn%20%20%20%20A%3CB%2CB%3CC.%22%2C%22inputLang%22%3A%22prolog%22%2C%22outputLang%22%3A%22mysql%22%7D)，将 Prolog 的一个子集转换为 SQL 用户定义的函数。

Prolog 中的这个谓词可以翻译成 SQL：

```
is_between(A,B,C) :- 
    A<B,B<C. 
```

这是翻译器作为 MySQL 函数的输出：

```
CREATE FUNCTION is_between(A double,B double,C double) RETURNS BIT BEGIN 
    RETURN A>B and B>C;
END 
```

类似地，有一个用于 SWI-Prolog的[Prolog-to-SQL 编译器，以及](http://www.swi-prolog.org/pack/list?p=sql_compiler)[另一个](https://github.com/ghxiao/nrdatalog2sql)将 Datalog 的非递归子集转换为 SQL 的转换器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-01-26T12:14:30.887

CQL，一个 SWI Prolog 附加包，将 Prolog，或者更确切地说是 Prolog DSL，编译为 SQL：

[https://www.swi-prolog.org/pldoc/man?section=cql-examples](https://www.swi-prolog.org/pldoc/man?section=cql-examples)

# api - 框架与。API

> ID：724380
> 
> 赞同：46
> 
> 时间：2009-04-07T06:44:19.603
> 
> 标签：api, frameworks

现在，这可能是一个愚蠢的问题，但有时框架和 API 这两个术语可以互换使用。我认为框架是一个更大更通用的东西，包含许多 API，可用于各种编程任务（例如，.NET Framework）。API 更小，更专业（例如， Facebook API。）有人想分享他们对此事的见解吗？

例如，微软称 .NET 为框架，而 Sun 称他们为平台……那么关于如何调用“库集合”，这是否也是一个商业/营销决策。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-07T07:13:01.780

[设计模式](http://en.wikipedia.org/wiki/Design_Patterns_(book))提供以下定义：

*   工具包：“应用程序通常会合并来自一个或多个称为工具包的预定义类库中的类。工具包是一组相关且可重用的类，旨在提供有用的通用功能”。
*   框架：“框架是一组协作类，它们构成特定软件类的可重用设计”。

这里的关键是，虽然工具包 (API) 在许多领域中都很有用，但框架旨在解决*特定*类别的问题，可以“通过创建框架抽象类的应用程序特定子类”来定制这些问题。

此外，也许更重要的是，“框架决定了应用程序的架构”：控制反转是框架的特征之一（参见[Martin Fowler](http://martinfowler.com/articles/injection.html)）；不是让您的应用程序调用特定的 API 来实现特定的行为，而是调用您的代码的框架。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-07T06:45:50.427

我一直认为框架就是整体，内部代码、API 等。

虽然 API 只是您想要使用框架时使用的部分。

换言之，.NET 框架由 .NET 库、所有语言等组成。API 就是您调用函数的方式。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-07T07:15:30.120

框架确实引入了[**控制反转**](http://en.wikipedia.org/wiki/Inversion_of_control)
的概念 （即整个程序的控制流不是由调用者决定的，而是由框架决定的）

当您提到*语言*框架（例如 Java Framework 或 .Net Framework）时，实际上不仅包括库及其 API（如果这些库提供控制反转，则 [软件框架将更加受限）。](http://en.wikipedia.org/wiki/Software_framework)

语言框架包括*将调用您的代码*（编译或执行）的开发和执行环境。
这就是为什么.Net Framework 是一个“框架”。

* * *

Java 可能将其框架（JDK、JRE）称为“ **[Java 平台](http://www.oracle.com/technetwork/java/index.html)**”，以强调其“平台无关”的编程语言特性。

从[关于 Java 技术](http://docs.oracle.com/javase/tutorial/getStarted/intro/definition.html)

> 平台是程序运行的硬件或软件环境。（包括 Microsoft Windows、Linux、Solaris OS 和 Mac OS）。
> **大多数平台可以描述为操作系统和底层硬件的组合。
> Java 平台与大多数其他平台的不同之处在于它是在其他基于硬件的平台之上运行的纯软件平台。**
> 
> Java 平台有两个组件：
> 
> *   Java 虚拟机
> *   Java 应用程序编程接口 (API)

![Java平台](https://i.stack.imgur.com/fm1hP.gif)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-07T06:52:05.747

顾名思义（应用程序编程接口），API 只是框架的接口。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-07T06:46:05.603

根据我的理解，API 基本上是一种与现有应用程序（如 Facebook）交互的方式，而框架基本上是一种从头开始构建您自己的应用程序的工具。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-09-21T11:51:31.400

*   **软件框架：**是软件系统（或子系统）的可重用设计。软件框架可能包括程序、代码库、脚本语言和其他软件，以帮助开发和粘合软件项目的不同组件。框架的各个部分可能通过 API 公开。

*   **API（应用程序编程接口）：**是由库和/或操作系统服务提供的一组例程（AKA 方法、函数）、数据结构、对象类和/或协议，以支持应用程序的构建。
    更多详细信息以及指向此特定主题的其他链接是 [http://aprogrammersday.blogspot.com/2009/02/difference-between-framework-and-api.html](http://aprogrammersday.blogspot.com/2009/02/difference-between-framework-and-api.html)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-03-12T13:31:47.883

**API**（应用程序编程接口）：就像他的名字的意思，是外部程序与你的内部程序或库进行交互而无需直接访问的接口。例如，谷歌地图 API 和 Facebook API 为您提供了与他们的程序和库进行交互的界面，而无需直接访问。

另一方面：

**框架**：是可以帮助您构建应用程序的库的集合。你可以把框架想象成一个“骨架”，应用程序定义了“肉”，所以你不能拿一个人的骨架来构建一个马的身体，所以在开始编程之前你必须选择好的框架。这就是为什么我们说：**你叫图书馆。框架调用你。**

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-07T06:46:47.490

我想认为 API 是框架的子集

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-07T07:01:30.450

根据我的经验，一个框架通常包含（至少）两个简单 API 没有的东西：

*   可扩展性：您可以组合或子类化框架组件来扩展或自定义其功能。

*   用于与应用程序开发相关的代码生成、管理或诊断任务的工具。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-11-30T11:03:30.587

框架基本上是抽象开发过程并促进代码重用的类的集合，例如，您可能拥有独立于您正在构建的应用程序的数据库、会话和分页类。但是 API 是源代码接口，它允许不同系统的两个或多个组件进行交互，例如将 Google Maps API 添加到您的网站，您和 Google 是两个不同的系统，Google 编码了用于将其产品合并到您的网站的底层接口/应用。总而言之，在构建系统时使用框架工作，然后在为 Facebook 和 Google 等其他人提供扩展时开发 API。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-11-02T14:57:55.250

我知道这是一个老话题，这真的无关紧要，但我还是忍不住附和我自己的观点。API（例如设备驱动程序 API、Windows API 等）为平台提供了基本和必要的功能，以便程序员可以发挥他的创造力并在平台上做一些事情——是的，包括使用它来构建框架。框架在功能和抽象上更高层次，并提供一组可重用且方便的函数/类/约定，以方便开发具有某些共同属性的应用程序（例如 iPad 应用程序、Web 服务等）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-08-09T12:56:23.157

框架实现了一个非常重要的选项，称为**IoC（控制反转）**，简而言之，这意味着您的代码*没有更多*的东西在手边。

在 API 中，您的代码调用其他代码（**库**），当您使用特定框架时，​​控制应用程序流的是框架。

# asp.net-mvc - 使用相同的方法签名发布和获取

> ID：724386
> 
> 赞同：59
> 
> 时间：2009-04-07T06:48:23.463
> 
> 标签：asp.net-mvc, post, controller, get, asp-net-mvc-1

在我的控制器中，我有两个称为“朋友”的动作。执行的取决于它是“获取”还是“发布”。

所以我的代码片段看起来像这样：

```
// Get:
[AcceptVerbs(HttpVerbs.Get)]
public ActionResult Friends()
{
    // do some stuff
    return View();
}

// Post:
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Friends()
{
    // do some stuff
    return View();
} 
```

但是，这不会编译，因为我有两个具有相同签名的方法（朋友）。我该如何去创造这个？我是否只需要创建一个操作，但要区分其中的“获取”和“发布”？如果是这样，我该怎么做？

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2009-04-07T07:03:59.603

将第二种方法重命名为“Friends_Post”之类的其他名称，然后您可以为第二种方法添加`[ActionName("Friends")]`属性。因此，请求类型为 POST 的 Friend 操作的请求将由该操作处理。

```
// Get:
[AcceptVerbs(HttpVerbs.Get)]
public ActionResult Friends()
{
    // do some stuff
    return View();
}

// Post:
[ActionName("Friends")]
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Friends_Post()
{
    // do some stuff
    return View();
} 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2010-07-12T03:05:11.890

如果你真的只想要一个例程来处理两个动词，试试这个：

```
[AcceptVerbs("Get", "Post")]
public ActionResult ActionName(string param1, ...)
{
//Fun stuff goes here.
} 
```

一个潜在的警告：我使用的是 MVC 版本 2。不确定 MVC 1 是否支持这一点。AcceptVerbs 的 Intellisense 文档应该让您知道。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-07-26T21:18:16.583

尝试使用：

```
[AcceptVerbs(HttpVerbs.Post | HttpVerbs.Get)]
public ActionResult Friends()
{
    // do some stuff
    return View();
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-07T07:04:30.490

不完全确定这是否是正确的方法，但我会使用无意义的参数来区分信号。像：

```
// Get:
[AcceptVerbs(HttpVerbs.Get)]
public ActionResult Friends(bool isGet)
{
    // do some stuff
    return View();
}

// Post:
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Friends()
{
    // do some stuff
    return View();
} 
```

我知道这很丑陋和骇人听闻，但它确实有效。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T07:24:19.287

将 cagdas 的回答标记为答案，因为它回答了我的问题。但是，由于我不喜欢在我的项目中使用 ActionName 属性，所以我使用了不同的解决方案。我只是将 FormCollection 添加到“发布”操作中（最终更改了方法签名）

```
// Get:
[AcceptVerbs(HttpVerbs.Get)]
public ActionResult Friends()
{
    // do some stuff
    return View();
}

// Post:
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Friends(FormCollection form)
{
    // do some stuff
    return View();
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T07:27:06.160

将要在帖子中接收的参数添加到 Post 方法。也许是这样的：

```
// Post:
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Friends(string friendName, string otherField)
{
    // do some stuff
    return View();
} 
```

..或者如果你有一个复杂的类型，像这样：

```
// Post:
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Friends(Friend friend)
{
    // do some stuff
    return View();
} 
```

**编辑：**最好使用更多类型的方法来接收已发布的项目，如上所示。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-12-20T20:21:57.287

你的动作方法不能做同样的事情，否则就没有必要编写两个动作方法。因此，如果语义不同，为什么不对动作方法也使用不同的名称呢？

例如，如果您有一个“删除”操作方法，而 GET 只是要求确认，您可能会调用 GET 方法“ConfirmDelete”而 POST 方法只是“删除”。

不确定这是否符合你的情况，但当我遇到同样的问题时，它总是对我有用。

# asp.net - XML 解析错误：未找到元素

> ID：724387
> 
> 赞同：0
> 
> 时间：2009-04-07T06:49:13.710
> 
> 标签：asp.net, javascript, xml, vb.net, formatting

我正在使用[NiceEdit](http://www.nicedit.com)格式化文本区域中的文本，它在指定的文本区域上显示一个工具栏，我创建了一个测试页面，它的工作，我响应。格式化后写入文本区域的内容，没关系，我创建一个断点来查看正在阅读的内容，一切都很好。

现在我移动到我应该实现这个文本格式的真实页面，它根本没有做任何事情，工具栏显示并且它的工作，但是当我提交时，没有存储任何内容，我创建了一个断点和它的内容文本区什么都没有，空“”。

我走得更远，把 Response.Write(textArea.text) 然后 Response.End() 我得到了错误：

XML 解析错误：未找到元素

以防万一，我用于格式化 NiceEdit 工具栏的脚本，这与我在测试页面中使用的脚本相同，并且运行良好，脚本是：

```
<script src="../nicEdit/nicEdit.js" type="text/javascript"></script>
<script type="text/javascript">
bkLib.onDomLoaded(function() {
new nicEditor({buttonList : ['fontSize','fontFamily','fontFormat','bold','italic','underline','strikethrough','forecolor','bgcolor','removeformat'], iconsPath : '../nicEdit/nicEditorIcons.gif'}).panelInstance('txtDescription');
});
</script> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T09:48:36.353

看起来我解决了它：而不是链接按钮，使用按钮来保存或执行操作......简单，对我来说不合逻辑，但它的工作：D

# php - 从 PHP URL 保存图像

> ID：724391
> 
> 赞同：426
> 
> 时间：2009-04-07T06:50:46.403
> 
> 标签：php, image

我需要将图像从 PHP URL 保存到我的 PC。假设我有一个页面，`http://example.com/image.php`，只有一个“花”图像，没有别的。如何使用新名称（使用 PHP）从 URL 中保存此图像？

* * *

## 回答 #1

> 赞同：754
> 
> 时间：2009-04-07T07:15:24.660

如果您已`allow_url_fopen`设置为`true`：

```
$url = 'http://example.com/image.php';
$img = '/my/folder/flower.gif';
file_put_contents($img, file_get_contents($url)); 
```

否则使用[cURL](http://www.php.net/manual/en/book.curl.php)：

```
$ch = curl_init('http://example.com/image.php');
$fp = fopen('/my/folder/flower.gif', 'wb');
curl_setopt($ch, CURLOPT_FILE, $fp);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_exec($ch);
curl_close($ch);
fclose($fp); 
```

* * *

## 回答 #2

> 赞同：272
> 
> 时间：2011-07-06T09:12:56.980

使用 PHP 的函数[copy()](https://www.php.net/manual/en/function.copy.php)：

```
copy('http://example.com/image.php', 'local/folder/flower.jpg'); 
```

注意：这需要[allow_url_fopen](https://www.php.net/manual/en/filesystem.configuration.php#ini.allow-url-fopen)

* * *

## 回答 #3

> 赞同：75
> 
> 时间：2009-04-07T06:55:10.187

```
$content = file_get_contents('http://example.com/image.php');
file_put_contents('/my/folder/flower.jpg', $content); 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2009-04-07T08:00:15.270

在这里，示例将远程图像保存到 image.jpg。

```
function save_image($inPath,$outPath)
{ //Download images from remote server
    $in=    fopen($inPath, "rb");
    $out=   fopen($outPath, "wb");
    while ($chunk = fread($in,8192))
    {
        fwrite($out, $chunk, 8192);
    }
    fclose($in);
    fclose($out);
}

save_image('http://www.someimagesite.com/img.jpg','image.jpg'); 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2011-02-01T16:09:00.730

[Vartec 对 cURL 的回答](https://stackoverflow.com/a/724449/352449)对[我](http://www.php.net/manual/en/book.curl.php)不起作用。确实如此，由于我的具体问题略有改善。

**例如，**

当服务器上有重定向时（例如当您尝试保存 facebook 个人资料图片时），您将需要以下选项集：

```
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); 
```

* * *

**完整的解决方案变为：**

```
$ch = curl_init('http://example.com/image.php');
$fp = fopen('/my/folder/flower.gif', 'wb');
curl_setopt($ch, CURLOPT_FILE, $fp);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
curl_exec($ch);
curl_close($ch);
fclose($fp); 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2010-12-03T17:45:05.457

我无法使用任何其他解决方案，但我能够使用 wget：

```
$tempDir = '/download/file/here';
$finalDir = '/keep/file/here';
$imageUrl = 'http://www.example.com/image.jpg';

exec("cd $tempDir && wget --quiet $imageUrl");

if (!file_exists("$tempDir/image.jpg")) {
    throw new Exception('Failed while trying to download image');
}

if (rename("$tempDir/image.jpg", "$finalDir/new-image-name.jpg") === false) {
    throw new Exception('Failed while trying to move image file from temp dir to final dir');
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-05-11T07:59:57.300

```
$img_file='http://www.somedomain.com/someimage.jpg'

$img_file=file_get_contents($img_file);

$file_loc=$_SERVER['DOCUMENT_ROOT'].'/some_dir/test.jpg';

$file_handler=fopen($file_loc,'w');

if(fwrite($file_handler,$img_file)==false){
    echo 'error';
}

fclose($file_handler); 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-09-18T12:10:47.263

请参阅[`file()`^(*PHP 手册*)](http://php.net/file)：

```
$url    = 'http://mixednews.ru/wp-content/uploads/2011/10/0ed9320413f3ba172471860e77b15587.jpg';
$img    = 'miki.png';
$file   = file($url);
$result = file_put_contents($img, $file) 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-01-07T06:38:45.963

```
$data = file_get_contents('http://example.com/image.php');
$img = imagecreatefromstring($data);
imagepng($img, 'test.png'); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2020-06-20T12:18:07.850

这里的答案都没有提到可以压缩 URL 图像（gzip）的事实，并且在这种情况下它们都不起作用。

有两种解决方案可以解决这个问题：

首先是使用 cURL 方法并设置 curl_setopt `CURLOPT_ENCODING, ''`：

```
// ... image validation ...

// Handle compression & redirection automatically
$ch = curl_init($image_url);
$fp = fopen($dest_path, 'wb');

curl_setopt($ch, CURLOPT_FILE, $fp);
// Exclude header data
curl_setopt($ch, CURLOPT_HEADER, 0);
// Follow redirected location
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);
// Auto detect decoding of the response | identity, deflate, & gzip
curl_setopt($ch, CURLOPT_ENCODING, '');

curl_exec($ch);

curl_close($ch);
fclose($fp); 
```

它可以工作，但是从对不同图像（png、jpg、ico、gif、svg）的数百次测试来看，它并不是最可靠的方法。

最好的方法是检测图像 url 是否具有内容编码（例如 gzip）：

```
// ... image validation ...

// Fetch all headers from URL
$data = get_headers($image_url, true);

// Check if content encoding is set
$content_encoding = isset($data['Content-Encoding']) ? $data['Content-Encoding'] : null;

// Set gzip decode flag
$gzip_decode = ($content_encoding == 'gzip') ? true : false;

if ($gzip_decode)
{
    // Get contents and use gzdecode to "unzip" data
    file_put_contents($dest_path, gzdecode(file_get_contents($image_url)));
}
else
{
    // Use copy method
    copy($image_url, $dest_path);
} 
```

有关 gzdecode 的更多信息，[请参阅此线程](https://stackoverflow.com/questions/8895852/uncompress-gzip-compressed-http-response)。到目前为止，这工作正常。如果有什么可以做得更好的，请在下面的评论中告诉我们。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-01-06T12:52:15.000

创建一个名为 images 的文件夹，位于您计划放置要创建的 php 脚本的路径中。确保它对每个人都有写权限，否则脚本将无法工作（它将无法将文件上传到目录中）。

# c# - 如何在 MVC 应用程序中显示数字状态

> ID：724402
> 
> 赞同：2
> 
> 时间：2009-04-07T06:57:00.383
> 
> 标签：c#, linq-to-sql, model-view-controller

我正在构建一个基于 MVC 的新应用程序并考虑 LINQ-To-SQL/Entity Framework。我有一个具有数字状态的实体，例如（0 - 打开，1 - 活动，2 - 关闭），我应该在哪里放置逻辑以在自动生成的视图/控制器或模型中显示适当的字符串（枚举？？） ? 我应该将所有这些逻辑移到业务层吗？我应该向 LINQ-To-SQL 构建的部分类添加业务逻辑和新属性（显示字符串状态）吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T07:02:01.493

实际上，LINQ-to-SQL 可以将整数直接绑定到枚举（到数据库中的`int`（等）或`[n][var]char`列数据），所以一个简单的答案是创建一个枚举（在您的数据/存储库层），并更改 dbml（通常通过设计器），以便它使用（完全限定的）枚举类型作为状态列。

如果这不是一个选项，那么我会将类中的 status 属性（再次通过 dbml）重命名为`StatusCode`，并添加一个返回首选表示的部分类（作为枚举或字符串），即

```
partial class YourType { // only do this if direct enum mapping isn't an option
    public Status Status { // could also be string
         get {
             switch(StatusCode) {
                  case 0: return Status.Open;
                  // etc
             }
         }
    }
} 
```

# c - 在位域结构上转换字节序

> ID：724404
> 
> 赞同：7
> 
> 时间：2009-04-07T06:58:08.010
> 
> 标签：c, data-structures, endianness

我需要将位域结构从小端架构转换为大端架构。如果我只是交换结构元素，那么最好的方法是什么，因为字节边界会出现问题。

防爆结构为：

```
struct {
    unsigned int    b1:1;
    unsigned int    b2:8;
    unsigned int    b3:7;
    unsigned int    b4:8;
    unsigned int    b5:7;
    unsigned int    b6:1;
}; 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T07:11:07.307

您可以使用 32 位整数，并使用 and- 和 bitshift 运算符从中提取信息。有了它，您可以简单地使用 htonl（主机到网络，长）。网络字节顺序是大端。

这不会像位域那样优雅，但至少你会知道你拥有什么，并且不必担心编译器会填充你的结构。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-02-25T10:19:06.033

处理器字节序与位字段排序无关。同一台计算机上的两个编译器很可能对位域使用相反的顺序。所以，鉴于此：

```
union {
    unsigned char x;
    struct {
        unsigned char b1 : 1;
        unsigned char b2 : 7;
    };
} abc;
abc.x = 0;
abc.b1 = 1;
printf( "%02x\n", abc.x ); 
```

除非您碰巧有详细的文档，否则要知道是否会打印出 01 或 80 的唯一方法是尝试一下。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-07T07:11:15.967

在将代码从 MIPS 移植到 Linux/x86 的项目中，我们这样做了。

```
struct {

#ifdef __ONE_ENDIANESS__
    unsigned int    b1:1;
    unsigned int    b2:8;
    unsigned int    b3:7;
    unsigned int    b4:8;
    unsigned int    b5:7;
    unsigned int    b6:1;
#define _STRUCT_FILLED
#endif /* __ONE_ENDIANESS__ */

#ifdef __OTHER_ENDIANESS__
    unsigned int    b6:1;
    unsigned int    b5:7;
    unsigned int    b4:8;
    unsigned int    b3:7;
    unsigned int    b2:8;
    unsigned int    b1:1;
#define _STRUCT_FILLED
#endif /* __OTHER_ENDIANESS__ */

};

#ifndef _STRUCT_FILLED
#  error Endianess uncertain for struct
#else
#  undef _STRUCT_FILLED
#endif /* _STRUCT_FILLED */ 
```

宏`__ONE_ENDIANESS__`和`__OTHER_ENDIANESS__`适合我们使用的编译器，因此您可能需要查看哪个适合您...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T07:03:16.017

那里有两个 16 位部分（前三个字段和后三个字段是 16 位）。

那只有 65536 个条目。所以有一个查找表来保存字段的位反转版本。将结构与另一个具有两个 16 位字段的结构包装在一个联合中以使其更容易？

类似的东西（未经测试，我不在 C 编译器附近）：

```
union u {
    struct {
        unsigned int    b1:1;
        unsigned int    b2:8;
        unsigned int    b3:7;
        unsigned int    b4:8;
        unsigned int    b5:7;
        unsigned int    b6:1;
     } bits;
     struct {
        uint16 first;
        uint16 second;
     } words
} ;

unit16 lookup[65536];

/* swap architectures */

void swapbits ( union u *p)
{
   p->words.first = lookup[p->words.first];
   p->words.second = lookup[p->words.second];
} 
```

查找表的数量留给读者作为练习:)

但是，请仔细阅读您的编译器文档。我不确定 C 标准是否要求该结构适合一个单词（尽管我希望大多数编译器都这样做）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T07:14:04.367

您希望在通道（文件或网络）和您的结构之间执行此操作。我的首选做法是通过编写以已知表示形式构建文件缓冲区的代码并匹配反转该转换的读取代码来将文件 I/O 与结构隔离。

您的具体示例特别难以猜测，因为位域被定义为 unsigned int 并且`sizeof(unsigned int)`特别不可移植。

假设作为一个 SWAG，`sizeof(int)==4`然后获取指向结构的指针并重新排列各个字节可能会得到你想要的答案。

为不同平台定义不同结构的技巧*可能*有效，但在您引用的示例中，字节边界没有完全中断，因此不太可能在不拆分的情况下在另一个平台上产生等效的一个平台将一个或多个字段分成两部分。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T07:13:10.563

交换字节应该足够了。字节内的位位置在大端和小端中是相同的。
例如：

```
char* dest = (char*)&yourstruct;
unsigned int orig = yourstruct;
char* origbytes = (char*)&orig;
dest[0] = origbytes[3];
dest[1] = origbytes[2];
dest[2] = origbytes[1];
dest[3] = origbytes[0]; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-08T10:35:40.193

当物理布局很重要时，您不应使用位域，因为它是由实现定义的，以填充较大字的顺序。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-04-10T03:37:53.883

为了做到这一点，我终于得到了一个解决方案（一些来自上述 epatel 的解决方案）。这是如果我从 x86 转换到 Solaris SPARC。

我们需要首先交换传入的结构，然后以相反的顺序读取元素。基本上在查看了结构是如何对齐的之后，我发现字节顺序和位顺序都发生了变化。这是一个伪代码。

```
struct orig
{    
    unsigned int    b1:1;
    unsigned int    b2:8;
    unsigned int    b3:7;
    unsigned int    b4:8;
    unsigned int    b5:7;
    unsigned int    b6:1;
};

struct temp
{    
    unsigned int    b6:1;
    unsigned int    b5:7;
    unsigned int    b4:8;
    unsigned int    b3:7;
    unsigned int    b2:8;
    unsigned int    b1:1;
}temp;

func (struct orig *toconvert)
{
    struct temp temp_val;
    //Swap the bytes
    swap32byte((u32*)toconvert);
    //Now read the structure in reverse order - bytes have been swapped
    (u32*)&temp_val = (u32 *)toconvert;
    //Write it back to orignal structure
    toconvert->b6=temp_val.b6;
    toconvert->b5=temp_val.b5;
    toconvert->b4=temp_val.b4;
    toconvert->b3=temp_val.b3;
    toconvert->b2=temp_val.b2;
    toconvert->b1=temp_val.b1; 
```

}

经过一些实验，我发现这种方法只有在元素完全填充结构时才有效，即没有未使用的位。

# c# - ViewModel 单根继承层次结构或带有 FilterAttributes 的 ViewData 注入

> ID：724417
> 
> 赞同：1
> 
> 时间：2009-04-07T07:04:19.163
> 
> 标签：c#, .net, asp.net-mvc

在之前的项目中，我对 MVC viewModel 使用了单根继承。

一切正常，并且在向站点管理员提供数据方面很有效，但控制器操作有点痛苦。为了每次都正确地构造根视图数据，我们必须重写（使用方法隐藏）Controller.View()。

这次我很想尝试属性 ViewData 注入，并且想知道是否有人知道这种方法的任何陷阱。

该技术涉及让操作方法设置 ViewData.Model，然后使用属性设置 ViewData 项以供站点主使用的数据使用。我可以使用 ViewDataDictionary 扩展方法强类型检索。

任何帮助是极大的赞赏。

**更新：**我正在使用过滤器注入方法，感觉比其他方法更干净。干净得多。我让我的 IoC 容器将属性注入过滤器，为它们提供构建站点范围通用数据所需的必要提供程序。虽然我必须为我想要通用的每个“事物”编写一个过滤器和一个辅助方法，但它释放了控制器操作中模型数据的构造。

还有其他人也走这条路吗？

**更新2：**耶！我想我难倒了 Stackoverflow

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T00:42:19.270

当结果是 ViewResult 时，如何使用基本控制器和在 OnActionExecuted 中注入的公共视图数据。这样，您只需要在一个地方实现对这些数据的检索——也许，再加上您的 ViewDataDictionary 扩展，以允许您以强类型的方式访问它。

# android - Android：在恢复应用程序时恢复活动的活动

> ID：724419
> 
> 赞同：6
> 
> 时间：2009-04-07T07:04:37.777
> 
> 标签：android, android-activity

我有两个正在运行的活动：*mainActivity*和*childActivity*。每当用户单击*mainActivity*中的按钮时，就会启动*childActivity*。我想做的是：

当活动活动是*childActivity*并且用户**单击主页按钮然后重新启动应用程序**时，我希望看到*childActivity* **而不是启动的** *mainActivity*。

我有一些建议实际上可以解决。我试图操纵 onStart、onRestart、onResume、onStop、onDestroy 事件。但是，他们并没有完全解决问题。应该有一个聪明的出路。谢谢你。

编辑：

谢谢你的回答，Soonil。当从最近的活动窗口调用活动时，您所说的情况正在发生。（长按主页按钮时打开的窗口）但是；从主屏幕打开它时不会发生这种情况。（比如从头开始）我不认为我的代码有特定的问题会产生这个错误。因为，我创建了一个测试项目并在发送问题之前尝试独立运行并面临同样的问题。无论如何，这是测试代码：

```
public class MainActivity extends Activity implements OnClickListener {
    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
        this.setTitle("MainActivity");

        ((Button) findViewById(R.id.btnChildActivity)).setOnClickListener(this);
    }

    @Override
    public void onClick(View arg0) {
        // TODO Auto-generated method stub
        startActivity(new Intent(this, ChildActivity.class));
    }

}

public class ChildActivity extends Activity {
    /** Called when the activity is first created. */
    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main2);
        this.setTitle("ChildActivity");

    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T14:50:19.013

**编辑**：今天有点随机地找到了您的问题的解决方案！请参阅此[错误报告](http://code.google.com/p/android/issues/detail?id=2373)。它准确地解释了你的问题。我无法重现该问题的原因是我从未让 Eclipse 直接启动应用程序。我使用 Eclipse 安装应用程序，然后自己启动它。

* * *

这已经是 Android 应用程序的默认行为，无需特殊技巧即可实现。我很惊讶您的应用程序没有表现出这种行为。每个 Android 应用程序都维护一个 Activity 堆栈，实际上是一个 LIFO 的 Activity 堆栈。这些活动可以进一步分组为任务，但根据我的经验，99% 的普通应用程序不需要了解任何有关任务的信息。

当您按下主页按钮时，整个应用程序堆栈都会进入后台。在后台，它可能随时因内存问题而被杀死，但如果在恢复之前没有多少时间过去，它通常不会被杀死，也不必重新创建。当您再次选择应用程序时，堆栈（或更准确地说，只有堆栈上的顶部项目）被恢复。

如果您的应用程序没有表现出这种行为，我怀疑它与您如何启动 mainActivity 和 childActivity 以及您可能正在使用的任何额外 Intent 标志有关。您是否有机会发布有关如何启动 mainActivity 和 childActivity 的代码片段？

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-08T12:08:37.897

我回去用一个类似的应用程序进行了测试，即使进程被强制内存不足，ChildActivity 也会自动重组，正如 Soonil 所说。您是在模拟器上还是在实际设备上看到这个？

如果您运行您的应用程序并观看 logcat，您应该在启动应用程序后看到类似以下内容，然后打开 ChildActivity 并单击主页，然后再次启动您的活动：

开始活动： Intent { action=android.intent.action.MAIN categories={android.intent.categroy.LAUNCHER} flags=... comp={com.yourpackagename.MainActivity} } 启动活动 yourpackagename.ChildActivity: pid= x uid=y gids={} 显示的活动 /.ChildActivity

当您没有看到您期望的行为时，您可以发布 logcat 的输出吗？

# apache-flex - 如何在 flex 上使用 Web 服务？

> ID：724420
> 
> 赞同：0
> 
> 时间：2009-04-07T07:04:40.413
> 
> 标签：apache-flex, web-services, soap

我将使用[https://adwords.google.com/api/adwords/v13/AdService?wsdl](https://adwords.google.com/api/adwords/v13/AdService?wsdl)。google adwords api到我的项目。那我该怎么用呢？你知道任何例子吗请参考我

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T07:09:21.260

谢谢你的问题，我喜欢它。

这是一个教程，我现在要自己学习。它看起来很简单，并与 Flex 3.0 一起使用：

[http://livedocs.adobe.com/flex/3/html/help.html?content=data_access_3.html](http://livedocs.adobe.com/flex/3/html/help.html?content=data_access_3.html)

如果您还想为教育或失业开发人员获取 Flex 的免费序列号，请访问此链接以获取信息：

[https://freeriatools.adobe.com/](https://freeriatools.adobe.com/)

干杯，

安德鲁

# ruby-on-rails - 如何确定我的 ActiveRecord 对象是否违反了唯一的数据库键/索引？

> ID：724431
> 
> 赞同：6
> 
> 时间：2009-04-07T07:07:30.950
> 
> 标签：ruby-on-rails, database, exception, activerecord, indexing

ActiveRecord`validates_uniqueness_of`容易[受到竞争条件](http://www.google.com/search?q=activerecord+validates+uniqueness+race+condition)的影响。要真正确保唯一性，需要额外的保障措施。ActiveRecord RDocs 的一个建议是在数据库上创建一个唯一索引，例如通过在迁移中包含：

```
add_index :recipes, :name, :unique => true 
```

这将确保在数据库级别名称是唯一的。但是这种方法的一个缺点是`ActiveRecord::StatementInvalid`尝试保存副本时返回的异常不是很有用。在捕获此异常时，无法确定该错误是由重复记录生成的，而不仅仅是由损坏的 SQL 生成的。

正如 RDocs 建议的那样，一种解决方案是解析异常附带的消息并尝试检测诸如“重复”或“唯一”之类的词，但这很笨拙，并且该消息是特定于数据库后端的。对于 SqlLite3，我的理解是消息是完全通用的，根本不能这样解析。

鉴于这对 ActiveRecord 用户来说是一个基本问题，如果有任何标准方法来处理这些异常，那就太好了。我将在下面提出我的建议；请发表评论或提供替代方案；谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-07T07:20:43.323

解析错误消息并没有那么糟糕，但感觉很笨拙。我遇到的一个似乎很吸引人的建议（不记得在哪里）是，在救援块中，您可以检查数据库以查看实际上是否存在重复记录。如果有，那么 StatementInvalid 很可能是因为重复，您可以相应地处理它。如果没有，那么 StatementInvalid 必须来自其他东西，并且您必须以不同的方式处理它。

所以基本思想，假设`recipe.name`上面的唯一索引：

```
begin
  recipe.save!
rescue ActiveRecord::StatementInvalid
  if Recipe.count(:conditions => {:name => recipe.name}) > 0
    # It's a duplicate
  else
    # Not a duplicate; something else went wrong
  end
end 
```

我尝试使用以下方法自动执行此检查：

```
class ActiveRecord::Base
  def violates_unique_index?(opts={})
    raise unless connection
    unique_indexes = connection.indexes(self.class.table_name).select{|i|i.unique}
    unique_indexes.each do |ui|
      conditions = {}
      ui.columns.each do |col|
        conditions[col] = send(col)
      end
      next if conditions.values.any?{|c|c.nil?} and !opts[:unique_includes_nil]
      return true if self.class.count(:conditions => conditions) > 0
    end
    return false
  end
end 
```

所以现在你应该能够`generic_record.violates_unique_index?`在你的救援块中使用来决定如何处理 StatementInvalid。

希望这有帮助！其他方法？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T07:27:54.617

这真的是一个大问题吗？

如果将唯一索引与`validates_uniqueness_of`约束一起使用，则

*   将保持数据完整性
*   当两个单独的请求尝试同时插入非唯一行时，您最多只会收到错误

因此，除非您有一个应用程序可以执行许多潜在的重复插入（在这种情况下，我会考虑重新设计它）我认为这在实践中很少成为问题。

# frameworks - 类库和框架有什么区别

> ID：724438
> 
> 赞同：17
> 
> 时间：2009-04-07T07:11:39.647
> 
> 标签：frameworks, class-library

我整天都听到类库、基类库、框架等术语……
什么突出了框架，什么是基类库？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-07T07:24:34.593

类库和软件框架的区别在于，在框架中，控制流不是由用户的代码决定的，而是由框架决定的。

这也被称为好莱坞原则（不要打电话给我们，我们打电话给你）。

顺便说一句，还有 一篇关于这个主题的不错的[Wikipedia 文章。](http://en.wikipedia.org/wiki/Software_framework)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-07T07:18:08.180

您在编写代码时使用类库，但您*在*框架内编写代码。

术语“框架”旨在唤起一种“身处环境中”的感觉。如果要我做一个（有限的）类比，我会说类库就像能够吃奶酪和喝葡萄酒，而框架就像访问法国；体验文化。框架是您构建程序的结构。类库是您使用的工具（可能在框架内）。

当然，框架通常会包含类库。例如，.NET 拥有大量包含在整个框架中的类库。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-12-10T09:29:34.103

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-07T07:19:30.533

**类库**通常是一个 DLL 或一个类包，您可以将其“包含”/“引用”到您的解决方案中并重用。

**框架**通常是针对特定上下文的重复模式/解决方案，例如 GUI 框架。框架通常意味着您按照框架设计者的要求编写某些部分，将它们放置在预期/正确的位置并且它应该可以工作。

*   例如，Spring 是 DI 的框架。您以设计人员指定的格式编写 xml 文件，然后框架允许您获得组装的类，而不必担心框架会这样做。
*   Rails 是用于 RAD 网络应用程序的 Ruby 框架。你只需要编写模型、控制器和视图，不到一个小时你就有了一个可以工作的网络应用程序。
*   BCL 是一组类库，因此您不必在 .NET 中实现数据结构和常用类型，只需包含它们即可免费获得经过测试证明的实现。

一个框架通常包含多个类库。与往常一样，这些术语现在以一种模棱两可的方式使用..但上面代表了对这些术语的更常见的解释......至少我的:)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-07T07:18:49.193

您经常使用库在您的 OWN 软件/基础设施中获得某些功能。例如打印条形码，您将使用库来执行此操作。框架抽象出一整类问题，可能是编写 Web 应用程序的问题。为此，该框架提供了具有您可以针对其编程的所有功能和存根的“框架”。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-07T07:20:42.603

类库只是封装在可定义单元（如程序集）中的一组类。该术语不限于任何特定的语言或框架。

基[类库](http://en.wikipedia.org/wiki/Base_Class_Library)(BCL) 是预装在 .NET Framework 中的一组类库的特定术语属性，这些类库提供整齐地组织到命名空间中的类，以便您拥有一个 API 来构建自己的解决方案。

框架是一个更广泛的术语，包括类库、管理进程受控执行的虚拟机、提供运行时环境以及其他服务，例如内存管理和异常处理。有关详细信息，请参阅[.NET 框架](http://en.wikipedia.org/wiki/.NET_Framework)。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-07T07:54:44.613

你调用类库的代码，框架调用你的代码

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-07T07:19:59.673

我认为这两者是相当可互换的...... - 它只是一组常见的可重用代码（在您所针对的任何平台中），通常由平台提供。

也许您可能会争辩说，BCL 通常代表“纯”（独立于供应商）模块，而“框架”*可能*（取决于您如何使用该术语）包括供应商的定制模块。但它可能对当地的解释开放。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-07T07:18:03.953

框架是一个或多个类库的据称内聚的集合。例如，Java 和 .NET 框架由数百个类库组成。在 .NET 中，程序集和类库之间存在自定义但不一定存在对应关系。在 Java 中，名称空间和类库之间存在粗略的对应关系。

虽然我从未注意到“*基*类库”这个短语，但我希望这样的东西包含旨在在使用前被子类化的抽象类。

在我的第一段中，框架意味着图书馆范围内的完整性。例如，您希望图像处理框架包含处理图像所需的一切，从文件格式解析器到内存中的图形操作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-07T07:17:40.850

我认为框架是应用程序可以遵循的模式，定义在一组库中。

根据上下文，“基”类库可能意味着几件事；它可以引用设计为派生自的类，这是框架中的一种常见方法，或者它可以仅引用假定在任何应用程序中有用的类的核心库，因此被认为是“基本”需求，几乎是语言的一部分（例如，容器类）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-06-05T17:11:53.887

一个应用程序有许多部分同步共存，提供不同的功能......现在必须为这些部分中的每一个编写代码才能工作，因此应用程序框架会为您执行该代码，这样您就不必经历细节编写与每个功能相关的每个代码。应用程序框架使编写应用程序更容易。

用最简单的话来说，如果你正在建造一座建筑，那么它的骨架结构、形状、它可以支撑的功能、电气和液压设计、框架等都是它的框架，现在你必须在这个框架内工作才能让你的建筑如此令人担忧关于制作抗震结构或制作线性直立建筑物已由您的框架处理

就是这么简单。该框架承担了与操作系统交互的所有复杂性，并为您简化了它们。它为您处理所有细节。显然，某些框架比其他框架做得更好。

应用程序框架和库之间的区别：您在编写代码时使用类库，但您在框架内编写代码。

# .net - 从 .Net 应用程序调用 PHP 脚本

> ID：724442
> 
> 赞同：1
> 
> 时间：2009-04-07T07:13:54.307
> 
> 标签：.net, php

无论如何从.Net应用程序调用PHP脚本并传入一些参数？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T07:16:36.063

您可以通过命令行调用来完成

```
php your-file.php parameter1 parameter2 
```

参数在`$_SERVER['argv']`变量中可用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T07:18:29.223

我已经使用 Web 服务与 .NET 和 PHP 进行互操作。您可以从两者中输出 XML，这意味着您可以调用每种方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T07:15:32.303

如果您安装了 PHP 运行时，您仍然可以启动一个新进程来执行脚本。

看一下**Process**类。

# .net - 用于解析类型名称的框架类？

> ID：724446
> 
> 赞同：0
> 
> 时间：2009-04-07T07:14:34.023
> 
> 标签：.net, reflection

我有包含完全限定类型名称的字符串，就像[这个 MSDN 文档一样](http://msdn.microsoft.com/en-us/library/yfsftwz6.aspx)。我想知道是否有一个框架类可以帮助我解析出各种组件（例如泛型类型参数）。

请注意，我不能简单地使用 Type.GetType 加载 Type 并检查其属性，因为字符串指定的类型在我试图解析它的上下文中可能无法访问。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T07:35:23.083

没有专门设计用于解析类型字符串的类。不过，围绕正则表达式构建一个应该不是特别困难的任务。

# .net - NHibernate 连接来自其他表的单个值

> ID：724447
> 
> 赞同：0
> 
> 时间：2009-04-07T07:14:43.460
> 
> 标签：.net, nhibernate, join, nhibernate-mapping

我试图让 nHibernate 将存储在单独表中的结构的名称加入到结构 POCO 对象中。

数据库看起来像这样：

```
+-----------+  +------------+  +-----------+
| Structure |  | Texts      |  | Languages |
+===========+  +============+  +===========+
| Id        |  | Id         |  | Id        |
| NameId    |  | LanguageId |  | Name      |
| FieldA    |  +------------+  +-----------+
| FieldB    |
+-----------+ 
```

我希望 POCO 对象如下所示：

```
public class Structure
{
    public Structure()
    {
    }

    public long Id
    {
        get { return name; }
        set { name = value; }
    }

    public string Name
    {
        get { return name; }
        set { name = value; }
    }

    public string FieldA
    {
        get { return name; }
        set { name = value; }
    }

    public string FieldB
    {
        get { return name; }
        set { name = value; }
    }

    private long id;
    private string name;
    private string fieldA;
    private string fieldB;
} 
```

所以我想要实现的是使用以下标准从 Texts 表中获取加入的 POCO 对象的 name 属性：

```
Texts.Id=Structure.NameId AND Texts.Id=CurrentLanguageId 
```

（CurrentLanguageId 将存储在应用程序中并映射到 nHibernate）

那么如何在 nHibernate 中映射这个连接以及如何将应用程序中的属性注入到连接中。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T07:23:17.420

如果您希望本地化您的 NHibernate 查询，请查看[此](http://ayende.com/Blog/archive/2006/12/26/LocalizingNHibernateContextualParameters.aspx).

# iphone - 同时发送 NSURLConnection 请求

> ID：724456
> 
> 赞同：3
> 
> 时间：2009-04-07T07:16:47.060
> 
> 标签：iphone, objective-c, cocoa, http

是否可以使用 NSURLConnection 同时向同一服务器发出两个请求？

我正在尝试这样做，看起来第二个请求在第一个请求完成之前不会开始。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T10:29:56.270

如果你使用 NSURLConnection 的同步版本

```
+ (NSData *)sendSynchronousRequest:(NSURLRequest *)request returningResponse:(NSURLResponse **)response error:(NSError **)error 
```

你需要启动两个线程来获得你想要的行为，你可以这样做我在自己的方法中移动下载并调用它：

```
- (void)performSelectorInBackground:(SEL)aSelector withObject:(id)arg 
```

另一种方法是使用 NSURLConnection 的异步版本，[请参阅文档](http://developer.apple.com/documentation/Cocoa/Conceptual/URLLoadingSystem/Tasks/UsingNSURLConnection.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-10-30T09:32:17.777

如果 cookie 存在，第二个请求似乎正在等待第一个请求。我相信在第二个请求中发送实际的 cookie 已经完成，因为它们可以在第一个请求的响应中进行修改。

您可以通过将属性 HTTPShouldHandleCookies 设置为 NO 来关闭对 ​​cookie 的处理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T08:54:23.020

您需要创建两个 NSURLConnection 对象。

# c++ - 编译时如何检查 TR1？

> ID：724465
> 
> 赞同：5
> 
> 时间：2009-04-07T07:19:34.307
> 
> 标签：c++, dictionary, unordered-map, tr1

我们正在编写一个将自身保存在 .hpp 文件中的日志库。我们希望包括`<tr1/unordered_map>`（如果编译器支持 TR1）或其他标准`<map>`。是否有标准方法在编译时检查 tr1 是否可用？

我在想，就像“ `__cplusplus`”定义符号的存在方式一样，也可以定义一个“ `__cxx__tr1`”或类似的东西。我在 TR1 的草稿中没有看到它，所以我认为它不存在，但我想先问一下以防万一。

作为说明，如果这些定义不存在，那么将它们包含在提案本身中并不是一个坏主意。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T07:31:58.473

GCC-4.3 有：

```
#define __GXX_EXPERIMENTAL_CXX0X__ 1 
```

但是，这显然不是标准的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T07:55:20.213

如果您使用任何配置工具，例如 autotools，您可以尝试编写如下测试：

```
AC_CHECK_HEADER(tr1/unordered_map,[AC_DEFINE([HAVE_TR1],[],["Have tr1"])],[])
AC_CHECK_HEADER(unordered_map,[AC_DEFINE([HAVE_CXX0X],[],["Have C++0x"])],[]) 
```

然后在您的代码中使用这些定义。

一般来说`__cplusplus`宏应该给你标准的版本号，但是没有编译器可以给你100%的标准实现......因此编写配置宏。

`#ifdef`不幸的是，除非您想为每个编译器编写 1001（boost 的作用），否则这只是检查此类事情的非常可靠的方法

进而：

```
#include "config.h"
#ifdef  HAVE_CXX0X
#  include <unordered_map>
   typedef std::unordered_map<foo,bar> my_map;
#elif HAVE_TR1
#  include <tr1/unordered_map>
   typedef std::tr1::unordered_map<foo,bar> my_map;
#else
#  include <map>
   typedef std::map<foo,bar> my_map;
#endif 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T11:38:41.470

请参阅 ISO C++ (WG21) 论文[N1575](http://std.dkuug.dk/jtc1/sc22/wg21/docs/papers/2004/n1575.html)。这篇论文已从 TR1 中删除，没有替换。所以没有官方的方法来检测TR1。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T07:48:53.677

我处理的一个库需要使用一些从 Boost 添加到 TR1 的类，如果可用的话，更喜欢 TR1。解决方案（作为基于 Unix 的库）是将检查推送到配置脚本中。

换句话说，不，我所知道的没有任何便携性。也就是说，如果你在 Unix 上，配置脚本检查工作得很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-14T15:36:33.350

假设一个人正在使用 VS2010，或者任何有 TR1 可用的套件，如果有人这样做会发生什么

```
#include "boost/tr1/unordered_map.hpp"
...
std::tr1::unordered_map< ... > uMap; 
```

是什么类型的`uMap`？

# delphi - 为什么 TADOBlobField.Savetofile 只写 8 个字节

> ID：724468
> 
> 赞同：0
> 
> 时间：2009-04-07T07:19:51.797
> 
> 标签：delphi, adodb

我最近重新访问了一个工作应用程序。

我将文件存储在 MSSQL 数据库的文本字段中。我将它读入 ADOTable 并作为 TBlobfield 调用 Savetofile 将其写入磁盘上的文件。这一直有效。但是现在它只是保存一个 8 字节的文件而不是正确的文件。

我对以前发生过这种情况有一个模糊的记忆，想知道是否有人遇到过它并知道解决方案？我正在使用德尔福 7。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T02:35:57.797

数据库中是否有任何变化（服务器/版本升级）？客户端机器（XP？Vista？）？调用 SaveToFile 方法时保存的是什么（可能文件只有 8 个字节）？该字段可以为空/空吗？

我建议不要针对基于集合的 RDBMS（MSSQL、Oracle 等）使用基于表的组件（TTable、TADOTable 等），使用 TADODataSet 并确保应用了所有 D7/ADO 补丁。

祝你好运

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T08:18:33.557

几年前（旧版本的 ado），如果 blob 字段不是查询中的最后一个字段，就会出现问题。我不知道这仍然是真的

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-18T13:16:02.387

这个问题是我没有应用 Delphi 7 Update 1 直接导致的。

这是 Delphi 7 发布版本中的一个已知错误。

# verilog - 使用 DPI 将任务导出到“C”

> ID：724476
> 
> 赞同：6
> 
> 时间：2009-04-07T07:22:40.743
> 
> 标签：verilog, hardware, system-verilog, verification, system-verilog-dpi

我有一个基于 verilog 的测试平台，使用 DPI 连接到'C 源代码。现在使用 DPI，我打算编写我的整个固件。为此，我需要三件事

*   注册读取
*   寄存器写
*   中断处理程序 据我了解，寄存器读取和写入是我需要从 RTL 测试台导出的任务。和中断处理程序（我通过从'C导入一个函数来实现）。

我检查了大多数 cadence 文档，没有发现任何有用的提示。我也注册了 cadence 用户社区，但在他们批准我的注册之前，我似乎无法提问。

万一有人知道这一点，将不胜感激他们的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-08T01:48:46.387

实际上我想出了这样的事情。

```
//--From RTL ---
export "DPI" task reg_read;

task reg_read;
   input int nAddr;
   output int nVal;

 // -- read implementation --

endtask

// -- From C code
extern void reg_read (int nAddr, int *pVal);

void test_read (void)
{
   int nRegVal;

   // Dummy checking !!
   reg_read (0x100, &nRegVal);
}

// -- Again in RTL --
import "DPI" context task test_read (); 
```

这适用于我使用 ncverilog。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-21T21:09:51.010

酷......我实际上写了一篇关于这个主题的文章。 [关联](http://www.icjournal.com/articles/2008/20080826_lsi.htm)

该论文实际上是通过 DPI 导出寄存器读取和写入等内容，然后向其中添加 TCL 解释器，以便您可以使用 TCL 来控制您的 sim。这是实验室人员喜欢的东西，因为他们所有的工具都已经在 Tcl 中了。

您可以按照说明在 DPI 上集成从 C 到 SV 的函数调用，然后在 TCL 的东西开始发挥作用时停止。

# c# - 有机会使用 Linq (C#) 获得唯一记录吗？

> ID：724479
> 
> 赞同：3
> 
> 时间：2009-04-07T07:23:27.980
> 
> 标签：c#, linq, unique

我有一个`list<list<string>>`

in`list[x][0]`是我想从中选择唯一记录的记录，因此此类记录不会出现在任何其他记录中`list[x][0`]，当我选择它时，我希望选择整行`list[x]`。我在 Linq 中没有找到合适的例子，请帮助:(

**编辑**

当 Jon Skeet 要求我澄清时，我不能否认 ;-)

```
list<list<string>> 
```

包含字符串表列表。每个字符串“table”都包含几个键`list[x][several_items]`，我想从 list-> 中获取唯一记录，这意味着该“table”中的第一个项目。

因此：

```
item[0] = "2","3","1","3"
item[1] = "2","3","4","2"
item[3] = "10","2"
item[4]= "1","2" 
```

-> 唯一意味着我可以将行派生`item[3] and item[4]`为唯一的。因为数字/字符串的第一次出现很重要。

如果有 2 个或更多记录/行 (`item[x] of which first item (item[x][0])`在列表中存在多次，则它不是唯一的。

每个列表的第一个元素对于确定唯一性很重要。如果有人可以帮助找到一种方法来找到非唯一的，也许会更容易 -> 所以从上面的例子中，我只会得到 item[0] 和 item[1]

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-07T07:28:22.540

编辑：我已经更新了`UniqueBy`底部的实现以显着提高效率，并且只遍历源一次。

如果我对您的理解正确（问题很不清楚-如果您能提供一个示例，这将非常有帮助），这就是您想要的：

```
public static IEnumerable<T> OnlyUnique<T>(this IEnumerable<T> source)
{
    // No error checking :)

    HashSet<T> toReturn = new HashSet<T>();
    HashSet<T> seen = new HashSet<T>();

    foreach (T element in source)
    {
        if (seen.Add(element))
        {
            toReturn.Add(element);
        }
        else
        {
            toReturn.Remove(element);
        }
    }
    // yield to get deferred execution
    foreach (T element in toReturn)
    {
        yield return element;
    }
} 
```

编辑：好的，如果您只关心列表的第一个元素的唯一性，我们需要对其进行一些更改：

```
public static IEnumerable<TElement> UniqueBy<TElement, TKey>
    (this IEnumerable<TElement> source,
     Func<TElement, TKey> keySelector)
{
    var results = new LinkedList<TElement>();
    // If we've seen a key 0 times, it won't be in here.
    // If we've seen it once, it will be in as a node.
    // If we've seen it more than once, it will be in as null.
    var nodeMap = new Dictionary<TKey, LinkedListNode<TElement>>();

    foreach (TElement element in source)
    {
        TKey key = keySelector(element);
        LinkedListNode<TElement> currentNode;

        if (nodeMap.TryGetValue(key, out currentNode))
        {
            // Seen it before. Remove if non-null
            if (currentNode != null)
            {
                results.Remove(currentNode);
                nodeMap[key] = null;
            }
            // Otherwise no action needed
        }
        else
        {
            LinkedListNode<TElement> node = results.AddLast(element);
            nodeMap[key] = node;
        }
    }
    foreach (TElement element in results)
    {
        yield return element;
    }
} 
```

你可以这样称呼它：

```
list.UniqueBy(row => row[0]) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T07:37:00.100

大概是这样的吧？

鉴于您的澄清，我现在相当确定这对您有用:)

```
var mylist = new List<List<string>>() {
    new List<string>() { "a", "b", "c" },
    new List<string>() { "a", "d", "f" },
    new List<string>() { "d", "asd" },
    new List<string>() { "e", "asdf", "fgg" }
};
var unique = mylist.Where(t => mylist.Count(s => s[0] == t[0]) == 1); 
```

`unique`现在包含上面的“d”和“e”条目。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-13T14:15:26.667

这是您需要的代码。仅选择不同的值对我来说非常有效。

```
//distinct select in LINQ to SQL with Northwind
var myquery = from user in northwindDC.Employees
              where user.FirstName != null || user.FirstName != ""
              orderby user.FirstName
              group user by user.FirstName into FN
              select FN.First(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T12:46:22.010

这是给你的一些Linq。

```
List<List<string>> Records = GetRecords();
//
List<List<string> UniqueRecords = Records
  .GroupBy(r => r[0])
  .Where(g => !g.Skip(1).Any())
  .Select(g => g.Single())
  .ToList(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T07:38:48.287

您可以维护一个列表和一个索引/[字典](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)：

```
List<List<string>> values;
Dictionary<string, List<string>> index; 
```

将项目添加到值时，还会将列表添加到索引中，并将字符串作为索引。

```
values[x].Add(newString);
index[newString] = values[x]; 
```

然后您可以通过以下方式获得正确的列表：

```
List<string> list = index[searchFor] 
```

在构建索引时会损失一些（最小的）性能和内存，但在检索数据时会获得很多。

如果字符串不是唯一的，您还可以将 List> 存储在[字典](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)/index 中，以允许每个索引键有多个结果。

抱歉，没有 Linq，这看起来不太酷，但是您可以快速查找，并且恕我直言，查找代码更清晰。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T07:50:09.007

我会继续将这个添加到战斗中。

```
using System;
using System.Collections.Generic;
using System.Linq;

namespace ConsoleApplication1 {
    class Program {
        static void Main(string[] args) {
            List<string> xx = new List<string>() { "xx", "yy", "zz" };
            List<string> yy = new List<string>() { "11", "22", "33" };
            List<string> zz = new List<string>() { "aa", "bb", "cc" };
            List<List<string>> x = new List<List<string>>() { xx, yy, zz, xx, yy, zz, xx, yy };
            foreach(List<string> list in x.Distinct()) {
                foreach(string s in list) {
                    Console.WriteLine(s);
                }
            }
        }
    }
} 
```

# javascript - 在 chrome 和 safari 中附加 onload 事件时 window.open 不起作用

> ID：724484
> 
> 赞同：0
> 
> 时间：2009-04-07T07:24:36.917
> 
> 标签：javascript, safari, google-chrome, window, cross-browser

如果满足特定条件，我想在加载时打开一个新窗口在所有其他条件下都可以正常工作，但在 Chrome 和 Safari 中没有打开窗口，有人请找到一种方法来做到这一点

**复制：** [window.open 在 chrome 和 safari 中附加 onload 事件时不起作用](https://stackoverflow.com/questions/724355/window-open-not-working-when-attached-on-onload-event-in-chrome-and-safari)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T07:29:08.277

默认情况下，Safari 和 Chrome 都会阻止加载时打开的弹出窗口。您可以在首选项中关闭弹出窗口阻止，或者您可以尝试使用模式窗口。

# perl - 为什么我的 Parse::RecDescent 会给我所有这些警告和错误？

> ID：724495
> 
> 赞同：1
> 
> 时间：2009-04-07T07:29:56.263
> 
> 标签：perl, parsing, parse-recdescent

对下面的 Perl 文件解析代码 [最后回复 PM @ [http://www.perlmonks.org/index.pl?node_id=754947]](http://www.perlmonks.org/index.pl?node_id=754947])感到很痛苦：

```
#!/usr/bin/perl -w

use strict;
use warnings;
#use diagnostics;

use Parse::RecDescent;
use Data::Dumper;

# Enable warnings within the Parse::RecDescent module.

$::RD_ERRORS = 1; # Make sure the parser dies when it encounters an error
$::RD_WARN   = 1; # Enable warnings. This will warn on unused rules &c.
$::RD_HINT   = 1; # Give out hints to help fix problems.
#$::RD_TRACE  = 1; # Trace of parser

#$::AUTOSTUB = 1;

my $grammar = <<'_EOGRAMMAR_';

{
    use strict;
    use warnings;
}
#{ our $errortext = ''; our $errorprefix = '';}
RECORDSTART : /^(RECORD)[\r\n]+/
{
    #print "\n[*] RECORDSTART -> " . $item[1];
    $1;
    #$item[1];
} 

RECORDEND : /^(\.)[\r\n]*/
#/\./
{
    #print "\n[*] RECORDEND -> " . $item[1] . "\n";
    $1;
    #$item[1];
} 

fieldName : /[^ \t\n]+/
{
    #print "\n[*] fieldName -> $item[1]\n";
    $item[1];
}

metaName : /[^ \t\n]+\n?/
{
    $item[1];
}

metaFieldValue: /([^\n]*)\n/
{
    $1;
}

fieldValue : /([^\n]*)\n/
{
    #print "[*] fieldValue -> $item[1] ($1)\n";
    $1;
}

field : /^F/ fieldName fieldValue
{
    #print "[*] Got field named \'" . $item{ fieldName } . '\' with value \'' . $item{ fieldValue } . "\'\n";
    #print "[*] Got metafield named \'" . $item[2] . '\' with value \'' . $item[3] . "\'\n";
    #print Data::Dumper->Dump([$text], ["fieldStuff"]);
    $return = { fieldName => $item[2], fieldValue => $item[3]};
}

metaField : /^\#/ metaName metaFieldValue
{
    #print "[*] Got metafield named \'" . $item{ metaName } . '\' with value \'' . $item{ metaFieldValue } . "\'\n";
    #print "[*] Got metafield named \'" . $item[2] . '\' with value \'' . $item[3] . "\'\n";
    $return = { metaName => $item[2], metaFieldValue => $item[3]};
}

recordBody : field(s)
{
    print "\n[*] field(s)\n";
    #print main::Dumper \@item;
    #print Data::Dumper->Dump([@item], ["field(s)"]);
    $return = 'field(s)';
    #if((length($text) > 3) && (0 == @item))
    if(length($text) > 2)
    {
        $return = undef;
    }
}
|
metaField(s)
{
    print "\n[*] metaField(s)\n";
    #print main::Dumper \@item;
    #print Data::Dumper->Dump([@item], ["metaField(s)"]);
    $return = 'metaField(s)';
    #if((length($text) > 3) && (0 == @item))
    if(length($text) > 2)
    {
        $return = undef;
    }
}
|
<error>
#<error: I am confused in recordBody at $thisoffset!>

#startOfRecord: RECORDSTART recordBody(s /$/) RECORDEND
startOfRecord: RECORDSTART recordBody RECORDEND
#startOfRecord: RECORDSTART ( metaField(s) field(s) ) RECORDEND
#startOfRecord: RECORDSTART ( field(s) metaField(s) ) RECORDEND
{
    #print main::Dumper \@item;
    $return = 'something';
    #$return = $item[1];
    1;
}
|
#<error>
<error: I could not even parse a line line starting at $thisoffset!>
_EOGRAMMAR_

#$skeletonPattern = "#input_type[ \t]*";
#my $metaFieldPattern = qr/[ \t]*#([^ \t]+)[ \t]+(.*)/o; # "#input_type SCDR+", "#filename processed_01_20080616001403.cdr", etc
#my $normalFieldPattern = qr/([ \t]*)([0-9]*)F[ \t]+([^ \t]+)[ \t]+([^ \t\r\n]+)(.*)/; # "1F S_Diagnostic1 62" OR " F S_Diagnostic1 62" OR " F S_Diagnostic1 62" are synonymous, etc

my $testData0 = <<'_EOGTESTA_';
RECORD
F ptc_record_length 00B6
F ptc_charging_start_time 20090604093721
F ptc_charging_end_time 20080604093721
F ptc_called_msrn_ton FF
F ptc_term_mcz_duration 060000
.
_EOGTESTA_

my $testData1 = <<'_EOGTESTA_';
RECORD
#input_id 91210758171x001_0013
#input_type PTC
#output_type MTC
#source_id 01
#filename TTFILE01-0001-20080101000000
#jingalama valuewith#inIt andaSpace
.
_EOGTESTA_

my $testData2 = <<'_EOGTESTA_';
RECORD
F ptc_record_length 00B6
F ptc_charging_start_time 20090604093721
F ptc_charging_end_time 20080604093721
F ptc_called_msrn_ton FF
F ptc_term_mcz_duration 060000
#input_id 91210758171x001_0013
#input_type PTC
#output_type MTC
#source_id 01
#filename TTFILE01-0001-20080101000000
#jingalama valuewith#inIt andaSpace
.
_EOGTESTA_

my $testData3 = <<'_EOGTESTA_';
RECORD
#input_id 91210758171x001_0013
#input_type PTC
#output_type MTC
#source_id 01
#filename TTFILE01-0001-20080101000000
#jingalama valuewith#inIt andaSpace
F ptc_record_length 00B6
F ptc_charging_start_time 20090604093721
F ptc_charging_end_time 20080604093721
F ptc_called_msrn_ton FF
F ptc_term_mcz_duration 060000
.
_EOGTESTA_

my $testData4 = <<'_EOGTESTA_';
RECORD
#input_id 91210758171x001_0013
#output_id 
#input_type PTC
#output_type PTC
#addkey 
#source_id 01
#filename TTFILE01-0001-20080101000000
F ptc_record_length 00B6
F ptc_record_type
F ptc_charging_start_time 20090604093721
F ptc_charging_end_time 20080604093721
F ptc_called_msrn_ton FF
F ptc_term_mcz_duration 060000
F ptc_term_mcz_change_direction 
.
_EOGTESTA_

my $parser = Parse::RecDescent->new($grammar) or die "Bad grammar!\n";;

print $testData0, "\n\n";
$parser->startOfRecord($testData0) ? print "Parsing done sucessfully!\n" : print "Bad input!\n";

print $testData1, "\n\n";
$parser->startOfRecord($testData1) ? print "Parsing done sucessfully!\n" : print "Bad input!\n";

print $testData2, "\n\n";
$parser->startOfRecord($testData2) ? print "Parsing done sucessfully!\n" : print "Bad input!\n";

print $testData3, "\n\n";
$parser->startOfRecord($testData3) ? print "Parsing done sucessfully!\n" : print "Bad input!\n";

print $testData4, "\n\n";
$parser->startOfRecord($testData4) ? print "Parsing done sucessfully!\n" : print "Bad input!\n";

#$parser->startOfRecord($testData) ? print "Parsing done sucessfully!" : die "Bad input!\n"; 
```

输出：

```
记录
F ptc_record_length 00B6
F ptc_charge_start_time 20090604093721
F ptc_charge_end_time 20080604093721
F ptc_called_msrn_ton FF
F ptc_term_mcz_duration 060000
.

[*] 字段
解析成功！
记录
#input_id 91210758171x001_0013
#input_type PTC
#output_type MTC
#source_id 01
#文件名 TTFILE01-0001-20080101000000
#jingalama valuewith#inIt andaSpace
.

[*] 元字段
解析成功！
记录
F ptc_record_length 00B6
F ptc_charge_start_time 20090604093721
F ptc_charge_end_time 20080604093721
F ptc_called_msrn_ton FF
F ptc_term_mcz_duration 060000
#input_id 91210758171x001_0013
#input_type PTC
#output_type MTC
#source_id 01
#文件名 TTFILE01-0001-20080101000000
#jingalama valuewith#inIt andaSpace
.

[*] 字段
输入错误！
记录
#input_id 91210758171x001_0013
#input_type PTC
#output_type MTC
#source_id 01
#文件名 TTFILE01-0001-20080101000000
#jingalama valuewith#inIt andaSpace
F ptc_record_length 00B6
F ptc_charge_start_time 20090604093721
F ptc_charge_end_time 20080604093721
F ptc_called_msrn_ton FF
F ptc_term_mcz_duration 060000
.

[*] 元字段
输入错误！
记录
#input_id 91210758171x001_0013
#output_id
#input_type PTC
#output_type PTC
#addkey
#source_id 01
#文件名 TTFILE01-0001-20080101000000
F ptc_record_length 00B6
F ptc_record_type
F ptc_charge_start_time 20090604093721
F ptc_charge_end_time 20080604093721
F ptc_called_msrn_ton FF
F ptc_term_mcz_duration 060000
F ptc_term_mcz_change_direction
.

[*] 元字段
输入错误！

```

这是标准错误：

```
print() 在 C:/laPerl/site/lib/Parse/RecDescent.pm 第 2905 行关闭文件句柄错误。
变量“$errortext”在 C:/laPerl/site/lib/Parse/RecDescent.pm 第 2906 行不可用。
变量“$errorprefix”在 C:/laPerl/site/lib/Parse/RecDescent.pm 第 2906 行不可用。
在 C:/laPerl/site/lib/Parse/RecDescent.pm 第 2850 行的 formline 中使用未初始化的值 $errorprefix。
在 C:/laPerl/site/lib/Parse/RecDescent.pm 第 2850 行的 formline 中使用未初始化的值 $errortext。
在 C:/laPerl/site/lib/Parse/RecDescent.pm 第 2852 行的 formline 中使用未初始化的值 $errortext。
在 C:/laPerl/site/lib/Parse/RecDescent.pm 第 2906 行关闭文件句柄错误上的 write()。
...

```

有什么建议么？我真的很困惑吗？

谁能弄清楚出了什么问题（ActivePerl 5.10 和 WinXP SP2 的选择除外）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T08:25:53.930

我认为在 XP 上选择 ActivePerl 很好；唯一的问题是语法。

您的 recordBody 语法规则说内部只能有多个字段或多个元字段，而两者之间不能有任何内容。

如果您需要任何字段/元字段的组合，我建议您创建一些人工规则 anyField

```
anyField : field | metaField

recordBody : anyField(s) 
```

# ruby - 轻松备份长时间运行的 ruby 进程

> ID：724499
> 
> 赞同：3
> 
> 时间：2009-04-07T07:32:56.193
> 
> 标签：ruby

我计划运行一个可能需要一个月才能完成的 ruby​​ 进程。如果可能的话，我想确保停电或按错按钮不会花费我整个月的工作。

有没有一种简单的方法可以定期将程序的状态保存到磁盘？（涉及更多工作的技术将包括添加代码来编组除数据库之外的所有内容，或者可能为进程的操作系统使用虚拟机）

（对于那些感兴趣的人：该过程涉及解析一个知名网站的数 GB 的 XML 文件，处理一些信息，并将信息保存到 ActiveRecord 数据库中。两次。）

**编辑**：项目是[这个](http://github.com/agrimm/philosophy-dump-parser/tree/master)，XML 文件是 pages-articles.xml（例如 enwiki-20090306-pages-articles.xml）。没有什么专有的，我只是不想处于“Plz halp”模式。第一遍获取维基百科页面标题列表，下一遍确定从每个页面到另一个页面的第一个链接，然后我计算一些统计数据。

正如一些回答者所建议的，从我离开的地方继续，可能是一个有效的选择。如果它在第一次通过时崩溃，那么我可能可以重新运行它，告诉它不要添加已经存在的条目。如果它在第二次通过时崩溃，那么我应该只要求它为尚未计算链接的页面建立链接。如果它在计算统计数据时崩溃，我可以重新计算统计数据。

**另一个编辑**：这个问题的更通用版本在[保存进程的内存供以后使用？](https://stackoverflow.com/questions/712876/save-a-process-memory-for-later-use). 看起来您无法轻松备份长时间运行的进程。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T08:11:48.503

我想不出一个超级简单的方法来做到这一点，但如果你愿意修改你的代码，你可能会从 YAML（一个易于使用的标记库[。yaml.org](http://www.yaml.org/)）。导入 YAML 库会为每个对象提供一个 .to_yml 函数，该函数将序列化整个对象，因此可以将其保存到文件中，也可以从 yml 中恢复对象。因此，这需要添加一些代码来定期保存，但实际的保存位可能相对容易。此外，yaml 是内置的，因此无需下载。

```
需要“yaml”
def 备份（objects_im_Using）
  out_file = File.open("前缀"+Time.now.strftime('%Y-%M-%d')+".yml","w")
  objects_im_Using.each {|object| out_file
```

（尽管我认为真正的红宝石方法是让备份功能产生一个块或类似的东西。）

抱歉，我想不出更好的方法。我有兴趣阅读对这个问题的更好回答！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T08:23:26.400

从上周末我的工作机器意外断电（大楼其他地方的施工）的角度来看，我对这个想法表示同情。

划分任务有什么价值吗？输入文件可以重新加工成许多更小的文件吗？

我知道，要小几个数量级，但我有一个流程，每天早上在几个 AR 模型中加载大约 200 万行。为了解决我遭受的令人震惊的数据库延迟问题（数据库服务器在不同的国家 - 不要问），我将输入的 CSV 文件分别重写为 16 个“片段”。每个片段都记录在片段模型中，这有助于我识别任何完成失败以重新运行。它工作得非常好，并且在需要时重新启动很简单。通常运行时间约30分钟。

如果您的 XML 输入结构合理，那么将子结构（我相信有比这更好的术语）提取到单独的文件中应该相当简单。我不知道 SAX 解析器能做到这一点有多快——可能不会太可怕，但如果它仍然太慢的话，完全可以在没有 XML 库的情况下完成。考虑向目标模型添加一列以识别从中加载它的片段 - 这样去除不完整的运行很简单。

除此之外，考虑将所有状态保持在一个类中并使用 Marshal 定期保存？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T17:37:29.907

它会随着它的进行保存到数据库中，但是从您的问题来看，您似乎无法仅凭该数据继续离开的地方。

那么内存中是否有数据可以保存在临时表或临时列中，让您从中断的地方继续？也许您不需要整个状态-也许数据的一个子集可以让您重新创建电源关闭的点（或其他）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T23:28:15.287

好的。现在我们知道的更多了，我认为整个问题可能没有实际意义。我猜，从耶稣受难日的一个小玩笑中，你应该能够在几个小时内提取你需要的数据。

你可能需要几天的时间来设置自己，弄清楚你需要存储什么，如何存储它以及当你拥有它时如何处理它，但无论如何这都是有趣的部分。

以下是我认为您可以解决问题的方法。

你知道文件结构。这是一个大的（说实话，大得令人难以置信）XML 文件；我看到大约 21GB。虽然结构很简单。您需要`<page>`元素，您需要从中提取一些基本信息：标题、文本（或至少其中的链接），也许还有 id。这是一个非常简单的解析工作——不需要 XML 库或诸如此类的东西，一个简单的字符串匹配算法就足够了。对于标题，使用 String#index 查找打开和关闭标签并提取其间的位。对于文本中的第一个链接，它有点棘手，因为您必须根据规则确定第一个真正的链接。

将 21GB 的文本读入内存是一个不错的技巧，但您当然不必这样做：您只需要一个有用大小的块即可。一兆字节似乎是合理的。或者可能是 10K。这没什么大不了的——砍掉一个 GB 左右来做实验。

我有一个脚本，它每分钟提取并写入一个文本文件大约 250,000 个标题/第一个链接对。它忽略“重定向”页面（因此它正在处理更多页面）并忽略带有“：”的链接（到目前为止还不够聪明，但我想在那里进行一些处理）。没有正则表达式，见鬼，没有要求。大约 30 行不是很简洁的代码。它找到了大约 523 万个标题（我认为还有更多非必需的标题：文件、项目等等），并在大约 20 分钟内编写了一个更集中、更易于管理的 1.03GB 输出（见下文）。Ruby (MRI) 1.8.6，Windows Vista，2GHz Core 2 Duo。他们说Ruby很慢。

前 3 行：

```
Anarchism, [[political philosophy]]
Autism, [[Neurodevelopmental disorder|brain development disorder]]
Albedo, [[Sun]] 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-02T23:36:59.447

在[保存进程的内存供以后使用？](https://stackoverflow.com/questions/712876/save-a-process-memory-for-later-use). 看起来您无法轻松备份长时间运行的进程。

# unit-testing - 你如何从 Rhino.Commons 模拟 UnitOfWork？

> ID：724500
> 
> 赞同：3
> 
> 时间：2009-04-07T07:32:56.367
> 
> 标签：unit-testing, nhibernate, rhino-mocks, repository, rhino-commons

我的应用程序正在使用 Rhino.Commons - NHRepository 和 UnitOfWork。我喜欢交易的 With.Transaction() 语法并且已经使用了一段时间。

但是我遇到了一个问题——如何模拟 UnitOfWork 进行测试？特别是这给我带来了麻烦：

```
With.Transaction(() => Repositories.TwinfieldSpooler.Update(spool)); 
```

我可以用 Rhino.Mocks 模拟存储库，但是我怎样才能轻松地模拟 UnitOfWork 来处理这种代码呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-20T06:10:18.237

With.Transaction 使用 UnitOfWork.Current 属性。UnitOfWork 是一个静态类——你不能用 RhinoMocks 模拟它。

UnitOfWork.Current 是一个公共静态属性，因此您可以将其换掉。不幸的是，setter 是内部的。

我为您看到 3 个选项：

*   修改 Rhino.Commons 源，使 UnitOfWork.Current 设置器公开，并在您的单元测试中设置它。

*   使用反射将 UnitOfWork.Current 设置为您的假工作单元。

*   由于 UnitOfWork.Current 在内部使用 Local.Data 来查找当前事务，您应该可以去：

    Rhino.Commons.Local.Data[UnitOfWork.CurrentUnitOfWorkKey] = myFakeUnitOfWork;

好消息是 UnitOfWork.Current 是一个 IUnitOfWork，RhinoMocks 可以轻松伪造接口。

最后我必须说，我对 Rhino.Commons 不是很熟悉，所以 Ayende 可能已经建立了一种伪造 UnitOfWork 的正确方法。如果这对您来说非常重要，您应该在 Rhino 讨论组中提问。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-12T16:28:51.990

我也有类似的需求，因为我想测试*围绕*持久性的逻辑，而不需要实际测试数据的持久性。`UnitOfWork`我发现我可以在我的测试的 SetUp 部分中轻松地使用这两行来模拟/存根：

```
IUnitOfWork theStubUnitOfWork = MockRepository.GenerateStub<IUnitOfWork>();
UnitOfWork.RegisterGlobalUnitOfWork(theStubUnitOfWork); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-03T18:15:49.353

谢谢，但我实际上决定忽略对 Rhino 基础设施的模拟。我发现 Ayende 的这篇文章[http://ayende.com/Blog/archive/2009/04/28/nhibernate-unit-testing.aspx](http://ayende.com/Blog/archive/2009/04/28/nhibernate-unit-testing.aspx)关于使用每次测试都重建的 sqlite 数据库。这是一个很好的解决方案！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-09T01:25:53.520

为其他人提供一点额外的信息：Ogre Psalm33 提到了如何存根 UnitOfWork，但如果你也希望 With.Transaction 工作，你可以另外存根 RhinoTransaction：

```
IUnitOfWork stubUnitOfWork = MockRepository.GenerateStub<IUnitOfWork>();
RhinoTransaction stubTx = MockRepository.GenerateStub<RhinoTransaction>();
stubUnitOfWork.Expect(x => x.BeginTransaction(System.Data.IsolationLevel.Unspecified)).IgnoreArguments().Return(stubTx);
UnitOfWork.RegisterGlobalUnitOfWork(stubUnitOfWork); 
```

我记得在某处看到 Ayende 的一张便条，他通常只将 With.Transaction 作为最后的手段，当他无法使用他喜欢的[Castle Automatic Transaction Management](http://www.castleproject.org/container/facilities/trunk/atm/index.html)时。

# c# - 如何在运行时分配数组值

> ID：724501
> 
> 赞同：16
> 
> 时间：2009-04-07T07:33:44.290
> 
> 标签：c#

考虑我有一个数组，

```
int[] i = {1,2,3,4,5}; 
```

在这里，我为它分配了值。但在我的问题中，我只在运行时获得这些值。如何将它们分配给数组。

例如：

我从用户那里获得了数组的最大大小以及现在如何将它们分配给数组 int []。

或者我可以使用任何其他数据类型，如 ArrayList 等，我可以在最后转换为 Int[] 吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-07T07:39:04.963

好吧，最简单的是使用`List<T>`：

```
List<int> list = new List<int>();
list.Add(1);
list.Add(2);
list.Add(3);
list.Add(4);
list.Add(5);
int[] arr = list.ToArray(); 
```

否则，您需要分配一个合适大小的数组，并通过索引器进行设置。

```
int[] arr = new int[5];
arr[0] = 1;
arr[1] = 2;
arr[2] = 3;
arr[3] = 4;
arr[4] = 5; 
```

如果您无法预测数组的大小，则第二种方法没有用，因为每次添加项目时重新分配数组的成本很高；a`List<T>`使用加倍策略来最小化所需的重新分配。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2015-05-07T15:13:31.487

你的意思是？

```
int[] array = { 1, 2, 3, 4, 5 };
array = new int[] { 1, 3, 5, 7, 9 };
array = new int[] { 100, 53, 25, 787, 39 };
array = new int[] { 100, 53, 25, 787, 39, 500 }; 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-07T07:38:49.613

使用`List<int>`然后`ToArray()`在最后调用它来创建一个数组。但是你*真的*需要一个数组吗？使用其他集合类型通常更容易。正如 Eric Lippert 所写，“[数组被认为有些有害](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)”。

你*可以*明确地做到这一点，就像这样：

```
using System;

public class Test
{
    static void Main()
    {
        int size = ReadInt32FromConsole("Please enter array size");

        int[] array = new int[size];
        for (int i=0; i < size; i++)
        {
            array[i] = ReadInt32FromConsole("Please enter element " + i);
        }

        Console.WriteLine("Finished:");
        foreach (int i in array)
        {
            Console.WriteLine(i);
        }
    }

    static int ReadInt32FromConsole(string message)
    {
        Console.Write(message);
        Console.Write(": ");
        string line = Console.ReadLine();
        // Include error checking in real code!
        return int.Parse(line);
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T07:39:28.487

如果你想要一个在执行过程中大小变化的数组，那么你应该使用另一个数据结构。一个通用的列表就可以了。然后，您可以向其中动态添加元素。

**编辑：**马克在我写我的时候发布了他的答案。这正是我的意思。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-10-12T15:33:37.240

您可以只使用以下行而不是调用单独的函数：

```
using System;

public class Test
{
    static void Main()
    {
        Console.WriteLine("Please enter array size");
        int size = Convert.ToInt32(Console.ReadLine());

        int[] array = new int[size];
        for (int i=0; i < size; i++)
        {
            Console.WriteLine("Please enter element " + i);
            array[i] = Convert.ToInt32(Console.ReadLine());
        }

        Console.WriteLine("Finished:");
        foreach (int i in array)
        {
            Console.WriteLine(i);
        }
    } 
```

# php - php 调整大小脚本不适用于透明 gif

> ID：724503
> 
> 赞同：3
> 
> 时间：2009-04-07T07:35:47.967
> 
> 标签：php, transparency, gd, gif

我怎样才能让它适用于透明的 gif 和 png？

```
function resizeImage($image,$newImage,$target_width,$target_height, $type="") {
    if (is_file($image)) {
        if($type == ".gif"){
            $image_org=@imagecreatefromgif($image);
        }else{
            $image_org=@imagecreatefromjpeg($image);
        }
        if ($image_org) {
            list($w,$h,$type,$attr) = getimagesize($image);
            $factor=C_Image_Custom::calcRescaleFactor($w,$h,$target_width,$target_height);

            if ($factor>1) {
                $image_w = $w / $factor;
                $image_h = $h / $factor;
            } else {
                $image_w = $w;
                $image_h = $h;
            }       

        //Note: PHP with GD2.0 required for imagecreatetruecolor
        $img_copy = imagecreatetruecolor($image_w, $image_h);
        imagecopyresampled($img_copy, $image_org, 0, 0, 0, 0, $image_w, $image_h, $w, $h);

            if (@imagejpeg($img_copy, $newImage, 80)) {
                chmod($newImage,0777);
            }   else {
                echo("<b>Error: </b>Unable to create image $newImage. Check directory permissions.");
            }   

          imagedestroy($image_org);
            imagedestroy($img_copy);
        }   
    } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-12T04:41:41.723

此功能非常适合我调整 jpg 和透明（或不透明）gif 的大小：

```
function resizeImage($originalImage, $toWidth, $toHeight, $isJPG)
{
    // Get the original geometry and calculate scales
    list($width, $height) = getimagesize($originalImage);
    $xscale = $width / $toWidth;
    $yscale = $height / $toHeight;

    // Recalculate new size with default ratio
    if ($yscale > $xscale) {
        $new_width = round($width * (1 / $yscale));
        $new_height = round($height * (1 / $yscale));
    } else {
        $new_width = round($width * (1 / $xscale));
        $new_height = round($height * (1 / $xscale));
    }

    // Resize the original image
    if ($isJPG) {
        $imageResized = imagecreatetruecolor($new_width, $new_height);
        $imageTmp = imagecreatefromjpeg($originalImage);
        imagecopyresampled($imageResized, $imageTmp, 0, 0, 0, 0, $new_width, $new_height, $width, $height);
    } else {
        //$imageResized = imagecreatetruecolor($new_width, $new_height);
        //$imageTmp = imagecreatefromgif ($originalImage);
        //imagecopyresampled($imageResized, $imageTmp, 0, 0, 0, 0, $new_width, $new_height, $width, $height);

        # what follows is for resizing a gif, transparent or not
        # http://ru2.php.net/imagecopyresampled
        # load/create images
        $imageTmp = imagecreatefromgif($originalImage);
        $imageResized = imagecreatetruecolor($new_width, $new_height);
        imagealphablending($imageResized, false);

        # get and reallocate transparency-color
        $transindex = imagecolortransparent($imageTmp);
        if ($transindex >= 0) {
            $transcol = imagecolorsforindex($imageTmp, $transindex);
            $transindex = imagecolorallocatealpha(
                $imageResized,
                $transcol['red'],
                $transcol['green'],
                $transcol['blue'],
                127
            );
            imagefill($imageResized, 0, 0, $transindex);
        }

        # resample
        imagecopyresampled($imageResized, $imageTmp, 0, 0, 0, 0, $new_width, $new_height, $width, $height);

        # restore transparency
        if ($transindex >= 0) {
            imagecolortransparent($imageResized, $transindex);
            for ($y = 0; $y < $new_height; ++$y) {
                for ($x = 0; $x < $new_width; ++$x) {
                    if (((imagecolorat($imageResized, $x, $y) >> 24) & 0x7F) >= 100) {
                        imagesetpixel(
                            $imageResized,
                            $x,
                            $y,
                            $transindex
                        );
                    }
                }
            }

        }
        # save GIF
        imagetruecolortopalette($imageResized, true, 255);
        imagesavealpha($imageResized, false);
    }
    return $imageResized;
} 
```

原始函数来自 PhpToys 1.0，与透明 .gifs 一起使用的部分来自[这个 PHP 文档注释](http://www.php.net/manual/en/function.imagecopyresampled.php#89987)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-02-21T17:25:24.150

我有同样的问题，透明度不适用于PNG，当它与PNG一起使用时，它只是不适用于GIF，我整天都在寻找解决方案，直到我找到这个功能“ [Maxim's，智能调整图像大小](https://github.com/maxim/smart_resize_image/blob/master/smart_resize_image.function.php)”

```
$info = getimagesize($file);

switch ( $info[2] ) {
    case IMAGETYPE_GIF: $image = imagecreatefromgif($file); break;
    case IMAGETYPE_JPEG: $image = imagecreatefromjpeg($file); break;
    case IMAGETYPE_PNG: $image = imagecreatefrompng($file); break;
    default: return false;
}

# This is the resizing/resampling/transparency-preserving magic
$image_resized = imagecreatetruecolor( $final_width, $final_height );

if ( ($info[2] == IMAGETYPE_GIF) || ($info[2] == IMAGETYPE_PNG) ) {
    $transparency = imagecolortransparent($image);
    if ($transparency >= 0) {

        $transparent_color = imagecolorsforindex($image, $trnprt_indx);
        $transparency = imagecolorallocate($image_resized, $trnprt_color['red'], $trnprt_color['green'], $trnprt_color['blue']);
        imagefill($image_resized, 0, 0, $transparency);
        imagecolortransparent($image_resized, $transparency);

    }
    elseif ($info[2] == IMAGETYPE_PNG) {

        imagealphablending($image_resized, false);
        $color = imagecolorallocatealpha($image_resized, 0, 0, 0, 127);
        imagefill($image_resized, 0, 0, $color);
        imagesavealpha($image_resized, true);

    }
}

imagecopyresampled($image_resized, $image, 0, 0, 0, 0, $final_width, $final_height, $width_old, $height_old); 
```

某些变量只有小错误，因此您必须按如下方式分配它们以消除 $trnprt_indx 和 $trnprt_color 的错误

```
$trnprt_color['red'] = 255;
$trnprt_color['green'] = 255;
$trnprt_color['blue'] = 255;
$trnprt_indx = 127; 
```

希望对你有帮助

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T08:40:52.317

It looks like you're only outputting to jpeg - which doesn't have transparency. If you want to output the transparency, you need to output a gif or png.

If you want to replace the transparency with a colour, I think you want the php function imagecolorallocatealpha

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T08:46:38.187

为什么只有jpeg？

这也适用于 gif：

```
if($type == ".gif"){
                    $image_org=@imagecreatefromgif($image);
            }else{
                    $image_org=@imagecreatefromjpeg($image);
            } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-03-26T10:52:47.327

这真的很老了，但万一其他人像我一样努力理解这里的解释对我有用：

```
<?php
$sourceImage = imagecreatefromgif('./enjoy.gif');

$newWidth = 220;
$newHeight = 120;

//Blank canvas
$destImage = imagecreatetruecolor($newWidth, $newHeight);

$transColorIndex = imagecolortransparent($sourceImage); 
// Returns the index of the transparent color: 119

$transRGBColor = imagecolorsforindex($sourceImage, $transColorIndex); 
//Returns the RGB of the index color: [red] => 255 [green] => 255 [blue] => 255 [alpha] => 127 
//In this case it's white but can be anaything

$transGdColor = imagecolorallocate($destImage, $transRGBColor['red'], $transRGBColor['green'], $transRGBColor['blue']); 
// Returns: 16777215   //A GD color identifier created with imagecolorallocate().

imagefill($destImage, 0, 0, $transGdColor);
//Fills the blank image with that color

imagecolortransparent($destImage, $transGdColor);
//Sets that color as transparent

//Resample
imagecopyresampled($destImage, $sourceImage, 0, 0, 0, 0, $newWidth, $newHeight, imagesx($sourceImage), imagesy($sourceImage));

header ( 'Content-type:image/gif' );
imagegif($destImage); 
```

# java - 模型视图同步（或避免同步）

> ID：724506
> 
> 赞同：0
> 
> 时间：2009-04-07T07:38:11.877
> 
> 标签：java, model-view-controller, design-patterns

给定软件系统的整体结构是模型视图控制器。视图（图形界面）是模型（域对象模型）的表示。

但是，在视图（图形界面）中有组件（例如 JTextComponent）。这些组件也被安排在模型视图控制器中。JTextComponent 使用[Document](http://java.sun.com/javase/6/docs/api/javax/swing/text/Document.html)作为其模型。

JTextComponent 旨在表示域对象模型的特定部分。但它的模型实际上是 Document 对象。

由 JTextComponent 描绘的这一信息既存储在 JTextComponent 文档中，也存储在域对象模型中。这种组织导致模型的这种信息被复制。因此这两个模型需要保持同步。违反 DRY。

是否有任何优雅的解决方案可以将 JTextComponent（或任何图形组件）绑定到域对象模型的一部分，所以数据真的只有一个地方吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T07:43:29.553

在您的`Document`对象模型中创建您自己的对象。

然后使用[**setDocument(d) 方法**](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/text/JTextComponent.html#setDocument(javax.swing.text.Document))。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T08:04:06.790

如果我理解正确，您将面临平行的收容层级。

```
enter code here
                   view  -----------------------> Model
                     |
                     v
                 TextArea------------------------>Document 
```

您担心的是模型中的数据也需要存在于文档中。解决这个问题的最优雅的方法是将文档从模型本身中移除，即使文档成为整个模型的窗口。

我认为尤瓦尔在暗示同样的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T17:17:28.567

这里发生了几件事。

Java 框架为您提供了一种更新 UI 的好方法，但限制您使用特定的结构 Document。

另一方面，您有一个充分的模型来代表您的数据。通过在您的模型中直接使用 Document，您还冒着将模型绑定到特定框架的风险。这不是一个好主意。

Java Document 框架提供了监听变化的能力，你可以利用它在你的模型和 Document 之间创建一个[Adapter 类。](http://en.wikipedia.org/wiki/Adapter_pattern)基本上，当您设置表单时，您将创建适配器类的实例。您将使用您的模型进行初始化。适配器将具有返回文档的属性。此外，适配器会将自己注册为该文档模型的侦听器。适配器将足够聪明，知道如何将文档模型的机会转换为您的模型。

像这样

1.  UI 与 JTextDocument 一起创建。
2.  在创建过程中，它从视图中请求您的模型。
3.  它创建了一个适配器实例，用您的模型对其进行初始化。
4.  适配器还将自己设置为 Document 的侦听器。
5.  将文档分配给 JTextDocument 对象。
6.  与 Document 的任何交互都会报告给 Adapter
7.  适配器通知视图将翻译后的数据传回。
8.  视图改变了模型。
9.  视图通知适配器模型已更改。
10.  适配器将更改转换为对文档的更改。

因为适配器绑定到 Java 框架，所以应该尽可能靠近 UI。适配器可能会实现视图公开的接口，以便视图不必引用任何特定于您正在使用的框架的内容。当您更改框架时，您所要做的就是创建一个实现该接口的新对象，而 View 并不明智。

# nhibernate - 使用 NHibernate 生成 SQL 查询

> ID：724508
> 
> 赞同：1
> 
> 时间：2009-04-07T07:38:26.337
> 
> 标签：nhibernate, orm, data-access

NHibernate 为我们提供了 ORM 功能。NHibernate 的一部分基于映射和 HQL（或 ICriteria）生成查询。我想知道是否可以在不使用其 ORM 功能的情况下使用 NHibernate 生成针对数据库的查询。

我正在尝试为客户提供对其数据库的自定义访问权限。由于此类数据库的模式在设计时是未知的，因此需要根据客户的配置生成查询（包括通过 WHERE 子句进行过滤）。

有没有人有使用 NHibernate（或其他 ORM）查询能力来生成自定义 SQL 的经验？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T08:15:04.703

查看 hibernate 周围从 ddl 生成休眠类的工具，或者反过来，比如 hbm2ddl。

# windows - 如何接收ip多播，只使用一个网卡

> ID：724509
> 
> 赞同：1
> 
> 时间：2009-04-07T07:38:34.573
> 
> 标签：windows, network-programming, winsock, multicast

我有多个 NIC 的服务器，运行 windows server 2003。我的应用程序接收多播数据包，但现在我只需要从一个网络接口接收多播数据包。我认为这会有所帮助，但我有一些问题。

```
ip_mreq   mreq;

mreq.imr_multiaddr.s_addr = multicast group address
mreq.imr_interface.s_addr=  network interface address
if (setsockopt( socet
              , IPPROTO_IP
              , IP_ADD_MEMBERSHIP
              , (const void *)&mreq
              , sizeof(mreq)) < 0)
{
   std::cerr << "setsockopt error" << std::endl;
} 
```

首先，我需要使用什么作为网络接口地址？网络接口的本地地址（与 ipconfig 返回的相同）或网络接口的索引，我可以使用 GetAdaptersAddresses api 函数获得吗？

其次，这实际上可以在 Windows 上实现，还是我只是花时间？

**更新** 我刚刚阅读了有关 WSAJoinLeaf 功能的信息，我想知道，不可能只使用一个 NIC 进行多播。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T01:53:28.693

第一：你的选择。请参阅[http://msdn.microsoft.com/en-us/library/ms738695(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms738695(VS.85).aspx)

第二：是的，这绝对是可能的。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-06T05:18:04.410

是的，这可行，您可以将[GetAdaptersInfo](http://msdn.microsoft.com/en-us/library/aa365917(VS.85).aspx)用于仅 IPv4 接口，或将[GetAdaptersAddresses](http://msdn.microsoft.com/en-us/library/aa365915(VS.85).aspx)用于两个系列。

请注意，mreq 仅通过地址而不是索引指定接口，ip6_mreq 和[GROUP_REQ](http://msdn.microsoft.com/en-us/library/bb427440(VS.85).aspx)（与家族无关）版本更喜欢索引，因为 IPv6 允许您拥有多个匹配的链路本地地址，但可以连接到不同的网络。

# c# - LINQ 能够过滤关联，但直接引用时返回 0 结果

> ID：724514
> 
> 赞同：2
> 
> 时间：2009-04-07T07:39:33.010
> 
> 标签：c#, linq, entity-framework

我对我正在测试的声明有点困惑。我正在使用 LINQ to Entity

我在下面的代码中发表了评论。这是我不明白的最后一个 Console.WriteLine。我感谢任何人对此的意见

```
 using(Ecommerce.Data.Entities.EcommerceEntities ents = new Ecommerce.Data.Entities.EcommerceEntities())
        {
            //This returns 1 item as expected
            var items = from a in ents.Product
                        where a.ProductVarianceOption.Count() > 0
                        select a;

            foreach (var item in items)
            {
                //This outputs AT07 as expected
                Console.WriteLine(item.ProductCode);

                //This outputs 0 , but because I was able to query
                //only those which had a count greater than 0 above
                //I do not know why this is returning 0
                Console.WriteLine(item.ProductVarianceOption.Count());
            }

        } 
```

TIA

安德鲁

**更新：以防万一其他人遇到这种情况，感谢 Marc Gravell，这是解决方案。Marc Gravell 的评论敦促我找到 IsLoaded 属性以及 Load 方法。谢谢：**

```
 using(Ecommerce.Data.Entities.EcommerceEntities ents = new Ecommerce.Data.Entities.EcommerceEntities())
        {
            //This returns 1 item as expected
            var items = from a in ents.Product
                        where a.ProductVarianceOption.Count() > 0
                        select a;

            foreach (var item in items)
            {
                //This outputs AT07 as expected
                Console.WriteLine(item.ProductCode);

                //This outputs 0 , but because I was able to query
                //only those which had a value greater than 0 above
                //I do not know why this is returning 0
                Console.WriteLine(item.ProductVarianceOption.Count());

                //Load in the data required
                item.ProductVariance.Load();

                //Load in the data required
                item.ProductVarianceOption.Load();

                //This now outputs 2\. ... As Expected. Thanks to Marc Gravell. :-)
                Console.WriteLine(item.ProductVarianceOption.Count());
            }

        } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T07:42:45.767

使用实体框架，如果您已经物化了对象，那么您必须显式加载集合关联，然后才能看到内容。一种痛苦。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T11:43:01.740

您可能想看看[Entity Framework 的透明延迟加载](http://code.msdn.microsoft.com/EFLazyLoading)。这用新的代码生成器替换了原始代码生成器。新的生成实体来处理引擎盖下的加载。请注意，代码并不完美 - 存在一些问题。就我而言，最大的问题是数据绑定问题，但是您可以轻松添加修复程序，因为您获得了源代码。

# oracle - 有没有办法让 Oracle 为每个查询调用重新计算查询计划？

> ID：724516
> 
> 赞同：7
> 
> 时间：2009-04-07T07:40:27.533
> 
> 标签：oracle, sql-execution-plan

我有一个参数化查询。根据参数值，最佳查询计划会有很大差异。麻烦在于：Oracle 将第一次查询调用的计划用于后续调用，导致性能不佳。我通过动态 SQL 处理它，但这种方式远非优雅。那么问题来了：有没有办法告诉Oracle必须重新计算查询计划？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T07:58:57.817

如果查询计划确实在参数值上发生了显着变化，也许你不应该为这个参数使用绑定变量。

该参数可以取多少个不同的值？如果只有几个，您最终会得到几个查询计划（每个值一个），并且这些计划有望表现良好并且可以重复使用。

或者您可以在 SQL 语句中使用注释“/* THIS IS VALUE BRACKET ONE * /”来分隔它们（或查询分析器提示，如果您觉得自己知道哪些是合适的，例如 /*+ CARDINALITY */ 可能适用这里）。

无论哪种方式，我认为您希望拥有单独的 SQL 语句，以便您可以在 Statspack 和朋友中获得单独的报告，因为看起来您真的想要微调该查询。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T07:47:39.327

对于 Oracle 10g，我们会选择查询中的任何表并执行

```
GRANT SELECT ON table1 TO user1; 
```

这将使引用该表的任何查询的计划无效。当然，您会希望选择一个对其他查询影响最小的表。另请参阅[此页面](http://coskan.wordpress.com/2007/03/01/how-to-invalidate-execution-plan/)以获取更多信息和示例列表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T08:18:10.657

如果您真的想每次都生成一个新的查询计划，只需按照 thilo 的建议添加一个独特的注释

```
select /* SQLID=1234 */ 1 from dual;
select /* SQLID=1235 */ 1 from dual; 
```

这些应该产生独特的计划。

不过，我非常怀疑是否需要这样做，在尝试解决优化器之前，您应该非常确定您的统计数据没有错。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T13:44:16.113

优化器使用的其中一件事是相关列上的直方图。如果您使用绑定变量并且相关列上有直方图，则计划可能会根据参数值而改变。第一个计划将保留在共享池中，并将用于所有值。

如果你不想要这个，那么你可以使用文字而不是绑定（如果你不会有太多相同的 sql 版本）。或者您可以移除直方图，移除直方图可确保独立于绑定参数值生成相同的计划。

每次执行都使 sql 无效不是一个好主意。根据这个 sql 的使用频率，它可能会导致新的问题，例如硬解析导致的闩锁问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-07T14:38:51.037

> 有没有办法告诉Oracle必须重新计算查询计划？

您可以`OUTLINE`为不同的执行计划创建多个 's 并选择使用哪一个`OUTLINE CATEGORIES`：

```
CREATE OUTLINE ol_use_nl
FOR
SELECT  *
FROM    mytable1 mt1
JOIN    mytable2 mt2
ON      mt1.id = mt2.id
WHERE   mt1.value BETWEEN :a AND :b
CATEGORY FILTERED;

/* Edit the outline to add USE_NL */

CREATE OUTLINE ol_use_nl
FOR
SELECT  *
FROM    mytable1 mt1
JOIN    mytable2 mt2
ON      mt1.id = mt2.id
WHERE   mt1.value BETWEEN :a AND :b
CATEGORY UNFILTERED;

/* Edit the outline to add USE_HASH */

ALTER SESSION SET USE_STORED_OUTLINES = FILTERED;

SELECT  *
FROM    mytable1 mt1
JOIN    mytable2 mt2
ON      mt1.id = mt2.id
WHERE   mt1.value BETWEEN 1 AND 2

/* This will use NESTED LOOPS */

ALTER SESSION SET USE_STORED_OUTLINES = UNFILTERED;

SELECT  *
FROM    mytable1 mt1
JOIN    mytable2 mt2
ON      mt1.id = mt2.id
WHERE   mt1.value BETWEEN 1 AND 1000000

/* This will use HASH JOIN */ 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T15:22:56.690

您的问题是由于绑定变量窥视 - 为整个数据库关闭它可能会破坏其他东西，但您可以通过添加以下提示来关闭它仅用于此查询：

/*+ opt_param('_OPTIM_PEEK_USER_BINDS ',FALSE) */

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T18:55:51.970

OP 告诉我们他不能更改 sql 语句。使用包`dbms_advanced_rewrite`可以截获一条 SQL 语句并更改这条 SQL 语句。

# naming-conventions - 您如何命名“反向引用”属性？

> ID：724525
> 
> 赞同：0
> 
> 时间：2009-04-07T07:46:23.447
> 
> 标签：naming-conventions, domain-driven-design

我正在开发一个具有丰富域模型的项目。

我的一些类有其他类型的集合，而那些其他类型有一个属性可以引用它们的“所有者”。这听起来可能有点神秘，所以一个代码示例会有所帮助：

```
public class Product
{
    private IList<ProductPrice> _prices = new List<ProductPrice>();

    public void AddPrice( ProductPrice price )
    {
       price.Product = this;
       _prices.Add (price);
    }
}

public class ProductPrice
{
    public DateTime ValidationDate {get; set;}
    public Decimal  Price {get; set;}
    public Product Product {get; set;}
} 
```

问题是：您更喜欢 ProductPrice 类的“产品”属性的名称是什么？

你会命名它： - 产品（就像现在一样） - 所有者 - BelongsTo - 别的东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T07:54:25.160

产品。

如果你有很多这样的类，并且想要一般地遵循反向引用，请从具有抽象方法 parent() 的 HasParent 接口继承，并让父接口继承父接口。但是除了遵循对象图或通过强制转换之外，您对父级无能为力。

编辑：实际上，让我修改一下。我在一个项目中工作，我们有一个半复杂的对象图，并且由于一些糟糕的计划和一些需求变化，有时我必须跨越图从相关对象中获取数据。ComponentCost 到其父项的 Cost 到其父项，其子 CustomsInfo 到其子 ComponentCustomsInfo 到其查找表 DutyCalculation。（是的，我没有做原始设计，所以不要对我皱眉头。）

一种`parent()`方法可以使它更通用一点。（最终我将一组枚举（Java 枚举，所以单例类）放在一起，以一种类型安全甚至优雅的方式为我遍历了图。不过，如果有一个父级，实现起来会更简单。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T08:19:28.437

产品 - 没有歧义并且命名一致 - 产品在任何地方都保持产品。

如果从外部访问该物业，我更喜欢这样：

```
price.Product.Name 
```

比这个：

```
price.Owner.Name 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T07:52:32.777

`Parent`是一个相当通用的术语，我经常觉得很有帮助 - 但`Product`也非常好用。

# asp.net - 如何在查询字符串中传递多个参数

> ID：724526
> 
> 赞同：101
> 
> 时间：2009-04-07T07:46:24.117
> 
> 标签：asp.net, query-string

我必须将三个值作为参数传递给例如`strID`和。`strName``strDate`

我想将这三个参数重定向到另一个页面`Response.Redirect()`。有人可以为我提供正确的查询字符串吗？

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2009-04-07T07:49:59.460

[请求参数](http://en.wikipedia.org/wiki/Query_string#Structure)

（以下是维基百科条目的链接部分的文本。）

## 结构

包含查询字符串的典型 URL 如下所示：

`http://server/path/program?query_string`

当服务器收到对此类页面的请求时，它会运行一个程序（如果配置为这样做），将原样的 query_string 传递给程序。问号用作分隔符，不是查询字符串的一部分。

网页中的链接可能具有包含查询字符串的 URL，但是，HTML 定义了 Web 浏览器生成查询字符串的三种方式：

*   通过 ... 元素的 Web 表单
*   通过具有构造的元素上的 ​ismap​ 属性的服务器端图像映射
*   通过现已弃用的元素进行索引搜索

### 网络表单

查询字符串的主要用途是包含 HTML 表单的内容，也称为 Web 表单。特别是，当提交包含字段 field1、field2、field3 的表单时，这些字段的内容被编码为查询字符串，如下所示：

`field1=value1&field2=value2&field3=value3...`

*   查询字符串由一系列字段值对组成。
*   在每一对中，字段名称和值由等号分隔。如果值为空字符串，则可以省略等号。
*   这一系列对由 & 号分隔，'&'（或分号，';' 用于嵌入在 HTML 中且不是由 ... 生成的 URL；见下文）。虽然没有明确的标准，但大多数 Web 框架允许将多个值与单个字段关联：

`field1=value1&field1=value2&field1=value3...`

对于表单的每个字段，查询字符串都包含一个字段=值对。Web 表单可能包含对用户不可见的字段；提交表单时，这些字段包含在查询字符串中

该约定是 W3C 推荐的。W3C 建议所有 Web 服务器都支持分号分隔符和 & 号分隔符[6]，以允许 HTML 文档中的 URL 中的 application/x-www-form-urlencoded 查询字符串，而无需实体转义 & 号。

从技术上讲，只有当表单提交方法为 GET 时，表单内容才会被编码为查询字符串。提交方式为 POST 时默认使用相同的编码，但结果不作为查询字符串发送，即不添加到表单的操作 URL 中。相反，该字符串作为 HTTP 请求的主体发送。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-04-07T07:50:13.437

```
Query String: ?strID=XXXX&strName=yyyy&strDate=zzzzz 
```

在重定向之前：

```
string queryString = Request.QueryString.ToString();

Response.Redirect("page.aspx?"+queryString); 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2013-04-10T11:14:46.117

试试这样。它应该工作

```
Response.Redirect(String.Format("yourpage.aspx?strId={0}&strName={1}&strDate{2}", Server.UrlEncode(strId), Server.UrlEncode(strName),Server.UrlEncode(strDate))); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-07T07:48:57.387

```
~mypage.aspx?strID=x&strName=y&strDate=z 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-05-31T02:56:58.217

这可以通过使用来完成：

```
Response.Redirect("http://localhost/YourControllerName/ActionMethodName?querystring1=querystringvalue1&querystring2=querystringvalue2&querystring3=querystringvalue3"); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-06-12T22:30:18.380

我使用 AbsoluteUri，你可以像这样得到它：

```
string myURI = Request.Url.AbsoluteUri;
 if (!WebSecurity.IsAuthenticated) {
        Response.Redirect("~/Login?returnUrl="
            + Request.Url.AbsoluteUri ); 
```

然后登录后：

```
var returnUrl = Request.QueryString["returnUrl"];
 if(WebSecurity.Login(username,password,true)){
                Context.RedirectLocal(returnUrl); 
```

这对我来说很有用。

# c++ - 当 C++ 线程退出时，内存是否保持分配状态？

> ID：724536
> 
> 赞同：5
> 
> 时间：2009-04-07T07:51:06.540
> 
> 标签：c++, multithreading, pthreads

我在 Linux 上使用 pthread 库。

我在线程 A 中分配了一个字符串，然后尝试在线程 B 中打印该字符串。但是，该字符串仅打印为空（我已验证它在线程 A 中有效）。

注意：字符串驻留在一个对象内，我怀疑它可能会被清理或重新实例化为空......容器对象不会给我一个段错误或任何东西，只是所有的值都是空的。

这是因为线程无法从其他线程访问内存，还是因为一旦线程 A 停止，内存就会被取消分配？或者两者都不是；这很可能是我的代码中的一个错误，但我只是想排除这种情况......

### 更新：

原来是内存问题。感谢您的回答，我自己也[回答了这个](https://stackoverflow.com/questions/724536/does-memory-stay-allocated-when-a-c-thread-exits/730868#730868)问题，如果您同意/不同意，请对我的回答发表评论。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-07T07:58:18.303

与进程不同，线程在进程内部共享一个公共内存空间（每个线程都有自己的堆栈，但堆通常是共享的）。因此，当您退出线程时，从共享堆分配的内存不会自动释放。但是，例如，如果您在堆栈上分配了一个字符串对象并通过一个简单的指针将其传递到某处，则析构函数将在线程退出时释放内存。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T07:59:09.203

尽管每个线程都有其“自己的”内存（即 - 它自己的堆空间）......内存就是内存。启动一个线程不会对另一个线程的内存做任何事情。线程 B 如何获取线程 A 中字符串的指针？

您需要提供更多详细信息...您是否将字符串放在堆上？如果它不在堆上，它可能会在线程 A 死亡时消失......否则你有一个错误......请发布更多！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T07:59:55.023

是的，内存保持分配状态。

在包含字符串的类的 dtor 中放置一个断点或一些日志，看看发生了什么。

希望这可以帮助

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-08T17:37:17.387

尽管您的“正确方法”有效，但对于您的原始问题来说，它的解决方法太多了。

以下是您原始问题所需的唯一更改。

```
void onlyFunctionRunFromThread2()
{
    MyType1 &mt1 = myMap[0];

   ... 
```

以你的“正确方式”，现在是你负责释放你用 new 分配的内存。在您的原始示例中，它是“自动”完成的（可以这么说）。

而且这两种解决方案都缺乏对地图或地图项目的锁定，这是一个完全不同的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T07:59:05.057

当一个线程完成时，它的堆栈被释放。但是，堆内存不是线程特定的，因此堆上的任何分配都将保留在那里，除非您执行清理。

字符串是否在堆栈上分配？如果是这样，即使两个线程运行相同的代码，线程之间也没有共享字符串。

在以下示例中，函数 foo 由两个线程运行：

```
void foo( void*)
{
   std::string myString;
   // Do something with your string....
} 
```

myString 不在线程之间共享。每个线程在他自己的堆栈上都有一个字符串对象。

那么，您所指的真实情况是什么？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T07:59:25.773

当您访问共享资源（即字符串）时，您是否使用了锁？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T14:04:44.787

正如已经说过的，线程对你的记忆没有任何作用。它们没有任何私有内存空间。它们只是操作系统调度程序的命令，用于实现 2 个或更多功能的“并行”执行。可以访问同一变量的任何 2 个函数都可以这样做，无论它们是否是线程化的（并排执行）或不（顺序）。

通常线程看起来像一些可怕的怪物，但它实际上只是给调度程序一个添加额外执行指针的提示。

要调试您描述的问题，只需更改两个函数中更基本的变量类型，例如 int。一旦您更改字符串或类似内容，您的容器很可能会立即对数据进行一些内部复制。

```
    诠释我; // 两个函数范围内的一些变量

无效 f1()
{
   而（真）
    {
       我++；
       我 %= 128000;
    }
}
无效 f2()
{
     而（真）
            标准::cout
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-08T16:51:26.187

事实证明，这个问题是由不正确的内存使用引起的，正如预期的那样。我 99% 确定以下示例是准确的；它几乎是伪代码，所以显然不会编译。

### 更新：

感谢nusi，刚刚添加了第三个解决方案。

### 错误的方式（使用堆栈内存）：

```
std::map<int, MyType1> myMap;

void firstFunctionRunFromThread1()
{
    MyType1 mt1;
    mt1.Test = "Test 1";
    myMap[0] = mt1;
}

void onlyFunctionRunFromThread2()
{
    MyType1 mt1 = myMap[0];

    // This actually does print "Test 1", so the memory is being accessed.
    std::cout << mt1.Test << endl;

    /* However, because we're using stack memory here, this value is lost
     * when we go back to thread #1\. */
    mt1.Test = "Test 2";
}

void secondFunctionFromThread1()
{
    MyType1 mt1 = myMap[0];

    // This will actually print out "Test 1", where "Test 2" is expected!
    std::cout << mt1.Test << endl;
} 
```

### *复杂*、正确的方法（使用堆内存）：

另请参阅使用堆栈内存的简单方法。

```
std::map<int, MyType1> myMap;

void firstFunctionRunFromThread1()
{
    // Use heap memory so the memory stays allocated.
    MyType1 *mt1 = new MyType1();
    mt1->Test = "Test 1";
    myMap[0] = *mt1;
}

void onlyFunctionRunFromThread2()
{
    /* Now, get a pointer to the object; we can't use stack memory
     * here because the values assigned would be lost as soon as 
     * we try and access them from secondFunctionFromThread1() */
    MyType1 *mt1 = &myMap[0];

    // As expected, this prints "Test 1"
    std::cout << mt1->Test << endl;

    /* Now, because we're assigning to memory on the heap, this will
     * stay assigned until the entire application exits, yay! */
    mt1->Test = "Test 2";
}

void secondFunctionFromThread1()
{
    /* Not sure if using heap memory here is neccecary, but we'll do
     * it anwyay just to play on the safe side... let me know if this
     * is pointless... */
    MyType1 *mt1 = &myMap[0];

    // Hurray, this prints "Test 2"!!! :)
    std::cout << mt1->Test << endl;
} 
```

### *简单*、正确的方法（正确使用堆栈内存）：

感谢nusi[的回答](https://stackoverflow.com/questions/724536/does-memory-stay-allocated-when-a-c-thread-exits/731025#731025)。

```
std::map<int, MyType1> myMap;

void firstFunctionRunFromThread1()
{
    MyType1 mt1;
    mt1.Test = "Test 1";
    myMap[0] = mt1;
}

void onlyFunctionRunFromThread2()
{
    /* Using the & before the variable turns it into a reference, so
     * instead of using stack memory, we use the original memory.
     * NOTE: Is this explanation correct? */
    MyType1 &mt1 = myMap[0];

    // This actually does print "Test 1", so the memory is being accessed.
    std::cout << mt1.Test << endl;

    // We're assigning to the reference, so this works.
    mt1.Test = "Test 2";
}

void secondFunctionFromThread1()
{
    MyType1 mt1 = myMap[0];

    // Prints "Test 1" as expected.
    std::cout << mt1.Test << endl;
} 
```

# sharepoint - Sharepoint 更新自定义数据库

> ID：724548
> 
> 赞同：3
> 
> 时间：2009-04-07T07:56:35.297
> 
> 标签：sharepoint, wss

是否可以利用 Sharepoint UI（例如列表编辑器）对外部数据库（由单独的后端应用程序拥有和使用）执行基本的 CRUD 操作？
我该怎么办？

这个数据库中有很多表，我只是希望最大限度地减少我们需要开发和维护的自定义代码（因为我们不是真正的开发商店 - 并且没有闲置的程序员......） .
（最好在 WSS 上，而不是 MOSS 上……但愿意听）

我应该补充一点，这个应用程序是在内部使用的，这些表可以看作是后端流程的复杂配置——需要经常更改，并且还包括“馈送”流程的数据。

此外，我对为此编写自定义 WebPart 没有兴趣，我还不如做一个简单的 CRUD Web 应用程序……我希望利用内置功能，并且仅通过配置就足够了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T12:14:39.730

如果您想访问另一个数据库中的数据并在没有自定义代码、第 3 方产品或 BDC（MOSS Enterprise 的一部分）的情况下将其显示在 SharePoint UI 中，那么我建议您查看可以添加到的数据表单 Web 部件使用 SharePoint Designer 的页面。我敢肯定它上面有很多链接——我刚刚发现的一个看起来不错的链接就在[这里](http://masteringsharepoint.com/blogs/beagle/archive/2008/08/13/DFWP1.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T22:09:14.783

或者为什么不只做一个 asp.net 应用程序而不涉及 Sharepoint，而不仅仅是查看页面......

# javascript - 在客户端机器上打印

> ID：724550
> 
> 赞同：0
> 
> 时间：2009-04-07T07:57:00.380
> 
> 标签：javascript, jsp

我正在创建一个 jsp 应用程序，在该应用程序中，我想通过向客户端系统的本地端口发送命令让我们说“cat /root/data.txt >/dev/lp0”在客户端（仅限 Linux os）机器中打印文件因为我的打印机是一台热敏打印机，它会打印一张票...... data.txt 将在客户端机器上......我不能使用 window.print();

但我不知道如何通过 scriplet /javascript 从服务器运行客户端命令 shell）......而且 ii 也不能使用 activexobject，因为客户端操作系统是 linux ..

所以请帮助我...

斯姆鲁蒂，德里

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T11:00:38.643

我认为这在纯 JavaScript 中是不可能的，这将是一个安全漏洞。你可以建立一个网站，当我上网时打印垃圾邮件。

可能有一些技术可以让您更多地访问客户端，例如 Java Webstart、Flash 或其他东西，但纯 JS 现在无法完成这项工作。

（我知道 Webstart 可以读取/写入您的文件系统，如果您使用签名的 jar 并且客户端确认它。如果您允许，Flash 可以访问您的网络摄像头，所以我猜它也可以访问您的打印机）

# structuremap - Unity & StructureMap

> ID：724551
> 
> 赞同：3
> 
> 时间：2009-04-07T07:57:18.833
> 
> 标签：structuremap, unity-container

在 Unity 中是否有对应于 StructureMap 的等效项：

```
ServiceLocator.Current.GetAllInstances<IT> 
```

试图遵循[这个](http://weblogs.asp.net/rashid/archive/2009/02/17/use-bootstrapper-in-your-asp-net-mvc-application-and-reduce-code-smell.aspx)小模式......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-08T17:24:18.387

ObjectFactory.GetAllInstances();

有关详细信息，请参阅[http://structuremap.sourceforge.net/RetrievingServices.htm#section3](http://structuremap.sourceforge.net/RetrievingServices.htm#section3)

# windows - 一个进程只初始化一次临界区

> ID：724560
> 
> 赞同：6
> 
> 时间：2009-04-07T07:59:14.883
> 
> 标签：windows, winapi, com, dll

在多线程应用程序中，除了将代码放在 DLL main() 中之外，有没有办法确保关键部分只初始化一次？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T18:33:01.400

在 Windows Vista 上，您可以使用一次性初始化函数。[使用一次性初始化](http://msdn.microsoft.com/en-us/library/ms686934(VS.85).aspx)展示了如何使用它们来确保事件只初始化一次。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T08:05:10.627

我建议用一个类包装 CRITICAL_SECTION，该类将在其构造函数和析构函数中处理临界区对象的初始化和取消初始化。这样，在大多数情况下，您将是线程安全的。（您必须确保在其构造函数完成之前没有人访问该对象，但这相对容易。）

您可以使用几个常见的 CRITICAL_SECTION 包装器。MFC 的[CCriticalSection](http://msdn.microsoft.com/en-us/library/h5zew56b(VS.80).aspx)是显而易见的选择，但您也可以创建自己的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T08:04:47.037

当然有很多很多方法。

1.  使用全局变量
2.  使用单例实例
3.  在 main 或其他一些单实例函数中创建它
4.  将其创建为某个单个实例类实例的成员 var

等等。这与尝试在代码中创建某个事物的单个实例的任何其他问题没有什么不同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T08:04:58.630

您还可以使用包装类并声明该类的全局对象。全局对象的构造函数只会在启动时调用一次。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T12:30:49.597

You can initialize a global critical section in `DllMain` for `DLL_PROCESS_ATTACH` (and clean up for `DLL_PROCESS_DETACH`).

# java - Java 正则表达式语法的 ANTLR 语法

> ID：724566
> 
> 赞同：5
> 
> 时间：2009-04-07T08:01:04.707
> 
> 标签：java, regex, parsing, antlr

我目前正在研究正则表达式的测试框架，我需要能够将 Java 正则表达式解析为 AST，以便能够生成与给定正则表达式匹配的示例字符串。

我查看了 的实现，`java.util.regex.Pattern`但代码看起来相当笨拙（我想强调的是速度而不是可读性），所以我决定使用 ANTLR 从头开始​​编写正则表达式解析器。

在我开始抨击自己之前，我想知道是否有人知道正则表达式的现成 ANTLR 语法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T08:14:55.673

这里有一个类似的问题：

[正则表达式语法](https://stackoverflow.com/questions/265457/regex-grammar)

答案包含各种语法的链接，其中没有一个是 ANTLR 的。我怀疑如果你将 BNF 翻译成 ANTLR，你会受到左递归头痛的困扰，但值得一试，你可能会走运。

# prolog - SML 是做什么用的？

> ID：724567
> 
> 赞同：20
> 
> 时间：2009-04-07T08:01:46.780
> 
> 标签：prolog, sml, dcg

SML在现实世界中的用途是什么？

它的实际用途是否与 Prolog 相似？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-01T19:00:00.450

At work, we use SML in actual real-life software products which we ship to paying customers. We use [MLton](http://mlton.org/) to compile our SML code to native code running on Windows, Linux, Solaris, AIX, and HP-UX. It works well, and we're happy with our choice.

I don't see SML as particularly suited to any clear niche. Indeed, SML is a very well-rounded general-purpose programming language. Prolog is well established in the logic programming/artifical intelligence/rule based system solving niche(s), but [it's used for a lot of things](https://stackoverflow.com/questions/130097/real-world-prolog-usage) besides these traditional domains.

For anyone who is considering using SML for a software project in the "real world", here are some of the advantages and disadvantages we've noticed so far:

*   SML is a very nice general programming language, especially the module system rocks
*   MLton optimizes so well that you can use abstractions freely without losing performance
*   Our old code is written in plain C. We can replace that piece by piece with SML, linking both C and SML code to the same executbles.
*   [SML/NJ](http://www.smlnj.org/) provides a repl for rapid development
*   Portable to all of our platforms

Disadvantages:

*   Miniscule user base
*   Lacking in the supporting tools area (IDE, code documentation, debuggers, etc.)
*   I had to actually port MLton myself to AIX and HP-UX

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-14T22:12:09.617

ML 不能直接与 Prolog 相提并论。Prolog 是一种声明性逻辑编程语言，基本上是使用 Horn 子句的定理证明器。（非纯 Prolog）的优点之一是它允许您在编译或运行时严格修改程序。例如，在大多数现代 Prolog 实现中，您可以使用 DCG（定句语法）形式直接编写语法。使用“-->”运算符的语法规则使用术语扩展重写为 Prolog 子句。例如：

```
a(N) --> b, c(N). 
```

将被改写为：

```
a(N,P0,P2) :- b(P0,P1), c(N,P1,P2). 
```

位置变量的使用强制箭头右侧的女儿相邻。由于 Prolog 将尝试通过证明子句（通过回溯）来证明子句的头部，因此您基本上拥有一个自上而下的左右解析器，无需任何额外工作。程序修改的另一个示例是（动态）事实或子句的断言或撤回，可用于修改程序在运行时的行为。

另一方面，ML 是一种不纯的函数式语言。Prolog 和 ML 之间的联系是一些定理证明器是用 ML 编写的。我会说 ML 更通用，但对于它的利基，Prolog 非常方便。两者都非常有用，即使只是为了拓宽你的视野。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T08:14:14.567

SML is used by compiler writers. Both Prolog and SML are used in theorem provers.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-01-30T08:44:57.390

卡内基梅隆大学的[FoxNet 项目是使用 SML 构建的。](http://www.cs.cmu.edu/~fox/foxnet.html)

Jane Street 专有贸易公司，使用 O'Caml 为他们自己的内部构建软件。

ML for the Working Programmer 一书的作者 Laurance C. Paulson 使用 SML 构建了 LCF 定理证明器 Isabell。

教授和 Haskell 专家 Philip Wadler 维护了一个使用函数式编程的现实世界项目列表，其中包括使用 ML 的项目，位于 [http://homepages.inf.ed.ac.uk/wadler/realworld/](http://homepages.inf.ed.ac.uk/wadler/realworld/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T08:07:04.817

I have only personally used it in university for a number theory course. I have to say I really enjoyed using it. It could handle huge numbers which was nice when dealing with cryptography.

If it matters I was using Moscow ML [http://www.itu.dk/people/sestoft/mosml.html](http://www.itu.dk/people/sestoft/mosml.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T08:14:01.073

I haven't seen many commercial applications of ML, but this may be down to the available environments, rather than a reflection on the language. I've seen a number of banks using F# (which is the same family as ML) to process data streams, do matrix algebra and look for patterns. The fact that Microsoft have packaged it for .NET obviously helps no end.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-07T08:27:44.237

Not SML, but closely related, is OCAML, which has been used for a number of things:

[http://caml.inria.fr/about/successes.en.html](http://caml.inria.fr/about/successes.en.html)

I rather like the "Faster Fourier Transform in the West" where ML is used to generate optimised C...

# php - 错误，谁能帮帮我

> ID：724570
> 
> 赞同：0
> 
> 时间：2009-04-07T08:04:44.853
> 
> 标签：php, symfony1

尝试运行页面时出现此错误：

```
ERROR:

500 | Internal Server Error | PropelException
Unable to open PDO connection [wrapped: could not find driver] 
```

是什么问题，我需要做些什么来消除这个问题？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T08:07:04.130

查看 php.ini 并为您的 RDBMS 供应商启用适当的 PDO 驱动程序。对于 MySQL，您需要取消注释 php_pdo_mysql。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-22T10:50:26.307

你可以看看 PHPInfo(); 检查您是否已成功取消注释所需的驱动程序。

修改 php.ini 后不要忘记重启 apache ;-)

# java - Java 是否存在开放式区间实现？

> ID：724575
> 
> 赞同：5
> 
> 时间：2009-04-07T08:06:27.830
> 
> 标签：java, math, intervals

我对不同时间间隔的某些值进行了分类。大多数具有 [20-30] 的形式，但有些具有 [30-infinite) 的形式。

是否有一个您知道的区间类可以表示：

*   两边都不闭合的区间（例如 (0-5) 或 [0-5) ）
*   无限期结束（或开始）的区间

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T12:42:15.623

Apache-commons-lang 项目（[http://commons.apache.org/lang/](http://commons.apache.org/lang/)）包含处理范围的类（如 IntRange - [https://commons.apache.org/proper/commons-lang/javadocs/api- 2.6/org/apache/commons/lang/math/IntRange.html](https://commons.apache.org/proper/commons-lang/javadocs/api-2.6/org/apache/commons/lang/math/IntRange.html)）。我不确定它是否满足您的所有需求，但可能值得检查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T08:09:45.170

我知道没有库类，但我记得写这样的类相当琐碎。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T08:48:11.427

[Time&Money](http://timeandmoney.sourceforge.net/)项目似乎有您需要的 Interval 类。

[在他们的 svn: interval package](http://timeandmoney.svn.sourceforge.net/viewvc/timeandmoney/timeandmoney/trunk/src/main/java/com/domainlanguage/intervals/)中查看这些文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-11-08T11:41:41.093

对于那些可能最终来到这里的人，您可以查看[谷歌范围](https://github.com/google/guava/wiki/RangesExplained)，这正是这里所要求的。

# python - ctypes bindings for Subversion in windows

> ID：724580
> 
> 赞同：0
> 
> 时间：2009-04-07T08:07:46.890
> 
> 标签：python, windows, svn, ctypes

Is there a binary installer or a faq for the new ctypes bindings for Subversion 1.6 in Windows (32 and 64bit)?

What library would you use to make an easy to deploy (both win32 and x64) svn client in python for svn version >= 1.5?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T09:07:13.503

你有[pysvn](http://pysvn.tigris.org/project_downloads.html)模块，它允许你这样做：

基于 subversion 1.5.5 的二进制安装程序

# unix - 从 ps 隐藏参数

> ID：724582
> 
> 赞同：7
> 
> 时间：2009-04-07T08:07:54.597
> 
> 标签：unix, command-line

我想让我的 ssh 命令对其他用户隐藏/伪装。

例子：

```
ssh user@host -i /my/private/key 
```

不幸的是，这将出现在 ps 列表中，其他用户将能够看到我正在使用的私钥文件。有没有解决的办法？

（他们以与我相同的用户身份登录）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-07T08:16:29.600

如果他们以您的身份登录，则基本上您几乎无法阻止他们学习该信息。如果您使用的是 Linux，他们将可以访问您的 /proc 条目，并且可以轻松地了解这些信息。

他们还可以：

*   删除所有文件。
*   以您的名义发送邮件侮辱您公司的首席执行官。
*   访问您的所有文件和命令行历史记录（如果有）。
*   无数其他的东西。

这不是保护自己的可行方法。您需要先解决相同的用户问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T08:13:26.003

在 Linux 上，您可以执行类似的操作

```
strncpy(argv[0], "mynewcmdlinehere", strlen(argv[0])); 
```

不知道其他Unices，对不起。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T08:14:19.230

隐藏命令行需要一个脚本，所以它是 Catch-22，因为具有相同用户的其他 ppl 将可以访问该脚本。

解决方案非常简单：**使用带有密码的密钥。** [（如何）](http://www.puddingonline.com/~dave/publications/SSH-with-Keys-HOWTO/document/html/SSH-with-Keys-HOWTO-5.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-10T15:30:54.683

即使您隐藏了命令行，用户也可以运行 lsof 来查看您的 ssh 进程打开的所有文件 - 其中将包括身份文件。但是，如果隐藏命令行确实是最终目标，您可以启动一个密钥代理，将身份加载到代理中，然后使用该代理进行 ssh。代理使用的套接字路径由环境变量控制。

不过，这绝不是安全性。Pax 是对的——“以同一用户身份登录”问题才是真正应该在这里解决的问题。停止使用其他人的帐户。;)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T08:11:58.377

不允许他们知道私钥文件的位置并不是什么安全功能——他们真的不应该拥有对它的读取权限，所以他们是否知道它在哪里并不重要。一般来说，如果您可以控制应用程序的源代码，则可以覆盖保存命令行参数的内存位置，这样您就可以将它们修改为“无害”的东西。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T08:28:41.457

在我的记忆深处，我记得很久以前做过类似的事情

首先，创建一个名为 ps 的 shell 脚本，它运行 ps 并将 grep 除包含 ssh（或匹配的内容）之外的所有行并将其放在安全位置（~/bin/ps）

将 ~/bin/ 添加到您的路径作为要搜索的第一个位置。

当然，他们仍然可以明确地使用 /usr/bin/ps （或任何它的位置）

需要注意的是，这一切都来自记忆，我没有一个 Unix 盒子来测试它......对不起

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-14T03:54:33.140

您可以通过受 0700 保护的 ~/.ssh/config 文件设置您的私钥。以下是 ~/.ssh/config 的示例：

```
Host myhost.com
  IdentityFile /home/maxcohan/.ssh/github.com.id_rsa 
```

# css - Whats the correct CSS to apply to a YUI menu bar?

> ID：724583
> 
> 赞同：0
> 
> 时间：2009-04-07T08:08:32.427
> 
> 标签：css, yui, yui-menu

I am trying to figure out the best way to use CSS sprites as header images for a [YUI menu control](http://developer.yahoo.com/yui/menu/).

I have a CSS sprite with the following CSS :

```
.navImg0{width:61px;height:23px;background-repeat:no-repeat;background-position:top left;background-image:url('/dynamicimage/navigation');background-position:-0px -0px;}
.navImg0:hover{width:61px;height:23px;background-repeat:no-repeat;background-position:top left;background-image:url('/dynamicimage/navigation');background-position:-0px -23px;}
.navImg1{width:75px;height:23px;background-repeat:no-repeat;background-position:top left;background-image:url('/dynamicimage/navigation');background-position:-65px -0px;}
.navImg1:hover{width:75px;height:23px;background-repeat:no-repeat;background-position:top left;background-image:url('/dynamicimage/navigation');background-position:-65px -23px;}
.navImg2{width:96px;height:23px;background-repeat:no-repeat;background-position:top left;background-image:url('/dynamicimage/navigation');background-position:-144px -0px;}
.navImg2:hover{width:96px;height:23px;background-repeat:no-repeat;background-position:top left;background-image:url('/dynamicimage/navigation');background-position:-144px -23px;}
.navImg3{width:65px;height:23px;background-repeat:no-repeat;background-position:top left;background-image:url('/dynamicimage/navigation');background-position:-244px -0px;}
.navImg3:hover{width:65px;height:23px;background-repeat:no-repeat;background-position:top left;background-image:url('/dynamicimage/navigation');background-position:-244px -23px;}
.navImg4{width:98px;height:23px;background-repeat:no-repeat;background-position:top left;background-image:url('/dynamicimage/navigation');background-position:-313px -0px;}
.navImg4:hover{width:98px;height:23px;background-repeat:no-repeat;background-position:top left;background-image:url('/dynamicimage/navigation');background-position:-313px -23px;} 
```

How can I apply this to a YUI menu?

So far I've applied the navImg0, navImg1 etc. styles to the buttons.

They come up in the right position but with a few problems:

*   there are lines between the items and i need to ideal way to remove them
*   when i rollover the button the correct rollover works, but then if i roll off the menu and onto the main part of the screen the button disappears
*   the `<a>` tags under the `<li>` for each of the top level items doesnt work (theres no text inside anymore).

They have a lot of documentation about applying CSS but I couldn't find any examples of how to use CSS Sprites as images.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T15:24:23.720

你能提供一个你看到的问题的活生生的例子吗？仅基于您的 CSS 片段很难调试。

与您的问题无关，但您可以通过组合每次重复的规则来使您的 CSS 更小且更易于维护。就像是

```
.navImg0, 
.navImg0:hover, 
.navImg1, 
.navImg1:hover, 
.navImg2, 
.navImg2:hover, 
.navImg3, 
.navImg3:hover, 
.navImg4, 
.navImg4:hover { background: url('/dynamicimage/navigation') no-repeat top left; }

.navImg0{width:61px;height:23px;background-position:-0px -0px;}
.navImg0:hover{width:61px;height:23px;background-position:-0px -23px;}
.navImg1{width:75px;height:23px;background-position:-65px -0px;}
.navImg1:hover{width:75px;height:23px;background-position:-65px -23px;}
.navImg2{width:96px;height:23px;background-position:-144px -0px;}
.navImg2:hover{width:96px;height:23px;background-position:-144px -23px;}
.navImg3{width:65px;height:23px;background-position:-244px -0px;}
.navImg3:hover{width:65px;height:23px;background-position:-244px -23px;}
.navImg4{width:98px;height:23px;background-position:-313px -0px;}
.navImg4:hover{width:98px;height:23px;background-position:-313px -23px;} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T13:48:28.973

1：听起来像边距/填充问题。*检查a*和*li*标签的边距和内边距。

2：我从来没有听说过它回滚时会发生这种情况。您使用的图像是动态的吗？在 css 中，看起来您正在使用一些服务器端代码动态创建它。这可能是问题所在，也可能是某种缓存问题。没有把握。

3：您的精灵表是否已经在显示的内容上显示了文本？通常这就是它在 spritesheet 中的工作方式，因此您通常会隐藏文本。如果您仍然想要此文本，请检查一些将*a*标签设置为*显示的 CSS：无*。它也可能在 YUI javascript 中，我对 YUI 不是很熟悉。;)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-26T00:58:20.470

我有几个使用精灵的 YUI 菜单，但这有点棘手。

如果您从标记构建，这很容易 - 只需在锚标记中添加您的 css 类名称。如果您从 javascript 构建菜单，则必须在呈现菜单后添加类。

```
YAHOO.util.Dom.addClass(theAnchorElemnt, 'the-sprite-css-class'); 
```

即使 YUI 提供了一个类名配置属性，它也不是您想要的。您需要在锚点处应用精灵。

希望有帮助。

# svn - 无法在我的服务器中保留最新版本的开源代码

> ID：724591
> 
> 赞同：0
> 
> 时间：2009-04-07T08:10:49.833
> 
> 标签：svn, git

我试图测试一些开源代码。问题是这些项目变化很快，以至于我的代码每天都过时了。

例如，我昨天开始[在](http://cnprog.googlecode.com/svn/trunk/). 我服务器上的代码已经很旧了。问题是当我将他们的分支上传到我的服务器时，我所做的所有更改都没有包含在最新代码中。

**也许，有可能通过Git**以某种方式将他们最新的代码重新定位到我的分支。他们的代码由**SVN**控制。

**您如何将原始项目的最新更改包含到我的分支中？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T08:19:12.480

使用 git-svn： http: [//git-scm.com/docs/git-svn](http://git-scm.com/docs/git-svn)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T08:33:46.563

看起来您需要了解有关[Vendor Branches](http://svnbook.red-bean.com/en/1.5/svn.advanced.vendorbr.html)的更多信息。

# apache - 使用身份验证设置 Apache 代理

> ID：724599
> 
> 赞同：40
> 
> 时间：2009-04-07T08:12:10.983
> 
> 标签：apache, authentication, proxy, mod-proxy

我需要设置一个带身份验证的代理来验证连接到 Internet 的应用程序的行为。

我正在尝试使用转发代理和身份验证设置 Apache 安装，即使我已经接近让它工作，我想知道是否有更好的方法，因为配置相当深奥。

如何将 Apache 配置为以这种方式工作？

有没有其他已经配置好的选项？也许是一些虚拟机或其他软件工具，而不是 Apache？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-04-07T08:32:36.020

作为记录，这是我设置 apache 以用作具有基本身份验证的转发代理的方式：

打开 http.conf

取消注释以下 LoadModule 指令以启用代理功能

```
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so 
```

将以下指令添加到 http.conf 以启用身份验证

```
ProxyRequests On
ProxyVia On

<Proxy *>
    Order deny,allow
    Allow from all
    AuthType Basic
    AuthName "Password Required"
    AuthUserFile password.file
    AuthGroupFile group.file
    Require group usergroup
</Proxy> 
```

使用 htpasswd.exe 实用程序创建一个 password.file。将其放在 Apache 根目录中

```
htpasswd.exe -c password.file username 
```

使用与 password.file 相同级别的文本编辑器创建一个 group.file，其内容如下

```
usergroup: username 
```

然后运行`apachectl restart`以获取配置更改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T08:20:05.973

我用[鱿鱼](http://www.squid-cache.org/)。

安装它并使用配置文件中的“auth_param”指令使用基本身份验证设置它非常容易。

您将 在 Squid 网站上找到一些[示例](http://wiki.squid-cache.org/ConfigExamples/)， [了解其工作原理](http://wiki.squid-cache.org/SquidFaq/ProxyAuthentication)以及 [有关 auth_param 的所有详细信息。](http://www.squid-cache.org/Doc/config/auth_param/)

# unit-testing - 企业库配置中的从 NUnit 迁移到团队系统错误

> ID：724600
> 
> 赞同：1
> 
> 时间：2009-04-07T08:12:38.220
> 
> 标签：unit-testing, nunit, enterprise-library

在 Visual Studio 中运行某些测试时，我将 NUnit 迁移到 Team System 时出现此错误：

> 测试方法 XXX.XXX.Data.Tests.Path.Method> 引发异常：System.Configuration.ConfigurationException：节名无效。请求的配置文件“C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\vstesthost.exe.Config”或文件“c:\WINDOWS\Microsoft.NET\Framework\”中不存在“dataConfiguration”部分v2.0.50727\Config\machine.config'。确保“enterpriseLibrary.configurationSections”配置部分存在于其中一个文件中，并且“dataConfiguration”部分已定义。

1.  我们假设它是企业库，
    “配置部分”需要什么才能让我的测试工作？
2.  通常在团队系统中哪里可以找到配置文件？
3.  另外为什么应用程序仍在工作而测试却没有？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T08:15:09.947

听起来好像找不到 app.config/web.config 文件。

使用 MSTest，它不会在通常的“输出”目录中进行测试。因此，“复制到输出目录”（等）标志什么也不做。您需要告诉它要将哪些文件部署到测试文件夹；有两种方法：

*   编辑 testrunco​​nfig 文件并将文件添加到部署列表
*   将[`[DeploymentItem]`](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.testtools.webtesting.deploymentitemattribute.aspx)属性添加到您的测试中，告诉它需要哪些文件

我不太喜欢这两种方法——事实上，我倾向于使用 TestDriven.NET 来运行测试，它按照您*期望*的方式运行。

当然，TestDriven.NET 也会在 IDE 中运行您的 NUnit 测试，包括代码覆盖率等 - 这会引出一个问题：如果现有测试可以在 IDE 中运行，为什么还要更改它们？显而易见的答案是“我们已经为 MSTest 付费，而 TestDriven.NET 不是免费的”......

# firefox - XPCOM tab based variable

> ID：724605
> 
> 赞同：0
> 
> 时间：2009-04-07T08:13:40.713
> 
> 标签：firefox, firefox-addon, xul, xpcom

When user clicks on of the button in toolbar it opens an url in the browser windows. user can process that content on clicking on some other button on the toolbar.

However it creates a problem when i have multiple tabs opened and each tab contains different url (so when i send a request to the server through toolbar actions it takes id for recently loaded data).

Could you please help me out so i can manage identifier returned from the server for each tab? I am using variable in JS to maintain the identifier for the loaded Url (Url comes from the server with the identifier).

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T15:01:39.667

gBrowser.mCurrentTab.setAttribute(key, value);

# c - C中联合的例子

> ID：724617
> 
> 赞同：35
> 
> 时间：2009-04-07T08:15:16.577
> 
> 标签：c, unions

我正在寻找一些工会的例子，不是为了了解工会是如何运作的，希望我能做到，而是想看看人们对工会做了哪些黑客行为。

因此，请随时分享您的工会技巧（当然还有一些解释:)）

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-04-07T08:20:39.560

一个经典是表示一个“未知”类型的值，就像在一个简单的虚拟机的核心中一样：

```
typedef enum { INTEGER, STRING, REAL, POINTER } Type;

typedef struct
{
  Type type;
  union {
  int integer;
  char *string;
  float real;
  void *pointer;
  } x;
} Value; 
```

使用它，您可以编写处理“值”而不知道其确切类型的代码，例如实现堆栈等。

由于这是在（旧的，C11 之前的）C 中，因此必须在外部为内部联合指定一个字段名称`struct`。在 C++ 中，您可以让`union`匿名。选择这个名字可能很难。我倾向于使用单字母的东西，因为它几乎从不孤立地引用，因此从上下文中总是可以清楚地看到发生了什么。

将值设置为整数的代码可能如下所示：

```
Value value_new_integer(int v)
{
  Value v;
  v.type = INTEGER;
  v.x.integer = v;
  return v;
} 
```

`struct`在这里，我使用了可以直接返回 s的事实，并且几乎将其视为原始类型的值（您可以分配`struct`s）。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-07T08:19:11.933

这是我每天都用的一个：

```
struct tagVARIANT {
    union {
        struct __tagVARIANT {
            VARTYPE vt;
            WORD    wReserved1;
            WORD    wReserved2;
            WORD    wReserved3;
            union {
                LONG          lVal;         /* VT_I4                */
                BYTE          bVal;         /* VT_UI1               */
                SHORT         iVal;         /* VT_I2                */
                FLOAT         fltVal;       /* VT_R4                */
                DOUBLE        dblVal;       /* VT_R8                */
                VARIANT_BOOL  boolVal;      /* VT_BOOL              */
                _VARIANT_BOOL bool;         /* (obsolete)           */
                SCODE         scode;        /* VT_ERROR             */
                CY            cyVal;        /* VT_CY                */
                DATE          date;         /* VT_DATE              */
                BSTR          bstrVal;      /* VT_BSTR              */
                IUnknown *    punkVal;      /* VT_UNKNOWN           */
                IDispatch *   pdispVal;     /* VT_DISPATCH          */
                SAFEARRAY *   parray;       /* VT_ARRAY             */
                BYTE *        pbVal;        /* VT_BYREF|VT_UI1      */
                SHORT *       piVal;        /* VT_BYREF|VT_I2       */
                LONG *        plVal;        /* VT_BYREF|VT_I4       */
                FLOAT *       pfltVal;      /* VT_BYREF|VT_R4       */
                DOUBLE *      pdblVal;      /* VT_BYREF|VT_R8       */
                VARIANT_BOOL *pboolVal;     /* VT_BYREF|VT_BOOL     */
                SCODE *       pscode;       /* VT_BYREF|VT_ERROR    */
                CY *          pcyVal;       /* VT_BYREF|VT_CY       */
                DATE *        pdate;        /* VT_BYREF|VT_DATE     */
                BSTR *        pbstrVal;     /* VT_BYREF|VT_BSTR     */
                IUnknown **   ppunkVal;     /* VT_BYREF|VT_UNKNOWN  */
                IDispatch **  ppdispVal;    /* VT_BYREF|VT_DISPATCH */
                SAFEARRAY **  pparray;      /* VT_BYREF|VT_ARRAY    */
                VARIANT *     pvarVal;      /* VT_BYREF|VT_VARIANT  */
                PVOID         byref;        /* Generic ByRef        */
                CHAR          cVal;         /* VT_I1                */
                USHORT        uiVal;        /* VT_UI2               */
                ULONG         ulVal;        /* VT_UI4               */
                INT           intVal;       /* VT_INT               */
                UINT          uintVal;      /* VT_UINT              */
                DECIMAL *     pdecVal;      /* VT_BYREF|VT_DECIMAL  */
                CHAR *        pcVal;        /* VT_BYREF|VT_I1       */
                USHORT *      puiVal;       /* VT_BYREF|VT_UI2      */
                ULONG *       pulVal;       /* VT_BYREF|VT_UI4      */
                INT *         pintVal;      /* VT_BYREF|VT_INT      */
                UINT *        puintVal;     /* VT_BYREF|VT_UINT     */
            } __VARIANT_NAME_3;
        } __VARIANT_NAME_2;
        DECIMAL decVal;
    } __VARIANT_NAME_1;
}; 
```

这是 OLE 自动化变量数据类型的定义。如您所见，它有很多可能的类型。根据您预期的客户端代码的功能，您可以在不同情况下使用的类型有很多规则。并非所有语言都支持所有类型。

它们后面的类型`VT_BYREF`由默认通过引用传递参数的语言（例如 VBScript）使用。这意味着，如果您有一些关心变体结构细节的代码（例如 C++）被不关心的代码（例如 VB）调用，那么您必须在需要时仔细取消对变体参数的引用。

byref 类型也用于从函数返回值。还支持使用奇怪的错误命名类型的数组类型`SAFEARRAY`- 在 C++ 中很难使用。

如果你有一个字符串数组，你可以将它传递给 vbscript，但它不能被使用（除了打印大小）。要实际读取这些值，数组数据需要是 type `VT_BYREF | VT_BSTR`。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-07T08:26:44.363

联合也常用于语言处理器的词法分析和解析阶段，如编译器和解释器。这是我现在正在编辑的一个。

```
union {
    char c;
    int i;
    string *s;
    double d;
    Expression *e;
    ExpressionList *el;
    fpos_t fp;
} 
```

联合用于将语义值与词法分析器的标记和解析器的产生相关联。这种做法在语法生成器中很常见，比如*yacc*，它提供了明确的支持。工会可以持有它的任何价值，但当时只能持有其中一个。例如，在输入文件中的任何一点，您要么读取了一个字符常量（存储在 中`c`），要么读取了一个整数（存储在 ），要么读取了`i`一个浮点数（存储在`d`）。语法生成器为根据正在处理的规则确定在任何时候存储哪些值提供了相当大的帮助。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-07T08:25:05.290

请避免使用 union 进行“黑客攻击”，它们会导致可移植性问题（字节序、对齐问题）。

*   union 的一个合法用途是在同一个地方存储不同的数据类型，最好使用标签，以便您知道它是哪种类型。请参阅 1800 INFORMATION 的示例。

*   不要使用联合在数据类型之间进行转换，例如从整数到几个字节。使用 shift 和 masking 代替以实现可移植性。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-07T09:26:31.147

我们在工作中使用联合来打包消息（C/C++），因此我们可以传递一个带有联合作为数据成员的结构，然后根据结构中的 id 字段访问正确的路径。

在有人将结构写入文件之前工作正常，现在我们仅限于文件中使用的最大数据，因为即使有文件版本，也没有人改变过它......

因此，虽然对内存中的工作很有用，但请避免盲目地将它们写入磁盘或网络。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-07T08:19:53.727

[巧合的是，我在这里](https://stackoverflow.com/questions/724404/converting-endianess-on-a-bit-field-structure/724415#724415)的 Stackoverflow 答案中只使用了一个，因此我可以将由 6 位字段组成的单词视为两个 16 位无符号整数。

几年前，我也将一个用于（第一个）ARM C 编译器——当时的指令都是 32 位的，但根据确切的指令有不同的布局。所以我有一个联合来表示一条 ARM 指令，其中包含一组结构，每个结构都有特定指令类型的适当位域。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-07T08:22:59.973

```
struct InputEvent
{
    enum EventType
    {
        EventKeyPressed,
        EventKeyPressRepeated,
        EventKeyReleased,
        EventMousePressed,
        EventMouseMoved,
        EventMouseReleased
    } Type;
    union
    {
        unsigned int KeyCode;
        struct
        {
            int x;
            int y;
            unsigned int ButtonCode;
        };
    };
};
...
std::vector<InputEvent>   InputQueue; 
```

使用联合黑客，我可以简单地制作一个对象向量。我相信这可以变得更干净......但它对我有用 - KISS

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-07T08:26:01.947

```
#define DWORD unsigned int
#define WORD  unsigned short
#define BYTE  unsigned char

typedef union _DWORD_PART_ {

   DWORD dwWord;

   struct {
      WORD dwMSB;
      WORD dwLSB;
   }hw;

   struct {

      BYTE byMSB;
      BYTE byMSBL;
      BYTE byLSBH;
      BYTE byLSB;

   } b;

} DWORD_PART; 
```

这是访问单词部分的简单方法。（一旦完成，平台字节序的任何变化也可以轻松处理）

# java - 通过 servlet 处理对 XMPP 服务器的登录

> ID：724638
> 
> 赞同：2
> 
> 时间：2009-04-07T08:24:49.580
> 
> 标签：java, http, session, servlets

我想听听一些关于如何在 servlet 容器（即 Tomcat）上管理长期 XMPP 连接的评论。

基本上，我们有一个将登录凭据提交给 servlet 的客户端，我们为每个会话创建一个 XMPPConnection 并将其存储在 HttpSession 中。

为简单起见，客户端可以执行 4 种操作：登录、发送/接收消息、注销。

(1) 如您所见，XMPPConnection 的生命周期应该由客户端处理（控制）。在我们的例子中，HttpSession 有一个与之关联的超时。你认为对 HttpSession 的依赖是一个错误吗？

(2) 从垃圾收集的角度来看，如果 HttpSession 超时并且我们没有专门调用 XMPPConnection.disconnect() 是否有问题？我理解它的方式，一旦达到超时，会话范围内的所有对象都会被 GC 处理。如果仍然连接，VM 会犹豫并忽略 XMPPConnection 吗？

(3) HttpSession 超时和失效有什么区别？我的理解是超时是指一个特定的对象，而失效会删除所有内容。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T22:04:06.427

(1) 虽然可能有更好的方法，但我不一定认为在会话中存储 XMPP 凭据有问题。我最近做了类似的事情并依赖于 HttpSession。

(2) 为了解决您的超时问题，您有几个选择。您可以在任何 servlet 发送/接收消息 (session.setTimeout()) 中动态设置会话超时，或者您可以在 web.xml 中将其设为静态值（值 -1 表示没有超时）。然后您可以创建一个 SessionListener 并在 sessionDestroyed 上调用 XMPPConnection.disconnect()。

# c# - Best practice(s) for on screen real-time log viewer for log4net

> ID：724640
> 
> 赞同：13
> 
> 时间：2009-04-07T08:25:06.070
> 
> 标签：c#, logging, log4net

I have a multi-threaded C# application that use log4net for logging capabilities. Mainly the RollingFileAppender.

I want to offer the capability for the user to view the activity of the application in an "application log" window. This will consist of a listview (details mode), a grid or something similar.

I'm looking for best ways to do it. The only solution I have so far is to setup an UDP appender and create a special thread that will listen and foward all messages to the UI.

I also examined the possibility to create a "wrapper" that both write to the UI, the log the message using log4net... hum.

Thanks a lot in advance for your help.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-07T08:40:59.823

If you're happy to rely on another program you can use [dbgview](http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx) from Sysinternals. This will display anything that is logged with [Debug.WriteLine()](http://msdn.microsoft.com/en-us/library/system.diagnostics.debug.writeline.aspx) method. I think that the [OutputDebugStringAppender](http://logging.apache.org/log4net/release/sdk/log4net.Appender.OutputDebugStringAppender.html) will do this, but I've not used Log4Net so I can't be sure.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T08:40:51.507

Do you require viewing the persisted log data in this window? If so, I would recommend logging to a database. Then log4net can work undisturbed by the client which can read the log data from the database in a non-locking manner.

You could use SQL Server Compact edition if you don't want/have an Express or full server going.

Logging to database is done with the built-in log4net [AdoNetAdapter](http://logging.apache.org/log4net/release/config-examples.html).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-04T18:28:50.670

我同意彼得·利勒沃德的观点。这是一个简单的示例，说明如何通过动态设置日志记录的详细程度从控制台应用程序记录到数据库

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using log4net;
using log4net.Config;
using NUnit.Framework;

namespace ExampleConsoleApplication
{
    [TestFixture]
    class TestClass
    {

    //private static readonly ILog logger =
    //     LogManager.GetLogger ( typeof ( TestClass ) );

    private static readonly log4net.ILog logger = log4net.LogManager.GetLogger ( System.Reflection.MethodBase.GetCurrentMethod ().DeclaringType );

        static void Main ( string[] args )
        {

            Console.WriteLine ( " START " );
            #region LoggerUsage
            DOMConfigurator.Configure (); //tis configures the logger 
            logger.Debug ( "Here is a debug log." );
            logger.Info ( "... and an Info log." );
            logger.Warn ( "... and a warning." );
            logger.Error ( "... and an error." );
            logger.Fatal ( "... and a fatal error." );

            #endregion LoggerUsage
            TestClass objTestClass = new TestClass();
            objTestClass.TestMethodNameOK ();
            objTestClass.TestMethodNameNOK ();

            Console.WriteLine ( " END HIT A KEY TO EXIT " );
            Console.ReadLine ();
            } //eof method 

        [SetUp]
        protected void SetUp ()
        {
            //Add Here the Initialization of the objects 
        }
        [Test ( Description = "Add here the description of this test method " )]
        protected void TestMethodNameOK ()
        { 
            //build ok use case scenario here - e.g. no exception should be raced '
            //Vegetable newCarrot = pool.GetItemByPropertyValue<Vegetable> ( "WriongByPurpose", "Orange" );
            //Assert.IsInstanceOfType ( typeof ( Vegetable ), newCarrot );
            //Assert.AreSame ( newCarrot, carrot );
            //logger.Info ( " I got the newCarrot which is " + newCarrot.Color );

        } //eof method 

        [Test ( Description = "Add here the description of this test method " )]
        protected void TestMethodNameNOK ()         //e.g. the one that should raze Exception
        {
            //build ok use case scenario here - e.g. no exception should be raced '
            //Vegetable newCarrot = pool.GetItemByPropertyValue<Vegetable> ( "WriongByPurpose", "Orange" );
            //Assert.IsInstanceOfType ( typeof ( Vegetable ), newCarrot );
            //Assert.AreSame ( newCarrot, carrot );
            //logger.Info ( " I got the newCarrot which is " + newCarrot.Color );

        } //eof method 

    } //eof class 

} //eof namespace 

#region TheAppConfig
/*
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <section name="log4net"
                 type="log4net.Config.Log4NetConfigurationSectionHandler, log4net" />
    </configSections>

    <log4net>
        <appender name="LogFileAppender" type="log4net.Appender.FileAppender">
            <param name="File" value="Program.log" />
            <param name="AppendToFile" value="true" />
            <layout type="log4net.Layout.PatternLayout">
        <!--<param name="Header" value="======================================" />
        <param name="Footer" value="======================================" />-->
        <param name="ConversionPattern" value="%d [%t] %-5p - %m%n" />
      </layout>
        </appender>

        <appender name="ColoredConsoleAppender" type="log4net.Appender.ColoredConsoleAppender">
      <mapping>
        <level value="ERROR" />
        <foreColor value="Red" />
      </mapping>
      <mapping>
        <level value="DEBUG" />
        <foreColor value="HighIntensity" />
      </mapping>
      <mapping>
        <level value="INFO" />
        <foreColor value="Green" />
      </mapping>
      <mapping>
        <level value="WARN" />
        <foreColor value="Yellow" />
      </mapping>
      <mapping>
        <level value="FATAL" />
        <foreColor value="White" />
        <backColor value="Red" />
      </mapping>

      <layout type="log4net.Layout.PatternLayout">
                <conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline" />
            </layout>
        </appender>

        <appender name="AdoNetAppender" type="log4net.Appender.AdoNetAppender">
            <connectionType value="System.Data.SqlClient.SqlConnection, System.Data, Version=1.2.10.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
            <connectionString value="data source=ysg;initial catalog=DBGA_DEV;integrated security=true;persist security info=True;" />
            <commandText value="INSERT INTO [DBGA_DEV].[ga].[tb_Data_Log] ([Date],[Thread],[Level],[Logger],[Message]) VALUES (@log_date, @thread, @log_level, @logger, @message)" />

            <parameter>
                <parameterName value="@log_date" />
                <dbType value="DateTime" />
                <layout type="log4net.Layout.PatternLayout" value="%date{yyyy'.'MM'.'dd HH':'mm':'ss'.'fff}" />
            </parameter>
            <parameter>
                <parameterName value="@thread" />
                <dbType value="String" />
                <size value="255" />
                <layout type="log4net.Layout.PatternLayout" value="%thread" />
            </parameter>
      <parameter>
        <parameterName value="@domainName" />
        <dbType value="String" />
        <size value="255" />
        <layout type="log4net.Layout.PatternLayout" value="%user" />
      </parameter>
            <parameter>
                <parameterName value="@log_level" />
                <dbType value="String" />
                <size value="50" />
                <layout type="log4net.Layout.PatternLayout" value="%level" />
            </parameter>
            <parameter>
                <parameterName value="@logger" />
                <dbType value="String" />
                <size value="255" />
                <layout type="log4net.Layout.PatternLayout" value="%logger" />
            </parameter>
            <parameter>
                <parameterName value="@message" />
                <dbType value="String" />
                <size value="4000" />
                <layout type="log4net.Layout.PatternLayout" value="%message" />
            </parameter>
        </appender>
        <root>
            <level value="ALL" />
            <appender-ref ref="LogFileAppender" />
            <appender-ref ref="AdoNetAppender" />
            <appender-ref ref="ColoredConsoleAppender" />
        </root>
    </log4net>
</configuration>
*/
#endregion TheAppconfig

 //this is the xml added replace here your log4net and Nunit paths
//<Reference Include="log4net, Version=1.2.10.0, Culture=neutral, PublicKeyToken=1b44e1d426115821, processorArchitecture=MSIL">
        //  <SpecificVersion>False</SpecificVersion>
        //  <HintPath>..\..\..\Log4Net\log4net-1.2.10\bin\net\2.0\release\log4net.dll</HintPath>
        //</Reference>
        //<Reference Include="nunit.framework, Version=2.4.8.0, Culture=neutral, PublicKeyToken=96d09a1eb7f44a77, processorArchitecture=MSIL" /> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T08:29:14.170

What about writing your own appender that will fire an event when something happens? You can obtain it's instance by examining log4net repository.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-12T02:06:26.343

你可以试试 log4net 查看器。请参阅 Ayende 的博客文章[Watching the logs run with log4net](https://ayende.com/blog/1634/watching-the-logs-run-with-log4net)。

# c# - WindowsMo bile：处理来自 DialogForm 的异常后应用程序退出

> ID：724644
> 
> 赞同：1
> 
> 时间：2009-04-07T08:26:22.133
> 
> 标签：c#, winforms, exception, windows-mobile

我有以下简单的场景：

一个带有Button的DialogForm，Button_click会抛出异常。

一个带有按钮和标签的 MainForm，在单击时，我在 Catch 块中显示了 DialogForm 的新实例。

如果我在常规 WinForms 中运行此设置，我可以按预期捕获异常。

如果我在 WinMobile 中运行它（我已经在 WM5 和 WM6 Pro 上测试过），我可以使用调试器看到输入了 Catch 块，~~但异常继续传播~~并且应用程序死亡。

MainForm 中的代码如下所示：

```
try
{
   using (DialogForm frm = new DialogForm())
   {
     DialogResult r = frm.ShowDialog();
     label1.Text = r.ToString();
  }
}
catch (Exception ex)
{
  label1.Text = ex.Message;
} 
```

### 编辑：

我进一步调查了一下，在这段代码和 Application.Run() 周围有一个 catch {} 块，应用程序仍然退出。

显然它**不是**一个失控的异常，它被捕获和处理得很好。但在此操作之后，应用程序似乎执行了一个不需要的 Exit()。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T16:51:57.577

在修补之后，我发现了一些有用的东西：

```
try {
  // show Dialog that Throws
}
catch (Exception ex) {
  label1.Text = ex.Message;
  Application.DoEvents();  // this solves it
} 
```

**任何可以告诉我为什么**需要 DoEvents() 的人仍然可以享受赏金。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-13T23:16:09.360

您需要“DoEvents”的原因是，当表单仍然可用时，它会清除消息队列。

正在发生的事情是仍有消息等待针对引发异常的表单进行处理。通过在此处调用“DoEvents”，您可以在 using 块清理表单并停止处理队列上的消息之前处理它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T18:00:18.227

我能找到的最好的信息是你正在调用 ShowDialog()。

我尝试使用 Reflector，但它不处理 CF dll。所以最好的比较是看主要的非CF文件。在其中，如果您跟踪 ShowDialog() 函数，它最终会调用 Application.RunDialog(form)。在那里，它创建一个新的线程上下文并为对话窗口运行它自己的消息循环。

由于我无法查看实际的 CF DLL，我只能进行“有根据的猜测”。这似乎与异常发生在单独的消息循环中并且不会被正确捕获的事实有关，除非您通过 DoEvents() 处理应用程序的消息队列。

所以基本上，ShowDialog() 会导致在单独的消息循环上创建异常，并且除非您调用 DoEvents()，否则无法正确处理它被捕获的事实。

如果你尝试一个常规的 Show() 会发生什么？你还需要 DoEvents 吗？我没有测试这个的环境，所以我只能建议你尝试一下。如果您将其更改为 Show() 并且不再需要 DoEvents()，我认为我们将确定我是否正确。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-02-17T15:11:32.817

[https://connect.microsoft.com/VisualStudio/feedback/details/94356/modal-windows-in-net-compact-framework-application-stop-working-if-unhandled-exception-on-modal-dialog-is-提出#tabs](https://connect.microsoft.com/VisualStudio/feedback/details/94356/modal-windows-in-net-compact-framework-application-stop-working-if-unhandled-exception-on-modal-dialog-is-raised#tabs)

在紧凑框架 2.0 中，这是一个公认的问题……他们不在乎……

如果您在捕获异常后在 try 中使用 showdialog，则 showdialod 不再起作用....

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T12:02:55.093

虽然编程文档会声明以下构造是不必要的，但我发现有时我必须使用以下构造。

```
try
{
 using (DialogForm frm = new DialogForm())   
 {     
       DialogResult r = frm.ShowDialog();
       label1.Text = r.ToString();  
 }
}
catch (Exception ex)
{
    label1.Text = ex.Message;
}
catch
{
    label1.Text = "Unknown Exception";
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-10T09:41:42.060

也许挂钩`AppDomain.CurrentDomain.UnhandledException`（连同乔尔的提示）可以解决您的异常问题？可能类似于[其他 .NET 答案](https://stackoverflow.com/questions/406385/handling-unhandled-exceptions-problem#406473)。

我使用以下代码

```
 try
    {
        AppDomain.CurrentDomain.UnhandledException +=
            (object sender, UnhandledExceptionEventArgs e) =>
            {
                CrashOn((Exception)e.ExceptionObject, e.IsTerminating);
            };
        var mainWindow = new MainWindow();
        MobileDevice.Hibernate += (sender, e) => { mainWindow.Hibernate(); };
        Application.Run(mainWindow);
    }
    catch (Exception huh)
    {
        CrashOn(huh, false);
    } 
```

在`Program.Main()`我的[WM6 Professional twitter 客户端](http://twitter.com/peSHIrTweets)中。在这里，该`CrashOn()`方法将异常信息保存到磁盘并启动崩溃恢复可执行文件。然后，这会显示客户端崩溃的信息，可以选择将异常信息邮寄给我，并为使用提供退出或重新启动客户端的选项。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-13T11:37:35.750

根据其他答案和我对所需 DoEvents 的评论：您是否尝试检查您的原始 catch 语句是否`label1.InvokeRequired`可能`true`？

如果是这样，您可能在这里有某种与多线程相关的竞争条件，因为您正在设置`label1.Text`从另一个线程抛出的异常类的属性？

在常规的 .NET 1.0 中，这通常只是起作用，而它不应该起作用。在以后的版本中，忽略`InvokeRequired == true`会导致异常。我不确定紧凑框架如何处理此类“违规行为”。也许它只是存在这个过程呢？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-10T09:00:32.547

我记得 dot net 有一个默认的异常处理程序，当异常跨越特定边界时会触发它。正是这个处理程序导致您的应用程序退出。我记得一段时间前看过这个问题，但不幸的是不再可以访问代码。至于 .NET 和 .NET CF 之间的行为差​​异，这是因为两者处理帧的方式不同（可能 CF 中的帧没有父级或类似的东西）。

你可以加入这个默认的异常处理并做任何你想做的事情......我认为我实现的代码是这样的：[未处理的异常](http://www.codeproject.com/KB/dotnet/unhandledexceptions.aspx)

# python - Python distutils, how to get a compiler that is going to be used?

> ID：724664
> 
> 赞同：34
> 
> 时间：2009-04-07T08:36:07.227
> 
> 标签：python, compiler-construction, installation, distutils

For example, I may use `python setup.py build --compiler=msvc` or `python setup.py build --compiler=mingw32` or just `python setup.py build`, in which case the default compiler (say, `bcpp`) will be used. How can I get the compiler name inside my setup.py (e. g. `msvc`, `mingw32` and `bcpp`, respectively)?

UPD.: I don't need the default compiler, I need the one that is **actually** going to be used, which is not necessarily the default one. So far I haven't found a better way than to parse `sys.argv` to see if there's a `--compiler...` string there.

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2011-03-04T10:49:56.167

这是 Luper Rouch 的答案的扩展版本，它帮助我获得了一个 openmp 扩展，以便在 Windows 上同时使用 mingw 和 msvc 进行编译。在子类化 build_ext 之后，您需要将其传递给 cmdclass arg 中的 setup.py。通过继承 build_extensions 而不是 finalize_options，您将拥有要查看的实际编译器对象，因此您可以获得更详细的版本信息。您最终可以在每个编译器、每个扩展的基础上设置编译器标志：

```
from distutils.core import setup, Extension
from distutils.command.build_ext import build_ext
copt =  {'msvc': ['/openmp', '/Ox', '/fp:fast','/favor:INTEL64','/Og']  ,
     'mingw32' : ['-fopenmp','-O3','-ffast-math','-march=native']       }
lopt =  {'mingw32' : ['-fopenmp'] }

class build_ext_subclass( build_ext ):
    def build_extensions(self):
        c = self.compiler.compiler_type
        if copt.has_key(c):
           for e in self.extensions:
               e.extra_compile_args = copt[ c ]
        if lopt.has_key(c):
            for e in self.extensions:
                e.extra_link_args = lopt[ c ]
        build_ext.build_extensions(self)

mod = Extension('_wripaca',
            sources=['../wripaca_wrap.c', 
                     '../../src/wripaca.c'],
            include_dirs=['../../include']
            )

setup (name = 'wripaca',
   ext_modules = [mod],
   py_modules = ["wripaca"],
   cmdclass = {'build_ext': build_ext_subclass } ) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-11-04T00:37:28.550

您可以对`distutils.command.build_ext.build_ext`命令进行子类化。

一旦`build_ext.finalize_options()`方法被调用，编译器类型被存储`self.compiler.compiler_type`为一个字符串（与传递给`build_ext`'`--compiler`选项的那个相同，例如'mingw32'、'gcc'等）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-04T23:16:04.480

```
#This should work pretty good
def compilerName():
  import re
  import distutils.ccompiler
  comp = distutils.ccompiler.get_default_compiler()
  getnext = False

  for a in sys.argv[2:]:
    if getnext:
      comp = a
      getnext = False
      continue
    #separated by space
    if a == '--compiler'  or  re.search('^-[a-z]*c$', a):
      getnext = True
      continue
    #without space
    m = re.search('^--compiler=(.+)', a)
    if m == None:
      m = re.search('^-[a-z]*c(.+)', a)
    if m:
      comp = m.group(1)

  return comp

print "Using compiler " + '"' + compilerName() + '"' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-17T14:17:00.913

```
import sys
sys.argv.extend(['--compiler', 'msvc']) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-07T04:22:45.107

```
class BuildWithDLLs(build):

    # On Windows, we install the git2.dll too.
    def _get_dlls(self):
        # return a list of of (FQ-in-name, relative-out-name) tuples.
        ret = []
        bld_ext = self.distribution.get_command_obj('build_ext')
        compiler_type = bld_ext.compiler.compiler_type 
```

您可以使用 self.distribution.get_command_obj('build_ext') 获取 build_ext 实例，然后获取 compiler_type

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-07T09:04:37.270

导入 distutils.ccompiler

compiler_name = distutils.ccompiler.get_default_compiler()

# visual-c++ - Problem with glui

> ID：724667
> 
> 赞同：0
> 
> 时间：2009-04-07T08:37:22.390
> 
> 标签：visual-c++, opengl, header

i was trying out a free code i downloaded from the internet,
when i compiled it says..
"Error 2 fatal error LNK1104: cannot open file 'glui32d.lib' MarchingCubesGLUI MarchingCubesGLUI"

i cant seems to find much reference online about GLui,
i know i dont have glui.h .dll and .lib files etc etc.

so what should/can i do?

FYI: i'm using VS 2008's c++

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T08:22:40.520

请检查[http://glui.sourceforge.net/](http://glui.sourceforge.net/)。

正如那里所说：“GLUI 是一个基于 GLUT 的 C++ 用户界面库，它为 OpenGL 应用程序提供按钮、复选框、单选按钮和微调器等控件。它独立于窗口系统，依赖 GLUT 来处理所有系统-相关问题，例如窗口和鼠标管理。”

所以，恕我直言，你应该做的是从站点下载 glui-2.35.zip，将其解压缩到一个目录中并构建 GLUI 可执行文件（dll 和 lib）。请参阅下载的 zip 中包含的 readme.txt 文件中的说明。

下一步是确保其他包含目录也包含要包含在您的 gui 安装中的路径，并且之前构建的 lib 包含在您尝试编译的项目中。

希望这能解决您的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T08:39:03.790

You need to locate the needed library (.lib) file, and put it somewhere where the compiler can find it during the linking phase of building your program.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T10:35:45.897

首先确保您已安装 openGL。我不确定，但如果它没有与 Visual Studio 2008 一起安装，您应该从 Platform SDK 安装它，可从 Microsoft 网站下载。

然后，确保包含目录和库目录的列表中有 OpenGL 的头文件和库文件所在的文件夹。（转到工具/选项，“项目和解决方案/VC++ 目录”部分。

# sql - SQL Server 标识列值从 0 而不是 1 开始

> ID：724668
> 
> 赞同：48
> 
> 时间：2009-04-07T08:38:21.827
> 
> 标签：sql, sql-server, sql-server-2005, identity, auto-increment

我遇到了一个奇怪的情况，我的数据库中的一些表的 ID 从 0 开始，即使 TABLE CREATE 具有 IDENTITY(1,1)。对于某些表是这样，但对于其他表则不然。它一直有效到今天。

我试过重置身份列：

```
DBCC CHECKIDENT (SyncSession, reseed, 0); 
```

但是新记录从 0 开始。我尝试对所有表都这样做，但有些仍然从 0 开始，有些从 1 开始。

任何指针？

（我正在使用带有高级服务的 SQL Server Express 2005）

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-04-07T08:49:22.750

来自[DBCC CHECKIDENT](http://technet.microsoft.com/en-us/library/ms176057(SQL.90).aspx)

```
DBCC CHECKIDENT ( table_name, RESEED, new_reseed_value ) 
```

> 如果自创建表以来没有向表中插入任何行，或者使用 TRUNCATE TABLE 语句删除了所有行，则在运行 DBCC CHECKIDENT 后插入的第一行使用 new_reseed_value 作为标识。否则，插入的下一行使用 new_reseed_value + 当前增量值。

因此，对于空表或截断表，这是预期的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2014-03-05T14:07:58.693

如果您传递一个重新种子值，则数据库将从该新值开始标识：

```
DBCC CHECKIDENT (SyncSession, RESEED, 0); --next record should be 0 + increment 
```

但是，您不必传递 a 值，如果您不这样做，`IDENTITY(a,b)`则会被使用：

```
DBCC CHECKIDENT (SyncSession, RESEED); --next record should be the seed value 'a' 
```

这通常是更好的做法，因为它使表更接近其初始创建状态。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T08:43:46.867

这是合乎逻辑的，因为您已将身份值更改（重新播种）为零？

```
DBCC CHECKIDENT (SyncSession, reseed, 1) 
```

将重新设置您的身份列，并确保第一条新记录以 1 开头。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-30T15:01:10.233

我有同样的问题，修改数据库后从备份中恢复。我只是添加一个虚拟记录，然后将其删除......然后将 RESEED 设置为 0。似乎工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-20T14:20:58.177

试试这个

```
DECLARE @c TABLE (TanvtechId varchar(10),NewTanvtechId Varchar(10))
INSERT INTO @c
SELECT TanvtechId , Row_Number() OVER (ORDER BY TanvtechId ) from Tanvtech 

UPDATE G
SET G.TanvtechId =a.NewTanvtechId 
FROM Tanvtech as G INNER JOIN @c as a ON a.TanvtechId =G.TanvtechId 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-09-09T09:54:05.703

当前接受的答案仅解释了这种烦人的现象。只有一个答案提供了某种解决方案，但并不真正实用，因为它需要一个虚拟插入，这使得它难以概括。

唯一通用的解决方案是重新设定标识值，然后检查当前标识值并在`0`. 这可以通过存储过程来完成：

```
CREATE OR ALTER PROCEDURE ReseedIdentity
    @tableName SYSNAME
AS
BEGIN
    DBCC CHECKIDENT(@tableName, RESEED, 0)
    IF IDENT_CURRENT(@tableName) = 0
    BEGIN
        DBCC CHECKIDENT(@tableName, RESEED, 1)
    END
END 
```

这将始终以标识值开始新记录`1`，无论是新表，截断后还是删除所有记录后。

如果存在从更高种子值开始的身份规范，则可以使用更高级的版本，这是前者的概括：

```
CREATE OR ALTER PROCEDURE ReseedIdentity
    @tableName SYSNAME
AS
BEGIN
    DECLARE @seed NUMERIC(18,0) = IDENT_SEED(@tableName) - 1;
    DBCC CHECKIDENT(@tableName, RESEED, @seed)
    IF IDENT_CURRENT(@tableName) = @seed
    BEGIN
        SET @seed = @seed + 1
        DBCC CHECKIDENT(@tableName, RESEED, @seed)
    END
END 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2016-05-26T07:12:36.900

```
DBCC CHECKIDENT ( Table_Name, RESEED, 0 ) 
```

这是一种以 w​​ith 开头的方法`id`，`Zero(0)`然后从表中删除所有行，然后再次将数据放回表中。

# sharepoint - 无法捕获 SharePoint Access denied 错误

> ID：724679
> 
> 赞同：7
> 
> 时间：2009-04-07T08:43:58.130
> 
> 标签：sharepoint, sharepoint-2007, moss

我正在尝试在 webpart 中以编程方式访问共享点列表，如下所示。

```
try
{
      masterList = web.Lists[listId];
}
catch(Exception e)
{
      RenderExceptionMessage(e.Message);
} 
```

RenderExceptionMessage() 方法应该在 Web 部件内显示用户友好的错误消息。

但问题是我无法捕获异常。相反，webpart 页面重定向到访问被拒绝页面，该页面显示错误消息“您当前登录为：域\用户”

此外，捕获的异常消息显示“无法评估表达式，因为代码已优化或本机框架位于调用堆栈顶部。”

知道为什么会这样吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-07T10:33:28.443

默认情况下，SharePoint 对页面/Web 服务请求中的拒绝访问异常（包括重定向到自定义页面）进行自定义处理，绕过代码中的异常处理。

要禁用此自定义处理，请将[SPSecurity.CatchAccessDeniedException](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spsecurity.catchaccessdeniedexception.aspx)设置为 false。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T12:23:23.577

也许另一种处理方法是添加一些防御性编程，例如检查以确保用户可以访问 SPWeb 和/或 SPList。在我的脑海中，我认为 SPWeb.EnsureUser 可以提供帮助。SPList.CheckPermissions 或 SPList.DoesUserHavePermissions 也可能有所帮助。

# c# - CruiseControl.NET 中 C# 自动化 Web 测试的“测试艺术”

> ID：724682
> 
> 赞同：3
> 
> 时间：2009-04-07T08:44:51.730
> 
> 标签：c#, nunit, cruisecontrol.net, web-testing, webaii

我们目前使用 SWEA ( [http://webiussoft.com](http://webiussoft.com) ) 在 CruiseControl.NET 夜间构建期间运行站点的自动化测试。

我们正在寻找一个更强大的解决方案，我们正在寻找“测试艺术”（[http://www.artoftest.com](http://www.artoftest.com)）解决方案。

有没有人使用过这个工具？

最重要的是，使用这个工具维护测试有多容易？

或者您会推荐任何其他 C#/NUnit/CruiseContol.NET 解决方案吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T21:09:36.423

我为 ArtOfTest 工作。在过去的几天里，我一直在研究如何让我们的框架与 CruiseControl.NET 很好地配合使用。主要的关键是在控制台模式下运行 CruiseControl.NET 服务器（而不是作为 Windows 服务）。这样做的原因是为了让单元测试运行阶段能够直接与桌面交互，这是 UI 测试所必需的。通常，在 Windows 服务下运行的代码不允许与桌面交互（这是我们需要的），因此在尝试时会失败。

TeamCity 也是另一个不错的 CI 服务器。我现在正在看它，并且大部分都已经弄清楚了。

如果您有任何其他更具体的问题，请随时通过contact@artoftest.com 与我们联系。我也会监视这个线程。

WatiN 还不错。不幸的是，它缺少任何类型的 VisualStudio 集成，并且缺少我们提供的许多其他功能。

谢谢，科迪

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-22T23:05:47.280

下面的链接是关于如何让 WebAii 与所有流行的 CI 服务器（CC、TeamCity 和 TFS Build）一起工作的文档

[http://www.artoftest.com/support/webaii/topicsindex.aspx?topic=cioverview](http://www.artoftest.com/support/webaii/topicsindex.aspx?topic=cioverview)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T22:41:53.467

另一种选择可能是[WatiN](http://sourceforge.net/projects/watin/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T17:23:02.317

似乎两个大的是 Watin 和 Selenium。我没有对 Selenium 做过任何工作，所以没有意见。

我已经使用了相当多的Watin，它非常好，但是有很多问题。可能很难处理来自浏览器的巨大变化的响应时间......设置超时持续时间等。

最新版本的 Watin 支持 IE & Firefox，非常酷。

至于测试维护，根据我的经验，最重要的是将“测试驱动程序”代码与“页面包装代码”完全分开。“测试驱动程序”是指实际的测试逻辑（NUnit 或类似的），其代码可能如下所示：

...

```
var wrapper = new SearchPageWrapper(browser);
wrapper.ClickAdvancedSearch();
wrapper.EnterSearchPhrase("dog");
wrapper.SetSortBy(SortType.Date);
wrapper.ExecuteSearch(); 
```

...页面包装器将这个逻辑接口暴露给页面本身，同时隐藏实现细节（这可能很复杂并且经常随着页面布局而改变）：

```
public class SearchPageWrapper {
  ...
  public void ClickAdvancedSearch() {
    _browser.Buttons("advSearch").Click();
  }

  public void EnterSearchPhrase(string phrase) {
    _browser.TextBox(Find.ByName("phrase")).TypeText(phrase);
  }
  ... etc ...
} 
```

通过这种方式，您构建了一个包装器库，可以轻松添加新的测试用例，并且还可以减少处理影响 Watin 查找和与页面上元素交互方式的布局更改的痛苦。

# c# - Web服务参数说明

> ID：724692
> 
> 赞同：3
> 
> 时间：2009-04-07T08:49:58.397
> 
> 标签：c#, web-services

是否可以为 (asmx)-webservice 中使用的参数创建描述？我知道我可以使用 Description-property 设置 webmethod 的描述。但是，是否也可以向参数添加属性以在 Web 服务中为给定参数创建描述

```
[WebMethod(Description = @"Get all approved friends <br /> 
    where rownum >= StartPage * count AND rownum < (StartPage+1) * count")]
public Friend[] GetFriendsPaged(int startPage, int count){...} 
```

例如，在上面给出的示例中，我想添加 StartPage 是基于 0 的文档。

提前致谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T11:34:35.210

没有办法做到这一点，即使您可以添加信息，也没有关于如何处理信息的标准。确实，WSDL 可以包含任何元素的注释，但是没有标准可以将这些注释放入生成的代理类中的注释中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T11:23:30.587

我找不到任何方法。我想您必须将文本放入 Webmethod 的描述中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-19T10:17:41.047

到目前为止，我已经设法将 html 标签放在描述中（比如指向我们的 wiki 页面），例如： `<a href=link>Service Wiki</a>`

# .net - 根据数据找出字段类型

> ID：724695
> 
> 赞同：0
> 
> 时间：2009-04-07T08:50:59.610
> 
> 标签：.net, import

我正在执行从一个系统到另一个系统的一次性导入例程。第一步是从大量 csv 文件中导入大量数据。每个 csv 文件中的第一行是字段名制表符分隔。其余的是数据，也是制表符分隔的，行是用 CR 分隔的。

我编写了一个 20 行的例程来创建表并将数据读入 sql 数据库。我将所有仅包含数字数据且字段名称中具有“ID”的字段设置为 INT，其余字段设置为 NVARCHAR (255)。

现在我想对其进行细化，使其查看数据并尝试找出每列中包含的数据类型。有时间、日期、id 字段、文本字段和数字字段。

我知道如何做到这一点，它相当容易，但我想知道在这方面是否有一些工作，以及是否有一些类可以处理这个问题。

找出首选尺寸更难。我认为我必须 1\. 查看所有行并找出每列最长的数据。2\. 有一个查找表，我将例如长度 0-50 映射为 100，长度 51-255 映射为 255，依此类推。

有人对此有一些聪明的意见吗？正如我所说的，这并不是什么特别难做的事情，但最好是制作一个智能库，以便稍后在其他导入场景中使用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T08:57:05.663

我会运行一个预处理阶段——分析 CSV 文件中的数据以计算出 nvarchar 的合理容量——例如，nvarchar(20) 或 nvarchar(2000)。我会让它打印一个带有每个列的示例条目的报告 - 实际上甚至生成“创建表” SQL 语句，您可以在运行之前手动编辑该语句。如果列中的每个条目都格式化为数字，则将其设为 int，依此类推。

作为一次性的事情，我完全希望您应该在运行数据导入之前直观地检查您将首先创建的每个表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T11:20:15.743

您是否考虑过 ADO.NET？您可以将数据读入数据集吗？

连接字符串如下所示：“Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\TxtFile\;Extended Properties='text;HDR=Yes;FMT=Delimited'” 请注意 HDR=YES，您将需要。

然后，当您连接到目录时，您可以使用 select 语句，例如：

“选择 * 从 data.txt”

还有其他设置可以调整查看多少行以确定类型等。您可以查看 schema.ini 文件以手动调整类型。此外，您可以将注册表项 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Jet\4.0\Engines\Text 设置为： ImportMixedTypes=Text from default 'Majority Type'

我还在 Excel 文件上使用了 SQL 导入表（在 Excel 中打开后保存 csv 文件后）。这也可以。虽然没有什么能完美运行 - 有时我仍然发现使用一些手动编码并自己检查列数据更容易。

# c# - 调试程序集加载问题

> ID：724699
> 
> 赞同：5
> 
> 时间：2009-04-07T08:52:57.547
> 
> 标签：c#, .net, visual-studio, mstest, fileloadexception

在单元测试期间我遇到了一个非常奇怪的问题（Visual Studio 中的 MSTest - .NET 3.5 SP1）：

1.  我单击“在解决方案中运行所有测试”
2.  所有测试都通过，*除了*一个特定的类，其中每个测试都会引发以下异常：“System.IO.FileLoadException：加载此程序集会产生与其他实例不同的授权集。（来自 HRESULT 的异常：0x80131401）。”
3.  然后我去在课堂上设置一个断点。结果：类中的所有测试都通过（之前失败的相同测试）。
4.  我单击“在解决方案中运行所有测试”。所有测试都通过了，除了*另一个*类。
5.  我去在课堂上设置一个断点。结果：班级中的所有测试均通过
6.  我单击“在解决方案中运行所有测试”。所有测试都通过了，除了第一个测试类。
7.  等等

如您所见，问题非常不一致，因此难以调试。

我曾尝试使用 Fusion Log Viewer，但这给了我不太理解的令人困惑的结果。

我应该寻找什么？有没有其他人遇到过这个问题？

**更新：** 要求提供一些附加信息。

测试已经运行好几个月了——我想我上次运行它们是在星期四，然后它们运行良好。我一直在尝试检查源代码控制历史，看看是否有什么变化，但没有什么异常。

我可以在不同的日子追溯并检查该项目，但我们正在使用 Visual Source Safe（我知道 - 不是我的决定 :-( ）所以我犹豫要不要这样做。

这些测试是常规的单元测试，我使用 Moq 来模拟对象......但正如我所说 - 它直到最近都运行良好。

我只是希望有关如何调试此问题的一些建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-04T00:47:53.383

我们也遇到了这个问题，虽然它只发生在我们的构建服务器上（我们安装了 VS2008 以便将 MSTest 与 MSBuild 一起使用），而不是本地发生。我们在构建服务器上的 VS2008 版本中安装了[此修补程序](http://connect.microsoft.com/VisualStudio/Downloads/DownloadDetails.aspx?DownloadID=16827)，从而消除了此问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T09:15:51.110

显然这是一个错误。毫无疑问，您已经找到了这个，但以防万一，这里有一个链接。

[http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=95157](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=95157)

希望能帮助到你。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T13:17:21.177

这里描述的问题只发生在我的机器上。我尝试清除我的 VS2008 设置，禁用所有加载项并在不同的位置检查项目，但都没有成功。现在我认为重新格式化机器之前的最后一个可能的解决方案是重新安装 VS2008，我目前没有时间，所以我现在只能忍受这个问题。

# svn - 如何撤消“svn 副本”

> ID：724707
> 
> 赞同：16
> 
> 时间：2009-04-07T08:54:38.090
> 
> 标签：svn, copy, undo

我不小心用'svn copy'复制主干覆盖了一个旧分支。更具体地说，对于每个版本，主干都会分支并作为标签保存，使用：

```
svn copy svn://machine/REPOS/trunk svn://machine/REPOS/tags/$RELEASENR 
```

但这一次，'RELEASENR' 的值是旧的现有分支而不是新分支的值。有人对如何撤消这个错误有任何想法吗？已经谢谢了！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-07T09:20:10.273

Subversion 不是这样工作的。你实际上并没有覆盖它。如果复制或移动的目标存在并且是目录，则复制或移动的项目将放置*在*该目录中：

```
svn copy svn://machine/REPOS/trunk svn://machine/REPOS/tags/EXISTS_ALREADY 
```

如果你看，你应该会发现：

```
svn://machine/REPOS/tags/EXISTS_ALREADY/trunk 
```

这是您刚刚尝试标记的主干的副本。这种情况下的修复很简单：

```
svn mv svn://machine/REPOS/tags/EXISTS_ALREADY/trunk \
       svn://machine/REPOS/tags/CORRECT_TAG_NAME 
```

（如果您不熟悉 *nix：\ 表示我已将一条逻辑线分成两条物理线，以免水平滚动条过度劳累。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-11-12T10:32:10.423

为了撤消

```
svn cp OLDFOLDER NEWFOLDER 
```

如果更改尚未提交，只需使用

```
svn revert NEWFOLDER --depth=infinity 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-03T23:27:06.007

您可以通过合并回上一个版本来撤消上一个版本。见[http://anilsaldhana.blogspot.com/2007/11/svn-undo-change.html](http://anilsaldhana.blogspot.com/2007/11/svn-undo-change.html)

```
svn merge --revision 92:91 . 
```

然后提交

# php - 检查启用的 php.ini 文件“extension=php_pdo_mysql.dll”但仍然错误

> ID：724712
> 
> 赞同：4
> 
> 时间：2009-04-07T08:57:19.113
> 
> 标签：php, open-source, symfony1

我检查了启用扩展的 php.ini 文件：

```
extension=php_pdf.dll
extension=php_pdo.dll
extension=php_pdo_firebird.dll
extension=php_pdo_mssql.dll
extension=php_pdo_mysql.dll 
```

但是当我尝试打开页面时仍然出现错误

500 | 内部服务器错误 | PropelException 无法打开 PDO 连接 [包装：找不到驱动程序]

我现在需要做什么？消除这个错误

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T11:34:08.953

*   找出您实际需要的 PDO 驱动程序（MySQL、MS SQL...？）

*   通过自己实例化 PDO 进行测试，以避免其他地方出现错误：

    `$db = new PDO('mysql:host=127.0.0.1;dbname=testdb', 'username', 'password');`

如果你仍然得到“找不到驱动程序”，现在你可以确定你真的错过了它:)

如何安装它，如果你还没有，很大程度上取决于你的系统。例如，在 Debian Linux 上，您需要执行`apt-get install php5-mysql`、安装`mysql`和扩展。`mysqli``pdo_mysql`

安装后，确保它在`php.ini`. 确保您正在编辑**正确**的文件 - 您的网络服务器使用的文件。

之后，要验证扩展是否正确加载，请执行以下任一操作：

*   创建一个执行的脚本`phpinfo()`。您应该看到一个*PDO*部分，其中包含一个关键*PDO 驱动程序*和一个值，例如“ `mysql, pgsql`”，或者

*   从命令行运行`php -m`，你应该看到`pdo_mysql`例如。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T12:23:46.417

扩展目录中的 php_pdo_mysql.dll 可能正在尝试加载默认情况下位于 php 目录中的 libmysql.dll 或 mysql.dll（我认为 - 它们至少在我的 php 目录中，但我很久以前就安装了它，我可以'不记得它们是默认存在还是我复制了它们）。如果 php 目录不在您的 PATH 中，则将找不到后面的这些 dll 并导致错误。

我建议检查 libmysql.dll 和/或 mysql.dll 是否在您的 php 目录中。如果是这样，请将您的 php 目录添加到系统的 PATH 并重新*启动*您的计算机。我有同样的问题，将php目录添加到系统路径，*重新启动*Apache，问题没有解决。在 Apache/PHP 在 php 目录中找到 dll 之前，我需要重新启动。

另一种方法是将 libmysql.dll 和 mysql.dll 复制到默认搜索的目录中（是 Windows 目录还是 Window\System32 目录）。加载 php_pdo_mysql.dll 后，它将能够找到相关的 dll。

如果这两个 dll 不在您的 php 目录中，请尝试下载并安装 MySQL。您可能会在我的 MySQL 安装程序安装的文件中找到这些 dll。

如果您使用的是 Apache，它应该会在错误日志中报告它无法加载 php_pdo_mysql.dll。如果没有，也许它在启动时报告了一些其他错误。从日志中发布任何错误可能有助于诊断。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T09:18:03.320

在 php.ini 中设置以下内容以检查加载扩展是否有问题。

```
display_startup_errors = On 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-08T14:05:22.530

你在使用命令行吗？

通常命令行和浏览器中的 PHP 使用不同的 PHP.ini 文件。

使用 phpinfo() 检查 borwser 中包含的模块 使用 PHP -m 查看通过 CLI 安装的模块

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T17:51:49.013

*   过去我遇到过问题，尽管 DLL 位于 php/ext/ 目录中并且尽管 php 路径设置正确，但我必须指定扩展的绝对路径。

*   检查 Apache 错误日志以查看加载扩展是否有问题

# php - function.require-once 在我的 wamp 服务器中出错

> ID：724713
> 
> 赞同：0
> 
> 时间：2009-04-07T08:57:34.807
> 
> 标签：php

我试图运行这样的东西：

```
<a href="login.php?logout=1" id="logout">logout</a>

<div id="main">

<?php require_once('getPhotos.php') ; ?>

<div id="response" class="hidden" />
</div><!-- end main--> 
```

> 但我收到这个错误。

**警告：require_once(1) [function.require-once]：无法打开流：第 17 行的 C:\wamp\www\myPhotosWebsite\index.php 中没有这样的文件或目录
致命错误：require_once() [function.require ]：在第 17 行的 C:\wamp\www\myPhotosWebsite\index.php 中打开失败需要 '1' (include_path='.;C:\php5\pear')**

> 任何建议......我做错了什么

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T09:00:30.790

它在文件夹 c:\wamp\myPhotosWebsite\ 或 c:\php5\pear 中找不到文件 getPhotos.php

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T09:17:50.793

*   getPhotos.php 存在吗？
*   它在哪里？
*   是这样写的吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T10:07:03.327

您所需的文件不在主脚本的目录中，也不在配置的包含目录中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T10:40:14.247

看起来比较奇怪。它看起来确实很奇怪，因为错误消息说它无法打开文件“1”，但不能打开文件“getPhotoes.php”。这让我觉得字符串 'getPhotoes.php' 是算术表达式的一部分。

我建议尝试

*   用双引号替换单引号
*   在 require_once 调用中关闭括号后删除空格。

应该是这样的：

```
<?php require_once("getPhotos.php"); ?> 
```

另一个疯狂的猜测是`require_once`文件（或 require_once 所需的另一个文件）中有另一个调用，其参数中有一个算术表达式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T10:50:21.790

最好总是使用

```
<?php require_once(".\getPhotos.php"); ?> 
```

不要忘记，如果您已经使用 require 来“运行”您的 index.php（不应该是这种情况），那么 require("xxx.php") 可能不会在与 index 相同的目录中打开 xxx.php。 php

# excel - 自重定向 .Asp 页面并保持相同的请求变量

> ID：724714
> 
> 赞同：0
> 
> 时间：2009-04-07T08:58:06.317
> 
> 标签：excel, redirect, formatting, self

我试图将页面的内容转换为 Excel 格式，问题是当我重定向页面时我没有得到我的请求变量，所以我找到了一个解决方案，我们应该为每个请求变量定义一个隐藏变量，然后定义Get 调用后的值。这是现在使用的代码：

```
<script language="Javascript">
   function exportToExcel()
   {
     document.frm.hndExcel.value = "true";
     document.frm.submit();
   }
</script>

<form name="frm" method="get" action="LibGetStatistics.asp" ID="Form1">
 <% if Request.QueryString("hndExcel") = "true" then
    Response.ContentType = "application/vnd.ms-excel"
 end if%>

 <%= GetStatistics() %>
  <input type="hidden" name="hndExcel" value="false" ID="Hidden1">
  *<input type="hidden" name="ShowOverDueBooks" value="
         <%=Request.QueryString "ShowOverDueBooks")%>" ID="Hidden2">
  <input type="hidden" name="StartDate" value="
         <%=Request.QueryString("StartDate")%>" ID="Hidden3">
  <input type="hidden" name="EndDate" value="
         <%=Request.QueryString("EndDate")%>" ID="Hidden4">*

 <a href="JavaScript:exportToExcel();"><img src='vimages/excel.gif' border=0></a>
</form> 
```

问题是当我想以其他形式使用此代码时，我需要为每个请求变量声明一个隐藏变量。有没有其他方法可以概括此代码，所以当我们发回页面时，我们会保留相同的请求。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T09:29:31.297

同样，经过一些尝试，我找到了一个不使用隐藏变量的通用解决方案，我们只需使用 Request.QueryString 属性：

```
<script language="Javascript">
function exportToExcel()
{
    document.frm.hndExcel.value = "true";
    document.frm.action='LibGetStatistics.asp?' + '<%=Request.QueryString%>';
    document.frm.submit();
}
</script>

<form name="frm" method="post"  ID="Form1">
    <input type="hidden" name="hndExcel" value="false" ID="Hidden1">
    <% if Request.Form("hndExcel") = "true" then
        Response.ContentType = "application/vnd.ms-excel"
    end if%>

    <%= GetStatistics() %>
          <a href="JavaScript:exportToExcel();">
              <img src='vimages/excel.gif' border=0></a>
</form> 
```

我希望这能帮助那些将面临这个问题的人。

# iphone - iPhone：更改自定义按钮图形

> ID：724721
> 
> 赞同：0
> 
> 时间：2009-04-07T08:59:25.987
> 
> 标签：iphone, cocoa-touch

我需要以编程方式更改自定义按钮的图形，我很困惑为什么下面的代码不起作用。我可以取消注释第一行并隐藏按钮，因此连接了 IBOutlet。变量 cardString 指向一个有效的图像 (0-51.jpg)。

```
 //[c1 setHidden: YES];
   cardString = [NSString stringWithFormat:@"%d%s", cards[0],".jpg"];
   card = [UIImage imageNamed: cardString];
   [c1 setBackgroundImage:card forState:UIControlStateNormal];
   NSLog(cardString); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T09:35:07.820

没关系。使用 setImage 而不是 setBackgroundImage

# ruby-on-rails - 瑞克究竟是什么？

> ID：724724
> 
> 赞同：81
> 
> 时间：2009-04-07T08:59:52.833
> 
> 标签：ruby-on-rails, ruby, rake

简单来说，Rake 是做什么的？它有什么目的？我知道这是一个构建工具，但我正在寻找更多细节。

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2013-11-29T16:41:48.317

这些答案假设您知道 DSL 是什么，或者熟悉 Make 或 Ant。如果不是这样，这里有一个（可能过于简单化的答案）：

[Rake](http://rake.rubyforge.org/)是一个可以用于[Ruby](https://www.ruby-lang.org)项目的工具。它允许您使用 ruby​​ 代码来定义可以在命令行中运行的“任务”。

Rake 可以作为 ruby​​ gem[下载并包含](http://rake.rubyforge.org/#label-Installation)在 ruby​​ 项目中。

安装后，您可以在添加到项目中的名为“ [Rakefile ”的文件中定义任务。](http://rake.rubyforge.org/doc/rakefile_rdoc.html)

我们称它为“构建工具”，因为 Rake 带有一些库，可以轻松完成构建/部署过程中常见的任务，例如[文件操作](http://martinfowler.com/articles/rake.html#FileTasks)（创建、删除、重命名和移动文件），通过[FTP](http://ruby-doc.org/stdlib-2.0.0/libdoc/rake/rdoc/Rake/FtpUploader.html)发布站点/ [SSH](http://ruby-doc.org/stdlib-2.0.0/libdoc/rake/rdoc/Rake/SshDirPublisher.html)，并[运行测试](http://rake.rubyforge.org/classes/Rake/TestTask.html)。

更多信息，这里是项目文档：[http ://rake.rubyforge.org/](http://rake.rubyforge.org/)

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-04-07T09:04:25.490

试试 Martin Fowler 关于 Rake 的文章了解更多信息：

[http://martinfowler.com/articles/rake.html](http://martinfowler.com/articles/rake.html)

他的序言是：

> Rake 是一种构建语言，目的类似于 make 和 ant。与 make 和 ant 一样，它是一种特定于领域的语言，与这两种语言不同，它是一种用 Ruby 语言编程的内部 DSL。在这篇文章中，我介绍了 rake 并描述了我使用 rake 来构建这个网站的一些有趣的事情：依赖模型、综合任务、自定义构建例程和调试构建脚本。

项目主页上也有更多信息或链接：

[http://rake.rubyforge.org/](http://rake.rubyforge.org/)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-07T09:21:20.863

Rake 允许您通过一个不错的命名空间 api 执行 Ruby 代码。一个例子是 rake db:migrate。您可以在其他任务之前和之后自动运行任务。就这些。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-04-07T09:10:44.477

[Rake](http://Rake.RubyForge.Org/)是[Ruby 编程语言中](http://Ruby-Lang.Org/)[基于依赖的声明式编程](http://MartinFowler.Com/articles/rake.html#DependencyBasedProgramming)的实现。基本上，Rake 之于 Ruby 就像[Make](http://OpenGroup.Org/onlinepubs/009695399/utilities/make.html)之于 C 一样，有一个显着的区别，那就是 Make 是一个外部[DSL](http://MartinFowler.Com/bliki/DomainSpecificLanguage.html)，而 Rake 是一个内部 DSL。

# iphone - 关于iPhone应用程序状态的另一个问题

> ID：724727
> 
> 赞同：5
> 
> 时间：2009-04-07T09:00:30.960
> 
> 标签：iphone, objective-c, cocoa, state, nsuserdefaults

我有另一个关于在 iPhone 上恢复应用程序状态的问题。简单的数据（比如选择的标签）可以存储在 NSUserDefaults 中，但这还不够。

我想恢复整个状态，包括导航控制器（转到子子视图控制器）。

我的问题是我的应用程序被分成了几个xib文件，所以一开始所有的View Controller都没有实例化。有没有办法从 xib 文件中“强制”实例化？

（我手下没有代码，不过看不清楚可以尝试写一个小端）

非常感谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T10:11:10.043

调用`[viewController view]`将确保加载给定视图控制器的 XIB；一旦它是，您可以正常使用它的任何其他属性。

这是我倾向于做的事情：

```
@class Record;  // some model object--I assume it has an integer record ID
@class DetailViewController;

@interface RootViewController : UIViewController {
    IBOutlet DetailViewController * detailController;
}

- (void)restore;
...
@end

@implementation RootViewController

// Note: all detailController showings--even ones from within 
// RootViewController--should go through this method.
- (void)showRecord:(Record*)record animated:(BOOL)animated {
    [self view];    // ensures detailController is loaded

    [[NSUserDefaults standardUserDefaults] setInteger:record.recordID 
                                               forKey:@"record"];
    detailController.record = record;

    [self.navigationController pushViewController:detailController 
                                         animated:animated];
}

- (void)restore {
    int recordID = [[NSUserDefaults standardUserDefaults] integerForKey:@"record"];

    if(recordID) {
        Record * record = [Record recordWithID:recordID];
        [rootViewController showRecord:record animated:NO];
        // If DetailViewController has its own state to restore, add this here:
        // [detailController restore];
    }
}
...
- (void)viewDidAppear:(BOOL)animated {
    [[NSUserDefaults standardUserDefaults] removeObjectForKey:@"record"];
}
@end

@implementation MyAppDelegate

- (void)applicationDidFinishLaunching:(UIApplication*)application {
    ...
    [rootViewController restore];
    ...
}
...
@end 
```

视图层次结构的每个级别都负责自己的状态保存，因此应用程序控制器不必知道所有可能的视图以及它们可能处于哪些顺序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T09:59:40.960

我在我的应用程序 Litho Graph 中执行此操作。如果您在退出时位于某个页面上，那么在您下次启动时，它会将您恢复到该页面。这也很简单：在我的主视图控制器的 -viewDidLoad 实现中，我检查用户默认值中的最后一页查看键。如果什么都没有，我会照常继续（并显示所有页面的列表）。如果有什么，我打开那个页面（将新的视图控制器推到导航控制器堆栈上）。

视图控制器的实际加载非常简单：我只是实例化它们。我的每个视图控制器类都覆盖了 -init 以在 super 上调用 -initWithNibName:bundle:，因此调用 +alloc 和 -init 来创建视图控制器实例足以从适当的 .xib 文件中加载它。然后，如上所述，我将其推送到导航控制器的堆栈中：

```
[self.navigationController pushViewController: controller animated: YES]; 
```

当然，您可以根据需要执行任意多个层，但请记住，如果要进行多个转换，您可能希望在没有动画的情况下推送视图控制器；用户必须等待几个动画会适得其反（：

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-17T23:17:06.823

查看苹果“drilldownsave”示例代码。做你想要的

# asp.net - Telerik 等效于 DetailView

> ID：724732
> 
> 赞同：1
> 
> 时间：2009-04-07T09:01:30.320
> 
> 标签：asp.net, telerik, detailsview

是否有与 asp.net DetailView 等效的 Telerik。或者我可以自定义一个详细视图以包括用于编辑的 Telerik 控件（以最小的努力）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T09:29:55.633

好吧，总会有 RadGrid。

[http://www.telerik.com/help/aspnet-ajax/gridoverview.html](http://www.telerik.com/help/aspnet-ajax/gridoverview.html)

在将标准或其他第三方控件与 Telerik 结合使用时，我遇到了不好的经历。他们经常表现得很奇怪，或者在其他控件中不起作用。

# iphone - 如何解决“找不到音频解码器组件 64766938 进行注册”？

> ID：724743
> 
> 赞同：0
> 
> 时间：2009-04-07T09:04:25.600
> 
> 标签：iphone, objective-c

如何删除 nslog 中显示的“找不到用于注册的音频解码器组件 64766938”？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T14:05:24.020

我记得在加载音频文件时遇到了这个问题，我不得不使用 Quicktime 将它们重新转换为 .CAF 文件。

不确定根本问题是什么，无论是我们做错了什么还是苹果的错误，但这肯定是一个简洁的错误。:-\

# c++ - IHTMLDocument2::write() 的问题

> ID：724746
> 
> 赞同：4
> 
> 时间：2009-04-07T09:04:42.247
> 
> 标签：c++, com, mfc, visual-c++-6, mshtml

我正在尝试从 html 缓冲区创建一个 mshtml 文档对象。但是当执行以下代码时，它正在调用 Internet Explorer 窗口。如何防止它调用 IE。

```
#include <atlbase.h>
#include <mshtml.h>

CoInitialize(NULL);

CString strHTMLCode = _T("<html><head><script language=\"JavaScript\">{top.location.href=\"index.php\"}</script></head><body></body></html>");

CComPtr<IHTMLDocument2> pDoc;
HRESULT hr = CoCreateInstance(CLSID_HTMLDocument, NULL, CLSCTX_INPROC_SERVER, IID_IHTMLDocument2, (void**)&pDoc);

SAFEARRAY* psa = SafeArrayCreateVector(VT_VARIANT, 0, 1);
VARIANT *param;

hr = SafeArrayAccessData(psa, (LPVOID*)¶m);
param->vt = VT_BSTR;
param->bstrVal = strHTMLCode.AllocSysString();

hr = pDoc->write(psa); //This line invoks internet explorer window.
hr = pDoc->close(); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2014-12-20T06:06:09.740

```
OLECHAR szHTML[] = OLESTR("<HTML><BODY>Hello World!</BODY></HTML>");

IHTMLDocument2 *pDoc = NULL;
CoInitialize(NULL);
CoCreateInstance(CLSID_HTMLDocument,
               NULL,
               CLSCTX_INPROC_SERVER,
               IID_IHTMLDocument2,
               (LPVOID *)&pDoc);
if(pDoc)
{
    IPersistStreamInit *pPersist = NULL;
    pDoc->QueryInterface(IID_IPersistStreamInit, (LPVOID *) &pPersist);
    if(pPersist)
    {
        IMarkupServices *pMarkSvr = NULL;
        pPersist->InitNew();
        pPersist->Release();
        pDoc->QueryInterface(IID_IMarkupServices, (LPVOID *)&pMarkSvr);
        if(pMarkSvr)
        {
            IMarkupContainer *pMkContainer = NULL;
            IMarkupPointer *pMkStart = NULL;
            IMarkupPointer *pMkFinish = NULL;
            pMarkSvr->CreateMarkupPointer(&pMkStart);
            pMarkSvr->CreateMarkupPointer(&pMkFinish);
            pMarkSvr->ParseString(szHTML, 0, &pMkContainer, pMkStart, pMkFinish);
            if(pMkContainer)
            {
                IHTMLDocument2 *pNewDoc = NULL;
                pMkContainer->QueryInterface(IID_IHTMLDocument, (LPVOID *)&pNewDoc);
                if(pNewDoc)
                {
                    // do anything with pNewDoc, in this case
                    // get the body innerText.
                    IHTMLElement *pBody;
                    pNewDoc->get_body(&pBody);
                    if(pBody)
                    {
                        BSTR strText;
                        pBody->get_innerText(&strText);
                        ShowMessage(strText);
                        pBody->Release();
                        SysFreeString(strText);
                    }
                    pNewDoc->Release();
                }
                pMkContainer->Release();
            }
            if(pMkStart)
                pMkStart->Release();
            if(pMkFinish)
                pMkFinish->Release();
            pMarkSvr->Release();
        }
    }
    pDoc->Release();
}
CoUninitialize(); 
```

参考： http: [//www.codeguru.com/cpp/in/ieprogram/article.php/c4385/Lightweight-HTML-Parsing-Using-MSHTML.htm#more](http://www.codeguru.com/cpp/i-n/ieprogram/article.php/c4385/Lightweight-HTML-Parsing-Using-MSHTML.htm#more)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-08T03:30:15.503

请尝试以下代码。

```
CoInitialize(NULL);

CString strHTMLCode = "...";
CComPtr<IHTMLDocument2> pDoc;
HRESULT hr = CoCreateInstance(CLSID_HTMLDocument, NULL, CLSCTX_INPROC_SERVER, IID_IHTMLDocument2, (void**)&pDoc);

// get persist stream init
ComQIPtr<IPersistStreamInit> psi = doc;

// allocate memory
HGLOBAL hMem = ::GlobalAlloc(GPTR, strHTMLCode.GetLength() * sizeof(TCHAR));
::GlobalLock(hMem);
::CopyMemory(hMem, (LPCTSTR)strHTMLCode, strHTMLCode.GetLength() *  * sizeof(TCHAR));

// create stream
IStream* stream = NULL;
HRESULT hr = ::CreateStreamOnHGlobal(hMem, FALSE, &stream);
if (SUCCEEDED(hr))
{
    // load html string
    psi->Load(stream);
    stream->Release();
}

// free memory
::GlobalUnlock(hMem);
::GlobalFree(hMem); 
```

# c# - 动态数据和实体框架的问题

> ID：724752
> 
> 赞同：1
> 
> 时间：2009-04-07T09:06:18.933
> 
> 标签：c#, .net, entity-framework, dynamic-data

我正在尝试将动态数据与具有由子实体派生的抽象类的实体模型一起使用。

每当我运行网站时，我都会收到此错误：

model.RegisterContext(typeof(QMSModel.QMSEntities), new ContextConfiguration() { ScaffoldAllTables = false });[KeyNotFoundException: 给定的键不在字典中。] System.ThrowHelper.ThrowKeyNotFoundException() +28 System.Collections.Generic .Dictionary `2.get_Item(TKey key) +7452124 System.Web.DynamicData.ModelProviders.EFAssociationProvider..ctor(EFColumnProvider column, NavigationProperty navigationProperty) +336 System.Web.DynamicData.ModelProviders.EFColumnProvider.get_Association() +82 System.Web.DynamicData.MetaColumn.Create(MetaTable table, ColumnProvider columnProvider) +16 System.Web.DynamicData.MetaTable..ctor(MetaModel metaModel, TableProvider tableProvider, Boolean scaffoldAllTables, String nameOverride) +272 System.Web.DynamicData.MetaModel.RegisterContext(DataModelProvider dataModelProvider, ContextConfiguration configuration) +758 System.Web.DynamicData.MetaModel.RegisterContext(Func`1 contextFactory, ContextConfiguration 配置) +359 System.Web.DynamicData.MetaModel.RegisterContext(Type contextType, ContextConfiguration 配置) +79 ASP.global_asax.RegisterRoutes(RouteCollection routes) in c:\Projects\DynamicDataWebsite\AdventureWebSite\Global.asax :19 ASP.global_asax.Application_Start(Object sender, EventArgs e) 在 c:\Projects\DynamicDataWebsite\AdventureWebSite\Global.asax:49

有人有想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T12:02:15.173

简短的回答是，[当您的实体框架模型包含任何类型的继承时，动态数据将被破坏](http://66.129.67.4/p/1277132/2431739.aspx)。这应该[在 DD 4.0 Preview 3 中得到修复](http://www.codeplex.com/aspnet/Wiki/View.aspx?title=Dynamic%20Data&referringTitle=Home)，但我还没有测试过。

我的总体印象是，实体框架和 ASP.NET MVC 的动态数据支持仍然是一项正在进行的工作。

# ruby-on-rails - Rails：模型方法执行顺序

> ID：724754
> 
> 赞同：0
> 
> 时间：2009-04-07T09:06:29.980
> 
> 标签：ruby-on-rails, ruby, model

我的模型有问题。我希望方法使用模型的另一个属性，但在使用它之前我希望执行另一个方法（使属性具有价值）。这是一个例子：

```
 def medthod_one=(val)
   self.value = val
 end

 def method_two
   self.second_value = self.value / 2 #just for example
 end 
```

因此，在我的情况下`self.second_value`是无效的，因为`self.value`尚未设置。提交此模型的创建表单后如何更改这些方法的执行顺序？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T09:19:49.247

当您只提供 foo-bar 示例而不是实际代码时，很难想出一个优雅的解决方案，但我的猜测告诉我，您可能想要这样的东西：

```
def som_setter=(val)
  self.value = val
end

def method_two
  return unless self.value
  # perform calculations with 'self.value'.
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:25:47.627

我不太确定我是否遵循您的问题，但也许看看活动记录回调会有所帮助。[http://api.rubyonrails.org/classes/ActiveRecord/Callbacks.html](http://api.rubyonrails.org/classes/ActiveRecord/Callbacks.html)

我认为您可能需要重新措辞这个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T09:15:20.067

你为什么不这样做：

```
def method_one=(val)
  self.value = val
  self.second_value = val / 2
end 
```

另一方面，如果`second_value`总是依赖于`self.value`，您可以将其实现为只读属性：

```
def second_value
  self.value / 2
end 
```

# wpf - 下划线 WPF 数据网格标题

> ID：724757
> 
> 赞同：0
> 
> 时间：2009-04-07T09:07:27.043
> 
> 标签：wpf, wpftoolkit

我有一个非常愚蠢的问题要问你.. :P 我怎样才能在 DataGrid 标题下划线？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T11:09:04.817

```
 <Window 
x:Class="Test.Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:dg="clr-namespace:Microsoft.Windows.Controls;assembly=WPFToolkit"
xmlns:dgp="clr-namespace:Microsoft.Windows.Controls.Primitives;assembly=WPFToolkit"
Title="Window1" Height="300" Width="300">
<Window.Resources>
    <Style TargetType="dgp:DataGridColumnHeader">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="dgp:DataGridColumnHeader">
                    <Label>
                        <Underline>
                            <ContentPresenter/>
                        </Underline>
                    </Label>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</Window.Resources>
<Grid>
    <dg:DataGrid>
        <dg:DataGrid.Columns>
            <dg:DataGridTextColumn Header="No." Width="50">
            </dg:DataGridTextColumn>
        </dg:DataGrid.Columns>
    </dg:DataGrid>
</Grid>
</Window> 
```

# c# - WPF 数据绑定到字符串属性

> ID：724763
> 
> 赞同：1
> 
> 时间：2009-04-07T09:10:52.510
> 
> 标签：c#, wpf, binding

我有一个关于我正在努力解决的数据绑定的问题。

我的 xaml.cs 文件中有以下属性：

```
 private string _stationIdInstruction;

    public event PropertyChangedEventHandler PropertyChanged;

    public string StationIdInstruction
    {
        get { return _stationIdInstruction; }
        set
        {
            _stationIdInstruction = value;
            OnPropertyChanged("StationIdInstruction");
        }
    }

    protected void OnPropertyChanged(string name)
    {
        if (PropertyChanged != null)
            PropertyChanged(this, new PropertyChangedEventArgs(name));
        }
    } 
```

如何将 TextBlock 绑定到 StationIdInstructions，以便在更新 StationIdInstructions 时将字符串属性作为其 Text 并更新 TextBlock.Text。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T09:19:30.713

是的，不要忘记指定绑定上下文。例如，

```
<Window ... Name="MyWindow">
  <Grid DataContext="{Binding ElementName=MyWindow, Path=.}">
    <TextBlock Text="{Binding Path=StationIdInstruction}" /> 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-07T09:15:28.583

在控件的 DataContext 上设置 StationIdInstructions 对象，并像这样设置 TextBlock：

```
<TextBlock Text="{Binding StationIdInstruction}" /> 
```

# c++ - 使用 pthread 来利用多个内核的问题

> ID：724765
> 
> 赞同：1
> 
> 时间：2009-04-07T09:14:33.190
> 
> 标签：c++, pthreads, mutex, sdl, semaphore

我正在使用 SDL 和 Pthread 用 C++ 开发光线追踪器。我在使我的程序使用两个内核时遇到问题。线程可以工作，但它们不会 100% 使用两个内核。为了接口 SDL，我直接写入它的内存 SDL_Surface.pixels，所以我认为它不可能是 SDL 锁定我。

我的线程函数如下所示：

```
void* renderLines(void* pArg){
while(true){
    //Synchronize
    pthread_mutex_lock(&frame_mutex);
    pthread_cond_wait(&frame_cond, &frame_mutex);
    pthread_mutex_unlock(&frame_mutex);

    renderLinesArgs* arg = (renderLinesArgs*)pArg;
    for(int y = arg->y1; y < arg->y2; y++){
        for(int x = 0; x < arg->width; x++){
            Color C = arg->scene->renderPixel(x, y);
            putPixel(arg->screen, x, y, C);
        }
    }

    sem_post(&frame_rendered);
    }
} 
```

注意：scene->renderPixel 是 const，所以我假设两个线程都可以从同一个内存中读取。我有两个工作线程在做这件事，在我的主循环中我使用：

```
//Signal a new frame
pthread_mutex_lock(&frame_mutex);
pthread_cond_broadcast(&frame_cond);
pthread_mutex_unlock(&frame_mutex);

//Wait for workers to be done
sem_wait(&frame_rendered);
sem_wait(&frame_rendered);

//Unlock SDL surface and flip it... 
```

注意：我也尝试过创建和加入线程而不是同步它们。我用“-lpthread -D_POSIX_PTHREAD_SEMANTICS -pthread”编译它，gcc 没有抱怨。

我的问题最好使用执行期间的 CPU 使用图来说明：（ [来源：][[jopsen.dk](http://jopsen.dk/downloads/processor_usage.png)][）][![执行期间的 CPU 使用率。](https://i.stack.imgur.com/DFLFg.png)](https://i.stack.imgur.com/DFLFg.png)

从图中可以看出，我的程序一次只使用一个内核，然后每隔一段时间在两者之间切换，但它永远不会将两者都驱动到 100%。我到底做错了什么？我没有在场景中使用任何互斥锁或信号量。我该怎么做才能找到错误？

此外，如果我将 while(true) 放在 scene->renderPixel() 周围，我可以将两个核心都推到 100%。所以我怀疑这是由开销引起的，但我只每 0.5 秒同步一次（例如 FPS：0.5），给定一个复杂的场景。我意识到告诉我我的错误可能并不容易，但是调试它的方法也很棒......我以前没有玩过pthreads......

另外，这可能是硬件或内核问题，我的内核是：

```
$uname -a
Linux jopsen-laptop 2.6.27-14-generic #1 SMP Fri Mar 13 18:00:20 UTC 2009 i686 GNU/Linux 
```

笔记：

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T09:36:29.890

这是没用的：

```
pthread_mutex_lock(&frame_mutex);
pthread_cond_wait(&frame_cond, &frame_mutex);
pthread_mutex_unlock(&frame_mutex); 
```

如果您等待等待新框架，请执行以下操作：

int new_frame = 0;

第一个线程：

```
pthread_mutex_lock(&mutex); 
new_frame = 1; 
pthread_cond_signal(&cond);
pthread_mutex_unlock(&mutex); 
```

其他线程：

```
pthread_mutex_lock(&mutex); 
while(new_frame == 0)
  pthread_cond_wait(&cond, &mutex); 
/* Here new_frame != 0, do things with the frame*/
pthread_mutex_unlock(&mutex); 
```

pthread_cond_wait()，实际释放互斥锁，并取消调度线程，直到条件发出信号。当条件发出信号时，线程被唤醒并重新获取互斥锁。所有这些都发生在 pthread_cond_wait() 函数中

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T09:24:32.680

我会在黑暗中猛烈抨击并说您的工作线程正在花费大量时间等待条件变量。为了在这种代码主要受 CPU 限制的情况下获得良好的 CPU 性能，可以理解为使用面向任务的编程风格，将线程视为“池”，并使用队列结构将工作提供给他们。他们应该花很少的时间将工作从队列中拉出来，而大部分时间都在做实际的工作。

你现在的情况是他们可能正在工作一段时间，然后通过信号量通知主线程他们已经完成。在两个线程都完成了它们当前正在处理的帧的工作之前，主线程不会释放它们。

由于您使用的是 C++，您是否考虑过使用 Boost.Threads？它使处理多线程代码变得更加容易，而且 API 实际上有点类似于 pthreads，但是以“现代 C++”的方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T09:31:35.753

我不是 pthreads 专家，但在我看来，以下代码是错误的：

```
pthread_mutex_lock(&frame_mutex);
pthread_cond_wait(&frame_cond, &frame_mutex);
pthread_mutex_unlock(&frame_mutex); 
```

引用[这篇文章](https://computing.llnl.gov/tutorials/pthreads/#ConditionVariables)

> `pthread_cond_wait()`阻塞调用线程，直到发出指定条件的信号。该例程应该在互斥锁被锁定时调用，它会在等待时自动释放互斥锁。收到信号并唤醒线程后，互斥量将自动锁定以供线程使用。然后，程序员负责在线程完成后解锁互斥锁。

**所以在**我看来，您应该在`pthread_cond_wait`.

# javascript - 如何在不知道其键的情况下获取枚举值？

> ID：724769
> 
> 赞同：0
> 
> 时间：2009-04-07T09:16:30.767
> 
> 标签：javascript, google-app-engine, google-translate

我正在尝试使用 Translation API 中的枚举器加载组合。但是，我不知道如何迭代并获取每个项目的键和值并将其显示给用户。谁能告诉我该怎么做？？？

我试图访问的对象是*google.language.Languages*。它是这样构建的：

```
google.language.Languages{
'AFRIKAANS' : 'af',  
'ALBANIAN' : 'sq',  
'AMHARIC' : 'am',  
'ARABIC' : 'ar',  
'ARMENIAN' : 'hy', 
....
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T09:22:20.393

```
for(language in google.language.Languages)
{
    alert(google.language.Languages[language]);
} 
```

?

# objective-c - 使用 NSMutableArray 的二维数组

> ID：724772
> 
> 赞同：45
> 
> 时间：2009-04-07T09:16:53.153
> 
> 标签：objective-c, cocoa, cocoa-touch, multidimensional-array, nsmutablearray

我需要在 Objective-C 中创建一个可变的二维数组。

例如我有：

```
NSMutableArray *sections;
NSMutableArray *rows; 
```

中的每个项目`sections`都由一个数组组成`rows`。`rows`是一个包含对象的数组。

我想做这样的事情：

```
[ sections[i] addObject: objectToAdd]; //I want to add a new row 
```

为了有这样的东西：section 0, rows: obj1, obj2, obj3 section 1, rows: obj4, obj5, obj6, obj 7 ...

有没有办法在 Objective-C 中做到这一点？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-04-07T09:29:39.160

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-07T09:31:04.897

If you want to do this using arrays, you can intialize your `sections` array, then add a rows array as follows:

```
NSMutableArray *sections = [[NSMutableArray alloc] init];
NSMutableArray *rows = [[NSMutableArray alloc] init];
//Add row objects here

//Add your rows array to the sections array
[sections addObject:rows]; 
```

If you want to add this rows object at a certain index, use the following:

```
//Insert your rows array at index i
[sections insertObject:rows atIndex:i]; 
```

You can then modify this rows array by retrieving the array:

```
//Retrieve pointer to rows array at index i
NSMutableArray *rows = [sections objectAtIndex:i]
//modify rows array here 
```

You could always create your own class called `Section`, which has an `NSMutableArray` member called `rows`; then you store your rows inside this array, and store the `Section` objects in an array:

```
@interface Section : NSObject {
    NSMutableArray *rows;
} 
```

Then you simply create `Section` items, and you can create methods inside your class to add/remove row items. Then you package all the `Sections` items up inside another array:

```
Section *aSection = [[Section alloc] init];
//add any rows to your Section instance here

NSMutableArray *sections = [[NSMutableArray alloc] init];
[sections addObject:aSection]; 
```

This becomes more useful if you want to add more properties for each `Section` instance.

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-07T10:14:01.253

The language has no support for multi-dimensional object-oriented arrays, but you can make a class that does it using an NSMutableArray full of NSMutableArrays, like the following. I haven't tried compiling this or anything, I just typed it in.

```
@interface SectionArray : NSObject {
  NSMutableArray *sections;
}
- initWithSections:(NSUInteger)s rows:(NSUInteger)r;
+ sectionArrayWithSections:(NSUInteger)s rows:(NSUInteger)r;
- objectInSection:(NSUInteger)s row:(NSUInteger)r;
- (void)setObject:o inSection:(NSUInteger)s row:(NSUInteger)r;
@end
@implementation SectionArray
- initWithSections:(NSUInteger)s rows:(NSUInteger)r {
  if ((self = [self init])) {
    sections = [[NSMutableArray alloc] initWithCapacity:s];
    NSUInteger i;
    for (i=0; i<s; i++) {
      NSMutableArray *a = [NSMutableArray arrayWithCapacity:r];
      for (j=0; j<r; j++) {
        [a setObject:[NSNull null] atIndex:j];
      }
      [sections addObject:a];
    }
  }
  return self;
}
+ sectionArrayWithSections:(NSUInteger)s rows:(NSUInteger)r {
  return [[[self alloc] initWithSections:s rows:r] autorelease];
}
- objectInSection:(NSUInteger)s row:(NSUInteger)r {
  return [[sections objectAtIndex:s] objectAtIndex:r];
}
- (void)setObject:o inSection:(NSUInteger)s row:(NSUInteger)r {
  [[sections objectAtIndex:s] replaceObjectAtIndex:r withObject:0];
}
@end 
```

You'd use it like this:

```
SectionArray *a = [SectionArray arrayWithSections:10 rows:5];
[a setObject:@"something" inSection:4 row:3];
id sameOldSomething = [s objectInSection:4 row:3]; 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-07-07T06:19:28.243

what the hell. As long as we're reviving this question, here's something for the age of literal collection syntax and visual format interpretation!

In case anyone is wondering, this works:

```
NSMutableArray *multi = [@[ [@[] mutableCopy] , [@[] mutableCopy] ] mutableCopy];
multi[1][0] = @"Hi ";
multi[1][1] = @"There ";
multi[0][0] = @"Oh ";
multi[0][1] = @"James!";        
NSLog(@"%@%@%@%@", multi[0][0], multi[1][0], multi[1][1], multi[0][1]); 
```

Result: "Oh Hi There James!"

Of course, there is the problem of trying something like `multi[3][5] = @"?"` and getting an invalid index exception, so I wrote a category for NSMutableArray.

```
@interface NSMutableArray (NullInit)
+(NSMutableArray *)mutableNullArrayWithSize:(NSUInteger)size;
+(NSMutableArray *)mutableNullArraysWithVisualFormat:(NSString *)string;
@end

@implementation NSMutableArray (NullInit)

+(NSMutableArray *)mutableNullArrayWithSize:(NSUInteger)size
{
    NSMutableArray *returnArray = [[NSMutableArray alloc] initWithCapacity:size];
    for (int i = 0; i < size; i++) {
        [returnArray addObject:[NSNull null]];
    }
    return returnArray;
}

+(NSMutableArray *)mutableNullArraysWithVisualFormat:(NSString *)string
{
    NSMutableArray *returnArray = nil;
    NSRange bitRange;
    if ((bitRange = [string rangeOfString:@"^\\[\\d+]" options:NSRegularExpressionSearch]).location != NSNotFound) {
        NSUInteger size = [[string substringWithRange:NSMakeRange(1, bitRange.length - 2)] integerValue];
        if (string.length == bitRange.length) {
            returnArray = [self mutableNullArrayWithSize:size];
        } else {
            returnArray = [[NSMutableArray alloc] initWithCapacity:size];
            NSString *nextLevel = [string substringWithRange:NSMakeRange(bitRange.length, string.length - bitRange.length)];
            NSMutableArray *subArray;
            for (int i = 0; i < size; i++) {
                subArray = [self mutableNullArraysWithVisualFormat:nextLevel];
                if (subArray) {
                    [returnArray addObject:subArray];
                } else {
                    return nil;
                }
            }
        }
    } else {
        return nil;
    }
    return returnArray;
}

@end 
```

As you can see, we have a convenience method for making an array full of `NSNull` so that you can set indices with wild abandon.

Secondly, there's a recursive method that parses a string with a visual format like: `[3][12]` (3 x 12 array). If your string is invalid in some way the method will return `nil`, but if it's valid you get a whole multidimensional array of the sizes you specify.

Here are some examples:

```
NSMutableArray *shrub = [NSMutableArray mutableNullArrayWithSize:5];
NSMutableArray *tree = [NSMutableArray mutableNullArraysWithVisualFormat:@"[3][12]"]; // 2-Dimensional Array
NSMutableArray *threeDeeTree = [NSMutableArray mutableNullArraysWithVisualFormat:@"[3][5][6]"]; // 3-Dimensional Array
NSMutableArray *stuntedTree = [NSMutableArray mutableNullArraysWithVisualFormat:@"[6][4][k]"]; // Returns nil 
```

You can pass as many dimensions as you like into the visual format method, and then access them with the literal syntax, like so:

```
NSMutableArray *deepTree = [NSMutableArray mutableNullArraysWithVisualFormat:@"[5][3][4][2][7]"];
deepTree[3][2][1][0][5] = @"Leaf";
NSLog(@"Look what's at 3.2.1.0.5: %@", deepTree[3][2][1][0][5]); 
```

Anyway, did this more as an exercise than anything else; it's probably pretty efficient in the grand scheme of things...considering as how we're making multi-dimensional arrays of Objective-C object pointers.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-03-17T15:50:32.503

Thanks to Jack for his code , i worked on it a bit; i need a multidimensional nsmutablearray for strings in one of my project , it still has some things that need to be fixed but works strings only at the moment , i will post it here , i am open for suggestions please cause i am only just a beginner in objective c at the moment...

```
@interface SectionArray : NSObject {

  NSMutableArray *sections;    

}
- initWithSections:(NSUInteger)intSections:(NSUInteger)intRow;
+ sectionArrayWithSections:(NSUInteger)intSections:(NSUInteger)intRows;
- objectInSection:(NSUInteger)intSection:(NSUInteger)intRow;
- (void)setObject:(NSString *)object:(NSUInteger)intSection:(NSUInteger)intRow;
@end

@implementation SectionArray

- initWithSections:(NSUInteger)intSections:(NSUInteger)intRow {
    NSUInteger i;
    NSUInteger j;

    if ((self = [self init])) {
        sections = [[NSMutableArray alloc] initWithCapacity:intSections];
        for (i=0; i < intSections; i++) {
            NSMutableArray *a = [NSMutableArray arrayWithCapacity:intRow];
            for (j=0; j < intRow; j++) {
                [a insertObject:[NSNull null] atIndex:j];
            }
            [sections addObject:a];
        }
    }
    return self;    
}
- (void)setObject:(NSString *)object:(NSUInteger)intSection:(NSUInteger)intRow {
    [[sections objectAtIndex:intSection] replaceObjectAtIndex:intRow withObject:object];
}
- objectInSection:(NSUInteger)intSection:(NSUInteger)intRow {
    return [[sections objectAtIndex:intSection] objectAtIndex:intRow];
}
+ sectionArrayWithSections:(NSUInteger)intSections:(NSUInteger)intRows {
    return [[self alloc] initWithSections:intSections:intRows] ;
}
@end 
```

This is working fine !!!

i am currently using it like this

```
SectionArray *secA = [[SectionArray alloc] initWithSections:2:2];
[secA setObject:@"Object":0:0];
[secA setObject:@"ObjectTwo":0:1];
[secA setObject:@"ObjectThree":1:0];
[secA setObject:@"ObjectFour":1:1];

NSString *str = [secA objectInSection:1:1];

NSLog(@" object is = %@" , str); 
```

Thanks again Jack !!

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-07T00:57:54.630

FYI: Jack's code needs a bunch of work before it works. Among other issues, the autorelease can cause the data to get released before you access it and his usage calls the class method arrayWithSections:rows: when it is actually defined as sectionArrayWithSections:rows:

I may try to post actual working code later if I get a chance.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-07-07T03:55:08.470

Reviving an old thread, but I reworked Jack's code so 1\. it compiles and 2\. it is in the order of 2D c arrays [rows][columns] instead of [sections(columns)][rows] as he has it. Here you go!

TwoDArray.h:

```
#import <Foundation/Foundation.h>

@interface TwoDArray : NSObject

@property NSMutableArray *rows;

- initWithRows:(NSUInteger)rows columns:(NSUInteger)columns;
+ sectionArrayWithRows:(NSUInteger)rows columns:(NSUInteger)columns;
- objectInRow:(NSUInteger)row column:(NSUInteger)column;
- (void)setObject:(id)obj inRow:(NSUInteger)row column:(NSUInteger)column;

@end 
```

TwoDArray.m:

```
#import "TwoDArray.h"

@implementation TwoDArray

- (id)initWithRows:(NSUInteger)rows columns:(NSUInteger)columns {
    if ((self = [self init])) {
        self.rows = [[NSMutableArray alloc] initWithCapacity: rows];
        for (int i = 0; i < rows; i++) {
            NSMutableArray *column = [NSMutableArray arrayWithCapacity:columns];
            for (int j = 0; j < columns; j++) {
                [column setObject:[NSNull null] atIndexedSubscript:j];
            }
            [self.rows addObject:column];
        }
    }
    return self;
}
+ (id)sectionArrayWithRows:(NSUInteger)rows columns:(NSUInteger)columns {
    return [[self alloc] initWithRows:rows columns:columns];
}
- (id)objectInRow:(NSUInteger)row column:(NSUInteger)column {
    return [[self.rows objectAtIndex:row] objectAtIndex:column];
}
- (void)setObject:(id)obj inRow:(NSUInteger)row column:(NSUInteger)column {
    [[self.rows objectAtIndex:row] replaceObjectAtIndex:column withObject:obj];
}
@end 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-09-09T13:27:04.260

This is what I did in order to initialize array of arrays.

```
NSMutableArray *arrayOfArrays = [[NSMutableArray alloc] initWithCapacity:CONST];

for (int i=0; i<=CONST; i++) {
    [arrayOfArrays addObject:[NSMutableArray array]];
} 
```

Then later in a code I could simply:

```
[[arrayOfArrays objectAtIndex:0] addObject:myObject]; 
```

# c# - WPF FileDrop 事件：只允许特定的文件扩展名

> ID：724774
> 
> 赞同：13
> 
> 时间：2009-04-07T09:17:53.227
> 
> 标签：c#, wpf, events

我有一个 WPF 控件，我想将一个特定文件从我的桌面拖放到这个控件中。这不是一个沉重的部分，但我想检查文件扩展名以允许或禁止删除。解决此问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-10T06:33:35.757

我认为这应该有效：

```
<Grid>
    <ListBox AllowDrop="True" DragOver="lbx1_DragOver" 
                                                      Drop="lbx1_Drop"></ListBox>
</Grid> 
```

假设您只想允许 C# 文件：

```
private void lbx1_DragOver(object sender, DragEventArgs e)
{
   bool dropEnabled = true;
   if (e.Data.GetDataPresent(DataFormats.FileDrop, true))
   {
      string[] filenames = 
                       e.Data.GetData(DataFormats.FileDrop, true) as string[];

      foreach (string filename in filenames)
      {
         if(System.IO.Path.GetExtension(filename).ToUpperInvariant() != ".CS")
         {
            dropEnabled = false;
    break;
         }
       }
   }
   else
   {
      dropEnabled = false;
   }

   if (!dropEnabled)
   {
      e.Effects = DragDropEffects.None;
  e.Handled = true;
   }            
}

private void lbx1_Drop(object sender, DragEventArgs e)
{
    string[] droppedFilenames = 
                        e.Data.GetData(DataFormats.FileDrop, true) as string[];
} 
```

# c# - ASP.NET 动态 UserControl ID 生成问题

> ID：724778
> 
> 赞同：3
> 
> 时间：2009-04-07T09:18:50.793
> 
> 标签：c#, .net, asp.net, user-controls

我在页面生命周期期间动态加载的 UserControls 的 ID 属性发生变化。更具体地说，当系统调用 Page.Form.RenderControl(htmlTextWriter); 时，ID 属性会发生变化。在调用之前，控件的 ID 为“ctl84”，但在调用之后，它的 ID 为“ctl99”。

htmlTextWriter 的输出包含原始 ID，但是在 VS 2008 调试器中检查控件的 ID 属性会发现它已更改。

该应用程序在使用 .NET 2.0 的 MCMS 2002 (Microsoft CMS 2002) 框架内运行，从 1.1 转换而来，并且未启用 xhtmlConformance="Legacy"。

我需要 ID 在整个页面生命周期中保持不变。

编辑：手动设置 ID 属性不是一个选项。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T09:23:58.987

您是否从代码中明确为控件分配了 ID？

如果你是ID应该保持不变。

它并没有解释为什么它会发生变化 - 我的猜测是......不是**同一个**控件。由于某种原因，您控制的生成例程可能会运行两次或像这样运行。

在控件被分类的地方放置一个断点，看看它是否被击中两次 - 如果是这样，你去，那是你的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T09:29:18.193

要确保它是控件的同一个实例而不是另一个，请检查控件的 GetHashCode() 方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T10:31:26.937

当您包含一个 asp.net 控件时，在运行时生成的 id 会发生变化。您无法预测生成的确切客户端 ID。您可以做的是使用用户控件提供的 ClienID 属性。

按钮 btnSave = new Button();

btnSave.ID = "btnSave";

字符串 clientID = btnSave.ClientID;

如果您检查cientID，它将类似于“ctl88_99_***_btnSave”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T11:52:22.513

是的，我认为 rAm 是对的.. 在我以前的经验中.. 我注意到显式 id 值一直有效，并且会推荐相同的.. 安迪

# url - 在 SEO 友好的 URL 中添加类别？

> ID：724783
> 
> 赞同：3
> 
> 时间：2009-04-07T09:20:09.867
> 
> 标签：url, seo

我有一个包含“项目”的网站，其中有一个 ID 和标题。它们分为几类。

类别索引在 URL 处查看

```
example.com/tutorials
example.com/maps 
```

从 SEO 的角度来看，一般来说，项目本身的最佳 URL 结构是什么？

```
example.com/tutorials/12/Make+a+php+site
example.com/maps/29/Inside+the+moon 
```

或者

```
example.com/12/Make+a+php+site
example.com/29/Inside+the+moon 
```

前者中的类别添加实际上是不必要的。我只需要 ID 即可找到物品。但是，我不知何故觉得前者更好。

你怎么看？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T09:25:19.997

类别是非常重要的与 SEO 相关的关键字，最好将它们放在 URL 中，即使它们不是必需的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T09:27:55.293

我同意 PeterP 的观点——仅仅拥有 /12/Make+a+php+site 并没有为读者或搜索引擎提供任何上下文。此外，恕我直言，加号很丑陋。改用破折号（如SO）:-)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T09:28:34.107

我会使用最具描述性的 URL，而不附加不必要的信息。如果这些是您网站中的不同类别，可通过单独的菜单项获得，我会使用

`http://www.example.com/Maps/12/Map-of-the-world`

形式。

如果“地图”或“教程”更像是不唯一的标签或类，或者每个项目可以有多个，或者没有单独的登录页面或菜单项，我不太确定。最好包括最基本的相关信息，从你的例子中我建议包括类别。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-06-09T10:33:32.447

我想争论在您的 url 方案中使用类别的公认答案，因为它们是某种与内容无关的分类法。

假设您有一个电影信息数据库 Web 应用程序，例如著名的 IMDB。在那里，您在这些**字段**中有内容：

*   电影预告片
*   电影演员/女演员
*   影评
*   ...

和这些**类别**：

*   行动
*   喜剧
*   冒险
*   ...

在您的 URL 中使用类别，您可能拥有以下 URL：

```
myimdb.com/action/ArnoldSchwarzenegger
myimdb.com/action/TheTerminator

myimdb.com/comedy/SomeLikeItHot
myimdb.com/comedy/MarilynMonroe 
```

**显然，将演员**和**电影**放在同一条道路上是没有意义的。您可能总是在同一类别下拥有各种内容域，因为类别是与**内容无关的分类法**。

所以我建议选择像这样的 URL 方案：

```
example.com/12/Make+a+php+site
example.com/29/Inside+the+moon 
```

就像堆栈溢出为它的问题所做的那样。

# java - 具有多语言支持的 java swing 程序

> ID：724790
> 
> 赞同：0
> 
> 时间：2009-04-07T09:23:36.350
> 
> 标签：java, swing

我想用java创建一个TextArea，我可以用中文写数据。我怎样才能做到这一点

谢谢巴皮

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T09:28:22.313

看到[这个问题](https://stackoverflow.com/questions/718776/how-to-display-japanese-characters-in-jtextarea)。

您唯一需要做的就是确保 JTextArea 使用一种可以显示中文字符的字体，而遗憾的是默认字体不能。

# c# - 无法正确使用 TileWindows 功能

> ID：724791
> 
> 赞同：0
> 
> 时间：2009-04-07T09:23:52.277
> 
> 标签：c#, winapi

我想平铺 C# winforms，但似乎 .Net 框架不支持这一点。所以我使用了 Win32 函数[TileWindows](http://msdn.microsoft.com/en-us/library/ms633554(VS.85).aspx)。这是代码：

```
 GCHandle gcHandle = GCHandle.Alloc(handles, GCHandleType.Pinned);
            IntPtr arrayHandle = gcHandle.AddrOfPinnedObject();
            TileWindows(IntPtr.Zero,
                        (uint)(Tile.Vertical | Tile.SkipDisabled),
                        IntPtr.Zero,
                        (uint)handles.Length, ref arrayHandle);
            gcHandle.Free(); 
```

句柄是 Winforms 句柄的数组，而 Tile 只是 uint 的枚举。问题是在调用此函数后，我的 dekstop 上所有打开的窗口都会受到影响，而不是传递的数组句柄。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T12:12:35.897

是什么`handles`？我假设它是一组窗口句柄

如何`TileWindows`定义（签名）？

`ref`我已经尝试过您的代码，并且在从最后一个参数中删除关键字后它实际上工作了。

```
 GCHandle gcHandle = GCHandle.Alloc(handles, GCHandleType.Pinned);
        IntPtr arrayHandle = gcHandle.AddrOfPinnedObject();
        TileWindows(IntPtr.Zero,
                    (uint)(Tile.Vertical | Tile.SkipDisabled),
                    IntPtr.Zero,
                    (uint)handles.Length, arrayHandle);
        gcHandle.Free(); 
```

带有函数签名：

```
 [DllImport("user32.dll")]
    static extern ushort TileWindows(IntPtr hwndParent, uint wHow, IntPtr lpRect,
       uint cKids, IntPtr lpKids); 
```

# wpf - 在 ListView 中动态嵌套 DataTemplates

> ID：724793
> 
> 赞同：0
> 
> 时间：2009-04-07T09:24:10.857
> 
> 标签：wpf, listview, datatemplate

我有一个 MyTypeOneViewModel 类型的对象，它显示在 ListView 的第一列中，我有一个 MyTypeTwoViewModel 类型的对象，它显示在我的 ListView 的第二列中。这两种类型都有一个 MyNestedViewModel 类型的属性。现在我想根据该属性的实际类型为 ListView 中的每个单元格显示不同的 DataTemplate。例如，如果该属性实际上包含一个 MyDoubleNestedViewModel，我想在该单元格中显示一个文本框，如果该属性包含一个 MyBooleanNestedViewModel，我想在 ListView 的该特定单元格中显示一个 ComboBox。请注意，DataTemplate 在每一行和每一列中可能会有所不同。

我可以在没有 TemplateSelector 的情况下实现这一点吗？WPF 能够根据绑定的类型自动选择正确的 DataTemplate。但这在 ListView 的这种嵌套场景中是否也能以某种方式工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T09:31:52.320

考虑以下选项：

**1\. 直接绑定到子属性。**

将该列绑定到子属性（类型为`MyNestedViewModel`）而不是父属性。然后 WPF 将根据嵌套视图模型的类型而不是父视图模型的类型来选择模板。

```
<GridViewColumn DisplayMemberBinding="{Binding TheChildViewModel}"/> 
```

**`ContentControl`2.在您的单元格模板中包含一个。**

在您的网格列模板中，将 a 绑定`ContentControl`到子属性：

```
<GridViewColumn.CellTemplate>
    <DataTemplate>
        <StackPanel>
            <Label Content="{Binding SomePropertyOnParentViewModel}"/>
            <ContentControl Content="{Binding TheChildViewModel}"/>
        </StackPanel>
    </DataTemplate>
</GridViewColumn.CellTemplate> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T17:19:31.587

WPF 可以完全满足您的需求。

引用具有您的数据类型的程序集，并为您需要显示的每种类型添加一个 DataTemplate 资源。

```
 xmlns:ui="clr-namespace:YourAssembly"
    <Window.Resources>

        <DataTemplate DataType="ui:MyDoubleNestedViewModel ">
              <Grid Margin="5,5,5,5" >

                   <TextBlock Text="{Binding Path=Value}"/>                                                     
        </Grid>

        </DataTemplate>

        <DataTemplate DataType="ui:MyBooleanNestedViewModel ">
              <Grid Margin="5,5,5,5" >

                   <ComboBox ItemsSource="{Binding Path=Items}"/>                                                       
        </Grid>

        </DataTemplate>
    </Window.Resources> 
```

现在，此模板将与此窗口中绑定到您的视图模型对象的任何列表或内容控件一起使用。您不需要指定 ItemTemplate 设置。

# vba - Outlook - 使用宏移动电子邮件不会保留收据日期

> ID：724797
> 
> 赞同：1
> 
> 时间：2009-04-07T09:25:56.687
> 
> 标签：vba, outlook

在 Outlook 中使用宏将电子邮件移动到子文件夹时，不会保留接收日期。

有谁知道如何避免这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-08-11T06:47:11.217

我发现宏改变了实际上是正确的 ModifiedTime 参数。问题是文件夹视图中的 Outlook 在 Receveid 列中不显示 ReceivedTime，而是显示 ModifiedTime。我还发现修改的列（通常不可见）包含实际的 RecievedTime。因此，一种补救方法是保持宏不变，但添加（在文件夹视图中的列上的鼠标右键）Modified 列到视图并可选地删除 Received 列。您将在“所有帖子字段”部分中找到已修改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-06T08:25:09.593

不是答案..但这里有一些复制问题的代码。似乎无法在任何地方找到答案。不过问这个问题的人不少。

```
Sub MoveToFolder(objFolder As Outlook.MAPIFolder)
  'On Error Resume Next
  If objFolder Is Nothing Then
    MsgBox "This folder doesn't exist!", vbOKOnly + vbExclamation, "INVALID FOLDER"
  End If

  If Application.ActiveExplorer.Selection.Count = 0 Then
    Exit Sub
  End If

  Dim objItem As Outlook.MailItem
  For Each objItem In Application.ActiveExplorer.Selection
      If objFolder.DefaultItemType = olMailItem Then
          If objItem.Class = olMail Then
              objItem.Move objFolder
          End If
      End If
  Next

  Set objItem = Nothing
  Set objFolder = Nothing
End Sub 
```

# iphone - 为设备构建应用程序时出现 iPhone 错误

> ID：724798
> 
> 赞同：-1
> 
> 时间：2009-04-07T09:26:07.093
> 
> 标签：iphone, code-signing

我想将一个应用程序部署到我之前在模拟器上测试过的 iPhone。我正在按照越狱方式但是[这个链接](https://stackoverflow.com/questions/37464/iphone-app-minus-app-store#37522)

但是当我将设置更改为 Project、Set Active SDK、Device 时，我收到 CodeSign 错误，如下所示： Code Signing Identity 'iPhone Developer' 与钥匙串中的任何代码签名证书都不匹配。添加到钥匙串后，触摸文件或清理项目以继续。

有什么想法我该怎么做？

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2009-04-07T10:27:30.940

您需要使用 Keychain Access 创建代码签名证书。

这是一个教程：[绕过代码签名并在 Cydia 上发布您的应用程序](http://adeem.wordpress.com/2009/03/29/bypass-code-signature-published-your-application-on-cydia/)

# sql - 您如何在 T-SQL 中从用户那里获取输入值？

> ID：724800
> 
> 赞同：1
> 
> 时间：2009-04-07T09:27:09.570
> 
> 标签：sql, sql-server, tsql

我想知道如何在 T-SQL 中获取用户的输入。

例如，我将如何做一个从用户那里获取两个数字并将它们相加的程序？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-12T19:30:38.217

有多种方法可以构建可以接受用户输入的 UI。这可能是另一个问题的主题。

正如其他评论者所指出的，请务必考虑直接接受用户输入的安全风险，在应用程序的多个层清理数据至关重要。也就是说，所有数据驱动的应用程序都必须接受用户数据并对其采取行动。这并非不可能，重要的是您对风险有充分的了解。接受用户数据并在其上执行的潜在问题是，恶意用户可能会尝试在您的数据库上执行他们自己的代码并删除表、提取敏感数据或其他讨厌的东西。除非整个应用程序位于相应的防火墙之后，否则对于没有丰富安全经验的任何人来说，这都不是一项任务。

也就是说，最简单的 UI 是让内部和受信任的用户安装 SQL Server Management Studio 之类的东西，然后为他们提供调用存储过程的 .sql 脚本。这种技术只是我可以推荐给具有一定技术性的受信任用户的东西。

你创建一个这样的过程：

* * *

```
create procedure AddNumbers
    @augend int,
    @addend int
as
/* 
if all the input that you are accepting is numeric 
it is somewhat safer as long as you use int or numeric datatypes from the start.
I would stay away from using any alphanumeric data in a function like this 
without running it through some validation with a regular expression or other method.
*/
select @augend+@addend 
```

* * *

然后指示您的用户像这样调用它

* * *

```
execute AddNumbers
    @augend = 4,
    @addend = 5 
```

* * *

此外，您可以构建一个调用此过程并给出结果的 UI。但是您需要仔细考虑所需的访问权限和安全性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T09:29:11.017

*永远*不要这样做。将这两个值作为参数传递给函数/存储过程（更不用说将 SQL Server 用作计算器很奇怪）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T09:29:59.097

有许多选项，包括：

1) 创建一个存储过程，接收用户提供给您的值

2) 根据用户提供的值动态创建 Select 语句

实际上，要正确回答这个问题，您需要向我们提供更多信息，例如您将如何从用户那里获取信息，您打算如何查询数据库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T09:37:30.340

将用户界面与持久性分开的分层架构永远不会这样做。持久性代码永远不应该离用户那么近。这样做是没有机会进行验证的。

这个例子可能是人为的，但答案是一样的：不要。

# asp.net - 为 gridview 设置数据源时出错

> ID：724802
> 
> 赞同：0
> 
> 时间：2009-04-07T09:28:07.633
> 
> 标签：asp.net, vb.net, gridview

我有一个网格视图。其数据源设置如下。 `dtTable`是一个数据表，将在其中检索表的值。但是当设置`dtTable`为数据源时，我收到一个错误“对象引用未设置为对象的实例”。这可能是什么原因？

```
gridview.Datasource = dtTable
gridview.Databind() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T09:34:31.473

确保 dtTable 有您需要的记录。此错误通常意味着 dtTable 为空。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T09:35:47.693

看一下`dtTable`变量的初始化位置。它回来了`Nothing`吗？也许您遇到了另一个被忽略的错误。可能`dtTable`是问题的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T13:25:00.140

如果数据表为空，您将不会得到空引用异常，如果gridview 为空，您将得到一个。这是假设这两行之一*实际上*正在生成异常。

# c# - 将信息（HTML 代码）传递到其他 ASP.NET (C#) 网站

> ID：724813
> 
> 赞同：0
> 
> 时间：2009-04-07T09:30:41.060
> 
> 标签：c#, html

我的问题是这样的：

我想将 HTML 代码发送到另一个网站。有没有特殊的发送方式？以便其他网站知道如何处理它？（这是我的一个朋友，他想在他的网站上显示我的信息）该网站需要它，因此可以从那里处理它。

我使用 C# .NET 2.0

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T09:45:06.627

嗯，

如果其他网站只是请求[http://www.yoursite/somehtml.aspx](http://www.yoursite/somehtml.aspx)他将获得他需要的 html。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T09:57:02.667

如果您想安全地传递信息，那么您真的应该使用 SSL。另一种选择是创建一个 Web 服务，您的朋友可以调用它来使用各种安全技术（例如加密和用户身份验证）访问信息。

# sql - 我应该在 SQL 中包含审计表的主键吗？

> ID：724831
> 
> 赞同：1
> 
> 时间：2009-04-07T09:35:21.250
> 
> 标签：sql, audit

我正在创建一个审计表，用于跟踪对主表中的记录所做的更改。

这里的审计表是主表（比如员工表）的完全相同的副本，但对于主表中发生的每次更改只有“插入”。所以它会有重复（相同的 EmployeeID），所以我应该为每个条目添加单独的 Audit_ID 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T09:38:35.877

当然，您需要表中的某种主键。

如果有的话，删除重复项和跟踪“插入原因”（出于调试目的）会更容易。

如果您没有明确地执行某些操作`RDBMS`（例如`MySQL`with ），它实际上会为您创建一个隐藏的主键，因此您只需自己执行并使其可见且可用。`InnoDB`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T09:47:29.677

您几乎*必须*这样做，因为 Employee 中的 EmployeeID 将是唯一的（更新不会添加新行，只需修改现有行），审计表将有多个具有相同 EmployeeId 的行（一个用于初始插入，该员工的每个后续更新都有一个）。

此外，Employee 中的实体是员工。但是审计中的实体是审计记录。他们应该有自己的身份证。

如果出现问题并且您需要实际更新或删除审计记录，您将需要此功能。实际上，如果插入员工，则更新一列的值，然后再次更新为原始值，您现在在审计中有两条相同的记录。哪些必须一起删除或更新（除非您在更新或删除中使用了限制子句。）混乱。

这也指出了向审计表添加时间戳的有用性。但不要认为您应该使用它和employeeid 作为复合键。首先，复合键很烂。其次，时间戳的粒度完全有可能小于系统执行两次更新（同一员工的两次更新，例如批处理操作）所花费的时间。（Sybase 日期时间的粒度为 3 毫秒；Intel Core 2 Extreme 在这段时间内可以执行近 2*亿*条指令。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T09:40:12.237

您可以使用员工 ID 和审核日期时间作为复合键...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T09:43:47.940

是的。我相信每个表中的非语义主键是最佳实践，因为它允许您以实用的方式引用它。您可以比使用日期更容易地可视化“从`audit-id`到的变化”。`audit-id+1`

# asp.net-mvc - ASP MVC 网址格式

> ID：724832
> 
> 赞同：0
> 
> 时间：2009-04-07T09:35:44.840
> 
> 标签：asp.net-mvc

假设您有一个页面，该页面根据您指定的某些标识符（例如它所属的类别）提供歌曲列表。您的 URL 可能格式如下：

[http://mysite.com/songs/view/1](http://mysite.com/songs/view/1)

现在假设您想添加分页，构建该 URL 的最佳方式是什么以及操作方法如何工作？我假设这样的事情是不正确的

[http://mysite.com/songs/view/1/page/2](http://mysite.com/songs/view/1/page/2)

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T09:45:44.923

我认为那会很好，或者有一些变化：

*   `/songs/view/1/page2`
*   `/songs/view/1?page=2`
*   `/songs/view/1/2`

或者您可以将其保存在 cookie 或其他东西中，而根本不必在 URL 中处理它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T23:47:10.893

如果您的 url 为[http://mysite.com/songs/view/1/page/2](http://mysite.com/songs/view/1/page/2)，您将始终要求单词 page 在 url 中。

现在，如果它是[http://mysite.com/songs/view/1/2](http://mysite.com/songs/view/1/2)其中 2 是页码并且可以为空，您仍然可以调用[http://mysite.com/songs/view/1](http://mysite.com/songs/view/1)这将是您的第一页.

路由引擎足够聪明，可以在页码有值时附加页码。

```
public ActionResult View(int id, int? page)
{

}

MapRoute("songs.view", "songs/view/{id}/{page}", new { controller = "songs", action = "view", id = "", page = "1" }); 
```

# url - 给出错误类别时拒绝访问

> ID：724840
> 
> 赞同：0
> 
> 时间：2009-04-07T09:37:32.183
> 
> 标签：url, seo

我有一个网站，其中的项目可以分为几类（项目有一个，不像标签）。

这给了我类似[http://example.com/tutorials/12/Do-nice-things](http://example.com/tutorials/12/Do-nice-things)的 URL 。但是，URL 中的类别和标题是出于 SEO 目的，我不需要它们，只需要 ID。它也适用于[http://example.com/somethingwrong/12/Foobar](http://example.com/somethingwrong/12/Foobar)。

现在，问题是：我是否应该检查给定的类别和标题是否与项目的实际属性匹配，如果 URL 错误则显示 404？

请记住，类别和 URL 可以更改。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T09:47:24.217

是的，否则人们可能会链接到同一事物的多个版本，并且对于搜索引擎，它看起来像是重复的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T12:08:55.283

人们可以更改项目的类别和/或标题，这将破坏现有的链接。但是，我真的不希望人们能够使用任何东西，所以我选择重定向到正确的 URL。

ps 这应该是永久重定向还是临时重定向？永久的，我认为

# email - 替代 0px 图像（又名网络信标）

> ID：724851
> 
> 赞同：2
> 
> 时间：2009-04-07T09:40:52.550
> 
> 标签：email

我们的营销部门向“选择加入”的客户发送简报，并希望跟踪这些电子邮件中有多少被打开。这不是垃圾邮件练习 - 这些客户可以随时取消订阅，并且他们会选择加入。

问题是许多（大多数？）网络和桌面电子邮件客户端默认不显示图像。这意味着我们无法判断用户是否打开了电子邮件，因为 0px 图像不会触发。当然，如果他们允许我们的域使用图像，它会很好地触发。这是一些示例代码：

```
<img src ="http://www.mydomain.com/?someInfo=x&otherInfo=y" width="1" height="1" /> 
```

有谁知道这种跟踪打开的电子邮件等方法是否有任何替代方法？

非常感谢！

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-07T09:50:11.060

请不要做这种事情。

正是这种在游泳池里的小便使电子邮件和互联网的所有事物如今变得如此不必要地困难。

如果您想知道电子​​邮件是否已打开，请添加适当的处置通知标题 ( [https://www.rfc-editor.org/rfc/rfc5337](https://www.rfc-editor.org/rfc/rfc5337) )。如果这不起作用，那么就接受您的客户控制他们自己的计算机的权利高于您的营销部门收集统计数据的需要。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T10:24:37.967

提供一个足够有趣的链接以点击，转到特定于您的电子邮件的位置。
缺点：并非所有阅读电子邮件的用户都会点击它。
优点：总比没有好？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T11:42:19.607

我的建议是让他们的努力值得。在电子邮件中放置一个链接，让他们知道，如果他们点击它或以某种方式回复（让您知道他们已经打开了电子邮件），他们将获得一些奖励。

然后奖励他们。市场研究公司实际上是为人们的时间*付费*，为什么你应该有所不同？毕竟，这是他们为您提供的服务，而不是您的基本权利。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T10:11:37.920

> 这意味着我们无法判断用户是否打开了电子邮件

欢迎来到美妙的电子邮件世界！

类别 NOTABUG，标记 WONTFIX

（过去有一些方法可以欺骗某些邮件发送者通过样式表发出外部请求，但这些是高度特定于软件的，通常在找到时会修复。根据设计，您不会找到任何可靠的解决方案。）

PS。

```
src="http://www.mydomain.com/?someInfo=x&otherInfo=y" 
```

&

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T09:51:12.650

我认为在不损害客户隐私或电子邮件安全的情况下，没有正确的方法可以做到这一点。HTML 电子邮件是有史以来最丑陋和最不安全的技术之一。说服你的人停止使用这样的东西。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T09:53:22.487

通知标题是我所知道的唯一其他方式。

# maven-2 - 在 Maven2 上，如何在（失败或成功）构建结束时调用 URL？

> ID：724854
> 
> 赞同：0
> 
> 时间：2009-04-07T09:42:51.797
> 
> 标签：maven-2, continuous-integration

我构建了一个[小型 AppeEngine 应用程序](http://build-status.appspot.com/?app_name=myApp)，它根据 URL 调用（[/pass](http://build-status.appspot.com/pass?app_name=myApp)或[/fail](http://build-status.appspot.com/fail?app_name=myApp)）显示绿色或红色屏幕。该页面每分钟刷新一次。

这个想法是使用一台备用计算机来显示该构建状态页面并设置一个[持续集成](http://en.wikipedia.org/wiki/Continuous_Integration)工具（在我的例子中是 TeamCity），它将在每个 maven 2 构建结束时调用 /pass 或 /fail URL。

那么，如何让 maven 2 在构建结束时调用 URL（[/pass](http://build-status.appspot.com/pass?app_name=myApp)或[/fail](http://build-status.appspot.com/fail?app_name=myApp)）？

我正在考虑一个 Maven 2 插件，但是否可以在构建结束时调用插件（并获取构建状态）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T12:29:33.157

Hudson的[状态监视器插件](http://wiki.hudson-ci.org/display/HUDSON/Status+Monitor+Plugin)完全符合您的要求。它甚至可以监控多项工作，而不仅仅是一项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T20:21:00.047

您可以在“安装”阶段使用来自 maven 的 antrun 来检查文件是否存在，然后基于此执行 httpclient（或等效项）。或者您可以编写一个调用 maven 然后调用 curl 的包装器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-08T10:07:13.583

我认为另一种方法是为 TeamCity 构建自定义通知程序，例如[Nabaztag Notifier](http://code.google.com/p/buildbunny/wiki/CreateTeamcityNotifier)。

更新：好的，我刚刚开始在谷歌代码上自定义 TeamCity 通知程序：[buildstatusnotifier](http://code.google.com/p/buildstatusnotifier/)。构建起来非常简单...... :)

这是主类[WebNotifier](http://code.google.com/p/buildstatusnotifier/source/browse/trunk/build-status/src/main/java/org/buildstatus/WebNotifier.java)。

# python - 从具有特定索引的python列表中挑选项目

> ID：724856
> 
> 赞同：48
> 
> 时间：2009-04-07T09:43:33.447
> 
> 标签：python, list, indexing, list-comprehension

我确信在 Python 中有一种很好的方法可以做到这一点，但我对这门语言还很陌生，所以如果这很简单，请原谅我！

我有一个列表，我想从该列表中挑选出某些值。我要挑选的值是列表中的索引在另一个列表中指定的值。

例如：

```
indexes = [2, 4, 5]
main_list = [0, 1, 9, 3, 2, 6, 1, 9, 8] 
```

输出将是：

```
[9, 2, 6] 
```

（即 main_list 中索引为 2、4 和 5 的元素）。

我觉得这应该可以使用列表推导之类的东西来实现，但我无法弄清楚（特别是，我无法弄清楚在使用列表推导时如何访问项目的索引）。

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-04-07T09:50:52.837

```
[main_list[x] for x in indexes] 
```

这将使用列表推导返回对象列表。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T09:47:29.427

```
t = []
for i in indexes:
    t.append(main_list[i])
return t 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-07T14:33:09.803

```
map(lambda x:main_list[x],indexes) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-01-19T12:44:00.810

如果你擅长`numpy`：

```
import numpy as np
main_array = np.array(main_list) # converting to numpy array
out_array = main_array.take([2, 4, 5])
out_list = out_array.tolist() # if you want a list specifically 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T09:50:51.107

我认为 Yuval A 的解决方案非常清晰和简单。但是如果你真的想要一个单行列表理解：

```
[e for i, e in enumerate(main_list) if i in indexes] 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-08-23T14:51:16.780

作为列表推导的替代方法，您可以使用`map`with `list.__getitem__`。对于大型列表，您应该会看到更好的性能：

```
import random

n = 10**7
L = list(range(n))
idx = random.sample(range(n), int(n/10))

x = [L[x] for x in idx]
y = list(map(L.__getitem__, idx))

assert all(i==j for i, j in zip(x, y))

%timeit [L[x] for x in idx]            # 474 ms per loop
%timeit list(map(L.__getitem__, idx))  # 417 ms per loop 
```

对于惰性迭代器，您可以使用`map(L.__getitem__, idx)`. 注意在 Python 2.7 中，`map`返回一个列表，所以不需要传递给`list`.

# javascript - 如何通过名称查找 JavaScript 变量

> ID：724857
> 
> 赞同：39
> 
> 时间：2009-04-07T09:43:47.033
> 
> 标签：javascript

有没有办法通过名称在页面上找到 JavaScript 变量（将其作为对象获取）？变量名称可用作字符串常量。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-04-07T10:01:06.917

```
<script>
var a ="test";
alert(a);
alert(window["a"]);
alert(eval("a"));
</script> 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-04-07T10:08:25.290

所有 JS 对象（哪些变量）在其范围内都可以作为其父对象的命名属性使用。在不存在显式父对象的情况下，它隐含地是`window`对象。

IE：

```
var x = 'abc';
alert(window['x']); //displays 'abc' 
```

对于一个复杂的对象：

```
var x = {y:'abc'};
alert(x['y']); //displays 'abc' 
```

这可以链接：

```
var x = {y:'abc'};
alert(window['x']['y']); //displays 'abc' 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-07T17:24:13.200

如果您想要一个在全局上下文中声明的变量，则将其附加到窗口对象。例如：窗口[“变量名”]。所有变量都是其范围内的哈希表值。

如果您必须使用点表示法，那么您将需要遵循 kennebec 的建议，在对象层次结构中导航。eval() 也可以工作，但它比可能需要的操作更昂贵。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-08-27T14:26:20.580

如果它是一个全局变量，你可以在全局对象上按名称查找它，因为全局变量是全局对象的属性。在浏览器上，有一个全局变量引用名为 的全局对象`window`，因此：

```
var name = "foo";
window.foo = 42;
alert(Number(window[name])); // 42 
```

但是全局变量是一件坏事^(（tm）)。

要在没有全局变量的情况下执行此操作，请使用您自己的对象：

```
var name = "foo";
var obj = {};
obj.foo = 42;
alert(Number(obj[name])); // 42 
```

上述两种方法都有效，因为在 JavaScript 中，您可以使用点符号和文字 ( `obj.foo`) 或括号符号和字符串 ( `obj["foo"]`) 来引用对象属性，在后一种情况下，字符串可以是任何表达式，包括变量查找。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-07T15:11:35.110

如果您的字符串引用了全局的“深度”属性，例如“Yankee.console.format”，您可以逐步浏览这些引用：

```
String.prototype.deref= function(){
    // remove leading and trailing quotes and spaces
    var obj= this.replace(/(^[' "]+|[" ']+$)/g,'');

    var M= obj.match(/(^[\w\$]+(\.[\w\$]+)*)/);
    if(M){
        M= M[1].split('.');
        obj= window[M.shift()];
        while(obj && M.length) obj= obj[M.shift()];
    }   
    return obj || this;
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-07-02T17:34:33.747

```
var getVar = function (obj) {
    for(var key in this) {
        if(obj === this[key]) return key;
    }
};

foo = 'foo';

console.log( getVar(foo) ); // => 'foo' 
```

[https://stackoverflow.com/a/17432007/1250044](https://stackoverflow.com/a/17432007/1250044)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T09:45:39.213

你可以使用 eval()

# c# - 从十六进制转换为字符串

> ID：724862
> 
> 赞同：42
> 
> 时间：2009-04-07T09:45:10.900
> 
> 标签：c#, string, hex, bitconverter

我需要检查一个`string`位于我作为`byte`数组接收的数据包中的一个。如果我使用`BitConverter.ToString()`，我会像破折号一样得到字节`string`（fe：00-50-25-40-A5-FF）。
我尝试了快速谷歌搜索后发现的大多数函数，但它们中的大多数都有输入参数类型`string`，如果我`string`用破折号调用它们，它会引发异常。

我需要一个将十六进制（as`string`或 as `byte`）转换为`string`表示十六进制值（fe：0x31 = 1）的函数。如果输入参数是`string`，函数应该识别破折号（例如“47-61-74-65-77-61-79-53-65-72-76-65-72”），因为`BitConverter`不能正确转换。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-04-07T10:01:06.243

像这样？

```
static void Main()
{
    byte[] data = FromHex("47-61-74-65-77-61-79-53-65-72-76-65-72");
    string s = Encoding.ASCII.GetString(data); // GatewayServer
}
public static byte[] FromHex(string hex)
{
    hex = hex.Replace("-", "");
    byte[] raw = new byte[hex.Length / 2];
    for (int i = 0; i < raw.Length; i++)
    {
        raw[i] = Convert.ToByte(hex.Substring(i * 2, 2), 16);
    }
    return raw;
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2014-12-08T17:23:36.113

对于 Unicode 支持：

```
public class HexadecimalEncoding
{
    public static string ToHexString(string str)
    {
        var sb = new StringBuilder();

        var bytes = Encoding.Unicode.GetBytes(str);
        foreach (var t in bytes)
        {
            sb.Append(t.ToString("X2"));
        }

        return sb.ToString(); // returns: "48656C6C6F20776F726C64" for "Hello world"
    }

    public static string FromHexString(string hexString)
    {
        var bytes = new byte[hexString.Length / 2];
        for (var i = 0; i < bytes.Length; i++)
        {
            bytes[i] = Convert.ToByte(hexString.Substring(i * 2, 2), 16);
        }

        return Encoding.Unicode.GetString(bytes); // returns: "Hello world" for "48656C6C6F20776F726C64"
    }
} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-07T09:58:55.313

```
string str = "47-61-74-65-77-61-79-53-65-72-76-65-72";
string[] parts = str.Split('-');

foreach (string val in parts)
{ 
    int x;
    if (int.TryParse(val, out x))
    {
         Console.Write(string.Format("{0:x2} ", x);
    }
}
Console.WriteLine(); 
```

您可以在以下位置拆分字符串 -
将文本转换为整数 (int.TryParse) 将整数
输出为十六进制字符串 {0:x2}

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-01-03T04:20:44.053

```
 string hexString = "8E2";
 int num = Int32.Parse(hexString, System.Globalization.NumberStyles.HexNumber);
 Console.WriteLine(num);
 //Output: 2274 
```

来自[https://msdn.microsoft.com/en-us/library/bb311038.aspx](https://msdn.microsoft.com/en-us/library/bb311038.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T09:59:33.097

您对“0x31 = 1”的引用让我认为您实际上是在尝试将 ASCII 值转换为字符串-在这种情况下，您应该使用类似 Encoding.ASCII.GetString(Byte[])

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-07-25T14:22:05.103

如果您需要将结果作为字节数组，您应该直接传递它而不将其更改为字符串，然后将其更改回字节。在您的示例中， (fe: `0x31 = 1`) 是 ASCII 码。在这种情况下，要将字符串（十六进制值）转换为 ASCII 值，请使用： `Encoding.ASCII.GetString(byte[])`

```
 byte[] data = new byte[] { 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x30 };
        string ascii=Encoding.ASCII.GetString(data);
        Console.WriteLine(ascii); 
```

控制台会显示：1234567890

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-01-23T02:30:53.530

我的 Net 5 解决方案最后也处理空字符：

```
hex = ConvertFromHex( hex.AsSpan(), Encoding.Default );

static string ConvertFromHex( ReadOnlySpan<char> hexString, Encoding encoding )
{
    int realLength = 0;
    for ( int i = hexString.Length - 2; i >= 0; i -= 2 )
    {
        byte b = byte.Parse( hexString.Slice( i, 2 ), NumberStyles.HexNumber, CultureInfo.InvariantCulture );
        if ( b != 0 ) //not NULL character
        {
            realLength = i + 2;
            break;
        }
    }

    var bytes = new byte[realLength / 2];
    for ( var i = 0; i < bytes.Length; i++ )
    {
        bytes[i] = byte.Parse( hexString.Slice( i * 2, 2 ), NumberStyles.HexNumber, CultureInfo.InvariantCulture );
    }

    return encoding.GetString( bytes );
} 
```

# asp.net - 多个本地化的 aspx 布局

> ID：724865
> 
> 赞同：2
> 
> 时间：2009-04-07T09:45:51.867
> 
> 标签：asp.net, localization

我想本地化一个应用程序，目前使用`App_LocalResource`resx 文件进行语言更改。但是，我想根据语言环境更改 ASPX 页面上的控件布局。我知道可以从 resx 文件中设置可见。

例如; 我的默认（en-US）可能有

```
 "firstname" : [textbox]  
"surname"   : [textbox] 
```

作为de-DE，我想交换订单

```
 "surname"   : [textbox]
"firstname" : [textbox] 
```

aspx 页面将使用相同的 CodeBehind。

我想我正在寻找的是类似拥有的东西；

*   默认.aspx
*   default.de-DE.aspx
*   默认.aspx.cs

其中 default.de-DE.aspx 包含与 default.aspx 相同的所有控件等，甚至具有相同的指令；

```
 <%@ Page CodeFile="Default.aspx.cs" Inherits="MyNamespace.Default" %> 
```

然后 .NET 框架选择这个而不是 default.aspx 布局..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T16:46:52.077

我已经在一个项目上工作了很长一段时间，该项目基本上可以完成您想要做的事情；我们按文件夹拆分是唯一的区别，所以 /en-US/Default.aspx 和 /de-DE/Default.aspx。这些页面共享一个通用的功能代码隐藏。它工作得很好，有一些问题：

*   确保文件总是一起更新 - 这是必要的，因为背后的共享代码。如果更新后面的代码，所有引用的控件最好都存在于页面上。
*   请注意您的控件引用 - 我们遇到了一些从错误文件夹引用控件的问题，从而导致了一些有趣的（有时难以诊断）问题。

就我个人而言，我建议将其拆分为文件夹而不是使用文件命名结构，因为它也很容易让您提供特定于语言环境的图像和 CSS。它还允许您通过在后面添加适当的代码来覆盖页面的常见行为（您也可以这样做，但是由于文件名中的句点，您的类名会很奇怪[例如，ApplicationNS.Default_de_de 相反到 ApplicationNS.en_us.Default]）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T10:42:39.797

在类似的情况下，我创建了一个具有可本地化的“RenderOrder”属性的自定义服务器控件。它还将 Surname 和 FirstName 公开为属性。

有时，详细地址字段也需要类似的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T10:21:07.240

我应该投票支持构建一个控件，该控件是您显示日期和时间的方式，这在很大程度上取决于本地化

*   [ASP.NET 2.0 中的资源和本地化](http://msdn.microsoft.com/en-us/magazine/cc163566.aspx)
*   [自定义 ASP.NET 服务器控件和语言本地化](http://weblogs.asp.net/dwahlin/archive/2009/01/20/custom-asp-net-server-controls-and-language-localization.aspx)
*   [关于本地化的好文章](http://www.west-wind.com/presentations/wwDbResourceProvider/introtolocalization.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T16:13:16.290

我想说处理这个问题的最好方法是通过 CSS。

您可以轻松地应用不同的样式表，这可以完全改变您网站的布局，从而移动所有控件。此解决方案还允许您轻松地为移动浏览器或打印或任何其他原因进行替代渲染，并且非常通用。

正如其他人所说，您显然还会遇到其他本地化问题，例如翻译或日期/货币格式。但是您将不得不通过其他方式解决这些问题。

以下是同一网站的一些示例，100% 相同的 HTML，只有 CSS 发生了变化，呈现完全不同。

[http://www.csszengarden.com/?cssfile=/212/212.css&page=0](http://www.csszengarden.com/?cssfile=/212/212.css&page=0)

[http://www.csszengarden.com/?cssfile=/211/211.css&page=0](http://www.csszengarden.com/?cssfile=/211/211.css&page=0)

假设您只有两个要翻转的控件的简单情况：

```
<div>
<div class=class1>Control1</div>
<div class=class2>Control2</div>

</div> 
```

然后根据位置，在样式表中使用浮动或绝对定位（在父容器内）重新定位两个 div。100% 相同的 html，有两种不同的布局？

ASPX

```
<link rel="stylesheet" id="Stylesheet1" type="text/css" runat="server" /> 
```

ASPX.cs

```
Stylesheet1.Attributes("href") = ResolveUrl("~\styles\StyleSheet.css") 
```

# sql - PostgreSQL 与 MySQL 有何不同？

> ID：724867
> 
> 赞同：68
> 
> 时间：2009-04-07T09:46:25.953
> 
> 标签：sql, mysql, postgresql

我被要求支持并使用一个 PostgreSQL 应用程序，但我是一个 MySQL 人——这是一个现实的任务吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-07T10:00:02.597

`PostgreSQL`有一些不错的功能`generate_series`，例如自定义聚合函数、数组等，如果您花一些时间学习它们，它们可以极大地简化您的生活。

另一方面，它缺少一些功能，`MySQL`例如在查询中使用和分配会话变量`FORCE INDEX`等，如果您习惯了这些功能，这会很烦人。

如果您只使用 basic `SQL`，那么您几乎不会注意到任何区别。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-07T09:53:24.670

> PostgreSQL 与 MySQL 有何不同？

这取决于您是在谈论仅 SQL（几乎相同）还是存储过程（完全不同）。

> 这是一个现实的任务吗？

绝对地。PostgreSQL 有很好的文档和社区。还有很多人，他们有 MySQL 和 PostgreSQL 的经验。

[“MySQL vs PostgreSQL wiki”](http://www.wikivs.com/wiki/MySQL_vs_PostgreSQL) ——以“哪个更好”为中心，但让您了解一些差异。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-08T00:26:39.283

PostgreSQL compared to MySQL is as any other pair of DBMSs compared. What they have in common is non-functional, specifically the consequences of each being open source. In terms of features, use, and strengths they are no closer to each other than PostgreSQL is to Oracle or DB2 is to Sybase.

Now on to your real question: you are a **SQL guy**, albeit one who has not yet had experience with PostgreSQL. This is a completely realistic task for you, and a good one since you'll expand your understanding of the varieties of DBMSs and gain a perspective on MySQL that you can't get from working solely within its sphere.

As someone who was once in exactly the same position, my guess is that you'll quickly pick up PostgreSQL and might even hesitate to return to MySQL ;-).

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-08T00:27:42.823

If you're interested in the different flavors of SQL, here are a few resources (though some may be outdated):

*   [SQLZoo](http://sqlzoo.net/)
*   [SQL Dialects Reference Wikibook](http://en.wikibooks.org/wiki/SQL_dialects_reference)
*   [Tips on Writing Portable SQL](http://phplens.com/lens/adodb/tips_portable_sql.htm)
*   [SQL Bible](http://www.tar.hu/sqlbible/index.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-07T10:10:20.543

您可能想看看这些页面： [为什么使用 PostgreSQL 而不是 MySQL：比较 2007 年的可靠性和速度](http://wiki.postgresql.org/wiki/Why_PostgreSQL_Instead_of_MySQL:_Comparing_Reliability_and_Speed_in_2007)，[为什么使用 PostgreSQL 而不是 MySQL 2009](http://wiki.postgresql.org/wiki/Why_PostgreSQL_Instead_of_MySQL_2009)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-07T09:52:06.517

大约一个月前我遇到了同样的情况......我在 postgres 上做得很好。有一个强大的 postgres 在线社区，如果您遇到任何问题，您应该能够找到帮助并轻松学习：）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-07T10:13:05.670

当我第一次开始使用 PostgreSQL 时，我对以前的公司很生气，没多久就从 MySQL 切换到 PostgreSQL。与我之前使用的 MySQL 相比，我发现它非常好，非常令人耳目一新（并不是说 MySQL 不好）。PostgreSQL 也是我在当前公司使用的 Oracle 的一个很好的垫脚石。我喜欢它有一个像 MySQL 这样的适当的命令行应用程序，但配置选项更难——但如果你没有设置它，那么就没有问题。

# html - 关于使用 960 网格系统进行 CSS 设计的问题

> ID：724878
> 
> 赞同：4
> 
> 时间：2009-04-07T09:50:22.073
> 
> 标签：html, css, 960.gs

我正在使用[960 网格系统](http://960.gs/)来创建布局原型。

我想将*导航*和*内容*之间的颜色设置为#000（纯黑色），但我不知道如何。我目前得到的是：

![替代文字](https://imgur.com/1NM0Y.png)

使用此代码：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<link rel="stylesheet" type="text/css" media="all" href="css/reset.css" />
<link rel="stylesheet" type="text/css" media="all" href="css/text.css" />
<link rel="stylesheet" type="text/css" media="all" href="css/960.css" />
<link rel="stylesheet" type="text/css" media="all" href="css/custom.css" />
<title>The system</title>
</head>
<body>

<div class="container_16" id="base">
    <div class="grid_16" id="header">Graphical banner</div>
    <div class="grid_16" id="logoutrow">Logout row</div>
    <div class="grid_3" id="navigation">Navigation</div>
    <div class="grid_13" id="content">Content</div>
    <div class="grid_16" id="footer">Footer</div>
</div>

</body>
</html> 
```

我的两个问题：

*   **如何为所有“中间”空间指定颜色，例如导航和内容之间的空间？**
*   **如果我不像[本](http://nettuts.com/tutorials/html-css-techniques/prototyping-with-the-grid-960-css-framework/)教程中那样使用 clear，我的布局只会看起来像我想要的那样。为什么？**

对于中间颜色，我尝试将其放入 custom.css 中但没有成功：

```
div#base {
    background-color: #000;
} 
```

如果您不熟悉 960 网格系统，但仍想尝试帮助整个 960.css，可以在[这里](http://pastebin.com/f6e31aef1)找到。

* * *

**两个问题都解决了：**

*   我的第二个问题在 Jan Aagaard 的帖子中得到了解决。我没有包含 nbsp XML 实体并且有一个空的 div。它不起作用，至少在 Firefox 3.x 中不起作用。

我当前的代码如下所示：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<link rel="stylesheet" type="text/css" media="all" href="css/reset.css" />
<link rel="stylesheet" type="text/css" media="all" href="css/text.css" />
<link rel="stylesheet" type="text/css" media="all" href="css/960.css" />
<link rel="stylesheet" type="text/css" media="all" href="css/custom.css" />
<title>The system</title>
</head>
<body>

<div class="container_16" id="base">
    <div class="grid_16" id="header">Graphical banner</div>
    <div class="clear">&nbsp;</div>
    <div class="grid_16" id="logoutrow">Logout row</div>
    <div class="clear">&nbsp;</div>
    <div class="grid_16" id="navigation-content>
        <div class="grid_3 alpha" id="navigation">Navigation</div>
        <div class="grid_13 omega" id="content">Content</div>
    </div>
    <div class="clear">&nbsp;</div>
    <div class="grid_16" id="footer">Footer</div>
    <div class="clear">&nbsp;</div>
</div>

</body>
</html> 
```

[960 网格系统](http://960.gs/)说网格子节点应该遵循一定的规则。第一个子节点应该有*alpha*类，最后一个是*omega*类。这就是我在上面所做的。这与 GateKiller 在下面给出的答案不同，*除此之外，*它还提供了一个解决方案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T10:05:05.860

最好的方法是将 #navigation 和 #contents 包装在容器 div 中，如下所示：

```
<div class="container_16" id="base">
    <div class="grid_16" id="header">Graphical banner</div>
    <div class="grid_16" id="logoutrow">Logout row</div>
    <div class="grid_16" id="navigation-content">
        <div class="grid_3" id="navigation">Navigation</div>
        <div class="grid_13" id="content">Content</div>
    </div>
    <div class="grid_16" id="footer">Footer</div>
</div> 
```

然后你可以这样设置背景：

```
#navigation-content {
    background: #000
} 
```

如果您不使用完整的 16 个网格，或者如果您使用任何需要清除的浮动规则，您只需要清除 div。[作者有以下明确要说的](http://sonspring.com/journal/960-grid-system)：

> 最后，我想谈谈960.css中包含的清除方法。首先是我个人的偏好，添加一些无害的标记来清除所有元素。我已经写了很多关于它的内容，所以我不再赘述。基本上，将 class="clear" 添加到要消失的 <span> 或 <div> 中。它的唯一作用是清除浮动。
> 
> 另一种方法适用于所有不想弄脏 HTML 的标记纯粹主义者。相反，您可以通过 CSS 插入标记。这种技术也已经有据可查。本质上，将 class="clearfix" 添加到元素以清除它们之后的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T10:25:13.863

第二个问题的答案：`<div class="clear">&nbsp;</div>`将具有以下样式的元素添加到您的页面。它基本上是一个空元素，不允许任何元素在它的左边或右边，有效地强制它之前和之后的内容在不同的行上。并非所有浏览器都需要它。

```
{
  clear: both;
  display: block;
  overflow: hidden;
  visibility: hidden;
  width: 0;
  height: 0;
} 
```

您可以使用类来代替 clear 元素`clearfix`。像这样将它添加到您的 contianer 元素中：

```
<div class="container_16 clearfix" id="base"> 
```

这样可以避免空元素，但我认为这种解决方案与不同浏览器的兼容性较差。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T10:44:25.827

它们都是浮动的，所以我猜`#base`容器没有扩展来容纳它们。尝试添加`overflow: hidden;`到您的`#base`div 以使其包含浮动子元素 - 从而允许您查看已应用到它的背景颜色。

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2009-04-07T10:09:21.327

做这个 。

```
<div class="container_16" id="base" style="background:#000"> 
```

# java - 如何在struts标签中获取JSP scriptlet值

> ID：724887
> 
> 赞同：5
> 
> 时间：2009-04-07T09:52:20.213
> 
> 标签：java, jsp, struts

这是我的代码：

```
<% request.setAttribute("lcItem", "Hello"); %> 
```

如果我执行以下操作，我将无法获得价值：

```
<s:property value="%{lcItem}" />
<s:property value="lcItem" /> 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T11:40:31.450

这完美..

```
<%       
   request.setAttribute("lcItem", LeftContentItem);
%>

<s:property value="#request['lcItem']" /> 
```

注意：根据我们使用的范围，我们应该指定#request ..等

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-04-04T06:59:07.810

您可以通过 2 种方式编写代码

1.  **`<% request.setAttribute("lcItem", "Hello"); %>`**
2.  **`<% pageContext.setAttribute("lcItem", "Hello"); %>`**

那么如果你想在 Struts2 Components 中访问这些值，你可以使用**#attr。**作为前缀。

例子

**`<s:property value="#attr.lcItem">`**

注意：它适用于*request*和*"pageContext"*。

```
<s:property value="lcItem" /> will not work because "lcItem" is not available in the Value Stack. 
```

# ios - UITableView - 滚动到顶部

> ID：724892
> 
> 赞同：411
> 
> 时间：2009-04-07T09:54:54.713
> 
> 标签：ios, uitableview

在我的表格视图中，我必须滚动到顶部。但我不能保证第一个对象将是第 0 行第 0 行。可能是我的表格视图将从第 5 部分开始。

所以我得到一个例外，当我打电话时：

```
[mainTableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:0 inSection:0] atScrollPosition:UITableViewScrollPositionTop animated:NO]; 
```

还有另一种方法可以滚动到表格视图的顶部吗？

* * *

## 回答 #1

> 赞同：895
> 
> 时间：2009-04-07T10:23:31.307

UITableView 是 UIScrollView 的子类，所以你也可以使用：

```
[mainTableView scrollRectToVisible:CGRectMake(0, 0, 1, 1) animated:YES]; 
```

或者

```
[mainTableView setContentOffset:CGPointZero animated:YES]; 
```

在 Swift 中：

```
mainTableView.setContentOffset(CGPointZero, animated:true) 
```

在 Swift 3 及更高版本中：

```
mainTableView.setContentOffset(.zero, animated: true) 
```

* * *

## 回答 #2

> 赞同：247
> 
> 时间：2012-01-17T15:24:49.243

**注意**：此答案对 iOS 11 及更高版本无效。

我更喜欢

```
[mainTableView setContentOffset:CGPointZero animated:YES]; 
```

如果您的表格视图上有一个顶部插图，则必须减去它：

```
[mainTableView setContentOffset:CGPointMake(0.0f, -mainTableView.contentInset.top) animated:YES]; 
```

* * *

## 回答 #3

> 赞同：87
> 
> 时间：2016-02-16T09:37:32.817

**可能的行动：**

1

```
func scrollToFirstRow() {
    let indexPath = NSIndexPath(forRow: 0, inSection: 0)
    self.tableView.scrollToRowAtIndexPath(indexPath, atScrollPosition: .Top, animated: true)
} 
```

2

```
func scrollToLastRow() {
    let indexPath = NSIndexPath(forRow: objects.count - 1, inSection: 0)
    self.tableView.scrollToRowAtIndexPath(indexPath, atScrollPosition: .Bottom, animated: true)
} 
```

3

```
func scrollToSelectedRow() {
    let selectedRows = self.tableView.indexPathsForSelectedRows
    if let selectedRow = selectedRows?[0] as? NSIndexPath {
        self.tableView.scrollToRowAtIndexPath(selectedRow, atScrollPosition: .Middle, animated: true)
    }
} 
```

4

```
func scrollToHeader() {
    self.tableView.scrollRectToVisible(CGRect(x: 0, y: 0, width: 1, height: 1), animated: true)
} 
```

5

```
func scrollToTop(){
    self.tableView.setContentOffset(CGPointMake(0,  UIApplication.sharedApplication().statusBarFrame.height ), animated: true)
} 
```

禁用滚动到顶部：

```
func disableScrollsToTopPropertyOnAllSubviewsOf(view: UIView) {
    for subview in view.subviews {
        if let scrollView = subview as? UIScrollView {
            (scrollView as UIScrollView).scrollsToTop = false
        }
        self.disableScrollsToTopPropertyOnAllSubviewsOf(subview as UIView)
    }
} 
```

根据需要修改和使用它。

**斯威夫特 4**

```
 func scrollToFirstRow() {
    let indexPath = IndexPath(row: 0, section: 0)
    self.tableView.scrollToRow(at: indexPath, at: .top, animated: true)
  } 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2014-08-13T19:53:56.950

最好不要使用 NSIndexPath （空表），也不要假设顶点是 CGPointZero （内容插入），这就是我使用的 -

```
[tableView setContentOffset:CGPointMake(0.0f, -tableView.contentInset.top) animated:YES]; 
```

希望这可以帮助。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2017-10-08T12:54:00.137

**斯威夫特 4**：

这很好用：

```
//self.tableView.reloadData() if you want to use this line remember to put it before 
let indexPath = IndexPath(row: 0, section: 0)
self.tableView.scrollToRow(at: indexPath, at: .top, animated: true) 
```

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2018-01-18T07:14:38.097

在 iOS 11上，`adjustedContentInset`当通话状态栏可见或不可见时，用于在两种情况下正确滚动到顶部。

```
if (@available(iOS 11.0, *)) {
    [tableView setContentOffset:CGPointMake(0, -tableView.adjustedContentInset.top) animated:YES];
} else {
    [tableView setContentOffset:CGPointMake(0, -tableView.contentInset.top) animated:YES];
} 
```

迅速：

```
if #available(iOS 11.0, *) {
    tableView.setContentOffset(CGPoint(x: 0, y: -tableView.adjustedContentInset.top), animated: true)
} else {
    tableView.setContentOffset(CGPoint(x: 0, y: -tableView.contentInset.top), animated: true)
} 
```

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2017-09-26T23:50:28.857

我遇到了一个问题，调用在空的`tableView`. 这是 Swift 4 处理空表视图的另一个选项。

```
extension UITableView {
  func hasRowAtIndexPath(indexPath: IndexPath) -> Bool {
    return indexPath.section < self.numberOfSections && indexPath.row < self.numberOfRows(inSection: indexPath.section)
  }

  func scrollToTop(animated: Bool) {
    let indexPath = IndexPath(row: 0, section: 0)
    if self.hasRowAtIndexPath(indexPath: indexPath) {
      self.scrollToRow(at: indexPath, at: .top, animated: animated)
    }
  }
} 
```

用法：

```
// from yourViewController or yourTableViewController
tableView.scrollToTop(animated: true)//or false 
```

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2018-11-11T03:49:33.507

**不要使用**

```
 tableView.setContentOffset(.zero, animated: true) 
```

它有时会不正确地设置偏移量。例如，在我的例子中，单元格实际上略高于带有安全区域插图的视图。不好。

**代替使用**

```
 tableView.scrollToRow(at: IndexPath(row: 0, section: 0), at: .top, animated: true) 
```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2015-06-17T10:33:27.240

对于具有 的表，`contentInset`将内容偏移设置为`CGPointZero`不起作用。它会滚动到内容顶部与滚动到桌面。

考虑到内容插入会产生这样的结果：

```
[tableView setContentOffset:CGPointMake(0, -tableView.contentInset.top) animated:NO]; 
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2013-04-26T10:17:05.360

此代码可让您将特定部分滚动到顶部

```
CGRect cellRect = [tableinstance rectForSection:section];
CGPoint origin = [tableinstacne convertPoint:cellRect.origin 
                                    fromView:<tableistance>];
[tableinstance setContentOffset:CGPointMake(0, origin.y)]; 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2019-11-29T21:36:01.990

**斯威夫特 5，iOS 13**

我知道这个问题已经有了很多答案，但根据我的经验，这种方法总是有效的：

```
let last = IndexPath(row: someArray.count - 1, section: 0)
tableView.scrollToRow(at: last, at: .bottom, animated: true) 
```

如果您正在使用动画（如键盘）或某些异步任务，则尤其如此 - 其他答案通常会滚动到*几乎*底部。如果由于某种原因这并没有让你一直走到底部，那几乎可以肯定是因为一个竞争动画，所以解决方法是将这个动画分派到主队列的末尾：

```
DispatchQueue.main.async {
    let last = IndexPath(row: self.someArray.count - 1, section: 0)
    self.tableView.scrollToRow(at: last, at: .bottom, animated: true)
} 
```

这似乎是多余的，因为您已经在主队列中，但这并不是因为它序列化了动画。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2014-12-07T15:04:58.127

迅速：

```
tableView.setContentOffset(CGPointZero, animated: true) 
```

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2018-01-11T08:23:04.490

斯威夫特 3

```
tableView.setContentOffset(CGPoint.zero, animated: true) 
```

如果`tableView.setContentOffset`不工作。

采用：

```
tableView.beginUpdates()
tableView.setContentOffset(CGPoint.zero, animated: true)
tableView.endUpdates() 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2015-09-07T17:21:39.280

添加到已经说过的内容，您可以创建一个扩展 (Swift) 或类别 (Objective C)，以便将来更容易做到这一点：

迅速：

```
extension UITableView {
    func scrollToTop(animated: Bool) {
        setContentOffset(CGPointZero, animated: animated)
    }
} 
```

任何时候您想将任何给定的 tableView 滚动到顶部，您都可以调用以下代码：

```
tableView.scrollToTop(animated: true) 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2017-02-01T08:37:27.263

由于我`tableView`充满了各种插图，这是唯一运作良好的东西：

斯威夫特 3

```
if tableView.numberOfSections > 0 && tableView.numberOfRows(inSection: 0) > 0 {
  tableView.scrollToRow(at: IndexPath(row: 0, section: 0), at: .top, animated: true)
} 
```

斯威夫特 2

```
if tableView.numberOfSections > 0 && tableView.numberOfRowsInSection(0) > 0 {
  tableView.scrollToRowAtIndexPath(NSIndexPath(forRow: 0, inSection: 0), atScrollPosition: .Top, animated: true)
} 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2017-05-04T19:01:36.720

我更喜欢以下内容，因为它考虑了插图。如果没有 inset，它仍然会滚动到顶部，因为 inset 将为 0。

```
tableView.setContentOffset(CGPoint(x: 0, y: -tableView.contentInset.top), animated: true) 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2015-02-04T08:23:18.280

斯威夫特：

如果您没有 tableView 标头：

```
tableView.setContentOffset(CGPointMake(0,  UIApplication.sharedApplication().statusBarFrame.height ), animated: true) 
```

如果是这样的话 ：

```
tableView.setContentOffset(CGPointMake(0, -tableViewheader.frame.height   + UIApplication.sharedApplication().statusBarFrame.height ), animated: true) 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2017-09-22T20:32:21.103

这是我用来在 iOS 11 上正常工作的方法：

```
extension UIScrollView {
    func scrollToTop(animated: Bool) {
        var offset = contentOffset
        if #available(iOS 11, *) {
            offset.y = -adjustedContentInset.top
        } else {
            offset.y = -contentInset.top
        }
        setContentOffset(offset, animated: animated)
    }
} 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2019-04-30T08:32:57.837

在 Swift 5 中，非常感谢@Adrian 的回答

```
extension UITableView{

    func hasRowAtIndexPath(indexPath: IndexPath) -> Bool {
        return indexPath.section < numberOfSections && indexPath.row < numberOfRows(inSection: indexPath.section)
    }

    func scrollToTop(_ animated: Bool = false) {
        let indexPath = IndexPath(row: 0, section: 0)
        if hasRowAtIndexPath(indexPath: indexPath) {
            scrollToRow(at: indexPath, at: .top, animated: animated)
        }
    }

} 
```

用法：

```
tableView.scrollToTop() 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2017-06-12T04:41:46.757

使用 contentOffset 不是正确的方法。这会更好，因为它是表格视图的自然方式

```
tableView.scrollToRow(at: NSIndexPath.init(row: 0, section: 0) as IndexPath, at: .top, animated: true) 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2018-07-10T05:14:54.567

这是唯一对我有用的代码片段

斯威夫特 4：

```
 tableView.scrollRectToVisible(CGRect(x: 0, y: 0, width: 1, height: 1), animated: true)
    tableView.scrollToRow(at: IndexPath(row: 0, section: 0), at: .top, animated: true)
    tableView.setContentOffset(CGPoint(x: 0, y: -70), animated: true) 
```

PS 70 是我的标题和表格视图单元格的高度

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2017-01-04T06:24:37.923

```
func scrollToTop() {
        NSIndexPath *topItem = [NSIndexPath indexPathForItem:0 inSection:0];
        [tableView scrollToRowAtIndexPath:topItem atScrollPosition:UITableViewScrollPositionTop animated:YES];
} 
```

在任何你想要 UITableView 滚动到顶部的地方调用这个函数

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2018-02-20T06:23:32.487

**Swift 4**通过扩展，处理空表视图：

```
extension UITableView {
    func scrollToTop(animated: Bool) {
        self.setContentOffset(CGPoint.zero, animated: animated);
    }
} 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2018-06-07T10:22:59.260

我使用 tabBarController 并且在每个选项卡的 tableview 中都有几个部分，所以这对我来说是最好的解决方案。

```
extension UITableView {

    func scrollToTop(){

        for index in 0...numberOfSections - 1 {
            if numberOfSections > 0 && numberOfRows(inSection: index) > 0 {
                scrollToRow(at: IndexPath(row: 0, section: index), at: .top, animated: true)
                break
            }

            if index == numberOfSections - 1 {
                setContentOffset(.zero, animated: true)
                break
            }
        }

    }

} 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2015-08-31T10:37:24.527

迅速

你的行 = selectioncellRowNumber 你的部分如果你有 = selectionNumber 如果你没有设置为零

//UITableViewScrollPosition.Middle or Bottom or Top

```
var lastIndex = NSIndexPath(forRow:  selectioncellRowNumber, inSection: selectionNumber)
self.tableView.scrollToRowAtIndexPath(lastIndex, atScrollPosition: UITableViewScrollPosition.Middle, animated: true) 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2015-11-12T23:37:20.207

我必须将乘以添加`-1 *`到状态栏和导航栏的总和，因为它离屏幕的高度，

```
self.tableView.setContentOffset(CGPointMake(0 , -1 * 
  (self.navigationController!.navigationBar.height +  
  UIApplication.sharedApplication().statusBarFrame.height) ), animated:true) 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2017-01-04T06:29:00.843

这是以编程方式将 ScrollTableView 置顶的代码

迅速：

```
self.TableView.setContentOffset(CGPointMake(0, 1), animated:true) 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2017-01-24T07:41:50.427

在 Swift-3 中：

```
self.tableView.setContentOffset(CGPoint.zero, animated: true) 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-11-12T03:58:29.420

如果您想在表格中移动滚动动画，请使用此代码。滚动在 0.5 秒内以动画移动到顶部。

```
[UIView beginAnimations:nil context:nil];
[UIView setAnimationDuration:0.5];
[UIView setAnimationCurve:UIViewAnimationCurveEaseOut];

[_tableContent scrollRectToVisible:CGRectMake(0, 0, 1, 1) animated:YES];

[UIView commitAnimations]; 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2017-04-14T06:36:04.023

使用斯威夫特：

```
self.scripSearchView.quickListTbl?.scrollToRowAtIndexPath(indexPath, atScrollPosition: .Top, animated: true) 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2017-06-07T15:45:39.907

要在完成后完成，请添加此扩展

```
// MARK: - UIScrollView

extension UIScrollView {

    /// Animate scroll to top with completion
    ///
    /// - Parameters:
    ///   - duration:   TimeInterval
    ///   - completion: Completion block
    func animateScrollToTop(withDuration duration:  TimeInterval,
                            completion:             @escaping (()->())) {

        UIView.animate(withDuration: duration, animations: { [weak self] in
                self?.setContentOffset(CGPoint.zero, animated: false)
            }, completion: { finish in
                guard finish else {
                    return
                }
                completion()
        })
    }
}

tableView.animateScrollToTop(withDuration: 0.25) { 
    // Finish
} 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2020-06-11T06:01:27.047

这是一个 UIScrollView 扩展的简单示例，您可以在应用程序的任何地方使用它。

1）首先，您应该创建`enum`可能的滚动方向：

```
enum ScrollDirection {
    case top, right, bottom, left

    func contentOffsetWith(_ scrollView: UIScrollView) -> CGPoint {
        var contentOffset = CGPoint.zero
        switch self {
            case .top:
                contentOffset = CGPoint(x: 0, y: -scrollView.contentInset.top)
            case .right:
                contentOffset = CGPoint(x: scrollView.contentSize.width - scrollView.bounds.size.width, y: 0)
            case .bottom:
                contentOffset = CGPoint(x: 0, y: scrollView.contentSize.height - scrollView.bounds.size.height)
            case .left:
                contentOffset = CGPoint(x: -scrollView.contentInset.left, y: 0)
            }
        return contentOffset
    }
} 
```

2）然后添加扩展UIScrollView：

```
extension UIScrollView {
    func scrollTo(direction: ScrollDirection, animated: Bool = true) {
        self.setContentOffset(direction.contentOffsetWith(self), animated: animated)
    }
} 
```

3）就是这样！现在你可以使用它了：

```
myScrollView.scrollTo(.top, animated: false) 
```

此滚动绑定到 tableView 的内容大小，它看起来比滚动到更自然`CGPoint.zero`

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2021-02-23T08:55:06.670

如果你需要使用 Objective-C 或者你仍然爱着：

```
NSIndexPath *indexPath = [NSIndexPath indexPathForRow:0 inSection:0];
    [_tableView scrollToRowAtIndexPath:indexPath atScrollPosition:UITableViewScrollPositionTop animated:YES]; 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2022-01-09T07:38:42.487

使用 scrollToRow 的解决方案解决了空 TableView 的问题（需要搜索）。

```
import UIKit

extension UITableView {

    public func scrollToTop(animated: Bool = false) {
        if numberOfRows(inSection: 0) > 0 {
            scrollToRow(
                at: .init(row: 0, section: 0),
                at: .top,
                animated: animated
            )
        }
    }

} 
```

* * *

## 回答 #35

> 赞同：-3
> 
> 时间：2017-02-21T06:41:16.173

使用此代码`UITableview`快速实现：

```
var cell = tableView.dequeueReusableCellWithIdentifier(“cell”)
if cell == nil {
    cell = UITableViewCell(style: .Value1, reuseIdentifier: “cell”)
} 
```

* * *

## 回答 #36

> 赞同：-30
> 
> 时间：2014-11-19T09:09:53.050

如果您不想滚动，您可以在启动时立即启动和停止滚动动画。

```
 $('document').ready(function() {
    $("html, body").animate({ scrollTop: 0 }, 500);
    return true;
    }); 
```

此外，要为 'x' 和 'y' 的 put 值设置动画，传入 0,0 将立即将页面滚动到左上角。

```
window.scrollTo(x, y); 
```

# c# - 用于客户特定出口的插件、接口或其他东西

> ID：724894
> 
> 赞同：0
> 
> 时间：2009-04-07T09:55:21.750
> 
> 标签：c#, asp.net, export

我正在编写一个需要从中导出数据的 Web 应用程序。问题是每个客户都需要不同的格式。有些想要制表符分隔，有些想要逗号分隔，甚至是固定宽度。

每次导出也可能需要不同的数据。

我应该考虑采取哪些方法来使每个客户都可以拥有自己的格式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T06:07:45.983

我需要和你一样的要求。

这里有一些问题的链接帮助我实现了这个设计模式我猜这是策略模式和观察者模式之间的混合

如果您想要将所有“格式化程序”存储在同一个程序集中，那么您可以轻松地不进行反射。您可以将类名存储在客户端配置中，然后根据客户端配置的类创建格式化程序对象。

[反射和应用程序设计](https://stackoverflow.com/questions/651283/reflection-application-design)
[继承和事件](https://stackoverflow.com/questions/639911/inheritance-events)

如果您需要一个工作示例，我可以在早上发布一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T10:00:26.107

我会创建一个类来检索您感兴趣的数据。

我还将创建一个类（或一组类），其中包含/表示您检索到的数据。

然后，我想我会创建一个接口或抽象基类“打印机”或“格式化程序”，或者任何合适的名称，负责将数据格式化为所需的格式。然后，您可以创建特定的子类，这些子类实现了以正确格式放置数据所需的逻辑。

# sql - 具有数百万行的四个表之间的连接的 Sql 查询

> ID：724902
> 
> 赞同：1
> 
> 时间：2009-04-07T09:59:50.193
> 
> 标签：sql, sql-server, join, large-data-volumes

我们有一个事务 sql 语句，它查询 4 ​​个表，每个表有数百万行。

尽管根据 TuningAdvisor 已使用索引和统计数据对其进行了优化，但仍需要几分钟时间。

查询的结构如下：

```
SELECT E.EmployeeName
    , SUM(M.Amount) AS TotalAmount
    , SUM(B.Amount) AS BudgetAmount
    , SUM(T.Hours) AS TotalHours
    , SUM(TB.Hours) AS BudgetHours
    , SUM(CASE WHEN T.Type = 'Waste' THEN T.Hours ELSE 0 END) AS WastedHours
来自员工 E
左加入 MoneyTransactions M
    ON E.EmployeeID = M.EmployeeID
LEFT JOIN BudgetTransactions B
    ON E.EmployeeID = B.EmployeeID
LEFT JOIN TimeTransactions T
    ON E.EmployeeID = T.EmployeeID
左加入 TimeBudgetTransactions TB
    ON E.EmployeeID = TB.EmployeeID
GROUP BY E.EmployeeName

```

由于每个事务表包含数百万行，我考虑将其拆分为每个事务表一个查询，使用表变量，如`@real`,`@budget`和`@hours`，然后将它们连接到一个 final 中`SELECT`。但在测试中它似乎没有加速。

您将如何处理以加快速度？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T10:04:50.243

我不确定您发布的查询是否会产生您期望的结果。

它将交叉连接所有维度表（MoneyTransactions 等）并将所有结果相乘。

试试这个：

```
SELECT  E.EmployeeName,
        (
        SELECT  SUM(amount)
        FROM    MoneyTransactions m
        WHERE   M.EmployeeID = E.EmployeeID
        ) AS TotalAmount,
        (
        SELECT  SUM(amount)
        FROM    BudgetTransactions m
        WHERE   M.EmployeeID = E.EmployeeID
        ) AS BudgetAmount,
        (
        SELECT  SUM(hours)
        FROM    TimeTransactions m
        WHERE   M.EmployeeID = E.EmployeeID
        ) AS TotalHours,
        (
        SELECT  SUM(hours)
        FROM    TimeBudgetTransactions m
        WHERE   M.EmployeeID = E.EmployeeID
        ) AS BudgetHours
FROM    Employees E 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T10:17:27.687

我不知道您的表上是否有所有可以加快处理速度的索引，但是拥有大表可能会对查询时间产生这种影响。如果可能，我建议对表进行分区。这是更多的工作，但是您为加快查询所做的一切现在在几百万条新记录之后还不够。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-07-20T13:45:12.917

试试这个：

```
SELECT E.EmployeeName, TA.TotalAmount, BA.BudgetAmount, TWH.TotalHours, BH.BudgetHours, TWH.WastedHours
FROM Employees E
LEFT JOIN 
(SELECT E.EmployeeID, SUM(M.Amount) AS TotalAmount
FROM Employees E INNER JOIN MoneyTransactions M ON E.EmployeeID = M.EmployeeID GROUP BY E.EmployeeID)TA
ON E.EmployeeID = TA.EmployeeID
LEFT JOIN 
(SELECT E.EmployeeID , SUM(B.Amount) AS BudgetAmount
FROM Employees E INNER JOIN BudgetTransactions B ON E.EmployeeID = B.EmployeeID GROUP BY E.EmployeeID)BA
ON E.EmployeeID = BA.EmployeeID
LEFT JOIN 
(SELECT E.EmployeeID , SUM(T.Hours) AS TotalHours , SUM(CASE WHEN T.Type = 'Waste' THEN T.Hours ELSE 0 END) AS WastedHours
FROM Employees E INNER JOIN TimeTransactions T ON E.EmployeeID = T.EmployeeID GROUP BY E.EmployeeID)TWH
ON E.EmployeeID = TWH.EmployeeID
LEFT JOIN 
(SELECT E.EmployeeID , SUM(TB.Hours) AS BudgetHours
FROM Employees E INNER JOIN TimeBudgetTransactions TB ON E.EmployeeID = TB.EmployeeID GROUP BY E.EmployeeID)BH
ON E.EmployeeID = BH.EmployeeID 
```

# javascript - 如果一个元素正在被动画，我如何用 jQuery 找出？

> ID：724911
> 
> 赞同：102
> 
> 时间：2009-04-07T10:03:54.910
> 
> 标签：javascript, jquery, animation

我正在尝试移动页面上的一些元素，并且在动画发生期间，我希望将“溢出：隐藏”应用于元素，并在动画完成后将“溢出”返回到“自动”。

我知道 jQuery 有一个实用函数，可以确定某些元素是否正在动画，但我在文档中的任何地方都找不到它

* * *

## 回答 #1

> 赞同：202
> 
> 时间：2009-04-07T11:49:14.160

```
if( $(elem).is(':animated') ) {...} 
```

**更多信息**：[https ://api.jquery.com/animated-selector/](https://api.jquery.com/animated-selector/)

* * *

或者：

```
$(elem)
    .css('overflow' ,'hidden')
    .animate({/*options*/}, function(){
        // Callback function
        $(this).css('overflow', 'auto');
    }; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-01-15T10:29:39.977

或者，要测试某些内容是否没有动画，您可以简单地添加一个“！”：

```
if (!$(element).is(':animated')) {...} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-06-22T22:20:02.953

如果您正在使用`css`动画并使用 specific 分配动画`class name`，那么您可以像这样检查它：

```
if($("#elem").hasClass("your_animation_class_name")) {} 
```

但请确保在动画完成后删除处理动画的类名！

此代码可用于`class name`在动画完成后删除：

```
$("#elem").on('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',
function(){ 
        $(this).removeClass("your_animation_class_name");
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-08-25T08:23:46.180

如果您想将 css 应用于动画元素，您可以使用`:animated`伪选择器并这样做，

```
$("selector").css('overflow','hidden');
$("selector:animated").css('overflow','auto'); 
```

来源：[https ://learn.jquery.com/using-jquery-core/selecting-elements/](https://learn.jquery.com/using-jquery-core/selecting-elements/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-06-26T06:58:16.247

```
$('selector').click(function() {
  if ($(':animated').length) {
    return false;
  }

  $("html, body").scrollTop(0);
}); 
```

# c# - 代表的@前缀有什么特殊含义吗？

> ID：724912
> 
> 赞同：10
> 
> 时间：2009-04-07T10:04:43.257
> 
> 标签：c#, syntax, delegates

有几次我看到 ReSharper 生成的代码如下所示：

```
delegate void myHandler(int i);
myHandler myHandlerContainer;
...
foreach (Delegate @delegate in myHandlerContainer.GetInvocationList())
{...} 
```

**@delegate**中的“ **@** ”是否赋予该变量任何特殊的语义含义？ 还是只是我以前没有遇到过的约定？

 *** * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-07T10:16:27.970

来自 MSDN 的更多详细信息：

> 前缀“ `@`”允许使用关键字作为标识符，这在与其他编程语言交互时很有用。该字符`@`实际上不是标识符的一部分，因此标识符在其他语言中可能被视为普通标识符，没有前缀。带有`@`前缀的标识符称为***逐字标识符***。`@`允许对不是关键字的标识符使用前缀，但出于风格问题强烈建议不要使用。

来自[C# 语言规范：2.4.2 标识符](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/lexical-structure#identifiers)。

因此，使用 ' `@`' 前缀允许例如从名为 " `delegate`" 的类派生，该类可能定义在用 C# 以外的另一种语言编写的库中。

在任何其他情况下，我不建议使用这种语法，而是使用与 C# 关键字不同的标识符（例如`valu`代替`value`）来增加代码可读性并避免混淆是否附加任何特殊含义。如果已完成，请正确评论为什么要这样做，以便其他人知道。

关于变量命名还有另一个有趣的事实：

> 包含两个连续下划线字符 ( `U+005F`) 的标识符保留供实现使用。例如，一个实现可能会提供以两个下划线开头的扩展关键字。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-07T10:06:38.790

这`@delegate`是为了区分变量名和`delegate`关键字。

# timezone - 如何在 Trac 中设置时区？

> ID：724917
> 
> 赞同：3
> 
> 时间：2009-04-07T10:06:03.970
> 
> 标签：timezone, trac

我正在努力使用 Trac 设置时区。我四处寻找，但没有发现任何帮助。我能做些什么？

整个站点时区或每个用户的时区设置都会有所帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-07-25T07:22:57.533

就像其他人指出的那样，解决方案是将其添加到 trac.ini：

```
[trac]
default_timezone = ... 
```

但棘手的是格式（见[http://trac.edgewall.org/ticket/9581](http://trac.edgewall.org/ticket/9581)）：

*   您可以使用`GMT +xx:xx`格式（简单但不省时）
*   或输入一个时区名称，例如`America/Los_Angeles`需要安装[pytz](http://pytz.sourceforge.net/) - 请参阅[http://trac.edgewall.org/wiki/PyTz](http://trac.edgewall.org/wiki/PyTz)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T10:59:38.693

整个站点的默认时区设置在`trac.ini`：

```
[trac]
default_timezone = ... 
```

在用户首选项中，您有日期时间首选项 ( )，用户可以在其中设置自己的（每个用户）时区。*`«base_url»`*`/prefs/datetime`

参见例如[http://trac.edgewall.org/prefs/localization](http://trac.edgewall.org/prefs/localization)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-07T14:56:44.817

要设置站点默认时区，`trac.ini`请使用以下语法进行编辑：

```
[trac]
default_timezone = GMT +10:00 
```

或者

```
[trac]
default_timezone = GMT -7:00 
```

# jquery - $.ajax 中的某些参数未通过

> ID：724920
> 
> 赞同：1
> 
> 时间：2009-04-07T10:07:25.120
> 
> 标签：jquery, ajax, json, authorization

我有这个功能

```
$.ajax({
    url: aurl,
    method: 'GET',
    beforeSend: function (req) { req.setRequestHeader('Authorization', auth); },
    cache: false,
    dataType: "json",
    error: function () {
        //error code
    },
    success: function (t) {
        //success code
    }
}); 
```

但是，参数：

*   方法
*   发送前
*   缓存

被我的浏览器 FF3、IE8 和 Chrome 忽略。因此，无论放在那里都不会改变浏览器发送到给定 url 的请求，例如：不能将方法设置为“POST”，或者更重要的是，不能将授权参数作为请求的一部分放置，以便 HTTP 授权表单被处理。

另一个奇怪的行为是，除非 dataType:"json" 否则不会发送或接收请求或响应，如 FF3 中使用 LiveHTTPHeaders 所示。例如，如果数据类型：“xml”。

浏览器似乎正确处理了 URL。

有这些问题的人如何确保发送这些额外的参数？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-07T10:26:16.997

URL 是远程的还是本地的？

根据[JQuery 文档](http://docs.jquery.com/Ajax/jQuery.ajax)

> 注意：所有远程（不在同一个域中）请求应指定为何`GET`时`'script'`或是`'jsonp'`（`dataType`因为它使用 DOM 脚本标签加载脚本）。需要`XMLHttpRequest`对象的 Ajax 选项不适用于这些请求。complete 和 success 函数在完成时调用，但不接收`XHR`对象；和函数不被调用`beforeSend`。`dataFilter`

对于`cache`选项，默认值为：“ `dataType`' `script`'和' `jsonp`'的假”

# mysql - 更新时出现“ODBC”@“localhost”错误

> ID：724921
> 
> 赞同：0
> 
> 时间：2009-04-07T10:07:26.120
> 
> 标签：mysql

当我尝试更新数据库中的数据时出现此错误。这是我的 database.php 文件

```
<?php

 $db_name = "db";
 $db_server = "localhost";
 $db_user = "xxxx";
 $db_pass = "zzzzzzzzz";

 $mysqli = new MySQLi($db_server, $db_user, $db_pass, $db_name)
 or die(mysqli_error());

?> 
```

更新.php

```
<?php

 require 'database.php';

 $title = mysql_real_escape_string($_POST['title']);
 $id = mysql_real_escape_string($_POST['id']);

 $update_query = "UPDATE photos SET title = '$title' WHERE id='$id'";

 $result = $mysqli->query($update_query) or die(mysqli_error($mysqli));

 if ($result) {
    echo "Success!";
    echo "The title of this photo has been changed to:  <strong>$title</strong>";
 }

?> 
```

错误信息：

```
Warning: mysql_real_escape_string() [function.mysql-real-escape-string]: Access denied for user 'ODBC'@'localhost' (using password: NO) in C:\wamp\www\myPhotosWebsite\changePhotoTitle.php on line 5 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T10:30:57.077

您正在混合过程和面向对象的样式调用。

尝试：

```
$title = $mysqli->escape_string(_POST['title']); /* Call as a method */ 
```

代替：

```
$title = mysql_real_escape_string($_POST['title']); 
```

`real_escape_string`需要一个有效的连接句柄，因为它需要知道连接字符集。

如果将其作为过程调用，则应将连接句柄作为第一个参数传递：

```
mysql_real_escape_string($connection_handle, $string_to_escape) 
```

或者只是将其称为上述方法。

查看[`mysqli_real_escape_string`](http://php.net/manual/en/mysqli.real-escape-string.php)更多详细信息

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T10:10:54.410

在您的 mysql connect() 中，您的用户名/密码组合似乎被拒绝访问 mysql，您可能需要检查您的详细信息并重试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T10:35:04.713

mysql_real_escape_string 需要数据库连接才能操作。除非您明确传递一个，否则这意味着您必须先调用[`mysql_connect()`](http://de2.php.net/manual/en/function.mysql-connect.php)。但是您正在使用一个`MySQLi()`对象来获取连接。我认为 using`MySQLi()`不会设置默认的连接`mysql_`系列功能。当然，

```
(using password: NO) 
```

意味着它没有获得 $db_pass。

最好坚持使用“mysql”或“mysqli”，而不是尝试将两者混合使用。如果您使用 MySQLi，您可能希望利用参数化语句来避免`$mysqli->escape_string()`显式调用。

PS。

```
echo "The title of this photo has been changed to:  <strong>$title</strong>"; 
```

$title 是 SQL 转义的，但不是 HTML 转义的。它会包含不需要的反斜杠，同时不会阻止 HTML 注入（XSS 攻击）。反而：

```
echo 'The title of this photo has been changed to: <strong>'.htmlspecialchars($_POST['title']).'</strong>'; 
```

# python - 如何让 pdb 识别出源在运行之间发生了变化？

> ID：724924
> 
> 赞同：17
> 
> 时间：2009-04-07T10:09:09.283
> 
> 标签：python, debugging, pdb

据我所知，pdb 无法识别源代码在“运行”之间何时发生变化。也就是说，如果我在调试，发现一个错误，修复那个错误，然后在 pdb 中重新运行程序（即不退出 pdb），pdb 将不会重新编译代码。即使 pdb 列出了新的源代码，我仍然会调试旧版本的代码。

那么，pdb 不会随着源代码的变化而更新编译后的代码吗？如果没有，有没有办法让它这样做？我希望能够留在一个 pdb 会话中，以保留我的断点等。

FWIW，gdb 会注意到它正在调试的程序何时在它下面发生变化，尽管只有在重新启动该程序时才会注意到。这是我试图在 pdb 中复制的行为。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2014-04-21T23:22:56.930

以下迷你模块可能会有所帮助。如果你在你的 pdb 会话中导入它，那么你可以使用：

```
pdb> pdbs.r() 
```

随时强制重新加载除**main**之外的所有非系统模块。代码跳过了这一点，因为它引发了 ImportError('Cannot re-init internal module **main** ') 异常。

```
# pdbs.py - PDB support

from __future__ import print_function

def r():
    """Reload all non-system modules, to reload stuff on pbd restart. """
    import importlib
    import sys

    # This is likely to be OS-specific
    SYS_PREFIX = '/usr/lib'

    for k, v in list(sys.modules.items()):
        if (
            k == "__main__" or
            k.startswith("pdb") or
            not getattr(v, "__file__", None)
            or v.__file__.startswith(SYS_PREFIX)
        ):
            continue
        print("reloading %s [%s]" % (k, v.__file__), file=sys.stderr)
        importlib.reload(v) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T11:44:45.700

“在 pdb 中重新运行程序”是什么意思？如果你已经导入了一个模块，Python 不会重新读取它，除非你明确要求这样做，即使用`reload(module)`. 然而，`reload`这远非防弹（见[xreload](http://svn.python.org/projects/sandbox/trunk/xreload/xreload.py)另一种策略）。

Python代码重载有很多陷阱。例如，为了更有效地解决您的问题，您可以使用一个类将 pdb 包装起来，该类将您的断点信息记录到磁盘上的文件中，并在命令中播放它们。

（对不起，忽略这个答案的第一个版本；现在还早，我没有仔细阅读你的问题。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2020-10-04T12:27:15.890

基于@pourhaus 的回答（从 2014 年开始），这个秘籍使用命令增强了*[`pdb++`](https://github.com/pdbpp/pdbpp)调试器*`reload`（预计可以在 Linux 和 Windows 上运行，在任何 Python 安装上）。

提示：新`reload`命令接受一个可选的模块前缀列表来重新加载（和*排除*），而不是在恢复调试时破坏已经加载的*全局变量。*

只需将以下*Python-3.6*代码插入到您的`~/.pdbrc.py`文件中：

```
## Augment `pdb++` with a `reload` command
#
#  See https://stackoverflow.com/questions/724924/how-to-make-pdb-recognize-that-the-source-has-changed-between-runs/64194585#64194585

from pdb import Pdb

def _pdb_reload(pdb, modules):
    """
    Reload all non system/__main__ modules, without restarting debugger.

    SYNTAX:
        reload [<reload-module>, ...] [-x [<exclude-module>, ...]]

    * a dot(`.`) matches current frame's module `__name__`;
    * given modules are matched by prefix;
    * any <exclude-modules> are applied over any <reload-modules>.

    EXAMPLES:
        (Pdb++) reload                  # reload everything (brittle!)
        (Pdb++) reload  myapp.utils     # reload just `myapp.utils`
        (Pdb++) reload  myapp  -x .     # reload `myapp` BUT current module

    """
    import importlib
    import sys

    ## Derive sys-lib path prefix.
    #
    SYS_PREFIX = importlib.__file__
    SYS_PREFIX = SYS_PREFIX[: SYS_PREFIX.index("importlib")]

    ## Parse args to decide prefixes to Include/Exclude.
    #
    has_excludes = False
    to_include = set()
    # Default prefixes to Exclude, or `pdb++` will break.
    to_exclude = {"__main__", "pdb", "fancycompleter", "pygments", "pyrepl"}
    for m in modules.split():
        if m == "-x":
            has_excludes = True
            continue

        if m == ".":
            m = pdb._getval("__name__")

        if has_excludes:
            to_exclude.add(m)
        else:
            to_include.add(m)

    to_reload = [
        (k, v)
        for k, v in sys.modules.items()
        if (not to_include or any(k.startswith(i) for i in to_include))
        and not any(k.startswith(i) for i in to_exclude)
        and getattr(v, "__file__", None)
        and not v.__file__.startswith(SYS_PREFIX)
    ]
    print(
        f"PDB-reloading {len(to_reload)} modules:",
        *[f"  +--{k:28s}:{getattr(v, '__file__', '')}" for k, v in to_reload],
        sep="\n",
        file=sys.stderr,
    )

    for k, v in to_reload:
        try:
            importlib.reload(v)
        except Exception as ex:
            print(
                f"Failed to PDB-reload module: {k} ({v.__file__}) due to: {ex!r}",
                file=sys.stderr,
            )

Pdb.do_reload = _pdb_reload 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-10-30T14:26:19.127

我决定在我的输入脚本中注释一些行，然后

```
(Pdb) run 
```

我让 pdb 认识到这种变化。坏事：它从一开始就运行脚本。下面的好东西。

```
(Pdb) help run
run [args...]
        Restart the debugged python program. If a string is supplied
        it is split with "shlex", and the result is used as the new
        sys.argv.  History, breakpoints, actions and debugger options
        are preserved.  "restart" is an alias for "run". 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-10-07T13:02:21.883

可能不适用于更复杂的程序，但对于`importlib.reload()`使用 Python v3.5.3 的简单示例：

```
[user@machine ~] cat test.py
print('Test Message')

#
# start and run with debugger
#
[user@machine ~] python3 -m pdb test.py
> /home/user/test.py(1)<module>()
-> print('Test Message')
(Pdb) c
Test Message
The program finished and will be restarted
> /home/user/test.py(1)<module>()
-> print('Test Message')

#
# in another terminal, change test.py to say "Changed Test Message"
#

#
# back in PDB:
#
(Pdb) import importlib; import test; importlib.reload(test)
Changed Test Message
<module 'test' from '/home/user/test.py'>
(Pdb) c
Test Message
The program finished and will be restarted
> /home/user/test.py(1)<module>()
-> print('Changed Test Message')
(Pdb) c
Changed Test Message
The program finished and will be restarted
> /home/user/test.py(1)<module>()
-> print('Changed Test Message') 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2017-11-21T14:03:53.143

**ipdb`%autoreload`扩展**

6.2.0 文档文档[http://ipython.readthedocs.io/en/stable/config/extensions/autoreload.html#module-IPython.extensions.autoreload](http://ipython.readthedocs.io/en/stable/config/extensions/autoreload.html#module-IPython.extensions.autoreload)：

```
In [1]: %load_ext autoreload

In [2]: %autoreload 2

In [3]: from foo import some_function

In [4]: some_function()
Out[4]: 42

In [5]: # open foo.py in an editor and change some_function to return 43

In [6]: some_function()
Out[6]: 43 
```

# php - 将分数转换为 html 实体

> ID：724926
> 
> 赞同：7
> 
> 时间：2009-04-07T10:09:49.483
> 
> 标签：php, html, string, html-entities, fractions

我们在数据库中存储了一些分数信息，例如 ¾ ½

如果没有进行搜索和替换，是否有任何内置的 PHP 函数可以自动将这些转换为正确的 html 实体？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T10:14:46.353

您可以使用[htmlentities() 函数](http://us3.php.net/htmlentities)。这会将所有特殊字符替换为其等效的 HTML。它应该可以完成您需要的工作。

好问题顺便说一句，+1。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T10:15:31.250

[实体](http://de3.php.net/manual/en/function.htmlentities.php)。

但你可能不需要。以包含它们的编码（UTF-8、ISO-8859-1）为您的页面提供服务，您可以将它们包含为文字、非转义字符。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-28T21:23:28.867

答案已经给出：使用`htmlentities()`. 另外，有人建议使用 UTF-8，这当然是个好主意。但是，如果您打算`htmlentities()`在 UTF-8 字符串上使用，请使用以下代码（否则您会得到奇怪的编码字符）：

```
htmlentities($str, ENT_COMPAT, 'UTF-8') 
```

正如你可以想象的那样，不得不一直添加第二个和第三个参数是很糟糕的。对于我需要的大多数项目`htmlentities()`，我最终编写了一个快捷功能，即：

```
function he($str) { // shortcut function for htmlentities() with UTF-8 settings
 return htmlentities($str, ENT_COMPAT, 'UTF-8');
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T10:14:59.737

尝试 htmlentities()

# c# - 如何仅将文件夹中的某些图像显示到 ASP.NET 中的中继器中

> ID：724928
> 
> 赞同：1
> 
> 时间：2009-04-07T10:10:25.270
> 
> 标签：c#, asp.net, image, repeater, itemdatabound

我有一个中继器，它将我所有的图像放在一个文件夹中并显示它。但是我必须进行哪些代码更改才能只允许说 Image1.jpg 和 Image2.jpg 显示在我的转发器中。我不希望中继器显示我文件夹中的所有图像。

我的中继器

```
<asp:Repeater ID="repImages" runat="server" OnItemDataBound="repImages_ItemDataBound">
<HeaderTemplate><p></HeaderTemplate>
<ItemTemplate>
    <asp:HyperLink ID="hlWhat" runat="server" rel="imagebox-bw">
    <asp:Image ID="imgTheImage" runat="server" />
    </asp:HyperLink>
</ItemTemplate>
<FooterTemplate></p></FooterTemplate>
</asp:Repeater> 
```

我的代码背后 - 页面加载

```
protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            string sBasePath = System.Web.HttpContext.Current.Request.ServerVariables["APPL_PHYSICAL_PATH"];
            if ( sBasePath.EndsWith("\\"))
                sBasePath = sBasePath.Substring(0,sBasePath.Length-1);

            sBasePath = sBasePath + "\\" + "pics";

            System.Collections.Generic.List<string> oList = new System.Collections.Generic.List<string>();
            foreach (string s in System.IO.Directory.GetFiles(sBasePath, "*.*"))
            {
                //We could do some filtering for example only adding .jpg or something
                oList.Add( System.IO.Path.GetFileName( s ));

            }
            repImages.DataSource = oList;
            repImages.DataBind();
        }

    } 
```

My Code behind - Repeater 的 ItemDataBound 事件代码

```
protected void repImages_ItemDataBound(object sender, RepeaterItemEventArgs e)
    {
        if (e.Item.ItemType == ListItemType.AlternatingItem ||
            e.Item.ItemType == ListItemType.Item)
        {
            string sFile = e.Item.DataItem as string;

            //Create the thumblink
            HyperLink hlWhat = e.Item.FindControl("hlWhat") as HyperLink;
            hlWhat.NavigateUrl = ResolveUrl("~/pics/" + sFile  );
            hlWhat.ToolTip = System.IO.Path.GetFileNameWithoutExtension(sFile);
            hlWhat.Attributes["rel"] = "imagebox-bw";

            Image oImg = e.Item.FindControl("imgTheImage") as Image;
            oImg.ImageUrl = ResolveUrl("~/createthumb.ashx?gu=/pics/" + sFile + "&xmax=100&ymax=100" );

        }

    } 
```

**回答：**

我更新的页面加载

```
protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            string sBasePath = System.Web.HttpContext.Current.Request.ServerVariables["APPL_PHYSICAL_PATH"];
            if ( sBasePath.EndsWith("\\"))
                sBasePath = sBasePath.Substring(0,sBasePath.Length-1);

            sBasePath = sBasePath + "\\" + "pics";

            System.Collections.Generic.List<string> oList = new System.Collections.Generic.List<string>();

            string[] extensions = { "*.jpg", "*.png" };

            List<string> files = new List<string>(); 

            foreach (string filter in extensions) 
            {
                files.AddRange(System.IO.Directory.GetFiles(sBasePath, filter)); 
                oList.Add(System.IO.Path.GetFileName(filter));
            }

            repImages.DataSource = oList;
            repImages.DataBind();
        } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T10:21:21.890

您要显示的图像名称是什么格式？如果您知道可以构造一个过滤器以在列出目录内容时使用：

```
string[] files = Directory.GetFiles(folder, "*1.jpg"); 
```

将列出所有以“1”结尾的 jpg 文件

编辑：

而不是：

```
foreach (string s in System.IO.Directory.GetFiles(sBasePath, "*.*"))
{
    //We could do some filtering for example only adding .jpg or something
    oList.Add( System.IO.Path.GetFileName( s ));
} 
```

你会有：

```
string[] files = System.IO.Directory.GetFiles(sBasePath, "*.jpg")
foreach (string s in files)
{
    oList.Add( System.IO.Path.GetFileName( s ));
} 
```

编辑2：

我进行了快速搜索，看起来 Get Files 不会采用多个扩展名，因此您必须分别搜索每种类型的扩展名：

```
string[] extensions = {"*.jpg" , "*.png" };

List<string> files = new List<string>();
foreach(string filter in extensions)
{
    files.AddRange(System.IO.Directory.GetFiles(path, filter));
}
foreach (string s in files)
{
    oList.Add( System.IO.Path.GetFileName( s ));
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-07T11:39:27.210

最简单的方法是将它们全部加载到 List<> 中，然后使用 Linq 过滤掉你想要的。

**VS2005**

```
public class GetFiles
{

    public static void Main(string[] args)
    {
        FileInfo[] files = 
            new DirectoryInfo(@"D:\downloads\_Installs").GetFiles();
        ArrayList exefiles = new ArrayList();

        foreach (FileInfo f in files)
        {
            if (f.Extension == ".exe") // or whatever matching you want to do.
            {
                exefiles.Add(f);
            }
        }

        foreach (FileInfo f in exefiles)
        {
            Console.WriteLine(f.FullName);
        }
        Console.ReadKey();
    }
} 
```

**VS2008**

```
public class GetFiles
{
    public static void Main(string[] args)
    {
        FileInfo[] files = 
            new DirectoryInfo(@"D:\downloads\_Installs").GetFiles();

        var exefiles = from FileInfo f in files 
                       where f.Extension == ".exe" 
                       select f;

        foreach (FileInfo f in exefiles)
        {
            Console.WriteLine(f.FullName);
        }

        Console.ReadKey();
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T10:12:52.253

您需要做的是在将列表绑定到转发器控件之前过滤掉所有您不想显示的图像。

# php - 如何区分表示元素和属性的 SimpleXML 对象？

> ID：724935
> 
> 赞同：3
> 
> 时间：2009-04-07T10:12:36.327
> 
> 标签：php, reflection, simplexml

我需要以特定方式打印*任意SimpleXML 对象，并对属性节点进行特殊处理。*

问题是 SimpleXML 元素和属性似乎使用完全相同的类，属性节点甚至假装支持`attributes()`方法，而 SimpleXML 隐藏了它的内部，所以似乎没有任何方法可以告诉节点类型（缺少生成 XML并重新分析它）。

两者都给出*相同的*结果：

```
$element = new SimpleXMLElement('<foo>test</foo>');
echo $element;
print_r($element);

$element = new SimpleXMLElement('<foo attr="test" />');
echo $element['attr'];
print_r($element['attr']); 
```

是否有允许在 SimpleXML 中识别节点类型的隐藏属性/方法？等效于 DOM`$node->nodeType`或`$node instanceof DOMAttr`? （我不能改用 DOM，对 SimpleXML 的支持是核心要求）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-02-12T09:29:05.163

没有内置属性`SimpleXMLElement`可以让您将它们区分开来。

然而，正如其他人所建议[`dom_import_simplexml`](http://php.net/dom_import_simplexml)的那样，该函数有时可以动态更改节点，例如，如果您传入一个子节点列表或命名的子节点，它将接受这些并将它们变成第一个元素。

如果它是一个空列表，例如没有从`attributes()`或不存在的命名子节点返回属性，它会给出一个警告，告诉你一个无效的节点类型已经给出：

> 警告：dom_import_simplexml()：要导入的节点类型无效

因此，如果您需要使用活泼的布尔值`true`/`false`来实现这一点，那么它是如何与 Simplexml 一起使用的：

```
$isElement   = $element->xpath('.') == array($element);

$isAttribute = $element[0] == $element
               and $element->xpath('.') != array($element); 
```

它与属性列表和元素列表类似，我[早上刚刚在博客上写过这个](http://hakre.wordpress.com/2013/02/12/simplexml-type-cheatsheet)，你需要有一些关于评估什么的具体知识，所以我为它创建了一个备忘单：

```
+------------------+---------------------------------------------+
| TYPE             | TEST                                        |
+------------------+---------------------------------------------+
| Element          | $element->xpath('.') == array($element)     |
+------------------+---------------------------------------------+
| Attribute        | $element[0] == $element                     |
|                  | and $element->xpath('.') != array($element) |
+------------------+---------------------------------------------+
| Attributes       | $element->attributes() === NULL             |
+------------------+---------------------------------------------+
| Elements         | $element[0] != $element                     |
|                  | and $element->attributes() !== NULL         |
+------------------+---------------------------------------------+
| Single           | $element[0] == $element                     |
+------------------+---------------------------------------------+
| Empty List       | $element[0] == NULL                         |
+------------------+---------------------------------------------+
| Document Element | $element->xpath('/*') == array($element)    |
+------------------+---------------------------------------------+ 
```

*   [SimpleXML 类型备忘单（2013 年 2 月 12 日；作者 hakre）](http://hakre.wordpress.com/2013/02/12/simplexml-type-cheatsheet)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-15T20:40:43.963

是的，有办法。好吧，您可以通过 API 检索没有什么优雅的东西，但是在 SimpleXML 内部的某个地方会跟踪它是什么并且它会产生差异，例如，当您调用诸如 getName() 或 asXML() 之类的函数时。

```
$element = new SimpleXMLElement('<foo>test</foo>');
print_r($element->getName());
print_r($element->asXML());
echo "------------------\n";
$element = new SimpleXMLElement('<foo attr="test" />');
$at = $element['attr'];
print_r($at->getName());
print_r($at->asXML());

foo
<?xml version="1.0"?>
<foo>test</foo>
------------------
attr 
attr="test" 
```

你的代码不会赢得选美比赛，但至少你可以做到。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-18T03:04:23.210

使用 palako 指出的内容，这样的功能可能会起作用：

```
function is_attribute($node) {
    return !($node->asXML()[0] == "<")
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T10:29:27.987

您需要[SimpleXMLElement::attributes](http://www.php.net/manual/en/function.simplexml-element-attributes.php)：

```
function xml_out($el) {
    $name = $el->getName();
    echo '<'. $name;

    if (count($el->attributes())) {
        foreach ($el->attributes() as $a=>$v) {
            echo ' '. ((string)$a) . '="' . htmlspecialchars((string)$v) . '"';
        }
    }

    echo '>'. (string)$el;

    if (count($el->children())) {
        foreach($el->children() as $c) {
            xml_out($c);
        }
    }
    echo '</'. $name . '>';

} 
```

可能需要一些调整。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-15T04:49:56.467

> 是否有允许在 SimpleXML 中识别节点类型的隐藏属性/方法？DOM 的 $node->nodeType 或 $node instanceof DOMAttr 的等价物？（我不能使用 DOM，支持 SimpleXML 是核心要求）

答案是否定的……是的。SimpleXML 没有这样的属性，但好消息是：SimpleXML 和 DOM 是同一枚硬币的两个面。*（硬币是 libxml ;)）*您不必选择其中之一，您可以同时使用！你可以`SimpleXMLElement`变成`DOMNode`，反之亦然。在您的情况下，您可以执行以下操作：

```
$element = new SimpleXMLElement('<foo attr="test" />');
$is_attr = (dom_import_simplexml($element['attr'])->nodeType === XML_ATTRIBUTE_NODE); 
```

如果这是您经常做的事情，或者您不想处理 DOM/SimpleXML 杂耍，您可以看看[SimpleDOM](http://code.google.com/p/simpledom/)。

```
$element = new SimpleDOM('<foo attr="test" />');
$is_attr = ($element['attr']->nodeType() === XML_ATTRIBUTE_NODE); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-15T15:54:40.283

不幸的是，没有允许在 SimpleXML 中识别节点类型的隐藏属性或方法。SimpleXML 仅使用一个 Class 并且元素没有任何指向其父级的内容。如果您尝试以下反射，您会发现没有什么可以区分元素或属性。

```
$element = new SimpleXMLElement('<foo>test</foo>');
echo ReflectionObject::export($element);

$element = new SimpleXMLElement('<foo attr="test">test</foo>');
echo ReflectionObject::export($element['attr']); 
```

但是，如果元素具有属性，您可以检测到它。因此，您必须假设传入的所有元素都具有属性。有了这个假设，您就可以将它们区分开来。

```
$element = new SimpleXMLElement('<foo attr="test">test</foo>');

echo ReflectionObject::export($element);
echo ReflectionObject::export($element['attr']); 
```

这是我能想到的最好的。请记住，没有属性的元素仍然可能返回 false 。

```
function isNotAttribute($simpleXML)
{
  return (count($simpleXML->attributes()) > 0);
}

$element = new SimpleXMLElement('<foo attr="test">test</foo>');
var_dump(isNotAttribute($element));
var_dump(isNotAttribute($element['attr']));

// returns
bool(true)
bool(false) 
```

# java - 字符编码问题 - Java

> ID：724940
> 
> 赞同：0
> 
> 时间：2009-04-07T10:13:50.690
> 
> 标签：java, character-encoding

我编写了一个小应用程序，它执行一些文本操作并将输出写入文件（html、csv、docx、xml），这一切似乎在 Mac OS X 上都可以正常工作。但是在 Windows 上，我似乎遇到了字符编码问题很多 '"' 似乎消失了，取而代之的是一些奇怪的东西。通常是一对中的结束 '"'。

我使用 FreeMarker 来创建我的输出文件，并且在读取模板和写入输出之间有一个 byte[] 数组，在一种情况下还有一个 ByteArrayStream。我认为这是一个字符编码问题，所以如果有人可以给我建议或指向我一些“最佳实践”资源来处理 java 中的字符编码。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-07T10:31:24.503

实际上只有一个最佳实践：请注意，字符串和字节是两个根本不同的东西，并且无论何时在它们之间进行转换，您都在使用字符编码（隐式或显式），您需要注意这一点。

Java API 中的典型问题点是：

*   `new String(byte[])`
*   `String.getBytes()`
*   `FileReader, FileWriter`

所有这些都隐式使用平台默认编码，这取决于操作系统和用户的区域设置。通常，最好避免这种情况并在上述情况下显式声明编码（不幸的是，FileReader/Writer 不允许，因此您必须使用 InputStreamReader/Writer）。

但是，您对引号的问题和您对模板引擎的使用可能有一个更简单的解释。你用什么程序来写你的模板？听起来它是插入["智能引号"](http://blogs.msdn.com/oldnewthing/archive/2009/02/25/9443404.aspx)的一个，它是特定于 Windows 的 cp1251 编码的一部分，但在更全局的 ISO-8859-1 编码中不存在。

您可能需要做的是了解您的模板保存在哪种编码中，并配置您的模板引擎以在读取模板时使用该编码。另请注意，某些 texxt 文件，特别是 XML，在标头中显式声明编码，如果该标头与文件使用的实际编码不一致，您总是会遇到问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-07T10:30:38.437

您可以通过提供 f,ex 来控制 JVM 将使用哪种编码运行

-Dfile.encoding=utf-8

for（当然是 UTF-8）作为 JVM 的参数。然后，您应该在所有平台上获得可预测的结果。例子：

java -Dfile.encoding=utf-8 my.MainClass

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T10:44:46.857

通过令人困惑的命名以“标准”编码运行 JVM`-Dfile.encoding`将解决很多问题。

确保您的应用不使用`byte[] <-> String`未指定编码的转换很重要，因为有时您无法强制执行 VM 编码（例如，如果您的应用服务器被多个应用程序使用）

如果你对整个编码问题感到困惑，或者想修改你的知识，Joel Spolsky 写了[一篇很棒的文章](http://www.joelonsoftware.com/articles/Unicode.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-10-28T14:44:16.307

我必须确保 OutputStreamWriter 使用正确的编码

```
OutputStream out = ...
OutputStreamWriter writer = new OutputStreamWriter(out, "UTF-8");
template.process(model, writer); 
```

另外，如果您使用 ByteArrayOutputStream 还请确保使用正确的编码调用 toString：

```
ByteArrayOutputStream baos = new ByteArrayOutputStream();
...
baos.toString("UTF-8"); 
```

# c++ - MD5 代码覆盖率

> ID：724942
> 
> 赞同：1
> 
> 时间：2009-04-07T10:14:40.487
> 
> 标签：c++, md5, code-coverage

我目前正在实现一个基于 MD5 哈希算法的 RSA 数据安全代码，在 UpdateData 方法中有一段内容如下：

```
mCount[0] += (length << 3);

if (mCount[0] < (length << 3))
{
    mCount[1]++;
} 
```

我目前正在尝试了解 if 语句如何评估为真（ mCount[0] 值初始化为 0）。任何帮助将不胜感激。

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T10:17:18.547

如果 mCount[0] 变量溢出，就会发生这种情况。

```
unsigned int i = 4294967295;//2^32-1
unsigned int j = 1;
i += j;
assert(i < j); 
```

您提到的代码块可能会被多次调用，具体取决于要处理的数据量。所以 mCount[0] 最终会溢出。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-07T10:24:32.380

这是用于进位传播，长度*8 的总和存储在两个 32 位字中（这里，mCount 可能是一个无符号整数数组）mCount[1]:mCount[0]。

```
lo += a
if (lo < a) hi++; // true if overflow occurs: lo + a >= 2^32 
```

相当于 64 位操作：

```
(hi:lo) += (0:a) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T22:05:49.153

As Eric and Brian point out, this happens has when mCount[0] overflows, which happens every 500mb (2^29), so if you hash files/data streams larger than 500mb you will see this code trigger.

Using two 32bit counters, allows for 2^61 bytes of input before the counter truly overflows.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T10:38:24.593

只要 mCount[0] 在加法之前为负并且加法本身没有溢出，就会发生这种情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-06T06:06:31.727

我知道这在技术上不是您编程问题的答案，但老实说，我可以给您的最有价值的建议是您应该使用广泛使用且经过严格审查的 MD5（或任何其他加密）算法，不要滚动你自己。我怎么能巧妙地说出这个......如果你问的是关于整数数学的问题，这个建议是双重正确的。通往地狱的道路上到处都是那些试图自己实施棘手的加密但没有完全理解他们在做什么的人的尸体，最终在这个过程中留下了巨大的安全漏洞。聪明点，使用别人的调试实现，利用你自己的宝贵时间来实现你无法从其他地方获得的系统部分。

# ms-access - Access ADP Corrupt 无法编译

> ID：724947
> 
> 赞同：0
> 
> 时间：2009-04-07T10:15:25.710
> 
> 标签：ms-access, vba, ms-access-2007

我有一个 Access ADP 项目，该项目在过去 6 年中一直是一个连续项目，因此它有数百个表单和 thosands 行的 VBA 代码。在最近的更新之后，它不会编译来创建 ADE 文件。它告诉我其中一个文本框不存在，但确实存在。我删除了 for 并从工作备份中重新导入它，但仍然是同样的错误。我尝试将整个项目导入新的 ADP 文件，但仍然无法编译，尝试压缩和修复以及 /decompile

有没有人没有任何技巧或软件包来帮助解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-08T03:46:59.270

我不使用 ADP，但在 MDB 中，这两种用于引用表单控件的语法之间存在差异：

```
 Me.MyControl
  Me!MyControl 
```

第一个导致 Access 创建一个返回控件的隐藏属性。其结果是对控件的引用进行编译时检查。

第二种使用当前表单的默认集合，不提供编译时检查。

我假设 VBA 在 ADP 中的工作方式与在 MDB 中的工作方式相同，那么为什么不尝试将有问题的控件引用转换为 bang 而不是 dot 呢？这将消除编译时检查，并可能允许项目编译而不必费力地重建它。

如果可行，我想我会尝试删除控件（以删除隐藏的属性定义）并使用新名称添加控件然后压缩（我不知道是否可以反编译 ADP，但如果可以，它也应该被反编译）。从理论上讲，这应该永久删除有问题的隐藏属性定义，如果这是问题的原因，您应该能够恢复到点运算符并返回编译时检查。

For what it's worth, I've seen too many corruption problems with the dot operator and always use the bang in all my projects. I'm OK with not having compile-time checking of control references.

And, oh, BTW, with the bang you lose automatic Intellisense (which in some cases is a blessing as Intellisense can get in your way in some contexts), but you can invoke a different Intellisense list with CTRL-SPACE. This list is not limited to the control type, but once you start typing, you get the usual autocomplete that jumps you to the appropriate location in the list.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T13:21:49.383

有时它有助于开始一个新的空项目，然后从旧项目中导入所有表单/报告/模块。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T20:52:58.050

如果 biger 的方法不起作用，请考虑使用 SaveAsText 方法保存每个模块。然后，正如 birger 建议的那样，导入，但只导入表格和表格。然后，使用 LoadFromText 方法重新创建模块。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-06T03:26:19.753

Sometimes, I found out that I need to manual click `Debug -> Compile` before making ADE files.

This following steps may help for unable-compile ADP file:

1.  Debug -> Compile
2.  Compact/Repair
3.  then make ADE

# javascript - 阿贾克斯安全

> ID：724950
> 
> 赞同：2
> 
> 时间：2009-04-07T10:16:09.827
> 
> 标签：javascript, ajax, security

我们有一个依赖 Ajax 的繁重应用程序。确保对服务器端脚本的请求不是来自独立程序而是通过坐在浏览器上的实际用户的好方法是什么

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-07T10:21:22.547

真的没有。

通过浏览器发送的任何请求都可以被独立程序伪造。

归根结底，这真的很重要吗？如果您担心，请确保请求已通过身份验证和授权，并且您的身份验证过程良好（请记住 Ajax 发送浏览器 cookie - 因此您的“正常”身份验证可以正常工作）。请记住，当然，独立程序也可以进行身份​​验证。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-08T00:43:35.203

没有办法自动阻止“非浏览器用户”请求访问您的服务器端脚本，但有一些方法可以识别您的应用程序触发了哪些脚本，哪些没有。

这通常使用一种叫做“面包屑”的东西来完成。基本思想是发出 AJAX 请求的页面应该生成（服务器端）唯一令牌（通常是 unix 时间戳 + salt + 秘密的哈希）。此令牌和时间戳应作为参数传递给 AJAX 请求。AJAX 处理程序脚本将首先检查此令牌（以及 unix 时间戳的有效性，例如它是否在令牌时间戳的 5 分钟内）。如果令牌签出，您可以继续完成此请求。通常，这种令牌生成 + 检查可以编码为 Apache 模块，以便自动触发并与应用程序逻辑分离。

欺诈性脚本将无法生成有效令牌（除非它们找出您的算法），因此您可以放心地忽略它们。

请记住，在会话中存储令牌也是另一种方式，但这不会比您网站的身份验证系统更安全。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-07T11:13:10.767

> 确保对服务器端脚本的请求不是来自独立程序而是通过坐在浏览器上的实际用户的好方法是什么

没有办法。浏览器与独立程序没有区别；浏览器可以自动化。

您不能相信来自客户端的任何输入。如果您出于任何安全目的而依赖客户端合作，那么您注定要失败。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-07T12:18:50.813

我不确定你在担心什么。从我坐的地方，我可以看到您的问题可能与三件事有关：

首先，您可能希望防止未经授权的用户发出有效请求。这是通过使用浏览器的 cookie 存储会话 ID 来解决的。会话 ID 需要与用户绑定，每次用户完成登录过程时都会重新生成，并且必须具有不活动超时。任何没有有效会话 ID 的请求，您都会拒绝。

其次，您可能希望防止第三方对您的站点进行重放攻击（即嗅探无辜用户的流量，然后发送相同的呼叫）。简单的解决方案是为此使用 https。SSL 层将阻止某人重放流量的任何部分。这在服务器端是有代价的，所以你要确保你真的不能冒这个风险。

第三，您可能希望阻止某人使用您的 API（这就是 AJAX 最终调用的方式）在您的站点上实现他自己的客户端。为此，您无能为力。您总是可以寻找合适的 User-Agent，但这很容易伪造，并且可能是尝试使用您的 API 的人首先想到的。您始终可以实现一些统计信息，例如查看每个用户每分钟的平均 AJAX 请求，看看是否有一些用户远高于您的平均水平。它很难实现，只有当你试图阻止自动化客户端比人类反应更快时它才有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-07T10:47:34.400

Safari 是适合您的网络浏览器吗？
如果是，您在许多应用程序中使用的引擎相同，只是说那些使用 QT QWebKit 库的应用程序。所以我会说，没有办法识别它。

用户可以伪造任何想要的请求 - 伪造任何他们喜欢的像 UserAgent 这样的标题......

一个问题：你为什么要按照你的要求去做？如果他们从浏览器或其他任何地方请求，对您来说有什么不同？
想不出你在这里称之为“安全”的一个原因。

如果您仍然想这样做，无论出于何种原因，请考虑制作您自己的应用程序，并嵌入浏览器。它可以在每个请求中以某种方式对应用程序进行身份验证 - 然后您只需向应用程序的浏览器发送有效响应。
不过，用户仍然可以对应用程序进行逆向工程。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T10:21:00.563

有趣的问题。

嵌入在应用程序中的浏览器呢？你介意那些吗？

您可能会想到一种“证明”请求来自浏览器的方法，但它最终将是启发式的。浏览器和应用程序之间的界限很模糊（例如嵌入式浏览器），您总是冒着拒绝用户使用意外浏览器（或其意外版本）的风险。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-07T12:09:31.460

正如之前提到的，没有办法做到这一点......但有一点需要注意，这对于防止针对特定 AJAX 功能的 CSRF 攻击很有用；比如在 AJAX 对象的帮助下设置自定义标头，并在服务器端验证该标头。

如果在该标头的值中，您设置了一个随机（一次性使用）令牌，您可以防止自动攻击。

# cocoa - 为 Cocoa 创建基于日历的日期选择器的最佳途径？

> ID：724954
> 
> 赞同：1
> 
> 时间：2009-04-07T10:17:46.047
> 
> 标签：cocoa, webview, interface-builder

我想使用日历实现日期选择器。在我继续尝试构建一个之前，是否已经有一些东西可以做到这一点？

我已经查看了 Interface Builder 中的日期选择器，据我所知，它几乎只是一个文本字段。通过开发人员文档查看（尽管很快），似乎有很多与日期相关的功能可用，但在界面方面并不多。所以如果我真的继续建立自己的，最好的攻击线是什么

我已经用 jQuery 为我正在开发的网站构建了我需要的 HTML/CSS 和 Javascript，所以我最初的想法是我可以使用 Web 视图并显示它，假设有某种方法可以检测内部发生的事件网页视图。但这对我来说有点便宜。推荐的路线是什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-07T10:52:16.167

使用 NSDatePicker。您可以使用检查器将其更改为日历或时钟，或两者兼而有之：

[NSDatePicker 检查员 http://www.quicksnapper.com/files/4901/200934222249DB2F9FDFB94_m.png](http://www.quicksnapper.com/files/4901/200934222249DB2F9FDFB94_m.png)

这是它的样子：

[NSDatePicker 图形模式 http://www.quicksnapper.com/files/4901/128705110149DB30430BA97_m.png](http://www.quicksnapper.com/files/4901/128705110149DB30430BA97_m.png)

# datatable - 数据表交集操作

> ID：724962
> 
> 赞同：0
> 
> 时间：2009-04-07T10:21:43.637
> 
> 标签：datatable

我有两个这样定义的数据表；

将 db1、db2 调暗为新数据表

db1 和 db2 保存来自不同查询的结果，但两者中的列完全相同。我想创建另一个数据表，其中包含 db1 和 db2 中的记录。即我想要两个数据表的交集。是否有捷径可寻？

（生成的数据表将用于填充网格视图。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-11-03T09:48:51.450

你可以试试这种方式。

```
 // Declare Data Table and Data View
        DataTable dt1 = new DataTable();
        DataTable dt2 = new DataTable();
        DataTable dt3 = new DataTable();
        DataTable dtTemp = new DataTable();
        DataView dv = new DataView();

        dt1.Columns.Add("Col1");
        dt1.Columns.Add("Col2");
        dt1.Columns.Add("Col3");

        dt2.Columns.Add("Col1");
        dt2.Columns.Add("Col2");
        dt2.Columns.Add("Col3");

        // Initialize Data Table and Data View

        dt1.Rows.Add("A", "B", "C"); // Testing data for data table 1; actual data will come from your query
        dt1.Rows.Add("E", "F", "G"); //                                 ==

        dt2.Rows.Add("A", "B", "C");
        dt2.Rows.Add("U", "V", "W");// Testing data for data table 2; actual data will come from your query
        dt2.Rows.Add("X", "Y", "Z");//                                  ==

        // Merge Data Table into temporary Data Table
        dtTemp = dt1;  //Initialize dt1 value in to dtTemp
        dtTemp.Merge(dt2);// Merge it with dt2 you will get the 

        // Use Data View to get disticnt values
        dv = new DataView(dtTemp);
        dt3 = dv.ToTable(true, "Col1", "Col2", "Col3");// Remember, it is for intersection not for union 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T23:12:18.293

如果您将[VB.NET 与 LINQ](http://msdn.microsoft.com/en-us/vbasic/aa904594.aspx)一起使用，您可以这样做：

```
Dim db3 = db1.Intersect(db2) 
```

从那里只需使用 db3 来填充您的 GridView。

# c# - 在单元测试中如何传递哈希表的输入

> ID：724964
> 
> 赞同：1
> 
> 时间：2009-04-07T10:22:38.970
> 
> 标签：c#, unit-testing, nunit

```
 public DataSet ExampleMethod(int param1, string param2, Hashtable ht)
   {

    if(ht==null)
    {
        ht = new Hashtable();
    }
    ht.Add("testKey","testData");

    DataSet ds = new DataSet();
    ds.Tables.Add();
    ds.Tables[0].Columns.Add("Column1");
    ds.Tables[0].Columns.Add("Column2");
    ds.Tables[0].Columns.Add("Column3");
    return ds ;

    } 
```

现在这只是一个示例方法，因为我有一个字符串、一个 int 和一个哈希表类型作为输入，我可以为 int 和 string 传递随机值，但是我将为哈希表类型传递什么类型的值以便进行单元测试这种方法。而且我还想要这个方法的示例 Nunit Fixture 代码，以便我可以在 Nunit 框架中对其进行测试。因为我的方法返回一个数据集，我如何为它编写一个文本夹具，因为我使用 AREequals.(5,add(2,3 )) 如果它返回一个 int 。那么当一个方法返回一个 Dataset 时该怎么做

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T10:25:18.590

您可以使用虚拟数据在 TestMethod 或 TestFixture 中创建 HashTable 并传递该对象。我理解你的意思吗？

在 [SetUp] 方法中，您使用虚拟数据填充 HashTable。

```
Hashtable ht = new Hashtable();

[SetUp]
public void SetUp()
{
   ht.Add( "key1", "value1" );
   ht.Add( "key2", "value2" );
   ht.Add( "key3", "value3" );
} 
```

我可以看到你真正的问题是关于返回的数据集的断言。您仍然可以使用 Assert.AreEqual，但改为测试 DataSet 是否包含您期望给定 HashTable 的单元格数据。

```
Assert.AreEqual( ht["key1"], ds.Tables[0].Rows[0][0].ToString() );
Assert.AreEqual( ht["key1"], ds.Tables[0].Rows[0][1].ToString() ); 
```

您可以为此使用循环。

您的 TestMethod 可能看起来像这样。

```
[Test]
public void Should_Do_Stuff()
{
    MyClass myObject = new MyClass();

    DataSet ds = myObject.ExampleMethod( 1, "string", ht );

    Assert.AreEqual( ds.Tables[0].Rows.Count, ht.Count );
    Assert.AreEqual( ht["key1"], ds.Tables[0].Rows[0][0].ToString() );
    Assert.AreEqual( ht["key1"], ds.Tables[0].Rows[0][1].ToString() );
} 
```

希望回答了你的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T11:44:43.780

传递 null 或使用静态数据创建新的哈希表并将其传递给此函数。对于检查数据集，您可以断言返回的数据集计数，是否为空，如果需要，还可以设置值。

# apache - 强制重定向到 SSL 的所有页面，除了一个

> ID：724968
> 
> 赞同：1
> 
> 时间：2009-04-07T10:24:29.137
> 
> 标签：apache, mod-rewrite, ssl

我正在尝试使用 apache2 的 mod_rewrite 来强制 SSL 连接到网站。到目前为止，它与网站`<VirtualHost>`条目中的以下内容正常工作：

```
RewriteEngine On
RewriteCond %{SERVER_PORT} !^443$
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [QSA,NC,R,L] 
```

这运行良好，并且重定向了所有内容，这正是我想要的。

但是，该站点上有一个特定页面使用 Google 地图 API，该 API 不能通过 SSL 使用，因此会在浏览器中触发混合内容警告。所以，我希望这个只有地图的页面不要重定向，并使用正常的非 SSL 连接。

我不想使用 SSL 的 URL 的形式`/thing/add/{ID}/page3`是`{ID}`数值。

这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T10:32:57.243

```
RewriteEngine On

RewriteCond %{SERVER_PORT} !^443$
RewriteRule ^thing/add/\d+/page3$ - [L]

RewriteCond %{SERVER_PORT} ^443$
RewriteRule ^(thing/add/\d+/page3) $ http://%{HTTP_HOST}/$1 [QSA,NC,R,L]

RewriteCond %{SERVER_PORT} !^443$
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [QSA,NC,R,L] 
```

规则从上到下处理；如果不在 SSL 上，第一个停止地图页面的重写；如果通过 SSL 访问，第二个（可选）将这些页面重定向到非安全页面；对于其他一切，旧规则适用。

# winforms - 从不同的线程更新 UI

> ID：724972
> 
> 赞同：1
> 
> 时间：2009-04-07T10:24:38.153
> 
> 标签：winforms, multithreading, asynchronous

我知道以前有人问过这个问题，但我觉得问得不对。

我有一个密集的操作，我希望 UI 保持响应。我读过一些帖子说后台工作者是最好的方法，但是，我认为这是假设您拥有密集任务的源代码。

我有一个没有源代码的库，我可以检查进度的唯一方法是附加到被触发的事件并以这种方式获取信息。

我在 MSDN 网站上看到的示例假设有来源。

我知道如何通过附加到事件来获得进度（这是一个百分比值），但是我如何将该值返回给 UI？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T11:09:59.557

以下答案基于我的直觉，并没有实际使用第三方库进行测试。

*   像往常一样在简单的后台（不是 BackGroundWorker）线程中调用第三方库代码。
*   将库组件的事件附加到代码中的普通事件处理程序（用于更新 UI）。
*   在事件处理程序代码中应如下所示：

    ```
    private void EventHandler(object sender, DirtyEventArgs e)
    {
        if (myControl.InvokeRequired)
            myControl.Invoke(new MethodInvoker(MethodToUpdateUI), e);
        else
            MethodToUpdateUI(e);
    }

    private void MethodToUpdateUI(object obj) 
    {
        // Update UI
    } 
    ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T10:29:47.720

附加到第三方组件中的进度事件并调用[`ReportProgress`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.reportprogress.aspx). `BackgroundWorker`将您的 UI 附加到[`BackgroundWorker.ProgressChanged`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.progresschanged.aspx)事件以更新 UI。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-07T11:00:09.237

您可以通过使用第二个线程和线程安全队列来获得所需的效果。

您可以创建第二个线程来监听事件。当新事件发生时，它将事件信息推送到队列（线程安全同步）。

使用计时器 (Windows.Forms.Timer) 将每 x 次检查一次队列，以防新事件存在可以更新 UI。

因为计时器在主线程中运行，它可以安全地更新 UI，如果你让它轻量级，它就不会阻塞足够长的时间而不会被注意到。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T11:07:29.907

类似的讨论是关于[这个 Q](https://stackoverflow.com/questions/712177/how-can-i-connect-to-a-database-on-a-remote-server-in-a-background-thread/712233#712233)。如果您出于某种原因不能或不想使用 BackgroundWorker，您可以使用自己的线程并将事件从它编组回您的 UI 线程。

```
private void Initialise() {      
    MyLibClass myLibClass = new MyLibClass();
    myLibClass.SomeEvent += SomeEventHandler;
    ThreadPool.QueueUserWorkItem(myLibClass.StartLongTask);
}

private void SomeEventHandler(EventArgs e) {     
   if (this.Dispatcher.Thread != Thread.CurrentThread) { 
      this.Dispatcher.Invoke(delegate { DoStuffOnUIThread(e); });
   }
   else {        
       DoStuffOnUIThread(e);     
   }
} 
```

# c# - 控制 XML 命名空间的顺序

> ID：724976
> 
> 赞同：2
> 
> 时间：2009-04-07T10:26:09.397
> 
> 标签：c#, xml

我在让“xmlns”首先出现在根属性列表中时遇到问题。

我得到这个：

```
 <myroot 
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xsi:schemaLocation="http://www.someurl.com/ns/myroot http://www.someurl.com/xml/schemas/myschema.xsd"
        xmlns="http://www.someurl.com/ns/myroot"> 

       <sometag>somecontent</sometag>

    </myroot> 
```

我想要这个：

```
<myroot 
        xmlns="http://www.someurl.com/ns/myroot" 
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xsi:schemaLocation="http://www.someurl.com/ns/myroot http://www.someurl.com/xml/schemas/myschema.xsd">

       <sometag>somecontent</sometag>

    </myroot> 
```

我的代码如下所示：

```
 XNamespace rt = "http://www.someurl.com/ns/myroot";
        XNamespace xsi = "http://www.w3.org/2001/XMLSchema-instance";

        var submissionNode = new XElement(XmlNameSpaces.rt + "myroot");
        submissionNode.Add(new XAttribute(XNamespace.Xmlns + "xsi", "http://www.w3.org/2001/XMLSchema-instance"));
        submissionNode.Add(new XAttribute(xsi + "schemaLocation", @"http://www.someurl.com/ns/myroot http://www.someurl.com/xml/schemas/myschema.xsd");); 
```

我需要做些什么来改变订单？

编辑：我知道订单通常不是相关的，但在这种情况下它是一个要求。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T10:48:40.467

会`XmlWriter`是你的选择吗？

Afaik，它使您可以完全控制属性和命名空间声明的顺序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T10:29:02.697

IIRC，属性的顺序（在xml中）并不重要......那么为什么要改变它呢？它会导致实际问题吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-03-29T06:13:28.783

我有一个客户有这个问题。这对 s 来说是一个真正的**痛苦**，所以我写了一个解决方法来解决这个问题。

请注意，这不是一个漂亮的解决方案，不应该鼓励这样做，但可以。

```
public static class MyKludgeXmlClass
{
    public static XmlDocument CreateXmlDocumentWithOrderedNamespaces()
    {
        var xml = "<?xml version=\"1.0\" encoding=\"utf-8\"?><MyRoot xmlns=\"http://www.example.com/schemas/1.0/VRSync\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.example.com/schemas/1.0/VRSync http://xml.example.com/vrsync.xsd\"></MyRoot>";
        System.Xml.XmlDocument doc = new System.Xml.XmlDocument();
        doc.LoadXml(xml);

        return doc;
    }
} 
```

有了`XmlDocument`你可以检索根：

```
var xmlDoc = MyKludgeXmlClass.CreateXmlDocumentWithOrderedNamespaces();
XmlElement root = xmlDoc.DocumentElement; 
```

并使用您喜欢的方法附加子节点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T10:49:17.173

XML 文档中未指定属性排序，因此不应依赖。可能值得看一下[规范](http://www.w3.org/TR/REC-xml/#attdecls)

您会发现，如果您将 XML 文档读入 DOM 并将其写出，无论平台/库如何，您都不能（也不应该）依赖属性排序。这是一个常见的误解，顺便说一句！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T18:19:50.837

要求属性按指定顺序排列的软件不符合 XML 建议。

您应该问的第一个问题不是“如何以定义的顺序生成具有名称空间属性的 XML？” 相反，它应该是“该软件在哪些其他方面不符合 XML 建议？” 因为我敢与您打赌，如果接收者的过程在某一方面违反了 XML 建议，那么它至少在另一方面违反了它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-10-23T02:01:03.433

^(因为有时正确的答案是说，***不，不要那样做……***)

**根据[XML Recommendation 中的 W3C 命名空间](https://www.w3.org/TR/xml-names/)，第[3 节声明命名空间](https://www.w3.org/TR/xml-names/#dt-NSDecl)：**

> [定义：命名空间（或更准确地说，命名空间绑定）是 使用一系列保留属性声明的**。**此类属性的名称必须是**xmlns或以****xmlns:**开头。与任何其他 XML 属性一样，这些属性可以直接提供，也可以[默认](http://www.w3.org/TR/REC-xml/#dt-default)提供。]

因此，命名空间声明的[顺序，就像任何属性](https://stackoverflow.com/a/19269903/290085)的顺序一样，是*无关紧要*的。

**因此，没有符合标准的 XML 工具或库会关心命名空间声明的顺序，您也不应该关心。**

# css - 我可以在每个图像的基础上使用 CSS 禁用 Firefox 的图像缩放吗？

> ID：724983
> 
> 赞同：4
> 
> 时间：2009-04-07T10:28:46.957
> 
> 标签：css, firefox, image-scaling

在我的网页上有两种情况，我不希望 Firefox 在放大和缩小时自动缩放图像。

我可以在这些图像上专门规避此功能，并让其余图像在 Firefox 中正常缩放（如果这是用户在他/她的偏好中设置的）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-07T16:38:44.900

当用户请求缩放时，无法标记或以其他方式阻止图像被缩放。

您可以使用[window.onresize并使用](https://developer.mozilla.org/En/DOM/Window.onresize)[Detecting Page Zoom in Firefox 3 (And Others) 中](http://novemberborn.net/javascript/page-zoom-ff3)描述的技术之一来检测缩放量。知道缩放量后，您可以将该百分比调整应用于要以固定尺寸保留的图像。

整件事不过是纸牌屋。仅 JavaScript 的解决方案在页面首次加载时不会检测缩放量，因此您需要页面上的 Flash 组件来检测缩放量。此外，缩放的实际效果对用户来说是不和谐的。图像大小调整将稍微落后于用户的缩放设置，导致页面重排，可能会移动他们首先尝试放大的内容。

# jquery - jQuery追加不在 IE7 中工作，但在 Firefox 中工作我通过 AJAX 从数据库中获取数据并将标签附加到选择语句。以下代码在 Firefox 中有效，但仅在 IE 中部分有效。IE 中的问题是在下拉列表中创建选项元素，但“文本”属性值为空（下拉列表出现 30 个空白行！但是，“值”属性值设置正确（这是 hte 主键来自我的数据库）。除了“文本”之外，我还需要在 IE 中设置其他字段吗？下面代码中的粗体文本是我认为问题所在。顺便说一句，值不为空，我尝试输入一个字符串文字，它在 I

> ID：724987
> 
> 赞同：2
> 
> 时间：2009-04-07T10:29:07.767
> 
> 标签：jquery, firefox, internet-explorer-7, drop-down-menu, append

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-07T10:36:17.797

我会尝试使用 .text() 代替：

```
 $.each(data, 
       function(key,value){ 
           $("option").attr("value", key)
                .text(value)
                .appendTo("#select1"); 
        }); 
```

我想这就是你想要的？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-27T14:15:10.293

让我们用块引号再试一次：

解决方案应该是：

```
$.each(data, 
       function(key,value){ 
           $("<option>").attr("value", key)
                .text(value)
                .appendTo("#select1"); 
        }); 
```

“选项”需要用 <> 包围

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-27T14:12:49.520

我认为发布的解决方案不正确。我认为应该是：

```
 $.each(data, function(key,value){ 
           $("").attr("value", key)
                .text(value)
                .appendTo("#select1"); 
        }); 
```

不是

```
 $.each(data, function(key,value){ 
           $("option").attr("value", key)
                .text(value)
                .appendTo("#select1"); 
        }); 
```

<> 不知何故被丢弃了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-19T15:58:06.573

altCognito 是正确的......但是，如果您正在循环整数，请确保使用

key/value.toString() - 虽然 jQuery 不会抛出任何错误并会处理它，但它会避免额外的开销。

一切都与性能有关，对吗？:)

```
$.each(data,  
       function(key,value){  
           $("option").attr("value", key.toString()) 
                .text(value.toString()) 
                .appendTo("#select1");  
        }); 
```

# gridview - 网格选定行

> ID：724991
> 
> 赞同：0
> 
> 时间：2009-04-07T10:29:48.390
> 
> 标签：gridview, infragistics, ultrawebgrid

嗨，我在此使用 infragistics ultrawebgrid 如何在按钮单击事件中获取选定的行索引

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T15:25:08.120

“按钮单击事件”是 ClickCellButton 事件还是其他一些在 CellEventArgs 中传递的 Infragistic 事件？如果是这样，您可以直接从中获取它。

```
private void grid_ClickCellButton(object sender, CellEventArgs e)
{
    int rowIndex = e.Cell.Row.Index;
} 
```

如您所见，一旦您拥有单元格对象，您就可以移动到您想要的行甚至其他单元格（通过 e.Cell.Row.Cells）。

如果您使用的是在 RowEventArgs 中传递的事件，您可以执行相同的操作。

```
private void grid_AfterRowUpdate(object sender, RowEventArgs e)
{
    int rowIndex = e.Row.Index;
} 
```

# search - 大文件的高效在线搜索和替换

> ID：724998
> 
> 赞同：3
> 
> 时间：2009-04-07T10:31:04.643
> 
> 标签：search, performance, replace, inline

有一些标准工具可以做到这一点，但我需要一个简单的 GUI 来帮助一些用户（在 Windows 上）。他们将获得一个打开文件对话框并选择要处理的文件。

该文件将是一个 XML 文件。该文件将包含（在前几行中）需要删除或替换为空格的文本字符串（不管是哪个）。

问题是 XML 文件有几 GB 大，但固定的搜索和替换字符串将出现在前 4k 左右。

覆盖搜索字符串并就地保存而不需要将全部内容读入内存或过度写入磁盘的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T10:38:30.227

显然，用空格替换整个文件的大小不会改变是这里的最佳选择，否则您必须流式传输整个文件才能在磁盘上更新。

如果这是针对 Unix 环境，我会考虑使用`mmap()`将文件开头的适当部分映射到 RAM 中，然后就地编辑它并完成。

[这个片段](https://mollyrocket.com/forums/viewtopic.php?p=2529)展示了如何使用 Win32 等效的`[CreateFileMapping()](http://msdn.microsoft.com/en-us/library/aa366537.aspx)`函数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T10:36:10.013

您可以轻松编写自己的工具。如果它是在一开始，那么任何蛮力方法都可以工作。继续扫描，直到找到它。

但是，只有在不更改文件大小的情况下才能避免大量磁盘写入。如果您希望在中间某处删除或插入字节，则必须覆盖它们后面的所有内容。在您的情况下，这实际上是所有文件。所以你必须用空格替换它。只要您只是用另一个字节替换一个字节，就不会有任何开销。****