# StackOverflow 问答 000833000-000833999

# c# - 从函数返回而不破坏对象

> ID：833001
> 
> 赞同：2
> 
> 时间：2009-05-07T05:24:43.650
> 
> 标签：c#, garbage-collection

我在 C# 2.0 中有一个名为 Foo() 的函数，它返回布尔类型的值。在返回布尔值之前，我在函数中实例化了一个我没有销毁的对象。我想知道是否有必要在返回值之前销毁创建的对象？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T05:27:40.383

不，不是。如果您的 Foo 方法创建*值类型*，它们位于堆栈上，因此在堆栈展开时会被清理。如果您创建*引用类型*，您对这些实例的引用将在方法退出时超出范围，因此这些实例将用于垃圾回收。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T05:27:21.490

不。除非有问题的对象实现了 IDisposable，否则在这种情况下将其包装在 using(){} 语句中

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T05:28:22.597

在 C# 中，所有对象都是自动进行垃圾回收的，基本上没有办法显式释放对象，所以不，您不需要手动销毁对象。

如果您的对象拥有资源，您希望确保释放该资源，但您不需要（不能）销毁该对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T05:32:59.340

如果在 i/o 或 db 对象的情况下使用 dispose 方法会更好。否则，当您尝试修改之前引用但未发布的文件时，可能会发生异常。

您还可以将 null 分配给对象以删除引用。

# svn - 忽略乌龟svn中的自签名，过期的ssl证书

> ID：833002
> 
> 赞同：4
> 
> 时间：2009-05-07T05:25:16.520
> 
> 标签：svn, version-control, tortoisesvn, ssl-certificate

Tortoise SVN 不允许我访问具有自签名**和**过期 ssl 证书的 svn 存储库。

是否有某个配置告诉它我无论如何都想信任该证书？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T07:44:54.907

我在 mac 上遇到了与 SCPlugin 类似的问题 - 解决方法是使用 svn 的命令行版本，它确实会提示您永久忽略证书错误，之后 gui（共享相同的设置）将正常工作。我不能确定，但​​我怀疑同样的方法可能适用于 TortoiseSVN。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-01-15T15:09:50.047

如果 TortoiseSVN 每次都要求接受证书，尽管你点击了“永久接受”，请进入 TortoiseSVN 配置并清除认证缓存。

# javascript - 如何使用 Javascript/jquery 验证文件上传字段

> ID：833012
> 
> 赞同：21
> 
> 时间：2009-05-07T05:29:03.703
> 
> 标签：javascript, jquery

如何验证用户是否选择了要上传的文件？

编辑：撞了

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-07T08:01:32.230

检查它的`value`属性：

在 jQuery 中（因为你的标签提到了它）：

```
$('#fileInput').val() 
```

或者在原生 JavaScript 中：

```
document.getElementById('myFileInput').value 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2013-01-08T10:22:46.277

我的功能将检查用户是否选择了文件，您还可以检查是否要允许该文件扩展名。

试试这个：

```
<input type="file" name="fileUpload" onchange="validate_fileupload(this.value);">

函数验证文件上传（文件名）
{
    var allowed_extensions = new Array("jpg","png","gif");
    var file_extension = fileName.split('.').pop().toLowerCase(); // split 函数将通过 dot(.) 拆分文件名，pop 函数将从数组中弹出最后一个元素，这也会为您提供扩展名。如果没有扩展名，那么它将返回文件名。

    for(var i = 0; i <= allowed_extensions.length; i++)
    {
        if(allowed_extensions[i]==file_extension)
        {
            返回真；// 有效的文件扩展名
        }
    }

    返回假；
}

```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-07-27T10:16:59.040

基于 Ravinders 解决方案，此代码停止提交表单。在服务器端检查扩展也可能是明智的。所以你不会让黑客上传他们想要的任何东西。

```
<script>
var valid = false;

function validate_fileupload(input_element)
{
    var el = document.getElementById("feedback");
    var fileName = input_element.value;
    var allowed_extensions = new Array("jpg","png","gif");
    var file_extension = fileName.split('.').pop(); 
    for(var i = 0; i < allowed_extensions.length; i++)
    {
        if(allowed_extensions[i]==file_extension)
        {
            valid = true; // valid file extension
            el.innerHTML = "";
            return;
        }
    }
    el.innerHTML="Invalid file";
    valid = false;
}

function valid_form()
{
    return valid;
}
</script>

<div id="feedback" style="color: red;"></div>
<form method="post" action="/image" enctype="multipart/form-data">
  <input type="file" name="fileName" accept=".jpg,.png,.bmp" onchange="validate_fileupload(this);"/>
  <input id="uploadsubmit" type="submit" value="UPLOAD IMAGE" onclick="return valid_form();"/>
</form> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T05:33:38.420

至少在 Firefox 中，DOM 检查器告诉我 File 输入元素有一个名为`files`. 你应该能够检查它的长度。

```
document.getElementById('myFileInput').files.length 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-01-09T04:25:37.430

我从某个论坛得到这个。我希望它对你有用。

```
<script type="text/javascript">
 function validateFileExtension(fld) {
    if(!/(\.bmp|\.gif|\.jpg|\.jpeg)$/i.test(fld.value)) {
        alert("Invalid image file type.");      
        fld.form.reset();
        fld.focus();        
        return false;   
    }   
    return true; 
 } </script> </head>
 <body> <form ...etc...  onsubmit="return
 validateFileExtension(this.fileField)"> <p> <input type="file"
 name="fileField"  onchange="return validateFileExtension(this)">
 <input type="submit" value="Submit"> </p> </form> </body> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-07-21T09:07:54.267

简单而强大的方式（动态验证）

将格式放在数组中，如“image/*”

```
var upload=document.getElementById("upload");
var array=["video/mp4","image/png"];
upload.accept=array;
upload.addEventListener("change",()=>{

console.log(upload.value)
})
```

```
<input type="file" id="upload" >
```

# asp.net - 在 asp.net mvc 中显示对象列表

> ID：833013
> 
> 赞同：0
> 
> 时间：2009-05-07T05:29:34.683
> 
> 标签：asp.net, asp.net-mvc

我是 MVC 的新手。我正在用 asp.net MVC 开发一个 Web 应用程序。在注册用户重定向到 ProfileView.aspx 页面后，我有一个表单，用户可以通过该表单进行注册。到这里一切都很好。

现在我想在他的个人资料下显示该用户发布的文章标题。现在我正在使用以下代码：

```
public ActionResult ProfileView(int id)
{

Profile profile = profileRepository.GetProfileByID(id);

var articles = articlesRepository.FindArticlesByUserID(id).ToList();

return View("ProfileView", profile);

} 
```

感谢您提前帮助
Baljit Grewal

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T13:41:11.990

我可以想到两个选择：

使用 ViewData 字典来存储文章。

```
public ActionResult ProfileView(int id)
{

Profile profile = profileRepository.GetProfileByID(id);  
var articles = articlesRepository.FindArticlesByUserID(id).ToList();
ViewData["Articles"] = articles;
return View("ProfileView", profile);
} 
```

或者，如果您想避免使用 ViewData，请创建一个 ViewModel。ViewModel 是一种数据传输对象。您可以像这样创建 ProfileViewModel 类：

```
public class ProfileViewModel
{
     public Profile Profile{ get; set; }
     public IList<Article> Articles { get; set; }
} 
```

或者只是在视图中包含您正在使用的 Profile 属性，这将使绑定更容易，但您必须将值从模型复制到控制器中的 ViewModel。：

```
public class ProfileViewModel
{
     public int Id{ get; set; }
     public string Name { get; set; }
     .......
     public IList<Article> Articles { get; set; }
} 
```

如果您选择最后一个选项，请查看[AutoMapper](http://www.codeplex.com/AutoMapper)（对象到对象映射器）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T05:36:13.733

您将希望您的页面从 ViewPage 继承，然后您可以在 .aspx 标记中使用您的模型，例如

# javascript - execCommand SaveAs 在 Firefox 中有效吗？

> ID：833015
> 
> 赞同：7
> 
> 时间：2009-05-07T05:31:39.767
> 
> 标签：javascript, firefox, google-chrome, bookmarklet

为什么这在 ff/chrome 中不起作用？

```
javascript: document.execCommand('SaveAs','true','http://www.google.com'); 
```

（用作书签）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-12-04T04:20:05.893

在 Firefox 中可以通过[数据 URI](https://developer.mozilla.org/en-US/docs/data_URIs)（另请参阅[下载数据 url 文件](https://stackoverflow.com/questions/3916191/download-data-url-file)）和可选的下载属性来执行此操作。

有关 HTML5 shim 演示，请参阅[http://html5-demos.appspot.com/static/a.download.html](http://html5-demos.appspot.com/static/a.download.html)。

[除了更改标题之外，如何在Firefox中强制另存为对话框？](https://stackoverflow.com/questions/833068/how-to-force-save-as-dialog-box-in-firefox-besides-changing-headers)也涵盖了这个主题。

您也可以通过以下 Firefox 测试的演示对其进行测试。

```
<!DOCTYPE html>
<body>
<script>
var a = document.createElement('a');
//alert(a.download === ''); // If true, this seems to indicate support
a.setAttribute('download', 'testme.png');
a.href = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAwElEQVQ4jWNgGPRgv7Y2z0lj45STpqbHT5iaxhCt8biBgcJJU9PZJ01MPp80MfkPxZOJN8DEpAFJ4/+TJib/T5mY7CdK8wkTkwJ0zVA8naDmk0ZGPjg0/z9hbGyDV/MZY2ORkyYm77FpPmVispwSp6/e7+DAQtj5pqabsdi8myjNUANmY7H99jEjIxWiDDhuauqCxYDD+7W1eYgy4IyxMetJE5PpyH4/ZWqqTZRmGIAm3fsk2YwOjhkZqZCtmVQAAIOlmIi0XoodAAAAAElFTkSuQmCC';
a.innerHTML = 'testing';
a.style.display = 'none';
document.body.appendChild(a);
a.click();
</script> 
```

以下方法也适用于 URL 以及没有下载属性的 JavaScript 启动的加载（虽然这种方法不允许文件名，但它允许在新选项卡中预览）：

```
<script>
var myText = 'Hello world!', 
    myHTML = '<b>'+myText+'</b>';

function openFile (textToEncode, contentType, newWindow) {
    // For window.btoa (base64) polyfills, see 
    // https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-browser-Polyfills
    var encodedText = window.btoa(textToEncode);
    var dataURL = 'data:' + contentType + ';base64,' + encodedText;
    if (newWindow) { // Not useful for application/octet-stream type
        window.open(dataURL); // To open in a new tab/window
    }
    else {
        window.location = dataURL; // To change the current page
    }
}
</script>

<h1>Hello world files:</h1>

<p>Octet stream type to prompts download dialog in Firefox, but with no 
   default file type or path:</p> 

<a href="data:application/octet-stream;base64,SGVsbG8sIFdvcmxkIQ%3D%3D">
    (text example)</a>
<a href="data:application/octet-stream;base64,PGI+SGVsbG8gd29ybGQhPC9iPg==">
    (HTML example)</a>
<button onclick="openFile(myHTML, 'application/octet-stream');">
    (HTML example, from JavaScript)</button>

<p>Quickly viewable (and manually savable) in browser but no dialog presented:</p>
<a href="data:text/plain;base64,SGVsbG8sIFdvcmxkIQ%3D%3D">(plain text, same window)</a>
<a href="data:text/plain;base64,SGVsbG8sIFdvcmxkIQ%3D%3D" target="new-tab">
    (plain text--in new tab)</a>
<a href="data:text/html,%3Ch1%3EHello%2C%20World!%3C%2Fh1%3E">(HTML, same window)</a>
<button onclick="openFile(myText, 'text/plain');">
    (text example, from JavaScript)</button>
<button onclick="openFile(myText, 'text/plain', true);">
     (text example, from JavaScript; open in new window)</button>
<button onclick="openFile(myHTML, 'text/html', true);">
   (HTML example, from JavaScript; open in new window)</button> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-07T05:36:58.987

execCommand 在浏览器之间没有完全标准化。事实上， execCommand('SaveAs', ...) 似乎只在 IE 上受支持。强制另存为的推荐方法是使用 content-disposition: 附件标头，如[http://www.jtricks.com/bits/content_disposition.html中所述](http://www.jtricks.com/bits/content_disposition.html)

由于这是 HTTP 标头的一部分，因此您可以在任何文件类型上使用它。如果您使用的是 apache，则可以使用 .htaccess 文件添加标头，如此[处](http://www.askapache.com/htaccess/using-http-headers-with-htaccess.html)所述。例如：

```
<FilesMatch "\.pdf$">
<IfModule mod_headers.c>
Header set Content-Disposition "attachment"
# for older browsers
Header set Content-Type "application/octet-stream"
</IfModule>
</FilesMatch> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T05:36:28.473

正如[微软所说](http://msdn.microsoft.com/en-us/library/ms536419.aspx)，“没有适用于这种方法的公共标准。”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T05:37:47.910

Firefox 不支持 execCommand。事实上，它似乎仅限于 IE。

# asp.net - 为什么在添加新的响应标头时会出现“平台不支持的异常”？

> ID：833030
> 
> 赞同：9
> 
> 时间：2009-05-07T05:40:30.167
> 
> 标签：asp.net, asp.net-mvc, iis

为什么在添加新的响应标头时会出现“平台不支持的异常”？我正在使用 Visual Studio Web 服务器调试网站。

```
Response.Headers["X-XRDS-Location"] = url 
```

异常消息：

> 此操作需要 IIS 集成管道模式。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-07T06:26:22.380

Response.Headers.Add() 仅适用于 IIS7 集成管道模式。请改用 Response.AddHeader()。此方法适用于所有平台。

# visual-studio-2008 - 有没有办法“导出”一个 Visual Studio 2008 解决方案

> ID：833031
> 
> 赞同：1
> 
> 时间：2009-05-07T05:40:51.897
> 
> 标签：visual-studio-2008

我被要求“清理”并在 .NET 环境中重新开始，开发人员在该环境中留下了相当混乱的混乱局面。我仍然可以使用开发人员，并且他/能够在他的机器上提取解决方案，但是当我尝试在我的机器上使用它时，它会造成混乱。

我想做的是有一个“导出解决方案”，它将所有各种依赖项拉出来并将它们组合到一个反映解决方案布局的目录中。

如果无法复制文件（例如，对 GAC 中的项目的引用），是否有任何实用程序或方法可以获取有关所有内容实际位置、调试和发布配置的物理和虚拟路径的完整报告。还有后期构建任务等。对于大量不同类型的项目和各种配置屏幕，只需手动尝试记录它是可能的，但事实证明非常容易出错，即使对于一个非常坚定的人也是如此。

我尝试只解析解决方案文件，因为它只是文本，但它并不能说明整个故事。该故事的一部分还在于文件在 Visual Source Safe 中的位置，因为当我能够整合一个工作解决方案时，VSS 通过随机将文件引入其中然后引用不存在的位置来“纠正”我。这是一种享受，而 VSS 是一种病毒。

有什么建议可以从地球上唯一一台可以构建它（并且只在发布版中）的机器中提取它，以便其他人可以使用它？

一旦我把它放在我的机器上，我将对其进行重组，但没有清楚地了解它是如何“工作”的，这将是在黑暗中拍摄的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T05:55:14.153

没有导出功能。

由于您仍然可以访问旧开发人员，请查看是否可以让他重新设置解决方案。相对文件路径、链接和并非所有要签入的文件通常都是问题所在。如果你没有完整的故事，这对你来说可能是一个很大的谜。（他的文件没有签入）

我认为**要求**老开发人员交出一个可行的解决方案也是完全合理的……否则。

```
Solution.sln
   [Project1]
   [Project2] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T05:55:24.000

我不知道导出的方法，我不能保证任何 b/c 听起来很糟糕，但这就是我会做的。首先，我会要求那个人压缩他的解决方案文件夹并将其发送给您。然后，我会在我的计算机上创建相同的目录结构（所以如果他在 s:\ ... \solution\ 有解决方案，我也会这样做。如有必要，使用 subst 制作驱动器号）。然后，我会将解决方案解压缩到新目录根目录并使用 Visual Studio 打开它。现在是有趣的部分开始的地方。然后我会尝试重新绑定 VSS。

一旦我完成了所有这些，我会要求那个人告诉我我需要哪些第 3 方集会，如果有的话。（记住 GAC 不是问题，因为它是对程序集的运行时引用，而不是编译时引用。除非他做了一些疯狂的事情，比如引用物理 GAC 文件位置。呃。）然后问他正确的构建顺序是什么. 那就是不依赖其他项目的项目。

然后，您需要尝试一个一个地构建最低级别的项目并纠正构建错误。然后上一级到依赖于您刚刚编译的项目的项目，依此类推，直到您完成整个解决方案。首先要构建一个项目，然后是两个，然后是三个，直到您让它们全部解决问题。

一旦你有一个构建的解决方案，你可以清理它。然后， RUN 不要步行替换 VSS 作为您的源存储库。

总帐。:)

# javascript - JavaScript 中的“提交不是函数”错误

> ID：833032
> 
> 赞同：303
> 
> 时间：2009-05-07T05:41:20.723
> 
> 标签：javascript, html, dom, submit

谁能告诉我这段代码出了什么问题？我尝试使用 JavaScript 提交表单，但显示错误“.submit 不是函数”。有关代码的更多详细信息，请参见下文：

```
<form action="product.php" method="get" name="frmProduct" id="frmProduct" enctype="multipart/form-data">

<input onclick="submitAction()" id="submit_value" type="button" name="submit_value" value="">

</form>

<script type="text/javascript">
    function submitAction()
    {
        document.frmProduct.submit();
    }
</script> 
```

我也试过这个：

```
<script type="text/javascript">
    function submitAction()
    {
        document.forms["frmProduct"].submit();
    }
</script> 
```

两者都向我显示相同的错误:(

* * *

## 回答 #1

> 赞同：836
> 
> 时间：2009-05-07T11:46:35.713

> 提交不是函数

意味着您命名了您的提交按钮或其他一些元素`submit`。将按钮重命名为`btnSubmit`，您的通话将神奇地工作。

当您命名按钮提交时，您将覆盖`submit()`表单上的功能。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-05-07T05:44:43.993

```
<form action="product.php" method="post" name="frmProduct" id="frmProduct" enctype="multipart/form-data">

<input id="submit_value" type="button" name="submit_value" value="">

</form>

<script type="text/javascript">

document.getElementById("submit_value").onclick = submitAction;

function submitAction()
{
    document.getElementById("frmProduct").submit();
    return false;
}
</script> 
```

编辑：我不小心交换了 id

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2017-01-25T08:18:14.407

如果您没有机会更改`name="submit"`，您也可以通过以下方式提交表单：

```
function submitForm(form) {
    const submitFormFunction = Object.getPrototypeOf(form).submit;
    submitFormFunction.call(form);
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2014-05-31T09:00:26.517

确保没有其他同名的表单，并确保表单中没有`name="submit"`or `id="submit"`。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-06-18T07:40:54.710

当我使用母版页创建 MVC 应用程序时，我遇到了同样的问题。如上所述，尝试查找名称为“提交”的元素，但事实并非如此。

就我而言，它在我的页面上创建了多个标签，因此在引用正确的表单时存在一些问题。

要解决此问题，我将让按钮处理要使用的表单对象：

```
onclick="return SubmitForm(this.form)" 
```

并与js：

```
function SubmitForm(frm) {
    frm.submit();
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-05-25T17:54:35.370

这个话题已经有很多答案了，但对我来说效果最好的（也是最简单的——一行！）是对 Neil E. Pearson 从 2013 年 4 月 21 日发表的评论的修改：

> 如果你的提交按钮被#submit 卡住了，你可以通过窃取另一个表单实例的 submit() 方法来绕过它。

我对他的方法的修改，以及对我有用的方法：

`document.createElement('form').submit.call(document.getElementById(frmProduct));`

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2021-04-08T04:16:30.610

很抱歉回答晚了，但对于那些仍然面临同样错误的人。要摆脱这个错误：

```
<form method="POST">
  <input type="text"/>
  <input type="submit" id="submit-form" value="Submit Form" style="display: none;"/>
</form>

<!-- Other element that will submit the form -->
<button onclick="submitTheForm()">Submit the form</button>

<script>
function submitTheForm(){
  document.getElementById("submit-form").click();
}
</script> 
```

**解释：**

javascript 函数`submitTheForm()`正在访问提交`input`元素并在其上调用单击事件，从而导致`form`提交。

这个解决方案是终身的，几乎 100% 兼容所有浏览器。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-09-25T17:28:08.047

为表单元素命名 submit 将简单地隐藏提交属性。确保您没有名为 submit 的表单元素，并且您应该能够正常访问提交功能。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-01-24T01:46:48.843

其实解决方法很简单...

原来的：

```
 <form action="product.php" method="get" name="frmProduct" id="frmProduct"
enctype="multipart/form-data">
    <input onclick="submitAction()" id="submit_value" type="button" 
    name="submit_value" value="">
</form>
<script type="text/javascript">
    function submitAction()
    {
        document.frmProduct.submit();
    }
</script> 
```

解决方案：

```
 <form action="product.php" method="get" name="frmProduct" id="frmProduct" 
enctype="multipart/form-data">
</form>

<!-- Place the button here -->
<input onclick="submitAction()" id="submit_value" type="button" 
    name="submit_value" value="">

<script type="text/javascript">
    function submitAction()
    {
        document.frmProduct.submit();
    }
</script> 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2020-11-15T07:13:11.603

我有同样的问题并解决了我的问题，只需从提交按钮中删除 name="submit" 即可。

```
<button name='submit' value='Submit Payment' ></button> 
```

**改成**

```
<button value='Submit Payment' ></button> 
```

删除名称属性希望它会工作

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-12-06T13:06:38.233

您应该使用以下代码：

```
$(document).on("ready", function () {

        document.frmProduct.submit();
    });
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-07-16T08:54:16.057

我用的是

```
var enviar = document.getElementById("enviar");
enviar.type = "submit"; 
```

只是因为其他一切都不起作用。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-03-10T13:19:17.710

我的解决方案是设置按钮的“表单”属性

```
<form id="form_id_name"><button name="btnSubmit" form="form_id_name" /></form> 
```

或者是js：

```
YOURFORMOBJ.getElementsByTagName("button")[0].setAttribute("form", "form_id_name");
YOURFORMOBJ.submit(); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-12-21T07:12:09.690

可能的解决方案 -
1.确保您没有任何其他带有名称/id 的元素作为提交。
2.尝试调用函数为`onClick = "return submitAction();"`
3。`document.getElementById("form-name").submit();`

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-01-18T06:05:17.900

`form.submit()`如果表单没有`<button type="submit">submit</button>`. `form`元素属于`HTMLFormElement`接口，因此，我们可以直接从原型调用，该方法将始终适用于任何表单元素。

```
HTMLFormElement.prototype.submit.call(form) 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-05-07T06:37:23.447

你可以试试

```
<form action="product.php" method="get" name="frmProduct" id="frmProduct" enctype="multipart/form-data">

<input onclick="submitAction(this)" id="submit_value" type="button" name="submit_value" value="">

</form>

<script type="text/javascript">
function submitAction(element)
{
    element.form.submit();
}
</script> 
```

您没有多个同名的表格吗？

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2009-05-07T09:18:51.327

使用 getElementById：

```
document.getElementById ('frmProduct').submit () 
```

# c++ - 如何将 const char* 转换为 char*

> ID：833034
> 
> 赞同：18
> 
> 时间：2009-05-07T05:41:55.480
> 
> 标签：c++

任何人都可以告诉我如何将 const char* 转换为 char* 吗？

```
get_error_from_header(void *ptr, size_t size, size_t nmemb, void *data) {
    ErrorMsg *error = (ErrorMsg *)data;
    char* err = strstr((const char *)ptr,"550");
    //error  cannot convert const char** to char*
    if(err) {
        strncpy(error->data,(char*)ptr,LENGTH_ERROR_MESSAGE-1);
        error->data[LENGTH_ERROR_MESSAGE-1] = '\0';
        error->ret = true;
    }
    return size*nmemb;
} 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-07T06:15:20.627

这里有几件事我不明白。我看到这是为[C++/CLI](http://en.wikipedia.org/wiki/C%2B%2B/CLI)标记的，但我在下面描述的内容应该与[Standard C++](http://en.wikipedia.org/wiki/C%2B%2B)相同。

### 不编译

您提供的代码无法编译；`get_error_from_header`没有指定返回类型。在我的实验中，我做了返回类型`size_t`。

### C++ 的签名`strstr()`

`strstr()`标准 C 库中的签名为：

```
char *
strstr(const char *s1, const char *s2); 
```

[但是C++ library](http://www.cplusplus.com/reference/clibrary/cstring/strstr/)`strstr()`中的签名，取决于重载，是以下之一：

```
const char * strstr ( const char * str1, const char * str2 );
      char * strstr (       char * str1, const char * str2 ); 
```

我会选择第一个重载，因为您不想修改字符串，只想阅读它。因此，您可以将代码更改为：

```
const char* err = strstr((const char *)ptr, "550");
if (err != NULL) {
    ...
} 
```

另外，我假设您的评论报告了错误：

```
//error  cannot convert const char** to char* 
```

是一个错字：没有`const char**`可看的。

### 分配给`err`不必要的

正如在前面的回答中所指出的，如果`err`用于存储结果的`strstr`只是检查，那么使用 是不必要的`NULL`。因此你可以使用：

```
if (strstr((const char *)ptr, "550") != NULL) {
    ...
} 
```

### `reinterpret_cast<>`鼓励使用

正如在另一个答案中指出的那样，您应该使用`reinterpret_cast<>`而不是 C 风格的演员表：

```
if (strstr(reinterpret_cast<const char *>(ptr), "550") != NULL) {
    ...
} 
```

### 用于`const_cast<>`剥离`const`

鉴于问题中的示例，我看不出这在哪里是必要的，但是如果您有一个需要`const`去除 -ness 的变量，则应该使用`const_cast<>`运算符。如：

```
const char * p1;
char * p2;

p2 = const_cast<char *>(p1); 
```

正如评论中指出的那样，使用`const_cast<>`运算符的原因是为了使作者的意图明确，并且便于搜索 ; 的使用`const_cast<>`。通常剥离 const 是错误或设计缺陷的根源。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-07T05:48:34.513

您似乎没有`err`在该功能的其余部分中使用，那么为什么还要创建它呢？

```
if (NULL != strstr((const char *)ptr, "550"))
{ 
```

如果你确实需要它，你真的需要修改它指向的任何东西吗？如果不是，则将其声明为`const`：

```
const char* err = strstr((const char *)ptr, "550"); 
```

最后，由于演员表是如此讨厌的事情，最好使用特定的现代风格演员表来执行您想要执行的操作。在这种情况下：

```
if (NULL != strstr(reinterpret_cast<const char *>(ptr), "550"))
{ 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-05-07T05:45:21.073

你不能这样做：

```
char* err = strstr((char *)ptr,"550"); 
```

该错误是因为如果您将 const char* 传递给 strstr ，您会得到一个（因为过载）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-03-27T07:37:09.050

//试试这个：

```
const char* mstr="";
char* str=const_cast<char*>(mstr); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T05:50:03.887

那么 ptr （你作为 void* 传入）实际上是 const 还是不是？（换句话说，内存是否在您的控制之下？）如果不是，则在调用 strstr 时将其转换为 char* 而不是 const char*。但是，如果是这样，您将得到一个 const char* 输出（指向 ptr 指向的字符串内部的一个位置），然后需要将 strncpy 输出到您负责管理的另一个字符串。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-06-08T13:01:22.847

根据我的深入研究，我发现许多论坛没有直接解决方案或对此问题的参考答案，然后我深入研究 GCC 在线文档，简要阅读他们的编译器正确文档，这就是我可以提供的。

在 GNU C 中，指向带有限定符的数组的指针与指向其他限定类型的指针类似。例如，int ( *)[5] 类型的值可用于初始化 const int (* )[5] 类型的变量。然而，这些类型在 ISO C 中不兼容，因为 const 限定符正式附加到数组的元素类型而不是数组本身。

如果我们采用这个描述可能会更好地理解

```
extern void
transpose (int N, int M, double out[M][N], const double in[N][M]);
double x[3][2];
double y[2][3];
…
transpose(3, 2, y, x); 
```

观察上述情况是，如果你有一个

```
s1=createStudent(s1, 123, "Poli");
s2=createStudent(s2, 456, "Rola); 
```

而“Poli”和“Rola”的 const char[5] 与 char a[] 相关。这是严格不允许的，因为每个元素都附加了限定符，而不是将整个数组作为 const。

# sql-server - 使用 linq 获取表中列的第一个字符

> ID：833045
> 
> 赞同：4
> 
> 时间：2009-05-07T05:45:51.743
> 
> 标签：sql-server, linq

我正在为以下查询寻找 LINQ 等效项：

SELECT UPPER(SUBSTRING(CompanyName, 1, 1)), COUNT(*) 从 MyTable GROUP BY UPPER(SUBSTRING(CompanyName, 1, 1))

提前致谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-07T06:09:37.723

好吧，我不知道它是否会转换为适当的 SQL 查询，但你可以试试这个：

```
var query = from company in db.MyTable
            let firstChar = company.CompanyName.Substring(0, 1).ToUpper()
            group company by firstChar into grouped
            select new { FirstChar = grouped.Key, Count = grouped.Count() }; 
```

这是一个 LINQ to Objects 示例：

```
using System;
using System.Collections.Generic;
using System.Linq;

class Test
{
    static void Main()
    {
        var companies = new[] {
            new { CompanyName = "One", CompanyID=1 },
            new { CompanyName = "Two", CompanyID=2 },
            new { CompanyName = "Three", CompanyID=3 },
            new { CompanyName = "Four", CompanyID=4 },
            new { CompanyName = "Five", CompanyID=5 },
            new { CompanyName = "Six", CompanyID=6 },
        };

        var query = from company in companies
            let firstChar = company.CompanyName.Substring(0, 1).ToUpper()
            group company by firstChar into grouped
            select new { FirstChar = grouped.Key, Count = grouped.Count() };

        foreach (var entry in query)
        {
            Console.WriteLine(entry);
        }
    }
} 
```

结果：

```
{ FirstChar = O, Count = 1 }
{ FirstChar = T, Count = 2 }
{ FirstChar = F, Count = 2 }
{ FirstChar = S, Count = 1 } 
```

我是否至少正确地说这是您希望看到的？

# properties - 本地使用 Private Field x Property 的最佳实践

> ID：833047
> 
> 赞同：2
> 
> 时间：2009-05-07T05:46:56.843
> 
> 标签：properties, private, private-members

当在一个类中你有一个私有字段并在公共属性上公开该字段时，我应该在类中使用哪个字段？

下面是我试图找出的一个例子。应该操纵 Private Field _Counter 还是 Property Counter？

公开课测试

```
Private _Counter As Integer

Public Property Counter() As Integer
    Get
        Return _Counter
    End Get
    Set(ByVal value As Integer)
        _Counter = value
    End Set
End Property

Private Sub Dosomething()

    'What is the best practice?
    'Direct access to private field or property?

    'On SET
    _Counter += 1
    'OR
    Me.Counter += 1

    'On Get
    Console.WriteLine(_Counter)
    Console.WriteLine(Me.Counter)

End Sub 
```

结束类

在此先感谢您的帮助。教育

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T06:02:38.147

IMO 您应该尽可能使用**属性访问器**。这是因为您不必担心拥有 a 属性时可能可用的任何*内部逻辑。*

发生这种情况的一个很好的例子是在 Linq DataContext 后面的代码中。

看一下这个...

```
[Column(Storage="_ReviewType", DbType="TinyInt NOT NULL")]
public byte ReviewType
{
    get
    {
        return this._ReviewType;
    }
    set
    {
        if ((this._ReviewType != value))
        {
            this.OnReviewTypeChanging(value);
            this.SendPropertyChanging();
            this._ReviewType = value;
            this.SendPropertyChanged("ReviewType");
            this.OnReviewTypeChanged();
        }
    }
} 
```

注意到“setter”中的所有逻辑了吗？

这就是为什么开始练习调用属性而不是字段的做法很重要，IMO。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T04:07:34.420

谢谢大家的回答和建议。

在考虑了这里的所有建议以及其他研究之后，我的印象是，对于 Private Field 与 Assessor 的这种情况，它更多是个人选择。所以基本上最重要的是无论你选择什么都要保持一致。

那就是说；我个人的规则倾向于这个：

1.  直接访问您的私有字段。

2.  如果访问访问器使用关键字 ME。提高可读性

3.  仅当访问器实现了也适用于私有访问的重要逻辑逻辑时才使用访问器。这样你就知道如果你正在使用访问器，那是因为“它还有其他东西”

4.  避免使用受保护的字段。派生类应该始终使用访问器，而不是直接访问该字段。

让我知道你的想法。

边注：

在此之后，我认为我们缺少类级别字段的新范围。像“Restricted”这样的关键字，该字段只能从其 getter/setter 访问。这样，您始终可以直接访问私有字段，但如果您需要确保某个字段只能由其访问者访问，您可以将 Private 更改为 Restricted。（“Restricted、RestrictedRead 和 RestrictedWrite”怎么样？）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T06:25:22.740

在我看来，在内部使用公共访问器是过度封装：它模糊了代码。使用这种方法，否则简单的操作会调用可能包含更复杂逻辑的访问器，因此更难分析操作的代码。

在我的编程经验中，我很少遇到它会有很大帮助的情况。相反，我更喜欢直接访问字段，并且仅在确实需要时，通过创建*私有*访问器来抽象访问，公共访问器和其他功能都可以使用该访问器。基本原理是，如果您需要在公共访问器中附加一些特殊逻辑，则很可能逻辑可能与内部访问不同。

另请注意，大多数现代 IDE（如 Eclipse）允许立即查看对私有字段的所有引用，并重构代码以使用函数而不是直接访问。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T05:51:11.917

我更喜欢尽可能使用该物业。这使您将来可以灵活地修改属性返回/设置的内容，而无需遍历并找到所有使用私有变量的位置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T05:59:14.270

使用私有字段，因为您没有在 setter 中做特定的事情。

我还建议删除属性设置器，这样你就可以强制计数器的状态由给定的方法 DoSomething() 设置

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T06:01:04.517

根据情况，最好只允许私下直接修改类上的字段，或者通过将语义与修改相关联的某种方法。这样就更容易推理这个类和那个特定的值，因为你可以确定它只是以某种方式修改的。此外，在某些时候，诸如递增和 int 之类的操作可能会产生额外的必要后果，此时通过方法公开对它的访问更有意义。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T06:10:36.927

我*总是*使用属性访问器，因为如果我将来在 getter 或 setter 中添加逻辑，我是安全的，我确信没有代码会绕过它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-07T06:21:59.440

如果您担心直接访问字段时调用属性访问器的性能开销，请不要。大多数编译器都会内联这种东西，从而有效地为您提供相同的性能。至少，您不太可能需要通过直接前往现场获得的额外纳秒*时间*。

最好坚持使用属性访问器，因为a）您可以在所有代码中保持一致，这使得它更易于维护；b）您可以获得其他人在这里指出的好处。

此外，我通常不添加`Me.`(or `this.`) 关键字，除非存在范围问题（我通过仔细选择标识符来尝试避免）。我不会对此感到困惑，因为我的函数和子函数从来没有那么长，以至于我不确定我是在使用本地（基于堆栈的）变量还是类的成员。当它们太长而无法轻易分辨时，我会重构。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-10T11:58:36.650

原始海报完全正确。

1）直接访问您的私人领域。

*   使重构更容易。

2) 如果访问访问器使用关键字 ME。提高可读性

*   明确列出范围需要读者更少的思考

3) 仅当访问器实现了也适用于私有访问的重要逻辑逻辑时才使用访问器。这样你就知道如果你在使用访问器，那是因为“它有其他东西”</p>

*   这是违反规则 #1 的唯一原因。

4) 避免使用受保护的字段。派生类应该始终使用访问器，而不是直接访问该字段。

# vbscript - 如何让我的应用程序安装脚本绕过 Server 2008 中的用户帐户控制？

> ID：833052
> 
> 赞同：0
> 
> 时间：2009-05-07T05:48:37.790
> 
> 标签：vbscript, windows-server-2008

我已经编写了一堆 VBScripts 来在我的 Server 2003 机器上安装软件（如 SQL Server Express、WSUS 等），这一切都很好。我现在正在使它们适应新的 Server 2008 机器，它们现在不会在不显示 UAC 提示的情况下运行。

我知道这是正常行为，但有什么方法可以禁用 UAC，运行我的安装字符串，然后再次启用 UAC？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T06:13:49.243

[Technet on UAC in Server 2008](http://technet.microsoft.com/en-us/library/cc772207.aspx)，简称 secpol.msc 或 gpedit.msc；您可能希望静默提升（“无提示”是实际值，设置名称本身取决于您是以管理员还是标准用户身份运行），而不是完全禁用 UAC。禁用 UAC 会关闭许多其他功能，尤其是一些虚拟化，这可能会破坏您安装的某些程序。

# mysql - 如何在Rails中显示一组中的下一行

> ID：833056
> 
> 赞同：2
> 
> 时间：2009-05-07T05:50:15.133
> 
> 标签：mysql, ruby-on-rails, ruby

我想在我的页面上显示每 30 秒更改一次的“提示”。rails 中“find”方法的结果不是按 ID 排序的。它将按另一列排序。

获取“下一个”值的最佳方法是什么。有没有办法获取结果集中的行数，然后通过下一行 id 查找？

谢谢，

谭

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T06:12:52.710

使用 find 和 :offset => N, :limit => 1 并简单地计算 N。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T06:11:37.890

你可以打一个 ajax 调用并得到一个随机提示。就像是

```
@tip = Tip.find(:first, :order => "RAND()")
render :update do |page|
  page.replace_html :tip_container, :partial => "tip"
end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T17:25:40.907

如果您已经将所有提示提取到一个数组中，您可以使用该数组索引、@results[1].tip、@results[2].tip 等单步执行它。

# python - 无法访问作为 Windows 服务运行的 Python 服务器

> ID：833062
> 
> 赞同：2
> 
> 时间：2009-05-07T05:52:05.347
> 
> 标签：python, windows-services, tcp

我编写了一个 Python TCP/IP 服务器供内部使用，使用 win32serviceutil/py2exe 创建 Windows 服务。

我将它安装在运行 Windows XP Pro SP3 的计算机上。但是，当它作为服务运行时，我无法连接到它。我可以确认它已绑定到地址/端口，因为当我尝试使用另一个应用程序绑定到该地址/端口时会发生冲突。此外，我检查了 Windows 防火墙设置并添加了适当的例外。如果我将服务器作为一个简单的控制台应用程序运行，一切都会按预期工作。但是，当我将它作为服务运行时，它不起作用。

我依稀记得以前遇到过这个问题，但我一生都记不起任何细节。

建议，有人吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T06:12:15.300

可能程序可能会在初始化后立即终止。请检查它是否在持续监听请求。

```
netstat -an |find /i "listening" 
```

并分析解析到程序的命令行。您可以使用[procexp](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)来做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-24T16:29:36.267

首先，无论何时实现 Windows 服务，请务必添加适当的日志记录。

我的工作线程由于异常“套接字操作无法在没有阻塞的情况下完成”而终止。

`sock.setblocking(1)`解决方案是在接受连接后简单地调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T14:12:28.080

检查该服务是否在 Nertwork 服务帐户而不是本地系统帐户下运行。后者没有网络访问权限，是运行服务的默认用户。您可以通过转到开始菜单中管理工具下的服务应用程序并查找您的服务来检查这一点。如果您右键单击该服务，您可以转到属性并更改运行它的用户。

# python - C中的Python风格迭代器

> ID：833063
> 
> 赞同：6
> 
> 时间：2009-05-07T05:52:46.487
> 
> 标签：python, c, iterator, jit, algol68

python 中的“yield”语句允许从过程中进行简单的迭代，这也意味着不需要预先计算序列并将其存储在“任意”大小的数组中。

是否有类似的方法从 C 过程中迭代（使用产量）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T08:48:36.617

*以下是自我答案的社区维基副本，可以选择作为“该”答案。请直接对实际的自我回答投赞成票/反对票*

这是我找到的方法：

```
 /* Example calculates the sum of the prime factors of the first 32 Fibonacci numbers */
#include <stdio.h>

typedef enum{false=0, true=1}bool;

/* the following line is the only time I have ever required "auto" */
#define FOR(i,iterator) auto bool lambda(i); yield_init = (void *)&lambda; iterator; bool lambda(i)
#define DO {
#define     YIELD(x) if(!yield(x))return
#define     BREAK return false
#define     CONTINUE return true
#define OD CONTINUE; }
/* Warning: _Most_ FOR(,){ } loops _must_ have a CONTINUE as the last statement. 
 *  *   Otherwise the lambda will return random value from stack, and may terminate early */

typedef void iterator; /* hint at procedure purpose */
static volatile void *yield_init;
#define YIELDS(type) bool (*yield)(type) = yield_init

iterator fibonacci(int n){
   YIELDS(int);
   int i;
   int pair[2] = {0,1};
   YIELD(0); YIELD(1);
   for(i=2; i<n; i++){
      pair[i%2] = pair[0] + pair[1];
      YIELD(pair[i%2]);
   }
}

iterator factors(int n){
  YIELDS(int); 
  int i;
  for(i=2; i*i<=n; i++){
    while(n%i == 0 ){
      YIELD(i);
      n/=i;
    }
  }
  YIELD(n);
}

main(){
    FOR(int i, fibonacci(32)){
        printf("%d:", i);
        int sum = 0;
        FOR(int factor, factors(i)){
            sum += factor;
            printf(" %d",factor);
            CONTINUE;
        }
        printf(" - sum of factors: %d\n", sum);
        CONTINUE;
    }
} 
```

[从http://rosettacode.org/wiki/Prime_decomposition#ALGOL_68](http://rosettacode.org/wiki/Prime_decomposition#ALGOL_68)得到这个想法- 但它在 C 中读起来更好

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T05:55:25.417

我不时把这个 URL 作为一个笑话拿出来：[C 中的协程](http://www.chiark.greenend.org.uk/~sgtatham/coroutines.html)。

我认为您的问题的正确答案是：没有直接的等价物，并且试图伪造它可能不会那么干净或易于使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T05:55:55.183

不。

又好又短！

# .net - 独立（ASP）.net 对象缓存？

> ID：833066
> 
> 赞同：0
> 
> 时间：2009-05-07T05:54:08.633
> 
> 标签：.net, asp.net, caching

我想知道，是否存在类似[Velocity](http://msdn.microsoft.com/en-us/data/cc655792.aspx)的东西，但供内部使用？

本质上是一个 .net 对象缓存，我将安装在服务器上，它与我的应用程序（主要是 ASP.net，但也可能是 WinForms）说 WCF（或更合适的东西？）。

如果可能，对象应该是可持久的，但大部分时间都保存在内存中。在我的计划中，这些对象很少更新（新的可能会经常添加，但现有的很少更新）但经常阅读。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T06:00:46.433

好的，我想我忽略了一些东西，Velocity 似乎可以在内部托管。出于某种原因，我认为我总是必须使用 Microsoft 的数据中心，但它看起来像是有一个服务器组件。

如果其他人知道另一个缓存服务器，我将保持打开状态，总是很高兴知道替代方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-10T16:58:22.553

您可以在 IIS、WinForms 应用程序等中托管 HttpRuntime...

# sql - 使用 SQL 查询将数据插入芝麻数据库

> ID：833067
> 
> 赞同：0
> 
> 时间：2009-05-07T05:54:26.247
> 
> 标签：sql, sesame

我想知道是否可以使用 SQL 查询将普通数据添加到芝麻数据库并通过 SQL 查询检索它们..??

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-06-05T12:52:38.087

您的意思是向 Sesame 存储添加新表以便您也可以存储非 RDF 数据吗？如果您使用 Sesame 的 RDBMS 存储，那么它是可能的。但这可能不是一个好主意，因为这很容易弄乱 Sesame 的内部架构并使存储处于不一致状态。

如果你使用 Sesame 的原生商店，那是不可能的。

# javascript - 除了更改标题之外，如何在Firefox中强制另存为对话框？

> ID：833068
> 
> 赞同：6
> 
> 时间：2009-05-07T05:55:10.287
> 
> 标签：javascript, firefox, save

有没有办法强制在 ff 中为 www.example.com/example.pdf 保存为对话框？（我无法更改标题）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T06:12:23.647

如果您可以将文件以 base64 格式输出到客户端，则可以使用 data uris 进行下载。

```
location.href = 'data:application/octet-stream;base64,' + appendPDFContentHere
OR
<a href="data:application/octet-stream;base64,appendPDFContentHere">pdf</a> 
```

但是，这仅适用于非 IE 浏览器，但正如您对 firefox 的要求，这应该可以很好地工作。

编辑：

下面的两个示例都包含生成 PNG 的字节。如果单击第一个，您可以像在浏览器中一样查看图像。但是，如果您单击第二个链接，它将强制您下载图像。将其保存为 .png，您将看到它们是完全相同的图像。两个链接的唯一区别是 mime 类型

[查看图片](http://tinyurl.com/ckcv9b "展示")（[预览缩短的 url](http://preview.tinyurl.com/ckcv9b "预习")）——mime 类型：image/png

[下载图片](http://tinyurl.com/da2edb "下载图片")（[预览缩短的 url](http://preview.tinyurl.com/da2edb "预习")）——mime 类型：application/octet-stream

你问你用什么代替了*appendPDFContentHere*，答案是构成 PDF 的 base64 编码字节。我使用这个在线[base64 编码器](http://www.motobit.com/util/base64-decoder-encoder.asp "base64 编码器")对示例中使用的图像进行编码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T05:57:17.783

我能想到的唯一其他方法是修改 Firefox 设置。我假设你不能这样做。

编辑：

我根据数据 URI 的想法拼凑了一个客户端解决方案。它使用[base64 编码器的修改版本和](http://www.webtoolkit.info/javascript-base64.html)[二进制 XMLHTTPrequests](http://web.archive.org/web/20071103070418/mgran.blogspot.com/2006/08/downloading-binary-streams-with.html)技术 脚本下载 PDF 文件，然后使用 base64 编码器动态生成和放置数据 URI 链接。

当您想要八位字节流编码但无权访问服务器时（对于 OP 来说似乎就是这种情况），它应该很有用。

请注意，我刚刚发布了一个使用[Hunts.pdf](http://www.google.com/ads/hunts.pdf)[的示例](http://www.prism.gatech.edu/~mflaschen3/PDFNewWindow/PDFNewWindow.html)，OP 正在使用该示例进行测试。

```
/**
*
*  Base64 encode / decode
*  http://www.webtoolkit.info/
*
**/

var Base64 = {

    // private property
    _keyStr : "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",

    // public method for encoding
    encode : function (input) {
        var output = "";
        var chr1, chr2, chr2raw, chr3, chr3raw, enc1, enc2, enc3, enc4;
        var i = 0;

        //input = Base64._utf8_encode(input);

        while (i < input.length) {

            chr1 = input.charCodeAt(i++) & 0xFF;
            chr2 = isNaN(chr2raw = input.charCodeAt(i++)) ? NaN : (chr2raw & 0xFF);
            chr3 = isNaN(chr3raw = input.charCodeAt(i++)) ? NaN : (chr3raw & 0xFF);

            enc1 = chr1 >> 2;
            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
            enc4 = chr3 & 63;

            if (isNaN(chr2)) {
                enc3 = enc4 = 64;
            } else if (isNaN(chr3)) {
                enc4 = 64;
            }

            output = output +
            this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +
            this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);

        }

        return output;
    }
}

// http://web.archive.org/web/20071103070418/mgran.blogspot.com/2006/08/downloading-binary-streams-with.html
//fetches BINARY FILES synchronously using XMLHttpRequest

load_url = function(url) {
    var req = new XMLHttpRequest();
    req.open('GET',url,false);
    //XHR binary charset opt by Marcus Granado 2006 [http://mgran.blogspot.com]
    req.overrideMimeType('text/plain; charset=x-user-defined');
    req.send(null);

    if (req.status != 200){
    alert(req.status);
    return '';
    }
    return req.responseText;
}

    function getDataURI(filename)
    {
    var file =  load_url(filename);
    var uueFile = Base64.encode(file);
    var uri = 'data:application/octet-stream;base64,' + encodeURIComponent(uueFile);
    return uri;
    }

 window.addEventListener("load",
                      function()
                      {
                        var link = getDataURI("foo.pdf");
                        document.getElementById("myDiv").innerHTML += '<a href="' + link + '"><code>' + link +  '</code></a><br><br>';
                      } 
```

# ruby-on-rails - 运行功能测试时，如何在 Ruby on Rails 应用程序中禁用救援处理程序？

> ID：833075
> 
> 赞同：5
> 
> 时间：2009-05-07T05:56:27.583
> 
> 标签：ruby-on-rails, unit-testing, exception, rescue

我的 Ruby on Rails 应用程序中有许多控制器，在操作结束时有一个救援处理程序，它基本上捕获任何未处理的错误并返回某种“用户友好”错误。但是，当我进行 rake 测试时，我希望禁用那些默认的救援处理程序，以便我可以看到完整的错误和堆栈跟踪。有没有自动化的方法来做到这一点？

**更新**澄清：我有这样的行动：

```
def foo
  # do some stuff...
rescue
  render :text => "Exception: #{$!}" # this could be any kind of custom render
end 
```

现在，当我对此进行功能测试时，如果引发异常，那么我将获得有关异常的一些信息，但我希望它表现得好像那里没有救援处理程序一样，所以我获取完整的调试信息。

**更新：解决方案**

我这样做了：

```
 rescue:
    raise unless Rails.env.production?
    render :text => "Exception: #{$!}" # this could be any kind of custom render
  end 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-01-11T02:22:30.813

不是很自动化，但是如何修改代码以在测试中调用时重新抛出异常？

也许是这样的：

```
def foo
  # do some stuff...
rescue
  raise if ENV["RAILS_ENV"] == "test"
  render :text => "Exception: #{$!}" # this could be any kind of custom render
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T18:00:27.577

您是否查看过使用`assert_raise( exception1, exception2, ... ) { block }`调用然后从块中打印异常？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T18:59:33.770

您使用哪种方法？ActionController 中有两种救援方法。

我的基本控制器中有这个：

```
def rescue_action_in_public(exception)
    response_code = response_code_for_rescue(exception)
    status = interpret_status(response_code)
    respond_to do |format|
        format.html { render_optional_error_file response_code}
        format.js { render :update, :status => status  do |page| page.redirect_to(:url => error_page_url(status)) end}
end 
```

结尾

这仅在生产模式下显示自定义错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-21T06:49:25.177

我认为最简单的做法是验证是否调用了正确的渲染 - 或者与常规、非异常情况不同的任何内容。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-13T06:05:08.210

您不需要禁用救援块。使用 assert_raise 方法（如 Scott 所建议的那样），并在块中调用您期望异常的方法。

例如：

```
def test_throws_exception
  assert_raise Exception do
    raise_if_true(true)
  end
end 
```

# jquery - jQuery 验证

> ID：833081
> 
> 赞同：1
> 
> 时间：2009-05-07T05:59:56.360
> 
> 标签：jquery, validation

字段

密码：

开放标识：

有 OpenID：

我想使用 jQuery 验证这个表单。我希望在选中复选框的情况下，应验证密码，以防不检查 - 应验证 openid。我试过这个：

```
$().ready(
   function()
   { 
       $("#account").validate
       (
        {
            errorLabelContainer: $("ul", $('div.error-container')),
            wrapper: 'li',

            rules:
            {
                Password:
                {
                    required: true,
                    minlength: 6,
                    maxlength: 20
                },

                OpenID:
                {
                   required: true,
                   minlength: 6
                }
            },

            messages:
            {
                Password:
                {
                    required: "Enter password.",
                    minlength: "Min length is 6.",
                    maxlength: "Max length is 20."
                },

                OpenID:
                {
                   required: "Enter open id.",
                   minlength: "Min length is 6"
                }
             }
          }
       )
  } 
```

);

此代码不考虑复选框是否被选中。我知道可以应用于所需规则
的函数[http://docs.jquery.com/Plugins/Validation/Methods/required#dependency-callback ，但它适用于所需规则。](http://docs.jquery.com/Plugins/Validation/Methods/required#dependency-callback)我怎样才能设法验证表格？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T06:19:26.733

你可以添加一个方法，你的检查它的函数 jQuery.validator.addMethod

# ajax - Google 分析代码不跟踪 ajax 生成的页面

> ID：833087
> 
> 赞同：2
> 
> 时间：2009-05-07T06:02:20.707
> 
> 标签：ajax, google-analytics

在我的站点中，我们只有一个 default.aspx 页面，我们将每个 htm 页面呈现为 default.aspx。现在我们已经在每个 htm 页面中添加了谷歌分析代码，但谷歌分析报告在跟踪中只显示一个页面 default.aspx。任何人都可以帮助我们如何跟踪每个页面？

提前致谢。

问候， 萨加尔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T09:08:59.133

更准确地说，Google Analytics 跟踪代码是一个纯 JavaScript 应用程序。`_trackPageview`它通过调用跟踪器对象的函数来测量页面浏览量。由于您很可能在静态模板中嵌入了跟踪代码（这绝对是好的），因此`_trackPageview`唯一会在文档加载时调用。虽然如果您的应用程序处理 AJAX 调用，您必须注意将虚拟页面查看报告回 Analytics，正如[Deviant 已经指出的那样](https://stackoverflow.com/questions/833087/google-anlytics-code-doesnt-track-ajax-generated-page/833092#833092)。

# java - EJB 容器中的 Spring 2.5

> ID：833090
> 
> 赞同：1
> 
> 时间：2009-05-07T06:03:35.523
> 
> 标签：java, spring, dependencies, ejb-3.0, java-ee-5

我想在 EJB3 项目中使用 spring 框架。具体来说，我想使用应该从给定数据源实例化的 JDBC 模板类。当我将 spring.jar 放入我的 Jboss lib 目录时，一切正常。但是当我将 JAR 放在我的 EAR 中时，似乎只有从 JDbcTemplate 到其他库的外部依赖项。EARs/EJBs 类加载器尝试实例化 JdbcTemplate 并向我显示由于外部依赖关系他无法加载该类。它没有显示我必须放入哪些额外的 JAR。

问题：是否有人知道我必须包含哪些额外的 JAR，甚至知道如何使用外部工具搜索依赖的 JAR。我记得有一个工具可以做到这一点，但我不知道它的名字了。我想像 jarjar 之类的东西。

有人可以帮忙吗？谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T22:09:38.103

This smells like an EAR config problem not an Spring problem. Are you sure that the jar is in the EJB's classpath? You might want to check the MANIFEST.MF file of the EJB's jar to verify this.

# flash - 闪存预加载在中间失败

> ID：833095
> 
> 赞同：0
> 
> 时间：2009-05-07T06:06:41.117
> 
> 标签：flash, preloader

Flash预加载中途失败如何发现失败并重新请求

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T13:56:43.280

你有你的代码示例吗？你是如何预加载的，你要预加载什么类型的文件？我假设瑞士法郎，但你永远不知道。AS2 还是 AS3？

在 AS3 中，您可能需要侦听由您用于预加载的任何方法调度的错误事件，然后相应地处理该错误以重试。您可能需要某种类型的尝试计数器，以避免陷入尝试加载不存在的文件的循环中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T03:38:58.310

尝试使用**loadClip**方法来预加载您的影片剪辑。loadClip 具有错误处理功能，可让您诊断正在发生的事情。

文档： http://livedocs.adobe.com/flash/9.0/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file= [00001189.html](http://livedocs.adobe.com/flash/9.0/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00001189.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T14:14:04.627

**解决方案 1：**
为加载程序上的错误添加事件侦听器。要查找的错误是 IOError 和 SecuriryError。

**解决方案 2：**
在 Firefox 中安装 Tamper Data 并查看请求以尝试找出失败的原因。

# sql-server - 大 SQL 表。有没有比 ntext 更好的方法？

> ID：833099
> 
> 赞同：0
> 
> 时间：2009-05-07T06:08:59.753
> 
> 标签：sql-server

我正在尝试修复遗留系统。这是一个 SQL DB 上的 VB6 应用程序。他们有一个超过演出的数据库表。它实际上没有很多行。原因是许多 RTF 格式的文本存储在 ntext 字段中。有什么方法可以在不对应用进行大手术的情况下减小表格的大小？

非常感谢马克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T06:16:34.383

什么坏了？如果它有效，我会说离开它。否则描述问题。一场演出绝不是一个令人望而却步的桌子大小，尤其是。如果行数很少。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T06:15:47.833

您是否与 Management Studio/Enterprise manager 一起查看过该数据库的可用空间？也许它内部有很多可用空间来自较旧的已删除数据，或者日志已经变得太大并且可以被截断。

# c# - DateTime 'Z' 格式说明符在哪里？

> ID：833102
> 
> 赞同：77
> 
> 时间：2009-05-07T06:09:59.003
> 
> 标签：c#, datetime, format, utc

[**更新**：*格式说明符与格式字符串不同；格式说明符是自定义格式字符串的一部分，其中格式字符串是“库存”并且不提供自定义。我的问题是说明符不是格式*]

我一直在尝试使用使用“zzz”格式说明符的格式字符串执行往返日期时间转换，我知道它与本地时间绑定。因此，如果我尝试使用 UTC 日期时间往返，它会抛出 DateTimeInvalidLocalFormat 异常，它应该使用以下文本：

*UTC 日期时间正在转换为仅适用于当地时间的格式的文本。这可能在使用“z”格式说明符调用 DateTime.ToString 时发生，该说明符将在输出中包含本地时区偏移量。**在这种情况下，要么使用指定 UTC 时间的“Z”格式说明符，**要么使用“o”格式字符串，这是在文本中保存 DateTime 的推荐方法。当传递要由 XmlConvert 或 DataSet 序列化的 DateTime 时，也会发生这种情况。如果使用 XmlConvert.ToString，则传入 XmlDateTimeSerializationMode.RoundtripKind 以正确序列化。如果使用 DataSet，请将 DataColumn 对象上的 DateTimeMode 设置为 DataSetDateTime.Utc。*

根据这个建议，我需要做的就是让我的代码工作是用 'ZZZ' 替换 'zzz' 这样我就可以采用 UTC 格式。问题是，在文档中的任何地方都找不到“Z”，我尝试的任何“Z”格式组合，即“Z”、“ZZ”、“ZZZ”，总是只是将 DateTime 实例转换为那些 Z 被视为文字.

是否有人忘记在没有告诉异常消息作者的情况下实现“Z”，或者我错过了如何在没有黑客攻击的情况下用“+0000”替换有效的本地时间偏移？

**代码示例：**

```
// This is the format with 'zzzzz' representing local time offset
const string format = "ddd MMM dd HH:mm:ss zzzzz yyyy";

// create a UTC time
const string expected = "Fri Dec 19 17:24:18 +0000 2008";
var time = new DateTime(2008, 12, 19, 17, 24, 18, 0, DateTimeKind.Utc);

// If you're using a debugger this will rightfully throw an exception
// with .NET 3.5 SP1 because 'z' is for local time only; however, the exception
// asks me to use the 'Z' specifier for UTC times, but it doesn't exist, so it
// just spits out 'Z' as a literal.
var actual = time.ToString(format, CultureInfo.InvariantCulture);

Assert.AreEqual(expected, actual); 
```

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-05-07T06:23:17.160

也许“K”格式说明符会有一些用处。这是唯一一个似乎提到使用大写“Z”的地方。

“Z”是 DateTimes 的一种独特情况。文字“Z”实际上是 UTC 时间的 ISO 8601 日期时间标准的一部分。当“Z”（祖鲁语）被添加到时间的末尾时，它表示那个时间是 UTC，所以实际上字面的 Z 是时间的一部分。这可能会给 .NET 中的日期格式库带来一些问题，因为它实际上是文字，而不是格式说明符。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-06-29T10:39:58.867

当您使用 DateTime 时，您可以在变量中存储日期和时间。

日期可以是本地时间或 UTC 时间，这取决于您。

例如，我在意大利（+2 UTC）

```
var dt1 = new DateTime(2011, 6, 27, 12, 0, 0); // store 2011-06-27 12:00:00
var dt2 = dt1.ToUniversalTime()  // store 2011-06-27 10:00:00 
```

那么，当我打印包含时区的 dt1 和 dt2 时会发生什么？

```
dt1.ToString("MM/dd/yyyy hh:mm:ss z") 
// Compiler alert...
// Output: 06/27/2011 12:00:00 +2

dt2.ToString("MM/dd/yyyy hh:mm:ss z") 
// Compiler alert...
// Output: 06/27/2011 10:00:00 +2 
```

dt1 和 dt2 仅包含日期和时间信息。dt1 和 dt2 不包含时区偏移量。

**那么如果“+2”不包含在 dt1 和 dt2 变量中，那么它是从哪里来的呢？**

它来自您的机器时钟设置。

编译器告诉您，当您使用 'zzz' 格式时，您正在编写一个组合“DATE + TIME”（存储在 dt1 和 dt2 中）+ **“TIMEZONE OFFSET”（不包含在 dt1 和 dt2 中的字符串，因为它们是 DateTyme 类型）**，它将使用正在执行代码的服务器计算机的偏移量。

编译器告诉您“警告：代码的输出取决于机器时钟偏移”

如果我在位于伦敦（+1 UTC）的服务器上运行此代码，结果将完全不同：而不是“ **+2** ”，它将写成“ **+1** ”

```
...
dt1.ToString("MM/dd/yyyy hh:mm:ss z") 
// Output: 06/27/2011 12:00:00 +1

dt2.ToString("MM/dd/yyyy hh:mm:ss z") 
// Output: 06/27/2011 10:00:00 +1 
```

正确的解决方案是使用 DateTimeOffset 数据类型代替 DateTime。从 2008 版本开始在 sql Server 中可用，从 3.5 版本开始在 .Net 框架中可用

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-03-13T02:35:26.677

我正在处理，`DateTimeOffset`不幸的是“o”打印出“+0000”而不是“Z”。

所以我最终得到：

```
dateTimeOffset.UtcDateTime.ToString("o") 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-07T06:41:09.893

通过字符串往返日期一直很痛苦......但是文档表明'o'说明符是用于捕获UTC状态的往返的说明符。解析时，如果原始结果是 UTC，则结果通常具有 Kind == Utc。我发现最好的办法总是在序列化之前将日期标准化为 UTC 或本地，然后指示解析器选择哪种标准化。

```
DateTime now = DateTime.Now;
DateTime utcNow = now.ToUniversalTime();

string nowStr = now.ToString( "o" );
string utcNowStr = utcNow.ToString( "o" );

now = DateTime.Parse( nowStr );
utcNow = DateTime.Parse( nowStr, null, DateTimeStyles.AdjustToUniversal );

Debug.Assert( now == utcNow ); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-07T06:14:08.417

[MSDN 上的此页面](http://msdn.microsoft.com/en-us/library/az4se3k1.aspx)列出了标准的 DateTime 格式字符串，不包括使用“Z”的字符串。

更新：您需要确保日期字符串的其余部分也遵循正确的模式（您没有提供发送内容的示例，因此很难说您是否这样做）。要使 UTC 格式正常工作，它应该如下所示：

```
// yyyy'-'MM'-'dd HH':'mm':'ss'Z'
DateTime utcTime = DateTime.Parse("2009-05-07 08:17:25Z"); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-07T06:17:36.287

```
Label1.Text = dt.ToString("dd MMM yyyy | hh:mm | ff | zzz | zz | z"); 
```

将输出：

```
07 Mai 2009 | 08:16 | 13 | +02:00 | +02 | +2 
```

我在丹麦，我与 GMT 的偏移量是 +2 小时，女巫是正确的。

如果您需要获取**CLIENT Offset**，我建议您检查我所做的一个[小技巧。](http://www.balexandre.com/GetTimeZone.aspx)该页面位于英国的服务器中，GMT 为 +00:00，如您所见，您将获得当地的 GMT 偏移量。

* * *

关于你的评论，我做了：

```
DateTime dt1 = DateTime.Now;
DateTime dt2 = dt1.ToUniversalTime();

Label1.Text = dt1.ToString("dd MMM yyyy | hh:mm | ff | zzz | zz | z");
Label2.Text = dt2.ToString("dd MMM yyyy | hh:mm | FF | ZZZ | ZZ | Z"); 
```

我明白了：

```
07 Mai 2009 | 08:24 | 14 | +02:00 | +02 | +2
07 Mai 2009 | 06:24 | 14 | ZZZ | ZZ | Z 
```

我没有例外，只是......它对大写 Z 没有任何作用 :(

对不起，我错过了什么吗？

* * *

仔细阅读有关[自定义日期和时间格式字符串的 MSDN](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx)

不支持大写“Z”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-07-01T22:31:48.533

如果您需要强制`+00:00`而不是`Z`指示UTC，这将得到您需要的东西：

```
string timeStamp = DateTime.UtcNow.ToString("yyyy-MM-dd'T'HH:mm:ss.ffffff'+00:00'"); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-03-04T15:20:31.493

看起来 +00.00 发生在 DateTimeKind 不是 UTC 时。指定它使“o”正常工作：

```
DateTime.SpecifyKind(new DateTime(2011, 6, 27, 12, 0, 0), DateTimeKind.Utc).ToString("o"); 
```

这将返回 Z 时间

# c# - 如何使用 System.Threading 模拟下载速度

> ID：833106
> 
> 赞同：1
> 
> 时间：2009-05-07T06:12:16.440
> 
> 标签：c#, .net, asp.net

我可以使用 System.Threading 来模拟用户连接速度还是有更好的方法或工具。

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T06:27:12.690

[Fiddler2](http://www.fiddler2.com/fiddler2/)是一个 HTTP 代理，允许您模拟调制解调器速度。（我不知道 TCP 的节流工具，更不用说 UDP）

编辑评论：

它在启动时将自己设置为 WinInet（系统）代理，甚至捕获 localhost 请求（如果出现问题，[请参阅此内容）；](http://www.fiddler2.com/Fiddler/help/hookup.asp#Q-LocalTraffic)此外，它还可以将请求重新路由到不同的主机（即对 example.com 的请求变成对 localhost 的请求）。

此外，它具有强大的脚本引擎，可让您制定自定义处理规则。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T06:19:16.250

[http://www.ozspeedtest.com/](http://www.ozspeedtest.com/)提供了一个比 speedtest.net 更简单的速度测试系统，所以从 C# 运行测试应该很容易（它只涉及下载特定大小的图像）。

我假设你正在做一些客户端的事情。

# objective-c - Objective-C 中有两个星号 ** 是什么意思？

> ID：833112
> 
> 赞同：15
> 
> 时间：2009-05-07T06:14:28.850
> 
> 标签：objective-c, pointers

我知道有一个星号 * 是一个指针，有两个 ** 是什么意思？

我从文档中偶然发现了这一点：

```
- (NSAppleEventDescriptor *)executeAndReturnError:(NSDictionary **)errorInfo 
```

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-05-07T06:17:50.433

它是一个指向指针的指针，就像在 C 中一样（尽管它有奇怪的方括号语法，但 Objective-C 是基于它的）：

```
char c;
char *pc = &c;
char **ppc = &pc;
char ***pppc = &ppc; 
```

依此类推，无限循环（或者直到你用完可变空间）。

它通常用于将指针传递给必须能够更改指针本身的函数（例如为可变大小的对象重新分配内存）。

=====

根据您对演示如何使用它的示例的请求，这是我为另一篇文章编写的一些代码来说明它。它是一个`appendStr()`管理自己分配的功能（您仍然必须释放最终版本）。最初，您将字符串 ( `char *`) 设置为 NULL，函数本身将根据需要分配空间。

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void appendToStr (int *sz, char **str, char *app) {
    char *newstr;
    int reqsz;

    /* If no string yet, create it with a bit of space. */

    if (*str == NULL) {
        *sz = strlen (app) + 10;
        if ((*str = malloc (*sz)) == NULL) {
            *sz = 0;
            return;
        }
        strcpy (*str, app);
        return;
    } 
```

```
 /* If not enough room in string, expand it. We could use realloc
       but I've kept it as malloc/cpy/free to ensure the address
       changes (for the program output). */

    reqsz = strlen (*str) + strlen (app) + 1;
    if (reqsz > *sz) {
        *sz = reqsz + 10;
        if ((newstr = malloc (*sz)) == NULL) {
            free (*str);
            *str = NULL;
            *sz = 0;
            return;
        }
        strcpy (newstr, *str);
        free (*str);
        *str = newstr;
    }

    /* Append the desired string to the (now) long-enough buffer. */

    strcat (*str, app);
} 
```

```
static void dump(int sz, char *x) {
    if (x == NULL)
        printf ("%8p   [%2d]   %3d   [%s]\n", x, sz, 0, "");
    else
        printf ("%8p   [%2d]   %3d   [%s]\n", x, sz, strlen (x), x);
}

static char *arr[] = {"Hello.", " My", " name", " is", " Pax",
                      " and"," I", " am", " old."};

int main (void) {
    int i;
    char *x = NULL;
    int sz = 0;

    printf (" Pointer   Size   Len   Value\n");
    printf (" -------   ----   ---   -----\n");
    dump (sz, x);
    for (i = 0; i < sizeof (arr) / sizeof (arr[0]); i++) {
        appendToStr (&sz, &x, arr[i]);
        dump (sz, x);
    }
} 
```

代码输出以下内容。您可以看到当当前分配的内存用完扩展字符串的空间时指针如何变化（在注释中）：

```
 Pointer   Size   Len   Value
 -------   ----   ---   -----
# NULL pointer here since we've not yet put anything in.
     0x0   [ 0]     0   []

# The first time we put in something, we allocate space (+10 chars).
0x6701b8   [16]     6   [Hello.]
0x6701b8   [16]     9   [Hello. My]
0x6701b8   [16]    14   [Hello. My name]

# Adding " is" takes length to 17 so we need more space.
0x6701d0   [28]    17   [Hello. My name is]
0x6701d0   [28]    21   [Hello. My name is Pax]
0x6701d0   [28]    25   [Hello. My name is Pax and]
0x6701d0   [28]    27   [Hello. My name is Pax and I]

# Ditto for adding " am".
0x6701f0   [41]    30   [Hello. My name is Pax and I am]
0x6701f0   [41]    35   [Hello. My name is Pax and I am old.] 
```

在这种情况下，您传入，`**str`因为您需要能够更改该`*str`值。

=====

或者以下，它对不在数组中的字符串进行展开的冒泡排序（哦，真可惜！）。它通过直接交换字符串的地址来做到这一点。

```
#include <stdio.h>

static void sort (char **s1, char **s2, char **s3, char **s4, char **s5) {
    char *t;

    if (strcmp (*s1, *s2) > 0) { t = *s1; *s1 = *s2; *s2 = t; }
    if (strcmp (*s2, *s3) > 0) { t = *s2; *s2 = *s3; *s3 = t; }
    if (strcmp (*s3, *s4) > 0) { t = *s3; *s3 = *s4; *s4 = t; }
    if (strcmp (*s4, *s5) > 0) { t = *s4; *s4 = *s5; *s5 = t; }

    if (strcmp (*s1, *s2) > 0) { t = *s1; *s1 = *s2; *s2 = t; }
    if (strcmp (*s2, *s3) > 0) { t = *s2; *s2 = *s3; *s3 = t; }
    if (strcmp (*s3, *s4) > 0) { t = *s3; *s3 = *s4; *s4 = t; }

    if (strcmp (*s1, *s2) > 0) { t = *s1; *s1 = *s2; *s2 = t; }
    if (strcmp (*s2, *s3) > 0) { t = *s2; *s2 = *s3; *s3 = t; }

    if (strcmp (*s1, *s2) > 0) { t = *s1; *s1 = *s2; *s2 = t; }
}

int main (int argCount, char *argVar[]) {
    char *a = "77";
    char *b = "55";
    char *c = "99";
    char *d = "88";
    char *e = "66";

    printf ("Unsorted: [%s] [%s] [%s] [%s] [%s]\n", a, b, c, d, e);
    sort (&a,&b,&c,&d,&e);
    printf ("  Sorted: [%s] [%s] [%s] [%s] [%s]\n", a, b, c, d, e);
    return 0;
} 
```

产生：

```
Unsorted: [77] [55] [99] [88] [66]
  Sorted: [55] [66] [77] [88] [99] 
```

不要介意 sort 的实现，只需注意传递变量`char **`以便它们可以轻松交换。任何真正的排序都可能作用于真正的数据数组而不是单个变量，但这不是示例的重点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-04-14T16:58:25.653

**指针指向指针**

“指针”的定义说它是一个特殊的变量，它存储另一个变量的*地址*（不是值）。那个其他变量很可能是一个指针。这意味着一个指针指向另一个指针是完全合法的。

假设我们有一个指针指向`p1`另一个指向`p2`字符的指针`c`。在内存中，这三个变量可以可视化为：

[![在此处输入图像描述](https://i.stack.imgur.com/xCrUl.png)](https://i.stack.imgur.com/xCrUl.png)

所以我们可以看到，在内存中，指针`p1`保存着指针的地址`p2`。指针`p2`保存字符的地址`c`。

`p2`指向字符的指针也是如此`c`，而`p1`指向的指针也是如此`p2`。或者我们也可以说`p2`是一个指向字符的指针`c`。

现在，在代码`p2`中可以声明为：

> 字符 *p2 = &c;

但是`p1`被声明为：

> 字符 **p1 = &p2;

所以我们看到这`p1`是一个双指针（即指向一个字符的指针），因此声明中的两个 *s。

现在，

*   `p1`是`p2`ie 5000的地址
*   `*p1`是`p2`ie 8000持有的值
*   `**p1`是 8000 的值，即`c` 我认为这应该非常清楚这个概念，让我们举一个小例子：

资料来源：[http ://www.thegeekstuff.com/2012/01/advanced-c-pointers/](http://www.thegeekstuff.com/2012/01/advanced-c-pointers/)

**对于它的一些用例：**

这通常用于将指针传递给必须能够更改指针本身的函数，它的一些用例是：

*   例如处理错误，它允许接收方法控制指针引用的内容。看到[这个](https://stackoverflow.com/questions/4765519/why-passing-error-instead-of-error-in-cocoa-programming)问题
*   用于创建不透明的结构，即其他人将无法分配空间。看到[这个](https://stackoverflow.com/questions/36610518/why-is-that-for-sqlite3-open-we-use-double-pointer-and-for-sqlite3-prepare-we/36610786?noredirect=1#comment60819087_36610786)问题
*   如果此问题的其他答案中提到了内存扩展。

[在我学习的过程中，请随时编辑/改进这个答案：]]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T06:16:02.310

指向指针的指针。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T07:49:12.477

在 C 中，指针和数组可以被同等对待，例如 char* 是一个字符串（字符数组）。如果您想将数组数组（例如许多字符串）传递给函数，您可以使用 char**。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-10-29T03:08:29.250

（参考：更多iOS 6开发）

> 在 Objective-C 方法中，参数（包括对象指针）是按值传递的，这意味着被调用的方法会获得自己传入的指针的副本。因此，如果被调用的方法想要更改指针，而不是指针指向的数据，您需要另一个级别的间接。于是，指针指向了指针。

# windows - 有没有办法在 Windows 上使用 Qt 列出当前进程？

> ID：833113
> 
> 赞同：3
> 
> 时间：2009-05-07T06:15:14.607
> 
> 标签：windows, qt, qt4

是否可以知道使用 Qt 4 正在运行哪些进程？我正在寻找一种方法来等到用户关闭应用程序才能进行操作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T07:57:45.700

我也不知道 Qt 解决方案。`CreateToolhelp32Snapshot()`但是使用,`Process32FirstW()`和`Process32NextW()`函数做到这一点并不难。只需搜索 MSDN 即可。还有一个（IMO太复杂）的例子

[拍摄快照并查看流程](http://msdn.microsoft.com/en-us/library/ms686701(VS.85).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T07:02:33.493

不是真正的 Qt4 解决方案，但您可以在[QProcess中启动](http://doc.trolltech.com/4.5/qprocess.html)[WMIC](http://technet.microsoft.com/en-us/library/bb742610.aspx)并评估结果。

就像是 ：

```
wmic process get name /every:5 
```

# xml - 在 XSLT 中，如何从不同的范围增加全局变量？

> ID：833118
> 
> 赞同：27
> 
> 时间：2009-05-07T06:15:51.220
> 
> 标签：xml, xslt, global-variables

我正在处理一个 XML 文件，我想在其中计算节点数，以便在编写新节点时可以将其用作 ID。

目前我有一个名为“counter”的全局变量。我可以在模板中访问它，但我还没有找到在模板中操作它的方法。

这是我的 XSLT 文件的精简版本：

```
<xsl:variable name="counter" select="1" as="xs:integer"/>

<xsl:template match="/"> 
   <xsl:for-each select="section">
      <xsl:call-template name="section"></xsl:call-template>
   </xsl:for-each>
</xsl:template>

<xsl:template name="section">

   <!-- Increment 'counter' here -->

   <span class="title" id="title-{$counter}"><xsl:value-of select="title"/></span>
</xsl:template> 
```

任何建议如何从这里开始？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-05-13T08:59:37.300

其他人已经解释了变量是如何不可变的——XSLT 中没有赋值语句（与一般的纯函数式编程语言一样）。

对于迄今为止提出的解决方案，我有一个替代方案。它避免了参数传递（这在 XSLT 中既冗长又丑陋——即使我承认这一点）。

在 XPath 中，您可以简单地计算`<section>`当前元素之前的元素数量：

```
<xsl:template name="section">
  <span class="title" id="title-{1 + count(preceding-sibling::section)}">
    <xsl:value-of select="title"/>
  </span>
</xsl:template> 
```

（注意：空白代码格式不会出现在您的结果中，因为只有空白的文本节点会自动从样式表中删除。所以不要觉得有必要将指令放在同一行。）

这种方法的一大优势（相对于 using `position()`）是它只依赖于当前节点，而不依赖于当前节点列表。如果您以某种方式更改了处理方式（例如，`<xsl:for-each>`不仅处理了部分，还处理了其他一些元素），那么 的值`position()`将不再必然对应`<section>`于文档中元素的位置。另一方面，如果`count()`像上面那样使用，那么它将始终对应于每个`<section>`元素的位置。这种方法减少了与代码其他部分的耦合，这通常是一件好事。

count() 的替代方法是使用该`<xsl:number>`指令。它的默认行为将为同一级别的所有同名元素编号，这恰好是您想要的：

```
<xsl:template name="section">
  <xsl:variable name="count">
    <xsl:number/>
  </xsl:variable>
  <span class="title" id="title-{$count}">
    <xsl:value-of select="title"/>
  </span>
</xsl:template> 
```

这是冗长的权衡（如果您仍想使用属性值模板花括号，则需要额外的变量声明），但只是稍微如此，因为它还大大简化了您的 XPath 表达式。

还有更多的改进空间。虽然我们已经移除了对当前节点列表的依赖，但我们仍然依赖于当前节点。这本身并不是一件坏事，但是通过查看模板并不能立即清楚当前节点是什么。我们只知道模板名为“ `section`”；要确定正在处理什么，我们必须查看代码中的其他地方。但即使这样也不一定是这样。

如果您曾经感到被引导使用`<xsl:for-each>`and`<xsl:call-template>`一起（如您的示例中所示），请退后一步，弄清楚如何使用`<xsl:apply-templates>`。

```
<xsl:template match="/doc">
  <xsl:apply-templates select="section"/>
</xsl:template>

<xsl:template match="section">
  <xsl:variable name="count">
    <xsl:number/>
  </xsl:variable>
  <span class="title" id="title-{$count}">
    <xsl:value-of select="title"/>
  </span>
</xsl:template> 
```

这种方法不仅不那么冗长（`<xsl:apply-templates/>`同时替换了`<xsl:for-each>`and `<xsl:call-template/>`），而且还可以立即清楚当前节点是什么。您所要做的就是查看`match`属性，并且您会立即知道您正在处理一个`<section>`元素并且`<section>`您正在计算元素。

有关模板规则（即`<xsl:template>`具有`match`属性的元素）如何工作的简要说明，请参阅[“XSLT 工作原理”](http://lenzconsulting.com/how-xslt-works/)。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-07T06:25:25.800

XSLT 变量不能更改。您将在模板之间传递值。

如果您使用的是 XSLT 2.0，您可以使用参数并使用隧道将变量传播到正确的模板。

您的模板将如下所示：

```
<xsl:template match="a">
<xsl:param name="count" select="0">
  <xsl:apply-templates>
     <xsl:with-param select="$count+1"/>
  </xsl:apply-templates>
</xsl:template> 
```

如果要创建 id，还请查看使用 generate-id()。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-07T10:42:44.540

XSLT 中的变量是不可变的，因此您必须考虑到这一点来解决问题。您可以`position()`直接使用：

```
<xsl:template match="/"> 
   <xsl:for-each select="section">
      <xsl:call-template name="section"/>
   </xsl:for-each>
</xsl:template>

<xsl:template name="section">
   <span class="title" id="title-{position()}"><xsl:value-of select="title"/></span>
</xsl:template> 
```

或者以更面向模板的方式：

```
<xsl:template match="/"> 
   <xsl:apply-templates select="section"/>
</xsl:template>

<xsl:template match="section">
   <span class="title" id="title-{position()}"><xsl:value-of select="title"/></span>
</xsl:template> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T06:20:30.037

变量是局部作用域的，并且在 xslt 中是只读的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-07T06:30:09.983

根据您的 XSLT 处理器，您可以将脚本函数引入 XLST。例如，Microsoft XML 库支持包含 javascript。有关示例，请参见[http://msdn.microsoft.com/en-us/library/aa970889(VS.85).aspx 。](http://msdn.microsoft.com/en-us/library/aa970889(VS.85).aspx)如果您计划在公共客户端浏览器上部署/执行 XSLT，这种策略显然不会奏效；它必须由特定的 XSLT 处理器来完成。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-07T06:37:29.467

你可以使用 position() 函数来做你想做的事。它看起来像这样。

```
<xsl:template match="/">
  <xsl:for-each select="section">
    <xsl:call-template name="section">
      <xsl:with-param name="counter" select="{position()}"/>
    </xsl:call-template>
  </xsl:for-each>
</xsl:template>

<xsl:template name="section">
  <xsl:param name="counter"/>
  <span class="title" id="title-{$counter}">
    <xsl:value-of select="title"/>
  </span>
</xsl:template> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T06:29:40.610

我自己还没有尝试过，但是您可以尝试将参数传递给模板。在您的第一个模板中，您在 for-each 语句中将参数设置为 count()（或者可能是 current()？），然后将该值传递给您的“部分”模板。

这里有更多关于[将参数传递给模板](http://www.stylusstudio.com/w3c/xslt/N118CD.htm)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-21T23:52:02.013

使用`<xsl:variable name="RowNum" select="count(./preceding-sibling::*)" />` 和***$RowNum***作为递增值。

例如：`<xsl:template name="ME-homeTiles" match="Row[@Style='ME-homeTiles']" mode="itemstyle"> <xsl:variable name="RowNum" select="count(./preceding-sibling::*)" /> ...<a href="{$SafeLinkUrl}" class="tile{$RowNum}"><img ....></a>`

这将为具有 tile1、tile2、tile3 等值的链接创建类...

# gcc - 64 位整数的 cmpxchg 示例

> ID：833122
> 
> 赞同：5
> 
> 时间：2009-05-07T06:16:53.353
> 
> 标签：gcc, assembly, x86-64, inline-assembly

我在 i686 架构中使用 cmpxchg（比较和交换）进行 32 位比较和交换，如下所示。

（编者注：最初的 32 位示例有问题，但问题不在于它。我相信这个版本是安全的，并且作为奖励，它也可以为 x86-64 正确编译。 **另请注意，内联 asm 不是为此需要或推荐；或在 i486 和 x86-64 上或上[`__atomic_compare_exchange_n`](https://gcc.gnu.org/onlinedocs/gcc/_005f_005fatomic-Builtins.html)的较旧`__sync_bool_compare_and_swap`工作`int32_t``int64_t`**。但这个问题是关于使用内联汇编来完成的，以防万一。）

```
// note that this function doesn't return the updated oldVal
static int CAS(int *ptr, int oldVal, int newVal)
{
    unsigned char ret;
    __asm__ __volatile__ (
            "  lock\n"
            "  cmpxchgl %[newval], %[mem]\n"
            "  sete %0\n"
            : "=q" (ret), [mem] "+m" (*ptr), "+a" (oldVal)
            : [newval]"r" (newVal)
            : "memory");    // barrier for compiler reordering around this

    return ret;   // ZF result, 1 on success else 0
} 
```

* * *

**64 位比较和交换的 x86_64 架构的等效项是什么**

```
static int CAS(long *ptr, long oldVal, long newVal)
{
    unsigned char ret;
    // ?
    return ret;
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T06:23:47.643

该`x86_64`指令集具有用于 8 字节（64 位）比较和交换的[`cmpxchgq`](http://www.felixcloutier.com/x86/CMPXCHG.html)( for quadword) 指令。`q`

还有一条`cmpxchg8b`指令适用于 8 字节数量，但设置起来更复杂，需要您使用`edx:eax`，`ecx:ebx`而不是更自然的 64 位`rax`。几乎可以肯定，这种情况存在的原因与英特尔在很久以前`x86_64`就需要 64 位比较和交换操作这一事实有关。它仍然存在于 64 位模式中，但不再是唯一的选择。

但是，如前所述，`cmpxchgq`对于 64 位代码来说，这可能是更好的选择。

* * *

如果您需要 cmpxchg 一个 16 字节的对象，则 64 位版本`cmpxchg8b`是[`cmpxchg16b`](http://www.felixcloutier.com/x86/CMPXCHG8B:CMPXCHG16B.html). 最早的 AMD64 CPU 缺少它，因此编译器不会为 16B 对象上的[std::atomic::compare_exchange](http://en.cppreference.com/w/cpp/atomic/atomic/compare_exchange)生成它，除非您启用`-mcx16`（对于 gcc）。不过，汇编器会对其进行汇编，但请注意，您的二进制文件不会在最早的 K8 CPU 上运行。（这仅适用于`cmpxchg16b`，不适用于`cmpxchg8b`64 位模式或`cmpxchgq`）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T06:25:01.633

cmpxchg8b

```
__forceinline int64_t interlockedCompareExchange(volatile int64_t & v,int64_t exValue,int64_t cmpValue)
{
  __asm {
    mov         esi,v
    mov         ebx,dword ptr exValue
    mov         ecx,dword ptr exValue + 4
    mov         eax,dword ptr cmpValue
    mov         edx,dword ptr cmpValue + 4
    lock cmpxchg8b qword ptr [esi]
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T07:09:19.327

`cmpexch`x64 体系结构使用良好的旧指令支持 64 位比较交换。或者您也可以使用更复杂的`cmpexch8b`指令（来自“ [AMD64 Architecture Programmer's Manual Volume 1: Application Programming](http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/24592.pdf) ”）：

> 该`CMPXCHG`指令将`AL`or`rAX`寄存器中的值与第一个（目标）操作数进行比较，并根据结果设置算术标志（`ZF`、`OF`、`SF`、 `AF`、`CF`、`PF`）。如果比较值相等，则将源操作数加载到目标操作数中。如果它们不相等，则将第一个操作数加载到累加器中。`CMPXCHG`可用于尝试拦截一个信号量，即测试其状态是否空闲，如果是，则将新值加载到信号量中，使其状态忙。测试和加载是原子执行的，因此使用信号量访问共享对象的并发进程或线程不会发生冲突。
> 
> 该`CMPXCHG8B` 指令将`EDX:EAX`寄存器中的 64 位值与 64 位内存位置进行比较。如果值相等，`ZF`则设置零标志 ( )，并将`ECX:EBX`值复制到内存位置。否则，`ZF` 清除标志，并将内存值复制到`EDX:EAX`.
> 
> 该`CMPXCHG16B` 指令将`RDX:RAX`和`RCX:RBX`寄存器中的 128 位值与 128 位内存位置进行比较。如果值相等，`ZF`则设置零标志 ( )，并将`RCX:RBX`值复制到内存位置。否则，`ZF`清除标志，并将内存值复制到`rDX:rAX`.

如果无法推断操作数的大小，则不同的汇编语法可能需要具有指令助记符中指定的操作长度。GCC 的内联汇编器可能就是这种情况——我不知道。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-12-01T06:12:07.437

AMD64 架构程序员手册 V3 中 cmpxchg8B 的用法：

将 EDX:EAX 寄存器与 64 位内存位置进行比较。如果相等，则将零标志 (ZF) 设置为 1，并将 ECX:EBX 寄存器复制到内存位置。否则，将内存位置复制到 EDX:EAX 并清除零标志。

我使用 cmpxchg8B 在 x86-64 机器上实现了一个简单的互斥锁功能。这是代码

```
.text
.align 8
.global mutex_lock
mutex_lock:
    pushq   %rbp
    movq    %rsp,   %rbp

    jmp .L1

.L1:
    movl    $0, %edx
    movl    $0, %eax
    movl    $0, %ecx
    movl    $1, %ebx
    lock    cmpxchg8B   (%rdi)
    jne .L1
    popq    %rbp
    ret 
```

# ruby - 查找模块中可用的类

> ID：833125
> 
> 赞同：79
> 
> 时间：2009-05-07T06:18:12.680
> 
> 标签：ruby, metaprogramming

我有一个模块`MyModule`。我动态地将类加载到其中。如何获取在其命名空间中定义的类的列表？

例子：

```
def load_plugins
  Dir.glob(File.dirname(__FILE__) + '/plugins/*.rb') do |f|
    MyModule.class_eval File.read(f)
  end

  # now how can I find the new classes I've loaded into MyModule?
end 
```

我应该说每个都`f`包含“class Foo; end”之类的东西。

你也可以这样想：在 Rails 中，我如何以编程方式找到 ActiveRecord 模块中定义的所有类？

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2009-05-07T06:36:54.070

类是通过常量访问的。在模块中定义的类在该模块中被列为常量。所以你只需要选择引用类的常量。

```
MyModule.constants.select {|c| MyModule.const_get(c).is_a? Class} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2019-11-06T14:41:22.323

如果您在 Rails 上，则需要先访问常量才能显示它们，因为它们是延迟加载的。

```
MyModule::NotAClass = "not a class"

MyModule.constants => [:NotAClass]

MyModule::AClass => :AClass # Access class for it to be autoloaded

MyModule.constants => [:AClass, :NotAClass]

# Now, select the constants which are class instances

MyModule.constants
        .map(&MyModule.method(:const_get))
        .select { |constant| constant.is_a? Class} 

 => [MyModule::AClass]** 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-04-08T14:22:57.983

如果您想递归地获取模块中的所有类，您可以执行类似的操作

```
def get_classes(mod)
  mod.constants.map do |c|
    const = mod.const_get(c)
    if const.is_a? Class
      const
    elsif const.is_a? Module
      get_classes(const)
    else
      next
    end
  end.flatten
end 
```

然后，给定一些模块结构，例如：

```
 module MyModule
  module Submodule1
    class Class1
    end
  end

  module Submodule2
    class Class2
    end
  end
end 
```

输出看起来像：

```
puts get_classes(MyModule)

# => MyModule::Submodule1::Class1
# => MyModule::Submodule2::Class2 
```

# c# - 如何在不序列化的情况下从对象获取字节？

> ID：833137
> 
> 赞同：1
> 
> 时间：2009-05-07T06:22:00.643
> 
> 标签：c#, .net

我想保存用户在运行时更改的控件的属性。（.Net windows 窗体应用程序）

我只是使用 BinaryFormatter 来序列化对象，它可以工作，但有些属性没有序列化，因此我想将对象保存为二进制

注意：我使用第三方组件，没有源代码

请你帮助我好吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T06:31:26.597

序列化对象*是*将其保存为“二进制”。如果您正在寻找一个直接的内存转储，那么您就不走运了——这在 .NET 中是不现实的。

如果序列化不能开箱即用，您可能需要序列化您可以序列化的内容，然后添加有关当前未序列化的属性的额外信息。我个人会稍微担心这个解决方案可能有多脆弱 - 属性没有被序列化可能有很好的理由。（.NET 二进制序列化从一开始就很脆弱......）

为什么不联系组件的作者并征求他们的意见呢？他们可能比我们更了解您可能遇到的任何怪癖。

# internet-explorer - IE工具栏，默认可见

> ID：833138
> 
> 赞同：2
> 
> 时间：2009-05-07T06:22:07.680
> 
> 标签：internet-explorer, registry, default, toolbar, visibility

我创建了一个运行良好的 IE 带对象（工具栏）。但是，当安装在新机器上时，默认情况下它是不可见的。当然，可以通过右键单击工具栏区域并选择它来打开它，但是，我想知道注册表中是否有一种方法或选项可以让我在安装后直接打开工具栏。

有谁知道如何做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-20T07:49:29.137

[您可以从 BHO 以编程方式显示工具栏（您可以在此处](http://msdn.microsoft.com/en-us/library/bb250436.aspx)找到有关制作 BHO 的更多信息）：

```
STDMETHODIMP MyBHO::SetSite(IUnknown *pUnkSite)
{
    if( /*is this the first run since BHO was installed?*/ )
    {
        CComQIPtr<IWebBrowser2, &IID_IWebBrowser2> webBrowser2 = pUnkSite; 
        if( webBrowser2 != NULL )
        {
            VARIANT vtBandGUID, vtShow, vtSize;

            vtBandGUID.vt = VT_BSTR;
            vtBandGUID.bstrVal = SysAllocString( OLESTR( "{TOOLBAR-GUID}" ) );

            vtShow.vt = VT_BOOL;
            vtShow.boolVal = true;

            vtSize.vt = VT_I2;
            vtSize.iVal = 0;

            webBrowser2->ShowBrowserBar( &vtBandGUID, &vtShow, &vtSize );
            SysFreeString( vtBandGUID.bstrVal );
        }
    }

    return S_OK;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T06:46:45.437

只是一个猜测，但也许这是 IE 的默认行为，使用户可以选择任何东西？他使浏览器变得混乱？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T07:01:23.870

不是一个确定的答案，但您可以运行 Sysinternals Process Monitor，仅过滤注册表更改，并记录手动使工具栏可见时发生的情况。然后确保在安装脚本中执行此操作。如果为工具栏注册表项分配了您无法控制的 GUID 或 ID，这可能会变得很棘手。

# sql-server - 在 ms sql 中编写 DB 对象脚本的免费实用程序

> ID：833148
> 
> 赞同：6
> 
> 时间：2009-05-07T06:25:17.030
> 
> 标签：sql-server, svn, version-control

我正在尝试实现数据库源代码控制。

我需要的工具应该为数据库中的每个对象创建一个单独的文件，最好排列在文件夹中，比如

存储过程函数视图表

并且能够转储某些查询的结果会很棒，以便跟踪几个配置表中的数据更改......

我想知道是否已经有一个工具可以处理这种事情......

--

只是为了清除一些东西......

我已经在使用 sql delta 来处理更新脚本...

我想要数据库的脚本以便与颠覆一起使用，这样我就可以跟踪每次提交更改了哪些对象，而无需研究更新脚本......

我正在使用 SQL 分布式管理对象 (SQL-DMO) 开发一个不错的 vb 脚本，我会告诉你它是如何进行的......

拥有自己的解决方案的好处是，我还可以包含查询或存储过程执行的输出，以跟踪某些表中的更改、服务器配置、数据库的增长，以及我可以转储到文本文件的任何内容...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T15:14:01.440

我正是为了这个目的而使用[ScriptDB](http://scriptdb.codeplex.com/)。我唯一需要更改的是删除生成文件中的脚本日期。否则，文件在 Subversion 中总是被标记为已更改。

这是我使用的批次。svnclient 是来自 codeplex [svncompletesync.codeplex.com](http://svncompletesync.codeplex.com/)的工具，用于将文件夹中的所有文件签入 subversion。：

`svn checkout "http://svn/myproject" D:\Projekte\db_svn\myproject`

`ScriptDB "D:\temp\scriptdb" myserver mydb mylogin mypwd`

`del "D:\Projekte\db_svn\myproject\Schema Objects\\*.sql" /q /s`

`xcopy "D:\temp\scriptdb\myserver\mydb\Schema Objects\\*.sql" "D:\Projekte\db_svn\myproject\Schema Objects" /e /y /i`

`svnclient "D:\Projekte\db_svn\myproject" -m "commit durch svncompletesync"`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T07:14:55.477

如果我理解正确，您需要两件事：首先，您需要从数据库元数据（表、视图、存储过程等）生成脚本，一旦完成，您需要使用某种一致的方法进行脚本版本控制.

如果您已经在数据库中有元数据和数据，我看不出有什么会阻止您**使用 SQL Management Studio**（或 SQL Enterprise Manager）从数据库对象**生成脚本：请参阅**[如何：生成脚本（SQL Server Management工作室）](http://technet.microsoft.com/en-us/library/ms178078.aspx)。这应该适用于 SQL Server 2000、2005 等。请记住，您可以自定义脚本生成设置，例如，您可以为每个对象使用单独的脚本，而不是一个巨大的脚本。您可能需要编写一些脚本来用数据填充表（我不确定向导是否支持数据提取）。

获得脚本后，您可能必须在特定文件夹之间手动分发它们，完成后，您应该准备好在源代码管理中检查它们。从这一点开始，您需要弄清楚后续数据库安装、升级和修复的方法。这是一项相当复杂的任务，涵盖比简单答案需要更长的时间。如果您对可能的选项感兴趣，请查看我的[数据库安装程序修订](http://alekdavis.blogspot.com/2008/07/database-installer-revised.html)后的帖子，其中提到了一些方法并参考了几篇解决**数据库版本控制**的文章（对不起，自我推销，但我不想重复相同的信息）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T07:19:58.240

该领域的大多数工具都不是免费的，但有一个开源项目[ScriptDB](http://scriptdb.codeplex.com/)可以满足您生成脚本的需求。

这不会解决如何以正确的顺序将脚本应用到数据库的问题 - 如果您不想付费，您可能必须自己即兴发挥。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T06:38:57.873

您可以尝试[Wizardby](http://code.google.com/p/octalforty-wizardby)，这并不是您所要求的，但仍然可以帮助您处理数据库更改管理。它可以对您的数据库模式（嗯，它的一个子集）进行逆向工程，然后在一个特殊的独立于平台的 DSL 中编写所谓的“迁移”：

```
version 20090331140131:
    oxite_FileResource:
        FileResourceID type => PK, primary-key => true
        SiteID type => Guid, nullable => false
        FileResourceName type => LongName
        CreatorUserID references => oxite_User
        Data type => Binary
        ContentType type => AnsiString, length => 25, nullable => false
        Path type => String, length => 1000, nullable => false
        State type => Byte, nullable => false
        CreatedDate type => DateTime, nullable => false
        ModifiedDate type => DateTime, nullable => false 

    oxite_UserFileResourceRelationship:
        UserID references => oxite_User
        FileResourceID references => oxite_FileResource:
            add index unique => true

        index "" columns => [UserID, FileResourceID], unique => true, clustered => true 
```

# gis - 屏幕坐标到纬度和经度

> ID：833151
> 
> 赞同：1
> 
> 时间：2009-05-07T06:26:04.097
> 
> 标签：gis, latitude-longitude, openlayers

在开放图层库中，以下是用于将屏幕坐标转换为经纬度的方法。我无法弄清楚这个方法封装的逻辑？

 `````
getLatLonFromPoint: function (point) {
    var center = this.getCenter();
    //map center lat/lon
    var res  = this.getResolution(); 
    //pre defined by the user. Represents the change in lat long per screen unit at the given zoom level
    var size = this.getSize(); 
    //this is the width and height of the div in which the map has to be displayed
    var delta_x = point.x - (size.w / 2);
    var delta_y = point.y - (size.h / 2);
    return new OpenLayers.LatLon(
        center.lat - delta_y * res,
        center.lon + delta_x * res );
   }

````  `有人可以提供一些指示吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T06:50:52.540

该函数根据当前地图的分辨率、当前地图中心点的经纬度以及所选点到地图中心的距离，计算出指定点的经纬度。

```
var center = this.getCenter();
//地图中心纬度/经度
var res = this.getResolution();
//由用户预先定义。代表经纬度的变化...
var size = this.getSize();

```

上面的代码收集了计算所需的信息：当前地图视图的中心点（这将为我们提供中心点的纬度/经度）、当前地图分辨率以及用户屏幕上的当前地图大小（可能受屏幕尺寸等影响）。

然后计算如下：

```
    //这是必须在其中显示地图的div的宽度和高度
    var delta_x = point.x - (size.w / 2);
    var delta_y = point.y - (size.h / 2);

```

首先取 x 坐标（以像素为单位）并减去地图的宽度（以像素为单位）。这给了我们一个新的 x 坐标，其中 0 是地图的中心像素。delta-x 现在应该是范围从 -(size.w/2) 到 +(size.w/2) 的像素值。然后我们对 y 坐标做同样的事情。所以 delta-x 和 delta-y 现在是笛卡尔坐标，原点位于地图的中心。

```
    返回新的 OpenLayers.LatLon(
        center.lat - delta_y * res,
        center.lon + delta_x * res );

```

我们需要将 delta-x 和 delta-y 从像素转换为纬度/经度。首先，我们将 delta-x 和 delta-y 乘以当前分辨率。这给了我们正确的比例，但不是正确的原点。添加 center.lat 和 center.lon adusts 以根据当前显示的地图为我们提供纬度/经度。

最后，“new OpenLayers.LatLon”调用只是将上述计算包装在一个 LatLon 对象中，以便它可以作为一个 LatLon 对象从函数中返回。

编辑：使用像素时，x 坐标的增加通常意味着“向右移动”，而 y 坐标的增加通常意味着“向上移动”。在地图上，当您增加经度时，您通常会“向右移动”。然而，纬度是颠倒的；当您增加纬度时，您通常会在地图上“向下移动”。

因此，Latitude 的工作方向与屏幕上的正常 y 坐标方案相反。因此，在最终计算中，center.lat 使用减号，center.lon 使用加号。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T07:15:21.310

我重新排列了现有的评论，添加了更多内容并添加了一些空白。希望你会发现这一点更清楚。

```
getLatLonFromPoint: function (point) {
    // point is the x and y screen coordinate

    // map center lat/lon
    var center = this.getCenter();

    // pre defined by the user. Represents the change in lat long per screen unit at the given zoom level
    var res  = this.getResolution(); 

    // this is the width and height of the screen (div) in which the map has to be displayed
    var size = this.getSize(); 

    // this is the distance of the point from the center of the screen (div)
    var delta_x = point.x - (size.w / 2);
    var delta_y = point.y - (size.h / 2);

    // return the latitude and longitude
    //   these are calculated from the center lat/lon using the 
    //   screen distances which are scaled (multiplied) by the resolution
    return new OpenLayers.LatLon(
        center.lat - delta_y * res,
        center.lon + delta_x * res );
   } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-05-25T11:46:53.907

试试这个：

```
map.events.register("mousemove", map, function(e) { 
    var position = this.events.getMousePosition(e);
    var p = map.getLonLatFromPixel(new OpenLayers.Pixel(position.x, position.y));
    // your longitude value = p.lon;
    // your latitude value = p.lat;
}); 
```

# c++ - 运算符重载 >>

> ID：833157
> 
> 赞同：0
> 
> 时间：2009-05-07T06:27:34.810
> 
> 标签：c++, operator-overloading

我对 C++ 运算符重载非常陌生，并且遇到了一些初期问题。

我已经定义：

> void Graph::operator>>(const char* param)

上述函数必须接受一个字符串作为输入，然后对该字符串执行某些操作。我如何调用这个函数？我可以通过哪些方式使用它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T06:45:26.903

如果要定义运算符以便可以执行以下操作：

```
cin >> myGraph
cout << myGraph 
```

您需要执行以下示例：

```
struct Entry
{
    string symbol;
    string original;
    string currency;

    Entry() {}
    ~Entry() {}
    Entry(string& symbol, string& original, string& currency)
        : symbol(symbol), original(original), currency(currency)
    {}
    Entry(const Entry& e)
        : symbol(e.symbol), original(e.original), currency(e.currency)
    {}
};

istream& operator>>(istream& is, Entry& en);
ostream& operator<<(ostream& os, const Entry& en); 
```

然后实现运算符：

```
istream& operator>>(istream& is, Entry& en)
{
    is >> en.symbol;
    is >> en.original;
    is >> en.currency;
    return is;
}

ostream& operator<<(ostream& os, const Entry& en)
{
    os << en.symbol << " " << en.original << " " << en.currency;
    return os;
} 
```

注意：在这种情况下，条目是结构，因此它的成员是公共的。如果您不想将它们公开，您可以将操作员方法定义为好友，以便他们可以访问 Entry 的私有成员。

如果成员不公开，Entry 的外观如下：

```
struct Entry
{
    private:
        string symbol;
        string original;
        string currency;

    public:
        Entry() {}
        ~Entry() {}
        Entry(string& symbol, string& original, string& currency)
            : symbol(symbol), original(original), currency(currency)
        {}
        Entry(const Entry& e)
            : symbol(e.symbol), original(e.original), currency(e.currency)
        {}

        friend istream& operator>>(istream& is, Entry& en);
        friend ostream& operator<<(ostream& os, const Entry& en);
}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T06:33:26.840

```
Graph myGraph;
myGraph >> "bla"; 
```

请注意，您的`operator>>()`. 通常它是这样使用的：

```
NumericObject NumericObject::operator>>(NumericObject const& operand) const;
// bitshifts to the right 
```

和

```
std::istream& operator>>(istream& in, StreamableObject& obj);
// parses a string representation of obj 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T06:39:59.570

我猜你实际上想要做的是能够编写这样的代码：

```
cin >> myGraph;
cout << myGraph; 
```

请注意，图形对象实际上并不是调用其方法的对象。

在这种情况下，您真正​​想要做的是重载全局 operator>> 函数：

```
std::istream& operator>> (std::istream&, graph&);
std::ostream& operator<< (std::ostream&, const graph&); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T06:35:51.420

如果您对此不熟悉，那么您选择了一个相当有趣（读作“不简单”）的问题来尝试解决。

运算符重载并不完全是函数。当编译器尝试解析如下所示的代码时，它们会被间接调用：

```
Graph g = new Graph();
g >> "do something"; 
```

我建议你不要这样做。由于副作用，运算符重载可能会导致非常难以解决的错误。他们对任何必须维护您的代码的人也很苛刻（可能是您忘记了为什么这样做之后）。

仅当它们的含义和使用直观时才使用运算符重载。

# .net - 如何使用 DataTrigger 覆盖绑定属性

> ID：833158
> 
> 赞同：10
> 
> 时间：2009-05-07T06:29:39.330
> 
> 标签：.net, wpf, xaml, binding, datatrigger

我有以下 XAML 用于显示有关在列表视图中选择的项目的详细信息。我希望矩形在文本后面显示标准信息颜色，除非所选项目表示错误消息。下面的代码不能按原样工作，总是显示信息颜色。如果我不`Fill`为根`<Rectangle />`元素指定 a ，它会很好用。

```
<Rectangle Fill="{DynamicResource {x:Static SystemColors.InfoBrushKey}}" 
           RadiusX="4" RadiusY="4">
  <Rectangle.Style>
    <Style TargetType="{x:Type Rectangle}">
      <Style.Triggers>
        <DataTrigger Binding="{Binding Path=CurrentMessage.Severity"  
                     Value="Error" >
          <Setter Property="Fill" Value="#20FF0000" />
        </DataTrigger>
      </Style.Triggers>
    </Style>
  </Rectangle.Style>
</Rectangle> 
```

该片段没有反映它，但实际代码具有相当多的严重性状态级别，因此我不想为每个可能的严重性定义触发器。我想要的逻辑是“使用信息颜色，除非严重性是错误，然后使用红色”。

我确定我误解了 WPF 的一些基本方面，但似乎无法确定它。有人可以指出我正确的方向，以便我指定的数据触发器在条件为真时覆盖现有的 Fill 值吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-07T07:37:36.233

您快到了。不要将“默认”填充指定为矩形的属性，而是在样式中指定它：

```
<Rectangle RadiusX="4" RadiusY="4">
  <Rectangle.Style>
    <Style TargetType="{x:Type Rectangle}">
      <Setter Property="Fill" 
              Value="{DynamicResource {x:Static SystemColors.InfoBrushKey}}" />
      <Style.Triggers>
        <DataTrigger Binding="{Binding Path=CurrentMessage.Severity"  
                     Value="Error" >
          <Setter Property="Fill" Value="#20FF0000" />
        </DataTrigger>
      </Style.Triggers>
    </Style>
  </Rectangle.Style>
</Rectangle> 
```

# linux - Linux 空间检查

> ID：833160
> 
> 赞同：0
> 
> 时间：2009-05-07T06:29:46.287
> 
> 标签：linux, space

在linux中集体检查文件空间...

我有近 100 多个文件...共同检查大小...

* * *

*编辑*：我需要的是：我有一个包含 1000 个文件的文件夹，我需要一些东西来计算总和 [*什么？*] 仅我需要的 100 个文件......不是所有 1000 个文件......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T06:32:54.783

此命令将为您提供当前目录中所有单个文件/目录的大小（以千字节为单位）：

```
du -ks * 
```

此命令将为您提供当前目录的总大小：

```
du -ks . 
```

如果您需要递归并获取更详细的信息， find 命令可能会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T06:40:10.223

如果您想要当前目录中所有文件的总大小（采用“人类可读格式”）

```
du -sh 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T06:32:56.107

我不是 linux 大师，但应该有一些`ls`显示大小的命令开关。

如果失败，请考虑使用`du`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T06:33:27.120

这有点含糊......假设你想要的只是获得一堆文件的总大小，有任意数量的解决方案。

如果文件都在同一个目录中，一种非常简单的方法是使用

```
ls -lh | head -1 
```

这将打印一行显示“总”数字，`-h`甚至带有友好的“人类可读”（这是 ls 的选项）单位。

请注意，这不适用于通配符，因为那时 ls 会抑制其“总”行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T07:23:29.543

使用 gdu：

```
 aaa:vim70> gdu 
5028    ./doc
4420    ./syntax
.
.
.
176     ./compiler
16      ./macros/hanoi
16      ./macros/life
48      ./macros/maze
20      ./macros/urm
200     ./macros
252     ./keymap
18000   . 
```

您可以使用**`--max-depth`**来限制搜索的深度：

```
 aaa:vim70> gdu --max-depth=1
5028    ./doc
136     ./print
76      ./colors
4420    ./syntax
420     ./indent
628     ./ftplugin
1260    ./autoload
64      ./plugin
800     ./tutor
3348    ./spell
176     ./compiler
200     ./macros
112     ./tools
844     ./lang
252     ./keymap
18000   . 
```

请注意， `macros`不会出现 的子目录。

甚至：

```
aaa:vim70> gdu --max-depth=0
18000   . 
```

默认单位是千字节。您可以使用`-h`以人类可读的形式获取它：

```
 aaa:vim70> gdu --max-depth=1 -h
5.0M    ./doc
136k    ./print
76k     ./colors
4.4M    ./syntax
420k    ./indent
628k    ./ftplugin
1.3M    ./autoload
64k     ./plugin
800k    ./tutor
3.3M    ./spell
176k    ./compiler
200k    ./macros
112k    ./tools
844k    ./lang
252k    ./keymap
18M     . 
```

# linq - 子查询 X 在哪里（来自...？

> ID：833162
> 
> 赞同：1
> 
> 时间：2009-05-07T06:30:12.840
> 
> 标签：linq

我怎样才能做到这一点 ？where tsc.TransactionID in (from t in Transactions where ........

```
 Eg:
        var query = (from tsd in TransactionSampleDetails 
        join tsc in TransactionSamples on  tsd.TransactionSampleID equals tsc.TransactionSampleID
        join qp in QualityParameters on tsd.ParameterID equals qp.ParameterID
        where tsc.TransactionID in (from t in Transactions where t.StockpileID == 7122 select t.TransactionID)
        select new 
        { 
            TransactionID = tsc.TransactionID,
            ParameterName = qp.Parameter,
            ParameterValue = tsd.ActualValue
        }); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T06:35:47.270

您可以使用包含：

```
where (from t in Transactions 
       where t.StockpileID == 7122 
       select t.TransactionID).Contains(tsc.TransactionID) 
```

请注意，使用另一个联接可能更有效和更合适：

```
join t in Transactions.Where(t => t.StockpileID == 7122)
  on tsc.TransactionId equals t.TransactionID 
```

# asp.net-mvc - asp.net mvc 中的整数验证

> ID：833163
> 
> 赞同：1
> 
> 时间：2009-05-07T06:30:13.167
> 
> 标签：asp.net-mvc

我正在使用服务器端验证，例如

```
 public IEnumerable<RuleViolation> GetRuleViolations()
    {
        if (String.IsNullOrEmpty(Name))
            yield return new RuleViolation("Name is Required", "Name");
        if (Price == 0)
            yield return new RuleViolation("Price is Required", "Price");
        yield break;
    } 
```

当我将 Price 留为空白时，它将 0 作为值。

所以我用0检查它。

在我的数据库中价格不能为空；我正在使用 LINQ-to-SQL 类。

现在我的问题是，当我将 Price 留空时，它给了我两条消息。例如

*   需要一个数值。
*   价格为必填项。

那么如何在不显示第一条错误消息的情况下进行自定义验证？

**回复评论** 我在这里引用专业 Asp.net MVC 1.0 的书籍[代码](http://weblogs.asp.net/scottgu/archive/2009/03/10/free-asp-net-mvc-ebook-tutorial.aspx)。

本书的 HTML 页面在[这里](http://weblogs.asp.net/scottgu/archive/2009/04/28/free-asp-net-mvc-nerddinner-tutorial-now-in-html.aspx)。

有用的[页面](http://nerddinnerbook.s3.amazonaws.com/Part3.htm)。

```
public class RuleViolation
    {
        public string ErrorMessage { get; private set; }
        public string PropertyName { get; private set; }

        public RuleViolation(string errorMessage)
        {
            ErrorMessage = errorMessage;
        }

        public RuleViolation(string errorMessage, string propertyName)
        {
            ErrorMessage= errorMessage;
            PropertyName = propertyName;
        }
    } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T07:56:14.427

我认为您会自动从框架中收到第一条消息“需要一个值”，因为您的`Price`属性是一个值类型，它永远不能为空。

所以当你发布一个空白字段时，框架通常会尝试分配`null`给这个属性，这在这种情况下是不可能的。

如果将类型更改为可为空：

```
public double? Price { get; set; } 
```

该特定消息应该消失。然后您可以将验证更改为：

```
 if (Price == null)
        yield return new RuleViolation("Price is required", "Price"); 
```

数据库字段不允许空值这一事实不应干扰您的视图模型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-28T15:58:29.223

为了使**Thomas Eyde**上面写的工作（不弄乱代码），你可以......

1.  打开对应的**.dbml**文件
2.  点击“价格”属性
3.  在 Visual Studio 属性窗口中，将 Nullable 值从 False 更改为 True
4.  保存文件！

您现在可以进入您的班级并添加 if 语句，VS 不应该抱怨。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T20:33:28.833

那是因为默认模型绑定器添加了该错误。您可以为该特定对象编写自己的模型绑定器，并直接使用表单集合来更好地控制验证。

# c# - NHibernate SQL 创建导致错误

> ID：833168
> 
> 赞同：4
> 
> 时间：2009-05-07T06:32:45.593
> 
> 标签：c#, nhibernate

我有 2 个名为 Order 和 Orderrow 的类。我使用 NHibernate 来加入它。

在运行 NUnit 来测试查询时，我得到了 ADOException：

```
Logica.NHibernate.Tests.NHibernateTest.SelectAllOrdersFromSupplierNamedKnorrTest:
NHibernate.ADOException : could not execute query
[ SELECT this_.OrderId as OrderId1_1_, this_.CreatedAt as CreatedAt1_1_, this_.ShippedAt as ShippedAt1_1_, this_.ContactId as ContactId1_1_, customer2_.ContactId as ContactId0_0_, customer2_.LastName as LastName0_0_, customer2_.Initials as Initials0_0_, customer2_.Address as Address0_0_, customer2_.City as City0_0_, customer2_.Country as Country0_0_ FROM Order this_ inner join Contact customer2_ on this_.ContactId=customer2_.ContactId ]
[SQL: SELECT this_.OrderId as OrderId1_1_, this_.CreatedAt as CreatedAt1_1_, this_.ShippedAt as ShippedAt1_1_, this_.ContactId as ContactId1_1_, customer2_.ContactId as ContactId0_0_, customer2_.LastName as LastName0_0_, customer2_.Initials as Initials0_0_, customer2_.Address as Address0_0_, customer2_.City as City0_0_, customer2_.Country as Country0_0_ FROM Order this_ inner join Contact customer2_ on this_.ContactId=customer2_.ContactId]
  ----> System.Data.SqlClient.SqlException : Incorrect syntax near the keyword 'Order'. 
```

在分析 NHibernate 创建的 SQL 时，我注意到 Order 类正在破坏 SQL 语句，因为 ORDER BY 是 SQL 中的内部关键字。

这是在 NHibernate 中创建的 SQL：

```
SELECT this_.OrderId as OrderId1_1_, this_.CreatedAt as CreatedAt1_1_, this_.ShippedAt as ShippedAt1_1_, this_.ContactId as ContactId1_1_, customer2_.ContactId as ContactId0_0_, customer2_.LastName as LastName0_0_, customer2_.Initials as Initials0_0_, customer2_.Address as Address0_0_, customer2_.City as City0_0_, customer2_.Country as Country0_0_ FROM Order this_ inner join Contact customer2_ on this_.ContactId=customer2_.ContactId 
```

我在 SQL Server 2008 Management Studio 中对其进行了如下更改：

```
SELECT this_.OrderId as OrderId1_1_, this_.CreatedAt as CreatedAt1_1_, this_.ShippedAt as ShippedAt1_1_, this_.ContactId as ContactId1_1_, customer2_.ContactId as ContactId0_0_, customer2_.LastName as LastName0_0_, customer2_.Initials as Initials0_0_, customer2_.Address as Address0_0_, customer2_.City as City0_0_, customer2_.Country as Country0_0_ FROM [Order] this_ inner join Contact customer2_ on this_.ContactId=customer2_.ContactId` 
```

我在表名 Order 中添加了括号（如下所示：[Order]），它是固定的。

但是如何在 NHibernate 中解决这个问题？是否有一个映射 XML 文件指令来完成这项工作？

（使用 VS2008 SP1、SQL Server 2008 SP1、NHibernate 2.0.1 GA）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T06:35:43.357

请参见“5.3\. SQL 引用的标识符”部分[。](https://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/mapping.html)Yoo基本上需要这个：

```
<class name="Order" table="`Order`"> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-07T06:37:26.487

我认为如果您在映射文件中添加引号（SQL Server 中的“[”和“]”，或者您的数据库支持的任何引号），hibernate 将在生成查询时引用对象名称。

（也许发布你的映射文件，所以我们可以看看）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-01-12T15:43:48.667

在 Fluent NHibernate 中，添加

```
.Column("`Order`"); 
```

到您的映射以修复此错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-07T12:25:45.247

使用约定时，您可以添加以下内容：

```
public class TableNameConvention
    : IClassConvention, IClassConventionAcceptance
{
    public void Accept(IAcceptanceCriteria<IClassInspector> criteria)
    {
        criteria.Expect(x => Check(x));
    }

    private bool Check(IClassInspector x)
    {
        return String.IsNullOrWhiteSpace(x.TableName) || x.TableName.Equals("`{0}`".Args(x.EntityType.Name));
    }

    public void Apply(IClassInstance instance)
    {
        instance.Table("`" + instance.EntityType.Name + "`");
    }
} 
```

要解决保留表名称和保留列名称（例如“From”）的问题，可以使用以下内容：

```
public class ColumnNameConvention : IPropertyConvention, IPropertyConventionAcceptance
{
    public void Apply(IPropertyInstance instance)
    {
        instance.Column("`" + instance.Property.Name + "`");
    }

    public void Accept(IAcceptanceCriteria<IPropertyInspector> criteria)
    {
        criteria.Expect(c => Check(c));
    }

    private bool Check(IPropertyInspector inspector)
    {
        //walkaround:
        //this convention causes problems with Components - creates columns like Issue`Id` so we apply it only to entities

        var type = inspector.EntityType;
        if (!(type.IsSubclassOf(typeof (Entity)) || type.IsSubclassOf(typeof (GlossaryEntity))))
        {
            return false;
        }

        return true;
    }
} 
```

# f# - 方便的 F# 片段

> ID：833180
> 
> 赞同：68
> 
> 时间：2009-05-07T06:37:14.053
> 
> 标签：f#, reference, code-snippets

已经有[两个](https://stackoverflow.com/questions/35940/elegant-snippets-of-f) [关于](https://stackoverflow.com/questions/832569/list-of-functional-code-snippets-for-procedural-programmers)F#/功能片段的问题。

然而，我在这里寻找的是**有用**的片段，可重用的小“帮助”功能。或者你永远记不住的模糊但漂亮的模式。

就像是：

```
open System.IO

let rec visitor dir filter= 
    seq { yield! Directory.GetFiles(dir, filter)
          for subdir in Directory.GetDirectories(dir) do 
              yield! visitor subdir filter} 
```

我想让它成为一种方便的参考页面。因此，不会有正确的答案，但希望有很多好的答案。

**编辑**Tomas Petricek 专门为 F# 片段[http://fssnip.net/](http://fssnip.net/)创建了一个站点。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-09-25T13:07:09.167

**Perl 风格的正则表达式匹配**

```
let (=~) input pattern =
    System.Text.RegularExpressions.Regex.IsMatch(input, pattern) 
```

`let test = "monkey" =~ "monk.+"`它允许您使用符号匹配文本。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2010-09-22T00:44:33.070

**中缀运算符**

我从[http://sandersn.com/blog//index.php/2009/10/22/infix-function-trick-for-f](http://sandersn.com/blog//index.php/2009/10/22/infix-function-trick-for-f)得到这个，去那个页面了解更多细节。

如果您了解 Haskell，您可能会发现自己在 F# 中缺少中缀糖：

```
// standard Haskell call has function first, then args just like F#. So obviously
// here there is a function that takes two strings: string -> string -> string 
startsWith "kevin" "k"

//Haskell infix operator via backQuotes. Sometimes makes a function read better.
"kevin" `startsWith` "K" 
```

虽然 F# 没有真正的“中缀”运算符，但同样的事情可以通过管道和“后管道”几乎同样优雅地完成（谁知道这样的事情？？）

```
// F# 'infix' trick via pipelines
"kevin" |> startsWith <| "K" 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2010-09-24T16:40:00.727

**多行字符串**

这是非常微不足道的，但它似乎是 F# 字符串的一个不广为人知的特性。

```
let sql = "select a,b,c \
           from table \
           where a = 1" 
```

这会产生：

```
val sql : string = "select a,b,c from table where a = 1" 
```

当 F# 编译器在字符串文字中看到反斜杠后跟回车时，它将删除从反斜杠到下一行第一个非空格字符的所有内容。这允许您拥有排列的多行字符串文字，而无需使用一堆字符串连接。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2009-05-12T06:40:30.533

**通用记忆**，由[该人](http://blogs.msdn.com/dsyme/archive/2007/05/31/a-sample-of-the-memoization-pattern-in-f.aspx)本人提供

```
let memoize f = 
  let cache = System.Collections.Generic.Dictionary<_,_>(HashIdentity.Structural)
  fun x ->
    let ok, res = cache.TryGetValue(x)
    if ok then res
    else let res = f x
         cache.[x] <- res
         res 
```

使用它，您可以像这样执行缓存读取器：

```
let cachedReader = memoize reader 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-05-07T08:58:58.050

**对文本文件的简单读写**

这些是微不足道的，但使文件访问可管道化：

```
open System.IO
let fileread f = File.ReadAllText(f)
let filewrite f s = File.WriteAllText(f, s)
let filereadlines f = File.ReadAllLines(f)
let filewritelines f ar = File.WriteAllLines(f, ar) 
```

所以

```
let replace f (r:string) (s:string) = s.Replace(f, r)

"C:\\Test.txt" |>
    fileread |>
    replace "teh" "the" |>
    filewrite "C:\\Test.txt" 
```

并将其与问题中引用的访问者相结合：

```
let filereplace find repl path = 
    path |> fileread |> replace find repl |> filewrite path

let recurseReplace root filter find repl = 
    visitor root filter |> Seq.iter (filereplace find repl) 
```

**如果您希望能够读取“锁定”文件（例如，已经在 Excel 中打开的 csv 文件......），请稍作改进**：****

 **```
let safereadall f = 
   use fs = new FileStream(f, FileMode.Open, FileAccess.Read, FileShare.ReadWrite)
   use sr = new StreamReader(fs, System.Text.Encoding.Default)
   sr.ReadToEnd()

let split sep (s:string) = System.Text.RegularExpressions.Regex.Split(s, sep)

let fileread f = safereadall f
let filereadlines f = f |> safereadall |> split System.Environment.NewLine 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2010-10-13T21:29:29.260

对于需要检查 null 的性能密集型内容

```
let inline isNull o = System.Object.ReferenceEquals(o, null)
if isNull o then ... else ... 
```

大约快 20 倍

```
if o = null then ... else ... 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2009-05-08T16:03:55.970

**Active Patterns**，又名“Banana Splits”，是一种非常方便的构造，可以让一个匹配多个正则表达式模式。这很像[AWK ，但没有](http://en.wikipedia.org/wiki/AWK)[DFA](http://en.wikipedia.org/wiki/Deterministic_finite_state_machine)的高性能，因为模式是按顺序匹配的，直到成功。

```
#light
open System
open System.Text.RegularExpressions

let (|Test|_|) pat s =
    if (new Regex(pat)).IsMatch(s)
    then Some()
    else None

let (|Match|_|) pat s =
    let opt = RegexOptions.None
    let re = new Regex(pat,opt)
    let m = re.Match(s)
    if m.Success
    then Some(m.Groups)
    else None 
```

一些使用示例：

```
let HasIndefiniteArticle = function
        | Test "(?: |^)(a|an)(?: |$)" _ -> true
        | _ -> false

type Ast =
    | IntVal of string * int
    | StringVal of string * string
    | LineNo of int
    | Goto of int

let Parse = function
    | Match "^LET\s+([A-Z])\s*=\s*(\d+)$" g ->
        IntVal( g.[1].Value, Int32.Parse(g.[2].Value) )
    | Match "^LET\s+([A-Z]\$)\s*=\s*(.*)$" g ->
        StringVal( g.[1].Value, g.[2].Value )
    | Match "^(\d+)\s*:$" g ->
        LineNo( Int32.Parse(g.[1].Value) )
    | Match "^GOTO \s*(\d+)$" g ->
        Goto( Int32.Parse(g.[1].Value) )
    | s -> failwithf "Unexpected statement: %s" s 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-09-11T20:21:42.003

**'Unitize' 一个不处理单元** 的函数使用`FloatWithMeasure`函数[http://msdn.microsoft.com/en-us/library/ee806527(VS.100).aspx](http://msdn.microsoft.com/en-us/library/ee806527(VS.100).aspx)。

```
let unitize (f:float -> float) (v:float<'u>) =
  LanguagePrimitives.FloatWithMeasure<'u> (f (float v)) 
```

例子：

```
[<Measure>] type m
[<Measure>] type kg

let unitize (f:float -> float) (v:float<'u>) =
  LanguagePrimitives.FloatWithMeasure<'u> (f (float v))

//this function doesn't take units
let badinc a = a + 1.

//this one does!
let goodinc v = unitize badinc v

goodinc 3.<m>
goodinc 3.<kg> 
```

* * *

**旧版本**：

```
let unitize (f:float -> float) (v:float<'u>) =
  let unit = box 1\. :?> float<'u>
  unit * (f (v/unit)) 
```

向[kvb致敬](https://stackoverflow.com/questions/1398611/f-ununit-reunit-inside-a-function/1406656#1406656)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-09-25T13:14:26.050

**也许单子**

```
type maybeBuilder() =
    member this.Bind(v, f) =
        match v with
        | None -> None
        | Some(x) -> f x
    member this.Delay(f) = f()
    member this.Return(v) = Some v

let maybe = maybeBuilder() 
```

这是一个简单的[单子](http://en.wikibooks.org/wiki/F_Sharp_Programming/Computation_Expressions)介绍。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2010-09-15T18:21:33.623

**选项合并运算符**

我想要一个`defaultArg`语法更接近 C# null-coalescing 运算符的函数版本，`??`. 这让我可以使用非常简洁的语法从选项中获取值，同时提供默认值。

```
/// Option-coalescing operator - this is like the C# ?? operator, but works with 
/// the Option type.
/// Warning: Unlike the C# ?? operator, the second parameter will always be 
/// evaluated.
/// Example: let foo = someOption |? default
let inline (|?) value defaultValue =
    defaultArg value defaultValue

/// Option-coalescing operator with delayed evaluation. The other version of 
/// this operator always evaluates the default value expression. If you only 
/// want to create the default value when needed, use this operator and pass
/// in a function that creates the default.
/// Example: let foo = someOption |?! (fun () -> new Default())
let inline (|?!) value f =
    match value with Some x -> x | None -> f() 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2010-09-07T09:13:38.357

**比例/比率函数生成器**

同样，微不足道，但很方便。

```
//returns a function which will convert from a1-a2 range to b1-b2 range
let scale (a1:float<'u>, a2:float<'u>) (b1:float<'v>,b2:float<'v>) = 
    let m = (b2 - b1)/(a2 - a1) //gradient of line (evaluated once only..)
    (fun a -> b1 + m * (a - a1)) 
```

例子：

```
[<Measure>] type m
[<Measure>] type px

let screenSize = (0.<px>, 300.<px>)
let displayRange = (100.<m>, 200.<m>)
let scaleToScreen = scale displayRange screenSize

scaleToScreen 120.<m> //-> 60.<px> 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2009-05-07T09:10:24.933

**转置列表**（参见[Jomo Fisher 的博客](http://blogs.msdn.com/jomo_fisher/archive/2007/11/17/tight-code-a-puzzle-in-f.aspx)）

```
///Given list of 'rows', returns list of 'columns' 
let rec transpose lst =
    match lst with
    | (_::_)::_ -> List.map List.head lst :: transpose (List.map List.tail lst)
    | _         -> []

transpose [[1;2;3];[4;5;6];[7;8;9]] // returns [[1;4;7];[2;5;8];[3;6;9]] 
```

这是一个尾递归版本，它（来自我的粗略分析）稍微慢一些，但是当内部列表长于 10000 个元素（在我的机器上）时，它的优点是不会引发堆栈溢出：

```
let transposeTR lst =
  let rec inner acc lst = 
    match lst with
    | (_::_)::_ -> inner (List.map List.head lst :: acc) (List.map List.tail lst)
    | _         -> List.rev acc
  inner [] lst 
```

如果我很聪明，我会尝试将它与异步并行化......

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2010-03-17T06:36:27.877

## F# Map <-> C# 字典

（我知道，我知道，System.Collections.Generic.Dictionary 并不是真正的“C#”字典）

**C# 到 F#**

```
(dic :> seq<_>)                        //cast to seq of KeyValuePair
    |> Seq.map (|KeyValue|)            //convert KeyValuePairs to tuples
    |> Map.ofSeq                       //convert to Map 
```

（来自 Brian，[here](http://www.jenkz.org/2008/07/18/c-dictionary-to-f-map/#comment-11)，Mauricio 在下面的评论中提出了改进。`(|KeyValue|)`是匹配 KeyValuePair 的活动模式 - 来自 FSharp.Core - 相当于`(fun kvp -> kvp.Key, kvp.Value)`）

**有趣的选择**

要获得所有不可变的优点，但使用 Dictionary 的 O(1) 查找速度，您可以使用`dict`返回不可变 IDictionary 的运算符（请参阅[此问题](https://stackoverflow.com/questions/1203209/f-how-do-you-declare-the-values-of-a-dictionary-entry-as-mutable)）。

我目前看不到使用此方法直接转换字典的方法，除了

```
(dic :> seq<_>)                        //cast to seq of KeyValuePair
    |> (fun kvp -> kvp.Key, kvp.Value) //convert KeyValuePairs to tuples
    |> dict                            //convert to immutable IDictionary 
```

**F# 到 C#**

```
let dic = Dictionary()
map |> Map.iter (fun k t -> dic.Add(k, t))
dic 
```

这里奇怪的是 FSI 会将类型报告为（例如）：

```
val it : Dictionary<string,int> = dict [("a",1);("b",2)] 
```

但如果您反馈`dict [("a",1);("b",2)]`，FSI 会报告

```
IDictionary<string,int> = seq[[a,1] {Key = "a"; Value = 1; } ... 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2010-09-15T18:10:42.073

**LINQ-to-XML 帮助程序**

```
namespace System.Xml.Linq

// hide warning about op_Explicit
#nowarn "77"

[<AutoOpen>]
module XmlUtils =

    /// Converts a string to an XName.
    let xn = XName.op_Implicit
    /// Converts a string to an XNamespace.
    let xmlns = XNamespace.op_Implicit

    /// Gets the string value of any XObject subclass that has a Value property.
    let inline xstr (x : ^a when ^a :> XObject) =
        (^a : (member get_Value : unit -> string) x)

    /// Gets a strongly-typed value from any XObject subclass, provided that
    /// an explicit conversion to the output type has been defined.
    /// (Many explicit conversions are defined on XElement and XAttribute)
    /// Example: let value:int = xval foo
    let inline xval (x : ^a when ^a :> XObject) : ^b = 
        ((^a or ^b) : (static member op_Explicit : ^a -> ^b) x) 

    /// Dynamic lookup operator for getting an attribute value from an XElement.
    /// Returns a string option, set to None if the attribute was not present.
    /// Example: let value = foo?href
    /// Example with default: let value = defaultArg foo?Name "<Unknown>"
    let (?) (el:XElement) (name:string) =
        match el.Attribute(xn name) with
        | null -> None
        | att  -> Some(att.Value)

    /// Dynamic operator for setting an attribute on an XElement.
    /// Example: foo?href <- "http://www.foo.com/"
    let (?<-) (el:XElement) (name:string) (value:obj) =
        el.SetAttributeValue(xn name, value) 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2009-10-07T15:12:35.693

**树排序/将树展平为列表**

我有以下二叉树：

```
 ___ 77 _
            /        \
   ______ 47 __       99
  /            \
21 _          54
    \        /  \
      43    53  74
     /
    39
   /
  32 
```

表示如下：

```
type 'a tree =
    | Node of 'a tree * 'a * 'a tree
    | Nil

let myTree =
    Node
      (Node
         (Node (Nil,21,Node (Node (Node (Nil,32,Nil),39,Nil),43,Nil)),47,
          Node (Node (Nil,53,Nil),54,Node (Nil,74,Nil))),77,Node (Nil,99,Nil)) 
```

扁平化树的一种简单方法是：

```
let rec flatten = function
    | Nil -> []
    | Node(l, a, r) -> flatten l @ a::flatten r 
```

这不是尾递归，我相信`@`操作员会导致它成为 O(n log n) 或 O(n^2) 与不平衡的二叉树。稍作调整，我想出了这个尾递归 O(n) 版本：

```
let flatten2 t =
    let rec loop acc c = function
        | Nil -> c acc
        | Node(l, a, r) ->
            loop acc (fun acc' -> loop (a::acc') c l) r
    loop [] (fun x -> x) t 
```

这是 fsi 中的输出：

```
> flatten2 myTree;;
val it : int list = [21; 32; 39; 43; 47; 53; 54; 74; 77; 99] 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2010-03-10T06:08:46.143

**Performance testing**

(Found [here](http://srtsolutions.com/blogs/chrismarinos/archive/2009/04/10/f-performance-testing-f-types-vs-structs-and-classes.aspx) and updated for latest release of F#)

```
open System
open System.Diagnostics 
module PerformanceTesting =
    let Time func =
        let stopwatch = new Stopwatch()
        stopwatch.Start()
        func()
        stopwatch.Stop()
        stopwatch.Elapsed.TotalMilliseconds

    let GetAverageTime timesToRun func = 
        Seq.initInfinite (fun _ -> (Time func))
        |> Seq.take timesToRun
        |> Seq.average

    let TimeOperation timesToRun =
        GC.Collect()
        GetAverageTime timesToRun

    let TimeOperations funcsWithName =
        let randomizer = new Random(int DateTime.Now.Ticks)
        funcsWithName
        |> Seq.sortBy (fun _ -> randomizer.Next())
        |> Seq.map (fun (name, func) -> name, (TimeOperation 100000 func))

    let TimeOperationsAFewTimes funcsWithName =
        Seq.initInfinite (fun _ -> (TimeOperations funcsWithName))
        |> Seq.take 50
        |> Seq.concat
        |> Seq.groupBy fst
        |> Seq.map (fun (name, individualResults) -> name, (individualResults |> Seq.map snd |> Seq.average)) 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2010-02-25T06:28:59.523

**数组的加权和**

基于 [k-array] 权重计算 [k-array of n-arrays] 数字的加权 [n-array] 总和

*（从[this question](https://stackoverflow.com/questions/2328697/how-to-apply-a-function-to-an-array-of-float-arrays)和[kvb](https://stackoverflow.com/users/82959/kvb)的[答案](https://stackoverflow.com/questions/2328697/how-to-apply-a-function-to-an-array-of-float-arrays/2329060#2329060)复制）*

鉴于这些数组

```
let weights = [|0.6;0.3;0.1|]

let arrs = [| [|0.0453;0.065345;0.07566;1.562;356.6|] ; 
           [|0.0873;0.075565;0.07666;1.562222;3.66|] ; 
           [|0.06753;0.075675;0.04566;1.452;3.4556|] |] 
```

我们想要一个加权和（按列），因为数组的两个维度都可以是可变的。

```
Array.map2 (fun w -> Array.map ((*) w)) weights arrs 
|> Array.reduce (Array.map2 (+)) 
```

**第一行**：第一个 Array.map2 函数对权重的部分应用产生了一个新函数 (Array.map ((*) weight)，该函数（对于每个权重）应用于 arr 中的每个数组。

**第二行**：Array.reduce 类似于 fold，除了它从第二个值开始并使用第一个作为初始“状态”。在这种情况下，每个值都是我们数组的“行”。因此，在前两行应用 Array.map2 (+) 意味着我们将前两个数组相加，这给我们留下了一个新数组，然后我们 (Array.reduce) 再次将其相加到下一个（在本例中为最后一个）大批。

结果：

```
[|0.060123; 0.069444; 0.07296; 1.5510666; 215.40356|] 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2009-09-17T06:50:19.480

好的，这与片段无关，但我一直忘记这一点：

如果您在交互式窗口中，您点击`F7`跳回代码窗口（不取消选择您刚刚运行的代码......）

从代码窗口转到 F# 窗口（以及打开 F# 窗口）是`Ctrl` `Alt` `F`

（除非 CodeRush 偷了你的绑定......）

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2010-09-15T18:46:40.457

**F#、DataReaders 的 DataSetExtensions**

[System.Data.DataSetExtensions.dll](http://msdn.microsoft.com/en-us/library/system.data.datarowextensions.aspx)添加了将 a`DataTable`视为 a`IEnumerable<DataRow>`以及以`DBNull`通过支持 System.Nullable 来优雅处理的方式对单个单元格的值进行拆箱的能力。例如，在 C# 中，我们可以获取包含空值的整数列的值，并使用`DBNull`非常简洁的语法指定默认为零：

```
var total = myDataTable.AsEnumerable()
                       .Select(row => row.Field<int?>("MyColumn") ?? 0)
                       .Sum(); 
```

但是，有两个领域缺少 DataSetExtensions。一是不支持`IDataReader`，二是不支持F#`option`类型。以下代码两者兼而有之 - 它允许将`IDataReader`a 视为 a `seq<IDataRecord>`，并且它可以从读取器或数据集中拆箱值，并支持 F# 选项或 System.Nullable。结合[另一个 answer 中](https://stackoverflow.com/questions/833180/handy-f-snippets/3720546#3720546)的选项合并运算符，这允许在使用 DataReader 时使用如下代码：

```
let total =
    myReader.AsSeq
    |> Seq.map (fun row -> row.Field<int option>("MyColumn") |? 0)
    |> Seq.sum 
```

也许忽略数据库空值的更惯用的 F# 方式是......

```
let total =
    myReader.AsSeq
    |> Seq.choose (fun row -> row.Field<int option>("MyColumn"))
    |> Seq.sum 
```

此外，下面定义的扩展方法可用于 F# 和 C#/VB。

```
open System
open System.Data
open System.Reflection
open System.Runtime.CompilerServices
open Microsoft.FSharp.Collections

/// Ported from System.Data.DatasetExtensions.dll to add support for the Option type.
[<AbstractClass; Sealed>]
type private UnboxT<'a> private () =

    // This class generates a converter function based on the desired output type,
    // and then re-uses the converter function forever. Because the class itself is generic,
    // different output types get different cached converter functions.

    static let referenceField (value:obj) =
        if value = null || DBNull.Value.Equals(value) then
            Unchecked.defaultof<'a>
        else
            unbox value

    static let valueField (value:obj) =
        if value = null || DBNull.Value.Equals(value) then
            raise <| InvalidCastException("Null cannot be converted to " + typeof<'a>.Name)
        else
            unbox value

    static let makeConverter (target:Type) methodName =
        Delegate.CreateDelegate(typeof<Converter<obj,'a>>,
                                typeof<UnboxT<'a>>
                                    .GetMethod(methodName, BindingFlags.NonPublic ||| BindingFlags.Static)
                                    .MakeGenericMethod([| target.GetGenericArguments().[0] |]))
        |> unbox<Converter<obj,'a>>
        |> FSharpFunc.FromConverter

    static let unboxFn =
        let theType = typeof<'a>
        if theType.IsGenericType && not theType.IsGenericTypeDefinition then
            let genericType = theType.GetGenericTypeDefinition()
            if typedefof<Nullable<_>> = genericType then
                makeConverter theType "NullableField"
            elif typedefof<option<_>> = genericType then
                makeConverter theType "OptionField"
            else
                invalidOp "The only generic types supported are Option<T> and Nullable<T>."
        elif theType.IsValueType then
            valueField
        else
            referenceField

    static member private NullableField<'b when 'b : struct and 'b :> ValueType and 'b:(new:unit -> 'b)> (value:obj) =
        if value = null || DBNull.Value.Equals(value) then
            Nullable<_>()
        else
            Nullable<_>(unbox<'b> value)

    static member private OptionField<'b> (value:obj) =
        if value = null || DBNull.Value.Equals(value) then
            None
        else
            Some(unbox<'b> value)

    static member inline Unbox =
        unboxFn

/// F# data-related extension methods.
[<AutoOpen>]
module FsDataEx =

    type System.Data.IDataReader with

        /// Exposes a reader's current result set as seq<IDataRecord>.
        /// Reader is closed when sequence is fully enumerated.
        member this.AsSeq =
            seq { use reader = this
                  while reader.Read() do yield reader :> IDataRecord }

        /// Exposes all result sets in a reader as seq<seq<IDataRecord>>.
        /// Reader is closed when sequence is fully enumerated.
        member this.AsMultiSeq =
            let rowSeq (reader:IDataReader)  =
                seq { while reader.Read() do yield reader :> IDataRecord }
            seq {
                use reader = this
                yield rowSeq reader
                while reader.NextResult() do
                    yield rowSeq reader
            }

        /// Populates a new DataSet with the contents of the reader. Closes the reader after completion.
        member this.ToDataSet () =
            use reader = this
            let dataSet = new DataSet(RemotingFormat=SerializationFormat.Binary, EnforceConstraints=false)
            dataSet.Load(reader, LoadOption.OverwriteChanges, [| "" |])
            dataSet

    type System.Data.IDataRecord with

        /// Gets a value from the record by name. 
        /// DBNull and null are returned as the default value for the type.
        /// Supports both nullable and option types.
        member this.Field<'a> (fieldName:string) =
            this.[fieldName] |> UnboxT<'a>.Unbox

        /// Gets a value from the record by column index. 
        /// DBNull and null are returned as the default value for the type.
        /// Supports both nullable and option types.
        member this.Field<'a> (ordinal:int) =
            this.GetValue(ordinal) |> UnboxT<'a>.Unbox

    type System.Data.DataRow with

        /// Identical to the Field method from DatasetExtensions, but supports the F# Option type.
        member this.Field2<'a> (columnName:string) =
            this.[columnName] |> UnboxT<'a>.Unbox

        /// Identical to the Field method from DatasetExtensions, but supports the F# Option type.
        member this.Field2<'a> (columnIndex:int) =
            this.[columnIndex] |> UnboxT<'a>.Unbox

        /// Identical to the Field method from DatasetExtensions, but supports the F# Option type.
        member this.Field2<'a> (column:DataColumn) =
            this.[column] |> UnboxT<'a>.Unbox

        /// Identical to the Field method from DatasetExtensions, but supports the F# Option type.
        member this.Field2<'a> (columnName:string, version:DataRowVersion) =
            this.[columnName, version] |> UnboxT<'a>.Unbox

        /// Identical to the Field method from DatasetExtensions, but supports the F# Option type.
        member this.Field2<'a> (columnIndex:int, version:DataRowVersion) =
            this.[columnIndex, version] |> UnboxT<'a>.Unbox

        /// Identical to the Field method from DatasetExtensions, but supports the F# Option type.
        member this.Field2<'a> (column:DataColumn, version:DataRowVersion) =
            this.[column, version] |> UnboxT<'a>.Unbox

/// C# data-related extension methods.
[<Extension; AbstractClass; Sealed>]
type CsDataEx private () =

    /// Populates a new DataSet with the contents of the reader. Closes the reader after completion.
    [<Extension>]    
    static member ToDataSet(this:IDataReader) =
        this.ToDataSet()

    /// Exposes a reader's current result set as IEnumerable{IDataRecord}.
    /// Reader is closed when sequence is fully enumerated.
    [<Extension>]
    static member AsEnumerable(this:IDataReader) =
        this.AsSeq

    /// Exposes all result sets in a reader as IEnumerable{IEnumerable{IDataRecord}}.
    /// Reader is closed when sequence is fully enumerated.
    [<Extension>]
    static member AsMultipleEnumerable(this:IDataReader) =
        this.AsMultiSeq

    /// Gets a value from the record by name. 
    /// DBNull and null are returned as the default value for the type.
    /// Supports both nullable and option types.
    [<Extension>]
    static member Field<'T> (this:IDataRecord, fieldName:string) =
        this.Field<'T>(fieldName)

    /// Gets a value from the record by column index. 
    /// DBNull and null are returned as the default value for the type.
    /// Supports both nullable and option types.
    [<Extension>]
    static member Field<'T> (this:IDataRecord, ordinal:int) =
        this.Field<'T>(ordinal) 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2009-09-25T06:59:14.640

**在命令行应用程序中**处理参数：****

 **```
//We assume that the actual meat is already defined in function 
//    DoStuff (string -> string -> string -> unit)
let defaultOutOption = "N"
let defaultUsageOption = "Y"

let usage =  
      "Scans a folder for and outputs results.\n" +
      "Usage:\n\t MyApplication.exe FolderPath [IncludeSubfolders (Y/N) : default=" + 
      defaultUsageOption + "] [OutputToFile (Y/N): default=" + defaultOutOption + "]"

let HandlArgs arr = 
    match arr with
        | [|d;u;o|] -> DoStuff d u o
        | [|d;u|] -> DoStuff d u defaultOutOption 
        | [|d|] -> DoStuff d defaultUsageOption defaultOutOption 
        | _ ->  
            printf "%s" usage
            Console.ReadLine() |> ignore

[<EntryPoint>]
let main (args : string array) = 
    args |> HandlArgs
    0 
```

（我对受[Robert Pickering](http://strangelights.com/blog/Default.aspx)启发的这项技术有一个模糊的记忆，但现在找不到参考资料）

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2010-01-27T07:00:45.057

**创建 XElement**

没什么了不起的，但我一直被 XNames 的隐式转换所吸引：

```
#r "System.Xml.Linq.dll"
open System.Xml.Linq

//No! ("type string not compatible with XName")
//let el = new XElement("MyElement", "text") 

//better
let xn s = XName.op_Implicit s
let el = new XElement(xn "MyElement", "text")

//or even
let xEl s o = new XElement(xn s, o)
let el = xEl "MyElement" "text" 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2010-02-16T07:03:09.673

**成对和成对**

我总是希望 Seq.pairwise 给我 [(1,2);(3;4)] 而不是 [(1,2);(2,3);(3,4)]。鉴于 List 中都不存在，并且我需要两者，这是供将来参考的代码。我[*认为*它们是尾递归](https://stackoverflow.com/questions/806712/how-do-i-know-if-a-function-is-tail-recursive-in-f)的。

```
//converts to 'windowed tuples' ([1;2;3;4;5] -> [(1,2);(2,3);(3,4);(4,5)])
let pairwise lst = 
    let rec loop prev rem acc = 
       match rem with
       | hd::tl -> loop hd tl ((prev,hd)::acc)
       | _ -> List.rev acc
    loop (List.head lst) (List.tail lst) []

//converts to 'paged tuples' ([1;2;3;4;5;6] -> [(1,2);(3,4);(5,6)])    
let pairs lst = 
    let rec loop rem acc = 
       match rem with
       | l::r::tl -> loop tl ((l,r)::acc)
       | l::[] -> failwith "odd-numbered list" 
       | _ -> List.rev acc
    loop lst [] 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2009-05-10T13:35:57.287

**一个方便的缓存功能**，可以保存`max` `(key,reader(key))`在字典中并使用 a`SortedList`来跟踪 MRU 键

```
let Cache (reader: 'key -> 'value) max = 
        let cache = new Dictionary<'key,LinkedListNode<'key * 'value>>()
        let keys = new LinkedList<'key * 'value>()

        fun (key : 'key) -> ( 
                              let found, value = cache.TryGetValue key
                              match found with
                              |true ->
                                  keys.Remove value
                                  keys.AddFirst value |> ignore
                                  (snd value.Value)

                              |false -> 
                                  let newValue = key,reader key
                                  let node = keys.AddFirst newValue
                                  cache.[key] <- node

                                  if (keys.Count > max) then
                                    let lastNode = keys.Last
                                    cache.Remove (fst lastNode.Value) |> ignore
                                    keys.RemoveLast() |> ignore

                                  (snd newValue)) 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2010-09-21T21:56:39.087

**日期范围**

`fromDate`和之间的简单但有用的日期列表`toDate`

```
let getDateRange  fromDate toDate  =

    let rec dates (fromDate:System.DateTime) (toDate:System.DateTime) = 
        seq {
            if fromDate <= toDate then 
                yield fromDate
                yield! dates (fromDate.AddDays(1.0)) toDate
            }

    dates fromDate toDate
    |> List.ofSeq 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2010-09-24T01:20:39.240

**将代码切换到 sql**

比这个列表中的大多数都微不足道，但仍然很方便：

在开发过程中，我总是将 sql 进出代码以将其移动到 sql 环境中。例子：

```
let sql = "select a,b,c "
    + "from table "
    + "where a = 1" 
```

需要“剥离”到：

```
select a,b,c
from table
where a = 1 
```

保持格式。去掉 sql 编辑器的代码符号，然后在我弄好 sql 时再手动放回去，这很痛苦。这两个函数来回切换 sql 从代码到剥离：

```
// reads the file with the code quoted sql, strips code symbols, dumps to FSI
let stripForSql fileName = 
    File.ReadAllText(fileName)
    |> (fun s -> Regex.Replace(s, "\+(\s*)\"", "")) 
    |> (fun s -> s.Replace("\"", ""))
    |> (fun s -> Regex.Replace(s, ";$", "")) // end of line semicolons
    |> (fun s -> Regex.Replace(s, "//.+", "")) // get rid of any comments
    |> (fun s -> printfn "%s" s) 
```

然后当您准备好将其放回代码源文件时：

```
let prepFromSql fileName = 
    File.ReadAllText(fileName)
    |> (fun s -> Regex.Replace(s, @"\r\n", " \"\r\n+\"")) // matches newline 
    |> (fun s -> Regex.Replace(s, @"\A", " \"")) 
    |> (fun s -> Regex.Replace(s, @"\z", " \"")) 
    |> (fun s -> printfn "%s" s) 
```

我很想**摆脱**输入文件，但甚至无法开始了解如何做到这一点。任何人？

**编辑：**

我想出了如何通过添加 Windows 窗体对话框输入/输出来消除对这些功能的文件要求。代码太多要显示，但是对于那些想做这样的事情的人，这就是我解决它的方法。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2009-09-25T07:29:11.523

**天真的 CSV 阅读器**（即，不会处理任何讨厌的事情）

*（在这里使用其他答案中的 filereadlines 和 List.transpose ）*

```
///Given a file path, returns a List of row lists
let ReadCSV = 
        filereadlines
            >> Array.map ( fun line -> line.Split([|',';';'|]) |> List.ofArray )
            >> Array.toList

///takes list of col ids and list of rows, 
///   returns array of columns (in requested order)
let GetColumns cols rows = 
    //Create filter
    let pick cols (row:list<'a>) = List.map (fun i -> row.[i]) cols

    rows 
        |> transpose //change list of rows to list of columns
        |> pick cols      //pick out the columns we want
        |> Array.ofList  //an array output is easier to index for user 
```

例子

```
"C:\MySampleCSV"
   |> ReadCSV
   |> List.tail //skip header line
   |> GetColumns [0;3;1]  //reorder columns as well, if needs be. 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-11-19T18:27:28.507

**帕斯卡三角（嘿，有人可能会觉得它有用）**

所以我们想创建一个像这样的东西：

```
 1
      1 1
     1 2 1
    1 3 3 1
   1 4 6 4 1 
```

很简单：

```
let rec next = function
    | [] -> []
    | x::y::xs -> (x + y)::next (y::xs)
    | x::xs -> x::next xs

let pascal n =
    seq { 1 .. n }
    |> List.scan (fun acc _ -> next (0::acc) ) [1] 
```

该`next`函数返回一个新列表，其中每个 item[i] = item[i] + item[i + 1]。

这是 fsi 中的输出：

```
> pascal 10 |> Seq.iter (printfn "%A");;
[1]
[1; 1]
[1; 2; 1]
[1; 3; 3; 1]
[1; 4; 6; 4; 1]
[1; 5; 10; 10; 5; 1]
[1; 6; 15; 20; 15; 6; 1]
[1; 7; 21; 35; 35; 21; 7; 1]
[1; 8; 28; 56; 70; 56; 28; 8; 1]
[1; 9; 36; 84; 126; 126; 84; 36; 9; 1]
[1; 10; 45; 120; 210; 252; 210; 120; 45; 10; 1] 
```

对于喜欢冒险的人，这里有一个尾递归版本：

```
let rec next2 cont = function
    | [] -> cont []
    | x::y::xs -> next2 (fun l -> cont <| (x + y)::l ) <| y::xs
    | x::xs -> next2 (fun l -> cont <| x::l ) <| xs

let pascal2 n =
    set { 1 .. n }
    |> Seq.scan (fun acc _ -> next2 id <| 0::acc)) [1] 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2010-10-12T20:21:19.733

**展平列表**

如果你有这样的事情：

```
let listList = [[1;2;3;];[4;5;6]] 
```

并希望将其“展平”为单个列表，因此结果如下：

```
[1;2;3;4;5;6] 
```

可以这样做：

```
let flatten (l: 'a list list) =
    seq {
            yield List.head (List.head l) 
            for a in l do yield! (Seq.skip 1 a) 
        } 

    |> List.ofSeq 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2011-03-25T08:05:59.690

**浮点数的列表推导**

这`[23.0 .. 1.0 .. 40.0]`被标记为已弃用，有几个版本支持。

但显然，这有效：

```
let dl = 9.5 / 11.
let min = 21.5 + dl
let max = 40.5 - dl

let a = [ for z in min .. dl .. max -> z ]
let b = a.Length 
```

*（顺便说一句，那里有一个浮点陷阱。在[fssnip](http://fssnip.net/3H)发现- F# 片段的另一个地方）*

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2010-10-13T21:30:45.793

将记录设置为空

```
type Foo = { x : int }
let inline retype (x:'a) : 'b = (# "" x : 'b #)
let f : Foo = retype null 
```

* * *

## 回答 #31

> 赞同：-2
> 
> 时间：2009-09-25T13:08:25.593

**平行图**

```
let pmap f s =
    seq { for a in s -> async { return f s } }
    |> Async.Parallel
    |> Async.Run 
```

# haskell - 为什么这个 Haskell 代码可以成功地处理无限列表？

> ID：833186
> 
> 赞同：35
> 
> 时间：2009-05-07T06:39:18.010
> 
> 标签：haskell, functional-programming, infinite, fold

我有一些 Haskell 代码可以在无限列表上正常工作，但我不明白*为什么**它*可以成功。（我修改了我的原始代码 - 没有处理无限列表 - 以合并来自其他在线代码的内容，突然我发现它可以工作但不知道为什么）。

```
myAny :: (a -> Bool) -> [a] -> Bool
myAny p list = foldr step False list
   where
      step item acc = p item || acc 
```

我对 foldr 的理解是它将遍历列表中的每个项目（也许这种理解是不完整的）。如果是这样，那么“step”函数的措辞应该无关紧要......代码应该无法处理无限循环。

但是，以下工作：

```
*Main Data.List> myAny even [1..]
True 
```

请帮助我理解：为什么？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-05-07T06:52:05.140

让我们对 Haskell 将如何评估您的表达式进行一些跟踪。在每一行上用 equals 替换 equals，表达式很快就会计算为 True：

```
myAny even [1..]
foldr step False [1..]
step 1 (foldr step False [2..])
even 1 || (foldr step False [2..])
False  || (foldr step False [2..])
foldr step False [2..]
step 2 (foldr step False [3..])
even 2 || (foldr step False [3..])
True   || (foldr step false [3..])
True 
```

这是有效的，因为`acc`它作为未评估的 thunk（惰性评估）传递，还因为该函数在其**第一个**参数`||`中是严格的。

 **所以这终止：

```
True || and (repeat True) 
```

但这不会：

```
and (repeat True) || True 
```

看||的定义 看看为什么会这样：

```
True  || _ =  True
False || x =  x 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-05-07T07:40:01.157

> 我对 foldr 的理解是它将遍历列表中的每个项目（也许这种理解是不完整的）。

`foldr`（不像`foldl`）不必遍历列表的每个项目。看看如何`foldr`定义是有启发性的。

```
foldr f z []     = z
foldr f z (x:xs) = f x (foldr f z xs) 
```

评估调用时`foldr`，它会强制评估对函数的调用`f`。但请注意递归调用`foldr`是如何嵌入到函数的参数中的`f`。`f`如果不评估其第二个参数，则不会评估该递归调用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T06:43:31.713

这里的关键是 Haskell 是一种非严格的语言。“非严格”意味着它允许非严格函数，这反过来意味着函数参数在使用之前可能不会被完全评估。这显然允许延迟评估，这是“一种延迟计算直到需要结果的技术”。

从[这篇 Wiki 文章开始](http://en.wikipedia.org/wiki/Non-strict_programming_language)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T06:44:09.950

我不知道 Haskell，但我怀疑在你的情况下，它是因为惰性评估而起作用的。因为它允许您无限长地使用列表，所以当您访问它时，它将根据您的需要计算结果。

见[http://en.wikipedia.org/wiki/Lazy_evaluation](http://en.wikipedia.org/wiki/Lazy_evaluation)

# java - 如何使用 HTTP (Tomcat) 创建超过 14000 个客户端，而 HTTP 通过 TCP 工作，因此创建了套接字

> ID：833194
> 
> 赞同：1
> 
> 时间：2009-05-07T06:41:43.247
> 
> 标签：java, sockets

HTTP 协议通过 TCP/IP 工作。所以事实上我们可以说，如果我们连接一个客户端，那么无论是 TCP 还是 HTTP，都会创建一个套接字，从而创建一个文件。Tomcat 在 HTTP 上工作。

在 TCP 上，我可以同时创建 1024 个客户端。如果我创建更多客户端，则会收到太多文件打开错误。但是使用 Tomcat 我可以创建超过 14000 个客户端。

如果我使用 Tomcat，那么我不会使用 ulimit 来增加我的操作系统的文件限制。

怎么可能？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T07:01:01.143

我的猜测是，要么...

1.  您正在使用 ulimit 高于 1024 的用户（而不是受限的交互式 shell）运行 tomcat
2.  您的 startup.sh 脚本中有一个 ulimit 语句。

想知道是不是后者...

```
grep ulimit ./bin/* 
```

另外，告诉我们您是如何启动 tomcat 的，我们将深入了解这一点！要查看您的 tomcat 在哪个用户下运行，请尝试以下操作...

```
ps aux | grep tomcat | cut -d " " -f 1 
```

输出将显示使用用户名和进程 ID。我敢打赌，这与您正在运行的情况不同。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T06:45:48.777

允许进程使用的文件描述符的数量是有限制的。在 Unix 系统上，套接字使用文件描述符。

要超过文件描述符的 1024 个限制，您可以使用*ulimit*命令。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T06:46:30.663

这是您的操作系统可以打开多少资源的限制。在 *NIX 中，您可以使用 ulimit ( [http://www.ss64.com/bash/ulimit.html](http://www.ss64.com/bash/ulimit.html) ) 控制这些限制

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T17:25:21.860

当你说“使用 Tomcat 我可以创建超过 14000 个客户端”时，“客户端”到底是什么意思？

您的应用程序是否有可能模拟 14000 个并发*用户*（例如，每个用户可能每 10 秒向服务器发出 1 个 HTTP 请求，每个请求需要 0.01 秒，因此在任何给定时间，tomcat 只需要约 14 个并发连接？

using`netstat -n|grep 8080`将列出到您的 tomcat 的所有活动 HTTP 连接（假设您正在侦听端口 8080，如果没有，请调整以适应）。这应该让您看到您真正使用了多少 TCP 连接。

你能发布更多关于你的负载测试程序实际做什么的细节吗？这可能有助于理解你所看到的。

# file - 选择多个文件时如何启动关联程序？

> ID：833199
> 
> 赞同：1
> 
> 时间：2009-05-07T06:43:50.230
> 
> 标签：file, associations

我已经设置了与我自己的程序相关联的 .jpg 文件。我想将上下文菜单添加到 .jpg 文件中，所以我将 HKCR.jpg\shell\open\command 的条目设置为“myProg.exe %1”。关联后，上下文菜单顶部会有一个项目，显示“使用 myprog 打开图像”。当我选择一个 .jpg 文件时，这很有效，但是当我选择多个文件并单击上下文菜单的顶部项目时，什么也没有发生。我该如何解决这个问题？

非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T07:11:53.627

每个选定的文件都将发送到您的应用程序的一个新实例。您的应用程序应检查是否存在以前的版本。如果先前的实例存在，它应该将其参数发送给它（例如，使用 Windows 消息）然后终止。

另一种方法是使用 DDE（[动态数据交换](http://msdn.microsoft.com/en-us/library/ms648711(VS.85).aspx)），这是 Shell 用来将所有文件发送到程序的一个实例的旧方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T07:19:10.037

您可能需要在 "%1" 周围加上双引号。

阅读这篇文章，了解更多关于这一切如何运作的详细信息。 [http://msdn.microsoft.com/en-us/library/bb776883.aspx](http://msdn.microsoft.com/en-us/library/bb776883.aspx)

此外，此博客条目还讨论了您需要专门为执行多选命令执行的操作：http: [//blogs.msdn.com/pix/archive/2006/06/30/652889.aspx](http://blogs.msdn.com/pix/archive/2006/06/30/652889.aspx)

# hibernate - Hibernate Search - 默认情况下如何列出所有记录

> ID：833201
> 
> 赞同：3
> 
> 时间：2009-05-07T06:45:14.003
> 
> 标签：hibernate

我正在使用休眠搜索。

我的 jsp 页面中有一个搜索文本框。如果我输入一些文本，它会返回正确的结果。但是如果我留下空消息并单击搜索按钮，它没有返回任何记录。

**代码：**

```
Session session = HibernateUtil.getSessionFactory().getCurrentSession();
session.beginTransaction();

String searchQuery = "Admin";
String[] userFields = {"firstName", "lastName", "role_groupName", "userId"};
QueryParser parser = new MultiFieldQueryParser(userFields, new StandardAnalyzer());
org.apache.lucene.search.Query luceneQuery;
try
{
    luceneQuery = parser.parse(searchQuery);
}
catch (ParseException e) 
{
    throw new RuntimeException("Unable to parse query: " + searchQuery, e);
}

FullTextSession ftSession = Search.getFullTextSession(session);
org.hibernate.Query query = ftSession.createFullTextQuery(luceneQuery, UserVO.class);

List results = query.list();
System.out.println("Result size:" + results.size()); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2014-07-14T10:42:37.950

AllContext org.hibernate.search.query.dsl.QueryBuilder.all()

查询匹配所有文档（通常与布尔查询混合）。

这是您需要使用的方法

这是您的问题的示例代码

```
@Test
public void testSearchUsingQueryBuilder() {
    FullTextSession fullTextSession = org.hibernate.search.Search
            .getFullTextSession(sessionFactory.getCurrentSession());
    QueryBuilder builder = fullTextSession.getSearchFactory()
            .buildQueryBuilder().forEntity(Country.class).get();
    org.apache.lucene.search.Query query = builder.all().createQuery();
    FullTextQuery jpaQuery = fullTextSession.createFullTextQuery(query,
            Country.class);
    System.out.println("Before HQL =" + startDate);
    List<Country> tempCountry = jpaQuery.list();
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-20T05:03:12.803

如果搜索文本框为空，我只输入“*”。以便它返回所有记录。现在它对我来说工作正常。这是我的代码。

```
try
{
    if(searchText == null || searchText.trim().length()==0)
    {
        searchText = "*";
    }
        luceneQuery = parser.parse(searchText);
    }
    catch (ParseException e)
    {
        throw new RuntimeException("Unable to parse query: " + searchText, e);
    } 
```

# iphone - iPhone 没有在 iPhone 上创建的已保存相册

> ID：833210
> 
> 赞同：1
> 
> 时间：2009-05-07T06:48:17.380
> 
> 标签：iphone, cocoa-touch, macos

我正在使用 iPhone 2.0 SDK。我使用 API UIImageWriteToSavedPhotosAlbum 来保存图像。当我保存图像时，会在 iPhone 模拟器上创建已保存的照片相册，但在设备上进行测试，图像会添加到相机胶卷相册中。调试时，没有出现错误，但未在设备上创建“已保存的照片”相册。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-28T20:20:31.353

这只是模拟器（和我想象 iPod touch）和 iPhone 之间的不同命名约定。由于 iPhone 有摄像头，因此保存的相册称为“相机胶卷”。由于模拟器没有相机，保存的相册称为“保存的照片”（或其他）。

使用 UIImageWriteToSavedPhotosAlbum() 应该将照片写入相应的相册。

如果图像被保存到 iPhone 上的相机胶卷，那么您的代码工作正常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T14:25:37.377

根据您的设备，您可能必须改用照片库。尝试以下操作：

```
 UIImagePickerControllerSourceType sourceType = UIImagePickerControllerSourceTypeSavedPhotosAlbum;

if ([UIImagePickerController isSourceTypeAvailable:sourceType] == NO)
    sourceType = UIImagePickerControllerSourceTypePhotoLibrary;
if ([UIImagePickerController isSourceTypeAvailable:sourceType] == YES)
{
    // acquire image
} 
```

# java - 用于构建 SQL 前端 GUI 的 Java 库\应用程序

> ID：833212
> 
> 赞同：1
> 
> 时间：2009-05-07T06:48:57.990
> 
> 标签：java, sql, swing, swt

有谁知道允许通过Java GUI（例如Swing 或SWT）进行SQL 前端操作的Java 库或应用程序？

我正在寻找类似于 ASP .Net Datagrid 的东西，您基本上可以在其中“插入”查询，设置一些东西，瞧！

我已经使用了相当多的 Spring JDBC，并且一直在使用 JDBC 模板来尝试构建一个通用项目来执行此操作 - 但看起来我所做的事情之前已经完成了，尽管更优雅:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T06:51:18.637

你知道松鼠吗？

[http://squirrel-sql.sourceforge.net/](http://squirrel-sql.sourceforge.net/)

# database - 在 Linux/POSIX 系统上获取用户全名的最简单方法是什么？

> ID：833227
> 
> 赞同：41
> 
> 时间：2009-05-07T06:55:27.287
> 
> 标签：database, linux, shell, posix, user-accounts

我可以通过 /etc/passwd grep 但这似乎很麻烦。'finger' 没有安装，我想避免这种依赖。这是一个程序，所以如果有一些命令可以让您访问用户信息，那就太好了。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-05-07T07:07:03.593

你没有指定编程语言，所以我假设你想使用 shell；这是**Posix shells 的答案**。

两个步骤：获取适当的记录，然后从该记录中获取您想要的字段。

首先，通过**查询`passwd`表**来获取账户记录：

```
$ user_name=foo
$ user_record="$(getent passwd $user_name)"
$ echo "$user_record"
foo:x:1023:1025:Fred Nurk,,,:/home/foo:/bin/bash 
```

对于歇斯底里的葡萄干，用户的全名记录在一个名为**[“GECOS”的字段中](http://en.wikipedia.org/wiki/Gecos_field)**；更复杂的是，这个字段通常有自己的结构，**全名只是几个可选子字段之一**。所以任何想要从账户记录中获取全名的东西都需要解析这两个级别。

```
$ user_record="$(getent passwd $user_name)"
$ user_gecos_field="$(echo "$user_record" | cut -d ':' -f 5)"
$ user_full_name="$(echo "$user_gecos_field" | cut -d ',' -f 1)"
$ echo "$user_full_name"
Fred Nurk 
```

您的**编程语言可能有一个库函数**，可以用更少的步骤完成此操作。在 C 中，您将使用“getpwnam”函数，然后解析 GECOS 字段。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-05-07T06:58:54.313

在现代 glibc 系统上，使用以下命令：

```
getent passwd "username" | cut -d ':' -f 5 
```

这将为您`passwd`提供指定用户的条目，与底层 NSS 模块无关。

阅读. [_`getent`](http://unixhelp.ed.ac.uk/CGI/man-cgi?getent)

* * *

如果您已经在编程，则可以使用`getpwnam()`C-Function：

```
struct passwd *getpwnam(const char *name); 
```

该`passwd`结构有一个`pw_gecos`成员，该成员应包含用户的全名。

阅读. [_`getpwnam()`](http://linux.die.net/man/3/getpwnam)

* * *

请注意，许多系统使用此字段的目的不仅仅是用户的全名。最常见的约定是`,`在字段中使用逗号 () 作为分隔符，并将用户的真实姓名放在首位。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-07T07:13:42.297

万一您想从 C 中执行此操作，请尝试以下操作：

```
#include <sys/types.h>
#include <pwd.h>
#include <errno.h>
#include <stdio.h>
#include <string.h>

/* Get full name of a user, given their username. Return 0 for not found,
   -1 for error, or 1 for success. Copy name to `fullname`, but only up
   to max-1 chars (max includes trailing '\0'). Note that if the GECOS
   field contains commas, only up to to (but not including) the first comma
   is copied, since the commas are a convention to add more than just the
   name into the field, e.g., room number, phone number, etc. */
static int getfullname(const char *username, char *fullname, size_t max)
{
    struct passwd *p;
    size_t n;

    errno = 0;
    p = getpwnam(username);
    if (p == NULL && errno == 0)
        return 0;
    if (p == NULL)
        return -1;
    if (max == 0)
        return 1;
    n = strcspn(p->pw_gecos, ",");
    if (n > max - 1)
        n = max - 1;
    memcpy(fullname, p->pw_gecos, n);
    fullname[n] = '\0';
    return 1;
}

int main(int argc, char **argv)
{
    int i;
    int ret;
    char fullname[1024];

    for (i = 1; i < argc; ++i) {
        ret = getfullname(argv[i], fullname, sizeof fullname);
        if (ret == -1)
            printf("ERROR: %s: %s\n", argv[i], strerror(errno));
        else if (ret == 0)
            printf("UNKONWN: %s\n", argv[i]);
        else
            printf("%s: %s\n", argv[i], fullname);
    }
    return 0;
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-09-18T15:37:57.057

其他答案的组合，在最小的 Debian/Ubuntu 安装上进行了测试：

```
getent passwd "$USER" | cut -d ':' -f 5 | cut -d ',' -f 1 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-07-07T09:11:14.690

试试这个：

```
getent passwd eutl420 | awk -F':' '{gsub(",", "",$5); print $5}' 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-08-02T11:43:31.247

前两个答案可以合并为一行：

```
getent passwd <username> | cut -d ':' -f 5 | cut -d ',' -f 1 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-08-15T09:20:24.400

我的代码适用于 bash 和 ksh，但不适用于 dash 或旧的 Bourne shell。它也会读取其他字段，以防您可能需要它们。

```
IFS=: read user x uid gid gecos hm sh < <( getent passwd $USER )
name=${gecos%%,*}
echo "$name" 
```

您还可以扫描整个 /etc/passwd 文件。这在普通的 Bourne shell 中工作，在 1 个进程中，但与 LDAP 或其他的没有那么多。

```
while IFS=: read user x uid gid gecos hm sh; do
  name=${gecos%%,*}
  [ $uid -ge 1000 -a $uid -lt 60000 ] && echo "$name"
done < /etc/passwd 
```

另一方面，使用工具是好的。C也不错。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-10-05T06:50:48.947

最近的 Linux/POSIX 发行版包括返回用户身份的[`id`实用程序。](https://man7.org/linux/man-pages/man1/id.1.html)如果使用该选项调用，`-F`它将返回全名：

```
$ id -F
Mickey Mouse 
```

与往常一样，BSD 变体比 GNU 变体更节俭。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-07-31T06:25:57.317

我在 Linux 上将全名放入变量中的方法是：

```
u_id=`id -u`
uname=`awk -F: -vid=$u_id '{if ($3 == id) print $5}' /etc/passwd` 
```

然后只需简单地使用变量，例如：`$ echo $uname`

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2013-11-10T11:56:50.617

取1：

```
$ user_name=sshd
$ awk -F: "\$1 == \"$user_name\" { print \$5 }" /etc/passwd
Secure Shell Daemon 
```

但是，passwd 数据库支持 gecos 中的特殊字符 '&'，应将其替换为用户名的大写值：

```
$ user_name=operator
$ awk -F: "\$1 == \"$user_name\" { print \$5 }" /etc/passwd
System & 
```

这里的大多数答案（除了手指解决方案）都不尊重 &。如果你想支持这种情况，那么你需要一个更复杂的脚本。

取2：

```
$ user_name=operator
$ awk -F: "\$1 == \"$user_name\" { u=\$1; sub(/./, toupper(substr(u,1,1)), u);
    gsub(/&/, u, \$5); print \$5 }" /etc/passwd
System Operator 
```

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2012-09-13T00:35:52.180

好的老*手指*也可能有帮助:-)

```
finger $USER |head -n1 |cut -d : -f3 
```

# windows - 64 位大型 malloc

> ID：833234
> 
> 赞同：18
> 
> 时间：2009-05-07T06:58:42.833
> 
> 标签：windows, memory, 64-bit, malloc, virtual-memory

malloc() 失败的原因是什么，尤其是在 64 位中？

我的具体问题是试图在 64 位系统上分配 10GB 的巨大 RAM 块。这台机器有 12GB 的 RAM 和 32GB 的交换空间。是的，malloc 是极端的，但为什么会有问题呢？这是在带有 Intel 和 MSFT 编译器的 Windows XP64 中。malloc 有时会成功，有时不会，大约 50%。8GB malloc 总是有效，20GB malloc 总是失败。如果 malloc 失败，重复请求将不起作用，除非我退出该进程并再次启动一个新进程（然后将有 50% 的成功率）。没有其他大型应用程序正在运行。它甚至在重新启动后立即发生。

如果您用完了可用的 32（或 31）位地址空间，我可以想象 malloc 在 32 位中失败，这样就没有足够大的地址范围来分配给您的请求。

如果你用完了物理 RAM**和**硬盘交换空间，我也可以想象 malloc 会失败。这不是我的情况。

但是为什么 malloc 会失败呢？我想不出其他原因。

我对一般 malloc 问题比我的具体示例更感兴趣，无论如何我可能会用内存映射文件替换它。失败的 malloc() 比其他任何事情都更像是一个谜……渴望了解您的工具而不是对基本原理感到惊讶。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-07T07:18:19.103

malloc 尝试分配一个连续的内存范围，这最初将在实际内存中，这仅仅是由于交换内存的工作方式（至少据我所知）。很可能您的操作系统有时无法找到一个连续的 10gb 内存块，并且仍然将所有需要实际内存的进程同时留在 RAM 中（此时您的 malloc 将失败）。

您是否真的需要 10gb 的连续内存，或者您是否能够将存储类/结构包装在几个较小的块周围并以块的形式使用您的内存？这放宽了巨大的连续要求，并且还应该允许您的程序将交换文件用于较少使用的块。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T17:39:13.387

您是否尝试过直接使用[`VirtualAlloc()`](http://msdn.microsoft.com/en-us/library/aa366887(VS.85).aspx)和[`VirtualFree()`](http://msdn.microsoft.com/en-us/library/aa366892(VS.85).aspx)？这可能有助于隔离问题。

*   您将绕过 C 运行时堆和 NT 堆。
*   您可以保留虚拟地址空间，然后提交它。这将告诉您哪个操作失败。

如果虚拟地址空间保留失败（即使它不应该，根据您所说的判断），[Sysinternals VMMap](http://technet.microsoft.com/en-us/sysinternals/dd535533.aspx)可能有助于解释原因。打开“显示空闲区域”可以查看空闲虚拟地址空间是如何碎片化的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T07:20:17.790

这里只是一个猜测，但 malloc 分配连续内存，您的堆上可能没有足够大的连续部分。这是我会尝试的几件事；

如果 20GB malloc 失败，四个 5GB malloc 会成功吗？如果是这样，这是一个连续的空间问题。

您是否检查过编译器开关是否限制了总堆大小或最大堆块大小？

您是否尝试过编写一个声明所需大小的静态变量的程序？如果这可行，您可以在该空间中使用大型 malloc 实现您自己的堆。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T07:03:32.260

您是否尝试过使用[堆函数](http://msdn.microsoft.com/en-us/library/aa366711(VS.85).aspx)来分配内存？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-02T09:04:36.260

这是一个官方消息来源，声明堆的最大请求大小由您的链接 CRT 库定义（除了您之前的代码整数溢出变为 0，这就是您没有返回 NULL 的原因）（_HEAP_MAXREQ）。

[http://msdn.microsoft.com/en-us/library/6ewkz86d.aspx](http://msdn.microsoft.com/en-us/library/6ewkz86d.aspx)

[在此处](https://stackoverflow.com/questions/181050/can-you-allocate-a-very-large-single-chunk-of-memory-4gb-in-c-or-c/938579#938579)查看我对大窗口分配的回答，我包括对有关 Vista/2008 内存模型改进的 MS 论文的参考。

简而言之，即使对于原生 64 位进程，普通 CRT 也不支持任何大于 4gb 的堆大小。您*必须*使用 VirtualAlloc* 或 CreateFileMapping 或其他一些类似物。

哦，我还注意到您声称您的较大分配实际上是成功的，这实际上是不正确的，您误解了 malloc(0x200000000); （十六进制为 8gb），正在发生的事情是由于测试工具的强制转换或其他一些影响，您正在请求 0 字节分配，您绝对没有观察到任何大于 0xfffff000 字节堆的东西正在提交，它是只是你看到整数溢出向下转换。

**对 WYSE**说的话或 * 保存您的头脑清醒的提示*

## 使用 malloc（或任何其他动态请求）分配内存的***唯一方法***

```
void *foo = malloc(SIZE); 
```

## 决不能（我不能强调）在请求的“（）”括号内计算动态内存请求的值

```
mytype *foo = (mytype *) malloc(sizeof(mytype) * 2); 
```

危险是会发生**整数**溢出。

在调用时执行算术总是一个编码**错误，您****必须始终**在评估请求的语句之前计算要请求的数据的**总和。**

为什么这么糟糕？我们知道这是一个错误，因为在*请求*动态资源时，将来**一定**会有我们将*使用*该资源的时间点。

要使用我们所要求的，我们**必须**知道它有多大？（例如数组计数、类型大小等）。

这意味着，如果我们在资源请求的 () 中看到任何算术，这是一个错误，因为我们**必须***再次*复制该代码才能正确使用该数据。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-24T04:54:28.877

问题是 Visual Studio 在编译 64 位应用程序时没有定义 WIN64，它通常仍然保留 WIN32，这对于 64 位应用程序是错误的。这会导致运行时在定义时使用 32 位值`_HEAP_MAXREQ`，因此所有大的`malloc()`都将失败。如果您将您的项目（在项目属性下，预处理定义下）更改为 WIN64，那么非常大`malloc()`应该完全没有问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T14:01:38.307

很可能是碎片化。为简单起见，让我们举个例子。

内存由一个 12kb 模块组成。该内存在 MMU 中被组织成 1kb 的块。所以，你有 12 x 1kb 块。您的操作系统使用 100 字节，但这基本上是管理页表的代码。所以，你不能换掉它。然后，您的应用程序每个都使用 100 字节。

现在，只要您的操作系统和应用程序在运行（200 字节），您就已经使用了 200 字节的内存（占用 2kb 块）。正好留下 10kb 可用于`malloc()`.

现在，您从`malloc()`几个缓冲区开始 - A（900 字节）、B（200 字节）。然后，您释放 A。现在，您有 9.8kb 可用空间（非连续）。因此，您尝试使用`malloc()`C (9kb)。突然，你失败了。

尾部有 8.9k 连续，前端有 0.9k。您无法将第一个块重新映射到末尾，因为 B 延伸到第一个 1k 和第二个 1k 块。

您仍然可以`malloc()`使用单个 8kb 块。

当然，这个例子有点做作，但希望它有所帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-07T10:56:15.257

> 但是为什么 malloc 会失败呢？我想不出其他原因

正如之前多次暗示的那样，由于内存碎片

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-03-20T23:49:25.347

我发现这个问题很有趣，所以我尝试从理论上的 POV 进行研究：

在 64 位（由于芯片限制实际上 48 位可用，并且由于操作系统限制而更少（44 位？））您当然*不*应该受到虚拟内存碎片的限制，即缺乏连续的虚拟地址空间。原因是虚拟地址空间太大，用尽它是不切实际的。

此外，我们可以预期*物理*内存碎片不应该成为问题，因为虚拟内存意味着不需要连续的物理内存地址范围来满足分配请求。相反，它可以满足任何足够大的内存页集。

因此，您必须遇到*其他*问题：或适用于虚拟内存的其他一些限制。

Windows 上肯定存在的另一个限制是提交限制。更多信息：

[http://blogs.technet.com/b/markrussinovich/archive/2008/11/17/3155406.aspx](http://blogs.technet.com/b/markrussinovich/archive/2008/11/17/3155406.aspx)

可能存在其他可能的限制，例如实际实现如何与实际硬件一起工作的怪癖。想象一下，当尝试创建虚拟地址空间到物理地址空间的映射时，您用完了页表中的条目来进行虚拟地址映射......操作系统内存分配器代码是否关心处理这种不太可能发生的情况？也许不是...

您可以在此处阅读有关页表如何实际工作以进行虚拟地址转换的更多信息：

[http://en.wikipedia.org/wiki/Memory_management_unit](http://en.wikipedia.org/wiki/Memory_management_unit)

# php - 通过 PHP 编辑 PHP 文件以进行配置

> ID：833237
> 
> 赞同：0
> 
> 时间：2009-05-07T06:59:20.507
> 
> 标签：php, configuration-files

首先，我假设这不是坏习惯，因为各种流行的软件都使用这种方法，比如 SMF。

无论如何，所以我目前有这个代码：

```
<?php
// main visual config
$cfg['lang']    = 'en';

// paths
$path['admin']  = 'index.php?p=admin';
$path['admin2'] = 'zvfpcms/admin';
$path['root']   = 'zvfpcms';
$path['images'] = 'zvfpcms/img';
$path['css']    = 'zvfpcms/css';
$path['js']     = 'zvfpcms/js';
$path['pages']  = 'zvfpcms/pg';
?> 
```

问题是，我希望通过界面直接编辑 $cfg 变量。

这将如何实现？我认为替换字符串不是一个好主意，尤其是当我创建的未来 $cfg 变量有大量可能性（甚至无限）时。

或者，我是否必须满足于不同的方法......

答案赞赏！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T08:18:21.720

[Pear Config](http://pear.php.net/package/Config)将让您轻松地从不同的源读取和写入配置，包括 PHP 文件/数组。您可能需要移动`$cfg`到它自己的文件中并包含它，以便其他变量等不受影响。

您也可以自己使用[`var_export()`](http://php.net/var_export)然后覆盖文件来完成，同样您可能需要将变量移动到它自己的文件中。我认为这会比 Pear 类编写更混乱/可读性更低的 PHP。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T07:06:57.570

将设置存储在数据库中，或者您可以使用标准的 ini 文件（键=值对）；

```
lang=en
timezone=CET 
```

阅读它们：

```
function loadSettings() {
    $cfg = array();
    foreach (file('settings.ini') as $line) {
        list ($key, $value) = explode('=', $line);
        $cfg[$key] = $value;
    }
    return $cfg;
} 
```

文件 I/O 的效率低于标准数据库调用，尤其是在您已经与数据库建立开放连接的情况下。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T07:32:45.013

我认为这是不好的做法的原因是因为您可以在编辑之前有一个正在运行的系统，在编辑中有一些错误（也许您没有转义单引号字符）并且在编辑之后整个应用程序变得不可用，因为PHP 无法解析配置文件，这几乎会影响您所做的一切。

XML 建议不错，因为您可以处理读取 XML 时发生的任何错误。

如果您有一个数据库（阅读这篇文章，您似乎没有使用数据库，这很好），那将是存储数据的最佳位置 - 这就是它的用途。在平面文件的世界中，读取非 PHP 文件并对其进行解释比自己自动编辑 PHP 文件要好得多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T07:02:01.687

只需将所有设置保存在数据库中，当设置更改时，重建配置文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T07:02:31.870

不要让您的 PHP 编辑 PHP 代码。请改用 XML 配置文件。读出 XML 信息，如果要进行更改，请更改从 XML 文件生成的数据结构中的值并将其吐回新的配置文件中。

# linux - 如何监禁 linux 用户

> ID：833247
> 
> 赞同：5
> 
> 时间：2009-05-07T07:03:08.140
> 
> 标签：linux, chroot, jail

有没有类似于 chroot 的东西，但是对于用户来说？

我们即将授予客户端访问我们服务器的权限，并希望他们只看到我们允许的目录。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T07:11:22.443

在 Google 上搜索“openssh jail”后，我找到了[SSHjail for openSSH](http://antitese.org/sshjail/)。如果您的客户端使用 ssh/scp 来访问上述服务器，这可能就是您正在寻找的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-06-18T15:40:16.883

2009 年的“最佳答案”已经过时。OpenSSH 现在带有该`ChrootDirectory`选项。请参阅[http://www.debian-administration.org/articles/590](http://www.debian-administration.org/articles/590)，它适用于 ssh 的旧版本。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T17:10:28.040

重要的是要注意 chroot(2) 并非出于安全目的。逃离 chroot 监狱非常容易。有关更多信息，请参阅这篇关于[滥用 chroot](http://kerneltrap.org/Linux/Abusing_chroot)的文章。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T07:09:44.770

如果您真的想走极端，[SE Linux](http://en.wikipedia.org/wiki/Selinux)（或任何其他[强制访问控制](http://en.wikipedia.org/wiki/Mandatory_access_control)）绝对是对默认 unix 权限的改进。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-10-26T09:50:41.227

一个有效的方法是使用[lshell](https://github.com/ghantoos/lshell)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-07T11:46:47.777

没有简单的方法可以在他们的 homedirs 中监禁用户。顺便说一句，我绝不会将我的系统的访问权限授予我至少不信任的人。

上次我这样做时，我使用了一个基于 [http://bash.cyberciti.biz/guide/A_menu_box](http://bash.cyberciti.biz/guide/A_menu_box) 的“不可逃避”菜单 .bashrc 启动了这个你不会逃避的脚本：

```
~/.bashrc :
(LAST LINE)
./menu.sh; exit 0 
```

是的，我必须为每个菜单项编写脚本（获取日志，检查 sys，...），但没有人运行 'chown -R root:root /' 而不是 *. 无价。

[编辑]：创建一个专用用户，不要以 root 身份执行此操作！！！

# jquery - Div 在 Mozilla 中不会随着效果而消失

> ID：833250
> 
> 赞同：0
> 
> 时间：2009-05-07T07:04:25.313
> 
> 标签：jquery

我正在使用以下内容来淡化带有幻灯片效果的 div。

```
$('div.clsBlue').eq(2).fadeOut(1000, function() {

                   }); 
```

这在 IE7 中完美地随着动画而消失，但在 Mozilla 3 中却没有。有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T07:54:46.817

我遇到了同样的问题：IE 6 运行良好，但 FFox 3 没有。

我解决了这个设置容器 DIV 的问题

> 高度：自动

问候。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T07:37:34.423

你在怪癖模式下运行吗？有时，如果您没有指定的 doctype，jQuery 动画可以做一些有趣的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-10T03:43:13.443

检查您正在淡出的 DOM 元素是否已定义或浏览器可识别的宽度和高度值。

我试图淡化一个带有绝对定位锚的 DIV 元素 - 这是行不通的。然后我为 DIV 设置显式宽度和高度，并将*position:absolute*设置为 DIV 而不是子锚点，以便可以拾取 DIV 的尺寸。只有这样，任何 jQuery 淡入淡出才会起作用。

# c++ - 通用 C++ 框架

> ID：833252
> 
> 赞同：3
> 
> 时间：2009-05-07T07:04:44.877
> 
> 标签：c++, frameworks

有没有人使用过[Common C++ 框架](http://www.gnu.org/software/commoncpp/)？它可以用作电信网络应用程序的框架吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T12:56:52.167

为什么用那个？[为什么要使用一个晦涩难懂的框架，当存在像Boost](http://www.boost.org "促进")这样的完善的、有据可查的、同行评审的、高质量的框架时。它拥有数百万个其他优秀的网络库。

# c++ - 控制 Lua5.1 的垃圾收集器

> ID：833257
> 
> 赞同：1
> 
> 时间：2009-05-07T07:07:18.553
> 
> 标签：c++, garbage-collection, lua

好的，所以我有一个使用 SWIG 向 Lua 公开的 C++ 类。该脚本创建对象，但管理器类也有一个指向该对象的指针，因此无论出于何种原因都可以在 C++（或其他脚本）中对其进行修改。

问题是当脚本完成对象被释放时，如何控制垃圾收集器收集的内容而无需实现 gc 元方法？

这是一个例子：

```
--Script that creates the object
someObject = Utils.Object("Obj name"); 
```

现在对象已经向管理器注册了自己，因此应用程序的其余部分（和其他脚本）可以访问它。

```
--Another script
obj = ObjManager:GetObject(0); 
```

显然不是一个非常现实的例子，但希望它能说明我的问题。有没有办法在没有 C++ 中的 gc 元方法的情况下否决垃圾收集器？

只是为了澄清管理器是用 C++ 编写的，而 Utils 是包含公开类的模块名称。该对象还在其构造函数中将自己注册到管理器。

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T21:46:50.903

Lua 的 GC 只知道 Lua 中持有的引用，这是一个合理的实现约束。这意味着对象的生命周期在 Lua 的控制之下。如果通过执行一个脚本或函数创建的对象需要供以后的脚本或函数使用，则必须在 Lua 状态中保留对它的引用，以便 GC*知道*它仍在使用中。否则与垃圾无异，随时可能被丢弃。

这是 Lua 注册表的用途之一。C 端可以通过将任何 Lua 对象放在注册表中来轻松地保存对它的引用。键可以是 C 库已知的某个唯一值（`static`转换为轻量用户数据的变量的地址通常是一个不错的选择，因为它不会与任何其他库中的任何键发生冲突）。或者，函数调用`luaL_ref(L, LUA_REGISTRYINDEX)`会将该项放在注册表中堆栈的顶部，并返回一个唯一的整数键。这适用于存储脚本提供的回调函数，既保护函数免受 GC 影响，又允许将指向它的“指针”（整数键）存储在 C 结构中，以便可以检索和调用它之后。

请注意，它`luaL_ref()`可用于管理任何表中的引用，因此使用模块专用的表而不是全局注册表可能非常有意义。在这种情况下，表`ObjManager`本身可能是一个很好的候选者。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T21:31:11.300

是的; 让 Utils.Object 将对象填充到私有表中。那么它*永远不会*被收集，但你可以玩游戏（代码未测试）：

```
do
  local retained = { }  -- table forces objects to be retained
  local old_util_object = Util.Object
  Util.Object = function(...)
    local obj = old_util_object(...)
    retained[obj] = true
    return obj
  end
  Util.Free = function(obj)
    assert(retained[obj])
    retained[obj] = nil  -- now obj can be garbage-collected
  end
end 
```

如果你想在 C++ 端解决同样的问题，让你的 C++ 代码分配一个私有表并将它放在 Lua 注册表中。然后你可以玩相同的插入/删除游戏，只使用 C API 而不是 Lua 源。假设您熟悉 Lua 的 C API，这很简单。如果您以前没有使用过 C API，那么现在是开始学习的最佳时机。

# c++ - std::map 无法处理多态性？

> ID：833258
> 
> 赞同：5
> 
> 时间：2009-05-07T07:07:28.600
> 
> 标签：c++

在 c++ 中使用 std::map 时，是否可以将继承的类作为它们的“基类”存储在映射中并且仍然能够调用它们的重载方法？看这个例子：

```
#include <iostream>
#include <map>
class Base
{
    public:
    virtual void Foo() { std::cout << "1"; }
};

class Child : public Base
{
    public:
    void Foo() { std::cout << "2"; }
};

int main (int argc, char * const argv[])
{
    std::map<std:string, Base> Storage;
    Storage["rawr"]=Child();
    Storage["rawr"].Foo();
    return 0;
} 
```

以下代码写入“1”。这以某种方式告诉我，当您使用 std::map 时，多态性不起作用。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-07T07:11:11.210

多态在这种情况下不起作用，因为 std::map 将 Base 存储为值类型，因此[对象被 sliced](http://en.wikipedia.org/wiki/Object_slicing)。

如果要对存储的对象进行多态性，则需要存储指针或使用[boost ptr 容器](http://www.boost.org/doc/libs/1_38_0/libs/ptr_container/doc/tutorial.html)之一来实现相同的效果。这意味着您需要记住之后删除内存（请不要将指向堆栈对象的指针放入映射中）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T07:11:37.823

它的[对象切片](http://en.wikipedia.org/wiki/Object_slicing)案例。尝试用指针插入。

在存在继承复制的情况下会导致切片。也就是说，如果您创建基类对象的映射并尝试将派生类对象插入其中，则对象的派生性将在对象被复制（通过基类复制构造函数）到映射中时被删除。

因此，建议使用指针而不是复制自身。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T07:14:40.970

第一个想法是，要获得多态性，您需要在指针或引用上调用成员方法。我会在映射中存储指向基类的指针（你存储的元素被复制），然后通过这样的指针调用：

```
#include <iostream>
#include <map>

class Base
{
    public:
    virtual void Foo() { std::cout << "1"; }
};

class Child : public Base
{
    public:
    void Foo() { std::cout << "2"; }
};

int main (int argc, char * const argv[])
{
    std::map<std::string, Base*> Storage;
    Storage["rawr"] = new Child();
    Storage["rawr"]->Foo();
    return 0;
} 
```

你得到结果“2”。

注意：您现在必须处理分配的内存。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T07:15:14.400

动态多态性仅适用于引用和指针。在使用容器的情况下，它在它们内部复制对象 - 仅使用指针。

如果您在不使用指针或引用的情况下强制从超类型转换为基类型，则对象内存将被**切片**。看看这个：[对象切片维基百科文章](http://en.wikipedia.org/wiki/Object_slicing)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T07:10:15.753

不，您必须存储**指向**基类的指针才能获得多态行为。你现在的做法会导致[切片](http://en.wikipedia.org/wiki/Object_slicing)。

# tdd - 测试驱动开发与自动化定理证明

> ID：833259
> 
> 赞同：3
> 
> 时间：2009-05-07T07:07:36.413
> 
> 标签：tdd, automated-tests

我对数字逻辑/架构设计感兴趣的一件事是自动定理证明，以验证例如浮点乘法模块。

单元测试很方便，但尝试测试（蛮力）浮点模块的每个可能输入几乎是棘手的。取而代之的是，您要么找到（1）它总是会产生正确结果的证明，要么（2）证明它会产生至少一个不正确的结果。

我现在正在尝试将类似的逻辑集成到我的软件中，我想知道是否可以将它与测试驱动开发结合使用或代替测试驱动开发？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T07:43:25.080

在过去，我在形式验证方面有很多经验，尽管它是针对硬件组件（VHDL/Verilog）的。相同的原则可以应用于软件，但是如果您有任何类型的 I/O 或事件，输入空间就会变得难以管理。由于状态空间变得太大，在大型“模型”上证明任何类型的陈述也是不切实际的。

理想情况下，您会在“计算”函数上使用定理证明器来证明它们的正确性。但是，出于以下几个原因，仍应使用测试：

*   您的定理中可能存在“错误”。如果编写定理的人是编写正在测试的实际代码的人，这尤其“危险”。
*   被测试的定理通常是不完整的。
*   您*必须*在测试环境中放置断言，以确保您用于代码输入（“环境”）的假设是有效的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T07:16:29.280

听起来您正在尝试构建“经过数学验证的软件”，这是一件非常难以实现的事情。

查看其他问题：[为什么不能证明程序](https://stackoverflow.com/questions/476959/why-cant-programs-be-proven)
（注意：链接的问题标题具有误导性 - 某些程序*可以*证明，但很难）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T07:18:05.687

你是说你会在数学上证明你的算法在纸上是正确的，还是写代码来做同样的事情？（我对你将如何做后者很感兴趣——如果可能的话，请链接到博客文章或在评论中解释如何做到这一点）

在前一种情况下，如果没有测试，您就无法证明您的实现反映了您的意图并按预期工作。
在后一种情况下，如果定理证明代码不执行实现 - 前面的论点成立。

就我个人而言，我只会使用 TDD——因为它**很容易**让我和其他人**阅读**一堆写得很好的测试并弄清楚代码的作用。更不用说**更快**了。 *您不必测试所有可能的输出，而是确定一组有代表性的输入。每个输入都应该通过代码执行不同的结果/路径。*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T07:13:13.907

始终与测试结合使用。否则，您无法证明您的实现实际上与您证明是正确的一致。

# mysql - 两个日期之间的 MySQL 周计算

> ID：833261
> 
> 赞同：19
> 
> 时间：2009-05-07T07:08:44.930
> 
> 标签：mysql

我已经被这个问题困扰了好几天，这就像计算两天之间的周数，例如：

```
Select @Days = (datediff( week, @pdtFromDate, @pdtToDate) - 1) * 5 
```

这会将输出返回为 257。

我需要将此脚本转换为 MySQL。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-05-07T08:50:20.037

```
DATEDIFF(@date1, @date2)/7 
```

这会返回一个分数，我猜你会想以某种方式舍入`CEIL()`,`ROUND()`或`FLOOR()`

我的测试示例有两个定义的日期：

```
SELECT FLOOR(DATEDIFF(DATE(20090215), DATE(20090101))/7); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-03-29T07:24:48.607

你也可以试试这个，因为它分隔了几周和几天。

```
 SET @day1=DATE('2015-02-02');
    SET @day2=DATE('2015-02-10');
    SELECT CONCAT(SUBSTRING_INDEX(ABS(DATEDIFF(@day1,@day2)/7),'.',1),'Weeks ',
    SUBSTRING_INDEX(ABS(DATEDIFF(@day1,@day2)),'.',1)-SUBSTRING_INDEX(ABS(DATEDIFF(@day1,@day2))/7,'.',1)*7,'Days'
    )AS diff 
```

# security - 通过自定义策略级别不工作为组件提供对 sharepoint 的完全信任

> ID：833262
> 
> 赞同：1
> 
> 时间：2009-05-07T07:09:03.277
> 
> 标签：security, sharepoint, assemblies, policy, cas

我正在构建几个 ucercontrols。这些用户控件将托管在[smartpart 的返回中](http://smartpart.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=10697)。我面临的问题是我的程序集没有适当地提供足够的权利。

为了实现这一点，您（基本上）有三个选择；
1\. 将站点设置为完全信任级别（显然不希望这样，也不适合我。程序集不受信任）
2\. 将程序集放在 gac 中（也尝试过，也不起作用）。
3\. 安全方面，我希望授予我的集会一套特殊的权利。

这可以通过自定义信任文件来完成。到目前为止，这是我想出的，但它不起作用。有人可以指出我正确的方向吗？

在安全类元素中添加了这两个子句；

```
<SecurityClass Name="AssemblyOne" Description="MyAssemblies.AssemblyOne, Version=1.0.0.0, Culture=neutral, PublicKeyToken=132bddbb4f2e45f2"/>
<SecurityClass Name="AssemblyTwo" Description="MyAssemblies.AssemblyTwo, Version=1.2.0.0, Culture=neutral, PublicKeyToken=e5141be41498e913" /> 
```

在命名权限集中添加了这个子句

```
 <PermissionSet
                class="NamedPermissionSet"
                version="1"
                Name="SPFULL"
                Unrestricted="true">
          <IPermission
                  class="AspNetHostingPermission"
                  version="1"
                  Level="Minimal"
                        />
          <IPermission
                  class="SecurityPermission"
                  version="1"
                  Flags="Execution"
                        />
          <IPermission class="WebPartPermission"
                  version="1"
                  Connections="True"
                        />
          <Assemblies>
            <Assembly Name="MyAssemblies.AssemblyOne" Version="1.0.0.0" PublicKeyBlob="002400000480000094000000060200000024000052534131000400000100010015fd63eb99fee087978556fcf698fae059d75307d1ee8e44486a349ea87843344440af9051d4434bac1d219b3a219d5f0ff50e8c0ed9eb7c07eab19d9ff0494ecaafc5ce1cb65d59ddd153b0f09790d6641af0325aaceb81c2e55c4610a1c18ae9f5a476de2282918a293726bce20aa932e06666b4e8b6885775b919a93a91a9" />
            <Assembly Name="MyAssemblies.AssemblyTwo" Version="1.2.0.0" PublicKeyBlob="00240000048000009400000006020000002400005253413100040000010001007da2bfd8e8ec53bd9caa8a5e3af2408cabd60b04c1df80bf8cbad447addaa8a7854818c77ea4f1ada3b73f33836b716999a5aac2475b22c676cedb3fe42cb2ebfba9dc20c04b1baab5a75ead6169b45d1dbef0bcbe82d5f862f954739ed100eaf41425eddd559aee883c055da038d0d8c2e998db799d6e1995ddea95a48eb0b4" />
          </Assemblies>
        </PermissionSet> 
```

然后我在现有的“默认”代码组上方添加了这个子句；

```
<CodeGroup
        class="UnionCodeGroup"
        version="1"
        PermissionSetName="SPFULL"
        Name="My first Web Part"
        Description="This code group grants the my first web part full permissions.">
        <IMembershipCondition
          class="StrongNameMembershipCondition"
          version="1"              PublicKeyBlob="002400000480000094000000060200000024000052534131000400000100010015fd63eb99fee087978556fcf698fae059d75307d1ee8e44486a349ea87843344440af9051d4434bac1d219b3a219d5f0ff50e8c0ed9eb7c07eab19d9ff0494ecaafc5ce1cb65d59ddd153b0f09790d6641af0325aaceb81c2e55c4610a1c18ae9f5a476de2282918a293726bce20aa932e06666b4e8b6885775b919a93a91a9" />
        <IMembershcipCondition
          Class="StrongNameMembershipCondition"
          version="1"
          PublicKeyBlob="00240000048000009400000006020000002400005253413100040000010001007da2bfd8e8ec53bd9caa8a5e3af2408cabd60b04c1df80bf8cbad447addaa8a7854818c77ea4f1ada3b73f33836b716999a5aac2475b22c676cedb3fe42cb2ebfba9dc20c04b1baab5a75ead6169b45d1dbef0bcbe82d5f862f954739ed100eaf41425eddd559aee883c055da038d0d8c2e998db799d6e1995ddea95a48eb0b4"/>
      </CodeGroup> 
```

谁能向我指出如何做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T18:15:47.493

我看不到如何将两个 dll 放入 GAC 或将 web.config 设置更改为 FullTrust 不起作用。你不能给它更多的权限。您确定您遇到的问题与安全有关吗？如果您只将其中一个 dll 放入 GAC，您是否具有 [assembly:AllowPartiallyTrustedCallers()] 属性？

附注：您应该将您的权限集放在 WSP:s manifest.xml 中，这将确保 SharePoint 在部署该功能时为所有 frontweb 上的 dll 设置正确的权限。这将使管理更容易。

[http://msdn.microsoft.com/en-us/library/aa543901.aspx](http://msdn.microsoft.com/en-us/library/aa543901.aspx)

# java - 如何处理执行许多不同背景更改的外观方法的错误？

> ID：833264
> 
> 赞同：1
> 
> 时间：2009-05-07T07:09:40.450
> 
> 标签：java, api, oop, exception-handling

想象一下，我有一个看起来像这样的服务：

```
public interface MyAccountService
{
    boolean create( String user );
} 
```

方法 create 执行几个更改，即（为了讨论）：

1.  将消息添加到队列中
2.  将一行添加到多个表中
3.  创建一个 LDAP 帐户等...

目前我将所有错误消息折叠成一个布尔返回值。现在在内部，如果出现错误，我会为支持团队记录这些。

例如，用户创建失败的典型日志

按以下（严格）顺序创建“alistair”帐户：

*   添加到表 Foo：成功
*   添加到表格栏：成功
*   添加到 LDAP：失败
*   添加到队列：成功

这样，技术支持人员可以决定如何修复帐户。

设计系统的最佳实践是什么，以便我们可以轻松跟踪事务的成功/失败（并手动修复）？返回布尔值并吞下所有异常是一个好的设计吗？

**编辑**：通过*吞下异常*，我的意思是不要把它们扔给调用者。但是，我确实记录了异常，并将它们转换为 false/true 返回值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T07:47:29.767

我喜欢这里介绍的文章中描述的方法，[这里](http://www.oracle.com/technetwork/java/effective-exceptions-092345.html)有关于它的[讨论](http://www.theserverside.com/news/thread.tss?thread_id=43820)......

这个想法是考虑某种异常，并以不同的方式处理它们：

> 一种例外情况是意外情况，这意味着由于已知问题而无法成功执行的流程（他使用的示例是支票账户，其中账户资金不足，或者支票已发出停止付款.) 这些问题应该通过不同的机制来处理，并且代码应该期望管理它们。
> 
> 另一种类型的异常是故障，例如 IOException。故障通常不是预期的或不应该预期的，因此处理故障可能不应该是正常过程的一部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T07:18:19.277

在我看来，你有 2 个选项： 1\. 抛出一个带有成功列表的自定义异常，因此 API 的客户端可以捕获异常并查看失败的原因，然后决定执行哪个操作。2\. 返回一个 ENUM，其中反映了结果的所有可能结果，因此
API 的客户端可以再次决定他将执行哪个操作。

无论如何，您必须记录您的方法遇到的所有问题，以便对其进行跟踪......异常和问题吞咽是一种非常糟糕的做法。

我更喜欢自定义 Exception 方法，因为 ENUM 更像是 C API ..

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T07:15:32.167

这取决于需要。

如果异常是由于客户端发送的错误信息而引起的，并且您希望他们知道以便他们更正它，那么您应该抛出异常。

如果异常是由于内部问题，但您仍然希望客户端知道，则抛出异常。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T07:15:44.617

不它不是。应记录有关异常的所有可用信息。（包括但不限于：异常类型、消息、堆栈跟踪……）

# .net - 从网络共享运行 .NET Windows 应用程序的注意事项

> ID：833269
> 
> 赞同：3
> 
> 时间：2009-05-07T07:11:09.060
> 
> 标签：.net

使用 .NET 3.5 SP1，我们现在可以默认通过网络运行 Windows 应用程序。即使使用早期版本，通过一些努力（设置代码访问安全性），我们也可以从网络共享运行可执行文件。

我的问题是，通过将应用程序放在网络共享上来分发应用程序的含义是什么。例如，性能如何受到影响，除了 CAS 等还有其他安全考虑因素吗？

它与分发应用程序相比如何，例如通过手动复制文件或使用智能客户端在本地安装它们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T07:47:06.773

好吧，显式本地复制的明显区别在于，即使共享不可用，您也可以使用它。如果应用程序可以从共享中运行，那么让它在（例如）标记为离线使用的 ClickOnce 部署中运行同样简单。然后您将获得离线使用*和*客户端缓存的优势（因此它不必在第二次/第三次/等时间复制任何内容） - 但它仍然很容易自动更新。

请注意，ClickOnce 部署也可以是网络共享部署，所以对我来说走这条路线是有意义的。您还可以签署整个部署（不仅仅是单个文件），指定信任等。此外，它可以在没有 .NET 3.5SP1 的情况下工作，并且它是否是映射共享（“f：\”）无关紧要或 UNC ("\\fooserver\bar") - 我相信 3.5 SP1 调整仅适用于映射共享？

最后，您还可以使用文件关联等功能。胜利如此之多，问题却如此之少。我会使用 ClickOnce ;-p

# asp.net - ASP.Net 向导 - 如何清除 Web 控件的内容

> ID：833281
> 
> 赞同：0
> 
> 时间：2009-05-07T07:14:24.590
> 
> 标签：asp.net

我有一个 ASP.NET 向导控件，我在其中循环返回`wiz.MoveTo(wiz.WizardSteps[0])`到 FinishButtonClick 事件处理程序中向导的第一步。

然后我还想清除步骤中所有控件的所有内容？

问题是由于视图状态，向导步骤中的控件会记住之前提交的值吗？

我不能在控件上使用 enableviewstate=false，因为它们需要能够记住它们在步骤之间的状态（来回）？

仅在 FinishButtonClick 事件发生时清除所有控件的视图状态的最简单方法是什么？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T07:55:17.160

有什么不应该清除的吗？如果没有，最简单的解决方案可能是在 click 事件处理程序中放入重定向，以便重新初始化所有内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T07:56:02.617

解决了。在这个过程中还学到了一些关于 ViewState 范围的新知识......

ViewState 不负责存储 TextBoxes、DropDowns、CheckBoxes 等控件的修改值。这些控件继承自 IPostBackDataHandler 接口。LoadPostBackData 事件在页面生命周期中触发，其中控件的 VALUES 从表单 HTTP POST 标头加载...由客户端重新提交...

那么如何销毁 HTTP POST Headers 来清除控制值呢？

一个新的请求会产生新的 HTTP POST 标头...所以我只需在 FinishButtonClick 事件处理程序中执行此操作：

```
HttpContext.Current.Response.Redirect(Page.Request.Url.ToString()); 
```

这有一个额外的好处，它可以进入向导的第 1 步，所以我也不必这样做`wiz.MoveTo(wiz.WizardSteps[0])`......。

希望这可以帮助有同样问题的人。

# c++ - 如何使用带有指针向量的 STL 算法

> ID：833289
> 
> 赞同：12
> 
> 时间：2009-05-07T07:15:50.920
> 
> 标签：c++, stl, boost, lambda, c++11

我有一个不属于容器的指针向量。如何在指针的目标上使用算法。我尝试使用 boost 的 ptr_vector，但它会在超出范围时尝试删除指针。

这是一些需要工作的代码：

```
vector<int*> myValues;
// ... myValues is populated
bool consistent = count(myValues.begin(), myValues.end(), myValues.front()) == myValues.size();
auto v = consistent ? myValues.front() : accumulate(myValues.begin(), myValues.end(), 0) / myValues.size();
fill(myValues.begin(), myValues.end(), v);
// etc. 
```

我意识到 for 循环会起作用，但这发生在很多地方，所以某种一元适配器？我找不到一个。提前致谢！

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-07T07:37:58.213

您可以使用[Boost Indirect Iterator](http://www.boost.org/doc/libs/1_38_0/libs/iterator/doc/indirect_iterator.html)。当取消引用（使用`operator*()`）时，它会应用*额外的*取消引用，因此您最终会得到迭代器引用的指针所指向的值。有关更多信息，您还可以查看[有关取消引用迭代器的这个问题](https://stackoverflow.com/questions/352152/is-there-a-dereferenceiterator-in-the-stl)。

这是一个简单的例子：

```
std::vector<int*> vec;

vec.push_back(new int(1));
vec.push_back(new int(2));

std::copy(boost::make_indirect_iterator(vec.begin()),
          boost::make_indirect_iterator(vec.end()),
          std::ostream_iterator<int>(std::cout, " "));     // Prints 1 2 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T07:51:22.177

```
bool consistent = count_if(myValues.begin(), myValues.end(), 
   bind2nd(ptr_fun(compare_ptr), *myValues.front())) == myValues.size();

int v = consistent ? *myValues.front() : accumulate(
   myValues.begin(), myValues.end(), 0, sum_int_ptr) / myValues.size();

for_each(myValues.begin(), myValues.end(), bind1st(ptr_fun(assign_ptr),v)); 
```

Fill 不能采用分配函数（以便取消引用指针）。因此使用了 for_each()。为了优化，在运行 for_each() 之前添加 if(!consistent) 是明智的。上述 STL one liner 中使用的函数：

```
int sum_int_ptr(int total, int * a) { return total + *a; }    
void assign_ptr(int v, int *ptr) { *ptr = v; }    
bool compare_ptr(int* a, int pattern) { return *a == pattern; } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T07:37:37.200

您可以查看`boost::shared_ptr<>`- 具有引用计数的智能指针。超出范围后它不会删除指针。

# c++ - linux/unix 下是否有相当于 WinAPI 的 MAX_PATH 的？

> ID：833291
> 
> 赞同：70
> 
> 时间：2009-05-07T07:16:35.880
> 
> 标签：c++, c, linux, unix, posix

如果我想分配一个 char 数组（在 C 中），它保证足够大以容纳任何有效的绝对路径+文件名，它需要多大。

在 Win32 上，有 MAX_PATH 定义。Unix/linux 的等价物是什么？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-05-07T07:24:15.143

有一个`PATH_MAX`，但它有点问题。[从realpath(3)](http://man7.org/linux/man-pages/man3/realpath.3.html)手册页的 bugs 部分：

> 此函数的 POSIX.1-2001 标准版本被设计破坏，因为无法确定输出缓冲区的合适大小*resolve_path*。根据 POSIX.1-2001，大小为**PATH_MAX**的缓冲区就足够了，但**PATH_MAX**不必是定义的常量，可能必须使用[pathconf(3)](http://man7.org/linux/man-pages/man3/pathconf.3.html)获得。并且询问[pathconf(3)](http://man7.org/linux/man-pages/man3/pathconf.3.html)并没有真正的帮助，因为一方面 POSIX 警告[pathconf(3)](http://man7.org/linux/man-pages/man3/pathconf.3.html)的结果可能很大并且不适合分配内存，另一方面 [pathconf(3)](http://man7.org/linux/man-pages/man3/pathconf.3.html)可能会返回 -1 到表示**PATH_MAX 不受限制**。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-05-08T01:30:34.190

到目前为止，关于 *nix 方面的其他答案似乎都是正确的，但我会在 Windows 上添加一个关于它的警告。

您被文档欺骗（通过遗漏）。

`MAX_PATH`确实已定义，甚至可能适用于存储在 FAT 或 FAT32 上的文件。但是，任何路径名都可以加上前缀`\\?\`来告诉 Windows API 忽略`MAX_PATH`并让文件系统驱动程序自己决定。在那之后，定义变得模糊。

再加上路径名称实际上是 Unicode（嗯，UTS-16）的事实，并且当使用“ANSI”API 时，与内部 Unicode 名称之间的转换取决于一系列因素，包括当前代码页，你有一个混乱的秘诀。

[MSDN](http://msdn.microsoft.com/en-us/library/aa365247.aspx)上对 Windows 的规则进行了很好的描述。规则比我在这里总结的要复杂得多。

**编辑：**感谢 KitsuneYMG 的评论，我改成`\\.\`了上面的。`\\?\`

Windows 路径和命名空间很复杂。有些人甚至可能认为它们太复杂了。复杂性的一个来源是 Win32（现在是 Win64）API 是一个位于 Windows NT 本地系统之上的子系统。

没有任何前缀的路径在最广泛的 Windows 平台上兼容。如果它仅限于 7 位 ASCII 字符，那么它与 2.0 版左右的 16 位 DOS 兼容（无论何时引入子目录，实际上可能已经在 DOS 3 中；但 DOS 1.0 只有根目录和`\`字符没有特殊意义）。

前缀导致路径名的`\\?\`平衡被逐字传递给适当的文件系统驱动程序，这产生了删除对`MAX_PATH`字符的限制的效果。如果长路径名也在网络共享上，那么您可以使用带有前缀的扩展 UNC 名称，`\\?\UNC\server\share\`而不是普通的 UNC 名称`\\server\share\`。使用此前缀会限制对 Win32 和更高版本的 Windows 平台的可移植性，但除非您需要在旧硬件上支持 16 位 Windows，否则这不是一个大问题。

`\\.\`前缀是另一种动物。它允许访问一组特殊命名的设备之外的设备对象，这些设备由 Windows 作为特殊文件名自动映射到每个文件夹中。这些特殊名称包括 CON、PRN、AUX、NUL、COM1、COM2、COM3、COM4、COM5、COM6、COM7、COM8、COM9、LPT1、LPT2、LPT3、LPT4、LPT5、LPT6、LPT7、LPT8 和 LPT9。请注意，所有这些名称都是特殊的，无论是否使用扩展名，或者大小写混合。但您可能安装了 10 个或更多 COM 端口。如果您使用 USB 调制解调器或 USB 串行端口适配器，这种情况很快就会发生，因为每个唯一的基于 USB 的串行端口都将被分配一个不同的 COMn 名称。如果需要访问第 50 个串口，那么只能使用名称`\\.\COM50`，因为 COM50*不是*像 COM1 这样的特殊名称。

我上面引用的 MSDN 页面有区别，我只是在原始答案中输入了不正确的前缀。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-05-07T07:19:09.320

好吧，至少在 Linux 上，有：

*   `PATH_MAX`（定义在`limits.h`）

*   `FILENAME_MAX`（定义在`stdio.h`）

这两个都设置`4096`在我的系统（x86 Linux）上。

**更新：：**来自[glibc 手册的一些信息](http://www.gnu.org/software/libc/manual/html_mono/libc.html#Limits-for-Files)

> 仅当系统对相关参数具有固定、统一的限制时，才会在 limits.h 中定义以下每个宏。如果系统允许不同的文件系统或文件有不同的限制，那么宏是未定义的；使用 pathconf 或 fpathconf 找出适用于特定文件的限制

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-06-28T17:20:42.253

FILENAME_MAX 是 ISO C 标准的一部分，它适用于 UNIX 和 Windows。但是，GNU C 库文档包含以下警告：

“与 PATH_MAX 不同，即使没有施加实际限制，也会定义此宏。在这种情况下，它的值通常是一个非常大的数字。在 GNU 系统上总是如此。

使用说明：不要使用 FILENAME_MAX 作为存储文件名的数组的大小！你不可能做一个那么大的数组！使用动态分配。”

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-07T07:20:20.503

您可以`[pathconf()](http://linux.about.com/library/cmd/blcmdl3_pathconf.htm)`在运行时使用它来计算，但在`<limits.h>`.

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-05-13T19:12:12.893

您可以使用该`realpath`函数为特定路径分配足够大的缓冲区。如果您将空指针作为第二个参数传递给它，它将为路径分配一个足够大的缓冲区。手册页可能比我能更好地解释它：

> realpath() 扩展所有符号链接并解析对 /./、/../ 和由 path 命名的以 null 结尾的字符串中的额外“/”字符的引用，以生成规范化的绝对​​路径名。生成的路径名存储为以 null 结尾的字符串，最多 PATH_MAX 个字节，存储在 resolved_pa​​th 指向的缓冲区中。生成的路径将没有符号链接、/./ 或 /../ 组件。
> 
> **如果将 resolved_pa​​th 指定为 NULL，则 realpath() 使用 malloc(3) 分配一个最多 PATH_MAX 字节的缓冲区来保存已解析的路径名，并返回指向此缓冲区的指针。调用者应该使用 free(3) 释放这个缓冲区。**

[http://linux.die.net/man/3/realpath](http://linux.die.net/man/3/realpath)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-12-20T16:07:53.260

限制.h

```
/*
 * File system limits
 *
 * NOTE: Apparently the actual size of PATH_MAX is 260, but a space is
 *       required for the NUL. TODO: Test?
 * NOTE: PATH_MAX is the POSIX equivalent for Microsoft's MAX_PATH; the two
 *       are semantically identical, with a limit of 259 characters for the
 *       path name, plus one for a terminating NUL, for a total of 260.
 */
#define PATH_MAX    260 
```

minwindef.h

```
#define MAX_PATH 260 
```

# java - 如何在 JBoss 的默认 RMI 注册表中注册服务器并从运行在另一个 JVM 中的客户端访问它？

> ID：833292
> 
> 赞同：3
> 
> 时间：2009-05-07T07:17:33.160
> 
> 标签：java, jboss, rmi, jackrabbit

我正在尝试通过 RMI访问部署在[JBoss应用程序服务器上的](http://www.jboss.org/jbossas/)[Jackrabbit存储库。](http://jackrabbit.apache.org)

当我尝试使用 ClientRepositoryFactory.getRepository('rmi://xxx.xxx.xxx.xxx:1099/imageserver') 连接到工厂时，出现以下异常。但是，如果我创建一个 Web 应用程序，该应用程序在具有不同端口的服务器上启动一个新的 RMI 注册表并在该新注册表中注册 Jackrabbit，它就可以工作。

但是，我需要通过对默认 JBoss 配置进行最小的调整来使其正常工作。因此，任何人都可以阐明问题的原因。我在其他地方看到过很多关于同一主题的帖子，我们已经尝试了所有合理（以及许多不合理）建议的解决方案。

```
org.apache.jackrabbit.rmi.client.RemoteRuntimeException: java.rmi.ConnectIOException: non-JRMP server at remote endpoint
    org.apache.jackrabbit.rmi.client.SafeClientRepository.getDescriptor(SafeClientRepository.java:81)
    com.btmatthews.freelancer.webapp.servlet.TestServlet.doGet(TestServlet.java:39)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:690)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:803)
    org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)
root cause

java.rmi.ConnectIOException: non-JRMP server at remote endpoint
    sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:230)
    sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.java:184)
    sun.rmi.server.UnicastRef.newCall(UnicastRef.java:322)
    sun.rmi.registry.RegistryImpl_Stub.lookup(Unknown Source)
    java.rmi.Naming.lookup(Naming.java:84)
    org.apache.jackrabbit.rmi.client.ClientRepositoryFactory$1.getRemoteRepository(ClientRepositoryFactory.java:95)
    org.apache.jackrabbit.rmi.client.SafeClientRepository.getDescriptor(SafeClientRepository.java:77)
    com.btmatthews.freelancer.webapp.servlet.TestServlet.doGet(TestServlet.java:39)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:690)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:803)
    org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-06-30T00:13:30.953

我认为您可能需要使用与 IIOP 和 JRMP 不同的 JNP 客户端。这是 JBoss 在 1099 中公开的协议。这意味着您可能需要使用以下内容配置初始上下文：

```
Hashtable<String, String> env = new Hashtable<String, String>();
env.put("java.naming.factory.initial",
        "org.jnp.interfaces.NamingContextFactory");
env.put("java.naming.provider.url", "jnp://localhost:1099");
env.put("java.naming.factory.url.pkgs",
        "org.jboss.naming:org.jnp.interfaces");

Context context = new InitialContext(env);

Service s = (Service) context.lookup("service");

s.sayHello(); 
```

或者您可能应该在 JBoss 耳朵中启动您自己的 RMI 服务器并在其他端口中发布。

干杯。

# vbscript - 如何在 Windows NT 4 中运行 VBScript？

> ID：833293
> 
> 赞同：4
> 
> 时间：2009-05-07T07:17:43.630
> 
> 标签：vbscript, wsh, nt4

我有一个 VBScript，我计划每天在许多 Windows 服务器上运行。在 Windows 2000 和 2003 中，该脚本运行良好，因为这两个操作系统都有 csript.exe。但是，在 Windows NT 4 中，它似乎没有这个可执行文件。

是否有在 Windows NT 4 中运行 VBScript 的替代/选项？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T07:25:54.420

您需要 WSH 5.6。它应该在 Windows Update 上可用，或者您可以[在此处](http://web.archive.org/web/20060901115837/download.microsoft.com/download/4/c/9/4c9e63f1-617f-4c6d-8faf-c2868f670c1c/Windows9x-Script56-KB917344-x86-enu.exe)下载。您知道不再支持 NT4 了吗？`</serverfault>`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T07:34:44.417

根据这篇 MSDN 文章，WSH 5.6 可用并在 NT 4.0 上运行：

[http://msdn.microsoft.com/en-us/library/ms974613.aspx](http://msdn.microsoft.com/en-us/library/ms974613.aspx)

但是，当我去下载中心获取 Windows Script Host 时，5.6 版本只声称适用于 Windows 2000 和 Windows XP。有一个更新的版本，5.7，但它说它只在 XP 上受支持。

下载中心：[http ://www.microsoft.com/downloads/en/results.aspx?freetext=windows+script+host&displaylang=en&stype=s_basic](http://www.microsoft.com/downloads/en/results.aspx?freetext=windows+script+host&displaylang=en&stype=s_basic)

那么，也许微软删除了 NT 是因为它已经报废了？或者他们对 5.6 做了一个小的更新，使其与 NT 4.0 不兼容。

# ios - 如何检测iphone是否处于静音模式

> ID：833304
> 
> 赞同：19
> 
> 时间：2009-05-07T07:20:26.150
> 
> 标签：ios, objective-c, iphone, cocoa-touch, audio

我正在开发一个应用程序。在那我想通过编码检测“iPhone是否处于静音模式？”。我正在通过将可可与Objective-C一起使用来开发它。

如果有人知道，请回复。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2011-02-15T15:51:03.930

Pirrpli的代码不起作用的原因是模拟器不支持测试，代码不检查错误。更正后的代码如下所示：

```
CFStringRef state = nil;
UInt32 propertySize = sizeof(CFStringRef);
AudioSessionInitialize(NULL, NULL, NULL, NULL);
OSStatus status = AudioSessionGetProperty(kAudioSessionProperty_AudioRoute, &propertySize, &state);

if (status == kAudioSessionNoError)
{
    return (CFStringGetLength(state) == 0);   // YES = silent
}
return NO; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T11:01:23.420

可以通过使用 AudioToolBox 测试 NULL 音频路由：

```
UInt32 routeSize = sizeof (CFStringRef);
CFStringRef route;

AudioSessionGetProperty (
                         kAudioSessionProperty_AudioRoute,
                         &routeSize,
                         &route
                        );

if (route == NULL) {
    NSLog(@"Silent switch is on");
} 
```

如果 route 为 NULL，则没有可用的音频输出。如果是“耳机”或“耳机”，则静音铃声开关仍可打开。但是，当它设置为“扬声器”时，它永远不会打开。

您可能最好在音频路由更改属性侦听器中对此进行测试，该侦听器设置如下：

```
AudioSessionAddPropertyListener (
                                 kAudioSessionProperty_AudioRouteChange,
                                 audioRouteChangeListenerCallback,
                                 self
                                 ); 
```

注意：如果您正在做任何时髦的事情，比如覆盖音频路由，那么这个答案可能不适用。

完全设置和拆除音频会话可能超出了此答案的范围。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-01-15T18:15:41.910

为了完整起见，从 Dan Bon 建立[这个链接](http://randomsnippetsofusefulstuff.blogspot.com/2009/07/iphone-silent-modeswitch-state.html)，我在我的应用程序中实现了以下方法来解决这个问题。需要注意的一点是代码首先检查 iPhone 模拟器 - 执行以下代码会使模拟器崩溃。有谁知道为什么？

```
-(BOOL)silenced {
     #if TARGET_IPHONE_SIMULATOR
         // return NO in simulator. Code causes crashes for some reason.
     return NO;
     #endif

    CFStringRef state;
    UInt32 propertySize = sizeof(CFStringRef);
    AudioSessionInitialize(NULL, NULL, NULL, NULL);
    AudioSessionGetProperty(kAudioSessionProperty_AudioRoute, &propertySize, &state);
    if(CFStringGetLength(state) > 0)
        return NO;
    else
        return YES;

} 
```

在视图控制器中声明此权利，您只需检查

```
if ([self silenced]) {
     NSLog(@"silenced");

else {
     NSLog(@"not silenced");
} 
```

或者，显然，您可以在某种辅助类中声明它。一个更优雅的解决方案可能是在 UIApplication 或其他类似的类上添加一个类别......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-13T10:02:45.927

您可以按照先前答案的建议使用音频路由属性，但请记住：-仅当音频类别为 AmbientSound 时才有效-您不应在应用程序中多次初始化音频会话（请参阅音频会话编程指南）-您应该释放那些 CFStringRef 以避免内存泄漏

如果当前音频类别不是 AmbientSound，您可以考虑暂时更改它，检查 Audio Route 属性，然后恢复原始音频类别。

请注意，在给定当前硬件配置（即是否插入耳机等）的情况下，更改音频类别将恢复该类别的默认音频路由。

# asp.net - 树视图，在一层上按需加载大量节点

> ID：833306
> 
> 赞同：1
> 
> 时间：2009-05-07T07:23:04.927
> 
> 标签：asp.net, asp.net-ajax, treeview, telerik

我处于需要显示树的情况。然而，一些节点有 35000 个子节点（直接子节点！）。这当然是在可用性方面放慢速度的方式。

我宁愿看到树只加载那些在浏览器视口中可见的节点。

WinForms 和 C++ 中存在这样的树，你们中有人知道 ASP.NET 中是否存在这样的树吗？

我们目前正在使用[Telerik Treeview](http://www.telerik.com/products/aspnet-ajax/treeview.aspx)，这是一个可爱的控件，但不支持所描述的情况。

*额外的问题*

从可用性的角度来看：你如何处理这样的树。在一个级别上显示 35000 个节点很好，但是你如何在那棵树中找到一些东西呢？你在树中使用分页吗？还是搜索框？或者也许增加额外的水平？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T17:58:17.677

有了这么多节点，即使您可以找到一种高效的方式来显示它们，您的用户也可能不会很容易使用它。想象一下尝试滚动 35,000 个节点只是为了找到您感兴趣的节点！分页也是如此。用户真的要浏览 3500 页（假设页面大小为 10）来找到他们的目标吗？可能不会，如果他们这样做了，他们可能不会太高兴。:)

相反，对于像这样的大型数据集，我发现通常最好提供某种类型的“过滤器”UI。使您的用户能够将可用数据“塑造”成更易于管理的集合的东西。

我不确定您必须提供哪些过滤功能（即您可以过滤哪些字段），但我认为这是您最好的选择。UI 的选项包括：

1.  像 RadGrid for ASP.NET AJAX 这样的东西可以提供内置的过滤 UI，使用户能够快速找到他们感兴趣的值。
2.  使用 RadTreeView 的客户端 API 并支持按需加载节点，您可以创建一个文本框，在用户键入时过滤树中的节点。您只需处理 TextBox 的 onkeyup 事件，然后向 Web 服务发出请求以获取满足过滤条件的节点，并用结果替换 TreeView 的节点集合。这将使您的用户*更*容易找到他们的目标节点。

显然还有其他方法，但希望这能给你一些想法。

**简短回答：**对于大型数据集，我会结合使用实时过滤和 Web 服务来向我的用户呈现更易于管理的结果集。对于初始加载，我只会加载第一个（比方说）200 个节点以保持高性能。

希望这可以帮助！-托德

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T17:57:25.150

我知道有一些 jQuery 驱动的树控件。不知道手头的名字。ASP.NET 树控件肯定不支持这一点，因为它不是 AJAXifiable。对于显示 35000 个节点的问题，我会像这样对它们进行分页。

```
node
|
-- Sub Node 1
|
-- ...
|
-- Sub Node n
|
-- more... 
```

当您将鼠标悬停在更多或单击它时，它将获得更多节点。如果您要显示 100 个子节点，我会加载 200 个并隐藏其他 100 个。这样，当您将鼠标悬停在更多子节点上时，它会立即显示。每次你将鼠标悬停在更多...下一个隐藏的 100 被加载。

此外，现在使用所有高级浏览器创建自定义树控件并不难，使用`<ul>`和`<li>`嵌套创建节点和子节点，然后应用适当的样式。`<li>`如果您想让整个点击更容易，可以在其中包含链接。

我的两分钱。

# compilation - 使用 Clozure Common Lisp 编译二进制文件

> ID：833314
> 
> 赞同：24
> 
> 时间：2009-05-07T07:29:48.623
> 
> 标签：compilation, executable, common-lisp

给定一个简单的程序，如下所示，你会如何：

1.  将其编译为由实现加载的单独图像文件，您将使用哪些命令行参数来加载它？

2.  将其编译为可以按原样加载和运行的独立二进制文件。

    *注意：我尝试在保存应用程序时添加“：prepend-kernel t”，只是为了引发以下错误。*

    ```
    Error: value NIL is not of the
    expected type REAL. While executing: 
    CCL::<-2, in process Initial(0). 
    ```

3.  你会如何抑制欢迎信息？

    **该程序**

    ```
    (defun main ()
      (format t "This is the program.")0) 
    ```

**编辑**

讨厌回答我自己的问题的一部分，但我还是发现了它。

加载函数后，键入以下内容进行编译：

```
(ccl:save-application "app") 
```

这将创建一个图像文件。通过将其传递给实现类型来加载它（注意：“ccl”二进制文件在我的系统路径中）；

```
ccl -I app 
```

要运行顶级函数，请将其作为参数传递

```
ccl -I app --eval (main) 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-05-07T08:40:10.890

[请参阅保存应用程序](http://ccl.clozure.com/manual/chapter4.9.html#Saving-Applications)下的 Clozure Common Lisp 文档

**编译和加载 Lisp 文件**

您可以编译`/foo/bar.lisp`通过调用命名的文件

```
 (compile-file "/foo/bar.lisp") 
```

这将创建一个包含本机代码的 fasl（快速加载）文件*。*

您可以使用函数加载已编译的文件 fasl 文件`LOAD`。`LOAD`并且`COMPILE-FILE`是标准的 Common Lisp 函数。

**创建应用程序**

几个定义：

*   *CCL 内核*：CCL 的一部分，提供内存管理等低级运行时服务。
*   *图片*：保存的 Lisp 堆转储
*   *应用*：CCL内核+镜像。这可以在一个文件中。

您可以通过调用 CCL 特定函数来保存应用程序：

```
(save-application "/foo/bar-image" :toplevel-function #'main) 
```

这将保存一个图像，您可以从命令 shell 使用 CCL 内核运行该图像：

```
ccl -I /foo/bar-image 
```

要保存包含内核的可执行文件，请在 Lisp 中使用：

```
(save-application "/foo/bar-app"
                  :toplevel-function #'main
                  :prepend-kernel t) 
```

`/foo/bar-app`您可以像往常一样从命令外壳调用此可执行文件。

在 Clozure Common Lisp 中，您可以检查

```
*command-line-argument-list* 
```

对于提供的命令行参数列表。

# asp.net - ASP.NET 2.0 中的模拟

> ID：833315
> 
> 赞同：2
> 
> 时间：2009-05-07T07:30:46.780
> 
> 标签：asp.net

再会，

我的 Web 应用程序设置为使用 Windows 身份验证，并且 Impersontation 设置为 true。

我不想使用登录的用户帐户启动进程。但是，当我尝试启动 notepad.exe 时，它​​作为网络服务运行。

我尝试了不同的模仿技术，但都没有奏效。

请帮忙。

[http://msdn.microsoft.com/en-us/library/ms998351.aspx#paght000023_impersonatingbyusingwindowsidentity](http://msdn.microsoft.com/en-us/library/ms998351.aspx#paght000023_impersonatingbyusingwindowsidentity)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T08:59:31.373

简单的模拟不允许您以其他用户身份启动进程。您必须使用`CreateProcessAsUser`Windows API 以及适当的权限

该`CreateProcessAsUser`功能不需要用户的密码。它需要一个可以从对象中获取的*主令牌。*`System.Security.Principal.WindowsIdentity`您的 ASP.NET 进程必须具有*作为操作系统*特权的一部分的 Act 才能获得模拟级令牌。

[**How To: Use Impersonation and Delegation in ASP.NET 2.0**](http://msdn.microsoft.com/en-us/library/ms998351.aspx)包含有关此主题的所有详细信息。

一个也可能相关的相关问题是：[使用 Process.Start() 从 Windows 服务中以不同用户身份启动进程。](https://stackoverflow.com/questions/362419/using-process-start-to-start-a-process-as-a-different-user-from-within-a-window)

# c - C 语言中的契约式设计，用于自动定理证明

> ID：833316
> 
> 赞同：5
> 
> 时间：2009-05-07T07:30:59.603
> 
> 标签：c, automated-tests, design-by-contract

我正在处理几个 C 项目，我想使用自动定理证明来验证代码。理想情况下，我只想使用 ATP 来验证功能合同。C/gcc 或外部软件/包/等中是否有任何功能可以实现按合同设计风格的编码？

如果不是，那只是我自己开始的动力。

我对此的参考可能是来自 MSR 的 Spec# 或 Sing#，但我是一名开源人员，我正在寻找开源解决方案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-10-31T18:48:26.040

开源：检查。

自动定理证明：检查。

您应该非常喜欢[Frama-C](http://frama-c.cea.fr/)及其[ACSL](http://frama-c.cea.fr/acsl.html)规范语言。您可能已经听说过它的 Caduceus 祖先，但目前它被认为已被 Frama-C/Jessie 取代。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T07:53:58.720

显然它没有内置在语言中，但是有很多附加组件可以让您继续前进。它们中的大多数是测试版——但您可能会考虑为它们做出贡献，而不是自己开始。

RubyForge[的 C 合同设计](http://rubyforge.org/projects/dbc/)，看起来很有前途。[GNU Nana](http://www.gnu.org/software/nana/)已经存在了很长时间，可能会很好地满足您的需求。希望这些是有帮助的。

编辑：在 O'Reily 上查看[这篇](http://www.onlamp.com/pub/a/onlamp/2004/10/28/design_by_contract_in_c.html)关于 C 合同设计的文章：

> 对 assert() 不满意并对契约式设计感到兴奋，我开始为 C 创建自己的契约式设计实现。在查看了一些可用于 Java [1](http://rubyforge.org/projects/dbc/)的解决方案后，我决定使用对象约束语言的一个子集来快递合同[4]。使用 Ruby 和 Racc，我为 C 创建了 Design by Contract，这是一个代码生成器，可以将嵌入在 C 注释中的合同转换为 C 代码以检查合同。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-26T20:12:58.523

如果您对使用定理证明器验证 C 代码感兴趣，您应该查看[VCC 项目](http://vcc.codeplex.com/)。从他们的网页：

> VCC 是并发 C 程序的机械验证器。VCC 采用一个 C 程序，用函数规范、数据不变量、循环不变量和幽灵代码进行注释，并尝试证明这些注释是正确的。如果成功，VCC 承诺您的程序实际上符合其规范。

VCC 是[微软研究院](http://research.microsoft.com/)非常成熟的系统，已经用于验证[微软 Hyper-V](http://www.microsoft.com/servers/hyper-v-server/default.mspx)的管理程序。VCC 也是开源的。

# sql - raiseerror sql server 静默消息

> ID：833321
> 
> 赞同：0
> 
> 时间：2009-05-07T07:33:10.550
> 
> 标签：sql, sql-server-2005

如何在 SQL Server 触发器中使用 ROLLBACK TRANS 而不获取标准消息？

“消息 3609，级别 16，状态 1，第 1 行事务在触发器中结束。批次已中止。”

这正在返回给客户。我希望 ROLLBACK 以静默方式完成。我只需要在触发器内实现这一点；即没有c# 或.NET 代码更改来捕获错误消息。

让我补充一点，这是对最近添加的功能的“肮脏”解决方法。当我们添加新功能时，客户不喜欢它。而不是紧急发布代码库，我们刚刚杀死了触发器内的更新。调用代码是客户端应用程序中的嵌入式 SQL，而不是存储过程。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T07:46:30.220

麻烦的是，触发器内部的回滚意味着在基础表中插入/更新或删除的行恢复原状，这意味着数据库未能执行原始程序要求它执行的操作。

您的调用代码是直接更新表，还是调用更新表的存储过程？后者为静默处理回滚提供了更多空间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-09T13:17:30.977

你想要的是一个[INSTEAD OF](http://technet.microsoft.com/en-us/library/ms175521.aspx)触发器，它实际上不对更新的行做任何事情。

# jsp - 如何检查用户是否在 JSP 中具有特定角色？

> ID：833322
> 
> 赞同：3
> 
> 时间：2009-05-07T07:34:02.933
> 
> 标签：jsp, roles

我需要根据用户的角色在 JSP 中做出决定。是否有标签或 EL 表达式可以让我这样做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T07:37:51.257

JSP 或 JSTL 中没有内置标签，但来自 Jakarta 项目的[request taglib](http://jakarta.apache.org/taglibs/doc/request-doc/)[`isUserInRole`](http://jakarta.apache.org/taglibs/doc/request-doc/#isUserInRole)提供了一个标签。[安装](http://jakarta.apache.org/taglibs/doc/request-doc/index.html#config)taglib，并像这样使用标签：

```
<req:isUserInRole role="admin">
 The remote user is in role "admin".
</req:isUserInRole>
<req:isUserInRole role="admin" value="false">
 The remote user is not in role "admin".
</req:isUserInRole> 
```

# user-interface - 黑莓应用程序中的滚动问题

> ID：833324
> 
> 赞同：1
> 
> 时间：2009-05-07T07:35:12.620
> 
> 标签：user-interface, blackberry, navigation, rim-4.5

我无法使用轨迹球滚动浏览应用程序屏幕。我正在使用 Blackberry Pearl 8100 模拟器。请帮忙。

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T07:44:26.590

它可以在其他模拟器上工作，而不是在 8100 上工作吗？真正的手机怎么样？

对于您的屏幕类，您可以尝试使用 style 属性专门告诉它进行垂直滚动，

```
super(MainScreen.VERTICAL_SCROLL | MainScreen.VERTICAL_SCROLLBAR); 
```

同样，您应该确保它没有设置为

```
super(MainScreen.NO_VERTICAL_SCROLL) 
```

# php - PHP 只从长字符串中删除一个字母一次？

> ID：833325
> 
> 赞同：1
> 
> 时间：2009-05-07T07:35:44.397
> 
> 标签：php, string

我需要从字符串中删除单个字符，例如在下面的文本块中，我需要能够删除其中一个 j。

djriojnrwadoiaushd

离开：

德里奥恩鲁瓦多伊阿什德

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T08:16:04.283

*您还可以将 str_relpace 与 $count 参数一起使用： $str = 'djriojnrwadoiaushd'; echo str_replace('j', '', $str, 1);*

Ups，对不起..我的错。

* * *

这是一个真正的方法：

```
$str = 'djriojnrwadoiaushd';
$pos = strpos( $str, 'j' );
if( $pos !== FALSE )
{
    echo substr_replace( $str, '', $pos, 1 );
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T07:40:08.130

只需使用子字符串：

```
<?php

$str = 'djriojnrwadoiaushd';
$remove = 'j';

$index = strpos($str, $remove);
if ($index !== false)
    $str = substr($str, 0, $index) . substr($str, $index + 1);

echo $str;

?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T07:41:53.027

退后一步——我知道正则表达式；

```
$newString = preg_replace("/".preg_quote($stringToReplace)."/", '', $inputString, 1); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T07:39:21.377

试试这个：

```
$needle = 'j';
if (($pos = strpos($str, $needle) !== false) {
    $str = substr($str, 0, $pos) . substr($str, $pos+strlen($needle));
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T07:40:19.143

[strpos()](http://be2.php.net/manual/en/function.strpos.php)返回大海捞针中第一根针的位置，即。字符串中的第一个 j 。然后删除该字母非常简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T07:46:10.533

您还可以使用 PHP 中的字符串是数组这一事实，并删除与 'j' 对应的元素：

```
$str[strpos($str, 'j')] = null; 
```

# mercurial - Mercurial“汞状态”和相对路径

> ID：833326
> 
> 赞同：31
> 
> 时间：2009-05-07T07:36:47.950
> 
> 标签：mercurial

我将 mercurial 和 git 用于不同的项目，并且都喜欢它们。我觉得 mercurial 有点烦人的是，“hg status”显示了相对于存储库根目录的路径，而不是当前目录（与 git 不同）。可以以某种方式调整这种行为吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-05-22T01:39:39.533

要查看相对于当前目录的工作区状态，您始终可以使用“。” （一个点）作为“hg status”的参数，即：

```
% hg root                   # root of the workspace
/work/foo

% pwd                       # current directory is <root>/src
/work/foo/src

% hg status                 # no argument, see all files
M etc/foo.conf              # all files are shown with paths
M src/foosetup.c            # relative to workspace root
% 
```

当您明确要求当前工作目录时，不同之处在于相对文件名路径使用它作为起点：

```
% hg status .               # see only files under current path
M foosetup.c
% 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-05-07T07:57:42.363

通常的解决方法是运行：

```
hg status $(hg root) 
```

对于 1.7 之前的旧版本 Mercurial，您可以使用此 hack，将其添加到存储库的“.hg/hgrc”文件中：

```
[alias]
 sst = status /path/to/root 
```

这需要启用别名扩展，因此您可能必须将“alias=”添加到您的 ~/.hgrc 文件中。

从 Mercurial 1.7 开始，别名扩展了解了“！” 转义以使用 shell 命令，因此您现在可以拥有一个全局别名来执行此操作：

```
[alias]
sst = !hg status $($HG root) $HG_ARGS 
```

不要使用`st = !hg status $(hg root)`，因为这会创建一个无限循环，一遍又一遍地运行 hg status 。它看起来像别名解析中的一个错误 - 如果您想要别名`hg status`以显示从根目录开始的路径，那么以下咒语在全局 $HOME/.hgrc 中有效：

```
[alias]
__mystatus = status
st = !hg __mystatus $($HG root) $HG_ARGS 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-10-14T10:42:29.913

自旧的 mercurial 版本（>= 2008 年的**1.1**）以来的标准工作方式是：

```
hg status re: 
```

产生：

```
M ../contrib/buildrpm
M ../hg
M httprepo.py 
```

从 mercurial **1.3** (2009) 开始，您可以根据`alias`需要定义：

```
[alias]
sst = status re: 
```

这种行为最终记录在**3.4** (2015) 中：

```
$ hg help status --verbose
[...]
- show changes in the working directory relative to the current directory
  (see 'hg help patterns' for more information):

    hg status re: 
```

自 mercurial **4.2**（2017 年 5 月）以来，您可以告诉 status 命令始终打印相对路径，将其放入您的`hgrc`：

```
[commands]
status.relative = True 
```

直接在命令行上测试（hg >= 4.2）：

```
$ hg --config commands.status.relative=True status
M ../contrib/buildrpm
M ../hg
M httprepo.py 
```

最后，引入了mercurial **4.3**[`ui.tweakdefaults`](https://www.mercurial-scm.org/wiki/FriendlyHGPlan)，其中包括将一些默认设置更改为更现代的默认设置：

```
[ui]
# hg status prints relative paths
# hg diff produces patches in git format
tweakdefaults = True 
```

如果您使用的是现代 mercurial (>=4.3)，这是官方推荐的方式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-04-04T12:46:26.657

Hg 随着时间的推移越来越好：使用 hg 2.2.3，我可以定义`st`别名。

```
[alias]
st = !hg status $($HG root) $HG_ARGS 
```

最后：

*   `hg st`将为您提供相对于当前目录的路径
*   `hg status`将为您提供相对于 hg 根目录的路径

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-12-12T19:34:50.110

我添加这个答案不是因为它比公认的答案更好，而是因为它澄清了“hg status”之间的区别。和“汞状态 $（汞根）”。这可能会让一些评论者感到困惑——更糟糕的是，这可能会导致忘记检查必要的东西。

“汞状况。” 仅使用相对路径报告 . 下面的子树的状态。

“hg status $(hg root)”使用相对于 CWD 的路径报告整个 repo 的状态。

两者都很有用。

（一般来说，“hg status path”显示路径下子树的状态（整个 repo if path = $(hg root)”，但相对于 CWD。（我必须承认我觉得这很混乱，因为有两件事发生：获取状态的子树，以及显示相对路径的 cwd。））

下面嵌入的 shell 会话示例显示了这一点。

```
$ bash [~/hack] 562 $> mcd hg-test
./hg-test
$ bash [~/hack/hg-test] 563 $> hg init .
$ bash [~/hack/hg-test] 564 $> mkdir subdir
$ bash [~/hack/hg-test] 565 $> touch foo
$ bash [~/hack/hg-test] 566 $> touch subdir/bar
$ bash [~/hack/hg-test] 567 $> hg status
? foo
? subdir/bar
$ bash [~/hack/hg-test] 552 $> hg status $(hg root)
? foo
? subdir/bar
$ bash [~/hack/hg-test] 552 $> cd subdir
./subdir
$ bash [~/hack/hg-test/subdir] 553 $> hg status
? foo
? subdir/bar
$ bash [~/hack/hg-test/subdir] 553 $> hg status .
? bar
$ bash [~/hack/hg-test/subdir] 513 $> hg status $(hg root)
? ../foo
? bar
$ bash [~/hack/hg-test/subdir] 523 $> hg status
? foo
? subdir/bar 
```

因此，如果你想做一些事情，比如在本地子树中备份文件，而不签入，然后恢复（我在使用“hg lock”时经常需要这样做，因为我使用的是无法区分的 FrameMaker 文件或合并到 hg 中（或几乎没有）：

```
$ bash [~/hack/hg-test/subdir] 523 $> mkdir bak; hg status -n . | xargs cp --target-directory bak
$ bash [~/hack/hg-test/subdir] 524 $> ls bak
bar 
```

但是，如果您要备份树中按状态报告的所有文件

```
$ bash [~/hack/hg-test/subdir] 528 $> mkdir bak-root; hg status -n $(hg root) | xargs cp --target-directory bak-root
cp: will not overwrite just-created `bak-root/bar' with `bar'
$ bash [~/hack/hg-test/subdir] 529 $> ls bak-root
bar  foo 
```

顺便说一句，警告显示了文件名冲突的问题。我通常使用一个小工具，我必须添加一个 .bak 后缀或 xargs。但是这个例子就足够了。

顺便说一句^2，我通常用“hg status -nm”做这样的事情，但上面的例子就足够了。

# sql-server - 数据库表定义中的列排序是否有标准/约定？

> ID：833329
> 
> 赞同：1
> 
> 时间：2009-05-07T07:37:35.423
> 
> 标签：sql-server, database, conventions

是否有关于如何在数据库表的定义中对列进行排序的标准/约定，如果有，该标准的动机是什么？（优点缺点）

例如，主键应该是第一列吗？外键应该直接跟在主键之后还是应该放在表的最右边？

如果不同 DBMS 的约定之间存在差异，则本例中的 DBMS 是 Microsoft SQL Server 2005。

谢谢/埃里克

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T07:41:50.747

我不知道任何标准，但我们构建列的方式是

1.  主键
2.  任何外键
3.  数据

我们的*大*数据列，如评论，放在最后。它使在查询分析器中查看尽可能多的数据变得更加容易，而无需向右滚动。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T08:28:18.250

我总是这样组织我的表格：

1.  主键
2.  “跟踪”列（DateModified、ModifiedBy 等）
3.  任何外键
4.  数据

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T07:40:58.817

我不确定设置约定，但我们总是将 ID/主键列作为表中的第一列。我想这只是因为它可以更清楚地看到pk。我会说也可以使用 fk 字段，但在那之后没有真正的标准，你也许可以通过数据类型来做到这一点？

此外，这不是一个既定的最佳实践，只是个人选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T07:42:17.843

据我所知没有。无论如何，您始终可以在选择期间重新排序列，因此除非有一些真正模糊的优化，否则您可以通过适当地对列进行排序来对某些数据库进行一些真正模糊的优化。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T07:44:55.967

我知道没有官方标准，但通常的做法是将主键放在第一位（通常是代理项），然后按功能对其他字段进行分组。因此，在“人员”表中，可以将包含人员地址数据的字段组合在一起。大多数人在适当的表定义之外添加 FK、索引和其他约束。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T07:41:51.323

毫米..据我所知，没有限制。它只是一个清晰的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T08:45:39.660

我同意上面的大多数帖子，主键优先（至少）。其余的都是个人喜好。如果你有一个标准，那就坚持那个标准。

我确实更喜欢将列相当合乎逻辑地放在一起。有时完全规范化的数据结构是不合适的，因此您将“次要实体”存储在同一个表上（即不删除 NULL）。一个示例是地址字段，或者放在一起的不同电话、移动电话、工作电话列。

我能举出的最引人注目的例子是如何不做。如果开发人员自动生成模式并按字母顺序创建列（甚至 PK 隐藏在表结构的中间），那是最烦人的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-07T08:49:50.663

根据edoode：-

```
Primary key(s) 
'Tracking' columns (DateModified, ModifiedBy and such) 
Any foreign keys 
Data 
```

加

```
Fixed width 'not null' columns
Fixed width 'nullable' columns
Variable Width columns VARCHAR NVARCHAR etc.
CLOBS
BLOBS 
```

如果您将长度可能不同的列粘贴在表格底部，您将获得非常微小的性能提升。

# iphone - iPhone开发：有多糟糕

> ID：833338
> 
> 赞同：1
> 
> 时间：2009-05-07T07:40:10.987
> 
> 标签：iphone, interface-builder

作为 Cocoa 开发的相对新生（我目前正在开发 iPhone 应用程序），我想知道 Interface Builder 报告的“非法几何”是否真的有害，或者以任何方式妨碍我的应用程序的功能或性能。我真的尽量避免重叠兄弟姐妹，但有时，出于审美原因，这只是必要的。但是，如果我在做非法的事情，我什么都不会注意到。它会在意想不到的情况下对我不利吗？它在技术上是非法的，还是违反了 Apple 的人机界面指南？非常感谢您的洞察力。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T18:16:51.657

重叠不是问题。随意忽略警告。当然，请确保您本着良好的 UI 设计精神来做这件事。

真正的问题是负宽度/高度或其他可能导致应用程序崩溃的完全超出范围的设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T18:28:53.360

需要注意的一件事 - 苹果非常重视其界面指南。我知道有一些人的应用因轻微违规而被应用商店拒绝。

# c++ - 计算 2 TDateTime 之间的时间，稍加改动

> ID：833340
> 
> 赞同：0
> 
> 时间：2009-05-07T07:40:26.430
> 
> 标签：c++, time, c++builder, tdatetime

我需要找出如何获得两次之间的时间，但前提是它在工作时间内（存储在数据库中）

这是我现在得到的，但这是完全错误的。总数不会正确。

```
int __fastcall Organisasjon::CalculateResponsetimeInOpeninghours(std::auto_ptr<DBCommand> cmd, long orgid, TDateTime starttimeIn, TDateTime endtimeIn)
{
int totalTimeInQueue = 0;
String sIsWorkDay = "";

String s  =  "SELECT o.isworkday, o.workdate, o.workstarttime, o.workendtime " \
                 "FROM orgwdexcep o " \
                 "WHERE o.workdate = :date " \
                 "AND o.orgid = :orgid ";
String s2 =  "SELECT o.isworkday, o.workdate, o.workstarttime, o.workendtime " \
                 "FROM globalwodexcep o " \
                 "WHERE o.workdate = :date ";
String s3 =  "SELECT o.workstarttime, o.workendtime " \
                 "FROM organizationworkday o " \
                 "WHERE o.weekdayindex = :weekdayindex " \
                 "AND o.orgid = :orgid ";
double MailThisDayStart = starttimeIn;
double MailThisDayEnd = endtimeIn;

while ((int)MailThisDayStart <= (int)endtimeIn)
{//for each day i period.
    if((int)MailThisDayStart != (int)endtimeIn)
    {
        MailThisDayEnd = (double)((long)MailThisDayEnd) + 1;
}
    cmd->setCommandText(s);
    cmd->Param( "date" ).setAsDateTime() = DBDatabase::ConvertToSADateTime(MailThisDayStart);
    cmd->Param("orgid").setAsLong() = orgid;
    cmd->Execute();
    if (!(cmd->isResultSet() && cmd->FetchNext()))
    {
        cmd->setCommandText(s2);
        cmd->Param( "date" ).setAsDateTime() = DBDatabase::ConvertToSADateTime(MailThisDayStart);
        cmd->Execute();
    }
    if(cmd->isResultSet() && cmd->FetchNext())
    {
      sIsWorkDay = String(cmd->Field("isworkday").asString());
    }
    else
    {
        int dayOfTheWeek = DayOfTheWeek(MailThisDayStart);
        cmd->setCommandText(s3);
        cmd->Param("weekdayindex").setAsLong() = dayOfTheWeek;
        cmd->Param("orgid").setAsLong() = orgid;
        cmd->Execute();
        if(cmd->isResultSet() && cmd->FetchNext())
        {
            sIsWorkDay = "T";
  }
    }
    if(sIsWorkDay == "T")
    {
        TDateTime tmpOpeningStart =  TDateTime(cmd->Field("workstarttime").asDateTime());
        TDateTime tmpOpeningEnd = TDateTime(cmd->Field("workendtime").asDateTime());
        double dtmpOpeningStart = tmpOpeningStart- (int)tmpOpeningStart;
        double dtmpOpeningEnd = tmpOpeningEnd- (int)tmpOpeningEnd;

        totalTimeInQueue +=  Organisasjon::CountHours(MailThisDayStart, MailThisDayEnd, dtmpOpeningStart, dtmpOpeningEnd,(int)MailThisDayStart);
    }
    MailThisDayStart++;//increase date by one
    MailThisDayStart = (double)((long)MailThisDayStart);
}
return totalTimeInQueue;
}

int __fastcall Organisasjon::CountHours(double MailTimeStart, double MailTimeEnd, double openingTimeStart, double openingTimeEnd, int DayToCompute)
{
   if(MailTimeEnd<openingTimeStart)
   {
       return 0;
       }
   if(MailTimeStart<(DayToCompute+openingTimeStart))
   {
       MailTimeStart=openingTimeStart;
   }
   else
   {
        MailTimeStart=MailTimeStart-(int)MailTimeStart;
   }
   if(MailTimeEnd>(DayToCompute+openingTimeEnd))
   {
    MailTimeEnd=openingTimeEnd;
   }
   else
   {
    MailTimeEnd=MailTimeEnd-(int)MailTimeEnd;
   }
   TDateTime dt = TDateTime((MailTimeEnd - MailTimeStart));
   unsigned short milli;
   unsigned short sec;
   unsigned short min;
   unsigned short hour;
   dt.DecodeTime(&hour,&min,&sec,&milli);
   int total = hour*3600;
   total += min*60;
   total += sec;
   return total;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T11:44:03.113

你想看什么`total`？

试试这个例子：

```
TDateTime MailTimeEnd = TDateTime::CurrentTime();;
MailTimeEnd += 1.0 / 24;
TDateTime MailTimeStart = TDateTime::CurrentTime();
TDateTime dt = TDateTime((MailTimeEnd - MailTimeStart));
unsigned short milli;
unsigned short sec;
unsigned short min;
unsigned short hour;
dt.DecodeTime(&hour,&min,&sec,&milli);
int total = hour*3600;
total += min*60;
total += sec; 
```

`total == 3600`. 这是正确的。

# vb.net - 来自 Web 服务的模糊类型数据的属性异常处理

> ID：833348
> 
> 赞同：1
> 
> 时间：2009-05-07T07:42:56.767
> 
> 标签：vb.net, web-services, exception-handling

我需要使用来自网络服务的数据。我正在接收 xml 数据并使用它通过属性设置器创建对象。

在一种特定情况下，对象的一个​​属性（称为“is_active”并指示对象在应用程序中是活动的还是非活动的）有时表示为

```
<field type="BooleanField" name="is_active">1</field> 
```

而在其他时候

```
<field type="BooleanField" name="is_active">True</field> 
```

客户端代码要求我使用整数 1 和 0 来表示。返回的字符串“True”或“False”会导致 System.FormatException，正如预期的那样。

处理这种情况的最优雅的方法是什么？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T07:53:06.243

你用什么来处理数据？由于这显然是自定义序列化，因此您似乎应该能够调整“BooleanField”处理来处理这两者......

但是，IMO，您没有按照预期的方式使用 xml ......将其指定为元素/属性会更容易，就像如何`XmlSerializer`（确实 - 为什么不只使用`XmlSerializer`？）：

```
<isActive>true</isActive> 
```

或者

```
<foo ... isActive="true" ... /> 
```

请注意，真/假的 xml 标准是小写的......

* * *

此外; 如果您正在使用`TypeConverter`- 您可以更改转换器：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
public class Program
{
    static void Main()
    {
        TypeDescriptor.AddAttributes(typeof(bool),
            new TypeConverterAttribute(typeof(MyBooleanConverter)));

        TypeConverter conv = TypeDescriptor.GetConverter(typeof(bool));
        Console.WriteLine((bool)conv.ConvertFrom("True"));
        Console.WriteLine((bool)conv.ConvertFrom("true"));
        Console.WriteLine((bool)conv.ConvertFrom("False"));
        Console.WriteLine((bool)conv.ConvertFrom("false"));
        Console.WriteLine((bool)conv.ConvertFrom("0"));
        Console.WriteLine((bool)conv.ConvertFrom("1"));
    }
}

class MyBooleanConverter : BooleanConverter
{
    static readonly Dictionary<string, bool> map
        = new Dictionary<string, bool>(StringComparer.OrdinalIgnoreCase)
        { { "true", true }, { "false", false },
          { "1", true }, { "0", false } };

    public override object ConvertFrom(ITypeDescriptorContext context,
        System.Globalization.CultureInfo culture, object value)
    {
        string s = value as string;
        bool result;
        if (!string.IsNullOrEmpty(s) && map.TryGetValue(s, out result))
        {
            return result;
        }
        return base.ConvertFrom(context, culture, value);
    }
} 
```

# windows-mobile - 适用于 Windows Mobile 的 Windows 服务

> ID：833353
> 
> 赞同：1
> 
> 时间：2009-05-07T07:44:51.503
> 
> 标签：windows-mobile, compact-framework

我们可以为 windows mobile（紧凑框架）编写一个 windows 服务，该服务应在设备启动时激活。你能请吗？提供相同的资源/示例代码的链接。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T08:16:14.377

您不能使用 Compact Framework 来开发 Windows 服务。这是 MSDN 中关于为 Windows CE 编写服务的[文章](http://msdn.microsoft.com/en-us/library/aa446909.aspx)。

对于常规应用程序，这个[问题](https://stackoverflow.com/questions/433325/running-background-services-on-a-pocketpc)有一些关于如何使其在启动时自动启动的想法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T13:42:33.377

您可以查看一个 CodePlex 项目，该项目可能是您在 Windows 移动设备上创建 Windows Server 的最佳选择。

还有一篇相关的博客文章，您可以查看更多详细信息。

[适用于 Windows Mobile 的托管服务](http://www.codeplex.com/managedserviceswm)

[托管代码中的 Windows Mobile 服务](http://bansky.net/blog/2008/04/services-for-windows-mobile-in-managed-code/)

# python - 如何在不进入任务托盘的情况下运行脚本？

> ID：833356
> 
> 赞同：1
> 
> 时间：2009-05-07T07:45:26.073
> 
> 标签：python

我有一个计划任务，它每 10 分钟运行一次 python 脚本

所以事实证明，我的桌面上每 10 分钟就会弹出一个脚本

我怎样才能使它立于不败之地，以便我的脚本可以在后台运行？

有人告诉我 pythonw 会完成这项工作，但我不知道如何使用它

有什么帮助吗？谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T07:58:06.573

> 有人告诉我 pythonw 会完成这项工作，但我不知道如何使用它

通常您只需将文件扩展名重命名为 .pyw。然后它将由pythonw执行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T07:50:13.317

设置计划任务以最小化启动脚本。

# security - 除了密码保护之外，如何改进对 MS Access MDB 的保护？

> ID：833358
> 
> 赞同：2
> 
> 时间：2009-05-07T07:46:28.083
> 
> 标签：security, ms-access, protection

我有一个受密码保护的 mdb 访问权限，但可以在 1 秒内通过在 google 中找到的免费工具轻松破解。除了支付一些昂贵的工具外，有没有什么好的方法可以保护 ms 访问数据库文件？我正在考虑对其进行加密，然后通过 dll 对其进行解密，获取一些数据，并将其传递给第三方应用程序，然后在连接关闭时再次加密文件。

如果有人愿意评论这种方法的谬误，或者有其他一些资源、工具等，那就太好了。

谢谢 ：）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T07:57:13.083

Access是老数据库，为什么不是SQL Express 2005（witch是免费的）？您将获得更多关于安全性的信息，并且在您的应用程序中，您在连接中使用了一个没有人知道也看不到它的用户/密码……如果他们尝试打开 SQL，他们只会看到数据库名称，并且没有别的（记住使用 SQL 身份验证而不是 Windows 身份验证）

如果您使用的是 .NET，在您的安装程序中，您可以告诉仅在安装 SQL 2005 Express 之后安装您的应用程序，或者如果使用其他语言，请使用 InstallShield、FinalBuilder 等来执行相同的操作...

:)

当我这样做时，您认为我“挣扎”... Access 已经开始响应时间很差，一个表中有超过 30k 行（来自 Microsoft 的引用），如果您要创建一个层来加密/解密数据.. .您的应用程序将从缓慢变为根本无法运行...这是个好主意吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T23:08:41.393

我完全赞成在合适的地方使用 Jet，但是当您开始担心密码保护数据超出了 NTFS 安全性和 Jet ULS 所能提供的范围时，您就处于需要使用不同数据存储的领域。

但是让我这样说：

安全不是一个技术问题——它是一个人的问题。没有安全措施可以保护您免受希望您生病的具有管理员权限的用户的侵害。您*始终*必须足够信任他人，才能授予他们查看和编辑您的数据的权限。很多时候，重点是如何让未经授权的用户远离您的数据，而不是设计您的应用程序以保护您的数据免受*授权*用户可能造成的损害。前者非常简单，而后者需要非常仔细地注意安全设置，以及设计应用程序的方式。

最后，您必须相信人们会负责任地行事，而 Jet 或 SQL Server 无法帮助您做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T08:32:48.940

从 MDB 格式更新为 ACCDB (Access2007) 格式怎么样？

[Access 2007 安全性入门](http://office.microsoft.com/en-us/access/HA101980471033.aspx)

“Office Access 2007 中的加密工具结合并改进了两个较旧的工具——数据库密码和编码。当您使用数据库密码加密数据库时，您会使其他工具无法读取所有数据，并强制用户输入密码以使用数据库。Access 2007 中应用的加密使用了比 Access 早期版本中使用的更强的算法..."

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T09:34:19.620

如果您只是想保护数据，或者您是否想保护其他东西，例如专门说 VBA 代码，我不清楚阅读您的帖子。您说您有一个 mdb 文件，但您使用的是 Access 2003、2007 还是其他版本？您/您是否计划在 Intranet 站点上部署 Access 解决方案？**（对于我下面的评论，我将假设您是）。**

我同意其他海报的观点，如果您有机会在部署基于 Access 的解决方案之前考虑其他解决方案，那么您应该这样做。但是，如果您无法避免使用基于 Access 的解决方案，我想分享以下建议和/或评论。

1.  如果您正在使用 Access 2003，那么您可能需要考虑用户和组级别的安全性（用户/组级别的安全设置和配置在 Access 2007 (accdb) 格式数据库中不可用，但是 Access 2007 将识别来自 mdb 文件的用户/组权限. 使用用户/组级别的安全性，您可以根据定义的用户和工作组限制对数据库的访问。有关更多信息 - [ [http://office.microsoft.com/en-us/access/HP051882261033.aspx][1]](http://office.microsoft.com/en-us/access/HP051882261033.aspx][1])

2.  考虑拆分您的数据库（将您的数据与您的应用程序对象（例如表单、报告）分开）和/或创建限制可用对象的不同版本。

3.  保留设计大师和生产复制品。这与之前的评论一致，其中的想法是并非所有东西都摆在桌面上。您可能想要查看适用于 2003 和 2007 的 Access Developer Extensions（如果您还没有的话）（可从 Microsoft 免费下载和安装）。

4.  尽可能采用阻止和/或限制员工或同事访问的政策（我再次假设您正在公司 Intranet 上进行部署）

5.  编码您的数据库。这将使您的表的属性信息、VBA 代码更难检索，因为数据库将被压缩，并且任何设计级别的信息都将被删除或更难访问。

6.  最后，如果您有时间、资源和/或附近的图书馆/书店有可用的副本，我建议您查看**Alison Balter 掌握的 Microsoft Office Access 2003**，查看开发多用户和企业应用程序部分，其中有关于安全的部分。ACCESS 2007 更新：**Alison Balter 掌握 Microsoft® Office Access 2007 开发**

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T07:53:51.797

以加密格式保存数据将是一种解决方案。如果密码“失败”，破解者也必须解密数据

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T08:01:45.880

无论您使用什么方法，知识渊博的人都可以破解。

这真的取决于数据的价值：如果它真的很有价值，我会使用不同的模型，比如将数据库放在互联网上的服务器后面。然后你可以限制查询的数量，以及过滤误用。

如果可以追踪泄漏或使用有限，则最好不要使用许可协议保​​护数据。至少那时你可能有办法弥补你的损失。请注意，[OED](http://en.wikipedia.org/wiki/Oxford_English_Dictionary#Electronic_versions)最近取消了其复制保护。

还要考虑未来：一些网络管理员在 10 年后可能需要合法地访问数据，使用简单的密码将表明数据*应该*受到保护，但仍然允许规避。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T08:39:17.770

对于桌面应用程序，我建议您走[Sql Server Compact Edition (SQLCE)](http://www.microsoft.com/Sqlserver/2005/en/us/compact.aspx)的路线。或者，如果您有一点钱，[VistaDB](http://www.vistadb.net/)（与 SQLCE 不同，它支持存储过程、视图和触发器）。您将获得更好的安全性、更好的性能、更少的维护和损坏问题以及更轻松的部署。

# c# - 如何从 DropDownList 选择更改文本框中的数据显示？

> ID：833370
> 
> 赞同：0
> 
> 时间：2009-05-07T07:52:37.117
> 
> 标签：c#, asp.net, data-binding, .net-3.5

大家好，作为我发布的主题。我真的需要知道，如何从 DDL 中获取可以自动更改 TextBox 显示的结果。我们的每件商品都有不止一个尺码，有时当您点击不同尺码时价格会有所不同。我该如何实现这个功能？

任何帮助，我将不胜感激。

这是我的示例代码：

**详细信息.aspx：**

```
<asp:TemplateField SortExpression="Size" ItemStyle-Wrap="True" ItemStyle-HorizontalAlign="Left" ItemStyle-VerticalAlign="Bottom" HeaderStyle-Wrap="False" HeaderText="Options">
  <ItemTemplate>
    Size:<asp:DropDownList ID="DropDownList1" runat="server" DataSourceID="SizeSource" AutoPostBack="true" DataTextField="Size" DataValueField="Size" Height="22px" Width="60px">
    </asp:DropDownList>
    &nbsp;&nbsp;&nbsp;&nbsp; Qty:<asp:TextBox ID="TextBox2" runat="server" Height="16px" Width="30px" Text="<%# 1 %>"></asp:TextBox>
    <br />
    Price(USD):
    <asp:TextBox runat="server" DataSourceID="SizeSource" SortExpression="Price" DataFormatString="{0}" ID="PriceList" Width="50px" Height="16px" ValidationGroup="Price" AutoPostBack="True" />
    <asp:SqlDataSource ID="SizeSource" runat="server" ConnectionString="<%$ ConnectionStrings:LIFEbabySAP %>" SelectCommand="SELECT left(T0.ItemCode,8) as Image, left(T0.ItemCode,8) as Code, T0.U_ItemName as Name, T0.U_Size as Size, T0.U_Colour as Color,case T1.Onhand when 0 then 'Out of Stock' else 'In Stock' end as Availability, T0.UserText as Description, CAST(T2.Price as Int)as Price FROM OITM T0 inner join oitw T1 on T0.ItemCode = T1.Itemcode inner join itm1 T2 on T0.ItemCode = T2.ItemCode WHERE (left(T0.ItemCode,8) = @Image) and T0.U_USE  = 'Y' and T1.Onhand != 0 and T1.whscode ='BAW' and T2.PriceList = 10">
      <SelectParameters>
        <asp:QueryStringParameter Name="Image" QueryStringField="product" Type="String" />
      </SelectParameters>
    </asp:SqlDataSource>
  </ItemTemplate>
  <HeaderStyle Wrap="False"></HeaderStyle>
  <ItemStyle HorizontalAlign="Left" VerticalAlign="Bottom" Wrap="True"></ItemStyle>
</asp:TemplateField> 
```

* * *

**Catalog.aspx.cs 代码隐藏（C#）：**

```
private void Page_Load(object sender, System.EventArgs e)
{
  if (!IsPostBack)
  {
    string Size = Request.QueryString["Price"];
    if (Size != null)
    {
      ddlCategory.SelectedValue = Size;
    }
  }

  ItemsGet();

}

protected void CatalogList_SelectedIndexChanged(object sender, EventArgs e)
{
  string Image = CatalogList.SelectedValue.ToString().Trim();
  string catid = ddlCategory.SelectedValue;
  Response.Redirect("Details.aspx?product="
    + Image
    + "&Price="
    + catid);
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-15T14:46:29.267

你能再指定一点吗，你想把下拉值放在一个文本框中吗？这会在服务器控件中吗（即gridview、datalist等......）

# c# - 应用程序之间的通信（进程间）？

> ID：833376
> 
> 赞同：3
> 
> 时间：2009-05-07T07:54:16.693
> 
> 标签：c#, client-server, interprocess

我即将编写一个负责与外部硬件通信的“服务器”应用程序。应用程序应处理来自客户端的请求。客户端向服务器发送消息，如果服务器忙于处理硬件，则新消息应存储在稍后处理的队列中。

客户端也应该能够取消请求（如果它在服务器的队列中）。当服务器应用程序完成硬件后，它应该能够将结果发送回请求该作业的客户端。

服务器和客户端应用程序可能在也可能不在同一台 PC 上。所有开发均在 .NET (C#) 2005 中完成。

所以，我的问题是：解决这个沟通问题的最佳方法是什么？

MSMQ？肥皂？WCF？远程？其他？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T08:06:58.393

假设您可以使用 .NET 3.0 或更高版本，那么您可能希望 WCF 作为通信通道 - 接口是一致的，但它允许您使用适当的传输机制，具体取决于客户端和服务器彼此相关的位置 - 所以您可以根据需要选择使用 SOAP 或 MSMQ 或二进制格式或其他格式（如果需要，您可以自行选择）。它还涵盖了双向通信的需要。

在服务器上排队消息可能应该被视为一个单独的问题 - 特别是考虑到需要删除排队的消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T08:02:41.820

如果客户端和服务器进程在同一台机器上，我认为命名管道将为您提供最快的原始字节传输率。如果进程跨不同的机器，则需要使用基于套接字的方法。

据报道，远程处理非常慢。根据您计划在其上部署解决方案的目标操作系统，您可以选择 WCF et.all 但是这些协议的开销是您在决定时可能需要查看的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T07:59:42.297

MSMQ 会有些道理，尽管有安全和部署方面的考虑。您可以查看服务总线（例如 NServiceBus 或 MassTransit），还有可以提供帮助的 SQL Server Service Broker（也可以被服务总线用作传输）。

WCF 将是另一件事，但它确实是跨网络传输，因此您可能仍希望 WCF 调用将消息放入服务器队列。

我不推荐远程处理，因为很难保持关注点的分离，而且在你意识到之前你正在开发一个非常健谈的界面而没有意识到它。远程调用相对而言代价高昂，因此您应该尽量保持消息的粗粒度。WCF 将是我的建议。尤其是因为您可以将其设置为使用 HTTP 传输并避免大量部署和安全问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T07:59:45.430

远程处理

如果所有开发都是在 .NET 2005 中完成的，那么 Remoting 是最好的方法。 [http://en.wikipedia.org/wiki/.NET_Remoting](http://en.wikipedia.org/wiki/.NET_Remoting)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T08:01:18.313

.NET Framework 提供了多种与不同应用程序域中的对象进行通信的方法，每种方法的设计都考虑到了特定级别的专业知识和灵活性。例如，Internet 的发展使 XML Web services 成为一种有吸引力的通信方法，因为 XML Web services 建立在 HTTP 协议和使用 XML 的 SOAP 格式的通用基础设施之上。这些是公共标准，可以立即与当前的 Web 基础设施一起使用，而不必担心额外的代理或防火墙问题。

然而，并不是所有的应用程序都应该使用某种形式的 XML Web 服务来构建，哪怕只是因为与通过 HTTP 连接使用 SOAP 序列化相关的性能问题。

[在 .NET 中选择通信选项](http://msdn.microsoft.com/en-us/library/8119f66k(VS.80).aspx)可帮助您决定您的应用程序需要哪种形式的对象间通信。

# java - 在java中检查另一个地图中的地图内容

> ID：833379
> 
> 赞同：1
> 
> 时间：2009-05-07T07:55:03.460
> 
> 标签：java, maps

我需要编写一小段代码，如果它存在于另一个地图中，我需要检查地图的内容（键值），将其从地图中删除

例如

地图1：

```
1=>obj1
2=>obj21
3=>obj3 
4=>obj4 
```

其他地图Map2：

```
10=>obj10
20=>obj20
2=>obj2
30=>obj30
3=>obj3 
```

fun (Map1, Map2) 执行后的结果有以下输出

地图2：

```
10=>obj10
2=>obj2
20=>obj20
30=>obj30 
```

遍历较小的映射并检查内容（键，值）是遍历较小的映射并检查较大映射中的键和内容是最有效的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T08:23:34.970

```
m1.entrySet().removeAll(m2.entrySet()); 
```

其中 m1 是要修改的 Map，m2 是需要从 m1 中删除的映射。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T08:36:33.283

```
private static <K, V> void fun(Map<K, V> a, Map<K, V> b) {
    Map<K, V> shortestMap = a.size() < b.size() ? a : b;
    Map<K, V> longestMap = a.size() > b.size() ? a : b;

    Set<Entry<K, V>> shortestMapEntries = shortestMap.entrySet();
    Set<Entry<K, V>> longestMapEntries = longestMap.entrySet();

    longestMapEntries.removeAll(shortestMapEntries);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-13T04:50:49.353

```
private static <K, V> removeDuplicates(Map<K, V> map1, Map<K, V> map2) {
    for (K key : map1.keySet()) {
        V val1 = map1.get(key);
        V val2 = map2.get(key);
        if (val2 != null && val2.equals(val1)
            map2.remove(key);
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T08:09:35.843

请参阅[java.util.Collection](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Collection.html)

```
boolean removeAll(Collection<?> c) 
```

# visual-studio-2008 - 有没有办法让智能感知为 VS 2008 中的经典 asp 自定义类工作？

> ID：833381
> 
> 赞同：2
> 
> 时间：2009-05-07T07:55:20.700
> 
> 标签：visual-studio-2008, asp-classic, intellisense

首先，这以前从未奏效过，因此它与 VS 2008 没有特别关系。问题：当您在包含在“主”asp 脚本中的单独文件中有自定义 asp 类时，您将无法在 Visual Studio 中获得智能感知.

示例：CUser.asp

```
<%
Class CUser
   Public Sub Create()
   Public Sub Remove()
End Class
%> 
```

主.asp：

```
<!--#include file="CUser.asp"-->
<%
Dim user : Set user = new CUser
user.Create
%> 
```

当您键入“user.”时，您不会获得任何 Intellisense。如果我在“结束类”语句之后执行相同的 INSIDE CUser.asp，那么它可以工作。

你知道有什么方法可以在所有 asp 文件中始终如一地工作吗？

想法：我想可能会生成一个自定义的“智能感知文件”，我可以将它包含我的函数、子程序等的所有符号和注释提供给 Visual Studio……但没有找到关于这个主题的太多信息。这里有什么线索吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-16T05:56:44.813

ASP Classic 中缺少“真正编译的”类是我很久以前切换到 ASP.NET 的主要原因之一……很抱歉告诉你。如果您喜欢类和对象，我强烈建议您对大型对象进行“语言切换”。:o)

我也从 VBscript 切换到 C#，因为我在获得 ASP 之前做了一些 C/C++。

但我决定使用 c# 而不是 VB.net 的主要原因是，大多数核心示例似乎都是用 c# 编写的，其次，当你很忙时，javascript（客户端）和 c#（服务器端）之间的切换非常有用。

最后，Flash/Actionscript 3.0 也变得越来越面向对象，这也建立在 ECMA 脚本标准之上。

抱歉所有这些旧文本，但我认为你可能已经准备好迎接“大开关”:o)

问候

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T19:54:05.183

不幸的是，这是不可能的。

# iphone - UITabBarController 可以通过代码选择选项卡吗？

> ID：833389
> 
> 赞同：31
> 
> 时间：2009-05-07T07:58:03.267
> 
> 标签：iphone, uitabbarcontroller

UITabBarController 是否可以在代码中选择选项卡？像 UINavigationController 我们可以使用 popViewController 弹回 rootViewController 而不是按下后退按钮，那么如何在 tabbarcontroller 中实现呢？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-05-07T08:06:49.737

使用 UITabBarController 上的 selectedIndex 属性。更多信息可以在[UITabBarController 类参考](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UITabBarController_Class/Reference/Reference.html#//apple_ref/occ/instp/UITabBarController/selectedIndex)中找到。

`controller.selectedIndex = 4;`

或使用

`[controller setSelectedIndex:4];`

# iphone - 在 iPhone 中显示带有文本框的警报视图

> ID：833392
> 
> 赞同：6
> 
> 时间：2009-05-07T07:58:14.967
> 
> 标签：iphone, cocoa-touch

是否可以像 AppStore 应用程序一样在内部显示带有文本框的警报视图。它在这样的对话框中要求输入密码。我已经看到至少有几个其他第三方应用程序在使用它。它是私有 API 吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-03-02T18:12:03.513

这是 Tharindu Madushana 提供的一种“Apple 认可”的做法。我从他在此页面的评论中得到它：http: [//iosdevelopertips.com/undocumented/alert-with-textfields.html](http://iosdevelopertips.com/undocumented/alert-with-textfields.html)

```
// Ask for Username and password.
UIAlertView *alertview = [[UIAlertView alloc] initWithTitle:@"Twitter Details!" message:@"\n \n \n" delegate:self cancelButtonTitle:@"Cancel" otherButtonTitles:@"OK", nil];

// Adds a username Field
UITextField *utextfield = [[UITextField alloc] initWithFrame:CGRectMake(12.0, 45.0, 260.0, 25.0)]; 
utextfield.placeholder = @"Username";
[utextfield setBackgroundColor:[UIColor whiteColor]]; 
[alertview addSubview:utextfield];

// Adds a password Field
UITextField *ptextfield = [[UITextField alloc] initWithFrame:CGRectMake(12.0, 80.0, 260.0, 25.0)]; 
ptextfield.placeholder = @"Password";
[ptextfield setSecureTextEntry:YES];

[ptextfield setBackgroundColor:[UIColor whiteColor]]; [alertview addSubview:ptextfield];
// Move a little to show up the keyboard
CGAffineTransform transform = CGAffineTransformMakeTranslation(0.0, 80.0);
[alertview setTransform:transform];

// Show alert on screen.
[alertview show];
[alertview release];

//...
// Don't forget to release these after getting their values
[utextfield release];
[ptextfield release]; 
```

最后要取回文本

```
-(void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex {
    if (buttonIndex == 0)
        return; //Cancel

    UITextField *field = (UITextField *)[[alertView subviews] lastObject];
    NSLog (@"%@", field.text);
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-07T09:04:33.030

是的，它是无证的。要将文本字段添加到 UIAlertView，请使用 addTextFieldWithValue: label: 方法。您调用时将默认文本作为第一个参数，将显示在空字段中的文本作为第二个参数。完成后，您可以使用 textFieldAtIndex:n 访问该字段 - 见下文。

```
UIAlertView *alert = [[UIAlertView alloc] initWithTitle: @"Who are you?"     
                       message:@"Give your full name" 
                       delegate:self  cancelButtonTitle:@"Cancel"   
                       otherButtonTitles:@"OK", nil]; 
[alert addTextFieldWithValue:@""label:@"Name"]; 

// Customise name field 
UITextField* name = [alert textFieldAtIndex:0]; 
name.clearButtonMode = UITextFieldViewModeWhileEditing; 
name.keyboardType = UIKeyboardTypeAlphabet; 
name.keyboardAppearance = UIKeyboardAppearanceAlert; 
[alert show]; 
```

下一个片段显示了如何检索名称字段中的值：

```
NSLog("Name is %@", [[modalView textFieldAtIndex:0] text]); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-10-09T23:11:37.100

这是一个非常古老的问题，有着非常古老的答案。

这是自 ios 5 以来我如何将 UITextfield 放入 UIAlertView 的示例：

```
 UIAlertView *message = [[UIAlertView alloc] initWithTitle:@"New List Name" message:@"" delegate:nil cancelButtonTitle:@"Cancel" otherButtonTitles:@"Continue", nil];

    message.alertViewStyle = UIAlertViewStylePlainTextInput;
    self.alertTextField = [message textFieldAtIndex:0];
    self.alertTextField.keyboardType = UIKeyboardTypeAlphabet;
    message.delegate = self;
    [message show];
    [self.alertTextField becomeFirstResponder]; 
```

其中 alertTextField 设置如下：

```
@property (nonatomic, strong) UITextField *alertTextField; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-07T09:07:56.920

Jeff Lamarche[在他的博客上发布了一些示例代码](http://iphonedevelopment.blogspot.com/2009/02/alert-view-with-prompt.html)来做到这一点。当我尝试时，格式看起来有点不稳定，但这可能是一个很好的起点。

# python - 需要帮助开发 facebook 应用程序

> ID：833406
> 
> 赞同：0
> 
> 时间：2009-05-07T08:01:49.810
> 
> 标签：python, django, facebook

我正在尝试使用 django 开发一个 facebook 应用程序。

我面临的问题是如何使用 facebook api 并获取用户好友列表。

**视图.py**

```
def canvas(request):
    # Get the User object 
    user, created = FacebookUser.objects.get_or_create(id = request.facebook.uid)
    return direct_to_template(request, 'canvas.fbml', extra_context={'fbuser': user,}) 
```

所以它对我来说很好。我在我的页面中获取用户信息。

```
Welcome,<fb:name uid="{{ fbuser.id }}" firstnameonly="true" useyou="false" />! 
```

这是canvas.fbml

需要帮助。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T08:20:35.867

在加载用户 ID 等时尝试使用单引号。

如果失败，它似乎是以下之一 - python 的输出错误。HTML / FBML 输出应如下所示

*   仔细检查您添加的属性是否正确。区分大小写。

*   您是否在此文件中加载了正确的身份验证信息（密钥）？我假设它在画布上一切正常。在 FBML 控制台中测试 FBML。

# c# - 如何找到控件的可见部分？

> ID：833411
> 
> 赞同：6
> 
> 时间：2009-05-07T08:05:43.357
> 
> 标签：c#, .net, winforms

我有一个控件，其父级是`ScrollableControl`. 如何找到用户实际可见的控件部分？两者都是矩形的 - Regions 没有什么有趣的事情。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-11T03:59:09.217

我认为我在下面写的 GetVisibleRectangle 方法就是您所要求的。随着控件的滚动，连续运行此操作会产生以下输出：

*   {X=0,Y=0,Width=0,Height=0} - button4 被滚动出视图。请注意，这里的值为`Rectangle.Empty`。
*   {X=211,Y=36,Width=25,Height=13} - button4 被滚动，所以左上角可见
*   {X=161,Y=36,Width=75,Height=13} - button4 已滚动，因此上半部分和整个宽度可见
*   {X=161,Y=26,Width=75,Height=23} - button4 被滚动到完全可见

请注意，除了 Width 和 Height 变化之外，X,Y 也随着滚动而变化。

资源：

```
private void button1_Click(object sender, EventArgs e)
{
    Rectangle r = GetVisibleRectangle(this.panel1, button4);
    System.Diagnostics.Trace.WriteLine(r.ToString());
}

public static Rectangle GetVisibleRectangle(ScrollableControl sc, Control child)
{
    Rectangle work = child.Bounds;
    work.Intersect(sc.ClientRectangle);
    return work;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T08:19:53.510

AutoScrollPosition 表示可滚动控件的显示矩形的位置。如果控件已滚动离开其起始位置 (0,0)，则检索到的 X 和 Y 坐标值为负。设置此属性时，必须始终指定正 X 和 Y 值以设置相对于起始位置的滚动位置。例如，如果您有一个水平滚动条，并且您将 x 和 y 设置为 200，则将滚动条向右移动 200 个像素；如果您随后将 x 和 y 设置为 100，则滚动看起来会向左跳跃 100 像素，因为您将其设置为距起始位置 100 像素。在第一种情况下，AutoScrollPosition 返回 {-200, 0}; 在第二种情况下，它返回 {-100,0}。

来源：[MSDN：ScrollableControl.AutoScrollPosition 属性](http://msdn.microsoft.com/en-us/library/system.windows.forms.scrollablecontrol.autoscrollposition.aspx)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2012-07-24T03:48:21.823

以下链接可能有助于解决此问题 [http://www.trace-solution.com/2012/06/how-to-get-visibleviewable-area-of-user.html](http://www.trace-solution.com/2012/06/how-to-get-visibleviewable-area-of-user.html)。

# svn - “svn up”命令说实体太大

> ID：833412
> 
> 赞同：21
> 
> 时间：2009-05-07T08:06:14.777
> 
> 标签：svn

当我尝试使用命令“svn up”更新我的本地颠覆副本时，它给了我错误：

svn：服务器发送了意外的返回值（413 请求实体太大）以响应“/repository/！svn/vcc/default”的报告请求

这里可能是什么问题？

谢谢！

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2011-12-16T15:14:17.437

我相信当有大量更改被更新并且请求返回实际上太大的响应时会发生此错误。发生这种情况时，请先尝试单独更新子文件夹。一旦您更新了一些子文件夹，为主文件夹请求返回的数据应该足够小，可以通过。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T11:55:53.320

我认为这是 SSL 认证的问题。[在http://svn.haxx.se/users/archive-2008-01/0689.shtml](http://svn.haxx.se/users/archive-2008-01/0689.shtml)讨论了一个解决方案：它说：

> 413 Request Entity Too Large”问题可以通过将 SSLVerifyClient 从目录级别移动到虚拟主机级别来解决，如 Apache 错误 39154， [http://www.mail-archive.com/bugs@httpd.apache.org/ msg21739.html](http://www.mail-archive.com/bugs@httpd.apache.org/msg21739.html)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-04-11T16:00:29.587

就我而言，这只是配置问题，即 LimitXMLRequestBody 设置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-11-07T20:21:34.583

如果您的配置之前工作并最终停止工作，则您可能已经损坏了客户端的工作文件夹。在这种情况下，您的工作文件夹中的以下命令可能会有所帮助：
`svn cleanup`

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-09-22T14:15:25.543

删除您的工作文件夹并进行干净的结帐。

# c# - 从 VB6 字符串数据到 .NET 字节数组的转换

> ID：833413
> 
> 赞同：1
> 
> 时间：2009-05-07T08:06:20.063
> 
> 标签：c#, .net, vb.net, vb6

我正在编写一个 C# 应用程序，它从 VB6 代码生成的 SQL 数据库中读取数据。数据是一个 Singles 数组。我正在尝试将它们转换为 float[]

下面是在数据库中写入数据的VB6代码（不能更改此代码）：

```
 Set fso = New FileSystemObject
  strFilePath = "c:\temp\temp.tmp"

  ' Output the data to a temporary file
  intFileNr = FreeFile
  Open strFilePath For Binary Access Write As #intFileNr
  Put #intFileNr, , GetSize(Data, 1)
  Put #intFileNr, , GetSize(Data, 2)
  Put #intFileNr, , Data
  Close #intFileNr

  ' Read the data back AS STRING
  Open strFilePath For Binary Access Read As #intFileNr
  strData = String$(LOF(intFileNr), 32)
  Get #intFileNr, 1, strData
  Close #intFileNr

  Call Field.AppendChunk(strData) 
```

如您所见，数据被放在一个临时文件中，然后作为 VB6 字符串读回并写入数据库（dbLongBinary 类型的行）

我尝试了以下方法：

进行块复制

```
byte[] source = databaseValue as byte[];
float [,] destination = new float[BitConverter.ToInt32(source, 0), BitConverter.ToInt32(source, 4)];
Buffer.BlockCopy(source, 8, destination, 0, 50 * 99 * 4); 
```

这里的问题是 VB6 二进制到字符串的转换。VB6 字符串 char 是 2 个字节宽，我不知道如何将其转换回我可以处理的二进制格式。

下面是 VB6 代码生成的临时文件的转储： [alt text http://robbertdam.nl/share/dump%20of%20text%20file%20generated%20by%20VB6.png](http://robbertdam.nl/share/dump%20of%20text%20file%20generated%20by%20VB6.png)

这是我从数据库中读取的数据转储（= VB6 字符串）： [alt text http://robbertdam.nl/share/dump%20of%20database%20field.png](http://robbertdam.nl/share/dump%20of%20database%20field.png)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T09:29:09.507

我看到的一种可能方法是：

1.  以 System.Char[] 的形式读回数据，它是 Unicode，就像 VB BSTR 一样。
2.  通过 Encoding.ASCII.GetBytes() 将其转换为 ASCII 字节数组。这有效地删除了所有交错的 0。
3.  将此 ASCII 字节数组复制到最终的浮点数组。

像这样的东西：

```
char[] destinationAsChars = new char[BitConverter.ToInt32(source, 0)* BitConverter.ToInt32(source, 4)];
byte[] asciiBytes = Encoding.ASCII.GetBytes(destinationAsChars);
float[] destination = new float[notSureHowLarge];
Buffer.BlockCopy(asciiBytes, 0, destination, 0, asciiBytes.Length); 
```

现在目的地应该包含原始的花车。警告：不确定 VB6 Singles 的内部格式是否与 System.Float 的内部格式二进制兼容。如果没有，所有赌注都取消。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-04-24T16:12:31.330

这是我从上面的答案中得出的解决方案。

将文件作为 unicode 读取`char[]`，然后重新编码为我的默认系统编码生成可读文件。

```
internal void FixBytes()
{
    //Convert the bytes from VB6 style BSTR to standard byte[].

    char[] destinationAsChars = 
    System.Text.Encoding.Unicode.GetString(File).ToCharArray();

    byte[] asciiBytes =  Encoding.Default.GetBytes(destinationAsChars);
    byte[] newFile = new byte[asciiBytes.Length];
    Buffer.BlockCopy(asciiBytes,0, newFile, 0, asciiBytes.Length);
    File = newFile;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-24T10:23:28.130

您可能知道，在 VB6 端这是非常糟糕的编码。它试图做的是将 Single 数据（与 C# 中的 float 相同）转换为字符串。但是，虽然有更好的方法可以做到这一点，但一开始是一个非常糟糕的主意。

主要原因是，将二进制数据读入 VB6 BSTR 会将数据从 8 位字节转换为 16 位字符，使用当前代码页。因此，这可能会在数据库中产生不同的结果，具体取决于它所运行的语言环境。（！）

因此，当您从数据库中读取它时，除非您指定写入时使用的相同代码页，否则您将获得不同的浮点数，甚至可能是无效的浮点数。

以十六进制形式查看二进制（单个）和 DB（字符串）形式的数据示例将有助于验证这是正在发生的事情。

从后来的帖子：

> 实际上，这不是“坏”的 VB6 代码。

是的，因为它将二进制数据带入字符串域，这违反了现代 VB 编码的主要规则。这就是存在 Byte 数据类型的原因。如果您忽略这一点，当您创建的数据库跨越区域设置边界时，您很可能会得到无法破译的数据。

> 他正在做的是以紧凑的二进制格式存储数组并将其作为“块”保存到数据库中。这样做有很多正当理由。

当然，他想要这个是有正当理由的（尽管您对“紧凑”的定义与传统定义不同）。目的是好的：选择的手段不是。

对 OP：

您可能无法更改作为输入数据提供的内容，因此以上内容主要是学术性的。如果还有时间更改用于创建 blob 的方法，让我们建议不涉及字符串的方法。

在应用任何提供的解决方案时，请尽量避免使用字符串，如果不能，请使用与创建它们的代码页匹配的特定代码页对其进行解码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T09:45:28.330

你能澄清一下文件的内容是什么（即一个例子）吗？作为二进制（可能是十六进制）还是字符？如果数据是 VB6 字符串，那么您必须使用 float.Parse() 来读取它。.NET 字符串也是每个字符 2 个字节，但是从文件加载时，您可以使用`Encoding`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-25T10:56:40.257

> 首先，我们跳过每隔一个字节来消除 Unicode 填充。

嗯......如果这是一个有效的策略，那么数据库字符串转储中的每一列都将只包含零。但是快速浏览第一个显示事实并非如此。事实上，这些列中有很多非零字节。我们能负担得起丢弃它们吗？

这表明，使用字符串导致的 Unicode 转换不是简单地添加“填充”，而是改变了数据的字符。您所说的填充是 ASCII 范围（00-7F 二进制）映射到相同的 Unicode 范围这一事实的巧合。但这不适用于二进制 80-FF。

看一下第一个存储的值，它的原始字节值为 94 9A 27 3A。当转换为 Unicode 时，这些不会变成 94 00 97 00 27 00 3A 00。它们变成 1D 20 61 01 27 00 3A 00。

丢弃每隔一个字节就会得到 1D 61 27 3A——而不是原来的 94 9A 27 3A。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-24T13:11:30.893

实际上，这不是“坏”的 VB6 代码。他正在做的是以紧凑的二进制格式存储数组并将其作为“块”保存到数据库中。这样做有很多正当理由。

VB6 代码将其保存到磁盘并读回的原因是因为 VB6 不支持仅在内存中读取和写入文件。如果您想创建一大块二进制数据并将其填充到其他位置（例如数据库字段），这是常用算法。

在 .NET 中处理这个问题不是问题。我拥有的代码在 VB.NET 中，因此您必须将其转换为 C#。

修改为处理字节和 unicode 问题。

```
Public Function DataArrayFromDatabase(ByVal dbData As byte()) As Single(,)
    Dim bData(Ubound(dbData)/2) As Byte
    Dim I As Long
    Dim J As Long

    J=0
    For I = 1 To Ubound(dbData) step 2
        bData(J) = dbData(I)
        J=1
    Next I

    Dim sM As New IO.MemoryStream(bData)
    Dim bR As IO.BinaryReader = New IO.BinaryReader(sM)
    Dim Dim1 As Integer = bR.ReadInt32
    Dim Dim2 As Integer = bR.ReadInt32
    Dim newData(Dim1, Dim2) As Single

    For I = 0 To Dim2
        For J = 0 To Dim1
            newData(J, I) = bR.ReadSingle
        Next
    Next

    bR.Close()
    sM.Close()
    Return newData
End Function 
```

关键技巧是像在 VB6 中一样读取数据。我们有能力在 .NET 中使用 MemoryStreams，所以这相当容易。

首先，我们跳过每隔一个字节来消除 Unicode 填充。

然后我们从字节数组创建一个内存流。然后使用 MemoryStream 初始化 BinaryReader。

我们在数组的第一维中读取 VB6 Long 或 .NET Int32 我们在数组的第二维中读取 VB6 Long 或 .NET Int32

读取循环以数组维度的相反顺序构造。Dim2 是外环，Dim1 是内环。原因是这就是 VB6 以二进制格式存储数组的方式。

返回newData，你就成功恢复了VB6创建的原始数组！

现在你可以尝试使用一些数学技巧。二维为 4 字节/字符，每个数组元素为 4 字节/字符。但是为了长期的可维护性，我发现使用内存流的字节操作更加明确。它需要更多的代码，但当你在 5 年后重新审视它时会更加清晰。

# icons - 什么是好的、免费的、插入式的 mimetype 图标集？

> ID：833418
> 
> 赞同：17
> 
> 时间：2009-05-07T08:07:43.510
> 
> 标签：icons, mime-types

我想要一组 mimetype 图标来配合我的文件上传，显示在用户的文件列表等中。

它应该是：

*   16x16 PNG 或 JPG（其他尺寸到 64x64 将是额外的，但不是必需的）
*   已经组织好了，我可以做例如 mimetype.sub('/','-') + '.png' 并获取图标文件名（我想避免花费大量时间来找出关联）
*   不是特定于平台的，最好在可用的情况下使用专有应用程序的本机图标（例如，.zip 图标不应看起来像 KDE 框）
*   漂亮但易读，适合普通观众；-)

有什么好的包呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-10-06T11:25:57.137

I found these: [http://openiconlibrary.sourceforge.net/gallery2/?./Icons/mimetypes/oxygen-style](http://openiconlibrary.sourceforge.net/gallery2/?./Icons/mimetypes/oxygen-style)

Edit 14-09-09 15:14 the link is now dead.

I don't know anymore how the above looked but I like these too: [https://github.com/pasnox/oxygen-icons-png/tree/master/oxygen](https://github.com/pasnox/oxygen-icons-png/tree/master/oxygen)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-19T08:22:59.443

我喜欢[丝绸图标](http://www.famfamfam.com/lab/icons/silk/)。它们包含 700 多个 16 x 16 像素图标，采用柔和的 PNG 格式，并根据知识共享署名 2.5 许可进行许可。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T09:13:11.183

鉴于那里[的 mime 类型数量庞大](http://www.w3schools.com/media/media_mimeref.asp)，我认为您不太可能找到包含所有这些类型的集合。

对于一个合理的子集，[Crystal Clear](http://commons.wikimedia.org/wiki/Category:Crystal_Clear_mimetype_icons)怎么样？哑剧类型不会放在盘子上交给你，但应该很容易发现哪些映射到我想的地方？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-02-27T14:06:39.520

我一直在寻找这样的图标集，但我发现的所有图标集都有一些不使用它们的理由（通常缺少 Office 2007+ 格式的 MIME 类型）。

然而，我偶然发现了这个[WordPress 插件](http://wordpress.org/extend/plugins/mimetypes-link-icons/)，它有一组很棒的图标，有多种尺寸和标准化命名（基于文件扩展名）。

我知道它们不能直接与 MIME 类型一起使用，但是扩展系统以支持文件扩展名通常并不难。

编辑：我不使用 WordPress ......只是图标。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-02-19T16:56:36.550

有一个开源项目：
[https](https://github.com/teambox/Free-file-icons)
://github.com/teambox/Free-file-icons 它对我来说很方便。创建我的文件管理器时..

它支持 4 种尺寸 (16,32,48,512) 以及良好的命名 [统一]
添加到它附带的 .ai 文件以防您希望编辑。

# sql - 如何更改列的标识增量

> ID：833420
> 
> 赞同：4
> 
> 时间：2009-05-07T08:08:59.060
> 
> 标签：sql, sql-server

以下语句可以重置种子

DBCC CHECKIDENT ('TableName', RESEED, 1)

但这次我必须改变它的增量。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T08:26:18.707

或者您可以使用 Sql Server Management Studio：

![Sql Server Management Studio 中的标识增量](https://i546.photobucket.com/albums/hh430/aleris149/identity_increment.png)

使用这种方法很可能会重新创建表。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T08:11:26.963

希望这可以帮助

```
 ALTER TABLE MyCustomers 
 ALTER COLUMN CustId IDENTITY (200, 2) 
```

来自 ms-help://MS.VSCC.v90/MS.MSDNQTR.v90.en/ssmprog3/html/5719d3e4-14db-4073-bed7-d08f39416a39.htm 的代码

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-03-09T04:55:23.173

我们不能将列的标识更新为在每个条目上增加 2。最简单的方法是使用 IDENTITY(1,2) 创建另一个表，然后在删除实际表之前将数据移动到该表。请通过下面的脚本。

让 TableA 是我们的实际表。

1.  CREATE TABLE TableB(col1 INT IDENTITY (1,2) NOT NULL, col2 VARCHAR(10) NULL);
2.  插入表 B 从表 A 中选择 col2；
3.  删除表表A；
4.  sp_rename 表 B，表 A；

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-07-23T19:44:41.463

您可以通过以下方式将自动增量重置为更高的值

1.  将 IDENTITY_INSERT 设置为关闭
2.  运行插入语句并将 ID 设置为您要继续的位置
3.  将 IDENTITY_INSERT 设置为
4.  删除创建的行（假设它只是为了增加种子）

例如;

最后一个 ID = 10 的表 'People' 可以设置为从 400,000 继续；

```
SET IDENTITY_INSERT AccessToken off
insert into People(Id, name) values (400000,'Bob')
SET IDENTITY_INSERT AccessToken on
Delete from People where ID = 400000 
```

# apache-flex - 为什么 Eclipse 的 flexbuilder 插件打开和编译这么慢？

> ID：833423
> 
> 赞同：3
> 
> 时间：2009-05-07T08:09:32.740
> 
> 标签：apache-flex, compiler-construction, time, eclipse-plugin, flexbuilder

我有一台不错的电脑。（名称中带有双核和大量内存的东西）。有时，仅当我打开一个简单的 mxml 文件时，FlexBuilder 才会提示“构建器项目”加载栏。看起来他做了一些困难的工作......我不要求任何花哨的东西。我只想以文本模式打开文件。每次我按 ctrl+s 时，我都害怕“永远占用的建筑项目”的事情。我已经禁用了自动构建，但这并不方便。

还有一点，比较好理解。我有一个 Ant 任务，它使用 flexBuilderSdk 编译我们的代码。这需要很长时间（比如 100 个 .as 文件和 20 个 .mxml 文件需要 2 分钟）。

对于两个问题：这正常吗？我能做点什么吗？因为它正在扼杀我的生产力！（不，认真的;-)）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T14:35:19.990

众所周知，Flex 编译器的性能非常缓慢。他们正在努力提高 Flex 4 的编译器性能。请参阅此处的开发人员说明：

[http://opensource.adobe.com/wiki/display/flexsdk/Notes+on+Compiler+Performance+Improvements](http://opensource.adobe.com/wiki/display/flexsdk/Notes+on+Compiler+Performance+Improvements)

编译 Flex 应用程序是一个两步过程。首先，MXML 文件被编译成等效的 ActionScript 类。如果添加“-keep”编译器参数，您将能够在名为“生成”的文件夹中看到所有这些文件。创建 AS3 类后，AS 编译器将这些类转换为 .SWF 文件形式的字节码。

如果您的硬盘速度较慢（例如 5400 RPM 笔记本电脑驱动器），也会影响编译性能。我肯定会建议禁用“自动构建”并在您想要构建时按 CTRL-B。当您想要构建时，这样做并不难，比每次更改文件时等待编译要好得多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T09:10:08.703

上述改进也已由 Brian Deitte 反向移植到 Flex 3 SDK。你可以在[他的博客](http://www.deitte.com/archives/2008/10/a_faster_flex_3.htm)上试试这个。它要快得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-03T20:26:30.290

您可以使用 Flex Builder 配置进行一些调整

更多在这里： [链接](http://weblog.mrinalwadhwa.com/2008/06/18/flex-builder-performance-tweak/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-09T21:35:32.650

使用 [[如何减少 Eclipse Ganymede 的内存使用？](https://stackoverflow.com/questions/94331/eclipse-memory-use][1])并阅读火山口发送的文章。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-20T09:08:20.243

anirudhsasikumar 标记一点：Flex4 SDK 的改进已被向后移植。 [http://www.deitte.com/archives/2008/10/a%5Ffaster%5Fflex%5F3.htm](http://www.deitte.com/archives/2008/10/a%5Ffaster%5Fflex%5F3.htm) 它有点快，但我遇到了一些Firefox的问题。（不要问为什么！）问题：结果 SWF 在 IE7 上工作，但在 Firefox 上不工作（无限等待加载）

但是构建的真正改进是使用FCSH，以避免两次编译同一个文件。它极大地提高了性能。

[http://wildwinter.blogspot.com/2008/04/fcsh-wrapper-for-ant.html](http://wildwinter.blogspot.com/2008/04/fcsh-wrapper-for-ant.html)

# turbogears - 将多个孩子模板文件嵌入到一个主要文件中

> ID：833428
> 
> 赞同：0
> 
> 时间：2009-05-07T08:11:09.617
> 
> 标签：turbogears

在主要的孩子模板文件中，我希望它只有 div 标签，每个标签只调用渲染的孩子文件并在其中粘贴内容。（如 php 中的“包含”函数）但我不知道该怎么做。有人对此有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-17T12:18:20.990

如果你换成 genshi 而不是默认的孩子，你可以使用包含标签来做到这一点：

```
 <xi:include href="menu.html" /> 
```

切换到genshi相当容易，我认为这只是一个混乱的问题。模板标签的工作原理相同。不过，您应该将扩展名从 .kid 重命名为 .html。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-17T06:08:00.110

你可以先定义一个“base_layout.kid”模板：

```
<html xmlns:py="http://purl.org/kid/ns#">
    <head>
        <title>App Name - ${page_title}</title>
        <link href="layout.css" type="text/css" rel="stylesheet" />
        ${page_specific_css()}
    </head>

    <body>
        <h1>Now viewing: ${page_title} of App Name</h1>

        <content>Default content</content>

        <div class="footer">Page Footer Text</div>
    </body>

</html> 
```

然后用你想要的任何数据替换“page.kid”中的“content”标签：

```
<html py:layout="'base_layout.kid'"
  xmlns:py="http://purl.org/kid/ns#">

    <link py:def="page_specific_css()"
    href="layout.css" type="text/css" rel="stylesheet" />

    <div py:match="item.tag == 'content'">
        <ul>
             <li>Content Item 1</li>
             <li>Content Item 2</li>
             <li>Content Item 3</li>
        </ul>
    </div>

</html> 
```

您可以检查是否在 python shell 中获得了正确的 html（在删除所有使用的标识符之后）：

```
>>> import kid
>>> t = kid.Template("page.kid")
>>> print t.serialize() 
```

# asp.net - 将 .swf 文件显示为 ASP .Net 页面标题

> ID：833430
> 
> 赞同：0
> 
> 时间：2009-05-07T08:13:18.270
> 
> 标签：asp.net, header, flash, webpage, banner

我有一个 ASP。Net 2.0 网站，使用 C# 2005 作为编程语言。我正在使用 CSS 进行布局。目前我使用普通/静态 .Gif 图像作为我的标题。我想通过在标题中使用一些动画来增强外观。我使用了一些 Flash 实用程序来设计我需要的动画横幅。但由于我无法直接使用 .swf 文件，我将其转换为 .Gif ，我可以使用和显示。问题是原始 .swf 文件大小约为 75 Kb，而转换后的 .Gif 文件很大（约 4.5 Mb）。我想显示原始 .swf 文件以提高速度。

我使用 CSS 样式表来显示 .Gif 动画横幅。我不知道如何直接使用 .Swf 文件。

请指导我。

谢谢你。

拉利特·库马尔·巴里克

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T08:18:26.463

我没有这样做，但我在[CodeProject](http://www.codeproject.com/KB/aspnet/playSwf.aspx)上找到了一些示例代码。

```
<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0" width="200" height="100">
    <param name="movie" value="<% =swfFileName%>" />
    <param name="quality" value="high" />
    <embed src="<% =swfFileName%>" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="200" height="100"></embed>
</object> 
```

我认为这应该可以帮助您开始使用它。显然，您必须替换`<% =swfFileName%>`为对要播放的 .swf 文件的引用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-07T00:09:37.707

您可以查找 SWFObject 它是嵌入 Flash 的一种非常好的标准方法...谷歌搜索 swfobject 这里是代码/标记...

第 1 步：使用符合标准的标记嵌入 Flash 内容和替代内容

SWFObject 的基本标记使用嵌套对象方法（带有专有的 Internet Explorer 条件注释）以确保仅通过标记的方式提供最佳的跨浏览器支持，同时符合标准并支持替代内容

SWFObject - 第 1 步

```
 <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="780" height="420">
    <param name="movie" value="myContent.swf" />
    <!--[if !IE]>-->
    <object type="application/x-shockwave-flash" data="myContent.swf" width="780" height="420">
    <!--<![endif]-->
      <p>Alternative content</p>
    <!--[if !IE]>-->
    </object>
    <!--<![endif]-->
  </object>

</div> 
```

注意：嵌套对象方法需要双重对象定义（外部对象针对 Internet Explorer，内部对象针对所有其他浏览器），因此您需要定义对象属性和嵌套参数元素两次。

必需的属性：

```
* classid (outer object element only, value is always clsid:D27CDB6E-AE6D-11cf-96B8-444553540000)
* type (inner object element only, value is always application/x-shockwave-flash)
* data (inner object element only, defines the URL of a SWF)
* width (both object elements, defines the width of a SWF)
* height (both object elements, defines the height of a SWF) 
```

必需的参数元素：

```
* movie (outer object element only, defines the URL of a SWF) 
```

注意：我们建议不要使用 codebase 属性指向 Adob​​e 服务器上 Flash 插件安装程序的 URL，因为根据限制其仅访问当前文档域的规范，这是非法的。我们建议使用带有微妙信息的替代内容，用户可以通过下载 Flash 插件获得更丰富的体验。如何使用 HTML 来配置您的 Flash 内容？

您可以将以下常用的可选属性添加到对象元素：

```
* id
* name
* class
* align 
```

您可以使用以下可选的 Flash 特定参数元素（更多信息）：

```
* play
* loop
* menu
* quality
* scale
* salign
* wmode
* bgcolor
* base
* swliveconnect
* flashvars
* devicefont (more info)
* allowscriptaccess (more info here and here)
* seamlesstabbing (more info)
* allowfullscreen (more info)
* allownetworking (more info) 
```

为什么要使用替代内容？

object 元素允许您在其中嵌套替代内容，如果未安装或不支持 Flash，则会显示这些内容。这些内容也将被搜索引擎收录，使其成为创建搜索引擎友好内容的绝佳工具。总而言之，当您希望创建可供不使用插件浏览 Web 的人访问的内容、创建对搜索引擎友好的内容或告诉访问者他们可以通过下载 Flash 插件获得更丰富的用户体验时，您应该使用替代内容.

第 2 步：在 HTML 页面的头部包含 SWFObject JavaScript 库

SWFObject 库由一个外部 JavaScript 文件组成。SWFObject 将在读取后立即执行，并在加载 DOM 后立即执行所有 DOM 操作 - 对于所有支持此操作的浏览器，如 IE、Firefox、Safari 和 Opera 9+ - 或者在 onload 事件后立即执行火灾：

SWFObject - 第 2 步

```
<script type="text/javascript" src="swfobject.js"></script> 
```

-->

可替代的内容

-->

第 3 步：在 SWFObject 库中注册您的 Flash 内容并告诉 SWFObject 如何处理它

首先向定义您的 Flash 内容的外部对象标记添加一个唯一 ID。其次添加 swfobject.registerObject 方法：

1.  第一个参数（字符串，必需）指定标记中使用的 id。
2.  第二个参数（字符串，必需）指定发布内容的 Flash 播放器版本。它为 SWF 激活 Flash 版本检测，以确定是显示 Flash 内容还是通过执行 DOM 操作来强制替代内容。虽然 Flash 版本号通常由 major.minor.release.build 组成，但 SWFObject 只查看前 3 个数字，因此“WIN 9,0,18,0”（IE）或“Shockwave Flash 9 r18”（所有其他浏览器) 将转换为“9.0.18”。如果您只想测试主要版本，您可以省略次要版本号和版本号，例如“9”而不是“9.0.0”。
3.  第三个参数（字符串，可选）可用于激活 Adob​​e 快速安装并指定快速安装 SWF 文件的 URL。当所需的插件版本不可用时，快速安装会显示一个标准化的 Flash 插件下载对话框，而不是您的 Flash 内容。默认的 expressInstall.swf 文件与项目打包在一起。它还包含相应的 expressInstall.fla 和 AS 文件（在 SRC 目录中），让您创建自己的自定义快速安装体验。请注意，快速安装只会触发一次（第一次调用它），它仅受 Win 或 Mac 平台上的 Flash Player 6.0.65 或更高版本支持，并且它需要 310x137 像素的最小 SWF 大小。
4.  第四个参数（JavaScript 函数，可选）可用于定义在嵌入 SWF 文件成功或失败时调用的回调函数（请参阅 API 文档）

    SWFObject - 第 3 步

    ```
     <script type="text/javascript">
      swfobject.registerObject("myId", "9.0.115", "expressInstall.swf");
      </script>

    </head>
    <body>
      <div>

        <object id="myId" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="780" height="420">

          <param name="movie" value="myContent.swf" />
          <!--[if !IE]>-->
          <object type="application/x-shockwave-flash" data="myContent.swf" width="780" height="420">
          <!--<![endif]-->
            <p>Alternative content</p>
          <!--[if !IE]>-->
          </object>
          <!--<![endif]-->
        </object>
      </div>
    </body> 
    ```

# java - 如何在 Ubuntu 中为 Java 5/Tomcat 5.5 编译 .war？

> ID：833433
> 
> 赞同：0
> 
> 时间：2009-05-07T08:14:21.653
> 
> 标签：java, web-services, tomcat, war

我尝试在 ubuntu 中为 Java5/Tomcat 5.5 编译一个 webtools 项目（手动安装 eclipse 3.4）。我将安装的 jre 设置为 java-1.5.0-sun-1.5.0.18 并将编译器合规级别设置为 1.5。当我将其导出到 .war 文件并尝试在 Tomcat (Windows XP, Tomcat 5.5.27, Java 1.5.0_18) 中部署它时，我收到以下错误：

```
严重：部署 Web 应用程序存档 Jdbc2Ei.war 时出错
java.lang.UnsupportedClassVersionError：.class 文件中的错误版本号
    在 java.lang.ClassLoader.defineClass1（本机方法）
    在 java.lang.ClassLoader.defineClass（未知来源）
...

```

有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T08:29:33.520

> java.lang.UnsupportedClassVersionError：.class 文件中的错误版本号

检查*你所有的 jars*是否都是为 java5 编译的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T09:56:00.957

在windows下编译，可以了！某处的一些错误......这个问题将有一段时间得到修复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T10:12:15.253

如果它在 Windows 中工作，可能是由于环境的差异，而不是 Linux 版本的 JDK 中存在的错误。检查 Linux 中是否存在多个 JVM（几乎可以肯定，因为 Ubuntu 可能带有非 Sun 版本），并 110% 确定您正在使用预期的版本进行编译。发行

```
which javac 
```

和

```
echo $JAVA_HOME; echo $JDK_HOME 
```

从命令行也可能有帮助，因为所有这些都可以用于定位 JDK（以及您在编译命令/工具中使用的设置）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T10:19:26.173

您的 tomcat 运行的 JDK 比用于编译某些类的 JDK 小。使用兼容的 JDK 重新编译或升级 tomcat 的 JRE。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T11:14:29.817

一个天真的：在更改项目首选项之后和在 Ubuntu 上导出 WAR 文件之前，您是否尝试强制编译您的项目（项目 -> 在 Eclipse 中清理...）？

# sql - SQL 查询耗时过长

> ID：833439
> 
> 赞同：1
> 
> 时间：2009-05-07T08:16:27.873
> 
> 标签：sql, ms-access, optimization, ado

我正在使用 ADO 将数据保存到 MS Access 数据库。将数据保存到文件需要相当长的时间（大约 7 秒 - 这对于我们的目的来说太长了）。我查看了正在运行的 SQL 查询的数量，大约是 4200；虽然没有一大堆数据。

数据库连接似乎是瓶颈。您是否知道减少所需时间的任何方法？或者通过某种方式将多个语句组合成一个以减少开销，或者一些 ADO/MS-Access 技巧？

例如，您能否一次将多行插入到一个表中，这样会明显更快吗？

**额外信息：**

我们有这么多查询的一个原因是我们插入了一行，然后有另一个查询来检索其自动递增的 ID；然后使用此 ID 插入更多行，将它们链接到第一行

回应几个评论和回复：我将连接一直打开，并使用 BeginTransaction() 和 CommitTransaciton() 作为单个事务执行

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-08T07:42:40.130

有些人已经发布了这`@@IDENTITY`会很快，所以这里有一个证明（使用 VBA）我的`INSERT INTO`两个表如何通过一个`VIEW`技巧一次比做两个 INSERTS 并每次抓取值快大约三倍`@@IDENTITY`......这不足为奇，因为后者涉及三个`Execute`陈述，而前者只涉及一个:)

在我的机器上进行 4200 次迭代，这个`VIEW`技巧用了 45 秒，而`@@IDENTITY`方法用了 127 秒：

```
Sub InitInerts()
  On Error Resume Next
  Kill Environ$("temp") & "\DropMe.mdb"
  On Error GoTo 0
  Dim cat
  Set cat = CreateObject("ADOX.Catalog")
  With cat
    .Create _
        "Provider=Microsoft.Jet.OLEDB.4.0;" & _
        "Data Source=" & _
        Environ$("temp") & "\DropMe.mdb"

    With .ActiveConnection

      Dim Sql As String

      Sql = _
      "CREATE TABLE TableA" & vbCr & "(" & vbCr & "   ID IDENTITY NOT" & _
      " NULL UNIQUE, " & vbCr & "   a_col INTEGER NOT NULL" & vbCr & ")"
      .Execute Sql

      Sql = _
      "CREATE TABLE TableB" & vbCr & "(" & vbCr & "   ID INTEGER NOT" & _
      " NULL UNIQUE" & vbCr & "      REFERENCES TableA (ID)," & _
      "  " & vbCr & "   b_col INTEGER NOT NULL" & vbCr & ")"
      .Execute Sql

      Sql = _
      "CREATE VIEW TestAB" & vbCr & "(" & vbCr & "   a_ID, a_col, " & vbCr & " " & _
      "  b_ID, b_col" & vbCr & ")" & vbCr & "AS " & vbCr & "SELECT A1.ID, A1.a_col," & _
      " " & vbCr & "       B1.ID, B1.b_col" & vbCr & "  FROM TableA AS" & _
      " A1" & vbCr & "       INNER JOIN TableB AS B1" & vbCr & "    " & _
      "      ON A1.ID = B1.ID"
      .Execute Sql

    End With
    Set .ActiveConnection = Nothing
  End With
End Sub

Sub TestInerts_VIEW()

  Dim con
  Set con = CreateObject("ADODB.Connection")
  With con
    .Open _
        "Provider=Microsoft.Jet.OLEDB.4.0;" & _
        "Data Source=" & _
        Environ$("temp") & "\DropMe.mdb"

    Dim timer As CPerformanceTimer
    Set timer = New CPerformanceTimer
    timer.StartTimer

    Dim counter As Long
    For counter = 1 To 4200
      .Execute "INSERT INTO TestAB (a_col, b_col) VALUES (" & _
                   CStr(counter) & ", " & _
                   CStr(counter) & ");"
    Next

    Debug.Print "VIEW = " & timer.GetTimeSeconds

  End With

End Sub

Sub TestInerts_IDENTITY()

  Dim con
  Set con = CreateObject("ADODB.Connection")
  With con
    .Open _
        "Provider=Microsoft.Jet.OLEDB.4.0;" & _
        "Data Source=" & _
        Environ$("temp") & "\DropMe.mdb"

    Dim timer As CPerformanceTimer
    Set timer = New CPerformanceTimer
    timer.StartTimer

    Dim counter As Long
    For counter = 1 To 4200
      .Execute "INSERT INTO TableA (a_col) VALUES (" & _
          CStr(counter) & ");"

      Dim identity As Long
      identity = .Execute("SELECT @@IDENTITY;")(0)

      .Execute "INSERT INTO TableB (ID, b_col) VALUES (" & _
                   CStr(identity) & ", " & _
                   CStr(counter) & ");"

    Next

    Debug.Print "@@IDENTITY = " & timer.GetTimeSeconds

  End With

End Sub 
```

这表明现在的瓶颈是与执行多个语句相关的开销。如果我们可以在一个语句中做到这一点呢？好吧，你猜怎么着，用我人为的例子，我们可以。首先，创建一个唯一整数的序列表，这是一个标准的 SQL 技巧（每个数据库都应该有一个，IMO）：

```
Sub InitSequence()

  Dim con
  Set con = CreateObject("ADODB.Connection")
  With con
    .Open _
        "Provider=Microsoft.Jet.OLEDB.4.0;" & _
        "Data Source=" & _
        Environ$("temp") & "\DropMe.mdb"

    Dim sql As String

    sql = _
        "CREATE TABLE [Sequence]" & vbCr & "(" & vbCr & "   seq INTEGER NOT NULL" & _
        " UNIQUE" & vbCr & ");"
    .Execute sql

    sql = _
        "INSERT INTO [Sequence] (seq) VALUES (-1);"
    .Execute sql

    sql = _
        "INSERT INTO [Sequence] (seq) SELECT Units.nbr + Tens.nbr" & _
        " + Hundreds.nbr + Thousands.nbr AS seq FROM ( SELECT" & _
        " nbr FROM ( SELECT 0 AS nbr FROM [Sequence] UNION" & _
        " ALL SELECT 1 FROM [Sequence] UNION ALL SELECT 2 FROM" & _
        " [Sequence] UNION ALL SELECT 3 FROM [Sequence] UNION" & _
        " ALL SELECT 4 FROM [Sequence] UNION ALL SELECT 5 FROM" & _
        " [Sequence] UNION ALL SELECT 6 FROM [Sequence] UNION" & _
        " ALL SELECT 7 FROM [Sequence] UNION ALL SELECT 8 FROM" & _
        " [Sequence] UNION ALL SELECT 9 FROM [Sequence] ) AS" & _
        " Digits ) AS Units, ( SELECT nbr * 10 AS nbr FROM" & _
        " ( SELECT 0 AS nbr FROM [Sequence] UNION ALL SELECT" & _
        " 1 FROM [Sequence] UNION ALL SELECT 2 FROM [Sequence]" & _
        " UNION ALL SELECT 3 FROM [Sequence] UNION ALL SELECT" & _
        " 4 FROM [Sequence] UNION ALL SELECT 5 FROM [Sequence]" & _
        " UNION ALL SELECT 6 FROM [Sequence] UNION ALL SELECT" & _
        " 7 FROM [Sequence] UNION ALL SELECT 8 FROM [Sequence]" & _
        " UNION ALL SELECT 9 FROM [Sequence] ) AS Digits )" & _
        " AS Tens, ( SELECT nbr * 100 AS nbr FROM ( SELECT" & _
        " 0 AS nbr FROM [Sequence] UNION ALL SELECT 1 FROM" & _
        " [Sequence] UNION ALL SELECT 2 FROM [Sequence] UNION"
    sql = sql & _
        " ALL SELECT 3 FROM [Sequence] UNION ALL SELECT 4 FROM" & _
        " [Sequence] UNION ALL SELECT 5 FROM [Sequence] UNION" & _
        " ALL SELECT 6 FROM [Sequence] UNION ALL SELECT 7 FROM" & _
        " [Sequence] UNION ALL SELECT 8 FROM [Sequence] UNION" & _
        " ALL SELECT 9 FROM [Sequence] ) AS Digits ) AS Hundreds," & _
        " ( SELECT nbr * 1000 AS nbr FROM ( SELECT 0 AS nbr" & _
        " FROM [Sequence] UNION ALL SELECT 1 FROM [Sequence]" & _
        " UNION ALL SELECT 2 FROM [Sequence] UNION ALL SELECT" & _
        " 3 FROM [Sequence] UNION ALL SELECT 4 FROM [Sequence]" & _
        " UNION ALL SELECT 5 FROM [Sequence] UNION ALL SELECT" & _
        " 6 FROM [Sequence] UNION ALL SELECT 7 FROM [Sequence]" & _
        " UNION ALL SELECT 8 FROM [Sequence] UNION ALL SELECT" & _
        " 9 FROM [Sequence] ) AS Digits ) AS Thousands;"
    .Execute sql

  End With

End Sub 
```

然后使用序列表枚举从 1 到 42000 的值，并在单个 INSERT INTO..SELECT 语句中构造行：

```
Sub TestInerts_Sequence()

  Dim con
  Set con = CreateObject("ADODB.Connection")
  With con
    .Open _
        "Provider=Microsoft.Jet.OLEDB.4.0;" & _
        "Data Source=" & _
        Environ$("temp") & "\DropMe.mdb"

    Dim timer As CPerformanceTimer
    Set timer = New CPerformanceTimer
    timer.StartTimer

    .Execute "INSERT INTO TestAB (a_col, b_col) " & _
             "SELECT seq, seq " & _
             "FROM Sequence " & _
             "WHERE seq BETWEEN 1 AND 4200;"

    Debug.Print "Sequence = " & timer.GetTimeSeconds

  End With

End Sub 
```

这可以在 0.2 秒内在我的机器上执行！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T11:24:31.057

更新版本的 Access 支持 @@IDENTITY 变量。您可以在插入后使用它来检索标识列，而无需进行查询。

```
INSERT INTO mytable (field1,field2) VALUES (val1,val2);
SELECT @@IDENTITY; 
```

请参阅此[知识库文章](http://support.microsoft.com/kb/815629)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T11:35:16.757

> 我们插入一行，然后有另一个查询来检索其自动递增的 ID；然后使用此 ID 插入更多行，将它们链接到第一行

这是一张桌子，两张桌子还是两张以上的桌子？

如果一个表，您可以考虑不同的设计，例如您可以生成自己的随机标识符，使用嵌套集模型而不是邻接列表模型等。很难知道您是否不会分享您的设计；-)

如果有两个表，假设列`FOREIGN KEY`上的表之间有一个`AUTOINCREMENT/IDENTITY`，您可以创建一个`VIEW`即`INNER JOIN`这两个表，`INSERT INTO`并且`VIEW`值`AUTOINCREMENT/IDENTITY`将被“复制”到引用表。此 Stack Overflow 答案（下面的链接）中的更多详细信息和工作示例。

如果有多个表，则该`VIEW`技巧不会超出两个表 AFAIK，因此您可能只需要忍受较差的性能或更改技术，例如 DAO 的报告速度比 ADO 快，SQL Server 可能比 ACE/Jet 快，等等. 再次，请随意分享您的设计，可能会有“跳出框框思考”的解决方案。

[如何插入数据？](https://stackoverflow.com/questions/788930/how-to-insert-data/793303#793303)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T11:54:17.600

对于您的情况，最好使用 ADO 执行插入操作，而不是运行 SQL 命令。

```
for i = 1 to 100
   rs.AddNew
   rs("fieldOne") = "value1"
   rs("fieldOne") = "value2"
   rs.Update
   id = rs("uniqueIdColumn")
   'do stuff with id...
next 
```

我知道使用 ADO 很慢，但它比打开 4200 个连接要快很多倍...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T14:25:59.763

一些建议（甚至可以组合）：

*   为什么在插入行之前不获取自动递增的 ID，这样您的值已经可用于下一个查询？这应该可以节省您一些时间。
*   还必须检查连接的关闭/打开。
*   您是否考虑过操作记录集（使用 Visual Basic 代码来更新数据）而不是表（使用发送到数据库的 SQL 指令）？
*   另一种解决方案（如果您确定连接是瓶颈）是在本地创建表，然后在工作完成后将其导出到访问文件。
*   当您使用 ADO 时，您甚至可以将数据保存为 XML 文件，从该 XML 文件加载记录集，使用 VBA 对其进行操作，并将其导出到 Access 数据库

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T23:06:12.587

不意味着要成为一个聪明的屁股......但是，有继续使用 Access 的理由吗？SQL Server Express 是免费的，速度更快，功能更强大......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-08T01:01:39.157

听起来您正在导入数据，而 Access 有更好的工具可用于导入数据。是的，它一次插入许多记录，而且速度会更快。

你能再描述一下这个应用程序吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-08T01:22:17.330

您可以为数据库提供的最便宜和（通常是每次）最好的速度提升是将不变的数据保留在缓存中。

不知道它是否适用于你的情况，但它很简单。您可以只插入一个（免费）库来执行此操作，或者保留已阅读项目的本地集合。例子 ：

*   想阅读第 X 项。
*   项目 X 是否在本地集合中？
*   否：从数据库中读取项目 X 并将其放入本地集合中。
*   是的：只需返回项目 X 的​​本地副本。

当然，当您运行具有大量服务器的网站时，它可能会稍微复杂一些。在这种情况下，只需使用应用程序块或缓存。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-11T07:28:57.407

请允许我反驳以下断言：

> SELECT @@IDENTITY 建议——与打开 AddOnly 记录集、更新字段、保存记录和存储 Autonumber 值相比，插入数据和检索 Autonumber 值绝对是一种更快的方法。SQL INSERT 总是比使用逐行记录集更快。

我认为这两个记录集方法可能比@@IDENTITY 方法快一点，因为我怀疑它涉及更少的数据库往返。在我的测试中，它在 1.2 秒时快了很多，而 @@IDENTITY 方法为 127 秒。这是我的代码（创建 .mdb 的代码发布在另一个答案中）：

```
Sub TestInerts_rs()

  Dim con
  Set con = CreateObject("ADODB.Connection")
  con.Open _
        "Provider=Microsoft.Jet.OLEDB.4.0;" & _
        "Data Source=" & _
        Environ$("temp") & "\DropMe.mdb"

  Dim timer As CPerformanceTimer
  Set timer = New CPerformanceTimer
  timer.StartTimer

  Dim rs1
  Set rs1 = CreateObject("ADODB.Recordset")
  With rs1
    .ActiveConnection = con
    .CursorType = 1  ' keyset
    .LockType = 3  ' optimistic
    .Source = "SELECT a_col, ID FROM TableA;"
    .Open
  End With

  Dim rs2
  Set rs2 = CreateObject("ADODB.Recordset")
  With rs2
    .ActiveConnection = con
    .CursorType = 1  ' keyset
    .LockType = 3  ' optimistic
    .Source = "SELECT b_col, ID FROM TableB;"
    .Open
  End With

  Dim counter As Long
  For counter = 1 To 4200
    rs1.AddNew "a_col", counter

    Dim identity As Long
    identity = rs1.Fields("ID").value

    rs2.AddNew Array(0, 1), Array(counter, identity)

  Next

  Debug.Print "rs = " & timer.GetTimeSeconds

End Sub 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-05-07T22:57:53.090

一些可能有用也可能没用的想法：

1.  让我支持 SELECT @@IDENTITY 建议——与打开 AddOnly 记录集、更新字段、保存记录和存储 Autonumber 值相比，插入数据和检索 Autonumber 值绝对是一种更快的方法。SQL INSERT 总是比使用逐行记录集更快。

2.  使用 DAO 事务，您可能能够将多个此类插入转换为一次执行的批处理。我不确定这一点，因为我不确切知道您在做什么以及您正在使用多少张桌子。关键是您将在事务中运行一系列 SQL INSERT，然后在最后执行 .Commit，这样对真实数据库文件的实际写入将作为单个操作发生，而不是 4200（或不管多少）单独的操作。

# wpf - 如何通过 WPF 中的命令参数传递多个参数？

> ID：833440
> 
> 赞同：4
> 
> 时间：2009-05-07T08:17:24.343
> 
> 标签：wpf

如何通过 WPF 中的命令参数传递多个参数？我们是否必须创建一个对象并通过如果有人可以帮助我举个例子

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-13T09:34:53.250

也许您可以将 MultiBinding 与将为您创建对象的转换器一起使用...

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-05-07T09:20:02.197

我猜将底层数据上下文传递给命令就足够了？这意味着您可以在命令的 Executed 处理程序中使用发件人的 DataContext，或`CommandParameter={Binding}`在 xaml 中设置。

如果您发现无法将 CommandParameter 绑定到单个对象 - 这可能是因为设计不当。

# javascript - 为什么这段 Javascript 代码这么慢？

> ID：833441
> 
> 赞同：2
> 
> 时间：2009-05-07T08:17:28.947
> 
> 标签：javascript, profiling, performance

我有这段 Javascript 代码，在 Internet Explorer 中每次调用大约需要 600 毫秒。在其他浏览器中花费的时间可以忽略不计。

```
var _nvs_currentTab;
var _nvs_zoomfield;
var _nvs_centerfield;
var _nvs_globsearch;
var _nvs_category;
var _nvs_favsonly;
var _nvs_wishonly;
var _nvs_friendfavsonly;
var _nvs_newitemsonly;
var _nvs_globsearchOld;
var _nvs_catOld;
var _nvs_favsonlyOld;
var _nvs_wishonlyOld;
var _nvs_friendFavsonlyOld;
var _nvs_newItemsOnlyOld;

function saveState()
{
    if (!_nvs_currentTab)
    {
        var f = document.getElementById;
        _nvs_currentTab = f('currentTab');
        _nvs_zoomfield = f('zoomfield');
        _nvs_centerfield = f('centerfield');
        _nvs_globsearch = f("globsearch");
        _nvs_category = f("category");
        _nvs_favsonly = f("favsonly");
        _nvs_wishonly = f("wishonly");
        _nvs_friendfavsonly = f("friendfavsonly");
        _nvs_newitemsonly = f("newitemsonly");
        _nvs_globsearchOld = f("globsearchOld");
        _nvs_catOld = f("categoryOld");
        _nvs_favsonlyOld = f("favsonlyOld");
        _nvs_wishonlyOld = f("wishonlyOld");
        _nvs_friendFavsonlyOld = f("friendFavsonlyOld");
        _nvs_newItemsOnlyOld = f("newItemsOnlyOld");
    }

    // get all state vars
    var navState= new Object();
    navState.page = currentPage;
    navState.currentTab = _nvs_currentTab.value;
    navState.zoomfield = _nvs_zoomfield.value;
    navState.centerfield = _nvs_centerfield.value;
    navState.globsearch = _nvs_globsearch.value;
    navState.category = _nvs_category.value;
    navState.favsonly = _nvs_favsonly.checked;
    navState.wishonly = _nvs_wishonly.checked;
    navState.friendfavsonly = _nvs_friendfavsonly.checked;
    navState.newitemsonly = _nvs_newitemsonly.checked;
    navState.globsearchOld = _nvs_globsearchOld.value;
    navState.catOld = _nvs_catOld.value;
    navState.favsonlyOld = _nvs_favsonlyOld.value;
    navState.wishonlyOld = _nvs_wishonlyOld.value;
    navState.friendFavsonlyOld = _nvs_friendFavsonlyOld.value;
    navState.newItemsOnlyOld = _nvs_newItemsOnlyOld.value;
    // build new url with state
    var url = new StringBuffer();
    url.append("#");
    for (var i in navState)
    {
        if (i != "page")
            url.append("&");
        url.append(i).append("=").append(navState[i]);
    }
    // set it
    window.location.href = url.toString();
} 
```

这是调用树的样子，来自 IE8 分析器：

```
saveState               1    615,00 ms
  f                    15      1,00 ms
  String.split          1      0,00 ms
    Array               1      0,00 ms
  Object                1      0,00 ms
  StringBuffer          1      0,00 ms
  append               64      0,00 ms
    Array.push         64      0,00 ms
  toString              1      0,00 ms
    Array.join          1      0,00 ms
  Object.valueOf       63      0,00 ms
  Function.toString    63      0,00 ms 
```

我正在使用的 StringBuffer 实现：

```
function StringBuffer() { 
    this.buffer = []; 
} 

StringBuffer.prototype.append = function append(string) { 
    this.buffer.push(string); 
    return this; 
}; 

StringBuffer.prototype.toString = function toString() { 
    return this.buffer.join(""); 
}; 
```

**编辑：**更新的代码，平均需要 397 毫秒才能运行。

```
var _nvs_currentTab;
var _nvs_zoomfield;
var _nvs_centerfield;
var _nvs_globsearch;
var _nvs_category;
var _nvs_favsonly;
var _nvs_wishonly;
var _nvs_friendfavsonly;
var _nvs_newitemsonly;
var _nvs_globsearchOld;
var _nvs_catOld;
var _nvs_favsonlyOld;
var _nvs_wishonlyOld;
var _nvs_friendFavsonlyOld;
var _nvs_newItemsOnlyOld;

function saveState()
{
    if (!_nvs_currentTab)
    {
        var _f = document.guideForm;
        _nvs_currentTab = _f.currentTab;
        _nvs_zoomfield = _f.zoomfield;
        _nvs_centerfield = _f.centerfield;
        _nvs_globsearch = _f.globsearch;
        _nvs_category = _f.category;
        _nvs_favsonly = _f.favsonly;
        _nvs_wishonly = _f.wishonly;
        _nvs_friendfavsonly = _f.friendfavsonly;
        _nvs_newitemsonly = _f.newitemsonly;
        _nvs_globsearchOld = _f.globsearchOld;
        _nvs_catOld = _f.categoryOld;
        _nvs_favsonlyOld = _f.favsonlyOld;
        _nvs_wishonlyOld = _f.wishonlyOld;
        _nvs_friendFavsonlyOld = _f.friendFavsonlyOld;
        _nvs_newItemsOnlyOld = _f.newItemsOnlyOld;
    }

    // build new url with state
    var url = new StringBuffer();
    url.append("#");
    url.append('currentPage=').append(currentPage);
    url.append('&currentTab=').append(_nvs_currentTab.value);
    url.append('&zoomfield=').append(_nvs_zoomfield.value);
    url.append('&centerfield=').append(_nvs_centerfield.value);
    url.append('&globsearch=').append(_nvs_globsearch.value);
    url.append('&category=').append(_nvs_category.value);
    url.append('&favsonly=').append(_nvs_favsonly.checked);
    url.append('&wishonly=').append(_nvs_wishonly.checked);
    url.append('&friendfavsonly=').append(_nvs_friendfavsonly.checked);
    url.append('&newitemsonly=').append(_nvs_newitemsonly.checked);
    url.append('&globsearchOld=').append(_nvs_globsearchOld.value);
    url.append('&catOld=').append(_nvs_catOld.value);
    url.append('&favsonlyOld=').append(_nvs_favsonlyOld.value);
    url.append('&wishonlyOld=').append(_nvs_wishonlyOld.value);
    url.append('&friendFavsonlyOld=').append(_nvs_friendFavsonlyOld.value);
    url.append('&newItemsOnlyOld=').append(_nvs_newItemsOnlyOld.value);
    // set it
    window.location.href = url.toString();
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-07T09:02:30.773

好吧，你不会相信的。我刚刚尝试删除以下行：

`window.location.href = url.toString();`

并且它将平均运行时间减少到三分之二毫秒。我从分析 toString 调用中知道非常快，因此显然设置 window.location.href 非常慢（几百毫秒！！！）。呸，我讨厌 IE。

注意：这是 Internet Explorer 的全新安装，我没有让我的浏览器变慢的疯狂工具栏。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T08:37:44.857

似乎您存储了某种形式的字段。

而不是使用`document.getElementById()`获取表单的每个元素尝试直接获取表单元素的值：

`navState.currentTab = document.formName.currentTab.value;`

其中`formName`是标签`name`属性的值，是表单元素（即输入、复选框）的属性值。`form``currentTab``name`

**编辑：**

当我在 2000 年使用 IE5 和 IE5.5 时，甚至更改（在变量中存储对表单元素的引用）：

```
for (i = 0; i < document.form.elements.length; i++) {
  values[i] = document.form.elements[i].value;
} 
```

到：

```
var form = document.form;
for (i = 0; i < form.elements.length; i++) {
  values[i] = form.elements[i].value;
} 
```

有很大的不同。

恐怕在过去的 10 年里什么都没有改变:(。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T08:37:26.620

您是否尝试过注释掉“获取所有变量”部分和`window.location.href`行？它可能是`input`导致延迟的 s 或导航（例如有问题的浏览器工具栏）之一。

顺便说一句，它在我的测试页面上运行良好，但可能是你有一个更大的 DOM。

# c# - 用作属性的对象的 C# 泛型列表 - 无法添加值

> ID：833442
> 
> 赞同：9
> 
> 时间：2009-05-07T08:17:36.933
> 
> 标签：c#, generics, properties

我第一次尝试泛型并且遇到了问题。

我有一个批量发送消息的 dll

*   该dll中有一个“消息”类和一个“批处理”类

*   在批处理类上，我有一些公共属性

*   在批处理类的公共属性中，有一个名为“Messages”的属性，它是“Message”类的列表，如下所示：

    ```
     public List<Message> Messages {get;set;} 
    ```

**方法一**

然后我有一个测试 exe，我想在“批处理”类上设置属性，如下所示：

```
Batch myBatch = new Batch()
myBatch.Messages.Add(
  new MyNameSpace.Message(txtToAddress.Text, txtMessage.Text)); 
```

当我运行应用程序时，我得到：

“你调用的对象是空的。”

**方法二**

玩了一会后，我发现我可以在测试 exe 中成功执行以下操作：

```
List<MyNameSpace.Message> myMessages = new List<MyNameSpace.Message>();
myBatch.Messages.Add(
 new MyNameSpace.Message(txtToAddress.Text, txtMessage.Text));
myBatch.Messages = myMessages; 
```

我想让它以第一种方式工作，因为其他程序员将使用 dll，使用第一种方法似乎更直观。

为了使第一种方法起作用，我缺少什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-07T08:19:28.113

通常，集合由父对象初始化：

```
public List<Message> Messages {get; private set;}

public Batch() { // constructor
    Messages = new List<Message>();
} 
```

现在它应该按预期工作。请注意，如果您正在使用，`XmlSerializer`您也需要保留公共集......

在某些方面，这里的长期属性代码更容易：

```
private List<Message> messages = new List<Message>();
public List<Message> Messages { get {return messages; } } 
```

（不要弄乱构造函数等）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T08:20:13.090

您需要先实例化您的列表。

将此添加到您的构造函数

```
Messages = new List<Message>(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T08:20:14.337

```
Batch myBatch = new Batch()
myBatch.Messages.Add( 
```

创建新批次后，消息列表可能尚未创建。在 Batch 的构造函数中创建 List。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T08:21:34.367

在`Batch`类的构造函数中，为属性创建一个列表`Messages`：

```
public Batch() {
   Messages = new List<Messages>();
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T08:21:45.863

您的 Batch 类必须负责在构造函数中创建 List 的实例，这可能是最好的地方。

# unit-testing - 编写与浏览器一起工作的测试是否值得（比如使用 selenium 或其他东西）？

> ID：833444
> 
> 赞同：6
> 
> 时间：2009-05-07T08:18:16.073
> 
> 标签：unit-testing, selenium

为发生在服务器端的事情编写测试显然是值得的，但我听说为 UI 编写单元测试真的很困难，而且它们很脆弱且不可靠。我希望更有信心，我所做的更改不会破坏我网站上导入页面的主要部分。

有什么想法或经验吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T18:47:22.787

UI 测试可能缓慢、脆弱且难以维护，但有些错误只能在 UI 测试中发现。重要的问题不是编写 UI 测试是否值得，而是如何保持 UI 测试有用、稳定和可维护。

一个常见的错误是使用 UI 测试代替其他测试。从理论上讲，您可以通过 UI 测试来测试很多功能，但是这种方法存在很多问题。对于初学者来说，某些功能可能很难直接在 UI 中进行测试（尤其是特殊情况）。其次，如果测试失败，通常很难看出问题的根源是什么。最后，您在 UI 测试中测试的代码路径越多，UI 测试的速度就越慢。如果您只依赖缓慢的测试，您的工作效率会变得更差，这会增加“临时”关闭损坏测试的诱惑。

我的建议是在单元测试和集成测试中尽可能多地进行测试，在 UI 和业务逻辑之间建立良好的分离，并使用 UI 测试来捕获/防止无法在其他类型的测试中测试的错误。

如果您有很多测试，请考虑创建多个套件。我创建了一套用于 UI 测试、一套用于集成测试和一套用于单元测试。单元测试非常快，所以我在开发代码时运行它们（通常通过 TDD）。这些是帮助我提高工作效率的测试。

我不太经常运行的集成测试（也许在我完成了一些更改之后）。我在准备提交更改时运行的 UI 测试（或者当我编写更多的 UI 测试时，很明显）。

最后一点建议：考虑使用[特定领域语言](http://en.wikipedia.org/wiki/Domain-specific_programming_language)编写 UI 测试。这使得更容易理解测试（因为它们被视为一组用户步骤，而不是一堆低级浏览器操作）。它还可以使代码更易于维护。例如，不是让每个测试都通过逐步浏览器操作来登录用户，您可能会看到：

```
LoginPage loginPage = new LoginPage(selenium);
HomePage homePage = loginPage
    .enterUserName(TestUsers.Alice.USER_NAME)
    .enterPassword(TestUsers.Alice.PASSWORD)
    .submit();
assertThat(homePage.getBreadcrumbs(), equalTo("Home")); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T08:53:22.697

这很容易，可以由技术不高的人完成，绝对值得付出努力。UI 测试对于桌面应用程序来说很难，对于 Web 应用程序来说并不难，因为您可以移动控件，而 selenium 仍然能够在 HTML 中找到它们。可怜的桌面开发者没有这样的运气。

当然，你总是有可能过度使用它，以至于与努力相比它不会给你带来太多回报，但它与正常的单元测试相同。你应该知道什么时候停止。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T11:17:01.540

我将它们用作开发的一部分。它们很酷的一点是你也可以在 IE 中执行它们（你需要 selenium 服务器）。我只在开发阶段使用它们，而不是像单元测试一样对待它们。如果我做一些特定于 UI 的逻辑，它们确实有很大帮助。

最重要的是将 id 分配给所有使用的 html 元素。没有它，测试非常脆弱。使用评论也有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T11:20:17.557

你为覆盖应用程序的不同动态而编写的测试越多越好。当您需要更改应用程序生成的页面上的某些内容时，您的测试会告诉您是否有任何问题。

是的，它们很脆弱，是的，让疯狂的选择器路径正常工作很痛苦......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T08:57:20.940

您可以使用[browsershots.org](http://browsershots.org)来检查您的页面在几乎所有浏览器中的外观。

# c# - 为什么这个演员是不可能的？

> ID：833447
> 
> 赞同：4
> 
> 时间：2009-05-07T08:18:39.067
> 
> 标签：c#, generics, oop

```
interface IFolderOrItem<TFolderOrItem> where TFolderOrItem : FolderOrItem {}

abstract class FolderOrItem {}

class Folder : FolderOrItem {}

abstract class Item : FolderOrItem {}

class Document : Item {} 
```

现在我正在尝试这样做：

```
class Something
{
    IFolderItemOrItem<Item> SelectedItem { get; set; }
    void SomeMagicMethod()
    {
        this.SelectedItem = (IFolderOrItem<Item>)GetMagicDocument();
        // bad bad bad ... ??
    }
    IFolderOrItem<Document> GetMagicDocument()
    {
        return someMagicDocument; // which is of type IFolderOrItem<Document>
    }
} 
```

有没有可能让这个工作？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-07T08:28:16.610

如果我没看错……那么问题就在于`Foo : Bar`，那**并不**意味着`ISomething<Foo> : ISomething<Bar>`……

在某些情况下，C# 4.0 中的变化可能是一种选择。或者，有时您可以使用泛型方法做一些事情（但不确定它是否会有所帮助）。

* * *

您在 C# 3.0（及更低版本）中可以做的最接近的可能是非通用基本接口：

```
interface IFolderOrItem {}
interface IFolderOrItem<TFolderOrItem> : IFolderOrItem
    where TFolderOrItem : FolderOrItem { } 
```

通常，基本接口将具有，例如，a`Type ItemType {get;}`来指示正在考虑的实际类型。然后用法：

```
IFolderOrItem SelectedItem { get; set; }
...
public void SomeMagicMethod()
{
    this.SelectedItem = GetMagicDocument(); // no cast needed
    // not **so** bad
} 
```

* * *

从规范来看，这与 §25.5.6 (ECMA 334 v4) 有关：

> 25.5.6 转换
> 
> 构造类型遵循与非泛型类型相同的转换规则（第 13 节）。应用这些规则时，构造类型的基类和接口应按照第 25.5.3 节中的描述确定。
> 
> 除了 §13 中描述的那些之外，构造的引用类型之间不存在特殊的转换。特别是，与数组类型不同，构造的引用类型不允许协变转换（第 19.5 节）。这意味着一个类型`List<B>`没有转换（隐式或显式）到`List<A>`即使`B`是从`A`. 同样，不存在从`List<B>`到 的 转换`List<object>`。
> 
> [注意：这样做的理由很简单：如果 `List<A>`允许转换为，那么显然，可以将类型的值存储`A`到列表中。但是，这会破坏 type 列表中的每个对象`List<B>`始终是 type 的值这一不变性，`B`否则在分配给集合类时可能会发生意外失败。尾注]

这同样适用于接口。这在 C# 4.0 中有所改变*，*但仅在某些情况下。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T08:25:30.020

就编译器而言，`IFolderOrItem<Document>`&`IFolderOrItem<Item>`是两种完全不同的类型。

`Document`可以继承`Item`，但`IFolderOrItem<Document>`不能继承`IFolderOrItem<Item>`

我依靠 Marc 或 Jon 发布指向 C# 规范相关部分的链接。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T08:26:46.023

问题是强制转换不适用于泛型参数，而是对整个类起作用。Document 继承自 Item，true，但 IFolderOrItem<Document> 不继承自 IFolderOrItem<Item>，也没有任何关系。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T08:42:15.173

一个理解它为什么会这样工作的例子：

假设 IFolderOrItem 公开了一个方法，例如 void Add(T element)。

您对 IFolderOrItem 的实现将假设参数是一个文档。

但是你们将 IFolderOrItem 转换为 IFolderItemOrItem，然后有人可以调用 Create(T) 方法，其中 T 应该是一个项目。

从 Item 到 Document 的转换是无效的，因为 Item 不是 Document。

你这样做的唯一方法是创建一个非通用版本的接口，允许对象作为参数，在你的实现中检查对象的类型。

# htmltidy - 如何阻止 HTML Tidy 删除我的结束标签？

> ID：833448
> 
> 赞同：0
> 
> 时间：2009-05-07T08:19:24.807
> 
> 标签：htmltidy

目前 HTML Tidy 正在更改任何空的 HTML 标记并将它们合并为一个，例如：

```
<script src="somescript.js"></script> 
```

变成：

```
<script src="somescript.js" /> 
```

这是一个问题，因为在我的 HTML 的“head”中包含 javascript 文件现在在某些明确需要此结束标记与开始标记分开的浏览器中不起作用。

如何阻止 Tidy 删除这些结束标签？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-11T21:15:44.847

尝试在元素中粘贴一些内容，这些`<script>`内容不会扰乱浏览器，但会阻止 Tidy 折叠标签。诸如空格、 或`&nbsp;`javascript 注释之类的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T08:26:22.777

您是否为 HTML 定义了 DOCTYPE？

将关闭标签包装成单个标签应该适用于有效的 Xhtml，但可能会扰乱 ye olde html。

# flash - Flash AS3中的动态stageWidth和Height

> ID：833466
> 
> 赞同：3
> 
> 时间：2009-05-07T08:24:00.380
> 
> 标签：flash, actionscript-3, web-applications, stage

这似乎是一件非常容易的事情，但它让我很头疼。我有一个作为画廊的影片剪辑，当单击按钮时，它被链接为从 AS 调用。单击图库中的图像时，它会使用 Tween 类淡入淡出，并且*应该*在主舞台上居中，但它却以movieClip为中心。

这是代码：

```
//Centers and places image right ondo the display board
function fullLoaded(e:Event):void {
    var myFull:Loader = Loader(e.target.loader);
    addChild(myFull);

    //positioning
    myFull.x = (stage.stageWidth - myFull.width) / 2;
    myFull.y = (stage.stageHeight - myFull.height) /2;

    //register the remove function
    myFull.addEventListener(MouseEvent.CLICK, removeFull);

    new Tween(myFull, "alpha", Strong.easeInOut,0,1,0.5,true);
} 
```

我尝试了所有这些组合都无济于事：

```
MovieClip(root).stage.stageWidth  
root.stage.stageWidth  
parent.stage.stageWidth 
```

这些都没有将图像放在正确的位置。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T10:47:11.473

设置这些这个属性，让你的舞台在左上角有它的 origo (0x0)：

```
stage.align = StageAlign.TOP_LEFT; 
```

这使舞台保持与窗口更改大小相同的比例：

```
stage.scaleMode = StageScaleMode.NO_SCALE; 
```

然后你需要等到你的图像被加载后再对齐它，因为在那之前它没有宽度。我还建议`Event.RESIZE`在舞台上收听，只要尺寸发生变化就会触发。

假设您当前的代码应该可以正常工作！

```
myFull.x = (stage.stageWidth - myFull.width) / 2;
myFull.y = (stage.stageHeight - myFull.height) /2; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-13T08:52:26.707

`MovieClip(root).addChild(myFull);` 不要忘记做同样的事情`removeChild`

# regex - url 的正则表达式

> ID：833469
> 
> 赞同：28
> 
> 时间：2009-05-07T08:26:02.700
> 
> 标签：regex, url, dns

> **可能重复：**
> [检查字符串是否为有效 URL 的最佳正则表达式是什么？](https://stackoverflow.com/questions/161738/what-is-the-best-regular-expression-to-check-if-a-string-is-a-valid-url)

没有 url 的正则表达式是`http://www.`什么？当用户输入uri名称时，我想验证它是否是uri

# linux - linux下j2EE/Flex的开发平台？

> ID：833470
> 
> 赞同：1
> 
> 时间：2009-05-07T08:26:14.730
> 
> 标签：linux, apache-flex, compatibility

在工作中，我们为所有笔记本电脑运行 vista。我不太喜欢它。由于许可证（和金钱）问题，XP 不是一个选项。老板和团队什么都可以，因为工作已经完成。

所以我希望将我的开发平台切换到linux（我不在乎）。

问题：我们正在 Adob​​e Flex 中构建一些东西。而且我已经为这对 flex / linux 读了很多不好的东西。

我的问题：我能否在 Linux 下使用 eclipse 和 flexbuilder 插件在不受巨大限制的情况下开发 Flex/J2EE 应用程序。（或至少 eclipse + flexSDK 编译器）

谢谢你的建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T10:35:38.677

尝试使用[AXDT](http://axdt.org/)插件作为 FlexBuilder 的免费替代品。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T08:43:49.600

我在 Linux 上开发，但有一个虚拟盒子实例，只是为了包住我需要使用 windows 来工作。效果很好:-)

# subsonic - 重命名 SubSonic 选择语句中的字段

> ID：833481
> 
> 赞同：0
> 
> 时间：2009-05-07T08:30:59.007
> 
> 标签：subsonic

在 SubSonic 中执行 select 语句时，有没有办法重命名字段？我正在使用*ExecuteTypedList<MyClass>*方法填充我的*List<MyClass>*对象，但 MyClass 的属性与数据库表中的列名并不完全相同。在 SQL 中，我可以*从 MyTable 中选择 col1 作为“FirstColumn”，将 col2 作为“SecondColumn”*，有没有办法在 SubSonic 中做类似的事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T20:04:29.603

前几天我也有同样的需求，并将该功能添加到我的本地 SubSonic 副本中。我刚刚提交了一个附加到[这个问题](http://code.google.com/p/subsonicproject/issues/detail?id=88)的补丁。应用补丁将使您可以编写如下查询

```
new Select(Table1.IdColumn.AliasAs("table1ID"),
Table2.IdColumn.AliasAs("table2ID"))
                .From(Table1.Schema)
                .InnerJoin(Table2.Table1IdColumn, Table1.IDColumn); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T14:35:59.707

我相信别名仅适用于聚合列。您可以将与您的列同名的属性添加到您的类或部分中，并将它们映射到您使用 ala 计算字段的属性：

```
public class Songs 
```

{

```
private string _songTitle;
public string SongTitle {
    get { return _songTitle; }
    set { _songTitle = value; }
}

public string SongName {
    get { return _songTitle; }
    set { _songTitle = value; }
} 
```

}

# java - 没有单例的 Java

> ID：833482
> 
> 赞同：2
> 
> 时间：2009-05-07T08:30:59.537
> 
> 标签：java, design-patterns

只是出于兴趣：如果排除了静态变量，您认为 Java 会成为一种更好的语言，从而有效地用单例替换单例吗？[定义在这里。](http://googletesting.blogspot.com/2008/08/root-cause-of-singletons.html)

如果您这么认为：您能否详细说明将其包含在语言中的动机是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T08:50:49.037

您引用的同一篇文章有​​以下声明：

> 另一种半可接受的单例是那些不影响代码执行的单例，它们没有“副作用”

...然后文章解释了日志记录。另一个典型的例子是印刷。因此，即使在呼吁“让我们摆脱所有单身人士”的文章中，这也是单身人士的论点。

作者提供的论点很有趣。他指出，拥有全局状态是 Singleton 的真正问题，只要您的程序和 Singleton 之间存在单向通信，您就清楚了。

如果没有静态变量，Java 肯定会是一种更糟糕的语言，因为它是多个用例中需要的特性。我的意思是，如果你真的想要的话，你可以在 Java 中以一种程序化的方式编程……这本身并不是邪恶的。

静态变量和单例的滥用并不一定意味着我们需要摆脱它们。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T08:43:14.390

> 如果静态变量被>排除，你认为Java会是一种更好的语言，有效地用单例替换单例？

不，有时您*确实*希望拥有所有对象共有的变量或常量。当然，**静态**不一定是邪恶的。

> 您能否详细说明将其包含在语言中的动机是什么？

**static**是不需要绑定到数据的对象或方法的简写，它对没有实例数据的行为进行建模。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T08:44:24.467

尽管鄙视单例和任何静态非最终的东西，我偶尔会使用以下成语为对象生成唯一的 ID。

```
private static long idCounter;
private synchronized static long getID() { return idCounter++; }
private final long id = getID(); 
```

所以这是拥有静态非决赛的一个论点。

（或者，正如 Tom Hawtin 指出的，稍微好一点的

```
private static final AtomicLong idCounter = new AtomicLong();
private final long id = idCounter.getAndIncrement(); 
```

)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T09:06:53.413

显然静态常量很有用。要在 Java 中使对象成为常量，您需要定义一个不可变类型。就目前而言，Java 有点缺乏常量类型。例如，很常见的是静态字段带有（非空）数组，但（希望_被视为常量。

在相对较少的情况下，可变静态是有意义的。例如，一些缓存和向现有对象添加外部字段。类似地，即使是常量`String`也有一个可变字段。

所以完全摆脱静态对于通用语言来说有点困难。我相信范和新话会这样做。

然而，常见的可变静态，无论是否装扮成单例，绝对是可以去的。API 当然会有所不同。这会让我的工作轻松很多。例如，该`SecurityManager`机制将是多余的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T11:01:06.930

我认为 java 将是一种没有静态的*更漂亮*的语言，但我不认为单例反模式可以通过删除关键字来解决。

单例是邪恶的，因为它“知道”自己不应该知道的一些事情，即它是整个系统中其类型的唯一实例。每当这种信息被封装在一个类中时，你就有了一个事实上的单例。

至于为什么它是在 Java 中的，我推测，就像整个范围的事情一样，它是 OO 纯度和实用性之间的折衷。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T08:48:04.753

我同意 DFA。有时静态是有道理的。

它也是一种语言功能，鄙视它的人可以选择不使用它。我发现静态和单例很有用。

# c# - 在 KeyValuePair 数组中捕获传入的参数值

> ID：833489
> 
> 赞同：6
> 
> 时间：2009-05-07T08:33:48.453
> 
> 标签：c#, reflection, arguments

我想知道如何在数组中获取方法的传入参数。或者只是动态地检索我的参数的值。

意思是，像这样的调用：

```
MyMethod(10, "eleven"); 
```

对于方法：

```
void MyMethod(int Test, str Test2) {} 
```

将在一个数组中解析，如：

```
{{"Test" => 10}, {"Test2", "eleven"}} 
```

如果我能通过反射实现这一点会更好。例如。以某种方式使用 StackTrace。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T08:42:20.633

我认为，您正在寻找的东西不存在。您可以拥有的最接近的是参数：

```
MyMethod(params object[] args) 
{
    // if you have to do this, it's quite bad:
    int intArg = (int)args[0];
    string stringArg = (string)arg[1]:
}

// call with any number (and type) of argument
MyMethod(7, "tr"); 
```

没有编译时类型检查，因此它不是处理参数的万能方法。但*如果*你的论点*是*动态的，它可能是一个解决方案。

* * *

**编辑：**有另一个想法：

您需要将所有参数手动放入列表/字典中。您可以编写一个助手类以允许以下操作：

```
MyMethod(int arg1, string arg2) 
{
    Arguments.Add(() => arg1);
    Arguments.Add(() => arg2);
    //
} 
```

助手看起来像这样

```
public static void Add<T>(Expression<Func<T>> expr)
{
    // run the expression to get the argument value
    object value = expr.Compile()();
    // get the argument name from the expression
    string argumentName = ((MemberExpression)expr.Body).Member.Name;

    // add it to some list:
    argumentsDic.Add(argumentName, value);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T08:39:46.333

最好的选择是使用匿名类型，如[本例](https://stackoverflow.com/questions/622880/named-optional-parameters-in-c-3-0/622894#622894)所示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-11T00:16:00.503

Maybe this won't be exactly what you were looking for, but I found I could get a reasonable compromise for my situation using a variation on the method Matt Hamilton suggested and making use of the implicit naming of anonymous type parameters:

```
public void MyMethod(string arg1, bool arg2, int arg3, int arg4)
{
    var dictionary = new PropertyDictionary(new 
    { 
        arg1, arg2, arg3, arg4 
    });
}

public class PropertyDictionary : Dictionary<string, object>
{
    public PropertyDictionary(object values)
    {
        if(values == null)
            return;

        foreach(PropertyDescriptor property in TypeDescriptor.GetProperties(values))
            Add(property.Name, property.GetValue(values);   
    }
} 
```

As I said, it may not be helpful in your situation, but in mine (unit testing a method which processes XML) it was very useful.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T08:47:11.853

好问题（+1）。我想这就是你需要的——

```
MethodBase mb = MethodBase.GetCurrentMethod();
ParameterInfo[] pi = mb.GetParameters(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T08:52:47.050

我知道的一种方法（不确定它是否是当今*唯一*的方法，但它曾经是）是使用面向方面的编程（AOP），尤其是拦截。手动滚动它有点痛苦，但是有一些出色的工具可以提供帮助。PostSharp 就是这样一种工具：[http](http://www.postsharp.org/) ://www.postsharp.org/ 。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T09:03:24.297

由于该方法使用命名参数，为什么不能直接用它们的名称和值显式填充字典？由于您已经知道它们，因此使用反射来获取它们的名称没有什么意义。

如前所述，params 关键字可用于定义具有可变数量参数的方法，但根据定义，这些参数是无名的。

我不确定你在问什么，按照你解释的方式，有什么意义。也许您可以进一步详细说明？

# asp.net - Gridview 行编辑 - 动态绑定到 DropDownList

> ID：833490
> 
> 赞同：23
> 
> 时间：2009-05-07T08:34:19.653
> 
> 标签：asp.net, gridview, drop-down-menu, dynamic-binding

我试图让一个 ASP.NET 3.5 GridView 在显示时将选定的值显示为字符串，并显示一个 DropDownList 以允许我在编辑时从给定的选项列表中选择一个值。看起来很简单？

我的 gridview 看起来像这样（简化）：

```
<asp:GridView ID="grvSecondaryLocations" runat="server" 
              DataKeyNames="ID" OnInit="grvSecondaryLocations_Init" 
              OnRowCommand="grvSecondaryLocations_RowCommand" 
              OnRowCancelingEdit="grvSecondaryLocations_RowCancelingEdit"
              OnRowDeleting="grvSecondaryLocations_RowDeleting"
              OnRowEditing="grvSecondaryLocations_RowEditing" 
              OnRowUpdating="grvSecondaryLocations_RowUpdating"  >
<Columns>
    <asp:TemplateField>
         <ItemTemplate>
              <asp:Label ID="lblPbxTypeCaption" runat="server" 
                                 Text='<%# Eval("PBXTypeCaptionValue") %>' />
         </ItemTemplate>
         <EditItemTemplate>
                      <asp:DropDownList ID="ddlPBXTypeNS" runat="server" 
                               Width="200px" 
                               DataTextField="CaptionValue" 
                               DataValueField="OID" />
         </EditItemTemplate>
    </asp:TemplateField>
</asp:GridView> 
```

网格在不处于编辑模式时显示正常 - 选定的 PBX 类型在 asp:Label 控件中显示其值。那里并不奇怪。

我将 DropDownList 的值列表加载到表单事件中调用`_pbxTypes`的本地成员中。`OnLoad`我验证了这一点 - 它有效，值在那里。

现在我的挑战是：当网格进入特定行的编辑模式时，我需要绑定存储在`_pbxTypes`.

很简单，我想 - 只需抓住事件中的下拉列表对象`RowEditing`并附加列表：

```
protected void grvSecondaryLocations_RowEditing(object sender, GridViewEditEventArgs e)
{
    grvSecondaryLocations.EditIndex = e.NewEditIndex;

    GridViewRow editingRow = grvSecondaryLocations.Rows[e.NewEditIndex];

    DropDownList ddlPbx = (editingRow.FindControl("ddlPBXTypeNS") as DropDownList);
    if (ddlPbx != null)
    {
        ddlPbx.DataSource = _pbxTypes;
        ddlPbx.DataBind();
    }

    .... (more stuff)
} 
```

麻烦的是 - 我从来没有从`FindControl`电话中得到任何回报 - 似乎`ddlPBXTypeNS`不存在（或找不到）。

我错过了什么？？一定是真的很愚蠢......但到目前为止，我所有的谷歌搜索、阅读 GridView 控件和询问好友都没有帮助。

谁能发现缺失的链接？;-)

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-05-07T08:52:26.070

很容易......你做错了，因为在那个事件中，控件不存在：

```
protected void gv_RowDataBound(object sender, GridViewRowEventArgs e)
{
    if (e.Row.RowType == DataControlRowType.DataRow && 
        (e.Row.RowState & DataControlRowState.Edit) == DataControlRowState.Edit)
    { 
        // Here you will get the Control you need like:
        DropDownList dl = (DropDownList)e.Row.FindControl("ddlPBXTypeNS");
    }
} 
```

也就是说，它仅对`DataRow`（实际包含数据的行）有效，并且如果它处于**编辑**模式......因为您一次只能编辑一行。`e.Row.FindControl("ddlPBXTypeNS")`只会找到您想要的控件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T08:49:29.260

我在 3.5 中使用 ListView 而不是 GridView。当用户想要编辑时，我已将下拉列表的选定项设置为记录的该列的现有值。我可以访问 ItemDataBound 事件中的下拉列表。这是代码：

```
protected void listViewABC_ItemDataBound(object sender, ListViewItemEventArgs e)
{
    // This stmt is used to execute the code only in case of edit 
    if (((ListView)(sender)).EditIndex != -1 && ((ListViewDataItem)(e.Item)).DisplayIndex == ((ListView)(sender)).EditIndex)
    {
        ((DropDownList)(e.Item.FindControl("ddlXType"))).SelectedValue = ((MyClass)((ListViewDataItem)e.Item).DataItem).XTypeId.ToString();
        ((DropDownList)(e.Item.FindControl("ddlIType"))).SelectedValue = ((MyClass)((ListViewDataItem)e.Item).DataItem).ITypeId.ToString();
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T10:14:04.407

您可以使用 SelectedValue：

```
<EditItemTemplate>
    <asp:DropDownList ID="ddlPBXTypeNS"
                      runat="server"
                      Width="200px"
                      DataSourceID="YDS"
                      DataTextField="CaptionValue"
                      DataValueField="OID"
                      SelectedValue='<%# Bind("YourForeignKey") %>' />
    <asp:YourDataSource ID="YDS" ...../>
</EditItemTemplate> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-12T12:56:19.983

```
protected void grvSecondaryLocations_RowEditing(object sender, GridViewEditEventArgs e)  
{  
    grvSecondaryLocations.EditIndex = e.NewEditIndex;  

    DropDownList ddlPbx = (DropDownList)(grvSecondaryLocations.Rows[grvSecondaryLocations.EditIndex].FindControl("ddlPBXTypeNS"));
    if (ddlPbx != null)  
    {  
        ddlPbx.DataSource = _pbxTypes;  
        ddlPbx.DataBind();  
    }  

    .... (more stuff)  
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-09T00:16:14.403

[balexandre](https://stackoverflow.com/a/833555/758118)的检查答案效果很好。但是，如果适应其他一些情况，它会产生问题。

我用它来更改两个标签控件的值 -`lblEditModifiedBy`并且`lblEditModifiedOn`- 当我编辑一行时，以便正确的 ModifiedBy 并将`ModifiedOn`在“更新”时保存到数据库中。

当我单击“更新”按钮时，`RowUpdating`它会显示我在`OldValues`列表中输入的新值。更新数据库时，我需要真正的“旧值”作为 Original_ 值。（有一个`ObjectDataSource`附件`GridView`。）

对此的解决方法是使用 balexandre 的代码，但在`gv_DataBound`事件中采用修改后的形式：

```
protected void gv_DataBound(object sender, EventArgs e)
{
    foreach (GridViewRow gvr in gv.Rows)
    {
        if (gvr.RowType == DataControlRowType.DataRow && (gvr.RowState & DataControlRowState.Edit) == DataControlRowState.Edit)
        {
            // Here you will get the Control you need like:
            ((Label)gvr.FindControl("lblEditModifiedBy")).Text = Page.User.Identity.Name;
            ((Label)gvr.FindControl("lblEditModifiedOn")).Text = DateTime.Now.ToString();
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-05-03T12:23:05.143

```
 <asp:GridView ID="GridView1" runat="server" PageSize="2" AutoGenerateColumns="false"
            AllowPaging="true" BackColor="White" BorderColor="#CC9966" BorderStyle="None"
            BorderWidth="1px" CellPadding="4" OnRowEditing="GridView1_RowEditing" OnRowUpdating="GridView1_RowUpdating"
            OnPageIndexChanging="GridView1_PageIndexChanging" OnRowCancelingEdit="GridView1_RowCancelingEdit"
            OnRowDeleting="GridView1_RowDeleting">
            <FooterStyle BackColor="#FFFFCC" ForeColor="#330099" />
            <RowStyle BackColor="White" ForeColor="#330099" />
            <SelectedRowStyle BackColor="#FFCC66" Font-Bold="True" ForeColor="#663399" />
            <PagerStyle BackColor="#FFFFCC" ForeColor="#330099" HorizontalAlign="Center" />
            <HeaderStyle BackColor="#990000" Font-Bold="True" ForeColor="#FFFFCC" />
            <Columns>
            <asp:TemplateField HeaderText="SerialNo">
            <ItemTemplate>
            <%# Container .DataItemIndex+1 %>.&nbsp
            </ItemTemplate>
            </asp:TemplateField>
                <asp:TemplateField HeaderText="RollNo">
                    <ItemTemplate>
                        <%--<asp:Label ID="lblrollno" runat="server" Text='<%#Eval ("RollNo")%>'></asp:Label>--%>
                        <asp:TextBox ID="txtrollno" runat="server" Text='<%#Eval ("RollNo")%>'></asp:TextBox>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField HeaderText="SName">
                    <ItemTemplate>
                    <%--<asp:Label ID="lblsname" runat="server" Text='<%#Eval("SName")%>'></asp:Label>--%>
                        <asp:TextBox ID="txtsname" runat="server" Text='<%#Eval("SName")%>'> </asp:TextBox>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField HeaderText="C">
                    <ItemTemplate>
                    <%-- <asp:Label ID="lblc" runat="server" Text='<%#Eval ("C") %>'></asp:Label>--%>
                        <asp:TextBox ID="txtc" runat="server" Text='<%#Eval ("C") %>'></asp:TextBox>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField HeaderText="Cpp">
                    <ItemTemplate>
                    <%-- <asp:Label ID="lblcpp" runat="server" Text='<%#Eval ("Cpp")%>'></asp:Label>--%>
                       <asp:TextBox ID="txtcpp" runat="server" Text='<%#Eval ("Cpp")%>'> </asp:TextBox>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField HeaderText="Java">
                    <ItemTemplate>
                       <%--  <asp:Label ID="lbljava" runat="server" Text='<%#Eval ("Java")%>'> </asp:Label>--%>
                        <asp:TextBox ID="txtjava" runat="server" Text='<%#Eval ("Java")%>'> </asp:TextBox>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField HeaderText="Edit" ShowHeader="False">
                    <EditItemTemplate>
                        <asp:LinkButton ID="lnkbtnUpdate" runat="server" CausesValidation="true" Text="Update"
                            CommandName="Update"></asp:LinkButton>
                        <asp:LinkButton ID="lnkbtnCancel" runat="server" CausesValidation="false" Text="Cancel"
                            CommandName="Cancel"></asp:LinkButton>
                    </EditItemTemplate>
                    <ItemTemplate>
                        <asp:LinkButton ID="btnEdit" runat="server" CausesValidation="false" CommandName="Edit"
                            Text="Edit"></asp:LinkButton>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:CommandField HeaderText="Delete" ShowDeleteButton="True" ShowHeader="True" />
                <asp:CommandField HeaderText="Select" ShowSelectButton="True" ShowHeader="True" />
            </Columns>
        </asp:GridView>
        <table>
            <tr>
                <td>
                    <asp:Label ID="lblrollno" runat="server" Text="RollNo"></asp:Label>
                    <asp:TextBox ID="txtrollno" runat="server"></asp:TextBox>
                </td>
                <td>
                    <asp:Label ID="lblsname" runat="server" Text="SName"></asp:Label>
                    <asp:TextBox ID="txtsname" runat="server"></asp:TextBox>
                </td>
                <td>
                    <asp:Label ID="lblc" runat="server" Text="C"></asp:Label>
                    <asp:TextBox ID="txtc" runat="server"></asp:TextBox>
                </td>
                <td>
                    <asp:Label ID="lblcpp" runat="server" Text="Cpp"></asp:Label>
                    <asp:TextBox ID="txtcpp" runat="server"></asp:TextBox>
                </td>
                <td>
                    <asp:Label ID="lbljava" runat="server" Text="Java"></asp:Label>
                    <asp:TextBox ID="txtjava" runat="server"></asp:TextBox>
                </td>
            </tr>
            <tr>
                <td>
                    <asp:Button ID="Submit" runat="server" Text="Submit" OnClick="Submit_Click" />
                    <asp:Button ID="Reset" runat="server" Text="Reset" OnClick="Reset_Click" />
                </td>
            </tr>
        </table> 
```

# jquery - jQuery UI Sortable - 不允许转移到子元素

> ID：833491
> 
> 赞同：3
> 
> 时间：2009-05-07T08:35:07.827
> 
> 标签：jquery, jquery-ui, jquery-ui-sortable, children

我正在使用 jQuery 的 UI 排序，并创建了一个这种格式的 div 系统；

```
<div class='mainDiv'>
    <label>text: <input type='text' name='textbox' /></label>

    <div class='children'>
        <div class='mainDiv'>...</div>
        <div class='mainDiv'>...</div>
        <div class='mainDiv'>
            <label>text: <input type='text' name='textbox' /></label>
            <div class='children'>...</div>
        </div>
    </div>
</div> 
```

div 可以有无限数量的孩子，我希望能够在其父框中拖放所有 .mainDiv，所以我使用了这个：

```
$(".mainDiv").parent().sortable({items: ".mainDiv", containment: "parent"}); 
```

但是，这允许将元素拖到其子级或兄弟级 .children div 中。我不想发生这种情况。我想限制元素留在他们的父母之内。

这里的任何帮助都会很热。

干杯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-11-24T03:36:14.010

我设法像这样解决它：

```
$(this).parent().sortable({
    items: '> li',
    axis: 'y',
    ...
}); 
```

在您的情况下，它应该与：

```
items: '> .mainDiv' 
```

**遏制：不需要**“父母” 。****

 **In my case, I enable "sortable" during a previous click event, as it is faster. I think its easier if you bind it to the "mousedown" event. If you create the tree dynamically (e.g.Ajax), I recommend you to use "livequery".

# ruby-on-rails - 将 onClick 事件附加到 Rails 的 link_to_function

> ID：833492
> 
> 赞同：5
> 
> 时间：2009-05-07T08:35:26.267
> 
> 标签：ruby-on-rails, prototype, onclick, form-for, link-to-function

如何将 onclick 事件附加到`link_to_function`单击事件刷新页面上的元素（使用部分）？

当用户单击生成的链接时，我想刷新包含代码的部分，以便`i`更新。

```
 def add_step_link(form_builder)
    logger.info 'ADD_STEP_LINK'
    link_to_function 'add a step' do |page|
      form_builder.fields_for :steps, Step.new, :child_index => 'NEW_RECORD' do |f|
        logger.info 'inserted js'
        html = render(:partial => 'step', :locals => { :step_form => f, :i=>@i+=1})
        page << "$('steps').insert({ bottom: '#{escape_javascript(html)}'.replace(/NEW_RECORD/g, new Date().getTime()) });"
      end
    end
  end 
```

我有一个较大形式的部分，其中仅包含：

```
<%= add_step_link(technique_form) %> 
```

我正在尝试跟踪技术中的步骤数。在我创建的表单中，用户可以将新步骤添加到一组说明中。现在，我有步骤 1-7 的默认字段。添加一个步骤，即可获得第 8 步。问题是后续步骤也编号为“8”。

为了我自己的目的，我正在扩展[http://railsforum.com/viewtopic.php?id=28447](http://railsforum.com/viewtopic.php?id=28447)中的“动态形式的多个子模型”教程。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-09T19:00:12.820

好的，我对你在做什么有点困惑，但我会尝试提出一些建议。

**与其使用link_to_function**，不如使用**link_to_remote**。链接到函数调用 javascript，但您真正想要做的是回调控制器，然后运行一些 rjs 以替换完整部分，或者更有可能将新的部分（包含步骤）附加到当前的末尾脚步。

这类似于您将看到的所有示例，人们将评论附加到他们的博客评论的末尾（期望使用 link_to_remote 而不是 remote_form_for）请参阅[http://media.rubyonrails.org/video的 3/4 /rails_blog_2.mov](http://media.rubyonrails.org/video/rails_blog_2.mov)

您可以在此处查看 link_to_remote 的文档：http: [//api.rubyonrails.org/classes/ActionView/Helpers/PrototypeHelper.html](http://api.rubyonrails.org/classes/ActionView/Helpers/PrototypeHelper.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-16T04:14:01.550

我建议`link_to_remote`按照 RichH 的建议使用。对你来说，诀窍似乎是跟踪`@i`. 我要么把它作为 URL 参数放在 中`link_to_remote`，要么放在会话对象中。我会建议会议——它似乎更容易。

# c# - 托管代码应该返回错误还是向非托管代码抛出异常？

> ID：833496
> 
> 赞同：5
> 
> 时间：2009-05-07T08:36:42.393
> 
> 标签：c#, c++, exception, com

我即将向使用 COM 的旧版 C++ 应用程序公开一个用 C# 编写的服务。向非托管客户端报告错误的最佳方法是什么？抛出异常还是仅仅返回一个错误值？

谢谢，斯特凡诺

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-08T08:12:29.060

你应该抛出异常。异常由框架映射到 HRESULTS，而 HRESULT 是向 COM 客户端返回错误的标准方式，所以这是要走的路。

每个异常类型都有一个 HResult 属性。当从 COM 客户端调用的托管代码引发异常时，运行时会将 HResult 传递给 COM 客户端。如果您需要特定于应用程序的 HRESULT 代码，您可以创建自己的自定义异常类型并设置[Exception.HResult](http://msdn.microsoft.com/en-us/library/system.exception.hresult.aspx)属性。

需要注意的一点是，当向 COM 客户端抛出异常时，调用堆栈信息将丢失。因此，在传播到 COM 客户端之前记录异常可能是个好主意。

我有时使用的一种技术如下：为记录和重新抛出异常的 COM 客户端显式实现 ComVisible 接口。COM 客户端使用 ComVisible 接口在传播异常之前记录它们。.NET 客户端使用具体类，并希望自己安排异常处理。写起来有点冗长，但在您随后进行故障排除时会很有帮助。

这种方法的另一个优点是，您可以针对 COM 客户端的 COM 限制定制 API，并为标准 .NET 客户端提供更标准的 API。例如，COM 客户端仅限于通过引用传递数组，而 .NET 客户端不鼓励通过引用传递。

例子：

```
[
ComVisible(true),
GuidAttribute("..."),
Description("...")
]
public interface IMyComVisibleClass
{
    // Text from the Description attribute will be exported to the COM type library.

    [Description("...")]
    MyResult MyMethod(...);

    [Description("...")]
    MyOtherResult MyArrayMethod([In] ref int[] ids,...);
}
...
[
ComVisible(true),
GuidAttribute("..."),
ProgId("..."),
ClassInterface(ClassInterfaceType.None),
Description("...")
]
public class MyComVisibleClass : IMyComVisibleClass
{
    public MyResult MyMethod(...)
    {
        ... implementation without exception handling ...
    }

    public MyOtherResult MyArrayMethod(int[] ids,...)
    {
        ... input parameter does not use ref keyword for .NET clients ...
        ... implementation without exception handling ...
    }

    MyResult IMyComVisibleClass.MyMethod(...)
    {
        // intended for COM clients only
        try
        {
            return this.MyMethod(...);
        }
        catch(Exception ex)
        {
            ... log exception ...
            throw;   // Optionally wrap in a custom exception type
        }
    }

    MyOtherResult IMyComVisibleClass.MyArrayMethod(ref int[] ids, ...)
    {
        // intended for COM clients only
        try
        {
            // Array is passed without ref keyword
            return this.MyArrayMethod(ids, ...);
        }
        catch(Exception ex)
        {
            ... log exception ...
            throw;   // Optionally wrap in a custom exception type
        }
    }

} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T08:51:14.340

如果您的 COM 应用程序在调用 C# 服务时支持 IErrorInfo 接口，并且它是一个完全内部的项目，那么抛出异常可能是最好的选择，因为它可以捕获最多的信息。然而，COM 传统上依赖 HR 结果来传达状态结果，如果将服务发布到其他来源可能会更好。

**编辑：**我更喜欢乔的回答。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T09:47:44.890

我同意其他人的观点，即在不了解您的项目的情况下，这不是“是或否”的答案。

这将取决于许多因素，例如：

*   安全性（即您的客户应该了解您的异常情况）
*   效率（即处理时间很关键）
*   可维护性（即你能改变遗留的 C++ 代码来解析你的异常条件）

[这是一篇很好的博客文章，讨论了有关异常处理的一些细微之处。](http://srtsolutions.com/blogs/effectivecsharp/archive/2005/06/08/exceptional-conditions-about-exceptions.aspx)

作者推荐以下两种方法之一：

任何一个：

*   返回错误文档。

或者：

*   在服务器上记录有关异常的所有信息。
*   创建一个引用记录信息的新异常。
*   将新异常发送给客户端以进行客户端处理和报告。

就个人而言，我认为您应该避免将 C# 服务与 C++ 应用程序紧密耦合。换句话说，编写您的 C# 服务，以便理论上任何消费者都可以使用它。同样，应编写 C++ 代码，使其不依赖于 C# 服务的内部工作，因此对异常（或错误代码）的更改或添加不会破坏使用者。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T08:50:43.390

我认为这取决于遗留应用程序将如何反应。如果它理解错误返回值，那么就采用这种方法。如果没有，那么您将不得不抛出异常并希望它适当地处理它们。

此外，如果它是错误的引用（例如空引用）或其他严重错误，我总是会抛出异常。然而，对于消费者无法事先检查的事情，应该避免异常（例如，空的搜索不应该抛出异常）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T09:03:32.330

最好的判断是你是使用异常还是返回值是你。“抛出异常”在几个方面胜过“返回值”。但在某些情况下，返回值就足够了。

# windows - 防止繁重的进程沉入交换文件

> ID：833497
> 
> 赞同：6
> 
> 时间：2009-05-07T08:36:52.190
> 
> 标签：windows, performance, virtual-memory, pagefile

我们的服务往往在晚上在我们客户的服务器上睡着，然后很难醒来。似乎发生的情况是，有时数百 MB 的进程堆被移动到交换文件中。这发生在晚上，当我们的服务未被使用，而其他服务被安排运行（数据库备份、反病毒扫描等）时。发生这种情况时，在几个小时不活动后，对服务的第一次调用最多需要几分钟（后续调用需要几秒钟）。

我很确定这是虚拟内存管理的问题，我真的很讨厌强迫操作系统将我们的服务保留在物理内存中的想法。我知道这样做会损害服务器上的其他进程，并降低整体服务器吞吐量。话虽如此，我们的客户只是希望我们的应用程序能够响应。他们不在乎夜间工作是否需要更长的时间。

我隐约记得有一种方法可以强制 Windows 将页面保留在物理内存上，但我真的很讨厌这个想法。我更倾向于一些内部或外部的看门狗，它们将启动更高级别的功能（已经有一些内部调度程序做的很少，并且没有区别）。如果有提供这种服务的第 3 方工具会同样好。

我很想听听针对此类问题的任何意见、建议和常见解决方案。该服务是用VC2005编写的，运行在Windows服务器上。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-07T08:55:04.800

正如您所提到的，强制应用程序留在内存中并不是在机器上共享资源的最佳方式。您可能会发现效果很好的一个快速解决方案是简单地安排一个事件，在您的客户开始使用它之前，每天早上在特定时间唤醒您的服务。您可以使用简单的脚本或 EXE 调用在 Windows 任务计划程序中安排它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-16T17:44:01.670

我并不是说你想这样做，或者说这是最佳实践，但你可能会发现它对你来说已经足够好了。它似乎符合您的要求。

摘要：定期触摸流程中的每一页，一次一页。

一个在后台运行并每 N 秒唤醒一次的线程呢？每次页面唤醒时，它都会尝试从地址 X 读取。该尝试受到异常处理程序的保护，以防您读取错误的地址。然后将 X 增加一页的大小。

4GB有65536页，3GB有49152页，2GB有32768页。将您的空闲时间（通宵死时间）除以您希望（尝试）访问每个页面的频率。

```
BYTE *ptr;

ptr = NULL;
while(TRUE)
{
    __try
    {
        BYTE b;

        b = *ptr;
    }
    __except(EXCEPTION_EXECUTE_HANDLER)
    {
        // ignore, some pages won't be accessible
    }

    ptr += sizeofVMPage;

    Sleep(N * 1000);
} 
```

您可以从 GetSystemInfo() 返回的结果中的 dwPageSize 值中获取 sizeOfVMPage 值。

不要试图通过使用 if (!IsBadReadPtr(ptr)) 来避免异常处理程序，因为应用程序中的其他线程可能正在同时修改内存保护。如果您因此而陷入困境，几乎不可能确定原因（这很可能是不可重复的竞争条件），所以不要浪费时间。

当然，您可能希望在白天关闭此线程并仅在您的空闲时间运行它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T09:02:29.807

第三种方法可能是让您的服务运行一个线程，该线程执行一些微不足道的操作，例如增加一个计数器，然后休眠相当长的一段时间，比如 10 秒。Thios 对其他应用程序的影响应该很小，但至少可以保持您的一些页面可用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-16T18:15:13.440

要确保的另一件事是您的数据已本地化。

换句话说：你真的需要全部 300 MiB 的内存才能做任何事情吗？是否可以重新排列您使用的数据结构，以便任何特定的请求都可以只用几兆字节来满足？

例如

*   如果您的 300 MiB 堆内存包含面部识别数据。数据内部是否可以进行排列，使男性和女性的人脸数据存储在一起？或者大鼻子与小鼻子是分开的？

*   如果它有某种逻辑结构，它可以排序吗？以便可以使用二进制搜索跳过很多页面？

*   如果它是专有的、内存中的数据库引擎，是否可以更好地对数据进行索引/集群以不需要这么多的内存页面命中？

*   如果它们是图像纹理，常用纹理可以彼此靠近吗？

您真的需要全部 300 MiB 的内存才能做任何事情吗？*如果没有所有*数据都回到内存中，您就无法服务请求？

**否则：**计划任务在 6 ᴀᴍ 唤醒它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T08:59:18.033

在成本方面，最便宜和最简单的解决方案可能只是为该服务器购买更多 RAM，然后您可以完全禁用页面文件。如果您运行的是 32 位 Windows，只需购买 4GB 的 RAM。然后整个地址空间将由物理内存支持，页面文件无论如何都不会做任何事情。

# ruby - 从具有日期和时间的数据库中检索记录

> ID：833503
> 
> 赞同：0
> 
> 时间：2009-05-07T08:40:31.543
> 
> 标签：ruby

当 start_day 和 end_day 相等时，我在尝试从数据库中检索记录时遇到问题，如果我想查看可能的记录：“从”2009 年 5 月 6 日到 2009 年 5 月 6 日。它没有给我记录如果类型“从”2009 年 5 月 6 日到 2009 年 5 月 7 日，数据库中是否只有记录。我的代码是。

> def generate_emails

```
@start = "#{params[:start][:day]}-#{params[:start][:month]}-#{params[:start][:year]}"
@start_date = Date.parse(@start) rescue
if !@start_date
  render :update do |page|
    page.hide "flash-error"
    page.visual_effect :highlight, "flash-error", :duration => 3
    page.replace_html "flash-error", "Invalid date, You selected #{params[:start][:day]} days for the #{params[:start][:month]} month"
    page.show "flash-error"
   end
  return
end

@end = "#{params[:end][:day]}-#{params[:end][:month]}-#{params[:end][:year]}"
@end_date = Date.parse(@end) rescue
  if !@end_date
  render :update do |page|
      page.hide "flash-error"
      page.visual_effect :highlight, "flash-error"
      page.replace_html "flash-error", "Invalid date, You selected #{params[:end][:day]} days for the #{params[:end][:month]} month"
      page.show "flash-error"
      end
  return
 end
@sent_message = SentMessage.find(:all, :conditions => ["message_type='Email' AND estate_id=? AND sent_date >= '#{@start_date}' AND sent_date <= '#{@end_date}' OR sent_date ='#{@start_date}' AND sent_date = '#{@end_date}' ", @estate_id], :order => "sent_date DESC") 
```

结尾

**编辑**

至少我得到了答案。。

> def generate_emails

```
@start = "#{params[:start][:day]}-#{params[:start][:month]}-#{params[:start][:year]}"
@start_date = Date.parse(@start)rescue
if !@start_date
  render :update do |page|
    page.hide "flash-error"
    page.visual_effect :highlight, "flash-error", :duration => 3
    page.replace_html "flash-error", "Invalid date, You selected #{params[:start][:day]} days for the #{params[:start][:month]} month"
    page.show "flash-error"
   end
  return
end

@end = "#{params[:end][:day]}-#{params[:end][:month]}-#{params[:end][:year]}"
@end_date = Date.parse(@end) rescue
  if !@end_date
  render :update do |page|
      page.hide "flash-error"
      page.visual_effect :highlight, "flash-error"
      page.replace_html "flash-error", "Invalid date, You selected #{params[:end][:day]} days for the #{params[:end][:month]} month"
      page.show "flash-error"
      end
  return
 end

 if @start_date == @end_date
   @start_date = DateTime.parse(@start)-1
   @end_date = DateTime.parse(@end)
   @sent_message = SentMessage.find(:all, :conditions => ["message_type='Email' AND estate_id=? AND sent_date >= '#{@start_date}' AND sent_date = '#{@end_date}' ", @estate_id], :order => "sent_date DESC")
 end

@sent_message = SentMessage.find(:all, :conditions => ["message_type='Email' AND estate_id=? AND sent_date >= '#{@start_date}' AND sent_date <= '#{@end_date}' OR sent_date ='#{@start_date}' AND sent_date = '#{@end_date}' ", @estate_id], :order => "sent_date DESC") 
```

结尾

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-07T09:14:47.467

我建议您检查是否`Date.parse`无法解析`@start`-`@end`很有可能您从 中获取的值`params`无法被运行 ruby​​ 代码的应用程序的语言环境正确解析。

# apache - 如何停止在 Railo 应用程序的 HTTP 标头中设置字符集？

> ID：833504
> 
> 赞同：0
> 
> 时间：2009-05-07T08:40:56.613
> 
> 标签：apache, coldfusion, railo

[我正在将 Railo 3.0 用于 Web 应用程序（设置与此](https://web.archive.org/web/20120419124906/http://blog.getrailo.com:80/index.cfm/2008/11/12/Installing-ResinRailo-on-CentOS)优秀指南完全相同）。我有一个 CFM 页面，它使用 cfcontent 标记提供一些旧的 HTML 文件。此内容采用各种字符集（均定义为 HTML 中的元标记）。问题是我所有的 CFM 页面都在 HTTP 响应标头中设置了 UTF-8 发送出去，这会覆盖 HTML 中定义的任何内容。因此，这些页面在浏览器中显示不正确。

**如何停止在 CFM 页面的 HTTP 标头中发送字符集？**

注意：我已经从默认的 Apache 配置中删除了 AddDefaultCharset 条目，这意味着现在提供的静态 HTML 页面在标题中没有任何字符集，但是这对 CFM 页面没有帮助 - [AddDefaultCharset 是坏的，坏的，坏的](https://web.archive.org/web/20130711031839/http://ungwe.org/blog/2004/01/26/22:52/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-06-08T04:45:55.130

我知道这是一个旧线程，但我最近遇到了类似的问题，并使用底层的 java servlet 上下文克服了它。如果你掌握了 ServletResponse，你可以调用 .reset()，根据 Java 文档，它说：

> 清除缓冲区中存在的任何数据以及状态代码和**标头**。

您需要从头开始重写所有标头，但它会清除流氓字符集标头。

```
<cfset objResponse = GetPageContext().getResponse()>
<cfset objResponse.reset()> 
```

这适用于Railo。在 CF (Adobe) 中，我认为您需要调用 getResponse() 两次以获取适当的响应对象。

希望对某人有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T12:39:08.177

您试图将页面发送为什么字符集？您可以通过以下几种方式强制页面的字符集：

```
<cfprocessingdirective pageEncoding="windows-1252"> 
```

[http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_p-q_13.html#2962107](http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_p-q_13.html#2962107)

```
<cfheader name="charset" value="windows-1252"> 
```

[http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_g-h_07.html#3989067](http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_g-h_07.html#3989067)

# .net - Business Objects Collection 中具有 lambda 标准的通用方法

> ID：833509
> 
> 赞同：1
> 
> 时间：2009-05-07T08:42:35.047
> 
> 标签：.net, .net-3.5, lambda, business-objects

我的应用程序中的每个业务对象都有抽象类（**BO**）还有父（通用）集合来存储所有 BO（名为**BOC** - 业务对象集合）

我想存档的是在 BOC 内部创建的通用方法，类似于：

```
public  T GetBusinessObject (lambda_criteria) 
```

所以我可以称这个方法类似于：

```
Employee emp = BOC.GetBusinessObject( Employee.ID=123 ) 
```

并且方法应返回满足指定 lambda 标准的 BO

任何提示如何存档？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T08:48:02.633

假设您的 BOC 在内部继承或使用通用列表，这并不难：

```
T GetBusinesObject<T>( Func<T, bool> predicate )
{
    return this.FirstOrDefault( predicate );
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T08:50:05.233

就像是

```
T GetBusinessObject<T>(Predicate<T> constraint) where T : BO 
```

然后像

```
GetBusinessObject<Employee>( e => e.ID = 123 ) 
```

也许？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T08:51:47.990

如果这是一个通用集合，那么调用者应该**已经**（通过 LINQ）能够使用：

```
BOC<Employee> boc = ...
// checks exactly 1 match, throws if no match
var emp = boc.Single(e => e.ID = 123);
// checks at most 1 match, null if no match
var emp = boc.SingleOrDefault(e => e.ID = 123);
// checks at least one match, throws if no match
var emp = boc.First(e => e.ID = 123);
// returns first match, null if no match
var emp = boc.FirstOrDefault(e => e.ID = 123); 
```

那怎么办？

# php - PHP PDO::bindParam() 数据类型.. 它是如何工作的？

> ID：833510
> 
> 赞同：31
> 
> 时间：2009-05-07T08:42:57.637
> 
> 标签：php, types, pdo, prepared-statement

我想知道[`bindParam()`](http://php.net/manual/en/pdostatement.bindparam.php)（或[`bindValue()`](http://php.net/manual/en/pdostatement.bindvalue.php)）中的数据类型声明用于...

我的意思是，我认为如果我定义一个整数参数 ( `PDO::PARAM_INT`)，则该参数必须转换为整数，例如

```
$delete->bindParam(1, $kill, PDO::PARAM_INT);
// should work like
$delete->bindParam(1, (int)$kill); 
```

或者如果参数不是声明的类型，至少会抛出一个错误。但这种情况并非如此。

谷歌搜索，我在 php.net 存档中发现：

> 大家好，
> 
> 我目前正在研究 PDO。正好在 bindParam() 函数上。第三个参数 data_type 似乎是在这里强制值的类型？但是当我尝试时：
> 
> ```
> $sql = "INSERT INTO produit (idproduit, nom, marque) VALUES (NULL, :nom, :marque)";
> $stmt = $dbh->prepare($sql);
> $nom = 'Testarossa'; $marque = 'Ferrari' ;
> $stmt->BindValue(':marque',$marque) ;
> $stmt->BindParam(':nom',$nom,PDO::PARAM_INT) ;
> 
> $stmt->execute(); $nom = '250 GTO' ;
> $stmt->execute(); ?> 
> ```
> 
> 我期待在我的数据库中出现 PHP 错误或整数。但在我的数据库中，我有：
> 
> 22 Testarossa 法拉利 23 250 GTO 法拉利
> 
> 这意味着如果我有第三个参数它没有改变。或者也许我错过了什么。有人可以告诉我更多吗？或者有人可以告诉我在哪里可以找到有关它的信息。
> 
> 问候，
> 
> 赛勒斯

这正是我的情况。我的想法哪里错了？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-05-14T21:43:19.390

在其他语言的其他数据库抽象框架中，它可用于确保您对内联值进行正确转义（对于不支持正确绑定参数的驱动程序）以及通过确保数字来提高网络效率适当打包的二进制文件（给定协议支持）。它看起来像在 PDO 中，它并没有做太多。

```
 if (PDO_PARAM_TYPE(param->param_type) == PDO_PARAM_STR && param->max_value_len <= 0 && ! ZVAL_IS_NULL(param->parameter)) {
                if (Z_TYPE_P(param->parameter) == IS_DOUBLE) {
                        char *p;
                        int len = spprintf(&p, 0, "%F", Z_DVAL_P(param->parameter));
                        ZVAL_STRINGL(param->parameter, p, len, 0);
                } else {
                        convert_to_string(param->parameter);
                }
        } else if (PDO_PARAM_TYPE(param->param_type) == PDO_PARAM_INT && Z_TYPE_P(param->parameter) == IS_BOOL) {
                convert_to_long(param->parameter);
        } else if (PDO_PARAM_TYPE(param->param_type) == PDO_PARAM_BOOL && Z_TYPE_P(param->parameter) == IS_LONG) {
                convert_to_boolean(param->parameter);
        } 
```

所以，如果你说它是一个 STR （或者你什么都不说，因为这是默认值）并且你的数据的内部类型是双精度，那么它将使用一种方法将其转换为字符串，如果它不是双精度则它将使用不同的方法将其转换为字符串。

如果你说它是一个 int 但它实际上是一个 bool，那么它会将它转换为 long。

如果你说它是一个布尔值，但它实际上是一个数字，那么它将把它转换为一个真正的布尔值。

这就是我（快速）看到的所有内容，我想一旦你将参数传递给驱动程序，它们就可以发挥额外的魔力。所以，我猜你得到的只是一点点做正确的事，以及司机之间的大量行为模棱两可和差异。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-05-14T21:52:28.260

所以我决定深入研究 PHP 源代码，这就是我发现的。

`static int really_register_bound_param`在 5.2.9 版的第 329 行的 ext/pdo/pdo_stmt.c 中

```
if (PDO_PARAM_TYPE(param->param_type) == PDO_PARAM_STR && param->max_value_len <= 0 && ! ZVAL_IS_NULL(param->parameter)) {
    if (Z_TYPE_P(param->parameter) == IS_DOUBLE) {
        char *p;
        int len = spprintf(&p, 0, "%F", Z_DVAL_P(param->parameter));
        ZVAL_STRINGL(param->parameter, p, len, 0);
    } else {
        convert_to_string(param->parameter);
    }
} else if (PDO_PARAM_TYPE(param->param_type) == PDO_PARAM_INT && Z_TYPE_P(param->parameter) == IS_BOOL) {
    convert_to_long(param->parameter);
} else if (PDO_PARAM_TYPE(param->param_type) == PDO_PARAM_BOOL && Z_TYPE_P(param->parameter) == IS_LONG) {
    convert_to_boolean(param->parameter);
} 
```

这些是 PDO 在绑定期间所做的转换。

*   PDO::PARAM_STR 将您提供的任何内容转换为除 null 之外的字符串。
*   PDO::PARAM_INT 将 bool 转换为 long
*   PDO::PARAM_BOOL 将 long 转换为 bool

就是这样。没有其他任何东西被转换。PDO 使用 PARAM 标志来格式化 SQL，而不是强制转换数据类型。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-07T10:49:17.163

**PDO::PARAM_INT 对INSERT**查询至少有一种影响：布尔值被转换为 0 或 1。就像在

```
$i = true;
$stmt->bindParam(':i', $v, PDO::PARAM_INT);
```

pdo_stmt.c：

```
否则如果 (PDO_PARAM_TYPE(param->param_type) == PDO_PARAM_INT && Z_TYPE_P(param->parameter) == IS_BOOL) {
        转换为长（参数->参数）；
}
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-14T20:38:57.877

我用 BindValue 尝试了同样的事情并得到了相同的结果，因此您看到的行为不仅限于 bindParam。

```
$stmt->BindValue(':marque', $marque) ;
$stmt->BindValue(':nom', $nom, PDO::PARAM_INT) ;

$stmt->execute();
$nom = '250 GTO';
$stmt->BindValue(':nom', $nom, PDO::PARAM_INT) ;
$stmt->execute(); 
```

# wcf - 使用 app.config 时关于 WCF 的一个问题

> ID：833515
> 
> 赞同：0
> 
> 时间：2009-05-07T08:43:55.090
> 
> 标签：wcf, app-config

我是WCF的初学者，我写了一个简单的例子，我的应用程序的app.config文件如下：

主持人：

```
<services>

  <service name="WCFService.Service.CalculatorService" behaviorConfiguration="calculatorBehavior">

    <host>
      <baseAddresses>
        <add baseAddress="http://10.1.9.210:8080/GeneralCalculator"/>
      </baseAddresses>
    </host>

    <endpoint address="" binding ="basicHttpBinding" contract="WCFService.Contract.ICalculator"></endpoint>

  </service>

</services>

<behaviors>

  <serviceBehaviors>
    <behavior name="calculatorBehavior">
      <serviceMetadata httpGetEnabled="true" httpGetUrl=""/>
    </behavior>
  </serviceBehaviors>      
</behaviors> 
```

* * *

客户：

```
<client>

  <endpoint address="http://10.1.9.210:8080/GeneralCalculator/CalculatorService" binding ="basicHttpBinding" contract="WCFService.Contract.ICalculator" />

</client> 
```

当我运行我的应用程序时，出现异常：“由于 EndpointDispatcher 的 AddressFilter 不匹配，接收方无法处理带有 To ' [http://10.1.9.210:8080/GeneralCalculator/CalculatorService](http://10.1.9.210:8080/GeneralCalculator/CalculatorService) '的消息。检查发送方和接收方的 EndpointAddresses 一致。”

我想我的配置文件有问题，请给我一些提示，

谢谢 ：）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T08:48:30.917

试试这个：

```
<services>

  <service name="WCFService.Service.CalculatorService" behaviorConfiguration="calculatorBehavior">

    <host>
      <baseAddresses>
        <add baseAddress="http://10.1.9.210:8080/GeneralCalculator"/>
      </baseAddresses>
    </host>

    <endpoint address="CalculatorService" binding ="basicHttpBinding" contract="WCFService.Contract.ICalculator"></endpoint>

  </service>

</services>

<behaviors>

  <serviceBehaviors>
    <behavior name="calculatorBehavior">
      <serviceMetadata httpGetEnabled="true" httpGetUrl=""/>
    </behavior>
  </serviceBehaviors>

</behaviors> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T08:49:53.987

您的客户端尝试连接到：

```
http://10.1.9.210:8080/GeneralCalculator/CalculatorService 
```

当您的服务器在以下位置公开服务时：

```
http://10.1.9.210:8080/GeneralCalculator 
```

这两个需要配合！:-)

因此，您可以使用 Rodrigo 的答案并添加一个相`address="CalculatorService"`对于您的服务器端点的相对值，或者您可以更改客户端的端点以指向与服务器现在公开的相同 URL。

马克

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T08:46:15.117

看起来客户端正在尝试访问以“CalculatorService”结尾的 Uri，而该服务在 Uri 上没有此后缀？更改客户端上的地址以匹配服务的地址。

# c# - 在 Cassini 上托管 ADO.NET 数据服务

> ID：833516
> 
> 赞同：0
> 
> 时间：2009-05-07T08:44:02.220
> 
> 标签：c#, .net, wcf-data-services, cassini

我们需要在不使用 III 的情况下运行 ADO.NET 数据服务。我看到 cassini 是正确的选择，但是如何在 Cassini 中托管 ADO.NET 数据服务。我找不到任何示例。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T08:48:45.830

你有理由想要在卡西尼号中使用它吗？您可以在没有 IIS 的普通应用程序、服务等中自行托管 ADO.Net 数据服务。如果你有兴趣，我的[博客](http://www.grumpydev.com/2009/01/10/self-hosting-adonet-data-services-astoria/)上的一些细节。

# sql-server - 如何在 SQL Server 的多个表中选择同时输入/更新的所有记录？

> ID：833521
> 
> 赞同：0
> 
> 时间：2009-05-07T08:45:56.303
> 
> 标签：sql-server, database

有没有人可以帮助我选择在 SQL Server 数据库中同时在不同表上输入/更新的多条记录。你认为这是可能的还是不可能的？

非常感谢您的帮助，谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T08:48:03.817

您的表是否有日期时间类型的日期/时间戳列？

否则你可能运气不好......

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T08:55:26.017

嗯......它可以像这样简单吗？

```
SELECT   * 
FROM     MyTable 
WHERE    CreatedDate = 'the date you are interested in' 
```

或者

```
SELECT   * 
FROM     MyTable 
GROUP BY CreatedDate
HAVING   COUNT(*) > 1 
```

?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T09:02:38.480

如果您在插入触发器内部，则可以查询`inserted`伪表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T14:34:36.917

如果 DATETIME 列的名称都相同，则可以生成如下查询

```
select
    'select * from '
        + t.name 
        + ' where UpdateDate = ''2009-05-01''' as SelectStatement
from sys.tables as t 
```

或者，如果 DATETIME 列名不是静态的，您可以按照以下方式进行操作：

```
select
    'select * from ' + t.name 
        + ' where ' + c.name + ' = ''2009-05-01''' as SelectStatement
from sys.tables as t join sys.columns as c on t.object_id=c.object_id
where c.system_type_id = (select system_type_id from sys.types where name = 'datetime') 
```

# blackberry - 在 HTTP 请求正文中发送数据失败

> ID：833524
> 
> 赞同：1
> 
> 时间：2009-05-07T08:47:05.693
> 
> 标签：blackberry, java-me, http-headers

我在我的 BlackBerry 应用程序中使用 J2ME 的 HttpConnection 类将数据发送到 Web 服务器。我需要在 HTTP 请求的正文中发送图像的内容。

这就是我所做的

1.  获取数组中文件的字节数

2.  打开 HTTP 连接

3.  将内容类型标头设置为 image/jpeg

4.  获取连接的输出流

5.  将字节写入输出流

6.  关闭输出流和连接

但是图像没有上传到服务器。可能是什么问题呢？

谢谢。

**编辑 - 添加代码**

```
HttpConnection conn = null;
OutputStream out = null;

try{
    conn = new HttpConnection(Connector.open(myURL));
    conn.setRequestProperty("Content-Type", "image/jpeg");
    conn.setRequestMethod(HttpConnection.POST);
    conn.setRequestProperty("Content-Disposition", "form-data");
    conn.setRequestProperty("Connection", "Keep-Alive");

    out = conn.openOutputStream;
    out.write(buffer, 0, buffer.length);
    conn.setRequestProperty("Content-Length", buffer.length);
    out.flush();
}
catch(Exception e){
    e.printStackTrace();
}
finally{
    if(out != null)
        out.close();

    if(conn != null){
        System.out.println("" + conn.getResponseCode());
        conn.close();
    }
} 
```

**编辑**

相同的代码，当我尝试使用字符串时，可以正常工作并将字符串发送到服务器。但这仍然是图像字节的问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T10:31:44.927

您的列表中可能缺少的一些内容：

*   在 2 和 3 之间使用 HttpConnection.setRequestMethod(HttpConnection.POST)。
*   使用 HttpConnection.setRequestProperty("Content-Length",...) 在 5 和 6 之间设置内容长度。
*   了解 HTTP 请求响应代码有助于调试您的问题：在关闭 OutputStream 之后但在关闭 HttpConnection 之前调用 HttpConnection.getResponseCode()。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-16T12:27:00.370

> conn = new HttpConnection(Connector.open(myURL));

这条线是错误的。Connection 是一个工厂类，它通过查看适当的协议实现来创建新的 Connection 对象。

```
HttpConnection conn = (HttpConnection) Connector.open(myURL); 
```

其余的代码似乎没问题。当您发布时，您至少需要定义内容类型和内容长度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T22:55:36.590

您绝对需要在发送 POST 数据*之前*`Content-Length`设置所有标头，包括标头。

此外，请确保您发送对请求有效的标头，而不是仅响应标头。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T19:11:34.013

您需要对字节进行编码（最好是 Base-64）并发送该字符串。原始字节不太可能是 http 安全的。

然后在服务器上，您需要将它们解码回一个字节数组并执行您要使用它执行的任何操作（保存为文件、将内容存入数据库等）

# c - 为什么 short 在 C 中的结构中存储为 4 个字节？

> ID：833526
> 
> 赞同：2
> 
> 时间：2009-05-07T08:47:13.507
> 
> 标签：c, struct, sizeof

我有以下两个结构：

问题是 sizeof(Content) 返回 160。该结构由 11 个短裤、6 个整数、76 个字符、7 个浮点数、1 个双精度数组成，总共增加了 158 个字节。我数了三遍，还是有2个字节的差别。

```
typedef struct TIME_T { 
    short year,mon,day; 
    short hour,min,sec; 
} TIME;

typedef struct { 
    int no; 
    char name[20]; 
    char Code[10]; 
    char DASType[10]; 
    short wlen; 
    float VLtd; 
    int samp; 
    int comp; 
    int locationID; 
    short TranMode; 
    char TranIns[12]; 
    short TimerMode; 
    char ClkType[12]; 
    float ClkErr; 
    float lat; 
    float lon; 
    float alt; 
    float azimuth,incident; 
    short weight; 
    short veloc; 
    int oritype; 
    char seismometer[12]; 
    double sens; 
    TIME start_time; 
    int record_samples; 
} Content; 
```

我写了一小段代码来打印结构中每个变量的位置，突然我发现`float wlen`需要 4 个字节。我的代码如下：

```
int main(void)
{   
    Content content;
    printf("Sizeof Content: %d\n", sizeof(content));
    printf("Sizeof int content.no: %d\n", (int)&content.name - (int)&content.no);
    printf("Sizeof char[20] content.name: %d\n", (int)&content.Code - (int)&content.name);
    printf("Sizeof char[10] content.Code: %d\n", (int)&content.DASType - (int)&content.Code);
    printf("Sizeof char[10] content.DASType: %d\n", (int)&content.wlen - (int)&content.DASType);
    printf("Sizeof short content.wlen:  %d\n", (int)&content.VLtd - (int)&content.wlen);
    printf("Sizeof float content.VLtdL %d\n", (int)&content.samp - (int)&content.VLtd);
    printf("Sizeof int content.samp: %d\n", (int)&content.comp - (int)&content.samp);
    printf("Sizeof int content.comp: %d\n", (int)&content.locationID - (int)&content.comp);
    printf("Sizeof int content.locationID: %d\n", (int)&content.TranMode - (int)&content.locationID);
    printf("Sizeof short content.TranMode: %d\n", (int)&content.TranIns - (int)&content.TranMode);
    printf("Sizeof char[12] content.TranIns: %d\n", (int)&content.TimerMode - (int)&content.TranIns);
    printf("Sizeof short content.TimerMode: %d\n", (int)&content.ClkType - (int)&content.TimerMode);
    printf("Sizeof char[12] content.ClkType: %d\n", (int)&content.ClkErr - (int)&content.ClkType);
    printf("Sizeof float content.ClkErr: %d\n", (int)&content.lat - (int)&content.ClkErr);
    printf("Sizeof float content.lat: %d\n", (int)&content.lon - (int)&content.lat);
    printf("Sizeof floatcontent.lon: %d\n", (int)&content.alt - (int)&content.lon);
    printf("Sizeof floatcontent.alt: %d\n", (int)&content.azimuth - (int)&content.alt);
    printf("Sizeof floatcontent.azimuth: %d\n", (int)&content.incident - (int)&content.azimuth);
    printf("Sizeof floatcontent.incident: %d\n", (int)&content.weight - (int)&content.incident);
    printf("Sizeof short content.weight: %d\n", (int)&content.veloc - (int)&content.weight);
    printf("Sizeof short content.veloc: %d\n", (int)&content.oritype - (int)&content.veloc);
    printf("Sizeof int content.oritype: %d\n", (int)&content.seismometer - (int)&content.oritype);
    printf("Sizeof char[12] content.seismometer: %d\n", (int)&content.sens - (int)&content.seismometer);
    printf("Sizeof double content.sens: %d\n", (int)&content.start_time - (int)&content.sens);
    printf("Sizeof TIME content.start_time: %d\n", (int)&content.record_samples - (int)&content.start_time);
    printf("Sizeof int content.record_samples: %d\n", sizeof(content.record_samples));

    getchar();
    return 0;
} 
```

输出如下：

```
Sizeof int content.no: 4
Sizeof char[20] content.name: 20
Sizeof char[10] content.Code: 10
Sizeof char[10] content.DASType: 10
Sizeof short content.wlen:  4
**Sizeof float content.VLtdL 4**
Sizeof int content.samp: 4
Sizeof int content.comp: 4
Sizeof int content.locationID: 4
Sizeof short content.TranMode: 2
Sizeof char[12] content.TranIns: 12
Sizeof short content.TimerMode: 2
Sizeof char[12] content.ClkType: 12
Sizeof float content.ClkErr: 4
Sizeof float content.lat: 4
Sizeof floatcontent.lon: 4
Sizeof floatcontent.alt: 4
Sizeof floatcontent.azimuth: 4
Sizeof floatcontent.incident: 4
Sizeof short content.weight: 2
Sizeof short content.veloc: 2
Sizeof int content.oritype: 4
Sizeof char[12] content.seismometer: 12
Sizeof double content.sens: 8
Sizeof TIME content.start_time: 12
Sizeof int content.record_samples: 4 
```

编译器是 MSVC8，未定义 UNICODE，未定义其他宏。是x86。

我尝试在 gcc 版本 3.4.4 中编译相同的代码，输出是相同的。 `Sizeof short content.wlen: 4`

谁能给我解释一下？

提前致谢。

**编辑：**感谢您的回答！我现在得到了。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-07T08:50:47.900

仅简短回答：[对齐](http://en.wikipedia.org/wiki/Data_structure_alignment)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-07T08:51:23.297

您不能简单地通过添加其所有组件的大小来计算结构的大小 - 允许编译器在字段之间插入填充，并且经常这样做。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-07T08:53:21.887

对齐——在 32 位架构上，以 32 位块的形式传递内存要高效得多。您实际上根本不会通过在 16 位中存储一个 short 来节省任何内存，因为它仍然是关联的 32 位字的一部分。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-07T08:53:21.077

你不是在计算字段的大小，而是它们之间的“距离”，所以我猜你看到的是结构中的单词对齐。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-07T08:53:55.053

在结构中添加另一个短路会扩大尺寸，还是保持不变？我敢打赌它的大小保持不变。

两个编译器都在努力使您的结构保持 8 字节对齐（我想），因此某些字段将被“扩展”以占用额外的空间；对该字段的实际操作将表现得好像它是“适当的”大小。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-07T09:00:54.647

如果编译器发现这样访问会更方便，结构成员通常在 4 字节边界上对齐。char 也会发生类似的行为。

您可以尝试通过将 short 放在一起来优化结构的内存占用，以便两个连续的 short 使用单个 32 位字。不要忘记仔细检查编译器结果。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-07T09:06:04.493

根据 C 标准，内存中的每个本机类型都必须与其大小对齐，但与您的问题没有直接关系。您应该研究的是结构包装。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-07T09:31:29.003

正如 dfa 所说，这是由于对齐。可以帮助减小结构大小的一种“良好做法”是从最大的成员开始按其个人大小（实际上是他们各自的对齐方式，但大小通常足够好）对其成员进行排序。

这并不总是正确的，但大多数时候都是如此。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-07T09:08:47.030

看看pahole，Poke-a-Hole的缩写。它是用于在结构中查找孔的 DWARF2 工具之一，孔是由于对齐规则而导致的成员之间的空间，可用于新的结构条目或重新组织以减小大小。

在程序作者 Arnaldo Carvalho de Melo 的[这篇 LWN 文章](http://lwn.net/Articles/206805/)中了解更多信息。

在网上找不到很多教程，但是[CERN](https://twiki.cern.ch/twiki/bin/view/Atlas/UsingPahole)的这个 wiki 页面有点帮助。

# java - 如何创建 servlet 以在某个 div 中返回数据库查询

> ID：833527
> 
> 赞同：0
> 
> 时间：2009-05-07T08:47:56.767
> 
> 标签：java, jquery, ajax, servlets

我需要创建一个非常简单的应用程序：

1.  我需要一个将数据提交给 servlet 的表单
2.  然后，servlet 查询数据库以根据表单给出的标准检索报告列表
3.  返回的文档列表必须显示在 .jsp 页面上的 div 中

我不确定最后一个（3号）。我知道如何使用 jQuery 调用 doPost 或其他方法（但不是由按钮触发时），只使用计时器，但我确信它是类似的东西。但我想让它尽可能简单，并尽可能避免使用 jQuery。

如果我调用 servlet 并在不使用 jQuery 的情况下返回数据，我如何指定我希望它返回的位置（即哪个 div）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T08:53:21.637

显示 Ajax 请求内容的位置取决于客户端 Javascript。servlet 只会创建数据（可以是 HTML，也可以是 JSON 或 XML，具体取决于您在客户端上的需要）。

如果您不想使用 jQuery（或prototype.js，或类似的东西），您必须自己编写用于触发 Ajax 请求和解析结果（包括如何显示）的逻辑。

我会说，坚持使用 jQuery。这将使其“尽可能简单”。如果您不确定单击按钮时如何启动新请求，请查看[本教程](http://nettuts.com/tutorials/javascript-ajax/submit-a-form-without-page-refresh-using-jquery/)。

# django - 使 Django 返回响应为“不同的文件名”

> ID：833536
> 
> 赞同：17
> 
> 时间：2009-05-07T08:49:10.883
> 
> 标签：django, http, filenames, httpresponse

我有一个 Django 视图，它返回`HttpResponse`一个特殊的 MIME 类型，以使用户的浏览器“下载”文件，而不是在浏览器中查看它。问题是响应将保存为的默认文件名是用户尝试访问的 URL。

有什么方法可以在`HttpResponse`对象中包含默认文件名，还是我必须重定向到不同的 URL 才能做到这一点？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-05-07T08:59:30.890

[文档](http://docs.djangoproject.com/en/dev/howto/outputting-pdf/)中有一个相关示例：

```
from django.http import HttpResponse

def some_view(request):
    # Create the HttpResponse object with the appropriate headers.
    response = HttpResponse(content_type='application/pdf')
    response['Content-Disposition'] = 'attachment; filename="somefilename.pdf"'
    return response 
```

# c# - 为什么这个 OdbcConnection 会抛出 System.InvalidOperationException？

> ID：833537
> 
> 赞同：0
> 
> 时间：2009-05-07T08:49:18.743
> 
> 标签：c#, .net, sql-server, ado.net

我正在构建一个 Winforms C# 2.0 应用程序。

我已经成功地能够使用以下命令连接到我的 SLQ 服务器数据库： m_connexion = new SqlConnection("server=192.168.xxx.xxx;uid=...;pwd=...;database=...");

因为我的公司希望能够使用任何数据库，所以我继续使用 Odbc 驱动程序，我的命令如下所示：

m_connexion = new OdbcConnection("server=192.168.xxx.xxx;uid=...;pwd=...;database=...");

但是，这会抛出 System.InvalidOperationException。知道为什么吗？

我也在尝试使用 DSN，但推荐 OdbcConnection connection = new OdbcConnection("DSN=MyDataSourceName"); [在这里](https://stackoverflow.com/questions/754302/how-to-get-odbc-connection-by-name)建议，但它同样会抛出我的 System.InvalidOperationException

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T08:52:31.530

连接字符串需要一个 Provider= 以便 ODBC 驱动程序知道您要连接到哪个服务器。在这种情况下 Provider=SQLSERVER 我相信。

**更新：**应该是 Provider=SQLOLEDB

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T08:53:31.870

我认为您需要指定驱动程序。在这里查看详细信息：[http ://connectionstrings.com/sql-server-2005#21](http://connectionstrings.com/sql-server-2005#21)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T10:30:33.137

如果指定 DSN，则必须使用 ODBC 控制面板配置 DSN。它在管理工具下称为“设置数据源 (ODBC)”。该面板还有一个“测试”按钮，它可能会告诉您更多关于出了什么问题。

PS 与使用 ODBC 连接、命令和数据读取器相比，“独立于数据库”的工作要多得多。您必须确保您的查询在每个目标数据库上运行，如果您没有每个目标数据库的测试服务器，您将无法做到这一点。因此，如果我是你，我会使用 SqlConnection 对其进行编码，因为你已经开始工作了。

# performance - Subsonic Performance，能处理多达100万首歌曲信息吗？

> ID：833557
> 
> 赞同：2
> 
> 时间：2009-05-07T08:52:31.967
> 
> 标签：performance, subsonic

我确实注意到 Subsonics 页面上的声明，它可以处理 100000+ 个文件，但我们需要处理多达 100 万首歌曲的信息。我们是否知道 100000 的限制来自于什么——它是基于数据库速度、硬盘容量，还是仅仅是它所测试的全部？

你能分享一些关于这个的经过验证的例子吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T14:54:03.627

您看到的语句是指文件还是表？我确实记得有句话说 sonic 可以处理 1,000 个表，但您将等待一段时间。这指的是构建类的过程，与记录的处理无关。根据我的经验，一般来说，100 万行是一个相对较小的数据库。但它不是大小，而是你使用它的方式，当涉及到数据库时，如果你以错误的方式使用它，你可以让一个快速服务器上的小型数据库屈服。我会毫不犹豫地使用 Subsonic 访问包含一百万行的表，但作为一个经过验证的示例，我不确定您要的是什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T16:40:10.127

已经有许多问题讨论了 SubSonic 性能，您可能应该仔细阅读这些问题：

[将 Subsonic 用于可能被大量访问的 ASPNET MVC 应用程序](https://stackoverflow.com/questions/149557/using-subsonic-for-potentially-heavily-accessed-aspnet-mvc-application)

[https://stackoverflow.com/questions/146087/best-performing-orm-for-net](https://stackoverflow.com/questions/146087/best-performing-orm-for-net)

[https://stackoverflow.com/questions/380620/what-object-mapper-solution-would-you-recommend-for-net-closed](https://stackoverflow.com/questions/380620/what-object-mapper-solution-would-you-recommend-for-net-closed)

Rob Connery 还写了一篇关于 SubSonic 性能的博文，值得您阅读：

[http://blog.wekeroad.com/blog/subsonic-scaling/](http://blog.wekeroad.com/blog/subsonic-scaling/)

就我的经验而言，SubSonic 处理具有一百万行的表格毫无问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T15:45:16.060

这个问题可以追溯到 SubSonic 是什么以及 SubSonic 是如何工作的。SubSonic 不仅仅是一个 ORM（对象关系映射器）。SubSonic 是一个 ORM，具有出色的查询构建器和一些有用的 Web 控件，可让您立即启动并开始工作。如果你在一个表中有 100 万条记录，你永远不会想要做

```
Select * From GinormousSongsTable 
```

. 您的数据库需要永远返回那么多行。更现实地，你会想做这样的事情

```
Select Top 50 * FROM GinormousSongsTable WHERE catagory = 'Rock' 
```

这是 SubSonic 将为您节省大量时间的地方。SubSonic 可以创建查询来处理分页或顶级功能或您正在寻找的任何其他内容。如果您愿意，您可以将 50 条记录作为 GinormousSongsTableCollection 返回，这样现在您就拥有强类型对象的优势，或者如果您需要 DataReader 的原始速度，那么您可以将 Query 作为 DataReader 返回，并具有与您遇到了所有的麻烦并创建了自己的连接、命令、参数等。SubSonic 可以很好地扩展并让您做您需要做的事情。

# pixelsense - Microsoft PixelSense 的示例应用程序？

> ID：833577
> 
> 赞同：0
> 
> 时间：2009-05-07T08:58:18.193
> 
> 标签：pixelsense

你们在网络上遇到过 Microsoft PixelSense 的任何示例应用程序（我需要应用程序的源代码）吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T17:24:33.933

谷歌搜索后的伙计们，我收集了一些有用的链接来开始在表面环境上编码。

[http://channel9.msdn.com/pdc2008/PC17/#Page](http://channel9.msdn.com/pdc2008/PC17/#Page) [http://ctlabs.blogspot.com/search/label/Surface](http://ctlabs.blogspot.com/search/label/Surface) [http://robertbunn.wordpress.com/2009/04/18/converting-wpf -apps-to-surface-apps-part-1/](http://robertbunn.wordpress.com/2009/04/18/converting-wpf-apps-to-surface-apps-part-1/) [http://www.aboutmicrosoftsurface.com/features-of-microsoft-surface.php](http://www.aboutmicrosoftsurface.com/features-of-microsoft-surface.php)

如果你们遇到任何有用的表面帖子，请发布您的答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T09:46:29.573

您将需要无法通过官方来源获得的 Surface SDK 1.0。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-28T02:52:04.983

您现在可以从[Surface 合作伙伴网站](http://partner.surface.com/en/Pages/default.aspx)下载带有示例应用程序的 Surface SDK 。如果您可以访问[Surface 社区站点](http://community.surface.com/)，那里有更高级的应用程序，没有源代码。

# sql - 慢而简单的查询，如何让它更快？

> ID：833579
> 
> 赞同：0
> 
> 时间：2009-05-07T08:58:49.643
> 
> 标签：sql, sql-server, database, optimization

我有一个 6GB 大小的数据库，有许多表，但是较小的查询似乎有最多的问题，并且想知道可以做些什么来优化它们，例如有一个 Stock、Items 和 Order 表。
Stock 表是库存商品，其中包含大约 100,000 条记录，其中 25 个字段存储 ProductCode、Price 和其他库存特定数据。
Items 表存储有关项目的信息，其中有超过 2,000,000 个，其中超过 50 个字段存储项目名称和有关项目或产品的其他详细信息。
Orders 表存储库存商品的订单，即下订单的时间加上售价，并且有大约 50,000 条记录。

这是来自此数据库的查询：

```
SELECT Stock.SKU, Items.Name, Stock.ProductCode FROM Stock
INNER JOIN Order ON Order.OrderID = Stock.OrderID
INNER JOIN Items ON Stock.ProductCode = Items.ProductCode
WHERE (Stock.Status = 1 OR Stock.Status = 2) AND Order.Customer = 12345
ORDER BY Order.OrderDate DESC; 
```

鉴于此处的信息可以采取哪些措施来改进此查询，还有其他类似的方法，还有哪些替代方法。但是，无法进一步详细说明数据和数据库的性质，因此如果给出一般的优化技巧和方法，这些将很好，或者任何通常适用于数据库的东西。
数据库是 Windows Server 2003 上的 MS SQL 2000，每个数据库都有最新的服务包。数据库升级/操作系统升级目前不是选项。

* * *

**编辑**

在提到的表格中，索引是 Stock.SKU、Items.ProductCode 和 Orders.OrderID。
像这样的查询的执行计划是 13-16 秒 75% 的时间花在 Stock 上

* * *

感谢到目前为止的所有回复 - 索引似乎是问题所在，给出的所有不同示例都有帮助 - 尽管查询有一些错误，但这帮助了我很多这些查询运行得更快，但结合了索引建议 我认为我现在可能走在正确的道路上 - 感谢您的快速回复 - 真的帮助了我，让我考虑了我以前没有想过或不知道的事情！

* * *

索引是我的问题，在带有订单（客户）的外键中添加了一个，这通过将执行时间减半来提高了性能！
看起来我有狭隘的视野并专注于查询 - 我已经与 DB 合作了几年，但这非常有帮助。但是，感谢所有查询示例，它们是我没有考虑过的组合和功能也可能有用！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T09:03:10.803

你的代码正确吗？？？我确定你错过了什么

```
INNER JOIN Batch ON Order.OrderID = Orders.OrderID 
```

并且您在代码中有一个 ) ...

* * *

您总是可以针对执行计划工具测试一些变体，例如

```
SELECT 
    s.SKU, i.Name, s.ProductCode 
FROM 
    Stock s, Orders o, Batch b, Items i
WHERE 
    b.OrderID = o.OrderID AND
    s.ProductCode = i.ProductCode AND
    s.Status IN (1, 2) AND 
    o.Customer = 12345
ORDER BY 
    o.OrderDate DESC; 
```

并且您应该只返回一小部分，例如 TOP 10... 选择 TOP 10 需要几毫秒，但将其绑定到您的应用程序时会节省大量时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T09:01:18.390

最重要的（如果尚未完成）：为表定义主键（如果尚未定义）并为外键和连接中使用的列添加索引。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T09:03:23.827

你指定索引了吗？在

*   Items.ProductCode
*   库存.产品代码
*   Orders.OrderID
*   订单.客户

有时，IN 可能比 OR 更快，但这并不像拥有索引那么重要。

请参阅 balexandre 答案，您的查询看起来错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T09:03:03.797

一些通用指针

*   您加入的所有字段是否都已编入索引？

*   ORDER BY 是必要的吗？

*   执行计划是什么样的？

顺便说一句，您似乎没有在问题查询示例中引用 Order 表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T09:04:24.323

正如 Cătălin Pitiş 建议的那样，表索引肯定会有所帮助。

另一个技巧是通过使用 sub select 或更极端的使用临时表来减小连接行的大小。例如，与其加入整个 Orders 表，不如加入

```
(SELECT * FROM Orders WHERE Customer = 12345) 
```

另外，不要直接加入 Stock 表加入

```
(SELECT * FROM Stock WHERE Status = 1 OR Status = 2) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T09:21:58.090

在表上设置正确的索引通常是对性能产生最大影响的原因。

在 Management Studio（或早期版本的查询分析器）中，您可以选择在运行时查看查询的执行计划。在执行计划中，您可以看到数据库真正为获得结果所做的工作，以及哪些部分需要最多的工作。那里有一些东西需要寻找，比如表扫描，这通常是查询中成本最高的部分。

表的主键通常有一个索引，但您应该验证它是否确实如此。然后，您可能需要用于查找记录的字段和用于排序的字段的索引。

添加索引后，您可以重新运行查询并在执行计划中查看它是否实际使用索引。（在为数据库创建索引后，您可能需要等待一段时间才能构建索引，然后才能使用它。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T09:30:04.153

你能试一试吗？

```
SELECT Stock.SKU, Items.Name, Stock.ProductCode FROM Stock
INNER JOIN Order ON Order.OrderID = Stock.OrderID AND (Order.Customer = 12345) AND (Stock.Status = 1 OR Stock.Status = 2))
INNER JOIN Items ON Stock.ProductCode = Items.ProductCode
ORDER BY Order.OrderDate DESC; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-07T13:19:53.417

详细说明 Cătălin Pitiş 已经说过的话：在您的查询中

```
SELECT Stock.SKU, Items.Name, Stock.ProductCode
    FROM Stock
      INNER JOIN Order ON Order.OrderID = Stock.OrderID
      INNER JOIN Items ON Stock.ProductCode = Items.ProductCode
  WHERE (Stock.Status = 1 OR Stock.Status = 2) AND Order.Customer = 12345
  ORDER BY Order.OrderDate DESC; 
```

标准 Order.Customer = 12345 看起来非常具体，而 (Stock.Status = 1 OR Stock.Status = 2) 听起来不具体。如果这是正确的，一个有效的查询包括

1）首先找到属于特定客户的订单，

2）然后找到对应的Stock行（具有相同的OrderID）过滤掉那些在（1、2）中具有Status的行，

3）最后找到与2）中Stock行具有相同ProductCode的项目

对于 1) 您需要针对表 Order 的 Customer 索引，针对 2) 针对表 Stock 的 OrderID 索引和针对 3) 针对表 Items 的 ProductCode 索引。

只要您的查询没有变得更加复杂（例如成为更大查询中的子查询，或者 Stock、Order 和 Items 只是视图，而不是表），查询优化器就应该能够从您的查询中找到该计划。否则，您将不得不按照 kuoson 的建议进行操作（但如果 (1, 2) 中的状态不是很具体和/或状态未在状态表中编入索引，则第二个建议无济于事）。但也要记住，如果您在表上执行许多插入/更新，那么保持索引最新会降低性能。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-07T15:34:06.137

为了缩短我 2 小时前给出的答案（当我的 cookie 关闭时）：

您需要*三个*索引：表 Order 的 Customer、Stock 的 OrderID 和 Items 的 ProductCode。

如果您错过了其中任何一个，您将不得不等待对相应表的完整表扫描。

# c# - 从 WebService 捕获传入参数

> ID：833588
> 
> 赞同：2
> 
> 时间：2009-05-07T09:02:17.043
> 
> 标签：c#, web-services, logging, arguments

我想知道如何动态捕获 WebService 调用的参数（用于日志记录）。

是否有任何属性存储正在调用的参数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T17:51:31.957

假设您将 Windows Communication Foundation 用于 Web 服务，您可以创建一个客户端消息检查器来捕获入站通信并解析参数并将它们存储到数据库表中。您需要处理的接口是**IEndpointBehavior**和**IClientMessageInspector**。创建之后，您可以将其作为一种行为附加到 web.config 文件中的一个端点，并且应该这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T15:20:38.193

这取决于日志记录的类型和您使用的 Web 服务的类型。这还取决于您最终要如何处理这些信息。（报告？统计？调试？）

它还取决于您要在哪里捕获 Web 服务参数。您可以从调用应用程序中记录它们，也可以直接在 Web 服务中记录它们，具体取决于应用程序和网络的体系结构。您可以将参数信息存储在 Web 服务器上的日志中（这可能会影响 Web 服务器的性能），或者您可以在应用程序中本地记录参数并从那里处理该信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T09:22:42.143

我存储进入 Web 服务的内容的一种方法是存储在数据库中。这是一个 .NET Web 服务，它通过存储过程从 db 获取数据，在存储过程中，我只是使用 INSERT INTO 语句来存储传入的内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T13:49:23.850

通过 web.config 中的诊断元素启用跟踪怎么样？不过，这可能更多用于调试目的。

```
<microsoft.web.services>
    <diagnostics>
    <trace enabled="true" input="inputTrace.config" output="outputTrace.config"/>
    </diagnostics>
</microsoft.web.services> 
```

# java - Iceface：更新时重置旧值

> ID：833598
> 
> 赞同：1
> 
> 时间：2009-05-07T09:03:50.050
> 
> 标签：java, icefaces

我有 bean 中的用户信息，我想更新这个用户。但我的问题是：当 inputtext 的值发生变化时，我想对其进行验证。如果新值错误，我想重置旧值。

请任何人都可以帮助我

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T10:48:44.700

您的“InputText”标签中必须有 ValueChangeListener 属性。在您的方法中，声明为侦听器，您有 ValueChangeEvent 对象，其中包含旧值。你可以这样做：

```
public void myValChanged(ValueChangeEvent event) {
 try {
   validate(event.getNewValue());
   myValue = event.getNewValue();
 } catch (Exception ex) {
    /*
    Listeners are called before update model values in the request lifecycle so any changes you make in that phase are overwritten by the actual values in the page.
    By changing the event's phase to UPDATE_MODEL_VALUES or INVOKE_APPLICATION your changes will overwrite those currently set in the page, which is what you need.
     */
            myValue = event.getOldValue();
    if (!event.getPhaseId().equals(PhaseId.INVOKE_APPLICATION)) {
        event.setPhaseId(PhaseId.INVOKE_APPLICATION);
        event.queue();
        return;
    }       
 }

} 
```

PhaseId 操作的想法是 - 不允许您的 ValueChangeListener 覆盖您的变量集“ `myValue = event.getOldValue();`”

# java - 我可以自己编译java吗？

> ID：833604
> 
> 赞同：3
> 
> 时间：2009-05-07T09:05:31.967
> 
> 标签：java, performance

他们是否说 sun 的 java 现在是开源的 - 那么我可以从源代码编译所有 patform 吗？

我使用了gentoo，我发现我自己编译了系统，性能很好，那么它可以用java（vm运行时和库类）来完成吗？

是否可以在 windows/linux 下进行？

有人做过吗？

这有什么意义吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T09:11:39.300

是的你可以。Sun 的 OpenJDK 项目中提供了预构建的二进制文件、源代码等：

[http://openjdk.java.net/](http://openjdk.java.net/)

很难说它是否会对性能产生影响。它可能，但通常差异不是很大。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T09:09:28.370

是的，这现在应该是可能的——不，它不会给你带来任何好处，除非你有一个编译器可以从相同的源输入生成更好的字节码。鉴于将 java 转换为字节码的简单性质以及大多数优化是在运行时完成的事实，这似乎不太可能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T09:11:13.373

是的，这是可能的。如果您检查 linux 发行版的存储库，您会注意到通常有 OpenJDK 选项。您所追求的一切都可以在[http://openjdk.java.net/](http://openjdk.java.net/)上找到。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T09:08:54.033

除了出于教育目的之外，我不太确定您为什么要这样做。

Sun 在所有方面（JVM 以及默认库）的性能改进方面付出了相当多的努力，我认为您没有理由让它变得更好。

同样，很高兴知道如何做到这一点，但我不希望有巨大的性能改进。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T09:11:17.320

我会开始在[这里](http://download.java.net/jdk7/)寻找你的 java jdk 源代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-07T10:55:29.580

Java 将程序编译为机器码，根据我在 Sun 网站上收集到的信息，它对使用哪种编译器非常敏感。因此，您需要使用受支持的构建环境来确保结果 100% 正确。

构建 JDK 对于外行来说并不容易，所以除非你觉得在家阅读 Makefiles，否则我会离开这个项目待会 :)

# c# - 是什么导致设计视图如此缓慢？

> ID：833605
> 
> 赞同：9
> 
> 时间：2009-05-07T09:06:01.653
> 
> 标签：c#, visual-studio, winforms

对于小型项目，我几乎可以立即切换到设计视图（< 1 秒）。

我有一个大型项目，需要大约 60 秒才能在设计视图中打开控件或表单——这只是第一次。在这 60 秒的延迟之后，我几乎可以立即在设计视图中打开项目中的任何控件 - 直到我重新编译项目。

如果这个项目构建的 exe 在另一个（小）项目中被引用，那么小项目会立即变得和大项目一样迟钝。同样，如果我将大项目中的所有文件单独添加到小项目中，小项目就会变得迟缓。

大项目引用了一个大的托管 C++ 项目，但是如果我将相同的引用（并从引用中调用一个函数以确保它已加载）添加到小项目，小项目仍然很快。

我的大型项目使用 SandDock。如果我的小项目使用 SandDock，它仍然很快。

我的大型项目有大约 60 个用户控件出现在工具箱中。如果我在小项目中添加 60 个用户控件，小项目仍然很快。

如果我使用 [System.ComponentModel.ToolboxItem(false)] 从工具箱中隐藏用户控件，则大型项目仍然很慢。

vs2005和vs2008都出现这个问题。

是什么让大型项目第一次打开设计视图变得如此缓慢？其他一些参考？大量的控件？班级人数多？还有什么原因？

我注意到的一件事（尽管可能是红鲱鱼）是 ProjectAssemblies 文件夹（C:\Documents and Settings\tim.gradwell\Local Settings\Application Data\Microsoft\VisualStudio\9.0\ProjectAssemblies）很大（> 1GB）并且这里的大多数文件夹都有我的托管 C++ dll 的副本！每次重新打开设计视图（重新编译后）时，这些文件夹似乎都会重新创建。这可能与放缓有关吗？

* * *

更多信息：

用户控件或表单中的工具条使表单需要 60 秒才能加载。删除工具条（但表单上仍有其他几个不同的控件）可以立即切换到设计视图。

不过，这还不是全部……全新项目中的工具条不会导致大幅减速 - 所以在我的大项目中一定有一些东西影响了工具条。此外，某些其他没有工具条的表单/控件仍然需要 60 秒才能显示设计视图，因此无论是什么影响工具条的东西也会影响其他控件。我将继续努力准确地确定哪些控件，甚至可能是导致它的原因！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-07T09:20:27.937

即使您已将类标记为不出现在工具箱中，Visual Studio 仍需要扫描所有打开的项目以发现这一点。为了加快速度，您需要关闭自动填充工具箱的设置。如果您使用工具箱进行大量工作，可能会有点烦人，但它会大大加快速度。

该设置在工具 -> 选项 -> Windows 窗体设计器中，将“AutoToolboxPopulate”设置为 false。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-21T17:17:36.397

第一个答案：“设置在工具 -> 选项 -> Windows 窗体设计器中，将“AutoToolboxPopulate”设置为 false”对我有用。当第一次在设计视图中查看表单时，设计人员在试图将注意力集中在表单上的控件上时至少会挂起一分钟。现在，只需几秒钟。（我没有足够的声誉点来直接评论那个答案）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-05-13T21:51:03.847

我在 Visual Studio 2005 中的一个 Win CE 6.0 项目中遇到了这个问题。该项目使用 System.Data.SQLite.dll v1.0.65.0。每次打开或重新编译项目，然后尝试打开带有网格的表格进行设计时，至少会有 12 分钟的延迟。结果它在“My Documents\Local Settings\Application Data\Microsoft\Visual Studio\8.0\Project Assemblies”下生成了 770 多个文件夹，其中大部分只有 SQLite dll 的副本。
问题似乎是我在项目中从“兄弟”文件夹中引用了这个 DLL 到我的项目。举个例子：
项目文件夹：“...Projects\ThisAndThat\projectFolder”
DLL文件夹：“...Projects\ThisAndThat\projectFolderBin”
可能有其他文件夹关系体现了这个问题，
我将 DLL 移到“Program Files\Microsoft.NET\SDK\CompactFramework\v2.0\WindowsCE”文件夹中，问题就消失了。我有一个包含两个选项卡的选项卡控件的表单。每个选项卡都包含一个数据网格控件。此表单现在几乎立即加载到设计器中。
如果有人知道更好的解决方案，或者 VS2005 的什么设置或行为导致此问题，请添加评论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T09:16:51.673

除了 devenv.exe 随机挂起之外，我的 2005 也发生了同样的事情

甚至在“构建”之后，有时自定义控件往往会破坏主窗体

您最近是否进行过病毒扫描和碎片整理？

# .net - WPF - 为什么 ContextMenu 项目适用于 ListBox 而不是 ItemsControl？

> ID：833607
> 
> 赞同：3
> 
> 时间：2009-05-07T09:06:18.143
> 
> 标签：.net, wpf, listbox, itemscontrol, routed-commands

列表中的项目具有上下文菜单。上下文菜单项绑定到路由命令。

如果列表控件是 a ，则上下文菜单项可以正常工作`ListBox`，但是一旦我将其降级为 a`ItemsControl`它就不再工作了。具体来说，菜单项始终是灰色的。我的`CanExecute`回调`CommandBinding`也没有被调用。

是什么`ListBox`让带有命令的上下文菜单项正确绑定？

以下是我为突出问题而整理的示例应用程序的一些摘录：

```
<!-- Data template for items -->
<DataTemplate DataType="{x:Type local:Widget}">
  <StackPanel Orientation="Horizontal">
    <StackPanel.ContextMenu>
      <ContextMenu>
        <MenuItem Header="UseWidget" 
                  Command="{x:Static l:WidgetListControl.UseWidgetCommand}"
                  CommandParameter="{Binding}" />
      </ContextMenu>
    </StackPanel.ContextMenu>
    <TextBlock Text="{Binding Path=Name}" />
    <TextBlock Text="{Binding Path=Price}" />
  </StackPanel>
</DataTemplate>

<!-- Binding -->
<UserControl.CommandBindings>
  <CommandBinding Command="{x:Static l:WidgetListControl.UseWidgetCommand}" 
                  Executed="OnUseWidgetExecuted" 
                  CanExecute="CanUseWidgetExecute" />
</UserControl.CommandBindings>

<!-- ItemsControl doesn't work... -->
<ItemsControl ItemsSource="{Binding Path=Widgets}" />

<!-- But change it to ListBox, and it works! -->
<ListBox ItemsSource="{Binding Path=Widgets}" /> 
```

这是视图模型和数据项的 C# 代码：

```
public sealed class WidgetListViewModel
{
    public ObservableCollection<Widget> Widgets { get; private set; }

    public WidgetViewModel()
    {
        Widgets = new ObservableCollection<Widget>
            {
                new Widget { Name = "Flopple", Price = 1.234 },
                new Widget { Name = "Fudge", Price = 4.321 }
            };
    }
}

public sealed class Widget
{
    public string Name { get; set; }
    public double Price { get; set; }
} 
```

这是控件的 C# 代码隐藏：

```
public partial class WidgetListControl
{
    public static readonly ICommand UseWidgetCommand 
        = new RoutedCommand("UseWidget", typeof(WidgetListWindow));

    public WidgetListControl()
    {
        InitializeComponent();
    }

    private void OnUseWidgetExecuted(object s, ExecutedRoutedEventArgs e)
    {
        var widget = (Widget)e.Parameter;
        MessageBox.Show("Widget used: " + widget.Name);
    }

    private void CanUseWidgetExecute(object s, CanExecuteRoutedEventArgs e)
    {
        e.CanExecute = true;
        e.Handled = true;
    }
} 
```

只是为了重申这个问题 - 是什么`ListBox`提供了允许它的上下文菜单项命令正确绑定的东西，有什么方法可以让它工作`ItemsControl`吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T16:27:44.557

好的，我看到的主要问题是 ItemsControl 没有所选项目的概念，因此您无法选择要绑定到 DataTemplate 的项目。

我不记得我在哪里看到的了，但是在编写 WPF 时要遵循的一个很好的规则是使用能够为您提供所需行为的控件，然后将其样式设置为您想要的样式。

所以考虑到这一点，您想要 ListBox 的行为，但需要 ItemsControl 的外观，那么为什么不设置 ListBoxItems 的样式以不显示选定和非选定之间的区别。

```
<Style TargetType="{x:Type ListBoxItem}">
    <Setter Property="Background" Value="Transparent"/>
    <Setter Property="HorizontalContentAlignment" Value="{Binding Path=HorizontalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
    <Setter Property="VerticalContentAlignment" Value="{Binding Path=VerticalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
    <Setter Property="Padding" Value="2,0,0,0"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type ListBoxItem}">
                <Border SnapsToDevicePixels="true" x:Name="Bd" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}">
                    <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsEnabled" Value="false">
                        <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T10:13:19.090

这可能与 ContextMenu 弹出窗口中的项目与 UserControl 的其余部分不在同一可视树中的事实有关（基本上，弹出窗口是一个单独的窗口）。这就是 CommandBindings 不起作用的原因。

但是现在我不知道如何在不指定 ContextMenu 中的 CommandBindings 的情况下解决这个问题。

# grails - 如何重命名现有的 Grails 应用程序

> ID：833612
> 
> 赞同：25
> 
> 时间：2009-05-07T09:08:13.833
> 
> 标签：grails

有人知道如何（轻松地）“重命名”现有的 grails 应用程序吗？我遇到了这个问题，因为我的 PaaS 提供商不允许我删除订阅......所以我想以不同的名称部署我的应用程序。

当然，我可以手动执行此操作，但我认为它可能是一个有用的“顶级”脚本（即“grails rename-app newappname”）

手动提示：

当我执行“grails create-app myappname”时，我可以看到 myappname 存在于以下文件（和文件名）中......当然这是由 create-app 脚本完成的，它替换了 @...@ 中的标记模板。我想一旦它们被替换，重命名就不是一件容易的事。

```
./.project: <name>myappname</name>
./application.properties:app.name=myappname
./build.xml:<project xmlns:ivy="antlib:org.apache.ivy.ant" name="myappname" default="test">
./ivy.xml:    <info organisation="org.example" module="myappname"/>
./myappname-test.launch:<stringAttribute key="org.eclipse.jdt.launching.PROJECT_ATTR" value="myappname"/>
./myappname.launch:<listEntry value="/myappname"/>
./myappname.launch:<listEntry value="<?xml version="1.0" encoding="UTF-8"?> <runtimeClasspathEntry containerPath="org.eclipse.jdt.launching.JRE_CONTAINER" javaProject="myappname" path="1" type="4"/> "/>
./myappname.launch:<stringAttribute key="org.eclipse.jdt.launching.PROJECT_ATTR" value="myappname"/>
./myappname.launch:<stringAttribute key="org.eclipse.jdt.launching.VM_ARGUMENTS" value="-Dbase.dir="${project_loc:myappname}" -Dserver.port=8080 -Dgrails.env=development"/>
./myappname.tmproj: <string>myappname.launch</string> 
```

当然......顶级目录名称是“myappname”

欢迎提供有关该领域正在进行的举措的任何提示或信息

问候，

约翰

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-07-24T01:48:23.033

我必须这样做，我将我的项目顶级目录重命名为新名称并编辑了 application.properties 文件。有一行 app.name=youroldappname 应该更改。

实际上，您甚至不必重命名目录。您可以使用不同的网络应用名称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-09T05:50:16.263

嗯，我知道这看起来不好玩，但是重命名项目目录应该不难（只是无聊），然后重命名所有带有你项目名称的文件（你可以忽略 .tmproj，除非你使用 TextMate）。最后，快速搜索所有文件以替换旧项目名称，您应该拥有它。

哦！首先，如果您使用的是 IDE，您需要从 IDE 中删除该项目，然后在完成重命名过程后重新导入它。

据我所知，除了项目目录和下面的任何地方都没有存储任何特定于项目的东西，所以它是一个非常有限的搜索集，你只需要这样做一次（我希望如此）。

不是很优雅，我知道，但蛮力确实有它的用途。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-12T11:17:09.283

我使用了蛮力方法，它对我有用。花了 5-10 分钟找到所有包含该名称的文件并将其替换为新文件。之后Netbeans也很好。唯一改变的是我不得不再次更改的端口号。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-03T20:24:55.300

除非您使用插件，否则只需重命名即可。它们将存储在`$USER_HOME/.grails/$GRAILS_VERSION/projects/OLDNAME`文件夹中。

因此，在重命名您的项目后，您“丢失”了您的插件。我没有尝试重命名插件的文件夹，但是安装所有插件也可以（至少使用 Google App Engine 和 gorm-jpa）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-13T13:32:41.893

如果仅更改 Web 应用程序名称还不够，您可以尝试粗略的方法 - 之前进行备份。（在工作区文件夹中）

```
zip -r oldname.zip oldname/ 
```

然后，在 eclipse/ggts 中，使用

禁用项目，自动构建搜索，文件，包含文本：“旧名称”，搜索右键单击搜索结果，全部替换，...​​“新名称”

退出 eclipse 并将所有文件夹重命名为新的项目名称。在 Unix/Mac 上运行

```
find . -name "oldname" 
```

和 mv 少数结果以正确反映新名称。

对我来说，它就像一个魅力，但要确保你的项目名称不是关键字并且相当独特。

# python - 我需要在 SCO 5.0.5 上安装 python 2.5

> ID：833624
> 
> 赞同：1
> 
> 时间：2009-05-07T09:11:34.150
> 
> 标签：python, unix

我很想在 sco unix 上安装 python2.5，我想知道有人尝试过这样做吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T09:14:52.520

您是否已经尝试过[标准源指令](http://www.python.org/download/source/)，但失败了？如果是这样，我想提及失败的原因会很有用。这几乎是一个非编程问题，就像现在所说的那样......

# python - 我需要一个带有鼻子的python单元测试sqlalchemy模型的样本

> ID：833626
> 
> 赞同：23
> 
> 时间：2009-05-07T09:12:34.353
> 
> 标签：python, unit-testing, testing, sqlalchemy, nose

有人可以告诉我如何为我使用鼻子创建的 sqlalchemy 模型编写单元测试。

我只需要一个简单的例子。

谢谢。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-07T10:35:31.673

您可以简单地创建一个内存 SQLite 数据库并将您的会话绑定到该数据库。

例子：

```
 from db import session # probably a contextbound sessionmaker
from db import model

from sqlalchemy import create_engine

def setup():
    engine = create_engine('sqlite:///:memory:')
    session.configure(bind=engine)
    # You probably need to create some tables and 
    # load some test data, do so here.

    # To create tables, you typically do:
    model.metadata.create_all(engine)

def teardown():
    session.remove()

def test_something():
    instances = session.query(model.SomeObj).all()
    eq_(0, len(instances))
    session.add(model.SomeObj())
    session.flush()
    # ... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-28T12:40:17.493

查看[夹具](http://code.google.com/p/fixture/)项目。我们用鼻子来测试它，它也是一种以声明方式定义要测试的数据的方法，将有一些广泛的示例供您使用！

另请参阅[夹具文档](http://farmdev.com/projects/fixture/)。

# data-binding - 如何使用 Expression Blend 3 创建 DataTemplate？

> ID：833633
> 
> 赞同：3
> 
> 时间：2009-05-07T09:15:27.760
> 
> 标签：data-binding, expression-blend

我目前正在尝试使用[Expression Blend 3 MIX09 版本](http://www.microsoft.com/expression/try-it/blendpreview.aspx)，**主要是将其用于具有数据绑定的 MVVM 结构化站点，能够在我设计时查看实时数据**。到目前为止，我**印象非常深刻**，不得不说**Blend 3 生成的 XAML 并没有人们说的那么糟糕**。我得到了以下两个示例，一个具有数据绑定，另一个具有动态加载的用户控件（视图）。在我设计我的应用程序时，我可以在 90% 的时间里留在 Expression Blend，在我设计时看到来自我的 ViewModel 的实时数据。我切换到 Visual Studio 只是为了创建配置文件，或者添加引用更容易。**Blend 3 改进的智能**感知**使我能够在大部分编码中留在 Blend 中：**

 ***   [可以使用 Expression Blend 和 Visual Studio 编辑的 MVVM 基础应用程序](http://tanguay.info/web/index.php?pg=codeExamples&id=168)
*   [如何使用 DataBinding 构建 WPF 应用程序，以便在 Expression Blend 中增强它](http://tanguay.info/web/index.php?pg=codeExamples&id=167)

不过，令我感到惊讶的是，我在 Expression Blend 中不能做的一件事是，在我创建了一个 ListBox 之后，我希望我可以右键单击并**创建一个 DataTemplate**。我当然可以在代码中创建一个 DataTemplate，然后在 Resources/Window 下我再次找到它，可以单击它旁边的按钮以“进入 DataTemplate”并在我的 Objects and Timeline 面板中查看控件，这很好. 但是从控件创建 DataTemplate 是如此普遍，我认为有一种方法可以做到这一点，而我只是想念它。

**在 Blend 3 中，您可以在哪里为 ListBox 或 ListView 等“创建 DataTemplate”？**

```
<UserControl
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:TestDynamic456"
    mc:Ignorable="d"
    x:Class="TestDynamic456.CustomersView"
    x:Name="UserControl"
    d:DesignWidth="640" d:DesignHeight="480">

    <UserControl.Resources>
        <local:CustomersViewModel x:Key="CustomersDataProvider"/>
    </UserControl.Resources>
    <StackPanel x:Name="LayoutRoot" Background="{x:Null}">

        <ListBox ItemsSource="{Binding Path=GetAll, Source={StaticResource CustomersDataProvider}}"/>

    </StackPanel>
</UserControl> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-06T17:51:13.180

在 Blend 3 中，您在 Blend2 中创建 ItemsControl 的 DataTemplate ;)

右键控件->编辑其他模板->编辑生成的项目(ItemTemplate)->CreateEmpty

# wcf-data-services - ADO.NET 数据服务媒体类型需要一个“;” 参数定义前的字符

> ID：833637
> 
> 赞同：0
> 
> 时间：2009-05-07T09:15:46.980
> 
> 标签：wcf-data-services

我正在尝试使用 ADO.NET，并且在第二次尝试浏览服务时看到此错误：

```
<?xml version="1.0" encoding="utf-8" standalone="yes" ?> 
 <error xmlns="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata">
 <code /> 
<message xml:lang="en-US">Media type requires a ';' character before a parameter  definition.</message> 
</error> 
```

第一次尝试是正常的。我在内部开发网络上使用完全相同的服务，这很好。我包括我的连接字符串：

```
<add name="J4Entities" connectionString="metadata=res://*;provider=System.Data.SqlClient;provider connection string=&quot;Data Source=MNSTSQL01N;Initial Catalog=J4;Integrated Security=True;MultipleActiveResultSets=True&quot;" providerName="System.Data.EntityClient"/> 
```

和我的数据服务类：

```
 using System;
 using System.Data.Services;
 using System.Collections.Generic;
 using System.Linq;
 using System.ServiceModel.Web;

 public class Data : DataService< J4Model.J4Entities >
 {
    // This method is called only once to initialize service-wide policies.
    public static void InitializeService(IDataServiceConfiguration config)
    {
        // TODO: set rules to indicate which entity sets and service operations are    visible, updatable, etc.
        // Examples:
        config.SetEntitySetAccessRule("*", EntitySetRights.AllRead);
        // config.SetServiceOperationAccessRule("MyServiceOperation",    ServiceOperationRights.All);
     }
   } 
```

有什么明显的我没有做的吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-03T14:20:30.527

我有一个类似的问题 -

这是我到目前为止发现的：

[MSDN 社交论坛](http://social.msdn.microsoft.com/Forums/en-US/adodotnetdataservices/thread/e47ec51b-ea38-49f7-9814-d113907d4e3a)

我不确定究竟是什么原因造成的，但对我来说一切都很好，然后它停止工作，给我一个类似的错误。

比较郁闷....

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-02T22:59:57.330

检查 HTTP 请求标头：接受。ADO.NET 数据服务在解析来自不同客户端的某些 Accept Header 类型时出现问题。

接受标头的 RFC：http: [//www.w3.org/Protocols/rfc2616/rfc2616-sec14.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)

刚刚发现 Solr/Java 库调用 oData .Net 服务时出现问题。

# java - 关于减少 Java 中的 CPU 使用率有什么建议吗？

> ID：833638
> 
> 赞同：2
> 
> 时间：2009-05-07T09:16:13.470
> 
> 标签：java, cpu-usage

我编写了一个 Java 程序来下载 HTML 页面。但是 CPU 使用率接近 100%，而网络使用率低于 3%。似乎那个 CPU 成了我的瓶颈。如何减少 CPU 使用率？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T09:20:57.093

使用分析器（我喜欢[VisualVM](https://visualvm.dev.java.net/)），找出瓶颈并修复它！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-07T09:19:12.450

如果您有一个连续的 while 循环，请在迭代之间给您的程序一些[睡眠](http://java.sun.com/docs/books/tutorial/essential/concurrency/sleep.html)时间。单独下载网页不应该导致太多的资源使用，您可能需要查看分析器以找出瓶颈所在。也许在这里发布代码可以让我们为您提供更多帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T10:07:59.790

您可以做的一件非常简单的事情来识别问题就是抓取一些堆栈跟踪。ctrl-/ctrl-break/jstack/jconsole/visualvm。如果程序灾难性地花费大量时间来解决性能问题（很有可能），那么您应该很容易看到问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-07T09:20:04.803

如果您的 CPU 使用率在很长一段时间内接近 100%，那么很可能您的代码中有错误（无限循环之类的）。尝试分析您的应用程序以查看发生了什么。从在代码的各个点打印当前时间开始。如果您仍然无法找到它，则需要一个分析器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T10:29:12.453

也许您轮询数据的速度太快了...

我会尝试将代码更改为事件驱动的通知。

问候。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-07T12:25:51.050

当您阅读时，您是否一次读取一个字符/字节？这将加载操作系统相当多。

> 使用 BufferedReader，和/或尝试使用 read(char[]...) 或 readLine() 读取，具体取决于您正在阅读的内容。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T18:29:06.120

您是否有机会使用内置的 Java XML DOM 东西解析 HTML？根据过去的经验，它可能会导致相当高的 CPU 使用率（老实说，这是我见过的最慢的实现）。如果是这样，您可能需要考虑使用第三方库进行 XML 解析（例如[JDOM](http://en.wikipedia.org/wiki/JDOM)）。

# jquery - 克隆元素上的 jQuery 动画错误

> ID：833641
> 
> 赞同：0
> 
> 时间：2009-05-07T09:16:55.853
> 
> 标签：jquery, jquery-ui, cross-browser, jquery-animate

在 Firefox 中，这似乎工作正常 - 但 Safari、Opera 和 Chrome 都有问题。控制元素颜色变化的jQuery.ui（第3181行）将抛出一个错误，即“突出显示”效果。

这仅在尝试克隆并在同一操作中突出显示克隆时发生，即`$(targetStory).after(targetStory.clone().effect("highlight", {}, 1300));`

这在 Firefox 中运行良好，但会导致其他浏览器停止运行 -`targetStory`只是被克隆的元素的 ID，需要在该元素之后进行克隆。

以前有没有人遇到过这个错误，是否有其他解决方案可以轻松地为克隆设置动画？线越少越好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-27T03:31:48.873

关于什么：

```
 $(targetStory).clone().effect("highlight", {}, 1300)).insertAfter(targetStory); 
```

完全相同的东西，只是顺序不同。不知道为什么 FF 是好的，而其他的都坏了，虽然......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-27T04:04:16.390

如果要克隆的元素有 ID，则需要先删除（或更改）克隆的 ID，然后再将其放回 DOM。尝试：

```
$(targetStory).clone().removeAttr('id').insertAfter(targetStory)
  .effect(...); 
```

# com - Direct3D 10 是否有 COM 曝光

> ID：833642
> 
> 赞同：2
> 
> 时间：2009-05-07T09:17:24.730
> 
> 标签：com, guid, direct3d

先生们，尊敬的女士们。

我在 Code Project 的 COM 论坛上发布了这个问题，并得到了一个流利的回复，所以希望你会更有帮助。

我看到微软有一个用于 Direct3D 9 的 COM 库，其 GUID 为 81BDCBCA-64D4-426d-AE8D-AD0147F4275C。

Microsoft 是否在 COM 上公开了 Direct3D 10，如果是，接口 GUID 是什么？

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T10:22:36.353

从 MSDN 上的文档来看，他们似乎已经从使用具有[IDirect3D9::CreateDevice](http://msdn.microsoft.com/en-us/library/bb174313(VS.85).aspx)等成员函数的 IDirect3D9 对象转移到使用[D3D10CreateDevice](http://msdn.microsoft.com/en-us/library/bb205086(VS.85).aspx)等全局函数。在 Direct3D 10 中，他们将 IDirect3D9 中与（例如）适配器相关的许多功能拆分为[DirectX 图形基础结构 (DXGI)](http://msdn.microsoft.com/en-us/library/cc835730(VS.85).aspx)。

换句话说，Direct3D 10 仍然使用 COM，但不，没有 IDirect3D9 的对应物。您使用 IDirect3D9 完成的事情现在通过其他方式完成。

编辑：具有上述 GUID 的 COM 类是 IDirect3D9。Direct3D 10 没有这个的更新版本（没有 IDirect3D10 可以做 IDirect3D9 所做的事情）；相反，该类的成员函数被拆分为您直接调用而不是通过对象调用的全局函数（例如[D3D10CreateDevice](http://msdn.microsoft.com/en-us/library/bb205086(VS.85).aspx)）和 DXGI 类（例如[IDXGIOutput](http://msdn.microsoft.com/en-us/library/bb174546(VS.85).aspx)）。您不需要 IDirect3D10 对象，因为您将使用它的任务现在以不同的方式完成。

您应该能够通过在 Direct3D 头文件中搜索 DEFINE_GUID 宏来将 GUID 映射到 COM 类名称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-17T02:23:09.647

在 COM 中，您所要求的库信息被编码在类型库（TLB 文件）中。自 DirectX 8.0 以来，Direct3D 就没有为它的任何对象使用类型库或 CoCreateInstance，差不多十年前了。Direct3D 使用 COM 接口来管理其对象的生命周期，仅此而已。他们根本不使用 QueryInterface。大多数 COM 基础结构不适用于 Direct3D 及其关联对象使用的接口。

他们不使用 CoCreateInstance 来创建他们的对象，而是提供一个工厂函数（如 Direct3DCreate9），您可以从中获取一个基本接口，然后使用该基本接口中的创建者方法来获取其他所有内容。在 Direct3D 10 中，他们认识到枚举显示等的基本接口对于 D3D 8 和 D3D 9 是稳定的和相同的，因此他们将其移至稳定的基本接口 IDXGIFactory。相同的 DXGI 代码用于 D3D 10、10.1 和 11。

# asp.net-mvc - 带有 ASP MVC 的潜在危险 Request.Form

> ID：833645
> 
> 赞同：1
> 
> 时间：2009-05-07T09:18:36.473
> 
> 标签：asp.net-mvc

我最近将我的一个项目从 MVC 的 beta 版本之一升级到了完整版本。

我的一个输入“潜在危险的 Request.Form yada yada”出现了黄屏死机。

所以我尝试编辑页面 validateRequest 属性，但没有用。

然后我尝试添加

`[ValidateInput(false)`]

对于违规行为，但是当我尝试构建它时，它说该属性不存在。

那我该怎么办？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-08-05T10:17:33.553

顺便说一句，除非您将以下内容添加到web.config 文件的一部分，否则MVC 2 / ASP.NET 4 中的重大更改`[ValidateInput(false)]`将不起作用：`<system.web>`

```
<httpRuntime requestValidationMode="2.0" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T12:27:57.143

它适用于我的网站。

您可以尝试使用新的普通网站吗？当我将网站从 beta 版转换为 R1 版时，我还有一些其他奇怪的行为（强类型视图不起作用）。重新开始并将文件复制到新的网络总是在最后工作。

# iphone - .xcodeproj 没有被 Xcode 的 SCM 工具提交

> ID：833646
> 
> 赞同：4
> 
> 时间：2009-05-07T09:18:41.483
> 
> 标签：iphone, svn, xcode, version-control

我正在使用 XCode 中嵌入的 SCM 工具来管理我的应用程序的版本控制。

我已经创建了一个 iPhone 应用程序，并且我已经将它添加/提交到了 Subversion 服务器，但是 .xcodeproj 文件不会上传（所有的类文件、资源等都在那里）！我什至没有选择“添加到存储库”。有时它在“SCM”列下的旁边有一个“A”（添加），但下次我提交更改或提交整个项目时，它仍然不会上传并显示在服务器上。结果，我的团队无法获得并运行该项目。

有没有办法做到这一点（不仅仅是使用终端或版本）？

谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-03-27T23:21:02.610

`<project>.xcodeproj`实际上是一个目录。项目数据存储在`<project>.xcodeproj/project.pbxproj`. 请注意，.xcodeproj 中还有一些其他相对不重要的文件，您无需担心 - 只需确保已`project.pbxproj`签入即可。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-09T04:16:23.523

最好的方法是从 SVN 签出最新版本，并对文件进行/复制更改并提交。

# c++ - 有没有办法设置 QPicture 的 DPI？

> ID：833655
> 
> 赞同：0
> 
> 时间：2009-05-07T09:21:21.303
> 
> 标签：c++, qt, printing, pyqt

有没有办法设置a的DPI `QPicture`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T23:03:15.940

我不这么认为。至少，不是以一种方便的方式。我能想到的唯一方法是缩放用于创建 QPicture 的 QPainter。如果您使用 QPainter 操作绘制图片，而不是仅将其设置在 QLabel 上，则可以改为缩放该 QPainter。

# svn - 如何在 TortoiseSVN 中使用全局修订号关键字？

> ID：833657
> 
> 赞同：5
> 
> 时间：2009-05-07T09:21:33.473
> 
> 标签：svn, tortoisesvn, version-control-keywords

在 CVS 中，您可以在代码中使用在检出文件时扩展的关键字。我想用`$GlobalRev$`关键字显示 CVS 的全局修订。

Subversion 有该`$Rev$`命令，但它只显示文件已更改的最新版本。我知道有一个`svnversion`命令，到目前为止，在[1.5](http://svnbook.red-bean.com/en/1.5/svn.ref.svnversion.html)和[1.6 nightly](http://svnbook.red-bean.com/nightly/en/svn.ref.svnversion.html)中没有任何文档。

我很想知道如何用 TortoiseSVN 做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T09:32:45.800

我认为没有与 CVS 相同的选项，至少在需要时我找不到任何选项。

相反，我使用 TortoiseSVN`SubWCRev.exe`将包含`$WCREV$`字符串的模板文件转换为具有当前修订号的模板文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T12:25:34.967

svnversion 仍然可用，并[记录在 1.5](http://svnbook.red-bean.com/en/1.5/svn.ref.svnversion.re.html)

> svnversion 是一个用于总结工作副本的修订混合的程序。生成的修订号或修订范围被写入标准输出。

签出后使用它来获取工作副本的修订版，[KeywordExpansion](http://svnbook.red-bean.com/en/1.5/svn.advanced.props.special.keywords.html)的文档描述了它的设计使用方式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-10T14:15:32.933

我的 2 美分：

我目前正在开发一个基于 Web 的 Java 应用程序。我们有一个构建服务器（[Hudson](http://hudson-ci.org/ "http://hudson-ci.org/")），它**无法**访问命令行 subversion 可执行文件；相反，它附带了一个纯 java Subversion 库，以便能够在拉取源代码以构建应用程序之前访问存储库。

现在我们需要在构建过程中在应用主页中包含全局修订号（如果您查看屏幕的右下角，这很像 StackOverflow 所做的）。

不幸的是，Subversion 和 Ant 之间没有很好的集成。最好的[SVNAnt](http://subclipse.tigris.org/svnant.html "http://subclipse.tigris.org/svnant.html")更适合使用命令行 svn.exe 并且给我们运行带来了相当大的麻烦。

最后，我花了两个小时使用[SVNKit](http://svnkit.com/ "http://svnkit.com/")，这是一个用于 Subversion 访问的纯 Java 库，以调整我们的构建脚本以查看修订号并将其插入我们的文件中。

就个人而言，我看不出创建变量有什么难的地方，比如说，`$GlobalRev$`你会在每个文件中插入，就像你用`$Id$`or做的那样`$Rev$`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-10T22:32:36.277

我理解上面的评论。但似乎 globalrev 在一种情况下可能很有用......

当您希望在所有正在运行的可执行文件中拥有最后一个构建的版本时。

例如，如果您在 versionning.propriety 文件中放入一个带有应用程序标题的属性，您可以添加版本号。

因此，当测试人员或用户评论问题时，他们可以将数字与版本进行比较，而不是查看功能是否存在。这个变量 $GlobalRev$ 将在一个小上下文中使用，但可能很有用。

问候

# objective-c - 发送一个动作可可 - IBAction

> ID：833658
> 
> 赞同：7
> 
> 时间：2009-05-07T09:21:34.470
> 
> 标签：objective-c, cocoa, macos

我想使用可可向另一个对象发送一个动作。理想情况下，我也希望它出现在界面生成器中。

我已经尝试过苹果文档，但是我缺少一些东西。添加以下内容，界面构建仅将操作显示为收到的操作。

```
- (IBAction)setTarget:(id)anObject;
- (IBAction)setAction:(SEL)aSelector; 
```

有人可以给我一个如何创建已发送操作的示例。谢谢

* * *

我在控制器 1 中定义了接收操作。然后我希望我的控制器 2 能够向控制器 1 发送一个动作（就像 NSButton 一样）。在界面构建中，您可以将一条线从 NSButton 拖到应该接收信号的控件。此功能不能仅限于那里的苹果对象，必须有一种方法来做到这一点。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-07T15:34:58.397

`IBAction`是一个预处理器指令，它告诉 Interface Builder “这是你应该知道的事情。” 它实际上评估为`void`。这意味着“动作”只是您可以以正常方式调用的正常方法：

```
[target someMethod:self]; 
```

如果您想模仿可以从 中获得的行为`NSButton`，您可以为目标添加一个出口，为选择器添加一个属性（作为字符串）：

```
@property (nonatomic, retain) IBOutlet id target;
@property (nonatomic, retain) NSString* actionSelectorString; 
```

然后你可以这样调用：

```
SEL action = NSSelectorFromString(self.actionSelectorString);
[self.target performSelector:action withObject:self]; 
```

如果您希望您的类通过在 Interface Builder 中拖放来连接选择器，最简单的方法是使您的类成为`NSControl`（从对象库中拖入自定义视图，Command-6 以显示检查器，选择您的班级在顶部弹出窗口中）。然后，您可以通过以下方式“调用”该操作：

```
- (void) go {
    [self sendAction:self.action to:self.target];
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T09:23:24.467

动作总是由对象接收。如果您想在另一个方向发送信息，您可能需要一个出口：寻找 IBOutlet。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T13:12:09.877

NSButton 是一个 NSControl，因此有一个可以连线的“动作”——当您触发控件时发送的消息（例如，单击按钮）。控制器没有动作（这意味着什么——你将如何发送消息？），所以你试图做的实际上没有意义。

如果您希望控制器 2 能够让控制器 1 做某事，您应该在控制器 2 上创建一个插座（类型为控制器 1，或它实现的某个接口），将其连接到 IB 中的控制器 1，然后您可以从控制器 2 发送您想要的任何消息以编程方式到controller1。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T13:56:18.210

如果您`Controller2`的类是`NSControl`. 定义一个“发送的动作”，当您从Interface Builder 中`NSControl`拖动时，它是您连接到目标对象的内容。`NSButton`话虽如此，IB 3.0 中存在（曾经？）一个错误，阻止了已发送的操作在 IB 中显示。有关详细信息，请参阅[此 cocoa-dev 线程](http://www.mail-archive.com/cocoa-dev@lists.apple.com/msg11865.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T14:12:14.787

controller1 和 controller2 是 NSControl 的子类。

```
[controller2 sendAction:@selector(receiveAction:) to:controller1]; 
```

# javascript - Javascript中“未定义”和“未定义”有什么区别？

> ID：833661
> 
> 赞同：45
> 
> 时间：2009-05-07T09:22:30.007
> 
> 标签：javascript

如果您尝试使用不存在且尚未声明的变量，javascript 将抛出错误。`var name is not defined`，并且脚本将在那里停止。

但是，如果您使用它进行检查，`typeof noname`它将返回`"undefined"`。我一直认为您必须声明一个 var 才能使其具有类型。通过使用： var a; 所以它具有未定义的类型或通过给它一个值，例如：`var b =5;`所以它具有其值的类型。

`var a;`还有和有什么区别`var b = undefined;`？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-05-07T09:51:24.180

未声明的变量（即不存在的变量）没有类型 - 因此它的类型*是*未定义的。我相信测试某些东西是否未定义的普遍接受的方法是

```
typeof var === 'undefined' 
```

而不是

```
var === undefined 
```

因为如果变量不存在，您将无法访问它。*如果您确定变量应该*存在，后一种情况可能更有用，因为两者之间的区别在于未声明的变量在第一种情况下将返回 false，但在第二种情况下会导致错误。

如果您使用的是第二种变体，请确保使用三等号运算符；（更常见的）双等号运算符执行类型强制，因此`null == undefined`为真而`null === undefined`为假。有时您可能想要第一种行为，但通常您会想要第二种行为，尤其是当您针对 undefined 进行测试时，因此识别差异很重要。（这是第一种情况的另一个好处，因为不可能犯这个微妙的错误）。

是的，变量可以具有未定义的值，并且您可以显式地为它们分配值。但是，分配`undefined`给变量可能会令人困惑，因为这有点矛盾（您已将变量定义为未定义），并且无法将该变量与不存在的变量或未初始化的变量区分开来。如果您想表示一个变量当前没有值，或者如果您想完全“取消声明”该变量，请使用 null，请使用`delete {varname}`. 将 undefined 分配给变量不会删除该变量的声明；如果您遍历它们，它仍然会出现在其拥有对象的属性列表中，所以我想不出任何对您有利的情况。

编辑：作为对评论的回应，在将值与 ===（或 ==）进行比较时，必须引用变量以获得其当前值才能进行比较。由于该变量不存在，因此此取消引用失败（到目前为止还没有真正的惊喜）。虽然您可能希望 typeof 运算符以类似的方式工作（获取当前值，查看其类型是什么），但它特别适用于未定义的变量。“短版本”（如[Mozilla 参考](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Special_Operators/typeof_Operator)所使用的​​）只是“typeof 运算符返回一个字符串，指示未计算的操作数的类型。”

[从ECMAScript 规范](http://www.mozilla.org/js/language/E262-3.pdf)中提取的长版本是未定义变量的特殊情况：

> 11.4.3 typeof *UnaryExpression*评估如下：
> 
> 1.  评估*UnaryExpression*（根据 10.1.4，如果变量未声明，则返回“一个 Reference 类型的值，其基对象为*null ，其属性名称为标识符”）。*
> 2.  如果 Type(Result(1)) 不是参考，则转到步骤 4。（它是参考）
> 3.  如果 GetBase(Result(1)) 为*null*，则返回“未定义”。（这是匹配未定义变量的特例）

至于你对第一个问题的评论，“你怎么能对不存在的东西进行分类”——这很容易！简单地将所有概念分为确实存在的事物（例如松鼠、岩石）和不存在的事物（独角兽、曲速引擎）。这就是未定义的意思；不管它在英语中的语义如何，它的 Javascript 含义是该变量尚未被声明或填充，因此虽然“名为 foo 的变量”的*概念*是有效的，但不存在具有该名称的变量具有实际值。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-05-07T11:17:21.480

JavaScript 提供了几种不同的缺失或空变量（和对象属性）的概念：

1.  实际上“未定义”的变量，即它们不存在，因为给定的名称未绑定在当前的词法环境中。访问这样的变量会引发错误，但使用`typeof`不会并且会返回`'undefined'`。相反，访问不存在的属性不会抛出错误`undefined`而是返回（您可以使用`in`运算符或`hasOwnProperty()`方法来检查属性是否确实存在）。

2.  未分配值的现有变量（由于[var 提升](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var#var_hoisting)很常见）或已显式设置为`undefined`. 访问这样的变量将返回`undefined`，`typeof`将返回`'undefined'`。

3.  已明确设置为 的现有变量`null`。访问这样的变量将返回`null`，`typeof`将返回`'object'`。请注意，这是一种误导：`null`不是对象，而是*Null*类型的原始值（其结果是您无法`null`从构造函数返回 - 您必须抛出错误来表示失败）。

我推荐以下做法：

1.  用于`typeof`检查`undefined`，因为它将涵盖前两种情况。
2.  不要分配`undefined`给*属性*：`delete`用来摆脱它们；请注意，您不能删除*变量*（但还要注意，全局变量实际上是全局对象的属性，因此可以删除）。
3.  用于`null`标记不存在有意义的值（例如，链表的最后一个节点的前向引用），或者如果您想清除变量作为垃圾收集器的提示。

你也可以选择`undefined`3\. 并且永远不要使用`null`。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-07T09:24:56.460

我相信这是同一事物的 JavaScript 定义和萤火虫之间的区别。

未定义只是尚未定义为值的事物的状态。所以它没有类型。

> 还有 var a; 之间的区别是什么？和 var b = 未定义；

```
var a; alert(a); // undefined
a; alert(a); // "Error "a" not defined"
a = undefined; alert(a); // undefined 
```

第二个示例不是有效的 JavaScript 代码，执行将停止。因为这是一个错误。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-12-07T13:09:39.747

```
alert(a);
```

这里`a`没有定义。

```
alert(a);
var a=10;
```

这`a`是未定义的，因为`javascript`引擎将此代码转换为

```
var a;
alert(a); // that's why `a` is defined here 
a=10; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2019-02-20T11:42:30.390

*   未定义 - 未声明和使用实例；
*   undefined - 声明和使用的实例没有它的值。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-06-28T11:21:06.050

> **undefined** : 已声明但未在上面分配值，我们在其他单词中访问它存在但未分配值
> 
> '**未定义**'：这是一个错误，向编码器/程序员/用户表明该变量在范围内不存在。不在范围内声明。

```
var a = 1;
console.log(a) //1

var b;
console.log(b) //undefined

console.log(c) //undefined
var c=2;

console.log(d) //undefined
var d;

e=3
console.log(e) //3
var e;

console.log(f) //Uncaught ReferenceError: f is not defined 
```

> ```
> > Note: the default behavior of javaScript moving declarations to the
> > top
> >So the above code is look like below internally 
> ```

```
var a = 1, b, c, d, e;
console.log(a) //1

console.log(b) //undefined

console.log(c) //undefined
c=2;

console.log(d) //undefined

e=3
console.log(e) //3

console.log(f) //Uncaught ReferenceError: f is not defined 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-08-03T05:11:26.447

**没有定义的：**

变量未声明或初始化。引发参考错误

例子：

```
console.log(newvariable); // results: ReferenceError: newvariable is not defined 
```

**不明确的：**

没有值声明的变量将具有未定义的值。

例子：

```
var newVar;
console.log(newVar); // results: undefined 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-05-16T19:31:19.693

Javascript 内存中不存在未声明的变量，而已声明的变量存在并且可以设置为未定义。

差异是由 Javascript 设计混乱引起的。如果变量的值未定义，则应将其删除。事实上，像 0、""、null 和 undefined 这样的虚假值基本上都是无意义且相同的。很多时间都浪费在他们身上。它们都是虚无和不存在的。拥有不止一种什么都没有，或者甚至允许有一种，这是非常矛盾的。

因此，我认为您应该在完全编程时避免显式使用虚假值。我还没有找到无法通过更好的方法消除它们的情况，并且没有它们编程会更好。

# http-status-code-404 - 我们网站上的多个 404 请求。是攻击还是错误的索引机器人？

> ID：833662
> 
> 赞同：0
> 
> 时间：2009-05-07T09:22:31.597
> 
> 标签：http-status-code-404, webrequest

我们的网站正在接收尝试访问不存在页面的请求。通常只有地址拼写错误的情况。就像正确的链接是/Info/SiteMap.aspx，但错误的请求是/Inf/SiteMap.aspx 缺少'o'。通常有很多请求，例如一分钟内连续 20 个请求。全部抛出 404。

是某个索引机器人的问题吗？或者有人测试我们网站的漏洞吗？

有什么经验或技巧吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T09:25:33.620

是的，请考虑以下事项。

1.  发送请求的主机的 IP 地址 - 如果它们是不同的但有多个 IP，我们可以怀疑它是使用 Zombies 进行的分布式攻击。

2.  . 如果请求来自同一来源，请检查请求之间的延迟。一般来说，爬虫不会在请求之间使用极短的时间间隔。

3.  索引机器人（爬虫）不执行“蛮力”类型的索引。他们只是从一页中检索链接并逐页递归地遍历。所以造成这种情况的原因应该不是分度机器人。

4.  检查任何模式。我的意思是顺序命名模式等。

> 例如：/Inf/SiteMap.aspx、/Infa/SiteMap.aspx、/Infb/SiteMap.aspx

# survey - 您的代码中有多少仍在生产中，您在生产中仍然拥有的最旧代码有多长时间？

> ID：833665
> 
> 赞同：2
> 
> 时间：2009-05-07T09:23:08.710
> 
> 标签：survey

这绝对是主观的，答案必然涉及猜测工作，但认为一些答案可能很有趣。

所以：

您的代码中有多少百分比仍在生产中？（您如何决定“您的”代码是什么 - 取决于您）

和

你知道的最古老的代码有多长时间了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T09:26:38.170

我已经工作了13年

*   3 年可能没有使用（90 年代的 VB 3）
*   6年肯定没用（公司倒闭）
*   1年左右在各个地方写原型

所以我会猜测我的付费时间中**只有不到 25%**的时间是真正发挥作用的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T09:29:16.963

我是一个穿着尿布的小孩，只工作了 3 年。我想说我 90% 的代码仍在生产中运行。我最旧的代码可能运行了 2.5 年

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T09:30:47.333

我在 1998 年左右发送给 IBM 的 CICS C/C++ 标头的 mod 仍然存在。

没有什么特别的，只是在正确的地方放了几个“#IFDEF CPLUSPLUS”宏——但它仍然是代码。

我认为我从 1992 年编写的一些 COBOL 代码仍在运行，但是，我不再认识该站点的任何人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-06T23:33:43.837

> 你知道的最古老的代码有多长时间了？

周末，我遇到了一位老同事（在我们当地的圣诞节选美比赛中的 10,000 人中），他仍在使用我在 1991 年第一份专业工作时帮助编写的软件。所以大约19年！这让我很开心。

它是一个基于 DOS 的应用程序，用 Advanced Revelation 编写，一个[4GL](http://en.wikipedia.org/wiki/Fourth-generation_programming_language)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-14T06:40:29.000

> 您的代码中有多少百分比仍在生产中？

我在 7 年的开发工作中编写了 4 个企业 Web 应用程序，其中 3 个仍然可以日常使用（ASP/SQL/VB.NET/C#）。

> 你知道的最古老的代码有多长时间了？

一个 Web 应用程序是一个 9 岁的实验室使用日历。它完全用 ASP 和 SQL 编写。

# performance - 应该以多快的速度创建动态生成的网页？

> ID：833667
> 
> 赞同：2
> 
> 时间：2009-05-07T09:24:11.657
> 
> 标签：performance, perception

我有许多数据驱动的基于 Web 的应用程序，它们为内部和公共用户提供服务，并且想衡量您期望创建页面的速度（以毫秒为单位）以保持用户满意度和可扩展性。

那么，为了维护一个快速的网站，创建页面的速度有多快？

这些站点是在 ASP 经典中开发的，带有一个 SQL Server 后端，可以生成我使用 XSLT 呈现的 XML 记录集。不是最有效的技术，创建页面需要 7 毫秒到 120 毫秒（即第一行代码和“Response.Write”之间的计时器间隔），具体取决于页面的复杂性。较慢的页面是由于数据库运行更大和更复杂的查询。即使我将所有的 ASP 经典重写为 ASP.NET，整体页面渲染速度也不会有任何显着提高。

我经常听到 Jeff 说他希望 SO 成为[最快的站点](https://blog.stackoverflow.com/2009/02/server-speed-tests/)，并且他的博客已经讨论了他的[代码](http://www.codinghorror.com/blog/archives/001218.html)和数据库的优化，但是您在优化代码方面需要走多远？通过使用 StringBuffer 而不是 String + String 来减少毫秒数是否可以很好地利用我的时间？

**[澄清]**

您从什么时候开始认为“此页面创建时间过长？”。是超过 20 毫秒、超过 200 毫秒还是一个页面可以花费一秒钟的时间来构建？你的“目标时间”是多少？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-07T09:34:23.753

这完全取决于您的受众和目标——我曾在目标“onload”事件<4secs的应用程序以及服务器上的时间预计<1ms的应用程序上工作。它可以采用任何一种方式 - 但无论您做什么，您都需要注意，无论您在服务器端级别进行的任何性能优化，都可能与网络性能（仍然是 Web 的主要瓶颈）和感知加载时间相形见绌。

雅虎对一般网站性能有一些[很好的指导](http://developer.yahoo.com/performance/rules.html)，特别是在感知负载方面。

希望您已经足够聪明，可以缓存您可以缓存的内容并做一些小事情，例如避免大量的 Response.Writes 链......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T09:30:55.150

用户并不关心您准备数据的速度，他们只关心页面的实际加载时间。

如果您在渲染中有很多开销，您的用户将体验到您的网站速度很慢。关于经典的 ASP，字符串连接被认为是非常糟糕的做法，因为当您达到关键字符串长度时它会非常慢，这将开始成为服务器的负担。

使用数组 (jscript) 或 .NET StringBuffer 可以显着改善渲染时间。除了卸载不必要的 CPU 使用，这将允许您的服务器处理更多流量，我想说那些明显的优化是非常值得做的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T09:58:20.093

可以在此处找到有关此主题的非常有趣的截屏视频：[链接文本](http://railsconfeurope.blip.tv/file/1555719/)。

Although it is made by a Rails guy, it is perfectly applicable to other frameworks.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T09:29:18.367

如果您只需更改一件事就可以减少毫秒，那就去做吧！

您可能还想查看缓存数据库请求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T10:18:57.780

One factor that affects user satisfaction to server response time is how often he is requesting a new page. If you're presenting (say) a page with lots of information that the user is going to spend some time to read, a longer "rendering" time is okay. In contrast, if the person is quickly navigating through pages, he will want a near instantaneous response.

For example, if you're on a news site, you probably will be okay if it takes a full second or two for the next page, since you're going to be spending 30 seconds to read it.

On the other hand, if you're browsing through an interactive map, you probably want the response to be less than a second.

# c++ - 递增问题

> ID：833672
> 
> 赞同：3
> 
> 时间：2009-05-07T09:24:56.647
> 
> 标签：c++

> **可能重复：**
> [谁能解释这些未定义的行为（i = i++ + ++i，i = i++ 等……）](https://stackoverflow.com/questions/949433/could-anyone-explain-these-undefined-behaviors-i-i-i-i-i-etc)

我有一个这样声明的变量：

```
int j=0; 
```

当我写：

```
cout<<j++<<" "<<j++<<" "<<j++<<"\n"; 
```

我收到这个输出：

```
2 1 0 
```

我希望收到这个输出：

```
0 1 2 
```

你能解释一下结果吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-07T09:30:29.643

规范说，如果您在同一序列点内多次修改同一变量，则结果为“未定义”。

序列点在 ; （而且 , 是一个序列点，不确定是否还有其他点）。

您正在尝试的与众所周知的琐事问题相同，“第二次分配后 x 的值是多少？”

```
int x;
x = 0;
x = x++; 
```

答案是“未定义”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-07T09:47:09.963

这段代码相当于

```
... operator<<( operator<<( operator<<( operator<<(cout,j++), " " ), j++ ), "\n" ); ... 
```

虽然给出了函数调用的顺序，但没有给出参数评估的顺序。所以不能保证首先评估哪个 j++。对 j 进行了修改，它们之间没有序列点，因此您会看到 Undefined Behaviour 的结果。

**[Edit1]**以前有不准确的地方。operator<<(int) 是 basic_ostream 的成员函数。将 operator<<(int) 表示为 f，将 operator<<(ostream&,const char*) 表示为 g。然后我们有

```
...g(f(j++)," ").f(j++)... 
```

评估顺序仍然可以是：eval(j++) -> eval(j++) ->**序列点**-> 调用(f) ->**序列点**-> 调用(g) ->**序列点**-> 调用(f)。这是因为来自标准 [expr.4] 的以下引用：

> 除非另有说明，单个运算符的操作数和单个表达式的子表达式的计算顺序以及副作用发生的顺序是未指定的

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T09:30:39.253

这是因为您的编译器可能会从右到左评估等式。

查看[此](https://stackoverflow.com/questions/621542/compilers-and-argument-order-of-evaluation-in-c)问题以获取更多信息。

**编辑：** 在 g++ 4.4.0 上测试

```
#include <iostream>

int main (int argc, char **argv) {
int j = 0;
std::cout << j++ << " " << j++ << " " << j++;
return 0;
} 
```

```
[john@awesome]g++ rtl.cpp -o rtl
[约翰@真棒]./rtl
0 1 2
[约翰@真棒]
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-07T09:29:15.310

这令人困惑但很正常，因为此运算符的评估顺序是从右到左。

# sql-server - SQLCMD，命令行变量和脚本：setvar

> ID：833678
> 
> 赞同：20
> 
> 时间：2009-05-07T09:26:36.347
> 
> 标签：sql-server, sql-server-2005, sqlcmd

在运行 SQLCMD.exe 并为脚本变量提供命令行参数时，我希望命令行上提供的值将覆盖 SQL 脚本文件中定义的值。

例如

给定以下 SQL 脚本：

```
:setvar XXX "SQL script"
print '$(XXX)' 
```

和命令行：

```
sqlcmd.exe -S <Server> -d <Database> -E -b -i <Script> -v XXX="Batch script" 
```

我希望输出是：

> 批处理脚本

但是输出是：

> SQL 脚本

这是有意的，还是必须`:setvar`删除 SQL 脚本中的语句？

我在脚本中提供了`:setvar`语句，因此我可以使用 SQLCMD 模式在 SQL Management Studio 中编辑/测试脚本，但在我的测试和生产环境中从命令行运行脚本。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-07T11:01:51.610

这似乎是设计使然；有人已经在 Connect 上提出了更改请求： [http ://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=382007](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=382007)

我能看到的解决该问题的唯一方法是在发布时注释掉（或以其他方式删除）`:setvar`命令。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-02-25T13:10:27.740

我也在为此苦苦挣扎，但我记得我注意到 msdeploy.exe 也能够使用变量执行 sql 脚本。但是，由于某些奇怪的原因，msdeploy.exe 能够从命令行传递变量，命令行中的变量值优先于脚本本身中定义的值。

一个例子：我有一个 sql 脚本 (NavDbSecurity.sql)，它定义了三个参数：

```
:setvar loginName "testLoginName"
:setvar databaseName "testDatabaseName"
:setvar NavCompanyName "blablabla" 
```

当我执行以下 msdeploy 脚本时，我通过命令行传递的参数值优先于脚本文件中定义的值（不要介意没有密码的 sa 用户；））：

```
msdeploy.exe -verb:sync -source:dbfullsql="c:\NavDbSecurity.sql" -dest:dbfullsql="data source=.\sqlexpress;initial catalog=data base;User Id=sa;Password=;",transacted=False -setParam:kind=SqlCommandVariable,scope="NavDbSecurity.sql",match=databaseName,value="[data base]" -setParam:kind=SqlCommandVariable,scope="NavDbSecurity.sql",match=loginName,value="domain\user" -setParam:kind=SqlCommandVariable,scope="NavDbSecurity.sql",match=NavCompanyName,value="testCompany" 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-10-02T11:51:57.327

尝试编辑您的 sqlproj 文件并添加以下属性

```
<CommentOutSetVarDeclarations>true</CommentOutSetVarDeclarations> 
```

生成的 sql 文件会将 setvars 注释掉，然后您可以使用命令行来设置实际值。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-07-18T17:29:46.070

考虑为您的 setvars 使用该`:r filename`命令。

作为一个单独的文件，您可以在您的部署区域中使用相同的文件名，每个部署区域都包含自己的区域特定内容。

```
:r path\sqlConfig.sql 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-29T00:49:02.773

我认为这是故意的。目前 .sql 脚本中的 setvar 语句具有最高优先级。

# c# - 我在 asp.net 2.0 中的会话变量有问题

> ID：833680
> 
> 赞同：2
> 
> 时间：2009-05-07T09:26:38.407
> 
> 标签：c#, asp.net, vb.net, session, back-button

当用户登录时，我保留一个 Session 变量。因此，当用户单击 btnLogout 时，它必须清除我的所有会话并将用户注销好！！！

它确实清除了我的会话，但是如果我在退出后立即单击 IE 中的 BACK 按钮，那么我仍然处于登录状态！这意味着它会回到用户仍然登录的屏幕。

我的登出代码

```
protected void btnLogout_Click
{
   Session.Clear();
   Session.Abandon();
   Session.RemoveAll();

   Response.Redirect("Home.aspx");
} 
```

为什么会这样，我该如何预防？

**编辑：** 代码中是否有一个选项可以让用户无法按下 Web 浏览器中的“返回”按钮？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-08T02:42:37.777

你可以把它放在你主人的 Page_Init 中：

```
Response.Cache.SetNoServerCaching();
Response.Cache.SetCacheability(HttpCacheability.NoCache);
Response.Cache.SetNoStore();
Response.Cache.SetExpires(new DateTime(1900, 01, 01, 00, 00, 00, 00)); 
```

例如，大多数银行网站都会这样做，因此您无法有效地使用后退按钮。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T10:24:32.183

这真的是一个问题吗？是的，他们可以看到他们的前一页已被缓存，但是一旦他们尝试在此上下文中发出任何其他合法请求，这些请求就会失败，因为您的会话变量已经消失。

除非你有一些非常具体的理由来围绕这个进行编码，否则你将解决一个实际上并不存在的问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T09:35:37.590

有几种方法可以告诉浏览器不要从代码隐藏、javascript 或通过 HTML 缓存页面，方法是在页面上使用以下内容

```
<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE"> 
```

在代码隐藏的代码中添加 page_load 事件以确保会话变量仍然实际存在也是一种很好的做法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T09:30:20.580

浏览器维护页面的缓存，因此简单地回击不会向服务器发出请求以查看您是否仍然登录。您必须使用 HTTPS 来确保缓存也受到保护。

# asp.net-mvc - 在领域驱动设计的上下文中，我在哪里可以找到有关身份验证和授权的信息？

> ID：833682
> 
> 赞同：2
> 
> 时间：2009-05-07T09:27:29.887
> 
> 标签：asp.net-mvc, refactoring, domain-driven-design, data-modeling, separation-of-concerns

我正在尝试以 DDD（域驱动设计）的方式做事。男孩，我挣扎。在我读过的所有书中，身份验证都是无关紧要的，也没有提到！

我编写了自己的身份验证和会员服务，负责注册和登录用户、创建加盐密码等。我不使用 .NET 的会员提供程序，但确实依赖表单身份验证。

我已经实现了一个包含用户名、电子邮件、密码哈希、批准状态等的用户模型。

现在我想域模型的其余部分不应该与用户相关。我有一个 Person 类，用于对 Person 及其相关数据进行建模。因此，它可用于对来自用户和非用户的个人数据进行建模。Company 类型的对象与 Persons 一起使用，而不是与 Users 一起使用。一个活动被分配给一个人，而不是一个用户。

问题是，我如何将 Person 模型与 User 模型联系起来？我真的不想在两个模型中的任何一个中相互引用。我是否应该创建一些名为 PersonUser 的关系模型并创建一个额外的服务来检索当前经过身份验证的用户的人员对象？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T12:46:36.210

从您介绍的内容来看，您有几个已知的事实：

1.  每个用户都是一个人
2.  不是每个人都是用户

在这种情况下，我将扩展 person 模型以包含一个可为空的 UserId 字段，以便您可以将 User 与那些也是用户的 Person 关联起来。

现在我还将假设您在人员模型中有几个“获取”方法..通过 ID、姓名、部门等检索人员......

我将重载（或创建不同的）获取方法以也从用户中检索人员对象（这可以是 id 或 foll 用户对象）。

```
public IPerson Fetch(IUser user) {} 
```

当然，既然你知道每个用户也是一个人，我个人认为将用户对象扩展为包含一个人属性并没有什么坏处或犯规......

```
public interface IUser 
{
   ...
   IPerson Person { get; set; }
} 
```

然后，您可以像往常一样返回用户对象......也许对用户中的人员字段进行一些时髦的延迟加载......或者在您获取用户对象时填充两者。

我不确定创建 User <-> Person 的“映射”表是否会给您带来超出我上面概述的任何东西（尽管您会从核心 DBA 那里获得非规范化数据的荣誉）..对我来说，这只是一个额外的表格，可以加入以获得相同的效果。

# c# - 返回值以表示无效值

> ID：833683
> 
> 赞同：1
> 
> 时间：2009-05-07T09:28:27.810
> 
> 标签：c#

假设您有一个返回枚举的函数：

```
public enum ServerStatus
{
    Down,
    Up
}

private ServerStatus GetServerStatus(int time)
{
    if (time >= 0 && time < 12)
    {
        return ServerStatus.Down;
    }
    else if (time >= 12 && time <= 23)
    {
        return ServerStatus.Up;
    }
    else
    {
        return ?? // Server status is neither Up nor Down
    } 
} 
```

我是不是该：

1.  将“既不”添加到 ServerStatus
2.  使 GetServerStatus 返回 ServerStatus？并返回 null
3.  返回另一个布尔值，指示该值是否有意义

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-07T09:31:27.503

如果这种情况在实践中永远不会发生，并且您不希望产生除“Up”和“Down”之外的其他内容，那么您应该抛出异常。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T09:55:15.403

如果您不想抛出异常，那么您总是可以有一个 Unknown 枚举值。例如，服务器状态可以是 Up、Down 或 Unknown。未知状态在某些情况下可能有效（例如，如果您无法连接到服务器）。这个未知值可以像布尔值一样进行测试，以确定答案是否有意义（如果合适）。

我并不是说这比 ArgumentOutOfRangeException 更好，只是说这是处理问题的另一种方式。您的调用代码总是会根据其他条件抛出异常。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T10:01:29.413

```
private ServerStatus GetSeverStatus(int time)
{
    if (time >= 0 && time < 12)
    {
        return ServerStatus.Down;
    }

    if (time >= 12 && time <= 23)
    {
        return ServerStatus.Up;
    }

    throw new ArgumentOutOfRangeException();
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T11:06:28.383

这是“我如何强制执行我的功能先决条件”的案例。你有几种方法可以做到这一点。

我真正欣赏的一种方法是：拥有一个非常简单的“按合同编程”功能来处理纯业务逻辑：断言有效的前提条件。*在此之上构建一个“安全”功能，以*确保输入有效。

```
// with a 'validity' return type
public Pair<bool,ServerStatus> checkedGetServerStatus( uint time ) {
   Pair<bool,ServerStatus> p;
   p.first = false;
   if( time > 23 ) return p;

   p.first = true;
   p.second = GetServerStatus( (int)time );
   return p;
}

// or with an exception
public ServerStatus GetServerStatusEx( uint time ) {
   if( time > 23 ) throw InvalidArgumentException(time);

   return GetServerStatus( (int)time );
} 
```

另一种可能更好的方法是将提供的函数参数类型更改为不会出错的类型。

```
class ServerTime {
    public ServerTime( uint hours ) { seconds = (hours%24)*3600; }
    private uint seconds;
}

public ServerStatus GetServerStatus( ServerTime time ) {
...
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T10:19:06.250

我的想法是这样的：

如果是例外情况（10,000 次调用中的 1 次，每年一次？）或不可恢复的错误，则引发异常。

如果“未知”情况不是例外或者是可恢复的错误，我将使用“未知”值。那么问题就变成了您是添加第三个值还是使用可空类型？

如果很有可能，则添加第三种状态“未知”或“无法获得”。

如果不太可能，则使用可空类型。

无论您使用哪种解决方案，您都可能需要某种方式来找出您无法确定服务器状态的确切原因 - 可能没有连接、用户凭据可能无效、连接可能太多等 - 以确定是否立即重试，延迟一段时间后重试或简单地中止。

# php - 在 PHP 中存储文件结构

> ID：833685
> 
> 赞同：0
> 
> 时间：2009-05-07T09:28:30.460
> 
> 标签：php, mysql, file, structure

存储文件结构以及文件（例如 Zip 文件）的最佳方式是什么？目前每个文件都是 MySQL 数据库中的一行，但显然无法从中读取结构。我想避免存储二进制文件。所有文件都应该是纯文本。每个 zip/文件结构对于提交它的用户都是私有的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T09:33:01.010

如果你想要结构，你可以有一个目录表和一个文件表。然后对于根目录中的每个目录，其父 id 为 0。然后，该目录下的每个目录都具有其父级的父 id。

然后你给文件目录 id 来指明它们的位置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T20:34:54.537

我的建议与 Ólafur Waage 的建议类似，但我会使用一个表，其中包含指示符列来表示记录的“类型”。

```
id - Primary Key
parent_id - FK to self (id)
type - enum('D', 'F')
name - varchar
content - BLOB (if you wanted to ever store the file contents). 
```

这遵循分层树结构，对于 MySQL，您可以在此处找到更多信息：http: [//mikehillyer.com/articles/managing-hierarchical-data-in-mysql/](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T09:59:38.310

最简单的方法（也许不是最好的）是确定您所追求的目录树的“根”文件夹，然后在每个文件上获取相对于该文件夹的路径并将其存储为数据库中的另一列（例如“路径”）桌子。您稍后可以查看这些值来构建相同的目录结构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T10:02:35.463

*最好*是上下文相关的。但从表面上看，我会说存储文件结构的最佳方式是在文件系统中。除非您需要将条目与其他记录链接在一起或以其他方式查询它们，否则关系数据库并不是任意分层数据的最佳选择。您还可以使用混合解决方案，在数据库中保留索引、文件路径和一些元数据，但仍将其存储在文件系统中。

# javascript - clientHeight/clientWidth 在不同的浏览器上返回不同的值

> ID：833699
> 
> 赞同：24
> 
> 时间：2009-05-07T09:30:54.183
> 
> 标签：javascript, css, firefox, internet-explorer-8, internet-explorer-7

在 IE7、IE8 和 Firefox 上的属性`document.body.clientHeight`和返回值不同：`document.body.clientWidth`

即 8：

```
document.body.clientHeight : 704 
document.body.clientWidth  : 1148 
```

即 7：

```
document.body.clientHeight : 704 
document.body.clientWidth  : 1132 
```

火狐：

```
document.body.clientHeight : 620 
document.body.clientWidth  : 1152 
```

为什么会存在这种差异？
在不使用 jQuery 的情况下，是否存在跨不同浏览器（IE8、IE7、Firefox）一致的等效属性？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-09-15T21:47:40.583

Paul A 关于为什么存在差异是正确的，但 Ngm 提供的解决方案是错误的（在 JQuery 的意义上）。

jquery（1.3）中clientHeight和clientWidth的等价物是

```
$(window).width(), $(window).height() 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-07T09:33:03.227

这与浏览器的盒子模型有关。使用 jQuery 或其他 JavaScript 抽象库之类的东西来规范化 DOM 模型。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-08-03T09:46:37.687

**body**元素采用可用宽度，通常是您的浏览器视口。因此，由于浏览器 chrome 边框、滚动条、菜单占用的垂直空间等等，跨浏览器的尺寸将不同......

高度也不同的事实也告诉我你通过 css 将**body/html**高度设置为 100%，因为高度通常取决于**body**内的元素..

**除非您通过 css 或它的 style 属性将body**元素的宽度设置为固定值，否则它的尺寸通常会因浏览器/版本而异，甚至可能取决于您为浏览器安装的插件。在这种情况下，常量值更像是规则的一个例外......

当您在其他不采用浏览器视口自动宽度的元素上调用 .clientWidth 时，它将始终返回元素“宽度”+“填充”。因此，宽度为 200 且填充为 20 的 div 将具有 clientWidth = 240（左右填充 20）。

然而，调用 clientWidth 的主要原因正是由于结果可能存在预期差异。如果你知道你会得到一个恒定的宽度并且值是已知的，那么调用 clientWidth 是多余的......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-25T13:03:06.750

jQuery中offsetHeight和offsetWidth的等价物是$(window).width()，$(window).height()不是clientHeight和clientWidth

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-03-19T01:57:11.720

`Element.clientWidth`&`Element.clientHeight` 返回该元素内容的高度/宽度以及任何适用的填充。

这些的 jQuery 实现是： [`$(target).outerWidth()`](http://api.jquery.com/outerwidth/)&[`$(target).outerHeight()`](http://api.jquery.com/outerHeight/)

`.clientWidth`&`.clientHeight`包含在 CSSOM 视图模块规范中，该规范目前处于工作草案阶段。尽管现代浏览器对此规范有一致的实现，但为了确保跨旧平台的一致性能，仍应使用 jQuery 实现。

附加信息：

*   https://developer.mozilla[dot]org/en-US/docs/Web/API/Element.clientWidth
*   https://developer.mozilla[dot]org/en-US/docs/Web/API/Element.clientHeight

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-02-10T19:17:50.920

我解决clientHeight问题的方法是使用控件firstChild的clientHight。我使用 IE 11 打印数据库中的标签，并且在 IE 8 中工作的 clientHeight 在 IE 11 中返回 0 的高度。我在该控件中找到了一个属性，该属性被列为 firstChild 并且如果 clientHeight 具有属性并且实际上有我正在寻找的高度。因此，如果您的控件返回的 clientSize 为 0，请查看其 firstChild 的属性。它帮助了我...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-07T09:36:54.637

这可能是由 IE 的盒子模型错误引起的。要解决此问题，您可以使用[Box Model Hack](http://en.wikipedia.org/wiki/Internet_Explorer_box_model_bug)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-07-04T14:59:43.123

我有一个类似的问题 - firefox 返回了 obj.clientHeight 的正确值，但即没有 - 它返回 0。我将其更改为 obj.offsetHeight 并且它有效。似乎有一些状态，即客户端高度 - 这使它变得不确定......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-09-15T05:36:00.310

浏览器窗口的更多信息： [http ://www.w3schools.com/js/js_window.asp?output=print](http://www.w3schools.com/js/js_window.asp?output=print)

# prototypejs - 如何使用 Prototype.js 获取浏览器窗口的大小？

> ID：833708
> 
> 赞同：12
> 
> 时间：2009-05-07T09:32:40.107
> 
> 标签：prototypejs

如何使用 Prototype.js 版本 1.6.0.3 获取浏览器窗口的大小？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-05-07T09:52:18.720

根据原型 API[文档](http://www.prototypejs.org/api/document/viewport)：

```
var viewport = document.viewport.getDimensions(); // Gets the viewport as an object literal
var width = viewport.width; // Usable window width
var height = viewport.height; // Usable window height 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-09-21T21:24:54.637

和相同的想法但更紧凑：

```
var WindowSize = Class.create({
    width: window.innerWidth || (window.document.documentElement.clientWidth || window.document.body.clientWidth),
    height: window.innerHeight || (window.document.documentElement.clientHeight || window.document.body.clientHeight)
}); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-07T10:22:18.427

这是我的解决方案，它提供与 Firefox 中的 Web Developer 工具栏相同的值。

```
var WindowSize = Class.create({
    width: function()
    {
        var myWidth = 0;
        if (typeof(window.innerWidth) == 'number')
        {
            //Non-IE
            myWidth = window.innerWidth;
        }
        else if (document.documentElement && document.documentElement.clientWidth)
        {
            //IE 6+ in 'standards compliant mode'
            myWidth = document.documentElement.clientWidth;
        }
        else if (document.body && document.body.clientWidth)
        {
            //IE 4 compatible
            myWidth = document.body.clientWidth;
        }
        return myWidth;
    },
    height: function()
    {
        var myHeight = 0;
        if (typeof(window.innerHeight) == 'number')
        {
            //Non-IE
            myHeight = window.innerHeight;
        }
        else if (document.documentElement && document.documentElement.clientHeight)
        {
            //IE 6+ in 'standards compliant mode'
            myHeight = document.documentElement.clientHeight;
        }
        else if (document.body && document.body.clientHeight)
        {
            //IE 4 compatible
            myHeight = document.body.clientHeight;
        }
        return myHeight;
    }
}); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-03-18T10:56:39.737

这适用于所有现代浏览器和 ie6+：

```
var w = document.documentElement.clientWidth;
var h = document.documentElement.clientHeight; 
```

需要正确的 Doctype

# java - 在java中将int的流转换为char

> ID：833709
> 
> 赞同：114
> 
> 时间：2009-05-07T09:32:42.963
> 
> 标签：java, types

这可能已经在其他地方得到了回答，但是您如何获得 int 值的字符值？

具体来说，我正在从 tcp 流中读取 a 并且 reader .read() 方法返回一个 int。

我如何从中得到一个字符？

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2009-05-07T10:05:48.000

也许你在问：

```
Character.toChars(65) // returns ['A'] 
```

更多信息：[`Character.toChars(int codePoint)`](http://docs.oracle.com/javase/8/docs/api/java/lang/Character.html#toChars-int-)

> 将指定字符（Unicode 代码点）转换为存储在 char 数组中的 UTF-16 表示形式。如果指定的代码点是 BMP（基本多语言平面或平面 0）值，则生成的 char 数组具有与 codePoint 相同的值。如果指定的代码点是补充代码点，则生成的 char 数组具有相应的代理对。

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2011-11-09T20:16:46.800

这取决于“将 int 转换为 char”的含义。

如果您只是想将值转换为 int，则可以使用 Java 的类型转换表示法进行转换：

```
int i = 97; // 97 is 'a' in ASCII
char c = (char) i; // c is now 'a' 
```

如果您的意思是将整数 1 转换为字符 '1'，您可以这样做：

```
if (i >= 0 && i <= 9) {
char c = Character.forDigit(i, 10);
....
} 
```

* * *

## 回答 #3

> 赞同：73
> 
> 时间：2009-05-07T09:48:34.187

如果您尝试将流转换为文本，则需要知道要使用哪种编码。然后，您可以将一个字节数组传递给[`String`](http://java.sun.com/javase/6/docs/api/java/lang/String.html)构造函数并提供 a [`Charset`](http://java.sun.com/javase/6/docs/api/java/nio/charset/Charset.html)，或者使用[`InputStreamReader`](http://java.sun.com/javase/6/docs/api/java/io/InputStreamReader.html)适当的`Charset`代替。

仅当您需要 ISO-8859-1 时，如果您直接从流中读取字节，只需从`int`to转换即可。`char`

编辑：如果您*已经*在使用 a `Reader`，那么将返回值转换为`read()`to`char`是正确的方法（在检查它是否为 -1 之后）......但调用`read(char[], int, int)`来读取整个块通常更有效和方便一次文本。不过不要忘记检查返回值，看看已经读取了多少个字符。

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2012-09-18T20:07:13.940

如果您想简单地将 int 5 转换为 char '5'：（仅适用于整数 0 - 9）

```
int i = 5;
char c = (char) ('0' + i); // c is now '5'; 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-05-07T09:34:38.900

简单铸造：

```
int a = 99;
char c = (char) a; 
```

有什么理由不适合你吗？

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-03-04T19:12:44.940

此解决方案适用于整数长度大小 =1。

`Integer input = 9; Character.valueOf((char) input.toString().charAt(0))`

如果 size >1 我们需要使用 for 循环并迭代。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-07-23T12:10:58.200

这里的大多数答案都提出了捷径，如果您不知道自己在做什么，这可能会给您带来大问题。如果你想走捷径，那么你必须确切地知道你的数据的编码是什么。

# UTF-16

每当 java 在其文档中谈论字符时，它都会谈论 16 位字符。

**您可以使用 a `DataInputStream`，它有方便的方法。为了提高效率，将其包装在`BufferedReader`.**

```
// e.g. for sockets
DataInputStream in = new DataInputStream(new BufferedInputStream(socket.getInputStream()));
char character = readChar(); // no need to cast 
```

问题是每个`readChar()`实际上都会执行 2`read`并将它们组合成一个 16 位字符。

# 美国ASCII

US-ASCII 保留 8 位来编码 1 个字符。ASCII 表只描述了 128 个可能的字符，所以 1 位始终未使用。

**在这种情况下，您可以简单地执行强制转换。**

```
int input = stream.read();
if (input < 0) throw new EOFException();
char character = (char) input; 
```

# 扩展的 ASCII

UTF-8、Latin-1、ANSI 和许多其他编码都使用 8 位。前 7 位遵循 ASCII 表，与 US-ASCII 编码的相同。但是，第 8 位提供的字符在所有这些编码中都不同。所以，这里的事情变得有趣了。

**如果您是牛仔，并且您认为第 8 位无关紧要（即您不关心诸如“à、é、ç、è、ô ... 之类的字符），那么您可以使用简单的演员阵容。**

但是，如果您想专业地执行此操作，则在导入/导出文本（例如套接字、文件...）时，您应该始终指定一个字符集。

# 始终使用字符集

让我们认真一点。以上所有选项都是廉价的技巧。如果您想编写灵活的软件，您需要支持可配置的字符集来导入/导出数据。这是一个通用的解决方案：

使用缓冲区读取数据并**使用 charset 参数**`byte[]`将其转换为。`String`

 **```
byte[] buffer = new byte[1024];
int nrOfBytes = stream.read(buffer);
String result = new String(buffer, nrOfBytes, charset); 
```

您还可以使用可以使用`InputStreamReader`charset 参数实例化的 an。

*还有一条黄金法则：永远不要直接将字节转换为字符。这总是一个错误。*

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-08-27T01:05:00.173

基于我的回答假设用户只是想将 an 转换`int`为`char`，例如

```
Input: 
int i = 5; 
Output:
char c = '5' 
```

上面已经回答了这个问题，但是如果是整数值`i > 10`，则需要使用`char array`.

```
char[] c = String.valueOf(i).toCharArray(); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-12-28T18:09:12.210

```
 int i = 7;
    char number = Integer.toString(i).charAt(0);
    System.out.println(number); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-07T20:11:22.287

这完全取决于传入数据的编码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-01-17T11:24:29.160

也许不是最快的：

```
//for example there is an integer with the value of 5:
int i = 5;

//getting the char '5' out of it:
char c = String.format("%s",i).charAt(0); 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2013-02-05T05:40:10.507

将 char 转换为 int 或 long 的答案是简单的转换。

例如：- 如果您想将 Char '0' 转换为 long。

跟随简单演员表

```
Char ch='0';
String convertedChar= Character.toString(ch);  //Convert Char to String.
Long finalLongValue=Long.parseLong(convertedChar); 
```

完毕！！

# python - 在 Python CGI 中返回 http 状态码

> ID：833715
> 
> 赞同：16
> 
> 时间：2009-05-07T09:33:26.360
> 
> 标签：python, http, cgi

是否可以通过python cgi脚本发送200以外的状态码（如301重定向）

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-07T09:35:43.033

通过cgi脚本？

```
print "Status:301\nLocation: http://www.google.com" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T11:27:24.713

通过wsgi应用程序？

```
def simple_app(environ, start_response):
    status = '301 Moved Permanently' # HTTP Status
    headers = [('Location','http://example.com')] # HTTP Headers
    start_response(status, headers)

    return [] 
```

# c# - C# + DirectShow.NET = 简单的网络摄像头访问？

> ID：833724
> 
> 赞同：6
> 
> 时间：2009-05-07T09:34:27.747
> 
> 标签：c#, directshow, webcam, directshow.net

我找到了一个在 C# 中访问网络摄像头的[示例](http://blogs.msdn.com/markhsch/archive/2007/11/19/c-webcam-user-control-source.aspx)。该示例使用[DirectShow.NET](http://directshownet.sourceforge.net/)库。我试图理解代码，但到目前为止，我唯一能弄清楚的是用户控件以某种方式调用 directshow 以直接绘制到用户控件的表面。

我想访问每个帧并将其放入 Bitmap 对象中。如何判断新框架何时到达？如何将此新帧捕获到位图对象中？

如果您熟悉 DirectShow.NET，这可能很容易回答。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T10:00:52.130

您将需要使用[ISampleGrabber](http://msdn.microsoft.com/en-us/library/dd376984(VS.85).aspx)接口，网上有很多关于如何使用它的 c++ 示例，它会为您提供 RGB 原始格式的数据，您可以将其输入 Bitmap 类。

还有一个名为[Touchless](http://www.codeplex.com/touchless)的开源库，它有一个代码项目，该项目采用网络摄像头并在每次新帧到达时给您一个回调。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-11-09T03:49:53.297

一定要看看这篇文章 - [http://www.codeproject.com/Articles/125478/Versatile-WebCam-C-library](http://www.codeproject.com/Articles/125478/Versatile-WebCam-C-library)；它基于 Touchless WebCam 捕获组件（但没有 Touchless SDK 的其他部分）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-15T07:56:59.980

如果您发现 Touchless 有用，但想使用最新的 DirectX SDK，请尝试在[http://touchless.codeplex.com/SourceControl/ListDownloadableCommits.aspx更改 31008 后获取最新源](http://touchless.codeplex.com/SourceControl/ListDownloadableCommits.aspx)

# c# - C# 中的内置 AOP - 正在开发中吗？

> ID：833729
> 
> 赞同：29
> 
> 时间：2009-05-07T09:36:22.470
> 
> 标签：c#, .net, aop

在大型应用程序中，我发现自己真的希望我有内置的 AOP 工具。在 C# 中，你能做的最好的事情就是工厂和 RealProxys、PostSharp、ICorDebug、ICorProfiler 或注入框架。没有干净的内置方式来执行 AOP。

是否有任何迹象（博客文章/内部讨论）表明 AOP 正在进行中？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-07T10:54:47.507

Romain 的回答（几乎 :) 完美地涵盖了当前的解决方案。至于未来的支持，[Anders Hejlsberg](http://www.microsoft.com/presspass/exec/techfellow/hejlsberg/default.mspx)此前[曾表示](http://almaer.com/blog/anders-hejlsberg-and-aop)他们对 AOP 处于观望状态。

我们只能希望通过 csc 的托管重写和“编译器即服务”，可以插入编译器，并在那里注入方面。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-07T10:36:48.643

我还没有听说过“干净的内置 AOP 方式”。但正如您所说，已经有很多“干净的 AOP 方法”，使用成熟而强大的框架，如[PostSharp](http://www.postsharp.org)或[Castle DynamicProxy](http://www.castleproject.org/dynamicproxy/index.html)。

使用 BCL 进行 AOP 的一种明显方法是使用 .NET Remoting 堆栈中的透明且真实的代理，这种方法具有很强的局限性。

另一种方法是依靠 System.Reflection.Emit 来动态生成代理，比如，嗯，来自 Castle 的 DynamicProxy。

最后，还有另一个微软官方标记的解决方案，随[企业库](http://msdn.microsoft.com/en-us/library/cc467894.aspx)一起提供。我说的是[策略注入应用程序块](http://msdn.microsoft.com/en-us/library/dd139982.aspx)。[Unity](http://msdn.microsoft.com/en-us/library/dd139982.aspx)还提供了一些利用 PIAB 的拦截功能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T22:44:40.360

Spring.NET 也提供了 AOP。它需要大量配置，但一旦设置好，它就可以正常工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T18:00:20.527

Delphi Prism 的 5 月版本在语言级别支持 AOP。

你可以在这里找到更多关于它的信息

[http://prismwiki.codegear.com/en/Cirrus](http://prismwiki.codegear.com/en/Cirrus)

此位置还有一个方面的开源库

[http://code.remobjects.com/p/prismaspects/](http://code.remobjects.com/p/prismaspects/)

# build-process - 与多个项目/语言/环境的持续集成

> ID：833733
> 
> 赞同：2
> 
> 时间：2009-05-07T09:37:37.957
> 
> 标签：build-process, continuous-integration, hudson

我想在我这里设置一个 CI 服务器（Hudson），并且已经设置了一个测试环境，我可以在其中构建我们的一些项目。现在我在做 .NET 和 Java，但是还有一些其他的语言出现了。

一个项目确实需要一个特殊的环境（第 3 方软件、编译器、Linux 作为操作系统），我想知道是否有人可以给我一个关于如何做到这一点的建议。

*   我应该只为这个项目运行另一个 Hudson 吗？我想在备用的 Windows 机器上使用 Hudson，而不是在 Linux 上。在 Linux 机器上构建 .NET 对我来说听起来很复杂...... ;-)
*   有没有办法进行“构建机器设置”，Hudson 可以将这个项目委托给另一台仅用于构建这个单一项目的机器？
*   还是我应该完全停止考虑这个问题，让一个项目继续进行而不进行持续集成？（可能是最简单但最糟糕的选择，因为我想在我的 Hudson 中运行 Checkstyle/StyleCop 功能来检查代码约定等......）[

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T09:53:28.887

检查[使用 hudson 的分布式构建](http://wiki.hudson-ci.org/display/HUDSON/Distributed+builds)以及[如何为 .NET 项目设置 hudson](http://redsolo.blogspot.com/2008/04/guide-to-building-net-projects-using.html)

# sql-server-2005 - 为什么我不能在 sql server 2005 中使用 drop procedure 语句从不同的模式中删除过程

> ID：833739
> 
> 赞同：0
> 
> 时间：2009-05-07T09:47:13.113
> 
> 标签：sql-server-2005, sql-server-2008, schema

就这么简单：

```
 drop procedure schemaName.procName 
```

获取以下错误消息：

消息 3701，级别 11，状态 5，第 2 行无法删除过程“procName”，因为它不存在或您没有权限。编辑：我也尝试使用基于 Sql 的身份验证 - 仍然不起作用

奇怪的是，我能够通过 GUI 删除该过程。

我确实有权限 - 我以系统管理员身份使用 Windows 身份验证运行

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-28T01:40:10.460

It is really hard to offer ideas to you about why this would be acting like this. What you can do is open SQL Profiler, and create a Trace on the SQL:StmtStarting/BatchStarting, RPC:Starting, and SP:Starting,StmtStarting events and actually capture the drop being issued by SQL Server Management studio through the UI and then compare that to the DDL that you are trying to manually write. At least then you will know exactly how SSMS is doing the drop.

# c# - 通过代码更改 selectedindex 时，Combobox 中的文本未突出显示

> ID：833740
> 
> 赞同：0
> 
> 时间：2009-05-07T09:47:34.003
> 
> 标签：c#, .net, controls, combobox

我正在使用包含三个值-NSW、TIC、VIA 的组合框。在页面加载中为 combobx 设置 selectedindex = 1 ，显示为 TIC 的值是正确的，但它没有被突出显示。我可以看到，当用户选择不同的值（我的意思是从 UI 中组合框的索引得到更改）时，特定的文本会突出显示，但是当我们通过编程方式更改索引时（c# 代码）不会发生这种情况。ComboboxStyle 是 DropDown。有人可以让我知道可能是原因吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-05T06:20:26.197

确保组合框 tabstop 属性设置为 true。否则，您将看不到选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T10:09:55.010

设置所选索引后，您的组合框不会获得焦点。使用 Focus() 方法设置焦点。

# jquery - 用 jquery 加载 html 页面并从中选择元素

> ID：833742
> 
> 赞同：0
> 
> 时间：2009-05-07T09:47:45.233
> 
> 标签：jquery, html, append, selector

我在从以前加载的 html 页面中选择元素时遇到问题

如果我使用此代码，则最后一个也被指定为 dom-tree 中的最后一个，而不是我刚刚插入的那个

```
$("div.wrapper:last").after('<div class="wrapper"></div>'); 
    $('.wrapper:last').load('tbnote.html .pane');
    $(".pane:last").prepend("testmessage"); 
```

我能做什么，让它工作，因为我也需要设置隐藏字段值和数据库表的主键值

如果不可能，那么在已经设置了 hiddenfieldvalues 的情况下获取 div 中的内容的替代方法是什么？

在此先感谢，理查德

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T10:08:21.970

尝试这个：

```
$('.wrapper:last').load('tbnote.html .pane', function() {
   $(".pane:last").prepend("testmessage");}); 
```

我不确定您实际上想要实现什么，但是 jQuery 新手开发人员的一个常见错误是认为 ajax 函数会立即执行。相反，远程 html 的加载将异步发生，您需要使用可选的回调函数。

# java - 在 Java 中读取 tcp 流的最有效方法

> ID：833744
> 
> 赞同：1
> 
> 时间：2009-05-07T09:48:15.000
> 
> 标签：java, tcp

我不得不修改一些客户端代码，因为没有正确定义通信协议。

我假设来自服务器的 tcp 消息将在新行中终止，所以我使用 reader.readLine() 来读取我的数据。

现在有人告诉我，情况并非如此，而是消息的前 4 个字符是消息长度，然后我必须阅读消息的其余部分。

最有效的明智方法是什么？

我的总体思路如下：

1.  创建一个 4 字符数组
2.  读入前 4 个字符
3.  确定消息长度是多少
4.  创建一个新的消息长度数组
5.  读入新数组。

这是代码示例（阅读器是在其他地方创建的 BufferedReader）：

```
char[] chars = new char[4];
int charCount = reader.read(chars);
String messageLengthString = new String(chars);
int messageLength = Integer.parseInt(messageLengthString);
chars = new char[messageLength];
charCount = reader.read(chars);
if (charCount != messageLength)
{
    // Something went wrong...
} 
```

我知道该怎么做，但是我是否必须担心字符缓冲区没有被填充？如果是这样，我应该如何处理这种情况？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T09:52:33.740

Java 中的字符用于*文本*数据。您确定协议*真的*以这种方式定义了消息的长度吗？更有可能是前四个*字节*表示 32 位长度。

如果您正在与 C 或 C++ 开发人员交谈，他们可能会使用“char”作为“byte”的同义词。

编辑：好的，根据评论：

我会创建一个方法，它接受`Reader`一个计数并重复调用`read()`，直到它读取了正确数量的数据，或者引发了异常。像这样的东西：

```
public static String readFully(Reader reader, int length) throws IOException
{
    char[] buffer = new char[length];
    int totalRead = 0;
    while (totalRead < length)
    {
        int read = reader.read(buffer, totalRead, length-totalRead);
        if (read == -1)
        {
            throw new IOException("Insufficient data");
        }
        totalRead += read;
    }
    return new String(buffer);
} 
```

那么你的代码可以是：

```
String lengthText = readFully(reader, 4);
int length = Integer.parseInt(lengthText);
String data = readFully(reader, length);
// Use data now 
```

您应该检查当他们想要发送少于 1000（或多于 9999）个字符时会发生什么......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T10:04:27.893

关于问题的一部分，一旦确定这是什么，就需要阅读一定数量的字符，以下成语在 java.io.Readers 中很常见：

```
int lengthToRead = getRequiredReadLength(); // Left as exercise to reader :-)
char[] content = new char[lengthToRead]
int from = 0;
while (lengthToRead > 0)
{
   try
   {
      int nRead = reader.read(context, from, lengthToRead);
      if (nRead == -1)
      {
         // End of stream reached before expected number of characters
         // read so handle this appropriately - probably throw an exception
      }
      lengthToRead -= nRead;
      from += nRead;
   }
   catch (IOException e)
   {
      // Handle exception
   }
} 
```

由于`read`调用保证返回非零结果（调用阻塞，直到*某些*数据可用，到达流的末尾（返回 -1）或抛出异常）这个 while 循环确保您将读取尽可能多的只要流可以提供您需要的字符。

一般而言，每当从 Reader 一次请求多个字符时，应注意不能保证实际提供了许多字符，并且应始终检查返回值以查看发生了什么。否则，您将不可避免地在某些时候遇到错误，您的部分流“消失”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T09:55:33.203

呃......对于 Unicode，Java 中的 a 不是`char`16 位吗？我不认为你在做正确的事情，使用字符来表示来自网络的字节。您可能应该考虑使用类似包中`[ByteBuffer](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/ByteBuffer.html)`的东西`java.nio`。

如果您知道单个消息的最大大小，则不会阻止您创建单个缓冲区，将四个字节读入缓冲区，将它们解析成一个`int`左右，然后使用该大小进行新的读取，覆盖缓冲区的内容.

**更新：**以上假设协议是二进制的，并且使用的`char`是“C-ism”。如果协议实际上是文本，并且最初的 4 字符长度是填充整数（在某些基础上，我猜是 10？），例如“0047”或“6212”，那么其他一些方法可能更好，没有从字节到字符。

# xml - 我应该使用 XML 元素的位置来确定它们的顺序吗？

> ID：833749
> 
> 赞同：2
> 
> 时间：2009-05-07T09:52:14.757
> 
> 标签：xml

假设我有一段 XML

```
<Items>
  <SubItem Name="Banana">
  <SubItem Name="Apple">
<Items> 
```

说香蕉先于苹果有道理吗？我知道它在语法上 - 但在语义上。

或者我是否需要包含一些排序属性：

```
<Items>
  <SubItem Name="Banana" Index="0">
  <SubItem Name="Apple" Index="1">
<Items> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T09:56:23.857

XML（实际上是 XPath）中有一种叫做[“文档顺序”](http://www.w3.org/TR/xpath#dt-document-order)的东西。所以是的，文件顺序是您可以依赖的有效东西。

只有当文档发生变化时它才能改变。*除非您不能保证文档是以正确的顺序构建*的，否则不需要“排序属性” 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T09:59:21.417

是的，您通常可以依赖文档中元素的顺序。XML 处理工具在转换和解析文档时*应该尊重它。*检查一下可能仍然是个好主意。

请注意，顺便说一句，标准不保证*属性顺序*（元素内属性的顺序）。

# java - 可重用的条件/表达式类

> ID：833754
> 
> 赞同：6
> 
> 时间：2009-05-07T09:53:11.120
> 
> 标签：java, expression, functor

我曾多次需要一些类来表示和操作条件（通常在 UI 中，因此用户通过组合不同的条件类型来构建查询，然后代码可以根据要查询的底层系统进行转换，例如 lucene 和D b）。我到处搜索一组可重用的类，我确信这必须在许多现有的地方使用（所有初学者的表达式语言），但找不到任何容易使用的东西。我最终自己编写了两次代码，但对不重用我确定存在的东西感到很遗憾。

典型需求是： - 多个运算符：and or 等​​ - 可变数量的操作数 - 组合条件以构建表达式 - 表达式的序列化 - 解析/格式化来自/到字符串的表达式

有人发现过类似的东西吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T01:41:57.130

听起来您可能正在寻找[Functor](http://en.wikipedia.org/wiki/Function_object)（又名函数对象）。如果是这样，这个[SO 问题](https://stackoverflow.com/questions/651541/best-java-functor-lib-jga-commons-functor-mango-or)将是相关的，wrt。选择：Commons functor（已经提到）是一种选择，但也有其他选择。

所有仿函数库都带有框架（非常简单；一元、二元谓词、这些谓词的映射功能、通过链接组合）和最常用的基本函数集。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T12:16:58.497

这听起来像您正在寻找类似[Hibernate Criteria API](https://www.hibernate.org/hib_docs/v3/api/org/hibernate/Criteria.html)的东西。缺点是你被绑定到一个数据库，或者更糟糕的是一个特定的持久性框架实现。它也不能满足你的所有要求，所以我认为这不是一个好的选择......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T21:24:24.780

您可能想查看[ANTLR](http://www.antlr.org/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T01:30:37.343

看看[Apache Commons Functor](http://commons.apache.org/sandbox/functor/)。例如[UnaryPredicate](http://commons.apache.org/sandbox/functor/apidocs/org/apache/commons/functor/UnaryPredicate.html)、[UnaryAnd](http://commons.apache.org/sandbox/functor/apidocs/org/apache/commons/functor/core/composite/UnaryAnd.html)、[UnaryOr](http://commons.apache.org/sandbox/functor/apidocs/org/apache/commons/functor/core/composite/UnaryOr.html)等。内置实现是可序列化的，但我不知道如何从字符串解析。不过，我认为这是实现您想要的一个非常好的开始。另外，请查看基于该库的[IBM 教程。](http://www.ibm.com/developerworks/java/library/j-fp.html)

# sql - NHibernate中三路多对多对一的映射和查询

> ID：833757
> 
> 赞同：2
> 
> 时间：2009-05-07T09:54:09.760
> 
> 标签：sql, nhibernate, orm, mapping

**更新：我错误地粘贴了错误重载的查询代码。底部是固定代码**

嗨，假设这是我的域。

我正在跟踪一些体育赛事，比如赛车。

每场比赛都有参加比赛的赛车手。

Racer 是特定于 Race 的 Driver（它具有 Driver、起始车道、运行时间等）。

司机有名字等……典型的个人数据。

我想执行以下查询： 获取此事件中的所有比赛（让我们离开分页），显示他们的参赛者信息，包括从车手那里获取的数据。

我的问题是，我不认为我的映射（或标准查询，或两者）对于这种情况是最佳的，所以我想问你，如果你在这里看到任何优化的机会。我特别不喜欢这样一个事实，即当前需要两次往返数据库，而我认为子查询可以使其一次性工作。

这是我的映射和查询（数据库是从映射生成的）

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
        assembly="Foo"
        namespace="Foo">
  <class name="Event" table="Events">
      <id name="Id">
        <generator class="guid"/>
      </id>
    <property name="EventId" not-null="true" unique="true" index="IDX_EventId" />
  </class>
</hibernate-mapping>

<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
        assembly="Foo"
        namespace="Foo">
  <class name="Race" table="Races">
    <id name="Id">
      <generator class="guid"/>
    </id>
    <property name="RaceId" not-null="true" unique="true" index="IDX_RaceId"/>
    <property name="Year" not-null="true" />
    <property name="IsValid" not-null="true" />
    <property name="Time" not-null="true" />

    <many-to-one name="Event" cascade="all" not-null="true" />

    <bag name="Contestants" cascade="save-update" inverse="true" lazy="false" batch-size="20" >
      <key column="Race"/>
      <one-to-many class="Racer"/>
    </bag>
  </class>
</hibernate-mapping>

<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
        assembly="Foo"
        namespace="Foo">
  <class name="Racer" table="Racers">
    <id name="Id">
      <generator class="guid"/>      
    </id>
    <many-to-one name="Race" foreign-key="FK_Racer_has_race" not-null="true" cascade="save-update" />
    <property name="Lane" not-null="true" />
    <many-to-one name="Driver" foreign-key="FK_Racer_has_driver" cascade="save-update" lazy="false" fetch="join" />
    <property name="FinishPosition" />
    <property name="Finished" not-null="true" />
  </class>
</hibernate-mapping>

<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
                   assembly="Foo"
                   namespace="Foo">
  <class name="Driver" table="Drivers">
    <id name="Id">
      <generator class="hilo"/>
    </id>
    <property name="Name" not-null="true" length="32" unique="true" index="IDX_Driver_Name" />
  </class>
</hibernate-mapping> 
```

和查询代码：

```
public IList<Race> GetMostRecentRacesForEvent( int eventId, int firstRaceToFetch, int count ) {
    DetachedCriteria criteria = DetachedCriteria.For( typeof( Race ) ).
        CreateAlias( "Event", "event" ).
        Add( Restrictions.Eq( "event.EventId", eventId ) ).
        AddOrder<Race>( r => r.Time, Order.Desc ).
        SetResultTransformer( new DistinctRootEntityResultTransformer() ).
        SetFirstResult( firstRaceToFetch ).
        SetMaxResults( count );
    return this.ExecuteListQuery<Race>(criteria); } 
```

将分页设置为 3 个比赛/页面，这是它生成的 SQL：

```
SELECT TOP 3 Id2_1_, RaceId2_1_, Year2_1_, IsValid2_1_, Time2_1_, Event2_1_, Id1_0_, EventId1_0_ FROM (SELECT ROW_NUMBER() OVER(ORDER BY __hibernate_sort_expr_0__ DESC) as row, query.Id2_1_, query.RaceId2_1_, query.Year2_1_, query.IsValid2_1_, query.Time2_1_, query.Event2_1_, query.Id1_0_, query.EventId1_0_, query.__hibernate_sort_expr_0__ FROM (SELECT this_.Id as Id2_1_, this_.RaceId as RaceId2_1_, this_.Year as Year2_1_, this_.IsValid as IsValid2_1_, this_.Time as Time2_1_, this_.Event as Event2_1_, event1_.Id as Id1_0_, event1_.EventId as EventId1_0_, this_.Time as __hibernate_sort_expr_0__ FROM Races this_ inner join Events event1_ on this_.Event=event1_.Id WHERE event1_.EventId = @p0) query ) page WHERE page.row > 0 ORDER BY __hibernate_sort_expr_0__ DESC 
```

第二个查询：

```
SELECT contestant0_.Race           as Race2_,
       contestant0_.Id             as Id2_,
       contestant0_.Id             as Id0_1_,
       contestant0_.Race           as Race0_1_,
       contestant0_.Lane           as Lane0_1_,
       contestant0_.Driver         as Driver0_1_,
       contestant0_.FinishPosition as FinishPo5_0_1_,
       contestant0_.Finished       as Finished0_1_,
       driver1_.Id                 as Id3_0_,
       driver1_.Name               as Name3_0_
FROM   Racers contestant0_
       left outer join Drivers driver1_
         on contestant0_.Driver = driver1_.Id
WHERE  contestant0_.Race in ('4157280d-be8d-44be-8077-a770ef7cd394' /* @p0 */,'74e1bfaa-9926-43c7-8b17-e242634dc32f' /* @p1 */,'e1e86b67-2c37-4fbe-8793-21e84a6e4be4' /* @p2 */) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T14:58:43.630

Stefan（退出评论，因为此时它变得不太可用）。

我根据您的建议重新编写了代码（不更改任何映射），现在，查询仅返回一个 Race - 与查询匹配的三个竞赛中的第一个（分页设置为 3 个竞赛/页面）。

当我删除

```
SetResultTransformer( new DistinctRootEntityResultTransformer() ) 
```

我得到了三件物品，但它的价值是相同的三倍，这……很奇怪。有任何想法吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T15:43:15.717

我*认为*它创建了多个查询以避免重复进入分页查询。（但我不确定，我没有看过 nhibernate 内部源代码）。由于使用了连接，因此对包含要获取的实体的重复项的集合进行分页实际上是无用的，因此您需要确保返回的结果集没有重复项。我认为 nhibernate 在这里选择 2 个或更多查询而不是 1 个查询。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T10:07:49.040

尝试这个：

```
DetachedCriteria criteria = DetachedCriteria.For( typeof( Race ), "race" )
    .CreateAlias("Event", "event")
    .CreateAlias("race.Contestants", "contestant")
    .SetFetchMode("race.Contestants", FetchMode.Join)
    .SetFetchMode("contestant.Driver", FetchMode.Join)
    .Add( Restrictions.Eq( "event.EventId", eventId ) )
    .AddOrder<Race>( r => r.Time, Order.Desc )
    .SetResultTransformer( new DistinctRootEntityResultTransformer() )
    .SetFirstResult( firstRaceToFetch )
    .SetMaxResults( count );
return this.ExecuteListQuery<Race>(criteria); } 
```

它应该进行一次查询并加入比赛、活动和参赛者。

您不应该过多地使用 FetchMode.Join，返回的结果集更大。（它包含与参赛者一样多的比赛和活动信息。）

# iphone - iPhone：获取应用程序绝对路径

> ID：833759
> 
> 赞同：1
> 
> 时间：2009-05-07T09:55:04.703
> 
> 标签：iphone

有没有办法以编程方式获取可执行文件的绝对路径。在执行此可执行文件期间，我的意思是 :) 在 linux 中读取 /proc/pid/* 以获取当前 PID

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-07T12:45:29.940

我不知道你为什么要这样做，但是：

```
[[NSBundle mainBundle] executablePath]; 
```

应该得到你所追求的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T10:05:30.793

您可能会接近[NSHomeDirectory](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Miscellaneous/Foundation_Functions/Reference/reference.html#//apple_ref/c/func/NSHomeDirectory)。

# c# - 列表 跨 Web 服务变为 Country []

> ID：833767
> 
> 赞同：3
> 
> 时间：2009-05-07T09:57:40.297
> 
> 标签：c#, .net, web-services

我有一个 Web 服务，当被调用时，它返回一个包含多态列表的 Result 对象。但是，当我在客户端应用程序中添加引用时，公共字段将成为客户端应用程序中的 Country 数组。如何将客户端应用程序中的字段更改为 List？

```
public Result GetCountryList()
{
    List<Country> countries = GrabCountryList();
    Result result = new Result();
    result.theResult = countries;
} 
```

这是公共财产

```
public object theResult
{
     get {return _theResult; }
     set {_theResult = value;}
} 
```

* * *

**接受**Mehmet Aras 的回答：

右键单击服务引用，然后选择“配置引用”。在集合类型下，选择 System.Collection.Generic.List。更新服务参考，应该可以了。

感谢 Matt Hamilton 提出的从数组创建新列表的建议。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-07T10:02:21.753

我相信您必须自己重建列表。Web 服务应该与语言无关，因为`List<T>`它是 .NET 框架的一部分，所以它不能是序列化返回值的一部分。

重建列表很简单：

```
var countries = new List<Country>(result.theResult); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-07T10:02:35.510

如果您使用的是 VS2008，服务参考设置表单上有一个高级按钮，可让您控制客户端代理的生成。在那里您可以选择集合类型，列表就在其中。

# java - 获取当前时间的 Java 代码

> ID：833768
> 
> 赞同：156
> 
> 时间：2009-05-07T09:57:47.583
> 
> 标签：java, time

我正在搜索代码`java`以获取或同步我的本地 PC 系统时间到我的应用程序中。

* * *

## 回答 #1

> 赞同：166
> 
> 时间：2009-05-07T11:38:41.850

尝试这个：

```
import java.text.SimpleDateFormat;
import java.util.Calendar;

public class currentTime {

    public static void main(String[] args) {
        Calendar cal = Calendar.getInstance();
        SimpleDateFormat sdf = new SimpleDateFormat("HH:mm:ss");
        System.out.println( sdf.format(cal.getTime()) );
    }

} 
```

您可以按照自己喜欢的方式格式化 SimpleDateFormat。有关任何其他信息，您可以查看 java api：

[简单日期格式](http://java.sun.com/j2se/1.5.0/docs/api/java/text/SimpleDateFormat.html)

[日历](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Calendar.html)

* * *

## 回答 #2

> 赞同：150
> 
> 时间：2009-05-07T10:01:07.043

两个都

`new java.util.Date()`

和

`System.currentTimeMillis()`

会给你当前的系统时间。

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2014-03-23T18:19:19.077

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-05-07T10:04:51.713

System.currentTimeMillis()

其他一切都可以解决.. 例如 new Date() 调用 System.currentTimeMillis()。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2015-10-16T02:11:09.670

试试这种方式，更高效、更**兼容**：

```
SimpleDateFormat time_formatter = new SimpleDateFormat("yyyy-MM-dd_HH:mm:ss.SSS");
String current_time_str = time_formatter.format(System.currentTimeMillis());
//Log.i("test", "current_time_str:" + current_time_str); 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2016-03-12T15:40:36.950

只是为了通知更多的开发人员，感谢 Basil Bourque，我只想在这个话题上加点我的石头。

如果您只想获取 HH:MM:SS 格式，请执行以下操作：

```
LocalTime hour = ZonedDateTime.now().toLocalTime().truncatedTo(ChronoUnit.SECONDS); 
```

干杯。

PS：这至少只适用于 Java 8 ！

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-05-07T10:01:25.013

如上所述，您可以使用

```
Date d = new Date(); 
```

或使用

```
Calendar.getInstance(); 
```

或者如果你想要以毫秒为单位

```
System.currentTimeMillis() 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-05-07T10:00:07.827

不太清楚你的意思，但你可能只需要

```
Date d = new Date(); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-04-12T08:59:31.380

尝试这个：

```
final String currentTime    = String.valueOf(System.currentTimeMillis()); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-05-07T10:04:24.850

您可以使用 new Date () 它会给您当前时间。

如果您需要以某种格式表示它（通常您需要这样做），请使用格式化程序。

```
DateFormat df = DateFormat.getDateTimeInstance (DateFormat.MEDIUM, DateFormat.MEDIUM, new Locale ("en", "EN"));
String formattedDate = df.format (new Date ()); 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-07-14T06:17:30.617

new Date().getTime() 被**窃听**。

```
 Date date = new Date();
    System.out.println(date);
    System.out.println(date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds());
    long t1 = date.getTime();
    System.out.println((t1 / 1000 / 60 / 60) % 24 + ":" + (t1 / 1000 / 60) % 60 + ":" + (t1 / 1000) % 60);
    long t2 = System.currentTimeMillis();
    System.out.println((t2 / 1000 / 60 / 60) % 24 + ":" + (t2 / 1000 / 60) % 60 + ":" + (t2 / 1000) % 60); 
```

它返回错误的时间毫秒。`System.currentTimeMillis()`也。由于我要求 Date**实例**告诉我相应的时间毫秒，因此它必须返回匹配的时间而不是来自不同时区的其他时间。有趣的是，不推荐使用的方法是唯一返回正确值的方法。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-07T10:02:37.943

要获取系统时间，请使用 Calendar.getInstance().getTime()

并且您应该每次都获取 Calendar 的新实例以获得*当前*时间。

要从java 代码*更改*系统时间，您可以使用命令行

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-06-20T16:05:00.877

试试这个来获取当前日期。您还可以使用 getters 获取当前小时、分钟和秒：

```
new Date(System.currentTimeMillis()).get....() 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-03-23T14:33:07.197

我知道这是一个很老的问题。但想澄清一下：

```
Date d = new Date() 
```

在当前版本的 Java 中已被贬低。推荐的方法是使用日历对象。例如：

```
Calendar cal = Calendar.getInstance();
Date currentTime = cal.getTime(); 
```

我希望这对将来可能会提到这个问题的人有所帮助。谢谢你们。

# client-server - 用于服务器到客户端通信的 MSMQ

> ID：833773
> 
> 赞同：4
> 
> 时间：2009-05-07T09:59:25.067
> 
> 标签：client-server, msmq, messaging

我们正在研究 MSMQ 以实现持久的“推送”服务器到客户端的通信。每台服务器最多可以有 1000 个客户端。

在我们的一个测试中，我们向 300 个离线客户端发送了一条小消息，然后向一个在线客户端发送了一条消息。最后一条消息延迟了 40 多分钟，因为 MSMQ 正在处理无法传递的消息（通过 MMC 观察到）。我们还使用 MSMQ 作为它运行良好的返回路径。

有没有办法通过减少尝试连接到脱机主机的时间来使 MSMQ 适应这种使用模式？如果没有，是否还有其他更适合的排队产品，或者它是你自己的时间？原始吞吐量不是优先级，但传出队列的数量和可预测性/最大延迟是优先级，客户端（可能是相当旧的机器）上的内存占用也是如此。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-12-01T01:48:38.630

您可以通过禁用日志记录并使消息不可恢复来提高性能......如果您不关心消息丢失。

脱机方案的快速修复可能是增加 MSMQ 可用的线程数，它使用每个传出队列的线程。每次离线连接尝试都需要一段时间，阻塞一个线程。[http://technet.microsoft.com/en-us/library/cc957498.aspx](http://technet.microsoft.com/en-us/library/cc957498.aspx)尝试向它抛出尽可能多的线程。

我的同行使用过 ActiveMQ，并表示它更灵活，同时性能更好。我没有亲自使用它，但如果你没有绑定到.Net，我会调查它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-01T15:16:22.320

我们的解决方案是通过 MSMQ 的管理 COM 接口之一以编程方式暂停到离线机器的队列（我们已经有一条 UDP 消息来判断客户端是否已启动）。

由于已知断开连接主机的队列暂停，MSMQ 花费更少的时间处理无法传递的消息。

在考虑评估技术的测试时应用一点横向思维也是一个很好的教训！一般来说，由于这个问题，我不会推荐将 MSMQ 用于服务器到客户端的通信——我会说由客户端轮询会更好。

# asp.net - 如何检查用户是否已登录或未使用 Cookie？

> ID：833786
> 
> 赞同：3
> 
> 时间：2009-05-07T10:02:26.650
> 
> 标签：asp.net, security

我想知道如何检测用户是否已经登录？使用 cookie。我没有使用任何登录控件。我有一个检查 ID 和密码的数据库。另外请让我知道是否可以在不使用 cookie 的情况下完成。任何代码或链接都会有所帮助。网络配置：

```
 <authentication mode="Forms">
  <forms name="myForm" loginUrl="LogIn.aspx" path="/" defaultUrl="Home.aspx">
</forms>
  </authentication>
<authorization>
  <deny users="?"/>
   </authorization> 
```

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-07T10:09:30.597

在使用 windows/forms 身份验证的 asp.net 中，您可以判断用户是否通过以下方式登录：

```
<%
   Page.User.Identity.IsAuthenticated
%> 
```

表单身份验证基于 cookie，但可以配置为不使用 cookieless 设置的 cookie。

如何完全设置表单身份验证不是一个快速的答案，但设置起来相对容易，网上有很多 HOW-TO。这是一个很好的[http://www.4guysfromrolla.com/webtech/110701-1.shtml](http://www.4guysfromrolla.com/webtech/110701-1.shtml)

MSDN：http: [//msdn.microsoft.com/en-us/library/aa480476.aspx](http://msdn.microsoft.com/en-us/library/aa480476.aspx)

您也可以使用不使用 cookie 的 Windows 身份验证。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-01-02T13:11:59.013

我用了：

```
HttpContext.Current.Request.IsAuthenticated 
```

# vb.net - C# 的默认值（T）的 VB 等效项

> ID：833791
> 
> 赞同：64
> 
> 时间：2009-05-07T10:02:50.783
> 
> 标签：vb.net, default-value

VB 与 C# 的等价物是什么`default(T)`-[默认运算符](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/default)

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-05-07T10:11:06.600

可以是以下任何一种：

```
Dim variable As T
Dim variable As T = Nothing
Dim variable As New T()
Dim variable As T = CType(Nothing, T) 'this is suggested by reflector 
```

在 VB.NET 中，甚至对值类型进行赋值`Nothing`是非常好的。只有当您为泛型类型指定`New`, 或约束时，后者才有可能。`Structure`

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-05-07T19:30:16.410

最接近的等价物`default(T)`是真的`CType(Nothing, T)`，因为它可以在任何使用的上下文中`default(T)`使用（即作为表达式）。

# vb.net - 如何循环遍历多个数组？

> ID：833792
> 
> 赞同：0
> 
> 时间：2009-05-07T10:03:32.700
> 
> 标签：vb.net, arrays, loops, for-loop

我是新手，如果我的问题以前被问过，我很抱歉。我已经搜索过，但未能找到或识别出答案。我正在使用 Visual Studio 2008 并在 vb.net 中创建一个应用程序。

我有 4 个名为的数组：- account1 account2 account3 account4。它们都有 4 个元素。我想以有效的方式为数组中的元素赋值。我认为两个 for next 循环会做到这一点。我的伪代码看起来像这样

```
for i=1 to 4
    for c= 0 to 3
        account(i)(c)= 'mydata' /so account(i) would be account1 etc and c the element
    next c
next i 
```

因此，所有数组的所有元素都被填充，而我不必为每个单独的数组名称设置一个 fornext 循环。请问我怎样才能做到这一点。

希望我提供了足够的信息以供使用，并且您可以提供帮助。感谢所有和任何建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-07T10:21:39.303

您应该创建一个多维数组而不是 4 个数组，这将允许您在数组中进行一般循环。

```
int[,] accounts = new int[4,4] // 4 accounts with 4 elements
for (int i = 0 ; i < accounts.GetUpperBound(0); i++)
  for (int j = 0 ; i < accounts.GetUpperBound(1); j++)
     accounts[i,j] = i*j;
  next
next 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T10:21:33.640

如果我理解正确，为什么不：

```
For i as integer = 0 to 3
    account1(i) = "Account1"
    account2(i) = "Account2"
    account3(i) = "Account3"
    account4(i) = "Account4"
Next 
```

编辑 VB.Net 以获得**Qua**的答案：

```
dim accounts(4,4) as integer

for i as integer = 0 To accounts.GetUpperBound(0)
  for j as integer = 0 To accounts.GetUpperBound(1)
     accounts(i, j) = new integer 'not needed for intergers, but if you had a class in here'
     accounts(i, j) = i*j;
  next
next 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-07T10:23:11.873

当我阅读您的代码示例时，我认为您不需要使用 2 个单独的循环，好像我是对的，您正在为数组的第 i 个位置分配相同的值，例如：

数组1(i) = 数组2(i) = 数组3(i) = 数组4(i)

在上面的示例中，您可以编写如下内容（在伪代码中）：

```
for i = 0 to 3
   account1(i) = MyData
   account2(i) = MyData
   account3(i) = MyData
   account4(i) = MyData
next i 
```

我认为这比尝试为变量名编写循环更清楚，尤其是对于您要维护的数组数量

如果您有很多数组，另一种选择可能更合适，那就是维护一个数组列表，然后可以简单地对其进行迭代。

此选项的伪代码：

```
for each array in listOfArrays
  for i = 0 to 3
    array(i) = MyData
  next i
next 
```

这绝对比尝试动态生成数组的名称更清晰，也更易于维护

# c++ - 从 VS2003 到 VS2005 的转换问题？

> ID：833794
> 
> 赞同：0
> 
> 时间：2009-05-07T10:04:01.640
> 
> 标签：c++, visual-studio, visual-studio-2005, visual-studio-2003

我正在尝试将项目从 vs2003 转换为 vs2005。转换完成后，缺少一些包含 headerfile.h 语句并生成包含“序列化”。如何解决这个问题。即使我复制和粘贴。它提示源将在外部修改环境味精出现。我该怎么做才能解决这个问题？？？

提前致谢..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T10:52:27.873

Visual Studio 2005 没有安装 Visual Studio 2003 安装的所有平台 SDK。您可能还需要安装平台 SDK。请参阅我对您的问题的评论。

# python - Django 主题/皮肤存储库

> ID：833799
> 
> 赞同：25
> 
> 时间：2009-05-07T10:05:26.270
> 
> 标签：python, django, django-admin

标准 Django 应用程序是否有一些免费可用的主题/皮肤？我的意思是包含页脚、页眉等的典型内容。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-07T10:55:52.623

如果您的问题涉及 django-admin 应用程序，您可以尝试[Grappeli](http://code.google.com/p/django-grappelli/)。如果没有，您可能想熟悉 CSS 框架。可以在[此处](https://stackoverflow.com/questions/203069/what-is-the-best-css-framework-and-are-they-worth-the-effort)或[此处](https://stackoverflow.com/questions/647853/how-do-you-choose-a-css-framework)找到有用的资源。我个人会推荐[960.gs](http://960.gs/)，但这是一个口味问题。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-04-30T02:14:30.000

看看[djangoslingshot.com](http://www.djangoslingshot.com)（完全公开，这是我的网站）。

其中一种产品是“模板模板”——目前有两个模板在 CC Attribute 许可下可用。

# c# - 构造函数初始化期间出现问题-下一步是什么？

> ID：833801
> 
> 赞同：0
> 
> 时间：2009-05-07T10:05:32.027
> 
> 标签：c#, oop, exception, error-handling, constructor

C#菜鸟问题...

我在类构造函数中使用了一些参数来初始化一些私有变量。当传入的数据不是我所期望的（错误的字符串长度、超出预期范围的数字、不存在的路径等等）时，我该怎么办？抛出异常？添加“一切正常”标志？

通常是怎么做的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T10:07:03.097

引发 ArgumentException。

有关更多详细信息，请参阅此相关问题：

[ac# dll 向调用应用程序返回错误的好方法是什么？](https://stackoverflow.com/questions/823224/whats-a-good-way-for-a-c-dll-to-return-error-to-the-calling-application)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T10:07:43.113

抛出适当的 ArgumentException，因为无法根据输入建立类的初始状态。

# c# - 成员变量的下划线前缀。智能感知

> ID：833811
> 
> 赞同：6
> 
> 时间：2009-05-07T10:07:57.060
> 
> 标签：c#, coding-style, naming-conventions

每个人都说“下划线，没有下划线”的辩论纯粹是哲学和用户偏好驱动的，但是有了下划线的智能感知，您可以很容易地将成员变量与局部变量区分开来，从而给您带来具体的好处

对所有成员变量都下划线的好处有什么反对论据吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-07T10:14:30.460

是的 - 对于某些人来说，它会降低可读性。我相信不同的人以不同的方式阅读（例如，一些人在内部发声，而另一些人则没有）。对于某些人（包括我自己），下划线会在我阅读时中断代码的“流动”。

我认为，如果您在区分局部变量和实例变量时遇到困难，那么很可能是您的方法太大或您的类做得太多。当然，情况并非总是如此，但我不倾向于认为它对于短期课程/方法来说是个问题。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-05-07T10:12:15.240

如果它只是你想要的智能感知，你总是可以通过输入“ `this.`”来获得它。

好的，它比“_”多 4 个字符，但智能感知随后会为您显示您的成员。

如果您使用下划线并且您的团队使用下划线，那么请继续使用它们。其他人会使用“ `m`_”，其他人可能有其他想法。我使用 StyleCop，在我的团队中，辩论已经结束，我们使用“ `this`.”。不使用匈牙利风格或下划线前缀。我们不再担心它了。

[编辑] 这不是对您的问题的批评——这是一个有效的问题，值得一问——但这场辩论在开发项目上浪费了太多时间。尽管我不喜欢 StyleCop 的所有内容，但我还是愿意使用它，因为它消除了这种类型的争论。说真的，我参加过长达一小时的会议，这种讨论占据了整个开发团队。疯狂的。就像我说的那样，您的问题是有效的，但请不要浪费自己的时间为此苦恼，这不值得:-)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-07T10:09:55.837

使用下划线只是实现该效果的一种方法。重要的是要保持一致。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-07T10:26:10.867

下划线可以看作是匈牙利符号的一种形式`*`，但前缀是一个“神奇的字符”，而不是有意义的东西。

如果您想要更多地说明前缀的用途，您可以使用类似`member`or `mbr`or的前缀`m`。有时会使用前缀`m_`，但随后下划线用作分隔符而不是前缀的一部分，并且 .NET 的命名建议表明它不应该用作分隔符。

就我个人而言，我开始喜欢成员变量的下划线，尽管它是一个具有隐藏含义的前缀。它不会像任何其他前缀那样混淆名称。

和往常一样，选择一个标准并坚持它比你实际选择的标准更重要。

* * *

`*`在 VBScript 等弱类型语言中，匈牙利表示法主要用于指定数据类型，但其初衷是指定变量的其他属性，因此将其用于成员变量更符合初衷。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-11-29T22:37:17.210

使用这个。在我看来，到处都会降低可读性。私有类字段的下划线前缀是完全可以接受的。它几乎不是匈牙利语，这是一个真正糟糕的命名约定，在智能感知前端键入 _ 加上一个字母是一种非常快速的方式来显示您的列表。我使用 CSLA.NET，很多 BO 示例都使用下划线约定，我在所有工作中继续使用它。不要让老派的前 C++ 和 C 开发人员吓到你认为这不是好的做法——.NET 不会遇到同样的问题。一个很好的例子是在构造函数中传递参数：

```
public MyObject(int field1, int field2, int field3)
{
    _field1 = field1;
    _field2 = field2;
    _field3 = field3;
} 
```

在我看来，它的可读性比

```
public MyObject(int field1, int field2, int field3)
{
    this.field1 = field1;
    this.field2 = field2;
    this.field3 = field3;
} 
```

但这是个人品味，正如其他地方所说，一致性是最重要的问题。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-07T10:12:19.967

只要您在整个项目中使用它，您选择什么命名约定并不重要。

# iphone - 如何在我的 Objective-C 源代码中转义 Unicode 字符？

> ID：833822
> 
> 赞同：38
> 
> 时间：2009-05-07T10:11:19.657
> 
> 标签：iphone, objective-c, unicode, escaping

问这个问题我感到非常愚蠢，但文档和谷歌根本没有给我任何爱。

我有一个 Unicode 字符，我想在我的 iPhone 应用程序的源代码中插入字符串文字。我知道它的十六进制值。使用什么正确的转义序列？就此而言，我忽略了哪些明显的信息来源会告诉我这一点？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-05-07T10:15:06.683

例子：

```
NSString *stuff = @"The Greek letter Beta looks like this: \u03b2, and the emoji for books looks like this: \U0001F4DA"; 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-07T10:42:53.357

如果您不想将其直接放在字符串中，则可以使用如下格式说明符：

```
[string stringByAppendingFormat:@"%C", 0x2665]; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-09-21T15:12:37.117

更现代的方法：

我不确定何时将此功能添加到语言中，但至少从 2015 年开始，**Objective-C 字符串文字可以包含任何 Unicode 字符。**例如，我用表情符号标记我的日志行，因为它们独特的颜色更容易让我挑选出来：

[![信息：@](https://i.stack.imgur.com/CWtUv.png)](https://i.stack.imgur.com/CWtUv.png)

因此，如果您有字符而不仅仅是代码点，并且您想在静态字符串中使用它而不是动态生成它，这是一个很好的方法，因为您只需查看即可立即知道您正在使用的字符它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-07T10:13:01.150

正确的转义序列将类似于以下内容

```
wchar_t * str = L"\x0627"; 
```

看到这个问题：[字符常量：\000 \xhh](https://stackoverflow.com/questions/755741/character-constant-000-xhh/755763)

编辑：哦，对不起，我错过了 iPhone 和 Objective-C 标签。以上对通用 C/C++ 有效，但我没有参与过 iPhone 开发，因此您的里程可能会有所不同。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2014-07-08T07:22:10.737

`\`是目标 c 中的转义字符，在要转义的字母之前使用它，如：

```
NSString temp = @" hello \"temporary.h\" has been inported"; 
```

在这里，如果您在 textview 或日志中打印临时字符串，您也会看到`"`正在打印，因为我们`\`在它们之前使用了转义字符

# java - 呼叫系统文本编辑器

> ID：833828
> 
> 赞同：2
> 
> 时间：2009-05-07T10:12:27.890
> 
> 标签：java, text, editor

我有适用于 CSV 文件的 Java 桌面应用程序。我想添加一些功能。此时我需要使用默认的系统文本编辑器打开选定的文件。当我在 Windows 上运行我的程序时，我没有任何问题，只需调用 notepad.exe，但如何处理 *nix 系统？一种解决方法是在程序选项中自定义设置首选文本编辑器的方式，但这不是最佳解决方案......

但也许它会更好地添加到程序自己的文本编辑器中，即使功能较少？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-07T10:31:27.797

我相信[`java.awt.Desktop.edit()`](http://java.sun.com/javase/6/docs/api/java/awt/Desktop.html#edit(java.io.File))可能是您正在寻找的东西，尽管它会启动操作系统认为应该编辑文件的任何内容，在 CSV 的情况下通常是电子表格应用程序而不是文本编辑器 - 也许您可以将文件重命名为TXT 临时或永久。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T10:29:24.450

[对于这样的功能，我相信使用JTextArea](http://java.sun.com/docs/books/tutorial/uiswing/components/textarea.html)并提供您自己的基本文本编辑器要好得多。

无论如何，看看[BareBonesBrowserLauncher](http://www.centerkey.com/java/browser/)。它是一个 Java 类，允许您在任何平台上启动默认浏览器。您可以根据自己的需要对其进行调整。从那里复制：

```
String[] editors = { "vim", "emacs", "vi",};
String editor = null;
for (int count = 0; count < editors.length && editors == null; count++) 
    if (Runtime.getRuntime().exec( new String[] {"which", editors[count]}).waitFor() == 0) 
        editor = editors[count];
if (editor == null) 
    throw new Exception("Could not find editor");
else Runtime.getRuntime().exec(new String[] {editor, filename}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T12:19:30.660

试试这个：

```
import java.awt.Desktop;
import java.io.File;
import java.io.IOException;

public class systemEditor {

    public static void main(String[] args) {
        Desktop dt = Desktop.getDesktop();
        try {
            dt.open( new File("FileName.csv") );
        } catch (IOException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
    }

} 
```

如果应用程序适用于 Mac，请记住将库从默认的 Mac OS 10.5 (JVM 1.5) 更改为 JVM 1.6，否则 java.awt.Desktop 将无法解析。

正如 Michael Borgwardt 所提到的，这不会打开文本编辑器。它在我的情况下打开 MS Excel。

有关更多信息，您可以查看 java api：

[java.awt.桌面](http://java.sun.com/javase/6/docs/api/java/awt/Desktop.html)

[java.io.文件](http://java.sun.com/javase/6/docs/api/java/io/File.html)

# c# - 在 .Net 中，是否可以在不继承自 System.Web.UI.Page 的类中使用 Response.Write

> ID：833830
> 
> 赞同：10
> 
> 时间：2009-05-07T10:12:45.270
> 
> 标签：c#, .net

刚刚在电话面试中被问到这个问题是真/假，有点难过。有任何想法吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-05-07T10:18:53.850

您可以从 HttpContext 静态对象中获取 Response 对象：

```
System.Web.HttpContext.Current.Response.Write("Some Text") 
```

如果 current 返回 null，则代码不会作为页面请求的一部分运行。如果你再次被问到这个问题，那就是答案，但后续问题应该是“你为什么需要？”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T10:19:19.403

简短的回答是肯定的。在采访中，id 以 UserControl 为例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T10:17:18.127

是的当然。如果您有“Respone”的参考做实例，您可以在它们上调用任何方法。

# time - 使用 TeraTerm 发送文件、传输速率、时间

> ID：833831
> 
> 赞同：0
> 
> 时间：2009-05-07T10:12:58.840
> 
> 标签：time, performance, modem

我正在使用 TeraTerm 通过拨号连接传输文件，为此我将在两端使用 ttl 脚本来自动化它。我想测量传输文件所需的时间，或者传输速率......但我不知道该怎么做？有人有什么主意吗？非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-10-19T17:19:36.973

gettime 会给你时间，但你需要得到正确的时间来正确计算吞吐量。您需要在发送开始时在发送数据的一侧获取时间。然后在接收结束时在接收端获取时间。将 gettime 从一侧发送到另一侧并进行计算。请记住，每台机器都必须有同步时间。所以每个人都应该使用时间服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-10T09:09:38.733

可能您可以在之前和之后调用[gettime](http://ttssh2.sourceforge.jp/manual/en/macro/command/gettime.html)，然后使用这两个点来计算使用的时间。

# authentication - 活动目录

> ID：833835
> 
> 赞同：4
> 
> 时间：2009-05-07T10:13:37.590
> 
> 标签：authentication, active-directory, passwords

如何从 Active Directory 获取用户的密码

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-07T10:33:12.973

很简单，你不能。几乎所有的身份验证系统中都没有存储密码。相反，它们被转换为存储的“哈希”。然后，当您想证明您知道密码时，您可以使用相同的算法将您输入的密码转换为哈希值，并将其与存储的数据进行比较。

有些使用公钥/私钥来执行散列，有些使用替代算法。他们都不能将哈希“取消转换”回原始密码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-07T10:15:27.103

管理员无权访问用户密码，只能更改密码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T10:41:55.823

您需要对域控制器进行管理访问才能获取哈希值。然后，您需要使用哈希破解器（例如[Cain](http://www.oxid.it/cain.html)）来查看是否可以恢复密码。如果密码不简单，这可能需要几天或几年的时间。

请注意，在大多数情况下这是非法的，通常重置密码而不是恢复密码。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-10-26T01:04:51.320

您无法获取存储在 Active Directory 中的密码，因为它们存储为哈希值。您可以在 Active Directory 中了解密码的唯一时间是在设置密码时，但为此您需要设置密码过滤器，并且要设置密码过滤器，您必须是域控制器上的管理员。

您也不能更改用户的密码，因为更改密码需要您知道用户的现有密码。您只能重置用户的密码，但为此您需要对用户帐户具有重置密码权限。

重置用户密码是一项通常委派给初级管理员的管理任务，在大多数情况下，委派的管理员可以重置用户帐户密码。

如果有兴趣，可以在此处很好地讨论更改 Active Directory 用户帐户密码和重置 Active Directory 用户帐户密码之间的区别：

[http://www.activedirsec.org/t43140076/what-is-the-difference-between-the-change-password-and-reset/](http://www.activedirsec.org/t43140076/what-is-the-difference-between-the-change-password-and-reset/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-22T17:01:14.607

默认情况下，活动目录被配置为利用散列算法来存储用户密码。但是，您可以覆盖该默认值并改用对称（可逆）加密。这确实允许通过可用的标准 API 检索密码。 [这是](http://technet.microsoft.com/en-us/library/cc784581%28WS.10%29.aspx)关于使用 AD 进行对称加密的链接。

此外，正如另一张海报提到的，您可以利用密码过滤器来捕获密码更改以及用户更改密码时的新密码。除此之外必须重置密码。哈希并不意味着被破坏或恢复，这就是重点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-06-16T14:37:38.870

通过支持的 API 以编程方式，您无法从 Active Directory 读取密码，但您可以通过实施[Password Filter](http://msdn.microsoft.com/en-us/library/ms721882%28v=vs.85%29.aspx)在设置密码的时间点获取密码。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-05-07T10:19:10.930

考虑到它是密码，我非常怀疑这是否可能。但是在[ServerFault](https://serverfault.com/)中问这个问题可能会更好？

我不确定您是否能够获得访问权限，但是一旦它退出测试版，您就可以注册。

# design-patterns - 事件驱动逻辑的设计模式

> ID：833837
> 
> 赞同：3
> 
> 时间：2009-05-07T10:14:05.267
> 
> 标签：design-patterns, events, client-server

我正在开发一个桌面应用程序，它依赖于它从服务器接收的 XML 数据。有几个文件，需要在不同的时间下载。

许多数据结构都填充了解析的数据。文件和数据结构之间的对应关系不是一对一的，事实上可能相当复杂。

应用程序状态和状态之间的转换取决于这些下载信息的内容（以及它们目前的可用性）。

晦涩的 spagetti 代码处理所有下载事件和相互依赖关系。

我一直在研究某种模式以更统一的方式使用它，但我认为开发人员社区已经找到了最合适的实践和模式。有人知道吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-08T08:20:24.670

当你有状态时，你肯定需要状态模式。当您有关于状态转换的复杂规则以及连接到此状态的不同 BL 时，这是最好的方法。首先绘制状态图，然后很容易编写所需的类。

我还必须同意 John 的观察者模式，您可以使用它来进行所需的依赖反转，并轻松处理状态转换。

在您的情况下，您可以将所有 BL 放入状态类并在系统达到该状态时进行处理，您将有代码分离并且没有意大利面条代码......代码将跟随并根据状态转换执行 BL。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T11:47:04.357

一段时间以来，我一直在广泛使用 Model-View-ViewModel 模式，我强烈推荐它。虽然网络上关于它的大多数文章都将它与 WPF 牢固地联系在一起，但没有理由不将它与其他技术一起使用。我已经将它用于 Web 服务、WPF 客户端和命令行（三个“视图”共享较低层）。

这是我快速而肮脏的描述：该模式由三层（自上而下）组成：视图（通常是 GUI，但实际上是任何外部接口）、视图模型（包含业务逻辑和工作数据集）和模型（域对象等）。每个层直接与下面的层通信，并为上面的层触发事件。

在 .Net 领域，该模式严重依赖 INotifyPropertyChanged 接口。当模型中的数据结构发生变化时，它们可能会触发一个事件。ViewModel 可以更新其状态（应用程序状态）作为响应并触发其事件。然后视图可以更新以显示新的应用程序状态。

这是一篇不错的文章：http: [//msdn.microsoft.com/en-us/magazine/dd419663.aspx](http://msdn.microsoft.com/en-us/magazine/dd419663.aspx)

再一次，该文章以 WPF 为中心。

我希望这个答案对你来说是正确的。如果没有，有关该问题的更多信息可能会很有用。你不是在谈论信号量、队列和线程吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T17:55:46.967

> 应用程序状态和状态之间的转换取决于这些下载信息的内容（以及它们目前的可用性）。

看起来您需要使用分层模式。我的意思是在您上面提到的示例中，是在状态模式之上使用策略模式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-07T10:46:11.490

[模型视图控制器（MVC）](http://en.wikipedia.org/wiki/Model-view-controller)呢？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T10:18:26.643

事件驱动系统最著名的设计模式之一可能是[观察者模式](http://en.wikipedia.org/wiki/Observer_pattern)。

# vim - 在VIM中删除光标之后或周围的单词

> ID：833838
> 
> 赞同：235
> 
> 时间：2009-05-07T10:14:15.607
> 
> 标签：vim, keyboard-shortcuts

我现在`VIM`从 TextMate 切换到。我发现`^+W`在 INSERT 模式下非常有用。但是，我不仅要删除光标之前的单词，还要删除光标之后或周围的单词。

我做了一些谷歌搜索，但我唯一能找到的是`^+W`删除光标之前的单词。

* * *

## 回答 #1

> 赞同：591
> 
> 时间：2009-05-07T14:34:56.637

正常模式：

```
daw : delete the word under the cursor    
caw : delete the word under the cursor and put you in insert mode 
```

* * *

## 回答 #2

> 赞同：112
> 
> 时间：2010-09-13T18:57:00.370

我认为这只是`daw`

```
daw - delete a word 
```

* * *

## 回答 #3

> 赞同：81
> 
> 时间：2009-05-07T15:27:32.687

你应该做的是为一系列命令创建一个特定键的 imap，在这种情况下，命令会让你进入正常模式，删除当前单词，然后让你重新插入：

```
:imap <C-d> <C-[>diwi 
```

* * *

## 回答 #4

> 赞同：77
> 
> 时间：2009-05-07T10:18:45.333

**以下适用于正常模式：**我同意 Dan Olson 的回答，即对于大多数删除，您可能应该处于正常模式。更多详情如下。

如果光标在单词内：在单词
`diw`中删除（不包括空格）
`daw`在单词周围删除（包括下一个单词之前的空格）。

如果光标位于单词的开头，只需按`dw`。

这可以通过添加移动的常用数字来相乘，例如 2w 向前移动 2 个单词，因此 d2w 删除了两个单词。

**插入模式 ^w**
在 Vim 中使用 hjkl 进行移动的想法是，将您的手放在主行上会更有效率。在一个单词的末尾 ^w 非常适合快速删除该单词。如果您已进入插入模式，输入一些文本并使用箭头键在您违背主行理念的单词中间结束。
如果您处于正常模式并且想要更改单词，您可以简单地使用`c`（更改）而不是`d`（删除）如果您想完全更改单词，然后重新进入插入模式而无需按下`i`返回打字。

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2009-05-07T10:17:56.333

你的意思是喜欢吗？

```
dw 
```

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2016-12-07T19:42:36.917

要删除两个空格之间的**所有字符，在正常模式下：**

```
daW 
```

只删除一个词：

```
daw 
```

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2009-05-07T10:34:30.270

看起来在插入模式下没有任何*内置*方法可以做到这一点，这就是问题所在。其他一些答案对于正常模式是正确的，并指出可以创建自定义映射以在插入模式下添加功能。

老实说，您可能应该在正常模式下进行大部分删除操作。^W 很高兴知道，但我不确定我是否能想到一种情况，我宁愿这样做，也不愿 esc 进入正常模式并拥有更强大的删除命令供我使用。

Vim 在这方面与许多其他编辑器（包括 TextMate）有很大不同。如果您高效地使用它，您可能会发现您不会在插入模式下花费太多时间。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2017-04-21T19:57:36.640

删除光标所在的整个单词`diw`
要删除光标所在的整个单词并让您进入插入模式`ciw`
，如果您不想删除整个单词但从您所在的位置删除，请使用`dw/cw`

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2019-03-25T12:05:56.027

既然删除一个词的方法有很多，让我们来举例说明。

假设您编辑：

```
foo-bar quux 
```

并在光标位于“bar”中的“a”时调用命令：

```
foo-bquux  # dw:  letters then spaces right of cursor
foo-quux   # daw: letters on both sides of cursor then spaces on the right 
foo- quux  # diw: letters on both sides of cursor
foo-bquux  # dW:  non-whitespace then spaces right of cursor
quux       # daW: non-whitespace on both sides of cursor then spaces on the right
 quux      # diW: non-whitespace on both sides of cursor 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2017-11-10T16:44:50.620

不幸的是，插入模式没有这样的命令。在 VIM 中，要删除光标下的整个单词，您可以`viwd`在 NORMAL 模式下键入。这意味着“ **V** isual-block I **nner** Word **D****删除**”。使用大写`W`来包含标点符号。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-05-31T06:23:59.427

尝试重复删除单词时接受的答案失败，请尝试以下解决方案：

```
" delete current word, insert and normal modes
inoremap <C-BS> <C-O>b<C-O>dw
noremap <C-BS> bdw 
```

它映射 CTRL-BackSpace，也在正常模式下工作。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-07T10:18:51.137

删除光标前一定数量的字符，可以使用X。删除光标后一定数量的**单词**，可以使用dw（例如3个单词可以使用3dw删除多个单词）。一般来说，要在光标周围删除，您可以使用 daw。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-05-07T10:18:51.573

不确定您对“之前”和“之后”的用法，但您是否尝试过

```
dw 
```

?

编辑：我猜你正在寻找可以在插入模式下使用的东西。奇怪的是，在文档中找不到任何东西， ctrl-w 似乎就是全部。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-05-07T10:34:14.437

在旧的vi中，`b`将光标移动到光标之前的单词的开头，将光标`w`移动到光标之后的单词的开头，将光标移动到光标之后的`e`单词的末尾并`dw`从光标删除到单词的末尾。

如果键入`wbdw`，则删除光标周围的单词，即使光标位于单词的开头或结尾。请注意，单词后的空格被认为是要删除的单词的一部分。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-01-19T17:16:16.703

我做了两个映射，所以我可以在插入和退出插入模式下获得一致性。

`:map <'Key of your choice'> caw`

`:imap <'Key of your choice'> <'Esc'> caw`

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-04-03T02:36:34.407

> 我不仅想删除光标之前的单词，还想删除光标之后或周围的单词。

在这种情况下，OP（即使用）提出的解决方案`<c-w>`可以与接受的答案结合起来给出：

```
inoremap <c-d> <c-o>daw<c-w> 
```

或者（较短的解决方案）：

```
inoremap <c-d> <c-o>vawobd 
```

样本输入：

```
word1 word2 word3 word4
               ^------------- Cursor location 
```

输出：

```
word1 word4 
```

# sql - ant sql任务类路径问题

> ID：833844
> 
> 赞同：2
> 
> 时间：2009-05-07T10:16:02.267
> 
> 标签：sql, ant, classpath

我有以下蚂蚁`build.xml`：

```
<path id="antclasspath">
    <fileset dir="lib">
        <include name="*.jar"/>
    </fileset>
</path>

<property name="pathvar" refid="antclasspath" />
<echo message="Classpath is ${pathvar}"/>

<sql
    driver="oracle.jdbc.driver.OracleDriver"
    url="jdbc:oracle:thin:@myserver.hu:1521:dbid"
    userid="myuserid"
    password="mypassword"
    print="yes"
    classpathref="antclasspath">
    select * from table
</sql> 
```

lib 目录中有一个Oracle JDBC 驱动程序。Echo 正确打印出来：

```
Classpath is E:\MyDir\lib\ojdbc14-10_2_0_3.jar 
```

不知何故 sql ant 任务仍然无法加载 Oracle 驱动程序：

```
E:\MyDir\build.xml:100: Class Not Found: JDBC driver oracle.jdbc.driver.OracleDriver could not be loaded 
```

这个 build.xml 有什么问题？很奇怪，它昨天工作了几次，但再也没有工作过。

`classpath="E:\MyDir\lib\ojdbc14-10_2_0_3.jar"`在任务中使用会给出相同的错误消息。

我正在使用 ant 1.7.1（内置于 Netbeans 6.5）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T15:41:42.390

语法对我来说是正确的。尝试将`-v`开关传递给您的 ant 命令，这将指示`sql`任务打印出它正在使用的类路径。您应该会看到如下内容：

```
[sql] connecting to jdbc:oracle:thin:@myserver.hu:1521:dbid
[sql] Loading oracle.jdbc.driver.OracleDriver using AntClassLoader with classpath E:\MyDir\lib\ojdbc14-10_2_0_3.jar
[sql] Executing commands
[sql] SQL:  select * from dual
[sql] Processing new result set.
[sql] DUMMY
[sql] X

[sql] 0 rows affected
[sql] 0 rows affected
[sql] Committing transaction
[sql] 1 of 1 SQL statements executed successfully 
```

如果这没有帮助，您可以尝试传递`-debug`开关，这将打印出大量信息，包括类加载器调试。

最后，您是否确认您的 ojdbc jar 没有损坏，并且实际上包含 OracleDriver 类？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-07T12:28:25.007

尝试将类名更改为 oracle.jdbc.OracleDriver。oracle.jdbc.driver 包已被弃用，取而代之的是 oracle.jdbc。

[请参阅此处](http://www.oracle.com/technology/software/tech/java/sqlj_jdbc/htdocs/readme_10201.html)自述文件中的“旧的 oracle.jdbc.driver 包将消失”部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-07T10:50:23.417

您可以尝试使用 classpath 元素，而不是 classpathref 属性。

```
<sql ..params..>
  <classpath refid="antclasspath"/>
</sql> 
```

这就是我总是引用我的类路径的方式，而且我从来没有遇到任何问题。

# silverlight - 如何将 Silverlight 应用程序添加到我的网页？

> ID：833849
> 
> 赞同：0
> 
> 时间：2009-05-07T10:17:45.130
> 
> 标签：silverlight

我创建了一个网站。如何将我的 Silverlight 应用程序添加到其中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T10:30:50.357

要使用 html 将 Silverlight 应用程序添加到您的页面，请按照[此处](http://msdn.microsoft.com/en-us/library/cc189089(VS.95).aspx)列出的步骤进行操作。通过快速的谷歌搜索，您可以找到如何在 asp、asp.net 等中嵌入 silverlight...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T10:33:06.547

Visual Studio 在嵌入 silverlight 应用程序的 html 页面中自动生成此代码

```
 ```
<div id="silverlightControlHost">
    <object data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%">
        <param name="source" value="SilverlightApplication1.xap"/>
        <param name="onerror" value="onSilverlightError" />
        <param name="background" value="white" />
        <param name="minRuntimeVersion" value="2.0.31005.0" />
        <param name="autoUpgrade" value="true" />
        <a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;">
            <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none"/>
        </a>
    </object>
    <iframe style='visibility:hidden;height:0;width:0;border:0px'></iframe>
</div> 
``` apache - foo.com/city/staticpage-cityname.html --> foo.com/staticpage-cityname.html

ID：833867

赞同：0

时间：2009-05-07T10:21:34.357

标签：apache, mod-rewrite, url-rewriting

我目前的解决方案是将所有内容都放在站点根目录中，尽管它提供了理想的结果，但它已经挤满了我的根文件夹（超过 200 个城市）。我想将所有城市放在 /root/cities/ 文件夹中并重写，使其看起来像在根文件夹中。

www.foo.com/cities/citypage(.html) 到 www.foo.com/citypage(.html)

            回答 #1

赞同：0

时间：2009-05-07T11:31:34.860

您可以使用规则来检查文件夹中是否存在这样的`cities`文件：

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{DOCUMENT_ROOT}cities%{REQUEST_URI} -f
RewriteRule !^cities/ cities%{REQUEST_URI} [L]

RewriteCond %{THE_REQUEST} ^GET\ /cities/([^\s?]*)
RewriteRule ^cities/ /%1 [L,R=301] 
```

        c# - 以编程方式将 Word 文件另存为图片

ID：833880

赞同：3

时间：2009-05-07T10:26:32.567

标签：c#, .net, wpf, ms-word

我想将 Word 文档的第一页另存为图片。用 C# 有什么方法可以做到这一点？

            回答 #1

赞同：2

时间：2009-05-07T11:53:39.190

您可以将 word 文档打印到 XPS 文档，在 WPF (.Net 3.5) 应用程序中打开它，然后使用 WPF 框架的文档和图像功能将第一个内部 FixedPage 对象转换为位图。如果您安装了 .Net 3 框架（可能是 3.5，我不确定），则可以使用 XPS 文档打印机。

            回答 #2

赞同：0

时间：2009-05-07T10:46:33.847

您可以将 Word 文件转换为 PDF（使用免费提供的转换器之一），或打印到 Postscript（Windows 打印机驱动程序）。然后将 PDF 或 PS 转换为图像，例如使用 ImageMagick 的*转换*命令或 ghostscript。

[http://www.imagemagick.org/](http://www.imagemagick.org/)

[http://pages.cs.wisc.edu/~ghost/](http://pages.cs.wisc.edu/~ghost/)

        c++ - 嵌套函数调用求值顺序

ID：833882

赞同：9

时间：2009-05-07T10:27:20.397

标签：c++

众所周知，函数参数的评估顺序未指定，并且在不同的编译器之间可能有所不同。

似乎不太清楚的是函数调用是否可以交错，在以下意义上：

```
f(g(h()), i(j())) 
```

假设编译器选择首先评估 f 的第一个参数。编译器可以在调用和`j`之间自由调用吗？我相信是这样，但我不知道在哪里可以找到标准中的确认。`h``g`

            回答 #1

赞同：14

时间：2009-05-07T10:39:58.650

评估顺序未指定 - 请参阅标准的第 5.2.2/8 节：

参数的评估顺序未指定。参数表达式评估的所有副作用在输入函数之前生效。

            回答 #2

赞同：3

时间：2009-05-07T10:35:07.353

我不知道标准说什么，但我认为如果它对你很重要，那么你可能应该重新安排代码，以便你知道按什么顺序会发生什么（临时变量是你的朋友）。即使您弄清楚标准所说的内容，并且如果我们假设您的编译器正确实现了该标准，您仍然会留下维护时间炸弹，因为您的继任者不会知道您所做的一切。

            回答 #3

赞同：2

时间：2009-05-07T10:33:29.867

标准未指定评估顺序。它仅取决于您的编译器。

            回答 #4

赞同：0

时间：2009-05-07T10:55:42.827

如果您在同一个表达式中使用的函数在某种程度上相关（一个会影响另一个的结果），那么不同的调用顺序会产生不同的结果，那么请避免在表达式中使用嵌套函数。

我这样做是一种很好的做法，正是因为正如另一个人所说，调用顺序是未定义的（如果优化器认为它会更优化，你甚至可以交错执行）。

        jquery - 奇怪的 Chrome 原型/jQuery 冲突

ID：833883

赞同：25

时间：2009-05-07T10:27:20.803

标签：jquery, google-chrome, prototypejs, conflict

我们有一个带有依赖原型的遗留代码的应用程序，但我们发现它对于我们想要使用它的大多数地方来说太“重”了，并且发现 jQuery 更适合我们的工作方式。所以我们正在迁移到 jQuery 以获得新功能。

与此同时，我们有几个页面需要加载这两个库：

```
<script language="javascript" type="text/javascript"
        src="prototype-1.5.1.2.js"></script> 
<script language="javascript" type="text/javascript"  
        src="jquery-1.3.2.js"></script> 
<script language="javascript" type="text/javascript">
    $j = jQuery.noConflict();
</script> 
```

（请注意旧版本的原型，我们发现在逐步淘汰它时我们不想修复的升级问题）

这适用于 IE6、IE7、IE8-as-7 和 FX3，但在 Chrome 中加载它并且所有 jQuery 的东西都失败了。

加载开发者 JavaScript 控制台会显示以下错误：

```
Uncaught Error: NOT_SUPPORTED_ERR: DOM Exception 9 http://.../prototype-1.5.1.2.js (line 1272)
Uncaught TypeError: Object #<an Object> has no method 'ready' http://.../lib.js (line 161)
Uncaught TypeError: Object #<an Object> has no method 'slideUp' http://.../page.aspx (line 173)
... and so on - all the failures are missing jQuery methods 
```

所以这看起来像是原型中的冲突，导致 jQuery 对象的创建失败。

特定的原型问题似乎是 Prototype.BrowserFeatures.XPath 不应该为真，因为不支持 XPath document.evaluate。

好的，现在**在打开 javascript 控制台的情况下重新加载页面 - 一切正常！**怎么回事？关闭控制台，重新加载，它再次失败。

只有在没有打开 javascript 控制台的情况下发生页面加载时才会发生故障 - 为什么会有任何区别？这看起来很像 Chrome 中的一个错误。

任何人都能够解释出了什么问题？为什么原型中的错误会导致 jQuery init 失败？为什么在打开控制台的情况下加载页面使其工作？

有人知道一个好的解决方法吗？（除了升级到prototype-1.6.0.3.js，它修复了这个问题，但在其他地方打破了遗留代码的负载）

            回答 #1

赞同：45

时间：2009-05-07T20:45:39.147

来自[Core/jQuery.noConflict](http://docs.jquery.com/Core/jQuery.noConflict)：

注意：此函数必须在包含 jQuery javascript 文件之后调用，但在包含任何其他冲突库**之前**，以及在实际使用其他冲突库之前，以防最后包含 jQuery。可以在 jQuery.js 文件的末尾调用 noConflict 来全局禁用 $() jQuery 别名。jQuery.noConflict 返回一个对 jQuery 的引用，因此它可以用来覆盖 jQuery 对象的 $() 别名。

也许尝试将其更改为：

```
<script language="javascript" type="text/javascript"
  src="jquery-1.3.2.js"></script> 
<script language="javascript" type="text/javascript">
    $j = jQuery.noConflict();
</script>
<script language="javascript" type="text/javascript"
  src="prototype-1.5.1.2.js"></script> 
```

            回答 #2

赞同：10

时间：2009-12-16T15:11:16.937

我发现这个问题的根源是：

1.  Prototype 加载，并且由于 WebKit 缺少`document.getElementsByClass()`， Prototype （偷偷地）创建它。

2.  jQuery 初始化开始，在最顶部，它设置`window.$`为`jQuery`.

3.  在 JQuery 的初始化期间，Sizzle 引擎（在 1.3.2 中添加？）初始化。作为自省的一部分，它会检查并测试`document.getElementsByClass()`. 结果，它调用了 Prototype 的实现`getElementsByClass()`，这取决于`window.$`设置为 Prototype 的`$`，而不是 jQuery 的。

最终，这将需要在 jQuery 中修复（请参阅票证[http://bugs.jquery.com/ticket/4365](http://bugs.jquery.com/ticket/4365)和[5027](http://bugs.jquery.com/ticket/5027)）。我的快速补丁是删除 jQuery 初始化顶部的分配`window.$`。

        asp.net - 为什么只读文本框在 ASP.NET 中不返回任何数据？

ID：833884

赞同：21

时间：2009-05-07T10:27:38.633

标签：asp.net, textbox, readonly

我已将文本框设置为只读。当用户单击它时，会显示一个日历，并且用户选择输入到只读文本框中的日期。

但是当我尝试将数据输入数据库时​​，它显示空值。怎么了？

            回答 #1

赞同：55

时间：2009-05-07T10:31:29.420

`Readonly`当涉及到 ASP.NET属性和`readonly`HTML 输入元素的属性时，有一点奇怪。与其设置 Web 控件的属性，不如`Readonly`尝试简单地将 HTML 属性添加到控件，如下所示：

```
textBox.Attributes.Add("readonly", "readonly"); 
```

这将使该控件在客户端浏览器中为只读，但仍允许您在输入回发到服务器时检索输入的值。

            回答 #2

赞同：3

时间：2009-05-07T10:33:56.747

系统假定只读或禁用控件不会在客户端更改，因此它不会将更改的值发布回服务器。您需要设置客户端只读属性而不是服务器端版本。

            回答 #3

赞同：2

时间：2017-05-02T10:39:44.433

ASP.NET 假定 Web 控件的 Readonly 和 Enabled="false" 属性不会改变。因此，它不会回发上面汤姆提到的值。您可以使用此解决方法。将此添加到 html 中，您不必担心 Readonly 属性或禁用控件。

```
 onkeydown="return false;" 
```

            回答 #4

赞同：0

时间：2011-08-19T10:36:04.433

或者您可以将 ASP 文本框替换为带有 runat="Server" 的输入类型文本，然后将只读属性添加为只读。检查链接

[通过客户端脚本更改时访问服务器端只读文本框值的解决方法](https://stackoverflow.com/questions/7106000/accessing-the-textbox-value-modfied-by-the-javascript-with-readonly-property-true)

        java - 以给定的执行时间启动线程

ID：833889

赞同：4

时间：2009-05-07T10:29:29.363

标签：java, multithreading, timer, kill, execution

我的主进程调用了一个外部库方法。此方法有时会挂起。我无法修复外部库，因为另一家公司负责它。

我想使用一个线程来调用具有定义的执行计时器的库。当方法调用需要很长时间时，放置方法调用的具有 Runnable 的线程应该停止，主进程应该继续前进。

1.  主线程等待
2.  执行线程

    *   start 启动定时器线程

    *   当计时器线程完成时，杀死执行线程

3.  执行线程停止主
4.  线程恢复

有人有这个逻辑的代码，我可以使用的设计模式或我可以阅读一些信息的互联网页面吗？

谢谢

            回答 #1

赞同：2

时间：2009-05-07T10:42:32.123

这将等待线程完成最多 30 秒。

```
Thread t = new Thread() {
  public void run() {
    badExternalMethod();
    synchronized (this) {
      notifyAll();
    }
  }
};

synchronized (t) {
  t.start();
  try {
    t.wait(30000); // 30 secs
  } catch (InterruptedException e) {
    e.printStackTrace();
  }
} 
```

// t 已完成或超时

            回答 #2

赞同：2

时间：2009-05-11T11:04:10.583

查看`java.lang.concurrent`Java 5 及更高版本中的包，特别是`CompletionService`接口和实现它的类。

此接口包括允许您提交任务并等待它完成或在超时后继续的调用。

            回答 #3

赞同：1

时间：2009-05-07T10:52:28.527

您将无法神奇地使正在运行的线程在 30 秒后停止；您需要做的是让该线程在时间结束后检查某些状态，注意它花费的时间太长并且`return`来自其运行方法。

大致有两种方法可以做到这一点：

1.  让库调用线程在每个花费少量时间的“块”中执行其操作，并检查每个块之间的状态。例如，如果您正在处理数十万条记录，您可能会在一批中处理数百条记录，然后检查标志。或者，如果您正在使用超时可用的潜在阻塞调用，请将超时设置为 500 毫秒并检查每次调用之间的标志。
2.  让主线程在时间到时中断库调用线程，并确保库线程正确处理中断并在这种情况下检查标志。这将要求库调用线程执行可中断的方法，尽管任何可能长时间运行的方法都应允许中断。

在这两种情况下，您都需要让其中一个线程（可能是主线程，因为它无事可做）将“停止”标志设置为`true`一旦时间到了（并且这个变量应该被声明为 volatile 所以更新是所有线程都看到）。同样，当库调用线程看到这个标志为真时，它应该停止它正在做的事情，通常通过从 run() 方法返回。

您不应该真正从主线程中杀死库线程；请参阅[Why are Thread.stop, Thread.suspend and Thread.resume Deprecated](http://java.sun.com/javase/6/docs/technotes/guides/concurrency/threadPrimitiveDeprecation.html)的原因，以及看起来与我上面描述的非常相似的替代方案。:-)

        .net - DLLImport'ed / P/Invoke'd win32 dll 中/带有自定义类型？

ID：833890

赞同：1

时间：2009-05-07T10:30:04.837

标签：.net, winapi, pinvoke, types, dllimport

下午好，

我目前正在与一个旧的 .dll 搏斗，我必须在 .Net 应用程序中重新使用该功能，到目前为止，我导入了返回 bool 等的基本/简单函数/方法，但实际上有些人确实也期望（或return) 在 .dll 中声明的类型。

我将如何处理？我将如何在我的 .net 环境中映射/创建该类型？这有可能吗？

干杯和感谢，-Jörg

            回答 #1

赞同：1

时间：2009-05-07T10:37:33.337

通过“类型”，我假设您的意思是结构，否则您必须找出如何将内存中的结构映射到您的类型。

您必须在 .NET 应用程序中创建相同的结构，并用`StructLayout`属性标记它（`LayoutKind.Sequential`最常见）。然后你应该能够传递对结构的引用。

MSDN 上的[Platform Invoke Tutorial](http://msdn.microsoft.com/en-us/library/aa288468.aspx#pinvoke_custommarshaling)也很有帮助。

            回答 #2

赞同：0

时间：2009-05-07T10:35:25.930

我的理解是，您通常会使用一些`[StructLayout]`选项（顺序或显式）在 .NET 代码中创建一个反映预期数据布局的结构 - 并将该结构传递到 PInvoke 边界（即在导入的 API 上）。

            回答 #3

赞同：0

时间：2009-05-07T10:39:24.830

我不知道这是不是你想要的，但我会试一试！

我在我的一个应用程序（ASP.NET）中使用了一个delphi dll，我必须创建一个包装器，我知道对于winforms不需要创建包装器DLL但是你需要映射方法，我正在粘贴2该 DLL 中的方法以及如何调用它们：

```
 #region DllImport

    [DllImport("LicenseInterface.dll", CallingConvention = CallingConvention.StdCall,
               CharSet = CharSet.Auto, EntryPoint = "EncodeString")]
    private static extern int _EncodeString(
        [MarshalAs(UnmanagedType.LPStr)] string secret,
        [MarshalAs(UnmanagedType.LPWStr)] string str,
        [MarshalAs(UnmanagedType.LPWStr)] StringBuilder encodedStr,
        int encodedBufferSize);

    [DllImport("LicenseInterface.dll", CallingConvention = CallingConvention.StdCall,
               CharSet = CharSet.Auto, EntryPoint = "DecodeString")]
    private static extern int _DecodeString(
        [MarshalAs(UnmanagedType.LPStr)] string secret,
        [MarshalAs(UnmanagedType.LPWStr)] string str,
        [MarshalAs(UnmanagedType.LPWStr)] StringBuilder decodedStr,
        int decodedBufferSize);

    #endregion

    public static int EncodeString(string str, ref string encodedStr)
    {
        StringBuilder _encodedString = new StringBuilder(2000);
        int ret = _EncodeString("aYs6aL9b8722XXe43", str, _encodedString, _encodedString.Capacity);
        encodedStr = _encodedString.ToString();
        return ret;
    }

    public static int DecodeString(string str, ref string decodedStr)
    {
        StringBuilder _decodedString = new StringBuilder(2000);
        int ret = _DecodeString("aYs6aL9b8722XXe43", str, _decodedString, _decodedString.Capacity);
        decodedStr = _decodedString.ToString();
        return ret;
    }

public License()
{
   // code...
   License.DecodeKey(moduleKey, ref serial, ref moduleId, ref expirationDate, ref userData);
   // more code...
} 
```

        hardware - 这里有什么多核优势吗？

ID：833908

赞同：0

时间：2009-05-07T10:34:14.123

标签：hardware, load, scalability, multicore, concurrency

让我这样构图。。

“假设我有一个在单核 Intel 处理器上运行的应用程序服务器并为 200 个并发用户提供服务。将硬件移动到双核系统是否可以让我的应用程序服务器现在为 350 个并发用户提供服务”？

我希望解决的基本问题是——“添加额外的处理器内核是否有助于提高服务器的 I/O 能力”。因为有时这正是硬件供应商在吹捧他们的多核服务器时所暗示的。

            回答 #1

赞同：3

时间：2009-05-07T10:48:29.893

你必须分析你的服务器，确定它的瓶颈，然后处理它们。

如果您受内存限制，请购买更多内存或购买内存更快的计算机。

如果您受磁盘限制，并且提供大量静态内容，请考虑使用 SSD 驱动器。

如果它是您的数据库绑定，请考虑这一点。

但通常你是“配置绑定”的，并且调整你的配置，例如改变池中的线程数，等等，会给你带来立竿见影的改进。

许多网络服务器和数据库正是为利用额外内核而编写的软件。当然，许多还收取每个内核的许可费，所以也要考虑这个方面。

            回答 #2

赞同：1

时间：2009-05-07T10:44:27.953

您可能会或可能不会看到好处，但由于 CPU 并没有真正执行 I/OI，因此不会期望任何显着的好处是任务主要受 I/O 限制。

编辑：我的回答假设您的代码是这样编写的，您实际上是在使用多个内核。如果不是这样，您的应用程序将不会受益于额外的内核，但机器将更好地为其他同时执行的任务提供服务。

            回答 #3

赞同：0

时间：2009-05-07T10:43:29.827

当然，这取决于您的应用程序服务器是如何编写的。如果软件不使用任何并行编程技术，那么即使硬件支持这样做，您也无法并行运行它。

            回答 #4

赞同：0

时间：2009-05-08T12:53:56.720

如果您的服务器是单线程的（使用基于选择的 IO），并且请求处理是无副作用的（即它可以在概念上并行化），那么在多核机器上运行（匹配）多个实例肯定会最大化计算效用机器。  

这是否转化为更高的吞吐量取决于请求处理是否受 CPU 限制。根据经验，IO 是分布式系统的主要瓶颈。但话虽如此，如果（请求）消息组装需要大量计算，那么每个请求都会有一定的给定 CPU 开销，超出 IO 成本。在这种情况下，拥有多个 CPU 辅助显然会有所作为。  

除了协议级别的考虑之外，显然如果处理每个请求都需要大量计算，那么 CPU 瓶颈将影响服务器的可用性。使用多个 CPU 显然会有所帮助。

        visual-studio - Visual Studio 停止自动更新引用

ID：833924

赞同：1

时间：2009-05-07T10:39:13.583

标签：visual-studio, reference

我正在为我的 bin 文件夹中的 Visual Studio 项目引用一个 dll (ICSharpCode.SharpZipLib.dll)，我要使用的版本是 0.5.0.0。但是，当我运行该项目时，dll 被替换为更新的 0.85.4.369，这与我拥有的一些库不兼容。

如何阻止 Visual Studio 对引用进行自动更新？

            回答 #1

赞同：3

时间：2009-05-07T10:44:44.537

这仅对网站有效 - 查看项目的 bin 文件夹并检查那里是否有一个名为 ICSharpCode.SharpZipLib.dll.refresh 的文件。删除它，VS 将不会在您构建站点时查找新版本的程序集。

            回答 #2

赞同：0

时间：2009-05-07T10:40:52.283

没有自动更新。更高版本必须在 GAC 中。

        inheritance - 自定义 TreeNode 和 SelectNodeChanged

ID：833926

赞同：0

时间：2009-05-07T10:39:25.360

标签：inheritance, treeview, treenode

我正在研究 asp.net，并且我编写了一个自定义 TreeNode (customTreeNode)，用于填充 TreeView。

触发 selectnodechanged 事件时会出现问题，该事件给了我一个 TreeNode 对象而不是 customTreeNode。我似乎也无法投射它。

这是我填充树的方式：

```
 node.ChildNodes.Add
                (
                    customTreeNode = new customTreeNode(site)
                ); 
```

我的 customTreeNode 类：

```
public class customTreeNode : TreeNode
    {
       public Guid Id { get; set; }
        private SPWebEntry _dataContext;
        public SPWebEntry DataContext
        {
            get
            {
                return _dataContext;
            }
        }

        public customTreeNode(SPWebEntry DataContext)
        {
            _dataContext = DataContext;

            this.Text = _dataContext.Title;
            this.Id = _dataContext.Id;
        }
} 
```

和事件

```
 void treeViewSiteCollection_SelectedNodeChanged(object sender, EventArgs e)
        {
            treeViewSiteCollection.SelectedNode;
        } 
```

`treeViewSiteCollection.SelectedNode`是 TreeNode 类型，我无法转换它。

            回答 #1

赞同：0

时间：2010-03-22T11:09:12.677

您必须扩展树本身也检查这篇文章
[http://forums.asp.net/p/1109208/1713613.aspx#1713613](http://forums.asp.net/p/1109208/1713613.aspx#1713613)

        dictionary - YAML：空值字典

ID：833927

赞同：56

时间：2009-05-07T10:39:42.130

标签：dictionary, map, yaml

如何在 YAML 中编写一个字典（映射），其中一个键具有空字符串作为其值？

            回答 #1

赞同：73

时间：2009-05-07T18:49:59.190

```
key: 
```

被解析为 null -

```
%YAML 1.1
---
!!map {
    ? !!str "key"
    : !!null "null",
} 
```

正确答案是：

```
key: "" 
```

        c# - 在 Silverlight 中制作造型图+页面布局应用程序

ID：833928

赞同：0

时间：2009-05-07T10:39:51.817

标签：c#, silverlight

在silverlight中创建页面布局/形状绘图、缩放、保存到数据库应用程序的可行性是什么？

有谁知道我在哪里可以找到一些关于我需要知道的课程/概念的好的学习材料？

我认为这将是一个有趣的项目。

提前致谢。

迈克尔

            回答 #1

赞同：0

时间：2010-07-28T11:02:22.213

这是一个很好的起点......   [http://www.silverlight.net/getstarted/](http://www.silverlight.net/getstarted/)

一般来说，虽然 Silverlight 应用程序并不意味着直接与数据库对话，但您可能需要考虑使用 WPF。

        java - 如何处理网络故障代码并恢复？

ID：833937

赞同：0

时间：2009-05-07T10:41:52.843

标签：java, networking

假设我正在更新一些信息并且网络连接断开。

我应该如何编写代码来处理这种情况并从代码上次执行的位置恢复？

我能想到的一种可能的方法是捕捉异常。并再次重做逻辑。

虽然（网络问题）{

网络问题=假；尝试{

//step 1 - 从 db 读取信息 //step 2 - 存储在类对象上 //step 3 - 更新信息 //step 4 - 连接到另一个网络服务器 //step 5 - 更新信息

}catch(NetworkgoneException){ NetworkProblem = true; 

   // 尝试再次连接 - 这又是我不知道需要多长时间。}

}

            回答 #1

赞同：2

时间：2009-05-07T10:50:03.573

原则上，您的方法似乎没问题。需要考虑的几点：

*   您不想无限期地重试。有一些最大重试次数，然后中止。
*   对于加分，区分值得重试的错误和不值得重试的错误（例如权威的否定 DNS 响应）。
*   想想你在沟通中想要完成什么。如果有些数据通过而有些不通过怎么办？您是否需要某种事务概念来避免触发重复操作？

        sql-server - sql server 2005 问题

ID：833940

赞同：-4

时间：2009-05-07T10:42:33.060

标签：sql-server, sql-server-2005

我需要使用 sql server 2005，我需要服务器和开发人员工具。

我的数据库包含 200 万条记录、20 个表和 30 个用户。

我需要什么版本的 sql server 2005？

            回答 #1

赞同：4

时间：2009-05-07T10:45:13.163

首先，您需要学习编写更好的主题行。我注意到这是你的习惯。这就是我投反对票的原因。

SQL Server 2005 Express 可以为您工作。SQL Server 2005 Developer Edition 适合您的开发人员使用，但不能用于生产。

为什么不使用 SQL Server 2008？为什么要从过去开始？

            回答 #2

赞同：1

时间：2009-05-07T10:43:57.237

您可以免费使用[SQL Server 2005 Express](http://www.microsoft.com/Sqlserver/2005/en/us/express.aspx)

            回答 #3

赞同：1

时间：2009-05-07T11:40:39.207

**快捷版**

在不知道您的数据大小的情况下，Express Edition 可能不是您所需要的，因为它具有以下限制：

*   4Gb 数据库大小
*   1 个 CPU
*   1Gb 内存。

**开发者版**

由于您将有 30 个用户连接到此实例，因此开发人员版将违反 Microsoft EULA，您很可能需要购买 SQL Server 2005 标准版或企业版。

但是，您可以使用工作站上的 Developer 版本来设计和开发数据库，​​然后将其部署到 Standard 或 Enterprise 版本的服务器上。

希望这可以帮助。

*   [开发者版许可](http://www.microsoft.com/sqlserver/2005/en/us/developer.aspx) 

        ruby - REXML 格式问题

ID：833942

赞同：2

时间：2009-05-07T10:42:50.047

标签：ruby, rexml

我正在使用 REXML 编辑 xml 文件，但在格式化时遇到了困难。

我的原始代码如下所示：

```
 file = File.new( destination)
  doc = REXML::Document.new file                         

  doc.elements.each("configuration/continuity2") do |element| 
    element.attributes["islive"]  =  "true"
    element.attributes["pagetitle"]  =  "#{@client.page_title}"
    element.attributes["clientname"]  =  "#{@client.name}"
  end

  doc.elements.each("configuration/continuity2/plans") do |element| 
    element.attributes["storebasedir"]  =  "#{@client.store_dir}"
  end 
```

我首先必须添加以下代码，因为 REXML 是添加单引号而不是双引号。我通过谷歌找到了以下内容：

```
 REXML::Attribute.class_eval( %q^
    def to_string
      %Q[#@expanded_name="#{to_s().gsub(/"/, '&quot;')}"]
    end
  ^ ) 
```

我还有一个问题是 REXML 正在重新格式化文档。

有没有办法阻止这种情况？

            回答 #1

赞同：0

时间：2011-04-07T23:46:17.310

看

[Ruby 将 XML 中的单引号转换为双引号](https://stackoverflow.com/questions/3927507/ruby-convert-single-quotes-to-double-quotes-in-xml)

这回答了你的问题

            回答 #2

赞同：0

时间：2009-08-14T10:26:38.697

关于引号：版本 3.1.7.3 允许您在元素上使用上下文 cattr_accessor。变更日志：

[http://www.germane-software.com/software/rexml/release.html](http://www.germane-software.com/software/rexml/release.html)（动态页面）

        c# - TextBox中的水印/提示/占位符文本？

ID：833943

赞同：293

时间：2009-05-07T10:42:50.140

标签：c#, wpf, textbox, watermark, hint

当用户在其中输入内容时，如何将一些文本放入`TextBox`将自动删除的文本？

            回答 #1

赞同：455

时间：2009-05-07T19:10:55.710

您可以创建一个可以添加到任何`TextBox`具有附加属性的水印。以下是附加属性的来源：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Documents;

/// <summary>
/// Class that provides the Watermark attached property
/// </summary>
public static class WatermarkService
{
    /// <summary>
    /// Watermark Attached Dependency Property
    /// </summary>
    public static readonly DependencyProperty WatermarkProperty = DependencyProperty.RegisterAttached(
       "Watermark",
       typeof(object),
       typeof(WatermarkService),
       new FrameworkPropertyMetadata((object)null, new PropertyChangedCallback(OnWatermarkChanged)));

    #region Private Fields

    /// <summary>
    /// Dictionary of ItemsControls
    /// </summary>
    private static readonly Dictionary<object, ItemsControl> itemsControls = new Dictionary<object, ItemsControl>();

    #endregion

    /// <summary>
    /// Gets the Watermark property.  This dependency property indicates the watermark for the control.
    /// </summary>
    /// <param name="d"><see cref="DependencyObject"/> to get the property from</param>
    /// <returns>The value of the Watermark property</returns>
    public static object GetWatermark(DependencyObject d)
    {
        return (object)d.GetValue(WatermarkProperty);
    }

    /// <summary>
    /// Sets the Watermark property.  This dependency property indicates the watermark for the control.
    /// </summary>
    /// <param name="d"><see cref="DependencyObject"/> to set the property on</param>
    /// <param name="value">value of the property</param>
    public static void SetWatermark(DependencyObject d, object value)
    {
        d.SetValue(WatermarkProperty, value);
    }

    /// <summary>
    /// Handles changes to the Watermark property.
    /// </summary>
    /// <param name="d"><see cref="DependencyObject"/> that fired the event</param>
    /// <param name="e">A <see cref="DependencyPropertyChangedEventArgs"/> that contains the event data.</param>
    private static void OnWatermarkChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        Control control = (Control)d;
        control.Loaded += Control_Loaded;

        if (d is ComboBox)
        {
            control.GotKeyboardFocus += Control_GotKeyboardFocus;
            control.LostKeyboardFocus += Control_Loaded;
        }
        else if (d is TextBox)
        {
            control.GotKeyboardFocus += Control_GotKeyboardFocus;
            control.LostKeyboardFocus += Control_Loaded;
            ((TextBox)control).TextChanged += Control_GotKeyboardFocus;
        }

        if (d is ItemsControl && !(d is ComboBox))
        {
            ItemsControl i = (ItemsControl)d;

            // for Items property  
            i.ItemContainerGenerator.ItemsChanged += ItemsChanged;
            itemsControls.Add(i.ItemContainerGenerator, i);

            // for ItemsSource property  
            DependencyPropertyDescriptor prop = DependencyPropertyDescriptor.FromProperty(ItemsControl.ItemsSourceProperty, i.GetType());
            prop.AddValueChanged(i, ItemsSourceChanged);
        }
    }

    #region Event Handlers

    /// <summary>
    /// Handle the GotFocus event on the control
    /// </summary>
    /// <param name="sender">The source of the event.</param>
    /// <param name="e">A <see cref="RoutedEventArgs"/> that contains the event data.</param>
    private static void Control_GotKeyboardFocus(object sender, RoutedEventArgs e)
    {
        Control c = (Control)sender;
        if (ShouldShowWatermark(c))
        {
            ShowWatermark(c);
        }
        else
        {
            RemoveWatermark(c);
        }
    }

    /// <summary>
    /// Handle the Loaded and LostFocus event on the control
    /// </summary>
    /// <param name="sender">The source of the event.</param>
    /// <param name="e">A <see cref="RoutedEventArgs"/> that contains the event data.</param>
    private static void Control_Loaded(object sender, RoutedEventArgs e)
    {
        Control control = (Control)sender;
        if (ShouldShowWatermark(control))
        {
            ShowWatermark(control);
        }
    }

    /// <summary>
    /// Event handler for the items source changed event
    /// </summary>
    /// <param name="sender">The source of the event.</param>
    /// <param name="e">A <see cref="EventArgs"/> that contains the event data.</param>
    private static void ItemsSourceChanged(object sender, EventArgs e)
    {
        ItemsControl c = (ItemsControl)sender;
        if (c.ItemsSource != null)
        {
            if (ShouldShowWatermark(c))
            {
                ShowWatermark(c);
            }
            else
            {
                RemoveWatermark(c);
            }
        }
        else
        {
            ShowWatermark(c);
        }
    }

    /// <summary>
    /// Event handler for the items changed event
    /// </summary>
    /// <param name="sender">The source of the event.</param>
    /// <param name="e">A <see cref="ItemsChangedEventArgs"/> that contains the event data.</param>
    private static void ItemsChanged(object sender, ItemsChangedEventArgs e)
    {
        ItemsControl control;
        if (itemsControls.TryGetValue(sender, out control))
        {
            if (ShouldShowWatermark(control))
            {
                ShowWatermark(control);
            }
            else
            {
                RemoveWatermark(control);
            }
        }
    }

    #endregion

    #region Helper Methods

    /// <summary>
    /// Remove the watermark from the specified element
    /// </summary>
    /// <param name="control">Element to remove the watermark from</param>
    private static void RemoveWatermark(UIElement control)
    {
        AdornerLayer layer = AdornerLayer.GetAdornerLayer(control);

        // layer could be null if control is no longer in the visual tree
        if (layer != null)
        {
            Adorner[] adorners = layer.GetAdorners(control);
            if (adorners == null)
            {
                return;
            }

            foreach (Adorner adorner in adorners)
            {
                if (adorner is WatermarkAdorner)
                {
                    adorner.Visibility = Visibility.Hidden;
                    layer.Remove(adorner);
                }
            }
        }
    }

    /// <summary>
    /// Show the watermark on the specified control
    /// </summary>
    /// <param name="control">Control to show the watermark on</param>
    private static void ShowWatermark(Control control)
    {
        AdornerLayer layer = AdornerLayer.GetAdornerLayer(control);

        // layer could be null if control is no longer in the visual tree
        if (layer != null)
        {
            layer.Add(new WatermarkAdorner(control, GetWatermark(control)));
        }
    }

    /// <summary>
    /// Indicates whether or not the watermark should be shown on the specified control
    /// </summary>
    /// <param name="c"><see cref="Control"/> to test</param>
    /// <returns>true if the watermark should be shown; false otherwise</returns>
    private static bool ShouldShowWatermark(Control c)
    {
        if (c is ComboBox)
        {
            return (c as ComboBox).Text == string.Empty;
        }
        else if (c is TextBoxBase)
        {
            return (c as TextBox).Text == string.Empty;
        }
        else if (c is ItemsControl)
        {
            return (c as ItemsControl).Items.Count == 0;
        }
        else
        {
            return false;
        }
    }

    #endregion
} 
```

附加属性使用一个名为 的类`WatermarkAdorner`，这里是源：

```
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Media;

/// <summary>
/// Adorner for the watermark
/// </summary>
internal class WatermarkAdorner : Adorner
{
    #region Private Fields

    /// <summary>
    /// <see cref="ContentPresenter"/> that holds the watermark
    /// </summary>
    private readonly ContentPresenter contentPresenter;

    #endregion

    #region Constructor

    /// <summary>
    /// Initializes a new instance of the <see cref="WatermarkAdorner"/> class
    /// </summary>
    /// <param name="adornedElement"><see cref="UIElement"/> to be adorned</param>
    /// <param name="watermark">The watermark</param>
    public WatermarkAdorner(UIElement adornedElement, object watermark) :
       base(adornedElement)
    {
        this.IsHitTestVisible = false;

        this.contentPresenter = new ContentPresenter();
        this.contentPresenter.Content = watermark;
        this.contentPresenter.Opacity = 0.5;
        this.contentPresenter.Margin = new Thickness(Control.Margin.Left + Control.Padding.Left, Control.Margin.Top + Control.Padding.Top, 0, 0);

        if (this.Control is ItemsControl && !(this.Control is ComboBox))
        {
            this.contentPresenter.VerticalAlignment = VerticalAlignment.Center;
            this.contentPresenter.HorizontalAlignment = HorizontalAlignment.Center;
        }

        // Hide the control adorner when the adorned element is hidden
        Binding binding = new Binding("IsVisible");
        binding.Source = adornedElement;
        binding.Converter = new BooleanToVisibilityConverter();
        this.SetBinding(VisibilityProperty, binding);
    }

    #endregion

    #region Protected Properties

    /// <summary>
    /// Gets the number of children for the <see cref="ContainerVisual"/>.
    /// </summary>
    protected override int VisualChildrenCount
    {
        get { return 1; }
    }

    #endregion

    #region Private Properties

    /// <summary>
    /// Gets the control that is being adorned
    /// </summary>
    private Control Control
    {
        get { return (Control)this.AdornedElement; }
    }

    #endregion

    #region Protected Overrides

    /// <summary>
    /// Returns a specified child <see cref="Visual"/> for the parent <see cref="ContainerVisual"/>.
    /// </summary>
    /// <param name="index">A 32-bit signed integer that represents the index value of the child <see cref="Visual"/>. The value of index must be between 0 and <see cref="VisualChildrenCount"/> - 1.</param>
    /// <returns>The child <see cref="Visual"/>.</returns>
    protected override Visual GetVisualChild(int index)
    {
        return this.contentPresenter;
    }

    /// <summary>
    /// Implements any custom measuring behavior for the adorner.
    /// </summary>
    /// <param name="constraint">A size to constrain the adorner to.</param>
    /// <returns>A <see cref="Size"/> object representing the amount of layout space needed by the adorner.</returns>
    protected override Size MeasureOverride(Size constraint)
    {
        // Here's the secret to getting the adorner to cover the whole control
        this.contentPresenter.Measure(Control.RenderSize);
        return Control.RenderSize;
    }

    /// <summary>
    /// When overridden in a derived class, positions child elements and determines a size for a <see cref="FrameworkElement"/> derived class. 
    /// </summary>
    /// <param name="finalSize">The final area within the parent that this element should use to arrange itself and its children.</param>
    /// <returns>The actual size used.</returns>
    protected override Size ArrangeOverride(Size finalSize)
    {
        this.contentPresenter.Arrange(new Rect(finalSize));
        return finalSize;
    }

    #endregion
} 
```

现在您可以像这样在任何 TextBox 上添加水印：

```
<AdornerDecorator>
   <TextBox x:Name="SearchTextBox">
      <controls:WatermarkService.Watermark>
         <TextBlock>Type here to search text</TextBlock>
      </controls:WatermarkService.Watermark>
   </TextBox>
</AdornerDecorator> 
```

水印可以是您想要的任何东西（文本、图像......）。除了适用于 TextBoxes 之外，此水印还适用于 ComboBoxes 和 ItemControls。

此代码改编自此[博客文章](http://www.ageektrapped.com/blog/the-missing-net-4-cue-banner-in-wpf-i-mean-watermark-in-wpf/)。

            回答 #2

赞同：354

时间：2014-02-10T08:43:05.637

只使用 XAML，没有扩展，没有转换器：

```
<Grid>
    <TextBox  Width="250"  VerticalAlignment="Center" HorizontalAlignment="Left" x:Name="SearchTermTextBox" Margin="5"/>
    <TextBlock IsHitTestVisible="False" Text="Enter Search Term Here" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="10,0,0,0" Foreground="DarkGray">
        <TextBlock.Style>
            <Style TargetType="{x:Type TextBlock}">
                <Setter Property="Visibility" Value="Collapsed"/>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Text, ElementName=SearchTermTextBox}" Value="">
                        <Setter Property="Visibility" Value="Visible"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </TextBlock.Style>
    </TextBlock>
</Grid> 
```

            回答 #3

赞同：59

时间：2011-12-05T16:43:32.517

我不敢相信没有人发布明显的[扩展 WPF 工具包 -](https://github.com/xceedsoftware/wpftoolkit/wiki/WatermarkTextBox)来自 Xceed 的 WatermarkTextBox。它工作得很好，并且是开源的，以防你想定制。
编辑：虽然仍然是开源的，但这个库现在只能免费用于非商业用途，请参阅[定价](https://github.com/xceedsoftware/wpftoolkit/wiki/Xceed-Toolkit-Plus-for-WPF)和[许可证](https://github.com/xceedsoftware/wpftoolkit/blob/master/license.md)。

            回答 #4

赞同：56

时间：2009-05-07T10:46:57.167

这是一个演示如何在 WPF 中创建水印文本框的示例：

```
<Window x:Class="WaterMarkTextBoxDemo.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:WaterMarkTextBoxDemo"
    Height="200" Width="400">

    <Window.Resources>

        <SolidColorBrush x:Key="brushWatermarkBackground" Color="White" />
        <SolidColorBrush x:Key="brushWatermarkForeground" Color="LightSteelBlue" />
        <SolidColorBrush x:Key="brushWatermarkBorder" Color="Indigo" />

        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <local:TextInputToVisibilityConverter x:Key="TextInputToVisibilityConverter" />

        <Style x:Key="EntryFieldStyle" TargetType="Grid" >
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Margin" Value="20,0" />
        </Style>

    </Window.Resources>

    <Grid Background="LightBlue">

        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition />
            <RowDefinition />
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Background="{StaticResource brushWatermarkBackground}" Style="{StaticResource EntryFieldStyle}" >
            <TextBlock Margin="5,2" Text="This prompt dissappears as you type..." Foreground="{StaticResource brushWatermarkForeground}"
                       Visibility="{Binding ElementName=txtUserEntry, Path=Text.IsEmpty, Converter={StaticResource BooleanToVisibilityConverter}}" />
            <TextBox Name="txtUserEntry" Background="Transparent" BorderBrush="{StaticResource brushWatermarkBorder}" />
        </Grid>

        <Grid Grid.Row="1" Background="{StaticResource brushWatermarkBackground}" Style="{StaticResource EntryFieldStyle}" >
            <TextBlock Margin="5,2" Text="This dissappears as the control gets focus..." Foreground="{StaticResource brushWatermarkForeground}" >
                <TextBlock.Visibility>
                    <MultiBinding Converter="{StaticResource TextInputToVisibilityConverter}">
                        <Binding ElementName="txtUserEntry2" Path="Text.IsEmpty" />
                        <Binding ElementName="txtUserEntry2" Path="IsFocused" />
                    </MultiBinding>
                </TextBlock.Visibility>
            </TextBlock>
            <TextBox Name="txtUserEntry2" Background="Transparent" BorderBrush="{StaticResource brushWatermarkBorder}" />
        </Grid>

    </Grid>

</Window> 
```

TextInputToVisibilityConverter 定义为：

```
using System;
using System.Windows.Data;
using System.Windows;

namespace WaterMarkTextBoxDemo
{
    public class TextInputToVisibilityConverter : IMultiValueConverter
    {
        public object Convert( object[] values, Type targetType, object parameter, System.Globalization.CultureInfo culture )
        {
            // Always test MultiValueConverter inputs for non-null
            // (to avoid crash bugs for views in the designer)
            if (values[0] is bool && values[1] is bool)
            {
                bool hasText = !(bool)values[0];
                bool hasFocus = (bool)values[1];

                if (hasFocus || hasText)
                    return Visibility.Collapsed;
            }

            return Visibility.Visible;
        }

        public object[] ConvertBack( object value, Type[] targetTypes, object parameter, System.Globalization.CultureInfo culture )
        {
            throw new NotImplementedException();
        }
    }
} 
```

**注意：**这不是我的代码。我在[这里](http://www.codeproject.com/Articles/26977/A-WatermarkTextBox-in-lines-of-XAML)找到了它，但我认为这是最好的方法。

            回答 #5

赞同：34

时间：2013-05-21T09:47:47.247

[CodeProject](http://www.codeproject.com/Articles/26977/A-WatermarkTextBox-in-3-lines-of-XAML)上有一篇关于如何在“3行XAML”中进行操作的文章。

```
<Grid Background="{StaticResource brushWatermarkBackground}">
  <TextBlock Margin="5,2" Text="Type something..."
             Foreground="{StaticResource brushForeground}"
             Visibility="{Binding ElementName=txtUserEntry, Path=Text.IsEmpty,
                          Converter={StaticResource BooleanToVisibilityConverter}}" />
  <TextBox Name="txtUserEntry" Background="Transparent"
           BorderBrush="{StaticResource brushBorder}" />
</Grid> 
```

好的，它可能不是 3 行 XAML 格式，但它*非常*简单。
不过要注意的一点是，它在 Text 属性上使用了一种非标准的扩展方法，称为“IsEmpty”。你需要自己实现这个，但是文章似乎没有提到这一点。

            回答 #6

赞同：22

时间：2015-11-05T08:31:45.020

使用样式的简单解决方案：

```
<TextBox>
    <TextBox.Style>
        <Style TargetType="TextBox" xmlns:sys="clr-namespace:System;assembly=mscorlib">
            <Style.Resources>
                <VisualBrush x:Key="CueBannerBrush" AlignmentX="Left" AlignmentY="Center" Stretch="None">
                    <VisualBrush.Visual>
                        <Label Content="MM:SS:HH AM/PM" Foreground="LightGray" />
                    </VisualBrush.Visual>
                </VisualBrush>
            </Style.Resources>
            <Style.Triggers>
                <Trigger Property="Text" Value="{x:Static sys:String.Empty}">
                    <Setter Property="Background" Value="{StaticResource CueBannerBrush}" />
                </Trigger>
                <Trigger Property="Text" Value="{x:Null}">
                    <Setter Property="Background" Value="{StaticResource CueBannerBrush}" />
                </Trigger>
                <Trigger Property="IsKeyboardFocused" Value="True">
                    <Setter Property="Background" Value="White" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </TextBox.Style>
</TextBox> 
```

很好的解决方案：

[https://code.msdn.microsoft.com/windowsdesktop/In-place-hit-messages-for-18db3a6c](https://code.msdn.microsoft.com/windowsdesktop/In-place-hit-messages-for-18db3a6c)

            回答 #7

赞同：21

时间：2012-05-02T10:35:43.567

我看到了[John Myczek 的解决方案](https://stackoverflow.com/questions/833943/watermark-textbox-in-wpf/answer-836463#answer-836463)`ComboBox`，以及它对和的兼容性的评论`PasswordBox`，所以我改进了 John Myczek 的解决方案，这里是：

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Controls.Primitives;
using System.Windows.Documents;

/// <summary>
/// Class that provides the Watermark attached property
/// </summary>
public static class WatermarkService
{
    /// <summary>
    /// Watermark Attached Dependency Property
    /// </summary>
    public static readonly DependencyProperty WatermarkProperty = DependencyProperty.RegisterAttached(
       "Watermark",
       typeof(object),
       typeof(WatermarkService),
       new FrameworkPropertyMetadata((object)null, new PropertyChangedCallback(OnWatermarkChanged)));

    #region Private Fields

    /// <summary>
    /// Dictionary of ItemsControls
    /// </summary>
    private static readonly Dictionary<object, ItemsControl> itemsControls = new Dictionary<object, ItemsControl>();

    #endregion

    /// <summary>
    /// Gets the Watermark property.  This dependency property indicates the watermark for the control.
    /// </summary>
    /// <param name="d"><see cref="DependencyObject"/> to get the property from</param>
    /// <returns>The value of the Watermark property</returns>
    public static object GetWatermark(DependencyObject d)
    {
        return (object)d.GetValue(WatermarkProperty);
    }

    /// <summary>
    /// Sets the Watermark property.  This dependency property indicates the watermark for the control.
    /// </summary>
    /// <param name="d"><see cref="DependencyObject"/> to set the property on</param>
    /// <param name="value">value of the property</param>
    public static void SetWatermark(DependencyObject d, object value)
    {
        d.SetValue(WatermarkProperty, value);
    }

    /// <summary>
    /// Handles changes to the Watermark property.
    /// </summary>
    /// <param name="d"><see cref="DependencyObject"/> that fired the event</param>
    /// <param name="e">A <see cref="DependencyPropertyChangedEventArgs"/> that contains the event data.</param>
    private static void OnWatermarkChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        Control control = (Control)d;
        control.Loaded += Control_Loaded;

        if (d is TextBox || d is PasswordBox)
        {
            control.GotKeyboardFocus += Control_GotKeyboardFocus;
            control.LostKeyboardFocus += Control_Loaded;
        }
        else if (d is ComboBox)
        {
            control.GotKeyboardFocus += Control_GotKeyboardFocus;
            control.LostKeyboardFocus += Control_Loaded;
            (d as ComboBox).SelectionChanged += new SelectionChangedEventHandler(SelectionChanged);
        }
        else if (d is ItemsControl)
        {
            ItemsControl i = (ItemsControl)d;

            // for Items property  
            i.ItemContainerGenerator.ItemsChanged += ItemsChanged;
            itemsControls.Add(i.ItemContainerGenerator, i);

            // for ItemsSource property  
            DependencyPropertyDescriptor prop = DependencyPropertyDescriptor.FromProperty(ItemsControl.ItemsSourceProperty, i.GetType());
            prop.AddValueChanged(i, ItemsSourceChanged);
        }
    }

    /// <summary>
    /// Event handler for the selection changed event
    /// </summary>
    /// <param name="sender">The source of the event.</param>
    /// <param name="e">A <see cref="ItemsChangedEventArgs"/> that contains the event data.</param>
    private static void SelectionChanged(object sender, SelectionChangedEventArgs e)
    {
        Control control = (Control)sender;
        if (ShouldShowWatermark(control))
        {
            ShowWatermark(control);
        }
        else
        {
            RemoveWatermark(control);
        }
    }

    #region Event Handlers

    /// <summary>
    /// Handle the GotFocus event on the control
    /// </summary>
    /// <param name="sender">The source of the event.</param>
    /// <param name="e">A <see cref="RoutedEventArgs"/> that contains the event data.</param>
    private static void Control_GotKeyboardFocus(object sender, RoutedEventArgs e)
    {
        Control c = (Control)sender;
        if (ShouldShowWatermark(c))
        {
            RemoveWatermark(c);
        }
    }

    /// <summary>
    /// Handle the Loaded and LostFocus event on the control
    /// </summary>
    /// <param name="sender">The source of the event.</param>
    /// <param name="e">A <see cref="RoutedEventArgs"/> that contains the event data.</param>
    private static void Control_Loaded(object sender, RoutedEventArgs e)
    {
        Control control = (Control)sender;
        if (ShouldShowWatermark(control))
        {
            ShowWatermark(control);
        }
    }

    /// <summary>
    /// Event handler for the items source changed event
    /// </summary>
    /// <param name="sender">The source of the event.</param>
    /// <param name="e">A <see cref="EventArgs"/> that contains the event data.</param>
    private static void ItemsSourceChanged(object sender, EventArgs e)
    {
        ItemsControl c = (ItemsControl)sender;
        if (c.ItemsSource != null)
        {
            if (ShouldShowWatermark(c))
            {
                ShowWatermark(c);
            }
            else
            {
                RemoveWatermark(c);
            }
        }
        else
        {
            ShowWatermark(c);
        }
    }

    /// <summary>
    /// Event handler for the items changed event
    /// </summary>
    /// <param name="sender">The source of the event.</param>
    /// <param name="e">A <see cref="ItemsChangedEventArgs"/> that contains the event data.</param>
    private static void ItemsChanged(object sender, ItemsChangedEventArgs e)
    {
        ItemsControl control;
        if (itemsControls.TryGetValue(sender, out control))
        {
            if (ShouldShowWatermark(control))
            {
                ShowWatermark(control);
            }
            else
            {
                RemoveWatermark(control);
            }
        }
    }

    #endregion

    #region Helper Methods

    /// <summary>
    /// Remove the watermark from the specified element
    /// </summary>
    /// <param name="control">Element to remove the watermark from</param>
    private static void RemoveWatermark(UIElement control)
    {
        AdornerLayer layer = AdornerLayer.GetAdornerLayer(control);

        // layer could be null if control is no longer in the visual tree
        if (layer != null)
        {
            Adorner[] adorners = layer.GetAdorners(control);
            if (adorners == null)
            {
                return;
            }

            foreach (Adorner adorner in adorners)
            {
                if (adorner is WatermarkAdorner)
                {
                    adorner.Visibility = Visibility.Hidden;
                    layer.Remove(adorner);
                }
            }
        }
    }

    /// <summary>
    /// Show the watermark on the specified control
    /// </summary>
    /// <param name="control">Control to show the watermark on</param>
    private static void ShowWatermark(Control control)
    {
        AdornerLayer layer = AdornerLayer.GetAdornerLayer(control);

        // layer could be null if control is no longer in the visual tree
        if (layer != null)
        {
            layer.Add(new WatermarkAdorner(control, GetWatermark(control)));
        }
    }

    /// <summary>
    /// Indicates whether or not the watermark should be shown on the specified control
    /// </summary>
    /// <param name="c"><see cref="Control"/> to test</param>
    /// <returns>true if the watermark should be shown; false otherwise</returns>
    private static bool ShouldShowWatermark(Control c)
    {
        if (c is ComboBox)
        {
            return (c as ComboBox).SelectedItem == null;
            //return (c as ComboBox).Text == string.Empty;
        }
        else if (c is TextBoxBase)
        {
            return (c as TextBox).Text == string.Empty;
        }
        else if (c is PasswordBox)
        {
            return (c as PasswordBox).Password == string.Empty;
        }
        else if (c is ItemsControl)
        {
            return (c as ItemsControl).Items.Count == 0;
        }
        else
        {
            return false;
        }
    }

    #endregion
} 
```

现在，a`ComboBox`也可以`Editable`，也`PasswordBox`可以加水印。不要忘记使用上面 JoanComasFdz 的评论来解决边距问题。

当然，所有功劳都归功于 John Myczek。

            回答 #8

赞同：14

时间：2015-07-02T18:05:47.117

[这个库](https://github.com/JohanLarsson/Gu.Wpf.Adorners)有水印。

[Nuget 包](https://www.nuget.org/packages/Gu.Wpf.Adorners/)

示例用法：

```
<TextBox adorners:Watermark.Text="Write something here" 
         adorners:Watermark.TextStyle="{StaticResource AdornerTextStyle}"
         adorners:Watermark.VisibleWhen="EmptyAndNotKeyboardFocused"/> 
```

            回答 #9

赞同：9

时间：2011-02-01T09:37:35.277

我创建了简单的纯代码实现，它也适用于 WPF 和 Silverlight：

```
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Media;

public class TextBoxWatermarked : TextBox
{
    #region [ Dependency Properties ]

    public static DependencyProperty WatermarkProperty = DependencyProperty.Register
    (
         "Watermark",
         typeof(string),
         typeof(TextBoxWatermarked),
         new PropertyMetadata(new PropertyChangedCallback(OnWatermarkChanged))
    );

    #endregion

    #region [ Fields ]

    private bool _isWatermarked;
    private Binding _textBinding;

    #endregion

    #region [ Properties ]

    protected new Brush Foreground
    {
        get { return base.Foreground; }
        set { base.Foreground = value; }
    }

    public string Watermark
    {
        get { return (string)GetValue(WatermarkProperty); }
        set { SetValue(WatermarkProperty, value); }
    }

    #endregion

    #region [ .ctor ]

    public TextBoxWatermarked()
    {
        Loaded += (s, ea) => ShowWatermark();
    }

    #endregion

    #region [ Event Handlers ]

    protected override void OnGotFocus(RoutedEventArgs e)
    {
        base.OnGotFocus(e);
        HideWatermark();
    }

    protected override void OnLostFocus(RoutedEventArgs e)
    {
        base.OnLostFocus(e);
        ShowWatermark();
    }

    private static void OnWatermarkChanged(DependencyObject sender, DependencyPropertyChangedEventArgs ea)
    {
        var tbw = sender as TextBoxWatermarked;
        if (tbw == null) return;
        tbw.ShowWatermark();
    }

    #endregion

    #region [ Methods ]

    private void ShowWatermark()
    {
        if (string.IsNullOrEmpty(base.Text))
        {
            _isWatermarked = true;
            base.Foreground = new SolidColorBrush(Colors.Gray);
            var bindingExpression = GetBindingExpression(TextProperty);
            _textBinding = bindingExpression == null ? null : bindingExpression.ParentBinding;
            if (bindingExpression != null)
                bindingExpression.UpdateSource();
            SetBinding(TextProperty, new Binding());
            base.Text = Watermark;
        }
    }

    private void HideWatermark()
    {
        if (_isWatermarked)
        {
            _isWatermarked = false;
            ClearValue(ForegroundProperty);
            base.Text = "";
            SetBinding(TextProperty, _textBinding ?? new Binding());
        }
    }

    #endregion
} 
```

用法：

```
<TextBoxWatermarked Watermark="Some text" /> 
```

            回答 #10

赞同：7

时间：2011-06-23T13:03:48.880

[在将@john-myczek 的代码](https://stackoverflow.com/questions/833943/watermark-textbox-in-wpf/836463#836463)与绑定的TextBox 一起使用时，我遇到了一些困难。由于 TextBox 在更新时不会引发焦点事件，因此水印将在新文本下方保持可见。为了解决这个问题，我简单地添加了另一个事件处理程序：

```
if (d is ComboBox || d is TextBox)
{
    control.GotKeyboardFocus += Control_GotKeyboardFocus;
    control.LostKeyboardFocus += Control_Loaded;

    if (d is TextBox)
        (d as TextBox).TextChanged += Control_TextChanged;
}

private static void Control_TextChanged(object sender, RoutedEventArgs e)
{
    var tb = (TextBox)sender;
    if (ShouldShowWatermark(tb))
    {
        ShowWatermark(tb);
    }
    else
    {
        RemoveWatermark(tb);
    }
} 
```

            回答 #11

赞同：7

时间：2019-05-28T06:00:21.433

文本框水印的最简单方法

```
 <Window.Resources>
    <Style x:Key="MyWaterMarkStyle" TargetType="{x:Type TextBox}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type TextBox}">
                    <Grid>
                        <Border Background="White" BorderBrush="#FF7D8683" BorderThickness="1"/>
                        <ScrollViewer x:Name="PART_ContentHost" Margin="5,0,0,0" VerticalAlignment="Center" />
                        <Label Margin="5,0,0,0" x:Name="WaterMarkLabel" Content="{TemplateBinding Tag}" VerticalAlignment="Center"
                           Visibility="Collapsed" Foreground="Gray" FontFamily="Arial"/>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="Text" Value=""/>
                            </MultiTrigger.Conditions>
                            <Setter Property="Visibility" TargetName="WaterMarkLabel" Value="Visible"/>
                        </MultiTrigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Foreground" Value="DimGray"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</Window.Resources> 
```

并添加文本框 StaticResource 样式

```
 <TextBox
                Style="{StaticResource MyWaterMarkStyle}"
                Tag="Search Category"
                Grid.Row="0"
                Text="{Binding CategorySearch,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                TextSearch.Text="Search Category"
                > 
```

            回答 #12

赞同：5

时间：2011-03-25T14:37:32.977

@Veton - 我真的很喜欢你的解决方案的简单性，但我的声誉还不够高，无法让你大吃一惊。

@Tim Murphy - “双向绑定需要路径或 XPath”错误是一个简单的修复......更新的代码包括其他一些小调整（仅 WPF 测试）：

```
using System;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Media;

public class TextBoxWatermarked : TextBox
{
  public string Watermark
  {
    get { return (string)GetValue(WaterMarkProperty); }
    set { SetValue(WaterMarkProperty, value); }
  }
  public static readonly DependencyProperty WaterMarkProperty =
      DependencyProperty.Register("Watermark", typeof(string), typeof(TextBoxWatermarked), new PropertyMetadata(new PropertyChangedCallback(OnWatermarkChanged)));

  private bool _isWatermarked = false;
  private Binding _textBinding = null;

  public TextBoxWatermarked()
  {
    Loaded += (s, ea) => ShowWatermark();
  }

  protected override void OnGotFocus(RoutedEventArgs e)
  {
    base.OnGotFocus(e);
    HideWatermark();
  }

  protected override void OnLostFocus(RoutedEventArgs e)
  {
    base.OnLostFocus(e);
    ShowWatermark();
  }

  private static void OnWatermarkChanged(DependencyObject sender, DependencyPropertyChangedEventArgs ea)
  {
    var tbw = sender as TextBoxWatermarked;
    if (tbw == null || !tbw.IsLoaded) return; //needed to check IsLoaded so that we didn't dive into the ShowWatermark() routine before initial Bindings had been made
    tbw.ShowWatermark();
  }

  private void ShowWatermark()
  {
    if (String.IsNullOrEmpty(Text) && !String.IsNullOrEmpty(Watermark))
    {
      _isWatermarked = true;

      //save the existing binding so it can be restored
      _textBinding = BindingOperations.GetBinding(this, TextProperty);

      //blank out the existing binding so we can throw in our Watermark
      BindingOperations.ClearBinding(this, TextProperty);

      //set the signature watermark gray
      Foreground = new SolidColorBrush(Colors.Gray);

      //display our watermark text
      Text = Watermark;
    }
  }

  private void HideWatermark()
  {
    if (_isWatermarked)
    {
      _isWatermarked = false;
      ClearValue(ForegroundProperty);
      Text = "";
      if (_textBinding != null) SetBinding(TextProperty, _textBinding);
    }
  }

} 
```

            回答 #13

赞同：3

时间：2013-12-24T06:56:22.083

你可以使用`GetFocus()`和`LostFocus()`事件来做到这一点

这是示例：

```
 private void txtData1_GetFocus(object sender, RoutedEventArgs e)
    {
        if (txtData1.Text == "TextBox1abc")
        {
            txtData1.Text = string.Empty;
        }
    }

    private void txtData1_LostFocus(object sender, RoutedEventArgs e)
    {
        if (txtData1.Text == string.Empty)
        {
            txtData1.Text = "TextBox1abc";
        }
    } 
```

            回答 #14

赞同：2

时间：2016-01-15T13:43:50.883

如果您不想自己滚动，WPF 的[MahApps.Metro具有内置的水印控件。](http://mahapps.com/ "MahApps.Metro")使用起来相当简单。

```
 <AdornerDecorator>
            <TextBox Name="txtSomeText"
                     Width="200"
                     HorizontalAlignment="Right">
                <Controls:TextBoxHelper.Watermark>I'm a watermark!</Controls:TextBoxHelper.Watermark>
            </TextBox>
        </AdornerDecorator> 
```

            回答 #15

赞同：1

时间：2009-05-07T10:48:51.750

```
<Window.Resources>

    <Style x:Key="TextBoxUserStyle" BasedOn="{x:Null}" TargetType="{x:Type TextBox}">
      <Setter Property="Foreground" Value="Black"/>
      <Setter Property="HorizontalAlignment" Value="Center"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
      <Setter Property="Width" Value="225"/>
      <Setter Property="Height" Value="25"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="Padding" Value="1"/>
      <Setter Property="Margin" Value="5"/>
      <Setter Property="AllowDrop" Value="true"/>
      <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="{x:Type TextBox}">
            <Border x:Name="OuterBorder" BorderBrush="#5AFFFFFF" BorderThickness="1,1,1,1" CornerRadius="4,4,4,4">
              <Border x:Name="InnerBorder" Background="#FFFFFFFF" BorderBrush="#33000000" BorderThickness="1,1,1,1" CornerRadius="3,3,3,3">
                <ScrollViewer SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" x:Name="PART_ContentHost"/>
              </Border>
            </Border>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <Style x:Key="PasswordBoxVistaStyle" BasedOn="{x:Null}" TargetType="{x:Type PasswordBox}">
      <Setter Property="Foreground" Value="Black"/>
      <Setter Property="HorizontalAlignment" Value="Center"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
      <Setter Property="Width" Value="225"/>
      <Setter Property="Height" Value="25"/>
      <Setter Property="FontSize" Value="12"/>
      <Setter Property="Padding" Value="1"/>
      <Setter Property="Margin" Value="5"/>
      <Setter Property="AllowDrop" Value="true"/>
      <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="{x:Type PasswordBox}">
            <Border x:Name="OuterBorder" BorderBrush="#5AFFFFFF" BorderThickness="1,1,1,1" CornerRadius="4,4,4,4">
              <Border x:Name="InnerBorder" Background="#FFFFFFFF" BorderBrush="#33000000" BorderThickness="1,1,1,1" CornerRadius="3,3,3,3">
                <Grid>
                  <Label x:Name="lblPwd" Content="Password" FontSize="11" VerticalAlignment="Center" Margin="2,0,0,0" FontFamily="Verdana" Foreground="#828385" Padding="0"/>
                  <ScrollViewer SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" x:Name="PART_ContentHost"/>
                </Grid>
              </Border>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsFocused" Value="True">
                <Setter Property="Visibility" TargetName="lblPwd" Value="Hidden"/>
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>
  </Window.Resources>

        <PasswordBox Style="{StaticResource PasswordBoxVistaStyle}" Margin="169,143,22,0" Name="txtPassword" FontSize="14" TabIndex="2" Height="31" VerticalAlignment="Top" /> 
```

这可以帮助检查您的代码。当应用于密码框时，它将显示密码，当用户键入时它将消失。

            回答 #16

赞同：1

时间：2009-10-12T21:32:21.120

好吧，这是我的：不一定是最好的，但由于它很简单，因此很容易根据您的喜好进行编辑。

```
<UserControl x:Class="WPFControls.ShadowedTextBox"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:WPFControls"
    Name="Root">
<UserControl.Resources>
    <local:ShadowConverter x:Key="ShadowConvert"/>
</UserControl.Resources>
<Grid>
    <TextBox Name="textBox" 
             Foreground="{Binding ElementName=Root, Path=Foreground}"
             Text="{Binding ElementName=Root, Path=Text, UpdateSourceTrigger=PropertyChanged}"
             TextChanged="textBox_TextChanged"
             TextWrapping="Wrap"
             VerticalContentAlignment="Center"/>
    <TextBlock Name="WaterMarkLabel"
           IsHitTestVisible="False"
           Foreground="{Binding ElementName=Root,Path=Foreground}"
           FontWeight="Thin"
           Opacity=".345"
           FontStyle="Italic"
           Text="{Binding ElementName=Root, Path=Watermark}"
           VerticalAlignment="Center"
           TextWrapping="Wrap"
           TextAlignment="Center">
        <TextBlock.Visibility>
            <MultiBinding Converter="{StaticResource ShadowConvert}">
                <Binding ElementName="textBox" Path="Text"/>
            </MultiBinding>
        </TextBlock.Visibility> 
    </TextBlock>
</Grid> 
```

转换器，正如现在所写的那样，它不一定是 MultiConverter，但在这种情况下，它可以很容易地扩展

```
using System;
using System.Globalization;
using System.Windows;
using System.Windows.Data;

namespace WPFControls
{
    class ShadowConverter:IMultiValueConverter
    {
        #region Implementation of IMultiValueConverter

        public object Convert(object[] values, Type targetType, object parameter, CultureInfo culture)
        {
            var text = (string) values[0];
            return text == string.Empty
                       ? Visibility.Visible
                       : Visibility.Collapsed;
        }

        public object[] ConvertBack(object value, Type[] targetTypes, object parameter, CultureInfo culture)
        {
            return new object[0];
        }

        #endregion
    }
} 
```

最后是后面的代码：

```
using System.Windows;
using System.Windows.Controls;

namespace WPFControls
{
    /// <summary>
    /// Interaction logic for ShadowedTextBox.xaml
    /// </summary>
    public partial class ShadowedTextBox : UserControl
    {
        public event TextChangedEventHandler TextChanged;

        public ShadowedTextBox()
        {
            InitializeComponent();
        }

        public static readonly DependencyProperty WatermarkProperty =
            DependencyProperty.Register("Watermark",
                                        typeof (string),
                                        typeof (ShadowedTextBox),
                                        new UIPropertyMetadata(string.Empty));

        public static readonly DependencyProperty TextProperty =
            DependencyProperty.Register("Text",
                                        typeof (string),
                                        typeof (ShadowedTextBox),
                                        new UIPropertyMetadata(string.Empty));

        public static readonly DependencyProperty TextChangedProperty =
            DependencyProperty.Register("TextChanged",
                                        typeof (TextChangedEventHandler),
                                        typeof (ShadowedTextBox),
                                        new UIPropertyMetadata(null));

        public string Watermark
        {
            get { return (string)GetValue(WatermarkProperty); }
            set
            {
                SetValue(WatermarkProperty, value);
            }
        }

        public string Text
        {
            get { return (string) GetValue(TextProperty); }
            set{SetValue(TextProperty,value);}
        }

        private void textBox_TextChanged(object sender, TextChangedEventArgs e)
        {
            if (TextChanged != null) TextChanged(this, e);
        }

        public void Clear()
        {
            textBox.Clear();
        }

    }
} 
```

            回答 #17

赞同：1

时间：2015-04-16T19:13:52.540

这是我的方法非常适合 MVVM，我还检查文本框是否有焦点，您也可以仅对文本值使用常规触发器，重点是我只是在值更改时更改背景图像：

```
 <TextBox.Style>
                        <Style TargetType="TextBox">

                            <Style.Triggers>
                                <MultiTrigger>
                                    <MultiTrigger.Conditions>
                                        <Condition Property="IsFocused" Value="True"/>
                                        <Condition Property="Text" Value=""/>
                                    </MultiTrigger.Conditions>
                                    <MultiTrigger.Setters>
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <ImageBrush ImageSource="/Images/Scan.PNG" Stretch="Uniform" AlignmentX="Left"/>
                                            </Setter.Value>
                                        </Setter>
                                    </MultiTrigger.Setters>
                                </MultiTrigger>

                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox> 
```

            回答 #18

赞同：1

时间：2015-07-20T07:20:42.833

```
<TextBox x:Name="OrderTxt" HorizontalAlignment="Left" VerticalAlignment="Top" VerticalContentAlignment="Center" Margin="10,10,0,0" Width="188" Height="32"/>

<Label IsHitTestVisible="False" Content="Order number" DataContext="{Binding ElementName=OrderTxt}" Foreground="DarkGray">
    <Label.Style>
        <Style TargetType="{x:Type Label}">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Setter Property="Width" Value="{Binding Width}"/>
            <Setter Property="Height" Value="{Binding Height}"/>
            <Setter Property="Margin" Value="{Binding Margin}"/>
            <Setter Property="VerticalAlignment" Value="{Binding VerticalAlignment}"/>
            <Setter Property="HorizontalAlignment" Value="{Binding HorizontalAlignment}"/>
            <Setter Property="VerticalContentAlignment" Value="{Binding VerticalContentAlignment}"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Text}" Value="">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Label.Style>
</Label> 
```

            回答 #19

赞同：1

时间：2017-01-21T20:25:08.573

使用柔和颜色的占位符文本设置文本框...

```
public MainWindow ( )
{
    InitializeComponent ( );
    txtInput.Text = "Type something here...";
    txtInput.Foreground = Brushes.DimGray;
} 
```

当文本框获得焦点时，清除它并更改文本颜色

```
private void txtInput_GotFocus ( object sender, EventArgs e )
{
    MessageBox.Show ( "got focus" );
    txtInput.Text = "";
    txtInput.Foreground = Brushes.Red;
} 
```

            回答 #20

赞同：1

时间：2017-10-29T15:17:30.893

这是最简单的解决方案：

```
 <Grid>
                <Label Content="Placeholder text" VerticalAlignment="Center" Margin="10">
                    <Label.Style>
                        <Style TargetType="Label">
                            <Setter Property="Foreground" Value="Transparent"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Expression}" Value="">
                                    <Setter Property="Foreground" Value="Gray"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Label.Style>
                </Label>
                <TextBox HorizontalAlignment="Stretch" Margin="5" Background="Transparent"
                 Text="{Binding Expression, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" Padding="5">
                </TextBox>
        </Grid> 
```

这是一个带有覆盖标签的透明背景的文本框。标签的灰色文本通过数据触发器变为透明，只要绑定文本不是空字符串，就会触发该触发器。

            回答 #21

赞同：1

时间：2018-01-10T08:22:17.600

另外，请参阅此[答案](https://stackoverflow.com/a/26356526/2600860)。您可以使用 VisualBrush 和样式中的一些触发器更轻松地完成此操作：

```
 <TextBox>
    <TextBox.Style>
        <Style TargetType="TextBox" xmlns:sys="clr-namespace:System;assembly=mscorlib">
            <Style.Resources>
                <VisualBrush x:Key="CueBannerBrush" AlignmentX="Left" AlignmentY="Center" Stretch="None">
                    <VisualBrush.Visual>
                        <Label Content="Search" Foreground="LightGray" />
                    </VisualBrush.Visual>
                </VisualBrush>
            </Style.Resources>
            <Style.Triggers>
                <Trigger Property="Text" Value="{x:Static sys:String.Empty}">
                    <Setter Property="Background" Value="{StaticResource CueBannerBrush}" />
                </Trigger>
                <Trigger Property="Text" Value="{x:Null}">
                    <Setter Property="Background" Value="{StaticResource CueBannerBrush}" />
                </Trigger>
                <Trigger Property="IsKeyboardFocused" Value="True">
                    <Setter Property="Background" Value="White" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </TextBox.Style>
</TextBox> 
```

为了增加此样式的可重用性，您还可以创建一组附加属性来控制实际的提示横幅文本、颜色、方向等。

            回答 #22

赞同：0

时间：2010-07-16T13:30:02.700

嗨，我把这个任务变成了一种行为。所以你只需要在你的文本框中添加这样的东西

```
<i:Interaction.Behaviors>
         <Behaviors:TextBoxWatermarkBehavior Label="Test Watermark" LabelStyle="{StaticResource StyleWatermarkLabel}"/>
</i:Interaction.Behaviors> 
```

[你可以在这里](http://blindmeis.wordpress.com/2010/07/16/wpf-watermark-textbox-behavior/)找到我的博客文章

            回答 #23

赞同：0

时间：2011-09-14T08:04:26.210

我的解决方案很简单。

在我的登录窗口中。xaml 是这样的。

```
 <DockPanel HorizontalAlignment="Center" VerticalAlignment="Center" Height="80" Width="300" LastChildFill="True">
        <Button Margin="5,0,0,0" Click="login_Click" DockPanel.Dock="Right"  VerticalAlignment="Center" ToolTip="Login to system">
            Login
        </Button>
        <StackPanel>
            <TextBox x:Name="userNameWatermarked" Height="25" Foreground="Gray" Text="UserName" GotFocus="userNameWatermarked_GotFocus"></TextBox>
            <TextBox x:Name="userName" Height="25"  TextChanged="loginElement_TextChanged" Visibility="Collapsed" LostFocus="userName_LostFocus" ></TextBox>
            <TextBox x:Name="passwordWatermarked" Height="25" Foreground="Gray" Text="Password"  Margin="0,5,0,5" GotFocus="passwordWatermarked_GotFocus"></TextBox>
            <PasswordBox x:Name="password" Height="25" PasswordChanged="password_PasswordChanged" KeyUp="password_KeyUp" LostFocus="password_LostFocus" Margin="0,5,0,5" Visibility="Collapsed"></PasswordBox>
            <TextBlock x:Name="loginError" Visibility="Hidden" Foreground="Red" FontSize="12"></TextBlock>
        </StackPanel>
    </DockPanel> 
```

代码是这样的。

```
private void userNameWatermarked_GotFocus(object sender, RoutedEventArgs e)
    {
        userNameWatermarked.Visibility = System.Windows.Visibility.Collapsed;
        userName.Visibility = System.Windows.Visibility.Visible;
        userName.Focus();
    }

    private void userName_LostFocus(object sender, RoutedEventArgs e)
    {
        if (string.IsNullOrEmpty(this.userName.Text))
        {
            userName.Visibility = System.Windows.Visibility.Collapsed;
            userNameWatermarked.Visibility = System.Windows.Visibility.Visible;
        }
    }

    private void passwordWatermarked_GotFocus(object sender, RoutedEventArgs e)
    {
        passwordWatermarked.Visibility = System.Windows.Visibility.Collapsed;
        password.Visibility = System.Windows.Visibility.Visible;
        password.Focus();
    }

    private void password_LostFocus(object sender, RoutedEventArgs e)
    {
        if (string.IsNullOrEmpty(this.password.Password))
        {
            password.Visibility = System.Windows.Visibility.Collapsed;
            passwordWatermarked.Visibility = System.Windows.Visibility.Visible;
        }
    } 
```

只需决定隐藏或显示水印文本框就足够了。虽然不漂亮，但做工不错。

            回答 #24

赞同：0

时间：2014-06-10T18:57:18.647

此技术使用 Background 属性来显示/隐藏占位符文本框。

*文本框获得焦点时显示占位符事件*

这个怎么运作：

*   当为空时，TextBox 背景设置为透明以显示 PlaceHolder 文本。
*   当不为空时，背景设置为白色以覆盖 PlaceHolder 文本。

*这是基本示例。为了我自己的目的，我把它变成了一个用户控件。*

```
<Grid>
    <Grid.Resources>
        <ux:NotEmptyConverter x:Key="NotEmptyConverter" />

        <Style TargetType="{x:Type Control}" x:Key="DefaultStyle">
            <Setter Property="FontSize" Value="20" />
            <Setter Property="Margin" Value="10"/>
            <Setter Property="VerticalAlignment" Value="Center"></Setter>
            <Setter Property="VerticalContentAlignment" Value="Center"></Setter>
        </Style>

        <Style TargetType="{x:Type TextBox}" BasedOn="{StaticResource DefaultStyle}"></Style>

    </Grid.Resources>

    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>
    <TextBox Grid.Row="0" Text="Placeholder Text Is Here" Foreground="DarkGray" />
    <TextBox Grid.Row="0" Name="TextBoxEdit" 
            Text="{Binding Path=FirstName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" >
        <TextBox.Style>
            <Style TargetType="{x:Type TextBox}" BasedOn="{StaticResource DefaultStyle}">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Path=FirstName.Length, FallbackValue=0, TargetNullValue=0}" Value="0">
                        <Setter Property="Background" Value="Transparent"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=FirstName, FallbackValue=0, TargetNullValue=0, Converter={StaticResource NotEmptyConverter}}" Value="false">
                        <Setter Property="Background" Value="White"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </TextBox.Style>
    </TextBox>
</Grid> 
```

这是用于检测 DataTrigger 中的非空字符串的 ValueConverter。

```
public class NotEmptyConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        var s = value as string;
        return string.IsNullOrEmpty(s);
    }
    public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        return null;
    }
} 
```

            回答 #25

赞同：0

时间：2014-10-27T14:32:40.027

您可以为输入的文本保留一个单独的值，并且可以将其与“GotFocus”和“LostFocus”事件中文本框的“文本”字段一起设置。当您获得焦点时，如果没有值，您将需要清除文本框。当您失去焦点时，您需要设置从文本框中获取“文本”值，然后如果文本框为空，则将文本框的“文本”值重置为占位符。

```
private String username = "";

private void usernameTextBox_GotFocus(object sender, RoutedEventArgs e) {
  if (String.IsNullOrEmpty(username)) {
    usernameTextBox.Text = "";
  }
}

private void usernameTextBox_LostFocus(object sender, RoutedEventArgs e) {
  username = usernameTextBox.Text;
  if (String.IsNullOrEmpty(usernameTextBox.Text)) {
    usernameTextBox.Text = "Username";
  }
} 
```

然后你只需要确保文本框的“文本”值被初始化为占位符文本。

```
<TextBox x:Name="usernameTextBox" Text="Username" GotFocus="usernameTextBox_GotFocus" LostFocus="usernameTextBox_LostFocus" /> 
```

您可以进一步将其提取到扩展“TextBox”类的类中，然后在整个项目中重用它。

```
namespace UI {
  public class PlaceholderTextBox : TextBox {
    public String Value { get; set; }
    public String PlaceholderText { get; set; }
    public Brush PlaceholderBrush { get; set; }
    private Brush ValuedBrush { get; set; }

    public PlaceholderTextBox() : base() {}

    protected override void OnInitialized(EventArgs e) {
      base.OnInitialized(e);

      ValuedBrush = this.Foreground;

      if (String.IsNullOrEmpty(this.Text)) {
        this.Text = PlaceholderText;
        this.Foreground = PlaceholderBrush;
      }
    }

    protected override void OnGotFocus(System.Windows.RoutedEventArgs e) {
      this.Foreground = ValuedBrush;
      if (String.IsNullOrEmpty(Value)) {
        this.Text = "";
      }

      base.OnGotFocus(e);
    }

    protected override void OnLostFocus(System.Windows.RoutedEventArgs e) {
      Value = this.Text;
      if (String.IsNullOrEmpty(this.Text)) {
        this.Text = PlaceholderText;
        this.Foreground = PlaceholderBrush;
      }

      base.OnLostFocus(e);
    }
  }
} 
```

然后这个可以直接在xaml中添加。

```
<Window x:Class="UI.LoginWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:m="clr-namespace:UI"
        Initialized="Window_Initialized">
    <Grid>
        <m:PlaceholderTextBox x:Name="usernameTextBox" PlaceholderText="Username" PlaceholderBrush="Gray" />
    </Grid>
</Window> 
```

            回答 #26

赞同：0

时间：2015-01-16T20:38:16.150

如果不是让水印的可见性取决于控件的焦点状态，而是希望它取决于用户是否输入了任何文本，则可以将 John Myczek 的答案（从`OnWatermarkChanged`下）更新为

```
static void OnWatermarkChanged(DependencyObject d, DependencyPropertyChangedEventArgs e) {
    var textbox = (TextBox)d;
    textbox.Loaded += UpdateWatermark;
    textbox.TextChanged += UpdateWatermark;
}

static void UpdateWatermark(object sender, RoutedEventArgs e) {
    var textbox = (TextBox)sender;
    var layer = AdornerLayer.GetAdornerLayer(textbox);
    if (layer != null) {
        if (textbox.Text == string.Empty) {
            layer.Add(new WatermarkAdorner(textbox, GetWatermark(textbox)));
        } else {
            var adorners = layer.GetAdorners(textbox);
            if (adorners == null) {
                return;
            }

            foreach (var adorner in adorners) {
                if (adorner is WatermarkAdorner) {
                    adorner.Visibility = Visibility.Hidden;
                    layer.Remove(adorner);
                }
            }
        }
    }
} 
```

如果您的文本框在显示表单或数据绑定到 Text 属性时自动获得焦点，这将更有意义。

此外，如果您的水印始终只是一个字符串，并且您需要水印的样式以匹配文本框的样式，那么在 Adorner 中执行以下操作：

```
contentPresenter = new ContentPresenter {
    Content = new TextBlock {
        Text = (string)watermark,
        Foreground = Control.Foreground,
        Background = Control.Background,
        FontFamily = Control.FontFamily,
        FontSize = Control.FontSize,
        ...
    },
    ...
} 
```

            回答 #27

赞同：0

时间：2015-10-07T15:17:49.620

我决定通过一个行为来解决这个问题。它使用一个`Hint`属性来定义要显示的文本（如果您愿意，也可以是一个对象）和一个`Value`属性来评估提示是否应该可见。

行为声明如下：

```
using System;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Interactivity;
using System.Windows.Media;

    public class HintBehavior : Behavior<ContentControl>
    {
        public static readonly DependencyProperty HintProperty = DependencyProperty
            .Register("Hint", typeof (string), typeof (HintBehavior)
            //, new FrameworkPropertyMetadata(null, OnHintChanged)
            );

        public string Hint
        {
            get { return (string) GetValue(HintProperty); }
            set { SetValue(HintProperty, value); }
        }

        public static readonly DependencyProperty ValueProperty = DependencyProperty
            .Register("Value", typeof (object), typeof (HintBehavior)
                , new FrameworkPropertyMetadata(null, OnValueChanged));

        private static void OnValueChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            var visible = e.NewValue == null;
            d.SetValue(VisibilityProperty, visible ? Visibility.Visible : Visibility.Collapsed);
        }

        public object Value
        {
            get { return GetValue(ValueProperty); }
            set { SetValue(ValueProperty, value); }
        }

        public static readonly DependencyProperty VisibilityProperty = DependencyProperty
            .Register("Visibility", typeof (Visibility), typeof (HintBehavior)
                , new FrameworkPropertyMetadata(Visibility.Visible
                    //, new PropertyChangedCallback(OnVisibilityChanged)
                    ));

        public Visibility Visibility
        {
            get { return (Visibility) GetValue(VisibilityProperty); }
            set { SetValue(VisibilityProperty, value); }
        }

        public static readonly DependencyProperty ForegroundProperty = DependencyProperty
            .Register("Foreground", typeof (Brush), typeof (HintBehavior)
                , new FrameworkPropertyMetadata(new SolidColorBrush(Colors.DarkGray)
                    //, new PropertyChangedCallback(OnForegroundChanged)
                    ));

        public Brush Foreground
        {
            get { return (Brush) GetValue(ForegroundProperty); }
            set { SetValue(ForegroundProperty, value); }
        }

        public static readonly DependencyProperty MarginProperty = DependencyProperty
            .Register("Margin", typeof (Thickness), typeof (HintBehavior)
                , new FrameworkPropertyMetadata(new Thickness(4, 5, 0, 0)
                    //, new PropertyChangedCallback(OnMarginChanged)
                    ));

        public Thickness Margin
        {
            get { return (Thickness) GetValue(MarginProperty); }
            set { SetValue(MarginProperty, value); }
        }

        private static ResourceDictionary _hintBehaviorResources;

        public static ResourceDictionary HintBehaviorResources
        {
            get
            {
                if (_hintBehaviorResources == null)
                {
                    var res = new ResourceDictionary
                    {
                        Source = new Uri("/Mayflower.Client.Core;component/Behaviors/HintBehaviorResources.xaml",
                            UriKind.RelativeOrAbsolute)
                    };
                    _hintBehaviorResources = res;
                }
                return _hintBehaviorResources;
            }
        }

        protected override void OnAttached()
        {
            base.OnAttached();
            var t = (ControlTemplate) HintBehaviorResources["HintBehaviorWrapper"];
            AssociatedObject.Template = t;
            AssociatedObject.Loaded += OnLoaded;
        }

        private void OnLoaded(object sender, RoutedEventArgs e)
        {
            AssociatedObject.Loaded -= OnLoaded;
            var label = (Label) AssociatedObject.Template.FindName("PART_HintLabel", AssociatedObject);
            label.DataContext = this;
            //label.Content = "Hello...";
            label.SetBinding(UIElement.VisibilityProperty, new Binding("Visibility") {Source = this, Mode = BindingMode.OneWay});
            label.SetBinding(ContentControl.ContentProperty, new Binding("Hint") {Source = this, Mode = BindingMode.OneWay});
            label.SetBinding(Control.ForegroundProperty, new Binding("Foreground") {Source = this, Mode = BindingMode.OneWay});
            label.SetBinding(FrameworkElement.MarginProperty, new Binding("Margin") {Source = this, Mode = BindingMode.OneWay});
        }
    } 
```

它用自己的模板包装目标，并为其添加一个标签：

```
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <ControlTemplate x:Key="HintBehaviorWrapper" TargetType="{x:Type ContentControl}">
        <Grid>
            <ContentPresenter Content="{TemplateBinding Content}" />
            <Label x:Name="PART_HintLabel" IsHitTestVisible="False" Padding="0" />
        </Grid>
    </ControlTemplate>
</ResourceDictionary> 
```

要使用它，只需将其添加为行为并绑定您的值（在我的情况下，我将其添加到 ControlTemplate 中，因此绑定）：

```
<ContentControl>
    <i:Interaction.Behaviors>
        <behaviors:HintBehavior Value="{Binding Property, RelativeSource={RelativeSource TemplatedParent}}"
                                                        Hint="{Binding Hint, RelativeSource={RelativeSource TemplatedParent}}" />
    </i:Interaction.Behaviors>
    <TextBox ... />
</ContentControl> 
```

如果这被认为是一个干净的解决方案，我希望得到反馈。它不需要静态字典，因此没有内存泄漏。

            回答 #28

赞同：0

时间：2015-11-14T23:47:44.187

我发现这种方法可以非常快速和简单地完成

```
<ComboBox x:Name="comboBox1" SelectedIndex="0" HorizontalAlignment="Left" Margin="202,43,0,0" VerticalAlignment="Top" Width="149">
  <ComboBoxItem Visibility="Collapsed">
    <TextBlock Foreground="Gray" FontStyle="Italic">Please select ...</TextBlock>
  </ComboBoxItem>
  <ComboBoxItem Name="cbiFirst1">First Item</ComboBoxItem>
  <ComboBoxItem Name="cbiSecond1">Second Item</ComboBoxItem>
  <ComboBoxItem Name="cbiThird1">third Item</ComboBoxItem>
</ComboBox> 
```

也许它可以帮助任何试图这样做的人

*来源： http: [//www.admindiaries.com/displaying-a-please-select-watermark-type-text-in-a-wpf-combobox/](http://www.admindiaries.com/displaying-a-please-select-watermark-type-text-in-a-wpf-combobox/)*

            回答 #29

赞同：0

时间：2016-10-27T16:51:26.163

```
namespace PlaceholderForRichTexxBoxInWPF
{
public MainWindow()
        {
            InitializeComponent();
            Application.Current.MainWindow.WindowState = WindowState.Maximized;// maximize window on load

            richTextBox1.GotKeyboardFocus += new KeyboardFocusChangedEventHandler(rtb_GotKeyboardFocus);
            richTextBox1.LostKeyboardFocus += new KeyboardFocusChangedEventHandler(rtb_LostKeyboardFocus);
            richTextBox1.AppendText("Place Holder");
            richTextBox1.Foreground = Brushes.Gray;
        }
 private void rtb_GotKeyboardFocus(object sender, KeyboardFocusChangedEventArgs e)
        {
            if (sender is RichTextBox)
            {
                TextRange textRange = new TextRange(richTextBox1.Document.ContentStart, richTextBox1.Document.ContentEnd); 

                if (textRange.Text.Trim().Equals("Place Holder"))
                {
                    ((RichTextBox)sender).Foreground = Brushes.Black;
                    richTextBox1.Document.Blocks.Clear();
                }
            }
        }

        private void rtb_LostKeyboardFocus(object sender, KeyboardFocusChangedEventArgs e)
        {
            //Make sure sender is the correct Control.
            if (sender is RichTextBox)
            {
                //If nothing was entered, reset default text.
                TextRange textRange = new TextRange(richTextBox1.Document.ContentStart, richTextBox1.Document.ContentEnd); 

                if (textRange.Text.Trim().Equals(""))
                {
                    ((RichTextBox)sender).Foreground = Brushes.Gray;
                    ((RichTextBox)sender).AppendText("Place Holder");
                }
            }
        }
} 
```

            回答 #30

赞同：0

时间：2016-11-28T18:16:48.260

```
<TextBox    Grid.Column="0" Name="TextBox_SearchBar" AcceptsReturn="False" AcceptsTab="False" TextWrapping="Wrap" KeyUp="TextBox_SearchBar_KeyUp" />
<TextBox    Grid.Column="0" Name="TextBox_Watermark" Text="Search Test Sets" Foreground="Gray" GotFocus="TextBox_Watermark_GotFocus" />

private void TextBox_Watermark_GotFocus( object sender, RoutedEventArgs e ) {
    TextBox_Watermark.Visibility = Visibility.Hidden;
    TextBox_SearchBar.Focus();
} 
```

这将创建两个文本框，一个用于接收水印的字段，一个用于水印。接收水印的字段可以是 ComboBox 或其他控件（只要您正确对齐并获得相应的焦点）。

水印必须是 TextBox 或其他可以 GetFocus 的控件（TextBlock 不能 GetFocus，因为我很难学到）。当水印 TextBox 获得焦点时，它会隐藏自身并提供对其他 TextBox 的访问权限。

如果要在 SearchBar TextBox 失去焦点后重新显示水印，只需向 TextBox_SearchBar 添加一个 LostFocus 事件处理程序，该处理程序会检查输入并将 TextBox_Watermark 的可见性切换为隐藏或可见。

            回答 #31

赞同：0

时间：2017-01-11T21:43:19.247

```
<TextBox Controls:TextBoxHelper.Watermark="Watermark"/> 
```

将 mahapps.metro 添加到您的项目中。将带有上述代码的文本框添加到窗口中。

            回答 #32

赞同：0

时间：2017-04-10T18:38:33.543

再看一个简单的独奏：

我专注于 GotFocus 和 LostFocus 事件。

XAML：

```
<Grid>
<TextBlock x:Name="DosyaİhtivaEdenDizinYansıması" Text="Hedef Dizin Belirtin" VerticalAlignment="Center" HorizontalAlignment="Center" TextAlignment="Center" Foreground="White" Background="Transparent" Width="500" MinWidth="300" Margin="10,0,0,0" Opacity="0.7"/>
<TextBox x:Name="DosyaİhtivaEdenDizin" CaretBrush="White" Foreground="White" Background="Transparent" VerticalContentAlignment="Center" HorizontalContentAlignment="Center" VerticalAlignment="Center" HorizontalAlignment="Center" MinHeight="40" BorderThickness="1" BorderBrush="White" Width="500" MinWidth="300" Margin="10,0,0,0" GotFocus="DosyaİhtivaEdenDizin_GotFocus" LostFocus="DosyaİhtivaEdenDizin_LostFocus"/>
</Grid> 
```

C＃：

```
 #region DosyaİhtivaEdenDizin
    private void DosyaİhtivaEdenDizin_GotFocus(object sender, RoutedEventArgs e)
    {
        if (DosyaİhtivaEdenDizin.Text.Length == 0)
        {
            DosyaİhtivaEdenDizinYansıması.Text = "";
        }
    }

    private void DosyaİhtivaEdenDizin_LostFocus(object sender, RoutedEventArgs e)
    {
        if (DosyaİhtivaEdenDizin.Text.Length == 0)
        {
            DosyaİhtivaEdenDizinYansıması.Text = "Hedef Dizin Belirtin";
        }
    }
    #endregion 
```

            回答 #33

赞同：0

时间：2018-05-09T04:09:19.350

[Telerik](https://docs.telerik.com/devtools/wpf/introduction)有一个[`RadWatermarkTextBox`](https://docs.telerik.com/devtools/wpf/controls/radwatermarktextbox/overview)专门用于解决此问题的控件。如果您使用 Telerik 控件，只需按以下方式使用

```
<telerik:RadWatermarkTextBox
    Text="{Binding Path=MyTextBoxText}"
    WatermarkContent="Please enter some text" /> 
```

            回答 #34

赞同：0

时间：2021-02-12T10:07:06.797

这是 XAML 中的另一个简单解决方案：
XAML：

```
 <TextBox>
            <TextBox.Resources>
                <Style TargetType="TextBox">
                    <Style.Triggers>
                        <Trigger Property="IsFocused" Value="True">
                            <!--text color-->
                            <Setter Property="Foreground" Value="Black"/>
                            <Setter Property="Text" Value=""/>
                        </Trigger>
                        <Trigger Property="IsFocused" Value="False">
                            <!--placeholder color-->
                            <Setter Property="Foreground" Value="Gray"/>
                            <!--placeholder here-->
                            <Setter Property="Text" Value="Placeholder"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </TextBox.Resources>
        </TextBox> 
```

        c# - 在 C# 中，如果抛出未处理的异常，Finally 块是否会在 try、catch、finally 中执行？

ID：833946

赞同：7

时间：2009-05-07T10:43:34.430

标签：c#, .net, finally

另一个面试问题是期待一个真/假的答案，我不太确定。
复制

*   [在 .NET 中，如果 catch 块中发生故障，最终总是会被调用怎么办？](https://stackoverflow.com/questions/582095/in-net-what-if-something-fails-in-the-catch-block-will-finally-always-get-call)
*   [finally 块是否总是运行？](https://stackoverflow.com/questions/464098/does-a-finally-block-always-run)
*   [当 finally 不在 .net try..finally 块中执行时的条件](https://stackoverflow.com/questions/111597/conditions-when-finally-does-not-execute-in-a-net-try-finally-block)
*   [如果我在 Try 块中返回一个值，Finally 语句中的代码会触发吗？](https://stackoverflow.com/questions/345091/will-code-in-a-finally-statement-fire-if-i-return-a-value-in-a-try-block)

            回答 #1

赞同：29

时间：2009-05-07T10:57:01.230

`finally`**大部分时间**被执行。这几乎是所有情况。例如，如果在线程上抛出异步异常（如`StackOverflowException`, `OutOfMemoryException`, ），则无法保证执行。这就是为编写高度可靠的代码而存在[约束执行区域的原因。](http://msdn.microsoft.com/en-us/library/ms228973.aspx)`ThreadAbortException``finally`

出于面试目的，我希望这个问题的答案是**错误**的（我不会保证任何事情！面试官自己可能不知道这一点！）。

            回答 #2

赞同：8

时间：2009-05-07T10:46:30.633

直接来自 MSDN：

finally 块对于清理在 try 块中分配的任何资源很有用。不管 try 块如何退出，控制总是传递给 finally 块。

catch 用于处理语句块中发生的异常，而 finally 用于保证语句块的执行，而不管前面的 try 块如何退出。

[http://msdn.microsoft.com/en-us/library/zwc8s4fz(VS.71,loband).aspx](http://msdn.microsoft.com/en-us/library/zwc8s4fz(VS.71,loband).aspx)

            回答 #3

赞同：8

时间：2009-05-07T11:03:15.973

通常，该`finally`块保证执行。

但是，在少数情况下会强制 CLR 在出现错误时关闭。在这些情况下，`finally`不会运行该块。  

一个这样的例子是存在 StackOverflow 异常。

例如，在`finally`块下面的代码中不执行。

```
static void Main(string[] args) {
   try {
      Foo(1);
   } catch {
      Console.WriteLine("catch");
   } finally {
      Console.WriteLine("finally");
   }
}

public static int Foo(int i) {
   return Foo(i + 1);
} 
```

我知道的另一种情况是终结器是否抛出异常。在这种情况下，该过程也会立即终止，因此该保证不适用。

下面的代码说明了问题

```
static void Main(string[] args) {
   try {
      DisposableType d = new DisposableType();
      d.Dispose();
      d = null;
      GC.Collect();
      GC.WaitForPendingFinalizers();
   } catch {
      Console.WriteLine("catch");
   } finally {
      Console.WriteLine("finally");
   }
}

public class DisposableType : IDisposable {
   public void Dispose() {
   }

   ~DisposableType() {
      throw new NotImplementedException();
   }
} 
```

`catch`在这两种情况下，进程都在和之前终止`finally`。

我承认这些例子非常做作，但它们只是为了说明这一点。

幸运的是，这两种情况都不经常发生。

            回答 #4

赞同：4

时间：2009-05-07T10:44:59.997

是的，finally 总是被执行。

            回答 #5

赞同：4

时间：2009-05-07T10:56:09.657

finally 总是会被执行的说法并不完全正确。请参阅[Haacked](https://stackoverflow.com/users/598/haacked)的[这个答案](https://stackoverflow.com/questions/111597/conditions-when-finally-does-not-execute-in-a-net-try-finally-block/111617#111617)：

两种可能：

*   `StackOverflowException`

*   `ExecutingEngineException`

当存在 StackOverflowException 时，finally 块将不会被执行，因为堆栈上没有空间可以执行更多代码。出现ExecutingEngineException时也不会调用，这种情况非常少见。

但是，这两个异常是您无法恢复的异常，因此基本上您的进程无论如何都会退出。

正如 Mehrdad 所提到的，可靠的 try/catch/finally 必须使用受[约束的执行区域 (CER)](http://msdn.microsoft.com/en-us/library/ms228973.aspx)。MSDN 提供了一个[示例：](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.runtimehelpers.prepareconstrainedregions.aspx)

```
[StructLayout(LayoutKind.Sequential)]
struct MyStruct
{
    public IntPtr m_outputHandle;
}

sealed class MySafeHandle : SafeHandle
{
    // Called by P/Invoke when returning SafeHandles
    public MySafeHandle()
        : base(IntPtr.Zero, true)
    {
    }

    public MySafeHandle AllocateHandle()
    {
        // Allocate SafeHandle first to avoid failure later.
        MySafeHandle sh = new MySafeHandle();

        RuntimeHelpers.PrepareConstrainedRegions();
        try { }
        finally
        {
            MyStruct myStruct = new MyStruct();
            NativeAllocateHandle(ref myStruct);
            sh.SetHandle(myStruct.m_outputHandle);
        }

        return sh;
    }
} 
```

            回答 #6

赞同：1

时间：2009-05-07T10:45:08.873

通常，无论是否抛出异常以及是否处理任何异常，都会始终执行 finally 块。

有几个例外（有关更多详细信息，请参阅其他答案）。

            回答 #7

赞同：0

时间：2009-05-07T10:45:50.883

finally 每次都会发生在 try catch 块中

            回答 #8

赞同：0

时间：2009-05-07T10:49:03.573

无论是否抛出异常，都会执行“Finally”。

它是关闭任何打开的连接的好地方。执行成功或失败，您仍然可以管理您的连接或打开文件。

            回答 #9

赞同：-2

时间：2009-05-07T11:11:11.167

finally 总是被执行。我不依赖于 try 块的工作方式。如果你必须为 try 和 cath 做一些额外的工作，最好放入 finally 块。所以你可以保证它总是被执行。

        c# - 在表单外显示列表框（winforms）

ID：833961

赞同：4

时间：2009-05-07T10:46:11.537

标签：c#, winforms

是否有可能让我的列表框显示在表单边界之外？

解决方案之一是使表单本身透明，并添加面板而不是表单作为背景。

但是还有其他更令人愉快的方式来做到这一点吗？

UPD：我需要为文本框制作自定义自动完成功能，以支持通配符。所以我希望在文本框下方显示一个列表框。我的表单大小应该是文本框的大小。因此，在这种情况下，垂直拉伸表单不起作用。

谢谢

            回答 #1

赞同：8

时间：2009-05-19T18:18:00.497

实际上，它是可能的。方法如下：

```
public class PopupWindow : System.Windows.Forms.ToolStripDropDown
{
    private System.Windows.Forms.Control _content;
    private System.Windows.Forms.ToolStripControlHost _host;

    public PopupWindow(System.Windows.Forms.Control content)
    {
        //Basic setup...
        this.AutoSize = false;
        this.DoubleBuffered = true;
        this.ResizeRedraw = true;

        this._content = content;
        this._host = new System.Windows.Forms.ToolStripControlHost(content);

        //Positioning and Sizing
        this.MinimumSize = content.MinimumSize;
        this.MaximumSize = content.Size;
        this.Size = content.Size;
        content.Location = Point.Empty;

        //Add the host to the list
        this.Items.Add(this._host);
    }
}

popup = new PopupWindow(listbox1);
PopupWindow.show(); 
```

            回答 #2

赞同：3

时间：2009-05-07T10:50:46.330

您可以使用*仅*包含列表框的第二种形式吗？你需要一些代码来相对于主窗体移动它，但它应该可以工作......

            回答 #3

赞同：1

时间：2009-05-07T10:59:36.577

不是真的，不。这与基本的 winforms 模型背道而驰。您可能可以通过大量手动修改或互操作来作弊，但这几乎不值得付出代价。

相反，问问自己为什么要这样做。看起来您正在尝试重新实现组合框，其唯一目的是添加自动完成功能。也许您应该简单地将组合框控件子类化，以将您的自动完成功能添加到为您完成所有困难工作并且已经存在的控件中。

在我目前的工作过程中，我已经看到至少三个不同的本土组合框都以各种方式损坏，相当于大量工作而没有真正的回报。我最喜欢的是组合框，它的下拉列表框窃取了拥有表单的焦点。看到损坏的代码导致任何使用它的东西闪烁真的很有趣。

编辑：

通过从 ComboBox 继承仍然可以将组合框修改为带有通配符的搜索/过滤器，并且仍然比滚动您自己的组合框更容易，但在这一点上，我建议考虑更[合适](https://stackoverflow.com/questions/824905/)的ui 范例。组合框不会过滤它们的下拉列表（除非您使用糟糕的软件作为灵感*咳嗽*SAP*咳嗽*）。

        python - 线程 TCP 服务器作为连接的用户和 unix 套接字之间的代理

ID：833962

赞同：0

时间：2009-05-07T10:46:21.193

标签：python, multithreading, sockets, tcp

我正在编写需要将数据从服务器推送到连接的客户端的 Web 应用程序。此数据可以从 Web 应用程序的任何其他脚本发送。例如，一个用户在服务器上进行了一些更改，并且应该通知其他用户。

所以我的想法是使用unix套接字（基于用户#ID的套接字路径）为相应的用户发送数据（网络应用程序脚本将连接到这个套接字并写入数据）。第二部分是 ThreadingTCPServer，它将接受用户连接并通过 TCP 套接字连接将数据从 unix 套接字推送给用户。

这是工作流程：

1.  用于连接 TCP 服务器
2.  Django 脚本打开 unixsocket 并向其写入数据。
3.  TCP 服务器从 unix 套接字读取数据并将其发送到与用户打开连接。

我希望你能理解我的想法：）

所以，我有两个问题：

1.您总体上对我的想法有什么看法？这是好的还是坏的解决方案？欢迎任何建议。

2.这是我的代码。

```
import SocketServer
import socket
import netstring
import sys, os, os.path
import string
import time

class MyRequestHandler(SocketServer.BaseRequestHandler):
    def handle(self):
        try:
            print "Connected:", self.client_address

            user = self.request.recv(1024).strip().split(":")[1]
            user = int(user)
            self.request.send('Welcome #%s' % user)

            self.usocket_path = '/tmp/u%s.sock' % user
            if os.path.exists(self.usocket_path):
                os.remove(self.usocket_path)

            self.usocket = socket.socket(socket.AF_UNIX, socket.SOCK_DGRAM)
            self.usocket.bind(self.usocket_path)
            self.usocket.listen(1)

            while 1:
                usocket_conn, addr = self.usocket.accept()
                while 1:
                    data = usocket_conn.recv(1024)
                    if not data: break
                    self.request.send(data)
                    break
                usocket_conn.close()
                time.sleep(0.1)

        except KeyboardInterrupt:
            self.request.send('close')
            self.request.close()

myServer = SocketServer.ThreadingTCPServer(('', 8081), MyRequestHandler)
myServer.serve_forever() 
```

我有一个例外

```
 File "server1.py", line 23, in handle
    self.usocket.listen(1)
  File "<string>", line 1, in listen
error: (102, 'Operation not supported on socket') 
```

            回答 #1

赞同：1

时间：2009-05-07T12:10:38.933

我认为您不应该使用 unix 套接字。如果您的应用程序（有一天）会变得流行或成为关键任务，您将无法仅添加另一台服务器来增加可伸缩性或使其冗余和故障安全。

另一方面，如果您将数据放入 fe memcached（并将用户的“数据集编号”作为单独的键），您将能够将数据从多个服务器放入 memcached 并从多个服务器读取。如果用户断开连接并从其他服务器重新连接，您仍然可以为他获取数据。

You could also use a database (to make it more fail-safe), or a mix of database and memcached if You like, but I have seen an app using unix sockets in the way You are trying to, and the programmer regreted it later. The table could have userid, data and timestamp columns and You could remember the last timestamp for the given user.

            回答 #2

赞同：0

时间：2009-05-07T12:08:26.020

这太复杂了。请使用[socketserver](http://docs.python.org/library/socketserver.html#module-SocketServer)模块。   

            回答 #3

赞同：0

时间：2009-06-17T03:56:57.877

You should use Twisted, or, more specifically, [Orbited](http://orbited.org/), to push data to your clients.  The sample code you posted has a number of potential problems, and it would be a lot harder to figure out what they all are than for you to just use a pre-built piece of code to do what you need.

        asp.net - ASP.NET：Request.Form 很慢！

ID：833964

赞同：0

时间：2009-05-07T10:46:31.850

标签：asp.net, performance, iis, iis-7, httpcontext

**我对Request.Form**有一个非常奇怪的行为。

这是运行相同 ASP.NET 应用程序的两台 IIS 7 服务器。在第一种情况下，一切正常。但是第二个的性能非常慢。

Profiler 显示这一行：

```
context.Request.Form["id"] 
```

每次花费超过**130 毫秒**！

探查器日志：

0,60% get_Form - 4536 毫秒 - 68 次调用 - System.Web.HttpRequest.get_Form()

服务器配置是一样的（？）。第一台服务器运行 Vista，第二台（速度较慢）运行 Windows Web Server 2008。

**UPD：**
两个应用程序实例都以集成模式运行，池设置相同。

有任何想法吗？

            回答 #1

赞同：0

时间：2009-05-07T10:49:52.013

Request.Form["id"] 是您在此请求期间对 Request.Form 的唯一引用吗？在这种情况下，时间可能与引用 Form 集合的开销有关。为了好玩，尝试添加另一个对 Request.Form 的引用，看看它是否也需要 130 毫秒。

            回答 #2

赞同：0

时间：2009-05-08T18:51:01.310

固定的！刚刚将应用程序端口从80改为8080。不知道这种行为的原因。

        linux - ubuntu：操纵无线网络

ID：833976

赞同：0

时间：2009-05-07T10:48:28.647

标签：linux, ubuntu, wireless

Ubuntu 中是否有 API（或命令行）来查看可用的无线网络、它们的强度等，并连接到一个？

            回答 #1

赞同：4

时间：2009-05-07T10:58:10.557

[network-manager](http://projects.gnome.org/NetworkManager/)有一个 dbus 服务。您可以使用任何带有 dbus 绑定的语言与之对话。

            回答 #2

赞同：1

时间：2009-05-07T11:00:59.363

ifconfig 和 iwconfig 用于控制网络连接。您的 wifi 适配器可能还具有用于创建初始网络设备的特定应用程序，madwifi 就是这种情况，它将创建一个 athX（x 是数字）设备，可以通过 ifconfig 和 iwconfig 进行控制。还应该提到的是，Ubuntu 附带的受限硬件驱动应用程序非常擅长安装和设置 wifi 驱动程序。

取决于变体的 Ubuntu 带有网络管理器，对于 KDE，它的 knetworkmanager 和 gnome 是 gnome-netstatus-applet。

默认情况下，这些应用程序根据变体启动。

            回答 #3

赞同：1

时间：2009-05-07T16:05:32.160

Linux 支持一种称为[无线扩展](http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html#wext)的东西，它定义了不同无线卡的通用接口。扩展定义了一组 IOCTL 调用和 netlink 事件，用于配置设备以及获取有关检测到的事件的信息（例如从接入点断开连接）。

使用无线扩展的应用程序示例包括[用于 Linux 的无线工具](http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/Tools.html)（iwconfig、iwlist 等）和[wpa_supplicant](http://hostap.epitest.fi/wpa_supplicant/)。

请注意，并非所有设备都支持无线扩展，因此您可能需要使用专有接口，例如 MadWiFi。

            回答 #4

赞同：0

时间：2009-05-12T17:49:16.663

用于命令行；可以使用 iwlist 完成扫描（尝试 man iwlist 更多帮助）

```
iwlist wlan0 scan 
```

wlan0 在我的例子中是无线接口的名称

对于 gui 部分，我更喜欢 wicd；易于使用，支持 wep,wpa,wpa2

            回答 #5

赞同：0

时间：2009-05-27T18:33:22.880

Ubuntu 倾向于利用“Undocumented Frameworks(TM)、Undocumented Object Brokerage Buses(TM) 和 Undocumented Abstraction Layers(TM) 的强大力量(TM)”。但幸运的是，有社区支持，您可以在 IRC 上与所有其他像您一样阅读过文档的人交谈。

使用`ifconfig`, `iwconfig`,如果你想要一些`iwlist`有`wpa_supplicant`文档告诉你它是如何工作的东西。或者，您可以只运行一次，查看输出并弄清楚如何编写一个执行您想要的 shell 脚本。

我不苦。一点也不。你为什么这么说？:D

（说实话，NetworkManager 不会让 iw{config,list} 撒谎，但不要指望 nm 不会覆盖您使用它们要求的设置。）

            回答 #6

赞同：0

时间：2017-06-02T08:37:59.733

命令行实用程序`nmtui`提供了一个终端内图形界面来连接到无线网络、查看它们的强度并连接到它们。

        iphone - 这个错误在 Xcode 中意味着什么？

ID：833985

赞同：0

时间：2009-05-07T10:50:15.617

标签：iphone, xcode

使用配置“Debug”构建项目“testjson”的目标“testjson”-（2 个错误）检查依赖项错误：没有指定名称或路径的 SDK '/Users/xcdfs/Library/SDKs/JSON/iphonesimulator.sdk' 错误: 没有指定名称或路径的 SDK '/Users/xcdfs/Library/SDKs/JSON/iphonesimulator.sdk' 错误：没有指定名称或路径的 SDK '/Users/xcdfs/Library/SDKs/JSON/iphonesimulator .sdk' 错误：没有指定名称或路径的 SDK '/Users/xcdfs/Library/SDKs/JSON/iphonesimulator.sdk' 构建失败（2 个错误）

            回答 #1

赞同：1

时间：2009-05-07T13:02:54.050

看起来您将 JSON 库添加为框架，而不是（我猜）静态或共享库。您正在使用哪个 JSON 库以及如何配置链接器以在构建设置中查看它？

        silverlight - 是否可以使用 Silverlight 缩放动态内容？

ID：833995

赞同：0

时间：2009-05-07T10:51:44.020

标签：silverlight, deepzoom

我是 Silverlight 的新手，我对如何缩放动态内容很感兴趣。例如，我有画布和几个列表框，我想放大它。

            回答 #1

赞同：1

时间：2009-05-07T23:04:06.960

是的。

Silverlight 中的每个视觉元素都可以通过多种不同的方式对其进行转换。可以通过添加 ScaleTransform 对象或对象 renderTransform 来应用缩放。

```
<Canvas>
     <Canvas.RenderTransform>
          <ScaleTransform ScaleX="2" ScaleY="2" />
     </Canvas.RenderTransform>
     <ListBox />
</Canvas> 
```

上面的 XAML 将缩放 Canvas 内的所有内容（在本例中只是 ListBox）。ListBox 将继续像 ListBox 一样工作。

        c# - 如何使用 ASP.Net MVC URL 路由为所有操作添加前缀？

ID：833996

赞同：6

时间：2009-05-07T10:51:48.967

标签：c#, asp.net, asp.net-mvc, url-routing

我正在尝试编写一个 MapRoute 调用，该调用将使任何以“json/”为前缀的路由在操作名称前添加“json”。例如，这样的路线：

```
"json/{controller}/{action}" 
```

使用“json/Foo/Bar”，它应该导致：

```
controller = "Foo"
action = "jsonBar" 
```

有任何想法吗？

            回答 #1

赞同：4

时间：2009-05-07T12:12:19.210

我想知道在路由数据中包含 json 并在操作中查找它是否会更好？即当映射你的路线时，使用类似的东西（对于默认值）：

```
new { mode="json", controller = "Home", action = "Index", id = "" } 
```

或将路线映射为：

```
"{mode}/{controller}/{action}" 
```

然后在控制器中访问它：

```
string mode = (string) RouteData.Values["mode"]; 
```

（或将其作为参数传入）

除此之外，您可能会编写自己的路由处理程序，但这是很多工作。

        jquery - 使用 jQuery 验证结束日期是否大于开始日期

ID：833997

赞同：115

时间：2009-05-07T10:52:01.103

标签：jquery, date, jquery-validate

如何在 jQuery 中检查/验证结束日期 [文本框] 是否大于开始日期 [文本框]？

            回答 #1

赞同：188

时间：2010-02-11T00:55:12.500

只是扩大融合的答案。此扩展方法使用 jQuery 验证插件工作。它将验证日期和数字

```
jQuery.validator.addMethod("greaterThan", 
function(value, element, params) {

    if (!/Invalid|NaN/.test(new Date(value))) {
        return new Date(value) > new Date($(params).val());
    }

    return isNaN(value) && isNaN($(params).val()) 
        || (Number(value) > Number($(params).val())); 
},'Must be greater than {0}.'); 
```

要使用它：

```
$("#EndDate").rules('add', { greaterThan: "#StartDate" }); 
```

或者

```
$("form").validate({
    rules: {
        EndDate: { greaterThan: "#StartDate" }
    }
}); 
```

            回答 #2

赞同：88

时间：2009-05-07T10:58:21.587

```
var startDate = new Date($('#startDate').val());
var endDate = new Date($('#endDate').val());

if (startDate < endDate){
// Do something
} 
```

我认为应该这样做

            回答 #3

赞同：21

时间：2013-08-05T07:49:06.373

派对有点晚了，但这是我的一部分

`Date.parse(fromDate) > Date.parse(toDate)`

这是详细信息：

```
var from = $("#from").val();
var to = $("#to").val();

if(Date.parse(from) > Date.parse(to)){
   alert("Invalid Date Range");
}
else{
   alert("Valid date Range");
} 
```

            回答 #4

赞同：15

时间：2009-05-11T15:05:31.060

参考 jquery.validate.js 和 jquery-1.2.6.js。将 startDate 类添加到您的开始日期文本框中。将 endDate 类添加到您的结束日期文本框中。

将此脚本块添加到您的页面：-

```
<script type="text/javascript">
    $(document).ready(function() {
        $.validator.addMethod("endDate", function(value, element) {
            var startDate = $('.startDate').val();
            return Date.parse(startDate) <= Date.parse(value) || value == "";
        }, "* End date must be after start date");
        $('#formId').validate();
    });
</script> 
```

希望这可以帮助 ：-）

            回答 #5

赞同：13

时间：2012-04-24T13:32:19.957

我只是在修改[danteuno 的回答](https://stackoverflow.com/a/2241515/50079)，发现虽然是善意的，但遗憾的是它在几个*不是*IE 的浏览器上被破坏了。这是因为 IE 将非常严格地接受它作为`Date`构造函数的参数，但其他人不会。例如，Chrome 18 提供

```
> new Date("66")
  Sat Jan 01 1966 00:00:00 GMT+0200 (GTB Standard Time) 
```

这会导致代码采用“比较日期”路径，并且从那里开始走下坡路（例如`new Date("11")`大于`new Date("66")`，这显然与预期效果相反）。

因此，经过考虑，我修改了代码以优先于“日期”路径的“数字”路径，并使用[Validate decimal numbers in JavaScript - IsNumeric() 中](https://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric)提供的出色方法验证输入确实是数字。

最后，代码变为：

```
$.validator.addMethod(
    "greaterThan",
    function(value, element, params) {
        var target = $(params).val();
        var isValueNumeric = !isNaN(parseFloat(value)) && isFinite(value);
        var isTargetNumeric = !isNaN(parseFloat(target)) && isFinite(target);
        if (isValueNumeric && isTargetNumeric) {
            return Number(value) > Number(target);
        }

        if (!/Invalid|NaN/.test(new Date(value))) {
            return new Date(value) > new Date(target);
        }

        return false;
    },
    'Must be greater than {0}.'); 
```

            回答 #6

赞同：6

时间：2013-05-27T01:35:09.423

所以我需要这条规则是可选的，以上建议都不是可选的。如果我调用该方法，即使我将其设置为需要一个值，它也会按要求显示。

这是我的电话：

```
 $("#my_form").validate({
    rules: {
      "end_date": {
        required: function(element) {return ($("#end_date").val()!="");},
        greaterStart: "#start_date"
      }
    }
  });//validate() 
```

我`addMethod`的不如 Mike E. 的最受好评的答案强大，但我使用 JqueryUI 日期选择器来强制选择日期。如果有人能告诉我如何确保日期是数字并且方法是可选的，那就太好了，但现在这个方法对我有用：

```
jQuery.validator.addMethod("greaterStart", function (value, element, params) {
    return this.optional(element) || new Date(value) >= new Date($(params).val());
},'Must be greater than start date.'); 
```

            回答 #7

赞同：5

时间：2009-05-07T15:39:00.303

文本字段中的日期值可以通过 jquery 的 .val() 方法获取，例如

```
var datestr1 = $('#datefield1-id').val();
var datestr2 = $('#datefield2-id').val(); 
```

我强烈建议在比较它们之前解析日期字符串。Javascript 的 Date 对象有一个 parse()-Method，但它只支持美国日期格式 (YYYY/MM/DD)。它返回自 unix 纪元开始以来的毫秒数，因此您可以简单地将值与 > 或 < 进行比较。

如果您想要不同的格式（例如 ISO 8661），您需要使用正则表达式或免费的 date.js 库。

如果你想成为超级用户，你可以使用 jquery ui datepickers 而不是 textfields。有一个允许输入日期范围的日期选择器变体：

[http://www.filamentgroup.com/lab/date_range_picker_using_jquery_ui_16_and_jquery_ui_css_framework/](http://www.filamentgroup.com/lab/date_range_picker_using_jquery_ui_16_and_jquery_ui_css_framework/)

            回答 #8

赞同：4

时间：2017-11-22T07:57:25.420

在 javascript/jquery 中，大多数开发人员使用字符串的 From & To 日期比较，而不转换为日期格式。从日期开始比较的最简单方法是比迄今为止更大。

```
Date.parse(fromDate) > Date.parse(toDate) 
```

在比较之前始终解析从和到日期以获得准确的结果

            回答 #9

赞同：3

时间：2016-05-09T13:35:49.273

```
jQuery('#from_date').on('change', function(){
    var date = $(this).val();
    jQuery('#to_date').datetimepicker({minDate: date});  
}); 
```

            回答 #10

赞同：2

时间：2011-02-05T08:50:40.753

我喜欢弗兰兹所说的，因为这就是我正在使用的：P

```
var date_ini = new Date($('#id_date_ini').val()).getTime();
var date_end = new Date($('#id_date_end').val()).getTime();
if (isNaN(date_ini)) {
// error date_ini;
}
if (isNaN(date_end)) {
// error date_end;
}
if (date_ini > date_end) {
// do something;
} 
```

            回答 #11

赞同：2

时间：2016-01-20T11:56:42.980

```
$(document).ready(function(){
   $("#txtFromDate").datepicker({
        minDate: 0,
        maxDate: "+60D",
        numberOfMonths: 2,
        onSelect: function(selected) {
          $("#txtToDate").datepicker("option","minDate", selected)
        }
    });

    $("#txtToDate").datepicker({
        minDate: 0,
        maxDate:"+60D",
        numberOfMonths: 2,
        onSelect: function(selected) {
           $("#txtFromDate").datepicker("option","maxDate", selected)
        }
    });
}); 
```

或访问此[链接](http://www.jquerybyexample.net/2012/01/end-date-should-not-be-greater-than.html)

            回答 #12

赞同：1

时间：2012-11-01T07:23:56.833

```
function endDate(){
    $.validator.addMethod("endDate", function(value, element) {
      var params = '.startDate';
        if($(element).parent().parent().find(params).val()!=''){
           if (!/Invalid|NaN/.test(new Date(value))) {
               return new Date(value) > new Date($(element).parent().parent().find(params).val());
            }
       return isNaN(value) && isNaN($(element).parent().parent().find(params).val()) || (parseFloat(value) > parseFloat($(element).parent().parent().find(params).val())) || value == "";              
      }else{
        return true;
      }
      },jQuery.format('must be greater than start date'));

}

function startDate(){
            $.validator.addMethod("startDate", function(value, element) {
            var params = '.endDate';
            if($(element).parent().parent().parent().find(params).val()!=''){
                 if (!/Invalid|NaN/.test(new Date(value))) {
                  return new Date(value) < new Date($(element).parent().parent().parent().find(params).val());
            }
           return isNaN(value) && isNaN($(element).parent().parent().find(params).val()) || (parseFloat(value) < parseFloat($(element).parent().parent().find(params).val())) || value == "";
                 }
                        else{
                     return true;
}

    }, jQuery.format('must be less than end date'));
} 
```

希望这会有所帮助:)

            回答 #13

赞同：0

时间：2018-07-29T10:56:58.937

首先，您使用 split 函数拆分两个输入框的值。然后以相反的顺序连接相同的内容。连接国家后将其解析为整数。然后比较 if 语句中的两个值。例如1>20-11-2018 2>21-11-2018

在拆分和连接新值后比较 20181120 和 20181121 之后比较相同。  

```
var date1 = $('#datevalue1').val();
var date2 = $('#datevalue2').val();
var d1 = date1.split("-");
var d2 = date2.split("-");

d1 = d1[2].concat(d1[1], d1[0]);
d2 = d2[2].concat(d2[1], d2[0]);

if (parseInt(d1) > parseInt(d2)) {

    $('#fromdatepicker').val('');
} else {

} 
```

            回答 #14

赞同：0

时间：2018-10-27T17:13:38.177

这应该工作

```
$.validator.addMethod("endDate", function(value, element) {
            var startDate = $('#date_open').val();
            return Date.parse(startDate) <= Date.parse(value) || value == "";
        }, "* End date must be after start date");
```

            回答 #15

赞同：0

时间：2021-05-24T13:34:42.857

你可以在两个不同的日期做这样的警报。

```
$('#end_date').on('change', function(){
             var startDate = $('#start_date').val();
             var endDate = $('#end_date').val();
             if (endDate < startDate){
                 alert('End date should be greater than Start date.');
                $('#end_date').val('');
             }
         }); 
```

您可以在日历上执行，它会自动禁用以前的日期。

```
$("#start_date").datepicker({
            dateFormat: 'dd/mm/yy',
            onSelect: function(date) {
                $("#end_date").datepicker('option', 'minDate', date);
            }
        });
$("#end_date").datepicker({ dateFormat: 'dd/mm/yy' }); 
```

            回答 #16

赞同：-2

时间：2009-05-07T10:56:02.357

如果保证格式正确 YYYY/MM/DD 并且两个字段之间完全相同，那么您可以使用：

```
if (startdate > enddate) {
   alert('error'
} 
```

作为字符串比较

```************``