# StackOverflow 问答 000576000-000576999

# winapi - 学习win32 API值得吗？

> ID：576034
> 
> 赞同：36
> 
> 时间：2009-02-22T23:13:13.873
> 
> 标签：winapi

我确信有人会专门问这个问题，但据我所知，没有人问过（有一个关于[学习 win32](https://stackoverflow.com/questions/342729/learning-the-win32-api)的问题，但不包括是否值得这样做）。

我对深入了解我使用的所有系统非常感兴趣（我主要使用 C# 进行编程，至少是专业的），所以我很简单地想知道 - 学习 win32 是值得的，还是有点矫枉过正？我在浪费时间吗？我获得的知识值得付出努力吗？

* * *

StackOverflow 上的类似/相关问题：

[学习低级 WinAPI 编程还有意义吗？](https://stackoverflow.com/questions/5507/does-it-still-make-sense-to-learn-low-level-winapi-programming)
[Win32 编程与现代专业人士的相关性如何？](https://stackoverflow.com/questions/506396/how-relevant-is-win32-programming-to-modern-professionals)

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-22T23:21:54.350

如果您计划将来进行 Windows 开发，那么了解最低级别的 Win32 如何工作肯定是非常宝贵的。它让您对 Windows、Messaging 和 GDI 等在您达到 .NET 级别时隐藏的事物有一定程度的了解。

我不建议您尝试使用 Win32 来编写所有应用程序，但我认为任何 Windows 开发人员都会从使用 C/C++ 编写简单的 Win32 应用程序中受益。

对于像 WPF 这样对 Win32 的依赖较少的事物来说，情况并非如此，但只要了解 Win32 的工作原理，就可以帮助您理解或欣赏 WPF 中的一些设计决策。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-22T23:36:07.390

如果以下所有内容都是正确的，我提倡学习**低级 Windows 编程背后的概念。**

1.  您将进行任何 Windows 编程。
2.  当无法解释的事情发生时，你想成为“去”的人。
3.  你爱学习。

像 .NET 这样的抽象层可以创建并允许开发人员在无需了解太多的情况下做出令人难以置信的事情。但是，当 .NET 以一种其作者未曾预料到的方式使用时，它揭示了其中一个微妙的错误，那么这就是一些 win32 API 知识大有帮助的时候。

您将不得不编写消息泵吗？我对此表示怀疑。它可以帮助诊断问题吗？完全正确！

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-22T23:46:42.870

这个问题很像，“学习**汇编**是否值得”；答案是一样的：

“是的，因为你会理解基本原理，并且能够比那些只在顶层抽象工作的人更深入地感知”。

但是，出于同样的原因，您*可能*不会在 99.5% 的时间里直接编写 Win32 API。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-22T23:57:24.313

当他们发明 C 来代替汇编语言时，人们可能会问：“学习汇编语言值得吗？” 了解两者的价值在于能够通过汇编来完成在 C 中无法完成的事情（例如触发中断）。

对于 Win32 也可以这样说。有些事情在 C# 中是不可能做到的。如果你不知道 win32 api，那么你会认为有些事情是不可能的。但是，一旦您知道自己缺少什么，在那些罕见的情况下，您将能够“降到 win32”并执行它们。

另一种看待它的方式是：编程就是能够同时在多个抽象层次上进行思考。例如，如果您知道您的语言使用不可变字符串，则不要编写将单个字符加到一个 10000 次的算法，因为它会很慢。如果您了解 win32 api，您将能够思考您用 C# 编写的每一行代码是如何实际实现的，这将帮助您编写更好的代码。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-22T23:23:10.103

至少对我来说，学习一个我不使用的 API（我假设暗示“深入”）是浪费时间。我宁愿花有限的时间和脑力来学习新概念或探索新工具，也不愿完全熟悉我现在不需要使用的现有工具。当我需要一个我没有或必须使用我不熟悉的工具的特定工具时，就是深入学习它的时候了。在此之前，我可能会做足够的调查以了解它是否对我有用，但仅此而已。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-22T23:38:21.067

是的，Win32 API 的原则对学习很有用——这些原则是构建其他一切的基础。

用于 GUI 开发的 .NET API，包括 Windows.Forms 和 WPF，在 Win32 API 之上的限制范围内完成它们所做的事情。这些框架的关键架构决策受到 Win32 API 的约束和通知。

另一方面，你不太可能从深入研究 API 中获得很多价值，因为有很多东西要学习，而且鉴于你大部分时间都花在 C# 上，你将有更少的机会去学习直接使用知识。

顺便说一句，这同样适用于其他技术——比如网络、密码学和硬件设计。学习基础知识将帮助您成为更好的开发人员。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-23T11:15:17.210

是的，您应该学习 Windows（其中很多东西早于 Win32）如何运行的基础知识。为什么？出于同样的原因，即使我不自己制作家具，我也了解榫卯接头的工作原理，或者即使我不自己进行汽车维修，我也了解内燃机的工作原理。

您在更高级别的抽象上工作，这很好，但是当[抽象泄漏](http://www.joelonsoftware.com/articles/LeakyAbstractions.html)时——这不是“如果”，那是“何时”——如果你不了解 Windows 的基础知识，你就会迷失方向。如果您至少不知道某些 API，那么如果您需要 P/Invoke .Net 中不可用的功能，您将不知道去哪里寻找。

除此之外，*好奇*的理由还不够吗？

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-22T23:16:16.533

如果您正在尝试编写一个 VB6 应用程序，那么 Win32 API 允许您做很多 VB6 本身不支持的事情。

如果您正在编写 C# WinForms 应用程序，那么我建议您首先学习广泛的 .NET Framework。

## 编辑

如果您*真的*想知道 Windows 的幕后发生了什么，那么您可能想查看Charles Petzold的[Programming Windows 3.1副本。](http://www.charlespetzold.com/oop/pw3.html)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-22T23:20:54.570

我个人认为Win32 API还是值得学习的。

据我回忆，当我开始学习 Win32 时（在做了一些 VB(A)、Pascal 等之后），我学到了很多关于 Windows 的知识并理解了 Windows 中的工作原理。一切都变得如此清晰。:)

因此，根据您的问题 - 您将通过学习 Win32 了解很多有关 Windows 的知识。正如您所说 - 您是一名 C# 程序员，我不确定您是否会经常使用它，因为您需要的几乎所有东西都已经在 .NET 中了。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-12-13T20:58:01.667

我不会一遍又一遍地重复其他人已经说过很多次的话。

这是一个**[Win32 教程](http://www.winprog.org/tutorial/)**的链接，我目前正在使用该教程学习 Win32 的基础知识。我发现它非常有趣且易于理解。

本教程帮助我首先了解我在中学时代开始编程时不了解的内容。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-25T05:31:20.687

这里的很多“否”答案似乎都集中在学习实际的方法、结构以及 API 中不可用的内容上。我会说是的，但不要关注 API 的各个组件，而是关注整体设计及其运行方式。当您了解操作系统核心级别发生的情况时，即使是 .NET 代码也可以更轻松地进行故障排除。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-22T23:28:25.427

你永远无法仅仅“学习”整个 win32 API，它太多了，而且它会成为一个移动的目标。如果您使用 C# 进行开发，则没有实际意义。

也就是说，尝试使用纯 C 和 API 调用创建记事本。这足以让 C# 开发人员至少欣赏它。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-22T23:43:23.893

如果我今天开始，我不会学习整个 API。但是，我确实认为理解基本概念很重要，理解消息循环如何工作是重中之重。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-05-13T17:17:46.957

这个问题看起来有点过时，但无论如何我都会回答。

答：复杂：是的。简单：可能没有必要。

这真的取决于你需要做什么。如果您需要使用 .NET 当前不支持的功能，请立即购买。但要小心，Win32 框架提供的大多数溺爱都没有，如果你做了一些非常愚蠢的事情，你的机器会蓝屏。

我知道当 .NET 刚出来的时候，我对学习 Win32 没有兴趣，.NET 就在这里，它是一个很大的进步。但关于 Windows 的可悲事实是：Windows 中的所有新功能首先是在本机代码中实现的。如果您想在 .NET 包装它之前使用 Windows 的任何部分，您可以使用 C++ 的 Win32 或 C# 或 VB.NET 的 Win32。.NET 是一个包装器，用于 Win32 中的所有内容。因此，如果您迫不及待，是的，如果您愿意，您可以互操作到操作系统的底层。

了解 Win32 并且可能有一天会了解 Win64（无论他们碰巧如何称呼它）将始终是一项有用的技能。任何 whizzbang 技术都需要某个地方的基础。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-05-19T16:38:34.440

.NET 是使用 win32 api 实现的，任何希望对 .NET 有更深入了解的人都会受益于至少对 win32api 有一点了解。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-09-24T20:21:44.063

我想进一步补充这一点。我从未正式研究过 Win32 API/MFC。当我第一次对 GUI 编程感兴趣时，我就开始使用 Visual C++ 4。无论如何，我希望我当时保持这个基础，因为我从来没有足够快地掌握（实际上我那时还很年轻），所以我转而学习了 Visual Basic。

出于某种原因，即使我对 Pascal 足够了解，Delphi 也从未让我感兴趣，但我离题了。这些天来，我在 IT 部门工作并在 NSIS 中开发安装程序脚本——而且我经常需要 NSIS 不提供的附加功能，所以我制作了自己的插件并保持它的快速和无依赖，我选择反对 Win32 API到 MFC 甚至是成熟的 C++。

这个评论的主要原因是我自己的好奇心让我着迷。我想知道更多，那么学习 API 的最佳资源在哪里。一本书？网站？

MFC 还值得处理吗？我确实看到了一个关于开发 Win32 GUI 应用程序的家伙的网站，在汇编中！老实说，我认为这有点矫枉过正，但它是紧凑、快速的代码、有趣的概念，但我从来没有能够掌握 80x86 汇编的窍门（见鬼，即使是大学里的 RISC 汇编我也无法做到！）

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-23T06:37:00.403

在您的职业生涯中，您不太可能只创建全新的应用程序，您可以在其中自由选择所使用的技术和编程语言。

迟早你将不得不与用 Win32 和 C/C++ 编写的旧代码集成。在这种情况下，了解 Win32 会有所帮助，尤其是当您使用 PInvoke 或 C++/CLI 进行集成时。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-09-02T23:51:20.440

误用.NET框架和Win32，你的机器会蓝屏？不知怎的，我对此表示怀疑。

了解 Win32（或汇编语言）的最大价值在于，当某些事情无法按预期工作时，您必须对其进行调试。您对底层系统了解得越多，调试问题的时间就越容易。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-04-27T13:05:31.757

*如果您的工作依赖于*系统，我认为了解系统如何工作总是很有趣。我并不是说你应该学习它的每一点，但仍然要有一个很好的理解，至少能够在你必须的那一天自己搜索更多。

软件并不神奇 - 好吧......好吧......对于 99% 的情况 :-)

这是 Eric Lippert 关于该主题的一篇关于“魔法思维”和“GUID 妖精”的优秀文章的链接：[这不是魔法](http://blogs.msdn.com/b/ericlippert/archive/2009/03/20/it-s-not-magic.aspx)

# ruby - 如何解析 UTF-8 数据并将其存储到 Ruby 中的制表符分隔文件中？

> ID：576038
> 
> 赞同：0
> 
> 时间：2009-02-22T23:14:34.227
> 
> 标签：ruby, utf-8

我有一个哈希名称 hsh ，它的值是 UTF-8 编码的。例如：

```
hsh ={:name => some_utf_8_string, :text => :some_other_utf_8_string} 
```

我目前正在执行以下操作：

```
$KCODE="UTF8"

File.open("save.tsv","w") do{|file|
  file.puts hsh.values.map{|x| x.to_s.gsub("\t",' ')}.join("\t")
} 
```

但这会随机发声，因为我认为某些多字节内容与“\ t”匹配并且它失败了。有没有我可以使用的推荐字符串来代替 "\t" 并且还有更好的方法来执行上述操作吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T23:24:39.570

如果您的数据是有效的 utf8，则制表符无法“排序”匹配多字节序列的一部分（这是 utf8 相对于其他一些多字节编码的优势之一）。你能更详细地了解你所说的“呱呱”是什么意思吗？

# php - 计数数组计数 1 太多

> ID：576051
> 
> 赞同：1
> 
> 时间：2009-02-22T23:20:31.077
> 
> 标签：php, arrays, count

有谁知道如何解决这个烦人的问题，即在计算数组中有多少个值时，如果值为 0，它会说 1，因为它会计算名称或其他东西。所以像这样：

```
0 : 1
1 : 1
2 : 2
3 : 3
4 : 4
5 : 5
6 : 6
7 : 7
8 : 8 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-22T23:25:46.823

为了完全回答这个问题，我需要这个代码。

我偷偷地怀疑你`count()`第一次输入的不是空数组，而是别的东西。一个已初始化、非空、非数组和非[`Countable`](http://php.net/manual/en/class.countable.php)对象变量的 a`count()`为 1。

有关更多信息，请参阅[count 的文档](http://php.net/count)。

# c# - 如何检索“平均值”性能计数器？

> ID：576054
> 
> 赞同：0
> 
> 时间：2009-02-22T23:21:35.943
> 
> 标签：c#, .net

我正在尝试检索 Windows 性能计数器并将其显示在 ASP.NET 页面中。但是，我很难检索平均类型的计数器。

说，我想检索计数器，例如每秒多少页请求？我不知道要计算那个值，因为 PerformanceCounter 类只给我 RawValue 和 NextValue，它们总是零。

请指教..

谢谢..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T01:48:51.503

每秒运行平均页面请求的一种方法是某种形式的 Web 日志分析器。有些甚至可能内置了平均功能。

如果这不是一个可接受的答案，您可能希望获得所需的计数器并存储它们返回给您的轮询值。如果这仅仅是平均页面请求/秒，您可以为每个点击添加一个时间值并保持其更轻的重量，因为必须在整个时间内运行 perfmon 可能不是最佳答案。

如果我在谷歌搜索，我会查看仪器，因为这就是您在这里的目标。祝你的任务好运。

# javascript - 在运行时构造 javascript 变量名

> ID：576055
> 
> 赞同：1
> 
> 时间：2009-02-22T23:21:48.063
> 
> 标签：javascript

```
someFunction(link) {
  someOtherFunction('div' + link);
} 
```

通过调用 someFunction("Test")，字符串 "divTest" 被传递给 someOtherFunction()。但我希望传递变量“divTest”的值。

怎么可能呢？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-22T23:37:16.637

使您的变量成为对象的成员。然后您可以使用`[]`字符串访问对象成员：

```
var byname = {
  divabc: ...,
  divxyz: ...
};

function someFunction(link) {
  someOtherFunction(byname['div'+link]);
}

someFunction('abc'); // calls someOtherFunction(byname.divabc) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-22T23:28:29.547

对于这种变量名称的动态构造/访问，您应该使用替代对象表示法，其中：

```
object.member === object["member"] 
```

这样，您可以将变量名称构造为字符串，并在方括号内使用它来访问对象成员。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-22T23:31:31.363

`eval`会这样做，但是当您想要合成这样的标识符时，它通常表明程序存在其他问题。正如 Ionut 所说，最好使用该`[]`符号。每当出现此类问题时，我都喜欢链接[到此。](http://perl.plover.com/varvarname.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-22T23:24:19.663

您应该能够使用“ [eval](http://www.w3schools.com/jsref/jsref_eval.asp) ”功能来完成此操作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T23:47:24.757

试试这个：

```
var divFoo = "bar";
function someFunction(link) {
    someOtherFunction(this['div' + link]);
}
function someOtherFunction(value) {
    alert(value);
}
someFunction("Foo"); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-22T23:27:21.593

正如 wybiral 所说，您只需要 eval：

```
someFunction(link) {
  someOtherFunction(eval('(div' + link + ')');
} 
```

基本上它所做的是将字符串的内容评估为代码。显然 eval 是一个危险的小工具，因为它允许执行任意代码，所以在使用它时要小心。

# asp.net-mvc - asp.net MVC，如何使用 HTTPApplication 类

> ID：576059
> 
> 赞同：1
> 
> 时间：2009-02-22T23:23:23.427
> 
> 标签：asp.net-mvc, httpapplication

如何在 MVC 中收集站点统计信息？（用户在线..等？）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-22T23:37:41.317

通常，您可以使用与普通 ASP.NET Web 应用程序相同的技术：在 global.asax 或类似的 OnSessionStart 处的用户计数器增量，或者您可以编写自己的事件处理程序来放置请求处理队列。

对于离线统计，可以使用谷歌分析，将他们的“sonda 代码”放入母版页。

twk

# sql - 使用复杂的 sql 查询的覆盖率...？

> ID：576071
> 
> 赞同：4
> 
> 时间：2009-02-22T23:28:31.060
> 
> 标签：sql

好的，我已经尝试解决这个问题大约 2 小时了......请告知：

表：

```
PROFILE [id (int), name (varchar), ...]
SKILL   [id (int), id_profile (int), id_app (int), lvl (int), ...]
APP     [id (int), ...] 
```

lvl基本上可以从0到3。

我试图获得这个特定的统计数据：“至少两个拥有 2 或更高技能的人覆盖的应用程序的百分比是多少？”

非常感谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T00:13:42.493

```
SELECT AVG(covered)
FROM (
  SELECT CASE WHEN COUNT(*) >= 2 THEN 1 ELSE 0 END AS covered
  FROM app a
  LEFT JOIN skill s ON (s.id_app = a.id AND s.lvl >= 2)
  GROUP BY a.id
) 
```

更有效的方法`MySQL`：

```
SELECT AVG
       (
         IFNULL
         (
           (
           SELECT 1
           FROM skill s
           WHERE s.id_app = a.id
           AND s.lvl >= 2
           LIMIT 1, 1
           ), 0
         )
       )
FROM app a 
```

一旦找到`person`每个的第二个熟练者，这将停止计数`app`。

如果你有几个`app`'s 但很多`person`'s 是有效的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T23:42:27.733

未经测试

```
select convert(float,count(*)) / (select count(*) from app) as percentage
from (
    select count(*) as number
    from skill
    where lvl >= 2
    group by id_app ) t
where t.number >= 2 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T00:01:21.137

逻辑是：百分比 = 100 *（感兴趣的应用程序数量）/（应用程序总数）

```
select 'percentage' = 
-- 100 times
  ( cast( 100 as float ) * 
-- number of apps of interest
  ( select count(id_app) 
    from ( select id_app, count(*) as skilled_count
           from skill
           where lvl >= 2
           group by id_app 
           having count(*) >= 2 ) app_counts ) 
-- divided by total number of apps
  / ( select count(*) from app ) 
```

需要转换为浮点数，因此 sql 不只是进行整数运算。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-22T23:32:41.393

```
SELECT SUM( CASE lvl WHEN 3 THEN 1 WHEN 2 THEN 1 ELSE 0 END ) / SUM(1) FROM SKILL 
```

如果您的数据库有 if/then 函数而不是`CASE`，请使用它。例如，在 MySQL 中：

```
SELECT SUM( IF( lvl >= 2, 1, 0 ) ) / SUM(1) FROM SKILL 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-22T23:55:08.373

我不确定这比 tvanfosson 的回答好还是坏，但无论如何：

```
SELECT convert(float, count(*)) / (Select COUNT(id) FROM APP) AS percentage
FROM APP INNER JOIN SKILL ON APP.id = SKILL.id 
WHERE (
   SELECT COUNT(id) 
   FROM SKILL AS Skill2 WHERE Skill2.id_app = APP.id and lvl >= 2
) >= 2 
```

# database - 属性值数据库

> ID：576080
> 
> 赞同：1
> 
> 时间：2009-02-22T23:33:40.873
> 
> 标签：database, sqlite, entity-attribute-value, sparql

我有许多对象，每个对象都有任意数量的共享和不同的属性值对（更具体地说：文件及其相关属性 - 例如图像的宽度和高度值，音乐的专辑/艺术家/长度文件等）。我希望能够搜索具有特定属性/值的对象（例如：按专辑）、按属性分组等。

对于这种情况，您建议使用哪种数据库？由于模块化（即时添加更多属性的能力），以及公共属性小于所有属性的 20% 的事实，具有规范化表的标准 SQL 并不能真正削减它。我已经尝试使用“[瘦数据模型](http://philip.greenspun.com/seia/user-registration-and-management)”来解决这个问题；但是我遇到了严重的可扩展性问题。

是否有针对这种情况调整的专门数据库（首选 BSD 许可的解决方案）？或者为此调整标准 RDBM 的任何替代方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T23:53:55.380

搜索具有某些属性的对象让我想到了 RDF 数据存储。看看一个 RDF API（参见 JENA、sesame、virtuoso）。

还是 BerkeleyDB ？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T18:10:28.203

您所说的称为[EAV](http://en.wikipedia.org/wiki/Entity-attribute-value_model)模型或[三重](http://www.w3.org/TR/rdf-concepts/#section-triples)商店。以后可以用[SPARQL查询](http://www.w3.org/TR/rdf-sparql-query/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T18:13:52.750

皮埃尔是对的；Triplestore 是您想要的，而 RDF 是它的标准。SPARQL 是查询它的标准语言（很像用于 RDBMS 的 SQL）。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-23T00:09:34.440

查看各种云服务提供的数据库：

*   [Google AppEngine 数据存储](http://code.google.com/intl/nl-NL/appengine/docs/python/gettingstarted/usingdatastore.html) （基于 Bigtable）
*   [亚马逊简单数据库](http://aws.amazon.com/simpledb/)
*   [微软 SDS](http://msdn.microsoft.com/en-us/sqlserver/dataservices/default.aspx)
*   [阿帕奇沙发数据库](http://couchdb.apache.org/&ei=8uihSY7UC8bF-QbBnO23Dg&sig2=jt4D-4wXg-pQL9PFZO8vPg&usg=AFQjCNHe5Uo6wBofiBNXHtxRsXkrVqzX4Q)

如果不能选择云数据库，BerkelyDB 可能是一个不错的选择。

# .net - 在 Visual Basic 中连接按钮和文本框

> ID：576094
> 
> 赞同：0
> 
> 时间：2009-02-22T23:40:02.437
> 
> 标签：.net, vb.net, dynamic-controls

我坚持这个要求我创建一个文本框和一个按钮的练习。每次按下按钮时，都应该在文本框中添加 1。有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T00:20:18.907

```
Public Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
    Dim i as Integer = int.Parse(TextBox1.Text)
    i += 1
    TextBox1.Text = i.ToString()
End Sub 
```

您还需要保护在文本框中的任何按键尝试或将其设置为 Enabled=true。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T23:43:46.403

1.  向按钮添加事件处理程序
2.  事件触发时：
3.  读取文本框中的文本值
4.  将其转换为数字
5.  将数字的值加一
6.  将该数字放回文本框
7.  利润 ：）

# html - 如何解码 HTML 实体？

> ID：576095
> 
> 赞同：26
> 
> 时间：2009-02-22T23:41:56.503
> 
> 标签：html, perl, ascii, special-characters

这是一个快速的 Perl 问题：

如何将 HTML 特殊字符转换`&uuml;`为`&#039;`普通的 ASCII 文本？

我从这样的事情开始：

```
s/\&#(\d+);/chr($1)/eg; 
```

并且可以为所有 HTML 字符编写它，但是可能已经存在一些这样的功能？

请注意，我不需要完整的 HTML->文本转换器。我已经用`HTML::Parser`. 我只需要用我得到的特殊字符转换文本。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-02-22T23:46:13.420

看看[HTML::Entities](http://search.cpan.org/perldoc?HTML::Entities)：

```
use HTML::Entities;

my $html = "Snoopy &amp; Charlie Brown";

print decode_entities($html), "\n"; 
```

你可以猜到输出。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-02-26T11:18:18.863

上面的答案告诉您如何将实体解码为 Perl 字符串，但您还询问了如何将这些实体更改为*ASCII*。

假设这确实是您想要的并且您不想要所有的 unicode 字符，您可以查看[Text::Unidecode](http://search.cpan.org/~sburke/Text-Unidecode-0.04/lib/Text/Unidecode.pm)模块，从 CPAN 将所有这些奇怪的字符重新转换为大致相似的 ASCII 字符集合：

```
use Text::Unidecode qw(unidecode);
use HTML::Entities qw(decode_entities);

my $source = '&#21271;&#20144;';  
print unidecode(decode_entities($source));

# That prints: Bei Jing 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-23T03:11:05.173

请注意，也有十六进制指定的字符。它们看起来像这样： é (e)。

使用 HTML::Entities 的 decode_entities 将实体转换为实际字符。要将其转换为 ASCII 需要更多的工作。我在过去使用了带有音译选项的 iconv（perl 接口：Text::Iconv）并取得了一些成功。但是，如果您正在处理一组有限的实体，或者您实际上不需要将其简化为 ASCII 等价物，您最好限制 decode_entities 生成的内容或为其提供自定义转换映射。请参阅 HTML::Entity 文档。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-22T23:47:18.050

有一些预定义的 HTML 实体 -`&amp;` `&quot;` `&gt;`等等 - 您可以硬编码。

然而，数字实体的较大情况`&#123;`会变得更加困难，因为这些值是[Unicode](http://unicode.org/)，并且转换为 ASCII 的范围从*困难*到*不可能*。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-08-01T22:24:08.810

我使用这个脚本。将其另存为`html2utf.py`ala 并使用它`echo $some_html | html2utf.py`。

```
#!/usr/bin/env python3
"""
An alternative for `perl -Mopen=locale -MHTML::Entities -pe '$_ = decode_entities($_)'` (which you can use by `cpanm HTML::Entities`) and `recode html..`.
"""

import fileinput
import html

for line in fileinput.input():
    print(html.unescape(line.rstrip('\n'))) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-02-05T08:37:46.590

我为 bash 创建了一个单行程序，使用 Perl 来解码传递给 perl 的 HTML 实体。我的解决方案是[这个答案](https://stackoverflow.com/a/576103/4220913)（见上文）和我上周在[commandlinefu.com上找到的东西的混合。](https://www.commandlinefu.com/commands/view/4840/url-encode)

我们大多数使用 Bash 编写代码的人都没有习惯使用`echo -n`删除`\n`换行符，因为它通常不会影响 Bash 文本解析。使用 Perl——以及这种特殊的方法——使用它很重要，`echo -n`否则 perl 会将“换行”`\n`字符解释为响应的文字部分，`%0A`从而在结果中添加不需要的字符。

这是我的 bash-perl 单线混合：

```
encodedURL="$(echo -n "$entityURL" | perl -MHTML::Entities -MURI::Escape -ne 'print uri_escape(decode_entities($_))')" 
```

例子：

输入：`Seals \&amp; Croft - Summer Breeze`

输出：`Seals%20%26%20Croft%20-%20Summer%20Breeze`

# mysql - 如何从 mysql 数据库中选择以特定字母开头的标题？

> ID：576096
> 
> 赞同：2
> 
> 时间：2009-02-22T23:41:58.217
> 
> 标签：mysql

我需要按字母顺序列出电影标题，因此我只需要显示以所选字母开头的项目。为了使这稍微复杂一些，许多标题以“the”或“a”开头，需要忽略。

mysql 查询将如何完成这样的任务？

我可以简单地为每个标题存储一个带有搜索字母的额外列，因为它很容易用 php 完成，但我希望有一个比这更干净的解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-22T23:49:19.387

```
SET @letter = 'A';

SELECT  title
FROM    movies
WHERE   title REGEXP CONCAT('^(the |a )?', @letter); 
```

`title`但是，如果有的话，这不会使用索引。

对于要使用的索引，您需要执行以下操作：

```
SET @letter = 'A';

SELECT  title
FROM    movies
WHERE   title LIKE CONCAT('the ', @letter, '%')
        OR title LIKE CONCAT('a ', @letter, '%')
        OR title LIKE CONCAT(@letter, '%') 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T23:43:19.620

```
SELECT  * FROM blah WHERE TITLE LIKE 'a%'; 
```

或者

```
SELECT * FROM blah WHERE SUBSTRING(TITLE, 1,1)='a'; 
```

或者，更进一步，涵盖忽略：

```
SELECT * FROM blah WHERE 
IF(SUBSTRING(TITLE, 1, 2)='a ',
  SUBSTRING(TITLE, 3, 1), 
  IF(SUBSTRING(TITLE, 1, 4) = 'the ', 
    SUBSTRING(title, 5, 1), SUBSTRING(TITLE, 1,1)
  )
)=='a'; 
```

在其他情况下，您也应该能够使用相同的 if 块来获取数据。

编辑：应得的信用 - Quassnoi 的正则表达式选项更加简洁 - 有兴趣了解性能比较。

但是，如果有专门的字段，它可能会表现得更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-22T23:46:13.590

这将处理“开始于”要求：

SELECT title FROM table WHERE title LIKE "D%"

为了处理以“a”或“the”等开头的电影标题，是否可以调整这些进入数据库的方式。例如。“电影，A”而不是“电影”

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-22T23:44:30.460

要仅选择以所选字母开头的标题，您可以执行以下操作

```
select * from movies where title like 'a%' 
```

# objective-c - NSTimeInterval 到可读的 NSNumber

> ID：576110
> 
> 赞同：3
> 
> 时间：2009-02-22T23:48:48.670
> 
> 标签：objective-c, cocoa, floating-point, double, rounding

NSTimeInterval == 双倍；（例如 169.12345666663）

我怎样才能把这个双数四舍五入，以便在“点”之后只剩下 2 位数字？
如果结果是 NSNumber，那就太好了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-22T23:56:23.783

如果这是出于显示目的，请查看[NSNumberFormatter](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSNumberFormatter_Class/Reference/Reference.html)。

如果出于某种原因您真的想在计算中舍入双精度数，您可以使用标准 C`round()`函数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-24T16:26:28.607

[可以使用NSDecimalRound()](http://developer.apple.com/library/ios/#documentation/Cocoa/Reference/Foundation/Miscellaneous/Foundation_Functions/Reference/reference.html#//apple_ref/c/func/NSDecimalRound)将 NSDecimal 舍入到指定的位数。

```
double d = [[NSDate date] timeIntervalSince1970];
NSDecimal in = [[NSNumber numberWithDouble:d] decimalValue];
NSDecimal out;
NSDecimalRound( &out, &in, 2, NSRoundUp );

NSDecimalNumber *result = [NSDecimalNumber decimalNumberWithDecimal:out]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-29T12:20:15.257

如果你真的想在点后留下两位数，乘以 100，使用 round() 函数将其四舍五入，再除以 100。但是，这并不能保证它在点之后真的只有两位数，因为通过再次划分它，您可能会得到一个无法真正用浮点表示法表达的数字，而当您期望 0.1 时，您实际上可能会得到 0.09999.. .，那是因为你不能用浮点表示法真正表达 0.1。

如果您只想在点后将其四舍五入为两位数以进行显示，则可以按照建议使用 NSNumberFormatter 或仅使用：

```
printf("%.2f\n", yourTimeInterval);
NSLog(@"%.2f\n", yourTimeInterval); 
```

或者要获得 NSString，您还可以使用以下内容，这可能比使用 NumberFormatter 更快（但是，它不会根据用户偏好进行本地化）：

```
NSString * intervalStr = nil;
char * intervalStrTmp = NULL;
asprintf(&intervalStrTmp, "%.2f", yourTimeInteval);
if (intervalStrTmp) {
  intervalStr = [[NSString alloc] initWithUTF8String:intervalStrTmp];
  free(intervalStrTmp);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-22T23:51:02.067

这个[HumanReadableTimeInterval 有](http://www.cocoadev.com/index.pl?HumanReadableTimeInterval)帮助吗？但是，它返回一个 NSString。或者，您可以通过乘以 100、转换为整数并再次除以 100 来四舍五入。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T23:55:23.850

在绝大多数情况下，对数字进行四舍五入是您只应在显示时执行的操作。浮点数（双精度或非双精度）的特性使得无法以固定精度存储某些数字。

有关格式化数字以使其显示为小数点后两位的信息，[请参阅另](https://stackoverflow.com/questions/560517/how-to-set-the-float-value-to-two-decimal-number-in-objective-c/560525#560525)一篇文章。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-28T10:17:40.043

我只会使用 ANSI C`round()`函数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-30T10:06:31.137

您始终可以使用以下方法对数字进行四舍五入：

```
double round2dec(double a) { return round(a * 100) / 100; } 
```

但很可能结果表示为双精度数不会只有 2 位小数。

现在，如果使用 == 符号，则意味着您的两个双精度数的比较仅对小数点后第二位进行。这是您可以执行的操作：

```
fabs(round2dec(NSTimeInterval) - round2dec(double)) < std::numeric_limits<double>::epsilon() 
```

# asp.net - 使用 cookie 防止访问站点中的某些非安全页面

> ID：576112
> 
> 赞同：0
> 
> 时间：2009-02-22T23:49:34.907
> 
> 标签：asp.net

如果我有一个小型微型站点，并且在第一页上我想确保用户不能跳转到（例如 2 或 3）之间的非安全页面，那么实现这一点的最佳方法是什么？只有当用户在下拉框中设置某个项目时，才能看到下一页。

我的第一个想法是饼干。如果用户转到第二个页面并且 cookie 的值为空，则重定向到失败页面。如果用户选择了正确的值，则 cookie 的值设置为成功。如果我将第二页上的链接发送给另一台 PC 上的朋友，这种方法会起作用吗？

有没有更好的办法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T10:04:52.683

如果我正确理解您的问题，那么您发送给您朋友的链接将不起作用，因为他们不会将 cookie 存储在他们的浏览器内存或他们的机器上。如果您将值存储在 Session 中也是如此，因为他们将在打开链接时创建自己的新会话。

要在共享链接时获得这种行为，您需要在查询字符串中传递值，即，当您在第 1 页上选择所需的选项并 sublit 表单时，回发采用所选选项，然后重定向到第 2 页，并附加选项url 作为查询字符串值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T00:16:45.920

便宜又脏？cookie 或会话值有效。两者都不是长期可靠的。

如果您这样做是为了让用户在选择下拉菜单后只能看到某些信息，您可以将其隐藏在面板中，并且仅在选择下拉菜单时显示该面板。如果您不介意用户每次都必须从下拉列表中进行选择，这是最有用的。如果您希望用户能够在不选择下拉菜单的情况下查看数据，您也可以将其与 cookie 一起使用。

隐藏在同一页面中（一个面板中下拉，另一个面板中的信息），您可以永久隐藏它。

如果这必须是第二个页面，您也可以将该页面放在另一个目录中，然后在其中放置一个需要登录的web.config文件。然后您可以通过“登录”使其成为“登录”每个回答的人。您最终会使用 Membership 位，但它们并没有与任何东西挂钩。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T00:21:19.373

出于一个特定原因，Cookie 并不是一个好主意。它们在用户的控制之下，而不是你。

如果用户禁用了 cookie（全局或仅针对您的站点），那么无论他们阅读第 1 页多少次，他们现在都无法访问第 2 页。

此外，如果他们知道您的 cookie 包含什么（即未加密），他们可以轻松地自己创建它或将方法转发给朋友让他们创建它。

关于您是否可以将第 2 页链接发送给其他人的问题，cookie 属于计算机。这意味着“其他人”几乎肯定不会拥有正确查看第 2 页的正确 cookie：他们会收到错误消息。

我们实施了一个类似的计划（很多年前，所以现在可能有更好的方法来做到这一点）。它涉及在将第 1 页传送到 IP 地址时存储一个特殊的“一次性”密钥。该页面 1 中的链接已修改为包含此键作为参数，因此，当您请求页面 2 时，该键也被发送。

密钥的生命周期为 30 分钟（可配置，但我们最终为 30 分钟）。为了让我们提供第 2 页，请求必须来自相同的 IP 地址并具有正确的密钥。

这阻止了将链接转发到其他地方并确保链接具有有限的生命周期。

这对你来说是否是一个可行的解决方案是一个只有你才能回答的问题。我知道我们收到了一些人的投诉，他们买了第 1 页，然后出去喝咖啡。当他们回来时，他们访问第 2 页的尝试没有成功。我们通过简单地将他们重定向到第 1 页来解决此问题，并带有适当的错误消息，表明他们的密钥已超时。

并不完美，但是，由于用户被告知为什么会发生这种情况，他们理解它的必要性。

# asp.net - ASP.NET Post Application_Error 事件

> ID：576113
> 
> 赞同：1
> 
> 时间：2009-02-22T23:49:58.933
> 
> 标签：asp.net, http, http-headers, httpmodule, page-lifecycle

我试图找到一个将在所有`Application_Error`事件处理程序之后立即触发的事件，以便我可以使用自定义 HttpModule 修改发送的响应（弄乱状态代码和“位置”标头并专门创建一个新正文）。

我已经尝试过挂钩`Application_EndRequest`（因为我已经读到这是唯一可以保证触发的处理程序）但是这在请求处理中为时已晚，无法修改响应标头，我得到`HttpException`：

```
Server cannot append header after HTTP headers have been sent. 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T23:56:09.213

我认为 ASP.Net 在 ApplicationError 之后启动了一个新响应，只是针对不同的错误处理页面。尝试加入此响应。

**更新**确定：这是怎么做的！

我想确保我们既可以附加错误处理程序，又可以优雅地处理页面中的事件，因此我们不能将最后一个服务器错误设为空，并且我们还希望能够添加标题！

在 web.config 中，添加：

```
<customErrors redirectMode="ResponseRewrite" mode="On">
    <error statusCode="500" redirect="~/ErrorHandler.aspx"/>
</customErrors> 
```

或者你想要捕捉的任何错误。在 httpModules 下：

```
<add name="ErrorModule" type="TestErrorLifecycle.ErrorModule, TestErrorLifecycle"/> 
```

记录错误的代码在此模块中：

```
public class ErrorModule : IHttpModule
{
    private volatile object locker = new object();

    public void Init(HttpApplication context)
    {
        context.Error += context_Error;
    }

    void context_Error(object sender, EventArgs e)
    {
        var app = sender as HttpApplication;

        lock (locker)
        {
            assertLogDirectory(app.Server);

            using (var fs = File.AppendText(app.Server.MapPath("~/logs/errorlog.txt")))
            {
                var lastException = app.Server.GetLastError();
                if (lastException == null) throw new ApplicationException("Not expected...");
                fs.WriteLine(lastException.Message);
            }
        }

        // we could also do a Request.Redirect() here...
    }

    private void assertLogDirectory(HttpServerUtility server)
    {
        var logdir = server.MapPath("~/logs/");
        if (!Directory.Exists(logdir))
            Directory.CreateDirectory(logdir);
    }

    public void Dispose()
    {
    }
} 
```

我只是将它写入文件系统。您可以使用内核文件事务或排他锁或其他任何东西，但因为我知道我只会从这里写入这个文件，所以我选择了一个简单的私有信号量。

我在 Default.aspx.cs 中添加了这个只是为了测试：

```
protected void Page_Load(object sender, EventArgs e)
{
    throw new ApplicationException("wtf, something wrong??!");
} 
```

在其中创建了文件 ErrorHandler.aspx（为简短起见，省略了一些部分）：

```
<body>
    <h2>Error handler</h2>
    <form id="form1" runat="server">
        <p>Last error: <asp:Label ID="lblError" runat="server" /></p>
    </form>
</body> 
```

这是页面类：

```
public partial class ErrorHandler : Page
{
    public ErrorHandler()
    {
        Load += ErrorHandler_Load;
    }

    private void ErrorHandler_Load(object sender, EventArgs e)
    {
        Response.AddHeader("X-TESTING", "Yes it works...");
        lblError.Text = Server.GetLastError() == null ? "noo, why is it null?!?" : Server.GetLastError().Message;
    }
} 
```

最后，我在 ErrorHandler.aspx 中获得了这些响应标头：

```
Server: ASP.NET Development Server/9.0.0.0
Date: Mon, 23 Feb 2009 00:37:45 GMT
X-AspNet-Version: 2.0.50727
X-TESTING: Yes it works...
Cache-Control: private
Content-Type: text/html; charset=utf-8
Content-Length: 725
Connection: Close
200 OK 
```

如果您尝试直接添加到 Response.Headers-collection，您需要以管道模式运行 IIS：[http ://forums.asp.net/p/1253457/2323117.aspx](http://forums.asp.net/p/1253457/2323117.aspx)

我希望这有帮助！干杯亨利克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T23:58:19.490

除非您在发送任何响应之前移动所有容易出错的代码，否则您将无法解决此问题。如果您想这样做，您需要设置一个 HttpHandler 以在将任何信息发送回客户端之前运行所有代码。

有一些方法可以重新架构以将信息返回给客户。知道应用程序在哪里崩溃并通过 try ... catch 运行它会有所帮助。

# scala - 在 Scala 中解包元组类型

> ID：576131
> 
> 赞同：7
> 
> 时间：2009-02-23T00:00:41.760
> 
> 标签：scala, types, tuples

我只是想知道，我可以在 Scala 中将元组类型分解为其组件的类型吗？

我的意思是，像这样

```
trait Container {
  type Element
}

trait AssociativeContainer extends Container {
  type Element <: (Unit, Unit)
  def get(x : Element#First) : Element#Second
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T00:42:10.740

本质上，您无法打开包装，但也许这可以达到您想要的效果：

```
 type First
  type Second
  type Element = (First, Second)
  def get(x: First): Second 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-05-15T21:44:02.550

这不会解包类型，但会限制类型`A`和`B`调用`get`.

```
trait Container {
  type Element
}

trait AssociativeContainer extends Container {
  type Element <: Tuple2[_, _]

  def get[A, B](x: A)(implicit ev: (A, B) =:= Element): B
} 
```

`Element`这看起来很有希望，但在作弊——如果是抽象的，它就行不通。

```
def Unpack[T<:Tuple2[_, _]] = new {
  def apply[A, B](implicit ev: T <:< (A, B)) = new {
    type AA = A
    type BB = B
  }
}

trait AssociativeContainer {
  type Element = (Int, String)
  val unpacked = Unpack[Element].apply
  type A = unpacked.AA
  type B = unpacked.BB

  1: A
  "": B
  def get(x: A): B
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-15T20:53:32.927

我对此有点晚了，但是使用模式匹配呢？没有完全正确的返回类型，我的语法可能有点不对，但这里是：

```
def get[K](key: K): Iterable[Any] {
  for ((key, x) <- elements) yield x
} 
```

# java - 数学帮助 - 无法旋转某些东西（知道 Java 会是一个加号）

> ID：576162
> 
> 赞同：0
> 
> 时间：2009-02-23T00:21:30.540
> 
> 标签：java, math, polygon, angle

好的，我正在尝试根据角度 0.x 的原始位置旋转 Java 多边形，并且 y 在我使用它们结束时最终被转换为 int，所以我可以理解没有看到一些变化，但是当角度差异很大，例如 0 到 180 我想我应该看到**一些东西**。

我已经有一段时间了，想不出它是什么。这是方法。（对不起，如果代码标签弄乱了，我的火狐把它们弄乱了。）

```
public void rotate(double x, double y, obj o1)
{
    double dist = Math.sqrt(Math.pow(x - (o1.x + (o1.w/2)), 2) + Math.pow(y - (o1.y + (o1.h/2)),2));

    x +=  (Math.sin(Math.toRadians(o1.a)) * dist);
    y -=  (Math.cos(Math.toRadians(o1.a)) * dist);  
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T00:39:25.053

方法中操作的`x`和的值不会在调用它的方法中看到，因为[Java 通过值传递方法参数](http://javadude.com/articles/passbyvalue.htm)。`y``rotate`

因此，方法中被改变的`x`and值是一个本地副本，所以一旦超出范围（即从方法返回到它的调用方法），and的值就会消失。`y``rotate``rotate``x``y`

所以目前，正在发生的事情是：

```
x = 10;
y = 10;
o1 = new obj();
o1.a = 100;
rotate(x, y, obj);
System.out.println(x);  // Still prints 10
System.out.println(y);  // Still prints 10 
```

在 Java 中从方法中获取多个值的唯一方法是传递一个对象，并操作传入的对象。（实际上，在进行方法调用时会传入对该对象的引用的副本。）

例如，重新定义`rotate`以返回 a `Point`：

```
public Point rotate(int x, int y, double angle)
{
    // Do rotation.
    return new Point(newX, newY);
}

public void callingMethod()
{
    int x = 10;
    int y = 10;
    p = rotate(x, y, 45);
    System.out.println(x);  // Should print something other than 10.
    System.out.println(y);  // Should print something other than 10.
} 
```

也就是说，正如[Pierre 建议](https://stackoverflow.com/questions/576162/math-help-cant-rotate-something-knowing-java-would-be-a-plus/576168#576168)的那样，在我看来，使用[AffineTransform](http://java.sun.com/javase/6/docs/api/java/awt/geom/AffineTransform.html)会容易得多。

例如，创建一个[`Rectangle`](http://java.sun.com/javase/6/docs/api/java/awt/Rectangle.html)对象并使用它旋转它`AffineTransform`可以通过以下方式执行：

```
Rectangle rect = new Rectangle(0, 0, 10, 10);

AffineTransform at = new AffineTransform();
at.rotate(Math.toRadians(45));

Shape rotatedRect = at.createTransformedShape(rect); 
```

`AffineTransform`可以应用于实现[`Shape`](http://java.sun.com/javase/6/docs/api/java/awt/Shape.html)接口的类。`Shape`可以在接口的链接 Java API 规范中找到实现的类列表`Shape`。

有关如何使用`AffineTransform`和 Java 2D 的更多信息：

*   [轨迹：2D 图形](http://java.sun.com/docs/books/tutorial/2d/index.html)
*   [课程：Java2D 中的高级主题](http://java.sun.com/docs/books/tutorial/2d/advanced/index.html)
    *   [变换形状、文本和图像](http://java.sun.com/docs/books/tutorial/2d/advanced/transforming.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T00:27:21.713

仅供参考：旋转形状和点已在[java.awt.geom.AffineTransform中实现](http://java.sun.com/j2se/1.4.2/docs/api/java/awt/geom/AffineTransform.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T00:35:32.053

您正在执行[2D 旋转变换](http://en.wikipedia.org/wiki/Rotation_matrix)。

它应该看起来像这样：

```
xnew = xold*cos(t) - yold*sin(t)
ynew = xold*sin(t) + yold*cos(t) 
```

当然，旋转角度 t 必须以弧度为单位。它在 x 轴为零，并在逆时针方向增加。

新旧点都需要相对于您正在旋转的原点表示。

# unix - 学习 Unix API 的好书？

> ID：576163
> 
> 赞同：5
> 
> 时间：2009-02-23T00:23:54.997
> 
> 标签：unix

我很想学习用 C kernell 调用和所有这些在纯 UNIX 中编程，但我基本上不知道从哪里开始......

书籍通常是最好的方式，所以这就是我要一本的原因——但一些好的在线材料也可以。但是请不要使用维基百科——我不想要百科全书，我想要一些书来指导我了解 unix API 并向我展示在那里可以完成哪些惊人的事情（比如 Aaron Hillegass 和他的 Cocoa Programming for Mac OS X），而不是书向我扔随机的东西。

好的，这几乎是我的问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T00:30:51.407

我有你要找的书：[“高级 UNIX 编程”](https://rads.stackoverflow.com/amzn/click/com/0131411543)。还有另一本书[《Unix 环境中的高级编程》](https://rads.stackoverflow.com/amzn/click/com/0131411543)非常好。我建议从第一个开始。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T00:34:34.643

除了 pheze 建议的“高级 UNIX 编程”之外，大多数 UNIX 系统都支持 POSIX 规范。为此，您可以从[O'reilly 关于 POSIX 的书](http://oreilly.com/catalog/9780937175736/index.html)开始。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T00:47:54.767

[Unix 编程的艺术](http://books.google.com/books?id=CZae0PbOXJMC&dq=the+art+of+unix+programing&printsec=frontcover&source=bn&hl=en&ei=1_GhSa-oO9KgtwfXpJiDDQ&sa=X&oi=book_result&resnum=4&ct=result#PPR10,M1)是一门很好的艺术。

# python - 使用 __init__() 方法理解 Python super()

> ID：576169
> 
> 赞同：2953
> 
> 时间：2009-02-23T00:30:08.570
> 
> 标签：python, class, oop, inheritance, super

我试图了解`super()`. 从外观上看，两个子类都可以创建，就好了。

我很想知道以下 2 个子类之间的实际区别。

```
class Base(object):
    def __init__(self):
        print "Base created"

class ChildA(Base):
    def __init__(self):
        Base.__init__(self)

class ChildB(Base):
    def __init__(self):
        super(ChildB, self).__init__()

ChildA() 
ChildB() 
```

* * *

## 回答 #1

> 赞同：2148
> 
> 时间：2009-02-23T00:37:31.220

`super()`让您避免显式引用基类，这很好。但主要优势在于多重继承，可以发生各种[有趣](http://www.artima.com/weblogs/viewpost.jsp?thread=236275)的事情。如果您还没有，请参阅[super 上的标准文档。](https://docs.python.org/2/library/functions.html#super)

请注意，[Python 3.0 中的语法发生了变化](https://docs.python.org/3/library/functions.html#super)`super().__init__()`：您可以说`super(ChildB, self).__init__()`哪个 IMO 更好一些。标准文档还参考了使用[指南，`super()`](https://rhettinger.wordpress.com/2011/05/26/super-considered-super/)该指南非常易于解释。

* * *

## 回答 #2

> 赞同：1041
> 
> 时间：2014-11-25T19:00:33.520

> ## 我试图理解`super()`

我们使用的原因`super`是，可能使用协作多重继承的子类将在方法解析顺序 (MRO) 中调用正确的下一个父类函数。

在 Python 3 中，我们可以这样称呼它：

```
class ChildB(Base):
    def __init__(self):
        super().__init__() 
```

在 Python 2 中，我们需要`super`像这样使用定义类的名称和来调用`self`，但从现在开始我们将避免这种情况，因为它是多余的、较慢的（由于名称查找）和更冗长的（所以如果你更新你的 Python还没有！）：

```
 super(ChildB, self).__init__() 
```

如果没有 super，您使用多重继承的能力会受到限制，因为您硬连线下一个父级的调用：

```
 Base.__init__(self) # Avoid this. 
```

我在下面进一步解释。

> ## “这段代码实际上有什么区别？：”

```
class ChildA(Base):
    def __init__(self):
        Base.__init__(self)

class ChildB(Base):
    def __init__(self):
        super().__init__() 
```

此代码的主要区别在于，您在with中`ChildB`获得了一个间接层，它使用定义它的类来确定要在 MRO 中查找的下一个类。`__init__``super``__init__`

我在[规范问题的答案中说明了这种差异，如何在 Python 中使用“超级”？](https://stackoverflow.com/a/33469090/541136)，它演示了**依赖注入**和**协作多重继承**。

## 如果 Python 没有`super`

这里的代码实际上非常接近`super`（它是如何在 C 中实现的，减去一些检查和回退行为，然后翻译成 Python）：

```
class ChildB(Base):
    def __init__(self):
        mro = type(self).mro()
        check_next = mro.index(ChildB) + 1 # next after *this* class.
        while check_next < len(mro):
            next_class = mro[check_next]
            if '__init__' in next_class.__dict__:
                next_class.__init__(self)
                break
            check_next += 1 
```

写得更像原生 Python：

```
class ChildB(Base):
    def __init__(self):
        mro = type(self).mro()
        for next_class in mro[mro.index(ChildB) + 1:]: # slice to end
            if hasattr(next_class, '__init__'):
                next_class.__init__(self)
                break 
```

如果我们没有该`super`对象，我们将不得不在任何地方编写此手动代码（或重新创建它！）以确保我们在方法解析顺序中调用正确的下一个方法！

super 如何在 Python 3 中做到这一点，而不被明确告知调用它的方法中的哪个类和实例？

它获取调用堆栈帧，并找到类（隐式存储为局部自由变量，`__class__`使调用函数成为类的闭包）和该函数的第一个参数，它应该是通知它哪个实例或类要使用的方法解析顺序 (MRO)。

由于它需要 MRO 的第一个参数，因此无法[使用`super`静态方法，因为它们无法访问调用它们的类的 MRO](https://bugs.python.org/issue31118)。

## 对其他答案的批评：

> super() 让您避免显式引用基类，这很好。. 但主要优势在于多重继承，可以发生各种有趣的事情。如果您还没有，请参阅 super 上的标准文档。

它相当随意，并没有告诉我们太多，但重点`super`不是避免编写父类。重点是确保调用方法解析顺序 (MRO) 中的下一个方法。这在多重继承中变得很重要。

我会在这里解释。

```
class Base(object):
    def __init__(self):
        print("Base init'ed")

class ChildA(Base):
    def __init__(self):
        print("ChildA init'ed")
        Base.__init__(self)

class ChildB(Base):
    def __init__(self):
        print("ChildB init'ed")
        super().__init__() 
```

让我们创建一个我们希望在 Child 之后调用的依赖项：

```
class UserDependency(Base):
    def __init__(self):
        print("UserDependency init'ed")
        super().__init__() 
```

现在请记住，`ChildB`使用 super，`ChildA`而不是：

```
class UserA(ChildA, UserDependency):
    def __init__(self):
        print("UserA init'ed")
        super().__init__()

class UserB(ChildB, UserDependency):
    def __init__(self):
        print("UserB init'ed")
        super().__init__() 
```

并且`UserA`不调用 UserDependency 方法：

```
>>> UserA()
UserA init'ed
ChildA init'ed
Base init'ed
<__main__.UserA object at 0x0000000003403BA8> 
```

但`UserB`实际上是否调用 UserDependency 因为`ChildB`调用`super`：

```
>>> UserB()
UserB init'ed
ChildB init'ed
UserDependency init'ed
Base init'ed
<__main__.UserB object at 0x0000000003403438> 
```

### 批评另一个答案

在任何情况下，您都不应该执行以下操作，另一个答案表明，当您将 ChildB 子类化时，您肯定会遇到错误：

```
super(self.__class__, self).__init__()  # DON'T DO THIS! EVER. 
```

[（这个答案不是很聪明也不是特别有趣，但是尽管评论中有直接的批评和超过 17 票反对，但回答者坚持提出建议，直到一位善良的编辑解决了他的问题。）]

解释：使用`self.__class__`in 代替类名`super()`会导致递归。`super`让我们在 MRO（请参阅此答案的第一部分）中查找子类的下一个父级。如果您告诉`super`我们在子实例的方法中，那么它将查找行中的下一个方法（可能是这个方法）导致递归，可能导致逻辑失败（在回答者的示例中，确实如此）或`RuntimeError`递归深度超过。

```
>>> class Polygon(object):
...     def __init__(self, id):
...         self.id = id
...
>>> class Rectangle(Polygon):
...     def __init__(self, id, width, height):
...         super(self.__class__, self).__init__(id)
...         self.shape = (width, height)
...
>>> class Square(Rectangle):
...     pass
...
>>> Square('a', 10, 10)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 3, in __init__
TypeError: __init__() missing 2 required positional arguments: 'width' and 'height' 
```

幸运的是， Python 3 的`super()`不带参数的新调用方法使我们能够回避这个问题。

* * *

## 回答 #3

> 赞同：270
> 
> 时间：2013-10-08T20:08:39.057

已经注意到，在 Python 3.0+ 中，您可以使用

```
super().__init__() 
```

进行调用，这很简洁，不需要您显式引用父 OR 类名称，这很方便。我只是想为 Python 2.7 或更低版本添加它，有些人通过编写`self.__class__`而不是类名来实现名称不敏感的行为，即

```
super(self.__class__, self).__init__()  # DON'T DO THIS! 
```

`super`但是，这会中断对从您的类继承的任何类的调用，其中`self.__class__`可能返回子类。例如：

```
class Polygon(object):
    def __init__(self, id):
        self.id = id

class Rectangle(Polygon):
    def __init__(self, id, width, height):
        super(self.__class__, self).__init__(id)
        self.shape = (width, height)

class Square(Rectangle):
    pass 
```

这里我有一个类`Square`，它是 的子类`Rectangle`。假设我不想为 for 编写单独`Square`的构造函数，因为构造函数 for`Rectangle`已经足够好了，但无论出于何种原因，我都想实现一个 Square，这样我就可以重新实现一些其他方法。

当我创建`Square`using`mSquare = Square('a', 10,10)`时，Python 调用构造函数 for`Rectangle`因为我没有给出`Square`它自己的构造函数。但是，在 for 的构造函数中`Rectangle`，调用`super(self.__class__,self)`将返回 的超类`mSquare`，因此它`Rectangle`再次调用了 for 的构造函数。正如@S_C 所提到的，这就是无限循环的发生方式。在这种情况下，当我运行时，`super(...).__init__()`我正在调用构造函数，`Rectangle`但由于我没有给它任何参数，我会得到一个错误。

* * *

## 回答 #4

> 赞同：82
> 
> 时间：2012-11-27T23:26:47.940

超级没有副作用

```
Base = ChildB

Base() 
```

按预期工作

```
Base = ChildA

Base() 
```

进入无限递归。

* * *

## 回答 #5

> 赞同：74
> 
> 时间：2012-05-25T17:52:49.797

只是提醒一下......对于 Python 2.7，我相信自从`super()`在 2.2 版中引入以来，您只能[`super()`](http://docs.python.org/library/functions.html#super)在其中一个父级继承自最终继承的类`object`（[新型类](http://docs.python.org/glossary.html#term-new-style-class)）时调用。

就个人而言，至于 python 2.7 代码，我将继续使用`BaseClassName.__init__(self, args)`，直到我真正获得使用`super()`.

* * *

## 回答 #6

> 赞同：57
> 
> 时间：2009-02-23T00:34:57.840

没有，真的。`super()`查看 MRO 中的下一个类（方法解析顺序，使用 访问`cls.__mro__`）来调用方法。只需调用 base`__init__`即可调用 base `__init__`。碰巧的是，MRO 只有一个项目——基础。所以你真的在做同样的事情，但是以一种更好的方式`super()`（特别是如果你稍后进入多重继承）。

* * *

## 回答 #7

> 赞同：37
> 
> 时间：2015-09-21T06:41:03.070

主要区别在于`ChildA.__init__`它将无条件地调用`Base.__init__`，而`ChildB.__init__`将调用**恰好是****祖先****行中的祖先的**`__init__`任何类 （这可能与您的期望不同）。**`ChildB``self`**

如果添加一个`ClassC`使用多重继承的：

```
class Mixin(Base):
  def __init__(self):
    print "Mixin stuff"
    super(Mixin, self).__init__()

class ChildC(ChildB, Mixin):  # Mixin is now between ChildB and Base
  pass

ChildC()
help(ChildC) # shows that the Method Resolution Order is ChildC->ChildB->Mixin->Base 
```

then**`Base`不再是`ChildB`**for`ChildC`实例的父级。现在`super(ChildB, self)`将指向`Mixin`if`self`是一个`ChildC`实例。

`Mixin`您已在`ChildB`和之间插入`Base`。你可以利用它`super()`

因此，如果您将类设计为可以在协作多重继承场景中使用，那么您使用这些类`super`是因为您并不真正知道谁将成为运行时的祖先。

超级考虑的[超级帖子](https://rhettinger.wordpress.com/2011/05/26/super-considered-super/)和[pycon 2015 随附的视频](https://youtu.be/EiOglTERPEo)很好地解释了这一点。

# c# - 在 C# 中添加矩阵？

> ID：576175
> 
> 赞同：2
> 
> 时间：2009-02-23T00:33:38.827
> 
> 标签：c#, arrays, matrix

我正在尝试使用一些简单的 for 循环在 C# 中将两个矩阵相加。我将结果存储在数据网格视图中。但是，最后一个单元格似乎没有添加。我一直在看这段代码一段时间，似乎无法弄清楚。我做错什么了吗？

```
 // Adds two matrices together using arrays.
    private void menuItemAdd_Click(object sender, EventArgs e)
    {
        // Create two 2-D arrays
        int[,] matrixOne = new int[dgvMatrixOne.RowCount, dgvMatrixOne.ColumnCount];
        int[,] matrixTwo = new int[dgvMatrixTwo.RowCount, dgvMatrixTwo.ColumnCount];

        // The rows of the total matrix match the rows of the first matrix.
        dgvMatrixTotal.RowCount = dgvMatrixOne.RowCount;

        // The columns of the total matrix match the columns of the first matrix.
        dgvMatrixTotal.ColumnCount = dgvMatrixOne.ColumnCount;

        // Fill matrix one with the data in the data grid matrix one.
        for (int i = 0; i < dgvMatrixOne.RowCount; i++)
        {
            for (int j = 0; j < dgvMatrixOne.ColumnCount; j++)
            {
                matrixOne[i, j] = Convert.ToInt32(dgvMatrixOne[i, j].Value);
            }
        }

        // Fill matrix two with the data in the data grid matrix two.
        for (int i = 0; i < dgvMatrixTwo.RowCount; i++)
        {
            for (int j = 0; j < dgvMatrixTwo.ColumnCount; j++)
            {
                matrixTwo[i, j] = Convert.ToInt32(dgvMatrixTwo[i, j].Value);
            }
        }

        // Set the total data grid to matrix one + matrix two.
        for (int i = 0; i < dgvMatrixOne.RowCount; i++)
        {
            for (int j = 0; j < dgvMatrixOne.ColumnCount; j++)
            {
                dgvMatrixTotal[i, j].Value = matrixOne[i, j] + matrixTwo[i, j];
            }
        }
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T00:41:15.237

您确定您的矩阵具有完全相同的大小吗，这两行无论如何都很奇怪，因为您从一个矩阵中获取行数，但从另一个矩阵中获取列数。

```
dgvMatrixTotal.RowCount = dgvMatrixOne.RowCount;
dgvMatrixTotal.ColumnCount = dgvMatrixTwo.ColumnCount; 
```

* * *

我相信您的错误是 MSDN 声明 Item 属性（用于使用 [] 运算符进行类似数组的访问）是：

```
public DataGridViewCell this [
    int columnIndex,
    int rowIndex
] { get; set; } 
```

但是你总是以倒序使用它（行在列之前）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T01:05:08.080

在像 C# 这样的语言中，您无需担心这些东西。有经过试验和测试的类库可以为您做这种事情，重要的是，它们已经过优化，可以利用处理器的 SIMD 指令等。如果语言有运算符重载，您只需要声明您的矩阵作为对象，并将它们与简单的结果相加 = mat_a + mat_b。

# c# - .net 集合，用于快速插入/删除

> ID：576176
> 
> 赞同：15
> 
> 时间：2009-02-23T00:33:53.490
> 
> 标签：c#, .net, collections

我需要维护一个连接的客户名册，这些客户的寿命很短，而且经常上下波动。由于潜在的客户数量，我需要一个支持快速插入/删除的集合。建议？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-23T01:37:05.493

## C5 通用集合库

我在 C# 和 C++ 中找到的最好的实现是这些——对于 C#/CLI：

*   [http://www.itu.dk/research/c5/Release1.1/ITU-TR-2006-76.pdf](http://www.itu.dk/research/c5/Release1.1/ITU-TR-2006-76.pdf)
*   [http://www.itu.dk/research/c5/](http://www.itu.dk/research/c5/)

它经过充分研究，具有可扩展的单元测试，并且自 2 月以来，他们还在 .Net 中实现了通用接口，这使得使用集合变得更加容易。他们在[Channel9](http://channel9.msdn.com/shows/Going+Deep/Peter-Sestoft-C5-Generic-Collection-Library-for-C-and-CLI/)上亮相，并且对这些系列进行了广泛的性能测试。

如果您无论如何都在使用数据结构，那么这些研究人员在他们的库中有一个[红黑树](http://en.wikipedia.org/wiki/Red-black_tree)实现，类似于您启动 Lütz 反射器并查看 System.Data 的内部结构：p。插入复杂度：O(log(n))。

## 无锁 C++ 集合

然后，如果您可以[允许一些 C++ 互操作](http://blog.rednael.com/2008/08/29/MarshallingUsingNativeDLLsInNET.aspx)，并且您绝对需要速度并且希望尽可能少的开销，那么来自 Dmitriy V'jukov 的这些无锁 ADT 可能是您在这个世界上可以获得的最好的，优于英特尔的并发库的 ADT。

*   [http://groups.google.com/group/lock-free](http://groups.google.com/group/lock-free)

我已经阅读了一些代码，这确实是一个精通这些东西如何组合在一起的人的素质。VC++ 可以进行本机 C++ 互操作而没有烦人的边界。[http://www.swig.org/](http://groups.google.com/group/lock-free)可以帮助您包装 C++ 接口以在 .Net 中使用，或者您可以通过 P/Invoke 自己完成。

## 微软的看法

他们编写了教程，[这个教程在 C# 中实现了一个相当粗糙的跳过列表](http://msdn.microsoft.com/en-us/library/ms379573.aspx)，并讨论了其他类型的数据结构。（在 CodeProject 有一个更好的[SkipList](http://www.codeproject.com/KB/recipes/skiplist1.aspx)，它非常精巧并以良好的方式实现接口。）它们还有一些与 .Net 捆绑在一起的数据结构，即[HashTable/Dictionary<,>](http://msdn.microsoft.com/en-us/library/4yh14awz.aspx)和[HashSet](http://msdn.microsoft.com/en-us/library/bb397727.aspx)。当然还有“ResizeArray”/List 类型以及堆栈和队列，但它们在搜索时都是“线性的”。

## 谷歌的性能工具

如果您希望加快内存分配所需的时间，您可以使用 google 的 perf-tools。它们可在 google 代码中找到，它们包含一个[非常有趣的多线程 malloc 实现 (TCMalloc)](http://goog-perftools.sourceforge.net/doc/tcmalloc.html)，它显示出比普通 malloc 更一致的时序。您可以将它与上面的无锁结构一起使用，以真正让性能变得疯狂。

## 通过记忆提高响应时间

您还可以在函数上使用 memoization 通过缓存来提高性能，如果您使用例如[F#](https://rads.stackoverflow.com/amzn/click/com/1590598504)会很有趣。F# 还允许 C++ 互操作，所以你可以在那里。

## 行）

[也有可能使用对bloom-filters](http://en.wikipedia.org/wiki/Bloom_filter)进行的研究自己做一些事情，这允许 O(k) 查找复杂性，其中 k 是一个常数，取决于您已实现的哈希函数的数量。这就是 google 的 BigTable 的实现方式。这些过滤器将为您提供元素，如果它在集合中，或者可能具有非常低的可能性的元素不是您正在寻找的元素（参见维基百科上的图表 - 它接近 P(wrong_key) -> 0.01 作为大小大约有 10000 个元素，但您可以通过实现进一步的哈希函数/减少集合来解决这个问题。

我没有搜索过 .Net 的实现，但由于哈希计算是独立的，您可以使用[MS 的性能团队的 Tasks 实现来加快速度。](http://blogs.msdn.com/pfxteam/archive/2008/06/02/8567093.aspx)

## “我的”采取——随机化以达到平均 O(log n)

碰巧我刚刚做了一个涉及数据结构的课程。在本例中，我们使用了 C++，但它很容易转换为 C#。我们构建了三种不同的数据结构；布隆过滤器、跳过列表和[随机二叉搜索树](http://gcu.googlecode.com/files/09BinarySearchTrees.pdf)。

见最后一段之后的代码和分析。

## 基于硬件的“集合”

最后，为了让我的回答“完整”，如果你真的需要速度，你可以使用[Routing-tables](http://en.wikipedia.org/wiki/Forwarding_information_base)或[Content-addressable memory 之](http://en.wikipedia.org/wiki/Content_addressable_memory)类的东西。这允许您在原则上非常快速地 O(1) 获得数据的“哈希”到值查找。

## 随机二叉搜索树/布隆过滤器 C++ 代码

如果您在代码中发现错误，或者只是关于我如何做得更好（或更好地使用模板）的指针，我将非常感谢您的反馈。请注意，布隆过滤器与现实生活中的不同。通常你不必能够从中删除，然后它比我为允许测试*删除*所做的黑客攻击更节省空间。

**数据结构.h**

```
#ifndef DATASTRUCTURE_H_
#define DATASTRUCTURE_H_

class DataStructure
{
public:
    DataStructure() {countAdd=0; countDelete=0;countFind=0;}
    virtual ~DataStructure() {}

    void resetCountAdd() {countAdd=0;}
    void resetCountFind() {countFind=0;}
    void resetCountDelete() {countDelete=0;}

    unsigned int getCountAdd(){return countAdd;}
    unsigned int getCountDelete(){return countDelete;}
    unsigned int getCountFind(){return countFind;}

protected:
    unsigned int countAdd;
    unsigned int countDelete;
    unsigned int countFind;
};

#endif /*DATASTRUCTURE_H_*/ 
```

**密钥.h**

```
#ifndef KEY_H_
#define KEY_H_

#include <string>
using namespace std;

const int keyLength = 128;

class Key : public string
{
public:
    Key():string(keyLength, ' ') {}
    Key(const char in[]): string(in){}
    Key(const string& in): string(in){}

    bool operator<(const string& other);
    bool operator>(const string& other);
    bool operator==(const string& other);

    virtual ~Key() {}
};

#endif /*KEY_H_*/ 
```

**密钥.cpp**

```
#include "Key.h"

bool Key::operator<(const string& other)
{
    return compare(other) < 0;
};

bool Key::operator>(const string& other)
{
    return compare(other) > 0;
};

bool Key::operator==(const string& other)
{
    return compare(other) == 0;
} 
```

**布隆过滤器.h**

```
#ifndef BLOOMFILTER_H_
#define BLOOMFILTER_H_

#include <iostream>
#include <assert.h>
#include <vector>
#include <math.h>
#include "Key.h"
#include "DataStructure.h"

#define LONG_BIT 32
#define bitmask(val) (unsigned long)(1 << (LONG_BIT - (val % LONG_BIT) - 1))

// TODO: Implement RW-locking on the reads/writes to the bitmap.

class BloomFilter : public DataStructure
{
public:
    BloomFilter(){}
    BloomFilter(unsigned long length){init(length);}
    virtual ~BloomFilter(){}

    void init(unsigned long length);
    void dump();

    void add(const Key& key);
    void del(const Key& key);

    /**
     * Returns true if the key IS BELIEVED to exist, false if it absolutely doesn't.
     */
    bool testExist(const Key& key, bool v = false);

private:
    unsigned long hash1(const Key& key);
    unsigned long hash2(const Key& key);
    bool exist(const Key& key);
    void getHashAndIndicies(unsigned long& h1, unsigned long& h2, int& i1, int& i2, const Key& key);
    void getCountIndicies(const int i1, const unsigned long h1,
        const int i2, const unsigned long h2, int& i1_c, int& i2_c);

    vector<unsigned long> m_tickBook;
    vector<unsigned int> m_useCounts;
    unsigned long m_length; // number of bits in the bloom filter
    unsigned long m_pockets; //the number of pockets

    static const unsigned long m_pocketSize; //bits in each pocket
};

#endif /*BLOOMFILTER_H_*/ 
```

**布隆过滤器.cpp**

```
#include "BloomFilter.h"

const unsigned long BloomFilter::m_pocketSize = LONG_BIT;

void BloomFilter::init(unsigned long length)
{
    //m_length = length;
    m_length = (unsigned long)((2.0*length)/log(2))+1;
    m_pockets = (unsigned long)(ceil(double(m_length)/m_pocketSize));
    m_tickBook.resize(m_pockets);

    // my own (allocate nr bits possible to store in the other vector)
    m_useCounts.resize(m_pockets * m_pocketSize);

    unsigned long i; for(i=0; i< m_pockets; i++) m_tickBook[i] = 0;
    for (i = 0; i < m_useCounts.size(); i++) m_useCounts[i] = 0; // my own
}

unsigned long BloomFilter::hash1(const Key& key)
{
    unsigned long hash = 5381;
    unsigned int i=0; for (i=0; i< key.length(); i++){
        hash = ((hash << 5) + hash) + key.c_str()[i]; /* hash * 33 + c */
    }

    double d_hash = (double) hash;

    d_hash *= (0.5*(sqrt(5)-1));
    d_hash -= floor(d_hash);
    d_hash *= (double)m_length;

    return (unsigned long)floor(d_hash);
}

unsigned long BloomFilter::hash2(const Key& key)
{
    unsigned long hash = 0;
    unsigned int i=0; for (i=0; i< key.length(); i++){
        hash = key.c_str()[i] + (hash << 6) + (hash << 16) - hash;
    }
    double d_hash = (double) hash;

    d_hash *= (0.5*(sqrt(5)-1));
    d_hash -= floor(d_hash);
    d_hash *= (double)m_length;

    return (unsigned long)floor(d_hash);
}

bool BloomFilter::testExist(const Key& key, bool v){
    if(exist(key)) {
        if(v) cout<<"Key "<< key<<" is in the set"<<endl;
        return true;
    }else {
        if(v) cout<<"Key "<< key<<" is not in the set"<<endl;
        return false;
    }
}

void BloomFilter::dump()
{
    cout<<m_pockets<<" Pockets: ";

    // I changed u to %p because I wanted it printed in hex.
    unsigned long i; for(i=0; i< m_pockets; i++) printf("%p ", (void*)m_tickBook[i]);
    cout<<endl;
}

void BloomFilter::add(const Key& key)
{
    unsigned long h1, h2;
    int i1, i2;
    int i1_c, i2_c;

    // tested!

    getHashAndIndicies(h1, h2, i1, i2, key);
    getCountIndicies(i1, h1, i2, h2, i1_c, i2_c);

    m_tickBook[i1] = m_tickBook[i1] | bitmask(h1);
    m_tickBook[i2] = m_tickBook[i2] | bitmask(h2);

    m_useCounts[i1_c] = m_useCounts[i1_c] + 1;
    m_useCounts[i2_c] = m_useCounts[i2_c] + 1;

    countAdd++;
}

void BloomFilter::del(const Key& key)
{
    unsigned long h1, h2;
    int i1, i2;
    int i1_c, i2_c;

    if (!exist(key)) throw "You can't delete keys which are not in the bloom filter!";

    // First we need the indicies into m_tickBook and the
    // hashes.
    getHashAndIndicies(h1, h2, i1, i2, key);

    // The index of the counter is the index into the bitvector
    // times the number of bits per vector item plus the offset into
    // that same vector item.
    getCountIndicies(i1, h1, i2, h2, i1_c, i2_c);

    // We need to update the value in the bitvector in order to
    // delete the key.
    m_useCounts[i1_c] = (m_useCounts[i1_c] == 1 ? 0 : m_useCounts[i1_c] - 1);
    m_useCounts[i2_c] = (m_useCounts[i2_c] == 1 ? 0 : m_useCounts[i2_c] - 1);

    // Now, if we depleted the count for a specific bit, then set it to
    // zero, by anding the complete unsigned long with the notted bitmask
    // of the hash value
    if (m_useCounts[i1_c] == 0)
        m_tickBook[i1] = m_tickBook[i1] & ~(bitmask(h1));
    if (m_useCounts[i2_c] == 0)
        m_tickBook[i2] = m_tickBook[i2] & ~(bitmask(h2));

    countDelete++;
}

bool BloomFilter::exist(const Key& key)
{
    unsigned long h1, h2;
    int i1, i2;

    countFind++;

    getHashAndIndicies(h1, h2, i1, i2, key);

    return  ((m_tickBook[i1] & bitmask(h1)) > 0) &&
            ((m_tickBook[i2] & bitmask(h2)) > 0);
}

/*
 * Gets the values of the indicies for two hashes and places them in
 * the passed parameters. The index is into m_tickBook.
 */
void BloomFilter::getHashAndIndicies(unsigned long& h1, unsigned long& h2, int& i1,
    int& i2, const Key& key)
{
    h1 = hash1(key);
    h2 = hash2(key);
    i1 = (int) h1/m_pocketSize;
    i2 = (int) h2/m_pocketSize;
}

/*
 * Gets the values of the indicies into the count vector, which keeps
 * track of how many times a specific bit-position has been used.
 */
void BloomFilter::getCountIndicies(const int i1, const unsigned long h1,
    const int i2, const unsigned long h2, int& i1_c, int& i2_c)
{
    i1_c = i1*m_pocketSize + h1%m_pocketSize;
    i2_c = i2*m_pocketSize + h2%m_pocketSize;
} 
```

** RBST.h **

```
#ifndef RBST_H_
#define RBST_H_

#include <iostream>
#include <assert.h>
#include <vector>
#include <math.h>
#include "Key.h"
#include "DataStructure.h"

#define BUG(str) printf("%s:%d FAILED SIZE INVARIANT: %s\n", __FILE__, __LINE__, str);

using namespace std;

class RBSTNode;
class RBSTNode: public Key
{
public:
    RBSTNode(const Key& key):Key(key)
    {
        m_left =NULL;
        m_right = NULL;
        m_size = 1U; // the size of one node is 1.
    }
    virtual ~RBSTNode(){}

    string setKey(const Key& key){return Key(key);}

    RBSTNode* left(){return m_left; }
    RBSTNode* right(){return m_right;}

    RBSTNode* setLeft(RBSTNode* left) { m_left = left; return this; }
    RBSTNode* setRight(RBSTNode* right) { m_right =right; return this; }

#ifdef DEBUG
    ostream& print(ostream& out)
    {
        out << "Key(" << *this << ", m_size: " << m_size << ")";
        return out;
    }
#endif

    unsigned int size() { return m_size; }

    void setSize(unsigned int val)
    {
#ifdef DEBUG
        this->print(cout);
        cout << "::setSize(" << val << ") called." << endl;
#endif

        if (val == 0) throw "Cannot set the size below 1, then just delete this node.";
        m_size = val;
    }

    void incSize() {
#ifdef DEBUG
        this->print(cout);
        cout << "::incSize() called" << endl;
#endif

        m_size++;
    }

    void decrSize()
    {
#ifdef DEBUG
        this->print(cout);
        cout << "::decrSize() called" << endl;
#endif

        if (m_size == 1) throw "Cannot decrement size below 1, then just delete this node.";
        m_size--;
    }

#ifdef DEBUG
    unsigned int size(RBSTNode* x);
#endif

private:
    RBSTNode(){}
    RBSTNode* m_left;
    RBSTNode* m_right;
    unsigned int m_size;
};

class RBST : public DataStructure
{
public:
    RBST() {
        m_size = 0;
        m_head = NULL;
        srand(time(0));
    };

    virtual ~RBST() {};

    /**
     * Tries to add key into the tree and will return
     *      true  for a new item added
     *      false if the key already is in the tree.
     *
     * Will also have the side-effect of printing to the console if v=true.
     */
    bool add(const Key& key, bool v=false);

    /**
     * Same semantics as other add function, but takes a string,
     * but diff name, because that'll cause an ambiguity because of inheritance.
     */
    bool addString(const string& key);

    /**
     * Deletes a key from the tree if that key is in the tree.
     * Will return
     *      true  for success and
     *      false for failure.
     *
     * Will also have the side-effect of printing to the console if v=true.
     */
    bool del(const Key& key, bool v=false);

    /**
     * Tries to find the key in the tree and will return
     *      true if the key is in the tree and
     *      false if the key is not.
     *
     * Will also have the side-effect of printing to the console if v=true.
     */
    bool find(const Key& key, bool v = false);

    unsigned int count() { return m_size; }

#ifdef DEBUG
    int dump(char sep = ' ');
    int dump(RBSTNode* target, char sep);
    unsigned int size(RBSTNode* x);
#endif

private:
    RBSTNode* randomAdd(RBSTNode* target, const Key& key);
    RBSTNode* addRoot(RBSTNode* target, const Key& key);
    RBSTNode* rightRotate(RBSTNode* target);
    RBSTNode* leftRotate(RBSTNode* target);

    RBSTNode* del(RBSTNode* target, const Key& key);
    RBSTNode* join(RBSTNode* left, RBSTNode* right);

    RBSTNode* find(RBSTNode* target, const Key& key);

    RBSTNode* m_head;
    unsigned int m_size;
};

#endif /*RBST_H_*/ 
```

** RBST.cpp **

```
#include "RBST.h"

bool RBST::add(const Key& key, bool v){
    unsigned int oldSize = m_size;
    m_head = randomAdd(m_head, key);
    if (m_size > oldSize){
        if(v) cout<<"Node "<<key<< " is added into the tree."<<endl;
        return true;
    }else {
        if(v) cout<<"Node "<<key<< " is already in the tree."<<endl;
        return false;
    }
    if(v) cout<<endl;
};

bool RBST::addString(const string& key) {
    return add(Key(key), false);
}

bool RBST::del(const Key& key, bool v){
    unsigned oldSize= m_size;
    m_head = del(m_head, key);
    if (m_size < oldSize) {
        if(v) cout<<"Node "<<key<< " is deleted from the tree."<<endl;
        return true;
    }
    else {
        if(v) cout<< "Node "<<key<< " is not in the tree."<<endl;
        return false;
    }
};

bool RBST::find(const Key& key, bool v){
    RBSTNode* ret = find(m_head, key);
    if (ret == NULL){
        if(v) cout<< "Node "<<key<< " is not in the tree."<<endl;
        return false;
    }else {
        if(v) cout<<"Node "<<key<< " is in the tree."<<endl;
        return true;
    }
};

#ifdef DEBUG
int RBST::dump(char sep){
    int ret = dump(m_head, sep);
    cout<<"SIZE: " <<ret<<endl;
    return ret;
};

int RBST::dump(RBSTNode* target, char sep){
    if (target == NULL) return 0;
    int ret = dump(target->left(), sep);
    cout<< *target<<sep;
    ret ++;
    ret += dump(target->right(), sep);
    return ret;
};
#endif

/**
 * Rotates the tree around target, so that target's left
 * is the new root of the tree/subtree and updates the subtree sizes.
 *
 *(target)  b               (l) a
 *         / \      right      / \
 *        a   ?     ---->     ?   b
 *       / \                     / \
 *      ?   x                   x   ?
 *
 */
RBSTNode* RBST::rightRotate(RBSTNode* target) // private
{
    if (target == NULL) throw "Invariant failure, target is null"; // Note: may be removed once tested.
    if (target->left() == NULL) throw "You cannot rotate right around a target whose left node is NULL!";

#ifdef DEBUG
    cout    <<"Right-rotating b-node ";
    target->print(cout);
    cout    << " for a-node ";
    target->left()->print(cout);
    cout    << "." << endl;
#endif

    RBSTNode* l = target->left();
    int as0 = l->size();

    // re-order the sizes
    l->setSize( l->size() + (target->right() == NULL ? 0 : target->right()->size()) + 1); // a.size += b.right.size + 1; where b.right may be null.
    target->setSize( target->size() -as0 + (l->right() == NULL ? 0 : l->right()->size()) ); // b.size += -a_0_size + x.size where x may be null.

    // swap b's left (for a)
    target->setLeft(l->right());

    // and a's right (for b's left)
    l->setRight(target);

#ifdef DEBUG
    cout    << "A-node size: " << l->size() << ", b-node size: " << target->size() << "." << endl;
#endif

    // return the new root, a.
    return l;
};

/**
 * Like rightRotate, but the other way. See docs for rightRotate(RBSTNode*)
 */
RBSTNode* RBST::leftRotate(RBSTNode* target)
{
    if (target == NULL) throw "Invariant failure, target is null";
    if (target->right() == NULL) throw "You cannot rotate left around a target whose right node is NULL!";

#ifdef DEBUG
    cout    <<"Left-rotating a-node ";
    target->print(cout);
    cout    << " for b-node ";
    target->right()->print(cout);
    cout    << "." << endl;
#endif

    RBSTNode* r = target->right();
    int bs0 = r->size();

    // re-roder the sizes
    r->setSize(r->size() + (target->left() == NULL ? 0 : target->left()->size()) + 1);
    target->setSize(target->size() -bs0 + (r->left() == NULL ? 0 : r->left()->size()));

    // swap a's right (for b's left)
    target->setRight(r->left());

    // swap b's left (for a)
    r->setLeft(target);

#ifdef DEBUG
    cout    << "Left-rotation done: a-node size: " << target->size() << ", b-node size: " << r->size() << "." << endl;
#endif

    return r;
};

//
/**
 * Adds a key to the tree and returns the new root of the tree.
 * If the key already exists doesn't add anything.
 * Increments m_size if the key didn't already exist and hence was added.
 *
 * This function is not called from public methods, it's a helper function.
 */
RBSTNode* RBST::addRoot(RBSTNode* target, const Key& key)
{
    countAdd++;

    if (target == NULL) return new RBSTNode(key);

#ifdef DEBUG
    cout << "addRoot(";
    cout.flush();
    target->print(cout) << "," << key << ") called." << endl;
#endif

    if (*target < key)
    {
        target->setRight( addRoot(target->right(), key) );
        target->incSize(); // Should I?
        RBSTNode* res = leftRotate(target);
#ifdef DEBUG
        if (target->size() != size(target))
            BUG("in addRoot 1");
#endif
        return res;
    }

    target->setLeft( addRoot(target->left(), key) );
    target->incSize(); // Should I?
    RBSTNode* res = rightRotate(target);
#ifdef DEBUG
    if (target->size() != size(target))
        BUG("in addRoot 2");
#endif
    return res;
};

/**
 * This function is called from the public add(key) function,
 * and returns the new root node.
 */
RBSTNode* RBST::randomAdd(RBSTNode* target, const Key& key)
{
    countAdd++;

    if (target == NULL)
    {
        m_size++;
        return new RBSTNode(key);
    }

#ifdef DEBUG
    cout << "randomAdd(";
    target->print(cout) << ", \"" << key << "\") called." << endl;
#endif

    int r = (rand() % target->size()) + 1;

    // here is where we add the target as root!
    if (r == 1)
    {
        m_size++;   // TODO: Need to lock.
        return addRoot(target, key);
    }

#ifdef DEBUG
    printf("randomAdd recursion part, ");
#endif

    // otherwise, continue recursing!
    if (*target <= key)
    {
#ifdef DEBUG
    printf("target <= key\n");
#endif
        target->setRight( randomAdd(target->right(), key) );
        target->incSize(); // TODO: Need to lock.
#ifdef DEBUG
        if (target->right()->size() != size(target->right()))
            BUG("in randomAdd 1");
#endif
    }
    else
    {
#ifdef DEBUG
    printf("target > key\n");
#endif
        target->setLeft( randomAdd(target->left(), key) );
        target->incSize(); // TODO: Need to lock.
#ifdef DEBUG
        if (target->left()->size() != size(target->left()))
            BUG("in randomAdd 2");
#endif
    }

#ifdef DEBUG
    printf("randomAdd return part\n");
#endif

    m_size++;       // TODO: Need to lock.
    return target;
};

/////////////////////////////////////////////////////////////
/////////////////////  DEL FUNCTIONS ////////////////////////
/////////////////////////////////////////////////////////////

/**
 * Deletes a node with the passed key.
 * Returns the root node.
 * Decrements m_size if something was deleted.
 */
RBSTNode* RBST::del(RBSTNode* target, const Key& key)
{
    countDelete++;

    if (target == NULL) return NULL;

#ifdef DEBUG
    cout << "del(";
    target->print(cout) << ", \"" << key << "\") called." << endl;
#endif

    RBSTNode* ret = NULL;

    // found the node to delete
    if (*target == key)
    {
        ret = join(target->left(), target->right());

        m_size--;
        delete target;

        return ret; // return the newly built joined subtree!
    }

    // store a temporary size before recursive deletion.
    unsigned int size = m_size;

    if (*target < key)  target->setRight( del(target->right(), key) );
    else                target->setLeft( del(target->left(), key) );

    // if the previous recursion changed the size, we need to decrement the size of this target too.
    if (m_size < size) target->decrSize();

#ifdef DEBUG
    if (RBST::size(target) != target->size())
        BUG("in del");
#endif

    return target;
};

/**
 * Joins the two subtrees represented by left and right
 * by randomly choosing which to make the root, weighted on the
 * size of the sub-tree.
 */
RBSTNode* RBST::join(RBSTNode* left, RBSTNode* right)
{
    if (left == NULL) return right;
    if (right == NULL) return left;

#ifdef DEBUG
    cout << "join(";
    left->print(cout);
    cout << ",";
    right->print(cout) << ") called." << endl;
#endif

    // Find the chance that we use the left tree, based on its size over the total tree size.
    // 3 s.d. randomness :-p e.g. 60.3% chance.
    bool useLeft = ((rand()%1000) < (signed)((float)left->size()/(float)(left->size() + right->size()) * 1000.0));

    RBSTNode* subtree = NULL;

    if (useLeft)
    {
        subtree = join(left->right(), right);

        left->setRight(subtree)
            ->setSize((left->left() == NULL ? 0 : left->left()->size())
                        + subtree->size() + 1 );

#ifdef DEBUG
        if (size(left) != left->size())
            BUG("in join 1");
#endif

        return left;
    }

    subtree = join(right->left(), left);

    right->setLeft(subtree)
         ->setSize((right->right() == NULL ? 0 : right->right()->size())
                    + subtree->size() + 1);

#ifdef DEBUG
    if (size(right) != right->size())
        BUG("in join 2");
#endif

    return right;
};

/////////////////////////////////////////////////////////////
/////////////////////  FIND FUNCTIONS ///////////////////////
/////////////////////////////////////////////////////////////

/**
 * Tries to find the key in the tree starting
 * search from target.
 *
 * Returns NULL if it was not found.
 */
RBSTNode* RBST::find(RBSTNode* target, const Key& key)
{
    countFind++; // Could use private method only counting the first call.
    if (target == NULL) return NULL; // not found.
    if (*target == key) return target; // found (does string override ==?)
    if (*target < key) return find(target->right(), key); // search for gt to the right.
    return find(target->left(), key); // search for lt to the left.
};

#ifdef DEBUG

unsigned int RBST::size(RBSTNode* x)
{
    if (x == NULL) return 0;
    return 1 + size(x->left()) + size(x->right());
}

#endif 
```

我将再次保存 SkipList ，因为已经可以从链接中找到 SkipList 的良好实现，而且我的版本并没有太大的不同。

从测试文件生成的图表如下：

**图表显示为 BloomFilter、RBST 和 SkipList 添加新项目所用的时间。** [图 http://haf.se/content/dl/addtimer.png](http://haf.se/content/dl/addtimer.png)

**图表显示为 BloomFilter、RBST 和 SkipList 查找项目所需的时间** [图表 http://haf.se/content/dl/findtimer.png](http://haf.se/content/dl/findtimer.png)

**图表显示删除 BloomFilter、RBST 和 SkipList** [图表所需的时间 http://haf.se/content/dl/deltimer.png](http://haf.se/content/dl/deltimer.png)

如您所见，随机二叉搜索树比 SkipList 好得多。布隆过滤器不辜负它的 O(k)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-23T00:37:21.440

为此考虑基于散列的集合，例如[`HashSet`](http://msdn.microsoft.com/en-us/library/bb397727.aspx)、[`Dictionary`](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)、[`HashTable`](http://msdn.microsoft.com/en-us/library/system.collections.hashtable.aspx)，它们为添加和删除元素提供恒定的时间性能。

来自 .NET Framework 开发人员指南的更多信息：

*   [哈希表和字典集合类型](http://msdn.microsoft.com/en-us/library/4yh14awz.aspx)
*   [HashSet 集合类型](http://msdn.microsoft.com/en-us/library/bb397727.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T01:22:39.990

好吧，你需要多少查询呢？链接列表具有快速插入/删除（在任何位置），但不如（例如）字典/排序列表搜索快。或者，每个中都有一个位/值对的直接列表 - 即“仍然具有价值”。只需在附加之前重新使用*逻辑上*的空单元格。删除只是清除单元格。

对于引用类型，“null”可以在这里使用。对于值类型，`Nullable<T>`.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-23T00:41:27.250

您可以使用 Hashtable 或强类型 Dictionary<Client>。客户端类可能会覆盖 GetHashCode 以提供更快的哈希码生成，或者如果使用 Hashtable，您可以选择使用 IHashCodeProvider。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T00:56:38.477

您需要如何找到客户？元组/字典是否必要？您很有可能在 Jeffrey Richter 的[Power Collections](http://www.codeplex.com/PowerCollections)库中找到解决问题的方法，该库包含您能想到的列表、树和大多数数据结构。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T01:37:56.863

Channel9 对 Peter Sestoft 的采访给我留下了深刻的印象：

[channel9.msdn.com/shows/Going+Deep/Peter-Setoft-C5-Generic-Collection-Library-for-C-and-CLI/](http://channel9.msdn.com/shows/Going+Deep/Peter-Sestoft-C5-Generic-Collection-Library-for-C-and-CLI/)

他是哥本哈根 IT 大学的教授，他帮助创建了 C5 通用集合库：

[www.itu.dk/research/c5/](http://www.itu.dk/research/c5/)

这可能是矫枉过正，或者它可能只是你正在寻找的快速收集......

h,

-麦克风

# .net - 记录最佳实践

> ID：576185
> 
> 赞同：323
> 
> 时间：2009-02-23T00:38:58.113
> 
> 标签：.net, asp.net, logging, trace

我想了解人们如何处理真实应用程序中的跟踪和日志记录。以下是一些可能有助于解释您的答案的问题。

**构架**

你使用什么框架？

*   log4net
*   System.Diagnostics.Trace
*   System.Diagnostics.TraceSource
*   记录应用程序块
*   其他？

如果使用跟踪，是否使用 Trace.Correlation.StartLogicalOperation？

您是手动编写此代码，还是使用某种形式的面向方面编程来完成它？愿意分享代码片段吗？

您是否对跟踪源提供任何形式的粒度？例如，WPF TraceSources 允许您在不同级别配置它们：

*   System.Windows -*所有 WPF 的设置*
*   System.Windows.Animation -*专门为动画覆盖。*

**听众**

您使用什么日志输出？

*   文本文件
*   XML 文件
*   事件簿
*   其他？

如果使用文件，您使用滚动日志还是仅使用单个文件？您如何使日志可供人们使用？

**查看**

您使用什么工具来查看日志？

*   记事本
*   尾巴
*   事件查看器
*   系统中心运营经理/微软运营经理
*   WCF 服务跟踪查看器
*   其他？

如果您正在构建 ASP.NET 解决方案，您是否还使用 ASP.NET 健康监控？您是否在运行状况监视器事件中包含跟踪输出？Trace.axd 呢？

自定义性能计数器呢？

* * *

## 回答 #1

> 赞同：232
> 
> 时间：2009-06-02T14:40:23.197

* * *

**更新：**对于 System.Diagnostics 的扩展，提供一些您可能需要的缺少的侦听器，请参阅 CodePlex 上的 Essential.Diagnostics ( [http://essentialdiagnostics.codeplex.com/](http://essentialdiagnostics.codeplex.com/) )

* * *

***构架***

## 问：你们使用什么框架？

**答：System.Diagnostics.TraceSource，内置于 .NET 2.0。**

它为应用程序提供了强大、灵活、高性能的日志记录，但是许多开发人员并没有意识到它的功能并且没有充分利用它们。

在某些领域，附加功能很有用，或者有时功能存在但没有很好的文档记录，但这并不意味着整个日志框架（设计为可扩展的）应该像一些流行的替代方案一样被丢弃并完全替换（NLog、log4net、Common.Logging 甚至 EntLib 日志记录）。

与其改变向应用程序添加日志语句的方式并重新发明轮子，不如在您需要的几个地方扩展 System.Diagnostics 框架。

在我看来，其他框架，甚至是 EntLib，都只是患有 Not Invented Here Syndrome，我认为他们浪费了时间重新发明在 System.Diagnostics 中已经很好工作的基础知识（例如您如何编写日志语句），而不是填补现有的少数空白。简而言之，不要使用它们——它们不是必需的。

**你可能不知道的功能：**

*   使用采用格式字符串和参数的 TraceEvent 重载可以帮助提高性能，因为参数作为单独的引用保存，直到 Filter.ShouldTrace() 成功。这意味着在系统确认消息之前不会对参数值进行昂贵的 ToString() 调用。
*   Trace.CorrelationManager 允许您关联有关相同逻辑操作的日志语句（见下文）。
*   VisualBasic.Logging.FileLogTraceListener 适合写入日志文件并支持文件轮换。尽管在 VisualBasic 命名空间中，它也可以很容易地在 C#（或其他语言）项目中使用，只需包含 DLL。
*   使用 EventLogTraceListener 时，如果您使用多个参数和空或 null 格式字符串调用 TraceEvent，则如果您使用本地化消息资源，则参数将直接传递给 EventLog.WriteEntry()。
*   服务跟踪查看器工具（来自 WCF）对于查看活动相关日志文件的图表非常有用（即使您没有使用 WCF）。这确实可以帮助调试涉及多个线程/活动的复杂问题。
*   通过清除所有侦听器（或删除默认值）来避免开销；否则 Default 会将所有内容传递给跟踪系统（并产生所有 ToString() 开销）。

**您可能希望扩展的区域（如果需要）：**

*   数据库跟踪侦听器
*   彩色控制台跟踪侦听器
*   MSMQ / 电子邮件 / WMI 跟踪侦听器（如果需要）
*   实现 FileSystemWatcher 以调用 Trace.Refresh 以进行动态配置更改

**其他建议：**

使用结构化事件ID，并保留一个参考列表（例如，将它们记录在一个枚举中）。

为系统中的每个（重要）事件拥有唯一的事件 ID 对于关联和查找特定问题非常有用。很容易追溯到记录/使用事件 ID 的特定代码，并且可以很容易地为常见错误提供指导，例如错误 5178 表示您的数据库连接字符串错误等。

事件 id 应该遵循某种结构（类似于电子邮件和 HTTP 中使用的回复代码理论），这允许您在不知道具体代码的情况下按类别对待它们。

例如，第一个数字可以详细说明一般类：1xxx 可用于“开始”操作，2xxx 用于正常行为，3xxx 用于活动跟踪，4xxx 用于警告，5xxx 用于错误，8xxx 用于“停止”操作，9xxx 用于致命错误，等等

第二个数字可以详细说明区域，例如21xx表示数据库信息（41xx表示数据库警告，51xx表示数据库错误），22xx表示计算模式（42xx表示计算警告等），23xx表示另一个模块等。

分配的结构化事件 ID 还允许您在过滤器中使用它们。

## 问：如果使用跟踪，是否使用 Trace.Correlation.StartLogicalOperation？

**答： Trace.CorrelationManager 对于在任何类型的多线程环境中关联日志语句非常有用（这在当今几乎是任何事情）。**

您至少需要为每个逻辑操作设置一次 ActivityId 才能关联。

然后可以将 Start/Stop 和 LogicalOperationStack 用于简单的基于堆栈的上下文。对于更复杂的上下文（例如异步操作），使用 TraceTransfer 到新的 ActivityId（在更改它之前）允许关联。

服务跟踪查看器工具可用于查看活动图（即使您不使用 WCF）。

## 问：您是手动编写此代码，还是使用某种形式的面向方面编程来编写？愿意分享代码片段吗？

**答：您可能想要创建一个范围类，例如 LogicalOperationScope，它 (a) 在创建时设置上下文，并且 (b) 在释放时重置上下文。**

这允许您编写如下代码来自动包装操作：

```
 using( LogicalOperationScope operation = new LogicalOperationScope("Operation") )
  {
    // .. do work here
  } 
```

在创建范围时，如果需要，可以首先设置 ActivityId，调用 StartLogicalOperation，然后记录 TraceEventType.Start 消息。在 Dispose 上，它可以记录停止消息，然后调用 StopLogicalOperation。

## 问：你们是否提供任何形式的跟踪源粒度？例如，WPF TraceSources 允许您在不同级别配置它们。

**答：是的，随着系统变得越来越大，多个跟踪源很有用/很重要。**

虽然您可能希望始终记录所有警告及以上消息，或所有信息及以上消息，但对于任何规模合理的系统，活动跟踪（启动、停止等）和详细日志记录的数量会变得过多。

与其只有一个开关可以将其全部打开或关闭，不如能够一次为系统的一个部分打开此信息很有用。

这样，您可以从通常的日志记录（所有警告、错误等）中找到重大问题，然后“放大”您想要的部分并将它们设置为活动跟踪甚至调试级别。

您需要的跟踪源的数量取决于您的应用程序，例如，您可能希望每个程序集或应用程序的每个主要部分都有一个跟踪源。

如果您需要更精细的控制，请添加单独的布尔开关来打开/关闭特定的高容量跟踪，例如原始消息转储。（或者可以使用单独的跟踪源，类似于 WCF/WPF）。

您可能还需要考虑将活动跟踪与一般（其他）日志记录分开的跟踪源，因为它可以更容易地按照您的需要配置过滤器。

请注意，即使使用不同的源，消息仍然可以通过 ActivityId 关联，因此请根据需要使用尽可能多的消息。

* * *

## 听众

**问：您使用什么日志输出？**

这可能取决于您正在编写的应用程序类型以及正在记录的内容。通常不同的东西会出现在不同的地方（即多个输出）。

我通常将输出分为三组：

**(1) 事件 - Windows 事件日志（和跟踪文件）**

例如，如果编写服务器/服务，那么在 Windows 上的最佳实践是使用 Windows 事件日志（您没有要报告的 UI）。

在这种情况下，所有致命、错误、警告和（服务级别）信息事件都应转到 Windows 事件日志。信息级别应保留给这些类型的高级事件，即您想要在事件日志中进入的事件，例如“服务启动”、“服务停止”、“连接到 Xyz”，甚至可能是“计划启动” 、“用户登录”等。

在某些情况下，您可能希望将事件日志写入应用程序的内置部分，而不是通过跟踪系统（即直接写入事件日志条目）。这意味着它不会被意外关闭。（请注意，您仍然希望在跟踪系统中记录相同的事件，以便进行关联）。

相反，Windows GUI 应用程序通常会将这些报告给用户（尽管他们也可能会记录到 Windows 事件日志中）。

事件也可能有相关的性能计数器（例如错误数/秒），协调任何直接写入事件日志、性能计数器、写入跟踪系统并报告给用户以使它们发生在同时。

即，如果用户在特定时间看到错误消息，您应该能够在 Windows 事件日志中找到相同的错误消息，然后在跟踪日志中找到具有相同时间戳的相同事件（以及其他跟踪详细信息）。

**(2) 活动 - 应用程序日志文件或数据库表（和跟踪文件）**

这是系统进行的常规活动，例如提供网页、提交股票市场交易、接受订单、执行计算等。

活动跟踪（开始、停止等）在这里很有用（以正确的粒度）。

此外，使用特定的应用程序日志（有时称为审核日志）也很常见。通常这是一个数据库表或应用程序日志文件，包含结构化数据（即一组字段）。

根据您的应用程序，这里的情况可能会有些模糊。一个很好的例子可能是一个将每个请求写入网络日志的网络服务器；类似的示例可能是消息传递系统或计算系统，其中每个操作都与特定于应用程序的详细信息一起记录。

一个不太好的例子是股票市场交易或销售订单系统。在这些系统中，您可能已经记录了活动，因为它们具有重要的业务价值，但是将它们与其他操作相关联的原则仍然很重要。

除了自定义应用程序日志外，活动通常还具有相关的性能计数器，例如每秒的事务数。

一般来说，您应该协调跨不同系统的活动记录，即在增加性能计数器和记录到跟踪系统的同时写入应用程序日志。如果您同时执行所有操作（或在代码中一个接一个），那么调试问题会更容易（比它们都发生在代码中的不同时间/位置）。

**(3) 调试跟踪 - 文本文件，或者 XML 或数据库。**

这是详细级别和更低级别的信息（例如，用于打开/关闭原始数据转储的自定义布尔开关）。这提供了系统在子活动级别所做的事情的胆量或细节。

这是您希望能够为应用程序的各个部分打开/关闭的级别（因此有多个源）。您不希望这些东西弄乱 Windows 事件日志。有时会使用数据库，但更有可能是在特定时间后清除的滚动日志文件。

此信息与应用程序日志文件之间的一个很大区别在于它是非结构化的。虽然应用程序日志可能包含 To、From、Amount 等字段，但详细调试跟踪可能是程序员输入的任何内容，例如“检查值 X={value}, Y=false”或随机注释/标记，如“完成了，再试一次”。

一项重要的做法是确保您放入应用程序日志文件或 Windows 事件日志的内容也以相同的详细信息（例如时间戳）记录到跟踪系统。这允许您在调查时关联不同的日志。

如果您计划使用特定的日志查看器，因为您有复杂的相关性，例如服务跟踪查看器，那么您需要使用适当的格式，即 XML。否则，一个简单的文本文件通常就足够了——在较低级别的信息基本上是非结构化的，因此您可能会发现数组转储、堆栈转储等。如果您可以关联回更高级别的更多结构化日志，事情应该好好地。

**问：如果使用文件，您是使用滚动日志还是仅使用单个文件？您如何使日志可供人们使用？**

答：对于文件，通常您希望从可管理性的角度滚动日志文件（使用 System.Diagnostics，只需使用 VisualBasic.Logging.FileLogTraceListener）。

可用性再次取决于系统。如果您只是在谈论文件，那么对于服务器/服务，可以在必要时访问滚动文件。（Windows 事件日志或数据库应用程序日志将有自己的访问机制）。

如果您无法轻松访问文件系统，那么对数据库的调试跟踪可能会更容易。[即实现一个数据库 TraceListener]。

我为 Windows GUI 应用程序看到的一个有趣的解决方案是，它在运行时将非常详细的跟踪信息记录到“飞行记录器”中，然后当您将其关闭时，如果它没有问题，它就会简单地删除该文件。

但是，如果它崩溃或遇到问题，则不会删除该文件。如果它发现错误，或者下次运行时它会注意到该文件，然后它可以采取措施，例如压缩它（例如 7zip）并通过电子邮件发送或以其他方式提供。

如今，许多系统都将故障自动报告给中央服务器（在与用户核对之后，例如出于隐私原因）。

* * *

## 查看

**问：您使用什么工具来查看日志？**

答：如果您有多个日志出于不同的原因，那么您将使用多个查看器。

Notepad/vi/Notepad++ 或任何其他文本编辑器是纯文本日志的基础。

如果您有复杂的操作，例如带有传输的活动，那么您显然会使用像服务跟踪查看器这样的专用工具。（但如果你不需要它，那么文本编辑器会更容易）。

由于我通常将高级信息记录到 Windows 事件日志中，因此它提供了一种以结构化方式快速获取概览的方法（查找漂亮的错误/警告图标）。如果日志中没有足够的内容，您只需要开始搜索文本文件，尽管至少日志为您提供了一个起点。（此时，确保您的日志具有协调的整体变得有用）。

通常，Windows 事件日志还使这些重要事件可用于监控工具，如 MOM 或 OpenView。

**其他 -**

如果您登录到数据库，则可以轻松过滤和排序信息（例如，放大特定的活动 ID。（对于文本文件，您可以使用 Grep/PowerShell 或类似工具来过滤您想要的特定 GUID）

MS Excel（或其他电子表格程序）。如果您可以使用正确的分隔符导入结构化或半结构化信息，这对于分析结构化或半结构化信息很有用，以便不同的值进入不同的列。

在调试/测试中运行服务时，为了简单起见，我通常将它托管在控制台应用程序中，我发现彩色控制台记录器很有用（例如，红色表示错误，黄色表示警告等）。您需要实现自定义跟踪侦听器。

请注意，该框架不包含彩色控制台记录器或数据库记录器，因此，现在，如果您需要它们，则需要编写它们（这不是太难）。

让我很恼火的是几个框架（log4net、EntLib 等）浪费时间重新发明轮子并重新实现了基本的日志记录、过滤和日志记录到文本文件、Windows 事件日志和 XML 文件，每个框架都有自己的不同的方式（每个日志语句都不同）；然后，每个人都实现了自己的版本，例如数据库记录器，而其中大部分已经存在，而只需要为 System.Diagnostics 提供更多的跟踪侦听器。谈论重复工作的巨大浪费。

**问：如果您正在构建 ASP.NET 解决方案，您是否还使用 ASP.NET 健康监控？您是否在运行状况监视器事件中包含跟踪输出？Trace.axd 呢？**

这些东西可以根据需要打开/关闭。我发现 Trace.axd 对于调试服务器如何响应某些事情非常有用，但它通常在使用频繁的环境或长期跟踪中没有用处。

**问：自定义性能计数器呢？**

对于专业应用程序，尤其是服务器/服务，我希望看到它完全配备了性能监视器计数器和记录到 Windows 事件日志。这些是 Windows 中的标准工具，应该使用。

您需要确保包含您使用的性能计数器和事件日志的安装程序；这些应该在安装时创建（以管理员身份安装时）。当您的应用程序正常运行时，它不需要具有管理权限（因此无法创建丢失的日志）。

这是练习以非管理员身份进行开发的一个很好的理由（当您需要安装服务等时，有一个单独的管理员帐户）。如果写入事件日志，.NET 将在您第一次写入时自动创建丢失的日志；如果您以非管理员身份开发，您将尽早发现这一点，并避免在客户安装您的系统但由于他们没有以管理员身份运行而无法使用它时出现令人讨厌的意外。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-02-23T03:08:50.357

我必须加入推荐 log4net 的合唱团，就我而言，这是从平台灵活性（桌面 .Net/Compact Framework，32/64 位）的角度来看的。

但是，将其包装在私有标签 API 中是一种**主要的反模式**。 [已经是Commons Logging](http://commons.apache.org/logging/)包装器[API](http://commons.apache.org/logging/apidocs/org/apache/commons/logging/Log.html)`log4net.ILogger`的 .Net 对应物，因此耦合已经为您最小化，并且由于它也是一个 Apache 库，因此通常甚至不用担心，因为您没有放弃任何控制权：如果您愿意，请分叉它必须。

我见过的大多数房屋包装库也犯了一个或多个错误：

42.  **使用全局单例记录器**（或等效的静态入口点），它失去了推荐[的每类记录器模式](http://logging.apache.org/log4net/release/faq.html#Are%20there%20any%20suggested%20ways%20for%20naming%20loggers?)的精细分辨率，而没有其他选择性增益。
43.  **未能公开可选`Exception`参数**，导致多个问题：
    *   它使异常日志记录策略更加难以维护，因此没有对异常进行一致的处理。
    *   即使使用一致的策略，将异常格式化为字符串也会过早丢失数据。我编写了一个自定义`ILayout`装饰器，它对异常执行详细的向下钻取以确定事件链。
44.  **未能公开属性`Is*Level*Enabled`**，这会在关闭区域或日志记录级别时放弃跳过格式化代码的能力。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-23T03:57:23.173

我不经常在 asp.net 中开发，但是当涉及到记录器时，我认为很多最佳实践是通用的。以下是我多年来学到的一些关于日志记录的随机想法：

### 构架

*   使用一个记录器抽象框架——比如 slf4j（或者你自己的），这样你就可以将记录器实现与你的 API 分离。我已经看到许多记录器框架来来去去，你最好能够毫不费力地采用一个新的框架。
*   尝试找到支持多种输出格式的框架。
*   尝试找到支持插件/自定义过滤器的框架。
*   使用可以由外部文件配置的框架，以便您的客户/消费者可以轻松调整日志输出，以便商业日志管理应用程序轻松读取它。
*   确保不要过度使用自定义日志记录级别，否则您可能无法迁移到不同的日志记录框架。

### 记录器输出

*   尽量避免使用 XML/RSS 样式的日志来记录可能遇到灾难性故障的日志。这很重要，因为如果在您的记录器没有写入结束标签的情况下关闭电源开关`</xxx>`，您的日志就会损坏。
*   记录线程。否则，可能很难跟踪程序的流程。
*   如果您必须国际化您的日志，您可能希望开发人员只使用英语（或您选择的语言）登录。
*   有时，可以选择将日志记录语句插入 SQL 查询中，这可能是调试情况下的救命稻草。如：

```
    -- 调用类：com.foocorp.foopackage.FooClass:9021
    选择 * 从 foo;
```

*   您需要类级别的日志记录。您通常也不想要记录器的静态实例 - 不值得进行微优化。
*   标记和分类记录的异常有时很有用，因为并非所有异常都是一样的。因此，如果您有一个日志监视器需要在关键状态时发送通知，那么提前了解重要异常的子集会很有帮助。
*   重复过滤器将节省您的视力和硬盘。您真的希望看到相同的日志记录语句重复 10^10000000 次吗？收到这样的消息不是更好吗： `This is my logging statement - Repeated 100 times`

另请参阅[我的这个问题](https://stackoverflow.com/questions/1112771/what-is-a-good-way-to-pass-useful-state-information-to-an-exception-in-java)。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2009-02-23T00:56:47.680

我没有资格评论 .Net 的日志记录，因为我的生计是 Java，但在过去 8 年中，我们的日志记录发生了迁移，您可能会发现与您的问题有一个有用的类比。

我们从 JVM 中的每个线程使用的 Singleton 记录器开始，并为整个进程设置日志记录级别。如果我们不得不调试系统的一个非常特定的部分，这会导致大量的日志，所以第一课是分割你的日志。

我们当前的记录器化身允许多个实例，其中一个定义为默认值。我们可以实例化任意数量的具有不同日志级别的子日志记录器，但这种架构最有用的方面是能够通过简单地更改日志记录属性来为单个包和类创建日志记录器。第二课是创建一个灵活的系统，允许在不更改代码的情况下覆盖其行为。

我们正在使用围绕 Log4J 的 Apache commons-logging library。

希望这可以帮助！

*** 编辑 ***

在阅读了下面 Jeffrey Hantin 的帖子后，我意识到我应该注意到我们的内部日志包装器实际上变成了什么。它现在本质上是一个工厂，并且严格用于使用正确的属性文件（由于遗留原因尚未将其移动到默认位置）来获取工作记录器。由于您现在可以在命令行上指定日志记录配置文件，我怀疑它会变得更加精简，如果您正在启动一个新应用程序，我肯定会同意他的说法，即您甚至不应该费心包装记录器。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-02-23T01:59:33.723

我们在工作中使用 Log4Net 作为日志记录提供程序，为日志实例使用单例包装器（尽管单例正在审查中，质疑它们是否是一个好主意）。

我们选择它的原因如下：

*   各种环境下的简单配置/重新配置
*   大量预先构建的附加程序
*   我们使用的 CMS 之一已经内置
*   大量的日志级别和围绕它们的配置

*我应该提一下，这是从 ASP.NET 开发的角​​度讲的*

我可以看到使用 .NET 框架中的 Trace 的一些优点，但我并不完全相信它，主要是因为我使用的组件并没有真正执行任何 Trace 调用。我经常使用的唯一一件事就是`System.Net.Mail`我能说的。

所以我们有一个包装 log4net 的库，在我们的代码中我们只需要这样的东西：

```
Logger.Instance.Warn("Something to warn about");
Logger.Instance.Fatal("Something went bad!", new Exception());

try {
  var i = int.Parse("Hello World");
} catch(FormatException, ex) {
  Logger.Instance.Error(ex);
} 
```

在方法中，我们检查是否启用了日志记录级别，因此您没有对 log4net API 的冗余调用（因此，如果未启用调试，调试语句将被忽略），但是当我有时间时我将对其进行更新以公开这些内容，以便您可以自己进行检查。这将防止在不应该进行评估时进行，例​​如：

```
Logger.Instance.Debug(string.Format("Something to debug at {0}", DateTime.Now); 
```

这将变成：

```
if(Logger.DebugEnabled) Logger.Instance.Debug(string.Format("Something to debug at {0}", DateTime.Now); 
```

（节省一点执行时间）

默认情况下，我们在两个位置登录：

1.  网站的文件系统（在非服务文件扩展名中）
2.  发送错误和致命的电子邮件

文件以每天滚动或 10mb (IIRC) 的形式完成。我们不使用 EventLog，因为它可能需要比我们通常想要的站点更高的安全性。

我发现记事本可以很好地阅读日志。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-23T04:22:52.363

**你使用什么框架？**

我们混合使用日志应用程序块和围绕 .Net 框架位工作的自定义日志帮助器。LAB 配置为输出相当广泛的日志文件，包括用于服务方法进入/退出的单独的一般跟踪文件和用于意外问题的特定错误文件。配置包括用于调试帮助的日期/时间、线程、pId 等以及完整的异常详细信息和堆栈（在意外异常的情况下）。

自定义日志记录助手使用 Trace.Correlation，并且在登录 WF 的上下文中特别方便。例如，我们有一个调用一系列顺序工作流的状态机。在每个调用活动中，我们记录开始（使用 StartLogicalOperation），然后在结束时使用 gereric 返回事件处理程序停止逻辑操作。

在尝试调试复杂业务序列中的故障时，这已被证明有用几次，因为它允许我们根据活动执行序列更快地确定 If/Else 分支决策等。

**您使用什么日志输出？**

我们使用文本文件和 XML 文件。文本文件是通过应用程序块配置的，但我们也从 WF 服务中获得了 XML 输出。这使我们能够捕获运行时事件（持久性等）以及通用业务类型异常。文本文件是按天和大小滚动的滚动日志（我相信 1MB 的总大小是一个滚动点）。

**您使用什么工具来查看日志？**

我们正在使用记事本和 WCF 服务跟踪查看器，具体取决于我们正在查看的输出组。如果您的输出设置正确，WCF 服务跟踪查看器真的非常方便，并且可以使读取输出变得更加简单。也就是说，如果我大致知道错误在哪里 - 只需阅读一个注释良好的文本文件也很好。

日志被发送到单个目录，然后根据源服务将其拆分为子目录。根目录通过一个网站公开，该网站的访问由支持用户组控制。这使我们能够查看生产日志，而无需提出请求并通过冗长的繁文缛节流程来获取生产数据。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-23T09:44:38.037

作为该工具的作者，我们当然使用[SmartInspect](http://www.gurock.com/products/smartinspect/)来记录和跟踪 .NET 应用程序。我们通常将命名管道协议用于实时日志记录，并将（加密的）二进制日志文件用于最终用户日志。我们使用 SmartInspect 控制台作为查看器和监控工具。

实际上有很多用于 .NET 的日志记录框架和工具。[DotNetLogging.com](http://www.dotnetlogging.com/)上有不同工具的概述和比较。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-01-24T13:13:06.803

答案中有很多很棒的建议。

一般的最佳实践是考虑谁将阅读日志。在我的情况下，它将是客户端站点的管理员。所以我记录了一些消息，这些消息给了他们一些他们可以采取行动的东西。例如，“无法初始化应用程序。这通常是由......引起的”

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-23T02:19:04.457

我们在 Web 应用程序中使用 log4net。

当应用程序在运行时出现故障并且您需要查看更多信息时，通过更改 XML 配置文件在运行时自定义日志记录的能力非常方便。

它还允许您针对特定的类或属性进行登录。当您知道错误发生在哪里时，这非常方便。一个经典的例子是 NHibernate，您只想查看进入数据库的 SQL。

编辑：

我们将所有事件写入数据库和 Trace 系统。我们用于错误或异常的事件日志。我们将大多数事件记录到数据库中，以便我们可以创建自定义报告并让用户在他们想要从应用程序中查看日志时查看日志。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-09-30T14:14:46.953

就面向方面的日志而言，我在另一个 SO 问题上被推荐使用 PostSharp -

[使用 Unity\T4\anything 的面向方面的日志记录](https://stackoverflow.com/questions/3633249/aspect-oriented-logging-with-unity-t4-anything-else)

如果您正在评估日志框架，答案中提供的链接值得访问。

# java - 在 Java 中重新抛出异常

> ID：576192
> 
> 赞同：4
> 
> 时间：2009-02-23T00:41:47.233
> 
> 标签：java

在java中，有可能重新抛出异常，但它有什么优势吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T00:44:25.557

想要重新抛出异常的一个例子是，当您真的不知道如何自己处理它，但您想记录异常已被抛出时。重新抛出它允许您捕获需要记录的堆栈信息，并将异常传递到调用堆栈以供调用者处理。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T00:45:28.423

当然。如果您需要对异常进行一些特殊处理（记录、清理等），但又不能完全“处理”它，通常是先进行处理，然后重新抛出异常。请注意，在许多情况下（尤其是清理资源），您可能需要 finally 子句而不是 catch/rethrow。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T00:44:20.847

有时，您希望方法抛出特定类型的异常，但很少有实例会导致方法中抛出其他异常。我经常用我想要的异常包装因果异常，然后重新抛出想要的异常。

当您无法确定异常导致您的操作失败时，这非常有用，直到将控制权传递给调用方法（或其祖先之一），因为如果进程最终失败，我可以在堆栈跟踪中回溯看看为什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T00:48:27.840

我已经很多年没有做过Java了，但据我所知，它就像其他语言一样，有例外和OO。异常可以被子类化，并且通常，您会想要捕获许多异常的基类，但可能无法处理所有异常。因此，假设您正在处理远程文件传输，并且想要捕获所有 IOError，因为您处理了其中的大部分，但没有处理 DiskFull。您可以重新抛出它，并让其他人在链上进一步处理它，但通过重新进行传输来处理其他问题，例如 TransmissionFailed。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T00:48:28.683

如果你能以某种方式证明你需要重新抛出你捕获的相同异常，我认为你的设计有问题。

捕获一个异常并重新抛出另一个异常是非常有意义的。例如，您可能想要添加原始异常没有的详细信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T02:38:08.153

### 真实案例

以下是一些我需要重新抛出 java 异常的真实情况：

*   在进行 JDBC 调用时，我会捕获一个 SQLException。但是，postgres 会抛出带有额外数据和状态的 PSQLException。在测试边缘案例时，我们能够破坏数据库，并且我们希望记录器具有关于异常和状态的非常具体的数据。我们会将原始异常包装在一个新异常中，其中包含有关服务器状态和重新抛出的更多数据。
*   在实现文本解析器时，我希望捕获许多运行时解析异常，例如 NumberFormatException，并将它们与有关文本导致的内容和导致解析异常的文本源的附加数据一起向上传递。
*   我的同事告诉我他工作的一个项目中，每个异常都被包装在两种类型之一的另一个异常中——RetryableException 和 FatalException。在 Retryable 异常的情况下，应用程序将等待并在固定时间段后重试操作。*我不确定我对这种设计的感觉如何，但我可以将其视为处理一些事务性问题的权宜之计。*
*   在某些情况下，我会使用一个现有的 API，该 API 为高级异常定义了一个 throws，并且我将执行一个抛出无关异常的操作（我觉得它确实属于 RuntimeException） - 然后我会重新抛出异常作为更一般异常的原因。
*   我能想到的最纯粹的你可能想要重新抛出异常的情况是当你想向它添加额外的数据时。例如：

    ```
    public bizMethod() throws CoolBizLogicException {
        int policyId = getPolicyId("bar");
        try {
          coolBizLogic(foobar); // this throws an exception
        }
        catch (CoolBizLogicException cble) {
          cble.setPolicyId(policyId);
          throw cble;
        }
    }
    ```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T00:44:43.870

我不这么认为。如果你不能处理它，不要抓住它。

# javascript - 如何返回元素 ID 而不是 [object HTMLDivElement] (Prototype.js)

> ID：576195
> 
> 赞同：13
> 
> 时间：2009-02-23T00:42:17.857
> 
> 标签：javascript, html, dom, prototypejs

我知道这很简单，但我无法理解它。目前以下代码返回“[object HTMLDivElement],[object HTMLDivElement]”我希望它返回“div1,div2”。有什么想法吗？多谢你们。

```
<HTML>
<HEAD>
<script type="text/javascript" src="path_to/prototype.js"></script>
<script>
function linkClick ()
{
    alert($$('div.basic'));
}
</script>
</HEAD>
<BODY>
   <div id="div1" class="basic" onclick="linkClick();"></div>
   <div id="div2" class="basic" onclick="linkClick();"></div>
</BODY>
</HTML> 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-06T15:20:18.747

我有同样的问题，有一个简单的解决方案：

如果 varElement 是包含 [HTMLDivElement]（或其他 DOM 对象）的对象，只需添加“.id”

例如

```
varElement.id 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-06T15:31:59.217

原型中有专门为此进行的优化：

```
$$('div.basic').pluck('id') 
```

如果我没看错你的问题，你想要一个 div ID 列表，而不是用逗号分隔的 id 字符串。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T00:47:03.070

```
var ids = $$('div.basic').collect(function(el) { return el.id; }); //array of ids

alert(ids.join(',')); 
```

*collect*是*map*的另一个名称，它允许您通过对每个元素应用“选择器”函数来将一种集合类型的元素转换为另一种类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T15:11:52.820

```
alert($$('div.basic').invoke('identify').join(','); 
```

调用将按名称调用函数。识别函数将提供 id。在数组上调用时，它将返回其 id 的数组。Join 将它们变成一个中间有逗号的字符串。

# javascript - 正则表达式：允许字母、数字和空格（至少包含一个字母或数字）

> ID：576196
> 
> 赞同：66
> 
> 时间：2009-02-23T00:43:54.200
> 
> 标签：javascript, regex

我目前正在使用这个正则表达式`^[A-Z0-9 _]*$`来接受字母、数字、空格和下划线。我需要修改它以在字符串中的某处至少需要一个数字或字母。任何帮助，将不胜感激！

这将用于验证我的网站的用户名。我实际上想支持尽可能多的字符，但只是想确保我防止代码注入，并且字符对所有用户都能正常显示。因此，我绝对愿意接受支持更广泛字符集的正则表达式验证建议。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-02-23T00:48:01.367

您只需要指定您当前的 RE，然后是一个字母/数字，然后是您当前的 RE：

```
^[A-Z0-9 _]*[A-Z0-9][A-Z0-9 _]*$ 
```

由于您现在已经声明它们是 Javascript RE，因此[这里](http://www.regular-expressions.info/javascriptexample.html)有一个有用的站点，您可以在其中针对输入数据测试 RE。

如果你也想要小写字母：

```
^[A-Za-z0-9 _]*[A-Za-z0-9][A-Za-z0-9 _]*$ 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-23T01:32:52.540

继续并在那里得到一个观点，而不是重复使用这些：

```
[A-Za-z0-9 _]
[A-Za-z0-9] 
```

我有两个（希望更好）替代这两个：

```
[\w ]
[^\W_] 
```

第一个匹配任何单词字符（字母数字和`_`，以及 Unicode）和空格。第二个匹配任何*不是*非单词字符或下划线的内容（仅限字母数字，以及 Unicode）。

如果您不想要 Unicode 匹配，请坚持使用其他答案。但是这些看起来更容易（在我看来）。在撰写本文时采用“首选”答案并使用较短的正则表达式给我们：

```
^[\w ]*[^\W_][\w ]*$ 
```

也许更具可读性，也许更少。当然更短。你的选择。

编辑：

就像一个注释，我在这里假设 Perl 风格的正则表达式。您的正则表达式引擎可能支持也可能不支持 \w 和 \W 之类的东西。

编辑2：

使用某人链接到的 JS 正则表达式测试器和一些基本示例对我的测试工作正常。没有做任何广泛的事情，只是想确保 \w 和 \W 在 JS 中正常工作。

编辑 3：

在尝试使用 JS 正则表达式测试器站点测试一些 Unicode 后，我发现了问题：该页面使用 ISO 而不是 Unicode。难怪我的日语输入不匹配。哦，那应该不难解决：

```
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
```

或者。就 JavaScript 而言，我不知道应该做什么，但我相信这并不难。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-23T00:46:03.477

```
^[ _]*[A-Z0-9][A-Z0-9 _]*$ 
```

您可以选择在前面添加一些空格或下划线，然后您需要一个字母或数字，然后是任意数量的数字、字母、空格或下划线。

仅包含空格和下划线的内容将导致该`[A-Z0-9]`部分失败。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-23T01:08:47.260

您可以使用[环视](http://www.regular-expressions.info/lookaround.html)：

```
^(?=.*[A-Za-z0-9])[A-Za-z0-9 _]*$ 
```

它将提前检查字符串是否包含字母或数字，如果有，它将检查其余字符是否符合您的要求。这可能可以改进，但它似乎适用于我的测试。

更新：

添加[Chris Lutz](https://stackoverflow.com/users/60777/chris-lutz)建议的[修改](https://stackoverflow.com/questions/576196/regular-expression-allow-letters-numbers-and-spaces-with-at-least-one-letter/576290#576290)：

```
^(?=.*[^\W_])[\w ]*$/ 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-09-28T04:12:48.500

对我来说 @"^[\w ]+$" 有效，允许数字、字母和空格，但需要输入至少一个字母或数字。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-04-12T10:09:47.020

这将针对特殊字符以及前导和尾随空格进行验证：

```
var strString = "Your String";

strString.match(/^[A-Za-z0-9][A-Za-z0-9 ]\*[A-Za-z0-9]\*$/) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-05-06T08:01:46.163

```
$("#ValuationName").bind("keypress", function (event) {
    if (event.charCode!=0) {
        var regex = new RegExp("^[a-zA-Z ]+$");
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        if (!regex.test(key)) {
            event.preventDefault();
            return false;
        }
    }
}); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-19T04:50:17.517

只需将其添加到 jquery.validationEngine-en.js 文件

```
 "onlyLetterNumberSp": {
                "regex": ^[A-Za-z0-9 _]*[A-Za-z0-9][A-Za-z0-9 _]*$,
                "alertText": "* No special characters allowed"
          }, 
```

并在文本字段中将其称为

```
<input type="text" class="form-control validate[required,custom[onlyLetterNumberSp]]"  id="title" name="title" placeholder="Title"/> 
```

# string - Haskell 中的高效字符串实现

> ID：576213
> 
> 赞同：24
> 
> 时间：2009-02-23T00:50:53.357
> 
> 标签：string, haskell, functional-programming

我目前正在自学 Haskell，我想知道在 Haskell 中使用字符串时的最佳实践是什么。

Haskell 中的默认字符串实现是一个 Char 列表。根据[Real World Haskell](http://book.realworldhaskell.org/read/efficient-file-processing-regular-expressions-and-file-name-matching.html)的说法，这对于文件输入输出效率很低，因为每个字符都是单独分配的（我假设这意味着字符串基本上是 Haskell 中的链表，但我不确定。）

但是，如果默认的字符串实现对于文件 i/o 效率低下，那么在内存中使用字符串是否也效率低下？为什么或者为什么不？C 使用一个 char 数组来表示一个字符串，我认为这将是大多数语言的默认处理方式。

如我所见，String 的列表实现将占用更多内存，因为每个字符都需要开销，并且迭代的时间也更多，因为需要指针取消引用才能到达下一个字符。但到目前为止，我一直喜欢使用 Haskell，所以我想相信默认实现是有效的。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-09T14:31:59.007

除了 String/ByteString 之外，现在还有一个结合了两全其美的[Text库——它与 Unicode 一起工作，同时在内部基于 ByteString，因此您可以获得快速、正确的字符串。](http://hackage.haskell.org/cgi-bin/hackage-scripts/package/text)

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-02-23T00:54:58.417

在 Haskell 中高效处理字符串的最佳实践基本上是：使用 Data.ByteString/Data.ByteString.Lazy。

[http://hackage.haskell.org/packages/archive/bytestring/latest/doc/html/](http://hackage.haskell.org/packages/archive/bytestring/latest/doc/html/)

* * *

就 Haskell 中默认字符串实现的效率而言，它不是。每个`Char`代表一个 Unicode 代码点，这意味着每个`Char`.

因为 a`String`只是`[Char]`，它是 的链表`Char`，这意味着`String`s 的引用局部性很差，并且再次意味着`String`s 在内存中相当大，至少它是`N * (21bits + Mbits)`其中 N 是字符串的长度，M 是一个指针（32、64，你有什么），与 Haskell 使用列表的许多其他地方不同，其他语言可能使用不同的结构（我在这里专门考虑控制流），`String`s 不太可能被优化由编译器循环等。

虽然 a`Char`对应于一个代码点，但 Haskell 98 报告没有指定任何有关执行文件 IO 时使用的编码的内容，甚至没有指定默认值，更不用说更改它的方法。在实践中，GHC 提供了一个扩展来做例如二进制 IO，但无论如何你都会在那个时候取消保留。

即使使用诸如在字符串前面添加之类的操作，在实践中 a 也不太可能`String`击败 a 。`ByteString`

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-24T08:17:29.033

答案比“使用惰性字节串”要复杂一些。

*   字节字符串每个值仅存储 8 位，而字符串保存真正的 Unicode 字符。因此，如果您想使用 Unicode，则必须始终在 UTF-8 或 UTF-16 之间进行转换，这比仅使用字符串更昂贵。不要错误地假设您的程序只需要 ASCII。除非它只是一次性代码，否则有一天有人需要输入一个欧元符号 (U+20AC) 或重音字符，您的快速字节串实现将被不可挽回地破坏。
*   字节字符串使一些事情变得更加昂贵，例如在字符串开头之前。

也就是说，如果您需要性能并且可以纯粹用字节串表示您的数据，那么就这样做。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-14T20:35:20.863

给出的基本答案，使用 ByteString，是正确的。也就是说，我之前的所有三个答案都有不准确之处。

关于 UTF-8：这是否会成为问题完全取决于您对字符串进行何种处理。如果您只是将它们视为单个数据块（包括连接等操作，但不拆分），或者执行某些有限的基于字节的操作（例如，以字节为单位查找字符串的长度，而不是在字符），你不会有任何问题。如果您使用的是 I18N，那么有足够多的其他问题只需使用`String`而不是`ByteString`开始解决您将遇到的极少数问题。

将单个字节添加到 ByteString 的前面可能比对 String 执行相同操作更昂贵。但是，如果您经常这样做，则可能会找到更便宜的方法来处理您的特定问题。

但最终结果将是，对于原始问题的发布者：是的，字符串在 Haskell 中效率低下，尽管相当方便。如果您担心效率，请使用 ByteStrings，并将它们视为 Char8 或 Word8 的数组，具体取决于您的目的（ASCII/ISO-8859-1 与某种类型的 Unicode，或只是任意二进制数据）。通常，使用惰性字节字符串（在字符串开头添加实际上是一个非常快的操作），除非您知道为什么需要非惰性字节字符串（通常包含在对惰性评估的性能方面的欣赏中）。

值得一提的是，我正在构建一个完全在 Haskell 中的自动交易系统，我们需要做的一件事是非常快速地解析我们通过网络连接接收到的市场数据馈送。我每秒可以处理读取和解析 300 条消息，而 CPU 数量可以忽略不计；就处理这些数据而言，GHC 编译的 Haskell 的性能与 C 非常接近，以至于它远未进入我的显着问题列表。

# c# - 我应该如何获取和处理（Exchange）电子邮件附件？

> ID：576226
> 
> 赞同：0
> 
> 时间：2009-02-23T00:56:40.537
> 
> 标签：c#, attachment, exchange-server-2003

我需要从电子邮件附件中获取一个 zip 文件，将其解压缩并将其复制到某处。

我应该怎么做？

我目前正在搜索诸如“Exchange API”和“处理电子邮件附件”之类的东西，并希望这种事情以前做过。

环境将是 Windows 和 Exchange 2003，任何编码都最好使用 C#。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T01:08:59.163

前段时间我不得不这样做，最好的方法是使用WEBDAV。每个邮件项目都可以像 URL 一样被引用。

如果您查看[WEBDAV 上的这篇博文](http://msdn.microsoft.com/en-us/library/ms877930(EXCHG.65).aspx)，它应该会为您指明方向。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T03:46:21.913

我最终使用[Redemption](https://stackoverflow.com/questions/589254/using-redemption-outlook-with-a-user-other-than-the-logged-in-user-and-gettin)做到了这一点，我遇到了几个问题，因此链接的问题，但最终到达了那里。

您确实需要安装 Outlook 客户端，并且您需要在尝试访问的任何邮箱上拥有**完整**的邮箱权限（不仅仅是读取）。

这个问题，[Read MS Exchange email in C#](https://stackoverflow.com/questions/652549/read-ms-exchange-email-in-c/652724#652724)在我得到一些好的答案几周后问了这个问题。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-23T04:02:55.657

假设您想在 .NET 中执行此操作，您将不得不编写或购买 POP3 或 IMAP4 类库来与 Exchange 服务器进行通信。

下面是来自 CodeProject 的 POP3 客户端的一个示例：http: [//www.codeproject.com/KB/IP/despop3client.aspx](http://www.codeproject.com/KB/IP/despop3client.aspx)

# java - 为什么 Math 类的方法是静态的？

> ID：576228
> 
> 赞同：6
> 
> 时间：2009-02-23T00:56:52.407
> 
> 标签：java

为什么 Math 类的方法是静态的？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-23T00:58:23.900

因为它们不需要任何内部状态，但 Java 中没有独立的函数——每个函数都必须是类的成员。因此，它们是静态的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-23T01:00:23.083

当您的方法实际上不涉及状态或类（例如，数学函数、数组上的实用程序等）时，该类仅用于将它们“分组”到一个连贯的位置。因此，您将它们列为静态（因为它们不接触状态）并且因为您从未实际实例化该类。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-23T01:30:00.813

与其他人所说的一样......静态方法调用速度更快，原因有两个：

1.  它们不是多态的——所以运行它们是一个特殊的 JVM 指令
2.  他们不需要将“this”作为第一个参数传递 - 不传递参数意味着堆栈上的项目更少，这意味着将项目放入堆栈所花费的时间更少

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T00:58:49.080

很大程度上是因为这些是实用方法，其中许多可以应用于原语的计算。该类的目的在很大程度上是为了提供一个标准的函数库，其中许多函数不需要直接应用于对象。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-23T00:58:50.327

它们是静态的，因为这些方法不依赖于Math 类的[实例变量](http://en.wikipedia.org/wiki/Instance_variable)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T00:59:13.510

静态函数没有“副作用”。当您期望计算得到单个结果时，无需跟踪状态变量。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-23T07:56:12.773

它们需要是静态的，因为数字是基元而不是适当的对象，因此它们不能是数字类型的实例方法。

现在 Java 也有用于装箱数的类，但是为每个数学运算创建一个对象效率太低了。

在其他语言中，例如 Smalltalk，数字是对象，所有算术运算都是实例方法。

* * *

## 回答 #8

> 赞同：-7
> 
> 时间：2009-02-23T00:59:43.727

可以像调用数学代码库一样调用它们。

# ruby-on-rails - Ruby/Rails 音频转换插件？

> ID：576229
> 
> 赞同：5
> 
> 时间：2009-02-23T00:57:11.547
> 
> 标签：ruby-on-rails, ruby, plugins, audio

我正在寻找一个好的 gem/plugin 来将用户上传的音频文件转换为不同的格式。我特别感兴趣的一种格式是使用 ima4 压缩转换为 Apple .caf 以包含在 iPhone 应用程序中。

到目前为止，我一直在我的 Mac 上使用 afconvert，但我需要在我的服务器端的 linux 机器上执行此操作。理想情况下，我可以制作回形针。

作为一个额外的解决方案，ffmpeg 可以工作，但我没有看到任何 .caf 选项。有人知道吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-04-24T01:05:53.610

[Sound eXchange](http://sox.sourceforge.net/)项目支持大量的音频文件转换。我过去曾使用它来将 OS X “say”程序输出的 aiff 文件转换为 Asterisk 的 ulaw 文件。这产生了相当不错的文本到语音。出于我的目的，我还在 github 上找到了一个名为[sox-ruby](http://github.com/Beirdo/sox-ruby/)的 Ruby 扩展，它直接包装了 libsox 函数。

# java - 代码适用于java图形，但不适用于graphics2d

> ID：576235
> 
> 赞同：0
> 
> 时间：2009-02-23T00:59:37.470
> 
> 标签：java, graphics, java-2d

在一个paintcomponent里面。它以g为参数，g可以是graphics或graphics2d。该类扩展了 jpanel。然后：

```
super.paintComponent(g);
this.setBackground( Color.BLACK ); 
```

如果 g 是 graphics 它可以工作，但如果它是 graphics2d 它不会。它可以同时编译，但 graphics2d 不会改变背景颜色。怎么来的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T03:06:20.397

[`JPanel`](http://java.sun.com/javase/6/docs/api/javax/swing/JPanel.html)（它是 的子类[`JComponent`](http://java.sun.com/javase/6/docs/api/javax/swing/JComponent.html)）只有一个[`paintComponent(Graphics)`](http://java.sun.com/javase/6/docs/api/javax/swing/JComponent.html#paintComponent(java.awt.Graphics))方法。它没有带有签名的方法`paintComponent(Graphics2D)`。

覆盖该`paintComponent(Graphics)`方法可以通过以下方式完成：

```
public void paintComponent(Graphics g)
{
    // Do things.
} 
```

但是，使用如下签名定义一个方法`paintComponent(Graphics2D)`是合法的，但*它永远不会被调用*，因为它不会覆盖定义于 中的任何方法`JComponent`：

```
public void paintComponent(Graphics2D g)
{
    // Do things.
    // However, this method will never be called, as it is not overriding any
    // method of JComponent, but is a method of the class this is defined in.
} 
```

[该类](http://java.sun.com/javase/6/docs/api/javax/swing/JComponent.html)（它是 的超类）的[Java API 规范`JComponent`](http://java.sun.com/javase/6/docs/api/javax/swing/JComponent.html)`JPanel`有一个方法摘要，其中列出了属于该类的所有方法。

有关在 Swing 中绘画的更多信息；

*   课程：从[Java 教程中](http://java.sun.com/docs/books/tutorial/index.html)[执行自定义绘画](http://java.sun.com/docs/books/tutorial/uiswing/painting/index.html)
*   [在 AWT 和 Swing 中绘画](http://java.sun.com/products/jfc/tsc/articles/painting/)

# python - 下载 zip 文件并使用 Python 将其写入磁盘有什么特殊技巧吗？

> ID：576238
> 
> 赞同：1
> 
> 时间：2009-02-23T01:00:37.703
> 
> 标签：python, ftp, ftplib

我正在使用 Python 的 ftplib 从远程 FTP 站点上传一个 zip 文件。然后我尝试将其写入磁盘。文件写入有效，但是大多数使用 WinZip 或 WinRar 打开 zip 的尝试都失败了；两个应用程序都声称文件已损坏。然而奇怪的是，当右键单击并尝试使用 WinRar 提取文件时，文件*将*被提取。

所以需要明确的是，文件写入将起作用，但不会在流行的 zip 应用程序中*打开，但**会*使用这些相同的应用程序解压缩。请注意，Python zipfile 模块*永远不会*无法提取 zip。

这是我用来从 FTP 站点获取 zip 文件的代码（请忽略错误的标签，这不是问题）。

```
filedata = None
def appender(chunk):
    global filedata
    filedata += chunk

def getfile(filename):
  try:
      ftp = None

      try:
          ftp = FTP(address)
          ftp.login('user', 'password')

      except Exception, e:
          print e

      command = 'RETR ' + filename

      idx = filename.rfind('/')
      path = filename[0:idx]
      ftp.cwd(path)
      fileonly = filename[idx+1:len(filename)]

      ftp.retrbinary('RETR ' + filename, appender)

      global filedata
      data = filedata

      ftp.close()

      filedata = ''
      return data

  except Exception, e:
      print e

data = getfile('/archives/myfile.zip')    
file = open(pathtoNTFileShare, 'wb')
file.write(data)
file.close() 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T01:13:59.353

直接在 retrbinary 函数内部传递 file.write 而不是传递 appender。这将起作用，并且在您下载大文件时也不会使用那么多 RAM。

但是，如果您希望将数据存储在变量中，您还可以有一个名为：

```
blocks = [] 
```

然后传递给 retrbinary 而不是 appender：

```
blocks.append 
```

您当前的 appender 函数是错误的。+= 在存在二进制数据时将无法正常工作，因为它会尝试执行字符串追加并在它看到的第一个 NULL 处停止。

正如@Lee B 所提到的，您还可以使用 urllib2 或 Curl。但是，如果您进行我上面提到的小修改，那么您当前的代码几乎是正确的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T01:12:00.437

我从未使用过该库，但 urllib2 工作正常，而且更简单。卷曲更好。

查看您的代码，我可以看到一些错误的地方。您的异常捕获仅打印异常，然后继续。对于像没有获得 FTP 连接这样的致命错误，他们需要打印消息然后退出。此外，您的文件数据以 None 开始，然后您的 appender 使用 += 添加到该文件，因此您尝试附加一个字符串 + None，当我在这里尝试时它会给出 TypeError。我很惊讶它的工作原理。我猜到 appender 会抛出异常，因此 FTP 副本会中止。

在重新阅读时，我刚刚注意到另一个关于在二进制数据上使用 += 的答案。很可能就是这样；python 有时会尝试变得聪明，当你加入带有空格或 NUL 的字符串或类似的东西时，它可能会“提供帮助”。最好的办法是打开文件（我们称它为 outfile），然后使用 appender 来处理 outfile.write(chunk)。

# javascript - 如何使用 Javascript 和 Prototype 不显眼地禁用提交按钮？

> ID：576240
> 
> 赞同：1
> 
> 时间：2009-02-23T01:02:34.390
> 
> 标签：javascript, prototypejs

所以我找到[了这个](https://stackoverflow.com/questions/326919/disabling-button-with-javascript-ff-vs-ie/327152#327152)建议，但我似乎不太明白怎么做。

这是我最初开始的代码：

```
 function greySubmits(e) {
      var value = e.srcElement.defaultValue;
      // This doesn't work, but it needs to
      $(e).insert('<input type="hidden" name="commit" value="' + value + '" />');

      // This causes IE to not submit at all
      $$("input[type='submit']").each(function(v) {v.disabled = true;})
   }

   // This works fine
   Event.observe(window, 'load', function() {
     $$("input[type='submit']").each(function(e) {
        Event.observe(e, 'click', greySubmits);
     });
  }); 
```

无论如何，我已经很接近了，但我似乎无法走得更远。

非常感谢您的帮助！

**更新**：对不起，我想我并不完全清楚。当有人单击提交按钮时，我想禁用所有提交按钮。但我**确实**需要发送提交按钮的值，以便服务器知道我单击了哪个按钮，因此插入调用。（注意：插入不会[**创建**](http://www.prototypejs.org/api/element/insert)您调用它的元素的子元素。）然后在禁用提交按钮后，我需要调用提交按钮提交调用的包含表单，因为禁用按钮后 IE 将不会提交。那有意义吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T17:29:29.103

你需要完全按照答案所说的去做：

“不要禁用其“onclick”中的按钮，而是将其保存，并在表单的 onsubmit 中执行。”

所以在 graySubmits() 中保留设置隐藏值的行，但删除禁用所有提交按钮的行。

然后在您的在线添加另一个事件处理程序 - 到表单，而不是提交按钮 - 执行禁用。

```
 function reallyGreySubmits(e) {
     // This causes IE to not submit at all
     $$("input[type='submit']").each(function(v) {v.disabled = true;})
 }

 Event.observe(window, 'load', function() {
     $$("input[type='submit']").each(function(e) {
        Event.observe(e, 'click', greySubmits);
     });
     $$("form").each(function(e) {
        Event.observe(e, 'submit', reallyGreySubmits);
     });
  }); 
```

我使用的另一个选项是不禁用提交，而是在两个元素之间交换可见性。单击时，将提交标记为隐藏，然后使 div 或其他在其位置显示为“已禁用”的元素可见。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T00:39:45.533

我终于让它工作了。Ryan 帮助了我，所以我会支持他 :-) 这是代码：

```
 function replaceSubmit(e) {
    var el = e.element();
    Element.insert(el, { 'before': '<input type="hidden" name="' + el.name + '" value="' + el.value +'" />'});
  }

  function greySubmits(e) {
    // Don't disable the submit if the submit was stopped with a return(false)
    if (e.returnValue) {
      $$("input[type='submit']").each(function(v) {v.disabled = true;})
    }
  }

  function fixButtons() {
    $$("input[type='submit']").each(function(v) {
        if (Element.hasClassName(v, 'disabled')) {
          v.disabled = true;
        } else {
          v.disabled = false;
        }
      });
  }

  Event.observe(window, 'load', function() {
      fixButtons();
      $$("input[type='submit']").each(function(e) {
          Event.observe(e, 'click', replaceSubmit);
        });
      $$("form").each(function(e) {
          Event.observe(e, 'submit', greySubmits);
        });
    }); 
```

fixButtons 是为了当人们单击后退按钮时，页面将修复所有按钮。如果你想禁用一个按钮并且不让它在背面重新启用，你只需给它一个禁用类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-24T14:49:01.560

```
document.observe("dom:loaded", function(){
   $$('form').find(function(thisForm) {
      Event.observe(thisForm, 'submit', function(event) {
         $$('input[type="submit"]').find(function(input) {
            input.value = 'Please wait ...';
            input.setAttribute('disabled',true);
            });
         });
      });       
   }); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-22T10:28:40.047

这是我想出的，这是从上面改编的。已修复，以便它使用 Prototype 的已停止属性检测取消的事件传播。

其他更改包括使用更长的变量名称（我总是对 e 是事件还是元素感到困惑），以及在取消表单提交时删除替换输入的函数。在我的实现中，按下浏览器并不会显示用户离开时的页面，而是似乎被重新获取（我正在使用 Rails），所以我也删除了该部分。

我在我的应用程序中使用按钮而不是输入，因此这部分也发生了变化。

```
function replaceSubmit(event) {
    var element = event.element();
    Element.insert(element, { 'before': '<input type="hidden" name="' + element.name + '" value="' + element.value +'" class="button_replacement">'});
}

function removeReplacementSubmits() {
    $$('input.button_replacement').each(function(button) {
        button.remove();
    });
}

function greySubmits(event) {
    // Don't disable the submit if the submit was stopped with a return(false)
    if (event.stopped === true) {
        removeReplacementSubmits();
    } else {
        $$('button[type="submit"]').each(function(button) {
            button.disabled = true;
            button.innerHTML += '&#133;';
        });
    }
}

Event.observe(window, 'load', function() {
    $$("button[type='submit']").each(function(element) {
        Event.observe(element, 'click', replaceSubmit);
    });
    $$("form").each(function(element) {
        Event.observe(element, 'submit', greySubmits);
    });
}); 
```

# gmail - Google 编程入门

> ID：576241
> 
> 赞同：4
> 
> 时间：2009-02-23T01:02:55.013
> 
> 标签：gmail

我刚刚开始了一个涉及使用一些 Google 的 API（用于 .NET）的项目，特别是联系人列表、日历和 Gmail。虽然 Google 确实通过他们的 code.google.com 网络提供了大量信息，但到目前为止，找到我需要开始的东西已被证明是一项艰巨的任务。我希望找到的是一张“大图”，看看 Google 为开发人员提供了什么，以及一些示例代码，以帮助我摆脱起步阶段。

有谁知道我在哪里可以找到一些使用 Google 的 API 开发基本应用程序的简单、有用的示例（我在 code.google.com 中遇到了一些示例，但它们太简陋以至于没有帮助）？是否有任何资源（印刷版或在线版）可以用勺子喂给谷歌新手而不用掩埋它们？在 code.google.com 中是否有适合 Google 初学者的特殊隐藏角落？

任何人都可以分享的任何信息都会非常有帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T01:07:24.613

[http://code.google.com/apis/ajax/playground/](http://code.google.com/apis/ajax/playground/)

# hdl - 如何在“Nand to Tetris”课程中为 ALU 设置输出标志？

> ID：576242
> 
> 赞同：20
> 
> 时间：2009-02-23T01:03:26.883
> 
> 标签：hdl, alu, nand2tetris

虽然我标记了这个作业，但它实际上是我自己免费完成的一门课程。无论如何，这门课程叫做“从 Nand 到俄罗斯方块”，我希望这里有人看过或上过这门课程，以便我能得到一些帮助。我正处于使用提供的 hdl 语言构建 ALU 的阶段。我的问题是我的芯片无法正确编译。当我尝试为 ALU 设置输出标志时出现错误。我相信问题是我不能下标任何中间变量，因为当我尝试根据一些随机变量（比如输入标志）将标志设置为真或假时，我没有得到错误。我知道问题不在于我尝试使用的芯片，因为我使用的是所有内置芯片。

到目前为止，这是我的 ALU 芯片：

```
/**
 * The ALU.  Computes a pre-defined set of functions out = f(x,y)
 * where x and y are two 16-bit inputs. The function f is selected 
 * by a set of 6 control bits denoted zx, nx, zy, ny, f, no.
 * The ALU operation can be described using the following pseudocode:
 *     if zx=1 set x = 0       // 16-bit zero constant
 *     if nx=1 set x = !x      // Bit-wise negation
 *     if zy=1 set y = 0       // 16-bit zero constant
 *     if ny=1 set y = !y      // Bit-wise negation
 *     if f=1  set out = x + y // Integer 2's complement addition
 *     else    set out = x & y // Bit-wise And
 *     if no=1 set out = !out  // Bit-wise negation
 *
 * In addition to computing out, the ALU computes two 1-bit outputs:
 *     if out=0 set zr = 1 else zr = 0 // 16-bit equality comparison
 *     if out<0 set ng = 1 else ng = 0 // 2's complement comparison
 */

CHIP ALU {

IN  // 16-bit inputs:
    x[16], y[16],
    // Control bits:
    zx, // Zero the x input
    nx, // Negate the x input
    zy, // Zero the y input
    ny, // Negate the y input
    f,  // Function code: 1 for add, 0 for and
    no; // Negate the out output

OUT // 16-bit output
    out[16],

    // ALU output flags
    zr, // 1 if out=0, 0 otherwise
    ng; // 1 if out<0, 0 otherwise

PARTS:
// Zero the x input
Mux16( a=x, b=false, sel=zx, out=x2 );

// Zero the y input
Mux16( a=y, b=false, sel=zy, out=y2 );

// Negate the x input
Not16( in=x, out=notx );
Mux16( a=x, b=notx, sel=nx, out=x3 );

// Negate the y input
Not16( in=y, out=noty );
Mux16( a=y, b=noty, sel=ny, out=y3 );

// Perform f
Add16( a=x3, b=y3, out=addout );
And16( a=x3, b=y3, out=andout );
Mux16( a=andout, b=addout, sel=f, out=preout );

// Negate the output
Not16( in=preout, out=notpreout );
Mux16( a=preout, b=notpreout, sel=no, out=out );

// zr flag
Or8way( in=out[0..7], out=zr1 );   // PROBLEM SHOWS UP HERE
Or8way( in=out[8..15], out=zr2 );
Or( a=zr1, b=zr2, out=zr );

// ng flag
Not( in=out[15], out=ng );

} 
```

因此，当我尝试将“out”的下标版本发送到 Or8Way 芯片时，问题就出现了。我尝试使用与“out”不同的变量，但遇到了同样的问题。然后我读到你不能下标中间变量。我想也许如果我将中间变量发送到其他芯片，并且该芯片下标它，它会解决问题，但它有同样的错误。不幸的是，我只是想不出一种方法来设置 zr 和 ng 标志而不下标一些中间变量，所以我真的被卡住了！

请注意，如果我用以下内容替换有问题的行，它将编译（但不会给出正确的结果，因为我只是使用一些随机输入）：

```
// zr flag
Not( in=zx, out=zr );

// ng flag
Not( in=zx, out=ng ); 
```

有人有想法么？

**编辑：**这是[本书的附录，](http://www1.idc.ac.il/tecs/book/appendixA.pdf)该附录指定了 hdl 的工作原理。具体看第 5 节，它讨论了总线并说：“内部引脚（如上面的 v）可能没有下标”。

**编辑：**这是我得到的确切错误：“第 68 行，无法将门的输出引脚连接到部件”。不过，错误消息有点令人困惑，因为这似乎不是真正的问题。如果我只是替换“Or8way(in=out[0..7], out=zr1);” 用“Or8way（in=false，out=zr1）；” 它不会产生这个错误，这导致我在附录中查找并发现 out 变量，因为它是作为中间派生的，所以不能下标。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-10-23T13:44:48.537

对于其他感兴趣的人，模拟器支持的解决方案是使用多个输出，例如：

```
Mux16( a=preout, b=notpreout, sel=no, out=out,out=preout2,out[15]=ng); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-03-20T21:57:29.527

这就是我做 ALU 的方式：

```
CHIP ALU {
IN  // 16-bit inputs:
    x[16], y[16],
    // Control bits:
    zx, // Zero the x input
    nx, // Negate the x input
    zy, // Zero the y input
    ny, // Negate the y input
    f,  // Function code: 1 for add, 0 for and
    no; // Negate the out output
OUT // 16-bit output
    out[16],
    // ALU output flags
    zr, // 1 if out=0, 0 otherwise
    ng; // 1 if out<0, 0 otherwise
PARTS:      
    Mux16(a=x, b=false, sel=zx, out=M16x);
    Not16(in=M16x, out=Nx);
    Mux16(a=M16x, b=Nx, sel=nx, out=M16M16x);

    Mux16(a=y, b=false, sel=zy, out=M16y);
    Not16(in=M16y, out=Ny);
    Mux16(a=M16y, b=Ny, sel=ny, out=M16M16y);

    And16(a=M16M16x, b=M16M16y, out=And16);
    Add16(a=M16M16x, b=M16M16y, out=Add16);
    Mux16(a=And16, b=Add16, sel=f, out=F16);

    Not16(in=F16, out=NF16);
    Mux16(a=F16, b=NF16, sel=no, out=out, out[15]=ng, out[0..7]=zout1, out[8..15]=zout2);

    Or8Way(in=zout1, out=zr1);
    Or8Way(in=zout2, out=zr2);
    Or(a=zr1, b=zr2, out=zr3);
    Not(in=zr3, out=zr);
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-23T03:22:50.903

Pax 建议的解决方案是使用中间变量作为另一个芯片的输入，例如 Or16Way。这是我修复问题并调试后的代码：

```
CHIP ALU {

IN  // 16-bit inputs:
    x[16], y[16],
    // Control bits:
    zx, // Zero the x input
    nx, // Negate the x input
    zy, // Zero the y input
    ny, // Negate the y input
    f,  // Function code: 1 for add, 0 for and
    no; // Negate the out output

OUT // 16-bit output
    out[16],

    // ALU output flags
    zr, // 1 if out=0, 0 otherwise
    ng; // 1 if out<0, 0 otherwise

PARTS:
// Zero the x input
Mux16( a=x, b=false, sel=zx, out=x2 );

// Zero the y input
Mux16( a=y, b=false, sel=zy, out=y2 );

// Negate the x input
Not16( in=x2, out=notx );
Mux16( a=x2, b=notx, sel=nx, out=x3 );

// Negate the y input
Not16( in=y2, out=noty );
Mux16( a=y2, b=noty, sel=ny, out=y3 );

// Perform f
Add16( a=x3, b=y3, out=addout );
And16( a=x3, b=y3, out=andout );
Mux16( a=andout, b=addout, sel=f, out=preout );

// Negate the output
Not16( in=preout, out=notpreout );
Mux16( a=preout, b=notpreout, sel=no, out=preout2 );

// zr flag
Or16Way( in=preout2, out=notzr );
Not( in=notzr, out=zr );

// ng flag
And16( a=preout2, b=true, out[15]=ng );

// Get final output
And16( a=preout2, b=preout2, out=out );
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T01:16:41.890

你有没有尝试过：

```
// zr flag
Or8way(
    in[0]=out[ 0], in[1]=out[ 1], in[2]=out[ 2], in[3]=out[ 3],
    in[4]=out[ 4], in[5]=out[ 5], in[6]=out[ 6], in[7]=out[ 7],
    out=zr1);
Or8way(
    in[0]=out[ 8], in[1]=out[ 9], in[2]=out[10], in[3]=out[11],
    in[4]=out[12], in[5]=out[13], in[6]=out[14], in[7]=out[15],
    out=zr2);
Or( a=zr1, b=zr2, out=zr ); 
```

我不知道这是否可行，但从[此处](http://moodle.cornellcollege.edu/0809/file.php/944/qa218-31Oct2008.pdf)查看此文档似乎很有意义。

我也会三思而后行，`out`因为试图找出它与关键字之间的区别`out`（如“ `out=...`”）会让人感到困惑。

在您的编辑之后，如果您不能为中间值下标，那么您似乎必须实现一个单独的“芯片”，例如`IsZero16`它将一个 16 位值作为输入（您的中间值`out`）并返回一位指示其零性你可以加载到`zr`. 或者你可以制作一个`IsZero8`芯片，但你必须像你目前正在做的那样把它称为两个阶段`Or8Way`。

这似乎是一个有效的解决方案，因为您**可以**将输入值下标到芯片。

而且，仅查看错误，这可能与您建议的问题不同。“无法将门的输出引脚连接到零件”这句话对我来说意味着您无法将输出参数的信号连接回芯片处理区域。从电气的角度来看，这是有道理的。

您可能会发现您必须将输出存储到一个临时变量中并使用它来设置`zr`和`out`（因为一旦信号已“发送”到芯片输出引脚，它们可能不再可用）。

我们可以试试吗：

```
CHIP SetFlags16 {
    IN  inpval[16];
    OUT zflag,nflag;
    PARTS:
        Or8way(in=inpval[0.. 7],out=zr0);
        Or8way(in=inpval[8..15],out=zr1);
        Or(a=zr0,b=zr1,out=zflag);
        Not(in=inpval[15],out=nflag);
} 
```

然后，在你的 ALU 芯片中，最后使用它：

```
// Negate the output
Not16( in=preout, out=notpreout );
Mux16( a=preout, b=notpreout, sel=no, out=tempout );

// flags
SetFlags16(inpval=tempout,zflag=zr,nflag=ng);

// Transfer tempout to out (may be a better way).
Or16(a=tempout,b=tempout,out=out); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-29T17:08:43.727

这里也有一个新芯片，但感觉更干净

```
/**
 * Negator16 - negates the input 16-bit value if the selection flag is lit
 */
CHIP Negator16 {
  IN sel,in[16];
  OUT out[16];

  PARTS:
  Not16(in=in, out=negateIn);
  Mux16(a=in, b=negateIn, sel=sel, out=out);
}

CHIP ALU {
  // IN and OUT go here...
  PARTS:
  //Zero x and y if needed
  Mux16(a=x, b[0..15]=false, sel=zx, out=x1);
  Mux16(a=y, b[0..15]=false, sel=zy, out=y1);

  //Create x1 and y1 negations if needed
  Negator16(in=x1, sel=nx, out=x2);
  Negator16(in=y1, sel=ny, out=y2);

  //Create x&y and x+y
  And16(a=x2, b=y2, out=andXY);
  Add16(a=x2, b=y2, out=addXY);

  //Choose between And/Add according to selection
  Mux16(a=andXY, b=addXY, sel=f, out=res);

  // negate if needed and also set negative flag
  Negator16(in=res, sel=no, out=res1, out=out, out[15]=ng);

  // set zero flag (or all bits and negate)
  Or16Way(in=res1, out=nzr);
  Not(in=nzr, out=zr);
} 
```

# c# - 升级程序集时，在隔离存储中迁移文件的最佳方法是什么？

> ID：576243
> 
> 赞同：6
> 
> 时间：2009-02-23T01:03:56.010
> 
> 标签：c#, winforms, devexpress, isolatedstorage

我有一个偶尔会更新的 .Net 2.0 C# 应用程序，并且程序集版本和文件版本会增加。这一切正常，但它也破坏了在独立存储中存储 xml 设置文件。（xml 文件由 DevExpress XtraGridView.SaveLayoutToXml() 生成）

有没有办法将这些文件从隔离存储中的旧文件夹复制到新文件夹。即从 Appname\1.0.0.0 到 Appname\1.0.1.0

或者有没有更好的地方来存储这些 xml 文件，当应用程序的文件版本发生变化时，这些文件不会改变？

我不想将这些文件存储在应用程序的 .exe 文件夹中，因为在没有管理员权限的情况下不允许应用程序在 Vista 中写入该文件夹。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T03:43:39.963

如果您使用 ClickOnce，则可以使用[应用程序范围的隔离存储](https://stackoverflow.com/questions/202013/clickonce-and-isolatedstorage/227218#227218)。

如果您不使用 ClickOnce，则可以通过为您的应用程序指定一个[强名称](http://msdn.microsoft.com/en-us/library/wd40t7ad(VS.80).aspx)来获得相同的效果。强名称通过向程序集添加公钥令牌和数字签名来保证程序集身份的唯一性。

# django - 如何从 Django 中的所有视图传递标准的静态变量？

> ID：576251
> 
> 赞同：11
> 
> 时间：2009-02-23T01:09:29.070
> 
> 标签：django

我正在开发一个博客应用程序，我希望有一个侧边栏，其中包含博客存在的所有月份的列表，以提供指向档案页面的链接。此外，我想让它在月份变化时自动更新，而不是在模板中硬编码。当然，据我所知，这意味着我必须计算*每个*视图中的月份列表，并将其传递到每个视图的每个模板中。

如果可能的话，我想避免这种情况。有没有办法计算一次列表并自动将其应用于每个模板，而不必从每个视图显式地将其传递到模板中？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-23T03:37:21.927

您的问题有几种可能的解决方案。

如果你真的想在你网站的*每个*页面上都有这个，[上下文处理器](http://docs.djangoproject.com/en/dev/ref/templates/api/#writing-your-own-context-processors)可能是你最好的选择。上下文处理器是将数据注入所有模板上下文的基本方法。但是请注意，*每个*请求都会调用上下文处理器。

另一种解决方案是创建一个[自定义模板标签](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#howto-custom-template-tags)，并将其用于您希望拥有侧边栏的所有页面的共享基本模板。创建模板标签有点复杂，但它们更灵活。

无论使用哪种解决方案，您还应该查看 Django 的[缓存框架](http://docs.djangoproject.com/en/dev/topics/cache/#topics-cache)。缓存框架可以很容易地暂时存储您的计算值一段时间，以节省每个请求的一些工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T01:16:26.527

你想要一个模板上下文处理器

[Django - 让中间件与视图/模板通信](https://stackoverflow.com/questions/557460/django-having-middleware-communicate-with-views-templates)

[http://docs.djangoproject.com/en/dev/ref/templates/api/?from=olddocs#id1](http://docs.djangoproject.com/en/dev/ref/templates/api/?from=olddocs#id1)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T04:26:12.870

Django 的模板继承应该涵盖这一点。您可以创建一个处理侧边栏功能的基本模板。您的其他视图扩展了此模板。

模板继承： http: [//www.djangobook.com/en/1.0/chapter04/#s-template-inheritance](http://www.djangobook.com/en/1.0/chapter04/#s-template-inheritance)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-25T16:35:46.050

前面提到的自定义模板标签和[模板片段缓存](http://docs.djangoproject.com/en/dev/topics/cache/?from=olddocs#template-fragment-caching)的组合应该可以解决问题。

# java - 是真关键字还是假关键字？

> ID：576253
> 
> 赞同：7
> 
> 时间：2009-02-23T01:11:24.760
> 
> 标签：java

Java中的`true`和关键字是什么？`false`

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-23T01:15:11.583

[这是Java 语言关键字](http://java.sun.com/docs/books/tutorial/java/nutsandbolts/_keywords.html)的完整列表。特别要注意的是

> `true`, `false`, 和`null`可能看起来像关键字，但**它们实际上是文字**；您不能将它们用作程序中的标识符。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-23T01:12:01.950

不`true`，并且`false`是文字。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T01:13:39.510

不，但它们是保留的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-12T11:20:14.693

**不**，true，false 不是关键字，它们实际上是文字；您不能将它们用作程序中的标识符。[这是java](http://docs.oracle.com/javase/tutorial/java/nutsandbolts/_keywords.html)中关键字的完整列表

```
abstract        continue            for           new           switch
assert***       default         goto*             package   synchronized
boolean     do                  if            private   this
break       double          implements    protected throw
byte        else            import            public    throws
case        enum****            instanceof    return    transient
catch       extends         int           short         try
char        final           interface     static    void
class       finally         long              strictfp**    volatile
const*      float           native            super         while

*   not used
**  added in 1.2
*** added in 1.4
****    added in 5.0 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-01-04T10:25:44.353

不，true 和 false 是 java 中的文字。字面量是实际值而不是变量名。尽管它们不是 java 关键字列表的一部分，但它们被认为是保留的。如果您尝试将它们用作变量，您将收到编译错误消息 - invalid VariableDeclaratorId

# objective-c - 将 NSDate 转换为 NSString

> ID：576265
> 
> 赞同：258
> 
> 时间：2009-02-23T01:18:24.413
> 
> 标签：objective-c, swift, nsstring, nsdate

如何转换，`NSDate`以便`NSString`仅将**@"yyyy"**格式的年份输出到字符串？

* * *

## 回答 #1

> 赞同：472
> 
> 时间：2009-05-30T22:38:51.787

怎么样...

```
NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
[formatter setDateFormat:@"yyyy"];

//Optionally for time zone conversions
[formatter setTimeZone:[NSTimeZone timeZoneWithName:@"..."]];

NSString *stringFromDate = [formatter stringFromDate:myNSDateInstance];

//unless ARC is active
[formatter release]; 
```

**斯威夫特 4.2：**

```
func stringFromDate(_ date: Date) -> String {
    let formatter = DateFormatter()
    formatter.dateFormat = "dd MMM yyyy HH:mm" //yyyy
    return formatter.string(from: date)
} 
```

* * *

## 回答 #2

> 赞同：284
> 
> 时间：2012-06-12T21:24:22.360

我不知道我们是怎么错过的：*[localizedStringFromDate:dateStyle:timeStyle:](https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSDateFormatter_Class/Reference/Reference.html#//apple_ref/occ/clm/NSDateFormatter/localizedStringFromDate%3adateStyle%3atimeStyle%3a)*

```
NSString *dateString = [NSDateFormatter localizedStringFromDate:[NSDate date] 
                                                      dateStyle:NSDateFormatterShortStyle 
                                                      timeStyle:NSDateFormatterFullStyle];
NSLog(@"%@",dateString); 
```

输出 '13/06/12 00:22:39 GMT+03:00'

* * *

## 回答 #3

> 赞同：87
> 
> 时间：2011-01-11T23:16:06.523

希望通过提供带时间的年、月、日等常规格式化程序来增加更多价值。您可以使用此格式化程序超过一年

```
[dateFormat setDateFormat: @"yyyy-MM-dd HH:mm:ss zzz"]; 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2011-05-05T21:52:57.100

网上有很多`NSDate`助手，我倾向于使用：

[https://github.com/billymeltdown/nsdate-helper/](https://github.com/billymeltdown/nsdate-helper/)

自述文件摘录如下：

```
 NSString *displayString = [NSDate stringForDisplayFromDate:date]; 
```

这会产生以下类型的输出：

```
‘3:42 AM’ – if the date is after midnight today
‘Tuesday’ – if the date is within the last seven days
‘Mar 1’ – if the date is within the current calendar year
‘Mar 1, 2008’ – else ;-) 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2015-09-10T00:53:46.243

在斯威夫特：

```
var formatter = NSDateFormatter()
formatter.dateFormat = "yyyy"
var dateString = formatter.stringFromDate(YourNSDateInstanceHERE) 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-09-16T12:37:37.740

```
 NSDateFormatter *dateformate=[[NSDateFormatter alloc]init];
  [dateformate setDateFormat:@"yyyy"]; // Date formater
  NSString *date = [dateformate stringFromDate:[NSDate date]]; // Convert date to string
  NSLog(@"date :%@",date); 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-04-23T20:47:37.577

如果你没有`NSDate` `-descriptionWithCalendarFormat:timeZone:locale:`可用的（我不相信 iPhone/Cocoa Touch 包括这个），你可能需要使用 strftime 和一些 C 风格的字符串。您可以从`NSDate`using获取 UNIX 时间戳`NSDate -timeIntervalSince1970`。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2015-08-11T09:01:00.393

```
+(NSString*)date2str:(NSDate*)myNSDateInstance onlyDate:(BOOL)onlyDate{
    NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
    if (onlyDate) {
        [formatter setDateFormat:@"yyyy-MM-dd"];
    }else{
        [formatter setDateFormat: @"yyyy-MM-dd HH:mm:ss"];
    }

    //Optionally for time zone conversions
    //   [formatter setTimeZone:[NSTimeZone timeZoneWithName:@"..."]];

    NSString *stringFromDate = [formatter stringFromDate:myNSDateInstance];
    return stringFromDate;
}

+(NSDate*)str2date:(NSString*)dateStr{
    if ([dateStr isKindOfClass:[NSDate class]]) {
        return (NSDate*)dateStr;
    }

    NSDateFormatter *dateFormat = [[NSDateFormatter alloc] init];
    [dateFormat setDateFormat:@"yyyy-MM-dd"];
    NSDate *date = [dateFormat dateFromString:dateStr];
    return date;
} 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2016-03-18T11:13:33.293

只需添加此扩展名：

```
extension NSDate {
    var stringValue: String {
        let formatter = NSDateFormatter()
        formatter.dateFormat = "yourDateFormat"
        return formatter.stringFromDate(self)
    }
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-02-10T14:20:01.273

如果您在 Mac OS X 上，您可以编写：

```
NSString* s = [[NSDate date] descriptionWithCalendarFormat:@"%Y_%m_%d_%H_%M_%S" timeZone:nil locale:nil]; 
```

但是，这在 iOS 上不可用。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-12-05T13:19:10.443

这是快速的格式：

```
func dateFormatterWithCalendar(calndarIdentifier: Calendar.Identifier, dateFormat: String) -> DateFormatter {

    let formatter = DateFormatter()
    formatter.calendar = Calendar(identifier: calndarIdentifier)
    formatter.dateFormat = dateFormat

    return formatter
}

//Usage
let date = Date()
let fotmatter = dateFormatterWithCalendar(calndarIdentifier: .gregorian, dateFormat: "yyyy")
let dateString = fotmatter.string(from: date)
print(dateString) //2018 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-01-24T14:16:41.620

迅速 4 个回答

```
static let dateformat: String = "yyyy-MM-dd'T'HH:mm:ss"
public static func stringTodate(strDate : String) -> Date
{

    let dateFormatter = DateFormatter()
    dateFormatter.dateFormat = dateformat
    let date = dateFormatter.date(from: strDate)
    return date!
}
public static func dateToString(inputdate : Date) -> String
{

    let dateFormatter = DateFormatter()
    dateFormatter.dateFormat = dateformat
    return formatter.string(from: inputdate)

} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-07-09T16:10:23.913

* * *

## **使用`extension`有清晰的代码**

* * *

您可以编写扩展以将任何`Date`对象转换为任何所需的日历和任何格式

```
extension Date{
    func asString(format: String = "yy/MM/dd HH:mm",
                  for identifier: Calendar.Identifier = .persian) -> String {
        let formatter = DateFormatter()
        formatter.calendar = Calendar(identifier: identifier)
        formatter.dateFormat = format

        return formatter.string(from: self)
    }
} 
```

然后像这样使用它：

```
let now = Date()

print(now.asString())  // prints -> 00/04/18 20:25
print(now.asString(format: "yyyy/MM/dd"))  // prints -> 1400/04/18
print(now.asString(format: "MM/dd", for: .gregorian))  //  prints -> 07/09 
```

要了解如何指定**所需的格式**字符串，请查看此[链接](https://nsdateformatter.com/)。
有关如何格式化日期的完整参考，请参阅[此处的](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/DataFormatting/Articles/dfNumberFormatting10_4.html#//apple_ref/doc/uid/TP40002368-SW5)**Apple**官方**日期格式化指南** 。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-03-27T00:16:46.970

```
NSCalendar *calendar = [NSCalendar currentCalendar];
NSDateComponents *components = [calendar components:(NSCalendarUnitYear | NSCalendarUnitMonth | NSCalendarUnitDay) fromDate:myNSDateInstance];
NSInteger year = [components year];
// NSInteger month = [components month];
NSString *yearStr = [NSString stringWithFormat:@"%ld", year]; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-01-10T18:50:13.700

定义您自己的实用程序来格式化您的日期所需的日期格式，例如。

```
NSString * stringFromDate(NSDate *date)  
 {   NSDateFormatter *formatter
    [[NSDateFormatter alloc] init];  
    [formatter setDateFormat:@"MM ∕ dd ∕ yyyy, hh꞉mm a"];    
    return [formatter stringFromDate:date]; 
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-10-16T07:56:53.123

#ios #swift #convertDateinString

只需像这样按照您传递的格式“将日期转换为字符串”：

```
let formatter = DateFormatter()

formatter.dateFormat = "dd-MM-YYYY" // pass formate here

let myString = formatter.string(from: date) // this will convert Date in String 
```

注意：您可以指定不同的格式，例如`"yyyy-MM-dd"`,`"yyyy"`等`"MM"`...

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-06-10T14:58:26.760

# iOS 15 更新

iOS 15 现在支持直接调用`.formatted`对象`Date`而无需显式`DateFormatter`.

## 常见格式示例

[文档](https://developer.apple.com/documentation/foundation/date/formatstyle/3798886-init)

```
date.formatted() // 6/8/2021, 7:30 PM
date.formatted(date: .omitted, time: .complete) // 19:30
date.formatted(date: .omitted, time: .standard) // 07:30 PM
date.formatted(date: .omitted, time: .shortened) // 7:30 PM
date.formatted(date: .omitted, time: .omitted) 
```

## 替代语法

[文档](https://developer.apple.com/documentation/foundation/date/formatstyle)

```
// We can also specify each DateComponent separately by chaining modifiers.
date.formatted(.dateTime.weekday(.wide).day().month().hour().minute())
// Tuesday, Jun 8, 7:30 pm

// Answer to specific question
date.formatted(.dateTime.year()) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-07-09T17:54:01.090

对于 Objective-C：

```
NSDate *date = [NSDate dateWithTimeIntervalSinceNow:0];
NSDateFormatter *formatter = [NSDateFormatter new];
formatter.dateFormat = @"yyyy";
NSString *dateString = [formatter stringFromDate:date]; 
```

对于斯威夫特：

```
let now = Date()
let formatter = DateFormatter()
formatter.dateFormat = "yyyy"
let dateString = formatter.string(from: now) 
```

[这是nsdateformatter](https://nsdateformatter.com/)的好网站。您可以`DateFormatter`在不同的本地预览不同的日期字符串。

[![在此处输入图像描述](https://i.stack.imgur.com/gViTP.png)](https://i.stack.imgur.com/gViTP.png)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-11-28T17:31:01.313

使用 C# 风格的方式将日期转换为字符串的简单方法。

用法：

```
let a = time.asString()
// 1990-03-25

let b = time.asString("MM ∕ dd ∕ yyyy, hh꞉mm a")
// 03 / 25 / 1990, 10:33 PM 
```

扩展：

```
extension Date {
    func asString(_ template: String? = nil) -> String {
        if let template = template {
            let df = DateFormatter.with(template: template)

            return df.string(from: self)
        }
        else {
            return globalDateFormatter.string(from: self)
        }
    }
}

// Here you can set default template for DateFormatter
public let globalDateFormatter: DateFormatter = DateFormatter.with(template: "y-M-d")

public extension DateFormatter {
    static func with(template: String ) -> DateFormatter {
        let df = DateFormatter()
        df.dateFormat = template
        return df
    }
} 
```

# java - 用浮点数除以零时，我可以强制java抛出错误吗？

> ID：576266
> 
> 赞同：2
> 
> 时间：2009-02-23T01:19:06.440
> 
> 标签：java, floating-point, divide-by-zero

我写了一个模拟器，它有一些碰撞检测代码，并在检测到碰撞时对每个对象进行了大量数学运算。

如果这两个对象位于完全相同的位置或在某些罕见的其他情况下，我将 NaN（不是数字）作为它们沿线某处的位置，我想知道在哪里。通常，如果我对整数执行这些操作，程序会崩溃，但因为 + 和 - 无穷大是浮点规范的一部分，所以它是允许的。

所以，沿着这条线的某个地方，我取负数的平方根或除以零。

无论如何我可以让我的程序在导致这种情况的操作上自动崩溃，以便我可以缩小一些范围？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T01:23:54.387

我认为你不能引发除以零异常，除非你在除法之前测试数字并自己引发异常。

浮点数的问题在于，标准要求结果获得 NaN（非数字）浮点数。我知道的所有 JVM 和编译器都遵循这方面的标准。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T12:14:29.563

您可以处理查找*fdiv*操作的二进制类，插入除以零的检查。

爪哇：

```
return x.getFloat() / f2; 
```

[javap](http://java.sun.com/javase/6/docs/technotes/tools/index.html#basic)输出：

```
0:   aload_0
1:   invokevirtual   #22; //Method DivByZero$X.getFloat:()F
4:   fload_1
5:   fdiv
6:   freturn 
```

为除零引发*ArithhemticException的替换代码：*

```
0:   aload_1
1:   invokevirtual   #22; //Method DivByZero$X.getFloat:()F
4:   fstore_2
5:   fload_0
6:   fconst_0
7:   fcmpl
8:   ifne    21
11:  new     #32; //class java/lang/ArithmeticException
14:  dup
15:  ldc     #34; //String / by zero
17:  invokespecial   #36; //Method java/lang/ArithmeticException."<init>":(Ljava/lang/String;)V
20:  athrow
21:  fload_2
22:  fload_0
23:  fdiv
24:  freturn 
```

这种处理可以使用像[ASM](http://asm.objectweb.org/)这样的字节码操作 API 来完成。这并非微不足道，但也不是火箭科学。

* * *

如果您想要的只是监视（而不是更改代码的操作），那么更好的方法可能是使用调试器。我不确定哪些调试器可以让您编写表达式来捕获您要查找的内容，但编写自己的调试器并不难。Sun JDK 提供了[JPDA](http://java.sun.com/javase/6/docs/technotes/guides/jpda/index.html)和演示如何使用它的示例代码（解压缩 jdk/demo/jpda/examples.jar）。

附加到 localhost 上的套接字的示例代码：

```
public class CustomDebugger {

    public static void main(String[] args) throws Exception {
        String port = args[0];
        CustomDebugger debugger = new CustomDebugger();
        AttachingConnector connector = debugger.getConnector();
        VirtualMachine vm = debugger.connect(connector, port);
        try {
            // TODO: get & use EventRequestManager
            vm.resume();
        } finally {
            vm.dispose();
        }
    }

    private AttachingConnector getConnector() {
        VirtualMachineManager vmManager = Bootstrap.virtualMachineManager();
        for (Connector connector : vmManager.attachingConnectors()) {
            System.out.println(connector.name());
            if ("com.sun.jdi.SocketAttach".equals(connector.name())) {
                return (AttachingConnector) connector;
            }
        }
        throw new IllegalStateException();
    }

    private VirtualMachine connect(AttachingConnector connector, String port)
            throws IllegalConnectorArgumentsException, IOException {
        Map<String, Connector.Argument> args = connector.defaultArguments();
        Connector.Argument pidArgument = args.get("port");
        if (pidArgument == null) {
            throw new IllegalStateException();
        }
        pidArgument.setValue(port);

        return connector.attach(args);
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-07-16T20:30:55.107

扩展 McDowell 处理二进制类的建议，我编写了一些代码，我已经成功地用于相对较大的代码库，我想分享：[https ://bitbucket.org/Oddwarg/java-sigfpe-emulator /](https://bitbucket.org/Oddwarg/java-sigfpe-emulator/)

我使用 Krakatau 来反汇编和重组类文件。一个包含公共静态辅助方法的小型 Java 类，`float notZero(float f)`必须`double notZero(double f)`作为进程的一部分添加到应用程序中。

原则上，对字节码汇编的修改非常简单：当遇到`fdiv`或`ddiv` 指令时，首先插入对适当`notZero`函数的调用。

```
L28:    fload_0 
L29:    fload_1 
        invokestatic Method owg/sigfpe/SIGFPE notZero (F)F 
L30:    fdiv 
L31:    fstore_2 
```

在此示例中，程序插入了 L29 和 L30 之间的行。

该`notZero`调用使用操作数堆栈的顶部作为其参数，即*除数*。如果除数不为零，则返回，将其放回操作数堆栈的顶部。如果除数为零，则`ArithmeticException`改为抛出 an。

调用方法并确保操作数堆栈保持不变可以避免大多数与堆栈映射帧和操作数堆栈溢出相关的问题，但我确实必须确保`.stack same`-type 帧之间的距离保持在阈值以下。它们按需重复。

我希望这对某人有用。我自己花费了足够多的时间手动搜索浮点除法为零。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T06:49:50.903

我可以建议您使用 AOP（例如[AspectJ](http://www.eclipse.org/aspectj/)）来捕获异常并为您提供额外的运行时信息。

两个可能相关的用例：

*   围绕您期望 NaN 的方面，并尝试防止 NaN/Infinity 并记录运行时信息
*   编写一个可以捕获异常并防止您的软件崩溃的方面

取决于您如何部署软件，您可以使用不同的 AOP 编织策略（运行时、加载时等）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T01:27:29.447

我不知道您可以在 VM 中设置什么来实现这一点。

根据您的代码的结构，我会在我的方法中添加以下类型的检查（我只是出于习惯一直这样做 - 虽然非常有用）：

```
float foo(final float a, final float b)  
{  
    // this check is problematic - you really want to check that it is a nubmer very   
    // close to zero since floating point is never exact.  
    if(b == 0.0f)  
    {  
        throw new IllegalArgumentException("b cannot be 0.0f");  
    }  

    return (a / b);  
} 
```

如果您需要浮点数的精确表示，您需要查看 java.math.BigDecimal。

# c# - 如何开始制作 C# RSS 阅读器？

> ID：576267
> 
> 赞同：50
> 
> 时间：2009-02-23T01:20:39.993
> 
> 标签：c#, xml, rss

我一直想做一个 RSS 阅读器（只是为了好玩），但我不知道从哪里开始。我对RSS一无所知。有没有关于 RSS 以及如何在应用程序中实现它的好的教程（不是关于如何制作 RSS 阅读器的教程，那太容易了）。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-02-23T01:24:07.210

看

[http://msdn.microsoft.com/en-us/library/bb943474.aspx](http://msdn.microsoft.com/en-us/library/bb943474.aspx)

[http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication.syndicationfeed.aspx](http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication.syndicationfeed.aspx)

[http://msdn.microsoft.com/en-us/library/bb943480.aspx](http://msdn.microsoft.com/en-us/library/bb943480.aspx)

基本上，.Net 3.5 框架中有很多东西可以完成解析和表示提要的繁重工作；例如，编写一个包含提要 URL 并下载提要并打印所有项目的标题和作者的 30 行应用程序并不难。（适用于 RSS 2.0（不是其他的！）或 Atom。）

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-23T01:36:26.697

如果您专注于创建**RSS 阅读器**而不是 RSS 解析逻辑，您可能希望使用CodePlex.com 上名为[Argotic的免费 RSS 库委派创建/阅读 RSS 提要](http://www.codeplex.com/Argotic)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-08-16T07:37:00.800

正如另一张海报所推荐的，SyndicationFeed 类和 Argotic 是最好的选择。

如果性能是一个问题，SyndicationFeed 类会好得多。我在我的硬件上对它进行了基准测试，它比 Argotic 快了大约 9 倍。

我在 SyndicationFeed 类中遇到的问题是它能够成功解析来自 'net. 它经常因 XmlException 而失败。

对于我的用途，我坚持使用 Argotic。毕竟，它是开源的，所以我可以随时根据需要进行更改。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-27T14:05:38.440

我建议你用这个

> [RSS.NET](http://www.rssdotnet.com/)是一个用于 RSS 提要的开源 .NET 类库。它为解析和编写 RSS 提要提供了可重用的对象模型。它与 RSS 版本 0.90、0.91、0.92 和 2.0.1 完全兼容，实现了所有结构。

由于标准联合供稿不支持其他版本的 rss。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T01:25:58.873

您需要使用 RSS XML 规范：[http ://cyber.law.harvard.edu/rss/rss.html](http://cyber.law.harvard.edu/rss/rss.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T01:27:30.460

如果您在不使用任何库的情况下编写功能齐全的阅读器，也请认为有[ATOM](http://www.atomenabled.org/developers/syndication/atom-format-spec.php)提要需要解析。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T01:40:34.703

RSS 本身非常简单。只是一个频道的 XML 描述，以及该频道上的项目列表（可能带有附加到每个项目的文件）。跟踪更新有点棘手，但管理编码和发布时间/日期也很棘手。真正的噩梦是不同站点使用的 RSS 格式的所有不同“解释”。如果你真的在写一个提要阅读器，你可能想从解析 Atom 开始，因为它是一种更标准化的格式，并且可能会让你更快，并有一个很好的设计来分支到 RSS。但实际上，您应该只使用 RSS 解析库——最好是可用的最兼容的一个（但不要为 RSS 库付费；它们很常见）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T01:56:16.383

RSS 是一种 XML 方言，所以如果您了解 XML，就可以解决部分问题。如果您想开始您的项目，请考虑查看已经存在的开源项目：

[http://www.codeplex.com/site/search?projectSearchText=RSS%20Reader](http://www.codeplex.com/site/search?projectSearchText=RSS%20Reader)

CodePlex（上图）是一个很好的起点，因为大多数项目都使用 C#。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-05-27T14:01:07.030

考虑阅读[RSS Bandit](http://rssbandit.org/)的源代码，这是一个 C# Winforms（可能很快 WPF）RSS 阅读器。

您应该通过单步执行应用程序来获得一些好主意。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-04-16T09:04:24.453

我一直在使用 RSS 并发现使用 RssSyndication 类通常更容易解析 ATOM 提要。对于 RSS 2.0 规范，如果提要确实有效，那么从 URI 加载 XDocument 并根据需要解析数据同样容易。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-09-28T12:30:39.740

如果您不能使用`System.ServiceModel.Syndication.Syndicationfeed`，例如因为您使用的是 PCL（可移植类库）。我写了一篇：[FeedParserPCL](https://github.com/aloisdg/FeedParserPCL)。您可以在[NuGet](https://www.nuget.org/packages/FeedParserPCL/)上找到它。

# ruby-on-rails - 是否有一个库可以自动进行 CSS 精灵？

> ID：576273
> 
> 赞同：5
> 
> 时间：2009-02-23T01:23:11.877
> 
> 标签：ruby-on-rails, css, ruby, optimization

CSS Spriting 确实可以提高性能，但它并不是最容易阅读和维护的东西。是否有任何工具可以让我单独编码图像但将它们聚合起来并用正确的蒙太奇子集替换 HTML？

我特别考虑了一个 Ruby on Rails 插件，但如果有另一种语言的包，我很乐意移植它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T02:05:14.770

[智能精灵](http://smartsprites.osinski.name/)

尝试一下。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T19:54:49.177

我还没有尝试过，但 image_bundle 似乎是你想要的：

[http://github.com/bartt/image_bundle/tree/master](http://github.com/bartt/image_bundle/tree/master)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T06:46:44.487

image_bundle 仅适用于 RMagick。我正在尝试将其移植到图像科学。

# html - 是否可以在渲染之前加载整个网页？

> ID：576276
> 
> 赞同：4
> 
> 时间：2009-02-23T01:24:08.940
> 
> 标签：html, ajax

我有一个网页每隔几秒就会自动重新加载并显示不同的随机图像。但是，当它重新加载时，会有一秒钟的空白页，然后图像会慢慢加载。我想继续显示原始页面，直到下一页加载到浏览器的内存中，然后一次显示它，这样它看起来就像一个无缝的幻灯片。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-23T01:29:25.043

是唯一改变图像的东西吗？如果是这样，使用 jQuery 的循环插件之类的东西可能会更有效，而不是重新加载整个页面。

[http://malsup.com/jquery/cycle/](http://malsup.com/jquery/cycle/)

如果您使用 jQuery，这是所需的 JS -

假设这是您的 HTML：

```
<div class="pics"> 
    <img src="images/beach1.jpg" width="200" height="200" /> 
    <img src="images/beach2.jpg" width="200" height="200" /> 
    <img src="images/beach3.jpg" width="200" height="200" /> 
</div> 
```

这将是所需的 jQuery：

```
$(function(){
$('div.pics').cycle();
}); 
```

无需担心不同的浏览器 - 完整的跨浏览器兼容性。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T02:02:11.003

如果您只是更改图像，那么我建议根本不要重新加载页面，并使用一些 javascript 来更改图像。这可能是 jquery 循环插件为您所做的。

无论如何，这是一个简单的例子

```
<img id="myImage" src="http://someserver/1.jpg" />

<script language="javascript">
var imageList = ["2.jpg", "3.jpg", "4.jpg"];
var listIndex = 0;

function changeImage(){
    document.getElementById('myImage').src = imageList[listIndex++];
    if(listIndex > imageList.length)
        listIndex = 0; // cycle around again.

    setTimeout(changeImage, 5000);
};

setTimeout(changeImage, 5000);
</script> 
```

这将每 5 秒更改一次图像源。不幸的是，浏览器会逐步下载图像，因此在下载新图像时，您会得到几秒钟的“闪烁”（或者可能是空白）。

为了解决这个问题，您可以“预加载”图像。这是通过创建一个不显示在屏幕上的新临时图像来完成的。一旦该图像加载，您将真实图像设置为与“预加载”相同的源，因此浏览器会将图像从其缓存中拉出，它会立即出现。你会这样做：

```
<img id="myImage" src="http://someserver/1.jpg" />

<script language="javascript">
var imageList = ["2.jpg", "3.jpg", "4.jpg"];
var listIndex = 0;
var preloadImage = new Image();

// when the fake image finishes loading, change the real image
function changeImage(){
    document.getElementById('myImage').src = preloadImage.src;
    setTimeout(preChangeImage, 5000);
};  
preloadImage.onload = changeImage;

function preChangeImage(){
    // tell our fake image to change it's source
    preloadImage.src = imageList[listIndex++];
    if(listIndex > imageList.length)
        listIndex = 0; // cycle around again.
};

setTimeout(preChangeImage, 5000);
</script> 
```

这很复杂，但我会把它作为练习留给读者把所有的部分放在一起（并希望说“啊哈！”）:-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T01:29:39.677

如果你创建了两个在图像区域重叠的 div，你可以通过 AJAX 加载一个带有新图像的 div，隐藏当前 div 并显示一个带有新图像的 div，你不会有网页刷新导致“糟糕的过渡”。然后重复这个过程。

如果只有少量图像并且它们总是以相同的顺序显示，您可以简单地创建一个动画 GIF。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T02:21:31.017

回到黑暗的过去（2002 年），我通过一个不可见的 iframe 来处理这种情况。我将内容加载到其中，然后在 body.onload() 方法中将内容放在需要去的地方。

Pre-AJAX 是一个很好的解决方案。

我只是为了完整性而提到这一点。我不推荐它，但值得注意的是 Ajax 不是先决条件。

话虽如此，在您只是循环图像的情况下，使用 Ajax 或类似 jQuery 循环插件的东西来动态循环图像而不重新加载整个页面。

# vbscript - 远程更改 IIS6 网站目录

> ID：576280
> 
> 赞同：1
> 
> 时间：2009-02-23T01:26:28.297
> 
> 标签：vbscript, iis-6, windows-server-2003, nant, teamcity

一、之前的情况：我们这个项目有一个一键构建脚本。它与 TFS Deployer + PowerShell + VB 脚本拼凑在一起。TFS Deployer 位于生产机器上，将新的网站文件复制到一个全新的目录中，然后调用将 IIS 网站更改为新目录的 VB 脚本。

现在，我正在让团队远离 TFS/MSBuild 的恐惧。我在专用构建服务器上有一个 TeamCity 构建代理。一个简单的 NANT 脚本通过共享文件夹将构建工件从构建服务器部署到生产服务器。简单、快速、有效。

但是，我还没有找到一种方法 a) 远程运行 VB 脚本 b) 使用不同的机制远程更新 IIS 站点（在 1-click 构建中以编程方式）。Windows 服务器 2003/IIS6。有任何想法吗？

更新：我通过创建另一个远程调用我通过 WMI 拥有的旧 vbs 的 vbs 解决了这个问题。谢谢大家！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T01:42:34.637

您能否将 vbscript 文件更改为同一服务器上不同网站中的 ASP 文件？这将允许您远程调用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T01:45:13.647

如果我要朝任何方向前进，我会考虑设置一个 WMI 脚本来完成这项工作，然后在相关服务器上对其进行配置。我将不得不考虑如何轻松地将其包含到您的自动构建中。我个人还没有与 TeamCity 合作过，尽管我参加了有关它如何工作的会议。

WMI 也可能能够运行脚本，并充当一种服务前端，因此您可以重用您已经花费的精力。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-24T16:59:37.343

我们使用[NAntContrib 的](http://nantcontrib.sourceforge.net/) [mkiisdir](http://nantcontrib.sourceforge.net/release/latest/help/tasks/mkiisdir.html)任务在远程机器上创建/修改虚拟目录。

```
<mkiisdir iisserver="Staging" dirpath="c:\temp" vdirname="Temp" /> 
```

这应该创建（如果 vdir 不存在）或更改位置（如果 vdir 已经存在）。

通常，似乎最干净的方法是首先使用[deliisdir](http://nantcontrib.sourceforge.net/release/latest/help/tasks/deliisdir.html)任务删除 vdir，然后再创建。

```
<deliisdir vdirname="Temp" failonerror="false" />
<mkiisdir dirpath="c:\temp" vdirname="Temp" accessread="true" accesswrite="false" accessscript="true" enabledirbrowsing="false" authntlm="true" authbasic="false" authanonymous="false" appcreate="Pooled" /> 
```

快乐编码！

# java - 什么是数字促销？

> ID：576302
> 
> 赞同：13
> 
> 时间：2009-02-23T01:42:44.310
> 
> 标签：java

谁能告诉我什么是数字促销？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-23T01:44:45.053

数值提升是将较小的数值类型转换为较大的数值类型，以便可以进行整数和浮点运算。在数值提升中，byte、char 和 short 值被转换为 int 值。如有必要，int 值也会转换为 long 值。根据需要，long 和 float 值转换为 double 值。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2017-02-28T13:40:54.643

**数值提升规则**

1.  如果两个值具有不同的数据类型，Java 会自动将其中一个值提升为两种数据类型中较大的一个。

2.  如果其中一个值是整数而另一个是浮点数，Java 会自动将整数值提升为浮点值的数据类型。

3.  较小的数据类型（即 byte、short 和 char）在与 Java 二进制算术运算符一起使用时首先被提升为 int，即使两个操作数都不是 int。

4.  在发生所有提升并且操作数具有相同的数据类型之后，结果值将具有与其提升的操作数相同的数据类型

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T01:54:02.037

数值提升是将操作数（至少涉及的数字之一）转换为通用类型。

例如：

```
int i = 10;
double d1 = 2.5;
double d2 = d1 * i; 
```

在这种情况下，i 被提升为 double，因此可以执行计算。在某些方面，您可以认为这类似于装箱，但装箱涉及从结构体移动到对象（从堆栈到堆）。但是，使用类比确实可以理解积分值被制成浮点以执行计算的事实。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T01:48:18.227

[如果你看这里](http://docs.oracle.com/javase/specs/jls/se8/html/jls-5.html)，你会看到以下引用：

> 数值提升（第 5.6 节）将数值运算符的操作数变为通用类型，以便可以执行操作。

他们[引用了本节](http://docs.oracle.com/javase/specs/jls/se8/html/jls-5.html#jls-5.6)，并在其中给出了各种示例。典型的例子是整数乘以浮点数。整数被提升为浮点数，因此相乘的结果是浮点数。

# .net - 消息队列 Windows 服务

> ID：576303
> 
> 赞同：1
> 
> 时间：2009-02-23T01:42:55.713
> 
> 标签：.net, msmq

我希望在 .Net 2.0 中编写一个侦听和处理消息队列 (MSMQ) 的 Windows 服务。

与其重新发明轮子，有人可以发布一个最佳方法的例子吗？它一次只需要处理一件事情，而不是并行处理（例如线程）。

基本上我希望它轮询队列，如果那里有任何东西，处理它，将它从队列中取出并重复。我也想以系统高效的方式做到这一点。

感谢您的任何建议！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T01:47:34.127

查看[http://msdn.microsoft.com/en-us/library/ms751514.aspx](http://msdn.microsoft.com/en-us/library/ms751514.aspx)上的 WCF 示例。

**编辑：**请注意，我的答案是在使用 .Net 2.0 进行编辑之前给出的。我仍然认为 WCF 是要走的路，但它至少需要 .NET 3.0。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T02:15:48.490

有几种不同的方法可以完成上述操作。我建议在消息队列上设置一个事件，以便在消息可用时通知您，而不是轮询它。

使用消息队列的简单示例是[http://www.codeproject.com/KB/cs/mgpmyqueue.aspx](http://www.codeproject.com/KB/cs/mgpmyqueue.aspx)，附加事件等的 MSDN 文档可以在 [http://msdn.microsoft.com/en-us/找到库/system.messaging.messagequeue_events.aspx](http://msdn.microsoft.com/en-us/library/system.messaging.messagequeue_events.aspx)

[此处](http://msdn.microsoft.com/en-us/library/system.messaging.messagequeue.receivecompleted.aspx)的 Microsoft 示例：

```
 ....
           // Create an instance of MessageQueue. Set its formatter.
           MessageQueue myQueue = new MessageQueue(".\\myQueue");
            myQueue.Formatter = new XmlMessageFormatter(new Type[]
                {typeof(String)});

            // Add an event handler for the ReceiveCompleted event.
            myQueue.ReceiveCompleted += new 
                ReceiveCompletedEventHandler(MyReceiveCompleted);

            // Begin the asynchronous receive operation.
            myQueue.BeginReceive();
            ....

        private static void MyReceiveCompleted(Object source, 
            ReceiveCompletedEventArgs asyncResult)
        {
            // Connect to the queue.
            MessageQueue mq = (MessageQueue)source;

            // End the asynchronous Receive operation.
            Message m = mq.EndReceive(asyncResult.AsyncResult);

            // Display message information on the screen.
            Console.WriteLine("Message: " + (string)m.Body);

            // Restart the asynchronous Receive operation.
            mq.BeginReceive();

            return; 
        } 
```

# c# - 在 C# 中自定义反序列化示例？

> ID：576304
> 
> 赞同：2
> 
> 时间：2009-02-23T01:44:11.170
> 
> 标签：c#, xml, serialization

我正在寻找一个示例，它可以让我将一个以 UTF-8 编码的 XML 流反序列化为一个类的字段。更具体地说，我有一堂课，

```
class Foo
{
    string abc;
    byte[] bcd;
} 
```

和 abc 映射到 XML 元素“Abc”，bcd 映射到 XML 元素“Bcd”，我想获取 bcd 的流并检索字节（直接从相关元素“Bcd”的 XML 流中）手动操作/在自定义方法。

我正在寻找一个样本，但失败了，谁能帮我指出一个相关的样本或写一些伪代码？

编辑：XML 是来自服务器的 SOAP 响应，在响应中有一个响应 XML 元素（我的示例中的元素 Bcd），它由服务器端的 UTF-8 编码，但由于 Http Web 服务将在客户端使用 base64，所以每次我在客户端收到这样的“字节”时，自动生成的 Web 服务代理都会抛出异常，表明 base64 编码中的 XML 元素无效。所以，我正在考虑如何使用 base64 编码覆盖默认值来解码字节，这就是我问这个问题的原因。如果有一种方法可以接受流或类似的东西代表相关响应元素的在线字节（我的示例中为 Bcd）并让我进行操作，那就太好了！

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T07:24:29.620

`IXmlSerializable`是一种选择（但不是很有趣），但*感觉*在这种情况下，属性提供了大部分想要的东西，而无需额外的工作：

```
[Serializable]
public class Foo
{
    public string Abc {get;set;}
    private byte[] bcd;
    public byte[] Bcd {
        get {return bcd;}
        set {/* your code (with `value`) here */ }
    }
} 
```

重新电汇格式（base64 等）；你试过通过 xsd.exe 运行它吗？它可能会让您感到惊讶并且做对了……但是是的；在`IXmlSerializable`你里面会有你的选择`ReadContentAsBase64`，`ReadContentAsBinHex`等等。但它很丑；类似的东西（对于一个**简单**的版本）：

```
[Serializable]
public class Foo : IXmlSerializable
{
    public Foo() { }
    public Foo(string abc, byte[] bcd)
    {
        Abc = abc;
        Bcd = bcd;
    }
    public string Abc { get; private set; }
    public byte[] Bcd { get; private set; }

    XmlSchema IXmlSerializable.GetSchema()
    {
        return null;
    }

    void IXmlSerializable.WriteXml(System.Xml.XmlWriter writer)
    {
        if (Abc != null)
        {
            writer.WriteElementString("Abc", Abc);
        }
        if (Bcd != null)
        {
            writer.WriteStartElement("Bcd");
            writer.WriteBase64(Bcd, 0, Bcd.Length);
            writer.WriteEndElement();
        }
    }
    void IXmlSerializable.ReadXml(System.Xml.XmlReader reader)
    {
        reader.ReadStartElement();
        reader.ReadStartElement("Abc");
        Abc = reader.ReadString();
        reader.ReadEndElement();
        reader.ReadStartElement("Bcd");
        MemoryStream ms = null;
        byte[] buffer = new byte[256];
        int bytesRead;
        while ((bytesRead = reader.ReadContentAsBase64(
            buffer, 0, buffer.Length)) > 0)
        {
            if (ms == null) ms = new MemoryStream(bytesRead);
            ms.Write(buffer, 0, bytesRead);
        }
        if (ms != null) Bcd = ms.ToArray();
        reader.ReadEndElement(); 
    }
} 
```

# javascript - 重置输入控件的边框颜色 (HTML/Javascript)

> ID：576319
> 
> 赞同：23
> 
> 时间：2009-02-23T01:54:08.277
> 
> 标签：javascript, html, dom, border, validation

有谁知道如何在使用 javascript 修改输入控件后重置它的边框颜色？通过突出显示其中包含不正确或无效数据的字段等来进行验证。

例如更改边框：

```
document.getElementById('myinput').style.border = '1px solid red'; 
```

如何重置？下一行只是完全删除了边框......

```
document.getElementById('myinput').style.border = ''; 
```

如果我将边框颜色重新设置为特定颜色（例如黑色或灰色等），它在某些浏览器/操作系统中可能看起来很奇怪，这种“主题”控件...

多谢！

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-23T01:59:32.117

不要通过设置样式属性来做到这一点。通过使用 CSS 类来做到这一点。我还建议使用 Javascript 库来处理这个问题。它只是使代码更干净。

删除 CSS 属性是有问题的，因为您并不总是知道应该将它们设置回什么。添加和删​​除类只是...有效。

每个元素可以有多个类，所以真的没有理由反对这样做（恕我直言）。

我习惯了 jQuery，所以我的例子就是这样。

错误的方法：

```
$("#myinput").css("border", "1px solid red"); 
```

正确的方法：

```
<style type="text/css">
.redborder { border: 1px solid red; }
</style>

<script type="text/javascript">
$("#myinput").addClass("redborder");
$("#myinput").removeClass("redborder");
$("#myinput").toggleClass("redborder");
</script> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-11-13T22:33:00.953

这对我有用：

```
document.getElementById('myinput').style.removeProperty('border'); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T02:01:36.900

你只是想让边界消失吗？我不这么认为，正如你所说的那样，事实并非如此。

“重置”的正确方法是设置为默认值。我不确定默认值是什么，但我猜想'1px black'或类似的东西。

我通常在各种应用程序中使用这种技术。当我不知道默认值时，我将设置我自己的“默认值”，以便我可以重复它。对于网页，我最喜欢的技术之一是设置控件的背景颜色，而不是边框​​。它非常明显，您可以选择更柔和的颜色并且仍然具有影响力。在这种情况下，很容易将背景设置回白色，这是默认设置。

# c++ - 在 GCC 3.3 下使用 operator() 编译 Boost 中的问题

> ID：576325
> 
> 赞同：0
> 
> 时间：2009-02-23T02:00:18.963
> 
> 标签：c++, gcc, boost, random

我有以下片段：

```
#include <boost/random/lognormal_distribution.hpp>
#include <boost/random/lagged_fibonacci.hpp> 

int main() {

  const double mean  = 0.0;
  const double sigma = 1.0;

  boost::lognormal_distribution<double> lognorm_dist(mean, sigma);
  boost::lagged_fibonacci44497 engine;

  // the following line give error in GCC 3.3
  const double value = lognorm_dist.operator() <boost::lagged_fibonacci44497>((engine)); 

} 
```

它编译得很好

```
i686-apple-darwin9-g++-4.0.1 (GCC) 4.0.1 (Apple Inc. build 5465) 
```

但在：

```
g++ (GCC) 3.3.3 (SuSE Linux) 
```

它给出了以下错误：

```
Mycode.cc:10:error: `operator()' not defined 
```

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T02:07:14.437

为什么不只是`lognorm_dist( engine );`？提供“类似函数”的语法是 operator() 的重点。也就是说，`lognorm_dist.template operator() <boost::lagged_fibonacci44497>((engine))`如果我没记错的话，应该可以解决你的编译问题。

# windows - 我想实现一个文件资源管理器，如何读取文件的图标并显示它们？

> ID：576341
> 
> 赞同：1
> 
> 时间：2009-02-23T02:12:38.370
> 
> 标签：windows, icons, windows-explorer

我想实现一个文件资源管理器，它与普通的文件资源管理器不同，它首先扫描文件系统并将信息存储到数据库中，它们从数据库中读取文件系统信息并显示它们，我需要存储文件的图标，我怎样才能做到这一点？是否有任何 Windows API？非常感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T02:23:06.770

[SHGetFileInfo](http://msdn.microsoft.com/en-us/library/bb762179(VS.85).aspx)可以获得文件图标的句柄。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T02:24:46.783

您需要使用[SHGetFileInfo](http://msdn.microsoft.com/en-us/library/bb762179(VS.85).aspx)。[这](http://www.pinvoke.net/default.aspx/shell32.SHGetFileInfo)看起来是 .NET 的一个很好的例子。

# javascript - 如何从 Firefox 扩展对 JavaScript 中的字符串进行 HTML 编码

> ID：576343
> 
> 赞同：2
> 
> 时间：2009-02-23T02:15:44.980
> 
> 标签：javascript, firefox, xpcom, html-encode

所以我知道我可以像这样编写自己的 HTML 编码函数：

```
function getHTMLEncode(t) {
    return t.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
} 
```

但我想知道是否有任何可用于 XPCOM 组件的本**机工具。**我正在编写一个组件，而不是一个覆盖，所以我没有一个 DOM 来做一些技巧，比如创建一个 DOM 元素并设置它的`innerHTML`.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-26T04:34:08.733

答案似乎是否定的——Firefox 中没有内置函数可以对来自 XPCOM 组件的字符串进行 HTML 编码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-01T19:14:32.587

从理论上讲，您可以创建一个 XML 文档，使用它来创建一个 HTML div，将其文本内容设置为您的未编码字符串并读取其 innerHTML。请注意，这仅编码 lt、gt 和 amp 字符，而不是 quot。

# python - Django 项目结构，推荐的结构以在应用程序之间共享扩展的身份验证“用户”模型？

> ID：576345
> 
> 赞同：1
> 
> 时间：2009-02-23T02:17:32.573
> 
> 标签：python, django, django-models, django-project-architect

我想知道当用户模型扩展/子类化并且此结果用户模型在多个应用程序之间共享和使用时，常见的项目/应用程序结构是什么。

我想在多个应用程序中引用相同的用户模型。我还没有构建登录界面，所以我不确定它应该如何组合在一起。

想到以下几点：

```
project.loginapp.app1
project.loginapp.app2 
```

这种情况有一个共同的模式吗？登录最好由“登录应用程序”处理吗？

类似于这个问题，但更具体。 [django 应用程序配置](https://stackoverflow.com/questions/464010/django-application-configuration)

**更新**

澄清了我上面的用例。我想将字段（扩展或子类？）添加到现有的身份验证用户模型。然后在多个应用程序中引用该模型。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-23T02:27:09.303

你为什么要扩展用户？请澄清。

如果您要添加有关用户的更多信息，则无需滚动您自己的用户和身份验证系统。Django 的版本非常可靠。用户管理位于 django.contrib.auth。

如果需要自定义与用户一起存储的信息，首先定义一个模型如

```
class Profile(models.Model):
    ...
    user = models.ForeignKey("django.contrib.auth.models.User", unique=True) 
```

然后设置

```
AUTH_PROFILE_MODULE = "appname.profile" 
```

在你的 settings.py

设置它的好处是允许您在视图中使用这样的代码：

```
def my_view(request):
    profile = request.user.get_profile()
    etc... 
```

如果您尝试为用户提供更多身份验证方式，则可以添加身份验证后端。扩展或重新实现 django.contrib.auth.backends.ModelBackend 并在 settings.py 中将其设置为您的 AUTHENTICATION_BACKENDS。

If you want to make use of a different permissions or groups concept than is provided by django, there's nothing that will stop you. Django makes use of those two concepts only in django.contrib.admin (That I know of), and you are free to use some other concept for those topics as you see fit.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T02:22:59.673

您应该首先检查 contrib.auth 模块是否满足您的需求，因此您不必重新发明轮子：

[http://docs.djangoproject.com/en/dev/topics/auth/#topics-auth](http://docs.djangoproject.com/en/dev/topics/auth/#topics-auth)

编辑：

检查这个在创建新用户后创建用户配置文件的片段。

```
def create_user_profile_handler(sender, instance, created, **kwargs):
    if not created: return

    user_profile = UserProfile.objects.create(user=instance)
    user_profile.save()

post_save.connect(create_user_profile_handler, sender=User) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T02:25:52.473

我认为“项目/应用程序”名称选择不当。它更像是“站点/模块”。例如，一个应用程序在没有视图的情况下可能非常有用。

查看YouTube 上的[2008 DjangoCon 演讲，尤其是关于](http://www.youtube.com/view_play_list?p=D415FAF806EC47A1)[可重用应用程序](http://www.youtube.com/watch?v=A-S0tqpPga4&feature=PlayList&p=D415FAF806EC47A1&index=14)的演讲，它会让你对如何构建项目有完全不同的看法。

# asp.net - sql 2005中的数据迁移

> ID：576346
> 
> 赞同：1
> 
> 时间：2009-02-23T02:17:57.937
> 
> 标签：asp.net, sql, vb.net, sql-server-2005

在我的 Live sql 数据库中，我必须将日期值从（日期、月份、年份）更改为日期。现在有 100 条记录，日期为日期、月份、年份（3 个字段）。如果我直接更改为日期字段，这 100 条记录的第 3 个字段中的所有数据将自动更改为默认日期，原始日期将消失。我应该怎么做才能安全地迁移我的所有数据

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T02:21:25.013

添加新列 (ALTER TABLE)，填充它，并在准备好时删除旧列。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T02:29:44.150

做好备份。添加新列，允许值为空。使用从现有列构建的月/日/年日期更新新列。更改新的日期列以禁止空值（如果适用）。更新您的代码以使用新列而不是旧列，然后删除旧列。如果无法更新所有代码，则可能需要添加触发器以保持新旧列同步。

# internet-explorer - IE 挂起 100% CPU / 得到堆栈跟踪

> ID：576349
> 
> 赞同：3
> 
> 时间：2009-02-23T02:19:35.890
> 
> 标签：internet-explorer, windbg, stack-trace

我遇到了 IE7 挂起访问我的网络应用程序的情况。根据[George V. Reilly的出色](https://stackoverflow.com/users/6364/george-v-reilly)[建议](https://stackoverflow.com/questions/574423/ie-hanging-using-100-of-the-cpu/574595#574595)，我安装了 WinDbg 来下载 IE 符号，设置 Process Explorer 以使用这些符号，然后使用 Process Explorer 获取挂起线程的堆栈跟踪。

我在下面粘贴了堆栈跟踪。更熟悉 IE 内部的人是否知道正在发生的事情，或者对如何进行此操作的建议？

```
ntkrnlpa.exe!KiUnexpectedInterrupt+0x8d
ntkrnlpa.exe!PsDereferencePrimaryToken+0x362
ntkrnlpa.exe!KiDeliverApc+0xb3
ntkrnlpa.exe!KiDispatchInterrupt+0x5a2
ntkrnlpa.exe!SeOpenObjectAuditAlarm+0x1ce
mshtml.dll!CTreePos::GetCp+0x5a
mshtml.dll!CFlowLayout::GetNestedElementCch+0x7d
mshtml.dll!CDisplay::FormattingNodeForLine+0x1d5
mshtml.dll!CFlowLayout::LineStart+0xdb
mshtml.dll!CDisplayPointer::GetLineStart+0x44
mshtml.dll!CDisplayPointer::IsAtBOL+0x4e
mshtmled.dll!CCaretTracker::PositionCaretAt+0xf9
mshtmled.dll!CCaretTracker::Init2+0x54
mshtmled.dll!CSelectionManager::SetCurrentTracker+0x26
mshtmled.dll!CSelectionManager::CreateTrackerForContext+0x1c0
mshtmled.dll!CSelectionManager::SetEditContext+0x8b
mshtmled.dll!CSelectionManager::SetEditContextFromElement+0x2ed
mshtmled.dll!CSelectionManager::EnsureEditContextClick+0x343
mshtmled.dll!CSelectionManager::HandleEvent+0xb9
mshtmled.dll!CHTMLEditor::PostHandleEvent+0x89
mshtml.dll!CDoc::HandleSelectionMessage+0x1e0
mshtml.dll!CDoc::PumpMessage+0xb69
mshtml.dll!CDoc::OnMouseMessage+0x3d7
mshtml.dll!CDoc::OnWindowMessage+0x748
mshtml.dll!CServer::WndProc+0x78
USER32.dll!InternalCallWinProc+0x28
USER32.dll!UserCallWinProcCheckWow+0x150
USER32.dll!CallWindowProcAorW+0x98
USER32.dll!CallWindowProcW+0x1b
IEDevToolbar.dll!DllUnregisterServer+0xe21d
USER32.dll!InternalCallWinProc+0x28
USER32.dll!UserCallWinProcCheckWow+0x150
USER32.dll!DispatchMessageWorker+0x306
USER32.dll!DispatchMessageW+0xf
IEFRAME.dll!CTabWindow::_TabWindowThreadProc+0x189
kernel32.dll!BaseThreadStart+0x37 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T03:16:29.263

Based on the stack trace, it is in the middle of altering the DOM. As commented on your previous post, IE is extremely inefficient when doing both reads and writes on the DOM (when compared to Firefox and Chrome.)

The performance problems can be tackled by reducing and optimize both the reading and the writing of the DOM by:

1.  navigating the DOM using simple DOM properties and methods whenever possible (`Document.getElementById`, `DomElement.parentNode`, `DomElement.childNodes[]`, `DomElement.nextSibling`, etc.) instead of the XPATH (CSS) selector methods (`DomElement.querySelector`)
    *   this is because **`querySelector` behaves O(N) under IE**, where N is the size of the *entire DOM* - that is, you will pay the penalty of traversing the entire DOM even if you call `querySelector` on a leaf node that has no children!
    *   if you trigger one or more `querySelector` calls for each element in a considerable subset of the DOM, you are essentially paying O(N^2) penalty
    *   note that YUI's `YAHOO.util.Selector.query`, Prototype's `element.down`, `element.up`, `element.select` all use the `querySelector` call internally
2.  altering the UI behavior, if possible, to skip or defer as much DOM traversal and modification as possible
    *   present as little information at a time; force the user to click (e.g. on expand links etc.) in order for you to proceed with additional processing/modifications
3.  switch away from Javascript, to Flash or Java.

Given that you are using YUI you may not have a lot of latitude as far as option 1 goes, and I can imagine that option 3 is almost certainly a non-option for you. Which unfortunately leaves option 2.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T02:24:35.457

它挂在所有浏览器中还是只挂在 IE7 中？

对我来说唯一突出的是“IEDevToolbar.dll！”

另外...可能是您的应用程序做了不应该做的事情。

# sql-server - SQL Server 文件和文件组

> ID：576358
> 
> 赞同：4
> 
> 时间：2009-02-23T02:25:18.170
> 
> 标签：sql-server, tsql, filegroup

我想不出为什么我们需要在一个文件组中有多个文件的任何原因。我之所以这么想的原因是我们可以从T-SQL（最终用户）级别控制文件组，但不能从T-SQL（最终用户）级别控制文件组的各个文件。为什么仍然需要文件的任何意见或想法？

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T10:53:29.320

每个文件组有多个文件仅出于以下原因有用：

1.  出于性能原因，将磁盘 I/O 负载分布在多个磁盘上。即在无法使用附加磁盘重新配置 RAID 配置或没有 RAID 的情况下。
2.  如果您有一个 VLDB 并且出于后勤原因不希望处理非常大的单个文件。

有一个“都市传说”，SQL Server 每个文件只使用 1 个线程，因此文件的数量应该与 CPU 的数量相匹配。然而，这是错误的，正如[微软在此处所讨论的那样](http://blogs.msdn.com/psssql/archive/2007/02/21/sql-server-urban-legends-discussed.aspx)。

从历史上看，还有另一个原因。信不信由你，在 SQL Server 4.2 到 7 的日子里，sql server 有时安装在 FAT32 文件系统上，它有 4 gig 文件的限制。将文件链接在一起（在我们现在称为文件组中）的能力是一种解决文件系统限制并允许在基于 FAT 的安装上大于 4gigs 的 DB 的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-04-29T10:41:41.533

旧线程，我知道，但这对我来说是有意义的：过去 Windows 文件系统 FAT32 中的最大文件大小为 2GB。如果你的数据库文件变大了，你就完蛋了（曾经用 MS Access-Database 发生在我身上）。因此他们允许定义最大文件大小（例如：2GB）并且您可以添加更多文件。如果您的数据库增长并且超过了最大大小，则下一个文件将被填充，直到该文件已满，依此类推。所有这些文件都可以作为一个文件组来寻址。您可以通过选择文件组来定义表数据位置，但是您看不到 tabledata 将在该文件组中的哪个文件中结束。您所知道的是，您的表数据可以最终出现在文件组中的任何文件中。通过这种“拆分”，您的文件系统永远不会看到大于最大文件大小的文件（此处：2GB）尽管您的数据库中的表可以大很多倍。今天，设置多个文件对于将大型数据文件“切碎”成较小的部分以进行基于文件的备份很有用（询问您的网络管理员他们想要什么，因为在备份期间将大型（如 1TB）文件写入分区需要很长时间，即使在快速RAID。所有其他写入操作都需要等待很长时间。较短的等待间隔让高优先级的操作更快地执行）。如果您关心同一个表的并行访问，请考虑水平分区，如 所有其他写入操作都需要等待很长时间。更短的等待间隔让高优先级的操作更快地执行）。如果您关心同一个表的并行访问，请考虑水平分区，如 所有其他写入操作都需要等待很长时间。更短的等待间隔让高优先级的操作更快地执行）。如果您关心同一个表的并行访问，请考虑水平分区，如[http://msdn.microsoft.com/en-us/library/ms188730%28v=sql.105%29.aspx](http://msdn.microsoft.com/en-us/library/ms188730%28v=sql.105%29.aspx)。这允许将表的数据分布在不同的硬盘上，例如“磁盘 R: 上的所有 1 月销售额”、“磁盘 S: 上的 2 月所有销售额”，而无需创建单独的表。在对表进行分区的过程中，您可以定义哪个部分应该进入哪个文件组。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T02:52:07.230

[我可以提供很长的解释，但 MSDN在这里](http://msdn.microsoft.com/en-us/library/aa174545(SQL.80).aspx)做得很好。可能您特别不需要在一个文件组中拥有多个文件，但并非所有人都如此。

# iphone - 具有可变内容的可滚动 iPhone“详细视图”的最佳布局是什么？

> ID：576361
> 
> 赞同：5
> 
> 时间：2009-02-23T02:27:09.070
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch, xcode

我正在构建一个基于导航控制器的 iPhone 应用程序，并且很好奇如何为我的应用程序构建详细视图。使我的努力复杂化的部分是：我应该使用哪些 UI 元素/层次结构来创建高度可变但可滚动的详细视图？

我的目标的一个很好的例子是像[移动 App Store 详细视图](http://img7.imageshack.us/img7/296/appstoreapp.png)这样的安排。标题、描述、屏幕截图等之间的水平划分让我相信这是一个变相的表格视图，但这只是一个猜测。

目前，我使用 UIScrollView 作为我的详细视图，但由于我无法确定传入内容的确切长度，我的描述视图最终会出现未使用的空间或截断的文本。是否有一些元素最适合以“块状”格式（如示例）显示此可变高度内容，同时仍保持整体视图滚动能力？

提前感谢你的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T17:40:26.673

如果您希望能够轻松地格式化复杂的内容，您可以使用 UIWebView。我基本上做的是创建一个 HTML 模板并将其添加为资源。在运行时，我加载这个 HTML 文档的内容并进行字符串替换以添加我想要的内容。在 HTML 中，我放置占位符，例如

```
<div><!-- ARTICLE_TITLE --></div> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T02:33:22.177

我不认为 App Store 详细视图是 UITableView。事实上，我很确定它是 UIScrollView 的子类。

要确定内容的大小，可以使用 NSString 的 sizeWithFont 方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-25T05:41:25.467

有点晚了，但仍然相关：App Store 几周前崩溃了，App Store 的“精选”选项卡很明显是没有应用 CSS 的 HTML。因此，它实际上是一个 UIWebView，或以某种方式显示的 Web 内容。

iTunes 应用程序的触地行为，虽然看起来非常相似，但表现不同，以更原生的方式。我不相信这个应用程序是以相同的方式实现的。

# asp.net - 如何将我的 ASP.NET 页面导出到 Excel？

> ID：576365
> 
> 赞同：0
> 
> 时间：2009-02-23T02:30:03.947
> 
> 标签：asp.net, vb.net, sql-server-2005

如何将我的 webapp 中的数据从 ASP.NET (VB.NET,SQL 2005) 导出到 Excel 工作表？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T02:34:05.263

更改 ASP.Net 页面的内容类型

```
Response.ContentType = "application/ms-excel" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T03:02:36.630

我最受欢迎的博客之一是如何使用 Excel XML 标记（**这不是 OpenXML，它是标准的 Excel XML**）从 .NET 代码生成 Excel 文档 - [http://www.aaron-powell.com/linq-to -xml 到 excel](http://www.aaron-powell.com/linq-to-xml-to-excel)

我还链接到使用 VB 9 的更简单方法。

尽管这是 .NET 3.5 代码，但可以在 .NET 2.0 中使用 XmlDocument 轻松完成并以这种方式创建节点。

然后只需设置正确的响应标头并在响应中流回。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T17:45:42.793

如果您可以在 GridView 控件中显示您的数据，它本身就支持“右键单击-->导出到 Excel”，而无需编写任何代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T03:05:56.090

SpreadsheetGear for .NET 可以做到。[您可以在此页面](http://www.spreadsheetgear.com/support/samples/excel.aspx)上找到一堆带有 C# 和 VB.NET 源代码的实时 ASP.NET 示例。

免责声明：我拥有 SpreadsheetGear LLC

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T03:15:05.727

I use almost the same exact code as CodeKiwi. I would use that if you have a DataTable and want to stream it to the client browser.

If you want a file, you could also do a simple loop through each row/column, create a CSV file and I guess provide a link to the client - you can use a file extension of CSV or XLS. Or if you stream the resulting file to the client it will prompt them if they want to open or save it to disk.

The interops are (well were last time I tried them) great for small datasets, but didn't scale well - horrifically slow for larger datasets.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T02:41:17.833

SQL Server 报告服务是将数据从应用程序导出到 Excel 的最佳方式。

如果您无权访问/不想使用报告服务，具体取决于您想要提取/格式化的数据，可能使用 CSV 结构而不是 Excel 可能是最简单的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T02:41:36.197

使用 Microsoft.Office.Interop.Excel dll 使用您的数据创建 excel 文件，然后使用 Hunter Daley 的下载方法提供下载文件的链接...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T02:45:43.893

作为一般解决方案，您可能需要考虑编写处理程序 (ashx) 以进行导出 - 并传递查询参数以重新创建查询以生成数据或传递标识符以从缓存中获取数据（如果已缓存）。根据 CSV 是否足以用于 Excel 导出，您可以只格式化数据并将其发送回，将 ContentType 设置为 @Hunter 建议的或使用主互操作程序集（这将需要服务器上的 Excel）来构建真正的 Excel 电子表格和将其序列化为响应流。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T02:46:51.550

我更喜欢使用 OLEDB 连接字符串。

```
Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\Excel.xls;Extended Properties="Excel 8.0;HDR=Yes;IMEX=1"; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-23T02:49:12.167

不确定是否要导出页面，但如果您只想导出数据集或数据表

```
 HttpContext.Current.Response.Clear()
        HttpContext.Current.Response.AddHeader("content-disposition", String.Format("attachment; filename={0}", fileName))
        HttpContext.Current.Response.ContentType = "application/ms-excel"

        Dim sw As StringWriter = New StringWriter
        Dim htw As HtmlTextWriter = New HtmlTextWriter(sw)

        Dim table As Table = New Table

        table.RenderControl(htw)

        '  render the htmlwriter into the response
        HttpContext.Current.Response.Write(sw.ToString)
        HttpContext.Current.Response.End() 
```

# disk - 识别 CD

> ID：576372
> 
> 赞同：5
> 
> 时间：2009-02-23T02:35:36.943
> 
> 标签：disk, cd, identification

我希望能够确定 CD 驱动器中的音乐专辑 CD。例如，如果有人声称他们驱动器中的 CD 是 Eminem - The Eminem Show，我希望能够验证 CD 确实是 The Eminem Show。

有任何想法吗？我已经申请了 Gracenote 开发者许可证，但他们五天之内不会回复我。

另外，这是如何工作的？音乐光盘是否有一些 GUID 或其他唯一标识符进行编码？

最后，这是否可以通过数据 CD 实现，比如暗黑破坏神 II 安装光盘 1？如果是这样，您可以指出我的任何方向，以完成此任务？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T02:43:41.947

您可能想使用[libcddb 之](http://libcddb.sourceforge.net/)类的东西来获取/验证音乐 CD 信息。不知道有没有类似的程序盘数据库。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T02:44:53.770

您可能需要查看 Wikipedia[文章](http://en.wikipedia.org/wiki/Cddb)以了解 CDDB 的工作原理。然后您可以查看[libcddb](http://libcddb.sourceforge.net/)以在 C 中实现您想要的。源代码应该为您提供大量线索，以防 C 不是您选择的语言。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T02:47:41.830

对于音乐 CD，Gracenote 的工作原理是分析 CD 上每个曲目的实际波形数据。它这样做是一种格式中立的方式。[它在这里](http://www.gracenote.com/business_solutions/music_id/)谈论它。

我还推荐[last.fm](http://blog.last.fm/2008/03/25/fingerprinting-and-metadata-progress-report)、[MusicBrainz](http://musicbrainz.org/)和[discogs](http://www.discogs.com/help/api)。

# c# - 为什么 C# 没有词法嵌套函数？

> ID：576374
> 
> 赞同：12
> 
> 时间：2009-02-23T02:39:40.630
> 
> 标签：c#, scheme

为什么 C# 语言设计者可能不包含对此类内容的支持（来自[计算机程序的结构和解释](http://mitpress.mit.edu/sicp/)，第二版，第 30 页）：

```
/// <summary>Return the square root of x.</summary>
double sqrt(double x) {
  bool goodEnough(double guess) {
    return Math.Abs(square(guess) - x) < 0.001;
  }
  double improve(double guess) {
    return average(guess, x / guess);
  }
  double sqrtIter(double guess) {
    return goodEnough(guess) ? guess : sqrtIter(improve(guess));
  }
  sqrtIter(1.0);
} 
```

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-23T02:47:34.560

事实上，C# 正是如此。

```
double sqrt(double x) {
    var goodEnough = new Func<double, bool>(guess =>
        Math.Abs(square(guess) - x) < 0.001
    );
    var improve = new Func<double, double>(guess =>
        average(guess, x / guess)
    );
    var sqrtIter = default(Func<double, double>);
    sqrtIter = new Func<double, double>(guess =>
        goodEnough(guess) ? guess : sqrtIter(improve(guess))
    );
    return sqrtIter(1.0);
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-23T09:04:05.683

正如Justice 所说，您可以使用C# 3.5 和lambdas 来实现；如果你有 C# 2.0，你可以使用匿名函数，虽然它会不那么性感：

```
double sqrt(double x) {
    Func<double, bool> goodEnough = delegate(double guess) {
        return Math.Abs(square(guess) - x) < 0.001;
    };
    Func<double, double> improve = delegate(double guess) {
        return average(guess, x / guess);
    };
    Func<double, double> sqrtIter = null;
    sqrtIter = delegate(double guess) {
        return goodEnough(guess) ? guess : sqrtIter(improve(guess));
    };
    return sqrtIter(1.0);
} 
```

编辑：我忘了，Func 没有在 C# 2.0 中定义，所以你必须自己定义它：

```
 public delegate TResult Func<T, TResult>(T guess); 
```

# iis - 在设置 SSL 方面需要帮助

> ID：576382
> 
> 赞同：2
> 
> 时间：2009-02-23T02:44:41.913
> 
> 标签：iis, xhtml, ssl, https

新手IIS问题：

我想为托管在我的 IIS 6.0 服务器上的 XHTML 页面（不是 asp.net）设置 HTTPS 访问。到目前为止，我已经完成了以下工作：

在 IIS 管理器中，为特定文件夹设置以下内容：

*   需要安全通道 (SSL)
*   需要 128 位加密
*   忽略客户端证书

但是，当我尝试从 IE 8.0 访问该页面时，出现以下错误：“Internet Explorer 无法显示该页面”。

使用 SSL 和 TSL 的选项在 IE 设置中为 ON。Firefox 也出现同样的错误。

**除了上述之外，我还应该在 IIS 服务器上设置什么吗？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T02:49:15.600

您是否生成了[自签名服务器证书](http://www.somacon.com/p42.php)？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T18:26:52.960

[这](http://support.microsoft.com/kb/299875)是在 IIS 中设置 SSL 的官方说明。如果这是您想要的路线，您可以在[此处找到创建自签名证书的说明。](http://codeforeternity.com/blogs/technology/archive/2008/02/15/creating-self-signed-ssl-certificates-on-iis-6-0-and-windows-server-2003.aspx)

# asp.net-mvc - 在 asp.net mvc 中将项目从控制器添加到应用程序

> ID：576388
> 
> 赞同：1
> 
> 时间：2009-02-23T02:47:59.723
> 
> 标签：asp.net-mvc

从我的控制器中，我想为应用程序变量赋值，就像我为会话变量一样。

我以为我可以使用：

```
Application("MyValue") = "test" 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T03:00:36.430

```
HttpContext.Application["MyValue"] = test 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T02:49:51.217

如果您尝试使用它来将数据从控制器传递到视图，请使用 ViewData。

```
ViewData("MyValue") = "test" 
```

如果没有，请提供更多有关您要完成的任务的背景信息。

# c++ - 为什么 strlen() 似乎返回 在 VC++ 调试器中？

> ID：576396
> 
> 赞同：0
> 
> 时间：2009-02-23T02:54:28.363
> 
> 标签：c++, string, visual-c++, visual-c++-6

我有一个 C++ 类型的字符串`const char*`作为参数传递给 strlen，但它返回 void。

它就像

```
strlen(astruct.string); 
```

谢谢..

编辑：做了一些检查，

```
strlen("test"); 
```

仍然无效..为什么？

编辑：这是图片 [http://img14.imageshack.us/img14/1808/strlen.png](http://img14.imageshack.us/img14/1808/strlen.png)

抱歉之前不清楚。格式化不是很好。无论如何，Evan Teran 和 Vlad Romascanu 都解决了这个困惑。另请查看 Brian R. Bondy 的回答。

谢谢。随意关闭。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T03:19:22.407

你被 Visual Studio 6.0 的蹩脚调试器弄糊涂了。不要依赖这个。由于内联或类似的原因，它可能无法获得返回值。

将值打印出来以获得实际值。

编辑：另外，从您的示例来看，您似乎无论如何都不会存储 strlen 的结果。这也可能是调试器看不到返回值的原因。如果您不使用该值，编译器完全有可能认为它不需要实际执行 strlen 。

注意：在这一点上，没有任何理由**继续**使用 VC++ 6.0。它是一个古老的编译器和 IDE，是一个令人尴尬的糟糕 c++ 编译器。Visual c++ 编译器的较新版本是免费的（没有 IDE），请使用它们。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T03:11:57.107

strlen 不是返回类型 void，它是您的调试器没有给出正确的消息。

**为什么你的调试器显示无效？**

您正在使用的 strlen 的实现可能包含在 #define strlen someothername_strlen 周围。

调试器可能不正确支持#define 或函数上的一些其他修饰符。

您必须执行 iLen = strlen("test") 之类的操作，然后在手表中检查 iLen。

通常您可以调用手表中的函数。例如，尝试定义以下函数，然后在您的手表中调用它：

```
int testFunc(char*)
{
  return 5;
} 
```

结果，您可能会在手表中获得 5。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T03:00:02.423

参考您的屏幕截图：您的调试器正在显示`<void>`，`strlen(...)`实际上它应该显示错误。

您不能调用方法并在调试器监视中显示它们的结果。调试器将仅显示现有变量和数据。它不能按需调用任意方法，因为这些方法可以以代码作者和调试器都没有预料到的方式改变正在调试的程序的状态。

您可以做的是，在您的代码中，临时添加：

```
size_t tmp_len = strlen(struc.string); 
```

然后编译，并将 tmp_len 添加到手表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T02:57:53.693

strlen 返回一个整数，所以我假设您的意思是它返回“0”。

此外，您指定数据类型的方式，我无法确定它是 const char * 还是 const char **。如果是后者，那么您需要确保将 ** 取消引用为单个 *。

我的猜测是字符串以空字节开头，这就是它返回 0 的原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T03:45:19.427

在 C++ 中，函数总是返回一个它们被声明返回的类型的值。由于`strlen`函数声明看起来像这样：

```
size_t strlen(const char *); 
```

它唯一*可能*返回的是一个`size_t`. 编译器在编译时使用此信息来确定在调用函数时如何处理返回值。这里的要点是，如果`strlen`函数如上声明，它不能决定有时返回`void`而有时返回一个类型的值`size_t`。

这通常是 C++ 等静态类型语言的特征。在动态类型语言（Perl、Python、Ruby、PHP 等）中，函数可以决定在每次调用时返回任何类型的值。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-02-23T03:04:05.067

它不能返回无效。Void 是缺少返回值，所以你不能错误地返回它。

无论如何，您如何检查无效？Void 不是一个值。请证明你是如何变得无效的。是编译时还是运行时？

如果您确实有一个`strlen`声明了`void`返回类型的系统，请尽可能快地朝另一个方向运行。

# c# - 如何在 DataGridView - Windows 窗体中禁用选中复选框列？

> ID：576397
> 
> 赞同：1
> 
> 时间：2009-02-23T02:55:21.640
> 
> 标签：c#, datagridview

我在 DataGridView 中有一个复选框列，我想验证用户是否可以通过计算他们单击的复选框的数量来检查复选框，然后决定禁用检查。

有人可以指导我如何有效地做到这一点吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T03:19:42.797

Quick code sample:

```
public partial class DGVCheckBoxTesting : Form
{

    private const int MAX_CHECKS = 5;

    public DGVCheckBoxTesting()
    {
        InitializeComponent();
        this.dataGridView1.Columns.Add("IntColumn", "IntColumn");
        this.dataGridView1.Columns.Add(new DataGridViewCheckBoxColumn { Name = "BoolColumn" });
        for (int i = 0; i <= 10; i++)
        {
            this.dataGridView1.Rows.Add(i, false);
        }

        this.dataGridView1.CellContentClick += new DataGridViewCellEventHandler(dataGridView1_CellContentClick);
        this.dataGridView1.CellContentDoubleClick += new DataGridViewCellEventHandler(dataGridView1_CellContentDoubleClick);
    }

    private void dataGridView1_CellContentDoubleClick(object sender, DataGridViewCellEventArgs e)
    {
        this.ValidateCheckBoxState(e);
    }

    private void dataGridView1_CellContentClick(object sender, DataGridViewCellEventArgs e)
    {
        this.ValidateCheckBoxState(e);
    }

    private void ValidateCheckBoxState(DataGridViewCellEventArgs e)
    {
        if (e.ColumnIndex != 1) //bool column
        { return; }

        this.dataGridView1.EndEdit();
        bool value = (bool)this.dataGridView1.Rows[e.RowIndex].Cells[e.ColumnIndex].Value;
        int counter = 0;
        foreach (DataGridViewRow row in this.dataGridView1.Rows)
        {
            if (row.Cells[1].Value != null && (bool)row.Cells[1].Value)
            {
                counter++;
            }
        }

        if (counter > MAX_CHECKS)
        {
            this.dataGridView1.Rows[e.RowIndex].Cells[e.ColumnIndex].Value = false;
            this.dataGridView1.EndEdit();
        }
    }

} 
```

Basically, what this code does is it adds an Integer column and a Bool column to the DataGridView. Then, on the CellContentClick event, if the checkbox column was clicked, first we commit the edit (if you don't do this, you'll have all kinds of trouble figuring out if the checkbox is checked or not). Then, we loop through the rows and count all the checked rows. Then, if the amount is greater than what we want to allow, we just set it back to false, and again re commit the edit. Test it out, it works. May not be the most elegant solution, but the DGV can be tricky with the checkboxes, so this is how I would do it.

EDIT: Just a small edit, I hooked into the ContentDoubleClick event as well, as I noticed you were able to beat the validation if you quickly clicked on the cell. Should work better now.

# iphone - 创建一个拆分视图 ViewController

> ID：576399
> 
> 赞同：1
> 
> 时间：2009-02-23T02:56:21.387
> 
> 标签：iphone

iPhone/Cocoa 开发相当新，所以我很难调整。

我想创建一个具有两个独立子视图的 ViewController。TabViewController/NavigationController 的设置方式，但我希望能够控制其他部分的内容（更不用说调整大小等）。任何一个方向都可以（上/下）或（左/右）。

```
+--------+   +----+----+
|  top   |   | l  |  r |
|        |   | e  |  i |
+--------+   | f  |  g |
|        |   | t  |  h |
| bottom |   |    |  t |
+--------+   +----+----+ 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T03:01:17.990

您可以创建 ViewController 的子类并添加三个属性：

FirstView, SecondView, isVertical

这三个属性通常足以创建一个简单的拆分视图。消费者将负责设置这些属性，并在 ViewController 的 loadView 方法中，将这两个视图添加到新视图中，然后将其分配给 UIViewController 的“视图”属性。

这就是一个*极其有限*的功能集拆分视图控制器的全部内容。其余的功能很可能只是自定义视图的大小和位置。

希望这会有所帮助，请开源它:)

# sql-server - 使用 MS Sql Server 2005 区分两个数据库备份文件的最佳方法是什么？

> ID：576400
> 
> 赞同：3
> 
> 时间：2009-02-23T02:57:36.487
> 
> 标签：sql-server, sql-server-2005

我有两个数据库备份文件。我想知道这两者之间是否有任何区别。我可以逐行逐个字段地做一个差异（我不是在寻找架构的差异，而是在寻找数据，尽管我希望架构保持不变）。

我可以对文件运行某种校验和，还是必须通过数据本身才能 100% 确定？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T03:35:05.833

Restore both backups to temporary database (might need to use 'WITH MOVE' to rename logical name), and then use a tool like RedGate's Data Compare.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T21:46:28.307

有些人编写了脚本来做这些事情。

我发现的一个 - [http://www.sql-server-performance.com/articles/dba/database_comparison_sp_p1.aspx](http://www.sql-server-performance.com/articles/dba/database_comparison_sp_p1.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T03:00:25.090

我认为您将不得不检查我认为的数据，因为我希望文件中包含日期和其他内容，这会弄乱您可以计算的任何校验和。

[Apex SQL Data Diff](http://www.apexsql.com/sql_tools_datadiff.asp)之类的东西非常好，但是那里有很多 diff 工具。您需要将备份还原到临时数据库才能运行它。

# iphone - 我在 iPHone 上的 Quartz 绘图在旋转后被剪掉了！

> ID：576424
> 
> 赞同：0
> 
> 时间：2009-02-23T03:12:03.533
> 
> 标签：iphone, drawing, quartz-graphics, clipping

我正在绘制三个矩形，其中一个从视图的末端脱落（即绘图大于当前视图边界），因此您看不到右边缘。这很好，但是当视图旋转时，右边缘仍然被剪裁，即使有足够的空间来绘制它。如何让视图重绘整个矩形？

我尝试过：
1）将框架和边界矩形更改为更大
2）调用 setNeedsLayout
3）调用 setContentMode:UIViewContentModeRedraw;
4) 调用 [self.view setClipsToBounds:NO]

接下来是尝试 CGLayer，除非有人提出其他建议。

-欧文

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T03:49:05.863

确保在 IB 中正确设置了此图层上的自动调整大小蒙版。如果它在旋转时没有以正确的方式拉伸，那么视图将不会采用屏幕的新形状。

# ruby - 从类中调用属性访问器方法

> ID：576428
> 
> 赞同：4
> 
> 时间：2009-02-23T03:16:28.250
> 
> 标签：ruby

我正在尝试调用我的类属性编写器之一，但由于某种原因，它永远不会被调用。这里有一些代码可以让这更清楚：

```
class Test
  attr_reader :test

  def test=(val)
    puts 'Called'
    @test = val
  end

  def set_it(val)
    test = val
  end
end

obj = Test.new
obj.set_it 5
puts obj.test
=> nil 
```

最后的 puts 语句输出“nil”。向 test= 添加调试语句表明它永远不会被调用。我究竟做错了什么？

**更新**

我部分重写了这个问题，因为我在写它时并没有真正理解这个问题。所以这个问题现在更加笼统了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-23T03:22:55.723

您本身并没有做任何“错误”。Ruby 只是认为您打算将局部变量 test 设置为 val，而不是调用该`test=`方法。`self.test = val`会做你所期望的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T01:56:14.713

这是有关此（显然很常见）问题的其他一些资源：

另一个 Stack Overflow 问题：[为什么 ruby​​ setter 需要“self”。班级内的资格？](https://stackoverflow.com/questions/44715/why-do-ruby-setters-need-self-qualification-within-the-class)

来自这个[家伙的博客](http://macournoyer.com/blog/2009/01/14/to-self-or-not-to-self/)：

> 作为一个 Ruby 新手，你可能曾经做过`race = "hooman"`，但发现它不起作用，然后对自己说：“我不会让这种情况再次发生在我身上。`self.`从现在开始，每当我调用方法时 ，我都会在前面添加！”</p>

# vb.net - VB.NET 中有条件三元运算符吗？

> ID：576431
> 
> 赞同：479
> 
> 时间：2009-02-23T03:17:30.150
> 
> 标签：vb.net, operators, conditional-operator, short-circuiting

在 Perl（和其他语言）中，条件三元运算符可以这样表示：

```
my $foo = $bar == $buz ? $cat : $dog; 
```

VB.NET中是否有类似的运算符？

* * *

## 回答 #1

> 赞同：643
> 
> 时间：2009-02-23T03:46:40.453

取决于版本。VB.NET 2008 中的`If`运算符是三元运算符（以及空合并运算符）。这是刚刚推出的，在 2008 年之前这是不可用的。这里有更多信息： [Visual Basic If 公告](https://devblogs.microsoft.com/vbteam/orcas-introduces-the-if-operator-a-new-and-improved-iif-sophia-salim/)

例子：

```
Dim foo as String = If(bar = buz, cat, dog) 
```

[编辑]

在 2008 年之前，它是`IIf`，其工作方式与上述操作员几乎相同`If`。

例子：

```
Dim foo as String = IIf(bar = buz, cat, dog) 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2009-02-23T04:25:19.987

iif 在 VB 中一直可用，即使在 VB6 中也是如此。

```
Dim foo as String = iif(bar = buz, cat, dog) 
```

因此，它不是真正的运算符，而是 Microsoft.VisualBasic 命名空间中的一个函数。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2012-08-16T15:50:32.657

`If()`是最接近的等价物，但如果您设置了，**请注意***隐式*`Option Strict off`转换。

例如，如果您不小心，您可能会尝试以下操作：

```
Dim foo As Integer? = If(someTrueExpression, Nothing, 2) 
```

将给出`foo`一个值`0`！

我认为`?`C# 中的等效运算符会导致编译失败。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-12-05T00:45:56.563

**仅作记录，这是If**和**IIf**之间的区别：

**IIf（条件，真部分，假部分）**：

*   这是旧的 VB6/VBA 函数
*   该函数始终返回一个 Object 类型，因此如果您想使用所选对象的方法或属性，您必须使用 DirectCast 或 CType 或 Convert.* 函数将其重新转换为其原始类型
*   正因为如此，如果 true-part 和 false-part 是不同的类型，则没有任何关系，结果无论如何只是一个对象

**如果（条件，真部分，假部分）**：

*   这是新的 VB.NET 函数
*   结果类型是所选部分的类型，true-part 或 false-part
*   如果打开了严格模式并且这两个部分属于不同类型，则这不起作用。在严格模式下，它们必须是相同的类型，否则你会得到一个异常
*   如果您确实需要两个不同类型的部分，请关闭严格模式（或使用 IIf）
*   如果严格模式允许不同类型的对象但从相同的基础继承或实现相同的接口，我到目前为止还没有尝试过。Microsoft 文档对此问题没有太大帮助。也许这里有人知道。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2022-01-11T21:01:11.517

```
If(<expression>, <expressionIfNothing>) 
```

如果`<expression>`计算结果为非 Nothing 的引用或 Nullable 值，则该函数返回该值。否则，它计算并返回`<expressionIfNothing>`（智能感知）

* * *

这对于检查特定值是否存在以及如果不替换它很有用。

例子：

```
If(cat, dog) 
```

在这里，如果 cat 不为 null，它将返回 cat。如果为 null，则返回 dog。大多数情况下，您将在这种情况下使用三元运算符。但是，如果您不想返回正在测试的值，则必须改用它：

```
If(condition, cat(true), dog(false)) 
```

# regex - How do I handle special characters in a Perl regex?

> ID：576435
> 
> 赞同：11
> 
> 时间：2009-02-23T03:20:38.647
> 
> 标签：regex, perl

I'm using a Perl program to extract text from a file. I have an array of strings which I use as delimiters for the text, e.g:

```
$pat = $arr[1] . '(.*?)' . $arr[2];

if ( $src =~ /$pat/ ) {
   print $1;
} 
```

However, two of the strings in the array are `$450` and `(Buy now)`. The problem with these is that the symbols in the strings represent end-of-string and capture group in Perl regular expressions, so the text doesn't parse as I intend.

Is there a way around this?

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-23T03:27:35.307

Try Perl's [quotemeta](http://perldoc.perl.org/functions/quotemeta.html) function. Alternatively, use `\Q` and `\E` in your regex to turn off interpolation of values in the regex. See [perlretut](http://perldoc.perl.org/perlretut.html#More-on-characters%2c-strings%2c-and-character-classes) for more on `\Q` and `\E` - they may not be what you're looking for.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-23T03:42:32.010

quotemeta escapes meta-characters so they are interpreted as literals. As a shortcut, you can use \Q...\E in double-quotish context to surround stuff that should be quoted:

```
$pat = quotemeta($arr[1]).'(.*?)'.quotemeta($arr[2]);
if($src=~$pat) { print $1 } 
```

or

```
$pat = "\Q$arr[1]\E(.*?)\Q$arr[2]";  # \E not necessary at the end
if($src=~$pat) { print $1 } 
```

or just

```
if ( $src =~ /\Q$arr[1]\E(.*?)\Q$arr[2]/ ) { print $1 } 
```

Note that this isn't limited to interpolated variables; literal characters are affected too:

```
perl -wle'print "\Q.+?"'
\.\+\? 
```

though obviously it happens after variable interpolation, so "\Q$foo" doesn't become '\$foo'.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-23T03:28:17.753

Use [quotemeta](http://perldoc.perl.org/functions/quotemeta.html):

```
$pat = quotemeta($arr[1]) . '(.*?)' . quotemeta($arr[2]);
if ($src =~ $pat) 
    print $1; 
```

# sql - 为什么 - “生成插入更新和选择语句”是灰色的？

> ID：576437
> 
> 赞同：4
> 
> 时间：2009-02-23T03:22:02.527
> 
> 标签：sql, visual-studio-2008, ms-access, databound-controls

为什么在“配置数据源”的“高级”部分中“生成插入更新和选择语句”是灰色的？在某些桌子上，它没有变灰并且工作正常。

我知道可以通过在属性中将 autogenerateeditbutton 标记更改为 true 来解决此问题，并且您可以通过这种方式进行编辑 - 但是完成此操作后，您尝试时不会更新数据库。

当我在论坛上查看有关此问题时，还提到这可能与设置主键有关。虽然我无法得到一个确凿的答案。

浏览器中的错误如下：

`NotSupportedException: Updating is not supported by data source 'AccessDataSource1' unless UpdateCommand is specified.`

任何想法如何使用这些有问题的表更新数据库？为什么它们有问题？

主键如何分配到表中。这应该在 Access 中完成吗？它可以在VS08中完成吗？如何？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T03:42:56.267

为了自动生成插入/选择/更新语句，表必须有一个主键，以便在插入或更新时选择正确行的代码知道要选择哪一行。如果表中没有具有唯一值的列，则可能有不止一行与应更新的行匹配。使用主键允许设计人员生成可靠地选择要更新的正确行的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T04:42:10.510

请参阅 tvanfosson 对主键的回答，这是一种可能性。如果您的 select 语句使用视图而不是直接表，您也会得到这种行为。

您可以通过在 .xsd 文件中生成或手动编码 xml 来解决此问题，但这是一个相当核心的解决方案；-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-22T10:31:56.530

使用如下视图创建数据源：主键是主键。对此类用户的插入、更新、选择、删除视图的权限：

" DeleteCommand="删除 [VW_Security_UK_UserAccess] WHERE [MainKey] = @MainKey"

```
 InsertCommand="INSERT INTO [VW_Security_UK_UserAccess] ([UserName], [HasAccess], [ApplicationDefinitionmainkey], [SortOrder]) VALUES (@UserName, @HasAccess, @ApplicationDefinitionmainkey, @SortOrder)" 
                SelectCommand="SELECT [MainKey], [UserName], [HasAccess], [ApplicationDefinitionmainkey], [SortOrder] FROM [VW_Security_UK_UserAccess]" 
                UpdateCommand="UPDATE [VW_Security_UK_UserAccess] SET [UserName] = @UserName, [HasAccess] = @HasAccess, [ApplicationDefinitionmainkey] = @ApplicationDefinitionmainkey, [SortOrder] = @SortOrder WHERE [MainKey] = @MainKey">
                <DeleteParameters>
                    <asp:Parameter Name="MainKey" Type="Int16" />
                </DeleteParameters>
                <InsertParameters>
                    <asp:Parameter Name="UserName" Type="String" />
                    <asp:Parameter Name="HasAccess" Type="String" />
                    <asp:Parameter Name="ApplicationDefinitionmainkey" Type="Byte" />
                    <asp:Parameter Name="SortOrder" Type="Int32" />
                </InsertParameters>
                <UpdateParameters>
                    <asp:Parameter Name="UserName" Type="String" />
                    <asp:Parameter Name="HasAccess" Type="String" />
                    <asp:Parameter Name="ApplicationDefinitionmainkey" Type="Byte" />
                    <asp:Parameter Name="SortOrder" Type="Int32" />
                    <asp:Parameter Name="MainKey" Type="Int16" />
                </UpdateParameters>
            </asp:SqlDataSource> 
```

# .net - Asynchronous Webrequest best practices

> ID：576440
> 
> 赞同：8
> 
> 时间：2009-02-23T03:23:16.283
> 
> 标签：.net, asynchronous, httpwebrequest

What is the best practice for getting a webrequest asynchronously?

I want to download a page from the internet (doesn't matter what) and avoid blocking a thread as much as possible.

Previously I believed that it was enough to just use the 'BeginGetResponse' and 'EndGetResponse' pair. But on closer inspection I also see that there is the option of using 'BeginGetRequestStream'

**[UPDATE]** GetRequestStream is used for POST operations

And then to add to the confusion, Should I be using stream.BeginRead and EndRead?

**[UPDATE]** this [article](http://tomasp.net/blog/csharp-async.aspx) suggests it is even better to process the HttpResponse.GetResponseStream asynchronously using Stream.BeginRead

What a mess!

Can someone point me in the right direction?

What is the Best Practice?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-24T08:22:06.557

您可以自己编写代码，也可以只使用 WebClient 来为您完成大量繁重的工作。例如，要将文件下载为字符串，您将调用 DownloadStringAsync() 最终将触发 OnDowloadStringCompleted 事件。如果文件是二进制文件，您可以尝试使用 DownloadDataAsync() 代替。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T07:06:13.383

您是否考虑过在新线程中执行 Web 请求？

[http://msdn.microsoft.com/en-us/library/ms173178.aspx](http://msdn.microsoft.com/en-us/library/ms173178.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T04:17:21.380

1.  您使用 Begin/EndGetResponse 异步等待 HTTP 响应。如果您正在执行 POST 并且需要异步发送大量数据，请使用 Begin/EndGetRequestStream。

2.  这不是异步通信所独有的——您可以查找同步版本以获取更多信息。

3.  我不确定您为什么要对请求流进行读取 - 很可能您将写入它，并从响应流中读取。

最后，[Jeffrey Richter 的博客](http://www.wintellect.com/cs/blogs/jeffreyr/default.aspx)有一篇关于 HttpWebRequest 和流的一些微妙之处的文章。

# sql - SQL 将一个表的所有值插入到另一个表中

> ID：576441
> 
> 赞同：138
> 
> 时间：2009-02-23T03:23:54.270
> 
> 标签：sql, sql-server, sql-server-2005

我正在尝试将一个表的所有值插入到另一个表中。但是插入语句接受值，但我希望它接受来自 initial_Table 的 select *。这可能吗？

* * *

## 回答 #1

> 赞同：275
> 
> 时间：2009-02-23T03:26:02.627

insert 语句实际上具有执行此操作的语法。如果您指定列名而不是选择“*”，则会容易得多：

```
INSERT INTO new_table (Foo, Bar, Fizz, Buzz)
SELECT Foo, Bar, Fizz, Buzz
FROM initial_table
-- optionally WHERE ... 
```

我最好澄清这一点，因为出于某种原因，这篇文章得到了一些反对票。

INSERT INTO ... SELECT FROM 语法适用于您要插入的表（在我上面的示例中为“new_table”）已经存在的情况。正如其他人所说，SELECT ... INTO 语法适用于您想要创建新表作为命令的一部分。

您没有指定是否需要在命令中创建新表，因此如果您的目标表已经存在，则 INSERT INTO ... SELECT FROM 应该没问题。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2010-04-21T09:35:06.267

试试这个：

```
INSERT INTO newTable SELECT * FROM initial_Table 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-08-22T02:08:38.803

您可以使用子查询插入如下：

```
INSERT INTO new_table (columns....)
SELECT columns....
FROM initial_table where column=value 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-23T03:26:28.897

从[这里开始：](http://www.w3schools.com/Sql/sql_select_into.asp)

```
SELECT *
INTO new_table_name [IN externaldatabase] 
FROM old_tablename 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-23T03:26:50.517

您可以使用`select into`语句。 [在 W3Schools 上查看更多信息](http://www.w3schools.com/Sql/sql_select_into.asp)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-06-07T18:08:54.693

有一种更简单的方法，您无需输入任何代码（非常适合测试或一次性更新）：

> 第1步

*   在资源管理器中右键单击表格，然后选择“编辑前 100 行”；

> 第2步

*   然后你可以选择你想要的行（*Ctrl + Click*或*Ctrl + A*），然后右键单击并复制（**注意**：如果你想添加一个“ *where* ”条件，然后右键单击 Grid -> Pane -> SQL Now您可以编辑查询并添加 WHERE 条件，然后再次右键单击 -> 执行 SQL，您需要的行将可以在底部选择）

> 第 3 步

*   对目标表执行步骤 1。

> 第4步

*   现在转到网格的末尾，最后一行将在第一列有一个星号*（*）*（此行是添加新条目）。单击它以选择整行，然后粘贴（*Ctrl + V*）。单元格可能有一个红色的 Asterix（表示它没有保存）

> 第 5 步

*   单击任何其他行以触发插入语句（红色 Asterix 将消失）

**注意 - 1**：如果列的顺序与目标表中的顺序不正确，您始终可以按照步骤 2，并以与目标表中相同的顺序选择列

**注意 - 2** - 如果您有身份列然后执行`SET IDENTITY_INSERT sometableWithIdentity ON`，然后按照上述步骤，最后执行`SET IDENTITY_INSERT sometableWithIdentity OFF`

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-23T09:07:24.240

如果您要永久传输大量数据，即不填充临时表，我建议使用**SQL Server 导入/导出数据**进行表到表映射。

当映射中有类型转换和可能的值截断时，导入/导出工具通常比直接 SQL 更好。通常，映射越复杂，使用集成服务 (SSIS) 等 ETL 工具而不是直接 SQL 的效率就越高。

导入/导出工具实际上是一个 SSIS 向导，您可以将您的工作保存为 dtsx 包。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-23T03:27:01.517

我认为这个声明可能会做你想要的。

```
INSERT INTO newTableName (SELECT column1, column2, column3 FROM oldTable); 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2011-04-17T22:08:42.670

```
 Dim ofd As New OpenFileDialog
                ofd.Filter = "*.mdb|*.MDB"
                ofd.FilterIndex = (2)
                ofd.FileName = "bd1.mdb"
                ofd.Title = "SELECCIONE LA BASE DE DATOS ORIGEN (bd1.mdb)"
                ofd.ShowDialog()
                Dim conexion1 = "Driver={Microsoft Access Driver (*.mdb)};DBQ=" + ofd.FileName
                Dim conn As New OdbcConnection()
                conn.ConnectionString = conexion1
                conn.Open()

            'EN ESTE CODIGO SOLO SE AGREGAN LOS DATOS'
            Dim ofd2 As New OpenFileDialog
            ofd2.Filter = "*.mdb|*.MDB"
            ofd2.FilterIndex = (2)
            ofd2.FileName = "bd1.mdb"
            ofd2.Title = "SELECCIONE LA BASE DE DATOS DESTINO (bd1.mdb)"
            ofd2.ShowDialog()
            Dim conexion2 = "Driver={Microsoft Access Driver (*.mdb)};DBQ=" + ofd2.FileName
            Dim conn2 As New OdbcConnection()
            conn2.ConnectionString = conexion2
            Dim cmd2 As New OdbcCommand
            Dim CADENA2 As String

            CADENA2 = "INSERT INTO EXISTENCIA IN '" + ofd2.FileName + "' SELECT * FROM EXISTENCIA IN '" + ofd.FileName + "'"

            cmd2.CommandText = CADENA2
            cmd2.Connection = conn2
            conn2.Open()
            Dim dA2 As New OdbcDataAdapter
            dA2.SelectCommand = cmd2
            Dim midataset2 As New DataSet
            dA2.Fill(midataset2, "EXISTENCIA") 
```

# .net - log4net 与 TraceSource

> ID：576456
> 
> 赞同：71
> 
> 时间：2009-02-23T03:37:24.783
> 
> 标签：.net, logging, log4net, trace, diagnostics

在[这个线程](https://stackoverflow.com/questions/576185/logging-best-practices)中，许多人表示他们使用 log4net。我是 TraceSources 的粉丝，想知道为什么要使用 log4net。

这就是我喜欢跟踪源的原因：

*   可插入的侦听器 - XML、TextFile、Console、EventLog，您自己的
*   可定制的跟踪开关（错误、警告、信息、详细、开始、结束、自定义）
*   可定制的配置
*   日志记录应用程序块只是一大组 TraceListeners
*   活动/范围的相关性（例如，将 ASP.NET 请求中的所有日志与给定客户相关联
*   服务跟踪查看器允许您分别针对这些活动可视化事件
*   所有这些都可以在 app.config/web.config 中进行配置。

由于 .NET 框架内部使用 TraceSources，它还为我提供了一种配置跟踪的一致方式 - 使用 log4net，我必须配置 log4net 以及 TraceSources。

log4net 给了我什么 TraceSources 没有（或者无法通过编写几个自定义 TraceListeners 来完成）？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-06-03T16:37:06.997

在早期（.NET 1.0）中，.NET Framework 中的跟踪非常有限。

例如 TraceSource 分区直到 .NET 2.0 才出现，并且您只有四个级别（错误、警告、信息、详细），但如果您愿意，可以使用六个布尔开关进行分区。

log4j 在 Java 中很流行，因此得到了对 .NET 端口的大量支持，一旦它流行起来，它就一直保持这种状态，即使人们甚至没有正确使用它（例如，将它包装在单例记录器中并丢失它的主要特点）。

尽管如此，我仍然认为 log4net 和其他框架（例如 NLog、Common.Logging 甚至 EntLib）通过从头开始实现自己的日志系统而走错了路，即甚至改变了您编写日志语句的方式。

我更希望看到努力，特别是从 .NET 2.0 开始，用于扩展 .NET 中已有内容的坚实基础。对于确实扩展已有内容的项目，请查看 CodePlex ( [http://essentialdiagnostics.codeplex.com/](http://essentialdiagnostics.codeplex.com/) ) 上的 Essential Diagnostics 项目。

log4net 的一些优势：

*   如果您运行混合环境并想要一致的日志记录，它类似于 log4j。

*   与您实现和必须配置的跟踪源数量相比，继承设置的自动记录器层次结构非常简洁。（尽管在某些情况下可能矫枉过正）。

*   log4net 已经有大约 28 个附加程序（相当于跟踪侦听器），而 System.Diagnostics 只有 10 个（但请参阅 Essential.Diagnostics 项目了解更多信息），所以如果你真的认为你可能需要 RemoteSyslogAppender、NetSendAppender、AnsiColorTerminalAppender 或 TelnetAppender，那么你很幸运。

缺点（与 System.Diagnostics 相比）：

*   您需要使用不同的日志记录语法，因此如果您已经在使用 source.TraceEvent()，则需要检查并替换所有内容。

*   这也扩展到不同的关联语法，因此您需要从 CorrelationManager 更改为 log4net 上下文。

*   不容易与框架跟踪（例如 WCF）集成。

*   对事件 ID 的支持不佳（需要使用单独的扩展项目 IEventLog）。

*   尚不支持 Windows (Vista) 的事件跟踪或服务跟踪查看器 XML 格式。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-23T04:47:38.857

我认为 log4net 正在做你为我列出的所有事情。

可插拔监听器听起来像附加器——它们有很多，事实上我什至破解了滚动日志文件以始终以 .log 结尾（用于文件关联），在电子邮件附加器中添加了一个 cc 字段，最后调整了我最喜欢的值彩色控制台附加程序。如果我可以这么大胆——我的彩色控制台幸福：

```
<appender name="ColoredConsoleAppender" type="log4net.Appender.ColoredConsoleAppender">
<!-- Can Use:
        Blue
        Green
        Red
        White
        Yellow
        Purple
        Cyan
        HighIntensity
        -->
<mapping>
  <level value="FATAL" />
  <foreColor value="Yellow, HighIntensity" />
  <backColor value="Red" />
</mapping>
<mapping>
  <level value="ERROR" />
  <foreColor value="White" />
  <backColor value="Purple, HighIntensity" />
</mapping>
<mapping>
  <level value="WARN" />
  <backColor value="Blue" />
  <foreColor value="White" />
</mapping>
<mapping>
  <level value="INFO" />
  <backColor value="Green" />
  <foreColor value="White" />
</mapping>
<mapping>
  <level value="DEBUG" />
  <foreColor value="White" />
</mapping>
<layout type="log4net.Layout.PatternLayout">
  <!--<conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline" />-->
  <!--<conversionPattern value="%-5level %file:%line - %message%newline" />-->
  <conversionPattern value="%level %logger:%line %newline     %message%newline" />
</layout> 
```

可定制的跟踪开关：Log4net 仅附带 FATAL ERROR WARN INFO DEBUG 以增加详细程度。我真正想念的唯一一个是 AUDIT for who-did-what 日志记录。

可定制的配置：我使用在运行时加载的 log4net.config 文件（或将日志写入 c:\ 抱怨我找不到配置。）

```
 Try
        ' Get log4net configuration from file
        Dim logConfigFile As FileInfo
        logConfigFile = New FileInfo(".\log4net.config")

        If logConfigFile.Exists Then
            XmlConfigurator.Configure(logConfigFile)
        Else
            CreateEmergenceLogFile(logConfigFile.FullName)
        End If

    Catch ex As Exception
        Console.Out.WriteLine("Could not load the log4net config file")
    End Try 
```

只是一大组 TraceListeners：抱歉跳过那个 - 我会相信你的话。

活动/范围的相关性：您的意思是每个文件（读取类）都有自己的命名日志，可以有单独的日志级别阈值。实际上，您甚至可以在单个类中对日志记录进行分段（实际上，这可能已经做得太多了……）

在类文件中：

```
 Private Shared _logger As log4net.ILog = _
log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType)

Private Shared _loggerAttribute As log4net.ILog = _
log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType.FullName & ".Attribute")

Private Shared _loggerCache As log4net.ILog = _
log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType.FullName & ".Cache") 
```

服务跟踪查看器：在 log4net.config 中：

```
 <logger name="NipissingU.ADWrapper.EntryTools.Attribute">
    <level value="INFO" />
  </logger>
  <logger name="NipissingU.ADWrapper.EntryTools.Cache">
    <level value="WARN" />
  </logger> 
```

所有这些都可以在 app.config/web.config 中进行配置：也许这在 ASP.NET 中是件好事，我不知道，但是在制作富客户端 bean 计数应用程序时，我喜欢单独的配置文件。

这里的一切都只是我自己的小使用技巧。

hth，-迈克

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-04-28T09:07:07.383

使用 TraceSources 而不是 Log4Net 的另一个原因是 Tracing 本身：Log4Net 只能用于 Logging（消息），但是如何跟踪一个 Object（同时多个信息）？当然 Log4Net 实现了很多 Listeners，但我需要所有这些吗？在大多数情况下不是。如果我需要一个特殊的监听器，实现我自己的监听器并不难，不是吗？例如，我需要一个侦听器来跟踪数据库（不仅是消息，而且同时还有不同的信息 {string's, int's, etc.}）。

我是对的吗？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-23T04:03:16.187

我更喜欢 Log4Net 而不是使用 Trace one of Targeting 的原因 - 使用 Log4Net，我可以独立地检测我的应用程序的不同层（数据访问、服务、业务逻辑等）和不同的子系统（身份验证、处理等）并打开/独立地关闭每个子系统的日志记录。

这种灵活性允许我为一个子系统配置详细的日志记录，而无需打开整个系统的消防软管。

Trace 类上提供的静态方法 [例如 TraceInformation()] 没有提供任何方法来指定日志记录来自哪个子系统，因此通过编写我自己的 TraceListener 不容易提供。

另一个原因是性能 - 我的应用程序可能每秒记录数千条消息。Log4Net 的开销很低。相比之下，上次我查看它时，日志应用程序块为记录的每条消息重新解析其 XML 配置，这使得该块非常沉重和缓慢。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-30T12:45:00.800

虽然我只知道 log4net 的工作方式，但使用该框架的一个明显好处是那些习惯使用 log4j 的人立即熟悉。

另一个小好处是使用 log4net 测试驱动日志记录非常简单；记录器实现 log4net.ILog。同样，我不熟悉 Microsoft 解决方案，但我想知道如何在不首先为 System.Diagnostics.Trace 类编写外观的情况下做到这一点。

粗略地看一下跟踪源文档，我找不到布局的等价物，并且有兴趣知道是否存在这样的等价物。PatternLayout 对于使用常见数据（如日期戳、线程信息、日志上下文等）格式化日志条目非常方便。 Log4net PatternLayout 文档：[http ://logging.apache.org/log4net/release/sdk/log4net.Layout.PatternLayout.html](http://logging.apache.org/log4net/release/sdk/log4net.Layout.PatternLayout.html)

此外，考虑到为日志框架编写扩展可能是一个经典的“元问题”，log4net 确实为表格提供了一个可插入侦听器等效项的庞大列表。

附加程序列表：http: [//logging.apache.org/log4net/release/config-examples.html](http://logging.apache.org/log4net/release/config-examples.html)

# visual-studio-2008 - Visual Studio 设置和部署：使用可选组件创建包？

> ID：576457
> 
> 赞同：0
> 
> 时间：2009-02-23T03:40:29.330
> 
> 标签：visual-studio-2008, installation, setup-deployment

例如，假设我的应用程序支持 Epson 打印机和 Canon 打印机。

我想在安装过程中有一个选项，可能是单选按钮，或者更好的是复选框（可以选择两者），上面写着“安装爱普生驱动程序”和“安装佳能驱动程序”。

然后，根据用户选择，安装程序包将仅安装 Epson 驱动程序，或仅安装 Canon 驱动程序，或两者兼而有之。

我想我想要的也可以被描述为有几个先决条件，但是让它们成为可选的。

关于从哪里开始的任何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T00:40:43.857

看起来我需要的东西无法从 VS 设置和部署中完成，因为我试图从 msi 运行 msi，这是不允许的。因此，作为一种解决方法，我必须创建一个带有几个复选框和这样的功能的小型“包装”Windows 窗体应用程序

```
 private void InstallComponent(string filePath)
    {
        System.Diagnostics.Process installerProcess;

        installerProcess = System.Diagnostics.Process.Start(filePath);

        while (installerProcess.HasExited == false)
        {
            //indicate progress to user
            Application.DoEvents();
            System.Threading.Thread.Sleep(250);
        }
    } 
```

和“安装”按钮，它会做一些类似的事情

```
 private void buttonInstall_Click(object sender, EventArgs e)
    {
        if (checkBoxCanonDrivers.Checked)
        {
            InstallComponent("CanonSetup.exe");
        }

        if (checkBoxEpsonDrivers.Checked)
        { 
            InstallComponent("EpsonSetup.exe");
        }

        // ............

        InstallComponent("MyMainApplicationSetup.exe");
    } 
```

现在关闭以使此应用程序灵活，例如从 XML 文件中读取设置文件位置等，但这超出了问题的范围...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T23:40:18.143

我认为您可以在 Visual Studio 部署项目中执行此操作，至少对于简单的情况（我认为最多 4 个复选框，但我可能错了）。请参阅此 MSDN 文章：[**复选框用户界面对话框**](http://msdn.microsoft.com/en-us/library/0b5sy4ht.aspx)；它解释了如何在安装过程中显示一个带有复选框的对话框，并根据复选框的选择来包含或排除文件。

# c# - How to setup private constructor?

> ID：576458
> 
> 赞同：4
> 
> 时间：2009-02-23T03:41:39.907
> 
> 标签：c#, unit-testing, constructor, nunit, private

How do I setup the unit test if the constructor is private (.NET)?

This is my class:

```
public class Class2
{
    // Private constructor.
    private Class2()
    {
    }

    public static Class2 getInstance()
    {

        if (x == null)
        {
            x= new Class2();
        }

        return x;
    }
} 
```

This is my unit test:

```
[TestFixture]
public class Class2Tester
{
    private Class2 test;

    [SetUp()]
    public void SetUp()
    {
        // I cant do this. How should I setup this up?
        test = new Class2();
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T03:51:26.917

The answer is: you don't. Not because you can't, but because you shouldn't.

By making the constructor private, you're saying that its behavior is not part of the public API of the class. In this case its behavior either a) doesn't affect the public API of the class which means it doesn't need to be tested. b) more likely, does affect the public API of the class, in which case, write your tests around that public API, not the black-boxed constructor.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T03:45:59.740

You don't specify a language so my answer will be generic. The typical way to do this is using reflection. You can do it directly in each test or by creating an accessor class that wraps all of the private methods/properties, including the constructor.

An example from C#/.NET

```
public void MyTest()
{
    MyClass class = typeof(MyClass).GetConstructor( null )
                                   .Invoke( null );
    ...
} 
```

Or, more typically, after adding private accessors to your test project

```
public void MyTest()
{
    MyClass class = ((MyClass)new MyClass_Accessor()).Target;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T04:12:59.487

在 java 中（假设唯一的构造函数是私有默认构造函数，否则需要检查数组）：

```
Constructor[] constructors = YourClass.class.getDeclaredConstructors();
constructors[0].setAccessible(true);
YourClass currentInstance = (YourClass) constructors[0].newInstance(null); 
```

然后，currentInstance 可供您使用。通常我只会为代码覆盖这样做，如果我将构造函数设为私有，通常是为了避免实例化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-11-30T18:22:50.023

取决于您在私有构造函数中所做的事情。如果您使用私有构造函数来禁止创建实用程序类的实例，那么我建议您抛出一个类似于您在 EJ2 中看到的非法访问错误。在这种情况下，您可以简单地通过不会被绕过的反射来测试它。

```
@Test(expected = InvocationTargetException.class)
public void privateConstructor() throws Exception {
    final Constructor<Keys> myConstructor = Keys.class.getDeclaredConstructor();
    myConstructor.setAccessible(true);
    myConstructor.newInstance();
} 
```

我不反对这种类型的测试。它可以帮助找到意外创建 util 类的实例的地方，而你并不打算这样做（序列化/反序列化等）。

如果它们（强烈不推荐）是有状态的，也可能意味着一些令人讨厌的惊喜。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T04:23:29.947

我通常根本不对构造函数进行单元测试。在这种情况下，您应该问自己的第一件事是您是否真的需要对该构造函数中的代码进行单元测试。当然，我们所有人中的偏执完美主义者有时会出来，所以如果答案是否定的，我说算了吧。

如果答案是肯定的，我认为你很有可能对你的构造函数和/或你的类做了太多的事情。即使不是这种情况，您也很有可能将确实需要进行单元测试的代码分解为它自己的公共函数。

诚然，总是有例外。但是我还没有遇到一个实例，我必须将构造函数设为私有并且必须对其进行单元测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T03:47:11.687

Basically, you should not do that. See [this question](https://stackoverflow.com/questions/105007).

# ftp - TSO/MVS Uploading problem

> ID：576461
> 
> 赞同：2
> 
> 时间：2009-02-23T03:43:08.187
> 
> 标签：ftp, cobol, mainframe, uploading

I'm uploading an ebcdic file(converted from ascii) from Windows OS to Mainframe. My problem is that when I checked the file after uploading it, I see alot of new lines. When I tried to check it with its hex dump I discovered that when mainframe sees a x'15' it translates it into a newline. In the file there are packed decimals so the hex could contain let say a x'001500001c' but when I upload it, mainframe mistook it as a new line. Can anyone help me with this problem?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T03:45:05.483

You should put your FTP client (or library if the upload is done by your code) into binary (IMAGE TYPE) mode instead of ascii/EBCDIC if you are sending a file already in EBCDIC i believe.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T05:05:29.347

这取决于您要上传到的目标“文件”的类型。

如果您要上传到具有固定块大小的成员（例如，FB80），则需要确保在传输之前用空格填充所有行（以二进制模式）。

文本模式传输不适合二进制文件（如果您的文件包含压缩小数，则它们**是**二进制文件 - FTP 没有可靠的方法来检测真正的行尾字符）。

您需要修复 Windows ASCII 到 EBCDIC 转换器才能生成固定长度的记录。

唯一的其他选择是在大型机上使用 REXX 脚本，但这仍然需要能够区分真正的行尾标记和二进制数据中的标记。

您可以通过它由 BCD nybbles 组成的事实来判断是否存在压缩十进制，其中最后一个是 0xC 或 0xD，但这也可能导致误报或误报。

我的建议：当您将其从 ASCII 转换为 EBCDIC 时，同时将行填充到所需的记录长度。

我想提出的另一点是，如果您只想查看大型机上的文件（不要在任何需要 EBCDIC 的代码中使用它们），ISPF 编辑器包括一些新命令（从 z/OS 1.9 开始）如果我没记错的话）。

`SOURCE ASCII`将数据显示为 ASCII 而不是 EBCDIC。此外，该`LF`命令允许您按摩 FB 成员中的 ASCII 流以正确修复行尾。

# c# - 获取具有多个监视器的整个屏幕的 DeviceContext

> ID：576476
> 
> 赞同：3
> 
> 时间：2009-02-23T03:56:05.377
> 
> 标签：c#, pinvoke, gdi, multiple-monitors

我需要用 C# 在所有东西上画一条线（用鼠标）。我可以使用 P/Invoke 获取桌面窗口的 Graphics 对象：

DesktopGraphics = Graphics.FromHdc(GetDC(IntPtr.Zero));

然而，我使用这个图形对象绘制的任何东西都只显示在左显示器上，而在右显示器上什么也没有。它没有失败或任何东西，它只是没有显示。

创建 Graphics 对象后，它显示可见剪辑区域为 1680 x 1050，这是我左显示器的分辨率。我只能假设它只是获取左监视器的设备上下文。他们是获取两个（或任何数量）监视器的设备上下文的方法吗？

* * *

**编辑 3/7/2009：有关我使用的修复程序的附加信息。**

我使用 colithium 提供的修复程序提出了以下代码，用于为每个监视器创建图形对象以及存储偏移量的方法，以便我可以将全局鼠标点转换为图形表面上的有效点。

```
private void InitializeGraphics()
{
    // Create graphics for each display using compatibility mode
    CompatibilitySurfaces = Screen.AllScreens.Select(s => new CompatibilitySurface()
        {
            SurfaceGraphics = Graphics.FromHdc(CreateDC(null, s.DeviceName, null, IntPtr.Zero)),
            Offset = new Size(s.Bounds.Location)
        }).ToArray();
}

private class CompatibilitySurface : IDisposable
{
    public Graphics SurfaceGraphics = null;
    public Size Offset = default(Size);

    public PointF[] OffsetPoints(PointF[] Points)
    {
        return Points.Select(p => PointF.Subtract(p, Offset)).ToArray();
    }

    public void Dispose()
    {
        if (SurfaceGraphics != null)
            SurfaceGraphics.Dispose();
    }
}

[DllImport("gdi32.dll")]
static extern IntPtr CreateDC(string lpszDriver, string lpszDevice, string lpszOutput, IntPtr lpInitData); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T04:25:08.817

[这](http://bytes.com/groups/net-c/253023-docking-window-problem)是另一个有同样问题的人的链接。通过调用以下方法解决了该问题：

```
CreateDC(TEXT("DISPLAY"),NULL,NULL,NULL) 
```

这将向所有监视器返回一个 DC。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T04:07:55.520

按照 URL 获取 EnumDisplayMonitor 可能会解决您的问题

[MSDN](http://msdn.microsoft.com/en-us/library/dd162610(VS.85).aspx)

要检索有关所有显示监视器的信息，请使用如下代码：

EnumDisplayMonitors(NULL, NULL, MyInfoEnumProc, 0); [MSJ](http://www.microsoft.com/msj/0697/monitor/monitor.aspx)提供的另一个 URL

# java - 从有序列表构建树

> ID：576478
> 
> 赞同：1
> 
> 时间：2009-02-23T03:57:11.630
> 
> 标签：java, performance, tree

在java中，我从一个总是要排序的列表中创建一个SortedSet（但只有ArrayList类型）。我认为一一添加它们的性能会很差（以 AVL 树为例），因为它必须对树进行大量重新排序。

我的问题是，我*应该*如何创建这个集合？以某种方式尽可能快地构建平衡树？

[我计划使用的具体实现是来自http://fastutil.dsi.unimi.it/docs/it/unimi/dsi/fastutil/ints/IntSortedSet.html](http://fastutil.dsi.unimi.it/docs/it/unimi/dsi/fastutil/ints/IntSortedSet.html)的 IntRBTreeSet 或 IntAVLTreeSet

在写完这篇文章之后，我认为糟糕的性能无论如何不会对我影响太大（数据量太少），但我仍然对在一般情况下如何完成它感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T04:29:55.437

具有树实现的集合将列表中的中间元素放在顶部。所以算法如下：

1.  找到 List 的中间元素
2.  将其插入集合
3.  对中间元素左侧和右侧的两个子列表重复

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T04:13:49.297

红黑树对于一般情况来说是一个不错的选择，它们的插入速度非常快。请参阅[Chris Okasaki 的论文](http://www.eecs.usma.edu/webs/people/okasaki/jfp99.ps)以获得优雅而快速的实现。[Functional Java](http://functionaljava.org)库有一个通用的Set[类](http://functionaljava.googlecode.com/svn/artifacts/2.17/javadoc/fj/data/Set.html)，它由根据本文实现的红黑树支持。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T06:10:00.633

在所有关于使用 Set 的讨论中，我突然想到这个问题可能会被重新陈述。为什么要使用 Set 呢？如果您只是想检查成员资格，并且您的源列表已排序，那么对该对象进行二进制搜索 - 这将比您可以想象的任何 n-tree 一样快（并且可能更快），而且并不难代码。

So, envision a OrderedListSet interface that just wraps the underling List object. As long as the comparator used to order the list is also used for the binary search, this should be pretty straight-forward.

All Set operations will start with a getIndex(Object ob) call, then the appropriate action is taken on the List.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T07:47:29.643

在元素到来时插入元素的简单方法是否存在性能问题？

如果不是，请不要优化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T05:21:44.587

内置的 TreeSet ( [http://java.sun.com/j2se/1.4.2/docs/api/java/util/TreeSet.html](http://java.sun.com/j2se/1.4.2/docs/api/java/util/TreeSet.html) ) 类使用红黑树作为它的支持树（并且，已经注意到，红黑树的插入速度非常快）。这是关于红黑树的[好信息](http://libredblack.sourceforge.net/)（在插入大部分已经排序的数据时，它们没有典型的二叉树实现的问题）。

如果您正在处理庞大的数据集（大到需要基于磁盘的备份或大量的分页文件交换），那么 B+Tree 是一个非常好的选择（请参阅[JDBM](http://jdbm.sourceforge.net/)了解基于 Java 的自平衡 B+Tree 版本 -它没有实现 Set，但可以根据需要以这种方式使用）。

根据您的应用程序实际使用这些数据的方式，您可能需要考虑使用[GlazedLists](http://publicobject.com/glazedlists/)库并使您的列表“活动”。如果您所做的只是静态分析，那么这可能有点矫枉过正，但它绝对是处理基于列表的数据的绝佳方式。绝对值得一读。

# iphone - UITableView（iPhone）中的布局选项？还是扩展 UIScrollView？

> ID：576481
> 
> 赞同：1
> 
> 时间：2009-02-23T03:59:03.187
> 
> 标签：iphone, uitableview, layout, uiscrollview

我是 Objective-C 和 iPhone 编码的新手，希望有人能帮助我。

基本上我想要一个显示该项目名称和数量的可滚动表。例如：苹果............2
橙子......4
香蕉......5

我希望名称左对齐，数字右对齐。

有什么方法可以用 UITableView 做到这一点，还是我需要扩展 UIScrollView？

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T04:05:19.053

设置`cell.text`为“苹果”。然后使用文本“2”创建一个新的 UILabel 视图并将其分配给`cell.accessoryView`.

文本总是在左边，附件视图总是在右边。`cell.image`如果您选择添加一个UIImage in ，则可以选择在单元格文本的左侧显示。

如果您的单元格布局比这更复杂，则必须手动将子视图添加到您的单元格中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T06:25:22.197

一个不太难的选择是使用一个文本标签和一个数字标签子类 UITableViewCell，然后只需设置标签值。

如果您想要...您已经展示过，那么您可能可以使用标准 UITableViewCell 并编写一些代码来提供已预先修改以适合分配的空间的单元格文本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-29T12:01:41.917

您可以简单地使用 Apple 已经提供的另一个 CellType 并更改 detailTextLabel 的颜色：

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    static NSString *CustomCellIdentifier = @"Cell";
    UITableViewCell *cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleValue1 reuseIdentifier:CustomCellIdentifier];
    cell.textLabel.text = @"Apples";
    cell.detailTextLabel.text = @"2";
    cell.detailTextLabel.textColor = [UIColor blackColor];
    return cell;
} 
```

无需为自己的子类化或添加标签而烦恼。

# c - 如何在c中垂直打印字符串？

> ID：576487
> 
> 赞同：0
> 
> 时间：2009-02-23T04:02:56.610
> 
> 标签：c, string, printf

好的，输出应该如下所示：

```
./a 3 4 8 2  
3  
4  
8  
2 
```

这是我到目前为止所拥有的，但是我迷路了，只能获取要打印的第一个整数（我们必须使用 GetInt，它获取字符串中的指定整数）：

```
int main (int argc, char*argv []){  
   int v;    
   int i;  
   i = 1;  
   v = GetInt(argc, argv, i + 1);  

   if(argc >= 1){  
      printf("%d\n", GetInt(argc, argv, i));  
   }  
   return 0;  
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T04:06:11.733

看起来您需要使用 for 循环依次获取每个值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T04:13:25.180

在没有真正看到您的 GetInt 实现的情况下，像这样（假设 C90）：

```
#include <stdio.h>

int GetInt( int argc, char* argv[], int i ) {
    /* 
     * you may want to use sscanf, strtol or other functions,
     * but you haven't specified
     */
    return atoi( argv[i] );
}

int main ( int argc, char* argv[] ) {
    int i;
    for ( i = 1; i < argc; ++i ) {
        printf( "%d\n", GetInt( argc, argv, i ) );
    }
    return 0;
} 
```

回报：

```
$ ./a.out 3 4 8 2
3
4
8
2 
```

错误检查省略等。弄清楚如何处理非小数参数是一个练习。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T04:36:56.870

作为一个注释，为什么你*必须*使用`GetInt()`？它完全是多余的，不是标准库的一部分，除非您自己（或在课堂上）编写它，否则我无法想象曾经使用它。这就是我要做的：

```
#include <stdio.h>

int main(int argc, char *argv[])
{
    int i;
    for(i = 1; i < argc; i++)
      {
        printf("%s\n", argv[i]);
      }
    return 0;
} 
```

我知道它不使用`GetInt()`，但它更短，你可能*不*应该使用`GetInt()`它，因为它有点没用。另外，已经有一个`atoi()`函数，如果你不想使用它，因为它已经过时了，如果你必须的话，`strtol()`你可以重铸一个函数`int`。

我不是在引用你或任何东西，我只是想知道为什么要求你使用这个多余的、非标准的功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T04:06:40.203

在循环中使用 printf()。argc 是 argv[] 中空格分隔参数的数量，在上面的示例中，argc = 5。

# api - 过度设计 API 的动机？

> ID：576495
> 
> 赞同：5
> 
> 时间：2009-02-23T04:08:27.250
> 
> 标签：api

似乎这里有相当多的人不喜欢过度设计的 API，这些 API 被设计为无限灵活，因此不会让简单的事情变得简单。尽管如此，似乎并不缺少需要您使用 8 个不同的类并编写 20 行样板代码来完成简单、常见任务的 API。我不会提及名字，因为这不应该是关于特定 API 是否被过度设计的激烈争论。

您认为这些可怕的过度设计 API 的根本原因是什么？你认为需要采取什么措施来防止 API 设计者创造出这样的怪物？

编辑：恕我直言，即使是可重用代码的创建也不是一个好的答案，因为如果 API 难以使用并且需要大量的样板，那么重用的好处就会变得值得怀疑。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-23T04:16:26.407

我相信这通常是所谓的[第二系统效应](http://en.wikipedia.org/wiki/Second-system_effect)的结果。设计师从他们的第一个“版本 1”设计中吸取教训，使下一个版本更加灵活，以至于它变得过度设计且难以理解。

Fred Brooks 的书[The Mythical Man-Month](http://en.wikipedia.org/wiki/The_Mythical_Man-Month)介绍了这个术语，并详细讨论了它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T04:15:10.747

万恶之源是开发人员没有 a) 聪明/经验丰富和 b) 不够充分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T04:47:18.437

我不确定这些是否是过度设计或抽象不足的情况。windows api就是一个很好的例子。

曾几何时，我花了很多时间编写打印和预览引擎。我必须解码在屏幕上显示内容并输出到打印机所需的 windows api 调用。在创建 api 抽象时，我试图根据开发人员试图完成的任务来思考......例如：“我想从坐标 (1, 1) 到 (8, 1) 绘制一条 1 点宽的红线 -以英寸表示。”

等效的 windows api 涉及许多令人讨厌的代码行...创建画笔，将其选择到设备上下文中，设置起点，处理从英寸到像素的转换，绘制到终点等等。我的抽象的 api 是一个单一的调用： dpLine(documentHandle, x1, y1, x2, y2, width, color); // 其中 x1, x2, y1, y2 以英寸表示

在这种情况下，我认为 windows gdi api 级别太低了。我确信他们所做的事情有充分的理由，只是没有时间/精力为可能使用它的程序员制作合适的界面。怪物的原因可能只是时间期限。该api在技术上是准确的；它允许程序员做他们需要的事情。这足以运送它。但是，它的级别太低了，需要第 3 方抽象才能使其可用。IMO，你可以为操作系统提供一个像这样的低级、复杂的 api 提出论据，但第 3 方工具不应该那么复杂。

-大学教师

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T04:14:33.273

> “过早的优化是万恶之源。”
> ——唐·克努特

即便如此，它还是非常非常诱人的，因为程序员本能地喜欢效率和聪明。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T04:14:45.130

二次系统效应？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T04:14:53.960

我认为没有什么可以阻止人们过度思考问题。这是解决问题所固有的。像 XP 这样的方法试图阻止它，但当它归结为它时，每个人都认为“但如果我让它更通用，那么我可以在某处重用它”

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T06:00:32.707

我认为 Python 遭受了第二系统效应。在 2.x 版本中，存在两种类型的类和不同的语义。

希望 Python 3.0 可以解决大部分问题。

# perl - 如何使用 Perl 在表格中显示数据？

> ID：576498
> 
> 赞同：2
> 
> 时间：2009-02-23T04:11:45.510
> 
> 标签：perl, html-table

我正在从数据库中获取数据。它有 4 行和 6 列。我想在 HTML 表格中显示它，但遇到了问题。我已经为 6 列做了 TH。但是，我在显示 4 行时遇到问题。这是我到目前为止所拥有的：

```
while (($f1, $t2, $n3, $k4, $d5, $e6) = $sth1->fetchrow_array)
{
        push (@first, $f1);
        push (@second, $t2);
        push (@third, $n3);
        push (@fourth, $k4);
        push (@fifth, $d5);
        push (@sixth, $e6);
} 
```

@first, @second...和其他都是数组

如果我这样做，则在显示数据时：

```
foreach (@first)
{
        print "<td>$_</td>";
} 
```

那是垂直显示数据，但我希望它水平显示。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-23T05:37:41.857

您也可以使用[HTML::Table](http://search.cpan.org/dist/HTML-Table/lib/HTML/Table.pm)。

```
use strict;
use warnings;
use HTML::Table;

my $table = HTML::Table->new( 
    -cols    => 6, 
    -border  => 1,
    -padding => 1,
    -head => [qw( f1 t2 n3 k4 d5 e6 )],
);

# do query here.    

while ( my @row = $sth->fetchrow_array ) {
    $table->addRow(@row);
}

$table->print; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T05:12:49.140

问题中的代码是使用 Perl 的 DBI（数据库接口）编写的：

```
print "<table>\n";
while (($f1, $t2, $n3, $k4, $d5, $e6) = $sth1->fetchrow_array)
{
    print "  <tr>\n";
    print "    <td>$f1</td>\n";
    print "    <td>$t2</td>\n";
    print "    <td>$n3</td>\n";
    print "    <td>$k4</td>\n";
    print "    <td>$d5</td>\n";
    print "    <td>$e6</td>\n";
    print " </tr>\n";
}
print "</table>\n"; 
```

或者您可以将该行读入一个数组，然后更简洁地打印该数组：

```
print "<table>\n";
while (my(@row) = $sth1->fetchrow_array)
{
    print "  <tr>\n";
    print "    <td>$val</td>\n" foreach my $val (@row);
    print " </tr>\n";
}
print "</table>\n"; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T15:43:30.217

如果您想在不必编写太多代码的情况下获得更多的灵活性，您可能还想查看 HTML::Table::FromDatabase。它为您制​​作 HTML，并让您可以轻松地格式化。这需要一点练习，但它已成为我武器库中的宝贵资源。

这是一些示例代码，可以让您了解可以用它做什么

```
use DBI;
use HTML::Table::FromDatabase;
use HTML::Table;
use CGI;

# Start the CGI wrapper
$query = new CGI();

# Just build the STH like normal, with either the SQL in-line or an $sql variable
my $sth = $mysql_dbh->prepare("SELECT DISTINCT field1, field2 FROM table ORDER BY field1");
$sth->execute;

# Tell the module to build the table using the STH you executed before
my $table = HTML::Table::FromDatabase->new(-sth=>$sth,
                                           -border=>1,  # We want a border on the entire table
                                           -callbacks=>[
                                                {
                                                        # On the switch column, we want to add an HREF with the data in the URL
                                                        column=>'field1',
                                                        transform=>
                                                                sub { $_ = shift; qq[<A HREF="$_">$_</A>]; },
                                                },
                                                {
                                                        # This example lets you return a value based on what value is in the field
                                                        column=>'field2',
                                                        transform=>
                                                                sub { $text = shift; DidItMatch($text); },
                                                }],
                                           # The two rows below are used to set CSS classes on even and odd rows if you want different formatting
                                           -evenrowclass=>'evenrow',
                                           -oddrowclass=>'oddrow'
                                           );

# Take the entire table and align all of the 2nd column to center
$table->setColAlign(2,'center');

# The following lines are just demonstrations of what else can be changed. There are a lot, so look at HTML::Table to get all of them
#$table->setColBGColor(2,'red');                # Sets the background color of all cells in a column
#$table->SetColVAlign(2,'middle');              # Sets the vertical alignment of all cells in a column
#$table->setColWidth(2,100);                    # Sets the width of a column. Could also use setColWidth(2,'50%');
#$table->setColNoWrap(2,1);                     # Sets the no-wrap property of a colum. 0=Wrap 1=NoWrap

# The following lines allow you to retrieve information about the table that was created.
my $row_count = $table->getTableRows;          # Retrieves the number of rows in the table
my $column_count = $table->getTableCols;       # Retrieves the number of columns in the table

# Finally, print the finalized table HTML
$table->print;

# Wrap up the STH and DBH if needed
$sth->finish;
$mysql_dbh->disconnect;

sub DidItMatch
{
        my $text = shift;
        if ($text eq 'Good text')
        {
                return "Matched";
        } else
        {
                return "$text";
        }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T05:13:20.620

这是否更接近您想要实现的目标？

```
# display one HTML table row for each DB row
print "<table>\n";
while (my @row = $sth1->fetchrow_array) {
  print "<tr>".join("", map { "<td>${_}</td>" } @row)."</tr>\n";
}
print "</table>\n"; 
```

# wpf - 由于 SplashScreen 关闭 MessageBox，如何将 wpf MessageBox.Owner 设置为桌面窗口

> ID：576503
> 
> 赞同：13
> 
> 时间：2009-02-23T04:14:38.733
> 
> 标签：wpf, messagebox

我通过将位图的**构建操作**设置为 Splashscreen来使用WPF 中的**SplashScreen功能。**在初始屏幕后面，正在检查许可信息，如果失败，我会显示**MessageBox**。

 ****根据此[反馈](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=381980&wa=wsignin1.0)，这是因为 MessageBox.Owner 是启动屏幕，并且一旦打开另一个窗口，即使它是 MessageBox，启动屏幕窗口也会关闭，然后又关闭 MessageBox，因此用户永远不会看到消息框。

所以解决方法是将 MessageBox.Owner 设置为另一个窗口，但这意味着我必须实例化另一个可能甚至不需要的窗口。

是否可以将 MessageBox.Owner 设置为桌面窗口？以及如何，因为唯一想到的其他函数是**GetDesktopWindow()** api 函数，但它返回一个窗口句柄，而 MessageBox.Owner 是一个 WPF 窗口。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-03-16T16:40:13.297

由于使用桌面窗口作为模态对话框的父级不是一个好主意，正如@Nir 在他的回答中指出的那样，这里有其他三种解决方法：

1）使用隐藏窗口。创建一个微小的非模态窗口作为 MessageBox 或其他模态对话框的父级。此处描述了此方法：

[http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/116bcd83-93bf-42f3-9bfe-da9e7de37546/](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/116bcd83-93bf-42f3-9bfe-da9e7de37546/)

2) 创建非模态消息窗口。将您的启动模式更改为显式关闭并使用非模式窗口来显示您的消息。此方法在此 StackOverflow 问题的答案中进行了描述：

[如果在 WPF 4.0 中使用闪屏，带有异常详细信息的 MessageBox 会立即消失](https://stackoverflow.com/questions/3891719/messagebox-with-exception-details-immediately-disappears-if-use-splash-screen-in)

3) 调用 MessageBox 两次。显然，该问题仅影响显示的第一个模态对话框。因此，如果您不介意第一个打开和关闭的闪烁，您可以简单地调用您的模态对话框两次。

[https://connect.microsoft.com/VisualStudio/feedback/details/600197/wpf-splash-screen-dismisses-dialog-box](https://connect.microsoft.com/VisualStudio/feedback/details/600197/wpf-splash-screen-dismisses-dialog-box)

就个人而言，我不喜欢任何这些变通方法。唯一的其他选择是避免内置的 SplashScreen 功能并从头开始滚动您自己的功能。如果您想进一步调查该路线，请点击以下链接：

[http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/8dd49fd0-9cc9-43c6-b285-6f119ab8a32e/](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/8dd49fd0-9cc9-43c6-b285-6f119ab8a32e/)

最后，如果你和我一样对这个问题感到恼火，你可以在这里投票支持微软修复这个错误：

[http://connect.microsoft.com/VisualStudio/feedback/details/600197/wpf-splash-screen-dismisses-dialog-box](http://connect.microsoft.com/VisualStudio/feedback/details/600197/wpf-splash-screen-dismisses-dialog-box)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-06-01T17:08:04.460

我自己想出了这个解决方案，所以也许它有问题，但它似乎工作得很好：

```
Window temp = new Window() { Visibility=Visibility.Hidden };
temp.Show();
MessageBox.Show(temp, "An error occurred before the application could start.\n\nTechnical Details: " + ex.Message, "Fatal Error", MessageBoxButton.OK, MessageBoxImage.Stop);
App.Current.Shutdown(1); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T04:27:52.663

我发现了问题。我还使用了导致此问题的内置启动画面：[WPF SplashScreen closes MessageBox](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=381980&wa=wsignin1.0)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T04:20:52.587

你能发布一些代码吗？我刚刚尝试将其添加到新 WPF 应用程序中的 App.xaml.cs 文件中：

```
protected override void OnStartup(StartupEventArgs e)
{
    if (MessageBox.Show("Start app?", "Confirm Start", 
        MessageBoxButton.YesNo) == MessageBoxResult.No)
    {
        this.Shutdown();
        return;
    }

    this.StartupUri = new Uri("Window1.xaml", UriKind.Relative);
    base.OnStartup(e);
} 
```

...并且它按预期工作（“确认开始”提示保持打开状态，直到我做出回应，如果我点击“否”，应用程序将关闭）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-24T15:38:05.090

桌面窗口永远不是正确的父窗口，请阅读此内容以了解原因：

[http://blogs.msdn.com/oldnewthing/archive/2004/02/24/79212.aspx](http://blogs.msdn.com/oldnewthing/archive/2004/02/24/79212.aspx)

现在这篇文章中描述的问题并没有发生太多，因为 MS 解决了它，在这篇文章中你可以看到：

[http://blogs.msdn.com/oldnewthing/archive/2006/11/02/931674.aspx](http://blogs.msdn.com/oldnewthing/archive/2006/11/02/931674.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-07-29T13:43:47.920

这个问题仍然是一个问题，我最近遇到了它。对我来说，解决方案是在出现任何问题时立即关闭启动屏幕：

```
 SplashScreen splash = new(Assembly.GetAssembly(typeof(GuiApp))!, "Resources/img_my.png");
        splash.Show(false);

        using ServiceProvider? services = initializeApp();

        if (services == null)
        {
            splash.Close(TimeSpan.Zero);
            return -3;
        } 
```

之后 MessageBox 正常显示。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-07-15T10:45:08.003

这对我帮助很大......给了我新的想法，但我在这里看到的示例代码需要一些修改

这是 wpf 中的一个简单示例，现在可以修改

点击按钮

粘贴此代码

if (System.Windows.Forms.MessageBox.Show("你确定", "delete", System.Windows.Forms.MessageBoxButtons.YesNo, System.Windows.Forms.MessageBoxIcon.Question) == System.Windows.Forms. DialogResult.Yes) { this.Close(); } else { MessageBox.Show("为什么不删除"); }

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2014-03-22T14:05:20.463

这与 OP 的情况没有直接关系，但对于在某些特殊情况下 MessageBox 隐藏在其他窗口后面时遇到问题的其他人可能有用。

正如@dthrasher 提到的，一种解决方案是使用隐藏的虚拟窗口。但有时即使这样也不够。我遇到的情况是，解决方案不仅是使用隐藏的虚拟窗口，而且每当我将它与 MessageBox 一起使用时都打开它的 TopMost 属性。

```
 _formKludge.TopMost = true;

     MessageBox.Show(_formKludge, "Nice informative message.", "Super-duper Program",
                     MessageBoxButtons.OK, MessageBoxIcon.Error);

     _formKludge.TopMost = false; 
```

# c# - 编译/运行带有我的用户控件的 ASP.NET 项目时，TypeConverter/InstanceDescriptor 失败

> ID：576509
> 
> 赞同：1
> 
> 时间：2009-02-23T04:16:16.623
> 
> 标签：c#

我遇到了 TypeConverter/InstanceDescriptor 的问题。

我有一个名为 MyClass 的课程

```
public class MyClass
{
    private ICollection<Color> _colors;
    public MyClass(ICollection<Color> colors)
    {
        _colors = colors;
    }

    public MyClass(string colors)
    {
        if("MyColors".equals(colors))
        {
        .
        .
        .
        }
    }

    .
    .
    .
} 
```

MyUserControl 具有 MyClass 类型的属性 MyProperty。

现在，当我拖放此属性并更改其值以便生成 xml 代码时。现在，我编译并最终出现此错误“对象引用未设置为对象的实例”

```
public static ColorGenerator FromString(object value)
{
    TypeConverter tc = TypeDescriptor.GetConverter(typeof(MyClass));
    if (tc.CanConvertFrom(typeof(string)))
        return tc.ConvertFrom(null, null, value) as MyClass;
    else return null;
}
.
.
.
if(destinationType == typeof(InstanceDescriptor))
{
    MethodInfo mi = typeof(MyTypeConverter).GetMethod("FromString", BindingFlags.Public | BindingFlags.Static, null, new Type[] { typeof(string) }, null);
     return new InstanceDescriptor(mi, new object[] { "MyColors" }, true);
}
.
.
. 
```

如果我的逻辑如下，那么我最终会得到“无法为‘MyNamespace.MyClass’类型的值生成代码。尝试为 MyClass 生成属性值时发生此错误。” 编译时出错。

```
.
.
.
if(destinationType == typeof(InstanceDescriptor))
{
            ConstructorInfo ci = typeof(MyClass).GetConstructor(new Type[] { typeof(string) });
            InstanceDescriptor descriptor = new InstanceDescriptor(ci, new object[] { "LightColors" });
            return descriptor;
}
.
.
. 
```

谁能向我解释这些错误是什么意思，以及为什么会发生？

提前一百万谢谢，Anony。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-24T05:20:23.513

我通过以下方式解决了这个问题： 1\. 在 MyClass 上使用了 TypeConverterAttribute 2\. 在 MyClass 上创建了一个静态属性，它返回 MyClass 的静态只读实例 3\. 在 ConvertTo() 方法中，我创建了 InstanceDescriptor，它采用对应于新的 PropertyInfo MyClass 的静态属性。

... :)

事情进展顺利。

-匿名

# visual-studio-2008 - 在代码中需要一个很好的 LinqDataSource 示例，而不是标记

> ID：576512
> 
> 赞同：3
> 
> 时间：2009-02-23T04:18:11.923
> 
> 标签：visual-studio-2008, linq, linq-to-sql, linqdatasource

任何人都有一个完全用代码设置 LinqDataSource 的好例子吗？我不需要帮助编写 LINQ 查询。我只需要帮助设置代码流。我想在代码中执行此操作的原因是因为我需要的查询的复杂性超出了 LinqDataSource 向导的功能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T21:00:13.403

*好吧，您可以通过设置*指定您的意思吗？这是一个如何创建`LinqDataSource`并准备使用的示例：

```
LinqDataSource source = new LinqDataSource();
source.ContextTypeName = "MyDataContext";
source.TableName = "MyTable";
source.Select = "new (Id As MyId, Name As MyName)";
source.Where = "Id > 1"; 
```

要改为以编程方式构造查询，您可以这样做：

```
LinqDataSource source = new LinqDataSource();
source.ContextTypeName = "MyDataContext";
source.Selecting += source_Selecting;
...
void source_Selecting(object sender, LinqDataSourceSelectEventArgs e)
{
    e.Result = from number in numbers where number > 1 select number;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-09T13:28:03.793

[这](http://johanleino.spaces.live.com/blog/cns!6BE273C70C45B5D1!328.entry)是与 SharePoint 和 SPGridView 相关的，但它可能会对您有所帮助。

# java - Android下载二进制文件问题

> ID：576513
> 
> 赞同：72
> 
> 时间：2009-02-23T04:18:33.373
> 
> 标签：java, android, download, httpurlconnection, fileoutputstream

我在从 Internet 下载我的应用程序中的二进制文件（视频）时遇到问题。在 Quicktime 中，如果我直接下载它，它可以正常工作，但是通过我的应用程序它会变得一团糟（即使它们在文本编辑器中看起来完全一样）。这是一个例子：

```
 URL u = new URL("http://www.path.to/a.mp4?video");
    HttpURLConnection c = (HttpURLConnection) u.openConnection();
    c.setRequestMethod("GET");
    c.setDoOutput(true);
    c.connect();
    FileOutputStream f = new FileOutputStream(new File(root,"Video.mp4"));

    InputStream in = c.getInputStream();

    byte[] buffer = new byte[1024];
    int len1 = 0;
    while ( (len1 = in.read(buffer)) > 0 ) {
         f.write(buffer);
    }
    f.close(); 
```

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-02-23T04:45:10.313

我不知道这是否是唯一的问题，但你有一个经典的 Java 故障：你没有指望 read()*总是*允许返回比你要求的字节少的事实。因此，您的读取可能会获得少于 1024 个字节，但您的写入始终会准确地写出 1024 个字节，可能包括来自前一个循环迭代的字节。

正确：

```
 while ( (len1 = in.read(buffer)) > 0 ) {
         f.write(buffer,0, len1);
 } 
```

也许 Android 上更高延迟的网络或更小的 3G 数据包大小正在加剧这种影响？

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-05-12T15:04:30.133

```
new DefaultHttpClient().execute(new HttpGet("http://www.path.to/a.mp4?video"))
        .getEntity().writeTo(
                new FileOutputStream(new File(root,"Video.mp4"))); 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-23T04:43:42.830

一个问题是您对缓冲区的读取。如果输入流的每次读取都不是 1024 的精确倍数，您将复制错误数据。采用：

```
byte[] buffer = new byte[1024];
int len1 = 0;
while ( (len1 = in.read(buffer)) != -1 ) {
  f.write(buffer,0, len1);
} 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2010-12-10T06:13:42.483

```
 public class download extends Activity {

     private static String fileName = "file.3gp";
     private static final String MY_URL = "Your download url goes here";

     @Override
     public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);

        try {
            URL url = new URL(MY_URL);
            HttpURLConnection c = (HttpURLConnection) url.openConnection();
            c.setRequestMethod("GET");
            c.setDoOutput(true);
            c.connect();

            String PATH = Environment.getExternalStorageDirectory()
                + "/download/";
            Log.d("Abhan", "PATH: " + PATH);
            File file = new File(PATH);
            if(!file.exists()) {
               file.mkdirs();
            }
            File outputFile = new File(file, fileName);
            FileOutputStream fos = new FileOutputStream(outputFile);
            InputStream is = c.getInputStream();
            byte[] buffer = new byte[1024];
            int len1 = 0;
            while ((len1 = is.read(buffer)) != -1) {
                fos.write(buffer, 0, len1);
            }
            fos.flush();
            fos.close();
            is.close();
        } catch (IOException e) {
            Log.e("Abhan", "Error: " + e);
        }
        Log.i("Abhan", "Check Your File.");
    } 
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-04-20T17:59:31.573

我根据之前对该线程的反馈修复了代码。我使用 eclipse 和多个大文件进行了测试。它工作正常。只需将其复制并粘贴到您的环境中，然后更改 http 路径和您希望将文件下载到的位置。

```
try {
    //this is the file you want to download from the remote server
    String path ="http://localhost:8080/somefile.zip";
    //this is the name of the local file you will create
    String targetFileName
        boolean eof = false;
    URL u = new URL(path);
    HttpURLConnection c = (HttpURLConnection) u.openConnection();
    c.setRequestMethod("GET");
    c.setDoOutput(true);
    c.connect();
    FileOutputStream f = new FileOutputStream(new File("c:\\junk\\"+targetFileName));
        InputStream in = c.getInputStream();
        byte[] buffer = new byte[1024];
        int len1 = 0;
        while ( (len1 = in.read(buffer)) > 0 ) {
        f.write(buffer,0, len1);
                 }
    f.close();
    } catch (MalformedURLException e) {
    // TODO Auto-generated catch block
    e.printStackTrace();
    } catch (ProtocolException e) {
    // TODO Auto-generated catch block
    e.printStackTrace();
    } catch (FileNotFoundException e) {
    // TODO Auto-generated catch block
    e.printStackTrace();
    } catch (IOException e) {
    // TODO Auto-generated catch block
    e.printStackTrace();
} 
```

祝你好运 Alireza Aghamohammadi

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-04-20T10:41:03.010

只需使用 apache 的复制方法（[Apache Commons IO](http://commons.apache.org/io/download_io.cgi)）——使用 Java 的优势！

```
IOUtils.copy(is, os); 
```

不要忘记在 finally 块中关闭流：

```
try{
      ...
} finally {
  IOUtils.closeQuietly(is);
  IOUtils.closeQuietly(os);
} 
```

# c# - 将自定义对象数据显示到 ListBox WPF

> ID：576515
> 
> 赞同：7
> 
> 时间：2009-02-23T04:20:28.987
> 
> 标签：c#, wpf

我在 WPF 应用程序中有一个 ListBox：

```
<ListBox HorizontalAlignment="Left" Margin="16,37,0,16" Name="lbEmpList" Width="194" SelectionChanged="lbEmpList_SelectionChanged" FontSize="12" SelectionMode="Single">

</ListBox> 
```

我有三个按钮：添加、删除和更新，它们将向列表框中添加、删除和更新项目。我将 Items 添加到我的自定义类对象名称*objEmployee*的 ListBox 中。这个自定义类包含几个属性：Id、Name、Address。
但是，当我将对象添加到 ListBox 时，它会将项目显示为

```
<Namespace Name>.<Custom Object name> 
```

如何在设计或运行时将任何对象属性绑定到此 ListBox 以实现我的功能？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-23T04:37:56.057

几个选项：

第一个也是最简单的选项是将 ListBox 的[DisplayMemberPath](http://msdn.microsoft.com/en-us/library/system.windows.controls.itemscontrol.displaymemberpath.aspx)属性设置为自定义对象的属性。因此，如果您的 Employee 类具有 LastName 属性，您可以这样做：

```
<ListBox DisplayMemberPath="LastName" ... /> 
```

如果您想更好地控制为每个项目显示的数据（包括自定义布局等），那么您需要为 ListBox 中的每个项目定义一个[DataTemplate](http://msdn.microsoft.com/en-us/library/ms742521.aspx)。最简单的方法是简单地设置 ListBox 的[ItemTemplate](http://msdn.microsoft.com/en-us/library/system.windows.controls.itemscontrol.itemtemplate.aspx)属性：

```
<ListBox ...>
    <ListBox.ItemTemplate>
        <DataTemplate>
            <StackPanel>
                <TextBlock Text="{Binding FirstName}" />
                <TextBlock Text="{Binding LastName}" />
            </StackPanel>
        </DataTemplate>
    </ListBox.ItemTemplate>
</ListBox> 
```

阅读我提供的链接并查看 MSDN 上的一些示例代码。

# asp.net - 从命令行运行 Web 应用程序代码？

> ID：576517
> 
> 赞同：0
> 
> 时间：2009-02-23T04:21:18.373
> 
> 标签：asp.net, linq-to-sql, build, sqlmetal

我有一个 ASP.NET Web 应用程序，其中包含用于执行其自己的数据库模式的代码；此代码在应用程序启动时运行。

我最近开始使用 LINQ to SQL，并添加了一个预构建事件来在我的数据库上运行 SqlMetal，以便我获得代表我的数据库表的对象。

如果我可以在预构建事件中强制执行数据库模式，然后运行 ​​SqlMetal，那将是非常酷的。实际上，如果架构发生变化（例如，我向表中添加了一个字段），我必须 (a) 构建并运行网站一次，以便应用程序启动并强制执行架构，然后 (b) 再次构建它以便 SqlMetal 运行。

那么：从命令行运行 Web 应用程序中的代码有哪些选择？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T04:31:34.543

这就是我们所做的。

我们有一个本地一键式构建，需要在签入前运行（集成构建也在每次签入时在单独的环境中运行......）。

NANT 脚本将：

1.  [使用Tarantino](http://code.google.com/p/tarantino/wiki/DatabaseChangeManagement)从头开始​​重建数据库（数据库变更管理）
    *   清理和编译
    *   将 DLL 复制到单独的目录
    *   针对 DLL 运行单元测试

我们有一个单独的 SQL Metal 脚本，但你的问题是让我看看在步骤 1 和 2 之间插入调用。这样你的数据库更改和 linq 生成的文件总是同步的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T04:38:07.727

您可以编写一个使用 CodeDOM 来解释存储库中的文件的小程序，也可以在预构建事件中直接调用编译器可执行文件。

使用 CodeDOM 可以避免任何必须知道编译器可执行文件在哪里的问题，但是如果您的代码不能包含在没有任何依赖关系的文件中，那么它就无法使用并调用编译器，那么执行结果是一个更好的选择。

# bash - 在 bash 脚本中从 HTML 字符引用更改为 utf-8，即。ā 变成 ā

> ID：576523
> 
> 赞同：5
> 
> 时间：2009-02-23T04:27:02.590
> 
> 标签：bash, utf-8, character-encoding

您将如何将包含以下字符引用的文档翻译成 bash 脚本中的实际可读字符？

```
&#257; &#225; &#462; &#224; &#275; &#233; &#283; &#232; &#299; &#237; &#464; &#236; &#470; &#472; &#474; &#476; &#252; &#470; &#472; &#474; &#476; &#252; 
```

这些变化为 ā á ǎ à ē é ě è ī í ǐ ǖ ǘ ǚ ǜ ü ǖ ǘ ǚ ǜ ü

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T04:53:02.557

如果您可以访问 Perl，那么它相对简单：

```
perl -ne 'binmode STDOUT,":utf8";s/&#([0-9]*);/pack("U",$1)/eg;print' \
  document.html 
```

例子：

```
#!/bin/bash
html2utf8() {
  perl -ne 'binmode STDOUT, ":utf8"; s/&#([0-9]*);/pack("U",$1)/eg; print'
}
echo 'testing 1 &#257; 2 &#300; 3 &#275;' | html2utf8 
```

产生：

```
testing 1 ā 2 Ĭ 3 ē 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-18T03:16:59.253

如果您正在寻找一种仅用于 bash 的方法，那么该线程中似乎有一些解决方案： http: [//forums.gentoo.org/viewtopic-t-820377-view-previous.html?sid=b35246f20410ba95ee048970d01ac6b3](http://forums.gentoo.org/viewtopic-t-820377-view-previous.html?sid=b35246f20410ba95ee048970d01ac6b3)

# javascript - 推荐一个同时处理日期和时间的 JS 日历小部件？

> ID：576524
> 
> 赞同：5
> 
> 时间：2009-02-23T04:27:13.400
> 
> 标签：javascript, datetime, datepicker, date, widget

我正在开发一个用户需要输入日期和时间的 Web 应用程序。我以前使用过这个日历小部件，它工作正常：

[http://www.dynarch.com/projects/calendar/](http://www.dynarch.com/projects/calendar/)

但是，它自 2005 年以来一直没有更新。我想知道是否有人知道更好的。

jQuery UI 中的日历不处理时间。只有日期。我需要一些能让用户使用一个控件同时输入日期和时间的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T04:55:45.547

我不知道有任何单个小部件可以很好地处理日期和时间。我见过的任何组合小部件都过于复杂和混乱。

然而，我经常使用独立的日期和时间小部件： [ClockPick](http://www.jnathanson.com/index.cfm?page=jquery/clockpick/ClockPick)和[datePicker](http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/)。两者都是[jQuery](http://jquery.com)插件，可以跨浏览器很好地工作，并且非常容易定制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T04:36:20.833

我认为不存在任何可以同时处理日期**和**时间的东西（至少没有什么真正好的）。

一般的做法似乎是使用下拉列表或其中的一些变体。如果您正在寻找更灵活的东西，有一个用于时间选择器的 jQuery 插件，它模仿 Google 日历时间选择器界面，我觉得它非常有用。

[http://labs.perifer.se/timedatepicker/](http://labs.perifer.se/timedatepicker/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-29T08:59:34.750

我为 jQueryUI 找到了一个相当不错的 datetimepicker。这是[Trent Richardson 的 timepicker 插件](http://trentrichardson.com/examples/timepicker/)。

到目前为止它工作得很好，并且可以进行大量定制以支持 i18n 和样式。由于我将它插入现有系统，我无法使用 jQueryUI 主题，但这不是实际问题。加载主题后，我例如为 .ui-datepicker-header 值设置不同的背景图像。

将 datetimepicker 添加到输入元素时，您还可以通过传递具有相应键值对的对象来覆盖所有字符串和格式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-01-25T21:25:22.633

我意识到这个问题是前段时间提出的，没有双关语的意思。[但这是您使用Kendo UI](http://demos.kendoui.com/web/datetimepicker/index.html)寻找的一个很好的例子

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-05T15:04:40.747

嗯，jscalendar 也可以配置为提供时间选择器，方法是在设置参数中设置 showTime:true。而且还应该设置singleClick：false，我猜......

可悲的是，它似乎无法正常工作。当前时间不会从 inputField 中读出，即使它已经被 jscalendar 自己写入。因此，更改日期后，时间设置回 0:0 :-(

如果你解决这个问题，请告诉我，如何:-)

克里斯托夫

# model-view-controller - MVP 模式：多个 Presenter 应该解耦还是可以直接通信？

> ID：576529
> 
> 赞同：4
> 
> 时间：2009-02-23T04:29:52.207
> 
> 标签：model-view-controller, mvvm, mvp

我有一个看起来像这样的用户界面：

```
 +--------+---------------+
    | model1 | model details |
    | model2 |     here,     |
    | model3 | loaded as the |
    |        | user selects  |
    |        | a model from  |
    |        |   the left.   |
    |        |               |
    +--------+---------------+ 
```

我正在使用[MVP 模式](https://stackoverflow.com/questions/2056/what-are-mvp-and-mvc-and-what-is-the-difference/101561#101561)来驱动这个 ui。

我在这里简化了很多，但为了分而治之，我想将 Presenter 分成两部分：一个处理左侧视图中的用户手势（用户更改此视图中的模型列表，例如排序）另一个 Presenter 在右侧的 View 中处理用户手势（用户更改此 View 中的单个模型）。

虽然左侧的 Presenter 与整个模型列表交互，但右侧的 Presenter 仅与单个模型交互：用户从左侧列表中选择的模型。IOW ui 是从左到右驱动的。

在用户选择（即单击）左侧的模型后，我当前的实现（大致）如下所示：

```
LeftPresenter.onModelClick = function(event) {
    var model = this.getModelFromEvent(event);
    this.view.setSelectedModel(model); // updates list widget on left
    RightPresenter.setSelectedModel(model); // notify the other Presenter
}

RightPresenter.setSelectedModel = function(model) {
    // lazy load the model from the db, and update the
    // view when the model fires the "loadComplete" event
    model.bind('loadComplete', this.view.setModel);
    model.lazyLoad();
} 
```

这是我对 MVP 模式或任何 MVC GUI 模式的模糊部分：

1.  一个 ui 可以像这样由多个 Presenter 驱动吗？
2.  是否应该解耦多个 Presenter，或者他们可以直接相互通信，如此处所示？

所以我的问题归结为：表明用户在**视图****中选择模型****的最佳方式是`RightPresenter``LeftPresenter`**什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T15:56:43.337

*1\. 一个ui可以这样由多个Presenter驱动吗？*

是的

*2\. 多个 Presenter 应该解耦还是可以直接相互通信，如图所示？*

我处理它的方式是我有一个看起来像这样的框架

当事件发生时，UI_Object 处理创建和触发 Command 对象的事件。每个 UI_Object 都实现了一个在 UI_Views 中找到的视图接口，并将自己注册到 UI_View。Command Objects 可以通过接口访问 UI_View 中注册的 UI Object。

例如，在我的一个金属切割应用程序中，有一个名为 HOLD 的屏幕元素，其中包含所有尚未放置在金属板上进行切割的零件。零件可以通过多种方式进入货舱。从零件文件加载，由形状编辑器创建，由我们的 CAD 屏幕创建，或从金属板上拾取。

这些操作中的每一个都被封装到实现命令设计模式的单独命令对象中。当命令对象执行时它调用。

```
CuttingScreen.Refresh
CADScreen.Refresh
ShapeEditor.Refresh 
```

这些中的每一个都将刷新相应的屏幕以更新保持。

现在我可以向我的应用程序界面添加一个方法。MyCuttingApplication.HoldRefresh 将依次调用所有三个刷新。

但重要的一点是，您的视图调用了一个命令，该命令使用视图实现的接口进行更新。视图对象在较低层中注册自己。

# .net - “死是真棒”是首选吗？

> ID：576532
> 
> 赞同：18
> 
> 时间：2009-02-23T04:33:17.753
> 
> 标签：.net, exception, architecture, exception-handling, crash

最近我参加了 Jeffrey Richter 的关于 .NET 的培训课程。他提到了一种编码策略“死是真棒”。也就是说，即使在程序或事件循环的根部也不要写“catch (Exception ex)”。如果抛出了一些未处理的异常，就让进程死掉。

我不确定这是否正确。就个人而言，我更喜欢`try {...} catch(Exception ex) {log and try to recover}`在执行的顶层有一个“”来包装。实际上，如果从 asXx 抛出任何异常，ASP.NET 不会死。如果它确实因异常而死，那么一个灵丹妙药的请求可以使整个服务保持沉默。

你怎么看？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-02-23T04:40:18.533

我认为这取决于您正在运行什么样的应用程序以及“死亡”的后果是什么。对于许多客户端应用程序来说，死亡真是太棒了。对于服务器，通常不是那么多（吞下日志是合适的）。没有一种万能的解决方案。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-23T04:44:22.920

也称为进攻性编程。

您应该查看“[进攻性编程：早期崩溃，经常崩溃](http://blogs.23.nu/c0re/offensive-programming-crash-early-crash-often/)”。

[这是与防御性编程](http://en.wikipedia.org/wiki/Defensive_programming)规范截然不同的意识形态：

> [防御性编程]旨在确保该软件的持续功能，尽管该软件的使用不可预见。

我个人喜欢“早期崩溃，经常崩溃”的理念。

我见过太多了：

```
try  
{  
    // ... Huge block of code goes here  
}  
catch(Exception ex)  
{  
   // Do nothing...  
} 
```

这比用力撞车要糟糕得多。如果异常处理得当，那么一点防御性编程就可以了。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-23T04:38:11.050

这一切都取决于您如何处理异常。如果您只在发生真正异常的事情时抛出异常（而不是在数据库查询没有返回结果或格式错误时），那么您真的不需要捕获异常。因为您的程序不应该能够恢复，所以您可以恢复的任何东西都不是异常，而是错误。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-23T06:43:46.877

**听起来像古鲁斯语**

这听起来像是*大师们*宣扬的另一条一般指导方针，它本身并不是一个坏建议。但是，该准则可以很容易地应用于不属于它的地方。我认为要记住您上面使用的关键短语是“一种编码策略”，因为这种策略在某些领域非常有用，但在其他领域可能非常有害。

死亡很棒——如果你*有*很多紧密耦合的组件，它们的状态相互依赖，那么异常很容易成为灾难性事件。但是，您的目标之一应该是以这样一种方式进行编码，即单个故障不必关闭整个系统（注意目标）。

您如何看待以下应用程序因普通异常而死亡：

*   医疗设备
*   发电厂
*   入侵检测系统

对于您在 try / catch 中捕获的异常 - 您确实应该期待它们并处理它们。对于所有其他情况，最好快速失败到预测的运行级别。那么，如果您在网络或 Web 处理程序中，为什么不直接终止当前操作呢？你真的需要整个应用程序崩溃吗？

如果您正在开发一个任务关键且具有公共界面的应用程序，这一点变得越来越重要。如果有可能导致应用程序关闭的异常情况，那么这将成为黑帽黑客意图造成拒绝服务攻击的攻击媒介。

滥用这种策略的极端案例有点太大了，无法给予太多赞扬。更好的方法是解决您的域问题。了解此策略的目的，并将适当的部分应用于您的问题。

警告：我在正常运行时间和安全性至关重要的服务器端系统上工作。

编辑：我想我对“进程死亡”的含义感到困惑——这是对整个应用程序的引用还是对正在运行的线程等的引用？

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-25T12:10:54.127

[Karl Seguin](http://codebetter.com/blogs/karlseguin/archive/2008/05/29/foundations-of-programming-pt-8-back-to-basics-exceptions.aspx)对异常处理说了以下几点：

1.  仅处理您实际上可以做某事的异常
2.  对于绝大多数异常你无能为力

很好的主题介绍。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-23T04:39:22.903

这是非常微软的。

MS 希望您将所有未处理的异常都扔给 WER。（Windows 错误报告，当应用程序崩溃时，您可以将错误发送给微软的对话框）

通过这种方式，您可以获得使用指标，并可以专注于导致客户悲伤的关键未处理异常。我相信这个想法是它迫使您考虑异常的来源。

但我完全同意你的看法。即使你重新抛出，你总是会在根目录下捕获一个未处理的，记录发生的事情。唯一的问题是，如果您未处理的 ex 内存不足，在这种情况下，您对 log 的调用可能会失败，因为 JIT 无法分配更多内存等。我认为 C++ 程序通过占用内存来处理这个问题，在未处理的异常上释放它，然后运行一个非常紧凑的日志例程来尝试优雅地失败。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-23T04:39:43.777

我不熟悉 Richter 的材料，但我认为哲学/理由是，在绝大多数情况下，程序实际上无法从未处理和意外的异常中恢复。

然而，让程序在用户面前死掉并不是一个好主意——它会留下非常糟糕的印象。我更喜欢将未处理的异常记录到数据库中，通知开发人员并跟踪它们以确保它们得到修复。

再说一次，我正是为了这个目的而销售产品，所以我在这方面有点偏见！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-23T04:59:30.093

如果你不能充分处理这个问题——如果它不是拒绝某种形式的错误输入（这包括你试图从磁盘或网络中读取的东西）你可能不能——那么你应该死。除非你 100% 确定你可以安全地继续，否则不要。

但是，我不会简单地放过一个例外。抓住它并尽可能多地收集信息。如果您的程序操作某种文档，请将其保存在*一个新名称*下——它可能已损坏，您不想覆盖原始文件。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-23T06:18:00.887

没有什么比堆栈跟踪更快地破坏用户信心了。至少，捕获异常并记录尽可能多的信息。然后向用户提供友好的消息和说明，说明如何解决问题或将问题报告给支持人员。

这里有关于继续处于不确定状态的担忧。如果这是一个网络应用程序，那么这不是问题，除非您过度依赖会话和应用程序状态。如果这是一个 Windows 应用程序，请随时退出（在让用户有机会保存之后）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-23T09:47:44.080

由于您不知道 Exception 的每个子类是什么，因此您根本无法知道捕获它们是可以的。因此，您应该注意自己的事情：捕获您知道和关心的异常，这主要是您为自己的程序显式创建的异常，或者为您正在使用的库调用中的错误创建的异常。特别是，捕获 Exception 类只是懒惰、糟糕的编程 --- 本质上，您是在说“我不在乎问题是什么，也不要告诉我；就这样做吧。” 看看 java 程序如何处理异常，因为那里的异常处理实践通常都很好。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-23T04:40:03.087

您的客户期望什么？

这一切又回到了那个。如果客户可以处理程序死亡并且他们可以重新启动它，那就这样吧。

有时，最好让一个进程终止并创建另一个进程来处理请求。

有时，最好尝试解决问题。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-23T04:43:06.433

我说你应该总是有一个根异常捕获器......特别是如果你可以在异常中加入某种信息，说明出了什么问题，代码或其他东西并将其打印给用户。然后，用户可以随时询问您（或支持或其他）出了什么问题并提供一些信息......而不是“它因保护故障而崩溃”

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-23T06:05:42.430

根本不处理任何异常有一个优点。如果出现问题，您宁愿崩溃并让用户抱怨，而不是让程序在不确定的状态下继续运行。

例如，如果您正在编写一个实时交易系统，并且出现意外错误，您最好让它崩溃。否则，您的程序可能会继续运行并进行愚蠢的交易。用户会马上抱怨“WTF？”，但至少你不会损失数百万美元。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-23T09:05:56.367

这里已经有了很棒的答案，尤其是 Simucal。我只想补充一点：

攻击性编程非常适合调试。根据我的经验，“早期失败，经常失败”可以被认为是为代码中的错误设置陷阱。当出现问题时——无论是内存泄漏、内存踩踏、意外 NULL 等——如果程序立即失败（以及相关的调试数据，如调用堆栈），通常更容易发现问题。

防御性编程非常适合生产环境。应用程序发布后，您可能不希望最终用户看到一个漂亮的小对话框，上面写着“foo() 处未处理的异常”。如果您的应用程序处于测试阶段并且您仍在收集调试信息，那可能会很棒，但如果您正在发布一个稳定的应用程序，您可能只是不想在某些事情确实失败的罕见情况下用神秘的输出打扰用户。

有时你可以同时拥有它。我经常按照以下几行编写 C 代码：

```
void foo(char* data) {
    ASSERT(data);
    if (!data) { return; }
    // ... work with data
} 
```

如果此代码是在测试环境中编译的，则 assert 语句会捕获错误条件。如果它是在生产环境中编译的，则断言会被预处理器删除，并且 foo() 会静默失败。

异常比断言更具表现力和灵活性，并且有多种方法可以管理它们，以便应用程序在测试环境中及早失败，并在生产环境中记录错误时继续前进。根据项目的类型，这种设计可能对您有意义。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-23T05:43:57.613

try catch 解决所有问题的问题在于，您通常最终会“处理”您不知道如何从中恢复的事情。用户会误以为事情进展顺利，但在内部你转向瑞士奶酪并最终以非常奇怪的方式打破。

另一方面，当他们也没有某种方式报告它时，将异常抛给用户并没有太大帮助

*   当您向 MS 注册时，新的 Windows 服务会提供该功能。
*   安装 drwatson 还可以捕获数据（转储文件）供您的用户手动发送给您。

如果您提供服务库并且它在进程中运行，如果您的服务与整个服务器混淆内存或设置等，那么当引发异常时服务器可能真的需要关闭。

根据合同，API 将倾向于提供一种方式来表示“我可以这样做”，然后提供一种方式来“执行它”，并且许多 API（如 MS 文件打开）将允许您在引发异常和返回错误代码之间进行切换。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-23T06:05:12.167

您始终可以设置自定义错误处理程序并忽略捕获您不准备处理的异常。如果满足正确的条件，试图从未知中恢复可能也会产生负面影响。但是话又说回来，这确实取决于异常是什么以及您如何处理它们。

另一方面 - 我认为人们会被整个“例外是邪恶的”心态所淹没。它们是一种工具，如果使用得当，可以带来惊人的好处。但是，许多人通过使用 catch(Exception) 包装 root 来滥用它们。

# cookies - Cookie 路径及其对子文件夹页面的可访问性

> ID：576535
> 
> 赞同：86
> 
> 时间：2009-02-23T04:34:24.053
> 
> 标签：cookies, httpcookie

假设我有一个域名为：www.example.com

如果我使用路径“ ***/*** ”设置 cookie，则该 cookie 将可以通过域中的所有页面访问，例如：

*   www.example.com/page1.html
*   www.example.com/subfolder1/page1.html
*   www.example.com/subfolder1/moresubfolder1/page1.html 等

如果我们将 cookie 设置为路径 ' ***/subfolder1*** '，该 cookie 将可用于该文件夹下的任何页面或子文件夹吗？例如：

*   www.example.com/subfolder1/moresubfolder/page1.html

所以，如果不是，我想，我别无选择，只能为这些 cookie 使用路径“/”，对吧？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-02-23T04:44:43.000

> 如果我们将 cookie 设置为路径**'/subfolder1'**，该 cookie 是否可用于该文件夹下的任何页面或子文件夹？

是的。该 cookie*将*可用于路径*中*的所有页面和子目录。`/subfolder1`

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2016-05-13T13:09:51.477

通过重用[这个](https://stackoverflow.com/a/8314164/575766)答案的一部分来消除一些歧义：

> 如果至少满足以下条件之一，则请求路径路径匹配给定的 cookie 路径：
> 
> *   cookie-path 和 request-path 是相同的。
> *   cookie-path 是 request-path 的前缀，cookie-path 的最后一个字符是 %x2F ("/")。
> *   cookie-path 是 request-path 的前缀，不包含在 cookie-path 中的 request-path 的第一个字符
>     是 %x2F ("/") 字符。

`/subfolder1`在路径和路径上设置 cookie 之间存在细微（但可能很重要）的区别`/subfolder1/`。

如果您依赖前者，您的请求路径需要以“%x2F ("/") 字符”（正斜杠）开头，以保证所需的行为。例如，查看链接的答案。

将 cookie 路径设置为简单地`/`避免任何边缘情况，但正如您所说 - cookie 可以在整个域中访问。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2014-07-14T10:16:42.510

如果我们将 cookie 设置为 path `/subfolder1`，则可以访问示例中的以下页面：

> www.example.com/subfolder1/page1.html
> www.example.com/subfolder1/moresubfolder1/page1.html
> 等。

但是，该页面`www.example.com/page1.html`将无法访问，因为它不属于允许的路径。

# perl - 如何在 Perl 中为未定义的值打印文字“null”？

> ID：576536
> 
> 赞同：3
> 
> 时间：2009-02-23T04:35:26.827
> 
> 标签：perl, null, undef

我正在运行一个查询“描述表”，它为“默认”列返回“空”值。但是，当我尝试将值从数据库打印到 HTML 表时，它不会打印“null”。它总是空白。

这就是我从数据库中存储数据的方式：

```
@nulls = ();

while (($null) = $sth1->fetchrow_array)
    {
    push (@nulls, $null);
    } 
```

当我打印数组的内容时，`@nulls`它从不打印'null'的字面值。它始终是空白的。有没有办法克服这个问题？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-23T05:25:55.303

正如 Chris J 所说，空值作为未定义值返回。

如果您启用了警告，您将在打印值时收到“未定义的打印值”警告。使用`strict`和`warnings`pragmata 可以节省大量的调试时间。`diagnostics`pragma 为标准警告和致命错误添加了额外的解释性文本。

捕获和替换来自数据库的 NULL 值非常容易：

```
use strict;
use warnings;

my @nulls = ();
while ((my $null) = $sth1->fetchrow_array)
    {
            # before perl 5.10: use the ternary operator.
            push @nulls, defined $null ? $null : 'NULL';

            # perl 5.10 adds the defined-or operator: //
            push @nulls, $null // 'NULL';
    } 
```

或者您可以`@nulls`按照上面显示的相同方式构建数组，然后在显示时更改空值。

```
my @pre_5_10  = map { defined $_ ? $_ : 'NULL' } @nulls;
my @perl_5_10 = map { $_ // 'NULL' } @nulls; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-23T04:45:34.510

从[http://metacpan.org/pod/DBI](http://metacpan.org/pod/DBI)，它将返回 null 值作为 'undef'。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T04:39:24.353

我不使用 Perl，但在我使用过的所有其他语言中，您必须测试 null 的值。如果为空，则打印出字符串文字“null”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T21:24:17.433

您没有说您使用的是什么数据库，但如果您不介意非便携式解决方案（例如在 Oracle 中），则可以在 SQL 级别执行此操作：

```
select NVL(some_column, 'NULL')
from some_table 
```

# delphi - Delphi，如何获取所有本地IP？

> ID：576538
> 
> 赞同：19
> 
> 时间：2009-02-23T04:36:17.467
> 
> 标签：delphi, winsock, ip

任何人都知道在delphi 中获取本地IP 地址的简单列表（例如tstrings）的方法。

我已经查看了其他相关问题，但似乎无法将它们转换为 delphi。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-30T00:33:13.210

在 indy 9 中，有一个单元 IdStack，其类为 TIdStack

```
fStack := TIdStack.CreateStack;
try
  edit.caption := fStack.LocalAddress;  //the first address i believe
  ComboBox1.Items.Assign(fStack.LocalAddresses); //all the address'
finally
  freeandnil(fStack); 
end; 
```

效果很好:)

来自 Remy Lebeau 的评论

> Indy 10 中也存在相同的情况，但代码略有不同：

```
TIdStack.IncUsage; 
try 
  GStack.AddLocalAddressesToList(ComboBox1.Items); 
  Edit.Caption := ComboBox1.Items[0]; 
finally 
  TIdStack.DecUsage; 
end; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-23T07:52:09.443

如果您使用 ICS 进行套接字通信，则可以使用在 OverbyteIcsWSocket 单元中定义的 LocalIPList 函数。

即使您不使用它，也可以下载源代码并查找实现。它在内部使用 WinSock。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-23T15:14:19.770

我在[这里发布了关于 SO 的解决方案](https://stackoverflow.com/questions/325872/detect-an-internet-connection-activation-with-delphi/331421#331421)。这将填充一个记录数组，其中包含系统上每个适配器的信息。这包括 IP 地址，还包括 MAC 地址、子网掩码、传输/接收数据包、描述等。

一旦你填充了记录数组，只需枚举它的 IP 地址，如果这就是你想要的。

这在 Linux 上模拟“ifconfig -a”：

```
C:\>ifconfig
0x00000001
"MS TCP Loopback interface"
        Link encap: Local loopback
        inet addr:127.0.0.1 Mask: 255.0.0.0
        MTU: 1520 Speed:10.00 Mbps
        Admin status:UP Oper status:OPERATIONAL
        RX packets:179805 dropped:0 errors:0 unkown:0
        TX packets:179804 dropped:0 errors:0 txqueuelen:0

0x00000002
"Broadcom NetXtreme 57xx Gigabit Controller - Packet Scheduler Miniport"
        Link encap: Ethernet HWaddr: XX-XX-XX-XX-XX-XX
        inet addr:10.101.101.102 Mask: 255.255.255.0
        MTU: 1500 Speed:100.00 Mbps
        Admin status:UP Oper status:OPERATIONAL
        RX packets:6287896 dropped:0 errors:0 unkown:0
        TX packets:5337100 dropped:0 errors:1 txqueuelen:0 
```

这是“ifconfig -a”项目的完整源代码。您还需要[获取我的辅助单元 (uAdapterInfo)](https://stackoverflow.com/questions/325872/detect-an-internet-connection-activation-with-delphi/331421#331421)并将其包含在此程序中。

```
program ifconfig;

{$APPTYPE CONSOLE}

uses
  SysUtils,
  Classes,
  Winsock,
  uAdapterInfo in 'uAdapterInfo.pas';

type
  TAdapterInfo = array of record
    dwIndex:    longint;
    dwType:     longint;
    dwMtu:      longint;
    dwSpeed:    extended;
    dwPhysAddrLen: longint;
    bPhysAddr:  string;
    dwAdminStatus: longint;
    dwOperStatus: longint;
    dwLastChange: longint;
    dwInOctets: longint;
    dwInUcastPkts: longint;
    dwInNUcastPkts: longint;
    dwInDiscards: longint;
    dwInErrors: longint;
    dwInUnknownProtos: longint;
    dwOutOctets: longint;
    dwOutUcastPkts: longint;
    dwOutNUcastPkts: longint;
    dwOutDiscards: longint;
    dwOutErrors: longint;
    dwOutQLen:  longint;
    dwDescrLen: longint;
    bDescr:     string;
    sIpAddress: string;
    sIpMask:    string;
  end;

  function Get_EthernetAdapterDetail(var AdapterDataFound: TAdapterInfo): boolean;
  var
    pIfTable: ^_IfTable;
    pIpTable: ^_IpAddrTable;
    ifTableSize, ipTableSize: longint;
    tmp:      string;
    i, j, k, m: integer;
    ErrCode:  longint;
    sAddr, sMask: in_addr;
    IPAddresses, IPMasks: TStringList;
    sIPAddressLine, sIPMaskLine: string;
    bResult:  boolean;
  begin
    bResult  := True; //default return value
    pIfTable := nil;
    pIpTable := nil;

    IPAddresses := TStringList.Create;
    IPMasks     := TStringList.Create;

    try
      // First: just get the buffer size.
      // TableSize returns the size needed.
      ifTableSize := 0; // Set to zero so the GetIfTabel function
      // won't try to fill the buffer yet, 
      // but only return the actual size it needs.
      GetIfTable(pIfTable, ifTableSize, 1);
      if (ifTableSize < SizeOf(MIB_IFROW) + Sizeof(longint)) then
      begin
        bResult := False;
        Result := bResult;
        Exit; // less than 1 table entry?!
      end;

      ipTableSize := 0;
      GetIpAddrTable(pIpTable, ipTableSize, 1);
      if (ipTableSize < SizeOf(MIB_IPADDRROW) + Sizeof(longint)) then
      begin
        bResult := False;
        Result := bResult;
        Exit; // less than 1 table entry?!
      end;

      // Second:
      // allocate memory for the buffer and retrieve the 
      // entire table.
      GetMem(pIfTable, ifTableSize);
      ErrCode := GetIfTable(pIfTable, ifTableSize, 1);

      if ErrCode <> ERROR_SUCCESS then
      begin
        bResult := False;
        Result := bResult;
        Exit; // OK, that did not work. 
        // Not enough memory i guess.
      end;

      GetMem(pIpTable, ipTableSize);
      ErrCode := GetIpAddrTable(pIpTable, ipTableSize, 1);

      if ErrCode <> ERROR_SUCCESS then
      begin
        bResult := False;
        Result := bResult;
        Exit;
      end;

      for k := 1 to pIpTable^.dwNumEntries do
      begin
        sAddr.S_addr := pIpTable^.table[k].dwAddr;
        sMask.S_addr := pIpTable^.table[k].dwMask;

        sIPAddressLine := Format('0x%8.8x', [(pIpTable^.table[k].dwIndex)]) +
          '=' + Format('%s', [inet_ntoa(sAddr)]);
        sIPMaskLine    := Format('0x%8.8x', [(pIpTable^.table[k].dwIndex)]) +
          '=' + Format('%s', [inet_ntoa(sMask)]);

        IPAddresses.Add(sIPAddressLine);
        IPMasks.Add(sIPMaskLine);
      end;

      SetLength(AdapterDataFound, pIfTable^.nRows); //initialize the array or records
      for i := 1 to pIfTable^.nRows do
        try
          //if pIfTable^.ifRow[i].dwType=MIB_IF_TYPE_ETHERNET then
          //begin
          m := i - 1;
          AdapterDataFound[m].dwIndex := 4;//(pIfTable^.ifRow[i].dwIndex);
          AdapterDataFound[m].dwType := (pIfTable^.ifRow[i].dwType);
          AdapterDataFound[m].dwIndex := (pIfTable^.ifRow[i].dwIndex);
          AdapterDataFound[m].sIpAddress :=
            IPAddresses.Values[Format('0x%8.8x', [(pIfTable^.ifRow[i].dwIndex)])];
          AdapterDataFound[m].sIpMask :=
            IPMasks.Values[Format('0x%8.8x', [(pIfTable^.ifRow[i].dwIndex)])];
          AdapterDataFound[m].dwMtu := (pIfTable^.ifRow[i].dwMtu);
          AdapterDataFound[m].dwSpeed := (pIfTable^.ifRow[i].dwSpeed);
          AdapterDataFound[m].dwAdminStatus := (pIfTable^.ifRow[i].dwAdminStatus);
          AdapterDataFound[m].dwOperStatus := (pIfTable^.ifRow[i].dwOperStatus);
          AdapterDataFound[m].dwInUcastPkts := (pIfTable^.ifRow[i].dwInUcastPkts);
          AdapterDataFound[m].dwInNUcastPkts := (pIfTable^.ifRow[i].dwInNUcastPkts);
          AdapterDataFound[m].dwInDiscards := (pIfTable^.ifRow[i].dwInDiscards);
          AdapterDataFound[m].dwInErrors := (pIfTable^.ifRow[i].dwInErrors);
          AdapterDataFound[m].dwInUnknownProtos := (pIfTable^.ifRow[i].dwInUnknownProtos);
          AdapterDataFound[m].dwOutNUcastPkts := (pIfTable^.ifRow[i].dwOutNUcastPkts);
          AdapterDataFound[m].dwOutUcastPkts := (pIfTable^.ifRow[i].dwOutUcastPkts);
          AdapterDataFound[m].dwOutDiscards := (pIfTable^.ifRow[i].dwOutDiscards);
          AdapterDataFound[m].dwOutErrors := (pIfTable^.ifRow[i].dwOutErrors);
          AdapterDataFound[m].dwOutQLen := (pIfTable^.ifRow[i].dwOutQLen);
          AdapterDataFound[m].bDescr := (pIfTable^.ifRow[i].bDescr);

          tmp := '';
          for j := 0 to pIfTable^.ifRow[i].dwPhysAddrLen - 1 do
          begin
            if Length(tmp) > 0 then
              tmp := tmp + '-' + format('%.2x', [pIfTable^.ifRow[i].bPhysAddr[j]])
            else
              tmp := tmp + format('%.2x', [pIfTable^.ifRow[i].bPhysAddr[j]]);
          end;

          if Length(tmp) > 0 then
          begin
            AdapterDataFound[m].bPhysAddr := tmp;
          end;
        except
          bResult := False;
          Result := bResult;
          Exit;
        end;
    finally
      if Assigned(pIfTable) then
      begin
        FreeMem(pIfTable, ifTableSize);
      end;

      FreeAndNil(IPMasks);
      FreeAndNil(IPAddresses);
    end;

    Result := bResult;
  end;

var
  AdapterData: TAdapterInfo;
  i: integer;
begin
  try
    WriteLn('');
    if Get_EthernetAdapterDetail(AdapterData) then
    begin
      for i := 0 to Length(AdapterData) - 1 do
      begin
        WriteLn(Format('0x%8.8x', [AdapterData[i].dwIndex]));
        WriteLn('"' + AdapterData[i].bDescr + '"');
        Write(Format(#9 + 'Link encap: %s ', [Get_if_type(AdapterData[i].dwType)]));

        if Length(AdapterData[i].bPhysAddr) > 0 then
          Write('HWaddr: ' + AdapterData[i].bPhysAddr);

        Write(#13 + #10 + #9 + 'inet addr:' + AdapterData[i].sIpAddress);
        WriteLn(' Mask: ' + AdapterData[i].sIpMask);
        WriteLn(Format(#9 + 'MTU: %d Speed:%.2f Mbps', [AdapterData[i].dwMtu,
          (AdapterData[i].dwSpeed) / 1000 / 1000]));
        Write(#9 + 'Admin status:' + Get_if_admin_status(AdapterData[i].dwAdminStatus));
        WriteLn(' Oper status:' + Get_if_oper_status(AdapterData[i].dwOperStatus));
        WriteLn(#9 + Format('RX packets:%d dropped:%d errors:%d unkown:%d',
          [AdapterData[i].dwInUcastPkts + AdapterData[i].dwInNUcastPkts,
          AdapterData[i].dwInDiscards, AdapterData[i].dwInErrors,
          AdapterData[i].dwInUnknownProtos]));
        WriteLn(#9 + Format('TX packets:%d dropped:%d errors:%d txqueuelen:%d',
          [AdapterData[i].dwOutUcastPkts + AdapterData[i].dwOutNUcastPkts,
          AdapterData[i].dwOutDiscards, AdapterData[i].dwOutErrors,
          AdapterData[i].dwOutQLen]));

        WriteLn('');
      end;
    end
    else
    begin
      WriteLn(#13+#10+'*** Error retrieving adapter information');
    end;
  except
    on E: Exception do
      Writeln(E.ClassName, ': ', E.Message);
  end;
end. 
```

这是您需要包括的辅助单元：

```
unit uAdapterInfo;

interface

uses
  Classes,
  SysUtils;

const
  MAX_INTERFACE_NAME_LEN = $100;
  ERROR_SUCCESS   = 0;
  MAXLEN_IFDESCR  = $100;
  MAXLEN_PHYSADDR = 8;

  MIB_IF_OPER_STATUS_NON_OPERATIONAL = 0;
  MIB_IF_OPER_STATUS_UNREACHABLE = 1;
  MIB_IF_OPER_STATUS_DISCONNECTED = 2;
  MIB_IF_OPER_STATUS_CONNECTING  = 3;
  MIB_IF_OPER_STATUS_CONNECTED   = 4;
  MIB_IF_OPER_STATUS_OPERATIONAL = 5;

  MIB_IF_TYPE_OTHER    = 1;
  MIB_IF_TYPE_ETHERNET = 6;
  MIB_IF_TYPE_TOKENRING = 9;
  MIB_IF_TYPE_FDDI     = 15;
  MIB_IF_TYPE_PPP      = 23;
  MIB_IF_TYPE_LOOPBACK = 24;
  MIB_IF_TYPE_SLIP     = 28;

  MIB_IF_ADMIN_STATUS_UP      = 1;
  MIB_IF_ADMIN_STATUS_DOWN    = 2;
  MIB_IF_ADMIN_STATUS_TESTING = 3;

  _MAX_ROWS_ = 20;
  ANY_SIZE   = 1;

type
  MIB_IFROW = record
    wszName:    array[0 .. (MAX_INTERFACE_NAME_LEN * 2 - 1)] of ansichar;
    dwIndex:    longint;
    dwType:     longint;
    dwMtu:      longint;
    dwSpeed:    longint;
    dwPhysAddrLen: longint;
    bPhysAddr:  array[0 .. (MAXLEN_PHYSADDR - 1)] of byte;
    dwAdminStatus: longint;
    dwOperStatus: longint;
    dwLastChange: longint;
    dwInOctets: longint;
    dwInUcastPkts: longint;
    dwInNUcastPkts: longint;
    dwInDiscards: longint;
    dwInErrors: longint;
    dwInUnknownProtos: longint;
    dwOutOctets: longint;
    dwOutUcastPkts: longint;
    dwOutNUcastPkts: longint;
    dwOutDiscards: longint;
    dwOutErrors: longint;
    dwOutQLen:  longint;
    dwDescrLen: longint;
    bDescr:     array[0 .. (MAXLEN_IFDESCR - 1)] of ansichar;
  end;

type
  MIB_IPADDRROW = record
    dwAddr:      longint;
    dwIndex:     longint;
    dwMask:      longint;
    dwBCastAddr: longint;
    dwReasmSize: longint;
    unused1:     word;
    unused2:     word;
  end;

type
  _IfTable = record
    nRows: longint;
    ifRow: array[1.._MAX_ROWS_] of MIB_IFROW;
  end;

type
  _IpAddrTable = record
    dwNumEntries: longint;
    table: array[1..ANY_SIZE] of MIB_IPADDRROW;
  end;

function GetIfTable(pIfTable: Pointer; var pdwSize: longint; bOrder: longint): longint;
  stdcall;
function GetIpAddrTable(pIpAddrTable: Pointer; var pdwSize: longint;
  bOrder: longint): longint; stdcall;

function Get_if_type(iType: integer): string;
function Get_if_admin_status(iStatus: integer): string;
function Get_if_oper_status(iStatus: integer): string;

implementation

function GetIfTable; stdcall; external 'IPHLPAPI.DLL';
function GetIpAddrTable; stdcall; external 'IPHLPAPI.DLL';

function Get_if_type(iType: integer): string;
var
  sResult: string;
begin
  sResult := 'UNKNOWN';
  case iType of
    1: sResult   := 'Other';
    6: sResult   := 'Ethernet';
    9: sResult   := 'Tokenring';
    15: sResult  := 'FDDI';
    23: sResult  := 'PPP';
    24: sResult  := 'Local loopback';
    28: sResult  := 'SLIP';
    37: sResult  := 'ATM';
    71: sResult  := 'IEEE 802.11';
    131: sResult := 'Tunnel';
    144: sResult := 'IEEE 1394 (Firewire)';
  end;

  Result := sResult;
end;

function Get_if_admin_status(iStatus: integer): string;
var
  sResult: string;
begin
  sResult := 'UNKNOWN';

  case iStatus of
    1: sResult := 'UP';
    2: sResult := 'DOWN';
    3: sResult := 'TESTING';
  end;

  Result := sResult;
end;

function Get_if_oper_status(iStatus: integer): string;
var
  sResult: string;
begin
  sResult := 'UNKNOWN';

  case iStatus of
    0: sResult := 'NON_OPERATIONAL';
    1: sResult := 'UNREACHABLE';
    2: sResult := 'DISCONNECTED';
    3: sResult := 'CONNECTING';
    4: sResult := 'CONNECTED';
    5: sResult := 'OPERATIONAL';
  end;

  Result := sResult;
end;

end. 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-01-01T20:07:58.177

绝地代码库包含一个过程

```
procedure GetIpAddresses(Results: TStrings); 
```

在单元 JclSysInfo

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-12T17:53:39.280

它也可以通过使用 WinApi 来完成（必要的标头在 Jedi ApiLib 中）。这就是我在[TSAdminEx](http://www.remkoweijnen.nl/blog/2009/02/20/tsadminex-beta-release/)应用程序中的操作方式：

```
function EnumerateIpAddresses(var IPList: TStringList): Boolean;
var
  IPAddrTable: PMIB_IPADDRTABLE;
  Size: DWORD;
  Res: DWORD;
  Index: Integer;
  Addr: IN_ADDR;
begin
  Result := False;

  IPList.Duplicates := dupIgnore;

  Size := 0;
  // Get required Size
  if GetIpAddrTable(nil, Size, False) <> ERROR_INSUFFICIENT_BUFFER then Exit;

  // Reserve mem
  GetMem(IPAddrTable, Size);
  Res := GetIpAddrTable(IPAddrTable, Size, True);

  if Res <> NO_ERROR then Exit;

  for Index := 0 to IPAddrTable^.dwNumEntries-1 do
  begin
    // Convert ADDR to String and add to IPList
    Addr.S_addr := IPAddrTable^.table[Index].dwAddr;
    // Prevent implicit string conversion warning in D2009 by explicit cast to string
    IPList.Add({$IFDEF UNICODE}String({$ENDIF UNICODE}inet_ntoa(Addr){$IFDEF UNICODE}){$ENDIF UNICODE});
  end;

  // Free Mem
  FreeMem(IPAddrTable);

  Result := True;
end; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-06-29T08:44:51.910

从 Delphi 7 Indy 9 源代码中，我找到了解决问题的方法`GStack`。和之前的帖子有点不一样。

```
function GetLocalIPAddress(List: TStringlist): Integer;
begin     
  if Assigned(GStack) then
    List.Assign(TStringlist(GStack.LocalAddresses))
  else
  begin
    GStack := GStackClass.Create;
    List.Assing(TStringlist(GStack.LocalAddresses));
    FreeAndNil(GStack);
  end;
end; 
```

我认为这也适用于 Indy 10。

# rss - 如何获取 RSS 提要上的所有旧项目？

> ID：576552
> 
> 赞同：126
> 
> 时间：2009-02-23T04:40:22.603
> 
> 标签：rss

我一直在尝试编写自己的 RSS 阅读器。我可以处理“解析 XML”位。我遇到的问题是“如何获取较旧的帖子？”

大多数 RSS 提要仅在其 XML 文件中列出 10-25 个最近的项目。如何获取提要中的*所有*项目，而不仅仅是最近的项目？

我能找到的唯一解决方案是使用“非官方”谷歌阅读器 API，它类似于

[http://www.google.com/reader/atom/feed/http://fskrealityguide.blogspot.com/feeds/posts/default?n=1000](http://www.google.com/reader/atom/feed/http://fskrealityguide.blogspot.com/feeds/posts/default?n=1000)

我不想让我的应用程序依赖于 Google Reader。

有没有更好的办法？我注意到在 Blogger 上，我可以执行“?start-index=1&max-results=1000”，而在 WordPress 上，我可以执行“?paged=5”。有没有什么通用的方法来获取一个 RSS 提要，以便它给我所有的东西，而不仅仅是最近的项目？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-02-23T05:22:24.297

RSS/Atom 提要不允许检索历史信息。提要的发布者可以根据需要提供它，例如您在上面给出的博主或 wordpress 示例中。

谷歌阅读器拥有更多信息的唯一原因是它从第一次出现时就记住了它。

有一些关于这样的信息作为[ATOM 协议的扩展被](http://www.ibm.com/developerworks/xml/library/x-extatom1/)谈论，但我不知道它是否真的在任何地方实现。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2015-08-17T21:00:57.887

正如此处提到的其他回复，提要可能不提供档案数据，但历史项目可能可从其他来源获得。

Archive.org 的 Wayback Machine 有一个 API 可以访问历史内容，包括 RSS 提要（如果他们的机器人已经下载了它）。我创建了 Web 工具[Backfeed](http://backfeed.strangecode.com/)，它使用此 API 重新生成包含串联历史项目的提要。如果您想详细讨论实施，请与我们联系。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-23T05:10:16.603

根据我使用 RSS 的经验，提要由最后 X 个项目编译，其中 X 是一个变量。某些 Feed 可能有完整列表，但出于带宽考虑，大多数地方可能仅限于最后几项。

对于拥有旧信息的谷歌阅读器来说，可能的答案是它会将其存储在其一侧以供以后用户使用。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2013-09-24T21:31:11.960

除了 David Dean 所说的 RSS/Atom 提要将只包含提要发布者当时发布的内容，并且有人需要积极收集这些信息才能获得任何历史信息。基本上谷歌阅读器是免费的，当你与之交互时，你可以从谷歌数据库服务器中检索这个存储的信息。

现在他们已经停用了这项服务，据我所知，您有两个选择。您必须开始从您感兴趣的提要中收集此信息并使用 XML 或其他方式存储数据，或者您可以从销售此类存档提要信息的公司之一支付此数据。

我希望这些信息对某人有所帮助。

肖恩

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2017-03-09T01:53:01.050

另一种潜在的解决方案在最初提出问题时可能不可用，并且不需要任何特定服务。

1.  找到您想要的 RSS 提要的 URL，并使用[waybackpack](https://github.com/jsvine/waybackpack)获取该提要的存档 url。
2.  使用[FeedReader](http://www.pythonforbeginners.com/feedparser/using-feedparser-in-python)或类似的库来下拉存档的 RSS 提要。
3.  从每个提要中获取 URL 并根据需要抓取它们。如果你要回到过去，可能会有一些死链接。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-05-03T23:59:31.250

所有先前的答案或多或少都依赖于现有服务以仍然拥有该提要的副本或提要引擎能够动态地提供较旧的项目。

还有另一种公认的积极主动且相当理论化的方法：让您的提要阅读器使用缓存代理，该代理在语义上理解 RSS 和/或 Atom 提要，并将它们缓存在每个项目的基础上，最多可以配置尽可能多的项目。

如果提要阅读器不定期轮询提要，代理可以根据自己的时间获取已知提要，以免错过高度易变提要中的项目，例如来自用户友好的提要中只有一个项目并且每天都在变化的项目（或至少曾经这样做）。因此，如果 feedreadere.g. 如果您离开几天后网络连接崩溃或丢失，您可能会丢失 feedreader 缓存中的项目。拥有定期获取这些提要的代理（例如，从数据中心而不是在家中或在服务器上而不是笔记本电脑上）可以让您轻松运行提要阅读器，仅在那时和当您的提要获取提要后发布的项目不会丢失上一次，但在下次取回它们之前再次旋转出来。

我把这个概念称为*语义提要代理*，并且我已经实现了一个[名为 sfp 的概念验证实现](https://github.com/xtaran/sfp)。虽然它只是一个概念证明，但我还没有进一步开发它。（因此，对于具有相似想法或目的的项目的提示，我会很高兴。:-)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-01-15T03:19:41.557

## 为什么会存在这个问题？

大多数 RSS 阅读器需要通过实时 URL 导入提要，这使得在 Wayback Machine 上未编入索引的网站变得更加困难。

之所以可以导入 Wayback Machine feeds，是因为阅读器可以根据其定义的 TTL 配置定期轮询服务器以获取更新。阅读器将当前日期时间与XML 响应中的 RSS 提要帖子`pubDate`或键进行比较。`lastBuildDate`我们无法破解机器日期时间来解决日期时间分辨率，因为当前日期时间是实时获取的。

我在下面概述了一个没有 Wayback 的替代解决方案。不幸的是，我无法找到适用于所有提要来源的通用解决方案。

## 替代解决方案

以我的经验，并非所有的提要都是部分的。XML 不必指定每个帖子的日期时间。这意味着 RSS 阅读器没有日期时间来过滤提要。可以在[此处](http://www.aaronsw.com/2002/feeds/pgessays.rss)找到此提要类型的示例。

当时间顺序无关，内容不需要排序时，这种阅读体验很有用。这种方法对于所有内容都很有价值的网站很有用，保罗格雷厄姆的链接论文就是一个很好的例子。

1.  如果站点有一个通用的、非按时间顺序的提要选项，请改为订阅该 RSS（首选选项）。
2.  下载链接的时间戳`.rss`文件，剥离日期时间并将文件托管在您自己的服务器上。请注意，我们可以通过 AWS Lambda 实现这一点。
    1.  设置从实时获取 RSS 的服务器。
    2.  `pubDate`在提取时从 XML 文件中去除标签。
    3.  在您自己的服务器上托管修改后的 RSS。

## 笔记

由于订单丢失，这些是次优解决方案，但是，我想提供 WaybackMachine 的潜在替代方案。

此外，一些现有的答案需要高级*SysDesign 解决方法*、更多的前期工作，并且在某些情况下已经过时（谷歌阅读器已关闭）。我希望它对那些真正需要完整提要列表的解决方案的人有所帮助。从原始 RSS 文件构建新的 RSS 提要并不难。

# python - 是否需要与 Python 3.0 一起学习 Python 2.6？

> ID：576557
> 
> 赞同：-1
> 
> 时间：2009-02-23T04:43:32.377
> 
> 标签：python

如果我学习 python 3.0 和其中的代码，我的代码是否仍与 Python 2.6（或 2.5！）兼容？

* * *

非常类似于：

[如果我要学习 Python，我应该学习 2.x 还是直接跳到 3.0？](https://stackoverflow.com/questions/410609/if-im-going-to-learn-python-should-i-learn-2-x-or-just-jump-into-3-0/410626)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T04:46:55.677

不，3.x 在很大程度上与 2.x 不兼容（这实际上是这样做的主要动机）。事实上，您可能根本不应该使用 3.0——它目前相当不可用，并且仍然主要是供库开发人员移植到它以便它可以使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T05:01:46.123

Python 2.6 和 Python 3.0 彼此*非常*兼容。老实说，两者之间并没有太大的区别。在这一点上，2.x 系列的第三方库支持要好得多（上次我检查，我使用的一些库没有从 2.5 更新，但是从 2.5 到 2.6 只是重新编译，但从 2.6 到3.0 对于 C 级的东西是一个真正的痛苦）。

刚开始学习2.6。基础设施现在就在那里，当您最终想要迁移到 3.x 时，会有很多帮助。2.x 不会消失：在某个时候会有 2.7 版本，所以如果你现在学习 2.6，你不会不走运。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T06:14:30.990

现在使用 2.6 会更容易，因为大多数外部库还与 3 不兼容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T04:47:38.747

不。Python 3 代码与 2.6 向后不兼容。我建议从 2.6 开始，因为您的代码会更有**用**。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-10-03T05:03:27.187

在大多数情况下，不再需要将 Python 2 与 Python 3 一起学习，原因如下。

1.  Python 2.7 已于 2020 年 1 月 1 日结束其生命周期。请升级您的 Python，因为 Python 2.7 不再维护，并且致力于学习它对大多数人来说不再有意义。安装一些 Python 2.7 包可能会出现问题，而在 Python 3 中安装它们没有任何问题。

2.  Python 3 是第一次学习 Python 的最佳方式，因为它比 Python 2 更容易让初学者理解。

# c# - 您将 SQL 语句放在 c# 项目中的什么位置？

> ID：576571
> 
> 赞同：30
> 
> 时间：2009-02-23T04:49:49.943
> 
> 标签：c#, sql, winforms, orm, data-access-layer

我可能会负责将 vb6 应用程序移植到 c#。此应用程序是一个与访问数据库交互的 Windows 应用程序。数据访问被封装在基本业务对象中。基本上一桌一课。现有的 vb6 业务对象通过 DAO 读取和写入 DB。我之前写过几次 DAL 和 ORM，但它们都只针对 SQL Server。这将需要针对访问和 sql server。在之前的项目中，我会将 SQL 字符串放在业务对象的私有部分中，并且可能会将多余的 sql 代码（如连接、创建命令）移到公共基类中以减少代码。

这一次，我正在考虑将 SQL 字符串写入 .settings 文件或其他键/值类型的文本文件。然后我会编写一个 sql 实用程序来编辑这个文件并允许我运行和测试参数化查询。这些查询将在业务对象中按名称引用，而不是将 sql 嵌入代码中。

我知道一种标准方法是为每个目标数据库创建一个 DAL，并具有要使用的 DAL 的配置状态。我真的不想为每个数据库创建两个 DAL 类。如果我只是通过键名引用正确的查询并具有正确的连接类型，那么代码似乎会更少。

那么，你们是在做这样的事情吗？您将如何或曾经如何解决这个问题？什么最适合你？

谢谢！

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-23T06:28:18.023

好吧，有很多选择 - 所以这真的取决于你最迫切的需求是什么:-)

一种方法可能是在 VS 解决方案中将 SQL 语句创建为文本文件，并在“构建操作”中将它们标记为“嵌入式资源”。这样，SQL 将包含在生成的程序集中，并且可以在运行时使用 .NET 框架的 ResourceManifestStream 从中检索：

```
private string LoadSQLStatement(string statementName)
{
    string sqlStatement = string.Empty;

    string namespacePart = "ConsoleApplication1";
    string resourceName = namespacePart + "." + statementName;

    using(Stream stm = Assembly.GetExecutingAssembly().GetManifestResourceStream(resourceName))
    {
        if (stm != null)
        {
            sqlStatement = new StreamReader(stm).ReadToEnd();
        }
    }

    return sqlStatement;
} 
```

您需要将“ConsoleApplication1”替换为您的实际命名空间，其中 sql 语句文件驻留。您需要通过完全限定名称来引用它们。然后您可以使用以下行加载您的 SQL 语句：

```
string mySQLStatement = LoadSQLStatement("MySQLStatement.sql"); 
```

然而，这使得查询相当“静态”，例如，您无法在运行时配置和更改它们 - 它们被直接烘焙到编译的二进制位中。但另一方面，在 VS 中，您的 C# 程序代码和 SQL 语句之间有一个很好的清晰分离。

如果您需要能够在运行时调整和更改它们，我会将它们放入单个 SQL 表中，其中包含例如关键字和作为字段的实际 SQL 查询。然后，您可以根据需要检索它们并执行它们。由于它们位于数据库表中，因此您也可以随意更改、修复、修改它们——甚至在运行时——而无需重新部署整个应用程序。

马克

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-23T07:52:27.540

当我真正需要它时，我将查询放入单独的 *.sql 文件中，然后将它们包含在 Resources.resx 中。其中有一个“文件”部分，允许您包含嵌入式资源文件。

之后，我可以使用生成的 Resources.MyQuery 属性，它既保证资源存在，又使我免于编写自定义资源加载方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T05:39:05.333

**LINQ to DataSet**听起来很适合您。

如果您之前没有使用过 .NET 3.5 / LINQ，那么您就可以大快朵颐了。LINQ 将节省您以字符串文字编写原始 sql，并为您提供一种更合乎逻辑的方式来创建查询。

无论如何，请查看此链接以在 Access 数据库上使用 LINQ - [http://msdn.microsoft.com/en-us/library/bb386977.aspx](http://msdn.microsoft.com/en-us/library/bb386977.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T13:22:58.947

如果我必须为 SQL 和 Access 创建应用程序，我会使用一些 IDAL 接口，具有通用功能实现的 DALCommon 以及从 DALCommon 继承的独立 DALSql 和 DALAccess，以及一些特定的东西，如异常、事务处理、安全等.
我曾经在资源文件中保存存储过程名称或查询。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T05:23:33.793

我会告诉我永远不会把它放在哪里，这是我在继承的一些代码中看到的。它是用 Java 编写的，但适用于任何语言

*   为 SQL 语句声明受保护的静态成员变量的基类，初始化为 null，具有返回单个 SQL 语句的 get 方法

*   每个受支持的数据库服务器的子类，具有分配给基类成员变量的 init 方法

*   使用基类方法检索 SQL 语句的几个 DA 类

*   应用程序启动类，负责创建正确的子类对象并调用其 init 方法

我也不会解释为什么我永远不会这样做:-)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T05:36:53.047

我们使用的一种方法是拥有一个可以连接到数据库的类和调用过程的方法，并在方法参数中提供过程名称。所以所有的 SQL 代码都在过程中。我们将为不同的返回类型使用重载

```
class ConnectToSQL()
{
        //connectSql code (read from setting file i assume)

        XMLDataDocument runProcedure(string procedureName);
        int runProcedure(string procedureName);

        //etc....
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-08T15:38:40.917

有时，就像使用自定义报告应用程序一样，您确实需要接受阻抗不匹配，并特别重视 SQL。在这些情况下，我建议如下： 对于每个包含 SQL 字符串的模块，创建一个静态“SQL”类来保存它们。一些 SQL 字符串可能需要参数，所以要保持一致并将每个字符串放在它自己的静态方法后面。

我只为偶尔的自定义报告应用程序这样做，但它总是效果很好，让人耳目一新和解放。很高兴几个月后回来进行增强，并在单个 SQL.cs 文件中找到所有等待您的 SQL。只需读取一个文件，它就会全部恢复，而且通常这是唯一需要更改的文件。

在这些情况下，我认为不需要将 SQL 隐藏在资源或其他地方。当 SQL 很重要时，它就很重要。有趣的是，现在越来越多的开发人员自由地将 SQL 与 C# 混合在一起，包括我相信这个站点，因为本质上，这就是 LINQ。

最后，与往常一样，确保您不易受到 SQL 注入攻击。特别是如果涉及用户输入，请确保您使用某种参数化并且您没有使用字符串连接。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-06-15T22:11:56.090

如果 SQL Query 有类似的“where”原因，则上面显示的嵌入解决方案可能不起作用，但对于相同的 Query，下一次运行需要 PropertyID='113'，因为 PropertyID 是读入的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-10-06T09:57:34.233

**[很高兴你问！将您的 sql 放入 QueryFirst .sql 模板中。](https://visualstudiogallery.msdn.microsoft.com/eaf390af-afc1-4994-a442-ec95923dafcb)**

它会作为嵌入式资源自动编译到您的应用程序中，但您不在乎。您只需在一个真实的 sql 窗口中编写它，连接到您的数据库，对表和列进行语法验证和智能感知，然后通过生成的`Execute()`方法使用它，对您的输入和结果使用智能感知。

免责声明：我写了 QueryFirst。

# php - 需要将算法编程得非常快，我应该将其作为 php 扩展还是以其他方式进行？

> ID：576572
> 
> 赞同：2
> 
> 时间：2009-02-23T04:50:39.350
> 
> 标签：php, c++, php-extension

我的大部分应用程序都是用 PHP 编写的（（前端和后端）。有一部分工作太慢，我需要重写它，可能不是 PHP。什么会给我以下：
1\. 最快速度
2。最快的开发
3\. 易于维护。

我想在 CPP 中将这段代码重写为 PHP 扩展，但可能是我锁定了这个解决方案而错过了一些更简单/更好的解决方案？

该算法是 PorterStemmerAlgorithm，每次运行时都会处理几 MB 的数据。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T05:00:49.137

答案真的取决于它是什么样的过程。

**如果它是一个长时间运行的进程（至少几秒钟）**，那么用 C++ 编写的外部程序可能会非常简单。它不会有 PHP 扩展的复杂性，而且它的稳定性不会影响 PHP/apache。您可以通过管道、共享内存或排序进行通信...

**如果它是一个运行时间很短的进程（以毫秒为单位），**那么您很可能需要编写一个 PHP 扩展。这将允许非常快速地调用它，几乎没有每次调用的开销。

**另一种可能性是自定义服务器**，它侦听 Unix 域套接字，并在 PHP 请求信息时快速响应 PHP。然后你的每次调用开销基本上是创建一个套接字（不错）。服务器可以是任何语言（c、c++、python、erlang 等），客户端可以是使用 socket_*() 函数的 50 行 PHP 类。

* * *

在做出此决定之前，需要评估大量信息。PHP 通常不会显示减速，直到您进入非常紧密的循环或数千次重复的函数调用。换句话说，HTTP 请求的开销和网络延迟通常使 PHP 延迟微不足道（除非上述情况适用）

*   也许有更好的方法来用 PHP 编写它？
*   你是数据库绑定的吗？
*   是 CPU 绑定、网络绑定还是 IO 绑定？
*   结果可以缓存吗？
*   是否已经存在一个库来完成繁重的工作。

* * *

通过提交自定义 PHP 扩展，您可以显着增加维护它所需的知识基础（甚至高于 C++）。但**在必要时它是一个很好的选择**。

随时用更多细节更新您的问题，我相信 Stack Overflow 会很乐意提供帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T07:10:39.950

**建议**

PorterStemmerAlgorithm 有一个**C**实现，位于[http://tartarus.org/~martin/PorterStemmer/c.txt](http://tartarus.org/~martin/PorterStemmer/c.txt)

将此 C 程序绑定到您的数据源并使其成为独立的可执行文件应该是一件容易的事。然后你可以简单地从 PHP 中使用 proc 函数之一调用它，例如[proc_open()](http://us3.php.net/manual/en/function.proc-open.php)

除非您需要根据 php 请求多次调用该程序，否则这种方法应该可以节省您构建和集成 PHP 扩展的工作量，更不用说已经完成了艰苦的工作（在 c 中）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T06:29:59.860

我不确定 PorterStemmerAlgorithm 是什么。但是，如果您可以让您的流程并行运行并一起收集信息，您可以查看在 JAVA 中轻松实现的并行运行流程。不确定如何在 PHP 中调用它，但绝对可以维护。

你可以看看这个框架。看起来很容易实现

[https://computefarm.dev.java.net/](https://computefarm.dev.java.net/)

问候，富兰克林。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T07:35:30.640

如果您出于速度原因绝对需要用不同的语言重写，那么我认为 gahooa 的答案很好地涵盖了这些选项。但是，在您这样做之前，您是否绝对确定您已经尽一切可能提高 PHP 实现的性能？

1.  在您的情况下缓存输出是否可行？您能否只运行一次算法并缓存输出而不是每次加载页面？
2.  您是否尝试过分析代码以确保没有完成不必要的工作（内部循环中的数据库查询等）。Xdebug 可以在这里提供帮助。
3.  是否有其他可用的词干提取算法可能在您的数据集上表现更好？

# c# - 使用 c#.net 连接远程 mysql 数据库

> ID：576573
> 
> 赞同：0
> 
> 时间：2009-02-23T04:52:40.560
> 
> 标签：c#, .net, windows, web-applications

我正在开发 c# windows 应用程序。

我想连接到驻留在另一个系统中的 mysql 数据库。

请帮我解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T05:02:41.317

假设您知道如何连接和查询数据库，您将需要以下内容：

1.  MySQL的[ADO.NET 提供程序](http://dev.mysql.com/downloads/connector/net/5.2.html)
2.  服务器的主机名或 IP 地址
3.  要连接的用户 ID 和密码

添加对 MySQL 提供程序的引用。从那里开始，它就像连接到 SQL Server 机器一样工作，只是类名有点不同，一些次要的 SQL 方言也不同。

当然，如果您还不知道如何连接到数据库，则需要慢一点开始。我建议你自己谷歌一个[基本的数据访问教程](http://www.google.com/search?rlz=1C1CHMB_enUS291US303&ie=UTF-8&q=ADO.NET+tutorial)。

祝你好运！

# emacs - 如何在 Windows 上为 Emacs 设置 geben？

> ID：576589
> 
> 赞同：0
> 
> 时间：2009-02-23T05:11:57.317
> 
> 标签：emacs, xdebug, geben

我在 Windows上设置[geben-on-emacs时遇到问题。](http://code.google.com/p/geben-on-emacs/)我有：

*   GNU Emacs 23.0.60.1
*   格本 0.22
*   xampp 1.7.0
*   Xdebug 2.0.4

本机[Debugclient](http://xdebug.org/docs/install#debugclient)工作正常：调试会话建立，我可以发出各种调试命令。

这就是我尝试使用 geben 进行调试时发生的情况：

*   问题**Mx geben**。获取*Waiting for debug server to connect at 9000 端口*响应。
*   `http://localhost/test.php?XDEBUG_SESSION_START=mydebug`在浏览器中打开。

在这个阶段 PHP 脚本被加载但次要模式没有设置 geben-mode。所以 SPC、i、o、r、g 等不起作用。如果我尝试手动发出命令（例如`M-x geben-run`），什么也不会发生。我可以切换到 *GEBEN<127.0.0.1:900: buffer 并手动输入[DBGp](http://xdebug.org/docs-dbgp.php)命令。

消息缓冲区有这一行，不确定是否相关：

> 无法加载颜色“亮蓝色”

我做错了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-24T11:59:32.993

我的 Emacs (GNU Emacs 22.3.1) 也没有亮蓝色作为颜色。尝试在 lisp 中搜索 brightblue 并将其更改为蓝色。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-25T22:23:17.417

[0.23 版](http://code.google.com/p/geben-on-emacs/downloads/list)修复了它。

请参阅[http://groups.google.com/group/geben-users/browse_thread/thread/cf0f377665d2a262#](http://groups.google.com/group/geben-users/browse_thread/thread/cf0f377665d2a262#)

# search-engine - 谷歌搜索返回空白页

> ID：576592
> 
> 赞同：3
> 
> 时间：2009-02-23T05:14:45.470
> 
> 标签：search-engine

当我在谷歌搜索任何字符串时，它正在重新调整一个空白页面。返回页面的 html 源代码如下所示。

```
<html>
<body>
<META HTTP-EQUIV="Refresh" CONTENT="0; URL=http://www.google.com/search?hl=en&q=test+search&meta=&safe=active">
</body>
</html> 
```

即没有任何东西返回给浏览器。

但是，当我在地址栏中使用 google 的 IP 地址进行搜索（而不是输入 google.com）时，搜索会返回所需的结果。（不再返回空白页）。

为什么会发生这种奇怪的行为？我很确定它没有被防火墙阻止，因为网络中与我具有相同访问权限的其他用户能够与谷歌正常工作。它也不是浏览器中的任何设置。

在我看来，当我使用域名（google.com）进行搜索时，搜索请求根本没有到达谷歌服务器。

承认这不是一个程序问题，虽然我可以使用谷歌的 IP 地址进行搜索，但使用域名时的问题对我来说仍然是一个未解之谜。

这种相当奇怪的行为可能是什么原因？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T05:22:57.807

可能有人劫持了您 PC 上的 google.com 地址。尝试 ping google.com 并查看地址是否解析为您认为应该的相同 IP。否则，他们可能已经劫持了您的浏览器（例如 IE 下的 BHO）。

无论如何，你是对的，这与编程无关。

编辑：我刚刚将该源代码输入到硬盘驱动器上的 HTML 文件中，并将 0 更改为 5。它在 5 秒后成功地将我刷新到谷歌，这是我希望你做的。

但是，在某些浏览器中可以禁用这种由页面启动的元刷新。例如，如果您在 IE6 中打开“工具”菜单、“Internet 选项”、“安全”选项卡，您可以禁用元刷新（在“杂项”下）。

这可能值得研究，这取决于您使用的浏览器。尝试在文件 x.html 中输入这个确切的内容并双击它：

```
<html><body>
    <META HTTP-EQUIV="Refresh" CONTENT="0; URL=http://xxx">
</body></html> 
```

它**应该**抱怨找不到xxx。如果不是，那么您的浏览器以某种方式禁用了元刷新（在这种情况下，请告诉我们您正在使用的浏览器）。

看看[这里](http://en.wikipedia.org/wiki/Meta_refresh)，看看这是如何工作的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T05:25:36.770

正在发生的事情`google.com`是将您软重定向到`www.google.co.in`，而您的浏览器可能已选择忽略此重定向。

您可以从您的浏览器访问`www.google.co.in`（注意印度域）吗？

您可能需要检查您的防病毒软件、弹出窗口阻止程序设置，或重新安装您的浏览器。

您 PC 上的其他浏览器可能与`www.google.com`.

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-02-23T05:24:25.757

向您的网络管理员询问您的问题。它会工作得最好。

# android - 在一定的空闲时间后锁定 android 应用程序

> ID：576600
> 
> 赞同：6
> 
> 时间：2009-02-23T05:23:52.373
> 
> 标签：android

我的 android 应用程序需要在第一个活动中输入密码。我希望能够在应用程序空闲一段固定时间后自动将应用程序发送回密码输入屏幕。

该应用程序有多个活动，但我希望所有活动的超时都是全局的。因此，`onPause()`在`Activity`.

我不确定应用程序空闲的最佳定义是什么，但是没有活动的活动就足够了。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-06-28T04:10:36.323

我知道已经接受了另一个答案，但是我在解决类似问题时遇到了这个问题，并认为我将尝试另一种更简单的方法，我认为如果其他人想尝试同样的方法，我不妨记录一下path. 在此处输入代码

一般的想法只是在任何活动暂停时在 SharedPreference 中跟踪系统时钟时间 - 听起来很简单，但是，如果你只使用这些，就会有一个安全漏洞，因为该时钟会在重启时重置。要解决这个问题：

*   有一个`Application`子类或共享静态单例类，具有全局解锁自启动状态（最初为 false）。该值应该与您的应用程序的进程一样长。
*   如果当前应用程序状态已解锁，则将每个相关的系统时间（自启动以来的实时时间）保存到[a](http://developer.android.com/reference/android/os/SystemClock.html#elapsedRealtime%28%29)中。`Activity``onPause``SharedPreference`
*   如果 appwide unlocked-since-boot 状态为 false（干净的应用程序启动 - 应用程序或手机重新启动），则显示锁定屏幕。否则，`SharedPreference`在可锁定活动的 onResume 中检查 ' 值；如果它不存在或大于该`SharedPreference`值 + 超时间隔，则也显示锁定屏幕。
*   当应用解锁时，将 appwide unlocked-since-boot 状态设置为 true。

除了超时之外，如果您的应用程序被杀死并重新启动或者您的手机重新启动，这种方法还会自动锁定您的应用程序，但我认为这对于大多数应用程序来说并不是一个特别糟糕的问题。它有点过于安全，可能会不必要地锁定任务切换很多的用户，但我认为通过完全消除任何后台进程/唤醒锁问题（不需要服务、警报或接收器）来减少代码和复杂性是值得的权衡）。

要解决不考虑时间锁定应用程序的进程终止问题，您可以使用 SharedPreference 并为系统启动广播意图注册一个侦听器以将该 Preference 设置为 false，而不是共享一个应用程序范围的单例来解锁自启动以来。这重新增加了初始解决方案的一些复杂性，其好处是在应用程序的进程在超时间隔内后台被终止的情况下更加方便，尽管对于大多数应用程序来说，这可能是矫枉过正。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-28T01:22:48.087

我通过使用 AlarmManager 来安排和取消超时操作来处理这个问题。

然后在我所有活动的 onPause() 事件中，我安排了闹钟。在我所有活动的 onResume() 事件中，我检查警报是否响起。如果闹钟响起，我会关闭我的应用程序。如果闹钟还没有响起，我就取消它。

我创建了 Timeout.java 来管理我的警报。当警报响起时，会触发一个意图：

```
public class Timeout {
    private static final int REQUEST_ID = 0;
    private static final long DEFAULT_TIMEOUT = 5 * 60 * 1000;  // 5 minutes

    private static PendingIntent buildIntent(Context ctx) {
        Intent intent = new Intent(Intents.TIMEOUT);
        PendingIntent sender = PendingIntent.getBroadcast(ctx, REQUEST_ID, intent, PendingIntent.FLAG_CANCEL_CURRENT);

        return sender;
    }

    public static void start(Context ctx) {
        ctx.startService(new Intent(ctx, TimeoutService.class));

        long triggerTime = System.currentTimeMillis() + DEFAULT_TIMEOUT;

        AlarmManager am = (AlarmManager) ctx.getSystemService(Context.ALARM_SERVICE);

        am.set(AlarmManager.RTC, triggerTime, buildIntent(ctx));
    }

    public static void cancel(Context ctx) {
        AlarmManager am = (AlarmManager) ctx.getSystemService(Context.ALARM_SERVICE);

        am.cancel(buildIntent(ctx));

        ctx.startService(new Intent(ctx, TimeoutService.class));

    }

} 
```

然后，我创建了一个服务来捕获警报生成的意图。它在我的应用程序类实例中设置了一些全局状态，以指示应用程序应该锁定：

```
public class TimeoutService extends Service {
    private BroadcastReceiver mIntentReceiver;

    @Override
    public void onCreate() {
        super.onCreate();

        mIntentReceiver = new BroadcastReceiver() {
            @Override
            public void onReceive(Context context, Intent intent) {
                String action = intent.getAction();

                if ( action.equals(Intents.TIMEOUT) ) {
                    timeout(context);
                }
            }
        };

        IntentFilter filter = new IntentFilter();
        filter.addAction(Intents.TIMEOUT);
        registerReceiver(mIntentReceiver, filter);

    }

    private void timeout(Context context) {
        App.setShutdown();

        NotificationManager nm = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);
        nm.cancelAll();
    }

    @Override
    public void onDestroy() {
        super.onDestroy();

        unregisterReceiver(mIntentReceiver);
    }

    public class TimeoutBinder extends Binder {
        public TimeoutService getService() {
            return TimeoutService.this;
        }
    }

    private final IBinder mBinder = new TimeoutBinder();

    @Override
    public IBinder onBind(Intent intent) {
        return mBinder;
    }

} 
```

最后，我创建了一个 Activity 子类，我的应用程序的所有 Activity 子类都从该子类中管理锁定和解锁：

```
public class LockingActivity extends Activity {

    @Override
    protected void onPause() {
        super.onPause();

        Timeout.start(this);
    }

    @Override
    protected void onResume() {
        super.onResume();

        Timeout.cancel(this);
        checkShutdown();
    }

    private void checkShutdown() {
        if ( App.isShutdown() ) {
            finish();
        }

    }

} 
```

使用 onPause 和 onResume 开始和停止超时给了我以下语义。只要我的应用程序的一项活动处于活动状态，超时时钟就不会运行。由于我使用了 AlarmManager.RTC 的警报类型，因此每当手机进入睡眠状态时，超时时钟都会运行。如果在手机处于睡眠状态时发生超时，那么我的服务将在手机唤醒后立即获取超时。此外，时钟会在任何其他活动打开时运行。

对于这些的更详细的版本，你可以看到我是如何在我的应用程序中实际实现它们的[https://github.com/bpellin/keepassdroid](https://github.com/bpellin/keepassdroid)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T05:37:59.703

查看[OpenIntents](http://code.google.com/p/openintents/) Safe 如何实现此功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-06T16:17:03.130

这对我来说是一个非常有用的帖子。支持@Yoni Samlan 给出的概念。我已经这样实现了

```
public void pause() {
        // Record timeout time in case timeout service is killed    
        long time = System.currentTimeMillis();     
        SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(this);
        SharedPreferences.Editor edit = preferences.edit();
        edit.putLong("Timeout_key", time);// start recording the current time as soon as app is asleep
        edit.apply();
    }

    public void resume() {       
        // Check whether the timeout has expired
        long cur_time = System.currentTimeMillis();
        SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(this);
        long timeout_start = preferences.getLong("Timeout_key", -1);
        // The timeout never started
        if (timeout_start == -1) {
            return;
        }   
        long timeout;
        try {
            //timeout = Long.parseLong(sTimeout);
            timeout=idle_delay;
        } catch (NumberFormatException e) {
            timeout = 60000;
        }
        // We are set to never timeout
        if (timeout == -1) {
            return;
        }
        if (idle){
        long diff = cur_time - timeout_start;
        if (diff >= timeout) {  
            //Toast.makeText(act, "We have timed out", Toast.LENGTH_LONG).show(); 
            showLockDialog();
        }
        }
    } 
```

从 onPause 调用 pause 方法，从 onResume 调用 resume 方法。

# math - Matlab中的曲线拟合

> ID：576602
> 
> 赞同：1
> 
> 时间：2009-02-23T05:25:25.100
> 
> 标签：math, matlab, curve

给定两点说（1,2,3）和（4,7,8）。这些点的端点切线也分别作为输入给出，例如 pi/4 和 -pi/2。如何在这些点之间拟合弧长为 2 的螺旋线？如何在 Matlab 中实现这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T06:11:47.843

I'm not sure what toolboxes you have access to, but you should check the documentation for these two:

*   [Curve Fitting toolbox](http://www.mathworks.com/access/helpdesk/help/toolbox/curvefit/curvefit.shtml)
*   [Spline toolbox](http://www.mathworks.com/access/helpdesk/help/toolbox/splines/splines.shtml)

I think there may be a number of different ways you could approach the problem (i.e. different types of curves to use to match an arbitrary set of points and tangents).

# iphone - 修改 plist 文件

> ID：576606
> 
> 赞同：0
> 
> 时间：2009-02-23T05:31:29.017
> 
> 标签：iphone, plist

我想以编程方式修改自定义 plist 文件中的条目。

任何人都可以建议我这样做吗？我试过修改键的值，但文件没有被保存..

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T06:27:45.653

我会看看 NSDictionary 方法：
`- (BOOL)writeToFile:(NSString *)path atomically:(BOOL)flag`

我敢肯定 NSArray 也有类似的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T16:01:30.657

您没有提供太多关于您尝试过的信息，但我从标签中假设这是在 iPhone 上。除了 Pat 的建议之外，请确保您尝试编辑的 plist 不在您的应用程序包中，而是位于沙箱中的文档或库等可编辑位置。

# c++ - 在 C/C++ 中将 BSTR 参数转换为 ANSI 的更好代码是什么？

> ID：576610
> 
> 赞同：4
> 
> 时间：2009-02-23T05:37:45.447
> 
> 标签：c++, c, string, cstring, bstr

到目前为止，我发现我可以通过两种（许多？）方式将传入的 BSTR 转换为 ANSI，我很想知道在速度/效率等方面，一种是否比另一种“更好”。

我已经使用了一段时间的方式是使用`USES_CONVERSION`and`W2A`宏，例如

```
BSTR __stdcall F(BSTR p1, BSTR p2 ) {
    USES_CONVERSION;

    LPSTR sNum1 = W2A( p1 );
    LPSTR sNum2 = W2A( p2 ); 
```

然而，最近，我遇到了另一种技术：

```
BSTR __stdcall F(BSTR p1, BSTR p2 ) {
    long amt = wcstombs( NULL, p1, 1 );
    sNum1 = (char *) malloc( amt ); 
    wcstombs( sNum1, p1, amt );
    *(sNum1 + amt) = '\0';

    amt = wcstombs( NULL, p2, 1 );
    sNum2 = (char *) malloc( amt ); 
    wcstombs( sNum2, p2, amt );
    *(sNum2 + amt) = '\0'; 
```

现在我承认，它更冗长，并且有两个调用，`wcstombs`但据我所知`USES_CONVERSION`，`W2A`宏可能隐藏着各种乐趣和游戏。

哪个代码更高效/更快？或者，我可以使用另一种技术来更好地完成这项工作吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T05:48:43.437

来自[MSDN](http://msdn.microsoft.com/en-us/library/87zae4a3(vs.71).aspx)：

> [...]与 BSTR 字符串相互转换的推荐方法是使用[CComBSTR](http://msdn.microsoft.com/en-us/library/zh7x9w3f(VS.71).aspx)类。要转换为 BSTR，请将现有字符串传递给 CComBSTR 的构造函数。要从 BSTR 转换，请使用 COLE2[C]DestinationType[EX]，例如 COLE2T。

从 CComBSTR 页面：

> [...]CComBSTR 类提供了许多将 ANSI 或 Unicode 字符串作为参数的成员（构造函数、赋值运算符和比较运算符）。这些函数的 ANSI 版本的效率低于 Unicode 版本，因为临时 Unicode 字符串通常是在内部创建的。为提高效率，请尽可能使用 Unicode 版本。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-04T12:43:31.257

请注意尼克批准的答案，虽然正确，但与描述宏的 MSDN 文档存在相同的问题。

问题是某些宏，例如@Nick - COLE2A 列出的宏，实际上并不存在。

然而，在 MSDN 页面的下方，有一些文本可以提示您了解这一事实并让您能够找出正确的宏！

该文本列在下表中的以下文本下：

> 旧的字符串转换宏和新的字符串转换类之间有几个重要的区别：

在新 ATL 7.0 转换类列中。

其中说：

> OLE 总是等价于 W

所以@Nick 示例中的宏实际上是**CW2A**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T18:41:35.453

笔记：

如果您使用 ATL 宏，例如：COLE2[C]DestinationType[Ex]（您可能应该这样做），请务必尽可能使用“C”版本，而不是您编写的非常量版本。它们可能等效于显式 BSTR->ASCII 转换（即：COLE2A），但对于不需要实际转换的转换（例如：为 UNICODE 编译时的 COLE2T），'C' 版本可以扩展为 noops，而非-'C' 如果源字符串是 const 版本仍将复制（因为您表示您需要生成的字符串是非常量的）。

另外值得注意的是：

新的 ATL7 宏并不总是需要USES_CONVERSION，但是它们分配临时的右值对象，而旧的宏使用_alloca。这可能很重要，也可能不重要，具体取决于您的使用情况（例如，不要在循环中使用旧的宏，它会运行很多次，这样做可能会破坏堆栈）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-24T05:33:49.567

自从我对 COM 或 BSTR 做任何事情以来已经有很长时间了，但我的建议是停止将 BSTR 视为特殊的东西。将它们视为指向宽字符零终止字符串的指针......如果这样做，将它们转换为 ANSI 可能会更容易。检查 [Eric 的 BSTR 语义完整指南](http://blogs.msdn.com/ericlippert/archive/2003/09/12/52976.aspx)...

# c++ - sprintf 等显示函数如何将数字转换为字符串？

> ID：576620
> 
> 赞同：1
> 
> 时间：2009-02-23T05:46:23.490
> 
> 标签：c++, floating-point, printf

我正在尝试提取浮点值的整数和小数部分，我似乎遇到了一些奇怪的舍入问题，这可能是由于浮点数的存储方式不精确。

我有一些这样的代码来提取小数部分：

```
double number = 2.01;
int frac = int(floor(number * 100)) % 100; 
```

然而，这里的结果不是 1，而是 0。这似乎是因为原来的 double 实际上被存储为：

```
2.0099999... 
```

然而，运行 sprintf 似乎得到了正确的转换：

```
char num_string[99];
sprintf(num_string,"%f",number); 
```

sprintf 如何在上述方法没有得到正确答案的情况下得到正确答案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T05:50:51.687

~~> 然而，这里的结果不是 1，而是 1。~~

你什么意思？

> 2.099999...

~~或者，更像`2.00999...`~~

正如您所指出的：

```
int frac = int(floor(number * 100)) % 100; 
```

将会：

```
int frac = int(floor(2.00999... * 100)) % 100;
         = int(floor(200.999...)) % 100;
         = int(floor(200.999...)) % 100;
         = int(200) % 100;
         = 200 % 100;
         = 0; 
```

[您可能对此](http://www.freebsd.org/cgi/cvsweb.cgi/src/lib/msun/src/s_floor.c?rev=1.8&content-type=text/x-cvsweb-markup)感兴趣。

另外，请参见`modf`：`math.h`

```
double modf(double x, double *intptr) /* Breaks x into fractional and integer parts. */ 
```

modf() 是比自己玩杂耍更好的选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T06:04:36.910

我非常同意使用 math.h 中的 modf。但如果你必须自己做杂耍，试试这段代码。这应该可以解决您看到的问题。

```
int round(double a) {
    if (a > 0)
        return int(a + 0.5);
    else
        return int(a - 0.5);
}

int main()
{
    double number = 2.01;
    int frac = round((number - ((int)number)) * 100);
    printf("%d", frac);
} 
```

# c# - 如何包含 System.Windows.Shapes？

> ID：576622
> 
> 赞同：7
> 
> 时间：2009-02-23T05:47:39.167
> 
> 标签：c#, windows, visual-studio-2008, shapes

我正在使用带有 .NET Framework (v3.5) 的 Visual Studio 2008。我似乎无法使用 System.Windows.Shapes，或除 Forms 之外的任何 System.Windows.*。

这是类描述的链接：

[System.Windows.Shapes（MSDN 库）](http://msdn.microsoft.com/en-us/library/system.windows.shapes.aspx)

我需要做一些特别的事情才能使用它吗？

我签入了所有框架文件夹，我为 System.Windows 拥有的唯一 dll/xml 文件是 System.Windows.Forms。

我需要做什么才能使其正常工作？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-23T05:50:10.237

此类是 WPF 的一部分，来自[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.shapes.shape.aspx)：

> 形状类
> 
> 程序集：PresentationFramework（在presentationframework.dll中）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-09-28T16:47:25.403

您需要添加对 PresentationFramework 库的引用。

在 VisualStudio 中，右键单击“解决方案资源管理器”中的项目。选择“添加参考”。“PresentationFramework”库将位于“.NET”选项卡下。您可能还需要添加“PresentationCore”和“WindowsBase”。

您可以通过转到“解决方案资源管理器”并展开“引用”项来查看项目的当前库引用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T05:52:25.690

您可能需要添加对库的引用，~~可能是 System.Windows.Presentation~~

编辑：它在**PresentationFramework**库中

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-19T14:35:04.553

1.  从 .Net 选项卡添加对 PresentationFramework 的引用
2.  使用 System.Windows.Shapes 编写

你就完成了！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-07-12T10:08:30.530

适用于 .Net 4.0 的其他解决方案：转到 referenes->add reference 并选择 .NET 选项卡下的 PrsentationFramework。

# ruby - 为什么 Ruby 的 select 不返回套接字？

> ID：576628
> 
> 赞同：1
> 
> 时间：2009-02-23T05:50:42.653
> 
> 标签：ruby, select, sockets

我正在尝试在 STDIN 上使用 select 并在 Ruby 中使用 TCP 套接字，但由于某种原因，从 select 返回的值似乎永远不会匹配其中一个选项；看起来它是正在返回的套接字，但它与使用 == （或等于？）不匹配。谁能告诉我为什么从 select 返回的结果与我传入的对象不匹配，以及我应该在这里做些什么不同的事情？

```
server = TCPSocket::new("irc.freenode.net", 7000)
server.puts "NICK MyBot"
server.puts "USER #{ENV['USER']} 0 * :My Bot"

# <snip definitions>

while (!$done)
  results = select([server, STDIN], nil, nil)
  if results[0] == STDIN
    puts "Reading from STDIN"
    execute_command
  elsif results[0] == server
    puts "Reading from server"
    receive_data
  else
    puts "Something's wrong... results[0]: #{results[0]}, server: #{server}"
    puts "IDs: results[0]: #{results[0].__id__}, server: #{server.__id__}"
    exit 1
  end
end 
```

这是我运行它时得到的：

```
出了点问题... 结果[0]：#<TCPSocket:0x33c390>，服务器：#<TCPSocket:0x33c390>
ID：结果[0]：1695840，服务器：1695990
```

我在 Mac OS X 上运行 Ruby 1.8.6 版。

```
$红宝石--版本
ruby 1.8.6 (2008-03-03 patchlevel 114) [universal-darwin9.0]
$ 哪个红宝石
/usr/bin/红宝石
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-23T08:10:15.657

select 返回的 Array 的第一个元素是准备好的 IO 对象的 Array。因此，您应该将 STDIN 和服务器与 results[0][0] 进行比较。或者更好地检查，如果套接字在结果数组中

```
...
if results[0].include? STDIN
  ...
elsif results[0].include? server 
 ...
... 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T06:06:49.493

如果您使用 .equal，您会得到相同的结果吗？或.eql？

[http://ruby-doc.org/core/classes/Object.html#M000341](http://ruby-doc.org/core/classes/Object.html#M000341)

== 可以被子类覆盖，但是 .equal? 不应该是。这里的主要问题实际上是为什么同一个对象，当通过 == 与自身进行比较时，返回 false。您可能需要查看 TCPSocket 类的源代码或文档。

# javascript - 用于客户端表单检查的 JavaScript 库是什么？

> ID：576631
> 
> 赞同：1
> 
> 时间：2009-02-23T05:52:55.317
> 
> 标签：javascript, ajax, validation, client-side

多年来，我曾涉足过一些纯 JavaScript，但还没有使用过任何 JavaScript/AJAX 库。对于我正在研究的一些新东西，我想使用一个 js 库来进行客户端表单验证，并且想知道哪个最适合。最好，我的标准是：快速且易于学习、占用空间小、与所有流行的浏览器兼容。

编辑：感谢 ASP 的建议，但它们与我无关。对不起，我最初没有提到它，但服务器是一个运行 Apache 和 PHP 的 Linux 机器。据我所知，我计划对输入进行服务器端验证，但希望客户端验证能够改善用户体验并尽可能避免服务器拒绝无效输入。

编辑2：对不起，我几个月没有回复！其他优先事项出现了，并转移了我的注意力。我最终做了自己的验证例程——除了在一些答案中提出的优点之外，我正在验证的一些项目很少在其他应用程序中使用，而且我找不到包含这种验证的库.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T05:55:52.907

你可以使用[jQuery](http://jquery.com/)和它的[Validation plugin](http://docs.jquery.com/Plugins/Validation)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T12:15:31.933

我自己不使用库，但深入研究了一些库（如原型、(yui-)ext、看似无所不在的 jquery、mootools），以从中学习并提取它们提供的一些功能或模式。这些库（又名“框架”）包含很多我从来不需要的功能，所以我编写了自己的函数子集。表单检查很难标准化（可能电话号码或电子邮件地址字段除外），所以我认为框架也无济于事。我的建议是检查其中一个库是否提供您正在寻找的功能，和/或使用/重写/复制您可以从中使用的功能。对于大多数开源库，可以下载未压缩的源代码。

需要说（顺便说一句，也许众所周知）客户端表单检查被认为是不够的。您还必须检查输入服务器端。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T13:32:35.227

在 AJAX 库之前，我使用了 Matthew "Matt" Frank 的 Validation.JS。

基本思想是您包含一个 JS 文件，然后将属性添加到您的 INPUT 语句。

例子：

```
<input name="start-date" type="text" 
    display-name="Start Date" date="MM/YYYY" required="@getRequired()" /> 
```

字段将被验证为 MM/YYYY 样式的日期。显示的任何错误消息都会将该字段称为“开始日期”。“@”前缀将导致在运行时评估 getRequired() 函数。

标准提供了各种东西（货币、日期、电话、邮编、最小值/最大值、最大长度等），并且有一个击键过滤器；或者，您可以自己滚动 - 最简单的方法是为该字段定义正则表达式，但您可以添加要调用的 Javascript 函数来进行验证。

处理程序可以在字段和表单之前/之后捕获伪事件。

除了 INPUT 语句中的 Attributes 之外，JS 还可以对字段应用验证操作：

```
// Set field background when in error state
document.MyForm["INVALID-COLOR"]="yellow";

// Show error messages on field blur
document.MyForm["SUPPRESS-ONCHANGE-MESSAGE"]=true;

document.MyForm.MyField.REQUIRED = true;
document.MyForm.MyField.DisplayName="Password"; 
```

Validation.JS 为 28K（未压缩）

为了找到一个您可以轻松获取详细信息的 HTML 文件，我进行了一些搜索，但我无法找到一个可以链接到的独立文件。

源代码在这里：

[http://code.google.com/p/javascript-form-validation/source/browse/#svn/trunk](http://code.google.com/p/javascript-form-validation/source/browse/#svn/trunk)

并且文档在 HTML 文件中 - 但您不能将它们视为 HTML，您必须下载它们然后查看它们，据我所知

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T12:51:38.977

我在 ASP.NET 中使用 AJAX 完成了大多数新工作，因此我将 ASP.NET 验证器与 AJAX 扩展器一起使用，它们运行良好。但是，如果您不熟悉 ASP.NET，这对您没有帮助。

大多数主要的 JavaScript 框架（jQuery、YUI、Prototype 等）都具有验证功能，因此您可以考虑使用它们。但是根据您的需要，您可能会认为它是矫枉过正的。

以前（在 ASP Classic 中）我使用自己的验证脚本，它只有 6KB；我现在显然不喜欢，因为我喜欢这些框架提供的一致性和优美性，但是 YMMV。

# python - PyGame 在同时按下 3 个以上的键时没有接收到事件

> ID：576634
> 
> 赞同：3
> 
> 时间：2009-02-23T05:55:34.933
> 
> 标签：python, pygame, keyboard-events

*我正在[PyGame](http://www.pygame.org/)中开发一个简单的游戏......一艘火箭飞船飞来飞去并射击东西。*

* * *

**问题：**为什么 pygame 在一次按下太多键时会停止发出键盘事件？

**关于密钥处理：**该程序有许多变量`KEYSTATE_FIRE, KEYSTATE_TURNLEFT`，例如 等...

1.  处理事件时`KEYDOWN`，它将相应的`KEYSTATE_*`变量设置为 True。
2.  处理事件时`KEYUP`，它将相同的变量设置为 False。

**问题：** 如果`UP-ARROW`和`LEFT-ARROW`被同时按下，pygame 在按下时不会发出`KEYDOWN`事件`SPACE`。此行为因键而异。按下字母时，我似乎可以在 pygame 停止`KEYDOWN`为其他键发出事件之前按住其中的 5 个。

**验证：**在我的主循环中，我只是打印了收到的每个事件来验证上述行为。

**代码：**作为参考，这里是此时处理关键事件的（粗略）方式：

```
while GAME_RUNNING:
    FRAME_NUMBER += 1
    CLOCK.tick(FRAME_PER_SECOND)

    #----------------------------------------------------------------------
    # Check for events
    for event in pygame.event.get():
        print event

        if event.type == pygame.QUIT:
            raise SystemExit()

        elif event.type == pygame.KEYDOWN and event.dict['key'] == pygame.K_UP:
            KEYSTATE_FORWARD = True
        elif event.type == pygame.KEYUP and event.dict['key'] == pygame.K_UP:
            KEYSTATE_FORWARD = False

        elif event.type == pygame.KEYDOWN and event.dict['key'] == pygame.K_DOWN:
            KEYSTATE_BACKWARD = True
        elif event.type == pygame.KEYUP and event.dict['key'] == pygame.K_DOWN:
            KEYSTATE_BACKWARD = False

        elif event.type == pygame.KEYDOWN and event.dict['key'] == pygame.K_LEFT:
            KEYSTATE_TURNLEFT = True
        elif event.type == pygame.KEYUP and event.dict['key'] == pygame.K_LEFT:
            KEYSTATE_TURNLEFT = False

        elif event.type == pygame.KEYDOWN and event.dict['key'] == pygame.K_RIGHT:
            KEYSTATE_TURNRIGHT = True
        elif event.type == pygame.KEYUP and event.dict['key'] == pygame.K_RIGHT:
            KEYSTATE_TURNRIGHT = False

        elif event.type == pygame.KEYDOWN and event.dict['key'] == pygame.K_SPACE:
            KEYSTATE_FIRE = True
        elif event.type == pygame.KEYUP and event.dict['key'] == pygame.K_SPACE:
            KEYSTATE_FIRE = False

    # remainder of game loop here... 
```

**按此顺序：**

*   `a (down)`
*   `s (down)`
*   `d (down)`
*   `f (down)`
*   `g (down)`
*   `h (down)`
*   `j (down)`
*   `k (down)`
*   `a (up)`
*   `s (up)`
*   `d (up)`
*   `f (up)`
*   `g (up)`
*   `h (up)`
*   `j (up)`
*   `k (up)`

**这是输出：**

*   `<Event(2-KeyDown {'scancode': 30, 'key': 97, 'unicode': u'a', 'mod': 0})>`
*   `<Event(2-KeyDown {'scancode': 31, 'key': 115, 'unicode': u's', 'mod': 0})>`
*   `<Event(2-KeyDown {'scancode': 32, 'key': 100, 'unicode': u'd', 'mod': 0})>`
*   `<Event(2-KeyDown {'scancode': 33, 'key': 102, 'unicode': u'f', 'mod': 0})>`
*   `<Event(3-KeyUp {'scancode': 30, 'key': 97, 'mod': 0})>`
*   `<Event(3-KeyUp {'scancode': 31, 'key': 115, 'mod': 0})>`
*   `<Event(3-KeyUp {'scancode': 32, 'key': 100, 'mod': 0})>`
*   `<Event(3-KeyUp {'scancode': 33, 'key': 102, 'mod': 0})>`
*   `<Event(2-KeyDown {'scancode': 36, 'key': 106, 'unicode': u'j', 'mod': 0})>`
*   `<Event(2-KeyDown {'scancode': 37, 'key': 107, 'unicode': u'k', 'mod': 0})>`
*   `<Event(3-KeyUp {'scancode': 36, 'key': 106, 'mod': 0})>`
*   `<Event(3-KeyUp {'scancode': 37, 'key': 107, 'mod': 0})>`

* * *

这是一个常见问题吗？有解决方法吗？如果不是，那么在使用 pygame 时处理多键控制问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-23T06:02:08.443

这听起来像是输入问题，而不是代码问题 - 您确定问题不是键盘本身吗？大多数键盘对可以同时按下的键的数量都有限制。很多时候，您一次只能按下几个靠近的键。

要对其进行测试，只需开始按住键盘上的字母，然后查看新字母何时停止出现。

我的建议是尝试将 SPACE 映射到其他地方的不同键，看看会发生什么。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T20:42:15.553

正如其他人已经避开的那样，某些（尤其是更便宜的低端）键盘具有低质量的[键盘矩阵](http://en.wikipedia.org/wiki/Keyboard_technology#Keyboard_switch_matrix)。使用这些键盘，某些组合键会导致您遇到的行为。另一个常见的副作用可能是“鬼键”，其中额外的按键将出现在输入流中，但实际上并未按下。

唯一的解决方案（如果问题与键盘矩阵有关）是更改您的键映射以在矩阵的不同行/列上使用键，或者购买具有更好矩阵的键盘。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T06:03:05.667

某些键盘无法将某些键一起发送。通常使用 3 个键即可达到此限制。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T06:02:59.957

这很可能取决于键盘。我目前的无名键盘只支持同时按下两个键，这在游戏中经常很痛苦。

# c# - 将 .Net (C#) COM 应用程序打开到 VB 时出错 (2147024894)

> ID：576636
> 
> 赞同：0
> 
> 时间：2009-02-23T05:56:16.977
> 
> 标签：c#, .net, com

我正在为第三方软件开发插件应用程序（他们使用 COM 技术将插件应用程序启动到他们的软件）。我正在使用 .Net(C#) 进行应用程序开发。第三方软件由VB开发。当我尝试将插件应用程序启动到第三方软件时，出现以下错误，
**DTM 创建失败！（-2147024894 - 未找到文件或程序集名称 TestComDTM 或其依赖项之一。）**
但我已复制所有安装位置所需的依赖项，但我仍然无法通过第三方软件启动我的应用程序。请帮我

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T11:21:01.860

解码 HRESULT：

*   -2147024894 是 0x80070002
*   在 WinError.h（Windows SDK 的一部分）中查找要容易得多。
*   7 是 FACILITY_WIN32，所以这是 Windows，所以查看 2 的 Win32 错误代码，即 ERROR_FILE_NOT_FOUND。
*   所以这是一个 HRESULT 文件未找到错误。

这反映了错误消息，但有时会告诉您更多有关路由原因的信息。

下一步：[进程监视器](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx "系统内部")可用于确定 COM 尝试从何处加载该文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T06:02:39.723

您可以尝试使用[依赖项遍历器](http://www.dependencywalker.com/)检查是否存在所有依赖项，分析模式非常适合。

标准 Windows 消息没有说的一件事是，如果在应用程序的依赖关系图中找不到任何依赖关系，它可能会出现（就像您调用的 dll 依赖于另一个），而不仅仅是找不到直接依赖关系.

# javascript - Chrome 不支持此查询字符串

> ID：576638
> 
> 赞同：-2
> 
> 时间：2009-02-23T05:56:54.010
> 
> 标签：javascript, google-chrome, query-string, cross-browser

我从链接中提取数据，[http://safalra.com/web-design/javascript/parsing-query-strings/](http://safalra.com/web-design/javascript/parsing-query-strings/)。它在 Firefox 中运行良好，但 Google Chrome 不支持此功能。是否有更好的方法或替代过程来提取查询字符串内容？

```
<script type="text/javascript">
    var _url = window.location
    alert(_url);
    var queryData = parseQueryString(_url.toString());
    var p = queryData['http://localhost/new_logic/test.php?a'];
    alert(queryData);
    var q = queryData['b'];
</script> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T06:44:29.903

您链接到的页面作者创建的`parseQueryString()`函数显然调用了一些不在 Chrome 上运行的 JavaScript 代码。

这并不意味着 Chrome 通常不支持 QueryStrings。看来您已经假设该`parseQueryString()`函数本质上是全局的，并且固有地内置于所有浏览器中。相反，它是作者自建的自定义函数。

最好建议您使用页面上的联系表格向作者发送电子邮件，或者深入了解 JavaScript 文件并找出不支持的确切内容。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T17:21:10.433

[http://safalra.com/web-design/javascript/parsing-query-strings/](http://safalra.com/web-design/javascript/parsing-query-strings/)的 parseQueryString有一些错误：

*   多个`+`s 不替换为空格。
*   多个未转义的等号会导致内容丢失。
*   空输入会产生一个带有键“”的对象。
*   多个空键不会被丢弃

在下面的函数中，上面的错误已经被删除，并且已经在 Firefox 3、Internet Explorer 7、Opera 9 和 Google Chrome 1 中进行了测试。

```
function parseQueryString(input){
    var out={}, decode=decodeURIComponent, s=input||location.search||"",
        kv=("?"===s.charAt(0)?s.slice(1):s).replace(/\+/g," ").split(/[&;]/g),
        idx=-1,key,value;
    while(++idx<kv.length){
        if (kv[idx]==="") continue;
        value=kv[idx].split("=");
        key=decode(value.shift());
        (out[key]||(out[key]=[])).push(decode(value.join("=")));
    }
    return out;
} 
```

[上面的函数（和原始函数）只需要URL](http://en.wikipedia.org/wiki/Uniform_Resource_Locator)的查询部分：从问号到字符串的末尾或到第一个 #。如果没有提供参数，它将自动从浏览器当前位置的 URL 中提取查询部分。

结果是一个包含查询字符串中键的对象，所有键的值是所有值的数组。

```
var data = parseQueryString("?a=test1&a=test2&b=test3");

//Result of data:
{
    a:["test1","test2"],
    b:["test3"]
} 
```

一些例子：

```
// Alert all values of the a key:
if (data.a && data.a.length) {
  for (var i=0;i<data.a.length;++i)
    alert(data.a[i]);
}

// Get the first value of a-key:
var value_a = data.a && data.a[0];

// Get the first value of a-key or default:
var value_a = data.a && data.a[0] || "default"; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T07:22:52.587

在您使用的代码中，'parseQuerySTring' 不会为 a 返回任何内容`http://localhost/new_logic/test.php?a`，因为 'a' 没有价值。也许你应该试试`http://localhost/new_logic/test.php?a=1&b=2&c=3`。现在 queryData.a 应该返回 1，queryData.b 2 等等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T06:45:55.843

该脚本似乎只期望搜索部分作为输入，但它适用于我的最新版本的 Chrome。

```
 <script type="text/javascript">
     var _url = window.location.search;
     alert(_url);
     var queryData = parseQueryString(_url.toString());
     var p = queryData['a'];
     alert(p);
     var q = queryData['b'];
     alert(q);
 </script> 
```

显示器

```
?a=aval&b=bval
aval
bval 
```

# c# - 调试和发布模式之间的 dll 加载差异

> ID：576639
> 
> 赞同：1
> 
> 时间：2009-02-23T05:58:16.783
> 
> 标签：c#, visual-studio-2005

使用 Visual Studio 2005。

这是一个有趣的。

要重现，请使用 Windows 应用程序和类库创建新的解决方案。

在类库中，像这样定义类：

```
public class SomeClassInDLL
{
    public string DoSomething()
    {
        return DateTime.Now.ToString();
    }
} 
```

获取 windows 应用程序以引用类库。添加一个按钮，并添加以下代码：

```
 private void button1_Click(object sender, EventArgs e)
    {
        try
        {
            MessageBox.Show("about to call DoSomething");
            string ret = DoCall();
            MessageBox.Show(ret);
        }
        catch (Exception ex)
        {
            MessageBox.Show("error : " + ex.GetType().ToString() + " " + ex.Message);

        }
    }

    private string DoCall()
    {
        SomeClassInDLL c1 = new SomeClassInDLL();
        return c1.DoSomething();
    } 
```

1) 在调试和发布模式下编译应用程序。（进入 bin\Debug 和 bin\Release 目录）

2）关闭Visual Studio，并从Windows资源管理器运行Windows应用程序

3) 单击按钮 1。

4）当“即将调用DoSomething”对话框出现时，在Windows资源管理器中，尝试删除引用的dll文件。

5a) 如果您在步骤 2 中运行调试模式版本：您可以成功删除 dll 文件。这是我所期望的，因为 dll 是在 DoCall 函数内部调用的，而不是直接在 button1_Click 中调用。

5b) 如果您在步骤 2 中运行了发布模式版本：您无法删除 dll 文件，因为它似乎已被应用程序锁定。

==

5a) 是我所期望的行为，因为 dotnet 1.1 天。有什么想法为什么 5b) 似乎比必要更早地锁定了 dll 吗？也许与优化有关？这种 dll 加载行为是否在某处进行了解释？

TIA。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T08:31:53.997

在发布模式下，DoCall 函数很可能被内联到按钮单击事件处理程序中。

这意味着类型加载器需要更早地了解 SomeClassInDll（因此锁定了 dll）

请注意，依赖此行为是危险的，可以通过反射、内联启发式的更改或类型加载器的更改轻松触发类型加载（例如，使依赖方法的推测性 jit 加载 - 尽管这不太可能）

# perl - 如何处理来自数据库查询的不同数量的项目？

> ID：576640
> 
> 赞同：0
> 
> 时间：2009-02-23T05:59:17.047
> 
> 标签：perl, dbi

实际上是以下内容的副本：[如何使用 Perl 在表格中显示数据](https://stackoverflow.com/questions/576498/how-can-i-display-data-in-table-with-perl)

那里接受的答案适用于此。一些替代品也是如此。

* * *

我正在尝试从 Perl 程序运行原始数据库查询并向用户显示结果。类似的东西`select * from table`。我想在 HTML 表格中显示信息。HTML 表中的列与返回的列相对应。

我有一些问题。我可以运行`describe table`查询以返回表中的列数。但是，我将如何将返回结果中的信息存储到数组中？

因此，如果我要存储这样的结果：

```
while (($f1, $t2, $n3, $k4, $d5, $e6) = $sth1->fetchrow_array) 
```

在这种情况下，我只知道有四列（我从描述表中得到）。但是这个数字四是动态的，可以根据表名而改变。我不能根据这个数字声明我的变量。有什么建议么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T06:47:30.893

尝试：

```
print "<table>\n";

# display HTML header
@cols = @{$sth->{NAMES_uc}};
print "<tr>".join("", map { "<th>${_}</th>" } @cols)."</tr>\n";

# display one HTML table row for each DB row
while (my @row = $sth->fetchrow_array) {
  print "<tr>".join("", map { "<td>${_}</td>" } @row)."</tr>\n";
}
print "</table>\n"; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T06:20:33.487

```
while (my @row = $sth->fetchrow_array)
{
        print "<tr>".join("", map{ "<td>${_}</td>" } @row)."</tr>"  ;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T06:21:41.237

使用另一个问题的答案中建议的技术 - 使用 fetchrow_array 提取到数组中：

```
while (my @row = $sth->fetchrow_array())
{
    ...process array...
} 
```

或者使用 的替代方法`fetchrow_array()`，例如`fetchrow_hashref()`。

# mysql - Windows：如何在不会 关闭的 shell 窗口中打开 .exe？

> ID：576648
> 
> 赞同：3
> 
> 时间：2009-02-23T06:03:29.563
> 
> 标签：mysql, windows, shell

这个问题我已经困扰很久了，太烦人了。

假设我想运行 mysqldump.exe ...这是我的过程：开始->运行，键入“cmd” ... dir 进入一个又一个目录，直到我最终到达 c:/program files/mysql/bin/ 然后我可以最后调用“mysqldump.exe”

我不介意使用 Windows 资源管理器访问 c:/program files/mysql/bin，但是我无法在 shell 中打开任何 .exe 文件，也无法使用目录就是那个。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-23T06:15:32.157

这就是我对这些类型的命令所做的：

将“命令提示符”快捷方式的副本拖到桌面上。

打开快捷方式的属性。

**将目标：**字段更改为： **%SystemRoot%\system32\cmd.exe /k mysqldump.exe**

**将Start in:**字段更改为： **c:/program files/mysql/bin/**

点击确定，然后将快捷方式从“命令提示符”重命名为“Mysqldump”。

然后在需要该命令时双击该图标。cmd.exe 的“/k”选项使窗口保持打开状态。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-23T06:08:00.240

微软为 Windows XP 发布了一个名为[Open Command Prompt Here](http://www.microsoft.com/windowsxp/Downloads/powertoys/Xppowertoys.mspx)的 powertoy 。如果您使用的是 Vista，您需要做的就是[按住 shift 并右键单击](http://www.howtogeek.com/howto/windows-vista/use-command-prompt-here-in-windows-vista/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T06:07:53.220

> `cmd`这是我的过程：开始->运行，在一个又一个目录 中键入“ ” ... dir，直到我最终到达，`c:/program files/mysql/bin/`然后我终于可以调用“ `mysqldump.exe`”

为什么不只是以下？

```
c:
cd "c:/program files/mysql/bin"
mysqldump.exe 
```

更好的是，把它放在一个批处理文件中并执行它。

您还可以创建快捷方式`cmd.exe`并将“开始于”目录设置为“ `c:/program files/mysql/bin`”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T06:08:52.983

您可以下载一个加载项，以便您可以右键单击该文件夹并打开命令提示符。节省大量时间，您说您不介意导航到该位置。

[http://download.microsoft.com/download/whistler/Install/2/WXP/EN-US/CmdHerePowertoySetup.exe](http://download.microsoft.com/download/whistler/Install/2/WXP/EN-US/CmdHerePowertoySetup.exe)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T06:11:53.803

一个不错的小技巧是，可以将资源管理器地址栏中的图标拖动到命令行窗口，并将完整路径插入当前光标位置。

它在 vista 中不起作用，但如果您在文件夹上按 SHIFT-右键单击，则会出现“在此处打开命令窗口”选项。

在 xp 下，您可以通过将其保存为 .reg 并执行它来获得它：

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Folder\shell\cmd]
@="Open Command Prompt Here"

[HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Folder\shell\cmd\command]
@="cmd.exe /k pushd %L" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T06:11:30.060

只需使用资源管理器导航到 bin 或任何目录。然后在地址栏输入*cmd并回车。*在此位置开始的命令行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T06:12:25.877

您可以使用 python 来完成：如果您还没有 activepython，请从[ActiveState 的网站](http://www.activestate.com/store/freedownload.aspx?prdGuid=b08b04e0-6872-4d9d-a722-7a0c2dea2758)下载。接下来，运行 PythonWin 并创建一个新脚本。写下以下内容：

```
from subprocess import *
Call("c://program files//mysql//bin//mysqldump.exe") 
```

将脚本保存在某处。当你想运行它时，只需双击。如果您喜欢编写批处理文件，有更简单的方法，但在这种情况下，Python 甚至比 Windows 更简洁。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T09:43:42.280

只需将 c:/program files/mysql/bin/ 放入您的路径...

然后，您可以直接运行 mysqldump.exe，甚至无需打开 cmd 提示符，只需将其键入“开始 > 运行”

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T10:07:55.577

我使用 MS PowerToy 有一段时间了，但由于关键特性，我转向了开源[Open Command Prompt Shell Extension ：](http://www.ktechcomputing.com/cmdopen/)

（从网站逐字复制）

> 通过右键单击目录中的任何空白屏幕空间，可以在您当前所在的目录中打开命令提示符。这消除了向上导航以在当前目录中打开命令提示符的需要。

必须实际单击文件夹才能使用 MS 工具打开命令提示符对我来说很烦人……尤其是因为当时我总是需要在当前目录上运行命令行工具。

# cocoa - Given an IBOutlet to an NSTextField that is bound to some NSDate, how can I programmatically set a new date?

> ID：576653
> 
> 赞同：1
> 
> 时间：2009-02-23T06:05:19.123
> 
> 标签：cocoa

I have a nice chunk of reuable code I'm trying to edit and keep clean of the details. I'd like to be able to edit the NSDate some NSTextField is bound to. The only thing I have is the IBOutlet to the text field. Is this possible?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T06:14:05.950

我假设您尝试直接设置文本字段的对象值。

如果这不起作用，请使用[`infoForBinding:`](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Protocols/NSKeyValueBindingCreation_Protocol/Reference/Reference.html#//apple_ref/occ/instm/NSObject/infoForBinding:)找出它绑定到的对象的哪个属性，然后使用`setValue:forKeyPath:`设置该对象的该属性的值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T06:18:52.103

我想如果您知道 textField 使用的日期格式，您可以：

`NSDateFormatter *myformatter = [[NSDateFormatter alloc] init];
[myformatter setDateFormat:textFieldDateFormat];
textField.text = [myformatter stringFromDate:yourdate];`

如果您不知道格式，那么您可以尝试解析 testField.text 以找出答案，但我这已经超出了我的工资等级。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T06:27:22.033

单独为 NSTextField 设置 objectValue 并没有深入到模型中。

我会试着解释我在做什么。在我的应用程序中，我从一个附有 NSDateFormatter 的简单文本字段开始。它绑定到 NSDate，一切都很好。后来我想在文本字段旁边添加一个弹出日历，以便用户可以单击他们的日期。

[http://media.clickablebliss.com/billable/interface_experiments/new_date_picker.png](http://media.clickablebliss.com/billable/interface_experiments/new_date_picker.png)

现在，我没有对这种行为进行硬编码，而是尝试对解决方案进行通用化。我最终编写了一个自定义帮助对象。我会将助手连接到文本字段和屏幕上的按钮，然后在助手中将按钮的操作设置为 openPopup:。当用户弹出一个日历视图时，我的代码会将日历视图绑定到文本字段绑定到的同一对象，代码如下：

```
// Set the binding of the date picker in the panel to the same binding as the controlToBeHelped
NSDictionary *controlToBeHelpedBindings = [controlToBeHelped infoForBinding:@"value"];
[popupPanelDatePicker bind:@"value" 
                  toObject:[controlToBeHelpedBindings valueForKey:NSObservedObjectKey]
               withKeyPath:[controlToBeHelpedBindings valueForKey:NSObservedKeyPathKey] 
                   options:nil]; 
```

这在我的一个项目中效果很好。在我的新项目中，我想重新使用这段代码。这次 NSDate 可以为零。我想修改我的代码，以便如果用户单击按钮以选择当前日期为零的日期，我首先将其设置为现在，然后显示弹出窗口。

因此，我需要编辑这个控件通过 IBOutlet 绑定到的 NSDate。谢谢。

编辑：感谢彼得，我想我得到了这个工作：

```
if ([[controlToBeHelpedBindings valueForKey:NSObservedObjectKey] valueForKeyPath:[controlToBeHelpedBindings valueForKey:NSObservedKeyPathKey]] == nil) {
    [[controlToBeHelpedBindings valueForKey:NSObservedObjectKey] setValue:[NSDate date] forKeyPath:[controlToBeHelpedBindings valueForKey:NSObservedKeyPathKey]];
} 
```

# java - JPA 实现——哪一个最好用？

> ID：576659
> 
> 赞同：34
> 
> 时间：2009-02-23T06:10:08.380
> 
> 标签：java, hibernate, jpa, toplink, openjpa

我使用了以下 JPA 实现：

1.  冬眠，
2.  顶联，
3.  OpenJPA

他们每个人都有自己的长处和短处。我发现 Hibernate 是三者中最先进的，只是它将自己的一些增强功能与 JPA 混合在一起，这使得切换到其他提供程序变得困难。最重要的是，它的查询解析器在解释 JPA 时更加宽松。它们使获得正确的库来支持休眠变得有点困难，因为我发现尝试获得所有依赖项的正确版本是一项任务。

Toplink 还可以，但给人的感觉是它有点残缺，因为甲骨文似乎希望你使用/购买？他们更先进的图书馆。尝试下载它也是一项任务，因为您需要通过运行 jar 文件来安装它。我发现它只实现了基本的 JPA 规范。我使用它的原因是 hibernate 使用了很多其他开源项目中常用的库，这些库经常会遇到类加载问题，尤其是在使用 JBoss 时

OpenJPA - 这是迄今为止最好的文档，易于下载和使用，但它似乎有很多错误。也许它只是我的代码，但我发现更高级的用法（例如与 CascadeType.all 设置的 OneToMany 关系）似乎不起作用。诚然，这可能是我的代码错了，我没有时间测试一个干净的案例，但许多这样的事件让我害怕使用它。我真的希望它变得更好。它的错误信息通常无助于解决问题。

人们还使用了哪些其他库，他们更喜欢哪些库，为什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-23T06:22:07.303

我对这些实现有相同的结论。

1.  OpenJPA 是/似乎有问题

2.  Hibernate 有大量的库，并且似乎*无法*延迟加载所有内容。

3.  Toplink 最终成为我的选择。它不像 Hibernate 那样灵活，但它可以工作，我不必安装*commons-logging*。

我接下来要尝试的是 JPOX，它最近已重命名为[datanucleus](http://www.datanucleus.org/)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-23T13:51:59.953

我个人觉得 OpenJPA 还不够成熟。还有其他更成熟的开源库，我宁愿使用它们。这些是我会按顺序考虑的：

1.  休眠。Hibernate 已经存在了很长时间，并且确实为 Java 中的 ORM 铺平了道路。我对 Hibernate 的唯一问题是许可。它是 LGPL 许可的，这可能会导致一些商业公司感到不安（出于我不会在这里讨论的原因）。无论如何，如果 LGPL 对您来说是个问题，那么最好避开它。

2.  Eclipse 链接。eclipselink 的一些背景知识。Toplink Essentials 是 Oracle 的 JPA 实现的免费版本。EclipseLink 取自 Toplink，Oracle 的完整 JPA 实现。EclipseLink 将成为 Glassfish v3.0 的 JPA 2.0 提供者，因此看起来一切都从 Toplink Essentials 转移到 EclipseLink。虽然 EclipseLink 版本只有 1.0.2，但该产品以其他名称存在已久。

我正在处理的一个项目现在在 Toplink Essentials 上，但我们计划很快切换到 Eclipselink。Hibernate 解决了我之前提到的许可问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-24T15:55:59.320

OpenJPA 被称为 Kodo，这是 BEA 很久以前购买的。Kodo 是 JDO 的实现，现在是 JPA。此外，我们非常密集地使用 OpenJPA。因此，我不会说它不成熟。很好但是我建议使用 Hibernate，即围绕 Hibernate 的 JPA 包装器。

原因？1) JPA 与 Hibernate 非常非常相似 2) 许多工作岗位都有 Hibernate 要求。最好还是靠主流产品……基本上

# c# - Declaring inherited generics with complex type constraints

> ID：576660
> 
> 赞同：2
> 
> 时间：2009-02-23T06:10:58.423
> 
> 标签：c#

I have an interface with a single generic type parameter:

```
public interface IDriveable<T> where T : ITransmission { ... } 
```

I also have a class that has a type parameter that needs to be of that interface type:

```
public class VehicleFactory<T> where T : /* ??? */ 
```

There is a problem here with this declaration. I can't put "IDriveable", because that has no type parameters and doesn't match the type signature of IDriveable. But I also don't want to put IDriveable<U> either, because then VehicleFactory has to know what *kind* of IDriveable it's getting. I want VehicleFactory to accept *any* kind of IDriveable.

The proposed solution a coworker had was to use:

```
public class VehicleFactory<T, U> where T : IDriveable<U> 
```

But I don't like this, since it's redundant. I have to say the "U" type twice:

```
var factory = new VehicleFactory<IDriveable<AllWheelDrive>, AllWheelDrive>(); 
```

What should go in the question marks?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T06:29:37.957

VehicleFactory 将*如何*处理 T？它实际上是否需要约束才能工作，还是只是为了开发人员的健全性检查？

解决这个问题的一种常见方法是声明一个非泛型接口 ( `IDriveable`)，然后让你的泛型接口扩展：

```
public interface IDriveable {}
public interface IDriveable<T> : IDriveable {}
public class VehicleFactory<T> where T : IDriveable 
```

如果您*确实*希望工厂能够使用`T`，您可以将任何`IDriveable<T>`不关心`T`的接口成员放入非泛型`IDriveable`中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-30T20:18:02.513

您可以像这样缩短经常使用的案例：

```
interface IDriveableAllWheel : IDriveable<AllWheelDrive>
{}

var factory = new VehicleFactory<IDriveableAllWheel, AllWheelDrive>(); 
```

甚至

```
class AllWheelFactory : VehicleFactory<IDriveableAllWheel, AllWheelDrive>
{} 
```

[另请参阅从由通用类实现的接口调用通用类中的通用属性](https://stackoverflow.com/questions/2197211/calling-generic-property-in-generic-class-from-interface-implemented-by-generic-c)中的 kvb 答案，以获得可能的解决方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T06:16:28.690

这对你有用吗？

```
public class VehicleFactory<T, U> where T : IDriveable<U> 
```

这将使工厂知道可驱动设备的类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T06:17:33.027

您可以使用 2 种类型的泛型定义 VehicleFactory 并将其中一种设置到接口。就像是：

```
public class VehicleFactory<T1,T2> where T1 : IDriveabel<T2> 
```

我希望这不是你对 Idriveable 的看法。我猜U是一种特定的类型。比如字符串等。

# mysql - 设置mysql用户名和密码

> ID：576676
> 
> 赞同：1
> 
> 时间：2009-02-23T06:19:40.320
> 
> 标签：mysql

我最近在家里安装了easyPHP，以便将我的计算机作为服务器（Windows XP）进行一些开发工作。

easyPHP 设置 apache、php 和 mysql 以在您的计算机上工作。我在设置 mysql 帐户的用户名和密码时遇到了麻烦（遗憾的是，我只通过 cPanel 完成过此操作）。

easyPHP GUI 让您可以通过我认为是“root”而没有密码的方式登录 mySQL，但我想尽快更改它。

有什么建议吗？谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T06:57:52.540

您可以通过以下命令创建用户：

```
create user user@host; 
```

例子：

```
create user farzad@localhost; 
```

然后你我为用户设置密码。您可以使用此行为您登录的当前用户创建密码：

```
set password = password('mynewpassword'); 
```

在上述命令中，password() 函数将字符串参数转换为哈希密码，mysql 将使用该密码对用户进行身份验证。如果您使用此行：

```
set password = 'mynewpassword'; 
```

那么你输入了你的字符串作为你的密码，它不是一个散列值，所以你以后将无法再次登录。所以不要忘记使用 password() 函数。

要更改另一个用户的密码，请使用以下命令：

```
set password for user@host = password('userpassword'); 
```

例子：

```
set password for farzad@localhost = password('dalkXfda23423'); 
```

创建用户并使用密码保护登录后，您需要为用户设置权限。使用 GRANT 命令来执行此操作。一般语法是这样的：

将 db.table 上的 {PERMISSIONS} 授予 user@host；

在此命令中，权限是逗号分隔的权限列表，如 SELECT、INSERT、CREATE、DROP、DELETE。您可以使用 ALL 作为高级权限，以便用户可以做大部分事情。db.table 指定用户可能执行操作的某个数据库的表。因此您可以将用户限制为只能访问数据库的一个表，或者使用通配符 * 来允许所有表或数据库。例子：

```
GRANT ALL ON myDb.* to farzad@localhost; 
```

如果您还没有创建用户或设置密码，使用grant 命令您可以创建用户，为他设置密码，并一次性授予所有权限。语法是这样的：

```
GRANT {PERMISSIONS} ON db.table to new_user@host IDENTIFIED BY 'userpassword'; 
```

例子：

```
GRANT ALL ON myDb.* to farzad@10.0.0.1 IDENTIFIED BY 'dalkXfda23423'; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T06:31:15.940

下一段代码（从[http://www.debian-administration.org/articles/39](http://www.debian-administration.org/articles/39)复制）创建一个带有密码的用户 paul (@localhost)，并赋予它对 pauldb 数据库的完全权限。一切都在 MySQL 提示符下完成：

```
mysql> grant CREATE,INSERT,DELETE,UPDATE,SELECT on pauldb.* to paul@localhost;
Query OK, 0 rows affected (0.00 sec)
mysql> set password for paul = password('mysecretpassword');
Query OK, 0 rows affected (0.00 sec)
mysql> flush privileges;
mysql> exit; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T06:32:27.327

好吧，如果您只是在寻找某种方法来更改 root 密码，并且您有一种方法来运行 SQL 命令，那么您正在寻找“SET PASSWORD”命令：[http://dev.mysql.com/doc/refman/5.0/en/set-password.html](http://dev.mysql.com/doc/refman/5.0/en/set-password.html)

要创建其他用户并为他们设置对特定数据库的访问权限，您需要查看手册中账户管理一章的大部分内容：[http://dev.mysql.com/doc/refman/5.0/en/account-management-sql.html](http://dev.mysql.com/doc/refman/5.0/en/account-management-sql.html)

# c++ - 如何跳过读取 C++ 文件中的一行？

> ID：576677
> 
> 赞同：5
> 
> 时间：2009-02-23T06:19:59.633
> 
> 标签：c++, file-io

该文件包含以下数据：

```
#10000000    AAA 22.145  21.676  21.588
10  TTT 22.145  21.676  21.588
1  ACC 22.145  21.676  21.588 
```

我尝试使用以下代码跳过以“#”开头的行：

```
#include <iostream>
#include <sstream>
#include <fstream>
#include <string>

using namespace std;
int main() {
     while( getline("myfile.txt", qlline)) {

           stringstream sq(qlline);
           int tableEntry;

           sq >> tableEntry;

          if (tableEntry.find("#") != tableEntry.npos) {
              continue;
          }

          int data = tableEntry;
   }
} 
```

但由于某种原因，它给出了这个错误：

> Mycode.cc:13：错误：在“tableEntry”中请求成员“find”，它是非类类型“int”

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T06:39:01.570

这更像你想要的吗？

```
#include <iostream>
#include <sstream>
#include <fstream>
#include <string>
#include <algorithm>

using namespace std;

int main() 
{
    fstream fin("myfile.txt");
    string line;
    while(getline(fin, line)) 
    {
        //the following line trims white space from the beginning of the string
        line.erase(line.begin(), find_if(line.begin(), line.end(), not1(ptr_fun<int, int>(isspace)))); 

        if(line[0] == '#') continue;

        int data;
        stringstream(line) >> data;

        cout << "Data: " << data  << endl;
    }
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T06:35:52.450

您尝试从该行中提取一个整数，然后尝试在该整数中找到一个“#”。这没有意义，编译器抱怨没有`find`整数方法。

您可能应该在循环开头的读取行上直接检查“#”。除此之外，您需要`qlline`在某处声明并实际打开文件，而不仅仅是将带有其名称的字符串传递给`getline`. 基本上是这样的：

```
ifstream myfile("myfile.txt");
string qlline;
while (getline(myfile, qlline)) {
  if (qlline.find("#") == 0) {
    continue;
  }
  ...
} 
```

# c# - 使用 linq 查询 xmlnode

> ID：576678
> 
> 赞同：11
> 
> 时间：2009-02-23T06:20:32.970
> 
> 标签：c#, linq, linq-to-xml

我有以下文件：

```
<root>
  <Product desc="Household">
    <Product1 desc="Cheap">
        <Producta desc="Cheap Item 1" category="Cooking" />
        <Productb desc="Cheap Item 2" category="Gardening" />
    </Product1>
    <Product2 desc="Costly">
        <Producta desc="Costly Item 1" category="Decoration"/>
        <Productb desc="Costly Item 2" category="Furnishing" />
        <Productc desc="Costly Item 3" category="Pool" />
    </Product2>
  </Product>
</root> 
```

我想了解以下信息：廉价和昂贵的商品总数、所有类别的列表（如烹饪、园艺、装饰......）、排序类别的列表并仅选择“昂贵”的产品

我该如何使用 LINQ。我这样做到现在：

```
 XElement xe = XElement.Load(Server.MapPath("~/product.xml"));
 ???? 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T07:27:31.907

不幸的是，您的 XML 结构将 Product 元素用于层次结构的三个级别。你还有其他类似“家庭”的元素吗？

假设我们只想要家用的，您可以使用：

**计算每个便宜/昂贵的项目**

```
xe.Element("Product") // Select the Product desc="household" element
  .Elements() // Select the elements below it
  .Select(element => new { Name=(string) element.Attribute("desc"),
                           Count=element.Elements().Count() }); 
```

**列出所有类别**

```
xe.Descendants() // Select all descendant elements
  .Attributes() // All attributes from all elements
  // Limit it to "category" elements
  .Where(attr => attr.Name == "category")
  // Select the value
  .Select(attr => attr.Value)
  // Remove duplicates
  .Distinct(); 
```

要对此进行排序，`.OrderBy(x => x)`请在最后使用。

**选择“昂贵”的产品**

```
xe.Descendants() // Select all elements
  // Only consider those with a "Costly" description
  .Where(element => (string) element.Attribute("desc") == "Costly")
  // Select the subelements of that element, and flatten the result
  .SelectMany(element => element.Elements()); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-23T07:42:07.160

好吧，我个人觉得更容易`XmlDocument`：

```
 XmlDocument root = new XmlDocument();
    root.LoadXml(xml); // or .Load(path);

    var categories = root.SelectNodes(
        "/root/Product/Product/Product/@category")
        .Cast<XmlNode>().Select(cat => cat.InnerText).Distinct();
    var sortedCategories = categories.OrderBy(cat => cat);
    foreach (var category in sortedCategories)
    {
        Console.WriteLine(category);
    }

    var totalItems = root.SelectNodes(
         "/root/Products/Product/Product").Count;
    Console.WriteLine(totalItems);

    foreach (XmlElement prod in root.SelectNodes(
        "/root/Product/Product[@desc='Costly']/Product"))
    {
        Console.WriteLine(prod.GetAttribute("desc"));
    } 
```

# visual-studio - 将 Visual Studio 项目引用添加到 SVN

> ID：576682
> 
> 赞同：1
> 
> 时间：2009-02-23T06:22:13.390
> 
> 标签：visual-studio, svn, version-control

我将一个项目签入到 SVN，其中包含来自一个开发盒的大约 15 个引用，然后在第二个开发盒上签出同一个项目，但大多数参考文件都丢失了。是否可以自动签入参考文件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T08:47:23.587

版本控制只会跟踪工作文件夹下的实际文件。如果第三方库安装在机器上的其他地方，它们根本不会包含在源代码管理中。您必须执行以下操作之一：

1.  确保在所有必需的开发机器上安装了第 3 方库（例如，nunit、企业库）。
2.  根本不要使用普通安装程序安装库，而是将单个 dll 和其他资源作为[Vendor Branches](http://svnbook.red-bean.com/en/1.5/svn.advanced.vendorbr.html)添加到源代码控制，然后通过将它们分支到项目位置或添加 svn 将它们置于项目下：外部定义。
3.  将所需的参考文件复制到您的源位置，将它们添加到源代码管理并从那里引用它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T20:56:38.810

我认为 Visual Studio SCC 工具很难确定这些文件是否应该自动添加。如果您使用的是 Jim T 描述的第一个场景，那么您绝对不希望这种情况发生。

# actionscript-3 - AS3 - 如何重新开始一部 Flash 电影

> ID：576687
> 
> 赞同：2
> 
> 时间：2009-02-23T06:25:26.097
> 
> 标签：actionscript-3, flash-cs4

这可能很简单，但我不知道该怎么做。

我在 AS3 中创建了一个照片库，所有内容都在一个关键帧上。在这个照片库中，我有一个回家的链接。我的目标是，当有人点击“主页”链接时，我希望一切重新开始。关于如何在 AS3 中执行此操作的任何想法？

欣赏它。

L.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T07:04:27.483

调用 Flash 播放器容器
通常是 HTML 页面并使用 JavaScript 重新加载 Flash 播放器

```
flash.external.ExternalInterface.call(jsFuncRestart); 
```

jsFuncRestart 是 HTML 文件中的 JavaScript 函数

现在在 js 函数中创建一个新对象并将当前的 flash 对象替换为新
对象

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T14:38:19.780

您可能使用 as3 为所有内容设置动画，对吧？然后只需执行一个重置功能，将所有图像放回其原始位置并重新开始动画。

# performance - 如何最小化编程语言的编译时间？

> ID：576693
> 
> 赞同：7
> 
> 时间：2009-02-23T06:29:36.287
> 
> 标签：performance, compiler-construction, language-design

我更多地考虑我正在设计的编程语言。我想知道，有什么方法可以最小化它的编译时间？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-23T10:47:54.733

您今天的主要问题是 I/O。你的 CPU 比主存快很多倍，内存比访问硬盘快 1000 倍。

因此，除非您对源代码进行大量优化，否则 CPU 将花费大部分时间等待读取或写入数据。

试试这些规则：

1.  设计您的编译器以在多个独立的步骤中工作。目标是能够在不同的线程中运行每个步骤，以便您可以利用多核 CPU。它还有助于并行化整个编译过程（即同时编译多个文件）

    它还允许您提前加载许多源文件并对其进行预处理，以便实际的编译步骤可以更快地工作。

2.  尝试允许独立编译文件。例如，为项目创建一个“缺失符号池”。缺少符号不应导致编译失败。如果您在某处发现丢失的符号，请将其从池中移除。编译完所有文件后，检查池是否为空。

3.  创建包含重要信息的缓存。例如：文件 X 使用文件 Y 中的符号。这样，当 Y 更改时，您可以跳过编译文件 Z（它不引用 Y 中的任何内容）。如果您想更进一步，请将定义的所有符号放入池中的任何位置。如果文件以添加/删除符号的方式发生更改，您将立即知道哪些文件受到影响（甚至无需打开它们）。

4.  在后台编译。启动编译器进程，检查项目目录是否有更改，并在用户保存文件后立即编译它们。这样，您每次只需要编译几个文件而不是所有文件。从长远来看，您将编译更多，但对于用户而言，周转时间会更短（= 用户必须等到她可以在更改后运行编译结果的时间）。

5.  使用“即时”编译器（即在使用文件时编译文件，例如在导入语句中）。然后项目以源代码形式分发，并在第一次运行时编译。Python 做到了这一点。要执行此操作，您可以在安装编译器期间预编译库。

6.  不要使用头文件。将所有信息保存在一个地方，并在必要时从源代码生成头文件。也许将头文件保存在内存中，永远不要将它们保存到磁盘。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T18:38:56.690

我自己实现了一个编译器，一旦人们开始批量输入数百个源文件，我就不得不查看它。我很惊讶我发现了什么。

事实证明，你可以优化的最重要的东西不是你的语法。它也不是您的词法分析器或解析器。相反，就速度而言，最重要的是从磁盘读取源文件的代码。I/O 到磁盘的速度很*慢*。真的很慢。您几乎可以通过它执行的磁盘 I/O 数量来衡量编译器的速度。

所以事实证明，要加速编译器，最好的办法就是在一个大 I/O 中将整个文件读入内存，从 RAM 中进行所有的词法分析、解析等，然后写出结果在一个大 I/O 中写入磁盘。

我与维护 Gnat（GCC 的 Ada 编译器）的负责人之一讨论了这个问题，他告诉我，他实际上曾经把所有他能做的事情都放在 RAM 磁盘上，这样即使他的文件 I/O 也只是 RAM 读取和写入。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T06:38:34.037

> 有什么方法可以最小化它的编译时间？

*   无编译（解释语言）
*   延迟（及时）编译
*   增量编译
*   预编译的头文件

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T09:57:08.800

在大多数语言（除了 C++ 之外的所有语言）中，编译单个编译单元都非常快。

绑定/链接通常很慢 - 链接器必须引用整个程序而不仅仅是单个单元。

C++ 的缺点是——除非你使用 pImpl 习惯用法——它需要每个对象和所有内联函数的实现细节来编译客户端代码。

Java（字节码的源代码）受到影响，因为语法不区分对象和类 - 您必须加载 Foo 类以查看 Foo.Bar.Baz 是否是 Foo 类的 Bar 静态字段引用的对象的 Baz 字段，或 Foo.Bar 类的静态字段。您可以在两者之间更改 Foo 类的源代码，而不更改客户端代码的源代码，但仍然必须重新编译客户端代码，因为字节码区分两种形式，即使语法没有. AFAIK Python 字节码不区分这两者 - 模块是其父级的真正成员。

如果你包含的头文件比需要的多，C++ 和 C 就会受到影响，因为预处理器必须多次处理每个头文件，而编译器会编译它们。最小化标头大小和复杂性会有所帮助，这表明更好的模块化将缩短编译时间。缓存标头编译并不总是可能的，因为在预处理标头时存在的定义可能会改变其语义，甚至语法。

如果大量使用预处理器，C 会受到影响，但实际编译速度很快；许多 C 代码用于`typedef struct _X* X_ptr`隐藏实现比 C++ 更好 - C 标头可以很容易地由 typedef 和函数声明组成，从而提供更好的封装。

因此，我建议让您的语言对客户端代码隐藏实现细节，如果您是一种同时具有实例成员和命名空间的 OO 语言，请明确访问这两种语言的语法。允许真正的模块，因此客户端代码只需要知道接口而不是实现细节。不允许预处理器宏或其他变体机制改变引用模块的语义。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-24T02:14:14.117

以下是我们通过测量编译速度及其影响因素了解到的一些性能技巧：

*   编写一个两遍编译器：字符到 IR，IR 到代码。*（编写一个经过字符 -> AST -> IR -> 代码的三遍*编译器更容易，但速度没有那么快。）

*   作为推论，没有优化器；很难编写一个快速的优化器。

*   考虑生成字节码而不是本机机器码。[Lua](http://www.lua.org/)的虚拟机是一个很好的模型。

*   尝试使用线性扫描寄存器分配器或 Fraser 和 Hanson 在[lcc](http://www.cs.princeton.edu/software/lcc)中使用的简单寄存器分配器。

*   在一个简单的编译器中，词法分析通常是最大的性能瓶颈。如果您正在编写 C 或 C++ 代码，请使用[re2c](http://re2c.org/)。如果您使用另一种语言（您会发现它更令人愉快），请阅读 aboug re2c 的论文并应用所学的课程。

*   使用最大咀嚼或[iburg](http://code.google.com/p/iburg/)生成代码。

*   令人惊讶的是，GNU 汇编器是许多编译器的瓶颈。如果您可以直接生成二进制文件，请这样做。或者查看[新泽西机器代码工具包](http://www.cs.tufts.edu/~nr/toolkit/)。

*   如上所述，设计您的语言以避免类似`#include`. 要么不使用接口文件，要么预编译你的接口文件。这种策略极大地减少了词法分析器的负担，正如我所说，这通常是最大的瓶颈。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T07:03:33.400

埃菲尔对不同的冻结状态有一个想法，重新编译并不一定意味着整个类都被重新编译。

你能分解多少兼容的模块，你有多关心跟踪它们？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-23T18:46:35.440

到目前为止，答案中令人惊讶地缺少一件事：让您使用上下文无关语法等。仔细研究 Wirth 设计的语言，例如 Pascal 和 Modula-2。您不必重新实现 Pascal，但语法设计是为快速编译而定制的。然后看看你是否能找到任何关于 Anders 实现 Turbo Pascal 的技巧的旧文章。提示：表驱动。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-23T10:50:38.797

*   使语法简单明了，因此解析起来又快又容易。
*   对文件包含施加严格的限制。
*   尽可能允许在没有完整信息的情况下进行编译（例如，C 和 C++ 中的预声明）。
*   如果可能，一次性编译。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-23T06:37:07.440

这是一个镜头..

如果您的工具链支持，请使用增量编译。（制作、视觉工作室等）。

例如，在 GCC/make 中，如果您有许多文件要编译，但只对一个文件进行更改，则只编译该文件。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-23T19:04:48.797

制作一个不会烂的构建系统！

那里有大量的程序，可能需要 3 个源文件，编译时间不到一秒钟，但在你走到那一步之前，你必须先完成一个 automake 脚本，该脚本需要大约 2 分钟的时间检查诸如`int`. 如果你在一分钟后去编译其他东西，它会让你经历几乎完全相同的一组测试。

因此，除非您的编译器*对*用户做了可怕的事情，例如更改其`int`s 的大小或在运行之间更改基本函数实现，否则只需将该信息转储到一个文件中，让他们在一秒钟内而不是 2 分钟内得到它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-23T07:03:00.187

在 C++ 中，您可以使用[Incredibuild等工具进行分布式编译](http://www.xoreax.com/solutions_vs.htm)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-23T18:26:55.800

这是一个多么严重的编译器？

除非语法非常复杂，否则解析器的运行速度应该比仅通过输入文件字符索引慢 10-100 倍。

同样，代码生成应该受到输出格式的限制。

你不应该遇到任何性能问题，除非你正在做一个大而严肃的编译器，能够处理具有大量头文件的大型应用程序。

然后你需要担心预编译的头文件、优化过程和链接。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-23T18:51:27.863

我还没有看到为最小化编译时间所做的太多工作。但有些想法确实浮现在脑海中：

1.  保持语法简单。复杂的语法会增加你的编译时间。
2.  尝试使用并行性，使用多核 GPU 或 CPU。
3.  对现代编译器进行基准测试，看看有哪些瓶颈以及您可以在编译器/语言中做些什么来避免它们。

除非您正在编写一种高度专业化的语言，否则编译时间并不是真正的问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-23T18:11:48.923

*   确保在您尝试编译的第一次编译所有内容。例如禁止前向引用。
*   使用上下文无关语法，这样您就可以在没有符号表的情况下找到正确的分析树。
*   确保可以从语法中推断出语义，这样您就可以直接构造正确的 AST，而不是通过使用解析树和符号表来构建正确的 AST。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-23T06:39:01.553

这取决于您正在编程的语言/平台。对于 .NET 开发，请尽量减少解决方案中的项目数量。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-23T06:52:34.283

在过去，您可以通过设置 RAM 驱动器并在那里编译来获得显着的加速。不过，不知道这是否仍然成立。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-23T10:12:43.007

一个简单的方法：确保编译器可以原生地利用多核 CPU。

# vb.net - 获取windows中被删除的文件

> ID：576708
> 
> 赞同：3
> 
> 时间：2009-02-23T06:38:34.753
> 
> 标签：vb.net, vb6

我想创建一个应用程序，它将从闪存驱动器中删除的文件保存到用作回收站的闪存驱动器的一部分中。我想捕获 windows 的删除事件，以便我可以复制标记为已删除的文件。

如果删除事件正在执行，是否有一个库会通知我的应用程序？

如果使用 FileSystemWatcher 组件，我无法获取被删除的文件，因为它只会在文件被删除后通知。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T07:24:37.840

您需要通过 Preoperation Callback Routines 编写 filesystemfilter 或 filesystemminifilter 驱动程序

如给出的

[http://msdn.microsoft.com/en-us/library/ms793697.aspx](http://msdn.microsoft.com/en-us/library/ms793697.aspx)

# smtp - 检索邮件的 SMTP 响应

> ID：576712
> 
> 赞同：3
> 
> 时间：2009-02-23T06:40:44.123
> 
> 标签：smtp

是否可以检索邮件的 SMTP 响应。例如，我正在向不存在的电子邮件 ID 发送邮件。当然，我们的服务器会向我们的邮件 ID 发送一封邮件守护程序失败邮件。我需要捕获该失败邮件。

怎么可能？请解释一下。有时我们可能会输入多个不存在的电子邮件 ID，因此我必须为每封相应的电子邮件单独检索所有失败邮件

请指导我！

提前致谢，

普拉文

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T10:33:32.707

我想我现在正确理解了你的问题。据我了解，您正在编写一个发送邮件的应用程序。在您的应用程序中，每当您发送邮件时，您还需要验证邮件是否已送达以及是否未送达，那么您希望在应用程序中获取失败消息。你是这个意思吗？

好吧，如果这就是你的意思，那么我认为用你的应用代码跟踪邮件状态是不可能的。例如，如果您在应用程序中使用 java sendMail，您只能确保从您的代码成功发送（没有任何发送异常，如 java.net.SocketException 或 javax.mail.MessagingException）。但是，您永远无法确定邮件是否真的到达了收件人。即如果由于错误的收件人地址或任何其他错误（例如收件人邮件服务器上的非法附件或阻止发件人ID等错误）而导致邮件被拒绝，您永远无法在您的应用程序中跟踪。

这是因为任何这样的错误情况都将由接收邮件服务器传达给发送邮件服务器，发送邮件服务器的信息存在于已发送邮件的标题中。

这是否回答你的问题？（或者我是否正确理解了您的问题？;-)）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T06:50:07.300

我不确定我的问题是否正确。如果您从您的地址 yyy@yourhost.com 向任何不存在的地址（例如 xxx@gmail.com）发送电子邮件，则 gmail.com 的邮件服务器会回复 yourhost.com 的邮件服务器，并提供失败消息和原因，以及您的投递地址，您会自动收到失败的邮件。您不必为此做任何额外的事情。

如果您正在谈论查看邮件标头，那么这取决于您使用的客户端。例如，如果您使用的是 MS Outlook，您可以右键单击邮件并单击选项，然后查看 Internet 标头部分以获取邮件标头。如果您使用的是一些基于 Web 的邮件，那么我相信会有一些选项可以查看详细的邮件标题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T06:59:35.747

退回的邮件将返回到邮箱。您应该能够通过正确设置您发送的邮件的标题来配置该邮箱。然后，您需要监视该邮箱，或让该邮箱将消息传递到您的程序。

我建议您考虑对您发送的所有消息使用[VERP](http://en.wikipedia.org/wiki/Variable_envelope_return_path)。这将使您更容易识别特定退回邮件属于哪个电子邮件地址。要做到这一点，您需要控制您的邮件服务器。配置东西需要一些工作。

要更详细地回答这个问题，您需要告诉我们您是如何发送消息的，您正在运行什么类型的邮件服务器，以及您对邮件服务器的控制程度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T10:34:28.307

在 Unix 上，您可以为此使用“ [procmail](http://www.procmail.org/) ”。Procmail 是一种可以拦截您的邮件并按照规则处理它们的服务。

如果您可以访问我的 IMAP 邮件，我建议您查看 Python 模块[imaplib](http://docs.python.org/library/imaplib.html)。

# asp.net - 如何将自定义表格单元集合添加到 gridview 行

> ID：576728
> 
> 赞同：0
> 
> 时间：2009-02-23T06:47:45.747
> 
> 标签：asp.net, gridview, gridviewrow

我创建了一个自定义 GridView 服务器控件。接下来我想做的是将我自己的自定义 TableCell 集合与那个 GridView 一起使用，这样我就可以设置一些自定义属性等。无数小时的谷歌搜索让我头晕目眩，没有产生任何实际结果。

有人对如何将自定义 TableCell 集合集成到 GridView 的 GridViewRow 有任何提示吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-15T03:03:14.430

您的自定义 GridView 控件是否扩展了内置的 GridView？

如果是这样，应该可以在 GridView 的 RenderContents 函数中使用您的自定义 TableCell。

如果您愿意，请发布任何可能有帮助的代码。我以前研究过自定义 GridViews（尽管功能非常有限），所以我可以帮忙。

# jquery - 你能用 jQuery 动画边框吗？有可用的插件吗？

> ID：576732
> 
> 赞同：1
> 
> 时间：2009-02-23T06:49:50.170
> 
> 标签：jquery, jquery-animate

我需要在 jQuery 中为边框设置动画。更具体地说，边框的颜色。

我宁愿不使用 1px 高的 div 背景颜色动画等。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T06:52:04.393

哦，看起来这个可以做到！

[http://plugins.jquery.com/project/color](http://plugins.jquery.com/project/color)

# c# - 从 DateTime 获取时区

> ID：576740
> 
> 赞同：111
> 
> 时间：2009-02-23T06:53:47.040
> 
> 标签：c#, .net, datetime, timezone

.Net DateTime 是否包含有关其创建时区的信息？

我有一个库从末尾有“+zz”的格式解析 DateTime，虽然它可以正确解析并调整本地时间，但我需要从 DateTime 对象中获取特定时区。

这可能吗？我只能看到 DateTime.Kind，它指定时间是本地时间还是 UTC。

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-02-23T07:07:30.753

DateTime 本身不包含真正的时区信息。它*可能*知道它是 UTC 还是本地，但不知道本地的真正含义。

DateTimeOffset 稍微好一些 - 这基本上是 UTC 时间和偏移量。但是，这仍然不足以确定时区，因为许多不同的时区在任何一个时间点都可以具有相同的偏移量。不过，这听起来对您来说可能已经足够好了，因为在解析日期/时间时您所要做的就是偏移量。

.NET 3.5 对时区的支持比以前好很多，但我真的很想看到标准的“ZonedDateTime”或类似的东西——UTC 时间和实际时区。构建你自己的很容易，但是在标准库中看到它会很高兴。

编辑：将近四年后，我现在建议使用具有更丰富的日期/时间类型集的[Noda Time 。](http://nodatime.org/)不过，作为野田时间的主要作者，我有偏见:)

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-02-23T07:03:57.453

不。

> *开发人员负责通过某种外部机制跟踪与 DateTime 值关联的时区信息。*

引用[这里](http://msdn.microsoft.com/en-us/library/ms973825.aspx)的一篇优秀文章。每个 .Net 开发人员都必须阅读。

所以我的建议是编写一个适合您需求的小包装类。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-24T06:56:26.807

.NET有一个[公共领域的 TimeZone 库](http://www.codeplex.com/publicdomain)。真的很有用。它将满足您的需求。

解决一般情况下的时区问题比您想象的要难。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-03-13T15:25:00.617

您可以使用**TimeZoneInfo**类

TimeZone 类识别本地时区，并且可以在协调世界时 (UTC) 和本地时间之间转换时间。TimeZoneInfo 对象可以表示任何时区，TimeZoneInfo 类的方法可以将一个时区的时间转换为任何其他时区的对应时间。TimeZoneInfo 类的成员支持以下操作：

1.  检索已由操作系统定义的时区。

2.  枚举系统上可用的时区。

3.  在不同时区之间转换时间。

4.  创建操作系统尚未定义的新时区。

    序列化时区以供以后检索。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T07:05:10.493

从 API（[http://msdn.microsoft.com/en-us/library/system.datetime_members(VS.71).aspx](http://msdn.microsoft.com/en-us/library/system.datetime_members(VS.71).aspx)）看来，它似乎无法显示所用时区的名称。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-03-19T20:01:18.527

通常的做法是将数据作为带有 UTC“时区”的 DateTime 传递，然后传递一个 TimeZoneInfo 对象，当您准备好显示数据时，使用 TimeZoneInfo 对象转换 UTC DateTime。

另一个选项是使用当前时区设置 DateTime，然后确保 DateTime 对象的“时区”是未知的，然后确保再次传递 DateTime，并使用指示传递的 DateTime 的 TimeZone 的 TimeZoneInfo。

正如其他人在这里指出的那样，如果 Microsoft 能够在此基础上创建一个很好的对象来完成这一切，那就太好了，但是现在您必须处理两个对象。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-05-23T19:45:20.177

DateTime 不知道其时区偏移量。没有内置方法可以返回偏移量或时区名称（例如 EAT、CEST、EST 等）。

就像其他人建议的那样，您可以将日期转换为 UTC：

```
DateTime localtime = new DateTime.Now;
var utctime = localtime.ToUniversalTime(); 
```

然后只计算差异：

```
TimeSpan difference = localtime - utctime; 
```

您也可以使用 DateTimeOffset 将一个时间转换为另一个时间：

```
DateTimeOffset targetTime = DateTimeOffset.Now.ToOffset(new TimeSpan(5, 30, 0)); 
```

但这是一种有损压缩 - 仅偏移量无法告诉您它所在的时区，因为两个不同的国家可能位于不同的时区，并且仅在一年中的部分时间（例如南非和欧洲）具有相同的时间。此外，请注意夏季夏令时可能会在不同的日期引入（EST 与 CET - 3 周的差异）。

您可以使用 TimeZoneInfo 类获取本地系统时区的名称：

```
TimeZoneInfo localZone = TimeZoneInfo.Local;
localZone.IsDaylightSavingTime(localtime) ? localZone.DaylightName : localZone.StandardName 
```

我同意 Gerrie Schenck 的观点，请阅读他建议的文章。

# c# - 自定义浏览文件夹对话框以显示路径

> ID：576741
> 
> 赞同：29
> 
> 时间：2009-02-23T06:53:47.370
> 
> 标签：c#, winforms

有谁知道自定义 System.Windows.Forms.FolderBrowserDialog 的最简单方法是什么，以便可以使用树下方文本框中的文本输入路径。

我想要这个，所以很容易选择未映射的 UNC 路径。

看起来[这个 KB](http://support.microsoft.com/kb/306285)有一些支持信息。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-24T06:49:42.690

就在这个周末，我需要这个。我看了又看，但找不到。根据那篇知识库文章和其他一些东西，我自己写了它。给你。 [FolderBrowserDialogEx（存档中的文章）](http://web.archive.org/web/20090223114903/http://www.codeplex.com/DotNetZip/)

完整的源代码。自由。MS-公共许可证。

![FolderBrowserDialogEx](https://i.stack.imgur.com/sYdYD.png)

使用它的代码：

```
 var dlg1 = new Ionic.Utils.FolderBrowserDialogEx();
     dlg1.Description = "Select a folder to extract to:";
     dlg1.ShowNewFolderButton = true;
     dlg1.ShowEditBox = true;
     //dlg1.NewStyle = false;
     dlg1.SelectedPath = txtExtractDirectory.Text;
     dlg1.ShowFullPathInEditBox = true;
     dlg1.RootFolder = System.Environment.SpecialFolder.MyComputer;

     // Show the FolderBrowserDialog.
     DialogResult result = dlg1.ShowDialog();
     if (result == DialogResult.OK)
     {
         txtExtractDirectory.Text = dlg1.SelectedPath;
     } 
```

功能：显示编辑框，在编辑框中显示完整路径。可用于浏览打印机或计算机，以及文件+文件夹，或只是文件夹。

**编辑，2018-05-31：** 如果上面的 Codeplex 链接对您不起作用，[则此 Git 资源](https://github.com/jkells/folder-browser-dialog-example/blob/master/FolderBrowserDialogEx.cs)也存在。

**编辑，2022-02-11：** 原作者可能有新的回购[https://github.com/DinoChiesa/DotNetZip/blob/master/Zip/Resources/FolderBrowserDialogEx.cs](https://github.com/DinoChiesa/DotNetZip/blob/master/Zip/Resources/FolderBrowserDialogEx.cs)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T15:09:08.503

在代码项目[文件夹浏览器](http://www.codeproject.com/KB/selection/folderbrowser.aspx?msg=1050735#xx1050735xx)下尝试- 这允许以多种方式自定义对话框。

在[social.msdn.microsoft.com](http://social.msdn.microsoft.com/Forums/en-US/winforms/thread/b16246c7-c2a9-4b37-b0aa-85b1ab4bfb0f)中也有一篇文章建议为此创建一个您自己的表单，甚至建议它的代码。

# javascript - John Resigs 微模板引擎，如何处理选择的问题？

> ID：576749
> 
> 赞同：1
> 
> 时间：2009-02-23T07:02:13.603
> 
> 标签：javascript, jquery, templating

我有一个看起来像这样的模板：

```
<script type="text/html" id="TemplateEdit">

    <td>
        <input type="hidden" value="<#= item.ID #>" id="Edit.ID" name="Edit.ID" />
        <select id="Edit_ClientID" name="Edit.ClientID">
            <option value="1">test</option>
            <option value="2">test 2</option>
            <option value="3">test 3</option>
        </select>
    </td>
    <td>
        <select id="Edit_Frequency" name="Edit.Frequency">
            <option value="1">Daily</option>
            <option value="2">Weekly</option>
            <option value="3">Fortnightly</option>
        </select>
    </td>
</script> 
```

在我传入的“item”对象中，它具有一些属性，例如 item.ClientID 和 item.Frequency。

一个通用函数处理模板的吸收和注入：

```
var template = tmpl(editTemplate, { item: data }); // this runs jresig's template code
domEle.append(template); //append the results in 
```

从理论上讲，运行此代码后，我可以执行以下操作：

```
$("#Edit_ClientID").val(data.ClientID); 
```

但是，我不想给这个模板函数添加特定于这个模板练习的代码。这个特定的函数处理整个站点的模板，我需要保持它的通用性。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T00:15:30.640

你可以在那里写普通的javascript，所以如果我正确理解你的问题，你可以这样做：

```
<script type="text/html" id="TemplateEdit">

    <td>
        <input type="hidden" value="<#= item.ID #>" id="Edit.ID" name="Edit.ID" />
        <select id="Edit_ClientID" name="Edit.ClientID">
            <option value="1" <# if(data.ClientID == 1){ #> selected <# } #>>test</option>
            <option value="2"<# if(data.ClientID == 2){ #> selected <# } #>>test 2</option>
            <option value="3"<# if(data.ClientID == 3){ #> selected <# } #>>test 3</option>
        </select>
    </td>
    <td>
        <select id="Edit_Frequency" name="Edit.Frequency">
            <option value="1">Daily</option>
            <option value="2">Weekly</option>
            <option value="3">Fortnightly</option>
        </select>
    </td>
</script> 
```

对于可执行的 javascript，请使用 <# #>，而不是 <#= #>

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T08:28:54.660

为什么不将整个 <Options> 列表作为模板参数传递？不一定是最优雅的......但它会避免向模板添加条件逻辑（即“这个项目是当前选定的项目吗？是的输出“选择”，没有输出什么）。

# unix - 一个标准的 Unix 命令行工具，用于连接到套接字

> ID：576750
> 
> 赞同：24
> 
> 时间：2009-02-23T07:02:15.087
> 
> 标签：unix, sockets, command-line, named-pipes

我有一些应用程序和标准 Unix 工具将它们的输出发送到 Solaris 中的命名管道，但是命名管道只能从本地存储（在 Solaris 上）读取，因此我无法通过网络访问它们或放置管道在 NFS 存储上，以通过网络访问其输出。

这让我想知道是否有类似的方法可以将命令行工具的输出直接转发到套接字，比如：

```
mksocket mysocket:12345
vmstat 1 > mysocket 2>&1 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-23T07:11:06.517

[Netcat](http://netcat.sourceforge.net/)非常适合这个。这是一个[包含一些常见示例的页面](http://www.g-loaded.eu/2006/11/06/netcat-a-couple-of-useful-examples/)。

您的案例的用法可能如下所示：

1.  服务器侦听连接，然后将输出发送给它：

    `server$ my_script | nc -l 7777`

2.  远程客户端连接到`server`端口 7777，接收数据，保存到日志文件：

    `client$ nc server 7777 >> /var/log/archive`

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-23T07:23:49.293

[`netcat`](http://netcat.sourceforge.net/)（也称为`nc`）正是您正在寻找的。它变得相当标准，但并非在所有系统上都可用。

[`socat`](http://www.dest-unreach.org/socat/)似乎是 netcat 的增强版本，具有更多功能，但不太常见。

在 Linux 上，您还可以使用`/dev/tcp/<host>/<port>`. 有关详细信息，请参阅[高级 Bash 脚本指南](http://tldp.org/LDP/abs/html/devref1.html#DEVTCP)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-23T07:05:20.570

netcat 将帮助在网络上建立管道。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-23T07:15:30.907

您可能想要使用以下之一：

1.  ssh：安全（加密），已在 Solaris 上开箱即用 - 但您必须为非交互式会话设置密钥对
    *   例如`vmstat 2>&1 | ssh -i private.key oss@remote.node "cat >vmstat.out"`
2.  netcat：设置简单 - 但不安全且容易受到攻击
    *   请参阅[http://www.debian-administration.org/articles/58](http://www.debian-administration.org/articles/58)等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-10-19T06:58:36.250

使用 netcat，每个人都在正确的轨道上。但我想补充一点，如果您正在输入`nc`并期待响应，您将需要使用该`-q <seconds>`选项。从手册：

> -q 秒
> 
> 在标准输入上的 EOF 之后，等待指定的秒数然后退出。如果秒数为负数，请永远等待。

例如，如果您想与您的 SSH 代理进行交互，您可以执行以下操作：

```
echo -en '\x00\x00\x00\x01\x0b' | nc -q 1 -U $SSH_AUTH_SOCK | strings 
```

更完整的示例位于[https://gist.github.com/RichardBronosky/514dbbcd20a9ed77661fc3db9d1f93e4](https://gist.github.com/RichardBronosky/514dbbcd20a9ed77661fc3db9d1f93e4)

* 我从[https://ptspts.blogspot.com/2010/06/how-to-use-ssh-agent-programmatically.html偷了这个](https://ptspts.blogspot.com/2010/06/how-to-use-ssh-agent-programmatically.html)

# linux - 为什么我们在 x86 上需要 zone_highmem？

> ID：576761
> 
> 赞同：6
> 
> 时间：2009-02-23T07:06:39.757
> 
> 标签：linux, memory-management, linux-kernel

在 linux 内核中，`mem_map`是包含所有“结构页面”描述符的数组。这些页面包括 lowmem 中的 128MiB 内存，用于动态映射 highmem。

由于lowmem大小为1GiB，所以`mem_map`数组只有1GiB/4KiB＝256KiB条目。如果每个条目大小为 32 字节，则`mem_map`内存大小 = 8MiB。但是如果我们可以使用`mem_map`映射所有 4GiB 物理内存（如果我们在 x86-32 上有这么多可用物理内存），那么 mem_map 数组将占用 32MiB，这不是很多内核内存（或者我错了吗？）。

所以我的问题是：为什么我们首先需要将 128MiB 用于间接高端映射？或者换一种说法，为什么不直接在内核空间中映射所有最大 4GiB 物理内存（如果可用）？

注意：如果我对上面内核源码的理解有误，请指正。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T07:25:09.353

看这里：[http](http://www.xml.com/ldd/chapter/book/ch13.html)

://www.xml.com/ldd/chapter/book/ch13.html 内核低内存是“真正的”内存映射，在 x86 上用 32 位指针寻址。

内核高内存是“虚拟”内存映射，在 x86 上使用虚拟结构寻址。

您不想将其全部映射到内核地址空间，因为您不能总是寻址所有这些，并且您需要大部分内存用于虚拟内存段（虚拟的，页面映射的进程空间）

。至少，我就是这样读的。哇，你问的这个问题好复杂。

为了引发更多混乱，第 13 章讨论了一些 PCI 设备无法处理 32 位空间，这是我之前评论的起源：

在 x86 上，由于 DMA 寻址问题，某些内核内存使用仅限于内存的第一个 GB。我不是 100% 熟悉这个话题，但是 PCI 总线上有一个 DMA 兼容模式。这可能就是您正在查看的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T07:39:27.120

使用物理地址扩展时，3.6 GB 不是上限，这在大多数现代 x86 主板上通常需要，尤其是内存热插拔。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-10-05T07:53:17.630

> 或者换一种说法，为什么不直接在内核空间中映射所有最大 4GiB 物理内存（如果可用）？

一个原因是用户空间：每个用户空间进程都有自己的虚拟地址空间。假设您在 x86 上有 4Gb 的 RAM。因此，如果我们建议内核拥有 1Gb 的内存（约 800 直接映射 + 约 200 vmalloc），那么所有其他约 3 Gb 应该在用户空间中旋转的进程之间**动态**分配。那么，当您有多个地址空间时，如何直接映射您的 4Gbs？

> 为什么我们在 x86 上需要 zone_highmem？

原因是一样的。内核只为低内存保留约 800Mb。所有其他内存将仅在需要时分配并与特定的虚拟地址连接。例如，如果您将执行一个二进制文件，则会创建一个新的虚拟地址空间，并分配一些页面来存储您的二进制代码和数据（堆、堆栈...）。所以high mem的关键属性是服务于动态内存分配请求，你永远不知道用户空间会触发什么......

# iphone - 导航控制器内的标签栏控制器，或共享导航根视图

> ID：576764
> 
> 赞同：80
> 
> 时间：2009-02-23T07:10:26.207
> 
> 标签：iphone, cocoa-touch, uitabbarcontroller, uinavigationbar

我正在尝试实现一个类似于*Tweetie*应用程序中的 UI 结构，其行为如下：顶级视图控制器似乎是一个导航控制器，其根视图是一个“帐户”表视图。如果您单击任何帐户，它将进入第二级，底部有一个标签栏。每个选项卡项显示一个不同的列表，让您可以进一步向下钻取（后续级别不显示选项卡栏）。

因此，这似乎是实现层次结构：

*   `UINavigationController`
    1.  *账户*：`UITableViewController`
    2.  `UITabBarController`
        1.  *推文*：`UITableViewController`
            *   推文/用户/等的详细视图
        2.  *回复*：`UITableViewController`
        3.  ...

这似乎有效[^1]，但根据 SDK 文档似乎不受支持`-pushViewController:animated:`（强调添加）：

> *viewController*：被压入堆栈的视图控制器。**它不能是标签栏控制器的实例。**

我想避免使用私有 API 等，但我不确定为什么即使它看起来工作正常，也明确禁止这种用法。有人知道原因吗？

我考虑过将标签栏控制器作为主控制器，每个标签都包含单独的导航控制器。这样做的问题是每个导航控制器都需要共享一个根视图控制器（即*Tweetie*中的“帐户”表）——这似乎不起作用：将表控制器推到第二个导航控制器似乎将其删除从一开始。更不用说选择不同帐户时的所有簿记可能会很痛苦。

我应该如何以正确的方式实施这个？

[^1]：标签栏控制器需要被子类化，以便标签栏控制器在该级别的导航项与所选标签的导航项保持同步，并且各个标签的表格控制器需要将它们各自的详细视图推送到`self.tabBarController.navigationController`而不是`self.navigationController`.

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-02-23T19:54:49.800

前两个答案是正确的——我不在`UITabBarController`Tweetie 中使用。编写一个很容易被推送到导航控制器堆栈的自定义`XXTabBarController`（普通子类`UIViewController`）很容易，但仍然遵循“视图控制器”理念。`Tweets`帐户特定视图 ( / `Replies`/ )上的每个“选项卡”`Messages`都是它自己的视图控制器，就他们而言，它们在屏幕上被一个 plain-ol 交换`UITabBarController`。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-04-29T22:19:25.853

我正在构建一个使用与 Tweetie 类似的导航框架的应用程序。我在我的博客[www.wiredbob.com](http://www.wiredbob.com/2009/04/iphone-tweetie-style-navigation.html)上写了一篇关于如何做到这一点的文章，该博客还链接到源代码。这是一个完整的模板，您可以将其用作另一个项目的基础。祝你好运！

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-23T07:59:56.087

可以将 UITabBar 添加到任何 UIViewController。这样，您实际上不必推送 UITabBarController 并因此保持在 Apple API 的指导范围内。

在界面构建器中，UITabBar 位于 Cocoa Touch Library 中的“Windows、Views & Bars”下。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-23T17:00:40.873

我在我的几个应用程序中执行此操作。将标签栏添加到基于 navigationController 的应用程序的技巧是不使用 TabBarController。将标签栏添加到视图，使该视图的视图控制器成为 TabBarDelegate，并在视图控制器的代码中响应用户在标签栏上的选择。

我使用选项卡栏将其他视图添加到选项卡栏的视图作为子视图，重新加载具有不同数据集的表格视图，重新加载 UIPickerView 等。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-01-08T08:31:29.773

在过去的一个小时里，我一直在努力实现 a`UITabBar`因为当我试图显示我的视图时它会被隐藏；然后我发现了这篇[文章](http://discussions.apple.com/thread.jspa?threadID=2099944&tstart=0)：

基本上，请确保根据这行代码在选项卡栏下方插入新视图：

```
[self.view insertSubview:tab2ViewController.view belowSubview:myTabBar]; 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-01-17T09:48:54.993

在我的应用程序中，根视图控制器是 UINavigation 控制器。在应用程序的某个时刻，我需要显示一个 UITabBar。正如之前的一些帖子所建议的那样，我尝试在导航层次结构中的 UIView 上实现 UITabBar，这确实有效。但我发现我想要更多选项卡控制器提供的默认行为，并且我找到了一种将 UITabBarController 与 UINavigation 控制器一起使用的方法：

1）当我想显示 UITabBarController 的视图时，我这样做：

```
MyAppDelegate *appDelegate = [[UIApplication sharedApplication] delegate];
appDelegate.window.rootViewController = myUiTabBarControllerInstance; 
```

2）当我想返回到导航层次结构中的位置时，我这样做：

```
appDelegate.window.rootViewController = myNavControllerInstance; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-10-08T08:23:18.157

我就是这样做的。这实际上是将 tabbarcontroller 推到导航控制器上。它工作正常。我在文档中没有找到苹果不支持这种方式的任何地方。有人可以给我这个警告的链接吗？

如果这是真的，苹果是否有可能拒绝将我的应用发布到应用商店？

```
-(void)setArrayAndPushNextController
{
    MyFirstViewController *myFirstViewController = [[MyFirstViewController alloc] init];
    MySecondViewController *mySecondViewController = [[MySecondViewController alloc] init];

    myFirstViewController.array = self.array;

    NSArray *array = [[NSArray alloc] initWithObjects:myFirstViewController, mySecondViewController, nil];
    UITabBarController *tab = [[UITabBarController alloc] init];
    tab.viewControllers = array;

    [array release];

    UITabBarItem *item1 = [[UITabBarItem alloc] initWithTitle:@"first title" image:nil tag:1];
    UITabBarItem *item2 = [[UITabBarItem alloc] initWithTitle:@"second title" image:nil tag:2];

    myFirstViewController.tabBarItem = item1;
    mySecondViewController.tabBarItem = item2;

    [self stopAnimatingSpinner];

    [self.navigationController pushViewController:tab animated:YES];

    [tab release];
    [item1 release];
    [item2 release];
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-11-13T13:03:41.503

这可以通过简单地将 TabBarController 嵌入到导航控制器中来实现。在故事板中：

1.  拖动一个 ViewController
2.  点击 ViewController 的场景
3.  单击编辑器>>嵌入>>导航控制器。
4.  在同一个 ViewController 上拖动一个按钮。
5.  拖动一个 TabBarController
6.  通过 push Segue Action 将 ViewController 上的按钮连接到 TabBarController。

在这种情况下，只有 TabBarController 的 RootViewController 会在 Navigation Controller 的堆栈中。所有的 TabBarItems 顶部都有导航栏，用户可以随时进入主屏幕，而不管所选的 TabBarItem

这可以在导航控制器堆栈中的任何 ViewController 上完成。

如果可行，请建议我如何提高声誉，以便我可以在下一个答案中发布图像和代码。:)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-04-12T18:10:43.477

我写了一篇关于我如何解决这个问题的博客文章。对我来说，使用模态视图比编写自定义标签栏实现更简单。

[http://www.alexmedearis.com/uitabbarcontroller-inside-a-uinavigationcontroller/](http://www.alexmedearis.com/uitabbarcontroller-inside-a-uinavigationcontroller/)

# c++ - c++ 类及其成员函数的名称修改？

> ID：576767
> 
> 赞同：3
> 
> 时间：2009-02-23T07:11:07.623
> 
> 标签：c++

当从 c++ dll 暴露时，我有没有办法避免 C++ 类及其成员函数的名称修改。

在这方面我不能使用 def 文件机制吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-23T07:12:15.967

我不相信。使用名称修饰，以便每个重载函数具有链接器查看的不同名称。

你可以用 C 重写它们并使用`extern "C" {}`构造，但是你会失去所有漂亮的继承、多态性等等。您还可以将 C++ 包装在 C 函数中并仅公开 C 函数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T07:20:21.407

我认为最好的方法是在 C++ 库周围提供 C 包装器。当我在 C++ 中编程时，这在 10 年或更长时间前非常流行，但我不知道它是否已经完成了。

基本上，对于每个要公开的`class C`构造函数`ctor`以创建一个`extern "C" CPtr cCtor(....)`返回不透明指针的方法`CPtr`以及要公开的每个函数`func`，您都可以创建`extern "C" cFunc(CPtr,....)`

另一种方法是创建一个`CStruct`具有函数指针类型的成员变量，实现它们以调用类方法并让客户端完成所有艰苦的工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T07:13:09.990

我能想到的唯一方法是将函数声明为 extern "C"。链接器需要名称修饰来区分例如重载函数的参数列表（如果不是名称修饰，链接器将无法使用）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-11T06:55:51.440

我认为虚函数将是答案，您是否注意到 COM，创建一个实例，它为您提供了一个指向表示为类的接口的指针。我猜想声明的方法不是按名称解析的，而是按插槽索引解析的。

# ios - 如何调用 iPhone 地图以获取当前位置作为起始地址的方向

> ID：576768
> 
> 赞同：73
> 
> 时间：2009-02-23T07:11:15.457
> 
> 标签：ios, objective-c, google-maps

我知道可以通过调用`openURL`带有参数`saddr`和`daddr`位置字符串或纬度/经度的谷歌地图 URL 来启动 iPhone 地图应用程序（参见下面的示例）。

但我想知道是否可以将起始地址设为**“当前位置”**地图书签，以便我可以使用**地图**应用程序的位置处理代码。我的谷歌搜索一直没有结果。

例如：

```
[[UIApplication sharedApplication] openURL:[NSURL URLWithString:[NSString stringWithFormat: @"http://maps.google.com/maps?saddr=%@&daddr=%@", myLatLong, latlong]]]; 
```

除了调用当前位置书签来代替`myLatLong`.

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2009-06-08T09:49:53.333

## iOS 6 之前

您需要使用核心位置来获取当前位置，但是使用该纬度/经度对，您可以让地图将您从那里路由到街道地址或位置。像这样：

```
CLLocationCoordinate2D currentLocation = [self getCurrentLocation];
// this uses an address for the destination.  can use lat/long, too with %f,%f format
NSString* address = @"123 Main St., New York, NY, 10001";
NSString* url = [NSString stringWithFormat: @"http://maps.google.com/maps?saddr=%f,%f&daddr=%@",
                    currentLocation.latitude, currentLocation.longitude,
                    [address stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]];
[[UIApplication sharedApplication] openURL: [NSURL URLWithString: url]]; 
```

最后，如果您确实想避免使用 CoreLocation 来显式查找当前位置，而是想使用`@"http://maps.google.com/maps?saddr=Current+Location&daddr=%@"`url，[请参阅我在下面的评论中提供的链接，](http://www.martip.net/blog/localized-current-location-string-for-iphone-apps)了解如何本地化**Current+Location**字符串。但是，您正在利用另一个未记录的功能，正如 Jason McCreary 在下面指出的那样，它在未来的版本中可能无法可靠地工作。

* * *

## iOS 6 更新

最初，**地图**使用谷歌地图，但现在，苹果和谷歌拥有独立的地图应用程序。

**1)**如果您希望使用 Google Maps 应用程序进行路由，请使用[comgooglemaps URL 方案](https://developers.google.com/maps/documentation/ios/urlscheme#directions)：

```
NSString* url = [NSString stringWithFormat: @"comgooglemaps://?daddr=%@&directionsmode=driving",
                    [address stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]];
BOOL opened = [[UIApplication sharedApplication] openURL: [NSURL URLWithString: url]]; 
```

**2)**要使用 Apple 地图，您可以使用`MKMapItem`iOS 6 的新类。 [请参阅此处的 Apple API 文档](https://developer.apple.com/documentation/mapkit/mkmapitem)

基本上，如果路由到目标*坐标*( `latlong`)，您将使用类似的东西：

```
 MKPlacemark* place = [[MKPlacemark alloc] initWithCoordinate: latlong addressDictionary: nil];
    MKMapItem* destination = [[MKMapItem alloc] initWithPlacemark: place];
    destination.name = @"Name Here!";
    NSArray* items = [[NSArray alloc] initWithObjects: destination, nil];
    NSDictionary* options = [[NSDictionary alloc] initWithObjectsAndKeys:
                                 MKLaunchOptionsDirectionsModeDriving, 
                                 MKLaunchOptionsDirectionsModeKey, nil];
    [MKMapItem openMapsWithItems: items launchOptions: options]; 
```

为了在同一代码中同时支持 iOS 6+ 和 iOS 6 之前的版本，我建议使用 Apple 在`MKMapItem`API 文档页面上提供的类似代码：

```
Class itemClass = [MKMapItem class];
if (itemClass && [itemClass respondsToSelector:@selector(openMapsWithItems:launchOptions:)]) {
   // iOS 6 MKMapItem available
} else {
   // use pre iOS 6 technique
} 
```

这将假设您的 Xcode Base SDK 是 iOS 6（或**最新的 iOS**）。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-12-01T10:05:57.393

```
NSString* addr = [NSString stringWithFormat:@"http://maps.google.com/maps?daddr=Current Location&saddr=%@",startAddr];
NSURL* url = [[NSURL alloc] initWithString:[addr stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]];
[[UIApplication sharedApplication] openURL:url];
[url release]; 
```

这有效，但仅当 iPhone/iPod 语言设置为英语时。如果您想支持其他语言，则必须使用本地化字符串来匹配地图书签名称。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-11-01T14:46:16.350

这适用于 iPhone：

> [http://maps.google.com/maps?saddr=Current Location&daddr=123 Main St,Ottawa,ON](http://maps.google.com/maps?saddr=Current%20Location&daddr=123%20Main%20St,Ottawa,ON)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-09-30T09:51:55.743

您可以使用预处理器#define，例如：

```
#define SYSTEM_VERSION_LESS_THAN(v)  ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] == NSOrderedAscending) 
```

了解您的 iOS 版本。然后，我也可以使用此代码来支持 iOS 6：

```
NSString* addr = nil;
if (SYSTEM_VERSION_LESS_THAN(@"6.0")) {
   addr = [NSString stringWithFormat:@"http://maps.google.com/maps?daddr=%1.6f,%1.6f&saddr=Posizione attuale", view.annotation.coordinate.latitude,view.annotation.coordinate.longitude];
} else {
   addr = [NSString stringWithFormat:@"http://maps.apple.com/maps?daddr=%1.6f,%1.6f&saddr=Posizione attuale", view.annotation.coordinate.latitude,view.annotation.coordinate.longitude];
}

NSURL* url = [[NSURL alloc] initWithString:[addr stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]];
[[UIApplication sharedApplication] openURL:url]; 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-23T15:07:00.867

由于沙盒，您无权访问 Map 应用程序的书签。

相反，请使用核心位置自行确定当前位置。然后在您构建的 URL 中使用该位置（经纬度）打开地图。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-09-07T12:37:29.753

我建议查看[CMMapLauncher](https://github.com/citymapper/CMMapLauncher)，这是我构建的一个迷你库，用于启动具有特定映射请求的 Apple、Google 和其他 iOS 映射应用程序。使用 CMMapLauncher，在您的问题中获取方向的代码将是：

```
[CMMapLauncher launchMapApp:CMMapAppAppleMaps
          forDirectionsFrom:[CMMapPoint mapPointWithName:@"Origin"
                                              coordinate:myLatLong]
                         to:[CMMapPoint mapPointWithName:@"Destination"
                                              coordinate:latlong]]; 
```

如您所见，它还封装了 iOS 6 和其他版本之间所需的版本检查。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-09-21T17:57:01.007

嘿，因为iOS6已经出来了！

苹果以一种糟糕的方式做了一些了不起的事情（从我的角度来看）。

`maps.google.com/?q=`Apple 的地图已启动，对于运行 iOS 6 的设备，如果您希望 iDevice 打开本机计划应用程序，则不应使用。现在是`maps.apple.com/?q=`。

为了让开发人员不必做太多工作，友好的 maps.apple.com 服务器将所有非 Apple 设备重定向到 maps.google.com，因此更改是透明的。

这样，我们开发人员只需将所有谷歌查询字符串切换为苹果查询字符串。这是我非常不喜欢的。

我今天必须实现该功能，所以我做到了。但我觉得我不应该只重写移动网站中的每个 url 以针对 Apple 的地图服务器，所以我认为我应该只检测 iDevices 服务器端并为这些服务提供苹果 url。我以为我会分享。

我正在使用 PHP，所以我使用了开源 Mobile Detect 库：[http ://code.google.com/p/php-mobile-detect/](http://code.google.com/p/php-mobile-detect/)

只需将`isiPad`伪方法用作布尔 getter，就完成了，您不会将 google 转换为 apple ;-)

```
$server=$detect->isiPad()?"apple":"google";
$href="http://maps.{$server}.com/?q=..." 
```

干杯!

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-09-20T10:53:22.373

对于 iOS6，苹果文档推荐使用等效的 maps.apple.com URL Scheme

所以用

```
http://maps.apple.com/maps?saddr=%f,%f&daddr=%f,%f 
```

代替

```
http://maps.google.com/maps?saddr=%f,%f&daddr=%f,%f 
```

为了向后兼容，代码将是

```
 NSString* versionNum = [[UIDevice currentDevice] systemVersion];
    NSString *nativeMapScheme = @"maps.apple.com";
    if ([versionNum compare:@"6.0" options:NSNumericSearch] == NSOrderedAscending)
        nativeMapScheme = @"maps.google.com";
    }
    NSString* url = [NSString stringWithFormat: @"http://%@/maps?saddr=%f,%f&daddr=%f,%f", nativeMapScheme
             startCoordinate.latitude, startCoordinate.longitude,
             endCoordinate.latitude, endCoordinate.longitude];
    [[UIApplication sharedApplication] openURL:[NSURL URLWithString:url]]; 
```

Apple Maps URL 方案还有大量其他受支持的参数：[Apple URL Scheme Reference](http://developer.apple.com/library/ios/featuredarticles/iPhoneURLScheme_Reference/iPhoneURLScheme_Reference.pdf)

如果您的代码的其他部分有条件代码，您可以使用这些 iOS 版本检测宏。[iOS 版本宏](https://stackoverflow.com/a/8042056/143318)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-06-02T16:51:22.867

真正的解决方案可以在这里找到。[Z5 Concepts iOS 开发代码片段](http://z5concepts.com/z5blog/post/How-To-Use-Current-Location-in-iOS-Maps-App.aspx)

它只需要一点编码。

```
- (IBAction)directions1_click:(id)sender
{
    NSString* address = @"118 Your Address., City, State, ZIPCODE";
    NSString* currentLocation = @"Current Location";
    NSString* url = [NSStringstringWithFormat: @"http://maps.google.com/maps?saddr=%@&daddr=%@",[currentLocation stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding],[address stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]];
    UIApplication *app = [UIApplicationsharedApplication];
    [app openURL: [NSURL URLWithString: url]];
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-05-26T23:34:04.460

您现在可以仅通过移动设备上的 url 在 html 中执行此操作。这是一个[例子](http://maps.google.com/maps/m?dc=mgc_maps#ll=43.600113,-116.198677&z=13&saddr=My%20Location&daddr=1910%20university%20dr%20Boise%20id&ttype=dep&dirflg=d&view=map&l-view=map&l-lci=m,com.google.latitudepublicupdates&ac=t,l,)。很酷的事情是，如果你把它变成一个二维码，你就可以通过手机扫描，从他们所在的任何地方找到你的方向。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-12-06T12:14:54.063

如果您不想请求位置权限并且没有 lat 和 lng，请使用以下内容。

```
NSString *destinationAddress = @"Amsterdam";

Class itemClass = [MKMapItem class];
if (itemClass && [itemClass respondsToSelector:@selector(openMapsWithItems:launchOptions:)]) {

    CLGeocoder *geocoder = [[CLGeocoder alloc] init];
    [geocoder geocodeAddressString:destinationAddress completionHandler:^(NSArray *placemarks, NSError *error) {
        if([placemarks count] > 0) {

            MKPlacemark *placeMark = [[MKPlacemark alloc] initWithPlacemark:[placemarks objectAtIndex:0]];

            MKMapItem *mapItem = [[MKMapItem alloc]initWithPlacemark:placeMark];

            MKMapItem *mapItem2 = [MKMapItem mapItemForCurrentLocation];

            NSArray *mapItems = @[mapItem, mapItem2];

            NSDictionary *options = @{
        MKLaunchOptionsDirectionsModeKey:MKLaunchOptionsDirectionsModeDriving,
        MKLaunchOptionsMapTypeKey:
            [NSNumber numberWithInteger:MKMapTypeStandard],
        MKLaunchOptionsShowsTrafficKey:@YES
            };

            [MKMapItem openMapsWithItems:mapItems launchOptions:options];

        } else {
            //error nothing found
        }
    }];
    return;
} else {

    NSString *sourceAddress = [LocalizedCurrentLocation currentLocationStringForCurrentLanguage];

    NSString *urlToOpen = [NSString stringWithFormat:@"http://maps.google.com/maps?saddr=%@&daddr=%@",
                 [sourceAddress stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding],
                 [destinationAddress stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding]];

    [[UIApplication sharedApplication] openURL:[NSURL URLWithString:urlToOpen]];
} 
```

对于 ios5，当前位置需要使用正确的语言。我使用这篇文章中的 LocalizedCurrentLocation [http://www.martip.net/blog/localized-current-location-string-for-iphone-apps](http://www.martip.net/blog/localized-current-location-string-for-iphone-apps)

对于 ios6，我使用 CLGeocoder 来获取地标，然后用它和当前位置打开地图。

记得添加 CoreLocation.framework 和 MapKit.framework

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-12-15T18:30:55.750

使用当前版本的谷歌地图，只需省略`sadr`参数：

> `saddr`: ... 如果该值留空，则将使用用户的当前位置。

[https://developers.google.com/maps/documentation/ios/urlscheme](https://developers.google.com/maps/documentation/ios/urlscheme)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-09-13T12:21:47.120

对于 iOS6 Maps App，您可以使用上面发布的相同 URL `http://maps.google.com/maps?saddr=%f,%f&daddr=%@`

但您使用的不是 Google 地图 URL，而是使用该 URL 并`maps://`生成以下 URL：`maps://saddr=%f,%f&daddr=%@.`

使用“当前位置”似乎不起作用，所以我保留了坐标。

另一个好处：它向后兼容：在 iOS5 上，它启动了谷歌地图应用程序。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-11-10T13:35:17.977

我的建议是使用[OpenInGoogleMaps-iOS](https://github.com/googlemaps/OpenInGoogleMaps-iOS)，因为这是一个最新的选择（到 2015 年 11 月），它支持可可豆荚安装，您只需点击几下即可开始使用。

安装使用：`pod "OpenInGoogleMaps"`

在头文件中要求使用：`#import "OpenInGoogleMapsController.h"`

下面的示例代码：

```
/*In case the user does NOT have google maps, then apple maps shall open*/
[OpenInGoogleMapsController sharedInstance].fallbackStrategy = kGoogleMapsFallbackAppleMaps;    

/*Set the coordinates*/
GoogleMapDefinition *definition = [[GoogleMapDefinition alloc] init];   
CLLocationCoordinate2D metsovoMuseumCoords;     //coordinates struct
metsovoMuseumCoords.latitude = 39.770598;
metsovoMuseumCoords.longitude = 21.183215;
definition.zoomLevel = 20;
definition.center = metsovoMuseumCoords;        //this will be the center of the map

/*and here we open the map*/
[[OpenInGoogleMapsController sharedInstance] openMap:definition]; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-01-11T05:37:18.433

我在另一个线程上回答了这个问题。（[当前位置不适用于 Apple Maps IOS 6](https://stackoverflow.com/questions/12539009/current-location-doesnt-work-with-apple-maps-ios-6/14272263#14272263)）。您需要先获取当前位置的坐标，然后使用它来创建地图 url。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-09-18T12:06:29.420

如果您不提供源位置，它将以当前位置为源。试试下面的代码 -

让 urlString = " [http://maps.apple.com/maps?daddr=(destinationLocation.latitude),(destinationLocation.longitude)&dirflg=d](http://maps.apple.com/maps?daddr=(destinationLocation.latitude),(destinationLocation.longitude)&dirflg=d) " }

UIApplication.shared.openURL（URL（字符串：urlString）！）

# php - 用于 url 的单个输入的 PHP 输入验证

> ID：576772
> 
> 赞同：0
> 
> 时间：2009-02-23T07:15:18.317
> 
> 标签：php, html, validation, object-tag

我有这个非常简单的脚本，它允许用户指定任何站点的 url。该脚本替换对象标记上的“数据”属性的 url，以在 HTML 页面上的对象内显示用户选择的站点。

我如何验证输入，以便用户无法在对象内从我的站点加载任何页面，因为我注意到它将显示我的代码。

编码：

```
 <?php
 $url = 'http://www.google.com';
 if (array_key_exists('_check', $_POST)) {
    $url = $_POST['url'];
 }
 //gets the title from the selected page
 $file = @ fopen(($url),"r") or die ("Can't read input stream");
 $text = fread($file,16384);
 if (preg_match('/<title>(.*?)<\/title>/is',$text,$found)) {
         $title = $found[1];
 } else {
         $title = "Untitled Document";
 }
 ?> 
```

编辑：（更多细节）这并不意味着是一个代理。我让用户决定将哪个网站加载到对象标签中（类似于 iframe）。php 唯一要读取的是输入 url 中的标题标签，因此可以将其加载到我网站的标题中。（不要担心它不会欺骗用户）虽然它可以显示任何网站的标题，但它不会以任何其他方式绕过任何过滤器。

我也知道我正在做的事情涉及的漏洞，这就是我研究验证的原因。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T07:53:45.977

正如 gahooa 所说，我认为你在这里所做的事情需要非常小心，因为你在玩火。可以安全地进行操作，但要非常谨慎地处理用户提供给您的 URL 中的数据。

对于您遇到的特定问题，我假设如果您输入文件名，例如如果有人在框中键入“index.php”，就会发生这种情况。您需要做的就是确保它们的 URL 以“http://”开头，以便 fopen 使用网络方法，而不是打开本地文件。在 fopen 行之前这样的事情应该可以解决问题：

```
if (!preg_match('/^http:\/\//', $url))
    $url = 'http://'.$url; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T09:02:55.670

parse_url：[http ://us3.php.net/parse_url](http://us3.php.net/parse_url)

您可以检查方案和主机。

如果方案是 http，则确保主机不是您的网站。我建议使用 preg_match 来抓取点之间的部分。就像在 www.google.com 或 google.com 中一样，使用 preg_match 来获取 google 一词。

如果主机是 ip，我不确定在这种情况下你想做什么。默认情况下，preg 匹配只会得到中间的 2 个数字和点（假设你尝试使用 preg_match 来获取 .com 之前的站点名称）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T07:22:26.613

**您是否知道您正在创建一个开放的 HTTP 代理，这可能是一个非常糟糕的主意？**

你甚至需要获取 URL 的内容吗？为什么不让用户的浏览器通过提供 URL 来做到这一点呢？

假设您确实需要获取 URL，请考虑针对已知的 URL“白名单”进行验证。如果您无法将其限制为已知列表，那么您将再次回到开放代理...

使用正则表达式 (preg) 确保它是一个好的 HTTP url，然后使用 CURL 扩展来执行实际请求。

*将 fopen() 系列函数与用户提供的参数混合使用会导致潜在的灾难。*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-05-24T21:54:36.477

您可以使用 PHP 过滤器。

filter_var($url, FILTER_VALIDATE_URL) 或 filter_input(INPUT_POST, 'url', FILTER_VALIDATE_URL);

[http://php.net/manual/en/function.filter-input.php](http://php.net/manual/en/function.filter-input.php)

还可以试试这个 PHP wiki 帖子引用的这些文档，这些文档与 **Yasuo Ohgaki** 的过滤器[https://wiki.php.net/rfc/add_validate_functions_to_filter?s[]=filter相关](https://wiki.php.net/rfc/add_validate_functions_to_filter?s[]=filter)

 ***   [https://www.securecoding.cert.org/confluence/display/seccode/Top+10+Secure+Coding+Practices](https://www.securecoding.cert.org/confluence/display/seccode/Top+10+Secure+Coding+Practices)
*   [https://www.owasp.org/index.php/OWASP_Secure_Coding_Practices_-_Quick_Reference_Guide](https://www.owasp.org/index.php/OWASP_Secure_Coding_Practices_-_Quick_Reference_Guide)
*   [http://cwe.mitre.org/top25/mitigations.html](http://cwe.mitre.org/top25/mitigations.html)

# math - 作为程序员，您将如何解释虚数？

> ID：576775
> 
> 赞同：18
> 
> 时间：2009-02-23T07:16:18.627
> 
> 标签：math, complex-numbers

作为一名程序员，我认为擅长数学是我的工作，但我很难理解虚数。我已经尝试过谷歌和[维基百科](http://en.wikipedia.org/wiki/Imaginary_number)但没有运气，所以我希望程序员可以向我解释，给我一个 <= 0 的平方数的例子，一些示例用法等......

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-23T07:31:48.027

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-02-23T07:30:44.270

问题：我不仅是程序员，还是数学家。解决方案：无论如何都要继续前进。

复数没有什么真正神奇的东西。他们成立背后的想法是实数有问题。如果你有一个方程 x^2 + 4，这永远不会是零，而 x^2 - 2 是零两次。所以数学家真的很生气，希望在多项式至少为 1 的情况下总是有零（想要一个“代数闭”域），并创建了一些任意数 j，使得 j = sqrt(-1)。所有的规则都从那里开始落实（尽管它们更准确地以不同的方式重新组织——具体来说，你不能正式地说“嘿，这个数字是负数的平方根”）。如果有那个数字 j，你可以得到 j 的倍数。你可以把实数加到 j 上，那么你就有了复数。

复合体的真正问题不在于所有这些，而在于您无法定义一个系统，从而可以获得小于和大于的普通规则。所以真的，你到达了你根本没有定义它的地方。它在二维空间中没有意义。所以老实说，我实际上无法回答“给我一个 <= 0 的平方数的例子”，尽管如果您将它的平方视为实数而不是复数，“j”是有意义的。

至于用途，我个人在处理分形时最常使用它们。mandelbrot 分形背后的想法是，它是一种绘制 z = z^2 + c 及其沿实虚轴散度的图形的方法。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-23T07:36:52.820

您可能还会问为什么存在负数？它们的存在是因为您想要表示某些方程的解，例如：x + 5 = 0。同样的事情适用于虚数，您想要紧凑地表示以下形式的方程的解：x^2 + 1 = 0。

这是我看到它们在实践中使用的一种方式。在 EE 中，您经常处理正弦波函数，或者可以分解为正弦波的函数。（参见例如[傅立叶级数](http://en.wikipedia.org/wiki/Fourier_series)）。

因此，您经常会看到以下形式的方程的解：

f(t) = A*cos(wt)

此外，您通常希望表示从该函数偏移某个相位的函数。90 度相移将为您提供 sin 函数。

g(t) = B*sin(wt)

您可以通过组合这两个函数（称为同相和正交分量）来获得任意相移。

h(t) = A *cos(wt) + i* B*sin(wt)

这里的关键是在线性系统中：如果 f(t) 和 g(t) 求解一个方程，h(t) 也将求解同一个方程。所以，现在我们有了方程 h(t) 的通用解。

h(t) 的好处在于它可以紧凑地写成

h(t) = Cexp(wt+theta)

使用 exp(iw) = cos(w)+i*sin(w) 的事实。

这真的没有什么特别深刻的。它只是利用数学恒等式来紧凑地表示各种方程的通用解。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T08:27:54.087

好吧，对于程序员：

```
class complex {
public:
  double real;
  double imaginary;

  complex(double a_real) : real(a_real), imaginary(0.0) { }
  complex(double a_real, double a_imaginary) : real(a_real), imaginary(a_imaginary) { }

  complex operator+(const complex &other) {
    return complex(
        real + other.real,
        imaginary + other.imaginary);
  }
  complex operator*(const complex &other) {
    return complex(
        real*other.real - imaginary*other.imaginary,
        real*other.imaginary + imaginary*other.real);
  }

  bool operator==(const complex &other) {
    return (real == other.real) && (imaginary == other.imaginary);
  }
}; 
```

基本上就是这样。复数只是实数对，为此定义了 +、* 和 == 的特殊重载。这些操作真的就是这样*定义*的。然后事实证明，这些具有这些运算的数字对与其他数学非常吻合，因此它们得到了一个特殊的名称。

它们不像“计数”中的数字，而更像是“可以用 +、-、*、... 进行操作，并且与“常规”数字混合时不会引起问题”。它们很重要，因为它们填补了实数留下的空白，就像没有平方为 -1 的数字一样。现在您有了`complex(0, 1) * complex(0, 1) == -1.0`一个有用的符号，因为在这些情况下您不必再专门处理负数。（而且，事实证明，当您使用复数时，基本上不再需要所有其他特殊情况）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-19T05:59:53.393

如果问题是“虚数存在吗？” 或“虚数是如何存在的？” 那么这不是程序员的问题。这甚至可能不是数学家的问题，而是形而上学家或数学哲学家的问题，尽管数学家可能觉得有必要证明他们在该领域的存在是正当的。从讨论数字是如何存在的开始很有用（很多解决这个问题的数学家都是柏拉图主义者，仅供参考）。有些人坚持认为虚数（就像早期的怀特黑德所做的那样）是一种实用的便利。但是，如果虚数仅仅是一种实用的便利，那么这对数学有什么意义呢？你可以' 不要仅仅将虚数解释为一种实用的工具或一对实数，而不必考虑这两对以及它们“实用”的一般后果。其他人坚持虚数的存在，认为虚数的不存在会破坏大量使用它们的物理理论（QM 在复杂的希尔伯特空间中是齐膝深的）。我相信这个问题超出了本网站的范围。

如果您的问题更具体，例如如何在软件中表达虚数，那么上面的答案（一对实数，以及它们的定义操作）就是它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-19T06:15:43.413

我不想把这个网站变成数学溢出，但是对于那些感兴趣的人：查看 Paul J. Nahin 的“一个虚构的故事：sqrt(-1) 的故事”。它以有趣和令人兴奋的方式谈论虚数的所有历史和各种应用。那本书让我在 7 年前阅读它时决定攻读数学学位（当时我正在思考艺术）。伟大的阅读！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T07:35:46.427

要点是你添加你*定义*为二次方程解的数字，比如 x ² = -1。命名该方程 i 的一个解，然后 i 的计算规则遵循该方程。

这类似于当您只知道正数时将负数定义为等式的解，例如 2 + x = 1，或者当您只知道整数时，将分数定义为等式的解，例如 2x = 1。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T07:36:45.347

停止尝试理解一个数字如何成为负数的平方根可能是最容易*的*，而只是继续假设它是。

所以（使用*i*作为 -1 的平方根）：

```
(3+5i)*(2-i)
= (3+5i)*2 + (3+5i)*(-i)
= 6 + 10i -3i - 5i * i
= 6 + (10 -3)*i - 5 * (-1)
= 6 + 7i + 5
= 11 + 7i 
```

根据数学的标准规则工作（记住第四行的 i 平方等于 -1）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-23T07:37:11.867

虚数是实数乘以虚数单位`i`。`i`定义为：

```
i == sqrt(-1) 
```

所以：

```
i * i == -1 
```

使用此定义，您可以获得负数的平方根，如下所示：

```
 sqrt(-3)
== sqrt(3 * -1)
== sqrt(3 * i * i) // Replace '-1' with 'i squared'
== sqrt(3) * i     // Square root of 'i squared' is 'i' so move it out of sqrt() 
```

而你的最终答案是实数`sqrt(3)`乘以虚数单位`i`。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-23T07:42:01.030

一个简短的回答：实数是一维的，虚数为等式添加了第二维，如果你乘以会发生一些奇怪的事情......

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-23T08:01:05.070

如果您有兴趣找到一个简单的应用程序并且您熟悉矩阵，那么使用复数将一个完全实数矩阵转换为复数空间中的三角形矩阵有时会很有用，并且它会使计算变得更容易一些.

结果当然是完全真实的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-23T08:02:13.273

到目前为止很好的答案（真的很像德文的！）

还有一点：

复数的第一个用途（尽管当时并没有这样称呼）是作为求解三阶方程的中间步骤。 [关联](http://www.clarku.edu/~djoyce/complex/cubic.html)

同样，这纯粹是一种工具，用于回答具有物理意义的*实数的实际问题。*

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-03-11T21:47:14.183

在电气工程中，电感的阻抗 Z 为 jwL，其中 w = 2*pi*f（频率）和 j (sqrt(-1)) 表示它超前 90 度，而对于电容器 Z = 1/jwc = -j/wc 是 -90deg/wc，因此它比一个简单的电阻滞后 90 度。

# python - 用 Python 编写一个 TTL 装饰器

> ID：576776
> 
> 赞同：3
> 
> 时间：2009-02-23T07:16:49.950
> 
> 标签：python, decorator, ttl

我正在尝试在 python 中编写一个 TTL 装饰器。基本上，如果函数在选定的时间内没有响应，我会给它一个异常。

[您可以在http://sebulba.wikispaces.com/recipe+thread2](http://sebulba.wikispaces.com/recipe+thread2)上找到 thead2 片段

```
from thread2 import Thread

"""  A TTL decorator. """
class Worker(Thread):
    def __init__(self, q, f, args, kvargs):
        Thread.__init__(self)

        self.q = q
        self.f = f
        self.args = args
        self.kvargs = kvargs

    def run(self,):
        try:
            res = (True, self.f(*self.args, **self.kvargs))
            self.q.put(res)
        except Exception, e:
            self.q.put((False, e))

class Referee(Thread):
    def __init__(self,q, ttl,exception_factory):
        Thread.__init__(self)

        self.exception_factory=exception_factory    
        self.q=q
        self.ttl=ttl

    def run(self):
        time.sleep(self.ttl)
        res = (False, self.exception_factory())
        self.q.put(res)

def raise_if_too_long(ttl, exception_factory=lambda :RuntimeError("Timeout")):
    def raise_if_too_long_aux(f):
        def ritl(*args,**kvargs):
            q = Queue.Queue(2)

            referee = Referee(q, ttl, exception_factory)
            worker = Worker(q,f,args,kvargs)

            worker.start()
            referee.start()

            (valid, res)= q.get(1)

            q.task_done()

            referee.terminate()
            worker.terminate()

            if valid:
                return res
            else:
                raise res

        return ritl

    return raise_if_too_long_aux 
```

但是，我得到了一些非常糟糕的结果。有时函数似乎返回正常，但装饰器在达到 TTL 并且错误出现之前不会返回。

你看到这段代码有什么问题吗？在python中是否有一种通用的方法/库来编写带有TTL的函数？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T07:33:17.867

提供的代码有点难以理解——它如何在正确的线程中正确的时间在正确的位置引发异常？

**考虑这个粗略的流程：**

使用目标函数调用的装饰器函数。返回一个函数：

2.  启动线程，调用目标函数
3.  使用 thread.join([timeout]) 加入线程
4.  如果超时，则引发异常，并忽略线程的结果。
5.  如果没有超时，则捕获线程的结果并返回。

（您需要设计一种方法来捕获线程的输出......）

有关线程超时的信息，请参见[http: //docs.python.org/library/threading.html...](http://docs.python.org/library/threading.html)

*（或者只是开始使用[erlang](http://www.erlang.org) **`:)`***

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-05-06T17:37:34.177

如果您希望在超过超时后终止函数的执行，您可能需要尝试具有该功能的代码。要使用该模块，只需要将您的函数作为参数调用`add_timeout`，并且返回的值可以运行。一旦被调用，`ready`就可以轮询对象的属性，并且可以通过该`value`属性访问返回的任何内容。代码的文档应该提供对其余可用 API 的解释。

**[代码编辑的长度]**请参阅[timeout.py](http://code.activestate.com/recipes/577045/)的源代码。

* * *

**附录：**

还有另一种看待问题的方法。您可以将函数及其参数提交给一个执行引擎，该引擎可以强制执行它可以运行多长时间的超时，而不是装饰一个函数以使其具有生存时间。我上面的原始答案是大约八年前对这个问题的解决方案。在进一步研究该主题后，我可以推荐以下模块吗？其后的模块用于测试和演示`asynchronous`模块的使用。

**异步.py**

```
#! /usr/bin/env python3
import abc as _abc
import collections as _collections
import enum as _enum
import math as _math
import multiprocessing as _multiprocessing
import operator as _operator
import queue as _queue
import signal as _signal
import sys as _sys
import time as _time

__all__ = (
    'Executor',
    'get_timeout',
    'set_timeout',
    'submit',
    'map_',
    'shutdown'
)

class _Base(metaclass=_abc.ABCMeta):
    __slots__ = (
        '__timeout',
    )

    @_abc.abstractmethod
    def __init__(self, timeout):
        self.timeout = _math.inf if timeout is None else timeout

    def get_timeout(self):
        return self.__timeout

    def set_timeout(self, value):
        if not isinstance(value, (float, int)):
            raise TypeError('value must be of type float or int')
        if value <= 0:
            raise ValueError('value must be greater than zero')
        self.__timeout = value

    timeout = property(get_timeout, set_timeout)

def _run_and_catch(fn, args, kwargs):
    # noinspection PyPep8,PyBroadException
    try:
        return False, fn(*args, **kwargs)
    except:
        return True, _sys.exc_info()[1]

def _run(fn, args, kwargs, queue):
    queue.put_nowait(_run_and_catch(fn, args, kwargs))

class _State(_enum.IntEnum):
    PENDING = _enum.auto()
    RUNNING = _enum.auto()
    CANCELLED = _enum.auto()
    FINISHED = _enum.auto()
    ERROR = _enum.auto()

def _run_and_catch_loop(iterable, *args, **kwargs):
    exception = None
    for fn in iterable:
        error, value = _run_and_catch(fn, args, kwargs)
        if error:
            exception = value
    if exception:
        raise exception

class _Future(_Base):
    __slots__ = (
        '__queue',
        '__process',
        '__start_time',
        '__callbacks',
        '__result'
    )

    def __init__(self, timeout, fn, args, kwargs):
        super().__init__(timeout)
        self.__queue = _multiprocessing.Queue(1)
        self.__process = _multiprocessing.Process(
            target=_run,
            args=(fn, args, kwargs, self.__queue),
            daemon=True
        )
        self.__start_time = _math.inf
        self.__callbacks = _collections.deque()
        self.__result = True, TimeoutError()

    @property
    def __state(self):
        pid, exitcode = self.__process.pid, self.__process.exitcode
        return (_State.PENDING if pid is None else
                _State.RUNNING if exitcode is None else
                _State.CANCELLED if exitcode == -_signal.SIGTERM else
                _State.FINISHED if exitcode == 0 else
                _State.ERROR)

    def __repr__(self):
        root = f'{type(self).__name__} at {id(self)} state={self.__state.name}'
        if self.__state < _State.CANCELLED:
            return f'<{root}>'
        error, value = self.__result
        suffix = f'{"raised" if error else "returned"} {type(value).__name__}'
        return f'<{root} {suffix}>'

    def __consume_callbacks(self):
        while self.__callbacks:
            yield self.__callbacks.popleft()

    def __invoke_callbacks(self):
        self.__process.join()
        _run_and_catch_loop(self.__consume_callbacks(), self)

    def cancel(self):
        self.__process.terminate()
        self.__invoke_callbacks()

    def __auto_cancel(self):
        elapsed_time = _time.perf_counter() - self.__start_time
        if elapsed_time > self.timeout:
            self.cancel()
        return elapsed_time

    def cancelled(self):
        self.__auto_cancel()
        return self.__state is _State.CANCELLED

    def running(self):
        self.__auto_cancel()
        return self.__state is _State.RUNNING

    def done(self):
        self.__auto_cancel()
        return self.__state > _State.RUNNING

    def __handle_result(self, error, value):
        self.__result = error, value
        self.__invoke_callbacks()

    def __ensure_termination(self):
        elapsed_time = self.__auto_cancel()
        if not self.__queue.empty():
            self.__handle_result(*self.__queue.get_nowait())
        elif self.__state < _State.CANCELLED:
            remaining_time = self.timeout - elapsed_time
            if remaining_time == _math.inf:
                remaining_time = None
            try:
                result = self.__queue.get(True, remaining_time)
            except _queue.Empty:
                self.cancel()
            else:
                self.__handle_result(*result)

    def result(self):
        self.__ensure_termination()
        error, value = self.__result
        if error:
            raise value
        return value

    def exception(self):
        self.__ensure_termination()
        error, value = self.__result
        if error:
            return value

    def add_done_callback(self, fn):
        if self.done():
            fn(self)
        else:
            self.__callbacks.append(fn)

    def _set_running_or_notify_cancel(self):
        if self.__state is _State.PENDING:
            self.__process.start()
            self.__start_time = _time.perf_counter()
        else:
            self.cancel()

class Executor(_Base):
    __slots__ = (
        '__futures',
    )

    def __init__(self, timeout=None):
        super().__init__(timeout)
        self.__futures = set()

    def submit(self, fn, *args, **kwargs):
        future = _Future(self.timeout, fn, args, kwargs)
        self.__futures.add(future)
        future.add_done_callback(self.__futures.remove)
        # noinspection PyProtectedMember
        future._set_running_or_notify_cancel()
        return future

    @staticmethod
    def __cancel_futures(iterable):
        _run_and_catch_loop(map(_operator.attrgetter('cancel'), iterable))

    def map(self, fn, *iterables):
        futures = tuple(self.submit(fn, *args) for args in zip(*iterables))

        def result_iterator():
            future_iterator = iter(futures)
            try:
                for future in future_iterator:
                    yield future.result()
            finally:
                self.__cancel_futures(future_iterator)

        return result_iterator()

    def shutdown(self):
        self.__cancel_futures(frozenset(self.__futures))

    def __enter__(self):
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        self.shutdown()
        return False

_executor = Executor()
get_timeout = _executor.get_timeout
set_timeout = _executor.set_timeout
submit = _executor.submit
map_ = _executor.map
shutdown = _executor.shutdown
del _executor 
```

**test_asynchronous.py**

```
#! /usr/bin/env python3
import _thread
import atexit
import functools
import inspect
import io
import math
import operator
import os
import sys
import time
import unittest

import asynchronous

# noinspection PyUnresolvedReferences
class TestConstructor:
    def instantiate(self, *args):
        parameters = len(inspect.signature(self.CLASS).parameters)
        return self.CLASS(*args[:parameters])

    def test_valid_timeout(self):
        instance = self.instantiate(None, print, (), {})
        self.assertEqual(instance.get_timeout(), math.inf)
        instance = self.instantiate(1, print, (), {})
        self.assertEqual(instance.get_timeout(), 1)
        float_timeout = (math.e ** (1j * math.pi) + 1).imag
        self.assertIsInstance(float_timeout, float)
        instance = self.instantiate(float_timeout, print, (), {})
        self.assertEqual(instance.get_timeout(), float_timeout)

    def test_error_timeout(self):
        self.assertRaises(TypeError, self.instantiate, '60', print, (), {})
        self.assertRaises(ValueError, self.instantiate, 0, print, (), {})
        self.assertRaises(ValueError, self.instantiate, -1, print, (), {})

# noinspection PyUnresolvedReferences
class TestTimeout(TestConstructor):
    def test_valid_property(self):
        instance = self.instantiate(None, None, None, None)
        instance.timeout = 1
        self.assertIsInstance(instance.timeout, int)
        instance.timeout = 1 / 2
        self.assertIsInstance(instance.timeout, float)
        kilo_bit = int.from_bytes(os.urandom(1 << 7), 'big')
        instance.timeout = kilo_bit
        self.assertEqual(instance.timeout, kilo_bit)

    def test_error_property(self):
        instance = self.instantiate(None, None, None, None)
        for exception, value in (
                (TypeError, 'inf'),
                (TypeError, complex(123456789, 0)),
                (ValueError, 0),
                (ValueError, 0.0),
                (ValueError, -1),
                (ValueError, -math.pi)
        ):
            with self.assertRaises(exception):
                instance.timeout = value
            self.assertEqual(instance.timeout, math.inf)

class Timer:
    __timers = {}

    @classmethod
    def start_timer(cls):
        ident, now = _thread.get_ident(), time.perf_counter()
        if now is not cls.__timers.setdefault(ident, now):
            raise KeyError(ident)

    @classmethod
    def stop_timer(cls, expected_time, error=None):
        if error is None:
            error = 1 / 4  # the default is a quarter second
        used = time.perf_counter() - cls.__timers.pop(_thread.get_ident())
        diff = used - expected_time
        return -error <= diff <= +error

# noinspection PyUnresolvedReferences
class TestTimer(Timer):
    def stop_timer(self, expected_time, error=None):
        self.assertTrue(super().stop_timer(expected_time, error))

def delay_run(delay, fn, *args, sync=True, **kwargs):
    def wrapper():
        time.sleep(delay)
        return fn(*args, **kwargs)

    if sync:
        return wrapper()
    _thread.start_new_thread(wrapper, ())

# noinspection PyUnresolvedReferences
class TestModuleOrInstance(TestTimer):
    @property
    def moi(self):
        return self.MODULE_OR_INSTANCE

    def test_valid_timeout(self):
        self.moi.set_timeout(math.inf)
        self.assertEqual(self.moi.get_timeout(), math.inf)
        self.moi.set_timeout(60)
        self.assertEqual(self.moi.get_timeout(), 60)
        self.moi.set_timeout(0.05)
        self.assertEqual(self.moi.get_timeout(), 0.05)

    def test_error_timeout(self):
        self.moi.set_timeout(math.inf)
        self.assertRaises(TypeError, self.moi.set_timeout, None)
        self.assertEqual(self.moi.get_timeout(), math.inf)
        self.assertRaises(ValueError, self.moi.set_timeout, 0)
        self.assertEqual(self.moi.get_timeout(), math.inf)
        self.assertRaises(ValueError, self.moi.set_timeout, -1)
        self.assertEqual(self.moi.get_timeout(), math.inf)

    def run_submit_check(self):
        self.start_timer()
        future = self.moi.submit(delay_run, 0.5, operator.add, 1, 2)
        self.assertRegex(repr(future), r'^<_Future at \d+ state=RUNNING>$')
        self.assertEqual(future.result(), 3)
        self.stop_timer(0.5)
        self.assertRegex(
            repr(future),
            r'^<_Future at \d+ state=FINISHED returned int>$'
        )

    def test_submit_one_second_timeout(self):
        self.moi.set_timeout(1)
        self.run_submit_check()

    def test_submit_no_timeout(self):
        self.moi.set_timeout(math.inf)
        self.run_submit_check()

    def test_submit_short_timeout(self):
        self.moi.set_timeout(0.5)
        self.start_timer()
        future = self.moi.submit(delay_run, 1, operator.add, 1, 2)
        self.assertRegex(repr(future), r'^<_Future at \d+ state=RUNNING>$')
        self.assertIsInstance(future.exception(), TimeoutError)
        self.stop_timer(0.5)
        self.assertRegex(
            repr(future),
            r'^<_Future at \d+ state=CANCELLED raised TimeoutError>$'
        )

    def run_map(self, *args):
        return getattr(self.moi, self.NAME_OF_MAP)(delay_run, *args)

    def test_valid_map(self):
        self.moi.set_timeout(1.5)
        for result in self.run_map(
                [1, 1, 1, 1],
                [operator.add] * 4,
                [0, 1, 2, 3],
                [3, 2, 1, 0]
        ):
            self.assertEqual(result, 3)

    def test_error_map(self):
        self.moi.set_timeout(1.5)
        success = 0
        with self.assertRaises(TimeoutError):
            for result in self.run_map(
                    [1, 1, 2, 1],
                    [operator.add] * 4,
                    [0, 1, 2, 3],
                    [3, 2, 1, 0]
            ):
                self.assertEqual(result, 3)
                success += 1
        self.assertEqual(success, 2)

    def run_shutdown_check(self, running, future):
        self.assertRaises(TimeoutError, future.result)
        running.remove(future)

    def run_submit_loop(self, executor):
        running = set()
        done_callback = functools.partial(self.run_shutdown_check, running)
        for _ in range(10):
            future = executor.submit(delay_run, 2, operator.add, 10, 20)
            running.add(future)
            future.add_done_callback(done_callback)
        time.sleep(0.5)
        return running

    def test_valid_shutdown(self):
        self.moi.set_timeout(1.5)
        running = self.run_submit_loop(self.moi)
        self.moi.shutdown()
        self.assertFalse(running)

    def test_error_shutdown(self):
        self.moi.set_timeout(1.5)
        running = self.run_submit_loop(self.moi)
        running.pop()
        self.assertRaises(KeyError, self.moi.shutdown)
        self.assertFalse(running)

class TestExecutorAPI(TestTimeout, TestModuleOrInstance, unittest.TestCase):
    CLASS = asynchronous.Executor
    MODULE_OR_INSTANCE = CLASS()
    NAME_OF_MAP = 'map'

    def test_valid_context_manager(self):
        with self.instantiate(1.5) as executor:
            running = self.run_submit_loop(executor)
        self.assertFalse(running)

    def test_error_context_manager(self):
        error = Exception()
        with self.assertRaises(Exception) as cm:
            with self.instantiate(1.5) as executor:
                running = self.run_submit_loop(executor)
                raise error
        self.assertIs(cm.exception, error)
        self.assertFalse(running)
        with self.assertRaises(KeyError):
            with self.instantiate(1.5) as executor:
                running = self.run_submit_loop(executor)
                running.pop()
        self.assertFalse(running)

class TestModuleAPI(TestModuleOrInstance, unittest.TestCase):
    MODULE_OR_INSTANCE = asynchronous
    NAME_OF_MAP = 'map_'

def verify_error():
    sys.stderr.seek(0, io.SEEK_SET)
    for line in sys.stderr:
        if line == 'queue.Full\n':
            break
    else:
        sys.stderr.seek(0, io.SEEK_SET)
        sys.__stderr__.write(sys.stderr.read())
        sys.__stderr__.flush()

def cause_error(obj):
    sys.stderr = io.StringIO()
    atexit.register(verify_error)
    inspect.currentframe().f_back.f_back.f_locals['queue'].put_nowait(obj)

def return_(obj):
    return obj

# noinspection PyUnusedLocal
def throw(exception, *args):
    raise exception

class TestFutureAPI(TestTimer, TestTimeout, unittest.TestCase):
    CLASS = asynchronous._Future

    def test_valid_representation(self):
        future = self.instantiate(None, time.sleep, (0.1,), {})
        self.assertRegex(repr(future), r'^<_Future at \d+ state=PENDING>$')
        future._set_running_or_notify_cancel()
        self.assertRegex(repr(future), r'^<_Future at \d+ state=RUNNING>$')
        future._set_running_or_notify_cancel()
        self.assertRegex(
            repr(future),
            r'^<_Future at \d+ state=CANCELLED raised TimeoutError>$'
        )
        future = self.instantiate(None, time.sleep, (0.1,), {})
        future._set_running_or_notify_cancel()
        time.sleep(0.5)
        self.assertRegex(
            repr(future),
            r'^<_Future at \d+ state=FINISHED raised TimeoutError>$'
        )
        self.assertIs(future.exception(), None)
        self.assertRegex(
            repr(future),
            r'^<_Future at \d+ state=FINISHED returned NoneType>$'
        )

    def test_error_representation(self):
        future = self.instantiate(0.5, cause_error, (None,), {})
        future._set_running_or_notify_cancel()
        self.assertRaises(TypeError, future.result)
        self.assertIsInstance(future.exception(), TimeoutError)
        self.assertRegex(
            repr(future),
            r'^<_Future at \d+ state=ERROR raised TimeoutError>$'
        )
        future = self.instantiate(0.5, cause_error, ((False, 'okay'),), {})
        future._set_running_or_notify_cancel()
        self.assertEqual(future.result(), 'okay')
        self.assertRegex(
            repr(future),
            r'^<_Future at \d+ state=ERROR returned str>$'
        )

    def test_cancel(self):
        future = self.instantiate(None, time.sleep, (0.1,), {})
        self.assertRaises(AttributeError, future.cancel)
        future._set_running_or_notify_cancel()
        future.cancel()
        self.assertTrue(future.cancelled())
        future = self.instantiate(None, time.sleep, (0.1,), {})
        checker = set()
        future.add_done_callback(checker.add)
        future._set_running_or_notify_cancel()
        future.cancel()
        future.cancel()
        self.assertIs(checker.pop(), future)
        self.assertFalse(checker)

    def test_cancelled(self):
        future = self.instantiate(None, time.sleep, (0.1,), {})
        self.assertFalse(future.cancelled())
        future._set_running_or_notify_cancel()
        self.assertFalse(future.cancelled())
        self.assertIs(future.result(), None)
        self.assertFalse(future.cancelled())
        future = self.instantiate(None, time.sleep, (0.1,), {})
        future._set_running_or_notify_cancel()
        future.cancel()
        self.assertTrue(future.cancelled())
        future = self.instantiate(0.1, time.sleep, (1,), {})
        future._set_running_or_notify_cancel()
        time.sleep(0.5)
        self.assertTrue(future.cancelled())

    def test_running(self):
        future = self.instantiate(None, time.sleep, (0.1,), {})
        self.assertFalse(future.running())
        future._set_running_or_notify_cancel()
        self.assertTrue(future.running())
        self.assertIs(future.result(), None)
        self.assertFalse(future.running())
        future = self.instantiate(None, time.sleep, (0.1,), {})
        future._set_running_or_notify_cancel()
        future.cancel()
        self.assertFalse(future.running())
        future = self.instantiate(0.1, time.sleep, (1,), {})
        future._set_running_or_notify_cancel()
        time.sleep(0.5)
        self.assertFalse(future.running())

    def test_done(self):
        future = self.instantiate(None, time.sleep, (0.1,), {})
        self.assertFalse(future.done())
        future._set_running_or_notify_cancel()
        self.assertFalse(future.done())
        self.assertIs(future.result(), None)
        self.assertTrue(future.done())
        future = self.instantiate(None, time.sleep, (None,), {})
        future._set_running_or_notify_cancel()
        self.assertIsInstance(future.exception(), TypeError)
        self.assertTrue(future.done())

    def test_result_immediate(self):
        data = os.urandom(1 << 20)
        future = self.instantiate(None, return_, (data,), {})
        future._set_running_or_notify_cancel()
        self.assertEqual(future.result(), data)
        test_exception = Exception('test')
        future = self.instantiate(None, throw, (test_exception,), {})
        future._set_running_or_notify_cancel()
        with self.assertRaises(Exception) as cm:
            future.result()
        self.assertIsInstance(cm.exception, type(test_exception))
        self.assertEqual(cm.exception.args, test_exception.args)

    def test_result_delay(self):
        future = self.instantiate(None, delay_run, (0, operator.add, 1, 2), {})
        self.start_timer()
        future._set_running_or_notify_cancel()
        self.assertEqual(future.result(), 3)
        self.stop_timer(0.1)
        future = self.instantiate(None, delay_run, (1, operator.add, 2, 3), {})
        self.start_timer()
        future._set_running_or_notify_cancel()
        self.assertEqual(future.result(), 5)
        self.stop_timer(1)
        future = self.instantiate(0.5, delay_run, (0, operator.add, 1, 2), {})
        self.start_timer()
        future._set_running_or_notify_cancel()
        self.assertEqual(future.result(), 3)
        self.stop_timer(0.1)
        future = self.instantiate(0.5, delay_run, (1, operator.add, 2, 3), {})
        self.start_timer()
        future._set_running_or_notify_cancel()
        self.assertRaises(TimeoutError, future.result)
        self.stop_timer(0.5)

    def test_result_before_running(self):
        future = self.instantiate(0.1, delay_run, (0, operator.add, 1, 2), {})
        delay_run(0.5, future._set_running_or_notify_cancel, sync=False)
        self.start_timer()
        self.assertEqual(future.result(), 3)
        self.stop_timer(0.5)

    def test_exception_immediate(self):
        data = os.urandom(1 << 20)
        future = self.instantiate(None, return_, (data,), {})
        future._set_running_or_notify_cancel()
        self.assertIs(future.exception(), None)
        test_exception = Exception('test')
        future = self.instantiate(None, throw, (test_exception,), {})
        future._set_running_or_notify_cancel()
        self.assertIsInstance(future.exception(), type(test_exception))
        self.assertEqual(future.exception().args, test_exception.args)

    def test_exception_delay(self):
        future = self.instantiate(None, delay_run, (0, operator.add, 1, 2), {})
        self.start_timer()
        future._set_running_or_notify_cancel()
        self.assertIs(future.exception(), None)
        self.stop_timer(0.1)
        future = self.instantiate(None, delay_run, (1, operator.add, 2, 3), {})
        self.start_timer()
        future._set_running_or_notify_cancel()
        self.assertIs(future.exception(), None)
        self.stop_timer(1)
        future = self.instantiate(0.5, delay_run, (0, operator.add, 1, 2), {})
        self.start_timer()
        future._set_running_or_notify_cancel()
        self.assertIs(future.exception(), None)
        self.stop_timer(0.1)
        future = self.instantiate(0.5, delay_run, (1, operator.add, 2, 3), {})
        self.start_timer()
        future._set_running_or_notify_cancel()
        self.assertIsInstance(future.exception(), TimeoutError)
        self.assertFalse(future.exception().args)
        self.stop_timer(0.5)

    def test_exception_before_running(self):
        future = self.instantiate(0.1, delay_run, (0, operator.add, 1, 2), {})
        delay_run(0.5, future._set_running_or_notify_cancel, sync=False)
        self.start_timer()
        self.assertIs(future.exception(), None)
        self.stop_timer(0.5)

    def test_valid_add_done_callback(self):
        future = self.instantiate(None, time.sleep, (0,), {})
        requires_callback = {future}
        future.add_done_callback(requires_callback.remove)
        self.assertIn(future, requires_callback)
        future._set_running_or_notify_cancel()
        self.assertIs(future.exception(), None)
        self.assertFalse(requires_callback)
        requires_callback.add(future)
        future.add_done_callback(requires_callback.remove)
        self.assertFalse(requires_callback)

    def test_error_add_done_callback(self):
        future = self.instantiate(None, time.sleep, (0,), {})
        requires_callback = [{future} for _ in range(10)]
        callbacks = [s.remove for s in requires_callback]
        error = Exception()
        callbacks.insert(5, functools.partial(throw, error))
        for fn in callbacks:
            future.add_done_callback(fn)
        future._set_running_or_notify_cancel()
        with self.assertRaises(Exception) as cm:
            future.exception()
        self.assertIs(cm.exception, error)
        self.assertFalse(any(requires_callback))

    def test_set_running_or_notify_cancel(self):
        future = self.instantiate(None, time.sleep, (0.1,), {})
        self.assertFalse(future.running() or future.done())
        future._set_running_or_notify_cancel()
        self.assertTrue(future.running())
        future._set_running_or_notify_cancel()
        self.assertTrue(future.cancelled())

if __name__ == '__main__':
    unittest.main() 
```

# shell - 我想抓取 iTunes 顶部 X RSS 提要并插入 dB

> ID：576780
> 
> 赞同：0
> 
> 时间：2009-02-23T07:19:33.750
> 
> 标签：shell, rss, scripting, screen-scraping, itunes

最好我想用一些 bash shell 脚本来做，也许是一些 PHP 或 PERL 和一个 MySQL 数据库。想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-10T03:07:18.473

据我所知，它没有得到积极维护，但 Scriptella 可能会有所帮助。非常简单的 xml 脚本，在 Java 上运行。

[如何将 RSS 吸入数据库的示例](http://snippets.dzone.com/posts/show/3534)：

```
<!DOCTYPE etl SYSTEM "http://scriptella.javaforge.com/dtd/etl.dtd">
<etl>
    <connection id="in" driver="xpath" url="http://snippets.dzone.com/rss"/>
    <connection id="out" driver="text" url="rss.txt"/>
    <connection id="db" driver="hsqldb" url="jdbc:hsqldb:db/rss" user="sa" classpath="hsqldb.jar"/>
    <script connection-id="db">
       CREATE TABLE Rss (
           ID Integer,
           Title VARCHAR(255),
           Description VARCHAR(255),   
           Link VARCHAR(255)

       )
    </script>
    <query connection-id="in">
        /rss/channel/item
        <script connection-id="out">
            Title: $title
            Description: [
            ${description.substring(0, 20)}...
            ]
            Link: $link
            ----------------------------------
        </script>
        <script connection-id="db">
            INSERT INTO Rss (ID, Title, Description, Link) 
            VALUES (?rownum, ?title, ?description, ?link);
        </script>
    </query>
</etl> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T09:25:39.877

这是一个使用 Perl 的解决方案，在（当然！）一堆模块的帮助下。

它使用 SQLite，因此您可以轻松运行它（（简单的）数据库的定义在脚本的末尾）。它还使用 Perl 哈希和简单的 SQL 语句，而不是适当的对象和 ORM 层。我发现直接解析 XML 比使用 RSS 模块更容易（我试过 XML::Feed），因为您需要访问特定标签（名称、预览...）。

您可以使用它作为基础来添加更多功能、数据库中的更多字段、流派表......但至少这样你就有了一个可以扩展的基础（也许你可以将结果发布为开放-资源）。

```
#!/usr/bin/perl

use strict;
use warnings;

use XML::Twig;                 # to parse the RSS
use DBIx::Simple;              # DB interaction made easy
use Getopt::Std;               # always need options for a script
use PerlIO::gzip;              # itunes sends a gzip-ed file
use LWP::Simple 'getstore';    # to get the RSS

my %opt;
getopts( 'vc:', \%opt);

# could also be an option, but I guess it won't change that much
my @URLs= ( 
            'http://ax.itunes.apple.com/WebObjects/MZStoreServices.woa/ws/RSS/topsongs/limit=10/xml',
          );

# during debug, it's nice to use a cache of the feed instead of hitting hit every single run
if( $opt{c}) { @URLs= ($opt{c}); }

# I like using SQLite when developping,
# replace with MySQL connect parameters if needed (see DBD::MySQL for the exact syntax)
my @connect= ("dbi:SQLite:dbname=itunes.db","","", { RaiseError => 1, AutoCommit => 0 }) ;

my $NS_PREFIX='im';

# a global, could be passed around, but would make the code a bit more verbose
my $db = DBIx::Simple->connect(@connect) or die "cannot connect to DB: $DBI::errstr";

foreach my $url (@URLs)
  { add_feed( $url); }

$db->disconnect;

warn "done\n" if( $opt{v});

sub add_feed 
  { my( $url)= @_;

    # itunes sends gziped RSS, so we need to unzip it
    my $tempfile= "$0.rss.gz"; # very crude, should use File::Temp instead 
    getstore($url, $tempfile);
    open( my $in_feed, '<:gzip', $tempfile) or die " cannot open tempfile: $!";

    XML::Twig->new( twig_handlers => { 'feed/title' => sub { warn "adding feed ", $_->text if $opt{v}; },
                                          entry       => \&entry,
                                       },
                      map_xmlns => { 'http://phobos.apple.com/rss' => $NS_PREFIX },
                  )
             ->parse( $in_feed);

    close $in_feed;
  }

sub entry
  { my( $t, $entry)= @_;

    # get the data
    my %song= map { $_ => $entry->field( "$NS_PREFIX:$_") } qw( name artist price);
    if( my $preview= $entry->first_child( 'link[@title="Preview"]') )
      { $song{preview}= $preview->att( 'href'); }

    # $db->begin_work;

    # store it
    if( ($db->query( 'SELECT count(*) FROM song WHERE name=?', $song{name})->flat)[0])
      { warn "  skipping $song{name}, already stored\n" if $opt{v};
      }
    else
      {
        warn "  adding $song{name}\n" if $opt{v};
        if( my $artist_id= ($db->query( 'SELECT id from ARTIST where name=?', $song{artist})->flat)[0])
          { warn "  existing artist $song{name} ($artist_id)\n" if $opt{v};
            $song{artist}= $artist_id; 
          }
        else
          { warn "  creating new artist $song{artist}\n" if $opt{v};

            $db->query( 'INSERT INTO artist (name) VALUES (??)', $song{artist});

            # should be $db->last_insert_id but that's not available in DBD::SQLite at the moment
            $song{artist}= $db->func('last_insert_rowid');
          }

        $db->query( 'INSERT INTO song ( name, artist, price, preview) VALUES (??)', 
                              @song{qw( name  artist  price  preview)});
        $db->commit;
      }
    $t->purge; # keeps memory usage lower, probably not needed for small RSS files
  }

__END__
=head1 NAME

  itunes2db - loads itunes RSS feeds to a DB

=head1 OPTIONS

  -c <file>  uses a cache instead of the list of URLs
  -v         verbose

=head1 DB schema

  create table song ( id INT PRIMARY KEY, name TEXT, artist INT, price TEXT, preview TEXT);
  create table artist (id INT PRIMARY KEY, name TEXT); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T07:44:42.847

好吧，我不太确定你在寻找什么样的答案，但我认为你不需要编写任何类型的 shell 脚本。Bother PHP 和 Perl 完全能够下载 RSS 提要并将数据插入 MySQL。将 PHP 或 Perl 脚本设置为每隔 X 小时/天/使用 cronjob 运行一次，这样就完成了。

没有太多要告诉你的，你的问题是多么模糊。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T08:56:17.153

我正在抓取 Stack Overflow 的提要，以使用 PHP 的[DOMDocument](http://us2.php.net/domdocument)执行一些额外的过滤，然后使用 DOM 方法来访问我想要的内容。我建议调查一下。

# php - 如何让我的 PHP 应用程序重新使用同一窗口播放音乐？

> ID：576783
> 
> 赞同：0
> 
> 时间：2009-02-23T07:21:11.717
> 
> 标签：php, html, xml

下面是我的播放器的代码，它将`playlist.xml`根据用户选择的歌曲自动生成一个文件。我将此文件保存`player.php`在我的根文件夹中，并以我给出的形式：

```
<form method="post" action="/player.php" target="_blank"> 
```

所以这个播放器正在根据选择的内容打开和播放歌曲。

但问题是当用户再次选择不同的歌曲，而之前选择的歌曲正在新窗口的播放器中播放时，选择的新歌曲将在另一个窗口中打开，即现在打开了两个播放器窗口。

实际上，我希望第二个选定的歌曲将在已经打开的同一个窗口中播放。您可以通过播放歌曲来查看我的网站中发生的事情：http: [//www.musicking.in/hindi-songs/69.html](http://www.musicking.in/hindi-songs/69.html)

```
<html>
<body>
<?php
  if(isset($_POST["song"])&& $_POST['song'] != "") {
    $song = $_POST["song"];
  }
  else { $song=array(); }

  for ($i="0"; $i<count($song); $i++) { 
    //echo  $song[$i];
  }

  //start of new php codep
  // create doctype

  //$array = array(
  //  'song.mp3','song.mp3','song.mp3',
  //);

  $dom = new DOMDocument("1.0");

  // display document in browser as plain text 
  // for readability purposes
  header("Content-Type: text/plain");
  // create root element
  $root = $dom->createElement("xml");
  $dom->appendChild($root);
  $i = "1";
  foreach ($song as $counter) {
    // create child element
    $song = $dom->createElement("track");
    $root->appendChild($song);

    $song1 = $dom->createElement("path");
    $song->appendChild($song1);
    // create text node
    $text = $dom->createTextNode($counter);
    $song1->appendChild($text); 

    $song1 = $dom->createElement("title");
    $song->appendChild($song1);

    $text = $dom->createTextNode("song ".$i);
    $song1->appendChild($text); 
    $i++;
  }

  // save and display tree
  //echo $dom->saveXML();
  $dom->save("playlist.xml");
?>

<script type="text/javascript" src="swfobject.js"></script>

<div id="flashPlayer">
  This text will be replaced by the flash music player.
</div>

<script type="text/javascript">
   var so = new SWFObject("playerMultipleList.swf", "mymovie", "295", "200", "7", "#FFFFFF");  
   so.addVariable("autoPlay","yes")
   so.addVariable("playlistPath","playlist.xml")
   so.write("flashPlayer");
</script>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T15:01:28.707

据我所知，您只能使用 javascript 来执行此操作……并且有一个小技巧可以检测弹出窗口是否已打开以及是否确实向其发送了 javascript 请求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-24T20:56:40.847

我知道这可能不是您正在寻找的“FIX”，但请尝试在您的闪存变量中指定目标。

我认为指定 _self 可能会有所帮助

只是一个想法

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T06:27:55.697

试穿这个尺寸；）

```
<form method="post" action="/player.php" target="popup-player" target="playerTargetWin" onSubmit="window.open('about:blank','playerTargetWin','width=300,height=300')">
    <p>
        <label for="textfield">Type something in the box:</label>
        <input type="text" name="textfield" id="textfield" />
    </p>
    <p>
        <input type="submit" value="Submit" />
    </p>
</form> 
```

# asp.net-mvc - ASP MVC 服务器要求 - Server 2008 非常理想吗？

> ID：576792
> 
> 赞同：0
> 
> 时间：2009-02-23T07:25:18.557
> 
> 标签：asp.net-mvc, iis, windows-server-2008

我在一些地方读到 MVC 需要 Windows Server 2008 才能获得全面支持。可以在 Vista Ultimate 开发机器上实现同样的目标，还是会缺少一些东西？

如果您使用过 MVC，您是否在为 Windows Server 2008 找到相对便宜的托管服务时遇到了困难？虽然托管对我来说并不是一个大问题（我知道我会找到一些），但需要一台带有 2008 Server 的开发机器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T07:43:02.057

ASP.NET MVC 与 Server 2008 配合得很好，但这不是必需的。不使用 Server 2008 (IIS 7) 的主要症结在于您将需要某种形式的 url 重写器，否则 Server 2003 (IIS 6) 将不知道您正在尝试执行 asp.net 应用程序。

您可以做的是将 mod_rewrite [isapirewrite](http://www.isapirewrite.com/)与 IIS 6 一起使用，一切顺利。

Steve Sanderson[在这里](http://blog.codeville.net/2008/07/04/options-for-deploying-aspnet-mvc-to-iis-6/)写了一篇很好的文章，详细介绍了如何实现几个选项，mod-rewrite 是“最干净”的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T11:19:09.087

你认为什么是“全力支持”？

Phil Haack 有一篇关于在 IIS6 上启动和运行 MVC 的非常好的帖子——这里还有[很多](https://stackoverflow.com/questions/570147/is-it-absolutely-necessary-to-manually-configure-iis6-to-use-asp-net-mvc)关于在非 IIS7/win2k8 设置上运行 MVC的其他[问题](https://stackoverflow.com/questions/364637/asp-net-mvc-on-godaddy-not-working-not-primary-domain-deployment)——你当然不需要使用类似的东西ISAPI-rewrite 或其他东西 - 在您的设置中拥有两个路由引擎似乎相当过分 - 如果您正在寻找“相对便宜的主机”，他们是否会安装/允许安装 ISAPI-Rewrite 之类的东西并且可用?

至于开发，我在 XP Professional 和 Vista Home Premium 上运行开发人员环境都没有问题（如果您自己从 Windows 组件中添加这些位，则它与 IIS7 一起提供）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T07:39:35.730

MVC 位“需要”在集成模式下运行的 IIS7，而不是 Windows 2008。由于 IIS7 存在于 Vista 上，只要配置正确，您就可以使用它了。

（我知道我的主机，DiscountASP.NET（显然在这里插入引用代码）有 IIS7 和 MVC 位都准备好了）

# ruby-on-rails - 如何在 rake 任务中使用“gets”？

> ID：576799
> 
> 赞同：82
> 
> 时间：2009-02-23T07:30:54.067
> 
> 标签：ruby-on-rails, ruby, rake

每当我尝试在 rake 任务中使用函数时，我都会收到错误消息。有没有办法让它工作？

错误说，“没有这样的文件或目录 -（rake 任务名称）”

* * *

## 回答 #1

> 赞同：163
> 
> 时间：2009-02-23T14:46:59.510

问题是[`Kernel#gets`](http://ruby-doc.org/core-2.0/Kernel.html#method-i-gets)（如果您只是单独使用，这就是您所调用`gets`的）假设您正在从一个由传递给 Rake 的参数命名的文件中提取。这意味着`gets`尝试返回一个名为 [rake-task-here] 的文件的内容，该文件几乎可以肯定不存在。

试试[`STDIN.gets`](http://ruby-doc.org/core-2.0/IO.html#method-i-gets)。

* * *

## 回答 #2

> 赞同：-4
> 
> 时间：2009-02-23T09:58:46.723

我认为您不应该在 rake 任务中使用gets，如果您需要从命令行获取输入，您可能应该将其作为参数传递，但是如果您发布一些不起作用的代码，那么我确定你会得到更好的答案。

# oracle - 我们可以在 PL/SQL 中使用线程吗？

> ID：576802
> 
> 赞同：24
> 
> 时间：2009-02-23T07:35:08.657
> 
> 标签：oracle, asynchronous, plsql

PL/SQL 中有异步调用的特性吗？假设我在一段代码中想多次调用一个过程，并且不关心该过程何时返回以及返回什么？

```
BEGIN
  myProc(1,100);
  myProc(101,200);
  myProc(201,300);
  ...
  ...

END; 
```

在上述情况下，我不希望我的代码在执行之前等待 myProc(1,100) 完成处理 (101,200)
谢谢。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-23T14:25:21.090

+1 DBMS_SCHEDULER 和 DBMS_JOB 方法，但也要考虑您是否应该使用不同的方法。

如果您有一个以逐行方式执行的过程并且您发现它很慢，那么答案可能不是同时多次运行该过程，而是确保使用基于集合的方法。在极端情况下，您甚至可以使用并行查询和并行 DML 来减少进程的挂钟时间。

我提到这一点只是因为这是一个非常常见的故障。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-23T09:40:00.497

像这样在 DBMS_JOB 中提交它：

```
declare
  ln_dummy number;
begin
  DBMS_JOB.SUBMIT(ln_dummy, 'begin myProc(1,100); end;');
  DBMS_JOB.SUBMIT(ln_dummy, 'begin myProc(101,200); end;');
  DBMS_JOB.SUBMIT(ln_dummy, 'begin myProc(201,300); end;');
  COMMIT;
end; 
```

您需要将 job_queue_processes 参数设置为 >0 以生成线程来处理作业。您可以通过检查视图 user_jobs 来查询作业。

请注意，这适用于 Oracle 9i，不确定 10g 有什么支持。[在此处](http://download.oracle.com/docs/cd/B10501_01/appdev.920/a96612/d_job.htm)查看更多信息。

编辑：添加错过的提交

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-23T07:45:27.557

您可能需要查看 DBMS_SCHEDULER。

**为完整性编辑：**

DMBS_SCHEDULER 在 Oracle 10g 上可用。对于在此之前的版本，DBMS_JOB 执行的工作大致相同。

有关详细信息，请参阅：http: [//download.oracle.com/docs/cd/B12037_01/server.101/b10739/jobtosched.htm](http://download.oracle.com/docs/cd/B12037_01/server.101/b10739/jobtosched.htm)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-01-09T11:34:19.640

对于 PL/SQL 并行处理，您有以下选项：

*   [DBMS_SCHEDULER（较新）](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_sched.htm)
*   [DBMS_JOB（旧）](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_job.htm)
*   [并行查询](http://www.orafaq.com/wiki/Parallel_Query_FAQ)

这些将让您在 PL/SQL 中“模拟”分叉和线程。当然，使用这些，您可能会意识到需要在并行执行的程序之间进行通信。为此，请查看：

*   [高级排队](http://www.thisisahmed.com/tia/database/introaq.html)
*   [DBMS_ALERT](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_alert.htm)
*   [DBMS_PIPE](http://www.oracle-base.com/articles/misc/dbms_pipe.php)

我个人使用 DBMS_Scheduler 实现了一个并行处理系统，并使用 DBMS_Pipe 在“线程”之间进行通信。我对两者的结合感到非常满意，并且我的主要目标（通过特定的重量级程序减少主要处理时间）实现了！

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-11-03T16:36:49.390

从 11g 开始，您确实有另一个选择。Oracle 引入了一个包，它的功能与您想做的类似，名为 DBMS_PARALLEL_EXECUTE

根据他们的说法，“DBMS_PARALLEL_EXECUTE 包使用户能够以增量方式并行更新表数据”。关于如何使用它的一个相当好的总结是[here](http://www.oracle-base.com/articles/11g/dbms_parallel_execute_11gR2.php)

基本上，您定义了 Oracle 应该用来将您的工作分成几部分的方式（在您的情况下，您似乎传递了一些关键值），然后它将单独启动每个部分。为了使用它，肯定需要一些计划和一些额外的编码，但无论如何你都不应该做任何事情。

使用诸如此类的认可方法的优势在于，Oracle 甚至提供了可用于监视每个独立线程的数据库视图。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-23T16:01:11.080

此处显示了执行并行（多线程）PL/SQL 的另一种方法：

[http://www.williamrobertson.net/documents/parallel-plsql-launcher.html](http://www.williamrobertson.net/documents/parallel-plsql-launcher.html)

使用 dbms_job 或 dbms_schedular 的缺点是您不知道您的任务何时完成。我读到你不打扰，但也许你将来会改变主意。

**编辑：**

这篇文章[http://www.devx.com/dbzone/10MinuteSolution/20902/0/page/1](http://www.devx.com/dbzone/10MinuteSolution/20902/0/page/1)描述了另一种方式。它使用`dbms_job`和`dbms_alert`。警报用于发出作业已完成的信号（回调信号）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-23T15:50:58.967

这里解释了将数据卸载到平面文件的不同方法。其中一种方法展示了如何使用 PL/SQL 进行并行执行以加快处理速度。

[http://www.oracle-developer.net/display.php?id=425](http://www.oracle-developer.net/display.php?id=425)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-09-13T22:42:16.693

askTom 在此处列出的并行流水线方法提供了一种更复杂的方法，但与 DBMS 作业技术不同，您实际上会暂停直到工作完成。也就是说，您*确实*要求使用“异步”技术，而 DBMS_JOB 非常适合。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-07-03T10:01:32.893

您是否考虑过使用 Oracle 高级队列？

# c# - linq 到实体生成的 sql

> ID：576803
> 
> 赞同：6
> 
> 时间：2009-02-23T07:35:29.767
> 
> 标签：c#, sql, linq, linq-to-entities, sql-like

我对 ado.net 实体框架中的实体的 linq 有一些问题。基本上我正在做的是这样的：

```
var results = (from c in companies
    where c.Name.StartsWith(letter)
    select c); 
```

这会被翻译成 SQL，如下所示：

```
WHERE (CAST(CHARINDEX(@p, [Extent1].[Name]) AS int)) = 1 
```

这很好，但我的表有数百万条记录，所以运行速度非常慢。我需要它来生成是这样的：

```
WHERE Name LIKE @p + '%' 
```

我搜索了高低，找不到任何解决方案，除了使用存储过程或使用实体 sql ...

有没有办法通过linq做到这一点？可能通过某种方式将 linq 扩展到实体 linq 提供程序，或者以某种方式拦截命令树或生成的查询？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-24T14:59:16.460

我不是 SQL 专家，但猜测这两种语法：

WHERE (CAST(CHARINDEX(@p, [Extent1].[Name]) AS int)) = 1

和

WHERE Name LIKE @p + '%'

将导致表扫描或理想情况下的索引扫描。最重要的是，他们将执行相同的操作。我通过查看下面的执行计划验证了这一点。最重要的是，您需要重新考虑您的数据库架构或您执行搜索的方式。这不是 LINQ 问题。

一个可能需要改进的领域：确保您已为正在搜索的列编制索引。

[替代文字 http://download.binaryocean.com/plan1.gif](http://download.binaryocean.com/plan1.gif)

[替代文字 http://download.binaryocean.com/plan2.gif](http://download.binaryocean.com/plan2.gif)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T07:46:22.920

哇，这真是一种奇怪的做法！请注意，LINQ-to-SQL（在这种情况下）使用`LIKE @p0 + '%'`......非常奇怪。

您使用的是哪个 EF 提供程序（数据库）？SQL 服务器？

正如你所说，存储过程将完成这项工作，但你不应该*这样*做......非常非常奇怪......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T09:37:20.437

这是 Linq to Entities 的一个[已知问题](http://www.thedatafarm.com/blog/CommentView,guid,3f476e16-90b5-4e49-bb46-be8042f7ef79.aspx)。与 LIKE 不同，显然这个结构不使用索引。

我们在使用 Substring（转换为 SUBSTRING）方面取得了一些成功。执行计划类似，但在我们的例子中查询执行得更快。

这是另一个“我确定它将在 EF 2 中修复”... :-(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-25T22:03:31.097

我尝试改用这种语法

```
Name.Substring(0, 1) == "E" 
```

生成此 SQL

```
WHERE N'E' = (SUBSTRING([Name], 0 + 1, 1)) 
```

也许这更有效？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-25T00:08:44.300

“字母”是字符吗？如果你把它变成一个字符串，会发生什么？

```
var results = (from c in companies
    where c.Name.StartsWith(letter.ToString())
    select c); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-07-24T09:04:04.917

您可以很容易地在 Link to Entity 中使用真实的like

以下是使其工作所需的：

添加

```
 <Function Name="String_Like" ReturnType="Edm.Boolean">
      <Parameter Name="searchingIn" Type="Edm.String" />
      <Parameter Name="lookingFor" Type="Edm.String" />
      <DefiningExpression>
        searchingIn LIKE lookingFor
      </DefiningExpression>
    </Function> 
```

到此标签中的 EDMX：

> edmx:Edmx/edmx:Runtime/edmx:ConceptualModels/Schema

还要记住`<schema namespace="" />`属性中的命名空间

然后在上面的命名空间中添加一个扩展类：

```
public static class Extensions
{
    [EdmFunction("DocTrails3.Net.Database.Models", "String_Like")]
    public static Boolean Like(this String searchingIn, String lookingFor)
    {
        throw new Exception("Not implemented");
    }
} 
```

此扩展方法现在将映射到 EDMX 函数。

更多信息在这里：http: [//jendaperl.blogspot.be/2011/02/like-in-linq-to-entities.html](http://jendaperl.blogspot.be/2011/02/like-in-linq-to-entities.html)

# sql - 如何仅使用 SQL 减去 mySQL 表中的所有价格？

> ID：576809
> 
> 赞同：1
> 
> 时间：2009-02-23T07:38:30.087
> 
> 标签：sql, mysql

我正在玩以下内容，但它还没有。

```
ALTER TABLE `product_price` 更改 `price` = `price` - 20;

```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-23T07:39:23.733

你要找的是这个：

```
UPDATE product_price SET price = price - 20; 
```

因此，如果您的数据如下所示：

```
| id | price         |
|----|---------------|
| 1  | 25.20         |
| 2  | 26.50         |
| 3  | 27.00         |
| 4  | 24.25         | 
```

它会变成这样：

```
| id | price         |
|----|---------------|
| 1  | 5.20          |
| 2  | 6.50          |
| 3  | 7.00          |
| 4  | 4.25          | 
```

正如 tehvan 在您的评论中指出的那样，当您想要更改表的*结构时使用*[ALTER](http://dev.mysql.com/doc/refman/5.1/en/alter-table.html)。从文档：

 *> ALTER TABLE 使您能够更改现有表的结构。例如，您可以添加或删除列、创建或销毁索引、更改现有列的类型或重命名列或表本身。您还可以更改表格的注释和表格的类型。

如果您想以任何方式更新信息，请使用[UPDATE](http://dev.mysql.com/doc/refman/5.0/en/update.html)语句。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T10:18:44.413

正如 Paolo Bergantino 所提到的，您试图更改表的*结构*而不是其中包含的*数据*。SQL 由不同的部分组成，每个部分负责不同的事情。为了定义您的数据结构（表、视图等），您使用 DDL（数据定义语言）。另一方面，为了操作数据，您使用 DML（数据操作语言）。

[该站点](http://www.orafaq.com/faq/what_are_the_difference_between_ddl_dml_and_dcl_commands)显示了 SQL 的不同部分以及示例。

# algorithm - 大 O 分析算法

> ID：576810
> 
> 赞同：7
> 
> 时间：2009-02-23T07:39:00.473
> 
> 标签：algorithm, complexity-theory, time-complexity, space-efficiency

你们发现所有算法在这两个方面都有惊人的（艰难的，奇怪的）复杂性分析 - 产生的 O 表示法和分析方式的唯一性？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-23T08:14:46.020

我有（相当）几个例子：

*   [union-find](http://en.wikipedia.org/wiki/Disjoint-set_data_structure)数据结构，它支持（摊销）逆阿克曼时间的操作。它特别好，因为数据结构非常容易编码。
*   [展开树](http://en.wikipedia.org/wiki/Splay_tree)，它们是自平衡二叉树（也就是说，除了 BST 之外没有存储额外的信息——没有红/黑信息。 [摊销分析](http://en.wikipedia.org/wiki/Amortized_analysis)本质上是为了证明展开树的界限而发明的；展开树以*摊销*的对数时间运行, 但最坏情况下的线性时间。证明很酷。
*   [斐波那契堆](http://en.wikipedia.org/wiki/Fibonacci_heap)，它在摊销的常数时间内执行大部分优先级队列操作，从而改善了[Dijkstra 算法](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)的运行时间和其他问题。与展开树一样，也有巧妙的“潜在功能”证明。
*   Bernard Chazelle 的算法，用于以线性时间逆阿克曼时间计算最小生成树。该算法使用[软堆](http://en.wikipedia.org/wiki/Soft_heap)，这是传统[优先级队列](http://en.wikipedia.org/wiki/Priority_queue)的一种变体，但可能会发生一些“损坏”并且可能无法正确回答查询。
*   [虽然关于 MST 的主题：Petti和 Ramachandran 给出了](http://www.eecs.umich.edu/~pettie/papers/jacm-optmsf.pdf)一个最优算法，但我们不知道运行时间！
*   许多随机算法都有感兴趣的分析。我只提一个例子：Delaunay 三角剖分可以在预期的 O(n log n) 时间内通过[递增地添加点](http://en.wikipedia.org/wiki/Delaunay_triangulation#Incremental)来计算；分析显然是错综复杂的，虽然我还没有看到它。
*   使用“位技巧”的算法可以很简洁，例如[在 O(n log log n) 时间（和线性空间）中排序](http://www.sice.umkc.edu/~hanyij/research/isortlln.ps)——没错，它通过使用不仅仅是比较来打破 O(n log n) 障碍。
*   [缓存遗忘算法](http://en.wikipedia.org/wiki/Cache-oblivious_algorithm)通常有有趣的分析。例如，[缓存忽略优先级队列（参见第 3 页）使用大小为 n、n](http://courses.csail.mit.edu/6.851/spring07/scribe/lec20.pdf) ^(2/3)、n ^(4/9)等的 log log n 级别。
*   数组上的（静态）范围最小查询很整洁。[标准证明](http://www.ics.uci.edu/~eppstein/261/BenFar-LCA-00.pdf)测试您在减少方面的限制：范围最小查询被减少到树中的最不共同祖先，这反过来又被减少到特定*类型*数组中的最小范围查询。最后一步也使用了一个可爱的技巧。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T07:43:32.867

[阿克曼函数](http://en.wikipedia.org/wiki/Ackermann_function)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T07:50:28.903

这个有点简单，但梳排序让我有点吃惊。

[http://en.wikipedia.org/wiki/Comb_sort](http://en.wikipedia.org/wiki/Comb_sort)

它是一个非常简单的算法，读起来像一个过于复杂的冒泡排序，但它是 O(n*Log[n])。我觉得这有点令人印象深刻。

过多的快速傅立叶变换算法也令人印象深刻，证明它们有效性的数学是迷幻的，我自己尝试证明一些很有趣。

[http://en.wikipedia.org/wiki/Fast_Fourier_transform](http://en.wikipedia.org/wiki/Fast_Fourier_transform)

我可以相当容易地理解素数基数、多个素数基数和混合基数算法，但是在大小为素数的集合上工作的算法非常酷。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-24T08:46:51.693

二维有序搜索分析非常有趣。你有一个二维数字数组 NxN ，其中每一行从左到右排序，每一列从上到下排序。任务是在数组中找到一个特定的数字。

递归算法：选择中间的元素，与目标数比较，丢弃数组的四分之一（取决于比较的结果），递归应用到剩余的 3 个四分之一，分析起来很有趣。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T07:48:27.660

非确定性多项式复杂性得到了我的投票，尤其是在（被认为不太可能）它可能与多项式相同的可能性的情况下。同样，理论上任何可以从量子计算中受益的东西（注意这组绝不是所有算法）。

我投票的另一个是对任意精度数字的常见数学运算——这是你必须考虑的事情，比如乘以大数字比乘以小数字更昂贵。Knuth 对此有很多分析（这对任何人来说都不应该是新闻）。Karatsuba 的方法非常巧妙：将两个因子除以 (A1;A2)(B1;B2) 的位数，然后分别乘以 A1 B1、A1 B2、A2 B1、A2 B2，然后合并结果。如果需要，递归...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-30T14:26:26.507

贝壳排序。有大量不同增量的变体，其中大多数除了使[复杂性分析更简单](http://www.inf.fh-flensburg.de/lang/algorithmen/sortieren/shell/shellen.htm)之外没有任何好处。

# ruby - 在 Ruby 中动态创建类

> ID：576827
> 
> 赞同：9
> 
> 时间：2009-02-23T07:47:00.143
> 
> 标签：ruby

我有一个应该看起来像这样的类：

```
class Family_Type1
    @people = Array.new(3)
    @people[0] = Policeman.new('Peter', 0)
    @people[1] = Accountant.new('Paul', 0)
    @people[2] = Policeman.new('Mary', 0)

    def initialize(*ages)
        for i in 0 ... @people.length
            @people[i].age = ages[i]
        end
    end
end 
```

我希望能够在运行时定义一堆与此类似的类（在启动时定义一次），其中数组的大小和分配给每个参数的类型是在运行时从外部规范文件定义的。

我有点让它使用 evals 工作，但这真的很难看。有更好的办法吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-23T08:36:47.730

据我了解，您需要元编程。这是使用初始化实例变量的初始化方法动态（动态）创建类的代码片段 -

```
class_name = 'foo'.capitalize
klass = Object.const_set(class_name,Class.new)

names = ['instance1', 'instance2'] # Array of instance vars

klass.class_eval do
  attr_accessor *names

  define_method(:initialize) do |*values|
    names.each_with_index do |name,i|
      instance_variable_set("@"+name, values[i])
    end
  end
  # more...
end 
```

希望您可以对其进行调整以适应您的要求。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-23T13:15:13.740

首先，您的示例代码不适合您的部分原因是您有两个不同`@people`的变量 - 一个是*实例变量*，另一个是*类实例变量*。

```
class Example
  # we're in the context of the Example class, so 
  # instance variables used here belong to the actual class object,
  # not instances of that class
  self.class #=> Class
  self == Example #=> true
  @iv = "I'm a class instance variable"

  def initialize
    # within instance methods, we're in the context
    # of an _instance_ of the Example class, so
    # instance variables used here belong to that instance.
    self.class #=> Example
    self == Example #=> false
    @iv = "I'm an instance variable"
  end
  def iv
    # another instance method uses the context of the instance
    @iv #=> "I'm an instance variable"
  end
  def self.iv
    # a class method, uses the context of the class
    @iv #=> "I'm a class instance variable"
  end
end 
```

如果您想在一个类中创建一次变量以在该类的实例方法中使用，请使用`constants`或`class variables`。

```
class Example
  # ruby constants start with a capital letter.  Ruby prints warnings if you
  # try to assign a different object to an already-defined constant
  CONSTANT_VARIABLE = "i'm a constant"
  # though it's legit to modify the current object
  CONSTANT_VARIABLE.capitalize!
  CONSTANT_VARIABLE #=> "I'm a constant"

  # class variables start with a @@
  @@class_variable = "I'm a class variable"

  def c_and_c
    [ @@class_variable, CONSTANT_VARIABLE ] #=> [ "I'm a class variable", "I'm a constant" ]
  end
end 
```

即便如此，在您的代码上下文中，您可能不希望 Family_Type1 的所有实例都引用相同的 Policemen 和 Accountants 对吧？还是你？

如果我们切换到使用类变量：

```
class Family_Type1
    # since we're initializing @@people one time, that means
    # all the Family_Type1 objects will share the same people
    @@people = [ Policeman.new('Peter', 0), Accountant.new('Paul', 0), Policeman.new('Mary', 0) ]

    def initialize(*ages)
        @@people.zip(ages).each { |person, age| person.age = age }
    end
    # just an accessor method
    def [](person_index)
      @@people[person_index]
    end
end
fam = Family_Type1.new( 12, 13, 14 )
fam[0].age == 12 #=> true
# this can lead to unexpected side-effects 
fam2 = Family_Type1.new( 31, 32, 29 )
fam[0].age == 12 #=> false
fam2[0].age == 31 #=> true
fam[0].age == 31 #=> true 
```

正如 Chirantan 所说，运行时初始化可以通过元编程来完成，但是如果您只初始化几个类，并且您知道它们的名称是什么，您也可以使用从文件中读取的任何内容来完成：

```
PARAMS = File.read('params.csv').split("\n").map { |line| line.split(',') }
make_people = proc do |klasses, params|
  klasses.zip(params).map { |klass,name| klass.new(name, 0) }
end
class Example0
  @@people = make_people([ Fireman, Accountant, Fireman ], PARAMS[0])
end
class Example1
  @@people = make_people([ Butcher, Baker, Candlestickmaker ], PARAMS[0])
end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T08:05:16.043

假设您想在运行时**为每个类型/数组大小创建不同的类：**

如果（就像在 Python 中）在执行时定义了一个 Ruby 类（我认为是这样），那么你可以这样做：

在函数中定义你的类。让函数接收数组大小和类型作为参数，并在其结果中返回类。这样，您就有了一种类工厂来调用规范文件中的每个定义:)

另一方面，如果您只想`@params`根据实际数据进行初始化，请记住，Ruby 是一种动态类型语言：只需`@params`在构造函数中重新分配给新数组！

# c# - 重复数据删除

> ID：576832
> 
> 赞同：-1
> 
> 时间：2009-02-23T07:49:13.633
> 
> 标签：c#

我有两个队列，我想删除重复的数据，我只想在队列 3 中插入​​不重复的数据

```
 foreach (GPJ_Model _gpjQx in gpjQx)
        {
            foreach (GPJ_Model _Model in mainP)
            {
                if (_gpjQx.dep.CompareTo(_Model.dep) != 0)
                {
                    updateP.Enqueue(_Model);
                }
            }
        } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T07:56:59.853

就个人而言，我会通过构建现有数据的哈希集来进行优化：

```
var existing = new HashSet<WhateverType>(_gpjQx.Select(x=>x.dep));
foreach(var item in mainP) {
    if(!existing.Contains(item.dep)) {
        updateP.Enqueue(item);
    }
} 
```

（属性`WhateverType`的类型在哪里`dep`）。

这应该使事情成为 O(n+m) 而不是 O(n*m)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T07:57:06.187

假设您的问题是这样的：如何在两个队列中查找重复项，删除它们并将它们复制到新队列中？

这是一个与语言无关的版本：

*   创建两个排序列表，每个队列一个
*   同步遍历每个队列，比较每个元素
    *   如果它们相等：删除并添加到第三个列表
    *   （如果队列中有多个相同的元素，请重复，直到您看到一个新的、不同的元素）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T08:30:38.323

为了简化，

```
 foreach (E e1 in q1)
    {
        foreach (E e2 in q2)
        {
            if (e1.CompareTo(e2) != 0)
            {
                q3.Enqueue(e1);
            }
        }
    } 
```

这样做的目的是将 q1 的所有元素多次添加到 q3，对于 q2 中与 q1 的元素不同的每个元素一次。如果 q1 是`[1, 2, 3]`并且 q2 也是，`[1, 2, 3]`那么 q3 将具有`[1, 1, 2, 2, 3, 3]`.

我怀疑那是你想要的。

尝试正确描述问题，可能使用示例。很可能，你自己会弄清楚如何解决它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T08:34:52.960

LINQ 版本

```
var distinct = gpjQx.Union(mainP).Distinct();

foreach(var value in distinct)
    updateP.Enqueue(value); 
```

# python - 关于在画布上显示照片是否存在已知的 Win32 Tkinter 错误？

> ID：576843
> 
> 赞同：3
> 
> 时间：2009-02-23T07:55:51.103
> 
> 标签：python, user-interface, winapi, tkinter

我注意到 tkinter 的一个非常奇怪的错误，我想知道这是否是因为 python 与 tcl 交互的方式存在某些问题，至少在 Win32 中是这样。

在这里，我有一个超级简单的程序，可以显示 gif 图像。它完美地工作。

```
from Tkinter import *

canvas = Canvas(width=300, height=300, bg='white')   
canvas.pack()

photo=PhotoImage(file=sys.argv[1])
canvas.create_image(0, 0, image=photo, anchor=NW)  # embed a photo
print canvas
print photo

mainloop( ) 
```

现在，我稍微更改程序以从函数内编辑画布对象。这一次，我只是得到一个空白画布。

```
# demo all basic canvas interfaces
from Tkinter import *

canvas = Canvas(width=300, height=300, bg='white')

canvas.pack()

def set_canvas(cv):
    photo=PhotoImage(file=sys.argv[1])
    cv.create_image(0, 0, image=photo, anchor=NW)  # embed a photo
    print cv
    print photo

set_canvas(canvas)
mainloop( ) 
```

两者之间的唯一区别是，在一个中，画布对象被传递给函数而不是直接使用。两个打印语句都返回相同的结果。我想知道在 tcl/python 层的对象模型中是否可能存在一些故障。

有什么想法吗，伙计们？

谢谢，/YGA

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T21:08:36.473

这样做是一种快速的解决方案，我将尝试解释：

```
def set_canvas(cv):
    global photo # here!
    photo=PhotoImage(file=sys.argv[1])
    cv.create_image(0, 0, image=photo, anchor=NW)  # embed a photo
    print cv
    print photo 
```

PhotoImage 需要至少有一个来自任何 Python 对象的引用，否则它会被垃圾收集。在我的解决方案中，我建议`photo`使用模块级名称，这样当函数结束时，仍然会有对 PhotoImage 对象的引用。您可能更喜欢创建一个类并制作`set_canvas`一个方法，并将 PhotoImage 对象存储为实例变量。

# java - JCIFS NTLM 库的替代品

> ID：576850
> 
> 赞同：19
> 
> 时间：2009-02-23T08:00:34.823
> 
> 标签：java, ntlm, jcifs, josso

JCIFS NTLM 库有什么替代品吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-05-21T11:06:59.697

华夫饼 - [https://github.com/dblock/waffle](https://github.com/dblock/waffle)

具有过滤器、身份验证器、支持 spring-security 等。仅限 Windows，但不需要本机 DLL。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-18T22:11:34.343

老实说，你不应该寻找一个。对于您的 SSO 需求，您应该使用适当的 kerberos / SPNEGO 而不是旧版 NTLM。

对于这些东西，您不需要特殊的库，因为 JVM 已经启用了自动执行此操作。您所要做的就是正确配置您的应用程序和 JVM 安全策略。Sun 的官方文档应该为您提供所需的所有详细信息，只需浏览“安全 API”部分。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-12-14T21:00:53.333

实际上[jcifs](https://jcifs.samba.org/)很好，您可以使用 Windows IIS 和 keep alive java Socket 在本地轻松测试[4 次握手。](http://www.innovation.ch/personal/ronald/ntlm.html)

这个 2004 Apache[伪代码](http://alvinalexander.com/java/jwarehouse/commons-httpclient-2.0.1/src/java/org/apache/commons/httpclient/NTLM.java.shtml)`generateType1Msg()`对于使用 jcifs 使用and构建算法很有用`generateType3Msg()`，甚至 Apache 也推广了一个[示例](https://hc.apache.org/httpcomponents-client-ga/ntlm.html)作为 HttpClient 的替代方案。

2004 年的旧 Apache 代码可以工作，但身份验证不稳定，您`HTTP/1.1 401 Unauthorized`经常会遇到这种情况，Luigi Dragone 的这个[非常旧的](http://www.luigidragone.com/software/ntlm-authentication-in-java/)代码也不再工作了。另一方面，Apache 的 HttpClient 运行平稳，但握手是在幕后完成的（仅供参考。HttpClient 需要`new NTCredentials()`定义用户的身份验证）。

这是一个在 IIS 上本地测试握手的示例，在没有域的端口 81 上。最后，如果您不使用 IIS ，则需要适当地更改`host`、和和 HTTP 标头。`port``user``password``WWW-Authenticate`

`HTTP/1.1 200 OK`表示认证正确，否则得到`HTTP/1.1 401 Unauthorized`.

```
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.net.Socket;
import java.net.UnknownHostException;

import jcifs.ntlmssp.NtlmFlags;
import jcifs.ntlmssp.Type1Message;
import jcifs.ntlmssp.Type2Message;
import jcifs.ntlmssp.Type3Message;
import jcifs.util.Base64;

import org.apache.http.impl.auth.NTLMEngineException;

public class TestNTLM {

    public static void main(String[] args) throws UnknownHostException, IOException, NTLMEngineException {
        Socket s = new Socket("127.0.0.1", 81);
        s.setKeepAlive(true);
        InputStream is = s.getInputStream();
        OutputStream os = s.getOutputStream();
        BufferedReader r = new BufferedReader(new InputStreamReader(is));
        BufferedWriter w = new BufferedWriter(new OutputStreamWriter(os));

        String host = "127.0.0.1:81";
        String hostDomain = "";
        String user = "My_Windows_Username";
        String password = "My_Windows_Password";

        w.write("GET http://127.0.0.1:81/ HTTP/1.1\n");
        w.write("Host: 127.0.0.1:81\n");
        w.write("Authorization: NTLM " + TestNTLM.generateType1Msg(hostDomain, host) + "\n\n");
        System.out.println("[First Message Sent]");
        w.flush();

        String resp = "", line = "";
        int contentLength = 0;
        while((line = r.readLine()) != null){
            if(line.length() == 0)
                break;
            System.out.println(line);
            if(line.startsWith("Content-Length"))
                contentLength = Integer.parseInt(line.substring(line.indexOf(":") + 1).trim());
            else if(line.startsWith("WWW-Authenticate"))
                resp = line.substring(line.indexOf(":") + 1).trim();
        }
        r.skip(contentLength);

        System.out.println("\n[Second Message Received]");
        System.out.println("Proxy-Authenticate: " + resp);
        resp = resp.substring(resp.indexOf(" ")).trim();

        w.write("GET http://127.0.0.1:81/ HTTP/1.1\n");
        w.write("Host: 127.0.0.1:81\n");
        w.write("Authorization: NTLM " + TestNTLM.generateType3Msg(user, password, hostDomain, host, new String(resp)) + "\n\n");

        w.flush();
        System.out.println("\n[Third Message Sent]");

        while((line = r.readLine()) != null){
            System.out.println(line);
            if(line.length() == 0)
                break;
        }
    }

    private static final int TYPE_1_FLAGS = 
            NtlmFlags.NTLMSSP_NEGOTIATE_56 | 
            NtlmFlags.NTLMSSP_NEGOTIATE_128 | 
            NtlmFlags.NTLMSSP_NEGOTIATE_NTLM2 | 
            NtlmFlags.NTLMSSP_NEGOTIATE_ALWAYS_SIGN | 
            NtlmFlags.NTLMSSP_REQUEST_TARGET;

    public static String generateType1Msg(final String domain, final String workstation)
            throws NTLMEngineException {
        final Type1Message type1Message = new Type1Message(TYPE_1_FLAGS, domain, workstation);
        return Base64.encode(type1Message.toByteArray());
    }

    public static String generateType3Msg(final String username, final String password,
            final String domain, final String workstation, final String challenge)
                    throws NTLMEngineException {
        Type2Message type2Message;
        try {
            type2Message = new Type2Message(Base64.decode(challenge));
        } catch (final IOException exception) {
            throw new NTLMEngineException("Invalid NTLM type 2 message", exception);
        }
        final int type2Flags = type2Message.getFlags();
        final int type3Flags = type2Flags
                & (0xffffffff ^ (NtlmFlags.NTLMSSP_TARGET_TYPE_DOMAIN | NtlmFlags.NTLMSSP_TARGET_TYPE_SERVER));
        final Type3Message type3Message = new Type3Message(type2Message, password, domain,
                username, workstation, type3Flags);
        return Base64.encode(type3Message.toByteArray());
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-04T16:31:51.973

我认为 NTLM 被弃用，取而代之的是 Kerberos/SPNEGO。查看[SPNEGO HTTP Servlet Filter](http://spnego.sourceforge.net)项目，看看它是否适合您的需要。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-27T16:51:25.877

jespa [www.ioplex.com](http://www.ioplex.com/)是我遇到的唯一一个。虽然没用过

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-01T11:27:46.027

如果您不介意商业打包产品，请查看：[Quest Single Sign On for Java](http://www.quest.com/single-sign-on-for-java/)，它提供对 SPNEGO/Kerberos（包括站点和 S4U 协议）以及 NTLM 的支持。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-09T11:01:05.230

Java Opensource Single Sign On (JOSSO) 位于[http://www.josso.org/](http://www.josso.org/) 他们有一个关于 NTLM 的页面，尽管我不确定它的效果如何。

# solr - Solr 奇怪的搜索行为

> ID：576851
> 
> 赞同：1
> 
> 时间：2009-02-23T08:00:53.480
> 
> 标签：solr, pysolr

我有很多索引的 solr 文档，其中包含字段

```
uri = nntp://msnews.microsoft.com/microsoft.public.windows.server.sbs 
```

但是当我用查询搜索时

```
uri:nntp\://msnews.microsoft.com/microsoft.public.windows.server.sbs 
```

它返回零结果。搜索查询可与其他类似的 uri (nntp://msnews.microsoft.com/microsoft.public.windows.windowsxp.general) 一起使用。

我在这里想念什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-30T04:58:06.410

如果您的搜索 URI 与您相似， `/select?uri%3Anntp*&rows=0` 您应该仍然能够很好地了解该字段中有多少项以 nntp 开头，甚至没有返回任何行，`numFound`结果标签的属性应该会告诉您。

如果这是空白，我会检查您的日志文件。您完全有可能在关闭提交的情况下添加文档。我会使用命令行脚本来强制提交和刷新读者：

```
sync
bin/commit 
sync
bin/readercycle 
```

然后我会再次发出该搜索，看看您是否可以再次看到您的数据。

# c# - 静态类有什么用

> ID：576853
> 
> 赞同：11
> 
> 时间：2009-02-23T08:01:13.680
> 
> 标签：c#, .net

静态类有什么用？我的意思是使用静态类有什么好处以及 CLR 如何处理静态类？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-23T08:05:44.123

静态类只是表示您不期望或不需要*实例*。这对于代码不是特定于对象的实用程序逻辑很有用。例如，扩展方法*只能*写在静态类中。

在 C# 2.0 之前，您可以只拥有一个带有私有构造函数的常规类；但是`static`让你*永远不能*有一个实例是正式的（**没有**构造函数*，所有成员都**必须**是静态的）。

（*=参见注释链；您可以选择使用类型初始值设定项（静态构造函数又名`.cctor`），但您不能拥有实例构造函数（又名`.ctor`））。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-23T08:15:46.157

.net 的编译和元数据模型要求所有函数都在一个类中定义。这使得反射 api 的生活变得更加轻松和简单，因为拥有类的概念及其可见性已经明确定义。它还使 il 模型更简单。

由于这排除了自由函数（与类无关的函数），因此可以选择将没有关联状态的函数（因此需要实例）放置在何处。如果它们不需要与它们关联的状态，也没有任何明确的基于实例的类可以关联并因此在其中定义，则它们的定义需要一些成语。

以前最好的方法是在构造函数是私有的类中定义方法，并且类中没有任何函数构造它。

这有点混乱（因为它没有明确说明为什么没有注释就完成了），并且反射 api 仍然可以找到构造函数并调用它。

因此允许使用静态类，使类的意图，即定义静态方法的地方，对用户和类型系统来说是清楚的。静态类根本没有构造函数。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-26T07:14:17.437

静态类是用 C# 编写过程程序的一种语言技巧。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-23T08:09:11.917

静态类的所有成员都必须是静态成员，因此，如果您忘记在其中任何一个之前添加“静态”，您的代码将无法编译，它也会使您的代码更具可读性，因为任何人都会看到该类是静态的会明白它只包含静态成员。

静态类的最佳用途是用于实用程序功能，您也可以使用它们在应用程序中保留全局方法和数据，我在几乎所有项目中都经常使用静态静态类。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-23T08:18:05.403

静态类通常用于对最初不希望通过对象实例访问的相关全局服务进行分组。一个示例是 .Net BCL 中的**Math**类，您可以直接使用它，例如 Math.Sqrt(10.0)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T08:09:19.717

静态类是密封的。这可能是将静态用于实用程序类的有用选项。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-06-10T16:12:17.210

我从这些陈述中得到了清晰的想法。

了解更多关于静态类的信息。首先，我们必须首先区分**静态**数据和**实例**数据。

每次创建类的新实例时，您都会获得实例数据的新副本以供使用。类的实例方法处理实例数据。实例数据完全独立于所有其他类甚至同一类的实例中的实例数据。如果您在一个实例中更改一个值，它不会影响其他实例中的相同值。大部分程序数据是实例数据。

静态数据等价于全局数据。程序中的每个人都看到相同的数据。如果有人更改数据，那么其他人也会看到更改。静态数据对于跨程序共享信息很有用，例如数据库连接字符串或日志文件。内存中一般只有一份静态数据。（有例外，例如在处理多个应用程序域时）。

当您创建一个类的实例时，您实际上是在分配一些内存来保存您自己的由该类定义的实例数据的副本。如果您创建一个类的 5 个实例，那么您将获得 5 个单独的内存位置，每个位置都有自己的实例数据副本。每个内存块都独立于其他内存块。

如果一个类没有实例数据，那么创建它的实例就没有任何意义。这样做是无害的，但也是浪费时间。这就是静态类的用武之地。**静态类是一种将类标识为没有实例数据的方法**。 **通过将类标记为静态，您是在告诉编译器该类中的所有数据都是全面共享的**。结果，编译器强制执行一些规则以使事情变得清晰。静态类只能包含静态成员。不能实例化静态类。静态类必须是密封的。为了方便开发人员，编译器强制执行此操作。

静态类是密封的。这是因为静态类不能有每个实例的数据。

Static methods are defined on the type level not on the instance level. That is why overriding doesn't work with static methods/properties/events...

Static constructor is called once and the static class remains in the memory for the lifetime of the application domain in which your program resides.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-12-12T06:55:50.523

参考： http: [//msdn.microsoft.com/en-us/library/79b3xss3 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/79b3xss3(VS.80).aspx)

1.首先你不能为静态类创建实例

2.  如果类声明为静态，则该类的成员变量应该是静态的

3.密封【不可继承】

4.不能包含实例构造函数

5.内存管理

示例：数学计算（数学值）不会改变 [STANDARD CALCULATION FOR DEFINED VALUES]

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2012-02-19T16:17:30.350

在一个类中，我们将一个函数声明为静态的，前提是该函数没有与任何对象关联。我们不应在该静态函数中使用“this”运算符，因为“this”运算符将引用调用该函数的对象。例如：考虑一个名为 Employee 的类有几个变量，如 Name、Age、Department，在这个 Employee 类中我将添加一个名为 getSimilarNames() 的函数，它将显示有多少员工具有相似的名字。此功能不需要与任何员工相关联。所以我把这个函数声明为一个静态的。如果一个类只包含静态函数，我们声明这个类是一个静态类。静态函数提高了性能。

# java - 如何在 Java 中填充数组？

> ID：576855
> 
> 赞同：90
> 
> 时间：2009-02-23T08:02:22.400
> 
> 标签：java, arrays

我知道如何正常进行，但我可以发誓您可以填写像 a[0] = {0,0,0,0}; 你是怎么做到的？我确实尝试了谷歌，但我没有得到任何帮助。

* * *

## 回答 #1

> 赞同：272
> 
> 时间：2009-02-23T08:04:01.133

查看[Arrays.fill](http://docs.oracle.com/javase/7/docs/api/java/util/Arrays.html#fill%28boolean%5B%5D,%20boolean%29)方法。

```
int[] array = new int[4];
Arrays.fill(array, 1); // [1, 1, 1, 1] 
```

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2009-02-23T08:05:31.160

您也可以将其作为声明的一部分：

```
int[] a = new int[] {0, 0, 0, 0}; 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-23T08:03:48.620

[`Arrays.fill()`](http://java.sun.com/javase/6/docs/api/java/util/Arrays.html#fill(long%5b%5d,%20long)). 该方法针对不同的数据类型进行了重载，甚至还有一个仅填充指定索引范围的变体。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2015-06-26T16:45:31.457

在 Java-8 中，您可以使用`IntStream`生成要重复的数字流，然后将其转换为数组。这种方法产生一个适合在初始化器中使用的表达式：

```
int[] data = IntStream.generate(() -> value).limit(size).toArray(); 
```

上面的`size`和`value`是产生要重复的项目数和重复值的表达式。

[演示。](http://ideone.com/gPEE7p)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-12-25T02:44:40.910

```
Arrays.fill(arrayName,value); 
```

在java中

```
int arrnum[] ={5,6,9,2,10};
for(int i=0;i<arrnum.length;i++){
  System.out.println(arrnum[i]+" ");
}
Arrays.fill(arrnum,0);
for(int i=0;i<arrnum.length;i++){
  System.out.println(arrnum[i]+" ");
} 
```

输出

```
5 6 9 2 10
0 0 0 0 0 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-23T08:09:35.737

可以使用`new Object {}`语法初始化数组。

例如，`String`可以通过以下任一方式声明一个数组：

```
String[] s = new String[] {"One", "Two", "Three"};
String[] s2 = {"One", "Two", "Three"}; 
```

基元也可以通过以下方式类似地初始化：

```
int[] i = new int[] {1, 2, 3};
int[] i2 = {1, 2, 3}; 
```

或一些数组`Object`：

```
Point[] p = new Point[] {new Point(1, 1), new Point(2, 2)}; 
```

Java 中数组的所有细节都写在[第 10 章：](http://java.sun.com/docs/books/jls/third_edition/html/arrays.html) Java 语言规范中[的数组，第三版](http://java.sun.com/docs/books/jls/third_edition/html/j3TOC.html)中。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-23T08:09:51.570

Java 中的数组元素在创建时被初始化为默认值。对于数字，这意味着它们被初始化为 0，对于引用，它们为空，而对于布尔值，它们为假。

要使用其他内容填充数组，您可以使用 [Arrays.fill()](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Arrays.html#fill(int[],%20int))或作为声明的一部分

```
int[] a = new int[] {0, 0, 0, 0}; 
```

Java 中没有像某些脚本语言那样用算术级数填充数组的捷径。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2016-03-02T19:08:05.283

```
int[] a = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10}; 
```

# c# - 用渐变颜色画一条线

> ID：576861
> 
> 赞同：7
> 
> 时间：2009-02-23T08:04:47.120
> 
> 标签：c#, winforms, gdi+, line, gradient

是否可以使用渐变色画线？

我希望能够绘制一条直线或曲线（如果可能），线的一端是蓝色，另一端是红色。

此外，每行可能需要一个以上的渐变，例如颜色从蓝色 -> 绿色 -> 红色。我在想这可能只是由多个绘制在一起的渐变线组成。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-23T08:16:44.907

```
protected override void OnPaint(PaintEventArgs e)
{
    base.OnPaint(e);

    Graphics graphicsObject = e.Graphics;

    using (Brush aGradientBrush = new LinearGradientBrush(new Point(0, 0), new Point(50, 0), Color.Blue, Color.Red))
    {
        using (Pen aGradientPen = new Pen(aGradientBrush))
        {
            graphicsObject.DrawLine(aGradientPen, new Point(0, 10), new Point(100, 10));
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T08:08:49.187

您将需要使用`System.Drawing.Drawing2D.LinearGradientBrush`而不是`System.Drawing.SolidBrush`

例子：

```
e.Graphics.DrawLine(new Pen(new System.Drawing.Drawing2D.LinearGradientBrush(... 
```

# mysql - 使用表将上次使用的 ID 保存在 Web 服务器场中

> ID：576882
> 
> 赞同：1
> 
> 时间：2009-02-23T08:23:15.593
> 
> 标签：mysql, database, thread-safety

我使用带有一行的表来保留最后使用的 ID（我有理由不使用 auto_increment），我的应用程序应该在服务器场中运行，所以我想知道如何更新最后插入的 ID（即递增它）和一步选择新 ID 以避免线程安全问题（服务器场中服务器之间的竞争条件）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T08:34:55.270

您要为数据库使用服务器场吗？这听起来并不“正确”。

您可能需要考虑将 GUID 用于 Id。它们可能很大，但没有重复项。

使用单个“下一个 id”值，您将遇到对该记录的锁定争用。我过去所做的是使用 id 范围表（RangeId、RangeFrom、RangeTo）。范围表的主键“RangeId”是一个简单的数字（例如 1 到 100）。“get next id”例程从 1 到 100 中选择一个随机数，获取第一个 id 低于随机数的范围记录。这会将锁分散到 N 条记录中。您可以使用 10、100 或 1000 的范围记录。当一个范围被完全消耗时，只需删除范围记录。

如果您真的在使用多个数据库，那么您可以手动确保每个数据库的范围记录集不重叠。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T08:29:47.777

您需要确保您的 ID 列只能在锁中访问 - 然后只有一个人可以读取最高 ID 并设置新的最高 ID。

您可以在 C# 中使用访问表的代码周围的 lock 语句来执行此操作，或者在您的数据库中，您可以在读/写时将事务放在一起。我不知道 mysql 上的确切语法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T09:12:03.653

使用事务数据库并手动控制事务。这样您就可以提交多个查询，而不会有混淆的风险。此外，您可以将相关查询集存储在存储过程中，因此您可以简单地调用这些事务查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-21T10:39:49.820

假设您的数据库配置为使用 READ_COMMITTED 或更好的事务隔离运行，然后使用一个更新行的 SQL 语句，将其设置为从行中选择的旧值加上增量。对于较低级别的事务隔离，您可能需要将 INSERT 与 SELECT FOR UPDATE 结合使用。

正如 [by Aaron Digulla] 所指出的，最好分配 ID 块，以减少查询和表锁的数量。

应用程序必须在独立于任何业务逻辑的事务中执行 ID 获取，否则任何需要 ID 的事务最终将等待每个首先请求 ID 的事务提交/回滚。

这篇文章：[http](http://www.ddj.com/architect/184415770 "Scott Ambler 的企业就绪对象 ID") ://www.ddj.com/architect/184415770解释了允许您的应用程序从多个分配器获取 ID 的 HIGH-LOW 策略。多个分配器提高了并发性、可靠性和可扩展性。

这里也有很长的讨论：[http://www.theserverside.com/patterns/thread.tss?thread_id=4228 "HIGH/LOW Singleton+Session Bean Universal Object ID Generator"](http://www.theserverside.com/patterns/thread.tss?thread_id=4228 "HIGH/LOW Singleton+Session Bean 通用对象 ID 生成器")

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T10:03:51.203

如果您遇到性能问题，请将 ID 增加 100 并为每个“客户端”服务器使用一个线程。线程应该执行增量并为每个感兴趣的方提供一个新的 ID。这样，线程只需为 100 个 ID 访问一次数据库。

如果线程崩溃，您将丢失几个 ID，但如果这种情况并非一直发生，您不必担心。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T10:11:32.090

AFAIK 将其从具有良好递增数字的数据库中取出的唯一方法将是数据库上的事务锁，这在性能方面是可怕的。您可以使用 GUID 获得无锁行为，但坦率地说，无论如何您都会在每个 CRUD 操作中遇到事务需求。

# printf - WinCE 上 printf 的限定符

> ID：576883
> 
> 赞同：1
> 
> 时间：2009-02-23T08:24:51.097
> 
> 标签：printf, windows-ce, qualifiers

在**WinCE**上，使用**printf**时，各种数据类型的限定符是什么 - 短、无符号长等。

简而言之，我知道答案是 %hd 和 %lu，我实际上正在寻找一个 MSDN 站点，该站点列出了 CE 上的所有数据类型及其限定符。不幸的是，我现在找不到该网站。我已经看过这篇[文章](https://stackoverflow.com/questions/2844/how-do-you-printf-an-unsigned-long-long-int)，但它不包含链接或答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-23T08:33:11.780

这篇 MSDN 文章：[格式规范字段：printf 和 wprintf 函数](http://msdn.microsoft.com/en-us/library/ms859632.aspx)（用于 Microsoft Windows CE 5.0 的平台生成器）会回答您的问题吗？

完成[**printf Type Field Characters**](http://msdn.microsoft.com/en-us/library/ms859597.aspx)，即。

# php - php httprequest 类和会话

> ID：576884
> 
> 赞同：0
> 
> 时间：2009-02-23T08:24:55.747
> 
> 标签：php, session

我在我的一个应用程序中使用 httprequest 类来请求跨域页面。基本上我需要通过跨域ajax请求根据用户的登录状态包含两个页面。由于安全问题，这是不允许的。

所以我所做的是我创建了一个代理页面，它使用 httprequest 类来请求远程文件，该文件又包括基于用户登录状态的两个 apges。

现在的问题是，每次 httprequest 类发出新请求时，会话就会被破坏，所以一旦我登录并在下次类发送新请求时刷新页面，从而创建一个新会话，所以登录的用户正在注销。

我需要做的是在多个 http 请求上保持相同的会话，直到用户选择注销。

我在 firebug 中观察到 http 请求正在发送 PHPSESSID cookie，但服务器没有发送任何响应。这有什么意义吗？

如何使用 php cookie 做到这一点？请帮忙。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T08:55:41.290

您需要在浏览器和远程服务器之间传递 cookie。我现在正在[做类似](https://stackoverflow.com/questions/573175/what-to-use-from-zend-framework-for-implementing-a-proxy)的事情，但我会给你一个更简单的例子：

**代理.php**

```
<?php

session_start();

if (! isset($_SESSION['remote_session_id'])) {

    $response = make_initial_request();

    /*
     * This means to read the Set-Cookie header and store it in your own session
     */
    $_SESSION['remote_session_id'] = $remote_session_id = get_remote_session_id($response);

} else {
    /*
     * Inside this function you must send a Cookie header populated with the value
     * of $remote_session_id. Its name is dependent on the remote server.
     */
    $response = make_remote_request($_SESSION['remote_session_id']);
} 
```

# .net - 如何避免 Windows 窗体单选按钮容器自动分组

> ID：576886
> 
> 赞同：7
> 
> 时间：2009-02-23T08:26:09.673
> 
> 标签：.net, winforms, layout, radio-button

**的背景**

在 .NET [Windows Forms](http://en.wikipedia.org/wiki/Windows_Forms) (2.0) 中，单选按钮自动按其容器控件分组，无论是 Form、Panel 还是 GroupBox。

这意味着当您选择一个单选按钮时，同一容器中的每个其他单选按钮都会自动更改为未选中状态。

现在，考虑以下表单布局：

```
MUST HAVE  NICE TO HAVE  DESCRIPTION
---------  ------------  -----------------------------------------------
   [ ]          [ ]      The gizmo works
   [ ]          [ ]      The gizmo works beautifully
   [ ]          [ ]      The gizmo works amazingly and makes you breakfast
   [ ]          [ ]      The gizmo comes with a pony 
```

*   每个`'[ ]'`都是一个单选按钮。
*   要求用户在第一列中选​​择*所需*的答案，在第二列中*选择可选*的（所需的最佳情况答案）。

如您所见，单选按钮应按列分组：选择其中一个单选按钮应清除该列的其余部分，但对另一列没有影响。

**问题**

基本上问题在于这是一个动态生成的表单。

*   布局中的行数是动态的，它是从可配置的表单定义中加载的。
*   描述文本直到运行时才知道，并且长度变化很大（有些可能只有几个单词，有些可能只有十几行）。
*   无法重新设计布局。这来自于（非技术）用户对这种已使用多年的纸质版本的熟悉程度。此表单也会打印，即使我更改了表单上的输入系统，这也意味着使用“旧”布局编写另一个版本以进行打印。

**我尝试过但没有用的**

我首先尝试使用三个面板将其实现为动态生成的布局，每列一个，因此自动单选按钮分组可以正常工作。它确实做到了。

但是与单选按钮及其文本之间的水平对齐相关的布局问题简直让我很生气。直到运行时才知道文本的大小，并且文本行可能会换行（有时每个项目会换行几次）。有时它正确对齐，有时它没有。我即将开始调试它，但我在想改变这个三面板实现是否是一个更好的选择。

**我正在尝试做的事情**

我想通过使用`TableLayoutPanel`三列来重新设计布局，以简化与对齐相关的问题，但这意味着我不能使用自动单选按钮按容器分组“功能”。

编辑：

正如 Gerrie 建议的那样，其他布局选项是将每一行实现为用户控件并使用流布局面板。

这再次意味着，我可能希望将控件用于布局，但不用于单选按钮分组。

*尽管使用水平用户控件，我仍需要获取垂直单选按钮组*

/编辑

**我想问什么**

我需要有关如何手动控制单选按钮分组的指针和建议。`RadioButton`如果需要，我真的不介意将类子类化。

具体来说，是否有任何“规范”或已知的子类化“RadioButton”或一直到 Win32 API，以便每次检查控件时（通过使用鼠标、键盘 Enter、空格键和任何其他方式我无法意识到选择它们）我可以捕获事件并手动更新表单上所有其他控件的状态，并且以众所周知的自动分组功能被“停用”的方式更新？我担心实现也是与容器相关的，我可能也被迫继承 Panel?。

Windows 窗体中的分组“魔术”如何工作？

我发现的每个实现自定义单选按钮组或“单选按钮列表”的谷歌搜索解决方案都以某种方式基于使用该组的容器。可以避免使用容器吗？如果是这样，如何？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T09:14:55.470

我发现的一个*临时*解决方案（阅读：*messy hack*）是我将**每个**单选按钮放在自己的小面板中。因此，它们之间根本不会发生分组。我正在监听每个按钮`checked`事件并相应地更新相应的事件。

我仍然认为拥有这么多面板有点过头了，如果有人有更清洁的解决方案，我很想听听。

（好吧，很抱歉回答我自己的问题。你知道，当你花时间解释一些事情时，你会开始以不同的眼光看待问题。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T08:41:37.220

我会选择一个简单直接的解决方案。例如，一个表示一行的自定义控件（即两个单选按钮和一个标签）。

编辑：好的，我想我现在明白你的要求了。难道你不能只有两个单选按钮集合：A 列中的单选按钮和 B 列中的单选按钮？

绘制表单时，将它们添加到两个 List<RadioButton> 或其他任何内容，并将它们绑定到两个单独的事件：columnARBChecked、columnBRBChecked。当其中一个事件触发时，您可以调用一些逻辑来检查/取消选中其余的单选按钮。

# drupal - 主题和模板有什么区别？

> ID：576888
> 
> 赞同：5
> 
> 时间：2009-02-23T08:27:35.070
> 
> 标签：drupal, templates, themes

我正在尝试将我的网站迁移到 Drupal，但我对主题和模板感到困惑。我当前站点中页面的外观完全由模板文件和 CSS 控制。它在 Drupal 中是如何工作的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T08:31:57.307

在 drupal 中，主题处理网站的外观，模板处理内容的呈现方式。

可以这样想：模板用于呈现内容，然后将主题应用于该内容。

**编辑：**因此，您的 css 文件与 drupal 中的主题一起使用，与模板无关。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-25T20:36:26.767

在 Drupal 中，“主题”只是一种特殊类型的插件，它将任意数量的模板（用于控制给定数据如何呈现为 HTML）、CSS、JS 文件、图像等捆绑在一起。

因此，您的总页标记有一个“模板”，一个侧边栏块如何呈现为 HTML 的“模板”等等。所有这些，捆绑在一起并命名，被称为一个主题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-09T16:29:27.087

这样看：可以创建一个没有模板的主题。这样的主题将具有覆盖 drupal 的默认 CSS 文件的 CSS 文件。使用这样的主题将创建一个看起来几乎与 Drupal 的默认站点完全一样的网站，除了它会有不同的颜色、字体等。

但是如果你想改变页面上项目的位置，页面上有哪些类型的项目等等，你必须通过在你的主题中添加一些你自己的来覆盖默认模板。这些新模板允许您更改 Drupal 显示的信息以及 Drupal 将使用哪种 HTML 来显示它。

例如，假设我想克隆 StackOverflow，但我想用 Drupal 来做。我要做的第一件事是创建一个新的内容类型（称之为“问题”），它就像一个故事，但有额外的字段来跟踪投票等等。Drupal 的默认模板不知道这些额外的字段，因此它们不会显示它们。

所以，我要做的是进入我的主题并添加一个新的 node.tpl.php 文件。这个新模板和标准模板一样，除了我可以添加代码说“如果这个节点是'问题'类型，则将投票小工具插入正文的左侧。”

这有帮助吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-02T17:18:06.420

主题由一组模板文件组成。block.tpl.php、node.tpl.php、page.tpl.php 都是模板文件，当它们与你的 CSS、JS 和图像结合时会产生一个主题。另外一个主题可以被继承。可以通过从现有主题继承而仅使用 CSS 而无需其他模板文件来创建主题，在这种情况下，将使用来自父主题的模板文件。

另一种看待它的方式是主题是您所看到的，模板文件负责生成标记。

我希望这使它更清楚一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T14:55:36.810

我很困惑...

第一个答案说模板和主题彼此无关，而第二个答案说主题只是答案的集合。

哪一个是对的？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-09T19:30:21.757

Drupal 有一个基于模板的主题系统。您可以在页面中定义自己的区域，并可以根据该区域安排内容。有一些默认的模板文件，例如 page.tpl ，block.tpl ，node.tpl ，它们显示不同类型的内容。您可以根据需要编写自己的模板文件，例如，如果您需要更改用户注册表单或登录页面的显示，您可以为此创建一个 tpl 文件，并且必须将数据重定向到该 tpl 文件。您可以使用 drupals api 将 css 或 js 添加到这些模板中。此重定向必须在主题 template.php 文件中完成

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-06T14:54:03.197

主题由 css、js、图像和模板文件组成。每个主题可能包含多个模板文件。

此外，主题可以被继承，并且子主题的模板文件可以覆盖其父主题的模板文件。

# iphone - 来自 Appstore 收入的非美国税？

> ID：576892
> 
> 赞同：12
> 
> 时间：2009-02-23T08:29:05.300
> 
> 标签：iphone, app-store

即使对于非美国开发者，Apple 是否也会“出于税收目的扣留部分收入”？我已经看到[了这个相关的问题](https://stackoverflow.com/questions/124093/tax-on-iphone-developer-payments)，但不清楚非美国开发人员会发生什么。有一个表格“W-8BEN”的参考，但我不明白 - 这是我非美国时必须填写的，并且我想避免 Apple 代扣税款吗？

例如，我知道[Dreamhost](http://www.dreamhost.com)推荐奖励计划的收入仅对美国公民征税——明确指出，对于非美国人，全额奖励已支付，他们必须自己处理税收问题。我正在寻找关于应用商店收入的这种明确声明。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-23T08:41:05.770

W8BEN 表格允许非美国公司声明美国不应预扣税款。必须提供正当理由。在我们的文章中，我们简单地说明了适用于跨境贸易的北美自由贸易协定的部分（第二部分，#10：“第七条”，“0%”，对于收入类型“软件许可证”，原因是“公司是加拿大。”）

一旦向客户提交了表格，获得全额付款就再也没有问题了。

坦率地说，这有点烦人，但我们已经习惯了（表格不需要定制，只是最近过时的）。

基本上，Apple 所需要的只是文书工作，以便他们可以在其应付账款系统中选中“0% 预扣税”复选框。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-23T08:37:08.930

传递朋友的答案（嗨格伦） - 这是澳大利亚的观点。

您应该阅读可从 iTunesConnect 的“管理您的税务信息”屏幕下载的 W-8BEN 提示表。特别是，作为澳大利亚公司/个体经营者，您不需要 ITIN。使用提供的 SS-4 申请 EIN，并将其传真到给定的号码。您应该在几天后从 IRS 取回 EIN 详细信息。我在 4 天内从传真中收到了号码，我想他们还给我寄了一封确认信。然后，您可以使用 EIN 填写 Apple 的文档。

您应该注意的另一件事是日本税表。如果您期望在日本有不错的销售额，例如，如果您已经为日本本地化了内容，那么不填写此表格将使您损失 20% 的销售额以缴纳预扣税。此外，由于 App Store 开业时的汇率等因素，您实际上在日本的销售中获得的每个座位比其他任何地方都多。他们需要 90 天来处理此问题，因此您越早发送越好。我等了太久，因为我发现一些部分令人困惑，但在与 iTunesConnect 人员核实后，它实际上非常简单。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T08:37:51.143

您可能应该[与 Apple](http://www.apple.com/contact/)[联系](http://www.apple.com/support/itunes/store/) ，而不是 Stack Overflow。

*编辑：*我认为有人认为直接询问 Apple 是您不应该做的事情，因为我投了反对票；）

# opengl - 您可以在不打开窗口的情况下创建 OpenGL 上下文吗？

> ID：576896
> 
> 赞同：30
> 
> 时间：2009-02-23T08:29:55.297
> 
> 标签：opengl

偶尔我会遇到想要获取 OpenGL 帧缓冲区对象的地方，但我对打开任何类型的窗口都不感兴趣。

是否可以在不将其附加到任何类型的窗口的情况下创建 opengl 上下文？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-23T08:57:47.273

是的！您可以将桌面窗口用作传递给 OpenGL 的窗口——只要您不尝试在其上显示任何内容；）

在创建新的 OpenGL 窗口时，只需调用[GetDesktopWindow](http://msdn.microsoft.com/en-us/library/ms633504(VS.85).aspx)并将结果作为参数传递。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-08-24T15:11:00.203

[http://www.opengl.org/wiki/Creating_an_OpenGL_Context](http://www.opengl.org/wiki/Creating_an_OpenGL_Context)

根据这个网页， `WGL_ARB_create_context`可以用来创建一个没有窗口的上下文。我自己并没有真正尝试过。我使用 freeGLUT 创建上下文，然后在屏幕外渲染到帧缓冲区 + 渲染缓冲区。我没有调用 glutMainLoop 就退出了程序。它很笨拙，但它适用于我的目的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T08:57:50.847

是的，您可以使用 OpenGL 执行屏幕外渲染，但设置它的确切方法取决于操作系统。最接近独立于操作系统的方式是使用[Mesa 3D](http://mesa3d.org/)，但是您的屏幕外渲染不会被硬件加速。

# java - 你在实际项目中使用过 Quickcheck

> ID：576901
> 
> 赞同：36
> 
> 时间：2009-02-23T08:33:04.603
> 
> 标签：java, haskell, testing, quickcheck

[Quickcheck](http://www.cs.chalmers.se/~rjmh/QuickCheck/)及其变体（即使在[Java](https://bitbucket.org/blob79/quickcheck)中有一个），似乎很有趣。然而，除了学术兴趣之外，它在真正的应用程序测试中是否真的有用（例如，GUI 应用程序或客户端/服务器，甚至是 StackOverflow 本身）？感谢您对类似测试生成器的任何体验。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-02-23T09:23:54.043

好吧。实际上没有，但我曾在最初开发 QuickCheck 的人手下学习，他是一个非常有趣的人。

早在 2004 年，我们被迫使用 QuickCheck 来测试我们的 Haskell 程序，它是好坏参半。主要是因为 Haskell 本身有点令人生畏，但当你让它工作时，它的美妙之处就永远不会减少。

从那以后，约翰完善了他多年前写的东西，并帮助爱立信测试了他们复杂的电信硬件，他在大约 2000 万行代码中发现了错误，通过他的方法将其减少到仅仅三个步骤。他是一位出色的演讲者，所以听他介绍他的出色表现总是很高兴，但总而言之，他对 QuickCheck 所做的一切对我来说都是新的。所以我问他，他对把这个推向市场有什么兴趣。他对这个想法持开放态度，但当时他的业务（基于 QuickCheck）相对较新，因此他将专注于其他领域。现在是 2007 年。我的意思是，即使您最终不会使用 QuickCheck，您也可以向它学习。

但什么是快速检查？它是一个组合测试框架和一种有趣的程序测试方式。微软研究院的人已经建立了类似的[Pex](http://research.microsoft.com/en-us/projects/Pex/)。Pex 通过检查您的 IL 自动生成测试。然而，John 会为函数的可能输入和测试属性编写一个生成器。属性是可以轻松测试的东西，而且更加正式。例如反转列表？嗯，颠倒一个列表，就像把一个列表分成两半，分别颠倒它们，然后以相反的顺序连接两个颠倒的一半。

```
1,2,3,4 // original
1,2 3,4 // split into A and B
2,1 4,3 // reverse A and B
4,3,2,1 // concat B and A 
```

这是一个很好的属性，可以使用称为规范的 QuickCheck 进行测试，结果非常惊人。

Pex 很好，但不如 QuickCheck 酷，Pex 简化了事情，QuickCheck 做到了，但编写一个好的规范需要付出很多努力。

QuickCheck 的强大之处在于，当它遇到故障时，它会将导致测试失败的输入减少到尽可能小的形式。让您详细描述导致测试失败的状态进展。与其他只会尝试以蛮力方式破坏您的代码的测试框架相比。

由于您编写测试规范的方式，这成为可能。QuickCheck 依靠伪随机性来发明输入，正因为如此，它能够回溯并找到无法通过测试的非常小的输入。

编写 QuickCheck 属性需要做更多的工作，但最终结果是更好的测试。正如约翰本人所说，70% 的错误是通过单元测试捕获的，但导致程序崩溃的是另外 30% 的错误。QuickCheck 正在测试最后的 30%。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-24T07:54:03.537

我已经完成了一个涉及离散事件模拟的真正 Haskell 问题。所以我写了一个基于 continuation monad 的 DES 库，以及 MVars 和 Channels 的等价物。我需要检查它是否正常工作，所以我编写了一堆 QuickCheck 属性来证明，例如，写入 Channel 的两个并发数据流将被正确合并而不会丢失任何内容。

我还使用 QuickCheck 来记录和验证我的[Ranged Sets](http://hackage.haskell.org/cgi-bin/hackage-scripts/package/Ranged-sets-0.2.0)和[Decimal](http://hackage.haskell.org/cgi-bin/hackage-scripts/package/Decimal)库中的属性。

根据我的经验，QuickCheck 有时很棒。如果你能以简洁的方式总结一个重要的属性，尽管提供该属性的算法很复杂，那么 QuickCheck 是一个巨大的胜利。另一方面，我经常发现算法等价于我要验证的属性。在这种情况下，我会寻找更简单的属性。例如，假设函数“foo”应该是非严格单调的。然后你可以写

```
prop_fooMonotonic x y = (x > y) ==> (foo x >= foo y) 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-24T02:04:12.360

我使用 QuickCheck 处理很多个人事务。过去六个月内：

*   运行 QuickCheck 以测试图像压缩器中的颜色变换和离散余弦变换。

*   运行 QuickCheck 来测试我为一些数值优化而设计的符号微分模块。

*   运行 QuickCheck 以测试 Bentley 和 Sedgewick 风格的三元搜索树。

QuickCheck 很少能满足我*所有*的单元测试需求，但它是一个很好的入门方式——而且 QuickCheck 法律可以制作很好的文档。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-23T09:52:43.117

我已经用过很多次了，主要是以直接的方式，主要用于测试协议和解析器实现。

但是，从我的个人经验来看，这是不那么微不足道的一点：[http ://www.haskell.org/haskellwiki/QuickCheck_as_a_test_set_generator](http://www.haskell.org/haskellwiki/QuickCheck_as_a_test_set_generator)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-24T02:10:02.987

[ScalaCheck](http://code.google.com/p/scalacheck/)（Scala 的 QuickCheck）用于测试[Functional Java](http://functionaljava.org)，这是一个库，除其他外，实现[了 Java 的 QuickCheck](http://functionaljava.googlecode.com/svn/artifacts/2.17/javadoc/fj/test/package-summary.html)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-06-23T09:19:36.190

AFAIK XMonad 使用 QuickCheck 进行了广泛测试

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-08-10T09:45:25.383

我只在生产环境中使用 Haskell 开发小助手工具。主要是因为我是我认识的唯一一个阅读 Haskell 的开发人员。虽然我广泛使用了 QuickCheck，但我对 C# 中没有类似的东西感到非常恼火。所以我决定尝试[自己写](http://kilfour.wordpress.com/2009/08/02/testing-tool-tour-quicknet-preview/)。我也查看了 Pex，但发现用于查找最小输入的程序探索技术不如 QuickCheck 那样有趣。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-08-07T20:32:37.280

我使用 QuickCheck 来测试以任何语言编写的命令行程序的行为。

查找低级或动态类型程序崩溃的输入特别有用。

为方便起见，我编写了[http://hackage.haskell.org/package/proctest](http://hackage.haskell.org/package/proctest)，其中包括一些 QuickCheck 与 hspec 和 HUnit 一起使用以通过这种方式测试命令行程序的示例。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-09-11T13:40:41.470

我们使用[FsCheck](http://fscheck.codeplex.com/)来检查我们的 OCaml 到 F# 的转换是否正确，并且我们的优化版本与未优化版本的工作方式相同。我还计划用它来测试词法分析器和解析器，因为[NHol](https://github.com/jack-pappas/NHol)项目使用了[解析器](https://github.com/jack-pappas/NHol/blob/master/NHol/parser.fs)组合器。

我们还有帮助函数，允许我们在[NUnit](http://www.nunit.org/)（XUnit for .Net）中运行测试。见[assertProp](https://github.com/jack-pappas/NHol/blob/master/NHol.Tests/TestHelpers.fs)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-02-02T02:53:16.060

我使用 QuickCheck 在 LG Linux Mobile 平台上测试 SMS PDU 编码器和解码器。我当时开发的软件的（旧）版本可在[http://hackage.haskell.org/package/GenSmsPdu-0.1下载](http://hackage.haskell.org/package/GenSmsPdu-0.1)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-02-02T05:18:40.007

这不是我的项目，但该`containers`包相当广泛地使用 QuickCheck。就个人而言，我尝试用它来比较我写的一个愚蠢的小素筛和一个 in `arithmoi`，这让我发现了一个 in`arithmoi`有时会出现段错误。

# php - 如何在 Magento 中创建一个简单的“Hello World”模块？

> ID：576908
> 
> 赞同：309
> 
> 时间：2009-02-23T08:36:38.340
> 
> 标签：php, magento, controller, magento-1.9

如何在 Magento 中完成以下任务？

*   使用控制器/视图/模型方法显示“Hello World”消息。所以，如果我去`http://example.com/myController`它会显示字符串'Hello World'。能够在我的网站模板中显示此字符串（例如，页眉、页脚等）将是一个奖励。

*   如何向此控制器（或必要时添加新控制器）添加方法，该方法与模型交互，执行查询`Select * FROM articles where id='10'`并将行（包含列`id, title, content`）返回给控制器？然后使用控制器包含一个视图，该视图将显示这一行。所以去`http://example.com/myController/show_row`（或类似的东西）会在视图中显示该行。（不需要花哨，只要 a`echo $row->id;`或类似的东西就可以了。）

有关 Magento 代码结构的任何其他信息也将非常有帮助。

* * *

## 回答 #1

> 赞同：544
> 
> 时间：2009-02-26T01:07:06.960

首先，我强烈建议您[从 PHP Architect 购买 PDF/电子书](http://www.phparch.com/books/phparchitects-guide-to-programming-with-magento/)。它是 20 美元，但它是我能找到的唯一直接的“Magento 的工作原理”资源。我还开始[在我自己的网站上编写 Magento 教程](http://alanstorm.com/category/magento)。

其次，如果您可以选择，但不是经验丰富的程序员或无法接触到经验丰富的程序员（最好是 PHP*和*Java），请**选择另一个购物车**。Magento 设计精良，但它被设计成一个购物车解决方案，其他程序员可以在其上构建模块。它的设计不是为了让聪明但不是程序员的人容易理解。

[第三，Magento MVC 与现在 PHP 开发人员流行的Ruby on Rails](http://en.wikipedia.org/wiki/Ruby_on_Rails)、[Django](http://en.wikipedia.org/wiki/Django_%28web_framework%29)、[CodeIgniter](http://en.wikipedia.org/wiki/Codeigniter#CodeIgniter)、[CakePHP](http://en.wikipedia.org/wiki/CakePHP)等 MVC 模型有很大不同。我认为它是基于[Zend](http://en.wikipedia.org/wiki/Zend_Framework)模型的，整个过程非常类似于 Java OOP。您需要关注**两个**控制器。module/frontName 控制器，然后是 MVC 控制器。

第四，Magento 应用程序本身是使用您将使用的相同模块系统构建的，因此围绕核心代码进行探索是一种有用的学习策略。此外，您将使用 Magento 做的很多事情都是**覆盖**现有的类。我在这里介绍的是**创建**新功能，而不是覆盖。当您查看那里的代码示例时，请记住这一点。

我将从您的第一个问题开始，向您展示如何设置控制器/路由器以响应特定的 URL。这将是一本小小说。稍后我可能有时间讨论与模型/模板相关的主题，但现在我没有。但是，我将简要谈谈您的 SQL 问题。

Magento 使用[EAV](http://en.wikipedia.org/wiki/Entity-Attribute-Value_model)数据库架构。只要有可能，尝试使用系统提供的模型对象来获取您需要的信息。我知道这些都在 SQL 表中，但最好不要考虑使用原始 SQL 查询来获取数据，否则你会发疯的。

最后的免责声明。我已经使用 Magento 大约两三周了，所以请谨慎购买。这是一个让我明白这一点的练习，就像帮助 Stack Overflow 一样。

## 创建一个模块

Magento 的所有添加和定制都是通过模块完成的。因此，您需要做的第一件事就是创建一个新模块。创建一个 XML 文件，`app/modules`命名如下

```
cd /path/to/store/app
touch etc/modules/MyCompanyName_HelloWorld.xml 
```

```
<?xml version="1.0"?>
<config>
     <modules>
        <MyCompanyName_HelloWorld>
            <active>true</active>
            <codePool>local</codePool>
        </MyCompanyName_HelloWorld>
     </modules>
</config> 
```

MyCompanyName 是您修改的唯一命名空间，它不必是您公司的名称，而是推荐的约定 my magento。`HelloWorld`是您的模块的名称。

## 清除应用程序缓存

现在模块文件已经到位，我们需要让 Magento 知道它（并检查我们的工作）。在管理应用程序中

1.  转到系统->缓存管理
2.  从所有缓存菜单中选择刷新
3.  单击保存缓存设置

现在，我们确保 Magento 知道该模块

1.  转到系统->配置
2.  单击高级
3.  在“禁用模块输出”设置框中，查找名为“MyCompanyName_HelloWorld”的新模块

如果您可以忍受性能下降，您可能希望在开发/学习时关闭应用程序缓存。没有什么比忘记清除缓存并想知道为什么您的更改没有显示更令人沮丧的了。

## 设置目录结构

接下来，我们需要为模块设置目录结构。您不需要所有这些目录，但现在设置它们并没有什么坏处。

```
mkdir -p app/code/local/MyCompanyName/HelloWorld/Block
mkdir -p app/code/local/MyCompanyName/HelloWorld/controllers
mkdir -p app/code/local/MyCompanyName/HelloWorld/Model
mkdir -p app/code/local/MyCompanyName/HelloWorld/Helper
mkdir -p app/code/local/MyCompanyName/HelloWorld/etc
mkdir -p app/code/local/MyCompanyName/HelloWorld/sql 
```

并添加配置文件

```
touch app/code/local/MyCompanyName/HelloWorld/etc/config.xml 
```

在配置文件中，添加以下内容，这本质上是一个“空白”配置。

```
<?xml version="1.0"?>
<config>
    <modules>
        <MyCompanyName_HelloWorld>
            <version>0.1.0</version>
        </MyCompanyName_HelloWorld>
    </modules>
</config> 
```

过于简单化了，这个配置文件可以让你告诉 Magento 你想运行什么代码。

## 设置路由器

接下来，我们需要设置模块的路由器。这将使系统知道我们正在处理任何形式的 URL

```
http://example.com/magento/index.php/helloworld 
```

因此，在您的配置文件中，添加以下部分。

```
<config>
<!-- ... -->
    <frontend>
        <routers>
            <!-- the <helloworld> tagname appears to be arbitrary, but by
            convention is should match the frontName tag below-->
            <helloworld>
                <use>standard</use>
                <args>
                    <module>MyCompanyName_HelloWorld</module>
                    <frontName>helloworld</frontName>
                </args>
            </helloworld>
        </routers>
    </frontend>
<!-- ... -->
</config> 
```

你在这里说的是“任何带有 helloworld 前端名称的 URL ...

```
http://example.com/magento/index.php/helloworld 
```

应该使用 frontName 控制器 MyCompanyName_HelloWorld”。

所以，有了上面的配置，当你加载上面的 helloworld 页面时，你会得到一个 404 页面。那是因为我们还没有为控制器创建文件。现在让我们这样做。

```
touch app/code/local/MyCompanyName/HelloWorld/controllers/IndexController.php 
```

现在尝试加载页面。进步！你会得到一个 PHP/Magento 异常，而不是 404

```
Controller file was loaded but class does not exist 
```

因此，打开我们刚刚创建的文件，并粘贴以下代码。类的名称需要基于您在路由器中提供的名称。

```
<?php
class MyCompanyName_HelloWorld_IndexController extends Mage_Core_Controller_Front_Action{
    public function indexAction(){
        echo "We're echoing just to show that this is what's called, normally you'd have some kind of redirect going on here";
    }
} 
```

我们刚刚设置的是 module/frontName 控制器。这是默认控制器和模块的默认操作。如果你想添加控制器或动作，你必须记住 Magento URL 的树的第一部分是不可变的，它们总是这样`http://example.com/magento/index.php/frontName/controllerName/actionName`

所以如果你想匹配这个 url

```
http://example.com/magento/index.php/helloworld/foo 
```

你必须有一个 FooController，你可以这样做：

```
touch app/code/local/MyCompanyName/HelloWorld/controllers/FooController.php 
```

```
<?php
class MyCompanyName_HelloWorld_FooController extends Mage_Core_Controller_Front_Action{
    public function indexAction(){
        echo 'Foo Index Action';
    }

    public function addAction(){
        echo 'Foo add Action';
    }

    public function deleteAction(){
        echo 'Foo delete Action';
    }
} 
```

请注意，默认控制器 IndexController 和默认操作 indexAction 可以是隐式的，但如果后面有东西，则必须是显式的。因此`http://example.com/magento/index.php/helloworld/foo`将匹配控制器 FooController 和动作 indexAction 而不是 IndexController 的动作 fooAction。如果你想要一个 fooAction，那么在控制器 IndexController 中你必须像这样显式地调用这个控制器： `http://example.com/magento/index.php/helloworld/index/foo`因为 url 的第二部分是并且将永远是控制器名。这种行为是对捆绑在 Magento 中的 Zend 框架的继承。

您现在应该可以访问以下 URL 并查看 echo 语句的结果

```
http://example.com/magento/index.php/helloworld/foo
http://example.com/magento/index.php/helloworld/foo/add
http://example.com/magento/index.php/helloworld/foo/delete 
```

因此，这应该让您对 Magento 如何调度到控制器有一个基本的了解。从这里我建议查看现有的 Magento 控制器类，看看应该如何使用模型和模板/布局系统。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-02-25T11:09:50.607

上个月左右我一直在与 Magento 搏斗，但我仍在努力解决问题。所以这是一个盲人带领盲人的例子。文档的方式很少，论坛/wiki充其量是混乱的。不仅如此，还有一些解决方案要么已经过时，要么远非最优。我不确定您是否有一个项目或只是想弄清楚，但如果您从修改现有功能而不是创建全新的功能开始可能会更容易。为此，我肯定会选择 wiki 中的“开发人员推荐文章”。新的付款方式一是真正令人大开眼界。

对于调试，我绝对推荐[使用 FirePHP](https://magento.stackexchange.com/questions/181/how-to-configure-firephp)并在出现问题时查看您的 HTML 源代码。ole echo 调试方法并不能很好地工作。

总体架构非常复杂，即使我完全理解它，我也需要写一本书来涵盖它。我能做的最好的就是给你建议，我希望有人在我刚开始的时候给我...

远离核心文件。不要修改它们，而是编写你自己的模块并覆盖你需要的。

Magento 使用由 XML 组成的配置文件来决定它需要做什么。为了让它运行你自己的东西而不是核心功能，你需要正确的 xml。不幸的是，没有关于如何构建 XML 的指南。您需要查看示例并进行一些认真的测试。更复杂的是，这些文件的内容在很大程度上是区分大小写的。但是，如果您掌握了这些，您就可以覆盖基本功能的任何部分，从而形成一个非常强大的系统。

Magento 使用`Mage::getModel('mymodel')`, `Mage::getSingleton('mysingleton')`,之类的方法`Mage::helper('myhelper')`来返回某些类的对象。默认情况下，它会在其核心命名空间中找到这些。如果你想让它使用你自己的，你需要在你的`config.xml`文件中覆盖这些。

您的类的名称必须与它们所在的文件夹相对应。

Magento 中的许多对象最终都扩展了称为 a 的东西`Varien_Object`。这是一个通用类（有点像瑞士军刀），它在生活中的目的是允许您动态定义自己的方法/变量。例如，您会看到它被用作一个美化的数组，将数据从一种方法传递到另一种方法。

在开发过程中，请确保禁用缓存。它会让 magento 变得非常缓慢，但它会为你节省很多头部创伤（因为它会撞到你的桌子上）。

你会看到`$this`被大量使用。根据您看到的文件，这意味着不同的类。`get_class($this)`是你的朋友，尤其是与 FirePHP 一起使用。

把事情记在纸上。很多。在你遇到它们后 1-2 天你会需要无数的小事实。

Magento 喜欢 OO。如果跟踪一个方法会带您完成 5-10 个不同的类，请不要感到惊讶。

[在此处](http://www.magentocommerce.com/design_guide)阅读设计师指南。它主要适用于图形设计师，但您*需要*它来了解模块输出的位置和原因。为此，不要忘记在管理面板的开发人员部分中打开“模板路径提示”。

还有更多，但在这变成一篇论文之前我会在这里停下来。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-06-27T14:55:32.787

我宁愿推荐[Mage2Gen](https://mage2gen.com/)，这将帮助您生成样板，您可以只专注于核心业务逻辑。它只是有助于加快速度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-11-20T14:36:11.830

Magento 模块是一组目录，其中包含创建特定商店功能所需的块、控制器、助手和模型。它是 Magento 平台中的定制单元。可以创建 Magento 模块来执行具有支持逻辑的多种功能，以影响用户体验和店面外观。它有一个生命周期，允许它们被安装、删除或禁用。从商家和扩展开发者的角度来看，模块是 Magento 平台的核心单元。

**模块声明**

我们必须使用配置文件来声明模块。作为 Magento 2 在模块的 etc 目录中搜索配置模块。所以现在我们将创建配置文件 module.xml。

代码将如下所示：

```
<?xml version="1.0"?> <config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:Module/etc/module.xsd"> <module name="Cloudways_Mymodule" setup_version="1.0.0"></module> </config> 
```

**模块注册** 该模块必须在 Magento 2 系统中使用 Magento Component Registrar 类进行注册。现在我们将在模块根目录中创建文件registration.php：

```
app/code/Cloudways/Mymodule/registration.php 
```

代码将如下所示：

```
?php
\Magento\Framework\Component\ComponentRegistrar::register(
\Magento\Framework\Component\ComponentRegistrar::MODULE,
'Cloudways_Mymodule',
__DIR__
); 
```

**检查模块状态** 按照上述步骤，我们将创建一个简单的模块。现在我们将使用以下命令行检查模块的状态以及它是启用还是禁用：

```
php bin/magento module:status

php bin/magento module:enable Cloudways_Mymodule 
```

完成整个过程后分享您的反馈

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-09-03T07:36:58.373

我试图从 magaplaza hello world 教程中制作我的模块，但是出了点问题。我从 github导入了这个模块的代码[https://github.com/astorm/magento2-hello-world并且它有效。](https://github.com/astorm/magento2-hello-world)从该模块中，我创建了一个类别子类别 ajax 选择下拉模块。将其安装在 magento2 安装的 aap/code 目录后，请按照此 URL.. [http://www.example.com/hello_mvvm/hello/world](http://www.example.com/hello_mvvm/hello/world) 您可以从这里下载其代码[https://github.com/sanaullahAhmad/Magento2_cat_subcat_ajax_select_dropdowns](https://github.com/sanaullahAhmad/Magento2_cat_subcat_ajax_select_dropdowns) 并将其放在您的 aap/code 文件夹中。比运行这些命令...

```
php bin/magento setup:update
php bin/magento setup:static-content:deploy -f
php bin/magento c:c 
```

现在您可以使用以下 URL http://{{www.example.com}}/hello_mvvm/hello/world 检查模块功能

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-01-05T13:23:19.940

和，

我建议你了解系统配置。

[如何在系统配置字段中显示所有类别？](https://www.magentoexpertise.in/show-categories-on-system-configuration/)

在这里，我用一个很好的例子解决了。它工作。您可以检查和学习代码流。

还有其他太多的例子你应该学习。

# java - 每次我使用 .put() 时，HashMap 都会被覆盖

> ID：576912
> 
> 赞同：1
> 
> 时间：2009-02-23T08:38:02.783
> 
> 标签：java, hashmap

我的申请与股票市场有关。我有一个持续更新名为 Price 的对象的提要。Price 有一个 HashMap，用于存储安全代码（String）和价格（Double）。每次出现新价格时，此对象都会更新。

该应用程序应该扫描价格的大动作。我有一个名为 Poller 的单独类，它每秒轮询 Price 对象并拍摄价格快照。快照是如上所述的 HashMap。然后，我想将这个价格的 HashMap 与 pollNumber 一起存储在另一个 HashMap 中，我稍后可以传递 pollNumber 并在对应于该 pollNumber 的时间获取价格。

但相反，我得到了所有以前的价格被覆盖并输出类似于下面的。

0：{MSFT=17.67，AAPL=93.85，GOOG=333.86} {0={MSFT=17.67，AAPL=93.85，GOOG=333.86}}

1 : {MSFT=17.64, AAPL=93.85, GOOG=334.02} {0={MSFT=17.64, AAPL=93.85, GOOG=334.02}, 1={MSFT=17.64, AAPL=93.85, GOOG=334.02}}

2 : {MSFT=17.64, AAPL=93.85, GOOG=334.08} {0={MSFT=17.64, AAPL=93.85, GOOG=334.08}, 1={MSFT=17.64, AAPL=93.85, GOOG=334.08}, 2= {微软=17.64，苹果=93.85，谷歌=334.08}}

3 : {MSFT=17.65, AAPL=93.83, GOOG=334.08} {0={MSFT=17.65, AAPL=93.83, GOOG=334.08}, 1={MSFT=17.65, AAPL=93.83, GOOG=334.08}, 2= {MSFT=17.65, AAPL=93.83, GOOG=334.08}, 3={MSFT=17.65, AAPL=93.83, GOOG=334.08}}

4 : {MSFT=17.64, AAPL=93.83, GOOG=334.07} {0={MSFT=17.64, AAPL=93.83, GOOG=334.07}, 1={MSFT=17.64, AAPL=93.83, GOOG=334.07}, 2= {MSFT=17.64, AAPL=93.83, GOOG=334.07}, 3={MSFT=17.64, AAPL=93.83, GOOG=334.07}, 4={MSFT=17.64, AAPL=93.83, GOOG=334.07}}

正如您所看到的，当我打印应该具有不同价格系列的整个 HashMap 时，它们都是相同的。

基本上 .put() 函数以某种方式覆盖旧条目。

如果您知道如何修复该行为，以便 HashMap（大的）每次都有一个新的价格序列条目。

* * *

```
public class Poller {

    private final int period=1000;
    private final int delay=1000;

    private static int pollNumber=0;
    private static HashMap<Integer,HashMap<String,Double>> 
        polledPrice = new HashMap<Integer, HashMap<String,Double>>();

    public void pollPrice(){

    Timer timer = new Timer();
    timer.scheduleAtFixedRate(new TimerTask() {
                public void run() {
                //    System.out.println(Price.getPricesMap());
System.out.println(pollNumber+" : "+Price.getPricesMap());
                    polledPrice.put(pollNumber, Price.getPricesMap());
                    System.out.println(polledPrice);
                    pollNumber = pollNumber+1;

                    Time atime = new Time();
                        atime.addToTimeMap(pollNumber);

                }
            }, delay, period);
    }
} 
```

* * *

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T08:42:01.463

您需要获取 HashMap 的副本，否则看起来您只是一遍又一遍地存储相同的 Map，这当然会被覆盖。使用这一行：

```
polledPrice.put(pollNumber, new HashMap(Price.getPricesMap())); 
```

作为最简单的修复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T09:34:22.803

问题是`Price.getPricesMap()`每次都返回对同一个对象的引用。对我来说，这听起来像是一个糟糕的 API 设计——或者至少应该记录一个。

它可以通过在客户端代码中制作副本（[如 Nick Fortescue 所建议的](https://stackoverflow.com/questions/576912/hashmap-gets-over-written-every-time-i-use-put/576916#576916)）或通过更改来修复`Price`。后者可以在每次发生实际更改时创建一个不可变映射，或者在每次调用时返回一个副本`getPricesMap()`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T08:45:55.523

您真的需要每秒轮询您拥有的服务吗？这对我来说听起来有点像虐待。您应该在每次轮询之间至少等待 5-10 秒，尤其是在这涉及请求 Web 资源时。我认为尼克给了你一个足够好的答案，但过度投票是邪恶的！不要这样做。

# java - 如何拦截具有标准 Java 功能（无 AspectJ 等）的方法调用？

> ID：576918
> 
> 赞同：23
> 
> 时间：2009-02-23T08:43:33.127
> 
> 标签：java, reflection, methods

我想拦截对某个类 MyClass 的所有方法调用，以便能够对某些 setter 调用做出反应。

我尝试使用动态代理，但据我所知，这仅适用于实现某些接口的类。但是 MyClass 没有这样的接口。

除了实现一个包装类之外，还有其他方法可以将所有调用委托给一个成员，该成员是 MyClass 的一个实例，还是使用 AOP？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-23T10:11:58.827

正如您所注意到的，您不能使用 JDK 动态代理（无接口），但使用[Spring](http://static.springframework.org/spring/docs/2.5.x/reference/aop.html)和 CGLIB（JAR 包含在 Spring 中），您可以执行以下操作：

```
public class Foo
{
    public void setBar()
    {
        throw new UnsupportedOperationException("should not go here");
    }

    public void redirected()
    {
        System.out.println("Yiha");
    }
}

Foo foo = new Foo();
ProxyFactory pf = new ProxyFactory(foo);

pf.addAdvice(new MethodInterceptor()
{
    public Object invoke(MethodInvocation mi) throws Throwable
    {
        if (mi.getMethod().getName().startsWith("set"))
        {
            Method redirect = mi.getThis().getClass().getMethod("redirected");
            redirect.invoke(mi.getThis());
        }
        return null;
    }
});

Foo proxy = (Foo) pf.getProxy();
proxy.setBar(); // prints "Yiha" 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-23T08:47:21.853

如果您准备做一些非常丑陋的事情，请查看：

[http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/](http://docs.oracle.com/javase/7/docs/technotes/guides/jpda/)

基本上，调试器接口应该允许您像调试器一样附加，从而拦截调用。请记住，我认为这是一个**非常**糟糕的主意，但您问是否可能。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T08:55:51.147

Java 没有任何用于方法拦截的实际语言功能（不确定是否有任何静态语言）

我有点喜欢 Nick 使用调试器接口的想法，这很刻薄。

我认为您需要的简短回答是：不，没有办法在不使用代理或包装器实际替换类的情况下拦截 Java 中的方法调用。

注意：AOP 库只是自动实现这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T09:26:15.223

一些 Java 大师可能对此不屑一顾，但我在完全避免原始类型和 setter 方面取得了一些成功。我的课看起来像这样：

```
class Employee extends SmartPojo {
    public SmartString name;
    public SmartInt age;
} 
```

你会注意到两件事： 1\. 一切都是公开的。2.没有构造函数。

魔法发生在 SmartPojo 中，它搜索实现“智能”接口的任何字段并对其进行初始化。由于这不是原始类（也不是最终类），因此我可以*在一个地方为模型中任何位置的所有字段*添加 set() 和 get() 方法。所以不再浪费 setter/getter，添加通知（也在一个地方）等非常简单。

诚然，这不再是 POJO，而且在大多数方面它都不是 Bean，但我发现这些旧想法对我的限制大于它们的帮助。YMMV。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-21T10:48:06.883

我只是为此目的开发了一个小框架。您可以在以下位置查看：[http](http://code.google.com/p/java-interceptor/) ://code.google.com/p/java-interceptor/ （使用 svn 进行查看）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-23T08:55:47.373

AspectJ 中没有太多魔法。您可以编写自己的代理。[http://java.sun.com/javase/6/docs/api/java/lang/instrument/package-summary.html](http://java.sun.com/javase/6/docs/api/java/lang/instrument/package-summary.html)似乎是一个很好的起点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T09:29:30.630

1.  为什么你的类不能实现接口？您可以从中提取一些接口，其中包含您想要拦截的所有方法并轻松使用动态代理机制。使用接口而不是类进行编码也是一种很好的编程习惯。

2.  您可以使用带有 Spring AOP 功能（内部使用动态代理）的 Spring 框架来执行此操作。您只需在配置文件中将您的类定义为 Spring bean，您的类的客户端必须要么从 Spring 应用程序上下文中获取其实例，要么自动作为依赖项（例如通过定义 setMyClass(MyClass mc) 方法） ）。从那里您可以轻松地定义一个切入该类的所有方法调用的切面。

# c# - WCF OperationContract 和 Nhibernate ICriteria

> ID：576919
> 
> 赞同：2
> 
> 时间：2009-02-23T08:43:34.610
> 
> 标签：c#, wcf, nhibernate, api, data-access-layer

我们正在尝试使用 WCF 和 ICriteria 创建一个很酷的 API，例如：

```
[ServiceContract]
public class ProductService
{
[OperationContract]
public List<Product> Get()

[OperationContract]
public List<Product> GetByCriteria(Criteria criteria)

} 
```

我们正在考虑使用 DetachedCriteria，以便任何人都可以发送它，我们将它连接到服务中的会话，以便在我们的数据库前面运行查询。

有没有人创建这样的 API？我们应该使用 Nhibernate 的 ICriteria 吗？还有其他很酷的想法吗？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T08:50:14.750

这不是很酷的 API。它是面向对象的，而不是面向服务的。而且它不会起作用。

您必须使用 KnownTypeAttribute（或 ServiceKnownTypeAttribute）进行多态查询。（见[这个](https://stackoverflow.com/questions/416457/wcf-contract-returning-interface-could-cause-serialization-issue/421657)问题）。

这也不是很优雅的解决方案，我不鼓励你这样做。在服务世界中要明确。

# asp.net - 天气、汇率和其他信息

> ID：576926
> 
> 赞同：2
> 
> 时间：2009-02-23T08:46:36.803
> 
> 标签：asp.net, web-services, widget, weather, add-on

我正在建立一个房地产网站，我想在主页上包含一些关于当前天气、温度、湿度等的详细信息。我可能还想包含一些汇率。

这一切都应该是最新的和最新的，我知道我可以使用需要零编码的插件或附加组件。我只是不知道该用什么。

有什么建议吗？

PS：虽然这可能不相关，但我使用的是 ASP.net 3.5 和 VB.net。

我正在寻找关于塞浦路斯的天气信息（具体是塞浦路斯北部）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T08:49:42.427

你可能想看看雅虎的：http: [//developer.yahoo.com/weather/](http://developer.yahoo.com/weather/)

[http://developer.yahoo.com/dotnet/](http://developer.yahoo.com/dotnet/)有教程，您也许可以使用他们的金融 API 进行 FX

[在这个（几乎重复的）问题](https://stackoverflow.com/questions/507441/best-weather-apis)的答案中有更多的链接。

# hardware - 硬件模拟

> ID：576930
> 
> 赞同：5
> 
> 时间：2009-02-23T08:48:09.967
> 
> 标签：hardware, emulation

我正在开发一个旨在恢复旧的特定硬件的软件项目，主要用于非营利组织和贫困学校。

我需要一种模拟旧硬件的方法，这样我就可以在发货之前测试应用程序。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T08:51:41.237

我不确定这个问题到底要问什么。我认为您是在寻求一种模拟某些硬件的方法？

如果是这样的话，我过去使用过[QEMU](http://wiki.qemu.org/Index.html)，而且效果很好。QEMU 是一个开源机器模拟器和虚拟器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T08:52:09.847

使用[虚拟机](http://en.wikipedia.org/wiki/Virtual_machine)？准备反映（或多或少）目标机器状态（速度、硬件等）的图像。并使用它们来测试部署？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T08:51:40.160

您可能想查看[Emulator Zone](http://www.emulator-zone.com/)，而 emulator 是您可能没有尝试过的一个很好的谷歌搜索词。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T08:53:39.843

好。如果旧硬件通过 RS232 进行通信，则编写一个包装 RS232 命令的类，并使该类注入旧硬件将响应的消息。在您的程序中，针对该类而不是真正的 rs232 端口工作，并在发货前将实例更改为真正的 rs232。

我在一个项目中成功地做到了这一点，它的效果非常好，而且没有你想象的那么复杂。

# python - 如何在 python 调用 SQLite 中通过名称引用列？

> ID：576933
> 
> 赞同：17
> 
> 时间：2009-02-23T08:50:12.003
> 
> 标签：python, sqlite

我有一些用于查询 MySQL 的代码，我希望将它与 SQLite 一起使用。我真正的希望是这不会涉及对代码进行太多更改。不幸的是，以下代码不适用于 SQLite：

```
cursor.execute(query)

rows = cursor.fetchall()

data = []
for row in rows
  data.append(row["column_name"]) 
```

这给出了以下错误：

```
 TypeError: tuple indices must be integers 
```

而如果我将引用更改为使用列号，它可以正常工作：

```
 data.append(row[1]) 
```

我可以以可以通过名称引用列的方式执行查询吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2013-11-18T07:27:11.817

自从提出问题并回答问题以来的五年中，出现了一个非常简单的解决方案。任何新代码都可以简单地用行工厂包装连接对象。代码示例：

```
import sqlite3

conn = sqlite3.connect('./someFile')
conn.row_factory = sqlite3.Row        // Here's the magic!

cursor = conn.execute("SELECT name, age FROM someTable")
for row in cursor:
    print(row['name']) 
```

这里有一些[很好的文档](http://docs.python.org/2/library/sqlite3.html#accessing-columns-by-name-instead-of-by-index)。享受！

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-23T09:25:44.557

要按名称访问列，请使用[`row_factory`](http://oss.itsystementwicklung.de/download/pysqlite/doc/sqlite3.html#sqlite3.Connection.row_factory)Connection 实例的属性。`cursor`它允许您设置一个接受参数和的函数`row`，并返回您想要的任何内容。pysqlite 有一些内置功能，即`sqlite3.Row`，它可以满足您的要求。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-23T09:01:05.893

我不确定这是否是最好的方法，但这是我通常使用 DB-API 2 兼容模块检索记录集的方法：

```
cursor.execute("""SELECT foo, bar, baz, quux FROM table WHERE id = %s;""", 
                  (interesting_record_id,))

for foo, bar, baz, quux in cursor.fetchall():
    frobnicate(foo + bar, baz * quux) 
```

查询格式化方法是 DB-API 标准之一，但恰好是 Psycopg2 的首选方法；其他 DB-API 适配器可能会建议一个不同的约定，这很好。

编写这样的查询，其中隐式元组解包用于处理结果集，通常对我来说比试图担心将 Python 变量名与 SQL 列名匹配（我通常只用它来删除前缀，然后仅当我使用列名的子集时，前缀不再有助于澄清事情），并且比记住数字列 ID 要好得多*。*

这种风格还可以帮助您避免`SELECT * FROM table...`，这对于除了最简单的表和查询之外的任何东西来说都是一场维护灾难。

因此，不完全是您所要求的答案，但可能仍然具有启发性。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-08-17T21:00:19.063

这可以通过在“connect”语句后添加一行来完成：

```
conn.row_factory = sqlite3.Row 
```

在此处查看文档：http: [//docs.python.org/library/sqlite3.html#accessing-columns-by-name-instead-of-by-index](http://docs.python.org/library/sqlite3.html#accessing-columns-by-name-instead-of-by-index)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-26T06:59:46.067

kushal 对[这个论坛](http://www.gossamer-threads.com/lists/python/python/755969)的回答很好：

> 使用字典光标：

```
import MySQLdb.cursors

.
.
.
cursor = db.cursor (MySQLdb.cursors.DictCursor)
cursor.execute (query)
rows = cursor.fetchall ()

for row in rows:
print row['employee_id'] 
```

请注意，列名区分大小写。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T15:06:27.683

SQLite API 支持 cursor.description 所以你可以很容易地做到这一点

```
headers = {}
for record in cursor.fetchall():
    if not headers:
        headers = dict((desc[0], idx) for idx,desc in cursor.description))
    data.append(record[headers['column_name']]) 
```

有点啰嗦，但可以完成工作。我注意到他们甚至在 dict_factory 下的 factory.py 文件中有它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-11-11T13:37:53.380

使用光标描述，如下所示：

```
rows = c.fetchall()
for row in rows:
    for col_i, col in enumerate(row):   
        print("Attribute: {0:30} Value: {1}".format(c.description[col_i][0],col)) 
```

# java - 在 weblogic 9/10 中使用 log4j 登录

> ID：576937
> 
> 赞同：5
> 
> 时间：2009-02-23T08:52:04.603
> 
> 标签：java, logging, log4j, weblogic

在 weblogic 中，我可以在控制台中配置 Serverlog 以使用 log4j 而不是默认的 JDK 日志记录。

但是，serverlog 没有使用 log4j.properties 文件，但似乎使用了 config.xml 中的配置，即使 log4j.properties 文件位于类路径中并且我设置了这些属性：

```
set JAVA_OPTIONS=%JAVA_OPTIONS% -Dlog4j.configuration=file:<path>/log4j.properties
set JAVA_OPTIONS=%JAVA_OPTIONS% -Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger   
set JAVA_OPTIONS=%JAVA_OPTIONS% -Dweblogic.log.Log4jLoggingEnabled=true 
```

是否可以为 Weblogic Server Logging 使用 log4j.properties 配置，还是只能使用 java 代码更改 log4j 配置？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-04T14:13:42.447

我对 WebLogic 一无所知，但是添加`-Dlog4j.debug`会导致 log4j 告诉您它在哪里寻找它的配置。我发现在之前跟踪 tomcat 中的日志记录问题时，这是非常宝贵的。

有关 log4j 配置过程的详细信息，请查看[PropertyConfigurator](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PropertyConfigurator.html)和[DOMConfigurator的文档。](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/xml/DOMConfigurator.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T13:31:00.440

如果您将 log4j.xml 放在类路径中，WebLogic 会选择它。我在 WebLogic 中使用带有 log4j 的 Apache Commons 日志记录，这很容易做到。不需要那些 Java 选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-25T15:10:04.650

您在哪里设置上述选项？尝试将 -Dlog4j 选项放在将使用 log4j 的每个托管服务器的服务器启动选项中

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-03T13:06:49.107

要指定日志记录到 Log4j 记录器而不是默认的 Java 日志记录：

```
* When you start the Administration Server, include the following Java option in the weblogic.Server command:

  -Dweblogic.log.Log4jLoggingEnabled=true 
```

来自： [http ://edocs.bea.com/wls/docs103/logging/config_logs.html#wp1014610](http://edocs.bea.com/wls/docs103/logging/config_logs.html#wp1014610)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-21T21:15:43.693

我从来没有按照我的意图完成这项工作。

我最终所做的是创建某种解决方法。我注册了一个监听 Weblogic serverlog 的处理程序。从这个处理程序中，我将自己的日志记录到 log4j。该日志记录可以重定向到做任何我想做的事情。

创建一个自定义 logHandler：

```
public class CustomLogHandler extends Handler {
..

    public CustomLogHandler () throws SecurityException, IOException,
            NamingException {

        String log4jConfig = LogFilterConfiguration.getLog4jDirectory();
        classlogger.info("log4j configured for file"+ log4jConfig );
        PropertyConfigurator.configure(log4jConfig);
        logFilterConfiguration = new LogFilterConfiguration();
    }

    public void publish(LogRecord record) {
        WLLogRecord rec = (WLLogRecord) record;
        if (!isLoggable(rec))
            return;
        if (getLoggerName().. is something i want to log) {
                        // do my own log4j logging
                  } 
```

然后创建一个 ApplicationLifecycleListener。使用 postStart 方法：

```
public void postStart(ApplicationLifecycleEvent evt) {
    Logger logger = LoggingHelper.getServerLogger();
    Handler oldHandler = null;
    Handler[] currentHandlers = logger.getHandlers();

              .. code to remove an old custom handler if exists...
    with something like logger.removeHandler(oldHandler);

    // add custom handler to serverlogger.
    CustomLogHandler h = null;      
    try {
        h = new CustomLogHandler ();
        // If handler was removed we can add a new version.
        if (!(unRemovedHandlerClasses.contains(h.getClass()))){
            logger.addHandler(h);
            registerMBean(h) ;
        }
    } catch (Exception nmex) {
    classLogger.error("Error adding CustomLogHandler to serverlogger "
                + nmex.getMessage());
        logger.removeHandler(h);
    }

} 
```

# php - 如何设计短信服务？

> ID：576940
> 
> 赞同：1
> 
> 时间：2009-02-23T08:53:45.787
> 
> 标签：php, python, sms, mobile-phones, bulksms

我想设计一个可以发送和接收短信的网站。

1.  我应该如何解决这个问题？
2.  有哪些可用资源？
3.  我知道 php,python 我还需要什么或者有更好的选择吗？
4.  如何仅使用我的电脑进行实验？[类似于 localhost]
5.  有什么好的托管服务呢？[编辑这个]
6.  [添加更多你能想到的问题？]

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-23T09:04:35.730

你可以看看[Kannel](http://www.kannel.org)。使用它创建 SMS 服务非常简单。只需定义一个关键字，然后输入传入的 SMS 请求将被路由到的 URL（您将在查询字符串参数中获得手机号码和 SMS 文本等信息），然后是您的 Web 脚本生成的任何输出（您可以使用任何网络脚本/语言/平台）将被发送回发件人。

测试很简单。您可以使用自己的 PC，只需使用 fakesmsc“短信中心”并发送 HTTP 请求即可。如果你有一个 GSM 调制解调器，你也可以使用它，利用调制解调器的 AT 命令集。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T09:25:06.867

首先，您需要注册一个帐户（短信网关），其中大多数还为您提供了如何使用其 API 发送和接收短信的示例代码。然后，您将围绕您的站点逻辑包装短信功能。

例如[http://www.clickatell.com/developers/php.php](http://www.clickatell.com/developers/php.php)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T11:38:17.327

我已经从我给出的关于[这个问题的](https://stackoverflow.com/questions/432944/sms-from-web-application/)[答案](https://stackoverflow.com/questions/432944/sms-from-web-application/433020#433020)中复制了这个。然而，除了下面的文字，看看[Wadja 的 SMS Gateway](http://sms.wadja.com/)交易（[API 链接](http://wadja.com/api)）......它们目前似乎是一个非常好的选择，尽管我个人没有使用它们。

> 您发送 SMS 消息的主要选项是使用现有的 SMS 提供商。根据我的经验（这在 SMS 消息传递 Web 应用程序中很广泛），您经常会发现与不同的提供商进行谈判是为您的应用程序获得最佳交易的最佳方式。
> 
> 不同的提供商通常提供不同的服务和不同的功能。我最喜欢的供应商，事实上，过去曾愉快地与我协商降低费率的供应商是 TM4B ( [http://www.tm4b.com](http://www.tm4b.com) )。这些家伙价格优惠，覆盖全球大部分地区，并拥有出色的客户服务。
> 
> 下面是从我的一个实时 Web 应用程序中提取的一些代码（以及一些被混淆的部分），用于通过他们的 API 发送一条简单的消息：

```
require_once("tm4b.lib.php");
$smsEngine = new tm4b();

// Prepare the array for sending
$smsRequest["username"] = "YOURUNAME";
$smsRequest["password"] = "YOURPWORD";
$smsRequest["to"] = "+441234554443";
$smsRequest["from"] = "ME!";
$smsRequest["msg"] = "Hello, test message!";

// Do the actual sending
$smsResult = $smsEngine->ClientAPI($smsRequest);

// Check the result
if( $smsResult['status'] == "ok" ) {
    print "Message sent!";
} else {
    print "Message not sent.";
} 
```

> 我过去使用过的许多其他提供商都有非常相似的界面，而且在定价方面都非常具有竞争力。您只需四处寻找适合您需求的提供商。
> 
> 在成本方面，大多数西方国家的价格从几便士/美分不等（不过，大多数第三世界国家的价格略高，所以要小心）。如果您想从他们那里获得体面的价格，您将不得不批量支付大多数供应商，但他们通常会与您协商“比平常少”的批次。大多数提供商确实提供后付款选项，但只有当您成功完成与他们的一些交易时......其他人从一开始就提供它，但价格过高。

希望能帮助到你！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T08:55:54.860

你需要一个短信服务器。[这](http://www.ozeki.hu/)应该让你开始。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-23T11:32:17.607

由于我的公司有时会这样做（文字促销等，尽管我们的主要关注点是低得多的东西），所以我认为我应该参与其中。

到目前为止，最简单的方法是使用诸如[Clickatell](http://www.clickatell.com)之类的服务，它提供 HTTP API，以及 FTP 和[SMPP](http://en.wikipedia.org/wiki/SMPP)等。但是，我不知道 Clickatell 如何处理接收消息，因为我们为此使用直接 SMPP 绑定到本地移动运营商。

如果您愿意为此付费，您应该能够将 SMPP 绑定到您当地的移动运营商，但它通常很昂贵。这也将允许您购买自己的[简码](http://en.wikipedia.org/wiki/Short_code)。

您可能还想看看[mBlox](http://www.mblox.com/)或[Nextcell](http://netxcell.com/bulk_sms_gateway.html)。一个快速的[谷歌搜索](http://www.google.com/?q=sms+gateway+provider)会出现更多。

您还可以购买一个 GSM 调制解调器，它可以让您像平常使用手机一样发送和接收消息，但通过 PC 除外。这通常意味着您将使用手机支付任何费用。（无论如何在爱尔兰）

# reporting - BIRT：表组中的交替行颜色

> ID：576941
> 
> 赞同：13
> 
> 时间：2009-02-23T08:54:25.690
> 
> 标签：reporting, birt

有没有人知道突出显示条件的外观如何，以便在组中创建交替行？我希望具有偶数个表组（而不是整个表）的每一行都有不同的颜色。

提前致谢！:-)

帕特里克

PS：我使用的是 BIRT 2.1.3

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-23T10:13:29.120

像这样向行添加突出显示：

```
row[0] % 2 Equals 0 
```

这是有效的，因为 row 是当前行，而 row[0] 是行号。row[1]、row[2] 等是当前行的数据值。

（来源：[http](http://dev.eclipse.org/newslists/news.eclipse.birt/msg03977.html) ://dev.eclipse.org/newslists/news.eclipse.birt/msg03977.html ）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-03-02T12:16:33.733

对于 Birt 2.3 报告

从大纲视图中单击表格。在属性编辑器上，单击突出显示选项卡。单击添加。您将看到三个下拉菜单。只需在第一个下拉菜单中输入 row.__rownum % 2 即可。从第二个中选择等于，然后在第三个中键入 0。然后，您将行的背景颜色设置为您最想要的任何颜色，我使用银色。

点击确定，仅此而已。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T19:03:08.340

Total.runningCount()%2 等于 0

# html - 正则表达式读出 HTML 标签

> ID：576943
> 
> 赞同：-1
> 
> 时间：2009-02-23T08:55:06.487
> 
> 标签：html, regex, tags

我正在寻找一个匹配由多行组成的文本中所有使用的 HTML 标记的正则表达式。它应该在以下几行中读出“b”、“p”和“script”：

```
<b>
<p class="normalText">
<script type="text/javascript"> 
```

有这种事吗？我的开始是它应该以“<”开头并阅读直到它遇到空格或“>”，但同时，它不应该包括开头的“<”，因为我只想匹配字母/单词本身。想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-23T09:08:31.430

SO上有很多类似的问题：

1.  [过滤掉 HTML 标签并解析 python 中的实体](https://stackoverflow.com/questions/37486/filter-out-html-tags-and-resolve-entities-in-python)
2.  [正则表达式匹配除 <p> 和 </p> 之外的所有 HTML 标记](https://stackoverflow.com/questions/29869/regex-to-match-all-html-tags-except-p-and-p)
3.  [去除除链接之外的所有 HTML 标签](https://stackoverflow.com/questions/44078/strip-all-html-tags-except-links)

等等。一般的协议是最好不要使用正则表达式来解析 HTML，而是通过应用 DOM 解析器并遍历 DOM 树来正确地进行解析。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T09:16:38.820

一旦您开始考虑浏览器有时很乐意解析的所有特殊情况和格式错误的 HTML，就几乎不可能对 HTML 进行正则表达式。尽管如此，我认为在不使用捕获组的情况下获取名称可能会很有趣，因此我也向您提供以下解决方案：

```
(?<=<)\w+(?=[^<]*?>) 
```

作为记录，我几乎不相信它在任何情况下都没有用，除了最微不足道的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T08:58:04.730

不知道你用的是什么系统，但在一定程度上是可以做到的。看看[这个](http://ryanswanson.com/regexp/#start)基于 flex 的在线应用程序。查看已发布 > XML 正则表达式示例。你会有一个想法。

# groovy - 动态调用静态方法的 Groovy 方式

> ID：576955
> 
> 赞同：27
> 
> 时间：2009-02-23T09:01:38.170
> 
> 标签：groovy

我知道在 Groovy 中，您可以使用字符串调用类/对象的方法。例如：

```
Foo."get"(1)
  /* or */
String meth = "get"
Foo."$meth"(1) 
```

有没有办法在课堂上做到这一点？我将类的名称作为字符串，并希望能够动态调用该类。例如，希望执行以下操作：

```
String clazz = "Foo"
"$clazz".get(1) 
```

我想我错过了一些非常明显的东西，只是无法弄清楚。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-23T23:54:45.793

正如 Guillaume Laforge 在 Groovy ML 上所建议的那样，

```
("Foo" as Class).get(i) 
```

会给出相同的结果。

我用这段代码测试过：

```
def name = "java.lang.Integer"
def s = ("$name" as Class).parseInt("10")
println s 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-23T13:28:47.840

试试这个：

```
def cl = Class.forName("org.package.Foo")
cl.get(1) 
```

有点长，但应该工作。

如果您想为静态方法创建类似“开关”的代码，我建议实例化类（即使它们只有静态方法）并将实例保存在映射中。然后你可以使用

```
map[name].get(1) 
```

选择其中之一。

**[EDIT]** `"$name"`是`GString`一个有效的陈述。`"$name".foo()`意思是“调用`foo()`类的方法`GString`。

**[EDIT2]**使用 Web 容器（如 Grails）时，您必须指定类加载器。有两种选择：

```
Class.forName("com.acme.MyClass", true, Thread.currentThread().contextClassLoader) 
```

或者

```
Class.forName("com.acme.MyClass", true, getClass().classLoader) 
```

第一个选项仅适用于 Web 上下文，第二种方法也适用于单元测试。这取决于您通常可以使用与调用的类相同的类加载器这一事实`forName()`。

如果您有问题，请使用第一个选项并`contextClassLoader`在您的单元测试中设置：

```
def orig = Thread.currentThread().contextClassLoader
try {
    Thread.currentThread().contextClassLoader = getClass().classLoader

    ... test ...
} finally {
    Thread.currentThread().contextClassLoader = orig
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-12-29T07:18:10.753

对 Chanwit 的回答的扩充说明了实例的创建：

```
def dateClass = 'java.util.Date' as Class
def date = dateClass.newInstance()
println date 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-08-13T21:49:17.760

这是另一种方式

```
import org.codehaus.groovy.grails.commons.ApplicationHolder as AH

def target = application.domainClasses.find{it.name == 'ClassName'}
target.clazz.invokeMethod("Method",args) 
```

有了这个，你不需要指定包名。如果您在两个不同的包中具有相同的类名，请小心。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-26T18:08:28.273

不久前，Groovy ML 上的 Melix 为我指出了动态类方法调用的“正确”方向，非常有用：

```
// define in script (not object) scope  
def loader = this.getClass().getClassLoader()

// place this in some MetaUtils class, invoked on app startup  
String.metaClass.toClass = {  
    def classPath = getPath(delegate) // your method logic to determine 'path.to.class'
    Class.forName(classPath, true, this.loader)  
}

// then, anywhere in your app  
"Foo".toClass().bar() 
```

您也可以创建另一个字符串 metaClass 方法来创建实例，并根据需要进行重构：

```
String.metaClass.toObject = {  
    def classPath = getPath(delegate)  
    Class.forName(classPath, true, this.loader).newInstance()  
} 
```

Groovy 很有趣；--)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-01-18T23:37:13.053

我正在运行 1.8.8 版 groovy ......并且简单的示例有效。

```
Import my.Foo
def myFx="myMethodToCall"
def myArg = 12

Foo."$myFx"(myArg) 
```

按预期和期望调用 Foo.myMethodToCall(12)。我不知道这是否一直都是这样。

# python - Python 代码混淆

> ID：576963
> 
> 赞同：39
> 
> 时间：2009-02-23T09:08:05.097
> 
> 标签：python, obfuscation

你知道任何可以帮助我混淆python代码的工具吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-23T10:29:49.893

您的问题空间未指定。这是用于命令行应用程序吗？这段代码应该用作库吗？

除了其他两个答案之外，您还可以将代码嵌入到二进制文件中。当它启动时，解码代码并评估字符串。这也适用于共享库扩展。我认为你也可以使用字节码来做到这一点，但它不会像调用 Py_EvalCode 那样简单。

py2exe 或 freeze 是其他解决方案，可将代码转换为可执行文件。它只是将代码包含在二进制文件中，并没有做任何严重的混淆，但它仍然比打开 .py 文件更难。

你可以用 Cython 编写代码，它类似于 Python，用 C 编写 Python 扩展文件，用作 .so。这可能是逆向工程中最难的，并且仍然为您提供用于开发的高级语言。

它们都是可破解的，所有解决方案也是如此。你想要它有多难？

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-23T09:10:54.590

[http://www.lysator.liu.se/~astrand/projects/pyobfuscate/](http://www.lysator.liu.se/~astrand/projects/pyobfuscate/)

或在[http://freshmeat.net/projects/pyobfuscate/](http://freshmeat.net/projects/pyobfuscate/)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-12-08T10:10:05.727

我实际上发现了一个非常好的项目，它基本上将 Python 转换为 C++ 并创建了一个二进制的、静态链接的文件。

看看这个：[http ://www.nuitka.net/](http://www.nuitka.net/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-23T09:53:42.583

在许多情况下，您可以发送字节编译的 .pyc 文件而不是 .py 源文件。这给了你一定程度的混淆。正如 pyobfuscate README 所暗示的，这有局限性。但是您也许可以将这两种方法结合起来。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-01-21T22:22:15.680

Python 的标准库包括[compileall.py](http://pyfaq.infogami.com/how-do-i-create-a-pyc-file)。您可以在目录上运行它，它将为您的所有源文件生成 .pyc 文件。.pyc 文件将仅包含字节码和文档字符串，并将删除所有注释。然后，您可以复制此目录，然后运行类似`rm -rf $(find . -name .py)`删除原始源文件的操作。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-08-29T16:31:36.030

最好的办法是使用[Shed Skin](http://code.google.com/p/shedskin/)进行编译，这是一个实验性的 Python-to-C++ 编译器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-08-09T16:37:08.773

尽管它不进行混淆，但这个[Python 配方](http://code.activestate.com/recipes/576704/)非常适合最小化 Python 代码的大小，包括去除注释。

# wpf - 有人知道一个简单的 WPF/Silverlight 数据访问框架吗？

> ID：576964
> 
> 赞同：0
> 
> 时间：2009-02-23T09:08:30.447
> 
> 标签：wpf, silverlight, data-access

有谁知道一个简单的 WPF 或 Silverlight 框架，它使您能够例如在 SQL Server 紧凑型数据库中定义一些数据库表，然后该框架自动创建允许用户登录和编辑该数据的 Window 类等？

我不是在寻找复杂的 MVVM 模式示例，它可以是硬编码的，它应该只是节省开发人员创建所有 CRUD 代码和表单以及用户编辑数据所需的授权的时间。开发人员可以定义 10 个数据库表，运行代码生成，然后几乎 80% 完成了他想要制作的任何简单的数据库应用程序。

所有这些都是通用代码，所以我认为这样的框架会存在，或者有人已经在从事这样的开源项目。

有谁知道这样的框架或工具？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-23T09:23:13.780

也许你应该看看[Sculpture](http://www.codeplex.com/Sculpture)项目。可能有你正在寻找的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T10:06:50.510

它不是 Silverlight，但[ASP.NET 动态数据](http://www.asp.net/dynamicdata/)听起来会满足您的要求。它为编辑数据库表提供了一个基于 Web 的前端。

我已经将它用于一个小项目，您可以在一个小时内使用 CRUD 功能启动并运行它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T13:04:59.207

由于您无法使用 Silverlight 直接连接到数据库服务器，因此您应该通过 Web 服务查看使用常规 .NET 框架的 .NET 数据访问框架。

# jquery-ui - 如何从 JQuery 对话框回发到另一个 ASP .NET 页面？

> ID：576966
> 
> 赞同：1
> 
> 时间：2009-02-23T09:09:38.183
> 
> 标签：jquery-ui

我正在使用 ASP .NET 来显示一个包含几个输入字段的 JQuery 对话框。我现在需要将这些字段提交给操作方法，就像普通的 HTML 提交按钮在 ASP .NET MVC 应用程序上的工作方式一样。我该如何做到这一点？

*   这是我的表单数据：

所有表单字段是必需的。

```
<%Html.BeginForm("AddUser", "User"); %>
<fieldset>
    <label for="name">Name</label>
    <input type="text" name="name" id="name" />
    <label for="email">Email</label>
    <input type="text" name="email" id="email" value="" />
    <label for="password">Password</label>
    <input type="password" name="password" id="password" value="" />
</fieldset>
<%Html.EndForm(); %> 
```

"

*   这是我的脚本：

```
    $（函数（）{
        $("#dialog").dialog({
            bgiframe：是的，
            身高：400，
            宽度：600，
            模态：真，
            纽扣： {
                '创建用户帐户': function() {
                   $(this).dialog('close');
                },
                取消：函数（）{
                    $(this).dialog('close');
                }
            }
        });
    });
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T09:28:42.410

在提交表单的代码中添加一行：

```
$(function() { 
    $("#dialog").dialog({ 
        bgiframe: true, 
        height: 400, 
        width: 600, 
        modal: true, 
        buttons: 
        { 
            'Create user account': function() {
                 $('#yourDialogFormID').submit(); // add this line
                 $(this).dialog('close'); 
             },
             Cancel: function() { 
                 $(this).dialog('close'); 
             }
       }
    });
 }); 
```

`Html.BeginForm()`您可以通过为方法提供参数来设置 ID `htmlAttributes`（`object`如果我没记错结构，请键入 - 在 IntelliSense 的重载方法中查找它）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-23T09:29:46.463

您可以从表单中获取数据并使用[jQuery.post发布](http://docs.jquery.com/Ajax/jQuery.post)

```
$.post("someform.aspx", { name: $("#name").val(), email: $("#email").val() } ); 
```

# python - 如何在python中将一个大文件更改为csv

> ID：576967
> 
> 赞同：2
> 
> 时间：2009-02-23T09:10:01.067
> 
> 标签：python, file, csv

我是python的初学者。我有一个巨大的文本文件（数百 GB），我想将文件转换为 csv 文件。在我的文本文件中，我知道行分隔符是一个字符串“<><><><><><><>”。如果一行包含该字符串，我想用“替换它。有没有办法做到这一点而不必读取旧文件并重写一个新文件。

通常我认为我需要做这样的事情：

```
fin = open("input", "r")
fout = open("outpout", "w")
line = f.readline
while line != "":
   if line.contains("<><><><><><><>"):
      fout.writeline("\"")
   else:
      fout.writeline(line)
   line = f.readline 
```

但是复制数百 GB 是浪费的。另外我不知道 open 是否会占用大量内存（它是否将文件处理程序视为流？）

任何帮助是极大的赞赏。

注意：文件的一个例子是

```
file.txt
<><><><><><><>
abcdefeghsduai 
asdjliwa
1231214 ""
<><><><><><><> 
```

将是 csv 中的一行和一列。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-23T10:27:42.130

@richard-levasseur

我同意，`sed`这似乎是正确的方法。这是OP描述的粗略：

```
 sed -i -e's/<><><><><><><>/"/g' foo.txt 
```

这将在现有的`foo.txt`. 出于这个原因，我建议将原始文件置于某种版本控制之下；任何 DVCS 都应该符合要求。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T09:18:55.350

是的，open() 将文件视为流，readline() 也是如此。它只会读取下一行。但是，如果您调用 read()，它会将所有内容读入内存。

乍一看，您的示例代码看起来不错。几乎每个解决方案都需要您将文件复制到其他地方。在没有 1:1 替换的情况下就地修改文件的内容并不容易。

使用一些标准的 unix 实用程序（最有可能是 awk 和 sed）*可能*会更快，但我缺乏提供完整解决方案所需的 unix 和 bash-fu。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T09:15:35.157

如果您没有备用磁盘，那只会浪费。也就是说，当它出现问题时修复它。作为第一次尝试，您的解决方案看起来不错。

它不会浪费内存，因为文件处理程序是一个流。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T09:23:05.543

读取行只需使用[文件迭代器](http://docs.python.org/library/stdtypes.html#file.next)即可完成：

```
for line in fin:
       if line.contains("<><><><><><><>"):
           fout.writeline("\"") 
```

还要考虑使用[CSV writer 对象](http://docs.python.org/library/csv.html#writer-objects)来写入 CSV 文件，例如：

```
import csv
writer = csv.writer(open("some.csv", "wb"))
writer.writerows(someiterable) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T14:53:51.473

使用python，为了安全起见，您必须创建一个新文件，它比尝试就地写入会引起更少的头痛。

下面列出的一次读取您的输入 1 行并缓冲列（根据我对您的测试输入文件的理解为 1 行），然后一旦命中行尾分隔符，它将将该缓冲区写入磁盘，每次手动刷新1000 行原始文件。这也将节省一些 IO，而不是写入每个段，每次 32 字节的 1000 次写入将比 8 字节的 4000 次写入快。

```
fin = open(input_fn, "rb")
fout = open(output_fn, "wb")
row_delim = "<><><><><><><>"
write_buffer = []

for i, line in enumerate(fin):
    if not i % 1000:
        fout.flush()
    if row_delim in line and i:
        fout.write('"%s"\r\n'%'","'.join(write_buffer))
        write_buffer = []
    else:
        write_buffer.append(line.strip()) 
```

希望有帮助。

编辑：忘了提一下，虽然使用 .readline() 并不是一件坏事，但不要使用 .readlines() 它将文件的全部内容读入包含每一行的列表，这是非常低效的。使用文件对象附带的内置迭代器是最好的内存使用和速度。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-24T01:59:12.403

@Constatin 建议如果您对替换感到满意

```
'<><><><><><><>\n'
```

经过

```
'"             \n'
```

那么替换字符串的长度相同，在这种情况下，您可以使用`mmap`. 您将需要 python 2.6。以正确的模式打开文件至关重要！

```
 import mmap, os
CHUNK = 2**20

oldStr = ''
newStr = '"             '
strLen = len(oldStr)
assert strLen==len(newStr)

f = open("myfilename", "r+")
size = os.fstat(f.fileno()).st_size

for offset in range(0,size,CHUNK):
    map = mmap.mmap(f.fileno(),
                    length=min(CHUNK+strLen,size-offset),  # not beyond EOF
                    offset=offset)
    index = 0  # start at beginning
    while 1:
        index = map.find(oldStr,index) # find next match
        if index == -1:  # no more matches in this map
            break
        map[index:index+strLen] = newStr

f.close() 
```

此代码未调试！它适用于 3 MB 的测试用例，但它*可能不适*用于大型（> 2GB）文件 - 该`mmap`模块似乎仍然有点不成熟，所以我不会过分依赖它。

从大局来看，从您发布的内容来看，尚不清楚您的文件最终是否会成为有效的 CSV。另请注意，您计划用于实际处理 CSV 的工具可能足够灵活，可以按原样处理文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T09:44:55.803

[对于完全按照说明的问题] 如果不使用 python 或任何其他语言复制数据，就无法做到这一点。*如果您的处理总是用相等长度*的新子字符串替换子字符串，也许您可​​以就地完成。但是，每当您替换`<><><><><><><>`为`"`您时，都会更改文件中所有后续字符的位置。从一个地方复制到另一个地方是处理这个问题的唯一方法。

编辑：

请注意，使用`sed`实际上不会保存任何复制...sed 也不会真正就地编辑。来自[GNU sed 手册](http://www.gnu.org/software/sed/manual/html_node/Invoking-sed.html#fn-1)：

> -i[SUFFIX]
> --in-place[=SUFFIX]
> 此选项指定要就地编辑文件。GNU sed 通过*创建一个临时文件*并将输出发送到这个文件而不是标准输出来做到这一点。

（强调我的。）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-23T09:55:01.973

如果您使用双引号分隔字段，则看起来您需要转义您在元素中出现的双引号（例如`1231214 ""`将需要是`\n1231214 \"\"`）。

就像是

```
fin = open("input", "r")
fout = open("output", "w")
for line in fin:
   if line.contains("<><><><><><><>"):
      fout.writeline("\"")
   else:
      fout.writeline(line.replace('"',r'\"')
fin.close()
fout.close() 
```

# delphi - Delphi - 找不到类 TListView

> ID：576968
> 
> 赞同：3
> 
> 时间：2009-02-23T09:10:06.557
> 
> 标签：delphi, delphi-5

我们有一个 Delphi 5 应用程序，它是在没有运行时包、dll 或外部资源（即单个可执行文件）的情况下构建的。当我们在客户端 PC 上安装它时，我们会收到以下错误消息：

> 找不到类 TListView

或者

> 找不到类 TImage

我们之前已经将它安装在数十台 PC 上而没有发生任何事故，但这次最新的安装是有问题的。

目标 PC 是全新安装的 Windows XP（Service Pack 3），未安装其他软件。

它不会抱怨所有的课程，而只是抱怨一两个。例如TPanel/ TForm/ TEdit 都可以。

谁能想到是什么原因造成的？

**编辑**

新 PC 上的 exe 在我所知道的大约 30 台其他 PC 上，包括 windows XP Sp1、2、3、Windows Vista 和 Windows Embedded。新旧 PC 都安装了旧版本，然后更新为最新版本。唯一的区别是最新安装的版本跳跃更高。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-23T18:31:58.080

这通常是 .DFM 流式传输期间的错误。通常这种错误发生在 TLabel 组件中，因为许多人从表单或框架中删除了 TLabel 字段，以减少混乱并减少表单的实例大小。然而，他们犯的常见且令人困惑的错误是，他们过于热心，删除**了所有**TLabel 引用。那是坏事开始发生的时候。让我来看看流系统如何定位组件的类。

请记住，.DFM 中的类引用*只是一个字符串*. 流系统必须将此字符串转换为类引用（TComponentClass）。流系统使用两种机制来执行此操作。第一个非常简单，涉及类引用的全局列表。您可以调用 RegisterClass 或 RegisterClasses 来显式地让流系统知道它。第二个更微妙，不太为人所知。事实上，这都是德尔福“魔法”的一部分:-)。当编译器构建表单时，所有代表表单组件的字段都会被处理，并构建一个内部表作为表单/框架/数据模块本身的 RTTI 或元数据的一部分。此表包含对组件字段表示的所有单个组件类型的引用列表。所以即使一个组件**不是**在全局列表中，仍然可以通过扫描这个编译器生成的表找到它。这就是 Classes.TReader.GetFieldClass() 方法的作用。

回到我的 TLabel 示例，只需确保*给定组件类型中的至少一个具有字段即可轻松解决此问题。*因此，只要至少有 TLabel 类型的字段，**所有**其他 TLabel 都可以正常加载。因此，在您的情况下，请确保未删除 TListView 或 TImage 字段。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T09:13:04.727

Re0sless,

我建议您打开和关闭应用程序的每种形式，然后重新构建。如果我没记错的话，那是我们遇到类似问题时的解决方案。

您还可以查看[DFM Check](http://www.vclcomponents.com/Delphi/Editors/DFM_Check-info.html)以自动打开和关闭所有 dfm，并查看[CnPack](http://www.cnpack.org/index.php?lang=en)以帮助您清理 uses 子句。

问候，
利文

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T14:34:37.807

我认为 Lieven 绝对是在正确的轨道上：在运行时找不到简单的基类是 Delphi（链接器）问题。此异常**不是**由操作系统引起的。

我遇到类似问题的经验：链接器生成了一个单元排列错误的项目。
示例：表单单元链接在基本单元之前。强制项目完全重新编译/重新链接本身应该会使这个异常消失。

一个简单的 [Rebuild All] 可能还不够。您可能会尝试重新编译而不进行优化。

我试图重现此错误，但我无法重现。Delphi 编译器/链接器是最好的编译器之一 - 编译速度/已编译 exe 的速度 - 但这个错误绝对是一个阻碍。

> 注意：我只在 D5 中遇到过这个错误。有没有其他人在使用其他 Delphi 版本时遇到过这个错误？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-25T18:10:21.073

由于文件复制错误，我看到了类似的问题。更令人困惑的是，故障出在中间媒体设备上。只需从现有发布版本中重新复制文件即可解决此问题。

现在可能无法确认，但很可能问题已“解决”；不是因为删除了不必要的使用子句项，而是因为它还涉及可执行文件的新副本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-30T13:23:46.883

我有同样的问题。找不到类 TCheckBox。我通常通过表单的 .DFM 编辑大量组件（例如重命名大量组件）。当我通过 .DFM 重命名表单上的所有 CheckBox 时，会出现此错误。

我只是剪切了所有复选框并再次粘贴它们（因此刷新了 .DFM 文件）。错误消失了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-02-11T07:58:16.053

此类“找不到类 XXX”的所有错误的解决方案很简单。在文本编辑器中打开表单的 DFM 文件并手动删除其中的 XXX 对象的定义。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-04-20T01:27:14.337

更改表单的名称并使用其他名称保存 .pas。如果在其他单位中使用，请更改所有引用以创建新单位名称。全部构建。有了这个错误就消失了。

# asp.net - 加载 Web 服务时出现 System.IO.FileNotFoundException

> ID：576970
> 
> 赞同：0
> 
> 时间：2009-02-23T09:11:42.937
> 
> 标签：asp.net, service

我有一个简单的（即使不是原始的）C++/CLI .NET 2.0 类库。它用于为 Web 服务包装一些 C++ 遗留代码。以下事实似乎是真实的：

1.  原始 C# 测试程序调用类库并且它可以工作。
2.  如果类库不引用我们代码库的任何模块，它也可以作为 Web 服务的一部分工作。也就是说，我加载 Web 服务并调用方法并接收正确的响应。
3.  在我用来自我们的代码库的调用替换复制和粘贴的代码的同时，Web 服务停止加载。我收到 System.IO.FileNotFoundException 消息。

问题：我找不到写找不到文件名的任何地方。

我用谷歌搜索了它，并在我的计算机上给了一些 ASP.NET 用户一些权限。我将我们库的所有 DLL 复制到安装 Web 服务的同一目录中。我在 IIS 日志、事件日志等中进行了搜索 - 我在哪里可以找到阻止 Web 服务出现的模块的名称。

任何有关此事的帮助将不胜感激。

鲍里斯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-23T09:16:19.553

你要换什么电话？可能是原始代码优雅地处理丢失的文件（甚至可能不重要）而你的不是吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T09:20:32.697

向 iusr-account 添加与对 asp.net-account 相同的权限。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-23T09:53:14.583

确保所有相关的 DLL 都在路径中（路径的意思不是程序集所在的目录，因为 ASP.net 将您的程序集复制到一个临时文件夹中，而是包含在系统路径环境变量中的目录）。

# xaml - 如何在 Kaxaml 中引用不同的 DLL

> ID：576974
> 
> 赞同：7
> 
> 时间：2009-02-23T09:13:14.350
> 
> 标签：xaml, xaml-tools, kaxaml

我想在 Kaxaml 中使用 DataGrid。如何引用工具包 dll？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-06T12:09:54.413

1.  将 WPFToolkit.dll 复制到“C:\Program Files\Kaxaml\”
    *   重启 Kaxaml

现在您可以使用这样的命名空间：

```
xmlns:dg="clr-namespace:Microsoft.Windows.Controls;assembly=WPFToolkit" 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-01-06T21:32:02.973

另一种选择是建立一个连接并向 Kaxaml 的配置添加探测路径。

**结点代码**

*   运行提升的 cmd
*   cd "c:\Program 文件 (x86)\Kaxaml"
*   mklink /J ProbeFolder "c:\path-to-your-code"

**修改 Kaxaml.exe.config**

*   运行高架记事本
*   打开“C:\Program Files (x86)\Kaxaml\Kaxaml.exe.config”
*   将以下内容添加到 <配置>：

> ```
> <runtime>
>   <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
>       <probing privatePath="ProbeFolder"/>
>    </assemblyBinding>
> </runtime> 
> ```

*   保存文件
*   重启kaxaml

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T09:37:15.837

在使用**clr-namespace/assembly**表示法在 XAML 中映射自定义类和命名空间时，您不能指定包含该类的程序集的路径，而只能指定程序集的名称（更多详细信息可以在[MSDN](http://msdn.microsoft.com/en-us/library/ms747086.aspx#Mapping_To_Custom_Classes_and_Assemblies)上找到），因为所有引用的程序集都必须在 XAML 编译期间通过项目文件链接。

[Kaxaml](http://www.kaxaml.com/)不支持项目的概念，因为它不进行任何编译，而是使用**System.Windows.Markup.XamlReader**类动态解析和呈现在编辑器中输入的 XAML。

这意味着在使用 Kaxaml 时，您只能引用包含在属于 .NET Framework 的程序集中的类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-19T08:50:59.910

基于 Todd White 的解决方案（这也是我自己的未来参考），您在 Kaxaml 中的 XAML 将引用如下第 3 方库：

```
<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:dxlc="clr-namespace:DevExpress.Xpf.LayoutControl;assembly=DevExpress.Xpf.LayoutControl.v13.2"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <!-- Layout Control  Start -->
  <dxlc:LayoutControl Orientation="Horizontal">
  </dxlc:LayoutControl>
  <!-- Layout Control  End -->
</UserControl> 
```

# c# - Sum() 在没有行时导致异常而不是返回 0

> ID：576979
> 
> 赞同：18
> 
> 时间：2009-02-23T09:16:23.923
> 
> 标签：c#, linq-to-sql, nullreferenceexception

我有这个代码（好吧，我没有，但是类似的东西：p）

```
 var dogs = Dogs.Select(ø => new Row
    {
            Name = ø.Name,
            WeightOfNiceCats = ø.Owner
              .Cats
              .Where(æ => !æ.Annoying)
              .Sum(æ => æ.Weight),
    }); 
```

在这里，我遍历所有狗并总结所有与狗拥有相同主人的不烦人的猫的重量（成一个不可为空的小数）。当然，几乎所有的猫都很烦人，所以我得到了这个错误：

> 不能将 null 值分配给 System.Decimal 类型的成员，该类型是不可为 null 的值类型。

使用的任何字段或外键都不能为空。因此，当`Where`子句不返回猫时，就会发生错误，而这通常会发生。但是我该如何解决呢？我希望它在发生这种情况时返回 0。尝试使用`DefaultIfEmpty()`after`Where`子句，但随后出现此错误：

> 你调用的对象是空的。

我想这是可以理解的。我尝试在`??`之后添加一个`Sum`，但由于此错误，它不会编译：

> 操作员 '？？' 不能应用于“十进制”和“十进制”类型的操作数

这当然也是有道理的。那么我能做什么呢？`Sum`如果在没有什么可总结的情况下，事情只是返回 0，那就太好了。或者某种`SumOrZero`声明。`SumOrZero`制作一种适用于 Linq2SQL的方法会很困难吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-23T12:57:32.253

这就是我现在的结果：

```
.Sum(æ => (decimal?) æ.Weight) ?? 0.0M, 
```

这就像一个魅力。

我仍然希望有一个`SumOrZero`我可以使用的，它的工作方式与普通的完全一样，`Sum`只是它永远不会`null`因任何原因返回。就像其他人所指出的那样，这很容易制作，`IEnumerable`但创建起来有点麻烦，`IQueryable`因此它可以与 Linq2SQL 等一起使用。所以我现在就把它留在那里。虽然如果有人有一天感到无聊并写了一个`SumOrZero`适用`IQueryable`于所有数字类型的 Linq2SQL，请告诉我：D

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-23T09:29:25.060

在 LINQ to Objects 中，这很容易。使用 LINQ to SQL 会更难。您可以编写自己的扩展方法，该方法`Queryable.Sum`使用从普通方法构建的表达式调用，并转换为可空类型。我怀疑你需要这样做？？0m 虽然在调用代码中。换句话说，你可以这样做：

```
.SumOrNull(æ => æ.Weight) ?? 0M, 
```

.SumOrNull 的签名在哪里：

```
public static decimal? SumOrNull<TSource, decimal>(this IQueryable<TSource>,
    Func<TSource,decimal> projection) 
```

您基本上可以为 Queryable 中支持的所有值类型编写它。您*可以*通用地编写它，并使用反射在 Queryable 中调用适当的方法，但这也很麻烦。

老实说，我认为你最好用你所拥有的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T09:23:28.057

您已经给出的技巧`.Sum(æ => (decimal?) æ.Weight) ?? 0.0M`（有点烦人，但还有更糟糕的事情......

与 LINQ-to-Objects 不同，您不能只添加自己的扩展方法，因为它需要由底层提供程序映射。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T09:37:32.950

您想使用 DefaultIfEmpty，它将返回一个带有单个元素 0 的 IEnumberable，这在语义上与您的要求相同。

由于您有一个可为空的小数，您可能必须使用采用 2 个参数的方法的第二个版本。

# qt - 为什么我的 Qt 插件没有加载？

> ID：576983
> 
> 赞同：0
> 
> 时间：2009-02-23T09:18:20.843
> 
> 标签：qt, visual-c++, plugins

我最近将我的 Qt 应用程序从使用 MinGW 切换到 MS Visual Studio 2008，因此 Qt 图像插件和 Sqlite 插件不再在 QA 计算机上工作。

在 MinGW 下，只是将插件 dll 放在 imageforats 文件夹中，但在这种情况下似乎还不够。

其他人有这个问题吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-26T10:42:19.790

为了解决这个问题，我必须重新编译为发行版并使用 Microsoft Visual C 可再发行运行时。

我失去了在 QA 机器上进行调试的能力，但至少插件可以正常工作。

# asp.net - 我应该忽略偶尔的 Invalid viewstate 错误吗？

> ID：576990
> 
> 赞同：57
> 
> 时间：2009-02-23T09:21:33.833
> 
> 标签：asp.net, error-handling, viewstate

时不时地（每天一次左右）我们在 ASP.NET 3.5 应用程序的日志中看到以下类型的错误

*   无效的视图状态
*   无效的回发或回调参数

这些是 ASP.NET 应用程序不时“发生”的事情吗？有人会建议我们花大量时间尝试诊断导致问题的原因吗？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-02-23T09:36:17.400

这要看情况。由于多种原因，可能会发生无效的视图状态。

1.  Viewstate 太大，在用户导致页面回发之前尚未完成渲染。修复通常是禁用所有触发回发的控件，并在页面完成加载后启用它们 - 请参阅[http://blogs.msdn.com/tom/archive/2008/03/14/validation-of-viewstate- mac-失败-error.aspx](https://web.archive.org/web/20090621083757/http://blogs.msdn.com/tom/archive/2008/03/14/validation-of-viewstate-mac-failed-error.aspx)
2.  您正在使用视图状态 MAC（出于安全原因，您应该使用），但您尚未设置机器密钥，并且应用程序池已回收生成一个新的。不要忘记设置 ViewStateUserKey。
3.  有人在 Mac 上使用旧版本的 IE，它会截断隐藏的表单字段。在这种情况下，您需要将视图状态从页面移出到[会话状态](http://msdn.microsoft.com/en-gb/magazine/cc163577.aspx#S4)。
4.  Viewstate MAC 问题通常表明您在网络场中并且忘记在 web.config 中设置机器密钥。但是，如果您这样做了，那么可能是有人试图做坏事（机器人发布评论，有人试图触发禁用控件的事件等）。如果只是为了排除潜在的安全问题，就应该追查这些原因。

无论您做什么，都***不要***关闭视图状态或事件验证。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-23T09:42:22.377

一个问题可能与用户路由器截断表单字段有关。解决这个问题的方法是在 web.config 中将 MaxPageStateFieldLength 设置为一个较小的数字（如 100），然后 ViewState 被分解为小块。做起来很简单，[这篇文章](http://weblogs.asp.net/lduveau/archive/2007/04/17/viewstate-chunking-in-asp-net-2-0-maxpagestatefieldlength.aspx)对它进行了充分的解释。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-23T09:53:08.937

例外不会时不时地“发生”。它们总是出于正当理由而发生，其中一些已经在其他答案中列出。

但是，要缓解 ViewState 的问题，请考虑完全禁用它。作为 ASP.NET 开发人员，我们经常倾向于在各种不需要的地方使用 ViewState，因为它是默认设置。在考虑使用控件之前，我通常会考虑使用静态 html。如果您决定使用控件，请考虑是否真的需要启用 ViewState。禁用它通常会导致更好的页面加载时间，所以如果可以的话，就这样做。

我希望它在默认情况下被禁用，所以人们被迫以这种方式思考，但事实并非如此。

**更新以回答评论：**

在我的脑海中，我想出了 3 个关闭 ViewState 的机会。

1.  如果在每次回发时都加载数据，则禁用 ViewState。如果您正在构建启用 AJAX 的网站（那是*真正*的AJAX 而不是那种 UpdatePanel ;)），通常会出现这种情况，您通常在第一次加载时加载数据，然后使用 AJAX 请求重新加载/更新数据。在某些情况下，您甚至可能仅出于禁用 ViewState 的目的在每次访问时加载数据，然后将数据缓存在服务器上。

2.  如果您将数据绑定到真正静态的内容，您还可以考虑禁用 ViewState。有时我会找到一个列表，该列表数据绑定到数据库中的一个小型静态 basedata 表或类似的东西。现在，这可能很危险，但如果我确信数据不会更改，我可能会将数据作为静态内容移动到页面中（您可以将其包装在单独的控件中，这样您就不会拥有数据的多个静态副本）。但是，如果数据确实发生了变化，您将不得不手动更改它。

3.  简单的控件（例如标签）通常是禁用 ViewState 的理想选择。

最后，您可以切换到 ASP.NET MVC 框架并永远告别这些问题，这就是我打算做的事情，即使我将面临一些其他问题。;)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-08-19T14:19:03.717

BlowDart 对 Invalid Viewstate 问题有正确的答案。可能是您的应用程序池被回收并更改了加密密钥。

请参阅这些帖子以获得支持：

[.NET 应用程序中不稳定的无效 Viewstate 问题](https://stackoverflow.com/questions/728513/erratic-invalid-viewstate-issue-in-net-application/728539#728539)

[使用 ASP .Net Membership 使用户登录持久化](https://stackoverflow.com/questions/682788/how-do-i-use-persistant-cookies-with-asp-net-membership/1049555#1049555)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-07-03T14:00:04.960

无效的视图状态对您的记录器或用户或您的网站没有任何价值，最终用户永远不会看到这些错误。为避免此错误，请尝试在**Global.ascx**中添加以下内容：

```
void Application_Error(object sender, EventArgs e)
    {          
                if (ex is HttpException && ex.InnerException is ViewStateException)
                {
                    Response.Redirect(Request.Url.AbsoluteUri);
                    return;
                }
    } 
```

有关更多信息，请查看以下链接：

[https://www.karpach.com/viewstateexception-invalid-viewstate.htm](https://www.karpach.com/viewstateexception-invalid-viewstate.htm)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-23T09:28:58.387

对于前者，您无能为力 - 我捕获此类异常并将用户退回到错误页面，并显示“您所在的页面已过期。这通常发生在您尝试重新访问您所在的页面时已经输入了数据。”

我在使用 UpdatePanel 的相当大的页面上看到的最多的是后者。我认为这是在页面完成加载之前用户发回（或可能回调）的时候，因此并非所有在页面末尾标记的javascript都已运行。

同样，除了在错误页面上显示适当友好的消息外，您无能为力。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-12-04T18:18:09.197

我的日志中抛出了这种异常，并且与此处列出的其他原因有很大不同。我确实有一个非常大的 ViewState，这是问题的一部分。但这与导致这些异常的另一个问题相结合（并且可能偶尔来自 IIS 的错误响应）。

我正在处理的代码库有一些花哨的代码来避免双击，作为其中的一部分，它向每个按钮的单击事件的 javascript 添加了一些东西，在第一次单击后禁用按钮，然后执行通常的回发。但是像这样调用回发是一个问题，因为我的一些按钮已经有一个由 .NET 自动生成的回发调用。所以我最终得到了双重回发，其中一个有无效的 ViewState。删除额外的回发为我停止了例外。

我知道我真的应该大幅减小 ViewState 的大小，但这是一个大型遗留代码库，这样的更改将非常具有侵入性。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-06T20:47:52.123

忽略此错误可能不是一个好主意。除了上述所有答案之外，您可能还需要考虑查看您的视图状态有多大。代理服务器可以截断大的视图状态。

如果您的视图状态很大，那么最好使用 ASP.net 跟踪来查看哪些控件正在使用视图状态，以及您可以在哪里关闭它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-29T16:07:39.453

根据 Wayne Walter Berry 在[这篇](http://www.31a2ba2a-b718-11dc-8314-0800200c9a66.com/2009/04/error-scriptresourceaxd-invalid.html)博文中的说法，另一个罪魁祸首可能是在 IE8 中使用 XHTML 文档类型，而页面上没有符合 XHTML 的标记。这会导致 IE8 向 scriptresource.axd 发送打乱的参数并抛出无效的视图状态异常。

他建议确保所有 javascript 块都使用`// <![CDATA[]]>`或简单地更改文档类型（这可能会导致页面上出现其他 css/样式问题）。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2010-04-09T06:35:09.713

更新：微软宣布以下针对 IE 8 的错误修复修复了此问题：http:
[//blogs.msdn.com/ieinternals/archive/2010/04/01/IE8-Lookahead-Downloader-Fixed.aspx](http://blogs.msdn.com/ieinternals/archive/2010/04/01/IE8-Lookahead-Downloader-Fixed.aspx)*******