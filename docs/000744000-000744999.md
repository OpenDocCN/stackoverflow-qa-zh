# StackOverflow 问答 000744000-000744999

# iframe - 拖动时自动滚动 iframe 父级 (Prototype & Scriptaculous)

> ID：744005
> 
> 赞同：1
> 
> 时间：2009-04-13T14:16:02.450
> 
> 标签：iframe, drag-and-drop, scroll, scriptaculous

我在页面上有一个 iframe。iframe 根据加载的内容调整自身大小。所以，它不会有任何滚动条。

iframe 包含可拖动元素的列表（Prototype & Scriptaculous）。我必须将元素从底部拖动到顶部，反之亦然，并且在拖动时，父窗口应该相应地滚动。我已经相应地修改了 dragdrop.js 文件以基于“window.parent.window”元素滚动。结果是父窗口在拖动元素时自动从底部滚动到顶部，但反之则不然。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T05:41:34.397

好的，谢谢大家。我想我自己已经解决了这个问题。

我所要做的就是计算 IFrame 窗口的位置，然后从拖放 js 代码计算的顶部滚动值中减去它。

# php - PHP/MySQL：从 YYYY-MM-DD 转换为 DD 月，YYYY？

> ID：744010
> 
> 赞同：2
> 
> 时间：2009-04-13T14:18:05.007
> 
> 标签：php, mysql, datetime

我在 MySQL 表中有一个 DATE 列，它以这种格式表示日期：YYYY-MM-DD。

我想使用 PHP 从数据库中检索日期，但显示如下：DD Month，YYYY。

例如，从“2009-04-13”到“2009 年 4 月 13 日”。

女巫是最好的方法吗？？（我知道如何从数据库中获取日期。我只需要知道如何转换它）

我还需要用西班牙语显示月份名称。有一种方法可以做到这一点，而无需使用 strplc 或类似的东西每月进行翻译？

我是编程新手，请详细说明。

谢谢！！！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T14:21:54.170

参考 MySQL 中的[DATE_FORMAT()](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_date-format)函数。我想这对你来说是最好的方法。

此外，您可以这样做：

*   从数据库中获取您的日期
*   在 PHP 中使用[strtotime](http://www.php.net/strtotime)转换为 unix 时间
*   [然后使用date](http://www.php.net/date)格式化时间。

[通过使用 date() 在 PHP 中使用setlocale](http://us2.php.net/manual/en/function.setlocale.php)设置语言环境时，您将能够获得西班牙语的月份名称。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T14:30:13.150

执行以下 MySQL 查询：

```
SET lc_time_names = 'es_ES';
SELECT DATE_FORMAT(t.date,'%e de %M, %Y') FROM your_table t ... 
```

使用 MySQLi，它将是：

```
$mysqli->query("SET lc_time_names = 'es_ES'");
$stmt = $mysqli->prepare("SELECT DATE_FORMAT(t.date,'%e de %M, %Y') FROM your_table t ...where id = ?");
... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T14:57:59.357

您还可以通过在 MySql 选择中使用 UNIX_TIMESTAMP(date) 来跳过 strtotime() 部分。但请记住，这是 MySQL 特定的功能，将来可能无法移植。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T14:22:08.473

最简单的方法是使用[strtotime()](http://php.net/strtotime)函数将输入标准化为 UNIX 时间戳。

然后使用[date()](http://php.net/date)函数以您希望的任何格式输出日期。请注意，您需要将 UNIX 时间戳作为第二个参数传递给 date()。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T14:55:08.457

另一个尚未提及的选项：

SQL：

```
SELECT UNIX_TIMESTAMP(date) FROM table 
```

PHP：

```
print date('your format', $timestamp_from_the_db); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T14:57:33.053

就个人而言，我喜欢在 MySQL 中使用整数数据类型来存储 UNIX 时间戳格式的日期。我将该整数的所有处理留给 PHP。保持表格和查询尽可能简单一直对我很有帮助。主要是，在我编写的代码中，日期对它们进行了某种计算。这一切都是在 PHP 端完成的，并且始终采用 UNIX 时间戳格式。以 UNIX 时间戳格式以外的任何格式存储或检索日期只是意味着错误蔓延的另一个步骤，并使查询的模块化程度降低。日期的格式最好留到显示前的最后一分钟。这只是我的意见，但除非在极端情况下您无法在提取后处理 DB 值，否则不应在 SQL 端格式化日期。

一个简化的例子：

```
<?php

$date = now();
$dueDate = $date + 60*60*24*7; // One week from now

$sqlInsert = "INSERT INTO reports SET `dueDate` = $date";
$resInsert = mysql_query( $sqlInsert );

$sqlSelect = "SELECT `dueDate` FROM reports";
$resSelect = mysql_query( $sqlSelect );
$rowSelect = mysql_fetch_array( $resSelect );

$DB_dueDate = $rowSelect['dueDate'];

$daysUntilDue = ( $DB_dueDate - now() ) / 60*60*24;

$formattedDueDate = date( "j F, Y", $DB_dueDate );

?>

The report is due on <?=$formattedDueDate?>.  That is <?=$daysUntilDue?> from now. 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-02-04T12:52:32.493

这将帮助您根据需要进行转换：

```
$dob ='2009-04-13';
echo date('d M Y', strtotime($dob)); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-02-04T12:56:35.273

$origDate = "2018-04-20";

$newDate = date("dmY", strtotime($origDate)); 回声 $newDate;

# c# - 如何取消方法的执行？

> ID：744013
> 
> 赞同：14
> 
> 时间：2009-04-13T14:18:47.297
> 
> 标签：c#

考虑我在 C# 中执行一个方法'Method1'。一旦执行进入方法，我会检查一些条件，如果其中任何一个为假，则应该停止 Method1 的执行。我该如何做到这一点，即在满足某些条件时可以执行方法。？

但我的代码是这样的，

```
int Method1()
{
    switch(exp)
    {
        case 1:
        if(condition)
            //do the following. **
        else
            //Stop executing the method.**
        break;
        case2:
        ...
    }
} 
```

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-04-13T14:20:49.587

使用`return`语句。

```
if(!condition1) return;
if(!condition2) return;

// body... 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-13T14:21:09.787

我想这就是你要找的。

```
if( myCondition || !myOtherCondition )
    return; 
```

希望它回答了你的问题。

## 编辑：

如果由于错误而想退出该方法，可以抛出如下异常：

```
throw new Exception( "My error message" ); 
```

如果你想返回一个值，你应该像以前一样返回你想要的值：

```
return 0; 
```

如果它是您需要的异常，您可以在调用您的方法的方法中使用 try catch 来捕获它，例如：

```
void method1()
{
    try
    {
        method2( 1 );
    }
    catch( MyCustomException e )
    {
        // put error handling here
    }

 }

int method2( int val )
{
    if( val == 1 )
       throw new MyCustomException( "my exception" );

    return val;
} 
```

MyCustomException 继承自 Exception 类。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T14:22:41.437

你说的是多线程吗？

或类似的东西

```
int method1(int inputvalue)
{
   /* checking conditions */
   if(inputvalue < 20)
   {
      //This moves the execution back to the calling function
      return 0; 
   }
   if(inputvalue > 100)
   {
      //This 'throws' an error, which could stop execution in the calling function.
      throw new ArgumentOutOfRangeException(); 
   }
   //otherwise, continue executing in method1

   /* ... do stuff ... */

   return returnValue;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T14:22:03.623

有几种方法可以做到这一点。您可以使用`return`or`throw`取决于您是否认为它是错误的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T14:21:21.113

您可以使用 return 语句设置保护子句：

```
public void Method1(){

 bool isOK = false;

 if(!isOK) return; // <- guard clause

 // code here will not execute...

} 
```

# java - 是否可以通过 JMX 使 JBoss 中的单个会话无效？

> ID：744021
> 
> 赞同：4
> 
> 时间：2009-04-13T14:19:58.090
> 
> 标签：java, jboss, session, jmx

我们正在追踪我们的应用程序中的一些内存问题，并且我们可以看到问题似乎存在的会话的大小。它只会影响某些会话，它们似乎膨胀失控，我们希望能够或多或少地“手动”使这些会话无效以回收该内存。有没有办法通过 JMX 做到这一点？我们正在使用 JBoss 4.5.2 。

提前致谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-14T19:37:41.953

答案是肯定的，你可以。

--这将获取加载到 JBoss 中的 Web 模块 MBean--

`/opt/lib/jboss-4.2.3.GA/bin/twiddle.sh -s <--ServerIP-->:1099 query 'jboss.web:*' | grep "type=Manager"`

--一旦你有了它，你就可以从那个 MBean 中获取活动会话--

`/opt/lib/jboss-4.2.3.GA/bin/twiddle.sh -s 172.16.0.216:1099 invoke "<--MBean-->" listSessionIds`

--最后，一旦你有了那个列表，你就可以挑选出感兴趣的会话并将其过期--

`/opt/lib/jboss-4.2.3.GA/bin/twiddle.sh -s <--ServerIP-->:1099 invoke "<--MBean-->" expireSession <--SessionID-->`

您可以将 <--ServerIP--> 替换为服务器绑定的 ip……它不必是本地的。只要您可以访问端口 1099，它就可以远程运行。

<--MBean--> 将替换为第一个查询的结果之一。

<--SessionID--> 将替换为第二个命令中的会话 ID 之一。

您也可以将 /opt/lib/jboss-4.2.3.GA/bin/twiddle.sh 替换为您机器上 twiddle 的位置。它包含在 JBoss 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-05T10:59:40.737

谢谢伊科鲁斯。您的解决方案至少以某种方式帮助我在任何给定时间查看服务器上的所有活动会话。

顺便说一句...在运行 twiddle.sh 之前需要做一些事情 确保在环境中设置了 JAVA_HOME 和 JBOSS_HOME 并确保 JBOSS_CLASSPATH 未设置或具有 twiddle.sh.ie {JBOSS_HOME}\client 中给出的所有库\jbossall-client.jar;{JBOSS_HOME}\client\getopt.jar;{JBOSS_HOME}\client\log4j.jar; {JBOSS_HOME}\lib\jboss-jmx.jar

否则你会遇到 ClassNotFound 异常

苏迪尔

# performance - “散列缺点”是什么意思？

> ID：744048
> 
> 赞同：5
> 
> 时间：2009-04-13T14:25:33.163
> 
> 标签：performance, algorithm, optimization, scala, hash

何时使用它，为什么？

我的问题来自这句话：“对某些类进行哈希处理并将它们的实例与引用相等性进行比较”

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-12-05T14:50:18.810

来自 Odersky、Spoon 和 Venners（2007 年），*Scala 编程*，Artima Press，p。243：

您通过缓存您在弱集合中创建的所有实例来散列类的 cons 实例。然后，任何时候你想要一个新的类实例，你首先检查缓存。如果缓存已经有一个元素等于你要创建的元素，你可以重用现有的实例。由于这种安排，任何两个与 equals() 相等的实例也与引用相等相等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T14:31:36.157

把大家的答案放在一起：

> ACL2（A Computational Logic for Applicative Common Lisp）是一个软件系统，由编程语言、一阶逻辑中的可扩展理论和机械定理证明器组成。
> 
> --[维基 ACL2](http://en.wikipedia.org/wiki/ACL2)
> 
> 在计算机编程中，cons（发音为 /ˈkɒnz/ 或 /ˈkɒns/）是 Lisp 编程语言的大多数方言中的基本功能。cons 构造（因此得名）包含两个值或指向值的指针的内存对象。这些对象被称为 (cons) 单元格、conses 或 (cons) 对。在 Lisp 行话中，“to cons x on y”表示用 (cons xy) 构造一个新对象。结果对具有左半部分，称为汽车（第一个元素）和右半部分（第二个元素），称为 cdr。
> 
> --[维基缺点](http://en.wikipedia.org/wiki/Cons)
> 
> 从逻辑上讲，hons 只是 cons 的另一个名称，即以下是 ACL2 定理：
> 
> （等于（荣誉 xy）（缺点 xy））
> 
> Hons 通常比 cons 运行得慢，因为在创建 hons 时，会尝试查看是否已经存在具有相同汽车和 cdr 的 hons。这涉及搜索和哈希表的使用。
> 
> -- [http://www.cs.utexas.edu/~moore/acl2/current/HONS.html](http://www.cs.utexas.edu/%7Emoore/acl2/current/HONS.html)

鉴于你的问题：

> 对某些类散列缺点并将它们的实例与引用相等性进行比较

这似乎`hash cons`是一个散列 LISP 构造函数的过程，以确定一个对象是否已经存在，通过相等比较。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T14:34:37.993

[http://en.wikipedia.org/wiki/Hash_cons](http://en.wikipedia.org/wiki/Hash_cons)现在重定向。

它[`con`与](http://en.wikipedia.org/wiki/Cons)散列一起允许`eq`（参考）比较而不是深度比较。这对内存更有效（因为相同的对象被存储为引用），如果比较是一种常见的操作，当然更快。

[http://www.cs.utexas.edu/~moore/acl2/current/HONS.html](http://www.cs.utexas.edu/~moore/acl2/current/HONS.html)描述了 Lisp 的实现。

# xml - 在 IE 中查看 XML 时如何禁用安全警告？

> ID：744050
> 
> 赞同：3
> 
> 时间：2009-04-13T14:26:26.170
> 
> 标签：xml, security, internet-explorer

当我在 Internet Explorer 中查看 XML 文件时，它会突出显示语法并提供可单击的展开/折叠控件。但是对于我打开的每个文件，我都会收到一个黄色警告栏，需要单击三下才能关闭。这些是本地文件，因此不需要安全警告。可以禁用吗？

[用于查看本地 xml 文件的 IE 黄色安全警告栏 http://carrieandtim.com/drop/iexmlwarning.png](http://carrieandtim.com/drop/iexmlwarning.png)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-19T05:12:55.853

此页面上的先前建议对我不起作用。[我在这个页面](http://www.leonmeijer.nl/archive/2008/04/27/106.aspx)上找到了答案

总而言之，进入 Internet 选项 > 高级，然后进入安全部分，然后勾选“允许活动内容在我的电脑上的文件中运行*”框

* 表示该设置只有在 Internet Explorer 重新启动后才会生效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T14:59:12.613

从 Windows 帮助（如果您从信息栏上下文菜单中单击“更多信息”）：

> 阻止信息栏阻止文件和软件下载
> 
> *   单击以打开 Internet Explorer。
>     
>     
> *   单击工具按钮，然后单击 Internet 选项。
>     
>     
> *   单击安全选项卡，然后单击自定义级别。
>     
>     
> *   执行以下一项或两项操作：
>     
>     
>     *   要关闭 ActiveX 控件的信息栏，请滚动到列表的 ActiveX 控件和插件部分，然后在 ActiveX 控件的自动提示下，单击启用。
>         
>         
>     *   要关闭文件下载的信息栏，请滚动到列表的下载部分，然后在自动提示文件下载下，单击启用。
>         
>         
> *   单击确定，单击是确认您要进行更改，然后再次单击确定

XML 查看器（着色并添加展开/折叠）是 IE 中包含的 ActiveX 控件。请注意，禁用此控件的安全警告将禁用 ActiveX 控件的所有警告，这可能不是一件好事。听起来您仍然会在首次使用控件时收到警告（请参阅附加的“允许以前未使用的 ActiveX 控件在没有提示的情况下运行”选项），但我无法确认。

# c# - 是否需要手动关闭和处置 SqlDataReader？

> ID：744051
> 
> 赞同：96
> 
> 时间：2009-04-13T14:26:39.087
> 
> 标签：c#, sql, .net, ado.net

我在这里使用遗留代码，有许多实例`SqlDataReader`从未关闭或处置。连接已关闭，但我不确定是否需要手动管理阅读器。

这会导致性能下降吗？

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2009-04-13T14:31:17.780

尽量避免使用这样的阅读器：

```
SqlConnection connection = new SqlConnection("connection string");
SqlCommand cmd = new SqlCommand("SELECT * FROM SomeTable", connection);
SqlDataReader reader = cmd.ExecuteReader();
connection.Open();
if (reader != null)
{
      while (reader.Read())
      {
              //do something
      }
}
reader.Close(); // <- too easy to forget
reader.Dispose(); // <- too easy to forget
connection.Close(); // <- too easy to forget 
```

相反，将它们包装在 using 语句中：

```
using(SqlConnection connection = new SqlConnection("connection string"))
{

    connection.Open();

    using(SqlCommand cmd = new SqlCommand("SELECT * FROM SomeTable", connection))
    {
        using (SqlDataReader reader = cmd.ExecuteReader())
        {
            if (reader != null)
            {
                while (reader.Read())
                {
                    //do something
                }
            }
        } // reader closed and disposed up here

    } // command disposed here

} //connection closed and disposed here 
```

using 语句将确保正确处理对象并释放资源。

如果您忘记了，那么您将把清理工作留给垃圾收集器，这可能需要一段时间。

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2009-04-13T15:45:45.420

请注意，释放使用 SqlCommand.ExecuteReader() 实例化的 SqlDataReader**不会**关闭/释放底层连接。

有两种常见的模式。首先，阅读器在连接范围内打开和关闭：

```
using(SqlConnection connection = ...)
{
    connection.Open();
    ...
    using(SqlCommand command = ...)
    {
        using(SqlDataReader reader = command.ExecuteReader())
        {
            ... do your stuff ...
        } // reader is closed/disposed here
    } // command is closed/disposed here
} // connection is closed/disposed here 
```

有时让数据访问方法打开连接并返回阅读器会很方便。在这种情况下，使用 CommandBehavior.CloseConnection 打开返回的阅读器很重要，这样关闭/处置阅读器将关闭底层连接。该模式看起来像这样：

```
public SqlDataReader ExecuteReader(string commandText)
{
    SqlConnection connection = new SqlConnection(...);
    try
    {
        connection.Open();
        using(SqlCommand command = new SqlCommand(commandText, connection))
        {
            return command.ExecuteReader(CommandBehavior.CloseConnection);
        }
    }
    catch
    {
        // Close connection before rethrowing
        connection.Close();
        throw;
    }
} 
```

并且调用代码只需要这样处理读者：

```
using(SqlDataReader reader = ExecuteReader(...))
{
    ... do your stuff ...
} // reader and connection are closed here. 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-13T14:29:13.077

为了安全起见，将每个 SqlDataReader 对象包装在[using 语句中](http://msdn.microsoft.com/en-us/library/yh598w02.aspx)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-13T14:29:13.247

只需用“使用”语句包装您的 SQLDataReader。这应该可以解决您的大部分问题。

# php - PHP 404 错误页面不会显示内容

> ID：744054
> 
> 赞同：0
> 
> 时间：2009-04-13T14:27:12.907
> 
> 标签：php, header, http-status-code-404

我在 Windows/IIS/PHP 虚拟主机上实现自定义 404 错误页面时遇到问题。每当我尝试在标头中发送 404 状态消息时，都不会向客户端发送任何内容，而是显示一个空白页面。

这是我正在使用的一个非常简单的脚本：

```
<?php
  header('HTTP/1.1 404 Not Found');
  header('Status: 404 Not Found');
  var_dump(headers_list());
?> 
```

在我的开发机器上，输出（显示在浏览器中）是

```
array(2) { [0]=>  string(23) "X-Powered-By: PHP/5.2.6" [1]=>  string(21) "Status: 404 Not Found" } 
```

在我的主机上没有输出。我似乎无法生成除了空白页面之外的任何内容，无论 PHP 回显什么内容，或者作为普通 HTML 包含在下面，尽管 PHP 处理（例如日志记录、数据库写入等）继续正常进行。

谁能建议问题可能是什么或如何解决？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T15:47:34.260

“空白页”闻起来像是 error_reporting(0) 隐藏了您会收到的错误消息。也许在您的标题之前有一些输出，这会引发错误。检查那个。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T14:29:51.857

如果在 PHP 标记之后放置文本会怎样？

此外，请确保您的脚本没有在主机上出错，无论是检查 apache 错误日志、在脚本上运行 php -l 还是打开 error_reporting 和 display_errors。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T16:31:50.037

如果在您的主机上将 PHP 配置为通过 CGI 运行，则可能无法在 IIS 中生成 404 错误页面（除非撒谎并返回 200 OK，这是一件坏事）。当然，我无法说服 IIS 4-6.0 允许我的 CGI 404 错误通过浏览器。

无论如何，您通常不希望 PHP 运行 CGI，还有其他相关问题以及速度缓慢。在 IIS 上，应该首选 PHP ISAPI 扩展（尽管我没有尝试过，我无法确认它解决了这个特定问题）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-20T08:14:19.513

我对 Linux 上的 PHP 5.2.6 有同样的问题。我发现 Web 服务器没有打印前 8109 个字节。

IE6 忽略长度小于 512 字节的自定义错误页面。这可能是对这个问题的解释，但可能您已经在多个浏览器中进行了测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T20:01:04.323

检查您的主机是否允许您使用 PHP 动态更改标头。我的主机不允许我通过 PHP 设置 404 标头，尽管其他标头（301，内容类型）很好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T20:21:43.850

我的建议是不要自己设置 HTTP/1.1 404 标头，让 Web 服务器为您完成。

传统上，这是通过 Status 标头完成的，Web 服务器应将其转换为 HTTP/1.0 或 1.1 404 Not Found 标头。

（旁注：[Status](http://hoohoo.ncsa.uiuc.edu/cgi/out.html)标头不是真正的 HTTP 标头，仅用于将信息从应用程序传递到服务器本身。）

# c - GCC内联汇编：跳转到块外的标签

> ID：744055
> 
> 赞同：12
> 
> 时间：2009-04-13T14:27:36.340
> 
> 标签：c, assembly, gcc, x86, inline-assembly

在 MSVC 下使用内联汇编时，可以通过引用 C/C++ 代码中的标签来跳出汇编块，如[MSDN 文章中所述](http://msdn.microsoft.com/en-us/library/aa279405(VS.60).aspx)。

在 GCC 下使用内联汇编时可以这样做吗？

这是我要完成的示例：

```
__asm__ __volatile__ (
"   /* assembly code */ "
"   jz external_label;  "
);

/* some C code */

external_label:
/* C code coninues... */ 
```

然而，编译器抱怨没有定义“external_label”。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-13T14:41:04.967

这个答案中的代码恰好可以工作，但是是未定义的行为，并且通常会在启用优化的情况下破坏事情。只有在 asm 语句后面跟着 时`asm goto`，或者[在有限的情况下](https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html#GotoLabels)，才可以安全地跳出内联 asm 语句`__builtin_unreachable();`

（这在这里不可用：跳到内联 asm 语句的中间，然后在函数内再次陷入编译器生成的代码是绝对不安全*的*。）

* * *

如果你用汇编器定义标签怎么办？

```
asm("external_label:"); 
```

* * *

**更新**：此代码似乎有效：

```
#include <stdio.h>

int
main(void)
{
  asm("jmp label");
  puts("You should not see this.");
  asm("label:");

  return 0;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2017-07-03T13:34:43.420

从 GCC 4.5 开始，您还可以使用[`asm goto`](https://gcc.gnu.org/onlinedocs/gcc-4.5.0/gcc/Extended-Asm.html#Extended%20asm%20with%20goto). 以下示例跳转到 C 标签：

```
#include <stdio.h>

int main(void) {
    asm goto (
        "jmp %l[done]"  // %l == lowercase L
        :
        :
        :
        : done          // specify c label(s) here
    );
    printf("Should not see this\n");

done:
    printf("Exiting\n");
    return 0;
} 
```

# actionscript-3 - 如何使用内置的 Date 类来节省时间？

> ID：744057
> 
> 赞同：1
> 
> 时间：2009-04-13T14:28:07.243
> 
> 标签：actionscript-3, datetime, date, time, calendar

这个问题的目的是使用内置的 Date 类而不是编写冗长的复杂函数来收集日期/时间计算的解决方案。

我会自己写一些答案，如果有人提出非常聪明的东西，我会接受答案。但这主要是作为解决方案的集合，因为我经常看到处理日期的代码过于复杂。

请记住，这**不是**针对 Date 类不能做的事情的长期解决方案。

一个好的起点是在这里找到的参考：http: [//help.adobe.com/en_US/AS3LCR/Flash_10.0/Date.html](http://help.adobe.com/en_US/AS3LCR/Flash_10.0/Date.html)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T14:29:32.060

要正确比较日期，您需要使用 getTime() 函数，它会为您提供自 1970 年 1 月 1 日以来的时间（以毫秒为单位）。这使得比较日期变得容易，以后的日期将返回更大的值。

您可以从另一个中减去一个以获得差异，但不幸的是没有内置的时间跨度类可以干净地处理这个；您将不得不使用一些数学来正确地向用户展示差异（例如，将差异除以一天中的毫秒数以获得天数差异）。

```
var date1:Date = new Date(1994, 12, 24);
var date2:Date = new Date(1991, 1, 3);
if(date1.getTime() > date2.getTime())
    trace("date1 is after date2");
else
    trace("date2 is after or the same as date1"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T14:31:54.347

您可以使用 Date 类轻松找出一年是否为闰年，而无需对规则的所有例外情况进行编码。通过从 marts the 1st 中减去一天（请求 marts the 0th），您可以找到 2 月份的天数。

请记住，该月的索引为零，因此第 3 个月的 Marts 具有索引 2。

```
function CheckIfYearIsLeapYear(year:uint):Boolean
{
    return new Date(year, 2, 0).Date == 29;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-09T15:33:11.870

还有`ObjectUtil.dateCompare(a,b)`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T14:28:34.840

要获取当前系统日期，只需创建一个新的 Date 对象，而不向构造函数传递任何值。像这样：

```
var today:Date = new Date();
trace("The date and time right now is: " + today. toLocaleString());
trace("The date right now is: " + today. toLocaleDateString());
trace("The time right now is: " + today. toLocaleTimeString()); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T14:30:22.230

内置的 Date 类很好地处理了“溢出”，这可以用来增加或减少时间。如果其中一个字段溢出，则日期类通过添加或减去溢出来处理它。

```
var date:Date = new Date(1993, 12, 28);
trace("7 days after the " + date.toLocaleDateString());
date.setDate(date.Date + 7);
trace("It was the " + date.toLocaleDateString()); 
```

# sql - 如何提高其 SET 涉及昂贵的聚合子查询的 SQL UPDATE 语句的性能？

> ID：744058
> 
> 赞同：0
> 
> 时间：2009-04-13T14:28:28.117
> 
> 标签：sql, oracle, performance

我有以下更新场景：

```
UPDATE destTable d
SET d.test_count = ( SELECT COUNT( employee_id )
                     FROM sourceTable s
                     WHERE d.matchCode1 = s.matchCode1 AND
                           d.matchCode2 = s.matchCode2 AND
                           d.matchCode3 = s.matchCode3 
                     GROUP BY matchCode1, matchCode2, matchCode3, employee_id ) 
```

我必须在循环中执行此操作，更改每次迭代的匹配代码。

在两个大表（每个约 500k 条记录）之间，此查询的执行时间长得令人无法接受。如果我只需要执行一次，我不会太在意。鉴于它被执行了大约 20 次，对于我的需要来说它需要的时间太长了。

它需要两次全表扫描（一次用于 destTable，另一次用于子查询）。

问题：

1.  你推荐什么技术来加快这个速度？

2.  SQL 优化器是否为我在 destTable 中更新的每一行运行子查询以满足子查询的 where 子句，或者它是否有一些超级智能可以一次完成这一切？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T14:33:29.227

在`Oracle 9i`及更高：

```
MERGE   
INTO    destTable d
USING   (
        SELECT  matchCode1, matchCode2, matchCode3, COUNT(employee_id) AS cnt
        FROM    sourceTable s
        GROUP BY
                matchCode1, matchCode2, matchCode3, employee_id
        ) so
ON      d.matchCode1 = s.matchCode1 AND
        d.matchCode2 = s.matchCode2 AND
        d.matchCode3 = s.matchCode3 
WHEN MATCHED THEN
UPDATE
SET     d.test_count = cnt 
```

为了加快查询速度，请确保在 in 上有一个复合索引，在in`(matchCode1, matchCode2, matchCode3)`上有一个`destTable`复合索引`(matchCode1, matchCode2, matchCode3, employee_id)``sourceTable`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T14:33:38.323

> 我必须循环执行

您要做的第一件事是将循环构建到您的子查询或 where 子句中。您正在更新数据，然后立即替换您刚刚更新的一些数据。您应该能够过滤您的更新以仅更改适合当前迭代的记录，或者使您的查询足够复杂以更新一个语句中的所有内容 - 可能两者兼而有之。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T14:32:39.120

您是否考虑过 UPDATE FROM 查询？

# java - 进程内 ActiveMQ 生产者/消费者示例？

> ID：744077
> 
> 赞同：3
> 
> 时间：2009-04-13T14:33:06.263
> 
> 标签：java, queue, jms, activemq

我正在研究在我的应用程序中使用 ActiveMQ 作为嵌入式进程内消息队列，但我对如何启动这样的应用程序有点困惑。我的设想是这样的（当然是伪代码）：

```
configureBroker ()
broker.start ()

createProducer (broker)
producer.start ()

for each desired consumer
    createConsumer (broker)
    consumer.start ()

waitForSignal ()
signalProducerShutdown ()

waitForEmptyQueues ()
signalConsumerShutdown ()

broker.stop () 
```

我试图组装一个简单的版本，但我一直坚持如何编写生产者和消费者，以使他们永远工作，或者直到被告知退出。做这个的最好方式是什么？我说的是线程方面。我需要/想要在自己的线程中产生什么，等等......

我对基于消息队列的应用程序完全陌生，所以请详细说明您的示例。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-12-03T18:09:45.667

当您指定 ActiveMQConnectionFactory 时，您可以指定“vm://”，其中 name 是代理的内部虚拟机特定名称，它将在 VM 内启动代理。

例如，

```
String broker = "vm://stackOverflowTest";
ActiveMQConnectionFactory connectionFactory = 
        new ActiveMQConnectionFactory(broker);
Connection amqcon = connectionFactory.createConnection();
amqcon.start(); 
```

从那里您可以创建您的生产者或消费者，就像通过网络一样。只要您为代理使用相同的名称，您就可以让多个线程/代码打开/与同一个 VM 实例通信。

此解决方案仅允许与 VM 通信，不打开任何外部端口。我假设这是您正在寻找的，因为您说您想要嵌入的进程内队列。

# guid - 生成唯一ID的公式？

> ID：744081
> 
> 赞同：3
> 
> 时间：2009-04-13T14:33:53.580
> 
> 标签：guid, uniqueidentifier

我想了解一些关于在不使用 GUID 的情况下生成唯一 ID 的想法。最好我希望唯一值是 int32 类型。

我正在寻找可以用于数据库主键以及对 url 友好的东西。

这些能算Unique吗？

1.  `(int)DateTime.Now.Ticks`
2.  `(int)DateTime.Now * RandomNumber`

还有其他想法吗？

谢谢

编辑：嗯，我正在尝试实践领域驱动设计，我所有的实体在创建时都需要有一个 ID 才有效。理论上我可以调用数据库来获得一个自动递增的数字，但宁愿避开这个，因为数据库相关的东西正在进入域。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T14:39:42.503

这取决于您需要它的独特性以及需要提供 ID 的项目数量。您最好的选择可能是按顺序分配它们；如果您尝试变得花哨，您可能会遇到生日悖论（碰撞的可能性比您预期的要大）或（如您的情况 1）上面）被迫限制您可以发布它们的速率。

在大多数情况下，您的 1) 比 2) 好一点；它的速率是有限的——你不能每次发出超过 1 个 ID——但不容易受到生日悖论的影响。你的 2) 只是扔掉一些东西。与随机数进行异或可能会稍微好一些，但无论如何我认为兰特不会给你买任何东西，只是隐藏问题并使其更难修复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T15:18:01.977

> > 这些被认为是全球唯一的吗？
> 
> 1) (int)DateTime.Now.Ticks 2) (int)DateTime.Now * RandomNumber

这两个选项都不是全球唯一的。

选项 1 - 仅当您可以保证每次报价不超过一个 ID 时，这才是唯一的。根据您的描述，这听起来并不可行。

选项 2 - 随机数是伪随机的，但不保证是唯一的。考虑到这一点，我们可以将此选项的 DateTime 部分减少为与选项 1 类似的问题。

如果您想要一个全局唯一 ID，它是一个 int32，一个好方法是某种返回顺序 ID 的同步服务。我想这取决于您对全局的定义是什么意思。如果您的工作量大于 int32，并且您的意思是在给定网络上是全局的，那么也许您可以使用附加序列号的 IP 地址，其中序列号是跨进程同步生成的。

如果您有除 IP 地址之外的其他唯一标识符，那么这显然是作为 URL 的一部分显示的更好选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T14:40:57.213

如果您使用的是 .NET，则可以使用 RNGCryptoServiceProvider 类

[RNGCryptoServiceProvider 类](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rngcryptoserviceprovider.aspx "RNGCryptoServiceProvider 类")

# django - 如何在 Django 模型中轻松地将记录标记为已删除，而不是实际删除它们？

> ID：744084
> 
> 赞同：13
> 
> 时间：2009-04-13T14:34:30.753
> 
> 标签：django, django-models

我不想删除我的 Django 应用程序中的记录，我只想将它们标记为“已删除”，并将它们隐藏在我的活动查询中。我这样做的主要原因是为用户提供取消删除选项，以防他们意外删除记录（某些后端审计跟踪也可能需要这些记录。）

有很多外键关系，所以当我将记录标记为已删除时，我也必须将此删除标志“级联”到这些记录。我应该使用哪些工具、现有项目或方法来做到这一点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-29T07:42:27.970

警告：这是一个旧答案，似乎文档建议现在不要这样做：[https ://docs.djangoproject.com/en/dev/topics/db/managers/#don-t-filter-away-这种类型的经理子类中的任何结果](https://docs.djangoproject.com/en/dev/topics/db/managers/#don-t-filter-away-any-results-in-this-type-of-manager-subclass)

Django 开箱即用地提供了您正在寻找的确切机制。

您可以更改用于通过相关对象进行访问的管理器。如果您的新自定义管理器在布尔字段上过滤对象，则标记为非活动的对象将不会显示在您的请求中。

有关更多详细信息，请参见此处：http: [//docs.djangoproject.com/en/dev/topics/db/managers/#using-managers-for-related-object-access](http://docs.djangoproject.com/en/dev/topics/db/managers/#using-managers-for-related-object-access)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T14:38:48.137

好问题，我一直想知道如何自己有效地做到这一点。

我不确定这是否可以解决问题，但是[django-reversion](https://github.com/etianen/django-reversion)似乎可以满足您的要求，尽管您可能想检查一下它是如何实现这一目标的，因为有一些低效的方法可以做到这一点。

另一个想法是在模型上添加可怕的布尔标志，然后创建一个自定义管理器，自动添加过滤器，尽管这不适用于跨不同模型的搜索。[此处建议](http://jtauber.com/blog/2008/12/19/marking_for_deletion_in_django/)的另一个解决方案是对所有内容进行重复模型，这似乎有点过头了，但可能对您有用。那里的评论还讨论了不同的选择。

我要补充一点，在大多数情况下，我认为这些解决方案中的任何一个都不值得麻烦。我通常只是把它吸起来，然后在布尔标志上过滤我的搜索。如果您尝试变得太聪明，它可以避免许多可能出现的问题。当然，这是一种痛苦，而且不是很干燥。如果您尝试通过它搜索相关模型，一个合理的解决方案将是自定义管理器的混合，同时意识到它的局限性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T23:48:15.477

我认为使用布尔“is_active”标志很好——你不需要将标志级联到数据库级别的相关条目，你只需要继续引用父级的状态。这就是 contrib.auth 的 User 模型所发生的情况，请记住 - 将用户标记为 not is_active 不会提示 django 遍历相关模型并神奇地尝试停用记录，而您只需继续检查用户对应的 is_active 属性相关项。

例如，如果每个用户都有很多书签，并且您不希望非活动用户的书签可见，只需确保 bookmark.user.is_active 为 true。书签本身不太可能需要 is_active 标志。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-01-05T18:39:39.543

这是几年前 Greg Allard 的一个快速博客教程，但我使用 Django 1.3 实现了它，它很棒。我向名为 soft_delete、undelete 和 hard_delete 的对象添加了方法，它们分别设置 self.deleted=True、self.deleted=False 和返回 self.delete()。

[用于软删除记录的 Django 模型管理器以及如何自定义 Django Admin](http://codespatter.com/2009/07/01/django-model-manager-soft-delete-how-to-customize-admin/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-03T09:06:01.333

有几个提供此功能的软件包：[https ://www.djangopackages.com/grids/g/deletion/](https://www.djangopackages.com/grids/g/deletion/)

我正在开发一个[https://github.com/meteozond/django-permanent/](https://github.com/meteozond/django-permanent/) 它取代了默认的 Manager 和 QuerySet 删除方法来引入逻辑删除。它完全隐藏了默认的 Django 删除方法，但有一个例外 - 标记从 PermanentModel 继承而不是删除的模型，即使它们的删除是由关系引起的。

# c# - 为什么是列表 .ForEach 比标准 foreach 快吗？

> ID：744085
> 
> 赞同：2
> 
> 时间：2009-04-13T14:34:32.687
> 
> 标签：c#, .net, list, foreach, benchmarking

考虑一下：

必备：

```
//The alphabet from a-z
List<char> letterRange = Enumerable.Range('a', 'z' - 'a' + 1)
.Select(i => (Char)i).ToList(); //97 - 122 + 1 = 26 letters/iterations 
```

标准foreach：

```
foreach (var range in letterRange)
{
    Console.Write(range + ",");
}
Console.Write("\n"); 
```

内置foreach：

```
letterRange.ForEach(range => Console.Write(range + ",")); //delegate(char range) works as well
Console.Write("\n"); 
```

我尝试过将它们相互定时，内置的 foreach 速度提高了 2 倍，这似乎很多。

我已经用谷歌搜索了，但我似乎找不到任何答案。

另外，关于：[在 .NET 中，哪个循环运行得更快，“for”还是“foreach”？](https://stackoverflow.com/questions/365615/in-c-net-which-loop-runs-faster-for-or-foreach)

```
for (int i = 0; i < letterRange.Count; i++)
{
    Console.Write(letterRange[i] + ",");
}
Console.Write("\n"); 
```

据我所知，它的执行速度并不比标准 foreach 快。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-13T14:39:54.907

我认为你的基准是有缺陷的。`Console.Write`是一项 I/O 绑定任务，它是基准测试中最耗时的部分。这是一个微基准，应该非常仔细地完成以获得准确的结果。

这是一个基准：[http](http://diditwith.net/PermaLink,guid,506c0888-8c5f-40e5-9d39-a09e2ebf3a55.aspx) ://diditwith.net/PermaLink,guid,506c0888-8c5f-40e5-9d39-a09e2ebf3a55.aspx （看起来不错，但我自己还没有验证过）。**截至 2015 年 8 月 14 日，该链接似乎已断开**

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-13T14:45:50.727

当您进入一个 foreach 循环时，您将枚举每个项目。该枚举每次迭代会导致两个方法调用：一个 to `IEnumerator<T>.MoveNext()`，另一个 to `IEnumerator<T>.Current`。那是两条`call`IL 指令。

`List<T>.ForEach`更快，因为它每次迭代只有一个方法调用——无论你提供的`Action<T>`委托是什么。**这是一条`callvirt`IL 指令。这比两条`call`指令快得多。**

正如其他人指出的那样，IO 绑定指令`Console.WriteLine()`会污染您的基准。做一些可以完全限制在记忆中的事情，比如把一个序列的元素加在一起。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T14:39:52.987

这是因为 foreach 方法没有使用枚举器。枚举器（foreach）往往比基本的 for 循环慢：

这是 ForEach 方法的代码：

```
public void ForEach(Action<T> action)
{
    if (action == null)
    {
        ThrowHelper.ThrowArgumentNullException(ExceptionArgument.match);
    }
    for (int i = 0; i < this._size; i++)
    {
        action(this._items[i]);
    }
} 
```

虽然我预计会有差异，但我有点惊讶它和你所说的一样大。使用枚举器方法，您将创建一个额外的对象，然后采取额外的步骤来确保枚举器不会失效（修改集合）。您还通过一个额外的函数调用 Current() 来获取成员。所有这些都增加了时间。

# apache - 使用 .htaccess 重定向

> ID：744087
> 
> 赞同：2
> 
> 时间：2009-04-13T14:35:06.227
> 
> 标签：apache, .htaccess, http-status-code-302

我想将所有用户页面请求重定向到同一域上的页面。

例如，我有一个“正在建设中，BRB”页面，我希望所有用户在尝试访问站点上的任何页面时都能看到该页面。

我尝试使用这个：

```
Redirect 302 / http://www.domain.com/index2.php 
```

这样做的目的是尝试将重定向也应用到 index2.php 页面，但它会卡在一个循环中，然后用户会看到这个循环，直到浏览器停止。

```
http://www.domain.com/index2.phpindex2.phpindex2.phpindex2.php etc., etc, 
```

关于如何将该规则写入除该页面之外的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T15:41:15.320

您必须排除要重定向到的文件。这是 mod_rewrite 的示例：

```
<IfModule mod_rewrite.c>
    RewriteEngine on
    RewriteRule !^index2\.php$ /index2.php [L,R=302]
</IfModule> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-26T01:37:49.323

### 为了防止无限循环（index2.php <--> index2.php）：

仅重定向如果要重定向的 URL 不包含字符串 'index2.php'

```
RewriteCond %{QUERY_STRING} !index2.php
RewriteRule ^(.*)$ /index2.php [L,R=301] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T14:58:43.333

你可以使用 mod_rewrite

``<IfModule mod_rewrite.c>`
RewriteCond {REQUEST_URI} !=/index2.php
RewriteEngine on
RewriteRule ^.*$ /index2.php
# End .HTACCESS
`</IfModule>`` 

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T15:37:17.623

我会更倾向于使用略有不同的

```
Options +FollowSymLinks 
<IfModule mod_rewrite.c>
    RewriteEngine on 
    RewriteRule ^/.*$ /index2.php [R=307,L]
</IfModule> 
```

这将使您返回重定向的临时移动状态。

省略这组标志意味着 mod_rewrite 默认会返回 302 Found 状态。

高温高压

干杯，

# text - 在批处理文件中显示文本文件中的行

> ID：744094
> 
> 赞同：0
> 
> 时间：2009-04-13T14:36:50.780
> 
> 标签：text, batch-file, numbers, lines

我试图找到一个脚本，让我在批处理文件中的文本文件中显示“linenumber# 和 linenumber# 以及lines#-#”？我在这个网站上找到了这个脚本..

```
@echo off
setlocal enabledelayedexpansion
if [%1] == [] goto usage
if [%2] == [] goto usage

SET /a counter=0

for /f "usebackq delims=" %%a in (%2) do (
if "!counter!"=="%1" goto exit
echo %%a
set /a counter+=1
)

goto exit

:usage
echo Usage: head.bat COUNT FILENAME

:exit 
```

而且效果很好:) 但它会从文本文件的顶部获取行数。我希望能够在文本文件中显示某些行，以及一个范围（如果可能）。

EG：我有一个 30 行的文本文件，我想显示第 1-4 行；7-11；13; 17-20; 22; 26 和 29

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T16:03:00.883

这是对上面示例批处理文件的简单修改。将下面的代码复制到文件中并将其命名为“LineDisplay.bat” - 它以 FirstLineNumber 和 LastLineNumber 作为参数。示例：LineDisplay test.txt 12 30（读取第 12-30 行）

```
@echo off
setlocal enabledelayedexpansion
if [%1] == [] goto usage
if [%2] == [] goto usage
if [%3] == [] goto usage

set /a FirstLineNumber = %2
set /a LastLineNumber = %3

echo Reading from Line !FirstLineNumber! to !LastLineNumber!

SET /a counter=1

for /f "usebackq delims=" %%a in (%1) do (
    if !counter! GTR !LastLineNumber! goto exit
    if !counter! GEQ !FirstLineNumber! echo !counter! %%a
    set /a counter+=1
)

goto exit

:usage
echo Usage: LineDisplay.bat FILENAME FirstLineNumber LastLineNumber

:exit 
```

[这是关于创建批处理文件http://vtatila.kapsi.fi/batch_tutorial.html](http://vtatila.kapsi.fi/batch_tutorial.html "Batch File Tutorial")的一个很好的教程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T16:01:15.583

似乎工作：

```
@ECHO OFF
REM Show usage and quit if no file name was given
IF [%1]==[] GOTO USAGE
REM Show entire file if no range was given
IF [%2]==[] TYPE %1 & GOTO :EOF

SETLOCAL ENABLEEXTENSIONS ENABLEDELAYEDEXPANSION

SET FILENAME=%1
SET LASTLINE=0

REM Build the array of lines to display
SHIFT
:RANGEREADLOOP
CALL :BUILDARRAY %1
SHIFT
IF NOT [%1]==[] GOTO RANGEREADLOOP

REM Loop through the file and keep track of the lines to display
SET CURRENTLINE=0
SET INDEX=1
FOR /F "delims=" %%l in (%FILENAME%) DO (
    SET LINE=%%l
    CALL :PRINTLINE
)

GOTO :EOF

REM Adds the lines from the specified range to the array of lines to display
:BUILDARRAY
    REM Find out whether we have a single line or a range
    SET TEST=%1
    SET /A TEST1=%TEST%
    SET /A TEST2=%TEST:-=%
    IF %TEST1%==%TEST2% (
        REM Single line
        SET /A LASTLINE+=1
        SET LINES[!LASTLINE!]=%1
    ) ELSE (
        REM Range
        FOR /F "tokens=1,2 delims=-" %%x IN ("%1") DO (SET RANGESTART=%%x&SET RANGEEND=%%y)
        REM Some sanity checking
        IF !RANGESTART! GTR !RANGEEND! (
            ECHO.Problem with range !RANGESTART!-!RANGEEND!:
            ECHO.  Ranges must have a start value smaller than the end value.
            EXIT /B 1
        ) ELSE (
            FOR /L %%i IN (!RANGESTART!,1,!RANGEEND!) DO (
                SET /A LASTLINE+=1
                SET LINES[!LASTLINE!]=%%i
            )
        )
    )
GOTO :EOF

REM Prints the specified line if the current line should be printed
:PRINTLINE
    SET /A CURRENTLINE+=1
    IF %CURRENTLINE%==!LINES[%INDEX%]! (
        REM We have a line to print, so do this
        ECHO !LINE!
        SET /A INDEX+=1
    )
GOTO :EOF

REM Prints usage and exits the batch file
:USAGE
    ECHO.%~n0 - Displays selected lines from a text file.
    ECHO.
    ECHO.Usage:
    ECHO.  %~n0 ^<filename^> ^<range^> ...
    ECHO.
    ECHO.  ^<filename^> - the text file from which to read
    ECHO.  ^<range^>    - the line range(s) to display.
    ECHO.
    ECHO.Example:
    ECHO.  %~n0 foo.txt 1-4 13 15 18-20
    ECHO.
    ECHO.  will display the first four lines from the file "foo.txt",
    ECHO.  the 13th and 15th as well as the lines 18 to 20.
    ECHO.
    ECHO.Line ranges are separated by comma, semicolon or space. If no range is given,
    ECHO.the entire file is displayed.
    EXIT /B 1
GOTO :EOF 
```

整个脚本可以使用一些更好的错误检查，例如不该做什么或错误检查有点不靠谱的例子：

*   `dl foo.txt 1-2-4` （打印第 1-2 行但没有错误消息）
*   `dl foo.txt -1` （范围 1- 不正确的错误消息）

其他限制：

*   范围必须排序。对于当前的实现，没有办法做类似`dl foo.txt 7-8,1-2`.
*   不能选择两次。类似的东西`dl foo.txt 1,2,2-8,11-15`会在第二行之后停止。
*   不支持 UNIX 样式的行尾 (U+000A)

**编辑：**修复了包含括号的文件的问题。

# java - 在哪里可以找到需要 Java 6 的小程序？

> ID：744096
> 
> 赞同：1
> 
> 时间：2009-04-13T14:37:26.143
> 
> 标签：java, applet, java-6

我目前在 Windows 上安装了 Java 5。当我的 Firefox 浏览器遇到需要 Java 6 的小程序时，我正在尝试测试新 Java 内核的安装方式。不幸的是，我尝试的小程序无法运行或仅运行 Java 5 JVM。我努力了：

1.  [http://jdk6.dev.java.net/plugin2/](http://jdk6.dev.java.net/plugin2/)
2.  [http://www.psynixis.com/test/HelloJava6Applet.html](http://www.psynixis.com/test/HelloJava6Applet.html)
3.  [http://bfo.co.uk/products/pdf/viewer.jsp](http://bfo.co.uk/products/pdf/viewer.jsp)

谁能指出我需要 Java 6 的其他小程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T14:50:27.033

尝试

[http://www.java.com/en/download/installed.jsp?detect=jre&try=1](http://www.java.com/en/download/installed.jsp?detect=jre&try=1)

他们在后台使用小程序来确定您正在运行的 Java 版本。

**更新：**它会告诉你你在 URL 中运行的版本：

[http://www.java.com/en/download/dt_verify.jsp?plugin=false&latest=false&](http://www.java.com/en/download/dt_verify.jsp?plugin=false&latest=false&) **users_jre=1.5.0**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T19:46:36.870

很少见到需要 1.6 的 Applet。毕竟，我认为小程序使用的任何东西都不需要 Java 6。

一个更快的查看方法是卸载 Java 5，然后尝试运行一个小程序......您可能会被提示下载 Java 6u13。

# apache - jboss url解码

> ID：744106
> 
> 赞同：0
> 
> 时间：2009-04-13T14:40:04.470
> 
> 标签：apache, servlets, jboss

我们有一个托管在 jboss 上的 servlet，它适用于 HttpServletRequest。但是有时我们会收到没有被 jboss 解码的请求，当我们对 HttpServletRequest 执行 getQueryParam 时，我们会得到 null。jboss 访问日志以编码形式显示 url。通常，当一切顺利时，url 会在访问日志中显示解码。例如：

这是一个有问题的请求：

```
127.0.0.1 [13/Apr/2009:14:18:53 +0000] GET /redirectService//%3Fclient_id=3&redirect_url=http%253A%252F%252Fwww.amazon.de%252Fgp%252Fsearch%253Fie%253DUTF8%2526keywords%253DMicrosoft+Office+2007%2526search-alias%253Dsoftware%2526 HTTP/1.1 'null' 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.12)' 
```

这是一个适当的要求：

```
127.0.0.1 [13/Apr/2009:14:19:37 +0000] GET /redirectService//?client_id=3&redirect_url=http%3A%2F%2Fwww.amazon.de%2Fgp%2Fsearch%3Fie%3DUTF8%26keywords%3DMAGIX+Video+deluxe+2008%26search-alias%3Dsoftware%26 HTTP/1.1 'http://www.google.de/search?hl=de&q=magix+video+deluxe+2008&meta=&aq=3&oq=%22magix%22' 'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506; .NET CLR 1.1.4322)' 
```

我们是否会遗漏一些 jboss 解码设置，或者只是恶意用户的情况？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-14T05:33:44.210

我们记录了用户代理，在大多数情况下它是一些可疑的“XXXagentXXX”，但在其他情况下是真正的 Mozilla（如上）。对于所有这些请求，推荐人都是“-”。然而，我今天注意到一件奇怪的事情。我们将请求从 apache (80) 重定向到 jboss。Apache 访问日志将上述请求显示为完全编码：

```
GET /r/%3Fclient_id%3D3%26redirect_url%3Dhttp%253A%252F%252Fwww.amazon.de%252Fgp%252Fsearch%253Fie%253DUTF8%2526keywords%253DCyberlink%2BPower%2BDirector%2526search-alias%253Dsoftware HTTP/1.0" 400 965 "-" "Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.1.10)" 
```

而 jboss 访问日志中除了 %3F 之外的所有内容都已解码。现在这让我觉得 apache 在解码的某个地方搞砸了？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T15:52:59.207

很难说，真的。

客户端似乎将问号解码为“%3F”，而不是 & 符号。可疑，不是吗？这看起来像一个错误的客户端 IMO。也许是不可移植的 javascript，也许是 Web 服务器端的一些 URL 重写错误，或者更深奥的原因……浏览器插件故障。

要排除不可移植的 javascript，请记录用户代理并比较结果。要排除 url 重写错误，请记录 referer。

AFAIK，URL 解码器行为是硬编码的。如果 uri 用非 ascii 或非 iso88591 编写，则字符串编码可能会发生变化，但这不是您所追求的。编码问号但未能编码＆符号的东西让我无法理解。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-02-25T13:08:38.827

我在使用 JBoss 13 解码 URL 时也遇到了问题。

我在 JBoss 配置中添加了最后一行，它现在可以工作了。

```
/subsystem=undertow/servlet-container=default:write-attribute(name=default-encoding,value="ISO-8859-15")
/subsystem=undertow/server=default-server/http-listener=default:write-attribute(name=url-charset,value="ISO-8859-15") 
```

如果需要更多文档，请在此处：[https ://wildscribe.github.io/WildFly/13.0/subsystem/undertow/server/http-listener/index.html](https://wildscribe.github.io/WildFly/13.0/subsystem/undertow/server/http-listener/index.html)

# c++ - CEdit 数字验证事件 C++ MFC

> ID：744110
> 
> 赞同：4
> 
> 时间：2009-04-13T14:42:12.467
> 
> 标签：c++, events, mfc, numeric, cedit

我有一个 CEdit 文本框，它是属性窗格的一部分，只允许数值（正整数）。当人们输入非数字值时，该框工作正常，但当他们删除框中的值时，会弹出一个对话框：“请输入一个正整数。”

情况如下：
1\. 我在盒子里有一个数字（比如 20）。
2.我删了号码。
3\. 我得到错误对话框。
谁能告诉我如何拦截此事件并在其中设置默认值？

这是我的属性窗格的样子：

```
 const int DEFAULT_VALUE = 20;

class MyPropertyPane:public CPropertyPane
{
    //....
private:
    CEdit m_NumericBox;
    int   m_value;

    //....
public:
    afx_msg void OnEnChangeNumericBox();

    //....
}
void MyPropertyPane::MyPropertyPane()
{
   // Set a default value
   m_value = DEFAULT_VALUE;
}

//....
void MyPropertyPane::DoDataExchange(CDataExchange* pDX)
{
    DDX_Control(pDX, IDC_NUMERIC_BOX, m_NumericBox);

    // this sets the displayed value to 20
    DDX_Text(pDX, IDC_NUMERIC_BOX, m_value);
}

//....
void MyPropertyPane::OnEnChangeNumericBox()
{
    // Somebody deleted the value in the box and I got an event
    // saying that the value is changed.

    // I try to get the value from the box by updating my data
    UpdateData(TRUE);

    // m_value is still 20 although the value is 
    // deleted inside the text box.
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-13T14:48:42.717

您收到的消息来自数据验证例程，而不是数据交换例程。DoDataExchange() 中可能有这样的调用：

```
void MyPropertyPane::DoDataExchange(CDataExchange* pDX)
{
    DDX_Control(pDX, IDC_NUMERIC_BOX, m_NumericBox);
    DDX_Text(pDX, IDC_NUMERIC_BOX, m_value);
    DDV_MinMaxInt(pDX, m_value, 1, 20); // if the value in m_value is outside the range 1-20, MFC will pop up an error dialog
} 
```

您可以通过删除内置的 MFC 数据验证并添加您自己的来解决此问题：

```
void MyPropertyPane::DoDataExchange(CDataExchange* pDX)
{
    DDX_Control(pDX, IDC_NUMERIC_BOX, m_NumericBox);
    DDX_Text(pDX, IDC_NUMERIC_BOX, m_value);

    if( m_value < 1 || m_value > 20 )
    {
        m_value = DefaultValue;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T15:26:18.350

John Dibling 的提示让我找到了这个解决方案：

```
 void MyPropertyPane::OnEnChangeNumericBox()
{
    UpdateData(TRUE);
    CString value;
    m_NumericBox.GetWindowText(value);
    if( value.IsEmpty() )
    {
        m_value = DEFAULT_VALUE;
        UpdateData(FALSE);
    }
} 
```

我真正需要做的唯一验证是检查该框是否包含一个值，因为实际的数字验证已由该框处理。用户不能输入非数字值，但他们可以删除现有的值，因此这是数据交换功能中难以处理的情况，我不得不“破解” OnChange 事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-22T04:00:24.927

**这个对我有用**

```
void CtimersDlg::OnEnChangeInterval()
{
   CString value; //or use char *
   CWnd *pWnd = GetDlgItem(IDC_INTERVAL);//IDC_EDITBOX

   if(pWnd)
   {
      pWnd->GetWindowTextW(value);
   }

   int i = _wtoi(value); //if char * use _atol()
   if((!value.IsEmpty())&& (i))  //To check i = 0 or 00 entered or not
      UpdateData(TRUE);
} 
```

# c# - 为什么 MailDefinition 类需要 System.Web.UI.Control？

> ID：744117
> 
> 赞同：14
> 
> 时间：2009-04-13T14:44:35.330
> 
> 标签：c#, asp.net, mailmessage

通过调用 MailDefinition 类的“CreateMailMessage”方法创建 MailMessage 对象时，第三个参数是 System.Web.UI.Control 类型的对象。

```
MailDefinition mail = new MailDefinition();

ListDictionary replacements = new ListDictionary();
replacements.Add("<%myname%>", "John");

mail.BodyFileName = "~/App_Data/Emails/SomeEmail.txt";
mail.From = "me@example.com";
mail.Subject = "Hello";

MailMessage message = mail.CreateMailMessage("example@example.com,", replacements, ); 
```

这是为什么？
如果我没有那种类型的对象，我应该传递什么？只是一个新的 Control 对象？

```
Control control = new Control(); 
```

**更新**

我强烈推荐使用[Razor](http://razorengine.codeplex.com/)来构建电子邮件模板。它有很好的语法，很好用，而且没有任何奇怪的依赖！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T14:51:22.413

通常你只是`this`作为控制传递。

```
MailMessage message = mail.CreateMailMessage("example@example.com,", replacements, this); 
```

至于原因，[这里是 MSDN 所说的：](http://msdn.microsoft.com/en-us/library/0002kwb2.aspx)

> owner 参数指示哪个控件是 MailDefinition 控件的父级。它确定在哪个目录中搜索 BodyFileName 属性中指定的文本文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-01-26T11:19:01.090

**CreateMailMessage**函数在内部使用指定的**Control**来查询它的**AppRelativeTemplateSourceDirectory**属性和它的**OpenFile**方法来读取正文的内容（在 MailDefinition 的**BodyFileName**属性中**指定**）。

对我来说，这似乎是糟糕的设计和不必要的紧密耦合。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-02-26T20:59:23.553

你也可以这样做：

```
MailMessage message = this.Mail.CreateMailMessage("no-reply@example.com", dictionary, new System.Web.UI.Control()); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-28T00:25:53.867

我一直在使用`new LiteralControl()`第三个参数，因为我的消息是从工作流发送的。有用。但我没有“为什么”的答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T15:01:03.780

如果您没有绑定到任何控件，听起来您可能根本不需要使用 MailDefinition 类。要简单地通过 smtp 发送电子邮件，您应该使用 System.Net.Mail.SmtpClient 和 System.Net.Mail.MailMessage。

# vmware - 推荐的虚拟化硬件规格是什么？

> ID：744122
> 
> 赞同：1
> 
> 时间：2009-04-13T14:46:58.447
> 
> 标签：vmware, virtualization, esx

我们是一家初创公司，还没有投资硬件资源来准备我们的开发和测试环境。建议是购买高端服务器，安装 vmware ESX 并部署多个 VM 用于构建、TFS、数据库……用于测试、调试和开发环境。我们仍然不确定要搭配哪些规格，例如 RAM、是否需要 SAN？、HD、处理器等。

请指教。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T00:59:09.973

You haven't really given much information to go on. It all depends on what type of applications you're developing, resource usage, need to configure different environments, etc.

Virtualization provides cost savings when you're looking to consolidate underutilized hardware. If each environment is sitting idle most of the time, then it makes sense to virtualize them.

However if each of your build/tfs/testing/staging/dev environments will be heavily used by all developers during the working day simultaniously then there might not be as many cost savings by virtualizing everything.

My advice would be if you're not sure, then don't do it. You can always virtualize later and reuse the hardware.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T15:00:19.973

这是一个非常开放的问题，确实有一个最佳答案......“这取决于”。

如果你有钱为你需要的一切购买单独的机器，那就走那条路。您可以使用此选项在硬件上缩减一点。

如果您没有钱购买单台机器，那么您可能需要为此考虑高端服务器。如果这是你的路线，我会看一台至少有 8GB RAM 和多个 NIC 的四核机器。您可以使用具有多个硬盘驱动器托架的服务器盒，您可以在其上设置多个 RAIDS。我建议您使用 RAID 5，以便获得冗余。

有了这样的东西，您可以毫无问题地运行多个 VMWare 会话。

我在上一份工作中设置了一个 10TB 的盒子。它有 2 个 NIC，8GB，并且是四台机器。包括的一切费用约为 9.5K

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-14T00:57:34.360

您的硬件要求将在一定程度上取决于您希望这些东西具有什么样的可靠性。如果您使用它来运行所有内容，我建议您至少有两台机器将虚拟机分开，如果您正常使用 N 台服务器，您应该能够在其中的 N-1 台上获得您的供应商更换坏零件所需的时间。

在低端，这是 2 台服务器。如果您想要更高的可靠性（即更少的停机时间），那么将需要某种类型的 SAN 来存储数据（我见过的所有实时迁移都是基于 SAN 的）。如果您可以使用“手动”方法（关闭两台服务器，将驱动器从服务器 1 移动到服务器 2，启动服务器 2，重新配置虚拟机以使用更少的内存并启动），那么您实际上并不需要 SAN 路由。

At the end of the day, your biggest sizing *requirement* will be HD and RAM. Your HD footprint will be relatively fixed (at least in most kinds of a dev/test environment), and your RAM footprint should be relatively fixed as well (though extra here is always nice). CPU is usually one thing you can skimp on a little bit if you have to, so long as you're willing to wait for builds and the like.

The other nice thing about going all virtualized is that you can start with a pair of big servers and grow out as your needs change. Need to give your dev environment more power? Get another server and split the VMs up. Need to simulate a 4-node cluster? Lower the memory usage of the existing node and spin up 3 copies.

At this point, unless I needed very high-end performance (ie. I need to consider clustering high-end physical servers for performance needs), I'd go with a virtualized environment. With the extensions on modern CPUs and OS/hypervisor support for them, the hit is not that big if done correct.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-25T16:38:47.397

If you can't afford to buy the single machines then you probably are not in a good position to start re-usably with virtualisation.

One way you can do it is take the minimum requirements for all your systems, i.e. TFS, mail, web etc., add them all together and that will give you an idea of half the minimum server you need to host all those systems. Double it and you be near what will get you buy, if you have spare cash double/triple the RAM. Most OSes run better with more RAM to particular ceiling. Think about buying expandable storage of some kind and aim for half populated to start with which will keep the initial cost/GB and make for some expansion at lower cost in the future.

You can also buy servers which take multiple CPUs but only put in the minimum amount of CPUs. Also go for as many cores on a CPU as you can get for thermal, physical and licensing efficiency.

I appreciate this is a very late reply but as I didn't see many ESX answers here I wanted to post a reply though my post equally relates to Hyper-V etc.

# python - 我需要一个 Python 函数，当给定所需的字符概率时，它将输出 4 个不同字符的随机字符串

> ID：744127
> 
> 赞同：2
> 
> 时间：2009-04-13T14:48:24.043
> 
> 标签：python, random

例如，函数可能类似于 def RandABCD(n, .25, .34, .25, .25)：

其中 n 是要生成的字符串的长度，后面的数字是 A、B、C、D 的期望概率。

我想这很简单，但是我在创建工作程序时遇到了麻烦。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T15:20:34.467

这是选择单个加权值的代码。你应该可以从这里拿走它。它使用[bisect](http://docs.python.org/library/bisect.html#bisect.bisect)和[random](http://docs.python.org/library/random.html#random.random)来完成工作。

```
from bisect import bisect
from random import random

def WeightedABCD(*weights):
  chars = 'ABCD'
  breakpoints = [sum(weights[:x+1]) for x in range(4)]
  return chars[bisect(breakpoints, random())] 
```

像这样称呼它：`WeightedABCD(.25, .34, .25, .25)`。

**编辑：这是一个即使权重不等于 1.0 也可以工作的版本：**

```
from bisect import bisect_left
from random import uniform

def WeightedABCD(*weights):
  chars = 'ABCD'
  breakpoints = [sum(weights[:x+1]) for x in range(4)]
  return chars[bisect_left(breakpoints, uniform(0.0,breakpoints[-1]))] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T15:00:50.487

随机类在python中非常强大。您可以生成具有适当权重所需字符的列表，然后使用 random.choice 获得选择。

首先，确保您进行随机导入。

例如，假设您想要一个来自 A、B、C 或 D 的真正随机字符串。 1\. 生成一个包含字符 li = ['A','B','C','D'] 的列表

2.  然后使用 random.choice output = "".join([random.choice(li) for i in range(0, n)]) 从中获取值

您可以轻松地将其设为以 n 作为参数的函数。

在上述情况下，您获得 A、B、C 或 D 的机会均等。

您可以使用列表中的重复条目来赋予字符更高的概率。因此，例如，假设您希望 A 的概率分别为 50%，B 和 C 的概率分别为 25%。你可以有一个这样的数组：

li = ['A','A','B','C']

等等。

参数化具有所需权重的字符并不难，以建模我将使用字典。

characterbasis = {'A':25, 'B':25, 'C':25, 'D':25}

使第一个参数，第二个是字符串的长度，并使用上面的代码来生成你的字符串。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T15:11:11.400

对于四个字母，这是我脑海中快速想到的东西：

```
from random import random

def randABCD(n, pA, pB, pC, pD):
    # assumes pA + pB + pC + pD == 1
    cA = pA
    cB = cA + pB
    cC = cB + pC
    def choose():
        r = random()
        if r < cA:
           return 'A'
        elif r < cB:
           return 'B'
        elif r < cC:
           return 'C'
        else:
           return 'D'
    return ''.join([choose() for i in xrange(n)]) 
```

我毫不怀疑这可以变得更干净/更短，我现在只是有点着急。

在 Dakota 的使用重复字符列表的回答中，我不满意 David 的原因是，根据您的概率，可能无法创建一个包含正确数字重复的列表来模拟您想要的概率。（好吧，我想这可能总是有可能的，但你最终可能需要一个巨大的列表 - 如果你的概率是 0.11235442079、0.4072777384、0.2297927874、0.25057505341 怎么办？）

*编辑*：这是一个更干净的通用版本，适用于任意数量的任意重量的字母：

```
from bisect import bisect
from random import uniform

def rand_string(n, content):
    ''' Creates a string of letters (or substrings) chosen independently
        with specified probabilities. content is a dictionary mapping
        a substring to its "weight" which is proportional to its probability,
        and n is the desired number of elements in the string.

        This does not assume the sum of the weights is 1.'''
    l, cdf = zip(*[(l, w) for l, w in content.iteritems()])
    cdf = list(cdf)
    for i in xrange(1, len(cdf)):
        cdf[i] += cdf[i - 1]
    return ''.join([l[bisect(cdf, uniform(0, cdf[-1]))] for i in xrange(n)]) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T15:16:33.023

这是一个适合您的粗略想法

```
import random as r

def distributed_choice(probs):
    r= r.random()
    cum = 0.0

    for pair in probs:
        if (r < cum + pair[1]):
            return pair[0]          
        cum += pair[1] 
```

该参数`probs`采用形式对（对象，概率）的列表。假设概率之和为 1（否则，归一化很简单）。

要使用它，只需执行：

```
''.join([distributed_choice(probs)]*4) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T15:21:31.123

嗯，有点像：

```
import random
class RandomDistribution:
    def __init__(self, kv):
        self.entries = kv.keys()
        self.where = []
        cnt = 0
        for x in self.entries:
            self.where.append(cnt)
            cnt += kv[x]
        self.where.append(cnt)   

    def find(self, key):
        l, r = 0, len(self.where)-1
        while l+1 < r:
           m = (l+r)/2
           if self.where[m] <= key:
               l=m
           else:
               r=m
        return self.entries[l]

    def randomselect(self):
        return self.find(random.random()*self.where[-1])

rd = RandomDistribution( {"foo": 5.5, "bar": 3.14, "baz": 2.8 } )
for x in range(1000):
    print rd.randomselect() 
```

应该让你大部分时间......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-14T12:50:06.330

谢谢大家的帮助，我能够弄清楚一些事情，主要是通过这些信息。对于我的特殊需要，我做了这样的事情：

```
import random
#Create a function to randomize a given string
def makerandom(seq):
    return ''.join(random.sample(seq, len(seq)))
def randomDNA(n, probA=0.25, probC=0.25, probG=0.25, probT=0.25):
    notrandom=''
    A=int(n*probA)
    C=int(n*probC)
    T=int(n*probT)
    G=int(n*probG)

#The remainder part here is used to make sure all n are used, as one cannot
#have half an A for example.
    remainder=''
    for i in range(0, n-(A+G+C+T)):
        ramainder+=random.choice("ATGC")
    notrandom=notrandom+ 'A'*A+ 'C'*C+ 'G'*G+ 'T'*T + remainder
    return makerandom(notrandom) 
```

# java - 在 GWT 应用程序中外部化 HTML 的最佳方法？

> ID：744137
> 
> 赞同：19
> 
> 时间：2009-04-13T14:51:56.453
> 
> 标签：java, html, gwt

在 GWT 应用程序中**外部化大量 HTML**的最佳方法是什么？我们有一个相当复杂的 GWT 应用程序，大约有 30 个“页面”；每个页面的底部都有一个指南，它是几段 HTML 标记。我想将 HTML 外部化，以便它可以尽可能地保持“未转义”。

我知道并了解如何在 GWT中使用**属性文件；**这当然比在 Java 类中嵌入内容要好，但对于 HTML 来说仍然有点难看（你需要对所有内容进行反斜杠，以及转义引号等）

**通常这是您将放在 JSP 中的那种东西**，但我没有看到任何与 GWT 中的等效项。我正在考虑编写一个小部件，它将简单地从服务器上的 html 文件中获取内容，然后将文本添加到 HTML 小部件中。但似乎应该有一个更简单的方法。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2010-10-31T12:09:56.590

我在类似的设置中使用了 ClientBundle。我创建了一个包 my.resources 并将我的 HTML 文档和以下类放在那里：

```
package my.resources;

import com.google.gwt.core.client.GWT;
import com.google.gwt.resources.client.ClientBundle;
import com.google.gwt.resources.client.TextResource;

public interface MyHtmlResources extends ClientBundle {
 public static final MyHtmlResources INSTANCE = GWT.create(MyHtmlResources.class);

 @Source("intro.html")
 public TextResource getIntroHtml();

} 
```

然后我通过从我的 GWT 客户端代码中调用以下命令来获取该文件的内容：

```
HTML htmlPanel = new HTML();
String html = MyHtmlResources.INSTANCE.getIntroHtml().getText();
htmlPanel.setHTML(html); 
```

有关详细信息，请参阅[http://code.google.com/webtoolkit/doc/latest/DevGuideClientBundle.html](http://code.google.com/webtoolkit/doc/latest/DevGuideClientBundle.html)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-13T15:14:58.660

您可以使用一些模板机制。试试[FreeMarker](http://freemarker.org/)或[Velocity](http://velocity.apache.org/)模板。您将在将通过模板库检索的文件中包含 HTML。这些文件可以用适当的扩展名命名，例如 .html、.css、.js 可单独观察。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-22T13:11:28.427

我会说您通过[Frame](http://google-web-toolkit.googlecode.com/svn/javadoc/1.5/com/google/gwt/user/client/ui/Frame.html)加载外部 html 。

```
Frame frame = new Frame();
frame.setUrl(GWT.getModuleBase() + getCurrentPageHelp());
add(frame); 
```

您可以安排一些约定或查找*getCurrentPageHelp(* ) 以返回适当的路径（例如：*/manuals/myPage/help.html*）

这是一个实际使用的框架[示例](http://examples.roughian.com/index.htm#Panels~Frame)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-11-05T06:45:02.287

在 GWT 2.0 中，您可以使用[UiBinder](http://code.google.com/webtoolkit/doc/latest/DevGuideUiBinder.html)执行此操作。

```
<ui:UiBinder xmlns:ui='urn:ui:com.google.gwt.uibinder'>
  <div>
    Hello, <span ui:field='nameSpan’/>, this is just good ‘ol HTML.
  </div>
</ui:UiBinder> 
```

这些文件与您的 Java 代码分开保存，并且可以作为 HTML 进行编辑。它们还提供与 GWT 小部件的集成，以便您可以轻松地从 GWT 代码访问 HTML 中的元素。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-06T06:10:54.517

GWT 2.0 在发布时应该有一个 ClientBundle，它可能会解决这个需求。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T19:50:33.067

您可以尝试实现`Generator`在编译时从文件加载外部 HTML 并构建一个发出它的类。在线创建生成器似乎没有太多帮助，但这里有一篇发给 GWT 组的帖子可能会让您入门：[groups.google.com 上的 GWT 组](http://groups.google.com/group/Google-Web-Toolkit/msg/ae249ea67c2c3435)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-19T21:39:29.947

我正在做类似的研究，到目前为止，我发现解决这个问题的最佳方法是通过[DeclarativeUI 或 UriBind](https://stackoverflow.com/questions/766149/is-it-possible-to-separate-totally-the-html-css-layout-from-the-gwt-logic/772793#772793)。不幸的是它还在孵化器中，所以我们需要解决这个问题。

我用几种不同的方式解决它：

1.  主动覆盖，即：您创建标准 HTML/CSS 并通过`<script>`标签注入 GET 代码。在任何需要从 GWT 代码访问元素的地方，您都可以编写如下代码：

    ```
    RootPanel.get("element-name").setVisible(false); 
    ```

2.  你编写你的代码 100% GWT，然后，如果需要一个大的 HTML 块，你可以通过 IFRAME 或通过 AJAX 将它带到客户端，然后通过 HTML 面板注入它，如下所示：

    ```
    String html = "<div id='one' "
       + "style='border:3px dotted blue;'>"
       + "</div><div id='two' "
       + "style='border:3px dotted green;'"
       + "></div>";
    HTMLPanel panel = new HTMLPanel(html);
    panel.setSize("200px", "120px");
    panel.addStyleName("demo-panel");
    panel.add(new Button("Do Nothing"), "one");
    panel.add(new TextBox(), "two");
    RootPanel.get("demo").add(panel); 
    ```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-27T13:22:00.500

为什么不使用旧的 IFRAME？只需创建一个 iFrame，您希望在其中放置提示并在 GWT 'page' 更改时更改其位置。

好处：

*   点击存储在任何结构的单独的可维护的 HTML 文件中
*   在服务器端**完全没有编码的**AJAX 样式加载
*   如果需要，应用程序仍然可以与加载的信息交互

缺点：

*   每个提示文件都应具有指向共享 CSS 的链接，以实现通用外观
*   很难国际化

为了使这种方法更好一点，您可能会处理加载错误并在 404 错误时重定向到默认语言/主题。因此，搜索优先级将是这样的：

1.  当前语言的当前主题
2.  默认语言的当前主题
3.  当前语言的默认主题
4.  默认错误页面

我认为创建这样的 GWT 组件来合并 iFrame 交互非常容易

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-08-19T17:21:19.797

GWT Portlets 框架 ( [http://code.google.com/p/gwtportlets/](http://code.google.com/p/gwtportlets/) ) 包括一个 WebAppContentPortlet。这会提供来自您的 Web 应用程序的任何内容（静态 HTML、JSP 等）。您可以将它放在具有其他 Portlet 中的附加功能的页面上，并且在页面加载时通过单个异步调用获取所有内容。

查看 WebAppContentPortlet 和 WebAppContentDataProvider 的源代码，了解它是如何完成的，或者尝试使用框架本身。以下是相关的来源：

WebAppContentPortlet（客户端）

```
((HasHTML)getWidget()).setHTML(html == null ? "<i>Web App Content</i>" : html); 
```

WebAppContentDataProvider（服务器端）：

```
HttpServletRequest servletRequest = req.getServletRequest();
String path = f.path.startsWith("/") ? f.path : "/" + f.path;
RequestDispatcher rd = servletRequest.getRequestDispatcher(path);
BufferedResponse res = new BufferedResponse(req.getServletResponse());
try {
   rd.include(servletRequest, res);
   res.getWriter().flush();
   f.html = new String(res.toByteArray(), res.getCharacterEncoding());
} catch (Exception e) {
   log.error("Error including '" + path + "': " + e, e);
   f.html = "Error including '" + path +
        "'<br>(see server log for details)";
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-27T12:43:12.650

您可以将 servlet 与 jsps 一起用于页面的 html 部分，并且仍然包含在页面上运行 gwt 应用程序所需的 javascript。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-03-19T22:22:59.333

我不确定我是否理解你的问题，但我假设你已经将这个常见的摘要分解到它自己的小部件中。如果是这样，问题是您不喜欢将 HTML 嵌入 Java 代码的丑陋方式。

GWT 2.0 有**UiBinder**，它允许您在原始 HTMLish 模板中定义 GUI，并且您可以将值从 Java 世界注入到模板中。通读[开发指南](http://code.google.com/webtoolkit/doc/latest/DevGuideUiBinder.html)，它给出了一个很好的大纲。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-05-09T07:27:47.870

您可以尝试使用在运行时生成和绑定的 html 模板的[GWT App ，无需编译时。](http://www.gwtapp.org/)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-10-22T17:58:59.797

看看 [http://code.google.com/intl/es-ES/webtoolkit/doc/latest/DevGuideClientBundle.html](http://code.google.com/intl/es-ES/webtoolkit/doc/latest/DevGuideClientBundle.html)

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2009-04-26T10:04:07.177

不知道 GWT，但您不能在您的应用程序 html 中定义和锚定 div 标记，然后对您需要的 HTML 文件执行 get 并附加到 div 吗？这与[微模板](http://ejohn.org/blog/javascript-micro-templating/)有何不同？

更新：

[我刚刚在另一个StackOverflow](https://stackoverflow.com/questions/365699/better-way-or-reusable-code-to-populate-an-html-element-or-create-a-select-after)问题的答案中找到了这个不错的 jQuery 插件。

# silverlight - 方法返回值在 Silverlight 中显示为 void

> ID：744141
> 
> 赞同：1
> 
> 时间：2009-04-13T14:54:17.307
> 
> 标签：silverlight

我编写了一个返回用户列表的 webmethod，虽然服务工作正常，但当我从页面调用它时，webservice 中的方法的返回类型为 void。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T15:13:48.770

您可能会觉得 Silverlight 中的 Web 服务调用必须异步处理。

当您定义一个 WebMethod 时，假设您在一个名为 WorkMan 的类上有一个名为 DoWork 的方法。您在 Silverlight 中的代码最终将如下所示：

```
WorkManSoapClient client = new WorkManSoapClient();
client.DoWorkCompleted += new EventHandler<DoWorkCompletedEventArgs>(this.DoWorkCompleteHandler); // where DoWorkCompletedHandler handles the callback. 
```

然后你调用你的实际方法并允许回调处理结果。

```
client.DoWorkAsync(); 
```

如果您的 web 方法返回一个值，您的 EventArg 对象将具有一个 Result 属性，您可以利用该属性来获取结果。

最后一点：个人风格的东西，但我喜欢 lambda 表达式，而不是为回调生成一个全新的方法。我可能会写如下内容：

```
WorkManSoapClient client = new WorkManSoapClient();
client.DoWorkCompleted += (s,e) => {
    if(e.Result != null){
        object foo = e.Result;
    }
};
client.DoWorkAsync(); 
```

# c# - 5 个文本框，2 个按钮。如何将文本框分配给按钮？

> ID：744142
> 
> 赞同：5
> 
> 时间：2009-04-13T14:54:24.963
> 
> 标签：c#, .net, asp.net

我想让我的用户选择使用文本框并按 Enter。挑战是我有 5 个文本框和 2 个选项。3个文本框属于一个按钮，2个文本框属于另一个。如何根据用户按下 Enter 时所在的文本框触发特定的 Button？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-13T15:07:28.117

我自己完成了这项工作，我有一个页面，其中包含针对不同用户类型的两种不同登录表单。我所做的是将这两个表单分成它们自己的 ASP 面板控件，并在面板上将 DefaultButton 设置为我希望的任何一个。这样，当他们完成输入表单并按下回车键时，它将在正确的按钮上提交。

**示例**：

```
<asp:Panel id="panel1" DefaultButton="button1">
    <asp:textbox id="textbox1"/>
    <asp:textbox id="textbox2"/>
    <asp:buton id="button1"/>
</asp:panel>

<asp:panel id="panel2" DefaultButton="button2">
    <asp:textbox id="textbox3"/>
    <asp:textbox id="textbox4"/>
    <asp:button id="button2"/>
</asp:panel> 
```

**编辑**：这是通过将 OnKeyPress 属性分配给文本框的[另一种方法。](http://weblogs.asp.net/rajbk/archive/2003/12/11/setting-the-default-button-for-a-textbox-in-asp-net.aspx)**这是一个与我在顶部描述的不同的解决方案**

**示例**：

```
function clickButton(e, buttonid){
    var evt = e ? e : window.event;
    var bt = document.getElementById(buttonid);
    if (bt){
        if (evt.keyCode == 13){
            bt.click();
            return false;
        }
    }
}

//code behind
TextBox1.Attributes.Add("onkeypress",
    "return clickButton(event,'" + Button1.ClientID + "')"); 
```

后面的代码生成以下代码：

```
<input name="TextBox1" type="text" id="TextBox1" onkeypress="return 
    clickButton(event,'Button1')"  /> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T15:14:03.450

在这种情况下，我会将相关的文本框和按钮分组到一个面板中。Panel 有一个可以使用的 DefaultButton 属性。DefaultButton="IdOfTheDefaultButtonForControlsInThisPanel"

[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.panel.defaultbutton.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.panel.defaultbutton.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T15:11:21.977

使用[jQuery](http://www.jquery.com)这很容易实现：

```
$(function ()
{
    $("#id-of-textbox-1, #id-of-textbox2, etc.").keyup(function (e)
    {
        if (e.keyCode === 13) $("#id-of-submit-button-1").click();
    });

    // And for the second group

    $("#id-of-textbox-3, #id-of-textbox4, etc.").keyup(function (e)
    {
        if (e.keyCode === 13) $("#id-of-submit-button-2").click();
    });
}); 
```

如果您使用的是 ASP.NET *Button*控件，请确保将[`UseSubmitBehavior`](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.button.usesubmitbehavior.aspx)这些控件的属性设置为 false。

# php - 在 PHP 中将数组作为参数而不是数组传递

> ID：744145
> 
> 赞同：164
> 
> 时间：2009-04-13T14:55:14.853
> 
> 标签：php, arrays, function, methods

我似乎记得在 PHP 中有一种方法可以将数组作为函数的参数列表传递，从而将数组解引用为标准`func($arg1, $arg2)`方式。但现在我不知道该怎么做。我记得通过引用传递的方式，如何“全局”传入参数......但不记得如何将数组从列表中删除为参数列表。

它可能很简单`func(&$myArgs)`，但我很确定不是这样。但是，遗憾的是，php.net 手册到目前为止还没有透露任何内容。并不是说我在过去一年左右不得不使用这个特殊功能。

* * *

## 回答 #1

> 赞同：186
> 
> 时间：2009-04-13T15:02:05.493

[http://www.php.net/manual/en/function.call-user-func-array.php](http://www.php.net/manual/en/function.call-user-func-array.php)

```
call_user_func_array('func',$myArgs); 
```

* * *

## 回答 #2

> 赞同：177
> 
> 时间：2015-12-02T17:25:36.553

[如前所述](https://stackoverflow.com/questions/744145/passing-an-array-as-arguments-not-an-array-in-php/34049110#comment37967053_744178)，从 PHP 5.6+ 开始，您可以（应该！）使用`...`标记（又名“splat 运算符”，[可变参数函数](http://php.net/manual/en/functions.arguments.php#functions.variable-arg-list)功能的一部分）轻松调用带有参数数组的函数：

```
<?php
function variadic($arg1, $arg2)
{
    // Do stuff
    echo $arg1.' '.$arg2;
}

$array = ['Hello', 'World'];

// 'Splat' the $array in the function call
variadic(...$array);

// 'Hello World' 
```

*注意：数组项通过它们在数组中的* **位置** *而不是它们的键映射到参数。*

根据[CarlosCarucce 的评论](https://stackoverflow.com/questions/744145/passing-an-array-as-arguments-not-an-array-in-php/34049110#comment65680057_34049110)，这种形式的参数解包**是迄今为止**在所有情况下最快的方法。在一些比较中，它比`call_user_func_array`.

## 在旁边

因为我认为这非常有用（尽管与问题没有直接关系）：您可以在函数定义中[对 splat 运算符参数进行类型提示，](http://php.net/manual/en/functions.arguments.php#example-151)以确保所有传递的值都与特定类型匹配。

（请记住，这样做**必须**是您定义的*最后一个*参数，并且它将传递给函数的所有参数捆绑到数组中。）

这对于确保数组包含特定类型的项非常有用：

```
<?php

// Define the function...

function variadic($var, SomeClass ...$items)
{
    // $items will be an array of objects of type `SomeClass`
}

// Then you can call...

variadic('Hello', new SomeClass, new SomeClass);

// or even splat both ways

$items = [
    new SomeClass,
    new SomeClass,
];

variadic('Hello', ...$items); 
```

* * *

## 回答 #3

> 赞同：83
> 
> 时间：2009-04-13T19:42:09.827

另请注意，如果要将实例方法应用于数组，则需要将函数传递为：

```
call_user_func_array(array($instance, "MethodName"), $myArgs); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-02-18T14:28:53.497

为了完整起见，从 PHP 5.1 开始，这也可以：

```
<?php
function title($title, $name) {
    return sprintf("%s. %s\r\n", $title, $name);
}
$function = new ReflectionFunction('title');
$myArray = array('Dr', 'Phil');
echo $function->invokeArgs($myArray);  // prints "Dr. Phil"
?> 
```

见： http: [//php.net/reflectionfunction.invokeargs](http://php.net/reflectionfunction.invokeargs)

对于您使用[ReflectionMethod::invokeArgs](http://php.net/reflectionmethod.invokeargs)的方法，并将对象作为第一个参数传递。

# networking - 网络：Virtual PC 2007 无法使用 NAT 访问主机

> ID：744149
> 
> 赞同：1
> 
> 时间：2009-04-13T14:56:04.993
> 
> 标签：networking, virtualization, nat, virtual-pc-2007

我无法使用计算机名（即 WINS）从我的来宾计算机访问我的主机。我可以使用它当时碰巧拥有的任何 IP 地址来访问它，但我需要一种一致的方式来访问它（即使我不在线）。

我有一个 Windows Server 2003 来宾虚拟机和一个 Vista 主机。我正在使用共享网络 (NAT)。我正在运行 Microsoft Virtual PC 2007 SP1。我已将我的 DNS 服务器设置为 192.168.131.254，其他一切都是 DHCP。任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T00:05:46.043

在 Vista Host 系统上的 windows hosts 文件中创建一个域名：

```
 C:\WINDOWS\system32\drivers\etc\hosts 

 172.16.16.4    localserver 
```

这是解释它的博客：

[http://blog.flexuous.com/2007/02/04/virtual-pc-ip-routing-enabling-vpc-nat-loopback-connector-at-the-same-time/](http://blog.flexuous.com/2007/02/04/virtual-pc-ip-routing-enabling-vpc-nat-loopback-connector-at-the-same-time/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T00:19:20.597

你没有提到网络设置。如果您碰巧控制路由器，例如家庭网络，您有几个选择。

*   [动态 DNS](http://support.microsoft.com/kb/816592)更新。当主机通过 DHCP 获得它的 IP 地址时，它可以使用它的主机名自动更新它的 DNS 记录。这类似于 dyndns 等服务，但也可以在没有网络访问的情况下在本地网络上工作。
*   [静态 DHCP 分配](http://en.wikipedia.org/wiki/Dhcp#Technical_overview)- 将 IP 地址分配到路由器上的 MAC 地址关系，以便每次从该 MAC 发出 DHCP 请求时，它总是会获得相同的 IP 地址。然后您可以将此地址添加到您的主机文件中，以便通过名称访问。

另一种选择是在主机和来宾上都设置一个静态环回设备，并将它们放在自己的专用网络中。这样，IP 地址将永远不会改变。然后，您可以将相应的 IP 地址添加到每台机器的主机文件中以按名称引用。

# nhibernate - 休眠错误：没有找到给定标识符的行错误

> ID：744150
> 
> 赞同：1
> 
> 时间：2009-04-13T14:56:30.513
> 
> 标签：nhibernate

我知道这个问题是重复的。但是没有人能简单地回答到足以正确回答的程度。当我尝试使用 guid 为我提供表中的记录时，我收到 Nhibernate 错误“No row with given identiifer found error”。我正在使用 Nhibernate 加载函数来加载具有唯一标识符（GUID）的记录，但如果记录不存在，则会给出异常。我是否缺少 hbm.xml 文件中的某些属性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-14T16:27:11.987

从[文档](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html_single/#manipulatingdata-loading)中，

> 请注意，如果没有匹配的数据库行，Load() 将引发不可恢复的异常。

如果要查询特定记录并且没有异常，请使用实际查询或`Get()`方法。

同样来自文档：

> 如果不确定是否存在匹配行，则应使用 Get() 方法，该方法会立即访问数据库，如果不存在匹配行则返回 null。

所以使用`Get()`并检查结果是否为空。

# virtualization - 是否建议开发人员在本地虚拟机上进行开发？

> ID：744152
> 
> 赞同：6
> 
> 时间：2009-04-13T14:57:04.803
> 
> 标签：virtualization

### 复制

> [使用 VM 进行开发的原因](https://stackoverflow.com/questions/424869/reasons-to-use-a-vm-for-development)

我正在尝试在我的公司推出一项政策，所有开发人员都必须在具有开发人员的虚拟机（例如 VMWare 工作站）上工作。环境，例如 IDE、工具、已安装的服务包，以使新团队成员更容易、更顺畅地配置新机器等...

您推荐这种方法还是在您的公司以类似的方式工作？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-13T15:14:28.270

我有一个同事喜欢这样工作。他的每个项目都有一个虚拟机。

我个人不喜欢用虚拟机做开发。

1.  它比直接在我的机器上工作要慢。
2.  它不能很好地完成多个显示器。

不要保护您的开发人员不了解有关 IDE、工具和服务包的详细信息。他们需要知道这些事情。

此外，不要强迫您的开发人员以某种方式工作。有些人可能对此不满意，不满意的开发人员 = 生产力较低的开发人员。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-13T16:05:38.070

我已经使用这两种方法多年了。目前我使用虚拟机。他们有很多很多优点。但是，不要强迫任何人采用一种特定的方式。如果他们被迫，他们将不会有生产力。如果可以的话，说服他们。

VM for Dev 的优势：

*   非常快速的部署：一位志愿者使用最新的和自定义的更新图像，所有人都可以从中受益。
*   每个项目都可以得到一个单独的副本，没有干扰，没有冲突。
*   “冻结”一切并重新启动非常简单！无需保存、关闭、运行、加载...
*   当出现问题时，它是一个图像，将其复制，克隆一个新图像并检查您的代码。
*   调试或测试时冻结（有时您想捕获特定状态）。如果您想返回并重复一些操作（想想测试），快照会有所帮助。
*   VMWare 具有远程调试和反向执行功能！
*   再现性！您的开发人员和测试人员可以重现错误，因为环境是受控的（假设图像上只有工作）和保存的状态（假设他们使用快照）。

另一方面，也有缺点：

*   虚拟机体积更大，占用大量空间和内存。
*   您不会获得 100% 的硬件性能。
*   您将在图像维护上浪费一些时间。
*   有些人只是讨厌它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T15:07:06.870

我强烈建议使用虚拟机进行开发。本地虚拟机的性能损失非常小，并且可以更安全地尝试新的想法/软件。

只需确保您有足够的 RAM 以支持多个 VM 和主机操作系统。

[也可以看看](https://stackoverflow.com/questions/392616/setting-up-a-development-environment-inside-a-virtual-machine/392632#392632)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T15:09:44.927

我在哪里工作，政策要求我们都有一台运行 VM 的物理机。我们只有虚拟机的管理员权限，而不是物理机。当我们必须运行多个开发应用程序时，这往往会产生问题，构建往往很慢，事实上一切都很慢。此外，当虚拟机开始达到 15gb 限制（大约使用一个半月）时，随着虚拟机开始崩溃，事情变得复杂，我们需要请求虚拟机压缩。

我的经历很糟糕，所以我不会推荐它。我们通常在 VM 中运行以下应用程序：文本编辑器、IDE、Weblogic 实例、用于数据库访问的 TOAD。Explorer 和 Firefox，办公应用程序等等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T21:48:38.557

在某些情况下，例如进行 SharePoint 开发工作，您或多或少需要在服务器上工作，而我只是不喜欢将笔记本电脑变成 2003/2008 服务器的想法 :-)

我们有两个 VMWare ESX 机器来托管我们的开发机器，只要人们记得关闭那些不使用的映像，它就可以很好地工作。另一个优势是我们在自己的域中拥有完整的 ESX 映像网络，这使我们能够做很多有趣的事情:-)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T15:06:16.607

在现代 IDE 中，有很多图形和磁盘 IO 正在进行，VM 都不能很好地执行这些操作。所以 - 如果你的虚拟机响应速度足够快，开发人员可以使用，那么我会说没有理由不这样做。如果不需要，您要么需要为他们获得更快的机器，要么返回记录如何设置构建环境。

对虚拟机不利的另一个因素是，如果您更改环境，则必须对所有虚拟机都进行更改，并且无论如何都要记录更改。如果你告诉每个人如何设置他们的系统，你不妨让他们在贱金属上设置自己的系统。

顺便说一句，我们确实为此提供了 VMsa——但它们往往用于旧版本的产品，因此我们仍然可以构建它，而无需安装旧的服务包、sdks 和编译器。没关系，但我发现在本地安装所有内容并在它们之间切换（使用联结指向构建目录）更容易。

现在 IIRC VMware 有一个名为[ThinApp](http://www.vmware.com/products/thinapp/)的虚拟化项目，它可以透明地将操作系统环境放到您的本地机器上，因此您可以同时运行多个相互冲突的应用程序。我没有使用过它，但确实认为它可能比在自己的窗口中运行的整个来宾虚拟机更好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-13T15:13:52.827

就个人而言，尽管出于您提到的所有原因，我认为这是一个好主意，但我也认为这需要在机器上花费相当多的额外成本。周末我只是在 VMWare 和一台中等机器（AMD X2 4600，2 GB RAM）上试用 Windows 7，我发现在 VM 中工作可能比在真实硬件上工作更糟糕。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-13T15:33:11.393

在我们的商店，我们几乎使用所有 VM 进行开发。我们为提高 VM 性能而采用的一种有用策略是始终在高速外部硬盘驱动器上运行它们。这样做会使它们运行得非常快，因为 VM 通常需要大量的磁盘 IO，正如之前的帖子所提到的那样。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-13T15:52:05.997

使用虚拟机进行开发是有正当理由的。但是，如果您只是为了标准化整个组织的开发环境而考虑这样做，那么有更好的方法来实现这一点（即，使用标准机器映像）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-13T21:32:47.550

从一些开发人员开始，尝试收集一些关于生产力变化的实际数据。

# c# - 拥有一个大的工作流程还是几个较小的特定工作流程更好？

> ID：744156
> 
> 赞同：4
> 
> 时间：2009-04-13T14:57:42.897
> 
> 标签：c#, workflow, workflow-foundation

我需要构建一个从服务器获取文件并移动到另一台服务器的应用程序。有人建议我考虑使用 Windows Workflow Foundation (WF)。

我开始构建工作流程，但它变得一团糟，我不确定我是否以最好的方式做到这一点。

这是基本的工作流活动：

获取源列表 确定源是 ftp 还是磁盘驱动器 从服务器获取文件列表 如果源是 ftp，则使用 ftp 获取文件 如果源是驱动器，则从驱动器读取文件 如果目标是 ftp，则 ftp 文件到服务器 else 如果目标是驱动器则写入驱动器 else 如果目标是 Web 服务则发布到 Web 服务 如果源是 ftp 然后使用 ftp 命令删除文件 else 如果源是驱动器则删除文件

对于一个工作流程，它会变得有点忙。我需要 2 个 while 循环，一个围绕集成，一个在我获得文件列表之后。

我想到的另一件事是构建多个工作流。一种用于 FTPtoFTP、FTPtoDrive、FTPtoWebServie、DriveToFTP、DrivetoDrive、DriveToWebService。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T15:28:50.157

首先，您应该考虑为每个主要部分创建自定义活动。自定义活动将是可以由许多步骤组成的复合活动。这将有助于整理一些东西，并允许您继续在相对较高的级别上使用工作流。

工作流设计器虽然很方便，但并不是真正设计成非常大的。从 VS 2008 开始，使用基于 XAML 的技术的最佳方式是使用文本编辑器并直接读/写 XML。

将其分解为多个工作流*可能*不是最好的方法，除非您可以将其分解为几个高级活动并在 XAML 级别上工作。请记住，如果所有这些的逻辑和流程几乎相同，那么您现在必须维护 6 个不同的工作流程。如果您的工作流程很复杂并且您需要修复所有工作流程中的常见逻辑错误，这将是一场*更大的噩梦。*

您还应该考虑使用服务。这可能允许您拥有一个工作流和一组活动，但每个步骤的实现都可以隔离到一个服务中。在这种情况下，您需要为每个组合实例化一个工作流，将相同的工作流加载到每个组合中，并注入不同的活动。不一定是最好的方法，但需要考虑。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T15:30:48.373

首先，在我看来，这听起来像是使用 WF 为应该相当简单的过程增加了额外的复杂性。尽管 WF 可用于对执行流程进行建模，但其目的是对业务流程进行建模，并包含业务规则和逻辑，而无需将它们放入您的实现中。

在您的示例中，业务规则看起来很像应该由 app.config 文件处理的事情。

但是，关于使用一个或多个工作流程的更广泛的问题。您希望您的每个工作流任务都具有大致相同的“广泛范围”

例如用于建表的 WF

*   购买木材
*   砍木头
*   为腿砍木头
*   斜边
*   圆形飞檐
*   用不同的粗细度砂两次
*   组装表

中间的台阶都比周围的台阶详细多了。因此，您可以考虑将其拆分为两个单独的工作流程：包含广泛步骤的高级工作流程和包含详细信息的较低级别工作流程。

因此，“GetDatasource”工作流步骤不关心（外部）它从什么类型的数据源收集，它只是返回到工作流中的下一步一组数据。

目标也是如此，它不关心它拥有什么类型的数据源，它只关心它与数据的关系。所以这也应该被封装。

所以你的工作流程可能是三个工作流程

最高WF

1.  获取数据源WF
2.  DoThingsWithDataWF

然后，您的 DoThingsWithDataWF 和 GetDataSourceWF 工作流都可以只关注它们需要的执行上下文。

**编辑**

正如评论者 James Schek 所指出的那样。您可以使用更高级别的工作流程来实际启动您的较低级别的工作流程并管理它们的执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T15:04:36.967

好吧，我个人还没有使用 WWF。不过，我之前已经完成了相当多的工作流程。对我来说，将它们分解成更小的工作流程似乎是最好的方法。当您使用工作流时，您应该尝试将每个工作流限制为特定任务，以便您拥有明确的启动操作以及至少一个成功的路线和至少一个失败的路线。一般来说，工作流程可能是非常棘手的事情，最好让每个工作流程尽可能简单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T15:10:03.257

作为一般规则，只要事情变得“混乱”，您就应该将它们分解成更小的部分。我绝对建议将其分解为几个工作流程。

# vim - Gvim 中的自动换行

> ID：744159
> 
> 赞同：47
> 
> 时间：2009-04-13T14:58:20.557
> 
> 标签：vim, word-wrap

如何让 Gvim 自动换行，不会在中间打断单词？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-04-13T15:16:15.630

毕竟网上好像有解决办法。

```
:set formatoptions=l
:set lbr 
```

链接：http: [//vim.wikia.com/wiki/Word_wrap_without_line_breaks](http://vim.wikia.com/wiki/Word_wrap_without_line_breaks)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-13T15:06:39.460

你可以

```
:set nowrap 
```

只是让大线条滚动屏幕边缘。但是 tw 可能是更好的方法。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-12-23T21:21:26.320

你可以

```
:set wrap linebreak nolist 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-13T15:01:44.103

```
:set tw=78 
```

将文本宽度设置为 78 个字符。您可以使用“[movement]gq”重新换行一些文本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-02-03T15:12:11.190

我使用以下设置来包装诸如降价文件之类的长行。

```
:set wrap
:set linebreak
:set nolist  " list disables linebreak
:set textwidth=0
:set wrapmargin=0 
```

来源：http: [//vim.wikia.com/wiki/Word_wrap_without_line_breaks](http://vim.wikia.com/wiki/Word_wrap_without_line_breaks)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-13T15:14:00.423

您还可以使用 wrapmargin，手册将其定义为：

```
Number of characters from the right window border where wrapping
starts.  When typing text beyond this limit, an <EOL> will be inserted
and inserting continues on the next line. 
```

# sql-server - SSRS中数据集的动态选择

> ID：744162
> 
> 赞同：0
> 
> 时间：2009-04-13T14:59:09.697
> 
> 标签：sql-server, dynamic, reporting-services, dataset

我将使用 SSRS 2005 设计报告。是否可以动态选择数据集？

假设我将有两个表，其中第一个是摘要，第二个是详细数据。我的参数之一（带有值`Summary`和`Detail`）将确定要显示哪个版本的报告。我可以有两个不同的数据集，并在单击参数视图对话框（或之前）中的查看报告按钮时设置将使用哪个数据集？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-10-18T20:28:09.337

您可以通过使用 switch 语句来使用单个数据集，如下所示：您可以在数据选项卡中键入它，但结果只能在预览选项卡中看到，而不能像常规查询那样在数据选项卡中看到。

```
=Switch(Parameters!ToDecide.Value = "Summary",
"Your query for Summary", 
Parameters!ToDecide.Value = "Detail",
"Your query for Detail") 
```

1.  确保查询中没有多余的空格（需要时不超过一个空格）
2.  这两个查询都应返回布局中的表所需的值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-19T08:14:31.420

您可能想尝试使用单个数据集并在报表中包含摘要和详细数据区域（表格、列表等），其中一个可见，另一个不可见。在这种情况下，数据集只评估一次，您仍然可以满足您的要求。

希望这可以帮助，

账单

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T15:55:22.463

您可能必须在一个矩形中包含 2 对表格，并隐藏未使用的表格（在容器级别）。或使用子报表。

如果您找到一种切换数据集的方法，那么您必须确保所有列都相同，并确保使用 DataSet 作为范围参数的任何函数也被更改......这让我认为它只是不支持。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-02T18:37:00.747

如果您有两个单独的表并根据所做的选择隐藏一个或另一个，则创建和维护会更容易。

我没有尝试过，但我认为另一种可能性是使用三个报告：一个容器、一个摘要子报告和一个详细子报告。根据选择在子报表之间切换。

不过，第一个实现有一个性能问题。SSRS 将在加载时尝试填充报表中的**每个**数据集，即使是报表输出中或其他数据集或表达式未使用的数据集。换句话说，仅仅因为您正在显示摘要报告，并不意味着您没有要求数据库也填写您的详细数据。

有一种解决方法可以稍微提高性能，但最终还是会访问服务器。hack 是设置一个标志参数来确定查询是否应该实际返回任何实际结果，或者它是否应该只返回您想要的列。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-03-26T20:08:33.257

您可以尝试添加取决于要执行的 cetain 参数的条件。然后从那里，您可以使用不同的数据集。假设您将在单独的隐藏 tablix 上使用它。

# coldfusion - 如何在 Fusebox 5.1 noxml 中创建搜索引擎安全 URL？

> ID：744181
> 
> 赞同：1
> 
> 时间：2009-04-13T15:03:46.160
> 
> 标签：coldfusion, application.cfc, fusebox

如何在 Fusebox 5.1 noxml 中创建搜索引擎安全 URL？

例如，我想要这个： [http ://www.site.com/index.cfm/app.welcome/](http://www.site.com/index.cfm/app.welcome/)

而不是这个： [http ://www.site.com/index.cfm?fuseaction=app.welcome](http://www.site.com/index.cfm?fuseaction=app.welcome)

Fusebox 5.1 应该能够做到这一点。我读过这篇[文章](http://trac.fuseboxframework.org/fusebox/wiki/Fusebox51Enhancements#SearchEngineSafeURLs)，但它只适用于 xml 版本。我知道的太少，我不知道从哪里开始。如何使用 noxml 版本的 fusebox？

**更新**：看起来我需要将此添加到我的 Application.cfc 文件中。虽然还是不行...

```
FUSEBOX_PARAMETERS.myself = "index.cfm/fuseaction/";
FUSEBOX_PARAMETERS.queryStringStart = "/";
FUSEBOX_PARAMETERS.queryStringSeparator = "/";
FUSEBOX_PARAMETERS.queryStringEqual = "/"; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T17:36:05.043

[riaforge](http://www.riaforge.org/)是你的朋友：

[http://coldcourse.riaforge.org/](http://coldcourse.riaforge.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-16T00:48:44.410

Fusebox 5.1 允许您通过更改 ? ＆ 到 /。您仍然需要提供自己的重写器。但是，如果您能够升级到 5.5，它应该也可以处理重写。

**示例重写器**

[http://www.fusebox.org/forums/messageview.cfm?catid=31&threadid=6117&STARTPAGE=2](http://www.fusebox.org/forums/messageview.cfm?catid=31&threadid=6117&STARTPAGE=2)

```
<cfscript>
// SES converter
qrystring = ArrayNew(1);
if ( Find("/",cgi.path_info) eq 1 and Find("/#self#",cgi.path_info) eq 0 ) {
qrystring = cgi.path_info;
} else if ( Len(Replace(cgi.path_info,"#self#/","")) gt 0 ) {
qrystring = ListRest(Replace(cgi.path_info,"#self#/","#self#|"),"|");
} else if ( FindNoCase("#self#/",cgi.script_name) gt 0 ) {
qrystring = ListRest(Replace(cgi.script_name,"#self#/","#self#|"),"|");
}
arQrystring = ListToArray(cgi.path_info,'/');
for ( q = 1 ; q lte ArrayLen(arQrystring) ; q = q + 2 ) {
if ( q lte ArrayLen(arQrystring) - 1 and not ( arQrystring[ Q ] is myFusebox.getApplication().fuseactionVariable and arQrystring[ q+1] is self ) ) {
attributes['#arQrystring[ Q ]#'] = arQrystring[ q+1];
}
}
</cfscript> 
```

**如果您选择使用 Coldcourse...**

[http://coldcourse.riaforge.com](http://coldcourse.riaforge.com)

下面将帮助您入门。如果您想要 /index.cfm/circuit/action/ 格式的 URL，您可以忽略服务器端重写（IIS 的 ISAPI）。但是，如果您想要 /circuit/action/ 或 /blah/，则需要将其设置为服务器端。

**应用程序.cfc**

将 onApplicationStart （或 onRequestStart 用于测试）放入内存中。

```
<cfset application.coldcourse = createObject("component","components.util.coldcourse").init("/config/coldcourse.config.cfm")> 
```

**index.cfm** 将其放在框架加载之前

```
<cfset application.coldcourse.dispatch(cgi.path_info, cgi.script_name) /> 
```

**Coldcourse.config.cfm**（示例配置）

```
<cfset setEnabled(true)>
<cfset setFrameworkEvent("action")>
<cfset setFrameworkSeparator(".")>
<cfset setFrameworkActionDefault("")>
<cfset setUniqueURLs(true)>
<cfset setBaseURL("http://www.mysite.com/index.cfm")>

<!--- CUSTOM COURSES GO HERE (they will be checked in order) --->
<!--- for http://www.mysite.com/about/ pages --->
<cfset addCourse("components")>
<cfset addCourse(pattern="about",controller="main",action="about")>
<cfset addCourse(pattern="contact",controller="main",action="contact")>
<cfset addCourse(pattern="help",controller="main",action="help")>

<!--- If nothing else matches, fall back to the standard courses (you probably shouldn't edit these) --->
<cfset addCourse(":controller/:action/:id")>
<cfset addCourse(":controller/:action")>
<cfset addCourse(":controller")> 
```

**安装 ISAPI 重写**

确保您使用的是正确的重写正则表达式，因为 2.0 版与 3.0 版不同。

2.0 脚本示例：

```
# Coldcourse URL Rewrite for CF
IterationLimit 0
RewriteRule ^(/.+/.+/.*\?.+\..*)$ /index.cfm/$1
RewriteRule ^(/[^.]*)$ /index.cfm/$1 
```

**禁用检查文件是否存在于 Web 服务器上**

如果您的 Web 日志中出现 404 错误，请为 IIS 执行此操作。

1.  打开 IIS 管理器
2.  右键单击站点并选择属性
3.  单击主目录选项卡
4.  单击配置按钮（对话框右下方）
5.  单击 .cfm 扩展名并选择“编辑”
6.  左下方复选框：“检查文件是否存在”

# sql-server - 在尝试排他锁之前进行测试

> ID：744182
> 
> 赞同：1
> 
> 时间：2009-04-13T15:04:24.707
> 
> 标签：sql-server

我编写了一些代码来升级 SQL Server 数据库。在升级数据库之前，我通过以下方式获得了排他锁：

```
ALTER DATABASE Test SET SINGLE_USER WITH NO_WAIT 
```

但是，我想在运行上述代码*之前测试数据库以查看是否可以使用独占锁。*测试不一定要 100% 完美，我只是想避免在尝试获得独占锁时出现超时的可能性。

为此，我编写了以下代码：

```
SELECT 
    *
FROM 
    sys.db_tran_locks 
WHERE 
    resource_database_id = DB_ID('Test') AND
    request_session_id <> @@SPID 
```

我假设如果返回 1 行或更多行，那么数据库必须正在使用中。这是真的？还是没有那么简单？

**更新**考虑到@gbn 的评论，我决定使用以下语句强制回滚现有连接：

```
ALTER DATABASE Test SET SINGLE_USER WITH ROLLBACK IMMEDIATE 
```

在运行此代码之前，我会给用户一个选择退出的机会。但是，我希望用户能够查看到数据库的活动连接列表 - 这样他们就可以做出明智的决定。这让我想到了这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T19:30:25.923

主要是，数据库锁只是为了表明它正在使用中。与代码/表对象相比，数据库实际上并没有很多排他锁情况。

单用户模式不是锁，而是允许的连接数。

我会将 ALTER DATABASE 包装在 TRY/CATCH 块中，因为不能保证状态不会在 check 和 ALTER DB 之间发生变化。

但是，我可能是错误的或误解了这个问题......所以您还必须在上面的查询中测试数据库资源的排他锁模式。您上面的代码将向您显示任何锁定，这可能是某人在 SSMS 中打开了一个空白查询窗口...

编辑，根据评论

您可以通过以下方式检测谁在使用它：

*   `sys.dm_exec_connection`s
*   `sys.dm_exec_sessions`
*   `sys.dm_exec_requests`

老实说，很难停止自动统计更新或用户进行单一连接。通常，您会断开所有其他用户的连接，而无需等待......

```
ALTER DATABASE MYDB SET SINGLE_USER WITH ROLLBACK IMMEDIATE 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T15:10:12.290

如果数据库从您确定它没有被使用到您尝试获取排他锁的那一刻开始变得忙碌怎么办？

# asp.net - 如何使用 CollapsiblePanelExtender 设置多个关闭按钮？

> ID：744184
> 
> 赞同：1
> 
> 时间：2009-04-13T15:05:52.067
> 
> 标签：asp.net, asp.net-ajax, collapsiblepanelextender

我的页面上有一个 asp.net ajax CollapsiblePanelExtender 控件。这个控件的设计方式，你可以指定一个控件来打开面板，另一个控件来关闭它：

```
<ajaxToolkit:CollapsiblePanelExtender ID="cpe" runat="Server"
  TargetControlID="panelStuff"
  ExpandControlID="butToggle" CollapseControlID="butToggle" Collapsed="True"
  SuppressPostBack="true" /> 
```

如果 ExpandControlID 和 CollapseControlID 相同（如本例所示），则控件会切换面板的打开和关闭。

但我想要的是另一个允许用户关闭此面板的控件（在 panelStuff 内）。理想情况下，我想指定：

```
CollapseControlID="butToggle,butClose" 
```

任何想法如何做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T18:39:34.517

实现这一目标的一种方法：

将 BehaviorID 分配给 CollapsiblePanelExtender：

```
<ajaxToolkit:CollapsiblePanelExtender ID="cpe" runat="Server" 
  BehaviorID="cpeForBehavior"
  TargetControlID="panelStuff"
  ExpandControlID="butToggle" CollapseControlID="butToggle" Collapsed="True"
  SuppressPostBack="true" /> 
```

创建 javascript 函数以执行所需的行为：

```
function closeCpe() {
    $find("cpeForBehavior")._doClose();
} 
```

在事件处理程序中执行函数：

```
<input type="button" id="MyOtherButton" onclick="closeCpe();" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-22T16:49:26.107

与上面的答案相同，但我正在寻找一个切换。_doToggle() 不起作用，仅供参考：

```
 function closeCpe() {
            var cpe = $find("cpeForBehavior");

            if (cpe.get_Collapsed()) {
                cpe._doOpen();
            }
            else {
                cpe._doClose();
            }
        } 
```

# sql-server - T-SQL 算术溢出：哪一列？

> ID：744192
> 
> 赞同：4
> 
> 时间：2009-04-13T15:09:17.533
> 
> 标签：sql-server, tsql

在 MS SQL Server 2005 中，当在 INSERT 期间遇到“将数字转换为数据类型数字的算术溢出错误”时，是否可以发现是哪一列的输入值导致了错误？

似乎有许多类似的转换错误没有报告哪一列引起了麻烦。这使得在大型查询中修复错误相当困难。还有其他方法可以解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T15:21:29.503

据我所知，不，您无法收到错误消息来显示哪一列出现故障。但是，如果您知道要插入的内容，您应该能够找到错误所在。你为什么不把表结构和插入查询。

# asp.net - Asp.Net 刷新时，插入了一个重复的帖子...应该只有一个帖子

> ID：744199
> 
> 赞同：0
> 
> 时间：2009-04-13T15:10:19.683
> 
> 标签：asp.net, sql, button, refresh

我有一个允许用户输入信息的 asp:textbox。当用户单击 asp:button 时，它将文本框中的文本插入到我的 sql 数据库中，然后重定向回页面。如果用户点击刷新，按钮的事件会再次被调用。我需要纠正这个问题，以便它不再被调用或它不会重新发布信息。

```
protected void PostButton_Click(object sender, EventArgs e)
{
    if (txtWallPost.Text.Length > 0)
    {
        string strCon = System.Web.Configuration.WebConfigurationManager.ConnectionStrings["SocialSiteConnectionString"].ConnectionString;
        using (SqlConnection conn = new SqlConnection(strCon))
        {
            using (SqlCommand cmd = conn.CreateCommand())
            {
                cmd.CommandText = "INSERT INTO [WallTable] ([UserId], [FriendId], [WallPost]) VALUES (@UserId, @FriendId, @WallPost)";
                cmd.Parameters.AddWithValue("@UserId", User.Identity.Name);
                cmd.Parameters.AddWithValue("@FriendId", User.Identity.Name);
                cmd.Parameters.AddWithValue("@WallPost", txtWallPost.Text);
                conn.Open();
                cmd.ExecuteNonQuery();
                conn.Close();
                txtWallPost.Text = "";
                LoadWallPosts();
                Response.Redirect("~/UserPages/UserProfile.aspx?view="+"wall");
            }
        }
    }
    return;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T15:17:23.367

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T15:20:39.893

我最终只是为墙上的帖子文本添加了一个会话 ID。在 post 方法中，它检查以确保文本框文本与会话文本不同。刷新时它会清除会话，因此工作正常。

# c# - 帮助我找到最好的 WPF

> ID：744200
> 
> 赞同：0
> 
> 时间：2009-04-13T15:11:09.480
> 
> 标签：c#, .net, wpf, user-interface

我想找出人们从使用 WPF 中得到的最大好处，特别是：

*   最好的和令人惊叹的 UI 示例
*   其他 UI 无法轻松实现的暗角（比如 MFC 或 GTK）
*   带代码的专业示例

建议？

可能这方面最好的书是[WPF in Action with Visual Studio 2008](http://manning.com/feldman2/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T21:19:04.853

这是我最喜欢的一些：

*   [Family.Show](http://www.vertigo.com/familyshow.aspx) - 家谱应用程序（带代码） [（来源：][[blogcasts.de](http://blogcasts.de/dwalzen/blog/FamilyShow.png)][）][![家庭秀](https://i.stack.imgur.com/gwNja.png)](https://i.stack.imgur.com/gwNja.png)

*   [PhotoSuru](http://www.photosuru.com/) - 照片浏览器（带代码） [（来源：][[photosuru.com](http://www.photosuru.com/default_files/image002.jpg)][）][![PhotoSuru](https://i.stack.imgur.com/RN31u.jpg)](https://i.stack.imgur.com/RN31u.jpg)

*   [Eikos 合作伙伴产品](http://72.32.149.120/index.html)- 只是截图，但看起来真的很不错 [EP Trading http://72.32.149.120/screens/EP9.jpg](http://72.32.149.120/screens/EP9.jpg)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T15:22:59.653

见： http: [//windowsclient.net/](http://windowsclient.net/)

特别是：[医疗保健演示](http://windowsclient.net/downloads/folders/wpfsamples/entry3754.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T15:19:37.650

我建议检查 Microsoft Expression Blend 附带的 WPF 示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-14T00:28:12.293

[十三23.com](http://www.thirteen23.com)

他们有很多令人惊叹的界面工作，但他们积极地让人们在任何时候下载 2 或 3 个他们的项目......他们杀死了他们目前没有工作的 dl 链接，这是一种耻辱

# c# - 优化我的方法

> ID：744203
> 
> 赞同：1
> 
> 时间：2009-04-13T15:11:26.047
> 
> 标签：c#

我正在尝试创建一个实用程序方法来在模板文件上执行类似邮件合并的功能。由于字符串是不可变的，我不确定我是否写得正确——有人可以看一眼并给我反馈吗？

```
public static string LoadTemplateFile(string fileName, 
                                      NameValueCollection  mergeFields)
{
    string result = System.IO.File.ReadAllText(fileName);

    if (mergeFields != null)
    {
        for (int index = 0; index < mergeFields.Count; index++)
        {
            result = result.Replace(mergeFields.Keys[index], 
                                    mergeFields[index]);
        }
    }

    return result;
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-13T15:15:54.210

您可能会更好地使用 StringBuilder 而不是字符串。

```
public static string LoadTemplateFile(
    string fileName, NameValueCollection  mergeFields)
{    
    System.Text.StringBuilder result = new System.Text.StringBuilder(
        System.IO.File.ReadAllText(fileName));

    if (mergeFields != null)
    {
        for (int index = 0; index < mergeFields.Count; index++)
        {
            result.Replace(mergeFields.Keys[index], 
                                    mergeFields[index]);
        }
    }

    return result.ToString();
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T15:16:02.090

看起来你正试图

1.  从磁盘读取文件
2.  根据提供的名称/值映射进行搜索/替换

如果是这种情况，那么是的，这将工作得很好。

我得到的唯一真实反馈是，根据替换名称/值对的数量，您将创建大量临时字符串。这对于小文件可能很好，但是一旦您开始将相对较大的文件加载到您的应用程序中，您可能会看到明显的差异。

更好的方法是使用 StringBuilder 并对该对象执行 Replace 调用。它将减少不必要的临时字符串的创建。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T15:17:01.323

使用 StringBuilder 而不是字符串。这是我唯一的建议，它的方式更快。

# c# - 如何在 HttpWebRequest 中混合压缩和缓存？

> ID：744204
> 
> 赞同：2
> 
> 时间：2009-04-13T15:12:16.623
> 
> 标签：c#, caching, httpwebrequest, http-compression

我有 ac# 客户端与cherrypy(http/rest) 网络服务交谈。问题是我不能同时打开压缩和缓存。

```
request.AutomaticDecompression = DecompressionMethods.GZip | DecompressionMethods.Deflate; 
```

通过省略上面的行，我得到了正确的缓存头（If-None-Math，If-Modified-Since），而注释掉它得到了压缩头（Accept-Encodig:gzip），但不是缓存头。在我看来，这就像一个错误，但也许我做错了什么。

[完整代码]

```
 public static string GET(string URL)
    {
        string JSON;
        // Create the web request  
        HttpWebRequest request = WebRequest.Create(URL) as HttpWebRequest;
        HttpRequestCachePolicy cPolicy = new HttpRequestCachePolicy(HttpRequestCacheLevel.Revalidate);

        request.Accept = "application/json";            
        request.CachePolicy = cPolicy;
        request.AutomaticDecompression = DecompressionMethods.GZip | DecompressionMethods.Deflate;
        request.Pipelined = false;

        // Get response  
        using (HttpWebResponse response = request.GetResponse() as HttpWebResponse)
        {                
            // Get the response stream  
            StreamReader readerF = new StreamReader(response.GetResponseStream());

            JSON = readerF.ReadToEnd();
            // Console application output  
            //Console.WriteLine(JSON);
            if (response.IsFromCache )
                Console.WriteLine("Request not from cache");
        }

        return JSON;
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-19T12:12:43.897

我已经实现了一种解决方法，请参见下面的代码。我认为处理压缩比处理缓存更容易，所以我自己实现了压缩部分。多亏了一篇博文，这很容易：[HttpWebRequest 和 GZip Http Responses](http://www.west-wind.com/WebLog/posts/102969.aspx)；我仍然认为这是.net中的一个错误。

```
 public static string GET(string URL)
    {
        string JSON;
        // Create the web request  
        HttpWebRequest request = WebRequest.Create(URL) as HttpWebRequest;
        HttpRequestCachePolicy cPolicy = new HttpRequestCachePolicy(HttpRequestCacheLevel.Revalidate);

        request.Accept = "application/json";
        request.Headers.Add(HttpRequestHeader.AcceptEncoding, "gzip,deflate");
        request.CachePolicy = cPolicy;
        request.Pipelined = false;

        // Get response  
        using (HttpWebResponse response = request.GetResponse() as HttpWebResponse)
        {
            //From http://www.west-wind.com/WebLog/posts/102969.aspx
            Stream responseStream = responseStream = response.GetResponseStream();
            if (response.ContentEncoding.ToLower().Contains("gzip"))
                responseStream = new GZipStream(responseStream, CompressionMode.Decompress);
            else if (response.ContentEncoding.ToLower().Contains("deflate"))
                responseStream = new DeflateStream(responseStream, CompressionMode.Decompress);

            // Get the response stream  
            StreamReader readerF = new StreamReader(responseStream);
            JSON = readerF.ReadToEnd();
        }

        return JSON;
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T16:28:02.557

这是政策的副作用吗？如果您只使用默认策略或其他策略会发生什么？

其他选择是自己管理缓存。

# 64-bit - 使用 vmware Server 安装 x64 来宾操作系统时出现问题

> ID：744211
> 
> 赞同：1
> 
> 时间：2009-04-13T15:14:18.333
> 
> 标签：64-bit, vmware

主机操作系统是 x64 Win 2003。

尝试加载 x64 iso (Ultrabac) 并得到以下信息：“尝试加载 x64 操作系统，但是此 CPU 与 x64 模式不兼容。请安装 32 位 X86 操作系统。安装程序无法继续。按任意键即可出口。”

所以我运行了处理器检查 64 位兼容性，结果没问题。

有人有想法么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T15:24:13.317

您还需要一个支持虚拟化扩展的 BIOS - 检查 a) 您的 BIOS 是否具有此设置 b) 是否设置为 ON

# browser - 把我从 IE6 中拯救出来

> ID：744216
> 
> 赞同：16
> 
> 时间：2009-04-13T15:15:39.937
> 
> 标签：browser, internet-explorer-6, cross-browser

我正准备开始为一家相当大的公司开展一个新的网络项目。

对于他们所有的用户，大约 17,000 人，他们都被 IE6 所困。他们计划在今年年底之前让每个人都过渡到 IE7，但是 IT 部门开始将这一承诺推后。

我被要求做的是让项目发起人对此进行更多的反击。然而，我有魅力的政治家按钮似乎坏了。我只是想不出简单的短语，例如“IE6 很烂”或“我还需要一百万个小时才能让它在 IE6 中工作”，所有这些可能都是真的，但事实并非如此。 t 真的觉得这是一个非常成熟的声明。

我想我正在寻找的是某种外行的解释方式，是的，我们可以支持 IE6，但我需要一些风险补偿，并用某种确凿的证据支持这一事实，它确实需要更多几个小时才能使某些东西看起来正确并在 IE6 和 IE7 中工作。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-13T15:26:18.897

我们经常需要说服非技术用户，IE6 对于任何仍在运行的公司来说都是一个非常糟糕的主意，因此我们正在编写一份文档来教育家庭和企业用户，如果有帮助的话，这里是一个摘要：

为什么 IE 6 有问题？

安全性远低于其他浏览器

自 IE 6 发布以来，互联网发生了很大变化，对数据安全的威胁比以往任何时候都多，包括网络钓鱼诈骗、脚本注入攻击、密钥记录病毒、身份盗窃和僵尸网络（已被用于犯罪活动的机器）。

有据可查的是，IE6 在上网时不如现代浏览器安全：

“..升级最令人信服的原因是提高了安全性。今天的互联网不是五年前的互联网。早在 2001 年 Internet Explorer 6 向全世界发布时，这些危险就根本不存在。” Sandi Hardmeier，微软 MVP

“较旧的浏览器是瑞士奶酪的安全漏洞，允许那里的黑帽接管计算机，构建僵尸网络，甚至窃取受害者的身份，大多数时候他们都不知情。” www.joelevi.com

IE 6 会对任何用于浏览网页的计算机构成安全风险。任何负责任的 IT 团队都将在公司网络内的所有计算机上升级到 IE7 或更高版本。许多人现在安装 Firefox 浏览器以进一步提高安全性。

它不符合标准

IE 6 不像大多数浏览器那样呈现网页，因为它使用了一个专有引擎，该引擎忽略了 W3C（万维网联盟）设定的许多标准。这会导致某些网页在 IE 6 中无法正确显示，而某些网页则根本无法显示。

这也意味着，虽然 Web 开发人员必须支持 IE 6，但他们的大部分工作都用于修复页面，而不是开发更好的内容和功能。简而言之，IE 6 阻碍了所有用户的 Web 开发。

慢点

在过去 8 年的浏览器开发和改进的安全性浏览器中，已针对包括下载速度、渲染速度和 JavaScript/AJAX 性能在内的所有方面进行了调整，这是大多数主要网站上用于提供更好最终用户体验的技术（有时称为 Web 2.0 技术）。

内存使用情况

Internet Explorer 7 实际上比 IE6 使用更少的内存，并且在机器上使用更少的整体资源。所以升级可以提高旧电脑的性能。

升级到 Firefox 或 Chrome

火狐

[http://en-us.www.mozilla.com/en-US/firefox/firefox.html](http://en-us.www.mozilla.com/en-US/firefox/firefox.html)

铬合金

[http://www.google.co.uk/chrome](http://www.google.co.uk/chrome)

升级到 IE 7 / 8

家庭用户

Internet Explorer 7 [http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=9ae91ebe-3385-447c-8a30-081805b2f90b](http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=9ae91ebe-3385-447c-8a30-081805b2f90b)

互联网浏览器 8

[http://www.microsoft.com/downloads/details.aspx?familyid=341C2AD5-8C3D-4347-8C03-08CDECD8852B&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=341C2AD5-8C3D-4347-8C03-08CDECD8852B&displaylang=en)

企业用户

Internet Explorer 7 资源页面

[http://technet.microsoft.com/en-gb/ie/bb381619.aspx](http://technet.microsoft.com/en-gb/ie/bb381619.aspx)

Internet Explorer 7 部署指南

[http://www.microsoft.com/downloads/details.aspx?FamilyID=e41d8800-d134-4356-a2e7-c01bee790908&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=e41d8800-d134-4356-a2e7-c01bee790908&DisplayLang=en)

Internet Explorer 8 资源页面

[http://technet.microsoft.com/en-us/ie/bb219517.aspx](http://technet.microsoft.com/en-us/ie/bb219517.aspx)

Internet Explorer 8 部署指南

[http://technet.microsoft.com/en-us/library/cc985339.aspx](http://technet.microsoft.com/en-us/library/cc985339.aspx)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-13T15:35:33.650

这是一项相当艰巨的任务，因为在此之前他们使用 IE6 可能还有其他原因（其他依赖 IE6 的冲突软件）。

*首先要做的是找出阻止 IT 进行迁移的问题——如果不是懒惰的话。*

*   也许更容易询问他们是否会考虑安装“替代浏览器”（这不会影响 IE6 的安装）。但大多数管理员不喜欢这个想法，因为 Firefox 不与 Windows 服务器共享数据/配置，但可能会为了金钱做出权衡。

*   如果没有真正的障碍，您可以向他们展示一个真实的例子，IE6 开发人员的平均一天是怎样的。

    1.  选择一个 UI 功能（结合 IE6 的所有优点来创建一个），该功能将在接下来的几个步骤中引起所需的问题。
    2.  向他们展示所有浏览器中的一切看起来都很好。
    3.  向他们展示它在 IE6 中的表现如何。
    4.  使其与 IE6 兼容。
    5.  向他们展示每个其他浏览器现在如何产生不同/不需要的结果。
    6.  修复它（使用繁重的变通方法），使其现在在大多数浏览器中看起来“正常”。
    7.  告诉他们，您必须将这些精力投入到您的所有组件/功能中，并且它们的生产成本会更高。

    请务必指出，如果您仅将 IE6 与 IE7 进行比较，甚至会发生这种情况。他们可能永远不会切换到 Safari。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T15:31:07.513

我所取得的成功如下。

IE 6 是一个已有近 8 年历史的应用程序，作为其中的一部分，它不像大多数其他技术那样容易支持当前技术。使用 IE6 创建支持 AJAX 的丰富 UI 是一项非常乏味的任务，并且通常需要大量的特定于浏览器的工作才能完成，因为它具有自己的“标准”级别。

除了所有这些之外，还有安全和性能方面的影响。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T15:34:42.357

关于 IE6 的整个主题，每当您将 IT 移出过去时，您可以使用以下命令：

[http://code.google.com/p/ie6-upgrade-warning/](http://code.google.com/p/ie6-upgrade-warning/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-13T15:37:16.377

[http://www.stopie6.org/](http://www.stopie6.org/)

让他们阅读

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T15:30:16.953

所有 IE6 专家都失业并享受退休金。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-13T15:35:42.993

它已有 8 年历史，落后于时代两个版本。人们害怕什么？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-13T16:02:08.467

我确实为一家拥有 160000 名员工的不知名公司工作，IE6 是唯一一家公司认可的浏览器。对我来说，建议他们“只是切换浏览器”是徒劳的，因为我意识到他们现在有价值数百万美元的应用程序正在使用 IE6，而移植这些应用程序将花费数万美元，而且修复移植版本。我通常会在 Web 开发中添加 5-10%，只是为了解决 IE6 问题，具体取决于界面。

# language-agnostic - 捕捉屏幕的最快方法是什么？任何语言

> ID：744219
> 
> 赞同：6
> 
> 时间：2009-04-13T15:16:13.820
> 
> 标签：language-agnostic, screen, screenshot, capture

我需要非常快速地打印 Windows 应用程序的打印屏幕才能从中制作视频……我一直在使用 C#，但我对任何可以使这个过程更快的语言持开放态度。

我使用了许多技术：

*   .net 函数：Bitmap.CopyFromScreen()
*   GDI
*   Direct3d/DirectX

我获得的最快速度是使用 GDI，但我仍然每秒获得不到 10 张照片。我需要更多一点，至少20或30...

这么简单的操作竟然要求这么高，我觉得很奇怪。看起来好像使用更快的 cpu 并没有改变这种情况。

我能做些什么？是否可以使用 gdi 或其他东西直接捕获应用程序的绘图？或者甚至是更低级别的函数来捕捉被扔到显卡上的信息？

对此问题的任何说明将不胜感激。非常感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T15:20:42.750

许多程序使用驱动程序并允许您的应用程序连接到较低级别的显示例程。我不完全确定这是如何完成的，但这是可能的。这是编写 Windows 驱动程序的起点。[http://msdn.microsoft.com/en-us/library/ms809956.aspx](http://msdn.microsoft.com/en-us/library/ms809956.aspx)

这是我刚刚通过谷歌找到的东西： [http ://www.hmelyoff.com/index.php?section=17](http://www.hmelyoff.com/index.php?section=17)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T15:30:49.137

您可能想使用类似[Camtasia](http://www.techsmith.com/camtasia.asp)的东西。取决于你制作视频的原因。

我使用 Jeff 的[User-Friendly Exception Handling](http://www.codinghorror.com/blog/archives/000014.html)的重写版本，他使用 GDI 的 BitBlt 来捕获屏幕截图。对我来说似乎足够快，但我没有对其进行基准测试，我们只是在抛出未处理的异常时将其用于一次拍摄。

```
#region Win32 API screenshot calls

// Win32 API calls necessary to support screen capture
[DllImport("gdi32", EntryPoint = "BitBlt", CharSet = CharSet.Ansi, SetLastError = true, ExactSpelling = true)]
private static extern int BitBlt(int hDestDC, int x, int y, int nWidth, int nHeight, int hSrcDC, int xSrc,
                                 int ySrc, int dwRop);

[DllImport("user32", EntryPoint = "GetDC", CharSet = CharSet.Ansi, SetLastError = true, ExactSpelling = true)]
private static extern int GetDC(int hwnd);

[DllImport("user32", EntryPoint = "ReleaseDC", CharSet = CharSet.Ansi, SetLastError = true, ExactSpelling = true)]
private static extern int ReleaseDC(int hwnd, int hdc);

#endregion

private static ImageFormat screenshotImageFormat = ImageFormat.Png;

/// <summary>
/// Takes a screenshot of the desktop and saves to filename and format specified
/// </summary>
/// <param name="fileName"></param>
private static void TakeScreenshotPrivate(string fileName)
{
    Rectangle r = Screen.PrimaryScreen.Bounds;

    using (Bitmap bitmap = new Bitmap(r.Right, r.Bottom))
    {
        const int SRCCOPY = 13369376;

        using (Graphics g = Graphics.FromImage(bitmap))
        {
            // Get a device context to the windows desktop and our destination  bitmaps
            int hdcSrc = GetDC(0);
            IntPtr hdcDest = g.GetHdc();

            // Copy what is on the desktop to the bitmap
            BitBlt(hdcDest.ToInt32(), 0, 0, r.Right, r.Bottom, hdcSrc, 0, 0, SRCCOPY);

            // Release device contexts
            g.ReleaseHdc(hdcDest);
            ReleaseDC(0, hdcSrc);

            string formatExtension = screenshotImageFormat.ToString().ToLower();
            string expectedExtension = string.Format(".{0}", formatExtension);

            if (Path.GetExtension(fileName) != expectedExtension)
            {
                fileName += expectedExtension;
            }

            switch (formatExtension)
            {
                case "jpeg":
                    BitmapToJPEG(bitmap, fileName, 80);
                    break;
                default:
                    bitmap.Save(fileName, screenshotImageFormat);
                    break;
            }

            // Save the complete path/filename of the screenshot for possible later use
            ScreenshotFullPath = fileName;
        }
    }
}

/// <summary>
/// Save bitmap object to JPEG of specified quality level
/// </summary>
/// <param name="bitmap"></param>
/// <param name="fileName"></param>
/// <param name="compression"></param>
private static void BitmapToJPEG(Image bitmap, string fileName, long compression)
{
    EncoderParameters encoderParameters = new EncoderParameters(1);
    ImageCodecInfo codecInfo = GetEncoderInfo("image/jpeg");

    encoderParameters.Param[0] = new EncoderParameter(Encoder.Quality, compression);
    bitmap.Save(fileName, codecInfo, encoderParameters);
} 
```

# java - Java反射：如何获取变量的名称？

> ID：744226
> 
> 赞同：153
> 
> 时间：2009-04-13T15:17:48.277
> 
> 标签：java, reflection

使用 Java 反射，是否可以获取局部变量的名称？例如，如果我有这个：

```
Foo b = new Foo();
Foo a = new Foo();
Foo r = new Foo(); 
```

是否可以实现一种可以找到这些变量名称的方法，如下所示：

```
public void baz(Foo... foos)
{
    for (Foo foo: foos) {
        // Print the name of each foo - b, a, and r
        System.out.println(***); 
    }
} 
```

*编辑：这个问题不同于[Is there a way in Java to find the name of the variable that was passed to a function?](https://stackoverflow.com/questions/9984550/is-there-a-way-in-java-to-find-the-name-of-the-variable-that-was-passed-to-a-fun) 因为它更纯粹地询问是否可以使用反射来确定局部变量的名称，而另一个问题（包括接受的答案）更侧重于测试变量的值。*

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-04-13T15:55:55.160

从 Java 8 开始，一些局部变量名信息可通过反射获得。请参阅下面的*“更新”*部分。

完整的信息通常存储在类文件中。一种编译时优化是删除它，节省空间（并提供一些混淆）。但是，当它存在时，每个方法都有一个局部变量表属性，其中列出了局部变量的类型和名称，以及它们在范围内的指令范围。

也许像[ASM](http://asm.ow2.org/)这样的字节码工程库可以让您在运行时检查这些信息。我能想到的唯一需要此信息的合理位置是在开发工具中，因此字节码工程也可能对其他用途有用。

* * *

*更新：*[Java 8 添加](http://openjdk.java.net/jeps/118)了对此的有限支持。参数（一种特殊的局部变量类）名称现在可以通过反射获得。除其他目的外，这有助于替换`@ParameterName`依赖注入容器使用的注释。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-04-13T15:20:03.937

这是*不可能*的。变量名称在 Java 中不通信（也可能由于编译器优化而被删除）。

**编辑（与评论有关）：**

如果您放弃必须将其用作函数参数的想法，这里有一个替代方案（我不会使用 - 见下文）：

```
public void printFieldNames(Object obj, Foo... foos) {
    List<Foo> fooList = Arrays.asList(foos);
    for(Field field : obj.getClass().getFields()) {
         if(fooList.contains(field.get()) {
              System.out.println(field.getName());
         }
    }
} 
```

如果`a == b, a == r, or b == r`或存在具有相同引用的其他字段，则会出现问题。

**由于问题得到澄清，现在不需要编辑**

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-04-13T15:24:55.703

（*编辑：删除了两个先前的答案，一个用于回答编辑前的问题，一个用于即使不是绝对错误，至少接近它。*）

如果使用 ( `javac -g`) 上的调试信息进行编译，则局部变量的名称将保存在 .class 文件中。例如，以这个简单的类为例：

```
class TestLocalVarNames {
    public String aMethod(int arg) {
        String local1 = "a string";
        StringBuilder local2 = new StringBuilder();
        return local2.append(local1).append(arg).toString();
    }
} 
```

使用 编译后`javac -g:vars TestLocalVarNames.java`，局部变量的名称现在位于 .class 文件中。`javap`的`-l`标志（“打印行号和局部变量表”）可以显示它们。

`javap -l -c TestLocalVarNames`显示：

```
class TestLocalVarNames extends java.lang.Object{
TestLocalVarNames();
  Code:
   0:   aload_0
   1:   invokespecial   #1; //Method java/lang/Object."<init>":()V
   4:   return

  LocalVariableTable:
   Start  Length  Slot  Name   Signature
   0      5      0    this       LTestLocalVarNames;

public java.lang.String aMethod(int);
  Code:
   0:   ldc     #2; //String a string
   2:   astore_2
   3:   new     #3; //class java/lang/StringBuilder
   6:   dup
   7:   invokespecial   #4; //Method java/lang/StringBuilder."<init>":()V
   10:  astore_3
   11:  aload_3
   12:  aload_2
   13:  invokevirtual   #5; //Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
   16:  iload_1
   17:  invokevirtual   #6; //Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
   20:  invokevirtual   #7; //Method java/lang/StringBuilder.toString:()Ljava/lang/String;
   23:  areturn

  LocalVariableTable:
   Start  Length  Slot  Name   Signature
   0      24      0    this       LTestLocalVarNames;
   0      24      1    arg       I
   3      21      2    local1       Ljava/lang/String;
   11      13      3    local2       Ljava/lang/StringBuilder;
} 
```

[VM 规范](http://java.sun.com/docs/books/vmspec/2nd-edition/html/VMSpecTOC.doc.html)解释了我们在这里看到的内容：

[§4.7.9`LocalVariableTable`属性](http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html#5956)：

> 该`LocalVariableTable`属性是`Code`（第 4.7.3 节）属性的可选可变长度属性。调试器可以使用它来确定方法执行期间给定局部变量的值。

存储每个槽中变量的`LocalVariableTable`名称和类型，因此可以将它们与字节码匹配。这就是调试器可以执行“评估表达式”的方式。

然而，正如埃里克森所说，没有办法通过正常反射访问这个表。如果您仍然决心这样做，我相信[Java 平台调试器体系结构 (JPDA)](http://java.sun.com/javase/technologies/core/toolsapis/jpda/)会有所帮助（但我自己从未使用过它）。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-12-30T11:03:35.980

```
import java.lang.reflect.Field;

public class test {

 public int i = 5;

 public Integer test = 5;

 public String omghi = "der";

 public static String testStatic = "THIS IS STATIC";

 public static void main(String[] args) throws IllegalArgumentException, IllegalAccessException {
  test t = new test();
  for(Field f : t.getClass().getFields()) {
   System.out.println(f.getGenericType() +" "+f.getName() + " = " + f.get(t));
  }
 }

} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2012-12-11T07:08:22.643

你可以这样做：

```
Field[] fields = YourClass.class.getDeclaredFields();
//gives no of fields
System.out.println(fields.length);         
for (Field field : fields) {
    //gives the names of the fields
    System.out.println(field.getName());   
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-19T20:27:06.640

您需要做的就是创建一个字段数组，然后将其设置为您想要的类，如下所示。

```
Field fld[] = (class name).class.getDeclaredFields();   
for(Field x : fld)
{System.out.println(x);} 
```

例如，如果你做了

```
Field fld[] = Integer.class.getDeclaredFields();
          for(Field x : fld)
          {System.out.println(x);} 
```

**你会得到**

```
public static final int java.lang.Integer.MIN_VALUE
public static final int java.lang.Integer.MAX_VALUE
public static final java.lang.Class java.lang.Integer.TYPE
static final char[] java.lang.Integer.digits
static final char[] java.lang.Integer.DigitTens
static final char[] java.lang.Integer.DigitOnes
static final int[] java.lang.Integer.sizeTable
private static java.lang.String java.lang.Integer.integerCacheHighPropValue
private final int java.lang.Integer.value
public static final int java.lang.Integer.SIZE
private static final long java.lang.Integer.serialVersionUID 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-02-25T15:10:00.433

更新@Marcel Jackwerth 的一般回答。

并且仅使用类属性，而不使用方法变量。

```
 /**
     * get variable name as string
     * only work with class attributes
     * not work with method variable
     *
     * @param headClass variable name space
     * @param vars      object variable
     * @throws IllegalAccessException
     */
    public static void printFieldNames(Object headClass, Object... vars) throws IllegalAccessException {
        List<Object> fooList = Arrays.asList(vars);
        for (Field field : headClass.getClass().getFields()) {
            if (fooList.contains(field.get(headClass))) {
                System.out.println(field.getGenericType() + " " + field.getName() + " = " + field.get(headClass));
            }
        }
    } 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2012-04-26T19:52:52.320

看这个例子：

```
PersonneTest pt=new PersonneTest();
System.out.println(pt.getClass().getDeclaredFields().length);
Field[]x=pt.getClass().getDeclaredFields();
System.out.println(x[1].getName()); 
```

# sms - 基于 Web 的 API 可以告诉我一个号码是固定电话还是手机？

> ID：744227
> 
> 赞同：18
> 
> 时间：2009-04-13T15:17:55.783
> 
> 标签：sms, phone-number, mobile-phones

我的应用程序向人们发送 SMS 消息，但作为手机输入的号码有时是固定电话（这是用户错误或用户不知道他们拥有的联系号码是手机还是固定电话。）

我发现一些网站可以告诉我一个号码是固定电话还是手机，但它们不提供编程 API。有谁知道 Web 应用程序可以确定一个号码是否可以接收 SMS 消息的方法？

我想测试 SMS 消息是一种方法，但是当我当前的 SMS 网关获得固定电话号码并且没有告诉我它尝试将 SMS 发送到的固定电话号码时，它会严重失败。我将与我的运营商一起跟进这一点，但如果用户是固定电话或手机号码，我希望有一种简单的方法让用户输入电话号码。

更新：有办法解决这个问题。看看[http://www.phonevalidator.com](http://www.phonevalidator.com)，他们可以查询电话号码并确定它是固定电话还是手机。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-19T02:32:19.173

这不是一项免费服务，但一家名为 Targus 的公司（不是包公司）有一个用于查询电话信息的 API。他们可以判断它是固定电话还是手机，甚至地址验证。费用基于您执行的查询次数（一次查询几美分）。 [http://www.targusinfo.com/](http://www.targusinfo.com/)

跟进：我在 2011 年 2 月 24 日联系了 TARGUSinfo，他们的销售代表告诉我，他们只处理数十万到数百万的记录集，通常他们的客户会插入他们的 API 以进行实时访问。区分较小记录集的单元格号码和陆线号码“不是他们可以帮助的”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-23T22:47:04.090

您可以让 JavaScript 打开一个带有 url 的弹出窗口：“ [http://www.phonevalidator.com/results.aspx?p=](http://www.phonevalidator.com/results.aspx?p=) ”+phoneNumber

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-13T15:27:51.483

恐怕唯一真正找到它的方法是联系短信网关服务提供商。例如，可以在此处找到它们的列表：

[http://en.wikipedia.org/wiki/SMS_gateways](http://en.wikipedia.org/wiki/SMS_gateways)

无论如何，我建议不要这样做：

当用户在他或她的个人资料中插入手机号码时，向该号码发送带有确认码的测试短信。如果号码未经用户验证，请不要打扰稍后向其发送 SMS 消息。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-18T09:56:16.773

实际上有允许接收短信的固定电话运营商。通过 text2voice 网关或具有扩展功能的电话终端。此外，在欧洲，手机运营商已经开始提供“虚拟陆线”，实际上是分配给一个特定基站的 GSM 手机。但他们确实遵循陆线编号方案。

恢复 — 不允许向固定电话号码发送 SMS 是错误的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-18T03:10:10.340

以下脚本返回

```
646-826-3879    LANDLINE 
```

Stack Overflow 热线。

```
#!/usr/bin/perl -w
use strict;
use warnings;

use LWP::Simple;
use LWP::Simple::Cookies ( autosave => 1, file => "$ENV{'HOME'}/lwp_cookies.dat" );

my $usage = "Usage: $0 <phone_number>\n\nwhere phone_number is on format XXX-XXX-XXXX or XXXXXXXXX";

die $usage unless scalar @ARGV == 1;

my $number = shift @ARGV;
die $usage unless $number =~ /(\d\d\d)-?(\d\d\d)/;
my $NPA = $1;
my $NXX = $2;

#GET /search.asp?frmNPA=646&frmNXX=826&frmCity=&frmState=&frmZip=&frmCounty=&frmCompany=&search.x=0&search.y=0 HTTP/1.0
my $doc = get 'http://www.area-codes.com/search.asp?frmNPA=' . $NPA . '&frmNXX=' . $NXX . '&frmCity=&frmState=&frmZip=&frmCounty=&frmCompany=&search.x=0&search.y=0';

# html format:
#...
#    <td><strong>NXX Use Type:</strong></td>
#        <td>LANDLINE</td>
#...
my $next = 0;
my $result = "";
grep {
    if (/NXX Use Type:/) {
        $next = 1;
    } else {
        if ($next) {
            $next = 0;
            $result = $_;
        }
    }
} split(/\n/, $doc);

$result =~ /<[^>]*>(.*)<[^>]*>/;

print "$number\t$1\n"; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-19T00:50:16.983

我不确定您是否真的要这样做...如果您想知道电话号码或固定电话提供商是否保留了号码，您应该能够在您所在国家/地区的电信监管实体的某些文件中找到范围（不知道谁在美国这样做 - 可能是[http://www.nanpa.com/](http://www.nanpa.com/)）。这些文件通常是公开的。

但问题是手机号码！= 能够接收短信。如今，通过号码移植和所有“统一通信”的想法，您可以轻松地将本地号码重定向到手机，处理短信的非地理号码和本地“特殊”号码将您收到的短信重写为 Facebook 消息；）例如我当地的“座机”号码被重定向到另一个国家和几个其他位置的手机。

您不应该为发送到不存在/其他陌生号码的消息付费，因此这可能是检查是否有人可以接收它们的好方法。如果您对 SMS 网关有很好的控制，您可以发送一条消息，其中传递报告处于活动状态并且到期 == 即时消息（忘记正式名称）。只需发送测试/欢迎消息 - 如果不接受，您可以将号码标记为不可用。否则，您可以只要求“接受短信的号码”而不是“手机号码”。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-05-07T17:43:26.890

试图在这里结合一些答案......

丹尼尔提到

> 您可以让 JavaScript 打开一个带有 url 的弹出窗口：“ [http://www.phonevalidator.com/results.aspx?p=](http://www.phonevalidator.com/results.aspx?p=) ”+phoneNumber

这仍然有效吗？我似乎无法重现它。如果我们可以让它工作，那么也许我们可以使用如下脚本......

```
#!/usr/bin/perl -w
use strict;
use warnings;

use LWP::Simple;

my $usage = "Usage: $0 <phone_number>\n\nwhere phone_number is on format XXX-XXX-XXXX or XXXXXXXXX";

die $usage unless scalar @ARGV == 1;

my $number = shift @ARGV;
die $usage unless $number =~ /(\d\d\d)-?(\d\d\d)/;
my $NPA = $1;
my $NXX = $2;

#GET /search.asp?frmNPA=646&frmNXX=826&frmCity=&frmState=&frmZip=&frmCounty=&frmCompany=&search.x=0&search.y=0 HTTP/1.0
my $doc = get 'http://www.phonevalidator.com/results.aspx?p=' . $NPA . $NXX;

# html format:
#...
#                                                       <td class="style16">
#                                Phone Line Type:
#                            </td>
#                            <td class="style13">
#                                <span id="PhoneTypeLabel">LANDLINE</span>
#                            </td>
#
#...
my $result = "";
grep {
    if (/PhoneTypeLabel/) {
        $result = $_;
    }
} split(/\n/, $doc);

$result =~ /<[^>]*>(.*)<[^>]*>/;

print "$number\t$1\n"; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-18T23:23:03.357

另一种选择是让用户从列表中选择他们的手机提供商。只是一个想法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-19T01:24:37.790

为什么不列出固定电话和手机号码的常用格式？例如，我所在的固定电话始终遵循以下格式：

```
9xxxx xxxx 
```

和手机总是：

```
04xx xxx xxx 
```

您可以轻松列出您所服务地区的固定电话/手机号码的一般格式。然后，当想知道一个美国号码是固定电话还是手机号码时，只需比较一下，看看它是否与固定电话格式或手机号码格式匹配。

验证电话号码的另一件事是通过短信向用户的手机发送一个临时密码，并要求他们输入该密码以验证他们的号码。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-20T15:07:54.340

如果我可以访问核心移动网络，我可以想象这样做。不过，这是一个 SS7 API，而不是 Web API。我敢打赌，任何提供 Web API 的服务都充当 SS7 网络的代理，而不是依赖于数据库。唯一的其他选择是查询号码可携带性数据库。最终，要终止呼叫，所有网络运营商都需要确定他们需要连接到哪个其他运营商。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-08-04T11:24:20.730

我们有一项服务，为美国和加拿大提供固定线路/蜂窝检测，还检测号码是活的还是死的，号码被移植到哪个无线运营商等。有一个完整的网络 API。

如果您在 www.hlrcheck.com 上注册一个帐户，我将对其进行验证并添加一些免费积分供您测试。我们目前处于测试阶段，但即将推出完整的候选版本。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-01-08T14:44:19.710

这里提到的所有解决方案都是静态号码模式查找，但确定给定手机号码是否有效（并准备好接收 SMS）的唯一可靠方法是执行 HLR 查找。HLR 代表归属位置寄存器，它是具有实时用户信息的移动网络运营商数据库。有几个用于 HLR 查找的 API 服务，例如 www.hlr-lookups.com。

# c# - 是否有内置方法对 .NET EventLog.Entries 集合中的条目进行二进制搜索？

> ID：744236
> 
> 赞同：0
> 
> 时间：2009-04-13T15:21:14.387
> 
> 标签：c#, .net, event-log, binary-search

我正在开发一个日志解析服务，用于捕获 Windows 事件日志中的特定安全事件。我最初的想法是使用 Microsoft 的[LogParser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)，但除了选择预先已知的特定实例/事件 ID 之外，我并没有寻找任何功能。

经过一些基准测试后，我发现迭代整个 .NET`EventLog.Entries`集合在提取数据方面比查询 Microsoft 的 LogParser 快 3 倍多。

最终，要提取的数据将保存在 SQL Server 数据库中。由于该服务每天都会执行此任务，因此我希望避免重复条目，并且我需要一种方法来查找`EventLog.Entries`集合中尚未在数据库中的下一个条目。一旦找到初始条目，我就可以开始插入数据库。

我正要编写一个二分搜索，以使用`DATETIME`数据库中最新的时间戳字段来查找此条目，并将其与集合`TimeWritten`中某个项目的属性进行比较。`EventLog.Entries`我可以这样做，但我想知道是否已经有内置方法来执行此搜索？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T14:48:28.950

我最终写了自己的，因为我找不到内置的实现：

```
/// <summary>
/// Performs a binary search on a specified EventLogEntryCollection's
/// TimeWritten property
/// </summary>
/// <param name="entries">The collection to search</param>
/// <param name="value">The timestamp value being searched</param>
/// <param name="low">The lower-bound search index</param>
/// <param name="high">The upper-bound search index</param>
/// <returns>The index of a matching timestamp, or -1 if not found</returns>
private int BinarySearch(EventLogEntryCollection entries, DateTime value, int low, int high)
{
    if (high < low)
        return -1;
    int mid = low + ((high - low) / 2);
    if (entries[mid].TimeWritten > value)
        return BinarySearch(entries, value, low, mid - 1);
    else if (entries[mid].TimeWritten < value)
        return BinarySearch(entries, value, mid + 1, high);
    else
        return mid;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T06:00:48.967

我不知道`EventLogEntryCollection`，但如果你需要一个通用的二分搜索算法，你可以使用在[PowerCollections](http://books.google.si/books?id=AxW2pg1LYGcC&pg=PA296&lpg=PA296&dq=powercollections+binarysearch&source=bl&ots=54KoH9nUpx&sig=3XpEpwGPCvU7SHllal6OUwXg-SM&hl=en&ei=1iXkSfbmMo6PsAaf7MinCw&sa=X&oi=book_result&ct=result&resnum=1#PPA297,M1)库中实现的那个。

# sql - sql中的朴素贝叶斯计算

> ID：744237
> 
> 赞同：9
> 
> 时间：2009-04-13T15:21:14.603
> 
> 标签：sql, mysql, machine-learning, nlp, bayesian

我想使用朴素贝叶斯将文档分类为数量相对较多的类。我希望根据该文章是否与已正确验证该实体的文章相似，来确认文章中提及的实体名称是否真的是该实体。

比如说，我们在一篇文章中找到了“通用汽车”这一文本。我们有一组数据，其中包含文章和其中提到的正确实体。因此，如果我们发现新文章中提到的“通用汽车”，它是否应该属于先前数据中包含已知正品的那类文章提及“通用汽车”与未提及该实体的文章类别？

（我不是为每个实体创建一个类，并试图将每篇新文章分类到每个可能的类中。我已经有一种启发式方法来查找实体名称的合理提及，我只想验证有限数量的合理性该方法已经检测到的每篇文章的实体名称提及。）

鉴于潜在的课程和文章的数量非常大，而且朴素贝叶斯相对简单，我想在 sql 中完成整个事情，但是我在评分查询方面遇到了麻烦......

这是我到目前为止所拥有的：

```
CREATE TABLE `each_entity_word` (
  `word` varchar(20) NOT NULL,
  `entity_id` int(10) unsigned NOT NULL,
  `word_count` mediumint(8) unsigned NOT NULL,
  PRIMARY KEY (`word`, `entity_id`)
);

CREATE TABLE `each_entity_sum` (
  `entity_id` int(10) unsigned NOT NULL DEFAULT '0',
  `word_count_sum` int(10) unsigned DEFAULT NULL,
  `doc_count` mediumint(8) unsigned NOT NULL,
  PRIMARY KEY (`entity_id`)
);

CREATE TABLE `total_entity_word` (
  `word` varchar(20) NOT NULL,
  `word_count` int(10) unsigned NOT NULL,
  PRIMARY KEY (`word`)
);

CREATE TABLE `total_entity_sum` (
  `word_count_sum` bigint(20) unsigned NOT NULL,
  `doc_count` int(10) unsigned NOT NULL,
  `pkey` enum('singleton') NOT NULL DEFAULT 'singleton',
  PRIMARY KEY (`pkey`)
); 
```

标记数据中的每篇文章都被拆分为不同的单词，并且对于每个实体的每篇文章，每个单词都被添加到`each_entity_word`和/或其`word_count`递增和`doc_count`递增 in `entity_word_sum`，两者都相对于 an `entity_id`。对于该文章中提到的每个已知实体都重复此操作。

对于每篇文章，无论每个单词中包含的实体如何，`total_entity_word` `total_entity_word_sum`都类似地递增。

*   P(word|any document) 应该等于该 单词 的`word_count`in`total_entity_word``doc_count``total_entity_sum`
*   P(word|document 提到实体*x* ) 应该等于`word_count`in `each_entity_word`对于`entity_id` *x*超过`doc_count`in `each_entity_sum`对于`entity_id` *x*
*   P(word|document*没有*提到实体*x* ) 应该等于 ( `word_count`in`total_entity_word`减去它的`word_count`in`each_entity_word`代表那个实体的那个词) 超过 (the `doc_count`in`total_entity_sum`减去`doc_count`那个实体 in `each_entity_sum`)
*   P（文档提及实体*x*）应该等于`doc_count`该`each_entity_sum`实体 id 超过`doc_count`in`total_entity_word`
*   P（文档未提及实体*x*）应等于 1 减（`doc_count`in`each_entity_sum`代表*x*的实体 id over `doc_count`in `total_entity_word`）。

对于进来的新文章，将其拆分为单词，然后选择 where word in ('I', 'want', 'to', 'use'...) 反对`each_entity_word`or `total_entity_word`。在我使用的数据库平台（mysql）中，IN 子句得到了相对较好的优化。

sql 中也没有 product() 聚合函数，所以当然你可以只做 sum(log(x)) 或 exp(sum(log(x))) 来获得 product(x) 的等价物。

因此，如果我收到一篇新文章，将其拆分为不同的单词并将这些单词放入一个大的 IN() 子句和一个潜在的实体 id 进行测试，我怎样才能获得文章落入该实体的朴素贝叶斯概率id在sql中的类？

编辑：

尝试#1：

```
set @entity_id = 1;

select @entity_doc_count = doc_count from each_entity_sum where entity_id=@entity_id;

select @total_doc_count = doc_count from total_entity_sum;

select 
            exp(

                log(@entity_doc_count / @total_doc_count) + 

                (
                    sum(log((ifnull(ew.word_count,0) + 1) / @entity_doc_count)) / 
                    sum(log(((aew.word_count + 1) - ifnull(ew.word_count, 0)) / (@total_doc_count - @entity_doc_count)))
                )

            ) as likelihood,
        from total_entity_word aew 
        left outer join each_entity_word ew on ew.word=aew.word and ew.entity_id=@entity_id

        where aew.word in ('I', 'want', 'to', 'use'...); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-19T07:48:23.593

**使用 R 到 Postgres（或 MySQL 等）接口**

或者，我建议使用已建立的 stats 包和数据库的连接器。如果您想从朴素贝叶斯切换到更复杂的东西，这将使您的应用程序更加灵活：

[http://rpgsql.sourceforge.net/](http://rpgsql.sourceforge.net/)

```
bnd.pr> data(airquality)

bnd.pr> db.write.table(airquality, no.clobber = F)

bnd.pr> bind.proxy("airquality")

bnd.pr> summary(airquality)
Table name: airquality 
Database: test 
Host: localhost
Dimensions: 6 (columns) 153 (rows)

bnd.pr> print(airquality)
   Day Month Ozone Solar.R Temp
1    1     5    41     190   67
2    2     5    36     118   72
3    3     5    12     149   74
4    4     5    18     313   62
5    5     5    NA      NA   56
6    6     5    28      NA   66
7    7     5    23     299   65
8    8     5    19      99   59
9    9     5     8      19   61
10  10     5    NA     194   69
Continues for 143 more rows and 1 more cols...

bnd.pr> airquality[50:55, ]
   Ozone Solar.R Wind Temp Month Day
50    12     120 11.5   73     6  19
51    13     137 10.3   76     6  20
52    NA     150  6.3   77     6  21
53    NA      59  1.7   76     6  22
54    NA      91  4.6   76     6  23
55    NA     250  6.3   76     6  24

bnd.pr> airquality[["Ozone"]]
  [1]  41  36  12  18  NA  28  23  19   8  NA   7  16  11  14  18  14  34   6
 [19]  30  11   1  11   4  32  NA  NA  NA  23  45 115  37  NA  NA  NA  NA  NA
 [37]  NA  29  NA  71  39  NA  NA  23  NA  NA  21  37  20  12  13  NA  NA  NA
 [55]  NA  NA  NA  NA  NA  NA  NA 135  49  32  NA  64  40  77  97  97  85  NA
 [73]  10  27  NA   7  48  35  61  79  63  16  NA  NA  80 108  20  52  82  50
 [91]  64  59  39   9  16  78  35  66 122  89 110  NA  NA  44  28  65  NA  22
[109]  59  23  31  44  21   9  NA  45 168  73  NA  76 118  84  85  96  78  73
[127]  91  47  32  20  23  21  24  44  21  28   9  13  46  18  13  24  16  13
[145]  23  36   7  14  30  NA  14  18  20 
```

然后，您需要安装 e1071 软件包来执行朴素贝叶斯。在 R 提示符下：

```
[ramanujan:~/base]$R

R version 2.7.2 (2008-08-25)
Copyright (C) 2008 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

 ~/.Rprofile loaded.
Welcome at  Sun Apr 19 00:45:30 2009
> install.packages("e1071")  
> install.packages("mlbench")
> library(e1071)
> ?naiveBayes
> example(naiveBayes) 
```

更多信息：

[http://cran.r-project.org/web/packages/e1071/index.html](http://cran.r-project.org/web/packages/e1071/index.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-02-25T16:21:35.847

这是 SQL Server 的简单版本。我在一个免费的 SQL Express 实现上运行它，它非常快。

[http://sqldatamine.blogspot.com/2013/07/classification-using-naive-bayes.html](http://sqldatamine.blogspot.com/2013/07/classification-using-naive-bayes.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T16:13:22.200

我没有时间计算公式的所有表达式`NB`，但这里是主要思想：

```
SET @entity = 123;

SELECT  EXP(SUM(LOG(probability))) / (EXP(SUM(LOG(probability))) + EXP(SUM(LOG(1 - probability))))
FROM    (
        SELECT  @entity AS _entity,
                /* Above is required for efficiency, subqueries using _entity will be DEPENDENT and use the indexes */
                (
                SELECT  SUM(word_count)
                FROM    total_entity_word
                WHERE   word = d.word
                )
                /
                (
                SELECT  doc_count
                FROM    each_entity_sum
                WHERE   entity_id = _entity
                ) AS pwordentity,
                /* I've just referenced a previously selected field */
                (
                SELECT  1 - pwordentity
                ) AS pwordnotentity,
                /* Again referenced a previously selected field */
                ... etc AS probability
        FROM    total_entity_word
        ) q 
```

请注意，您可以`SELECT`通过在相关子查询中使用它们来轻松引用前一个字段（如示例中所示）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-19T07:40:16.750

**如果使用 Oracle，它具有内置的数据挖掘功能**

我不确定您正在运行什么数据库，但如果您使用的是 Oracle，则数据挖掘功能已融入数据库：

[http://www.oracle.com/technology/products/bi/odm/index.html](http://www.oracle.com/technology/products/bi/odm/index.html)

...包括朴素贝叶斯：

[http://download.oracle.com/docs/cd/B28359_01/datamine.111/b28129/algo_nb.htm](http://download.oracle.com/docs/cd/B28359_01/datamine.111/b28129/algo_nb.htm)

还有很多其他人：

[http://www.oracle.com/technology/products/bi/odm/odm_techniques_algorithms.html](http://www.oracle.com/technology/products/bi/odm/odm_techniques_algorithms.html)

这让我很惊讶。绝对是 Oracle 在该领域相对于开源替代品的竞争优势之一。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-22T17:54:24.997

这是一篇详细介绍您正在寻找的内容的博客文章：http: [//nuncupatively.blogspot.com/2011/07/naive-bayes-in-sql.html](http://nuncupatively.blogspot.com/2011/07/naive-bayes-in-sql.html)

我在 SQL 中编写了许多版本的 NB 分类器。上面提倡更改分析包的答案不适用于我的大数据和处理时间要求。我有一个表格，每个单词/类组合都有一行（nrows = words * classes）和一个系数列。我有另一个表，其中包含 document_id 和 word 列。我只是将这些表按单词组合在一起，按文档分组，并对系数求和，然后调整类概率的总和。这给我留下了一张包含 document_id、class、score 的表格。然后我只选择了最低分数（因为我正在做一个补充朴素贝叶斯方法，我发现它在多类情况下效果更好）。

作为旁注，我发现许多转换/算法修改大大改善了我的坚持预测。它们在 Jason Rennie 的“解决朴素贝叶斯文本分类器的不良假设”的著作中进行了描述，并在此处进行了总结：[http ://www.ist.temple.edu/~vucetic/cis526fall2007/liang.ppt](http://www.ist.temple.edu/~vucetic/cis526fall2007/liang.ppt)

# latex - 我可以在使用 LaTeX Beamer 进行逐项列出期间转到另一帧吗？

> ID：744243
> 
> 赞同：8
> 
> 时间：2009-04-13T15:23:15.457
> 
> 标签：latex, beamer

基本上我想做这样的事情：

```
\begin{frame}{Frame 1}
  \begin{itemize}
    \item A \pause
    \item B \pause
    \item C \pause
    \showsubframe
    % continue here
    \item D \pause
    \item E \pause
  \end{itemize}
\end{frame}

\begin{frame}{Subframe} % only show this during Frame 1, not also after
   % something to help explain point C from Frame 1
\end{frame} 
```

有谁知道我如何在另一帧中显示一帧？另外，我想我必须在某处定义子框架（例如在主框架之后），并且我不想在主框架之后再次显示它。

谢谢你的时间！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-13T21:57:50.767

您可以使用`\againframe`恢复前一帧的显示。

例子：

```
\frame<1-3>[frame1]{
  \begin{itemize}
    \item<1-> A
    \item<2-> B
    \item<3-> C
    \item<4-> D
    \item<5-> E
  \end{itemize}
}

\frame{
   % something to help explain point C from Frame 1
}

\againframe<4->{frame1} 
```

# c# - GDI+：视觉选择指示器的 DrawReversible 替代方案？

> ID：744248
> 
> 赞同：1
> 
> 时间：2009-04-13T15:24:29.527
> 
> 标签：c#, gdi+, drawing, bitmap

我一直在寻找另一种在**不使用**和相关 XOR 方法的情况下为视觉对象（如选定的边缘、线条等）**绘制选择指示符的替代方法。**原因是不需要的异或“伪影”、不适用于位图的可逆性、无法控制实际视觉外观和速度缓慢。**`ControlPaint.DrawReversibleFrame`**

另一方面，如果用户决定取消选择一两个对象，我想**避免重新绘制整个场景（实际上是地图），因为重新绘制可能会非常昂贵。**

所以我能看到的唯一选择是直接在 a 上实现一些基本的绘图逻辑`Bitmap`，但在像素更改之前**存储像素的先前内容。**然后（理论上）如果用户选择取消选择该边缘，我将能够重新应用选定边缘矩形的旧内容。

我的问题是您是否认为这是一个好主意，或者您是否看到我的问题的其他替代方案（在 GDI+ 内）？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-04T19:57:46.360

如果选择指示器只是绘制在未选择对象的顶部，您可以使用两个位图，在一个背景上绘制所有未选择的对象，在另一个上绘制选择指示器，然后将它们都绘制在屏幕上。
否则，您可以执行相同的操作，只是您渲染选定的对象而不仅仅是指示器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-26T04:55:17.013

仅将“感兴趣”的矩形存储在屏幕外缓冲区中。并在失去焦点时重新绘制。. . 或者，如果您可以根据内存数据重新绘制正常显示的部分，您应该没问题。否则，您似乎掌握了要点。

# python - 用 Python 读取大文件

> ID：744256
> 
> 赞同：13
> 
> 时间：2009-04-13T15:28:04.290
> 
> 标签：python, performance, file-io, large-files

我有一个 384MB 的文本文件，有 5000 万行。每行包含 2 个空格分隔的整数：一个键和一个值。文件按关键字排序。我需要一种有效的方法来查找 Python 中大约 200 个键的列表的值。

我目前的方法包括在下面。这需要 30 秒。必须有更高效的 Python foo 才能将其降低到最多几秒钟的合理效率。

```
# list contains a sorted list of the keys we need to lookup
# there is a sentinel at the end of list to simplify the code
# we use pointer to iterate through the list of keys
for line in fin:
  line = map(int, line.split())
  while line[0] == list[pointer].key:
    list[pointer].value = line[1]
    pointer += 1
  while line[0] > list[pointer].key:
    pointer += 1
  if pointer >= len(list) - 1:
    break # end of list; -1 is due to sentinel 
```

编码二进制搜索 + 寻找解决方案（感谢 kigurai！）：

```
entries = 24935502 # number of entries
width   = 18       # fixed width of an entry in the file padded with spaces
                   # at the end of each line
for i, search in enumerate(list): # list contains the list of search keys
  left, right = 0, entries-1 
  key = None
  while key != search and left <= right:
    mid = (left + right) / 2
    fin.seek(mid * width)
    key, value = map(int, fin.readline().split())
    if search > key:
      left = mid + 1
    else:
      right = mid - 1
  if key != search:
    value = None # for when search key is not found
  search.result = value # store the result of the search 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-13T15:37:33.317

如果你只需要 5000 万行中的 200 行，那么将它们全部读入内存是一种浪费。我会对搜索键列表进行排序，然后使用 seek() 或类似的东西对文件应用二进制搜索。这样你就不会将整个文件读入内存，我认为这应该加快速度。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-13T15:46:13.797

S.Lotts 答案的轻微优化：

```
from collections import defaultdict
keyValues= defaultdict(list)
targetKeys= # some list of keys as strings
for line in fin:
    key, value = line.split()
    if key in targetKeys:
        keyValues[key].append( value ) 
```

由于我们使用的是字典而不是列表，因此键不必是数字。这会为每一行保存 map() 操作和字符串到整数的转换。如果您希望键是数字，请在最后进行转换，此时您只需为每个键执行一次，而不是为 5000 万行中的每一行执行一次。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-13T15:33:48.100

目前尚不清楚“list[pointer]”是什么意思。但是，请考虑这一点。

```
from collections import defaultdict
keyValues= defaultdict(list)
targetKeys= # some list of keys
for line in fin:
    key, value = map( int, line.split())
    if key in targetKeys:
        keyValues[key].append( value ) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-13T15:32:40.443

我会使用内存映射：http: [//docs.python.org/library/mmap.html](http://docs.python.org/library/mmap.html)。
通过这种方式，您可以像存储在内存中一样使用该文件，但操作系统会决定应该从文件中实际读取哪些页面。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-13T16:35:18.077

这是对文本文件的递归二进制搜索

```
import os, stat

class IntegerKeyTextFile(object):
    def __init__(self, filename):
        self.filename = filename
        self.f = open(self.filename, 'r')
        self.getStatinfo()

    def getStatinfo(self):
        self.statinfo = os.stat(self.filename)
        self.size = self.statinfo[stat.ST_SIZE]

    def parse(self, line):
        key, value = line.split()
        k = int(key)
        v = int(value)
        return (k,v)

    def __getitem__(self, key):
        return self.findKey(key)

    def findKey(self, keyToFind, startpoint=0, endpoint=None):
        "Recursively search a text file"

        if endpoint is None:
            endpoint = self.size

        currentpoint = (startpoint + endpoint) // 2

        while True:
            self.f.seek(currentpoint)
            if currentpoint <> 0:
                # may not start at a line break! Discard.
                baddata = self.f.readline() 

            linestart = self.f.tell()
            keyatpoint = self.f.readline()

            if not keyatpoint:
                # read returned empty - end of file
                raise KeyError('key %d not found'%(keyToFind,))

            k,v = self.parse(keyatpoint)

            if k == keyToFind:
                print 'key found at ', linestart, ' with value ', v
                return v

            if endpoint == startpoint:
                    raise KeyError('key %d not found'%(keyToFind,))

            if k > keyToFind:
                return self.findKey(keyToFind, startpoint, currentpoint)
            else:
                return self.findKey(keyToFind, currentpoint, endpoint) 
```

在 jEdit 中创建的示例文本文件似乎可以工作：

```
>>> i = integertext.IntegerKeyTextFile('c:\\sampledata.txt')
>>> i[1]
key found at  0  with value  345
345 
```

它肯定可以通过缓存找到的键并使用缓存来确定未来的起始搜索点来改进。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-13T15:53:55.320

如果您对文件的格式有任何控制权，则“排序和二进制搜索”响应是正确的。细节是这只适用于固定大小和偏移量的记录（好吧，我应该说它只适用于固定长度的记录）。

使用固定长度的记录，您可以轻松地在已排序的文件周围 seek() 以找到您的密钥。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-13T15:40:51.873

一种可能的优化是使用[file.readlines(..)](http://docs.python.org/library/stdtypes.html#file.readlines)`sizehint`中的选项进行一些缓冲。这允许您在内存中加载多行，总计约为字节。`sizehint`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-13T15:56:12.913

您需要使用 seek() 实现二进制搜索

# windows - 如何向资源管理器右键单击上下文菜单添加新选项？

> ID：744258
> 
> 赞同：3
> 
> 时间：2009-04-13T15:29:03.057
> 
> 标签：windows, visual-studio

我想为所有显示“构建”的 .sln 文件在 Windows 资源管理器中添加一个右键菜单选项。它只需要调用 devenv 来构建 sln 而无需先打开它。最简单的方法是什么？

请注意，我使用的是 Windows Vista，如果这很重要的话。

**解决方案**

我在 32 位 Windows 上找到了 Vs2008 的简单解决方案。使用以下命令创建并运行 .Reg 文件：

```
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\VisualStudio.Launcher.sln\Shell\Build (Debug)\command]
@="\"C:\\Program Files\\Microsoft Visual Studio 9.0\\Common7\\IDE\\devenv.com\" %1 /Build Debug" 
```

并确保 Visual Studio 的路径正确。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T16:26:47.537

使用它创建并运行 .Reg 文件，并确保 Visual Studio 的路径正确。

```
Windows Registry Editor Version 5.00

[HKEY_CLASSES_ROOT\VisualStudio.Launcher.sln\Shell\Build (Debug)\command]
@="\"C:\\Program Files\\Microsoft Visual Studio 9.0\\Common7\\IDE\\devenv.com\" %1 /Build Debug" 
```

以上示例适用于 32 位窗口上的 VS2008。对于较新版本的 Visual Studio，请更新 Common7 文件夹的路径

*   VS2008 - 微软 Visual Studio 9.0
*   VS2010 - 微软 Visual Studio 10.0
*   VS2012 - 微软 Visual Studio 13.0
*   VS2013 - 微软 Visual Studio 12.0

如果您正在运行 64 位 (x64) 窗口，则路径将是：

```
"C:\\Program Files (x86)\\Microsoft Visual Studio ??.0\\Common7\\IDE\\devenv.com\" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T15:37:40.243

您将需要编写一个 shell 扩展。看：

[http://www.theserverside.net/tt/articles/showarticle.tss?id=ShellExtensions](http://www.theserverside.net/tt/articles/showarticle.tss?id=ShellExtensions)

# sql-server - 群集上的每个 SQL Server 实例是否都需要自己的 LUN？

> ID：744259
> 
> 赞同：0
> 
> 时间：2009-04-13T15:29:21.793
> 
> 标签：sql-server, cluster-computing, failovercluster, san

我正在设置一个 Misc SQL 集群（Windows 2008/SQL 2005 和 2008），它将处于活动/活动状态，并且上面有十几个 SQL 实例。从我读过的文档中，我无法判断每个 SQL 实例是否需要自己的 LUN，或者我是否可以创建一个非常大的 LUN，然后在该 LUN 上创建十几个不同的分区（每个分区一个SQL 实例）。

在任何一种情况下，SAN 上的物理磁盘布局都不会改变，因此从性能的角度来看，我选择哪一个并不重要（假设我可以选择其中任何一个）。我只想知道分区方法是否有效，或者每个实例是否需要拥有自己的 LUN 才能正确处理故障转移。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T15:48:18.407

每个实例都需要单独的磁盘/LUN。它们将由活动节点“拥有”并且是依赖资源。

如果你想一想，2 个 SQL Server 实例如何共享一个驱动器？这是一个冲突。

从 Windows 2003 开始​​，您可以使用 NTFS 挂载点，即将 LUN 挂载到驱动器中的 empoty 文件夹中。虽然我自己没有尝试过。

编辑：这里有一些漂亮的图片“[集群共享卷如何工作](http://windowsitpro.com/article/articleid/100867/q-how-do-cluster-shared-volumes-work-in-windows-server-2008-r2.html)”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T14:04:17.043

每个实例都需要单独的磁盘。在 Server 2008 中，您将为故障转移管理器中的每个实例添加共享存储。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-29T18:55:59.900

我想知道是否有办法使用 CSV（集群共享卷）来解决这个问题。在 Windows 2008 R2 中，您可以对其进行设置，以便集群中的多个节点可以访问同一个 LUN - 您不再需要仅将 LUN 分配给一个节点！

# syncml - 功能齐全的 SyncML 兼容 WBXML 编码器-解码器？

> ID：744273
> 
> 赞同：2
> 
> 时间：2009-04-13T15:34:10.110
> 
> 标签：syncml, wbxml

是否有任何可用的 WBXML 编码器-解码器至少完全符合 SyncML 1.2？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-25T12:10:21.223

终于找到了一个按预期工作的转换器。适用于所有版本的 SyncML。

**[http://libwbxml.aymerick.com/browser/wbxmlTestSuite/trunk/TestSuite.bat?rev=6](http://libwbxml.aymerick.com/browser/wbxmlTestSuite/trunk/TestSuite.bat?rev=6)**

# oracle10g - Oracle 10g 最大会话过期数

> ID：744279
> 
> 赞同：1
> 
> 时间：2009-04-13T15:35:54.770
> 
> 标签：oracle10g

我们有 Oracle 10 g 数据库，我们收到消息为 ORA-00018: maximum number of sessions exceeded 。我们配置参数如下；

会话 600 进程：600

及其共享服务器模式。我们将其更新为会话：900 和进程：750。现在 Oracle 正在运行，但我需要知道这是否有助于我们继续，或者我还需要做一些其他更改以避免错误“ORA-00018：最大超出会话数"

任何人都可以帮助请您的回复非常感谢

问候约瑟夫

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T15:37:54.423

您可能有用户进行会话并且根本不释放它们，或者长时间保持它们。当您遇到该异常时，请查看是否有任何长时间运行的事务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T15:49:17.890

了解这一点的最佳方法是每隔 5-10 分钟连接到数据库并转储 v$session 表。通过这种方式，您可以了解有时所有进程/应用程序都与数据库保持连接。这可能是一个长期运行的进程/守护进程/服务根本没有释放会话的错误。一个简单的脚本，如果您可以作为 cron 作业运行以转储 v$session 表，它可能会变得可见。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-07-05T14:31:14.210

对于 12c 数据库，这是我解决它的方法：

**1**控制正在使用的连接数

登录您的 PDB

```
sqlplus <username>/<pswd>@<hostname>:1521/<ServiceName> 
```

检查连接数

```
SELECT
    'Currently, ' 
    || (SELECT COUNT(*) FROM V$SESSION)
    || ' out of ' 
    || VP.VALUE 
    || ' connections are used.' AS USAGE_MESSAGE
FROM 
    V$PARAMETER VP
WHERE 
    VP.NAME = 'sessions' 
```

它显示“当前使用了 m 个连接中的 n 个”。这里 n > m。应该是相反的。

**2**更改最大会话数

在您的 PDB 中以 sys 身份登录

```
quit
sqlplus / as sysdba
alter session set container = PDB1; 
```

更改会话数

```
alter system set sessions=100 scope=both sid='*'; 
```

**3**弹回数据库

```
SQL> shutdown immediate
SQL> startup 
```

打开所有 PDB（由弹跳关闭）

```
ALTER PLUGGABLE DATABASE ALL OPEN; 
```

**4**再次控制

```
sqlplus <username>/<pswd>@<hostname>:1521/<ServiceName> 
```

运行控制 SQL 查询

```
SELECT
    'Currently, ' 
    || (SELECT COUNT(*) FROM V$SESSION)
    || ' out of ' 
    || VP.VALUE 
    || ' connections are used.' AS USAGE_MESSAGE
FROM 
    V$PARAMETER VP
WHERE 
    VP.NAME = 'sessions' 
```

它显示“当前使用了 m 个连接中的 n 个”。现在 n < m。

# .net - 如何在 asp.net 中的数据绑定 asp:hyperlink 字段上插入单引号？

> ID：744280
> 
> 赞同：1
> 
> 时间：2009-04-13T15:36:37.267
> 
> 标签：.net, asp.net

我正在尝试将 ASP.NET 超链接绑定到我的数据集的“句柄”列，如下所示：

```
<ItemTemplate>
    <asp:HyperLink ID="idTracking" runat="server"  NavigateUrl='<%# "javascript:SendPath(" + Eval( "Handle", "{0}") + ")" %>' Text="Test" />                                            
</ItemTemplate> 
```

我希望 NavigateUrl 阅读：

```
javascript:SendPath('123abc') 
```

但是，我不能介绍单引号。我该怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T15:43:32.397

据我所知，超链接控件的文本属性会自动编码，我总是必须简单地将其作为标准的 html 锚标记。

所以像这样。

```
<a href='<%# "javascript:SendPath(" + Eval( "Handle", "{0}") + ")" %>'>Your Link</a> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T15:51:56.153

为什么不这样做：

```
 <asp:HyperLink ID="idTracking" runat="server"  NavigateUrl='<%#  Eval("Handle", "javascript:SendPath(\'{0}\')") %>' Text="Test" /> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T15:57:24.017

请务必转义您放入 {0} 位置的字符串中的任何单引号。我的建议是使用 HTML 锚标记而不是像这样的 asp:HyperLink 控件：

```
<asp:TemplateColumn ...>
  <ItemTemplate>
    <a href="javascript:SendPath('<%#Container.DataItem("Handle").ToString.Replace("'", "\'") %>');">Test</a>
  </ItemTemplate>
</asp:TemplateColumn> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-07-10T14:44:28.373

像这样写：

```
NavigateUrl='<%# "SendPath(\"" + Eval( "Handle", "{0}") + "\")" %>' 
```

工作示例：

**注意：** `\"`是写`"`在标签中的。

**输出**

```
NavigateUrl='SendPath("123")' 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-10-26T18:30:02.470

我试图自己弄清楚这一点。这似乎有效：

```
onmouseup=<% String.Format("alert('{0}')",Eval("Code"))  %> 
```

**注意**开头缺少的单引号。否则，ASP.NET 解析器将阻塞在 = 符号之后的单引号后面的单引号。HTML 语法检查器用绿色为文本加下划线，并说“属性值必须用引号括起来”，但它在生成的 html 中有效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-19T02:12:58.733

转换为标准的 html 锚标记通常可以解决问题。但是，如果您可能因为其他依赖关系而必须使用 asp 控件，\x0027 不会干扰 asp 语法。

```
<asp:HyperLink ID="lnkDelete" runat="server" NavigateUrl='<%# "return confirm(\x0027Delete " + Eval(Container.DataItem, "name") + "?\x0027)" %>' Text="Delete" /> 
```

# math - 一组给定的群元素是一组陪集代表吗？

> ID：744285
> 
> 赞同：10
> 
> 时间：2009-04-13T15:37:38.247
> 
> 标签：math, discrete-mathematics

恐怕这个问题有点技术性，但我希望有人可能偶然发现了类似的主题，或者给我一些指示。

如果 G 是一个群（在代数结构的意义上），并且如果 g [1] , ..., g [n]是 G 的元素，是否有算法（或某些专用程序中的函数，如 GAP）来确定是否存在是 G 的一个子群，使得这些元素构成该子群陪集的一组代表？（我们可以假设 G 是一个置换群，甚至可能是完全对称群。）

（当然有几种算法可以找到给定子群的陪集，例如 Todd-Coxeter 算法；这是一种逆问题。）

谢谢，丹尼尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T20:16:50.010

我能想出的唯一解决方案是幼稚的。基本上，如果您有元素`x1,...,xn`，您将使用 GAP`LowIndexSubgroupsFpGroup`来枚举索引为 n 的所有子组（丢弃索引 < n 的子组）。然后你会遍历每个这样的组，生成陪集，并检查每个陪集是否包含其中一个元素。

这就是我能想到的。如果您提出更好的方法，我会非常感兴趣。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-11T19:29:12.040

您要确定的是是否存在 G 的子群 H 使得 {g [1] , ..., g [n] } 是H 的陪集的[横向](http://en.wikipedia.org/wiki/Transversa)。即 G 的划分的一组代表H的陪集。

首先，根据[拉格朗日](http://en.wikipedia.org/wiki/Lagrange's_theorem_(group_theory))定理，|G| = |G:H| * |G|，其中 |G:H| = |G|/|H| 是 G 的子群 H 的索引。如果 {g [1] , ..., g [n] } 确实是横向的，则 |G:H| = |{g [1] , ..., g [n] }|，所以算法中的第一个测试应该是 n 是否整除 |G|。

此外，由于仅当 g [i] g [j] ^(-1在 H 中时 g) [i]和 g [j]才在同一个右陪集中，因此您可以检查具有索引 n 的子群以查看它们是否避免 g [i] g [j] ^(-1)。另外，请注意 (g [i] g [j] ^(-1) )(g [j] g [k] ^(-1) ) = g [i] g [k] ^(-1 ，因此您可以选择 g) [i]的任何配对。

如果 n 比 |G| 小，这就足够了。

另一种方法是从 H 作为平凡群开始并添加集合 H ^* = {h in G : h ^k != g [i] g [j] ^(-1)的元素，对于所有 i, j, k; i != j} 到 H 的生成器，直到你不能再添加（即直到它不再是子组）。H 是 G 的最大子群，使得 H 是 H ^*的子集。如果你能得到所有这样的 H（并且让它们足够大），那么你正在寻找的子组必须是其中之一。

这种方法对于较大的 n 会更好。

无论哪种方式，非指数时间方法都不明显。

**编辑：**我刚刚在这里找到了关于这个主题的讨论：[http ://en.wikipedia.org/wiki/Wikipedia:Reference_desk/Archives/Mathematics/2009_April_18#Is_a_given_set_of_group_elements_a_set_of_coset_representatives.3F](http://en.wikipedia.org/wiki/Wikipedia:Reference_desk/Archives/Mathematics/2009_April_18#Is_a_given_set_of_group_elements_a_set_of_coset_representatives.3F)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T16:06:19.140

正如 Il-Bhima 建议的那样，一种稍微不那么粗暴的方法是枚举索引 n 的所有子组，然后对于每个子组，检查每个 x [i] * x [j] ^(-1)以查看它是否包含在子组中。

元素 x1, ..., xn 将是子组的代表当且仅当每个产品

x [i] * x [j] ^(-1)其中 (i != j)

不在子组中。

这种类型的检查似乎比生成所有陪集更简单，并且计算速度更快。

# sqlite - SQLite - 将值增加一定数量

> ID：744289
> 
> 赞同：116
> 
> 时间：2009-04-13T15:38:24.047
> 
> 标签：sqlite

是否可以在不读取最后一个值并随后更新它的情况下将表中的某个值增加某个数字？

即我有“产品”和“质量”栏：产品：iLamp 质量：50

我想将质量提高（或降低）x。为了实现这一点，我首先读取最后一个值 (50)，增加或减少它，然后将其写回。

有没有直接的方法来完成这个任务？

* * *

## 回答 #1

> 赞同：242
> 
> 时间：2009-04-13T15:39:35.137

**示例 1**（适用于所有行）：

```
UPDATE product SET price = price + 50 
```

**示例 2**（针对特定行）：

```
UPDATE product SET price = price + 50 WHERE id = 1 
```

**示例 3**（针对特定行）：

```
UPDATE product SET price = price + 50 WHERE id IN [1, 2, 3] 
```

**示例 4**（通用）：

```
UPDATE {table} SET {column} = {column} + {value} WHERE {condition} 
```

在哪里：

*   `{table}`- 表名
*   `{column}`- 列名
*   `{value}`- 应该增加或减少列值的数字
*   `{condition}`- 一些条件（如果有）

# .net - 实体框架 - 使用 GUID 作为条件

> ID：744292
> 
> 赞同：1
> 
> 时间：2009-04-13T15:40:30.877
> 
> 标签：.net, entity-framework

如何将此示例[继承和关联与实体框架一起](http://mosesofegypt.net/post/Inheritance-and-Associations-with-Entity-Framework-Part-1.aspx)使用，但使用数据类型 GUID 作为条件？

在这个示例中，我只使用字符串和整数作为条件。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T16:06:24.947

是的，只要 GUID 不是外键即可。任何标量类型都是允许的，并且 GUID 是标量，但它是实体框架的当前发布版本的限制，您不能使用外键值作为子类型鉴别器字段。

# python - python/django中的电子邮件白名单/黑名单

> ID：744308
> 
> 赞同：1
> 
> 时间：2009-04-13T15:46:11.423
> 
> 标签：python, django, email, whitelist, blacklist

我正在编写一个 django 应用程序，它跟踪允许哪些电子邮件地址将内容发布到用户的帐户。用户可以根据需要将地址列入白名单和黑名单。

任何未指定的地址都可以按消息处理，也可以默认为白名单或黑名单（再次由用户指定）。

这是我写的 django 模型......你认为这是一个好方法吗？还是应该为每个用户的配置文件模型添加白名单和黑名单字段？

```
class knownEmail(models.Model):
    # The user who set this address' permission, NOT
    # the user who the address belongs to...
    relatedUser = models.ManyToManyField(User)
    email = models.EmailField()

class whiteList(knownEmail):
    pass

class blackList(knownEmail):
    pass 
```

然后我可以做类似的事情：

```
def checkPermission(user, emailAddress):
    "Check if 'emailAddress' is allowed to post content to 'user's profile"
    if whiteList.objects.filter(relatedUser=user, email=emailAddress):
        return True
    elif blackList.objects.filter(relatedUser=user, email=emailAddress):
        return False
    else:
        return None 
```

有没有更好的办法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T22:17:36.913

我会对其进行重组，以便两个列表都包含在一个模型中。

```
class PermissionList(models.Model):
    setter = models.ManyToManyField(User)
    email = models.EmailField(unique=True) #don't want conflicting results
    permission = models.BooleanField() 
```

然后，您的列表将是：

```
# whitelist
PermissionList.objects.filter(permission=True)
# blacklist
PermissionList.objects.filter(permission=False) 
```

要检查特定用户，您只需向模型添加几个函数：

```
class PermissionList(...):
    ...
    @classmethod
    def is_on_whitelist(email):
        return PermissionList.objects.filter(email=email, permission=True).count() > 0

    @classmethod
    def is_on_blacklist(email):
        return PermissionList.objects.filter(email=email, permission=False).count() > 0

    @classmethod
    def has_permission(email):
        if PermissionList.is_on_whitelist(email):
            return True
        if PermissionList.is_on_blacklist(email):
            return False
        return None 
```

将所有内容放在一个地方要简单得多，而且您可以用更少的工作进行更有趣的查询。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T15:54:41.903

[请以大写字母开头所有类名。]

您的代码没有很好地利用您的类区别。

具体来说，您的类没有任何不同的行为。由于这两个类都有相同的方法，所以不清楚*为什么*它们是两个不同的类。如果他们有不同的方法，那么你的解决方案很好。

但是，如果它们没有不同的方法，您可能需要考虑为两个子集的每一个提供一个定制的[管理器](http://docs.djangoproject.com/en/dev/topics/db/managers/#managers)`KnownEmail`

```
class WhiteList( models.Manager ):
    def get_query_set( self ):
        return super( WhiteList, self ).get_query_set().filter( status='W' )

class BlackList( models.Manager )
    def get_query_set( self ):
        return super( BlackList, self ).get_query_set().filter( status='B' )

class KnownEmail( models.Model ):
    relatedUser = models.ForeignKey(User)
    email = models.EmailField()
    status = models.CharField( max_length=1, choices=LIST_CHOICES )
    objects = models.Manager() # default manager shows all lists
    whiteList= WhiteList() # KnownEmail.whiteList.all() is whitelist subset
    blackList= BlackList() # KnownEmail.blackList.all() is blackList subset 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-02-02T21:22:17.567

此类将电子邮件地址与电子邮件域的黑名单进行比较。如果您愿意，可以使用[pip install django-email-blacklist](https://pypi.python.org/pypi?:action=display&name=django-email-blacklist&version=1.0.1)下载此模块。

```
from django.conf import settings
import re

class DisposableEmailChecker():
"""
Check if an email is from a disposable
email service
"""

    def __init__(self):
        self.emails = [line.strip() for line in   open(settings.DISPOSABLE_EMAIL_DOMAINS)]

    def chunk(self, l, n):
        return (l[i:i + n] for i in range(0, len(l), n))

    def is_disposable(self, email):
        for email_group in self.chunk(self.emails, 20):
            regex = "(.*" + ")|(.*".join(email_group) + ")"
                if re.match(regex, email):
                    return True
                return False 
```

# ruby - 如何在 Ruby 中拼出整数？

> ID：744311
> 
> 赞同：3
> 
> 时间：2009-04-13T15:48:02.543
> 
> 标签：ruby, module, integer, inflection

有谁知道一个 Ruby 模块，它将接受一个整数并将其拼写出来（1 =>“一”，2 =>“二”等）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T15:54:56.567

试试这个：

[http://mike-burns.com/project/integer_to_word/](http://mike-burns.com/project/integer_to_word/)

# jquery - 在jQuery中获取CSS规则的百分比值

> ID：744319
> 
> 赞同：101
> 
> 时间：2009-04-13T15:50:17.887
> 
> 标签：jquery, css

假设规则如下：

```
.largeField {
    width: 65%;
} 
```

有没有办法以某种方式获得“65%”，而不是像素值？

谢谢。

**编辑：**不幸的是，在我的情况下使用 DOM 方法是不可靠的，因为我有一个导入其他样式表的样式表，因此**cssRules**参数以*null*或*undefined*值结束。

然而，这种方法适用于大多数简单的情况（一个样式表，文档的*head*标记内有多个单独的样式表声明）。

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2012-05-03T13:57:21.630

最简单的方法

```
$('.largeField')[0].style.width

// >>> "65%" 
```

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2013-11-09T07:56:15.163

这绝对是可能的！

您必须首先 hide() 父元素。这将阻止 JavaScript 计算子元素的像素。

```
$('.parent').hide();
var width = $('.child').width();
$('.parent').show();
alert(width); 
```

见我的[例子](http://jsfiddle.net/sxqnt/)。

现在......我想知道我是否是第一个发现这个黑客的人：）

**更新：**

# 单线

```
element.clone().appendTo('body').wrap('<div style="display: none"></div>').css('width'); 
```

它将在标签之前留下一个隐藏元素`</body>`，您可能想要`.remove()`。

请参阅[one-liner 的示例](http://jsfiddle.net/sxqnt/76/)。

我愿意接受更好的想法！

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2009-04-13T16:09:06.237

恐怕没有内置的方法。你可以这样做：

```
var width = ( 100 * parseFloat($('.largeField').css('width')) / parseFloat($('.largeField').parent().css('width')) ) + '%'; 
```

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2009-04-13T16:27:02.997

您可以访问该`document.styleSheets`对象：

```
<style type="text/css">
    .largeField {
        width: 65%;
    }
</style>
<script type="text/javascript">
    var rules = document.styleSheets[0].rules || document.styleSheets[0].cssRules;
    for (var i=0; i < rules.length; i++) {
        var rule = rules[i];
        if (rule.selectorText.toLowerCase() == ".largefield") {
            alert(rule.style.getPropertyValue("width"));
        }
    }
</script> 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2016-06-07T10:09:11.753

晚了，但对于新用户，**如果 css 样式包含百分比**，请尝试以下操作：

```
$element.prop('style')['width']; 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2012-09-04T19:15:22.170

基于 Adams 答案的 jQuery 插件：

```
(function ($) {

    $.fn.getWidthInPercent = function () {
        var width = parseFloat($(this).css('width'))/parseFloat($(this).parent().css('width'));
        return Math.round(100*width)+'%';
    };

})(jQuery);

$('body').html($('.largeField').getWidthInPercent());​​​​​ 
```

将返回“65%”。如果您喜欢 if (width=='65%')，则仅返回四舍五入的数字以更好地工作。如果您直接使用 Adams 的答案，那是行不通的（我得到了类似 64.93288590604027 的东西）。:)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-04-06T19:29:52.067

基于 timofey 出色且令人惊讶的解决方案，这是一个纯 Javascript 实现：

```
function cssDimensions(element) {
  var cn = element.cloneNode();
  var div = document.createElement('div');
  div.appendChild(cn);
  div.style.display = 'none';
  document.body.appendChild(div);
  var cs = window.getComputedStyle
    ? getComputedStyle(cn, null)
    : cn.currentStyle;
  var ret = { width: cs.width, height: cs.height };
  document.body.removeChild(div);
  return ret;
} 
```

希望它对某人有帮助。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-08-20T11:48:55.060

[我在 jQuery 中获取全局样式表的值中](https://stackoverflow.com/questions/7131462/getting-values-of-global-stylesheet-in-jquery)遇到了类似的问题，最终我想出了与[上面相同的解决方案](https://stackoverflow.com/questions/7131462/getting-values-of-global-stylesheet-in-jquery/7132264#7132264)。

只是想将这两个问题联系起来，以便其他人可以从以后的发现中受益。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-12-08T18:59:22.843

***使用交叉乘法将像素转换为百分比***。

**公式设置：**

1.) (element_width_pixels/parent_width_pixels) = (element_width_percentage / 100)

2.) element_width_percentage = (100 * element_width_pixels) / parent_width_pixels

**实际代码：**

```
<script>

   var $width_percentage = (100 * $("#child").width()) / $("#parent").width();

</script> 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-08-28T07:15:58.057

迟到的回应，但想为任何偶然发现此问题的 2020 年以上的人补充。可能更适合小众案例，但我想分享几个选项。

如果您知道初始 % 值是什么，您还可以将这些值分配给样式表的 :root 中的变量。IE

```
:root {
    --large-field-width: 65%;
}

.largeField {
  width: var(--large-field-width);
} 
```

当您想在 JS 中访问此变量时，您只需执行以下操作：

```
let fieldWidth = getComputedStyle(document.documentElement).getPropertyValue('--large-field-width');
// returns 65% rather than the px value. This is because the % has no relative
// size to the root or rather it's parent. 
```

另一种选择是在脚本开头指定默认样式：

```
element.style.width = '65%' 
```

然后可以通过以下方式访问它：

```
let width = element.style.width; 
```

我个人更喜欢第一个选项，但它确实取决于您的用例。这些都是技术上的内联样式，但我喜欢如何直接使用 JS 更新变量值。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-13T16:24:37.993

您可以将需要使用 jQuery 访问的样式放在以下任一位置：

1.  文件头直接
2.  在一个包含中，然后将哪个服务器端脚本放在头部

然后应该可以（虽然不一定容易）编写一个 js 函数来解析文档头中样式标签内的所有内容并返回您需要的值。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-10-03T04:11:27.250

jQuery 中没有任何内容，即使在 javascript 中也没有任何直接的内容。接受 timofey 的回答并使用它运行，我创建了这个函数来获取你想要的任何属性：

```
// gets the style property as rendered via any means (style sheets, inline, etc) but does *not* compute values
// domNode - the node to get properties for 
// properties - Can be a single property to fetch or an array of properties to fetch
function getFinalStyle(domNode, properties) {
    if(!(properties instanceof Array)) properties = [properties]

    var parent = domNode.parentNode
    if(parent) {
        var originalDisplay = parent.style.display
        parent.style.display = 'none'
    }
    var computedStyles = getComputedStyle(domNode)

    var result = {}
    properties.forEach(function(prop) {
        result[prop] = computedStyles[prop]
    })

    if(parent) {
        parent.style.display = originalDisplay
    }

    return result
} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2010-03-06T10:42:36.223

您可以使用 css(width) 函数返回元素的当前宽度。

IE。

```
var myWidth = $("#myElement").css("width"); 
```

另见： [http :](http://api.jquery.com/css/) [//api.jquery.com/width/ http://api.jquery.com/css/](http://api.jquery.com/width/)

# python - python中的导入是静态的，有什么解决方案吗？

> ID：744325
> 
> 赞同：4
> 
> 时间：2009-04-13T15:52:59.130
> 
> 标签：python

foo.py：

```
i = 10

def fi():
    global i
    i = 99 
```

bar.py：

```
import foo
from foo import i

print i, foo.i
foo.fi()
print i, foo.i 
```

这是有问题的。为什么`i`改变时不`foo.i`改变？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-13T16:05:56.277

罗斯所说的是像这样重构 foo ：

```
_i = 10

def getI():
    return _i

def fi():
    global _i
    _i = 99 
```

然后你会看到它以你想要的方式工作：

```
>>> import foo
>>> print foo.getI()
10
>>> foo.fi()
>>> print foo.getI()
99 
```

从某种意义上说，它也“更好”，因为您避免导出全局，但仍提供对它的读取访问。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-13T16:15:33.787

`import`所做的是`bar.py`设置一个`i`在模块命名空间中调用的标识符，该标识符指向与在`bar.py`模块命名空间中调用的标识符相同的地址。`i``foo.py`

这是一个重要的区别......`bar.i`不是指向`foo.i`，而是指向内存中`10`保存对象的同一空间，该空间`foo.i`恰好同时指向。在python中，变量名不是内存空间......它们是指向内存空间的标识符。当您在 bar 中导入时，您正在设置一个本地名称空间标识符。

您的代码在`foo.fi()`调用之前按预期运行，`i`此时 foo.py 命名空间中的标识符更改为指向文字 99，这是内存中的一个对象，显然与 10 位于不同的位置。现在模块级命名空间字典`foo`具有`i`在内存中标识`i`与 bar.py中的标识符不同的对象。

Shane 和 rossfabricant 对如何调整你的模块以实现你想要的有很好的建议。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T17:10:17.570

`i`inside`foo.py`与in**不同** 。当你这样做时：`i``bar.py``bar.py`

```
from foo import i 
```

这会创建一个新`i`的 in `bar.py`，它与 in*引用相同*的`i`对象`foo.py`。

你的问题是：当你打电话时`foo.fi()`，它会这样做：

```
i = 99 
```

该赋值使`foo.py`'`i`指向另一个整数对象 ( `99`)。整数对象本身是不可变的（谢天谢地），所以它只会改变`foo.py`'s`i`指向的东西。不是`bar.py`的`i`。`bar.py`'s`i`仍然指向它之前指向的旧对象。（整数不可变对象`10`）

您可以通过将以下命令放入以下命令来测试我在说什么`bar.py`：

```
print foo.i 
```

它应该打印`99`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T15:56:22.600

您可以调用函数而不是引用全局变量。

# iphone - 为什么在 iPhone 上使用 UIImage 渲染不同图像时性能不佳

> ID：744327
> 
> 赞同：1
> 
> 时间：2009-04-13T15:53:01.533
> 
> 标签：iphone, performance, uiimage, render

我正在使用 UIImage 从 32x32 块渲染游戏地图。代码如下

```
for( int x = 0; x < rwidth; ++x)
{
    for(int y = 0; y < rheight; ++y)
    {
        int bindex = [current_map GetTileIndex:x :y];
        CGPoint p;
        p.x = x * tile_size_x;
        p.y = y * tile_size_x;
        [img_list[bindex] drawAtPoint:p];
    }
} 
```

这最终会渲染大约 150 个图块。我的问题是当我运行这段代码时，我的渲染时间会下降到每秒 2-3 帧。

我认为 iPhone 是填充绑定的，但是如果我强制 bindex = 1（即渲染相同的块 150 次），那么我会得到完整的帧速率。

我不敢相信从不同的 UIImages 渲染是如此昂贵。

有人可以告诉我我做错了什么...

哦，我忘了提及使用 CGImageCreateWithImageInRect 从更大的纹理页面创建的图像列表。

谢谢丰富

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T18:09:45.103

破解打开 Instruments 并分析您的代码。看起来您正在绘制 UIView，并且它们并未真正针对游戏进行优化。由于 UIView 是基于图层的，因此 drawAtPoint: 需要在图像出现在屏幕上之前多次绘制图像（到屏幕外缓冲区）。

话虽如此，UIImage 并不是真正为游戏设计的。作为 UIKit 的一部分有很多开销。你并不是真的要拥有数百个。

大约按速度顺序（从最慢到最快）：

*   UIImage（如果你有几个大图像通常使用）
*   CALayers（如果你需要精细的动画控制或者你有大约 20 到 100 个图块/图像）
*   OpelGL 纹理（大多数游戏应该使用的）

# iphone - 可以仅使用网页重定向吗？

> ID：744329
> 
> 赞同：1
> 
> 时间：2009-04-13T15:53:08.897
> 
> 标签：iphone, cocoa-touch, uiwebview

我有一个 UIWebView，它通过 viewDidLoad 中的 loadRequest 加载 URL。用户单击 RootViewController 中的一个按钮，该按钮会推送 webview 并出现一个网页。只能访问网页代码，有没有办法重定向用户？我尝试了 META Refresh，但没有任何影响。

链接不起作用，因为 webview 委托方法都没有在 webview 中实现。我现在试图避免发布应用程序的更新。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T16:10:29.103

1）再次检查元刷新语法：

```
<head>
<meta http-equiv="refresh" content="0; URL=http://www.example.com/page123.html" />
</head> 
```

2）你说你可以访问网页代码，这能走多远？你能操纵http-header吗，如果是php-page，这是可能的：

```
<?php
header("Location: http://www.example.com/page123.html"); /* Redirect browser */

/* Make sure that code below does not get executed when we redirect. */
exit;
?> 
```

示例取自[http://de.php.net/header](http://de.php.net/header)

其他服务器端语言应该有类似的东西。

3）使用JavaScript：

```
window.location = 'http://www.example.com/page123.html'; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T15:59:46.727

使用 JavaScript：

```
window.location = 'http://stackoverflow.com/questions/744329/possible-to-redirect-using-only-webpage'; 
```

# database - 我可以在 CakePHP 的用户表上添加其他字段并且仍然使用内置的身份验证方法吗？

> ID：744331
> 
> 赞同：0
> 
> 时间：2009-04-13T15:53:32.297
> 
> 标签：database, model-view-controller, authentication, cakephp

我正在使用 cakePHP，我想在 Users 表中添加一个名字和姓氏列，但是当我通过字段值时`firstname`，`lastname`这些列始终为空，而默认字段填充得很好。

是否可以这样做或者我需要第二个表来存储这些值？

更新代码：

报名表格

```
 <?php
    $session->flash('register');
    echo $form->create('User', array('action' => 'register/'));
    echo '<h3>Register</h3>';
    echo $form->input('firstname', array('label'=>'First Name'));
    echo $form->input('lastname', array('label'=>'Last Name'));
    echo $form->input('username');
    echo $form->input('email');
    echo '<input class="submitimg" type="image" src="' . $basepath . 'img/btn_submit.gif" alt="Submit" />';
    echo $form->end();
    ?> 
```

在 user_controller.php 中注册操作

```
 function register() {
    if (!empty($this->data)) {

        $password = $this->str_makerand(8,10);
        $this->data['User']['password'] = $this->Auth->password($password);

        $this->User->create(); 
        $result = $this->User->save($this->data);

        if ($result) {
            $this->Session->setFlash('Registration complete, an email will be sent with your password', 'default', array(), 'register');
            $this->sendNewUserMail($this->data['User']['username'], $this->data['User']['email'], $password);
        } else {            
            $this->Session->setFlash('That username or email address is already taken, please try again', 'default', array(), 'register');
        }           
    }
    $this->redirect(array('controller' => 'properties', 'action' => 'index'));
} 
```

MySQL用户表：

```
CREATE TABLE users (
  id int(11) NOT NULL AUTO_INCREMENT,
  username char(50) DEFAULT NULL,
  firstname varchar(100) NOT NULL,
  lastname varchar(100) NOT NULL,
  password char(50) DEFAULT NULL,
  email varchar(100) NOT NULL,
  created datetime NOT NULL,
  PRIMARY KEY (id),
  UNIQUE KEY email (email),
  UNIQUE KEY username (username)
) 
```

谢谢你的帮助

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T16:00:29.563

您绝对可以在您的用户表上添加其他字段。Auth 组件只会针对该表中的用户名和密码字段进行授权。事实上，如果您阅读 Auth 组件的属性，您会发现您可以设置 Cake 将使用哪些字段作为用户/密码字段。

听起来你的问题是一个错误。请发布一些代码和数据库架构，我会进一步帮助您。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T16:00:23.120

在这种情况下，最好将一个单独的表链接到包含您要保留的所有额外信息的用户表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T16:50:54.920

这是我的用户表：

```
CREATE TABLE `cake_users` (
    `id` int(11) unsigned NOT NULL auto_increment,
    `username` varchar(100) default NULL,
    `password` varchar(100) default NULL,
    `email` varchar(150) default NULL,
    `firstname` varchar(60) default NULL,
    `lastname` varchar(60) default NULL,
    `priv` int(4) default '0',
    PRIMARY KEY (`id`)
); 
```

我没有公共用户注册，但我可以使用附加字段创建用户。这是我在控制器中使用的代码：

```
function admin_add() {
    if (!empty($this->data)) {
        $this->User->create();
        $this->set('password',$this->Auth->password($this->data['User']['password']));
        if ($this->User->save($this->data)) {
            $this->Session->setFlash(__('The User has been saved', true));
            $this->redirect(array('action'=>'index'));
        } else {
            $this->Session->setFlash(__('The User could not be saved. Please, try again.', true));
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T18:59:21.023

额外的字段是或当然是可能的和正常的。您的代码中的某处可能存在隐藏的错误。

`$this->data`您是否在发布后尝试调试/输出？您的名字/姓氏值是否显示在数组中？您的模型中是否有列白名单/黑名单阻止保存这些字段？输入字段在输出 HTML 中的外观如何？他们应该被命名为`data[User][firstname]`，如果他们不是，那么就大错特错了..

# events - 密钥预览和接受按钮

> ID：744335
> 
> 赞同：1
> 
> 时间：2009-04-13T15:54:42.293
> 
> 标签：events, acceptbutton

使用 winforms，我将 KeyPreview 属性设置为 true，并且在基本表单中也为正确的键事件提供了事件句柄。

在从它继承的表单中，我根据应用程序的要求设置了 AcceptButton 属性。

在某些情况下，我希望 Enter 键的功能与 AcceptButton 的功能不同。

我希望在我的基本表单中捕获输入键并检查我不希望AcceptButton 事件触发的特殊情况。

不过，AcceptButton 点击​​似乎是在我的 basef 表单中的任何关键事件之前触发的。我可以将功能写入可能的接受按钮的点击事件中，但在我看来，这将是一个 hack。

有什么建议么？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-06T19:56:27.210

处理此问题的另一种方法是覆盖表单的 ProcessDialogKey() 方法，您可以在该方法中取消接受和/或取消按钮。例如，我有一个带有过滤器编辑器的应用程序，它根据用户输入过滤网格。当过滤器编辑器控件具有应用过滤器的焦点时，我希望用户能够点击返回键。问题是接受按钮代码运行并关闭表单。下面的代码解决了这个问题。

```
 protected override bool ProcessDialogKey(Keys keyData)
    {
        // Suppress the accept button when the filter editor has the focus.
        // This doesn't work in the KeyDown or KeyPress events.
        if (((keyData & Keys.Return) == Keys.Return) && (filterEditor.ContainsFocus))
            return false;

        return base.ProcessDialogKey(keyData);
    } 
```

您可以通过将以下代码放入基本对话框表单中来进一步实现这一点。然后，您可以根据需要取消子类中控件的接受按钮。

```
 private readonly List<Control> _disableAcceptButtonList = new List<Control>();

    protected override bool ProcessDialogKey(Keys keyData)
    {
        if (((keyData & Keys.Return) == Keys.Return) && (_disableAcceptButtonList.Count > 0))
        {
            foreach (Control control in _disableAcceptButtonList)
                if (control.ContainsFocus)
                    return false;
        }

        return base.ProcessDialogKey(keyData);
    }

    protected virtual void DisableAcceptButtonForControl(Control control)
    {
        if (!_disableAcceptButtonList.Contains(control))
            _disableAcceptButtonList.Add(control);
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T13:24:58.887

作为我们的解决方法，我们捕获了我们想要覆盖接受按钮功能的控件的进入和离开事件。在 enter 事件中，我们将当前的接受按钮保存在一个私有变量中，并将接受按钮设置为 null。休假时，我们会将接受按钮重新分配给我们持有的私有变量。

KeyPreview 事件可能已经完成了与上述类似的事情。如果有人有更优雅的解决方案，我仍然很想知道。

谢谢。

# wpf - 在VB中过滤一个wpf collectionviewsource？

> ID：744338
> 
> 赞同：3
> 
> 时间：2009-04-13T15:55:23.057
> 
> 标签：wpf, vb.net, filtering, collections

我想使用我编写的过滤器过滤collectionviewsource，但我不确定如何将过滤器应用于它？

这是我的收藏视图源：

```
 <Grid.Resources>
        <CollectionViewSource x:Key="myCollectionView" 
           Source="{Binding Path=Query4, Source={x:Static Application.Current}}">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="ContactID" 
                                     Direction="Descending"/>
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
    </Grid.Resources> 
```

我已经实现了一个过滤器：

```
 Private Sub WorkerFilter(ByVal sender As Object, ByVal e As FilterEventArgs)

    Dim value As Object = CType(e.Item, System.Data.DataRow)("StaffSection")

    If (Not value Is Nothing) And (Not value Is DBNull.Value) Then
        If (value = "Builder") Or (value = "Office Staff") Then
            e.Accepted = True

        Else

            e.Accepted = False
        End If
    End If
End Sub 
```

那么如何在加载时获得由过滤器过滤的 CollectionViewSource 呢？您能否提供我需要的所有 hte 代码（我认为只有几行），因为我对编码很陌生。

多谢你们

编辑：为了记录，

```
 <CollectionViewSource x:Key="myCollectionView" Filter="WorkerFilter" ... /> 
```

给我错误：

> 对象初始化失败 (ISupportInitialize.EndInit)。'System.Windows.Data.BindingListCollectionView' 视图不支持过滤。对象“myCollectionView”出错

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-06T01:07:02.953

我对 WPF Coding awswell 比较陌生。这是我建议您尝试的方法：

做一个过滤函数如下：

```
Public Function FilterList(item As Object) As Boolean
        Dim value as Object = item
        If (Not value Is Nothing) And (Not value Is DBNull.Value) Then
        If (value = "Builder") Or (value = "Office Staff") Then
            Return True

        Else

            Return False
        End If
    End If
End Function 
```

从 Window_Loaded 事件中调用函数：

```
Private Sub MainWindow_Loaded(sender As Object, e As RoutedEventArgs) Handles MainWindow.Loaded
    MyCollectionView = CollectionViewSource.GetDefaultView(Query4) 'May not be needed, IDK
    MyCollectionView.Filter = New Predicate(Of Object)(AddressOf FilterList)
End Sub 
```

如果这不起作用，请告诉我（可能需要一些调整：D）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-10T15:55:48.800

我有同样的问题，直到我决定做以下事情并且效果很好，我不知道有什么缺点：

```
<Window 
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:data="clr-namespace:System.Windows.Data;assembly=PresentationFramework">

    <CollectionViewSource
    x:Key="FilteredBindingListCollection"
    CollectionViewType="{x:Type data:ListCollectionView}" />

</Window> 
```

希望这会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T16:08:18.157

您只需要在 XAML 中附加事件：

```
<CollectionViewSource x:Key="myCollectionView" Filter="WorkerFilter" ...> 
```

# .net - 如何在级联下拉列表中显示选定的值？

> ID：744347
> 
> 赞同：2
> 
> 时间：2009-04-13T16:00:04.870
> 
> 标签：.net, asp.net, asp.net-mvc

我想为编辑视图中的选定值扩展以下代码。以国家 -> 州 -> 城市为例。

我有脚本 CascadingDropDownList.js：

```
function bindDropDownList(e, targetDropDownList) 
{
    var key = this.value;
    var allOptions = targetDropDownList.allOptions;
    var option;
    var newOption;
    targetDropDownList.options.length = 0;

    for (var i=0; i < allOptions.length; i++) 
    {
        option = allOptions[i];
        if (option.key == key) 
        {
            newOption = new Option(option.text, option.value);
            targetDropDownList.options.add(newOption);
        }
    }
} 
```

我有一个助手类：

```
public static class JavaScriptExtensions
{
    public static string CascadingDropDownList(this HtmlHelper helper, string name, string associatedDropDownList)
    {
        var sb = new StringBuilder();

        // render select tag
        sb.AppendFormat("<select name='{0}' id='{0}'></select>", name);
        sb.AppendLine();

        // render data array
        sb.AppendLine("<script type='text/javascript'>");
        var data = (CascadingSelectList)helper.ViewDataContainer.ViewData[name];
        var listItems = data.GetListItems();
        var colArray = new List<string>();
        foreach (var item in listItems)
            colArray.Add(String.Format("{{key:'{0}',value:'{1}',text:'{2}'}}", item.Key, item.Value, item.Text));
        var jsArray = String.Join(",", colArray.ToArray());
        sb.AppendFormat("$get('{0}').allOptions=[{1}];", name, jsArray);
        sb.AppendLine();
        sb.AppendFormat("$addHandler($get('{0}'), 'change', Function.createCallback(bindDropDownList, $get('{1}')));", associatedDropDownList, name);
        sb.AppendLine();
        sb.AppendLine("</script>");

        return sb.ToString();

    }
}

public class CascadingSelectList
{
    private IEnumerable _items;
    private string _dataKeyField;
    private string _dataValueField;
    private string _dataTextField;

    public CascadingSelectList(IEnumerable items, string dataKeyField, string dataValueField, string dataTextField)
    {
        _items = items;
        _dataKeyField = dataKeyField;
        _dataValueField = dataValueField;
        _dataTextField = dataTextField;
    }

    public List<CascadingListItem> GetListItems()
    {
        var listItems = new List<CascadingListItem>();
        foreach (var item in _items)
        {
            var key = DataBinder.GetPropertyValue(item, _dataKeyField).ToString();
            var value = DataBinder.GetPropertyValue(item, _dataValueField).ToString();
            var text = DataBinder.GetPropertyValue(item, _dataTextField).ToString();
            listItems.Add(new CascadingListItem(key, value, text));
        }
        return listItems;
    }
}
public class CascadingListItem
{
    public CascadingListItem(string key, string value, string text)
    {
        this.Key = key;
        this.Value = value;
        this.Text = text;
    }

    public string Key { get; set; }
    public string Value { get; set; }
    public string Text { get; set; }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T14:29:03.247

我已经实现了。选择的值在隐藏归档中。

并确保您的控制器方法返回带有两个字段的 json 对象。

```
<script type="text/javascript">

var ddlCountry;
var ddlStateID;

function pageLoad() {
    ddlStateID = $get("StateID");
    ddlCountry = $get("CountryID");
    $addHandler(ddlCountry, "change", bindOptions);
    bindOptions();
}
function bindOptions() {
    ddlStateID.options.length = 0;
    var CountryID = ddlCountry.value;
    var stateSelected = document.getElementById('StateSelected').value;
    if (CountryID) {
        var url = "/Student/States/" + CountryID;
        $.getJSON(url, null, function(data) {
            $("#StateID").empty();
            $.each(data, function(index, optionData) {
                if (stateSelected == optionData.ID) {
                    $("#StateID").append("<option value='"
                    + optionData.ID
                    + "' selected>" + optionData.Name
                    + "</option>");
                }
                else {
                    $("#StateID").append("<option value='"
                    + optionData.ID
                    + "'>" + optionData.Name
                    + "</option>");
                };
            });
        });
    };
} 
```

**添加** 控制器（我的网址是学生/州，即在学生控制器中我输入以下代码）

```
public ActionResult States(int id)
    {
        var states = db.states.Select(s => new { ID = s.ID, Name = s.Name }).OrderBy(s=>s.Name).ToList();
        return Json(states);
    } 
```

您可以返回任意数量的字段，但如果其中任何一个具有空值，则它不会转换为 json 对象。我不确定这一点，但是当我返回整个状态对象时它不起作用。当时状态表有一个名为deletedby的字段，它包含空值！。但是当我只返回两个“需要”的字段时，它就可以正常工作了！

# sql-server-2005 - 我可以使用 SQL Server 分区来优化全文搜索吗？

> ID：744351
> 
> 赞同：0
> 
> 时间：2009-04-13T16:00:35.010
> 
> 标签：sql-server-2005, optimization, full-text-search, partitioning

我有一个带有全文索引列的非常大的表。如果我明智地分区这个表（对我来说，明智地是按日期），它会加快查询速度吗？或者，即使查询限制为单个分区，全文子句仍会搜索整个表吗？

从我目前所见，我认为答案是分区无济于事。所以最好的选择是有价值的答案。例如，为每个日期范围创建表格并通过执行 [???] 轻松维护它们。

编辑：目前非常大是 450 万行，但会随着时间的推移而激增（明天可能是 2000 万行，所以我想为此做好计划）。在硬件方面，我很无知。我知道当全文查询返回大量行时查询很慢，即使整个查询没有。不确定这是否意味着它是计算限制或 IO 限制，或者是否有足够的信息来判断。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T18:54:01.580

我不认为它会。

全文索引驻留在单个全文目录中。

这与基于日期范围将数据分区到数据文件组上非常不同，使用视图和约束将查询定向到正确的分区。

我的想法是确保您的全文目录和索引位于它们自己的 LUN/磁盘集上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-14T12:49:06.567

GBN 是对的——它无济于事。

通常我的建议是避免更改架构来解决硬件问题。遵循 FTS 设置的最佳实践，您可以很好地扩展。如果您能阐明“非常大的桌子”是什么意思以及它是什么类型的硬件，我们可能会帮助您提供更好的答案。例如，它是在慢速 RAID 5 中具有 6 个驱动器的 2-cpu 16gb 内存盒上的 100 万行表，还是在 RAID 中具有 100 个驱动器 SAN 的 4-cpu 64gb 盒上的 1000 万行表10？

# multithreading - 多线程与否

> ID：744352
> 
> 赞同：1
> 
> 时间：2009-04-13T16:01:02.683
> 
> 标签：multithreading, performance

我正在创建一个 Windows 控制台应用程序，它将逐行读取文本文件并从固定长度数据的字符串中提取数据。该应用程序目前编写为 Windows 应用程序，但稍后将转换为 Windows 控制台应用程序。我注意到应用程序从读取文本、插入数据库和导出数据库需要一段时间才能运行。

如果我使用多个线程，它会帮助加快进程吗？我正在考虑一个线程读取数据，另一个线程将数据插入数据库。

有什么建议吗？

编辑：应用程序将在 VB.net 中完成

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T16:26:10.033

我假设这是一个 SQL 数据库。

您的问题很可能是您一次只做一件事情。SQL 讨厌这样。SQL 和 SQL 数据库对项目**集**进行操作。

因此，打开一个事务，读取并插入 1,000 个项目。保存这些项目以防事务提交由于某种原因失败，以便您可以重试。

我已经设法使用这种技术将一些听起来与您的描述相似的 Perl 脚本加速了 20 倍以上。

我不知道您正在使用的 Microsoft 库，但这里有一个使用 DBI 的 Perl 示例。使其工作的部分是 AutoCommit => 0 和 $dbh->commit。

```
#!/usr/bin/perl

use strict;
use DBI;

my $dbname = 'urls';
my $user = 'postgres';
my $pass = '';

my $dbh = DBI->connect(
    "DBI:Pg:dbname=$dbname",
    $user,
    $pass,
    { 'RaiseError' => 1, AutoCommit => 0 }
);

my $insert = $dbh->prepare('
    INSERT INTO todo (domain, path)
    VALUES (?, ?)
');

my $count = 0;
while(<>) {
    if( $count++ % 1000 == 0) {
        $dbh->commit;
    }
    chomp;
    my ($one, $two) = split;
    $insert->execute($one, $two);
}
$dbh->commit;
$dbh->disconnect; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T16:04:00.477

笼统地说是不可能的——找出答案的唯一方法是构建应用程序并测试性能。瓶颈很可能是数据库插入，但多线程是否会加快速度取决于许多因素：

*   您的应用程序和数据库服务器是否在同一台机器上运行？
*   他们使用同一个磁盘吗？
*   一个插入会引起与另一个的争用吗？

你明白了。话虽如此，我已经在金融行业编写了服务器，其中多线程数据库访问确实产生了巨大的影响。但这些都是在与具有备用数据库 I/O 的巨大 Sun 企业服务器通信，因此用来自多线程应用程序的请求充斥它是有道理的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T16:04:48.650

使用多个线程，您可能会得到一些重叠 - 一个线程正在从磁盘读取，而另一个线程正在执行数据库插入。我猜您可能不会看到太大的改进 - 除非您正在读取非常大的文件，否则您的大部分时间可能都花在插入数据库中，而磁盘 I/O 中的时间只是噪音。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T16:29:05.673

将数据提交到数据库是一项耗时的操作。尝试分批收集项目（比如 1000 个）并将这些批次提交到数据库，而不是逐个提交项目。这应该会提高你的表现。对于这种类型的应用程序来说，多线程是多余的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T16:05:01.707

您可能不会从中获得太多收益，因为您在这里概述的任务本质上是连续的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T16:07:04.603

在构建应用程序之前，您不会知道多线程是否会有所帮助，但您似乎真的只是想要更好的性能。在做任何事情之前，您需要测量应用程序的性能。也许有些代码效率低下，所以使用分析器来识别瓶颈。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-13T16:08:03.120

多个线程并不总能提高性能。如果活动真的可以并行执行，那么只有基本的多线程工作。如果在读取数据时进行了大量的 IO 操作，那么值得一试。最好的方法是原型和验证。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-04-13T16:06:48.503

你用什么来构建windows应用程序？如果您使用的是 .Net，请使用线程池。Jeff Richter 开发了一个名为 Power threading 的不错的库。[下载](http://www.wintellect.com/PowerThreading.aspx)

此外，了解线程在 Windows 操作系统中的工作方式。添加多个线程有时可能无济于事，我通常不鼓励这样做。

# ruby-on-rails - Rails 过时了？站点地图的方法总是返回 HTTP 200

> ID：744353
> 
> 赞同：5
> 
> 时间：2009-04-13T16:01:04.587
> 
> 标签：ruby-on-rails, ruby, etag

我的 Ruby on Rails 应用程序使用以下控制器代码生成 sitemap.xml 文件：

```
class SitemapController < ApplicationController
  layout nil

  def index
    headers['Content-Type'] = 'application/xml'
    last_post = Post.last
    if stale?(:etag => last_post, :last_modified => last_post.updated_at.utc)
      respond_to do |format|
        format.xml { @posts = Post.sitemap } # sitemap is a named scope
      end
    end
  end
end 
```

我的理解是，`stale?`如果内容没有更改，该方法应确保 HTTP 304 Not Modified 响应。但是，每当我使用 curl 或 Web 浏览器进行测试时，我总是得到 HTTP 200：

```
$ curl --head localhost:3000/sitemap.xml
HTTP/1.1 200 正常
连接：关闭
日期：2009 年 4 月 13 日星期一 15:50:00 GMT
最后修改时间：格林威治标准时间 2009 年 4 月 8 日星期三 16:52:07
X-运行时：100
ETag：“5ff2ed60dddcdecf291e7191e1ad540f6”
缓存控制：私有，max-age=0，必须重新验证
内容类型：应用程序/xml；字符集=utf-8
内容长度：29318

```

我`stale?`是否正确使用该方法？甚至可以在本地进行测试吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-14T14:24:15.997

您的 Rails 代码可能很好，但 curl 在您执行测试时没有发送 If-Modified-Since 标头。来自[curl 文档](http://www.cs.sunysb.edu/documentation/curl/index.html)：

> 时间条件
> 
> HTTP 允许客户端为其请求的文档指定时间条件。它是 If-Modified-Since 或 If-Unmodified-Since。Curl 允许您使用 -z/--time-cond 标志指定它们。
> 
> 例如，您可以轻松地进行仅在远程文件比本地副本更新时才执行的下载。它会像这样：
> 
> curl -z local.html [http://remote.server.com/remote.html](http://remote.server.com/remote.html)
> 
> 或者，仅当本地文件比远程文件新时，您才可以下载文件。通过在日期字符串前面加上“-”来做到这一点，如下所示：
> 
> curl -z -local.html [http://remote.server.com/remote.html](http://remote.server.com/remote.html)
> 
> 您可以指定“自由文本”日期作为条件。告诉 curl 只下载从昨天开始更新的文件：
> 
> curl -z 昨天 [http://remote.server.com/remote.html](http://remote.server.com/remote.html)
> 
> 然后，Curl 将接受各种日期格式。您总是通过在日期前面加上破折号'-'来反过来检查日期。

# sql-server-2005 - 将表中的数据转换为不同的视图

> ID：744366
> 
> 赞同：0
> 
> 时间：2009-04-13T16:05:29.583
> 
> 标签：sql-server-2005, tsql

我有下表的数据：

```
tag    dt          value
1      2009/03/01  10.2
2      2009/03/01  12
3      2009/03/01  120
....
1      2009/03/02  13.2
2      2009/03/02  9
3      2009/03/02  23
.... 
```

基本上，对于一组标签，沿日期（3 月 1 日、2 日，...）都有值。我想在不同的视图中有这样的数据：

```
dt             tag(1)   tag(2)   tag(3)
2009/03/01     10.2     12       120
2009/03/02     13.2     9        23
.... 
```

我尝试使用以下 SQL 仅获取 tag(1)' 值

```
SELECT dt, SUM(value) [tag(1)] FROM myTable
GROUP BY dt, tagid
HAVING tagid = 1 
```

如何使用 TSQL 按日期在一列中获取所有 tag(1)、tag(2) 和 tag(3) 的值？

顺便说一句，我有 Microsoft SQL Server 2005。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T16:09:03.380

```
SELECT dt, 
SUM(case when tag=1 then value else 0 end) as tag1,
SUM(case when tag=2 then value else 0 end) as tag2,
SUM(case when tag=3 then value else 0 end) as tag3
FROM myTable
GROUP BY dt 
```

# python - Python 中的循环（或循环）导入

> ID：744373
> 
> 赞同：479
> 
> 时间：2009-04-13T16:07:07.457
> 
> 标签：python, circular-dependency, cyclic-reference

如果两个模块相互导入会发生什么？

为了概括这个问题，Python 中的循环导入怎么样？

* * *

## 回答 #1

> 赞同：402
> 
> 时间：2009-04-14T02:03:43.453

如果你这样做`import foo`(inside `bar.py`) 和`import bar`(inside `foo.py`)，它会正常工作。当任何东西实际运行时，两个模块都将完全加载并相互引用。

问题是当你做`from foo import abc`(inside `bar.py`) 和`from bar import xyz`(inside `foo.py`) 时。因为现在每个模块都需要另一个模块已经被导入（这样我们正在导入的名称就存在）才能被导入。

* * *

## 回答 #2

> 赞同：338
> 
> 时间：2009-04-13T16:15:00.700

去年在[comp.lang.python](http://groups.google.com/group/comp.lang.python/browse_thread/thread/1d80a1c6db2b867c)上对此进行了非常好的讨论。它非常彻底地回答了你的问题。

> 进口真的很简单。请记住以下几点：
> 
> 'import' 和 'from xxx import yyy' 是可执行语句。它们在运行的程序到达该行时执行。
> 
> 如果模块不在 sys.modules 中，则导入会在 sys.modules 中创建新的模块条目，然后执行模块中的代码。在执行完成之前，它不会将控制权返回给调用模块。
> 
> 如果 sys.modules 中确实存在一个模块，那么无论它是否已完成执行，导入都会简单地返回该模块。这就是为什么循环导入可能会返回看起来部分为空的模块的原因。
> 
> 最后，执行脚本运行在名为 __main__ 的模块中，以自己的名称导入脚本将创建一个与 __main__ 无关的新模块。
> 
> 把这些放在一起，你在导入模块时应该不会有任何意外。

* * *

## 回答 #3

> 赞同：117
> 
> 时间：2009-04-13T16:16:23.973

循环导入终止，但您需要注意不要在模块初始化期间使用循环导入的模块。

考虑以下文件：

一个.py：

```
print "a in"
import sys
print "b imported: %s" % ("b" in sys.modules, )
import b
print "a out" 
```

b.py：

```
print "b in"
import a
print "b out"
x = 3 
```

如果你执行 a.py，你会得到以下信息：

```
$ python a.py
a in
b imported: False
b in
a in
b imported: True
a out
b out
a out 
```

在 b.py 的第二次导入（在 second 中`a in`），Python 解释器不会`b`再次导入，因为它已经存在于模块 dict 中。

如果您在模块初始化期间尝试访问`b.x`，您将获得一个.`a``AttributeError`

将以下行附加到`a.py`：

```
print b.x 
```

然后，输出是：

```
$ python a.py
a in                    
b imported: False
b in
a in
b imported: True
a out
Traceback (most recent call last):
  File "a.py", line 4, in <module>
    import b
  File "/home/shlomme/tmp/x/b.py", line 2, in <module>
    import a
 File "/home/shlomme/tmp/x/a.py", line 7, in <module>
    print b.x
AttributeError: 'module' object has no attribute 'x' 
```

这是因为模块在导入时执行，并且在`b.x`访问时，该行`x = 3`尚未执行，这只会发生在`b out`.

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2015-11-05T14:51:51.887

正如其他答案所描述的那样，这种模式在 python 中是可以接受的：

```
def dostuff(self):
     from foo import bar
     ... 
```

这将避免在其他模块导入文件时执行导入语句。只有存在逻辑循环依赖时，才会失败。

大多数循环导入实际上不是逻辑循环导入，而是引发`ImportError`错误，因为`import()`调用时评估整个文件的顶级语句的方式。

**如果您确实希望将导入放在首位，这些`ImportErrors`几乎总是可以避免的**：

考虑这个循环导入：

### 应用程序 A

```
# profiles/serializers.py

from images.serializers import SimplifiedImageSerializer

class SimplifiedProfileSerializer(serializers.Serializer):
    name = serializers.CharField()

class ProfileSerializer(SimplifiedProfileSerializer):
    recent_images = SimplifiedImageSerializer(many=True) 
```

### 应用程序 B

```
# images/serializers.py

from profiles.serializers import SimplifiedProfileSerializer

class SimplifiedImageSerializer(serializers.Serializer):
    title = serializers.CharField()

class ImageSerializer(SimplifiedImageSerializer):
    profile = SimplifiedProfileSerializer() 
```

来自 David Beazley 的精彩演讲[模块和包：生与死！- PyCon 2015](https://www.youtube.com/watch?v=0oTh1CXRaQ0) , `1:54:00`, 这是一种在 python 中处理循环导入的方法：

```
try:
    from images.serializers import SimplifiedImageSerializer
except ImportError:
    import sys
    SimplifiedImageSerializer = sys.modules[__package__ + '.SimplifiedImageSerializer'] 
```

这会尝试导入`SimplifiedImageSerializer`，如果`ImportError`被引发，因为它已经被导入，它将从 importcache 中提取它。

*PS：你必须用大卫比兹利的声音阅读整篇文章。*

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2018-07-06T03:16:05.577

**模块 a.py ：**

```
import b
print("This is from module a") 
```

**模块 b.py**

```
import a
print("This is from module b") 
```

运行“模块 a”将输出：

```
>>> 
'This is from module a'
'This is from module b'
'This is from module a'
>>> 
```

它输出这 3 行，而由于循环导入，它应该输出 infinitial。此处列出了运行“Module a”时逐行发生的情况：

1.  第一行是`import b`. 所以它会访问模块 b
2.  模块 b 的第一行是`import a`. 所以它会访问模块a
3.  模块 a 的第一行是`import b`但***请注意，此行将不再执行***，因为 python 中的每个文件只执行一次导入行，无论何时何地执行它都无关紧要。所以它将传递到下一行并打印`"This is from module a"`。
4.  从模块 b 访问完整个模块 a 后，我们仍然在模块 b。所以下一行将打印`"This is from module b"`
5.  模块 b 行完全执行。所以我们将回到我们开始模块b的模块a。
6.  import b 行已经执行，不会再执行。下一行将打印`"This is from module a"`，程序将完成。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2009-04-14T07:30:51.730

我在这里有一个让我印象深刻的例子！

**foo.py**

```
import bar

class gX(object):
    g = 10 
```

**酒吧.py**

```
from foo import gX

o = gX() 
```

**主文件**

```
import foo
import bar

print "all done" 
```

**在命令行：** $ python main.py

```
Traceback (most recent call last):
  File "m.py", line 1, in <module>
    import foo
  File "/home/xolve/foo.py", line 1, in <module>
    import bar
  File "/home/xolve/bar.py", line 1, in <module>
    from foo import gX
ImportError: cannot import name gX 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2021-05-24T14:23:36.113

令我惊讶的是，还没有人提到由类型提示引起的循环导入。
如果您*仅*因类型提示而进行循环导入，则可以以干净的方式避免它们。

考虑`main.py`哪个利用了另一个文件中的异常：

```
from src.exceptions import SpecificException

class Foo:
    def __init__(self, attrib: int):
        self.attrib = attrib

raise SpecificException(Foo(5)) 
```

和专用的异常类`exceptions.py`：

```
from src.main import Foo

class SpecificException(Exception):
    def __init__(self, cause: Foo):
        self.cause = cause

    def __str__(self):
        return f'Expected 3 but got {self.cause.attrib}.' 
```

这将通过and轻松提高`ImportError`as`main.py`进口`exception.py`，反之亦然。`Foo``SpecificException`

因为`Foo`仅在类型检查期间才需要，所以我们可以使用[类型](https://docs.python.org/3/library/typing.html#typing.TYPE_CHECKING)模块中的常量`exceptions.py`安全地使其有条件导入。该常量仅在类型检查期间使用，这允许我们有条件地导入，从而避免循环导入错误。 在 Python 3.6 中，使用前向引用：`TYPE_CHECKING``True``Foo`

```
from typing import TYPE_CHECKING
if TYPE_CHECKING:  # Only imports the below statements during type checking
   ​from src.main import Foo

class SpecificException(Exception):
   ​def __init__(self, cause: 'Foo'):  # The quotes make Foo a forward reference
       ​self.cause = cause

   ​def __str__(self):
       ​return f'Expected 3 but got {self.cause.attrib}.' 
```

在 Python 3.7+ 中，延迟评估注释（在[PEP 563](https://www.python.org/dev/peps/pep-0563/)中引入）允许使用“普通”类型而不是前向引用：

```
from __future__ import annotations
from typing import TYPE_CHECKING
if TYPE_CHECKING:  # Only imports the below statements during type checking
   ​from src.main import Foo

class SpecificException(Exception):
   ​def __init__(self, cause: Foo):  # Foo can be used in type hints without issue
       ​self.cause = cause

   ​def __str__(self):
       ​return f'Expected 3 but got {self.cause.attrib}.' 
```

在 Python 3.11+ 中，`from __future__ import annotations`默认情况下是活动的，因此可以省略。

该答案基于Stefaan Lippens[的另一种解决方案，可将您从 Python 中的圆形导入孔中挖掘出来。](https://www.stefaanlippens.net/circular-imports-type-hints-python.html)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2019-09-05T19:44:19.327

这里有很多很棒的答案。虽然问题通常有快速的解决方案，其中一些感觉比其他的更 Pythonic，如果你有做一些重构的奢侈，另一种方法是分析你的代码的组织，并尝试删除循环依赖。例如，您可能会发现：

**文件 a.py**

```
from b import B

class A:
    @staticmethod
    def save_result(result):
        print('save the result')

    @staticmethod
    def do_something_a_ish(param):
        A.save_result(A.use_param_like_a_would(param))

    @staticmethod
    def do_something_related_to_b(param):
        B.do_something_b_ish(param) 
```

**文件 b.py**

```
from a import A

class B:
    @staticmethod
    def do_something_b_ish(param):
        A.save_result(B.use_param_like_b_would(param)) 
```

在这种情况下，只需将一个静态方法移动到一个单独的文件中，例如`c.py`：

**文件 c.py**

```
def save_result(result):
    print('save the result') 
```

将允许`save_result`从 A 中删除该方法，从而允许从 b 中的 a 中删除 A 的导入：

**重构文件 a.py**

```
from b import B
from c import save_result

class A:
    @staticmethod
    def do_something_a_ish(param):
        A.save_result(A.use_param_like_a_would(param))

    @staticmethod
    def do_something_related_to_b(param):
        B.do_something_b_ish(param) 
```

**重构文件 b.py**

```
from c import save_result

class B:
    @staticmethod
    def do_something_b_ish(param):
        save_result(B.use_param_like_b_would(param)) 
```

总而言之，如果您有一个工具（例如 pylint 或 PyCharm）报告可以是静态的方法，那么仅仅`staticmethod`在它们上扔一个装饰器可能不是消除警告的最佳方法。尽管该方法看起来与类相关，但最好将其分开，特别是如果您有几个密切相关的模块可能需要相同的功能并且您打算练习 DRY 原则。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-03-02T19:11:28.470

我完全同意pythoneer在这里的回答。但是我偶然发现了一些循环导入存在缺陷的代码，并在尝试添加单元测试时引起了问题。因此，要在不更改所有内容的情况下快速修补它，您可以通过动态导入来解决问题。

```
# Hack to import something without circular import issue
def load_module(name):
    """Load module using imp.find_module"""
    names = name.split(".")
    path = None
    for name in names:
        f, path, info = imp.find_module(name, path)
        path = [path]
    return imp.load_module(name, f, path[0], info)
constants = load_module("app.constants") 
```

同样，这不是永久修复，但可以帮助想要修复导入错误而不更改太多代码的人。

干杯!

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-06-30T09:57:33.653

循环导入可能会令人困惑，因为导入做了两件事：

1.  它执行导入的模块代码
2.  将导入的模块添加到导入模块的全局符号表中

前者只执行一次，而后者在每个导入语句中执行。循环导入会在导入模块使用导入的部分执行代码时产生情况。因此，它不会看到在 import 语句之后创建的对象。下面的代码示例演示了它。

循环进口并不是不惜一切代价避免的终极邪恶。在一些像 Flask 这样的框架中，它们是非常自然的，并且调整你的代码以消除它们并不会使代码变得更好。

主文件

```
print 'import b'
import b
print 'a in globals() {}'.format('a' in globals())
print 'import a'
import a
print 'a in globals() {}'.format('a' in globals())
if __name__ == '__main__':
    print 'imports done'
    print 'b has y {}, a is b.a {}'.format(hasattr(b, 'y'), a is b.a) 
```

b.by

```
print "b in, __name__ = {}".format(__name__)
x = 3
print 'b imports a'
import a
y = 5
print "b out" 
```

一个.py

```
print 'a in, __name__ = {}'.format(__name__)
print 'a imports b'
import b
print 'b has x {}'.format(hasattr(b, 'x'))
print 'b has y {}'.format(hasattr(b, 'y'))
print "a out" 
```

带有注释的 python main.py 输出

```
import b
b in, __name__ = b    # b code execution started
b imports a
a in, __name__ = a    # a code execution started
a imports b           # b code execution is already in progress
b has x True
b has y False         # b defines y after a import,
a out
b out
a in globals() False  # import only adds a to main global symbol table 
import a
a in globals() True
imports done
b has y True, a is b.a True # all b objects are available 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-10-09T12:48:24.813

我通过以下方式解决了这个问题，它运行良好，没有任何错误。考虑两个文件`a.py`和`b.py`.

我添加了这个`a.py`并且它起作用了。

```
if __name__ == "__main__":
        main () 
```

### 一个.py：

```
import b
y = 2
def main():
    print ("a out")
    print (b.x)

if __name__ == "__main__":
    main () 
```

### b.py：

```
import a
print ("b out")
x = 3 + a.y 
```

我得到的输出是

```
>>> b out 
>>> a out 
>>> 5 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-11-10T02:21:52.713

假设您正在运行一个名为`request.py` In request.py 的测试 python 文件，您编写

```
import request 
```

所以这也很可能是循环导入。

**解决方案：**

`aaa.py`只需将您的测试文件更改为其他名称，例如`request.py`.

不要使用其他库已经使用的名称。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-02-06T01:07:27.257

好的，我想我有一个很酷的解决方案。假设您有 file`a`和 file `b`。您有要在 module 中使用的一个`def`或一个`class`in 文件，但是您还有其他东西，一个,或 file 中的变量，您需要在您的定义或文件中的类。您可以做的是，在 file 的底部，在调用 file所需的 file 中的函数或类之后，但在从 file 调用 file 所需的函数或类之前，说 Then ，这是**关键部分**, 在文件中需要或来自文件的所有定义或类中`b``a``def``class``a``b``a``a``b``b``a``import b`**`b``def``class``a`（我们称之为`CLASS`），你说`from a import CLASS`**

 **这是有效的，因为您可以`b`在 Python 不执行 file 中的任何导入语句的情况下导入文件`b`，因此您可以避开任何循环导入。

例如：

### 文件一：

```
class A(object):

     def __init__(self, name):

         self.name = name

CLASS = A("me")

import b

go = B(6)

go.dostuff 
```

### 文件 b：

```
class B(object):

     def __init__(self, number):

         self.number = number

     def dostuff(self):

         from a import CLASS

         print "Hello " + CLASS.name + ", " + str(number) + " is an interesting number." 
```

瞧。

# objective-c - 在 Objective-C 中设置属性值的推荐编码风格

> ID：744374
> 
> 赞同：0
> 
> 时间：2009-04-13T16:07:09.220
> 
> 标签：objective-c, coding-style

假设我有这个界面：

```
// .h
@interface DataObject : NSObject {
    NSString* value;
}

@property (retain) NSString* value;

@end

// .m

@implementation DataObject

@synthetize value

@end 
```

据我了解，以下两个片段是相同的：

```
DataObject *o = [[[DataObject alloc] init] autorelease];
[o setValue: @"Hello"];

DataObject *o = [[[DataObject alloc] init] autorelease];
o.value = @"Hello"; 
```

我对么？如果是，我应该更喜欢一种而不是另一种吗？或者它只是一种风格偏好？

谢谢你。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T16:15:18.733

这是风格问题。

点语法在整个 Objective C 中的许多地方都有效，尽管它只被认为对于 getter 和 setter 是“可接受的”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T16:12:41.907

我认为点符号比调用 set 方法更可取。我认为代码更具可读性，并且点表示法更清楚地表明您正在设置一个属性，而不是仅仅在类上调用一个方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T16:38:33.233

点符号只是语法糖，所以两者是相同的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-13T10:59:06.040

2009 年 8 月，博客圈中出现了关于使用点语法的争论。

*   **骗局：[http :](http://weblog.bignerdranch.com/?p=83) **//weblog.bignerdranch.com/** ?p= 83（Joe Conway，为 Big Nerd Ranch 工作）**
***   **亲**：[http](http://eschatologist.net/blog/?p=226) ://eschatologist.net/blog/?p=226 （为 Apple 工作的 Chris Hanson）**

 **# windows - 如何以编程方式检测系统热键？

> ID：744375
> 
> 赞同：3
> 
> 时间：2009-04-13T16:07:41.607
> 
> 标签：windows, hotkeys

我正在寻找一种以编程方式检测系统中热键的方法。我的应用程序支持可配置的热键来执行不同的操作，并且我希望能够判断另一个应用程序是否已经捕获了一个或者它是内置的 Windows 热键（例如用于锁定工作站的 Win-L）。

如果它是拥有热键的另一个应用程序，我希望能够向用户展示它。至少是exe的名称。

我知道使用热键的三种方法：

*   使用标准 API 的系统挂钩
*   使用属性对话框中的热键功能获取快捷方式
*   轮询异步键状态并响应

我怀疑我可以检测到第三种类型，但是其他两种呢？还有其他我需要了解的情况吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T16:22:34.613

我可以想到三种使用标准 API 的方法：

*   注册热键

*   SetWindowsHookEx(WH_KEYBOARD)

*   SetWindowsHookEx(WH_LL_KEYBOARD)

使用第一种方法，您将获得返回值是否另一个应用程序已经注册了相同的热键（或者快捷方式是否使用此热键，或者 Explorer.exe 注册了热键，因为它是 Win+E 或 win+R）。但是，您不会以这种方式获得应用程序名称。

对“热键”使用 Windows Hooks 或异步键状态：我认为不可能在那里检测到热键，因为您可能会在上下文中使用热键（例如，如果最后四个击键是“，则将“t”替换为“irst”）弗里斯") 那样。您可以使用 keybd_event 注入热键（以您的窗口为焦点）并测试事件是否“通过”；另一方面，通过钩子实现的某些“热键”情况不会消耗击键，因此它仍然会通过。

我将使用的方法：首先确保要输入快捷方式，您必须在快捷方式框中键入确切的快捷方式（如果失败，用户将看到哪个应用程序使用它）。然后使用RegisterHotkey，这样你会注意到（在以后的会话中）如果另一个“表现良好”的应用程序试图从你那里窃取这个快捷方式。

# .net - 在多个项目中重用 asmx webservices

> ID：744386
> 
> 赞同：2
> 
> 时间：2009-04-13T16:09:53.397
> 
> 标签：.net, web-services

我们的系统中有多个项目想要共享同一个 asmx webservice。有没有人对如何做到这一点有任何建议/最佳实践。

问题是网络服务在不断变化，所以我不能只在生产中添加网络引用。这也很危险，因为在进行开发时我希望它指向我的本地机器。我应该将我的网络引用添加到本地主机吗？

我还应该有专门的 web 服务项目，而不是分散在多个项目中的 asmx 文件吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T16:14:46.910

Web 服务的要点之一是它们是可重用的，因此您可以在任何可能的地方使用它。

您的问题有点不清楚到底是什么问题，但是您应该能够从任何具有网络访问权限的应用程序中使用您的 Web 服务。

-编辑-

拥有专门的 Web 服务项目通常被认为是最佳实践。您可以拥有多个 Web 服务项目，如何分解这些项目取决于您和您的业务/技术要求。

这应该解决您的主要问题。您有一个本地 Web 服务项目，以及使用它的本地项目。您可以根据需要将这些项目中的一个或两个部署到生产环境中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T17:37:07.943

如果我正确理解您的问题，您希望拥有一个开发网络服务和一个生产网络服务。生产实例是最后调试/检查的构建。调试实例是您正在处理的当前构建。

我推荐的实现这一点的方法是拥有一个 dev 子域，这样您就可以同时使用 web 服务，例如[http://www.myapp.com/Service.asmx](http://www.myapp.com/Service.asmx)和[http://dev.myapp.com/Service.asmx](http://dev.myapp.com/Service.asmx)。这两个子域将是 IIS 中的不同站点。在您的代码中，您会将 Web 引用绑定到 dev 子域，因为该域将是您用来更新 Web 引用的域（如果更改参数）。然后，您将使用“#if not debug”将 Web 服务对象 url 更改为 www 站点以用于生产（发布）代码。

这样，您将针对调试服务进行构建，直到您对它感到满意为止。此时您可以更新您的软件（如果参数已更改）并将新的 dll 上传到发布站点。

我会将 web 服务保留在一个单独的项目中，以保持部署的程序集简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T16:12:25.400

不确定我是否理解你的问题。如果您在生产环境中发布 Web 服务，您所要做的就是在每个需要它的应用程序中添加对它的 Web 引用。使用 Web 服务的全部前提是您使其可用 - 如果您仅在您的开发环境中使用它，也许您想考虑将它用作您分发或保留在 GAC 中的标准 C# dll？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T16:16:45.673

您所需要的只是创建一个良好的流程所有权，以及跨多个团队或部门使用这些 Web 服务的文档。在 SOA 世界中，您必须创建服务注册表，以便轻松查看可用服务并在需要时重用它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T16:37:35.513

在进行开发时，只需将 Web 引用指向您的本地计算机并在本地运行 Web 服务。我真的不认为有任何问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T18:51:09.450

您应该创建一个类库项目并在那里定义您的网络服务。将该项目引用到您的 Web 应用程序中，然后在 webservice asmx 文件中将其指向 webservice 类。

# c# - 网格控制

> ID：744387
> 
> 赞同：2
> 
> 时间：2009-04-13T16:10:03.957
> 
> 标签：c#, .net, .net-3.5, controls

我的任务是创建一个控件，该控件具有允许拖放图像的热点。这些位置将根据拖动到控件上的内容而改变。将图像放到控件上后，它需要能够移动到新位置（通过拖放或使用箭头键）。

我能想到的最接近此功能的示例是 Microsoft Windows 桌面。当您在它周围拖动一个图标时，您可以将它放在任何地方（捕捉到最近的允许热点）我正在使用 C# 使用 .net 3.5。

我正在寻找开始制作此控件的原型的想法。

什么是最好的继承自 Winform 控件，或者从头开始自定义控件是唯一的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T16:15:24.863

假设第三方解决方案尚不存在，我相当确定您必须实现自己的控制。至于您的逻辑应该如何进行，您需要实现的只是碰撞检测。我无法具体告诉您这将如何在您的应用程序中工作，因为这将取决于几个变量（热点是否固定大小？它们是否以对称网格模式布置等）。如果它们都以对称模式布置，您应该能够使用数学函数将给定的 X、Y 对转换为特定的热点。如果它们具有不同的大小和布局，那么您可能必须搜索您的热点矩形集合（或至少该集合的一个子集）才能找到包含您的点的矩形。

# tomcat - Tomcat：用于与 Tomcat 5.5 JNDI 树建立外部客户端连接的初始化上下文参数是什么？

> ID：744389
> 
> 赞同：3
> 
> 时间：2009-04-13T16:10:26.560
> 
> 标签：tomcat, jndi

目前我将它用于 JBoss，但我还需要一些用于外部 Tomcat 的东西：

```
Properties props = new Properties();
props.put(Context.PROVIDER_URL, "jnp://localhost:1099");
props.put(Context.INITIAL_CONTEXT_FACTORY, "org.jnp.interfaces.NamingContextFactory");
props.put(Context.URL_PKG_PREFIXES, "org.jboss.naming.client");
props.put("j2ee.clientName", "abtest"); 
```

用谷歌搜索我找到了这个，但我无法弄清楚 Tomcat 的端口配置为接受 JNDI 连接......

```
props.put(Context.INITIAL_CONTEXT_FACTORY,
"org.apache.naming.java.javaURLContextFactory");
props.put(Context.PROVIDER_URL, "http://localhost:???"); 
```

请问你能帮帮我吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-14T10:31:25.853

As far as I know, tomcat doe not support remote access to its JNDI tree, so you can access it only from the tomcat process. Because of that, The tomcat sets all the initialization params for the default InitialConext, and you can use it like this:

```
// Obtain our environment naming context
Context initCtx = new InitialContext();
Context envCtx = (Context) initCtx.lookup("java:comp/env");

// Look up our data source
DataSource ds = (DataSource)
  envCtx.lookup("jdbc/EmployeeDB");

// Allocate and use a connection from the pool
Connection conn = ds.getConnection();
... use this connection to access the database ...
conn.close(); 
```

You can also learn more of the JNDI in tomcat in [this link](http://tomcat.apache.org/tomcat-5.5-doc/jndi-resources-howto.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-24T10:04:11.590

我发现这个在 Tomcat 中使用的有用链接：[从 Tomcat 调用的 Jboss 中的 EJB](http://www.theserverside.com/discussions/thread.tss?thread_id=35811)

这似乎很愚蠢，但实际上该主题中的方法已经足够好，可以考虑。主要思想在这里：Tomcat 服务器有自己的 JNDI 系统，因此内部 Web 应用程序必须首先声明他们想要使用的 JNDI，然后使用该声明来查找远程服务器的对象（Jboss 的 EJB）。

希望对你有帮助，

问候，

# c# - 函数的动态返回类型

> ID：744401
> 
> 赞同：23
> 
> 时间：2009-04-13T16:14:03.183
> 
> 标签：c#

如何创建一个基于参数类型具有动态返回类型的函数？

像

```
protected DynamicType Test(DynamicType type)
{

return ; 

} 
```

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-04-13T16:16:24.143

您必须为此使用泛型。例如，

```
protected T Test<T>(T parameter)
{

} 
```

在这个例子中，' `<T>`'告诉编译器它代表一个类型的名字，但是你不知道在创建这个函数的上下文中它是什么。所以你最终会这样称呼它......

```
int foo;

int bar = Test<int>(foo); 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2011-11-04T10:05:41.520

虽然公认的答案很好，但它已经写了两年多了，所以，我应该补充一点，你可以使用：

```
protected dynamic methodname(dynamic input)
{
    return input;
} 
```

输入将作为相同类型返回，您不需要将方法作为泛型调用。

**参考：**
[https ://msdn.microsoft.com/en-us/library/dd264736.aspx](https://msdn.microsoft.com/en-us/library/dd264736.aspx)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-13T16:20:40.373

实际上，假设你有一组已知的参数和返回类型，它可以通过简单的重载来处理：

```
protected int Test(string p) {   ...  }
protected string Test(DateTime p ) { .... } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T16:15:58.483

然后你需要使用泛型。

```
protected T Test(T type) {

return type;

} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T16:21:04.803

C# 不是动态语言。要在 C# 中解决这个问题，您可以稍后返回一个通用对象和类型转换为您认为该值应该是什么——不推荐。您也可以返回一个接口，这样您就不必真正关心特定的类实例。正如其他人指出的那样，您也可以使用泛型。这实际上取决于您在函数体内需要/想要做什么，因为上述所有方法都有其自身的局限性。

# eclipse - 如何在 Windows XP 上将 Eclipse 的内部浏览器从 IE 更改为 Firefox？

> ID：744404
> 
> 赞同：60
> 
> 时间：2009-04-13T16:15:10.450
> 
> 标签：eclipse

如何在 Windows XP 上将 Eclipse 的内部浏览器从 IE 更改为 Firefox？

更具体地说，我需要更改内部浏览器，而不是通过 Preferences -> General -> Web Browser 添加外部浏览器。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-13T17:19:24.523

在首选项 -> 常规 -> 网络浏览器中，有“使用内部网络浏览器”选项。选择“使用外部网络浏览器”并选中“Firefox”。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-13T18:05:15.210

我不知道这是否会有所帮助，但这里是 SWT 常见问题解答问题[如何使用 Mozilla 作为浏览器的底层渲染器？](http://www.eclipse.org/swt/faq.php#howusemozilla)

编辑：经过进一步研究，听起来这在 Eclipse 3.4 中是不可能的，但[可能会](https://bugs.eclipse.org/bugs/show_bug.cgi?id=173128)在以后的版本中发布。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-03-04T06:10:49.743

您可以在 中找到更改浏览器的选项`Window menu`。

见下图。

![在此处输入图像描述](https://i.stack.imgur.com/DOBqp.jpg)

这张图很容易理解。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-03-08T02:25:51.087

我喜欢 Aptana Browser Preview 窗口。

您可以从他们的更新站点获取它：http: [//download.aptana.org/tools/studio/plugin/update/studio/](http://download.aptana.org/tools/studio/plugin/update/studio/)

安装 Aptana 插件后，打开一个 Aptana 项目，帮助下应该有一个选项来安装 aptana 功能。在其他下你会发现一个 Firefox/XUL 浏览器。安装 XUL 插件可能有更直接的方法，但上述过程有效。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-13T04:50:42.717

窗口-->网络浏览器-->火狐

# sql-server - 不同模式的数据库设计帮助

> ID：744417
> 
> 赞同：1
> 
> 时间：2009-04-13T16:19:32.123
> 
> 标签：sql-server, xml, database-design, sql-server-2000

我为一个计费服务工作，该服务使用一些复杂的基于大型机的计费软件来提供其核心服务。我们设置了用于跟踪事物的各种代码：支付代码、提供商代码、注销代码等......每种类型的代码都有一组完全不同的数据项，这些数据项控制代码的作用和它的行为方式。

我的任务是建立一个新系统来跟踪对这些代码所做的更改。我们想知道谁请求了什么代码，谁/何时审查、批准和实施，以及该代码的确切设置是什么样的。当前进程仅跟踪两种不同类型的代码。该项目将立即添加对第三个的支持，其目标是在以后也可以轻松地将其他代码类型添加到同一进程中。我的设计难题是每种代码类型都有不同的数据集，需要对其进行配置，并且复杂度各不相同。所以我有几个选择：

*   我可以为每种代码类型提供它自己的表并独立构建它们。考虑到我们目前只有三个我关心的代码，这将是最简单的。然而，这个概念已经失败了，否则我一开始就不会构建一个新系统。它的弱点还在于，在表示级别编写通用源代码以显示任何代码类型（即使是尚未实现的那些）的请求数据所涉及的代码也不是微不足道的。

*   构建一个能够存储与每种代码类型关联的数据点的数据库模式：不仅是值，还有它们是什么类型以及它们应该如何显示（来自某种枚举的下拉列表）。我有一个不错的数据库架构，但它只是感觉不对：查询和维护过于复杂，最终需要一个自定义查询来以漂亮的表格形式查看每种代码类型的完整数据。

*   将每个代码请求的数据点存储为 xml。这极大地简化了数据库设计，并有望更容易构建接口：只需为每种代码类型设置一个模式。然后有代码验证对其模式的请求，将模式转换为显示小部件并将实际请求项映射到显示上。该项目缺少的是如何处理对模式的更改。

我的问题是：你会怎么做？我错过了任何大的设计选择吗？这些选择还有其他优点/缺点吗？

我目前的倾向是使用 xml 选项。鉴于模式更新是预期的，但极少发生（可能每 18 个月每种代码类型少于一个），我是否应该构建它以假设模式永远不会更改，但是这样我以后可以轻松地添加对更改模式的支持？在 SQL Server 2000 中会是什么样子（我们正在迁移到 SQL Server 2005，但是要等到该项目应该完成之后才能准备好）？

**[更新]：**
我认为 xml 的一个原因是某些数据会很复杂：嵌套/条件数据、枚举下拉列表等。但我真的不需要查询其中的任何一个。所以我认为在 xml 模式中定义这些数据会更容易。

然而，le dorfier 关于引入一项全新技术的观点非常贴切。我们目前在任何地方都使用很少的 xml。这种情况正在慢慢改变，但目前这看起来有点不合适。

我也不完全确定如何从模式构建输入表单，然后以优雅的方式将与该模式匹配的记录合并到表单中。只存储部分完成的记录是很常见的，所以我不想从记录本身构建表单。不过，这是另一个问题的主题。

基于到目前为止的所有评论，Xml 仍然是领先的候选者。单独的表格可能同样好或更好，但我感觉我的经理会认为与我们目前所做的相比，这并没有足够的不同或通用性。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T18:09:49.627

对于一个复杂、细致的问题，没有简单、通用的解决方案。您不能同时拥有简单的存储和简单的应用程序逻辑。数据库结构必须很复杂，或者您的应用程序在解释数据时必须很复杂。

[我在“产品表，多种产品，每种产品都有很多参数](https://stackoverflow.com/questions/695752/product-table-many-kind-of-product-each-product-have-many-parameters/695860#695860)”中概述了解决这个普遍问题的五个解决方案。

对于您的情况，我倾向于**具体表继承**或**序列化 LOB**（XML 解决方案）。

XML 可能是一个好的解决方案的原因是：

*   您不需要使用 SQL 来挑选单个字段；你总是要显示整个表格。
*   您的 XML 可以注释数据类型、用户界面控制等字段。

当然，您需要添加代码来解析和验证 XML。您应该使用 XML 模式来帮助解决这个问题。在这种情况下，您只是将一种用于执行数据组织 (RDBMS) 的技术替换为另一种（XML 模式）。

您也可以使用 RDF 解决方案而不是 RDBMS。在 RDF 中，元数据是可查询和可扩展的，您可以使用关于实体的“事实”对实体进行建模。例如：

*   付款代码`XYZ`包含属性`TradeCredit`（Net-30、Net-60 等）
*   属性`TradeCredit`是类型`CalendarInterval`
*   类型`CalendarInterval`显示为下拉列表
*   .. 等等

* * *

回复您的评论：是的，我对任何使用 XML 的解决方案都持谨慎态度。套用[Jamie Zawinski 的话](http://en.wikiquote.org/wiki/Jamie_Zawinski)：

> 有些人在遇到问题时会想“我知道，我会使用 XML”。现在他们有两个问题。

另一种解决方案是发明一种小的[领域特定语言](http://en.wikipedia.org/wiki/Domain-specific_language)来描述您的表单。使用它来生成用户界面。然后*仅*使用数据库来存储表单数据实例的值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T16:54:37.000

Why do you say "this concept has already failed or I wouldn't be building a new system in the first place"? Is it because you suspect there must be a scheme for handling them in common?

Else I'd say to continue the existing philosophy, and establish additional tables. At least it would be sharing an existing pattern and maintaining some consistency in that respect.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T16:48:16.267

Do a web search on "generalized specialized relational modeling". You'll find articles on how to set up tables that store the attributes of each kind of code, and the attributes common to all codes.

If you’re interested in object modeling, just search on “generalized specialized object modeling”.

# http - 如何记录进入 IIS 的 HTTP 请求

> ID：744418
> 
> 赞同：6
> 
> 时间：2009-04-13T16:19:38.020
> 
> 标签：http, iis

我在我的开发机器上运行 IIS 5。我有一个运行在其上的 asp.net 3.5 Web 服务，我从同一服务器上运行的不同 Web 应用程序调用该服务。我的服务返回错误 500 内部服务器错误，我正在对其进行故障排除。我的请求是通过`System.Net.HttpWebReques`t 对象发送的，从客户的角度来看它看起来是有效的。

我想从服务器的角度查看原始传入的 HTTP 请求。由于该服务是在环回上调用的，因此我无法使用 Wireshark 来查看它。

IIS 日志向我显示请求标头，但不显示帖子内容。

关于如何在 IIS 中查看完整的原始传入 HTTP 请求有什么建议吗？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T16:41:32.680

您是否尝试过使用[提琴手](http://www.fiddler2.com/Fiddler2/)？只需使用您的机器名称而不是 localhost。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T16:35:56.530

我认为您想添加一个 HTTPModule 进行日志记录。 [这是](http://technet.microsoft.com/en-us/library/bb742398.aspx)一篇关于 ASP.NET 模块和处理程序的非常好的文章：

这样，当您想禁用日志记录时，您只需从 web.config 文件中删除/注释它即可。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T16:36:46.560

最好的办法是在不同的端口上运行每个 Web 应用程序，然后使用[Fiddler](http://www.fiddler2.com/fiddler2/)之类的工具为要监视的端口创建代理。这将监控进出您的特定应用程序的所有流量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-10-31T15:50:05.220

这是我们用来记录 HTTP POST 请求数据的自定义 HTTP 模块的代码。

```
using System;
using System.Web;

namespace MySolution.HttpModules
{
    public class HttpPOSTLogger : IHttpModule
    {

        public void Dispose()
        {
        }

        public void Init(HttpApplication context)
        {
            context.BeginRequest += new EventHandler(context_BeginRequest);
        }

        private void context_BeginRequest(object sender, EventArgs e)
        {
            if (sender != null && sender is HttpApplication)
            {
                var request = (sender as HttpApplication).Request;
                var response = (sender as HttpApplication).Response;

                if (request != null && response != null && request.HttpMethod.ToUpper() == "POST")
                {
                    var body = HttpUtility.UrlDecode(request.Form.ToString());
                    if (!string.IsNullOrWhiteSpace(body))
                        response.AppendToLog(body);
                }
            }
        }

    }
} 
```

不要忘记在您的应用程序的 web.config 中注册它。

使用 IIS 集成模型的 system.WebServer 部分

```
<system.webServer>
    <modules>
      <add name="HttpPOSTLogger" type="MySolution.HttpModules.HttpPOSTLogger, MySolution.HttpModules" />
    </modules>
</system.webServer> 
```

使用 IIS 经典模型的 system.web 部分

```
<system.web>
    <httpModules>
        <add name="HttpPOSTLogger" type="MySolution.HttpModules.HttpPOSTLogger, MySolution.HttpModules"/>
    </httpModules>
</system.web> 
```

IIS 日志 应用模块前：

```
::1, -, 10/31/2017, 10:53:20, W3SVC1, machine-name, ::1, 5, 681, 662, 200, 0, POST, /MySolution/MyService.svc/MyMethod, -, 
```

IIS 日志应用模块后：

```
::1, -, 10/31/2017, 10:53:20, W3SVC1, machine-name, ::1, 5, 681, 662, 200, 0, POST, /MySolution/MyService.svc/MyMethod, {"model":{"Platform":"Mobile","EntityID":"420003"}}, 
```

全文：

[https://www.codeproject.com/Tips/1213108/HttpModule-for-logging-HTTP-POST-data-in-IIS-Log](https://www.codeproject.com/Tips/1213108/HttpModule-for-logging-HTTP-POST-data-in-IIS-Log)

# sharepoint - 场类型初始化程序异常中的 MOSS 2007 站点

> ID：744419
> 
> 赞同：3
> 
> 时间：2009-04-13T16:19:39.363
> 
> 标签：sharepoint, exception, sharepoint-2007, moss

我们有一些针对 MOSS 农场构建的解决方案，其中一个包括计时器作业。这份工作几个月来一直很好。最近管理员将另一台服务器加入场，我们的计时器作业自动开始在这台新机器上运行。一旦发生此切换，我们的计时器作业就开始产生以下错误（在 SP 日志中找到）。

起初我以为是权限问题，但之前工作的机器上的定时器服务和新的机器上的定时器服务在同一个域帐户下运行。仅在其中一个站点/网站上循环站点集合中的站点列表时似乎失败了（下面的代码片段）。我知道这个域帐户可以访问它，因为它可以在同一帐户下的另一个盒子上工作。有没有人知道为什么会发生这个神秘的错误？或者，是否需要在这台新机器上执行任何特殊程序以确保它具有适用于 MOSS 场中所有数据库的正确 ACL？

**代码：**

```
public static void Main(string[] args)
{
    SPSecurity.RunWithElevatedPrivileges(delegate() { setInputParameters(); }); 
}

private static void setInputParameters()
{
    SPFarm farm = SPFarm.Local;
    SPWebService service = farm.Services.GetValue<SPWebService>("");
    foreach (SPWebApplication webApp in service.WebApplications) 
    { 
        foreach (SPSite siteCollection in webApp.Sites) 
        {   
            using(siteCollection)
            {
                siteCollection.CatchAccessDeniedException = false; 

                try 
                {
/* Here is the line that it fails on */
                     foreach (SPWeb web in siteCollection.AllWebs) 
```

**例外：**

```
The Execute method of job definition LMSDataImport (ID 4b37b285-ef8a-407c-8652-391639449790) threw an exception. 
More information is included below.  
The type initializer for 'Microsoft.SharePoint.Administration.SPPersistedObjectCollection`1' threw an exception.

Exception stack trace:    

at Microsoft.SharePoint.Administration.SPPersistedObjectCollection`1.get_BackingList()     
at Microsoft.SharePoint.Administration.SPPersistedObjectCollection`1.GetEnumerator()     
at Microsoft.SharePoint.Administration.SPAlternateUrlCollectionManager.LookupAlternateUrl(Uri canonicalRequestUri)     
at Microsoft.SharePoint.Administration.SPAlternateUrl.LookupCore(Uri uri, SPFarm farm)     
at Microsoft.SharePoint.Administration.SPWebApplication.Lookup(SPFarm farm, Uri requestUri, Boolean fallbackToHttpContext, SPAlternateUrl& alternateUrl, SiteMapInfo& hostHeaderSiteInfo, Boolean& lookupRequiredContext)     
at Microsoft.SharePoint.SPSite..ctor(SPFarm farm, Uri requestUri, Boolean contextSite, SPUserToken userToken)     
at Microsoft.SharePoint.SPSite..ctor(SPFarm farm, Uri requestUri, Boolean contextSite)     
at Microsoft.SharePoint.Administration.SPSiteCollection.get_Item(String strSiteName)     
at Microsoft.SharePoint.Administration.SPSiteCollection.get_Item(Int32 index)     
at Microsoft.SharePoint.Administration.SPSiteCollection.ItemAtIndex(Int32 iIndex)     
at Microsoft.SharePoint.SPBaseCollection.SPEnumerator.System.Collections.IEnumerator.get_Current()     
at LMSDataImporter.setInputParameters()     
at Microsoft.SharePoint.SPSecurity.CodeToRunElevatedWrapper(Object state)     
at Microsoft.SharePoint.SPSecurity.<>c__DisplayClass4.<RunWithElevatedPrivileges>b__2()     
at Microsoft.SharePoint.Utilities.SecurityContext.RunAsProcess(CodeToRunElevated secureCode)     
at Microsoft.SharePoint.SPSecurity.RunWithElevatedPrivileges(WaitCallback secureCode, Object param)     
at Microsoft.SharePoint.SPSecurity.RunWithElevatedPrivileges(CodeToRunElevated secureCode)     
at Axian.AxianCalendar.LMSDataImporter.Main(String[] args)     
at Microsoft.SharePoint.Administration.SPTimerJobInvoke.Invoke(TimerJobExecuteData& data, Int32& result) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T16:53:17.317

Check the DLLs for SharePoint, do all exists and all are the same version? Try putting a catch for the TypeInitializationException, and see what is wrong inside that exception.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-17T22:20:45.307

这不是一个解决方案，但作为临时解决方法，我认为我对您的其他问题之一的建议是：

[如何指示 SharePoint 场在特定服务器上运行计时器作业？](https://stackoverflow.com/questions/714848/how-do-you-instruct-a-sharepoint-farm-to-run-a-timer-job-on-a-specific-server)

将在您进一步调查时让您继续运行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-23T16:23:06.150

检查 NLB（网络负载平衡）配置。大多数情况下，当 NLB 更改其状态时，SharePoint 和与其集成的应用程序会失败。有一个补丁可以解决这个问题。只是一个建议。不确定这是否是原因。但我遇到了类似的问题，根本原因是 NLB 错误

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T16:11:20.937

Type init 异常只是意味着在类的 .ctor 中发生了异常（您可能知道）。真正的异常应该在 InnerException 属性中——你能掌握这个吗？可能它源于数据库，好吧，来自 Microsoft.SharePoint.Administration.SPPersistedChildCollection InitializeFromDatabse 方法。

您能否查看共享点日志（在该错误服务器上）以获取有关数据库错误的信息，它*会*在那里。阅读日志很痛苦，但如果您从[http://www.codeplex.com/features安装 ULS 日志查看器功能，则不会](http://www.codeplex.com/features)

由于堆栈跟踪具有 SPAlternateUrl 进一步修补堆栈，可能您的区域配置错误（并且不包括此新服务器的机器名称的映射） - 授予，它不应该失败这么糟糕，但你能做什么。

您可以按来源过滤 ULS 日志。

-Oisin

# python - Django模型-事后如何通过PK过滤掉重复值？

> ID：744424
> 
> 赞同：6
> 
> 时间：2009-04-13T16:20:47.457
> 
> 标签：python, django, data-structures, set, unique

我通过进行几个查询来构建 Django 模型对象的列表。然后我想删除任何重复项，（所有这些对象的类型都与 auto_increment int PK 相同），但我不能使用 set() 因为它们不可散列。

有没有一种快速简便的方法来做到这一点？我正在考虑使用 dict 而不是以 id 为键的列表。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-14T13:40:00.330

一般来说，如果可能的话，最好将所有查询合并到一个查询中。IE。

```
q = Model.objects.filter(Q(field1=f1)|Q(field2=f2)) 
```

代替

```
q1 = Models.object.filter(field1=f1)
q2 = Models.object.filter(field2=f2) 
```

如果第一个查询返回重复的模型，则使用 distinct()

```
q = Model.objects.filter(Q(field1=f1)|Q(field2=f2)).distinct() 
```

如果您的查询确实无法使用单个命令执行，那么您将不得不求助于使用 dict 或其他答案中推荐的其他技术。如果您在 SO 上发布确切的查询可能会有所帮助，我们可以看看是否可以组合成一个查询。根据我的经验，大多数查询都可以使用单个查询集完成。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-13T16:27:26.083

> 有没有一种快速简便的方法来做到这一点？我正在考虑使用 dict 而不是以 id 为键的列表。

如果您被锁定在当前进行多个查询的结构中，这正是我会做的。然后简单地`dictionary.values()`返回您的列表。

如果你有更多的灵活性，为什么不使用`Q`对象呢？而不是实际进行查询，将每个查询存储在一个`Q`对象中并使用按位或（“|”）来执行单个查询。这将实现您的目标并保存数据库命中。

[Django Q 对象](http://docs.djangoproject.com/en/dev/topics/db/queries/#complex-lookups-with-q-objects)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T16:58:21.313

如果您将`__hash__`函数添加到模型定义中，则可以使用一个集合，以便它返回 id（假设这不会干扰您在应用程序中可能具有的其他哈希行为）：

```
class MyModel(models.Model):

    def __hash__(self):
        return self.pk 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T16:24:46.120

如果顺序无关紧要，请使用字典。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T17:44:12.297

删除“重复”取决于您如何定义“重复”。

如果您希望每列（PK 除外）都匹配，那将是一件令人头疼的事情——需要进行大量比较。

另一方面，如果您有一些“自然键”列（或一组短列），则可以轻松查询和删除这些列。

```
master = MyModel.objects.get( id=theMasterKey )
dups = MyModel.objects.filter( fld1=master.fld1, fld2=master.fld2 )
dups.all().delete() 
```

如果您可以识别一些较短的关键字段集以进行重复识别，则效果很好。

* * *

**编辑**

如果模型对象尚未保存到数据库中，您可以在这些键的元组上创建一个字典。

```
unique = {}
...
key = (anObject.fld1,anObject.fld2)
if key not in unique:
    unique[key]= anObject 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-22T19:08:06.483

我用这个：

```
dict(zip(map(lambda x: x.pk,items),items)).values() 
```

# http - 从外部网页捕获详细信息

> ID：744425
> 
> 赞同：0
> 
> 时间：2009-04-13T16:20:47.487
> 
> 标签：http, web-applications, browser, http-headers

我想知道是否可以从用户以前访问过的网页中捕获详细信息，如果我的页面没有链接到它？

我想要实现的是允许用户在浏览网页时找到他们喜欢的页面，然后通过书签导航到我网站上的页面，这将添加 URL（可能还有其他一些细节，如页面标题）到一个表单，然后他们可以将其提交到我的站点以将该页面添加到那里的收藏夹列表中。

我不确定从哪里开始寻找这个。我想知道我是否可以使用 http 引荐来源网址，但认为这可能只有在有指向我的页面的链接时才有效？

或者，我对如何捕获这些数据的其他建议持开放态度 - Firefox 插件？用户在 iframe 中浏览其他网站的页面，顶部有一个瘦框架？

提前感谢您的建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T16:25:54.107

出于安全和隐私原因，浏览器通常不允许使用此类功能。IFrame 可以工作，但这是一种常见的黑客技术，因此它可能会在未来被破坏或被标记。

firefox插件是最好的解决方案，但需要用户手动安装。

此外，可以使用小书签。当他们活跃在目标页面上时，小书签可以向您发送 URL。

此示例小书签将为目标页面创建一个 tinyURL。您可以将其添加到您的数据库或诸如此类。

```
javascript:void(window.open('http://tinyurl.com/create.php?url='+document.location.href)); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T16:26:41.513

如果一些其他站点链接到您的站点并且用户单击了将他们带到您站点的链接，您可以从 http 标头访问“引荐来源”。获取 HTTP 标头的方式是特定于语言/框架的。在 .NET 中，您将使用 Request.UrlReferrer；其他框架可能会以不同的方式处理它。

编辑：再次阅读您的问题后，我猜您正在寻找的是某种浏览器插件。如果我理解正确，您希望让您的客户能够在网站上为网站添加书签，这会以某种方式通知您的网站他们正在查看的页面。实现这一目标的最简洁方法是浏览器插件。您还可以使用 FRAME 技巧，例如 Digg 栏。

# wpf - 资源中的 WPF 存储布局

> ID：744428
> 
> 赞同：0
> 
> 时间：2009-04-13T16:21:13.197
> 
> 标签：wpf

我有应用程序，其中默认窗口的边框关闭

窗口标签定义如下所示：

```
<Window x:Class="TEA.UI.MainWindow"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="Title" WindowStyle="None" AllowsTransparency="True" Background="Transparent"> 
```

在 Window 标签内，有一个 Grid 面板，它包含几个 Rectangle 形状和一些其他的网格。

它看起来像这样：

```
<Grid>
    <!-- WINDOW BACKGROUND -->
    <Rectangle Stroke="#FF214E80" RadiusX="3" RadiusY="3" ClipToBounds="True">
        <Rectangle.Fill>
            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                <GradientStop Color="#FF193C6C" Offset="0"/>
                <GradientStop Color="#FF2A65A4" Offset="1"/>
            </LinearGradientBrush>
        </Rectangle.Fill>
    </Rectangle>
    <!-- // WINDOW BACKGROUND -->

    <!-- HEADER HIGHLIGHT2 -->
    <Rectangle HorizontalAlignment="Stretch" Margin="2,2,2,0" VerticalAlignment="Top" Height="62" RadiusX="2" RadiusY="2">
        <Rectangle.Fill>
            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                <GradientStop Color="#00193C6C" Offset="1"/>
                <GradientStop Color="#4C96ABC3" Offset="0"/>
            </LinearGradientBrush>
        </Rectangle.Fill>
    </Rectangle>
    <!-- // HEADER HIGHLIGHT2 -->
<Grid>
    ....
</Grid> 
```

这些矩形形状也用于其他窗口对话框。

我的问题是：

如何将这些重新编排存储在 WPF 资源字典中？

我将如何引用它们？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T09:33:30.297

实际上解决方案很简单 WPF UserControl 为我解决了问题

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T18:14:12.300

您可以在资源字典中为这些项目创建一个样式，并为每个属性设置一个设置器 - 一个包含在下面。

```
<Style TargetType="{x:Type Rectangle}" x:Key="WindowBackground">
  <Setter Property="Stroke" Value="#FF214E80"/>
</Style> 
```

然后在您的窗口中，您可以像这样引用样式..

```
<Rectangle Style="{StaticResource WindowBackground}"/> 
```

# silverlight - 如何将可视状态管理与自定义控件模板分开？

> ID：744430
> 
> 赞同：0
> 
> 时间：2009-04-13T16:21:35.643
> 
> 标签：silverlight, silverlight-3.0

如何将可视状态管理与自定义控件模板分开？

我有一个自定义控件，但在模板中放置了几个不同的面孔。所有模板必须具有相同的基于状态的可视化。有没有办法只设置一次我的 VSM？否则我需要在每个模板中复制 VSM 代码。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-19T08:42:02.273

重新模板通常会导致重复代码，尤其是对于 VSM 代码。不幸的是，今天没有一种简单的方法可以抽象出该代码。

# java - Java集合/映射应用方法等效？

> ID：744435
> 
> 赞同：25
> 
> 时间：2009-04-13T16:23:48.010
> 
> 标签：java, collections, apply

我想将一个函数应用于 Java 集合，在这种特殊情况下是一个映射。有没有很好的方法来做到这一点？我有一张地图，想对地图中的所有值运行 trim() 并让地图反映更新。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-04-13T16:31:50.457

使用 Java 8 的 lambda，这是一个单行：

```
map.replaceAll((k, v) -> v.trim()); 
```

为了历史起见，这里有一个没有 lambdas 的版本：

```
public void trimValues(Map<?, String> map) {
  for (Map.Entry<?, String> e : map.entrySet()) {
    String val = e.getValue();
    if (val != null)
      e.setValue(val.trim());
  }
} 
```

或者，更一般地说：

```
interface Function<T> {
  T operate(T val);
}

public static <T> void replaceValues(Map<?, T> map, Function<T> f)
{
  for (Map.Entry<?, T> e : map.entrySet())
    e.setValue(f.operate(e.getValue()));
}

Util.replaceValues(myMap, new Function<String>() {
  public String operate(String val)
  {
    return (val == null) ? null : val.trim();
  }
}); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-09-15T09:08:20.200

除了您接受的响应之外，我不知道使用 JDK 库执行此操作的方法，但是 Google Collections 允许您使用类`com.google.collect.Maps`和执行以下操作`com.google.common.base.Function`：

```
Map<?,String> trimmedMap = Maps.transformValues(untrimmedMap, new Function<String, String>() {
  public String apply(String from) {
    if (from != null)
      return from.trim();
    return null;
  }
} 
```

该方法与提议的方法的最大区别在于它提供了原始地图的视图，这意味着虽然它始终与原始地图同步，但`apply`如果您大量操作所述地图，则可能会多次调用该方法.

集合也存在类似的`Collections2.transform(Collection<F>,Function<F,T>)`方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T16:31:11.533

是否可以就地修改集合取决于集合中对象的类。

如果这些对象是不可变的（字符串是），那么您不能只从集合中获取项目并修改它们 - 相反，您需要遍历集合，调用相关函数，然后将结果值放回去。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-13T16:58:16.023

对于这样的事情可能有点矫枉过正，但是[Apache Commons Collections](http://commons.apache.org/collections/)库中有许多非常好的实用程序可以解决这些类型的问题。

```
Map<String, String> map = new HashMap<String, String>(); 
map.put("key1", "a  ");
map.put("key2", " b ");
map.put("key3", "  c");

TransformedMap.decorateTransform(map, 
  TransformerUtils.nopTransformer(), 
  TransformerUtils.invokerTransformer("trim")); 
```

我强烈推荐 O'Reilly 的[Jakarta Commons Cookbook](https://rads.stackoverflow.com/amzn/click/com/059600706X)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-03-17T01:49:41.740

我最终使用了@erickson 答案的突变，突变为：

*   返回一个新的`Collection`，而不是就地修改
*   return `Collection`s 元素的类型等于的返回类型`Function`
*   支持映射映射的值或列表的元素

代码：

```
public static interface Function<L, R> {
    L operate(R val);
}

public static <K, L, R> Map<K, L> map(Map<K, R> map, Function<L, R> f) {
    Map<K, L> retMap = new HashMap<K, L>();

    for (Map.Entry<K, R> e : map.entrySet()) retMap.put(e.getKey(), f.operate(e.getValue()));

    return retMap;
}

public static <L, R> List<L> map(List<R> list, Function<L, R> f) {
    List<L> retList = new ArrayList<L>();

    for (R e : list) retList.add(f.operate(e));

    return retList;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T16:32:09.300

您必须遍历所有条目并修剪每个 String 值。由于 String 是不可变的，因此您必须将其重新放入地图中。更好的方法可能是在将值放置在地图中时对其进行修剪。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-06-24T08:53:54.873

我想出了一个“映射器”类

```
public static abstract class Mapper<FromClass, ToClass> {

    private Collection<FromClass> source;

    // Mapping methods
    public abstract ToClass map(FromClass source);

    // Constructors
    public Mapper(Collection<FromClass> source) {
        this.source = source;
    }   
    public Mapper(FromClass ... source) {
        this.source = Arrays.asList(source);
    }   

    // Apply map on every item
    public Collection<ToClass> apply() {
        ArrayList<ToClass> result = new ArrayList<ToClass>();
        for (FromClass item : this.source) {
            result.add(this.map(item));
        }
        return result;
    }
} 
```

我这样使用：

```
Collection<Loader> loaders = new Mapper<File, Loader>(files) {
    @Override public Loader map(File source) {
        return new Loader(source);
    }           
}.apply(); 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-04-13T19:05:22.303

您还可以查看 Google Collections

# c# - WinForms：双向TextBox问题

> ID：744436
> 
> 赞同：2
> 
> 时间：2009-04-13T16:23:48.027
> 
> 标签：c#, winforms, textbox

我有一个 TextBox，用于数据输入和显示。用户可以从列表中选择项目，每个项目都有一个相应的文本，当项目被选中时，该文本会显示在 TextBox 中。

用户可以编辑此文本框，从而更改列表项的相应文本。

我的问题是：我使用 TextChanged 事件来检测用户何时输入一些文本并更新事件处理程序中的内部变量，但是当我以编程方式更改文本框的值时也会调用此事件处理程序。我希望仅在用户更改文本框时调用此处理程序。我怎样才能做到这一点？

**编辑：**组合框也有同样的问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T16:29:08.623

处理程序将始终被调用 - 我知道无法禁用它。但是，您可以简单地在您的类中设置一个标志来指示您已经以编程方式更改了状态并且应该忽略下一个事件。

```
_updating = true;
_textBox.Text = "New Text";  

...      

_textBox_TextChanged( object sender, EventArgs e )
{
    if( _updating ) { _updating = false; return; }
    // Do something special with the new text.
} 
```

您也可以尝试创建文本框控件并覆盖 Text 属性以提供您自己的自定义逻辑。

```
class MyTextBox : TextBox
{
    public overrides string Text{ 
        get{ return base.Text; }
        set{
            if( value == Text ) return;
            _updating = true;
            base.Text = value;
            _updating = false;
           }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T16:27:04.587

每当 TextBox 更改其 Text 属性时调用 TextChanged 事件，这可以通过修改 Text 属性来实现，或者当用户直接更改文本时，还有其他事件更可能适用于您尝试实现的场景。

*   KeyPress：每当用户按下按键时触发
*   KeyDown：每当一个键被拉下时引发
*   KeyUp：每当一个键被拉起（释放）时引发

希望能帮助到你

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T16:27:18.923

您可以在程序更新中设置一个标志，如果设置了该标志，则可以在事件处理程序中提前退出。

但是如果你使用数据绑定，那么变量和 gui 会自动同步，这样就避免了这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T17:38:19.440

您的意思是您希望第二个文本框显示取决于第一个文本框中的内容的内容，但前提是用户确实设置了它？

您能否更具体地说明您要实现的目标？在我看来，您的 UI 设计可能会让用户感到困惑，因为 B 中的文本有时与 A 相关，有时与 A 无关。

如果您仍然想这样做，典型的方法是使用更新标志，如其他答案中所建议的那样。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T17:42:09.913

检查文本框上的焦点。如果它没有焦点，则意味着用户没有对其进行编辑。

# sas - 在 OPEN VMS 中使用 PROC IMPORT 时出现 SAS 错误

> ID：744441
> 
> 赞同：1
> 
> 时间：2009-04-13T16:25:42.407
> 
> 标签：sas

我在 OpenVMS 8.3 平台上运行 SAS 版本 8.1。我尝试了 2 种不同的方法来导入 csv 数据文件，但似乎都无法让它们中的任何一种正常工作。如果有人对我可能做错了什么有任何想法，那就太好了。这似乎是一件相当简单的事情。

**CSV 文件**

SSID,field1,......(等)

AA9999999,043844,.......(等)

**方法A——**这似乎“几乎”有效。

数据 JU2_DAT;

```
 INFILE STD_JU2  DSD LRECL=1024 TRUNCOVER FIRSTOBS=2;

   INPUT    ID $
            field1 $ 
```

出于某种原因，ID 字段的最后一个字符被截断了......而不是得到 9 个字符，我只得到 8 个字符。

**方法B**

PROC IMPORT DATAFILE=STD_JU2 OUT=JU2_DAT DBMS=CSV ; 获取名称=是；

这种方法似乎根本没有运行。它将 CPU 固定在 100%，当我终止进程时，LOG 中出现以下错误。这让我感到困惑，因为我没有在任何类型的窗口环境中运行它。

错误：无法打开 X 显示。检查显示名称/服务器访问授权。

+错误：无法打开 X 显示。检查显示名称/服务器访问授权。

+错误：无法打开 X 显示。检查显示名称/服务器访问授权。

+

+

错误：设备不支持全屏。

+ERROR：设备不支持全屏。

+ERROR：设备不支持全屏。

错误：在列表中找不到命名项目。

+错误：在列表中找不到命名项目。

+错误：在列表中找不到命名项目。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T17:10:56.493

我会尝试在您的输入语句中添加一个信息。默认长度为 8 个字符。使用冒号修饰符将导致 SAS 读取 :$X。字符或直到遇到分隔符。

```
INFILE STD_JU2  DSD LRECL=1024 TRUNCOVER FIRSTOBS=2;
INPUT    ID :$9.
        field1 $ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T06:08:55.100

我从未使用过 OpenVMS，但我看到了错误消息：

```
ERROR: Cannot open X display. Check display name/server access authorization. 
```

或者在没有 X 服务器的情况下在 Unix 下运行类似的东西。`-nodms`解决方案是使用（或可能`-nodmr`）命令行选项调用 SAS 。

# javascript - JavaScript：继承和常量声明

> ID：744452
> 
> 赞同：1
> 
> 时间：2009-04-13T16:27:08.393
> 
> 标签：javascript, inheritance, constants

求助，我有这门课

```
var jMath = {

    pi2: Math.PI,

    foo: function() {
        return this.pi2;
    }
} 
```

我想让 pi2 保持不变，并且我希望 jMath 从 Math 对象继承。我怎么做？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T16:51:42.623

Consider using `prototype`:

```
function JMath() {};
JMath.prototype = {
    pi2: Math.PI,

    foo: function() {
        return this.pi2;
    }
}

var j = new JMath(); 
j.pi2=44; j.foo(); // returns 44
delete j.pi2; j.foo(); // now returns Math.PI 
```

The difference between this and @altCognito's answer is that here the fields of the object are shared and all point to the same things. If you don't use prototypes, you create new and unlinked instances in the constructor. You can override the prototype's value on a per-instance basis, and if you override it and then decide you don't like the override value and want to restore the original, use `delete` to remove the override which merely "shadows" the prototype's value.

Edit: if you want to inherit all the methods and fields of the Math object itself, but override some things without affecting the Math object, do something like this (change the name "Constructor1" to your liking):

```
function Constructor1() {};
Constructor1.prototype = Math;
function JMath() {};
JMath.prototype = new Constructor1();
JMath.prototype.pi2 = JMath.prototype.PI;
JMath.prototype.foo = function() { return this.pi2; }

var j = new JMath();
j.cos(j.foo()); // returns -1 
```

edit 3: explanation for the Constructor1 function: This creates the following prototype chain:

```
j -> JMath.prototype -> Math 
```

j is an instance of JMath. JMath's prototype is an instance of Constructor1\. Constructor1's prototype is Math. JMath.prototype is where the overridden stuff "lives". If you're only implementing a few instances of JMath, you could make the overridden stuff be instance variables that are setup by the constructor JMath, and point directly to Math, like @altCognito's answer does. (j is an instance of JMath and JMath's prototype is Math)

There are 2 downsides of augmenting-an-object-in-the-constructor. (Not actually downsides necessarily) One is that declaring instance fields/methods in the constructor creates separate values for each instance. If you create a lot of instances of JMath, each instance's JMath.foo function will be a separate object taking up additional memory. If the JMath.foo function comes from its prototype, then all the instances share one object.

In addition, you can change JMath.prototype.foo after the fact and the instances will update accordingly. If you make the foo function in the constructor as a per-instance method, then once JMath objects are created, they are independent and the only way to change the foo function is by changing each one.

* * *

edit 2: as far as read-only properties go, you can't really implement them from within Javascript itself, you need to muck around under the surface. However you can declare so-called "[getters](http://ejohn.org/blog/javascript-getters-and-setters/)" which effectively act as constants:

```
JMath.prototype.__defineGetter__("pi2", function() { return Math.PI; });
JMath.prototype.__defineSetter__("pi2", function(){}); // NOP
var j = new JMath();
j.pi2 = 77; // gee, that's nice 
// (if the setter is not defined, you'll get an exception)
j.pi2; // evaluates as Math.PI by calling the getter function 
```

Warning: The syntax for defining getters/setters [apparently is not something that IE doesn't implement nicely](http://annevankesteren.nl/2009/01/gettters-setters).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T16:34:04.197

哦，有趣，从头开始，这是正确的版本：

```
function JMath() {
   this.foo = function() {
        return this.PI;
    }
}

JMath.prototype = Math;

var jMath = new JMath();
alert(jMath.foo()); 
```

（与此处的其他答案相匹配）

（我最初尝试使用“JMath.prototype = new Math()”来设置原型，这是我在其他地方看到的，但上面的方法有效）

## 编辑

这是作为单身人士的一种方法

```
//  Execute an inline anon function to keep
//  symbols out of global scope
var jMath = (function()
{
    //  Define the JMath "class"
    function JMath() {
        this.foo = function() {
            return this.PI;
        }
    }

    JMath.prototype = Math;

    // return singleton
    return new JMath();
})();

//  test it
alert( jMath.PI );

//  prove that JMath no longer exists
alert( JMath ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T17:04:10.097

用户定义的对象属性不能是常量。数学（和其他一些对象）是一个特殊的内置 - 它具有只读属性和函数。但它不是构造函数——它只是一个静态对象（Math.constructor === Object）。

而且因为 JavaScript 具有原型继承，而不是经典继承，所以你*不能*从 Math 继承。（[在这里阅读更多](http://javascript.crockford.com/inheritance.html)）

但是，您可以做的是定义原型。当在本地找不到某个属性时，JS 解析器会在当前对象的原型上查找该属性。altCognito 当前的解决方案很好地说明了这一点。

我很好奇你到底想要达到什么目的。也许这样的东西是你想要的？

```
var jMath = function()
{
    const pi2 = Math.PI;

    this.getPi2 = function()
    {
        return pi2;
    }
}

var j = new jMath;
alert( j.getPi2() ); 
```

# iphone - NSString 包含一个数字，为 什么它会使我的应用程序崩溃？

> ID：744458
> 
> 赞同：1
> 
> 时间：2009-04-13T16:28:10.153
> 
> 标签：iphone, objective-c, nsstring

我在我的应用程序中遇到了 NSString 的一些困难。基本上，我有一个名为 o1string 的 NSString，其中包含值“602”。我想在 UIAlertView 中将其与其他一些文本一起输出。

```
votedmessage = [ NSString stringWithFormat:@"The current standings are as follows:\n\n%@: %@ votes", b1title, o1string ];
UIAlertView *votedAlert = [[UIAlertView alloc] initWithTitle:@"Thank you for voting" message:votedmessage delegate:self cancelButtonTitle:nil otherButtonTitles:@"OK", nil]; 
```

我使用了 NSLog 并验证了 NSString 中的值肯定是 602，并且消息中使用的另一个变量（b1title）可以自行输出。但是，当我将 o1votes 变量添加到警报消息中时，我无法弄清楚为什么应用程序会崩溃，这是否与在 NSString 中仅保存一个数字的冲突有关？

这就是 o1string 的设置方式。它肯定包含从 XML 文件中获取的“602”。

```
o1string = [[options objectAtIndex:3] objectForKey: @"votes"];
o1string = [o1string stringByReplacingOccurrencesOfString:@"\n" withString:@""];
o1string = [o1string stringByReplacingOccurrencesOfString:@"    " withString:@""]; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T16:58:16.180

Unless that assignment of o1string is in the same method where votedmessage is created (since you don't say, I'm assuming not), it will be gone by the time you get to the code where votedmessage needs it.

Unless you're using garbage collection, you need to retain objects that you want to keep around past the current method. See the [Objective-C memory management guide](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html) for complete details.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T17:00:34.600

You need to post more code. In particular it's not clear whether the two pieces you posted are in the same function or different places.

If they're in different places you must call [o1string retain] (and later [o1string release]). The easiest way to do this would be to make olstring a property with retain semantics.

stringByReplacingOccurrencesOfString returns a temporary instance that will be auto-released sometime after the function exists.

I would guess the reason b1Title works is that it's stored in your dictionary so is persistent. o1string is created from the stringByXXX functions and is temporary.

# groovy - 如何使用 Groovy 的 mock.interceptor 包来模拟对象构造函数？

> ID：744466
> 
> 赞同：3
> 
> 时间：2009-04-13T16:29:23.333
> 
> 标签：groovy, mocking

`mock.interceptor`在我尝试使用包在 Groovy 中模拟对象时：

```
def mock = new MockFor(TheClass);
mock.demand.theMethod{ "return" }
mock.use {
    def underTest = new TheClass()
    println underTest.theMethod()
} 
```

我遇到的问题是`TheClass()`在`use{`块中创建时，它使用实际的构造函数，在这种情况下，我宁愿不使用它。如何创建此类的实例，以便我可以测试我关心的方法`theMethod`，而无需使用构造函数？

使用 EasyMock/CE，可以在不使用构造函数的情况下制作模拟，但我很好奇如何在 Groovy 中实现这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-11T14:45:53.343

[我最近看到了GMock](http://code.google.com/p/gmock/ "GMock")的作者的一个演示文稿，它有一些钩子可以允许“构造函数”模拟，我认为这就是你所追求的。

例如

```
 def mockFile = mock(File, constructor('/a/path/file.txt')) 
```

这个库不同于 groovy 的“内置”库，但它看起来写得非常好，对你想要模拟的东西进行了一些思考，更重要的是，当测试失败时你会收到错误消息。

我想这就是你所追求的。我会说小心使用构造函数模拟 - 你应该注入一个工厂对象可能是一种气味，但对于某些事情它看起来运作良好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-12T08:14:14.910

您可以在调用 MockFor 时使用 interceptConstruction 标志，请参阅 [MockFor](http://docs.groovy-lang.org/2.4.7/html/gapi/groovy/mock/interceptor/MockFor.html)。

# regex - 如何使用 RegEx 插入 JSON 响应？

> ID：744467
> 
> 赞同：0
> 
> 时间：2009-04-13T16:30:38.900
> 
> 标签：regex, json, asp.net-ajax

我正在将 JSON 用于我正在开发的 Web 应用程序。但是由于各种原因，我需要根据服务调用的 JSON 响应创建已经在客户端脚本上定义的“对象”。为此，我想使用正则表达式将“新”语句插入 JSON 响应。

```
function Customer(cust)
{
    this.Name = null;
    this.ReferencedBy = null;
    this.Address = null;

    if (cust != null)
    {
        this.Name = cust.Name;
        this.ReferencedBy = cust.ReferencedBy;
        this.Address = cust.Address;
    }
} 
```

JSON 响应由 ASP.NET AJAX 服务返回，它包含一个“__type”成员，可用于确定对象类型并插入“new”语句。

示例 JSON：

```
{"__type":"Customer", "ReferencedBy":{"__type":"Customer", "Name":"Rita"}, "Name":"Joseph", "Address":"123 {drive}"} 
```

生成的字符串如下所示：

```
new Customer({"ReferencedBy":new Customer({"Name":"Rita"}), "Name":Joseph", "Address":"123 {drive}"}) 
```

到目前为止，我得到了这个，但它不适用于 ReferencedBy 成员。

匹配：

```
({"__type":"Customer",)(.*?}) 
```

代替：

```
new Customer({$2}) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T17:13:50.277

嗯，你为什么不尝试做一个更简单的方法呢？例如：

```
var myJSON =     {"__type":"Customer", "ReferencedBy":{"__type":"Customer", "Name":"Rita"}, "Name":"Joseph", "Address":"123 {drive}"}; 
```

检查类型后：myJSON.__type，如果是客户，则：

new Customer({"ReferencedBy":new Customer({"Name":myJSON.ReferencedBy.Name}), "Name":myJSON.Name, "Address":myJSON.Address });

这是因为您已经定义了数据结构，因此不必使用正则表达式来匹配模式和提取数据。

# reflection - 类上的 ILMerge 和自定义属性

> ID：744468
> 
> 赞同：0
> 
> 时间：2009-04-13T16:30:51.147
> 
> 标签：reflection, dll, ilmerge

我将一些 dll 文件合并在一起，现在我的代码将在其中一个合并的 dll 文件中找到类，但无法看到我在它们上拥有的自定义属性。它可以很好地找到所有类，但缺少属性。有什么想法可以解决这个问题吗？

编辑：进一步调查显示属性在类上，但类型的 Guid 与原始类型不同，因此 GetCustomAttribute 找不到它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-04-28T17:46:59.847

/copyattrs 或 /copyattrs:True。您还可以使用 /attr:filename 标记指定要使用的属性。

默认情况下，它将使用您合并的第一个程序集的属性。

# silverlight - 在 Silverlight 3.0 中结合 .NET RIA 服务和 MVVM

> ID：744474
> 
> 赞同：8
> 
> 时间：2009-04-13T16:32:37.647
> 
> 标签：silverlight, silverlight-3.0, mvvm, ria, wcf-ria-services

在 Silverlight 3.0 中使用 .NET RIA 服务和 MVVM 时，RIA 服务中的元数据类型和 MVVM 模式中的 ViewModel 有区别吗？这些是同一件事还是应该分开？

元数据类型是部分实体类的密封内部类。那里似乎没有适当的分离，但元数据类型也可以用 Validation 的属性进行修饰，使其看起来像 ViewModel。

我四处寻找，但我没有看到任何关于这个的详细信息。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-18T20:33:57.257

同意 ChuckJ - 通常 DomainContext 构成视图模型的一部分。例如，假设我有一个允许搜索产品目录的搜索页面。这是我构建事物的方式：

在服务器上：

```
class Catalog : DomainService {
    IQueryable<Product> GetProducts(string keyword) { ... }
} 
```

生成的 DomainContext：

```
class Catalog : DomainContext {
    EntityList<Product> Products { get; }
    void LoadProducts(string keyword);
} 
```

我要写的视图模型：

```
class SearchViewModel {
    Catalog _catalog = new Catalog();

    public IEnumerable<Product> Results {
        get { return _catalog.Products; }
    }

    public void Search(string keyword) {
        _catalog.Products.Clear();
        _catalog.LoadProducts(keyword);
    }
} 
```

最后在我的 xaml 中，我将 UserControl 的 DataContext 设置为 SearchViewModel 的一个实例，并将 ItemsControl 绑定到 Results 属性。我将使用您选择的 ViewModel 模式将按钮单击绑定到 Search（这实际上是 SearchViewModel 公开的命令）。我个人喜欢使用[Silverlight.FX](http://projects.nikhilk.net/SilverlightFX)的东西，例如：

```
<Button Content="Search"
  fxui:Interaction.ClickAction="$model.Search(keywordTextBox.Text)" /> 
```

和最初显示[的here](http://www.nikhilk.net/Silverlight-ViewModel-Pattern.aspx)。

正如 Chuck 提到的，我的视图模型中可能确实有其他状态，例如，SelectedProduct 可能双向绑定到我的 xaml 中 ListBox 的 SelectedItem，然后将相同的 SelectedProduct 绑定为 DataForm 的 DataContext 以显示所选产品的详细信息。

希望有帮助！[我很快就会在我的博客](http://www.nikhilk.net)上写更多关于这个的博客。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T19:13:19.943

RIA 服务数据上下文被设计为在 MVVM 模式中扮演 ViewModel 的角色，因为它们本机支持数据绑定，但它们在文档中不使用该术语。但是，这真的取决于。您可能需要视图模型中的状态，而不是 RIA 数据上下文提供的命令和其他视图相关状态。我认为您想要做的是使用来自 RIA 服务的数据上下文作为视图模型的一部分。

# c - 为什么我不能与具有相同内容的两个结构互换分配？

> ID：744477
> 
> 赞同：5
> 
> 时间：2009-04-13T16:33:28.643
> 
> 标签：c, struct

我正在尝试学习 C，但遇到了一些奇怪的事情：

```
struct
{
  int i;
  double j;
} x, y;

struct
{
  int i;
  double j;
} z; 
```

在这里，您可以看到我创建了两个`struct`元素相同的 s。

为什么当我尝试分配`x = z`它时会产生编译错误但`x = y`不会产生？它们具有相同的内容，那么为什么我不能将它们相互分配呢？

**有什么办法可以**让我分配`x = z`吗？或者他们只是必须是相同的`struct`。

任何 C 大师都可以为我指明正确的方向吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-13T16:36:05.063

它们的内容相同，但类型不同。如果它们打算属于同一类型，只需`typedef x z;`. 如果它们不是同一个东西，只是碰巧包含相同的字段，最好创建一个单独的函数来正确分配字段。

* * *

我在 C 中声明结构的常用风格包括 typedef，所以我忘了提及它（对不起！）。这是语法：

```
typedef struct
{
  int foo;
  double bar;
} x;

/* Further down, if needed */
typedef x z; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-13T16:37:02.083

使结构相同的类型相同称为“[鸭子类型](http://en.wikipedia.org/wiki/Duck_typing)”。这是在某些语言中完成的，但不是在 C 中。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-13T16:37:36.590

编译器不会计算可能具有相同结构的结构之间的“类型等价”，因此就它而言，第二个结构与第一个无关。

它可以做 x 和 y 因为它们是同时声明的。

为什么要重新声明 struct ？您可能应该对结构进行一次类型定义（例如，在 H 文件中）以使其成为实际类型，然后声明实例。

[这是一个关于结构类型定义的好教程。](http://www.cs.princeton.edu/~lworthin/126/precepts/structs.html)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-13T16:38:45.727

```
struct mystruct
{  
int i;  
double j;  
};

struct mystruct x, y;
struct mystruct z; 
```

如果您打算在它们之间复制数据，则必须以相同的身份声明它们。您有两个声明，对于编译器来说它们相等并不重要，它们是两个不同的结构，编译器不应该检测它们的相似性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T16:43:12.240

C differentiates `struct`s based on name, and if they're anonymous, then different structure definitions are different.

Anyhow, classic C doesn't allow `x = z` when `x` and `z` are structs -- is that an ANSI or a C99 addition? Anyhow, you should instead use

```
#include <string.h>
memcpy(&x, &z, sizeof(x)); 
```

# .net - 将 EBCDIC 字符转换为十六进制值（AFP EBCDIC 数据）

> ID：744486
> 
> 赞同：1
> 
> 时间：2009-04-13T16:35:14.863
> 
> 标签：.net, vb.net, hex, ebcdic

我使用一些需要解析并找到一些十六进制值的 EBCDIC 数据。我遇到的问题是，我似乎正在使用不正确的编码读取文件。我可以看到我的记录以“ ”开头（在 EBCDIC`!`中是 a ），但是在转换为十六进制时，它返回为 a ，这是“ ”的 ASCII 值。`x5A``x21``!`

我希望框架中有一个内置方法，但恐怕我将不得不创建一个自定义类来正确映射 EBCDIC 字符集。

```
Using fileInStream As New FileStream(inputFile, FileMode.Open, FileAccess.Read)
   Using bufferedInStream As New BufferedStream(fileInStream)
      Using reader As New StreamReader(bufferedInStream, Encoding.GetEncoding(37))
         While Not reader.EndOfStream
            Do While reader.Peek() >= 0
               Dim charArray(52) As Char
               reader.Read(charArray, 0, charArray.Length)

               For Each letter As Char In charArray
                  Dim value As Integer = Convert.ToInt16(letter)

                  Dim hexOut As String = [String].Format("{0:x}", value)
                  Debug.WriteLine(hexOut)
               Next
            Loop
         End While
      End Using
   End Using
End Using 
```

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-14T14:30:47.150

你可以这样做：

1.  打开法新社文件。读取前 9 个字节。
2.  字节 0 应为 0xD3 或 0x5A。字节 1 和字节 2 将是 SFI 的长度，包括您刚刚读取的 9 个字节中的 8 个。它是大端，所以长度 = byte1 * 256+byte2。
3.  字节 3、4 和 5 是结构化字段标识符。如果您正在寻找可打印的文本，请寻找 PTX，（演示文本元素）0xD3 0xEE 0x9B。如果没有找到，请向前跳过 length-8 并读取接下来的 9 个字节。
4.  如果您确实找到了 PTX，请读取长度为 8 字节的内容。解析控制序列以获取文本有点棘手。第一个将从 0x2b 0xD3 开始，一个字节表示长度，字节表示它是哪种控制序列。如果此字节为奇数，则下一个控制序列将省略 0x2B 0xD3 标头，而是从长度字节开始。这被称为“链接”，显然是为了驱使程序员疯狂地解析这些东西而引入的。
5.  从长度字节length-1 向前跳过并按下或只是寻找下一个0x2B 0xD3；最后一个控制序列将不会被链接，并且 PTX 末尾之后的所有内容都将是 EBCDIC。使用 Jon Skeet 的库（感谢 Jon）并寻找下一个 PTX 元素。

对不起，我啰嗦了。这是可行的，但并不简单。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T16:59:24.883

是的，当您以字符串形式读取文本数据时，它会在内部将其存储为 Unicode。如果您关心*二进制*值（即原始字节），那么首先不要对其进行解码。

如果您真的需要使用自定义 EBCDIC 编码来做任何事情，您可以使用我的[开源 EBCDIC 实现](http://pobox.com/~skeet/csharp/ebcdic)——但我认为您真的只需要下定决心将其视为二进制数据还是文本。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T20:21:48.093

以这种方式仔细阅读 AFP 数据。它在字节和位顺序上都是大端的。如果您将其视为二进制数据，例如通过文档中的结构化字段进行解析，则需要考虑这一点。

# linq-to-entities - Linq 到实体 System.data.Objects

> ID：744489
> 
> 赞同：1
> 
> 时间：2009-04-13T16:35:27.453
> 
> 标签：linq-to-entities, namespaces

我开始使用 Linq to Entities，示例引用了一个名为 System.Data.Objects 的命名空间。我的环境不包含此命名空间，我找不到包含它的 DLL。有谁知道我在哪里可以找到它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-12-24T19:46:34.177

我有同样的问题。

我下载了 Microsoft 教程的代码并开始使用它，但我自己没有在解决方案中添加任何 EDM 项目，因此缺少参考。

我在 VS2010 中使用“添加新项目 > ADO.Net 实体数据模型”向解决方案添加了一个新的空 EDM。

然后我重新构建了解决方案。没有编译器错误。

然后我删除了空的 EDM。

将 EDM 添加到解决方案中添加了必要的参考。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T17:14:23.553

如果您创建了一个针对 .Net 3.5 的网站 [假设您安装了 3.5 SP1]，那么您的项目中就支持 ADO.NET Entity Framework。您可以从添加新项目对话框中添加实体模型。这意味着您的项目具有对 System.Data 的引用并公开 System.Data.Objects 命名空间。没有任何理由不应该发生。

这个命名空间在使用 ADO.NET Entity Framework 开发应用程序时非常重要，因为它为您提供了可以处理实体、实体查询和查询结果的对象。

例如：

如果要存储 Qry 或 Expression 返回的所有客户结果集，则可以使用以下语法来执行此操作。

```
ObjectResult<Customer> _Resultset = ctx.Customers; 
```

同样，您可以使用 ObjectQuery 来存储实体查询。

您可以参考以下[链接](http://msdn.microsoft.com/en-us/library/system.data.objects.aspx)以了解更多信息。

[链接文本](http://msdn.microsoft.com/en-us/library/system.data.objects.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T16:51:29.020

没关系。它似乎是核心框架的一部分。我正在使用的教程来自微软，所以不是很清楚...... :-)

# ruby-on-rails - 关闭 Firefox 中文本字段的自动完成功能

> ID：744490
> 
> 赞同：41
> 
> 时间：2009-04-13T16:35:48.730
> 
> 标签：ruby-on-rails, firefox

我现在应该在学习法语，但我没有学习任何词汇，而是一直在使用一个测试词汇的 rails 应用程序 - 所以它显示一个单词，我必须输入它的翻译。

不幸的是，Firefox 会记住我已经在那里输入的所有内容，因此这在一定程度上降低了它的实用性。

是否有可能通过 form_for 或其他选项来关闭这种通常有用的行为？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2009-04-13T16:52:39.253

So it turns out it's pretty simple. Rather than

```
<%= f.text_field :fieldname %> 
```

put

```
<%= f.text_field :fieldname, :autocomplete => :off %> 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2010-03-08T20:59:08.453

您还可以使用 :html 集合中的 :autocomplete 属性在表单级别关闭自动完成功能，该属性将生成 Erv 引用的 HTML。语法是

```
<% form_for :form_name, @form_name, :html => {:autocomplete => "off"} do |f|%>
...
<% end %> 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-13T16:41:21.213

Add autocomplete="off" as an attibute on your form tag:

```
<form action="..." method="..." autocomplete="off" >
</form> 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-12-08T16:39:27.807

我正在使用表单的“标签”变体，发现它可以工作：

```
<%= text_field_tag('favorite animal', nil, :options => {:autocomplete => 'off'}) %> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-12-08T17:13:12.680

**在Rails 3**应用程序的标签变体下方：

```
<%= text_field_tag :search, nil, :autocomplete => 'off' %> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-05-02T09:56:18.893

Rails 4+ 中的简单解决方案

在我添加的表格中：

```
:autocomplete => "off" 
```

在现场：

```
:autocomplete=>"none" 
```

例子：

```
 <%= form_for(@user.address_detail,
           :url => {:action => :update_address},
           :validate => true,
           :method => :put,
           :html => {:class => "form-horizontal",:autocomplete => "off"},
  ) do |f| %>

          <div class="controls">
        <%= f.text_field :address_line_1,:autocomplete=>"none" %>
      </div> 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-10-06T23:57:27.093

这在 Rails 4+ 中对我有用

```
<%= f.text_field :name, autocomplete: :off %> 
```

漂亮又简单

# c# - WinForms：暂时禁用事件处理程序

> ID：744494
> 
> 赞同：38
> 
> 时间：2009-04-13T16:36:19.713
> 
> 标签：c#, winforms

如何在 WinForms 中临时禁用事件处理程序？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-04-13T16:39:21.687

可能，最简单的方法（不需要取消订阅或其他东西）是声明一个布尔值并在处理程序的开头检查它：

```
bool dontRunHandler;

void Handler(object sender, EventArgs e) {
   if (dontRunHandler) return;

   // handler body...
} 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-04-13T16:39:25.460

从什么角度禁用？如果您想从处理程序的委托列表中删除您范围内的方法，您可以这样做。

```
object.Event -= new EventHandlerType(your_Method); 
```

这将从委托列表中删除该方法，您可以稍后重新附加它

```
object.Event += new EventHandlerType(your_Method); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-07-08T10:22:50.317

我正在这样做，使用控制扩展。

```
public static void SetDatasource(
  this ComboBox cb, 
  object dataSource, 
  EventHandler _SelectedIndexChanged_eventHandler = null, 
  EventHandler _SelectedValueChanged_eventHandler = null)
{
//disable events
  if (_SelectedIndexChanged_eventHandler != null) cb.SelectedIndexChanged -= _SelectedIndexChanged_eventHandler;
  if (_SelectedValueChanged_eventHandler != null) cb.SelectedValueChanged -= _SelectedValueChanged_eventHandler;
  if (cb.InvokeRequired)
  {
    cb.BeginInvoke(new _d_SetDatasource_ComboBox(SetDatasource), new object[] { cb, dataSource, _SelectedIndexChanged_eventHandler});
  }
  else
  {
    cb.DataSource = dataSource;
    //events enabled again
    if (_SelectedIndexChanged_eventHandler != null) cb.SelectedIndexChanged += _SelectedIndexChanged_eventHandler;
    if (_SelectedValueChanged_eventHandler != null) cb.SelectedValueChanged += _SelectedValueChanged_eventHandler;
  }
}
private delegate void _d_SetDatasource_ComboBox(ComboBox cb, object dataSource, EventHandler _SelectedIndexChanged_eventHandler = null, EventHandler _SelectedValueChanged_eventHandler = null); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2021-03-03T06:17:49.423

禁用组件的事件。伪代码：

```
YourComponent.YourComponentEvent -= ExistingMethodForTheEvent; 
```

启用

```
YourComponent.YourComponentEvent += ExistingMethodForTheEvent; 
```

DataGridView 中的 CellFormatting 等事件示例：

```
//enabling
DataGridView1.CellFormatting += DataGridView1_CellFormatting;
//disabling
DataGridView1.CellFormatting -= DataGridView1_CellFormatting;

private void DgvBillings_CellFormatting(...) {
...
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-07-09T14:25:06.680

如果您只为一堆复选框或单选按钮使用一个事件处理程序，您还可以使用以下内容：

```
var lSender = sender as RadioButton;
if (lSender?.Checked != true)
    return; 
```

# c# - 创建新实例或仅设置内部变量

> ID：744504
> 
> 赞同：1
> 
> 时间：2009-04-13T16:38:27.290
> 
> 标签：c#, .net, asp.net, optimization, class

我编写了一个辅助类，它在构造函数中接受一个字符串，并提供许多 Get 属性来返回字符串的各个方面。目前设置线的唯一方法是通过构造函数，一旦设置就无法更改。由于这个类只有一个内部变量（字符串），我想知道是否应该保持这种方式，还是应该允许设置字符串？

一些示例代码我的帮助为什么我要问：

```
StreamReader stream = new StreamReader("ScannedFile.dat");
ScannerLine line = null;
int responses = 0;
while (!stream.EndOfStream)
{
  line = new ScannerLine(stream.ReadLine());
  if (line.IsValid && !line.IsKey && line.HasResponses)
    responses++;
} 
```

以上是计算给定扫描文件中有效响应数量的快速示例。像这样编码会更有利吗？

```
StreamReader stream = new StreamReader("ScannedFile.dat");
ScannerLine line = new ScannerLine();
int responses = 0;
while (!stream.EndOfStream)
{
  line.RawLine = stream.ReadLine();
  if (line.IsValid && !line.IsKey && line.HasResponses)
    responses++;
} 
```

此代码用于 ASP.net Web 应用程序的后端，需要具有一定的响应性。我知道这可能是过早优化的情况，但我正在编写代码以提高客户端的响应能力和可维护性。

谢谢！

**编辑 -**我决定也包括该类的构造函数（是的，这就是它的真正含义。）：

```
public class ScannerLine
{
  private string line;
  public ScannerLine(string line)
  {
    this.line = line;
  }

  /// <summary>Gets the date the exam was scanned.</summary>
  public DateTime ScanDate
  {
    get
    {
      DateTime test = DateTime.MinValue;
      DateTime.TryParseExact(line.Substring(12, 6).Trim(), "MMddyy", CultureInfo.InvariantCulture, DateTimeStyles.None, out test);
      return test;
    }
  }

  /// <summary>Gets a value indicating whether to use raw scoring.</summary>
  public bool UseRaw { get { return (line.Substring(112, 1) == "R" ? true : false); } }

  /// <summary>Gets the raw points per question.</summary>
  public float RawPoints
  {
    get
    {
      float test = float.MinValue;
      float.TryParse(line.Substring(113, 4).Insert(2, "."), out test);
      return test;
    }
  }
} 
```

** EDIT 2 - ** 我包含了该类的一些示例属性以帮助澄清。如您所见，该类从扫描仪中获取固定字符串，并且可以更轻松地将行拆分为更有用的块。该文件是来自 Scantron 机器的行分隔文件，解析它的唯一方法是一堆 string.Substring 调用和转换。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T16:54:18.797

如果你真的需要这个类，我肯定会坚持使用不可变版本。不变性使你的代码更容易推理——如果你存储一个对 a 的引用`ScannerLine`，知道它不会改变是很有用的。性能几乎可以肯定是微不足道的——读取行所涉及的 IO 可能比创建新对象更重要。如果您*真的*关心性能，应该在您决定基于这些性能担忧做出设计决策之前对代码进行基准测试/分析。

但是，如果您的状态只是一个字符串，那么您是否真的比直接存储字符串并拥有适当的方法来稍后分析它们提供了很多好处？`ScannerLine`分析字符串并缓存该分析，还是真的只是一堆解析方法？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T16:48:19.807

你的第一种方法更清楚。性能方面你可以获得一些东西，但我认为不值得。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T16:53:38.750

我会选择第二个选项。它更有效，而且它们都同样容易理解 IMO。另外，您可能无法知道 while 循环中的这些语句将被调用多少次。那么谁知道呢？这可能是 0.01% 的性能提升，或 50% 的性能提升（不太可能，但可能）！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T16:54:25.800

不可变类有很多优点。像这样的简单值类是不可变的是有意义的。对于现代 VM，类的对象创建时间很短。你拥有它的方式很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T17:14:56.373

我实际上会完全抛弃类的“实例”性质，并将其用作静态类，而不是像现在这样的实例。每个属性都是完全独立的，除了使用的字符串。如果这些属性彼此相关，和/或每次分配字符串时都设置了其他“隐藏”变量（例如预处理属性），那么就有理由这样做重新分配的方式或其他方式，但是从您在那里所做的事情来看，我会将其更改为该类的 100% 静态方法。

如果您坚持让该类成为一个实例，那么出于纯粹的性能原因，我将允许重新分配字符串，因为 CLR 不会不断地创建和销毁同一类的实例（显然字符串本身除外）。

归根结底，IMO 这是您真正可以随心所欲地做的事情，因为没有其他类实例变量。做其中一个可能有风格上的原因，但在解决这个问题时很难“出错”。如果类中还有其他变量是在构造时设置的，那么这将是一个完全不同的问题，但是现在，您所看到的最清晰的代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T17:16:30.130

我会选择你的第一个选项。在您的示例中，类没有理由是可变的。保持简单，除非您确实需要使其可变。如果你真的很关心性能，那么运行一些性能分析测试，看看有什么不同。

# java - 将 Google Web Toolkit (GWT) 用作成熟的 Java Web 框架是否有意义？

> ID：744515
> 
> 赞同：12
> 
> 时间：2009-04-13T16:40:32.057
> 
> 标签：java, gwt, wicket, web-frameworks

我对 GWT 是否可以作为我的整个表示层的基础感兴趣。

我很想知道是否有人成功地尝试过 - 或不成功 - 并且可以说服或不说服我尝试这个。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T17:23:29.990

大约一年前，我与 GWT 合作过。当时这似乎是一个好主意，但有一些警告：

*   我在 API 的某些部分遇到了“陷阱”问题，这可能与您像在 Java 中一样进行编码的事实有关，而实际上您实际上是在为一个像 Java 一样的单独编译的环境编写代码，所以你做了一些不正确的假设（在这种情况下，将嵌套值传递给前端）。我认为还有另一个是重写我的 ant 脚本以使用 32 位 jvm 进行 gwt 编译。
*   我花了一些时间试图调整外观——我们从未部署完成的项目，所以我不确定要达到专业水平需要做多少工作，但它似乎（逻辑上）会是相当于调整一个摇摆界面。在视觉上，可能比 html 更笨拙。
*   因为在最终产品中 ajax 对你来说是如此隐蔽，所以我担心如果性能不佳我可能会做什么。

话虽如此，它似乎绝对值得一玩，而且我的经历是很久很久以前的互联网时代，特别是考虑到它现在可能更加成熟。还值得指出的是，这是从大多数 MVC 框架开发 GUI 代码的一种非常不同（且令人耳目一新）的方式，如果没有其他原因，值得一看。

我的感觉是，如果您正在构建一个对图形要求非常苛刻的高负载专业站点，GWT 可能不是一个好的选择，否则还可以。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-14T05:36:01.383

您提到 GWT 将处理表示层。你也会用 Java 做业务层吗？如果是这种情况，我想向您介绍[IT Mill Toolkit](http://itmill.com)，它正是这样做的：它是一个使用 GWT 呈现其 GUI 组件的工具包，允许您完全用 Java 来完成您的应用程序。我认为它试图创造的术语是“服务器驱动的 RIA”。

我来自 PHP 背景，但很快就喜欢上了这个工具包。不过我还是不要多说，让你自己做决定可能会更好。

*Disclamer：我确实在 IT Mill 工作，尽管这与我的观点无关。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T16:52:41.810

GWT 相对较新。随着代码库的增长，编译过程往往会变得有点慢。当我们使用它时，我们发现更复杂的小部件的布局和渲染存在许多问题，并且模拟器的行为与真实服务器完全不同。此外，对于从右到左的语言，我们在 i18n 上遇到了麻烦......

总而言之，GWT 存在（通常？）年轻技术的问题。但是，它确实使某些事情变得非常容易，例如您命名的 Ajaxifying。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-14T05:13:18.800

我们已经为一个非常大的项目做到了这一点，只要您知道它的局限性、优势和劣势，它就可以很好地工作。有趣的是，演示是我们最省事的，因为我们只是像处理任何其他 HTML 页面一样使用 CSS 对其进行了皮肤处理。该项目上线，运行完美，所以我没有抱怨。

我发现的陷阱你可以在这里找到：

[最大的 GWT 陷阱？](https://stackoverflow.com/questions/99866/biggest-gwt-pitfalls/99977#99977)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-19T19:37:20.347

我们开发了一个大型 HR Portal 应用程序，整个表示层在 GWT 中完成。后端是Spring。一切都运行良好，用户界面非常受用户欢迎。非常重要的是，我们很容易添加新功能和维护应用程序。我认为使用 Javascript 库做一些可比较和可维护的事情要困难得多。

您确实需要某种客户端框架，否则您最终会编写一个（就像我们一样！）：我们的应用程序构建在[GWT Portlets](http://code.google.com/p/gwtportlets/)（免费和开源）之上。

我们使用 HTML 片段为不同部署的应用程序设计皮肤，每个“页面”的布局都存储在 XML 文件中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-14T05:56:39.460

关于这个 raible 视频的一些很好的信息：[http ://raibledesigns.com/rd/entry/my_drunk_on_software_interview](http://raibledesigns.com/rd/entry/my_drunk_on_software_interview)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2014-09-03T18:40:09.807

GWT 本身就是一个 UI 增强库，而不是一个框架。如果您将它与 Google App Engine 一起使用，那么您就有了一个基本框架。（这是一个不同的故事，当我看到它时，我决定不将它包含在我们的架构中）。

这是一个很棒的图书馆，我们用它做了一些了不起的事情。然而，由于它是一个库，它只能在您的架构允许的范围内发挥作用。

就 ANT 而言，64 位编译器没有问题。

<java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler" dir="${dir.GWTCompile}"> <-- dir.GWTCompile 是包含 GWT 的目录 --> <classpath> 类路径 </classpath> <jvmarg value="-${gwt.maxMem}"/> <arg value="@{gwt.baseModule}" /> <arg value="DEBUG" /> <arg value= “-严格” /> </java>

至于生成的代码，如果您想查看它，它就在您的战争中。（它也是开源的，所以你可以在那里查看。）

GWT 在编译过程中所做的事情：它为不同的浏览器集创建了多个 JS 库副本（一个可能需要几分钟编译的原因），您可以根据需要添加/删除这些。这减少了需要下载的 JS 包并提高了速度，因为它不必有那些讨厌的 if (EI) this else if (FF) that。但是，当您进行本地调试（至少在 Eclipse 中）时，您不必等待，允许将其留给构建服务器（或者当您需要手动构建和部署时（尼安德特人））。

GWT 的缺点。由于它是一个 javascript 客户端（几乎完全是），因此您不能将它用于不支持它或支持其中一个版本的东西。因此，对于 iPad 和 iPhone 之类的东西，如果您不使用旨在弥合这些差距的其他库（例如 mgwt），您可能会遇到一些问题。

# .net - Where is Message defined in .Net, using the Compact Framework?

> ID：744519
> 
> 赞同：1
> 
> 时间：2009-04-13T16:41:11.637
> 
> 标签：.net, winforms, compact-framework

Should be an easy question, so don't all pile on -

I'm trying to override WndProc like this:

```
using System;
using System.Collections.Generic;
using System.Collections;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using System.IO; 
```

snip...

```
public class GTextBox : TextBox
{
    protected override void WndProc(ref Message m) 
```

and I get this error:

error CS0246: The type or namespace name 'Message' could not be found (are you missing a using directive or an assembly reference?)

I've poked around a little but I don't see how to find out where Message is defined? Any hints?

**Update:** "using System.Windows.Forms" is in the file, and I have checked the DLL reference. Hmm... probably time to re-boot for good luck?

**Update 2:** My Bad! - I am using the Compact Framework, and it does not allow direct access to the Message structure. Ouch - should have put that in my original question

**Update 3:** Excellent article on CF and WndProc handling [http://msdn.microsoft.com/en-us/magazine/cc188736.aspx](http://msdn.microsoft.com/en-us/magazine/cc188736.aspx)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T16:42:26.500

The `Message` struct is in the `System.Windows.Forms` namespace and assembly.

[http://msdn.microsoft.com/en-us/library/system.windows.forms.message.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.message.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T16:43:36.840

I believe it's "System.Windows.Forms.Message." I'm not sure why you're getting that error, it looks like you're "using System.Windows.Forms;".

Maybe the DLL reference got deleted?

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T16:44:49.207

Took a bit of a creative google search but:

[http://msdn.microsoft.com/en-us/library/system.windows.forms.message.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.message.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T18:33:01.397

它在[Microsoft.WindowsCE.Forms 命名空间](http://msdn.microsoft.com/en-us/library/microsoft.windowsce.forms.message.aspx)中公开可用。您需要添加对程序集的引用。

# hibernate - 如何更改 JPA 中的实体类型？

> ID：744520
> 
> 赞同：10
> 
> 时间：2009-04-13T16:41:13.163
> 
> 标签：hibernate, jpa, transactions, entitymanager

在我的具体情况下，我正在使用鉴别器列策略。这意味着我的 JPA 实现（Hibernate）创建了一个带有特殊*DTYPE*列的*用户表。*此列包含实体的类名。例如，我的*users*表可以有**TrialUser**和**PayingUser**的子类。这些类名将在*DTYPE*列中，以便 EntityManager 从数据库加载实体时，它知道要实例化哪种类型的类。

 *******我尝试了两种转换实体类型的方法，都感觉像肮脏的黑客：

1.  使用本机查询手动对列执行更新，更改其值。这适用于属性约束相似的实体。
2.  创建目标类型的新实体，执行*BeanUtils.copyProperties()*调用以移动属性，保存新实体，然后调用命名查询，该查询手动将新 Id 替换为旧 Id，以便所有外键约束得到维护。

#1 的问题是，当您手动更改此列时，JPA 不知道如何将此实体刷新/重新附加到持久性上下文。它需要一个ID 为 1234 的**TrialUser**，而不是一个 ID 为 1234 的**PayingUser**。它失败了。在这里，我可能会做一个 EntityManager.clear() 并分离所有实体/清除 Per。上下文，但由于这是一个服务 bean，它会擦除​​系统所有用户的未决更改。

#2 的问题是，当您删除**TrialUser**时，您设置为 Cascade=ALL 的所有属性也将被删除。这很糟糕，因为您只是试图交换不同的用户，而不是删除所有扩展对象图。

***更新 1***：#2 的问题使我几乎无法使用它，所以我放弃了尝试让它工作。更优雅的 hack 绝对是 #1，我在这方面取得了一些进展。关键是首先获取对底层 Hibernate Session 的引用（如果您使用 Hibernate 作为 JPA 实现）并调用 Session.evict(user) 方法从持久性上下文中仅删除该单个对象。不幸的是，没有纯粹的 JPA 支持。这是一些示例代码：

```
 // Make sure we save any pending changes
  user = saveUser(user);

  // Remove the User instance from the persistence context
  final Session session = (Session) entityManager.getDelegate();
  session.evict(user);

  // Update the DTYPE
  final String sqlString = "update user set user.DTYPE = '" + targetClass.getSimpleName() + "' where user.id = :id";
  final Query query = entityManager.createNativeQuery(sqlString);
  query.setParameter("id", user.getId());
  query.executeUpdate();

  entityManager.flush();   // *** PROBLEM HERE ***

  // Load the User with its new type
  return getUserById(userId); 
```

请注意引发此异常的手动**flush() ：**

```
org.hibernate.PersistentObjectException: detached entity passed to persist: com.myapp.domain.Membership
at org.hibernate.event.def.DefaultPersistEventListener.onPersist(DefaultPersistEventListener.java:102)
at org.hibernate.impl.SessionImpl.firePersistOnFlush(SessionImpl.java:671)
at org.hibernate.impl.SessionImpl.persistOnFlush(SessionImpl.java:663)
at org.hibernate.engine.CascadingAction$9.cascade(CascadingAction.java:346)
at org.hibernate.engine.Cascade.cascadeToOne(Cascade.java:291)
at org.hibernate.engine.Cascade.cascadeAssociation(Cascade.java:239)
at org.hibernate.engine.Cascade.cascadeProperty(Cascade.java:192)
at org.hibernate.engine.Cascade.cascadeCollectionElements(Cascade.java:319)
at org.hibernate.engine.Cascade.cascadeCollection(Cascade.java:265)
at org.hibernate.engine.Cascade.cascadeAssociation(Cascade.java:242)
at org.hibernate.engine.Cascade.cascadeProperty(Cascade.java:192)
at org.hibernate.engine.Cascade.cascade(Cascade.java:153)
at org.hibernate.event.def.AbstractFlushingEventListener.cascadeOnFlush(AbstractFlushingEventListener.java:154)
at org.hibernate.event.def.AbstractFlushingEventListener.prepareEntityFlushes(AbstractFlushingEventListener.java:145)
at org.hibernate.event.def.AbstractFlushingEventListener.flushEverythingToExecutions(AbstractFlushingEventListener.java:88)
at org.hibernate.event.def.DefaultAutoFlushEventListener.onAutoFlush(DefaultAutoFlushEventListener.java:58)
at org.hibernate.impl.SessionImpl.autoFlushIfRequired(SessionImpl.java:996)
at org.hibernate.impl.SessionImpl.executeNativeUpdate(SessionImpl.java:1185)
at org.hibernate.impl.SQLQueryImpl.executeUpdate(SQLQueryImpl.java:357)
at org.hibernate.ejb.QueryImpl.executeUpdate(QueryImpl.java:51)
at com.myapp.repository.user.JpaUserRepository.convertUserType(JpaUserRepository.java:107) 
```

您可以看到**User**具有 OneToMany 集的**Membership**实体导致了一些问题。我对幕后发生的事情知之甚少，无法破解这个坚果。

 *****更新 2***：到目前为止唯一有效的方法是更改​​ DTYPE，如上面的代码所示，然后调用**entityManager.clear()**

我不完全理解清除整个持久性上下文的后果，我希望让**Session.evict()**处理正在更新的特定实体。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T15:47:17.647

所以我终于想出了一个可行的解决方案：

放弃**EntityManager**以更新*DTYPE*。这主要是因为**Query.executeUpdate()**必须在事务中运行。您可以尝试在现有事务中运行它，但这可能与您正在修改的实体的相同持久性上下文相关联。这意味着在更新*DTYPE*之后，您必须找到一种方法来**evict()**实体。最简单的方法是调用**entityManager.clear()**，但这会导致各种副作用（请参阅 JPA 规范）。更好的解决方案是获取底层委托（在我的例子中，一个 Hibernate **Session**）并调用**Session.evict(user)**. 这可能适用于简单的域图，但我的非常复杂。我永远无法让**@Cascade(CascadeType.EVICT)**与我现有的 JPA 注释一起正常工作，例如**@OneToOne(cascade = CascadeType.ALL)**。我还尝试手动将我的域图传递给**Session**并让每个父实体驱逐其子实体。由于未知原因，这也不起作用。

我处于只有**entityManager.clear()**可以工作的情况，但我不能接受副作用。然后我尝试为实体转换创建一个单独的持久性单元。我想我可以将**clear()**操作本地化到只负责转换的那台 PC。我为它设置了一个新的 PC，一个新的对应**EntityManagerFactory**，一个新的事务管理器，并手动将此事务管理器注入到存储库中，以便将**executeUpdate()**手动包装到与正确 PC 对应的事务中。在这里我不得不说我对 Spring/JPA 容器管理的事务了解不够，因为它最终成为了一场噩梦，试图获取本地/手动事务**executeUpdate()**可以很好地处理从服务层拉入的容器管理事务。

在这一点上，我扔掉了所有东西并创建了这个类：

```
@Transactional(propagation = Propagation.NOT_SUPPORTED)
public class JdbcUserConversionRepository implements UserConversionRepository {

@Resource
private UserService userService;

private JdbcTemplate jdbcTemplate;

@Override
@SuppressWarnings("unchecked")
public User convertUserType(final User user, final Class targetClass) {

        // Update the DTYPE
        jdbcTemplate.update("update user set user.DTYPE = ? where user.id = ?", new Object[] { targetClass.getSimpleName(), user.getId() });

        // Before we try to load our converted User back into the Persistence
        // Context, we need to remove them from the PC so the EntityManager
        // doesn't try to load the cached one in the PC. Keep in mind that all
        // of the child Entities of this User will remain in the PC. This would
        // normally cause a problem when the PC is flushed, throwing a detached
        // entity exception. In this specific case, we return a new User
        // reference which replaces the old one. This means if we just evict the
        // User, then remove all references to it, the PC will not be able to
        // drill down into the children and try to persist them.
        userService.evictUser(user);

        // Reload the converted User into the Persistence Context
        return userService.getUserById(user.getId());
    }

    public void setDataSource(final DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }
} 
```

我相信这种方法有两个重要部分可以使它起作用：

1.  我用**@Transactional(propagation = Propagation.NOT_SUPPORTED)**对其进行了标记， 它应该暂停来自服务层的容器管理事务，并允许在PC外部进行转换。
2.  在尝试将转换后的实体重新加载回 PC 之前，我使用**userService.evictUser(user); 逐出当前存储在 PC 中的旧副本；**. 用于此的代码只是获取一个**Session**实例并调用**evict(user)**。有关更多详细信息，请参阅代码中的注释，但基本上，如果我们不这样做，任何对**getUser**的调用都会尝试返回仍在 PC 中的缓存实体，但它会抛出关于类型不同的错误。

虽然我最初的测试进展顺利，但这个解决方案可能仍然存在一些问题。当它们被发现时，我会保持更新。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-14T19:18:46.380

您真的需要在 User 类型中表示订阅级别吗？为什么不在系统中添加订阅类型？

然后，该关系将表示为：用户有一个订阅。如果您希望保留订阅历史，也可以将其建模为一对多关系。

然后，当您想要更改用户的订阅级别时，您将创建一个新订阅并将其分配给用户，而不是实例化一个新用户。

```
// When you user signs up
User.setSubscription(new FreeSubscription());

// When he upgrades to a paying account
User.setSubscription(new PayingSubscription()); 
```

TrialUser 真的与 PayingUser 不同吗？可能不是。聚合而不是继承会更好地为您服务。

订阅数据可以存储在单独的表中（映射为实体），也可以存储在用户表中（映射为组件）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-16T17:58:02.313

这个问题与 Java 的关系比其他任何东西都多。您不能更改实例的运行时类型（在运行时），因此 hibernate 不提供这种场景（例如，与 rails 不同）。

如果您想从会话中逐出用户，则必须逐出关联实体。你有一些选择：

*   使用 evict=cascade 映射实体（参见[Session#evict](http://www.hibernate.org/hib_docs/v3/api/org/hibernate/Session.html#evict(java.lang.Object)) javadoc）
*   手动驱逐所有关联的实体（这可能很麻烦）
*   清除会话，从而驱逐所有实体（当然，您将丢失本地会话缓存）

我在 grails 中遇到过类似的问题，我的解决方案类似于**grigory 的**解决方案。我复制所有实例字段，包括关联的实体，然后删除旧实体并写入新实体。如果您没有那么多关系，这很容易，但是如果您的数据模型很复杂，那么最好使用您描述的本机 sql 解决方案。

以下是来源，如果您有兴趣：

```
def convertToPacient = {
    withPerson(params.id) {person ->
      def pacient = new Pacient()
      pacient.properties = person.properties
      pacient.id = null
      pacient.processNumber = params.processNumber
      def ap = new Appointment(params)
      pacient.addToAppointments(ap);

      Person.withTransaction {tx ->
        if (pacient.validate() && !pacient.hasErrors()) {

          //to avoid the "Found two representations of same collection" error
          //pacient.attachments = new HashSet(person.attachments);
          //pacient.memberships = new HashSet(person.memberships);
          def groups = person?.memberships?.collect {m -> Group.get(m.group.id)}
          def attachs = []
          person.attachments.each {a ->
            def att = new Attachment()
            att.properties = a.properties
            attachs << att
          }

          //need an in in order to add the person to a group
          person.delete(flush: true)
          pacient.save(flush: true)
          groups.each {g -> pacient.addToGroup(g)};
          attachs.each {a -> pacient.addToAttachments(a)}
          //pacient.attachments.each {att -> att.id = null; att.version = null; att.person = pacient};

          if (!pacient.save()) {
            tx.setRollbackOnly()
            return
          }
        }
      } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-08T23:10:10.377

> 这个问题与 Java 的关系比其他任何东西都多。您不能更改实例的运行时类型（在运行时），因此 hibernate 不提供这种场景（例如，与 rails 不同）。

我遇到这篇文章是因为我（或认为我是）有类似的问题。我开始相信问题不在于技术中改变类型的机制，而是一般来说改变类型并不容易或直接。问题是类型通常具有不同的属性。除非您仅针对行为差异映射到不同类型，否则不清楚如何处理附加信息。因此，基于新对象的构造迁移类型是有意义的。

问题与“Java 无关”。它通常与类型论有关，更具体地说与对象关系映射有关。如果您的语言支持打字，我很想听听您如何在运行时自动更改对象的类型，并神奇地利用剩余信息智能地做一些事情。只要我们在传播 FUD：当心你从谁那里得到建议：Rails 是一种框架，Ruby 是一种语言。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-13T17:24:27.740

当您说转换时，您可能歪曲了问题。在我看来，您真正想做的是基于另一个类的实例构造一个类的实例，例如：

```
public PayingUser(TrialUser theUser) {
...
} 
```

然后您可以删除旧的试用用户并保留新的付费用户。

# jquery - jquery 属性选择器找不到属性

> ID：744523
> 
> 赞同：6
> 
> 时间：2009-04-13T16:41:38.920
> 
> 标签：jquery, attributes, css-selectors, css

我需要重新[问](https://stackoverflow.com/questions/742964/attributes-not-selectable-by-jquery-attribute-selector)我的老问题，我可能不应该在凌晨 1 点问它：P

似乎使用 jquery 的属性选择器找不到某些属性：

```
$("*[some=value]"); 
```

到目前为止，我似乎无法使用表单的 action 属性和 img 的 src 属性。是否有一个属性列表不起作用，所以我可以为它们编写自定义选择器？

再次感谢！

* * *

**编辑：** 似乎没有人相信某些选择器不能按预期工作。看这个例子：在[这个网站](http://dogself.com/telluriumTest/index2.htm)（上面有 jquery 1.3 用于 firebugging）有一个看起来像这样的表单：

```
<form style="display: inline;" method="get" action="list"> 
```

（它在“搜索当前下载”下拉列表中）。如果您打开 firebug 并尝试使用此选择器：

```
$("form[action=list]"); 
```

您将无法选择表格。action 属性没有什么特别之处。该页面上徽标图像的 src 也是如此：

```
<img alt="Logo" src="/p/aost/logo?logo_id=1238551994"/> 
```

不起作用的选择器是：

```
$("img[src=/p/aost/logo?logo_id=1238551994"); 
```

当然，我可以进行通配符匹配，这不是我所追求的。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-13T17:04:44.153

没有不受支持的属性的“列表”，因为不应该有；这是 jQuery 中的一个错误。

以下是这方面的公开门票：

*   [无法使用 action 属性选择表单](http://dev.jquery.com/ticket/3245)
*   [吸引表单的“动作”和选择器的属性过滤器](http://dev.jquery.com/ticket/2662)
*   [属性“src”的选择器与 1.2.6 中的工作方式不同](http://dev.jquery.com/ticket/4244)

Apparently the common denominator between the bugs is that jQuery is comparing the selector string you specify against the full URL as opposed to the actual action/src attribute as it is defined in the HTML. This explains why the [attributeEndsWith](http://docs.jquery.com/Selectors/attributeEndsWith#attributevalue) or the [attributeContains](http://docs.jquery.com/Selectors/attributeContains#attributevalue) selectors do work in this case.

I would recommend just giving the form/image a class/ID and getting it over with.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T16:49:38.120

这完全取决于您使用的 jQuery 版本。

在 1.3 之前，您可以使用 @ 表示法：

```
$("*[@name=value]") 
```

所以也许添加@会有所帮助。

除此之外，您应该输入与标记中定义的**完全相同**的属性值- 例如，如果您尝试使用 查找图像`src="http://example.com/dog.jpg"`，请不要这样做，因为它不起作用：

```
$("img[src=dog.jpg") 
```

因为它将尝试查找 src**等于**“dog.jpg”的图像，而不包含它。

如果您想搜索仅定义部分属性的属性，我建议您阅读[jQuery API 选择器](http://docs.jquery.com/Selectors)页面。例如，要获取所有**包含** “dog.jpg”的 src 图像，您可以使用：

```
$("img[src*=dog.jpg]") 
```

同样，您可以找到其属性以特定值/字符串开头或结尾的元素。

# c# - TripleDES：指定的密钥是“TripleDES”的已知弱密钥，不能使用

> ID：744530
> 
> 赞同：12
> 
> 时间：2009-04-13T16:43:58.010
> 
> 标签：c#, .net, cryptography, cryptographicexception

我正在使用 .NET 3.0 类`System.Security.Cryptography.MACTripleDES`生成 MAC 值。不幸的是，我正在使用使用“ `1111111111111111`”（作为十六进制）作为单长度 DES 密钥的硬件设备。如果您尝试使用加密弱密钥，该`System.Security.Cryptography`库会对密钥进行一些完整性检查并返回异常。

例如：

```
byte[] key = new byte[24];
for (int i = 0; i < key.Length; i++)
  key[i] = 0x11;

byte[] data = new byte[] { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
byte[] computedMac = null;
using (MACTripleDES mac = new MACTripleDES(key))
{
  computedMac = mac.ComputeHash(data);
} 
```

抛出异常

```
System.Security.Cryptography.CryptographicException : Specified key is a known weak key for 'TripleDES' and cannot be used. 
```

我知道这不是安全密钥。在生产中，设备将使用新的安全密钥进行闪存。同时，有什么方法可以抑制这个异常被抛出？也许是`app.config`或注册表设置？

编辑：密钥实际上是 101010... 由于算法强制奇校验。我不确定这是否适用于 DES 算法，或者只是我所做的支付处理工作中的一个要求。

编辑 2：Daniel 在下面的回答有一些关于黑客 .NET 的非常好的信息。不幸的是，我无法使用这种技术解决我的问题，但仍然有一些有趣的阅读。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T17:16:13.923

我不会真的推荐它，但您应该能够修改使用[Reflector](http://sebastien.lebreton.free.fr/reflexil/)和[插件 ReflexIL检查弱键的 IL 代码](https://www.red-gate.com/products/dotnet-development/reflector/)

编辑：

抱歉，我花了一段时间才将所有内容加载到我的虚拟机（运行 Ubuntu）中，并且不想弄乱 Mono。

*   安装 ReflexIL 插件：查看 -> 插件 -> 添加
*   打开 ReflexIL：工具 -> ReflexIL v0.9
*   找到 IsWeakKey() 函数。（您可以使用搜索：F3）
*   会出现两个函数，双击 System.Security.Cryptography.TripleDES 中的那个
*   ReflexIL 也应该出现。在 Instructions 选项卡中，一直向下滚动到第 29 行（偏移量 63）。
*   将 ldc.i4.1 更改为 ldc.i4.0，这意味着该函数将始终返回 false。

在您的程序集窗格（左侧）中，您现在可以向上滚动并单击“公共语言运行时库”，ReflexIL 窗格将为您提供保存它的选项。

重要笔记：

*   首先备份您的原始程序集！(mscorlib.dll)
*   mscorlib.dll 是一个签名程序集，您需要 ReflexIL 的 .NET SDK（sn.exe 工具）使其跳过验证。我刚刚自己检查了这个，你应该已经安装了 Visual C#。只需在被要求时单击“注册它以跳过验证（在此计算机上）”。
*   我想我不必告诉你只能在你的开发机器上使用它:)

祝你好运！如果您需要其他说明，请随时使用评论框。

编辑2：

我很困惑！

[![](https://i.stack.imgur.com/Uizi9.png)](http://i44.tinypic.com/2r6fwbo.png)

我从 mscorlib 程序集中的 set_Key 函数中完全删除了 IsWeakKey 检查。我绝对确定我修改了正确的功能，并且我做得正确。Reflector 的反汇编程序不再显示该检查。然而有趣的是，Visual C# 仍然抛出同样的异常。

这让我相信 mscorlib 必须以某种方式仍然缓存在某个地方。但是，将 mscorlib.dll 重命名为 mscorlib.dll_ 会导致 MSVC# 崩溃，因此它必须仍然依赖于原始 dll。

这是非常有趣的东西，但我想我已经到了不知道发生了什么的地步，这没有任何意义！见附图。:(

编辑3：

我在 Olly 中注意到，与 mscoree、mscorsec 和 mscorwks 等程序集不同；mscorlib.dll 实际上并不位于：c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\

但相反，在似乎不存在的位置：C:\WINDOWS\assembly\NativeImages_v2.0.50727_32\mscorlib\6d667f19d687361886990f3ca0f49816\mscorlib.ni.dll

我想我在这里遗漏了一些东西:) 将对此进行更多调查。

编辑4：

即使修补了 IsWeakKey 中的所有内容，并使用“ngen.exe”删除和生成 mscorlib.dll 的新本机映像 ( **x.ni** .dll)，我也遇到了同样的异常。我必须指出，即使在卸载本机 mscorlib 映像后，它仍在使用 mscorlib.ni.dll ......嗯。

我放弃。我希望有人能够回答到底发生了什么，因为我当然不知道。:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-14T20:58:22.023

我发现你需要做什么。幸运的是，有一种方法可以创建不检查弱密钥的 ICryptoTranforms。您还需要注意基类，因为它也会进行完整性检查。通过反射简单地调用 _NewEncryptor 方法（你需要做更多的反射，但这就是想法）。

幸运的是 MACTripleDES 有一个 TripleDES 类型的字段，因此从 MACTripleDES 派生并通过构造函数中的反射替换它。我已经为你完成了所有的工作。

我无法验证是否生成了正确的 MAC，但不会引发异常。此外，您可能希望对代码进行文档注释并进行异常处理（反射失败 - 例如，如果字段/方法不存在） - 但这是如此；所以我没有打扰。

```
using System;
using System.Reflection;
using System.Security.Cryptography;
using System.IO;

namespace DesHack
{
    class Program
    {
        static void Main(string[] args)
        {
            byte[] key = new byte[24];
            for (int i = 0; i < key.Length; i++)
                key[i] = 0x11;

            byte[] data = new byte[] { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
            byte[] computedMac = null;
            using (MACTripleDES mac = new MACTripleDESHack(key))
            {
                computedMac = mac.ComputeHash(data);
            }
        }
    }

    class MACTripleDESHack : MACTripleDES
    {
        TripleDES _desHack = new DesHack();

        static FieldInfo _cspField = typeof(MACTripleDES).GetField("des", BindingFlags.Instance | BindingFlags.NonPublic);

        public MACTripleDESHack()
            : base()
        {
            RewireDes();
        }

        public MACTripleDESHack(byte[] rgbKey)
            : base(rgbKey)
        {
            RewireDes();
        }

        private void RewireDes()
        {
            _cspField.SetValue(this, _desHack);
        }

    }

    class DesHack : TripleDES
    {
        TripleDESCryptoServiceProvider _backing = new TripleDESCryptoServiceProvider();

        static MethodInfo _newEncryptor;
        static object _encrypt;
        static object _decrypt;

        public override int BlockSize
        {
            get
            {
                return _backing.BlockSize;
            }
            set
            {
                _backing.BlockSize = value;
            }
        }

        public override int FeedbackSize
        {
            get
            {
                return _backing.FeedbackSize;
            }
            set
            {
                _backing.FeedbackSize = value;
            }
        }

        // For these two we ALSO need to avoid
        // the base class - it also checks
        // for weak keys.
        private byte[] _iv;
        public override byte[] IV
        {
            get
            {
                return _iv;
            }
            set
            {
                _iv = value;
            }
        }

        private byte[] _key;
        public override byte[] Key
        {
            get
            {
                return _key;
            }
            set
            {
                _key = value;
            }
        }

        public override int KeySize
        {
            get
            {
                return _backing.KeySize;
            }
            set
            {
                _backing.KeySize = value;
            }
        }

        public override KeySizes[] LegalBlockSizes
        {
            get
            {
                return _backing.LegalBlockSizes;
            }
        }

        public override KeySizes[] LegalKeySizes
        {
            get
            {
                return _backing.LegalKeySizes;
            }
        }

        public override CipherMode Mode
        {
            get
            {
                return _backing.Mode;
            }
            set
            {
                _backing.Mode = value;
            }
        }

        public override PaddingMode Padding
        {
            get
            {
                return _backing.Padding;
            }
            set
            {
                _backing.Padding = value;
            }
        }

        static DesHack()
        {
            _encrypt = typeof(object).Assembly.GetType("System.Security.Cryptography.CryptoAPITransformMode").GetField("Encrypt").GetValue(null);
            _decrypt = typeof(object).Assembly.GetType("System.Security.Cryptography.CryptoAPITransformMode").GetField("Decrypt").GetValue(null);
            _newEncryptor = typeof(TripleDESCryptoServiceProvider).GetMethod("_NewEncryptor", BindingFlags.NonPublic | BindingFlags.Instance);
        }

        public DesHack()
        {            
        }

        public override ICryptoTransform CreateDecryptor()
        {
            return CreateDecryptor(_key, _iv);
        }

        public override ICryptoTransform CreateEncryptor()
        {
            return CreateEncryptor(_key, _iv);
        }

        public override ICryptoTransform CreateDecryptor(byte[] rgbKey, byte[] rgbIV)
        {
            // return this._NewEncryptor(rgbKey, base.ModeValue, rgbIV, base.FeedbackSizeValue, CryptoAPITransformMode.Decrypt);
            return (ICryptoTransform) _newEncryptor.Invoke(_backing,
                new object[] { rgbKey, ModeValue, rgbIV, FeedbackSizeValue, _decrypt });
        }

        public override ICryptoTransform CreateEncryptor(byte[] rgbKey, byte[] rgbIV)
        {
            // return this._NewEncryptor(rgbKey, base.ModeValue, rgbIV, base.FeedbackSizeValue, CryptoAPITransformMode.Encrypt);
            return (ICryptoTransform) _newEncryptor.Invoke(_backing,
                new object[] { rgbKey, ModeValue, rgbIV, FeedbackSizeValue, _encrypt });
        }

        public override void GenerateIV()
        {
            _backing.GenerateIV();
        }

        public override void GenerateKey()
        {
            _backing.GenerateKey();
        }

        protected override void Dispose(bool disposing)
        {
            if (disposing)
                ((IDisposable) _backing).Dispose();
            base.Dispose(disposing);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T17:11:35.167

不幸的是，该行为不能被覆盖。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-14T13:58:57.710

[您可以在DESCryptoServiceProvider](http://msdn.microsoft.com/en-us/library/system.security.cryptography.descryptoserviceprovider.aspx)之上自己实现 CBC-MAC，而不是使用 MACTripleDES 和重复的 DES 密钥来伪造单个 DES CBC-MAC 。

<1111111111111111> 不是弱 DES 密钥。

这将计算 DES CBC-MAC：

```
public static byte[] CalcDesMac(byte[] key, byte[] data){
        DESCryptoServiceProvider des = new DESCryptoServiceProvider();
        des.Key = key;
        des.IV = new byte[8];
        des.Padding = PaddingMode.Zeros;
        MemoryStream ms = new MemoryStream();
        using(CryptoStream cs = new CryptoStream(ms, des.CreateEncryptor(), CryptoStreamMode.Write)){
          cs.Write(data, 0, data.Length);
        }
        byte[] encryption = ms.ToArray();
        byte[] mac = new byte[8];
        Array.Copy(encryption, encryption.Length-8, mac, 0, 8);
        PrintByteArray(encryption);
        return mac;
    } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-14T10:14:32.260

在 MSDN 论坛中有一个很好的建议使用[反射](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/8fdfcce7-3a8a-4271-8557-3df715c80df8)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T18:47:23.703

我不是安全专家，但用另一个值异或你的密钥是否足以满足完整性检查？您可以为您的调试版本（使用适当的 IFDEF）执行此操作，以便您可以为密钥足够强大的发布或生产版本进行适当的检查并删除它。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-11-29T17:01:05.713

基于反射的解决方案可以帮助您解决问题，但它们是肮脏和邪恶的。还没有人提到一个非常有用的方法：`TripleDES.IsWeakKey`

我遇到了这个问题，并使用一个非常简单的实用程序解决了这个问题，我在我的 CryptoServiceProvider 上设置密钥之前立即使用该实用程序：

```
private void MakeSecureKey(byte[] key)
{
    while(TripleDES.IsWeakKey(key))
    {
        var sha = SHA256Managed.Create().ComputeHash(key);
        Array.Copy(sha,key,key.Length);
    }
} 
```

如果您在制作加密器或解密器时调用它，它应该可以防止崩溃并始终为您提供安全密钥。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-08-20T08:43:22.043

很简单（从 GitHub 上查看代码后）

静态 bool TripleDES.IsWeakKey(Byte[] rgbKey)

由于它是静态的 - 很容易针对它测试您的密钥

1.  大小必须是 16 或 24 字节 (???) 为什么他们不能把它放在文档中
2.  代码检查几个简单的重复只需创建随机的足够值

参见代码：[https ://github.com/mono/mono/blob/master/mcs/class/corlib/System.Security.Cryptography/TripleDES.cs](https://github.com/mono/mono/blob/master/mcs/class/corlib/System.Security.Cryptography/TripleDES.cs)

德克尔

# python - Getting TTFB (time till first byte) for an HTTP Request

> ID：744532
> 
> 赞同：7
> 
> 时间：2009-04-13T16:44:06.650
> 
> 标签：python, http, urllib2

Here is a python script that loads a url and captures response time:

```
import urllib2
import time

opener = urllib2.build_opener()
request = urllib2.Request('http://example.com')

start = time.time()
resp = opener.open(request)
resp.read()
ttlb = time.time() - start 
```

Since my timer is wrapped around the whole request/response (including read()), this will give me the TTLB (time to last byte).

I would also like to get the TTFB (time to first byte), but am not sure where to start/stop my timing. Is urllib2 granular enough for me to add TTFB timers? If so, where would they go?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2016-08-12T10:21:47.343

你应该使用`pycurl`，而不是`urllib2`

1.  install `pyCurl`：
    您可以使用 pip / easy_install，或从源代码安装。

    easy_install pyCurl

    也许你应该是一个超级用户。

2.  用法：

    ```
    import pycurl
    import sys 
    import json

    WEB_SITES = sys.argv[1]

    def main():
        c = pycurl.Curl()
        c.setopt(pycurl.URL, WEB_SITES)              #set url
        c.setopt(pycurl.FOLLOWLOCATION, 1)  
        content = c.perform()                        #execute 
        dns_time = c.getinfo(pycurl.NAMELOOKUP_TIME) #DNS time
        conn_time = c.getinfo(pycurl.CONNECT_TIME)   #TCP/IP 3-way handshaking time
        starttransfer_time = c.getinfo(pycurl.STARTTRANSFER_TIME)  #time-to-first-byte time
        total_time = c.getinfo(pycurl.TOTAL_TIME)  #last requst time
        c.close()

        data = json.dumps({'dns_time':dns_time,         
                           'conn_time':conn_time,        
                           'starttransfer_time':starttransfer_time,    
                           'total_time':total_time})
        return data

    if __name__ == "__main__":    
        print main() 
    ```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T16:51:11.267

Using your current `open` / `read` pair there's only one other timing point possible - between the two.

The `open()` call should be responsible for actually sending the HTTP request, and should (AFAIK) return as soon as that has been sent, ready for your application to actually read the response via `read()`.

Technically it's probably the case that a long server response would make your application block on the call to `read()`, in which case this isn't TTFB.

However if the amount of data is small then there won't be much difference between TTFB and TTLB anyway. For a large amount of data, just measure how long it takes for `read()` to return the first smallest possible chunk.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-14T10:12:53.310

要获得良好的接近度，您必须阅读（1）。并打乱时间。

它对我来说效果很好。您应该记住的唯一一件事是：python 可能会在调用 read(1) 时加载超过一个字节。取决于它的内部缓冲区。但我认为大多数工具的行为都会不准确。

```
import urllib2
import time

opener = urllib2.build_opener()
request = urllib2.Request('http://example.com')

start = time.time()
resp = opener.open(request)
# read one byte
resp.read(1)
ttfb = time.time() - start
# read the rest
resp.read()
ttlb = time.time() - start 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T17:27:51.693

默认情况下，在 urllib2 中的 HTTP 打开的实现在读取时没有回调。HTTP 协议的 OOTB 打开器是`urllib2.HTTPHandler`，它用于`httplib.HTTPResponse`通过套接字进行实际读取。

理论上，您可以编写自己的 HTTPResponse 和 HTTPHandler 子类，并使用[install_opener](http://docs.python.org/library/urllib2.html)将其作为默认开启程序安装到 urllib2 中。这将是不平凡的，但不是非常痛苦，所以如果您基本上从标准库复制并粘贴当前的 HTTPResponse 实现并调整其中的`begin()`方法以在从套接字开始读取时执行一些处理或回调。

# c# - App_Code 文件夹中的多个文件夹

> ID：744533
> 
> 赞同：3
> 
> 时间：2009-04-13T16:44:07.680
> 
> 标签：c#, .net, asp.net

我在我的 App_Code 文件夹中创建了多个子文件夹来组织我的课程，它似乎工作正常，对此有什么限制吗？

像：

*   应用程序代码
    *   用户界面
        *   文本框
        *   标签

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-09-07T14:57:55.753

我发现[这条](http://msdn.microsoft.com/en-us/library/t990ks23%28v=vs.80%29.aspx)有趣的信息正在寻找有关 App_Code 的信息，所以我想分享一下。

但是，您可以将 Web 应用程序配置为将 App_Code 文件夹的子文件夹视为单独的可编译单元。然后，每个文件夹都可以包含不同编程语言的源代码。通过在 Web.config 文件的编译元素中创建 codeSubDirectories 元素并添加对子文件夹的引用来指定配置。以下示例说明了如何配置名为 VBCode 和 CSCode 的子文件夹以编译为单独的程序集：

```
<compilation debug="false">
    <codeSubDirectories>
        <add directoryName="VBCode" />
        <add directoryName="CSCode" />
    </codeSubDirectories>
</compilation> 
```

对 VBCode 和 CSCode 子文件夹的引用不需要包含有关子文件夹中包含的编程语言的任何信息。与 App_Code 文件夹本身一样，ASP.NET 根据子文件夹中的文件推断要使用的编译器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T16:47:29.763

我不相信有任何限制。我在很多项目上都做到了这一点，没有任何问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T16:50:47.383

绝对没有限制。子目录只是文件系统分组，您必须手动将命名空间分配给 App_Code 中的所有类。

# c - C数组声明和赋值？

> ID：744536
> 
> 赞同：19
> 
> 时间：2009-04-13T16:45:19.580
> 
> 标签：c, arrays, variable-assignment

我在[这里](https://stackoverflow.com/questions/744477/assignment-and-structs-in-c)问过一个关于结构的类似问题，但我试图弄清楚 C 如何处理诸如分配变量之类的事情，以及如果它们在功能上相同，为什么不允许将它们分配给彼此。

假设我有两个数组：

```
int x[10];  
int y[10]; 
```

为什么 x = y 不能编译？如果它们都是那样的相同“签名”，那么您不应该来回分配它们吗？

我可以以允许我在 C 中这样做的方式声明这些吗？对我来说，你可以做到这一点是有道理的，但也许有办法做到这一点？结构的类型定义似乎是解决方案，数组声明和赋值是否相同？

感谢你们的帮助，我是 Stackoverflow 的新手，但到目前为止它对我来说是一个非常好的资源！

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-13T16:50:40.723

简单地说，数组是不可赋值的。它们是“不可修改的左值”。这当然引出了一个问题：为什么？请参阅此问题以获取更多信息：

[为什么 C++ 支持在结构中按成员分配数组，但通常不支持？](https://stackoverflow.com/questions/3437110/why-does-c-support-memberwise-assignment-of-arrays-within-structs-but-not-gen)

**数组不是指针。** `x`这里*确实*指的是一个数组，尽管在许多情况下，这个“衰减”（隐式转换）为指向其第一个元素的指针。同样，`y`数组的名称也是如此，而不是指针。

您可以在结构中进行数组赋值：

```
struct data {
    int arr[10];
};

struct data x = {/* blah */};
struct data y;
y = x; 
```

但是你不能直接用数组来做。使用`memcpy`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-08-23T17:23:28.897

```
int x [sz];
int *y = x; 
```

这编译并将`y`与`x`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T17:11:04.543

这里的一些消息说数组的名称会产生其第一个元素的地址。这并不总是正确的：

```
#include <stdio.h>

int
main(void)
{
  int array[10];

  /*
   * Print the size of the whole array then the size of a pointer to the
   * first element.
   */
  printf("%u %u\n", (unsigned int)sizeof array, (unsigned int)sizeof &array[0]);

  /*
   * You can take the address of array, which gives you a pointer to the whole
   * array. The difference between ``pointer to array'' and ``pointer to the
   * first element of the array'' matters when you're doing pointer arithmetic.
   */
  printf("%p %p\n", (void*)(&array + 1), (void*)(array + 1));

  return 0;
} 
```

输出：

```
40 4
0xbfbf2ca4 0xbfbf2c80 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T16:50:57.133

为了分配数组，您必须分配数组内的值。

IE。x=y 等价于

```
for(int i = 0; i < 10 < ++i)
{
x[i] = y[i];
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-01T19:16:22.733

为了补充空白的答案，我设计了以下程序：

```
localhost:~ david$ cat test.c
#include <stdlib.h>
#include <stdio.h>
int main (int argc, char * argv [])
{
  struct data {
    int c [2];
  } x, y;
  x.c[0] = x.c[1] = 0;
  y.c[0] = y.c[1] = 1;
  printf("x.c %p %i %i\n", x.c, x.c[0], x.c[1]);
  printf("y.c %p %i %i\n", y.c, y.c[0], y.c[1]);
  x = y;
  printf("x.c %p %i %i\n", x.c, x.c[0], x.c[1]);
  printf("y.c %p %i %i\n", y.c, y.c[0], y.c[1]);

  return 0;
} 
```

执行时，输出如下：

```
x.c 0x7fff5fbff870 0 0
y.c 0x7fff5fbff860 1 1
x.c 0x7fff5fbff870 1 1
y.c 0x7fff5fbff860 1 1 
```

重点是说明结构值的复制是如何发生的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T16:53:15.787

当说“int x[10]”时，是说“为 10 个整数保留一些空间并传递给我一个指向该位置的指针”。因此，要使副本有意义，您需要对所指向的内存进行操作，而不是“内存位置的名称”。

因此，要在此处复制，您将使用 for 循环或 memcpy()。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-13T18:14:16.450

我使用了 C 编译器，它可以很好地编译......并且在运行时代码会使 x 指向 y 的数组。

您会看到，在 C 中，数组的名称是指向数组开头的指针。事实上，数组和指针本质上是可以互换的。您可以获取*任何*指针并像数组一样对其进行索引。

早在 70 年代初开发 C 语言时，它就适用于抽象程度略高于汇编语言的相对较小的程序。在那种环境下，能够轻松地在数组索引和指针数学之间来回切换非常方便。另一方面，复制整个数据数组是一件非常昂贵的事情，而且几乎没有什么值得鼓励或从用户那里抽象出来的事情。

是的，在当今时代，将数组的名称作为“整个数组”的简写而不是“数组前面的指针”会更有意义。然而，C 并不是在现代设计的。如果您想要一种语言，请尝试 Ada。x := y 完全符合您的期望；它将一个数组的内容复制到另一个数组。

# c# - 类似于 getopt 的 C# 命令行选项解析库/策略？

> ID：744539
> 
> 赞同：1
> 
> 时间：2009-04-13T16:46:05.663
> 
> 标签：c#, command-line, options

如果这已经被覆盖，请原谅我，但解析命令行选项似乎是我最近的第二份工作。关于 getopt 的信息可以在[这里](https://stackoverflow.com/questions/535792/command-line-processing-library-getopt)找到。

**复制 ：**

[寻找 .NET 的命令行参数解析器](https://stackoverflow.com/questions/631410/looking-for-a-command-line-argument-parser-for-net)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T16:55:32.803

[Mono.GetOptions](http://www.go-mono.com/docs/monodoc.ashx?tlink=0%40N%3AMono.GetOptions)可能是您想要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T16:53:37.847

我相信这些都应该有帮助......

[http://sourceforge.net/projects/cshapoptparse/](http://sourceforge.net/projects/csharpoptparse/) [http://www.filebuzz.com/fileinfo/23306/Gastown_C__Command_Line_Parser.html](http://www.filebuzz.com/fileinfo/23306/Gastown_C__Command_Line_Parser.html) [http://www.codeproject.com/KB/recipes/command_line.aspx](http://www.codeproject.com/KB/recipes/command_line.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T16:57:27.617

各种 Codeplex 项目：

*   [http://www.codeplex.com/commandline](http://www.codeplex.com/commandline)
*   [http://www.codeplex.com/cmdlineargsparser](http://www.codeplex.com/cmdlineargsparser)
*   [http://commandlinearguments.codeplex.com/](http://commandlinearguments.codeplex.com/)
*   [http://www.codeplex.com/ConsoleFx](http://www.codeplex.com/ConsoleFx)

[上一个带有几个 getopt 端口的答案](https://stackoverflow.com/questions/631410/looking-for-a-command-line-argument-parser-for-net/685700#685700)

# lucene - Lucene 中 SpanQuery 的用途是什么？

> ID：744540
> 
> 赞同：20
> 
> 时间：2009-04-13T16:46:15.227
> 
> 标签：lucene

有人可以解释什么是 a `SpanQuery`，它的典型用例是什么？

该[文档](https://lucene.apache.org/core/7_7_3/core/org/apache/lucene/search/spans/SpanQuery.html)非常简洁，并不断提到“跨度”的概念，我不太确定我明白了。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-13T17:05:48.033

Spans 为Lucene提供[邻近搜索功能。](https://lucene.apache.org/core/4_10_0/core/org/apache/lucene/search/spans/package-summary.html#package_description)它们用于查找彼此靠近的多个术语，而无需这些术语以指定的顺序出现。您可以指定要查找的术语，以及它们必须有多接近。您可以将这些跨度查询相互组合或与其他类型的 Lucene 查询组合。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-10-25T08:05:00.237

找到关于 SpanQuery 的所有[信息](https://lucidworks.com/blog/2009/07/18/the-spanquery/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-13T17:04:49.083

跨度查询是一个查询，它返回有关每个匹配发生在文档中的位置的*信息。*您使用 getSpans() 方法来获取位置。

以下幻灯片（不幸的是在 Powerpoint 中）包含一个示例：[http ://www.cnlp.org/apachecon2005/AdvancedLucene.ppt](http://www.cnlp.org/apachecon2005/AdvancedLucene.ppt)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-03T00:10:13.203

您链接到的 javadocs 用于“ org.apache.lucene.search.spans ”包中的一个类。如果您单击了这些 javadocs 上的“包”链接，您将被带到...

[https://lucene.apache.org/core/4_10_0/core/org/apache/lucene/search/spans/package-summary.html](https://lucene.apache.org/core/4_10_0/core/org/apache/lucene/search/spans/package-summary.html)

...深入解释 Span 的概念和 Span 是什么。

# c# - 如何使用 C# 列出可用的视频模式？

> ID：744541
> 
> 赞同：7
> 
> 时间：2009-04-13T16:46:27.160
> 
> 标签：c#, winapi, interop, screen-resolution

我找到了使用 C++ ( [http://www.codeproject.com/KB/tips/resswitch.aspx](http://www.codeproject.com/KB/tips/resswitch.aspx) ) 的好例子，但在 C# 中没有。

有人可以帮忙吗？

编辑：列出视频模式的确切功能是：

```
BOOL CVideoModes::GetAvailableVideoModes(CAvailableVideoModes& modes)
{
  modes.SetSize(0, 5);
  int i=0;
  DEVMODE dm;

  while (EnumDisplaySettings(NULL, i, &dm))
  {
    CVideoMode thismode(dm.dmBitsPerPel, dm.dmPelsWidth, 
                        dm.dmPelsHeight, dm.dmDisplayFrequency);
    modes.SetAtGrow(i, thismode);
    ++i;
  }

  modes.FreeExtra();

  return (i>0);
} 
```

但老实说，我无法理解 C++ 代码。我在哪里可以找到“thismode”功能？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-13T17:07:04.740

如果您的意思是视频模式是可用的分辨率，请尝试调用`EnumDisplaySettingsEx`

详细信息可以在这里找到：

[http://msdn.microsoft.com/en-us/library/dd162612(VS.85).aspx](http://msdn.microsoft.com/en-us/library/dd162612(VS.85).aspx)

列出可用分辨率的小程序：

```
using System;
using System.Linq;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace ListResolutions
{

    class Program
    {
        [DllImport("user32.dll")]
        public static extern bool EnumDisplaySettings(
              string deviceName, int modeNum, ref DEVMODE devMode);
        const int ENUM_CURRENT_SETTINGS = -1;

        const int ENUM_REGISTRY_SETTINGS = -2;

        [StructLayout(LayoutKind.Sequential)]
        public struct DEVMODE
        {

            private const int CCHDEVICENAME = 0x20;
            private const int CCHFORMNAME = 0x20;
            [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 0x20)]
            public string dmDeviceName;
            public short dmSpecVersion;
            public short dmDriverVersion;
            public short dmSize;
            public short dmDriverExtra;
            public int dmFields;
            public int dmPositionX;
            public int dmPositionY;
            public ScreenOrientation dmDisplayOrientation;
            public int dmDisplayFixedOutput;
            public short dmColor;
            public short dmDuplex;
            public short dmYResolution;
            public short dmTTOption;
            public short dmCollate;
            [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 0x20)]
            public string dmFormName;
            public short dmLogPixels;
            public int dmBitsPerPel;
            public int dmPelsWidth;
            public int dmPelsHeight;
            public int dmDisplayFlags;
            public int dmDisplayFrequency;
            public int dmICMMethod;
            public int dmICMIntent;
            public int dmMediaType;
            public int dmDitherType;
            public int dmReserved1;
            public int dmReserved2;
            public int dmPanningWidth;
            public int dmPanningHeight;

        }

        static void Main(string[] args)
        {            
                DEVMODE vDevMode = new DEVMODE();
                int i = 0;
                while (EnumDisplaySettings(null, i, ref vDevMode))
                {
                    Console.WriteLine("Width:{0} Height:{1} Color:{2} Frequency:{3}",
                                            vDevMode.dmPelsWidth,
                                            vDevMode.dmPelsHeight,
                                            1 << vDevMode.dmBitsPerPel,         vDevMode.dmDisplayFrequency
                                        );
                i++;
                }
        }

    }

} 
```

# c# - 在 Windows Mobile 6 中抑制操作系统消息

> ID：744553
> 
> 赞同：2
> 
> 时间：2009-04-13T16:49:38.510
> 
> 标签：c#, windows-mobile

我目前正在开发一个面向 Windows Mobile 6 设备的 C# 应用程序，它将在 kiosk 中运行（很清楚 WinMob 6[并不是 kiosk 应用程序的最佳平台](http://blogs.msdn.com/raffael/archive/2008/03/01/supporting-kiosk-applications-on-windows-mobile-technically-achievable-vs-supported.aspx)）。我可以将任务栏移出屏幕，但在某些情况下，操作系统会显示一个消息/状态框（例如，当 ActiveSync 启动时，它会显示一个包含连接过程状态的对话框）。有没有人知道一种方法（通过代码或注册表设置）来抑制这些类型的消息？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-28T13:45:43.187

您可以定期检查这些消息框何时出现并分别使用 WM_CLOSE/DestroyWindow 关闭/销毁它们。

此外，您可以尝试[使用 SureLock Studio](http://www.42gears.com/surelock/index.shtml)来处理这些消息和许多其他情况以模拟信息亭模式。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-24T10:50:35.537

如果您的项目有预算，请考虑查看[Spb Kiosk Engine](http://www.spbsoftwarehouse.com/products/kioskengine/)

# jquery - jQuery UI 对话框定位

> ID：744554
> 
> 赞同：118
> 
> 时间：2009-04-13T16:50:09.617
> 
> 标签：jquery, jquery-ui

我正在尝试使用[jQuery 对话框 UI](http://docs.jquery.com/UI/Dialog)库，以便在将鼠标悬停在某些文本旁边时放置一个对话框。jQuery 对话框采用一个位置参数，该参数从当前视口的左上角开始测量（换句话说`[0, 0]`，无论您当前滚动到哪里，它都将始终放在浏览器窗口的左上角）。但是，我知道检索位置的唯一方法是相对于整个页面的元素。

以下是我目前拥有的。 `position.top`被计算为 1200 左右，这使对话框远低于页面上的其余内容。

```
$(".mytext").mouseover(function() {
    position = $(this).position();
    $("#dialog").dialog('option', 'position', [position.top, position.left]);
} 
```

我怎样才能找到正确的位置？

谢谢！

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2010-07-14T02:40:58.430

作为替代方案，您可以使用[jQuery UI`Position`实用程序](http://jqueryui.com/demos/position/)，例如

```
$(".mytext").mouseover(function() {
    var target = $(this);
    $("#dialog").dialog("widget").position({
       my: 'left',
       at: 'right',
       of: target
    });
} 
```

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2012-03-23T13:59:13.843

感谢上面的一些答案，我进行了实验并最终发现您需要做的就是编辑模态对话框定义中的“位置”属性：

```
position:['middle',20], 
```

JQuery 对水平“X”值的“中间”文本没有问题，我的对话框在中间弹出，从顶部向下 20 像素。

我喜欢 JQuery。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2010-01-19T19:33:25.173

在阅读了所有回复后，这终于对我有用：

```
$(".mytext").mouseover(function() {
    var x = jQuery(this).position().left + jQuery(this).outerWidth();
    var y = jQuery(this).position().top - jQuery(document).scrollTop();
    jQuery("#dialog").dialog('option', 'position', [x,y]);
}); 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2010-02-24T15:26:45.517

以 Jaymin 的例子更进一步，我想出了这个用于将 jQuery ui-dialog 元素定位在您刚刚单击的元素上方（想想“语音气泡”）：

```
$('#myDialog').dialog( 'open' );
var myDialogX = $(this).position().left - $(this).outerWidth();
var myDialogY = $(this).position().top - ( $(document).scrollTop() + $('.ui-dialog').outerHeight() );
$('#myDialog').dialog( 'option', 'position', [myDialogX, myDialogY] ); 
```

请注意，在计算相对宽度和高度偏移之前，我“打开”了 ui-dialog 元素。这是因为如果没有 ui-dialog 元素物理地出现在页面中，jQuery 无法评估 outerWidth() 或 outerHeight()。

只需确保在对话框选项中将“模态”设置为 false，就可以了。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2013-02-26T11:30:42.837

[http://docs.jquery.com/UI/API/1.8/Dialog](http://docs.jquery.com/UI/API/1.8/Dialog)

左上角固定对话框的示例：

```
$("#dialogId").dialog({
    autoOpen: false,
    modal: false,
    draggable: false,
    height: "auto",
    width: "auto",
    resizable: false,
    position: [0,28],
    create: function (event) { $(event.target).parent().css('position', 'fixed');},
    open: function() {
        //$('#object').load...
    }
});

$("#dialogOpener").click(function() {
    $("#dialogId").dialog("open");
}); 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2015-01-23T10:14:06.350

检查你的`<!DOCTYPE html>`

我注意到，如果您错过了`<!DOCTYPE html>`HTML 文件顶部的 ，即使您指定了 position: { my: 'center', at: 'center' ，属于：窗口}

EG： http: [//jsfiddle.net/npbx4561/](http://jsfiddle.net/npbx4561/) - 从运行窗口复制内容并删除 DocType。另存为 HTML 并运行以查看问题。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-04-13T18:41:47.820

查看一些 jQuery 插件以了解对话框的其他实现。 [Cluetip](http://examples.learningjquery.com/67/demo/)似乎是一个功能丰富的工具提示/对话框样式插件。第 4 个演示听起来与您尝试做的类似（尽管我发现它没有您正在寻找的精确定位选项。）

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2014-06-12T20:38:25.923

要将其置于控制之上，您可以使用以下代码：

```
 $("#dialog-edit").dialog({
...    
        position: { 
            my: 'top',
            at: 'top',
            of: $('#myControl')
        },

...
    }); 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2011-09-23T13:15:27.563

```
$(".mytext").mouseover(function() {
   var width = 250;
   var height = 270;
   var posX = $(this).offset().left - $(document).scrollLeft() - width + $(this).outerWidth();
   var posY = $(this).offset().top - $(document).scrollTop() + $(this).outerHeight();
   $("#dialog").dialog({width:width, height:height ,position:[posX, posY]});
} 
```

在元素下方放置一个对话框。我使用 offset() 函数只是因为它计算相对于浏览器左上角的位置，但 position() 函数计算相对于父元素的父 div 或 iframe 的位置。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-04-13T18:20:33.533

而不是做纯jquery，我会做：

```
$(".mytext").mouseover(function() {
    x= $(this).position().left - document.scrollLeft
    y= $(this).position().top - document.scrollTop
    $("#dialog").dialog('option', 'position', [y, x]);
} 
```

如果我正确理解您的问题，则您拥有的代码将对话框定位为好像页面没有滚动，但您希望它考虑滚动。我的代码应该这样做。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2015-04-08T06:58:23.330

```
$("#myid").dialog({height:"auto",
        width:"auto",
        show: {effect: 'fade', speed: 1000},
        hide: {effect: 'fade', speed: 1000},
        open: function( event, ui ) {
          $("#myid").closest("div[role='dialog']").css({top:100,left:100});              
         }
    }); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-04-13T19:46:14.123

此[页面](http://www.howtocreate.co.uk/tutorials/javascript/browserwindow)显示如何确定您的滚动偏移量。jQuery 可能有类似的功能，但我找不到。使用页面上显示的 getScrollXY 函数，您应该能够从 .position() 结果中减去 x 和 y 坐标。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-06-10T16:30:16.263

有点晚了，但你现在可以通过相应地使用 $j(object).offset().left 和 .top 来做到这一点。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2010-08-20T14:47:04.430

我不认为讲话泡泡是完全正确的。我对其进行了一些调整，以便它可以工作并且该项目在链接下方打开。

```
function PositionDialog(link) {
    $('#myDialog').dialog('open');
    var myDialogX = $(link).position().left;
    var myDialogY = $(link).position().top + $(link).outerHeight();
    $('#myDialog').dialog('option', 'position', [myDialogX, myDialogY]);
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2013-08-02T14:17:26.437

要固定中心位置，我使用：

```
open : function() {
    var t = $(this).parent(), w = window;
    t.offset({
        top: (w.height() / 2) - (t.height() / 2),
        left: (w.width() / 2) - (t.width() / 2)
    });
} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2013-10-28T16:43:23.370

**这是代码..，如何将 jQuery UI 对话框定位到中心......**

```
var $about = $("#about");

   $("#about_button").click(function() {
      $about.dialog({
         modal: true,
         title: "About the calendar",
         width: 600,         
         close: function() {
            $about.dialog("destroy");
            $about.hide();
         },
         buttons: {
            close : function() {
               $about.dialog("close");
            }
         }
      }).show();

      $about.dialog("option", "position", 'center');

   }); 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2010-06-04T08:18:00.073

您可以使用`$(this).offset()`，位置与父级有关

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2012-11-26T12:37:28.860

我已经尝试了所有建议的解决方案，但它们不起作用，因为对话框不是主文档的一部分，并且会有自己的层（但这是我有根据的猜测）。

1.  初始化对话框`$("#dialog").dialog("option", "position", 'top')`
2.  打开它`$(dialog).dialog("open");`
3.  然后获取显示对话框的 x 和 y（不是文档的任何其他节点！）

    `var xcoord = $(dialog).position().left + ADD_MODIFIER_FOR_X_HERE;`

    `var ycoord= $(dialog).position().top + ADD_MODIFIER_FOR_Y_HERE;`

    `$(dialog).dialog('option', 'position', [xcoord , ycoord]);`

这样，坐标来自对话框而不是文档，并且位置根据对话框的层而改变。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-03-22T02:03:35.313

我尝试了很多方法来让我的对话框以页面为中心，并看到代码：

`$("#dialog").dialog("option", "position", 'top')`

创建时不要更改对话框位置。

相反，我更改选择器级别以获取整个对话框。

`$("#dialog").parent()`<-- 这是 dialog() 函数在 DOM 上创建的父对象，这是因为选择器 $("#dialog") 不应用属性 top、left。

为了使我的对话框居中，我使用了[jQuery-Client-Centering-Plugin](http://www.west-wind.com/weblog/posts/2008/Aug/21/A-simple-jQuery-Client-Centering-Plugin)

$("#dialog").parent().centerInClient();

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-10-23T21:22:15.253

上述解决方案非常正确...但是调整窗口大小后UI对话框不保留位置。下面的代码做到这一点

```
 $(document).ready(function(){

                $(".test").click(function(){
                            var posX = $(".test").offset().left - $(document).scrollLeft() + $(".test").outerWidth();
                            var posY = $(".test").offset().top - $(document).scrollTop() + $(".test").outerHeight();
                            console.log("in click function");
                            $(".abc").dialog({
                                position:[posX,posY]
                            });

                        })

            })

            $(window).resize(function(){
                var posX=$(".test").offset().left - $(document).scrollLeft() + $(".test").outerWidth();
                var posY = $(".test").offset().top - $(document).scrollTop() + $(".test").outerHeight();

            $(".abc").dialog({
                                position:[posX,posY]
                            });
            }) 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-06-08T07:10:21.243

您可以设置样式的顶部位置以显示在中心，看到代码：

.ui-dialog{top: 100px !important;}

这种样式应该从顶部显示 100px 的对话框。

# sql-server-2005 - How do you store a picture in an image column?

> ID：744589
> 
> 赞同：3
> 
> 时间：2009-04-13T17:00:11.357
> 
> 标签：sql-server-2005

I have a User table:

```
Name varchar(20)
Picture image 
```

I want to store a image into the Picture column -- how can I achieve this using SQL Scripts?

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-13T17:04:54.603

这是将图像存储到 sql server 的示例代码：

```
SqlConnection conn = new SqlConnection(connectionString);

try
{
    int imageLength = uploadInput.PostedFile.ContentLength;
    byte[] picbyte = new byte[imageLength];
    uploadInput.PostedFile.InputStream.Read (picbyte, 0, imageLength);

    SqlCommand command = new SqlCommand("INSERT INTO ImageTable (ImageFile) VALUES (@Image)", conn);
    command.Parameters.Add("@Image", SqlDbType.Image);
    command.Parameters[0].Value = picbyte;

    conn.Open();
    command.ExecuteNonQuery();
    conn.Close();
}
finally
{
    if (conn.State != ConnectionState.Closed)
    {
        conn.Close();
    }
} 
```

**注意：** uploadInput 是一个文件输入控件，用于将图像文件上传到服务器。取自 ASP.NET 应用程序的代码。

**编辑：**这是插入图像类型列的脚本：

```
INSERT INTO ImageTable (ImageColumn)

SELECT ImageColumn FROM 
OPENROWSET(BULK N'C:\SampleImage.jpg', SINGLE_BLOB) 
AS ImageSource(ImageColumn); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T17:05:37.397

对于纯脚本访问，请在联机丛书中查找 BULK 命令。SQL Server 2005 允许您直接从磁盘中提取二进制数据。但是，这不适用于以前版本的 SQL Server。

# ruby-on-rails - 使用 Rails 动态构建 RESTful 路由

> ID：744592
> 
> 赞同：2
> 
> 时间：2009-04-13T17:01:20.743
> 
> 标签：ruby-on-rails, ruby, routes

我正在尝试编写一个辅助方法，它接受复数资源的名称并返回相应的链接。该方法的本质是：

```
def get_link(resource)
  link_to "#{resource.capitalize}", resource_path
end 
```

- 显然上面的`resource_path`部分不起作用。我想要的是能够通过`foos`获取`foos_path`和`bars`获取`bars_path`等。我该怎么做？我不太清楚语法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T17:04:35.730

```
 def get_link(resource)
  link_to "#{resource.capitalize}", send("#{resource}_path")
end 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T18:31:24.723

```
def get_link（资源）
  link_to(resource.to_s.titleize, send("#{resource}_path"))
结尾

```

对资源的 to_s 调用是为了支持将符号作为资源传递。所以

```
get_link("foos")

```

将工作，也

```
get_link(:foos)

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-30T20:48:42.160

如果你想用一个成员构建一个 RESTful 路由：

```
send("edit_#{resource}_path".to_sym, @resource) 
```

# math - 了解离散傅里叶变换

> ID：744596
> 
> 赞同：4
> 
> 时间：2009-04-13T17:03:31.957
> 
> 标签：math, fft, complex-numbers

我有一个关于离散傅里叶变换的小问题。如果我理解正确，那么我们所做的就是将多项式转换为其点值表示，其中 n 点表示多项式的 n-1 次幂。但是为什么我们必须在统一的第 n 个根上对其进行评估呢？任何其他 n 点不会唯一标识这个多项式并且更简单吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T17:11:43.543

> 任何其他 n 点不会唯一标识这个多项式并且更简单吗？

对两者都没有。1）不能保证 n 任意点会起作用，2）它不会更简单。把问题转过来：你为什么反对团结的根源？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-14T14:06:27.317

**申请**的主要原因是

*   波变成单项式。
*   时间空间上的乘积是相空间上的卷积，反之亦然（因此您可以在 O(n log n) 中将两个 n 次多项式相乘）。
*   时间空间上的导数是 x 在相空间上的乘积，反之亦然。

你不会有这些随机点 - 直观地说，因为它们不形成一个组。还有更多的理论原因（还有一些更适用的原因）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T02:45:11.923

不，不是。它与多项式无关。这是关于将向量（初始数字序列）分解为不同的基础。只是这个基础有一系列非常有用的属性：

(1) 它是正交的——向量不混合，确定转换回原始基础非常简单。

(2) 傅里叶基向量是移位（或循环移位，对于离散情况）操作的特征向量——傅里叶基函数在移位向量索引之后仍然是相同的函数（乘以一个数字）。这就是使卷积和一大类微分方程的解在傅里叶空间中非常简单的原因。

(3) 最后，条目是统一的根——这引发了*F* FT，这是迄今为止发现的最优雅的算法之一，它减少了将基更改为 N log N 所需的 N^2 操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-19T01:44:32.917

这是离散傅里叶变换的两个“直观”解释。他们不会直接跳入方程式，而是以一种希望有人告诉我这事之前的方式引导你

1.  [http://betterexplained.com/articles/an-interactive-guide-to-the-fourier-transform/](http://betterexplained.com/articles/an-interactive-guide-to-the-fourier-transform/)

2.  [http://www.altdevblogaday.com/2011/05/17/understanding-the-fourier-transform/](http://www.altdevblogaday.com/2011/05/17/understanding-the-fourier-transform/)

# sharepoint - MOSS 需求收集

> ID：744604
> 
> 赞同：1
> 
> 时间：2009-04-13T17:05:30.297
> 
> 标签：sharepoint, moss

我正在与一个客户进行一个项目，该项目需要为 Internet 和 Intranet 安装 MOSS。不幸的是，客户不知道他想要什么。是否有系统的方法通常用于收集 MOSS 需求，例如业务分析师通常要求明确方向和管理范围的一组问题。有没有参考资料可以提供帮助？在这种情况下你通常会怎么做？

此外，在收集阶段，我们将clinet 3选项显示为显示外观和感觉的图像原型，一旦他确认了一个，我们要求MOSS设计师将PSD文件反映在MOSS网站上以显示为演示。你使用另一种方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T17:17:06.137

MOSS 中的一个大问题是，在用户数据积累起来并且重新组织为时已晚之前，客户并不确定如何组织他们的数据（根据站点、子站点等）。

UI 更改（外观）相对容易，所以如果你真的必须确定一件事，请确保它是数据的组织方式。示例：每个业务线是一个网站集，还是每个 LOB 都有一个包含子网站的大型网站集？这也会影响数据的保护方式，这也是以后修改的一大难题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T17:38:29.220

在生产环境中部署 MOSS 需要大量的规划。最初，每个人都只是因为 MOSS 的设置如此简单而兴奋不已，突然间，您可以在各处拥有协作站点、wiki 和博客。尽管您似乎不必担心太多，但确保您选择的拓扑和场结构是可扩展的，需要进行大量规划。

这里有几个链接可以帮助您入门：

*   可下载的书籍：[Office SharePoint Server 2007 的规划和体系结构](http://technet.microsoft.com/en-us/library/cc262757.aspx)
*   [规划总体设计](http://technet.microsoft.com/en-us/library/cc262612.aspx)
*   [容量规划](http://technet.microsoft.com/en-us/library/bb961988.aspx)
*   [逻辑架构](http://technet.microsoft.com/en-us/library/cc261976.aspx)
*   [设计服务器场和拓扑](http://technet.microsoft.com/en-us/library/cc263157.aspx)
*   [SharePoint 外部协作工具包](http://technet.microsoft.com/en-us/library/cc268155.aspx)
*   [冗余计划](http://technet.microsoft.com/en-us/library/cc263044.aspx)

这只是一个开始，technet 和 msdn 是很好的资源，并且有各种主题可以帮助您入门。就像我说的，一旦您制定了计划，部署产品本身并不是非常困难，但是建立计划/站点拓扑/搜索/索引/数据库考虑/估计增长需要相当多的时间。我刚刚完成了这个项目，我们有大约 2000 个 Intranet 用户，这是一个为期 6 个月的项目，在 4 月底接近完成。祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T17:20:57.187

伙计，这是一个沉重的问题。你可以写一整本书来回答这个问题（有些人有）。不过老实说，我开始的一个好地方是查找“清单”。我用作参考的一个位于此处： http://office.microsoft.com/download/afile.aspx?AssetID= [AM102552101033](http://office.microsoft.com/download/afile.aspx?AssetID=AM102552101033)

它不仅对收集需求有很大帮助，而且对基础设施需求、存储等也有很大帮助。

我同意**马克萨姆**。用户几乎不知道（如果有的话）他们在 MOSS 方面需要什么。他们可能知道解决业务问题需要什么，只是不知道如何在 SharePoint 中解决。那就是你要进来的地方。

# windows-mobile - 在 .Net Compact Framework 中检测手指滑动

> ID：744606
> 
> 赞同：0
> 
> 时间：2009-04-13T17:05:43.603
> 
> 标签：windows-mobile, compact-framework, mobile, gesture-recognition

寻找一种在我的 Windows Mobile 应用程序中检测手指手势的方法。主要目标：检测用户何时在屏幕上进行向左或向右滑动。类似于用于解锁 iPhone 的滑动动作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T17:16:39.600

[`MouseDown`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.mousedown(loband).aspx)当事件发生时设置一个标志，同时存储位置。

1.  如果您希望在用户将手指从屏幕上移开之前做出反应，请收听[`MouseMove`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.mousemove(loband).aspx)事件，并检查相对于您执行操作所需的事件的方向和距离`MouseDown`。
2.  如果您希望等待用户先将手指从屏幕上移开，请监听[`MouseUp`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.mouseup(loband).aspx)事件并检查方向和距离。

# c# - 用户控制模板

> ID：744608
> 
> 赞同：0
> 
> 时间：2009-04-13T17:06:09.423
> 
> 标签：c#, asp.net, user-controls

我在 MSDN 上关注[了这篇文章。](http://msdn.microsoft.com/en-us/library/36574bf6(VS.80).aspx)

该模板工作正常，但我遇到了两个大问题。

即使我用这些装饰模板，我也无法访问模板中的控件

```
[TemplateContainer(typeof(MessageContainer))]
[PersistenceMode(PersistenceMode.InnerProperty)]
[Browsable(false)]
[DesignerSerializationVisibility(DesignerSerializationVisibility.Content)] 
```

其次，我遇到了一个非常糟糕的设计时错误：

```
Error Creating Control - TemplateTest1
Type 'System.Web.UI.UserControl' does not have a public property named 'MessageTemplate'. 
```

现在，为什么我想要这个是因为用户控件非常简单，所以我想创建将产生这个的用户控件

```
 <div class="FormFiled">
--- here i want the ability to put controls that i want ----
<div class="Wrapper">
</div>
</div> 
```

因此，如果模板不起作用，除了模板之外还有其他方法可以实现吗？

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T17:21:05.330

模板的代码在哪里？它在 App_Code 文件夹中是否属于您的页面没有胶水的某个命名空间？

例如我使用以下模板

```
namespace GUI.Controls
{

public class GvTemplate : ITemplate 
```

...

在后面的代码中，我必须按如下方式调用它：

```
colField.ItemTemplate = new GUI.Controls.GvTemplate() 
```

如果您不是动态创建模板，则必须在页面顶部注册控件...

# visual-studio-2008 - Sandcastle 帮助文件生成器和 VS 2008

> ID：744610
> 
> 赞同：4
> 
> 时间：2009-04-13T17:07:54.847
> 
> 标签：visual-studio-2008, sandcastle

如何将沙堡帮助文件构建器项目 (.shfbproj) 添加到 Visual Studio 2008 解决方案？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T18:04:01.950

是的，有一种方法可以在 Visual Studio 中创建 Sandcastle 文档：[DocProject](http://www.codeplex.com/DocProject)

引用项目网站：

> DocProject 使用 Visual Studio 2005/2008 和 MSBuild 的强大功能驱动 Sandcastle 帮助生成工具。从为所有项目参考构建编译帮助版本 1.x 或 2.x 的各种项目模板中进行选择。DocProject 使用 Sandcastle 促进项目文档的管理和开发，允许您使用 Visual Studio 的集成工具来自定义 Sandcastle 的输出。

马克

# iphone - 是否可以通过 WAN 连接两部 iPhone 以获得实时游戏体验？

> ID：744611
> 
> 赞同：8
> 
> 时间：2009-04-13T17:08:20.977
> 
> 标签：iphone

是否可以通过网络（广域网）连接两部 iPhone 以获得实时游戏体验？对于像乒乓球这样的游戏（例如）来说，连接是否足够快？我应该采取哪些步骤？我应该在 iPhone SDK 中使用什么类型的对象来实现这一点？

如果您投票结束，请至少发表评论。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T17:28:21.333

是的，iPhone 可以与网络通信。但是，您将遇到与桌面客户端相同的问题，包括内在网络延迟和 NAT 穿越问题。此外，您将要处理标准嵌入式系统问题，即您不能对 CPU 征税并期望网络性能保持高水平。解决方案与桌面上的解决方案相同，例如拥有一个中央“游戏服务器”，可以减轻 NAT 穿越问题并将“命中”确定从客户端移开。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T20:20:20.097

还可以看看新 SDK 中的 GameKit

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T23:13:28.167

如果您想绕过网络，请查看 Whiteboard，虽然不是游戏，但它使用设备的 wifi 连接进行实时协作，延迟非常低。我认为如果你能弄清楚如何让你的游戏像这样连接到其他设备，你就可以实现一些高质量的游戏创意。

至少，这是我想做的事情之一。

如果您需要通过网络进行游戏，那么您将不会轻易解决上面提到的@John Douthat 问题。对于围棋（以 Tetsuki 为例）和国际象棋等游戏，这不是问题，但射手 (obv) 会是问题。

而且，不，我与 Whiteboard（或 Tetsuki 就此而言）没有任何关系，我只是认为这项技术很酷。

# configuration - app.config、web.config 中的外部修改/更新是否适用于运行时？

> ID：744612
> 
> 赞同：0
> 
> 时间：2009-04-13T17:09:34.313
> 
> 标签：configuration, app-config

这里有个疑问。

.net 应用程序配置文件中的外部修改/更新 - app.config, web.config - 是否适用于运行时？或者应用程序需要重新启动。？

这适用于这些配置文件中的部分吗？

感谢 123 开发者

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T17:18:09.533

是的，当您不处于调试模式时，对配置文件的更改会在运行时反映出来。因此，不需要重新启动。

# ssl - 嵌入式网络服务器和证书

> ID：744613
> 
> 赞同：2
> 
> 时间：2009-04-13T17:10:03.017
> 
> 标签：ssl, certificate, openssl, ssl-certificate, self-signed

我有一个带有嵌入式网络服务器的应用程序。该网络服务器现在可以通过 OpenSSL 包执行 SSL :)

现在到证书问题。这个应用程序已售出，我之所以这么说，是因为它不仅位于我拥有的服务器上——它还安装在数千台计算机上。我希望我的客户是安全的，所以我希望他们尽可能轻松地使用 SSL。现在我们创建自己的 CA，然后创建自签名证书。这意味着我们所有的客户（和他们的用户）都需要安装他们自定义的、特定于安装的 CA，或者忍受来自证书的不受信任的根警告，这两者都没有吸引力。

如何解决这个问题？

我们要么需要：

1.  让安装我们的 CA 变得非常简单（浏览器故意让这些 CA 变得非常困难——很多可怕的警告对话框）
2.  不知何故，所有这些客户证书都由浏览器认可的 CA 合法签名。
3.  强迫客户去购买自己的证书并安装它

我不知道我们将如何做#1，所以我们正在看#2。＃3几乎是不可能的。

我们突然想到，我们可以购买一个 SSL 证书，并将其与我们的产品一起提供——是的，每个人都在使用相同的证书，并且证书和私钥可能/将会泄露到公共域......嗯。 ..出于责任的缘故，可能不希望我们的名字出现在上面...

我想问题在于我们一开始就违背了 CA 的目的。有关如何使用户轻松安全地进行此操作的任何想法？（假设中间人攻击不是问题——真的有记录吗？？）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T17:41:07.560

对此没有简单易行的解决方案。如果这很容易解决，那么 SSL 证书系统的安全性就会很差。

正如您所说，您的选择仅限于如何避免浏览器警告。根据应用程序，每种方法都可能很好。

**1.在客户端浏览器上安装根CA**

如果应用程序在内部使用，或者如果客户端需要安装一些东西来使用应用程序，这是一个合理的解决方案。这可能也是成本最低的解决方案，因为不需要额外费用。但是，如果该应用程序将被广大人群使用，那么这不是一个合理的解决方案。

**2.购买商业根CA签名证书**

如果您的应用程序对 Internet 开放，这很可能是必需的。但是，如果您是在销售应用程序而不是简单地提供其服务，那么出于责任原因，这可能不是您所提到的。

**3\. 让客户购买自己的商业根CA签名证书**

如果您的应用程序被出售以供客户使用，这可能是合理的。您可以使用自签名证书作为基本选项来提供应用程序，并提供给您的客户使用他们的证书（如果他们愿意）。许多公司的网站已经拥有 SSL 证书。

# winforms - 我可以从 winforms 应用程序定位浏览器实例吗？

> ID：744614
> 
> 赞同：0
> 
> 时间：2009-04-13T17:10:03.720
> 
> 标签：winforms, browser

我们正在尝试将我们的产品与公司中的另一个产品进行松散集成。我们的有 Windows 和 Web 客户端，他们的完全在 Web 上。简而言之，他们为我们制作了一个接受一些参数的登录页面，我们只需对该 URL 进行 GET 操作，即可将用户转换到其他应用程序。

另一个应用程序的会话状态存在问题，打开多个浏览器会导致保存回我们应用程序的密钥在会话中被覆盖。我知道在网络版本中它是小菜一碟：

```
window.open('http://theotherappsurl.com', 'otherapp'); 
```

通过传递窗口名称参数，它总是在同一个选项卡/窗口中打开。

棘手的问题是在 winforms 应用程序中，我所做的只是将默认浏览器启动到 URL：

```
Process.Start('http://theotherappsurl.com'); 
```

这让我想到了我的问题 - 从 winforms 启动浏览器窗口时，有什么方法可以定位浏览器窗口的现有实例？有没有办法以这种方式命名窗口？任何特定于 IE 的东西（我不是这个的支持者，但我们的产品是 windows/IE-only）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-16T03:24:01.417

以下工作几乎令人恶心 - 有一个 WebBrowser 控件的静态实例并将 HTML 踢到它，它使用命名窗口执行 window.open()。它的工作方式与在现有浏览器实例中执行此操作相同...甚至不需要控制树的一部分！

所以现在除了“定位”一个浏览器窗口（我们认为这是不可能的）之外，我的老板还希望它也能推动该浏览器实例。我将 window.open(...) 更改为 window.open(...).focus() 并且它可以在我的机器（Server 2008 x64/IE8）上运行，但显然不能在他的（XP/IE7）上运行。是否有机会找到解决方案或具体原因？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T18:55:04.200

我不知道您是否会认为这种做法有点矫枉过正，但您可以创建一个简单的 winform 应用程序来包装 Web 浏览器控件，使其成为单实例应用程序，然后调用它而不是直接调用 IE。

# visual-c++ - 在 VC++ 中录制在线广播流

> ID：744619
> 
> 赞同：4
> 
> 时间：2009-04-13T17:11:04.637
> 
> 标签：visual-c++, mfc, stream, radio

我想开发一个软件，可以使用 MFC 在 VC++ 中录制在线广播流。任何让我开始的指示。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T21:26:48.133

嗯，之前这里推荐过[BASS库](http://www.un4seen.com)，一定要再做一次。它简直太棒了，并且内置了对互联网流和录制的支持。无需做繁琐的网络工作，只需查看下载中的示例 Netradio。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-08T16:17:06.770

您可以使用 NAudio 库，它非常有用[http://naudio.codeplex.com/](http://naudio.codeplex.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T22:14:47.027

You could maybe look into [a project](http://ed.zehome.com/?page=cpige) that already seems to have implemented what you are asking for.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T17:22:36.857

我怀疑这不是微不足道的，主要是由于缺乏文档和/或编解码器。

“在线广播流”涵盖了许多罪恶。有许多不同的编解码器在使用，并且有许多不同的安排用于将音频数据从服务器传输到客户端。

有两个基本问题。首先是获取进入您 PC 的数据。一种解决方案是通过编写过滤器驱动程序或使用现有的第三方产品（如 WinPCAP）更容易地从网络堆栈中捕获数据。第二个问题是弄清楚这个数据中什么是你的音频数据。此数据将被压缩，因此您需要知道正在使用的编解码器，以便在获得数据后可以播放它。（例如，编解码器可能嵌入在 Flash 或 Java 小程序中，因此对您不可用）。数据也可以被加密。如果是这种情况，您还需要颠覆数据传输流中涉及的客户端软件，这是一个全新的球赛。

基本上，你可以花两年时间在这上面，很简单。

# c# - 将 Ruby 转换为 C#

> ID：744620
> 
> 赞同：7
> 
> 时间：2009-04-13T17:11:05.930
> 
> 标签：c#, ruby, caching

需要将以下代码从 Ruby 转换为 C#。但是，我对 yield 关键字的使用和 Ruby 的一般语法感到有些困惑。任何懂一点Ruby的人都可以帮忙转换一下代码吗

```
class < < Cache
STALE_REFRESH = 1
STALE_CREATED = 2

# Caches data received from a block
#
# The difference between this method and usual Cache.get
# is following: this method caches data and allows user
# to re-generate data when it is expired w/o running
# data generation code more than once so dog-pile effect
# won't bring our servers down
#
def smart_get(key, ttl = nil, generation_time = 30.seconds)
  # Fallback to default caching approach if no ttl given
  return get(key) { yield } unless ttl

  # Create window for data refresh
  real_ttl = ttl + generation_time * 2
  stale_key = "#{key}.stale"

  # Try to get data from memcache
  value = get(key)
  stale = get(stale_key)

  # If stale key has expired, it is time to re-generate our data
  unless stale
    put(stale_key, STALE_REFRESH, generation_time) # lock
    value = nil # force data re-generation
  end

  # If no data retrieved or data re-generation forced, re-generate data and reset stale key
  unless value
    value = yield
    put(key, value, real_ttl)
    put(stale_key, STALE_CREATED, ttl) # unlock
  end

  return value
end 
```

结尾

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-13T19:14:01.550

我根本不懂 C#，所以我对 C# 所说的任何话都应该持保留态度。但是，我将尝试解释这段 Ruby 代码中发生了什么。

```
class << Cache 
```

Ruby 有一种叫做*单例方法*的东西。这些与单例软件设计模式无关，它们只是为一个且仅一个对象定义的方法。因此，您可以拥有同一个类的两个实例，并向这两个对象之一添加方法。

单例方法有两种不同的语法。一种是只在方法名称前加上对象，因此只为 object`def foo.bar(baz)`定义一个方法。另一种方法称为*打开单例类*，它在语法上看起来类似于定义一个类，因为这也是语义上发生的事情：单例方法实际上存在于一个不可见的类中，该类被插入到类层次结构中的对象与其实际类之间。`bar``foo`

 *此语法如下所示：`class << foo`. 这将打开 object 的单例类，`foo`并且在该类主体内定义的每个方法都成为 object 的单例方法`foo`。

为什么在这里使用它？好吧，Ruby 是一门纯面向对象的语言，这意味着包括类在内的*一切*都是对象。现在，如果方法可以添加到单个对象中，并且类是对象，这意味着方法可以添加到单个类中。换句话说，Ruby 不需要人为地区分常规方法和静态方法（无论如何，这是一种欺骗：它们不是真正的方法，只是美化的过程）。什么是 C# 中的静态方法，只是类对象的单例类上的常规方法。

所有这些只是解释之间定义的所有内容`class << Cache`及其对应`end`变为的冗长方式`static`。

```
 STALE_REFRESH = 1
  STALE_CREATED = 2 
```

在 Ruby 中，每个以大写字母开头的变量实际上都是一个常量。但是，在这种情况下，我们不会将它们翻译为`static const`字段，而是将其翻译为`enum`，因为它们就是这样使用的。

```
 # Caches data received from a block
  #
  # The difference between this method and usual Cache.get
  # is following: this method caches data and allows user
  # to re-generate data when it is expired w/o running
  # data generation code more than once so dog-pile effect
  # won't bring our servers down
  #
  def smart_get(key, ttl = nil, generation_time = 30.seconds) 
```

这个方法有 3 个参数（实际上是 4 个，我们稍后会看到具体*原因*），其中两个是可选的（`ttl`和`generation_time`）。它们都有一个默认值，但是，在`ttl`没有真正使用默认值的情况下，它更多地作为一个标记来判断参数是否被传入。

`30.seconds`是`ActiveSupport`库添加到`Integer`类的扩展。它实际上并没有做任何事情，它只是返回`self`。在这种情况下使用它只是为了使方法定义更具可读性。（还有其他方法可以做一些更有用的事情，例如`Integer#minutes`，返回`self * 60`等等`Integer#hours`。）我们将使用它作为指示，参数的类型不应该是`int`，而是`System.TimeSpan`。

```
 # Fallback to default caching approach if no ttl given
    return get(key) { yield } unless ttl 
```

这包含几个复杂的 Ruby 结构。让我们从最简单的开始：尾随条件修饰符。如果条件主体只包含一个表达式，则可以将条件附加到表达式的末尾。所以，`if a > b then foo end`你也可以说，而不是说`foo if a > b`。所以，以上等价于`unless ttl then return get(key) { yield } end`。

下一个也很简单：`unless`只是`if not`. 所以，我们现在在`if not ttl then return get(key) { yield } end`

第三是Ruby的真值系统。在 Ruby 中，事实非常简单。其实，假很简单，真自然就出来了：特殊关键字`false`是假的，特殊关键字`nil`是假的，其他都是真的。所以，在这种情况下，条件将*只*为真，如果`ttl`是要么`false`或`nil`。`false`对于时间跨度来说，这并不是一个糟糕的合理值，所以唯一有趣的是`nil`. 该片段会更清楚地写成这样：`if ttl.nil? then return get(key) { yield } end`. 由于参数的默认值为，因此如果没有传入`ttl`参数`nil`，则此条件为真`ttl`. 因此，条件用于确定调用方法的参数数量，这意味着我们不会将其转换为条件，而是将其转换为方法重载。

现在，到`yield`. 在 Ruby 中，每个方法都可以接受隐式代码块作为参数。这就是为什么我在上面写道，该方法实际上需要*四个*参数，而不是三个。代码块只是一段匿名的代码，可以传递、存储在变量中并在以后调用。Ruby 继承了 Smalltalk 的块，但这个概念可以追溯到 1958 年，即 Lisp 的 lambda 表达式。在提到匿名代码块时，但至少现在，在提到 lambda 表达式时，您应该知道如何表示这个隐式的第四个方法参数：委托类型，更具体地说，是 a `Func`。

那么，怎么`yield`办？它将控制权转移到块。它基本上只是一种调用块的非常方便的方式，而无需将其显式存储在变量中然后调用它。

```
 # Create window for data refresh
    real_ttl = ttl + generation_time * 2
    stale_key = "#{key}.stale" 
```

这种`#{foo}`语法称为*字符串插值*。它的意思是“用大括号之间表达式的求值结果替换字符串中的标记”。它只是一个非常简洁的版本`String.Format()`，这正是我们将要翻译的内容。

```
 # Try to get data from memcache
    value = get(key)
    stale = get(stale_key)

    # If stale key has expired, it is time to re-generate our data
    unless stale
      put(stale_key, STALE_REFRESH, generation_time) # lock
      value = nil # force data re-generation
    end

    # If no data retrieved or data re-generation forced, re-generate data and reset stale key
    unless value
      value = yield
      put(key, value, real_ttl)
      put(stale_key, STALE_CREATED, ttl) # unlock
    end

    return value
  end
end 
```

这是我将 Ruby 版本转换为 C# 的微弱尝试：

```
public class Cache<Tkey, Tvalue> {
    enum Stale { Refresh, Created }

    /* Caches data received from a delegate
     *
     * The difference between this method and usual Cache.get
     * is following: this method caches data and allows user
     * to re-generate data when it is expired w/o running
     * data generation code more than once so dog-pile effect
     * won't bring our servers down
    */
    public static Tvalue SmartGet(Tkey key, TimeSpan ttl, TimeSpan generationTime, Func<Tvalue> strategy)
    {
        // Create window for data refresh
        var realTtl = ttl + generationTime * 2;
        var staleKey = String.Format("{0}stale", key);

        // Try to get data from memcache
        var value = Get(key);
        var stale = Get(staleKey);

        // If stale key has expired, it is time to re-generate our data
        if (stale == null)
        {
            Put(staleKey, Stale.Refresh, generationTime); // lock
            value = null; // force data re-generation
        }

        // If no data retrieved or data re-generation forced, re-generate data and reset stale key
        if (value == null)
        {
            value = strategy();
            Put(key, value, realTtl);
            Put(staleKey, Stale.Created, ttl) // unlock
        }

        return value;
    }

    // Fallback to default caching approach if no ttl given
    public static Tvalue SmartGet(Tkey key, Func<Tvalue> strategy) => 
        Get(key, strategy);

    // Simulate default argument for generationTime
    // C# 4.0 has default arguments, so this wouldn't be needed.
    public static Tvalue SmartGet(Tkey key, TimeSpan ttl, Func<Tvalue> strategy) => 
        SmartGet(key, ttl, new TimeSpan(0, 0, 30), strategy);

    // Convenience overloads to allow calling it the same way as 
    // in Ruby, by just passing in the timespans as integers in 
    // seconds.
    public static Tvalue SmartGet(Tkey key, int ttl, int generationTime, Func<Tvalue> strategy) => 
        SmartGet(key, new TimeSpan(0, 0, ttl), new TimeSpan(0, 0, generationTime), strategy);

    public static Tvalue SmartGet(Tkey key, int ttl, Func<Tvalue> strategy) => 
        SmartGet(key, new TimeSpan(0, 0, ttl), strategy);
} 
```

请注意，我不知道 C#，我不知道 .NET，我没有测试过这个，我什至不知道它在语法上是否有效。无论如何，希望它有所帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-13T17:17:33.543

如果缓存不包含请求的数据（`yield`这是您调用该块的方式），则此代码似乎正在传递一个要评估的块。这是相当惯用的 ruby​​ 代码；我不知道您如何（甚至是否）可以将其“翻译”为 c#。

寻找一个用例来了解我的意思。你应该找到类似这样的东西：

```
x = smart_get([:foo,"bar"]) { call_expensive_operation_foo("bar") } 
```

一个更好的选择是弄清楚你需要它做什么，并在 c# 中编写一些从头开始的东西，而不是试图从 ruby​​ 中“翻译”。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-13T17:56:32.420

看起来您正在尝试将 memcache-client 从 Ruby 移植到 C#。如果是这样，使用本机 C# memcache 客户端实现可能会更容易，例如：

[http://code.google.com/p/beitmemcached/](http://code.google.com/p/beitmemcached/)

无论哪种方式，我都同意 MarkusQ 的观点，即从高级语言到低级语言的翻译总体上可能会比仅以惯用的方式重写目标语言的效率低。从 Ruby 到 C# 的直接翻译最多只会给你一些非常丑陋的代码。

yield Ruby 关键字允许您调用作为隐式声明参数传递给方法的代码块。因此，例如，您可以认为 smart_get 方法定义实际上看起来更像：

```
def smart_get(key, ttl = nil, generation_time = 30.seconds, &block) 
```

当您这样调用 smart_get 时：

```
x = smart_get("mykey", my_ttl) { do_some_operation_here } 
```

大括号中的内容被分配给上面扩展定义中的变量块。yield 然后调用 &block 中的代码。这是一个粗略的简化，但应该可以帮助您了解总体思路。

回到你的转换。我刚刚所做的简化不一定会让你 100% 做到这一点，因为一旦你找到了 C# 方法来翻译该代码，另一段代码就会破坏你的翻译。例如，假设给定方法需要检查块：

```
def foo
   if block.arity == 0
      # No arguments passed, load defaults from config file and ignore call
   else
      yield
   end
end 
```

当然，由于 lambda 是 Ruby 中的一等对象，您可能会遇到如下代码：

```
foo = lambda { |a, b, c| a + b + c }   
# foo is now defined as a function that sums its three arguments 
```

如果您遇到动态定义方法的代码，或者（对翻译器来说更糟）利用 Ruby 的可延展类，那么上帝会帮助您：

```
class Foo
   def show
      puts "Foo"
   end
end

foo = Foo.new
foo.show   # prints "Foo"

class <&lt;foo; def show; puts "Bar";  end; end

foo.show  # prints "Bar"

Foo.new.show  # prints "Foo"

foo.show  # Still prints "Bar" 
```

由于 Ruby 中每个类的每个实例都可以有自己的类定义，所以我不确定如果没有花哨的体操，即使是简单的示例也可以移植到 C#。Ruby 有很多这样的特性会破坏简单的翻译工作，所以我建议学习你要移植的东西，然后从头开始重做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-02-22T23:11:48.187

尝试这个：

```
def foo
   if block.arity == 0
      # No arguments passed, load defaults from config file and ignore call
   else
      yield
   end
end 
```

# error-logging - 如何在 PyS60 中记录打印语句和错误消息？

> ID：744625
> 
> 赞同：0
> 
> 时间：2009-04-13T17:12:43.727
> 
> 标签：error-logging, pys60

在 Python for S60 (PyS60) 中运行基于图形的程序时，错误消息和打印语句的输出（即标准输出）被隐藏。如果由于错误应用程序停止按预期工作，它会丢失并且跟踪错误非常困难，有时需要运行代码的“第二个剥离版本”。

这显然是痛苦的。

如何将这些错误记录到文件中，以便稍后查看。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-05T13:11:21.087

PyS60 的具体信息在这里： [http ://wiki.forum.nokia.com/index.php/Python_debugging_techniques](http://wiki.forum.nokia.com/index.php/Python_debugging_techniques)

# python - 调用未知的 Python 函数

> ID：744626
> 
> 赞同：7
> 
> 时间：2009-04-13T17:12:47.767
> 
> 标签：python

这是我能想到的主题的最佳名称，而且我的搜索都没有产生与该问题相关的信息。

如何从字符串中调用函数，即

```
functions_to_call = ["func_1", "func_2", "func_3"]

for f in functions_to_call:
    call f 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-13T17:31:15.603

您可以使用 python 内置 locals() 来获取本地声明，例如：

```
def f():
    print "Hello, world"

def g():
    print "Goodbye, world"

for fname in ["f", "g"]:
    fn = locals()[fname]
    print "Calling %s" % (fname)
    fn() 
```

您可以使用“imp”模块从用户指定的 python 文件中加载函数，这为您提供了更多的灵活性。

使用 locals() 可以确保您不能调用通用 python，而使用 eval，您最终可能会导致用户将您的字符串设置为一些令人讨厌的东西，例如：

```
f = 'open("/etc/passwd").readlines'
print eval(f+"()") 
```

或类似的东西，最终让你的编程做你不希望发生的事情。通常，对 locals() 和 dicts 使用类似的技巧只会给攻击者 KeyErrors。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-13T17:15:39.180

你怎么不知道要调用的函数的名称？存储函数而不是名称：

```
functions_to_call = [int, str, float]

value = 33.5

for function in functions_to_call:
    print "calling", function
    print "result:", function(value) 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-13T17:17:50.283

类似的东西......当我在python中查看函数指针时......

```
def myfunc(x):
    print x

dict = {
    "myfunc": myfunc
}

dict["myfunc"]("hello")

func = dict.get("myfunc")
if callable(func):
    func(10) 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-13T17:31:22.590

看一下 getattr 函数：

[http://docs.python.org/library/functions.html?highlight=getattr#getattr](http://docs.python.org/library/functions.html?highlight=getattr#getattr)

```
import sys

functions_to_call = ["func_1", "func_2", "func_3"]

for f in functions_to_call:
  getattr(sys.modules[__name__], f)() 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-14T14:56:09.057

不要使用评估！它几乎从不需要，python 中的函数就像其他所有东西一样只是属性，并且可以`getattr`在类上使用或通过以下方式访问`locals()`：

```
>>> print locals()
{'__builtins__': <module '__builtin__' (built-in)>,
 '__doc__': None,
 '__name__': '__main__',
 'func_1': <function func_1 at 0x74bf0>,
 'func_2': <function func_2 at 0x74c30>,
 'func_3': <function func_3 at 0x74b70>,
} 
```

由于那是一本字典，您可以通过 dict-keys 获取函数`func_1`，`func_2`并且`func_3`：

```
>>> f1 = locals()['func_1']
>>> f1
<function func_1 at 0x74bf0>
>>> f1()
one 
```

因此，无需求助于 eval 的解决方案：

```
>>> def func_1():
...     print "one"
... 
>>> def func_2():
...     print "two"
... 
>>> def func_3():
...     print "three"
... 
>>> functions_to_call = ["func_1", "func_2", "func_3"]
>>> for fname in functions_to_call:
...     cur_func = locals()[fname]
...     cur_func()
... 
one
two
three 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-13T17:14:58.760

```
functions_to_call = ["func_1", "func_2", "func_3"]

for f in functions_to_call:
    eval(f+'()') 
```

*编辑添加：*

是的， eval() 通常是一个坏主意，但这正是 OP 所要寻找的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-13T17:16:03.830

请参阅[eval 和 compile](http://docs.python.org/library/functions.html)函数。

> 此函数还可用于执行任意代码对象（例如由 compile() 创建的对象）。在这种情况下，传递一个代码对象而不是一个字符串。如果代码对象已使用 'exec' 作为 kind 参数进行编译，则 eval() 的返回值将为 None。

# linux - 可靠的UDP

> ID：744637
> 
> 赞同：3
> 
> 时间：2009-04-13T17:16:09.117
> 
> 标签：linux, linux-kernel, udp

如何开发 Linux 内核模块以使 UDP 可靠？这是我的大学作业，我不知道如何进行。如何通过加载新的内核模块来更改 linux 内核中的默认 UDP 行为？以及如何编写这样的内核模块？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-13T17:33:28.263

可靠的 UDP 与仅使用 TCP 不同。有许多不同之处，但最主要的是保证您始终会收到完整的 UDP 消息或根本不会收到它。然而，接收部分 TCP 消息不仅可能而且很常见。

由于这只是一个家庭作业，我建议只实现一个发送消息，等待一个 ACK​​，发送下一个超时消息例程。如果超时开始，则在声明失败之前重新发送消息若干次。是的，这将比必要的慢。有很多技术可以提高吞吐量，但对于您的任务，您可能不需要使用它们。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-13T17:21:34.317

实际上*有*可靠的 UDP，它被称为[RUDP](http://en.wikipedia.org/wiki/Reliable_User_Datagram_Protocol)，它是为计划 9 发明的。但是，这真的没有意义，只是使用 TCP。

编辑：另外，[UDT](http://udt.sourceforge.net/)可能有用。它基于UDP，但可靠。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-03-31T17:49:56.773

那些一直告诉可怜的人“只使用 TCP”的人忽略了为什么在 TCP 上使用可靠的 UDP 实现是有充分理由的——这不是数据报语义（它很容易在 TCP 之上分层）

一个主要的合法驱动因素是许多节点之间的无连接通信，否则可能需要承载过多的连接多重性

这通常用于广播数据馈送、集群内系统软件通信等。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-14T06:58:54.710

我认为询问如何使 UDP 可靠可能会以错误的方式解决这个问题。根据定义，UDP 或多或少是不可靠的 - ipso facto。您将无法使协议的操作系统端实现更加“可靠”。

许多使用 UDP 的应用程序都使用它，因为它们需要它的低开销、低延迟特性，而不是它们需要 TCP 的精确可靠性。但是几乎所有这些应用程序仍然需要一些机制来验证端到端接收某些类型的消息，甚至可能需要重新组装和/或初始握手。例如，考虑 VoIP 电话中的 SIP；TCP 潜在的三向握手和非常渐进的拥塞控制对于体面的呼叫建立时间或 QoS 来说是不可接受的，但肯定需要某种方式来确认消息（这就是临时响应的用途，在 SIP 术语中）。或者网络游戏使用的各种协议——基本思想相同。

很可能分配的真正意图——即使没有明确说明——与其说是使*UDP可靠，不如说是创建一个**使用*UDP*并*在其自己的通信方案中具有一些原始可靠性抽象层的简单程序，封装在UDP中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-13T17:53:16.173

我经常使用 UDP，而我最终看到的主要“可靠性”问题是丢失数据包（尤其是在分段的 IP 数据包中）。您可以通过防止碎片（添加一个将数据报分成 IP 大小的块）以及让 recipeint 检测并请求重新发送丢失的“块”来完成 90% 的工作。

但是，这种东西确实是 TCP 的发明目的。UDP 最适合用于时间敏感的数据，无论如何重新发送都会过时。

有一个网络拓扑解决方案。只需安排好事情，以免发生任何冲突（LAN 上丢失数据包的第一来源）。以下是我为使 UDP 可靠所做的工作：

*   将*一个*客户端和服务器放在专用的以太网链路上（可能在它们之间有一个交换机，但在它们的专用 LAN 上没有其他系统）。
*   在 UDP LAN 上保持严格的客户端-服务器通信协议。除非响应客户端，否则服务器永远不允许交谈。
*   关闭该 UDP 链接（Netbios 等）上的所有外部网络垃圾。
*   使两端的 ARP 表项静态（这样 ARP 就不会每 10 分钟干扰一次）。

（注意：最后一个特别重要。在许多系统上，导致 ARP 请求的 IP 数据包只是被丢弃，而不是在解析 ARP 后发送）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-13T18:44:43.927

可靠传输数据的技术统称为“ARQ”，代表自动重复请求。

此处解释的主题过于冗长，但维基百科页面是一个很好的起点，但仅此而已。我建议你拿起一本关于计算机网络的教科书（例如 Tanenbaum 或 Kurose/Ross）然后从那里开始。如果您认为它足以完成您的任务，实施基本的停止等待 ARQ 并忘记更高级的 ARQ 方案，那么构建它们还有*很多*工作要做。

我没有开发 Linux 内核模块的经验，但是如果您选择更高级的 ARQ 方案之一，如果 ARQ 机制的实现结果证明比将其打包为内核模块需要更多的工作，我不会感到惊讶。

祝你的任务好运。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-13T17:18:03.763

就像 TCP 一样，在 UDP 之上覆盖 TCP。“可靠的 UDP”是矛盾的。它不是这样设计的。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-13T17:32:55.550

如果您绝对需要一个基于消息的传输层协议，您可以在其中关闭一些 TCP 可靠性功能，例如线头阻塞，请查看[SCTP](http://en.wikipedia.org/wiki/Stream_Control_Transmission_Protocol)。API 甚至有一个“ [UDP 模式](https://datatracker.ietf.org/doc/html/draft-ietf-tsvwg-sctpsocket-19#section-9.7)”来屏蔽底层连接。

它仍在进行中，所以你不能指望用户拥有它——但如果你只需要它用于你维护的计算机，它应该没问题。它在[各种风格的 unix](http://en.wikipedia.org/wiki/Stream_Control_Transmission_Protocol#Implementations)中实现，尽管大部分开发工作都发生在 FreeBSD 中。YMMV。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-13T18:13:28.637

如果您想了解有关如何修改 Linux 内核的更多信息，我的第一反应是谷歌“linux 内核”，甚至可能在其中添加“套接字”。[Linux Kernel](http://www.kernel.org/)网站看起来可能有一些其他的线索供您参考。

我的建议是

1) 看看 UDP 在 Linux 中是如何实现的
2) 看看 RUDP 是如何实现的（正如有人已经提到的那样）
3) ...（你在这里创造了奇迹）
4) 利润！错误...完成了作业！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-14T14:12:31.297

老实说，我想知道这是否是一个技巧问题。需要两方进行通信，除非您已经建立了传达此愿望的协议，否则您绝对无法确保发送者知道（或关心）您希望它重新发送数据包。如果 UDP 本身可以做到这一点，我强烈怀疑内核已经支持它。

你剩下的就是识别和实现一个实现新协议的模块。这没有什么问题，其他人已经给了你建议，我相信你可以使用UDP实现来处理实际的数据包传输。但请记住，它是一种新协议的实现，而不仅仅是稍微扭曲 UDP 以在其中获得新功能。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-14T06:51:12.840

我不确定是否有一种简单的方法可以通过新模块修改现有 UDP 代码的行为。

更简单的是获取 UDP 代码（net/ipv4/udp.c）并使用新的 IP 协议号创建一个新模块，并修改此代码以实现您可靠的 UDP 协议。您将需要重命名所有外部符号，以便名称不会与现有符号冲突，找出它在哪里注册协议号 (17) 并更改它，然后更新 Makefile 以构建您的新模块并可能在其中添加一个条目配置文件。

查看 /etc/protocols 以查看已经分配了哪些协议 ID。

编辑：看起来 udp.c 不能作为模块构建。您将需要查看一些其他协议（例如 ipip.c 或 ip_gre.c）以了解如何将您的代码变成模块。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-11-06T09:19:33.023

如果你想要一个可靠的 UDP，你最好的选择是使用 SCTP（[流控制传输协议](http://en.wikipedia.org/wiki/Stream_Control_Transmission_Protocol)）。它现在是一种完善的协议，可以在任何地方使用。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-13T17:19:41.793

您需要考虑可靠的含义。此外，您需要决定是否需要按顺序排列数据包，或者是否可以按顺序排列。如果乱序没问题，您需要提出一个 ACK​​、重新传输和超时方案。您还需要决定是否要处理数据包碎片。如果你能摆脱它，你可能想要限制数据包的大小以防止碎片。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-13T18:50:21.527

您可能会陷入“可靠”的概念。您对技术术语的确切含义有明确的概念吗？（或者，更相关的是，我想，你的导师是什么意思。）

当您对协议必须具备哪些特征才能称其为可靠有准确的概念时，这可能会为您的工作提供指导。将其作为最低要求进行构建，而不是迷失在功能更全面的真实环境中-world 实施，也可能使完成你的作业更可行。

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2009-04-13T17:23:02.877

如果出于某种原因您必须使用 UDP（说真的，只使用 TCP），一些快速简单的可靠性功能将是存在心跳、确认和异或校验和。

# sql - Windows CE 与 Windows Server 2003 的日期时间同步

> ID：744639
> 
> 赞同：0
> 
> 时间：2009-04-13T17:16:21.097
> 
> 标签：sql, compact-framework, windows-server-2003, replication, windows-ce

我的应用程序（紧凑框架）在 Windows CE 上运行。设备的“冷启动”会重置系统时间。有什么方法可以将系统时间与 Windows Server 2003 (IIS) 同步，或者在 SQL Server 2000 上使用合并复制。我在其中一个数据表中有一个计数列，它计算当前时间，但是这一行在某种程度上不可能添加到发布中。

我知道有一种方法可以询问 SQL 服务器，但在我的情况下最好不要使用直接 sql 查询。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T18:30:57.283

如果服务器运行的是 NTP 时间服务器，可以[直接查询](http://blog.opennetcf.com/ctacke/2006/12/11/QueryingAnNTPSNTPTimeServer.aspx)。

# iphone - iPhone SDK：如何确定 TabBarController 中的最后一个活动选项卡？

> ID：744640
> 
> 赞同：1
> 
> 时间：2009-04-13T17:16:26.013
> 
> 标签：iphone, uitabbarcontroller

我的 iPhone 应用程序中的选项卡栏控制器选项卡之一会根据用户到达的位置（哪些其他选项卡）更改它显示的内容。例如，如果选项卡是 A、B、C 和 D，如果用户以前在选项卡 A 上，则 C 选项卡将显示图片，如果用户以前在选项卡 B 上，则显示文本。

我不确定如何在不继承 TabBarController 的情况下实现这一点（Apple 文档不鼓励这样做）。TabBarController 具有当前活动控制器的属性，以及选项卡栏中所有控制器的列表，但无法看到“选项卡栏控制器遍历树/堆栈”，可以这么说。有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T17:56:54.167

`UITabBarController`您可以设置委托并通过以下方式跟踪最后选择的视图控制器，而不是子类

```
- (void)tabBarController:(UITabBarController *)tabBarController
    didSelectViewController:(UIViewController *)viewController; 
```

# php - 可能的 PDOException 错误（MySQL 5）？

> ID：744656
> 
> 赞同：9
> 
> 时间：2009-04-13T17:19:48.967
> 
> 标签：php, mysql, database, pdo

所以我正在为我的网络应用程序设置一个安装程序，并有数据库凭据的输入字段。我的验证过程的一部分包括测试数据库连接（使用 PHP 的 PDO 库）。如果连接失败，我希望能够区分错误的密码、错误的地址、不存在的数据库名称等，以便我可以引用表单上正确的输入字段。

谁能指出我参考概述了 PDOException 返回的可能的错误代码/消息？

**编辑：**我想到这些错误代码/消息可能是特定于数据库的，而本机数据库代码/错误可能只是通过。如果是这种情况，我目前只使用 MySQL 5 数据库。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-13T17:46:14.863

MySQL 文档是[错误代码](https://dev.mysql.com/doc/refman/8.0/en/error-handling.html)的完整参考。

从 1000 开始的错误代码是[服务器错误](https://dev.mysql.com/doc/refman/8.0/en/server-error-reference.html)。其中包括以下错误：

*   错误：1045 SQLSTATE: 28000 ( `ER_ACCESS_DENIED_ERROR`) 消息：用户'%s'@'%s'的访问被拒绝（使用密码：%s）

*   错误：1049 SQLSTATE: 42000 ( `ER_BAD_DB_ERROR`) 消息：未知数据库'%s'

从 2000 开始的错误代码是[客户端错误](https://dev.mysql.com/doc/refman/8.0/en/client-error-reference.html)。其中包括以下错误：

*   错误：2005 ( `CR_UNKNOWN_HOST`) 消息：未知的 MySQL 服务器主机 '%s' (%d)

*   错误：2003 ( `CR_CONN_HOST_ERROR`) 消息：无法连接到 '%s' (%d) 上的 MySQL 服务器

我不会列出所有可能的错误，因为它们已经记录在案，而且我不知道您需要处理哪些错误。例如，错误 2001 和 2002 特定于 UNIX 套接字连接，这可能与您的目标平台无关。

不要忘记使用[`PDO::errorCode()`](http://php.net/manual/en/pdo.errorcode.php)and[`PDO::errorInfo()`](http://php.net/manual/en/pdo.errorinfo.php)而不是简单的`PDOException`消息。

* * *

重新评论您的评论`getCode()`- 不，它似乎不受这种方式的支持。我做了一个快速测试，`var_dump()`对`PDOException`. 不幸的是，即使错误代码和 SQLSTATE 包含在异常消息中，它的代码也是简单的“0”。

[Exception::getCode()](http://php.net/manual/en/exception.getcode.php)是基`Exception`类的一部分，从 PHP 5.1.0 开始。使用此对象字段取决于各自的 PDO 驱动程序实现。至少对于 MySQL 驱动程序，他们显然没有。

* * *

## 回答 #2

> 赞同：-9
> 
> 时间：2009-04-13T17:42:43.280

我不确定 PDO，但您可以使用`mysql_error()`返回如下内容的函数：

> *   **用户youruser** @ **yourserver**的访问被拒绝
> ***   无法选择数据库*   ...ETC**

 **然后，您可以直接向用户显示这些错误，或者尝试获取所有可能错误的列表，并直接确定错误的原因。

# code-golf - 高尔夫 - 在文本文件中展开模板

> ID：744671
> 
> 赞同：1
> 
> 时间：2009-04-13T17:25:17.613
> 
> 标签：code-golf

Golf - 实现一个简单的模板方案。

扩展是：

*   %KEY% -> 价值
*   %% -> %

命令行参数：

*   ARG1：字典文件，格式`key=value`如示例
*   ARG2：模板文件

这是我不太喜欢打高尔夫球的尝试（python）：261 个字符。

```
import sys
dd = dict([ll.split("=",2) for ll in open( sys.argv[1],'r') if len(ll.split("=", 2)) == 2])
tt = "".join([ ll for ll in open( sys.argv[2],'r')])
sys.stdout.write("".join([(((s == "") and "%") or ((s in dd) and dd[s]) or s) for s in tt.split("%")])) 
```

信息和通信技术

```
NAME=MyName
ODDS=100 
```

模板

```
I, %NAME% am %ODDS% %% sure that that this a waste of time. 
```

结果

```
I, My Name am 100 % sure that this is a waste of time. 
```

是的，我意识到这是一个有缺陷的模板系统，“捕捉”了一个更短更好的实现。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T18:38:26.017

在 Python 中，您可以利用内置的字符串格式使其更短。只需要一点正则表达式黑客来获得匹配的语法。

```
import sys, re
sys.stdout.write(re.sub(r'%(.+?)%',r'%(\1)s',open(sys.argv[2]).read())%dict(l.split("=",2) for l in open(sys.argv[1],'r'))) 
```

低至 139 字节。（虽然也许 args/file-IO 的东西不应该成为高尔夫挑战的一部分？）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T17:34:42.427

C＃。

```
string s = "NAME=MyName ODDS=100"; // any whitespace separates entries
string t = "I, %NAME% am %ODDS% %% sure that that this a waste of time.";

foreach(var p in s.Split().Select(l=>l.Split('=')).ToDictionary(
e=>"%"+e[0]+"%",e=>e[1]))t=t.Replace(p.Key,p.Value);t=t.Replace("%%","%");
Console.WriteLine(t); 
```

我相信算法部分是 159。请注意，如果您将其输入“NAME=%%”之类的内容（它会将 %% 进一步折叠为 %），这可能会产生意想不到的结果，但是任何简短的简单算法都会以一种或另一种方式表现出类似的行为，因为您有以某种顺序进行字符串替换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T09:35:18.530

在 vc++ 中 .. 可能是最快的方法:)

```
void customFormat(const char* format, char dicItemSep, char dicValueSep, const char* dic, char* out)
{
    if(out)
    {
        const char x = '%';
        while(*format)
        {
            while(*format && *format != x)*out++=*format++;
        if(!*format || !*(++format))goto exit;
            if(*format == x)
            {
                *out++=x;
                continue;
            }
            const char *first = format;
            const char *d = dic;
            while(*first)
            {
                while(*d)
                {
                    while(*d && (*d != *first))d++;
                    if(*d == *first)
                    {
                        while((*first++ == *d++) && (*d != dicValueSep));
                        if(!*first)goto exit;
                        if(*d != dicValueSep || *first != x)
                        {
                            first = format;
                            while(*d && (*d != dicItemSep))d++;
                            continue;
                        }
                        break;
                    }
                }
                if(!*d)break;
                d++;
                while((*d != dicItemSep) && *d && (*out++ = *d++));
                format = ++first;
                break;
            }
        }
    exit:
        *out = 0;
    }
}
int _tmain(int argc, _TCHAR* argv[])
{
    char t[1024];
    customFormat
        (
            "%NAME% am %ODDS% %% sure that that this a waste of time.",
            '\n',
            '=',
            "NAME=MyName\nODDS=100",
            t
        );
    printf("%s", t);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T14:56:17.923

红宝石，114 个字符

```
d=Hash[*[open(ARGV[0]).read.scan(/(.+)=(.*)/),'','%'].flatten]
print open(ARGV[1]).read.gsub(/%([^%]*)%/){d[$1]} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-20T04:13:51.587

不是这个问题的真正答案，但我希望你意识到，如果你需要它来完成任何类型的实际任务，Python 有一个*更具可读性*的模板格式`{variable}`

```
 # MyDict.py
 dict = {
     some : 'every',
     p : '?', 
     q : '?..'
 }

 # main file
 import MyDict
 print """
    What is {some}thing{p} 
    Who values this mysterious {some}thing{q}
 """.format(**dict) 
```

如果需要，您可以保留字典格式：

```
 with open(dictionary_file, 'r') as f:
      for l in f.readlines():
           k, v = '='.split(l)
           if v: dict[k] = v 
```

# emacs - 无法在 Emacs 中隐藏欢迎屏幕

> ID：744672
> 
> 赞同：105
> 
> 时间：2009-04-13T17:25:35.193
> 
> 标签：emacs

我想隐藏欢迎屏幕。

我的`.emacs`文件：

```
 (setq c-basic-offset 4) ; indents 4 chars
 (setq tab-width 4)          ; and 4 char wide for TAB
 (setq indent-tabs-mode nil) ; And force use of spaces

 (turn-on-font-lock)       ; same as syntax on in Vim

 (setq width (max width (+ (length str) 1)))   ;line numbers

 (setq inhibit-splash-screen t)         ; hide welcome screen 
```

我试图在我的 .emacs 中运行最后一行代码，但没有成功。

如何在 Emacs 中隐藏欢迎屏幕？

* * *

## 回答 #1

> 赞同：186
> 
> 时间：2009-04-13T17:28:49.353

将以下内容添加到您的`$HOME/.emacs`:

```
(setq inhibit-startup-screen t) 
```

下次启动 Emacs 时，欢迎屏幕应该不会出现。如果你已经用欢迎屏幕打开了 Emacs，你可以用`C-x k`(Control-x, 然后 k) 来杀死它。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-04-13T17:30:38.707

```
(setq inhibit-splash-screen t)
(setq inhibit-startup-message t) 
```

或者，您可以：

```
alias emacs='emacs --no-splash' 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-04-13T17:33:05.817

您可以通过 emac 的菜单轻松完成...

选项 -> 自定义 emacs -> 顶级自定义组

然后选择环境组，然后初始化，并将禁止启动屏幕设置为打开。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-13T17:31:56.660

在我的 .emacs 中，我有 (setq inhibitor-startup-message t)，这对我有用。

gnu emacs 手册说禁止启动消息是旧版本，禁止启动消息是较新版本。不知道是哪个版本改的。 [http://www.gnu.org/software/emacs/manual/html_node/emacs/Initial-Options.html](http://www.gnu.org/software/emacs/manual/html_node/emacs/Initial-Options.html)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-10-08T11:00:22.770

在 Emacs 24 中，`inhibit-splash-screen`并且`inhibit-startup-message`是 的别名`inhibit-startup-screen`，因此只需添加`(setq inhibit-startup-screen t)` 到您的`.emacs`文件中即可解决问题。

鉴于该配置，您的启动缓冲区现在是`*scratch*`，如果您想进一步更改默认缓冲区，`M-h v initial-buffer-choice <RET>`将会有所帮助。

官方文档：[http ://www.gnu.org/software/emacs/manual/html_node/elisp/Startup-Summary.html](http://www.gnu.org/software/emacs/manual/html_node/elisp/Startup-Summary.html)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-05-19T01:41:02.320

您可以使用 set `initial-scratch-message`variable to nil 来隐藏初始消息或设置您想要显示消息的任何内容。

`(setq initial-scratch-message nil)`

或者

`(setq initial-scratch-message ";; Happy Hacking")`

希望它有所帮助。

# asp.net - .NET 中的本地化

> ID：744673
> 
> 赞同：0
> 
> 时间：2009-04-13T17:25:39.843
> 
> 标签：asp.net, localization

您好我正在使用此处描述的资源文件：http: [//msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.aspx](http://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.aspx)

我以编程方式设置文化信息，而不是在页面声明的顶部。我需要为每个页面声明文化信息吗？我可以做些什么来使用一行更改所有页面的文化信息吗？我正在使用母版页。谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T17:28:46.997

在母版页的代码中设置文化，或者在所有页面都来自的基类中设置文化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T17:32:07.050

您可以通过添加[global](http://msdn.microsoft.com/en-us/library/hy4kkhe0.aspx)元素在 web.config 中设置默认文化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T17:40:52.240

如果您只想将文化设置为浏览器的设置，请遵循[此答案](https://stackoverflow.com/questions/744673/localization-in-net/744689#744689)。如果您需要以编程方式设置文化，请使用以下内容：

```
public class MyPage : Page
{
    protected override void InitializeCulture()
    {
        base.InitializeCulture();
        Thread.CurrentThread.CurrentCulture = ...;
        Thread.CurrentThread.CurrentUICulture = ...;
    }
} 
```

然后确保所有页面都继承自 MyPage 而不是 Page。

# java - Java 中的 void 方法中的 return 关键字有什么作用？

> ID：744676
> 
> 赞同：80
> 
> 时间：2009-04-13T17:27:41.897
> 
> 标签：java, methods, return, void

我正在看[一个寻路教程](http://www.cokeandcode.com/main/tutorials/path-finding/)，我注意到方法`return`中的一个语句`void`（类`PathTest`，第 126 行）：

```
if ((x < 0) || (y < 0) || (x >= map.getWidthInTiles()) || (y >= map.getHeightInTiles())) {
    return;
} 
```

我是Java的新手。谁能告诉我为什么它在那里？据我所知，`return`不允许使用 void 方法。

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2009-04-13T17:30:28.023

它只是在此时退出该方法。一旦`return`执行，其余代码将不会执行。

例如。

```
public void test(int n) {
    if (n == 1) {
        return; 
    }
    else if (n == 2) {
        doStuff();
        return;
    }
    doOtherStuff();
} 
```

请注意，编译器足够聪明，可以告诉您无法访问某些代码：

```
if (n == 3) {
    return;
    youWillGetAnError(); //compiler error here
} 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-04-13T17:32:38.827

你可以有`return`一个 void 方法，你不能*返回任何值*（如`return 5;`），这就是他们称之为*void*方法的原因。有些人总是用 return 语句明确地结束 void 方法，但这不是强制性的。不过，它*可以*用来提前离开函数：

```
void someFunct(int arg)
{
    if (arg == 0)
    {
        //Leave because this is a bad value
        return;
    }
    //Otherwise, do something
} 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-04-13T17:36:00.363

该关键字只是从调用堆栈中弹出一个框架，将控件返回到函数调用之后的行。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-04-13T17:32:53.930

Java 语言[规范](http://java.sun.com/docs/books/jls/third_edition/html/statements.html#14.17)说，如果您的方法返回 void，则可以不带表达式地返回。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-13T17:33:48.857

它退出函数并且什么也不返回。

类似的东西`return 1;`是不正确的，因为它返回整数 1。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-13T17:33:16.503

它的功能与带有指定参数的函数的 return 相同，只是它什么都不返回，因为没有什么要返回，并且控制权被传递回调用方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-11-26T03:53:11.250

看这个例子，你想有条件地添加到列表中。如果没有“return”这个词，所有的 if 都将被执行并添加到 ArrayList 中！

```
 Arraylist<String> list =  new ArrayList<>();

    public void addingToTheList() {

    if(isSunday()) {
        list.add("Pray today")
        return;
    }

    if(isMonday()) {
        list.add("Work today"
        return;
    }

    if(isTuesday()) {
        list.add("Tr today")
        return;
    }
} 
```

# compact-framework - 紧凑框架中是否有一个很好的清单？

> ID：744683
> 
> 赞同：6
> 
> 时间：2009-04-13T17:30:26.603
> 
> 标签：compact-framework, reference

我正在寻找紧凑框架中遗漏的内容列表，因此我不必对每一个内容都一头雾水。例如，我刚刚发现 Message 结构不是直接可用的。没什么大不了的，但我花了一个小时想我做错了什么，因为所有编译器都说“你错过了 using 语句吗？”。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T17:43:58.240

正如他们所说，它不是一个完整的参考，但在 msdn 上有一个很好的列表。

[http://msdn.microsoft.com/en-us/library/2weec7k5.aspx](http://msdn.microsoft.com/en-us/library/2weec7k5.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T17:44:43.307

这是[MSDN 文章](http://msdn.microsoft.com/en-us/library/2weec7k5.aspx)，解释了 .NET Compact 和常规 .NET 框架之间的区别。

# c# - 服务器端技能和桌面开发技能有什么区别？

> ID：744691
> 
> 赞同：1
> 
> 时间：2009-04-13T17:32:37.020
> 
> 标签：c#, .net, asp.net, database, multithreading

今天早上，我读到了一个很好的问题，关于这个人应该从 Sharepoint 职位中得到什么。我有一个关于服务器端工程的类似问题。我对服务器端工程职位有什么期望，它与桌面开发有何相似之处和不同之处？

我有 WinForms、WPF 方面的经验、一些轻量级的多线程经验、一些使用 Web 服务的经验、一些编写一些精简、简单的 Web 服务、编写数据访问层 (DAL) 的经验，以及一些设置和使用基于 SQL Server 的数据库的经验。 CRUD 风格的界面和使用存储过程。

我的团队没有服务器端工程师头衔的人，所以我真的不确定这些技能是什么样的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T19:01:50.877

他们是非常不同的世界。我在营地的两边都工作过，但主要是服务器端。我工作的是经典的客户端服务器而不是网络（是的，我们还在附近）。

*   客户端是关于用户交互的，服务器端（大多数情况下）没有用户。这实际上是相当解放的。
*   服务器端意味着考虑管理者，而不是用户。您需要提供对故障查找、报告、诊断日志记录的访问——通常是您自己的*和*Windows 事件日志。
*   客户端是短暂的（用户来来去去），服务器端是持久的。因此，资源管理至关重要：泄漏意味着死亡。内存泄漏、句柄泄漏、堆碎片。你最终会梦见这些东西。我在 24 小时通知中被拖到西班牙，因为一个系统可能会在异常情况下炸毁 Windows DDE 内存分配器的顶部，这告诉你这些东西有多重要。
*   在客户端对用户的响应（为 GUI 提供服务）就是一切，在服务器端则更复杂。线程变得更加重要，但线程是为了可扩展性而不是为了保持 GUI 响应。我还没有像以前在固件时代那样开始计算处理器周期或检查中断延迟数据，但它已经接近了。
*   安全性变得很重要，但比您想象的要少。并非每个服务器应用程序都是面向 Internet 的。考虑访问级别，通过视图限制访问等。
*   曾几何时，服务器端总是意味着本地，但这种情况正在改变。

### 编辑：

通过线程来实现可伸缩性，我的意思是很容易以不伸缩的方式应用线程。为每个查询生成一个线程很好，直到您的建模告诉您可能有 500 个并发查询。所以你需要考虑线程池和队列。

就“管理者”而言，这里的需求其实有两种，一种是给SysAdms报告，一种是给适合的管理类型报告。SysAdms 需要故障查找方面的帮助，我认为这是发生在您的应用程序上的系统故障（网络中断、网络风暴、硬盘满/崩溃、服务器故障转移、调用 DR 等）和诊断，我认为这是报告您*自己的*应用程序的异常行为。

系统管理员有非常短期的需求——这一小时，这一天，给我发电子邮件，给我发短信，把它备份等等。他们需要随时可用的详细技术信息，因为你不知道什么时候你*真的*需要它。但是，无论您向他们提供多少信息，只有最优秀的系统管理员不会在您遇到空气流动装置时拿起电话并给您打电话。

经理需要中长期绩效报告，每天/每周/每月有多少查询，我上周做得如何，本周我需要做些什么来改进，我如何让我的员工/同事看到目标绩效/superiors 等。这主要是根据要求（报告），尽管经常要求诸如带有运行统计信息的墙板之类的东西......但即使这些也不一定是实时的。您可以在民意调查中从数据库中吸出这种东西。作为服务器端人员，您可能必须设计一些视图来促进此报告，但您的大部分工作都针对 SysAdms 感兴趣的异常情况。至少，在我的经验中是这样的。但请记住，如果 SysAdm 不满意，无论如何你都会与经理打交道......

顺便说一句：奇怪的是，尽管 SysAdms 似乎过着压力很大的生活，但与我共事过的所有最好的人都是非常悠闲的人。奇怪，那个。我想这是一种应对机制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T17:36:58.473

服务器端技能更多地涉及可扩展性和长期资源消耗。还有共享资源争用。

在桌面应用程序上，如果您泄漏或占用内存太久，这可能没什么大不了的。在服务器应用程序中执行此操作，您只是锁定了许多用户。

在服务器端应用程序中，您确实需要了解连接和线程池、死锁以及一系列其他问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T17:47:20.493

我不确定您的问题是否可以重新表述为 Web 与客户端开发，因为这将是描述这两种环境的另一种方式，尽管不完全正确。可能有一些服务器-客户端应用程序具有与基于 Web 的应用程序不同的服务器端，我曾经使用其中一个，考虑每一端的代码应该有多难是一种巧妙的方式。

Web 开发存在不同版本的软件和尝试读取数据的解决方案的问题。包括 Internet Explorer、Firefox 和 Chrome 在内的浏览器都有不同的处理方式，如果您将一些 Javascript 与服务器端代码混合在一起，在某些情况下运行一对代码可能会很痛苦。浏览器限制可能是一个因素，也可能是人们期望客户端拥有的插件，例如 Flash、Java 或 Silverlight。处理网络的无状态有时会很痛苦。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T17:54:00.133

再加上 Gaijin 的建议，不要太害怕，有一些规则，但大多数都很容易遵循，因为 Smell 代码就是 Smell 代码，如果你知道你的工具并拥有良好的技能，那么你就会发现它。

有一些很好的方法可以改进您的 Web 应用程序，其中值得一提的是： - 小心使用 viewstate 并在不需要的控件上禁用它。- 有效地使用缓存，ASP.net 对此提供了很好的控制。-Dispose 资源，例如在处理文件 IO 时。- 使用 Firebug 分析您的请求并查看错误。- 使用 ANTS profiler 和 Jetbrain 的 Profiler 等分析应用程序。

现在，服务器比以前更强大了，可以处理大量操作，但这并不意味着你不应该关心你的代码

最后，我想说.Net 框架是一个如此神奇的世界，如果您知道如何使用正确的工具来完成正确的工作，那么您可以制作任何您想要的东西，更美妙的是，如果您使用 Winforms、WPF、 Silver light、ASP.net 或 MVC，总是有很多东西你不必学习，因为它们在 Framework 之间共享。

希望这可以帮助。

# c# - 如何检测我是否在控制台中运行

> ID：744693
> 
> 赞同：16
> 
> 时间：2009-04-13T17:32:43.260
> 
> 标签：c#, .net, vb.net, logging

有没有一种简单的方法可以让代码库自动检测它是从控制台应用程序还是 Windows 应用程序调用的？如果从控制台窗口调用它，我希望我的库不要向 Windows 事件日志报告，而是向控制台窗口报告。但是，如果它不是从控制台窗口中运行的，它应该向 Windows 事件日志报告。

我想过要求我的日志组件传递日志目标，但如果它能够自动处理这两个目标，那就太好了。我还不需要像 log4net 这样广泛的东西，事实上，如果有必要提供支持以记录到数据库/文件和其他未知的日志记录目标，那么我可能会推荐这样的解决方案。不过现在，只要让我的组件自动检测环境并根据环境记录到控制台或事件日志就足够了。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2013-03-07T10:24:26.037

刚刚发现“Console.Title”在windows应用程序中将是一个空白字符串，它将在控制台应用程序中自动设置。

虽然仍然是一个黑客。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-13T17:40:26.097

从架构上讲，将日志记录上下文传递到库组件是正确的选择。该库不知道也不应该知道关于它运行的环境的太多上下文。

因为您想在库中本地支持这两种特殊情况，所以我建议采用统一的方法。

1.  继续创建调用者控制的更通用的日志入口点/旋钮。
2.  创建一个单独的入口点/旋钮，为您想要自动支持的案例自动设置通用的入口点/旋钮。

不过，根据您的描述，即使这似乎也太复杂了。您是否考虑过在诊断集合中简单地使用适当的 TraceListener，您的控制台应用程序添加适当的 TraceListener 以输出到控制台，而非控制台应用程序添加适当的 EventLog TraceListener 以输出到 Windows 事件日志？这具有与所有内置的.net 日志支持一起工作的额外优势，而无需假设任何外部依赖项（例如，log4net）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T17:47:50.930

这个问题的变体已经被问过。即[这里](https://stackoverflow.com/questions/207896/c-net-detect-whether-program-is-being-run-as-a-service-or-a-console-applicatio)和[这里](https://stackoverflow.com/questions/200163/am-i-running-as-a-service#200183)。

' 解决方案似乎归结为两种选择

*   使用反射来弄清楚是什么在召唤你。
*   在控制台应用程序的情况下，在 try-catch 块中调用控制台，看看它是失败还是成功。

我自己的建议是让你的图书馆导出一个界面。接口具有返回调用者类型的函数或属性。调用对象有一个实现接口并返回它是什么类型的类。因为复杂性是一个问题，您可以通过在界面中放置的内容来控制它。

如果应用程序没有在库中注册自己，那么您可以尝试抛出错误或尝试某种自动检测方案。

通过使用接口并抛出错误，您可以明确地向使用库的程序员展示您所期望的。两者之间的交互由接口定义。

此外，交互比自动方案更灵活，因为作为用户，我可以选择我的调用二进制文件如何与您的库交互，而不是一些神秘的规则集。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T17:51:35.007

我知道这是一种 hack，但是在没有控制台时调用 Console.Read 会引发异常。

```
bool isConsole = true;
try
{
    isconsole = Console.CursorLeft >= int.MinValue;
}
catch( IOException )
{
    // Try to attach to parent process's console window
    isConsole = AttachConsole( 0xFFFFFFFF );
}   

...

[DllImport( "kernel32", SetLastError = true )]
private static extern bool AttachConsole( uint dwProcessId ); 
```

这是一个副作用，所以它可能不是一种可靠的检测方法，但它现在有效。

# java - 从 Format 对象中检索格式字符串

> ID：744696
> 
> 赞同：3
> 
> 时间：2009-04-13T17:33:05.787
> 
> 标签：java, introspection, string-formatting

在 Java 中有一种方法可以从 Format 对象（或任何派生类）中检索格式字符串

在代码中：

```
Format f = new DecimalFormat("$0.00");
System.out.println(???); 
```

有什么我可以用来获取 System.out.println(???); 打印“$0.00”。

我看着 toPattern(); 但该函数不会出现在抽象 Format 类中，我正在使用的变量可以是任何扩展 Format 的变量。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T17:58:26.100

模式（如果有的话）取决于`Format`. 不能保证 a`Format`甚至会使用模式进行格式化。

编辑：我不确定您要做什么，但是如果您需要保留一个 Format 实例，它是可序列化的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T21:38:32.543

我不确定你对代码有什么访问权限，但如果你在第一行应用这个小改动，你应该能够以这种方式获得你正在查看的信息：

```
DecimalFormat f = new DecimalFormat("$0.00"); 
System.out.println(f.toPattern()); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T17:42:38.103

恐怕没有这样的运气！你必须知道你正在处理哪个子类并调用适当的方法:-(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T17:42:42.923

没有已知的直接方法可以从父 Format 执行此操作。因为模式实际上存在于格式层次结构的叶子（SimpleDateFormat、MessageFormat、ChoiceFormat、DecimalFormat）；其中有 toPattern 方法。由于它似乎是约定，您可以通过反射获得它。

# web-services - 真实交易API

> ID：744699
> 
> 赞同：114
> 
> 时间：2009-04-13T17:33:22.587
> 
> 标签：web-services, api, finance

你知道一个 API 可以让你用现实生活中的股票或货币进行交易吗？

如果有，请描述您的经历：

*   易于开发
*   佣金
*   沙盒环境？
*   等等

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-04-13T17:37:25.260

AFAIK，[TradeStation](http://www.tradestation.com/automated_trading/auto_trading.shtm)是其中最著名的。大多数其他交易软件都提供 API（NinjaTrader、MetaStock 等）。FWIW，甚至还有自动交易系统的竞争——看[这个](http://championship.mql4.com/)。

此外，这是交易所必须支持并且您的经纪人必须允许的事情。我知道的大多数交易所未经事先许可都不允许自动交易。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-04-13T17:56:45.650

有许多经纪人会让你访问一个 API，让你进行交易。显然，您将向他们支付佣金以及可能比直接市场更大的买卖差价。它们在允许您交易的工具类型上都会有所不同。

如果您想要一个简单的方法，您可以使用收缩包装的软件，例如[Tradestation](http://www.tradestation.com/)（可怕的专有语言）、[NinjaTrader](http://www.ninjatrader.com/)（更好一点，基于 C#）或[SmartQuant](http://www.smartquant.com/)（更好，基于 C#）。这些通常具有与实际执行交易的许多经纪商的预建接口。[InteractiveBrokers](http://www.interactivebrokers.com/)也有一个直接的 API，但它们以难以处理而闻名。

我建议查看其他论坛，例如[EliteTrader](http://www.elitetrader.com)，它提供了有关不同经纪商相对优点的大量信息。也有很多人通过 API 进行交易。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-15T16:37:15.840

试试 TD Ameritrade - 他们有一个很好的 API、相对较低的交易费用和一个很好的帮助论坛。链接到他们的[API 产品概述](http://www.tdameritrade.com/tradingtools/partnertools/api_dev.html)。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-04-13T17:41:45.703

大多数电子证券交易所不提供 API，它们提供消息规范。为了让他们接受您的消息（即直接与他们交易），您将不得不花费大量金钱。并成为交易所的一员——这就是 IB 所做的。即使是实时市场数据馈送（您需要进行明智的交易）也可能非常昂贵。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2010-12-29T19:36:18.587

这类似于我几年前提出的一个问题：[哪些在线经纪人提供 API？](https://stackoverflow.com/questions/59327/what-online-brokers-offer-apis)

我建议调查一下[盈透证券](http://www.interactivebrokers.com/)，这是我最终选择的。[他们的 API](http://www.interactivebrokers.com/en/pagemap/pagemap_APISolutions.php)支持多种语言，包括 Java、C++、ActiveX 和 Excel 的 DDE。您可以通过 API 有效地做任何事情，您可以使用他们相当强大的交易平台来做这些事情。

仅作为经纪人，很难击败 IB 疯狂的低佣金（我的大部分订单都非常低，以至于每笔订单的最低佣金为 1 美元）。将它与相当简单的 API 结合起来，很难被击败。

另外，请查看我的问题（链接在上面和[此处](https://stackoverflow.com/questions/59327/what-online-brokers-offer-apis)），以获取有关提供 API 的代理的更多信息。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-08-10T22:20:44.517

我刚刚开始使用[TradeKing 的](http://www.tradeking.com/)API。它非常简单并且使用oauth。5 美元的交易佣金也不错。

E-trade 也有一个 API，但您必须经过一些步骤才能获得生产访问权限。它们还通过彗星接口提供实时流媒体。除了 etrade 提供的 java 库之外，似乎也没有任何用于 etrade 的库。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-03-11T20:42:45.590

[https://www.quantopian.com](https://www.quantopian.com)

我想是最新的，但有一个在线 ide/调试器/可视化器，并与交互式经纪人集成，用于纸质交易和真实交易。伟大的研发社区

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-11-15T17:36:35.493

[浏览此页面](http://ta-lib.org/hdr_lnk.html)上的链接。

列出了一些开源 api。还没有尝试过，但计划检查 active-quant。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-13T17:40:52.677

联系您的目标证券交易所以获取交易 API 和测试服务器。如果您的目标 Stock Excnage 在 OMX 平台上，您将获得 X-Stream API（非托管 c++）和文档。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-11-15T11:52:24.670

您可能还想查看托管在 Github上的[**TD Ameritrade .NET SDK**](https://github.com/kriasoft/tdameritrade)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-13T17:37:18.100

我相信有一个 API 可以与 ETrade 和其他一些交易软件一起使用。不过，我不认为你会找到一个 API 来执行交易而不使用商业产品。但是，如果您尝试对交易进行一些分析，则有一些 API 可用于检索报价、收听报价、获取交易品种的历史数据等。正如我在开始时所说，许多现有的商业产品都有一个用于编写代码以使用它们的 API。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-02-20T15:32:51.293

我曾使用 NinjaTrader 和 MetaTrader 交易货币和期货产品。

忍者交易者非常易于使用。尽管我可以拥有自己的代码，但我没有超强的深度编码技能，而且它对我来说效果很好。

他们的应用程序可以免费下载。他们还创建了一个“应用程序”，您可以在其中选择不同的技术指标来创建交易策略。

使用自动化系统交易了一段时间，无论输赢，我强烈建议您在交易时使用 TICK DATA。在您使用技术指标做出交易决策的意义上，自动交易非常具有竞争力且非常快速。这意味着，如果您使用诸如 1 分钟数据之类的数据，那么您将落后于有利可图的交易，如果您的系统有任何交易的话。

我可以告诉你，作为日内交易者，坐在屏幕前并在 1 分钟移动平均线穿过 10 分钟或类似情况时进行交易的日子已经结束。并不是说长期策略在日线图上不起作用，它们确实起作用。

我的观点是，无论您使用什么平台，都要使用分时数据。Ninja Trader 很不错。注册分时数据，并使用它进行交易。如果您使用技术指标，您将有更好的盈利机会。

# c# - 类的前缀/后缀

> ID：744705
> 
> 赞同：3
> 
> 时间：2009-04-13T17:35:16.153
> 
> 标签：c#, .net, naming-conventions

当你编写一个包含大量类的应用程序时，你是否使用前缀/后缀作为你的类名？或者我应该只依赖我已经定义的命名空间？

就我而言，我有这样的课程：

```
Blur
Contrast
Sharpen
Invert
... 
```

我只是不知道我明天可能有什么，并希望尽可能避免与 BCL 中经常使用的类发生冲突。

有任何想法吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-13T17:37:49.487

命名空间正是为了解决这个问题而发明的。使用它们。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-13T17:37:24.167

我想说不要在名称中使用前缀或后缀——这非常接近匈牙利表示法，这被广泛认为是不好的，即使是 MS 的创建者也是如此。该规则的唯一例外是接口，许多人认为可以使用前缀`I`，但我认为接口也不应该有前缀。您应该将相关的类分组到命名空间中以防止冲突。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-13T17:49:46.557

避免为类添加前缀或后缀，除非：

*   它是一个接口：`IFilter`
*   您需要传达它正在参与模式：`GaussianBlurStrategy`
*   (from marc_s) You create a custom exception: `ImageDoesNotSupportFilterTypeException`
*   **Sometimes** to communicate if something is an abstract base class: `FilterBase`

I'm torn on that last one. I don't like seeing the Base suffix, but it's really hard for a consumer of your API to know that they can't instantiate Filter (without trying it first) based on the name. I have no love for it, but it's a convention that I use.

**EDIT**

Per Jon B's comment, suffixing custom delegates with `Handler` is common (`FilterExecutedHandler(object sender, FilterEventArgs e);`). Although a delegate declaration isn't a class per se, it can cause name collission so should probably be stated here.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-13T17:38:06.850

通常，我会将它们命名为描述性的（就像您所拥有的那样），但我将它们拆分为适当命名的命名空间。

在你的情况下，我会举起类似的东西

```
namespace AppName.ImageOperations
{
    public class Blur{...}
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T17:39:12.727

如果你有一个通用的基类或接口（例如类 Effect 或接口 IEffect），那么我可能会使用 Effect 作为这些类的后缀。

否则我倾向于使用命名空间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T17:40:40.680

在工作中，我们为所有类使用前缀，有些类使用后缀。这确实阻止了 BCL 冲突，但我认为这是不必要的。你最好使用合理的命名和良好的命名空间。

我建议对接口使用 I 前缀，但这只是个人喜好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-13T18:17:27.347

Actually I could care less about prefix/suffix and more about Namespace partitions and Class names. I want Class names to be meaningful, but I also want correct Namespaces as to avoid collisions and to unify my companies code base.

Ex.

```
namespace Company.Department.Product
{
     public class Class
     {}
} 
```

This makes it very easy to partition code out, and help programmers decide where to put functionality. It takes more time to setup, but I feel in the end it's worth it.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-02T06:58:19.740

The [Guidelines for Names](http://msdn.microsoft.com/en-us/library/ms229002.aspx) (from Microsoft) is an interesting read...

For Namespaces they say:

> The general format for a namespace name is as follows:
> 
> `<Company>.(<Product>|<Technology>)[.<Feature>][.<Subnamespace>]`
> 
> For example, Microsoft.WindowsMobile.DirectX

For Classes, one thing they say:

> Do not give class names a prefix (such as the letter C).
> 
> Interfaces, which should begin with the letter I, are the exception to this rule.

Worth at least a scan through to pick up some ideas...

# java - Java 正则表达式分组问题

> ID：744732
> 
> 赞同：1
> 
> 时间：2009-04-13T17:40:58.370
> 
> 标签：java, regex

我正在尝试找出我遇到的 Java 正则表达式问题。这是1.6，但我认为这并不重要。反正...

我将有一些输入数据，如下所示......

```
"Blah yadda yidda 44-Barack Obama, this that the other" 
```

或者

```
"Something here, there 22-Hyphenated-example.  Hi there folks" 
```

基本上我想提取从数字到尾随标点的所有内容。在我要提取的两个示例输入中...

```
"Barack Obama" 
```

和

```
"Hyphenated-example" 
```

我不能完全得到我需要使用的模式。我能得到的最接近的是这个......

```
"[0-9]{1,2}-([A-Z -]*\\b*)" 
```

然而，这给了我......

```
"44-Barack Obama" 
```

我的代码是...

```
Pattern pattern = Pattern.compile(regex, Pattern.CASE_INSENSITIVE);
Matcher matcher = pattern.matcher("Blah yadda yidda 44-Barack Obama, this that the other");
if (matcher.find())
    // This gives me "44-Barack Obama" but I want "Barack Obama".
    System.out.println(matcher.group()); 
```

有趣的是，我正在使用 QuickREx Eclipse 插件来测试这个模式，它会返回正确的值。但是，运行上面的代码不会。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T17:42:23.203

使用`matcher.group(1)`, not的结果`matcher.group()`。第二种形式返回与前一个`matches`or`find`方法匹配的所有内容。第一种形式用于访问正则表达式中的各个捕获组。

# language-agnostic - 如何表示遗传算法的路径？

> ID：744734
> 
> 赞同：3
> 
> 时间：2009-04-13T17:41:34.237
> 
> 标签：language-agnostic, artificial-intelligence, genetic-algorithm

我想使用 GA 来确定从 A 到 B 的最佳路径，满足某些条件（长度、匝数等）

路径的示例是：上 4、左 8、下 3、右 3、下 1、左 10、上 4、左 1、上 3

问题是，我真的不知道一种很好的方式来表示这样的信息，以便在 GA 中使用，特别是因为路径的长度是可变的。

有谁知道如何做这样的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T17:59:50.573

我不确定你的表示问题到底是什么，所以我怀疑你有这个问题是因为误解了 GA 的染色体字符串。从理论上讲，如果您采取额外的步骤来划分您的单个基因，则不必在整数边界上明确重组染色体串，这将允许您在逐个基因的基础上进行重组。这解决了可变长度基因的问题，例如您的“路径”。重组可变长度基因只是在突变方法中添加另一个变体，特别是“使用这个元素或核对这个元素”，除了标准的“使用来自 A 的元素或来自 B 的元素”，如果你的基因可以分解成离散的元素，就像你的路径一样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-25T22:22:57.723

听起来您真的很想使用[**A* 优化算法**](http://en.wikipedia.org/wiki/A*_algorithm)之类的东西，它通常（效果很好）用于寻路。您可以指定任何您喜欢的启发式函数以获得适当的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-25T22:18:01.977

我会使用 U、D、L、R....

所以“上 4，左 8，下 3，右 3，下 1，左 10，上 4，左 1，上 3”将是：

**UUUULLLLLLLLDDDRRRDLLLLLLLLLLLUUUULUUU**

像这样繁殖字符串会容易得多。

对于 A（15 个字符）和 B（3 个字符），我在 A 和 B 之间的育种功能是：

*   在 1 和 MAX(LEN(A), LEN(B)) {介于 1 和 15} 之间选择一个随机所需的长度 (len)
*   在 1 和 len 之间选择一个随机分割点。
*   选择您是否希望 A 或 B 随机先行。
*   从一个中取出第一个 s 字符，然后从另一个中取出最后一个（len-s）个字符。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-04T20:44:51.660

GA 可以处理可变长度的染色体。实际个体可能非常复杂。例如，它可以包含一些固定长度的位、字符串（没有固定长度），可能还有一些共轭复数对。此外，共轭复数对必须始终保留一些条件。可以做到，但个体越复杂，遗传操作就越复杂（例如交叉、突变）。可能健身功能需要更多的代码行。但这仍然是可能的。

也许正如建议的那样，您可以选择数字编码的路径表示，但仍然可以使用您的示例编码为[Osama ALASSIRY](https://stackoverflow.com/users/25544/osama-alassiry)建议： **UUUULLLLLLLLDDDRRRDLLLLLLLLLLLUUUULUUU**。
对于交叉：

*   让变异操作符读取给定个体的当前长度1，
*   生成两个随机数 x1,y1，x1,y1 =< lenght1 和 x1 != y1（这是您对个人 1 的切割点），
*   对个人 2 做同样的事情，现在你有两对 (x1,y1) 和 (x2,y2)，
*   从个体 1 复制 x1 和 y1 之间的内容，并将其插入到值 x2 和 y2 之间的个体 2 中。新版本的 Individual 2 可能会改变其长度，因为 x1y1 和 x2y2 之间的基因数量可能不同，但没关系，
*   x2y2 之间的个人 2 的原始版本中的内容应该插入 x1y1 之间的个人 1 的新版本中（它的长度也会改变），

为了清楚起见：
父 A：UUUULLLLLLLLDDDRRRDLLLLLLLLLUUUULUUU
父 B：DRRRRLULUDDDR
你生成随机对pairA（4,18），pairB（0,5）假设你从0开始计算基因你交换以下字符串：
UUUU **LLLLLLLLDDDRRRD** LLLLLLLLLLUUUULUUU
**DRRRRL** ULUDDDR
所以交叉后你得到
UUUU **DRRRRL** LLLLLLLLLLUUUULUUU
**LLLLLLLLDDDRRRD** ULUDDDR
现在你刚刚跨越。您也可以使用一个切割点或多个点。

至于突变：

*   生成介于 0 和个体长度之间的数字，
*   生成 1-4 之间的数字并更新该基因。（如果生成 1，则将其更改为 U、2-D、3-L、4-R）

你刚刚做了突变。您还可以突变多个基因。

但正如我所说，还有其他可能性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T22:02:11.537

[对我来说，这听起来与旅行推销员问题](http://en.wikipedia.org/wiki/Travelling_salesman_problem)非常相似，该页面是否包含一些有用的信息？

# java - Java Array HashCode 实现

> ID：744735
> 
> 赞同：56
> 
> 时间：2009-04-13T17:41:41.660
> 
> 标签：java, integer, hashcode

这很奇怪。一位同事询问了 java 中 myArray.hashCode() 的实现。我以为我知道，但后来我进行了一些测试。检查下面的代码。我注意到的奇怪的事情是，当我写出第一个系统时，结果是不同的。请注意，它几乎就像是在报告内存地址并修改类移动地址或其他东西。只是想我会分享。

```
int[] foo = new int[100000];
java.util.Random rand = new java.util.Random();

for(int a = 0; a < foo.length; a++) foo[a] = rand.nextInt();

int[] bar = new int[100000];
int[] baz = new int[100000];
int[] bax = new int[100000];
for(int a = 0; a < foo.length; a++) bar[a] = baz[a] = bax[a] = foo[a];

System.out.println(foo.hashCode() + " ----- " + bar.hashCode() + " ----- " + baz.hashCode() +  " ----- " + bax.hashCode());

// returns 4097744 ----- 328041 ----- 2083945 ----- 2438296
// Consistently unless you modify the class.  Very weird
// Before adding the comments below it returned this:
// 4177328 ----- 4097744 ----- 328041 ----- 2083945

System.out.println("Equal ?? " +
  (java.util.Arrays.equals(foo, bar) && java.util.Arrays.equals(bar, baz) &&
  java.util.Arrays.equals(baz, bax) && java.util.Arrays.equals(foo, bax))); 
```

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-04-13T17:46:31.243

该`java.lang.Array` `hashCode`方法继承自`Object`，这意味着哈希码取决于引用。要根据数组的内容获取哈希码，请使用`Arrays.hashCode`.

请注意它是一个浅哈希码实现。还存在一个深度实现`Arrays.deepHashCode`。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-13T17:48:06.437

数组使用基于内存位置的默认哈希码（但不一定*是*内存位置，因为它只是一个`int`并且所有内存地址都不适合）。您还可以通过打印`System.identityHashCode(foo)`.

只有`equal`当它们是相同的、相同的数组时，数组才是。所以，数组哈希码只有在它们是相同的、相同的数组的情况下才会相等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T18:00:19.790

Object.hashCode() 的默认实现确实是返回对象的指针值，尽管这取决于实现。例如，一个 64 位 JVM 可以将指针和 XOR 以及高位和低位字放在一起。如果有意义，鼓励子类覆盖此行为。

但是，对可变数组执行相等比较是没有意义的。如果一个元素发生变化，那么两者就不再相等。为了保持相同的数组将始终返回相同的 hashCode 无论其元素发生什么的不变性，数组不会覆盖默认的 hashcode 行为。

请注意，java.util.Arrays 提供了一个 deepHashCode() 实现，以便在基于数组内容而不是数组本身的标识进行散列时很重要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-27T02:46:34.057

我同意使用 java.util.Arrays.hashCode（或 google guava 通用包装器 Objects.hashcode），但请注意，如果您使用 Terracotta，这可能会导致问题 - 请参阅[此链接](http://forums.terracotta.org/forums/posts/list/4379.page "这个链接")

# compiler-construction - 编译器的整数如何放入内存并在 CPU 中处理？

> ID：744743
> 
> 赞同：1
> 
> 时间：2009-04-13T17:43:21.890
> 
> 标签：compiler-construction, integer

我在采访中得到了这个问题。

我很难回答。我不确定我应该从哪里开始。最后，我讨论了这个问题与编译器及其构造的关系。

我不确定“编译器的整数”到底是什么意思。现在在我看来，编译器这个词会让候选人感到困惑。

**你会如何在 5 分钟内回答这个问题？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T17:55:56.557

我的硬件架构课五分钟版：

[与任何其他形式的数据一样，整数通过内存层次结构](http://en.wikipedia.org/wiki/Memory_hierarchy)从磁盘复制到[CPU 寄存器](http://en.wikipedia.org/wiki/Processor_register)，在那里它可以用作[汇编](http://en.wikipedia.org/wiki/Assembly_language)指令的参数。

汇编指令的结果最终会沿着内存层次返回到[RAM](http://en.wikipedia.org/wiki/RAM)，在那里它们可以被[内存指针](http://en.wikipedia.org/wiki/Pointer_(computing))访问。

[编译器](http://en.wikipedia.org/wiki/Compiler)负责创建汇编语言，该语言将有效地管理 CPU 的有限寄存器。

在高级计算机语言中，管理这些寄存器的程序集通常是完全透明的，并且使用[变量进行](http://en.wikipedia.org/wiki/Variable_(programming))[抽象](http://en.wikipedia.org/wiki/Abstraction_(computer_science))。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T17:45:00.797

这个问题可能是想让你谈谈寄存器。信息被复制到寄存器中，然后将机器代码运算符应用于它们，然后将信息从寄存器中复制回来。

# c# - 在 C# 中保存每个用户选项的最佳方法

> ID：744746
> 
> 赞同：17
> 
> 时间：2009-04-13T17:44:29.643
> 
> 标签：c#, settings

什么是保存/加载设置的简单方法？如果每个用户都有自己的一组设置，我会更喜欢它。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-04-13T17:47:40.040

如果这是一个桌面应用程序，存储应用程序和/或用户特定设置的最佳方式是使用内置方法。[在 C# 中使用设置](http://msdn.microsoft.com/en-us/library/aa730869.aspx)

**编辑**

[在 C# Visual Studio 2010 中使用设置](http://msdn.microsoft.com/en-us/library/0zszyc6e)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T17:48:06.077

这在很大程度上取决于应用程序的类型。

如果这是一个桌面应用程序，您可以将信息保存到用户区域的注册表中。或者进入他们在磁盘上的用户目录。如果这是一个 Web 或服务器应用程序，您需要将其存储到由用户键入的数据库中，或者存储到为每个用户命名的磁盘文件中。

既然您提到了选项，似乎客户端路径更有可能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T18:00:37.577

ConfigurationManager 运行良好（桌面应用程序）。本质上，您正在使用 app.config xml 文件来保存设置。对于大多数基本用途，只需编辑 app.config。为您要保存的每个设置添加一个键值对...然后访问它，只需执行 ConfigurationManager.get..["yourKey"] 它将返回设置。设置它几乎相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T18:03:11.890

在 .Net 应用程序中，使用 Visual Studio 中的内置设置选项创建这样的设置 - 值保存在配置文件中，但 VS 为您提供了一个很好的界面来创建它们和一个 .Net 类以强类型方式访问它们. 您可以通过这种方式创建用户特定设置或应用特定设置。

要创建设置文件，请双击“属性”文件夹，然后选择“设置”选项卡，然后单击链接以创建“settings.settings”文件（是的，好名字！）。完成此操作后，您将看到存储在 app.config 中的实际设置，以及用于获取这些设置的自动生成代码位于 Settings.designer.cs 中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T18:03:33.777

当您说“每个用户都有自己的一组设置”时，您是指同事通过网络共享的应用程序还是共享计算机上的应用程序？

就个人而言，我会选择设置文件路线。您可以使用注册表，但这让我很怀疑。Windows 中有一些地方（假设您在 Windows 上）可以将用户数据永久存储一天，您需要做的就是写信给它们。如果你在 Vista 上，写入注册表可能不是一个选项，除非你想 UAC 提示你的用户。

如果您的应用程序已经使用某种 SQL 后端，请使用它。制作一个设置表或一个键/值包并将其存储在那里。将其序列化为对象，反之亦然，您应该拥有一个版本 1 的设置管理器。

查看[ConfigurationManager](http://msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.aspx)和[SpecialFolders](http://msdn.microsoft.com/en-us/library/system.environment.specialfolder.aspx)，这应该可以帮助您入门。

# c# - 将 C++ .exe 项目转换为 dll

> ID：744750
> 
> 赞同：1
> 
> 时间：2009-04-13T17:45:37.673
> 
> 标签：c#, c++, marshalling, shadow-copy, dll

Microsoft 提供了 vshadow 的源代码来操作 VSS（卷影服务 [shadow copy]），我已经对其进行了一些修改，但我想将它制作成一个 dll，以便我可以在我的 C# 项目中使用它。我不知道该怎么做，源代码相当简单，应该不会太难，但我真的不知道从哪里开始。我应该如何将其转换为可用的 dll 而不是编译为可执行文件？

**更新**：有人已经这样做了：[http ://www.alphaleonis.com/2008/08/alphavss-bringing-windows-shadow-copy-service-vss-to-net/](http://www.alphaleonis.com/2008/08/alphavss-bringing-windows-shadow-copy-service-vss-to-net/)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T17:53:37.547

您需要在 Visual Studio 中更改项目设置以创建 DLL。此外，您将需要定义 dll 入口点。

~~但是，VSS 是一组 COM API，因此您可以使用 pinvoke 从 C# 直接调用它们，而不是使用此包装 C++ 可执行文件。~~

由于 SDK 仅包含库，而不包含 DLL，因此您必须创建一个 dll 项目才能使用它。

这是一个[很好的博客指南](http://geeklit.blogspot.com/2006/08/calling-c-lib-from-c.html)。

您需要下载[VSS SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=0b4f56e4-0ccc-4626-826a-ed2c4c95c871&DisplayLang=en#QuickInfoContainer)（如果您还没有）。

[关于pinvoke的体面文章。](http://msdn.microsoft.com/en-us/magazine/cc164123.aspx)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-13T17:54:18.683

这样的任务可以是微不足道的，也可以是极其复杂的。在您的情况下，问题可能倾向于复杂的结果。

这样做的原因是因为您需要将现有接口替换为一组您可以使用的新功能。然后需要导出这些函数，以便您可以将它们导入 dotNet。

# .net - 需要发现客户端计算机上是否安装了 dotnet 框架

> ID：744751
> 
> 赞同：0
> 
> 时间：2009-04-13T17:45:40.047
> 
> 标签：.net, javascript, silverlight, web-services

我需要一种方法来了解浏览我网站的用户是否在他的计算机上安装了 dotnet 框架，以及哪个版本（不太重要）。
我需要它至少可以与 Firefox 和 IE 7 及更高版本一起使用。

有任何想法吗？

（“localhost”上的框架是否公开了任何 Web 服务？）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T17:47:53.330

.NET Framework 改变了流行浏览器的用户代理。您可以检查用户代理以找出答案。

火狐：

> Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.0.8) Gecko/2009032609 Firefox/3.0.8 (.NET CLR 3.5.30729)

IE：

> Mozilla/4.0（兼容；MSIE 8.0；Windows NT 6.0；WOW64；Trident/4.0；SLCC1；.NET CLR 2.0.50727；.NET CLR 3.5.30729；.NET CLR 3.0.30618；InfoPath.2）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T17:51:06.397

显示在 ASP.NET 中使用 Mehrdad 答案的示例在[这里](http://blog.ninethsense.com/aspnet-how-to-detect-net-version-from-browser-using-user-agent-string/)。这些概念应该适用于您。

# c# - 最新与按需

> ID：744761
> 
> 赞同：3
> 
> 时间：2009-04-13T17:48:56.497
> 
> 标签：c#, .net

我不知道标题是否有意义，但基本上我想知道人们对是否在必须更改公共成员时计算公共成员的意见，还是在访问时立即计算？

假设你有一个类`CustomCollection`，它有一个名为`Count`. 应该`Count`为每个`Add`, `Remove`, etc 操作更新，还是应该在访问时计算？

保持最新似乎很直观，但随后您想知道，人们多久致电`Add`,`Remove`等与`.Count`.

还有一个混合版本，您可以在访问属性时对其进行缓存？我认为这需要更新另一个变量，对吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T17:53:15.317

当您说您必须考虑访问这些功能的频率时，您是对的。如果`count`一直被访问，它不应该是按需的，因为这会比必要的慢。如果更多地访问其他函数，那么`count`每次重新计算也将是一种浪费。

`count`如果将标志设置为假，然后将标志设置为真，则中间立场将具有按需计算的东西。调用`add`,`remove`等会将标志设置为 false。

像这样的东西：

```
Class CachedCount 
   int count = 0;
   boolean count_is_valid = false;

   int getCount()
       if count_is_valid
           return count;
       else
           count = calculate_count();
           count_is_valid = true;
           return count;

    void Add(item)
        count_is_valid = false;
        ...

    ... 
```

请注意，如果您`count`连续访问多次而不访问`add`,`remove`等，并且对 , 等的访问`add`不会`remove`与对`count`. 如果请求是交错的，则失去此优势。最大的好处来自于这样的序列：`add, add, add, remove, remove, add, count, count, count, count, count, count`而不是`add, count, add, count, remove, count, remove, count, add, count`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-13T17:59:43.100

作为操作数据的副作用，关于类*状态*的大多数信息应该始终是最新的。例如，Count 属性基于数据的内部存储（即数组长度）。

可能需要计算依赖于类状态的某些条件的其他属性。例如，一个`ContainsValidOrder`属性可能取决于类中的顺序。对于这些属性，您必须评估类的使用情况，并确定在从集合中添加和删除项目时计算值的成本是否更便宜，然后在每次访问该属性时扫描整个集合。

然而，.NET 指导方针确实建议属性不执行复杂的代码，并且重复访问属性不会产生任何副作用或性能影响。因此，对于表示计算数据的属性，使用 GetXXX 方法可能会更好。这向使用您的库的开发人员表明 1\. 计算可能需要一些时间，以及 2\. 他们应该保留他们任务的 duratino 值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T17:55:11.723

取决于更新计数所需的时间，如果它是一个耗时的过程并且您不经常调用计数我会选择在调用函数时更新计数，而不是每次修改集合时。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T17:52:03.603

这个答案将取决于应用程序的类型。以及具体情况。

对于计数变量，我通常会即时更新它，因为计算成本可能过高，而存储成本非常低。

在其他情况下，计算成本可能非常低，但存储成本可能很高（可能需要维护代码以保持准确的位置数量）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-13T17:53:57.140

您可能想要对这些公共成员的访问频率与计算它们所需的时间进行某种度量。如果保持更新是一项微不足道的操作，那么以更直观的方式进行操作，如果更新是一项复杂的操作但很少访问，那么按需提供它可能是有意义的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-13T17:55:23.267

按需可以说更简单，因此通常可以认为更好。

至于性能，大多数应用程序可能不会注意到差异。两种方法都有其缺点。最新的策略可能会导致不必要的计算，而按需可能会导致您多次执行相同的计算（但另一方面，客户端可以自行存储计算值，从而避免重复工作） . 按需还创建更小的对象，理论上意味着更少的缓存未命中和更少的垃圾收集，这两者都会极大地损害性能。但同样，我认为大多数应用程序都不会注意到。

顺便说一句，如果计算非常昂贵，那么它不应该在属性中，如果我正确地记住了 .Net 编码指南的话。

# java - 我应该使用监听器还是观察器？

> ID：744762
> 
> 赞同：16
> 
> 时间：2009-04-13T17:49:03.220
> 
> 标签：java, swing, arraylist, listener, observer-pattern

我的 GUI 中有一个下拉框，它显示另一个类中 ArrayList 的内容。新对象可以在 GUI 的其他地方添加到 ArrayList，所以我需要知道它什么时候更新，所以我可以刷新下拉菜单。据我所知，我的两个选择是扩展 ArrayList 类以允许我向其中添加自己的 changeListener，或者使包含相关 ArrayList 的类扩展可观察。

哪个是更合适的解决方案？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-13T17:56:33.093

这两种解决方案本质上是相同根设计模式（由四人组定义的“观察者”模式）的实现。在前一种情况下，您使 ArrayList 本身“可观察”，在后一种情况下，您使域使用数组列表“可观察”的对象。

我倾向于做后者：使域对象可观察。这主要是因为您最终可能会更改有关域对象的其他内容（应为其更新 GUI。）如果它已经是可观察的，那么您已经设置好了。

请注意，您不必严格扩展`java.util.Observable`- 您可以在不这样做的情况下实现设计模式。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-13T17:55:17.930

Java 中的`Observable`实现很少使用，并且不能与 Swing 很好地互操作。改用一个`EventListener`。

特别是，在管理“GUI 中的其他位置”列表的内容时，是否有理由不扩展[`AbstractListModel`](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/AbstractListModel.html)甚至[`DefaultListModel`](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/DefaultListModel.html)直接使用？然后您的组合框可以使用`ComboBoxModel`委托给同一个`ListModel`实例的 a，添加它自己的实现来跟踪选择状态。

我想到了这样的事情（但我没有测试过）：

```
final class MyComboBoxModel 
  extends AbstractListModel 
  implements ComboBoxModel 
{

  private final ListModel data;

  private volatile Object selection;

  MyComboBoxModel(ListModel data) { 
    /* 
     * Construct this object with a reference to your list, 
     * which contents are managed somewhere else in the UI.
     */
    this.data = data;
    data.addListDataListener(new ListDataListener() {
      public void contentsChanged(ListDataEvent evt) { 
        fireContentsChanged(this, evt.getIndex0(), evt.getIndex1()); 
      }
      public void intervalAdded(ListDataEvent evt) { 
        fireContentsChanged(this, evt.getIndex0(), evt.getIndex1()); 
      }
      public void intervalRemoved(ListDataEvent evt) { 
        fireContentsChanged(this, evt.getIndex0(), evt.getIndex1()); 
      }
    });
  }

  public void setSelectedItem(Object selection) { 
    this.selection = selection;
    fireContentsChanged(this, 0, data.getSize() - 1);
  }

  public Object getSelectedItem() { return selection; }

  public int getSize() { return data.getSize(); }

  public Object getElementAt(int idx) { return data.getElementAt(idx); }

} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T18:58:42.380

为什么不使用绑定？

[http://wiki.eclipse.org/index.php/JFace_Data_Binding](http://wiki.eclipse.org/index.php/JFace_Data_Binding)

将您的 GUI 小部件绑定到您的列表。更改将在两个对象之间透明地传播。请务必使用适当的可观察对象包装您的模型，例如 WritableList（如果直接使用 ArrayList）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T17:58:49.890

总是更喜欢组合而不是扩展（我的参考是有效的 java 和我的个人经验）。扩展 ArrayList 只是一个承诺，您不会违反任何类不变量。它还将您绑定到您正在扩展的特定列表实现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T18:02:45.840

您可以切换到使用[GUI 设计模式](http://www.martinfowler.com/eaaDev/)。或者构建一个有限的实现。

创建一个具有 DrawXArrayList 方法的 GUI 表单界面（其中 X 是一些有意义的名称。它有一个 ArrayList 类型的参数

创建一个名为 GUIView 的新类。它至少有两个方法：UpdateXArrayList 和 RegisterForm

当您初始化您的应用程序时，让 GUI 表单向实现 GUIView 的类注册自身。使实现 GUIView 的类对表单可见。

当您的 GUI 表单中的任何内容更新数组列表时，它会调用 UpdateXArrayList 作为它所做的最后一件事。然后，实现 GUIView 的类中的 UpdateXArrayList 方法将依次调用 DrawXArrayList 并传递更新的数组列表。然后，实现 GUIFormInterface 的表单类中的 DrawXArrayList 将采取需要更新显示 ArrayList 的控件的步骤。

虽然与观察者和侦听器设置相比，这似乎是很多步骤。您可以更好地控制各种用户操作如何影响 UI，然后是观察者 - 侦听器模式。此外，您在代码中记录了用户操作和 UI 更新之间的交互。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T20:24:33.487

如果您可以向应用程序添加一个新 jar，请查看 [glazed Lists](http://www.publicobject.com/glazedlists/)

# c - 如何比较C中字符串的结尾？

> ID：744766
> 
> 赞同：51
> 
> 时间：2009-04-13T17:51:16.770
> 
> 标签：c, string

我想确保我的字符串以“.foo”结尾。我正在使用 C，一种我并不完全熟悉的语言。我发现最好的方法如下。任何 C 大师都想确保我优雅而明智地做到这一点？

```
int EndsWithFoo(char *str)
{
    if(strlen(str) >= strlen(".foo"))
    {
        if(!strcmp(str + strlen(str) - strlen(".foo"), ".foo"))
        {
            return 1;
        }
    }
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-04-13T18:03:42.123

每个字符串不要多次调用 strlen 。

```
int EndsWith(const char *str, const char *suffix)
{
    if (!str || !suffix)
        return 0;
    size_t lenstr = strlen(str);
    size_t lensuffix = strlen(suffix);
    if (lensuffix >  lenstr)
        return 0;
    return strncmp(str + lenstr - lensuffix, suffix, lensuffix) == 0;
}

int EndsWithFoo(const char *str) { return EndsWith(str, ".foo"); } 
```

编辑：为迂腐添加了 NULL 检查。对于极端迂腐的人来说，如果 str 和 suffix 都为 NULL，是否应该返回非零值。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-13T18:26:00.433

```
int EndsWithFoo( char *string )
{
  string = strrchr(string, '.');

  if( string != NULL )
    return( strcmp(string, ".foo") );

  return( -1 );
} 
```

如果以“.foo”结尾，将返回 0。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-13T18:03:41.937

我现在无法访问编译器，所以有人可以告诉我这是否有效吗？

```
#include <stdio.h>
#include <string.h>

int EndsWithFoo(const char* s);

int
main(void)
{
  printf("%d\n", EndsWithFoo("whatever.foo"));

  return 0;
}

int EndsWithFoo(const char* s)
{
  int ret = 0;

  if (s != NULL)
  {
    size_t size = strlen(s);

    if (size >= 4 &&
        s[size-4] == '.' &&
        s[size-3] == 'f' &&
        s[size-2] == 'o' &&
        s[size-1] == 'o')
    {
      ret = 1;
    }
  }

  return ret;
} 
```

无论如何，请务必将参数限定为`const`，它会告诉所有人（包括编译器）您不打算修改字符串。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-14T01:37:01.643

如果您可以更改函数的签名，请尝试将其更改为

```
int EndsWith(char const * str, char const * suffix, int lenstr, int lensuf); 
```

这将产生更安全、更可重用和更高效的代码：

1.  添加的 const 限定符将确保您不会错误地更改输入字符串。这个函数是一个谓词，所以我认为它永远不会有副作用。
2.  要比较的后缀作为参数传入，因此您可以保存此函数以供以后与其他后缀一起使用。
3.  如果您已经知道字符串，此签名将使您有机会传递字符串的长度。我们称之为[动态规划](http://en.wikipedia.org/wiki/Dynamic_programming)。

我们可以这样定义函数：

```
int EndsWith(char const * str, char const * suffix, int lenstr, int lensuf)
{
    if( ! str && ! suffix ) return 1;
    if( ! str || ! suffix ) return 0;
    if( lenstr < 0 ) lenstr = strlen(str);
    if( lensuf < 0 ) lensuf = strlen(suffix);
    return strcmp(str + lenstr - lensuf, suffix) == 0;
} 
```

对额外参数的明显反驳是，它们意味着代码中有更多的噪音，或者表达力较差的代码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-13T17:54:35.547

`strlen(".foo")`s 不是必需的。如果你真的想让它变得灵活，你可以使用`sizeof ".foo" - 1`-- 一个编译时间常数。

此外，空字符串检查会很好。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-13T18:23:55.430

测试代码，包括测试：

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int ends_with_foo(const char *str)
{
    char *dot = strrchr(str, '.');

    if (NULL == dot) return 0;
    return strcmp(dot, ".foo") == 0;
}

int main (int argc, const char * argv[]) 
{
    char *test[] = { "something", "anotherthing.foo" };
    int i;

    for (i = 0; i < sizeof(test) / sizeof(char *); i++) {
        printf("'%s' ends %sin '.foo'\n",
               test[i],
               ends_with_foo(test[i]) ? "" : "not ");
    }
    return 0;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-09-16T13:35:39.250

这是一个通用解决方案，使用 memcmp() 返回与 Python 的 str.endswith() 相同的值。不检查 str / suffix 是否为 NULL 是有意的，其他 libc str 函数也不检查 NULL ：

```
int ends_with(const char *str, const char *suffix) {
  size_t str_len = strlen(str);
  size_t suffix_len = strlen(suffix);

  return (str_len >= suffix_len) &&
         (!memcmp(str + str_len - suffix_len, suffix, suffix_len));
} 
```

测试 C：

```
printf("%i\n", ends_with("", ""));
printf("%i\n", ends_with("", "foo"));
printf("%i\n", ends_with("foo", ""));
printf("%i\n", ends_with("foo", "foo"));
printf("%i\n", ends_with("foo", "foobar"));
printf("%i\n", ends_with("foo", "barfoo"));
printf("%i\n", ends_with("foobar", "foo"));
printf("%i\n", ends_with("barfoo", "foo"));
printf("%i\n", ends_with("foobarfoo", "foo")); 
```

结果 C：

```
1
0
1
1
0
0
0
1
1 
```

测试 Python：

```
print("".endswith(""))
print("".endswith("foo"))
print("foo".endswith(""))
print("foo".endswith("foo"))
print("foo".endswith("foobar"))
print("foo".endswith("barfoo"))
print("foobar".endswith("foo"))
print("barfoo".endswith("foo"))
print("foobarfoo".endswith("foo")) 
```

结果 Python：

```
True
False
True
True
False
False
False
True
True 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-01-07T20:57:20.263

这是您将在此处找到的最有效的（对于计算机而言）答案。

```
int endsWith(const char *string,const char *tail)
{

    const char *s1;

    const char *s2;

    if (!*tail)
        return 1;
    if (!*string)
        return 0;
    for (s1 = string; *s1; ++s1);
    for (s2 = tail; *s2; ++s2);
    if (s1 - string < s2 - tail)
        return 0;
    for (--s1, --s2; *s1 == *s2 && s2 >= tail; --s1, --s2);
    if (s2 < tail)
        return 1;
    else
        return 0;
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-05-27T17:00:47.757

对不起，我参加聚会有点晚了。你不能用一些简单的指针数学来做点什么吗？

```
char* str = "hello.foo"; //this would be string given

int x = 4; //.foo has 4 characters

int n = strlen(str)- x; //where x is equal to suffix length

char* test = &str[n]; //do some pointer math to find the last characters

if(strcmp(test, ".foo") == 0){
    //do some stuff
}// end if 
```

字符指针通过指向其数组中的第一个字符来工作。因此，当您这样做时，您将测试的第一个字符设置为“。” 在“.foo”中（如果它包含的话）。这也是为什么您不需要为它分配内存的原因，因为它只是指向已经存在的字符数组。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-07-08T12:15:32.187

```
#include <assert.h>
#include <string.h>

int string_has_suffix(const char *str, const char *suf)
{
    assert(str && suf);

    const char *a = str + strlen(str);
    const char *b = suf + strlen(suf);

    while (a != str && b != suf) {
        if (*--a != *--b) break;
    }
    return b == suf && *a == *b;
}

// Test Unit
int main (int argc, char *argv[])
{
    assert( string_has_suffix("", ""));
    assert(!string_has_suffix("", "a"));
    assert( string_has_suffix("a", ""));
    assert( string_has_suffix("a", "a"));
    assert(!string_has_suffix("a", "b"));
    assert(!string_has_suffix("a", "ba"));
    assert( string_has_suffix("abc", "abc"));
    assert(!string_has_suffix("abc", "eeabc"));
    assert(!string_has_suffix("abc", "xbc"));
    assert(!string_has_suffix("abc", "axc"));
    assert(!string_has_suffix("abcdef", "abcxef"));
    assert(!string_has_suffix("abcdef", "abxxef"));
    assert( string_has_suffix("b.a", ""));
    assert( string_has_suffix("b.a", "a"));
    assert( string_has_suffix("b.a", ".a"));
    assert( string_has_suffix("b.a", "b.a"));
    assert(!string_has_suffix("b.a", "x"));
    assert( string_has_suffix("abc.foo.bar", ""));
    assert( string_has_suffix("abc.foo.bar", "r"));
    assert( string_has_suffix("abc.foo.bar", "ar"));
    assert( string_has_suffix("abc.foo.bar", "bar"));
    assert(!string_has_suffix("abc.foo.bar", "xar"));
    assert( string_has_suffix("abc.foo.bar", ".bar"));
    assert( string_has_suffix("abc.foo.bar", "foo.bar"));
    assert(!string_has_suffix("abc.foo.bar", "xoo.bar"));
    assert(!string_has_suffix("abc.foo.bar", "foo.ba"));
    assert( string_has_suffix("abc.foo.bar", ".foo.bar"));
    assert( string_has_suffix("abc.foo.bar", "c.foo.bar"));
    assert( string_has_suffix("abc.foo.bar", "abc.foo.bar"));
    assert(!string_has_suffix("abc.foo.bar", "xabc.foo.bar"));
    assert(!string_has_suffix("abc.foo.bar", "ac.foo.bar"));
    assert( string_has_suffix("abc.foo.foo", ".foo"));
    assert( string_has_suffix("abc.foo.foo", ".foo.foo"));
    assert( string_has_suffix("abcdefgh", ""));
    assert(!string_has_suffix("abcdefgh", " "));
    assert( string_has_suffix("abcdefgh", "h"));
    assert( string_has_suffix("abcdefgh", "gh"));
    assert( string_has_suffix("abcdefgh", "fgh"));
    assert(!string_has_suffix("abcdefgh", "agh"));
    assert( string_has_suffix("abcdefgh", "abcdefgh"));

    return 0;
}

// $ gcc -Wall string_has_suffix.c && ./a.out 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-08-17T10:54:15.263

> *任何 C 大师都想确保我优雅而明智地做到这一点？*

只要参数是有效的以空字符结尾的字符串，您的解决方案就可以**正常工作。**这是**最重要**的，在这方面，您这样做是**明智**的。作为答案发布的更复杂的解决方案不符合此目标。

编译器将内联`strlen(".foo")`并且应该能够确定两个实例`strlen(str)`返回相同的值，因此生成单个调用[（**clang**和**gcc**执行）](https://godbolt.org/z/cdhfncq5b)。

然而，恕我直言，计算长度一次并使用它会更*优雅*`memcmp()`，而不是`strcmp()`需要更多的工作并且没有内联。您还应该定义`str`为 a以在使用常量字符串或字符串文字调用函数时`const char *`实现正确性并防止出现警告。`const`

测试一个特定的`".foo"`后缀是一个更普遍问题的特例：测试一个字符串是另一个字符串的后缀。

这是一个简单有效的解决方案：

```
#include <string.h>

int strEndsWith(const char *s, const char *suff) {
    size_t slen = strlen(s);
    size_t sufflen = strlen(suff);

    return slen >= sufflen && !memcmp(s + slen - sufflen, suff, sufflen);
}

int strEndsWithFoo(const char *s) {
    return strEndsWith(s, ".foo");
} 
```

代码非常简单和通用，但现代编译器将`strEndsWithFoo`非常有效地内联。正如可以在[GodBolt 的编译器资源管理器](https://godbolt.org/z/WTb8h79fs)上验证的那样，**clang 12.0.0**在编译时计算长度`".foo"`并内联`memcmp()`为单个`cmp`指令，仅生成 12 个 x86_64 指令：

```
strEndsWithFoo:                            # @strEndsWithFoo
        pushq   %rbx
        movq    %rdi, %rbx
        callq   strlen
        movq    %rax, %rcx
        xorl    %eax, %eax
        cmpq    $4, %rcx
        jb      .LBB1_2
        xorl    %eax, %eax
        cmpl    $1869571630, -4(%rbx,%rcx)      # imm = 0x6F6F662E
        sete    %al
.LBB1_2:
        popq    %rbx
        retq 
```

**gcc 11.2**生成非常相似的代码，还有 12 条指令：

```
strEndsWithFoo:
        pushq   %rbx
        movq    %rdi, %rbx
        call    strlen
        xorl    %r8d, %r8d
        cmpq    $3, %rax
        jbe     .L7
        xorl    %r8d, %r8d
        cmpl    $1869571630, -4(%rbx,%rax)
        sete    %r8b
.L7:
        movl    %r8d, %eax
        popq    %rbx
        ret 
```

英特尔的 ICC 编译器会生成一组长而复杂的 SIMD 指令，即使在英特尔处理器上也更难遵循，效率也可能更低。性能在很大程度上取决于`strlen()`库函数的效率，因此基准测试应包括字符串长度的各种分布。

*如果最有效的解决方案怎么办，*没有绝对的答案？但是简单并不妨碍效率，简单直接的代码更容易验证。当它结合了简单、正确和高效时，就达到了*优雅*。

引用[Brian Kernighan 的话](https://en.wikiquote.org/wiki/Brian_Kernighan)：

*   控制复杂性是计算机编程的本质。
    *软件工具 (1976)*，p。319（与 PJ 普劳格）。

*   每个人都知道，调试的难度是一开始编写程序的两倍。因此，如果您在编写它时尽可能地聪明，您将如何调试它？
    *“编程风格的要素”*，第 2 版，第 2 章。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-13T19:29:48.890

如果总有一些超出点的东西，我们可以沉迷于一些指针算术：

```
int EndsWithFoo (char *str)
{
   int iRetVal = 0;
   char * pchDot = strrchr (str, '.');

   if (pchDot)
   {
      if (strcmp (pchDot+1, "foo") == 0)
      {
         iRetVal = 1;
      }
   }
   return iRetVal;
} 
```

当然，您可能想在此处添加一点 strlen 以检查是否有*超出*点的内容 :-)

注意 - 我没有运行它来检查它，但对我来说它看起来不错。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-09-11T06:39:38.153

我想使用我的版本：

```
bool endsWith(const char *filename, const char *ext) {
    const uint len = strlen(filename);
    const uint extLen = strlen(ext);
    if (len < extLen) {
        return false;
    }
    for (uint index  = 1; index <= extLen; index++) {
        if (filename[len - index] != ext[extLen - index]) {
            return false;
        }
    }
    return true;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-13T19:03:14.103

也许...

```
bool endswith (const char *str, const char *tail)
{
  const char *foo = strrstr (str, tail);
  if (foo)
  {
     const int strlength = strlen (str);
     const int taillength = strlen (tail);
     return foo == (str + strlength - taillength);
  }
  return false;
}

endswith (str, ".foo"); 
```

顺便说一句，除了重复`strlen`调用之外，原始问题中的解决方案看起来不错。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-02-08T11:01:32.983

或者...

```
#include <stdbool.h>
#include <stdio.h>
#include <string.h>

bool strendscmp(const char* haystack, const char* needle) {
    size_t len_str = strlen(haystack);
    size_t len_ending = strlen(needle);
    return len_str >= len_ending && strcmp(&haystack[(len_str - len_ending)], needle) == 0;
}

//SOME TESTS
int main(int argc, char** argv) {
    printf("%s\n", strendscmp("abc", "bc") ? "true" : "false"); //true
    printf("%s\n", strendscmp("abc", "d") ? "true" : "false"); //false
    printf("%s\n", strendscmp("abc", "") ? "true" : "false"); //true
    printf("%s\n", strendscmp("sumo", "omo") ? "true" : "false"); //false
    printf("%s\n", strendscmp("babbbba", "bbaabaab") ? "true" : "false"); //false
    printf("%s\n", strendscmp("dadaab", "bdadaab") ? "true" : "false"); //false
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-08-16T16:14:55.283

在 POSIX 系统上，您可以使用 glob 模式匹配字符串的结尾

```
#include <fnmatch.h>

if (fnmatch("*.foo", my_string, 0))
  /* match */ 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-11-07T06:50:22.370

我对此的看法：

```
int string_has_suffix(const char* string, const char* suffix) {
    if (string && suffix) {
        if (strlen(string) >= strlen(suffix)) {
            const char* testLoc;
            testLoc = strrchr(string, suffix[0]);
            if (testLoc) {
                return (strcmp(suffix, testLoc) == 0);
            }
        }
    }
    return 0;
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-05-10T05:35:10.200

我之所以写这个只是因为有人说“最优化”。

```
#include <stdint.h>

int_fast8_f EndsWithFoo(const char *str) {
    char c;
    union {
        uint32_t u;
        char s[4];
    } sfx = { .s = { '.','f','o','o'} },
      cur = { .u = 0 };
    c = *str;
    if (0 == c) { return 0; }
    cur.s[0] = c;
    c = *++str;
    if (0 == c) { return 0; }
    cur.s[1] = c;
    c = *++str;
    if (0 == c) { return 0; }
    cur.s[2] = c;
    c = *++str;
    if (0 == c) { return 0; }
    cur.s[3] = c;
    while (1) {
        c = *++str;
        if (0 == c) {
                if (cur.u == sfx.u)
                {
                        return 1;
                } else {
                        return 0;
                }
        }
        cur.s[0] = cur.s[1];
        cur.s[1] = cur.s[2];
        cur.s[2] = cur.s[3];
        cur.s[3] = c;
    }
} 
```

不会多次从内存中加载字节（除非您的目标处理器几乎没有任何寄存器）。循环中的字符/字节副本应由编译器在任何 32 位或更大的字目标处理器上转换为单个逻辑移位，但我按照我的方式对其进行编码，这样 C 代码就不必知道字节序. sfx（后缀）被编译器转为整数常量，相等后缀测试是单个32位整数相等测试。每个新字节都必须测试为 0。虽然有一些小技巧可以将 0 作为单词中的一个字节进行测试，但它们并不能防止读取过去我们应该可以访问的内存（假设str 指向一个正确终止的字符串）。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-07-24T04:46:16.067

我总是检查 glib 字符串函数，它们有各种有用的位。已存在后缀检查功能。

```
gchar * str;

if (!g_str_has_suffix(str)) {
    return FALSE;
} 
```

我是 C 的新手，所以如果这不是 100%，我会道歉……但对我来说，它看起来像是一个可靠的保护条款！

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2009-04-13T18:14:52.737

你也可以这样概括：

```
int endsWith(const char* text, const char* extn)
{
    int result = 1;
    int len = strlen(text);
    int exprLen = strlen(extn);
    int index = len-exprLen;
    int count = 0;

    if(len > exprLen)
    {
        for( ; count  < exprLen; ++count)
        {
            if(text[index + count] != extn[count])
            {
                result = 0;
                break;
            }

        }
    }
    else
    {
        result = 0;
    }
    return result;
} 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2015-04-23T16:40:38.783

使用一个 strlen(needle)、strstr() 并测试 '\0' 的通用解决方案：

```
#include <stdio.h>
#include <string.h>
#include <stdbool.h>

bool endsWith(const char* haystack, const char* needle)
{
    bool rv = false;
    if (haystack && needle)
    {
        size_t needle_size = strlen(needle);
        if (needle_size == 0) return false;
        const char* act = haystack;
        while (NULL != (act = strstr(act, needle)))
        {   
            if (*(act + needle_size) == '\0')
            {   
                rv = true;
                break;
            }
            act += 1;
        }
    }

    return rv;
}

int main (int argc, char * argv[])
{
    char *a = "file1.gz";
    char *b = "1.gz";
    char *c = NULL;
    char *d = "1.gzabc";
    char *e = "1.gzabc1.gz";
    char *f = "";
    char *g = "rbrbr";
    char *h = "rbr";

    printf("endsWith:\n");
    printf("'%s' '%s' = %d\n",a,b,endsWith(a,b));
    printf("'%s' NULL = %d\n",a,endsWith(a,c));
    printf("'%s' '%s' = %d\n",d,b,endsWith(d,b));
    printf("'%s' '%s' = %d\n",e,b,endsWith(e,b));
    printf("'%s' '%s' = %d\n",e,f,endsWith(e,f));
    printf("'%s' '%s' = %d\n",g,h,endsWith(g,h));

    return 0;
} 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2018-09-09T03:28:12.883

```
int strends(char* str, char* end){
    return strcmp(str + strlen(str) - strlen(end), end) == 0;
} 
```

我发现这是实现结果的最简单方法。

* * *

## 回答 #23

> 赞同：-2
> 
> 时间：2014-05-08T07:50:06.937

我会这样做：

```
/**
  * Return 0 if the string haystack ends with the string needle
  * 
  * @param haystack the string to be analyzed
  * @param needle the suffix string
  * @return 0 if the string haystack ends with the string needle, 1 if not
*/
int strbcmp(const char *haystack, const char *needle) {
    int length;
    if (haystack && needle && strlen(haystack) >= (length = strlen(needle)) && strlen(strstr(haystack, needle)) == length) return 0;
   return 1;
} 
```

测试程序是：

```
#include <stdio.h>
#include <string.h>

int strbcmp(const char *haystack, const char *needle) {
    int length;
    if (haystack && needle && strlen(haystack) >= (length = strlen(needle)) && strlen(strstr(haystack,needle)) == length) return 0;
    return 1;
}

int main (int argc, char * argv[]){
    char *a = "file1.gz";
    char *b = "1.gz";
    char *c = NULL;
    char *d = "1.gzabc";

    printf("%s %s = %d\n",a,b,strbcmp(a,b));
    printf("%s %s = %d\n",a,c,strbcmp(a,c));
    printf("%s %s = %d\n",d,b,strbcmp(d,b));

    return 0;
} 
```

* * *

## 回答 #24

> 赞同：-3
> 
> 时间：2009-04-13T18:05:04.303

我建议最好的方法是反转字符串，然后比较前 n 个字符。

那里有许多字符串反转函数的示例（甚至 Joel 都将其引用为标准面试问题），因此只需实现其中一个，然后逐步通过反转字符串进行比较。

编辑以回应downvotes。好的，是的，这种方法确实需要额外的 CPU 或内存来实现，但提问者没有指出任何此类限制，他明确要求提供一个优雅的解决方案。反转字符串然后从前面比较比乱找字符串的末端并向后工作要优雅得多。并且对于下一个程序员来说也更容易掌握和维护。

# c# - 将行添加到绑定的数据视图

> ID：744767
> 
> 赞同：1
> 
> 时间：2009-04-13T17:51:17.253
> 
> 标签：c#, row, add, dataview

我需要在数据视图中添加行我的代码如下

```
DataGridViewSelectedRowCollection row = dataGridView1.SelectedRows; 
for (int o = 0; o < row.Count; o++) 
{ 
  DataRow myRow; 
  myRow = (row[o].DataBoundItem as DataRowView).Row; 

  DataRowView drv = dv2.AddNew(); 
  drv = row[o].DataBoundItem as DataRowView; 

} 
```

它在调试模式下只添加空白行我可以在这些行中看到数据，但它们只是没有显示在 datagridview 上

非常欢迎任何帮助

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T18:00:07.937

您的问题不是很清楚，但是在绑定之前将该行添加到您要进行数据绑定的任何内容中可能会更简单，然后它应该已经存在。

# c++ - 如何确定商店的实际开发水平，例如 C++ 与 C？

> ID：744768
> 
> 赞同：13
> 
> 时间：2009-04-13T17:51:17.753
> 
> 标签：c++

我想你们中的大多数人都知道我在说什么。你开始了一份新工作，在扫描代码的第一周左右，你意识到你在另一个 C 商店，偶尔会出现流或不幸的用户定义类。您很快意识到，您不仅不会学习任何新东西，而且您被要求不要使用某些东西只是时间问题，因为没有其他人理解它们并且将无法维持您的工作。

您多久会看到一些新技术，比如 StackOverflow，却发现如果您曾经在工作中使用过它，您最多只会感到困惑或烦恼？

根据您的经验，这些地方是常态还是例外？

在面试环境中，您如何（或将如何）尝试确定团队的复杂程度和对 C++ 的投入程度？例如，我曾尝试询问有关公司使用 STL、Boost、3rd 方库等的问题，但这似乎只会逐渐接近你在其中找到的实际情况。想法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-13T18:36:47.147

这真的是全方位的。一方面，我曾在一个最近用 C 重写代码的地方工作过。最近是 10 年前。每个人都对这种新奇的技术持高度怀疑态度。

稍远一点，您会发现 C 程序员碰巧拥有启用了 C++ 功能的编译器。他们将涉足“类”关键字。但除此之外，他们实际上是用 C 语言编写的。

接下来，我想你会发现那些刚刚了解继承和多态性的人。这些人会为 MFC 或 wxWidgets 程序而神魂颠倒，认为它是最棒的。

你会走得更远，找到刚刚读过 Meyer 的人。它们都是关于弄清楚如何有效地使用 STL。他们有一个基本的模板概念，主要等同于 STL 使用它们的方式。

然后你就有了现代 C++ 模板元编程极客。如今，我们中的许多人以提升及其所有优点的形式使用他们的工作。很少有人真正使用模板元编程。这大概是件好事。

我已经看到每个级别都编写了非常好的代码。

我一直喜欢 C++ 的一个很酷的事情是，在每个增加的复杂性级别上，成本都可以用“如何在 C 中实现这种新的抽象”来概念化。所以我可以概念化继承和多态性增加了函数指针查找的成本。自从我看到这个并用 C 编写了这个，我知道我在做什么。由于预处理器在 C 中的工作方式，我还对模板的工作方式有所了解。这适用于 C++ 和 C 世界中的大多数功能。

由于很容易将概念映射到它们在 C 中的实现方式，因此我可以轻松地可视化底层架构如何运行我的代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T18:36:04.027

如果你在字里行间阅读，你可能会发现他们的问题中隐藏着大量信息，无论是他们想要你做什么，还是他们的复杂程度。

您可能还想回复他们的问题，不仅是答案，还有更难的问题，需要澄清他们问题中的歧义。

当你这样做时，不要表现得像个傲慢的混蛋。;-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T18:34:30.927

我工作过的地方不一定使用 C soley。他们并没有一个接一个地推出新程序……他们通常是在构建一些大的东西并对其进行维护。以我的经验，将一种语言的新的令人兴奋的特性继续实现到一个不断增长的旧软件中变得越来越难，主要工作是维护/更新它。

我认为在采访中询问那些很酷的新功能会很有帮助……你至少应该能够剔除那些显而易见的功能。另一件事是询问您是否可以与一些实际编写代码的人交谈。大多数面试都是与经理类型的......他们并不总是参与使用语言的最新功能的人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T17:56:45.963

我在三个 C++ 商店工作了很长时间。在所有情况下，它们都是真正的 C++ 商店，使用 C++ 的预期用途，并且根据我在它们工作的时间保持相当最新。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-13T19:24:33.990

向他们索取一份 C++ 编码标准文档的副本。这应该让您对他们的工作水平有所了解。如果他们没有，那可能是一个不好的迹象。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-13T18:42:06.993

有趣的是，我认为进步水平与您的偏好几乎相反。因此，此响应可能不会直接有用，但我希望它至少能提供一些信息。

* * *

首先，任何鼓励“聪明”的环境都是可疑的。如果我看到很多 Boost、很多模板元编程，尤其是任何对 C++“函数式”特性的使用，这是一个很大的红色警告信号。这意味着开发人员对什么是正确的编程有一些了解，但由于缺乏想象力或政治而受限于使用陈旧的垃圾语言，例如 C++。C 语言枯燥乏味，但“高级”C++ 却不遗余力地干扰开发。

其次，检查特定技术或概念是否被视为流行语。如果未来的雇主使用 XML，你可以做一个简单的检查——他们是使用真正的解析器/序列化器（SAX 或 DOM 都可以），还是用正则表达式解析它并用原始字符流序列化它？如果是后者，则表明他们不理解XML*为何*有用，他们只是使用它在项目描述中添加另一个三个字母的首字母缩略词。

第三，弄清楚开发人员*希望*他们使用什么语言以及为什么。每个优秀的开发人员都有一个最喜欢的晦涩语言——不管是 Python、Ruby、Smalltalk、Haskell 还是 Factor——以及喜欢它的原因。如果每个人都满足于使用 C++ 工作，这是另一个警告信号，表明他们对一般编程没有太多好奇心。

# c# - 从属性网格重置属性

> ID：744774
> 
> 赞同：5
> 
> 时间：2009-04-13T17:53:37.700
> 
> 标签：c#, propertygrid, propertydescriptor

我正在使用 PropertyGrid 来显示我的对象的属性。但是，我还允许用户创建自己的属性，并为这些自定义属性设置值。每个可以具有这些自定义属性的对象都有一个 Dictionary 集合，其中字符串是标识属性的唯一键，Object 是原始类型（字符串、布尔值、整数等）的值。

我用 get 和 set 方法创建了一个自定义 PropertyDescriptor，这些方法检查 Dictionary 是否有匹配的键，或者分别用匹配的键创建/覆​​盖值。

但是，我还想让用户能够清除该属性，从而将其条目从字典中完全删除。我将代码放在我的自定义 PropertyDescriptor 的 ResetValue 覆盖方法中，但是我看不到任何通过 PropertyGrid 接口调用它的方法？它似乎不是上下文菜单选项或类似的东西。

因此，如果我有一个带有自定义 ResetValue 方法的自定义 PropertyDescriptor，我如何真正从 PropertyGrid 调用该方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T18:29:43.183

我认为实现这一点的最简单方法是在属性网格中添加一个上下文菜单，带有一个菜单项“重置”，然后像这样处理它的点击事件：

```
private void resetToolStripMenuItem_Click(object sender, EventArgs e)
{                        
    PropertyDescriptor pd = propGrid.SelectedGridItem.PropertyDescriptor;
    pd.ResetValue(propGrid.SelectedObject);
} 
```

我认为 Visual Studio 会做这样的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-05-11T14:22:06.333

注解：PropertyGrid.SelectedObject 在 Childobjects 中返回了错误的 Value（组件）。因此，CanResetValue 方法接收到了不正确的组件。

我的解决方案：

```
private void OnContextMenuOpening(object sender, CancelEventArgs e)
{
  var lGrid = mCurrentControl as PropertyGrid;

  if (lGrid != null)
  {
    var lItem = lGrid.SelectedGridItem;

    // Für untergeordnete Eigenschaften kann nicht SelectedObject verwendet werden
    // Component ist eine interne Eigenschaft der Klasse System.Windows.Forms.PropertyGridInternal.GridEntry
    // ((System.Windows.Forms.PropertyGridInternal.GridEntry)(lItem)).Component
    // Zugriff via Reflection
    var lComponent = lItem.GetType().GetProperty("Component").GetValue(lItem, null);

    if (lComponent != null)
      tsmi_Reset.Enabled = lItem.PropertyDescriptor.CanResetValue(lComponent);
    else
      tsmi_Reset.Enabled = lItem.PropertyDescriptor.CanResetValue(lGrid.SelectedObject);
  }
}

// Contextmenu -> Reset
private void OnResetProperty(object sender, EventArgs e)
{
  var lGrid = mCurrentControl as PropertyGrid;

  if (lGrid != null)
    lGrid.ResetSelectedProperty();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-03-11T11:24:41.137

对于子对象，对包含属性的对象的引用隐藏在类`Instance`的非公共后代的属性中`GridItem`。`ITypeDescriptorContext`值得庆幸的是，这个属性是这些后代类确实实现的接口的成员。因此，有一个解决方案包括在所有属性的上下文菜单中正确启用重置命令：

```
private void contextMenuToolStrip_Opening(object sender, CancelEventArgs e)
{
  var item = propertyGrid.SelectedGridItem;
  resetToolStripMenuItem.Enabled = item != null &&
                                   item.GridItemType == GridItemType.Property &&
                                   item is ITypeDescriptorContext context &&
                                   item.PropertyDescriptor.CanResetValue(context.Instance);
}

private void resetToolStripMenuItem_Click(object sender, EventArgs e)
{
  propertyGrid.ResetSelectedProperty();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-02-24T12:09:46.120

这就是我用来重置我的属性的方法

```
 public static void InitResetContextMenuStrip(this PropertyGrid grid, params string[] resettableProperties)
    {
        if (grid.ContextMenuStrip != null)
            return;

        var menuStrip = new ContextMenuStrip();
        var resetItem = new ToolStripMenuItem("Reset");

        resetItem.Click += (s, e) =>
        {
            try
            {
                if (resettableProperties.Any(p => grid.SelectedGridItem.PropertyDescriptor.Name == p))
                {
                    grid.SelectedGridItem.PropertyDescriptor.SetValue(grid.SelectedObject, null);
                    grid.Refresh(); //redraw the grid to reflect the changes
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
        };

        menuStrip.Items.Add(resetItem);

        menuStrip.Opening += (s, e) =>
        {
            try
            {
                resetItem.Enabled = resettableProperties.Any(p => grid.SelectedGridItem.PropertyDescriptor.Name == p);
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
        };

        grid.ContextMenuStrip = menuStrip;
    } 
```

这就是我使用它的方式：

```
myGrid.InitResetContextMenuStrip(
    nameof(ClassName.PropertyName1),
    nameof(ClassName.PropertyName2)); 
```

信用： http: [//www.windows-tech.info/3/41955b2a405bf481.php](http://www.windows-tech.info/3/41955b2a405bf481.php)

# logging - 电锯 log4j 查看器的远程事件有什么意义？

> ID：744775
> 
> 赞同：5
> 
> 时间：2009-04-13T17:53:38.497
> 
> 标签：logging, log4j, apache-chainsaw

[http://logging.apache.org/chainsaw/quicktour.html](http://logging.apache.org/chainsaw/quicktour.html)

第一个特点。

我完成了本教程，它只是展示了如何直观地使用 GUI，并没有详细介绍这个新功能。我找到的最好的文档是这样的：

> 就像 Appender 在 log4j 环境之外发送日志事件（到文件、到 smtp、到套接字等）一样，接收器在 log4j 环境中带来日志事件。
> 
> 接收器旨在支持从另一个进程接收远程日志记录事件。例如，SocketAppender 将日志事件“附加”到套接字，为特定主机和端口号配置。在套接字的接收端可以是一个 SocketReceiver 对象。SocketReceiver 对象接收日志事件，然后将其“发布”到接收机器上的 log4j 环境（LoggerRepository），由配置的 appenders 等处理。此环境中的各种设置（Logger 级别、Appender 过滤器和阈值) 应用于接收到的日志事件。
> 
> 接收器还可用于将来自其他日志记录包的日志消息“导入”到 log4j 环境中。
> 
> 接收器可以配置为将事件发布到给定的 LoggerRepository。

所以...

**使用链锯 + 简单的 log4j 文件附加程序无法使用这个新组件，我可以实现什么样的日志记录策略？**

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T18:28:38.600

它们是您可以用远程事件做的许多有趣的事情：
- 避免在应用程序服务器上创建文件。文件不好。
- 在多个应用程序服务器的情况下集中日志。
- 从本地环境查看实时生产日志，即使电锯不是很性感，过滤功能也比普通的 vi/grep 更方便。
- 登录数据库而不是文件。文件不好。

而且可能更多！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T19:03:04.697

我过去曾在网格环境中使用过远程事件。

为什么 ？因为我们不知道我们的代码会在哪里运行。我们将部署“n”个作业，网格基础设施将选择在哪些机器上运行这些作业。如果没有远程事件，我们将不得不跟踪这些作业的去向，然后还要麻烦登录、查找日志等。因为网格由用于其他目的的机器组成，我们无法保证这些机器将在以后的日期诊断问题。

因此，一切都被配置为将日志事件流式传输回服务器，我们可以在其中为每个原​​始服务器创建日志文件，并自己管理这些日志。存在诸如管理通过网络流式传输到一台服务器的数据量等问题，但只要您意识到这一点，就可以了。

# project-management - 什么时候应该坚持培训新技术？

> ID：744793
> 
> 赞同：-1
> 
> 时间：2009-04-13T17:56:42.687
> 
> 标签：project-management

天，

我参与了一个项目，该项目需要我熟悉几种新技术，因为项目计划中遗漏了几项任务。我只是想我会潜水并学习完成各种工作所需的知识。一般来说，这种学习是在我自己的时间完成的。

到目前为止，我必须学习的技术列表是：

*   Solaris 10 SMF 和从旧版 rc 目录迁移。
*   Solaris 10 svcadm,
*   Solaris 10 inetadm 和从 inetd 机制的迁移，以及
*   zfs、zpools 和 zfs 快照。

现在我必须学习 Solaris Cluster，因为这对坚持必须参加 Solaris Cluster 课程才能做任何事情的人太忙了，无法提供帮助。

人们在什么时候坚持被派去参加培训课程？你用什么方法来获得这样的培训，你如何证明它的合理性？

顺便说一句，我非常幸运，项目经理知道我必须学习所有这些并且非常感激。我想我会“去邮政”，除了所有额外的学习之外，我有一个永远想知道“为什么要花这么长时间？”的 PM！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T18:11:15.960

如果您的工作要求您从事一些您不精通的技术工作，并且您在所有各方都知道您不了解该技术的情况下从事这项工作，那么雇主 (IMO) 有责任：

*   提供时间让您自己学习材料
*   如有必要，向您发送课程以学习材料
*   获取资源（即书籍）供您参考

但是，如果您需要事先了解材料，那么您有责任完成上述三项任务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T18:06:39.027

所以你学会了用自己的时间做雇主要求的工作（无薪）？你的老板非常感激？嗯嗯。

我的座右铭是——如果我的雇主要求我学习一些新技术——然后给我一些课程或预算，让我自己学习。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T18:10:16.460

我认为一种情况是技术是专有的，并且没有那么多免费的学习材料。为了完成你的工作，你的老板只需要接受培训并支付培训费用（这可能价格过高，但几乎不可能学习其他方法）。

# algorithm - 对产品列表进行分类的算法？拿 2

> ID：744801
> 
> 赞同：15
> 
> 时间：2009-04-13T17:58:37.127
> 
> 标签：algorithm, machine-learning, neural-network, classification

几周前我问了一个[类似的问题，但我没有正确地问这个问题。](https://stackoverflow.com/questions/695347/algorithm-to-classify-a-list-of-products)所以我在这里用更多细节重新提出这个问题，我想得到一个更面向人工智能的答案。

我有一个列表，代表或多或少相同的产品。例如，在下面的列表中，它们都是希捷硬盘。

1.  希捷硬盘 500Go
2.  适用于笔记本电脑的希捷硬盘 120Go
3.  希捷 Barracuda 7200.12 ST3500418AS 500GB 7200 RPM SATA 3.0Gb/s 硬盘
4.  希捷全新闪亮 500Go 硬盘
5.  希捷梭子鱼 7200.12
6.  希捷 FreeAgent Desk 500GB 外置硬盘 银色 7200RPM USB2.0 零售
7.  GE Spacemaker Laudry
8.  马自达3 2010
9.  马自达3 2009 2.3L

对于人类来说，硬盘3和5是一样的。我们可以更进一步，假设产品 1、3、4 和 5 相同，并将产品 2 和 6 放在其他类别中。

在我之前的问题中，有人建议我使用特征提取。当我们有一个预定义描述的小数据集（所有硬盘驱动器）时，它工作得很好，但是所有其他类型的描述呢？我不想开始为我的应用程序可能面临的所有描述编写基于正则表达式的特征提取器，它无法扩展。**是否有任何机器学习算法可以帮助我实现这一目标？**我能得到的描述范围很广，在第一行，可能是冰箱，然后在下一行，是硬盘。我应该尝试走神经网络路径吗？我的输入应该是什么？

感谢您的帮助！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-13T18:34:04.623

您应该同时查看[聚类](http://en.wikipedia.org/wiki/Data_clustering)和[分类](http://en.wikipedia.org/wiki/Statistical_classification)。您的类别似乎是开放式的，因此表明聚类可能更适合该问题。至于输入表示，您可以尝试提取单词和字符[n-grams](http://en.wikipedia.org/wiki/N-gram)。您的相似性度量可能是常见 n-gram 的计数，或[更复杂的东西](http://www.cs.ualberta.ca/~lindek/papers/sim.pdf)。您可能需要手动标记生成的集群。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-13T18:50:47.987

我会看一些[贝叶斯分类](http://en.wikipedia.org/wiki/Naive_Bayes_classifier)方法。这将涉及训练分类器以识别特定单词，以指示产品属于您的类别之一的概率。例如，经过培训，它可以识别出如果产品描述中包含“Seagate”，则有 99% 的可能性是硬盘，而如果产品描述中有“Mazda”，则有 97% 的可能性是汽车。像“新”这样的词可能最终不会对任何分类做出太大贡献，这是您希望它工作的方式。

这样做的缺点是它通常需要相当大的训练数据语料库才能开始正常工作，但您可以对其进行设置，以便在生产时继续修改其百分比（如果您注意到它对某些内容进行了错误分类)，它最终会变得非常有效。

贝叶斯技术最近大量用于[垃圾邮件过滤应用程序](http://www.paulgraham.com/spam.html)，因此最好了解一下它在那里的使用方式。

# cakephp - 事后应用 CakePHP 的翻译行为

> ID：744802
> 
> 赞同：2
> 
> 时间：2009-04-13T17:58:38.313
> 
> 标签：cakephp, internationalization

我正在慢慢学习如何应用 CakePHP 的翻译行为，我想我已经掌握了基础知识，但我正在使用现有数据处理现有项目。Cake 会为我插入新记录真是太好了，但我需要手动（我假设）为一些现有数据插入一些翻译。我的第一个问题：

如果这是我的默认语言和我的核心表中使用的语言，我是否必须在我的 i18n 表中为 en_us 记录？例如，如果 categories.name = 'Entertainment'，我真的需要在 i18n 中创建一个“重复”记录来指示指定“娱乐”的英文翻译吗？经验证据似乎是肯定的，但这似乎需要做很多额外的工作，所以我希望有人能告诉我我遗漏了一些东西。

其次，有没有一种“简单”的方法可以将翻译记录输入数据库？由于在项目过程中添加了语言，因此返回并为遗留数据创建 i18n 记录将非常痛苦。

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-04T02:30:49.943

我知道这是旧的，但由于它没有得到答复，而且我在弄清楚这一点时遇到了一些麻烦，这是我的两分钱：

范围，Cakephp 1.3。

首先，您的应用程序中的每个字段 -> 记录 -> 模型都需要一个 i18n 记录，当然只有具有翻译行为的模型并且只针对指定字段，所以是的，您最终会在实际模型字段和 i18n 表。

此外，您需要为 find 方法指定的任何语言的现有翻译来返回任何内容。这让我感到困惑，因为我还将翻译行为添加到了一个已经开发的项目中，其中包含大量数据。基本上我所做的是创建一个同步方法，以便为每个具有翻译行为的模型的每个字段创建每个翻译。如果我将来添加一种新语言，我将不得不再次运行它。

这是代码：

```
$locales = array( 'spa', 'eng', 'por' );
$models = array( 'Event', 'News', 'Promotion', 'Shop', 'ShopCategory' );

foreach ( $models as $model )
{
    $this->loadModel( $model );
    $records = $this->{$model}->find( 'all', array(
                                                  'fields' => array( "*" ),
                                                  'contain' => FALSE
                                             ) );

    $fields = $this->{$model}->actsAs['Translate'];
    foreach ( $records as $record )
    {
        foreach ( $fields as $field )
        {
            foreach ( $locales as $locale )
            {
                $content = mysql_real_escape_string( $record[$model][$field] );
                $this->{$model}->query( "INSERT INTO `i18n` (`locale`, `model`, `foreign_key`, `field`, `content`) VALUES('{$locale}', '{$model}', '{$record[$model]['id']}', '{$field}', '{$content}');" );
            }
        }
    }
} 
```

提示：使用 locale、model、foreign_key 和 field 键在 i18n 表中创建唯一索引。

因此，既然我已经以所有语言复制了原始数据，我需要能够使用给定语言创建新记录。问题是，如果我用英语创建新记录，我应该可以用西班牙语更新它，但由于没有西班牙语的 i18n 记录，我无法在我的 CMS 中看到该记录，也无法对其进行编辑。我解决这个问题的方法是在创建新记录时为每种语言创建 i18n 记录，但在编辑记录时只使用当前语言进行编辑。

我将此修改用于翻译行为： [http ://bin.cakephp.org/view/1939852942](http://bin.cakephp.org/view/1939852942)

但是这个修改的大多数例子都说你必须在表单中创建表单输入： echo $this->Form->input('name.eng'); echo $this->Form->input('name.spa'); echo $this->Form->input('description.eng'); echo $this->Form->input('description.spa');

我觉得这很烦人，所以我基本上在 app_controller 中做了一个辅助函数来将可翻译字段转换为这个数据结构：

```
function _expandLocalizations( $data )
{
    foreach ( $data as $modelName => $modelData )
    {
        if ( !isset( $modelData[$this->{$modelName}->primaryKey] ) )
        {
            foreach ( $this->{$modelName}->actsAs['Translate'] as $field )
            {
                $translations = array();
                foreach ( $this->languages as $language )
                {
                    $translations[$language] = $this->data[$modelName][$field];
                }
                $data[$modelName][$field] = $translations;
            }
        }
    }
    return $data;
} 
```

并在每个添加方法中：

```
if ( !empty( $this->data ) )
    {
        $this->News->set( $this->data );
        if ( $this->News->validates() )
        {
            $this->News->create();
            $data = $this->_expandLocalizations( $this->data );
            $saved = $this->News->save( $data );
            if ( $saved )
            { 
```

这样我就可以使用传统的形式，如果我添加新的语言我不需要改变视图。我需要修改传统的烘焙添加方法，因为我需要提交的数据进行验证，但修改后的数据用于保存。

最后，我按照以下步骤更改站点/管理员中的语言：http: [//nuts-and-bolts-of-cakephp.com/2008/11/28/cakephp-url-based-language-switching-for- i18n-and-l10n-国际化和本地化/](http://nuts-and-bolts-of-cakephp.com/2008/11/28/cakephp-url-based-language-switching-for-i18n-and-l10n-internationalization-and-localization/)

所以基本上就是这样。1\. 您为数据库中已有的每个数据创建翻译，每个数据都复制到每种语言。2\. 在创建时为新记录创建每个翻译，当然所有的值都相同。3\. 编辑所选翻译中的每条记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T08:07:30.813

我没有第二个问题的答案，但第一个问题的答案似乎是“是”。在挖掘源代码之后，看起来生成查询的 where 子句将结果限制为那些正在检索的字段名称具有当前语言环境的语言环境值的结果。这是相当有限的。

有一张[现有的票](https://trac.cakephp.org/ticket/4886#comment:2)（或与之非常相似的票）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-15T20:44:49.037

至于第一个问题，答案是否定的。即使我一开始也这么认为，也不需要重复数据。

我写了一篇关于它的博客文章来帮助你在那里迷失的灵魂。 [http://kristofferdarj.se/2012/05/cakephp-how-to-actually-use-i18n/](http://kristofferdarj.se/2012/05/cakephp-how-to-actually-use-i18n/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-11-06T09:05:02.623

对多列使用翻译行为会大大降低您的网站速度。我能找到加速它的最简单方法是添加这个索引。这个索引被注释掉了`cakephp/app/Config/Schema/i18n.sql`，我不知道为什么。

```
ALTER TABLE rabotvins_i18n
ADD UNIQUE INDEX I18N_LOCALE_FIELD(locale, model, foreign_key, field); 
```

# java - 这会导致垃圾收集问题吗

> ID：744803
> 
> 赞同：0
> 
> 时间：2009-04-13T17:58:46.783
> 
> 标签：java, garbage-collection, guava

[我在Google Collections](http://code.google.com/p/google-collections/)之上写了一个类似于 DSL 的 Linq

```
 public class IterableQuery {

   public static <T> Where<T> from(Iterable<T> originalCollection) {
      return  new Where<T>( Iterables.transform(originalCollection, IterableQuery.<T>SAME()));
   }

   private static <T> Function<T, T> SAME() {
      return new Function<T, T>(){
         public T apply(T arg0) {
            return arg0;
         }
      };
   }

   public static class SelectOrderBy<T>{

      private final Iterable<T> iterable;

      public SelectOrderBy(Iterable<T> iteable) {
         this.iterable = iteable;
      }

      public  SelectOrderBy<T> orderyBy( Comparator<T> sort ){
          Ordering.forComparator(sort).sort((List< ? extends T>) iterable);
          return new SelectOrderBy<T>( iterable);
      }

      public  <F> Iterable<F> select(  Function<? super T,? extends F> function){
         return Iterables.transform(iterable, function);
      }
      public  Iterable<T> selectEveryThing( ){
         return iterable;
      }
   }

   public static class Where<T>{

      private final Iterable<T> iterable;

      public Where(Iterable<T> iterable) {
         this.iterable = iterable;
      }

      public    SelectOrderBy<T> where(Predicate<T> predicate) {
         return  new SelectOrderBy<T>( Iterables.filter(iterable, predicate));
      }
   }

} 
```

所以我可以以更简洁易读的方式进行查询集合

```
 Iterable<? extends NewOrder > currentlyAssigned = 
         IterableQuery.
          from(orders).
          where(placedInLast10Days).
          orderBy(lastName). 
          select(orderToNewOrder); 
```

我担心这种方法是否会导致迷你对象爆炸并导致一些垃圾收集问题（或任何其他问题）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T18:45:26.173

我相信 Google Collections 的大多数迭代器都使用延迟执行。延迟执行将最小化创建的中间对象的数量，因为它将消除可以为每个调用（where、orderby 等）创建的大多数中间/临时列表。

基本上，在调用 iterator.next() 之前，不会计算 currentAssigned.iterator() 返回的每个元素。在那之前，您的 currentAssigned 迭代只是一组操作，仅此而已。

如果这些对象的持续时间超过单个元素操作的持续时间，您唯一关心的就是迷你对象的爆炸......在这种情况下，峰值内存使用量可能会变得非常大，并且您可能会在非常大的列表上耗尽内存，或者如果您正在转换对象（即在所有字符串或其他东西上调用 ToUpper() ）。仅当 where() 的结果是另一个列表时才会出现这种情况，然后 orderby() 创建了另一个列表，依此类推。

就 GC 处理许多短期对象而言，没有问题。现代 Java 垃圾收集器经过大量优化以处理该确切行为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T18:05:32.353

我认为这取决于变换的行为方式，如果它像一个惰性过滤器，即你不附加对每个结果的引用。那么它的数量超过了OK对象。垃圾收集明智，您不会保留任何隐藏的引用，一旦您丢失了根引用，整个图将变得无法访问并被收集。走的路，这真的很整洁。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T09:51:38.733

垃圾收集器有专门的短寿命对象代码，使用起来非常便宜。基本上偶尔会标记所有可到达的年轻对象，然后一举回收所有其他对象。

# python - Google App Engine--动态创建的模板

> ID：744828
> 
> 赞同：0
> 
> 时间：2009-04-13T18:05:52.960
> 
> 标签：python, google-app-engine, templates, django-templates

我正在尝试为我的应用程序构建一个简单的 CRUD 管理部分。基本上，对于给定的模型，我希望通过模型的属性将模板循环到一个简单的表中（一旦这样做，我实际上可以实现 CRUD 部分）。实现此目的的一种可能方法是动态生成具有特定于该模型的所有必要模板标签的模板。

伪代码：

```
def generate_tamplate(model):
     template.write("<table border='1'>")
     template.write("<tr>")
     for attribute in model:
          template.write("<td>%s</td>" % attribute)
     template.write("</tr>")
     template.write("<tr>")
     for attribute in model:
          template.write("<td>{{ %s.%s }}</td>" % model.attribute)
     template.write("</tr>")
     template.write("</table>") 
```

生成正确的文本应该不难。我可以按照我的伪代码模型用 Python 来做。我想知道两件事：1）我可以使用 Django 的模板语言来代替吗？也就是说，使用模板生成模板 2）一旦我生成了文本，我怎样才能将它写入 webapp 的模板加载器可以访问的文件？

我记得不久前看到有关从数据库加载模板的一些信息。这可能与 GAE 吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T13:19:06.980

是的`template.writes`，您可以生成下一个模板，而不是这样做 - 因为`template.render(...)`只返回文本。然后，您可以存储返回的文本并将其放入 DataStore，然后稍后检索它并调用`.render(Context(...))`它以返回您要生成的 html。

您不能将生成的模板写入文件 - 因为 AppEngine 应用程序没有文件系统的写入权限，只有读取权限。

如果你改变你的' `generate_tamplate`'函数来使用一个模板，伪代码可能是这样的：

```
from google.appengine.ext.webapp import template

def generate_tamplate(model):
    t = template.render(path_to_template1.html, Context({'model':model}))
    DataStoreTemplate(template=t, name=model.name).put()

''' Later, when you want to generate your page for that model '''
def generate_page(model):
    t = DataStoreTemplate.all().filter("name =",model.name).get().template
    htmlresult = t.render(Context({'model':model}))
    return htmlresult 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T23:40:59.427

不久前我看到了这个开源项目： [http ://code.google.com/p/gae-django-dbtemplates/](http://code.google.com/p/gae-django-dbtemplates/)

使用模板生成模板应该没问题。只需将模板呈现为字符串。这是我使用的一些代码，因此我可以将一些 xml 粘贴到 memecache 中

```
path = os.path.join(os.path.dirname(__file__), 'line_chart.xml')
xml = template.render(path, template_values) 
```

您可以轻松地做一些非常相似的事情并将结果保存在数据存储中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-16T09:08:46.800

其他选项，在我看来，可以大大简化为 GAE 编写应用程序，使用用户其他模板语言，如[Mako](http://www.makotemplates.org/)，它允许您在模板中嵌入 Python 代码，因此不需要摆弄。您可以将模型数据传递给模板（就像 一样简单`template.render(template_file, model=model`），模板看起来像这样：

```
<table border='1'>
  <tr>
      % for attribute in model:
        <td>${attribute}</td>
      % endfor
  </tr>
  <tr>
      % for attribute in model:
        <td>${model.attribute}</td>
      % endfor
  </tr>
</table> 
```

我按照[这个谷歌搜索的博客条目](http://blog.pansapiens.com/2008/06/24/mako-templates-in-google-app-engine-seems-to-work-for-me/)在我的应用程序中获取了 Mako - 它非常简单，并且就像一个魅力。

# c# - 将脚本语言集成到 C# 应用程序是否有意义？

> ID：744840
> 
> 赞同：6
> 
> 时间：2009-04-13T18:10:57.410
> 
> 标签：c#, .net, scripting

我一直在考虑将 Ruby 集成到我的应用程序中，但我工作中的一些朋友告诉我，C# 已经非常高级了。但对我来说，它似乎有更多的包袱来做非常快的事情。

你们有什么感想？

此外，如果我确实进行了集成，那么限制它是否有意义，以便您可以使用应用程序的现有功能做任何事情，但不能扩展它？

这样做的原因是，脚本语言不以性能着称，如果你说让人们编写模糊、对比度等过滤器，那么这些会比它们应该的要慢得多，并且会降低脚本编写者客户的体验， 正确的？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T18:17:02.200

我已经将（lua）脚本集成到应用程序中，并且我还使用 c# 本身作为“脚本语言”，通过从用户提供的代码动态编译动态程序集。我还使用符合特定接口或基类的用户提供的程序集实现了“插件”系统。

有很多事情需要考虑，从安全性到性能，再到最终用户的困惑。我不认为你可以做出一个笼统的陈述，比如“脚本语言不属于应用程序”，甚至“脚本语言属于应用程序”。任何给定的特定情况都需要仔细考虑所有选项以及这些选项的后果，然后再跑掉并做一些你以后可能会后悔的事情。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-13T18:17:37.893

当通过脚本接口而不是本机应用程序实现给定功能时，可能会对性能造成影响，但是如果您希望允许用户编写应用程序脚本并允许他们实现对他们有用的功能您的应用程序本身不支持，那么这对我来说似乎是个好主意。如果你最终得到了一个非常流行的特定用户脚本，如果你可以改进它的性能，你总是可以在以后的版本中将它作为你的应用程序的原生功能发布。希望这可以帮助！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-13T18:20:05.797

我喜欢能够编写脚本来扩展应用程序的功能。如果脚本语言是众所周知的，那就更好了。

我不会基于对性能的担忧来限制脚本可以执行的功能。例如，您不知道某些东西在未来的硬件上会如何表现；但是，您应该限制它可以为安全/功能做的事情。

如果您有性能问题，那么我会通过脚本实现扩展点，也可以通过允许执行和运行编译代码的插件来实现。

# 编辑

一般来说，我认为它不会再引入漏洞，然后通过插件扩展应用程序。至于具体的漏洞，我真的不能不知道你的应用程序是什么。但以网络浏览器为例。IE 有很多安全漏洞，因为脚本可以访问比它们应该访问的更多的资源。

强制通过编译代码完成扩展确实允许您利用机制来帮助防止攻击。例如，您可以检查一个程序集（假设 .net 在这里）。轻松查找恶意代码（是的，您也可以使用脚本来执行此操作），或者您可以阻止对某些资源的访问 cia Code Access Security。您还可以利用代码签名，并且只加载来自受信任的发布者的插件。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-13T18:33:00.947

根据您要完成的工作，您可能会喜欢**PowerShell**所提供的功能。您可以使您的应用程序成为自定义 PowerShell 脚本主机，或者只提供操作应用程序的 cmdlet。

无论哪种情况，您的用户都可以从具有内置 .NET/COM/WMI 支持的丰富、强大、合理的脚本语言中受益，但他们不必是开发人员即可使用它。

您还建立在您的用户可能已经拥有的技能之上。如果他们还没有它，他们可以为您的应用程序学习它，然后在将来从中受益。

Exchange Server 2007 实现了一个自定义脚本主机，如果您想查看一个如何工作的示例。

# c# - 使用不安全代码导入类

> ID：744842
> 
> 赞同：0
> 
> 时间：2009-04-13T18:12:05.787
> 
> 标签：c#, garbage-collection

例如，我有一个第三方类，其方法中有不安全的代码。它会进行一些内存更改，并且不会自行清除内存。它发生了，我必须使用这个类，它是不安全的方法。请你解释一下，在下一次垃圾收集器通过后，那些由不安全代码写入的字节会发生什么。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T18:18:21.947

垃圾收集器不会碰它们。一方面这很好，因为您不必担心它会干扰非托管代码。另一方面，如果您不自己清理它们，那就是内存泄漏。

每当您使用分配内存的不安全代码时，我都会将其包装在实现 IDisposable 的对象中。如果第三方类尚未实现 IDisposable，我将创建一个新类来封装该功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T18:14:50.473

.NET 垃圾收集器不会对这些字节做任何事情，因为运行时没有分配它们。他们只会被泄露。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T18:15:31.533

什么都没发生。使用不安全的代码和内存分配，由不安全的代码来正确释放系统资源。

# linq-to-sql - Linq to SQL - 当子对象更改时更新父对象上的计算字段（如“小计”）

> ID：744850
> 
> 赞同：0
> 
> 时间：2009-04-13T18:14:24.843
> 
> 标签：linq-to-sql

我有一个 L2S SalesOrder 实体，其中包含一组子 LineItems。使用 winforms，在我的销售订单表单上，我有一个绑定到 LineItems 的 datagridview，它像梦一样工作。如果用户更改 LineItem 数量（例如），我的 LineItem 部分类会处理 OnQuantityChanged 并重新计算 LineItem SubTotal 字段，并且网格会自动更新。我对它的干净整洁感到欣喜若狂。

现在我想在我的 SalesOrder 对象上有一个名为“Total”的计算字段，它是所有 LineItems 的 SubTotal 字段的总和（加上一些其他的东西，比如税收和运费，但现在不要担心）。每当更改 LineItem 时，自动更新 SalesOrder 的 Total 字段的最佳/最干净的方法是什么？如果有人能指出我正确的方向，我将不胜感激。

不知道它是否有所作为，但我正在使用[Rick Strahl 的 Linq To SQL 业务框架](http://www.west-wind.com/WebLog/posts/246690.aspx)（这太棒了，顺便说一句！）。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T18:29:04.370

您可能想查看[Bindable LINQ](http://www.codeplex.com/bindablelinq)：

> 可绑定 LINQ 是 LINQ 的一组扩展，可为标准 LINQ 查询添加数据绑定和更改传播功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-04T02:11:21.613

这实际上比我想象的要容易。我将 ReCalculate() 添加到了我的 SalesOrder 中，然后我可以像这样从我的 LineItem 中调用它...

```
Partial Class SalesOrderLineItem
    Private Sub OnQuantityChanged()
        RefreshMySubTotal()
    End Sub
    Private Sub OnUnitPriceChanged()
        RefreshMySubTotal()
    End Sub
    Private Sub RefreshMySubTotal()
        Dim dNewSubtotal As Decimal = 0
        dNewSubtotal = Me.Quantity * Me.UnitPrice * (1 - (Me.Discount * 0.01))
        If Me.SubTotal <> dNewSubtotal Then
            Me.SubTotal = dNewSubtotal
            If Me.SalesOrder IsNot Nothing Then Me.SalesOrder.ReCalculate()
        End If
    End Sub 
```

# openid - DotNetOpenId ClaimedIdentifier - 硬编码是否安全？

> ID：744855
> 
> 赞同：2
> 
> 时间：2009-04-13T18:15:22.470
> 
> 标签：openid, dotnetopenauth

我正在尝试使用 OpenID 来允许我通过 Google 登录我的网站。最终它会被访问者使用，但现在它只是硬编码为谷歌来验证我自己的登录。

我的代码如下所示：

```
var openId = new OpenIdRelyingParty();

// If we have no response, start
if (openId.Response == null)
{
    // Create a request and send the user off
    openId.CreateRequest("https://www.google.com/accounts/o8/id").RedirectToProvider();
}
else
{
    // We got a response - check it's valid
    if (openId.Response.Status == AuthenticationStatus.Authenticated
        && openId.Response.ClaimedIdentifier == "blah_blah")
    {
    }
} 
```

现在，我有几个问题：

1.  运行一次是否安全，捕获 ClaimedIdentifier 并将其放入其中。会永远一样吗？

2.  在那里对其进行硬编码是否安全（它是秘密的吗？如果用户确实看到了它，那会损害任何东西吗？用户可以伪造吗？只能 Google 导致以他们的 url 开头的 ClaimedIdentifiers 吗？）

我已经尝试过这些文档，但它们有点稀疏，我无法找到这些问题的答案。

**编辑：**我可能已经回答了我自己的问题。我在我的网站 (openid.delegate) 上使用了元标记，这样我就可以使用我的博客网址而不是讨厌的 Google 网址登录。当我通过 Google 登录时，它返回 ClaimedIdentifier 作为我的博客网址。这让我觉得任何人都可以访问我的登录页面，以他们自己的 Google 帐户登录，然后使用我自己的 ClaimedIdentifier 将他们返回到我的博客。

3.  当 ClaimedIdentifier 看起来很容易伪造时，我应该如何验证用户？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T21:39:10.607

是的，存储 Claimed Identifier 是安全的，并且该值不是秘密的，因此如果其中包含 claim_id 值的代码被泄露，这不是安全妥协。

是的，它必须始终相同，否则用户无法重新获得对他们创建的帐户的访问权限。话虽如此，Google 的独特之处在于，如果您的网站的 Realm URL 发生变化，Google 会开始将所有新的 claim_id 发送到您的网站。所以只要领域保持不变，claim_id 也会保持不变。由于您使用的是 DotNetOpenId，因此默认领域只是您的网站根 URL，因此除非您更改托管网站的 URL，否则它可能会保持不变。

正如您所确定的，claim_id 不能轻易伪造。如果是这样，那么 OpenID 就真的没用了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T19:50:38.247

在搞砸了很多事情之后（并且有一个朋友尝试以我的身份登录），我想我有答案了......

我网站中的标签包含我的 Google 用户名，如果我尝试使用我的博客 URL 以其他用户身份登录请求，它似乎失败（在 Google 中没有将我发送回我正在登录的网站，而不是它将我退回失败）。

这让我认为返回我自己的 url 作为 ClaimedIdentity*是*安全的，不能被伪造等等。

# sharepoint - Sharepoint webpart 中gridview 的服务器端分页

> ID：744859
> 
> 赞同：2
> 
> 时间：2009-04-13T18:16:01.673
> 
> 标签：sharepoint, gridview, datatable

我在**SharepPoint webparts**中自定义了一些控件。我使用**GridView**控件来利用内置的分页和列排序。**GridView**从一个方法中获取数据绑定，该方法通过一个（使用循环）迭代来`SPlist`构建**`foreach`**一个**DataTable**。在显示在网格中之前，需要对列表进行循环以应用逻辑来处理列表。

随着列表变大，页面需要更长的时间（永远）加载。即使分页允许**GridView**仅显示 12 行数据，我相信`foreach`循环正在处理整个列表。

我已经使用 SQL 和 nHibernate 在 .Net 中完成了服务器端分页。**在SharePoint**中应该可以做到这一点，对吧？我正在寻找一些指导、示例代码或任何类型的方向。即使是明确的“你是个白痴”也会有所帮助。

以前有人做过吗？或者，是否有人可以提出替代的数据绑定方案？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T18:39:41.897

如果可以使用 SPQuery 获取数据，则可以使用 RowLimit 和 ListItemCollectionPosition 属性。

[http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splistitemcollectionposition.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splistitemcollectionposition.aspx)

[http://www.zimbio.com/SQL/articles/625/Paging+SPList+Sharepoint](http://www.zimbio.com/SQL/articles/625/Paging+SPList+Sharepoint)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T19:25:25.110

SharePoint 下的分页与 ASP.NET 中的分页基本相同，如果存在速度差异，我会将其归因于您的 SharePoint 数据源，而不仅仅是 gridview 在 SharePoint 中运行的事实。

您的数据绑定是否超出了您的需要？

您可以将数据缓存在 Page.Cache 对象中，并在删除或更新之类的操作弄脏数据时销毁缓存副本。

# windows - 在命令行上使用 VS2008 部署 SharePoint 失败

> ID：744860
> 
> 赞同：2
> 
> 时间：2009-04-13T18:16:54.260
> 
> 标签：windows, visual-studio-2008, sharepoint, command-line, deployment

我正在尝试为我们的 SharePoint 解决方案实现一个夜间构建环境，其中包括适用于 Windows SharePoint Services 3.0（版本 1.2）的 VS 2008 和 VS 2008 扩展。当我通过 VS 2008 GUI 进行部署时，它工作正常。当我使用命令行时：

```
c:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\devenv.exe SharePoint.sln /Deploy Release 
```

我收到以下错误：

```
------ Deploy started: Project: SharePoint.Site, Configuration: Release Any CPU ------
------ Generate solution file and setup batch file ------
Creating solution ...
System.NotImplementedException
Error: The method or operation is not implemented. 
```

其他人似乎也有[类似的问题](http://social.msdn.microsoft.com/Forums/en-US/sharepointdevelopment/thread/5241b654-49b1-407f-aa6d-f4a739cc9b3b)。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T21:52:06.613

VSeWSS 1.2 不支持命令行构建。我要么尝试[VSeWSS 1.3 的 CTP，](http://www.microsoft.com/downloads/details.aspx?FamilyID=FB9D4B85-DA2A-432E-91FB-D505199C49F6&displaylang=en)要么尝试像[STSDev](http://stsdev.codeplex.com/)或[WSPBuilder](http://wspbuilder.codeplex.com/)这样的社区工具。

# django - 未找到反向：从模板发送请求上下文

> ID：744866
> 
> 赞同：3
> 
> 时间：2009-04-13T18:17:57.690
> 
> 标签：django, django-urls

注意在给出第一个答案之前，这个问题已经过大量编辑。

你好，

我对 django 还很陌生，如果我遗漏了一些明显的东西，我深表歉意。

我有一个如下所示的 urls.py 文件：

```
urlpatterns = patterns(
    '',
    (r'^$', 'faros.lantern.views.home_page'),
    (r'^login/$', 'django.contrib.auth.views.login'),
    (r'^logout/$', 'django.contrib.auth.views.logout'),
    (r'^about/$', 'faros.lantern.views.about_page_index', {}, 'about_page_index'),
    (r'^about/(?P<page_id>([a-z0-9]+/)?)$', 'faros.lantern.views.about_page', {}, 'about_page'),
) 
```

看起来像这样的视图：

```
def about_page_index(request):
    try:
        return render_to_response('lantern/about/index.html', context_instance=RequestContext(request))
    except TemplateDoesNotExist:
        raise Http404

def about_page(request, page_id):
    page_id = page_id.strip('/ ')

    try:
        return render_to_response('lantern/about/' + page_id + '.html', context_instance=RequestContext(request))
    except TemplateDoesNotExist:
        raise Http404 
```

还有一个包含以下内容的模板：

```
<a href="{% url lantern.views.about_page_index %}">Contact</a>
<a href="{% url lantern.views.about_page page_id="contact" %}">Contact</a> 
```

我收到此错误消息：

```
Caught an exception while rendering: Reverse for '<function about_page at 0x015EE730>' with arguments '()' and keyword arguments '{'page_id': u'contact'}' not found. The first reverse works fine (about_page_index), generating the correct URL without error messages. 
```

我认为这是因为使用了 about_page view( `request`) 的 request 参数，所以我需要在模板中生成 URL 时将其传入。问题是，我不知道如何找到它，四处寻找也无济于事。有任何想法吗？

谢谢，

多姆

ps 顺便说一句，在应用程序中处理静态“关于”类型页面的方法看起来是可怕的还是合理的？我本质上是在获取 URL 并假设模板的路径是`about/`位之后的任何内容。这意味着我可以使静态页面看起来像应用程序的一部分，因此用户可以跳转到 about 部分，然后直接返回到它们的来源。评论/反馈这是 djangoic 还是愚蠢的赞赏！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-13T19:58:27.683

如果我从您的视图函数 ( ) 的签名中猜对了`def about_page(request, page_id = None):`，您可能有另一个 URL 配置指向同一个视图但不带`page_id`参数。如果是这样，django reverse 函数将只看到其中一个，并且可能会看到没有命名`page_id`正则表达式模式的那个。这是一个非常常见的反转问题！:-)

要解决此问题，请为每个 url 模式分配一个名称（请参阅[urlpatterns 变量的语法](http://docs.djangoproject.com/en/dev/topics/http/urls/#syntax-of-the-urlpatterns-variable)）。在您的示例中，您将执行以下操作：

```
(r'^about/(?P<page_id>([a-z]+/)?)$', 'faros.lantern.views.about_page', 
 {}, 'about_with_page_id') 
```

然后在模板中：

```
<a href="{% url about_with_page_id page_id="contact" %}">Contact</a> 
```

* * *

**编辑**

感谢您发布更新的 urls.py。在`url`模板标签中，使用不合格的模式名称应该可以解决问题（请注意，我正在删除`lantern.views`部分：

```
<a href="{% url about_page_index %}">Contact</a>
<a href="{% url about_page page_id="contact" %}">Contact</a> 
```

* * *

**编辑2**

我很抱歉我没有早点关注这个。您的模式以 django 无法反转的方式表达，这就是导致不匹配的原因。代替：

```
r'^about/(?P<page_id>([a-z]+/)?)$' 
```

采用：

```
r'^about/(?P<page_id>[a-z0-9]+)/$' 
```

我在我的系统上创建了一个与您的系统匹配的虚拟项目，重现了错误，并将此更正插入成功。如果这不能解决你的问题，我会吃掉我的帽子！:-)

# subsonic - 从枚举表中填充字段

> ID：744867
> 
> 赞同：0
> 
> 时间：2009-04-13T18:18:07.517
> 
> 标签：subsonic

我有以下表格

**实体**
id,name,categoryid
21,"Blah",1

**EntityCategory** (枚举表)
id, name
1,"New Blahs"

我在 Entity->categoryid 和 EntityCategories->id 之间有 FK 关系

**我已经为实体类 Entity{ID,Name,CategoryName}**生成了 SubSonic 类以及相应的模型对象

 **我正在尝试返回填充了类别名称的 Model.Entity 类型，即

```
public Entity GetEntityByName(string name){
  return new 
    Select(
      Entity.IdColumn,    
      Entity.NameColumn,
      EntityCategory.NameColumn)
   .From(Entity.Schema)
   .InnerJoin(Tables.EntityCategory)
   .Where(Entity.NameColumn).IsEqualTo(name)
   .ExecuteSingle<Model.Entity>(); 
```

不用说这是行不通的。我实际上得到了一个 Model.Entity，Entity.Name 设置为 EntityCategoryName。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-13T19:49:04.053

如果您使用 SubSonic 3.0，您可以使用投影来执行此操作：

```
var result = from e in db.Entities
where e.ID=1
select new Entity{
   ID=e.ID,
   name=e.Name, 
   CategoryName=(CategoryName)e.CategoryID
} 
```

使用 SubSonic 2.x，我想说让您自己轻松并使用只读枚举扩展部分类：

```
public partial class Entity{
   public CategoryName{
     return (CategoryName)this.CategoryID;
   }
} 
```

# windows - 如何更改年龄不匹配的 PDB 以正确匹配？

> ID：744870
> 
> 赞同：33
> 
> 时间：2009-04-13T18:19:10.853
> 
> 标签：windows, windbg, symbols, pdb-files, symbol-server

我们的夜间构建过程被破坏了很长时间，以至于它生成的 PDB 文件与相应的图像文件的年龄相差几个小时。我已经解决了这个问题。

但是，我想开始使用符号服务器，但由于必须使用这些年龄不匹配的 pdb 文件而不能。我通过在 windbg 中使用 .symopt +0x40 方法解决了这个问题。这意味着我必须手动组织我所有的 pdb 文件，并且经过多年的发布，这些文件加起来。

我正在寻找一种方法来修改 windbg 用来标记 pdb 年龄的机制，并强制它与我的图像文件匹配。实用程序[ChkMatch](http://www.debuginfo.com/tools/chkmatch.html)执行类似的操作，但用于 pdb 签名。开发人员在页面“ChkMatch 能够使可执行文件和 PDB 文件匹配，如果它们具有不同的签名但相同的年龄（有关 PDB 签名和年龄的更多信息，请参阅本文）。如果年龄不同，该工具无法使文件匹配。”

我查看了 hexeditor 内部，甚至找到了与年龄相对应的位，但它必须在内部提取更多技巧，因为我无法让它工作。

有任何想法吗？

**编辑**：我不知道这是否有帮助，但在我的特殊情况下，年龄差异是由不必要的重新链接 dll 引起的，这也会重新创建 PDB 文件。但是，我们的构建过程是存储原始 dll（重新链接之前）和重新链接之后的 pdb。我想过以某种方式手动重现这种情况。意思是，强制重新链接 DLL，但在两种情况下都保存 pdb。然后我可以对这两个文件进行二进制比较，看看它们是如何变化的。也许运行某种自动执行此操作的修补软件？通过查看我的控制案例中究竟发生了什么变化，也许我可以对保存在我公司构建过程中的 DLL 和 PDB 做同样的事情？

**编辑**：我想通了！！！！感谢对第一个答案的评论之一，我查看了“未记录的 Windows 2000 秘密：程序员食谱”一书的 pdf 链接。作者详细介绍了 pdb 文件格式。正如我之前所说，我已经将 pdb 加载到十六进制编辑器中并翻转了一些位，似乎我进行了年龄/签名匹配，但它不起作用。好吧，在使用 W2k 机密书中的实用程序将 pdb“爆炸”到包含的流中之后，我发现它们在流 3 中隐藏了另一个对年龄的引用！！！！！！！！！！一旦我也翻转了那个，它就在windbg中匹配了。这是巨大的！！！！非常感谢....符号服务器我来了！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-14T10:05:53.293

windbg 不会修改 pdb 的年龄 - 它只会查找它以匹配可执行文件的年龄 - 编译器在它（重新）生成可执行文件和调试文件时会这样做。

现在，根据 debuginfo.com 文章，到达正确的调试目录（codeview 类型），将其与 PDB7 签名匹配并修改可执行文件中的年龄或 GUID 并不难。为什么这不是一个选择？

我想，你想更新 pdb 吗？恐怕，pdb 是一种专有格式。有多个只读 API（dbghelp.dll 和 dia sdk），但就修改而言，您需要猜测细节才能修改。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-12-07T21:05:34.607

或者您可以使用此处的建议让 windbg 忽略不匹配的签名和年龄：

[http://www.debuginfo.com/articles/debuginfomatch.html](http://www.debuginfo.com/articles/debuginfomatch.html)

> ...虽然默认情况下 [windbg] 也不允许加载不匹配的调试信息，但 .symopt 调试器命令可以更改默认行为。在我们发出“.symopt+0x40”命令后，调试器将愉快地接受并加载不匹配的 PDB 和 DBG 文件。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-09-03T11:28:55.400

虽然正如 SamB 所说，在 PDB 中（格式 7，我的测试是基于 VS2010 生成的 .exe 和 .pdb，以及 windbg 6.9.0003.113 X86）有一个额外的年龄参考，所以在 PDB 文件中总共会有 3 个年龄需要修改. 不幸的是，SamB 没有告诉我们如何找到魔法 3rd age，stream 3？不！根据我的测试，我提取了 100 多个 pdb 流，我尝试了 02（如果 SamB 是 0 索引）和 03，两者都找不到年龄。

只要你有一个十六进制编辑器和windbg，修复其他两个年龄就很容易了。

*   查找 GUID 和年龄

使用 symchk 获取不匹配的 PDB 文件的签名（GUID）： symchk your.exe /v /s 。

通常输出将包含：

```
[SYMCHK] ------------------------------------
SymbolCheckVersion  0x00000002
Result              0x00010001
DbgFilename         CPP_Snippet.dbg
DbgTimeDateStamp    0x00000000
DbgSizeOfImage      0x00000000
DbgChecksum         0x00000000
PdbFilename         E:\zrf\C_CPP\CPP_Snippet.pdb
PdbSignature        {6D8D99B0-E96B-4093-9D97-8BDC5152B6E0}
PdbDbiAge           0x00000188 
```

*   修复 2 个更容易的年龄

搜索 GUID 的最后一部分：8BDC5152B6E0，因为只有最后一部分与大端/小端问题无关，它与 pdb 文件中的完全相同。小心搜索原始十六进制值，以使其更准确，您应该验证 GUID 中的其他值（需要在 X86 中反转字节顺序）完全匹配。在 PDB 文件中将恰好找到 2 个 GUID，伴随的年龄正好在 GUID 的第一个字节之前。修改它。就是这样！

*   我用粗鲁的方法找出第三个年龄。

    转储 PDB 文件的十六进制数，每行一个字节（2 个十六进制数）。od -v -t x1 your.pdb | sed 's/^[0-9a-f]* //;s/ /\n/g' > age_offset.txt

    获取每个匹配年龄的行号，在我的情况下，它是 4 个连续行，其值为 88 01 00 00，vim age_offset.txt :g/88\n01\n00\n00/s/^/\= (line('. ') . ':')/

    这是一个 ex 模式命令，最近版本的 vim 应该支持它。

    :v/:/d

    这将删除所有不包含'：'的行，剩余的行是行号，它是每个匹配年龄的偏移量。

    :%s/:.*//

    这将修剪 :88 并单独留下偏移量。

    :%s/.*/\=(子匹配(0) - 1)/

    该命令将每个数字减 1，我这样做是因为 vim 中的行号是 1-index，并且每个年龄的字节偏移量应该是 0-index 以使同事实用程序满意。

    :w

    保存文件

    现在我们得到一个文本文件，每一行都包含一个十进制数，代表一个偏移量，从这个偏移量开始，接下来的 4 个字节就是你梦想年龄的候选。

    接下来，我尝试修改每个潜在的年龄，然后尝试通过 symchk 检查它直到匹配，每次只修补一个偏移量。

    首先，我将备份一个修改了 2 个年龄（和 GUID）的 PDB。我们称之为 ori.pdb

    这是完成艰苦工作的批处理脚本：

> ```
> for /F usebackq %%i in (`type age_offset.txt`) DO (
>   copy /y ori.pdb CPP_Snippet.pdb
>   @rem dd if=ori.pdb bs=1c count=4 skip=%%i | xxd -g1 | grep "88 01 00 00" || echo "Bad data at %%i" && goto exit
>   dd if=pdb_age.dat of=CPP_Snippet.pdb bs=1c count=4 seek=%%i conv=notrunc
>   symchk CPP_Snippet.exe /s . && echo "Found it at offset %%i" && goto exit
>   )
> :exit 
> ```

幸运的是，我在第 38 个偏移处找到了正确的位置。

这不是尝试错误修复要修补的正确偏移量的最快方法，但它对我有用，这是我的原型，以确保只有 1 个额外的年龄需要修复，否则，可能的组合是巨大的（我有 111 个年龄候选人尝试），因此尝试错误的方式不实用。

我认为编写一个实用程序以更快的方式完成相同的工作非常容易。

顺便说一句：根据我的测试。chkmatch 可能会报告匹配，而 symchk 和 windbg vs 认为它​​不匹配。

windbg 命令 !itoldyouso 匹配，而 .reload /f your_module.exe 仍然无法匹配。

修复了3个年龄后，不仅windbg，Visual Studio也可以加载pdb文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-04-03T05:11:35.007

使用[symopt](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/-symopt--set-symbol-options-)命令启用[SYMOPT_LOAD_ANYTHING](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/symbol-options#symopt-load-anything)：

```
.symopt+ 0x40 
```

从[文档](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/symbol-options#symopt-load-anything)：

> 此符号选项减少了符号处理程序在尝试匹配符号时的挑剔性。
> 
> 此选项在所有调试器中默认关闭。调试器运行后，可以分别使用`.symopt+0x40`或打开或关闭它`.symopt-0x40`。
> 
> 此选项在 DBH 中默认关闭。`symopt +40`DBH 运行后，可分别使用或开启或关闭`symopt -40`。

有关更多信息，请参阅[http://ntcoder.com/bab/2012/03/06/how-to-force-symbol-loading-in-windbg/](http://ntcoder.com/bab/2012/03/06/how-to-force-symbol-loading-in-windbg/)

# database-design - 客户和供应商数据库设计问题

> ID：744871
> 
> 赞同：5
> 
> 时间：2009-04-13T18:19:35.627
> 
> 标签：database-design

我正在开发一个 Web 应用程序，我将在其中拥有客户和供应商。

最初我考虑使用客户表和供应商表。

然后当我考虑银行交易时，我注意到每笔交易都需要引用客户或供应商，所以我想使用一个名为 Business 的表，我将在其中保存客户和供应商。

如果我想列出银行交易时使用客户和供应商表，我将不得不在这两个表中搜索以获取公司名称。

如果我使用业务表，我将不得不使用业务类型列，并为所有业务类型合并可能的字段。

对设计有什么建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-05-29T07:07:24.087

客户和供应商。错误的。它是供应商和买家 - 标准商业业务关系的两个方面。术语“客户”是一个仅对营销部门有用的概念——它的含义是基于上下文的，因此对于任何特定的业务流程来说都太抽象了。仅当您将客户定义为一种关系类型（例如“买方”）时，它才会起作用——这似乎毫无意义且令人困惑。

一个组织/个人可能存在于两个阵营中的想法完全是巧合。如果业务要求您知道给定的一方存在于两个业务关系中，那么他们必须能够以某种方式控制此信息 - 并且控制方法必须由业务决定 - 您无法发明它。必须有一个业务规则，使业务能够知道并记录同一方涉及两个不同的方面。

如果业务规则不支持，则无法创建有效的数据结构。真的就是这么简单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T18:24:49.110

您需要问的问题是客户和供应商之间共有哪些信息。如果信息（以及该信息的*使用*）大致相同，那么将它们存储在同一个表中可能是可以的。如果信息（或其使用）有很大不同，那么您可能应该将它们分开存储，并在包含银行交易所需的任何内容之间创建一个通用视图。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T18:25:29.590

问题是，您的客户也可以是供应商吗？在许多企业中，客户是向您购买的实体，供应商是向您销售的企业，同一实体可以在不同时间做这两件事。在金融行业，这些被称为“交易对手”，我从未见过将它们区分为不同表格的金融交易系统。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T18:23:30.703

您的两个想法都是对您的问题的有效和正确的解决方案。要知道正确的答案，您需要考虑您的应用的预期使用模式来决定哪个更可取。例如，您是否会比单独列出客户和供应商更频繁地列出所有银行交易？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T18:26:14.863

这个问题的答案在于两个方面：a）这两种类型的对象（客户和供应商）只是同一枚硬币的两个面，还是根本不同，b）它是否会产生更易于维护、更合理的数据库模式？

您必须从业务逻辑的角度和核心 RDBMS 的角度考虑影响。能够在 Transaction 表中为 Customer 和 Supplier 表定义外键是否有价值？

您真的要在您的应用程序中进行搜索，其中客户结果和供应商结果会混合在一起吗？如果是这样，我建议只创建一个合并公共部分并将表格分开的视图。请记住，其他信息，例如地址或电话号码，可以存储在其他谨慎的表中，因此许多常见信息现在将被重构掉。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T19:16:30.000

我不想重复其他人所说的话，但想在您的客户和供应商的特定用例中添加这一点，根据您的领域需要注意的一件事是客户可能是供应商。

假设我们正在处理销售汽车零件。经销商是客户，因为他们确实从其他经销商处购买零件（例如，当零件延期交货时）。因此，经销商既可以是客户，也可以是供应商。

我通常喜欢通过定义业务或公司实体来模拟客户供应商关系，这定义了我们正在处理的对象。姓名、地址等。然后我会定义一个客户，客户是企业，客户是企业的客户，这样您就可以知道客户是谁，客户也属于谁。然后，您可以使用有关该关系的其他信息来装饰您的客户。

您可以对供应商做同样的事情。您也可以将其抽象出来并拥有一个单一的关系表，但它会变得复杂，并且您会失去一些含义而没有太多收获。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-13T19:30:20.947

我认为您的最佳答案来自用户域。是否有任何客户和供应商信息由相同的用户（在相同的角色中）共同维护？如果是这样，如果他们可以在一个地方为这两个目的更改信息，对他们来说会更容易。如果没有，你让他们改变彼此的数据，这不会让任何人高兴。

如果您有单独的采购和销售系统，并且需要与它们交互，也会出现同样的问题；或拥有一个企业系统（在这种情况下，您可能应该匹配它的功能。）

问题 - 您是从用例或用户故事中得出您的需求还是...？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-03-17T15:39:41.853

如果您想做出正确的决定 - 您必须考虑三种情况（谈论 RDBMS）：

1.  第一种情况：查询速度（必须是简单的查询才能有速度）；在这种情况下，如果您只想列出一项业务的所有银行交易，我会制作一张表 - 业务。

2.  案例二：复杂会计信息系统的数据库设计；在与会计有关的付款订单条目的基础上获得的主要报告： 2.1。基于付款订单项目的应付帐款AP；2.2\. 基于付款订单项目的应收账款 AR；2.3\. 与复式簿记核对（在帐户分类帐中进行的条目） 2.4。作为供应商的税务管理（基于付款订单项目） 2.5。作为供应商的工人（基于付款订单项目）我会为客户制作一张桌子，为供应商制作另一张桌子。在这种情况下，您必须在表中有两个字段用于支付订单项目（一个 ID 字段用于客户，另一个字段用于供应商，以提高查询速度）。

3.  第三：简单业务的数据库设计；根据支付订单中的条目获得的主要报告： 3.1。基于付款订单项目的应收账款 AR；3.2\. 作为供应商的税务管理（年度利润税）；我会制作一张表：业务 - 如果您只想列出一项业务的所有银行交易。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-07-15T14:05:58.193

需要考虑的事情...您使用“客户编号”和“供应商编号”吗？如果是这样，这些数字是否相同？如果不是，您可能希望将这些设置分解为指向相同相关数据的单独表（在企业表中）。

另一种方法是在 Businesses 表中有一个 CustomerNumber 列和一个 SupplierNumber 列，IMO 不正确并且可能会造成混淆。

# ruby-on-rails - 如何改进这个 Rails 代码？

> ID：744880
> 
> 赞同：4
> 
> 时间：2009-04-13T18:23:54.710
> 
> 标签：ruby-on-rails, ruby, refactoring

我正在编写一个小浏览器游戏作为学习 RoR 的项目，我对它很陌生。

这是一个由 cronjob 定期调用的小方法。

我猜应该有某种方法可以将元素添加到药水数组中，然后在最后进行批量保存，我也不喜欢每次在循环中点击数据库以再次获取市场的商品数量.

```
def self.restock_energy_potions
  market = find_or_create_market

  potions = EnergyPotion.find_all_by_user_id(market.id)

  while (potions.size < 5)
    potion = EnergyPotion.new(:user_id => market.id)
    potion.save
    potions = EnergyPotion.find_all_by_user_id(market.id)
  end    
end 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-13T18:30:09.690

我不确定我是否理解你的问题。你在寻找这样的东西吗？

```
def self.restock_energy_potions
  market = find_or_create_market   
  potions = EnergyPotion.find_all_by_user_id(market.id)
  (potions.size...5).each {EnergyPotion.new(:user_id => market.id).save }
  end    
end 
```

注意范围内的三个点；如果已经有 5 个，你不想制作药水。

此外，如果您的药水是链接的（例如通过`has_many`），您可以通过属性创建它们`market.potions`（我在这里猜测，关于用户和市场之间的关系 - 细节取决于您的模型的设置方式）并一次保存它们. 我不认为数据库节省会很重要。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T18:49:50.203

假设你的市场/用户`has_many`药水，你可以这样做：

```
def self.restock_energy_potions
  market = find_or_create_market
  (market.potions.size..5).each {market.potions.create(:user_id => market.id)}
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T00:40:18.340

a) 使用关联：

```
class Market < AR::Base
  # * note that if you are not dealing with a legacy schema, you should
  #   rename user_id to market_id and remove the foreigh_key assignment.
  # * dependent => :destroy is important or you'll have orphaned records
  #   in your database if you ever decide to delete some market
  has_many :energy_potions, :foreign_key => :user_id, :dependent => :destroy
end

class EnergyPotion < AR::Base
  belongs_to :market, :foreign_key => :user_id
end 
```

b) 添加后无需重新加载关联。还将功能移动到模型中：

```
find_or_create_market.restock

class Market
  def restock
    # * note 4, not 5 here. it starts with 0
    (market.energy_potions.size..4).each {market.energy_potions.create!}
  end
end 
```

c) 还要注意创建！而不是创造。你应该检测错误。错误处理取决于应用程序。在您的情况下，因为您从 cron 运行它，所以您可以做一些事情 * 发送带有警报的电子邮件 * 捕获异常并记录它们，（exception_notifier 插件或 hoptoad 托管服务） * 打印到 stderror 并配置 cron 以将错误发送到某些电子邮件。

```
 def self.restock_potions
    market = find_or_create
    market.restock
  rescue ActiveRecord::RecordInvalid
    ...
  rescue
    ...
  end 
```

# php - 一个单元如何使用 Zend Framework 和 PHPUnit 测试向数据库中添加一行？

> ID：744883
> 
> 赞同：0
> 
> 时间：2009-04-13T18:24:45.693
> 
> 标签：php, unit-testing, zend-framework

为了测试行的插入/更新，我编写了一个测试来模拟帖子，检查它是否重定向，并检查新插入/更新的文本是否在页面上。代码有效，但测试无效 - 你能告诉我为什么错了吗？

```
public function testEditProduct() {
    $request = $this->getRequest();
    $request->setMethod('POST');
    $request->setPost(array(
        'id'=>'1',
        'title'=>'Test Product 1a'
    ));
    $this->dispatch('/product/edit/id/1');
    $this->assertRedirectTo('/');
    $this->assertQueryContentContains('a', 'Test Product 1a');
}
public function testAddProduct() {
    $request = $this->getRequest();
    $request->setMethod('POST');
    $request->setPost(array(
        'title'=>'Test Product 3'
    ));
    $this->dispatch('/product/add/');
    $this->assertRedirectTo('/');
    $this->assertQueryContentContains('a', 'Test Product 3');
} 
```

以下测试都有效，断言带有 ID 参数的索引页面包含适当的文本，并且在删除产品后，该产品的标题不再显示在页面上。

```
public function testIndexPageListsProducts() {
    $this->dispatch('/product/index/id/1');
    $this->assertQueryContentContains('h1', 'Test Product 1');
}

public function testDeleteProduct() {
    $request = $this->getRequest();
    $request->setMethod('POST');
    $this->dispatch('/product/delete/id/2');
    $this->assertRedirectTo('/');
    $this->assertNotQueryContentContains('a', 'Test Product 2');
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T15:07:02.023

在你的第一个测试中，改变

```
$this->assertRedirectTo('/');
$this->assertQueryContentContains('a', 'Test Product 3'); 
```

至

```
$this->assertRedirectTo('/');

$this->resetRequest();
$this->resetResponse();

$this->disptach('/');
$this->assertQueryContentContains('a', 'Test Product 3'); 
```

如果我是正确的，单元测试框架不会执行重定向。它跟踪请求了哪些重定向，但实际上并不执行它们。

因此，在您的代码中，您正在检查编辑视图/操作中是否存在“测试产品 3”，并且该测试当然会失败。您应该首先请求索引，然后进行测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-16T13:09:25.043

谢谢你的帮助。我发现`$this->resetRequest();`并`$this->resetResponse();`抛出了错误，但我检查了[Zend_Test_PHPUnit_ControllerTestCase 的方法摘要](http://framework.zend.com/apidoc/core/Zend_Test/PHPUnit/Zend_Test_PHPUnit_ControllerTestCase.html#reset)，发现`$this->reset();` 链接页面确实列出了您提到的方法，但它们的列出方式不同。

`$this-reset();`单独也抛出了一个错误（没有为此应用程序定义默认模块），但我发现如果我`$this->bootstrap();`之后调用测试通过。这是一个有效的解决方案吗？为了澄清，我的测试代码现在是：

```
public function testEditProduct() {
    $request = $this->getRequest();
    $request->setMethod('POST');
    $request->setPost(array(
        'id'=>'1',
        'title'=>'Test Product 1a'
    ));
    $this->dispatch('/product/edit/id/1');
    $this->assertRedirectTo('/');

    $this->reset();
    $this->bootstrap();
    $this->dispatch('/');
    $this->assertQueryContentContains('a', 'Test Product 1a');
}
public function testAddProduct() {
    $request = $this->getRequest();
    $request->setMethod('POST');
    $request->setPost(array(
        'title'=>'Test Product 3'
    ));
        $this->dispatch('/product/add/');
    $this->assertRedirectTo('/');

    $this->reset();
    $this->bootstrap();
    $this->dispatch('/');
    $this->assertQueryContentContains('a', 'Test Product 3');
} 
```

# python - Python 正则表达式是否允许嵌入选项？

> ID：744885
> 
> 赞同：4
> 
> 时间：2009-04-13T18:25:02.477
> 
> 标签：python, regex

特别是，我想知道是否可以在模式字符串中指定一个嵌入选项来启用多行模式。也就是说，通常使用 Python 正则表达式启用多行模式，如下所示：

```
pattern = re.compile(r'foo', re.MULTILINE) 
```

我想要一种通过在模式字符串中指定它而不是使用 re.MULTILINE 选项来获得多行匹配的方法。您可以使用嵌入的 (?m) 表达式在 Java 中执行此操作。例如，

```
pattern = re.compile(r'(?m)foo') 
```

这在 Python 中是否可行，还是我需要使用 re.M 选项？一般来说，Python 中的嵌入式模式选项是否有很好的参考？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-13T18:28:37.477

是的。

从[文档](http://docs.python.org/library/re.html)：

> **`(?iLmsux)`**（来自集合'i'、'L'、'm'、's'、'u'、'x'的一个或多个字母。）
> 
> 该组匹配空字符串；字母为整个正则表达式设置了相应的标志：（[`re.I`](http://docs.python.org/library/re.html#re.I) 忽略大小写）、[`re.L`](http://docs.python.org/library/re.html#re.L)（取决于区域设置）、[`re.M`](http://docs.python.org/library/re.html#re.M)（多行）、[`re.S`](http://docs.python.org/library/re.html#re.S) （点匹配所有）、[`re.U`](http://docs.python.org/library/re.html#re.U)（取决于 Unicode）和（详细）。[`re.X`](http://docs.python.org/library/re.html#re.X)（标志在[模块内容](http://docs.python.org/library/re.html#contents-of-module-re)中描述。）
> 
> **如果您希望将标志包含在正则表达式中，而不是将标志参数传递给`compile()` 函数，这将非常有用。**
> 
> 请注意，该`(?x)`标志会更改表达式的解析方式。它应该首先在表达式字符串中使用，或者在一个或多个空白字符之后使用。如果标志前有非空白字符，则结果未定义。

# php - PHP 中的时区

> ID：744893
> 
> 赞同：4
> 
> 时间：2009-04-13T18:26:46.903
> 
> 标签：php, date, timezone

PHP 似乎使用一种相当烦人的方法来设置环境时区，使用区域名称而不是 GMT 偏移量。这使得时区下拉列表非常痛苦，因为它要么必须很大才能容纳所有可能的 PHP 时区值，要么我必须找到一种方法将 GMT 偏移量转换为有效值以传递给 PHP。

那么，给定一个 GMT 偏移量，我如何在 PHP 中设置时区？例如，如何将“-8.0”的 GMT 偏移值转换为可以传递给的值`date_timezone_set()`？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-13T18:33:33.940

使用区域名称是描述时区的*正确*方式。单独使用 GMT 偏移量是非常模棱两可的。

这反映在您的问题中 - 您应该如何将 -8 的 GMT 偏移量转换为时区？好吧，这取决于“GMT -8”的真正含义。它的意思是“每个时间点的UTC -8”还是“冬季的UTC -8，夏季的UTC -7”？如果是后者，冬天什么时候开始和结束？

我*希望*PHP 接受一组众所周知的“固定”（无 DST）时区值，例如“Etc/GMT+3”等。但除非你真的，真的是指固定时区，否则你是最好找出您实际上在谈论的区域，因为否则您的计算几乎可以保证在某些时候是错误的。

在去年的大部分时间里，我一直在与时区作斗争。它们很痛苦——*尤其是*当某些区域更改其 DST 规则时（就像美国几年前所做的那样），或者当某些区域看似随意选择加入和退出 DST 时。试图在一个数字中反映所有这些是愚蠢的。如果您只对单个时间点感兴趣，那可能没问题 - 但此时您不妨首先存储 UTC 值。否则，名称是最好的方法。（请注意，那时不一定一帆风顺。即使名称也会随着时间而改变......）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-13T19:39:55.323

如果您使用 PHP >= 5.2，则可以使用内置的 DateTimeZone 类方法 listAbbreviations。

```
var_dump( DateTimeZone::listAbbreviations() ); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-13T18:33:48.120

您需要维护一个包含各个位置的夏令时数据的数据库，这就是为什么最好存储一个位置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-12-27T12:40:43.957

您还可以尝试使用 PHP 库[Dater](https://github.com/barbushin/dater)来处理不同时区和格式的日期时间 - [https://github.com/barbushin/dater](https://github.com/barbushin/dater)

# python - 自动向 pot 文件添加注释

> ID：744894
> 
> 赞同：0
> 
> 时间：2009-04-13T18:27:22.207
> 
> 标签：python, localization, internationalization

我想从我的 py 文件中提取某些注释，这些注释为翻译提供上下文，而不是手动编辑 .pot 文件，基本上我想从这个 python 文件中获取：

```
# For Translators: some useful info about the sentence below
_("Some string blah blah") 
```

到这个pot文件：

```
# For Translators: some useful info about the sentence below
#: something.py:1
msgid "Some string blah blah"
msgstr "" 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T17:15:16.600

经过多次小便后，我找到了最好的方法：

```
#. Translators:
# Blah blah blah
_("String") 
```

然后使用 搜索评论。像这样：

```
xgettext --language=Python --keyword=_ --add-comments=. --output=test.pot *.py 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T16:00:27.043

我打算推荐这个`compiler`模块，但它忽略了评论：

f.py：

```
# For Translators: some useful info about the sentence below
_("Some string blah blah") 
```

..和编译器模块：

```
>>> import compiler
>>> m = compiler.parseFile("f.py")
>>> m
Module(None, Stmt([Discard(CallFunc(Name('_'), [Const('Some string blah blah')], None, None))])) 
```

Python 2.6 中的[AST](http://www.python.org/doc/2.5.2/lib/module-compiler.ast.html)模块似乎也是如此。

不确定是否可行，但如果您使用三引号字符串代替..

```
"""For Translators: some useful info about the sentence below"""
_("Some string blah blah") 
```

..您可以使用编译器模块可靠地解析 Python 文件：

```
>>> m = compiler.parseFile("f.py")
>>> m
Module('For Translators: some useful info about the sentence below', Stmt([Discard(CallFunc(Name('_'), [Const('Some string blah blah')], None, None))])) 
```

我尝试编写一个模式完整的脚本来提取文档字符串 - 它不完整，但似乎抓住了大多数文档字符串：http: [//pastie.org/446156](http://pastie.org/446156)（或在[github.com/dbr/so_scripts](http://github.com/dbr/so_scripts/tree/0bd66a21695a390cfa45f9ee26d7bed4eac10e5c/parse_py)上）

另一个更简单的选择是使用正则表达式，例如：

```
f = """# For Translators: some useful info about the sentence below
_("Some string blah blah")
""".split("\n")

import re

for i, line in enumerate(f):
    m = re.findall("\S*# (For Translators: .*)$", line)
    if len(m) > 0 and i != len(f):
        print "Line Number:", i+1
        print "Message:", m
        print "Line:", f[i + 1] 
```

..输出：

```
Line Number: 1
Message: ['For Translators: some useful info about the sentence below']
Line: _("Some string blah blah") 
```

不确定`.pot`文件是如何生成的，所以我对那部分完全没有帮助..

# google-maps - 如何将邮政编码可视化添加到 Google 静态地图 API 生成的图像？

> ID：744917
> 
> 赞同：2
> 
> 时间：2009-04-13T18:35:46.727
> 
> 标签：google-maps, mapping

这与我[之前提出](https://stackoverflow.com/questions/603644/how-do-i-embed-google-map-or-other-gis-mapping-output-in-a-pdf-as-i-generate-it)的一个问题有关。

考虑到技术限制，谷歌静态地图 API 似乎是可行的方法，但是，业务限制是不同的，我开始认为它们没有重叠的地方。

简而言之，我需要生成一个带有邮政编码边界的地图图像，并且邮政编码以不同的方式着色以突出显示一些并暗淡其他。这显然不是谷歌在他们的 API 中提供的东西，所以我可以做些什么来使用他们的地理编码、地图绘制和混合邮政编码图像？
当然，无需以某种方式构建我自己的全国性图块集来覆盖检索到的图像。

有点像这样，但无需支付使用费：http: [//maps.huge.info/zip.htm](http://maps.huge.info/zip.htm)

编辑：
我找到了[制图边界文件](http://www.census.gov/geo/www/cob/bdy_files.html)，但不知道如何将它们消化成有用的东西。

# jquery - 使用 jQuery Slider - 位置

> ID：744920
> 
> 赞同：1
> 
> 时间：2009-04-13T18:36:36.617
> 
> 标签：jquery, slider

我一直在使用滑块并使用以下代码：

```
 $(function(){
        $('#slider').slider({
            animate: true,
            step: 1,
            min: 0,
            max: 10,
            orientation: 'vertical',
            start: function(event, ui){
                $('#current_value').empty();
                $('#current_value').fadeIn().append('Value is ' + ui.value);
            },
            change: function(event, ui){
                alert();
                //$('#current_value').empty();
            }

        });
    }); 
```

我试图让它在顶部是 10 的值，底部是 1 和步骤 1 的值。这看起来正确吗？

我遇到的另一个问题是当你从一个位置移动到另一个位置时，我希望它显示它停止的位置（当前）。

因此，如果它位于 4 并且您单击 7，当您停止附加到 DIV 时，我尝试更改并停止，但它的行为并非如此。它采用了错误的位置值。

**链接**：[http](http://www.ryancoughlin.com/demos/interactive-slider/index.html) ://www.ryancoughlin.com/demos/interactive-slider/index.html 如果您使用键盘并转到底部，我的目标是让它以 1 为增量从 1 步进到 10

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T18:46:58.197

用 SLIDE 替换你的 CHANGE 事件......我前段时间问过[类似的问题。](https://stackoverflow.com/questions/621147/jquery-ui-slider-cant-slide-to-0)

您可能还想添加 STOP 事件...将您的逻辑从 START 移动到 SLIDE 和 STOP

# python - Python/Django 建模问题

> ID：744921
> 
> 赞同：1
> 
> 时间：2009-04-13T18:36:36.897
> 
> 标签：python, database, django, model

让许多子记录指向 Django 中同一模型/表中的一个父记录的最佳方法是什么？

这个实现是否正确？：

```
class TABLE(models.Model):
    id = models.AutoField(primary_key=True)
    parent = models.ForeignKey("TABLE", unique=False) 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-13T18:40:42.423

Django 为自连接的 ForeignKey 提供了一个特殊的语法：

```
class TABLE(models.Model):
    id = models.AutoField(primary_key=True)
    parent = models.ForeignKey('self') 
```

[来源](http://docs.djangoproject.com/en/dev/ref/models/fields/#foreignkey)（第二段）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-13T18:45:15.503

两件事情：

首先，您需要允许 为空值的可能性`parent`，否则您的`TABLE`树可能没有根。

其次，您需要担心“我是我自己的爷爷”的可能性。有关热烈的讨论，请参见[此处](https://stackoverflow.com/questions/401118/foreignkey-form-restrictions-in-django)。

# ruby - Mac 有什么好的 Ruby 开发环境？

> ID：744935
> 
> 赞同：8
> 
> 时间：2009-04-13T18:40:34.313
> 
> 标签：ruby, macos, ide, development-environment

我曾经在 mac 上开发 Java，结果很好，只使用终端和 IntelliJ。Mac 上运行 Ruby 开发的好工具有哪些

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-13T18:42:30.597

大多数 Rails 人在 Mac 上开发并使用[TextMate](http://macromates.com/)。因此，TextMate 对 Ruby*和*Rails 有很好的支持，并且可能是用于在 Mac 上开发 Ruby 代码的最佳文本编辑器。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-13T18:45:43.067

[Netbeans](http://www.netbeans.org/)是一个绝佳的选择，它具有许多用于调试、重构、数据库浏览、源代码控制等方面的出色功能。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-13T18:41:36.307

我使用 emacs，它有一个很好的 ruby​​ 模式。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-13T18:49:33.747

我将在 Textmate 推荐中获得第二/第三。称它为文本编辑器有点害处。[从这个 PDF](http://pragmaticstudio.com/rails/RailsTextMateCheats.pdf)开始，它有一些有用的 ruby​​/rails textmate 快捷方式

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-13T18:43:58.220

正如 mipadi 所说，TextMate 是一个出色的编辑器，并且可能是 Ruby 代码的最佳编辑器。对于开源替代方案，您也可以尝试[Smultron](http://www.tuppis.com/smultron/)。它的边缘有点粗糙，但它做得很好。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-13T18:44:00.920

我喜欢 TextMate，尽管我一直在使用 NetBeans。如果您喜欢功能齐全（又名臃肿）的 IDE，请尝试一下。相当不错： [http ://wiki.netbeans.org/Ruby](http://wiki.netbeans.org/Ruby)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-13T20:01:33.697

JetBrains（IntelliJ 背后的人）正在开发专门用于 Ruby on Rails 的 IDE：[RubyMine](http://www.jetbrains.com/ruby/index.html)。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-13T20:14:44.133

如果你喜欢 vim，可以添加模糊文件查找器（[http://github.com/jamis/fuzzy_file_finder/tree/master](http://github.com/jamis/fuzzy_file_finder/tree/master)）和 rails.vim（[http://www.vim.org/scripts/script.php?script_id= 1567](http://www.vim.org/scripts/script.php?script_id=1567) ) 插件提供了非常好的体验。

如果你不喜欢 vim，textmate 是一个不错的文本编辑器。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-13T18:52:53.783

您已经使用过 IntelliJ 了吗？您可能应该看看[Ruby/Rails 集成](http://www.jetbrains.com/idea/features/ruby_rails.html)。它支持调试、代码分析和重构等。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-14T09:48:35.783

TextMate 是我最喜欢的，但如果你想完成代码，NetBeans 是最好的选择（Aptana/RedRails 已经过时了）。NB 的夜间版本具有更好的 OSX 外观和感觉。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-14T15:51:22.603

如果你来自 *nix 并且喜欢 Vim，那么[MacVim](http://code.google.com/p/macvim/ "麦克维姆")。

如果您来自任何其他操作系统和/或您不喜欢 Vim，那么[TextMate](http://macromates.com/ "文本伴侣")。

TextMate 不是免费的，但值得 39 欧元。相信我。它会为自己付出很多很多倍的代价。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-06-10T12:58:52.417

MacVim 或 AquaEmacs 对于想要在 Mac 上开发并充分利用其编辑器的人来说确实是最佳选择：对于不太特别的人来说，Textmate 是要走的路。

我总是向任何人推荐 VIM/Emacs，因为

1.  它们不是基于 GUI 的，这意味着它们所做的一切都可以轻松修改和编写脚本
2.  它们更容易扩展
3.  您可以在服务器上使用它们
4.  它们通常更快，因为您和底层操作系统之间的代码更少
5.  它们通常支持更多的语言和不同的开发风格
6.  他们对自己所做的事情更加透明和易于理解
7.  必要时，一切都可以通过键盘快捷键完成，因此在它们上进行开发更快

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-03-01T19:25:36.490

[Sublime Text 2](http://www.sublimetext.com/2)，由同事推荐（我没有个人经验）。

# apache-flex - 团队如何使用 Flex Builder Pro 开发大型应用程序？

> ID：744937
> 
> 赞同：4
> 
> 时间：2009-04-13T18:40:45.280
> 
> 标签：apache-flex, actionscript, flex3, flexbuilder

我们为 Flash 平台开发应用程序，其中包含大量运行时加载的资产（图形、数据、音频、代码库等）。这些资产在项目文件夹中按逻辑组织。程序员和设计人员从版本控制中获取最新信息，签出他们的代码或设计工作，在应用程序的完整本地副本中进行测试，然后在完成后签入。该组织对这个工作流程和我们的沟通很重要。

使用 Flash 或 FlashDevelop，我可以轻松地处理任何组织的文件夹和文件。我可以轻松地编译单个包或类来创建运行时可加载的 swf。在 Flex Builder Pro 中，似乎我的选择是为我需要编译的每个 swf 创建一个项目，或者创建一个引用模块的项目，这些模块也可以设置为项目。这两种技术似乎都不适合团队，甚至不如我们当前的工作流程。注意：我有大约 10 年的 Flash 使用经验，但只有几个月使用 Flex Builder Pro 的经验。我很可能只是没有发现更好的工作流程。

您能否分享一些关于您和您的团队如何使用 Flex Builder Pro 开发具有大量运行时库和其他资产的大型应用程序的技巧？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-13T21:31:20.847

一般来说，您是正确的：使用 FlexBuilder 的想法是您将创建一个需要构建的项目（.swf、.swc 等）。

文件存储库（正如您提到的那样）绝对是大规模开发的必备品。

在您的工具箱中添加诸如[Ant](http://labs.adobe.com/wiki/index.php/Flex_Ant_Tasks)（我个人最喜欢的）和[Maven](http://www.sonatype.com/books/maven-book/reference/ch20.html)（流行度和功能迅速增长）之类的构建工具可以让您进行更高级的构建（甚至是单元测试）。这些类型的工具将允许在单个操作中构建具有许多方面和依赖关系的大型应用程序。这对于大型应用程序和开发环境来说是必须的。对于有很多子项目的大型项目，我通常会有一个“主”项目，它只不过是一个调用子项目构建脚本并将所有内容放在一起的构建脚本。Maven 尤其擅长这一点。有 Eclipse 插件可以帮助使用这两种工具。

不同的情况需要不同的方式一起使用项目。将库项目作为依赖项直接链接可能会有所帮助。这样，您的项目就能够调试链接的代码并根据需要对其进行修改。或者，如果库项目的修改频率较低，则可以将其资产放入依赖项目的 /libs 文件夹中，从而无需在开发过程中打开 .swc 生成项目。

将您的项目保持在每个项目一个资产的情况下，对于保持其井井有条有很长的路要走。通常我为每个客户都有一个文件夹，每个项目都有一个文件夹。如果该项目需要分解为子项目，那么所有这些子项目都将位于该项目文件夹中（无论彼此之间的关系如何）。

有时，为单个项目创建多个资产当然会有所帮助。这可能是针对不同情况的多个 .swf、用于分发到不同地方或客户的不同 .zip 或十几种其他情况。“资产”项目有时就是一个很好的例子。有时我有一个“项目”，它只是我的资产集合。我通常不会从 FlexBuilder 中访问该项目，而且它通常没有 .project 和其他 Eclipse 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-02T17:05:27.173

我还结合使用图书馆项目和常规项目。我在大型项目中遇到的一个问题是**编译时间**。以下是编译的一些链接：

*   [关于加快 Flex Builder 3 中的编译时间的任何建议？](https://stackoverflow.com/questions/33768/any-advice-for-speeding-up-the-compile-time-in-flex-builder-3)
*   [http://code.seanhess.net/?p=184](http://code.seanhess.net/?p=184)
*   [http://www.rogue-development.com/blog2/2007/11/slow-flex-builder-compile-and-refresh-solution-modules/](http://www.rogue-development.com/blog2/2007/11/slow-flex-builder-compile-and-refresh-solution-modules/)
*   [http://blog.iconara.net/2008/02/22/quick-tips-to-speed-up-your-ant-build/](http://blog.iconara.net/2008/02/22/quick-tips-to-speed-up-your-ant-build/)

设置正确的 eclipse.ini 并使用 -incremental 编译器选项确实帮助了我。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T22:00:35.083

除非您开发一个 Hello World 应用程序，否则您应该拥有多个 Flex Builder 项目。主要的类具有最少的类，并且可能是显示应用程序的第一个屏幕所需的共享库。

字体和 CSS 转到单独的项目并编译成单独的 swf。在运行时通过 StyleManager 加载它们。仅此一项就可以加快应用程序的编译速度。

其余代码必须拆分为单独的项目（Flex 库项目或仅具有模块的项目）。阅读有关将库与主项目链接的差异（RSL 与合并到代码与外部）。

我们使用 Ant 来构建每个项目和整个应用程序。我们的开源 Fx2Ant 实用程序可在几秒钟内为您的 Flex Builder 项目生成 ANT 脚本。

例如，这是我去年从事的项目：[http](http://www.mbusa.com) ://www.mbusa.com 。它由超过 15 个 Flex Builder 项目组成。

# grid - 确定回发是 page_load 还是 itemcommand

> ID：744943
> 
> 赞同：0
> 
> 时间：2009-04-13T18:42:56.880
> 
> 标签：grid, load, itemcommand

我在数据网格中的页面左侧有一个用户列表，我想在页面右侧加载一个带有单击用户信息的 div。我假设我会在 itemcommand 事件中加载 div，但是我该如何处理页面加载呢？我需要知道导致回发的原因吗？我是否也需要重新加载网格`page_load`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T19:06:10.290

> 那我该如何处理页面加载呢？

每个回发都使用一个全新的页面类实例，并完全重建页面。唯一不同的是，某些控件可能是通过 ViewState 预先填充的。您无需为任何这些控件重复加载工作。

> 我需要知道导致回发的原因吗？

ASP.Net 将为您处理并触发事件。您只需要知道它是否是回发，甚至可能不需要（请参阅下一部分）。

> 我是否还需要在 page_load 上重新加载网格？

是的。嗯，有点。您需要将网格的 html 重新呈现给浏览器。好消息是您的网格数据可能已经处于视图状态，并且会自动发生。你不需要自己担心。

但是，在许多情况下，您可能会发现最好关闭网格的视图状态并在每次回发时重新加载它们。这是因为 ViewState 只是页面上的隐藏输入，必须随每个请求发布（上传）到服务器。大多数互联网用户的上传带宽非常有限，因此一个大的 ViewState 会让你的网站看起来很慢，即使你的服务器几乎没有出汗。

根据您的情况，您可以通过禁用选择控件上的 ViewState 来换取一些*额外*的服务器性能来换取站点响应能力，从而做得更好。在这种情况下，您将始终加载网格并且不再需要关心请求是否是回发。

相比之下，如果这是一个内部应用程序，用户通常通过本地以太网连接到您的 Web 服务器，则很难在平衡响应能力和服务器性能方面击败 ViewState **。**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T18:50:56.020

通过检查 !IsPostBack 排除网格绑定

```
if(!IsPostBack){
   // Bind the Grid
} 
```

对于 div itemcommand，您可以检索从网格中单击的值并加载用户信息。

因此，您不需要每次都加载网格。它只会第一次加载。我认为您不需要检查导致回发的原因，因为无论如何您只会加载一次网格。

# asp.net - 用户控件全球化

> ID：744944
> 
> 赞同：0
> 
> 时间：2009-04-13T18:43:06.350
> 
> 标签：asp.net, localization, globalization

嗨，如何在用户控件上设置文化信息？我已设置资源文件，但无法覆盖 InitializeCulture()，因为它在 System.Web.UI.UserControl 中不可用。有人可以指出我正确的方向吗？我想以编程方式进行。谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T19:22:37.020

在用户控件的 PageLoad 事件中，您可以设置当前线程的文化：

```
Me.Culture = "en-US" 
```

此后的任何内部框架调用都将使用该线程的当前文化集，例如 Convert.ToDouble() 调用将在这里工作：

```
Me.Culture = "en-US"
Dim num as Double = Convert.ToDouble("1,000.50") 
```

...但这不起作用：

```
Dim num as Double = Convert.ToDouble("1.000,50") 
```

...如果我们将文化设置为法裔加拿大人：

```
Me.Culture = "fr-CA"
Dim num as Double = Convert.ToDouble("1.000,50") 
```

...这将工作并正确解析字符串，因为法语加拿大文化的默认小数分隔符是逗号。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T19:17:48.000

哟需要改变当前线程的文化

# c# - 如何以浏览器 PDF 格式打开数据？

> ID：744969
> 
> 赞同：1
> 
> 时间：2009-04-13T18:53:45.450
> 
> 标签：c#, .net, asp.net

我得到数据（沃尔沃汽车的价格）我的 xml 或 sql 数据库，我有“xyz.aspx”页面。如何在网络浏览器中打开 pdf。但我想了解如何打开 pdf（来自 sql 数据表的数据）xyz.aspx 或 another.aspx 中的数据...

示例：[沃尔沃的价格 pdf](http://www.volvocars.com/tr/tools/Pages/fiyat%20listesi.aspx)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-13T19:00:46.120

假设你有一张这样的桌子：

```
CREATE TABLE PDFTable (
    [PDFID] [bigint] IDENTITY (1, 1) NOT NULL ,
    [PDFFile] [varbinary(max)]
) 
```

并且您将 PDF 文件以二进制格式存储在此表中。并且您希望像这样向访问者公开您的 PDF 文件：

> [http://www.mysite.com/getpdf.aspx?pdfid=12](http://www.mysite.com/getpdf.aspx?pdfid=12)

这是从数据库读取二进制 pdf 数据并将其写入响应流的示例：

```
// PageLoad event of your getpdf.aspx page :
long pdfId= Convert.ToInt64(Request.QueryString["pdfid"]);

using (var conn = new SqlConnection(connectionString))
{
    using (var command = new SqlCommand(
        "SELECT PDFFile FROM PDFTable WHERE PDFId = @PDFID", conn))
    {
        command.Parameters.Add("@PDFID", SqlDbType.Int).Value = pdfId;
        conn.Open();

        Response.ContentType = "application/pdf";
        Response.BinaryWrite((byte[]) command.ExecuteScalar());
    }
} 
```

此页面将导致您的客户在他/她的浏览器中打开 pdf。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T20:12:04.920

您还需要通过设置内容类型标头将您的 mime 类型设置为“application/pdf”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T19:01:03.203

有两个步骤。

1.  生成包含数据的 pdf。
2.  将pdf传送到浏览器

第 1 步：有许多可用于编写 pdf 的库。随便挑一个。自己生成 PDF 可能不可行，因为格式非常复杂。

对于第 2 步：将 Content.Headers 设置为包含 mime/pdf contentType，并使用 BinaryWrite 将 pdf 数据输出到浏览器。

# java - 如何在 griffon 中将第二个 MVC 组显示为对话框

> ID：744977
> 
> 赞同：4
> 
> 时间：2009-04-13T18:58:27.047
> 
> 标签：java, swing, grails, groovy, griffon

我可以看到如何实例化第二个 MVC 组，例如

```
def (loginPaneModel, loginPaneView, loginPaneController) =
      createMVCGroup('LoginPane', 'LoginPane', [:]);
view.loginPanel = loginPaneView.loginPanel 
```

但我不想显示为我的主窗口的一部分。我想让它弹出来。我该怎么做？谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-14T17:08:01.127

好吧，似乎只需要第一行。这足以弹出一个窗口。不过，我相信关键是让视图成为一个框架。

```
def frame = frame(title:'Login', pack:true, locationByPlatform:true) {
     ...
}
frame.pack()
frame.show() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T15:08:20.420

最简单的方法是使用视图面板作为父 MVC 组中对话框的根。在你的代码片段是你的控制器的组的视图中，你可以做这样的事情......

```
application(title:'your app', ....) {
  // your existing code...

  loginDialog = dialog(title:'Login Panel', visible:false) {
    panel(loginPanel)
  }
} 
```

然后当你需要显示对话框时（在同一个控制器中）

```
view.loginDialog.visible = true 
```

将对话框嵌套在另一个窗口中的副作用是将对话框的所有者设置为父级的框架或对话框。拥有另一个对话框/窗口拥有的对话框是导致对话框与父级链接并始终浮动在该父级之上的原因。它也将与父母一起提高/降低。

# c# - 空闲时间后隐藏鼠标光标

> ID：744980
> 
> 赞同：12
> 
> 时间：2009-04-13T18:58:48.170
> 
> 标签：c#

我想在空闲时间后隐藏鼠标光标，当我移动鼠标时它会显示出来。我尝试使用计时器，但效果不佳。有谁能够帮助我？请！

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-13T20:19:11.360

如果您使用的是 WinForms 并且只部署在 Windows 机器上，那么使用它[`user32 GetLastInputInfo`](http://msdn.microsoft.com/en-us/library/ms646302.aspx)来处理鼠标和键盘空闲是很容易的。

```
public static class User32Interop
{
  public static TimeSpan GetLastInput()
  {
    var plii = new LASTINPUTINFO();
    plii.cbSize = (uint)Marshal.SizeOf(plii);

    if (GetLastInputInfo(ref plii))
      return TimeSpan.FromMilliseconds(Environment.TickCount - plii.dwTime);
    else
      throw new Win32Exception(Marshal.GetLastWin32Error());
  }

  [DllImport("user32.dll", SetLastError = true)]
  static extern bool GetLastInputInfo(ref LASTINPUTINFO plii);

  struct LASTINPUTINFO
  {
    public uint cbSize;
    public uint dwTime;
  }
} 
```

然后在你的`Form`

```
public partial class MyForm : Form
{
  Timer activityTimer = new Timer();
  TimeSpan activityThreshold = TimeSpan.FromMinutes(2);
  bool cursorHidden = false;

  public Form1()
  {
    InitializeComponent();

    activityTimer.Tick += activityWorker_Tick;
    activityTimer.Interval = 100;
    activityTimer.Enabled = true;
  }

  void activityWorker_Tick(object sender, EventArgs e)
  {
    bool shouldHide = User32Interop.GetLastInput() > activityThreshold;
    if (cursorHidden != shouldHide)
    {
      if (shouldHide)
        Cursor.Hide();
      else
        Cursor.Show();

      cursorHidden = shouldHide;
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-13T19:17:50.493

这是一个人为的例子，说明如何做到这一点。您可能缺少一些覆盖光标可见性的逻辑：

```
public partial class Form1 : Form
{
    public TimeSpan TimeoutToHide { get; private set; }
    public DateTime LastMouseMove { get; private set; }
    public bool IsHidden { get; private set; }

    public Form1()
    {
        InitializeComponent();
        TimeoutToHide = TimeSpan.FromSeconds(5);
        this.MouseMove += new MouseEventHandler(Form1_MouseMove);
    }

    void Form1_MouseMove(object sender, MouseEventArgs e)
    {
        LastMouseMove = DateTime.Now;

        if (IsHidden) 
        { 
            Cursor.Show(); 
            IsHidden = false; 
        }
    }

    private void timer1_Tick(object sender, EventArgs e)
    {
        TimeSpan elaped = DateTime.Now - LastMouseMove;
        if (elaped >= TimeoutToHide && !IsHidden)
        {
            Cursor.Hide();
            IsHidden = true;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-03-18T05:08:11.420

需要考虑 Environment.Tickcount 为负数：

```
public static class User32Interop
{

    public static TimeSpan GetLastInput()
    {
        var plii = new LASTINPUTINFO();
        plii.cbSize = (uint)Marshal.SizeOf(plii);

        if (GetLastInputInfo(ref plii))
        {
            int idleTime = unchecked(Environment.TickCount - (int)plii.dwTime);
            return TimeSpan.FromMilliseconds(idleTime);
        }
        else
            throw new Win32Exception(Marshal.GetLastWin32Error());
    }

    [DllImport("user32.dll", SetLastError = true)]
    static extern bool GetLastInputInfo(ref LASTINPUTINFO plii);

    struct LASTINPUTINFO
    {
        public uint cbSize;
        public uint dwTime;
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-11-03T14:21:46.123

如果您尝试从另一个线程中隐藏光标，您需要在 winform 上调用 Invoke(...) 以进入 UI 线程。为什么 Cursor.Hide() 不起作用，我花了一些时间。“PInvoke ShowCursor(bool bShow)”还有返回[Show/Hide-Count](https://stackoverflow.com/questions/7639502/why-do-cursor-show-and-cursor-hide-not-immediately-hide-or-show-the-cursor)的好处。

```
[DllImport("user32.dll")]
static extern int ShowCursor(bool bShow);

private System.Timers.Timer _timerMouseAutoHide;
Point _lastPos = new Point(int.MaxValue);
readonly Stopwatch _stopwatch = new Stopwatch();
private int _cursorVisibilityCount = 0;

private void InitMouseAutoHide()
{
    if (_timerMouseAutoHide != null)
        return;

    _timerMouseAutoHide = new Timer(100){AutoReset = false};
    _timerMouseAutoHide.Elapsed += MouseAutoHideHit;

    _timerMouseAutoHide.Start();
    _stopwatch.Restart();
}

private void MouseAutoHideHit(object pSender, ElapsedEventArgs pE)
{
    try
    {
        if (IsDisposed)
            return;

        var lCurrentPos = Cursor.Position;
        var lCursorHasMoved = _lastPos != lCurrentPos;
        _lastPos = lCurrentPos;

        if (_cursorVisibilityCount < 0 && lCursorHasMoved)
        {
            //Cursor is not Visible and Mouse has moved
            _cursorVisibilityCount = ShowCursor();
            Debug.WriteLine($"Visible {lCurrentPos}, ShowCursor={_cursorVisibilityCount}");
        }
        else if (_cursorVisibilityCount > -1 && _stopwatch.ElapsedMilliseconds > 3000)
        {
            //Cursor is Visible and Mouse didn't move fox x ms.
            _cursorVisibilityCount = HideCursor();
            Debug.WriteLine($"Hidden {lCurrentPos}, ShowCursor={_cursorVisibilityCount}");
        }

        if (lCursorHasMoved)
            _stopwatch.Restart();
    }
    catch (Exception lEx)
    {
        GLog.Error(lEx);
    }
    finally
    {
        _timerMouseAutoHide?.Start();
    }
}

public int ShowCursor()
{
    var lCursorVisibilityCount = 0;
    Invoke(new Action(() =>
    {
        do
        {
            lCursorVisibilityCount = ShowCursor(true);
        } while (lCursorVisibilityCount < 0);
    }));
    return lCursorVisibilityCount;
}

public int HideCursor()
{
    var lCursorVisibilityCount = 0;
    Invoke(new Action(() =>
    {
        do
        {
            lCursorVisibilityCount = ShowCursor(false);
        } while (lCursorVisibilityCount > -1);
    }));
    return lCursorVisibilityCount;
} 
```

# algorithm - 大小为 n 的数组，有一个元素 n/2 次

> ID：744981
> 
> 赞同：10
> 
> 时间：2009-04-13T18:59:02.100
> 
> 标签：algorithm

给定一个包含 n 个整数的数组，其中一个元素出现超过 n/2 次。我们需要在线性时间和恒定的额外空间中找到该元素。

YAAQ：还有另一个数组问题。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-13T19:07:31.067

我有一个偷偷摸摸的怀疑，它类似于（在 C# 中）

```
// We don't need an array
public int FindMostFrequentElement(IEnumerable<int> sequence)
{
    // Initial value is irrelevant if sequence is non-empty,
    // but keeps compiler happy.
    int best = 0; 
    int count = 0;

    foreach (int element in sequence)
    {
        if (count == 0)
        {
            best = element;
            count = 1;
        }
        else
        {
            // Vote current choice up or down
            count += (best == element) ? 1 : -1;
        }
    }
    return best;
} 
```

这听起来不太可能奏效，但确实如此。（[作为后记文件的证明](http://www.cs.utexas.edu/users/boyer/mjrty.ps.Z)，由 Boyer/Moore 提供。）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-13T21:54:07.500

找到中位数，在未排序的数组上需要 O(n)。由于超过 n/2 个元素等于相同的值，因此中位数也等于该值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-13T19:19:35.013

```
int findLeader(int n, int* x){
    int leader = x[0], c = 1, i;
    for(i=1; i<n; i++){
        if(c == 0){
            leader = x[i];
            c = 1;
        } else {
            if(x[i] == leader) c++;
            else c--;
        }
    }

    if(c == 0) return NULL;
    else {
        c = 0;
        for(i=0; i<n; i++){
            if(x[i] == leader) c++;
        }
        if(c > n/2) return leader;
        else return NULL;
    }
} 
```

我不是此代码的作者，但这将解决您的问题。第一部分寻找潜在的领导者，第二部分检查它是否在数组中出现超过 n/2 次。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T19:13:29.803

[好吧，您可以按照此处[pdf]](http://www.cs.rutgers.edu/~muthu/soradix.pdf)的描述进行就地基数排序，这不需要额外的空间和线性时间。然后您可以单次计算连续元素并在 count > n/2 处终止。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-14T05:16:21.647

这是我最初的想法。

我试图保持不变的“一个元素出现超过 n/2 次”，同时减少问题集。

让我们开始比较 a[i], a[i+1]。如果它们相等，我们比较 a[i+i]、a[i+2]。如果不是，我们从数组中删除 a[i]、a[i+1]。我们重复这个直到 i>=(current size)/2。此时，我们将让“THE”元素占据第一个（当前大小）/2 个位置。这将保持不变。

唯一需要注意的是，我们假设数组在一个链表中[因为它给出了 O(n) 的复杂度。]

人家怎么说？

-布皮

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T19:07:30.770

我的第一个想法（不够）是：

*   对数组进行就地排序
*   返回中间元素

但这将是 O(n log n)，任何递归解决方案也是如此。

如果您可以破坏性地修改数组（并且适用各种其他条件），您可以使用它们的计数或其他内容替换元素。你对数组还有其他了解吗，你可以修改它吗？

*编辑* 将我的答案留给后代，但我认为 Skeet 明白了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-13T19:09:18.097

怎么样：随机选择 K 个元素的一小部分并查找重复项（例如，前 4 个、前 8 个等）。如果 K == 4，那么没有得到至少 2 个重复项的概率是 1/8。如果 K==8，那么它会低于 1%。如果您发现没有重复，请重复该过程，直到您找到为止。（假设其他元素更随机分布，这将表现得非常糟糕，例如，数组的 49% =“A”，数组的 51% =“B”）。

例如：

```
findDuplicateCandidate: 
    select a fixed size subset.
    return the most common element in that subset
    if there is no element with more than 1 occurrence repeat.
    if there is more than 1 element with more than 1 occurrence call findDuplicate and choose the element the 2 calls have in common 
```

这是一个恒定顺序操作（如果数据集还不错），所以然后按顺序（N）对数组进行线性扫描以进行验证。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-10-24T13:17:47.160

在php中---请检查它是否正确

```
function arrLeader( $A ){
$len = count($A);
$B = array();
$val=-1;
$counts = array_count_values(array); //return array with elements as keys and occurrences of each element as values
for($i=0;$i<$len;$i++){
    $val = $A[$i];
    if(in_array($val,$B,true)){//to avoid looping again and again
    }else{
     if($counts[$val]>$len/2){
      return $val;
     }
     array_push($B, $val);//to avoid looping again and again
    }
 }
 return -1;
} 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2017-10-03T13:24:07.410

```
int n = A.Length;
            int[] L = new int[n + 1];
            L[0] = -1;
            for (int i = 0; i < n; i++)
            {
                L[i + 1] = A[i];
            }
            int count = 0;
            int pos = (n + 1) / 2;
            int candidate = L[pos];
            for (int i = 1; i <= n; i++)
            {
                if (L[i] == candidate && L[pos++] == candidate)
                    return candidate;
            }
            if (count > pos)
                return candidate;
            return (-1); 
```

# javascript - 阻止用户从 Web 应用程序复制和粘贴文本的最佳方法是什么？

> ID：744983
> 
> 赞同：1
> 
> 时间：2009-04-13T18:59:27.480
> 
> 标签：javascript, html, apache-flex, copy-paste

我正在处理的网站显示了一些非常有价值的专有第 3 方数据。因此，他们希望阻止人们复制和粘贴他们的信息。他们明白，当然，我们无法阻止用户只是写下信息或打印出来，但他们想让他们的数据尽可能难以被获取。另一个大问题是性能。该网站看到大量的活动，所以保持它的活泼是一件大事。

我希望从你们那里得到一些关于实现这一目标的最佳方法的反馈

已提出的一些潜在解决方案：

1.  使用一些 javascript 来阻止用户点击 ctrl / 右键单击​​（恼人并且不会阻止更高级的用户）
2.  使用 flex（非常慢，但非常安全，因为数据是二进制的）
3.  创建或找到一些时髦的 html 到图像转换器并将数据显示为图像

非常欢迎您的想法和意见。

提前致谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-13T19:07:27.913

向用户收取访问信息的费用。

你可以尝试各种代码变通办法，但你真的不会阻止任何有决心的人。通过收费，你限制了对真正需要信息的人的访问，如果他们复制了这些信息，那么至少你已经得到了报销。它还过滤掉了很多会恶意使用它的人。此外，在信息上放置法律声明，详细说明如何使用它，以便您可以在必要时对复印机采取法律行动。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-13T19:38:08.620

这听起来确实是问题起源的严重问题。如果这是不容易复制的东西，为什么它完全可见？

如果它真的是专有的，为什么将它发布在网络上是个好主意？

似乎内部网页会更合适。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T19:16:55.707

为内容收费是一个很好的答案，但我猜你已经在为内容收费了。

＃2显然是最安全的选择，也是最灵活的，让你尽可能地惩罚自己（做一些事情，比如通过线路加密等......）所以它也应该不足为奇实施成本最高。

鉴于，有人可以反编译你的代码并检查内存，但在这一点上，你会怀疑你是否会阻止任何人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T19:32:07.683

以受密码保护的 pdf 格式提供下载信息，他们唯一能做的就是查看它，不能打印、复制粘贴等。尽管您无法停止打印屏幕。Primo PDF 可以为您做到这一点并且是免费的。[http://www.primopdf.com/](http://www.primopdf.com/)

这里的关键是绕过您选择的任何解决方案所需的努力，大于您试图防止被复制的信息的价值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-13T19:04:47.623

这是一个棘手的情况，因为这是网络......

您可以使用非常小的闪存来显示敏感数据，您可以完全控制这些数据，如果它很小，不应该影响您的下载时间。这可能是我的首选方法。

选项 #3 将阻止人们复制和粘贴，但不会阻止他们下载图像。我不确定这对你是否重要。

您是否需要为关闭了 javascript 的受众提供服务？如果没有，您可以首先使用 AJAX 提取敏感信息，然后使用脚本阻止他们复制该 div 或其他内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-13T19:08:30.330

您可能想查看[Tynt Tracer](http://www.tynt.com/)。它不会阻止复制，但至少可以让您跟踪它的去向......无论如何。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-13T19:08:35.493

您可能会将选项 1 视为一种“最低限度”的做法，但不可否认，这不是一个很好的选择，因为简单地禁用 JS 就可以解决它。

您的第三个想法也可以，但您实际上可以通过转到图像以及它们存储在临时 Internet 文件中的方式来更轻松地保存。

另外，作为旁注，为了防止打印，您可能需要指定一个仅打印的 CSS 来隐藏所有内容。

```
body {display:none;} 
```

它并不完美，但再次阻止了临时用户打印。

# jquery-ui - 更新 div 事件

> ID：744985
> 
> 赞同：1
> 
> 时间：2009-04-13T19:00:34.717
> 
> 标签：jquery-ui

我正在使用 jquery 滑块并使用 append() 来更新值，但除非我在开​​始事件中清空它，否则它将继续添加它。有没有一种方法可以让我在每次操作发生时都更新值而不是打印出来。我尝试了 replaceWith 但没有运气。

```
start: function(event, ui){
    $('#current_value').empty();    
},
slide: function(event, ui){
    $('#current_value').fadeIn().append('Value is '+ui.value);
}, 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T19:04:10.823

你可能想要类似的东西

```
slide: function(event, ui){
    $('#current_value').text('Value is '+ui.value);
    $('#current_value').fadeIn();
} 
```

[text()](http://docs.jquery.com/Attributes/text#val)文档

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T19:03:49.123

您需要使用 html() 而不是 append()，append 在给定元素的末尾添加值，html 为给定元素设置 innerHtml。

$('#current_value').html('值为'+ui.value).fadeIn();

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T19:03:26.630

如果我理解你的话，你应该：

```
var existing = $('#current_value').html();
$('#current_value').html(existing + ui.value).fadeIn(); 
```

# asp.net - 在没有 IISReset 的情况下重新加载 Web 程序集的最佳方法

> ID：744990
> 
> 赞同：1
> 
> 时间：2009-04-13T19:01:53.747
> 
> 标签：asp.net, iis, iis-6

发布到网站和/或 gac 某些程序集后，重新加载程序集的最佳方法是什么。

我学到的一个简单技巧是触摸 web.config 并重新加载应用程序域。

与此相关的最佳实践是什么？

是否可以在没有网页引用的 IISRESET 的情况下更新服务器激活的服务组件？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T19:04:16.207

你可以跑

> iisapp.vbs /a "应用程序池名称" /r

这将重新启动应用程序池，而其余的应用程序池保持不变。没有 IIS 服务被停止或启动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T19:05:51.133

如果您发布到网站并将新的 .dll 文件放入 bin 中，应用程序将自动回收。

如果您更新 GAC，您将需要使用 web.config 上的保存方法，或者只是重新启动应用程序所在的应用程序池。

# .net - 如何判断我是否在 Web 服务器下运行？

> ID：744991
> 
> 赞同：0
> 
> 时间：2009-04-13T19:02:10.407
> 
> 标签：.net, iis, design-patterns, provider

我正在编写一个 C# .NET 模块，我想使用提供者模式。

如果我的代码在 Web 服务器上运行，我可以访问`System.Web.Configuration`并调用`ProvidersHelper`以加载由数据确定的适当提供程序`web.config`。

如果我的代码在独立环境中运行，我将无法访问此类。

在我看来，我可能会编写一个使用反射的包装类（a）确定我是否可以访问内置的`System.Web.Configuration.ProvidersHelper`，如果不能，（b）提供一个功能等效的接口，它只依赖于我可用的资源在单机模式下。

有没有人以前遇到过这个问题和/或有建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T19:14:51.873

检查 HttpContext.Current 是否不为空：

```
if(HttpContext.Current!=null)
   // I'm running on a web server 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T19:15:16.943

您可以创建一个统计 IsWeb 函数，该函数返回 HttpContext.Current 是否为空。

如果它不为空，你就有一个网站，如果它为空，你就没有。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T19:25:20.133

如果您正在编写一个可以从基于 Web 或非基于 Web 的应用程序访问的模块，那么处理配置的正确方式™，恕我直言，是让客户端代码*告诉*您您所处的环境。这应该是对客户端代码的轻微影响，并大大降低了代码的复杂性。一种可能的解决方案是让客户端传入一个符合相同接口的对象（尽管快速浏览 MSDN 文档显示没有为 ProvidersHelper 定义接口，因此简单的路线已经过时了）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T19:28:08.987

如果您想避免对`System.Web`程序集的引用，则必须创建一个接口，该接口公开您感兴趣的信息，并让您的消费者酌情提供此接口的实现者：

```
// Core assembly, doesn't reference System.Web
public class ThisUsesProviders {
    public ThisUsesProviders(IProviderProvider pp) { ... }
}

public interface IProviderProvider {
   SpecialProvider InstantiateSpecialProvider(/* custom arguments */);
}

// Helper assembly, references System.Web
public class DefaultProviderProvider : IProviderProvider
{
    SpecialProvider InstantiateSpecialProvider(/* custom arguments */)
    {
        // call ProvidersHelper 
    }
}

// standalone consumer:
var thing = new ThisUsesProvider(new NonStandardProvider());

// ASP.NET:
var thing = new ThisUsesProvider(new DefaultProviderProvider()); 
```

这种模式称为[依赖注入](http://martinfowler.com/articles/injection.html)和[控制反转](http://en.wikipedia.org/wiki/Inversion_of_control)。

# django - 无法在我的计算机中启动 django 服务器

> ID：744993
> 
> 赞同：2
> 
> 时间：2009-04-13T19:03:00.873
> 
> 标签：django

我通过以下方式导出了我的 django 项目的路径

```
$ export DJANGO_SETTINGS_MODULE=/Users/masi/Documents/Test/djangobook/ch3.settings 
```

我跑不成功

```
$ django-admin.py runserver 
Error: Could not import settings '/Users/masi/Documents/Test/djangobook/ch3.settings' (Is it on sys.path? Does it have syntax errors?): Import by filename is not supported. 
```

**如何在没有错误消息的情况下启动 Django 服务器？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T19:07:34.357

你`$DJANGO_SETTINGS_MODULE`应该设置为`ch3.settings`. 只需确保该`ch3`应用程序也在您的`$PYTHONPATH`.

例如，如果您的应用位于`/Users/masi/Documents/Test/djangobook/`，则设置`$DJANGO_SETTINGS_MODULE`为`ch3.settings`，并确保您的`$PYTHONPATH`包含`/Users/masi/Documents/Test/djangobook`.

```
$ export PYTHONPATH=/Users/masi/Documents/Test/djangobook/
$ export DJANGO_SETTINGS_MODULE=ch3.settings 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T21:02:07.327

从[django-admin.py 和 manage.py](http://docs.djangoproject.com/en/dev/ref/django-admin/#ref-django-admin)上的 django 文档：

> django-admin.py 是 Django 用于管理任务的命令行实用程序。
> 
> 此外，在每个 Django 项目中都会自动创建 manage.py。manage.py 是 django-admin.py 的一个瘦包装器，它在委托给 django-admin.py 之前为您处理两件事：
> 
> *   它将您的项目包放在 sys.path 上。
> *   它设置`DJANGO_SETTINGS_MODULE`环境变量，使其指向您项目的 settings.py 文件。
> 
> 通常，在处理单个 Django 项目时，使用 manage.py 会更容易

因此，如果您的目录结构如下所示：

```
djangobook/
    ch3/
        settings.py 
```

执行以下操作，您可以忽略所有 DJANGO 环境变量（除非您有一些非常奇怪的安装）：

```
$ cd /Users/masi/Documents/Test/djangobook/ch3/
$ python manage.py runserver 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-09-18T15:38:53.227

对于那些遇到相同错误的人，在尝试运行类似的东西时：

```
python manage.py runserver --settings=settings_dev 
```

当设置文件位于 app 目录中时，如下所示：

```
mysite/
  settings.py
  settings_dev.py
requirements.txt
manage.py 
```

您不必指定`$PYTHONPATH`（至少四年后）您只需要确保您的`--settings`值包含文件夹名称 - 您还需要使用点表示法，斜杠不会。

```
python manage.py runserver --settings=mysite.settings_dev 
```

导出`$DJANGO_SETTINGS_MODULE`值时也是如此：

```
export DJANGO_SETTINGS_MODULE=mysite.settings_dev 
```

可能会节省其他人我失去工作的时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-13T20:30:22.067

你也可以试试`manage.py`。

从您的项目目录中，运行

> `$ python manage.py runserver`

即使它只是一个包装器，也`manage.py`总是对我有用，而对我`django-admin.py`不起作用。显然我们都做错了（我刚开始使用 Django），但这至少应该能让你继续前进。

# sql-server - 从 Oracle 读取数据时的 OleDb 与 DataReader

> ID：744995
> 
> 赞同：1
> 
> 时间：2009-04-13T19:03:13.867
> 
> 标签：sql-server, sql-server-2005, oracle, ssis

使用一种类型的提供者是否比另一种更快？我们正在使用 SSIS (SQL Server 2005) 从 Oracle 中提取一些数据并将其导入 SQL Server。我的理解是 OLEDB 更快，因为连接是本机的，并且数据没有通过任何 .NET 代码运行？

它是否正确？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T19:35:30.390

OLEBD 肯定会工作得更快。

但是您必须在 Oracle 数据库的 Microsoft 或 Oracle 驱动程序之间做出选择。我建议您尝试两者并决定哪一个可以为您提供更好的性能。

我听说 oracle 的驱动程序在 ssis 2008 上改进了很多（写作性能很糟糕）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T19:14:38.413

那要看！从 .NET 代码中，您总是更喜欢使用 Oracle .NET 提供程序来访问 Oracle 数据库。侦察你也想使用 SSIS 的 .NET 提供程序

# c# - PropertyGrid 中的斜体文本

> ID：744999
> 
> 赞同：3
> 
> 时间：2009-04-13T19:03:33.383
> 
> 标签：c#, propertygrid

我正在使用 PropertyGrid 来显示通过 ICustomTypeDescriptor 的实现公开的自定义属性。

我的对象设置在树结构中，每个属性的值要么在每个对象中设置，要么从父对象继承。在 PropertyGrid 中，我想直观地向用户展示在所选对象中设置了哪些属性值，以及哪些属性值是从父对象继承的。

现在，我将每个属性都显示为两个类别。一组显示在实际对象中设置的值，如果未设置，则带有空白字段。另一组显示分配给对象的属性值，这些属性值要么在对象中设置，要么在对象中未设置时继承。

我想将这两组组合成一个购买，以常规文本显示设置属性，并以斜体文本显示继承值。但是，似乎没有任何方法可以通过 ICustomTypeDescriptor.GetProperties() 做到这一点。而且我无法轻松访问 PropertyGrid 的属性，因为它们是在程序运行时创建的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-13T19:21:10.533

你不能用斜体——但你可以用粗体；粗体行为由`PropertyDescriptor`'s决定`ShouldSerializeValue`；`PropertyDescriptor`您可以通过各种`System.ComponentModel`技巧（`ICustomTypeDescriptor`或`TypeConverter`）包装s`TypeDescriptionProvider`并提供您自己的`PropertyDescriptor`.

或者，有更多选项的类似网格，例如[VisualHint](http://www.visualhint.com/index.php/propertygrid/) - 请参阅该页面上的“属性自定义”。******************