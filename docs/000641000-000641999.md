# StackOverflow 问答 000641000-000641999

# python - 无法将 iPython 设置为使用 2.6.1 Python

> ID：641000
> 
> 赞同：1
> 
> 时间：2009-03-13T00:19:37.873
> 
> 标签：python, ipython

我已经在 Mac 中安装了最新的 iPython。但是，它使用 Python 版本 2.5.1。

[我在这里](http://www.python.org/download/)通过 MacPython 包安装了 Python 2.6.1 。

**如何让我的 iPython 使用 Python 2.6.1？**

我不确定 MacPython 包在哪里安装了最新的 Python。最新的**Python 应该以某种方式放置 PATH**以便 iPyhon 可以使用它。

**[编辑]**在第一个答案之后

我运行以下命令

```
$ln -s python python2.6 
```

我无法通过以下方式打开 python2.6

```
python 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-03-11T06:08:52.660

一个让它工作的好方法就[在这里。](http://www.jamesmurty.com/2009/06/05/ipython-with-python-2_6-osx-leopard/)在 ipython 指向 python2.6 之前，我需要重新启动终端。注意最新的 ipython 发行版是 0.10，而不是 0.9。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T03:25:37.940

你应该有一个python，python2.5和python2.6，对吗？如果您不想在系统范围内使用 python2.6，则简单的解决方案是将 (ln -s ..) python 符号链接到 python2.6 而不是 python2.5

# mysql - 使用 C++ Builder 在 Windows 上编译 MySQL

> ID：641015
> 
> 赞同：1
> 
> 时间：2009-03-13T00:25:01.930
> 
> 标签：mysql, c++builder, compilation

可能的？想疯了？如果是和否（分别）知道如何去做吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T14:21:48.537

我不知道这是否可能。使用较新版本的 Builder 和一些可能不是微不足道的努力，我猜它可能是。但你到底为什么要这么做？您最终将得到一个在未经测试的环境中编译的 MySQL 版本，而不是 MySQL 本身提供的获得大量测试曝光的分发版本。我想不出这样做的一个优点，但我能想到很多缺点。

如果您的问题是 Builder 是您必须使用的唯一开发环境，请注意您可以使用 Visual C++ Express 进行编译，MS 将免费为您提供。

如果你真的想这样做，你会想要[MySQL 的构建指南](http://dev.mysql.com/doc/mysql-sourcebuild-excerpt/5.1/en/index.html)和[CMake](http://www.cmake.org/)。按照他们对 Visual Studio 的说明，您可以开始构建一些东西。然后，您需要四处寻找合适的编译器选项等等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T00:51:51.820

不应该太具有挑战性；如果您想编译它，只需使用[Cygwin 。](http://www.cygwin.com/)

# macos - 在 Mac 的终端中找不到 Applications 文件夹

> ID：641017
> 
> 赞同：2
> 
> 时间：2009-03-13T00:26:44.877
> 
> 标签：macos, find, locate

我尝试了以下代码不成功

```
find Applications | xargs -0 grep Applications 
```

我也尝试了以下失败

```
find Applications 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-13T00:34:06.153

是不是类似：

```
mdfind 应用程序 | grep 应用程序

```

`mdfind`是*Spotlight*的命令行界面。不知何故，我怀疑这就是你要找的。

以下命令将找到您安装在`/Applications`.

```
查找 /Applications -type d -name "*.app"

```

您的问题很难回答，因为您没有说明您的总体意图是什么......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-13T00:28:47.740

它在/应用程序中。

尝试

```
find /Applications 
```

# web-applications - 您将如何向潜在投资者和利益相关者证明/捍卫免费增值支付模式？

> ID：641018
> 
> 赞同：2
> 
> 时间：2009-03-13T00:27:21.613
> 
> 标签：web-applications, payment

我们正准备发布一个 Web 应用程序，该应用程序提供有限的免费计划以及更多功能丰富的付费计划集合。

似乎我们从投资者等人那里得到的一个常见问题是“为什么你有一个免费的计划？”

在我看来，许多流行的 Web 应用程序（Basecamp、Lighthouse、GitHub 等）的成功似乎都是由这种模式提供支持的，这种模式让人们毫不犹豫地尝试一下，然后非常喜欢它，他们意识到他们需要拥有付费计划中的功能并开始付费。

当然，如果不是全部，我支付的大多数在线应用程序都通过这种方法吸引了我，我知道我很乐意为我喜欢和需要的服务付费。

您如何向那些没有立即看到优点的人宣传这种方法的有用性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-13T00:31:34.910

所有成功的免费增值应用程序的一个关键要素是它们在用户和应用程序之间*创建了依赖关系。*如果使用/收益级别足够高，用户自然会希望成为高级服务的订户并获得附加功能的访问权限。

如果您的利益相关者仍然不相信，那么没有什么比成功更成功了。向他们展示一些过去的应用程序示例，这些应用程序在让人们进行过渡方面做得非常出色[——GitHub](http://github.com)和[iShoot](http://www.newsobserver.com/front/story/1413551.html)，对于初学者来说。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-13T00:38:56.577

成功的软件，事实上任何产品的成功都是获得良好的市场渗透率。使用软件，您根本无法通过预先销售来获得用户，除非您有专门的销售人员和/或庞大的营销预算。

因此，您理解的免费增值路线，在与投资者交谈时，我使用的方法是计算几个销售人员的成本、较长的交货时间等，并将其转化为风险/回报推销。您可以在人员/营销上花费 x 以获得 y 客户。或者你会得到更多的客户，他们不付任何费用，而且还有 y 个客户，他们获得了溢价，但没有人头计算费用。如果你的数字是有道理的，那就是一个强有力的论据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-13T00:32:51.880

我会把他们推荐给乔尔关于[卓越客户服务](http://www.joelonsoftware.com/articles/customerservice.html)的帖子。与之相辅相成的是让人们尝试你的产品；如果我必须为它付费并且不知道我会得到什么回报，我不会尝试你的产品。

我尝试它的风险越小，我就越有可能尝试它。如果我们至少不能尝试并看到它的用处，我的公司就不会购买[SQL Compare 。](http://www.red-gate.com/products/SQL_Compare/index.htm)为什么任何其他软件或 Web 2.0 应用程序会有所不同？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-13T00:33:58.820

其他任何东西的免费样品。我想到了快克可卡因。但是免费食品是杂货行业的标准产品。

另外，要非常清楚，您只是遵循吉列模型：便宜/免费的剃须刀，终身年金购买替换刀片。

[http://en.wikipedia.org/wiki/Razor_and_blades_business_model](http://en.wikipedia.org/wiki/Razor_and_blades_business_model)

# java - JScrollPane 中的组件停止接收 KeyEvents

> ID：641025
> 
> 赞同：0
> 
> 时间：2009-03-13T00:29:55.913
> 
> 标签：java, swing

我在 JScrollPane 中放置了一个组件（ JPanel 上的衍生产品）。

```
scrollPane = new JScrollPane(component); 
```

由于组件偶尔会改变大小，我不得不偶尔做：

```
 SwingUtilities.invokeLater(new Runnable(){

          public void run()
          {
            scrollPane.getViewport().setView(component);
            component.repaint();
          }
    }); 
```

此外，该组件可以接收 KeyEvents

```
 component.addKeyListener(this);
    SwingUtilities.invokeLater(new Runnable()
    {
        public void run()
        {
            component.setFocusable(true);
            component.requestFocusInWindow();       
        }
    }); 
```

但是，组件永远不会收到任何关键事件。甚至其中的代码`keyTyped()`也不会执行（我放在`System.out.println()`那里）。更令人费解的是，在调试模式下，我可以暂停主线程，而 AWT 事件线程将接受关键事件。但在正常执行期间，它不起作用。

谁能建议我做错了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-13T18:23:32.073

制作我的组件 java.swing.Scrollable，并替换`scrollPane.getViewport().setView(component);` 为`component.revalidate`解决了我的问题。

谢谢 ordnungswidrig！

# memory - 您如何命名变量对应用程序的内存使用有任何影响吗？

> ID：641026
> 
> 赞同：13
> 
> 时间：2009-03-13T00:31:03.773
> 
> 标签：memory, variables

声明一个变量名称，其名称的长度对应用程序的总内存有多大（如果有的话）影响？反正有最大长度吗？或者我们是否可以随意详细说明我们的变量（和实例）？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-13T00:35:30.580

实际上，这取决于语言。

如果您使用的是 C++ 或 C，则没有影响。

如果您使用的是解释性语言，那么您就是在传递源代码，因此它会产生巨大的影响。

如果您使用的编译语言可以编译为中间语言，例如 Java 或任何 .NET 语言，那么变量名、类名、方法名等通常都是 IL 的一部分。拥有更长的方法名称会产生影响。但是，如果您稍后运行混淆器，这就会消失，因为混淆器会将所有内容重命名为（通常）非常短的名称。这就是为什么混淆通常会影响性能的原因。

但是，我强烈建议使用长的、描述性的变量/方法/类名。这使您的代码易于理解、可维护和可读 - 从长远来看，这远远超过任何轻微的性能。益处。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-13T00:32:54.173

它对编译语言没有影响。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T00:34:51.643

在编译语言中，几乎可以肯定不是；一切都成为符号表中的符号。在解释型语言中，答案也是否定的，除了一些极其罕见的例外（例如，在某些较旧版本的 Python 中会有差异）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-13T00:36:30.420

MSVC++ 将变量名截断为 255 个字符。变量名长度对编译后的代码大小没有影响。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-13T00:47:25.433

正如其他人所说，变量名在编译语言中消失了。我相信.Net中的局部变量名可能会被丢弃。但一般来说，即使在解释型语言中，变量名的内存消耗也可以忽略不计，特别是考虑到好的变量名的优势。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-13T00:52:50.540

实际上，在 ASP.NET 中，控件和母版页的长变量名确实会增加生成的 HTML 的大小。这将添加一些微不足道的额外内存来缓冲输出流，但效果会在您通过网络发送的额外几百字节中最为明显。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-13T02:21:55.707

在 Python 中，名称似乎被收集到许多简单的表中。每个名称在每个代码对象中只出现一次。名称对性能没有影响。

出于统计目的，我查看了一个 20 行函数，它是 Project Euler 问题 15 的解决方案。该函数创建了一个 292 字节的代码对象。它在名称表中使用了 7 个不同的名称。您必须使用 41 个字符的变量名来将字节码文件的大小加倍。

这将是唯一的影响——疯狂的大名称可能会减慢模块的加载时间。

# c# - 我可以有一个不可变的 IEnumerable<> 吗？

> ID：641037
> 
> 赞同：3
> 
> 时间：2009-03-13T00:34:40.253
> 
> 标签：c#, .net

我有类似这样的代码：

```
class Foo
{
   List<Bar> _myList;
   ...
   public IEnumerable<Bar> GetList() { return _myList; }
} 
```

GetList() 的结果**不**应该是可变的。

澄清一下，如果 Bar 的实例被修改是可以的。
我只是想确保集合本身没有被修改。

我确定我在 SO 上的某个地方读到了一个答案，有人指出这是可能的，但对于我的一生，我再也找不到它了。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-13T00:45:45.610

已经提供的答案绝对可以正常工作，但我只是想补充一点，您可以在 .NET 3.5 中使用*AsReadOnly*扩展方法，如下所示：

```
class Foo
{
   List<Bar> _myList;
   ...
   public ReadOnlyCollection<Bar> GetList() { return _myList.AsReadOnly(); }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-13T00:37:37.970

您可以使用 System.Collections.ObjectModel.ReadOnlyCollection

```
public ReadOnlyCollection<Bar> GetList() {return new ReadOnlyCollection<Bar>(_myList);} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-13T00:38:16.207

```
return new System.Collections.ObjectModel.ReadOnlyCollection<Bar>(_myList); 
```

[http://msdn.microsoft.com/en-us/library/system.collections.objectmodel.aspx](http://msdn.microsoft.com/en-us/library/system.collections.objectmodel.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-13T00:45:37.887

您不能阻止 Bar 元素在 Collection 级别被修改。如果您只希望它在添加/删除/等方面不可变，请使用 ReadOnlyCollection。

如果您需要强制每个元素不可变，那么您必须在 Bar 类中强制执行，即没有设置器或任何更改 Bar 状态的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-13T00:39:14.953

您可以从 ReadOnlyCollecton 公开 IEnumerable 或者您可以执行以下操作（假设 LINQ）：

```
public IEnumerable<Bar> GetList() { return (from item in _myList select item); } 
```

# c++ - C++中重载的指针问题？

> ID：641043
> 
> 赞同：0
> 
> 时间：2009-03-13T00:36:35.430
> 
> 标签：c++, pointers, overloading

指针为重载解决带来了一些特殊问题。

比如说，

```
void f(int* x) { ... }
void f(char* x) { ...}
int main()
{
    f(0);
} 
```

调用 f(0) 有什么问题？如何修复 f(0) 的函数调用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-13T00:39:44.453

`f((int*) 0)`或者`f((char *) 0)`

但如果你发现自己这样做了，我会再看看你的设计。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T00:39:59.617

投射它，或者根本不使用它：

```
f((int*)0); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T00:54:33.793

调用 f(0) 的问题在于分辨率不明确。您的两个重载函数都采用一个指针，在这种情况下只能通过强制转换来解决。

```
f((int*)0) 
```

根据您在此处尝试执行的操作，还有其他明确的选项。

# c - 如何在 Emacs 中折叠 #ifdef/#ifndef 块？

> ID：641045
> 
> 赞同：6
> 
> 时间：2009-03-13T00:36:53.120
> 
> 标签：c, emacs

我想在 C 中隐藏 #ifdef 和 #ifndef 块。看起来我需要使用折叠模式或大纲次要模式。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-13T01:02:10.343

*hide-ifdef-mode*应该做类似的事情。虽然我自己没有使用它，但打开它并使用以下命令阅读它的描述。它应该包含在 emacs 中。

```
M-x hide-ifdef-mode
C-h m 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T07:51:41.700

您可以使用 Cedet 的折叠模式

# c++ - 有哪些工具可以将 C++ 代码与编码指南进行比较？

> ID：641050
> 
> 赞同：8
> 
> 时间：2009-03-13T00:38:12.803
> 
> 标签：c++, coding-style

存在用于将代码与各种语言的自定义指定编码指南/标准集进行比较的工具（而不是针对常见缺陷的纯静态分析）。示例包括.Net 代码的[FxCop和 Java 的](http://msdn.microsoft.com/en-us/library/bb429476(VS.80).aspx)[CheckStyle](http://checkstyle.sourceforge.net/)，但我想知道人们在 C++ 世界中知道哪些示例。

[有人问了一个关于免费工具的现有问题，这些工具提供了](https://stackoverflow.com/questions/93260/a-free-tool-to-check-c-c-source-code-against-a-set-of-coding-standards)[Vera](http://www.inspirel.com/vera/)等示例，但我也想知道可能可用的商业工具。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-13T06:40:27.597

我们使用的工具是 Parasoft 的 CodeWizard。但我认为新版本被称为“Parasoft C++ Test”。从主页：

*   对代码进行静态分析以符合用户选择的编码标准
*   用于创建自定义编码规则的图形规则向导编辑器
*   用于识别潜在运行时错误的静态代码路径模拟
*   具有图形界面和进度跟踪的自动代码审查
*   单元和组件级测试的自动生成和执行
*   灵活的存根框架
*   完全支持回归测试
*   代码覆盖率分析和代码高亮
*   单元测试执行期间的运行时内存错误检查
*   用于桌面和命令行使用的完整团队部署基础架构

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-11-08T23:22:39.863

我设法生成的完整列表：

*   [PRQA 的 QA C++](http://www.programmingresearch.com/QACPP_MAIN.html#1_1)
*   [Parasoft 的 C++ 测试](http://www.parasoft.com/jsp/products/home.jsp?product=CppTest&itemId=47)
*   [MS Visual Studio Team System](http://msdn.microsoft.com/en-us/library/ms181459(VS.80).aspx)似乎有一些功能，但很难通过他们的网站来判断。
*   [GrammaTech CodeSonar](http://www.grammatech.com/products/codesonar/overview.html)
*   [覆盖范围扩展](http://www.coverity.com/products/static-analysis-extend.html)

最后两个提供了一些功能，但不是特别可定制的：

*   [Klocwork 洞察力](http://www.klocwork.com/)
*   [Rational PurifyPlus](http://www-01.ibm.com/software/awdtools/purifyplus/win/features/?S_CMP=wspace)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-13T23:03:52.087

**免责声明：使用此工具是我的日常工作。**

我显然有偏见，但 QA C++ 的主要功能之一是编码标准执行。例如，我们执行 JSF++ 和 MISRA C++ 执行。[您可以在此处](http://www.programmingresearch.com/QACPP_MAIN.html#1_3)阅读有关此内容的更多信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-13T00:41:25.183

`astyle`是一种常见的 Unix 工具，可将源重新格式化为指定的样式。它支持大多数类 C 语言。我知道没有类似的商业工具。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-13T06:14:46.647

> 我还想知道可能可用的商业工具。

Visual Studio Team System Edition 2005/2008 确实有一些这样的东西。他们还可以对整个团队执行一套规则。看看这个。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-08-12T10:57:56.327

我不知道您是在寻找具有内置规则的工具还是想要根据您的自定义规则进行验证。如果是第二个，您可能会发现基于 regexp 实现对不需要的模式的搜索很有用。根据您的需要，Metrix++ [http://metrixplusplus.sourceforge.net/](http://metrixplusplus.sourceforge.net/)可能会提供有用的框架。

# html - diff 到 html (diff2html) 程序

> ID：641055
> 
> 赞同：59
> 
> 时间：2009-03-13T00:39:27.170
> 
> 标签：html, diff

我正在寻找一个“diff to html”程序，它可以从给定的 diff/patch 文件生成一个静态 html 页面。

我当然搜索过它，但除了一些脚本之外，我发现没有“真正的项目”（例如 Debian/Ubuntu 中没有包）。

我错过了什么吗？你能推荐什么吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2011-02-13T23:29:15.723

您可以使用[diff2html.py](http://wiki.droids-corp.org/articles/d/i/f/Diff2html.html)，它能够从统一的 diff 输入在静态 html 页面中创建并排 diff。该脚本是用python编写的。

```
cat foo.diff | python diff2html.py > foo.html 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-13T01:34:11.907

[pygments](http://pygments.org/)为 diff （以及许多其他语言）提供语法突出显示，并且可以用作库或命令行程序。那是你要找的那种东西吗？如果不是，请澄清问题...

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2011-11-16T19:59:27.260

类似于以下内容：

```
vim test.diff -c TOhtml -c ":saveas test.html" -c ":q" -c ":q" 
```

效果很好，您可以通过更改 vi 中的配色方案来更改差异的配色方案。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-05-01T04:58:52.220

[http://www.sourceforge.net/projects/diff2html](http://www.sourceforge.net/projects/diff2html)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-13T01:21:08.787

[Text-Diff-HTML](http://search.cpan.org/dist/Text-Diff-HTML/)，[difflib.HtmlDiff](http://docs.python.org/library/difflib.html#difflib.HtmlDiff)，[CSDiff](http://www.componentsoftware.com/Products/CSDiff/)怎么样？

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-02-12T00:46:39.057

您是否尝试过[http://prettydiff.com/](http://prettydiff.com/)，因为它忽略了空白和评论的差异。

[免责声明：这是我的网站]

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-04-29T11:54:13.987

Vim 中还有[2html](http://vimdoc.sourceforge.net/htmldoc/syntax.html#2html.vim)，效果很好，而且它是内置的：它采用 Vim 知道如何突出其语法的文件，并创建具有正确格式的 HTML。要使用它，只需用 Vim 打开想要的文件，然后获取 2html 脚本。它将在新缓冲区中打开转换后的文件，可以保存。这里：

```
vim example.diff 
```

然后在 Vim 中，

```
:so /usr/share/vim/vim72/syntax/2html.vim
:wqa 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-05-14T13:14:55.833

我发现产生很好的并排差异的最好的是这个脚本：

[http://tools.ietf.org/tools/rfcdiff/](http://tools.ietf.org/tools/rfcdiff/)

尽管它设计用于 RFC，但它适用于任何文本文件。

这个项目也有很好的输出，但我不确定它是否可以在没有颠覆的情况下使用： [http ://code.google.com/p/coderev/](http://code.google.com/p/coderev/)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-13T00:45:00.837

我在 Emacs 中使用[htmlize 。](http://www.emacswiki.org/emacs/Htmlize)不随 Emacs 提供，并假设您使用的是 Emacs。依赖于 Emacs 的 Diff 模式的语法高亮。只适合一次做一个文件。 *为我做正确的事*。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-06-14T20:45:36.030

我找到[了 coderev](http://code.google.com/p/coderev/)，演示看起来不错

# c++ - 什么是域错误

> ID：641064
> 
> 赞同：15
> 
> 时间：2009-03-13T00:41:52.703
> 
> 标签：c++, stl

在 C++ 中，<stdexcept> 有一个用于“域错误”的基类 std::domain_error。我不明白在什么情况下我应该在我的代码中抛出一个域错误。所有其他异常基类都很容易解释。我很确定 std::domain_error 本身与互联网域名无关，因此请解释域错误是哪类错误并提供一些示例。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-13T09:40:11.190

处理数学函数时会使用域误差和范围误差。

一方面，函数的域是函数可以接受的值的集合。例如，平方根函数的域是一组正实数。因此，[`domain_error`](http://en.cppreference.com/w/cpp/error/domain_error)当函数的参数不包含在其域中时，将引发异常

另一方面，函数的范围是函数可以返回的值的集合。例如，像这样的函数的范围：

```
f(x) = -x² 
```

是负实数的集合。那么 的意义`range_error`何在？如果函数的参数在它的域中，那么结果必须在它的范围内，所以我们不应该在范围内有任何错误......但是，有时值可以*定义*，但不能*表示*。例如，在 C 语言中，`<math.h>`如果返回值的大小太大（或太小）无法表示，则函数会产生错误

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-13T00:44:32.167

*域错误*是指函数的数学*域*的问题。有时只为某些值定义函数。如果您尝试使用不属于其域的参数调用此类函数，则这是一个域错误。

例如，尝试`sqrt()`使用负参数调用是域错误，因为负数不属于`sqrt()`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-13T00:47:08.133

很好的解释形式[cplusplus.com](http://www.cplusplus.com/reference/std/stdexcept/domain_error.html)：

> 通常，数学函数的域是为其定义的值的子集。例如，平方根函数只为非负数定义。因此，此类函数的负数将是域错误。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-13T00:47:18.743

好吧，这就是您从 C++ 标准中获得的所有指导：

> 类 domain_error 定义了实现抛出异常的对象类型，以报告域错误。

这里的域是“问题域”的意思，与互联网无关。例如，如果传递负数，平方根函数可能会引发域错误。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-13T00:46:06.793

它用于“域”错误类的逻辑错误。这可能适用于函数的输入超出其操作的允许域的任何情况。这就是标准中规定的目的。

例如，您有一个只接受正浮点数的函数，因此它会为负数抛出 domain_error。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-13T00:47:11.473

“由库或您抛出的详细描述，用于报告域错误（数学意义上的域）。”

来自：[http ://www.aoc.nrao.edu/~tjuerges/ALMA/STL/html/classstd_1_1domain__error.html](http://www.aoc.nrao.edu/~tjuerges/ALMA/STL/html/classstd_1_1domain__error.html)

据此，如果您的输入不符合您在界面上设置的约束，则应该使用它。比如说，一个应该接收正值并被赋予负值的函数。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-13T00:44:35.533

它指的是数学领域。

```
float MySqrRoot(float x)
{
    // sqrt is not valid for negative numbers.
    if (x < 0) throw new domain_error;

    //...
} 
```

# java - 在 JTable 行中检测对象的策略？

> ID：641065
> 
> 赞同：2
> 
> 时间：2009-03-13T00:42:42.060
> 
> 标签：java, sorting, jtable

事情是这样的：一个由 JTableModel 支持的可排序 JTable，它带有一组填充行的对象（一个对象 = 一行）。需要删除行。

不排序，删除对象很简单：获取选中的行索引，删除同一索引下的数组对象。但是，通过排序，行索引在某种意义上会变得混乱，因为它们不再匹配支持数组对象的索引。克服这个问题的正确方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-13T00:59:22.957

奥斯卡几乎是对的，应该这样做：

```
int selectedRow = table.getSelectedRow();
tableModel.removeRow(table.convertRowIndexToModel(selectedRow)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-13T00:46:52.690

我认为（不太确定）有一种像“modelToView”这样的方法，它返回视图索引所代表的模型中的实际索引。

因此，例如，您有 A、B、C、D，然后您对 desc 进行排序。D,C,B,A 此方法将为视图索引 3 ( A ) 返回 0

我认为这是在支持排序的 JXTable 上或在 Java 6 中的 JTable 上。

如果您自己建立了这种排序，请考虑添加此方法。

# c# - 网络连接丢失时，Web 服务调用锁定

> ID：641079
> 
> 赞同：0
> 
> 时间：2009-03-13T00:47:22.610
> 
> 标签：c#, web-services, compact-framework

我在 c# 上为 .NET 紧凑框架 1.0 SP3 平台编写 GUI 应用程序，该平台使用 Web 服务从我们的服务器检索数据。

当我远离接入点时，连接丢失，下一个 Web 服务调用会锁定整个应用程序。每个调用都由 try{...}catch{...} 环绕，但据我在日志中看到的，进程永远不会从锁定的 Web 服务调用返回。

到底是怎么回事？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-13T01:36:31.010

Web 服务的超时时间是多少？您是否尝试过调整超时？

我会添加一个 Thread.Sleep(5000); 在 Web 服务中，然后将客户端中的超时设置为 2 秒，然后使用调试器运行并确保在超时时捕获异常。在连接到网络时执行此操作。

然后，如果经过一定次数的尝试后服务仍然超时，您将希望显示某种错误消息。然后，您需要等待一段可配置的时间，然后再重试。您还需要让用户手动尝试重新连接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T02:21:19.500

超时设置为 10 秒。日志中有一条记录显示三个捕获的异常，然后 Web 服务调用锁定。

# c - 为什么下面的 C 代码是非法的？

> ID：641081
> 
> 赞同：3
> 
> 时间：2009-03-13T00:47:48.803
> 
> 标签：c, pointers, addressof

考虑一个典型的环境，为什么下面的代码在 C 中是非法的？

```
{
int x;
&x = (int*) malloc(3*sizeof(int));
...
} 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-13T00:49:31.373

你不能给地址分配一些东西，`x`因为他的地址`x`不是[左值](http://en.wikipedia.org/wiki/Value_(computer_science))

（An`lvalue`是“可以分配给的东西”，即它不能在**等号**的左侧）

尝试

```
int* x;
x = (int*) malloc(3*sizeof(int)); // TODO: Call free(x) 
```

现在`x`指向您分配的内存，您可以执行以下操作

```
int foo = *x;
int bar = x[0]; 
```

您可以通过以下方式使用运算符将​​地址*分配*`x` *给*`&`其他内容：

```
int x = 1;
int* y = &x;  // y now holds the address of x
*y = 2;       // Now x = 2 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-13T00:50:01.887

因为 x 的地址不是左值 - 它不是可以修改的东西。C 允许您更改地址指向的内容 - 它不允许您更改地址本身。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-13T01:00:07.853

每个人都是正确的。代码执行时 X 的地址是一个常数。换句话说，它说“嘿，你可以改变我，编译器，存储'x'变量的位置。”

你可以这样做

```
int main()
{
    int* x;
    *(&x) = malloc(3*sizeof(int));

} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-13T00:49:40.000

变量的地址不能更改。相反，您很可能想要这样的东西：

```
int *x = (int *)malloc(3 * sizeof(int));
...
free(x); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-13T01:46:31.907

并不是说这完全有价值，但由于没有其他人提出它（上述所有答案都是正确的，顺便说一句，而且是多余的，我同意人们应该投票给正确的答案，而不是一遍又一遍地说同样的话）。

在您的示例中， x 是一个堆栈变量。malloc 为您提供堆内存。在今天的编程中，这可能不是您需要考虑太多的事情，但是如果您曾经在内存非常宝贵的环境中工作，您将希望尽可能地节省您的堆栈。

还值得注意的是，由于某种原因，您分配了 3*sizeof(int)。即使您可以为堆栈分配内存，在您的示例中，由于您只尝试获取 1 个 int，您只需要 1* sizeof(int)，其余部分将被浪费。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-13T00:52:16.950

&x 返回指向 x 的指针。您不能在作业的左侧使用它，只能在右侧使用它。

如果你想给一个指针赋值，你必须把它声明为一个指针，就像**int *x;**

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-13T00:49:54.650

这就是语言的设计方式。要执行您想要的操作，请使用指针。

# php - link_to() 成功生成路由，但单击该链接会导致 404

> ID：641083
> 
> 赞同：1
> 
> 时间：2009-03-13T00:48:53.543
> 
> 标签：php, symfony1

我已经建立了一个[网站](http://www.dur.ac.uk/trevelyan.alumni/)。如果我尝试单击诸如[注册](http://www.dur.ac.uk/trevelyan.alumni/register)之类的链接，则会收到以下错误：

```
404 | Not Found | sfError404Exception
Empty module and/or action after parsing the URL 
    "/trevelyan.alumni/register" (/). 
```

链接是使用生成的

```
<?php 
    print link_to( 'Register', 'register/index' ); 
?> 
```

我在应用程序/前端/模块/注册中有一个“注册”模块。

我对 Symfony 很陌生，感谢任何帮助！

* * *

路由.yml：

```
# default rules
homepage:
  url:   /
  param: { module: home, action: index }

default_index:
  url:   /:module
  param: { action: index }

default:
  url:   /trevelyan.alumni/:module/:action/* 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-13T11:15:16.207

我认为您的问题是您从“子站点”而不是直接从“根”网址运行 symfony（[http://www.dur.ac.uk/trevelyan.alumni](http://www.dur.ac.uk/trevelyan.alumni)而不是[http: //www.dur.ac.uk/](http://www.dur.ac.uk/)）。我认为最简单的解决方案是添加`trevelyan.alumni`到 routing.yml 中所有 url 的前面。

例如，对于`default`路线，而不是

```
default:
  url: /:module/:action/* 
```

采用

```
default:
  url: /trevelyan.alumni/:module/:action/* 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T11:34:44.160

阅读 Steven Oxley，但也试试这个：

检查您的模块目录中至少有一个**具有正确名称**的操作类（symfony 区分大小写，这非常棘手）。

如果这样做，请检查默认操作（在模块配置文件中）是否是模块中的操作类之一。

每次更改配置文件时不要忘记清除缓存。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-15T11:11:59.497

我设法通过编辑 symfony 控制器文件来解决这个问题，以使用 $_SERVER 变量来选择一个模块，如果没有找到的话。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-09-08T14:10:38.853

在您的*routing.yml*文件末尾：

```
homepage:
  url:   
  param: { module: main, action: index }

default:
  url:   /:module/:action/* 
```

并且不要忘记之后清除缓存；）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-13T23:31:03.067

快速说明一下，要使路由更改生效，您必须运行 symfony clear cache：

```
./symfony clear-cache 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-17T10:47:39.413

由于默认路由规则，您应该从匹配的 url 中删除一个点以进行路由

将您的默认路由更改为：

```
default:
  url: /trevelyan_alumni/:module/:action/* 
```

这应该有效。请注意，dot(.) 被替换为 _

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-30T09:16:57.910

我已经从 symfony 1.2 升级到 1.4，并且遇到了这个问题。归根结底，基本上配置文件都已经发生了足够的变化，以至于路由以某种方式中断了。浏览应用程序配置文件并将它们与 lib/vendor/symfony/lib/config/config 中的“新应用程序”模板进行比较/更新（或者您保存 symfony 的任何位置）修复了这个问题。

# .net - BeginPaint 的 hWnd 参数值正确吗？

> ID：641089
> 
> 赞同：3
> 
> 时间：2009-03-13T00:50:58.873
> 
> 标签：.net, c++, gdi

我正在尝试制作一个在窗口中绘制一些数据的 Visual C++ 2008 程序。我从[不同的](http://www.informit.com/articles/article.aspx?p=328647&seqNum=3) [地方](http://msdn.microsoft.com/en-us/library/aa922023.aspx)读到了正确的方法是重写 WndProc。因此，我在 Visual C++ 2008 Express Edition 中制作了一个 Windows 窗体应用程序，并将此代码添加到 Form1.h，但它不会编译：

```
 public:
    [System::Security::Permissions::PermissionSet(System::Security::Permissions::SecurityAction::Demand, Name="FullTrust")]
    virtual void WndProc(Message %m) override
    {
        switch(m.Msg)
        {
            case WM_PAINT:
            {
                HDC     hDC;
                PAINTSTRUCT ps;
                hDC = BeginPaint(m.HWnd, &ps);

                // i'd like to insert GDI code here

                EndPaint(m.Wnd, &ps);
                return;
            }
        }
        Form::WndProc(m);
    } 
```

当我尝试在 Visual C++ 2008 Express Edition 中编译它时，会出现此错误： **错误 C2664: 'BeginPaint' : cannot convert parameter 1 from 'System::IntPtr' to 'HWND'**

当我尝试使用 this->Handle 而不是 m.HWnd 时，会发生相同的错误。

当我尝试将 m.HWnd 转换为 (HWND) 时，会出现此错误： **错误 C2440: 'type cast' : cannot convert from 'System::IntPtr' to 'HWND'**

也许我需要将 m.HWnd 转换为 pin_ptr 或其他东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-13T00:58:49.790

您参考的文章讨论了如何在本机 C++ 应用程序中进行操作，而不是在 WinForms 应用程序中。您应该重写 OnPaint 方法，而不是在 WndProc 中处理消息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-13T01:11:17.750

如果您正在制作原始 Win32 应用程序，那么您可以使用这些功能。

另一方面，如果您正在制作 WinForms 应用程序，那么您需要覆盖 OnPaint 事件。

*   切换到设计视图（显示表单的视图。）
*   单击表单的标题栏
*   在属性窗口中（默认情况下可能在您的右下角屏幕上）选择靠近顶部的闪电。这将显示事件列表。
*   向下滚动到绘画事件并双击它。

您最终将得到一个 Paint 例程外壳，您可以从中使用图形对象的绘图功能。

```
 private: System::Void Form1_Paint(System::Object^  sender, System::Windows::Forms::PaintEventArgs^  e) 
{
    e->Graphics->DrawRectangle(...)              
} 
```

如果你真的想写原始的 Win32 代码，请告诉我，我可以帮你写一个 shell。目前，如果您对 Win32 感兴趣，我推荐 Charles Petzold 的 Programming Windows 5th edition。

如果你想学习 C++ WinForms...好吧，我建议切换到 C# 或 VB.NET，因为它们可能更直观。

希望这可以帮助。干杯。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-13T01:01:29.427

我认为你在 Win32 编程（必须覆盖 WM_PAINT）和 Windows Forms / .NET 之间混淆了，你只需要覆盖 draw 方法。

在 .NET 中在表单上绘图非常简单！您只需覆盖 OnPaint 方法，然后执行所有绘图。

您可以使用 Visual Studio 中的工具箱或在您的类中使用以下代码绑定到绘制处理程序；

```
this.Paint += new System.Windows.Forms.PaintEventHandler(this.MyForm_Paint); 
```

然后像这样实现 MyForm_Paint 方法；

```
private void MyForm_Paint(object sender, System.Windows.Forms.PaintEventArgs e)
{
  //create a graphics object from the form
  Graphics g = this.CreateGraphics();

  // create  a  pen object with which to draw
  Pen p = new Pen(Color.Red, 7);  // draw the line 

  // call a member of the graphics class
  g.DrawLine(p, 1, 1, 100, 100);
} 
```

# c - 从数组中检索和存储元素（根据条件）

> ID：641097
> 
> 赞同：1
> 
> 时间：2009-03-13T00:53:53.187
> 
> 标签：c, arrays, copy, elements, sudoku

给定一个包含 81 个元素的数组（表示 9x9 网格），我如何遍历每个元素，抓住它周围的三个元素，然后对它们执行操作，然后继续到每行、列或子矩阵的下三个元素。查看下方或数独网格以查看布局。

```
 define COL(n)      ((n) % 9)
define ROW(n)      ((n) / 9)
define SUB(n)      ((n / 3) % 9) 
```

例如，我有

```
 int grid[81]; 
```

和

```
 int array_x[9], array_y[9], array_s[9]; 
```

由于总共 9x9 的网格可以拆分为以下 9 个类别，每个数组有 9 个元素，我希望将每列（x 轴）的元素三人一组，执行

```
 r = ((a = ~a) & (b = ~b)) | ((b | a) & ~c);

// or

r = ((~a & ~b)) | ((~b | ~a) & ~c); 
```

在它们上，取三个结果数，并对它们执行，然后将其存储到数组中。

如果这听起来不可能，对不起，我想要一种不同的方式来做到这一点。绝对开放的建议...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-13T01:00:36.573

另一个尝试：

```
void applyThingy(int *grid, int xPitch, int yPitch)
{
    int row, column;
    int *rowPointer = grid;

    for(row = 0; row < 3; ++row)
    {
        int *columnPointer = rowPointer;

        for(column = 0; column < 3; ++column)
        {
            doOperation(columnPointer);
            columnPointer += xPitch;
        }

        rowPointer += yPitch * 9;
    }
}

applyThingy(&grid[SUB(n)], 1, 1); // Perform on 3x3 subgrid
applyThingy(&grid[ROW(n)], 1, 0); // Perform on row
applyThingy(&grid[COL(n)], 0, 1); // Perform on column 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-13T01:39:00.287

我不确定你想做什么，但它是这样的吗？：

```
#define IDX(row, col) ((row)*9+(col))

int m = some_column;
for (int n = 0; n < 9; n += 3) {
  a = grid[IDX(n, m)];
  b = grid[IDX(n+1, m)];
  c = grid[IDX(n+2, m)];
  r = ...;
  ...
} 
```

另外，我不确定你想对你的操作做什么

```
r = ((a = ~a) & (b = ~b)) | ((b | a) & ~c); 
```

你分配`~a`给`a`，这是你想要的吗？如何`a`定义，您想将其设置为什么？你想达到什么目的？

# opengl-es - 为 OpenGL (ES) 创建一个稳定的（帧率稳定的）游戏引擎

> ID：641108
> 
> 赞同：2
> 
> 时间：2009-03-13T00:59:59.163
> 
> 标签：opengl-es

我无法为我的 OpenGL 应用程序创建可靠的游戏引擎。这是一款由多个动作的精灵组成的游戏。

我创建的对象基本上都是我的精灵。另一个名为“gameEngine”的对象每隔几秒（一个计时器）循环执行一组计算，从而产生新的游戏变量。之后，精灵对象现在知道它们的绘图数据。

问题是，在收集了我所有的绘图数据后，绘图应该在正确的时间进行，从而产生稳定的动画。根据当前场景的复杂性，游戏计算需要不确定的时间量。因此，实际绘图发生在不同的时间点。我将如何防止这种情况发生？

为了澄清，我的方法是这样的：

```
// Every something of a second I call tick
-(void)tick
{
  drawingData = gameEngine();
  draw(drawingData); 
} 
```

必须有构建这样的游戏引擎的最佳实践我不知道吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-13T02:30:15.530

游戏循环有很多种，但更好的循环将动画与绘图或更经典的术语模型和视图分开。基本上，您想构建一个游戏模型，您可以在其中建立时间流逝并更新模型（物理帧率），然后在连续时刻独立渲染模型的快照（渲染帧率）。

这里有几篇文章更详细地解释了游戏循环的一些变化及其优缺点。也有源代码。我希望它有所帮助。

[修复你的时间步长！](http://gafferongames.com/game-physics/fix-your-timestep/)和 [deWiTTERS 游戏循环文章](http://dewitters.koonsolo.com/gameloop.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T01:19:37.807

这真的与 OpenGL 无关。它更多地与您正在使用的操作系统或系统 API（即 Carbon/Cocoa/Win32）有关。但真正非常简单的情况是这样的（伪代码）：

```
checkTime = currentTime
while not exitCondition
    if currentTime - checkTime >= 50 milliseconds
        checkTime = checkTime + 50 milliseconds
        updateScene
    else drawScene 
```

您尽可能频繁地绘制，但仅每 50 毫秒更新一次（即每秒 20 次）。显然还有**很多**其他的事情需要考虑，尤其是当你落后（跳帧）时你会做什么。

了解 OpenGL 内容的最佳地点是 Nehe 的课程：

[http://nehe.gamedev.net/lesson.asp?index=01](http://nehe.gamedev.net/lesson.asp?index=01)

它们有点过时了，但每节课底部的示例代码是一个很好的起点，它有多种语言和多种操作系统可用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T01:04:31.650

它在某种程度上取决于平台，但通常有效的一种基本方法是在渲染循环中使用高性能计时器，并使用它来帮助您在帧之间休眠，以获得稳定、稳定的帧速率。

您可以对帧的渲染进行计时，然后按数量休眠以保持稳定的帧速率。

但是，如果您的平台无法跟上您想要达到的帧速率，您将需要开始寻找优化游戏引擎的方法。这只会减慢速度以使它们保持一致和流畅 - 而不是加快速度。

--- 澄清 ----

```
`-(void)tick
{
    time = now() // from high perf. timer
    drawingData = gameEngine();

```
newTime = now()
// pause for the time required to make the framerate consistent
Sleep(totalTimeForTickToBeStable - newTime + time)
draw(drawingData); 
```

}` 

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T02:30:04.453

最好的解决方案是多线程应用程序——一个线程将绘图数据计算到缓冲区中，一个线程渲染数据。

如果您正在寻找一个非常简单的解决方案，只需颠倒计算和渲染的顺序即可。

```
void Initialize()
{    
   DrawingData = GameEngine();
}

void Tick()
{
   Draw(DrawingData);
   DrawingData = GameEngine();
} 
```

您在应用程序启动时计算第一个绘图数据，当计时器触发时，您只需绘制它。之后，您可以一直到下一个计时器事件再次计算绘图数据。

但总的来说，以可变帧速率渲染可能是更好的解决方案 - 如果机器要慢到您想要的帧速率并且您在快速机器上提供高帧速率，您可以避免这些问题。

```
void Main()
{
   StartTime = Now();

   while (!ExitRequested)
   {     
      DrawingData = GameEngine(Now() - StartTime);
      Draw(DrawingData);
   }
} 
```

您尽可能快地渲染帧 - 不是每个帧之间的固定间隔，而是应用程序运行的实时时间。这意味着不要每帧将对象推进 20 毫秒，只需将它们移动到当前运行时间表示的位置即可。

# iphone - 带有 Cocoa 编程的 NIB/XIB 文件 - 更快的开发时间？

> ID：641117
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-03-13T01:06:49.303
> 
>         
> 
> 标签：iphone, cocoa, cocoa-touch

我用 iPhone SDK 编程已经有一段时间了。

我没有使用界面生成器。这让我有点害怕。我知道实际上我可能在“与框架作斗争”，但我不这么认为。

我发现在我的应用程序委托中实例化我的 UITabBarController 非常容易，实例化一个 UINavigationController，然后随时推送和弹出视图控制器。

自然，我对如何使用 XIB 文件构建应用程序没有广泛的知识，因为我从未这样做过，但是我确实知道它的一般要点，我已经使用 NIB 在 Cocoa 中构建了一些 Mac 应用程序。所以我并不是完全无知。

My question is whether there is an increase in development time when choosing to lay out UITableViewControllers and UIViewControllers using XIBs rather than programmatically instantiating them and then setting up the ivars.  

正如我所看到的，这两种方法仍然需要您将视图控制器子类化以进行自定义，这可能会发生在您的大多数视图中。同样，代表仍然需要手动课程，并且从 XIB 内部连接插座的过程似乎与我设置 ivar 相当。

还是我错过了其他一些要点？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T01:22:05.600

与 IB 相比，编写代码来配置 UI 所需的时间要长得多。

此外，您可以将设计交给设计师，让他们调整 UI。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T01:51:51.350

最后他们都完成了同样的事情。您应该根据具体情况使用其中一种。大多数时候编写代码来创建和定位视图，尤其是在以后维护它，将比使用 IB 花费更长的时间。不过，在一个简单的 iPhone 应用程序中，这可能不是真的，您最好在代码中创建所有内容。基本上，您应该知道如何做到这两点，并选择涉及最清晰代码和最快开发的路径。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T02:15:21.790

当您使用 IB 来实际布置视图时，它会大放异彩；即使是两个或三个视图，在代码中进行布局和配置也会很麻烦。我确实倾向于将它用于选项卡栏和导航控制器，有时用于子控制器（通常仅在我认为用户很可能使用它的情况下），但这更多是因为我已经在那里，所以我觉得它很方便。

有了他们下周宣布的这个新版本 3 操作系统，我希望 Interface Builder 能够获得它在 Cocoa 中的一些灵活性，您可以在其中为自己的类添加调色板，甚至构建复杂的非视图数据结构（通过使用自定义调色板）。不过，我们必须拭目以待。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T01:12:33.563

不要太担心，IMO Interface Builder 也有点高估了。

它对于让事情快速启动和运行绝对有用，或者如果您的应用程序有很多设置繁琐的屏幕，但您并没有错过太多。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-14T06:38:48.297

对于您概述的用途，只需在代码中执行操作就可以了，甚至可能更容易理解。

布局视图或自定义单元格......然后你会进入大量的字体/颜色/位置设置，这些设置很快就会变成大量代码，难以维护和调整。在这些情况下，更容易在 IB 中调整您想要的内容。

# php - 解析 SQL 字符串

> ID：641119
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T01:07:22.283
> 
>         
> 
> 标签：php, sql

将 sql 字符串解析为单独的组件的好方法是什么。我尝试过使用正则表达式，但是我无法让它正常工作。

比如说：

```
"SELECT * FROM tbl WHERE user_id > 50" 
```

将创建一个包含所有组件的数组

```
$arr[0] = "SELECT";
$arr[1] = "*";
$arr[2] = "FROM"; 
```

等等...

谢谢

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T01:11:30.073

我会选择一个可以集成到您的语言中的 sql 解析器：不要重新发明轮子。

我没有特别推荐使用其中一种，但我相信您可以找到满足您需要的一种。

参见相关：[PHP MySQL SQL 解析器（插入和更新）](https://stackoverflow.com/questions/283087/php-mysql-sql-parser-insert-and-update)

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T01:11:59.353

SQL SELECT 语句的完整语法非常复杂。我认为您可能希望将自己限制在其中的一个子集。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T01:22:22.700

正则表达式只能解析[正则语言](http://en.wikipedia.org/wiki/Regular_language)。也就是可以用有限状态机来表达的语言。  

大多数编程语言，包括 SQL，都不能表示为正则语言，因此不能用正则表达式解析。即使是像拆分 SQL 表达式这样有限的任务，使用正则表达式也会变得异常困难。

您需要使用更强大的解析器生成器来处理更复杂的语法。你用 PHP 标记你的问题，所以你可能想研究一下[Lime](http://lime-php.sourceforge.net/)。  

您还需要找到与您选择的解析器生成器兼容的 PHP 语法文件。我不知道在哪里可以买到 PHP 和 Lime，但是有一个名为[DBIx::MyParsePP](http://search.cpan.org/~philips/DBIx-MyParsePP-0.50/lib/DBIx/MyParsePP.pm)的纯 Perl 项目，它基于 MySQL 的语法。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T01:15:25.430

正确和完整地解析 SQL 是很困难的。您可以免费使用像 ANTLR 这样的解析器生成器工具包以及 SQL“语法”。出于成本考虑，我知道[Visual Studio Team System 2008 数据库版](http://www.microsoft.com/downloads/details.aspx?FamilyID=bb3ad767-5f69-4db9-b1c9-8f55759846ed&displaylang=en)包含一个 SQL 解析器。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T01:40:25.103

您展示的示例是一段代码，它将读取您的 SQL 语句并在其间进行标记化并将每个标记存储在数组中。如果您正在寻找这样的代码，您可以使用 php 中的拆分函数来实现：http:
 [//ca.php.net/split](http://ca.php.net/split)

问候，

波利亚。

# sql-server - Sql Server Profiler 中的“exec sp_reset_connection”是什么意思？

> ID：641120
> 
>         
> 
> 赞同：178
> 
>         
> 
> 时间：2009-03-13T01:07:34.637
> 
>         
> 
> 标签：sql-server, database-connection, sql-server-profiler, sp-reset-connection

试图通过发出“sp_reset_connection”来理解 Sql Profiler 的含义。

我有以下“exec sp_reset_connection”行，后跟 BatchStarting 和 Completed，

```
RPC:Completed       exec sp_reset_connection
SQL:BatchStarting   SELECT [c].[TestID] AS [TestID], [c].[Description] AS [Description] FROM [dbo].[Test] AS [c]
SQL:BatchCompleted  SELECT [c].[TestID] AS [TestID], [c].[Description] AS [Description] FROM [dbo].[Test] AS [c] 
```

基本上第一行“exec sp_reset_connection”是否意味着整个过程（我的连接被打开，select stmt运行，然后连接被关闭并释放回池）才发生？或者我的连接仍处于开放阶段。

而且，为什么 sp_reset_connection 在我自己的 select 语句之前执行，它不应该在用户的 sql 之后进行重置吗？

我想知道有没有办法更详细地了解连接何时打开和关闭？

通过看到“exec sp_reset_connection”，这是否意味着我的连接已关闭？

* * *

## 回答 #1

> 赞同：209
> 
>             
> 
> 时间：2010-05-27T20:01:31.807

就像其他答案所说，`sp_reset_connection`表明连接池正在被重用。注意一个特殊的后果！

> **[Jimmy Mays 的 MSDN 博客](http://blogs.msdn.com/b/jimmymay/archive/2009/02/02/sp-reset-connection-does-not-reset-transaction-isolation-level-unexpected-behavior-by-design.aspx)**说：
> 
>   
>   
> 
> sp_reset_connection 不会将事务隔离级别从先前连接的设置重置为服务器默认值。

**更新**：从 SQL 2014 开始，对于 TDS 版本 7.3 或更高版本的客户端驱动程序，事务隔离级别将重置为默认值。

参考：[SQL Server：跨池连接的隔离级别泄漏](https://stackoverflow.com/questions/9851415/sql-server-isolation-level-leaks-across-pooled-connections)

以下是一些附加信息：

> **[sp_reset_connection 有什么作用？](http://web.archive.org/web/20100730003952/http://sqldev.net/articles/sp_reset_connection/default.html)**
> 
>   
>   
> 
> 数据访问 API 的层（如 ODBC、OLE-DB 和 System.Data.SqlClient）在重新使用连接池中的连接时都调用（内部）存储过程 sp_reset_connection。它这样做是为了在重新使用之前重置连接的状态，但是没有记录什么东西会被重置。本文尝试记录被重置的连接部分。
> 
>   
>   
> 
> sp_reset_connection 重置连接的以下方面：
> 
>   
>   
> 
> *   所有错误状态和数字（如@@error）
>     
>     
> 
> *   停止作为执行并行查询的父 EC 的子线程的所有 EC（执行上下文）
>     
>     
> 
> *   等待任何未完成的 I/O 操作
>     
>     
> 
> *   通过连接释放服务器上所有持有的缓冲区
>     
>     
> 
> *   解锁连接使用的任何缓冲区资源
>     
>     
> 
> *   释放连接拥有的所有已分配内存
>     
>     
> 
> *   清除连接创建的任何工作表或临时表
>     
>     
> 
> *   杀死连接拥有的所有全局游标
>     
>     
> 
> *   关闭所有打开的 SQL-XML 句柄
>     
>     
> 
> *   删除任何打开的 SQL-XML 相关工作表
>     
>     
> 
> *   关闭所有系统表
>     
>     
> 
> *   关闭所有用户表
>     
>     
> 
> *   删除所有临时对象
>     
>     
> 
> *   中止未结交易
>     
>     
> 
> *   入伍时分布式事务的缺陷
>     
>     
> 
> *   减少当前数据库中释放共享数据库锁的用户的引用计数
>     
>     
> 
> *   释放获得的锁
>     
>     
> 
> *   释放任何获取的句柄
>     
>     
> 
> *   将所有 SET 选项重置为默认值
>     
>     
> 
> *   重置@@rowcount 值
>     
>     
> 
> *   重置@@identity 值
>     
>     
> 
> *   使用 dbcc traceon() 重置任何会话级别的跟踪选项
>     
>     
> 
> *   `NULL`在 SQL Server 2005 和更新版本中将CONTEXT_INFO 重置为[[不是原始文章的一部分]]
>     
>     
> 
>   
>   
> 
> **sp_reset_connection 不会重置：**
> 
>   
>   
> 
> *   安全上下文，这就是连接池根据确切的连接字符串匹配连接的原因
>     
>     
> 
> *   使用[sp_setapprole](https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-setapprole-transact-sql)输入的应用程序角色，因为在 SQL Server 2005 之前根本无法恢复应用程序角色。从 SQL Server 2005 开始，可以恢复应用程序角色，但只能使用不属于会话的附加信息。在关闭连接之前，需要通过[sp_unsetapprole](https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-unsetapprole-transact-sql)使用`sp_setapprole`执行时捕获的“cookie”值手动恢复应用程序角色。

*注意：我在此处包含列表，因为我不希望它在瞬息万变的网络中丢失。*

* * *

## 回答 #2

> 赞同：22
> 
>             
> 
> 时间：2009-03-13T01:32:38.180

这表明正在使用连接池（这是一件好事）。

* * *

## 回答 #3

> 赞同：10
> 
>             
> 
> 时间：2011-08-03T10:01:08.890

但请注意：

如果在存储过程或触发器中发出 SET TRANSACTION ISOLATION LEVEL，则当对象返回控制权时，隔离级别将重置为调用对象时有效的级别。例如，如果在批处理中设置 REPEATABLE READ，然后批处理调用将隔离级别设置为 SERIALIZABLE 的存储过程，则当存储过程将控制权返回给批处理时，隔离级别设置将恢复为 REPEATABLE READ。

[http://msdn.microsoft.com/en-us/library/ms173763.aspx](http://msdn.microsoft.com/en-us/library/ms173763.aspx)

# algorithm - 编程代数方程

> ID：641121
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T01:08:09.253
> 
>         
> 
> 标签：algorithm, math, linear-algebra, pseudocode

在另一篇文章中，MSN 给了我一个很好的指导来解决我的代数问题（[从总成本计算出价](https://stackoverflow.com/questions/639215/calculating-bid-price-from-total-cost)）。现在，即使我可以手动计算它，我也完全不知道如何用伪代码或代码编写它。任何人都可以给我一个快速提示？顺便说一句，我想根据最终成本计算出价。

```
usage cost(bid) = PIN(bid*0.10, 10, 50)
seller cost(bid) = bid*.02
added cost(bid) = PIN(ceiling(bid/500)*5, 5, 10) + PIN(ceiling((bid - 1000)/2000)*5, 0, 10)
storing cost(bid) = 100
So the final cost is something like:

final cost(bid) = PIN(bid*.1, 10, 50) + pin(ceiling(bid/500)*5, 5, 20) + PIN(ceiling((bid - 1000)/2000)*10, 0, 20) + bid*.02 + 100 + bid
Solve for a particular value and you're done.

For example, if you want the total cost to be $2000:

2000 = PIN(bid*.1, 10, 50) + pin(ceiling(bid/500)*5, 5, 10) + PIN(ceiling((bid - 1000)/2000)*5, 0, 10) + bid*.02 + 100 + bid.
Bid must be at least > 1500 and < 2000, which works out nicely since we can make those PIN sections constant:

2000 = 50 + 10 + 5 + 100 + bid*1.02
1835 = bid*1.02
bid = 1799.0196078431372549019607843137 
```

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T02:32:56.053

该函数简化为：

```
 / 1.02 * bid + 115   bid <   100
                  | 1.12 * bid + 105   bid <=  500
final cost(bid) = | 1.02 * bid + 160   bid <= 1000
                  | 1.02 * bid + 165   bid <= 3000
                  \ 1.02 * bid + 170   otherwise 
```

如果您将每个部分视为一个单独的函数，则可以将它们反转：

```
bid_a(cost) = (cost - 115) / 1.02
bid_b(cost) = (cost - 105) / 1.12
bid_c(cost) = (cost - 160) / 1.02
bid_d(cost) = (cost - 165) / 1.02
bid_e(cost) = (cost - 170) / 1.02 
```

如果您将成本计入每个功能，您将获得该范围的估计出价。您必须检查该值是否确实在该函数的有效范围内。

例子：

```
cost = 2000

bid_a(2000) = (2000 - 115) / 1.02 = 1848  Too big! Need to be < 100
bid_b(2000) = (2000 - 105) / 1.12 = 1692  Too big! Need to be <= 500
bid_c(2000) = (2000 - 160) / 1.02 = 1804  Too big! Need to be <= 1000
bid_d(2000) = (2000 - 165) / 1.02 = 1799  Good. It is <= 3000
bid_e(2000) = (2000 - 170) / 1.02 = 1794  Too small! Need to be > 3000

Just to check:

final cost(1799) = 1.02 * 1799 + 165 = 2000   Good! 
```

由于原始函数是严格递增的，因此这些函数中最多有一个会给出可接受的值。但是对于某些输入，它们都不会给出很好的价值。这是因为原始函数跳过了这些值。

```
final cost(1000) = 1.02 * 1000 + 160 = 1180
final cost(1001) = 1.02 * 1001 + 165 = 1186 
```

因此，例如，没有函数会给出可接受的值`cost = 1182`。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T01:47:33.963

由于使用`PIN`and `ceiling`，我看不到一种简单的方法来反转计算。假设它`bid`具有固定的精度（我猜点后面有两位小数），您总是可以使用二进制搜索（因为函数是单调的）。

编辑：在考虑了更多之后，我观察到`x = bid*1.02 + 100`，我们发现最终成本在 x+15（不含）和 x+70（含）之间（即`x+15 < final cost < x+70`）。考虑到这个范围的`70-15=55`大小（它不再有任何一个或其中）。`bid``x+15 = final cost``x+70 = final cost``PIN``ceiling`

为了说明，设最终成本为`222`。由此可知。`x+15 = 222`_ `bid = 107/1.02 = 104.90`然后我们得到使用成本由 给出，`bid*0.1`而附加成本为`5`。换句话说，我们得到`final cost = bid*0.1 + bid*0.02 + 5 + 100 + bid = bid*1.12 + 105`，因此`bid = (222-105)/1.12 = 104.46`。由于这个值`bid`意味着使用和额外成本的正确值，我们知道这就是解决方案。

但是，如果我们首先查看`x+70 = 222`，我们会得到以下内容。首先我们得到这个假设`bid = 52/1.02 = 50.98`。这意味着使用成本为`10`，附加成本为`5`。所以我们得到`final costs = 10 + bid*0.02 + 5 + 100 + bid = bid*1.02 + 115`和 因此`bid = (222-115)/1.02 = 104.90`。但是如果`bid`是，`104.90`那么使用成本不是`10`，`bid*0.1`所以这不是正确的解决方案。

我希望我解释得足够清楚。如果没有，请告诉我。

注意：对于特殊值，我指的是那些定义使用值和附加成本的函数发生变化的值。例如，对于使用成本，这些值为`100`和`500`：在`100`您使用之下、在您使用`10`之上以及在您之间使用。`500``50``bid*0.1`

# macos - Mac OS X 上的 POSIX 信号量：sem_timedwait 替代方案

> ID：641126
> 
>         
> 
> 赞同：15
> 
>         
> 
> 时间：2009-03-13T01:10:58.060
> 
>         
> 
> 标签：macos, unix, posix, semaphore

我正在尝试将使用信号量的项目（来自 linux）移植到 Mac OS X，但是某些 posix 信号量未在 Mac OS X 上实现

我在这个港口打的那个是`sem_timedwait()`

我对信号量了解不多，但从手册页`sem_wait()`看来似乎很接近`sem_timedwait`并且已实现

从手册页

> `sem_timedwait()`
> 
>   `sem`函数应锁定函数中 as  引用的信号量`sem_wait()`。但是，如果在
> 
>   不等待另一个进程或线程
> 
>   通过执行某个`sem_post()`
>   功能来解锁信号量的情况下无法锁定信号量，则应
> 
>   在指定的超时到期时终止此等待

从我对信号量如何工作的有限理解来看，我认为这`sem_timedwait()`更安全，但我仍然应该能够使用 sem_wait()

它是否正确？如果不是我还有什么其他选择...

谢谢

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-05-03T07:03:07.427

超时可能对算法的操作很重要。因此，仅使用`sem_wait()`可能行不通。

您可以使用`sem_trywait()`, 在所有情况下都会立即返回。然后，您可以循环并使用您选择的睡眠间隔，每次都会减少总超时，直到您用完超时或获取信号量。

一个更好的解决方案是重写算法以使用条件变量，然后您可以使用它`pthread_cond_timedwait()`来获得适当的超时。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2013-03-01T17:44:19.907

另一种选择可能是使用 
澳大利亚天文台软件组的 Keith Shortridge 的[sem_timedwait.c实现。](http://www.aao.gov.au/local/www/ks/uploads/sem_timedwait.c)

从源文件：

```
/*
*                       s e m _ t i m e d w a i t
*
*  Function:
*     Implements a version of sem_timedwait().
*
*  Description:
*     Not all systems implement sem_timedwait(), which is a version of
*     sem_wait() with a timeout. Mac OS X is one example, at least up to
*     and including version 10.6 (Leopard). If such a function is needed,
*     this code provides a reasonable implementation, which I think is
*     compatible with the standard version, although possibly less
*     efficient. It works by creating a thread that interrupts a normal
*     sem_wait() call after the specified timeout.
*
* ...
*
*  Limitations:
*
*     The mechanism used involves sending a SIGUSR2 signal to the thread
*     calling sem_timedwait(). The handler for this signal is set to a null
*     routine which does nothing, and with any flags for the signal 
*     (eg SA_RESTART) cleared. Note that this effective disabling of the
*     SIGUSR2 signal is a side-effect of using this routine, and means it
*     may not be a completely transparent plug-in replacement for a
*     'normal' sig_timedwait() call. Since OS X does not declare the
*     sem_timedwait() call in its standard include files, the relevant 
*     declaration (shown above in the man pages extract) will probably have
*     to be added to any code that uses this.
* 
* ...
* 
*  Copyright (c) Australian Astronomical Observatory.
*  Commercial use requires permission.
*  This code comes with absolutely no warranty of any kind.
*/ 
```

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2018-02-14T01:47:47.150

我曾经在 OSX 上使用命名信号量，但现在 sem_timedwait 不可用，并且不推荐使用 sem_init 和朋友。我使用 pthread 互斥体和条件实现了信号量，如下对我有用（OSX 10.13.1）。您可能需要制作一个句柄与结构表并查找 sem_t 类型，如果它不能在其中保存一个 ptr（即指针是 64 位而 sem_t 是 32？）

```
#ifdef __APPLE__

typedef struct
{
    pthread_mutex_t count_lock;
    pthread_cond_t  count_bump;
    unsigned count;
}
bosal_sem_t;

int sem_init(sem_t *psem, int flags, unsigned count)
{
    bosal_sem_t *pnewsem;
    int result;

    pnewsem = (bosal_sem_t *)malloc(sizeof(bosal_sem_t));
    if (! pnewsem)
    {
        return -1;
    }
    result = pthread_mutex_init(&pnewsem->count_lock, NULL);
    if (result)
    {
        free(pnewsem);
        return result;
    }
    result = pthread_cond_init(&pnewsem->count_bump, NULL);
    if (result)
    {
        pthread_mutex_destroy(&pnewsem->count_lock);
        free(pnewsem);
        return result;
    }
    pnewsem->count = count;
    *psem = (sem_t)pnewsem;
    return 0;
}

int sem_destroy(sem_t *psem)
{
    bosal_sem_t *poldsem;

    if (! psem)
    {
        return EINVAL;
    }
    poldsem = (bosal_sem_t *)*psem;

    pthread_mutex_destroy(&poldsem->count_lock);
    pthread_cond_destroy(&poldsem->count_bump);
    free(poldsem);
    return 0;
}

int sem_post(sem_t *psem)
{
     bosal_sem_t *pxsem;
    int result, xresult;

    if (! psem)
    {
        return EINVAL;
    }
    pxsem = (bosal_sem_t *)*psem;

    result = pthread_mutex_lock(&pxsem->count_lock);
    if (result)
    {
        return result;
    }
    pxsem->count = pxsem->count + 1;

    xresult = pthread_cond_signal(&pxsem->count_bump);

    result = pthread_mutex_unlock(&pxsem->count_lock);
    if (result)
    {
        return result;
    }
    if (xresult)
    {
        errno = xresult;
        return -1;
    }
}

int sem_trywait(sem_t *psem)
{
    bosal_sem_t *pxsem;
    int result, xresult;

    if (! psem)
    {
        return EINVAL;
    }
    pxsem = (bosal_sem_t *)*psem;

    result = pthread_mutex_lock(&pxsem->count_lock);
    if (result)
    {
        return result;
    }
    xresult = 0;

    if (pxsem->count > 0)
    {
        pxsem->count--;
    }
    else
    {
        xresult = EAGAIN;
    }
    result = pthread_mutex_unlock(&pxsem->count_lock);
    if (result)
    {
        return result;
    }
    if (xresult)
    {
        errno = xresult;
        return -1;
    }
    return 0;
}

int sem_wait(sem_t *psem)
{
    bosal_sem_t *pxsem;
    int result, xresult;

    if (! psem)
    {
        return EINVAL;
    }
    pxsem = (bosal_sem_t *)*psem;

    result = pthread_mutex_lock(&pxsem->count_lock);
    if (result)
    {
        return result;
    }
    xresult = 0;

    if (pxsem->count == 0)
    {
        xresult = pthread_cond_wait(&pxsem->count_bump, &pxsem->count_lock);
    }
    if (! xresult)
    {
        if (pxsem->count > 0)
        {
            pxsem->count--;
        }
    }
    result = pthread_mutex_unlock(&pxsem->count_lock);
    if (result)
    {
        return result;
    }
    if (xresult)
    {
        errno = xresult;
        return -1;
    }
    return 0;
}

int sem_timedwait(sem_t *psem, const struct timespec *abstim)
{
    bosal_sem_t *pxsem;
    int result, xresult;

    if (! psem)
    {
        return EINVAL;
    }
    pxsem = (bosal_sem_t *)*psem;

    result = pthread_mutex_lock(&pxsem->count_lock);
    if (result)
    {
        return result;
    }
    xresult = 0;

    if (pxsem->count == 0)
    {
        xresult = pthread_cond_timedwait(&pxsem->count_bump, &pxsem->count_lock, abstim);
    }
    if (! xresult)
    {
        if (pxsem->count > 0)
        {
            pxsem->count--;
        }
    }
    result = pthread_mutex_unlock(&pxsem->count_lock);
    if (result)
    {
        return result;
    }
    if (xresult)
    {
        errno = xresult;
        return -1;
    }
    return 0;
}

#endif 
```

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-05-03T16:15:16.693

您是否考虑过使用 apache 可移植运行时？它预装在每个 Mac OS X Box 和许多 Linux 发行版上，它带有一个围绕线程并发的平台中立包装器，甚至可以在 MS Windows 上工作：

[http://apr.apache.org/docs/apr/1.3/group__apr__thread__cond.html](http://apr.apache.org/docs/apr/1.3/group__apr__thread__cond.html)

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2011-12-30T05:54:15.350

我认为最简单的解决方案是使用 sem_wait() 结合调用 alarm() 唤醒中止等待。例如：

```
alarm(2);
int return_value = sem_wait( &your_semaphore );
if( return_value == EINTR )
   printf( "we have been interrupted by the alarm." ); 
```

一个问题是警报需要几秒钟作为输入，因此在您的情况下，定时等待可能太长了。

——阿吉利斯

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2020-05-15T16:34:14.443

一种选择是使用低级 semaphore mach API：

```
#include <mach/semaphore.h>

semaphore_create(...)

semaphore_wait(...)
semaphore_timedwait(...)
semaphore_signal(...)

semaphore_destroy(...) 
```

它用于libuv BTW。

参考：

*   [https://opensource.apple.com/source/xnu/xnu-201/osfmk/kern/sync_sema.c](https://opensource.apple.com/source/xnu/xnu-201/osfmk/kern/sync_sema.c)

*   [https://github.com/libuv/libuv/blob/master/src/unix/thread.c](https://github.com/libuv/libuv/blob/master/src/unix/thread.c)

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-05-03T05:58:36.847

如果没有被应该调用 sem_post() 的主线程调用，您能否尝试通过在另一个调用 sem_post() 的线程中启动一个定时器来模拟 sem_timedwait() 调用的功能？

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2010-03-03T16:08:40.083

如果您只能使用 MP API：

*   MPCreateSemaphore/MPDeleteSemaphore

*   MPSignalSemaphore/MPWaitOnSemaphore

`MPWaitOnSemaphore``kMPTimeoutErr`如果超过指定的超时时间而没有发出信号，则存在。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2016-05-19T13:22:08.147

我计划使用以下函数作为替代，但后来我发现 sem_getvalue() 在 OSX 上也已被弃用且无法使用。您可以在 MIT 或 LGPL 许可（您的选择）下自由使用以下未经测试的代码。

```
#ifdef __APPLE__
struct CSGX__sem_timedwait_Info
{
    pthread_mutex_t MxMutex;
    pthread_cond_t MxCondition;
    pthread_t MxParent;
    struct timespec MxTimeout;
    bool MxSignaled;
};

void *CSGX__sem_timedwait_Child(void *MainPtr)
{
    CSGX__sem_timedwait_Info *TempInfo = (CSGX__sem_timedwait_Info *)MainPtr;

    pthread_mutex_lock(&TempInfo->MxMutex);

    // Wait until the timeout or the condition is signaled, whichever comes first.
    int Result;
    do
    {
        Result = pthread_cond_timedwait(&TempInfo->MxCondition, &TempInfo->MxMutex, &TempInfo->MxTimeout);
        if (!Result)  break;
    } while (1);
    if (errno == ETIMEDOUT && !TempInfo->MxSignaled)
    {
        TempInfo->MxSignaled = true;
        pthread_kill(TempInfo->MxParent, SIGALRM);
    }

    pthread_mutex_unlock(&TempInfo->MxMutex);

    return NULL;
}

int sem_timedwait(sem_t *sem, const struct timespec *abs_timeout)
{
    // Quick test to see if a lock can be immediately obtained.
    int Result;

    do
    {
        Result = sem_trywait(sem);
        if (!Result)  return 0;
    } while (Result < 0 && errno == EINTR);

    // Since it couldn't be obtained immediately, it is time to shuttle the request off to a thread.
    // Depending on the timeout, this could take longer than the timeout.
    CSGX__sem_timedwait_Info TempInfo;

    pthread_mutex_init(&TempInfo.MxMutex, NULL);
    pthread_cond_init(&TempInfo.MxCondition, NULL);
    TempInfo.MxParent = pthread_self();
    TempInfo.MxTimeout.tv_sec = abs_timeout->tv_sec;
    TempInfo.MxTimeout.tv_nsec = abs_timeout->tv_nsec;
    TempInfo.MxSignaled = false;

    sighandler_t OldSigHandler = signal(SIGALRM, SIG_DFL);

    pthread_t ChildThread;
    pthread_create(&ChildThread, NULL, CSGX__sem_timedwait_Child, &TempInfo);

    // Wait for the semaphore, the timeout to expire, or an unexpected error condition.
    do
    {
        Result = sem_wait(sem);
        if (Result == 0 || TempInfo.MxSignaled || (Result < 0 && errno != EINTR))  break;
    } while (1);

    // Terminate the thread (if it is still running).
    TempInfo.MxSignaled = true;
    int LastError = errno;

    pthread_mutex_lock(&TempInfo.MxMutex);
    pthread_cond_signal(&TempInfo.MxCondition);
    pthread_mutex_unlock(&TempInfo.MxMutex);
    pthread_join(ChildThread, NULL);
    pthread_cond_destroy(&TempInfo.MxCondition);
    pthread_mutex_destroy(&TempInfo.MxMutex);

    // Restore previous signal handler.
    signal(SIGALRM, OldSigHandler);

    errno = LastError;

    return Result;
}
#endif 
```

SIGALRM 比 SIGUSR2 更有意义，因为这里显然使用了另一个示例（我没有费心看它）。SIGALRM 主要用于 alarm() 调用，当您需要亚秒级分辨率时，这实际上是无用的。

此代码首先尝试使用 sem_trywait() 获取信号量。如果这立即成功，那么它就会退出。否则，它会启动一个线程，该线程是通过 pthread_cond_timedwait() 实现定时器的地方。MxSignaled 布尔值用于确定超时状态。

您可能还会发现此相关函数对于调用上述 sem_timedwait() 实现很有用（同样，MIT 或 LGPL，您的选择）：

```
int CSGX__ClockGetTimeRealtime(struct timespec *ts)
{
#ifdef __APPLE__
    clock_serv_t cclock;
    mach_timespec_t mts;

    if (host_get_clock_service(mach_host_self(), CALENDAR_CLOCK, &cclock) != KERN_SUCCESS)  return -1;
    if (clock_get_time(cclock, &mts) != KERN_SUCCESS)  return -1;
    if (mach_port_deallocate(mach_task_self(), cclock) != KERN_SUCCESS)  return -1;

    ts->tv_sec = mts.tv_sec;
    ts->tv_nsec = mts.tv_nsec;

    return 0;
#else
    return clock_gettime(CLOCK_REALTIME, ts);
#endif
} 
```

帮助使用与 clock_gettime() 可以提供的最接近的东西填充 timespec 结构。有各种各样的评论说重复调用 host_get_clock_service() 是昂贵的。但是启动线程也很昂贵。

真正的解决方案是让 Apple 实现整个 POSIX 规范，而不仅仅是强制性部分。只实施 POSIX 的强制性部分，然后声称 POSIX 合规性只会让每个人都有一个半损坏的操作系统和大量类似上述的变通方法，这些变通方法的性能可能不太理想。

综上所述，我放弃了 Mac OSX 和 Linux 上的本地信号量（Sys V 和 POSIX）。它们以很多相当不幸的方式被破坏。其他人也应该放弃他们。（我不会放弃那些操作系统上的信号量，只是放弃本机实现。）无论如何，现在每个人都有一个没有商业限制的 sem_timedwait() 实现，其他人可以复制意大利面到他们心中的内容。

# c++ - 将 Delphi 代码转换为 C++ 的最佳方法？

> ID：641140
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-03-13T01:18:47.917
> 
>         
> 
> 标签：c++, delphi, macos

我有一个用 Delphi 编写的应用程序，它在 Delphi 2007 中编译。我认为它最初是用 Delphi 7 编写的。

无论如何，我需要将所有核心非 GUI 代码转换为 C++，因为我想发布该软件的 Mac 版本。

做这个的最好方式是什么？我可以采取什么捷径来加快这个过程？

编辑：代码编译为本机代码，而不是.NET。

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2009-03-13T02:05:53.983

简单的答案：如果没有完全重写，您根本无法将重要的 Delphi 代码移植到 C++。C++ 的对象模型与 Delphi 的非常不同。它没有像 TObject 那样派生所有其他对象的基类，并且它缺乏对 Delphi 代码通常认为理所当然的许多 RTTI 内容的支持。并且没有简单的方法可以在 C++ 中重新实现 Delphi RTTI，因为很多都是在编译器级别完成的，而且很多都是基于所有 Delphi 类都来自 TObject 的事实。

C++ 也缺乏对在 Delphi 中很常见的单元**初始化**和**终结**部分的概念的支持，而它所拥有的却被严重破坏了。（查看“静态订单初始化惨败”以了解所有血腥细节。）

Delphi 的异常处理也比 C++ 先进得多。其中一部分是对象模型，一部分是它的编译器魔法。另外，C++ 不支持**try-finally**构造。

如果您想将 Delphi 项目移植到 Mac，Free Pascal 是您的最佳解决方案。它与 Delphi 不是 100% 兼容，但对于很多事情来说已经足够了，而且你特别提到你不需要移植 Delphi GUI 的东西。AFAIK GUI 区域是大多数 FPC 兼容性弱点的根源，因此，如果这不是必需的，FPC 可能非常接近您的需求，至少在 CodeGear 推出 OSX 编译器之前是这样。（这还没有正式宣布，但基于已经说过的各种事情，假设明年某个时候可以使用它并不是没有道理的。）

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-04-06T23:20:02.337

要将您的代码从 Delphi 转换为 Cpp，请查看

[http://ivan.vecerina.com/code/delphi2cpp/](http://ivan.vecerina.com/code/delphi2cpp/)。

我使用它来使用 wxWidgets 函数转换 SysUtils、DateUtils 和 StrUtils 中的一些类和函数。如果您打算将 wxWidgets 用于 C++，请查看[http://twinforms.com/products/wxwidgets/wxvcl.php](http://twinforms.com/products/wxwidgets/wxvcl.php)，其中包含所有转换后的源代码。

如果您想直接开发 Mac OSX 应用程序，请查看 wxForms for Delphi - [http://twinforms.com/products/wxformsdelphi/index.php](http://twinforms.com/products/wxformsdelphi/index.php)

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T01:27:01.953

我认为这很难机械地完成，因此您可能正在考虑完全重写。需要记住的一点是，Delphi 通常使用 try...finally 结构进行资源管理，而 C++ 使用称为 RAII 的技术（资源获取即初始化）。在尝试转换之前，您应该阅读这个和其他 C++ 习惯用法。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T01:25:14.330

如果您的代码在 Delphi 2007 中编译为 .NET 程序集，那么您可能有一个比尝试从 Delphi 的 object pascal 移植到 C++ 更容易的选择。

您可能会将您的逻辑编译成 .NET 程序集（甚至可能是 UI 的一部分），并使用 Mono 在 Mac 上运行它。您可以围绕 Mono 编写自定义 GUI，甚至可能制作一个独立于平台的单一应用程序。

* * *

## 回答 #5

> 赞同：-1
> 
>             
> 
> 时间：2009-03-13T06:58:10.020

您也可以使用[Delphi Prism](http://prismwiki.codegear.com/en/Main_Page)。它适用于 .NET，但它是 Delphi 语言规范中的最后一个表达式。它还支持 Mac OSX（请参阅链接）。此外，来自 CodeGear/EMBT 的人员正在开发新的编译器以及新版本的 Delphi，预计将于 4 月进入测试版，并缩小 Prism 和 RAD studio 之间的差距。请参阅他们的“Beta 计划”页面。

* * *

## 回答 #6

> 赞同：-2
> 
>             
> 
> 时间：2009-03-13T01:43:29.183

做到这一点的“正确”方法是用Objective C重写它。我发现Objective C有点奇怪，但是在对象连接和委托的方式上与Delphi有很多相似之处。

您也许可以使用 Free Pascal 更快地完成它，但您应该认真考虑重写。

如果 Embarcadero 能够发布一个不像 Kylix 那样糟糕的 Mac OS X 版本的 Delphi，我会爱上他们的。一个人可以做梦。

编辑：留在 Delphi 有很大的好处，并在 Objective C 中为 Mac 提供一个单独的版本。首先，这意味着你不需要在 Windows 上重写版本，失去了（大概）多年对 Delphi 的投资代码。其次，从 UI 的角度来看，Mac 软件的运行方式与 Windows 不同。产品的简单移植是不合适的，并且会阻碍开发人员使用 Windows 和 Mac 的强大原生功能。请参阅：旧版本的 MS Word for Mac 或 iTunes for Windows。他们看起来和感觉都错了。

# python - Django，Python循环逻辑问题

> ID：641145
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T01:21:36.443
> 
>         
> 
> 标签：python, django-models

这部分有效。可能需要更多信息，但是，我想我会在这里发布任何明显可能有问题的建议。

问题是如果 activity.get_cost() 返回一个`False`值，该函数似乎完全退出，返回`None`.

当然，我想要它做的是`cost`在 中累积 Decimal 值`costs = []`并返回它们的总和。很简单，我原以为……但我的新手 Python 技能显然缺少一些东西。

应要求提供更多信息。谢谢你。

```
def get_jobrecord_cost(self):
    costs = []
    for activity in self.activity_set.all():
        cost = activity.get_cost()
        if cost:
            costs.append(cost)
    if len(costs):
        return sum(costs)
    else:
        return False 
```

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T01:39:07.260

我注意到如果所有成本都没有，您将返回 False；我不知道是否有特定的原因，但这确实使编写起来有点困难。如果这不是必需的，你可以这样写：

```
def get_jobrecord_cost(self):
    costs = [activity.get_cost() or 0 for activity in self.activity_set.all()]
    return sum(costs) 
```

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T01:26:41.033

我认为您可以通过以下方式简化此操作：

```
def get_jobrecord_cost(self):
    costs = 0
    for activity in self.activity_set.all():
        cost = activity.get_cost()
        if cost:
            costs += cost

    return costs 
```

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T01:43:49.497

```
def get_jobrecord_cost(self):
    return sum((activity.get_cost() or 0 for activity in activity_set.all()) or 0) 
```

根据您要处理的数据量，此版本比 DNS 更有效，因为它使用生成器理解并且不需要将整个列表加载到内存中。除了循环发生在 C 中之外，它在功能上等同于 grieve。请注意，这并不一定意味着这*更好*。这种方法显然更密集，并且可读性更低。

# c# - Application_Start 没有触发？

> ID：641148
> 
>         
> 
> 赞同：148
> 
>         
> 
> 时间：2009-03-13T01:22:06.710
> 
>         
> 
> 标签：c#, asp.net-mvc

我有一个正在开发的 ASP.NET MVC（测试版）应用程序，并且无法确定我是否做错了什么，或者`Application_Start`当我尝试时我在 Global.asax.cs 中的方法实际上没有触发调试应用程序。

我在我的方法中的一行上放了一个断点`Application_Start`，并期望当我尝试调试应用程序时断点应该被击中......但它永远不会。不是在我重置 IIS 之后，不是在我重新启动之后，从来没有。我错过了什么吗？为什么这个方法永远不会被调用？

* * *

## 回答 #1

> 赞同：183
> 
>             
> 
> 时间：2011-10-05T00:40:10.533

注意：使用内置的“Visual Studio Development Server”或**IIS Express**（例如，因为您正在**针对 IIS 进行开发并且具有应用程序正常运行所需的特定设置）的一个很好的****简单替代方法**是简单地在 IIS 中运行（我使用自定义 Web 服务器 + 主机文件条目 + IIS 绑定到同一域）

 ****1.  等待调试会话启动

2.  然后只需对根 web.config 进行空白编辑并保存文件

3.  刷新页面（Ctrl + F5）

您的断点应该很好地命中，并且您可以继续在您的**自然 IIS 栖息地**中进行调试。伟大的 ！

* * *

## 回答 #2

> 赞同：86
> 
>             
> 
> 时间：2009-03-13T02:35:00.247

如果这是在 IIS 中，则应用程序可以在调试器附加之前启动。如果是这样，我不确定你是否可以让睡眠足够长的时间来连接。

在 Visual Studio 中，您可以将调试器附加到进程。您可以通过单击调试 >> 附加到进程来执行此操作。附加到浏览器，然后点击您的应用程序。为了安全起见，请重新启动 IIS 并点击该站点。我不是 100% 相信这会解决问题，但它会比在 App_Start 中触发线程睡眠要好得多。

另一种选择是临时托管在内置的 Web 服务器中，直到您完成调试应用程序启动。

* * *

## 回答 #3

> 赞同：58
> 
>             
> 
> 时间：2013-07-04T12:18:53.157

在任何情况下，以下内容都会有所帮助（无论您使用的是 IIS、Cassini 还是其他）：

1.  在 Application_Start 中设置断点

2.  开始调试（很可能没有命中断点）-> 浏览器中显示一个页面

3.  更改 web.config（例如输入一个空行）并保存

4.  在浏览器中重新加载页面 -> 断点被击中！

为什么这行得通？当 web.config 更改时，Web 服务器（IIS、Cassini 等）会进行回收，但在这种情况下（无论出于何种原因），该过程保持不变，因此您可以使用调试器（Visual Studio ）。

* * *

## 回答 #4

> 赞同：22
> 
>             
> 
> 时间：2009-12-22T08:29:54.663

我在使用 IIS 托管应用程序的 application_start 中也遇到断点问题。一个好的解决方法是使用 Debugger.Break(); 在代码中而不是 VS 断点中

* * *

## 回答 #5

> 赞同：10
> 
>             
> 
> 时间：2011-02-11T03:01:50.547

我也有同样的问题。我在我的解决方案中做了很多重命名。之后，我得到了两个不工作的 Web 应用程序，而另外几个 Web 应用程序一切正常。我收到错误路线错误。当我尝试在方法中设置断点`Application_Start`，然后重新启动 IIS 时，VS 并没有中断执行。随着可行的网络应用程序中断工作。然后我记得“干净的解决方案”和“重建”不会删除重命名后留下的程序集。这就是解决方案！我已经手动清理`bin`了我的 buggy-web-applications 目录，然后看到`Global.asax` `Inherits=""`属性中的新错误被引用了旧 dll。我已将其更改为新的，并且休息开始工作。假设在重命名 Global.asax 期间没有更新，

* * *

## 回答 #6

> 赞同：7
> 
>             
> 
> 时间：2014-04-20T01:29:49.287

在另一个供应商构建后我们接管的项目中遇到了同样的问题。问题在于，虽然以前的供应商在 Global.asax.cs 中编写了许多命令，这可能会让您相信它正在使用，但实际上它被完全忽略了。Global.asax 没有从它继承，如果 .cs 文件存在，很容易永远看不到这个文件 - 您必须右键单击 Global.asax 并单击查看标记才能真正看到它。

全球.asax：

```
<%@ Application Language="C#" %> 
```

需要改为：

```
<%@ Application Codebehind="Global.asax.cs" Inherits="ProjectNamespace.MvcApplication" Language="C#" %> 
```

其中 ProjectNamespace 是您的 Global.asax.cs 类的任何名称空间（通常是您的项目的名称）。

在我们的例子中，该文件包含一堆内联代码，其中一些是从 .cs 文件中复制粘贴的，而另一些则不是。我们只是将内联代码转储到 .cs 文件中，然后逐渐合并我们的更改。

* * *

## 回答 #7

> 赞同：5
> 
>             
> 
> 时间：2011-04-04T09:43:35.410

尝试将应用程序池的托管管道模式切换为“经典”而不是“集成”。这为我解决了问题。现在查原因...

（此答案的道具属于弗洛雷斯（请参阅他对自己答案的评论），我只是想将其作为单独的答案提供以引起更多关注）

* * *

## 回答 #8

> 赞同：5
> 
>             
> 
> 时间：2012-06-12T09:44:27.640

确保您的 global.asax 不在子目录下。它必须放在项目的根级别。

* * *

## 回答 #9

> 赞同：4
> 
>             
> 
> 时间：2012-07-31T18:00:52.473

我们遇到了类似的问题，global.asax.cs 被忽略了。

事实证明，该站点已从预编译的 .NET 2 网站升级到 .NET 4.0 站点。在服务器上，该`PrecompiledApp.config`文件尚未从根文件夹中删除。删除它并回收 IIS 应用程序池并触摸 web.config 以重新启动应用程序后，Global.asax.cs 中的代码开始正常工作。

* * *

## 回答 #10

> 赞同：3
> 
>             
> 
> 时间：2015-03-03T08:25:01.847

曾经我遇到过一个问题，部署脚本实际上没有将 Global.asax 和 Global.asax.cs 复制到 IIS 文件夹中......所以它在开发服务器上调试时工作，但在 IIS 下没有。

* * *

## 回答 #11

> 赞同：3
> 
>             
> 
> 时间：2015-07-13T13:02:35.550

迟到的入场...

要在调试器有足够的时间附加之前测试 IIS 应用程序是否启动，只需将其添加到 GLOBAL.ASAX 的顶部或底部`Application_Start`。

```
throw new ApplicationException("Yup, it fired"); 
```

* * *

## 回答 #12

> 赞同：3
> 
>             
> 
> 时间：2016-04-17T11:31:07.233

我在使用静态页面（例如 index.html）作为启动页面时遇到了这个问题——Application-Start 没有被调用。我发现提供静态页面实际上并没有启动应用程序。请求 .aspx 页面确实如此。

* * *

## 回答 #13

> 赞同：3
> 
>             
> 
> 时间：2017-06-15T13:50:34.800

确保 Global.asax 和 Global.asax.cs 中的命名空间相同。如果它们不同，它不会抛出任何错误，但也不会命中断点，因为它根本没有执行 application_start。

* * *

## 回答 #14

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T01:25:34.827

当您说“调试”时，您是指实际从 Visual Studio 的内置 Web 服务器启动应用程序以进行调试，还是指附加到 IIS 中的进程？如果是前者，您应该点击 Application_Start，但如果是后者，则很难尽早进入进程以捕捉它。

* * *

## 回答 #15

> 赞同：2
> 
>             
> 
> 时间：2014-06-24T21:44:13.937

关闭 Visual Studio 并删除 Web 项目（或解决方案中的所有项目）中的`bin`和`obj`文件夹。

以下是从所有项目中删除这些文件夹的命令：

```
rm *\bin -r
rm *\obj -r 
```

* * *

## 回答 #16

> 赞同：2
> 
>             
> 
> 时间：2014-11-07T13:46:08.330

我根据 Visual Studio 的“构建代码分析”进行了一些更改。代码分析为 Global.asax 中的 Application_Start() 建议“CA1822 将成员标记为静态”。我这样做并最终解决了这个问题。

我建议禁止显示此代码分析消息，并且不要更改用于引导应用程序的平台自动创建的方法/类的签名。由于某种原因，方法 Application_Start 的签名可能是非静态的。

我恢复到这个方法签名并且 Application_Start() 再次触发：

```
 protected void Application_Start()
    { ... } 
```

* * *

## 回答 #17

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T01:24:55.360

我认为应用程序启动事件仅在发出第一个请求时才被触发，您是否在访问您的网站（即发出请求）？

* * *

## 回答 #18

> 赞同：1
> 
>             
> 
> 时间：2012-07-11T17:08:12.513

我在 .net 4 web forms vs2010 项目中遇到了这个问题，并尝试了此页面上提到的所有内容。最终删除和添加 global.asax 实际上为我解决了这个问题。

* * *

## 回答 #19

> 赞同：1
> 
>             
> 
> 时间：2013-10-22T11:10:26.560

我有同样的问题，无法捕捉Application_Start。原因是它没有触发标记文件中的不匹配。
**标记文件 Global.asax 继承了另一个类...**

* * *

## 回答 #20

> 赞同：1
> 
>             
> 
> 时间：2014-12-01T16:09:24.283

你检查项目设置了吗？我遇到了这个问题，我的起始 URL 转到了与我的服务器特定端口不同的端口。我花了太长时间才弄清楚...

* * *

## 回答 #21

> 赞同：1
> 
>             
> 
> 时间：2015-05-13T18:05:42.857

在尝试了尽可能多的适用于我的情况的其他答案并且没有任何运气之后，我进入了 Web 项目的属性（使用 RIA 服务的 Silverlight 应用程序的服务器端项目），单击“Web”选项卡并将所选服务器从“Local IIS”更改为“IIS Express”。（注意我使用的是VS2013。）这解决了这个问题。Application_Start 在“IIS Express”下执行，但不在“Local IIS”下执行。有趣的...

* * *

## 回答 #22

> 赞同：1
> 
>             
> 
> 时间：2016-03-30T19:15:26.943

我试图单步执行从应用程序启动调用的 RegisterRoutes() 中的代码，但没有达到我的断点。我确定 Application_Start 没有被调用。我必须进行更改以对 App_start/RouteConfig.cs 进行表面更改并在调用 Application_Start 之前将其保存。我猜这些文件被缓存在某个地方，除非进行更改，否则不会被调用。

* * *

## 回答 #23

> 赞同：1
> 
>             
> 
> 时间：2020-02-26T14:30:30.393

**`System.Web.Routing`通过在项目中添加程序集引用解决了我的相同问题**

[![在此处输入图像描述](https://i.stack.imgur.com/qyVso.png)](https://i.stack.imgur.com/qyVso.png)

* * *

## 回答 #24

> 赞同：0
> 
>             
> 
> 时间：2013-03-23T05:15:14.890

如果您使用的是 System.Diagnostics.Debugger.Break(); 解决方法（我认为它适合临时使用）并且它在您的 Windows 8 机器上“无法正常工作”。原因是 Visual Studio 的“及时调试”中的一个错误。

**修复如下是修复“Visual Studio Just-In-Time Debugger”的关键**

打开 regedit 并转到“AppIDFlags”注册表值的 HKEY_CLASSES_ROOT\AppID{E62A7A31-6025-408E-87F6-81AEB0DC9347}，将标志设置为 0x8

**更多信息：**
[http ://connect.microsoft.com/VisualStudio/feedback/details/770786/just-in-time-debugging-operation-attempted-is-not-supported](http://connect.microsoft.com/VisualStudio/feedback/details/770786/just-in-time-debugging-operation-attempted-is-not-supported)

* * *

## 回答 #25

> 赞同：0
> 
>             
> 
> 时间：2013-06-04T03:43:46.653

在我的例子中，通过系统托盘杀死内置的 ASP.NET 开发服务器实例解决了这个问题。

* * *

## 回答 #26

> 赞同：0
> 
>             
> 
> 时间：2014-12-11T18:53:18.480

奇怪而疯狂的东西......但是在服务器机器上进行调试，另一个用户让 IIS Express 在他们的会话中运行。我必须注销该用户才能终止他正在运行的 IIS Express 进程。这似乎解决了问题！

**更新**

在花了 1 个多小时追查导致问题的原因之后......这是交易：我有点设法**`s`**在`<appSettings>`. `Web.config`Visual Studio 试图在`Error List`窗口中用*警告*警告我。我承认我很少检查警告......应该从现在开始检查它。:D 一旦我删除了**`s`**有问题的断点就被击中了`Application_Start`。

![在此处输入图像描述](https://i.stack.imgur.com/2VQuI.png)

* * *

## 回答 #27

> 赞同：0
> 
>             
> 
> 时间：2015-02-25T16:09:30.617

我在尝试初始化 log4net 时遇到了这个问题。我决定只为 Global.asax 创建一个静态构造函数

```
static Global(){
//Do your initialization here statically
} 
```

* * *

## 回答 #28

> 赞同：0
> 
>             
> 
> 时间：2015-04-30T19:36:04.537

问题主要发生在您尝试将 Global.asax 文件重定位到另一个解决方案目录时。将 Global.asax 文件再次重定位到默认位置。它将按预期工作。

* * *

## 回答 #29

> 赞同：0
> 
>             
> 
> 时间：2019-07-25T18:02:00.643

上述解决方案都不适合我。但是重新安装软件包

```
Microsoft.CodeDom.Providers.DotNetCompilerPlatform 
```

使用 nuget gui 是一种（不太好）的解决方法

# c - 双指针的方圆图？

> ID：641156
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T01:26:39.397
> 
>         
> 
> 标签：c, pointers

有没有人有一个双指针的框和圆图的链接？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T01:33:08.413

查看

[http://www.mattababy.org/~belmonte/Teaching/CCC/CCC/transparent_figure5.gif](http://www.mattababy.org/~belmonte/Teaching/CCC/CCC/transparent_figure5.gif)

从这个[C 速成课程](http://www.mattababy.org/~belmonte/Teaching/CCC/CrashCourseC.html)。它以二维数组的形式显示了“指向指针的指针”图。

如果您正在寻找更基本的东西：

```
  ______ _____
 / \ / \ | |
| 整数** |--->| 整数* |--->| 整数 |
 \______/ \____/ |_____|

```

# java - 如何聚焦 JFrame？

> ID：641172
> 
>         
> 
> 赞同：11
> 
>         
> 
> 时间：2009-03-13T01:36:27.937
> 
>         
> 
> 标签：java, user-interface, swing, jframe

我正在编写一个小游戏，一个 JFrame 保存主游戏，另一个 JFrame 显示分数。问题是，当我完成构建它们时，JFrame 的分数总是会集中！我试过调用 scoreDisplay.toFront()、scoreDisplay.requestFocus()，甚至：

```
display.setState(JFrame.ICONIZED);
display.setState(JFrame.NORMAL); 
```

有什么办法可以使这项工作？在此先感谢，约翰·穆拉诺

* * *

## 回答 #1

> 赞同：13
> 
>             
> 
> 时间：2015-05-29T12:29:54.207

**调用`requestFocus()`方法。**

这不能保证有效，因为操作系统不允许框架具有焦点的原因有很多。在不同的应用程序中可能有另一个具有更高优先级的帧。还有一些 linux 桌面（如果我没记错的话）不允许框架请求焦点。

为了给你更好的成功机会，我还建议`toFront()`在请求焦点之前调用该方法。

```
frame.setVisible(true);
frame.toFront();
frame.requestFocus(); 
```

请记住，这些都不能保证，因为帧处理，尤其是焦点和分层，非常依赖于操作系统。所以将框架设置为可见，将其移动到前面，并请求焦点。一旦你放弃了 EDT，操作系统很可能会把焦点放在框架上。至少，窗口应该在顶部。

* * *

## 回答 #2

> 赞同：10
> 
>             
> 
> 时间：2009-03-13T14:37:49.633

切换`alwaysOnTop`

看这里：

[http://forums.sun.com/thread.jspa?threadID=5124278](http://forums.sun.com/thread.jspa?threadID=5124278)

> 阅读 API
>    [http://java.sun.com/j2se/1.5.0/docs/api/java/awt/Window.html#toFront中的 toFront](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/Window.html#toFront)
> 
>   
>   
> 
> 某些平台可能不允许此 VM 将其 Windows 放置在本机应用程序的窗口或其他 VM 的 Windows 之上。
> 
>   
>   
> 
> 在 Windows 操作系统上，例如 toFront 会导致任务栏上的图标闪烁，但窗口停留在后面。
> 
>   
>   
> 
> 唯一会迫使窗口靠前的是setAlwaysOnTop。

```
frame.setAlwaysOnTop(true); 
frame.setAlwaysOnTop(false); 
```

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T01:45:48.413

我会做的方式是：  

```
 frame.toFront();
 frame.setState(Frame.NORMAL); 
```

如果您还想对其进行更多控制，则应使用 requestFocuse。

顺便说一句，这是一个例子：
 [http ://coding.derkeiler.com/Archive/Java/comp.lang.java.gui/2006-06/msg00152.html](http://coding.derkeiler.com/Archive/Java/comp.lang.java.gui/2006-06/msg00152.html)

* * *

## 回答 #4

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T01:47:01.470

有没有考虑把分数设置在和游戏帧相同的帧里？

其他可能的（快速和肮脏的）选项是以相反的顺序创建它们，或者至少（如果分数取决于游戏）以相反的顺序显示它们。

```
score.setVisible( true );
game.setVisible( true ); 
```

我的猜测是，目前它们是：

```
game.setVisible( true );
score.setVisible( true ); 
```

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2016-11-08T20:12:37.150

只需在 JOptionPaneMessageDialog 代码上方添加以下代码行... this.setAlwaysOnTop(false);

* * *

## 回答 #6

> 赞同：-1
> 
>             
> 
> 时间：2012-07-11T02:37:32.357

```
frame.setExtendedState( JFrame.MAXIMIZED_BOTH);
frame.setVisible(true); 
```

试试上面的..

# c# - Gmail 中的未读电子邮件计数

> ID：641176
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T01:38:01.973
> 
>         
> 
> 标签：c#, gmail

我正在使用 Google 配置 API（教育版），我正在考虑允许用户直接从我的应用程序访问他们的电子邮件，而无需他们登录。

到目前为止，我已经完成了这项工作，但我还想在我的应用程序中显示未读电子邮件的数量。我在 API 中找不到。

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T02:05:27.620

你在用 Python 编写你的应用程序吗？

如果是这样，请查看[gmail notifier](http://gmail-notify.sourceforge.net/index.php)。

这是一个适用于 linux 桌面的 python 应用程序，但它保留了未读消息的计数。  

希望有帮助。

# sql - 在 ASP.Net MVC 应用程序中自动更新上次修改日期

> ID：641182
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T01:41:21.653
> 
>         
> 
> 标签：sql, asp.net-mvc, entity-relationship

基本信息：

1.  ASP.NET MVC 应用程序

2.  使用 ADO.NET 实体框架

3.  SQL 服务器 2005

我有一些表或多或少具有主要是一对多关系的层次结构。大多数（如果不是全部）都有 Last Modified 列，我的问题只是如何最好地确保该列在整个层次结构中正确更新。我宁愿在数据库级别自动完成它，我只是不确定如何。一位同事提到触发器，同时提到它们可能不是最好的方法。我不知道是在我用来管理模型的类中还是在数据库级别执行此操作。我宁愿不必单独更新每个引用，因为这会变得乏味，而且我必须为每个级别制作一堆单独的函数。

那么我的问题是：

1.  有没有办法在数据库级别使用我可以调用的存储过程来做到这一点？

2.  如果不是，你会建议我在应用程序方面做些什么来最好地以编程方式处理这个问题？

如果有更多信息有帮助，我很乐意提供，我很难弄清楚如何问这个问题。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T01:55:43.023

另一个人在这里有相同/相似的问题。他们的意见使用触发器。这是完整的回复：
 [Sql Server (Entity Framework): created_at , updated_at Columns](https://stackoverflow.com/questions/516517/sql-server-entity-framework-createdat-updatedat-columns)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T01:59:46.883

这取决于你希望你的惩罚在哪里。您可以通过以下两种方式之一获得它。

*   使用触发器将更改传播到您的层次结构。当您只写一次并大量阅读时，这可能是最好的。例如：更新地址并在父记录以及地址本身上设置最后修改。  

*   Just update one last modified and then query for everything when you need to see when something has been modified.  This might be best if you write a lot, but read very little.  eg: Only update the last modified on an address. When you query for changed records, query for records that have a last modified or records with addresses that have a last modified.

It's hard to say without knowing your situation.  If you need to update all related last modified dates, then I would go the trigger route just to keep things simple.

# c# - Microsoft 语音识别器 6.1 培训文件

> ID：641191
> 
>         
> 
> 赞同：-1
> 
>         
> 
> 时间：2009-03-13T01:47:27.850
> 
>         
> 
> 标签：c#, speech-recognition, sapi

我正在用 C# 开发语音应用程序。语音识别的东西在 Windows XP 上与 SAPI 5.1 一起工作得很好。但是我现在在 Office 2003 附带的机器上安装了 Microsoft Speech Recognizer v 6.1。无论我做了多少培训，我都发现语音文件（MSASR 下的 .dat 文件）没有得到更新（至少从上次修改的时间戳）。与 v 5.1 相比，Speech Recognizer v 6.1 中的语音训练工作方式是否有任何重大变化，有人可以告诉我吗？

提前致谢。

更新：有人在 Microsoft Speech Forums 中回答了这个问题。这是回复的链接。[http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.speech_tech.sdk&mid=53f6b970-3252-4ef5-91da-eaf20367c023&sloc=en-us](http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.speech_tech.sdk&mid=53f6b970-3252-4ef5-91da-eaf20367c023&sloc=en-us) 

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-16T16:18:18.503

你确定你找对地方了吗？检查 HKEY_CURRENT_USER\Software\Microsoft\Speech\RecoProfiles 下的注册表以获取有关用户配置文件和训练数据的信息。我在Vista上，控制面板显示它是8.0版。我看到培训文件正在更新。

此 MSDN 参考包含注册表设置的详细信息[http://msdn.microsoft.com/en-us/library/ms717036(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms717036(VS.85).aspx)

# c# - IInvokeProvider 命名空间？

> ID：641197
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T01:50:23.147
> 
>         
> 
> 标签：c#, wpf

只是为了好玩，我正在玩一些 C# 和 WPF。由于 Button.PerformClick() 不再存在，我将通过一些示例以编程方式向按钮发送按钮单击事件。我下面的示例是使用 System.Windows.Automation.Provider 命名空间中的 IInvokeProvider。我的 VisualStudio 2008 Pro 副本似乎无法在任何地方找到所述命名空间或 IInvokeProvider 接口！我查看了 MSDN 文档，这是正确的命名空间，它说它在 Windows XP 及更高版本上可用。我究竟做错了什么？  

我使用 .NET Framework 3.5 版将项目作为 C# WPF Windows 应用程序启动。  

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2009-03-13T01:56:25.690

添加对 UIAutomationProvider.dll 的引用...这应该允许您使用 System.Windows.Automation.Provider 命名空间。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-05-12T04:33:58.150

试试这个：

ButtonAutomationPeer bap = new ButtonAutomationPeer(myButton); IInvokeProvider iip = bap.GetPattern(PatternInterface.Invoke) 作为 IInvokeProvider；
**iip.Invoke();** // 点击按钮

# php - PHP MySQL插入删除数据

> ID：641198
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T01:51:22.037
> 
>         
> 
> 标签：php, mysql

好的，这对我来说是一个新的。基本上我有一个表文章：

```
id: int auto increment
title: varchar(200)
description: varchar(1000)
ctext: longtext
chtml: longtext 
```

现在我用 mysql_query 插入这个表：

```
INSERT INTO articles
(title, description, ctext, chtml)
VALUES
('$title', '$description', '$text', '$html') 
```

所有值都通过 mysql_escape_string() 传递。

这里的文本和 html 大约有 50k 大小（所以我不能在这里发布完整的查询）。

现在，问题来了：查询有效。插入新行。但是 ctext 和 chtml 列是**空**的。这是 MySQL 5.0.51a 和 PHP 5.2.8。据我所知，没有出现任何错误。

现在我将查询转储到 /tmp 中的一个文件并运行它：

```
mysql -u username -p dbname < /tmp/query 
```

**一样。**

我将查询复制到 Navicat 中，它...有效。

那么到底发生了什么？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T02:13:01.033

一些随意的想法：

*   您是否尝试过控制文本长度，看看它是否只在某一点失败？

*   你打开什么样的连接？哪个司机？

*   您是否检查过连接的编码？可能会发送一些无效字符。

*   您是否尝试过使用[参数](http://www.php.net/manual/en/pdo.prepare.php)而不是`mysql_escape_string`？

*   您是否尝试过直接从 Navicat 的同一个文件执行而不是使用复制粘贴？同样，可能与未通过复制粘贴但保存在文件中的无效字符有关。

*   只是为了涵盖我们经常忘记的基础知识，您如何验证数据没有插入？我的意思是，你如何想象它？您可以有一个换行符来隐藏 3 种可视化方式中的 2 种的第一行。只是一个长镜头，但我已经看到它发生了。

* * *

**补充**：MySQL连接默认为latin1，你需要使用类似`mysql_query("SET NAMES 'utf8'")`传输unicode字符的东西。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T01:54:15.803

我不确定这是否重要，但`mysql_escape_string`已弃用并替换为`mysql_real_escape_string`

您是否尝试过使用较小的文本？

# c# - 我可以信任 NHibernate Fluent Automappings 吗？

> ID：641209
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T01:59:15.433
> 
>         
> 
> 标签：c#, nhibernate, fluent-nhibernate, nhibernate-mapping

我目前正在测试使用 NHibernate Fluent Automappings 来映射我的域对象并创建我的数据库模式。  

这是个好主意还是坏主意？  

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T02:22:09.623

测试映射对我来说似乎是个好主意。

我现在正在将 Fluent NHibernate 用于一个项目，但不是自动映射（我有一个小设计问题，我需要在自动映射对我有用之前重构一个类）。

我喜欢 NHibernate，特别是 Fluent Nhibernate 的一点是，如果您要使用这些工具和自动映射，它们倾向于按照某些约定将您的设计“引导”到某个方向。

在我现在正在进行的项目中，我从 ADO.Net 开始，使用 XML 映射进入 NHibernate，然后使用 Fluent Nhibernate，现在尝试让 AutoMappings 工作。在每一步，我都必须重构我的实体设计或数据库的某些方面——为了更好。因此，这些工具不仅很棒，还可以帮助您引导您走向一些好的设计。而且我认为使用自动映射，如果您从一开始就使用它们，这将更容易实现。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T19:46:40.047

你应该暗中相信任何东西吗？不。

自动映射几乎没有什么危险，如果你测试它就更危险了。如果您也遇到任何问题，就会有一个[活跃的社区。](http://groups.google.com/group/fluent-nhibernate)

# html - CSS 控件继承 - 继承其他控件样式

> ID：641217
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T02:06:40.830
> 
>         
> 
> 标签：html, css, inheritance, label, stylesheet

我的问题有两个部分：

1）有没有办法在CSS中继承另一个控件的属性和样式？假设控件没有父/子层次结构并且可以是完全不同的控件类型：

IE：

```
#MyFirstControl
{
  width: 100px;
}

#MySecondControl
{
  width: MyFirstControl.styles.width; /* This doesn't work */
} 
```

2) 假设标签标签是任何其他标签的子标签。width 属性不能与“inherit”或“auto”一起使用。怎么了？

IE：

```
<style>
  div
  {
    width: 100px;
  }
</style>

<div>
  <!-- This label does what it wants for width. It's not the width of the containing div -->
  <label style="width: inherit">Some Text</label>
<div> 
```

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T02:19:27.833

第 1 部分：您想使用类名而不是 id 来控制样式：

```
.control_a {
  width: 100px;
}

<blah id='MyFirstControl' class='control_a'/>
<blah id='MySecondControl' class='control_a'/> 
```

这使您可以跨任意数量的标签共享样式。另外，请记住，您可以在单个元素上使用多个类名：

```
.control_a {
  width: 100px;
}

.red { background: #f00; }    
.blue { background: #00f; }

<blah id='MyFirstControl' class='control_a red'/>
<blah id='MySecondControl' class='control_a blue'/> 
```

这使您可以为单个元素选择许多不同的样式来源。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T02:22:14.100

没有办法继承 CSS“对象”。您可以从其他标签内的标签继承样式，但继承的是标签而不是样式本身。如果您将标签放在具有另一种样式的标签内，它将继承自该样式。

如果将 CSS 样式视为对象可能会很有趣，因为您可以避免大量编码，但是由于您可以创建一个可以应用于不同类型的对象的类，甚至可以将多个类应用于一个标签，它更比必要的有趣。

我不确定第二个问题，但我想这与您应用标签名称的事实有关，而不是使用类或 id。我将不得不再玩一些，看看我是否能解决问题。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-11-30T19:25:43.727

1) 由于 CSS 不允许自引用，因此您可以在同一样式中指定两个单独元素的共同方面：

```
#MyFirstControl, #MySecondControl
{
  width: 100px;
} 
```

2）如果要相信我的 IDE 和浏览器，在这种情况下`inherit`不是有效值`width`，但我不确定为什么。这可能就是您的示例不起作用的原因。

# javascript - 是否有一个简单的库可以将 JSON 对象呈现为树？

> ID：641218
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-03-13T02:07:07.193
> 
>         
> 
> 标签：javascript, json, treeview

那么，是否有一个非常简单的库可以将 JSON 对象呈现为树？我知道这可以通过多种方式完成（例如 YUI），但出于调试目的，我希望能够简单地将我从服务器接收的 JSON 对象视为一棵树，没什么特别的（但可折叠的树将是奖金）。

我正在寻找的解决方案类似于：

```
<script source="something.js"/>
<script>
   obj ={"hello":"world"}
   lib.renderJSON("someid",obj);
</script>
...    
<div id="someid"/> 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2015-04-14T14:58:07.103

由于该线程是为响应 Google 搜索而出现的，因此认为可能值得添加我发现的内容（另一个链接在此上下文中不再有效，但我可能错过了一些功能）。

周围有一些，但我没有找到一个以“图形树视图”提供它的，而是一个简单的“文本树视图”。有标题为“美化器”或“易读”的 JSON 查看器。

我最终使用了：
 [yesmeck 的 jsonview](https://github.com/yesmeck/jquery-jsonview/releases)

又好又简单，第一次就完成了。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2010-06-05T15:24:23.097

也检查一下：http: [//jquery.bassistance.de/treeview/demo/async.html](http://jquery.bassistance.de/treeview/demo/async.html)

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2015-05-12T07:15:32.370

使用 D3 很容易加载 json 数据就像这样

```
 d3.json("flare.json", function(error, flare) {
              flare.x0 = 0;
               flare.y0 = 0
               update(root = flare);
           }); 
```

* * *

## 回答 #4

> 赞同：-1
> 
>             
> 
> 时间：2016-02-15T11:04:04.367

我创建了一个简单的 JSON 查看器。它通过标准的 JSON.parse() 方法从字符串中解析 JSON，并绘制 json-tree。您只能在项目中使用 jsonTree 库，并在一个 html 页面上创建许多 json-trees：

```
var wrapper = document.getElementById("wrapper");
var data = {
    "firstName": "Jonh",
    "lastName": "Smith",
    "phones": [
        "123-45-67",
        "987-65-43"
    ]
};
var tree = jsonTree.create(data, wrapper);
```

```
<link href="libs/jsonTree/jsonTree.css" rel="stylesheet" />
<script src="libs/jsonTree/jsonTree.js"></script>
```

[jsonTree](https://github.com/summerstyle/jsonTreeViewer)库（jsonTreeViewer 的一部分）

# algorithm - 如何对旋转的矩形执行碰撞检测？

> ID：641219
> 
>         
> 
> 赞同：21
> 
>         
> 
> 时间：2009-03-13T02:07:33.400
> 
>         
> 
> 标签：algorithm, math, geometry, collision-detection

好的，我正在尝试编写一个程序，它可以告诉我旋转到 140 度的 30x100 矩形中的任何点是否在另一个旋转到 200 度的 30x100 矩形内。

老实说，我什至不知道从哪里开始。我考虑过在进行正常计算之前重新旋转它们，但它们仍然不匹配。

我怎样才能做到这一点？

# javascript - 如何使用 jQuery（或类似的）提取所有 CSS

> ID：641221
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T02:09:07.797
> 
>         
> 
> 标签：javascript, jquery, css

给定一个已加载（可能有多个）CSS 文件和内联样式的网页，通过使用：

```
<link rel="stylesheet" type="text/css" href="some_file.css" />
<style type="text/css"> /* some css rules */  </style>
<link rel="stylesheet" type="text/css" href="some_other_file.css" />
<style type="text/css"> /* some other css rules */  </style>      
<!-- etc --> 
```

如何编写一个函数（可能使用 jQuery）来提取所有有效的网络 CSS 规则？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T02:57:54.717

我不确定你想用这个做什么，但这应该让你开始：

```
function getStyles() {
    if(!document.styleSheets) return false; // return false if browser sucks
    var rules = new Array();
    for (var i=0; i < document.styleSheets.length; i++) {
        var x = 0;
        styleSheet = document.styleSheets[i];
        if(styleSheet.cssText) { // if this is IE, get the rules directly
            rules.push(styleSheet.cssText);
        } else {
            // otherwise get them individually
            do {
                cssRule = styleSheet.cssRules[x];
                if(cssRule) rules.push(cssRule.cssText);
                x++;
            } while (cssRule);
        }
    }
    return rules;
} 
```

当您调用它时，它将返回一个包含所有规则的数组。在 Firefox、IE 中测试。

# iphone - 强制 iPhone Web 应用程序进入横向模式

> ID：641223
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-03-13T02:12:27.977
> 
>         
> 
> 标签：iphone, safari, landscape, mode

你如何强制 iPhone 网络应用程序（不是本机应用程序）进入横向模式？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2010-05-26T13:28:46.903

我不知道如何在启动时强制它，但我找到了一种巧妙的方法来让你的内容在从纵向更改为横向时正确缩放，尤其是在你使用画布的情况下。

```
<head>
  <meta name="viewport" content="initial-scale=1.6; maximum-scale=1.0; width=device-width; "/>
  ...
</head> 
```

因此，一旦您的用户将手机翻转到横向模式，您的页面就会以正确的比例显示。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T07:31:35.277

我认为不可能强制设备进入横向模式。可以**检测**设备何时处于横向模式。见这里例如javascript：
 [http ://www.engageinteractive.co.uk/blog/2008/06/19/tutorial-building-a-website-for-the-iphone/](http://www.engageinteractive.co.uk/blog/2008/06/19/tutorial-building-a-website-for-the-iphone/)

# .net - Log4Net 中 LogFileAppender 的最大文件大小

> ID：641226
> 
>         
> 
> 赞同：38
> 
>         
> 
> 时间：2009-03-13T02:12:46.633
> 
>         
> 
> 标签：.net, log4net

我现在使用 Log4net 有一段时间了，它是一个了不起的日志框架，尤其是在连接到 Castle.Windsor 时。然而...

我通常使用滚动文件附加程序，但这导致日志文件比我实际想要的多，因此，对于我的最新项目，改为使用基本的 LogFileAppender，但问题是日志文件不断增长（似乎永远） .

如何告诉附加程序不要超过固定大小（并开始删除旧日志并将新日志附加到文件中？

我当前的配置如下：

```
<appender name="LogFileAppender" type="log4net.Appender.FileAppender">
  <file value="E:\Logs\iWater\Schedule-Dispatch-API.log"/>
  <param name="AppendToFile" value="true"/>
  <maximumFileSize value="2048KB"/>
  <layout type="log4net.Layout.PatternLayout">
    <conversionPattern value="%-16date{dd MMM HH:mm:ss} %-7level %-25.35logger{1} %message%newline"/>
  </layout>
</appender> 
```

它似乎没有尊重 maximumFileSize 属性。有什么解决办法吗？

或者，如何将滚动文件附加程序配置为仅创建 1 个文件（曾经）？

* * *

## 回答 #1

> 赞同：76
> 
>             
> 
> 时间：2009-03-13T02:30:41.177

FileAppender 类没有 MaxFileSize/MaximumFileSize 属性。只有使用 RollingFileAppender 才能获得这些。这是一个示例，它将您的文件限制为固定的最大大小，没有备份（将 maxSizeRollBackups 设置为 0）。请注意，当文件达到其最大大小时，它会被截断（基本上会删除所有现有的日志记录并重新开始）：

```
<appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender">
    <file value="log.txt" />
    <appendToFile value="true" />
    <rollingStyle value="Size" />
    <maxSizeRollBackups value="0" />
    <maximumFileSize value="10MB" />
    <staticLogFileName value="true" />
    <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline" />
    </layout>
</appender> 
```

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T02:18:26.807

LogFileAppender 不支持限制输出文件的大小（至少在我能找到的参考资料中）。要限制文件大小，请使用 RollingFileAppender 并滚动 Size 并设置文件大小限制。

要限制翻转文件的数量，请使用[MaxSizeRollBackups](http://logging.apache.org/log4net/release/sdk/log4net.Appender.RollingFileAppenderMembers.html)属性

# php - 通过 jquery javascript 函数使用 SESSION 变量更新 MySQL

> ID：641228
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T02:14:16.740
> 
>         
> 
> 标签：php, jquery, mysql

我目前有一个使用 jQuery.js 的 javascript 文件“score.js”，该文件通过链接正确调用。score.js 中的代码是：

```
function originalUpdateScore(answer,correct){
if (answer == correct) 
{    
$.post('updateScore.php');  
}
window.location.reload(true);
} 
```

此函数调用“updateScore.php”：

```
<?php
include("dbstuff.inc");
$con = mysqli_connect($host, $user, $passwd, $dbname)
or die ("Query died: connection");  

$updateScore = "UPDATE `user` SET `tempScore`=`tempScore`+1
    WHERE (user.Username='$_SESSION[logname]')";

mysqli_query($con, $updateScore);

?> 
```

但是，数据库未正确更新。如果我替换该行：

```
$updateScore = "UPDATE `user` SET `tempScore`=`tempScore`+1 
               WHERE (user.Username='$_SESSION[logname]')"; 
```

和：

```
$updateScore = "UPDATE `user` SET `tempScore`=`tempScore`+1 
               WHERE (user.Username='123pf')"; 
```

其中 123pf 是 SESSION 变量包含在调用它正确更新的 javascript 的 php 文件中的值。为什么使用会话变量不起作用？我在查询中错误地调用它吗？

提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T02:19:29.923

你[`session_start`](http://www.php.net/session_start)在 updateScore.php 中的任何地方调用吗？

如果您还没有开始会话，我不相信会话变量将可用。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T02:47:16.783

另外，您是否可以*完全*控制 $_SESSION['logname']？如果没有，有人可以轻松更改他们的登录名以注入 SQL 并损坏/损害您的数据库。例如，如果他们能够将他们的登录名设置为这样，您可能会丢失您的用户表：

```
$_SESSION['logname']="'; DROP TABLE user;-- "; 
```

通过这样玩，你正在向作弊者敞开心扉。在这种情况下，任何用户都可以随时访问 updateScore.php 来增加他们的统计数据，因为该脚本既不检查他们的答案，也不检查 JS 构建的表示分数正常的标记。将这种逻辑保留在前端（javascript）而不在后端（PHP）上进行验证是一个坏主意；javascript 和 AJAX 是非常有用的快捷方式，可以改善用户体验，但不能将它们视为唯一的有效性检查器。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T13:17:35.227

这可能只是一个转录错误，但您在问题中显示的代码使用 $_SESSION[logname]，它应该是 $_SESSION['logname']。

# c# - 未使用的“使用”声明的开销？

> ID：641234
> 
>         
> 
> 赞同：48
> 
>         
> 
> 时间：2009-03-13T02:16:52.100
> 
>         
> 
> 标签：c#, performance, using

我刚刚安装了 resharper，它让我知道我在每个类中实际上没有使用的命名空间。

这让我想到了一个问题 - 将这些未使用的 using 声明保留在其中实际上是否有任何开销？

这只是紧凑代码的问题，还是在我不需要时调用这些命名空间会影响性能？

* * *

## 回答 #1

> 赞同：99
> 
>             
> 
> 时间：2009-03-13T02:20:54.570

来自[C# 团队对常见问题的回答](http://blogs.msdn.com/csharpfaq/archive/2004/10/20/245411.aspx)：

> 当您添加程序集引用或使用 'using' 关键字时，
>    **csc.exe 将忽略您在代码中实际上没有使用的任何程序集**......不要[浪费]您的时间剥离未使用的' `using`'语句或应用程序中的程序集引用。**C# 编译器会自动为您执行此操作。**

`Assembly.GetReferencedAssemblies()`您可以通过调用;来验证是否确实如此。您会看到未使用的任何内容实际上都不会包含在列表中。

去除未使用的主要用途是

*   更容易看到您的代码实际使用了什么

*   它将防止您的 Intellisense 被您实际上不会使用的东西污染。

* * *

## 回答 #2

> 赞同：40
> 
>             
> 
> 时间：2009-03-13T02:23:25.907

`using`剥离语句有一些性能原因：

*   当需要查看的数据较少时，VS 的 IntelliSense 运行得更快

但是，请注意所有这些原因都是特定于编译时的。编译器会`using`自动去除未使用的 s。

* * *

## 回答 #3

> 赞同：10
> 
>             
> 
> 时间：2009-03-13T02:25:04.483

unusesd using 语句中最大的“开销”是理解您的代码:)

删除未使用的代码会使您的代码更整洁，更易于其他人阅读和维护。

* * *

## 回答 #4

> 赞同：10
> 
>             
> 
> 时间：2009-03-13T03:08:02.383

Visual Studio 2008 中的 C# 代码编辑器具有删除未使用的**using**语句的功能。

右键单击并选择**组织使用 | 删除未使用的 Using**。

# c# - 将 App 构建为 Release 时更改 Log4Net 根级别

> ID：641240
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T02:19:48.253
> 
>         
> 
> 标签：c#, asp.net, log4net

我有一个正在使用 log4net 的项目，它运行良好，但我想知道在调试和发布时是否可以覆盖日志记录的根“级别”属性的 XML 配置。

目前我的根配置如下：

```
<root>
  <level value="WARN"/>
  <appender-ref ref="LogFileAppender"/>
  <appender-ref ref="DebugAppender"/>
</root> 
```

在我的网络应用程序 Global.asax 类中，我想我可以将一些东西包装在一个

```
protected override void Application_Start(object sender, EventArgs e) {
  base.Application_Start(sender, e);
  XmlConfigurator.Configure();

  #if DEBUG
  //Change logging level to DEBUG
  #endif
} 
```

在调试内置解决方案时将根日志记录级别更改为调试。

这是否可能，我的想法是我想要的最佳实践类型的解决方案，我将如何做到（或者你会如何做得更好）？

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T03:08:21.010

我做相反的事情，在调试模式下，我使用开发人员配置，这更适合为我过滤相关消息；在发布模式下，我将级别锁定为 WARN 以防止用户想要破解我的代码（他可以使用很多其他方式，但这是一个 5 秒的技巧）：      

```
public static void Initialize()
{

#if DEBUG
    ConfigureAndWatch();
#else
    ConfigureAndLockChanges();
#endif

}

#if DEBUG

private static void ConfigureAndWatch()
{
    XmlConfigurator.ConfigureAndWatch(new FileInfo("log4net.config"));
}

#else

private static void ConfigureAndLockChanges()
{
    // Disable using DEBUG mode in Release mode (to make harder to hack)
    XmlConfigurator.Configure(new FileInfo("log4net.config"));
    foreach (ILoggerRepository repository in LogManager.GetAllRepositories())
    {
        repository.Threshold = Level.Warn;
    }
}

#endif 
```

# sql - SQL Server UDT 大小 2005 到 2008

> ID：641244
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T02:21:41.760
> 
>         
> 
> 标签：sql, sql-server, sql-server-2008, user-defined-types

在 SQL Server 2005 中，我们定义了一些 UDT（用户定义的数据类型），特别是 SK（代理键）。这些被定义为 32 位“int”。因此大小为 4 个字节。

在 SQL Server 2008 中，整数数据类型的 UDT 使用不同的存储机制，具体取决于精度：

存储 显示 UDT 的最大存储大小。最大存储大小因精度而异。

精度（位数）.....存储（字节）

1 – 9..................................5

10 – 19..................................9

20 – 28..................................13

29 – 38..................................17

这样做的一个后果是基于 BOTH int 和 bigint 的 UDT 将占用 9 个字节！注意：本机 int 和 bigint 数据类型仍分别占用 4 和 8 个字节！

9 个字节对于代理键 UDT 来说似乎相当重量级！

谁能解释为什么会这样（特别是设计原理是什么）？UDT 和本机数据类型之间的这种差异是如何产生的？

除了不使用 UDT 之外，还有其他方法吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-14T15:24:44.203

对不起，但在我看来你搞错了。请记住，“SELECT 没有损坏”，并且由于转换问题，Microsoft 不会在不强烈宣传的情况下修改其引擎的如此关键部分。

您引用的表格来自[MSDN中的](http://msdn.microsoft.com/en-us/library/ms187746.aspx)**十进制**和**数字**存储，它们基本上超过**int**

 **如果您使用的是严格别名，[Using special datatypes](http://technet.microsoft.com/en-us/library/ms191240.aspx)强烈暗示基于**int**的类型只占用四个字节。如果您使用的是 CLR 类型，则会出现龙或更多开销。

无论如何，您可以通过查看[sys.types来验证您的数据类型的足迹](http://msdn.microsoft.com/en-us/library/ms188021.aspx)

# iphone - 从编程的角度来看，iPhone OS 3.0 需要什么？

> ID：641249
> 
>         
> 
> 赞同：16
> 
>         
> 
> 时间：2009-03-13T02:22:18.967
> 
>         
> 
> 标签：iphone, mobile

iPhone OS 3.0 将于下周（3 月 17 日）发布和预览。

我们都知道用户想要的功能集。iPhone 上的复制/粘贴、彩信、Flash 等。

我们会看到这些。

我感兴趣的是开发社区认为*SDK*缺少什么，需要什么，以使平台的编程更容易和更高效。

* * *

## 回答 #1

> 赞同：16
> 
>             
> 
> 时间：2009-03-13T02:36:11.930

*   一个更完整的界面生成器，支持自定义调色板和各种类似的好东西。

*   更好地控制键盘。

*   更好的单元测试支持。（可以进行单元测试，但只能在模拟器上进行，而且设置起来很别扭。）

*   推送通知。*请。*

*   更准确的模拟器，即具有更准确的框架集的模拟器。

*   能够轻松构建像邮件撰写窗口这样的视图。

*   就此而言，应用程序内的撰写窗口。

*   与调用 URL 相比，应用程序在本地共享数据的更好方法。

*   访问日历、笔记、邮件（可能是只读的）和书签（同样是只读的）数据库。甚至可能限制对 iPod 数据库的访问——即使只是读取歌曲元数据以及访问和更改正在播放的歌曲的能力也会有所帮助。

*   UILabel 和 UIWebView 之间的某种中间立场，允许格式化文本而没有很大的麻烦。

*   更多内置工具栏图标。

*   Beta SDK 中的“玻璃”按钮样式的回归。

*   暴露了一些有用的内部视图，例如 UIProgressHUD。

最后但并非最不重要...

*   一匹小马。

* * *

## 回答 #2

> 赞同：9
> 
>             
> 
> 时间：2009-03-13T04:41:54.450

*   Mobile Safari 的简单 Javascript 小书签安装方法。（开放[雷达](http://openradar.appspot.com/radar?id=4422)：[1、2](http://openradar.appspot.com/5935641)）

*   UIWebView 需要更多 UIScrollView 的属性和方法，比如 contentOffset。

*   一些内置行为和视图的更多可配置性，例如 UITableViewCell 的“删除”按钮上的按钮文本，或 UIAlertSheet/UIAlertView 按钮的样式和文本。（其中一些今天可以通过无证电话完成，但我宁愿不依赖这些。）

*   来自 UINavigationController 的更多灵活性，例如推送/弹出视图的能力，这些视图选择性地不显示导航栏但使用相同的动画和堆栈，或者导航栏按钮标签和行为的更多可定制性。

*   能够限制每个 UIViewController 的界面方向，而不仅仅是通过 shouldAutorotate 接受/拒绝更改。例如，我希望我的主要内容视图是可自动旋转的，但我希望我的导航层次结构和设置屏幕始终以纵向显示，即使内容视图旋转为横向也是如此。

*   libxml 及其方便的 DOM XML 解析器，而不是基于 SAX 的 NSXMLParser。

*   libcurl w/SSL，或 NSURLConnection 的更多选项和功能。

*   能够检查 URL 方案是否已注册。这可用于应用程序检测是否安装了其他特定应用程序，并有选择地启用功能，例如当 Instapaper 检测到 Tweetie 已安装时，它可以提供“使用 Tweetie 发布”按钮。*（免责声明：那是一个插件。我制作[Instapaper](http://www.instapaper.com/)。）*

我相信我会想更多，但总的来说，我**很**高兴为 iPhone 开发。我对 iPhone OS、SDK 和开发工具的质量和复杂程度感到惊讶，因为它们都非常年轻。

* * *

## 回答 #3

> 赞同：7
> 
>             
> 
> 时间：2009-03-13T03:37:55.167

我很惊讶还没有人提到垃圾收集。Mac 上的 Objective-C 2.0 支持可选的垃圾回收。我真的看不出任何理由它在 iPhone 上也不能正常工作，并且它会消除必须在整个地方显式释放对象的大部分乏味。

* * *

## 回答 #4

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T04:36:06.320

我最希望的是允许 iPhone 通过蓝牙或其他方式相互交谈。当然，如果他们在同一个 Wi-Fi 网络上，他们可以通过 Bonjour 通话，但这在 2009 年还不够方便。如果我和朋友出去玩多人游戏，我们首先必须找到一个星巴克或其他任何东西都可以使用同一个 Wi-Fi 网络。另外，想想如果 iPhone 可以在不需要 Wi-Fi 的情况下相互交谈，你可能拥有的社交应用程序数量多得离谱。交换名片，和那边的可爱女孩调情等等。

从纯程序员的角度来看，让 XCode 像 Eclipse 或 IntelliJ 在 Java 世界中一样有用的 IDE。我有太多时间浪费在 IDE 可以在我输入时为我找到的愚蠢的东西上。

我也不明白为什么我不能在不使用图像的情况下为按钮着色。

* * *

## 回答 #5

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T03:44:46.023

在这一点上，更好的多任务处理绝对是关键。Android 拥有它，Palm 的 WebOS 拥有它——两者似乎都在很大程度上不受限制且实施良好。可能性：

*   具有良好 UI 的推送通知（除了标记/声音/其他的消息堆栈 - 如果他们必须有一个额外的批准步骤，这样应用程序就不会令人讨厌，就这样吧）

*   多个完整进程（我意识到，当前的操作系统不可能，但是我从来没有很好地解释为什么 iPhone 不支持虚拟内存）

*   可以在后台运行的更小的“后台”版本的应用程序 - 没有 GUI 并且显着更严格的内存限制

* * *

## 回答 #6

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T08:43:35.603

*   一个很好的映射 API。让我们访问 Maps 应用程序使用的 Google Maps 抽象！

*   更多界面生成器的优点

*   更好的模拟器

* * *

## 回答 #7

> 赞同：3
> 
>             
> 
> 时间：2009-03-14T21:42:52.097

*   智能收件箱。传入的消息会根据类型路由到已安装的处理程序。

*   同步框架，简化了与桌面和 Mobile Me 的同步。

*   体面的风景支持，没有大量的错误，特别是对于相机选择器。更好地支持旋转并更好地控制它。

*   从选择器访问图像的 EXIF 数据，以便我们知道它们的位置

*   更深入地访问相机 API，这样我们就不会被标准的 photo taker/picker 套路

*   可以启动应用程序的推送通知。（代替完整的多任务处理，我认为我们不会得到并且可能会出现问题。）

*   更好、更直观的键盘控制。

*   用于应用程序间消息传递的 API。

*   访问日历、iTunes、邮件、便笺等中的数据（经用户许可）

*   更准确的模拟器，例如限制带宽的方法，以及使用 Mac 的相机实际拍照。

*   用于数据交换的电话-电话蓝牙

*   访问 iPhone 应用程序使用的更多视图，例如进度 HUD、电子邮件地址的电子邮件“blobbing”机制、缩略图滚动条、照片应用程序中的 HUD 等等。

* * *

## 回答 #8

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T02:31:31.160

减少沙盒。这不太可能发生，但如果应用程序具有比当前稍多的功能（例如，实际的文件系统访问权限）总是值得赞赏的。即使它是只读访问权限，它仍然允许更有趣的应用程序存在）。

编辑：另外，访问复制/粘贴 API。但我希望这对苹果来说是显而易见的。

* * *

## 回答 #9

> 赞同：2
> 
>             
> 
> 时间：2009-03-14T06:36:44.510

我的列表：

*   与 Mac 一样，功能更全面的 IB 支持

*   应用间数据传输机制（可以是 C&P，但不一定是）

*   大幅改进的相机 API，具有更深层次的控制和更大的灵活性

*   SDK接入蓝牙和更多协议支持

*   像今天的 Mac 一样，围绕地址簿的真正的 ObjectiveC 框架。

*   当应用程序尝试访问通讯录数据时，类似于位置警告的警告。

我敢肯定，无论他们实际准备了什么，都会有一些有趣的转折。

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T02:37:45.997

*   无需启动 SMS 客户端并让用户键入消息即可发送 SMS 消息。

*   访问原始相机数据，这样就可以完成工作而无需拍照并等待它保存（就像您可以使用 Android 一样）

*   推送通知，以便您可以启动任务......需要用户可控。

*   可以对焦的相机（我知道……必须等待下一部 iPhone……如果他们决定把它放进去……）

* * *

## 回答 #11

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:28:20.973

一个 UIKit 级别的绘图 api。

* * *

## 回答 #12

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T06:34:57.970

> 我们都知道人们想要的功能集。iPhone 上的复制/粘贴、彩信、Flash 等。

我会认为那些特定的项目在 SO 愿望清单中（尽管我看这个评论的投票似乎是错误的 :-)。

当您拥有电子邮件时，彩信是一个毫无意义的应用程序。Flash 不是操作系统问题 - Flash 可以在今天交付。

我什至不想要推送通知——它们只是一个补丁，我想要后台应用程序。我还希望修复所有损坏的 API，例如相机、视频和风景支持。对 CoreImage 过滤器的支持也很好，但可能太多了。

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2009-03-14T21:18:47.973

*   [[ABAddressBook sharedAddressBook] me] 因为能够使用所有者的邮政编码、电话号码或其他任何内容。

*   能够将文件下载到本地存储并将它们同步回 iTunes 或您的硬盘

* * *

## 回答 #14

> 赞同：0
> 
>             
> 
> 时间：2009-03-16T16:23:38.117

从照片中获取 EXIF 数据

一次拉出所有照片

一次拉出所有联系人

控制屏幕亮度

访问 iPod 部分中的音乐

阅读电子邮件和短信的权限

访问 Safari cookie（所以也许我可以制作某种让我保持登录状态的应用程序。）

* * *

## 回答 #15

> 赞同：0
> 
>             
> 
> 时间：2009-03-17T06:17:17.177

*   修复横向模式下的表格视图

*   可直接访问相机的新相机 API

*   上传到应用商店时自动分发代码签名（而不是 xcode 中的代码签名）

*   请求更多内存的能力，因此用户无需重新启动手机即可摆脱后台应用程序

* * *

## 回答 #16

> 赞同：-3
> 
>             
> 
> 时间：2009-03-13T02:28:42.383

一个非 Mac 的开发环境。

# ipython - 无法设置 IPython 默认登录 shell

> ID：641251
> 
>         
> 
> 赞同：-1
> 
>         
> 
> 时间：2009-03-13T02:23:32.287
> 
>         
> 
> 标签：ipython

我通过 MacPorts 将 IPython 安装到我的 Mac 上。我可以通过*$ IPython*运行它，而不是作为登录 shell。

我试图找到 IPython 的目录，然后我可以将其放入终端的设置中，但未成功

```
locate /*IPython 
```

即使通过 whereis 我也没有找到它。

**如何将 IPython 设置为默认登录 shell？**

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T03:22:14.610

locate 不是一个实时数据库，所以假设您刚刚安装它，它找不到 IPython 我并不感到惊讶

你是如何安装的，IPython？软件包中必须有关于安装位置的文档吗？

如果您使用 macports 安装它，请查看您的 macports 目录（通常是 /opt/）

如果是，`/opt/`则查找`/opt/local/bin`您的 python 安装

# wpf - WPF 可以用拇指覆盖/覆盖文本吗？

> ID：641254
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T02:26:07.647
> 
>         
> 
> 标签：wpf, user-controls

我有一个 WPF UserControl，它用作我正在编写的应用程序的浮动“聊天窗口”。基本上，网格中的三行：标题、用于聊天消息的富文本框，最后是用于用户输入的文本框。

标题元素上有一个 Thumb，以便用户可以在应用程序内拖动聊天窗口。但我还需要在该标题中添加文本。当然，当我这样做时，Thumb 变得无响应，因为其他一些元素在它的顶部。我无法弄清楚如何使这项工作，因为拇指不接受内容......

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T02:30:26.293

我没有将 Thumb 嵌套在 HeaderContentControl 中，而是将它们分开，并将 HeaderContentControl 上的 IsHitTestVisible 设置为 false。

# java - Glassfish 在 OS X 10.5/Java 6 上挂起

> ID：641255
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T02:26:50.750
> 
>         
> 
> 标签：java, macos, glassfish

我想在 Mac 上玩 glassfish，但我无法启动它。

我已经按照安装说明创建了一个默认域，这似乎很好，但是当我尝试启动它时（`asadmin start-domain domain1`）它就在那里：

```
[kris@Macintosh-2:~/glassfish] ./bin/asadmin start-domain domain1
Starting Domain domain1, please wait.
Default Log location is /Users/kris/glassfish/domains/domain1/logs/server.log.
Redirecting output to /Users/kris/glassfish/domains/domain1/logs/server.log 
```

日志只包含启动服务器的命令：

```
Mar 12, 2009 7:09:40 PM com.sun.enterprise.admin.servermgmt.launch.ASLauncher buildCommand
INFO:
/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Home/bin/java
<crapload of system properties>
-client
-XX:+UnlockDiagnosticVMOptions
-XX:MaxPermSize=192m
-Xmx512m
-XX:NewRatio=2
-XX:+LogVMOutput
-XX:LogFile=/Users/kris/glassfish/domains/domain1/logs/jvm.log
-cp
/Users/kris/glassfish/lib/jhall.jar:/Users/kris/glassfish/lib/appserv-launch.jar
com.sun.enterprise.server.PELaunch
start 
```

最终，`asadmin`放弃等待：

```
Timeout waiting for domain domain1 to go to starting state.
CLI156 Could not start the domain domain1. 
```

这是使用 glassfish v2.1，但我在 v3 前奏中得到了类似的行为。我也尝试过 java 5 和 6。我不知道要进行什么样的调试，因为它似乎还没有起步。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T09:13:14.690

我第一次能够启动我的 glassfish，但第二次，它只是给了我一个奇怪的错误消息，它无法启动域。

谷歌搜索，在 imq 中提到了一个锁定文件。

检查“/glassfish/domains/domain1/imq/instances/imqbroker/”中是否有文件“锁定”。如果有，请将其删除，然后尝试再次启动 glassfish。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-06-11T15:27:44.617

同样在 JMS 方面，您是否尝试在 domain.xml 中将代理从 EMBED 更改为 LOCAL？我似乎记得在 OS X 上的帮助。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2011-03-14T14:41:10.003

自从您第一次启动 glassfish 安装目录以来，您是否移动过它？当你这样做时，GF 对缓存感到非常困惑。解决方案[在这里](https://stackoverflow.com/questions/5300034/glassfish-hangs-after-moving-installation-directory/5300054#5300054)。

# asp.net - 如何在 ViewState 中存储嵌套的 CompositeControl 属性

> ID：641259
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T02:27:57.610
> 
>         
> 
> 标签：asp.net, viewstate, composite-controls

我有一个复合控件，它具有大量可用于设置控件样式的属性。我想对这些属性进行分组，但仍保留 ViewState 中的一些属性 控件的标记如下所示：

例如

```
<cc:Test id="test">
    <Toolbar Items="add,delete" Enabled="true" />
    <Grid Enabled="true" AllowSort="true" AllowFilter="true" />
</cc:Test> 
```

我的代码看起来像这样

```
<ParseChildren(true)> <PersistChildren(true)> _
Public Class Test Inherits CompositeControl

    Private _grid As New GridStyle();
    <PersistenceMode(PersistenceMode.InnerProperty)> _
    <DesignerSerializationVisibility(DesignerSerializationVisibility.Content)> _
    Public ReadOnly Property Grid As GridStyle
        Get
            Return _grid;
        End Get
    End Property
End Class

Public Class GridStyle
    private _allowFilter As Boolean = False;
    Public Property AllowFilter As Boolean
        Get
            Return _allowFilter
        End Get
        Set(value As Boolean)
            _allowFilter = value
        End Set
    End Property
End Class 
```

ViewState 无法从 GridStyle 类访问，那么我将如何维护 ViewState 中 AllowFilter 属性的状态？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-15T08:43:33.333

在您的自定义控件中（或为自定义控件中使用的标准控件制作包装器），您需要覆盖 SaveViewState 和 LoadViewState

这在 MSDN 和一般网络上有很好的记录

# c - gethostbyname win32错误

> ID：641262
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T02:29:10.090
> 
>         
> 
> 标签：c, winapi, sockets, visual-studio-2005

我以通常的方式使用 gethostbyname() 函数...

```
iaHost.s_addr = inet_addr(lpServerName);
if (iaHost.s_addr == INADDR_NONE)
{
    // Wasn't an IP address string, assume it is a name
    lpHostEntry = 0;
    lpHostEntry = gethostbyname(lpServerName);
} 
```

访问我的网站并返回信息。变量“lpServerName”可以是任何主机，例如“google.com”或环回“127.0.0.1”。

我的系统：在 AMD Opteron 系统上运行的 Windows x64 或 x32（发生相同的错误无关紧要），XAMPP 在我的机器上，我将它用于调试目的，我的编译器是 Microsoft Visual c++ 2005。

这就是问题所在：当我使用环回地址时，上面的代码可以正常工作。当我尝试访问计算机外部的网站时，我收到以下错误：“Windows 已在 test_gethostbyname.exe 中触发断点。这可能是由于堆损坏，并表示 test_gethostbyname.exe 或任何它已加载的 DLL。输出窗口可能有更多的诊断信息”。该程序“test_gethostbyname.exe”仅包含来自一个更大的项目的代码部分，该项目适用于访问 Internet。因此，我认为堆没有被我所做的任何事情破坏。我已经尝试了具有相同结果的“getaddrinfo”命令。我在网上搜索了关于这个问题的任何类型的信息，没有任何乐趣（除了 unix 系统上的分段错误）。

有谁知道这个命令有什么问题会导致这个错误发生？  

提前致谢，

周杰伦

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T02:45:19.380

我看到您正在检查 INADDR_NONE 但另一个失败状态 INADDR_ANY 呢

[http://msdn.microsoft.com/en-us/library/ms738563(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms738563(VS.85).aspx)

您将什么字符串传递给 gethostbyname()？很可能 lpServerName 的格式有问题。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T02:33:51.980

是 lpServerName:

*   非 NULL 终止

*   空值

*   已删除

我的猜测是它不是 NULL 终止的。

即使 inet_addr 没有看到 NULL 终止，它也可能会停止，所以这就是为什么当您使用普通 IP 点分字符串时它可以工作的原因。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T15:22:18.140

我玩过字符串是否为空终止并且错误没有消失。我编译的示例来自 Microsoft 对 gethostname() 的描述，我认为它在功能上是正确的，但我仍然得到错误。

今天早上，我在另一台使用 Visual c++ 的 express 版本的机器上重新编译了示例，并且没有发生错误。因此，我开始怀疑我的开发机器上的库库可能有问题，所以我将重新安装编译器和平台 SDK，看看是否能解决问题。  

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-17T14:25:26.833

我找到了答案。问题似乎是我的 XP 系统上的库。正如我之前提到的，我在另一个 XP 系统上编译程序没有问题。我使用 Windows 7 和 Visual c++ 8 express 在我的开发系统上编译了该系统，并且它工作正常。

# emacs - 无法在 Emacs 中设置 .txt 文件 .tex 的语法

> ID：641265
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T02:30:17.370
> 
>         
> 
> 标签：emacs, syntax, latex

**如何在 Emacs 中设置 .txt 文件 .tex 的语法？**

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-03-13T02:38:46.320

对于这样的问题，您应该参考[EmacsWiki](http://www.emacswiki.org/)等其他资源。

在您的`.emacs`中，您可以执行以下操作：

```
(setq auto-mode-alist
  (append '(("\\.txt$" . tex-mode))
    auto-mode-alist)) 
```

此外，您可以使用以下方法更改当前缓冲区的模式行：

```
Mx tex 模式

```

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T14:40:35.883

您还可以将以下内容放在文件的开头：

```
% -*- TeX -*- 
```

这将向 emacs 发出信号，表明您的文件应该处于 tex 模式。

# c# - 日期时间变量

> ID：641267
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T02:30:29.727
> 
>         
> 
> 标签：c#, asp.net

我想在 C# 中为 DateTime 变量传递一个空值。该值应作为空值存储在数据库中。

我试过使用 Datetime.Minvalue，但它存储了一个默认值。它在数据库中必须为空。我怎么做？

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2009-03-13T02:32:29.613

使用`DateTime?`如

```
DateTime? foo = null; 
```

这使得一个可以为**[空](http://msdn.microsoft.com/en-us/library/1t3y8s4s(VS.80).aspx)** `DateTime`的：

> 可空类型可以表示其基础值类型的正常值范围，**外加一个额外的空值**。

然后在写出值时，您可以使用如下值：

```
if(foo == null)
{
   // Handle the null case
} 
else 
{
   // Handle the non-null case
} 
```

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T02:36:35.483

我同意可空类型的答案，但是当您将其写入数据库时​​，您仍然需要测试 null 并将其转换为 DBNull.Value。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T02:33:27.037

您可以使用`DateTime?`值类型。它可以有`null`值，但除此之外它与`DateTime`

# javascript - 在 JavaScript 中通过 ID 引用 ASP.NET 控件？

> ID：641280
> 
>         
> 
> 赞同：49
> 
>         
> 
> 时间：2009-03-13T02:37:22.720
> 
>         
> 
> 标签：javascript, asp.net, ajax

当 ASP.NET 控件被渲染时，它们的 id 有时会发生变化，就像它们在命名容器中一样。`Button1`例如，实际上可能具有`ctl00_ContentMain_Button1`渲染时间的 id。

我知道您可以在 .cs 文件中将 JavaScript 编写为字符串，获取控件的 clientID 并使用 clientscript 将脚本注入您的页面，但是有没有一种方法可以使用 ASP.NET Ajax 直接从 JavaScript 引用控件？

我发现编写一个函数来递归解析 dom 并找到一个包含我想要的 id 的控件是不可靠的，所以我在寻找最佳实践而不是解决方法。

* * *

## 回答 #1

> 赞同：75
> 
>             
> 
> 时间：2009-03-13T02:58:16.947

Dave Ward 的这篇文章可能有你要找的东西：

[http://encosia.com/2007/08/08/robust-aspnet-control-referencing-in-javascript/](http://encosia.com/2007/08/08/robust-aspnet-control-referencing-in-javascript/)

文章摘录：

> 确实有。更好的解决方案是使用内联 ASP.NET 代码来注入控件的 ClientID 属性：
> 
> ```
> $get('<%= TextBox1.ClientID %>') 
> ```
> 
>   
>   
> 
> 现在，无论页面的结构和控件的嵌套级别如何，都会引用正确的客户端元素 ID。在我看来，这种方法的非常小的性能成本非常值得让您的客户端脚本更有弹性地适应变化。

Dave 的一些示例代码来自该帖子的评论线程：

```
<script>
  alert('TextBox1 has a value of: ' + $get('<%= TextBox1.ClientID %>').value);
</script> 
```

我上面链接的文章的评论线程也有一些很好的讨论。

* * *

## 回答 #2

> 赞同：18
> 
>             
> 
> 时间：2013-11-04T10:53:46.543

您可以更改`ClienIDMode`控件的属性，`'Static'`这将产生您在 .NET 代码中为控件提供的相同 ID。

```
<asp:TextBox ID="TextBox1" ClientIDMode="Static" runat="server"></asp:TextBox> 
```

将导致：

```
<input name="ctl00$MainContent$TextBox1" type="text" id="TextBox1"> 
```

所以你有相同的ID。

* * *

## 回答 #3

> 赞同：12
> 
>             
> 
> 时间：2009-03-13T02:49:11.383

对此有几点想法：

1) 我很幸运地通过 css 类而不是 id 获取元素，因为 asp.net id 并不像你所说的那样可靠。我使用这个函数，它的表现相当不错：

```
function getElementsByClass(searchClass,node,tag) {
 var classElements = new Array();
 if ( node == null )
    {
        node = document;
    }

 if ( tag == null )
    {
        tag = '*';
    }

 var els = node.getElementsByTagName(tag);
 var elsLen = els.length;
 var pattern = new RegExp("(^|\\s)"+searchClass+"(\\s|$)");

 for (i = 0, j = 0; i < elsLen; i++) 
    {
        if ( pattern.test(els[i].className) ) 
            {
                classElements[j] = els[i];
                j++;
            }
      }
 return classElements;
} 
```

2) jQuery 在这里有很大帮助。使用 jQuery，您可以可靠地获取 id 以某个字符串结尾的元素。虽然这不是使用 jQuery 的“原因”，但它绝对是一个加分项。

3) 这将在 asp.net 4.0 中修复，所以请坚持住 :-) [http://weblogs.asp.net/asptest/archive/2009/01/06/asp-net-4-0-clientid-overview。 aspx](http://weblogs.asp.net/asptest/archive/2009/01/06/asp-net-4-0-clientid-overview.aspx)

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T02:46:09.253

我认为没有单一的“最佳实践”可以做到这一点。有很多不同的*非常好的*做法。这是我们的：

每个具有客户端功能的控件都会在控件标记的正下方呈现一个内联脚本块：

```
<span id="something_crazy_long">
    control markup
</span>
<script type="text/javascript">new CustomControl('something_crazy_long');</script> 
```

每个控件都有一个随附的 JS，例如：

```
var CustomControl = function(id) {
    this.control = document.getElementByID(id);
    this.init();
};

CustomControl.prototype.init = function() {
    //do stuff to wire up relevant events
}; 
```

在代码隐藏中，我们执行以下操作：

```
class CustomControl : Control

override void Render(HtmlTextWriter writer)
{
    writer.WriteBeginTag("span");
    writer.WriteAttribute("id", this.ClientID);
    writer.Write(HtmlTextWriter.TagRightChar);
    //write control markup
    writer.WriteEndTag("span");
    writer.WriteBeginTag("script");
    writer.WriteAttribute("type", "text/javascript");
    writer.Write(HtmlTextWriter.TagRightChar);
    writer.Write(
        string.Format("new CustomControl('{0}');", this.ClientID)
    );
    writer.WriteEndTag("script");
} 
```

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T02:53:46.223

我做了一些类似于 Rex M 的事情，除了避免多个脚本标签我在我的页面基类中使用一个函数来注册我将在客户端使用的控件，然后将它们吐出到 1 个脚本标签内的 html 中。

您甚至可以将您的控件子类化以自动注册到该函数或使用布尔属性来设置您是否要在客户端使用它们。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T03:05:14.760

哦，我也发现了这个，以防其他人遇到这个问题。

为 asp.net 控件使用自定义 jQuery 选择器：http: 
 [//john-sheehan.com/blog/custom-jquery-selector-for-aspnet-webforms/](http://john-sheehan.com/blog/custom-jquery-selector-for-aspnet-webforms/)

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2012-11-28T13:35:45.993

对于 'ctl00_ContentMain_Button1' - 在 asp.net 中，当页面在浏览器中呈现时，第一部分保持相同的 'ctl00'。第二部分是使用“ContentMain”的 ContentPlaceHolder 的 ID。第三是控件 'Button1' 的 ID

我喜欢这个[http://codedotnets.blogspot.in/2012/01/how-get-id-server-control-javascript.html](http://codedotnets.blogspot.in/2012/01/how-get-id-server-control-javascript.html)

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2013-06-17T20:55:42.157

我更喜欢标记 document.getElementById('<%#TextBox1.ClientID %>').value 中的数据绑定标签，而不是使用服务器端标签实现 <% = TextBox1.ClientID %>。

服务器端标签禁止你在后面的代码中向 dom 添加控件。当您构建应用程序时，通常会出现这种需求，而数据绑定方法可能会使您免于重大重写。

使用服务器端标签时，也称为“代码块”，执行此常见操作

> this.Form.Controls.Add(myContorl);

在运行时生成此错误：

> 无法修改 Controls 集合，因为该控件包含代码块（即 <% ... %>）。

不幸的是，这通常只有在您建立了您的网站后才会变得明显。

在实现数据绑定控件“<%#TextBox1.ClientID %>”时，解析标记中引用的控件属性的值，在适当的位置，例如 Page_Load 数据绑定的末尾，如下所示：

> Page.DataBind()

请记住，Page.DataBind() 会导致页面上的子控件也进行 DataBind，如果页面单独处理某些子控件的数据绑定，这可能是一个不需要的副作用。如果是这种情况，可以像这样在单个控件上执行数据绑定：

> TextBox1.DataBind()

应用程序演变最终会导致某种基本站点范围的功能，您可能希望在其中添加基本控件，一旦您使用服务器端标签将网站应用程序替换为数据绑定就会出现问题，特别是当页面已被编码以处理数据绑定时他们自己。

* * *

## 回答 #9

> 赞同：-1
> 
>             
> 
> 时间：2012-01-29T12:41:50.720

您也可以使用`document.getElementById`方法获取ID。

# mysql - MySQL中IP数值的正则表达式？

> ID：641282
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T02:38:00.863
> 
>         
> 
> 标签：mysql, regex, ip

假设一个标题为“交易”的表格

典型查询：`select * from transactions where ip=INET_ATON('127.0.0.1');`

我希望能够使用特定的第一个八位字节（即 127）对所有 ip 进行正则表达式搜索，但我不太清楚语法。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T03:24:59.953

“transactions.ip”已经是一个整数，这就是提问者使用 INT_ATON 的原因。尝试直接将其与 /regexp 之类的字符串匹配是没有好处的，您必须首先使用反向函数 INT_NTOA 将其转换回 IPv4 地址：

```
SELECT * FROM transactions WHERE INT_NTOA(ip) LIKE '127.%'; 
```

这需要完整的表扫描（击败索引）来转换和比较。

> 我希望能够使用特定的第一个八位字节（即 127）对所有 ip 进行正则表达式搜索

但是，如果您想与 IP 地址的前半部分进行比较，您可以利用第一个八位字节存储在数字的最高有效位中这一事实，并说：

```
SELECT * FROM transactions WHERE ip BETWEEN INT_NTOA('127.0.0.0') AND INT_NTOA('127.255.255.255'); 
```

这可以使用 'ip' 上的索引来完成，因此效率会大大提高。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T03:10:16.760

您将 ip 与 INET_ATON 的结果进行比较，这意味着 ip 是一个 32 位整数。您的操作应该很简单...

```
SELECT * FROM transactions WHERE (longip & 0xFF000000) = (0x7F000000) 
```

这将比将正则表达式应用于字符串中的点 IP 快得多，并且比 LIKE '127.%' 解决方案更快。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T02:52:23.777

像这样？

```
select * from transactions where ip REGEXP "^[1-2][1-9][1-9]" 
```

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T03:03:01.957

```
SELECT * FROM transactions WHERE ip LIKE '127.%'; 
```

# debugging - 诠释 i = 2; // 当你只需要一些东西来断点时，你用什么作为一次性行？

> ID：641283
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-03-13T02:38:26.650
> 
>         
> 
> 标签：debugging

每当我想要一个没有任何东西可以中断的地方的断点时（在循环内，&c），我倾向于自动下拉：

```
int i = 2; 
```

我很好奇别人用什么。

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2009-03-13T02:41:19.140

Visual Studio 允许您在大括号上休息。

* * *

## 回答 #2

> 赞同：9
> 
>             
> 
> 时间：2009-03-13T03:18:37.520

在 .NET Framework 中（此处使用 C#）：

```
System.Diagnostics.Debugger.Break(); 
```

为了避免每次都输入这个，只需为您的首选语言创建一个新的代码片段：

```
<?xml version="1.0" encoding="utf-8" ?>
<CodeSnippets xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">
  <CodeSnippet Format="1.0.0">
    <Header>
      <Title>sddb</Title>
      <Shortcut>sddb</Shortcut>
      <Description>
        Code snippet for System.Diagnostics.Debugger.Break()
      </Description>
      <Author>Peter McG</Author>
      <SnippetTypes>
        <SnippetType>Expansion</SnippetType>
      </SnippetTypes>
    </Header>
    <Snippet>
      <Code Language="csharp">
        <![CDATA[System.Diagnostics.Debugger.Break();$end$]]>
      </Code>
    </Snippet>
  </CodeSnippet>
</CodeSnippets> 
```

* * *

## 回答 #3

> 赞同：7
> 
>             
> 
> 时间：2009-03-13T02:53:51.497

如果它是 x86 机器上的 C++，我只使用：

```
__asm int 3 
```

并等待异常发生。甚至不必在 Windows 上的调试器中启动，或者您使用好的 ole DebugBreak()。

* * *

## 回答 #4

> 赞同：7
> 
>             
> 
> 时间：2009-03-13T02:54:34.583

你不需要一次性代码。

你甚至可以在“for”循环声明中放置一个断点；
将光标移到“for”循环声明上并按***F9***

![替代文字](https://farm4.static.flickr.com/3421/3349936931_f8c7d66947_o.png)

* * *

## 回答 #5

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T10:47:52.823

```
i = i; 
```

或范围内定义的任何变量。

在 C#/VS 中，您会收到编译器警告，因此它也是将代码标记为未完成等的好方法。

* * *

## 回答 #6

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T02:40:48.440

```
console.write("stop here") 
```

在.net 中总是使用那条线，我不知道为什么，只是多年来。  

* * *

## 回答 #7

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T12:32:09.763

插入代码来破坏有什么意义？是不是已经有你想破解的代码了？我只是将断点放在有问题的实际行上；我的 IDE (Eclipse) 在执行该行之前停止。似乎很容易。

现在，在我了解条件断点之前，我曾经添加代码来测试有趣的条件，这样我就不会在每次循环迭代或每次调用常用函数时都中断。

* * *

## 回答 #8

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T02:52:50.063

```
(void *)"Insert witty comment."
```

* * *

## 回答 #9

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T02:59:39.283

```
asm { int3 } 
```

但我是个疯子 :D

* * *

## 回答 #10

> 赞同：3
> 
>             
> 
> 时间：2010-02-15T08:58:08.243

在 C/C++ 中，您可以使用无操作：

`;`

* * *

## 回答 #11

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T02:46:10.733

在 C# 中，我在结束大括号上打断，而在 VB.NET 中，我在 End If/Sub/Function/whatever 上打断。

* * *

## 回答 #12

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T02:51:30.923

`bool breakHere = true;`

这是自我记录！

* * *

## 回答 #13

> 赞同：2
> 
>             
> 
> 时间：2009-03-17T23:08:27.083

我在 C# 中使用它：

```
If (Debugger.IsAttached)
    Debugger.Break(); 
```

我抛出 IsAttached 以便如果它没有被删除它不会影响生产代码。

* * *

## 回答 #14

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T11:40:45.473

```
int moo = 42; 
```

为什么哞？不知道，就是想起来。为什么是42？为什么不选它！

* * *

## 回答 #15

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T11:43:55.293

```
int x = 0;  
x = x; 
```

* * *

## 回答 #16

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:44:05.443

我对价值做同样的事情，`int`但我最喜欢的是

```
int y=1; 
```

* * *

## 回答 #17

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T02:50:09.913

```
Console.Writeline(e.Message); 
```

* * *

## 回答 #18

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T12:53:43.520

asm 易失性（“nop”）；

* * *

## 回答 #19

> 赞同：1
> 
>             
> 
> 时间：2009-03-17T23:03:41.370

在大多数（如果不是全部）Javascript 调试器中，您可以使用

```
debugger; 
```

语句，它表现为一个断点。

* * *

## 回答 #20

> 赞同：0
> 
>             
> 
> 时间：2009-05-25T20:48:55.993

让我们考虑理想的属性。代码应该

1.  可以断点

2.  清楚地解释它仅用于断点。

3.  运行它的用户不会立即看到。

4.  不影响运行时行为（包括运行时间）。

根据您使用的优化器，最佳断点代码可能会有所不同。

我不太喜欢添加组装。它不可移植，并且会破坏编译器对周围代码的分析。即使它是无操作的，它也可能会影响性能。

打印是用户可见的。与调试器交谈感觉就像你做错了什么。我听说过在调试器中运行代码时线程错误如何消失的故事（这就是调试器的名字：D）。我想说这是要避免的事情，它解决的问题应该由更好的调试器来解决（也许是一个易于使用的猴子修补程序？）。

我认为最好的代码是`bool breakpoint_dummy = /* the value means nothing */ false;`. 它适合 80 列，它解释了它是什么，如果你的优化编译器不能处理未使用的变量，它会（希望？）编译为`xorl eax, eax`，一个快速而小的代码（我猜）。一般来说，零比一便宜;-)

* * *

## 回答 #21

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T11:35:48.170

`String foo = "bar";`

* * *

## 回答 #22

> 赞同：0
> 
>             
> 
> 时间：2010-05-18T01:58:48.890

我一直做的是制作某种`#define`，例如（VC++）：

```
#define NOP __asm{nop} 
```

对于不同的平台，这可以很容易地成为其他东西，例如（gcc）：

```
#define NOP asm("nop") 
```

如果没有内联汇编语言，你可以用一些明智的方法来捏造：

```
/* insert directives to prevent inlining and optimization */
void nop() {} 

#define NOP (nop()) 
```

对于您不想要的构建，它也可以变成无：

```
#define NOP ((void)0) 
```

这种事情可以去任何平台特定的类型定义等等去。

# ruby-on-rails - 我可以在 Capistrano 任务中与 Rails 模型交互吗？

> ID：641287
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T02:44:17.883
> 
>         
> 
> 标签：ruby-on-rails, rake, capistrano

我经常使用依赖于已加载的 Rails 环境任务的 Rake 任务。然后我在 Rake 任务中与 Rails 模型进行交互。我可以在 Capistrano 中执行此操作吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T02:50:40.240

您绝对可以使用 capistrano 来执行 rake 任务。

```
 desc 'Run a Rake Task.'
  task :after_deploy, :roles => :app do
    run "cd /path/to/app && rake -e environnment task here"
  end 
```

如果您问是否可以从 Capistrano 访问 rails 模型，那么我会说我不这么认为，除非您使用其他也加载 rails 环境的方式，例如脚本/运行器。

我会说坚持从 Capistrano 发射 rake 任务。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2012-07-30T09:26:43.050

以下可能会更好：

```
run "cd #{current_path} && #{rake} RAILS_ENV=#{rails_env} sunspot:solr:stop" 
```

# .net - WPF Binding - 如何确定对象无效以防止保存

> ID：641289
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-03-13T02:45:51.080
> 
>         
> 
> 标签：.net, wpf, binding

我在 WPF 应用程序中有一个文本框，该文本框绑定到实现 IDataErrorInfo 的 Linq to Entities 类的属性。文本框绑定具有 ValidatesOnExceptions=True 和 ValidatesOnDataErrors=True。当文本框绑定到整数属性并且用户输入文本时，文本框轮廓显示为红色，因为我没有设置自定义样式。

在我的 Save 方法中，我如何知道对象无效而无法保存？我希望用户单击“保存”按钮，我可以通知他们出现问题，而不是禁用“保存”按钮。

干杯，

戴夫

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T02:51:07.243

我还没有找到一个简单的方法来做到这一点。我在陷阱周围找到了一些代码来递归遍历表单上的所有控件，并确定其中是否有任何验证错误。我最终把它变成了一个扩展方法：

```
// Validate all dependency objects in a window
internal static IList<ValidationError> GetErrors(this DependencyObject node)
{
    // Check if dependency object was passed
    if (node != null)
    {
        // Check if dependency object is valid.
        // NOTE: Validation.GetHasError works for controls that have validation rules attached 
        bool isValid = !Validation.GetHasError(node);
        if (!isValid)
        {
            // If the dependency object is invalid, and it can receive the focus,
            // set the focus
            if (node is IInputElement) Keyboard.Focus((IInputElement)node);
            return Validation.GetErrors(node);
        }
    }

    // If this dependency object is valid, check all child dependency objects
    foreach (object subnode in LogicalTreeHelper.GetChildren(node))
    {
        if (subnode is DependencyObject)
        {
            // If a child dependency object is invalid, return false immediately,
            // otherwise keep checking
            var errors = GetErrors((DependencyObject)subnode);
            if (errors.Count > 0) return errors;
        }
    }

    // All dependency objects are valid
    return new ValidationError[0];
} 
```

因此，当用户单击表单上的“保存”按钮时，我会这样做：

```
var errors = this.GetErrors();
if (errors.Count > 0)
{
    MessageBox.Show(errors[0].ErrorContent.ToString());
    return;
} 
```

这比应有的工作要多得多，但是使用扩展方法可以简化一点。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T15:45:07.273

您可以在您的 s 上设置[`NotifyOnValidationError`](http://msdn.microsoft.com/en-us/library/system.windows.data.binding.notifyonvalidationerror.aspx)为，然后在某个父元素上添加事件处理程序。每当添加或删除错误时，都会触发该事件。`true``Binding`[`Error`](http://msdn.microsoft.com/en-us/library/system.windows.controls.validation.error.aspx)

# html - 没有动作的 HTML 表单

> ID：641292
> 
>         
> 
> 赞同：29
> 
>         
> 
> 时间：2009-03-13T02:47:05.257
> 
>         
> 
> 标签：html, django, forms, django-forms

在 Django / Pinax 中，我遇到了这样开头的登录表单：

```
<form class="login" method="POST" action=""> 
```

它工作得很好。因此，我假设 Django 框架中的某些 java 脚本或某些东西将值放入 action 属性中。

所以，我的问题：

*   Django如何插入动作？

*   他们为什么这样做？

*   我怎样才能知道这个表格的作用是什么？

更新：我看到这根本不是 Django 的事情，而是大多数浏览器所做的事情。

* * *

## 回答 #1

> 赞同：39
> 
>             
> 
> 时间：2009-03-13T02:57:26.260

在大多数浏览器中，空字符串的操作将表单指向浏览器当前加载的 URL，这是首先为表单提供服务的脚本。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2012-08-16T20:22:01.693

有关*具有空操作的表单*的有趣见解，请阅读[此线程](https://stackoverflow.com/questions/1131781/is-it-a-good-practice-to-use-an-empty-url-for-a-html-forms-action-attribute-a)，它为您提供了有关此问题的更新的 HTML5 视角。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T17:58:56.640

页面加载后，该页面加载的 javascript 也可能会根据正在使用该页面的应用程序设置一个操作。

另一种可能的可能性是 javascript 正在处理 onsubmit 事件。这样做可以防止页面重新加载或重定向到特定页面

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2014-07-24T10:07:01.687

我想现在回答这个帖子有点晚了。不管怎样，我会从这件事上学到什么。

`HttpResponseRedirect`如果表单中没有指定“动作”，那么 Django在相应的视图中查找。

例如，在下面的示例中：

```
if form.is_valid(): # All validation rules pass
        # Process the data in form.cleaned_data
        # ...
        return HttpResponseRedirect('/thanks/') 
```

一旦表单被验证（和处理），页面被重定向到“谢谢”

# asp.net - 从用户提交的 HTML 中重写 url

> ID：641300
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T02:51:32.080
> 
>         
> 
> 标签：asp.net, regex, wysiwyg

我在一个小 cms 中使用一个所见即所得的编辑器。它允许用户上传文件、图像等。如果我在源代码中添加名为 dog.jpg 的图像，我将得到：

```
<img src="/myweb/userfiles/images/dog.jpg" /> 
```

我可以将其保存到数据库并稍后在任何页面上使用它，直到我将我的站点移动到一个活动域。

myweb 是 IIS 中的虚拟目录。“/”指向根目录，在本例中为 localhost，所以我必须使用“/myweb”。但是，当我将站点上传到服务器并在那里复制数据库时，所有链接都会被破坏，因为服务器上没有“myweb”文件夹。

我的想法是用空字符串替换保存时的“/myweb”。我还必须替换编辑器为某些文件创建的完整 url。在显示时，我必须添加正确的应用程序目录。我可能会将这两个版本都保存在数据库中，并且仅在服务器更改时强制显示版本进行更新。

到目前为止，我想出了：

```
p = p.Replace("href=\"" + fullUrl, "href=\"").Replace("src=\"" + fullUrl, "src=\"").Replace("href=\"" + partialUrl, "href=\"").Replace("src=\"" + partialUrl, "src=\""); 
```

这是丑陋的，难以维护且效率低下。我想更好的方法是使用正则表达式，但我不知道该怎么做。

我的问题是，任何人都可以推荐关于此的好文章、博客/论坛帖子吗？如果您有其他解决方案，那就太好了。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:45:17.920

我不确定正则表达式版本是否具有您在这种情况下提到的任何特征。

也就是说，你可以这样做：

```
 string ReplaceUrlPaths(string html, string partialPath, string fullPath)
    {
        var pattern = string.Format("((href|src)=\")({0}|{1})", partialPath, fullPath);
        var regex = new Regex(pattern);
        return regex.Replace(html, m => m.Groups[1].Value);
    }
    [TestMethod]
    public void TestMethod10()
    {
        var input = @"<img src=""/myweb/userfiles/images/dog.jpg"" />";
        //carefull with any special regex char in the paths
        var replaced = ReplaceUrlPaths(input, "/myweb", "/some/full/path"); 
        Assert.AreEqual(
            @"<img src=""/userfiles/images/dog.jpg"" />", 
            replaced);
    } 
```

如果您继续这样做，请重构它以使用编译选项实例化一次正则表达式（因为 partialPath 和 fullPath 不会改变）。

还可以考虑通过定义一个具有备用端口的网站来将其作为根 URL 来避免这一切。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T03:41:26.950

将本地根路径与图像分开存储。对于每个图像，存储该图像的相对路径。

在本地显示图像时，使用与相对路径合并的本地根。当您发布到远程服务器时，您将远程根添加到相对路径。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T11:21:56.017

您的所见即所得编辑器是否允许您配置基本 URL，例如，以便图像的路径可以使用相对路径？我认为 FCKEditor 在它的配置文件中有类似 FCKConfig.BaseHref 的东西，它会做这样的事情。

或者，您可以使用 ASP.NET 2.0 Web 服务器将站点作为根站点运行吗？这样您就不必担心重写图像的路径，因为您可以只使用来自 webroot 的路径。

# c# - Any performance difference between int.Parse() and Convert.Toint()?

> ID：641304
> 
>         
> 
> 赞同：28
> 
>         
> 
> 时间：2009-03-13T02:53:16.163
> 
>         
> 
> 标签：c#, performance

Is there any significant advantages for converting a string to an integer value between int.Parse() and Convert.ToInt32() ? 

```
string stringInt = "01234";

int iParse = int.Parse(stringInt);

int iConvert = Convert.ToInt32(stringInt); 
```

I found a [question](https://stackoverflow.com/questions/104063/system-convert-toint-vs-int) asking about casting vs Convert but I think this is different, right? 

* * *

## 回答 #1

> 赞同：37
> 
>             
> 
> 时间：2009-03-13T03:00:33.943

When passed a string as a parameter, Convert.ToInt32 calls int.Parse internally. So the only difference is an additional null check.

Here's the code from .NET Reflector

```
public static int ToInt32(string value)
{
    if (value == null)
    {
        return 0;
    }
    return int.Parse(value, CultureInfo.CurrentCulture);
} 
```

* * *

## 回答 #2

> 赞同：16
> 
>             
> 
> 时间：2009-03-13T03:14:13.740

For what its worth:

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            int iterations = 1000000;
            string val = "01234";

            Console.Write("Run 1: int.Parse() ");
            DateTime start = DateTime.Now;
            DoParse(iterations, val);
            TimeSpan duration = DateTime.Now - start;
            Console.WriteLine("Duration: " + duration.TotalMilliseconds.ToString() + "ms");

            Console.Write("Run 1: Convert.ToInt32() ");
            start = DateTime.Now;
            DoConvert(iterations, val);
            duration = DateTime.Now - start;
            Console.WriteLine("Duration: " + duration.TotalMilliseconds.ToString() + "ms");

            Console.Write("Run 2: int.Parse() ");
            start = DateTime.Now;
            DoParse(iterations, val);
            duration = DateTime.Now - start;
            Console.WriteLine("Duration: " + duration.TotalMilliseconds.ToString() + "ms");

            Console.Write("Run 2: Convert.ToInt32() ");
            start = DateTime.Now;
            DoConvert(iterations, val);
            duration = DateTime.Now - start;
            Console.WriteLine("Duration: " + duration.TotalMilliseconds.ToString() + "ms");

            Console.Write("Run 3: int.Parse() ");
            start = DateTime.Now;
            DoParse(iterations, val);
            duration = DateTime.Now - start;
            Console.WriteLine("Duration: " + duration.TotalMilliseconds.ToString() + "ms");

            Console.Write("Run 3: Convert.ToInt32() ");
            start = DateTime.Now;
            DoConvert(iterations, val);
            duration = DateTime.Now - start;
            Console.WriteLine("Duration: " + duration.TotalMilliseconds.ToString() + "ms");

            Console.ReadKey();
        }

        static void DoParse(int iterations, string val)
        {
            int x;
            for (int i = 0; i < iterations; i++)
            {
                x = int.Parse(val);
            }
        }

        static void DoConvert(int iterations, string val)
        {
            int x;
            for (int i = 0; i < iterations; i++)
            {
                x = Convert.ToInt32(val);
            }
        }

    }
} 
```

Result of 1,000,000 iterations of each:

```
Run 1: int.Parse() Duration: 312.5ms
Run 1: Convert.ToInt32() Duration: 328.125ms
Run 2: int.Parse() Duration: 296.875ms
Run 2: Convert.ToInt32() Duration: 312.5ms
Run 3: int.Parse() Duration: 312.5ms
Run 3: Convert.ToInt32() Duration: 312.5ms 
```

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T02:57:47.447

The difference lies in the way both handles NULL value. 

When encountered a NULL Value, Convert.ToInt32 returns a value 0.
On other hand,Parse is more sensitive and expects a valid value. 
So it would throw an exception when you pass in a NULL.

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T02:57:51.893

See [this discussion for details.](http://julien.jacobs.free.fr/netshare/2006/08/int32parse-vs-converttoint.html)

Convert.ToInt32 won't throw as often (if stringInt == null, it returns 0 instead of throwing an exception), but has a slight bit more overhead since it's doing a few extra checks, then calling int.Parse internally.

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T03:36:37.743

I wrote the code below and the result was that int.parse is slower than convert.toint32.

```
 static void Main(string[] args) {
        Console.WriteLine(TimeConvertTo());
        Console.WriteLine(TimeParse());
    }

    static TimeSpan TimeConvertTo() {
        TimeSpan start = DateTime.Now.TimeOfDay;
        for (int i = 0; i < 99999999; i++) {
            Convert.ToInt32("01234");
        }
        return DateTime.Now.TimeOfDay.Subtract(start);
    }

    static TimeSpan TimeParse() {
        TimeSpan start = DateTime.Now.TimeOfDay;
        for (int i = 0; i < 99999999; i++) {
            int.Parse("01234");
        }
        return DateTime.Now.TimeOfDay.Subtract(start);
    } 
```

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2014-07-31T00:20:20.010

There are some performance implications as others have mentioned. If you look at the test code and performance stats [from this website](http://cc.davelozinski.com/c-sharp/fastest-way-to-convert-a-string-to-an-int "http://cc.davelozinski.com/c-sharp/fastest-way-to-convert-a-string-to-an-int"):

*   Int.Parse() and Int.TryParse() generally perform faster as the number of conversions you're performing increases.

*   Convert.ToInt() seems to perform best with a low number of conversions

*   The overall *fastest* way to convert a string to an int (assuming no exceptions) regardless of the number of conversions you need to perform is:

_

```
y = 0; //the resulting number from the conversion
//loop through every char in the string, summing up the values for the final number
for (int i = 0; i < s[x].Length; i++) 
    y = y * 10 + (s[x][i] - '0'); 
```

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2021-12-19T15:06:23.413

Both of the them are slow. If you know the exact format of input string and care about speed, I suggest you write the convert function by yourself.

# utilities - 有哪些实用程序可以在许多文件或文件夹中搜索代码？

> ID：641310
> 
>         
> 
> 赞同：-1
> 
>         
> 
> 时间：2009-03-13T02:56:11.740
> 
>         
> 
> 标签：utilities

什么是在许多文件或文件夹中查找代码的实用程序。类似于 PowerGrep 但免费软件。

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T03:06:18.253

在 Windows 上，有一个类似于 grep 的“查找”命令。

您还可以下载 cygwin 或其他一些 Unix 模拟器并从中获取 grep。

在 Windows 上，您还可以使用“unxutils”包获得独立版本的 grep：http: [//unxutils.sourceforge.net/](http://unxutils.sourceforge.net/)

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T08:55:35.120

对于 Windows，我过去曾使用过[Agent Ransack](http://www.mythicsoft.com/agentransack/)，它做得非常好。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T03:14:07.437

由于您似乎在 Windows 上，Google 告诉我您实际上可以使用 DOS cmd 行：

> 递归查找文件中的文本字符串，输出行号：
> 
>   
>   
> 
> FOR /R c:\~kenneth %v IN (*.css) DO find /N /I "#banner" "%~fv" >> test.txt
> 
>   
>   
> 
> 注意 %v 是一个变量，可以是任何字母。带引号的 "%~fv" 扩展为带引号的完全限定路径名。如果没有引号，则不会处理带有空格的目录。
> 
>   
>   
> 
> *.css 可以是任何通配符，甚至可以是 *。>> 将输出连接到一个文件，在本例中为 test.txt。

在此处查找更多示例：http: [//kennethhunt.com/archives/000173.html](http://kennethhunt.com/archives/000173.html)

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T07:31:42.343

[**Ack**](http://petdance.com/ack/)提供**与 grep 相同的选项**，它旨在搜索源代码、跳过临时文件和二进制文件、核心转储。它是一个 Perl 脚本，因此可以在 Unix 和 Windows 系统上运行。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T07:56:54.857

我为此使用记事本++。它甚至支持正则表达式。

搜索->在文件中搜索

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T09:25:36.343

[Textpad](http://www.textpad.com)是一个非常有用且便宜的编辑器，具有非常好的跨目录搜索功能。它甚至允许您快速转到搜索结果中提到的每个文件/行，只需反复按 F4。

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T12:17:02.343

Eclipse 功能强大且免费。Ctrl + Alt + H 将搜索 Eclipse 支持的任何语言的方法、声明、类型或自由文本。您甚至可以使用通配符和正则表达式。

例如，我一直在努力寻找对某种方法的所有访问。Eclipse 再次为我做得很好：Ctrl + H 将打开 Call Hierarchy 视图。

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T02:59:02.077

如果它在 Mac 上，[TextWrangler](http://www.barebones.com/products/TextWrangler/)非常适合使用 grep 进行多文件搜索。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T03:13:46.737

你也可以试试 Komodo Edit。它是一个支持多种语言并支持递归搜索目录的开发 IDE。它是用 Java 编写的，因此可以在“每个”平台上运行。

[http://www.activestate.com/komodo_edit/](http://www.activestate.com/komodo_edit/)

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T04:10:26.913

我没有见过 PowerGrep，但 Visual Studio 的“在文件中查找”最适合我。还允许“替换文件”并打开更改的文件以启用撤消。

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:53:47.983

在最新版本的 Windows 上，findstr.exe 会为您提供很好的服务，它比 find.exe 具有更多功能。

> > findstr /nips /c:"唯一文本字符串" *.txt

它不如 grep 强大，但它可以工作。/n 给你行号，/m 只会给你文件名。

如果您忘记了文件规范，它只会等待终止。

我还建议学习 cmd shell 脚本。以“for /?”开头。

* * *

## 回答 #12

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T12:23:49.987

我知道您要免费软件，但如果其他人正在浏览此问题，我建议您查看[Eluent Find](http://www.eluent.com/elfind.htm)。我几年前买的，每天都用。我为我所做的不同类型的搜索设置了许多路径计划和扩展配置。

它有点老化，似乎没有升级，但它像宣传的那样工作，不知道他们会添加什么。每年左右我都会四处看看比赛，并没有发现任何对我更有效的东西。路径计划是关键特征。

20 美元。

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T12:28:36.513

如果你安装 cygwin，你会得到`find`和`grep`实用程序，它们可以像这样一起使用：

```
find <dir> -name '*.cpp' -exec grep -H <pattern> {} \; 
```

或者只是递归 grep，如果您不关心按文件扩展名过滤：

```
grep -R <pattern> <dir> 
```

* * *

## 回答 #14

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T17:33:40.553

[谷歌桌面](http://desktop.google.com/)。一旦它为您的文件编制索引，它就可以非常快速地搜索和在您的所有文件中搜索 - 代码或其他文件。您还可以按文件类型搜索。

如果您使用的是 Windows XP，我不推荐使用 Windows Live Search。它又慢又笨重。

* * *

## 回答 #15

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T18:44:29.527

再次投票给[ack](http://petdance.com/ack/)。它的用处怎么强调都不为过，它确实是您处理大型代码库时最好的朋友。

# unit-testing - 测试概率函数

> ID：641318
> 
>         
> 
> 赞同：10
> 
>         
> 
> 时间：2009-03-13T02:59:00.890
> 
>         
> 
> 标签：unit-testing, testing, tdd, probability, shuffle

我需要一个以随机顺序返回数组的函数。我想确保它是随机的，但我不知道如何编写测试以确保数组确实是随机的。我可以多次运行代码，看看我是否多次得到相同的答案。虽然大型阵列不太可能发生冲突，但小型阵列（例如两个元素）很可能发生冲突。  

我应该怎么做？  

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T03:11:45.150

[Cedric](http://beust.com/weblog/archives/000369.html)推荐一种方法，您可以在该方法中运行足够多的时间以获得具有统计意义的样本并验证样本的属性。

因此，对于洗牌，您可能想要验证元素之间的关系是否具有非常小的协方差，每个元素的预期位置是 N/2，等等。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T03:07:24.740

基本上，诀窍是从您正在测试的类中提取随机性。这将允许您通过注入测试中的随机性公式来测试该类，当然这根本不是随机的。

C# 示例：

```
public static List<int> Randomise(List<int> list, Func<bool> randomSwap)
{
    foreach(int i in list)
    {
        if (randomSwap)
        {
            //swap i and i+1;
        }
    }
    return list;
} 
```

伪用法：

```
list = Randomise(list, return new Random(0, 1)); 
```

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-20T21:11:03.760

其他文章建议使用固定种子作为随机数生成器，模拟随机数生成器。这些都是很好的建议，我经常遵循它们。但是，有时我会改为测试随机性。  

给定要从源数组中随机填充的目标数组，请考虑执行以下操作。使用连续整数加载源数组。创建第三个名为“sum”的数组并用零加载它。现在随机填充目标，然后将目标的每个元素添加到 sum 的相应元素。再做一千次。如果分布真的是随机的，那么总和应该都大致相同。您可以对 sum 数组的每个元素进行简单的 -delta < expected < +delta 比较。  

您还可以对 sum 数组的元素进行均值和标准差，并对它们进行增量比较。  

如果您设置正确的限制，并进行足够的迭代，这就足够了。你可能会认为它会给你一个假阴性，但如果你正确设置了限制，宇宙射线更有可能改变程序的执行。  

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-15T01:10:41.160

首先，您应该为随机数生成器使用固定种子，否则测试可能会随机失败（即有时它们可​​能是有序的——[这就是随机性的问题](http://dilbert.com/strips/comic/2001-10-25/)）。然后您可以进行一些简单的检查，例如值是否按顺序排列，并且每次运行时值都不同。

这是我为自己的[shuffle bag](http://kaioa.com/node/53)实现编写的测试示例。

```
import jdave.Specification;
import jdave.junit4.JDaveRunner;
import org.junit.runner.RunWith;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Random;

/**
 * @author Esko Luontola
 * @since 25.2.2008
 */
@RunWith(JDaveRunner.class)
public class ShuffleBagSpec extends Specification<ShuffleBag<?>> {

    public class AShuffleBagWithOneOfEachValue {

        private ShuffleBag<Integer> bag;
        private List<Integer> expectedValues = Arrays.asList(0, 1, 2, 3, 4, 5, 6, 7, 8, 9);

        public ShuffleBag<Integer> create() {
            bag = new ShuffleBag<Integer>(new Random(123L));
            for (Integer value : expectedValues) {
                bag.add(value);
            }
            return bag;
        }

        public void onFirstRunAllValuesAreReturnedOnce() {
            List<Integer> values = bag.getMany(10);
            specify(values, does.containExactly(expectedValues));
        }

        public void onFirstRunTheValuesAreInRandomOrder() {
            List<Integer> values = bag.getMany(10);
            specify(values.get(0), does.not().equal(0));
            specify(values.get(0), does.not().equal(1));
            specify(values.get(0), does.not().equal(9));
            specify(values, does.not().containInOrder(expectedValues));
            specify(values, does.not().containInPartialOrder(1, 2, 3));
            specify(values, does.not().containInPartialOrder(4, 5, 6));
            specify(values, does.not().containInPartialOrder(7, 8, 9));
            specify(values, does.not().containInPartialOrder(3, 2, 1));
            specify(values, does.not().containInPartialOrder(6, 5, 4));
            specify(values, does.not().containInPartialOrder(9, 8, 7));
        }

        public void onFollowingRunsAllValuesAreReturnedOnce() {
            List<Integer> run1 = bag.getMany(10);
            List<Integer> run2 = bag.getMany(10);
            List<Integer> run3 = bag.getMany(10);
            specify(run1, does.containExactly(expectedValues));
            specify(run2, does.containExactly(expectedValues));
            specify(run3, does.containExactly(expectedValues));
        }

        public void onFollowingRunsTheValuesAreInADifferentRandomOrderThanBefore() {
            List<Integer> run1 = bag.getMany(10);
            List<Integer> run2 = bag.getMany(10);
            List<Integer> run3 = bag.getMany(10);
            specify(run1, does.not().containInOrder(run2));
            specify(run1, does.not().containInOrder(run3));
            specify(run2, does.not().containInOrder(run3));
        }

        public void valuesAddedDuringARunWillBeIncludedInTheFollowingRun() {
            List<Integer> additionalValues = Arrays.asList(10, 11, 12, 13, 14, 15);
            List<Integer> expectedValues2 = new ArrayList<Integer>();
            expectedValues2.addAll(expectedValues);
            expectedValues2.addAll(additionalValues);

            List<Integer> run1 = bag.getMany(5);
            for (Integer i : additionalValues) {
                bag.add(i);
            }
            run1.addAll(bag.getMany(5));
            List<Integer> run2 = bag.getMany(16);

            specify(run1, does.containExactly(expectedValues));
            specify(run2, does.containExactly(expectedValues2));
        }
    }

    public class AShuffleBagWithManyOfTheSameValue {

        private ShuffleBag<Character> bag;
        private List<Character> expectedValues = Arrays.asList('a', 'b', 'b', 'c', 'c', 'c');

        public ShuffleBag<Character> create() {
            bag = new ShuffleBag<Character>(new Random(123L));
            bag.addMany('a', 1);
            bag.addMany('b', 2);
            bag.addMany('c', 3);
            return bag;
        }

        public void allValuesAreReturnedTheSpecifiedNumberOfTimes() {
            List<Character> values = bag.getMany(6);
            specify(values, does.containExactly(expectedValues));
        }
    }

    public class AnEmptyShuffleBag {

        private ShuffleBag<Object> bag;

        public ShuffleBag<Object> create() {
            bag = new ShuffleBag<Object>();
            return bag;
        }

        public void canNotBeUsed() {
            specify(new jdave.Block() {
                public void run() throws Throwable {
                    bag.get();
                }
            }, should.raise(IllegalStateException.class));
        }
    }
} 
```

这是实现，如果您还想查看它：

```
import java.util.ArrayList;
import java.util.List;
import java.util.Random;

/**
 * @author Esko Luontola
 * @since 25.2.2008
 */
public class ShuffleBag<T> {

    private final Random random;

    /**
     * Unused values are in the range {@code 0 <= index < cursor}.
     * Used values are in the range {@code cursor <= index < values.size()}.
     */
    private final List<T> values = new ArrayList<T>();
    private int cursor = 0;

    public ShuffleBag() {
        this(new Random());
    }

    public ShuffleBag(Random random) {
        this.random = random;
    }

    public void add(T value) {
        values.add(value);
    }

    public T get() {
        if (values.size() == 0) {
            throw new IllegalStateException("bag is empty");
        }
        int grab = randomUnused();
        T value = values.get(grab);
        markAsUsed(grab);
        return value;
    }

    private int randomUnused() {
        if (cursor <= 0) {
            cursor = values.size();
        }
        return random.nextInt(cursor);
    }

    private void markAsUsed(int indexOfUsed) {
        cursor--;
        swap(values, indexOfUsed, cursor);
    }

    private static <T> void swap(List<T> list, int x, int y) {
        T tmp = list.get(x);
        list.set(x, list.get(y));
        list.set(y, tmp);
    }

    public void addMany(T value, int quantity) {
        for (int i = 0; i < quantity; i++) {
            add(value);
        }
    }

    public List<T> getMany(int quantity) {
        List<T> results = new ArrayList<T>(quantity);
        for (int i = 0; i < quantity; i++) {
            results.add(get());
        }
        return results;
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-11-23T20:49:26.153

无需测试随机性——这已经隐含在您选择的算法和随机数生成器中。使用 Fisher-Yates/Knuth 改组算法：

[http://en.wikipedia.org/wiki/Knuth_shuffle](http://en.wikipedia.org/wiki/Knuth_shuffle)

该 Wikipedia 页面中的 Java 实现：

```
public static void shuffle(int[] array) 
{
    Random rng = new Random();       // java.util.Random.
    int n = array.length;            // The number of items left to shuffle (loop invariant).
    while (n > 1) 
    {
        n--;                         // n is now the last pertinent index
        int k = rng.nextInt(n + 1);  // 0 <= k <= n.
        // Simple swap of variables
        int tmp = array[k];
        array[k] = array[n];
        array[n] = tmp;
    }
} 
```

# wpf - 最大化 WPF 不会更新宽度？

> ID：641323
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-03-13T03:01:09.777
> 
>         
> 
> 标签：wpf, resize, width, maximize, maximize-window

最大化窗口时，屏幕的`Width`属性似乎没有更新到完全最大化的宽度。如果我调整它的大小，一切正常，但在最大化时却不行。

我的代码如下：

```
private void Window_SizeChanged(object sender, SizeChangedEventArgs e)
{
    UpdateColumns();
}

private void button1_Click(object sender, RoutedEventArgs e)
{
    UpdateColumns();
}

private void UpdateColumns()
{
    ColumnCount = Math.Round(Width/150);
    statusBarItemColumnCount.Content = ColumnCount;
    button1.Content = ColumnCount + " " + Width;
}

private void Window_StateChanged(object sender, EventArgs e)
{
    UpdateColumns();
} 
```

* * *

## 回答 #1

> 赞同：15
> 
>             
> 
> 时间：2009-03-13T03:14:06.470

看看`ActualWidth`，而不是`Width`。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T03:15:12.413

尝试使用`ActualWidth`而不是`Width`，应该可以解决它

# erlang - Erlang 和其他语言的多核编程有什么区别？

> ID：641326
> 
>         
> 
> 赞同：18
> 
>         
> 
> 时间：2009-03-13T03:03:09.163
> 
>         
> 
> 标签：erlang, multicore

我阅读了 Joe Armstrong 的[“Programming Erlang”](https://rads.stackoverflow.com/amzn/click/com/193435600X)，以及“n 核机器中的 n 倍速度”理论。在 Erlang 中进行多核编程的有效方法是使用大量进程（线程）。

我是一名 C++ 程序员，所以我很好奇在 C++ 中创建大量线程和在 Erlang 中创建大量进程之间的区别。我知道在 C/C++ 中处理线程并不容易。我也知道锁定/解锁会使系统变慢。但这也不*是不可能*的，对吧？

那么.. 为什么 Erlang 是一种多核友好的语言？仅仅是因为它易于编程吗？

我正在为 MMORPG 制作在线游戏服务器，这就是我对 Erlang 作为替代服务器语言感兴趣的原因。

（我已经读过[这个](https://stackoverflow.com/questions/181284/functional-programming-and-multicore-architecture)问题，但我认为这不是我要找的问题。）

* * *

## 回答 #1

> 赞同：26
> 
>             
> 
> 时间：2009-03-13T08:57:49.547

它归结为*线程*与*进程*。

操作系统是专门设计的，因此每个“用户”都认为他们拥有整台计算机——这就是为什么你*以用户 wwwrun*的身份运行 apache。

程序员，作为程序员，开始重载这种范式，首先是每个人类用户运行多个“工作”。因为操作系统是为多个用户设计的，所以该架构的扩展上限反映了*登录用户*的扩展上限——这就是为什么 apache 将在 4,000 到 8,000 个用户时开始消亡的原因。

流程是一个成熟的范例（我的流程不会让你的流程崩溃）。但是，当我们开始看到线程的引入时，事情开始变得非常不同。在这里，我们的程序具有外部阻塞活动（在磁盘上等待、在 io 上等待、在内存上等待）希望能够一方面等待，另一方面工作，线程允许您这样做并克服两个问题：

*   您无法获得足够的进程，因为操作系统无法处理它

*   每个进程都很昂贵，因为在设计上，它为“用户”提供了操作系统的全部功能

线程的问题在于它们打破了进程设计的分离。我的线程可能会破坏您的线程 - 错误会传播。

Erlang 的不同之处在于许多方面。Joe Armstrong 的[博士论文](http://erlang.org/download/armstrong_thesis_2003.pdf)名为*“在存在软件错误的情况下制作可靠的分布式系统”*。

可靠性意味着进程优于线程。问题是操作系统进程太“昂贵”，因为它们是为人类（你拥有机器）设计的，而不是为程序的并发单元设计的。在 Erlang VM 中，VM 具有多用户系统的全部功能（它在操作系统进程中运行），每个 Erlang 进程的并发能力要小得多——如果它想使用“大机器”的话与为它做这件事的虚拟机交谈。所以 Erlang 进程比操作进程（和线程）便宜得多。你只是产卵，产卵，产卵。开箱即用的 Erlang VM 从 2**8 个进程开始，但您可以将其增加到数百万个（如果您有足够的 RAM）。

此外，正如乔在他的博士论文第一部分的第一部分所说的那样，要拥有可靠的软件，您需要从两台计算机开始。使用 Erlang/OTP，在*编写时*您不知道您的软件将在哪台计算机上运行。Erlang/OTP 集群在运行时会分配你的计算工作。因此，Erlang 进程是本地分布式的，spawn()（Erlang for fork()）和重启语义也是如此。

因为 Erlang 有自己的进程，所以它有自己的调度程序和自己的代码加载器/二进制格式（Erlang 可以解释或编译为本地二进制文件）。这会带来一系列额外的好处——在您编写 Erlang/OTP 应用程序之前，它已经可以将其二进制文件热交换出来，等等

因此，确保您可以使用 C++ 编写多线程应用程序 - 但您有责任防止错误传播和构建系统稳定性。

当然，您可以用 C 构建可靠的软件 - 看看 Erlang（VM 是用 C 编写的），重点是您为什么要这样做？在过去，公司编写自己的“操作系统”，您现在可以编写自己的操作系统，但您为什么要这样做？有数百万行健壮的测试代码“执行”，就像 Erlang/OTP 系统中有 150 万行健壮的测试代码“执行”一样。

使用 Erlang 就是使用其他人编写的东西，并且只构建使您的公司有效的部分。

* * *

## 回答 #2

> 赞同：15
> 
>             
> 
> 时间：2009-03-13T04:19:05.317

不，这不是不可能的，但是 Erlang 确实让它变得更容易了。关键是不在进程之间共享状态。Erlang 通过它是一种函数式语言来实现这一点。该函数应该没有副作用，也不应该访问任何变量状态（除了在堆栈上传递的参数）。有了这些属性，系统中任何函数的计算都可以转移到另一个具有单独内存空间的处理器上，而 Erlang 会为你做这件事。Erlang 只需要复制函数的参数和内存空间之间的结果（注意：这并不适合所有类型的应用程序......需要对非常大的输入状态进行操作的函数可能会表现出性能复制该状态时出现问题）。

在 C++ 应用程序中简单地使用线程可能有不同的处理器（在多核系统中）试图同时访问相同的共享内存。然后系统必须做很多工作来确保与每个核心关联的本地缓存保持一致。这是您可能遭受巨大性能损失的地方。由于这个原因，当您拥有多个内核时，我们有一个应用程序在工作时会降低性能。事实上，我什至会说你最好将你的应用程序设计为只使用你需要执行异步 I/O 的线程，但你需要让进程做真正的工作而不被阻塞I/O，使用完整的进程。通过使用完整进程，您可以保证每个进程都有自己的内存空间，并且没有两个线程会同时使用相同的内存（当然，然后，您需要想出一种在这些进程之间进行通信的好方法）。使用这样的系统以及围绕管理状态和分发处理的规则，您可以获得与 Erlang 提供的类似的结果，但是您必须做很多 Erlang 已经为您做的基础设施工作。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T05:30:50.807

上下文切换非常昂贵。Erlang 中没有。锁让传统程序开始思考接下来要执行哪个线程。这也是极其昂贵的。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T12:01:16.580

[Gordon Guthrie](https://stackoverflow.com/users/58594/gordon-guthrie)的[回答](https://stackoverflow.com/questions/641326/what-is-the-difference-between-multicore-programming-in-erlang-and-other-language/641873#641873)很棒。哪里有更大的差异是个人喜好。在我看来，Erlang 更大的不同在于可靠性和*偶然*的可扩展性。在 Erlang 中，您可以以自然的方式设计并发进程，而不会出现大的性能问题，这将是偶然的，可扩展的可分发的。大信息中存在陷阱，因此在大多数情况下，您的设计将是优雅的，并且无需特别注意即可运行良好。当你的设计优雅时，你犯的错误就会更少，它会更容易管理，顺便说一下，你可以用最少的努力进行分发和扩展，结果将是可靠的。

简而言之，在 Erlang 中，您可以设计与在 C++ 中不同的程序，因为您可以在没有大的性能问题的情况下做到这一点，并且无需付出很大的努力就能保证良好的可伸缩性和可靠性。没有人是完美的，但对于有趣的大量任务，Erlang 是最佳选择。

**编辑**：关于 Erlang 和 C++ 之间差异的精彩[介绍](http://www.erlang.se/euc/06/proceedings/1600Nystrom.ppt)- Erlang 的顶级性能提高了 2.5 倍，延迟降低了 3 倍，SLOC 降低了 18 倍 - 我假设摩托罗拉的开发人员在 C++ 方面的经验足以编写好的软件。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T03:17:37.990

好吧，具有只能设置一次变量的语言的性质以及它是一种函数式语言的事实会自动使具有大量并行性的程序能够以“正确的方式”编写和执行多核。

除了这两个事实之外，我对 erlang 了解不多，所以可能还有其他东西。但这并不是说您不能使 C++ 程序具有可扩展性，但您可能会经历很多事情来实现性能、可扩展性和稳定性，如果您使用 erlang 编写这些程序，这些都是免费的。

# null - 关于不可为空类型的争论

> ID：641328
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-03-13T03:05:02.967
> 
>         
> 
> 标签：null, d, access-violation, non-nullable, null-pointer

我不断听到人们谈论不可为空的引用类型如何解决如此多的错误并使编程变得如此容易。甚至 null 的创建者也称其为[十亿美元的错误](http://tinyurl.com/8wmgtt)，并且[Spec#](http://research.microsoft.com/en-us/projects/specsharp/)引入了不可为 null 的类型来解决这个问题。

***编辑：****忽略我对 Spec# 的评论。我误解了它是如何工作的。*

***编辑2：***我一定是在和错误的人说话，我真的希望有人与之争论:-)

* * *

所以我猜，作为少数派，我错了，但我不明白为什么这场辩论有任何价值。我认为 null 是一种查找错误的工具。考虑以下：

```
class Class { ... }

void main() {
    Class c = nullptr;
    // ... ... ... code ...
    for(int i = 0; i < c.count; ++i) { ... }
} 
```

砰！访问冲突。有人忘记初始化了`c`。

* * *

现在考虑一下：

```
class Class { ... }

void main() {
    Class c = new Class(); // set to new Class() by default
    // ... ... ... code ...
    for(int i = 0; i < c.count; ++i) { ... }
} 
```

哎呀。循环被静默地跳过。可能需要一段时间才能找到问题所在。

* * *

如果你的类是空的，那么代码无论如何都会失败。为什么不让系统告诉你（尽管有点粗鲁），而不必自己弄清楚呢？

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2009-09-20T20:13:47.463

Its a little odd that the response marked "answer" in this thread actually highlights the problem with null in the first place, namely:

> I've also found that most of my NULL
>   pointer errors revolve around
>   functions from forgetting to check the
>   return of the functions of string.h,
>   where NULL is used as an indicator.

Wouldn't it be nice if the compiler could catch these kinds of errors at compile time, instead of runtime?

If you've used an ML-like language (SML, OCaml, SML, and F# to some extent) or Haskell, reference types are non-nullable. Instead, you represent a "null" value by wrapping it an option type. In this way, you actually change the return type of a function if it can return null as a legal value. So, let's say I wanted to pull a user out of the database:

```
let findUser username =
    let recordset = executeQuery("select * from users where username = @username")
    if recordset.getCount() > 0 then
        let user = initUser(recordset)
        Some(user)
    else
        None 
```

Find user has the type `val findUser : string -> user option`, so the return type of the function actually tells you that it can return a null value. To consume the code, you need to handle both the Some and None cases:

```
match findUser "Juliet Thunderwitch" with
| Some x -> print_endline "Juliet exists in database"
| None -> print_endline "Juliet not in database" 
```

If you don't handle both cases, the code won't even compile. So the type-system guarantees that you'll never get a null-reference exception, and it guarantees that you always handle nulls. And if a function returns `user`, its guaranteed to be an actual instance of an object. Awesomeness.

Now we see the problem in the OP's sample code:

```
class Class { ... }

void main() {
    Class c = new Class(); // set to new Class() by default
    // ... ... ... code ...
    for(int i = 0; i < c.count; ++i) { ... }
} 
```

Initialized and uninitialized objects have the same datatype, you can't tell the difference between them. Occasionally, the [null object pattern](http://en.wikipedia.org/wiki/Null_Object_pattern) can be useful, but the code above demonstrates that the compiler has no way to determine whether you're using your types correctly.

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2009-03-17T00:17:01.897

我不明白你的例子。如果您的“= new Class()”只是一个占位符而不是没有 null，那么它（在我看来）显然是一个错误。如果不是，那么真正的错误是“...”没有正确设置其内容，这两种情况完全相同。

一个显示你忘记初始化 c 的异常会告诉你它在什么时候没有被初始化，但不是它应该在哪里被初始化。类似地，错过的循环将（隐式地）告诉您它需要在哪里有一个非零的 .count，而不是应该做什么或在哪里。我不认为这对程序员来说更容易。

我不认为“无空值”的意义在于简单地进行文本查找和替换并将它们全部变成空实例。这显然是没有用的。关键是要构造你的代码，使你的变量永远不会处于它们指向无用/不正确值的状态，其中 NULL 是最常见的。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T03:37:28.600

我承认我并没有真正阅读过很多关于 Spec# 的内容，但我知道 NonNullable 本质上是一个属性，您可以将其放在参数上，而不必放在变量声明上；把你的例子变成这样的东西：

```
class Class { ... }

void DoSomething(Class c)
{
    if (c == null) return;
    for(int i = 0; i < c.count; ++i) { ... }
}

void main() {
    Class c = nullptr;
    // ... ... ... code ...
    DoSomething(c);
} 
```

使用 Spec#，您将 doSomething 标记为“参数 c 不能为空”。这对我来说似乎是一个很好的特性，因为这意味着我不需要 DoSomething() 方法中的第一行（这是一个容易忘记的行，对 DoSomething() 的上下文完全没有意义）。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-04-13T19:56:09.590

非空类型的想法是让编译器而不是您的客户端发现错误。假设您在语言中添加了两个类型说明符 @nullable（可能为 null）和 @nonnull（从不为 null）（我使用的是 Java 注释语法）。

当你定义一个函数时，你注释它的参数。例如，下面的代码将编译

```
int f(@nullable Foo foo) {
  如果 (foo == null)
    返回0；
  返回 foo.size();
}
```

尽管 foo 在入口处可能为空，但控制流保证，当您调用 foo.size() 时，foo 是非空的。

但是如果你取消对 null 的检查，你会得到一个编译时错误。

以下内容也将编译，因为 foo 在条目中是非空的：

```
int g(@nonnull Foo foo) {
  返回 foo.size(); // 好的
}
```

但是，您将无法使用可空指针调用 g：

```
@nullable Foo foo;
g(foo); // 编译器错误！
```

编译器对每个函数进行流分析，因此它可以检测@nullable 何时变为@nonnull（例如，在检查 null 的 if 语句中）。如果它立即初始化，它还将接受 @nonnull 可验证定义。

```
@nonnull Foo foo = new Foo();
```

[在我的博客](http://bartoszmilewski.wordpress.com/2009/01/18/java-pluggable-types/)中有更多关于这个主题的内容。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-17T00:22:15.283

正如我所看到的，有两个使用 null 的区域。

首先是没有价值。例如，布尔值可以为真或假，或者用户尚未选择设置，因此为空。这是有用的，也是一件好事，但可能最初实施不正确，现在正试图将这种使用形式化。（应该有第二个布尔值来保存设置/取消设置状态，还是 null 作为三态逻辑的一部分？）

第二个是在空指针意义上。这通常是程序错误情况，即。一个例外。这不是预期的状态，存在程序错误。这应该在现代语言中实现的正式例外的保护范围内。也就是说，通过 try/catch 块捕获 NullException。

那么，您对其中的哪些感兴趣？

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-09-20T19:35:40.283

我目前正在用 C# 研究这个主题。.NET 对于值类型具有 Nullable，但对于引用类型不存在反向功能。

我为引用类型创建了 NotNullable，并将问题从 if（不再检查 null）转移到数据类型域。这使得应用程序在运行时而不是在编译时抛出异常。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2011-01-21T19:19:24.627

当我们处理域对象时，不可为空的类型对我来说更有意义。当您将数据库表映射到对象并且您有不可为空的列时。假设您有一个名为 User 的表，它的列 userid varchar(20) not nullable；

拥有一个具有不可为空的 UserId 字符串字段的 User 类会非常方便。您可以在编译时减少一些错误。

# c++ - 如何弄清楚从哪里加载程序数据？

> ID：641335
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T03:07:56.110
> 
>         
> 
> 标签：c++, linux, autotools

我有一个用 C++ 编写的项目（在 glibmm 的帮助下），我正在使用自动工具来管理它。我要问的问题是“我到底如何才能确定从哪里装载东西？”。虽然我可以在 autotools 上找到我想要的所有指南，但没有人回答这个问题。

例如，地图进入`$DATADIR/maps`（通常`/usr/[local/]share/myprogram/maps`.Autotools 会做正确的事情并将它们放在那里，但我怎么知道它是放在那里还是`$HOME/myprogram/maps`适当地加载它们（理想情况下它会`$PWD`先搜索，但这很容易）。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T03:27:31.057

您可以为您可能想要查看的各种自动配置位置将字符串构建到可执行文件中。这或多或少是 GCC 等程序所做的。

例如，我机器上的 GCC 4.3.3 在 /work5/tmp 下编译并配置为安装在 /usr/gcc/v4.3.3 中，它包含（以及许多其他）字符串：

```
/usr/ccs/bin/
/usr/ccs/lib/
/usr/gcc/v4.3.3
/usr/gcc/v4.3.3/bin/
/usr/gcc/v4.3.3/lib
/usr/gcc/v4.3.3/lib/gcc/
/usr/gcc/v4.3.3/libexec/gcc/
/usr/gcc/v4.3.3/share/locale
/usr/gnu/include
/usr/include
/usr/include/iso
/usr/include/sys
/usr/lib/
/usr/lib/ld.so.1
/usr/libexec/gcc/
/usr/local/share/bison
/usr/tmp
/var/tmp
/var/tmp/
/work5/tmp/gcc-4.3.3-obj/./prev-gcc/include
/work5/tmp/gcc-4.3.3-obj/gcc
/work5/tmp/gcc-4.3.3-obj/intl
/work5/tmp/gcc-4.3.3-obj/libiberty
/work5/tmp/gcc-4.3.3-obj/sparc-sun-solaris2.10/libgcc 
```

* * *

一条评论说：“这就是我想弄清楚该怎么做？”

有很多方法。部分答案是知道您需要哪些名称。如果查看自动配置输出，makefile 中有诸如 prefixdir 和 pkglibdir 之类的名称。您可以将它们添加到 C 编译器行：

```
DFLAG1 = -DPKGLIBDIR='"$(pkglibdir)"' 
```

并将 DFLAG1 添加到您的 CFLAGS。重复恶心...

然后，程序中的代码可以执行以下操作：

```
static const char *libdirs_to_search[] =
{
    ...
#ifdef PKGLIBDIR
    PKGLIBDIR,
#endif /* PKGLIBDIR */
}; 
```

更简洁的方法是修改生成的 config.h 文件和配置代码，以便您感兴趣的目录定义在 config.h 文件中，而不是在 makefile 中。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-18T01:23:05.483

Jonathan Leffler 的回答很有帮助（他为我提供了足够的信息来获取源代码进化并找到我需要做的事情），但它并没有完全回答我的问题，所以我将在这里发布完整的解决方案：

在configure.ac（或configure.in，无论如何）中，我在最后添加了以下几行：

```
# Defines so we know where to look
privdatadir='${datadir}'/myprogram
AC_SUBST(privdatadir)

mapsdir='${privdatadir}'/maps
AC_SUBST(mapsdir) 
```

在 src/Makefile.am 中，添加了以下内容：

```
AM_CXXFLAGS = -DMYPROGRAM_MAPSDIR=\"$(mapsdir)\" 
```

在实际的 C++ 代码中，使用了以下代码：

```
const std::string file_directory (MYPROGRAM_MAPSDIR); // Defined in Makefile.am 
```

再次感谢乔纳森告诉我在哪里看，但我想为后代发布完整的答案。

# java - 如何从struts bean中获取价值？

> ID：641338
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T03:08:46.827
> 
>         
> 
> 标签：java, jsp, servlets, struts

我是新来的struts。我只是想构建一个简单的应用程序来获取用户的输入并显示它。为此，我从用户那里获得了输入并将其存储在一个 bean 中，并且我还使用 bean:write 在下一页中显示了它，但如何将它放在文本框中。我尝试使用 html:text 但我不知道如何将值放入其中。

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T04:19:23.367

设置要在请求属性中显示的属性或 bean，并在最后一页中从中获取值：

在文本框中插入值的语法是

```
<html:text property="propertyName" value="value"></html:text/> 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T12:00:11.887

如果你想把它放在一个文本框中，我想你可能想试试  [textfield 标签](http://struts.apache.org/2.0.14/docs/textfield.html)

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T06:25:19.380

您需要用 html:form 包装 html:text。html:form 的 action 属性将指向 struts-config.xml 中定义的动作。这个动作将与一个表单 bean 相关联，您在其中存储了您正在谈论的值。然后在 html:text 中像这样引用该属性

<html:text property="存储值的属性名"/>

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-07-17T08:24:20.007

您可以使用“”直接从bean中获取属性的值。前任：

```
<bean:write name="user" property="username" />
Replace by this:
<html:text name="user" property="username" style="width:150" maxlength="20"/>

In that:
name - is the bean object name
property - is the property of the bean object 
```

祝你好运！

# django - Django Admin SelectMultiple 小部件

> ID：641358
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T03:21:08.920
> 
>         
> 
> 标签：django, django-admin

在我的模型中，我在 2 个表用户和组之间有多对多的关系。在管理界面中，我看到了 Groups 的 SelectMultiple 小部件。实际上，我使用的是 filter_horizo​​ntal，我在 2 个单独的列表中看到可用组和选定组。是否可以过滤我可以看到的可用组列表（基于某些标准）。我不想在组表中显示所有组。谢谢

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T08:08:17.980

在您的表单类中，您可以为组字段指定自定义查询集，然后确定哪些组实例在表单中可用：

```
class UserForm(forms.ModelForm):
    # override the default groups field
    groups = forms.ModelMultipleChoiceField(
        queryset=Groups.objects.filter(YOUR_CONDITIONS),
        widget=forms.SelectMultiple,
    )

    class Meta:
        model = User 
```

# macos - 使用 Apple 的 PackageMaker 设置一次性安装程序

> ID：641359
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T03:21:46.327
> 
>         
> 
> 标签：macos, packagemaker

我是这方面的新手，所以我将解释到目前为止我做了什么：

1.  打开`PackageMaker`并将我`MyApp`的 from拖到`/Applications`左侧边栏中  

2.  将 MyApp 的所有者/组更改为 root/admin 和`rwxrwxr-x`

3.  创建一个`postinstall`shell 脚本并在 Scripts 选项卡中选择它

那么现在，如何添加我只想运行 1 次（首次安装时）的可执行文件（Adobe AIR 安装程序）？我是否也将其拖到左侧边栏中？我试过这样做，但它给了它一个`/Applications`我不想要的目的地。我希望将其提取到临时位置，安装并删除。另外，我如何从 shell 脚本中引用它？我会使用`open`命令来运行它吗？希望这是有道理的...

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-14T23:27:56.150

您应该能够将它添加到您的包资源文件夹中，然后使用您的 shell 脚本运行它：

```
open -a /path/to/the/air/installer.app 
```

# c# - Base32 解码

> ID：641361
> 
>         
> 
> 赞同：42
> 
>         
> 
> 时间：2009-03-13T03:23:09.070
> 
>         
> 
> 标签：c#, .net, base32

我有一个 base32 字符串，需要将其转换为字节数组。而且我在 .NET 框架中找不到转换方法。我可以找到 base64 的方法，但找不到 base32 的方法。

`Convert.FromBase64String`– 像这样的 base32 将是完美的。

框架中有这样的方法还是我必须自己动手？

* * *

## 回答 #1

> 赞同：123
> 
>             
> 
> 时间：2011-08-20T22:07:53.860

我需要一个 base32 编码器/解码器，所以今天下午我花了几个小时把它放在一起。我相信它符合此处列出的标准：[https](https://www.rfc-editor.org/rfc/rfc4648#section-6) ://www.rfc-editor.org/rfc/rfc4648#section-6 。

```
public class Base32Encoding
{
    public static byte[] ToBytes(string input)
    {
        if (string.IsNullOrEmpty(input))
        {
            throw new ArgumentNullException("input");
        }

        input = input.TrimEnd('='); //remove padding characters
        int byteCount = input.Length * 5 / 8; //this must be TRUNCATED
        byte[] returnArray = new byte[byteCount];

        byte curByte = 0, bitsRemaining = 8;
        int mask = 0, arrayIndex = 0;

        foreach (char c in input)
        {
            int cValue = CharToValue(c);

            if (bitsRemaining > 5)
            {
                mask = cValue << (bitsRemaining - 5);
                curByte = (byte)(curByte | mask);
                bitsRemaining -= 5;
            }
            else
            {
                mask = cValue >> (5 - bitsRemaining);
                curByte = (byte)(curByte | mask);
                returnArray[arrayIndex++] = curByte;
                curByte = (byte)(cValue << (3 + bitsRemaining));
                bitsRemaining += 3;
            }
        }

        //if we didn't end with a full byte
        if (arrayIndex != byteCount)
        {
            returnArray[arrayIndex] = curByte;
        }

        return returnArray;
    }

    public static string ToString(byte[] input)
    {
        if (input == null || input.Length == 0)
        {
            throw new ArgumentNullException("input");
        }

        int charCount = (int)Math.Ceiling(input.Length / 5d) * 8;
        char[] returnArray = new char[charCount];

        byte nextChar = 0, bitsRemaining = 5;
        int arrayIndex = 0;

        foreach (byte b in input)
        {
            nextChar = (byte)(nextChar | (b >> (8 - bitsRemaining)));
            returnArray[arrayIndex++] = ValueToChar(nextChar);

            if (bitsRemaining < 4)
            {
                nextChar = (byte)((b >> (3 - bitsRemaining)) & 31);
                returnArray[arrayIndex++] = ValueToChar(nextChar);
                bitsRemaining += 5;
            }

            bitsRemaining -= 3;
            nextChar = (byte)((b << bitsRemaining) & 31);
        }

        //if we didn't end with a full char
        if (arrayIndex != charCount)
        {
            returnArray[arrayIndex++] = ValueToChar(nextChar);
            while (arrayIndex != charCount) returnArray[arrayIndex++] = '='; //padding
        }

        return new string(returnArray);
    }

    private static int CharToValue(char c)
    {
        int value = (int)c;

        //65-90 == uppercase letters
        if (value < 91 && value > 64)
        {
            return value - 65;
        }
        //50-55 == numbers 2-7
        if (value < 56 && value > 49)
        {
            return value - 24;
        }
        //97-122 == lowercase letters
        if (value < 123 && value > 96)
        {
            return value - 97;
        }

        throw new ArgumentException("Character is not a Base32 character.", "c");
    }

    private static char ValueToChar(byte b)
    {
        if (b < 26)
        {
            return (char)(b + 65);
        }

        if (b < 32)
        {
            return (char)(b + 24);
        }

        throw new ArgumentException("Byte is not a value Base32 value.", "b");
    }

} 
```

* * *

## 回答 #2

> 赞同：15
> 
>             
> 
> 时间：2009-03-13T04:13:12.943

检查这里[的](http://www.atrevido.net/blog/PermaLink.aspx?guid=debdd47c-9d15-4a2f-a796-99b0449aa8af)`FromBase32String`.NET 实现。

* * *

编辑：以上链接已失效；[您可以在archive.org](https://web.archive.org/web/20060422042142/http://www.atrevido.net/blog/PermaLink.aspx?guid=debdd47c-9d15-4a2f-a796-99b0449aa8af)找到存档副本

实际代码如下：

```
using System;
using System.Text;

public sealed class Base32 {

      // the valid chars for the encoding
      private static string ValidChars = "QAZ2WSX3" + "EDC4RFV5" + "TGB6YHN7" + "UJM8K9LP";

      /// <summary>
      /// Converts an array of bytes to a Base32-k string.
      /// </summary>
      public static string ToBase32String(byte[] bytes) {
            StringBuilder sb = new StringBuilder();         // holds the base32 chars
            byte index;
            int hi = 5;
            int currentByte = 0;

            while (currentByte < bytes.Length) {
                  // do we need to use the next byte?
                  if (hi > 8) {
                        // get the last piece from the current byte, shift it to the right
                        // and increment the byte counter
                        index = (byte)(bytes[currentByte++] >> (hi - 5));
                        if (currentByte != bytes.Length) {
                              // if we are not at the end, get the first piece from
                              // the next byte, clear it and shift it to the left
                              index = (byte)(((byte)(bytes[currentByte] << (16 - hi)) >> 3) | index);
                        }

                        hi -= 3;
                  } else if(hi == 8) { 
                        index = (byte)(bytes[currentByte++] >> 3);
                        hi -= 3; 
                  } else {

                        // simply get the stuff from the current byte
                        index = (byte)((byte)(bytes[currentByte] << (8 - hi)) >> 3);
                        hi += 5;
                  }

                  sb.Append(ValidChars[index]);
            }

            return sb.ToString();
      }

      /// <summary>
      /// Converts a Base32-k string into an array of bytes.
      /// </summary>
      /// <exception cref="System.ArgumentException">
      /// Input string <paramref name="s">s</paramref> contains invalid Base32-k characters.
      /// </exception>
      public static byte[] FromBase32String(string str) {
            int numBytes = str.Length * 5 / 8;
            byte[] bytes = new Byte[numBytes];

            // all UPPERCASE chars
            str = str.ToUpper();

            int bit_buffer;
            int currentCharIndex;
            int bits_in_buffer;

            if (str.Length < 3) {
                  bytes[0] = (byte)(ValidChars.IndexOf(str[0]) | ValidChars.IndexOf(str[1]) << 5);
                  return bytes;
            }

            bit_buffer = (ValidChars.IndexOf(str[0]) | ValidChars.IndexOf(str[1]) << 5);
            bits_in_buffer = 10;
            currentCharIndex = 2;
            for (int i = 0; i < bytes.Length; i++) {
                  bytes[i] = (byte)bit_buffer;
                  bit_buffer >>= 8;
                  bits_in_buffer -= 8;
                  while (bits_in_buffer < 8 && currentCharIndex < str.Length) {
                        bit_buffer |= ValidChars.IndexOf(str[currentCharIndex++]) << bits_in_buffer;
                        bits_in_buffer += 5;
                  }
            }

            return bytes;
      }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
>             
> 
> 时间：2017-02-14T16:13:35.120

这是我的编码和解码功能。我觉得它们比其他建议更短更简洁。所以如果你需要一个小的，试试这些。

```
public static string BytesToBase32(byte[] bytes) {
    const string alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
    string output = "";
    for (int bitIndex = 0; bitIndex < bytes.Length * 8; bitIndex += 5) {
        int dualbyte = bytes[bitIndex / 8] << 8;
        if (bitIndex / 8 + 1 < bytes.Length)
            dualbyte |= bytes[bitIndex / 8 + 1];
        dualbyte = 0x1f & (dualbyte >> (16 - bitIndex % 8 - 5));
        output += alphabet[dualbyte];
    }

    return output;
}

public static byte[] Base32ToBytes(string base32) {
    const string alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
    List<byte> output = new List<byte>();
    char[] bytes = base32.ToCharArray();
    for (int bitIndex = 0; bitIndex < base32.Length * 5; bitIndex += 8) {
        int dualbyte = alphabet.IndexOf(bytes[bitIndex / 5]) << 10;
        if (bitIndex / 5 + 1 < bytes.Length)
            dualbyte |= alphabet.IndexOf(bytes[bitIndex / 5 + 1]) << 5;
        if (bitIndex / 5 + 2 < bytes.Length)
            dualbyte |= alphabet.IndexOf(bytes[bitIndex / 5 + 2]);

        dualbyte = 0xff & (dualbyte >> (15 - bitIndex % 5 - 8));
        output.Add((byte)(dualbyte));
    }
    return output.ToArray();
} 
```

* * *

## 回答 #4

> 赞同：6
> 
>             
> 
> 时间：2019-03-05T22:28:37.550

这是一个非常古老的问题，但我碰巧偶然发现它想要 OTP 令牌同样的东西。事实证明，NuGet 上的 OTP.NET 包中内置了 base 32 功能：

```
Base32Encoding.ToBytes("(your base 32 string here)") 
```

反过来也是可能的：

```
Base32Encoding.ToString(new byte[] { /* your bytes here */ }) 
```

* * *

## 回答 #5

> 赞同：5
> 
>             
> 
> 时间：2010-05-02T12:00:14.240

我已经编写了一些基于灵活标准的各种 Base32 和 Base64 编码/解码方法的实现。值得注意的是：base64url（根据 rfc4648）及其 base32 等效项。

默认情况下，Base32Url 类仅使用字符 A 到 Z 和 2 到 7 进行编码。不使用连字符、下划线、加号、斜线或等号，使其在几乎所有情况下都可用作 URL 标记。Base32Url 还支持自定义字母、区分大小写/不区分大小写、填充/无填充等。

[这张贴在代码项目上。](http://www.codeproject.com/Tips/76650/Base32-base32url-base64url-and-z-base-32-encoding-.aspx)

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:51:32.993

这是我快速记下的解决方案。它仅适用于 8 个 base32 字符的倍数的字符串。不过确实有效。

```
public class Base32
{
  /// <summary>
  /// Decode a Base32 string
  /// This will only work on a multiple of 40 bits (5 bytes)
  /// http://www.garykessler.net/library/base64.html
  /// </summary>
  public static byte[] Decode(string Base32String)
  {
    // Ignore hyphens
    string str = Base32String.Replace("-", "");

    // Convert it to bits
    List<byte> bits = new List<byte>();
    foreach (char c in str)
    {
      int i = CharToValue(c);
      bits.Add((byte)((i & 16) > 0 ? 1 : 0));
      bits.Add((byte)((i & 8) > 0 ? 1 : 0));
      bits.Add((byte)((i & 4) > 0 ? 1 : 0));
      bits.Add((byte)((i & 2) > 0 ? 1 : 0));
      bits.Add((byte)((i & 1) > 0 ? 1 : 0));
    }

    // Convert bits into bytes
    List<byte> bytes = new List<byte>();
    for (int i = 0; i < bits.Count; i += 8)
    {
      bytes.Add((byte)(
        (bits[i + 0] << 7) +
        (bits[i + 1] << 6) +
        (bits[i + 2] << 5) +
        (bits[i + 3] << 4) +
        (bits[i + 4] << 3) +
        (bits[i + 5] << 2) +
        (bits[i + 6] << 1) +
        (bits[i + 7] << 0)));
    }

    return bytes.ToArray();
  }

  static int CharToValue(char c)
  {
    char cl = char.ToLower(c);
    if (cl == 'a') return 0;
    if (cl == 'b') return 1;
    if (cl == 'c') return 2;
    if (cl == 'd') return 3;
    if (cl == 'e') return 4;
    if (cl == 'f') return 5;
    if (cl == 'g') return 6;
    if (cl == 'h') return 7;
    if (cl == 'i') return 8;
    if (cl == 'j') return 9;
    if (cl == 'k') return 10;
    if (cl == 'l') return 11;
    if (cl == 'm') return 12;
    if (cl == 'n') return 13;
    if (cl == 'o') return 14;
    if (cl == 'p') return 15;
    if (cl == 'q') return 16;
    if (cl == 'r') return 17;
    if (cl == 's') return 18;
    if (cl == 't') return 19;
    if (cl == 'u') return 20;
    if (cl == 'v') return 21;
    if (cl == 'w') return 22;
    if (cl == 'x') return 23;
    if (cl == 'y') return 24;
    if (cl == 'z') return 25;
    if (cl == '2') return 26;
    if (cl == '3') return 27;
    if (cl == '4') return 28;
    if (cl == '5') return 29;
    if (cl == '6') return 30;
    if (cl == '7') return 31;
    throw new Exception("Not a base32 string");
  }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2011-11-25T14:05:05.593

我已经为 VB.NET 提出了我自己的通用 Base32 编码器/解码器实现。我已经通过独立网站验证了结果，因此它看起来确实非常准确。

任何关于如何改进代码的评论都将受到欢迎。

```
Option Compare Text
Imports System.ComponentModel

Public Structure Base32(Of T)

        Private Const csValidStandardBase32Chars As String = "0123456789ABCDEFGHIJKLMNOPQRSTUV"

        <EditorBrowsable(EditorBrowsableState.Never)> _
        Class Base32Nibble

                <EditorBrowsable(EditorBrowsableState.Never)> _
                Friend mStore As New BitArray(5, False)

                Public ReadOnly Property Value As Byte
                        Get
                                Dim result As Byte = 0
                                For index As Byte = 0 To mStore.Count - 1
                                        If mStore(index) Then
                                                result += (2 ^ index)
                                        End If
                                Next
                                Return result
                        End Get
                End Property

                Public Overrides Function ToString() As String
                        Dim nibbleString As String = Nothing
                        For Each bit As Boolean In mStore
                                nibbleString = Math.Abs(CInt(bit)).ToString() & nibbleString
                        Next
                        Return nibbleString
                End Function

        End Class

        Private Shared mNibbles As List(Of Base32Nibble)

        Public ReadOnly Property Count As Long
                Get
                        Return mNibbles.Count
                End Get
        End Property

        Default Public ReadOnly Property Item(ByVal index As Integer) As Base32Nibble
                Get
                        Return DirectCast(mNibbles(index), Base32Nibble)
                End Get
        End Property

        Public Sub New(ByVal Value As T)
                Dim temp As Object = CType(Value, T)
                getNibbles(BitConverter.GetBytes(temp))
        End Sub

        Public Sub New(ByVal Value As Byte())
                getNibbles(Value)
        End Sub

        Public Shared Widening Operator CType(ByVal Value As T) As Base32(Of T)
                Return New Base32(Of T)(Value)
        End Operator

        Public Shared Widening Operator CType(ByVal Value As Byte()) As Base32(Of T)
                Return New Base32(Of T)(Value)
        End Operator

        Public ReadOnly Property Value As String
                Get
                        Dim result As String = Nothing
                        For Each Nib As Base32(Of T).Base32Nibble In mNibbles
                                result = csValidStandardBase32Chars(Nib.Value) & result
                        Next
                        Return result.TrimStart("0")
                End Get
        End Property

        Public Function ToNumeric(ByVal Base32String As String) As T
                Dim result As T = CType(CType(0, Object), T)
                Try
                        If Base32String.Trim.Length > 0 Then
                                Dim pos As Integer = 0
                                Do
                                        Dim temp As Object = getBase32Value(Base32String, pos)
                                        result = result + temp
                                        pos += 1
                                Loop While (pos < Base32String.Length)
                        End If
                Catch ex As Exception
                        ' Catch overflow errors if the generic type T doesn't have enough
                        ' room to store the result
                        System.Diagnostics.Debug.Print(ex.Message)
                End Try
                Return result
        End Function

        Private Shared Sub getNibbles(ByVal Value As Byte())

                Dim valueBytes As New BitArray(Value)
                Dim nib As Base32Nibble = Nothing

                mNibbles = New List(Of Base32Nibble)

                Dim padding As Byte = (1 - (valueBytes.Length / 5 - (valueBytes.Length \ 5))) * 5
                valueBytes.Length = valueBytes.Length + padding

                For element As Short = 0 To valueBytes.Count - 1
                        If (element Mod 5 = 0) Then
                                nib = New Base32Nibble()
                                mNibbles.Add(nib)
                        End If
                        nib.mStore.Item(element Mod 5) = valueBytes.Item(element)
                Next

        End Sub

        Private Function getBase32Char(ByVal InputString As String, ByVal InputPosition As Integer) As String
                Return csValidStandardBase32Chars.IndexOf(Mid(InputString, InputPosition + 1, 1))
        End Function

        Private Function getBase32Value(ByVal InputString As String, ByVal InputPosition As Integer) As T
                Return CType(CType((getBase32Char(InputString, InputPosition) * (32 ^ (InputString.Length - 1 - InputPosition))), Object), T)
        End Function

End Structure 
```

这是将 123456789 转换为 Base32 的示例

```
Dim value As Base32(Of Int64) = 123456789
Console.WriteLine( "123456789 in Base32 = " & value.Value) 
```

# asp.net - Asp.net 网格视图

> ID：641363
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T03:24:02.517
> 
>         
> 
> 标签：asp.net, vb.net, view, grid

如何将 sql 2005 数据库中的 NULL 字段 [日期输出] 检索到 ASP.Net 中的网格视图。我需要用户编辑此字段。

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-15T08:20:56.990

我不确定 ASP.NET GridView 是否支持绑定到可为空的日期时间字段，但是在我目前开发的一个项目中，我使用 Telerik 网格及其内置的 GridDateTimeColumn，它支持绑定到开箱即用的可为空的日期时间。如果您有兴趣，请查看Telerik 网站上的[这个演示。](http://demos.telerik.com/aspnet-ajax/grid/examples/generalfeatures/columntypes/defaultcs.aspx)

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2010-01-07T06:24:26.233

遍历您的数据表或列表，并手动将所有空值设置为空字符串，这应该可以工作。

# c# - 在 C# 中重用事件处理程序的良好实践

> ID：641365
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T03:24:49.957
> 
>         
> 
> 标签：c#, .net

在我当前的项目中，我在不同的选项卡中使用了四个网格视图。随着系统的发展，它们有一些共享的方法，例如显示自定义工具提示和在行上时的右键单击菜单。

我现在正在进行代码清理练习。我在下面看到的是我现在有四个事件处理程序调用相同的方法。是否可以将事件处理程序全部更改为直接指向 GridMenu，避免额外的代码？这会在以后的开发中给我带来问题吗？

显然，目前我正在使用默认的偶数处理程序名称。

```
private void grdEnquiriesLevel1_ShowGridMenu(object sender, GridMenuEventArgs e)
    {
        GridMenu(sender, e);
    }

    private void grdApplicantsLevel1_ShowGridMenu(object sender, GridMenuEventArgs e)
    {
        GridMenu(sender, e);
    }

    private void grdApplicationsLevel1_ShowGridMenu(object sender, GridMenuEventArgs e)
    {
        GridMenu(sender, e);
    }

    private void grdInterviewsLevel1_ShowGridMenu(object sender, GridMenuEventArgs e)
    {
        GridMenu(sender, e);
    }

    private void GridMenu(object sender, GridMenuEventArgs e)
    {
        GridView view = (GridView)sender;

        if (view.CalcHitInfo(e.Point).InRow)
            popupMenu1.ShowPopup(Cursor.Position);
    } 
```

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2009-03-13T03:29:48.930

与其直接注册到`GridMenu`，不如创建一个名为 的通用事件处理程序`Grid_ShowGridMenu`。

只需为每个网格注册到相同的事件处理程序，而不是为每个网格创建单独的事件处理程序。

```
grdEnquiriesLevel1.ShowGridMenu += Grid_ShowGridMenu;
grdApplicantsLevel1.ShowGridMenu += Grid_ShowGridMenu;
grdApplicationsLevel1.ShowGridMenu += Grid_ShowGridMenu;
grdInterviewsLevel1.ShowGridMenu += Grid_ShowGridMenu;

private void Grid_ShowGridMenu(object sender, GridMenuEventArgs e)
{
    GridMenu((GridView)sender, e.Point); 
} 
```

现在，与其`sender, e`直接传递给`GridMenu`，不如只传递*必要*的值`GridMenu`并更改 的签名，`GridMenu`这样它就可以更*可重用*。

```
private void GridMenu(GridView grid, Point hitPoint) 
{
    if (grid.CalcHitInfo(hitPoint).InRow)
        popupMenu1.ShowPopup(Cursor.Position);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T03:28:24.783

只要事件代码对于所有控件都是通用的，那么这个方法就很好而且很干净。

如果您开始在代码中使用主要的 if/else 或 switch 块，那么也许是时候重新考虑一下了。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T04:16:34.620

您应该制作一个封装自定义网格的用户控件。这样，您的所有行为都将被封装和可重用。

# file - 最快的 Sha1 函数（Linux，最多 2GB 文件）

> ID：641368
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T03:25:39.937
> 
>         
> 
> 标签：file, hash, cryptography, sha1, performance

是否有任何 linux 命令行实现在大文件（< 2GB）上生成 sha1 时表现非常出色？

我玩过“openssl sha1”，需要几分钟才能获得 2GB 文件的 sha1：/.

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-03-13T03:50:00.237

在我的机器上，对于一个 1GB 的文件，有足够的内存在第一次运行后将整个文件缓存在内存中：

```
sha1sum: 3.92s
openssl sha1: 3.48s
python hashlib.sha1: 3.22s 
```

> 获取 2GB 文件的 sha1 需要几分钟

那里有问题，除非你使用非常慢的旧硬件。即使在第一次运行时，文件是直接从磁盘读取的，在我的机器上每次演出只需要“openssl sha1”大约 20 秒。您是否普遍存在 I/O 缓慢问题？

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-03-20T20:27:12.023

我不认为 SHA 算法可以针对大小进行优化，因为它在固定大小的块上运行，并且计算不能并行完成。似乎小文件上最快的实现也将是大文件上最快的。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T03:38:34.883

您的问题可能是磁盘 I/O。旧的 2.0GHz Core Duo 处理器上的基本 SHA1 实现可以以 100MiB/s 的速度处理 /dev/zero - 比通常与此类系统配对的大多数硬盘驱动器更快。

向我们展示您当前看到的速度（以及在什么规格的硬件上）。

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2012-01-18T17:50:43.293

如果您不是特别需要 sha1 但正在寻找对大文件进行校验和，则 Sha512sum 对于大文件会更快，因为它会读取更大的块

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T03:30:02.267

`sha1sum`是我用来计算 SHA-1 校验和的东西……它被设计成只做一件事，所以我希望它尽可能快地完成它。不过，我没有任何 2GB 文件可以对其进行基准测试:-(

*编辑*：在对 ISO 映像进行一些测试之后，我的系统上的限制因素似乎是磁盘 I/O 速度——这并不奇怪，尽管我觉得之前没有想到这一点有点傻。一旦纠正，似乎openssl的速度大约是sha1sum的两倍......

# c# - 如何将字符串转换为“函数签名”以创建委托？

> ID：641373
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T03:28:15.733
> 
>         
> 
> 标签：c#, delegates

我正在尝试将方法的名称从一个类传递给另一个类，因此另一个类可以“订阅”她到第一个类不知道的事件。假设我有这些课程：

```
class1
{
  public void method1(string msg)
  {
    //does something with msg
  }

  public void i_make_a_class2()
  {
    class2 bob = new class2(method1);
  }
}

class2
{
  delegate void deleg(string msg);
  deleg deleg1;

  public class2(string fct)
  {
    // What I'm trying to do would go there with "fct" converted to function signature
    deleg1 = new deleg(fct);
    // Rest of the class constructor...
  }
  private void method2()
  {
    deleg1(im_a_String);
  }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T03:58:59.843

你真的不想传递函数的名称——你想传递委托函数本身——这是委托的关键。给我一分钟，我会按照你想要的方式编写代码。

干得好：

```
public delegate void deleg(string msg);

public class class1
{
  public void method1(string msg)
  {
    //does something with msg
  }

  public void i_make_a_class2()
  {
    class2 bob = new class2(method1);
  }
}

public class class2
{
  deleg deleg1;
  string im_a_String = "Test";

  public class2(deleg fct)
  {
    deleg1 = fct;
    // Rest of the class constructor...
  }
  private void method2()
  {
    deleg1(im_a_String);
  }
} 
```

# java - 从 JBoss 应用程序服务器连接到 DB2 时出错

> ID：641387
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T03:37:57.677
> 
>         
> 
> 标签：java, jboss, db2, ibm-midrange

我正在尝试从托管在 JBoss 应用程序服务器中的 Java 应用程序连接到 AS400 数据库 DB2。但是，当我运行我的应用程序时，我会收到以下错误：

**显然为 URL 指定了错误的驱动程序类：class: com.ibm.as400.access.AS400JDBCDriver, url: jdbc:as400://DBSYTEM;driver=toolbox;trace=false;errors=full;prefetch=true;naming=system;图书馆=*LIBL**

以前有没有人遇到过类似的问题？

谢谢，

维拉。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-09-22T17:27:26.703

我有完全相同的问题。

如下设置connection-url解决了这个问题。jdbc:as400://[systemname]/[schema];extended dynamic=true;package=jbpkg;package cache=true;package library=jboss;errors=full

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T05:29:19.767

从您问题中的连接 URL 来看，我认为您在 AS/400 上使用 DB2。

您是否验证了 IBM DB2 for AS/400 JDBC 驱动程序的正确类路径的存在？JBoss Application Server 不提供 IBM DB2 for AS/400 的 JDBC 驱动程序，它仅由 IBM 提供。

# java - 我可以用过滤器指定休眠关系吗？

> ID：641388
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T03:38:04.527
> 
>         
> 
> 标签：java, hibernate, filter, mapping

我有一个与许多酒吧有关的 foo。

当我删除系统中的栏时，出于某种疯狂的商业原因，我想将它们保留在数据库中，所以我只是将删除的字段设置为 true。

我可以在我的休眠映射中指定我只希望我的集合包含该字段为假的元素吗？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T06:04:48.650

您还可以使用 SQL 语句将内容排除在外，使用**where**属性： 设置关系的休眠映射文件的示例位：

```
<set name="specialConditions" cascade="none" order-by="sortOrder, Text1" 
  where="Discriminator in ( 'SPECIAL-CURF-AGREEMENT' ) and active = 'Y'" 
  sort="unsorted" inverse="false" mutable="true" optimistic-lock="true" 
  embed-xml="true">    
  <key column="parentID" not-null="false" on-delete="noaction" /> 
  <one-to-many class="au.gov.abs.maserati.domain.entity.Condition" not-found="exception" embed-xml="true" /> 
</set> 
```

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T05:55:42.417

Hibernate 提供了[过滤器](http://www.hibernate.org/hib_docs/reference/en/html/filters.html)来实现这一点。

示例豆类：

```
public class Foo {
    private Long id;
    private String text;
    private Set<Bar> bars = new HashSet<Bar>();    
    // constructors, getters, setters
}

public class Bar {
    private Long id;
    private boolean deleted;
    private String text;
    // constructors, getters, setters
} 
```

示例映射**注意：`filter`元素**

```
<hibernate-mapping package="org.nkl.hib">
  <class name="Foo">
    <id name="id" column="FOO_ID">
      <generator class="sequence" />
    </id>
    <property name="text" />
    <set name="bars" cascade="all" fetch="join">
      <key column="FOO_ID" />
      <one-to-many class="Bar" />
      <filter name="deleted" condition=":deleted = deleted" />
    </set>
  </class>
  <filter-def name="deleted">
    <filter-param name="deleted" type="boolean" />
  </filter-def>
</hibernate-mapping>

<hibernate-mapping package="org.nkl.hib">
  <class name="Bar">
    <id name="id" column="BAR_ID">
      <generator class="sequence" />
    </id>
    <property name="text" />
    <property name="deleted" />
  </class>
</hibernate-mapping> 
```

示例单元测试：

```
public class FooBarTest {

    private static SessionFactory sessionFactory;

    @AfterClass
    public static void closeSessionFactory() {
        sessionFactory.close();
    }

    @BeforeClass
    public static void setupSessionFactory() {
        Configuration configuration = new Configuration();
        configuration.configure();
        sessionFactory = configuration.buildSessionFactory();
    }

    @Test
    public void testBarFilter() {
        doInTransaction(new Command() {
            public void execute(Session session) {
                Foo foo = new Foo("foo");
                foo.addBar(new Bar("bar1"));
                foo.addBar(new Bar("bar2"));
                foo.addBar(new Bar("bar3"));
                session.save(foo);
            }
        });

        doInTransaction(new Command() {
            public void execute(Session session) {
                Bar bar = (Bar) session.createQuery(
                        "from Bar b where b.text = 'bar2'").
                        uniqueResult();
                bar.setDeleted(true);
                session.update(bar);
            }
        });

        doInTransaction(new Command() {
            public void execute(Session session) {
                session.enableFilter("deleted").
                        setParameter("deleted", Boolean.FALSE);
                Foo foo = (Foo) session.createQuery("from Foo").
                        uniqueResult();
                assertEquals(2, foo.getBars().size());
            }
        });
    }

    private void doInTransaction(Command command) {
        Session session = sessionFactory.openSession();
        Transaction tx = session.beginTransaction();
        command.execute(session);
        tx.commit();
        session.close();
    }
}

interface Command {
    public void execute(Session session);
} 
```

# delphi - Delphi - 设置字符串和 PAnsiChar 以及其他字符串不显示的问题

> ID：641390
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T03:38:48.940
> 
>         
> 
> 标签：delphi, string, pointers, char, ansi

[我从 Rob Kennedy](https://stackoverflow.com/questions/628965/delphi-accessing-data-from-dynamic-array-that-is-populated-from-an-untyped-poin/629213#629213)那里得到了建议，他的一个建议是，他的建议之一是使用`SetString`然后将其加载到显示它的 VCL 组件中，从而大大提高了我正在开发的应用程序的速度。

我正在使用 Delphi 2009，所以现在 PChar 是 Unicode，

```
SetString(OutputString, PChar(Output), OutputLength.Value);
edtString.Text := edtString.Text + OutputString; 
```

有效，我自己将其更改为 PChar，但由于被移动的数据并不总是 Unicode，实际上它通常是 ShortString Data.... 所以他实际上给了我使用的内容：

```
SetString(OutputString, PAnsiChar(Output), OutputLength.Value);
edtString.Text := edtString.Text + OutputString; 
```

什么都没有显示，但是我检查了调试器，并且通常以我过去一次构建 1 个字符的方式出现的文本位于变量中。

奇怪的是，这不是我今晚第一次遇到这种情况。因为我试图想出另一种方法，所以我接受了他的部分建议，而不是构建到 VCL 的 TCaption 中，而是将其构建到字符串变量中，然后复制它，但是当我发送它时，什么都没有显示。再次在调试器中，内置数据的变量...具有数据。

```
for I := 0 to OutputLength.Value - 1 do
begin
  OutputString := OutputString + Char(OutputData^[I]);
end;
edtString.Text := OutputString; 
```

上述方法不起作用，但旧的慢速方法工作得很好....

```
for I := 0 to OutputLength.Value - 1 do
begin
  edtString.Text := edtString.Text + Char(OutputData^[I]);
end; 
```

我尝试将变量设为 ShortString、String 和 TCaption，但没有显示任何内容。我还发现有趣的是，当我将我的十六进制数据从同一个数组构建到 Richedit 中时，它非常快，而在文本数据的编辑中执行它非常非常慢。这就是为什么我没有费心尝试更改richedit 的代码，因为它的运行速度非常快。

编辑添加 - 我想我找到了问题，但我没有解决方案。如果我在调试器中编辑值以删除任何无法显示的内容（旧方法过去只是不显示......不会失败），那么我剩下的就会显示出来。因此，如果只是摆脱被转换为垃圾字符的字节的问题，我该如何解决呢？

我基本上从正在显示十六进制编辑器样式的 SCSI 设备传入原始数据。我最初一次添加一个字符的慢速风格成功地显示了字符串和其中没有 Unicode 特定字符的 Unicode 字符串。更快的方法即使工作也不会以一种方式显示 ShortStrings，而另一种方式不会显示不使用非 0-255 字符的 UnicodeStrings。我真的很喜欢并且可以使用速度提升，但如果这意味着牺牲读取字符串的能力......那么应用程序的意义何在？

EDIT3 - 好吧，现在我已经发现 0-31 是控制字符并且 32 及以上是有效的，我想我会尝试过滤 char 并将那些无效的替换为 . 这是我打算稍后做的事情来模拟十六进制编辑器样式。

如果有任何其他建议，我很乐意听到它们，但除此之外，我认为我可以制定一个比原始解决方案更快的解决方案，同时满足我的需要。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T08:31:59.983

一些评论：

1.  你的问题很不清楚。你到底想做什么？

2.  您的问题读起来很糟糕，请使用拼写检查器检查您的文字。

3.  您所指的问题是：[Delphi access data from dynamic array that is paid from an untyped pointer](https://stackoverflow.com/questions/628965/delphi-accessing-data-from-dynamic-array-that-is-populated-from-an-untyped-poin)

4.  请像您在上一个问题中所做的那样提供您的函数的完整代码示例，我想知道您是否实施了 Rob Kennedy 的建议或您在以下答案中给自己的代码（希望不是 :)）

5.  据我了解您的问题：您正在向您的 SCSI 设备发送查询，并且您得到一个字节数组，您将其存储在变量 OutputData 中。之后，您想向用户显示您的数据。所以你真正的问题是：**如何向用户显示一个字节数组？**

6.  以同一用户身份登录，不要为每个新问题创建一个帐户。这样我们就可以跟踪您的问题历史，并通过“获得建议”了解您的意思。

如果我对您问题的真正含义是正确的，一些假设和建议：

1.  将您的数据显示为十六进制字符串不会有任何问题

2.  在普通的备忘录字段中显示数据会给您带来问题，尽管 Delphi 字符串可以包含任何字符，包括 0 个字节，但显示它们会给您带来问题。例如，一个 TMemo 将显示您的数据，直到第一个 0 字节。您必须做的（并且您自己给出了答案）是用假人替换不可见的字符。之后，您可以在 TMemo 中显示您的数据。实际上所有十六进制查看器都这样做，无法打印的字符将显示为一个点。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T18:27:15.170

我`PAnsiChar`在我的例子中使用是有原因的。它看起来`OutputLength`是以字节而不是字符来衡量的，所以我确保使用长度总是以字节为单位的类型。你还会注意到我展示了`OutputString`as 的声明`AnsiString`。

`AnsiString`但是，由于编辑控件存储了 Unicode，因此和之间会有转换`UnicodeString`。这将考虑系统的当前代码页，但这可能不是您想要的。您可能希望将变量声明为 a `RawByteString`。这不会有任何与之关联的代码页，因此不会有任何意外的转换。

不要使用字符串来存储二进制数据。如果您正在构建相当于十六进制编辑器的内容，那么您正在使用二进制数据。记住这一点很重要。即使您的二进制数据*碰巧*主要由可以解释为文本的字节组成，您也不能将数据视为文本，否则您将遇到您所看到的问题——未按预期显示的字符。如果您从 SCSI 设备获得一堆字节，则将它们存储在字节数组中，而不是字符。

在十六进制编辑器中，您会注意到它们始终显示字节的十六进制值。它们可能会显示那些解释为字符的字节，但这是次要的，它们通常只显示可以表示 ASCII 字符的字节；他们不会尝试对基本显示器过于花哨。*好的*十六进制编辑器也可以将解释为宽字符的数据显示出来。这有助于调试，因为用户可以通过多种方式查看相同的数据。但它们只是对数据的*看法*。它们实际上并没有改变数据的二进制内容。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T13:46:35.890

当您过滤掉不可见的字符时...您可能需要决定如何处理其中的几个，例如#9(Tab)、#10(LF)、#11(Verticle Tab)、#12(FF-或新页),#13(CR)

# c++ - C++ 定义跨文件常量的最佳方式

> ID：641397
> 
>         
> 
> 赞同：11
> 
>         
> 
> 时间：2009-03-13T03:45:27.830
> 
>         
> 
> 标签：c++, templates, constants, extern

我正在开发一款游戏并且有一个有趣的问题。我有一些游戏范围的常量值，我想在一个文件中实现。现在我有这样的事情：

常量.cpp

```
extern const int BEGINNING_HEALTH = 10;
extern const int BEGINNING_MANA = 5; 
```

常量.hpp

```
extern const int BEGINNING_HEALTH;
extern const int BEGINNING_MANA; 
```

然后文件只是 #include "constants.hpp" 这很好用，直到我需要使用其中一个常量作为模板参数，因为外部链接的常量不是有效的模板参数。所以我的问题是，实现这些常量的最佳方法是什么？恐怕只是将常量放在头文件中会导致它们在每个翻译单元中定义。而且我不想使用宏。

谢谢

* * *

## 回答 #1

> 赞同：19
> 
>             
> 
> 时间：2009-03-13T04:04:53.150

摆脱`extern`你的设置。

此代码在标头中运行良好，因为一切都是“真正恒定的”，因此具有内部链接：

```
const int BEGINNING_HEALTH = 10;
const int BEGINNING_MANA = 5;
const char BEGINNING_NAME[] = "Fred";
const char *const BEGINNING_NAME2 = "Barney"; 
```

此代码不能安全地放在头文件中，因为每一行都有外部链接（显式或因为不是真正的常量）：

```
extern const int BEGINNING_HEALTH = 10;
extern const int BEGINNING_MANA = 5;
const char *BEGINNING_NAME = "Wilma";  // the characters are const, but the pointer isn't 
```

* * *

## 回答 #2

> 赞同：10
> 
>             
> 
> 时间：2009-03-13T03:53:35.923

枚举呢？

常量.hpp

```
 enum {
    BEGINNING_HEALTH = 10,
    BEGINNING_MANA = 5
  } 
```

* * *

## 回答 #3

> 赞同：7
> 
>             
> 
> 时间：2009-03-13T04:33:53.893

在 .hpp 文件中使用“static const int”，并在 .cpp 文件中不添加任何内容（当然，除了您拥有的任何其他代码）。

* * *

## 回答 #4

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T12:18:37.940

使用命名空间：

```
namespace GameBeginning {
    const int HEALTH = 10;
    const int MANA   = 5; 
}; 
```

然后你可以使用作为 player.health = GameBeginning::HEALTH;

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T04:06:39.480

大多数编译器根本不为 const POD 值分配空间。他们优化它们并将它们视为已被删除`#define`，不是吗？

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T06:51:05.967

一个简单的事情曾经发生过：

```
#define BEGINNING_HEALTH 10 
```

伙计，那是那些日子。

哦，等等，那**仍然是**日子！

* * *

## 回答 #7

> 赞同：-2
> 
>             
> 
> 时间：2009-03-13T03:53:39.917

也许类似于静态类的东西？

```
class CONSTANTS {
public:
static inline int getMana() { return 10;};
}; 
```

* * *

## 回答 #8

> 赞同：-5
> 
>             
> 
> 时间：2009-03-13T04:10:34.057

作为对标题问题的快速回答，单例模式可能是一种最好的 C++ 方式来定义跨文件常量并确保仅对象的一个​​实例。

至于模板参数问题，你需要传递一个类型而不是一个值。你的类型是“int”。

# c# - 禁用特定 GDI 设备上下文的抗锯齿

> ID：641401
> 
>         
> 
> 赞同：10
> 
>         
> 
> 时间：2009-03-13T03:47:54.470
> 
>         
> 
> 标签：c#, winapi, hook, gdi, cleartype

我正在使用第三方库将图像渲染到 GDI DC，并且我需要确保在没有任何平滑/抗锯齿的情况下渲染任何文本，以便我可以将图像转换为具有索引颜色的预定义调色板。

我用于渲染的第三方库不支持此功能，仅根据当前的窗口设置来渲染文本以​​进行字体渲染。他们还表示，他们不太可能很快增加关闭抗锯齿功能。

到目前为止，我发现的最好的解决方法是以这种方式调用第三方库（为简洁起见，省略了错误处理和先前的设置检查）：

```
private static void SetFontSmoothing(bool enabled)
{
    int pv = 0;
    SystemParametersInfo(Spi.SetFontSmoothing, enabled ? 1 : 0, ref pv, Spif.None);
}

// snip
Graphics graphics = Graphics.FromImage(bitmap)
IntPtr deviceContext = graphics.GetHdc();

SetFontSmoothing(false);
thirdPartyComponent.Render(deviceContext);
SetFontSmoothing(true); 
```

这显然对操作系统产生了可怕的影响，每次我渲染图像时，其他应用程序都会从​​启用清除类型闪烁到禁用并返回。

所以问题是，有谁知道我可以如何更改特定 DC 的字体渲染设置？

即使我可以只使更改过程或线程特定而不影响整个操作系统，那将是向前迈出的一大步！（这将使我可以选择将此渲染输出到一个单独的进程 - 无论如何渲染后结果都会写入磁盘）

**编辑：**我想补充一点，我不介意解决方案是否比几个 API 调用更复杂。如果只需要一天的工作，我什至会对涉及挂钩系统 dll 的解决方案感到满意。

**编辑：背景信息**
第三方库使用大约 70 种颜色的调色板进行渲染。将图像（实际上是地图图块）渲染到 DC 后，我将每个像素从它的 32 位颜色转换回它的调色板索引，并将结果存储为 8bpp 灰度图像。这作为纹理上传到视频卡。在渲染期间，我使用在视频卡上执行的像素着色器重新应用调色板（也存储为纹理）。这让我可以立即在不同的调色板之间切换和淡入淡出，而无需重新生成所有需要的图块。为典型的世界视图生成和上传所有图块需要 10-60 秒。

**编辑：将 GraphicsDevice 重命名为 Graphics**
这个问题的先前版本中的 GraphicsDevice 类实际上是 System.Drawing.Graphics。我重命名了它（使用 GraphicsDevice = ...），因为有问题的代码位于命名空间 MyCompany.Graphics 中，编译器无法正确解析它。

**编辑：成功！**
我什至设法`PatchIat`在`Marshal.GetFunctionPointerForDelegate`. .NET 互操作团队确实做得非常出色！我现在使用以下语法，其中`Patch`的扩展方法是`System.Diagnostics.ProcessModule`：

```
module.Patch(
    "Gdi32.dll",
    "CreateFontIndirectA",
    (CreateFontIndirectA original) => font =>
    {
        font->lfQuality = NONANTIALIASED_QUALITY;
        return original(font);
    });

private unsafe delegate IntPtr CreateFontIndirectA(LOGFONTA* lplf);

private const int NONANTIALIASED_QUALITY = 3;

[StructLayout(LayoutKind.Sequential)]
private struct LOGFONTA
{
    public int lfHeight;
    public int lfWidth;
    public int lfEscapement;
    public int lfOrientation;
    public int lfWeight;
    public byte lfItalic;
    public byte lfUnderline;
    public byte lfStrikeOut;
    public byte lfCharSet;
    public byte lfOutPrecision;
    public byte lfClipPrecision;
    public byte lfQuality;
    public byte lfPitchAndFamily;
    public unsafe fixed sbyte lfFaceName [32];
} 
```

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-18T19:07:41.383

不幸的是你不能。控制字体抗锯齿的能力是按字体完成的。GDI 调用 CreateFontIndirect 处理 LOGFONT 结构的成员以确定其是否允许使用 cleartype、常规或不使用抗锯齿。

正如您所指出的，有系统范围的设置。不幸的是，如果您无法控制 LOGFONT 的内容，那么更改系统范围的设置几乎是降低 DC 上字体渲染质量的唯一（已记录）方法。

* * *

这段代码不是我的。是非托管的 C。如果你知道它的 HMODULE，它将挂钩由 dll 或 exe 文件导入的任何函数。

```
#define PtrFromRva( base, rva ) ( ( ( PBYTE ) base ) + rva )

/*++
  Routine Description:
    Replace the function pointer in a module's IAT.

  Parameters:
    Module              - Module to use IAT from.
    ImportedModuleName  - Name of imported DLL from which
                          function is imported.
    ImportedProcName    - Name of imported function.
    AlternateProc       - Function to be written to IAT.
    OldProc             - Original function.

  Return Value:
    S_OK on success.
    (any HRESULT) on failure.
--*/
HRESULT PatchIat(
  __in HMODULE Module,
  __in PSTR ImportedModuleName,
  __in PSTR ImportedProcName,
  __in PVOID AlternateProc,
  __out_opt PVOID *OldProc
  )
{
  PIMAGE_DOS_HEADER DosHeader = ( PIMAGE_DOS_HEADER ) Module;
  PIMAGE_NT_HEADERS NtHeader;
  PIMAGE_IMPORT_DESCRIPTOR ImportDescriptor;
  UINT Index;

  assert( Module );
  assert( ImportedModuleName );
  assert( ImportedProcName );
  assert( AlternateProc );

  NtHeader = ( PIMAGE_NT_HEADERS )
    PtrFromRva( DosHeader, DosHeader->e_lfanew );
  if( IMAGE_NT_SIGNATURE != NtHeader->Signature )
  {
    return HRESULT_FROM_WIN32( ERROR_BAD_EXE_FORMAT );
  }

  ImportDescriptor = ( PIMAGE_IMPORT_DESCRIPTOR )
    PtrFromRva( DosHeader,
      NtHeader->OptionalHeader.DataDirectory
        [ IMAGE_DIRECTORY_ENTRY_IMPORT ].VirtualAddress );

  //
  // Iterate over import descriptors/DLLs.
  //
  for ( Index = 0;
        ImportDescriptor[ Index ].Characteristics != 0;
        Index++ )
  {
    PSTR dllName = ( PSTR )
      PtrFromRva( DosHeader, ImportDescriptor[ Index ].Name );

    if ( 0 == _strcmpi( dllName, ImportedModuleName ) )
    {
      //
      // This the DLL we are after.
      //
      PIMAGE_THUNK_DATA Thunk;
      PIMAGE_THUNK_DATA OrigThunk;

      if ( ! ImportDescriptor[ Index ].FirstThunk ||
         ! ImportDescriptor[ Index ].OriginalFirstThunk )
      {
        return E_INVALIDARG;
      }

      Thunk = ( PIMAGE_THUNK_DATA )
        PtrFromRva( DosHeader,
          ImportDescriptor[ Index ].FirstThunk );
      OrigThunk = ( PIMAGE_THUNK_DATA )
        PtrFromRva( DosHeader,
          ImportDescriptor[ Index ].OriginalFirstThunk );

      for ( ; OrigThunk->u1.Function != NULL;
              OrigThunk++, Thunk++ )
      {
        if ( OrigThunk->u1.Ordinal & IMAGE_ORDINAL_FLAG )
        {
          //
          // Ordinal import - we can handle named imports
          // ony, so skip it.
          //
          continue;
        }

        PIMAGE_IMPORT_BY_NAME import = ( PIMAGE_IMPORT_BY_NAME )
          PtrFromRva( DosHeader, OrigThunk->u1.AddressOfData );

        if ( 0 == strcmp( ImportedProcName,
                              ( char* ) import->Name ) )
        {
          //
          // Proc found, patch it.
          //
          DWORD junk;
          MEMORY_BASIC_INFORMATION thunkMemInfo;

          //
          // Make page writable.
          //
          VirtualQuery(
            Thunk,
            &thunkMemInfo,
            sizeof( MEMORY_BASIC_INFORMATION ) );
          if ( ! VirtualProtect(
            thunkMemInfo.BaseAddress,
            thunkMemInfo.RegionSize,
            PAGE_EXECUTE_READWRITE,
            &thunkMemInfo.Protect ) )
          {
            return HRESULT_FROM_WIN32( GetLastError() );
          }

          //
          // Replace function pointers (non-atomically).
          //
          if ( OldProc )
          {
            *OldProc = ( PVOID ) ( DWORD_PTR )
                Thunk->u1.Function;
          }
#ifdef _WIN64
          Thunk->u1.Function = ( ULONGLONG ) ( DWORD_PTR )
              AlternateProc;
#else
          Thunk->u1.Function = ( DWORD ) ( DWORD_PTR )
              AlternateProc;
#endif
          //
          // Restore page protection.
          //
          if ( ! VirtualProtect(
            thunkMemInfo.BaseAddress,
            thunkMemInfo.RegionSize,
            thunkMemInfo.Protect,
            &junk ) )
          {
            return HRESULT_FROM_WIN32( GetLastError() );
          }

          return S_OK;
        }
      }

      //
      // Import not found.
      //
      return HRESULT_FROM_WIN32( ERROR_PROC_NOT_FOUND );
    }
  }

  //
  // DLL not found.
  //
  return HRESULT_FROM_WIN32( ERROR_MOD_NOT_FOUND );
} 
```

您可以通过执行以下操作从您的代码中调用它（我还没有检查过它是否以任何方式编译：P）：

1.  声明要挂钩的函数的指针类型：

    ```
    typedef FARPROC (WINAPI* PFNCreateFontIndirect)(LOGFONT*); 
    ```

2.  实现一个钩子函数

    ```
    static PFNCreateFontIndirect OldCreateFontIndirect = NULL;

    WINAPI MyNewCreateFontIndirectCall(LOGFONT* plf)
    {
      // do stuff to plf (probably better to create a copy than tamper with passed in struct)
      // chain to old proc
      if(OldCreateFontIndirect)
        return OldCreateFontIndirect(plf);
    } 
    ```

3.  在初始化期间的某个时间挂钩函数

    ```
    HMODULE h = LoadLibrary(TEXT("OtherDll"));
    PatchIat(h, "USER32.DLL", "CreateFontIndirectW", MyNewCreateFontIndirectProc, (void**)&OldCreateFontIndirectProc); 
    ```

当然，如果您要挂接的模块存在于 .NET 中，则非常不清楚`CreateFontIndirect`调用的来源。`mscoree.dll`? 您调用的实际模块？我猜祝你好运：P

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2010-05-31T18:20:11.560

根据要求，我已经打包了我为解决这个问题而编写的代码并将其放在 github 存储库中：http: [//github.com/jystic/patch-iat](http://github.com/jystic/patch-iat)

它看起来像很多代码，因为我必须重现所有 Win32 结构才能使这些东西工作，并且当时我选择将每个结构放在自己的文件中。

如果你想直接进入代码的核心，它位于：`ImportAddressTable.cs`

它的许可非常自由，并且适用于所有意图和目的，公共领域，因此请随时在您喜欢的任何项目中使用它。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T12:20:43.287

您的字体是否需要比黑白更多的颜色？如果没有，您可以将您的*位图*对象设置为每像素图像 1 位（*Format1bppIndexed*？）。

系统可能不会平滑 1bpp 图像上的字体渲染。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-17T01:42:56.213

GraphicsDevice 类是第 3 方类吗？

我这样做的方法是：

```
Graphics g = Graphics.FromImage(memImg);
g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.None; 
```

或者在你的情况下：

```
GraphicsDevice graphics = GraphicsDevice.FromImage(bitmap)
graphics.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.None; 
```

如果 GraphicsDevice 类继承了 Graphics 类（否则尝试使用 Graphics 类？）

# flash - 我如何每隔几分钟旋转一次 Flash 视频？

> ID：641403
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T03:49:05.827
> 
>         
> 
> 标签：flash, video, rotation

我想在 5 分钟后将我网站上的 flash 视频旋转为新视频。自动旋转它。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:45:11.760

通过旋转，我认为您的意思是播放系列中的下一个视频，对吗？您需要添加一个事件侦听器来侦听播放 flv 的 NetStream 实例的 NetStatusEvent。一旦你得到“NetStream.Play.Stop”，你就知道你的视频已经停止了，你可以启动下一个。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T04:21:22.813

您可以将 setInterval 与补间结合使用来进行实际旋转。

# iphone - 为什么 UITableView 在 dealloc 中崩溃应用程序？

> ID：641406
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T03:50:00.567
> 
>         
> 
> 标签：iphone, cocoa-touch, uitableview

我在视图的 dealloc 中这样做

```
[baseTable release]; 
```

在头文件中，我这样声明：

```
IBOutlet UITableView *baseTable;
....
@property(nonatomic, retain) UITableView *baseTable; 
```

出于某种原因，我在 dealloc 中得到一个“EXC_BAD _ACCESS”。当我注释掉上面的行时，一切都很好。如何确定 UITableView 和发布的具体情况？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-21T18:31:20.703

如果您想找出 EXC_BAD_ACCESS 错误的确切原因，请启用 NSZombie，这样无论何时您调用已释放对象的任何方法，它都会准确地告诉您它是什么对象以及它是什么方法。

要启用 NSZombie：

1.  展开左侧“组和文件”窗口中的可执行文件部分。

2.  打开可执行文件的属性。

3.  找到“参数”部分（它在屏幕的下半部分，我忘记了它在哪个选项卡中）

4.  添加一个值为“YES”的新参数“NSZombieEnabled”

要禁用它，请删除该值或取消选中它，如果您想稍后再次打开它。一定不要让它打开，因为它在启用时实际上并没有释放任何东西！

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:28:49.397

我的猜测是您在某个地方发布了太多次 baseTable，请寻找一个您在没有保留的情况下发布它的地方。

每次保留都必须有一个且只有一个版本，从那里开始，看看你是怎么做的。棘手的一点是确保无论您传递 baseTable 对象，释放/保留都匹配。因此，它不会像 [baseTable release] 上的 grep 那样简单，不幸的是：)

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:34:33.907

听起来你过度释放了`baseTable`。如果不查看更多代码，很难说这可能发生在哪里。您是否随时将该表的所有权授予自动释放池？当您自动释放一个对象时，您将所有权转移到自动释放池，您需要确保放弃该对象（并可能`nil`放弃它的实例变量）。

您需要检查每次使用`baseTable`并确保任何可能承担表所有权的对象在释放它之前保留它。还请记住，您可能通过别名作为`UITableViewDelegate`or`UITableViewDataSource`方法的参数来引用表对象。

* * *

## 回答 #4

> 赞同：-1
> 
>             
> 
> 时间：2012-10-29T04:17:49.727

当您使用 Retain 属性时，请检查是否

```
if(self.tableView!=nil)
{
self.tableView = nil;
} 
```

在 dealloc.In 这种方式中，您正在检查表视图是否为 nil，并且您正在将其变为 nil。

# javascript - JavaScript 中的负向后等价

> ID：641407
> 
>         
> 
> 赞同：161
> 
>         
> 
> 时间：2009-03-13T03:50:38.410
> 
>         
> 
> 标签：javascript, regex, negative-lookbehind

有没有一种方法可以在 JavaScript 正则表达式中实现相当于[否定的向后查找？](http://www.regular-expressions.info/lookaround.html#lookbehind)我需要匹配一个不以特定字符集开头的字符串。

如果在字符串的开头找到匹配的部分，我似乎无法找到执行此操作而不会失败的正则表达式。负向回溯似乎是唯一的答案，但 JavaScript 没有。

这是我想要工作的正则表达式，但它没有：

`(?<!([abcdefg]))m`

所以它会匹配'jim'或'm'中的'm'，但不匹配'jam'

* * *

## 回答 #1

> 赞同：101
> 
>             
> 
> 时间：2012-07-05T15:02:34.540

自 2018 年以来，[Lookbehind Assertions](https://github.com/tc39/proposal-regexp-lookbehind)成为[ECMAScript 语言规范](https://github.com/tc39/proposals/blob/master/finished-proposals.md)的一部分。

```
// positive lookbehind
(?<=...)
// negative lookbehind
(?<!...) 
```

* * *

**2018年前的回答**

由于 Javascript 支持[负前瞻](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#special-negated-look-ahead)，一种方法是：

1.  反转输入字符串

2.  与反向正则表达式匹配

3.  反转并重新格式化匹配

* * *

```
const reverse = s => s.split('').reverse().join('');

const test = (stringToTests, reversedRegexp) => stringToTests
  .map(reverse)
  .forEach((s,i) => {
    const match = reversedRegexp.test(s);
    console.log(stringToTests[i], match, 'token:', match ? reverse(reversedRegexp.exec(s)[0]) : 'Ø');
  }); 
```

**示例 1：**

在@andrew-ensley 的问题之后：

```
test(['jim', 'm', 'jam'], /m(?!([abcdefg]))/) 
```

输出：

```
jim true token: m
m true token: m
jam false token: Ø 
```

**示例 2：**

在@neaumusic 评论之后（匹配`max-height`但不匹配`line-height`，标记为`height`）：

```
test(['max-height', 'line-height'], /thgieh(?!(-enil))/) 
```

输出：

```
max-height true token: height
line-height false token: Ø 
```

* * *

## 回答 #2

> 赞同：82
> 
>             
> 
> 时间：2018-05-20T12:32:37.493

[Lookbehind Assertions](https://github.com/tc39/proposal-regexp-lookbehind)在2018 年被[ECMAScript 规范](https://tc39.github.io/ecma262/)[接受。](https://github.com/tc39/proposals/blob/master/finished-proposals.md)

积极的后视用法：

```
console.log(
  "$9.99  €8.47".match(/(?<=\$)\d+\.\d*/) // Matches "9.99"
);
```

负后视用法：

```
console.log(
  "$9.99  €8.47".match(/(?<!\$)\d+\.\d*/) // Matches "8.47"
);
```

平台支持：

*   ✔️ [V8](https://developers.google.com/v8/)

    *   ✔️[谷歌浏览器 62.0](https://bugs.chromium.org/p/v8/issues/detail?id=4545)

    *   ✔️ Microsoft Edge 79.0

    *   ✔️ [Node.js 6.0 有标志，9.0 没有标志](https://node.green/)

    *   ✔️ Deno（所有版本）

*   ✔️蜘蛛[猴](https://bugzilla.mozilla.org/show_bug.cgi?id=1225665)

    *   ✔️ [Mozilla Firefox 78.0](https://bugzilla.mozilla.org/show_bug.cgi?id=1634135)

*   ️ JavaScriptCore：[Apple 正在开发它](https://bugs.webkit.org/show_bug.cgi?id=174931)

    *   ️ 苹果Safari

    *   ️ iOS WebView（iOS + iPadOS 上的所有浏览器）

*   ❌ Chakra：[微软正在研究它，](https://github.com/Microsoft/ChakraCore/issues/3448)但现在放弃了 Chakra，转而支持 V8

    *   ❌ Internet Explorer

    *   ❌ 79 之前的 Edge 版本（基于 EdgeHTML+Chakra 的版本）

* * *

## 回答 #3

> 赞同：68
> 
>             
> 
> 时间：2014-11-30T13:20:25.080

假设您要查找`int`前面没有的所有内容`unsigned` ：

支持消极的后视：

```
(?<!unsigned )int 
```

不支持负面回顾：

```
((?!unsigned ).{9}|^.{0,8})int 
```

基本上想法是抓住 n 个前面的字符并排除匹配与否定前瞻，但也匹配没有前面 n 个字符的情况。（其中 n 是后视的长度）。

所以有问题的正则表达式：

```
(?<![abcdefg])m 
```

将转化为：

```
([^abcdefg]|^)m
((?![abcdefg]).|^)m 
```

您可能需要使用捕获组来找到您感兴趣的字符串的确切位置，或者您想用其他东西替换特定部分。

* * *

## 回答 #4

> 赞同：41
> 
>             
> 
> 时间：2009-03-13T13:38:29.620

Mijoja 的策略适用于您的具体情况，但不适用于一般情况：

```
js>newString = "Fall ball bill balll llama".replace(/(ba)?ll/g,
   function($0,$1){ return $1?$0:"[match]";});
Fa[match] ball bi[match] balll [match]ama 
```

这是一个示例，目标是匹配双 l，但如果它前面有“ba”，则不匹配。注意“球”这个词——真正的后视应该抑制了前 2 个 l's 但与第二对匹配。但是通过匹配前 2 个 l，然后将该匹配作为误报忽略，正则表达式引擎从该匹配的*末尾*继续，并忽略误报中的任何字符。

* * *

## 回答 #5

> 赞同：33
> 
>             
> 
> 时间：2009-03-13T04:11:00.437

采用

```
newString = string.replace(/([abcdefg])?m/, function($0,$1){ return $1?$0:'m';}); 
```

* * *

## 回答 #6

> 赞同：12
> 
>             
> 
> 时间：2013-08-23T00:13:54.677

您可以通过否定字符集来定义非捕获组：

```
(?:[^a-g])m 
```

...这将匹配前面有任何这些字母的每个`m` **NOT 。**

* * *

## 回答 #7

> 赞同：2
> 
>             
> 
> 时间：2019-04-01T19:43:11.730

这是我`str.split(/(?<!^)@/)`为 Node.js 8 实现的（不支持后视）：

```
str.split('').reverse().join('').split(/@(?!$)/).map(s => s.split('').reverse().join('')).reverse() 
```

作品？是的（未经测试的unicode）。不愉快？是的。

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2015-04-19T07:06:43.317

遵循 Mijoja 的想法，借鉴 JasonS 暴露的问题，我有了这个想法；我检查了一下，但不确定自己，所以在 js 正则表达式中由比我更专家的人进行验证会很棒:)

```
var re = /(?=(..|^.?)(ll))/g
         // matches empty string position
         // whenever this position is followed by
         // a string of length equal or inferior (in case of "^")
         // to "lookbehind" value
         // + actual value we would want to match

,   str = "Fall ball bill balll llama"

,   str_done = str
,   len_difference = 0
,   doer = function (where_in_str, to_replace)
    {
        str_done = str_done.slice(0, where_in_str + len_difference)
        +   "[match]"
        +   str_done.slice(where_in_str + len_difference + to_replace.length)

        len_difference = str_done.length - str.length
            /*  if str smaller:
                    len_difference will be positive
                else will be negative
            */

    }   /*  the actual function that would do whatever we want to do
            with the matches;
            this above is only an example from Jason's */

        /*  function input of .replace(),
            only there to test the value of $behind
            and if negative, call doer() with interesting parameters */
,   checker = function ($match, $behind, $after, $where, $str)
    {
        if ($behind !== "ba")
            doer
            (
                $where + $behind.length
            ,   $after
                /*  one will choose the interesting arguments
                    to give to the doer, it's only an example */
            )
        return $match // empty string anyhow, but well
    }
str.replace(re, checker)
console.log(str_done) 
```

我的个人输出：

```
Fa[match] ball bi[match] bal[match] [match]ama 
```

原则是`checker`在字符串中任意两个字符之间的每个点调用，只要该位置是以下位置的起点：

--- 任何不想要的大小的子字符串（这里`'ba'`，因此`..`）（如果知道该大小；否则可能会更难做）

--- --- 如果它是字符串的开头，则小于该值：`^.?`

并且，在此之后，

--- 实际要寻找的东西（这里`'ll'`）。

在每次调用 时`checker`，都会有一个测试来检查之前的值`ll`是否不是我们不想要的（`!== 'ba'`）；如果是这种情况，我们调用另一个函数，它必须是这个 ( `doer`) 将在 str 上进行更改，如果目的是这个，或者更一般地说，它将输入手动处理所需的数据的扫描结果`str`。

在这里，我们更改了字符串，因此我们需要跟踪长度差异，以抵消由 给出的位置`replace`，所有这些都是在 上计算的`str`，它本身永远不会改变。

由于原始字符串是不可变的，我们可以使用该变量`str`来存储整个操作的结果，但我认为这个已经被替换复杂的示例使用另一个变量 ( `str_done`) 会更清晰。

我想就性能而言，它一定非常苛刻：所有那些毫无意义的 '' 到 '' 的替换，`this str.length-1`时间，加上这里由 doer 手动替换，这意味着很多切片......可能在上述特定情况下可能被分组，通过将字符串仅切割一次，在我们想要插入的位置周围将其`[match]`与自身`.join()`一起 ing 。`[match]`

另一件事是我不知道它将如何处理更复杂的情况，即假后视的复杂值......长度可能是最有问题的数据。

并且，在 中`checker`，如果 $behind 有多种不需要的值的可能性，我们将不得不使用另一个正则表达式对其进行测试（`checker`最好在外部缓存（创建），以避免创建相同的正则表达式对象在每次调用`checker`) 时，了解它是否是我们试图避免的。

希望我已经清楚了；如果不犹豫，我会努力的更好。:)

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2018-02-16T13:28:04.950

使用您的情况，**如果您想** `m`用某些东西替换，例如将其转换为大写`M`，您可以否定捕获组中的设置。

匹配`([^a-g])m`，替换为`$1M`

```
"jim jam".replace(/([^a-g])m/g, "$1M")
\\jiM jam 
```

`([^a-g])`将匹配范围内的任何 char not( `^`)   `a-g`，并将其存储在第一个捕获组中，因此您可以使用`$1`.

所以我们找到`im`in`jim`并将其替换`iM`为`jiM`.

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2019-07-07T12:51:28.417

如前所述，JavaScript 现在允许后视。在较旧的浏览器中，您仍然需要一种解决方法。

我敢打赌，如果没有后视，就没有办法找到一个正则表达式来准确地提供结果。您所能做的就是与小组合作。假设您有一个 regex `(?<!Before)Wanted`，`Wanted`您要匹配`Before`的 regex 是哪里，并且是计算不应该在匹配之前的内容的 regex。您能做的最好的事情就是否定正则表达式`Before`并使用正则表达式`NotBefore(Wanted)`。想要的结果是第一组`$1`。

在您的情况下`Before=[abcdefg]`，这很容易否定`NotBefore=[^abcdefg]`。所以正则表达式是`[^abcdefg](m)`. 如果你需要的位置`Wanted`，你也必须分组`NotBefore`，这样想要的结果就是第二组。

如果模式匹配的`Before`长度是固定`n`的，即模式不包含重复标记，则可以避免否定`Before`模式而使用正则表达式`(?!Before).{n}(Wanted)`，但仍然必须使用第一组或使用正则表达式`(?!Before)(.{n})(Wanted)`并使用第二组团体。在此示例中，模式`Before`实际上具有固定长度，即 1，因此请使用正则表达式`(?![abcdefg]).(m)`或`(?![abcdefg])(.)(m)`. 如果您对所有匹配项感兴趣，请添加`g`标志，请参阅我的代码片段：

```
function TestSORegEx() {
  var s = "Donald Trump doesn't like jam, but Homer Simpson does.";
  var reg = /(?![abcdefg])(.{1})(m)/gm;
  var out = "Matches and groups of the regex " + 
            "/(?![abcdefg])(.{1})(m)/gm in \ns = \"" + s + "\"";
  var match = reg.exec(s);
  while(match) {
    var start = match.index + match[1].length;
    out += "\nWhole match: " + match[0] + ", starts at: " + match.index
        +  ". Desired match: " + match[2] + ", starts at: " + start + ".";   
    match = reg.exec(s);
  }
  out += "\nResulting string after statement s.replace(reg, \"$1*$2*\")\n"
         + s.replace(reg, "$1*$2*");
  alert(out);
} 
```

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2016-04-12T00:18:59.970

这有效地做到了

```
"jim".match(/[^a-g]m/)
> ["im"]
"jam".match(/[^a-g]m/)
> null 
```

搜索和替换示例

```
"jim jam".replace(/([^a-g])m/g, "$1M")
> "jiM jam" 
```

请注意，负的后视字符串必须为 1 个字符长才能正常工作。

* * *

## 回答 #12

> 赞同：-1
> 
>             
> 
> 时间：2013-11-04T21:24:17.143

`/(?![abcdefg])[^abcdefg]m/gi`
是的，这是一个技巧。

# ruby - Kernel.loop 方法需要 'do' 。不允许分号？

> ID：641413
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T03:54:53.487
> 
>         
> 
> 标签：ruby, syntax, loops, kernel

对于某些结构，我可以选择使用分号或`do`关键字来分隔语句的结尾，如下`until`例所示。

```
until x == 100 do puts x; x+=1 end 

until x == 100; puts x; x+=1 end 
```

但这是不可能的`Kernel.loop`。

```
x=0    
loop do puts x; x+=1; break if x == 100 end

x=0    
loop; puts x; x+=1; break if x == 100 end # => error 
```

有这样的原因吗？

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T05:37:05.940

*   `loop`是一种方法 (in `Kernel`)，它确实需要一个带有`do...end`or的块`{ }`。

*   `while`和`until`是语句（如`if`），不要指望一个块。关键字是可选的`do`，但它不表示一个块（例如`while x == 100 { puts x; x+=1; }`，将失败`loop { puts x; x+=1; break if x == 100 }`得很惨，而工作正常。）

所以，`do`在这两种情况下意味着不同的东西。在`loop`（和其他方法）的情况下，它实际上表示一个块；在等的情况下`while`，`until`它只是语法糖（就像`then`在之后一样`if`。）不要被误导。

# python - 在 Python 中使用多处理时我应该如何记录？

> ID：641420
> 
>         
> 
> 赞同：288
> 
>         
> 
> 时间：2009-03-13T04:02:31.457
> 
>         
> 
> 标签：python, logging, multiprocessing

现在我在一个框架中有一个中心模块，它使用 Python 2.6[`multiprocessing`模块](http://docs.python.org/library/multiprocessing.html?#module-multiprocessing)生成多个进程。因为它使用`multiprocessing`，所以有模块级多处理感知日志，`LOG = multiprocessing.get_logger()`. 根据[文档](http://docs.python.org/library/multiprocessing.html#logging)，此记录器具有进程共享锁，因此您不会`sys.stderr`通过同时写入多个进程而在（或任何文件句柄）中乱码。

我现在遇到的问题是框架中的其他模块不支持多处理。在我看来，我需要让这个中央模块的所有依赖项都使用多处理感知日志记录。*这在框架内*很烦人，更不用说框架的所有客户端了。有没有我没有想到的替代方案？

* * *

## 回答 #1

> 赞同：142
> 
>             
> 
> 时间：2009-05-21T18:10:33.620

我刚刚编写了一个自己的日志处理程序，它只是通过管道将所有内容提供给父进程。我只测试了十分钟，但它似乎工作得很好。

（**注意：**这是硬编码为`RotatingFileHandler`，这是我自己的用例。）

* * *

## 更新：@javier 现在将这种方法作为 Pypi 上可用的包进行维护 - 请参阅 Pypi上[的 multiprocessing-logging](https://pypi.python.org/pypi/multiprocessing-logging/)，github 上[https://github.com/jruere/multiprocessing-logging](https://github.com/jruere/multiprocessing-logging)

* * *

## 更新：实施！

这现在使用队列来正确处理并发，并且还可以正确地从错误中恢复。我现在已经在生产中使用它几个月了，下面的当前版本可以正常工作。

```
from logging.handlers import RotatingFileHandler
import multiprocessing, threading, logging, sys, traceback

class MultiProcessingLog(logging.Handler):
    def __init__(self, name, mode, maxsize, rotate):
        logging.Handler.__init__(self)

        self._handler = RotatingFileHandler(name, mode, maxsize, rotate)
        self.queue = multiprocessing.Queue(-1)

        t = threading.Thread(target=self.receive)
        t.daemon = True
        t.start()

    def setFormatter(self, fmt):
        logging.Handler.setFormatter(self, fmt)
        self._handler.setFormatter(fmt)

    def receive(self):
        while True:
            try:
                record = self.queue.get()
                self._handler.emit(record)
            except (KeyboardInterrupt, SystemExit):
                raise
            except EOFError:
                break
            except:
                traceback.print_exc(file=sys.stderr)

    def send(self, s):
        self.queue.put_nowait(s)

    def _format_record(self, record):
        # ensure that exc_info and args
        # have been stringified.  Removes any chance of
        # unpickleable things inside and possibly reduces
        # message size sent over the pipe
        if record.args:
            record.msg = record.msg % record.args
            record.args = None
        if record.exc_info:
            dummy = self.format(record)
            record.exc_info = None

        return record

    def emit(self, record):
        try:
            s = self._format_record(record)
            self.send(s)
        except (KeyboardInterrupt, SystemExit):
            raise
        except:
            self.handleError(record)

    def close(self):
        self._handler.close()
        logging.Handler.close(self) 
```

* * *

## 回答 #2

> 赞同：84
> 
>             
> 
> 时间：2009-03-13T04:39:42.583

以非侵入方式处理此问题的唯一方法是：

1.  生成每个工作进程，使其日志转到**不同的文件描述符**（磁盘或管道）。理想情况下，所有日志条目都应该加上时间戳。  

2.  然后，您的控制器进程可以执行以下操作*之一*：

    *   **如果使用磁盘文件：**在运行结束时合并日志文件，按时间戳排序

    *   **如果使用管道（推荐）：**将所有管道中的日志条目即时合并到一个中央日志文件中。（例如，定期[`select`](http://docs.python.org/library/select.html)从管道的文件描述符中，对可用的日志条目执行合并排序，并刷新到集中式日志。重复。）

* * *

## 回答 #3

> 赞同：36
> 
>             
> 
> 时间：2015-08-18T06:47:17.583

`QueueHandler`在 Python 3.2+ 中是本机的，并且正是这样做的。它很容易在以前的版本中复制。

Python 文档有两个完整的示例：[从多个进程记录到单个文件](https://docs.python.org/3/howto/logging-cookbook.html#logging-to-a-single-file-from-multiple-processes)

对于那些使用 Python < 3.2 的用户，只需从以下网址复制`QueueHandler`到您自己的代码中：[https](https://gist.github.com/vsajip/591589) ://gist.github.com/vsajip/591589或导入[logutils](https://pypi.org/project/logutils/)。

每个进程（包括父进程）都将其日志记录放在 . `Queue`，然后一个`listener`线程或进程（为每个进程提供一个示例）拾取它们并将它们全部写入文件 - 没有损坏或乱码的风险。

* * *

## 回答 #4

> 赞同：32
> 
>             
> 
> 时间：2016-01-23T13:59:47.747

下面是另一个解决方案，重点是为从 Google 来到这里的其他任何人（比如我）提供简单性。记录应该很容易！仅适用于 3.2 或更高版本。

```
import multiprocessing
import logging
from logging.handlers import QueueHandler, QueueListener
import time
import random

def f(i):
    time.sleep(random.uniform(.01, .05))
    logging.info('function called with {} in worker thread.'.format(i))
    time.sleep(random.uniform(.01, .05))
    return i

def worker_init(q):
    # all records from worker processes go to qh and then into q
    qh = QueueHandler(q)
    logger = logging.getLogger()
    logger.setLevel(logging.DEBUG)
    logger.addHandler(qh)

def logger_init():
    q = multiprocessing.Queue()
    # this is the handler for all log records
    handler = logging.StreamHandler()
    handler.setFormatter(logging.Formatter("%(levelname)s: %(asctime)s - %(process)s - %(message)s"))

    # ql gets records from the queue and sends them to the handler
    ql = QueueListener(q, handler)
    ql.start()

    logger = logging.getLogger()
    logger.setLevel(logging.DEBUG)
    # add the handler to the logger so records from this process are handled
    logger.addHandler(handler)

    return ql, q

def main():
    q_listener, q = logger_init()

    logging.info('hello from main thread')
    pool = multiprocessing.Pool(4, worker_init, [q])
    for result in pool.map(f, range(10)):
        pass
    pool.close()
    pool.join()
    q_listener.stop()

if __name__ == '__main__':
    main() 
```

* * *

## 回答 #5

> 赞同：22
> 
>             
> 
> 时间：2009-03-13T11:19:29.113

[`logging`另一种选择可能是包](http://docs.python.org/library/logging.html)中的各种非基于文件的日志记录处理程序：

*   `SocketHandler`

*   `DatagramHandler`

*   `SyslogHandler`

（和别的）

这样，您可以轻松地在可以安全写入并正确处理结果的某个地方拥有一个日志记录守护程序。（例如，一个简单的套接字服务器，它只是解开消息并将其发送到它自己的旋转文件处理程序。）

`SyslogHandler`也会为你处理这件事。当然，您可以使用自己的实例`syslog`，而不是系统实例。

* * *

## 回答 #6

> 赞同：14
> 
>             
> 
> 时间：2010-07-15T07:41:56.800

将日志记录和队列线程分开的其他变体。

```
"""sample code for logging in subprocesses using multiprocessing

* Little handler magic - The main process uses loggers and handlers as normal.
* Only a simple handler is needed in the subprocess that feeds the queue.
* Original logger name from subprocess is preserved when logged in main
  process.
* As in the other implementations, a thread reads the queue and calls the
  handlers. Except in this implementation, the thread is defined outside of a
  handler, which makes the logger definitions simpler.
* Works with multiple handlers.  If the logger in the main process defines
  multiple handlers, they will all be fed records generated by the
  subprocesses loggers.

tested with Python 2.5 and 2.6 on Linux and Windows

"""

import os
import sys
import time
import traceback
import multiprocessing, threading, logging, sys

DEFAULT_LEVEL = logging.DEBUG

formatter = logging.Formatter("%(levelname)s: %(asctime)s - %(name)s - %(process)s - %(message)s")

class SubProcessLogHandler(logging.Handler):
    """handler used by subprocesses

    It simply puts items on a Queue for the main process to log.

    """

    def __init__(self, queue):
        logging.Handler.__init__(self)
        self.queue = queue

    def emit(self, record):
        self.queue.put(record)

class LogQueueReader(threading.Thread):
    """thread to write subprocesses log records to main process log

    This thread reads the records written by subprocesses and writes them to
    the handlers defined in the main process's handlers.

    """

    def __init__(self, queue):
        threading.Thread.__init__(self)
        self.queue = queue
        self.daemon = True

    def run(self):
        """read from the queue and write to the log handlers

        The logging documentation says logging is thread safe, so there
        shouldn't be contention between normal logging (from the main
        process) and this thread.

        Note that we're using the name of the original logger.

        """
        # Thanks Mike for the error checking code.
        while True:
            try:
                record = self.queue.get()
                # get the logger for this record
                logger = logging.getLogger(record.name)
                logger.callHandlers(record)
            except (KeyboardInterrupt, SystemExit):
                raise
            except EOFError:
                break
            except:
                traceback.print_exc(file=sys.stderr)

class LoggingProcess(multiprocessing.Process):

    def __init__(self, queue):
        multiprocessing.Process.__init__(self)
        self.queue = queue

    def _setupLogger(self):
        # create the logger to use.
        logger = logging.getLogger('test.subprocess')
        # The only handler desired is the SubProcessLogHandler.  If any others
        # exist, remove them. In this case, on Unix and Linux the StreamHandler
        # will be inherited.

        for handler in logger.handlers:
            # just a check for my sanity
            assert not isinstance(handler, SubProcessLogHandler)
            logger.removeHandler(handler)
        # add the handler
        handler = SubProcessLogHandler(self.queue)
        handler.setFormatter(formatter)
        logger.addHandler(handler)

        # On Windows, the level will not be inherited.  Also, we could just
        # set the level to log everything here and filter it in the main
        # process handlers.  For now, just set it from the global default.
        logger.setLevel(DEFAULT_LEVEL)
        self.logger = logger

    def run(self):
        self._setupLogger()
        logger = self.logger
        # and here goes the logging
        p = multiprocessing.current_process()
        logger.info('hello from process %s with pid %s' % (p.name, p.pid))

if __name__ == '__main__':
    # queue used by the subprocess loggers
    queue = multiprocessing.Queue()
    # Just a normal logger
    logger = logging.getLogger('test')
    handler = logging.StreamHandler()
    handler.setFormatter(formatter)
    logger.addHandler(handler)
    logger.setLevel(DEFAULT_LEVEL)
    logger.info('hello from the main process')
    # This thread will read from the subprocesses and write to the main log's
    # handlers.
    log_queue_reader = LogQueueReader(queue)
    log_queue_reader.start()
    # create the processes.
    for i in range(10):
        p = LoggingProcess(queue)
        p.start()
    # The way I read the multiprocessing warning about Queue, joining a
    # process before it has finished feeding the Queue can cause a deadlock.
    # Also, Queue.empty() is not realiable, so just make sure all processes
    # are finished.
    # active_children joins subprocesses when they're finished.
    while multiprocessing.active_children():
        time.sleep(.1) 
```

* * *

## 回答 #7

> 赞同：12
> 
>             
> 
> 时间：2020-07-06T06:50:22.180

截至 2020 年，似乎有一种更简单的多处理日志记录方式。

此函数将**创建记录器**。您可以在此处设置格式以及您希望输出的位置（文件、标准输出）：

```
def create_logger():
    import multiprocessing, logging
    logger = multiprocessing.get_logger()
    logger.setLevel(logging.INFO)
    formatter = logging.Formatter(\
        '[%(asctime)s| %(levelname)s| %(processName)s] %(message)s')
    handler = logging.FileHandler('logs/your_file_name.log')
    handler.setFormatter(formatter)

    # this bit will make sure you won't have 
    # duplicated messages in the output
    if not len(logger.handlers): 
        logger.addHandler(handler)
    return logger 
```

在 init 中实例化记录器：

```
if __name__ == '__main__': 
    from multiprocessing import Pool
    logger = create_logger()
    logger.info('Starting pooling')
    p = Pool()
    # rest of the code 
```

现在，您只需在需要记录的每个函数中添加此引用：

```
logger = create_logger() 
```

并输出消息：

```
logger.info(f'My message from {something}') 
```

希望这可以帮助。

* * *

## 回答 #8

> 赞同：11
> 
>             
> 
> 时间：2013-10-16T07:31:34.927

通过使用处理程序，所有当前的解决方案都过于耦合到日志记录配置。我的解决方案具有以下架构和功能：

*   您可以使用*任何*您想要的日志记录配置

*   日志记录在守护线程中完成

*   使用上下文管理器安全关闭守护进程

*   与日志记录线程的通信由`multiprocessing.Queue`

*   在子流程中，`logging.Logger`（和已经定义的实例）被修补以将*所有*记录发送到队列

*   *新*：在发送到队列之前格式化回溯和消息以防止酸洗错误

带有使用示例和输出的代码可以在以下 Gist 中找到：[https ://gist.github.com/schlamar/7003737](https://gist.github.com/schlamar/7003737)

* * *

## 回答 #9

> 赞同：8
> 
>             
> 
> 时间：2016-10-19T09:11:43.140

由于我们可以将多进程日志记录表示为多个发布者和一个订阅者（侦听器），因此使用[ZeroMQ](http://zguide.zeromq.org/page:all)来实现 PUB-SUB 消息传递确实是一种选择。

此外，[PyZMQ](http://pyzmq.readthedocs.io)模块（ZMQ 的 Python 绑定）实现了[PUBHandler](http://pyzmq.readthedocs.io/en/latest/api/zmq.log.handlers.html#zmq.log.handlers.PUBHandler)，它是用于通过 zmq.PUB 套接字发布日志消息的对象。

网上有一个[解决方案](https://pyfunc.blogspot.co.il/2013/08/centralized-logging-for-distributed.html)，用于使用 PyZMQ 和 PUBHandler 从分布式应用程序集中记录日志，可以很容易地采用在本地处理多个发布进程。

```
formatters = {
    logging.DEBUG: logging.Formatter("[%(name)s] %(message)s"),
    logging.INFO: logging.Formatter("[%(name)s] %(message)s"),
    logging.WARN: logging.Formatter("[%(name)s] %(message)s"),
    logging.ERROR: logging.Formatter("[%(name)s] %(message)s"),
    logging.CRITICAL: logging.Formatter("[%(name)s] %(message)s")
}

# This one will be used by publishing processes
class PUBLogger:
    def __init__(self, host, port=config.PUBSUB_LOGGER_PORT):
        self._logger = logging.getLogger(__name__)
        self._logger.setLevel(logging.DEBUG)
        self.ctx = zmq.Context()
        self.pub = self.ctx.socket(zmq.PUB)
        self.pub.connect('tcp://{0}:{1}'.format(socket.gethostbyname(host), port))
        self._handler = PUBHandler(self.pub)
        self._handler.formatters = formatters
        self._logger.addHandler(self._handler)

    @property
    def logger(self):
        return self._logger

# This one will be used by listener process
class SUBLogger:
    def __init__(self, ip, output_dir="", port=config.PUBSUB_LOGGER_PORT):
        self.output_dir = output_dir
        self._logger = logging.getLogger()
        self._logger.setLevel(logging.DEBUG)

        self.ctx = zmq.Context()
        self._sub = self.ctx.socket(zmq.SUB)
        self._sub.bind('tcp://*:{1}'.format(ip, port))
        self._sub.setsockopt(zmq.SUBSCRIBE, "")

        handler = handlers.RotatingFileHandler(os.path.join(output_dir, "client_debug.log"), "w", 100 * 1024 * 1024, 10)
        handler.setLevel(logging.DEBUG)
        formatter = logging.Formatter("%(asctime)s;%(levelname)s - %(message)s")
        handler.setFormatter(formatter)
        self._logger.addHandler(handler)

  @property
  def sub(self):
      return self._sub

  @property
  def logger(self):
      return self._logger

#  And that's the way we actually run things:

# Listener process will forever listen on SUB socket for incoming messages
def run_sub_logger(ip, event):
    sub_logger = SUBLogger(ip)
    while not event.is_set():
        try:
            topic, message = sub_logger.sub.recv_multipart(flags=zmq.NOBLOCK)
            log_msg = getattr(logging, topic.lower())
            log_msg(message)
        except zmq.ZMQError as zmq_error:
            if zmq_error.errno == zmq.EAGAIN:
                pass

# Publisher processes loggers should be initialized as follows:

class Publisher:
    def __init__(self, stop_event, proc_id):
        self.stop_event = stop_event
        self.proc_id = proc_id
        self._logger = pub_logger.PUBLogger('127.0.0.1').logger

     def run(self):
         self._logger.info("{0} - Sending message".format(proc_id))

def run_worker(event, proc_id):
    worker = Publisher(event, proc_id)
    worker.run()

# Starting subscriber process so we won't loose publisher's messages
sub_logger_process = Process(target=run_sub_logger,
                                 args=('127.0.0.1'), stop_event,))
sub_logger_process.start()

#Starting publisher processes
for i in range(MAX_WORKERS_PER_CLIENT):
    processes.append(Process(target=run_worker,
                                 args=(stop_event, i,)))
for p in processes:
    p.start() 
```

* * *

## 回答 #10

> 赞同：6
> 
>             
> 
> 时间：2009-06-17T21:15:15.223

我也喜欢 zzzeek 的回答，但安德烈是正确的，需要一个队列来防止乱码。我对管道有一些运气，但确实看到了一些意料之中的乱码。实现它比我想象的要难，特别是由于在 Windows 上运行，对全局变量和东西有一些额外的限制（请参阅：[如何在 Windows 上实现 Python 多处理？](https://stackoverflow.com/questions/765129/hows-python-multiprocessing-implemented-on-windows)）

但是，我终于让它工作了。这个例子可能并不完美，所以欢迎提出意见和建议。它也不支持设置格式化程序或除根记录器以外的任何内容。基本上，您必须使用队列重新启动每个池进程中的记录器，并在记录器上设置其他属性。

同样，欢迎任何有关如何使代码更好的建议。我当然还不知道所有的 Python 技巧 :-)

```
import multiprocessing, logging, sys, re, os, StringIO, threading, time, Queue

class MultiProcessingLogHandler(logging.Handler):
    def __init__(self, handler, queue, child=False):
        logging.Handler.__init__(self)

        self._handler = handler
        self.queue = queue

        # we only want one of the loggers to be pulling from the queue.
        # If there is a way to do this without needing to be passed this
        # information, that would be great!
        if child == False:
            self.shutdown = False
            self.polltime = 1
            t = threading.Thread(target=self.receive)
            t.daemon = True
            t.start()

    def setFormatter(self, fmt):
        logging.Handler.setFormatter(self, fmt)
        self._handler.setFormatter(fmt)

    def receive(self):
        #print "receive on"
        while (self.shutdown == False) or (self.queue.empty() == False):
            # so we block for a short period of time so that we can
            # check for the shutdown cases.
            try:
                record = self.queue.get(True, self.polltime)
                self._handler.emit(record)
            except Queue.Empty, e:
                pass

    def send(self, s):
        # send just puts it in the queue for the server to retrieve
        self.queue.put(s)

    def _format_record(self, record):
        ei = record.exc_info
        if ei:
            dummy = self.format(record) # just to get traceback text into record.exc_text
            record.exc_info = None  # to avoid Unpickleable error

        return record

    def emit(self, record):
        try:
            s = self._format_record(record)
            self.send(s)
        except (KeyboardInterrupt, SystemExit):
            raise
        except:
            self.handleError(record)

    def close(self):
        time.sleep(self.polltime+1) # give some time for messages to enter the queue.
        self.shutdown = True
        time.sleep(self.polltime+1) # give some time for the server to time out and see the shutdown

    def __del__(self):
        self.close() # hopefully this aids in orderly shutdown when things are going poorly.

def f(x):
    # just a logging command...
    logging.critical('function number: ' + str(x))
    # to make some calls take longer than others, so the output is "jumbled" as real MP programs are.
    time.sleep(x % 3)

def initPool(queue, level):
    """
    This causes the logging module to be initialized with the necessary info
    in pool threads to work correctly.
    """
    logging.getLogger('').addHandler(MultiProcessingLogHandler(logging.StreamHandler(), queue, child=True))
    logging.getLogger('').setLevel(level)

if __name__ == '__main__':
    stream = StringIO.StringIO()
    logQueue = multiprocessing.Queue(100)
    handler= MultiProcessingLogHandler(logging.StreamHandler(stream), logQueue)
    logging.getLogger('').addHandler(handler)
    logging.getLogger('').setLevel(logging.DEBUG)

    logging.debug('starting main')

    # when bulding the pool on a Windows machine we also have to init the logger in all the instances with the queue and the level of logging.
    pool = multiprocessing.Pool(processes=10, initializer=initPool, initargs=[logQueue, logging.getLogger('').getEffectiveLevel()] ) # start worker processes
    pool.map(f, range(0,50))
    pool.close()

    logging.debug('done')
    logging.shutdown()
    print "stream output is:"
    print stream.getvalue() 
```

* * *

## 回答 #11

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T04:40:00.353

只需在某处发布您的记录器实例。这样，其他模块和客户端可以使用您的 API 来获取记录器，而无需`import multiprocessing`.

* * *

## 回答 #12

> 赞同：3
> 
>             
> 
> 时间：2009-06-06T13:59:52.723

我喜欢 zzzeek 的回答。我只是将管道替换为队列，因为如果多个线程/进程使用相同的管道端来生成日志消息，它们会出现乱码。

* * *

## 回答 #13

> 赞同：3
> 
>             
> 
> 时间：2021-04-19T16:05:21.213

[并发日志处理程序](https://github.com/Preston-Landers/concurrent-log-handler)似乎完美地完成了这项工作。在 Windows 上测试。还支持 POSIX 系统。

## 大意

*   使用返回记录器的函数创建一个单独的文件。记录器必须有`ConcurrentRotatingFileHandler`每个进程的新实例。下面给出的示例函数`get_logger()`。

*   创建记录器是在进程初始化时完成的。对于`multiprocessing.Process`子类，这意味着`run()`方法的开始。

## 详细说明

我这个例子，我会使用下面的文件结构

```
.
│-- child.py        <-- For a child process
│-- logs.py         <-- For setting up the logs for the app
│-- main.py         <-- For a main process
│-- myapp.py        <-- For starting the app
│-- somemodule.py   <-- For an example, a "3rd party module using standard logging" 
```

## 代码

### 子进程

```
# child.py 

import multiprocessing as mp
import time
from somemodule import do_something

class ChildProcess(mp.Process):
    def __init__(self):
        self.logger = None
        super().__init__()

    def run(self):
        from logs import get_logger
        self.logger = get_logger()

        while True:
            time.sleep(1)
            self.logger.info("Child process")
            do_something() 
```

*   简单的子进程继承`multiprocessing.Process`并简单地记录到文件文本“子进程”

*   **重要提示**：在子进程内或其他地方（*不是*模块级别或在子进程内`get_logger()`）调用。这是创建实例所必需的，并且每个进程都需要新实例。`run()`*`__init__()``get_logger()``ConcurrentRotatingFileHandler`*
 **   仅用于演示这`do_something`适用于 3rd 方库代码，它不知道您正在使用并发日志处理程序。* 

 *### 主要流程

```
# main.py

import logging
import multiprocessing as mp
import time

from child import ChildProcess
from somemodule import do_something

class MainProcess(mp.Process):
    def __init__(self):
        self.logger = logging.getLogger()
        super().__init__()

    def run(self):
        from logs import get_logger

        self.logger = get_logger()
        self.child = ChildProcess()
        self.child.daemon = True
        self.child.start()

        while True:
            time.sleep(0.5)
            self.logger.critical("Main process")
            do_something() 
```

*   每秒两次登录文件的主进程“主进程”。也继承自`multiprocessing.Process`.

*   与子进程相同的注释`get_logger()`和应用。`do_something()`

### 记录仪设置

```
# logs.py

import logging
import os

from concurrent_log_handler import ConcurrentRotatingFileHandler

LOGLEVEL = logging.DEBUG

def get_logger():
    logger = logging.getLogger()

    if logger.handlers:
        return logger

    # Use an absolute path to prevent file rotation trouble.
    logfile = os.path.abspath("mylog.log")

    logger.setLevel(LOGLEVEL)

    # Rotate log after reaching 512K, keep 5 old copies.
    filehandler = ConcurrentRotatingFileHandler(
        logfile, mode="a", maxBytes=512 * 1024, backupCount=5, encoding="utf-8"
    )
    filehandler.setLevel(LOGLEVEL)

    # create also handler for displaying output in the stdout
    ch = logging.StreamHandler()
    ch.setLevel(LOGLEVEL)

    formatter = logging.Formatter(
        "%(asctime)s - %(module)s - %(levelname)s - %(message)s [Process: %(process)d, %(filename)s:%(funcName)s(%(lineno)d)]"
    )

    # add formatter to ch
    ch.setFormatter(formatter)
    filehandler.setFormatter(formatter)

    logger.addHandler(ch)
    logger.addHandler(filehandler)

    return logger 
```

*   这使用`ConcurrentRotatingFileHandler`  来自 concurrent-log-handler 包。每个进程都需要一个新的 ConcurrentRotatingFileHandler 实例。

*   请注意，`ConcurrentRotatingFileHandler`每个进程中的所有参数都应该相同。

### 示例应用

```
# myapp.py 

if __name__ == "__main__":
    from main import MainProcess

    p = MainProcess()
    p.start() 
```

*   只是一个关于如何启动多进程应用程序的简单示例

### 使用标准的第 3 方模块示例`logging`

```
# somemodule.py 

import logging

logger = logging.getLogger("somemodule")

def do_something():
    logging.info("doing something") 
```

*   只是一个简单的例子来测试来自 3rd 方代码的记录器是否可以正常工作。

### 示例输出

```
2021-04-19 19:02:29,425 - main - CRITICAL - Main process [Process: 103348, main.py:run(23)]
2021-04-19 19:02:29,427 - somemodule - INFO - doing something [Process: 103348, somemodule.py:do_something(7)]
2021-04-19 19:02:29,929 - main - CRITICAL - Main process [Process: 103348, main.py:run(23)]
2021-04-19 19:02:29,931 - somemodule - INFO - doing something [Process: 103348, somemodule.py:do_something(7)]
2021-04-19 19:02:30,133 - child - INFO - Child process [Process: 76700, child.py:run(18)]
2021-04-19 19:02:30,137 - somemodule - INFO - doing something [Process: 76700, somemodule.py:do_something(7)]
2021-04-19 19:02:30,436 - main - CRITICAL - Main process [Process: 103348, main.py:run(23)]
2021-04-19 19:02:30,439 - somemodule - INFO - doing something [Process: 103348, somemodule.py:do_something(7)]
2021-04-19 19:02:30,944 - main - CRITICAL - Main process [Process: 103348, main.py:run(23)]
2021-04-19 19:02:30,946 - somemodule - INFO - doing something [Process: 103348, somemodule.py:do_something(7)]
2021-04-19 19:02:31,142 - child - INFO - Child process [Process: 76700, child.py:run(18)]
2021-04-19 19:02:31,145 - somemodule - INFO - doing something [Process: 76700, somemodule.py:do_something(7)]
2021-04-19 19:02:31,449 - main - CRITICAL - Main process [Process: 103348, main.py:run(23)]
2021-04-19 19:02:31,451 - somemodule - INFO - doing something [Process: 103348, somemodule.py:do_something(7)] 
```

* * *

## 回答 #14

> 赞同：2
> 
>             
> 
> 时间：2014-03-12T23:13:44.430

将所有日志记录委托给另一个从队列中读取所有日志条目的进程怎么样？

```
LOG_QUEUE = multiprocessing.JoinableQueue()

class CentralLogger(multiprocessing.Process):
    def __init__(self, queue):
        multiprocessing.Process.__init__(self)
        self.queue = queue
        self.log = logger.getLogger('some_config')
        self.log.info("Started Central Logging process")

    def run(self):
        while True:
            log_level, message = self.queue.get()
            if log_level is None:
                self.log.info("Shutting down Central Logging process")
                break
            else:
                self.log.log(log_level, message)

central_logger_process = CentralLogger(LOG_QUEUE)
central_logger_process.start() 
```

只需通过任何多进程机制甚至继承共享 LOG_QUEUE 即可，一切正常！

* * *

## 回答 #15

> 赞同：2
> 
>             
> 
> 时间：2016-06-01T06:57:48.777

下面是一个可以在 Windows 环境下使用的类，需要 ActivePython。您还可以继承其他日志处理程序（StreamHandler 等）

```
class SyncronizedFileHandler(logging.FileHandler):
    MUTEX_NAME = 'logging_mutex'

    def __init__(self , *args , **kwargs):

        self.mutex = win32event.CreateMutex(None , False , self.MUTEX_NAME)
        return super(SyncronizedFileHandler , self ).__init__(*args , **kwargs)

    def emit(self, *args , **kwargs):
        try:
            win32event.WaitForSingleObject(self.mutex , win32event.INFINITE)
            ret = super(SyncronizedFileHandler , self ).emit(*args , **kwargs)
        finally:
            win32event.ReleaseMutex(self.mutex)
        return ret 
```

这是一个演示用法的示例：

```
import logging
import random , time , os , sys , datetime
from string import letters
import win32api , win32event
from multiprocessing import Pool

def f(i):
    time.sleep(random.randint(0,10) * 0.1)
    ch = random.choice(letters)
    logging.info( ch * 30)

def init_logging():
    '''
    initilize the loggers
    '''
    formatter = logging.Formatter("%(levelname)s - %(process)d - %(asctime)s - %(filename)s - %(lineno)d - %(message)s")
    logger = logging.getLogger()
    logger.setLevel(logging.INFO)

    file_handler = SyncronizedFileHandler(sys.argv[1])
    file_handler.setLevel(logging.INFO)
    file_handler.setFormatter(formatter)
    logger.addHandler(file_handler)

#must be called in the parent and in every worker process
init_logging() 

if __name__ == '__main__':
    #multiprocessing stuff
    pool = Pool(processes=10)
    imap_result = pool.imap(f , range(30))
    for i , _ in enumerate(imap_result):
        pass 
```

* * *

## 回答 #16

> 赞同：2
> 
>             
> 
> 时间：2021-03-06T02:53:09.677

我想建议使用 logger_tt 库：   [https ://github.com/Dragon2fly/logger_tt](https://github.com/Dragon2fly/logger_tt)

multiporcessing_logging 库在我的 macOSX 上不起作用，而 logger_tt 可以。

* * *

## 回答 #17

> 赞同：1
> 
>             
> 
> 时间：2010-08-05T06:11:37.660

我有一个类似于 Ironhacker 的解决方案，除了我在我的一些代码中使用 logging.exception 并发现我需要在将异常传递回队列之前格式化异常，因为回溯不是 pickle'able：

```
class QueueHandler(logging.Handler):
    def __init__(self, queue):
        logging.Handler.__init__(self)
        self.queue = queue
    def emit(self, record):
        if record.exc_info:
            # can't pass exc_info across processes so just format now
            record.exc_text = self.formatException(record.exc_info)
            record.exc_info = None
        self.queue.put(record)
    def formatException(self, ei):
        sio = cStringIO.StringIO()
        traceback.print_exception(ei[0], ei[1], ei[2], None, sio)
        s = sio.getvalue()
        sio.close()
        if s[-1] == "\n":
            s = s[:-1]
        return s 
```

* * *

## 回答 #18

> 赞同：1
> 
>             
> 
> 时间：2016-09-13T16:55:19.867

这是我的简单黑客/解决方法......不是最全面的，但我认为比我在写这篇文章之前找到的任何其他答案更容易修改和更容易阅读和理解：

```
import logging
import multiprocessing

class FakeLogger(object):
    def __init__(self, q):
        self.q = q
    def info(self, item):
        self.q.put('INFO - {}'.format(item))
    def debug(self, item):
        self.q.put('DEBUG - {}'.format(item))
    def critical(self, item):
        self.q.put('CRITICAL - {}'.format(item))
    def warning(self, item):
        self.q.put('WARNING - {}'.format(item))

def some_other_func_that_gets_logger_and_logs(num):
    # notice the name get's discarded
    # of course you can easily add this to your FakeLogger class
    local_logger = logging.getLogger('local')
    local_logger.info('Hey I am logging this: {} and working on it to make this {}!'.format(num, num*2))
    local_logger.debug('hmm, something may need debugging here')
    return num*2

def func_to_parallelize(data_chunk):
    # unpack our args
    the_num, logger_q = data_chunk
    # since we're now in a new process, let's monkeypatch the logging module
    logging.getLogger = lambda name=None: FakeLogger(logger_q)
    # now do the actual work that happens to log stuff too
    new_num = some_other_func_that_gets_logger_and_logs(the_num)
    return (the_num, new_num)

if __name__ == '__main__':
    multiprocessing.freeze_support()
    m = multiprocessing.Manager()
    logger_q = m.Queue()
    # we have to pass our data to be parallel-processed
    # we also need to pass the Queue object so we can retrieve the logs
    parallelable_data = [(1, logger_q), (2, logger_q)]
    # set up a pool of processes so we can take advantage of multiple CPU cores
    pool_size = multiprocessing.cpu_count() * 2
    pool = multiprocessing.Pool(processes=pool_size, maxtasksperchild=4)
    worker_output = pool.map(func_to_parallelize, parallelable_data)
    pool.close() # no more tasks
    pool.join()  # wrap up current tasks
    # get the contents of our FakeLogger object
    while not logger_q.empty():
        print logger_q.get()
    print 'worker output contained: {}'.format(worker_output) 
```

* * *

## 回答 #19

> 赞同：1
> 
>             
> 
> 时间：2018-04-07T02:55:58.693

有这个很棒的包裹

包：
 [https ://pypi.python.org/pypi/multiprocessing-logging/](https://pypi.python.org/pypi/multiprocessing-logging/)

代码：
 [https ://github.com/jruere/multiprocessing-logging](https://github.com/jruere/multiprocessing-logging)

安装：

```
pip install multiprocessing-logging 
```

然后加：

```
import multiprocessing_logging

# This enables logs inside process
multiprocessing_logging.install_mp_handler() 
```

* * *

## 回答 #20

> 赞同：1
> 
>             
> 
> 时间：2020-01-15T22:51:15.583

对于可能需要这个的人，我为 multiprocessing_logging 包编写了一个装饰器，它将当前进程名称添加到日志中，因此可以清楚谁记录了什么。

它还运行 install_mp_handler() 因此在创建池之前运行它变得无用。

这让我可以看到哪个工作人员创建了哪些日志消息。

这是带有示例的蓝图：

```
import sys
import logging
from functools import wraps
import multiprocessing
import multiprocessing_logging

# Setup basic console logger as 'logger'
logger = logging.getLogger()
console_handler = logging.StreamHandler(sys.stdout)
console_handler.setFormatter(logging.Formatter(u'%(asctime)s :: %(levelname)s :: %(message)s'))
logger.setLevel(logging.DEBUG)
logger.addHandler(console_handler)

# Create a decorator for functions that are called via multiprocessing pools
def logs_mp_process_names(fn):
    class MultiProcessLogFilter(logging.Filter):
        def filter(self, record):
            try:
                process_name = multiprocessing.current_process().name
            except BaseException:
                process_name = __name__
            record.msg = f'{process_name} :: {record.msg}'
            return True

    multiprocessing_logging.install_mp_handler()
    f = MultiProcessLogFilter()

    # Wraps is needed here so apply / apply_async know the function name
    @wraps(fn)
    def wrapper(*args, **kwargs):
        logger.removeFilter(f)
        logger.addFilter(f)
        return fn(*args, **kwargs)

    return wrapper

# Create a test function and decorate it
@logs_mp_process_names
def test(argument):
    logger.info(f'test function called via: {argument}')

# You can also redefine undecored functions
def undecorated_function():
    logger.info('I am not decorated')

@logs_mp_process_names
def redecorated(*args, **kwargs):
    return undecorated_function(*args, **kwargs)

# Enjoy
if __name__ == '__main__':
    with multiprocessing.Pool() as mp_pool:
        # Also works with apply_async
        mp_pool.apply(test, ('mp pool',))
        mp_pool.apply(redecorated)
        logger.info('some main logs')
        test('main program') 
```

* * *

## 回答 #21

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T04:40:17.607

一种替代方法是将多处理日志写入已知文件并注册一个`atexit`处理程序以加入这些进程，然后在 stderr 上读取它；但是，您不会以这种方式获得到 stderr 上输出消息的实时流。

* * *

## 回答 #22

> 赞同：0
> 
>             
> 
> 时间：2015-03-26T12:04:40.203

如果您在模块中的锁、线程和分叉组合中发生死锁`logging`，则会在[错误报告 6721](http://bugs.python.org/issue6721)中报告（另请参见[相关的 SO 问题](https://stackoverflow.com/questions/24509650)）。

[这里](https://github.com/google/python-atfork/blob/master/atfork/stdlib_fixer.py)发布了一个小的修复解决方案。

但是，这只会解决`logging`. 这并不能解决事情可能会出现乱码的问题。请参阅此处提供的其他答案。

* * *

## 回答 #23

> 赞同：0
> 
>             
> 
> 时间：2019-10-05T06:38:04.817

提到的最简单的想法：

*   获取当前进程的文件名和进程 ID。

*   设置一个`[WatchedFileHandler][1]`. [此处](https://www.packetmischief.ca/2017/10/25/3-ways-to-fail-at-logging-with-flask/)详细讨论了此处理程序的原因，但简而言之，其他日志处理程序存在某些更糟糕的竞争条件。这个具有最短的竞争条件窗口。

    *   选择将日志保存到的路径，例如 /var/log/...

# c# - “处理程序”模式？

> ID：641426
> 
>         
> 
> 赞同：15
> 
>         
> 
> 时间：2009-03-13T04:06:48.607
> 
>         
> 
> 标签：c#, .net, design-patterns

我遇到了一种被称为“处理程序模式”的设计模式，但我在任何地方都找不到对该模式的任何真正引用。它基本上只是一个单一方法接口，允许您轻松扩展后端的功能，而无需重新编译客户端。对于必须处理许多不同类型的请求的 Web 服务可能很有用。这是一个例子：

```
public interface IHandler
{
    IDictionary<string, string> Handle(IDictionary<string, string> args);
} 
```

args 通常会包含一个键，例如“Action”，其值告诉实现该做什么。可以传入额外的参数来为 impl 提供更多信息。然后 impl 传回客户端“应该”理解的任意参数列表。

这是一种反模式，还是另一种伪装的模式？推荐这种类型的设计吗？

编辑：更多信息：按照我看到的实现方式，“根”处理程序将充当其他具体处理程序的调度程序（也许？）。根处理程序有一个“HandlerResolver”，它根据消息的内容决定哪个具体的处理程序应该获取消息。也许它实际上就像一个“调度程序”模式，虽然我也不知道这是否真的是一个模式。我猜它的根中也可能有一个责任链模式，它允许您将一堆具体的处理程序链接在一起，然后让他们决定哪个处理它。

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2009-03-13T04:36:32.950

这是对没有它们的语言进行闭包的 OOP 方式。它没有“模式”名称，因为在函数式语言中它是显而易见的工作方式。在 OOP 语言上，OTOH，你必须做一些工作，所以它似乎是一个可命名的成语。“处理程序”听起来不错。

（这不是单例，顺便说一句）

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T04:20:57.590

我以“SingletonRegistry”的名义使用它

看到[这个线程](https://stackoverflow.com/questions/401720/brokered-definition-set-design-pattern-well-known-under-another-name)

我已经用过几次了。特别是当要采取的行动是未知的（在设计的第一阶段）或应用程序应该支持极大的灵活性时。

我从文件或数据库加载字典，并创建将在某个“键”下处理请求的类的单个实例。

我发现这个[类也在](http://code.google.com/p/toxiclibs/source/browse/trunk/toxiclibs/src.prefs/toxi/util/datatypes/SingletonRegistry.java?spec=svn144&r=144)网上搜索那个名字。

好像不是一样的？

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T04:26:56.000

因为您在帖子中使用了“动作”一词，所以我相信这可能是命令模式的一部分。查看 Wiki 并搜索“处理程序”...也许这会提供更多见解。

[http://en.wikipedia.org/wiki/Command_pattern](http://en.wikipedia.org/wiki/Command_pattern)

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:11:27.770

我不知道它是否真的被推荐，但实际上我不得不在我编写的一些 MATLAB 应用程序中使用这种模式来模拟对象的类似引用的行为（现在对于新版本来说这是不必要的）。

具有讽刺意味的是，我实际上将函数称为“处理程序”。我的对象只存储了一个包含函数句柄引用 (@handler) 的字段，而方法只是调用此函数的包装器。例如，对象的重载 GET 函数将调用：

```
object.handler('get',...input argument list...) 
```

我不确定这是否被认为是其他语言的“好”设计选择。我选择它是出于必要，因为它是我在 MATLAB 中创建类似引用行为的唯一方法（处理函数可以访问初始化数据的工作区，我不必传入和传出各种方法调用）。最新版本的 MATLAB 现在有一个 HANDLE 类，可以以更简洁的方式完成这些工作。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T05:23:13.213

我认为受 COM 影响的设计可以更好地实现避免重新编译的目标。您从中获得了哪些额外的灵活性：

```
IHandler UserHandler = ...;

Dictionary<string,string> result = UserHandler.Handle(
    new Dictionary<string, string>{
        { "Action", "AddUser" },
        { "UserName", "Joe Bloggs" },
        { "Age", "23" } });
NewUserId = Int.Parse(result["UserId"]); 
```

超过：

```
IUserHandler UserHandler = ...;

AddUserResult result = UserHandler.AddUser(new AddUserArgs {
    UserName = "Joe Bloggs",
    Age = 23 });
NewUserId = result.UserId; 
```

当您可以扩展操作、结果和参数时：

```
IUserHandler UserHandler = ...;

AddUserResult2 result = UserHandler.AddUser(new AddUserArgs2 {
    UserName = "Joe Bloggs",
    Age = 23,
    Password = "xyzzy" });
NewUserId = result.UserId;
SessionId = result.SessionId;

IUserHandler2 UserHandler2 = UserHandler as IUserHandler2;
if (UserHandler2 != null)
{
    LoginUserResult loginResult = UserHandler2.LoginUser(new LoginUserArgs {
        UserId = NewUserId,
        SessionId = SessionId,
        Password = "xyzzy" });
} 
```

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2015-01-19T01:00:27.573

我已经在遗留代码库中看到了“处理程序”类，尤其是对于 Web 服务。不过，从我所见，这些通常会变成适配器、外观或一些类似的模式，并最终被称为处理程序，因为它正在处理请求。

# parsing - 我如何知道 PDF 页面是彩色的还是黑白的？

> ID：641427
> 
>         
> 
> 赞同：63
> 
>         
> 
> 时间：2009-03-13T04:07:12.927
> 
>         
> 
> 标签：parsing, pdf, colors, automation, printers

给定一组PDF文件，其中一些页面是彩色的，其余页面是黑白的，是否有任何程序可以在给定的页面中找出哪些是彩色的，哪些是黑白的？这将很有用，例如，在打印论文时，只需花费额外的费用来打印彩色页面。考虑到双面打印的人的奖励积分，如果它后面是彩色页面，则将适当的黑白页面发送到彩色打印机。

* * *

## 回答 #1

> 赞同：29
> 
>             
> 
> 时间：2009-03-15T12:28:39.640

这是我见过的最有趣的问题之一！我同意其他一些帖子，即渲染到位图然后分析位图将是最可靠的解决方案。对于简单的 PDF，这是一种更快但不太完整的方法。

1.  解析每个 PDF 页面

2.  查找颜色指令（g、rg、k、sc、scn 等）

3.  寻找嵌入的图像，分析颜色

我下面的解决方案是#1 和#2 的一半。#2 的另一半是跟进用户定义的颜色，这涉及在页面中查找 /ColorSpace 条目并对其进行解码——如果您对此感兴趣，请离线联系我，因为它非常可行但不是5分钟。

首先是主程序：

```
use CAM::PDF;

my $infile = shift;
my $pdf = CAM::PDF->new($infile);
PAGE:
for my $p (1 .. $pdf->numPages) {
   my $tree = $pdf->getPageContentTree($p);
   if (!$tree) {
      print "Failed to parse page $p\n";
      next PAGE;
   }
   my $colors = $tree->traverse('My::Renderer::FindColors')->{colors};
   my $uncertain = 0;
   for my $color (@{$colors}) {
      my ($name, @rest) = @{$color};
      if ($name eq 'g') {
      } elsif ($name eq 'rgb') {
         my ($r, $g, $b) = @rest;
         if ($r != $g || $r != $b) {
            print "Page $p is color\n";
            next PAGE;
         }
      } elsif ($name eq 'cmyk') {
         my ($c, $m, $y, $k) = @rest;
         if ($c != 0 || $m != 0 || $y != 0) {
            print "Page $p is color\n";
            next PAGE;
         }
      } else {
         $uncertain = $name;
      }
   }
   if ($uncertain) {
      print "Page $p has user-defined color ($uncertain), needs more investigation\n";
   } else {
      print "Page $p is grayscale\n";
   }
} 
```

然后是处理每个页面上的颜色指令的辅助渲染器：

```
package My::Renderer::FindColors;

sub new {
   my $pkg = shift;
   return bless { colors => [] }, $pkg;
}
sub clone {
   my $self = shift;
   my $pkg = ref $self;
   return bless { colors => $self->{colors}, cs => $self->{cs}, CS => $self->{CS} }, $pkg;
}
sub rg {
   my ($self, $r, $g, $b) = @_;
   push @{$self->{colors}}, ['rgb', $r, $g, $b];
}
sub g {
   my ($self, $gray) = @_;
   push @{$self->{colors}}, ['rgb', $gray, $gray, $gray];
}
sub k {
   my ($self, $c, $m, $y, $k) = @_;
   push @{$self->{colors}}, ['cmyk', $c, $m, $y, $k];
}
sub cs {
   my ($self, $name) = @_;
   $self->{cs} = $name;
}
sub cs {
   my ($self, $name) = @_;
   $self->{CS} = $name;
}
sub _sc {
   my ($self, $cs, @rest) = @_;
   return if !$cs; # syntax error                                                                                             
   if ($cs eq 'DeviceRGB') { $self->rg(@rest); }
   elsif ($cs eq 'DeviceGray') { $self->g(@rest); }
   elsif ($cs eq 'DeviceCMYK') { $self->k(@rest); }
   else { push @{$self->{colors}}, [$cs, @rest]; }
}
sub sc {
   my ($self, @rest) = @_;
   $self->_sc($self->{cs}, @rest);
}
sub SC {
   my ($self, @rest) = @_;
   $self->_sc($self->{CS}, @rest);
}
sub scn { sc(@_); }
sub SCN { SC(@_); }
sub RG { rg(@_); }
sub G { g(@_); }
sub K { k(@_); } 
```

* * *

## 回答 #2

> 赞同：23
> 
>             
> 
> 时间：2015-02-06T15:52:52.737

较新版本的[Ghostscript](http://www.ghostscript.com)（9.05 及更高版本）包括一个名为 inkcov 的“设备”。它以青色 (C)、品红色 (M)、黄色 (Y) 和黑色 (K) 值计算每页（不是每个图像）的墨水覆盖率，其中 0.00000 表示 0%，1.00000 表示 100%（请参阅*[检测所有包含颜色的页面](https://tex.stackexchange.com/a/61216/7770)*）。

例如：

```
$ gs -q -o - -sDEVICE=inkcov file.pdf 
0.11264  0.11605  0.11605  0.09364 CMYK OK
0.11260  0.11601  0.11601  0.09360 CMYK OK 
```

如果 CMY 值不为 0，则页面为彩色。

要仅输出包含颜色的页面，请使用这个方便的 oneliner：

```
$ gs -o - -sDEVICE=inkcov file.pdf |tail -n +4 |sed '/^Page*/N;s/\n//'|sed -E '/Page [0-9]+ 0.00000  0.00000  0.00000  / d' 
```

* * *

## 回答 #3

> 赞同：15
> 
>             
> 
> 时间：2012-04-26T22:11:04.677

可以使用[Image Magick](http://www.imagemagick.org/)工具`identify`。如果在 PDF 页面上使用，它首先将页面转换为光栅图像。如果页面包含颜色可以使用`-format "%[colorspace]"`选项进行测试，对于我的 PDF 打印`Gray`或者`RGB`. 恕我直言`identify`（或它在背景中使用的任何工具；Ghostscript？）确实根据颜色的呈现选择色彩空间。

一个例子是：

```
identify -format "%[colorspace]" $FILE.pdf[$PAGE] 
```

其中 PAGE 是从 0 开始的页面，而不是 1。如果不使用页面选择，所有页面都将折叠为一，这不是您想要的。

我编写了以下 BASH 脚本，该脚本用于`pdfinfo`获取页数，然后循环遍历它们。输出彩色页面。我还为双面文档添加了一项功能，您可能还需要非彩色背面页面。

使用输出的空格分隔列表，可以使用以下方法提取彩色 PDF 页面`pdftk`：

```
pdftk $FILE cat $PAGELIST output color_${FILE}.pdf 
```

* * *

```
#!/bin/bash

FILE=$1
PAGES=$(pdfinfo ${FILE} | grep 'Pages:' | sed 's/Pages:\s*//')

GRAYPAGES=""
COLORPAGES=""
DOUBLECOLORPAGES=""

echo "Pages: $PAGES"
N=1
while (test "$N" -le "$PAGES")
do
    COLORSPACE=$( identify -format "%[colorspace]" "$FILE[$((N-1))]" )
    echo "$N: $COLORSPACE"
    if [[ $COLORSPACE == "Gray" ]]
    then
        GRAYPAGES="$GRAYPAGES $N"
    else
        COLORPAGES="$COLORPAGES $N"
        # For double sided documents also list the page on the other side of the sheet:
        if [[ $((N%2)) -eq 1 ]]
        then
            DOUBLECOLORPAGES="$DOUBLECOLORPAGES $N $((N+1))"
            #N=$((N+1))
        else
            DOUBLECOLORPAGES="$DOUBLECOLORPAGES $((N-1)) $N"
        fi
    fi
    N=$((N+1))
done

echo $DOUBLECOLORPAGES
echo $COLORPAGES
echo $GRAYPAGES
#pdftk $FILE cat $COLORPAGES output color_${FILE}.pdf 
```

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2012-11-14T15:30:37.047

Martin Scharrer 的剧本很棒。它包含一个小错误：它计算两个包含颜色并且直接连续两次的页面。我修好了。此外，该脚本现在对页面进行计数并列出用于双页打印的灰度页面。它还打印逗号分隔的页面，因此输出可以直接用于从 PDF 查看器打印。我已经添加了代码，但你也可以[在这里](https://dl.dropbox.com/u/6649639/Scripts/identifyColoredPagesInPDF.sh)下载。

干杯，时移

```
#!/bin/bash

if [ $# -ne 1 ] 
then
    echo "USAGE: This script needs exactly one paramter: the path to the PDF"
    kill -SIGINT $$
fi

FILE=$1
PAGES=$(pdfinfo ${FILE} | grep 'Pages:' | sed 's/Pages:\s*//')

GRAYPAGES=""
COLORPAGES=""
DOUBLECOLORPAGES=""
DOUBLEGRAYPAGES=""
OLDGP=""
DOUBLEPAGE=0
DPGC=0
DPCC=0
SPGC=0
SPCC=0

echo "Pages: $PAGES"
N=1
while (test "$N" -le "$PAGES")
do
    COLORSPACE=$( identify -format "%[colorspace]" "$FILE[$((N-1))]" )
    echo "$N: $COLORSPACE"
    if [[ $DOUBLEPAGE -eq -1 ]]
    then
    DOUBLEGRAYPAGES="$OLDGP"
    DPGC=$((DPGC-1))
    DOUBLEPAGE=0
    fi
    if [[ $COLORSPACE == "Gray" ]]
    then
        GRAYPAGES="$GRAYPAGES,$N"
    SPGC=$((SPGC+1))
    if [[ $DOUBLEPAGE -eq 0 ]]
    then
        OLDGP="$DOUBLEGRAYPAGES"
        DOUBLEGRAYPAGES="$DOUBLEGRAYPAGES,$N"
        DPGC=$((DPGC+1))
    else 
        DOUBLEPAGE=0
    fi
    else
        COLORPAGES="$COLORPAGES,$N"
    SPCC=$((SPCC+1))
        # For double sided documents also list the page on the other side of the sheet:
        if [[ $((N%2)) -eq 1 ]]
        then
            DOUBLECOLORPAGES="$DOUBLECOLORPAGES,$N,$((N+1))"
        DOUBLEPAGE=$((N+1))
        DPCC=$((DPCC+2))
            #N=$((N+1))
        else
        if [[ $DOUBLEPAGE -eq 0 ]]
        then 
                DOUBLECOLORPAGES="$DOUBLECOLORPAGES,$((N-1)),$N"
        DPCC=$((DPCC+2))
        DOUBLEPAGE=-1
        elif [[ $DOUBLEPAGE -gt 0 ]]
        then
        DOUBLEPAGE=0            
        fi                      
        fi
    fi
    N=$((N+1))
done

echo " "
echo "Double-paged printing:"
echo "  Color($DPCC): ${DOUBLECOLORPAGES:1:${#DOUBLECOLORPAGES}-1}"
echo "  Gray($DPGC): ${DOUBLEGRAYPAGES:1:${#DOUBLEGRAYPAGES}-1}"
echo " "
echo "Single-paged printing:"
echo "  Color($SPCC): ${COLORPAGES:1:${#COLORPAGES}-1}"
echo "  Gray($SPGC): ${GRAYPAGES:1:${#GRAYPAGES}-1}"
#pdftk $FILE cat $COLORPAGES output color_${FILE}.pdf 
```

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T04:31:58.513

ImageMagick 有一些用于图像比较的内置方法。

[http://www.imagemagick.org/Usage/compare/#type_general](http://www.imagemagick.org/Usage/compare/#type_general)

ImageMagick 有一些 Perl API，所以如果您巧妙地将这些 API 与 PDF 到图像转换器结合起来，您可能会找到一种方法来进行黑白测试。

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T04:34:24.873

我会尝试这样做，尽管可能有其他更简单的解决方案，我很想听到它们，我只是想尝试一下：

1.  循环遍历所有页面

2.  将页面提取到图像

3.  验证图像的颜色范围

对于页数，您可能无需花费太多精力就可以将其转换[为](http://code.activestate.com/recipes/496837/)Perl。它基本上是一个正则表达式。也有人[说](http://webui.sourcelabs.com/cups/mail/user/threads/Alternative_way_to_find_no._of_pages_inside_PDF%253F.meta)：

> r"(/Type)\s?(/Page)[/>\s]"
> 
>   
>   
> 
> 您只需计算此正则表达式在 PDF 文件中出现的次数，减去您找到字符串“<>”（未呈现的空年龄）的次数。

要提取图像，您可以使用[ImageMagick](http://www.imagemagick.org/script/perl-magick.php)来执行[此](http://www.imagemagick.org/discourse-server/viewtopic.php?f=1&t=5243&view=previous)操作。或者看到[这个问题](https://stackoverflow.com/questions/430707/how-can-i-extract-images-from-a-pdf-file)。

最后，要确定它是否是黑白的，这取决于您的意思是字面上的黑白还是灰度。对于黑白，您应该只在所有图像中使用黑白。如果你想看灰度，现在，这真的不是我的专长，但我想你可以看看红色、绿色和蓝色的平均值是否接近，或者原始图像和[灰度转换](http://ubuntuforums.org/showthread.php?t=663059)后的图像是否接近彼此。

希望它能给你一些提示，帮助你走得更远。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2020-08-31T18:58:32.260

这是适用于 Windows 的 ghostscript 解决方案，它需要来自 GnuWin 的 grep ( [http://gnuwin32.sourceforge.net/packages/grep.htm](http://gnuwin32.sourceforge.net/packages/grep.htm) )：

单色（黑白）页面：

`gswin64c -q  -o - -sDEVICE=inkcov DOCUMENT.pdf | grep "^ 0.00000  0.00000  0.00000" | find /c /v ""`

彩页：

`gswin64c -q  -o - -sDEVICE=inkcov DOCUMENT.pdf | grep -v "^ 0.00000  0.00000  0.00000" | find /c /v ""`

总页数（您可以从任何 pdf 阅读器中更轻松地获得这一页）：

`gswin64c -q  -o - -sDEVICE=inkcov DOCUMENT.pdf | find /c /v ""`

# mysql - 从文本文件中的术语列表创建 MySQL 表

> ID：641438
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T04:13:30.353
> 
>         
> 
> 标签：mysql, database, linux, text, field

我有一个文本文件，其中包含一长串术语（大约 800 个），格式按字母顺序排列：

```
一个字
字
cword
...

```

我想使用这个文件来创建一个新的 MySQL 表，其中每个术语都是一个字段，都具有属性 VARCHAR(5)。

如果字段按照它们在文件中出现的顺序插入，那将是最好的，因为我也在脚本中使用此文件进行内容分析，如果在将数据插入时保持（字母）顺序会更容易这个新表。

对于那些好奇的人，我是一名学生，正在做一个涉及内容分析的科学史论文项目。这些字段将用于保存频率数据。将有另一个字段作为主键并将这些字段与其他数据链接。我不是程序员，但确实有 10 年运行 linux 的经验，并且通常能够解决问题。然而，谷歌在这里让我失望了。

编辑

所以 Damoviso 指出我真正需要做的是将文件转换为 mySQL 命令。我使用 awk 和 uniq 生成以下内容：

```
CREATE TABLE keyterms_frq (
    filename VARCHAR(20),
    apperception VARCHAR(5),
    behaviorism VARCHAR(5),
    behavioristic VARCHAR(5),
    behaviorists VARCHAR(5),
    behaviorist VARCHAR(5),
    behavior VARCHAR(5),
    behaviour VARCHAR(5),
    brain VARCHAR(5),
    conditioned VARCHAR(5),
    conditioning VARCHAR(5),
    condition VARCHAR(5),
    consciousness VARCHAR(5),
    conscious VARCHAR(5),
    experienced VARCHAR(5),
    experiences VARCHAR(5),
    experience VARCHAR(5),
    intellect VARCHAR(5),
    introspections VARCHAR(5),
    introspection VARCHAR(5),
    introspectively VARCHAR(5),
    introspective VARCHAR(5),
    intuition VARCHAR(5),
    memoryimage VARCHAR(5),
    memory VARCHAR(5),
    mentality VARCHAR(5),
    mentally VARCHAR(5),
    mental VARCHAR(5),
    mind VARCHAR(5),
    mirrorscript VARCHAR(5),
    mirrorwriting VARCHAR(5),
    unconditioned VARCHAR(5)
); 
```

不幸的是，它仍然无法正常工作，因为它会生成以下内容：

> ERROR 1064 (42000)：您的 SQL 语法有错误；检查与您的 MySQL 服务器版本相对应的手册，以在第 1 行的“条件 VARCHAR(5)、意识 VARCHAR(5)、有意识 VARCHAR(5)、经验”附近使用正确的语法

我最初认为我可以生成的字段数量是有限的，但这似乎不是问题

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T05:10:34.100

就个人而言（我知道这可能不会流行），但我倾向于使用 Excel 和类似 Textpad 或 Notepad++（甚至香草记事本）的东西来进行一次性数据库插入和像这样的表创建。

导入文本文件，以便将每个单词放在一个新行中，根据需要对它们进行排序，然后通过在顶部和底部插入列和一行来围绕它构建 SQL 命令。

在这种情况下，我建议：

1.  在单元格 A1 的顶部插入一行，包含以下内容：

    `CREATE TABLE MyTable (Id INT NOT NULL AUTO`_`INCREMENT PRIMARY KEY,`

2.  在 B 列中与单词相邻的每个单元格中，输入以下内容：

    `VARCHAR(5),`

3.  删除最后一个逗号，并`);`在下面的单元格中添加一个“”。

4.  另存为制表符分隔的文件，然后使用您选择的文本编辑器，将制表符替换为空格。

您将得到一个可以针对数据库运行的 SQL 文件。

是的，它很乱而且不是很 1337，但它很有效。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T21:12:35.443

嘿，弗兰克，我刚刚在你的 Facebook 页面上写了这个，但又来了：

“条件”是 MySQL 中的保留字，因此您不能使用该字命名任何列。在此处查看列表（至少对于 MySQL 5.1）：

[http://dev.mysql.com/doc/refman/5.1/en/reserved-words.html](http://dev.mysql.com/doc/refman/5.1/en/reserved-words.html)

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T05:09:23.980

所以基本上我认为你要求的是：将文件读入程序。  

让程序获取每一行并生成一个列出所有单词的字符串。

将 CREATE TABLE 语句与包含字段名称的字符串连接以创建 SQL 语句。

将该 SQL 命令发送到您的 sql 服务器。
我在这方面还太陌生，无法很好地实现这个想法，但希望如果这符合您的要求，我会给某人一个想法。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T04:23:28.177

我不确定我是否完全理解您的问题，但我确实有一个想法：

如果要计算频率数据，如果在将单词插入表之前对其进行排序，则可以编写更有效的内容分析算法。这将减少数据库服务器上的 CPU 压力，并且您的频率计算器也会更有效。

也许您可以为我们详细说明您的问题？

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2010-12-02T20:38:54.833

其工作方式是使用“load data infile”将文件加载到数据库中。用 x 替换所有我前缀的变量

```
mysql -uxuser -pxpass xdatabase -e "LOAD DATA INFILE '/tmp/xwordlist.cvs' INTO TABLE xtable FIELDS TERMINATED BY ',' (xcolname)" 
```

# c# - Asp.Net MVC 无法获取 .html 文件或 .xml 文件 404 错误？

> ID：641440
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T04:16:01.377
> 
>         
> 
> 标签：c#, jquery, html, asp.net-mvc

如何返回视图中文件夹中的 .html 文件或 .xml 文件？我正在使用 jquery，它通过 ajax 请求静态 Html 文件并将结果插入到 div 中，它不断给出 404 错误任何想法？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2009-03-13T04:23:09.893

如果您需要忽略给定路径的路由，请使用：

```
routes.IgnoreRoute("path/to/static/content"); 
```

另外，我可能读错了您的问题，但是将静态内容放在您的 View 文件夹中是个坏主意。在文档根目录创建一个类似“Content”或“public”的文件夹。

如果您确实需要*处理*请求并将其作为 .html 或 .xml 输出，请创建一个类似于“{controller}/{action}/{id}.xml”或其他内容的路由。

# perl - Perl 有哪些优雅的特性或用途？

> ID：641442
> 
>         
> 
> 赞同：35
> 
>         
> 
> 时间：2009-03-13T04:17:01.187
> 
>         
> 
> 标签：perl

> 什么？Perl 漂亮吗？  [优雅](https://stackoverflow.com/questions/563036/what-is-elegant-code)？他一定是在开玩笑！

确实，那里有一些丑陋的 Perl。有些人，我的意思是很多。我们都见过。

> 嗯，这是象征汤。不是吗？

是的，有符号。就像“数学”有“符号”一样。只是我们程序员对标准的数学符号比较熟悉。我们逐渐接受了来自母语的符号，无论是 ASM、C 还是 Pascal。Perl 只是决定再增加一些。

> 好吧，我认为我们应该去掉所有不必要的符号。使代码看起来更好。

这样做的语言已经存在。它被称为[Lisp。](http://en.wikipedia.org/wiki/Lisp_programming_language)  （很快，[perl 6](http://perlgeek.de/blog-en/perl-5-to-6/)。）

> 好吧，聪明的家伙。事实是，我已经可以发明自己的符号了。它们被称为函数和方法。此外，我们不想重新发明[APL](http://en.wikipedia.org/wiki/APL_%28programming_language%29)。

哦，假的另一个自我，你真有趣！真的，Perl 可以很漂亮。它也可能很丑陋。使用 Perl，[TIMTOWTDI](http://en.wikipedia.org/wiki/There_is_more_than_one_way_to_do_it)。

那么，你最喜欢的优雅 Perl 代码是什么？

* * *

## 回答 #1

> 赞同：28
> 
>             
> 
> 时间：2009-03-13T05:08:56.913

Perl 有助于使用列表/哈希来实现命名参数，我认为这非常优雅，并且对自记录代码有很大帮助。

```
my $result = $obj->method(
    flux_capacitance       => 23,
    general_state          => 'confusion',
    attitude_flags         => ATTITUDE_PLEASANT | ATTITUDE_HELPFUL,
); 
```

* * *

## 回答 #2

> 赞同：24
> 
>             
> 
> 时间：2009-03-16T03:34:14.690

我最喜欢的优雅 Perl 代码并不一定是优雅的。它们是*元优雅*的，可以让您摆脱许多 Perl 开发人员已经养成的所有坏习惯。我需要几个小时或几天的时间才能将它们全部展示在他们应得的细节中，但作为一个简短的列表，它们包括：

*   [autobox](http://search.cpan.org/perldoc?autobox)，它将 Perl 的原语转换为一流的对象。

*   [autodie](http://search.cpan.org/perldoc?autodie)，这会导致内置程序在失败时抛出异常（消除对`or die...`构造的大多数需求）。另请参阅我的[autodie 博客](http://pjf.id.au/blog/index.rss?tag=autodie)和[视频](http://pjf.id.au/blog/?position=540)）。

*   [Moose](http://moose.perl.org/)，它提供了一种优雅的、可扩展的和*正确*的 Perl 编写类的方法。

*   [MooseX::Declare](http://search.cpan.org/perldoc?MooseX::Declare)，它在使用 Moose 时提供了令人敬畏的语法。

*   [Perl::Critic](http://perlcritic.com/)，您的个人、自动、可扩展和知识渊博的代码审查员。另请参阅[此 Perl-tip](http://perltraining.com.au/tips/2009-02-05.html)。

*   [Devel::NYTProf](http://search.cpan.org/perldoc?Devel::NYTProf)，它为我提供了我在*任何*编程语言中看到的最详细和最有用的分析信息。另请参阅[Tim Bunce 的博客](http://blog.timbunce.org/2008/07/15/nytprof-v2-a-major-advance-in-perl-profilers/)。

*   [PAR](http://search.cpan.org/perldoc?PAR)，Perl Archiver，用于捆绑发行版，甚至将整个程序转换为独立的可执行文件。另请参阅此[Perl-tip](http://perltraining.com.au/tips/2008-05-23.html)。

*   Perl 5.10，它提供了一些令人惊叹的正则[表达式改进](http://perltraining.com.au/tips/2008-02-08.html)、[智能匹配](http://perltraining.com.au/tips/2008-04-18.html)、[switch 语句](http://perltraining.com.au/tips/2008-03-12.html)、[定义或和状态变量](http://perltraining.com.au/tips/2008-03-03.html)。

*   [Padre](http://padre.perlide.org/)是唯一一个集成了上述优点的 Perl 编辑器，它是跨平台的，并且是完全免费和开源的。

如果您懒得关注链接，我最近[在 Linux.conf.au](http://linux.conf.au/programme/schedule/view_talk/175)上就上述大部分内容进行了一次演讲。如果你错过了，有一个[在线视频](http://mirror.linux.org.au/pub/linux.conf.au/2009/Friday/175.ogg)（ogg theora）。如果你懒得看视频，我今年将在 OSCON 上做一个大大扩展的演讲版本作为教程（标题为 Doing *Perl right*）。

祝一切顺利，

*保罗*

* * *

## 回答 #3

> 赞同：19
> 
>             
> 
> 时间：2009-03-13T13:59:41.927

我很惊讶没有人提到[施瓦茨变换。](http://en.wikipedia.org/wiki/Schwartzian_transform)

```
my @sorted =
  map  { $_->[0] }
  sort { $a->[1] <=> $b->[1] }
  map  { [ $_, expensive_func($_) ] }
@elements; 
```

在没有 slurp 操作员的情况下，

```
my $file = do { local $/; readline $fh }; 
```

* * *

## 回答 #4

> 赞同：16
> 
>             
> 
> 时间：2009-03-13T05:14:41.983

有用户希望您的程序处理的文件列表吗？不想意外处理程序、文件夹或不存在的文件？试试这个：

```
@files = grep { -T } @files; 
```

而且，就像魔术一样，您已经清除了所有不适当的条目。不想默默无视他们？在最后一行之前添加这一行：

```
warn "Not a file: $_" foreach grep { !-T } @files; 
```

为每个无法处理为标准错误的文件打印一条很好的警告消息。不使用相同的东西`grep`看起来像这样：

```
my @good;
foreach(@files) {
  if(-T) {
    push @good, $_;
  } else {
    warn "Not a file: $_";
  }
} 
```

`grep`(and `map`) 可用于缩短代码，同时仍保持其可读性。

* * *

## 回答 #5

> 赞同：11
> 
>             
> 
> 时间：2009-03-15T22:43:30.100

“或死”结构：

```
open my $fh, "<", $filename
    or die "could not open $filename: $!"; 
```

使用 qr// 创建语法：

```
#!/usr/local/ActivePerl-5.10/bin/perl

use strict;
use warnings;
use feature ':5.10';

my $non_zero         = qr{[1-9]};
my $zero             = qr{0};
my $decimal          = qr{[.]};
my $digit            = qr{$non_zero+ | $zero}x;
my $non_zero_natural = qr{$non_zero+ $digit*}x;
my $natural          = qr{$non_zero_natural | $zero}x;
my $integer          = qr{-? $non_zero_natural | $zero}x;
my $real             = qr{$integer (?: $decimal $digit)?}x;

my %number_types = (
    natural => qr/^$natural$/,
    integer => qr/^$integer$/,
    real    => qr/^$real$/
);

for my $n (0, 3.14, -5, 300, "4ever", "-0", "1.2.3") {
    my @types = grep { $n =~ $number_types{$_} } keys %number_types;
    if (@types) {
        say "$n is of type", @types == 1 ? " ": "s ", "@types";
    } else {
        say "$n is not a number";
    }
} 
```

用于分解重复代码的匿名子例程：

```
my $body = sub {
    #some amount of work
};

$body->();
$body->() while $continue; 
```

代替

```
#some amount of work
while ($continue) {
    #some amount of work again
} 
```

基于散列的调度表：

```
my %dispatch = (
    foo => \&foo,
    bar => \&bar,
    baz => \&baz
);

while (my $name = iterator()) {
    die "$name not implemented" unless exists $dispatch{$name};
    $dispatch{$name}->();
} 
```

代替

```
while (my $name = iterator()) {
    if ($name eq "foo") {
        foo();
    } elsif ($name eq "bar") {
        bar();
    } elsif ($name eq "baz") {
        baz();
    } else {
        die "$name not implemented";
    }
} 
```

* * *

## 回答 #6

> 赞同：9
> 
>             
> 
> 时间：2009-03-13T04:17:14.057

我最喜欢的一个例子是 Perl 的阶乘计算器实现。在 Perl 5 中，它看起来像这样：

```
use List::Util qw/reduce/;
sub factorial {
    reduce { $a * $b } 1 .. $_[0];
} 
```

如果数字 <= 1 或字符串，则返回 false，如果传入数字则返回数字（如果是小数则向下舍入）。

期待 Perl 6，它看起来[像这样](http://perlgeek.de/blog-en/perl-6/y-combinator-not-needed.html)：

```
sub factorial {
    [*] 1..$^x
} 
```

而且（来自上面链接中的博客）您甚至可以将其实现为运算符：

```
sub postfix:<!>(Int $x) {
    [*] 1..($x || 1)
} 
```

然后在您的代码中使用它，如下所示：

```
my $fact5 = 5!; 
```

* * *

## 回答 #7

> 赞同：9
> 
>             
> 
> 时间：2009-03-13T22:00:19.697

具有构造函数、getter/setter 和类型验证的三行类：

```
{
    package Point;
    use Moose;

    has ['x', 'y'] => (isa => 'Num', is => 'rw');
}

package main;
my $point = Point->new( x => '8', y => '9' );

$point->x(25); 
```

* * *

## 回答 #8

> 赞同：7
> 
>             
> 
> 时间：2009-03-13T04:18:14.727

如果您有一个逗号分隔的标志列表，并且想要一个查找表，您所要做的就是：

```
my %lookup = map { $_ => 1 } split /,/, $flags; 
```

现在您可以像这样简单地测试您需要哪些标志：

```
if ( $lookup{FLAG} ) {
    print "Ayup, got that flag!";
} 
```

* * *

## 回答 #9

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T12:18:32.090

我很惊讶没有人提到这一点。这是我认为的**杰作：**

```
#!/usr/bin/perl
                                           $==$';
                                         $;||$.| $|;$_
             ='*$ ( ^@(%_+&~~;# ~~/.~~
         ;_);;.);;#) ;~~~~;_,.~~,.* +,./|~
    ~;_);@-, .;.); ~~,./@@-__);@-);~~,.*+,.
  /|);;~~@-~~~~;.~~,. /.);;.,./@~~@-;.;#~~@-;;
  ;;,.*+,./.);;#;./@,./ |~~~~;#-(@-__@-__&$#%^';$__
   ='`'&'&';$___="````" |"$[`$["|'`%",';$~=("$___$__-$[``$__ "|
              "$___"| ("$___$__-$[.%")).("'`"|"'$["|"'#")。
        '/.*?&([^&]*)&.*/$'.++$=.("/``"|"/$[`"|"/#'").(";` /[\\`\\`$__]//`;"
        |";$[/[\\$[\\`$__]//`;"|";#/[\\\$\\.$__]//'").'@:=(" @-","/.",
       "~~",";#",";;",";.",",.",");","()","*+","__","-("," /@",".%","/|",
        ";_");@:{@:}=$%..$#:;'.('`'|"$["|'#')."/(..)(..)/" .("```"|"``$["|
        '#("').'(($:{$'.$=.'}<<'.(++$=+$=).')|($:{$'.$=.'} ))/'.("```;"|
        "``$[;"|"%'#;").("````'$__"|"%$[``"|"%&!,").${$[};` $~$__>&$=`;$_=
       '*$(^@(%_+&@-__~~;#~~@-;.;;,.(),./.,./|,.-();;#~~@- );;;,.;_~~@-,./.,
        ./@,./@~~@-);;;,.(),.;.~~@-,.,.,.;_,./@,.-();;#~~@ -,.;_,./|~~@-,.
          ,.);););@-@-__~~;#~~@-,.,.,.;_);~~~~@-);;;,.(),.*+) ;;# ~~@-,
           ./|,.*+,.,.);;;);*+~~@-,.*+,.;;,.;.,./.~~@-,.,.,.; _) ;~~~
             ~@-,.;;,.;.,./@,./.);*+,.;.,.;;@-__~~;#~~@-,.;;,.* + );;
               #);@-,./@,./.);*+~~@-~~.%~~.%~~@-;;__,. /.);;#@- __@-
                 __ ~~;;);/@;#.%;#/.;#-(@-__~~;;;.;_ ;#.%~~~~ ;;()
                      ,.;.,./@,. /@,.;_~~@-););,.;_);~~,./@,.
                      ;;;./@,./| ~~~~;#-(@- __,.,.,. ;_);~~~ ~@
                       -~~());; #);@-,./@, .*+);;; ~~@-~~
                       );~~);~~ *+~~@-);-( ~~@-@-_ _~~@-
                       ~~@-);; #,./@,.;., .;.);@ -~~@-;
                       #/.;#-( ~~@-@-__ ~~@-~~ @-);@
                       -);~~, .*+,./ |);;;~ ~@-~~
                        ;;;.; _~~@-@ -__);。%;#-(
                        @-__@ -__~~;# ~~@-;; ;#,。
                        ;_,.. %);@-,./@, .*+,
                        ..%, .;.,./|) ;;;)
                        ;;#~ ~@-,.*+,. ,.~~
                       @-); *+,.;_);;.~ ~););
                      ~~,.; .~~@-);~~,.;., ./.,.;
                      ;,.*+ ,./|,.); ~~@- );;;,.(
                    ),.*+); ;#~~/|@-
                  _~~;#~~ $';$;;

```

* * *

## 回答 #10

> 赞同：3
> 
>             
> 
> 时间：2009-03-16T06:55:45.283

我非常***喜欢*** [Black Perl](http://www.perlmonks.org/?node_id=237465)（链接到重写以在 Perl 5 下编译的版本）。它可以编译，但据我所知，它实际上并没有做任何事情。

这就是语言学家从实用的角度而不是从理论的角度编写的语言所得到的。

继续前进，您可以将人们抱怨的 Perl 视为 pidgin Perl（非常有用，但不具有表达力，并且要小心尝试在其中表达任何复杂的东西），以及 @pjf 所说的“正确”的东西” Perl，莎士比亚、海明威、休谟等的语言。[编辑：错误，虽然比休谟更容易阅读，而且比莎士比亚少过时。] [重新编辑，希望比海明威少酗酒]

* * *

## 回答 #11

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T06:03:45.503

`map`除了对and的喜爱之外`grep`，我们还可以编写一个简单的命令行解析器。

```
my %opts = map { $_ => 1 } grep { /^-/ } @ARGV; 
```

如果我们愿意，我们可以将每个标志设置为其在@ARGV 中的索引：

```
my %opts = map { $ARGV[$_] => $_ } grep { $ARGV[$_] =~ /^-/ } 0 .. $#ARGV; 
```

这样，如果一个标志有一个参数，我们可以得到这样的参数：

```
if( defined( $opts{-e} ) ) {
  my $arg = $ARGV[ $opts{-e} ];
  # do -e stuff for $arg
} 
```

当然，有些人会哭说我们正在重新发明轮子，我们应该使用 getopt 或其一些变体，但老实说，这是一个相当容易重新发明的轮子。另外，我不喜欢getopt。

如果你不喜欢其中一些行有多长，你总是可以使用中间变量或者只是方便的换行符（嘿，Python 狂热分子？你听到了吗？我们可以将一行代码放在两行中，它仍然有效！ ) 让它看起来更好：

```
my %opts = map  { $ARGV[$_] => $_   }
           grep { $ARGV[$_] =~ /^-/ } 0 .. $#ARGV; 
```

* * *

## 回答 #12

> 赞同：1
> 
>             
> 
> 时间：2009-07-23T01:34:20.983

这种文件解析机制紧凑且易于定制（跳过空行、跳过以 X 开头的行等）。

```
open(H_CONFIG, "< $file_name") or die("Error opening file: $file_name! ($!)");
while (<H_CONFIG>)
{
   chomp;         # remove the trailing newline
   next if $_ =~ /^\s*$/; # skip lines that are blank
   next if $_ =~ /^\s*#/; # skip lines starting with comments
   # do something with the line
} 
```

我在不同的构建情况下使用这种类型的构造——我需要预处理或后处理有效负载文件（S 记录等）或 C 文件或收集目录信息以进行“智能构建”。

* * *

## 回答 #13

> 赞同：1
> 
>             
> 
> 时间：2014-06-02T06:49:41.273

我最喜欢的优雅 Perl 特性是它对数值和字符串值使用不同的运算符。

```
my $string = 1 . 2;
my $number = "1" + "2";
my $unambiguous = 1 . "2"; 
```

将此与 JavaScript 等其他动态语言进行比较，其中“+”用于连接和添加。

```
var string = "1" + "2";
var number = 1 + 2;
var ambiguous = 1 + "2"; 
```

或者对于需要在字符串和数值之间进行类型强制的动态语言，例如 Python 和 Ruby。

```
string = "1" + "2"
number = 1 + 2
throws_exception = 1 + "2" 
```

在我看来，Perl 做得如此正确，而其他语言则做得如此错误。

* * *

## 回答 #14

> 赞同：-17
> 
>             
> 
> 时间：2009-03-13T04:32:55.003

像我这样的可怜的打字员经常在按 shift 键时抽筋，并且几乎不合理地害怕使用分号，他们开始在`python`格式化文件中编写我们的 Perl 代码。:)

例如

```
>>> k = 5
>>> reduce(lambda i,j: i*j, range(1,k+1),1)
120
>>> k = 0
>>> reduce(lambda i,j: i*j, range(1,k+1),1)
1 
```

# ruby-on-rails - 在 Unix 上，查找执行程序的用户是否是 root？

> ID：641449
> 
>         
> 
> 赞同：23
> 
>         
> 
> 时间：2009-03-13T04:21:30.367
> 
>         
> 
> 标签：ruby-on-rails, ruby, bash, unix, rake

我正在编写一个 rake 脚本，并希望检测（如果可能，使用 Ruby 而不是 bash）执行 rake 脚本的用户是否具有 root 权限。

如果它不是root，那么我想终止脚本。

* * *

## 回答 #1

> 赞同：41
> 
>             
> 
> 时间：2009-03-13T04:29:14.357

在类中使用[`uid`](http://www.ruby-doc.org/core/classes/Process.html#M003200)或：[`euid`](http://www.ruby-doc.org/core/classes/Process.html#M003204)[`Process`](http://www.ruby-doc.org/core/classes/Process.html)

```
raise 'Must run as root' unless Process.uid == 0 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:26:41.290

我不知道 Ruby，但您要检查的是用户 ID 是否为 0。在 C 中，您可以通过检查[`getuid()`](http://linux.die.net/man/2/getuid). 从 Unix 命令行，您还可以检查[`id -u`](http://linux.die.net/man/1/id).

# c# - 验证 ITemplate 中的表单字段

> ID：641453
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T04:23:59.703
> 
>         
> 
> 标签：c#, asp.net, templates, validation

我有一个自定义控件，其中包含以下定义的属性：

```
[PersistenceMode(PersistenceMode.InnerProperty)]
public ITemplate Template { 
  get { return template; }
  set { template = value; }
} 
```

该控件覆盖 CreateChildControls()，并添加了几个 HtmlGenericControls 和一个 asp:Panel 控件。

控件的实际实际实现如下所示：

```
<user:Frame runat="server">
   <Template>
      <asp:Literal runat="server" ID="SomeControl" Text="SomeValue" />                  
   </Template>
</user:Frame> 
```

虽然页面按预期呈现，但它会产生许多不同严重程度的后果，包括：

*   包含在模板中的控件不能直接引用，需要 FindControl。这可以。

*   我一直无法对它们使用验证控件。

有没有更好的方法来设计我的自定义控件？或者也许只是一种让验证工作的方法？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-16T05:12:56.623

默认情况下，框架假定您在控件中可能有多个模板，例如在中继器中。在您的情况下，您必须使用 TemplateInstance 属性告诉它您打算拥有一个模板。例如

```
[PersistenceMode(PersistenceMode.InnerProperty)]
[TemplateInstance(TemplateInstance.Single)]
public ITemplate Template { 
  get { return template; }
  set { template = value; }
} 
```

这将允许您直接引用模板化控件，并且还应该解决您的验证问题。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-16T05:28:43.200

在这种情况下使验证工作的一种方法是以编程方式添加验证控件。例如：

```
var c = parentControl.FindControl("id");

parentControl.Controls.AddAt(
   parentControl.Controls.IndexOf(c) + 1,
   new RequiredFieldValidator() { ControlToValidate = c.D }); 
```

# asp.net - ASP.NET 嵌入式代码表达式

> ID：641456
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T04:24:30.950
> 
>         
> 
> 标签：asp.net, asp.net-3.5

下面的代码有效，但我不确定如何？

OnClientClick='<%# CreateConfirmation(Eval("EventName"),DataBinder.Eval(Container.DataItem, "EventDate", "{0:ddd, d MMM}")) %>'         

Public Function CreateConfirmation(ByVal EventName As String, ByVal EventDate As String) As String Return String.Format("return confirm('Are you sure you want to register for {0} on {1} ?');", EventName, EventDate ) 结束函数   

我已经读过 <%# %> 是一个数据绑定表达式，但是在这里我们不是直接数据绑定（实际上是从函数 CreateConfirmation 中返回值），我还认为它应该与 <%= %> 一起使用，但它提供了 JavaScript错误消息，即非法 XML 字符指向 =

请你澄清一下这是为什么？

非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:47:29.943

这个问题在现有帖子中得到了非常准确的回答：

[为什么将 <%= %> 表达式作为服务器控件上的属性值会导致编译错误？](https://stackoverflow.com/questions/370201/why-will-expressions-as-property-values-on-a-server-controls-lead-to-a-compile) 

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T04:46:57.997

您可以调用 <%#. Eval 位是使它与数据源中的行/对象相关的部分。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T04:51:06.283

您仍在将返回的字符串绑定到属性。您只能将 <%=%> 与内联 HTML 一起使用。绑定到 contols 属性时必须使用 <%#%>。

# iphone - iPhone打开数据：Safari中的网址

> ID：641461
> 
>         
> 
> 赞同：9
> 
>         
> 
> 时间：2009-03-13T04:27:25.577
> 
>         
> 
> 标签：iphone, url, safari, data-url

我有一个 Data: URL（参见：[http](http://en.wikipedia.org/wiki/Data_URI_scheme) ://en.wikipedia.org/wiki/Data_URI_scheme ）（作为 NSString），我想在 Safari 中打开它。你将如何做到这一点（我试过 openURL:.）

示例：  

```
data:text/html;base64,(Some Base64 Encoded Data Here) 
```

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2009-03-22T03:29:42.187

在 iPhone OS 2.2.1 和 5.0.1 中，无论是在模拟器还是在设备上，打开**data:** url 在 a 中都可以正常工作，`UIWebView`但 using`openURL`完全没有任何作用。

如果您愿意在导航栏中键入一个 URL，Safari 会很乐意并正确地呈现这样的 URL，所以这显然是 Safari 的问题`sharedApplication openURL`，而不是 Safari 的问题。

如果 base64 字符串足够短（可能小于 2K），您可以将其作为查询参数包装到 http URL，该 URL 仅返回对数据 url 的重定向。然后你可以使用 openURL 打开 http URL。是的，这意味着通过某些服务器弹跳，但它会起作用。

或者，由于 Safari 显然没有这样做，您*可以*告诉 iPhone*您的*应用程序是**数据的处理程序：**方案并负责在 UIWebView 中呈现内容。不过，这似乎在未来可能会失败。:-)

数据 URL 最初来自哪里？也许您可以构建一个网页，其内容只不过是`<iframe src="<the data url>"/>`一次又一次地在该 URL 上使用 openURL。

* * *

## 回答 #2

> 赞同：-1
> 
>             
> 
> 时间：2009-03-18T21:55:44.833

这应该这样做：

```
NSURL *yourURL = [[NSURL alloc] initWithString:yourStr];    
[[UIApplication sharedApplication] openURL:yourURL];
[yourURL release]; 
```

假设“yourStr”是一个 NString，其中包含您的数据所在的 URL。

# java - 在 Java 中使用过多的静态变量会导致内存泄漏吗？

> ID：641462
> 
>         
> 
> 赞同：49
> 
>         
> 
> 时间：2009-03-13T04:27:33.580
> 
>         
> 
> 标签：java, memory-management, memory-leaks

如果我的应用程序有太多静态变量或方法，那么根据定义，它们将存储在堆中。如果我错了请纠正我

1）这些变量在应用程序关闭之前会一直在堆上吗？

2) 它们是否随时可用于 GC？如果不是，我可以说这是内存泄漏吗？

* * *

## 回答 #1

> 赞同：91
> 
>             
> 
> 时间：2009-03-13T04:33:21.443

静态方法只是方法，它们不存储在堆中，它们只是不能使用“this”参数。

静态变量充当 GC 的“根”。因此，除非您将它们显式设置为 null，否则它们将与程序存在一样长，因此可以从它们访问的所有内容。

仅当您打算让内存变得空闲并且它没有变得空闲时，才将这种情况视为内存泄漏。如果您打算让您的静态变量在部分时间内包含对对象的引用，并且在完成该对象时忘记将其设置为 null，那么您最终可能会出现泄漏。但是，如果您将它放在静态变量中并打算在程序运行时一直存在，那么它绝对不是泄漏，它更有可能是“永久单例”。如果该对象在您希望它仍然存在时被回收，那将非常糟糕。

至于您关于堆的问题：Java 中的所有对象都存在于堆上或堆栈上。使用 new 运算符在堆上创建对象。然后将参考附加到它们。如果引用变为空或超出范围（例如，块结束），GC 会意识到无法再次到达该对象并回收它。如果您的引用在静态变量中，它永远不会超出范围，但您仍然可以将其设置为 null 或另一个对象。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-19T02:35:00.323

如果您有一个静态哈希图并向其中添加数据......数据将永远不会消失并且您有泄漏 - 以防您不再需要数据。如果你需要数据，那不是泄漏，而是一大堆内存。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T12:46:52.333

静态直接或间接引用的对象将保留在堆上，直到可以收集适当的类加载器。在某些情况下（例如 ThreadLocal），其他对象间接引用了类加载器，导致它保持未被收集。

例如，如果您有一个静态列表并动态添加对它的引用，那么您很容易以“对象生命周期争用问题”告终。出于多种原因，请避免使用可变静态。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:35:23.093

只要您可以从代码中的某个位置引用这些变量，GCed 就不能，这意味着它们将一直存在到应用程序结束。

你能称它为内存泄漏吗，我不会称它为内存泄漏，通常内存泄漏是你通常希望恢复但你从未这样做的内存，或者你只恢复了它的一部分。此外，内存泄漏通常会随着时间的推移变得更糟（例如：每次调用方法时都会“泄漏”更多内存），但是在这种情况下，这些变量的内存使用量是（某种）静态的。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:40:32.363

它不会导致经典 C 意义上的内存泄漏......例如

```
Class A{

static B foo;

...

static void makeFoo(){
   foo = new B();
   foo = new B();
} 
```

在这种情况下，调用 makeFoo() 不会导致内存泄漏，因为第一个实例可以被垃圾收集。

# c# - .NET 控件，如 Outlook 的电子邮件地址文本控件

> ID：641464
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-03-13T04:28:09.990
> 
>         
> 
> 标签：c#, winforms, controls

我正在寻找一个 .NET 2.0 (windows) 应用程序的控件（或关于构建我自己的建议），其工作方式类似于 Outlook 邮件窗口中的地址框（下面的蜜蜂）

[Outlook 地址控制 http://content.screencast.com/users/Ryan_Farley/folders/Jing/media/a511142b-dd04-4885-ad1e-f2582c201723/2009-03-12_2116.png](http://content.screencast.com/users/Ryan_Farley/folders/Jing/media/a511142b-dd04-4885-ad1e-f2582c201723/2009-03-12_2116.png)

该控件基本上适用于每个电子邮件地址类似于文本区域中的项目的情况。我不太关心让用户也像在 Outlook 中那样在这个区域中键入内容。我只是希望能够将这些完整的字符串（电子邮件地址）添加到文本区域或列表中，并且用户可以选择它们（但不能编辑）并且可以通过列表删除或退格以删除整个项目（e - 邮件地址）。

有谁知道那里有这样的控件吗？有什么建议可以建立我自己的吗？（或者任何人都知道你甚至称这个控件是什么，所以我知道用谷歌搜索什么？）

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-05-08T16:51:27.180

这里有一些代码可以帮助您入门。  

```
using System.Text;
using System.Windows.Forms;
using System;

namespace WindowsFormsApplication1
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
            textBox1.Text = "mail@mail.com; mail2@mail.com; mail3@mail.com";
        }

        private void textBox1_Click(object sender, EventArgs e)
        {
            int nextSpaceIndex = textBox1.Text.Substring(textBox1.SelectionStart).IndexOf(' ');
            int firstSpaceIndex = textBox1.Text.Substring(0, textBox1.SelectionStart).LastIndexOf(' ');
            nextSpaceIndex = nextSpaceIndex == -1 ? textBox1.Text.Length : nextSpaceIndex + textBox1.SelectionStart;
            firstSpaceIndex = firstSpaceIndex == -1 ? 0 : firstSpaceIndex;
            textBox1.SelectionStart = firstSpaceIndex;
            textBox1.SelectionLength = nextSpaceIndex - firstSpaceIndex;
        }
    }
} 
```

这将在您单击电子邮件地址时选择整个电子邮件地址。我不确定这是否是您想要的功能（虽然听起来是这样），但它会让您入门。如果你想做除了点击功能之外的其他事情，挂钩到由`TextBox`.

* * *

## 回答 #2

> 赞同：-2
> 
>             
> 
> 时间：2009-03-13T05:19:56.950

.NET 2.0 Windows Forms 已经有了，它只是一个 MaskedTextBox。

但是为了提供最大的输入有效性，例如电子邮件地址，您可以在 MaskedTextBox 中的文本发生更改时添加正则表达式 (Regex) 验证。

**更新：**
为了提供更多的自定义，例如多个电子邮件地址，您还可以将 MaskedTextBox 与 RichTextBox 结合使用，因为 Outlook 电子邮件地址输入控件的确切功能没有本机 Windows 窗体实现。

我也这样做了，通过在 RichTextBox 控件获得焦点时捕获用户的当前光标，然后使用在运行时动态生成的附加 MaskedTextBox 直接屏蔽输入，显示在 RichTextBox 顶部。因此，当输入的电子邮件地址超过一个时，可能会有多个 MaskedTextBoxes。

我并不是说这是一项容易的任务，但这是可行的。

看到这个：

[MaskedTextBox 上的 MSDN 文档](http://msdn.microsoft.com/en-us/library/system.windows.forms.maskedtextbox.aspx "MSDN 中的 MaskedTextBox")

# conditional - 用于处理开关和多个字符串比较的“Pythonic”等效项

> ID：641469
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-03-13T04:31:55.130
> 
>         
> 
> 标签：conditional, python

好吧，所以我的标题很烂。一个例子效果更好：

```
input = 'check yahoo.com' 
```

我想解析输入，使用第一个单词作为“命令”，并将字符串的其余部分作为参数。这是我的非 Pythonic 思维如何编码的简单版本：

```
if len(input) > 0:
    a = input.split(' ')
    if a[0] == 'check':
        if len(a) > 1:
            do_check(a[1])
    elif a[0] == 'search':
        if len(a) > 1:
            do_search(a[1]) 
```

我喜欢 Python，因为它将通常复杂的事情变成了相当简单的事情。我对它不是太有经验，而且我相当确定有更好的方法来做这些事情......某种方式更pythonic。我见过一些人用 dicts 和 lambda 函数替换 switch 语句的例子，而其他人只是推荐 if..else 嵌套。

* * *

## 回答 #1

> 赞同：31
> 
>             
> 
> 时间：2009-03-13T04:37:58.593

```
dispatch = {
  'check': do_check,
  'search': do_search,
}
cmd, _, arg = input.partition(' ')
if cmd in dispatch:
    dispatch[cmd](arg)
else:
    do_default(cmd, arg) 
```

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T10:08:02.293

> 我相当肯定有一种更好的方法来做这些事情......某种方式更pythonic。

并不真地。您的代码简单、清晰、明显且类似于英语。

> 我见过一些用 dicts 和 lambda 函数替换 switch 语句的例子，

是的，你已经看到了它们，但它们并不清晰、不明显或类似英语。它们的存在是因为有些人喜欢在 switch 语句上绞尽脑汁。

> 而其他人只是推荐 if..else 巢。

正确的。他们工作。它们简单、清晰、...

你的代码很好。不要管它。继续。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T05:50:13.757

这可以让您避免给每个命令名称两次；函数名几乎直接用作命令名。

```
class CommandFunctions:
    def c_check(self, arg):
        print "checking", arg

    def c_search(self, arg):
        print "searching for", arg

    def c_compare(self, arg1, arg2):
        print "comparing", arg1, "with", arg2

    def execute(self, line):
        words = line.split(' ')
        fn = getattr(self, 'c_' + words[0], None)
        if fn is None:
            import sys
            sys.stderr.write('error: no such command "%s"\n' % words[0])
            return
        fn(*words[1:])

cf = CommandFunctions()
import sys
for line in sys.stdin:
    cf.execute(line.strip()) 
```

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T05:11:16.470

如果您正在寻找一种单一的“pythonic”方法，您可以使用以下方法：

```
 def do_check(x): print 'checking for:', x
def do_search(x): print 'searching for:', x

input = 'check yahoo.com'
{'check': do_check}.get(input.split()[0], do_search)(input.split()[1])
# checking for: yahoo.com

input = 'search google.com'
{'check': do_check}.get(input.split()[0], do_search)(input.split()[1])
# searching for: google.com

input = 'foo bar.com'
{'check': do_check}.get(input.split()[0], do_search)(input.split()[1])
# searching for: bar.com 
```

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-16T02:06:21.110

忽略，我只是意识到我的答案与其他答案之一相似-显然没有删除键:)

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-06-13T17:05:03.163

[@MizardX 答案的](https://stackoverflow.com/questions/641469/pythonic-equivalent-for-handling-switch-and-multiple-string-compares/641485#641485)变化：

```
from collections import defaultdict

dispatch = defaultdict(do_default, check=do_check, search=do_search)
cmd, _, arg = input.partition(' ')
dispatch[cmd](arg) 
```

# iphone - 为什么这行 Objective-C 会泄漏内存？

> ID：641495
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T04:43:39.533
> 
>         
> 
> 标签：iphone, objective-c, memory-management

我正在编写一个 iPhone 应用程序。我有一个看起来像这样的头文件：

```
 @interface EditTagsViewController : UITableViewController {
  NSMutableArray *allTags;
  NSMutableArray *selectedTags;
  NSInteger currentFavorite;
}
@property (nonatomic, retain) NSMutableArray *allTags;
@property (nonatomic, retain) NSMutableArray *selectedTags;
@property (nonatomic) NSInteger currentFavorite;
@end 
```

在实现文件中，我的 viewDidLoad 方法如下所示：

```
 - (void)viewDidLoad {
  NSMutableArray *aTags = [[NSMutableArray alloc] initWithArray:[Tag findAllTags]];
  self.allTags = aTags;
  [aTags release];

  NSMutableArray *sTags = [[NSMutableArray alloc] initWithArray:[Tag findByFavoriteId:currentFavorite]];
  self.selectedTags = sTags;
  [sTags release];

  UIBarButtonItem *add = [[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemAdd target:self action:@selector(addNewTag:)];
  self.navigationItem.rightBarButtonItem = add;
  [add release];
  [super viewDidLoad];
} 
```

这是我的dealloc方法：

```
 - (void)dealloc {
  [allTags release];
  [selectedTags release];
  [super dealloc];
} 
```

令我困惑的是，当我在模拟器和设备本身上运行应用程序时，使用 Instruments（内存泄漏），它告诉我 viewDidLoad 方法中的这一行正在泄漏一个数组：

```
 self.selectedTags = sTags; 
```

这很令人困惑，因为我使用了完全相同的技术和 2 个不同的变量，但第一个变量没有报告泄漏。

我觉得我在这里遗漏了一些明显的东西。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T04:52:15.703

你的代码对我来说看起来是正确的。是否有可能其中一个`[Tag findAllTags]`或`[Tag findByFavoriteId:]`正在泄漏？你确定 set`self.allTags`和`self.selectedTags`to `nil`in`dealloc`吗？

注意说`self.allTags = ...`和之间的区别`allTags = ...`。因为`allTags`它是一个属性并且具有`retain`属性，所以无论何时通过分配`self.allTags = ...`，它都会隐式调用 setter 方法`[self setAllTags:...]`，该方法会调用`retain`新值和`release`旧值（如果有）。您在此代码示例中正确执行了此操作，但如果您在其他地方直接分配`allTags`（没有`self.`），则您没有`release`使用旧值，这可能是泄漏的根源。同样对于`selectedTags`.

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T04:49:28.817

看看`findByFavoriteId`有`retain`没有 这是我在您的示例中使用的`aTags`and之间可以看到的唯一区别`sTags`

# c# - 转换二维数组

> ID：641499
> 
>         
> 
> 赞同：26
> 
>         
> 
> 时间：2009-03-13T04:46:21.727
> 
>         
> 
> 标签：c#, .net, multidimensional-array, data-structures, flatten

什么是`selectMany.ToArray()`方法？它是内置方法`C#`吗？

我需要将二维数组转换为一维数组。

* * *

## 回答 #1

> 赞同：61
> 
>             
> 
> 时间：2009-03-13T05:21:25.760

如果您的意思是*锯齿状*数组 ( `T[][]`)，`SelectMany`是您的朋友。但是，如果您的意思是一个*矩形*数组 ( )，那么您可以通过- 或`T[,]`仅枚举日期数据：`foreach`

```
int[,] from = new int[,] {{1,2},{3,4},{5,6}};
int[] to = from.Cast<int>().ToArray(); 
```

* * *

## 回答 #2

> 赞同：29
> 
>             
> 
> 时间：2009-03-13T04:48:49.783

[SelectMany](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.selectmany.aspx)是一个投影运算符，是命名空间 System.Linq 提供的扩展方法。

它在序列上执行一对多元素投影，允许您将结果序列“展平”为一个。

你可以这样使用它：

```
int[][] twoDimensional = new int[][] { 
                                      new int[] {1, 2},
                                      new int[] {3, 4},
                                      new int[] {5, 6}
                                     };

int [] flattened = twoDimensional.SelectMany(x=>x).ToArray(); 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2020-08-24T14:34:45.087

该解决方案致力于将任何类型的`int`数组，*常规的、锯齿状的*或*嵌套*的（*最后这些数组取自 javascript 及其对象表示法，但它们也可以在 C# 中实现为复杂的锯齿状对象数组*），转换为简单的单声道维整数数组：

```
 public static int[] getFlattenedIntArray(object jaggedArray)
    {

        var flattenedArray = new List<int>();

        var jaggedArrayType = jaggedArray.GetType();
        var expectedType = typeof(int);

        if (jaggedArrayType.IsArray)
        {
            if (expectedType.IsAssignableFrom(jaggedArrayType.GetElementType()))
            {
                foreach (var el in jaggedArray as int[])
                {
                    flattenedArray.Add(el);
                }
            }
            else
            {
                foreach (var el in jaggedArray as object[])
                {
                    foreach (var retIntEl in getFlattenedIntArray(el))
                    {
                        flattenedArray.Add(retIntEl);
                    }
                }

            }
        }
        else if (jaggedArrayType == expectedType)
        {
            flattenedArray.Add((int)jaggedArray);
        }
        else
        {
            return new int[0];
        }

        return flattenedArray.ToArray();
    } 
```

试试这个小提琴：[https ://dotnetfiddle.net/5HGX96](https://dotnetfiddle.net/5HGX96)

* * *

## 回答 #4

> 赞同：-1
> 
>             
> 
> 时间：2018-12-03T17:28:49.537

我的解决方案：

```
public struct Array3D<T>
{
    public T[] flatten;
    int x_len;
    int y_len;
    int z_len;

    public Array3D(int z_len, int y_len, int x_len)
    {
        this.x_len = x_len;
        this.y_len = y_len;
        this.z_len = z_len;
        flatten = new T[z_len * y_len * x_len];
    }

    public int getOffset(int z, int y, int x) => y_len * x_len * z + x_len * y + x;

    public T this[int z, int y, int x] {
        get => flatten[y_len * x_len * z + x_len * y + x];
        set => flatten[y_len * x_len * z + x_len * y + x] = value;
    }

    public T this[int flat_index] {
        get => flatten[flat_index];
        set => flatten[flat_index] = value;
    }
} 
```

# java - C/C++“系统级程序员”的线程问题与Java程序员面临的问题有很大不同吗？

> ID：641514
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T04:53:35.500
> 
>         
> 
> 标签：java, c++, c, multithreading, jobs

我正在寻找一份开发工作，并且看到许多清单指定开发人员必须精通多线程。这出现在 Java 工作列表和涉及 UNIX 上的“系统编程”的 C++ 列表中。

在过去的几年里，我一直在使用 Java 并使用它的各种同步机制。

在 90 年代后期，我做了很多 C++ 工作，尽管线程很少。然而，在大学里，我们在 Solaris 上使用线程。

我的问题是，与 Java 开发人员相比，C/C++ 开发人员面临的问题是否存在显着差异，以及解决这些问题的任何技术是否存在根本不同。Java 显然包括一些更好的机制和集合的同步版本等。

如果我想刷新或重新学习 UNIX 上的线程，最好的方法是什么？我应该看哪个图书馆？等等。目前有一些关于 C++ 线程的很棒的教程吗？

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2009-03-13T05:14:49.380

线程的基本挑战（例如同步、竞争条件、线程间通信、资源清理），但 Java 通过垃圾收集、异常、高级同步对象、高级调试支持和反射使线程更易于管理。

使用 C++，您更有可能出现内存损坏和“不可能”的竞争条件。而且您将需要编写更多低级线程原语或依赖不属于标准化语言的库（如 boost）。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T09:07:02.440

C++ 实际上比 Java 更容易编写复杂的线程代码，因为它具有 Java 缺乏的特性[——RAII](http://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization)或“资源获取即初始化”。这个习惯用法用于编写良好的 C++ 代码中的所有资源控制，但特别适用于必须自动管理同步的多线程代码。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T04:55:49.613

垃圾收集使不泄漏内存的编程线程更容易，并且您可以做一些[花哨的事情来解决收集的时间问题。](http://www.artima.com/lejava/articles/javaone_2007_realtime_gc.html)

确定性析构函数使不会产生僵尸的编程线程更容易，请参阅[此处的 ACM 论文](http://portal.acm.org/citation.cfm?doid=604131.604153)

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T05:01:23.047

看看[pthreads](https://computing.llnl.gov/tutorials/pthreads/)和[boost](http://www.boost.org/doc/libs/1_38_0/doc/html/thread.html)（pthreads 是一个随机的 lijnk，但它看起来还可以作为一个起点）。

在高层次上，Java/C/C++/ 的问题是相同的。关于如何解决问题的细节（要调用的函数、要创建的类等）因语言而异。  

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T08:48:12.580

这取决于您选择工作的级别。英特尔 TBB 和 OpenMP 从相当高的层次处理了许多常见情况。Posix 线程、Windows API 和 Boost 线程等可移植库使您更接近与 Java 中的原语相同的水平。

C++0x 线程（尤其是获取和释放内存屏障）允许您达到比 Java 提供的更多控制和复杂性的更低级别（`volatile`在 Java 中标记变量使其同时获得获取和释放内存屏障，但在Java 你不能只要求获取或释放障碍；在 C++0x 中你可以）。

请注意，C++0x 的线程模型是故意低级的，希望人们能在其上构建 TBB 之类的东西，并且下次标准委员会开会时，他们将能够弄清楚哪些更高级别的库和工具包运行良好，可以从中学习。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:29:28.277

无论使用哪种编程语言，线程的特性都很常见。例如，即使跨操作系统，POSIX 线程和 WIN32 线程也具有相同的逻辑特性集，尽管 API 调用和本地实现 WRT 底层硬件/内核可能会发生变化，但对于系统程序员来说，关于线程的逻辑思考以及如何使它们按预期工作& 实现这一点是最困难的部分。在谈到编程语言时甚至是这样。如果您真的了解线程和线程同步的概念，那么您可以在任何您喜欢的编程语言中使用它们。由于这些编程语言在本机线程/线程同步实现之上提供了语法糖。

# sql - 如何找出访问 SQL Server 的用户名和机器名

> ID：641515
> 
>         
> 
> 赞同：12
> 
>         
> 
> 时间：2009-03-13T04:54:41.097
> 
>         
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我的工作公司有一个 MSSQL 服务器 2005。关于找出当前日志用户以及发送警告消息的任何方式，我有两个问题：

第一个问题是是否有任何 T-SQL 或 SP 可用于找出当前登录用户名和机器名。如果用户使用 SQL server sa 名称远程访问 SQL server，有没有办法找出该用户的 windows 名称（登录 windows 的名称）？

我的下一个问题是，如果我可以获取用户名或 id，有没有办法发出警告消息，例如“当前 SQL 服务器正在清理或备份，请不要在这个时候登录”。我想这可能很难。我可能必须向用户发送电子邮件。

SQL 服务器只能在公司中访问。SQL 服务器有一个用户列表作为登录用户：windows 用户、SQL 用户和 sa。

* * *

## 回答 #1

> 赞同：39
> 
>             
> 
> 时间：2009-03-13T06:01:03.887

```
SELECT SUSER_SNAME(), HOST_NAME() 
```

如果连接是“sa”（或任何其他 SQL 登录名），那么您将找不到域/Windows 用户名。SQL Server 只知道它是“sa”或那个 SQL 登录名。

HOST_NAME 也可能不可靠，可以在连接字符串（“应用程序名称”）中设置。或者它可能是模糊的，例如“Microsoft Office”默认用于 Access、Excel 等

`client_net_address`您可以通过in回溯[`sys.dm_exec_connections`](http://msdn.microsoft.com/en-us/library/ms181509.aspx)并将 MAC 地址与 IP 匹配并找出谁登录了...

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T08:12:08.953

找出主机和用户的一种简单方法是

```
EXEC sp_who2; 
```

您可以在哪里获得一些其他值得了解的信息，例如用户处于活动状态等等......它并不能解决 gbn 宣布的问题。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T17:52:12.087

首先感谢您的所有建议。我尝试了所有方法，我认为 Joakim Backman 的方法符合我的需要。这是我发现的摘要。

*   sys.syslogins 的查询只列出登录信息。accdate 没有给出当前登录用户的时间戳。我尝试从另一个应用程序登录到我的 SQL，但此查询未列出登录名。

*   SELECT SUSER_SNAME(), HOST_NAME() 仅列出 SQL 服务器上的一个用户。例如，我以我的名字登录到 SQL Server。这个查询的结果只列出了我的名字和机器名。此查询不列出 SQL 服务器上的当前用户。

*   exec sp_who2 列出了我需要的信息。它列出了当前用户名机器名、活动状态、数据库名用户的访问权限和使用的命令。

为了获得我在 SP 中使用的信息，我必须过滤并将信息与其他表格（例如电子邮件）连接起来。这是我使用的代码：

```
DECLARE @retTable TABLE (
 SPID int not null
 , Status varchar (255) not null
 , Login varchar (255) not null
 , HostName varchar (255) not null
 , BlkBy varchar(10) not null
 , DBName varchar (255) null
 , Command varchar (255) not null
 , CPUTime int not null
 , DiskIO int not null
 , LastBatch varchar (255) not null
 , ProgramName varchar (255) null
 , SPID2 int not null
 , REQUESTID INT
)  

INSERT INTO @retTable EXEC sp_who2  

SELECT Status, Login, HostName, DBName, Command, CPUTime, ProgramName -- *
  FROM @retTable
  --WHERE Login not like 'sa%' -- if not interested in sa
  ORDER BY Login, HostName 
```

# language-agnostic - 方法应该属于谁？

> ID：641519
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-03-13T04:57:21.387
> 
>         
> 
> 标签：language-agnostic, oop

我正在尝试设计一个简单的游戏 --- Pong, Arkanoid--- 严格使用“正确的 OO”，无论这意味着什么。

所以，通过将自己设计到死亡，我试图达到一个我知道下次该做什么或不做什么的地步……

例如，谁应该处理碰撞？和记分？

我的第一个想法是给球一些工作，但它开始以指数方式扩展成一个上帝对象：球会知道它在哪里，它撞到了谁，并向记分对象报告。

这对于可怜的球来说太过分了。

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T05:04:55.923

经验法则：

*   如果一个对象在逻辑上拥有所有涉及的状态，那么它就拥有使用该状态的方法

*   如果一种方法需要来自多个对象的状态：

    *   如果容器对象拥有该方法使用的所有对象，那么它也拥有该方法

    *   否则您需要一个“桥”对象来拥有实用程序方法

    *   除非有一个强有力的论据表明一个对象是该方法的“控制器”（虽然暂时想不出一个例子）

在您的情况下，“游戏板”或“游戏环境”可能具有拥有碰撞检测（实用程序/桥接）方法的“游戏物理”类（或方法组）

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T07:53:03.320

一个好的或坏的设计通过它对意想不到的需求的适应程度来揭示自己，所以我建议保留一份潜在的“游戏功能”库存，以便为你的设计反思提供参考。由于您将其作为学习项目进行，因此您可以发疯。

Arkanoid 是一个非常好的选择，它提供了很多选择。让不同的积木获得不同的分数。使一些砖块在被击中时改变其他砖块的得分。制作一些砖块需要多次点击。赋予球、桨或砖块超能力。改变这些权力：其中一个使球键盘可控，另一个使其透明，另一个反转“重力”，等等。让砖块掉落物体。

目标是，当您进行此类更改时，它会影响尽可能少的类和方法。了解您的设计必须如何更改以适应此标准。

使用具有重构菜单的 IDE，尤其是**移动方法**重构。（如果您还没有，请阅读*[Refactoring](https://rads.stackoverflow.com/amzn/click/com/0201485672)*一书。）尝试将各种方法放置在各处。请注意，当方法“错误”放置时，哪些变得难以更改，而当您将其放置在其他地方时，哪些变得更容易。当对象处理自己的状态时，方法被正确放置；你可以“告诉”一个对象做某事，而不是“问”它关于它的状态的问题，然后根据它的答案做出决定。

假设在您的设计中，每个精灵都是一个对象实例。（您可以选择其他策略。）通常，运动会改变精灵的状态，因此描述特定种类精灵的运动的方法可能属于该精灵的类。

碰撞检测是代码的敏感部分，因为它可能涉及检查所有可能的精灵对。您需要区分*检查*碰撞和*通知*碰撞对象。例如，您的球对象需要在与桨碰撞时改变其运动。但是检测碰撞的算法一般不属于球类，因为其他成对的对象可能会与对游戏很重要的结果发生碰撞。

等等...

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T13:03:23.467

请记住，**对象也可以存在于**给定问题的逻辑元素（不仅是*真实*元素，如球和板）。

所以对于碰撞检测，你可以有一个 CollidingElement 类来处理位置和形状状态。然后可以通过组合将该对象嵌入到游戏中应该发生碰撞的任何对象中，并将任何需要的方法调用委托给它。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T05:00:42.347

这真的取决于你的实现，但我想你会有一个“游戏板”对象来管理记分，或者每边都有一个目标对象。至于碰撞，我认为您可能希望在对象之间传递事件。我认为任何物体都应该知道它的位置。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T05:05:18.700

在大多数游戏中，你都有静态和演员。.. 演员四处走动，他们每个人都独立地找出他们何时与某物发生碰撞，因为他们知道自己的形状和范围

# java - 为什么要将 Java 接口方法声明为抽象的？

> ID：641536
> 
>         
> 
> 赞同：146
> 
>         
> 
> 时间：2009-03-13T05:07:15.263
> 
>         
> 
> 标签：java, eclipse, interface, abstract

我今天使用 Eclipse 的“拉接口”重构特性来创建基于现有类的接口。该对话框提供了将新接口的所有新方法创建为“抽象”方法。

这样做有什么好处？

我认为允许您将接口方法声明为抽象的事实是该语言的一个多余且无害的特性，并不特别鼓励。

为什么 Eclipse 会支持这种风格，或者为什么有人会自愿选择这样做？

澄清：我不是在问为什么接口方法是抽象的，这是显而易见的。我在问为什么要明确选择将它们标记为抽象，因为如果它们在接口中，它们无论如何都是抽象的。

* * *

## 回答 #1

> 赞同：149
> 
>             
> 
> 时间：2009-03-13T05:14:02.313

根据[Java Language Specification](http://docs.oracle.com/javase/specs/jls/se7/html/jls-9.html#jls-9.1.1.1)，`abstract`接口的关键字已过时，不应再使用。（第 9.1.1.1 节）

`abstract`也就是说，由于 Java 倾向于向后兼容，我真的怀疑关键字是否存在会有所作为。

* * *

## 回答 #2

> 赞同：40
> 
>             
> 
> 时间：2009-03-13T07:15:26.967

eclipse 中的“这样做的好处”（在接口方法声明上添加抽象）将是[jdk1.3 中与 jdt eclipse 编译器的旧兼容性问题](https://bugs.eclipse.org/bugs/show_bug.cgi?id=11435)

> 从 1.4 开始，jdk 库不再包含默认的抽象方法（在实现接口的抽象类上）。
> 
>   这是在欺骗 Eclipse 1.3 编译器诊断，因为它们的实现依赖于它们的存在。
> 
>   请注意，Javac 1.3 将完全拒绝针对 1.4 库执行（使用 -bootclasspath 选项）。

由于 Eclipse 编译器可能处于 1.4 兼容级别（请参阅 参考资料`Workbench>Preferences>Java>Compiler>JDK Compliance`），或者如果使用 1.3 兼容模式，则至少使用 1.3 类库，因此在大多数当前 Eclipse 项目中不需要存在“抽象”。

* * *

## 回答 #3

> 赞同：40
> 
>             
> 
> 时间：2012-04-12T21:42:48.707

来自[Java SE 7 JLS](http://docs.oracle.com/javase/specs/jls/se7/html/jls-9.html#jls-9.4)（Java 语言规范）：“允许但不鼓励为接口中声明的方法冗余地指定 public 和/或 abstract 修饰符。”

对于[Java SE 5.0](http://docs.oracle.com/javase/specs/jls/se5.0/html/interfaces.html#9.4)：“为了与旧版本的 Java 平台兼容，允许但不鼓励，作为一种风格，为接口中声明的方法冗余指定抽象修饰符。”

* * *

## 回答 #4

> 赞同：9
> 
>             
> 
> 时间：2009-03-13T06:08:03.247

根据JLS接口中的方法默认是抽象的，所以关键字是多余的。知道这一点，我永远不会用它来“避免展示混乱”。

# merge - 是否有支持版本差异比较的 word 文档格式？

> ID：641538
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T05:08:11.313
> 
>         
> 
> 标签：merge, diff, document

我知道这个问题可能已经被问过了，但我真的很想知道一个程序可以逐行显示与 word 文档之间的差异。因此，我需要一种支持此功能的 word 文档格式（.doc、.docx 和 .ods 显然不支持）。

HTML 和 XML 是唯一接近支持此功能的格式，还是有其他格式？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T05:15:55.257

MS Word 2007 本身可以为您比较文档！检查此[链接](http://www.word07.com/compare-documents.htm)。这是你想要的？

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T05:27:56.570

LaTeX、DocBook（实际上是 XML）。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2017-12-01T09:32:58.917

我使用 MS Word 2003（是的，它在 Windows 10 上仍然可以正常工作）。在大多数情况下，我喜欢它，它确实具有用于比较 .doc 或 .docx 文件的比较功能，但该功能相当可悲。

幸运的是，至少有两个不错的免费替代品。[金山软件 WPS](https://www.wps.com/) Writer v.10.2.0.5978 和[LibreOffice](https://www.libreoffice.org) Writer 5.4.3（都是免费的，都在 2017 年 11 月左右发布）在比较 MS Word 文档方面都做得很好。（您也可以通过[Ninite](https://ninite.com/)非常方便地获取 LibreOffice 。）

WPS Office 是“免费的广告”，或者您可以付费让广告消失。LIbreOffice 是免费和开源的。

我认为我更喜欢 LibreOffice，但比较功能有点难找。首先在 LibreOffice Writer 中打开您的“新”文档。然后导航到**Edit -> Track Changes -> Compare Document...**  并打开“旧”文档。LibreOffice Writer 向您显示“新”文档，并通过将插入带下划线和删除显示为删除线（已删除）文本来识别其中的更改。实际上，这很不错。

当然，WPS Writer 和 LibreOffice Writer 也可以编辑您的文件。因此，如果您记得保存为 .doc 或 .docx 格式，它们可以完全取代 MS Office，对于许多用户而言。然而，在程序更晦涩的“角落”中，兼容性并不完美，所以我发现自己大部分时间仍在使用旧的 MS Word 2003 进行编辑。

# c++ - 为什么 glCopyTexSubImage2D 不能正确复制我的正方形？

> ID：641542
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T05:09:38.347
> 
>         
> 
> 标签：c++, opengl, 2d

这里是输出： http: [//i43.tinypic.com/9a5zyx.png](http://i43.tinypic.com/9a5zyx.png)
如果事情按照我想要的方式工作，左边正方形的颜色将匹配右边正方形的颜色。感谢有关该主题的任何帮助

```
#include <gl/glfw.h>

const char* 标题="测试";
胶粘剂img；
无符号整数 w=64,h=64;
整数屏幕宽度，屏幕高度；

无效启用2d（）
{
    glMatrixMode(GL_PROJECTION);
    glPushMatrix();
    glLoadIdentity();

    glViewport(0,0,screenwidth,screenheight);
    glOrtho(0,screenwidth,screenheight,0,-1,1);

    glMatrixMode(GL_MODELVIEW);
    glPushMatrix();
    glLoadIdentity();

    glPushAttrib(GL_DEPTH_BUFFER_BIT|GL_LIGHTING_BIT);
    glDisable(GL_DEPTH_TEST);
    glDisable(GL_LIGHTING);

    glClearColor(0.0f, 0.0f, 0.0f, 0.5f);
}

无效的drawmytex（）
{
    glEnable(GL_TEXTURE_2D);
    glBindTexture(GL_TEXTURE_2D,img);
    glBegin(GL_QUADS);
    glTexCoord2i(0,0);
    glVertex2i(0,0);
    glTexCoord2i(1,0);
    glVertex2i(w,0);
    glTexCoord2i(1,1);
    glVertex2i(w,h);
    glTexCoord2i(0,1);
    glVertex2i(0,h);
    glEnd();
    glDisable(GL_TEXTURE_2D);
}

无效drawquad（int x，int y）
{
    glBegin(GL_QUADS);
    glColor3f(0.0f,1.0f,0.0f);
    glVertex2i(x,y);
    glColor3f(1.0f,0.0f,1.0f);
    glVertex2i(x+w,y);
    glColor3f(0.0f,1.0f,1.0f);
    glVertex2i(x+w,y+h);
    glColor3f(0.0f,0.0f,1.0f);
    glVertex2i(x,y+h);
    glEnd();
}

无效的 texcopy()
{
    如果（！glIsTexture（img））
        glDeleteTextures(1,&img);
    glGenTextures(1,&img);
    glBindTexture(GL_TEXTURE_2D,img);
    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);
    glTexImage2D(GL_TEXTURE_2D,0,GL_RGBA,w,h,0,GL_RGBA,GL_UNSIGNED_BYTE,0);

    glMatrixMode(GL_PROJECTION);
    glLoadIdentity();
    glOrtho(0,w,h,0,-1,1);
    glViewport(0,0,w,h);
    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();

    glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT);
    绘制四边形（0,0）；

    glBindTexture(GL_TEXTURE_2D,img);
    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);
    //glCopyTexImage2D(GL_TEXTURE_2D,0,GL_RGBA,0,0,w,h,0);
    glCopyTexSubImage2D(GL_TEXTURE_2D,0,0,0,0,0,w,h);

    glMatrixMode(GL_PROJECTION);
    glLoadIdentity();
    glOrtho(0,screenwidth,screenheight,0,-1,1);
    glViewport(0,0,screenwidth,screenheight);
    glMatrixMode(GL_MODELVIEW);
    glLoadIdentity();
}

主函数（）
{
    整数运行；

    glfwInit();

    运行=glfwOpenWindow(640,480,0,0,0,0,0,0,GLFW_WINDOW);
    如果（！运​​行）
    {
        glfw终止（）；
        返回0；
    }

    glfwSetWindowTitle(title);
    glfwEnable(GLFW_STICKY_KEYS);
    glfwGetWindowSize(&screenwidth,&screenheight);

    enable2d();
    纺织品（）；

    做
    {
        glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT);
        glLoadIdentity();

        drawquad(64,0);
        drawmytex();

        glfwSwapBuffers();
        运行=!glfwGetKey(GLFW_KEY_ESC)&&glfwGetWindowParam(GLFW_OPENED);
        GLenum 错误=glGetError();
        如果（错误！=GL_NO_ERROR）运行=错误；
        glfwSleep(.017);
    }
    而（运行==1）；

    glDeleteTextures(1,&img);

    glfw终止（）；
    返回运行；
}

```

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T17:32:08.017

尝试添加 'glColor3f(1,1,1);' 在你的“drawmytex”函数中。我怀疑您的纹理是用当前颜色调制（相乘）的，如果是这样，问题不在于纹理副本，而在于您显示它的方式。

# encryption - Encfs 是如何工作的？

> ID：641545
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T05:11:03.227
> 
>         
> 
> 标签：encryption

我无法理解 Encfs 背后的想法。即使是我的 Ubuntu 提供的现成示例，也不适用于我：

> 加密文件 ~/crypt ~/.crypt

有一个错误：

> 无法定位挂载点

我应该以某种方式初始化文件吗？怎么了？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2015-04-30T07:42:22.140

自 2009 年以来，我每天都在使用 encfs，直到现在，我将快速介绍如何：

## **你需要什么让它工作？**

仅 fuse 和 encfs，它们可以直接在你的包管理中找到

```
Debian : apt-get install encfs
Fedora : yum install encfs
Gentoo : emerge encfs 
```

...

*（仅选择 encfs 将自动安装依赖项）*

##  **如何创建加密目录？**

如果你想用你的用户（非 root）使用 encfs，你必须先在这个组上添加 fuse。打开终端并登录 root ：

```
adduser youruser fuse 
```

*用你的替换你的用户。*

一旦添加，杀死并重新启动 X 或只是重新启动您的计算机。

现在打开一个终端（在用户 $ 中）：

```
groups 
```

如果您看到 fuse，那么您现在可以通过以下命令创建目录：

```
encfs /home/youruser/.crypt/ /home/youruser/crypt 
```

*.crypt 和 crypt 目录不能存在，如果存在，删除它们或选择其他路径*

第一次显示如下：

> 目录“/home/youruser/.crypt/”不存在。应该创建吗？(y,n) y
> 
>   目录“/home/youruser/crypt”不存在。应该创建吗？(y,n) y
> 
>   请从以下选项之一中选择：输入“x”表示专家配置模式，输入“p”表示预配置的偏执模式，其他任何内容，或空行将选择标准模式。?> p
> 
>   新的 Encfs 密码：
> 
>   验证 Encfs 密码：

*如图所示，回答 -> 第一个 y | 第二个y | 第三个* 

创建后，目录 crypt 被挂载（默认情况下），在 crypt 目录中添加文件。为了使它们不可读：

```
fusermount -u /home/youruser/crypt 
```

这将卸载目录 crypt，“消失”中的所有文件都可以在目录 .crypt 上找到加密：

```
ls /home/youruser/.crypt/ 
```

将显示类似（本示例中的 3 个文件）的内容：

```
0WoRsjyzZHI,Un-198TRY-dU  91rj264Z09Jcz7XZ4sbDeYfd  KpJTDI2TVUEFHTkksqxPT9xu 
```

要恢复您的加密文件可读，请执行以下操作：

```
encfs /home/youruser/.crypt /home/youruser/crypt 
```

将输出提示需要您的密码

## **如何备份加密文件，并将它们打开到另一台计算机/服务器**

请注意，除了您的加密文件之外，您绝对需要备份文件 encfs6.xml ，其中包含您的编码密码和他的盐生成。

[http://en.wikipedia.org/wiki/Salt_%28cryptography%29](http://en.wikipedia.org/wiki/Salt_%28cryptography%29)

这个文件可以找到：

```
/home/youruser/.crypt/.encfs6.xml 
```

以正确方式备份加密数据的最佳方法：

```
tar cvzf CryptedBackup.tar.gz /home/youruser/.crypt/ 
```

使用备份，在您的其他计算机/服务器上将其解压缩到 /home/user/ 并创建安装点（mkdir /home/user/crypt），它就可以工作了。

小心，如果您丢失了密码，或者您的 encfs6.xml 丢失，则无法取回您的加密

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T07:01:17.393

**如果两个**条件都为真，它会给你这个错误：

*   `~/crypt` **不是一个目录**（例如丢失，或者一个名为的非目录`~/crypt`已经存在），*并且*

*   `~/crypt` **无法**由 encfs 创建（mkdir 将失败，例如权限问题，或名为的非目录`~/crypt`已存在）

[请参阅http://code.google.com/p/encfs/source/browse/trunk/encfs/main.cpp?spec=svn27&r=27](http://code.google.com/p/encfs/source/browse/trunk/encfs/main.cpp?spec=svn27&r=27)上的源代码

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:03:50.117

也许您正在混淆目录。**~/crypt**和**~/.crypt**都必须是现有目录，其中 encfs 的第一个参数将是存储，加密文件将由 encfs 存储的位置，第二个参数是您要放置文件的位置被加密。

有关如何设置和使用 encfs 的指南，另请参阅[此处。](http://www.movingtofreedom.org/2007/02/21/howto-encfs-encrypted-file-system-in-ubuntu-and-fedora-gnu-linux/)

# performance - 处理 OpenGL 中的 Alpha 混合以获得更好的性能

> ID：641548
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T05:12:27.340
> 
>         
> 
> 标签：performance, opengl, graphics, alphablending

由于混合会影响我们游戏的性能，因此我们尝试了几种混合策略来创造混合的“幻觉”。其中之一是每隔奇数帧绘制一个精灵，导致精灵有一半的时间是可见的。效果倒是不错。（顺便说一下，您需要适当的帧速率，否则您的精灵会明显闪烁）

尽管如此，我想知道在避免混合方面是否有任何好的见解，以便在不影响（太多）视觉体验的情况下改善整体性能。

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T07:27:49.013

是实际的混合影响了你的表现吗？（即显存带宽）

这些天来，游戏通常会做什么来处理大量 alpha 混合的东西（想想覆盖整个屏幕的大爆炸）：将它们渲染成更小的纹理（例如比屏幕小 2x2 或 4x4），然后将它们合成回主屏幕。

这样做可能还需要将不透明表面的深度缓冲区渲染到较小的纹理中，以正确处理与不透明几何体的交叉点。在某些平台（控制台）上，进行多重采样或深度缓冲区黑客操作可能会使这成为一项非常便宜的操作；虽然在普通 PC 上没有这样的运气。

参见 GPU Gems 3 中的文章，例如：[High-Speed, Off-Screen Particles](http://http.developer.nvidia.com/GPUGems3/gpugems3_ch23.html)。Christer Ericson 的博客文章也概述了许多优化方法：[优化粒子系统的渲染](http://realtimecollisiondetection.net/blog/?p=91)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T07:34:42.617

这里是关于快速渲染粒子系统的优秀文章。它涵盖了较小的屏幕外缓冲区技术，并提出了许多其他方法。

你可以在[这里阅读](http://realtimecollisiondetection.net/blog/?p=91)

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-09-11T13:26:07.783

从您的问题中不清楚哪种混合应用会影响您的游戏性能。一般来说，混合速度非常快。如果您的问题与粒子系统相关，那么最有可能影响帧率的是绘制的粒子的数量和大小。特别是大量的近距离（因此是大）粒子将需要高内存带宽和显卡的填充率。我自己实现了一个粒子系统，虽然我可以在远处渲染大量粒子，但我在较弱的硬件上感受到了负面影响，例如在烟雾中飞行（这将填满整个屏幕，因为观众在其中） .

# php - PHP 命令行界面奇怪的 5 秒暂停（与 mysql/mysqli 扩展有关）

> ID：641550
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-03-13T05:14:28.880
> 
>         
> 
> 标签：php, windows, command-line

从命令行 PHP 客户端（Windows 上的 PHP 5.2）执行 PHP 脚本时，我遇到了 5 到 7 秒的奇怪暂停。

在此暂停期间，PHP 脚本似乎只是“冻结”了一段时间，然后返回到命令提示符。它没有使用任何显着的 CPU 时间，就好像它在等待一些延迟。

在尝试了 PHP.ini 之后，我将其范围缩小到启用了 mysql 或 mysqli 扩展的事实。如果这些扩展都被禁用，则不会出现烦人的暂停，并且 PHP 脚本会在几毫秒内终止。

我正在使用的命令是：

```
"C:\Program Files\PHP\php.exe" -f %1 
```

其中 %1 是 PHP 脚本。

即使正在执行的 PHP 脚本基本上是空的，暂停仍然会发生：

```
<?php

?> 
```

您知道是什么导致了这种暂停，以及如何在仍然允许 mysql 或 mysqli 在命令行上支持 PHP 的同时将其删除？

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T05:33:22.050

[这是mysql 中](http://bugs.mysql.com/bug.php?id=37226)的一个错误。您可以通过获取最新的 libmysql.dll（5.1.31 或更高版本。一些旧版本也可以使用 - 请参阅第二个链接）来解决它。确保这是实际使用的 libmysql.dll，并且您的路径中没有其他 libmysql.dll。有关详细信息，请参阅相关的[php 问题](http://bugs.php.net/bug.php?id=41350)。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2012-10-09T08:52:09.333

对我来说（Mac OS X 上的 Zend Server CE），imap exetension 是罪魁祸首。禁用它解决了这个问题。

Anoyone 想写一个 PHP 扩展二分脚本？:)

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2011-08-22T05:29:15.353

在 Windows 7 64 位下，我还经历了从命令行运行 PHP 的 2 秒延迟。

此版本有延迟：~~**[ZendServer 社区版](http://www.zend.com/en/products/server-ce/)**~~

~~**附带的 php.exe (v5.3.5)**~~

这个版本非常快：

**随[EasyPHP提供的 php.exe (v5.3.6)](http://www.easyphp.org/)**

（很抱歉碰到一个古老的线程，但希望这有助于其他人在谷歌上搜索这个问题。）

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2020-10-07T09:14:19.073

在 2020 年使用 PHP 7.4 的 linux 上，这种情况仍然会发生。解决方案是将我的主机名链接到`/etc/hosts`文件中的 127.0.0.1，因此 5 秒的延迟来自查找我自己的主机名（但没有找到它）。虽然在服务器上我已经设置了主机名，但我并没有在我的桌面系统上真正这样做（而且它不会自动这样做）。

要解决它，`hostname`请在命令行上运行（查看当前机器的主机名），然后将此行添加到`/etc/hosts`：

```
127.0.0.1 yourhostname 
```

您将在哪里用`hostname`显示的内容替换您的主机名。

# computer-science - 我在上CS课程。我应该关注什么编程主题？

> ID：641553
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T05:14:54.090
> 
>         
> 
> 标签：computer-science

这个时候最重要的是什么？我知道我可以在以后获得编程经验。毕业后我应该学习以下哪一项才能成为一名优秀的程序员或分析师？

*   数据结构

*   算法

*   软件工程

*   低级方面

*   设计模式和OO分析

**[编辑]**

感谢您的回答。我想包括其他重要主题，以供其他学生参考：

*   并发编程

*   操作系统

**[/编辑]**

注意：我认为列表的第一项应该是**学习英语**

* * *

## 回答 #1

> 赞同：17
> 
>             
> 
> 时间：2009-03-13T05:18:56.360

他们都是。您列表中的所有内容都很重要。

* * *

## 回答 #2

> 赞同：7
> 
>             
> 
> 时间：2009-03-13T05:23:45.817

我个人会研究以下内容：

*   一种类似 C 的语言 (C/C/C++/C#/Java)

*   一种脚本语言

*   一种函数式编程语言

    *   特别是因为我们正在转向多核世界，这将派上用场，因为它允许并行化超出其他语言目前所能做的。例如，整个电信基础设施都在 Erlang 上运行。

*   数据结构

    *   您将在任何地方使用这些。它们与编程语言无关，您将在整个职业生涯中都需要它们

*   算法

    *   这些最有可能与上述项目一起使用。某些数据结构具有某些算法来访问它们。

*   设计模式

    *   是的，当然要学习各种设计模式，但同时要知道它们并不是软件工程的全部。

您列表中的其他所有内容也非常重要，因此虽然我建议上述项目，但它们并不比您列出的其他项目更重要。这些是我希望我从学校毕业后得到的项目，我很遗憾地说我没有将它们作为课程提供，但我必须在我所有其他课程作业的同时自己学习它们。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T05:50:13.553

鉴于您没有在列表中提及任何特定语言，我认为您已经走在正确的轨道上。我认为这是 CS 学生犯的第一个错误——专注于语言或范式。

您的整个清单非常重要；我唯一要补充的是对多线程的相当深入的研究。未来会越来越重要：（[Ars-Technica 文章](http://arstechnica.com/software/news/2008/07/intel-an-expensive-many-core-future-is-ahead-of-us.ars)）

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T05:25:35.233

在这里插入 Joel 似乎很合适；-)

[http://www.joelonsoftware.com/articles/CollegeAdvice.html](http://www.joelonsoftware.com/articles/CollegeAdvice.html)

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T05:31:08.730

都是必填项！！

你在想什么？我希望您在专注度之间做出选择（例如，游戏设计与安全和密码学）。

您不能在“算法、oop、数据结构、软件工程等”之间进行选择。这些是基础！你必须全部学习。

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T05:31:23.380

我将从数据结构和算法开始，那里没有竞争。OO设计很有用。有点低级，是的。可以跳过 S/W 工程（对盐粒没问题）。

此外，这里有一些想法：

*   关系数据库基础知识（不仅仅是“如何使用 oracle”，而是实际的关系代数）

*   操作系统

*   编译器+解释器

*   IR（/遗传算法/神经网络）中的一些东西

是的，我偏向于“硬核”CS 的东西。忙碌的工作、繁重的流程和其他你很快就会在行业中学习的 PM 废话，无需浪费你的教育资源。:-)

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T05:19:52.457

让我们来看看..

您将需要了解复杂性以及数据结构和算法，以便做出重要的选择。不幸的是，您将需要真正了解这些主题并解决复杂的脑筋急转弯，因为它们在求职面试中比在您以后的实际工作中发挥的作用要大得多。因此，出于实际原因，这些是最重要的事情。

软件工程、设计模式和分析非常重要（尽管我有偏见）。不幸的是，除了设计模式之外，如果不积极实践主要项目，您将无法真正学习这些主题。专注于理解面向对象编程的概念和虚函数/动态绑定的概念，因为它们非常重要，而且很多人没有正确理解它们。尽最大努力获得一份好的实习。

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T07:02:56.123

您列出的所有内容都是体面的计算机科学教育的基本组成部分，尽管您确实应该添加以下内容：

*   操作系统

*   联网

*   数学（离散、微积分、代数、证明、统计的入门课程）

*   数据库

*   基础（有限自动机、正则表达式、图灵机等）

这两个列表一起将使您对计算机科学有一个很好的核心理解，然后您应该选择一些更专业的主题（您最感兴趣的主题）。

*   人工智能

*   加密/安全

*   图像/信号处理/识别

*   编译器

*   图形

*   游戏设计

*   等等

你会发现，一旦你开始深入一个话题，所有的核心课程，包括数学，都会开始发挥作用！例如，我目前正在研究图像识别，并且必须使用和理解来自统计、人工智能、微积分、证明、代数、算法、数据结构、OOP 等的东西。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T05:27:45.790

清单上的所有内容都很重要，但您也需要正确的态度。你需要深入了解你学习的每件事是如何工作的，以及为什么要这样做，而不仅仅是做课堂作业。这才是真正让您成为未来专家的优势所在。

* * *

## 回答 #10

> 赞同：-1
> 
>             
> 
> 时间：2009-03-13T05:20:06.120

所有这些都非常好，但算法是一个很好的起点。也许您甚至应该首先研究离散数学课程的理论。

* * *

## 回答 #11

> 赞同：-1
> 
>             
> 
> 时间：2009-03-13T05:43:20.170

1.  多线程和分布式系统。

2.  如何使用漂亮的 GUI 构建用户友好的应用程序。

# sql - Mysql子查询问题

> ID：641555
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T05:16:02.123
> 
>         
> 
> 标签：sql, mysql, subquery

鉴于这两个表：

```
Foo (id, name)       -- PK = id
Bar (fooId, value)   -- PK = composite, fooId + value
                     -- value is a non-negative int 
```

我怎样才能找到所有在0以上`Foo.name`没有对应的s `Bar,value`？

例如：

```
Foo
id   name
1    a
2    b
3    c

Bar
fooid    value
1        0
1        1
2        0
3        4

Result:
b 
```

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T05:26:46.650

```
SELECT Name
FROM Bar
INNER JOIN Foo ON Foo.Id = Bar.fooId
GROUP BY fooId, name
HAVING SUM(Value) = 0 
```

此查询和 zodeus 发布的查询执行时间大致相同，但是此查询不包括任何未由 Bar 表引用的 Foo 记录。例如，如果您还有记录 Foo (4, d)，则此查询仍将返回“b”，而 zodeus 的查询将返回“b”和“d”。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T05:18:06.453

```
SELECT name FROM FOO WHERE id NOT IN(
    SELECT fooId FROM Bar GROUP BY fooId HAVING MAX(Value) > 0) 
```

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T06:03:51.260

我发现以下内容最容易阅读和理解......

```
SELECT foo.name
FROM foo
WHERE NOT EXISTS (SELECT 'x'
                  FROM bar
                  WHERE bar.fooid = foo.id
                    AND bar.value > 0) 
```

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:02:14.707

```
select Foo.name 
from Foo
where Foo.id not in 
(select Bar.fooid from Bar
where value > 0) 
```

# c# - 我应该使用 ReAllocHGlobal 还是 FreeHGlobal/AllocHGlobal？

> ID：641564
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T05:21:08.723
> 
>         
> 
> 标签：c#, memory-management, interop

我正在与之交互的旧数据库使用数据缓冲区将行传递给应用程序。为了在 C# 中处理这个问题，我编写了一个类，它提供了在缓冲区中读取和写入不同类型的方法。每个数据文件使用一个数据缓冲区，但必须为某些操作调整缓冲区的大小。为此，我添加了一个**Allocate**方法：

```
public void Allocate(int bytes) {
    if (handle != IntPtr.Zero) { // memory has already been allocated
        Marshal.FreeHGlobal(handle);
    }
    handle = Marshal.AllocHGlobal(bytes);
} 
```

然而，那是在我注意到**ReAllocHGlobal**之前。现在我想知道我是否应该这样做：

```
public void Allocate(int bytes) {
    if (handle != IntPtr.Zero) { // memory has already been allocated
        handle = Marshal.ReAllocHGlobal(handle, (IntPtr)bytes);
    } else { // this is a brand new data buffer
        handle = Marshal.AllocHGlobal(bytes);
    }
} 
```

我认为第一种方法看起来更干净，但哪种方法最好用？我的第一个想法是**ReAllocHGlobal**最有意义（因为它专门用于调整现有内存块的大小），但我不是 100% 确定。

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T05:39:14.173

如果您不需要保留缓冲区中的信息，则释放和分配新缓冲区是更好的选择。如果 ReAlloc 需要在不同的位置分配缓冲区，它将复制现有的内容。

另一方面，如果您想保留缓冲区的内容并扩展（或缩小）它，ReAlloc 是更简单的方法。

# silverlight-2.0 - Silverlight 2.0 加载问题

> ID：641570
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-03-13T05:26:02.830
> 
>         
> 
> 标签：silverlight-2.0

我为客户开发了一个 SL2 应用程序（其计算机通过组策略处于相当严重的锁定状态）。SL2 应用程序对除客户端之外的所有人都运行良好。

客户端使用 WinXP + IE7 并安装了 SL2 运行时。

在客户端的机器上弹出以下错误：

```
Error: Unhandled Error in Silverlight
2 Application Code: 2103 Category:
InitializeError Message: 2103 An error
has occurred Code: 0 
```

客户端可以加载 SLv1 网站，例如[http://silverlight.net](http://silverlight.net)

客户端无法加载 SLv2 网站，例如：

*   [http://memorabilia.hardrock.com/](http://memorabilia.hardrock.com)

*   [http://demos.telerik.com/silverlight/default.aspx](http://demos.telerik.com/silverlight/default.aspx)

*   [http://timheuer.com/wpfe/versiontest/](http://timheuer.com/wpfe/versiontest/)

客户看到的是一个空白的 silverlight 画布，但能够右键单击并调出 silverlight 首选项菜单。

[替代文字 http://img6.imageshack.us/img6/1309/hardrockerror.jpg](http://img6.imageshack.us/img6/1309/hardrockerror.jpg)

有关如何调试此问题的任何想法或是否有其他人遇到此问题？

我应该补充一点，它在 Firefox 下运行良好，但他们的 IT 部门不愿意将 FF 推广到所有机器。环境必须是XP+IE7

标记：

```
<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" width="100%" height="100%">
            <param name="source" value="/ClientBin/RosterUI.xap"/>
            <param name="onerror" value="onSilverlightError" />
            <param name="background" value="white" />
            <param name="minRuntimeVersion" value="2.0.31005.0" />
            <param name="autoUpgrade" value="true" />
            <param name="scaleMode" value="zoom" />
            <a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;">
                <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none"/>
            </a>
        </object> 
```

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-04-15T06:11:22.567

经过几个月的反复来回，这个问题已经解决了——尽管我们仍然不知道真正的根本原因。

客户的 IT 人员最近更新了他们的透明代理服务器（也过滤内容），silverlight 应用程序开始在 IE 下运行。

所做的更改之一是允许下载 DLL 文件（捆绑在 XAP 文件中）。他们认为这是原因，尽管我不是 100% 相信，因为它不能完全解释为什么它在 Firefox 中工作（假设它也通过代理运行）

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-19T19:36:41.077

我会仔细检查调用 Silverlight 控件的 HTML 标记是否列出了正确的版本号。如果您使用 ASP 用户控件，应该没问题。如果您手动编写 HTML 代码，它应该如下所示：

```
 <object data="data:application/x-silverlight," type="application/x-silverlight-2"
  id="silverlightHost" width="100%" height="100%">
  <param name="source" value="ClientBin/MYXAPFILENAME.xap" />
  <param name="onerror" value="onSilverlightError" />
  <param name="background" value="white" />
  <param name="initparams" value="<%= _initParams %>" />
  <param name="minRuntimeVersion" value="2.0.31005.0" />
  <param name="autoUpgrade" value="true" />
  <a href="http://go.microsoft.com/fwlink/?LinkID=124807" style="text-decoration: none;">
    <img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight"
      style="border-style: none" />
  </a>
</object> 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-18T08:43:04.567

可能是重新安装 Silverlight 运行时或 IE7 可以提供帮助。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-19T19:53:56.717

也许客户端安装了旧版本的 SL2。您可以在 Microsoft Silverlight 配置面板的“关于”选项卡中查看它们的版本号（右键单击空的 Silverlight 应用程序）。

如果它是较旧的版本，他们将需要安装 RTM 版本。

# multithreading - 如何在两个线程中使用队列——一个用于消费者，一个用于生产者

> ID：641573
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T05:27:50.830
> 
>         
> 
> 标签：multithreading, queue

我正在使用一个应用程序，其中较低级别的应用程序在接收数据时总是调用回调 RecData(char *buf)。

在回调中，我创建了两个线程并将消费者和生产者函数分别传递给这些创建的线程。

我的代码：

无效的 RecData (char * buf) {

```
CreateThread(NULL,0,producer_queue,(void *)buf,0,NULL);
CreateThread(NULL,0,consumer_queue,NULL,0,NULL); 
```

}

当我一次收到一个数据时，上述方法有效。如果我几乎同时收到 5 个数据，那么 producer_queue 应该首先将所有数据放入队列，然后 consumer_queue 应该开始检索数据，但是一旦 producer_queue 将第一个数据放入队列，consumer_queue 就会检索它。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T05:34:22.297

我相信你想要做的是控制对队列的访问。你会想看看使用互斥锁来控制从队列中读取。

当您收到数据时，您将锁定互斥锁，然后将数据排入队列。完成对数据的排队后，释放锁。

从队列中读取时，您将看到互斥锁是否被锁定。如果您正在将数据写入队列，您将无法开始读取，直到您的生产者线程完成写入所有数据并释放锁。如果您实际上锁定了互斥锁，那么您在读取数据时会阻止写入器线程写入。

这种方法可能会引入潜在的死锁。如果您的写入线程在释放锁之前死亡，那么您的读取线程将无法继续（然后您的线程死亡可能只会触发错误状态）。

我希望这是有道理的。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:07:13.133

使用条件变量的概念。您拥有的问题是多线程编程世界中最常见的问题。仅使用互斥锁无济于事。永远记住，互斥锁是用于锁定的，而条件变量是用于等待的。后者总是更安全，并且几乎可以肯定线程何时应该开始从共享队列中消费。

查看以下链接，了解如何在 Windows 上自行创建条件变量：
      [http ://www.cs.wustl.edu/~schmidt/win32-cv-1.html](http://www.cs.wustl.edu/~schmidt/win32-cv-1.html)

如果您使用的是 windows vista，下面的 msdn 示例可能会对您有所帮助：http:
     [//msdn.microsoft.com/en-us/library/ms686903 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms686903(VS.85).aspx)

在所有情况下，都使用 Schmidt 网站中显示的逻辑，因为它看起来更便携（哦，是的，至少在不同版本的 Windows 上可移植）。Schmidt 的实现为您提供标准 POSIX api 感觉，这是大多数现代 UNIX/LINUX 系统上广泛使用的标准。

# c# - 多个 Windows 服务，一个安装程序，删除依赖项

> ID：641575
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T05:28:10.003
> 
>         
> 
> 标签：c#, .net, windows-services, installation

我有一个安装多个服务的服务安装程序项目。这很好，但任何单个服务中的单个未处理异常都会停止此安装程序安装的所有服务。

安装程序的代码看起来像这样

```
ServiceBase[] ServicesToRun;

ServicesToRun = new ServiceBase[] 
{ 
    new Service1() ,
    new Service2() ,
    ...
};

ServiceBase.Run(ServicesToRun); 
```

因此，一旦安装了服务，我可以在 Windows 服务管理窗口中看到几个单独的服务，每个服务都可以独立启动、停止、暂停和恢复。

但是，如果一个人遇到未处理的异常，那么他们都会停止。

理想情况下，只有出现问题的服务会停止，而其他服务会继续愉快地进行。

谁能建议一种方法来做到这一点，而无需为每个服务创建一个真正独立的安装程序项目？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T05:30:49.997

在最高级别为每个服务添加独立的错误处理，这样不会影响所有服务。

如果错误不严重，您可能还需要添加自动服务重启。只要确保在服务关闭和错误重新启动的情况下添加大量日志记录。

# .net - 如何在 WPF 应用程序中更改 DateTimePicker 的格式（例如 dd/MMM/yyyy）

> ID：641577
> 
>         
> 
> 赞同：17
> 
>         
> 
> 时间：2009-03-13T05:29:33.213
> 
>         
> 
> 标签：.net, wpf, datetime, datetimepicker, datetime-format

我想更改 WPF 应用程序中 DateTimePicker 中选择的日期格式

* * *

## 回答 #1

> 赞同：15
> 
>             
> 
> 时间：2010-12-09T23:22:54.380

我最近正在处理这个问题。我找到了一种执行这种自定义格式的简单方法，希望对您有所帮助。您需要做的第一件事是在您的 XAML 中将特定样式应用于您当前的 DatePicker，就像这样：

```
<DatePicker.Resources>
    <Style TargetType="{x:Type DatePickerTextBox}">
        <Setter Property="Control.Template">
            <Setter.Value>
                <ControlTemplate>
                    <TextBox x:Name="PART_TextBox" Width="113" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" Text="{Binding Path=SelectedDate,Converter={StaticResource DateTimeFormatter},RelativeSource={RelativeSource AncestorType={x:Type DatePicker}},ConverterParameter=dd-MMM-yyyy}" BorderBrush="{DynamicResource BaseBorderBrush}" />
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</DatePicker.Resources> 
```

正如您在这部分中所注意到的，当时存在一个名为 DateTimeFormatter 的转换器，以绑定到“PART_TextBox”的 Text 属性。此转换器接收包含您的自定义格式的转换器参数。最后，我们在 C# 中为 DateTimeFormatter 转换器添加代码。

```
public class DateTimeConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        DateTime? selectedDate = value as DateTime?;

        if (selectedDate != null)
        {
            string dateTimeFormat = parameter as string;
            return selectedDate.Value.ToString(dateTimeFormat);
        }

        return "Select Date";
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        try
        {

            var valor = value as string;
            if (!string.IsNullOrEmpty(valor))
            {
                var retorno = DateTime.Parse(valor);
                return retorno;
            }

            return null;
        }
        catch
        {
            return DependencyProperty.UnsetValue;
        }
    }
} 
```

我希望这对你有帮助。请让我知道任何问题或改进建议。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2010-12-07T11:07:26.103

```
Thread.CurrentThread.CurrentCulture = (CultureInfo)Thread.CurrentThread.CurrentCulture.Clone();
Thread.CurrentThread.CurrentCulture.DateTimeFormat.ShortDatePattern = "dd-MMM-yyyy"; 
```

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2016-04-05T09:32:29.863

将此样式添加到您的 xaml 或 App.xaml 文件

```
 <Style TargetType="{x:Type DatePickerTextBox}">
     <Setter Property="VerticalContentAlignment" Value="Center"/>
     <Setter Property="Control.Template">
         <Setter.Value>
             <ControlTemplate>
                 <TextBox x:Name="PART_TextBox"
            Text="{Binding Path=SelectedDate, StringFormat='dd.MM.yyyy', 
            RelativeSource={RelativeSource AncestorType={x:Type DatePicker}}}" />
             </ControlTemplate>
         </Setter.Value>
     </Setter>
 </Style> 
```

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2009-11-10T05:54:11.997

在 XAML 中：

```
<toolkit:DatePicker SelectedDateFormat="Long" /> 
```

或者

```
<toolkit:DatePicker SelectedDateFormat="Short" /> 
```

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2012-10-20T22:28:37.010

感谢@Fernando García 提供的基础。

我为 DatePicker 编写了一个 DateFormat 附加属性，它允许您提供一个格式字符串用于显示和输入。

对于输入，它将尝试使用提供的格式进行解析，然后回退到尝试使用当前区域性的格式进行解析。

问题格式的示例用法：

```
<DatePicker my:DatePickerDateFormat.DateFormat="dd/MMM/yyyy"/> 
```

DateFormat 附加属性是：

```
public class DatePickerDateFormat
{
    public static readonly DependencyProperty DateFormatProperty =
        DependencyProperty.RegisterAttached("DateFormat", typeof (string), typeof (DatePickerDateFormat),
                                            new PropertyMetadata(OnDateFormatChanged));

    public static string GetDateFormat(DependencyObject dobj)
    {
        return (string) dobj.GetValue(DateFormatProperty);
    }

    public static void SetDateFormat(DependencyObject dobj, string value)
    {
        dobj.SetValue(DateFormatProperty, value);
    }

    private static void OnDateFormatChanged(DependencyObject dobj, DependencyPropertyChangedEventArgs e)
    {
        var datePicker = (DatePicker) dobj;

        Application.Current.Dispatcher.BeginInvoke(
            DispatcherPriority.Loaded, new Action<DatePicker>(ApplyDateFormat), datePicker);
    }

    private static void ApplyDateFormat(DatePicker datePicker)
    {
        var binding = new Binding("SelectedDate")
            {
                RelativeSource = new RelativeSource {AncestorType = typeof (DatePicker)},
                Converter = new DatePickerDateTimeConverter(),
                ConverterParameter = new Tuple<DatePicker, string>(datePicker, GetDateFormat(datePicker))
            };
        var textBox = GetTemplateTextBox(datePicker);
        textBox.SetBinding(TextBox.TextProperty, binding);

        textBox.PreviewKeyDown -= TextBoxOnPreviewKeyDown;
        textBox.PreviewKeyDown += TextBoxOnPreviewKeyDown;

        datePicker.CalendarOpened -= DatePickerOnCalendarOpened;
        datePicker.CalendarOpened += DatePickerOnCalendarOpened;
    }

    private static TextBox GetTemplateTextBox(Control control)
    {
        control.ApplyTemplate();
        return (TextBox) control.Template.FindName("PART_TextBox", control);
    }

    private static void TextBoxOnPreviewKeyDown(object sender, KeyEventArgs e)
    {
        if (e.Key != Key.Return)
            return;

        /* DatePicker subscribes to its TextBox's KeyDown event to set its SelectedDate if Key.Return was
         * pressed. When this happens its text will be the result of its internal date parsing until it
         * loses focus or another date is selected. A workaround is to stop the KeyDown event bubbling up
         * and handling setting the DatePicker.SelectedDate. */

        e.Handled = true;

        var textBox = (TextBox) sender;
        var datePicker = (DatePicker) textBox.TemplatedParent;
        var dateStr = textBox.Text;
        var formatStr = GetDateFormat(datePicker);
        datePicker.SelectedDate = DatePickerDateTimeConverter.StringToDateTime(datePicker, formatStr, dateStr);
    }

    private static void DatePickerOnCalendarOpened(object sender, RoutedEventArgs e)
    {
        /* When DatePicker's TextBox is not focused and its Calendar is opened by clicking its calendar button
         * its text will be the result of its internal date parsing until its TextBox is focused and another
         * date is selected. A workaround is to set this string when it is opened. */

        var datePicker = (DatePicker) sender;
        var textBox = GetTemplateTextBox(datePicker);
        var formatStr = GetDateFormat(datePicker);
        textBox.Text = DatePickerDateTimeConverter.DateTimeToString(formatStr, datePicker.SelectedDate);
    }

    private class DatePickerDateTimeConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            var formatStr = ((Tuple<DatePicker, string>) parameter).Item2;
            var selectedDate = (DateTime?) value;
            return DateTimeToString(formatStr, selectedDate);
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            var tupleParam = ((Tuple<DatePicker, string>) parameter);
            var dateStr = (string) value;
            return StringToDateTime(tupleParam.Item1, tupleParam.Item2, dateStr);
        }

        public static string DateTimeToString(string formatStr, DateTime? selectedDate)
        {
            return selectedDate.HasValue ? selectedDate.Value.ToString(formatStr) : null;
        }

        public static DateTime? StringToDateTime(DatePicker datePicker, string formatStr, string dateStr)
        {
            DateTime date;
            var canParse = DateTime.TryParseExact(dateStr, formatStr, CultureInfo.CurrentCulture,
                                                  DateTimeStyles.None, out date);

            if (!canParse)
                canParse = DateTime.TryParse(dateStr, CultureInfo.CurrentCulture, DateTimeStyles.None, out date);

            return canParse ? date : datePicker.SelectedDate;
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-12-29T10:05:59.613

```
DatePicker1.SelectedDate = DatePicker1.SelectedDate.Value.ToString("dd/MM/yyyy") 
```

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2011-11-11T14:20:01.620

对我来说，改变环境来改变`DatePicker`格式（比如`Thread.CurrentCulture`）不是一个好主意。当然，您可以创建`Control`派生`DatePicker`并实现依赖属性，例如`Format`，但这需要花费太多精力。

我发现的简单而优雅的解决方案是将值绑定到`SelectedDate`自身，而不是绑定到一些未使用的属性（我`ToolTip`为此使用了属性），并在 SelectedDate 更改时更新此属性。

单向绑定的 C# 实现如下所示：

```
 DatePicker datePicker = new DatePicker();
    datePicker.SetBinding(ToolTipProperty, "Date");
    datePicker.SelectedDateChanged += (s, ea) =>
        {
            DateTime? date = datePicker.SelectedDate;
            string value = date != null ? date.Value.ToString("yyyy-MM-dd") : null;
            datePicker.ToolTip = value;
        }; 
```

XAML+C# 应如下所示：

XAML：

```
<DatePicker ToolTip="{Binding Date Mode=TwoWay}"
            SelectedDateChanged="DatePicker_SelectedDateChanged"/> 
```

C＃：

```
private void DatePicker_SelectedDateChanged(object sender, EventArgs ea)
{
    DatePicker datePicker = (DatePicker)sender;
    DateTime? date = datePicker.SelectedDate;
    string value = date != null ? date.Value.ToString("yyyy-MM-dd") : null;
    datePicker.ToolTip = value;
} 
```

对于两种方式的实现处理`ToolTipChanged`事件更新的方式相同`SelectedDate`。

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T05:47:53.200

通常，日期时间格式存储在资源文件中，因为这将有助于应用程序的国际化。

您可以从资源文件中选择格式并使用`ToString(DATE_FORMAT)`

在您的情况下，您可能想要使用

```
dateTimePicker.SelectedDate.ToString("dd-MMM-yyyy"); 
```

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2016-10-29T07:50:07.643

尝试这个

```
 private void UserControl_Loaded(object sender, RoutedEventArgs e)
    {
      DateLabel.Content = Convert.ToDateTime(datePicker1.Text).ToString("dd-MM-yyyy");
    } 
```

# c# - 获取存储在一块内存中的字节数？

> ID：641579
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T05:30:07.970
> 
>         
> 
> 标签：c#, memory-management, interop

我在 C# 中分配一块内存以从非托管数据缓冲区中检索信息：

```
handle = Marshal.AllocHGlobal(33455); 
```

检索到的信息的最大大小为 33,455 字节，但在某些情况下，信息的大小可能会小于此大小。

如何确定分配的块中实际使用了多少字节，而不是实际分配了多少？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T05:34:26.603

系统应该如何知道使用的数据与随机数据？它对您的数据结构一无所知。它只知道你分配了多少。您没有在句柄中存储字节。句柄只是指为您预留的一块内存。

您可以将数据初始化为一个标记值（例如 Windows 将在调试模式下执行的 0xcdcdcdcd），然后您可以计算它。或者，如果数据是字符串，您可以调用 strlen()（或安全字符串函数之一）。或者，您可以编写一些包装函数来包装用于写入内存的 API，并跟踪您使用了多少数据。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T05:43:02.400

根据 MSDN 上的文档

[http://msdn.microsoft.com/en-us/library/s69bkh17.aspx](http://msdn.microsoft.com/en-us/library/s69bkh17.aspx)

您将获得分配的内存，或者如果请求无法完成，您将获得内存不足异常。

因此，您的问题的答案是您将：1）通过“句柄”分配和引用 33455 字节的内存，或者...... 2）将引发内存不足异常，并且您将有零字节通过“句柄”分配和引用的内存。

在这个非常低的水平上，这就是你所知道的。

您可以在块的开头存储一个计数以指示您使用了多少，或者按照建议使用哨兵值。

# asp.net-mvc - ASP.NET MVC 中的 ModelFactory 解决“RenderPartial”问题

> ID：641600
> 
>         
> 
> 赞同：9
> 
>         
> 
> 时间：2009-03-13T05:46:34.077
> 
>         
> 
> 标签：asp.net-mvc, renderpartial, subcontroller

ASP.NET MVC 中的“RenderPartial()”方法提供了非常低级别的功能。它不提供，也不试图提供真正的“子控制器”模型*。

我有越来越多的控件通过“RenderPartial()”呈现。它们分为 3 个主要类别：

> 1) 作为使用该页面模型的特定页面的直接后代的控件
> 
>   
>   
> 
> 2) 作为特定页面的直接后代的控件，这些控件使用该页面的模型和
>   [某种类型的附加键](https://stackoverflow.com/questions/369573/how-do-you-pass-an-arbitrary-bit-of-data-to-a-user-control-in-asp-net-mvc-using-h/584752#584752)。想想“DataRepeater”的实现。
> 
>   
>   
> 
> 3) 代表与其出现的页面无关的功能的控件。这可以是任何东西，从横幅旋转器到反馈表、商店定位器、邮件列表注册。关键是它不在乎放在哪个页面上。

由于`ViewData`模型的工作方式，每个请求只存在一个模型对象——也就是说，子控件需要的任何东西都必须存在于页面模型中。

最终，MVC 团队将有望推出真正的“子控制器”模型，但在那之前，我只是在主页面模型中添加子控件也需要的任何内容。

在上述 (3) 的情况下，这意味着我的“ProductModel”模型可能必须包含“MailingListSignup”模型的字段。显然这并不理想，但我已经接受了与当前框架的最佳折衷方案 - 并且最不可能“关闭任何门”到未来的子控制器模型。

控制器应该负责获取模型的数据，因为模型实际上应该只是一个不知道从哪里获取数据的愚蠢数据结构。但我不希望控制器必须在几个不同的地方创建模型。

我已经开始做的是创建一个工厂来为我创建模型。这个工厂被控制器调用（模型不知道工厂）。

```
public static class JoinMailingListModelFactory {

        public static JoinMailingListModel CreateJoinMailingListModel() {

            return new JoinMailingListModel()
            {
                MailingLists = MailingListCache.GetPartnerMailingLists();
            };
        }
    } 
```

所以我的实际问题是其他有同样问题的人实际上是如何创建模型的。未来与新 MVC 功能兼容的最佳方法是什么？

* * *

*   注意：有一些问题`RenderAction()`我不会在这里讨论——尤其是它只在 MVCContrib 中，而不是在 ASP.NET-MVC 的 RTM 版本中。其他问题引起了[足够多的问题](https://stackoverflow.com/questions/523695/post-method-called-on-mvc-usercontrols-as-well-as-their-parent-views)，我选择不使用它。所以让我们暂时假装它只`RenderPartial()`存在——或者至少那是我决定使用的。

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-16T05:47:49.847

与其添加诸如`MailingListSignup`属性之类的东西，不如`ProductModel`将两者封装在一个类中的同一级别，`ProductViewModel`如下所示：

```
public class ProductViewModel() {
    public ProductModel productModel;
    public MailingListSignup signup;
} 
```

然后让你的视图被强类型化到`ProductViewModel`类中。您可以`ProductModel`通过调用访问`Model.productModel`，也可以使用 访问注册类`Model.signup`。

这是对 Fowler 的“演示模型”( [http://martinfowler.com/eaaDev/PresentationModel.html](http://martinfowler.com/eaaDev/PresentationModel.html) ) 的松散解释，但我已经看到一些 Microsoft 开发人员使用它，例如 Rob Conery 和 Stephen Walther。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T05:58:23.377

我在这种情况下看到的一种方法是使用动作过滤器来填充部分视图的数据 - 即 subclass `ActionFilterAttribute`。在 中`OnActionExecuting`，将数据添加到 ViewData。然后，您只需使用过滤器装饰*使用*该部分视图的不同操作。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T20:19:13.120

我使用了一个 RenderPartial 重载，让您指定一个新的 ViewData 和 Model：

[渲染部分代码](http://aspnet.codeplex.com/SourceControl/changeset/view/21528#288013)

如果你看MVC源代码的上一个链接，以及下面的（寻找RenderPartialInternal方法）：

[RenderPartial内部代码](http://aspnet.codeplex.com/SourceControl/changeset/view/21528#266468)

您可以看到，如果基本上复制您传递的视图数据，则创建一个新字典并设置要在控件中使用的模型。所以页面可以有一个Model，但是再传递一个不同的Model给子控件。

如果子控件没有直接从主视图模型中引用，您可以使用 Marc Gravell 提到的技巧来添加您的自定义逻辑。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-07-07T21:34:41.967

我尝试的一种方法是使用带有接口的强类型局部视图。在大多数情况下，聚合 ViewModel 是更好的方法，但我仍然想分享这一点。

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<IMailingListSignup>" %> 
```

Viewmodel 实现接口

```
 public class ProductViewModel:IMailingListSignup 
```

这一点都不完美，但解决了一些问题：您仍然可以轻松地将属性从路由映射到模型。我不确定是否可以将路由参数映射到 MailingListSignup 的属性，否则。

您仍然有填充模型的问题。如果还不晚，我更喜欢在 OnActionExecuted 中进行。我看不到如何在 OnActionExecuting 中填充模型。

# asp.net - ASP.NET Charting Control 货币格式

> ID：641603
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T05:49:23.883
> 
>         
> 
> 标签：asp.net, formatting, charts

我需要为我的 Y 轴标签使用不同的货币。我阅读了[http://social.msdn.microsoft.com/Forums/en-US/MSWinWebChart/thread/56453466-06b1-4df4-8265-5c63dc18efe5/](http://social.msdn.microsoft.com/Forums/en-US/MSWinWebChart/thread/56453466-06b1-4df4-8265-5c63dc18efe5/)但我仍在努力将美元符号更改为不同的字符。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-14T20:28:47.640

在 FormatNumber 事件中：

```
if (e.ElementType == DataVisualization.Charting.ChartElementType.AxisLabels)
{
    System.Globalization.NumberFormatInfo nfi = new System.Globalization.NumberFormatInfo();
    nfi.CurrencySymbol = "#";
    e.LocalizedValue = string.Format(nfi, e.Format, e.Value);
} 
```

# asp.net - 确定控件是在 Web 窗体还是母版页中呈现的最有效方法是什么？

> ID：641605
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T05:49:46.847
> 
>         
> 
> 标签：asp.net, user-controls, master-pages

我有一个可以放置在 Web 表单 (.aspx) 或母版页 (.master) 中的控件。我希望它根据它所在的功能而有所不同。

我的第一个想法是将控件树爬回根目录，看看我是否越过了 MasterPage 控件。如果是这样，那么它必须在母版页中。

但是，这似乎效率低下。有没有更好的办法？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T05:52:22.160

我不确定是否有更有效的方法，但如果您要爬上层次结构，请通过[NamingContainer](http://msdn.microsoft.com/es-es/library/system.web.ui.control.namingcontainer.aspx)进行。通过使用它，您将跳过大量不必要的跳跃。

除非是一个会在页面上出现很多时间的控件，否则通过 NamingContainer 将绰绰有余:)

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T08:02:43.517

首先检查页面是否有母版页。然后通过控制树寻找内容占位符：

```
public static bool IsInMaster(Control control) {
    if (control.Page.Master == null) return false;
    while (control != null) {
        if (control is ContentPlaceHolder) return false;
        control = control.Parent;
    }
    return true;
} 
```

# c# - 混合自定义和基本序列化？

> ID：641612
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T05:55:10.313
> 
>         
> 
> 标签：c#, xml, serialization

我有一个具有 100 多个属性的类（它是一个数据库映射类），其中一个属性必须在一个方法中。换句话说，这些数据不是通过属性而是通过方法公开的：

“ABCType GetABC(), SetABC(ABCType 值)”

这一切都非常不像 C#。当我看到它时，我不寒而栗。

该类需要可序列化，以便可以通过 Web 服务发送，并且 Get/Set 方法公开的数据也需要序列化。（它在一个方法中，因为我使用的网格对反射做了一件奇怪的事情；它无法处理包含与包含对象相同类型的属性的对象。问题属性将数据库对象的原始状态存储在如果需要还原。是的，实施效率低下 - 但我无法重新设计它。）

我的问题是这样的：因为只有这 1 个字段需要自定义序列化代码，所以我想仅将自定义序列化用于调用 GetABC 和 SetABC，将类的其余部分恢复为基本 XML 序列化。它将最大限度地减少我的序列化代码中出现错误的可能性。有办法吗？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T06:03:30.073

我要尝试的第一件事是添加一个用于序列化的属性，但将其隐藏在 UI 中：

```
[Browsable(false)] // hide in UI
public SomeType ABC {
    get {return GetABC();}
    set {SetABC(value);}
} 
```

不幸的是，你不能真正混合和匹配序列化；一旦你实施`IXmlSerializable`，你就拥有了*一切*。如果您使用的是 WCF，则`DataContractSerialier`支持序列化的非公共属性，因此您可以使用：

```
[DataMember]
private SomeType ABC {
    get {return GetABC();}
    set {SetABC(value);}
} 
```

但这不适用于通过`XmlSerializer`.

这个`[Browsable]`技巧真的有用吗？假设自定义网格使用`TypeDescriptor`，另一个选项可能是通过 隐藏它`ICustomTypeDescriptor`，但这只是为了隐藏一个属性需要做很多工作......

# windows - 文件的内存映射与 CreateFile/ReadFile

> ID：641614
> 
>         
> 
> 赞同：15
> 
>         
> 
> 时间：2009-03-13T05:57:13.287
> 
>         
> 
> 标签：windows, winapi, memory-mapped-files

与使用 CreateFile ReadFile 组合执行相同操作相比，使用内存映射文件读取（常规大小的文件）有哪些缺点（如果有）？

* * *

## 回答 #1

> 赞同：13
> 
>             
> 
> 时间：2009-03-15T00:29:16.330

使用 ReadFile/WriteFile，您可以获得确定性的错误处理语义。当您使用内存映射文件时，会通过抛出异常来返回错误。

此外，如果内存映射文件必须访问磁盘（或更糟糕的是，网络），您的内存读取可能需要几秒钟（甚至几分钟）才能完成。根据您的应用程序，这可能会导致意外停顿。

如果您使用 ReadFile/WriteFile，您可以使用 API 的异步变体来控制此行为。

如果您使用 ReadFile，您还可以获得更多的确定性性能，特别是如果您的 I/O 模式是可预测的 - 内存映射 I/O 通常是随机的，而 ReadFile 几乎总是串行的（因为 ReadFile 在当前文件位置读取并推进当前文件位置）。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-11-12T05:10:19.690

文件映射的一大优点是它不会影响系统缓存。如果您的应用程序通过 ReadFile 进行过多的 I/O，您的系统缓存将增长，消耗越来越多的物理内存。如果您的操作系统是 32 位并且您的内存远远超过 1GB，那么您就很幸运了，因为在 32 位 Windows 上，系统缓存的大小受到 1GB 的限制。否则系统缓存将消耗所有可用的物理内存，并且内存管理器将很快开始将其他进程的页面清除到磁盘，从而加强磁盘操作而不是实际减少它们。这种效果在 64 位 Windows 上尤为明显，其中缓存大小仅受可用物理内存的限制。另一方面，文件映射不会导致系统缓存过度增长，同时不会降低性能。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T06:08:38.377

您需要更复杂的代码来建立文件映射，而不仅仅是打开和读取。文件映射旨在随机访问文件的一部分。如果您不需要它，请不要打扰文件映射。

此外，如果您需要将您的代码移植到另一个平台上，如果您不使用文件映射，您会更容易、更快地完成它。

# c# - 什么时候应该使用字段而不是属性？

> ID：641619
> 
>         
> 
> 赞同：10
> 
>         
> 
> 时间：2009-03-13T06:00:17.460
> 
>         
> 
> 标签：c#, theory

任何人都可以清楚地说明您何时使用字段以及何时在类设计中使用属性？

考虑：

```
public string Name; 
```

或者：

```
private string _Name;
public string Name
{
   get { return _Name; }
   set { _Name = value; }
} 
```

我意识到第二种方法更合适和灵活，所以这就是我通常尝试使用的方法。

但是为什么我看到人们使用第一种方法呢？他们只是懒惰，还是在某些特定情况下这是正确的选择？这只是偏好问题吗？

* * *

## 回答 #1

> 赞同：15
> 
>             
> 
> 时间：2009-03-13T06:05:39.553

那么在 C# 3.0 中，您实际上可以编写：

```
public string Name {get; set;} 
```

这可以让你变得适当和懒惰。

一般来说，使用属性，您可以获得适当的封装。您可以选择允许设置值或获取值，或两者兼而有之。使用公共成员，您没有该选项。

这可能是一方面的偏好，一方面是您的团队决定如何处理快速和肮脏的类定义，但我想说的是，使用 get/sets 的属性。

回答

> 任何人都可以清楚地说明您何时使用属性以及何时在类设计中使用属性？

你永远不应该使用公共属性。您应该始终使用属性。它更安全、更灵活。也就是说，人们会很懒惰，只会使用公共成员。但是，在 C# 3.0 中，您可以使用更简洁的语法来定义属性，这应该可以满足您内心的懒惰。

只需键入`prop`并点击`<tab>`即可加快添加属性的懒惰。

* * *

## 回答 #2

> 赞同：14
> 
>             
> 
> 时间：2009-03-13T06:17:44.830

艾伦回复的一些附加信息：

```
public string Name {get; set;} 
```

是相同的

```
private string _Name;

public string Name{   
get { return _Name; }   
set { _Name = value; }
} 
```

如果你想禁止名称的设置功能，你可以有

公共字符串名称 {get; **私人**集;}

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T06:10:09.480

属性比字段更易于维护，您可以将逻辑封装在您的 setter/getter 中，从而允许您隐藏实现。

它们还使重构更容易。

更多信息：

*   [物业使用指南](http://msdn.microsoft.com/en-us/library/bzwdh01d(VS.71).aspx)

*   [字段使用指南](http://msdn.microsoft.com/en-us/library/ta31s3bc(VS.71).aspx)

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T08:56:27.333

使用属性可以控制它的安全性：

```
public string Foo { protected get; private set; } 
```

属性提供了引发事件的简单方法：

```
public string Foo
{
  get { return _foo; }
}
set
{
  bool cancel = false;
  if(BeforeEvent != null) // EventHandler<CancelEventArgs> BeforeEvent
  {
    CancelEventArgs e = new CancelEventArgs();
    BeforeEvent(this, e);
    cancel = e.Cancel;
  }
  if(!cancel)
  {
    _foo = value;
    if(AfterEvent != null) // EventHandler<EventArgs> AfterEvent
    {
      AfterEvent(this, new EventArgs());
    }
  }
} 
```

我也经常使用这样的代码：

```
string Foo
{
  set
  {
    IsFooSet = value != null;
  }
}

bool IsFooSet
{
  get { return _isFoo; }
  set
  { 
   _isFoo = value;
   if(value) // some event raise or controls on form change
  }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:13:54.063

当您公开该字段时，您允许用户对该字段执行任何他们想做的事情。他们可以分配意外值、无效值、可能导致溢出的值等。

使用该属性，您可以控制是否允许为字段设置新值、在存储之前按摩值、通知相关方有关字段值的更改等。以及通过 getter 返回值的相同想法. 对于 2.0 以上的 .NET 框架，您可以为 getter、setter 设置访问器。比如说，您只希望用户对该字段只有读取权限，然后您将 getter 设为 public，但将 setter 设为私有或受保护。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T10:44:21.413

除了已经给出的首选属性的原因之外，System.ComponentModel 中还有很多很酷的东西与数据绑定和仅适用于属性而不是字段的更改通知有关。例如，查看有关 PropertyChangedHandler 的文档。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2014-05-29T18:03:16.923

上面定义的属性就像 getter 和 setter。使用属性的唯一好处是您可以将其视为具有访问限制的变量。

```
public string Name { get; private set; } 
```

此属性可以公开访问，但只能私下设置。（您现在不希望任何人未经您的同意而更改您的名字！;)）

# silverlight - Silverlight MVVM 链接模型和视图模型

> ID：641633
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-03-13T06:13:26.820
> 
>         
> 
> 标签：silverlight, mvvm, model, linker

MVVM 上有很多很好的例子，但我仍然很困惑。

假设您有一个 CustomerModel 和一个 CustomerViewModel。似乎 CustomerModel 上会有一个 Name 属性，而 CustomerViewModel 上会有一个。CustomerViewModel 上的设置器将设置 CustomerModel Name 属性，然后调用 OnPropertyChanged(PropName) 以便更新 UI。这真的正确吗？似乎 getter/setter 将被定义两次。如果您有一个具有 50 个属性的模型，那么这将变得非常乏味。

另外，假设我设置了一个 Qty 属性。ViewModel 更新模型。模型根据新的数量更新其 Value 属性。ViewModel 如何收到 Model 属性更改的通知？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-19T20:47:06.620

您的 ViewModel 不必严格封装模型。在您的场景中，CustomerViewModel 可能有一个 Customer 属性，这最终意味着您的 View 绑定到 Model 属性......它只是通过 ViewModel 来实现的。这是完全合法的。然而，这就是说，封装它通常是有好处的。您的商业模式可能不包括变更通知。在用户单击 OK 按钮之前，您可能不希望用户交互修改业务模型。您的业​​务模型可能会通过错误输入的异常，而您想使用另一种形式的验证。我相信你可以想到其他事情。事实上，我猜大多数时候你会想要封装，所以它并不是真的“乏味”

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T10:54:44.710

在您提供的客户示例中，CustomerModel 包含您的数据库（或其他后端）存储的所有信息。如果将在 UI 上显示 CustomerViewModel 包含类似的信息（名称等，如果您有一个大类，可能还有 50 个其他属性），但使用 INotifyPropertyChanged 接口将它们显示为视图（即 XAML）可以的属性绑定到。

例如

```
public int Name
{
    get
    {
        return this.name;
    }

    set
    {
        if (this.name!= value)
        {
            this.name= value;
            this.OnPropertyChanged("Name");
        }
    }
} 
```

ViewModel 还包含 UI 状态的其他位 - 可见性标志、当前选项卡索引、由多个字段中的数据构建的更复杂的文本位、子项的 ObservableCollection<> 等。所有这些都将绑定到 XAML。

我已经看到从 Model 创建的 ViewModel 是一次性的，单向的过程，例如使用构造函数：

```
 CustomerViewModel viewModel = new CustomerViewModel(customer); 
```

或作为扩展方法

```
 CustomerViewModel viewModel = customer.ToViewModel(); 
```

我还没有看到任何更新 ViewModel 以更改模型的规定 - ViewModel 的重点是它与模型隔离。它保留数据的单独副本。它不会将更改传播回模型，直到您按下“保存”按钮。因此，如果您改为取消，则模型中的任何内容都没有改变，也没有什么可以撤消的。

您可能过于努力地使 ViewModel 与模型保持同步 - 大多数情况下，例如保存或加载，您可以丢弃当前的 ViewModel 并从模型的当前状态创建一个新的。是否需要保留 ViewModel 的 UI 状态并更改其中的数据？这不是一个常见的要求，但可以通过在保存或加载发生时调用的一两个方法来完成。

所以也有这样的假设，即这种连线逻辑发生在某个地方。这就是为什么大多数涉及*视图*的模式还涉及*控制器*，这些控制器负责执行命令（例如显示客户、保存客户）并在之后设置新的 UI 状态。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-05-08T13:16:12.597

[正如wekempf](https://stackoverflow.com/users/80193/wekempf)已经说明的那样，具体如何完成将部分取决于您的商业模式。

根据您在 UI 中显示客户信息的方式，您的 ViewModel 中可能有一个客户（您的模型）类型的 ObservableCollection。例如，如果您正在显示一个主/详细方案，您可能有一个客户列表，并在选择特定客户时在下面显示详细信息。

# .net - 默认 ContextMenu 样式 - WPF

> ID：641634
> 
>         
> 
> 赞同：13
> 
>         
> 
> 时间：2009-03-13T06:13:35.400
> 
>         
> 
> 标签：.net, wpf, contextmenu

我正在尝试修改 WPF 中 ContextMenu 的默认样式。  

通常，您可以使用 Edit Control Parts (Template) > Edit a Copy 菜单选项在 Expression Blend 中创建默认值的副本。但是我不知道如何使用 ContextMenu 来做到这一点。知道如何获得要修改的默认样式吗？

我正在尝试禁用通常显示图标的上下文菜单的左侧。  

谢谢！

**更新：**  也许我不清楚删除图标。例如，如果您有一个没有图标的上下文菜单，那么菜单的整个左侧都是浪费空间。我想修改上下文菜单背景的默认样式以删除它。只是我不知道如何访问这种默认样式。

* * *

## 回答 #1

> 赞同：19
> 
>             
> 
> 时间：2009-03-24T04:45:30.040

对于无法通过 Expression Interface 访问的模板和样式（例如 ContextMenu 模板），您可以使用以下代码来提取模板：

```
Dim sb As System.Text.StringBuilder = New System.Text.StringBuilder
Using Writer As TextWriter = New StringWriter(sb)
    System.Windows.Markup.XamlWriter.Save(ContextMenu.Template, Writer)
End Using
Debug.Write(sb.ToString) 
```

或者在 C# 中

```
var str = new StringBuilder();
using (var writer = new StringWriter(str))
    XamlWriter.Save(ContextMenu.Template, writer);
Debug.Write(str); 
```

* * *

## 回答 #2

> 赞同：10
> 
>             
> 
> 时间：2010-07-19T19:05:53.637

我找到了在 Blend 中获取 ContextMenu 模板的简单方法：

1.  我向带有一些菜单项的按钮添加了 ContextMenu。

2.  在属性窗格的“杂项”下，有一个用于 ContextMenu 的分组项。

3.  打开这个。您会发现通常的样式和模板属性。

4.  单击弹出菜单的方块，然后选择转换为新资源...

就是这样。选择您想要放置模板/样式的位置，然后就完成了。

这是我的标记：

```
<StackPanel x:Name="LayoutRoot">
    <Button Content="Click for ContextMenu" Width="30" HorizontalAlignment="Center" VerticalAlignment="Center">
        <Button.ContextMenu>
            <ContextMenu Template="{DynamicResource ContextMenuControlTemplate1}" Style="{DynamicResource ContextMenuStyle1}">
                <MenuItem Header="File"/>
                <MenuItem Header="Edit"/>
                <MenuItem Header="View"/>
                <MenuItem Header="Recent Files"/>
                    <MenuItem Header="file1.txt"/>
                    <MenuItem Header="file2.txt"/>
            </ContextMenu>
        </Button.ContextMenu>
    </Button>
</StackPanel> 
```

我得到的样式/模板：

```
<Style x:Key="ContextMenuStyle1" TargetType="{x:Type ContextMenu}">
    <Setter Property="Background" Value="{DynamicResource MenuBackgroundBrush}"/>
    <Setter Property="BorderThickness" Value="1"/>
    <Setter Property="BorderBrush" Value="{DynamicResource WindowBorderBrush}"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type ContextMenu}">
                <Border Uid="Border_93">
                    <Border.Style>
                        <Style TargetType="{x:Type Border}">
                            <Setter Property="Tag" Value="{DynamicResource {x:Static SystemParameters.DropShadowKey}}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="True">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Padding" Value="0,0,5,5"/>
                                    <Setter Property="Effect">
                                        <Setter.Value>
                                            <DropShadowEffect BlurRadius="4" Opacity="0.8" ShadowDepth="1"/>
                                        </Setter.Value>
                                    </Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                </Border>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

希望这可以帮助。在通常的 MS 彻底性中，找不到默认样式的画笔。:)

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2016-04-21T09:07:15.137

试试这个：（将此代码放在 XAML 的资源部分中）这应该从上下文菜单中删除图标条。

```
<Style TargetType="{x:Type ContextMenu}">
    <Setter Property="OverridesDefaultStyle" Value="True" />
    <Setter Property="SnapsToDevicePixels" Value="True" />
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type ContextMenu}">
                <Border BorderThickness="1" CornerRadius="4" BorderBrush="Black" x:Name="Border" Background="White">
                    <StackPanel ClipToBounds="True" Orientation="Vertical" IsItemsHost="True" />
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="true">
                        <Setter TargetName="Border" Property="Background" Value="White" />
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T06:26:20.330

实际上，该空间不是 ContextMenu 的一部分，它是 MenuItem 的一部分。因此，只需在表达式混合中将 MenuItem 拖到您的窗口并创建控件的副本。希望您的 ContextMenu 声明如下

```
 <ContextMenu  >
    <MenuItem Header="Copy"/>
    <MenuItem Header="Paste"/>
    <MenuItem Header="Clear"/>
 </ContextMenu> 
```

在您的 MenuItem ControlTemplate 中，您可以看到如下所示的空间。所以删除我在屏幕截图中标记的网格的图标和第一列。

![替代文字](https://i.stack.imgur.com/WGXaP.jpg)

* * *

## 回答 #5

> 赞同：-1
> 
>             
> 
> 时间：2009-03-13T16:13:35.113

左侧的额外空间是由于设置`IsCheckable`和`IsChecked`打开`true`时出现的小复选标记`MenuItem`。

复选标记位于模板中，`MenuItem`因此如果您对其进行编辑，您可以将其取出。

# ssl - 我们可以为开发或 SIT 环境安装任何免费的 ssl 证书吗？

> ID：641637
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T06:16:10.887
> 
>         
> 
> 标签：ssl

有人有这方面的信息吗？

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T06:24:58.853

如果这是您的意思，您可以签署自己的 SSL 证书。你可以去[这里](http://www.tc.umn.edu/~brams006/selfsign.html)获取一些关于在 linux 下设置自签名证书的建议，或者你可以去[这里](http://www.somacon.com/p42.php)获取关于基于 IIS 6 的环境的建议。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T06:25:49.350

例如，您可以使用 OpenSSL 创建任意数量的 SSL 证书。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T06:26:26.850

如果您不关心对根证书颁发机构的正确信任链验证，则可以使用自签名证书。

MS有一个makecert工具。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2014-03-10T02:37:47.580

我认为您可以在第 1 类中免费使用 startssl.com。请查看[http://blog.myee.web.id/get-free-ssl-for-your-site/](http://blog.myee.web.id/get-free-ssl-for-your-site/)或[http://www.myee。 web.id/get-free-ssl-for-your-site/](http://www.myee.web.id/get-free-ssl-for-your-site/)

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2013-08-07T06:19:45.860

[http://cert.startcom.org/](http://cert.startcom.org/)提供免费的 ssl 证书。

**注意：** 
“StartCom 证书政策和实践声明”文件 §3.1.2.1 明确指出 1 类（免费）证书仅用于非商业用途。[3] 先前版本的 CPS 不包括此限制。[https://www.startssl.com/policy.pdf]

# asp.net-mvc - LINQ 查询生成非空嵌套菜单？

> ID：641639
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T06:16:49.590
> 
>         
> 
> 标签：asp.net-mvc, linq

要查看我的问题，请访问 www.apoads.com 并将鼠标悬停在“本地企业”菜单项上。它是从 db 调用生成的一系列嵌套无序列表。继续并单击“本地企业”下的一些项目，您会看到大多数类别都是空的（该站点非常新）。

**问题：** 
我只想显示实际包含本地业务的类别。这是我的类别架构的样子：

```
int BizCatID - PK,Identity (used in FK relation to the table named Biz)
int? ParentID - BizCatID of this rows parentID, null means no parent
nvarchar Name - name of the category
nvarchar Caption - quick description of the category 
```

**我尝试过的：** 
我尝试像这样更新我的 LINQ 查询：

```
from c in db.BizCategories where c.ParentID != null && c.Bizs.Count() > 0 select c; 
```

这显然行不通，因为我需要父类别来显示子类别是否包含业务。所以我尝试了这个：

```
from c in db.BizCategories where c.Bizs.Count() > 0 select c; 
```

这也不起作用，因为父类别下永远不会有任何业务。所以看起来我需要做某种逆递归，但我不知道该怎么做。

或者，也许我正在为自己制造困难，我需要更改我的数据库模式？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T06:35:17.750

我不确定递归位，但这可能会让你开始。是一个两级查询。我猜你想支持任意数量的级别。

```
var allcats = (from c in db. BizCategories
               select c).ToList(); // This will retrieve them all from the database.

var twoLevels = from c in allcats
                where c.ParentID == null
                select new {
                             Name = c.Name, Caption = c.Caption,
                             Children = 
                             from d in allcats 
                             where d.ParentID == c.BizCatID
                             select d
                           }; 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:09:56.060

像这样的查询越来越接近我的需要：

```
from c in BizCategories
    where c.ParentID == null
        select new {
            Name = c.Name, Caption = c.Caption,
            Children = 
            from d in BizCategories
            where d.ParentID == c.BizCatID && d.Bizs.Count() > 0
            select d
        } 
```

我应该能够对这些结果运行另一个 LINQ 查询并准确提取我需要的内容。不是在我现在可以测试的计算机上，但我会尽快回复。谢谢！

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T15:38:04.827

像这样创建类来保存您的信息

```
public class BusinessCat
{
    public string Name{get;set;}
    public string Caption{get;set;}
    public List<'dunno datatype'> Children{get;set;};
}

var results = from c in BizCategories
    where c.ParentID == null
        select new BusinessCat{
            Name = c.Name,
            Caption = c.Caption,
            Children =  (from d in BizCategories
                    where d.ParentID == c.BizCatID && d.Bizs.Count() > 0 select d).ToList()
        } 
```

有了这个，你就有了一个充满孩子的列表，你可以简单地用 foreach 遍历它。

您还可以为 .Join() 扩展方法

```
where d.ParentID == c.BizCatID && d.Bizs.Count() 
```

# php - 访问已由单独类中的方法实例化的类

> ID：641641
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T06:20:18.863
> 
>         
> 
> 标签：php, oop

简而言之：如何访问由不同类的方法实例化的类的方法？

我现在正在查看一些代码，它执行以下操作（更改代码不是一种选择，顺便说一句。它不是我的......我只是破译它）：

一个类有一个实例化不同类的方法。它看起来像这样：

```
// 这个文件被命名为 fooClassHere.php

类Foo{
    公共$meh；

    函数栏（）{
        $某事=新巴兹；
        $this->meh = $something->getStuff();
    }
}

```

我想弄清楚的是如何访问这个实例化类 Baz 的方法。另一个页面包含如下内容：

```
包括“bazClassHere.php”；
包括'fooClassHere.php'；

$a = 新的 Foo；
$a->bar();

```

那么现在不应该所有的 Baz 都以某种方式可用（而不仅仅是我分配给 $this->meh 的 getStuff()）？包含 Foo 和 Baz 类，代码实例化 Foo，然后调用 Foo 的方法 bar() 反过来实例化 Baz 类。显然下面会显示 Baz 的 getStuff() 方法返回的数据：

```
var_dump($a->meh);

```

但我想访问Baz 的**所有**可用方法，而无需像在 Foo 的 bar 方法中那样手动分配它们的中间步骤：

```
$this->meh = $something->getStuff()
```

也许是这样的（但当然这不起作用）：

```
$a = 新的 Foo；

$a->bar(); //将 Baz 实例化为 $something
$a->something->fromBaz(); //$something 是 Baz 的一个实例，是吗？不？

```

我希望这是有道理的，并且我没有将这个问题与我的笔记混淆。确认！>_<

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T06:25:11.957

如果更改代码不是一种选择，那么您就不走运了。要实现您想要的，请执行以下操作：

```
class Foo {
    public $meh;
    public $something;

    function bar(){
        $this->something = new Baz;
        $this->meh = $this->something->getStuff();
    }
} 
```

然后稍后您可以执行以下操作：

```
$foo = new Foo;
$foo->something->myBazMethod(); 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T10:53:13.810

您可以在 Foo 类上使用 __call，在 php.net 上查找

基本上，当您尝试调用该类没有的函数时，会调用 __call。在那里，您可以将请求传递给您的内部对象。

```
class a
{
    protected $b;

    public function __construct()
    {
        $this->b = new b();
    }

    public function meh()
    {
        return 'meh';
    }

    public function __call($func, $param)
    {
        return call_user_func_array(array($this->b, $func), $param);
    }
}

class b
{
    public function yo($something)
    {
        return $something;
    }
}

$a = new a();
echo $a->meh();
echo $a->yo('dude!'); 
```

# math - 将矩阵对角线转换为参差不齐的数组？

> ID：641642
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T06:22:07.500
> 
>         
> 
> 标签：math, matrix

我正在尝试为以下问题提出非暴力解决方案。给定一个任意大小的矩阵：

```
[6  0  3  5]
[3  7  1  4]
[1  4  8  2]
[0  2  5  9] 
```

将其对角线转换为向量列表，如下所示：

```
(0)
(1, 2)
(3, 4, 5)
(6, 7, 8, 9)
(0, 1, 2)
(3, 4)
(5) 
```

（在本例中从左下角到右上角）

有没有一种优雅的方法可以做到这一点，而不是迭代左列和顶行？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T07:05:18.007

我只想写一个小函数来将向量索引转换为矩阵索引。

说矩阵是`NxN`方阵，那么就会有`2N-1`向量；如果我们将向量从`0`到编号，则向量的`2N-2`元素将位于行和列（或者相反，行、列的矩阵元素将是向量的元素）。然后，每当您需要访问向量的元素时，只需将坐标从转换为（即，将向量索引转换为矩阵索引）并访问矩阵的适当元素。而不是实际上有一个向量列表，你会得到一些*模仿的东西*`k``n``max(N-1-n+k,k)``max(n+k-N+1,k)``i``j``min(i,j)``N-1+j-i``k,n``i,j`*向量列表，从某种意义上说，它可以为您提供列表中任何向量的任何所需元素 - 这确实同样好。（欢迎鸭子打字；-）*

 *但是，如果您要访问矩阵的每个元素，迭代可能会更快，而不是每次都进行此计算。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T07:10:44.950

（非检查代码）像这样的东西（java代码）：

```
// suppose m is the matrix, so basically an int[][] array with r rows and c columns
// m is an int[rows][cols];

List result = new ArrayList(rows + cols - 1);
for (int i = 0; i < (rows + cols - 1))
{
  int y;
  int x;
  if (i < rows)
  {
    x = 0;
    y = rows - i - 1;
  }
  else
  {
    x = i - rows + 1;
    y = 0;
  }
  Vector v = new Vector();
  while (y < rows && x < cols)
  {
    y++;
    x++;
    v.add(new Integer(m[y][c]));
  }
  result.add(v);
}
// result now contains the vectors you wanted 
```

**编辑：**我把 x 和 y 弄混了，现在更正了。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T18:59:18.600

数学：

```
m = {{6, 0, 3, 5}, 
     {3, 7, 1, 4}, 
     {1, 4, 8, 2}, 
     {0, 2, 5, 9}};

Table[Diagonal[m, i], {i, 1 - Length@m, Length@m[[1]] - 1}] 
```

它给出了第 i 个对角线的列表，其中第 0 个对角线是主对角线，i = -1 给出它下面的一个，等等。换句话说，它返回：

```
{{0}, {1, 2}, {3, 4, 5}, {6, 7, 8, 9}, {0, 1, 2}, {3, 4}, {5}} 
```

当然，使用内置`Diagonal`功能是一种作弊。这是`Diagonal`从头开始的实现：

```
(* Grab the diagonal starting from element (i,j). *)
diag0[m_,i_,j_] := Table[m[[i+k, j+k]], {k, 0, Min[Length[m]-i, Length@m[[1]]-j]}]

(* The i'th diagonal -- negative means below the main diagonal, positive above. *)
Diagonal[m_, i_] := If[i < 0, diag0[m, 1-i, 1], diag0[m, 1, i+1]] 
```

该`Table`函数基本上是一个收集到列表中的 for 循环。例如，

```
Table[2*i, {i, 1, 5}] 
```

返回`{2,4,6,8,10}`。

# mvvm - Silverlight MVVM 标头详细信息

> ID：641644
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T06:24:13.067
> 
>         
> 
> 标签：mvvm, silverlight, header, detailsview

所以可以说我有一个 OrderModel 和一个 OrderViewModel。我在 ViewModel 和 Model 上都有供应商、订单日期等属性，它们是链接在一起的。看过这方面的例子，看起来很简单，尽管在编写 setter/getter 方面有些重复。

现在我该如何处理 OrderDetails？在我的模型中，我会有一个列表。

我有 OrderDetail 的 OrderDetailViewModel 吗？如果是这样，那么 OrderViewModel 是如何提供的呢？作为 ObservableCollection？如果是这样，您如何使其与原始列表保持同步？

这是我没有看到一个像样的例子的地方。如果有人可以指出我，我将不胜感激。我喜欢 MVVM 的概念，但我开始觉得它的开销太大了。为什么不让 ViewModel 也处理模型部分。在日常的 LOB 应用程序中，两者之间真的有那么大的区别来保证真正的 MVVM 似乎需要的所有代码吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T06:54:52.383

看起来这是您需要的：http: [//jonas.follesoe.no/SpeakingAtMSDNLiveNextMonth.aspx](http://jonas.follesoe.no/SpeakingAtMSDNLiveNextMonth.aspx)

谷歌上的翻译将此作为演讲的摘要：

> Silverlight 2 于今年秋季发布，为想要在此基础上创建富 Internet 应用程序 (RIA) 的开发人员奠定了良好的基础。网。在本次会议中，我们将深入了解 Silverlight 2 的发展以及选择 Silverlight 2 作为以数据为中心的业务应用程序平台的好处。本次会议将涵盖通过安全 WCF 服务进行数据访问、如何使用模型-视图-视图模型模式 (MVVM) 构建代码、如何编写代码、设计人员可以使用以及为开发人员提供易于混合的技巧等内容. 会议将围绕潜水日志应用程序构建，演示后代码将可用。

然而与此同时，Jonas 已经在这里谈到了 MVVM：

[http://jonas.follesoe.no/YouCardRevisitedImplementingTheViewModelPattern.aspx](http://jonas.follesoe.no/YouCardRevisitedImplementingTheViewModelPattern.aspx)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-05-01T20:04:37.190

You can use something like this to keep your ObservableCollections synchronised between the model and view model:

```
/// <summary>
/// Keeps one collection synchronised with another.
/// </summary>
/// <typeparam name="Source">The type of the source items.</typeparam>
/// <typeparam name="Destination">The type of the destination items.</typeparam>
public class CollectionSync<Source, Destination>
{
    private readonly Func<Source, Destination> _destItemFactory;
    private readonly Action<Destination>       _destItemRemover;

    private readonly IList<Destination> _destList;
    private readonly IList<Source>      _sourceList;

    /// <summary>
    /// Initializes a new instance of the <see cref="CollectionSync&lt;Source, Destination&gt;"/> class.
    /// </summary>
    /// <param name="sourceList">The source list.</param>
    /// <param name="destList">The destination list.</param>
    /// <param name="destItemFactory">Factory method which creates a Destination for a given Source.</param>
    /// <param name="destItemRemover">Method called when a Destination is removed.</param>
    public CollectionSync(IList<Source> sourceList,
                          IList<Destination> destList,
                          Func<Source, Destination> destItemFactory,
                          Action<Destination> destItemRemover)
    {
        _destItemFactory = destItemFactory;
        _destItemRemover = destItemRemover;
        _sourceList = sourceList;
        _destList = destList;

        ((INotifyCollectionChanged) _sourceList).CollectionChanged += SourceCollection_CollectionChanged;

        PopulateWithAllItems();
    }

    private void PopulateWithAllItems()
    {
        foreach (Source sourceItem in _sourceList)
            _destList.Add(_destItemFactory(sourceItem));
    }

    private void SourceCollection_CollectionChanged(object sender, NotifyCollectionChangedEventArgs args)
    {
        switch (args.Action)
        {
            case NotifyCollectionChangedAction.Add:
                OnItemsAdded(args.NewStartingIndex, args.NewItems);
                break;
            case NotifyCollectionChangedAction.Remove:
                OnItemsRemoved(args.OldStartingIndex, args.OldItems);
                break;
            case NotifyCollectionChangedAction.Reset:
                OnItemsReset();
                break;
            case NotifyCollectionChangedAction.Move:
            case NotifyCollectionChangedAction.Replace:
                throw new NotImplementedException();
        }
    }

    private void OnItemsReset()
    {
        _destList.Clear();
        PopulateWithAllItems();
    }

    private void OnItemsRemoved(int index, ICollection items)
    {
        int itemCount = items.Count;
        for (int i = 0; i < itemCount; i++)
        {
            Destination removed = _destList[index];
            _destList.RemoveAt(index);
            if (_destItemRemover != null)
                _destItemRemover(removed);
        }
    }

    private void OnItemsAdded(int index, IList items)
    {
        int itemIndex = index;
        foreach (Source item in items)
        {
            // Add to Items collection
            _destList.Insert(itemIndex, _destItemFactory(item));
            itemIndex++;
        }
    }
} 
```

Taking your Order/OrderDetails example, in your Order view model you would hook up the two ObservableCollections like this:

```
_modelToViewModelSync = new CollectionSync<IOrderDetail, OrderDetailViewModel>(
    orderDetailModels,                 // the list of your order details models
    OrderDetails,                      // the list of order details view models exposed by the Order view model
    x => new OrderDetailViewModel(x),  // factory method to create a view model
    null);                             // do something here if you care when your view models are removed 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-05-01T20:13:07.200

当谈到“我是否需要另一个视图模型”这个问题时，我的回答是：如果您的视图所做的只是显示模型数据，那么直接绑定到订单并没有什么坏处。为此创建一个 ViewModel 将是非常多余的。需要创建 ViewModel 的时间是当您在“订单详细信息”屏幕中有需要表示的逻辑或状态时。不是将它添加到模型中，而是在那时创建一个 ViewModel。

至于保持这些项目同步，类似于 GraemeF，我创建了一个 Binder 类，它使用反射将两个值绑定在一起。它使我的模型和视图模型属性保持同步，并且可用于使其他事物保持同步，例如这个特定的集合。创建这样的活页夹有一些开销，但是一旦完成，您就可以以函数方式指定数据相关性，这非常好。

# cocoa-touch - 播放声音的 iPhone 应用程序出现问题

> ID：641650
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T06:26:01.907
> 
>         
> 
> 标签：cocoa-touch, core-audio

我开发了一个播放声音的 iPhone 应用程序。  

但是，当我在模拟器中播放声音时，控制台会显示以下行（[也显示在此屏幕截图中](http://img12.imageshack.us/img12/7097/picture2mtb.png)）。

```
[12:07:07.505 <0xb0185000>] could not find audio decoder component 64766938 for registration
[12:07:07.506 <0xb0185000>] could not find audio decoder component 6D730011 for registration
[12:07:07.514 <0xb0185000>] could not find audio decoder component 696C6263 for registration
[12:07:07.514 <0xb0185000>] could not find audio decoder component 6D730031 for registration
[12:07:07.515 <0xb0185000>] could not find audio decoder component 696C6263 for registration 
```

问题是什么？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T08:22:48.897

您如何加载文件，以及如何将文件添加到应用程序？

如果您将声音文件包含在应用程序的捆绑包中，则可能由于您错误地加载资源而导致此错误。

如果是这种情况，这是您要检索声音文件的代码：

`NSString *resPath = [[NSBundle mainBundle] pathForResource:kMySoundFileName ofType:kMySoundFileNameExtension inDirectory:@""];`

# c# - 如果发生错误，using 语句会回滚数据库事务吗？

> ID：641660
> 
>         
> 
> 赞同：85
> 
>         
> 
> 时间：2009-03-13T06:32:40.987
> 
>         
> 
> 标签：c#, transactions, rollback, using-statement

我在 using 语句中有一个 IDbTransaction，但我不确定如果在 using 语句中引发异常，它是否会回滚。我知道 using 语句将强制调用 Dispose()...但是有谁知道 Rollback() 是否也是如此？

**更新：**另外，我是否需要像下面那样显式调用 Commit() 或者使用语句也会处理这个问题？

我的代码看起来像这样：

```
using Microsoft.Practices.EnterpriseLibrary.Data;

...

using(IDbConnection connection = DatabaseInstance.CreateConnection())
{
    connection.Open();

    using(IDbTransaction transaction = connection.BeginTransaction())
    {
       //Attempt to do stuff in the database
       //potentially throw an exception
       transaction.Commit();
    }
} 
```

* * *

## 回答 #1

> 赞同：106
> 
>             
> 
> 时间：2009-03-13T06:38:08.773

事务类的 Dispose 方法执行回滚，而 Oracle 的类不执行。因此，从事务的角度来看，它依赖于实现。

`using`另一方面，连接对象的语句要么关闭与数据库的连接，要么在重置连接后将连接返回到池中。在任何一种情况下，都应该回滚未完成的事务。这就是为什么异常永远不会留下活动事务的原因。

另外，是的，您应该`Commit()`明确调用。

* * *

## 回答 #2

> 赞同：18
> 
>             
> 
> 时间：2009-03-14T00:57:52.453

你必须调用提交。using 语句不会为您提交任何内容。

* * *

## 回答 #3

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T06:38:39.817

我相信如果有一个`Commit()`从未调用过的异常，那么事务将自动回滚。

# javascript - 这个 jQuery 代码片段会导致任何内存泄漏吗？

> ID：641666
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T06:35:25.630
> 
>         
> 
> 标签：javascript, jquery, memory-leaks, closures

我想知道以下 jquery 代码是否会导致任何内存泄漏：

```
$( function() {                 
  var parent=$('table#mytable tbody').get(0);
  $('tr:last', parent).click(function(){...});
}); 
```

根据我的理解，`$('tr:last', parent)`最后一行是 DOM 对象，但是在匿名函数中，闭包在范围内有这个 DOM 对象，因此 DOM 和 js 对象之间存在循环引用。

但是如果真的有泄漏的话，我可以在曼宁出版的畅销书《jQuery in Action》中看到很多这样的代码。在 jQuery 编码中是有害的“最佳实践”吗？

但我不知道我的理解是否正确。希望大家多多指正和指正。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T06:39:27.773

此代码将导致 Internet Explorer 6 和 Internet Explorer 7 中的内存泄漏不在其他浏览器中，请参阅[Douglas Crockford](http://javascript.crockford.com/memory/leak.html)和[IBM Devloper Site的这些文章](http://www.ibm.com/developerworks/web/library/wa-memleak/)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T07:01:06.720

IE 容易泄漏。[您可以使用Microsoft 的 javascript 内存泄漏检测器](http://blogs.msdn.com/gpde/pages/javascript-memory-leak-detector.aspx)在 IE 中测试您的代码是否泄漏。

Firefox 也可能泄漏。[这篇文章](http://www.ibm.com/developerworks/web/library/wa-memleak/)解释了原因。还有一个用于 Firefox 的[泄漏检测器插件](https://addons.mozilla.org/en-US/firefox/addon/2490)（尚未测试）。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2012-08-07T04:46:44.850

之前提交的答案（从 3 年前开始，叹息）是错误的。虽然 jQuery 1.0 - 1.2 会在这里泄漏，但从被问到这个问题时查看 jQuery 的版本[http://download.oldapps.com/jquery/jquery-1.3.js](http://download.oldapps.com/jquery/jquery-1.3.js)以下行包含在添加所有事件的函数中听众：

```
 // Nullify elem to prevent memory leaks in IE
    elem = null; 
```

这是链接文档中的确切防泄漏建议。

# iphone - 我可以使用 cocos2d 在我的 iphone 应用程序中使用 pickerview 吗？

> ID：641668
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T06:37:49.290
> 
>         
> 
> 标签：iphone, cocos2d-iphone

### 复制：

> [如何使用 cocos2d 在 iphone 应用程序中使用选取器视图？](https://stackoverflow.com/questions/614004/how-can-i-use-picker-view-in-iphone-application-using-cocos2d)

大家好，我正在开发 iphone 游戏项目。在这个游戏中，我想要旋转一些图像（如卷轴旋转）。但我不能这样做。我可以在这个应用程序中使用 cocos2d 使用选择器视图。如果可以给出一些说明怎么能我为这个项目做那个或任何不同的解决方案。

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-10-24T03:15:03.203

你可以使用任何你想要的东西。我经常被很多人认为 Cocos2d 是一个你不能带任何老朋友进入的世界而感到好笑。Cocos2d 只是一个使 OpenGL 易于游戏的库，仅此而已。就是这样。

我认为您可能会从先尝试一些更简单的项目中受益。我犯了一个错误，试图跳入超出我理解的东西，虽然最终它可能是有益的，但有时我希望我以更系统的方式学习。

# path - 如果文件的路径在 uri 之间有空格，则无法获取路径中的文件

> ID：641680
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T06:49:30.027
> 
>         
> 
> 标签：path, uri

当我尝试打开文件路径中有空间的文件时，消息框突然出现找不到文件“文件路径”的部分路径。我使用了 LocalPath 而不是 AbsolutePath，它对我来说很好，但它只限于 WinApps，我需要一个更通用的解决方案。诸如 Uri 未转义数据路径之类的东西。我不确定语法。

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2010-04-13T20:54:47.013

在 Java 中：URI uri = new File("文件名中的空格").toURI();

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T06:57:49.240

是否可以获取文件取决于您的软件实现。尝试用 %20 替换空格

我们在这里谈论什么样的发展？JAVA GUI 还是 WebApps？C/C++？

* * *

## 回答 #3

> 赞同：-1
> 
>             
> 
> 时间：2009-04-17T19:43:33.783

您应该尝试用引号将您的 URI 括起来

```
new Uri("\"C:\some path\some file\""); 
```

# c - C：从后台线程返回异步错误的模式？

> ID：641681
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T06:50:14.767
> 
>         
> 
> 标签：c, multithreading, error-handling

我正在编写一个开源 C 库。这个库相当复杂，有些操作可能需要很长时间。因此，我创建了一个后台线程来管理长时间运行的任务。

我的问题是我还没有找到一种优雅的方式来从后台线程返回错误。假设后台线程重新组织文件或进行定期维护，但它失败了——怎么办？

我目前看到两个选项：

1）如果用户有兴趣看到这些错误，他可以注册一个回调函数。

我不喜欢这个选项——用户甚至不知道有一个后台线程，所以他很可能会忘记设置回调函数。从可用性的角度来看，这个选项很糟糕。

2) 后台线程将错误存储在全局变量中，下一个 API 函数返回此错误。

这就是我目前正在做的事情，但我也不是 100% 满意，因为这意味着用户必须期望每个 API 函数都会返回每一个可能的错误代码。即，如果后台线程设置了 IO 错误，而用户只想知道库版本，那么尽管 get_version() API 调用根本不访问磁盘，但他会收到 IO 错误。再次，糟糕的可用性......</p>

还有其他建议/想法吗？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T06:53:57.720

也许对于“长时间运行的操作”（您想使用线程的操作）为用户提供两个选项：

*   `DoAction(...)`返回状态的阻塞

*   `DoActionAsync(..., <callback>)`将状态提供给用户提供的回调函数的非阻塞

这使用户可以选择他们希望如何处理长操作（而不是您自己决定），并且很清楚如何返回状态。  

注意：我想如果他们调用`DoActionAsync`，并且用户没有指定回调（例如他们通过`null`），那么调用不会阻塞，但用户不需要/不需要处理状态。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-16T19:47:59.093

您应该保留错误事件和警告的线程安全列表（或队列）。工作线程可以将事件发布到列表中，然后主线程可以从列表中读取事件，一次一个，或者批量读取，以防止出现竞争条件。理想情况下，主线程应该获取事件队列的副本并刷新它，这样在多个主线程或工作线程的情况下重复事件不会发生变化。列表中的事件将具有类型和详细信息。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T08:38:38.563

我有兴趣了解如何将完成状态通知给 API 的调用者。

由于后台线程执行所有执行。前台线程选择等待完成，如同步。或者前台线程可以执行其他任务，注册回调。

现在，由于第一种方法是同步的，就像您使用全局变量一样。您可以使用具有 1 个成员的消息队列，而不是全局变量。现在， - 调用者可以轮询消息队列的状态 - 调用者可以阻止等待消息队列的状态

我能想到的，

但是如果我是调用者，我想知道进度状态，如果花费的时间很……很长。所以最好给出某种完成百分比或其他东西，以使最终用户能够开发更好的带有进度条和所有内容的应用程序。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T06:58:00.410

如果您提供一个库并尝试通过线程隐藏昂贵的工作，我建议不要这样做。如果某些东西很昂贵，调用者应该可以看到它，如果它困扰他，他应该自己处理后台/线程。这样他也可以完全控制错误。它还使使用您的库的开发人员不再控制他的过程。

如果您仍想使用线程，我建议您真正遵循回调路线，但在 API 和文档中清楚地显示将有一个后台线程在此任务上运行，因此回调是必要的。

最好的方法是向图书馆的用户提供同步和异步两种方式，以便他们可以选择最适合他们特定情况的方式。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-30T15:06:57.250

您可以查看 java 的[Future API](http://java.sun.com/javase/6/docs/api/java/util/concurrent/Future.html)，了解处理异步调用和错误的替代机制。如果您愿意，您可以轻松地用一些 isError() 或 getError() 方法替换检查的异常。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-20T07:39:29.857

感谢所有好的答案。你为我提供了很多思考的材料。

你们中的一些人建议回调。最初，我认为回调是个好主意。但它只是将问题转移给了用户。如果用户收到异步错误通知，他将如何处理？他将不得不中断和/或通知他的同步程序流程，这通常很棘手并且经常破坏设计。

我现在正在做的解决方案：如果后台线程产生错误，下一个API调用将返回错误BACKGROUND_ERROR_PENDING。使用单独的 API 函数 (get_background_error()) 用户可以查看此错误代码，如果他对此感兴趣的话。

此外，我添加了文档，因此如果返回此错误，用户不会感到太惊讶。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2013-04-24T10:20:27.617

我同意肖恩的观点。带有事件循环的消息队列。

如果有错误后台线程可以插入到队列中。事件循环将阻塞，直到有新消息可用。

我已经使用 Apache Portable 运行时时间在构建具有高事务率的电信服务器方面取得了巨大成功。它从未失败过。

我使用 1 个线程插入队列，这将是您的后台线程。事件循环将在另一个线程中运行并阻塞，直到插入新消息。

我会推荐带有 APR FIFO 队列的 APR 线程池（这也是线程安全的）。

快速设计在这里：

```
void background_job()
{
    /* There has been an error insert into the queue */
    apr_status_t rv = 0;

    rv = apr_queue_push(queue, data);
    if(rv == APR_EOF) {
        MODULE_LOG(APK_PRIO_WARNING, "Message queue has been terminated");
        return FALSE;
    }
    else if(rv == APR_EINTR) {
        MODULE_LOG(APK_PRIO_WARNING, "Message queue was interrupted");
        return FALSE;
    }
    else if(rv != APR_SUCCESS) {
        char err_buf[BUFFER_SIZE];
        MODULE_LOG(APK_PRIO_CRITICAL, "Failed to push to queue %s", apr_strerror(rv, err_buf, BUFFER_SIZE));

        return FALSE;
    }

    return TRUE;   
}

void evt_loop()
{
   while(continue_loop) {
    apr_status_t rv = 0;

    rv = apr_queue_pop(queue, data);
    if(rv == APR_EOF) {
        MODULE_LOG(APK_PRIO_WARNING, "Message queue has been terminated");
        return FALSE;
    }
    else if(rv == APR_EINTR) {
        MODULE_LOG(APK_PRIO_WARNING, "Message queue was interrupted");
        return FALSE;
    }
    else if(rv != APR_SUCCESS) {
        char err_buf[BUFFER_SIZE];
        MODULE_LOG(APK_PRIO_CRITICAL, "Failed to pop from the queue %s", apr_strerror(rv, err_buf, BUFFER_SIZE));

        return FALSE;
    }

    return TRUE;
   } 
} 
```

以上只是一些简单的代码片段，如果需要我发布更完整的代码。

希望有帮助

# c# - Linq to SQL .Sum() without group ... into

> ID：641682
> 
>         
> 
> 赞同：31
> 
>         
> 
> 时间：2009-03-13T06:50:55.903
> 
>         
> 
> 标签：c#, linq-to-sql, .net-3.5

我有这样的事情：

```
var itemsInCart = from o in db.OrderLineItems
                  where o.OrderId == currentOrder.OrderId
                  select new { o.OrderLineItemId, ..., ..., o.WishListItem.Price} 
```

有什么办法可以做

```
itemsCart.Sum() //not sure what to pass into the function 
```

要获取 o.WishListItem.Price 的总和，还是我必须从数据库中获取另一个 iQueryable< T> 与 group ... 进入？

* * *

## 回答 #1

> 赞同：70
> 
>             
> 
> 时间：2009-03-13T07:06:05.557

关于什么：

```
itemsInCart.AsEnumerable().Sum(o=>o.Price); 
```

[AsEnumerable](http://www.hookedonlinq.com/AsEnumerableOperator.ashx)有所不同，此查询将在本地执行（Linq To Objects）。

* * *

## 回答 #2

> 赞同：19
> 
>             
> 
> 时间：2009-03-13T06:55:59.090

你可以：

itemsCart.Select(c=>c.Price).Sum();

只打一次数据库：

```
var itemsInCart = (from o in db.OrderLineItems
                  where o.OrderId == currentOrder.OrderId
                  select new { o.OrderLineItemId, ..., ..., o.WishListItem.Price}
                  ).ToList();
var sum = itemsCart.Select(c=>c.Price).Sum(); 
```

节省的额外往返行程是值得的：）

* * *

## 回答 #3

> 赞同：8
> 
>             
> 
> 时间：2009-03-13T07:04:14.547

尝试：

```
itemsCard.ToList().Select(c=>c.Price).Sum(); 
```

实际上这会表现得更好：

```
var itemsInCart = from o in db.OrderLineItems
              where o.OrderId == currentOrder.OrderId
              select new { o.WishListItem.Price };
var sum = itemsCard.ToList().Select(c=>c.Price).Sum(); 
```

因为您只会从数据库中检索一列。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2013-12-28T20:41:21.947

试试这个：

```
var itemsInCart = from o in db.OrderLineItems
                  where o.OrderId == currentOrder.OrderId
                  select o.WishListItem.Price;

return Convert.ToDecimal(itemsInCart.Sum()); 
```

我觉得更简单！

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2014-07-09T18:22:39.663

我知道这是一个老问题，但你为什么不能这样做：

```
db.OrderLineItems.Where(o => o.OrderId == currentOrder.OrderId).Sum(o => o.WishListItem.Price); 
```

我不确定如何使用查询表达式来做到这一点。

# html - 如何在 textarea 中使用不同的字体颜色？

> ID：641685
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2009-03-13T06:52:08.600
> 
>         
> 
> 标签：html, fonts, colors

我希望在输入特定关键字时在文本区域中更改字体颜色，例如在 Visual Studio 中。

我在任何地方都没有看到这个，所以我不知道这是否可以通过 HTML 和 JavaScript 实现。

有没有人见过这样的事情？或者知道怎么写？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T07:01:27.000

Textarea 是一个标准的 HTML 元素，因此是在黎明之后发明的。不幸的是，这意味着它的外观和功能受到限制。

据我所知，更改特定单词的颜色是不可能的。然而，解决这个问题的一种方法是在页面中嵌入一个 iFrame。这样，您可以将 iFrame 内容视为另一个网页并使用 CSS 对其进行样式设置。

[Yahoo RTE](http://developer.yahoo.com/yui/examples/editor/simple_adv_editor.html)、[FCKEditor](http://www.fyneworks.com/jquery/FCKEditor/)和[轻量级 RTE](http://code.google.com/p/lwrte/)以这种方式工作。

另一个不使用 iFrame 的选项是 Stack Overflow 上使用的编辑器，称为 WMD。文件在[这里](http://github.com/derobins/wmd/tree/master)。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2016-07-08T08:17:47.297

这是不可能的。

方法是使用 使 textarea 的字体（而不是光标）透明`color:#000;-webkit-text-fill-color:transparent`，然后创建底层 100% 重叠`div`的内容，`textarea`将在 textarea 的`oninput`事件中复制 + 格式化的内容。

您需要解决（或避免）同步这两个元素时出现的一些问题，例如滚动，但可以做到。我用这种方式制作了自己的 HTML 编辑器。

AFAIK，CSS 属性 -webkit-text-fil-color 在 Opera、Chrome 中受支持，并且应该在即将发布的 Firefox v.48 中。

* * *

## 回答 #3

> 赞同：-4
> 
>             
> 
> 时间：2009-03-13T07:01:16.860

您可能必须在客户端上运行 javascript 以检测文本何时更改，然后将要突出显示的文本替换为具有适当样式的一些子 html 元素。

例如

原文：

```
This is what the user typed. 
```

突出显示的文本

```
This is what the <a class="className">user</a> typed. 
```

# sql-server - SQL 2000 或子句在 SQL2005 中不起作用

> ID：641686
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T06:52:41.140
> 
>         
> 
> 标签：sql-server, sql-server-2005

谁能帮我理解为什么以下查询在 SQL 2000 中运行良好，而在 SQL 2005 中运行良好

在 SQL 2005 中，它会出错“将 char 数据类型转换为 smalldatetime 数据类型导致 smalldatetime 值超出范围”

```
DECLARE @Table table(date varchar(6),code char(1))
INSERT INTO @Table select '010209','N'
INSERT INTO @Table select '032809','N'
INSERT INTO @Table select space(6),'N'

select * FROM  @Table  
WHERE  
(
      (
            date <> ''  
            AND        
            GETDATE() < CAST(LEFT(date, 2) + '/' +  SUBSTRING(date, 3, 2) + '/' +  RIGHT(date,2) AS SMALLDATETIME)
      )  
      OR code = 'Y') 
```

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T06:56:41.757

错误正是它所说的。

不管你怎么努力，`'  /  /  '`永远不会有任何约会。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T07:08:27.187

是的，leppie 本来可以更清楚一点，但是 <> '' 与您的空格不匹配（6）。

这将起作用（使用 ltrim/rtrim）

```
DECLARE @Table table(date varchar(6),code char(1))
INSERT INTO @Table select '010209','N'
INSERT INTO @Table select '032809','N'
INSERT INTO @Table select space(6),'N'

select * FROM  @Table  
WHERE  
(
      (
            ltrim(rtrim(date)) <> ''  
            AND        
            GETDATE() < CAST(LEFT(date, 2) + '/' +  SUBSTRING(date, 3, 2) + '/' +  RIGHT(date,2) AS SMALLDATETIME)
      )  
      OR code = 'Y') 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:07:32.790

采用

```
date.RTRIM() <> '' 
```

代替

```
date <> '' 
```

# c# - C# 中的 TreeView 控件、select() 和焦点

> ID：641690
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-03-13T06:55:25.270
> 
>         
> 
> 标签：c#, treeview

当我在 中选择 a`Node`时`TreeView`，它会突出显示并显示基于它的数据`Node`。当我选择另一个`Control`（`TreeView`失去焦点）时，它不再突出显示。失去焦点后如何保持突出显示？

在进行搜索时，我无法判断选择了哪个节点，因为我必须将焦点放在文本框上（以便用户可以输入更多文本）。

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2009-03-13T06:59:04.120

您必须将 HideSelection 属性设置为 false - 这样您才能看到选择，尽管 TreeView 控件失去了焦点

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2012-04-04T16:14:00.750

我刚刚遇到了这个问题，这就是我解决它的方法：将 DrawMode 属性更改为`TreeViewDrawMode.OwnerDrawText`并注册到 DrawNode 事件

```
 private void MyTreeGridview_DrawNode(object sender, DrawTreeNodeEventArgs e) 
    {
        if ((e.State == TreeNodeStates.Selected) && (!MyTreeGridview.Focused))
        {
            Font font = e.Node.NodeFont ?? e.Node.TreeView.Font;
            Color fore = e.Node.ForeColor;
            if (fore == Color.Empty)fore = e.Node.TreeView.ForeColor;      
            fore = SystemColors.HighlightText;
            Color highlightColor = SystemColors.Highlight;
            e.Graphics.FillRectangle(new SolidBrush(highlightColor), e.Bounds);
            ControlPaint.DrawFocusRectangle(e.Graphics, e.Bounds, fore, highlightColor);
            TextRenderer.DrawText(e.Graphics, e.Node.Text, font, e.Bounds, fore, highlightColor, TextFormatFlags.GlyphOverhangPadding);
        }
        else
        {
            e.DrawDefault = true;
        }
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2014-06-24T16:26:52.197

如果在 HideSelection 设置为 False 并且 TreeView 失去焦点时，突出显示颜色不够亮到您喜欢的程度：

确保 TreeView 的 HideSelection 设置为 True（默认值）。

然后处理 TreeView 的 Enter 和 Leave 事件，例如：

```
void myTreeView_Leave(object sender, EventArgs e)
{
    if((sender as TreeView).SelectedNode != null)
        (sender as System.Windows.Forms.TreeView).SelectedNode.BackColor = Color.Red; //your highlight color
}

void myTreeView_Enter(object sender, EventArgs e)
{
    if((sender as TreeView).SelectedNode != null)
        (sender as TreeView).SelectedNode.BackColor = (sender as TreeView).BackColor;
} 
```

# c# - 如何防止异常值插入数据库？

> ID：641692
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T06:56:03.490
> 
>         
> 
> 标签：c#, sql-server, database, defensive-programming

我有一个 MS SQL DB，其中包含一组表，每个表代表一组根据我们的公式计算的变量。所有变量都是具有预定义精度的数字（我们使用数字数据类型，其中 nm 作为整数部分的 n 位数和小数部分的 m 位数）。

我的问题是如何防止异常值或任何违反列大小的无效值？目前我们正在做简单的“try catch”，因为 ADO.net 会为无效值抛出异常，有没有更好的方法？此外，我想在此列中为此异常值设置一个有效值（即：可能为零）。我正在使用 C#3、MSSQL 2000 并使用`SqlBulkCopy`类插入。

PS：我在询问来自 DB 端或 dotnet 端的任何解决方案

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-04-30T02:54:44.850

我必须同意 MartinK 并在批量插入数据之前进行验证步骤。这也将允许您更好地对该过程进行单元测试。

如果您有多个应用程序向此表添加数据，则存储过程可能是另一种强制验证的解决方案。

但是，另一种选择是将批量插入到对数据类型有更宽松限制的临时/原始表中，然后使用 TSQL 将这些记录按摩到主表中。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:02:07.093

您可以尝试编写 PSQL 触发器/序列来验证您的数据类型关系！

有多少应用程序使用数据库中的相同数据？如果它只是您的应用程序，您不应该考虑将异常逻辑移出中间层。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-04-30T03:03:45.453

您正在描述我希望在应用程序设计中出现的验证和异常处理逻辑，而不是在数据库设计中。为什么它看起来不是最容易为您处理的地方？您使用的是哪种 DAL？

# javascript - 使用跨框架脚本获取选定文本

> ID：641713
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T07:02:16.377
> 
>         
> 
> 标签：javascript, jquery, security, dom, xss

我已经为一个问题苦苦挣扎了几个小时，我希望能在实现我的目标方面得到一些帮助，或者确认我正在尝试做的事情实际上是不可能的。

我有一个 webapp，它`document.getSelection()`从任意网页获取选定的文本 () 作为输入。虽然可以使用小书签相当轻松地编写此类脚本，但如果我可以使用 iframe 完成此操作，则对最终用户来说是最好的。

父框架是我使用此脚本的站点：

```
$('#frame').load(function(){
    // this event won't be triggered
    $(window).mouseup(function(){
        doStuff(window.getSelection()); 
    });

    // this will throw a security error
    $(window.frames[0].document).mouseup(function(){
        doStuff(window.frames[0].document.getSelection()); 
    });                  
}); 
```

任意站点位于子框架中。除非子文档来自我的域，否则出于 XSS 安全原因禁止访问。我尝试了几种变体并尝试了破解，包括将 iframe 设置`src`为我的域，并使用第三方 URL 作为参数，然后重定向到第三方 URL。从某种意义上说，我很高兴它不起作用（因为如果它起作用了，那么`XSS`安全还有很长的路要走......）

另一种选择是下载第三方页面并像代理服务器一样从我的域提供它，但我已经遇到了一堆文件的相对路径问题，这些问题有时很容易成为绝对路径，但有时是傻瓜的差事（例如通过脚本访问文件时）。

我已经得出结论，我可能只是运气不好。也许我的案例的一个重要区别是我只想访问`.getSelection()`孩子的方法。无需能够访问 cookie 或击键或与 DOM 交互。也许这没有什么不同，但也许确实如此。

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2011-01-18T16:11:36.240

我没有完全阅读您的答案:-) 但也许我有一个解决方案，它涉及在父帧和子帧之间传递数据，两种方式。

您可以从孩子中写入（而不是读取）父母的哈希（哈希是[http://url#HASH_PART](http://url#HASH_PART)）。因此，在父 iframe 上，只需设置间隔来检查值，比如每 50 毫秒。

```
function checkHash() {
    if (window.location.hash == "#something") {
        // my child frame set this value using: 
        //parent.window.location.hash = "something";
        doSomething();
    }
} 
```

有关更多详细信息，或者进行父子之间的通信，则可以在[此处](http://softwareas.com/cross-domain-communication-with-iframes)找到解释此问题的完整文章（也有演示链接） 。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:38:31.077

您可以尝试代理方法，但插入指向原始域的[基本标记。](http://www.w3schools.com/TAGS/tag_base.asp)然后应该注意路径。

即使你能找到它们，我也不会依赖任何 XSS 黑客——它们可能会被纠正，而且很可能不会跨浏览器。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:42:33.423

一种可能性是使用 XHR 中的文本编写 iframe 的文档，或者使用 jQuery 的`load()`函数，这仅在 iframe 中没有导航的情况下才有效。

# c++ - 最喜欢的 Valgrind 选项

> ID：641721
> 
>         
> 
> 赞同：10
> 
>         
> 
> 时间：2009-03-13T07:05:42.840
> 
>         
> 
> 标签：c++, debugging, valgrind, options

我通常使用这个：

```
valgrind --tool=memcheck --leak-check=yes --show-reachable=yes --num-callers=20 --track-fds=yes ./mycode 
```

但不确定它是否一方面检查所有内容，另一方面过于冗长。你最喜欢的选择是什么？

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-04-09T03:04:07.697

SVN valgrind 有 --track-origins=yes，这实际上使得未初始化值警告很有用。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2009-03-15T22:29:15.173

`--tool=callgrind`

在适用的情况下，`--instr-atstart=no`

# c++ - 从两个向量中删除公共实体？

> ID：641724
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-03-13T07:06:59.203
> 
>         
> 
> 标签：c++, vector

说我有`vector<class1a>,vector<class1b>`如何从他们两个中删除公共实体我已经为class1对象class1a，class1b定义了==运算符

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2009-03-13T08:48:56.260

[stl 算法](http://www.cplusplus.com/reference/algorithm/)提供了几个函数来执行集合操作，特别是计算[集合对称差](http://www.cplusplus.com/reference/algorithm/set_symmetric_difference.html)，这是您所需要的。

这是一个使用示例：

```
#include <algorithm>
#include <vector>

int main(int argc, char **argv) {

    std::vector<int> v1;
    v1.push_back(1);
    v1.push_back(2);
    v1.push_back(3);
    v1.push_back(4);
    v1.push_back(5);
    v1.push_back(6);

    std::vector<int> v2;
    v2.push_back(2);
    v2.push_back(4);
    v2.push_back(6);
    v2.push_back(8);

    // Ranges must be sorted!
    std::sort(v1.begin(), v1.end());
    std::sort(v2.begin(), v2.end());

    std::vector<int> res; // Will contain the symmetric difference
    std::set_symmetric_difference(v1.begin(), v1.end(), 
                                  v2.begin(), v2.end(), 
                                  std::back_inserter(res));

    // Copy result to the output
    std::copy(res.begin(), res.end(), std::ostream_iterator<int>(cout, " "));
    // Prints "1 3 5"

    return 0;
} 
```

`std::set_symmetric_difference`需要两个范围（即两对 OutputIterators）和一个 InputIterator，它将放置结果。它还将一个迭代器返回到结果范围的末尾。

* * *

**编辑**

我刚刚阅读了您对您的问题的评论。如果要修改两个原始向量，可以使用`std::set_difference`：

```
vector<int>::iterator endRange;
endRange = set_difference(v1.begin(), v1.end(), 
                          v2.begin(), v2.end(), 
                          v1.begin());
v1.erase(endRange, v1.end()); 
```

在这里，我们将集合差异 v1 - v2 的结果放入 v1。但是，我们不能反之亦然，因为 v1 现在已修改。解决方法是计算v1和v2的交集，然后与这个交集的差`std::set_intersection`：

```
vector<int> inter;
set_intersection(v1.begin(), v1.end(),
                 v2.begin(), v2.end(),
                 back_inserter(inter));
// inter is "2 4 6"

v1.erase(set_difference(v1.begin(), v1.end(),
                        inter.begin(), inter.end(),
                        v1.begin()),
         v1.end());
// v1 is "1 3 5"

v2.erase(set_difference(v2.begin(), v2.end(),
                        inter.begin(), inter.end(),
                        v2.begin()),
         v2.end());
// v2 is "8" 
```

我想还有更多的高性能解决方案，但是这个很清楚，并且通过使用广为人知的 stl 算法真正传达了您的意图。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T08:00:33.083

在 stl 标头算法中有一个名为“set_symmetric_difference”的函数，它将把一个的所有元素，但不是两个源范围都放在一个目标范围中。

请记住，两个范围都必须开始排序。

[msdn 文档](http://msdn.microsoft.com/en-us/library/t333wak6.aspx)

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:10:21.207

对 2 个向量进行排序，然后并行遍历它们，执行常见的合并操作。这将告诉您哪些项目是相同的。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:11:53.093

天真的方法是进行 n^2 迭代，将第一个向量中的每个元素与第二个数组中的每个元素进行比较，并将任何匹配项添加到第三个向量。当您完成 n^2 迭代时，您将遍历第三个向量并从前两个向量中删除这些对象。

不是最好的解决方案，但取决于您期望向量有多大，它可能是最简单的解决方案之一。  

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:15:50.587

对于 和 中的每对项目`class1a`，`class1b`如果它们不相等，则将它们添加到输出集。否则，只添加一个这样的实例。重复数组长度的最小值。如果一个更长，您将剩下一些 - 尝试将所有这些添加到集合中。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:35:43.847

开始在 Set 中添加向量的值。覆盖 class1 和 class2 的 equals 方法来决定您希望对象如何相等。如果默认情况下不覆盖 equals == 将用于比较，并且由于对象属于不同的类 == 将始终返回 false。所以你需要重写equals方法。

# java - 如何使用 java api 托管邮件？

> ID：641727
> 
>         
> 
> 赞同：-3
> 
>         
> 
> 时间：2009-03-13T07:07:49.577
> 
>         
> 
> 标签：java, email, jsp

我想在我的机器上托管邮件。所以我可以通过我的机器发送和接收邮件。

java中是否有任何api可以做同样的事情..

谢谢

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T07:24:07.400

有 Java API 可以通过现有的邮件服务器发送邮件（请参阅[JavaMail](http://java.sun.com/products/javamail/)库）。至于用 Java 编写的实际*邮件服务器*，您或许应该看看[Apache James 项目](http://james.apache.org/)。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T07:32:47.143

几个额外的 java 邮件服务器：

[http://sourceforge.net/projects/jmailsrv/](http://sourceforge.net/projects/jmailsrv/)

[http://sourceforge.net/projects/ichabod/](http://sourceforge.net/projects/ichabod/)

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T11:51:26.260

查看 DeveloperWorks [Apache James 简介](http://www.ibm.com/developerworks/java/library/j-james1.html)系列（第 1 部分已链接）。

# visual-studio - 创建可注册的 Visual Studio 包

> ID：641728
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T07:08:09.373
> 
>         
> 
> 标签：visual-studio

我正在为 Visual Studio 创建一个文件生成器（类似于 LINQ to SQL/LINQ to Entities 生成器）。我已经按照 Visual Studio 2008 SDK ( [http://code.msdn.microsoft.com/sfgdd](http://code.msdn.microsoft.com/sfgdd) ) 中的示例进行了操作，但是遇到了`regpkg`问题，我不知道如何让它工作。

我找不到任何需要如何完成的好例子，这些例子似乎认为我已经有一个`.reg`文件，但我不知道我需要`.reg`做什么。

有人可以填补示例文档中的空白吗？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-06-08T01:39:36.467

我已经设法解决了这个问题，使用 Visual Studio 中的安装程序项目来设置注册表项。除此之外，您还需要将 DLL 安装到 GAC 中。

我将在我的博客上做一个系列，从注册表项开始：[http ://www.aaron-powell.com/blog/june-2009/creating-an-installer-for-a-single-文件生成器---part-1.aspx](http://www.aaron-powell.com/blog/june-2009/creating-an-installer-for-a-single-file-generator---part-1.aspx)

# vb.net - vb.net 中 pdf 文件中的图像颜色

> ID：641733
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T07:10:10.240
> 
>         
> 
> 标签：vb.net, image, pdf

我正在创建一个在 VB.Net 中生成 PDF 文件的程序。

一切正常，只是图像显示为蓝色背景，而提供的图像没有。

以下是正在使用的代码行：

```
sColor = IIf(mvarEncodeASCII85, ToASCII85(ImgColor),
    (System.Text.Encoding.GetEncoding(1252).GetString(ImgColor))) 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T07:38:23.077

没有太多细节，但我的第一个想法是它是 .png 文件或 .gif 文件。我对么？在这种情况下，adobe acrobat 处理透明背景可能会出现问题。

正如我所说，如果没有任何进一步的细节，很难准确地说出。

# shell - 如何在 shell 中以日期为基础重命名文件？

> ID：641737
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T07:12:13.810
> 
>         
> 
> 标签：shell, scripting, sed

我想重命名一些都在同一个目录中的文件。使用的文件名模式是`Prefix_ddmmyy.tex`欧洲日期格式。为了可读性和排序，我想以`Prefix_yymmdd.tex`规范日期格式的模式重命名文件。

任何人都知道如何为完整目录自动执行此操作？我的 sed 和正则表达式知识不是很敏锐...

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T07:19:10.093

对于 Prefix_*.tex 中的文件；do file_new= `echo "$file" | sed -e 's:\([0-9][0-9]\)\([0-9][0-9]\)\([0-9][0-9]\)\(\.tex\):\3\2\1\4:'`
      test "$file" != "$file_new" && mv -f "$file" "$file_new" 完成

或者，如果您有很多文件和/或想要递归处理文件，请替换：

```
for file in Prefix_*.tex ; do 
```

和：

```
find . -name Prefix_*.tex -print | while read file ; do 
```

或（非递归，GNU）：

```
find . -maxtdepth 1 -name Prefix_*.tex -print | while read file ; do 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T11:46:47.440

你也可以在没有外部命令的情况下使用任何 bourne 类型的 shell：

```
for f in *.tex; do
  _s=.${f##*.} _f=${f%.*} _p=${f%_*}_ 
  _dt=${_f#$_p} _d=${_dt%????} _m=${_dt%??} 
  _y=${_dt#$_m} _m=${_m#??}
  mv -- "$f"  "$_p$_y$_m$_d$_s"
done 
```

使用*zsh*将是：

```
 autoload -U zmv
 zmv '(*_)(??)(??)(??)(.tex)' '$1$4$3$2$5' 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:49:31.480

你可以试试“ [mmv](http://www.ss64.com/bash/mmv.html) ”。

# ruby - 开始。. . 在表示“块”时结束？

> ID：641743
> 
>         
> 
> 赞同：11
> 
>         
> 
> 时间：2009-03-13T07:18:25.620
> 
>         
> 
> 标签：ruby, syntax

```
temp = 98.3
begin
  print "Your temperature is " + temp.to_s + " Fahrenheit. "
  puts "I think you're okay."
  temp += 0.1
end while temp < 98.6 
```

在上面的示例中，开始和结束之间的所有内容都是一个块吗？

我仍然很困惑什么是块。

如果你不能称它为一个块，你会怎么称呼开始和结束之间的那段代码？可以称它为块吗？

* * *

## 回答 #1

> 赞同：19
> 
>             
> 
> 时间：2009-03-13T07:34:05.270

Block 在 Ruby 中具有特殊的含义。  [根据](http://www.artima.com/intv/closures.html)Ruby 的创建者 Matz 的说法，您可以将块视为无名函数——通常是可以被[`yield`](http://www.tutorialspoint.com/ruby/ruby_blocks.htm)编辑的东西，也可以接受参数。

在描述 Ruby 语法时，您可能会看到以下类型的歧义：

*   `begin`... （在*其他*`end`语言中称为块）有时可以简单地称为它是什么，即 Ruby 中的[*表达式*](http://www.ruby-doc.org/docs/ProgrammingRuby/html/tut_expressions.html)（它可能又包含其他表达式 - 表达式只是具有返回值的东西）。一些参考文献仍将其称为 a或 a ，这在一定程度上增加了混乱*[](http://www.ruby-doc.org/docs/ProgrammingRuby/html/tut_expressions.html)*`begin/end block``code block`**
 ***   `do`...`end`或者在 Ruby 中`{...}`总是被称为[*块*](http://www.ruby-doc.org/docs/ProgrammingRuby/html/tut_containers.html)** 

 **例如，仔细阅读[Ruby 语法手册页](http://docs.huihoo.com/ruby/ruby-man-1.4/syntax.html)，例如

> `begin` *`expression`* `end`
> 
>   *`expression`* `while` *`expression`*
> 
>   `loop` *`block`*

如需进一步阅读，请参阅：

*   [编程红宝石](http://www.ruby-doc.org/docs/ProgrammingRuby/)

*   [Ruby（来自其他语言）](http://www.ruby-lang.org/en/documentation/ruby-from-other-languages/)

*   [更多的](http://www.ruby-lang.org/en/documentation/)文档

* * *

## 回答 #2

> 赞同：9
> 
>             
> 
> 时间：2009-03-13T22:15:27.617

`begin/end`是严格控制流，而不是块。

```
begin
  puts "hi"
end
# => "hi" 
```

代码立即运行。如果它是一个块，则必须以某种方式调用它才能运行其中的代码，如下例所示：

```
def a_method; end
a_method { puts "hi" }
# nothing..

def a_method
  yield
end

a_method { puts "Hi!" }
# => "Hi!" 
```

# django - Django MOD_PYTHON 错误

> ID：641750
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T07:28:19.013
> 
>         
> 
> 标签：django, mod-python

我已经让 django 和 mod_python 一起运行了一段时间，但今天我收到以下错误

```
MOD_PYTHON ERROR

ProcessId:      4551
Interpreter:    'thatch'

ServerName:     'thatch'
DocumentRoot:   '/var/www/thatch'

URI:            '/'
Location:       '/'
Directory:      None
Filename:       '/var/www/thatch/'
PathInfo:       ''

Phase:          'PythonHandler'
Handler:        'django.core.handlers.modpython'

Traceback (most recent call last):

  File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line 1537, in HandlerDispatch
    default=default_handler, arg=req, silent=hlist.silent)

  File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line 1202, in _process_target
    module = import_module(module_name, path=path)

  File "/usr/lib/python2.5/site-packages/mod_python/importer.py", line 304, in import_module
    return __import__(module_name, {}, {}, ['*'])

ImportError: No module named django.core.handlers.modpython 
```

这是我的虚拟主机配置

```
<VirtualHost *:80>
  ServerName  thatch

  DocumentRoot /var/www/thatch

  <Location "/">
    SetHandler python-program
    PythonPath "['/var/www/thatch'] + sys.path"
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE thatch.settings
    PythonOption django.root /var/www/thatch
    PythonDebug On
  </Location>

  <Location "/media">
    SetHandler None
  </Location>

  <LocationMatch "\.(jpg|gif|png|css|js)$">
    SetHandler None
  </LocationMatch>

</VirtualHost> 
```

任何想法为什么会发生这种情况？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T15:16:59.557

我只能猜测您的问题可能是什么，但这里有两个标准检查：

1.  从几个不同的工作目录在 shell 中导入 modpython

2.  更改用户（如果您有任何除 root 设置）并重复步骤 1

如果 #2 看起来比它的价值更麻烦，那么尝试*非常非常仔细地*检查沿 modpython 路径的每个文件夹的权限，以确保“其他”在沿途的每个阶段都具有读取权限。如果你已经将 django 移动到你的主目录中（就像我曾经做过的那样......不知道为什么，但得到了同样的错误）那将是问题所在。您要么需要将其移回 apache 可以读取的目录，要么需要为其他目录添加读取权限。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2010-05-29T23:07:39.337

在我的情况下 pytonpath 和访问权限是好的。这个错误在重新编译python后消失了。

配置：

Gentoo 

Django 1.1 

Apache：

 www-servers/apache-2.2.15 USE="doc ssl suexec threads -debug -ldap (-selinux) -static" APACHE2_MODULES="alias auth_basic authn_alias authn_anon authn_default authn_file authz_default authz_host authz_owner autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache 过滤头包括 info log_config logio mem_cache mime mime_magic 协商重写 setenvif 拼写状态 unique_id userdir usertrack vhost_alias -actions -asis -auth_digest -authn_dbd -authn_dbm -authz_dbm -authz_groupfile -authz_user -cern_meta -charset_lite -dbd -dumpio -ident -imagemap -log_forensic -代理 -proxy_ajp -proxy_balancer -proxy_connect -proxy_ftp -proxy_http -substitute -version" APACHE2_MPMS="worker -event -itk -peruser -prefork" 

Python 2.6.4

# c# - .net HttpHandlers 将请求向上传递到 IIS6

> ID：641754
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T07:30:19.193
> 
>         
> 
> 标签：c#, .net, httphandler

有没有办法让 Http 处理程序将请求通过管道备份到 IIS 6 并让它处理请求？

例如，如果我为 verb="(wildcard)" path="(wildcard).txt" 设置了一个 Http 处理程序

我有一个名为 myunformated.txt 的文件，如果它没有附加查询字符串参数，我希望 IIS 6 将它发送给用户。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T08:25:50.747

你的问题的答案是否定的。这就是 IIS7 的集成管道实现的目标，但它在 IIS6 上不可用。

在这种特定情况下，使用 context.Response.TransmitFile 可以解决问题，尽管您应该考虑设置响应内容类型、字符集和缓存控制标头，例如：-

```
HttpResponse Response = context.Response

Response.ContentType = "text/plain";
Response.CharSet = "Windows-1252";
Response.AddFileDependency(filePath);

// Set additional properties to enable caching.
Response.Cache.SetExpires(DateTime.Now.AddSeconds(60));
Response.Cache.SetCacheability(HttpCacheability.Public);
Response.Cache.SetValidUntilExpires(true);
Response.TransmitFile(filePath); 
```

这几乎重复了 IIS 静态内容处理程序将执行的操作。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T07:36:20.273

为什么不只是：Response.TransmitFile？- 请注意，与 Response.WriteFile 不同，此文件不会加载整个文件。

您可能希望完全避免它，并让链接指向不同的文件名。通过这种方式，您可以从 IIS 中获得所有您想要的东西——尤其是恢复下载。

# javafx - 如何在 JavaFX 中获取像素的 RGB 值

> ID：641769
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T07:42:38.963
> 
>         
> 
> 标签：javafx

我开始使用 JavaFX，基本上我想要实现的是一个颜色选择器。起初，我想有一个带有LinearGradient 的矩形，它可以通过所有主要/次要颜色。

看起来像我想要的，但问题是我无法在此节点中的给定坐标（x，y）处获取 RGB 值。我知道你可以通过任何形状的填充属性来做到这一点，如果它是颜色的话。

但是无论如何要获得 LinearGradient/Paint 内任何东西的 RGB 值吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T08:09:18.493

这个[ColorPicker JavaFX 示例](http://developers.sun.com.cn/javafx/samples/EffectsPlayground/src/ColorPicker.fx.html)有帮助吗？

```
[...]

function colorAtLocation(x:Integer, y:Integer) : Color {
    var bimg = iv.image.bufferedImage;
    if (x < 0 or x >= bimg.getWidth() or y < 0 or y >= bimg.getHeight()) {
        return null;
    }
    var rgb = bimg.getRGB(x, y);
    var r = Bits.bitAnd(Bits.shiftRight(rgb, 16), 0xff);
    var g = Bits.bitAnd(Bits.shiftRight(rgb,  8), 0xff);
    var b = Bits.bitAnd(Bits.shiftRight(rgb,  0), 0xff);
    Color.rgb(r, g, b)
}

function updateSelectedColor(e:MouseEvent) {
    var rgb = colorAtLocation(e.x, e.y);
    if (rgb != null) {
        picker.selectedColor = rgb;
    }
}

[...] 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-30T19:54:22.630

The `ColorPicker` JavaFX example starts with a `png` image that is loaded to an `image` that then populates the `ImageView`.  

The question starts with a JavaFX `Rectangle` containing `LinearGradient`.   

To get the rectangle contents into a buffered image, one can use the java.awt.Robot:

```
 var rectangle = new java.awt.Rectangle(x,y,width,height);
        var robot = new java.awt.Robot();
        var bufferedImage = robot.createScreenCapture(rectangle); 
```

where `rectangle` would be describe the coordinates of the JavaFX Rectangle containing the bits of interest.

The `robot.createScreenCapture` call has the gotcha that to do the screen capture, the screen has to be visible.  There should be a better of way to populate the buffered image but I've not yet encountered it.  

# python - 用 Python 编写的 3D OpenGL 游戏可以看起来不错并且运行得很快吗？

> ID：641770
> 
>         
> 
> 赞同：16
> 
>         
> 
> 时间：2009-03-13T07:48:58.277
> 
>         
> 
> 标签：python, opengl

我打算使用 jMonkeyEngine 在 Java 中编写一个简单的 3d（等距视图）游戏 - 没什么好想的，我只想学习一些关于 OpenGL 和编写高效算法（随机地图生成算法）的知识。

当我计划做什么时，我开始想知道是否要切换到 Python。我知道 Python 的存在并不是为了成为编写 3d 游戏的工具，但是有可能用这种语言编写好看的游戏吗？

我想到了 3d 图形、漂亮的效果和空闲的 CPU 时间来为游戏引擎的其余部分供电？我看过好看的 java 游戏——老实说，当我看到 Runescape HD 中的细节水平时，我相当震惊。

另一方面，pygame.org 只有 2d 游戏，还有一些 3d 项目。python有没有高效的3d游戏引擎？pyopengl 是唯一的选择吗？python中好看的游戏不流行或不可能实现？

我将不胜感激任何信息/反馈。

* * *

## 回答 #1

> 赞同：18
> 
>             
> 
> 时间：2009-03-13T08:31:34.977

如果您担心 3D 性能：大多数性能关键部分将由 OpenGL 处理（在 C 库中甚至在硬件中），因此用于驱动它的语言应该无关紧要。

要真正找出性能是否存在问题，您必须尝试一下。但原则上它没有理由不能工作。

无论如何，您仍然可以优化关键部分，无论是在 Python 中还是通过下降到 C 语言。对于大多数对性能不那么关键的游戏引擎，您仍然可以获得 Python 的优势。

* * *

## 回答 #2

> 赞同：8
> 
>             
> 
> 时间：2009-03-13T10:25:30.130

是的。夏娃在线做到了。

[http://support.eve-online.com/Pages/KB/Article.aspx?id=128](http://support.eve-online.com/Pages/KB/Article.aspx?id=128)

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2012-07-10T16:03:30.423

我做了一个 EuroPython 演讲，讲述了我从 Python 驱动 OpenGL 的业余尝试：http:
 [//pyvideo.org/video/381/pycon-2011--algorithmic-generation-of-opengl-geom](http://pyvideo.org/video/381/pycon-2011--algorithmic-generation-of-opengl-geom)

我正在谈论的代码的最新版本在这里：
 [https ://github.com/tartley/gloopy](https://github.com/tartley/gloopy)

它被称为“图书馆”，但我太天真了：这是一堆个人实验代码。

尽管如此，它表明您可以在 Python 中以 60fps 的速度移动数百位几何图形。

尽管上面的演示相当简单，因为它使用简单的几何体和无纹理的面，但我发现更详细的几何体、纹理映射或其他更现代的图形效果不会对帧速率产生实质性影响。或者至少它们不会比在 C 程序中使用相同的效果更糟。这些都是在 GPU 上运行的，所以如果你的程序是用 Python 编写的，它根本没有任何区别。

Python 对性能敏感的一件事是，如果您在 CPU 端创建动态几何图形，例如通过弯曲或熔化形状来移动形状内的各个顶点。在 Python 中进行这种逐顶点计算，然后从结果构造一个新的 ctypes 数组，然后将这个几何图形分流到 GPU，每一帧都会很慢。相反，您可能应该在顶点着色器中执行此操作。

另一方面，如果您只需要仿射变换（移动物体、旋转物体、打开抽屉柜、旋转汽车车轮、弯曲关节机械臂），那么所有这些都可以由 GPU 完成，而您的程序是用 Python 编写对性能几乎没有影响。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T08:36:47.117

您可能想查看[Python-Ogre](http://www.python-ogre.org/)。我自己搞砸了，没什么大不了的，但看起来还不错。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T12:09:29.803

我会推荐[pyglet](http://www.pyglet.org/)，它是与 pygame 类似的系统，但与 OpenGL 完全绑定。您可以从简单的 2D 游戏开始，以掌握系统的窍门，然后再升级到 3D。它是一个比 PyGame 更现代的系统，PyGame 是围绕 SDL 构建的，现在它本身有点长。

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T08:54:43.733

也许有点跑题了，但是，如果您的目标是学习 Python，那么使用[IronPython](http://www.ironpython.com/)和[XNA](http://www.xna.com/)创建游戏怎么样？XNA 不是 OpenGL，但我发现它是一个非常简单的 2D/3D 引擎，速度很快并且支持 Shader Model 3.0。

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T09:15:55.477

查看[Frets on Fire](http://fretsonfire.sourceforge.net/screenshots/)项目——一个开源的 Guitar Hero 替代品。它是用 Python 编写的，并且在 OpenGL 中有不错的 3D 图形。我建议查看[其来源](http://fretsonfire.sourceforge.net/documentation/source/)以获取有关库等的提示。

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2009-03-14T14:29:57.363

几年前有一个吸血鬼游戏，其中大部分（如果不是全部）代码都是用 Python 编写的。不确定其中是否包含 3D 例程，但它工作正常。

# programming-languages - 有什么比“Hello World”更好的语言介绍预览？

> ID：641780
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-03-13T07:55:01.523
> 
>         
> 
> 标签：programming-languages

许多编程语言都通过一个简单的“Hello World”程序来介绍自己。

作为一名程序员，我必须承认这并不能很好地了解该语言的优势和能力。

在提供编程语言的演示时，您建议使用什么样的问题？

* * *

## 回答 #1

> 赞同：14
> 
>             
> 
> 时间：2009-03-13T07:58:25.163

我认为“Hello World”程序有它的用途。如果您可以运行该程序，它说明了很多：

*   您的 IDE/工具设置正确

*   您可以用该语言编写类和/或主要方法

*   您可以调用该语言的函数进行打印

*   您可以编辑文件并为该语言正确格式化

*   您的编译器正在工作并且您知道如何使用它。

因此，出于这些原因，我没有找到比“Hello World”更好的替代方案。

但是，就一般语言的良好介绍而言，我非常喜欢[Python Challenge](http://www.pythonchallenge.com/)等编码挑战。您将获得一组必须使用该语言完成的挑战/谜题。它们一开始非常基础（第一个比写一个 hello world 更容易）。  

他们迅速进入更困难和更高级的任务，通常是旨在展示语言特定方面的任务。

我只希望每种语言都有如此有趣的编程挑战。我认为 LISP、Haskell、C++、C、Java 等挑战对人们来说是一个有趣的语言介绍。它们可以根据语言进行定制。  

C++ 挑战可能会很快开始遇到涉及指针和其他通常被误解的方面的挑战，以帮助了解那些困难的部分，而 LISP/Haskell 挑战可能会开始提出一些更适合函数式语言的问题。

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T08:08:39.507

如果您担心“hello world”程序的范围，您可以随时升级到“hello world”

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T07:58:15.587

恕我直言，hello world 程序的目的是用该语言展示一个非常简单的程序，而不是展示优势和能力。

这会很困难，因为每种语言都有自己的优势。比较每种语言的一组标准函数*可能*会带来麻烦，尤其是对于一本介绍书。

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T08:12:49.980

Larry O'Brian 写了三篇关于练习的非常好的博客文章，以帮助您熟悉编程语言。

[第 1 部分：基础知识](http://www.knowing.net/index.php/2006/06/16/15-exercises-to-know-a-programming-language-part-1/)

[第 2 部分：数据结构](http://www.knowing.net/index.php/2006/06/16/15-exercises-to-know-a-programming-language-part-2-data-structures/)

[第 3 部分：库、框架和混搭](http://www.knowing.net/index.php/2006/06/16/15-exercises-to-know-a-programming-language-part-3-libraries-frameworks-and-mashups/)

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T08:51:29.937

“99 瓶啤酒”是一个比“Hello world”稍微复杂一些的例子，因此它可以展示一种语言与其他语言的区别。

查看[http://99-bottles-of-beer.net/](http://99-bottles-of-beer.net/)。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T08:03:03.873

取决于该语言的哪些核心功能使其与其他语言区分开来。[想到](http://www.haskell.org/haskellwiki/Introduction#Quicksort_in_Haskell)了Haskell 快速排序。

话虽如此，hello world*确实*展示了如何立即产生某种输出。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T08:04:01.390

就我个人而言，当我开始使用一种新的编程语言时，我会尝试重新编写一段我已经用另一种语言编写的代码，以便我可以感受该语言并了解它与我已有的内容的关系在我以前的编程经验中学到了。

人们建议编写简单的东西，例如二叉搜索树和其他数据结构，以及一种简单的方法来测试它是否有效。另一件事是当事情开始变得复杂或不符合您以前的经验时，不要放弃编程语言。

至于寻找编程语言的优势？好吧，从编写一个小应用程序开始，然后一旦你对这种语言有了感觉，就看看用这种语言编写的开源项目。看看它做得很好，查看邮件列表，找出该项目的困难部分，他们必须解决导致他们问题的语言的一些特质。

您立即知道的某些语言适用于特定任务并且不建议在该任务之外使用它们。例如，PHP 是一种 Web 编程语言，您可以在其中编写大程序并在命令行上运行它们这一事实并不意味着它是一种应该用于这些任务的语言。

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T08:56:02.873

Bjarne Stroustrup 选择制作一个功能强大的计算器（包括解析）给我留下了非常好的印象。我原以为第一个项目会太难，但他一步一步做得很好。最终的应用程序不是玩具。

所有这些都在他的新书《C++ 编程原理与实践》中。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:34:49.270

在某些情况下，“Hello world”可能并不重要。参见例如[Struts 2 "Hello world"](http://struts.apache.org/2.1.6/docs/hello-world.html)。要让它正常工作，您需要设置服务器、设置环境、部署应用程序等。

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T22:19:10.290

好吧，“[眨眼](http://picasaweb.google.com/obeyeater/PhonePics#5300579596853247538)”是一个不错的选择，但在嵌入式世界中，这更重要......

对于错过了眨眼的你，这只是让 LED 以稳定的速度闪烁开/关。有点展示如何使用 gpio。

/约翰

# asp.net - 如何从服务器端 ASP.NET 2.0 获取与 Google Map API 的距离

> ID：641784
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T07:57:37.943
> 
>         
> 
> 标签：asp.net, google-maps

我正在开发一个需要服务器端访问 google map api 的项目。我想计算距离（实际距离，不是直线）。google map api 支持 javascript 而不是 asp.net。请给建议...！

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T09:21:28.537

Google API 允许您通过服务器端调用进行地理编码：

[http://code.google.com/apis/maps/documentation/services.html#Geocoding_Direct](http://code.google.com/apis/maps/documentation/services.html#Geocoding_Direct)

这将允许您获取位置的经度和纬度。然后，您可以使用 CMS 建议的技术缓存这些并使用它们来计算距离。

您需要注意 Google T&C，因为您只能存储地理编码数据以在公开可用的 Google 地图上使用。

您可能还会遇到从单个 IP 发出的请求数量的限制。

但是，我认为您所说的非直线距离是指考虑道路和单向街道等的距离。

如果是这种情况，我认为商业服务是您唯一的选择。虽然理论上你可以通过屏幕抓取来完成这一切，但我几乎可以肯定这会破坏谷歌的 T&C。

最简单的解决方案可能就是在您的应用程序页面上嵌入 Google 地图并让用户计算距离。如果需要，您可以预先填写往返字段。

同样，如果这是针对内部应用程序，即未公开提供的“我对 Google T&C 的理解”，将禁止这样做。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T09:59:17.463

您在问题中指定了谷歌地图 - 但您看过虚拟地球吗？具体来说，这个**[带有 Virtual Earth Web Service 的路由](http://blogs.msdn.com/virtualearth/archive/2009/01/21/routing-in-virtual-earth-web-service.aspx)**示例听起来与您想要的完全一样：

*   服务器端访问（只需在 Visual Studio 中添加服务引用）

*   实际距离（不是直线），因为它使用的是*路线*

其他人提出的关于“内部/内部网使用”的 T&C 的担忧适用于 VE 以及我认为的谷歌 - 你必须阅读你的应用程序是否需要许可。

ps 如果你*只是*想计算直线距离，我有[使用 SQL Server 2008 的说明](http://conceptdev.blogspot.com/2009/01/calculating-distance-in-c-with.html)；它还链接到一些[直接的 c# 代码](http://www.wiredprairie.us/blog/index.php/archives/688)。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T09:23:08.127

使用 firebug 或 fiddler 之类的东西来查看从 javascript 发送到 Google 的请求，然后您应该能够使用该信息和 .net 中的 HTTPWebRequest 构建请求并检索相同的信息。

高温高压

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T08:01:55.170

[您可以使用大圆距离](http://en.wikipedia.org/wiki/Great-circle_distance)算法计算两个地理坐标（纬度、经度）的距离。

[在这里](http://www.movable-type.co.uk/scripts/latlong.html)你可以找到一些其他的距离计算公式。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:36:01.687

好吧，您几乎已经确定了关键问题，Gmaps API 是浏览器驻留的 javascript API，并且没有太多的解决方法。大多数 API 在浏览器中执行，因此没有太多的网络流量可以监视。

正如 tsaunders 提到的，有一个可以轻松访问的地理编码 API 调用，但它只进行反向/地理编码，如果你已经有 lat/lng，你可以使用 rms 建议的计算，但它们就像 tsaunders 指出的那样“乌鸦飞过” ' 距离。

如果您确实在寻找道路采取的距离，API 会执行路由，但您返回浏览器以从用户那里获取起点/终点。

也许您可以更具体地说明您正在尝试做什么以及为什么您觉得这需要您从服务器访问 API。例如，我的应用程序具有从用户那里收集信息并将请求发送回我的服务器以进行处理的功能，其中一些数据首先由 Gmaps API 处理。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2010-04-07T10:43:09.740

如果我要使用 API 平台，我肯定不会使用 Google，因为免费的平台不包括先进的地理编码，意味着准确性很差。也没有 sla 、支持或服务权利。

方向很差，爱尔兰和地理编码的覆盖范围几乎是孩子气的，而且隐私很臭。没有专业企业会使用谷歌地图解决方案。

他们复制其他人的想法，说他们有自己的，并获得了大量的媒体（他们只在 2006 年增加了地铁站）和 dcyclc 车道（2010 年），viamichelin 增加了这些 2006 年和 2009 年的交通！

任何寻求 API 的机构或开发人员都应该坚持使用 Bing 或 ViaMichelin 以获得更好的定制和用户体验，这是杀手锏！

# jquery - jquery滑块最大值

> ID：641787
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T07:58:48.860
> 
>         
> 
> 标签：jquery, slider

我在下面使用 jquery 滑块插件：

```
<script type="text/javascript">
     $(document).ready(function() {
         $("#slider").slider({ min:-10 }, { max: 500 }, { step: 1 });
         $('#slider').bind('slidechange', function(event, ui) {
         var value = $('#slider').slider('option','value');
             alert(value);
         });
     });
</script> 
```

但是最大值没有初始化，总是设置为100。怎么了？谢谢

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T08:23:57.460

你必须这样写：

```
$("#slider").slider({ min:-10, max: 500, step: 1 }); 
```

# batch-file - 关闭批处理文件

> ID：641788
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T08:00:14.270
> 
>         
> 
> 标签：batch-file

我写了一个批处理文件，其中有 3 个 .bat 文件在后台运行。我有另一个批处理文件，其中包含 3 个 .bat 文件，用于停止在第一个批处理文件中运行的那些 .bat 文件。所有这些工作正常，但停止这些 .bat 文件后，第一个批处理文件的命令窗口没有关闭。我给我写的两个批处理文件都“退出”了。请帮助我。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-05-25T03:11:44.620

您可以尝试使用启动其他批处理文件

```
CMD /C 
```

或者，当它们应该关闭时，您可以尝试直接从另一个批处理文件中按名称关闭它们：

```
taskkill /F /IM batchname.bat 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T08:03:30.877

你正在用吗

```
call batchfile.bat 
```

运行批处理文件？否则，流量将出乎意料。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-05-25T03:05:38.500

如果您可以使用 Bat-To-Exe-Converter 将其转换为 .exe，则可以使用：

```
tskill [program] 
```

就像你想关闭一个名为“helloworld.exe”的批处理文件：

```
tskill helloworld 
```

您还可以使用的是：

```
tskill cmd 
```

并这样做几次。它将关闭 1 个命令和提示/时间。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2011-11-02T18:59:58.937

我以这种方式对我的一些批处理脚本进行延迟关闭：

```
FOR /l %%a in (30,-1,1) do (TITLE %TITLE% -- Closing in %%as&ping -n 2 -w 1 127.0.0.1>NUL)
EXIT /B 0 
```

# python - 在 Python 的 Textmate 中突出显示尾随空格？

> ID：641794
> 
>         
> 
> 赞同：11
> 
>         
> 
> 时间：2009-03-13T08:02:43.610
> 
>         
> 
> 标签：python, macos, textmate

我想做一些类似[Textmate](http://remysharp.com/2008/03/30/trailing-white-space-in-textmate/)技巧的事情，这样当我在 Python 中编写代码时，尾随空格总是会以某种方式突出显示——这样更容易立即更正它，其他编辑器（如 Emacs）可以做到这一点。

不幸的是，该帖子之后的讨论似乎表明这很难做到。对我来说，`invalid.trailing-whitespace`遵循此提示后，范围选择器甚至在首选项中都不可见。有没有其他人在这方面取得过任何成功？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-14T01:45:21.760

我不知道如何突出显示尾随空格，但您可以通过转到

捆绑 -> 文本 -> 转换/剥离 -> 删除文档中的尾随空格

此外，因为 textmate 具有 emacs 绑定，您可以像在 emacs 中那样做。

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2009-03-22T00:44:01.760

此代码有效（但不带注释）：

```
{   scopeName = 'source.whitespace';
    patterns = (
        {  name = 'source.invalid.trailing-whitespace';
            match = '(\s+)$';
            captures = { 1 = { name = 'invalid.trailing-whitespace'; }; };
         },
    );
} 
```

PS：我已将“source”更改为“source.whitespace”

对于 Python 语法中的注释更改：

```
{  name = 'comment.line.number-sign.python';
   match = '(#).*$\n?';
   captures = { 1 = { name = 'punctuation.definition.comment.python'; }; };
}, 
```

在：

```
{  name = 'comment.line.number-sign.python';
   match = '(#).*?(\s*)$\n?';
   captures = { 
     1 = { name = 'punctuation.definition.comment.python'; }; 
     2 = { name = 'invalid.trailing-whitespace';  }; 
   };
}, 
```

您需要在 Python 语言定义中添加一个“包含”，其中：

```
:
patterns = (
 {    name = 'comment.line.number-sign.python';
: 
```

转为：

```
:
patterns = (
 {  include = 'source.whitespace'; },
 {    name = 'comment.line.number-sign.python';
: 
```

# .net - 谁能推荐一本书在.Net中构建企业数据库应用程序？

> ID：641798
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2009-03-13T08:04:37.613
> 
>         
> 
> 标签：.net

我刚从一门课程中回来，我们介绍了一些构建企业应用程序（包括数据库应用程序）的方法。

简而言之，我已经意识到我们构建数据库应用程序的方式是完全错误的（我不会详细说明）。

谁能推荐一本有信誉的书或网站，向我展示在 .Net 中构建企业、可扩展数据库应用程序的“最佳实践”方式？

我需要这个不仅是为了帮助我改变我做事的方式，也是为了让我的老板支持我认为我们需要改变我们做事方式的原因。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T08:18:06.223

这本关于领域驱动设计的书非常实用：

[.NET Domain-Driven Design with C#: Problem - Design - Solution](http://www.wrox.com/WileyCDA/WroxTitle/-NET-Domain-Driven-Design-with-C-Problem-Design-Solution.productCd-0470147563.html)

我认为您的问题不仅仅与数据库有关：我认为人们构建*企业数据库应用程序*的意义并不在于您不决定*围绕*数据库构建企业解决方案。

数据库只是设计的一小部分，而不是设计的中心。

企业应用程序必须首先满足整个公司的需求，因此必须包括许多不同的技术：数据库、用户界面（瘦客户端、胖客户端、Web 客户端）、服务、报告、安全性、可扩展性等必须全部得到适当的解决，并且或多或少同样重要。

有许多方法可以解决这些企业问题和许多解决方案。

因此，*企业数据库应用程序*似乎不是描述构建企业应用程序的方法的正确方式。

另一方面，诸如[领域驱动设计](http://en.wikipedia.org/wiki/Domain-driven_design)之类的东西是解决这类问题的通用方法。

他们不仅专注于数据库方面，而且专注于构建整个应用程序。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T08:15:20.617

这是一本非常好的关于 .NET 架构的免费书籍：[Application Architecture Guide 2.0](http://www.codeplex.com/AppArchGuide)

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T08:45:52.897

我还推荐Martin Fowler[的企业应用程序架构模式。](http://books.google.com/books?id=FyWZt5DdvFkC&hl=us)

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T14:53:59.283

[High Scalable Book store](http://highscalability.com/book-store)上有很多好书。它们可能并非特定于 .Net，但最佳实践适用于任何地方。这是一篇很好的 MSDN 文章[Scaling Strategies for ASP.NET Applications](http://msdn.microsoft.com/en-us/magazine/cc500561.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T08:57:07.817

[应用领域驱动设计和模式：](https://rads.stackoverflow.com/amzn/click/com/0321268202) Jimmy Nilsson 的 C# 和 .NET 示例。

# c# - DisplayMember 在 DataSource=null 上得到重置

> ID：641809
> 
>         
> 
> 赞同：9
> 
>         
> 
> 时间：2009-03-13T08:13:41.803
> 
>         
> 
> 标签：c#, controls, user-interface, combobox, datasource

我有一个 ComboBox，其项目是使用 DataSource 属性设置的。DataSource 是自定义对象的集合（*具有字符串属性 'Value' 和 int 属性 'Id'*）。在初始化控件中，我将**DisplayMember**设置为*Value*并将**ValueMember**设置为*Id*。现在我试图通过调用清除数据源，

```
myComboBox.DataSource = null; 
```

当我这样做时，我的 DisplayMember 会自动重置为“”。我是否正确清除了数据源？这是我应该表现的方式吗？？？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T08:19:51.900

我可以重现它......这不是我所期望的，但看起来你只需要在`DisplayMember`之后设置背部。

查看反射器，这是非常有意的：

```
 if (value == null)
        {
            this.DisplayMember = "";
        } 
```

不确定其*背后*的原因，但很简单：

```
string oldDisplayMember = cbo.DisplayMember;
cbo.DataSource = null;
cbo.DisplayMember = oldDisplayMember; 
```

不漂亮，但它会工作。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2015-07-06T21:51:42.470

当抛出异常或 Datasource 值为 null 时，Displaymember 设置为空字符串。

使用 .NET 代码反编译器，代码中有关于其工作原理的注释。我会试着解释一下。

在以下情况下可能会抛出异常：

1.  DataSourceChanged 上的应用程序代码

2.  在数据被格式化以显示时的绑定期间

3.  如果 DisplayMember 值在新数据源中无效。

该评论还提到实际的异常被“吞下”以防止破坏预期的行为。

我个人遇到了这种行为，因为没有抛出异常，所以很难弄清楚这些条件中的哪一个导致了重置。可能有更好的方法，但现在我在自定义控件中使用它。Datasource 属性在重置后设置 DisplayMember 时有效，所以我真的不确定它为什么会失败：

```
 public new object DataSource
    {
        get { return base.DataSource; }
        set
        {
            string displayMem = this.DisplayMember;
            base.DataSource = value;
            if (string.IsNullOrEmpty(this.DisplayMember) && string.IsNullOrEmpty(displayMem)) 
                this.DisplayMember = displayMem;
            DetermineDropDownWidth();
        }
    } 
```

# asp.net - 是否有解密 AS3CRYPTO 加密消息的 AES 源代码 (VB.NET)

> ID：641810
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T08:14:04.800
> 
>         
> 
> 标签：asp.net, vb.net, encryption

是否有可用于 AES 加密的简单 ASP.NET (.VB)？

这是一个指向 c# 的链接，但它的复杂性有很多参数，例如盐。[ [http://www.gutgames.com/post/AES-Encryption-in-C.aspx]](http://www.gutgames.com/post/AES-Encryption-in-C.aspx])

我需要一个与 GOOGLEAS3 类一起使用的简单类，它可以像这样轻松调用：

```
var key:ByteArray = Hex.toArray("1234567890abcdef");
var pt:ByteArray = Hex.toArray( Hex.fromString("aaaaaaaaaaaaaaaaaaaa"));
var aes:AESKey = new AESKey(key);
aes.encrypt(pt);
var out:String = Hex.fromArray(pt).toUpperCase(); 
```

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T08:45:06.003

AES 内置在框架中，作为 System.Security.Cryptography 中的[Aes](http://msdn.microsoft.com/en-us/library/system.security.cryptography.aes.aspx)类。有两种具体的实现，一种是托管的，一种是使用 Windows Crypto Service Provider（速度更快，但不能移植到其他平台）。还有一个[Rijndael](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndaelmanaged.aspx)的实现，AES 就是从该实现中派生出来的。

请记住，您需要一个初始化向量以及加密/解密的密钥，因为它是一个分组密码。如果您在未设置一个的情况下进行加密，则将使用随机一个，但您需要存储和检索它以进行解密。

示例代码：（摘自我即将出版的书*grin*的第 6 章）

```
static byte[] Encrypt(byte[] clearText, byte[] key, byte[] iv)
{
    // Create an instance of our encyrption algorithm.
    RijndaelManaged rijndael = new RijndaelManaged();

    // Create an encryptor using our key and IV
    ICryptoTransform transform = rijndael.CreateEncryptor(key, iv);

    // Create the streams for input and output
    MemoryStream outputStream = new MemoryStream();
    CryptoStream inputStream = new CryptoStream(
        outputStream,
        transform,
        CryptoStreamMode.Write);

    // Feed our data into the crypto stream.
    inputStream.Write(clearText, 0, clearText.Length);

    // Flush the crypto stream.
    inputStream.FlushFinalBlock();

    // And finally return our encrypted data.
    return outputStream.ToArray();
} 
```

并解密

```
static byte[] Decyrpt(byte[] clearText, byte[] key, byte[] iv)
{
    // Create an instance of our encryption algorithm.
    RijndaelManaged rijndael = new RijndaelManaged();

    // Create an decryptor using our key and IV
    ICryptoTransform transform = rijndael.CreateDecryptor(key, iv);

    // Create the streams for input and output
    MemoryStream outputStream = new MemoryStream();
    CryptoStream inputStream = new CryptoStream(
        outputStream,
        transform,
        CryptoStreamMode.Write);

    // Feed our data into the crypto stream.
    inputStream.Write(clearText, 0, clearText.Length);

    // Flush the crypto stream.
    inputStream.FlushFinalBlock();

    // And finally return our decrypted data.
    return outputStream.ToArray();
} 
```

用 AES 类之一和合适的密钥替换 RijndaelManaged 类。

# c# - 如何将 wpf ListBox 的 ItemTemplate 嵌入到 Window 的资源中？

> ID：641815
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T08:17:15.773
> 
>         
> 
> 标签：c#, wpf, xaml, itemtemplate

抱歉，如果这是一个基本问题，但我怎样才能将我拥有的 ListBox 的 ItemTemplate 放入窗口的资源中，以便多个 ListBox 可以使用它。

这是一些 XAML：

```
<Window x:Class="Example">
    <Window.Resources>
        <DataTemplate x:Key="dtExample">
            <ListBox.ItemTemplate>
            // styles go here...
            </ListBox.ItemTemplate>
        </DataTemplate>
    </Window.Resources>
    <ListBox ItemTemplate="{StaticResource dtExample}">
    // items go here...
    </ListBox>
</Window> 
```

这会引发“附加属性没有设置器”设计时错误。为了简洁起见，我删除了我认为无关紧要的部分代码。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T08:21:45.937

只需将您的 itemtemplate 添加到窗口的资源并添加一个键：

```
<Window.Resource>
 <DataTemplate x:Key="myTemplate">
  ....
 </DataTemplate>
</Window.Resources> 
```

然后用这样的东西应用它：

```
<ListBox ItemTemplate="{StaticResource myTemplate}">
 ...
</ListBox> 
```

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T12:37:37.473

您提供了以下代码：

```
 <DataTemplate x:Key="dtExample">
        <ListBox.ItemTemplate>
        // styles go here...
        </ListBox.ItemTemplate>
    </DataTemplate> 
```

但这行不通。您**不能**`<ListBox.ItemTemplate>`直接在模板中提供。你在这里不需要这个。只需创建一个简单的数据模板，它应该可以工作。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2010-06-30T10:41:04.703

我知道这篇文章太老了，对作者来说太有趣了，但我可能对那些有同样问题的人感兴趣，然后用谷歌搜索一下。我可能会看到问题是您应该在 ListBox 中使用 ListBox.ItemTemplate。例如，`<ListBox ...><ListBox.ItemTemplate> ... </ListBox.ItemTemplate></ListBox>`

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:51:56.827

我认为问题在于您应该在资源中使用 x:Key 属性而不是 x:Name..

改变它，它会像一个魅力:)

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T10:06:17.557

您的 Window 类中有以下标签吗？

```
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
```

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2020-06-19T11:14:43.827

主题很旧，但这是解决方案：

```
<Window.Resources>
    <Style x:Key="ListBoxItem_Color" TargetType="{x:Type ListBoxItem}">
        <Setter Property="Template">
            *//style*
        </Setter>
    </Style>
</Window.resources>

<ListBox x:Name="MyListBox"
         ...
         ItemContainerStyle="{StaticResource ListBoxItem_Color}">
      <.../>
</ListBox> 
```

# asp.net - 使大型 ASP.NET Web 应用程序符合第 508 节的工具和实践

> ID：641824
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T08:24:10.093
> 
>         
> 
> 标签：asp.net, section508

我们即将迁移现有的大型 ASP.NET Web 应用程序以使其[符合第 508 节](http://www.section508.gov/index.cfm?FuseAction=Content&ID=3)。是否有任何推荐的工具和实践可用于此类项目？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T08:56:16.990

*   确保应用程序可以在不使用 JavaScript 的情况下正常运行。您可能会发现必须减少使用内置 ASP.NET 服务器控件才能执行此操作。

*   确保 HTML 有效，并充分利用标签等元素为所有输入赋予意义等。

*   您可能希望考虑使用 ASP.NET MVC，因为它可以让您更好地控制最终呈现的 HTML。或者，可以使用[CSS 控制适配器。](http://www.asp.net/CssAdapters/)

*   如果您的应用程序需要 XHTML 编辑器，那么可能值得一看[XStandard](http://www.xstandard.com/)。这个编辑器提供了一个可访问的界面并生成兼容的 XHTML（不需要 JavaScript），缺点是它是一个浏览器插件，因此它可能不适合您的应用程序。

# c++ - 链接器映射文件中的 __unwind$ 是什么

> ID：641826
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T08:26:22.350
> 
>         
> 
> 标签：c++, visual-c++, linker

对于 VS2008 (C++) 生成的链接器映射文件，符号“__unwind$”是什么意思？我的应用程序的链接器映射文件中有很大一部分。

我有一个日志，上面写着崩溃发生在一个特定的偏移量上，比如“x”。当我查看这个偏移量的链接器映射时，我发现这个 __unwind$41357 对应于该偏移量。

通常还有任何参考来了解链接器映射文件的文件格式吗？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T09:15:48.537

当抛出异常时，堆栈会发生“展开”。`__`前缀表示编译器生成的符号。因此，根据描述，您会在投掷和接球之间发生崩溃。我的假设是调用的析构函数是从`__unwind$`函数中调用的。内联析构函数没有自己的堆栈帧，因此它会显示在调用`__unwind$`函数中。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:15:52.793

只是一个猜测，但我会说它是在抛出异常时处理堆栈展开的代码的一部分。

# cocoa-touch - 如何在 Iphone 上使用 Objective-C 在控制器中初始化自定义类/对象

> ID：641829
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2009-03-13T08:29:50.987
> 
>         
> 
> 标签：cocoa-touch

我有一个像这样的简单“模型”类（当然还有构造函数）

```
@implementation Widget
@synthesize name;
@synthesize color;

- (id) init 
{
    if (self = [super init])
    {
        self.name = @"Default Name";
        self.color = @"brown";
    }
    return self;
}

@end 
```

我已经将它声明为我的控制器的内部成员，如下所示：

```
#import <UIKit/UIKit.h>
#import "Widget.h"

@interface testerViewController : UIViewController {
    IBOutlet UITextField    *stuffField;
    Widget *widget;
}

@property (nonatomic, retain) UITextField *stuffField;
@property (nonatomic, retain) Widget *widget;
- (IBAction)buttonPressed:(id)sender;
@end 
```

并且......我正在尝试在我的控制器中初始化它，如下所示：

```
#import "testerViewController.h"
@implementation testerViewController
@synthesize stuffField;
@synthesize widget;

- (IBAction)buttonPressed:(id)sender
{
    stuffField.text = widget.name;
}

- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil {
    if (self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil]) {
        widget = [[Widget alloc] init];
    }
    return self;
} 
```

但是.. 它似乎没有初始化我的对象，因为我的文本字段每次都出现空白。有什么线索吗？  

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T10:50:17.700

尝试使用

-(void) viewDidLoad{} 方法来初始化你的数据

在您的界面类中使用 @class Widget 而不是 #import "Widget.h"

并在您的实现类中使用 #import "Widget.h"

并确保您进入您的 buttonPressed 处理程序！

# .net - 如何禁用所有 .NET 安全策略？

> ID：641842
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T08:39:21.523
> 
>         
> 
> 标签：.net, asp.net, interop, iis-6

我正在尝试用将在 IIS 上运行的 ASP.NET 解决方案替换旧的自制单线程 Web 服务器。旧服务器做了很多奇怪的事情，比如访问路径之外的文件、进行 com 调用、写入 c: 等等。它从用 C++ 编写的库中完成所有这些工作。

在新应用程序中，我们希望使用相同的库，因此我们最终必须弄清楚如何使应用程序安全。但现在我只想让一个原型在 IIS 上运行，这样我们就可以证明它将是对现有解决方案的改进。

问题是我在.NET 的安全异常之后得到了安全异常。我通过以下方式摆脱了一些：

```
caspol -machine -chggroup 1.5\. FullTrust
caspol -s off 
```

但我仍然无法运行它。我必须处理的是：

*   视窗 2003 服务器

*   IIS 6

*   .NET 2.0

我还可以补充一点，在 casini 上一切正常，但我们需要在 IIS 上启动它以证明值得花时间进行切换。

如何禁用所有 .NET 安全性以便我可以运行原型？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T08:44:17.690

（一些小的修改）

听起来您遇到的安全问题是*Windows*安全问题，而不是*.NET*策略。只要它仅**用于原型**，您就可以以管理员身份运行它。[将应用程序池的身份更改](https://stackoverflow.com/questions/630183/sspi-connection-in-net-2-0-web-service/630220#630220)为管理帐户（或您自己）。祈祷;-p

对于*实际*工作，您将创建一个仅具有必要权限的非管理域帐户。

我想它可以在开发网络服务器中工作，因为它以*你*的身份运行。

# java - 将 Java BigDecimal 舍入到最近的间隔

> ID：641848
> 
>         
> 
> 赞同：18
> 
>         
> 
> 时间：2009-03-13T08:44:44.773
> 
>         
> 
> 标签：java, rounding, bigdecimal, intervals

我有一个 BigDecimal 计算结果，我需要将其四舍五入到最接近的指定间隔（在这种情况下，它是金融市场的刻度大小）。

例如价格 [Tick Size] -> 四舍五入的价格

```
100.1 [0.25] -> 100
100.2 [0.25] -> 100.25
100.1 [0.125] -> 100.125
100.2 [0.125] -> 100.25 
```

谢谢。

更新：schnaader 的解决方案，翻译成 Java/BigDecimal 术语：

```
price = price.divide(tick).setScale(0, RoundingMode.HALF_UP).multiply(tick) 
```

* * *

## 回答 #1

> 赞同：14
> 
>             
> 
> 时间：2009-03-13T08:49:16.960

您可以标准化刻度大小，然后使用通常的舍入方法：

```
100.1 [0.25] -> * (1/0.25) -> 400.4 [1]  -> round -> 400 -> / (1/0.25) -> 100
100.2 [0.25] -> * (1/0.25) -> 400.8 [1] -> round -> 401 -> / (1/0.25) -> 100.25 
```

所以应该是：

```
Price = Round(Price / Tick) * Tick; 
```

另请注意，您似乎必须为 BigDecimals 设置正确的舍入模式。例如，请参阅[BigDecimal 文档](http://java.sun.com/j2se/1.5.0/docs/api/java/math/BigDecimal.html#ROUND_CEILING)。所以你应该确保设置正确并编写一些测试来检查你的代码的正确性。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2020-04-24T18:36:13.553

这与**“将股票价格四舍五入到最接近的刻度大小”**更相关。

schnaader 提供的答案是正确的，但是缺少一些内容。

*   首先，你必须检查股价是否需要四舍五入。不必要的舍入会弄乱小数部分。

*   然后你还需要处理在divide函数`ArithmeticException`中可能出现的问题`BigDecimal`

这是我的解决方案。解释它需要很多时间。我建议尝试一些样品来感受一下。寻找功能**`roundTick()`**。

```
import static java.math.RoundingMode.HALF_UP;

import java.math.BigDecimal;

/**
 * Utility class for stock price related operations.
 */
public final class PriceFormatter {

    public static final float DELTA = 0.0001f;

    private PriceFormatter() {
    }

    /**
     * Rounds the price to the nearest tick size.
     *
     * @param price    price
     * @param tickSize tick size
     * @return price rounded to the nearest tick size
     */
    public static final float roundTick(final float price, final float tickSize) {
        if (tickSize < DELTA) {
            return price;
        }

        if (!isRoundingNeeded(price, tickSize)) {
            return price;
        }

        final BigDecimal p = new BigDecimal(price);
        final BigDecimal t = new BigDecimal(tickSize);

        final BigDecimal roundedPrice = p.divide(t, 0, HALF_UP).multiply(t);

        return roundedPrice.floatValue();
    }

    /**
     * Checks whether price needs rounding to the nearest tick size.
     *
     * @param price    price
     * @param tickSize tick size
     * @return true, if rounding is needed; false otherwise
     */
    public static final boolean isRoundingNeeded(final float price, final float tickSize) {
        final int mult = calculateTickMultiplier(tickSize);
        final int mod = (int) (tickSize * mult);
        final float reminder = (((price * mult) % mult) % mod);
        final boolean needsRounding = reminder > DELTA;
        return needsRounding;
    }

    public static final int calculateTickMultiplier(final float tickSize) {
        int result = 1;
        while (((tickSize * result) < 1) || (((tickSize * result) - (int) (tickSize * result)) > DELTA)) {
            result *= 10;
        }

        return result;
    }

} 
```

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2013-12-06T01:44:42.480

```
p= p - p % t + ((p % t < t / 2) ? 0.0 : t); 
```

//其中 p= 价格和 t= 刻度增量

# javascript - JavaScript 窗口大小调整事件

> ID：641857
> 
>         
> 
> 赞同：677
> 
>         
> 
> 时间：2009-03-13T08:50:23.120
> 
>         
> 
> 标签：javascript, window-resize

如何挂钩浏览器窗口调整大小事件？

有[一种 jQuery 监听调整大小事件的方法，](https://stackoverflow.com/questions/599288/cross-browser-window-resize-event-javascript-jquery)但我不希望将它带入我的项目中，只是为了满足这一要求。

* * *

## 回答 #1

> 赞同：708
> 
>             
> 
> 时间：2009-03-13T08:58:05.363

最佳做法是附加到调整大小事件。

```
window.addEventListener('resize', function(event) {
    ...
}, true); 
```

jQuery 只是包装标准的`resize`DOM 事件，例如。

```
window.onresize = function(event) {
    ...
}; 
```

jQuery*可能会*做一些工作来确保在所有浏览器中一致地触发 resize 事件，但我不确定是否有任何浏览器不同，但我鼓励您在 Firefox、Safari 和 IE 中进行测试。

* * *

## 回答 #2

> 赞同：613
> 
>             
> 
> 时间：2013-08-29T20:32:33.057

首先，我知道`addEventListener`上面的评论中已经提到了这个方法，但是我没有看到任何代码。由于它是首选方法，因此它是：

```
window.addEventListener('resize', function(event){
  // do stuff here
}); 
```

[这是一个工作示例](http://codepen.io/jondlm/pen/doijJ)。

* * *

## 回答 #3

> 赞同：535
> 
>             
> 
> 时间：2010-06-30T14:19:45.970

永远不要覆盖 window.onresize 函数。

相反，创建一个函数以将事件侦听器添加到对象或元素。这会检查并以防监听器不起作用，然后它会覆盖对象的功能作为最后的手段。这是 jQuery 等库中使用的首选方法。

`object`：元素或窗口对象

`type`：调整大小、滚动（事件类型）

`callback`：函数引用

```
var addEvent = function(object, type, callback) {
    if (object == null || typeof(object) == 'undefined') return;
    if (object.addEventListener) {
        object.addEventListener(type, callback, false);
    } else if (object.attachEvent) {
        object.attachEvent("on" + type, callback);
    } else {
        object["on"+type] = callback;
    }
}; 
```

然后使用是这样的：

```
addEvent(window, "resize", function_reference); 
```

或使用匿名函数：

```
addEvent(window, "resize", function(event) {
  console.log('resized');
}); 
```

* * *

## 回答 #4

> 赞同：45
> 
>             
> 
> 时间：2017-04-06T03:12:56.840

永远不要直接使用 resize 事件，因为它会在我们调整大小时连续触发。

使用去抖动功能来减轻多余的调用。

`window.addEventListener('resize',debounce(handler, delay, immediate),false);`

这是一个常见的在网络上漂浮的反跳，尽管在 lodash 中寻找更高级的反跳。

```
const debounce = (func, wait, immediate) => {
    var timeout;
    return () => {
        const context = this, args = arguments;
        const later = function() {
            timeout = null;
            if (!immediate) func.apply(context, args);
        };
        const callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
    };
}; 
```

这可以像这样使用......

```
window.addEventListener('resize', debounce(() => console.log('hello'),
200, false), false); 
```

它不会每 200 毫秒触发一次以上。

对于移动方向更改，请使用：

```
window.addEventListener('orientationchange', () => console.log('hello'), false); 
```

这是我整理的一个[小图书馆，可以很好地处理这个问题。](https://github.com/julienetie/resizilla)

* * *

## 回答 #5

> 赞同：43
> 
>             
> 
> 时间：2018-03-20T10:00:27.483

**2018+ 解决方案：**

您应该使用[ResizeObserver](https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver)。`resize`它是一种浏览器原生解决方案，其性能比使用事件要好得多。此外，它不仅支持上的事件，`document`而且还支持任意上的事件`elements`。

> ```
> var ro = new ResizeObserver( entries => {
>   for (let entry of entries) {
>     const cr = entry.contentRect;
>     console.log('Element:', entry.target);
>     console.log(`Element size: ${cr.width}px x ${cr.height}px`);
>     console.log(`Element padding: ${cr.top}px ; ${cr.left}px`);
>   }
> });
> 
> // Observe one or multiple elements
> ro.observe(someElement); 
> ```

目前，[Firefox、Chrome、Safari 和 Edge 都支持它](https://caniuse.com/#feat=resizeobserver)。对于其他（和更旧的）浏览器，您必须使用[polyfill](https://github.com/que-etc/resize-observer-polyfill)。

* * *

## 回答 #6

> 赞同：16
> 
>             
> 
> 时间：2015-10-05T18:38:42.377

我确实相信@Alex V 已经提供了正确的答案，但答案确实需要一些现代化，因为它现在已经超过五年了。

主要有两个问题：

1.  切勿`object`用作参数名称。这是一个保留词。话虽如此，@Alex V 提供的功能在`strict mode`.

2.  @Alex V 提供的`addEvent`函数不返回`event object`if 该`addEventListener`方法是否被使用。另一个参数应该添加到`addEvent`函数中以允许这样做。

**注意：新参数 to`addEvent`已设为可选，因此迁移到此新函数版本不会中断对该函数的任何先前调用。将支持所有遗留用途。**

`addEvent`这是具有这些更改的更新功能：

```
/*
    function: addEvent

    @param: obj         (Object)(Required)

        -   The object which you wish
            to attach your event to.

    @param: type        (String)(Required)

        -   The type of event you
            wish to establish.

    @param: callback    (Function)(Required)

        -   The method you wish
            to be called by your
            event listener.

    @param: eventReturn (Boolean)(Optional)

        -   Whether you want the
            event object returned
            to your callback method.
*/
var addEvent = function(obj, type, callback, eventReturn)
{
    if(obj == null || typeof obj === 'undefined')
        return;

    if(obj.addEventListener)
        obj.addEventListener(type, callback, eventReturn ? true : false);
    else if(obj.attachEvent)
        obj.attachEvent("on" + type, callback);
    else
        obj["on" + type] = callback;
}; 
```

`addEvent`对新函数的示例调用：

```
var watch = function(evt)
{
    /*
        Older browser versions may return evt.srcElement
        Newer browser versions should return evt.currentTarget
    */
    var dimensions = {
        height: (evt.srcElement || evt.currentTarget).innerHeight,
        width: (evt.srcElement || evt.currentTarget).innerWidth
    };
};

addEvent(window, 'resize', watch, true); 
```

* * *

## 回答 #7

> 赞同：11
> 
>             
> 
> 时间：2009-12-05T18:50:43.967

感谢您在[http://mbccs.blogspot.com/2007/11/fixing-window-resize-event-in-ie.html](http://mbccs.blogspot.com/2007/11/fixing-window-resize-event-in-ie.html)上引用我的博客文章。

虽然您可以连接到标准的窗口调整大小事件，但您会发现在 IE 中，每个 X 轴和每个 Y 轴移动都会触发一次该事件，从而导致触发大量事件，这些事件可能具有性能如果渲染是一项密集的任务，则会对您的网站产生影响。

我的方法涉及一个短暂的超时，该超时会在后续事件中被取消，以便在用户完成窗口大小调整之前，该事件不会冒泡到您的代码中。

* * *

## 回答 #8

> 赞同：7
> 
>             
> 
> 时间：2009-11-16T05:27:55.777

```
window.onresize = function() {
    // your code
}; 
```

* * *

## 回答 #9

> 赞同：5
> 
>             
> 
> 时间：2009-03-13T09:00:25.313

以下博客文章可能对您有用：[修复 IE 中的窗口调整大小事件](http://mbccs.blogspot.com/2007/11/fixing-window-resize-event-in-ie.html)

它提供了以下代码：

> ```
> Sys.Application.add_load(function(sender, args) {
>     $addHandler(window, 'resize', window_resize);
> });
> 
> var resizeTimeoutId;
> 
> function window_resize(e) {
>      window.clearTimeout(resizeTimeoutId);
>      resizeTimeoutId = window.setTimeout('doResizeCode();', 10);
> } 
> ```

* * *

## 回答 #10

> 赞同：3
> 
>             
> 
> 时间：2014-04-20T03:55:19.340

如果您只想调整窗口和窗口的大小，上面已经提到的解决方案将起作用。但是，如果您想将调整大小传播到子元素，则需要自己传播事件。这是一些示例代码：

```
window.addEventListener("resize", function () {
  var recResizeElement = function (root) {
    Array.prototype.forEach.call(root.childNodes, function (el) {

      var resizeEvent = document.createEvent("HTMLEvents");
      resizeEvent.initEvent("resize", false, true);
      var propagate = el.dispatchEvent(resizeEvent);

      if (propagate)
        recResizeElement(el);
    });
  };
  recResizeElement(document.body);
}); 
```

请注意，子元素可以调用

```
 event.preventDefault(); 
```

在作为调整大小事件的第一个 Arg 传入的事件对象上。例如：

```
var child1 = document.getElementById("child1");
child1.addEventListener("resize", function (event) {
  ...
  event.preventDefault();
}); 
```

* * *

## 回答 #11

> 赞同：1
> 
>             
> 
> 时间：2011-04-13T20:30:10.903

```
<script language="javascript">
    window.onresize = function() {
    document.getElementById('ctl00_ContentPlaceHolder1_Accordion1').style.height = '100%';
} 

</script> 
```

* * *

## 回答 #12

> 赞同：1
> 
>             
> 
> 时间：2015-09-01T18:18:00.973

```
var EM = new events_managment();

EM.addEvent(window, 'resize', function(win,doc, event_){
    console.log('resized');
    //EM.removeEvent(win,doc, event_);
});

function events_managment(){
    this.events = {};
    this.addEvent = function(node, event_, func){
        if(node.addEventListener){
            if(event_ in this.events){
                node.addEventListener(event_, function(){
                    func(node, event_);
                    this.events[event_](win_doc, event_);
                }, true);
            }else{
                node.addEventListener(event_, function(){
                    func(node, event_);
                }, true);
            }
            this.events[event_] = func;
        }else if(node.attachEvent){

            var ie_event = 'on' + event_;
            if(ie_event in this.events){
                node.attachEvent(ie_event, function(){
                    func(node, ie_event);
                    this.events[ie_event]();
                });
            }else{
                node.attachEvent(ie_event, function(){
                    func(node, ie_event);
                });
            }
            this.events[ie_event] = func;
        }
    }
    this.removeEvent = function(node, event_){
        if(node.removeEventListener){
            node.removeEventListener(event_, this.events[event_], true);
            this.events[event_] = null;
            delete this.events[event_];
        }else if(node.detachEvent){
            node.detachEvent(event_, this.events[event_]);
            this.events[event_] = null;
            delete this.events[event_];
        }
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2020-09-07T20:10:36.467

您可以使用以下[适用于小型项目的方法](https://stackoverflow.com/a/54769527/860099)

```
<body onresize="yourHandler(event)"> 
```

```
function yourHandler(e) {
  console.log('Resized:', e.target.innerWidth)
}
```

```
<body onresize="yourHandler(event)">
  Content... (resize browser to see)
</body>
```

# css - 像素和百分比宽度 div 并排

> ID：641861
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T08:53:18.480
> 
>         
> 
> 标签：css, width

我发现了很多类似的问题，并尝试了几种解决方案（包括一些所谓的“圣杯”CSS 布局），但它们并不能完全满足我的需要。

我有一个包含 id 的 div （一个包含 CSS 的块）`right`。在它的左侧，我想要一个固定宽度的 div （一个分隔条，但它的用途并不重要； id `splitpane`）；在右侧，填充其余空间，另一个 div（`right-box`下面的 id）。

我尝试制作两个内部 div `display: inline-block`（使用`vertical-align: top`），将左侧设置为`width: 3px`，但无法将右侧设置为 100% - 3px 的宽度。我也尝试过使用`float: left`//技巧`margin-left: -100%`，`margin-left: 3px`但它有同样的问题：100% 加上 3px 溢出父包含块并导致滚动条弹出。（当然，问题不是滚动条本身；我可以用`overflow: hidden`它来删除它，但右边的内容会被截断。）

目前我正在使用`width: 99.5%`正确的 div，但这是一个可怕的 hack（并且会根据屏幕宽度溢出）。它看起来有点像这样：

```
<div id="right"><div id="splitpane"></div><div id="right-box">
  ...
</div></div> 
```

使用 CSS 如下（浮动版本，但 inline-block 版本类似）：

```
#right {
  display: inline-block;
  vertical-align: top;
  height: 100%;
  width: 85%;  /* this is part of a larger div */
}
#right-box {
  width: 99.5%; /* stupid hack; actually want 100% - 3px for splitter */
  height: 100%;
}
#splitpane {
  float: left;
  width: 3px;
  height: 100%;
  background: white;
  border-left: solid gray 1px;
  border-right: solid gray 1px;
  cursor: e-resize;
} 
```

甚至有可能做到这一点吗？这是针对内部应用程序的。所以解决方案只需要在 Firefox 3 中运行（如果它们特定于 FF3，最好是因为该解决方案符合标准，但其他浏览器不符合标准，而不是因为它仅使用 Firefox代码）。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T09:35:22.250

DIV 是错误的元素类型，因为它们不会相互“交谈”。您可以使用表格轻松实现此目的：

```
<table style="width:200px">
<tr>
    <td id="splitpane" style="width: 3px">...</td>
    <td id="rightBox" style="width: 100%">...</td>
<tr>
</table> 
```

100% 将使 rightBox 尽可能宽，但在表格的范围内。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T09:14:41.987

为什么你没有在右框上使用**margin-left**（因为它是浮动布局）？

所以无需创建拆分器 div ...

```
 #right{
width:200px; /*specify some width*/
}
#rightbox{
float:left;
margin-left: 3px; /*replace the splitter*/
/*margin: 0 3px; /*use this to give left & right splitter*/ */
} 
```

是的，类似的东西，我讨厌空的 div，它不是语义的，就像在“旧”表方式上放置一个拆分器

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2013-03-16T23:26:46.920

这个有可能。由于块级元素会自动扩展以占用任何剩余的水平空间，因此您可以在具有所需宽度的未清除浮动元素旁边使用块级元素。

```
<style type="text/css">
    div {
        height: 100px;
    }
    #container {
        width: 100%;
    }
    #left {
        background: #FF0;
    }
    #splitpane {
        position: relative;
        float: right;
        background: #000;
        width: 3px;
    }
</style>

<div id="container">
    <div id="splitpane"></div>
    <div id="left"></div>
</div> 
```

见[http://jsfiddle.net/georeith/W4YMD/1/](http://jsfiddle.net/georeith/W4YMD/1/)

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:11:02.697

如果 div #right-box 仅包含非浮动内容，则将内容放在 #right 中并让它环绕浮动 #splitpane 可能是一个想法。

# c++ - 在c ++中返回指向向量元素的指针

> ID：641864
> 
>         
> 
> 赞同：70
> 
>         
> 
> 时间：2009-03-13T08:54:56.760
> 
>         
> 
> 标签：c++, pointers, containers, iterator

我在全局范围内有一个 myObjects 向量。我有一种方法，它使用 a`std::vector<myObject>::const_iterator`来遍历向量，并进行一些比较以找到特定元素。一旦我找到了所需的元素，我希望能够返回一个指向它的指针（向量存在于全局范围内）。

如果我 return `&iterator`，我是返回迭代器的地址还是迭代器指向的地址？

我是否需要将`const_iterator`back 转换为 myObject，然后返回它的地址？

* * *

## 回答 #1

> 赞同：103
> 
>             
> 
> 时间：2009-03-13T09:01:33.517

返回迭代器指向的事物的地址：

```
&(*iterator) 
```

**编辑：**为了消除一些混乱：

```
vector <int> vec;          // a global vector of ints

void f() {
   vec.push_back( 1 );    // add to the global vector
   vector <int>::iterator it = vec.begin();
   * it = 2;              // change what was 1 to 2
   int * p = &(*it);      // get pointer to first element
   * p = 3;               // change what was 2 to 3
} 
```

不需要指针向量或动态分配。

* * *

## 回答 #2

> 赞同：15
> 
>             
> 
> 时间：2009-03-13T09:03:54.150

返回 &iterator 将返回迭代器的地址。如果您想返回一种引用元素的方式，请返回迭代器本身。

请注意，您不需要将向量设为全局才能返回迭代器/指针，但向量中的操作可能会使迭代器无效。例如，如果新的 size() 大于保留的内存，则向向量添加元素可以将向量元素移动到不同的位置。从向量中删除给定项之前的元素将使迭代器引用不同的元素。

在这两种情况下，根据 STL 实现，可能很难调试，只是随机错误经常发生。

评论后编辑：'是的，我不想返回迭代器 a）因为它的 const 和 b）肯定它只是一个本地的临时迭代器？——克拉科斯

迭代器不比任何其他变量更多或更少是本地或临时的，它们是可复制的。您可以返回它，编译器将为您制作副本，就像使用指针一样。

现在有了常量。如果调用者想要通过返回的元素（无论是指针还是迭代器）执行修改，那么您应该使用非常量迭代器。（只需从迭代器的定义中删除“const_”）。

* * *

## 回答 #3

> 赞同：6
> 
>             
> 
> 时间：2014-09-05T19:41:38.137

您可以使用向量的**数据**函数：

> 返回指向向量中第一个元素的指针。

如果不想要指向第一个元素的指针，而是通过索引，那么您可以尝试，例如：

```
//the index to the element that you want to receive its pointer:
int i = n; //(n is whatever integer you want)

std::vector<myObject> vec;
myObject* ptr_to_first = vec.data();

//or

std::vector<myObject>* vec;
myObject* ptr_to_first = vec->data();

//then

myObject element = ptr_to_first[i]; //element at index i
myObject* ptr_to_element = &element; 
```

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T09:02:21.033

返回迭代器不是一个好主意。当对向量（inversion\deletion）进行修改时，迭代器变得无效。此外，迭代器是在堆栈上创建的本地对象，因此返回相同的地址根本不安全。我建议您使用 myObject 而不是矢量迭代器。

**编辑：**
如果对象是轻量级的，那么最好返回对象本身。否则返回指向存储在向量中的 myObject 的指针。

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T12:34:01.413

只要您的向量保持在全局范围内，您就可以返回：

```
&(*iterator) 
```

我会提醒你，这通常是非常危险的。如果您的向量曾经移出全局范围并被破坏，则任何指向 myObject 的指针都将变为无效。如果您将这些函数编写为较大项目的一部分，则返回非常量指针可能会导致某人删除返回值。这将对应用程序产生不确定的和灾难性的影响。

我将其重写为：

```
myObject myFunction(const vector<myObject>& objects)
{
    // find the object in question and return a copy
    return *iterator;
} 
```

如果您需要修改返回的 myObject，请将您的值存储为指针并在堆上分配它们：

```
myObject* myFunction(const vector<myObject*>& objects)
{
    return *iterator;
} 
```

这样你就可以控制它们何时被破坏。

这样的事情会破坏你的应用程序：

```
g_vector<tmpClass> myVector;

    tmpClass t;
    t.i = 30;
    myVector.push_back(t);

    // my function returns a pointer to a value in myVector
    std::auto_ptr<tmpClass> t2(myFunction()); 
```

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:02:46.197

说，您有以下内容：

```
std::vector<myObject>::const_iterator first = vObj.begin(); 
```

那么向量中的第一个对象是：`*first`。要获取地址，请使用：`&(*first)`。

但是，为了与 STL 设计保持一致，如果您打算稍后将它传递给 STL 算法，我建议您返回一个迭代器。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T10:21:48.330

您将 myObject 的副本存储在向量中。所以我相信复制 myObject 的实例并不是一项昂贵的操作。然后我认为最安全的方法是从您的函数中返回 myObject 的副本。

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2014-09-05T20:29:25.880

参考 dirkgently 和 anon 的答案，您可以调用**front**函数而不是**begin**函数，因此您不必**编写**，`*`而只需编写`&`.

代码示例：

```
vector<myObject> vec; //You have a vector of your objects
myObject first = vec.front(); //returns reference, not iterator, to the first object in the vector so you had only to write the data type in the generic of your vector, i.e. myObject, and not all the iterator stuff and the vector again and :: of course
myObject* pointer_to_first_object = &first; //* between & and first is not there anymore, first is already the first object, not iterator to it. 
```

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2014-11-29T17:12:02.790

我不确定是否需要返回迭代器指向的东西的地址。您所需要的只是指针本身。您将看到 STL 的迭代器类本身为此目的实现了 _Ptr 的使用。因此，只需执行以下操作：

```
return iterator._Ptr; 
```

# java - 在 Eclipse RCP 应用程序中捕获终止信号

> ID：641866
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T08:55:30.363
> 
>         
> 
> 标签：java, linux, command-line, eclipse-rcp, signals

我有一个 Eclipse RCP GUI 应用程序的命令行版本，它可以使用许多相同的插件（这对于集成测试很方便）。它所做的一件事是连接到服务器，请求内容并启动交互式循环。要退出，GUI 应用程序的用户可以停止循环并关闭应用程序。

在我的命令行应用程序中，“关闭”应用程序最明显的方法是 CTRL-C！但是，如果我可以捕获退出信号，这会在服务器上留下可以清理的“会话垃圾”。杂物最终会超时或其他什么，但如果我也能把它清理干净就好了。

那么，我有哪些选择可以从 Eclipse RCP 应用程序中捕获终止信号？如果有帮助，这是特定于 Linux 的。但我不加载任何 SWT 插件。当我 ctrl-c 命令行时，不会调用我的“主循环”Plugin.stop()。像 Python 的 KeyboardInterrupt 这样的东西会是王牌！

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T09:09:22.140

我找到了另一种方法 - 添加一个在结束时运行的关闭挂钩......

```
 Runtime.getRuntime().addShutdownHook(new Thread() {
        public void run() {
            System.out.println("The end.");
        }
    }); 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T09:01:36.823

看看 bash 的`trap`内置函数。CTRL-C 的信号是 SIGINT，但您可能还想捕获 SIGTERM 和 SIGHUP。

# app-config - app.config 加密

> ID：641875
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T08:58:53.240
> 
>         
> 
> 标签：app-config, encryption

我正在点网中开发一个 Windows 应用程序。它的配置文件包含敏感数据，例如 sql pass..所以在部署应用程序时，我想将其加密。我用谷歌搜索了一下，找到了一个 Rsiprovider 来加密字段。但是加密是特定于机器的，需要以明文模式部署配置文件，并且在第一次运行程序后，加密在运行机器上成功。有没有办法将配置文件部署为加密？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T09:13:50.553

想一想 - 如果您在发货前加密，您还必须在某处提供密钥。然后问题转移到如何隐藏那个键......

设置后加密旨在隐藏配置以防窥探。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2011-05-22T20:38:29.243

这个[链接](http://www.codeproject.com/KB/security/encryptstrings.aspx)帮助我制作了一个加密的配置文件。其他解决方案的问题在于它们是特定于机器的，因此如果您对 .config 进行加密，则无法在另一台机器上对其进行解密（当您将应用程序部署到多台机器时不太可行）

# c# - 如何区分同一对象的两个版本？

> ID：641876
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-03-13T08:58:53.443
> 
>         
> 
> 标签：c#, comparison, object, diff, hierarchy

我想比较两个不同版本的对象并在 UI 中显示它们的差异。

首先我调用一个方法来知道两个对象之间是否有任何区别

方法是：

```
public bool AreEqual(object object1,object object2, Type comparisionType) 
```

如果上述方法返回 true，我调用该`GetDifferences`方法来获取差异，即：

```
public ObjectDifference[] GetObjectDifferences(object object1, object object2, Type comparisionType)
{
  ArrayList memberList = new ArrayList();
  ArrayList differences = new ArrayList();

  memberList.AddRange(comparisionType.GetProperties());
  memberList.AddRange(comparisionType.GetFields());

  for (int loopCount = 0; loopCount < memberList.Count; loopCount++)
  {
    object objVal1 = null;
    object objVal2 = null;
    MemberInfo member = ((MemberInfo)memberList[loopCount]);
    switch (((MemberInfo)memberList[loopCount]).MemberType)
    {
      case MemberTypes.Field:
        objVal1 = object1 != null ? ((FieldInfo)memberList[loopCount]).GetValue(object1) : null;
        objVal2 = object2 != null ? ((FieldInfo)memberList[loopCount]).GetValue(object2) : null;
        break;
      case MemberTypes.Property:

        objVal1 = object1 != null ? ((PropertyInfo)memberList[loopCount]).GetValue(object1, null) : null;
        objVal2 = object2 != null ? ((PropertyInfo)memberList[loopCount]).GetValue(object2, null) : null;
        break;
      default:
        break;
    }

    if (AreValuesDifferentForNull(objVal1, objVal2))
    {
      ObjectDifference obj = new ObjectDifference(objVal1, objVal2, member, member.Name);
      differences.Add(obj);
    }
    else if (AreValuesDifferentForPrimitives(objVal1, objVal2))
    {
      ObjectDifference obj = new ObjectDifference(objVal1, objVal2, member, member.Name);
      differences.Add(obj);
    }
    else if (AreValuesDifferentForList(objVal1, objVal2))
    {
      ObjectDifference[] listDifference = GetListDifferences((ICollection)objVal1, (ICollection)objVal2, member);
      differences.AddRange(listDifference);
    }
    else if ((!AreValuesEqual(objVal1, objVal2)) && (objVal1 != null || objVal2 != null))
    {
      ObjectDifference obj = new ObjectDifference(objVal1, objVal2, member, member.Name);
      differences.Add(obj);
    }
  }
  return (ObjectDifference[])differences.ToArray(typeof(ObjectDifference));
}

public class ObjectDifference
{
  private readonly object objectValue1;
  private readonly object objectValue2;
  private readonly System.Reflection.MemberInfo member;
  private readonly string description;

  public object ObjectValue1
  {
    get { return objectValue1; }
  }
  public object ObjectValue2
  {
    get { return objectValue2; }
  }
  public System.Reflection.MemberInfo Member
  {
    get { return member; }
  }
  public string Description
  {
    get { return description; }
  }

  public ObjectDifference(object objVal1, object objVal2, System.Reflection.MemberInfo member, string description)
  {
    this.objectValue1 = objVal1;
    this.objectValue2 = objVal2;
    this.member = member;
    this.description = description;
  }
} 
```

对于每个差异，我创建一个 ObjectDifference 类型的对象并将其添加到数组中。突出显示的部分是我被卡住的部分！如果对象包含另一个复杂对象，我的程序确实给了我差异，但我不知道它属于哪种类型

例如，我有两个名称类型的对象

```
class Name
{
  string firstName, LastName;
  List phNumber;
}

class PhoneNumber
{
  string officeNo, MobileNo, HomeNo;
} 
```

在比较两个对象时，我得到的输出很简单 -

*   `firstname`- 约翰玛丽

*   `LastName`- 库珀洛尔

*   `officeNo`- 22222 44444

*   `MobileNo`- 989898 089089

*   `HomeNo`- 4242 43535

`officeNo`类型的层次结构`PhoneNumber`丢失了，这对我来说很重要。

我应该如何在创建差异的同时维护这种类型的树？希望我能够理解我的问题。

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T09:09:05.260

你试图做和展示的东西本质上是复杂的。我过去曾这样做过（对于基于 diffgram/delta 的进程），甚至尝试以简单**友好的方式***显示*嵌套更改也很棘手。

 **如果它适合您的用户群，一种选择可能是将两个图简单地序列化为 xml，并使用类似[xml diff](http://msdn.microsoft.com/en-us/library/aa302294.aspx)的东西。

# sql-server-2005 - SQL Server 2005 上的 T-SQL 帮助

> ID：641880
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T09:01:18.337
> 
>         
> 
> 标签：sql-server-2005, tsql, select

我有一个在下面工作的 T-SQL：

```
 SELECT WP_VTDID AS UTIL_VTDID, 
(SELECT COUNT(WP_ENGINE) FROM WAYPOINTS WHERE (WP_ENGINE = 1) AND (WP_SPEED > 0) AND WP_VTDID='L083') AS UTIL_RUN,
(SELECT COUNT(WP_ENGINE) FROM WAYPOINTS WHERE (WP_ENGINE = 1) AND (WP_SPEED = 0) AND WP_VTDID='L083') AS UTIL_IDLE,
(SELECT COUNT(WP_ENGINE) FROM WAYPOINTS WHERE (WP_ENGINE = 0) AND WP_VTDID='L083') AS UTIL_OFF
FROM WAYPOINTS
WHERE WP_VTDID = 'L083' AND WP_DATETIME BETWEEN '2009-03-13 00:00:00' AND '2009-03-13 23:59:59'
GROUP BY WP_VTDID 
```

但是我有多个**WP_VTDID**值并且我想获取所有数据，有人可以创建一个适用于多个值的 T-SQL 命令吗？（数据库中已有值）

PS：暂时忽略WP_DATETIME
**所以**

结果可能是这样的：

```
---------------------------------
| UTIL_VTDID | 运行 | 空闲 | 关闭 |
---------------------------------
| L083 | 100 | 20 | 0 |
| L084 | 200 | 50 | 10 |
| L085 | 60 | 30 | 50 |
| L086 | 0 | 0 | 100 |
---------------------------------

```

* * *

找到解决方案，感谢**Jakob Christensen**

```
 SELECT WP_VTDID AS UTIL_VTDID, 
(SELECT COUNT(WP_ENGINE) FROM WAYPOINTS WHERE (WP_ENGINE = 1) AND (WP_SPEED > 0) AND WP_VTDID=t.WP_VTDID) AS UTIL_RUN,
(SELECT COUNT(WP_ENGINE) FROM WAYPOINTS WHERE (WP_ENGINE = 1) AND (WP_SPEED = 0) AND WP_VTDID=t.WP_VTDID) AS UTIL_IDLE,
(SELECT COUNT(WP_ENGINE) FROM WAYPOINTS WHERE (WP_ENGINE = 0) AND WP_VTDID=t.WP_VTDID) AS UTIL_OFF
FROM WAYPOINTS t
WHERE WP_DATETIME BETWEEN '2009-03-13 00:00:00' AND '2009-03-13 23:59:59'
GROUP BY WP_VTDID 
```

谢谢，

德尔斯

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T09:14:47.540

您想在航点表上加入嵌套的 SQL 语句。

这是未经测试的，但看看我在这里做了什么：

```
SELECT 
     WAYPOINTS.WP_VTDID AS UTIL_VTDID, 
     COUNT(UTIL_RUN.WP_ENGINE) AS UTIL_RUN
FROM WAYPOINTS
JOIN WAYPOINTS  UTIL_RUN ON
    WAYPOINTS.PKEY=UTIL_RUN.PKEY
AND (UTIL_RUN.WP_ENGINE = 1) AND (UTIL_RUN.WP_SPEED > 0)
WHERE WAYPOINTS.WP_DATETIME BETWEEN '2009-03-13 00:00:00' AND '2009-03-13 23:59:59'
GROUP BY WAYPOINTS.WP_VTDID 
```

只需加入其他价值观。

并将 pkey 替换为您的主键字段。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T09:17:05.320

这可以解决问题：

```
SELECT DISTINCT
WP_VTDID AS UTIL_VTDID, 
(
    SELECT COUNT(WP_ENGINE) 
    FROM WAYPOINTS 
    WHERE (WP_ENGINE = 1) 
    AND (WP_SPEED > 0) 
    AND WP_VTDID = t.WP_VTDID
) AS UTIL_RUN,
(
    SELECT COUNT(WP_ENGINE) 
    FROM WAYPOINTS 
    WHERE (WP_ENGINE = 1) 
    AND (WP_SPEED = 0) 
    AND WP_VTDID = t.WP_VTDID
) AS UTIL_IDLE,
(
    SELECT COUNT(WP_ENGINE) 
    FROM WAYPOINTS 
    WHERE (WP_ENGINE = 0) 
    AND WP_VTDID = t.WP_VTDID
) AS UTIL_OFF
FROM WAYPOINTS t 
```

# php - 调用存储过程后从 php 访问 LAST_INSERT_ID()

> ID：641893
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T09:10:59.810
> 
>         
> 
> 标签：php, mysql, stored-procedures

我在 mysql 中定义了一个存储过程（我们称之为*proc_create_node(parent INT)*），它进行插入。

当我从 mysql cli 调用它时，执行以下操作就可以了：

```
CALL proc_create_node(12);
SELECT LAST_INSERT_ID(); 
```

我得到最后插入的 id：

```
+------------------+
| LAST_INSERT_ID() |
+------------------+
|               15 | 
+------------------+ 
```

现在，当我从 php 调用这些行，或者如果我使用*mysql_insert_id()* php 函数时，我总是返回*0*。

我错过了什么？我怎样才能在 php 中获得最后插入的 id？

你的……皮埃尔

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-15T11:52:36.017

Check out the usage of mysqli_multy_query here: [http://ua.php.net/manual/en/mysqli.multi-query.php](http://ua.php.net/manual/en/mysqli.multi-query.php)

This function is designed to work with multi-statement queries like yours. But to use that you need to work through php_mysqli module and not through php_mysql which is not simple if you support old application.

Second - you can put SELECT LAST_INSERT_ID() in to your stored procedure and receive it in execution result.

Both ways are worth to try but second one is much simple and works with php_mysql.

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T11:11:52.250

它在这里工作：

```
$link = mysql_connect('localhost', 'root', '');
if (!$link) {
   die('Not connected : ' . mysql_error());
}

$db_selected = mysql_select_db('test', $link);
if (!$db_selected) {
   die ('Can\'t use test : ' . mysql_error());
}
$result = mysql_query('CALL blub(12)');
if (!$result) {
   die('Invalid query: ' . mysql_error());
}
$result = mysql_query('SELECT LAST_INSERT_ID()');
if (!$result) {
   die('Invalid query: ' . mysql_error());
}

print_r(mysql_fetch_assoc($result)); 
```

打印一个递增的整数。mysql 5.1.30 和 php 5.2.9-1。

所以问题一定出在您的 php 代码中，在您的存储过程中（您是否从 php 传递有效参数？）或在您的 php 或 mysql 版本中（恰好有很多错误）。

顺便说一句：替换`SELECT LAST_INSERT_ID()`在`mysql_insert_id()`这里*不起作用*。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T11:30:33.453

这可能与数据库连接有关 - LAST_INSERT_ID() 函数不是在每个连接的基础上工作吗？

您认为将 SELECT LAST_INSERT_ID() 添加到存储过程中并修改存储过程以返回所述 ID 是否是个好主意？

# shell - 调用 MSXML2::IXMLDOMDocumentPtr -> Release() 时 Internet Explorer 崩溃

> ID：641896
> 
>         
> 
> 赞同：-1
> 
>         
> 
> 时间：2009-03-13T09:12:18.920
> 
>         
> 
> 标签：shell, atl

我正在使用 Visual Studio 2008 在 C++ (ATL 9) 中创建一个外壳扩展。外壳扩展在模块类中创建一个全局 MSXML2::IXMLDOMDocumentPtr 对象 m_XmlDoc。然后所有类在扩展中使用这个 m_XmlDoc 来读取 xml 文档。

我面临的问题是 Internet Explorer。当 Shell 扩展处于活动状态并且我打开/关闭 Internet Explorer 时，我得到一个调试对话框并且 IE 崩溃。错误消息显示“iexplore.exe 中 0x6aac30f1 处的未处理异常：0xC0000005：访问冲突读取位置 0x03050970。” 当我在消息窗口上单击“中断”时，它会将我带到 COM 智能指针的“释放”方法，错误似乎在 m_pInterface->Release();

此调用是从 Module 的析构函数进行的，并且 m_pInterface 的值也不为 NULL。我想也许 Internet Explorer 正在使用 XML DOM，并且对 Release 的调用会在其中产生一些问题。

```
MSXML2::IXMLDOMDocumentPtr m_XmlDoc;

In _AtlModule.Init() method
    ::CoInitialize(NULL);
    m_XmlDoc.CreateInstance(MSXML2::CLSID_DOMDocument40); 
```

dll主要代码：

```
extern "C" BOOL WINAPI DllMain(HINSTANCE hInstance, DWORD dwReason, LPVOID lpReserved)
{
    ::CoInitialize(NULL);
    if (dwReason == DLL_PROCESS_ATTACH)
    {
        _AtlModule.Init();  
        CreateImageLists();
        ::DisableThreadLibraryCalls(hInstance);
    }

    hInstance;
    return _AtlModule.DllMain(dwReason, lpReserved); 
} 
```

* * *

## 回答 #1

> 赞同：0
> 
>             
> 
> 时间：2009-03-15T01:03:00.977

不鼓励使用 DisableThreadLibraryCalls，你看到了吗？

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-20T16:40:03.210

您发布的代码至少存在两个问题：

1.  您在 DllMain 中调用 CoInitialize。

2.  您正在 DllMain 中创建一个 COM 对象。

3.  如果你在 CreateImageLists() 中做一些你也不应该在 DllMain 中做的事情，我不会感到惊讶。

此外，通过不使用智能指针来“修复”您的崩溃的原因是因为现在您实际上不再释放对象了。您的代码已损坏，并且不发布引用不是解决任何问题的有效方法。

我建议您阅读，然后重新阅读[DllMain](http://msdn.microsoft.com/en-us/library/ms682583.aspx)的文档，特别注意在函数实现中您不应该做的事情。正如您将在前面看到的：

> **警告**  您可以在 DLL 入口点执行的操作受到严格限制。要提供更复杂的初始化，请为 DLL 创建一个初始化例程。您可以要求应用程序在调用 DLL 中的任何其他例程之前调用初始化例程。

我怀疑一旦你阅读它，并修复你的代码以在有效时间创建 COM 对象，并在有效时间释放它，你的 shell 扩展将停止崩溃。

* * *

## 回答 #3

> 赞同：-1
> 
>             
> 
> 时间：2009-03-16T06:11:56.060

问题是因为用于 XmlDomDocument 的 COM 智能指针。我将其更改为普通指针，即使在 Vista 中也可以正常工作。

此问题在 XP 和 Vista 中具有不同的行为。在 XP 中，当我关闭 Internet Explorer 时，我遇到了一个未处理的异常。在 Vista 中，我无法浏览虚拟驱动器。

# java - 如何确保 N 个线程以大致相同的速度运行？

> ID：641906
> 
>         
> 
> 赞同：15
> 
>         
> 
> 时间：2009-03-13T09:15:52.933
> 
>         
> 
> 标签：java, multithreading, join, erlang, simulation

我正在考虑编写一个物理模拟软件，其中每个物理元素都将在其自己的线程中进行模拟。

这种方法有几个优点。它在概念上将非常接近现实世界的运作方式。将系统扩展到多台机器会容易得多。

但是，要使其正常工作，我需要确保所有线程都以相同的速度运行，并对“相同”进行相当自由的解释。说在彼此的 1% 以内。

这就是为什么我不一定需要类似 Thread.join() 的解决方案。我不想要一些超级控制的学校情妇来确保所有线程定期相互同步。我只需要能够要求运行时（无论它是什么——可能是 Java、Erlang 或最适合这个问题的任何东西）以或多或少相等的速度运行线程。

任何建议将不胜感激。

**更新 2009-03-16**

我要感谢所有回答这个问题的人，特别是那些回答基本上是“不要这样做”的人。由于大家的评论，我现在更好地理解了我的问题，我不太确定我应该按照最初的计划继续。尽管如此，我觉得彼得的回答是对问题本身的最佳回答，这就是我接受它的原因。

* * *

## 回答 #1

> 赞同：13
> 
>             
> 
> 时间：2009-03-13T09:19:29.243

如果没有协调，你就无法真正做到这一点。如果一个元素最终需要比另一个元素更便宜的计算（以一种可能不明显的方式）怎么办？

你不一定需要一个超级控制器——你可以只为每个线程保留某种计步器，并有一个全局计数器来指示“最慢”线程。（当每个线程都完成了一些工作时，它必须检查它是否落后于其他线程，如果是，则更新计数器。）如果一个线程注意到它比最慢的线程有很长的路要走，它可以简单地等待（可能在显示器上）。

只是经常这样做，以避免由于共享数据争用而产生过多的开销，我认为它可以很好地工作。

* * *

## 回答 #2

> 赞同：12
> 
>             
> 
> 时间：2009-03-13T11:06:16.600

你需要某种同步。[CyclicBarrier](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/CyclicBarrier.html)类有你需要的：

> 一种同步辅助工具，它允许一组线程相互等待以达到共同的障碍点。CyclicBarriers 在涉及固定大小的线程组的程序中很有用，这些线程组必须偶尔相互等待。屏障被称为循环的，因为它可以在等待线程被释放后重新使用。

在每个“滴答”之后，您可以让所有线程等待其他线程，这会更慢。当剩余的线程到达屏障时，它们都会继续。

* * *

## 回答 #3

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T09:22:04.870

线程意味着完全独立地运行，这意味着以任何方式同步它们总是很痛苦的。在您的情况下，您需要一个中央“时钟”，因为没有办法告诉虚拟机每个线程应该获得相同数量的......呃......它应该得到什么？相同数量的RAM？可能没关系。相同数量的CPU？您的所有对象是否都非常相似，以至于每个对象都需要相同数量的汇编指令？

所以我的建议是使用一个中央时钟向每个进程广播时钟滴答。每个进程中的所有线程都读取滴答声（应该是绝对的），计算与他们看到的最后一个滴答声的差异，然后相应地更新其内部模型。

当一个线程完成更新时，它必须让自己进入睡眠状态；等待下一个滴答声。在 Java 中，在“tick received”锁上使用 wait() 并使用“notifyAll()”唤醒所有线程。

* * *

## 回答 #4

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T10:40:23.323

我建议尽可能不要使用线程，因为如果您不小心，它们只会在以后添加问题。在进行物理模拟时，您可以使用数十万个离散对象进行更大的模拟。你不可能在我知道的任何操作系统上创建这么多线程，即使你可以，它也会像狗屎一样运行！

在您的情况下，您可以创建多个线程，并在每个线程中放置一个事件循环。“主”线程可以对执行进行排序并向每个工作线程发布“进程”事件以唤醒它并使其完成一些工作。这样，线程将休眠，直到您告诉它们工作。

您应该能够让主线程以允许所有工作线程在下一次滴答之前完成的速率进行滴答。

我不认为线程是您问题的答案，除了并行化成少量工作线程（等于机器中的内核数），每个线程对一系列物理对象进行线性排序。您仍然可以以这种方式使用主/事件驱动的方法，但您会消除很多开销。

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T10:02:15.227

请不要。线程是一种允许并行执行外观的 O/S 抽象。对于多核和多核 CPU，O/S 可以（但不必）在不同的核之间分配线程。

我认为最可行的可扩展性愿景是使用工作线程，其尺寸与您拥有的内核数量大致匹配，并在它们之间分配工作。一个粗略的草案：定义一个类 ActionTick 来更新一个粒子，并让工作线程从一个共享队列中选择 ActionTicks 来处理。即使有这样的解决方案，我也看到了一些挑战。

1.  线程开销：您会在不同的工作线程之间获得上下文切换开销。线程本身很昂贵（如果实际上不像进程那样具有破坏性）：使用不同的线程池大小测试性能。在内核数量之外添加更多线程往往会降低性能！

2.  同步成本：你会遇到几个竞争点：一个人访问工作队列，但更糟糕的是，访问模拟世界。您需要界定每个 ActionTick 的效果或实施大量锁定/解锁。

3.  优化物理的困难。您想要界定每个 ActionTick 所查看的对象/粒子的数量（距离截断？模拟空间的 3D 树细分？）。根据模拟领域的不同，您可以通过检查项目子集中是否需要任何更改来消除大量工作。在对工作项进行排队之前进行这些优化更容易，而不是作为分布式算法。但是，您的模拟的那部分成为潜在的可扩展性瓶颈。

4.  复杂。线程和并发在解决方案中引入了几罐蠕虫。始终首先考虑其他选项——但如果您需要它们，请在创建自己的工作项调度、锁定和执行策略之前尝试线程......

警告：我没有使用过任何大型模拟软件，只是一些业余爱好者的代码。

* * *

## 回答 #6

> 赞同：3
> 
>             
> 
> 时间：2009-04-07T14:38:04.083

正如您所提到的，有很多“不要这样做”的答案。大多数似乎将线程读取为 Java 使用的操作系统线程。既然您在帖子中提到了 Erlang，我想发布一个更以 Erlang 为中心的答案。

使用进程（或参与者、微线程、绿色线程，有时称为）对这种模拟进行建模并不一定需要任何同步。从本质上讲，我们有几个（很可能是数千或数十万）需要模拟的物理对象。我们希望尽可能逼真地模拟这些对象，但可能还涉及某种实时方面（但不一定，您在问题中没有提到这一点）。

一个简单的解决方案是为每个对象生成一个 Erlang 进程，向所有对象发送刻度，并在继续下一个刻度之前收集模拟结果。这实际上是同步所有内容。当然，它更多的是确定性解决方案，并且不保证任何实时属性。进程如何相互通信以获取计算所需的数据也很重要。您可能需要以巧妙的方式对它们进行分组（碰撞组等），为休眠对象设置休眠进程（Erlang 对此有很好的支持）等以加快速度。

要获得实时属性，您可能需要限制流程执行的计算（以交易准确性换取速度）。这也许可以通过在*不*等待答案的情况下发送滴答声来完成，并让对象进程使用它们当前的位置和您需要的其他数据回复每个滴答声（即使它可能只是当时的近似值）。正如[DJClayworth](https://stackoverflow.com/users/19276/djclayworth)所说，这可能会导致模拟中累积错误。

*我想从某种意义上说，问题实际上是关于是否有可能利用并发的力量在这里获得某种优势*。如果您需要同步，这是一个非常强烈的信号，表明您不需要每个物理对象之间的并发。因为您基本上通过等待其他进程来浪费大量计算时间。您可能会在计算过程中使用并发，但我认为这是另一个讨论。

**注意：**这些想法都没有考虑到实际的物理计算。这不是 Erlang 的强项，也许可以在 C 库或任何你喜欢的东西中执行，具体取决于你想要的特征类型。

**注意：**我不知道任何情况下已经这样做了（尤其是不是我），所以我不能保证这是合理的建议。

* * *

## 回答 #7

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T11:50:08.603

即使有完美的软件，硬件也会阻止你这样做。硬件线程通常没有公平的性能。在很短的时间内，如果线程在 +-10% 的性能范围内运行，你就很幸运了。

当然，这些是异常值。一些芯片组将在省电模式下运行一些内核，而另一些则不会。我相信其中一台 Blue Gene 研究机器具有硬件线程的软件控制调度而不是锁。

* * *

## 回答 #8

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T13:59:42.597

默认情况下，Erlang 会尝试将其进程均匀地分布在可用线程上。默认情况下，它还将尝试在所有可用处理器上运行线程。因此，如果您有足够多的可运行 Erlang 进程，那么您将获得相对均衡的平衡。

* * *

## 回答 #9

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T09:19:03.847

我不是线程专家，但线程的全部意义不是它们彼此独立 - 并且是不确定的吗？

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T09:26:56.997

我认为你对你说的问题有一个基本的误解：

> 从概念上讲，它将非常接近现实世界的运作方式

现实世界根本不会以类似线程的方式工作。大多数机器中的线程*不是独立*的，实际上甚至不是同时的（`OS`将使用上下文切换）。当有很多`IO`或等待发生时，它们提供最大的价值。

最重要的是，随着更复杂的事情发生，现实世界不会“消耗更多资源”。想一想两个物体从高处落下的区别，一个平稳落下，另一个执行某种复杂的翻滚运动……

* * *

## 回答 #11

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T11:20:33.133

我会制作一种“时钟生成器”——并在那里注册每个新对象/线程。当 delta-t 过去时，时钟将通知所有已注册的对象。但是，这并不意味着您需要为每个对象使用单独的线程。理想情况下，您将拥有与处理器一样多的线程。从您的设计角度来看，您可以通过 Executor 或线程池将对象任务的执行分开，例如，当对象接收到滴答事件时，它会进入线程池并自行安排执行。

* * *

## 回答 #12

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:21:23.780

为了实现这一目标，必须发生两件事。您必须确保每个 CPU 核心拥有相同数量的线程，并且您需要某种同步。

这种同步可能相当简单，例如在执行计算时检查每个线程的“循环完成”变量，但您无法避免它。

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T12:13:34.350

在控制电机工作时，我使用了一些数学来将速度保持在稳定状态。该系统具有PID控制、比例、积分和微分。但这是模拟/数字系统。也许可以类似地使用来确定每个线程必须运行多长时间，但我能给你的最大提示是所有线程都将有一个时钟同步。

* * *

## 回答 #14

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T16:02:35.390

我首先要承认我不是线程专家，但这听起来是一种非常错误的模拟方式。正如其他人已经评论过的那样，拥有太多线程在计算上是昂贵的。此外，如果您打算做我认为您正在考虑做的事情，您的模拟可能会产生随机结果（如果您正在制作游戏，则可能无关紧要）。

我会使用一些用于计算模拟的离散步骤的工作线程。

# iphone - iphone内存管理问题

> ID：641908
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T09:16:45.443
> 
>         
> 
> 标签：iphone, objective-c, memory, memory-management

如何检查对象是否已从内存中释放？

我知道当我们使用 alloc|copy|retain 创建该对象时，必须手动释放该对象。如果使用实例类方法（`NSString stringwithformat:`），对象会被自动释放，但是，有时那里的函数会有`NSAutoRealeasePool`一些对象用于释放。`(void)dealloc`

谁能告诉我

1.  在`[object release]`alloc 函数之后立即释放对象有什么区别？`[object release]``(void)dealloc``NSAutoReleasePool`

2.  什么时候`(void)dealloc`调用函数，什么时候`NSAutoReleasePool`释放内存，我知道这是每个循环周期，我如何从代码中检查它？

3.  当我在标题中声明一个变量并将属性设置为保留时，我仍然可以对该对象使用分配函数但不会导致内存泄漏，但从[这篇文章](https://stackoverflow.com/questions/612986/why-does-this-create-a-memory-leak-iphone)看来，一旦在标题中声明了一个保留对象，那么你就没有更长的时间可以分配对象，因为两者都会保留对象，谁能告诉我为什么我仍然可以这样编码而不会导致任何内存泄漏？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2009-03-13T14:32:36.870

1.  `[object release]`立即释放您的对象。发送释放消息后，您不应该再次使用该对象 - 除非您绝对知道您仍然对该对象有保留。如果您的保留是最后一个保留，则可以在调用释放期间释放内存。自动释放“稍后”释放一个对象，系统不保证“稍后”的含义，除了它将在当前消息的范围之后。

2.  见上文，从代码的角度来看，在 autorelease 之后调用 dealloc 时，没有真正的 qay 可以保证。您应该假设它是在您发送自动释放消息的方法返回之后的某个时间。

3.  您只需要平衡保留和释放。如果您有一对多（在您描述的情况下很可能），那就是泄漏。相反，如果您有其他方式的不平衡，当您访问已释放的内存时，您将产生更具破坏性的错误。

保留属性的正确顺序是：

1.  `alloc init           // retain == 1`

2.  `set the property     // retain == 2 due to setProperty calling retain.`

3.  `release the object   // retain == 1`

保留计数为 1，没有内存泄漏。

# tdd - 测试驱动开发是要走的路。但是应该怎么做呢？

> ID：641911
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T09:18:08.983
> 
>         
> 
> 标签：tdd

[许多开发人员正在使用测试驱动开发](http://en.wikipedia.org/wiki/Test_Driven_Development)(TDD)设计他们的应用程序，但我想知道应该在哪个阶段将 TDD 合并到我的项目中？我应该先设计我的类，做一些单元测试并确定需要哪些方法，还是先设计方法，然后再做一些单元测试？

解决此问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：19
> 
>             
> 
> 时间：2009-03-20T20:59:21.480

TDD 是一种编码和小型设计技术。这不是一种宏观的构想技术。如果你开始编写一个应用程序，你会想做一些故事板、线框图，甚至是一些简单的草图。您应该对更大规模的设计（即系统中的类和关系）有所了解。在您开始进行交互设计（例如方法和参数）之前，您开始进行TDD。  

您所做的线框将使您*了解*系统应该如何显示。大规模设计将使您了解要创建哪些类。然而，这些模型都不应该被认为是正确的或永久的。在编写测试时，您会发现更好的设计理念，这些理念将改变您的高级设计，甚至您的线框设计。  

* * *

## 回答 #2

> 赞同：18
> 
>             
> 
> 时间：2009-03-13T09:21:08.367

测试驱动的重点*是*测试驱动设计和实现。

在某些情况下这是不合适的——设计应该是什么样子的可能很明显，特别是如果它正在实现一个现有的接口（或一些类似的受限选择），但是当你有一个很大的“设计空间”时，TDD 鼓励你写测试演示您希望如何*使用*该类，而不是从您认为如何*实现*它开始。

通常，如果某些东西易于测试，它就会易于使用。

* * *

## 回答 #3

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T09:24:04.647

测试驱动设计的口头禅：

*   创建测试。

*   编译测试（并验证它是否失败）

*   写界面

*   编译测试（现在应该编译）

*   运行测试（现在应该失败）

*   写代码

*   编译/运行测试（现在应该两者都做）

对每个项目重复。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T11:27:31.480

我对在实现之前编写单元测试持怀疑态度。如果您对所需的类和方法的确切设计有一个很好的想法，但通常在新项目开始时您不知道，这可能会很有效。

我更喜欢的方法是承认一个新项目的开始可能有点混乱。设计过程的一部分是编写代码来验证某些想法或找到最佳方法。很多时候代码会遇到死胡同并被丢弃，为它编写的任何单元测试都是浪费时间。

不要误会我的意思，我完全支持精心设计的软件，并且在某一点上，有组织的混乱转变为易于理解的设计是至关重要的。那时，类结构和 UML 图开始固化。这就是 TDD 对我来说很重要的一点。每个班级都应该能够单独进行测试。如果设计是好的，具有适当程度的解耦，通常在该位置周围撒一些模拟对象很容易实现。如果设计不好，测试将成为一场真正的噩梦，因此会被忽略。

归根结底，您需要的是高质量的生产代码。单元测试是帮助实现这一目标的最佳工具之一，但它们不应该独立存在，并且变得比它们正在测试的代码更重要，你有时会从 TDD 的口头禅中感受到这种感觉。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T11:52:24.057

**从小处着手**

a) 下次向 Utility 类添加方法时，首先为该方法编写测试。进行字符串处理的方法是一个很好的起点，因为它们往往有很多错误，但不需要复杂的数据集来测试它们。

b) 然后，一旦您对编写单元测试有信心，请继续使用不涉及 UI 并且不直接或间接与数据库对话的类。

c) 然后您必须决定是否设计您的应用程序以使单元测试更容易。例如

*   很难测试 UI 代码，所以看看 MVP 等，  

*   它是测试访问数据库的代码的头，因此将您的逻辑分成不需要访问数据库即可运行的方法。

a) 和 b) 有很大的回报，而无需改变您设计整个系统的方式。您必须考虑 c) 是否物有所值....（我认为是，但很多人不这样做，而且您通常无法控制整个系统设计。）

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2009-03-16T16:17:11.660

理想情况下，您将在开始编码时开始应用 TDD。**先想想**你的设计，你可以在纸上画图；无需使用 CASE 工具，只需设想主要类及其交互，选择一个，编写第一个简单测试，编写代码使其通过，编写另一个测试，使其通过，重构......

如果您的流程要求在编码阶段之前记录和审查设计，那么您就不能遵循 TDD 并让您的设计浮出水面。但是，您可以先进行设计，然后先进行实施测试。您将像应用 TDD 一样获得单元测试，但仍应用您的流程。

让你的设计尽可能的高层次，这样你就可以让设计的低层次细节浮出水面。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:21:41.440

请看

[http://en.wikipedia.org/wiki/Test-driven_development](http://en.wikipedia.org/wiki/Test-driven_development)

他们提出了一个高水平的任务

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:28:52.560

TDD 确保开发人员与他们的业务逻辑相比，对测试用例给予同等重视。我在我的项目中遵循了它，我可以看到它的优点：因为我首先编写测试用例，所以我确保我的测试用例处理业务逻辑的所有可能覆盖范围，从而捕获/减少错误的数量。有时它不实用，因为它需要足够的时间来编写这些测试用例。底线是你需要对你的代码进行很好的单元测试。所以要么从实现开始，然后确保所有场景都有足够的测试用例（大多数人没有因此出现这种做法。）要么编写测试方法试运行，然后编写您的实现。只有当您的所有测试用例都成功通过时，您的实现才算完成。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:30:09.063

您应该收听堆栈溢出播客 41，他们在其中谈论 TTD。很难说每个人都在使用 TDD，要获得高代码覆盖率需要大量时间和资源。如果您为所有代码编写测试，单元测试可以有效地使开发时间加倍。

播客的要点之一是您的时间和资源可以更好地用于其他任务，例如可用性和新功能。

# testing - 假人的回归测试

> ID：641912
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T09:18:45.847
> 
>         
> 
> 标签：testing, qa, regression-testing

我希望在发布 Web 应用程序之前对其进行回归测试。

简而言之，我正在寻找可以执行以下操作的东西：

1.  使用 selenium 之类的东西通过网络浏览器记录测试

2.  将这些测试加载到应用程序中

3.  进行所需的逻辑/功能更改

4.  运行测试脚本

5.  查看测试状态（通过/失败）

6.  修复损坏的测试

7.  冲洗并重复

我想要一个具有最低编码技能的 QA 人员能够完成上述工作。这是对编码人员进行自己的较低级别回归和单元测试的补充。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T09:24:48.373

您可以使用 IBM 的 Rational Robot 工具来完成以上所有工作。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T10:22:07.130

我会看看

1.  [测试完成](http://www.automatedqa.com/products/testcomplete/)。商业工具。

2.  [自动车](http://www.autoitscript.com/autoit3/index.shtml)。自由的

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-07-25T02:17:44.510

[Selenium RC](http://seleniumhq.org/)确实适用于您所描述的内容。我能够使用[TestNG](http://testng.org/doc/documentation-main.html)来管理 Selenium 测试。既好又免费！

# eclipse - 哪个配置文件包含 Eclipse 工作区中所有项目的名称？

> ID：641919
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2009-03-13T09:21:39.270
> 
>         
> 
> 标签：eclipse

> **可能重复：**
> 
>   [项目列表存储在 Eclipse 工作区的什么位置？](https://stackoverflow.com/questions/251116/where-in-an-eclipse-workspace-is-the-list-of-projects-stored)

工作区文件夹中是否有任何配置文件，Eclipse 在其中存储了属于工作区的所有项目的列表？

* * *

## 回答 #1

> 赞同：17
> 
>             
> 
> 时间：2009-03-13T09:45:08.153

在我的 Eclipse 中，我可以在以下位置找到每个项目的文件夹：

```
.metadata/.plugins/org.eclipse.core.resources/ 
```

# c# - 使用属性公开类似数组的数据结构

> ID：641923
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T09:22:30.830
> 
>         
> 
> 标签：c#, data-structures, properties

将内部数据结构作为属性公开给您的业务类是典型的做法。但是当我们必须公开类似数组的结构（如 List<Rule> 规则）时，我们可能会遇到使用错误的问题（如选项 1 中）。

建议将此类数据结构的克隆公开为属性，以免内部结构受到干扰。

有没有人对此有很好的解决方案？

```
public class Rule 
{
}

public class RulesManager 
{
    List<Rule> rules = new List<Rule>();

    public List<Rule> Rules
    {
        get { return rules; }
        set { rules = value; }
    }

    public void Add(Rule r)
    {
        rules.Add(r);
        // Do something else after add;
    }

    public void Delete(Rule r) 
    {
        rules.Remove(r);
        // Do something else after delete;
    }
}
public class CallingCode 
{
    public static void Main() 
    {
        RulesManager r = new RulesManager();
        // Option 1            
        r.Rules.Add(new Rule());
        // Option 2 
        r.Add(new Rule());
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T09:27:37.103

您可以返回using`Clone`的只读版本，而不是返回 a 。`rules``rules.AsReadOnly()`

```
public IList<Rule> Rules
{
  get { return rules.AsReadOnly(); }
// set { rules = value; -- should not be allowed to set if read only!
} 
```

注意`IList`.

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:27:55.247

您可以返回 IEnumerable，而不是返回 List。IEnumerable 允许用户遍历集合，但不允许用户轻松修改它。

或者，您可以返回一个数组而不是列表。这将创建用户无法轻松修改的列表副本。

最后，您应该知道用户也可能会修改集合的内容。这可能是您想要的，但您可能还想退回您的物品的副本。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:29:22.137

我认为将 IList 作为属性公开是很常见的，但我更喜欢只公开显式的添加/删除函数。如果您正在开发更多的框架，您还可以考虑在您的类中实现一个集合接口（例如 IList）。

代替：

```
public List<Rule> Rules
{
    get { return rules; }
    set { rules = value; }
} 
```

我更喜欢在类上实现`IEnumerable<T>`一个索引器，这样我就可以控制列表发生的事情。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:29:22.327

查看[ReadOnlyCollection](http://msdn.microsoft.com/en-us/library/ms132474.aspx)和[AsReadOnly()](http://msdn.microsoft.com/en-us/library/e78dcd75.aspx) List 方法。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:29:59.280

一个基本的解决方法是使用`List<T>.AsReadOnly()`方法，它将列表包装在 ReadOnlyCollection 周围以阻止任何“写”访问。当然，您必须将 setter 设为私有，否则将没有意义......

另一种选择是实现您自己的 IList，它会在“写入”访问的情况下提醒您并允许您执行业务逻辑。

# sharepoint - 高级搜索选项以编程方式共享点搜索

> ID：641924
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T09:22:41.157
> 
>         
> 
> 标签：sharepoint, search, object, model

我正在使用目标代码模型从共享点搜索中检索搜索结果。任何人都可以建议我如何为我的搜索设置高级搜索选项。目标代码模型是否具有执行高级搜索的功能。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T10:48:36.910

[是的，您可以使用FullTextSqlQuery](http://msdn.microsoft.com/en-us/library/microsoft.office.server.search.query.fulltextsqlquery.aspx)类执行高级搜索，如下面的代码示例所示。另请参阅[最佳实践：为企业搜索中的相关结果编写 SQL 语法查询](http://msdn.microsoft.com/en-us/library/bb219479.aspx)。

```
using (SPSite site = new SPSite("http://server"))   // Site Collection URL
using (FullTextSqlQuery query = new FullTextSqlQuery(site))
{
  query.ResultTypes = ResultType.RelevantResults;
  query.EnableStemming = true;
  query.TrimDuplicates = true;
  query.Culture = new CultureInfo(1033);    // Use en-US stemmer and word-breaker
  query.RowLimit = 40;
  query.StartRow = 0;
  query.KeywordInclusion = KeywordInclusion.Allkeywords;   // Implicit AND search
  query.HighlightedSentenceCount = 3;
  query.SiteContext = new Uri("http://server");  // Site Collection URL
  query.QueryText = "SELECT WorkId, Title, Path, HitHighlightedSummary, HitHighlightedProperties, CollapsingStatus, Description, Rank, Size" +
                     " FROM SCOPE()" +
                     " WHERE \"scope\" = 'A Scope'" +
                     " AND FREETEXT(defaultproperties, 'keyword1 keyword2')" +
                     " AND Color = 'Black'" + // Color is a managed property
                     " ORDER BY Rank DESC";            

  ResultTableCollection results = query.Execute();
  ResultTable relevantResults = results[ResultType.RelevantResults];

  // TODO: Process results
}; 
```

# c# - linq 的 let 关键字是否比 into 关键字更好？

> ID：641931
> 
>         
> 
> 赞同：86
> 
>         
> 
> 时间：2009-03-13T09:25:38.667
> 
>         
> 
> 标签：c#, linq

我目前正在复习 LINQ 并试图理解 the`let`和 using`into`关键字之间的区别。到目前为止，就我的理解而言，`let`关键字似乎比关键字更好。`into`

关键字本质上允许人们在`into`投影后继续查询。（只是想明确说明我不是指加入群组的那个。）

给定一组名称，它允许执行以下操作：

```
var intoQuery =
  from n in names
  select Regex.Replace(n, "[aeiou]", "")
  into noVowel
  where noVowel.Length > 2
  select noVowel; 
```

它获取 select 的结果并将其放入`noVowel`变量中，然后允许引入额外`where`的`orderby`, 和`select`子句。`noVowel`创建变量后，该变量`n`将不再可用。

另一方面，`let`关键字使用临时匿名类型来允许您一次重用多个变量。

您可以执行以下操作：

```
var letQuery =
  from n in names
  let noVowel = Regex.Replace(n, "[aeiou]", "")
  where noVowel.Length > 2
  select noVowel; 
```

`noVowel`和变量都`n`可以使用（尽管在这种情况下我没有使用它）。

虽然我可以看到差异，但我不太明白为什么要使用`into`关键字而不是`let`关键字，除非明确希望确保以前的变量不能在查询的后半部分使用。

那么，这两个关键字都存在有充分的理由吗？

* * *

## 回答 #1

> 赞同：85
> 
>             
> 
> 时间：2009-03-13T09:30:41.650

是的，因为正如你所说，他们在做不同的事情。

`select ... into`有效地隔离整个一个查询，并让您将其用作新查询的输入。就个人而言，我*通常*更喜欢通过两个变量来做到这一点：

```
var tmp = from n in names
          select Regex.Replace(n, "[aeiou]", "");

var noVowels = from noVowel in tmp
               where noVowel.Length > 2
               select noVowel; 
```

（诚​​然，在这种情况下，我会在两行中使用点表示法，但忽略...）

通常，您不*希望*查询前面部分的全部包袱 -`select ... into`根据上面的示例，当您使用或将查询分成两部分时。这不仅意味着查询的早期部分在不应该使用的情况下不能使用，它还简化了正在发生的事情——当然这意味着每一步的复制可能会减少。

另一方面，当您*确实*想保留上下文的其余部分时，`let`更有意义。

* * *

## 回答 #2

> 赞同：44
> 
>             
> 
> 时间：2009-03-13T09:37:46.843

主要区别是`let`将变量注入上下文/范围，在其中`into`创建一个新的上下文/范围。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2017-05-05T22:04:42.587

想知道 DB 端的区别，写了 2 个实体框架查询。  

*   让  

    ```
    from u in Users
    let noVowel = u.FirstName.Replace("a","").Replace("e","").Replace("i","")
    where noVowel.Length >5
    select new {u.FirstName, noVowel} 
    ```

*   进入  

    ```
    from u in Users
    select u.FirstName.Replace("a","").Replace("e","").Replace("i","")
    into noVowel
    where noVowel.Length >5
    select noVowel 
    ```

生成的 SQL 几乎**相同**。SQL 并不完美，相同的字符串处理代码在 2 个地方（where 和 select）重复。

```
SELECT 1 AS [C1], [Extent1].[FirstName] AS [FirstName], 
REPLACE(REPLACE(REPLACE([Extent1].[FirstName], N'a', N''), N'e', N''), N'i', N'') AS [C2]
FROM [dbo].[User] AS [Extent1]
WHERE ( CAST(LEN(REPLACE(REPLACE(REPLACE([Extent1].[FirstName], N'a', N''), N'e', N''), N'i', N'')) AS int)) > 5
GO

SELECT 
REPLACE(REPLACE(REPLACE([Extent1].[FirstName], N'a', N''), N'e', N''), N'i', N'') AS [C1]
FROM [dbo].[User] AS [Extent1]
WHERE ( CAST(LEN(REPLACE(REPLACE(REPLACE([Extent1].[FirstName], N'a', N''), N'e', N''), N'i', N'')) AS int)) > 5 
```

这是LINQ-to-SQL生成的SQL

```
-- Region Parameters
DECLARE @p0 NVarChar(1000) = 'a'
DECLARE @p1 NVarChar(1000) = ''
DECLARE @p2 NVarChar(1000) = 'e'
DECLARE @p3 NVarChar(1000) = ''
DECLARE @p4 NVarChar(1000) = 'i'
DECLARE @p5 NVarChar(1000) = ''
DECLARE @p6 Int = 5
-- EndRegion
SELECT [t1].[FirstName], [t1].[value] AS [noVowel]
FROM (
    SELECT [t0].[FirstName], REPLACE(REPLACE(REPLACE([t0].[FirstName], @p0, @p1), @p2, @p3), @p4, @p5) AS [value]
    FROM [User] AS [t0]
    ) AS [t1]
WHERE LEN([t1].[value]) > @p6
GO

-- Region Parameters
DECLARE @p0 NVarChar(1000) = 'a'
DECLARE @p1 NVarChar(1000) = ''
DECLARE @p2 NVarChar(1000) = 'e'
DECLARE @p3 NVarChar(1000) = ''
DECLARE @p4 NVarChar(1000) = 'i'
DECLARE @p5 NVarChar(1000) = ''
DECLARE @p6 Int = 5
-- EndRegion
SELECT [t1].[value]
FROM (
    SELECT REPLACE(REPLACE(REPLACE([t0].[FirstName], @p0, @p1), @p2, @p3), @p4, @p5) AS [value]
    FROM [User] AS [t0]
    ) AS [t1]
WHERE LEN([t1].[value]) > @p6 
```

似乎 Linq-to-SQL比实体框架**更智能**，字符串处理只执行一次。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2020-04-06T09:14:32.737

[leppie 答案的](https://stackoverflow.com/a/641963/4990642)可视化版本。可以看出，编译器在查询中产生错误，`into`与后者不同的是访问第一个变量。

[![在此处输入图像描述](https://i.stack.imgur.com/9WBQj.png)](https://i.stack.imgur.com/9WBQj.png)

# c++ - WASAPI 阻止 Windows 自动挂起？

> ID：641935
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T09:27:40.723
> 
>         
> 
> 标签：c++, audio, windows-vista, suspend

第一次发帖，温柔点;-)

我正在编写一个音频应用程序（在 C++ 中），它作为 Windows 服务运行，使用 WASAPI 从插孔中的线路中获取样本，并对其进行一些处理。

我注意到，当我的应用程序“录制”时，Windows 不会自动挂起或休眠。

我已经注册了电源事件通知，如果我自己按下暂停按钮，我的服务会获得适当的电源事件并正常处理它们。如果我让系统自行挂起，则永远不会收到电源事件。

如果我删除了引用 WASAPI 的代码位，则在手动和自动挂起时都会正常接收电源事件。所以似乎有一些关于使用 WASAPI 告诉 Windows 忽略自动挂起计时器的东西。

谁能帮助解释这种行为，我能做些什么来阻止它吗？我不希望我的应用程序成为行为不端并阻止系统暂停的应用程序之一。

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2009-03-17T02:01:17.027

不幸的是，没有任何机制可以做你想做的事——打开音频流可以防止电源状态转换，就像通过网络打开文件和许多其他事情一样。

这是音频驱动程序 (portcls.sys) 的功能，而不是 WASAPI，也不是 Vista 的新行为——我相信 XP 和 Win2K 有类似的行为（尽管电源状态转换在 Vista 上比在 XP 上可靠得多和 Win2K，因此用户倾向于更多地依赖它们）。

在 Windows 7 上，您可以使用“powercfg -requests”来查找系统的任何部分是否阻止机器进入睡眠状态。更多信息可以在[这里找到](http://channel9.msdn.com/pdc2008/PC02/)

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2009-04-09T12:03:40.503

非常感谢拉里确认这种行为是设计使然，而不是我在做一些愚蠢的事情。

为了解决这个问题，我使用了 Win32 `CallNtPowerInformation()`API 来检索系统空闲计时器：

```
SYSTEM_POWER_INFORMATION spi = {0};
NTSTATUS status = CallNtPowerInformation(SystemPowerInformation, NULL, 0, 
                                         &spi, sizeof(spi));

if (NT_SUCCESS(status) && (spi.TimeRemaining==0))
{
    // should have gone to sleep
} 
```

成员从用户在控制面板中指定的时间（例如“1 小时后系统待机” `spi.TimeRemaining`）开始倒计时（以秒为单位），并在 CPU 使用率（以百分比表示）超过 时重置`spi.MaxIdlenessAllowed`。

如果`spi.TimeRemaining`达到零，系统*应该*已经进入睡眠状态，所以我关闭我所有的 WASAPI 句柄并让它这样做。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T18:22:54.400

我相信电源管理 API 中有一个功能，它允许应用程序告诉操作系统它不希望系统在一段时间内进入省电模式（我认为这是一个开/关类型的功能）。如果 WASAPI 中的某些东西正在调用该方法，那么您可能无能为力。这对硬件按钮行为是有意义的，因为电源管理服务不会根据电源模式的激活方式来强制执行应用程序请求。

至于解决方法，我不知道。我可能会尝试的一件事是从电源管理 API 读取节电超时信息，然后在系统接近节电阈值时暂停录制；我不知道那会有多难。祝你好运。:)

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-14T09:39:12.323

> 我可能会尝试的一件事是从电源管理 API 读取节电超时信息，然后在系统接近节电阈值时暂停录制；

一个好主意——但我认为这很难。省电超时应该可以使用电源管理 API 读取，但您还需要知道当前用户输入的空闲状态，这是无法从 Windows 服务读取的。

# tfs - w2k3 x64 上的 TFS 2005？

> ID：641945
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T09:31:10.370
> 
>         
> 
> 标签：tfs, 64-bit

任何人都快点告诉我有关在 w2k3 x64 上运行 TFS 的任何文章，或者是否有可能，因为它似乎不是 =<

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T09:54:39.550

Team Foundation Server 的应用层不能安装在 64 位环境中。

几个月前，当我忘记了这个事实时，它让我感到震惊：

[https://blog.iannelson.uk/on-64-bit-tfs-virtualization-and-conchango-scrum/](https://blog.iannelson.uk/on-64-bit-tfs-virtualization-and-conchango-scrum/)

# .net - LINQ to SQL 从 .NET 插入大对象

> ID：641950
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2009-03-13T09:34:14.873
> 
>         
> 
> 标签：.net, linq, linq-to-sql

使用 LINQ to SQL 将具有 100,000 条记录的列表对象获取到 SQL 的最快方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-03-13T10:24:31.600

对于海量数据，*最快*的方法是使用类似[`SqlBulkCopy`](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.aspx)将数据（通过精心制作的`IDataReader`）推送到临时表（相同的布局，但没有索引/等） - 然后使用[SqlCommand](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlcommand.aspx)执行存储过程来推送数据将临时表转换为真实表。但请注意，此处不涉及 LINQ-to-SQL（除非您使用它来调用存储过程）。

您可以尝试仅使用常规 LINQ-to-SQL `InsertOnSubmit`- 在尝试优化数据之前评估数据量的问题有多大；即使次优，它也可能“足够快”。

`IDataReader`您可以相当轻松地创建一个；我经常从[这里](http://www.codeproject.com/KB/database/CsvReader.aspx)使用 csv 。要从列表中创建一个，您可以`SimpleDataReader`从[这里](http://groups.google.co.uk/group/microsoft.public.dotnet.languages.csharp/msg/b1d70b504cdee2ad)借用并覆盖`DoRead`。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T09:39:10.400

你可以：

```
MyContext.Items.InsertAllOnSubmit( 
    from i in list
    select new Item
    {
       //map properties
    }); 
```

附言。虽然没有尝试插入那么多数据

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:40:45.497

LINQ2SQL 不支持批量插入。看看运行你自己的 SQL，或者使用另一个支持它的框架（我记得实体框架支持它，但我不能确定）。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T10:19:14.017

您可能希望准确指定 100,000 条记录的来源。

如果您从非数据库源检索记录，我知道插入记录的最快方法是使用 InsertAllOnSubmit 方法。当然，这意味着一个事务中有 100,000 个插入语句，但如果没有更多细节，这件事就没有太多选择。

如果您从数据库中检索记录，则调用存储过程的性能会更好。例如，在您的存储过程中：

```
INSERT INTO TableA
SELECT * FROM TableB 
```

然后，您使用 LINQ 调用存储过程。

# c# - 在运行时加载程序集

> ID：641961
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2009-03-13T09:37:02.137
> 
>         
> 
> 标签：c#, .net

我的项目是一个应用程序，我们在其中加载各种程序集并对其执行操作。

我们陷入了需要添加对我们加载的程序集（将由用户选择）的引用的情况。所以我需要在运行时添加对 DLL 的引用。

我试过[这个网站](http://www.codeproject.com/KB/cs/addrefvsnet.aspx)，但在这里他们只支持像 System.Security 等微软 DLL。我想添加对用户创建的 dll（类库）的引用。

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2009-03-13T09:39:40.273

你不能在运行时“添加引用”——但你可以加载程序集—— `Assembly.LoadFrom`/等。问题是除非你使用s.否则你`Assembly.LoadFile`不能*卸载它们。*`AppDomain`一旦你有了一个`Assembly`，你就可以`assemblyInstance.GetType(fullyQualifiedTypeName)`通过反射来创建实例（然后你可以将其转换为已知的接口等）。

举个简单的例子：

```
// just a random dll I have locally...
Assembly asm = Assembly.LoadFile(@"d:\protobuf-net.dll");
Type type = asm.GetType("ProtoBuf.ProtoContractAttribute");
object instance = Activator.CreateInstance(type); 
```

此时我可以`instance`转换为已知的基本类型/接口，或者继续使用反射来操作它。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T11:42:50.727

如果程序集位于当前位置或 GAC 之外的其他位置，只需使用
***AppDomain.CurrentDomain.AssemblyResolve***事件自行交付程序集。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:39:34.250

如果您在运行时加载程序集，它将在当前位置或 GAC 中查找其所有依赖项，如果找到则加载它们，否则会出错。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-03-13T09:59:13.330

复合 UI 应用程序块可在三个方面促进客户端应用程序的设计和实现：

*   它允许您的应用程序基于模块或插件的概念。

*   它允许具有 shell 专业知识的开发人员构建组件，以隐藏业务逻辑开发的用户界面复杂性。

*   它使用模块之间松散耦合的模式来促进开发。

对于 WPF：查看[Prism：模式和实践 WPF 和 Silverlight 站点的复合应用程序指南](http://www.codeplex.com/CompositeWPF)它执行您需要的程序集加载，并且实际上在内部使用 Unity，因为它是 IoC 容器。

对于非 WPF：查看[Smart Client - Composite UI Application Block](http://msdn.microsoft.com/en-us/library/aa480450.aspx)

或者：尝试任何 IoC 容器，例如[Castle Windsor](http://www.castleproject.org/index.html)、autofac、unity 等。

# jquery - JQuery 1.3.1 找不到动态生成的行

> ID：641962
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2009-03-13T09:37:21.183
> 
>         
> 
> 标签：jquery, ajax, dynamic

我刚刚安装了 ASP.NET MVC RC2，并且还使用了 JQuery 1.3.1 库。

在我使用 1.2.6 库之前。

我们的应用程序在该库下运行良好。

但现在我有一个奇怪的问题。

我们有一个使用 AJAX 调用的结果构建的网格视图。

使用返回的结果，我们通过克隆隐藏行将新行添加到表中。

从 JQuery 生成的 HTML 将额外的参数放置到标签中。这些是 JQuery12345678="null" 的形式。他们都有相同的名字。在表格的头部有一个复选框，用于选择/取消选择表格的所有行。这是通过遍历表的行来实现的。

```
$("#selectAllCheckbox").click(function() {
    var checked = this.checked;
    $("#dgNewTasks tbody tr").find(':input[type="checkbox"]').each(function() {
        this.checked = checked;
    });
}); 
```

现在通过使用新库不再设置复选框。我已经使用 IE 开发者工具来检查 HTML。如果我从行中删除 JQuery12345678="null" 参数。它工作正常。

有人可以告诉我我必须做什么吗？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T10:18:56.230

我们需要查看您的 HTML。这可能会说明问题。同时，您的代码可以大大简化：

```
$("#selectAllCheckbox").click(function() {
    var checked = this.checked;
    $("#dgNewTasks tbody tr :checkbox").attr("checked", checked);
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2010-05-01T22:41:50.743

听起来您需要使用[.live](http://api.jquery.com/live/)而不是 .click：

```
$("#selectAllCheckbox").live(function() {
    var checked = this.checked;
    $("#dgNewTasks tbody tr").find(':input[type="checkbox"]').each(function() {
        this.checked = checked;
    });
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2010-05-01T22:33:49.687

这不起作用，因为您在事件处理程序中附加了事件处理程序（例如`click()`），`ready()`此时没有任何动态创建的行。因此，`click()`在动态创建的行创建后，将它们附加到或任何其他事件处理程序。

# svn - 我可以在不使用本地工作副本的情况下将新文件夹添加到 TFS 存储库服务器端吗？

> ID：641978
> 
>         
> 
> 赞同：9
> 
>         
> 
> 时间：2009-03-13T09:43:12.510
> 
>         
> 
> 标签：svn, tfs, workspace

我目前正在将一些源代码从 Subversion (SVN) 存储库传输到我客户的 Team Foundation Server。我偶然发现的一件事是，如果不先将该存储库中的所有文件拉到本地工作区中的本地工作文件夹，似乎就无法编辑存储库。我正在使用 Visual Studio 2008 团队资源管理器。

我的存储库类似于以下结构：

```
$
$/branches
$/trunk
$/trunk/Solution1
$/trunk/Solution1/... etc. 
```

现在我要做的是在主干的根目录中添加一个新文件夹（即$/trunk/Docs）。因为 Solution1 文件夹树 ($/trunk/Solution1) 包含大量数据，所以我不想先获取该文件夹的本地副本。我想在服务器端创建新的“Docs”文件夹。但是，我注意到源代码管理资源管理器工具栏上的“新建文件夹”按钮在选定的存储库文件夹不能用作本地工作区中的工作文件夹时显示为灰色。

使用 SVN 这从来不是问题，因为使用 TortoiseSVN 我可以使用 Repo-Browser 在服务器端创建一个新文件夹。SVN 不需要您先检查其父文件夹。

有人知道如何在服务器端编辑 TFS 存储库吗？我错过了一些琐碎的事情吗？

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2009-03-13T09:49:59.170

您不需要获取本地副本，但您需要将服务器端文件夹映射到本地计算机上的工作区。

在源代码管理资源管理器中，使用“工作区...”下拉框来创建这样的映射。我发现最简单的方法是将 TFVC ($) 中的根节点映射到本地计算机上的目录，例如 c:\tfs，并允许层次结构向下传播。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2010-09-21T16:45:07.273

有趣（或悲伤）的事情是 TFS 服务器引擎本身没有限制（如果您将 SVNBridge 放在它上面，您可以在不使用本地工作副本的情况下将新文件夹添加到 TFS 存储库服务器端. 但可悲的是，本机 TFS 客户端无法做到这一点......

# mysql - MySQL：无法访问 root 帐户

> ID：641984
> 
>         
> 
> 赞同：18
> 
>         
> 
> 时间：2009-03-13T09:47:02.127
> 
>         
> 
> 标签：mysql, mysql-error-1045

我在本地 Windows 机器上运行 MySQL 5.x，并且使用 MySQL 管理员，我无法连接到使用 root 帐户创建的数据库。我得到的错误是：

> MySQL 错误号 1045 用户'root'@'localhost'的访问被拒绝（使用密码：YES）

我不记得更改 root 帐户凭据，但我知道我试图通过添加它们的 IP 来让 LAN 上的其他计算机访问数据库。我为其中一个 IP 做的一件事是指定对帐户的访问权限`'root'`而不是`root`，即我用单引号字符包围了 root。全部使用 MySQL 管理员。这可能是我无法使用root登录的原因吗？

另外，有没有办法创建一个新的或重置 root 帐户？如前所述，我可以完全访问我的盒子。

**看到这些问题**

*   **[如何将 MySQL root 密码更改为默认密码？](https://stackoverflow.com/questions/205614/how-to-change-mysql-root-password-to-default)**

*   **[如何找回我的 MySQL 用户名和密码？](https://stackoverflow.com/questions/4371/how-do-i-retrieve-my-mysql-username-and-password)**

*   **[如何更改 MySQL 中的 root 用户的密码？](https://stackoverflow.com/questions/53482/how-do-i-change-the-password-of-the-root-user-in-mysql)**

* * *

## 回答 #1

> 赞同：21
> 
>             
> 
> 时间：2010-12-09T20:39:46.603

您可以使用初始化文件。查看有关[如何重置 Root 密码](http://dev.mysql.com/doc/refman/5.1/en/resetting-permissions.html)的 MySQL 官方文档（包括对替代解决方案的评论）。

因此，基本上使用 init 文件，您可以将修复访问权限所需的任何 SQL 查询（例如`GRAND`、`CREATE`、`FLUSH PRIVILEGES`等）添加到 init 文件（任何文件）中。

这是我恢复root帐户的示例：

```
echo "CREATE USER 'root'@'localhost' IDENTIFIED BY 'root';" > your_init_file.sql
echo "GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION;" >> your_init_file.sql 
echo "FLUSH PRIVILEGES;" >> your_init_file.sql 
```

创建文件后，您可以运行：

```
killall mysqld
mysqld_safe --init-file=$PWD/your_init_file.sql 
```

然后检查这是否有效，按下`Ctrl+Z`并输入：`bg`将进程从前台运行到后台，然后通过以下方式验证您的访问权限：

```
mysql -u root -proot
mysql> show grants;
+-------------------------------------------------------------------------------------------------------------+
| Grants for root@localhost                                                                                   |
+-------------------------------------------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'root'@'localhost' IDENTIFIED BY PASSWORD '*81F5E21E35407D884A6CD4A731AEBFB6AF209E1B' | 
```

也可以看看：

*   [没有密码——](http://everythingmysql.ning.com/profiles/blogs/no-password-no-problem)一切都没有问题 MySQL

*   [错误 #28331：当 CREATE USER 由于重复键而失败时，错误消息不清楚](http://bugs.mysql.com/bug.php?id=28331)

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2017-09-11T12:26:17.953

这对我有用：

[https://blog.dotkam.com/2007/04/10/mysql-reset-lost-root-password/](https://blog.dotkam.com/2007/04/10/mysql-reset-lost-root-password/)

第 1 步：如果 MySQL 守护程序当前正在运行，则停止它

```
 ps -ef | grep mysql      - checks if mysql/mysqld is one of the running processes.

  pkill mysqld             - kills the daemon, if it is running. 
```

第 2 步：运行 MySQL 安全守护程序并跳过授权表      

```
 mysqld_safe --skip-grant-tables &

  mysql -u root mysql 
```

第 3 步：以 root 身份登录 MySQL，无需密码

```
 mysql -u root mysql 
```

第 4 步：运行 UPDATE 查询以重置 root 密码

```
 UPDATE user SET password=PASSWORD("value=42") WHERE user="root";
  FLUSH PRIVILEGES; 
```

在 MySQL 5.7 中，'password' 字段已被删除，现在字段名称为 'authentication_string'：

```
 UPDATE user SET authentication_string=PASSWORD("42") WHERE 
  user="root";
  FLUSH PRIVILEGES; 
```

第 5 步：停止 MySQL 安全守护程序

第 6 步：启动 MySQL 守护进程

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2009-03-13T09:51:05.847

MySQL手册中有一节介绍[如何重置root密码](http://dev.mysql.com/doc/refman/5.0/en/resetting-permissions.html)，这将解决您的问题。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2013-03-20T18:06:32.650

使用root访问mysql时遇到了同样的问题。我发现的问题是某些数据库文件没有mysql用户的权限，这是启动mysql服务器守护进程的用户。

我们可以用`ls -l /var/lib/mysql`命令检查一下，如果mysql用户没有对某些文件或目录的读写权限，那可能会导致问题。我们可以使用命令更改这些文件或目录的所有者或模式`chown/chmod`。

完成这些更改后，重新启动 mysqld 守护程序并使用 root 使用以下命令登录：

```
mysql -u root 
```

然后更改密码或创建其他用户登录mysql。

高温高压

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2021-08-27T12:29:57.130

**这段代码是我的解决方案**

`ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'pWKQiSdwMBZDJfWZEnxgEHCPl4GgkJ';`

# python - 重命名文件，Python/Jython

> ID：641985
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2009-03-13T09:48:05.040
> 
>         
> 
> 标签：python, file, jython, rename

我有一个充满文件的目录，其中一些文件的名称中有一个＆符号。我想用＆符号重命名所有文件，并用加号（+）替换每个＆符号。我正在处理大约 10k 个文件。最好的方法是什么？

* * *

## 回答 #1

> 赞同：13
> 
>             
> 
> 时间：2009-03-13T09:58:43.253

```
import glob, os
for filename in glob.glob(os.path.join(yourPath, "*&*")):
   os.rename(filename, filename.replace('&','+')) 
```

* * *

## 回答 #2

> 赞同：7
> 
>             
> 
> 时间：2009-03-13T11:42:25.657

如果您有子目录：

```
import os
for dirpath, dirs, files in os.walk(your_path):
    for filename in files:
        if '&' in filename:
            os.rename(
                os.path.join(dirpath, filename),
                os.path.join(dirpath, filename.replace('&', '+'))
            ) 
```

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2009-03-13T10:23:09.683

```
import os
directory = '.'
for file in os.listdir(directory):
    if '&' in file :
        os.rename(file, file.replace('&', '+')) 
```

替换`directory`为您自己的路径。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2013-09-23T17:10:00.940

使用[重命名](https://github.com/75lb/rename)：

```
$ rename --find '&' --replace '+' * 
```

# wcf - WCF：每个业务实体的单独服务

> ID：641990
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2009-03-13T09:51:03.413
> 
>         
> 
> 标签：wcf, web-services

例如，如果您有客户、订单和产品。您是否为这些业务实体中的每一个创建单独的服务？

您应该为其中的每一个创建一个服务合同，这有点合乎逻辑。但是，由于您必须明确指定您的服务将实施的合同……这会迫使您为每个服务合同创建单独的服务，不是吗？

你能告诉我你将如何处理这件事吗？不知何故，为永远的商业实体提供服务感觉很笨拙……:-(

提前，非常感谢和问候。

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2009-03-13T10:01:49.627

服务作用于业务实体，但不是业务实体。

因此，客户、订单和产品将是数据合同，而不是服务合同。

您对构成服务合同的那些数据合同执行的操作，您在实体上公开的操作可能是也可能不是实体可以做的所有事情。

如果，正如我认为您可能会问的那样，每个实体都有共同的功能（例如 CRUD 操作），那么是的，您应该为每个实体（CustomerCRUDService、OrderCRUDService 等）上的 CRUD 服务设置一个单独的服务联系人，因为 Web 服务没有t 支持方法签名的重载。

（来自评论）

有几种方法。

1) 复合服务契约：例如，我有一个实现 WSTransfer 的服务——这实际上由两个服务契约组成，IWSTransferResource 和 IWSTransferFactory。反过来，我有一个 IWSTransfer 服务合同，它只实现这些单独的合同 - 公共接口 IWSTransfer ： IWSTransferResource, IWSTransferFactory

2) 但是您甚至不必那么复杂，WCF 中的实现可以实现多个服务合同 - MyServiceImpl : IMyContract1, IMyContract2。然而，每个合约都需要一个单独的端点，因为端点是用于服务合约的，而不是实现类。************ 
```