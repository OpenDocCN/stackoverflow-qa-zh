# StackOverflow 问答 000251000-000251999

# java - 将“Java School”程序员转变为 C 或 C++ 程序员有多难？

> ID：251007
> 
> 赞同：28
> 
> 时间：2008-10-30T17:17:59.900
> 
> 标签：java, c++, c

我的公司是一家 C++ 公司，一直在招聘应届毕业生。然而，由于 Java Schools 现象，我们通常最终采访强大的 Java 程序员，可能只有一分钟的 C++ 知识。通常 C++ 课程并没有真正让学生为使用 C++ 做好准备。然而，这些孩子往往是聪明的孩子，渴望学习并尽力而为。

每次采访，我都在为这个基本问题苦苦挣扎：

将“Java School”程序员转变为 C 或 C++ 程序员有多难？贵公司是否有将典型的“Java 学校”程序员转变为强大的 C++ 程序员的经验？值得付出努力吗？

我为此苦苦挣扎的原因之一不仅仅是因为 C 或 C++ 与 Java 语言的差异，而是学习 C 或 C++ 所带来的基本技能，我认为这些技能在 Java School 中经常会迷失。[这些包括数据结构、计算复杂性、手动内存管理，以及 Joel Spolsky在这里](http://www.joelonsoftware.com/articles/ThePerilsofJavaSchools.html)所说的一切。

通常，据我所知，一个学生会具备一些基本技能（能够回答几个问题），但我仍然会有很大一部分的想法，对某人能学习到这些技能的程度持怀疑态度无需在某些 C 或 C++ 中弄脏手的技能。也许我需要摆脱这种刻板印象。我只是不公平吗？

无论如何，您将“Java School”程序员转变为 C 或 C++ 程序员的经验如何？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-30T17:33:43.037

好吧，如果他们不了解数据结构和算法复杂性，他们就不会非常擅长严肃的 Java 编程，所以我认为语言在这里不是问题。

他们不会理解指针，但是好的 C++ 编程通常不会以复杂的方式使用指针。（也有例外，但由于我不知道贵公司是做什么的，所以我无法确定他们是否会申请。）毕竟，您可能不希望您的开发人员编写自己的链表而不是使用 std::列表。

他们不会理解手动内存管理，但这在 C++ 中比以前容易得多。在现代 C++ 中，由于可能存在异常，您自己的内存管理变得更加困难，因此您想在几乎所有东西上练习 RAII（使用 auto_ptr、boost::shared_ptr 等）。

如果我在经营一些东西，如果它们看起来不错，我就会雇用它们。我会意识到可能存在问题（毕竟 C++ 是一种比 Java 要求更高的语言），并且对如何处理它们有某种想法。

没有理由仅仅因为他们不具备您想要的确切技能而避免雇用大学毕业生。聪明的人会学习，你可能不想雇用不聪明的人。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-30T17:21:49.753

程序员程序。真正知道如何编程的人可以学习任何语言。当然，有一个学习曲线，但一个好的编码器可以相对快速地上手。如果您期待有高级知识的人，那么无论如何您都不会希望雇用应届毕业生，对吗？因此，无论哪种方式，都会有一条学习曲线。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-10-30T18:17:50.387

纯粹从 C++ 程序员的角度来说，我认为想要学习 C++ 的 Java 开发人员将面临相当陡峭的学习曲线。是的，在某种程度上，所有语言的开发代码都是相似的。我曾经被要求用 Excel 的宏语言（VBA 之前）编写代码。我做到了，但这就像试图用五年级的词汇 写*《战争与和平》 。*

据我所知，C++ 中还有其他问题（指针、内存管理、运算符重载）在 Java 中不存在，它们也不是小问题。特别是如果您正在寻找帮助遗留 C++ 代码的人，这些可能会带来很大的障碍。而且我认为我会在开始时至少进行一些维护工作来开始任何新员工。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-10-30T18:01:35.163

与我使用过的其他语言（如 Java、C、Python、Fortan、Javascript、ASP 和 Perl）相比，我使用过多种语言进行编程，并且发现 C++ 很难理解和提高效率。我几乎会说它属于自己的一个类别。我不相信我刚刚列出的一种语言（包括 Java）的能力可以很好地预测一个人的 C++ 程序员可能有多好。我认为 C++ 几乎需要一种不同类型的思维，当然还有在编码时将大量信息放在脑海中的能力，而不是主要关注业务需求。

多年来，我一直在努力精通 C++，尽管从不需要在工作中使用它（即在我自己的时间学习）。这是非常艰难的，毕竟我不确定作为 C++ 程序员我是否会成功并富有成效。我认为我在其他语言方面总体上相当称职。

因此，基于我对一个人（我！）的小而明显的偏见样本，我建议倾向于那些已经展示出大量过去 C++ 经验的开发人员，如果这就是他们每天要在工作中做的事情的话。我认为，您将需要花费更多时间来寻找这些候选人，但从长远来看，您将有更大的成功机会。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-05-31T00:45:13.823

我的经验法则是，我宁愿让 C/C++ 程序员编写 Java，也不愿让 Java 程序员编写 C/C++。在他们尝试之前，我无法判断哪些 Java 程序员可以处理内存管理和指针。

如果我只能选择 Java 学校的孩子，我会告诉他们一些关于汇编和 C 的恐怖故事，然后尝试将它们分成三类。

1.  无所畏惧。他们没有注意。
2.  害怕和恐慌，因为他们知道他们无法处理那种复杂性。
3.  恐惧和渴望，因为他们明白，即使比他们更聪明的人也会因奇怪的内存和硬件问题而受到打击，但见鬼，这听起来确实是一个很好的挑战。

我会从第 3 组招聘。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-30T18:08:25.353

“你不能教高个子。” ——某著名篮球教练。

招聘时，您正在寻找既能快速学习新概念又能迅速*改掉*习惯的人。后者可以偷偷摸摸你。在 Java->C++ 转换的情况下，您可能会面临“忘记”诸如严重依赖 IDE、“一切都是对象”、对象和程序的心理模型太高级等问题。

我建议您寻找具有灵活性的东西——让他们在 IDE 和纯文本编辑器中编写一个小程序，向他们展示一个简单的 C++ 函数，该函数传递一个指针并修改底层值，看看他们是否会绊倒， ETC。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-04T07:42:10.040

作为一个主要是“Java 学生”的人，并且是最近刚毕业的人，我绝对认为我可以轻松地学习 C 或 C++...

不过，我真的不想。我只能为我自己说话，但如果你是用 Java 长大的，C 可能是一门非常丑陋的语言。我认为动机将成为更大的障碍。动机，也许还有一些抱怨“在*Java*中这太容易了，为什么不是 C *Java*？” :)

如果你能找到一个有适当动机的人，其余的都会好起来的。:)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-30T17:37:10.017

无论他们的“语言”群体如何，要弄清楚毕业生是否对基础知识有扎实的理解是相对简单的。这些基础知识包括 1) 数据结构 2) 操作系统和 3) 算法及其复杂性。这些本质上是概念领域，讨论其中特定问题的设计或方法可以揭示它们的强弱程度。您不必让他们编写代码。

我想说，如果有人在这些基础上打下了坚实的基础，并且同样重要的是有积极的态度，他就可以学习任何其他语言。

我总是追求这些基础知识和他们的评估——应届毕业生或有经验的。这些是雇用某人的主要标准。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-30T17:23:48.080

Java 学校的人应该仍然对数据结构和计算复杂性有很强的掌握。它们唯一不足的地方是手动内存管理。如果他们了解垃圾收集器为他们做了什么，并且他们看起来足够聪明，你可以教他们内存管理，那么我会说给他们一个机会。由于他们没有花时间在 Java 学校学习内存管理，因此请尝试找出他们在您需要的其他领域是否特别强。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-30T20:27:00.907

我认为 Joel Spolsky 在他的文章中提到的问题是“获取”指针和递归需要一定的智力，基于 C 的课程会淘汰那些没有它的人，而 Java 学校不会不一定要这样做。

那么招聘经理该怎么做，因为人们不会在简历上放，“我没有得到指示，而且我永远不会得到。”

因此，如果您相信 Joel 的假设，即“获取”指针和递归的能力是人们天生具有或没有的个人特质，我会看到以下选项：

1.  只从 C/C++ 学校而不是 Java 学校招聘。
2.  如果没有 C/C++ 学校，那就聘请有经验的 C/C++ 程序员而不是大学。
3.  如果您致力于从大学招聘，那么接受比您转换他们的失败率不可忽略不计。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-05-31T00:24:57.797

我自己也是一名学生，我早年的大部分课程都是用 Java 完成的，但我总是尝试用 C++ 做事，只是为了好玩。本学期开设了一门新课程，要求每个人都使用 C++ + OpenGL + Qt 编程，而其他许多从未使用过 C++ 的学生很难适应，并且经常花费数小时与简单的编译时错误作斗争。这可能有很多原因（包括愚蠢），但我认为对于*只*使用 Java 的人（很多学生只是使用他们被告知的东西）更改为 C++ 可能非常困难。不幸的是，我想不出任何方法来减轻过渡的痛苦，只能想到 Dijkstra 说：

> 向之前接触过 BASIC 的学生教授好的编程实际上是不可能的：作为潜在的程序员，他们在精神上被残缺不全，没有再生的希望。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-30T17:41:55.843

我自己是一名 java 开发人员，但在大学里有 C/C++ 基础。我很高兴我从内存管理、列表、队列、堆栈开始，最重要的是：指针。虽然我没有明确使用指针，但我知道我的应用程序后面发生了什么，发现内存泄漏、性能问题等。

我认为最好的解决方案不是要求 Java/C# 开发人员在上班时学习 C/C++（以及这些语言附带的所有问题），而是在大学里教他们这些科目。这将是最好的解决方案。

就像现在一样，这就像修复效果/症状，而不是实际原因。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-30T19:53:24.593

我从 C/C++ 开始，然后转到 Java。

我不确定新毕业生真的什么都知道——把他们当成白手起家的培训。与未受过教育的黑客合作可能会更好。

也就是说，对于一个优秀的工程师来说，在指针、内存分配等之间来回切换是相当容易的——但我认为从垃圾收集的 OO 切换回非 OO 是非常困难的。

当您使用带有 GC 的系统时，您会更好地从高层次思考您的设计。您实际上可以以更易于理解的方式进行编码。您开始真正拥有专注于单一职责的类（大多数类将是几个屏幕——大多数方法将是微不足道的）。

我从来没有见过好的 OO C++ 代码，这可能是好的，因为 OO 代码的性能不会那么好，只是有太多小的分配/释放、短的方法调用和其他小的性能障碍，让 C++ 程序员高兴.

这有点像把你的赛车装上空调、动力转向和电动车窗。更有用，但破坏了最初选择它的原因。

顺便说一句，如果有人有参考，我很想看到一些好的 OO c++ 代码......

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-30T20:29:21.277

我认为这种“Java 学校”的想法在很大程度上是人为的。我所在的大学使用 java 来教它主序列 CS 课程（数据结构、算法等）但是，它们是许多其他使用其他语言（如 C/C++/Scheme）的课程，并且在更高级别的课程中可以完成工作任何语言。

你真的认为用什么语言教授基本编程概念很重要吗？

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-03-12T20:18:39.700

一个好的计算机科学课程应该教给学生基础知识，无论您使用哪种编程语言，这些基础知识都是一样的。你提到的东西，内存管理，数据结构等等，都是这些基础技能的一部分。根据我的经验，熟悉这些概念的程序员会比不了解这些概念的程序员设计出更好（更有效、更快、更容易）的解决方案，尤其是对于非标准问题。

至于语言选择，一个好的程序员应该能够在几周内学会一门新的编程语言，并在 1-2 个月内精通。对于具有许多共享特性的 C++ 和 Java 来说尤其如此。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-30T17:21:27.053

取决于程序员的智商。真正的问题是：这个程序员是否足够聪明，可以让我们投入学习时间？越聪明，他需要学习的时间就越少。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-30T17:21:47.007

Java 程序员和 C++ 开发人员一样适合 C# 房屋。

跨入 C/C++ 将取决于程序员，但除了一般编程经验外，我不会将他们的 Java 技能计算在内。如果你吸引了很多这样的申请人，我也会感到惊讶。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-30T19:22:38.870

我在[这里](https://stackoverflow.com/questions/207286/does-c-still-matter#208328)的帖子几乎可以回答您的问题。就像乔尔（Joel）在您提供的链接中感到难过一样，今天他们没有在学校学习基础知识真是太糟糕了。但是优秀的人还在学习，他们学习操作系统并破解linux内核调度程序，他们做汇编项目等......
我公司的大多数员工都是刚刚毕业，如果不了解基本知识就不可能通过我们的考试，所以振作起来，你身边仍然有优秀的候选人需要知道[如何找到他们](http://www.joelonsoftware.com/articles/GuerrillaInterviewing3.html)。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-30T20:24:53.360

这比把一个好的 C/C++ 程序员变成一个好的 Java 程序员更难。这里的重点是“好”。任何人都可以用任何语言进行糟糕的编程。优秀的 C++ 程序员必须很好地理解指针。C++ 中最重要的概念之一是迭代器，它是通过运算符重载对 C 指针的泛化，这使得许多算法在 C++ 中真正通用。

NCG 是否明白这一点的一个重要指标是他们在操作系统课程中的表现。如果他们通过了一个项目工作量大的操作系统课程（比如用任何语言实现任何操作系统组件）并且他们喜欢它，那么他们很可能是你能得到的最好的学生之一。

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2009-07-15T19:51:34.450

如果你雇佣刚毕业的年轻人，你应该雇佣智商，而不是任何特定的技能。你想要的是[聪明和把事情做好的](https://rads.stackoverflow.com/amzn/click/com/1590598385)人，而不是知道如何以一种特别令你满意的方式来指点的人。

* * *

## 回答 #21

> 赞同：-3
> 
> 时间：2008-10-30T17:33:24.660

这只是另一种语言。

而且，如果您坚持使用相对较小的纯 OOP 特性子集，那么从 Java 开发人员的角度来看，确实没有太多可学的东西。为了让他们成为通用的 OOP 程序员，你唯一应该教他们的是他们必须实现一个析构函数来处理他们的内存。

但是，如果他们应该使用 STL、模板、异常等，他们可能需要更多的指导。

* * *

## 回答 #22

> 赞同：-4
> 
> 时间：2009-05-31T01:00:17.740

我不买“你要么得到指针/递归，要么你没有”。头脑是一块干净的石板。只要有足够的时间和兴趣，任何人都可以学习任何东西。问题是——这些孩子有兴趣吗？

我们一直在为我的工作寻找实习生，我已经完成了今年的 30 多份简历。令我震惊的主要事情是，他们中很少有人做过他们的班级或工作不需要他们做的该死的事情。找一个自己做过并享受它的人，你会很满意。

也就是说，就我个人而言，我不会和不懂 C 和汇编的人浪费时间。使用 gdb 从 C++ 崩溃中调试核心转储与查看 Java 堆栈跟踪之间存在很大差异。由于许多原因，C++ 确实是一种可怕的语言，但它的优点在于它与 C 的共同点。它是一种强大的方法，可以告诉计算机完全按照您的意愿去做，而无需担心关于某些运行时正在做什么其他废话。

此外，如果您想节省时间，请不要与不是来自前 10 名工程师学校的任何人打扰。并不是说二级学校没有优秀的学生，但从实际的角度来看，你不需要你的雇员成为他们中的一员。

麻省理工学院、斯坦福大学、加州大学伯克利分校、佐治亚理工学院、伊利诺伊州厄巴纳香槟分校、CMU、加州理工学院、南加州大学、密歇根州安娜堡分校、德克萨斯州奥斯汀分校。

我也不会雇用任何人来编写使用 Microsoft Windows 的软件。作为一名计算机科学专业的学生，​​如果不成为 Linux 用户，您根本不会对软件或计算机如何工作感兴趣（如果您使用 FreeBSD 或其他东西会更好）

# sharepoint - 如何更改 SharePoint 2007 的 URL

> ID：251017
> 
> 赞同：3
> 
> 时间：2008-10-30T17:21:01.110
> 
> 标签：sharepoint, url

我使用手动添加的 HOSTS 记录创建了一个新的 SharePoint 门户用于测试目的。我已经对其进行了全部测试，并希望使用我们 DNS 中的 URL 将其公开给外界。

我似乎找不到直接更改 SharePoint 门户 URL 的方法。有谁知道这个设置在哪里？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T17:25:47.607

没关系。我在以下位置找到了答案：

[http://www.sharepointblogs.com/johnwpowell/archive/2007/01/04/how-to-change-the-sharepoint-url-using-alternate-access-mappings.aspx](http://www.sharepointblogs.com/johnwpowell/archive/2007/01/04/how-to-change-the-sharepoint-url-using-alternate-access-mappings.aspx)

# asp.net - 在 CSS 类之间共享样式

> ID：251030
> 
> 赞同：3
> 
> 时间：2008-10-30T17:25:17.437
> 
> 标签：asp.net, css

在[这个问题](https://stackoverflow.com/questions/226206/alternating-item-style)中，我得到了一个非常酷的答案，即分别在左右交替图像及其描述。现在我想将样式应用于两者，例如 padding-top、padding-bottom 等。在这种情况下，如何将样式应用于 RowStyle 和 AlternatingRowStyle。

```
<AlternatingRowStyle CssClass="ProductAltItemStyle" />   
<RowStyle CssClass="ProductItemStyle" />
<Columns>
    <asp:TemplateField>
        <ItemTemplate>
            <div class="Image"><asp:Image runat="server" ID="productImage" ImageUrl='<%# Eval("imageUrl") %>' /></div>
            <div class="Description"><asp:Label runat="server" ID="lblProductDesc" Width="100%" Text='<%# Eval("productDesc") %>'></asp:Label></div>
        </ItemTemplate>
    </asp:TemplateField> 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-30T17:26:30.243

这是你如何做到的：

```
.ProductAltItemStyle, .ProductItemStyle {
    // CSS Rules that apply to both go here
}
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T18:04:53.237

或者，您可以这样做：

```
<AlternatingRowStyle CssClass="ProductAltItemStyle ProductCommonStyle" />   
<RowStyle CssClass="ProductItemStyle ProductCommonStyle" /> 
```

ProductCommonStyle 包含交替行和标准行通用的格式。

更好的是，您可以为整个网格视图分配一个样式，并使用它来定义共享类：

```
table.GridViewStyle tr td
{
   padding:3px 5px;
   border:1px solid gray;
}

tr.ProductAltItemStyle td
{
    background:white;
}

tr.ProductItemSTyle td
{
    background:silver;
} 
```

# tsql - 如何在 T-SQL 中将 YYYYMMDD 形式的 varchar 字段转换为日期时间？

> ID：251033
> 
> 赞同：7
> 
> 时间：2008-10-30T17:25:41.833
> 
> 标签：tsql, datetime

如何在 T-SQL 中将 YYYYMMDD 形式的 varchar 字段转换为日期时间？

谢谢你。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-30T17:28:39.350

```
select convert(datetime, '20081030') 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T17:28:42.687

使用 CONVERT() 函数？

[http://msdn.microsoft.com/en-us/library/ms187928.aspx](http://msdn.microsoft.com/en-us/library/ms187928.aspx)

# c# - 最佳同步策略

> ID：251035
> 
> 赞同：0
> 
> 时间：2008-10-30T17:25:57.200
> 
> 标签：c#

我有一个简单的应用程序，每次单击按钮时都会写入一个 xml 文件。完成此操作后，我很快就读取了 Xml 文件（如下几行，中间没有任何方法可以介入）。

当应用程序第一次运行时，xml 文件被写入/读取，但如果我再次按下按钮，我会得到“文件正在被另一个进程使用”。我正在用我的流进行整个刷新、关闭、处理，并打算使用 ProcessMon 检查哪个进程正在保存文件。

以编程方式，避免此问题的最佳策略是什么？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T17:29:27.943

只需确保文件已写入，然后使用您刚刚写入文件的内存数据即可。
你不需要再读一遍。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T18:07:44.573

the easiest solution would be to just lock all of the code that accesses the xml file

i.e.

```
object locker = new Object();

....

lock (locker)
{
     //write xml file
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T19:27:21.900

我想我已经在其他地方回答了这个问题。在关闭之前调用 Flush() 方法，并使用单独的 FileStream 对象。我认为 FileStream 对象是问题所在，这就是为什么在完成编写后 Flush() 总是好的原因。

不过，对于读者来说，没有等效的方法。这就是我最终使用 FileSTream 对象的原因。

鲁德多

# .net - 是否可以在 TransactionScope 中执行 SQL 命令并发送 MSMQ 消息？

> ID：251050
> 
> 赞同：2
> 
> 时间：2008-10-30T17:29:26.367
> 
> 标签：.net, sql, transactions, msmq

我正在研究将 MSMQ 用于我团队的新项目，但我需要知道我是否可以发送 MSMQ 消息并在 System.Transactions.TransactionScope 中执行 SQL 命令，并让它们一起提交或回滚。我在网上找不到一个可靠的来源，用代码示例说“是”。

我需要将一些消息发送到单个队列并在单个数据库中插入一些记录，但我需要一起成功或失败。

编辑：我无法在我的测试中实际验证这是否有效（我很快就完成了这项任务），但所有文档都指出 TransactionScope 确实在同一实例中捕获 MSMQ 消息和 SQL 命令。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T17:54:47.830

根据个人经验，我知道 TransactionScope 与 SQL 配合得很好。我对 MSMQ 不太熟悉，但快速的[Google 搜索](http://www.google.com/search?q=msmq+transactionscope)显示了一些看起来运行成功的示例（通常是论坛讨论）。System.Messaging.MessageQueue 对象也有一个 .Transactional 属性，而 .Send() 方法有一个 MessageQueueTransaction 参数，所以我想说它们应该一起工作。

这是搜索中某个论坛的代码示例（不是我的代码）：

```
using (TransactionScope scope = new TransactionScope())  
{  
    using (MessageQueue myQueue = new MessageQueue(QUEUE_NAME))  
    {  
    if (myQueue.Transactional)  
        {  
        myQueue.Send(TicketTextBox.Text, "Message", MessageQueueTransactionType.Automatic);  
        }  
    }  
scope.Complete();  
} 
```

只需将您的 SQL 代码放入 TransactionScope 的 using() 块中（在 .Complete() 之前），您就可以开始了吗？

# oracle - 使用 DBMS_AQ.POST 的示例及其实用程序的说明

> ID：251060
> 
> 赞同：0
> 
> 时间：2008-10-30T17:31:57.657
> 
> 标签：oracle, messaging, advanced-queuing

DBMS_AQ 包有一个称为 POST 的方法。

文件说，

> 此过程发布到匿名订阅列表，允许注册订阅的所有客户端获得持久消息的通知。缓冲消息不支持此功能。

和

> 此调用提供了尽力而为的保证。通知最多发送给注册客户一次。此调用主要用于轻量级通知。如果应用程序需要更严格的保证，那么它可以加入队列。

我理解所有用词，但我看不出非保证消息传递的目的。我排队一些东西，因为我需要它去某个地方。也许只是我的企业没有这方面的用例。我想知道您对这种技术有什么用例。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-31T00:01:48.667

首先想到的是，您可能有大量对 DB 信息感兴趣的客户端应用程序。某些系统会触发一个事件，该事件会使用有用但不那么重要的信息（例如，向用户显示的表中的总行数）更新数据库。

然后它想将这个广播给客户端，但是如果客户端真的很忙（或短暂离线 - 例如网络断开），这种方法可以用来丢弃不重要的消息。这可能是在某些情况下采取的最佳方法，就好像它们处于脱机状态一样，客户端在重新连接时可能会再次主动查找所有信息。

虽然有一些用例，但我猜它们比有保证的交付要少得多——就像 TCP 似乎比 UDP 使用得多。

# iis - 你认为微软永远不会在 IIS 中支持经典的 asp

> ID：251065
> 
> 赞同：11
> 
> 时间：2008-10-30T17:33:27.233
> 
> 标签：iis, asp-classic

我们正试图就我们对经典 asp 的支持做出重大决定。有没有人看到微软不能放弃对 IIS 的支持的原因。

任何已放弃支持的 Microsoft 技术示例都会有所帮助。ASP 是一个棘手的问题，因为与其他技术不同，放弃对 IIS 的支持最终会扼杀它。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-30T17:39:02.043

我认为它将在近期到中期得到支持。[在这里](http://www.hanselman.com/blog/LifecycleSupportForClassicASPInWindows.aspx)支持这一点的证据

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-30T17:36:27.990

我认为这是一种可能性，因为它在 IIS7 中默认未启用。

另一点是 Visual Studio 2003 需要 hack 才能使其与 Vista 一起使用。因此，认为 IIS10 需要 hack 才能使经典的 ASP 工作可能不是一件容易的事……

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-30T17:37:15.477

对 VB 6 的编程支持已被删除，因为除非发生非常严重的事情，否则它们不会修复任何错误，但仍支持平台和运行时。我怀疑 IIS 上的 ASP 也是如此。

从这篇[文章](http://msdn.microsoft.com/en-us/vbrun/ms788708.aspx)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-30T17:40:27.313

我的想法转向 Visual Fox Pro，它*应该*至少在 5 年前就已经死了。上周我刚刚遇到有人在生产软件中使用它。话虽如此，您可能应该担心的是：

1.  Will it become difficult or costly to hire programmers that know classic ASP?
2.  Will the cost of maintaining classic ASP go up from a hosting perspective?
3.  Will it become costly to the business to use a technology like classic ASP that might not easily integrate with newer web technologies?
4.  Will you loose employees that would rather be working on something newer aka better for the resume and more interesting?

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-01-31T07:17:58.923

Microsoft announced today that ASP will be supported on Windows 8 for a minimum of 10 years after its release date. ASP is currently supported on all shipping versions of IIS.

Here is the latest word direct from MS:

[http://support.microsoft.com/kb/2669020](http://support.microsoft.com/kb/2669020)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T17:36:52.123

这是 MS 的产品：他们可以用它做任何他们想做的事：他们已经放弃了对其他平台的支持，因为它们已经成熟/被替换。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T17:55:13.040

Given how widespread classic ASP is, I believe they will support it for a long time to come even if it's by punting the support on newer platforms to some sort of virtualization technology.

But given the amount of clout that I have at Microsoft, the fact that I've made this observation means that now they'll probably drop support starting with the next version of IIS.

*Damn you, Heisenburg!!*

*...shakes fist in the air dramatically*

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-30T20:02:52.830

> Any examples of Microsoft technologies like this that have had their support dropped would help

What, like VB6? *Everything* will eventually get it's support dropped. It's too expensive for any company, even one with pockets as deep as Microsoft, to support everything forever.

TBH, I see this as a good reason to use open source projects. Even if the rest of the world drops an OSS project, you can still do whatever you want and have the source code around to do anything you need to.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-03T00:22:39.180

Given that **Microsoft added support for classic ASP back into Visual Studio 2008 via SP1** due I believe, to developer demand, I think they now fully appreciate how widespread classic ASP is and the need to continue supporting this technology.

I can't see them dropping it in the near future at least.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-30T17:37:26.180

“经典”Visual Basic 6 已不受支持。

当然*，*微软最终会放弃对 Classic ASP 的支持。永远支持每个产品不是他们的政策。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-30T17:56:12.630

[ASP tips for IIS7](http://blogs.iis.net/bills/archive/2007/05/21/tips-for-classic-asp-developers-on-iis7.aspx) is another link showing there will be support for it in the latest IIS. [MCMS 2002](http://support.microsoft.com/gp/lifean26) is approaching its end of mainstream support which is coming soon though isn't quite the same scale as what ASP is.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-30T18:14:45.543

It may not be supported out of the box in the future, but I would assume some patch or addon will be provided for support. There are still a lot of sites using ASP for processing, might put them in a crunch if they have to upgrade soon.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-30T19:04:29.623

I believe the answer to this question, like many decisions at Microsoft, is more legal than technical.

Basically, before any major action is taken at MS, it must get passed the question, "*If we do this, how likely is it that someone will sue us?*"

Now, for MSFT to be sued over Classic ASP, the plaintiff would have to show that MSFT's actions prevented them from doing business (which here we'll assume that involves running a Classic ASP website). To reach that level, we'd need an IIS version N which cannot run Classic ASP at all, with IIS version N-1 no longer supported.

Verson N-1 of OS related apps tend to be supported 5 to 8 years after the release of Version N. On the other hand, maintaining minimal support of Classic ASP in IIS version N & N+1 etc should be trivial, and avoids the potential of lawsuit entirely.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-31T05:36:38.767

While .NET is "technically" 1000x better than Classic ASP, Microsoft would be abandoning a lot of future code superstars. I started learning how to code almost 20 years ago with BASIC for the same reason ASP is valuable... it's basic.

And let's face it, with a little know-how and today's low-cost high-performance servers you can make just about any Classic ASP application fly like there's no tomorrow.

Every major O.S. needs, MUST HAVE, a fairly robust "non-compiled" counterpart to keep people educated and interested otherwise they would be placing a huge wall in front of their future growth... new coders gravitate towards the path of least resistance.

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-03-23T16:01:46.737

This question has been answered quite nicely in Scott Hanselman's blog:

[http://www.hanselman.com/blog/LifecycleSupportForClassicASPInWindows.aspx](http://www.hanselman.com/blog/LifecycleSupportForClassicASPInWindows.aspx)

It looks like the Classic ASP runtime will be around until 2018 - ish?

# arrays - 比较排序是否必须比较所有相邻单元格？

> ID：251068
> 
> 赞同：3
> 
> 时间：2008-10-30T17:33:48.573
> 
> 标签：arrays, algorithm, sorting

比较排序是否必须比较 A[i] 最大值和 A[i+1] 最大值？我认为任何比较排序都必须，但我不确定。我检查了归并排序、插入排序和快速排序，并且必须比较它们中的 A[i] 最大值和 A[i+1] 最大值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T20:31:18.590

每个正确的算法都必须比较相邻的单元格，除非它们相等。证明：否则假设。最终数组中的 A[i] 和 A[i+1] 尚未进行比较（A[i] < A[i+1）。如果它们的位置在原始数组中交换会发生什么？该算法进行的所有比较都给出了与原始 run(*) 相同的结果，因此它执行相同的排列，因此它们的最终位置被交换，因此它使算法不正确。

(*) 这是因为 A[i] 和 A[j] 是相邻的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T17:46:02.557

是的，在任何比较排序中，相邻的单元格总是会相互比较。有关比较排序下限的更精确定义，请参阅[此页面。](http://en.wikipedia.org/wiki/Comparison_sort#Number_of_comparisons_required_to_sort_a_list)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T17:55:33.427

是的，除非有至少 3 个相同的元素。如果不这样做，就无法保证您已正确排序。避免比较所有对的唯一方法是传递原则。

```
A[i] > A[j] and A[j] > A[k] implies A[i] > A[k]. 
```

对于不同的连续值，没有中间值可以帮助您避免比较。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T23:05:24.583

Shell 排序不比较相邻的单元格。这就是它们与慢速排序（冒泡、插入、选择）相比获得一些效率的方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T17:42:25.780

Quicksort 和 Mergesort 将始终比较相邻元素。只有当两个元素不比较时，算法才知道两者之间有一个元素。我认为大多数其他*O* ( *n* log *n* ) 排序算法也是如此。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T17:44:06.227

我怀疑不是。考虑一组完全由一个值的副本组成的值。这些被划分为 2 组 A 和 B，使得 A 组中的任何值都不大于 B 组中的任何值。然后在它们自身内部进行排序。A 的结束值和 B 的开始值不需要进行比较。

我不知道是否有任何实际的例子，但想想很有趣。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T17:50:02.817

对于这类问题（很像更一般的比较排序是 n-log-n 方法），一个（迷你）“对手”论点将是有效的——尝试破坏任何算法，在某些输入上，它不会做这样的比较。

这个想法与更一般的“比较排序需要 O(n log n) 比较”证明非常相似，所以我想你最近或者即将在你的课堂上看到它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-30T22:57:01.183

因为我的英语，对不起..我的英语不流利。

@see 动画排序算法：http: [//vision.bc.edu/~dmartin/teaching/sorting/anim-html/all.html](http://vision.bc.edu/~dmartin/teaching/sorting/anim-html/all.html)

本站展示了 8 种排序算法的比较：插入·选择·冒泡·壳·合并·堆·快速·快速3

# oracle - 从 Oracle 10g 降级到 9i 时要寻找什么？

> ID：251069
> 
> 赞同：3
> 
> 时间：2008-10-30T17:35:04.857
> 
> 标签：oracle, downgrade

我不得不将我的 Oracle 实例从 10g (10.1.0.2.0) 降级到 9i (9.2.xxx)。没有计划这样做，我没有记录 10g 依赖项。

我必须解决对 10g 的哪些依赖关系？

我可以执行任何类型的查询来检测依赖关系吗？

当然，我希望有一个灵丹妙药，而不是筛选大量的功能添加来与 100 klocs 的 PL/SQL 进行比较。

顺便说一句，我们并没有就地降级数据库，而是从 10g 实例迁移到单独的 9i 实例。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T17:52:01.050

Take a look at the [Oracle 10G New Features](http://download.oracle.com/docs/cd/B19306_01/server.102/b14214/toc.htm) documentation to see what you need to not be using.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T18:10:07.127

There are a host of parameters you could set to put you in 9i compatibility, turn off hash group by's etc.

You could start to make your 10g instance look a lot more like 9i without moving it anywhere. Won't be perfect but it's a start.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T18:25:41.107

大人物（据我所知）。如果您在这些领域具有功能，请仔细查看：

*   正则表达式是 10g 中的新内容。
*   嵌套表集合函数
*   分层查询的一些功能（CONNECT_BY_ISCYCLE、NOCYCLE、...）
*   对象和集合改进（新的集合函数，在创建后修改 varray 的最大大小，...）
*   行间计算（SQL MODEL 子句）。

[@tony-andrews](https://stackoverflow.com/questions/251069/what-to-look-for-when-downgrading-from-oracle-10g-to-9i#251118)：正如 Tony 所提到的，10g 新功能文档中可能有更多细节，我确信我的模糊和无知的大脑已经遗漏了这些细节。

# wcf - 企业服务总线和消息代理

> ID：251071
> 
> 赞同：2
> 
> 时间：2008-10-30T17:36:34.950
> 
> 标签：wcf, remoting, soa

好吧，伙计们是时候变得愚蠢了，我想开始研究 WCF，但老实说，在我这样做之前，我想了解更多关于 SOA 的一般知识。

我不太了解“企业服务总线”的概念，不确定它是模式/方法还是软件。此外，sam 可以说是“消息代理”。

除此之外，大型 SOA 框架（例如 BizTalk、WebSphere 等）如何适应这里？就此而言，WCF 如何适应？

我真的不喜欢这些东西，所以你能不能让你的答案尽可能简单，不要试图用科学来困惑。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T20:38:28.060

简单来说，SOA 将您与表示相关的组件与获取内容的机制分离。

这听起来很微不足道，但其想法是表示组件不仅应该独立于获取数据的程序，而且应该与它无关。

为此，创建了一个“服务”抽象层，其中包含著名的“企业服务总线”（ESB）。ESB 是知道服务位于何处以及如何调用它们以将数据中继给请求者的程序。

如今，SOA 已成为企业级系统中的一种标准，而不仅仅是一种选择，原因很简单，即数据**是**（而不是“可能”）从不同的来源获取的。例如，登录/身份验证服务可能是基于集中式 LDAP 的；可以使用与托管数据库引擎的 JDBC 连接来获取订单详细信息；信用卡授权可能正在使用支付网关 Web 服务调用；等等...

使用这种架构的最大优势是，如果明天可以从不同的资源获得相同的服务，那么对核心应用程序设计的影响为零或最小。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T00:58:49.420

我同意，将流行语与现实脱钩可能很棘手。

这是我的想法：

SOA 是关于围绕服务定位您的业务功能。这意味着要考虑具有（通常）定义良好的接口的功能黑盒。SOA 通常还涉及使服务可用的前期工作——这将它与更老式的“集成”区分开来——尽管两者之间存在高度交叉。

ESB 只是一个架构层，它允许您将服务连接在一起。通常它会添加连接、路由、协议转换等。它是可选的，但仍然是许多 SOA 项目的典型组件。这是一种模式，但许多软件供应商都有可以帮助实现该模式的 ESB“产品”。

诚然，这些都是模糊的答案，一些软件/服务供应商有更具体的定义（以及实现它们的各种技术）。你必须自己考虑这些。

**免责声明**：我作为 WebSphere 顾问在 IBM 工作，但我并不是以官方身份代表他们发言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-24T00:10:20.657

ESB 提供了一个基于标准的集成平台，它将消息传递、Web 服务、数据转换和智能路由组合在一个事件驱动的 SOA 中。ESB 是迈向完整 SOA 的重要步骤之一。

Biztalk Server 2006 等框架及其 ESB Guidance 工具包旨在成为 ESB。您可能已经知道，Biztalk 提供开箱即用的消息传递、Web 服务和转换功能。借助 ESB Guidance 工具包 ( [www.codeplex.com/esb](http://www.codeplex.com/esb) )，BizTalk 现在可以提供基于智能内容的路由和基于行程的处理。这使得集成架构比具有重量级集成代理的传统 EAI 架构更松散耦合。

WCF 可以用作托管服务的轻量级容器，消费者可以通过 ESB 访问这些服务。

从硬件世界打个比方，ESB 就像您 PC 中的主板，所有设备都通过总线插入到板上，然后到板上来确定不同设备如何相互通信。设备只需要知道它们与总线接口的方式。

干杯

# c# - wsdl.exe 导致“找不到 SOAP 1.1 绑定”

> ID：251079
> 
> 赞同：3
> 
> 时间：2008-10-30T17:38:49.327
> 
> 标签：c#, asp.net, web-services, wsdl

我正在尝试实现一个 HTML Parsing Web 服务，如*ASP.NET Unleashed*（第 1 版）的第 23 章和[这篇 MSDN 文章中所述](http://msdn.microsoft.com/en-us/library/xxb0bsdh.aspx)。到现在为止还挺好！但是，在使用 wsdl.exe 生成类时，我确实收到了一个恼人的警告：

```
Microsoft (R) Web 服务描述语言实用程序
[Microsoft (R) .NET Framework，版本 2.0.50727.3038]
版权所有 (C) 微软公司。版权所有。

警告：此 Web 参考不符合 WS-I Basic Profile v1.1。
未找到 SOAP 1.1 绑定：WS-I 的基本概要 1.1 包括
建议如何使用一组核心 Web 服务的实施指南
应该一起使用规范来开发可互操作的 Web
服务。对于 1.1 Profile，这些规范是 SOAP 1.1，
WSDL 1.1、UDDI 2.0、XML 1.0 和 XML 模式。

有关 WS-I Basic Profile v1.1 的更多详细信息，请参阅规范
在 http://www.ws-i.org/Profiles/BasicProfile-1.1.html。

```

如果可能的话，我想符合规范。我查看了[推荐页面](http://www.ws-i.org/Profiles/BasicProfile-1.1.html)并在 w3.org 上找到了几个页面，但没有找到我需要包含哪些 xml 元素以符合要求的具体示例。

代替发布我的 xml，我只想说 wsdl 大致符合 MSDN 文章中使用的内容（除了我通过添加“.dtd”修复了 w3.org 上 XMLSchema 的无效 URL）。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T18:38:44.090

[`Wsdl.exe`](http://msdn.microsoft.com/en-us/library/7h3ystb6(VS.80).aspx)默认情况下使用**SOAP**作为协议来实现，因此会尝试检查与基本配置文件的一致性。无论如何，`wsdl.exe`处理这个并继续只有一个警告。如果您查看[MSDN 文章文件](http://msdn.microsoft.com/en-us/library/xxb0bsdh.aspx)，您会注意到绑定配置为使用**HttpGet**协议。所以，如果你想抑制警告，运行

```
wsdl.exe /protocol:HttpGet <url or path> 
```

但是，生成的代理类与前一个相同。

*旁注*：您不必修复任何定义命名空间的 URL，因为它不是用作 URL 而是用作标识符。尽管许多名称空间看起来像 URL，但它们不需要指向 Web 上的实际资源。命名空间`http://www.w3.org/2001/XMLSchema`由 W3C 在[XML Schema 推荐](http://www.w3.org/TR/xmlschema-1/)中定义。

# c# - Linq to SQL Class - Stored Procedure Signature Change

> ID：251088
> 
> 赞同：7
> 
> 时间：2008-10-30T17:42:47.947
> 
> 标签：c#, linq-to-sql

I have a Linq to Sql .dbml file which auto generates my method signatures for certain stored procedures. eg, I have in SQL `spGetEmployees(@Name)` so in my data context I have `spGetEmployees(string Name)`.

Now, my underlying sp changed to add an additional parameter: `spGetEmployees(@name, @count)` and so I want the function in my `DataContext` to change as well. Is there a way to do this without dropping the stored proc from the Linq to Sql class file and re-adding it?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T18:03:46.423

Currently if you use the ui you must drop the function and add it back there is no refresh yet. You can automate this class with sqlmetal.exe this will allow you to regenerate these files every time you update your database.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T18:14:54.480

[可从http://www.huagati.com/dbmltools/](http://www.huagati.com/dbmltools/)获得执行此操作的第三方工具

# vim - VIM visual mode: highlight last 2 chars in each line?

> ID：251090
> 
> 赞同：3
> 
> 时间：2008-10-30T17:44:27.523
> 
> 标签：vim

I like Vim's visual mode. `v` for highlight/select chars or lines, `Ctrl``v` for rectangle highlighting, as far as I know (I am a beginner). Is there any way to use visual mode to highlight last two chars, for example, on each line for some selected lines? The selected lines are in different length. Basically, I would like to find a quick way to remove the last two chars for some selected lines. Not sure I can use visual mode to highlight irregular area.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-30T17:57:44.250

My approach to this sort of problem is to use line selection (shift-V, cursor movement) to select the lines-of-interest, then type:

```
 :s/..$// 
```

That's a substitution, using the regex `..$` which will match the last two characters at the end of the line. Then substitute 'nothing' i.e. delete.

In vim, once you hit the `:` with a line selection active, the command prompt will actually show:

```
:'<,'> 
```

Which is the start and end of selection addresses for the next command (s in this case)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T17:56:38.527

I can't think of a way to do this in visual mode, but you could use a command like this to do it...

```
:10,20 normal $xx 
```

This would go to each line between line number 10 and 20, use $ to go to the end of the line, and then use x twice to delete two characters. Normal just tells vim to use the following symbols as if they were keyboard shortcuts entered in normal mode (i.e after hitting esc).

Does that help?

# asp.net - runat=server 容器内的 GridView/ObjectDataSource 未绑定

> ID：251091
> 
> 赞同：1
> 
> 时间：2008-10-30T17:44:32.593
> 
> 标签：asp.net, data-binding, gridview, objectdatasource

我有一个带有 2 个单选按钮的小型 Web 表单，分别称为 PickFromList 和 EnterValue。选中 PickFromList 后，我​​想显示一个已配置为绑定到 ObjectDataSource 的 GridView。当 EnterValue 被选中时，我希望 GridView 消失。

此表单使用表格进行布局，并希望根据适当的数据和用户输入隐藏/显示适当的行。

不幸的是，当 trPickFromList2 行指定 id 和 runat="server" 属性时，GridView 没有绑定。如果我从 trPickFromList2 行中删除 id 和 runat="server" ，它将成功绑定。

有任何想法吗？

```
<table id="tblOptions" runat="server">
    <tr id="trPickFromList1" runat="server">
        <td>
            <asp:RadioButton ID="rbFromList" runat="server" GroupName="Selection" 
                Text="Get Data From Existing Item" AutoPostBack="True" 
                oncheckedchanged="rbromList_CheckedChanged" />
        </td>
    </tr>
    <tr id="trPickFromList2" runat="server">
        <td style="padding-left:20px">
            <asp:GridView ID="gvList" runat="server" AutoGenerateColumns="False" 
                DataSourceID="odsList" Width="400px" onrowdatabound="gvList_RowDataBound">
                <Columns>
                    ...
                </Columns>
            </asp:GridView>
        </td>
    </tr>
    <tr id="trEnterValue1" runat="server">
        <td>
            <asp:RadioButton ID="rbEnterValue" runat="server" GroupName="Selection" 
                            Text="Create a New Item"
                            AutoPostBack="True" 
                            oncheckedchanged="rbEntered_CheckedChanged" />
        ... 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-04T13:10:05.697

我最终实现了[Wilco Bauwer 的 RowSelectorField 控件](http://www.wilcob.com/Wilco/News/RowSelectorFieldForGridView.aspx)来解决这个问题。这不是一个完美的解决方案，因为控件显示所选行的索引值而不是所选数据键值；但是，效果很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T18:44:19.257

为什么不使用 javascript 显示/隐藏 TRs？这样您就不会遇到这个问题，并且您将拥有一个响应速度更快的 UI。

使用 jQuery：

$('.classOnShowRadioButton').click(function(){ $('.trToShow').show(); $('.trToHide').hide(); });

然后显然对另一个单选按钮执行相反的操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T18:07:08.273

嗯..不太确定，但让我有好几次的事情是将 AutoWireEvents 设置为 false，它位于 <% page /%> 部分的顶部。抱歉，如果没有帮助，但是像这样烦人且微不足道的事情很可能是问题所在。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T18:39:13.467

如果乔建议的 AutoWireEvents 回答不是问题，您还可以尝试从 tr 标签中删除 runat=server，而是用占位符包装它们并使用占位符来控制可见性。（注意，不要使用面板，因为它会导致无效的 html）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T19:17:14.963

我[注意到](http://devio.wordpress.com/2008/04/24/formview-no-update-inside-run-at-server-table-control/)带有 runat="server" 的 TR 标记内的 FormView 有相同的行为

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T20:02:21.550

您使用表格进行布局的任何特殊原因？尝试从表格中取出所有控件，并使单选按钮使实际的 GridView 可见/不可见。

# windows-vista - 在 Windows 中打开演示模式？

> ID：251104
> 
> 赞同：8
> 
> 时间：2008-10-30T17:47:22.417
> 
> 标签：windows-vista

Windows Vista 具有“演示模式”，您可以使用移动中心将其打开。

如何以编程方式打开它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-17T09:23:30.157

我发现的唯一方法是`presentationsettings.exe`使用`/start`或`/stop`直接调用。

我还找到了描述如何在台式电脑上激活演示模式的链接：[http ://www.dubuque.k12.ia.us/it/mobilitycenter/](http://www.dubuque.k12.ia.us/it/mobilitycenter/)

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-05-04T23:19:48.703

这已经很老了，但我发现这在第三方程序中不起作用，因为 cmd 没有继承环境，因此它们不像在运行框中那样工作：

*   `PresentationSettings`
*   `PresentationSettings /start`
*   `PresentationSettings /stop`

但是，使用 powershell 生成一个新环境，我可以使用以下命令以编程方式调用它：

*   `Start-Process cmd -ArgumentList "/c PresentationSettings"`# 生成一个 GUI
*   `Start-Process cmd -ArgumentList "/c PresentationSettings /start" -NoNewWindow`# 在没有 gui 的情况下执行，但图标出现在托盘中
*   `Start-Process cmd -ArgumentList "/c PresentationSettings /stop" -NoNewWindow`# 在没有 gui 的情况下执行，但图标在启动后从托盘中消失。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T21:09:56.203

这似乎满足了您的需求： [链接文本](http://blogs.msdn.com/kaevans/archive/2006/09/25/770484.aspx)

# tortoisesvn - TortoiseSvn 和 Windows Server 2008 用户帐户控制

> ID：251109
> 
> 赞同：29
> 
> 时间：2008-10-30T17:49:14.533
> 
> 标签：tortoisesvn, windows-server-2008, uac

这里有一个问题：
**TortoiseSvn 可以在不关闭用户帐户控制的情况下在 Windows 2008 上工作吗？**

故事是这样的：我刚刚将我的测试服务器移至 Windows 2008，但我遇到了 TortoiseSvn 问题。我以管理员身份登录，但是当我从 Subversion 存储库更新一些代码时，我收到一条消息： **错误无法设置文件 'C:\dev\trunk.svn\entries' 读写：访问被拒绝** 所以我看到了这样的消息，我知道要运行清理。但是当我运行 cleanup 我得到： **Cleanup failed to process the following paths: C:\dev\trunk**

因此，进一步的调查使我确信我有权限问题。从命令提示符运行**svn status**显示目录被锁定并且运行**svn cleanup**失败，就像乌龟清理一样。但是当我以管理员身份启动命令提示符时，我可以毫无问题地运行**svn cleanup并且可以运行****svn up**并更新我的文件。

更新：这是一个 Windows UAC 权限问题。关闭 UAC 可以解决此问题。但我想找到一个不需要关闭 UAC 的解决方案。由于 Tortoise 是一个 windows shell 扩展，我不知道如何让它以管理员身份运行。

有什么建议么？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-12-27T21:11:17.987

右键单击您的工作副本 c:\dev 文件夹，从上下文菜单中选择“属性”。在属性对话框中，转到安全选项卡。您会注意到 Admin 用户没有完全访问权限（该用户未在此处列出）。添加管理员用户并授予其完全访问权限。

是的，管理员用户通常对所有文件夹具有完全访问权限，但仅在 UAC 提示之后。应用程序通常不提供 UAC 提示，而是收到拒绝访问错误。要在没有 UAC 提示的情况下授予管理员用户对该文件夹的完全访问权限，您必须手动添加该用户。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-30T17:53:52.853

获得所有权并让自己完全控制 C:\Dev\Trunk.svn 和子项。那应该可以解决您的问题。

我建议不要关闭 UAC。如果您需要关闭它，您可以通过控制面板\用户帐户\打开或关闭用户帐户来完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T17:57:11.913

我在打开 UAC 的 Windows Vista SP1 上使用 TortoiseSVN。我没有任何问题。由于 Vista SP1 和 Windows 2008 本质上是相同的操作系统，我认为您可能遇到了另一个问题。

SVN 对临时文件做了很多重命名，如果存在共享冲突，它就不是特别健壮。我发现一些防病毒产品会发现 SVN 刚刚关闭了一个（临时）文件。他们会扫描它，当他们扫描它时，SVN 会尝试重命名它——共享违规：boom。搜索索引器有时会导致同样的问题。

看看你是否可以阻止你的源目录被索引，或者阻止你的 AV 对它们进行实时扫描。您可以排除目录，也可以排除 TortoiseProc.exe 进程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-02-08T00:37:18.767

We just updated to SVN 1.9.3, but we use SVN on our development server to update our testing sites directly from the repository by checking out the website files. We found that users who did not perform the original checkout do not have permission to run an SVN update. Now, all of these users are part of the administrators group, and it still did not matter, but what we found was very odd is that you can add the Everyone group to the checked out folder, and then anyone is able to perform an SVN Update.

I don't understand why the everyone group being added would be able to perform this, and not anyone from the Administrators group.

我确保管理员组具有完全控制权，并且它被传播到所有子目录和文件。没有关系。

如果其他人对此有解释，那将非常有帮助。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2012-08-13T23:06:27.230

Did you try navigating to Program Files\TortoiseSVN\bin in Windows Explorer and setting "run ad administrator" on TortoiseProc.exe > Properties > Compatibility?

# sql - 如何从 SQLServer2005 表中删除字段

> ID：251110
> 
> 赞同：5
> 
> 时间：2008-10-30T17:49:32.863
> 
> 标签：sql, sql-server-2005

我试过这个：

```
ALTER TABLE My.Table DROP MyField 
```

并得到这个错误：

-MyField 不是约束。

- 无法删除约束。请参阅以前的错误。

表中只有一行数据，并且刚刚添加了该字段。

**编辑：** 只是跟进，sql确实缺少COLUMN。现在我得到了更严重的错误：

*   对象“some_object__somenumbers”取决于列“MyField”
*   ALTER TABLE DROP COLUMN MyField 失败，因为一个或多个对象访问此列。

**编辑：**

```
ALTER TABLE TableName DROP Constraint ConstraintName 
```

工作，之后我能够使用以前的代码删除该列。感谢你们俩，谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-30T17:50:37.633

我认为您只是缺少 COLUMN 关键字：

```
ALTER TABLE TableName DROP COLUMN ColumnName 
```

您还需要确保首先删除任何依赖于 ColumnName 的约束。

您可以通过以下方式做到这一点：

```
ALTER TABLE TableName DROP ConstraintName 
```

对于您拥有的每个约束。

如果您有基于列的索引，您还需要先删除这些索引。

```
DROP INDEX TableName.IndexName 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T18:11:35.067

布赖恩解决了你原来的问题——对于你的新问题（对象'some_object__somenumbers'依赖于列'MyField'）这意味着你有一个依赖问题。诸如索引、外键引用、默认值等。要删除约束，请使用：

```
ALTER TABLE TableName DROP ConstraintName 
```

另外 - 您需要先删除依赖于该列的所有约束，然后它才能让您删除列本身。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-29T11:05:27.077

```
ALTER TABLE TABLE_NAME ADD COLUMN SR_NO INTEGER(10)NOT NULL; 
```

# database - 使用 Wiki 的方法 - 混合数据库

> ID：251113
> 
> 赞同：10
> 
> 时间：2008-10-30T17:50:28.027
> 
> 标签：database, wiki

我需要一个数据库，其中一个（或多个）字段的行为类似于 wiki。我希望 wiki 的自由形式内容创建方面得到数据库严格语义结构的支持。

具体来说，我需要这个数据库字段来保存 wiki 样式的标记、跟踪多用户更改、允许还原等......

我是从几个方向来的：

*   通过使该字段指向来自单独的 wiki 系统的页面，将 wiki 嵌入数据库。
*   围绕 wiki 构建数据库（为我的结构化数据每页创建额外的字段）。
*   或者用我自己的系统从头开始构建它来跟踪这个领域的变化（考虑到有多少维基软件，这真的有必要吗？）

有没有人有任何经验或见解接近这个建设？或者任何人都可以向我指出一个可以让我上路的框架吗？

我研究过像 TikiWiki 和 TWiki 这样的结构化 wiki，但我不清楚如何完成我想要的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-02-20T18:49:34.650

仅供将来参考，对此感兴趣的任何人可能还想查看[语义媒体维基](http://semantic-mediawiki.org/wiki/Semantic_MediaWiki)扩展：

> **Semantic MediaWiki (SMW)**是 MediaWiki（支持 Wikipedia 的 wiki 系统）的免费扩展，有助于搜索、组织、标记、浏览、评估和共享 wiki 的内容。传统的 wiki 只包含计算机既无法理解也无法评估的文本，而 SMW 添加了语义注释，使您可以轻松发布语义 Web 内容，并允许 wiki 充当协作数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-06-14T08:00:01.967

Halo 扩展只是 SMW+ 中的一个扩展。后者是一个完整的软件包，包含已安装的 MW、SMW 和几个扩展，以实现更好的可用性（例如 WYSIWYG）和功能。它是一个开源的 win 安装程序或 vmware。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T18:05:32.097

[MediaWiki](http://www.mediawiki.org/wiki/MediaWiki)的[属性扩展](http://www.mediawiki.org/wiki/Extension:Attribute)将允许您向页面添加自定义属性。

如果你真的需要更多，[这里](http://www.mediawiki.org/wiki/Manual:Database_layout)记录了数据库结构。

# .net - Best way to search large file for data in .net

> ID：251115
> 
> 赞同：1
> 
> 时间：2008-10-30T17:51:02.953
> 
> 标签：.net, vb.net, file, parsing

I am working on a project where I search through a large text file (large is relative, file size is about 1 Gig) for a piece of data. I am looking for a token and I want a dollar value immediately after that token. For example,

this is the token 9,999,999.99

So here's is how I am approaching this problem. After a little analysis it appears that the token is usually near the end of the file so I thought I would start searching from the end of the file. Here is the code I have so far (vb.net):

```
 Dim sToken As String = "This is a token"
    Dim sr As New StreamReader(sFileName_IN)

    Dim FileSize As Long = GetFileSize(sFileName_IN)
    Dim BlockSize As Integer = CInt(FileSize / 1000)
    Dim buffer(BlockSize) As Char
    Dim Position As Long = -BlockSize
    Dim sBuffer As String
    Dim CurrentBlock As Integer = 0
    Dim Value As Double

    Dim i As Integer

    Dim found As Boolean = False
    While Not found And CurrentBlock < 1000
        CurrentBlock += 1
        Position = -CurrentBlock * BlockSize

        sr.BaseStream.Seek(Position, SeekOrigin.End)
        i = sr.ReadBlock(buffer, 0, BlockSize)
        sBuffer = New String(buffer)

        found = SearchBuffer(sBuffer, sToken, Value)
    End While 
```

GetFileSize is a function that returns the filesize. SearchBuffer is a function that will search a string for the token. I am not familiar with regular expressions but will explore it for that function.

Basically I read in a small chunk of the file search it and if I don't find it load another chunk and so on...

Am I on the right track or is there a better way?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T17:56:29.010

I think you've got the right idea in chunking the file. You may want to read chunks in at line breaks rather than a set number of bytes, though. In your current implementation, if the token lies on a 1000 byte boundary it could get cut in half, preventing you from finding it. The same thing could cause the data to be cut off as well.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-03T01:26:07.757

Wait you people...

What if the token is broken between two chunks? Have you considered this?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T18:05:53.267

If you're going to use chunks, it would be wise to use blocks which are multiples of 512 bytes long, and seek on a 512 byte alignment, because that will tend to be more efficient in accessing the disk (which ultimately will be in 512 byte blocks).

There may be other granularities even better than that, but 512 would be a good start.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T18:09:20.360

If you wanted to do something more complicated but possibly faster, then you could look at reading the blocks asynchronously, so that you're searching one while the next is loading.

That way you get to perform the search at the same time as the data is chugging into memory.

I have to say though that unless your search is very expensive, disk read time will probably completely dominate this, and so complicated overlapping won't be worth the additional complexity.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-18T11:07:09.177

您始终可以使用 FileStream 搜索文件（或继续按照您的方式进行，您的选择）。如果您决定使用 FileStream 方法，那么您想要做的是这样的：

```
Dim stream As New FileStream("something.txt")
Dim findBytes As [Byte]() = BitConverter.GetBytes("whatever")
Dim f As Integer = 0

' remaining = Length - Position
While stream.Length - stream.Position > 0
    If stream.ReadByte() = findBytes(f) Then
        If ++f >= findBytes.Length Then
            Console.WriteLine(stream.Position)
            Exit While
        End If
    Else
        f = 0
    End If
End While 
```

请注意，我使用 ac# to vb 转换器是因为我不喜欢 vb。

基本思想适用于仅在块中搜索字符串。如果您想在块中添加阅读，这非常简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-02-14T18:19:40.233

“如果令牌在两块之间断裂怎么办？你考虑过这个吗？”

最近才这样做。在覆盖 CurrentBlock 之前，我将 CurrentBlock 保存到了 PreviousBlock 中，然后将这两个 Block 结合起来并检查是否对找到您正在寻找的搜索词感到不高兴！效果很好。搜索词不能转义，除非搜索词大于块的长度。

# eclipse - 项目列表存储在 Eclipse 工作区的什么位置？

> ID：251116
> 
> 赞同：124
> 
> 时间：2008-10-30T17:51:13.857
> 
> 标签：eclipse, project

我将 Eclipse 与“外部”项目一起使用——即从现有源创建的项目。

在工作区文件中四处寻找，我找不到对这些项目的任何引用。我的问题是：Eclipse 如何跟踪这些项目？

我希望能够自动将这样的项目添加到工作区（通过生成`.project`和`.classpath`文件）。

* * *

## 回答 #1

> 赞同：157
> 
> 时间：2008-10-30T17:56:06.547

视窗：

```
<workspace>\.metadata\.plugins\org.eclipse.core.resources\.projects\ 
```

Linux / osx：

```
<workspace>/.metadata/.plugins/org.eclipse.core.resources/.projects/ 
```

您的项目可以存在于工作区之外，但所有特定于 Eclipse 的`metadata`都存储在该`org.eclipse.core.resources\.projects`目录中如tk421storm[的](https://stackoverflow.com/users/2344699/tk421storm)[评论](https://stackoverflow.com/questions/251116/where-in-an-eclipse-workspace-is-the-list-of-projects-stored/251129?noredirect=1#comment122812680_251129)和[Jeegar Patel](https://stackoverflow.com/users/775964/jeegar-patel)的 [回答](https://stackoverflow.com/a/24114078/6309)中所述：

> 为了使手动更改生效，请务必在`File -> Refresh`之后进行。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-03-12T01:35:47.337

在 Mac OS X 中，它位于

```
<workspace>/.metadata/.plugins/org.eclipse.core.resources/.projects 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-30T18:05:10.227

在 Eclipse 3.3 中：

它安装在您的 Eclipse 工作区下。就像是：

```
.metadata\.plugins\org.eclipse.core.resources\.projects\ 
```

**在**您的工作区文件夹中。

在该文件夹下是每个项目一个文件夹。那里有一个名为*.location*的文件，但它是二进制文件。

因此，如果不以编程方式与 Eclipse 进行交互，您似乎无法做自己想做的事。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-04-19T15:41:29.483

如果您使用 Perforce（将项目作为 Perforce 项目导入），则 .cproject 和 .project 将位于 PERFORCE 项目的根目录下，而不是工作区文件夹中。

希望这可以帮助 ：）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-06-09T05:19:03.180

在Linux中删除后

```
<workspace>\.metadata\.plugins\org.eclipse.core.resources\.projects\ 
```

不工作。

之后我完成了**文件->刷新**

然后它清除了从 eclipse 中列出的所有旧项目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T18:11:56.250

您还可以拥有多个工作区 - 因此您可以连接到一个并设置“A”个项目 - 然后在需要时连接到不同的集合。

# iphone - 如何使用导航控制器对 UIViewControllers 进行内存管理？

> ID：251117
> 
> 赞同：6
> 
> 时间：2008-10-30T17:51:36.307
> 
> 标签：iphone, cocoa-touch, memory-management

所以，是的，我是这个疯狂的 iPhone 世界中的 Java 人。当谈到内存管理时，我仍然对自己在做什么不是很清楚。

我有一个使用导航控制器的应用程序，当该进入下一个视图时，我的代码如下所示：

```
UIViewController *myController = [[MyViewController alloc] initWithNibName:@"MyView" 
                                                                    bundle:[NSBundle mainBundle];
[[self navigationController] pushViewController:myController animated:YES]; 
```

现在根据Apple关于内存管理的基本规则

> 如果您使用名称以“alloc”或“new”开头或包含“copy”（例如，、、或）的方法创建对象，或者向其发送消息，则您将获得`alloc`对象`newObject`的`mutableCopy`所有权`retain`。`release`您有责任使用或放弃您拥有的对象的所有权`autorelease`。任何其他时间您收到一个对象，您都不能释放它。

对我来说，这意味着我应该发布`myController`，或者给它一个`autorelease`信息。但是，每当我尝试这样做时，我的应用程序都会在我从堆栈中推送和弹出视图时崩溃。

这对我来说并不合适，但在运行 Instruments 时，它声称我没有任何内存泄漏。

所以我的问题是

1.  我这样做对吗？
2.  导航控制器是否获得了 MyViewController 的所有权，解释了没有内存泄漏？
3.  我应该将 myController 分配给我的根 ViewController 中的实例变量吗？在这种情况下，它将被标记为保留，我将在根的 dealloc 方法中释放

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-30T18:24:12.870

问题是（很可能）您在导航控制器有机会声明所有权*之前释放了您的视图控制器。*有两种方法可以解决这个问题：

*   `-release`将控制器推送到导航控制器*后*
*   `-autorelease`你的控制器*在*推动它之前。如果你这样做，活动的 NSAutoreleasePool （你不需要担心）会在稍后释放你的控制器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T21:29:35.320

@Ben Gottlieb 为什么在推送之前需要自动释放？对象分配时的保留计数为 1，推送之前或之后的自动释放不会影响保留计数，尽管通常在对象分配/初始化之后应用自动释放作为样式问题：

```
[[[object alloc] init] autorelease]; 
```

@bpapa，

2）推送时，导航控制器会保留视图控制器。稍后当这个视图从导航控制器堆栈中弹出时，导航控制器将释放它。

3）除非有明确的理由坚持该视图，否则您不应将其分配给实例变量。通常，您希望您的视图仅在您需要时才存在。

# c# - 在 .net 远程处理中查找远程对象的 IP 地址

> ID：251150
> 
> 赞同：1
> 
> 时间：2008-10-30T18:02:29.950
> 
> 标签：c#, remoting

我有一个使用 .net 远程处理的客户端-服务器应用程序。客户在局域网中，我事先不知道他们的位置。

有时我们会进行文件传输，作为一种优化，我想确定客户端是否实际上与服务器位于同一台机器上（很有可能）。在这种情况下，我只需要做一个 File.Copy。

假设客户端调用远程方法：

RemoteFile server.GetFile(string path);

如何确定客户端（请求者）是否在同一台机器上？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T18:25:22.447

如果您知道要从中调用远程方法的服务器的 IP 地址，则可以使用此方法来判断您是否在同一台机器上：

```
using System.Net;

private bool CheckIfServer(IPAddress serverIP)
{
    // Get all addresses assigned to this machine
    List<IPAddress> ipAddresses = new List<IPAddress>();
    ipAddresses.AddRange(Dns.GetHostAddresses(Dns.GetHostName()));

    // If desirable, also include the loopback adapter
    ipAddresses.Add(IPAddress.Loopback);

    // Detect if this machine contains the IP for the remote server
    // Note: This uses a Lambda Expression, which is only available .Net 3 or later
    return ipAddresses.Exists(i => i.ToString() == serverIP.ToString());
} 
```

如果您不知道远程服务器的 IPAddress，您可以使用服务器的主机名轻松获取它，如下所示：

```
Dns.GetHostAddresses("remote_host_address") 
```

这将返回一个 IPAddress[]，其中包括该主机的所有已解析地址。

# iphone - 在 iPhone 应用程序中将日期持久化到 SQLite3

> ID：251155
> 
> 赞同：16
> 
> 时间：2008-10-30T18:03:30.247
> 
> 标签：iphone, cocoa-touch, sqlite

我正在开发一个将数据保存到 SQLite3 数据库的 iPhone 应用程序。

对于我坚持的每一行，我希望包括一个“创建日期”和一个“最后修改日期”

我的问题是将这些信息存储在表格中的推荐方法是什么？

这些属性在我的应用程序中表示为 NSDate，但我不确定如何在我的表中表示此信息。

似乎 SQLite3 提供了 DATETIME 类型，但对如何解析此信息没有本机理解。

任何帮助将非常感激。

提前致谢。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-30T18:14:57.600

我通常使用双精度，例如：

```
sqlite3_bind_double(statement, index, [dateObject timeIntervalSince1970]); 
```

其中 dateObject 是一个 NSDate*。然后，当从数据库中获取数据时，使用

```
[NSDate dateWithTimeIntervalSince1970:doubleValueFromDatabase]; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-30T19:12:30.620

在 UNSIGNED INT 列中存储为典型的 C 时间（例如 time() 返回的 time_t/int 值）值。像用**NSDate**说的那样转换：

```
- timeIntervalSince1970
- dateWithTimeIntervalSince1970:(double)value 
```

除了存储为整数，除非您需要亚秒级粒度（通常，对于 created-on/last-modified 来说，这是过大的）。无符号整数比双精度整数小得多，也更容易处理。虽然这在大多数桌面和 Web 应用程序中可能不再重要，但它肯定对 iPhone 有帮助。每一点都有帮助。

大多数人没有意识到的 C-times 的一个附带好处是它们与时区无关。如果您需要支持多个时区，这会派上用场。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-30T22:06:55.263

我转换为/从 ISO8601 字符串：[http ://en.wikipedia.org/wiki/ISO_8601](http://en.wikipedia.org/wiki/ISO_8601)

比时间间隔更具可读性/可破解性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T18:14:40.253

[根据文档](http://www.sqlite.org/datatype3.html)，没有 DATETIME 数据类型！我使用*实数*数据类型并使用*timeIntervalSinceReferenceDate*方法将 NSDate 转换为*实数。*

 ** * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-10T22:29:00.180

[如何使用 Objective C 在 SQLite 中获取日期时间列](https://stackoverflow.com/questions/1711504/how-get-datetime-column-in-sqlite-objecite-c/1711591#1711591)

# c++ - C++ 中 const 重载有什么用？

> ID：251159
> 
> 赞同：71
> 
> 时间：2008-10-30T18:04:24.143
> 
> 标签：c++, function, constants, overloading

在 C++ 中，函数的签名部分取决于它是否为 const。这意味着一个类可以有两个具有相同签名的成员函数，除了一个是 const 而另一个不是。如果你有一个这样的类，那么编译器将根据你调用它的对象来决定调用哪个函数：如果它是类的 const 实例，将调用函数的 const 版本；如果对象不是 const，则将调用另一个版本。

在什么情况下您可能想利用此功能？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-30T18:20:40.740

这只有在成员函数返回指针或对类的数据成员（或成员的成员，或成员的成员，......等）的引用时才有意义。通常返回非常量指针或对数据成员的引用是不受欢迎的，但有时它是合理的，或者只是非常方便（例如 [] 运算符）。在这种情况下，您需要提供一个 const 和一个非常量版本的 getter。这样，是否可以修改对象的决定取决于使用它的函数，该函数可以选择将其声明为 const 或 non-const。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-10-30T18:06:25.683

它在那里，因此您可以让编译器强制您返回一个 const 对象还是一个常规对象，并且仍然保持相同的方法签名。[Const Correctness](https://isocpp.org/wiki/faq/const-correctness#const-overloading)有深入的解释。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-31T10:32:46.630

看看 std::map::operator[] 的行为。如果您尝试引用无效键，则 const 版本会引发错误，但非 const 版本会执行插入操作。插入行为比必须使用 std::map::insert 更方便（而且会进行覆盖），但不能用于 const 映射。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-30T18:07:43.280

您可能希望使用它来决定是否返回对对象的 const 引用。STL 的容器使用一个 const 重载的 begin() 和 end() 函数来决定是返回一个 const_iterator 还是一个普通的迭代器。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2019-11-24T09:48:42.133

```
#include <iostream>
using namespace std;
class base
{

public:
void fun() const
{
    cout<<"have fun";
}
void fun()
{
    cout<<"non const";
}

};
int main()
{
    base b1;
    b1.fun(); //does not give error
    return 0;
} 
```

这里编译器不会给出任何错误，因为在`const`函数的情况下编译器会将`this`指针转换为`const this*`. 第三个参数将这两个函数分开。

# naming-conventions - 应用程序何时应该尊重输入的区分大小写？

> ID：251162
> 
> 赞同：1
> 
> 时间：2008-10-30T18:05:09.697
> 
> 标签：naming-conventions, user-input, case-sensitive

我最近推出了一个应用程序，它使用 PGP 自动加密从另一个内部系统输出的文件，然后 sftp'd 到外部目标服务器目录，供第三方应用程序使用。我一直在尝试解决整个过程大约一周的问题，直到今天早上在电子邮件中没有收到第三方的回复......

“<em>原来，文件命名不正确，所以系统认为你没有提交它。有一个大写的“T”应该小写。”</p>

行。*在深深叹了口气之后（因为没有其他人可以访问该目录并且没有其他以类似方式命名的文件），我开始怀疑，“<strong>应用程序何时应该尊重密码之外的*用​​户输入区分大小写？” 我在这里通过我的大脑试图想一个时间，我希望“文件名”和“文件名”有意识地表示不同的东西。

[顺便说一句，我不是在谈论应用程序内变量命名约定。](http://www.codinghorror.com/blog/archives/000458.html)我实际上非常喜欢区分大小写的语言。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T18:08:19.923

我想这取决于它所在的平台。在 Linux 中，区分大小写是默认设置，因此文件系统调用 nessacary 会区分大小写以在目录中查找文件。但除此之外，它不应该。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T02:19:21.517

您希望在以下情况下保留大小写：

*   输入显示回给希望看到与输入完全一致的用户。

*   大写和小写字母具有不同的内在含义，*例如*“kb”（1000 位）*与*KB“（1024 字节）。

*   数据可能会在您的应用程序外部以区分大小写的方式进行处理，如您的问题陈述中。

*   数据将被存储但不会“处理”（搜索、排序、比较），因此不需要标准化。

# database - alter index across schemas

> ID：251172
> 
> 赞同：2
> 
> 时间：2008-10-30T18:07:15.120
> 
> 标签：database, oracle, indexing, grant

I am synchronizing tables using a stored PL/SQL procedure as part of a web application - when they hit a button it does the sync. The PL/SQL is executing as user A, but needs to disable indexes and sync a couple of tables in schema B. I can't get user A to 'alter index B.indexName unusable' despite granting it 'alter any index', and in desperation even DBA. The error is ORA-01418: specified index does not exist. This is working on another developer's sandbox but I can't figure out why. Any suggestions will be appreciated.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T18:11:09.513

Are you granting the ALTER ANY INDEX privilege via a role? Or is the privilege being granted directly to user A?

Privileges granted through a role (such as DBA) are not available to definer's rights stored procedures (the default). Only privileges that are granted directly to the user are available in a definer's rights stored procedure.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T19:05:04.630

我删除了索引并重建了它，这似乎已经解决了上面的问题。现在它让我禁用索引，但告诉我用户没有足够的权限来更改索引...当我完成填充表时在线重建。如果您愿意的话，用户 A 需要什么权限来执行该操作？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T18:11:26.937

索引是否存在？不止一次，我因为不接受错误信息而浪费了时间。

# sql - 如果 SQL Server 2000 中存在表，我如何删除它？

> ID：251181
> 
> 赞同：20
> 
> 时间：2008-10-30T18:11:06.220
> 
> 标签：sql, sql-server

我有一个 DTS 包，它删除一个表，然后创建它并填充它，但有时会发生一些事情，并且包在删除表后失败。如果重新运行它会失败，因为该表尚未创建。

SQLServer 2000 是否有类似 MySQL 的“如果存在”之类的东西？

谢谢。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-30T18:17:42.527

或者更快：

```
IF OBJECT_ID('temp_ARCHIVE_RECORD_COUNTS') IS NOT NULL  
  DROP TABLE temp_ARCHIVE_RECORD_COUNTS 
```

*   [OBJECT_ID - MSDN 参考 - SQL Server 2000](http://msdn.microsoft.com/en-us/library/aa276843%28v=sql.80%29.aspx)
*   [OBJECT_ID - MSDN 参考 - SQL Server 2008](http://msdn.microsoft.com/en-us/library/ms190328(v=SQL.100).aspx "MSDN SQL Server 2000")

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-30T18:13:55.093

```
IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TableName]') AND type in (N'U'))
DROP TABLE TableName;
GO 
```

如果要检查数据库中是否存在其他对象，可以在此处检查[sys.objects 表中的类型定义列表。](http://msdn.microsoft.com/en-us/library/ms177596.aspx)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-30T19:14:56.310

还没有人提到这种方法：

```
if exists (select * from INFORMATION_SCHEMA.TABLES where TABLE_NAME='MyTable') 
begin 
    drop table MyTable
end 
```

这是最便携的方法 - 它至少适用于 MSSQL2000 到 MSSQL2008。

INFORMATION_SCHEMA 表是 SQL-92 标准的一部分。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-30T18:19:47.543

当然：

`IF OBJECT_ID('YOURTABLENAME') IS NOT NULL`

`YOURTABLENAME`你的桌子的名字在哪里。

如果它是一个临时表，那么只需在函数调用`tempdb.#`之前添加。`OBJECT_ID`

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-30T18:44:51.800

当您删除和对象然后添加回数据库时要记住的一件事是将任何权限添加回表。这让我们绊倒了很多次。

我对 TracyNixon 的回答投了赞成票。我想说您不想直接查询 sysobjects 表，因为 Microsoft 更新可能会破坏这种代码。您可以使用 OBJECT_ID 函数将自己与此隔离。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T18:16:05.993

您需要检查[sysobjects](http://msdn.microsoft.com/en-us/library/aa260447(SQL.80).aspx)表

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T18:16:51.420

以下工作，只需将 TABLENAME 替换为您的表

```
IF EXISTS( SELECT * FROM dbo.sysobjects where id = object_id(N'TABLENAME') AND OBJECTPROPERTY(id, N'IsTable') = 1)
BEGIN
    DROP TABLE TABLENAME
END 
```

# winapi - 重置等待计时器

> ID：251189
> 
> 赞同：2
> 
> 时间：2008-10-30T18:13:53.283
> 
> 标签：winapi

来自 MSDN：

> CancelWaitableTimer函数不会更改计时器的信号状态[。](http://msdn.microsoft.com/en-us/library/ms681985.aspx)它会在定时器设置为信号状态之前停止定时器并取消未完成的 APC。因此，对定时器执行等待操作的线程会一直等待，直到它们超时或定时器被重新激活并且其状态设置为已发出信号。*如果计时器已经处于信号状态，则它保持在该状态。*

（强调我的）

那么：如果我不能调用 CancelWaitableTimer，如何将手动重置等待计时器设置为非信号状态？ResetEvent 不适用于可等待的计时器（失败并显示 ERROR_INVALID_HANDLE）。

我不想使用 SetWaitableTimer，因为（此时）我不知道将其设置为什么持续时间。我想我可以将延迟设置为一个很大的数字，但这对我来说感觉有点像黑客。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T18:19:24.380

你可以用一些永远不会发生的非常大的时间调用 SetWaitableTimer 吗？一旦你知道了实际时间，然后再次调用它。

更新：*无论是否破解，文档都非常清楚 mr 可等待计时器“在调用 SetWaitableTimer 之前一直处于信号状态”。在我看来，这就是您将不得不使用的功能。您只需要有一个名为“RESET_TIMER”的不错的常量，它设置为 -2^63 或其他值。*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-23T15:47:27.010

如果您使可等待计时器自动重置，那么一旦等待该计时器完成，它将自动重置。

但是，来自 MSDN：

> 如果多个对象变为信号，则该函数返回数组中第一个句柄的索引，其对象被信号。

我最初认为这意味着如果等待数组中的较早句柄与可等待计时器同时发出信号，您可能会丢失计时器信号，但我已经读过

> WaitForMultipleObjects() 从 0 开始扫描句柄数组，并在找到信号句柄后立即返回。只有第一个找到的句柄被重置为无信号状态；其他的都没有动。

请参阅[多个句柄同时发出信号时 WaitForMultipleObjects 的行为](https://stackoverflow.com/questions/667319/behavior-of-waitformultipleobjects-when-multiple-handles-signal-at-the-same-time)

# msdn - TechNet 或 MSDN 订阅？

> ID：251193
> 
> 赞同：19
> 
> 时间：2008-10-30T18:14:36.260
> 
> 标签：msdn, subscriptions, technet

我只是一个单人软件商店，我目前有 MSDN 订阅。它很快就要更新了，看起来要花一笔不小的钱。我看到 TechNet 订阅的费用要少得多，而且似乎包含所有相同的软件。我在这里错过了什么吗？这2个包有什么区别？

更新：Visual Studio 和 TechNet 订阅的价格仍然低于 MSDN 订阅的成本。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-30T18:17:27.860

如果内存服务于 TECHNET 订阅是用于评估目的的许可证，而 MSDN 订阅是用作​​开发人员的许可证。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T18:16:32.450

TechNet 是否包括 Visual Studio？

我认为这是最大的不同之一。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-19T20:57:52.997

TechNet 包含一组非常不同的产品，用于评估。以下是有关不同 TN 订阅的详细信息：[http ://technet.microsoft.com/en-us/subscriptions/bb892756.aspx](http://technet.microsoft.com/en-us/subscriptions/bb892756.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T18:31:19.270

检查此问题以[找到便宜的 MSDN 订阅](https://stackoverflow.com/questions/42466/msdn-subscriptions-on-the-cheap)，尽管听起来您不符合 Empower 的资格。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-07-10T13:38:12.807

如果您是软件商店，请获取 MSDN。TechNet 不为您提供任何开发/测试方案！

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2012-06-06T00:25:03.573

WTF，你们一直在输入“评估”吗？在 Microsoft 的页面上列出了 Technet 和 MSDN 订阅之间的区别，他们甚至没有使用 Evaluate 或 Evaluation 一词。他们说“使用”很多。然后他们指定你可以使用它。从技术上讲，两个订阅都是针对其软件评估的字典定义。

例子：：

MSDN：熟悉并了解最新的 Microsoft 软件，以支持您的应用程序开发过程。

因此，您可以评估他们的最新软件，以支持您的应用程序开发过程。

TechNet：熟悉并了解最新的 Microsoft 软件，以支持使用或部署该软件的内部或外部客户。

因此，您可以评估他们的最新软件，以支持使用或部署该软件的内部/外部客户。

看，它们是评估软件的不同方式，所以你说 TechNet 是评估而 MSDN 不是。如果你想获得TECHNICAL，它们都是评估。它们不是永不过期的完整许可证。但是，就您对订阅的实际操作而言，除了 MSDN 提供的免费开发人员工具外，它们并没有那么不同……（如果您不计算价格）- 获取TechNet 订阅和购买 Visual Studio。您将能够做与 MSDN 相同的事情。

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2012-06-06T00:13:22.550

评价目的？他们是否会出现在您家门口检查以确保您正在使用他们为您提供的完整许可证密钥的软件，他们希望您按照他们想要的方式使用？

当您说评估时，人们可能会推断您是在说软件过期之类的。有点像这个词。“评估期”

它们为您提供每个库中包含的软件的产品密钥，即使在您的订阅到期后也能继续工作。如果 Technet 比 MSDN 便宜，即使您单独购买 Visual Studio，也请选择 Technet。我两个都有，因为我有钱。两者都买没有真正的意义，但无论如何.. 省下你该死的钱并获得 Technet 订阅。

# c# - 如何限制 C# 程序占用的 CPU 使用率？

> ID：251198
> 
> 赞同：11
> 
> 时间：2008-10-30T18:15:07.460
> 
> 标签：c#, cpu

我正在开发一个 C# 程序，并且我有一个消耗太多 CPU 的函数。我想知道一种通过代码（而不是任何外部应用程序）来控制它并限制 CPU 使用百分比的方法。例如，如果它使用 90% 的 CPU 使用率，要让我的应用程序只消耗 20%，即使它变得更慢。它必须在应用程序内自动完成。如果你提供一个类，那就太棒了。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-30T18:20:15.937

我不知道您是否可以这样做，但是您可以通过[Priority](http://msdn.microsoft.com/en-us/library/system.threading.thread.priority.aspx)属性更改执行线程的线程优先级。您可以通过以下方式设置：

```
Thread.CurrentThread.Priority = ThreadPriority.Lowest; 
```

另外，我不认为你真的想限制它。如果机器处于空闲状态，您希望它忙于任务，对吗？ThreadPriority 有助于将此信息传达给调度程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T18:22:17.383

您可以通过在循环中调用 Thread.Sleep(milliseconds) 来减慢循环。这会将 CPU 交还给调度程序。

但是“消耗过多的 CPU”让我认为你可能有更根本的问题。该线程是否正在轮询并等待其他内容？如果是这样，您应该考虑使用事件或其他一些基于内核的信号机制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T01:00:38.327

我想您需要查询某种操作系统 API 以了解您消耗了多少 CPU 并从中做出限制决定（如 Thread.Sleep）。

# javascript - 延迟 JQuery 效果

> ID：251204
> 
> 赞同：48
> 
> 时间：2008-10-30T18:16:34.383
> 
> 标签：javascript, jquery, effects

我想在延迟几秒钟后淡出一个元素及其所有子元素。但我还没有找到一种方法来指定效果应该在指定的时间延迟后开始。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2008-10-30T18:18:10.963

```
setTimeout(function() { $('#foo').fadeOut(); }, 5000); 
```

5000 是以毫秒为单位的五秒。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2009-02-16T08:00:18.203

我使用我刚刚写的这个暂停插件

```
$.fn.pause = function(duration) {
    $(this).animate({ dummy: 1 }, duration);
    return this;
}; 
```

像这样称呼它：

```
$("#mainImage").pause(5000).fadeOut(); 
```

注意：您不需要回调。

* * *

**编辑：您现在应该使用[jQuery 1.4。内置延迟（）](http://api.jquery.com/delay/)方法。我没有检查过，但我认为它比我的插件更“聪明”。**

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2010-01-15T02:54:12.670

以前你会做这样的事情

```
$('#foo').animate({opacity: 1},1000).fadeOut('slow'); 
```

第一个动画没有做任何事情，因为您已经在元素上设置了 opacity 1，但它会暂停一段时间。

在 jQuery 1.4 中，他们已将其内置到框架中，因此您不必像上面那样使用 hack。

```
$('#foo').delay(1000).fadeOut('slow'); 
```

功能与原始`jQuery.delay()`插件相同[http://www.evanbot.com/article/jquery-delay-plugin/4](http://www.evanbot.com/article/jquery-delay-plugin/4)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-04-15T18:02:26.100

最好的方法是使用 jQuery 延迟方法：

$('#my_id').delay(2000).fadeOut(2000);

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-18T00:32:26.410

您可以通过使用 fadeTo() 方法来避免使用 setTimeout，并在其上设置 5 秒的延迟。

```
$("#hideAfterFiveSeconds").click(function(){
  $(this).fadeTo(5000,1,function(){
    $(this).fadeOut("slow");
  });
}); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-09T05:21:03.547

我编写了一个插件，让您可以在链中添加延迟。

例如 $('#div').fadeOut().delay(5000).fadeIn(); // 淡出元素，等待 5 秒，淡入元素。

它不使用任何动画技巧或过多的回调链接，只是简单干净的短代码。

[http://blindsignals.com/index.php/2009/07/jquery-delay/](http://blindsignals.com/index.php/2009/07/jquery-delay/)

# c# - 中间层验证

> ID：251209
> 
> 赞同：2
> 
> 时间：2008-10-30T18:17:31.793
> 
> 标签：c#, validation, middle-tier

我想对我的业务代码进行验证。我正在考虑两种方法来做到这一点。

一，按以下方式对我的类属性设置器进行验证

```
class Student{
    public string Name{
        get { return _name; }
        set {
            if (value.IsNullOrEmpty) throw exception ...
        }
    } 
} 
```

现在，这种方法的问题在于，每次分配 Name 时都会运行验证代码，而我们可能不需要，例如用数据库中的数据填充它时。

两个，我更喜欢，将静态方法放在这些实体类上，比如

```
class Student {
    public **static** void ValidateName(**string name**) {
        if (string.IsNullorEmpty(name)) 
        {
            throw ...
        }
        ...
    } 
```

请注意，我使用的是静态方法而不是实例方法，例如

```
class Student{
    public void Validate() {
        // validation logic on instance properties
        if (string.IsNullorEmpty(Name)) 
        {
            throw ...
        }

        ...
    } 
```

是因为我并不总是传入一个 Student obj，我确实经常将原始类型（如字符串名称）传递给一个方法，比如

```
public static FindStudentByName(string name)
{
   // here I want to first do validation
   Student.ValidateName(name);

   // query DB
   ...
} 
```

如果我确实通过了学生 obj，那么我当然可以

```
public static AddStudent(Student s)
{
    // call the instance method
    s.Validate();
} 
```

现在，我想让事情变得非常简单，所以我**不想**采用以下任何一种方法

1.  在属性上使用属性，例如 [StringLength(25)]。

    一，因为这需要反射并影响性能，所以有一些技巧可以降低性能，但我还是想让它越简单越好。

    第二，我希望我的网站能够在 Medium Trust 中运行。据我了解，反思需要完全信任。

2.  使用那里的任何验证块，例如 MS。在 CodePlex 上找到企业库等。

现在，我想听听你对此的看法，

我要采用的方法有哪些潜在问题？
这种方法会比其他方法性能更好、更易读、更容易维护吗？

您如何在中间层进行验证？

谢谢一堆！

射线。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T18:33:38.437

[我使用规则引擎在中间层执行域验证，与此处所写](http://www.codethinked.com/post/2008/10/12/Thoughts-On-Domain-Validation-Part-1.aspx)的非常相似。一个朋友的项目使用类似于您在后一个示例中提出的方法，最终结果是不可维护的（脆弱，难以实现通用验证 UI）。规则引擎方法是可维护的，因为它将所有验证和持久性规则本地化在一个组织良好的位置，并将每个规则作为一个完全成熟的类 - 但在域类上公开验证，类似于您提出的。有些人喜欢动态编译，因此他们将它们存储在数据库中以进行高级部署后配置；在我的情况下，我喜欢它们的编译时间检查，因此在静态类上公开了带有 lambda 的规则定义。

我知道这不符合你想要做的，但是问我会怎么做并说其他方法不够简单就像说“你怎么能写出可靠的代码，我想保持简单所以单元测试是不可能的。” 对我来说，将每个规则视为自己的类是好的，因为它更易于维护和记录，尽管实现起来更复杂。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T18:20:18.667

选项二实际上并不强制执行验证，至少在您手动调用 validate 的情况下不会。因此，您的对象的消费者可能会违反规则。

我个人会使用类似于您的第一个示例的内容，因为它可以确保所有数据都是有效的。这是对数据库方面的额外检查，但据我所知，通常没什么大不了的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T18:37:54.827

您建议的方法似乎表明不应始终应用该组验证。没关系。我已经看到了很多我们“大多数时候”想要的规则和验证，但并非总是如此。所以，问题变成了“您希望何时应用这些验证”？

比如说，你有一些你*总是*想要应用的验证，还有一些你只想在......我不知道......你即将保存到存储（数据库）时验证。在这种情况下，始终应用的检查应该在属性中（请参阅下面的更多内容），并且仅在您要保存到存储时应用的检查应该在方法中（可能沿行命名 ' VerifyRulesForStorage') 将在适当时调用（例如，在您的“SaveToStorage”方法中间）。

我认为值得考虑的一件事是，当您在多个实体之间进行相同的验证时，您可能会发生重复。无论是在属性中，还是在“VerifyRulesForStorage”方法中，您都可能会在许多地方、许多类中进行相同的检查（例如：String.IsNullOrEmpty 或 CheckItsANumber 或 CheckItsOneOfTheAcceptedValues 等）。当然，您可以通过继承（例如，您的所有实体都从具有实现每种检查类型的方法的基实体类继承）或组合（可能是更好的方法，以便您的实体的类树由其他驱动，更合适的考虑因素，例如：您的所有实体都有一个 Validator 对象来实现所有这些检查）。无论哪种方式，您都可能希望远离静态方法，

在我们的系统中，我们实际上有描述验证规则的元数据。类的属性名称用于检索正确的元数据，然后告诉系统应用哪些规则。然后，我们有一个验证器对象，它通过工厂实例化正确类型的对象以实际执行验证（例如，我们有一个实现 IsRequiredString 规则的类，一个实现 IsNumber 规则等）。听起来很复杂，但在像我们这样的 lrge 系统中，这绝对是值得的。

最后，现成的库可能是一个不错的选择。在我们的情况下，它们不是因为我们有特殊要求 - 但总的来说.. 使用其他人开发（并将支持）的轮子比构建自己的轮子有好处（相信我，我喜欢在我的时候重建轮子可以..我只是说在某些情况下，每种方法都比另一种更好）。

# installation - 如何在基于 MSI 的卸载期间停止正在运行的进程？

> ID：251218
> 
> 赞同：4
> 
> 时间：2008-10-30T18:19:31.867
> 
> 标签：installation, windows-installer, wise, altiris

我在 Windows XP 上使用 Wise Package Studio 7.0 SP2。

我有一个 MSI Wrapped EXE 安装，它可以愉快地安装一些文件，然后运行安装中的一个文件，我们可以将其称为 app.exe。

因此，在 MSI 编辑器的“执行延迟”选项卡上，我必须添加以下行：

```
If Not Installed then
  Execute Installed Program app.exe (Action)
End 
```

这确保了我的 app.exe*只会*在安装时运行，而不是在修改/修复/删除期间运行。当 app.exe 运行时，它会方便地将自身添加到系统托盘中。

我正在寻找在移除过程中会发生相反作用的东西。我想停止 app.exe 进程，从而将其从系统托盘中删除。

目前，我的删除删除了所有文件，但 app.exe 仍在运行并仍显示在系统托盘中。我看过添加条件语句：

```
If REMOVE~="ALL" then
  *remove the app from the systray!*
End 
```

条件语句只允许我在删除时做一些事情，但是我不确定实际终止进程的最佳方法。是否有我可以运行的 MSI 命令让我这样做？我应该编写自己的 .exe 来做到这一点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T07:09:49.037

6 个月前，我们使用 VBScript 动作来做同样的事情，然后就在 SP3 发布的时候，objProcess.Terminate() 函数拒绝在某些机器上工作。不管我们怎么做，它只是冻结了。这发生在我们大约 10% 的测试机器上，因此我们被迫寻找替代解决方案（谁知道它可能冻结了多少客户！）

我的第一个发现是内置的（从 Windows 2000 开始）命令 TASKKILL，例如：`TASKKILL /IM app.exe /F`但由于这似乎使用了与我们在 VBScript 中使用的类似的终止进程的方法，因此该方法也会失败。

所以现在我们使用`pskill.exe`来自 sysinternals 的工具，您需要使用命令行开关来禁止许可协议提示，但除此之外，这是我发现的杀死正在运行的 EXE 的最简单的方法。

当然，最好的解决方案是构建自己的 EXE 或 DLL 来完成它，如果你碰巧知道一点 C++ ;)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-22T20:53:37.817

仅仅终止进程是不够的，因为这不会清理 Windows 通知区域（但是，当鼠标下一次悬停时，Windows 会清理没有匹配进程的图标）。突然终止应用程序的另一个原因通常最好保留用于调试。不幸的是，更合适的解决方案也涉及更多。您可以在应用程序中创建一个命名事件并注册一个回调方法以在设置时调用。回调将关闭应用程序。然后，您将编写一个自定义操作来设置事件并等待进程终止。

如果您需要支持取消（例如，提示用户他有未保存的更改并决定不取消），您可以使用另一个命名事件来指示，因此自定义操作可以等待进程结束或取消事件， 以先到者为准。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T04:55:53.690

您可以将 VBscript 元素作为自定义操作插入 MSI。像这样的东西应该可以完成这项工作：

```
strMachine = "localhost"
strAppName = "notepad.exe"

Set objProcesses = GetObject("winmgmts://" & strMachine).ExecQuery("SELECT * FROM Win32_Process WHERE Caption LIKE '" & strAppName & "'")

For Each objProcess In objProcesses
    intRetVal = objProcess.Terminate(0)
Next 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-07T22:12:43.303

如果您的 app.exe 是在内部创建的，您可以添加一个命令行，告诉它杀死当前正在运行的那个。当给定该命令行时，它将向该程序的第一个实例发送一条消息或告诉它退出的信息，然后等待直到该程序的第一个实例实际终止。然后安装程序将能够使用终止开关运行程序，并知道当终止开关实例返回时它的原始实例已经消失。

# ruby-on-rails - 如何在 Ruby on Rails 和 Test::Unit 中测试控制器过滤器

> ID：251225
> 
> 赞同：1
> 
> 时间：2008-10-30T18:21:22.470
> 
> 标签：ruby-on-rails, unit-testing

我们在 Ruby on Rails 中有一个带有许多过滤器的大型应用程序。其中一些过滤器可能很复杂。我正在寻找一种通过单元测试单独测试这些过滤器的方法。现在，我通过将它们与功能测试一起使用的操作来测试它们。只是感觉这不是正确的方法。
有没有人有这方面的建议或经验？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T20:21:09.517

请记住，过滤器只是一种方法。
鉴于这种：

```
class SomeController
  before_filter :ensure_awesomeness

  ...
end 
```

你没有理由不能这样做：

```
SomeController.new.ensure_awesomeness 
```

然后检查它是否调用了 redirect_to 或它应该做的任何事情

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-10-15T12:13:44.707

You can testing with this code:

```
require "test_helper"
describe ApplicationController do

  context 'ensure_manually_set_password' do
    setup do
      class ::TestingController < ApplicationController
        def hello
          render :nothing => true
        end
      end

      NameYourApp::Application.routes.draw do 
        get 'hello', to: 'testing#hello', as: :hello
      end
    end

    after do
        Rails.application.reload_routes!
    end

    teardown do
      Object.send(:remove_const, :TestingController)
    end

    context 'when user is logged in' do
      setup do
        @controller = TestingController.new
      end

      context 'and user has not manually set their password' do
        let(:user) { FactoryGirl.build(:user, manually_set_password: false) }
        setup do
                    login_as user
          get :hello
        end

        should 'redirect user to set their password' do
          assert_redirected_to new_password_path(user.password_token)
        end
      end
    end
  end
end 
```

It's code is original from [http://robots.thoughtbot.com/testing-a-before-filter](http://robots.thoughtbot.com/testing-a-before-filter), I changed for Rails 3

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-13T08:34:31.553

我有[一个](http://smsohan.blogspot.com/2009/05/unit-test-actioncontroller-filters.html)关于单元测试 before_filters 的帖子，你不妨看看。希望它会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-30T19:40:26.690

我遇到过这个问题。

执行需要请求的操作的过滤器呢？即使用闪存

Authlogic require_user 方法的示例仅通过使用 ApplicationController.new.send(:some_filter) 将不起作用。

[https://github.com/binarylogic/authlogic_example/blob/master/app/controllers/application_controller.rb](https://github.com/binarylogic/authlogic_example/blob/master/app/controllers/application_controller.rb)

有人对如何单独测试这种东西有一些非黑客的想法吗？（我通过创建一个仅用于测试的额外虚拟控制器来做到这一点。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T18:36:35.733

这取决于您的过滤器在做什么。

这个： http: [//movesonrails.com/journal/2008/1/23/testing-your-application-controller-with-rspec.html](http://movesonrails.com/journal/2008/1/23/testing-your-application-controller-with-rspec.html)

而且学习如何使用摩卡咖啡会让你走得很远。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T22:25:21.607

猎户座我在几次出现时都搞砸了。此外，大多数时候过滤器是私有的，因此您必须发送：

```
SomeController.new.send(:some_filter) 
```

# networking - 是什么导致发送 TCP/IP 重置 (RST) 标志？

> ID：251243
> 
> 赞同：144
> 
> 时间：2008-10-30T18:25:53.400
> 
> 标签：networking, tcp

我试图弄清楚为什么我的应用程序的 TCP/IP 连接每 10 分钟（确切地说，在 1-2 秒内）不断打嗝。我运行了 Wireshark，发现在 10 分钟不活动后，另一端正在发送一个设置了重置 (RST) 标志的数据包。谷歌搜索告诉我“RESET 标志表示接收器变得混乱，因此想要中止连接”，但这有点缺乏我需要的细节。这可能是什么原因造成的？沿途的某个路由器是否可能对此负责，或者这是否总是来自另一个端点？

**编辑：**在我的计算机和另一个端点之间有一个路由器（特别是 Linksys WRT-54G）——我应该在路由器设置中寻找什么吗？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2008-10-30T18:36:55.933

“路由器”可以做任何事情 - 特别是 NAT，它可能涉及任何数量的错误缠身的流量......

设备发送 RST 的一个原因是为了响应接收到已关闭套接字的数据包。

很难给出一个明确但普遍的答案，因为自从 TCP 开始以来，所有可能的变态都在 TCP 上被访问过，并且各种各样的人都可能会插入 RST 以试图阻止流量。（例如，一些“国家防火墙”就是这样工作的。）

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-30T20:01:01.663

同时在对等点上运行数据包嗅探器（例如，Wireshark），以查看发送 RST 的对等点还是中间人。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-10-02T16:52:08.210

我刚刚花了很多时间来解决这个问题。所提出的解决方案都没有奏效。原来，我们的系统管理员错误地将相同的静态 IP 分配给了属于不同组但位于同一网络上的两台不相关的服务器。最终结果是间歇性地断开 vnc 连接，浏览器必须刷新几次才能获取网页，以及其他奇怪的事情。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2010-07-11T14:52:28.830

RST 由执行主动关闭的一方发送，因为它是发送最后一个 ACK​​ 的一方。因此，如果它在错误状态下从执行被动关闭的一方接收到 FIN，它会发送一个 RST 数据包，指示另一方发生了错误。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-07-23T14:21:48.680

如果有一个路由器在做 NAT，尤其是一个资源很少的低端路由器，它将首先老化最旧的 TCP 会话。为此，它`RST`在数据包中设置标志，有效地告诉接收站（非常不礼貌地）关闭连接。这样做是为了节省资源。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-30T18:35:11.197

如果连接空闲 x 分钟，某些防火墙会这样做。一些 ISP 也出于各种原因将其路由器设置为这样做。

在当今时代，您需要优雅地处理（根据需要重新建立）这种情况。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2019-08-08T02:52:39.410

需要注意的一件事是许多 Linux netfilter 防火墙配置错误。

如果你有类似的东西：

-A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT

-A FORWARD -p tcp -j REJECT --reject-with tcp-reset

然后数据包重新排序可能会导致防火墙认为数据包无效，从而生成重置，然后会破坏其他健康的连接。

无线网络特别有可能重新排序。

这应该是：

-A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT

-A FORWARD -m state --state INVALID -j DROP

-A FORWARD -p tcp -j REJECT --reject-with tcp-reset

基本上任何时候你都有：

... -m state --state RELATED,ESTABLISHED -j ACCEPT

紧随其后的是：

... -m 状态 --state 无效 -j DROP

最好丢弃一个数据包，然后生成一个潜在的协议中断 tcp 重置。当它们被证明是正确的发送时，重置会更好......因为这消除了超时。但是，如果它们有任何可能无效，那么它们可能会导致这种痛苦。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-04-16T12:28:08.350

这是因为网络中有另一个进程向您的 TCP 连接发送 RST。

通常在以下情况下会发送 RST

*   启用使用 SO_LINGER 选项的套接字时，进程关闭套接字
*   当您的进程退出而不关闭套接字时，操作系统正在执行资源清理。

在您的情况下，听起来一个进程正在连接您的连接（IP + 端口）并在建立连接后继续发送 RST。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-04-22T06:10:22.653

在大多数应用程序中，套接字连接都有超时。如果在超时时间内客户端和服务器之间没有通信，则按照您的观察重置连接。一个很好的例子是一个 FTP 服务器，如果你连接到服务器，只是离开连接而不浏览或下载文件，服务器会踢掉你的连接，通常是为了让其他人能够连接。我想这就是您在连接时遇到的问题。因此，请查看服务器应用程序，如果这是您从中获取重置的位置，并查看它是否确实为源代码中的连接设置了超时。

# mod-rewrite - http 到 https 到 http 使用 mod_rewrite 和 IBM http 服务器

> ID：251246
> 
> 赞同：3
> 
> 时间：2008-10-30T18:27:00.340
> 
> 标签：mod-rewrite, ssl, ibmhttpserver

好的，我有一个`apache IBM HTTP Server WAS 6.1`设置

我已经`certs`正确安装并且可以成功加载`http`和`https`页面。

通过 成功`j_security_check`验证后`https`，我希望现在授权的页面（以及所有后续页面）加载为`http`.

我希望这一切都可以使用，`mod_rewrite`因为我不想更改应用程序代码，而这些代码在网络服务器上确实应该很简单。

我认为这会起作用，但它不起作用，我担心这是因为以某种方式`j_security_check`绕过`mod_rewrite`。

```
RewriteCond %{HTTPS} =off
RewriteCond %{THE_REQUEST} login\.jsp.*action=init [OR]
RewriteCond %{THE_REQUEST} login\.jsp.*action=submit
RewriteRule .* https://%{SERVER_NAME}%{REQUEST_URI} [R,L]     <<-- this rule is working

RewriteCond %{HTTPS} =on
RewriteCond %{THE_REQUEST} !login\.jsp.*action=init [OR]
RewriteCond %{THE_REQUEST} !login\.jsp.*action=submit
RewriteRule .* http://%{SERVER_NAME}%{REQUEST_URI} [R,L] <--- this rule is not working or the condition is not returning true 
```

我知道这`[R,L]`将强制执行的规则成为在请求上运行并相应重定向的最后一条规则。

经过一番谷歌搜索后，我发现了这个小宝石。

```
mod_rewrite: My rules are ignored. Nothing is written to the rewrite log.
The most common cause of this is placing mod_rewrite directives at global scope (outside of any VirtualHost containers) but expecting the directives to apply to requests which were matched by a VirtualHost container.

In this example, the mod_rewrite configuration will be ignored for requests which are received on port 443:

    RewriteEngine On
    RewriteRule ^index.htm$ index.html

    <VirtualHost *:443>
    existing vhost directives
    </VirtualHost>

Unlike most configurable features, the mod_rewrite configuration is not inherited by default within a <VirtualHost > container. To have global mod_rewrite directives apply to a VirtualHost, add these two extra directives to the VirtualHost container:

    <VirtualHost *:443>
    existing vhost directives
    RewriteEngine On
    RewriteOptions Inherit
    </VirtualHost> 
```

将 Inherit 声明添加到我`virtualhost`的指向机器 ip 的单个声明中并且`port 443`没有任何帮助。

现在我知道我的应用服务器分别在`9080`和上进行通信，但我在 web 服务器中`9443`找不到一个。`virtualhost``httpd.conf`

我在未经过身份验证的情况下使用不同的重写规则进行了一些测试，发现我的`mod rewrite`代码有效..

**那么：如何让 websphere 在身份验证后使用 mod 重写？**

就像 Web 服务器仅用于未经身份验证的请求，然后某个黑盒容器以某种方式提供所有内容。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-31T14:44:12.203

这是http到https到http的解决方案

您必须像文章所说的那样将条件和重写规则放在虚拟主机中，但由于某种原因，继承不想工作。

```
RewriteEngine on
RewriteCond %{HTTPS} !=on
RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /path/login\.jsp\ HTTP/1\.1
RewriteRule .* https://%{SERVER_NAME}%{REQUEST_URI} [R,L]

   <VirtualHost 000.000.000.000:443>
    ServerName servername
    ServerAlias url.com machinename
    DocumentRoot d:/ibmhttpserver61/htdocs/en_US
    ErrorLog d:/ibmhttpserver61/logs/secerr.log
    TransferLog d:/ibmhttpserver61/logs/sectrans.log
    SSLEnable
    Keyfile d:/ibmhttpserver61/ssl/ctxroot.kdb
    SSLV2Timeout 100
    SSLV3Timeout 1000 

    RewriteEngine On
    RewriteCond %{REQUEST_URI} /path/secure/index.jsf
    RewriteRule ^(.*)$ http://url/path/secure/index.jsf [R,L]    

    </VirtualHost> 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-30T21:44:16.073

大胆猜测：第二个逻辑 OR 是否应该是 AND（即没有 [OR] 并且 RewriteCond 默认为 AND）？

```
RewriteCond %{THE_REQUEST} !login\.jsp.*action=init
RewriteCond %{THE_REQUEST} !login\.jsp.*action=submit 
```

# c# - 如何获取当前 Windows 帐户的 SID？

> ID：251248
> 
> 赞同：31
> 
> 时间：2008-10-30T18:27:47.153
> 
> 标签：c#, c++, windows, winapi, sid

我正在寻找一种简单的方法来获取当前 Windows 用户帐户的 SID。我知道我可以通过 WMI 做到这一点，但我不想走那条路。

向所有用 C# 回答的人道歉，因为他们没有指定它是 C++。:-)

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-10-30T18:37:35.637

在 Win32 中，调用[GetTokenInformation](http://msdn.microsoft.com/en-us/library/aa446671.aspx)，传递令牌句柄和`TokenUser`常量。它将为您填写一个[TOKEN_USER](http://msdn.microsoft.com/en-us/library/aa379634.aspx)结构。其中的元素之一是用户的 SID。它是一个 BLOB（二进制），但您可以使用[ConvertSidToStringSid](http://msdn.microsoft.com/en-us/library/aa376399.aspx)将其转换为字符串。

要获取当前令牌句柄，请使用[OpenThreadToken](http://msdn.microsoft.com/en-us/library/aa379296(VS.85).aspx)或[OpenProcessToken](http://msdn.microsoft.com/en-us/library/aa379295(VS.85).aspx)。

如果您更喜欢 ATL，它有[CAccessToken](https://docs.microsoft.com/en-za/cpp/atl/reference/caccesstoken-class?view=msvc-160)类，其中包含各种有趣的东西。

.NET 具有[Thread.CurrentPrinciple](http://msdn.microsoft.com/en-us/library/system.threading.thread.currentprincipal.aspx)属性，该属性返回 IPrincipal 引用。您可以获取 SID：

```
IPrincipal principal = Thread.CurrentPrincipal;
WindowsIdentity identity = principal.Identity as WindowsIdentity;
if (identity != null)
    Console.WriteLine(identity.User); 
```

同样在 .NET 中，您可以使用 WindowsIdentity.GetCurrent()，它返回当前用户 ID：

```
WindowsIdentity identity = WindowsIdentity.GetCurrent();
if (identity != null)
    Console.WriteLine(identity.User); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-11-13T06:07:38.480

```
ATL::CAccessToken accessToken;
ATL::CSid currentUserSid;
if (accessToken.GetProcessToken(TOKEN_READ | TOKEN_QUERY) &&
    accessToken.GetUser(&currentUserSid))
    return currentUserSid.Sid(); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-30T18:37:01.287

这应该给你你需要的东西：

使用 System.Security.Principal；

...

var sid = WindowsIdentity.GetCurrent().User;

根据[MSDN Docs ，WindowsIdentity 的用户属性返回 SID](http://msdn.microsoft.com/en-us/library/system.security.principal.windowsidentity_members.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-30T18:31:50.937

[CodeProject](http://www.codeproject.com/KB/cs/processownersid.aspx)有几种不同的方法你可以尝试......你没有提到你想要解决方案的语言。

如果您想通过批处理文件或其他方式访问它，您可以将其视为[Sysinternals](http://www.sysinternals.com)的 PsGetSid 。它将 SID 转换为名称，反之亦然。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T18:53:43.403

在 C# 中，您可以使用

`using Microsoft.Win32.Security;`

...

`string username = Environment.UserName + "@" + Environment.GetEnvironmentVariable("USERDNSDOMAIN");`

`Sid sidUser = new Sid (username);`

**或者...**

`using System.Security.AccessControl;`

`using System.Security.Principal;`

...

`WindowsIdentity m_Self = WindowsIdentity.GetCurrent();`

`SecurityIdentifier m_SID = m_Self.Owner;");`

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-01-13T12:26:27.530

我找到了另一种获取 SID 的方法：

```
System.Security.Principal.WindowsIdentity id = System.Security.Principal.WindowsIdentity.GetCurrent();
string sid = id.User.AccountDomainSid.ToString(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-08-16T15:11:18.707

在本机代码中：

```
function GetCurrentUserSid: string;

    hAccessToken: THandle;
    userToken: PTokenUser;
    dwInfoBufferSize: DWORD;
    dw: DWORD;

    if not OpenThreadToken(GetCurrentThread, TOKEN_QUERY, True, ref hAccessToken) then
        dw <- GetLastError;
        if dw <> ERROR_NO_TOKEN then
            RaiseLastOSError(dw);

        if not OpenProcessToken(GetCurrentProcess, TOKEN_QUERY, ref hAccessToken) then
            RaiseLastOSError;
    try
        userToken <- GetMemory(1024);
        try
            if not GetTokenInformation(hAccessToken, TokenUser, userToken, 1024, ref dwInfoBufferSize) then
                RaiseLastOSError;
            Result <- SidToString(userToken.User.Sid);
        finally
            FreeMemory(userToken);
    finally
        CloseHandle(hAccessToken); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-11-12T06:28:53.113

这个问题被标记为`c++`我用`c++`语言回答，所以我推荐使用***WMI***工具：

因此，作为***WMI***命令`powershell`，下面`SID`的命令获取`system-pc1`用户：

> ```
> Get-WmiObject win32_useraccount -Filter "name = 'system-pc1'" | Select-Object sid 
> ```

首先，您需要通过以下方式获取最新`username`信息`code`：

```
char username[UNLEN+1];
DWORD username_len = UNLEN+1;
GetUserName(username, &username_len); 
```

现在您可以尝试使用`WQL`语言并按`c++`如下方式执行此查询（在此示例中，我`system-pc1`在查询中使用了用户名`WQL_WIN32_USERACCOUNT_QUERY`：

```
#define                 NETWORK_RESOURCE                    "root\\CIMV2"
#define                 WQL_LANGUAGE                        "WQL"
#define                 WQL_WIN32_USERACCOUNT_QUERY         "SELECT * FROM Win32_Useraccount where name='system-pc1'"
#define                 WQL_SID                             "SID"

IWbemLocator            *pLoc = 0;              // Obtain initial locator to WMI to a particular host computer
IWbemServices           *pSvc = 0;              // To use of connection that created with CoCreateInstance()
ULONG                   uReturn = 0;
HRESULT                 hResult = S_OK;         // Result when we initializing
IWbemClassObject        *pClsObject = NULL;     // A class for handle IEnumWbemClassObject objects
IEnumWbemClassObject    *pEnumerator = NULL;    // To enumerate objects
VARIANT                 vtSID = { 0 };          // OS name property

// Initialize COM library
hResult = CoInitializeEx(0, COINIT_MULTITHREADED);
if (SUCCEEDED(hResult))
{
    // Initialize security
    hResult = CoInitializeSecurity(NULL, -1, NULL, NULL, RPC_C_AUTHN_LEVEL_DEFAULT,
        RPC_C_IMP_LEVEL_IMPERSONATE, NULL, EOAC_NONE, NULL);
    if (SUCCEEDED(hResult))
    {
        // Create only one object on the local system
        hResult = CoCreateInstance(CLSID_WbemLocator, 0, CLSCTX_INPROC_SERVER,
            IID_IWbemLocator, (LPVOID*)&pLoc);

        if (SUCCEEDED(hResult))
        {
            // Connect to specific host system namespace
            hResult = pLoc->ConnectServer(TEXT(NETWORK_RESOURCE), NULL, NULL,
                0, NULL, 0, 0, &pSvc);
            if (SUCCEEDED(hResult))
            {
                /* Set the IWbemServices proxy
                * So the impersonation of the user will be occurred */
                hResult = CoSetProxyBlanket(pSvc, RPC_C_AUTHN_WINNT, RPC_C_AUTHZ_NONE,
                    NULL, RPC_C_AUTHN_LEVEL_CALL, RPC_C_IMP_LEVEL_IMPERSONATE,
                    NULL, EOAC_NONE);
                if (SUCCEEDED(hResult))
                {
                    /* Use the IWbemServices pointer to make requests of WMI
                    * For example, query for user account */
                    hResult = pSvc->ExecQuery(TEXT(WQL_LANGUAGE), TEXT(WQL_WIN32_USERACCOUNT_QUERY),
                        WBEM_FLAG_FORWARD_ONLY | WBEM_FLAG_RETURN_IMMEDIATELY, NULL, &pEnumerator);
                    if (SUCCEEDED(hResult))
                    {
                        // Go to get the next object from IEnumWbemClassObject
                        pEnumerator->Next(WBEM_INFINITE, 1, &pClsObject, &uReturn);
                        if (uReturn != 0)
                        {
                            // Get the value of the "sid, ..." property
                            pClsObject->Get(TEXT(WQL_SID), 0, &vtSID, 0, 0);
                            VariantClear(&vtSID);

                            // Print SID
                            wcout << vtSID.bstrVal;

                            pClsObject->Release();
                            pClsObject = NULL;
                        }
                    }
                }
            }
        }
    }

    // Cleanup
    pSvc->Release();
    pLoc->Release();
    pEnumerator->Release();
    // Uninitialize COM library
    CoUninitialize(); 
```

这个例子确实工作正常！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T18:34:47.157

你没有指定你想要什么语言。但是，如果您喜欢 C#，那么本文提供了 WMI 方法以及利用 Win32 API 的更快（但更冗长）的方法。

[http://www.codeproject.com/KB/cs/processownersid.aspx](http://www.codeproject.com/KB/cs/processownersid.aspx)

我认为目前没有其他方法可以在不使用 WMI 或 Win32 API 的情况下执行此操作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-10-23T14:33:28.377

这是我认为最短的一个。

```
UserPrincipal.Current.Sid; 
```

适用于 .net >= 3.5

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-11-14T09:44:02.583

在 cmd.exe 中

> whoami /用户

如果您以编程方式需要它，请询问更多指定

# sharepoint - 创建自定义字段类型和自定义内容类型

> ID：251256
> 
> 赞同：2
> 
> 时间：2008-10-30T18:34:07.610
> 
> 标签：sharepoint, moss, wss

有没有人有任何很好的链接来开发不涉及使用 VSeWSS 的自定义字段和内容类型？我在网上看到的大多数东西都需要安装 VSeWSS，我宁愿只用 VS2005 从头开始​​构建它们。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T18:51:14.767

我使用这些博客来帮助我处理[此处](http://claytonj.wordpress.com/2007/05/15/regular-expression-validation-custom-field-type/)和[此处的自定义字段](http://www.sharepointblogs.com/nicksevens/archive/2007/08/31/create-custom-field-types-for-sharepoint.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T19:14:49.743

也不确定自定义内容类型。但是，如果您想避免 VSeWSS，是否可以使用另一个 Visual Studio 加载项？[WSPBuilder](http://www.codeplex.com/wspbuilder)包括自定义字段类型的模板。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T19:59:18.890

我理解在没有工具帮助的情况下先手动完成的想法。

但是，您最终会手动创建大量 xml。这真的会很痛，而且需要很长时间。

我个人会推荐[STSDev](http://www.codeplex.com/stsdev)。使用它为自定义内容类型和字段创建解决方案和功能，包括任何自定义控件。

创建包后，您可以对其进行逆向工程，以找出整个事物如何结合在一起的具体细节。

如果您在虚拟机上执行此操作，您仍然可以保留原始 2005 安装，以便在需要时回滚。

我相信这将增加了解内容类型和字段发生情况的时间。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-28T14:07:12.110

CodePlex 上的[MOSS 特征生成器](http://www.codeplex.com/mossfeaturegenerator)是一个非常强大的工具，可以从现有站点数据创建特征，这意味着您可以使用 GUI 创建所需的一切，然后将其导出为特征。这对于学习如何创建事物以及将现有事物实际转换为特征非常方便。它适用于内容类型、站点列、列表等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-05T07:00:21.450

查看快速工具和 SPDeploy：

[http://rapid-tools.googlecode.com](http://rapid-tools.googlecode.com)

SPDeploy 允许您使用 Visual Studio 在本地开发解决方案并远程部署自动生成的 wsp。

# c# - 数据访问层 - 亚音速，C# 2.0

> ID：251264
> 
> 赞同：1
> 
> 时间：2008-10-30T18:36:41.380
> 
> 标签：c#, subsonic

在亚音速周围挖掘，我遇到了这个

[链接文本](http://blog.wekeroad.com/blog/subsonic-writing-decoupled-testable-code-with-subsonic-2-1/)

好文章，但有一些？

现在我想要返回 IList 或 Dataset 的选项，我会为此创建一个抽象工厂吗，如果可以，我是否可以有一个通用方法将 IList 或 Dataset 作为 ref 参数并填充传入的对象？

在与我的数据层对话的业务层中声明静态类是否是一种好习惯，以便在我有 gridviewcontrol 的 UI 中执行此操作

mybusinesslayer.getdata(ref myDataset) //因为 mybusinesslayer 是静态的

mygridviewcontrol.datasource = mydataset....

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T05:32:48.433

您打算如何处理无法使用 IList 的数据集？恕我直言，您将希望尽可能地进行强类型化。

在我的团队中，我们将中间层连接到 ObjectDataSources，然后我们所有的 GridViews、ListViews 等......使用它们来获取数据：

**业务层/中间层**

```
namespace Project
{
    public class BusinessLayer
    {
        public IList<Product> GetProducts()
        {
            return new Select().From( Products.Schema ).Where( Products.Columns.Status ).IsEqualTo( true ).ExecuteTypedList<Product>();
        }
    }
} 
```

**在页面上**

```
<asp:ObjectDataSource id="odsProducts" runat="server" TypeName="Project.BusinessLayer" SelectMethod="GetProducts()"></asp:ObjectDataSource> 
```

然后从那里，您可以将任何数据视图控件（Gridview、Listview 等）连接到数据源。它非常干净，不需要代码隐藏中的代码。

我还看到了您发布的 Rob 的那篇文章，发现它有助于弄清楚如何使用 SubSonic 编写解耦应用程序。

# c# - 如何将数组/数据表等变量传递给 SQL Server？

> ID：251271
> 
> 赞同：4
> 
> 时间：2008-10-30T18:40:11.903
> 
> 标签：c#, sql, sql-server

有时您需要使用数据表中的许多行来升级数据库，或者您有一个充满数据的数组，而不是将所有这些数据放在一个字符串中，然后在 SQL SERVER 中拆分，或者而不是在逐行代码并更新数据库，还有其他方法吗？除了 SQL SERVER 2005 中的传统变量之外，还有其他类型的变量吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T20:01:01.570

我同意 John 的观点，`SqlBulkCopy`或者 sqlxml 是 SQL Server 2005 中的最佳选择；请注意，在 SQL Server 2008 中，您还具有[表值参数](http://msdn.microsoft.com/en-us/library/bb675163.aspx)，这值得考虑；尤其是与新的[合并连接](http://msdn.microsoft.com/en-us/library/ms141775.aspx)混合时。

请注意，如果您使用`SqlBulkCopy`，我强烈建议仅将大容量插入到临时表中 - 即仅用于导入的单独表；然后运行存储过程将数据移动到活动表中。这样您就可以获得正确的日志记录，并且您可以在运行 SP 时在数据库中拥有一个范围很窄的事务（即，您不需要跨越所有网络 IO 的事务）。

另一点；如果您正在处理大量数据，您可能不想加载一个`DataTable`（因为这会迫使您首先缓冲内存中的所有数据）；作为替代方案，也可以编写自己的`IDataReader`从流（例如文件等）中提取数据；看`SimpleDataReader` [这里](http://groups.google.com/group/microsoft.public.dotnet.languages.csharp/browse_thread/thread/84d08dd9778efd77/91c7a20056ffe8e1)。会很高兴地`SqlBulkCopy`接受数据。`IDataReader`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T18:44:57.853

有几种方法可以做到这一点。

如果您只是插入行，那么我将创建一个包含信息的 DataTable 对象，然后使用 SqlBulkCopy 对象：

```
SqlBulkCopy copier = new SqlBulkCopy(connectionString, SqlBulkCopyOptions.Default);
copier.BatchSize = 500; //# of rows to insert at a time
copier.DestinationTableName = "dbo.MyTable";
copier.WriteToServer(myDataTable); 
```

另一种选择是使用 sql 2005 'xml' 数据类型将数据包装在 xml 中（无论您想这样做），然后将其发送到您的存储过程（它会执行您需要执行的任何操作）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T20:10:50.817

约翰提到使用 XML ......这就是我将用于您的情况的方法（SQL Server 2005，并制作一个为您处理 SQL 的存储过程）。

这是一个如何开始的示例（这只是一个 select 语句，但如果需要，您可以对其进行更新）：

```
CREATE PROCEDURE MySproc ( @Accounts XML )
AS

SELECT
    Accounts.AccountID.query('.')
FROM
    @Accounts.nodes('//ID/text()') AS Accounts(AccountID)

GO
EXEC MySproc '<Accounts><ID>123</ID><ID>456</ID></Accounts>' 
```

# nhibernate - 更新多对一关系

> ID：251275
> 
> 赞同：0
> 
> 时间：2008-10-30T18:42:04.037
> 
> 标签：nhibernate

我有一个用户对象，上面有一个 Country 对象。我在用户映射文件中使用多对一标记进行映射：

```
<many-to-one name="Country" column="CountryID" cascade="none"/> 
```

如何更新用户的国家？

目前我的 UI 有一个国家下拉列表，新国家的 ID 被传递给控制器​​。然后控制器根据该值设置用户所在国家/地区的 ID。所以：

```
var user = session.Get<User>(userID);
user.Country.ID = Convert.ToInt32(Request.Form["Country_ID"]); 
```

但是当我打电话时：

```
session.SaveOrUpdate(user); 
```

我收到一条错误消息，提示“Country 实例的标识符已从 7 更改为 8”。大概这是因为 NHibernate 将 Country 对象标记为脏？我不想更新国家对象，只是用户中的 ID 引用。有可能这样做吗？

谢谢，乔恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T10:04:43.330

您始终可以掌握底层连接并手动进行更新。

[http://www.darkside.co.za/archive/2008/03/03/castle-activerecord-get-the-underlying-database-connection.aspx](http://www.darkside.co.za/archive/2008/03/03/castle-activerecord-get-the-underlying-database-connection.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T18:58:43.973

```
var user = session.Get<User>(userID);
user.Country = session.Get<Country>(Convert.ToInt32(Request.Form["Country_ID"])); 
```

您必须从数据库中检索国家，然后将其设置为用户

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T22:16:02.217

谢谢安德斯。当我们所做的只是更新对该对象的引用时，为什么我们需要首先取回对象的额外开销？

实际上，我们的控制器会自动反序列化对对象的请求。我们有没有办法告诉 NHibernate 忽略国家对象的更新而只更新用户？我会认为 cascade="none" 会这样做。

如果一个对象上有多个多对一对象需要更新，会发生什么？在保存之前将它们全部取回是很多开销。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T11:27:16.533

这真的会否定首先使用 ORM 的全部目的，不是吗？像这样更新子对象的正常模式是什么？当然，这是一个非常常见的场景。是否要加载每一个：

```
var user = session.Get<User>(userID);
user.Country = session.Get<Country>(Convert.ToInt32(Request.Form["Country_ID"]));
user.Manager = session.Get<User>(Convert.ToInt32(Request.Form["Manager_ID"]));
user.State = session.Get<State>(Convert.ToInt32(Request.Form["State _ID"]));
user.Region = session.Get<Region>(Convert.ToInt32(Request.Form["State _ID"])); 
```

我们真的需要为每个子对象进行额外的数据库调用（尽管这些对象没有被更新）吗？

目前我们有：

```
var ds = new NameValueDeserializer();
var entity = session.Get<TEntity>(entityID);
ds.Deserialize(entity, form);
session.Update(entity); 
```

因此，这通常适用于所有实体。必须专门加载子对象以保存实体将是不必要的编码开销（以及进行额外的数据库调用）。

在配置、映射、拦截器等方面有没有办法解决这个问题？有谁知道为什么 Hibernate 做出了这个设计决定？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T12:18:08.097

您可能应该将此讨论带到 NHibernate 用户组。

[http://groups.google.com/group/nhusers](http://groups.google.com/group/nhusers)

# asp.net - 如何？参数和LIKE语句SQL

> ID：251276
> 
> 赞同：80
> 
> 时间：2008-10-30T18:42:05.893
> 
> 标签：asp.net, sql, vb.net

我正在编写一个搜索函数，并且已经想到了使用参数来防止或至少限制 SQL 注入攻击的这个查询。但是，当我通过我的程序运行它时，它不会返回任何内容：

`SELECT * FROM compliance_corner WHERE (body LIKE '%@query%') OR (title LIKE '%@query%')`

参数可以这样使用吗？还是它们仅在以下情况下有效：

`SELECT * FROM compliance_corner WHERE body LIKE '%<string>%'`（`<string>`搜索对象在哪里）。

编辑：我正在用 VB.NET 构建这个函数，这对你们贡献的语法有影响吗？

另外，我在 SQL Server 中运行了这个语句：`SELECT * FROM compliance_corner WHERE (body LIKE '%max%') OR (title LIKE`%max%')` 并返回结果。

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2008-10-30T19:15:33.097

好吧，我会选择：

```
 Dim cmd as New SqlCommand(
 "SELECT * FROM compliance_corner"_
  + " WHERE (body LIKE @query )"_ 
  + " OR (title LIKE @query)")

 cmd.Parameters.Add("@query", "%" +searchString +"%") 
```

* * *

## 回答 #2

> 赞同：79
> 
> 时间：2008-10-30T18:54:17.537

您的 Visual Basic 代码如下所示：

```
Dim cmd as New SqlCommand("SELECT * FROM compliance_corner WHERE (body LIKE '%' + @query + '%') OR (title LIKE '%' + @query + '%')")

cmd.Parameters.Add("@query", searchString) 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-10-30T18:46:20.127

你所要做的：

`LIKE '%' + @param + '%'`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T18:44:12.613

您可能必须将 % 符号与您的参数连接起来，例如：

喜欢'%' || @查询 || '%'

编辑：实际上，这可能根本没有任何意义。我想我可能误解了你的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-13T20:27:32.000

`%`有时，如果您从 VB 执行查询与从 MS SQL / Access 执行查询时，用作占位符的符号不同。尝试将占位符符号从 更改`%`为`*`。那可能行得通。
但是，如果您调试并希望直接在 MS SQL 或 Access 中复制您的 SQL 字符串以对其进行测试，您可能必须将符号更改回`%`MS SQL 或 Access 中才能实际返回值。

希望这可以帮助

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-08-01T05:04:59.610

也试试这种方式

```
Dim cmd as New SqlCommand("SELECT * FROM compliance_corner WHERE (body LIKE CONCAT('%',@query,'%')  OR  title LIKE CONCAT('%',@query,'%') )")
cmd.Parameters.Add("@query", searchString)
cmd.ExecuteNonQuery() 
```

使用**Concat**而不是**+**

# php - 对 PHP 迭代器进行排序

> ID：251277
> 
> 赞同：13
> 
> 时间：2008-10-30T18:42:21.557
> 
> 标签：php, iterator

有没有一种简单的方法可以在 PHP 中对迭代器进行排序（而不是将其全部拉入数组并对其进行排序）。

我的具体示例是[DirectoryIterator](http://www.php.net/directoryiterator)但如果有一个适用于任何迭代器的解决方案会很好。

```
$dir = new DirectoryIterator('.');
foreach ($dir as $file)
    echo $file->getFilename(); 
```

我希望能够按各种标准（文件名、大小等）对这些进行排序

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T18:57:24.037

没有办法做到这一点。迭代器应该“迭代”整个列表。您必须对基础列表进行排序以实现所需的行为。

顺便说一句，更完整的 SPL 参考在这里： [http ://www.php.net/~helly/php/ext/spl/](http://www.php.net/~helly/php/ext/spl/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-09-30T15:55:32.117

您必须使用 iterator_to_array() 然后 uasort() 来减少。而且，在我的性能测试中，速度足够快。

对于您的具体示例，我知道使用迭代器的最紧凑方式如下：

```
// get (recursively) files matching a pattern, each file as SplFileInfo object
$matches = new RegexIterator(
               new RecursiveIteratorIterator(
                   new RecursiveDirectoryIterator('/path/to/files/')
               ),
               '/(\.php|\.ini|\.xml)$/i'
            );
 $files = iterator_to_array($matches);

// sort them by name
uasort($files, create_function('$a,$b', 'return strnatcasecmp($a->getFilename(), $b->getFilename());')); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-11-10T13:36:14.143

对于5年后在这里结束的人：

如果您使 Iterator 成为 ArrayIterator 的扩展，您可以使用

ArrayIterator::uasort（按值排序）和 ArrayIterator::uksort（按键排序）

[http://php.net/manual/en/arrayiterator.uasort.php](http://php.net/manual/en/arrayiterator.uasort.php)

[http://php.net/manual/en/arrayiterator.uksort.php](http://php.net/manual/en/arrayiterator.uksort.php)

# sql - 选择一列 DISTINCT SQL

> ID：251278
> 
> 赞同：14
> 
> 时间：2008-10-30T18:42:30.977
> 
> 标签：sql, sql-server, coldfusion, cfml

补充：使用 SQL Server 2000 和 2005，因此必须同时在两者上工作。此外，value_rk 不是数字/整数（错误：操作数数据类型唯一标识符对 min 运算符无效）

当我不关心返回的其他列时，有没有办法进行单列“DISTINCT”匹配？例子：

```
**Table**
Value A, Value L, Value P
Value A, Value Q, Value Z 
```

我只需要根据第一行（值 A）中的内容返回其中一个行。我仍然需要第二列和第三列的结果（无论如何，第二列实际上应该完全匹配，但第三列是唯一键，我至少需要其中一个）。

这是我到目前为止所得到的，尽管它显然不起作用：

```
SELECT value, attribute_definition_id, value_rk
FROM attribute_values
WHERE value IN (
    SELECT value, max(value_rk)
    FROM attribute_values
)
ORDER BY attribute_definition_id 
```

我在 ColdFusion 工作，所以如果有一个简单的解决方法，我也愿意接受。我试图限制或“分组”第一列“值”。value_rk 是我的大问题，因为每个值都是唯一的，但我只需要一个。

注意： value_rk 不是数字，因此这不起作用

更新：我有一个工作版本，它可能比纯 SQL 版本慢很多，但老实说，在这一点上任何工作都比没有好。它从第一个查询中获取结果，执行第二个查询，除了将结果限制为一个，并为匹配的值获取匹配的 value_rk。像这样：

```
<cfquery name="queryBaseValues" datasource="XXX" timeout="999">
    SELECT DISTINCT value, attribute_definition_id
    FROM attribute_values
    ORDER BY attribute_definition_id
</cfquery>

<cfoutput query="queryBaseValues">
    <cfquery name="queryRKValue" datasource="XXX">
        SELECT TOP 1 value_rk
        FROM attribute_values
        WHERE value = '#queryBaseValues.value#'
    </cfquery>
    <cfset resourceKey = queryRKValue.value_rk>
    ... 
```

所以你有了它，在 ColdFusion 中明确地选择了一个列。仍然非常欢迎任何纯 SQL Server 2000/2005 建议:)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-30T21:32:46.813

这可能有效：

```
SELECT DISTINCT a.value, a.attribute_definition_id, 
  (SELECT TOP 1 value_rk FROM attribute_values WHERE value = a.value) as value_rk
FROM attribute_values as a
ORDER BY attribute_definition_id 
```

..未测试。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-30T18:51:55.640

```
SELECT a1.value, a1.attribute_definition_id, a1.value_rk
FROM attribute_values AS a1
  LEFT OUTER JOIN attribute_values AS a2
    ON (a1.value = a2.value AND a1.value_rk < a2.value_rk)
WHERE a2.value IS NULL
ORDER BY a1.attribute_definition_id; 
```

换句话说，找到不存在具有相同和更大的`a1`行`a2`的`value`行`value_rk`。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-30T18:56:23.273

这应该适用于 PostgreSQL，我不知道你使用哪个 dbms。

```
SELECT DISTINCT ON (value)
  value, 
  attribute_definition_id, 
  value_rk
FROM 
  attribute_values
ORDER BY
  value, 
  attribute_definition_id 
```

[PostgreSQL 文档](http://www.postgresql.org/docs/8.3/interactive/sql-select.html#SQL-DISTINCT)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T18:49:32.803

这是你要找的吗？

```
SELECT value, attribute_definition_id, value_rk
FROM attribute_values av1
WHERE value_rk IN (
        SELECT max(value_rk)
        FROM attribute_values av2
        WHERE av2.value = av1.value
)
ORDER BY attribute_definition_id 
```

如果 value_rk 是唯一的，这应该有效。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T19:12:05.490

好的，这是我的假设：

标准 SQL Server

value_rk 不是数值，但 value 和 attribute_definition_id*是*数值。

```
SELECT value_rk, MIN(value) as value, MIN(attribute_definition_id) as attribute_definition_id
FROM attribute_values
GROUP BY value_rk
ORDER BY MIN(attribute_definition_id) 
```

如果其中一个字段不是数字，则需要更多考虑 - 请告诉我们。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-05T22:15:37.687

如果您愿意使用表变量，则可以将其全部保存在一个数据库调用中，如下所示：

```
DECLARE @attribute_values TABLE (value int, attribute_definition_id int, value_rk uniqueidentifier)

INSERT INTO @attribute_values (value)
SELECT DISTINCT value FROM attribute_values

UPDATE @attribute_values
SET attribute_definition_id = av2.attribute_definition_id,
    value_rk = av2.value_rk
FROM @attribute_values av1
INNER JOIN attribute_values av2 ON av1.value = av2.value

SELECT value, attribute_definition_id, value_rk FROM @attribute_values 
```

本质上，您正在创建一个有限的记录集，其中的表填充了唯一的“值”值，并让 SQL Server 仅使用主表中的一个匹配项来填补空白。

编辑添加：此语法在 cfquery 中工作得很好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T18:47:15.757

```
SELECT value, attribute_definition_id, value_rk
FROM attribute_values
WHERE value, value_rk IN (
        SELECT value, max(value_rk)
        FROM attribute_values
        GROUP BY value
)
ORDER BY attribute_definition_id 
```

未测试！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-30T18:55:29.487

我不确定我是否完全理解您的设置，但这样的工作是否可行：

```
SELECT value, attribute_definition_id, value_rk
FROM attribute_values
GROUP BY value
ORDER BY attribute_definition_id; 
```

同样，我不确定您要限制哪一列，或者您希望如何限制它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T20:04:51.030

没有我想要的那么优雅——它本质上就是你正在做的，只是在纯 SQL 中——但它可以工作并且都可以在 SQL 中完成。

```
DECLARE @mytable TABLE(mykey NVARCHAR(512), myVal NVARCHAR(512))

声明 @keyVal NVARCHAR(512)
声明 @depVal NVARCHAR(512)
声明 myCursor CURSOR 为
   从属性值中选择 DISTINCT（值）
打开我的光标
从 myCursor 获取下一个到 @keyVal
而@@FETCH_STATUS=0
  开始
     SET @depVal = (SELECT TOP 1 attribute_definition_id FROM attribute_values WHERE VALUE=@keyVal ORDER BY attribute_definition_id)
     插入@mytable（mykey，myVal）值（@keyVal，@depVal）
     从 myCursor 获取下一个到 @keyVal
  结尾
DEALLOCATE myCursor

选择 * 从 @mytable

```

您可以使用此方法添加 depVal2 和其他人。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-01-06T10:52:20.843

我想

```
SELECT DISTINCT a.value, a.attribute_definition_id, 
(SELECT TOP 1 value_rk FROM attribute_values WHERE value = a.value) as value_rk
FROM attribute_values as a
ORDER BY attribute_definition_id 
```

工作过

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-08-31T18:58:28.230

正如 John Fiala 所指出的，当您想要对列的子集执行“不同”操作时，SQL 服务器中的规范答案是使用 group by 子句。为什么这是正确的规范答案？好吧，您想拉入不属于您的“不同”组的列。您究竟想为这些附属列提取哪些行？使用 group by 子句并为这些附属列定义聚合函数可以使您的查询表现良好，因为您现在知道这些附属列是如何获得的。这篇文章提供了更多细节：

[http://weblogs.sqlteam.com/jeffs/archive/2007/10/12/sql-distinct-group-by.aspx](http://weblogs.sqlteam.com/jeffs/archive/2007/10/12/sql-distinct-group-by.aspx)

```
SELECT value_rk, MIN(value) as value, 
MIN(attribute_definition_id) as attribute_definition_id
FROM attribute_values
GROUP BY value_rk 
```

此外，值得注意的是 MIN 和 MAX 适用于文本和其他几种非数值的数据类型。

# c# - 如何在另一个用户控件中使用 asp.net 用户控件？

> ID：251289
> 
> 赞同：6
> 
> 时间：2008-10-30T18:46:41.983
> 
> 标签：c#, asp.net, user-controls, ascx

我有一个用户控件 ( `gallery.ascx`)，我想`photo.ascx`在画廊控件中使用该控件。我在顶部添加了这个寄存器`gallery.ascx`，但仍然找不到照片：

```
<%@ Register TagPrefix="ssctrl" TagName="photo" Src="controls/photo.ascx" %> 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T18:55:19.703

如果有人想知道，注册是正确的，我的照片用户控制标签只是没有正确形成。我确实有它：

```
<ssctrl:photo ID="Photo" Key="<%# Eval("PageTemplatePK") %>" runat="server" /> 
```

并且 Key 属性需要使用单引号而不是双引号，因为它使用的是 Eval 表达式：

```
<ssctrl:photo ID="Photo" Key='<%# Eval("PageTemplatePK") %>' runat="server" /> 
```

在那之后，它奏效了。

# javascript - 是否有一个很好的博客可嵌入代码小部件

> ID：251297
> 
> 赞同：0
> 
> 时间：2008-10-30T18:50:50.697
> 
> 标签：javascript, blogs, widget

我的联合创始人目前正在我们的博客上询问一个可嵌入的代码小部件。

[http://devver.net/blog/2008/10/someone-please-build-an-awesome-embeddable-code-widget/](http://devver.net/blog/2008/10/someone-please-build-an-awesome-embeddable-code-widget/)

基本上我们想要[http://pastie.org/](http://pastie.org/)或[http://codepad.org/](http://codepad.org/)之类的东西，但我们真的想在我们的博客中嵌入代码部分。我们知道有一些用于常见博客和服务器端解决方案的插件，但是能够嵌入一点 javascript 并在任何地方都有格式良好的代码会很棒......

这样的事情存在吗？我们刚刚错过了吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T18:57:49.123

我想你想要一个 javascript 语法荧光笔

*   [http://code.google.com/p/syntaxhighlighter/](http://code.google.com/p/syntaxhighlighter/)

*   [http://shjs.sourceforge.net/](http://shjs.sourceforge.net/)

*   [http://www.google.com/search?q=javascript+syntax+highlighter](http://www.google.com/search?q=javascript+syntax+highlighter)

有时您只是一直在思考错误的关键字；-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-07T00:36:03.440

我们有一个用户指出了一个 WordPress 插件，它使用 Gist 来完成我们所要求的......

[http://pomoti.com/gist-it-english](http://pomoti.com/gist-it-english)

即使您不使用该插件，它看起来也像是 Gist 的一项功能，可让您将代码嵌入网络上任何您想要的地方。[http://gist.github.com](http://gist.github.com)

看起来相当甜美。感谢 Dirceu Jr。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T19:14:02.583

查看[CodeRay](http://coderay.rubychan.de/)和[UltraViolet](http://ultraviolet.rubyforge.org/)。它们都非常好且易于使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T06:50:16.843

我使用 Dojo 中包含的荧光笔（改编自[Ivan Sagalaev 的 highlight.js](http://softwaremaniacs.org/soft/highlight/)）。您需要做的就是在您的网页头部包含几行代码（一个指向 AOL 或 Google 的脚本标签，一个指向 AOL 或 Google 托管的 CSS 的链接，以及一个请求突出显示的简单脚本）和添加带有预格式化片段的 <pre><code lang="javascript"> 块——它们将被自动找到并突出显示。

当然，支持多种语言以及自动猜测代码段的语言。如果用户关闭 JavaScript，它将优雅地降级。

这个解决方案的另一个优点：不需要托管任何文件，不需要配置服务器，不需要动态生成 HTML，可以与任何东西一起使用——即使是静态文件也会被突出显示。

You can see examples in official tests: [test_highlight.html](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/highlight/tests/test_highlight.html), [test_pygments.html](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/highlight/tests/test_pygments.html). This is the example of snippets on my web site: [the article with several highlighted code snippets](http://lazutkin.com/blog/2008/may/18/aop-aspect-javascript-dojo/) — look in the head of this page to see how the highlighter can be included directly from AOL.

# java - 为什么 SomeClass不等于 SomeClass 在 Java 泛型类型中？

> ID：251298
> 
> 赞同：8
> 
> 时间：2008-10-30T18:51:00.523
> 
> 标签：java, generics

我注意到 Collections.sort 的规范：

```
public static <T> void sort(List<T> list, Comparator<? super T> c) 
```

为什么`? super`这里需要“”？如果`ClassB`extends `ClassA`，那么我们是否不能保证 a`Comparator<ClassA>`无论如何都能够比较两个`ClassB`对象，而没有 " `? super`" 部分？

换句话说，给定这段代码：

```
List<ClassB> list = . . . ;
Comparator<ClassA> comp = . . . ;
Collections.sort(list, comp); 
```

为什么即使没有`? super`为 Collections.sort() 的声明指定“”，编译器也不够聪明，无法知道这是可以的？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T19:00:02.190

Josh Bloch 今年在 Google I/O 上做了一个名为[Effective Java Reloaded](http://sites.google.com/site/io/effective-java-reloaded)的演讲，您可能会觉得这很有趣。它讨论了一个名为“Pecs”（生产者`extends`、消费者`super`）的助记符，它解释了为什么在输入参数中使用`? extends T`和`? super T`（仅；从不用于返回类型），以及何时使用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-30T19:07:59.147

[在More Fun with Wildcards](http://java.sun.com/docs/books/tutorial/extra/generics/morefun.html)中有一个非常好的（但曲折的）解释。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T19:07:15.093

这类似于 C#，我几天前才了解它的原因（困难的方式，然后是 PDC 信息丰富的方式）。

认为`Dog extends Animal`

`Blah<Dog>`不**一样**，因为`Blah<Animal>`它们具有完全不同的类型签名，即使`Dog`extends `Animal`。

例如假设一个方法`Blah<T>`：

```
T Clone(); 
```

在`Blah<Dog>`这就是`Dog Clone();`而在`Blah<Animal>`这就是`Animal Clone();`。

您需要一种方法来区分编译器可以说`Blah<Dog>`具有相同的公共接口，`Blah<Animal>`这就是所`<? super T>`表明的 - 任何用作 T 的类都可以在`Blah<? super T>`.

`Blah<out T>`（我相信在 C# 4.0 中。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T19:04:42.323

对您来说很明显，在 的情况下`Comparator`，任何祖先都`T`可以工作。但是编译器不知道这样的类`Comparator`函数 - 它只需要被告知它是否应该允许`<T>`或`<? super T>`.

换一种方式来看，是的，`Comparator`在这种情况下，任何祖先都可以工作，而库开发人员所说的方式就是使用`<? super T>`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T20:48:01.973

对您的问题的简单回答是，图书馆设计师希望为图书馆用户提供最大的灵活性；例如，此方法签名允许您执行以下操作：

```
List<Integer> ints = Arrays.asList(1,2,3);
Comparator<Number> numberComparator = ...;

Collections.sort(ints, numberComparator); 
```

使用通配符可以防止您被迫使用`Comparator<Integer>`; 语言要求库设计者指定通配符这一事实使他或她能够允许或限制这种使用。

# facebook - 与传统 Facebook 应用相比，新的 Facebook Connect 平台提供了什么？

> ID：251304
> 
> 赞同：6
> 
> 时间：2008-10-30T18:52:08.727
> 
> 标签：facebook

[Facebook Connect](http://developers.facebook.com/connect.php)似乎是在您自己的网站上利用用户的 Facebook 帐户的一种很酷的新方法（获取他们的朋友列表、写入他们的个人资料等）。我不明白的是，新的 Facebook Connect 平台通过授予离线访问权限的传统 Facebook 应用程序提供了什么。

任何人都可以通过提供两个选项之间差异的清晰解释来帮助我吗？什么时候使用一个比另一个更好？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-30T18:58:04.363

Facebook connect 似乎是为与不通过 Facebook 访问的站点集成而设计的，但这些站点存在于 facebook 之外，并使用 facebook 作为集成方法。

我认为这是一种非常不同的做事方式，如果你想在你的 OWN 网站上集成 Facebook，Facebook Connect 就是你要走的路。如果你想构建一个在 facebook 中工作的应用程序，当前的方法就是要走的路。

# c# - 在 C# 中更改资源处理程序的标头中的名称

> ID：251307
> 
> 赞同：3
> 
> 时间：2008-10-30T18:52:42.300
> 
> 标签：c#, asp.net, mime-types, handler

我有一个资源处理程序，它是 Response.WriteFile(fileName) 基于通过查询字符串传递的参数。我正在正确处理 mimetype，但问题出在某些浏览器中，文件名显示为 Res.ashx（处理程序的名称）而不是 MyPdf.pdf（我正在输出的文件）。有人可以告诉我在将文件发送回服务器时如何更改文件名吗？这是我的代码：

```
// Get the name of the application
string application = context.Request.QueryString["a"];
string resource = context.Request.QueryString["r"];

// Parse the file extension
string[] extensionArray = resource.Split(".".ToCharArray());

// Set the content type
if (extensionArray.Length > 0)
    context.Response.ContentType = MimeHandler.GetContentType(
        extensionArray[extensionArray.Length - 1].ToLower());

// clean the information
application = (string.IsNullOrEmpty(application)) ?
    "../App_Data/" : application.Replace("..", "");

// clean the resource
resource = (string.IsNullOrEmpty(resource)) ?
    "" : resource.Replace("..", "");

string url = "./App_Data/" + application + "/" + resource;

context.Response.WriteFile(url); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T19:09:03.560

根据 Joel 的评论，您的实际代码将如下所示：

```
context.Response.AddHeader("content-disposition", "attachment; filename=" + resource); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T18:58:43.817

这篇 Scott Hanselman 的帖子应该会有所帮助：
[http ://www.hanselman.com/blog/CommentView.aspx?guid=360](http://www.hanselman.com/blog/CommentView.aspx?guid=360)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T19:18:42.903

谢谢你们的回答。最终代码有效并检查 pdf。

```
if (extensionArray[extensionArray.Length - 1].ToLower() == "pdf")
    context.Response.AddHeader("content-disposition", 
        "Attachment; filename=" + resource); 
```

# javascript - 将状态传递给 JavaScript 中的回调适当使用闭包？

> ID：251313
> 
> 赞同：2
> 
> 时间：2008-10-30T18:55:10.703
> 
> 标签：javascript, closures

假设您想在 JavaScript 中发出一个异步请求，但您想将一些状态传递给回调方法。以下是 JavaScript 中对闭包的适当使用吗？

```
function getSomethingAsync(someState, callback) {
    var req = abc.createRequestObject(someParams);
    req.invoke(makeCallback(someState, callback));
}

function makeCallback(someState, callback) {
    return function getSomethingCallback(data) {
        var result = processDataUsingState(data, someState);
        callback(result); // alternately/optionally pass someState along to result
    }
} 
```

如果没有，是否有更好或更惯用的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T19:08:58.490

我没有看到任何直接的问题 - 闭包之所以强大有很多原因，其中之一是消除了使用全局变量进行状态维护的需要。

也就是说，关于闭包，您唯一需要警惕的是通常发生在 IE 中的内存泄漏，但这些通常是 IIRC，与 DOM 元素和附加的事件处理程序相关。

继续！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-19T17:31:58.197

更惯用的方法是使用[`Function.bind`](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind)，然后您不需要复制代码来创建闭包。我将使用一个简单的示例（没有您的自定义代码）来解释

```
/**
 * Retrieves the content of a url asyunchronously
 * The callback will be called with one parameter: the html retrieved
 */
function getUrl(url, callback) {
    $.ajax({url: url, success: function(data) {
        callback(data);
    }})    
}

// Now lets' call getUrl twice, specifying the same 
// callback but a different id will be passed to each
function updateHtml(id, html) {
    $('#' + id).html(html);
}

// By calling bind on the callback, updateHTML will be called with 
// the parameters you passed to it, plus the parameters that are used
// when the callback is actually called (inside )
// The first parameter is the context (this) to use, since we don't care,
// I'm passing in window since it's the default context
getUrl('/get/something.html', updateHTML.bind(window, 'node1'));
// results in updateHTML('node1', 'response HTML here') being called
getUrl('/get/something-else.html', updateHTML.bind(window, 'node2'));
// results in updateHTML('node2', 'response HTML here') being called 
```

`Function.bind`是新的，所以如果您需要向后支持，请查看兼容性部分 [`Function.bind`](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind)

最后，我知道这个问题没有被标记为 jQuery。这只是在不处理跨浏览器问题的情况下显示异步函数的最快方法

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T19:05:51.367

使用匿名函数更好（更好）：

```
function getSomethingAsync (someState, callback) {
    req.invoke (function (data) {
       var result = processDataUsingState (data, someState);
       callback (result);
    });
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-22T21:57:52.760

您还可以使用 call() / apply() 在函数中操作“this”的值。

例如，指定异步方法的另一个参数是在回调中用作“this”的对象。这就是 jQuery 在事件回调中将 dom 节点设置为“this”的方式。

```
function getSomethingAsync(callback, scope) {
    var req = abc.createRequestObject(someParams);
    req.invoke(function(rsp) {
      callback.apply(scope, [rsp]);
    });
}

// usage:
getSomethingAsync(function() {console.log(this.someState)}, {someState:'value'}); 
```

# php - 从自己的域中读取文件会导致 404

> ID：251317
> 
> 赞同：1
> 
> 时间：2008-10-30T18:55:46.770
> 
> 标签：php, apache

当我尝试使用`curl`或从[http://example.com/](http://example.com/)`file_get_contents`读取 http://example.com/python/json/ 之类[的](http://example.com/python/json/)内容时，我应该会收到 JSON 响应，但会收到 404 错误。在我自己的域之外使用 curl 或任何其他方法效果很好。

```
echo file_get_contents('http://example.com/python/json/'); => 404
echo file_get_contents('http://google.com'); => OK 
```

相同的脚本适用于我的笔记本电脑，但我不知道有什么区别。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T18:59:33.987

看起来 example.com 不是 IP 地址的默认域，并且 file_get_contents 使用 HTTP/1.0 而不是 HTTP/1.1 和/或不发送 Host: 标头。试试 PHP 中的 curl 支持：

```
$curl = curl_init();
curl_setopt($curl, CURLOPT_URL, 'http://example.com/');
curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);
$result = curl_exec($curl);
curl_close($curl); 
```

或者，/etc/hosts 文件为 example.com 设置了错误的 IP 地址。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T19:00:37.573

也许与域有关？当然，你不想在这里透露它，所以你可能需要做一些事情，但我想健全性检查是你可以通过网络浏览器访问该 URL（或命令行工具，如 GET，如果你'只是命令行）。

您也可以只对域执行 ping 和/或跟踪路由 - 结果可能很有启发性。

# c++ - 将类对象传递给函数（可能通过指针而不是引用）C++

> ID：251325
> 
> 赞同：1
> 
> 时间：2008-10-30T18:58:59.463
> 
> 标签：c++, reference, arguments

所以假设我有两个不同的功能。一个是 BST 类的一部分，一个只是一个辅助函数，它将调用该类函数。我会在这里列出它们。

```
sieve(BST<T>* t, int n); 
```

这个函数是这样调用的： sieve(t,n) 对象被称为 BST t；

我将在 sieve 函数中使用类 remove 函数来删除特定对象。我不确定这个基本功能的原型应该是什么样子？这样做：

```
sieve(BST<int> t, int n) 
```

这里发生的一切都编译得很好，但是当调用 t.remove 函数时，我看不到实际结果。我假设是因为它只是创建一个副本或整个其他 t 对象，而不是从我的 main() 函数传递一个。

如果我在创建原始对象的主函数中调用删除函数 (t.remove(value))，它将正确删除所有内容。一旦我开始通过我的筛子功能进行操作，当我从我的主要功能中重新打印出来时，我看不到任何变化。所以我的主要功能看起来像这样：

```
int main ()
{
   int n,
       i,
       len;

   BST<int> t;

   cin >> n;
   vector<int> v(n);

   srand(1);

   for (i = 0; i < n; i++)
      v[i] = rand() % n;

   for (i = 0; i < n; i++)
      t.insert(v[i]);
       print_stat(t);
   t.inOrder(print_data);

   sieve(v,t,n);
   print_stat(t);
   t.inOrder(print_data);
   return 0;
} 
```

所以我的结果最终是一样的，即使我在函数中的调试语句显示它实际上是在删除一些东西。我猜我出错的地方是我如何将 t 对象传递给函数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T19:03:36.893

```
sieve(BST<int>& t, int n) 
```

`&`指定通过*引用*而不是值传递。:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T19:06:40.743

如果我正确理解您的问题，您应该使用

```
BST t;    
sieve(BST<T> *t, int n); 
```

并将其调用为：

```
sieve(&t,n) 
```

将指针传递给`t`对象

或者

```
BST t; 
sieve(BST<T> &t, int n); 
```

并将其调用为：

```
sieve(t,n) 
```

传递对`t`对象的引用

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T19:06:18.870

签名：

```
/* missing return type */ sieve<BST<int> t, int n); 
```

实际上，将复制`BST<int>`传入的 to `sieve()`。因此，您对其所做的任何更改都将被丢弃（除非您返回它的副本）。

你可能想要这样的东西：

```
void sieve<BST<int> & t, int n); 
```

它传入一个引用，因此您在方法内部所做的任何修改`t`都是对您传入的对象（不是副本）进行的。

一旦你理解并理解了它，你可能希望将`sieve()`函数设为“函数模板”，以便它可以采用`BST<>`包含任何类型的 a。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T19:08:56.680

> 这里发生的一切都编译得很好，但是当调用 t.remove 函数时，我看不到实际结果。我假设是因为它只是创建一个副本或整个其他 t 对象，而不是从我的 main() 函数传递一个。

正确的。这正是发生的情况，因为在 C++ 中，参数是按值传递给函数的。传递引用或指针将解决您的问题。使用参考更干净。

# java - 是否类似于 Java 1.5 中的 ServiceLoader？

> ID：251336
> 
> 赞同：15
> 
> 时间：2008-10-30T19:04:01.013
> 
> 标签：java, reflection, plugins, service

如何在运行时在实现定义接口的类路径中发现类？

ServiceLoader 很适合（我想，我没用过），但我需要在 Java 1.5 中使用。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-30T20:41:22.017

Java 1.5 没有为此内置任何内容。我自己实现了它；这不是太复杂。但是，当我们升级到 Java 6 时，我将不得不将对我的实现的调用替换为对`ServiceLoader`. 我本可以在应用程序和加载器之间定义一个小桥梁，但我只在少数地方使用它，而包装器本身将是 ServiceLoader 的一个很好的候选者。

这是核心思想：

```
public <S> Iterable<S> load(Class<S> ifc) throws Exception {
  ClassLoader ldr = Thread.currentThread().getContextClassLoader();
  Enumeration<URL> e = ldr.getResources("META-INF/services/" + ifc.getName());
  Collection<S> services = new ArrayList<S>();
  while (e.hasMoreElements()) {
    URL url = e.nextElement();
    InputStream is = url.openStream();
    try {
      BufferedReader r = new BufferedReader(new InputStreamReader(is, "UTF-8"));
      while (true) {
        String line = r.readLine();
        if (line == null)
          break;
        int comment = line.indexOf('#');
        if (comment >= 0)
          line = line.substring(0, comment);
        String name = line.trim();
        if (name.length() == 0)
          continue;
        Class<?> clz = Class.forName(name, true, ldr);
        Class<? extends S> impl = clz.asSubclass(ifc);
        Constructor<? extends S> ctor = impl.getConstructor();
        S svc = ctor.newInstance();
        services.add(svc);
      }
    }
    finally {
      is.close();
    }
  }
  return services;
} 
```

更好的异常处理留给读者练习。此外，该方法可以参数化以接受调用者选择的 ClassLoader。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-03-09T13:53:15.800

`javax.imageio.spi.ServiceRegistry`与以前的 Java 版本等效。它从 Java 1.4 开始可用。

它看起来不像一个通用的实用程序类，但它是。它甚至比 更强大`ServiceLoader`，因为它允许对返回的提供程序的顺序进行一些控制并直接访问注册表。

请参阅[http://docs.oracle.com/javase/7/docs/api/index.html?javax/imageio/spi/ServiceRegistry.html](http://docs.oracle.com/javase/7/docs/api/index.html?javax/imageio/spi/ServiceRegistry.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T21:21:13.777

ServiceLoader 非常基础，从 1.3 开始就在 JDK 中（非正式地）使用。ServiceLoader 终于使它成为一等公民。它只是查找为您的接口命名的资源文件，该文件基本上捆绑在库 jar 的 META-INF 目录中。

该文件包含要加载的类的名称。

因此，您将拥有一个名为：

META-INF/services/com.example.your.interface

里面只有一行：com.you.your.interfaceImpl。

代替 ServiceLoader，我喜欢 Netbeans Lookup。它适用于 1.5（也许是 1.4）。

开箱即用，它的功能与 ServiceLoader 完全相同，而且使用起来很简单。但它提供了更多的灵活性。

这是一个链接： http: [//openide.netbeans.org/lookup/](http://openide.netbeans.org/lookup/)

这是一篇关于 ServiceLoader 的文章，但它在底部提到了 Netbeans Lookup： [http ://weblogs.java.net/blog/timboudreau/archive/2008/08/simple_dependen.html](http://weblogs.java.net/blog/timboudreau/archive/2008/08/simple_dependen.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-30T11:47:57.477

很遗憾，

> Java 1.5 没有为此内置任何内容...

只是真相的一部分。

周围有非标`sun.misc.Service`。

[http://www.docjar.com/docs/api/sun/misc/Service.html](http://www.docjar.com/docs/api/sun/misc/Service.html)

请注意，它不是标准 J2SE API 的一部分！它是 Sun JDK 的非标准部分。所以你不能依赖它，如果你使用，比如说，`JRockit`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-14T20:44:37.737

这是一个老问题，但另一种选择是使用**Package Level Annotations**。请参阅我的答案：[查找实现接口的 Java 类](https://stackoverflow.com/questions/435890/find-java-classes-implementing-an-interface/5831808#5831808)

包级注解是 package-info.java 类中的注解。

JAXB 使用它而不是服务加载器。我也认为它比服务加载器更灵活。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T20:34:27.290

没有可靠的方法可以知道类路径中有哪些类。根据其[文档](http://java.sun.com/javase/6/docs/api/java/util/ServiceLoader.html)，ServiceLoader 依赖外部文件来告诉它要加载哪些类；你可能想做同样的事情。基本思想是有一个带有要加载的类名称的文件，然后使用反射来实例化它/它们。

# tomcat - 调整/最佳实践 Inetsoft 样式报告 BI 工具？

> ID：251337
> 
> 赞同：0
> 
> 时间：2008-10-30T19:04:02.977
> 
> 标签：tomcat, db2, data-warehouse, business-intelligence

有人在使用商业智能工具 Inetsoft Style Report 吗？我坚持下去，想知道是否有人对服务器管理员的调整和/或最佳实践有建议？我们在使用 Tomcat 和 db2 数据库的快速 Solaris 机器上运行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-12-31T00:10:51.403

你有我的同情。我们在具有 4G 内存的双 Xeon 上运行我们的，它仍然是一头猪。我们的一位程序员是前 Inetsoft 员工，并已尽一切努力对其进行优化。

我唯一的建议是，如果您的组织正在考虑 StyleReport，请运行！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-04T21:43:33.107

吉姆和克林特，

这是来自 InetSoft 的 Mark。很抱歉听到性能问题。这绝对是我们的支持团队可以提供帮助的类型。因此，请联系您的 InetSoft 客户经理或在[http://www.inetsoft.com/customer/support.jsp](http://www.inetsoft.com/customer/support.jsp)上登记票证。下一个版本的 Style Intelligence 和 Style Report 将于本月发布，性能增强在进步列表中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-25T13:37:03.437

您可以检查的一件事是当服务器运行时 CPU 是否被充分利用。如果它不是或接近 100%，请检查 Tomcat 线程池大小并尝试增加它。StyleReport 中也应该有参数来控制它的线程池大小。通常，如果 CPU 被充分利用，性能应该没问题。

# java - 在 Java 5 中获取驱动器大小

> ID：251338
> 
> 赞同：0
> 
> 时间：2008-10-30T19:04:03.417
> 
> 标签：java, size, drive

我想获得驱动器的大小（或指向分区的 UNC 路径会很好，但不是必需的），以及所述驱动器（或 UNC 路径）的可用空间。这不需要跨平台工作；仅在 Windows 中。

我知道在 Java 6 中很容易做到，但这不是一个选择；我被Java 5困住了。

我可以通过以下方式获得可用空间：

> cmd.exe /c Z:\ /-c
> 
> 或者
> 
> cmd.exe /c \\server\share /-c

并且只是免费解析出结果字节。但是我似乎找不到获得总驱动器大小的方法。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T19:34:21.513

一种方法是在命令行上使用 fsutil。它返回如下内容：

```
D:\>fsutil fsinfo ntfsinfo c:
NTFS Volume Serial Number :       0xd49cf9cf9cf9ac5c
Version :                         3.1
Number Sectors :                  0x0000000004a813ff
Total Clusters :                  0x000000000095027f
Free Clusters  :                  0x00000000002392f5
Total Reserved :                  0x0000000000000490
Bytes Per Sector  :               512
Bytes Per Cluster :               4096
Bytes Per FileRecord Segment    : 1024
Clusters Per FileRecord Segment : 0
Mft Valid Data Length :           0x000000000e70c000
Mft Start Lcn  :                  0x00000000000c0000
Mft2 Start Lcn :                  0x0000000000000010
Mft Zone Start :                  0x0000000000624ea0
Mft Zone End   :                  0x0000000000643da0 
```

将您的扇区数乘以每个扇区的字节数以获得您的大小。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T02:58:16.683

如果您对此感到满意，则可以使用 JNI 调用轻松完成此操作...

如果您想要一个可与 JDK1.5 一起使用的预打包库，请查看[Apache FileSystemUtils](http://commons.apache.org/io/api-release/index.html?org/apache/commons/io/FileSystemUtils.html)

这只是包装了您描述的系统调用，但至少它是一个您可以使用的标准库，直到您能够使用 1.6。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-13T09:01:35.857

您可以使用[SIGAR](http://support.hyperic.com/display/SIGAR/Home)库，它可以让您在许多平台上进行本机访问。

# windows - 如何获取与进程关联的 GDI 对象

> ID：251343
> 
> 赞同：12
> 
> 时间：2008-10-30T19:04:53.163
> 
> 标签：windows, command-line

我正在调查我们的一个智能客户端应用程序中的 GDI 泄漏问题。我正在寻找一种工具（如**tasklist**）来获取与进程关联的 GDI 对象。我可以在任务管理器中看到 GDI 对象，但我需要在某处定期捕获它。例如在文本文件中。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-30T20:29:44.443

[使用GetGuiResources](http://msdn.microsoft.com/en-us/library/ms683192.aspx) API 函数编写一个程序来定期记录进程使用的 GDI 句柄的数量应该非常简单。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-30T15:54:36.563

完全免费的 Process Explorer ( [http://www.sysinternals.com](http://www.sysinternals.com) ) 允许您以图形方式检查这个以及与正在运行的进程相关的无数其他方面。添加`GDI Objects`到要显示的列中，您就可以开始运行了。该列`GDI Objects`可以在对话框的`Process Memory`选项卡中找到。`Select Columns`

注意：微软收购了他们的工具，我相信 Mark Russinovich 现在为微软工作。Sysinternals 工具通常不需要任何安装，只需将它们复制到方便的地方，如果它们还没有的话，它们应该在你的工具箱中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-03-10T20:48:58.740

使用来自 NirSoft 的免费工具[GDIView 。](http://www.nirsoft.net/utils/gdi_handles.html)

他们的描述：

> GDIView 是一个独特的工具，它显示每个进程打开的 GDI 句柄（画笔、钢笔、字体、位图和其他）列表。它显示每种类型的 GDI 句柄的总数，以及有关每个句柄的详细信息。对于需要跟踪软件中 GDI 资源泄漏的开发人员来说，此工具非常有用。

您可以将 GDI 计数器列表保存为常规、制表符分隔、逗号分隔和表格文本文件，以及水平或垂直 HTML 文件或 XML 文件。

# ruby-on-rails - ActiveRecord 查找以

> ID：251345
> 
> 赞同：46
> 
> 时间：2008-10-30T19:05:48.543
> 
> 标签：ruby-on-rails, ruby, activerecord

非常简单的问题 - 我如何进行搜索以查找名称以 ActiveRecord 中某个字符串开头的所有记录。我已经在互联网上看到了使用逐字 LIKE SQL 子句的各种位 - 但据我所知，这不是“正确”的做法。

是否有“正确”的 Rails 方式？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-10-30T19:52:32.427

如果要在数据库中进行搜索，则需要使用 SQL。

而且，当然，您需要在数据库中进行搜索，否则您需要将*所有*对象加载到 Ruby 中（这不是一件好事）。

因此，您将需要类似的东西

```
MyModel.find(:all, :conditions => ["field LIKE ?", "#{prefix}%"]) 
```

where`prefix`是您要查找的字符串的变量。

在 Rails 3.0+ 中，这变成：

```
MyModel.where("field LIKE :prefix", prefix: "#{prefix}%") 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-30T20:03:02.767

我强烈推荐[Searchlogic](http://rdoc.info/projects/binarylogic/searchlogic)插件。

然后就很简单了：

```
@search = Model.new_search(params[:search])
@search.condition.field_starts_with = "prefix"
@models = @search.all 
```

Searchlogic 足够聪明，就像 ActiveRecord 一样，可以获取`starts_with`条件中的字段名称。它还将处理所有分页。

此方法将有助于防止 SQL 注入，并且与数据库无关。Searchlogic 最终会根据您使用的数据库适配器以不同的方式处理搜索。您也不必编写任何 SQL！

Searchlogic 有很好的文档并且易于使用（我自己是 Ruby 和 Rails 的新手）。当我遇到困难时，插件的作者甚至在几个小时内直接回复了一封电子邮件，帮助我解决了我的问题。我不能推荐 Searchlogic 足够多......正如你所知道的。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-10-31T16:19:17.387

每次我想查看特定列是否以前缀开头时，我都不想编写范围。

```
# initializers/active_record_initializers.rb
class ActiveRecord::Base
  # do not accept a column_name from the outside without sanitizing it
  # as this can be prone to sql injection
  def self.starts_with(column_name, prefix)
    where("lower(#{column_name}) like ?", "#{prefix.downcase}%")
  end
end 
```

像这样称呼它：

```
User.starts_with('name', 'ab').limit(1) 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-08-05T16:38:46.407

免责声明：我是 Ruby 和 Rails 的新手，我仍在努力学习 Ruby 做事的方式，但我已经有大半辈子的时间在编码，而且专业十年。DRY 是一个我非常熟悉的概念。这是我实现它的方式。和narsk的回答很像，我觉得也不错。

```
# name_searchable.rb
# mix this into your class using
#   extend NameSearchable
module NameSearchable
  def search_by_prefix (prefix)
    self.where("lower(name) LIKE '#{prefix.downcase}%'")
  end
end 
```

然后在你的模型中：

```
class User < ActiveRecord::Base
  extend NameSearchable
  ...
end 
```

然后当你想使用它时：

```
User.search_by_prefix('John')   #or
User.search_by_prefix("#{name_str}") 
```

需要注意的一件事：

传统的关系数据库在满足这类查询方面并不是特别好。如果您正在寻找一种不会在负载下杀死数据库的高响应实现，那么您可能应该使用针对该目的量身定制的解决方案。流行的例子包括 Solr 或 Sphinx，还有很多其他的。有了这个实现，因为你 DRY，你可以在一个地方用一个单独的索引器替换这个实现，你就可以开始摇滚了。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-22T15:03:45.110

非常类似于上面的答案，但是如果您使用的是 ActiveRecord...2.1 或更高版本，则可以使用命名范围，它允许您在通过关联检索的记录上使用此“查找器”：

```
class User
  named_scope :with_name_like, lambda {|str|
    :conditions => ['lower(name) like ?', %(%#{str.downcase}%)]
  }
end 
```

像这样使用：

```
User.with_name_like("Samson") 
```

（返回数据库中名称如“Samson”的所有用户。

或者：

```
some_association.users.with_name_like("Samson") 
```

用户仅使用“Samson”之类的名称关闭该关联。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-08-31T22:57:58.960

现在是 2012 年，我想我会在此更新中加入 narsk 的回答。

`named_scope`不久前就变成`scope`了，所以这个例子变成了

```
class User
  scope :name_starts_with, lambda {|str|
    :conditions => ['lower(name) like ?', "#{str.downcase}%"]
  }
end 
```

请注意，我`%`从 narsk 的解决方案中删除了第一个，因为 OP 要求的是“starts_with”而不是“包含”匹配。

现在你可以做类似的事情

```
User.name_starts_with("b").each do {|bs| puts bs.inspect}
bob = User.name_starts_with("bob").first

… etc 
```

请注意，范围*总是返回集合*，而不是单个结果。当我第一次开始使用 AR 时，这让我很震惊，但我仍然时不时地忘记了这一点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-02-14T19:27:22.900

Dave Sag，我想您的代码的第一部分应该是

```
class User
  scope :name_starts_with, (lambda do |str|
                              {:conditions => ['lower(name) like ?', "#{str.downcase}%"]}
                            end )
end 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-06-20T08:05:06.940

同一件事的非常简洁的语法可能是：

```
Model.where(field: ('prefix'...'prefiy')) 
```

这呈现：

```
WHERE ( field >= 'prefix' AND field < 'prefiy') 
```

这是因为*“prefiy”是第一个按字母顺序与**“prefix”*前缀不匹配的字符串。

我不会正常使用它（我会选择 squeel 或 ransack），但如果由于某种原因您必须坚持查询的哈希语法，它可以节省您的时间......

# c# - 在哈希冲突和字符串性能方面的最佳哈希算法

> ID：251346
> 
> 赞同：53
> 
> 时间：2008-10-30T19:05:49.060
> 
> 标签：c#, algorithm, hash

如果我们有以下优先级（按此顺序），那么最好的散列算法是什么：

1.  最小的哈希冲突
2.  表现

它不一定是安全的。基本上我正在尝试根据某些对象的属性组合创建索引。**所有属性都是字符串**。

任何对 c# 实现的引用将不胜感激。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-03T21:18:30.237

忘记“最好”这个词。无论任何人可能想出哪种哈希算法，除非您有一组非常有限的数据需要进行哈希处理，否则每个平均性能非常好的算法如果只提供正确的（或从您的角度来看）可能变得完全无用“错误”）数据。

与其浪费太多时间考虑如何在不使用过多 CPU 时间的情况下让哈希更无冲突，我宁愿开始考虑“如何减少冲突问题”。例如，如果每个哈希桶实际上是一个表，并且该表中的所有字符串（发生冲突）都按字母顺序排序，您可以使用二进制搜索（仅 O(log n)）在桶表中搜索，这意味着，即使每个第二个哈希桶有 4 次冲突，您的代码仍然会有不错的性能（与无冲突表相比会慢一些，但不会那么多）。这里的一大优势是，如果你的表足够大并且你的哈希不是太简单，

实际上，在使用二进制搜索直接在排序表中搜索结果比散列更快之前，我自己也遇到过这种情况！尽管我的散列算法很简单，但散列值需要相当长的时间。性能测试表明，只有当我得到超过 700-800 个条目时，散列确实比二分查找快。但是，由于该表无论如何都不会超过 256 个条目，并且平均表低于 10 个条目，因此基准测试清楚地表明，在每个系统、每个 CPU 上，二进制搜索都更快。在这里，通常已经比较数据的第一个字节足以导致下一次 bsearch 迭代的事实（因为数据过去在第一个到两个字节中已经非常不同）结果证明是一个很大的优势。

所以总结一下：我会采用一个不错的哈希算法，它不会导致太多的平均冲突并且相当快（如果它非常快，我什至会接受更多的冲突！）而是优化我的代码如何一旦发生冲突，获得最小的性能损失（他们会的！除非您的哈希空间至少等于或大于您的数据空间，并且您可以将唯一的哈希值映射到每个可能的数据集）。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-30T19:23:14.983

正如[Nigel Campbell](https://stackoverflow.com/questions/251346/best-hashing-algorithm-in-terms-of-hash-collisions-and-performance#251361)指出的那样，没有“最佳”散列函数之类的东西，因为它取决于您正在散列的数据特征以及您是否需要加密质量散列。

也就是说，这里有一些指针：

*   由于您用作哈希输入的项目只是一组字符串，因此您可以简单地组合每个单独字符串的哈希码。我已经看到了建议执行此操作的以下伪代码，但我不知道对它的任何特定分析：

    ```
    int hashCode = 0;

    foreach (string s in propertiesToHash) {
        hashCode = 31*hashCode + s.GetHashCode();
    } 
    ```

    根据[这篇文章](http://www.themissingdocs.net/wordpress/?m=200607)，System.Web 有一个内部方法，它使用以下方法组合哈希码

    ```
    combinedHash = ((combinedHash << 5) + combinedHash) ^ nextObj.GetHashCode(); 
    ```

    我还看到了将哈希码简单地异或的代码，但这对我来说似乎是个坏主意（尽管我再次没有分析来支持这一点）。如果没有别的，如果相同的字符串以不同的顺序散列，你最终会发生冲突。

*   我使用 FNV 效果很好： [http ://www.isthe.com/chongo/tech/comp/fnv/](http://www.isthe.com/chongo/tech/comp/fnv/)

*   Paul Hsieh 有一篇不错的文章：[http ://www.azillionmonkeys.com/qed/hash.html](http://www.azillionmonkeys.com/qed/hash.html)

*   Bob Jenkins 的另一篇不错的文章最初于 1997 年发表在 Dobb 博士的期刊上（链接的文章有更新）：[http ://burtleburtle.net/bob/hash/doobs.html](http://burtleburtle.net/bob/hash/doobs.html)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-30T19:08:33.220

没有一种单一的最佳散列算法。如果您有一个已知的输入域，您可以使用完美散列生成器（例如[gperf](http://www.gnu.org/software/gperf/)）来生成散列算法，该算法将在该特定输入集上获得 100% 的比率。否则，这个问题就没有“正确”的答案。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-31T00:57:16.010

我将在这里跛脚并给出更理论的回答而不是精确的答案，但请接受其中的价值。

首先有两个明显的问题：

一种。碰撞概率 B. 散列的性能（即：时间、CPU 周期等）

这两个问题有轻微的关联。它们不是完全相关的。

问题 a 处理哈希值和生成的哈希空间之间的差异。当您散列一个 1KB 文件（1024 字节）文件并且散列有 32 个字节时，将有：

1,0907481356194159294629842447338e+2466（即一个有 2466 个零的数字）输入文件的可能组合

并且哈希空间将有

1,1579208923731619542357098500869e+77（即有77个零的数字）

差异是巨大的。它们之间有 2389 个零差。因为我们将 10^2466 个案例减少到 10^77 个案例，所以会有冲突（当两个不同的输入文件具有完全相同的哈希时，冲突是一种特殊情况）。

最小化冲突风险的唯一方法是扩大哈希空间，从而使哈希更长。理想情况下，哈希将具有文件长度，但这在某种程度上是愚蠢的。

* * *

第二个问题是性能。这仅涉及哈希算法。当然，更长的哈希很可能需要更多的 CPU 周期，但更智能的算法可能不需要。对于这个问题，我没有明确的案例答案。这太难了。

但是，您可以对不同的哈希实现进行基准测试/测量并从中得出预结论。

祝你好运 ;）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-30T19:20:59.310

Java 的 String 类使用的简单 hashCode 可能显示出合适的算法。

下面是“GNU Classpath”的实现。（许可证：GPL）

```
 /**
   * Computes the hashcode for this String. This is done with int arithmetic,
   * where ** represents exponentiation, by this formula:<br>
   * <code>s[0]*31**(n-1) + s[1]*31**(n-2) + ... + s[n-1]</code>.
   *
   * @return hashcode value of this String
   */
  public int hashCode()
  {
    if (cachedHashCode != 0)
      return cachedHashCode;

    // Compute the hash code using a local variable to be reentrant.
    int hashCode = 0;
    int limit = count + offset;
    for (int i = offset; i < limit; i++)
      hashCode = hashCode * 31 + value[i];
    return cachedHashCode = hashCode;
  } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-30T19:14:43.080

您可以使用[此处描述](http://www.concentric.net/~Ttwang/tech/inthash.htm)的 Knuth 哈希函数获得两者。

假设哈希表大小为 2 次方，它的速度非常快——只有一次乘法、一次移位和一位与。更重要的是（对您而言）它非常适合最小化碰撞（请参阅[此分析](http://blog.clawpaws.net/post/2007/04/22/Good-Hash-Functions)）。

[这里](http://www.cs.hmc.edu/~geoff/classes/hmc.cs070.200101/homework10/hashfuncs.html)描述了一些其他好的算法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T20:11:28.053

这是[杜鹃哈希](http://en.wikipedia.org/wiki/Cuckoo_hashing)。

> 查找只需要检查哈希表中的两个位置，在最坏的情况下需要恒定的时间（请参阅大 O 表示法）。这与许多其他哈希表算法形成对比，后者在查找时间上可能没有恒定的最坏情况限制。

我认为这符合您的碰撞和性能标准。看来权衡是这种类型的哈希表只能填满 49%。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-04-17T03:32:23.723

这是自己实现它的简单方法：http: [//www.devcodenote.com/2015/04/collision-free-string-hashing.html](http://www.devcodenote.com/2015/04/collision-free-string-hashing.html)

这是该帖子的一个片段：

如果说我们有一个大写英文字母的字符集，那么字符集的长度是 26，其中 A 可以用数字 0 表示，B 可以用数字 1 表示，C 可以用数字 2 表示，依此类推，直到 Z 用数字表示25\. 现在，每当我们想将此字符集的字符串映射到唯一数字时，我们执行与二进制格式相同的转换

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-03-08T20:57:44.493

“Murmurhash”在性能和碰撞方面都相当不错。

“softwareengineering.stackexchange”中提到的线程进行了一些测试，并且 Murmur 获胜。

我将我自己的 MurmurHash 2 的 C# 移植到 .NET 并在 466k 英文单词列表上对其进行了测试，得到了 22 次冲突。

结果和实现在这里：[https](https://github.com/jitbit/MurmurHash.net) ://github.com/jitbit/MurmurHash.net （免责声明，我参与了这个开源项目！）

# nhibernate - 在 nhibernate 中按集合计数排序

> ID：251351
> 
> 赞同：2
> 
> 时间：2008-10-30T19:06:33.533
> 
> 标签：nhibernate, collections, sql-order-by

有没有办法通过一个集合的属性计数来排序对象列表？

为了论证，假设我有一个问题对象，它有一个问题名称属性，一个属性是答案对象的集合，另一个属性是用户对象的集合。用户通过问题表上的外键加入问题表，答案与中间连接表连接。

如果我想让 nhibernate 获得“问题”对象的列表，我可以按 Question.Answers.Count 排序吗？

我已经使用 HQL 尝试了文档的示例：

```
 List<Question> list = nhelper.NHibernateSession
        .CreateQuery("Select q from Question q left join q.Answers a group by q,a order by count(a)")
        .List<Question>(); 
```

但我明白了

```
"column Question.Name is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause" 
```

我尝试将所有属性添加到按列表分组，但它不起作用。然后发生的事情是外键 userId 导致与上述相同的错误，但我无法将其包含在组中，因为 nhibernate 将其列为

```
Question.Users.UserId 
```

如果包含它并不能解决它。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-30T19:28:17.890

我遇到了这个问题，我使用 Linq 来解决它。

```
 var sort = from n in c
                       orderby q.Answers.Count
                       select n; 
```

我相信这就是语法，如果有人可以验证那会很棒，我没有过多地使用 LINQ。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T15:54:45.227

我不能使用 linq。

我解决它的方法（你可能会认为它是驴）是在数据库上创建一个计算列，使用 UDF 计算计数。然后我将休眠映射中的列标记为 update="false" 和 insert="false"。

我现在可以像往常一样按这个新列排序我的查询。它给了我额外的好处，即能够在我的应用程序中需要它的地方绑定这个值。

它似乎表现不错，希望它不会花费我太多的表现。

# asp.net-mvc - 如何在 ASP.NET MVC 中为具有多个字段的视图实现“创建”控制器操作

> ID：251356
> 
> 赞同：2
> 
> 时间：2008-10-30T19:07:25.017
> 
> 标签：asp.net-mvc, parameters, controller

我是 ASP.NET MVC 的新手，所以这可能是一个愚蠢的问题。

我有一个包含许多参数的帐户对象。我想出了一个策略，将其分解为一个类似“向导”的界面，引导用户收集所需的字段以创建初始业务对象。然后它将逐步浏览页面以收集其他可选参数。这样，用户就不会面对一个必须输入 30 项内容的页面（我可能夸大了这个数字，但你明白了）。

尽管如此，第一页将有 10-12 项用户需要填写，然后我才能填写伴随成功注册的 2-3 个业务对象的所有必填字段。基本上，一个新用户需要同时获得一个帐户和注册一个事件，因此项目的数量。

在 ASP.NET MVC 中，我的所有表单参数似乎都映射到控制器方法中的方法参数。知道具有大量参数的方法被认为是应该重构的*代码异味*，我想知道是否有不同的方法来实现这一点，或者我是否坚持使用具有一对一的控制器方法表单参数和方法参数之间的映射。

我在 Google 搜索中遗漏了一个众所周知的模式来解决这个问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T19:11:04.383

看看 Scott Gu 关于[表单发布场景](http://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx)的帖子。特别是您想查看模型活页夹。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T21:59:52.157

总是有老...

```
Request.Form("key"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T00:45:36.987

同上 joelc：模型粘合剂。他的链接指向很好。

# java - 是否可以使用 EJB 升级数据库模式？

> ID：251359
> 
> 赞同：0
> 
> 时间：2008-10-30T19:07:59.913
> 
> 标签：java, ejb

假设我有一个 EJB 应用程序，它定义了一些实体和它们之间的关系。我认为可以从实体轻松创建数据库模式。所以现在应用程序可以工作，但一段时间后需要改变一些关系，例如一对一需要变成一对多，我可以升级我的数据库来这样做而不丢失旧数据吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T15:54:50.240

听起来您让容器从您的实体中自动生成模式，这样您就不必费力地创建自己的 ORM（为什么不呢？）如果是这样，Apache 项目中有一个名为 DdlUtils 的漂亮工具你可能会觉得有用。

首先备份旧数据库，然后重新部署更新后的应用程序以使用新架构生成一个空数据库。使用 DdlUtils，您可以连接到两个数据库并让它生成将旧数据库迁移到新模式所需的 SQL，从而保留您的数据。

如果您只是添加或删除表或列，它就像一个魅力。我不知道当您执行更改列名之类的操作时效果如何。在这种情况下，您可能需要手动编辑 sql。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T19:53:44.340

如果使用 Hibernate 作为 JPA 实现，您可以传递属性 hibernate.hbm2ddl.auto。如果您手动更改架构，您应该考虑将其设置为“验证”。您也可以尝试“更新”，它应该处理简单的东西而无需手动更改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T21:56:54.173

当然可以！您必须做什么取决于许多不同的因素：您使用哪种 ORM？哪个 EJB 容器？哪个关系型数据库？

通常适用以下步骤：

1.  停止应用程序
2.  备份您的数据库
3.  编辑您的数据库架构
4.  取消部署应用程序
5.  使应用程序适应您的新模式。不要忘记编辑您的 ORM 配置！
6.  重新部署应用程序
7.  重新启动应用程序

要获得更详细（和有帮助）的答案，您必须向我们提供有关当前情况、您想要实现的目标以及您将要改变的内容的更多详细信息。

# deployment - JSF 和 SunOne Webserver 6.1

> ID：251377
> 
> 赞同：0
> 
> 时间：2008-10-30T19:15:10.413
> 
> 标签：deployment, jsf, webserver, sunone

有人知道在部署到 SunOne 6.1 SP2 Webserver 时最适合使用哪个 JSF 版本吗？更重要的是我在哪里可以找到这类信息？

谢谢， 阿莱霍

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-08T14:20:10.763

如果您打算使用 Sun ONE Server 6，请注意您必须使用 JSF 1.1 而不是 JSF 1.2（最新版本）。JSF 1.1 需要 java 1.3 或更高版本、JSP 1.2、JSTL 1.0 和 Java Servlet 2.3 实现。此外，如果您使用的是 RichFaces，请记住您只能使用 Richfaces 3.1.5，因为这需要 JSF 1.1。

# c# - 数据绑定相对于手动查询/添加到控件的好处

> ID：251379
> 
> 赞同：4
> 
> 时间：2008-10-30T19:15:30.740
> 
> 标签：c#, .net, sql-server, model-view-controller, data-binding

我成为 C# 程序员总共大约 2 年，专业的时间超过 1 年。我在一家公司担任开发人员，开发在 .NET 2 之前开始的应用程序。我的问题是：

直接使用来自 sql 查询的数据绑定来控制查询和手动将项目添加到控件有什么好处？这种方法通常被认为更干净，在部署方面更简单吗？是否仍然存在手动添加会对数据的显示/值进行更细粒度的控制的情况？

我之所以问，是因为我被分配了一些错误，这些错误处理一些根据查询结果填充自己的控件，并且希望清理不必要的逻辑并将其推送到库而不是我来处理。

注意：我们使用的是 .NET 2.0

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T19:35:15.020

我个人发现使用

```
control.DataSource = YourSource;
control.DataBind(); 
```

过程更容易，您不必进行迭代，并且总体上减少了LOC。

如果使用 DropDownLists 和其他控件，您很可能还会设置 DataValueField 和 DataTextField 属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T19:41:10.813

数据绑定更容易设置，总体上更不容易出错，显着降低 LOC（如 Mitchel Sellers 所说），并且除了一些小故障之外，工作相当可靠。

根据我的经验，如果您需要为数据绑定控件指定确切的更新顺序或时间，您实际上只需要完全手动控制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-23T06:02:00.823

信息连接的设置要简单得多，整体问题主题更少，大大降低了 LOC，并且除了一些小错误之外，将很容易工作。根据我的经验，如果您需要为某些句柄的详细信息指定实际的更新顺序或时间，您实际上只需要完全的指南控制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T20:14:43.833

如果您有复杂的输入场景，手动绑定会很有用。使用数据绑定输入控件，您会发现只有当数据到达数据库并引发异常（日期/时间格式错误、整数超出正确范围等）时，您才知道有错误数据。

您显然可以通过数据控件上的各种验证/预提交事件来处理这个问题，但是手动验证您的输入并在您知道它是正确的时候发布它会更容易（并且更明显可读）。

这是我能想到的唯一原因，它只适用于输入。如果您处于只读场景中，那么数据绑定是轻而易举的事。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-06T09:01:15.507

我的经历与我以前在这里的海报完全相反。[这篇博文](http://aaronfeng.blogspot.com/2006/05/databinding-is-evil.html)（日期为 2006 年）总结了我对数据绑定的感受。

# c# - 设计问题 - 控制阵列

> ID：251382
> 
> 赞同：2
> 
> 时间：2008-10-30T19:16:10.147
> 
> 标签：c#, asp.net, .net-3.5, controls

好的，我知道该怎么做，但我想知道这是否是最好的方法。

我有一个名为“主题”的表，其中包含主题列表（obv）。我有一个包含大约 20 (+/-10) 个复选框的页面，其中包含用户可以订阅的所有不同主题。我认为最好的方法是制作一个复选框控件数组并在页面加载时填充它。

问题是复选框的排列方式是独一无二的，我应该将它们放在页面上，然后在加载时动态填充它们吗？这是最好的方法吗？我对控制数组不太熟悉。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T19:25:31.797

定义“我应该将它们放在页面上”的含义。

您是说将它们拖放到 aspx 页面上吗？如果你这样做了，你必须复制每一个——一个由页面创建，第二个由你创建，替换第一组。

复选框的数量如何变化（“20（+/- 10）”）？它们是来自数据库的选项吗？它们是固定的，但你只是不知道有多少？

ControlCollection 的一个有趣的方面是一个控件一次只能在一个中。如果您要尝试：

```
 ControlCollection cool = new ControlCollection ();
 coll.Add(Page.Controls[0]); 
```

它将被添加到 coll，但会自动从 Page.Controls 中删除。

已编辑：（回复评论）在您的代码隐藏中，手动创建复选框（自从我编写 WebForm 代码以来已经有一段时间了，所以我在这里讨论了一下），并将其放在一个数组中（一个数组不应该有我提到的关于 ControlCollection 的问题）

```
CheckBox[] boxes = new Checkbox[20];
for(int i =0; i< 20; ++i)
{
    boxes[i] = new CheckBox();
    // do stuff here
    Page.Controls.Add(boxes[i]);
} 
```

现在对于“在这里做事”，我们需要把它们放在正确的地方。有很多方法。我们可以`<table>`围绕它们建立一个；我们也可以`<asp:placeholder>`在 aspx 中添加控件；我们可以设置 CSS 样式的位置属性。

# silverlight - Silverlight 2 侧边栏小工具

> ID：251389
> 
> 赞同：8
> 
> 时间：2008-10-30T19:18:58.690
> 
> 标签：silverlight, windows-vista, windows-desktop-gadgets

如何在 Vista 侧边栏小工具中显示 Silverlight 2.0 应用程序？每当我使用标准 Silverlight 2 对象标签加载小工具时，我都会得到无silverlight 默认内容而不是应用程序。那么，让它运行的诀窍是什么？

这就是我目前尝试实现的方式：

```
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=Unicode" />
    <title>Silverlight Test</title>
    <style type="text/css">
      body {
        margin: 0;
        width: 130px;
      }
    </style>
  </head>

  <body>
  <object data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%">
            <param name="source" value="GTest.xap"/>            
            <param name="background" value="transparent" />
            <param name="minRuntimeVersion" value="2.0.31005.0" />
            <param name="autoUpgrade" value="true" />
            <param name="windowless" value="true" />
            Get Silverlight
        </object>
  </body>

  </html> 
```

我可以在 IE 中使用影响侧边栏的设置，以便允许 Silverlight 执行吗？

即使我可以让它在我的电脑上运行，那也是一个好的开始。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-31T17:22:20.667

为后代澄清：

将源值更改为“x-gadget://ClientBin/GTest.xap”就可以了。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-31T15:27:43.020

似乎在 Silverlight 2 的发布版本中，源参数发生了变化，并且必须是 URI - 请参阅 Silverlight 论坛中的此线程：http: [//silverlight.net/forums/p/30968/99824.aspx](http://silverlight.net/forums/p/30968/99824.aspx)

# c# - 为什么 lock(this) {...} 不好？

> ID：251391
> 
> 赞同：520
> 
> 时间：2008-10-30T19:19:21.763
> 
> 标签：c#, multithreading, locking

MSDN[文档](https://docs.microsoft.com/en-us/previous-versions/visualstudio/visual-studio-2012/c5kehkcz(v=vs.110))说

```
public class SomeObject
{
  public void SomeOperation()
  {
    lock(this)
    {
      //Access instance variables
    }
  }
} 
```

是“如果可以公开访问实例，则存在问题”。我想知道为什么？是因为锁的持有时间超过了必要的时间吗？还是有什么更阴险的原因？

* * *

## 回答 #1

> 赞同：535
> 
> 时间：2008-10-30T20:34:15.980

在 lock 语句中使用这种形式是不好的，`this`因为它通常无法控制还有谁可能会锁定该对象。

为了正确规划并行操作，应特别注意考虑可能的死锁情况，而拥有未知数量的锁入口点会阻碍这一点。例如，任何引用对象的人都可以在对象设计者/创建者不知道的情况下锁定它。这增加了多线程解决方案的复杂性，并可能影响其正确性。

私有字段通常是更好的选择，因为编译器会对它实施访问限制，并且它会封装锁定机制。使用`this`通过将部分锁定实现暴露给公众来违反封装。`this`除非已记录在案，否则您是否会获得锁定也不清楚。即使这样，依靠文档来防止问题也不是最理想的。

最后，还有一个常见的误解，即`lock(this)`实际上修改了作为参数传递的对象，并以某种方式使其只读或不可访问。这是**错误**的。作为参数传递给的对象`lock`仅用作**key**。如果该钥匙上已被锁住，则无法上锁；否则，允许锁定。

这就是为什么在`lock`语句中使用字符串作为键是不好的，因为它们是不可变的，并且可以在应用程序的各个部分共享/访问。您应该改用私有变量，`Object`实例会很好。

运行以下 C# 代码作为示例。

```
public class Person
{
    public int Age { get; set;  }
    public string Name { get; set; }

    public void LockThis()
    {
        lock (this)
        {
            System.Threading.Thread.Sleep(10000);
        }
    }
}

class Program
{
    static void Main(string[] args)
    {
        var nancy = new Person {Name = "Nancy Drew", Age = 15};
        var a = new Thread(nancy.LockThis);
        a.Start();
        var b = new Thread(Timewarp);
        b.Start(nancy);
        Thread.Sleep(10);
        var anotherNancy = new Person { Name = "Nancy Drew", Age = 50 };
        var c = new Thread(NameChange);
        c.Start(anotherNancy);
        a.Join();
        Console.ReadLine();
    }

    static void Timewarp(object subject)
    {
        var person = subject as Person;
        if (person == null) throw new ArgumentNullException("subject");
        // A lock does not make the object read-only.
        lock (person.Name)
        {
            while (person.Age <= 23)
            {
                // There will be a lock on 'person' due to the LockThis method running in another thread
                if (Monitor.TryEnter(person, 10) == false)
                {
                    Console.WriteLine("'this' person is locked!");
                }
                else Monitor.Exit(person);
                person.Age++;
                if(person.Age == 18)
                {
                    // Changing the 'person.Name' value doesn't change the lock...
                    person.Name = "Nancy Smith";
                }
                Console.WriteLine("{0} is {1} years old.", person.Name, person.Age);
            }
        }
    }

    static void NameChange(object subject)
    {
        var person = subject as Person;
        if (person == null) throw new ArgumentNullException("subject");
        // You should avoid locking on strings, since they are immutable.
        if (Monitor.TryEnter(person.Name, 30) == false)
        {
            Console.WriteLine("Failed to obtain lock on 50 year old Nancy, because Timewarp(object) locked on string \"Nancy Drew\".");
        }
        else Monitor.Exit(person.Name);

        if (Monitor.TryEnter("Nancy Drew", 30) == false)
        {
            Console.WriteLine("Failed to obtain lock using 'Nancy Drew' literal, locked by 'person.Name' since both are the same object thanks to inlining!");
        }
        else Monitor.Exit("Nancy Drew");
        if (Monitor.TryEnter(person.Name, 10000))
        {
            string oldName = person.Name;
            person.Name = "Nancy Callahan";
            Console.WriteLine("Name changed from '{0}' to '{1}'.", oldName, person.Name);
        }
        else Monitor.Exit(person.Name);
    }
} 
```

控制台输出

```
'this' person is locked!
Nancy Drew is 16 years old.
'this' person is locked!
Nancy Drew is 17 years old.
Failed to obtain lock on 50 year old Nancy, because Timewarp(object) locked on string "Nancy Drew".
'this' person is locked!
Nancy Smith is 18 years old.
'this' person is locked!
Nancy Smith is 19 years old.
'this' person is locked!
Nancy Smith is 20 years old.
Failed to obtain lock using 'Nancy Drew' literal, locked by 'person.Name' since both are the same object thanks to inlining!
'this' person is locked!
Nancy Smith is 21 years old.
'this' person is locked!
Nancy Smith is 22 years old.
'this' person is locked!
Nancy Smith is 23 years old.
'this' person is locked!
Nancy Smith is 24 years old.
Name changed from 'Nancy Drew' to 'Nancy Callahan'. 
```

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2008-10-30T19:22:27.653

因为如果人们可以获取您的对象实例（即：您的`this`）指针，那么他们也可以尝试锁定同一个对象。现在他们可能不知道你在`this`内部锁定，所以这可能会导致问题（可能是死锁）

除此之外，这也是不好的做法，因为它锁定“太多”

例如，您可能有一个成员变量`List<int>`，而您真正需要锁定的只是该成员变量。如果你在你的函数中锁定整个对象，那么调用这些函数的其他东西将被阻塞等待锁定。如果这些函数不需要访问成员列表，您将导致其他代码无缘无故地等待并减慢您的应用程序。

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2008-10-30T19:27:10.153

看看 MSDN 主题[线程同步（C# 编程指南）](http://msdn.microsoft.com/en-us/library/ms173179.aspx)

> 通常，最好避免锁定公共类型或应用程序无法控制的对象实例。例如，如果实例可以公开访问，lock(this) 可能会出现问题，因为您无法控制的代码也可能会锁定对象。**这可能会造成死锁情况，其中两个或多个线程等待释放同一个对象**. 锁定公共数据类型，而不是对象，可能会出于同样的原因导致问题。锁定文字字符串尤其危险，因为文字字符串是由公共语言运行时 (CLR) 进行的。这意味着整个程序的任何给定字符串文字都有一个实例，完全相同的对象代表所有正在运行的应用程序域中的所有线程中的文字。因此，在应用程序进程中的任何位置对具有相同内容的字符串进行锁定会锁定该字符串在应用程序中的所有实例。因此，最好锁定未实习的私有或受保护成员。一些类提供了专门用于锁定的成员。例如，Array 类型提供 SyncRoot。许多集合类型也提供 SyncRoot 成员。

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2012-05-09T06:08:41.027

我知道这是一个旧线程，但是因为人们仍然可以查找并依赖它，所以指出它`lock(typeof(SomeObject))`明显比`lock(this)`. 话说回来; 衷心感谢 Alan 指出这`lock(typeof(SomeObject))`是不好的做法。

的实例`System.Type`是最通用的粗粒度对象之一。至少，System.Type 的实例对于 AppDomain 来说是全局的，并且 .NET 可以在 AppDomain 中运行多个程序。这意味着如果两个完全不同的应用程序都试图在 System.Type 的同一个全局实例上获得同步锁，则它们可能会相互干扰，甚至造成死锁。

所以`lock(this)`不是特别健壮的形式，可能会导致问题，并且由于引用的所有原因应该总是引起人们的注意。然而，有广泛使用、相对受人尊敬且明显稳定的代码，例如 log4net，它广泛使用了 lock(this) 模式，尽管我个人更希望看到这种模式发生变化。

但`lock(typeof(SomeObject))`开辟了一个全新的和增强的蠕虫罐头。

物有所值。

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2008-10-30T19:25:54.650

...并且完全相同的论点也适用于此构造：

```
lock(typeof(SomeObject)) 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2013-06-12T09:35:08.260

想象一下，您的办公室有一位熟练的秘书，他是部门的共享资源。有时，您会因为有任务而冲向他们，只是希望您的另一位同事尚未认领他们。通常你只需要等待一小段时间。

因为关怀是分享，所以您的经理决定客户也可以直接使用秘书。但这有一个副作用：客户甚至可能在您为该客户工作时认领他们，并且您还需要他们执行部分任务。发生死锁，因为声明不再是层次结构。如果一开始就不允许客户认领，本可以完全避免这种情况。

`lock(this)`正如我们所见，这很糟糕。外部对象可能会锁定该对象，并且由于您无法控制谁在使用该类，因此任何人都可以锁定它......这就是上面描述的确切示例。同样，解决方案是限制对象的曝光。但是，如果您有一个`private`,`protected`或`internal`类，您*已经可以控制谁锁定了您的 object*，因为您确定您自己编写了代码。所以这里的信息是：不要将其公开为`public`. 此外，确保在类似场景中使用锁可以避免死锁。

与此完全相反的是锁定在整个应用程序域中共享的资源——最坏的情况。这就像把你的秘书放在外面，让外面的每个人都可以认领他们。结果是彻底的混乱——或者就源代码而言：这是一个坏主意；扔掉它并重新开始。那么我们该怎么做呢？

正如这里大多数人指出的那样，类型在应用程序域中共享。但是我们可以使用更好的东西：字符串。原因是字符串*是池化的*。换句话说：如果您在应用程序域中有两个具有相同内容的字符串，则它们有可能具有完全相同的指针。由于指针用作锁定键，因此您基本上得到的是“准备未定义行为”的同义词。

同样，您不应锁定 WCF 对象、HttpContext.Current、Thread.Current、Singletons（通常）等。避免这一切的最简单方法是什么？`private [static] object myLock = new object();`

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-03-23T00:40:57.300

如果锁定*共享资源*，锁定*this*指针可能会很*糟糕*。共享资源可以是静态变量或计算机上的文件——即在类的所有用户之间共享的东西。原因是每次实例化您的类时，this 指针都会包含对内存中某个位置的不同引用。因此，在一个类的一个实例中锁定*this*与在另一个类实例中锁定*this*是不同的。

 ***查看此代码以了解我的意思。将以下代码添加到控制台应用程序的主程序中：

```
 static void Main(string[] args)
    {
         TestThreading();
         Console.ReadLine();
    }

    public static void TestThreading()
    {
        Random rand = new Random();
        Thread[] threads = new Thread[10];
        TestLock.balance = 100000;
        for (int i = 0; i < 10; i++)
        {
            TestLock tl = new TestLock();
            Thread t = new Thread(new ThreadStart(tl.WithdrawAmount));
            threads[i] = t;
        }
        for (int i = 0; i < 10; i++)
        {
            threads[i].Start();
        }
        Console.Read();
    } 
```

创建一个新类，如下所示。

```
 class TestLock
{
    public static int balance { get; set; }
    public static readonly Object myLock = new Object();

    public void Withdraw(int amount)
    {
      // Try both locks to see what I mean
      //             lock (this)
       lock (myLock)
        {
            Random rand = new Random();
            if (balance >= amount)
            {
                Console.WriteLine("Balance before Withdrawal :  " + balance);
                Console.WriteLine("Withdraw        : -" + amount);
                balance = balance - amount;
                Console.WriteLine("Balance after Withdrawal  :  " + balance);
            }
            else
            {
                Console.WriteLine("Can't process your transaction, current balance is :  " + balance + " and you tried to withdraw " + amount);
            }
        }

    }
    public void WithdrawAmount()
    {
        Random rand = new Random();
        Withdraw(rand.Next(1, 100) * 100);
    }
} 
```

这是锁定*此*的程序的运行。

```
 Balance before Withdrawal :  100000
    Withdraw        : -5600
    Balance after Withdrawal  :  94400
    Balance before Withdrawal :  100000
    Balance before Withdrawal :  100000
    Withdraw        : -5600
    Balance after Withdrawal  :  88800
    Withdraw        : -5600
    Balance after Withdrawal  :  83200
    Balance before Withdrawal :  83200
    Withdraw        : -9100
    Balance after Withdrawal  :  74100
    Balance before Withdrawal :  74100
    Withdraw        : -9100
    Balance before Withdrawal :  74100
    Withdraw        : -9100
    Balance after Withdrawal  :  55900
    Balance after Withdrawal  :  65000
    Balance before Withdrawal :  55900
    Withdraw        : -9100
    Balance after Withdrawal  :  46800
    Balance before Withdrawal :  46800
    Withdraw        : -2800
    Balance after Withdrawal  :  44000
    Balance before Withdrawal :  44000
    Withdraw        : -2800
    Balance after Withdrawal  :  41200
    Balance before Withdrawal :  44000
    Withdraw        : -2800
    Balance after Withdrawal  :  38400 
```

这是在*myLock*上锁定程序的运行。

```
Balance before Withdrawal :  100000
Withdraw        : -6600
Balance after Withdrawal  :  93400
Balance before Withdrawal :  93400
Withdraw        : -6600
Balance after Withdrawal  :  86800
Balance before Withdrawal :  86800
Withdraw        : -200
Balance after Withdrawal  :  86600
Balance before Withdrawal :  86600
Withdraw        : -8500
Balance after Withdrawal  :  78100
Balance before Withdrawal :  78100
Withdraw        : -8500
Balance after Withdrawal  :  69600
Balance before Withdrawal :  69600
Withdraw        : -8500
Balance after Withdrawal  :  61100
Balance before Withdrawal :  61100
Withdraw        : -2200
Balance after Withdrawal  :  58900
Balance before Withdrawal :  58900
Withdraw        : -2200
Balance after Withdrawal  :  56700
Balance before Withdrawal :  56700
Withdraw        : -2200
Balance after Withdrawal  :  54500
Balance before Withdrawal :  54500
Withdraw        : -500
Balance after Withdrawal  :  54000 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-08-14T23:22:49.367

有一篇非常好的文章[http://bytes.com/topic/c-sharp/answers/249277-dont-lock-type-objects](http://bytes.com/topic/c-sharp/answers/249277-dont-lock-type-objects)由 Microsoft® .NE​​T 运行时的性能架构师 Rico Mariani撰写

摘抄：

> 这里的基本问题是您不拥有类型对象，并且您不知道还有谁可以访问它。一般来说，依赖锁定一个不是您创建并且不知道还有谁可能正在访问的对象是一个非常糟糕的主意。这样做会导致僵局。最安全的方法是只锁定私有对象。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-30T19:59:31.323

这里也有一些很好的讨论：[这是互斥锁的正确使用吗？](https://stackoverflow.com/questions/46909/is-this-the-proper-use-of-a-mutex)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-30T19:30:40.570

因为任何可以看到您的类实例的代码块也可以锁定该引用。您想隐藏（封装）您的锁定对象，以便只有需要引用它的代码才能引用它。关键字 this 引用当前类实例，因此任何数量的事物都可以引用它并可以使用它来进行线程同步。

需要明确的是，这很糟糕，因为其他一些代码块可能会使用类实例来锁定，并且可能会阻止您的代码获得及时的锁定或可能产生其他线程同步问题。最好的情况：没有其他方法使用对您的类的引用来锁定。中间情况：某些东西使用对您的类的引用来执行锁定，它会导致性能问题。最坏的情况：某些东西使用你的类的引用来做锁，它会导致非常糟糕、非常微妙、非常难以调试的问题。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-03-26T10:59:01.050

对不起，伙计们，但我不同意锁定它可能会导致死锁的论点。您混淆了两件事：死锁和饥饿。

*   您无法在不中断其中一个线程的情况下取消死锁，因此在陷入死锁后您无法退出
*   在其中一个线程完成其工作后，饥饿将自动结束

[这](http://imageshack.us/photo/my-images/403/threading.png/)是一张说明差异的图片。

**结论**如果线程饥饿对您来说不是问题，您
仍然可以安全地使用。`lock(this)`您仍然必须记住，当正在使用饥饿线程的线程`lock(this)`以锁定对象的锁结束时，它将最终以永恒的饥饿结束；）

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-06-10T20:09:16.240

这是一些更易于遵循的示例代码（IMO）：（将在**LinqPad**中工作，参考以下命名空间：System.Net 和 System.Threading.Tasks）

需要记住的是，lock(x) 基本上是语法糖，它的作用是使用 Monitor.Enter，然后使用 try、catch、finally 块来调用 Monitor.Exit。请参阅：[https](https://docs.microsoft.com/en-us/dotnet/api/system.threading.monitor.enter) ://docs.microsoft.com/en-us/dotnet/api/system.threading.monitor.enter （备注部分）

> 或使用 C# lock 语句（Visual Basic 中的 SyncLock 语句），它将 Enter 和 Exit 方法包装在 try...finally 块中。

```
void Main()
{
    //demonstrates why locking on THIS is BADD! (you should never lock on something that is publicly accessible)
    ClassTest test = new ClassTest();
    lock(test) //locking on the instance of ClassTest
    {
        Console.WriteLine($"CurrentThread {Thread.CurrentThread.ManagedThreadId}");
        Parallel.Invoke(new Action[]
        {
            () => {
                //this is there to just use up the current main thread. 
                Console.WriteLine($"CurrentThread {Thread.CurrentThread.ManagedThreadId}");
                },
            //none of these will enter the lock section.
            () => test.DoWorkUsingThisLock(1),//this will dead lock as lock(x) uses Monitor.Enter
            () => test.DoWorkUsingMonitor(2), //this will not dead lock as it uses Montory.TryEnter
        });
    }
}

public class ClassTest
{
    public void DoWorkUsingThisLock(int i)
    {
        Console.WriteLine($"Start ClassTest.DoWorkUsingThisLock {i} CurrentThread {Thread.CurrentThread.ManagedThreadId}");
        lock(this) //this can be bad if someone has locked on this already, as it will cause it to be deadlocked!
        {
            Console.WriteLine($"Running: ClassTest.DoWorkUsingThisLock {i} CurrentThread {Thread.CurrentThread.ManagedThreadId}");
            Thread.Sleep(1000);
        }
        Console.WriteLine($"End ClassTest.DoWorkUsingThisLock Done {i}  CurrentThread {Thread.CurrentThread.ManagedThreadId}");
    }

    public void DoWorkUsingMonitor(int i)
    {
        Console.WriteLine($"Start ClassTest.DoWorkUsingMonitor {i} CurrentThread {Thread.CurrentThread.ManagedThreadId}");
        if (Monitor.TryEnter(this))
        {
            Console.WriteLine($"Running: ClassTest.DoWorkUsingMonitor {i} CurrentThread {Thread.CurrentThread.ManagedThreadId}");
            Thread.Sleep(1000);
            Monitor.Exit(this);
        }
        else
        {
            Console.WriteLine($"Skipped lock section!  {i} CurrentThread {Thread.CurrentThread.ManagedThreadId}");
        }

        Console.WriteLine($"End ClassTest.DoWorkUsingMonitor Done {i} CurrentThread {Thread.CurrentThread.ManagedThreadId}");
        Console.WriteLine();
    }
} 
```

**输出**

```
CurrentThread 15
CurrentThread 15
Start ClassTest.DoWorkUsingMonitor 2 CurrentThread 13
Start ClassTest.DoWorkUsingThisLock 1 CurrentThread 12
Skipped lock section!  2 CurrentThread 13
End ClassTest.DoWorkUsingMonitor Done 2 CurrentThread 13 
```

请注意，线程#12 永远不会因为它的死锁而结束。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-12-03T18:47:56.883

请参考以下链接，它解释了为什么 lock (this) 不是一个好主意。

[https://docs.microsoft.com/en-us/dotnet/standard/threading/managed-threading-best-practices](https://docs.microsoft.com/en-us/dotnet/standard/threading/managed-threading-best-practices)

所以解决方法是在类中添加一个私有对象，例如lockObject，并将代码区域放在lock语句里面，如下图：

```
lock (lockObject)
{
...
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-07-28T01:40:34.670

这是一个更简单的说明（取自[这里的问题 34](https://gridwizard.wordpress.com/2014/06/17/technical-interviews-net-developers)）为什么 lock(this) 不好并且当您的类的使用者也尝试锁定对象时可能导致死锁。下面，三个线程中只有一个可以继续，另外两个处于死锁状态。

> ```
> class SomeClass
> {
>     public void SomeMethod(int id)
>     {
>         **lock(this)**
>         {
>             while(true)
>             {
>                 Console.WriteLine("SomeClass.SomeMethod #" + id);
>             }
>         }
>     }
> }
> 
> class Program
> {
>     static void Main(string[] args)
>     {
>         SomeClass o = new SomeClass();
> 
>         lock(o)
>         {
>             for (int threadId = 0; threadId < 3; threadId++)
>             {
>                 Thread t = new Thread(() => {
>                     o.SomeMethod(threadId);
>                         });
>                 t.Start();
>             }
> 
>             Console.WriteLine();
>         } 
> ```

为了解决这个问题，这个人使用了 Thread.TryMonitor（有超时）而不是锁：

> ```
>  Monitor.TryEnter(temp, millisecondsTimeout, ref lockWasTaken);
>             if (lockWasTaken)
>             {
>                 doAction();
>             }
>             else
>             {
>                 throw new Exception("Could not get lock");
>             } 
> ```

[https://blogs.appbeat.io/post/c-how-to-lock-without-deadlocks](https://blogs.appbeat.io/post/c-how-to-lock-without-deadlocks)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-02-08T03:07:10.303

您可以建立一个规则，说明一个类可以具有锁定“this”或类中的代码实例化的任何对象的代码。因此，如果不遵循模式，这只是一个问题。

如果您想保护自己免受不遵循此模式的代码的影响，那么接受的答案是正确的。但如果遵循模式，这不是问题。

lock(this) 的优点是效率。如果您有一个包含单个值的简单“值对象”怎么办。它只是一个包装器，它被实例化了数百万次。通过要求创建一个仅用于锁定的私有同步对象，您基本上使对象的大小翻了一番，分配的数量也翻了一番。当性能很重要时，这是一个优势。

当您不关心分配数量或内存占用时，由于其他答案中指出的原因，最好避免使用 lock(this) 。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2012-10-31T22:01:42.143

如果可以公开访问该实例，则会出现问题，因为可能有其他请求可能正在使用相同的对象实例。最好使用私有/静态变量。

# asp.net - 在 ASP.NET 中验证查询字符串

> ID：251395
> 
> 赞同：3
> 
> 时间：2008-10-30T19:21:16.890
> 
> 标签：asp.net, validation, query-string

是否有可以在我当前的 ASP.NET 应用程序中使用的库来验证 queryStrings？

编辑〜使用正则表达式查找模式，如字符串，仅，仅数字，长度为 x 的字符串，...等

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T19:24:35.543

不了解库，但您可以使用它来检查查询字符串是否存在：

```
if (!String.IsNullOrEmpty(Request.Querystring["foo"]))
{
   // check further
}
else
{
   // not there, do something else
} 
```

如果要使用正则表达式进一步验证，可以创建一个接受字符串并返回布尔值的类。

```
public static Boolean IsValid(String s)
{
    const String sRegEx = @"regex here";

    Regex oRegEx = new Regex(sRegEx , RegexOptions.IgnoreCase | RegexOptions.Multiline | RegexOptions.IgnorePatternWhitespace | RegexOptions.Compiled);
    MatchCollection oMatches = oRegEx.Matches(s);

    return (oMatches.Count > 0) ? true : false;
} 
```

这是一个很好的免费程序，可以帮助您构建正则表达式：[Expresso](http://www.ultrapico.com/expresso.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T20:11:13.530

这种事情的最佳方法可能是使用正则表达式来检查您正在寻找的任何条件。

在实际场景中将验证与演示分开会很好，但这只是为了举例：

```
 if (!string.IsNullOrEmpty(Request.QueryString["Variable"]))
    {
        string s = Request.QueryString["Variable"];

        Regex regularExpression = new Regex("Put your regex here");

        if (regularExpression.IsMatch(s))
        {
            // Do what you want.
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T19:29:07.607

您的意思是要询问将查询字符串分成几个部分吗？ASP.Net 已经为您做到了。您可以通过 Request.QueryString 集合访问各个参数。

对于查询字符串：?fruit=apple&socks=white

Request.QueryString["fruit"] 会给你“apple”，Request.QueryString["socks"] 会给你“white”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T19:38:29.197

如果您谈论的是在请求进入时验证查询字符串，.NET Framework 已经这样做了。Page 有一个名为 ValidateRequest 的属性，默认情况下为 true，查询字符串中的任何无效都会导致错误（在您的代码中第一次访问查询字符串时），而您无需执行任何操作。

如果您正在谈论验证作为数据或其他内容的查询字符串，那么[这篇 MSDN Mag 文章](http://msdn.microsoft.com/en-us/magazine/cc163462.aspx)可能会对您有所帮助。

编辑：我看到您在询问有关数据验证的更多信息。您应该在我上面链接的 MSDN 文章中找到一些好东西。

# java - 在 Axis Web 服务中使用来自 Java 的复杂数据类型

> ID：251396
> 
> 赞同：1
> 
> 时间：2008-10-30T19:21:42.037
> 
> 标签：java, web-services, wsdl, axis

我目前正在开发一个处理 SOAP Web 服务的 Java 应用程序。

问题在于我解析了 WSDL [Apache Axis 的**Parser**对象为我完成了它]，然后我创建了调用。

当我尝试调用它时，我必须传递一个 Object[] 来分配参数 [取自 WSDL 的操作]。正常的操作很容易，但是当我有自定义数据类型时，我无法让它为我填写。我尝试传递 Object[]{ new Object { }}，但它分配了第一个字段。我不能传递它已经处理过的，因为它把'< >'更改为'--lt --gt'，而服务器无法识别它'。

这是 WSDL 的一个片段。

> ```
>  <s:element name="FERecuperaQTYRequest">
>     <s:complexType>
>       <s:sequence>
>         <s:element minOccurs="0" maxOccurs="1" name="argAuth" type="tns:FEAuthRequest" />
>       </s:sequence>
>     </s:complexType>
>   </s:element>
>   <s:complexType name="FEAuthRequest">
>     <s:sequence>
>       <s:element minOccurs="0" maxOccurs="1" name="Token" type="s:string" />
>       <s:element minOccurs="0" maxOccurs="1" name="Sign" type="s:string" />
>       <s:element minOccurs="1" maxOccurs="1" name="cuit" type="s:long" />
>     </s:sequence>
>   </s:complexType> 
> ```

这就是麻烦的Java Fragment

```
 QTY = (String) call.invoke (
                new Object[]{
                     new Object[]{
                            tokenConexion.getToken (),
                            tokenConexion.getSign (),
                            tokenConexion.getCUIT ()
                                 }
                            }); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T19:33:08.490

您是否考虑过使用诸如 Spring 的代理功能之类的东西？你在 spring 配置文件中告诉它一些关于 web 服务的信息，你所有的客户端代码必须处理的是你创建的接口——它甚至不必知道另一端有 web 服务！

示例 Spring 配置：

```
<bean id="myService" class="org.springframework.remoting.jaxrpc.JaxRpcPortProxyFactoryBean">
    <property name="serviceFactoryClass" value="org.apache.axis.client.ServiceFactory"/>
    <property name="wsdlDocumentUrl" value="classpath://META-INF/myService.wsdl"/>
    <property name="namespaceUri" value="http://com/myService"/>
    <property name="endpointAddress" value="http://server/MyService"/>
    <property name="serviceName" value="MyService"/>
    <property name="portName" value="MyService"/>
    <property name="serviceInterface" value="com.IMyService"/>
    <property name="lookupServiceOnStartup" value="false"/>
</bean>
<bean id="myClient" class="com.MyServiceClient">
    <property name="myService" ref="myService"/>
</bean> 
```

爪哇：

```
public interface IMyService {
    Foo getFoo();
}

public class MyServiceClient {
    private IMyService myService;
    public void setMyService(IMyService myService) {
        this.myService = myService;
    }

    public void DoStuff() {
        Foo foo = myService.getFoo();
        ...
    }
} 
```

对于自定义对象，您可能需要继承 JaxRpcPortProxyFactoryBean：

```
public class MyServiceFactoryBean extends JaxRpcPortProxyFactoryBean {
protected void postProcessJaxRpcService(Service service) {
    TypeMappingRegistry registry = service.getTypeMappingRegistry();
    TypeMapping mapping = registry.createTypeMapping();
            QName qName = new QName("http://com/myService", "Foo");
    mapping.register(Foo.class, qName,
            new BeanSerializerFactory(Foo.class, qName),
            new BeanDeserializerFactory(Foo.class, qName));
    }
} 
```

我喜欢这一点的是，*不应该*关心服务实现的代码*不会*。测试变得轻而易举，并且您的课程的凝聚力*要*好得多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T22:26:20.310

我们尝试使用复杂的对象和轴。不！我们在 Dotnet 能够从 WSDL 创建正确的对象方面遇到了很多问题。我们最终只使用了原语、字符串和数组。如果有人有使用复杂对象的好方法，我很想听听。

# .net - 是否存在任何实现 luac 功能的 .NET DLL？

> ID：251401
> 
> 赞同：2
> 
> 时间：2008-10-30T19:22:44.313
> 
> 标签：.net, dll, lua, luac

有谁知道封装 lua 5.1 编译器的任何 DLL（最好是 .net）？我正在开发一个 .net 项目，其中一部分需要编译 lua 脚本，我宁愿有一个可以发送脚本代码的 DLL，而不是将脚本发送到临时文件并运行 luac.exe。

编辑：我需要一个 .NET 库，它以输出标准 lua 字节码的方式实现 luac（不是编译到 CLR 的 lua 库）。编译 lua c 源代码不起作用，因为当我在 ac# 项目中包含对 dll 的引用时，Visual Studio 抱怨它不是一个有效的程序集。我的搜索到目前为止还没有找到任何东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T21:52:51.750

Lua 和 .Net 集成有 Lua.NET 项目：

[http://www.lua.inf.puc-rio.br/projects/luanet/](http://www.lua.inf.puc-rio.br/projects/luanet/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-21T21:04:52.933

您可以`luac`通过从[lua-users wiki](http://lua-users.org/wiki/LuaCompilerInLua)获取的以下命令在 Lua 中进行模拟：

```
lua -e 'io.write(string.dump(assert(loadfile())))' <sample.lua >sample.out 
```

因此，如果您打算在 C 中的 API 级别执行此操作（即使我知道您使用的是 .NET），它应该类似于

```
lua_dostring(L, "string.dump(assert(loadstring([==[YOUR CODE HERE]==])))");
size_t sz;
char *output = lua_tolstring(L, -1, &sz); 
```

然后只需将`sz`字符保存到您的输出文件中。

我意识到这是一个迟到的答案，但由于这里还没有一个，我想我会尝试一下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T20:00:11.133

luac 的所有代码都与 lua 一起分发......将其变成 DLL 将是微不足道的。

# javascript - 使用 {} 或 new Object() 在 JavaScript 中创建一个空对象？

> ID：251402
> 
> 赞同：404
> 
> 时间：2008-10-30T19:22:44.860
> 
> 标签：javascript, arrays, object, javascript-objects, new-operator

在 JavaScript 中创建空对象有**两种不同的方法：**

```
var objectA = {}
var objectB = new Object() 
```

脚本引擎处理它们的方式有什么不同吗？有什么理由使用其中一个吗？

同样，也可以使用不同的语法创建一个空数组：

```
var arrayA = []
var arrayB = new Array() 
```

* * *

## 回答 #1

> 赞同：494
> 
> 时间：2008-10-30T23:14:25.500

## 对象

使用没有任何好处`new Object();`- 而`{};`可以使您的代码更紧凑，更易读。

对于定义空对象，它们在技术上是相同的。语法更短、`{}`更整洁（更少 Java-ish），并允许您立即内联填充对象 - 如下所示：

```
var myObject = {
        title:  'Frog',
        url:    '/img/picture.jpg',
        width:  300,
        height: 200
      }; 
```

## 数组

`new Array();`对于数组，使用over几乎没有任何好处`[];`——只有一个小例外：

```
var emptyArray = new Array(100); 
```

创建一个 100 项长的数组，其中所有插槽都包含`undefined`- 这在某些情况下（例如`(new Array(9)).join('Na-Na ') + 'Batman!'`）可能很好/有用。

## 我的推荐

1.  永远不要使用`new Object();`——它比它笨重`{};`而且看起来很傻。
2.  始终使用`[];`- 除非您需要快速创建具有预定义长度的“空”数组。

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2011-04-14T14:59:17.530

是的，有区别，它们不一样。确实，您会得到相同的结果，但引擎对它们的工作方式不同。其中一个是对象字面量，另一个是构造函数，两种在 javascript 中创建对象的不同方式。

```
var objectA = {} //This is an object literal

var objectB = new Object() //This is the object constructor 
```

在 JS 中，一切都是对象，但你应该注意 new Object() 的以下内容：它可以接收一个参数，并且根据该参数，它将创建一个字符串、一个数字或只是一个空对象。

例如：`new Object(1)`, 将返回一个数字。`new Object("hello")`将返回一个字符串，这意味着对象构造函数可以根据参数将对象创建委托给其他构造函数，如字符串、数字等......当您管理动态数据时，记住这一点非常重要创建对象..

当您可以使用某种文字表示法时，许多作者建议不要使用对象构造函数，这样您可以确定您正在创建的内容是您期望在代码中包含的内容。

我建议您进一步阅读文字符号和javascript上的构造函数之间的差异，以找到更多详细信息。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-30T19:32:26.697

这些具有相同的最终结果，但我只想补充一点，使用文字语法可以帮助人们习惯 JSON 的语法（JavaScript 文字对象语法的字符串化子集），因此进入它可能是一个好习惯.

另一件事：如果您忘记使用`new`运算符，您可能会遇到细微的错误。因此，使用文字将帮助您避免该问题。

最终，这将取决于情况和偏好。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-30T19:45:35.530

```
var objectA = {} 
```

更快，根据我的经验，更常用，所以最好采用“标准”并节省一些打字。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-30T20:08:00.493

对象和数组字面量语法 {}/[] 是在 JavaScript 1.2 中引入的，因此在 4.0 之前的 Netscape Navigator 版本中不可用（并且会产生语法错误）。

我的手指仍然默认说 new Array()，但我是一个很老的人。值得庆幸的是，Netscape 3 并不是当今许多人不得不考虑的浏览器......

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-30T20:55:53.050

我相信在[这里](http://developer.yahoo.com/yui/theater/)`{}`的一个Javascript 视频中被推荐为一个很好的编码约定。对于伪经典继承是必需的。这种方式有助于提醒您，这不是一种经典的面向对象语言，而是一种原型语言。因此，您真正需要的唯一时间是使用构造函数时。例如：`new``var obj = {};``new`

```
var Mammal = function (name) {
  this.name = name;
};

Mammal.prototype.get_name = function () {
  return this.name;
}

Mammal.prototype.says = function() {
  return this.saying || '';
} 
```

然后像这样使用它：

```
var aMammal = new Mammal('Me warm-blooded');
var name = aMammal.get_name(); 
```

`{}`使用as 相反的另一个优点`new Object`是您可以使用它来执行 JSON 样式的对象文字。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2016-08-06T01:20:24.373

## 数组实例化性能

如果你想创建一个没有长度的数组：

**`var arr = [];`比`var arr = new Array();`**

如果你想创建一个具有一定长度的空数组：

**`var arr = new Array(x);`比`var arr = []; arr[x-1] = undefined`;快**

对于基准单击以下内容：[https ://jsfiddle.net/basickarl/ktbbry5b/](https://jsfiddle.net/basickarl/ktbbry5b/)

*但是我不知道两者的内存占用，我可以想象这`new Array()`会占用更多空间。*

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-30T19:23:30.707

这本质上是一样的。使用任何你觉得更方便的东西。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-07-09T04:03:33.440

**好的**，只有两种不同的方法可以做同样的事情！一个被调用`object literal`，另一个是函数`constructor`！

但请继续阅读，有几件事我想分享：

使用`{}`使您的代码更具可读性，同时不推荐创建实例`Object`或其他内置函数...

此外，Object 函数获取参数，因为它是一个函数，就像`Object(params)`......但是`{}`是在 JavaScript 中启动一个对象的纯粹方式......

使用对象字面量使您的代码看起来更干净，更易于其他开发人员阅读，并且符合 JavaScript 中的最佳实践...

虽然 Javascript 中的对象几乎可以是任何东西，`{}`但只指向 javascript 对象，为了测试它是如何工作的，请在您的 javascript 代码或控制台中执行以下操作：

```
var n = new Object(1); //Number {[[PrimitiveValue]]: 1} 
```

令人惊讶的是，它正在创建一个数字！

```
var a = new Object([1,2,3]); //[1, 2, 3] 
```

这是创建一个数组！

```
var s = new Object('alireza'); //String {0: "a", 1: "l", 2: "i", 3: "r", 4: "e", 5: "z", 6: "a", length: 7, [[PrimitiveValue]]: "alireza"} 
```

这个奇怪的结果`String`！

所以如果你正在创建一个对象，建议使用对象字面量，有一个标准的代码，避免像上面那样的任何代码事故，`{}`根据我的经验，性能方面的使用更好！

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2020-12-04T10:04:46.423

```
Var Obj = {}; 
```

这是最常用和最简单的方法。

使用

```
var Obj = new Obj() 
```

不是首选。

没有必要使用`new Object()`.

为了简单、可读性和执行速度，使用第一个（对象文字方法）。

# c++ - 你如何制作一个异构的 boost::map？

> ID：251403
> 
> 赞同：32
> 
> 时间：2008-10-30T19:23:10.537
> 
> 标签：c++, boost, map

我想要一个具有同构键类型但异构数据类型的映射。

我希望能够做类似（伪代码）的事情：

```
boost::map<std::string, magic_goes_here> m;
m.add<int>("a", 2);
m.add<std::string>("b", "black sheep");

int i = m.get<int>("a");
int j = m.get<int>("b"); // error! 
```

我可以有一个指向基类的指针作为数据类型，但宁愿没有。

我以前从未使用过 boost，但看过 fusion 库，但不知道我需要做什么。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-30T23:12:08.610

```
#include <map>
#include <string>
#include <iostream>
#include <boost/any.hpp>

int main()
{
    try
    {
        std::map<std::string, boost::any> m;
        m["a"]  = 2;
        m["b"]  = static_cast<char const *>("black sheep");

        int i = boost::any_cast<int>(m["a"]);
        std::cout << "I(" << i << ")\n";

        int j = boost::any_cast<int>(m["b"]); // throws exception
        std::cout << "J(" << j << ")\n";
    }
    catch(...)
    {
        std::cout << "Exception\n";
    }

} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-30T19:28:40.247

[如何构建不同类型对象的 <favorite container>？](http://www.parashift.com/c++-faq/heterogeneous-list.html)

> 你不能，但你可以很好地伪造它。在 C/C++ 中，所有数组都是同构的（即元素都是相同的类型）。但是，通过额外的间接层，您可以呈现出异构容器的外观（异构容器是其中包含的对象具有不同类型的容器）。
> 
> 异构容器有两种情况。
> 
> 第一种情况发生在您要存储在容器中的所有对象都是从公共基类公开派生的情况下。[...]
> 
> 第二种情况发生在对象类型不相交时——它们不共享一个公共基类。
> 这里的方法是使用句柄类。容器是句柄对象的容器（按值或按指针，您可以选择；按值更容易）。每个句柄对象都知道如何“保持”（即维护指向）您要放入容器中的对象之一。您可以使用具有几种不同类型指针的单个句柄类作为实例数据，也可以使用隐藏您希望包含的各种类型的句柄类层次结构（要求容器是句柄基类指针）。这种方法的缺点是，每次更改可以包含的类型集时，它都会打开句柄类进行维护。好处是您可以使用句柄类来封装内存管理和对象生命周期的大部分丑陋。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-30T19:28:48.607

会[boost::any](http://www.boost.org/doc/libs/1_36_0/doc/html/any/s02.html)对你有用吗？

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-31T00:04:10.533

谢谢大卫，这正是我所需要的。这是有效的解决方案。

```
#include <iostream>
using std::cout;
using std::endl;

#include <map>
#include <boost/any.hpp>

using boost::any_cast;
typedef std::map<std::string, boost::any> t_map;

int main(int argc, char **argv)
{

  t_map map;
  char *pc = "boo yeah!";

  map["a"] = 2.1;
  map["b"] = pc;

  cout << "map contents" << endl;
  cout << any_cast<double>(map["a"]) << endl;
  cout << any_cast<char*>(map["b"]) << endl;

  return 0;
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-30T20:22:43.553

如果您希望支持一组有限的类型，[Boost.Variant](http://www.boost.org/doc/libs/1_36_0/doc/html/variant.html)应该可以解决问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-05-14T14:00:23.860

boost any 肯定有效，但我认为使用 Int 键入 Technology 作为融合映射的关键类型是更好的解决方案。没有类型擦除，可能更快

# oracle - 从 Oracle 9i 中的嵌套查询中选择

> ID：251409
> 
> 赞同：1
> 
> 时间：2008-10-30T19:24:35.043
> 
> 标签：oracle, plsql

在 MS SQL 2005 或 T-SQL 中，您可以执行以下操作：

```
SELECT T.NAME, T.DATE 
  FROM (SELECT * FROM MyTable WHERE ....) AS T 
```

我未能在 Oracle 9i DB 上尝试类似的 SQL。在 MS SQL 中，嵌套 SQL 被视为动态创建并随后销毁的临时/动态视图。我怎样才能在 Oracle 中做类似的事情？我真的不想创建一个视图来做到这一点。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T19:26:47.393

我相信它会扼杀“as”。

```
SELECT T.NAME, T.DATE 
  FROM (SELECT * FROM MyTable WHERE ....)  T 
```

应该管用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T19:27:27.503

您唯一需要更改的是删除关键字“AS”。Oracle 仅将其用于列别名（例如 SELECT dummy AS some_name FROM dual），尽管即使那样您也不需要它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T21:27:21.737

如果您确实需要创建一个临时的物理结果集，那么您可以使用子查询因式分解子句来做到这一点：

```
with t as
(SELECT /*+ materliaze */ 
        *
 FROM   MyTable
 WHERE ....)
SELECT T.NAME, T.DATE 
FROM T
/ 
```

除了优化器对查询中的中间结果集的准确估计对于有效执行计划至关重要的特定情况外，通常不值得这样做，在这种情况下，可以使用动态采样来查看结果集的大小，或者在查询的其余部分中多次使用计算结果集。

您应该能够只删除 AS，如果这样做是安全的，Oracle 会在逻辑上将内联视图合并到主查询中。

# embedded - 嵌入式系统最糟糕的做法？

> ID：251413
> 
> 赞同：41
> 
> 时间：2008-10-30T19:26:14.463
> 
> 标签：embedded, anti-patterns

在开发嵌入式系统时，您认为应该遵循哪些“最差实践”？

我对不该做什么的一些想法是：

*   避免抽象硬件层，而是在整个代码中分散硬件访问。*   没有任何类型的仿真环境，只有实际的硬件可以执行/可爱。*   避免单元测试，可能是由于以上两点*   不以分层结构开发系统，因此较高层可能依赖于已调试和工作的较低层功能*   选择硬件而不考虑将使用它的软件和工具*   使用为易于调试而设计的硬件，例如无测试点、无调试 LED、无 JTAG 等。

    我敢肯定有很多关于不该做什么的好主意，让我们听听！

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-10-31T00:59:17.223

*   未初始化的异常向量（你知道，对于那些“永远不会到达”的异常向量）
*   跟我说：全局变量。尤其是在没有保护的情况下在 ISR 和任务（或前台循环）之间共享的那些。
*   没有在必要时使用“volatile”。
*   将 DisableInterrupts() 和 EnableInterrupts() 配对的例程。了解？不是*RestoreInterrupts()*，而是*ENABLE*。是的，嵌套。
*   测试时无需切换 GPIO。
*   船上没有测试点。
*   没有用于查看运行时系统状态的 LED 或串行端口。
*   无法测量 CPU 的繁忙/空闲程度。
*   除了最可怕的情况外，对所有情况都使用内联汇编。写一个快速标注。
*   使用 for (i = 0; i < 1000; i++) { } 来“延迟一点”。是的，那不会以一百种不同的方式咬你....
*   尽可能不使用 const 来保留 RAM 并减少启动时间（不复制/初始化变量）

我还有很多，但这应该让我们开始......

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-10-31T19:53:07.900

在我伤害自己之前有人阻止我。

顺便说一句，我意识到并非所有这些都严格特定于*嵌入式*开发，但我相信它们中的每一个在嵌入式世界中至少与现实世界一样重要。

*   在制定时间表时，请继续并假设一切都会在第一次工作。

*   无需示波器和/或逻辑分析仪即可启动电路板。特别是。范围，那永远没用。

*   设计时不要考虑电源。热量、效率、纹波对 ADC 读数和系统行为的影响、EMF 辐射、启动时间等问题并不重要。

*   无论您做什么，都不要使用复位控制器（5 美分 IC 类型），只需使用 RC 电路（希望其中耦合有大量高频交流噪声）

*   拥抱大爆炸！！！不要逐步开发小块并经常集成，傻瓜！！！只需与同事一起编写几个月的代码，然后在大型贸易展演示的前一天晚上将它们全部放在一起！

*   不要使用调试/跟踪语句检测代码。能见度很差。

*   在你的 ISR 中做很多事情。冒泡排序、数据库查询等......嘿，可能没有人会打扰你，你有发言权，好好享受吧，伙计！

*   忽略设计中的电路板布局。让自动布线器在那些匹配的阻抗走线和大电流、高频电源上发挥作用。嘿，你还有更重要的事情要操心，伙伴！！！

*   使用全新的、测试版的、未发布的、早期采用者的芯片，特别是如果它对安全至关重要（航空、医疗）或大批量（召回 100 万个单元很有趣）。当 4 核 300 MHz 7 级流水线芯片上有新的硅采样时，为什么还要去拉斯维加斯？

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-10-31T19:36:16.530

好的第 2 轮....还有一些：

*   不要使用看门狗定时器（尤其是内置的！）

*   当缩放整数数学就足够时使用浮点类型和例程

*   在没有保证时使用 RTOS

*   *真正*有意义时不要使用 RTOS

*   永远不要查看生成的汇编代码来了解幕后发生的事情

*   编写固件，使其无法在现场更新

*   不要记录你所做的任何假设

*   如果您在测试/调试时看到奇怪的东西，请忽略它，直到它再次发生；这可能不是什么重要的事情，比如掉电、错过的中断、堆栈损坏的迹象或其他一些短暂和间歇性的问题

*   在调整堆栈大小时，最好的理念是“从小处着手并不断增加，直到程序停止崩溃，然后我们可能就可以了”

*   不要利用像 Micrium 的 uC/Probe 这样的运行时分析工具（我相信还有其他工具）

*   在运行主应用程序之前不要包括硬件的开机自检 - 嘿，启动代码正在运行，什么可能不工作？

*   绝对不要在您不会实施的 POST（上图）中包含 RAM 测试

*   如果目标处理器有一个 MMU，尽管如此，不要使用那个可怕的 MMU！尤其是不要让它保护您免受对代码空间的写入、从数据空间的执行等...

*   如果您一直在测试、调试和集成一组特定的编译器选项（例如无/低优化），请务必在最终版本构建之前打开全面优化！！！！但只有在您不打算测试时才打开优化。我的意思是，您已经测试了几个月 - 会出什么问题？！？？！

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-30T19:34:32.853

初始化后的动态内存分配。系统启动并运行后，内存池应保持静态。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-30T19:53:42.427

*   跳过伐木设施。嵌入式系统很难调试，您需要大量的日志记录。
*   无法允许日志记录级别。许多系统中的一个会表现出奇怪的行为，您需要将该系统的日志记录的调试级别设置为更详细的级别。
*   不允许某种输出端口允许登录到例如控制台。
*   没有能力“单步执行”代码。
*   无法分析代码，因此您可以查看哪些位需要优化，例如在汇编程序中。
*   不开发某种“健全性测试”，因此您可以在加载后和发货前快速检查设备是否正常工作。
*   基于一些“本土”操作系统的设计

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-30T19:40:08.617

尝试在不访问您正在开发的实际硬件的情况下进行开发。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-22T21:37:28.580

在您的解决方案中使用多个处理器并确保它们具有相反的字节序。然后确保它们之间的接口是其中一个可以直接访问另一个内存。

是的，我之前已经对这种架构进行了编程。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-30T19:44:37.140

假设字节序将永远相同。

（将其扩展到寄存器的大小以及有关硬件规格的任何内容）

*（评论中的案例解释）。*

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-30T19:55:10.940

如果没有更多地定义“嵌入式编程”，那么就不可能说出什么是好的或坏的做法。

例如，在 CE 或 XPe 平台上，您可能使用的许多技术在 CE 或 XPe 平台上完全不适合使用狡猾的非标准方言“C”对 8 位微控制器进行编程。

在许多情况下，抽象是一种（过度）昂贵的奢侈品，因此“避免它”可能是好事而不是坏事。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-30T21:13:10.347

这里有几个：

*   不要设计一个您的开发人员、经理和客户都能理解的易于解释的架构。

*   嵌入式系统几乎总是对成本敏感的平台。不要计划硬件变得更慢（更便宜），也不要计划关键数据路径中的新功能。

*   大多数嵌入式系统是“无头的”（没有键盘或鼠标或任何其他 HID）。不要在你的日程安排中计划编写调试工具。并且不要资源至少一名开发人员来维护它们。

*   请务必低估获得提示所需的时间。这就是让核心 CPU 达到可以与您和您与它对话的程度所需的时间。

*   始终假设硬件子系统可以开箱即用，例如内存、时钟和电源。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-30T19:27:35.310

不：

*   留下没有指向任何地方的未使用的中断向量（毕竟，它们永远不会被触发，所以这有什么危害......），而不是让它们跳转到一个默认的未使用的中断处理程序，它会做一些有用的事情。

*   不熟悉您正在使用的处理器的细节，特别是如果您正在编写任何低级驱动程序。

*   选择闪存量最少的处理器系列版本，理由是您始终可以“稍后升级”，除非成本无法避免。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-08-10T08:51:59.223

*   假设微机按照数据表所说的做了/没有按照数据表的承诺做。
*   将看门狗服务程序置于高优先级定时中断中，这样无论发生什么其他事情，看门狗都不会失败。
*   使用在 Internet 上看到的任何代码，尤其是来自 Arduino/Pic 站点的代码。
*   假设从一个组件到另一个组件都有任何标准定义，例如 Tx/Rx（我们这里有一个 Sony 单元，上面有 2 个通信端口，一个 Tx/Rx 相对于另一个反转）。
*   认为客户会费心检查/测试任何东西，直到他们售出至少 100 个单位
*   假设该领域的任何其他参与者实际上都知道他们在做什么（我们有一份标准文档，上面写着“我们认为这是我们的旧协议所做的，但没有人真正记得”）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-03-07T03:47:40.743

一些额外的注意事项：

*   将硬件相关部件的开发和测试留到最后才发现硬件不能正常工作、不能按预期工作或有一些软件无法修复的缺陷（例如，不需要的非线性失真中断所有进一步的信号处理）。
*   简单地设计模拟-数字电路，而不考虑数字部分中发生的事情如何影响模拟部分（例如，串扰，导致从 ADC 读取错误数据）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-04T13:45:07.220

*   将您的固件模块编写为完全通用的，接受每个可能的参数作为变量，即使您上面的层**总是**使用相同的参数调用。

*   即使系统中有 DMA 引擎（为什么要打扰硬件），在代码中的任何地方都使用**memcpy 。**

*   设计一个复杂的分层固件架构，然后让模块直接访问更高级别模块拥有的全局变量。

*   选择一个 RTOS，但不要费心去测试它的实际性能（我们不能相信供应商给出的数字吗？）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-30T19:43:57.623

嵌入式系统中的一件重要事情是独立于您的应用程序评估技术，包括软件（编译器、库、操作系统）和硬件（芯片组）。避免使用这些测试台是危险的。一个人应该要么购买评估套件，要么建立他/她自己的测试台。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-11-27T10:28:26.413

打印。

如果您的跟踪工具需要上下文切换和/或中断，那么您将永远无法调试任何与时间相关的内容。

写入内存缓冲区（memcpy'ing enums 而不是 s(n)printf 的奖励点），并在其他时间读取它。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-08T22:58:10.920

这可能更像是一个硬件解决方案——但对于从头开始的新项目，低估资源需求是一个大问题，尤其是在使用没有简单方法扩展代码/存储大小的小型独立微控制器时。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-03-07T03:17:08.293

从软件的角度来看，没有花时间学习硬件。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-05-18T12:08:02.040

这不仅适用于嵌入式系统，而且将所有这些时间都花在寻找错误（调试）上，而不是通过诸如代码审查之类的酷东西来避免错误，这绝对是一种最常见的最坏做法。

另一种方法是让一个巨大的处理器完成所有工作，而不是将问题分解为小问题，例如使用更多的小处理器。还记得可可吗？

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-09-07T16:19:19.747

这在很大程度上取决于您正在为其编程的控制器类型。有时成本是最重要的事情，你试图用尽可能少的钱过日子。那是我通常乘坐的船。以下是我使用过的一些最糟糕的做法：

*   不要专注于改进您的流程。下次再努力一点。稍后当我们不忙于匆忙发布新产品同时支持该领域的所有这些错误时，我们可以担心这些东西。
*   避免设计一种工程工具来让您的生活更轻松，如果您确实构建了一个，请不要让它向设备发送无效输入
*   不要质疑优化。这是魔法。编译器知道它在做什么。永远不会有编译器错误，尤其是对于您的客户 7 位 PIC 子微控制器。太多人会注意到吧？
*   像运行物理引擎一样进行除法和乘法运算，不用担心溢出、精度损失、四舍五入到零。
*   如果您的时间安排似乎有效，请不要检查您是否偏离了 1 分或是否随时间漂移。您在高中时演奏打击乐，您会注意到 7200000 时钟周期和 7200001 之间的差异。
*   依靠对您的固件一无所知的小组进行的系统级测试
*   在尽可能多的不同设备上工作。有几个调试器会话与不同的开发环境一起使用。开发一种产品，同时对另一种产品进行基准测试，并尝试在第三个产品上重现现场问题。
*   匆忙发布新版本的代码，因为您只更改了一件事，而且您可能没有破坏它。生产线下线了，我们不能浪费任何时间！
*   如果优化已关闭，请不要进行任何类型的测试来警告您。应该不会对吧？您刚刚安装的新 IDE 版本不可能破坏该设置。
*   把代码写得足够好才能工作。花 75% 的时间把它弄到一半。
*   不要对功能的设计有任何投入。允许任何功能收集几天的状态信息。无法为测试注入此状态信息。这将使您在尝试重现人们在现场看到的错误时有空闲时间，生产人员也会很感激他们的休息时间

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-11-08T08:47:14.427

我在嵌入式系统工作超过 8 年并教授嵌入式系统的经验中的一些最糟糕的做法：

1.  **数据类型的选择**——嵌入式系统资源稀缺。如果数据的范围是 5-200，则没有必要将其声明为 int。所需的只有 8 位，而使用的是 32 位。浪费24位。

错误的数据类型也可能是灾难性的。

2.  **在 ISR 中做大量工作**- ISR 应该尽可能短。我见过一些人在 ISR 中实现了整个逻辑，这非常非常糟糕。太糟糕了，它应该被列为犯罪。改用标志

3.  **使用整数作为标志**- 这更像是第 1 点的扩展。您只需要一位。不要为此使用 16 位或 32 位。

4.  但我所见过的最糟糕的是一遍又一遍地思考算法以获得最好和最完美的方法。停止！！牢记最佳实践，让系统首先运行。

还有很多。你可以[在这里阅读其中的一些](https://nerdyelectronics.com/risk-areas-in-embedded-systems-development-development-process/)

# javascript - 从父页面调用 iframe 中的 JavaScript 代码

> ID：251420
> 
> 赞同：650
> 
> 时间：2008-10-30T19:27:56.177
> 
> 标签：javascript, html, iframe

基本上，我有一个`iframe`嵌入页面，并且`iframe`有一些我需要从父页面调用的[JavaScript例程。](http://en.wikipedia.org/wiki/JavaScript)

现在相反很简单，因为您只需要调用`parent.functionName()`，但不幸的是，我需要完全相反的。

请注意，我的问题不是更改 的源[URL](http://en.wikipedia.org/wiki/Uniform_Resource_Locator)，`iframe`而是调用`iframe`.

* * *

## 回答 #1

> 赞同：579
> 
> 时间：2008-10-30T19:35:41.400

假设您的 iFrame 的 id 是“targetFrame”并且您要调用的函数是`targetFunction()`：

```
document.getElementById('targetFrame').contentWindow.targetFunction(); 
```

您还可以使用`window.frames`而不是访问框架`document.getElementById`。

```
// this option does not work in most of latest versions of chrome and Firefox
window.frames[0].frameElement.contentWindow.targetFunction(); 
```

* * *

## 回答 #2

> 赞同：155
> 
> 时间：2008-10-30T20:27:26.570

这里有一些怪癖需要注意。

1.  `HTMLIFrameElement.contentWindow`可能是更简单的方法，但它不是一个标准属性，并且一些浏览器不支持它，主要是旧的。这是因为 DOM Level 1 HTML 标准对`window`对象没有任何规定。

2.  您也可以尝试`HTMLIFrameElement.contentDocument.defaultView`，一些较旧的浏览器允许但 IE 不允许。即便如此，该标准并没有明确说明您可以取回`window`对象，原因与 (1) 相同，但如果您愿意，您可以在此处获取一些额外的浏览器版本。

3.  `window.frames['name']`返回窗口是最古老的，因此也是最可靠的界面。但是您必须使用`name="..."`属性才能按名称获取框架，这有点难看/~~不推荐使用~~/过渡。（`id="..."`会更好，但 IE 不喜欢那样。）

4.  `window.frames[number]`也很可靠，但知道正确的索引是诀窍。你可以摆脱这个，例如。如果您知道页面上只有一个 iframe。

5.  完全有可能子 iframe 尚未加载，或者出现其他问题使其无法访问。您可能会发现反转通信流程更容易：也就是说，当子 iframe`window.parent`完成加载并准备好被回调时，让子 iframe 通知其脚本。通过将它自己的一个对象（例如回调函数）传递给父脚本，该父脚本可以直接与 iframe 中的脚本进行通信，而不必担心它与什么 HTMLIFrameElement 相关联。

* * *

## 回答 #3

> 赞同：70
> 
> 时间：2010-04-18T17:11:02.113

调用父 JS 函数`iframe`是可能的，但只有当父和加载的页面`iframe`都来自同一个域，即 abc.com，并且两者都使用相同的协议，即两者都是 on`http://`或时`https://`。

在以下提到的情况下，调用将失败：

1.  父页面和 iframe 页面来自不同的域。

2.  他们使用不同的协议，一种在 http:// 上，另一种在 https:// 上。

对此限制的任何解决方法都将非常不安全。

例如，假设我注册了域 superwinningcontest.com 并发送了指向人们电子邮件的链接。当他们加载主页时，我可以`iframe`在其中隐藏几个 s 并阅读他们的 Facebook 提要，检查最近的亚马逊或 PayPal 交易，或者——如果他们使用的服务没有实现足够的安全性——从他们的账户中转出资金帐户。这就是 JavaScript 仅限于同域和同协议的原因。

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2008-10-30T19:39:02.907

在 IFRAME 中，将您的函数公开给窗口对象：

```
window.myFunction = function(args) {
   doStuff();
} 
```

要从父页面访问，请使用：

```
var iframe = document.getElementById("iframeId");
iframe.contentWindow.myFunction(args); 
```

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2011-10-29T10:22:59.120

如果 iFrame 的目标和包含的文档位于不同的域中，则之前发布的方法可能不起作用，但有一个解决方案：

例如，如果文档 A 包含一个包含文档 B 的 iframe 元素，并且文档 A 中的脚本调用了文档 B 的 Window 对象上的 postMessage()，那么将在该对象上触发一个消息事件，标记为源自文档 A。文档 A 中的脚本可能如下所示：

```
var o = document.getElementsByTagName('iframe')[0];
o.contentWindow.postMessage('Hello world', 'http://b.example.org/'); 
```

要为传入事件注册事件处理程序，脚本将使用 addEventListener()（或类似机制）。例如，文档 B 中的脚本可能如下所示：

```
window.addEventListener('message', receiver, false);
function receiver(e) {
  if (e.origin == 'http://example.com') {
    if (e.data == 'Hello world') {
      e.source.postMessage('Hello', e.origin);
    } else {
      alert(e.data);
    }
  }
} 
```

此脚本首先检查域是预期域，然后查看消息，它要么显示给用户，要么通过将消息发送回最初发送消息的文档来响应。

通过[http://dev.w3.org/html5/postmsg/#web-messaging](http://dev.w3.org/html5/postmsg/#web-messaging)

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2017-10-07T16:42:04.437

其中一些答案没有解决 CORS 问题，或者没有明确说明您放置代码片段的位置以使通信成为可能。

这是一个具体的例子。假设我想单击父页面上的一个按钮，并让它在 iframe 内执行某些操作。这是我将如何做到的。

parent_frame.html

```
<button id='parent_page_button' onclick='call_button_inside_frame()'></button>

function call_button_inside_frame() {
   document.getElementById('my_iframe').contentWindow.postMessage('foo','*');
} 
```

iframe_page.html

```
window.addEventListener("message", receiveMessage, false);

function receiveMessage(event)
    {
      if(event) {
        click_button_inside_frame();
    }
}

function click_button_inside_frame() {
   document.getElementById('frame_button').click();
} 
```

要走向另一个方向（单击 iframe 内的按钮以调用 iframe 外的方法），只需切换代码片段所在的位置，然后更改：

```
document.getElementById('my_iframe').contentWindow.postMessage('foo','*'); 
```

对此：

```
window.parent.postMessage('foo','*') 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-06-30T12:48:58.807

只是为了记录，我今天遇到了同样的问题，但这次页面嵌入在一个对象中，而不是 iframe（因为它是一个 XHTML 1.1 文档）。以下是它与对象的工作方式：

```
document
  .getElementById('targetFrame')
  .contentDocument
  .defaultView
  .targetFunction(); 
```

（对不起，丑陋的换行符，不适合单行）

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-10-30T19:31:58.290

Quirksmode 对此发表了一篇[文章](http://web.archive.org/web/20080225210716/http://www.quirksmode.org/js/iframe.html)。

由于该页面现在已损坏，并且只能通过 archive.org 访问，因此我在这里复制了它：

**框架**

在此页面上，我简要概述了从它们所在的页面访问 iframe。毫不奇怪，有一些浏览器注意事项。

iframe 是一个内联框架，它包含一个具有自己 URL 的完全独立的页面，但仍放置在另一个 HTML 页面中。这为网页设计提供了非常好的可能性。问题是访问 iframe，例如将新页面加载到其中。这个页面解释了如何做到这一点。

**框架还是物体？**

基本问题是 iframe 是被视为框架还是对象。

*   正如[框架页面简介中](http://web.archive.org/web/20080225210716/http://www.quirksmode.org/js/frameintro.html)所解释的，如果您使用框架，浏览器会为您创建框架层次结构（`top.frames[1].frames[2]`等等）。iframe 是否适合此框架层次结构？
*   或者浏览器是否将 iframe 视为另一个对象，一个恰好具有 src 属性的对象？在这种情况下，我们必须使用标准的[DOM 调用](http://web.archive.org/web/20080225210716/http://www.quirksmode.org/js/dom.html)（比如`document.getElementById('theiframe'))`访问它。通常浏览器允许在“真实”（硬编码）iframe 上查看两个视图，但生成的 iframe 不能作为框架访问。

**名称属性**

最重要的规则是为您创建的任何 iframe 提供一个`name`属性，即使您还使用`id`.

```
<iframe src="iframe_page1.html"
    id="testiframe"
    name="testiframe"></iframe> 
```

大多数浏览器都需要该`name`属性来使 iframe 成为框架层次结构的一部分。一些浏览器（尤其是 Mozilla）需要`id`使 iframe 可以作为对象访问。通过将这两个属性分配给 iframe，您可以保持选项打开。但`name`远比 重要`id`。

**使用权**

要么将 iframe 作为对象访问并更改其`src`，要么将 iframe 作为框架访问并更改其`location.href`.

document.getElementById('iframe_id').src = 'newpage.html'; 框架['iframe_name'].location.href = 'newpage.html'; 框架语法稍微好一些，因为 Opera 6 支持它，但不支持对象语法。

**访问 iframe**

因此，为了获得完整的跨浏览器体验，您应该为 iframe 命名并使用

```
frames['testiframe'].location.href 
```

句法。据我所知，这总是有效的。

**访问文档**

`name`只要您使用该属性，访问 iframe 内的文档非常简单。要计算 iframe 中文档中的链接数，请执行 [`frames['testiframe'].document.links.length`](http://web.archive.org/web/20080225210716/http://www.quirksmode.org/js/iframe.html#).

**生成的 iframe**

但是，当您通过[W3C DOM](http://web.archive.org/web/20080225210716/http://www.quirksmode.org/dom/intro.html)生成 iframe 时，iframe 不会立即输入到`frames`数组中，并且`frames['testiframe'].location.href`语法不会立即起作用。在 iframe 出现在数组中之前，浏览器需要一点时间，这段时间没有脚本可以运行。

`document.getElementById('testiframe').src`语法在所有情况下都可以正常工作。

链接的`target`属性也不适用于生成的 iframe，但在 Opera 中除外，即使我将生成的 iframe 同时提供了 a`name`和 an `id`。

缺乏`target`支持意味着您必须使用 JavaScript 来更改生成的 iframe 的内容，但由于您首先需要 JavaScript 来生成它，所以我认为这不是什么大问题。

**iframe 中的文本大小**

一个好奇的 Explorer 6 唯一错误：

当您通过查看菜单更改文本大小时，iframe 中的文本大小会正确更改。但是，该浏览器不会更改原始文本中的换行符，因此部分文本可能会变得不可见，或者可能会出现换行符，而该行仍然可以容纳另一个单词。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2008-10-30T19:36:34.957

IFRAME 应该在`frames[]`集合中。使用类似的东西

```
frames['iframeid'].method(); 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2014-02-08T17:44:45.013

我找到了一个非常优雅的解决方案。

正如您所说，执行位于父文档上的代码相当容易。这就是我的代码的基础，正好相反。

当我的 iframe 加载时，我调用位于父文档上的函数，将作为参数传递给位于 iframe 文档中的本地函数的引用。父文档现在可以通过此引用直接访问 iframe 的功能。

**例子：**

在父级上：

```
function tunnel(fn) {
    fn();
} 
```

在 iframe 上：

```
var myFunction = function() {
    alert("This work!");
}

parent.tunnel(myFunction); 
```

当 iframe 加载时，它会调用 parent.tunnel(YourFunctionReference)，它会执行参数中接收到的函数。

就这么简单，无需处理来自各种浏览器的所有非标准方法。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-10-13T17:15:18.880

继续[JoelAnaair 的](https://stackoverflow.com/users/7441/joel-anair)回答：

为了更稳健，请按如下方式使用：

```
var el = document.getElementById('targetFrame');

if(el.contentWindow)
{
   el.contentWindow.targetFunction();
}
else if(el.contentDocument)
{
   el.contentDocument.targetFunction();
} 
```

像魅力一样工作:)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2011-12-05T05:43:42.957

如果您想从另一个函数（例如 shadowbox 或 lightbox）生成的 iframe 调用 Parent 上的 JavaScript 函数。

您应该尝试使用`window`对象并调用父函数：

```
window.parent.targetFunction(); 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-08-03T12:40:09.757

遵循 Nitin Bansal 的回答

为了更加稳健：

```
function getIframeWindow(iframe_object) {
  var doc;

  if (iframe_object.contentWindow) {
    return iframe_object.contentWindow;
  }

  if (iframe_object.window) {
    return iframe_object.window;
  } 

  if (!doc && iframe_object.contentDocument) {
    doc = iframe_object.contentDocument;
  } 

  if (!doc && iframe_object.document) {
    doc = iframe_object.document;
  }

  if (doc && doc.defaultView) {
   return doc.defaultView;
  }

  if (doc && doc.parentWindow) {
    return doc.parentWindow;
  }

  return undefined;
} 
```

和

```
...
var el = document.getElementById('targetFrame');

var frame_win = getIframeWindow(el);

if (frame_win) {
  frame_win.targetFunction();
  ...
}
... 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-11-21T20:08:48.757

```
 $("#myframe").load(function() {
            alert("loaded");
        }); 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2011-08-30T06:44:56.393

相同但更简单的方法是[如何从 iframe 中的页面刷新父页面](http://dotnetspidor.blogspot.com/2011/07/refresh-parent-page-partially-from.html)。只需调用父页面的函数来调用 javascript 函数来重新加载页面：

```
window.location.reload(); 
```

或者直接从 iframe 中的页面执行此操作：

```
window.parent.location.reload(); 
```

两者都有效。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-12-14T11:33:03.440

试一试`parent.myfunction()`

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2014-08-05T12:09:52.813

使用以下调用父页面中框架的功能

```
parent.document.getElementById('frameid').contentWindow.somefunction() 
```

# c++ - 模板类的类型定义？

> ID：251432
> 
> 赞同：7
> 
> 时间：2008-10-30T19:30:51.863
> 
> 标签：c++, templates, typedef

是否可以`typedef`长类型使用模板？例如：

```
template <typename myfloat_t>
class LongClassName
{
    // ...
};

template <typename myfloat_t>
typedef std::vector< boost::shared_ptr< LongClassName<myfloat_t> > > LongCollection;

LongCollection<float> m_foo; 
```

这不起作用，但是有没有办法达到类似的效果？我只是想避免键入和阅读几乎覆盖了我的编辑器窗口整个宽度的类型定义。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-30T19:34:19.190

不，目前不可能。这将在 C++0X AFAIK 中实现。

我能想到的最好的是

```
template<typename T> struct LongCollection {
    typedef std::vector< boost::shared_ptr< LongClassName<T> > > type;
};

LongCollection<float>::type m_foo; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T19:36:01.230

如果您不想采用宏方式，则必须为每种类型制作单独的 typedef：

```
typedef std::vector< boost::shared_ptr< LongClassName<float> > > FloatCollection;
typedef std::vector< boost::shared_ptr< LongClassName<double> > > DoubleCollection; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T19:36:33.490

不，但是您可以使用“助手”类型来接近，请参阅此[示例](http://www.gotw.ca/gotw/079.htm)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T19:43:24.240

Leon 给出的解决方案是规范的。一点背景知识：这被称为“（模板）元函数”，因为它基本上是一个在编译时被评估的“函数”。它处理类型而不是值：有一个输入类型列表（类型参数）和一个“返回值”：声明类型名称“type”的 typedef。

“调用”的工作方式类似于正常的函数调用，尽管语法不同：

```
// Normal function
result = f(args);

// Metafunction
typedef f<args>::type result; 
```

这种代码结构是 Boost 库等库中甚至在 STL 中的一个常用习惯用法：`allocator_type::rebind<U>::other`完成相同的事情，唯一的区别`type`是调用typedef `other`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T19:41:09.673

它并不完全符合您的要求，但这可能会根据您的实际情况达到预期的效果：

```
template <typename myfloat_t>
class LongClassName
{
    // ...
};

template <typename myfloat_t>
class LongCollection : public std::vector< boost::shared_ptr< LongClassName<myfloat_t> > > 
{
}; 
```

您可能需要根据需要添加一些构造函数或运算符。

# c# - 我可以在 LINQ to 对象中执行“或”操作吗？

> ID：251433
> 
> 赞同：3
> 
> 时间：2008-10-30T19:30:56.497
> 
> 标签：c#, linq

在谷歌中查找 LINQ 和 Or 被证明有些困难，所以我在这里。

我想要以下内容：

```
(from creditCard in AvailableCreditCards 
where creditCard.BillToName.ToLowerInvariant().Contains(txtFilter.Text.ToLowerInvariant())
**or creditCard.CardNumber.().Contains(txtFilter.Text)**
orderby creditCard.BillToName
select creditCard) 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T19:35:06.317

支持 LINQ 的 C# 关键字仍然是 C#。`where`将其视为有条件的`if`; 您以相同的方式执行逻辑运算。在这种情况下，逻辑或，您使用`||`

```
(from creditCard in AvailableCreditCards 
 where creditCard.BillToName.ToLowerInvariant().Contains(
             txtFilter.Text.ToLowerInvariant())  
 || creditCard.CardNumber.().Contains(txtFilter.Text) 
orderby creditCard.BillToName 
select creditCard) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T19:34:47.970

您可以使用 .Where() 函数来完成此操作。

```
var cards = AvailableCreditCards.Where(card=> card.CardNumber.Contains(txtFilter.Text) || card.BillToName.ToLowerInvariant().Contains(txtFilter.Text.ToLowerInvariant()); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T19:35:14.990

您应该使用适用于您的语言的布尔运算符。管道 | 在 C# 中工作

这是单曲上的[msdn](http://msdn.microsoft.com/en-us/library/kxszd0kx(VS.80).aspx) | 这是双管道上的[msdn](http://msdn.microsoft.com/en-us/library/6373h346(VS.80).aspx) ||

与双管道的处理是它短路（如果左表达式为真，则不运行右表达式）。许多人只使用双管只是因为他们从未学习过单管。

双管道的短路行为会创建*分支代码*，如果预期运行右侧的表达式会产生副作用，这可能会非常糟糕。

我在 linq 查询中更喜欢单管道的原因是 - 如果查询有一天在 linq to sql 中使用，则 c# 的两个 OR 运算符的底层转换是 sql 的 OR，它的操作类似于单管道。

# c++ - 具有重复键的 STL 优先级队列 - 可能吗？

> ID：251438
> 
> 赞同：9
> 
> 时间：2008-10-30T19:32:12.000
> 
> 标签：c++, stl

我需要将我的 A 类对象存储在一些数据结构中。另外，我希望它们根据一个键自动排序，在我的例子中是另一个 B 类的嵌入对象。

因此我决定使用 STL 优先级队列。

但是，2 个或更多对象 B 可能具有相同的键值。

我的问题：

**STL 优先级队列是否允许重复键？**

**如果确实如此，我应该考虑什么以及应该使用哪个谓词？**

**我知道我可以使用多重集，但它的大 O 表示法性能更差，这就是我想使用优先级队列的原因。**

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-30T19:35:42.197

> STL 优先级队列是否允许重复键？

是的。

> 如果确实如此，我应该考虑什么

相等元素之间的顺序可以任意改变。

> 我应该使用哪个谓词？

你的意思是？这完全取决于你的语义。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-30T19:37:38.980

是的，它支持重复键。

从文档中：

```
void push(const value_type& x) Inserts x into the priority_queue.
                               Postcondition: size() will be incremented by 1\. 
```

一个简单的测试证实了这一点：

```
int main() {
  priority_queue<int> q;
  q.push(5);
  q.push(5);
  cout << q.top() << endl;
  q.pop();
  cout << q.top() << endl;
  q.pop();
} 
```

输出：

```
5
5 
```

至于谓词，请使用您之前使用过的任何内容 - 优先级队列所保证的任何内容都不会因允许相等的元素而被破坏，因此您的算法应该可以正常工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T19:40:36.150

康拉德有一个很好的答案，补充一下。你应该知道priority_queue不一定有很好的性能。根据此页面[http://www.cs.brown.edu/~jwicks/libstdc++/html_user/classstd_1_1priority__queue.html](http://www.cs.brown.edu/~jwicks/libstdc++/html_user/classstd_1_1priority__queue.html)，看起来它是通过对所有操作执行 make_heap、pop_heap 等来实现的，以获得最高优先级。

与其他数据结构相比，重新堆化可能会很昂贵，具体取决于您的用例。

# c# - 将 int 列表作为参数传递给 Web 用户控件

> ID：251439
> 
> 赞同：12
> 
> 时间：2008-10-30T19:32:14.013
> 
> 标签：c#, asp.net, typeconverter

我想将一个 int 列表（List）作为声明性属性传递给 Web 用户控件，如下所示：

```
<UC:MyControl runat="server" ModuleIds="1,2,3" /> 
```

我创建了一个 TypeConverter 来做到这一点：

```
public class IntListConverter : System.ComponentModel.TypeConverter
{
    public override bool CanConvertFrom(
           System.ComponentModel.ITypeDescriptorContext context, 
           Type sourceType)
    {
        if (sourceType == typeof(string)) return true;
        return base.CanConvertFrom(context, sourceType);
    }
    public override object ConvertFrom(
      System.ComponentModel.ITypeDescriptorContext context, 
      System.Globalization.CultureInfo culture, object value)
    {
        if (value is string)
        {
            string[] v = ((string)value).Split(
                new char[] { ',' }, StringSplitOptions.RemoveEmptyEntries);
            List<int> list = new List<int>();
            foreach (string s in vals)
            {
                list.Add(Convert.ToInt32(s));
            }
            return list
        }
        return base.ConvertFrom(context, culture, value);
    }
    public override bool CanConvertTo(ITypeDescriptorContext context,
      Type destinationType)
    {
        if (destinationType == typeof(InstanceDescriptor)) return true;
        return base.CanConvertTo(context, destinationType);
    }
    public override object ConvertTo(ITypeDescriptorContext context,
      System.Globalization.CultureInfo culture, object value, Type destinationType)
    {
        if (destinationType == typeof(InstanceDescriptor) && value is List<int>)
        {
            List<int> list = (List<int>)value;
            ConstructorInfo construcor = typeof(List<int>).GetConstructor(new Type[] { typeof(IEnumerable<int>) });
            InstanceDescriptor id = new InstanceDescriptor(construcor, new object[] { list.ToArray() });
            return id;
        }
        return base.ConvertTo(context, culture, value, destinationType);
    }
} 
```

然后将属性添加到我的属性中：

```
[TypeConverter(typeof(IntListConverter))]
public List<int> ModuleIds
{
    get { ... }; set { ... };
} 
```

但我在运行时收到此错误：

`Unable to generate code for a value of type 'System.Collections.Generic.List'1[[System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]]'. This error occurred while trying to generate the property value for ModuleIds.`

我的问题与[此处](https://stackoverflow.com/questions/116797/passing-int-array-as-parameter-in-web-user-control)找到的问题类似，但该解决方案并未解决我的问题：

**更新：**我找到了一个解决第一个问题的页面。我更新了上面的代码以显示我的修复。添加的代码是`CanConvertTo`and`ConvertTo`方法。现在我得到一个不同的错误。：

`Object reference not set to an instance of an object.`

此错误似乎是由`ConvertTo`方法中的某些内容间接引起的。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-30T22:32:14.853

在将调试器连接到 Cassini 后，我看到 null ref 实际上来自 System.Web.Compilation.CodeDomUtility.GenerateExpressionForValue，它基本上是在尝试获取传递给 List 构造函数的 int[] 数组的表达式。由于 int[] 数组没有类型描述符，因此它会失败（并在进程中抛出一个空 ref，而不是它应该的“无法生成属性集异常”）。

我想不出一种将可序列化值放入 List<int> 的内置方法，所以我只使用了一个静态方法：

```
class IntListConverter : TypeConverter {
    public static List<int> FromString(string value) {
       return new List<int>(
          value
           .Split(new char[] { ',' }, StringSplitOptions.RemoveEmptyEntries)
           .Select(s => Convert.ToInt32(s))
       );
    }

    public override object ConvertTo(ITypeDescriptorContext context, CultureInfo culture, object value, Type destinationType) {
        if (destinationType == typeof(InstanceDescriptor)) {
            List<int> list = (List<int>)value;
            return new InstanceDescriptor(this.GetType().GetMethod("FromString"),
                new object[] { string.Join(",", list.Select(i => i.ToString()).ToArray()) }
            );
        }
        return base.ConvertTo(context, culture, value, destinationType);
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T20:57:44.997

虽然我不能说我对这个错误有任何特别的经验，但其他来源表明您需要向 InstanceDescriptor 类型添加转换。查看：

[http://weblogs.asp.net/bleroy/archive/2005/04/28/405013.aspx](http://weblogs.asp.net/bleroy/archive/2005/04/28/405013.aspx)

其中提供了原因的解释，或者：

[http://forums.asp.net/p/1191839/2052438.aspx#2052438](http://forums.asp.net/p/1191839/2052438.aspx#2052438)

它提供了与您类似的示例代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T08:10:02.657

我通过创建 2 个属性解决了一些类似的问题：

```
public List<int> ModuleIDs { get .... set ... }
public string ModuleIDstring { get ... set ... } 
```

ModuleIDstring 将其值集转换为列表并设置 ModuleIDs 属性。

这也将使 ModuleID 可从 PropertyGrid 等中使用。

好的，不是最好的类型安全解决方案，但对我来说它有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T20:17:53.517

从后面的代码中传递列表...

aspx：

```
<UC:MyControl id="uc" runat="server" /> 
```

代码隐藏：

```
List<int> list = new List<int>();
list.add(1);
list.add(2);
list.add(3);

uc.ModuleIds = list; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T20:20:17.100

我通常这样做的方式是让属性包装 ViewState 集合。如果可以使您的方式看起来更好，但这将完成工作：

```
public IList<int> ModuleIds
{
   get
   {
       string moduleIds = Convert.ToString(ViewState["ModuleIds"])

       IList<int> list = new Collection<int>();

       foreach(string moduleId in moduleIds.split(","))
       {
          list.Add(Convert.ToInt32(moduleId));
       }

      return list;
   }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T20:46:34.333

我相信问题出在集合{}。类型转换器想要将 back 更改为`List<int>`字符串，但.`CanConvertFrom()``List<int>`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T20:52:49.123

您可以将其传递给字符串并以逗号分隔以填充私有变量。没有归因的精确性，但会起作用。

```
private List<int> modules;
public string ModuleIds
{
  set{
    if (!string.IsNullOrEmpty(value))
    {
    if (modules == null) modules = new List<int>();
    var ids = value.Split(new []{','});
    if (ids.Length>0)
      foreach (var id in ids)
        modules.Add((int.Parse(id)));
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-30T22:31:40.703

我认为您最好的选择是让您的用户控件具有 DataSource 样式的属性。

您将属性作为一个对象，然后对 IList/IEnumerable/ 等进行一些类型检查以确保它是正确的。

# ruby - 编写一个 ruby 命令行应用程序；最好的方法是什么？

> ID：251444
> 
> 赞同：6
> 
> 时间：2008-10-30T19:33:55.383
> 
> 标签：ruby, idioms

我有一个正在开发的命令行 Ruby 应用程序，我想允许它的用户提供将作为过滤器运行在部分流程上的代码。基本上，应用程序这样做：

1.  读入一些数据
2.  如果指定了过滤器，则使用它来过滤数据
3.  处理数据

我希望过滤过程（步骤 2）尽可能灵活。

我的想法是，用户可以提供一个 Ruby 文件，该文件设置一个已知常量以指向实现我定义的接口的对象，例如：

```
# user's filter

class MyFilter
  def do_filter(array_to_filter)
    filtered_array = Array.new
    # do my filtering on array_to_filter
    filtered_array
end 

FILTER = MyFilter.new 
```

然后，我的应用程序代码将执行以下操作：

```
array_that_might_get_filtered = get_my_array()
if (options.filter_file)
  require options.filter_file
  array_that_might_get_filtered = FILTER.do_filter(array_that_might_get_filtered)
end 
```

虽然这可行，但感觉很俗气，似乎应该有更好的方法来做到这一点。我还考虑让过滤器采用将已知名称的方法添加到已知类的形式，但这似乎也不太正确。

Ruby中有更好的成语吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T20:19:20.253

我只是使用命令行和约定的组合。

> 如果指定了过滤器，则使用它来过滤数据

我假设您会在命令行上指定一个过滤器？所以你会像这样调用应用程序？

```
ruby dataprocessor.rb custom_filter 
```

如果是这样，您可以定义一个“api”，其中类名必须与传入的内容相匹配 - 几乎与您在示例中所描述的完全一样。

不过，为了更进一步，您可以使用一些逻辑来查找`CustomFilter`使用 ruby​​'s 的类`defined?`，如果找不到，请查找`custom_filter.rb`（或任何合适的变体）并尝试加载该文件，然后重试。

这为您提供了极大的可扩展性，因为您可以编写任意数量的过滤器类，将它们放入自己的 .rb 文件中，并将它们放在 ruby​​ 可以找到它们的任何地方。您也不必有预定义的常量，唯一的约束是

1.  类名必须匹配文件名（的变体）——这是 ruby​​ 中的约定，所以你可能已经在这样做了。
2.  它必须有一些预定义的方法，比如你的`do_filter`方法

顺便说一句，这与 rails 需要您的模型所做的非常相似，这就是为什么您可以直接使用`SomeModel`而不必总是先做`require app/models/some_model`:-)`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T19:50:52.383

看起来像是[Strategy Pattern](http://en.wikipedia.org/wiki/Strategy_pattern)的工作，并且由于 ruby​​ 具有[作为第一类对象](http://weblog.raganwald.com/2007/01/closures-and-higher-order-functions.html)的功能，您可以传递过滤器函数以由数组存储，以便按需调用该自定义过滤器函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T20:28:23.837

```
# user code
USER_FILTER = lambda { |value| value != 0xDEADBEEF }

# script code
load( user_code );
FILTER = ( const_defined?(:USER_FILTER) ? USER_FILTER : lambda { true } )

output_array = input_array.filter(&FILTER) 
```

# vb.net - 寻求代码设计建议：使用 VB.Net 和 Ms-Access

> ID：251459
> 
> 赞同：-1
> 
> 时间：2008-10-30T19:37:12.850
> 
> 标签：vb.net, ms-access

也许天真地，我创建了一个类 (AdminDatabase) 来处理与不同 MS-Access 数据库文件的连接（参见底部的代码）。该类的目的是允许从 MS-Access 数据库中检索数据并操作数据。这很好用。我可以为 AdminDatabase 类的实例提供一条 SQL 语句并用结果填充数据表（**代码部分中的***getDataTable*方法。现在我已经使用 Visual Studio 的数据设计器将数据集添加到项目中。

 **现在我有点困惑。一旦用户选择了相关的数据文件，AdminDatabase 类集的连接字符串。由于新数据集也使用相同的设置，My.Settings.AdminConnectionString 用于连接，这让我想到了我的问题：

1.  实例化 AdminDatabase 对象后，我可以假设我使用数据设计器创建的数据集将连接到用户在运行时选择的 MS-Access 数据库文件吗？

2.  我应该在我的连接类中编写方法来访问使用数据设计器创建的数据集中的数据，还是直接访问数据集可以？我想我可以在某个地方有一个方法来设置项目中的连接字符串设置。

3.  我还能如何解决这个问题？

### 代码

```
     公共类 AdminDatabase
       ' 存储在 New() 方法中设置的连接字符串
       暗淡 strAdminConnection 作为字符串

       公共子新（）
       ...
       adminName = dlgopen.FileName
       conAdminDB = 新的 OleDbConnection
       conAdminDB.ConnectionString = "数据源='" + adminName + "';" + _
           “提供者=Microsoft.ACE.OLEDB.12.0”

       ' 将连接字符串存储在 strAdminConnection 中
       strAdminConnection = conAdminDB.ConnectionString.ToString()
       My.Settings.SetUserOverride("AdminConnectionString", strAdminConnection)
       ...
       结束子

       ' 从数据库中检索数据
       公共函数 getDataTable(ByVal sqlStatement As String) As DataTable
            暗淡为新数据集
            将 dt 调暗为新数据表
            Dim da 作为新的 OleDbDataAdapter
            将 localCon 调暗为新的 OleDbConnection

            localCon.ConnectionString = strAdminConnection

            使用 localCon
                暗淡命令 As OleDbCommand = localCon.CreateCommand()
                command.CommandText = sqlStatement
                localCon.Open()
                da.SelectCommand = 命令
                da.填充（dt）
                获取数据表 = dt
            结束使用

        结束功能
    结束类

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T20:18:40.690

如果您使用强类型数据集而不是通用 DataTable 作为返回值，我会将它们视为不同的方法，为正在完成的操作返回正确的数据集。

我个人不再使用 DataSets 了，所以我不能 100% 确定是否有更清洁的方法......

# visual-studio-2008 - 我可以在 Windows Vista x64 上运行 Visual Studio 2008 x86 吗？

> ID：251460
> 
> 赞同：6
> 
> 时间：2008-10-30T19:37:14.410
> 
> 标签：visual-studio-2008, compatibility, vista64

是否可以在 Windows Vista 64 位系统上运行 32 位版本的 Visual Studio 2008 Professional？

*   是否有任何我需要注意的已知警告？
*   是否必须安装 x64 版本的 .NET Framework？
*   构建针对 x86 的软件会有什么问题吗？
*   获得 x64 版本的 VS2008 而不是重用当前的 x86 许可证是否有任何（合理的）论据？

非常想获得 x64 Vista 装备以利用更多 RAM :)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-30T19:44:00.963

没有 x64 版本的 Visual Studio 2008。我在 Vista x64 Ultimate 上运行标准的 32 位版本，它运行良好。我真的没有遇到任何日常问题。你只需安装它就可以了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-25T13:19:21.750

我现在在 x64 上使用 VS2008。这让我可以使用完整的 4GB RAM。它有效，但有一些极端情况需要注意：

*   调试 x64 应用程序是通过从 32 位子系统到 64 位子系统的远程调试来完成的。

*   默认情况下，托管 (.NET) 应用程序被标记为“任何平台”，这意味着它们在 x64 操作系统上以 64 位运行。这意味着托管调试默认是远程的。

*   远程调试时没有 Edit-and-Continue，因此 x64 操作系统上没有适用于 .NET 的 E&C，除非[您将应用程序标记为 32-bit-only](http://www.delarou.net/weblog/PermaLink,guid,6fcde84b-c94e-406b-91a7-8df2d633a057.aspx)。同样，如果你制作一个原生的 64 位应用程序，你就不能对它进行 E&C。

*   远程调试时没有混合（托管 + 本机），因此您无法同时调试 x64 应用程序的托管和本机部分。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T19:47:26.480

*   我不知道。我同时使用 Visual Studio 2008 Professional 和 Team System，它们似乎都可以在 x64 上正常工作。
*   是的。
*   不。
*   我认为没有 64 位版本的 VS 2008。

总的来说，这对我来说一帆风顺，所以我认为你可以直接加入。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-30T19:53:02.770

看看这个..

[用 Vista 64 编写的代码在 32 位操作系统上是否兼容？](https://stackoverflow.com/questions/30543/is-code-written-in-vista-64-compatible-on-32-bit-os)

基思

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T19:44:52.740

我的印象是 64 位窗口的设计使得完全存在于 UserLand 中的 32 位程序“正常工作”。需要内核模式访问的设备驱动程序等程序可能需要 64 位特定端口。

我不知道有任何明显的例外，但我相信如果你足够努力的话，你会找到一些。因此，除了移动设备模拟器可能例外，Visual Studio 应该没问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-30T19:46:52.970

我有 VS 2005 的 CD，SP1 让我在我的 vista 上做 x64。VS2008 必须相同。

可以肯定的是，一旦安装，请检查编译器配置文件以查看是否可以在 X86 和 X64 中构建。如果是的话（就像我在我的 Vista 上做的那样）你没事！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-30T20:15:10.963

正如其他人所说，VS 是一个 32 位应用程序，因此虽然它在 64 位操作系统上运行良好，但它只能通过“神奇”镜像窗口提供的“神奇”镜像窗口看到注册表和部分文件系统。

唯一一次对我们来说是个问题是当我们尝试在 .NET 应用程序中添加对 COM dll 的引用时。COM dll 没有出现在引用对话框中，因为它仅注册为 64 位 DLL。为此，我们必须注册 32 位版本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-25T12:41:09.767

唯一的缺点是如果您想在 Vista x64 上使用 SQL Express Management Studio。我的速度非常慢，我找不到任何与原因相关的答案！

编辑：

没关系，我在打字时遇到了问题。

Vista 具有 TCP/IP 自动调整功能。通过遵循本教程： http: [//www.vistax64.com/tutorials/72308-auto-tuning-tcp-ip-receive-level.html](http://www.vistax64.com/tutorials/72308-auto-tuning-tcp-ip-receive-level.html)我禁用了它，现在一切都像梦一样运行！

# javascript - 后续 AJAX 调用之间的最短时间

> ID：251463
> 
> 赞同：2
> 
> 时间：2008-10-30T19:37:59.087
> 
> 标签：javascript, html, ajax

在需要定期轮询服务器的 AJAX 应用程序（如聊天应用程序）中，建议两次调用之间的最短时间是多少，以便尽快完成更新？什么时间被认为是服务器和客户端的猪？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T19:42:31.137

这个问题的答案很大程度上取决于：

1.  每次轮询发送多少数据
2.  您一次将有多少用户在线
3.  您的服务器可以处理多少带宽
4.  客户上的数据需要多“新鲜”

如果不了解您的应用程序的任何这些细节，就很难给出好的建议。您是否研究过客户端连接到服务器的方法，并且服务器保持连接打开直到有可用数据？然后服务器传递数据，客户端立即重新连接并再次等待。这可能很难开始工作，但您可以通过这种方式最大限度地提高带宽效率和响应能力。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T23:49:59.187

我们在聊天中有不同的 AJAX 轮询解决方案：

请求被发送到服务器，并以非常短的延迟间隔（如 0.5 秒）循环轮询*服务器端的数据。*一个数据被获取，请求返回。然后下一个请求立即发送到服务器。所有请求的超时设置为 60 秒，当它过期而没有获取数据时，下一个请求将替换它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T19:43:50.730

这取决于应用程序，但对于聊天，您可能想要经常轮询 - 我会说 1 到 4 秒。您可以做的是动态更改轮询间隔以减少服务器负载 - 如果一分钟内没有人说任何话，则增加到 10 秒......在 5 分钟后增加到 30 秒 - 诸如此类。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T19:43:51.447

除了您希望给服务器负载带来负担的同时用户数量之外，没有真正的限制。您可以通过跟踪平均响应时间在客户端动态调整它。

为了正确地做到这一点，在一个不错的负载下，你赌注使用[Comet](http://en.wikipedia.org/wiki/Comet_(programming))。

# python - 如何将函数名作为字符串获取？

> ID：251464
> 
> 赞同：950
> 
> 时间：2008-10-30T19:38:24.750
> 
> 标签：python, string, function

在 Python 中，如何在不调用函数的情况下将函数名作为字符串获取？

```
def my_function():
    pass

print get_function_name_as_string(my_function) # my_function is not in quotes 
```

应该输出`"my_function"`。

Python中有这样的功能吗？如果没有，关于如何`get_function_name_as_string`在 Python 中实现 , 的任何想法？

* * *

## 回答 #1

> 赞同：1235
> 
> 时间：2008-11-01T00:07:17.713

```
my_function.__name__ 
```

使用`__name__`是首选方法，因为它适用于统一。与 不同`func_name`的是，它也适用于内置函数：

```
>>> import time
>>> time.time.func_name
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
AttributeError: 'builtin_function_or_method' object has no attribute 'func_name'
>>> time.time.__name__ 
'time' 
```

双下划线也向读者表明这是一个特殊属性。作为奖励，类和模块也有一个`__name__`属性，所以你只需要记住一个特殊的名称。

* * *

## 回答 #2

> 赞同：363
> 
> 时间：2012-11-22T13:59:49.493

要从其中获取当前函数或方法的名称，请考虑：

```
import inspect

this_function_name = inspect.currentframe().f_code.co_name 
```

`sys._getframe`也可以代替`inspect.currentframe`尽管后者避免访问私有函数。

要改为获取调用函数的名称，请考虑`f_back`在`inspect.currentframe().f_back.f_code.co_name`.

* * *

如果还使用`mypy`，它可能会抱怨：

> 错误：“Optional[FrameType]”的项目“None”没有属性“f_code”

要抑制上述错误，请考虑：

```
import inspect
import types
from typing import cast

this_function_name = cast(types.FrameType, inspect.currentframe()).f_code.co_name 
```

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2008-10-30T19:39:19.740

```
my_function.func_name 
```

函数还有其他有趣的属性。键入`dir(func_name)`以列出它们。`func_name.func_code.co_code`是编译后的函数，存储为字符串。

```
import dis
dis.dis(my_function) 
```

将以*几乎*人类可读的格式显示代码。:)

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2017-11-07T10:48:04.037

如果你也对类方法感兴趣，Python 3.3+`__qualname__`除了`__name__`.

```
def my_function():
    pass

class MyClass(object):
    def method(self):
        pass

print(my_function.__name__)         # gives "my_function"
print(MyClass.method.__name__)      # gives "method"

print(my_function.__qualname__)     # gives "my_function"
print(MyClass.method.__qualname__)  # gives "MyClass.method" 
```

* * *

## 回答 #5

> 赞同：36
> 
> 时间：2013-12-21T00:59:58.403

该函数将返回调用者的函数名。

```
def func_name():
    import traceback
    return traceback.extract_stack(None, 2)[0][2] 
```

这就像 Albert Vonpupp 用一个友好的包装回答。

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2019-03-20T03:49:32.903

```
import inspect

def foo():
   print(inspect.stack()[0][3]) 
```

在哪里

*   `stack()[0]`是来电者

*   `stack()[3]`是方法的字符串名称

* * *

## 回答 #7

> 赞同：28
> 
> 时间：2016-07-19T08:37:30.777

我喜欢使用函数装饰器。我添加了一个类，它也对函数时间进行计时。假设 gLog 是一个标准的 python 记录器：

```
class EnterExitLog():
    def __init__(self, funcName):
        self.funcName = funcName

    def __enter__(self):
        gLog.debug('Started: %s' % self.funcName)
        self.init_time = datetime.datetime.now()
        return self

    def __exit__(self, type, value, tb):
        gLog.debug('Finished: %s in: %s seconds' % (self.funcName, datetime.datetime.now() - self.init_time))

def func_timer_decorator(func):
    def func_wrapper(*args, **kwargs):
        with EnterExitLog(func.__name__):
            return func(*args, **kwargs)

    return func_wrapper 
```

所以现在你所要做的就是装饰它，瞧

```
@func_timer_decorator
def my_func(): 
```

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2018-03-16T14:21:11.507

您只想获取函数的名称，这是一个简单的代码。假设您定义了这些功能

```
def function1():
    print "function1"

def function2():
    print "function2"

def function3():
    print "function3"
print function1.__name__ 
```

输出将是**function1**

现在假设您在列表中有这些功能

```
a = [function1 , function2 , funciton3] 
```

获取函数的名称

```
for i in a:
    print i.__name__ 
```

输出将是

**功能**
**1 功能2**
**功能3**

* * *

## 回答 #9

> 赞同：19
> 
> 时间：2016-03-25T21:21:23.133

作为[@Demyn 答案](https://stackoverflow.com/a/20714270/109941)的扩展，我创建了一些实用函数，它们打印当前函数的名称和当前函数的参数：

```
import inspect
import logging
import traceback

def get_function_name():
    return traceback.extract_stack(None, 2)[0][2]

def get_function_parameters_and_values():
    frame = inspect.currentframe().f_back
    args, _, _, values = inspect.getargvalues(frame)
    return ([(i, values[i]) for i in args])

def my_func(a, b, c=None):
    logging.info('Running ' + get_function_name() + '(' + str(get_function_parameters_and_values()) +')')
    pass

logger = logging.getLogger()
handler = logging.StreamHandler()
formatter = logging.Formatter(
    '%(asctime)s [%(levelname)s] -> %(message)s')
handler.setFormatter(formatter)
logger.addHandler(handler)
logger.setLevel(logging.INFO)

my_func(1, 3) # 2016-03-25 17:16:06,927 [INFO] -> Running my_func([('a', 1), ('b', 3), ('c', None)]) 
```

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2013-08-31T00:34:37.407

`sys._getframe()`不保证在 Python 的所有实现中都可用（[参见 ref](http://docs.python.org/2/library/sys.html)），您可以使用该`traceback`模块来做同样的事情，例如。

```
import traceback
def who_am_i():
   stack = traceback.extract_stack()
   filename, codeline, funcName, text = stack[-2]

   return funcName 
```

调用`stack[-1]`将返回当前进程的详细信息。

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2019-10-24T19:46:38.177

我已经看到了一些使用装饰器的答案，尽管我觉得有些答案有点冗长。这是我用来记录函数名称以及它们各自的输入和输出值的东西。我在此处对其进行了调整，以仅打印信息而不是创建日志文件，并将其调整为适用于 OP 特定示例。

```
def debug(func=None):
    def wrapper(*args, **kwargs):
        try:
            function_name = func.__func__.__qualname__
        except:
            function_name = func.__qualname__
        return func(*args, **kwargs, function_name=function_name)
    return wrapper

@debug
def my_function(**kwargs):
    print(kwargs)

my_function() 
```

输出：

```
{'function_name': 'my_function'} 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2020-12-02T15:03:01.853

```
import inspect

def my_first_function():
    func_name = inspect.stack()[0][3]
    print(func_name)  # my_first_function 
```

或者：

```
import sys

def my_second_function():
    func_name = sys._getframe().f_code.co_name
    print(func_name)  # my_second_function 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2020-09-12T06:09:24.023

尝试

```
import sys
fn_name = sys._getframe().f_code.co_name 
```

进一步参考 [https://www.oreilly.com/library/view/python-cookbook/0596001673/ch14s08.html](https://www.oreilly.com/library/view/python-cookbook/0596001673/ch14s08.html)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-02-05T23:24:06.750

`__name__`您可以使用特殊变量将函数的名称作为字符串获取。

```
def my_function():
    pass

print(my_function.__name__) # prints "my_function" 
```

# javascript - 如何在jQuery中引用表单中的输入

> ID：251466
> 
> 赞同：2
> 
> 时间：2008-10-30T19:38:30.537
> 
> 标签：javascript, jquery, ajax

一个简单的 jQuery 问题。

我在一页上有几个相同的表格（除了他们的名字），每个表格都有一些隐藏的输入。我想通过使用表单名称和输入名称来引用它们。（输入名称在我的页面中不是唯一的）

例如：

```
var xAmt = $('#xForm'+num).('#xAmt'); 
```

我真的很想将这些值提供给 AJAX POST

```
 $.ajax({
      url: "X.asp",
      cache: false,
      type:  "POST",
      data:  "XID=xID&xNumber=xNum&xAmt=xAmt", 
```

...

如果我能更好地获得 AJAX 调用中的值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T20:23:20.447

```
function queryX( args ) {
    var queryString = [ "XID=", args.XID, "&xNumber=", args.xNumber, "&xAmt=", args.xAmt ].join("");
    $.ajax({
        url: "X.asp",
        cache: false,
        type:  "POST",
        data:  queryString,
        success : function( data ) {
            return data;
        }
    });
}
var myReturnData = queryX({
    XID : $("input[name='XID']").val(),
    xNumber : $("input[name='xNumber']").val(),
    xAmt : $("input[name='xAmt']").val()
}); 
```

**编辑：**

这为您提供了最大的灵活性，如果只有输入值会改变（但查询字符串变量不会），那么您可以传入任何您想要的值作为值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T19:53:06.937

看起来你想要`formSerialize()`（甚至`ajaxSubmit()`）从[jQuery 表单插件](http://docs.jquery.com/Plugins:Forms#formSerialize.28.29)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T02:42:00.060

执行此操作的灵活方法已在此处得到解答，但您也可以使其与当前代码一起使用。（如果这对于您正在寻找的东西来说太基本了，请原谅我。）

使用 CSS 后代选择器（空格）从唯一的表单名称向下钻取：

```
var xAmt = $('#xForm'+num+ ' #xAmt').val(); 
```

对您需要的每个值重复并调用 $.ajax 就像您正在做的那样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T20:15:14.987

**编辑：**

您需要先将它们全部选中，然后才能使用它们。

要仅访问 xForm# 元素，您可以执行这样的选择器（您应该检查语法，我没有运行它，这只是一个示例）：

```
$('form input[name*='xAmt']  ').each(function(){ alert( $(this).val() ); alert( $(this).parent().attr('name') + $(this).parent().attr('id') ); }); 
```

表单 input[name*='xAmt'] 表示选择表单内包含术语 xAmt 的任何元素。您也可以开始于、结束于等。请参阅下面的链接。

在每个循环中，您可以将每个循环作为 $(this) 访问。您可以通过 $(this).parent() 访问它的父表单，因此您可以知道输入在哪个表单中。

您可能会在循环中构建数据，或者对它们执行其他操作，然后发布。

看：

[http://docs.jquery.com/Selectors/attributeContains#attributevalue](http://docs.jquery.com/Selectors/attributeContains#attributevalue)

[http://docs.jquery.com/Selectors](http://docs.jquery.com/Selectors)

[http://docs.jquery.com/Each](http://docs.jquery.com/Each)

[http://docs.jquery.com/Attributes/attr#name](http://docs.jquery.com/Attributes/attr#name)

[http://docs.jquery.com/Traversing/parent#expr](http://docs.jquery.com/Traversing/parent#expr)

# c# - 如何从 C# 中的图像目录创建视频？

> ID：251467
> 
> 赞同：14
> 
> 时间：2008-10-30T19:38:35.263
> 
> 标签：c#, directshow, media, multimedia, wmv

我有一个尺寸相同的位图目录。我想将这些位图转换成视频文件。我不在乎视频文件（编解码器）是 wmv 还是 avi。我唯一的要求是我指定帧速率。这不需要是跨平台的，仅适用于 Windows（Vista 和 XP）。我已经阅读了一些关于使用 Windows Media SDK 或 DirectShow 的内容，但没有一篇关于提供代码示例的明确说明。

任何人都可以提供一些见解或一些有价值的资源来帮助我在 C# 中做到这一点吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-30T21:31:16.160

冒着被否决的风险，我将提供一个可能的替代选项——缓冲位图动画。

```
double framesPerSecond;
Bitmap[] imagesToDisplay;     // add the desired bitmaps to this array
Timer playbackTimer;

int currentImageIndex;
PictureBox displayArea;

(...)

currentImageIndex = 0;
playbackTimer.Interval = 1000 / framesPerSecond;
playbackTimer.AutoReset = true;
playbackTimer.Elapsed += new ElapsedEventHandler(playbackNextFrame);
playbackTimer.Start();

(...)

void playbackNextFrame(object sender, ElapsedEventArgs e)
{
    if (currentImageIndex + 1 >= imagesToDisplay.Length)
    {
            playbackTimer.Stop();

            return;
    }

    displayArea.Image = imagesToDisplay[currentImageIndex++];
} 
```

如果查看用户可以访问图像、有足够的资源将图像保存在内存中、不想等待视频编码并且可能需要不同的播放速度，则这种方法很有效。

......只是把它扔在那里。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-14T12:17:04.657

您可以使用[Splicer](http://www.codeplex.com/splicer)来执行此操作。

请参阅[http://www.codeplex.com/splicer/Wiki/View.aspx?title=News%20Feeds&referringTitle=Home上的示例 3](http://www.codeplex.com/splicer/Wiki/View.aspx?title=News%20Feeds&referringTitle=Home)

编辑：

```
using (ITimeline timeline = new DefaultTimeline(25))
{
    IGroup group = timeline.AddVideoGroup(32, 160, 100);

    ITrack videoTrack = group.AddTrack();
    IClip clip1 = videoTrack.AddImage("image1.jpg", 0, 2);
    IClip clip2 = videoTrack.AddImage("image2.jpg", 0, 2);
    IClip clip3 = videoTrack.AddImage("image3.jpg", 0, 2);
    IClip clip4 = videoTrack.AddImage("image4.jpg", 0, 2);

    double halfDuration = 0.5;

    group.AddTransition(clip2.Offset - halfDuration, halfDuration, StandardTransitions.CreateFade(), true);
    group.AddTransition(clip2.Offset, halfDuration, StandardTransitions.CreateFade(), false);

    group.AddTransition(clip3.Offset - halfDuration, halfDuration, StandardTransitions.CreateFade(), true);
    group.AddTransition(clip3.Offset, halfDuration, StandardTransitions.CreateFade(), false);

    group.AddTransition(clip4.Offset - halfDuration, halfDuration, StandardTransitions.CreateFade(), true);
    group.AddTransition(clip4.Offset, halfDuration, StandardTransitions.CreateFade(), false);

    ITrack audioTrack = timeline.AddAudioGroup().AddTrack();

    IClip audio =
        audioTrack.AddAudio("soundtrack.wav", 0, videoTrack.Duration);

    audioTrack.AddEffect(0, audio.Duration,
                        StandardEffects.CreateAudioEnvelope(1.0, 1.0, 1.0, audio.Duration));

    using (
        WindowsMediaRenderer renderer =
            new WindowsMediaRenderer(timeline, "output.wmv", WindowsMediaProfiles.HighQualityVideo))
    {
        renderer.Render();
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T20:39:11.740

您可以使用 avifil32 库中的 AVI*，这里有一个示例（未尝试）： http:
[//www.adp-gmbh.ch/csharp/mandelbrot/index.html](http://www.adp-gmbh.ch/csharp/mandelbrot/index.html)

您可能对此感兴趣： http:
[//bytescout.com/swfslideshowscout_example_c_sharp.html](http://bytescout.com/swfslideshowscout_example_c_sharp.html)
（使用 C# 从 JPG 图像制作 Flash 幻灯片）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-31T09:24:35.643

[FFMPEG 可以轻松做到这一点。](https://stackoverflow.com/questions/93954/how-to-programatically-create-videos#94485)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-31T12:18:47.630

实现您想要的理想技术是[DirectShow 编辑服务](http://msdn.microsoft.com/en-us/library/ms783329(VS.85).aspx)。但是，如果这是一个一次性项目，那么我不会打扰 - 学习曲线可能非常陡峭。

尽管在 MSDN 内外都有大量通用的 DirectShow 示例，但可用的 DES 示例代码的方式并不多。出于您的目的，我建议您从[这里](http://msdn.microsoft.com/en-us/library/ms787453(VS.85).aspx)开始，了解使用静止图像作为视频源的基本说明。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-31T09:01:42.007

我还没有尝试过，但[Windows Movie Maker](http://msdn.microsoft.com/en-us/library/bb469712(VS.85).aspx)有一个 API，以及您可以使用的 XML 文件格式。

# mysql - 在 mysql 表 auto_increment 中创建一个 ID（事后）

> ID：251479
> 
> 赞同：61
> 
> 时间：2008-10-30T19:41:26.193
> 
> 标签：mysql, primary-key, auto-increment

我从另一个开发人员那里获得了一个数据库。他没有在任何表上使用 auto_incrementers。它们都有主键 ID，但他在代码中手动完成了所有递增操作。

我现在可以把它们变成 Auto_incrementers 吗？

* * *

哇，非常好，非常感谢。它在我的一张桌子上运行顺利。但是第二张表，我收到此错误...将 '.\DBNAME#sql-6c8_62259c' 重命名为 '.\DBNAME\dealer_master_events' 时出错

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2008-10-30T20:24:01.460

例如，这是一个具有主键但没有主键的表`AUTO_INCREMENT`：

```
mysql> CREATE TABLE foo (
  id INT NOT NULL,
  PRIMARY KEY (id)
);
mysql> INSERT INTO foo VALUES (1), (2), (5); 
```

您可以使用以下选项`MODIFY`重新定义该列：`AUTO_INCREMENT`

```
mysql> ALTER TABLE foo MODIFY COLUMN id INT NOT NULL AUTO_INCREMENT; 
```

验证这是否已生效：

```
mysql> SHOW CREATE TABLE foo; 
```

输出：

```
CREATE TABLE foo (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=6 DEFAULT CHARSET=latin1 
```

请注意，您已就地修改了列定义，而无需创建第二列并删除原始列。约束不受影响，`PRIMARY KEY`您无需在`ALTER TABLE`声明中提及。

接下来，您可以测试插入是否生成新值：

```
mysql> INSERT INTO foo () VALUES (); -- yes this is legal syntax
mysql> SELECT * FROM foo; 
```

输出：

```
+----+
| id |
+----+
|  1 | 
|  2 | 
|  5 | 
|  6 | 
+----+
4 rows in set (0.00 sec) 
```

我在 Mac OS X 上的 MySQL 5.0.51 上对此进行了测试。

我还测试了`ENGINE=InnoDB`一个依赖表。修改`id`列定义不会中断参照完整性。

* * *

要响应您在评论中提到的错误 150，它可能与外键约束冲突。我很抱歉，在我测试它之后，我认为它会起作用。以下是一些可能有助于诊断问题的链接：

*   [mysql error 1025 (HY000): Error on rename of './foo' (errorno: 150) 是什么意思？](https://stackoverflow.com/questions/160233/what-does-mysql-error-1025-hy000-error-on-rename-of-foo-errorno-150-mean)
*   [http://www.simplicidade.org/notes/archives/2008/03/mysql_errno_150.html](http://www.simplicidade.org/notes/archives/2008/03/mysql_errno_150.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-30T20:11:19.443

我猜您不需要重新增加现有数据，为什么您不能运行一个简单的 ALTER TABLE 命令来更改 PK 的属性？

就像是：

```
ALTER TABLE `content` CHANGE `id` `id` SMALLINT( 5 ) UNSIGNED NOT NULL AUTO_INCREMENT 
```

我已经在我自己的 MySQL 数据库上测试了这段代码，它可以工作，但我没有用任何有意义的记录尝试它。更改行后，您需要将增量重置为保证不会干扰任何其他记录的数字。

```
ALTER TABLE `content` auto_increment = MAX(`id`) + 1 
```

同样，未经测试，但我相信它会起作用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-01-12T19:31:33.970

以上都不适用于我的桌子。我有一个无符号整数作为主键的表，其值范围从 0 到 31543。目前有超过 19000 条记录。我不得不将列修改为`AUTO_INCREMENT`( `MODIFY COLUMN`'id' ) 并在同一语句中`INTEGER UNSIGNED NOT NULL AUTO_INCREMENT`设置种子 ( )。`AUTO_INCREMENT = 31544`

```
ALTER TABLE `'TableName'` MODIFY COLUMN `'id'` INTEGER UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT = 31544; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-02-21T21:34:00.430

这对我有用（我想让 id 成为主要并设置自动增量）

ALTER TABLE `table_name`CHANGE `id` `id`INT PRIMARY KEY AUTO_INCREMENT;

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-04-12T15:55:44.280

```
ALTER TABLE `foo` MODIFY COLUMN `bar_id` INT NOT NULL AUTO_INCREMENT; 
```

或者

```
ALTER TABLE `foo` CHANGE `bar_id` `bar_id` INT UNSIGNED NOT NULL AUTO_INCREMENT; 
```

但是如果你是另一个表中的外键，这些都不起作用`bar_id`：你会得到

```
an error 1068: Multiple primary key defined 
```

为了解决这个问题，临时禁用外键约束检查

```
set foreign_key_checks = 0; 
```

并在运行上述语句后，再次启用它们。

```
set foreign_key_checks = 1; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T19:55:38.210

是的，很容易。只需运行数据定义查询来更新表，添加一个 AUTO_INCREMENT 列。

如果您有一个现有的数据库，请注意保留“人为创建的”主键上可能已经存在的任何外键关系。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-30T19:54:40.927

只要您在当前 PK 中有唯一整数（或某些唯一值），您就可以创建一个新表，并使用 IDENTITY INSERT ON 插入其中。然后删除旧表，并重命名新表。

不要忘记重新创建任何索引。

# sql-server - 如何在启用镜像的情况下缩小 SQL Server 日志文件？

> ID：251480
> 
> 赞同：5
> 
> 时间：2008-10-30T19:41:34.183
> 
> 标签：sql-server

我有几个数据库用于我的应用程序，它们使用 SQL Server 2005 镜像在其他地方保存一份不错的数据副本。就像一个魅力，然而，日志文件似乎在不断增长，一个 15GB 的 3GB 数据库。

通常情况下，我可以缩小它 - 但是会弹出一个错误，表明这是无法完成的。但是，如果未选中最终会扩展以使用驱动器上的所有空间。

我看到我可以为日志文件设置最大文件大小，这就是答案吗？日志会在达到最大值时滚动，还是数据库会停止运行？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-11-09T02:44:36.680

从日志传送切换到镜像后，我们遇到了同样的问题。您必须创建一个定期备份事务日志（每 15 或 30 分钟左右）的作业，以防止日志大小失控。

如果它已经失控，请运行 BACKUP LOG TO DISK = 'Nul'，然后运行 ​​DBCC SHRINKFILE 命令。然后你就可以开始你的工作了。

请注意，“Nul”不是拼写错误，它是一种旧的 DOS 技巧，其行为就像您正在编写文件一样，但实际上只是将信息转储到以太网中，因此它不会占用机器上的空间。

此外，您的日志会一直增长，直到您的空间用完，然后整个事情都停止工作。您的应用将收到事务日志已满的错误。

编辑：大卫正确地指出，这个动作会破坏日志链并降低从失败中恢复的能力。务必使用备份日志到 'nul' 命令作为最后的手段。如果驱动器上有空间，则应进行适当的日志备份并设置日志备份计划。确保您还包括定期完整备份和清理任务以删除旧文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T03:49:14.177

我会看看你的日志文件为什么会增长，然后你可以定义一个策略来解决你的问题。检查您的镜像状态可能值得

当主体数据库公开时，它会通过用户连接和处理事务处于活动状态。但是，没有日志记录被发送到镜像数据库，并且如果主体失败，则从主体进入暴露状态的那一刻起，镜像将没有来自主体的任何事务。此外，主体的事务日志不能被截断，因此日志文件将无限增长。参考[http://www.microsoft.com/technet/prodtechnol/sql/2005/dbmirror.mspx](http://www.microsoft.com/technet/prodtechnol/sql/2005/dbmirror.mspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-03T10:04:54.850

我在镜像数据库上遇到了同样的问题，日志文件增长了 40GB，而主 Db 文件大约为 700 Mb

1-只需执行此操作即可创建存储过程

```
 use master
   go
   if object_id ('sp_shrink_mirrored_database', 'P') is not null 
     drop proc sp_shrink_mirrored_database 
   go
   create procedure sp_shrink_mirrored_database @dbname sysname, @target_percent int = null
   as
   begin
     declare @filename sysname
     declare @filesize int
     declare @sql nvarchar(4000)

     if @target_percent is null
       dbcc shrinkdatabase (@dbname)
     else 
       dbcc shrinkdatabase (@dbname, @target_percent)
     declare c cursor for 
     select [name], [size] from sys.master_files where type=0 and database_id = db_id (@dbname)
     open c
     fetch next from c into @filename, @filesize
     while @@fetch_status=0
     begin
       set @filesize=(@filesize+1)*8
       set @sql='alter database [' + @dbname + '] modify file ( name=' 
         + @filename + ', size=' + cast(@filesize as nvarchar) + 'kb )'
       execute sp_executesql @sql
       fetch next from c into @filename, @filesize
     end
     close c
     deallocate c
   end
   go 
```

2-在新的查询窗口中执行这样的存储过程例如，如果要收缩mydb数据库，请运行以下语句。

```
 EXEC sp_shrink_mirrored_database 'mydb' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T21:51:35.590

可以在这里找到一些好主意：[http://yukonspace ... transaction-log-growth](http://yukonspace.blogspot.com/2007/12/transaction-log-growth.html)。

根据我对完全恢复模式数据库的经验（应该以某种类似的方式表现），您至少需要定期进行完全备份，否则日志只会增长。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-18T09:01:50.837

[http://support.microsoft.com/kb/937531](http://support.microsoft.com/kb/937531)

> ### 在 SQL Server 2005 中使用数据库镜像时，镜像数据库上不会重复收缩操作
> 
> 原因
> 数据库镜像仅在检查点之后才会更改物理文件大小。
> 
> 替代
> **方法 方法 1**
> 若要解决此问题，请运行以下语句在 master 数据库中创建一个新的存储过程。然后，使用此存储过程来收缩主体数据库，而不是运行 DBCC SHRINKDATABASE 语句或 DBCC SHRINKFILE 语句。
> *[存储过程太长，无法在此处发布]*
> 
> **方法 2**
> 在压缩主体上的文件后发出手动检查点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-09T13:26:16.163

你确定镜子没有落后吗？主体服务器实例在成功应用到镜像之前无法截断日志。在某一点之后，我相信您可能必须备份事务日志并将其应用于镜像并重新启动镜像。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-14T09:46:59.973

要缩小事务文件，必须执行备份，因为有活动虚拟日志文件： [http ://www.xoowiki.com/Article/SQL-Server/tronquer-journal-de-log-sur-base-en-miroir-499 .aspx](http://www.xoowiki.com/Article/SQL-Server/tronquer-journal-de-log-sur-base-en-miroir-499.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-06-21T14:34:38.120

1.  您必须定期备份日志，否则您的日志文件将无限增长。如果您无法写入日志（即磁盘空间不足或达到最大大小），数据库将失败
2.  SQL Server 2005 存在缩小未反映在镜像端的问题。解决方案在这里 [http://support.microsoft.com/kb/937531](http://support.microsoft.com/kb/937531)

This article有一些关于[日志文件如何](http://technet.microsoft.com/en-us/library/ms178037.aspx)工作的好信息，您还应该阅读[可以延迟日志截断的因素](http://technet.microsoft.com/en-us/library/ms345414.aspx)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-31T11:32:08.427

只需使用以下命令即可缩小日志文件

```
USE DBNAME
GO
DBCC SHRINKFILE(DBNAME_log, 1)
BACKUP LOG DBNAME WITH TRUNCATE_ONLY
DBCC SHRINKFILE(DBNAME_log, 1)
GO 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-11-13T04:52:58.370

配置事务日志备份并创建作业或直接运行以下命令。

```
use DatabaseName
GO
DBCC SHRINKFILE (LogicalFileName_log, 1);
GO 
```

如果要缩小数据文件，请按照以下步骤操作。

1.  转到您的数据库属性。
2.  选择左侧的选项。
3.  将 auto Shrink 属性更改为 true，默认为 false。

并等待 sql server 自动收缩它。

我希望它能解决日志和数据文件收缩问题。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2013-11-04T00:09:56.707

请确保在使用 TRUNCATE_ONLY 执行日志备份后执行完整备份。这会破坏日志备份链。

# vb.net - 在 VB.NET 中进行铸造

> ID：251482
> 
> 赞同：14
> 
> 时间：2008-10-30T19:42:36.800
> 
> 标签：vb.net, casting, ctype

我希望能够在仅在运行时知道类型的情况下动态转换一个值。像这样的东西：

```
myvalue = CType(value, "String, Integer or Boolean") 
```

包含类型值的字符串作为参数传递，也从数据库中读取，值作为字符串存储在数据库中。

这可能吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-30T20:14:05.193

```
 Dim bMyValue As Boolean
 Dim iMyValue As Integer
 Dim sMyValue As String 
 Dim t As Type = myValue.GetType

 Select Case t.Name
     Case "String"
        sMyValue = ctype(myValue, string)
     Case "Boolean"
        bMyValue = ctype(myValue, boolean)
     Case "Integer"
        iMyValue = ctype(myValue, Integer)
 End Select 
```

这有点hacky，但它有效。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-30T19:49:45.430

当然可以，但`myvalue`必须定义为 type `Object`，你不一定想要这样。也许这是一个由泛型更好地服务的案例。

什么决定了将使用什么类型？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-30T20:10:06.200

这是最短的方法。我已经用多种类型对其进行了测试。

```
Sub DoCast(ByVal something As Object)

    Dim newSomething = Convert.ChangeType(something, something.GetType())

End Sub 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-30T19:52:28.340

那么，您如何确定需要哪种类型？正如乔尔所说，这可能是泛型的情况。问题是：由于您在编译时不知道类型，因此无论如何都不能处理返回的值，因此在这里强制转换没有意义。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T20:03:36.760

也许您可以使用反射来代替动态投射某些东西（这似乎不起作用）。获取和调用特定的方法或属性很容易。

```
Dim t As Type = testObject.GetType()
Dim prop As PropertyInfo = t.GetProperty("propertyName")
Dim gmi As MethodInfo = prop.GetGetMethod()
gmi.Invoke(testObject, Nothing) 
```

它并不漂亮，但您可以在一行中完成其中的一些操作，而不是这么多。

# php - PHP中的动态类方法调用

> ID：251485
> 
> 赞同：104
> 
> 时间：2008-10-30T19:43:40.387
> 
> 标签：php

有没有办法为 PHP 动态调用同一类中的方法？我没有正确的语法，但我想做类似的事情：

```
$this->{$methodName}($arg1, $arg2, $arg3); 
```

* * *

## 回答 #1

> 赞同：200
> 
> 时间：2008-10-30T19:50:54.850

有不止一种方法可以做到这一点：

```
$this->{$methodName}($arg1, $arg2, $arg3);
$this->$methodName($arg1, $arg2, $arg3);
call_user_func_array(array($this, $methodName), array($arg1, $arg2, $arg3)); 
```

您甚至可以使用反射 API [http://php.net/manual/en/class.reflection.php](http://php.net/manual/en/class.reflection.php)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2017-01-06T21:11:35.197

您可以使用 PHP 中的重载： [重载](http://php.net/manual/en/language.oop5.overloading.php)

```
class Test {

    private $name;

    public function __call($name, $arguments) {
        echo 'Method Name:' . $name . ' Arguments:' . implode(',', $arguments);
        //do a get
        if (preg_match('/^get_(.+)/', $name, $matches)) {
            $var_name = $matches[1];
            return $this->$var_name ? $this->$var_name : $arguments[0];
        }
        //do a set
        if (preg_match('/^set_(.+)/', $name, $matches)) {
            $var_name = $matches[1];
            $this->$var_name = $arguments[0];
        }
    }
}

$obj = new Test();
$obj->set_name('Any String'); //Echo:Method Name: set_name Arguments:Any String
echo $obj->get_name();//Echo:Method Name: get_name Arguments:
                      //return: Any String 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-30T19:46:34.873

只需省略大括号：

```
$this->$methodName($arg1, $arg2, $arg3); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-30T19:51:01.543

您还可以使用`call_user_func()`和`call_user_func_array()`

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-30T19:52:17.343

如果您在 PHP 中的一个类中工作，那么我建议您使用 PHP5 中的重载 __call 函数。您可以在[此处](http://us.php.net/manual/en/language.oop5.overloading.php)找到参考。

基本上 __call 对动态函数的作用就像 __set 和 __get 对 OO PHP5 中的变量一样。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-16T11:58:27.303

就我而言。

```
$response = $client->{$this->requestFunc}($this->requestMsg); 
```

使用 PHP SOAP。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-11-26T11:59:32.603

您可以使用闭包将方法存储在单个变量中：

```
class test{        

    function echo_this($text){
        echo $text;
    }

    function get_method($method){
        $object = $this;
        return function() use($object, $method){
            $args = func_get_args();
            return call_user_func_array(array($object, $method), $args);           
        };
    }
}

$test = new test();
$echo = $test->get_method('echo_this');
$echo('Hello');  //Output is "Hello" 
```

编辑：我已经编辑了代码，现在它与 PHP 5.3 兼容。[这里的](https://stackoverflow.com/a/27149017/428640)另一个例子

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-01-26T22:23:50.800

这么多年了还有效！如果它是用户定义的内容，请确保修剪 $methodName。在我注意到它有一个前导空格之前，我无法让 $this->$methodName 工作。

# algorithm - 堆叠矩形以尽可能少地占用空间

> ID：251488
> 
> 赞同：14
> 
> 时间：2008-10-30T19:43:46.550
> 
> 标签：algorithm, math

我有一个程序可以计算将矩形拟合在一起所占用的最小面积。

输入：不同高度和宽度的矩形。
输出：一个包含所有这些矩形的矩形。
规则：一个人不能转动或滚动矩形，它们不能重叠。

我知道这是相关的或可能被定义为装箱问题（NP-hard）。然而，我为那些找到的算法通常会限制例如宽度。我没有这样的限制，唯一的目标是使生成的区域尽可能小。

关于什么算法适合获得一个体面的解决方案的任何指针？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T20:42:04.933

[http://www-rcf.usc.edu/~skoenig/icaps/icaps04/icapspapers/ICAPS04KorfR.pdf](http://www-rcf.usc.edu/~skoenig/icaps/icaps04/icapspapers/ICAPS04KorfR.pdf)

显然，这个问题比最初看起来要难。这是一个有趣的算法，因为它首先猜测一个解决方案，然后对其进行改进，所以如果您不想等待最佳解决方案，您可以运行它进行一定次数的迭代以获得近似解决方案（越长你运行它，近似值越好）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T20:35:01.967

我建议从一个简单的贪婪方法开始，看看这是否足以满足您的需求。如果您的输入表现良好或很小，这可能就是您所需要的——当您尝试做一些更复杂的事情时，复杂性会迅速上升。

例如：按大小对矩形进行排序，最大的在前。一次添加一个矩形，尝试新矩形的每个可能位置。选择导致最小边界框的位置。

另一种贪婪的方法是选择一个起始矩形，然后重复添加导致最密集排列的矩形（其中密度定义为边界框被填充区域的百分比）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T19:50:28.097

我会先浏览一下[http://mathworld.wolfram.com](http://mathworld.wolfram.com) - 他们非常适合这样的东西。

其次，我可以设想一个愚蠢的算法，它将最长（在 X 维度中）的框放在底部，然后将最高的（在 Y 维度中）放在它的一侧或另一侧的顶部。然后继续以这种“阶梯式”的方式将它们向右和向上堆叠（例如向右移动直到你不能，然后向上等等）。

这可能是不理想的，并且很可能会给您带来不好的结果，但这是首先想到的。

# java - EJB3 业务逻辑模式和实践

> ID：251493
> 
> 赞同：6
> 
> 时间：2008-10-30T19:44:10.323
> 
> 标签：java, jpa, jakarta-ee, ejb-3.0, stateless-session-bean

我正在使用 EJB3（Hibernate + Glassfish 用于应用程序和 Web 服务层，Lift on Glassfish 用于 Web UI）在 Java 中开发多层金融处理应用程序，我正在努力解决在哪里的问题把我的业务逻辑。

当这个项目开始时，我们的第一个想法是将大部分业务逻辑放入无状态会话 bean。然而，随着时间的推移，我们发现 EJB 框架提供的依赖注入过于局限，所以我们的很多业务逻辑最终都在由 Guice 在无状态会话 bean 的 @PostConstruct 方法中组装的 POJO 中. 这一进展导致我们在会话 bean 和 POJO 之间的业务逻辑碎片化，我正在尝试找出一种方法来纠正这个问题。

最初，我们尝试让 Web 层使用会话 bean 的远程接口来执行一些可以从 UI 和 Web 服务层访问的功能，这些功能由 @WebService 注释的无状态会话 bean 提供。从持久性和性能的角度来看，这被证明是一场噩梦，因为我们的实体图可能会变得非常大，并且将分离的实体图重新附加到持久性上下文中非常容易出错，所以我们的解决方案是从传递对象开始周围的标识符并在需要时从数据库中查找实体。

我的基本问题是：您可以建议哪些原则和指导方针来决定业务逻辑应该放在会话 bean 中还是 POJO 中？给定一个复杂的对象图，什么时候传递实体 bean 才有意义？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-07T23:22:41.750

我在使用 JPA、EJB3 和 Wicket 构建 web 应用程序时遇到了这个问题。由于通过重复查询来重击我的数据库比在内存中保存大量大型实体更具可扩展性，因此我决定只传递它们的 id 而从不传递实体本身。

Wicket 及其模型概念与这个决定有很大关系。它们的 loadableDetachableModel 在实体不使用时会清理它们，同时仍保留 id。实现了一个 load() 方法，它知道如何在再次需要实体时获取实体，在我的例子中是通过调用无状态会话 bean；并且persist() 方法调用无状态bean 来持久化更改。这个模型类是我实际传递的。Wicket 只处理与显示和输入验证有关的逻辑，我只需要将 ejb 注入模型类。也许您可以在您的应用程序中创建类似的东西（我不知道电梯必须提供什么......）。

这对我来说效果很好，但是我没有特别复杂的业务逻辑，并且可以隔离任何需要持久化到小逻辑单元和单个页面中的更改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T20:01:05.563

每当您需要许多“系统”服务（注入等）时，请使用无状态 bean。否则 - POJO。POJO 更加灵活。

然而，简单的（访问器？）方法（例如在 web 服务和 bean 中）只能做一些简单的工作并返回结果。

# .net - 所见即所得编辑器不使用 .NET 中的更新面板 (AJAX)

> ID：251505
> 
> 赞同：1
> 
> 时间：2008-10-30T19:48:46.913
> 
> 标签：.net, ajax, updatepanel, wysiwyg

我们正在测试所见即所得的编辑器，但我们无法让它们与异步回发一起工作。我们将 TextBox(/textarea) 放在 UpdatePanel 中并调用一个简单的保存到 DB，我们所有的所见即所得工具栏都消失了，在文本框中留下了一堆 HTML。

这是我们一直在努力实现的：nicedit.com/ 我们发现CuteEditor 可以与异步一起使用。回发，但我们遇到了很多问题，我们正在完全废弃它。

这些只是两个示例，但我们已经尝试了其他一些示例，包括 TinyMCE。是什么导致这弄乱了 AJAX 调用？

*编辑*- 我同意 Thomas 的观点，它与在“onLoad”事件期间运行 javascript 的 WYSIWYG 编辑器有关。不幸的是，UpdatePanel 请求杀死了它并且不会重新呈现所见即所得的编辑器。[所以其他人可以进行实验，这是另一个与客户端 PageLoad 事件](https://stackoverflow.com/questions/338702/how-to-call-a-client-side-javascript-function-after-a-specific-updatepanel-has-be)挂钩的 SO 问题。

*编辑 2* - 最终我最终[使用 jQuery 将 WYSIWYG 加载/渲染事件绑定到元素的 onfocus 事件](http://docs.jquery.com/Events/bind)。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T13:20:27.147

看看这是否有帮助[http://nicedit.pbwiki.com/Saving+via+AJAX](http://nicedit.pbwiki.com/Saving+via+AJAX)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T08:55:16.323

这主要是由于两个问题（独立于您所见即所得的控制）。WYSIWG 编辑器在“onLoad”事件上运行 JS（您无法轻松修复），或者您的 WYSIWYG 编辑器在变为可见时包含 JavaScript（在 Ajax 请求中不会在不采取特殊操作的情况下将其呈现回客户端）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T19:55:13.280

根据我对 TinyMCE 的记忆，您需要在 POST 之前关闭编辑器。

我在[InnovaStudio](http://www.innovastudio.com/)上也取得了成功，但你必须为此付费（59.99 美元）。

我自己也在等[WysiHat](http://www.37signals.com/svn/posts/1330-introducing-wysihat-an-eventually-better-open-source-wysiwyg-editor)。

# python - windows mobile 上的脚本语言 - 类似于 python @ nokia s60

> ID：251506
> 
> 赞同：3
> 
> 时间：2008-10-30T19:48:59.847
> 
> 标签：python, windows-mobile, mobile

**我尝试为基于Windows 移动**的设备找到类似于诺基亚的python 的东西——一个脚本解释器[在这种情况下还能够创建独立的应用程序]，可以轻松访问所有电话界面——能够拨打电话、发送短信、拍照, 通过 GPRS 发送文件等...

虽然有 2.5 **pythonce**可用于 windows mobile，但它是纯 python 解释器，我寻找的是诺基亚 python 具有的所有“库”，如“导入相机”、“导入消息”、以编程方式控制手机的能力。诺基亚python的蓝牙控制台也很棒。

我不想使用 .NET CF （AFAIK）来控制你需要使用一些间接方法的相机（例如：http: [//blogs.msdn.com/marcpe/archive/2006/03/03/542941 .aspx](http://blogs.msdn.com/marcpe/archive/2006/03/03/542941.aspx)）。

感谢您提供的任何帮助，在此先感谢。

我希望有一些我无法通过谷歌找到的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T23:36:00.760

听起来这似乎是您为 PythonCE 项目开发一些 C 扩展模块的机会。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T01:53:11.780

铁蟒？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T19:56:46.350

那么有[Mortscript](http://www.sto-helit.de/index.php?module=download&action=list&category=18)。一种广泛使用的 Windows Mobile 脚本。不确定它是否可以访问所有电话功能。我相信 Windows Mobile 也有[TCL](http://www.kocjan.org/tclmentor/1-tcl/17-tcl-on-windows-mobile-introduction.html)。

# perl - 如何确定 URL 是否重定向？

> ID：251532
> 
> 赞同：11
> 
> 时间：2008-10-30T19:56:36.960
> 
> 标签：perl, http, redirect, groovy

如果我有一个 URL（例如[http://www.foo.com/alink.pl?page=2](http://www.foo.com/alink.pl?page=2)），我想确定我是否被重定向到另一个链接。我还想知道最终的 URL（例如[http://www.foo.com/other_link.pl](http://www.foo.com/other_link.pl)）。最后，我希望能够在 Perl 和 Groovy 中做到这一点。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-30T20:35:24.323

在 Perl 中：

```
use LWP::UserAgent;
my $ua = LWP::UserAgent->new;

my $request  = HTTP::Request->new( GET => 'http://google.com/' );
my $response = $ua->request($request);
if ( $response->is_success and $response->previous ) {
    print $request->url, ' redirected to ', $response->request->uri, "\n";
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-30T20:00:31.397

好吧，我对 Perl 或 groovy 一无所知，所以我将从 HTTP 的角度再给你一个，你必须适应。

通常，您发出一个 HTTP 请求，然后您会返回一些 HTML 文本以及响应代码。Success 的响应代码是 200。300 范围内的任何响应代码都是某种形式的重定向。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-30T20:08:11.820

参考詹姆斯的回答 - 示例 HTTP 会话：

```
$ telnet www.google.com 80
HEAD / HTTP/1.1
HOST: www.google.com

HTTP/1.1 302 Found
Location: http://www.google.it/
Cache-Control: private
Content-Type: text/html; charset=UTF-8
Set-Cookie: ##############################
Date: Thu, 30 Oct 2008 20:03:36 GMT
Server: ####
Content-Length: 218 
```

使用 HEAD 而不是 GET 你只会得到标题。“302”表示临时重定向，“Location：”是您被重定向到的位置。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-30T22:42:07.593

一个快速而肮脏的 groovy 脚本来展示这些概念——注意，这是使用[java.net.HttpURLConnection](http://java.sun.com/j2se/1.5.0/docs/api/java/net/HttpURLConnection.html)

为了检测重定向，您必须使用`setFollowRedirects(false)`. 否则，无论如何，您最终都会以`responseCode`200 的值进入重定向页面。缺点是您必须自己导航重定向。

```
URL url = new URL ('http://google.com')
HttpURLConnection conn = url.openConnection()
conn.followRedirects = false
conn.requestMethod = 'HEAD'
println conn.responseCode
// Not ideal - should check response code too
if (conn.headerFields.'Location') {
  println conn.headerFields.'Location'
}

301
["http://www.google.com/"] 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T20:03:38.320

在 Perl 中，您可以为此使用[LWP::Useragent](http://search.cpan.org/~gaas/libwww-perl/lib/LWP/UserAgent.pm)。我想最简单的方法是`response_redirect`使用`add_handler`.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-12T22:27:59.850

我认为这适用于 301 重定向。

```
use LWP::UserAgent;
my $ua = LWP::UserAgent->new;

my $request  = HTTP::Request->new( GET => 'http://google.com/' );
my $response = $ua->request($request);
if ( $response->is_redirect  ) {
    print $request->url . " redirected to location " .  $response->header('Location') .  "\n";
} 
```

# java - 解析 MM/DD/YY 格式的日期并将其调整为当前/上个世纪的最佳方法是什么？

> ID：251535
> 
> 赞同：11
> 
> 时间：2008-10-30T19:57:53.573
> 
> 标签：java, date, date-format

我们的一位客户希望能够为年份部分输入只有 2 位数字的日期。日期将是过去的日期，因此如果 2 位数年份在当前年份之后，我们希望它适用于上一个世纪，但如果 2 位数年份等于或小于当前年份，则适用于当前世纪。

截至今天 2008 年 10 月 30 日

01/01/01 = 01/01/2001

01/01/09 = 01/01/1909

这是一个奇怪的要求，我解决了这个问题，我只是不喜欢我的解决方案。感觉有更好的方法来做到这一点。

谢谢您的帮助。

```
public static String stupidDate(String dateString)
{
    String twoDigitYear = StringUtils.right(dateString, 2);
    String newDate = StringUtils.left(dateString, dateString.length() - 2);
    int year = NumberUtils.toInt(twoDigitYear);
    Calendar c = GregorianCalendar.getInstance();
    int centuryInt = c.get(Calendar.YEAR) - year;
    newDate = newDate + StringUtils.left(Integer.toString(centuryInt), 2) + twoDigitYear;
    return newDate;
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-30T21:25:40.493

Groovy 脚本（很容易投入到 java 中）展示了 @bobince 关于 SimpleDateFormat 的观点。

```
import java.text.SimpleDateFormat

SimpleDateFormat sdf = new SimpleDateFormat('MM/dd/yy')
SimpleDateFormat fmt = new SimpleDateFormat('yyyy-MM-dd')

Calendar cal = Calendar.getInstance()
cal.add(Calendar.YEAR, -100)
sdf.set2DigitYearStart(cal.getTime())

dates = ['01/01/01', '10/30/08','01/01/09']
dates.each {String d ->
  println fmt.format(sdf.parse(d))
} 
```

产量

```
2001-01-01
2008-10-30
1909-01-01 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-30T20:49:53.437

SimpleDateFormat 已经使用两个字母的“yy”格式为您解析了两位数的年份。（显然，它仍然允许四位数。）

默认情况下，它使用 now-80→now+20，因此它与您建议的规则不完全相同，但它是合理且标准化的（至少在 Java 世界中），并且可以根据需要使用 set2DigitYearStart() 覆盖。

```
DateFormat informat= new SimpleDateFormat("MM/dd/yy");
DateFormat outformat= new SimpleDateFormat("MM/dd/yyyy");
return outformat.format(informat.parse(dateString)); 
```

从长远来看，尝试迁移到 ISO8601 日期格式（yyyy-MM-dd），因为 MM/dd/yy 大约是最糟糕的日期格式，最终必然会导致问题。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-30T20:09:45.123

这个怎么样：

```
public static String anEasierStupidDateWithNoStringParsing(String dateString) {
    DateFormat df = new SimpleDateFormat("MM/dd/yyyy");

    //handling ParseExceptions is an exercise left to the reader!
    Date date = df.parse(dateString);
    Calendar cal = Calendar.getInstance();
    cal.setTime(date);

    Calendar now = Calendar.getInstance();
    if (cal.after(now)) {
        cal.add(Calendar.YEAR, -100);
    }

    return cal;
} 
```

换句话说，如果 SimpleDateFormat （[它有自己的解释年份字符串的规则](http://java.sun.com/j2se/1.4.2/docs/api/java/text/SimpleDateFormat.html)）返回当前日期之后的日期，则让 SimpleDateFormat 解析字符串并将年份调整为上一个世纪。

这将保证所有返回的日期都是过去的。但是，它没有考虑任何可能像上个世纪*之前*那样被解析的日期- 例如，使用 format `MM/dd/yyyy`，像“01/11/12”这样的日期字符串会解析为公元 12 年 1 月 11 日

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-30T20:49:21.953

如果 Joda Time 是一个选项：

```
String inputDate = "01/01/08";
// assuming U.S. style date, since it's not clear from your original question
DateTimeFormatter parser = DateTimeFormat.forPattern("MM/dd/yy");
DateTime dateTime = parser.parseDateTime(inputDate);
// if after current time
if (dateTime.isAfter(new DateTime())) {
    dateTime = dateTime.minus(Years.ONE);
}

return dateTime.toString("MM/dd/yyyy"); 
```

我知道 Joda Time 不是 Java SE 的一部分，正如我在另一个线程中所说的那样，当有一个 Java 库可以做同样的事情时，我通常不会容忍使用第三方库。然而，开发 Joda Time 的人也在领导 JSR310 - 日期和时间 API，它将使其进入 Java 7。所以我 Joda Time 基本上将出现在未来的 Java 版本中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-10-30T08:00:14.593

```
Date deliverDate = new SimpleDateFormat("MM/dd/yy").parse(deliverDateString);
String dateString2 = new SimpleDateFormat("yyyy-MM-dd").format(deliverDate); 
```

为我工作。

# c# - 为什么这个泛型方法要求 T 有一个公共的、无参数的构造函数？

> ID：251541
> 
> 赞同：0
> 
> 时间：2008-10-30T20:00:11.010
> 
> 标签：c#, generics

```
public void Getrecords(ref IList iList,T dataItem) 
{ 
  iList = Populate.GetList<dataItem>() // GetListis defined as GetList<T>
} 
```

dataItem 可以是我的订单对象或用户对象，这将在运行时决定。上面不起作用，因为它给了我这个错误类型'T'必须有一个公共无参数构造函数才能将它用作参数'T'泛型

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T20:03:01.080

```
public void GetRecords<T>(ref IList<T> iList, T dataitem)
{
} 
```

你还在寻找什么？

**修改后的问题：**

```
 iList = Populate.GetList<dataItem>() 
```

“数据项”是一个变量。你想在那里指定一个类型：

```
 iList = Populate.GetList<T>() 
```

> 类型“T”必须有一个公共的无参数构造函数，以便在泛型类型 GetList:new() 中将其用作参数“T”

这就是说，当你定义 Populate.GetList() 时，你声明它是这样的：

```
IList<T> GetList<T>() where T: new() 
{...} 
```

这告诉编译器 GetList 只能使用具有公共无参数构造函数的类型。你使用 T 在 GetRecords 中创建一个 GetList 方法（这里的 T 指的是不同的类型），你必须对其进行相同的限制：

```
public void GetRecords<T>(ref IList<T> iList, T dataitem) where T: new() 
{
   iList = Populate.GetList<T>();
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T20:04:23.560

您修改后的问题将 dataItem 作为类型 T 的对象传递，然后尝试将其用作 GetList() 的类型参数。也许您传递 dataItem 只是作为指定 T 的一种方式？

如果是这样，你可能想要这样的东西：

```
public IList<T> GetRecords<T>() {
  return Populate.GetList<T>();
} 
```

然后你这样称呼它：

```
IList<int> result = GetRecords<int>(); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-30T20:18:51.347

要求一个公共的、无参数的构造函数的问题只能是因为 Populate.GetList 需要它——即具有“T : new()”约束。要解决此问题，只需将相同的约束添加到您的方法中。

实际上，我怀疑这`ref`是一个好的策略。在推动时，`out`可能会这样做（因为您没有读取该值），但一个更简单（并且更值得期待）的选项是返回值：

```
public IList<T> GetRecords<T>(T dataItem) where T : new()
{  // MG: what does dataItem do here???
  return Populate.GetList<T>();
} 
```

当然，此时调用者还不如`Populate.GetList`直接调用！

我怀疑您也可以删除 dataItem ......但问题并不完全清楚。

如果您不希望它是通用的（并且 dataItem 是模板对象），那么您可以通过以下方式执行此操作`MakeGenericMethod`：

```
public static IList GetRecords(object dataItem) 
{
    Type type = dataItem.GetType();
    return (IList) typeof(Populate).GetMethod("GetList")
        .MakeGenericMethod(type).Invoke(null,null);
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-30T20:02:18.320

您可以将 Generic 与 < T > 一起使用，它将在运行时接受您想要的类型。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-30T20:02:43.733

```
Getrecords<T> ... 
```

这应该有您需要的任何更详细的信息。 [http://msdn.microsoft.com/en-us/library/twcad0zb(VS.80).aspx](http://msdn.microsoft.com/en-us/library/twcad0zb(VS.80).aspx)

# sharepoint - SharePoint stsadm 添加解决方案 - 失败并出现基于权限的错误（对象引用）

> ID：251554
> 
> 赞同：3
> 
> 时间：2008-10-30T20:02:58.290
> 
> 标签：sharepoint, stsadm

*第一次*尝试将 MOSS 解决方案从开发服务器部署到 UAT 服务器。在执行此命令时

```
stsadm -o addsolution -filename xxx 
```

我得到一个“对象引用未设置为对象的实例”基于这些链接：（和其他）：

[ [http://social.msdn.microsoft.com/forums/en-US/sharepointdevelopment/thread/63f0f95d-1215-4041-be6d-64ae63bda276/][1]](http://social.msdn.microsoft.com/forums/en-US/sharepointdevelopment/thread/63f0f95d-1215-4041-be6d-64ae63bda276/][1])

[ [http://www.telerik.com/community/forums/thread/b311D-bachea.aspx](http://www.telerik.com/community/forums/thread/b311D-bachea.aspx) 我确定了以下几点：][1]

1.  我是 MOSS 服务器上农场管理员组的成员
2.  我是服务器上 WSS_RESTRICTED_WPG 的成员
3.  我已经在服务器上的 WSS_ADMIN_WPG 组中

我检查了事件日志，发现异常说登录到我的站点服务数据库失败。

如果我尝试通过 SQL Server Mgt Studio 添加自己，我无权设置对该数据库的访问权限，例如：

> 原因：无法打开登录请求的数据库“SharedServices1_DB”。登录失败。用户 'XXXXX\Administrator' 登录失败。

那么，我错过了什么？我需要做任何明显的事情吗？欢迎任何有用的建议。

谢谢

[1]：[http://MSDN](http://MSDN)论坛帖子

[1]：[http://Telerik](http://Telerik)支持线程

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T21:05:09.910

我认为您缺少的显而易见的事情是用户帐户没有使用共享点数据库所需的权限 - 正如您在帖子中所说的那样；）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T06:58:32.093

添加解决方案与 SSP 无关。

此错误通常是因为执行 stsadm 命令的用户无权访问场配置数据库。这与只有“场凭据”帐户才能访问场配置数据库这一事实有关。

您可以尝试以下两种方法之一：

1.  以“场凭据”帐户的身份运行 stsadm 命令。通常这是一个服务帐户，默认情况下，它是在安装过程中用于创建场数据库的帐户。
2.  将“农场凭据”帐户更改为您的登录用户。您可以使用 stsadm -o updatefarmcredentials 来执行此操作

希望有帮助！

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-30T20:47:51.583

问题似乎不在于您的解决方案，而在于 SSP。尝试删除 UAT SSP 并重新创建它并与您的站点关联。

如果可行，您将需要找出问题发生的原因。

# windows - 在 Windows 命令提示符中转义尖括号

> ID：251557
> 
> 赞同：100
> 
> 时间：2008-10-30T20:03:34.403
> 
> 标签：windows, cmd, escaping

我需要将包含尖括号（< 和 >）的字符串回显到 Windows 机器上的文件中。基本上我想做的是以下几点：
`echo some string < with angle > brackets >>myfile.txt`

这不起作用，因为命令解释器与尖括号混淆了。我可以像这样引用整个字符串：
`echo "some string < with angle > brackets" >>myfile.txt`

但是后来我的文件中有我不想要的双引号。

转义方括号 ala unix 也不起作用：
`echo some string \< with angle \> brackets >>myfile.txt`

想法？

* * *

## 回答 #1

> 赞同：178
> 
> 时间：2008-10-30T20:10:40.067

出于某种原因，Windows 转义字符是 ^。

```
echo some string ^< with angle ^> brackets >>myfile.txt 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2012-07-21T17:04:59.307

诚然，官方转义字符是`^`，但要小心，因为有时您需要**三个** `^`字符。这只是*有时*：

```
C:\WINDOWS> echo ^<html^>
<html>

C:\WINDOWS> echo ^<html^> | sort
The syntax of the command is incorrect.

C:\WINDOWS> echo ^^^<html^^^> | sort
<html>

C:\WINDOWS> echo ^^^<html^^^>
^<html^> 
```

摆脱这种废话的一个技巧是使用命令而不是`echo`使用双引号进行输出和引用：

```
C:\WINDOWS> set/p _="<html>" <nul
<html>
C:\WINDOWS> set/p _="<html>" <nul | sort
<html> 
```

请注意，这不会保留提示文本上的前导空格。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-09-25T14:39:29.917

有一些方法可以避免`^`转义序列。

您可以使用延迟扩展的变量。下面是一个小批量脚本演示

```
@echo off
setlocal enableDelayedExpansion
set "line=<html>"
echo !line! 
```

或者您可以使用 FOR /F 循环。从命令行：

```
for /f "delims=" %A in ("<html>") do @echo %~A 
```

或从批处理脚本：

```
@echo off
for /f "delims=" %%A in ("<html>") do echo %%~A 
```

这些方法起作用的原因是因为延迟扩展和 FOR 变量扩展都发生在特殊运算符（如`<`, `>`, `&`, , `|`, `&&`, ）`||`被解析之后。请参阅[Windows 命令解释器 (CMD.EXE) 如何解析脚本？](https://stackoverflow.com/a/4095133/1012053)了解更多信息。

* * *

[sin3.14 指出管道可能需要多次转义](https://stackoverflow.com/a/11594161/1012053)。例如：

```
echo ^^^<html^^^>|findstr . 
```

管道需要多次转义的原因是因为管道的每一侧都在一个新的 CMD 进程中执行，因此该行被多次解析。请参阅[为什么在管道代码块中延迟扩展失败？](https://stackoverflow.com/q/8192318/1012053)用于解释 Window 的管道实现的许多尴尬后果。

使用管道时，还有另一种方法可以避免多次转义。您可以显式实例化您自己的 CMD 进程，并用引号保护单转义：

```
cmd /c "echo ^<html^>"|findstr . 
```

如果你想使用延迟扩展技术来避免逃逸，那么还有更多的惊喜（如果你是 CMD.EXE 设计方面的专家，你可能不会感到惊讶，但没有官方的 MicroSoft 文档解释这些东西）

请记住，管道的每一侧都在其自己的 CMD.EXE 进程中执行，但该进程不会***继承***延迟扩展状态 - 它默认为 OFF。因此，您必须显式实例化您自己的 CMD.EXE 进程并使用 /V:ON 选项来启用延迟扩展。

```
@echo off
setlocal disableDelayedExpansion
set "line=<html>"
cmd /v:on /c echo !test!|findstr . 
```

请注意，延迟扩展在父批处理脚本中处于关闭状态。

但是，如果在父脚本中启用了延迟扩展，那么所有的地狱都会崩溃。以下***不起作用***：

```
@echo off
setlocal enableDelayedExpansion
set "line=<html>"
REM - the following command fails
cmd /v:on /c echo !test!|findstr . 
```

问题是`!test!`在父脚本中展开，所以新的 CMD 进程试图解析 unprotected`<`和`>`.

您可以逃避`!`，但这可能会变得棘手，因为这取决于是否`!`引用了 。

如果没有引用，则需要双重转义：

```
@echo off
setlocal enableDelayedExpansion
set "line=<html>"
cmd /v:on /c echo ^^!test^^!|findstr . 
```

如果引用，则使用单个转义：

```
@echo off
setlocal enableDelayedExpansion
set "line=<html>"
cmd /v:on /c "echo ^!test^!"|findstr . 
```

但是有一个令人惊讶的技巧可以避免所有转义 - 封闭管道的左侧可以防止父脚本`!test!`过早扩展：

```
@echo off
setlocal enableDelayedExpansion
set "line=<html>"
(cmd /v:on /c echo !test!)|findstr . 
```

但我想即使这样也不是免费的午餐，因为批处理解析器在使用括号时会在末尾引入一个额外的（也许是不需要的）空间。

不是批处理脚本的乐趣;-)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-11-23T13:42:52.843

为了使用特殊字符，例如 Windows 上带有 echo 的“>”，您需要在其前面放置一个特殊的转义字符。

例如

```
echo A->B 
```

因为 '>' 必须被 '^' 转义，所以将无法工作：

```
 echo A-^>B 
```

另请参阅[转义序列](https://sites.google.com/site/opensourceconstriubtions/ettl-martin-1/tutorials/how-to-escape-special-characters-in-windows-batch-files-when-using-echo)。 [![在此处输入图像描述](https://i.stack.imgur.com/NfH6K.png)](https://i.stack.imgur.com/NfH6K.png)

有一个简短的批处理文件，它打印一组基本的特殊字符及其转义序列。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T20:30:47.343

> 转义方括号 ala unix 也不起作用：
> 
> 回显一些字符串 \< 带角 \> 括号 >>myfile.txt

反斜杠将被视为绝对路径名的开始。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2011-03-28T06:58:15.307

您还可以使用双引号来转义特殊字符...

```
echo some string "<" with angle ">" brackets >>myfile.txt 
```

# .net - 从 .NET 向 Access (Jet) 表添加列

> ID：251560
> 
> 赞同：0
> 
> 时间：2008-10-30T20:03:47.583
> 
> 标签：.net, database, ms-access, jet

我们的应用程序（已部署）正在使用 Access/Jet 数据库。我们软件的即将发布的版本需要在其中一个表中添加一些额外的列。我需要先检查这些列是否存在，如果不存在则添加它们。

有人可以提供一个快速的代码示例、链接或朝着正确的方向轻推吗？

（我使用的是 c#，但 VB.NET 示例也可以）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T20:17:08.417

离开我的头顶，但类似：

```
Dim conn as New AdoConnection(someConnStr)
Dim cmd as New AdoCommand
cmd.Connection = conn
cmd.CommandText = "ALTER TABLE X ADD COLUMN y COLUMNTYPE"
cmd.ComandType = CommandType.Text
cmd.ExecuteNonQuery() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T20:12:40.873

在表中查询您期望的字段，如果该字段不存在，则处理错误。

也添加列，只需向数据库提供一个[alter table](http://msdn.microsoft.com/en-us/library/bb177883.aspx) SQL 语句。

# web-services - 从 Sharepoint 到 HTML 的 CAML

> ID：251577
> 
> 赞同：2
> 
> 时间：2008-10-30T20:11:22.797
> 
> 标签：web-services, sharepoint, interop, caml

我正在调用返回 CAML 片段[的 SharePoint 的 Web 服务 API之一。](http://msdn.microsoft.com/en-us/library/ms995760.aspx)我已经在互联网上进行了广泛的搜索，但我一直无法弄清楚如何使这个 CAML 片段呈现为“正常”的 HTML，我可以在 Plumtree、WLP、Liferay 或任何其他门户等更健全的环境中呈现除了 SharePoint。

如果没有办法做到这一点，我想知道为什么微软首先编写了返回 CAML 的 SharePoint Web 服务调用。Web 服务用于互操作性，似乎 CAML 仅在 SharePoint 中运行的 WebPart 中有效。[比尔和史蒂夫注意：这不是互操作性。]

如果我对返回的 CAML 无能为力，我将调用一个仅返回数据的不同 Web 服务，然后编写我自己的 UI。我希望有一条更简单的道路。任何建议将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T20:53:30.450

CAML 仍然是 XML，并且如前所述，XSLT 将能够将其呈现为 HTML。CAML 的实际嵌套 OR/AND 结构完全是另一个问题。

这将需要展开 CAML 结构并以普通人理解的方式显示它。

不幸的是，XSLT 语言不适合展开这样的嵌套结构（它没有堆栈）。这是可能的，但完成后我强烈建议使用另一种语言来解析和展开 CAML。

我还没有看到 CAML 到 SQL 的转换代码。听起来像是一个很棒的 Codeplex 项目。

所以总而言之......你有点塞满了 CAML。虽然它是 XML，但它的结构不适合在任何其他查询语言中使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T20:17:17.353

您可以通过 XSLT 样式表发送 CAML 以生成 HTML 或 XHTML。

**编辑：**

考虑您的第一个问题（为什么 SharePoint 从其某些 Web 服务返回 CAML）...谁知道呢？它可能用于支持创作工具，例如 SharePoint 设计器。但从缺乏文档和工具看来，CAML 或多或少是内部 SharePoint 的东西。目前，执行 CAML 到 HTML 的转换需要以某种方式访问​​ SharePoint 中的 CAML 呈现引擎，或者重新实现它。这两种选择都没有吸引力。

我认为您的结论（调用数据返回 Web 服务并自己呈现 HTML）可能是您最好的选择。

# windows - 使用批处理脚本重命名文件

> ID：251584
> 
> 赞同：2
> 
> 时间：2008-10-30T20:13:34.303
> 
> 标签：windows, command-line, timestamp

如何使用 Windows 命令行重命名文件以包含日期时间？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T20:25:21.333

这是一个类似的问题：

[如何以适合在文件名中使用的格式在 Windows 命令行上获取当前日期时间？](https://stackoverflow.com/questions/203090/how-to-get-current-datetime-on-windows-command-line-in-a-suitable-format-for-us)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T20:18:05.700

在[http://www.ss64.com/nt/syntax.html](http://www.ss64.com/nt/syntax.html)查看[StampMe.cmd](http://www.ss64.com/nt/stampme.txt)。

# database - 来自旧的未知数据库系统的 TBC 文件

> ID：251585
> 
> 赞同：0
> 
> 时间：2008-10-30T20:13:42.197
> 
> 标签：database, dos

我有一堆 *.TBC 文件来自一个非常古老的应用程序，它在 MS-DOS 中运行，称为 TURBOLAB。任何人都知道哪个数据库系统使用带有 TBC 扩展名的文件。

我尝试将文件重命名为 *.dbf 以检查它们是否是没有运气的 dBase 文件。

任何的想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T20:20:18.067

从应用程序和时代（旧的 MS-DOS）来看 *.tbc 可能是应用程序开发人员编写的固定长度二进制记录格式。

首先尝试在文本编辑器（如 TextPad）中打开文件，如果您可以阅读内容，如果可以，我有一个固定长度的文本文件阅读器，您可以根据自己的需要进行调整。如果不能，您可能需要通过反复试验来确定字段长度和数据类型。

此外，每个 *.tbc 是否有关联文件？配对文件可以指示字段长度和数据类型（或者该信息可以存储在 *.tbc 文件本身的顶部）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T20:19:12.313

我用谷歌搜索了这个：[FlexPro](http://www.adeptscience.co.uk/products/dataanal/flexpro/import.html)。我希望它有所帮助。听起来很贵，我希望你的数据值得。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T21:02:38.310

> 从应用程序和时代（旧的 MS-DOS）来看 *.tbc 可能是应用程序开发人员编写的固定长度二进制记录格式。

我想你是对的。不幸的是，没有匹配的文件名。如果这些文件中的每一个都是一个“表”，那么这个数据库中有大约 150 个表。对于这么旧的应用程序来说，工作量太大了。我想我的客户将不得不从头开始使用我的应用程序。

无论如何感谢您的帮助。

# asp.net - ASP.NET AjaxControlToolKit Accordion 通过 javascript 设置活动窗格

> ID：251588
> 
> 赞同：1
> 
> 时间：2008-10-30T20:14:20.480
> 
> 标签：asp.net, javascript, asp.net-ajax

我希望能够使用 javascript 更改手风琴的活动窗格。

我看到一个行为 set_SelectedIndex 但我似乎无法让它工作。

如何找出此控件支持的方法？

如何从页面设置选定的索引？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T21:16:55.567

[我在这篇博文http://disturbedbuddha.wordpress.com/2007/11/30/selecting-an-ajax-accordionpane-by-id/](http://disturbedbuddha.wordpress.com/2007/11/30/selecting-an-ajax-accordionpane-by-id/)上找到了一条评论，它向我展示了如何使用 Accordion.AccordionBehavior.set_SelectedIndex(index); .

我从变量的代码隐藏中输出启动脚本，paneIds 带有代码及其索引的前言。这允许我通过 id 设置活动窗格。

# php - PHP如何进行递归函数调用？

> ID：251592
> 
> 赞同：1
> 
> 时间：2008-10-30T20:15:24.567
> 
> 标签：php, string, recursion

PHP（以及其他）将首先执行最深的函数，然后逐步退出。例如，

```
$text = strtoupper(str_replace('_', ' ', file_get_contents('file.txt'))); 
```

我正在为模板解析器做一些与上述示例非常相似的事情。它寻找标签

```
{@tag_name} 
```

并将其替换为名称**为 $tag_name**的变量。再举一个例子：

```
$a = 'hello';
$b = ' world';
INPUT = 'This is my test {@a{@b}} string.';
OUTPUT (step 1) = 'This is my test {@a} world string.';
OUTPUT output = 'This is my test hello world string.'; 
```

我该怎么做呢？这有意义吗？如果没有，我可以尝试更好地解释。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T21:42:40.100

我不确定我是否理解您示例中的嵌套，因为该示例并未说明嵌套背后的目的。您的示例输入很容易成为

```
'This is my test {@a} {@b} string.' 
```

在 str_replace 中使用数组将非常简单快速地处理这个问题。

```
$aVars = array('{@a}' => 'hello', '{@b}' => 'world');
$sString = 'This is my test {@a} {@b} string.';

echo str_replace(array_keys($aVars), array_values($aVars), $sString); 
```

这给了我们

> 这是我的测试 hello world 字符串。

现在，对此的递归函数并不太难，尽管我不确定我是否理解它会有多大用处。这是一个工作示例：

```
function template($sText, $aVars) {
    if (preg_match_all('/({@([^{}]+)})/',
                       $sText, $aMatches, PREG_SET_ORDER)) {
        foreach($aMatches as $aMatch) {
            echo '<pre>' . print_r($aMatches, 1) . '</pre>';

            if (array_key_exists($aMatch[2], $aVars)) {
                // replace the guy inside
                $sText = str_replace($aMatch[1], $aVars[$aMatch[2]], $sText);

                // now run through the text again since we have new variables
                $sText = template($sText, $aVars);
            }
        }
    }

    return $sText;
} 
```

该 print_r 将向您显示匹配项的外观，以便您可以按照该功能的步伐进行操作。现在让我们试一试...

```
$aVars = array('a' => 'hello', 'b' => 'world');
$sStringOne = 'This is my test {@a} {@b} string.';
$sStringTwo = 'This is my test {@a{@b}} string.';

echo template($sStringOne, $aVars) . '<br />'; 
```

第一个结果：

> 这是我的测试 hello world 字符串。

现在让我们试试字符串二

```
echo template($sStringTwo, $aVars) . '<br />'; 
```

第二个结果：

> 这是我的测试 {@aworld} 字符串。

这很可能就是您正在寻找的。显然，您需要一个`aworld`变量才能递归地工作......

```
$aVars = array('a' => '', 'b' => '2', 'a2' => 'hello world');

echo template($sStringTwo, $aVars) . '<br />'; 
```

和我们的结果。

> 这是我的测试 hello world 字符串。

只是为了一些递归的乐趣......

```
$aVars = array('a3' => 'hello world', 'b2' => '3', 'c1' => '2', 'd' => '1');
$sStringTre = 'This is my test {@a{@b{@c{@d}}}} string.';

echo template($sStringTre, $aVars) . '<br />'; 
```

> 这是我的测试 hello world 字符串。

不知道这是不是你要的...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T20:18:52.610

这不是一项微不足道的任务。您需要手动解析字符串并进行自己的逻辑替换。没有神奇的功能或功能可以为您做到这一点。

我自己的模板引擎可以做到这一点（以及更多），只有核心（无模板宏）的重量为 600+ LOC

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T20:30:41.540

`array_push`使用堆栈 - 将每个打开的元素放在顶部，并`array_pop`在第一个结束标记处评估最顶部。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T20:20:07.770

至少在给定的示例中，我不明白为什么 @b 令牌会嵌套在 @a 令牌中。两个人似乎没有什么需要。你想在 Perl 中做这样的事情吗？

```
$a = "b";
$b = "Hello World!";

print $$a; 
```

输出将是“Hello World”

# delphi - 串口 WriteFile() 冻结

> ID：251594
> 
> 赞同：4
> 
> 时间：2008-10-30T20:16:14.610
> 
> 标签：delphi, serial-port, freeze, writefile

我有一个简单的应用程序，它应该每分钟向串行端口发送一个字节。但有时，出于某种奇怪的原因，它会在 WriteFile() 函数的某个位置冻结。sw 和 hw 流量控制均已关闭。我已经搜索了一些关于从另一个线程执行的挂起读取操作的内容，但我相信这不是问题，因为我的应用程序有单线程。此外，来自 CreateFile 的句柄看起来是有效的，因此该端口不应被任何其他应用程序使用。有人遭受过这种情况吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T22:54:16.493

如果您在 Google 上搜索*writefile hangs*一词，您会发现很多关于此问题的讨论。一些线索是缓冲区溢出，正确调整缓冲区大小，有缺陷的 COM 端口，清除错误状态......似乎有很多事情可以尝试。

我建议的另一件事是使用通信库而不是直接调用 API，例如 Async Professional ( [http://sourceforge.net/projects/tpapro/](http://sourceforge.net/projects/tpapro/) )。即使它们为您的应用程序增加了一些开销，它们也可能会简化您的工作并避免许多潜在的陷阱......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T23:16:50.520

您是否尝试过将 CommPortDriver.CheckLineStatus 设置为 true（“以防止在未连接设备或设备关闭时挂起”）？comdrv32.pas 库的源代码包含该建议。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-03T08:57:47.720

您也可以尝试[ComPort](http://sourceforge.net/projects/comport/)，它被忽略了一段时间，但现在又被积极开发了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T20:21:03.337

好吧，我正在使用这个库： Delphi 7 中的[http://lhdelphi.ic.cz/uploader/storage/ComDrv32.pas](http://lhdelphi.ic.cz/uploader/storage/ComDrv32.pas)，在 Windows XP 上，但里面的组件只是一些 Win API 调用的包装，CreateFile，写入文件等

# unit-testing - VS2008 代码覆盖率 - 找不到“未覆盖的块”

> ID：251602
> 
> 赞同：1
> 
> 时间：2008-10-30T20:18:08.383
> 
> 标签：unit-testing, code-coverage

我正在针对我正在开发的经过单元测试的 DLL 运行 VS2008 的代码覆盖率。对于某些功能，它声称没有覆盖 2 个块，而有 50 个左右。当我查看 VS2008 突出显示的功能时，它找不到未覆盖的块。

突出显示似乎适用于某些功能，因为它正确地为未覆盖的块显示不同的颜色。似乎不一致。

这是错误还是 PIBKAC？如果是后者，我做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T21:06:59.593

只是一个建议，试试[TestDriven.Net](http://www.testdriven.net)的代码覆盖率工具并比较结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T23:53:52.783

我已经看到一些问题，代码覆盖分析器在 try/catch 块上关闭大括号时遇到问题。当我看到这类事情时，我只是不担心——只要我能看到实际的代码被覆盖了。

[编辑] 我会支持 TestDriven.NET 的建议。我喜欢它的右键单击测试菜单，它让我可以轻松地运行单个测试，而且我还使用 NCover 而不是内置的覆盖——主要是因为它在另一个窗口中打开并且不会在我的主编辑器中为文本着色。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-22T11:00:43.353

确保区分*覆盖块*和*部分覆盖块*。如果我没记错的话，默认设置中的颜色是相似的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-14T08:01:42.370

我有一种情况，其中为枚举的每个成员选择不同路径的 switch 语句没有“默认”路径。您可以通过未突出显示的 switch 语句的括号发现未完全覆盖的块。

# c# - 将 DB Connection 对象传递给方法

> ID：251603
> 
> 赞同：21
> 
> 时间：2008-10-30T20:18:39.693
> 
> 标签：c#, .net, ado.net, database-connection

想知道是否建议将数据库连接对象传递给（到其他模块）或让方法（在其他模块中）负责设置它。我倾向于让方法设置它，以便在使用它之前不必检查连接的状态，并且只需让调用者将任何需要的数据传递给设置连接所需的调用方法。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-30T20:33:16.013

就我个人而言，我喜欢使用紧密范围的连接；晚点打开它们，使用它们，然后关闭它们（在“使用”块中，都在本地方法中）。在大多数情况下，连接池将处理重用连接，因此这种方法没有真正的开销。

*过去*，传递连接的主要优点是您可以传递交易；但是，[`TransactionScope`](https://stackoverflow.com/questions/224689/transactions-in-net#224702)这是一种在方法之间共享事务的更简单的方法。

由于这些类是特定于实现的，我会编写每个类来打开它自己的本机事务。否则，您可以使用 ado.net 工厂方法从配置文件（提供程序名称）创建适当的类型。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-30T20:52:16.333

就个人而言，我喜欢使用 SetData 和 GetData在[Thread Local Storage](http://msdn.microsoft.com/en-us/library/system.runtime.remoting.messaging.callcontext_methods.aspx)顶部存储我当前打开的连接和事务的堆栈。我定义了一个类来管理我与数据库的连接并允许它使用 dispose 模式。这节省了我传递连接和事务的需要，我认为这会使代码混乱和复杂化。

我强烈建议**不要**将其留给每次需要数据时打开连接的方法。这将导致一个非常糟糕的情况，即很难在整个应用程序中管理事务并且打开和关闭太多连接（我知道连接池，从池中查找连接仍然比它更昂贵重用一个对象）

所以我最终得到了这些方面的东西（完全未经测试）：

```
class DatabaseContext : IDisposable {

    List<DatabaseContext> currentContexts;
    SqlConnection connection;
    bool first = false; 

    DatabaseContext (List<DatabaseContext> contexts)
    {
        currentContexts = contexts;
        if (contexts.Count == 0)
        {
            connection = new SqlConnection(); // fill in info 
            connection.Open();
            first = true;
        }
        else
        {
            connection = contexts.First().connection;
        }

        contexts.Add(this);
    }

   static List<DatabaseContext> DatabaseContexts {
        get
        {
            var contexts = CallContext.GetData("contexts") as List<DatabaseContext>;
            if (contexts == null)
            {
                contexts = new List<DatabaseContext>();
                CallContext.SetData("contexts", contexts);
            }
            return contexts;
        }
    }

    public static DatabaseContext GetOpenConnection() 
    {
        return new DatabaseContext(DatabaseContexts);
    }

    public SqlCommand CreateCommand(string sql)
    {
        var cmd = new SqlCommand(sql);
        cmd.Connection = connection;
        return cmd;
    }

    public void Dispose()
    {
        if (first)
        {
            connection.Close();
        }
        currentContexts.Remove(this);
    }
}

void Test()
{
    // connection is opened here
    using (var ctx = DatabaseContext.GetOpenConnection())
    {
        using (var cmd = ctx.CreateCommand("select 1"))
        {
            cmd.ExecuteNonQuery(); 
        }

        Test2(); 
    }
    // closed after dispose
}

void Test2()
{
    // reuse existing connection 
    using (var ctx = DatabaseContext.GetOpenConnection())
    {
        using (var cmd = ctx.CreateCommand("select 2"))
        {
            cmd.ExecuteNonQuery();
        }
    }
    // leaves connection open
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-30T20:21:38.593

出于自动化测试的目的，传递它通常更容易。这称为[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)。

当您需要编写测试时，您可以创建一个模拟数据库连接对象并传递它而不是真实的。这样，您的自动化测试就不会依赖于每次都需要重新填充数据的实际数据库。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T20:20:05.977

我个人努力尽可能集中我的数据访问，但是，如果不可能，我总是在其他类中打开一个新连接，因为我发现在传递实际连接时有太多其他事情可能会阻碍目的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T20:21:21.387

建立连接可能会很昂贵，并且可能会增加往返行程。所以，再一次，更好的设计是传递连接对象。

我说可能，因为如果您是 Microsoft ADO 应用程序，您可能正在使用连接池......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T20:27:44.807

这是对这个问题的更深入的了解。我有一个管理数据库连接的类，并且有 2 个实现接口的类。其中一个类用于 SQL，另一个用于 OLAP。管理器知道要使用哪个连接，因此它可以将确切的连接传递给类型，或者类型可以创建自己的连接。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T20:31:47.747

您可以毫无问题地传递连接对象（例如，Microsoft Enterprise Library 允许在连接中传递静态方法调用），或者您可以在外部对其进行管理，这取决于您的设计，没有直接的技术权衡。

如果您的解决方案将被移植到其他数据库，请注意可移植性不要传递特定连接（这意味着不要传递您计划与其他数据库一起使用的 SqlConnection）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-30T20:57:35.573

我建议您区分连接对象及其状态（打开、关闭）。

您可以有一个从 web.config 读取连接字符串的方法（或属性）。每次使用相同版本的连接字符串可确保您从连接池中受益。

当您需要打开连接时调用该方法。在最后一刻，设置完所有 SqlCommand 属性后，打开连接，使用它，然后关闭它。在 C# 中，您可以使用 using 语句来确保连接已关闭。如果没有，请务必在 finally 块中关闭连接。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T20:20:57.037

我会使用 web.config

```
<configuration>
    <connectionStrings>
        <add name="conn1" providerName="System.Data.SqlClient" connectionString="string here" />
        <add name="conn2" providerName="System.Data.SqlClient" connectionString="string here" />
    </connectionStrings>
</configuration> 
```

然后您可以从应用程序中的任何位置引用它

# language-agnostic - 一台漂亮的打印机“统治他们”

> ID：251622
> 
> 赞同：5
> 
> 时间：2008-10-30T20:22:22.460
> 
> 标签：language-agnostic, pretty-print

我正在寻找一种可以以尽可能多的语言漂亮地打印（AKA 整洁或美化）源代码的工具。我特别热衷的包括：

*   爪哇
*   JSP
*   HTML
*   JavaScript
*   SQL
*   JSON
*   XML

理想情况下，该工具应该能够就地更新源文件，并且能够一次格式化多个文件。如果它可以格式化包含多种语言的文件（例如，包含 HTML、Java 和 JavaScript 源代码的 JSP），那就太好了，但这可能要求有点高。

我已经找到了一个似乎涵盖很多语言的[商业工具](http://www.polystyle.com/)，但免费的会更好:)

顺便说一句，我知道大多数语言都有一台漂亮的打印机，但我正在寻找的是“一站式商店”。

干杯，唐

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T20:33:01.550

我一直使用 Vim 来做这件事。它不能很好地处理 HTML，但它可以处理其他的。使用 Vim 命令很容易在多个文件上自动运行它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T20:45:28.623

[维基百科](http://en.wikipedia.org/wiki/Prettyprint#Code_Beautifiers)有一个很大的列表。不过，我有兴趣看看这里可能会出现什么共识。

几个处理多种语言；例如

PrettyPrinter，（每种编程语言的开源美化器）

UniversalIndentGUI（任何漂亮打印机的图形用户界面，带有格式设置的实时预览）

prettyprinter.de，（PHP、Java、C++、C、Perl、JavaScript、CSS 的在线美化工具）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-30T21:24:43.443

对于 Haskell，我有这个`~/bin/pp.hs`：

```
#!/usr/bin/env runhaskell
module Main (main) where
import Language.Haskell.Parser
import Language.Haskell.Pretty
import System.Environment
pp f = case parseModule f
        of ParseOk m -> prettyPrint m
           a -> show a
main = do args <- getArgs
          mapM_ (>>= putStrLn . pp) $
            if null args then [getContents] else map readFile args 
```

在 Vim 中`:set equalprg=~/bin/pp.hs`，选择一个区域，点击`=`，然后繁荣，它会被美化。

好吧，不是很笼统。但我认为如果我在这里添加它，它帮助某人的机会很小。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T20:53:45.877

Emacs 是我个人的最爱。有一些附加组件允许您使用几乎所有的语言。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T20:37:53.040

我使用[UltraEdit](http://www.ultraedit.com/)并发现它通常非常好。它不是免费的，但也不是那么贵。

# xml - 如何在 VS2008（或其他工具）中创建相当于 DataSet 或 DataTable 的 XML/XSD

> ID：251626
> 
> 赞同：1
> 
> 时间：2008-10-30T20:22:44.660
> 
> 标签：xml, visual-studio, visual-studio-2008, xsd

所以今天我不得不将一些带有数据的表从 MS Access 数据库中移动到 XML 中，以便在 Web 应用程序中使用。所以我认为在 Visual Studio 中将表结构定义为 XSD 文件，然后加载数据是一个简单的过程（为了简单起见，假设我会输入它）。好吧，对于我的生活，我无法弄清楚……我在谷歌上搜索了很多文章，但似乎没有任何内容适合我。

我想我的问题的简单形式是：是否可以（以图形方式）在 Visual Studio 中定义简单的 xml 模式，然后编辑其中包含的数据（在 VS 中，通过一个漂亮的网格界面）并将数据保存到 xml文件？

如果没有，是否有适合此的流行免费软件或开源工具？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T20:45:23.507

简单的方法是执行以下操作。

1.  使用 DataAdapter 读取数据并填充数据集
2.  将其绑定到 DataGrid 控件，进行更新
3.  接受对数据集的更改
4.  在 DataSet 和 volia 上调用 WriteXml() 方法！您有一个包含数据的 XML 文档。

# javascript - ExtJS 中有 map() 函数吗？

> ID：251636
> 
> 赞同：4
> 
> 时间：2008-10-30T20:25:29.477
> 
> 标签：javascript, map, extjs

ExtJS 有 Ext.each() 函数，但是否还有一个 map() 也隐藏在某个地方？

我很努力，但没有找到任何可以填补这个角色的东西。像 Ext 这样大的 JS 库显然必须具备，这似乎是一件简单而琐碎的事情。

或者当 Ext 真的不包含它时，将它添加到 Ext 的最佳方法是什么？当然，我可以写：

```
Ext.map = function(arr, f) { ... }; 
```

但这真的是正确的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-04-04T14:09:25.103

至少从 Ext4 开始，包括 Ext.Array.map。

[http://docs.sencha.com/extjs/5.0.1/#!/api/Ext.Array-method-map](http://docs.sencha.com/extjs/5.0.1/#!/api/Ext.Array-method-map)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T20:40:32.753

因为`map`它更像是一个实用程序，所以我不明白为什么会有任何特殊的方式将其插入 Ext 命名空间；您建议的方式会足够好，尽管您可能希望这样做：

```
if(Ext && typeof(Ext.map) == "undefined") { // only if Ext exists & map isn't already defined
   Ext.map = function(arr, f) { ... };
} 
```

似乎这样就可以了……但是，我不使用 ExtJS，所以我不知道。我确实看过他们的文档，在这种情况下似乎没有什么特别的事情要做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T22:54:53.807

看来，我这里的大学正在使用[ext-basex](http://code.google.com/p/ext-basex/)，它使用 map() 和其他方法扩展了 Array.prototype。

所以我可以写：

```
[1, 2, 3].map( function(){ ... } ); 
```

问题解决了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T16:53:29.227

使用 Ext+Prototype 或 Ext+Jquery 等混合库之一怎么样？我已经使用 Extjs+Prototypejs 有一段时间了，它对我在 Extjs 代码中的工作有很大帮助，同时还有更熟悉的prototypejs。

[http://extjs.com/products/extjs/build/](http://extjs.com/products/extjs/build/) 将构建一个自定义 tar/zip 文件，其中包含运行 extjs 和 (prototypejs|jquery|yahooUI) 所需的所有文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T23:40:47.537

ExtJS 不会取代 Javascript 语言本身。数组函数不是 ExtJS 核心的重点。但是有一个特殊的 Ext.Array 对象类型。您可以自行扩展它。

编辑：不是 Ext.Array，而只是扩展的 Array 对象。

# windows - Windows API 彩色输出到 Powershell/cmd.exe 中的标准输出

> ID：251637
> 
> 赞同：4
> 
> 时间：2008-10-30T20:25:40.210
> 
> 标签：windows, colors, stdout, command-line-interface

任何人都知道在哪里可以找到描述如何使用 API 和/或标准输出在 Windows CLI 界面上输出颜色的参考资料？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T20:48:15.640

Win32[控制台 API](http://msdn.microsoft.com/en-us/library/ms682010.aspx)有一个函数 [SetConsoleTextAttribute](http://msdn.microsoft.com/en-us/library/ms686047.aspx)，可用于设置文本的前景色和背景色。示例代码在[这里](http://msdn.microsoft.com/en-us/library/ms686974.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T20:43:12.920

至少有颜色命令：

```
color bg fg 
```

在哪里：

```
0: Black
1: Blue
2: Green
3: Cyan
4: Red
5: Purple
6: Yellow
7: Gray
8: Silver
9: Light blue
A: Lime
B: Light cyan
C: Light red
D: Light purple
E: Light yellow
F: White 
```

例子：

```
color 80 
```

给出带有黑色文本的银色背景。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T20:48:30.037

不完全是参考，但它应该可以帮助您在 MSDN 上找到您要查找的内容，请查看：

[http://www.gamedev.net/community/forums/topic.asp?topic_id=457528](http://www.gamedev.net/community/forums/topic.asp?topic_id=457528)。

您可能想查找“WriteConsoleOutput”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T20:46:53.987

在 powershell write-host 中采用 -backgroundcolor 和 -foregroundcolor 参数

# web-services - 为什么使用带有 Linq to SQL 的 Web 服务？

> ID：251640
> 
> 赞同：4
> 
> 时间：2008-10-30T20:26:33.000
> 
> 标签：web-services, linq-to-sql

谁能告诉我使用带有 asp.net gui 的 Web 服务和使用 Linq to SQL 的需要/优势是什么？Web 服务层似乎没有必要。Linq to SQL 对我来说是全新的，我正在研究，因为我正在建立一个新项目。有人对这个有经验么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T20:32:18.307

您将为其他应用程序可能需要访问您的数据的情况（例如智能客户端、另一个应用程序、winforms 应用程序等）公开服务。很多人会使用 Web 服务进行开发，以防止自己在未来不得不重组到 Web 服务。

在几乎所有专业/企业 Web 应用程序中，您都希望将 UI 层与数据访问层分开，这样您就不会在 UI 层中嵌入 Linq to SQL 调用。相反，您将在两者之间有一个服务层，无论是它的 Web 服务、WCF，还是只是一个带有业务逻辑的 DLL，用于协调您的数据访问层。独立层更易于维护、更新、重构和学习，因此在创建它们方面的前期投资是值得的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T20:29:54.723

这当然不是必需的，但如果您想将数据访问层保持在与表示服务器 (ASP.NET) 不同的服务器上，它会很方便。Web 服务允许您将两个服务器之间的通信限制为仅端口 80。

请注意，这也适用于普通的旧 ADO.NET 或其他任何东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T20:57:19.270

Web 服务成为一个分离层，因为它们旨在作为一种与平台无关的方式将数据发送到其他软件。它们是向其他软件提供信息而不是直接向用户提供信息的网站。
WebService 是对网站进行大修的分离层，并不能完全取代良好的数据、业务逻辑和 UI 分离。
按照您的逻辑执行此操作，但要注意如果您不需要与其他软件通信，您付出的性能下降。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T23:47:13.437

完全同意 Ovidiu Pacurar。Web 服务不是对关注层建模的好选择。您应该使用良好的老式 OO 设计来做到这一点。Web 应用程序没有理由在其自身内部调用 Web 服务以进行数据访问，除非它们是为客户端 ajax 调用而设计的，或者如果出于极端安全考虑需要在另一台服务器上运行业务/数据层。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T20:35:57.130

同意之前的海报。您可能希望这样做以应用“关注点分离”的想法......

# oracle - 无论如何在 Oracle 10gR2 中声明一个没有属性的 TYPE

> ID：251648
> 
> 赞同：2
> 
> 时间：2008-10-30T20:27:58.970
> 
> 标签：oracle, inheritance, types

我想创建一个只有方法的基础对象。该对象将是`QUEUABLE_OBJECT_TYPE`并且它将具有一个`ENQUEUE`方法。这些消息（属性）的有效负载将通过子类型化此对象来添加。

我收到一个错误，听起来好像您不能：

> PLS-00589：在对象类型“QUEUABLE_OBJECT_TYPE”中找不到属性

有谁知道解决此错误的方法？或者是否可以在子类型中隐藏超类型的这个属性？

要么是一个可以接受的答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T00:30:38.717

我读过的所有内容都表明不可能创建没有任何属性的类型。也不可能在子类型中隐藏虚拟属性。您可能只需要在主类型中有一个属性，并利用它——例如，通过使其识别类型的版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T09:14:25.633

Oracle 确实提供了一些泛型类型，[请参阅文档了解详细信息](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14260/adobjadv.htm#sthref948)

# oracle - 如何让我的 DBA 暂停并恢复更新大表中每一行的存储过程？

> ID：251651
> 
> 赞同：4
> 
> 时间：2008-10-30T20:28:49.250
> 
> 标签：oracle

我有一个大约一百万行的表，我需要用冗长的计算结果来更新表中的每一行（每行的计算结果可能不同）。因为它很耗时，所以 DBA 必须能够控制执行。这个特殊的计算需要每年运行一次（它会做一个年终总结）。我想使用 DBMS_SCHEDULER.CREATE_JOB 创建一个作业，该作业将从表中获取 100 行，更新它们然后停止；然后，下一次执行作业将在先前执行停止的地方继续执行。

我的第一个想法是在存储过程的末尾包含此代码：

```
-- update 100 rows, storing the primary key of the last
-- updated row in last_id
-- make a new job that will run in about a minute and will
-- start from the primary key value just after last_id
dbms_scheduler.create_job
( job_name=>'yearly_summary'
, job_type=>'STORED_PROCEDURE'
, job_action=>'yearly_summary_proc(' || last_id || ')'
, start_date=>CURRENT_TIMESTAMP + 1/24/60
, enabled=>TRUE
); 
```

但是当存储过程运行时出现此错误：

```
ORA-27486: insufficient privileges
ORA-06512: at "SYS.DBMS_ISCHED", line 99
ORA-06512: at "SYS.DBMS_SCHEDULER", line 262
ORA-06512: at "JBUI.YEARLY_SUMMARY_PROC", line 37
ORA-06512: at line 1 
```

欢迎提出其他方法的建议。我更喜欢使用 DBMS_SCHEDULER 并且我不想创建任何表；这就是我将 last_id 传递给存储过程的原因。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T20:51:45.193

我倾向于对使用这样的作业来控制执行持谨慎态度。连续作业之间的延迟往往太短，以至于 DBA 无法确定要终止/暂停/等的作业，或者延迟足够长，以至于运行时间的很大一部分将花费在连续作业之间的延迟上.

在不创建任何新对象的情况下，您可以使用[DBMS_ALERT](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_alert.htm#CHDCFHCI)包来允许您的 DBA 发送暂停作业的警报。您的代码可以`DBMS_ALERT.WAITONE`每隔一百行调用一次该方法，以检查 DBA 是否已发出特定警报（即`PAUSE_YEAREND_JOB`警报）。如果没有收到警报，代码可以继续。如果收到警报，您可以暂停代码，直到`RESUME_YEAREND_JOB`收到另一个警报（`PAUSE_YEAREND_JOB`即暂停的日期等）

当然，您可以通过创建一个新表来执行相同的操作，让 DBA 向表中写入一行以暂停作业，并每隔 N 行从表中读取一次。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T20:54:48.963

另一个探索的途径是 dbms 调度程序的支持工具，用于执行窗口和资源计划。

[http://www.oracle-base.com/articles/10g/Scheduler10g.php](http://www.oracle-base.com/articles/10g/Scheduler10g.php)

并且：

[http://download-west.oracle.com/docs/cd/B19306_01/server.102/b14231/schedover.htm#sthref3501](http://download-west.oracle.com/docs/cd/B19306_01/server.102/b14231/schedover.htm#sthref3501)

使用窗口和资源计划，您的 DBA 可以简单地配置系统以执行您的过程以遵守某些规则 - 包括作业窗口和仅使用一定数量的资源（即 CPU 使用率）执行。

这样程序可以每年运行一次，并且可以控制 CPU 使用率。

虽然这可能无法提供您的 DBA 想要的手动控制。

另一个想法是编写您的程序来处理所有记录，但每 1000 次左右提交一次。如果您的 DBA 希望停止作业，可以使用 dbms job.cancel() 命令取消作业，然后他们可以在准备就绪时恢复它（通过重新安排或重新运行它）。诀窍是该过程需要能够跟踪处理的行，例如使用“processed_date”列，或列出主键和处理日期的单独表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T05:45:58.470

除了关于 的答案之外`DBMS_ALERT`，您的 DBA 还希望能够看到您的存储过程在哪里。您应该使用[`DBMS_APPLICATION_INFO.SET_SESSION_LONGOPS`](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/d_appinf.htm#sthref412)Oracle 中的功能来执行此操作。

# javascript - 如何使用 javascript 访问 BadgerFish 标记的属性？

> ID：251659
> 
> 赞同：0
> 
> 时间：2008-10-30T20:31:49.120
> 
> 标签：javascript, ruby-on-rails, xml, json

我用 cobravsmongoose 从 ruby​​ 创建了一个 json 对象，但是属性**`@`**前面有符号。每当我尝试使用 JavaScript 中的标准对象表示法访问它们时，例如`object.object.object.@attribute`我得到一个*parse error*。还有其他方法可以访问这些对象吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T20:34:56.367

将您的 JSON 作为字符串获取。执行替换以清理 @ 符号，并将其重新创建为 JSON。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T20:37:30.433

您还可以使用下标表示法访问您的对象属性：

```
object.object['@attribute'] 
```

但最好按照@Diodeus 的建议去做

# c# - 在 Web 用户控件中检查 Shift+Click 或 Ctrl+Click

> ID：251675
> 
> 赞同：1
> 
> 时间：2008-10-30T20:35:15.760
> 
> 标签：c#, asp.net, user-controls

我需要生成一个 Web 用户控件（在 C# 中），该控件在单击时会表现出不同的行为，具体取决于当时是否按下了 shift（或 control）键。控件本身将包含一个 ImageButton 和/或 Hyperlink。

这可能吗？

基本上，如果登录用户是管理员，那么我需要允许他们访问以更新关联的 URL。我不想为此管理员设置单独的页面，因为它会引起混乱。

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T20:37:47.750

[这里](http://www.javascripter.net/faq/ctrl_alt.htm)怎么样？

要实现`Ctrl`//检测`Alt`，`Shift`您可以使用 properties `event.ctrlKey`、`event.altKey`和`event.shiftKey`已弃用的 Navigator-specific property `event.modifiers`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T21:30:13.090

我不鼓励这样做，因为它会使您在使用不同的浏览器版本时遇到严重的麻烦。

只要您没有明确地针对一个浏览器，您就会一直在为各种浏览器进行维护工作。

解决此问题的一种方法是找到支持此行为的受支持的 Javascript 库（如 jQuery），并让该库的维护者关心浏览器兼容性（然后您仍然需要更新该库..）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T20:40:19.400

您的控件需要发出一些 javascript 来检测单击它时正在按下的键。

[这是 w3schools 关于 events 的入门](http://w3schools.com/js/js_events.asp)，[这里是](https://developer.mozilla.org/en/DOM/window#Event_Handlers)您可以收听的`window`对象的事件列表（例如键盘按下的 onkeydown）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T13:32:24.780

好吧，“权力”已经决定 Shift/Ctrl + Click 方法太笨重了。

在头脑风暴会议之后，我们决定沿着在控件旁边显示一个小的“编辑”按钮的路线走下去。这仅对管理员用户可见，我在大约两个小时内将其汇总在一起。

感谢您抽出宝贵时间提供您的意见。

有高代表的人可以帮我解决这个问题 - 谢谢。

# php - 使用 PHP 的数组上的 MAX 和 MIN 值

> ID：251688
> 
> 赞同：1
> 
> 时间：2008-10-30T20:40:26.763
> 
> 标签：php, arrays

有谁知道如何获得 PHP 中第二列和第三列的最大值和最小值？

```
$ar = array(array(1,  10,   9.0,   'HELLO'),
            array(1,  11,  12.9,   'HELLO'),
            array(3,  12,  10.9,   'HELLO')); 
```

输出应该是这样的：

最大(12.9) 最小(10)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T20:58:59.377

另外一个选项

```
<?php

function array_rotate( $array )
{
    $rotated = array();
    foreach ( $array as $rowIndex => $col )
    {
        foreach ( $col as $colIndex => $value )
        {
            $rotated[$colIndex][$rowIndex] = $value;
        }
    }
    return $rotated;
}

$ar = array(array(1,  10,   9.0,   'HELLO'),
            array(1,  11,  12.9,   'HELLO'),
            array(3,  12,  10.9,   'HELLO'));

$ar = array_rotate( $ar );

echo max( $ar[2] ), "\n", min( $ar[1] ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T20:50:33.247

```
<?php
$ar = array(array(1,  10,   9.0,   'HELLO'),
            array(1,  11,  12.9,   'HELLO'),
            array(3,  12,  10.9,   'HELLO'));
function col($tbl,$col){
    $ret = array();
    foreach ($tbl as $row){
        $ret[count($ret)+1] = $row[$col];
    }
    return $ret;
}
print (max(col($ar,2))."\n");
print (min(col($ar,1))."\n");
?> 
```

这是你要找的吗？我想这不是最有效的方法。

# windows - 使用不受支持的 Win32 GDI 笔模式有问题吗？

> ID：251693
> 
> 赞同：1
> 
> 时间：2008-10-30T20:41:49.397
> 
> 标签：windows, winapi, drawing, gdi

MSDN[文档](http://msdn.microsoft.com/en-us/library/ms535223(VS.85).aspx)（有些）清楚地说明了有关 GDI Pen 的以下两个事实：

1.  化妆笔（通过 CreatePen 或 ExtCreatePen w/ PS_COSMETIC 创建）必须为 1 个*单位*宽（嗯，<= 1，但我们不要去那里）。

2.  ~~几何 (ExtCreatePen w/ PS_GEOMETRIC) 笔必须是实心的（仅限 PS_SOLID，无 PS_DASH 等）。然而，它们可以画出更粗的线条。~~ *这在我上面的链接中清楚地记录为只有 9 倍的限制（我很愚蠢）。为了我的辩护，我的代码中的（坏的）评论和（破碎的）逻辑让我不相信。其他一些谷歌搜索的文章一定是只针对 Windows 9x 编写的。*

**为什么我可以违反这些规则并让 GDI 愉快地用这些笔画画？**

我可以创建胖（例如宽度 = 10）化妆笔**和**虚线几何笔。哎呀，我可以创建一个粗大的虚线几何笔！

这些笔似乎*通常*可以正常工作。我看到的唯一问题是在折线中，当我通过非常大的点数组时 - 它渲染线条的速度非常慢。但是，Polyline 通常对大型阵列的行为很奇怪 - 它与*坏*笔的行为不同。（我的其他折线问题可能是另一个问题......）

**~~使用宽化妆笔或带有图案的宽几何~~笔是否安全？**

 ~~* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T22:04:45.127

一般来说，您应该遵守记录在案的 API，否则您可能会依赖操作系统版本的特定行为。

您描述的`ExtCreatePen`限制（例如，不`PS_DASH`带`PS_GEOMETRIC`）仅适用于 Win9x，不适用于 WinNT，因此在 NT/2000/XP 上，您的“粗虚线几何笔”应该不是问题。另请注意，[`Polyline`](http://msdn.microsoft.com/en-us/library/ms534241.aspx)对 Win9x 有一些限制。

如果您想要虚线，我建议`PS_USERSTYLE`您使用它来控制虚线和间隙的长度，而不是依赖于默认值`PS_DASH`。

# perl - 如果已安装，我如何需要可选的 Perl 模块？

> ID：251694
> 
> 赞同：55
> 
> 时间：2008-10-30T20:41:58.757
> 
> 标签：perl, module, require

我有依赖于`Term::ReadKey`获取终端宽度的 Perl 代码。我的安装缺少这个模块，所以如果模块不存在，我想提供一个默认值而不是抛出异常。

我如何有条件地使用可选模块，而不提前知道它是否可用。

```
# but only if the module is installed and exists
use Term::ReadKey;
... 
```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-10-30T21:07:56.050

这是一个不需要其他模块的简单解决方案：

```
my $rc = eval
{
  require Term::ReadKey;
  Term::ReadKey->import();
  1;
};

if($rc)
{
  # Term::ReadKey loaded and imported successfully
  ...
} 
```

请注意，下面所有使用的答案（我希望它们低于这个答案！:-)`eval { use SomeModule }`都是错误的，因为`use`语句是在编译时评估的，无论它们出现在代码中的什么位置。因此，如果`SomeModule`不可用，脚本将在编译后立即死亡。

（`use`语句的字符串 eval 也可以工作 ( )，但是当/对做同样的事情`eval 'use SomeModule';`时，在运行时解析和编译新代码是没有意义的，并且在编译时进行语法检查以启动。）`require``import`

最后，请注意，我在此处使用`eval { ... }`and`$@`是为了本示例的目的而简洁。在实际代码中，您应该使用[Try::Tiny](http://search.cpan.org/dist/Try-Tiny/)之类的东西，或者至少[要注意它解决的问题](http://search.cpan.org/dist/Try-Tiny/lib/Try/Tiny.pm#BACKGROUND)。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-30T20:53:46.890

查看 CPAN 模块[Module::Load::Conditional](http://search.cpan.org/perldoc?Module::Load::Conditional)。它会做你想做的事。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-30T21:23:59.000

经典的答案（至少可以追溯到 Perl 4，早在“使用”出现之前）是“require()”一个模块。这是在脚本运行时执行的，而不是在编译时执行的，您可以测试成功或失败并做出适当的反应。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-04T10:35:48.817

如果您需要特定版本的模块：

```
my $GOT_READKEY;
BEGIN {
    eval {
        require Term::ReadKey;
        Term::ReadKey->import();
        $GOT_READKEY = 1 if $Term::ReadKey::VERSION >= 2.30;
    };
}

# elsewhere in the code
if ($GOT_READKEY) {
    # ...
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-05T06:43:47.767

```
if  (eval {require Term::ReadKey;1;} ne 1) {
# if module can't load
} else {
Term::ReadKey->import();
} 
```

或者

```
if  (eval {require Term::ReadKey;1;}) {
#module loaded
Term::ReadKey->import();
} 
```

注意：只有在正确加载的情况下`1;`才会执行。`require Term::...`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2021-01-07T10:45:33.727

```
use Module::Load::Conditional qw(check_install);

use if check_install(module => 'Clipboard') != undef, 'Clipboard'; # class methods: paste, copy 
```

使用[if](https://perldoc.perl.org/if) pragma 和[Module::Load::Conditional](https://perldoc.perl.org/Module::Load::Conditional)核心模块。

[check_install](https://perldoc.perl.org/Module::Load::Conditional#$href-=-check_install(-module-=%3E-NAME-%5B,-version-=%3E-VERSION,-verbose-=%3E-BOOL-%5D-);)返回 hashref 或`undef`.

* * *

[该模块也在编译指示文档的另见](https://perldoc.perl.org/if)部分中提到：

> Module::Load::Conditional provides a number of functions you can use to query what modules are available, and then load one or more of them at runtime.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-11-20T01:49:20.057

这是加载可选模块的有效习惯用法（[只要您没有在带有 sigdie 处理程序的代码库中使用它](https://stackoverflow.com/q/65835906/124486)），

```
use constant HAS_MODULE => defined eval { require Module }; 
```

如果可用，这将需要模块，并将状态存储在常量中。

你可以这样使用，

```
use constant HAS_READLINE => defined eval { require Term::ReadKey };

my $width = 80;
if ( HAS_READLINE ) {
  $width = # ... code, override default.
} 
```

请注意，如果您需要导入它并引入符号，您也可以轻松地做到这一点。你可以跟进。

```
use constant HAS_READLINE => defined eval { require Term::ReadKey };
Term::ReadKey->import if HAS_READLINE; 
```

此方法使用常量。这样做的好处是，如果您没有此模块，则会从 optree 中清除死代码路径。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2014-10-23T00:45:28.530

我认为使用变量时它不起作用。请检查[这个链接](http://perldoc.perl.org/functions/require.html)，它解释了它如何与变量一起使用

```
$class = 'Foo::Bar';
        require $class;       # $class is not a bareword
    #or
        require "Foo::Bar";   # not a bareword because of the "" 
```

require 函数将在@INC 数组中查找“Foo::Bar”文件，并会抱怨在那里找不到“Foo::Bar”。在这种情况下，您可以这样做：

```
 eval "require $class"; 
```

# javascript - 阅读/设置 IE 选项的最佳方式？

> ID：251696
> 
> 赞同：0
> 
> 时间：2008-10-30T20:43:09.893
> 
> 标签：javascript, internet-explorer, settings, registry

从 Javascript 网页读取和/或设置 Internet Explorer 选项的最佳方法是什么？我知道这些在注册表设置中。

例如，我正在使用[JavaScript Diagram Builder](http://www.lutanho.net/diagram/)在网页中动态生成条形图。这使用浮动 DIV 中的背景颜色来生成条形图。我希望能够读取用于打印背景颜色的浏览器设置，如果未选中，要么警告用户颜色不会打印，要么以编程方式选择此选项。

编辑：当我想到做类似事情的产品时，我认为他们大多只是测试是否禁用 Java、JavaScript 或 Cookie，这可以在不读取注册表的情况下完成。

所以我想大家的共识是不应该尝试我想做的事情。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T20:45:25.380

网页没有业务阅读用户的设置，所以没有这个界面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T21:25:44.080

您可以使用巨大的左边框而不是使用背景颜色来设置条形的样式。

像这样：

```
<style>
    div.bar
    {
      width:1px;
      border-left:10px solid red;
    }
</style>
<div class="bar" style="height:100px"></div> 
```

显然取决于您使用的产品的多功能性。但我不明白为什么至少在打印样式表中这样做会造成伤害。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T20:44:54.990

听起来这将是一个很大的安全漏洞，IE 团队会牢牢把握住这个漏洞

# perl - 如何在没有安装权限的情况下使用新的 Perl 模块？

> ID：251705
> 
> 赞同：28
> 
> 时间：2008-10-30T20:46:30.183
> 
> 标签：perl, permissions, installation, module, cpan

这是我的情况：我对 Perl 几乎一无所知，但它是移植机器上唯一可用的语言。我只有在我的本地工作区而不是 Perl 安装位置中写入的权限。我需要使用 CPAN 中的[Parallel::ForkManager](http://search.cpan.org/dist/Parallel-ForkManager) Perl 模块

如何在不进行中央安装的情况下使用此 Parallel::ForkManager？是否有我可以设置的环境变量以便将其定位？

谢谢

京东

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-10-30T21:01:37.467

来自[perlfaq8：如何保留自己的模块/库目录？](http://faq.perl.org/perlfaq8.html#How_do_I_keep_my_own)：

当你构建模块时，告诉 Perl 在哪里安装模块。

对于基于 C 的发行版，在生成 Makefile 时使用 INSTALL_BASE 选项：

```
perl Makefile.PL INSTALL_BASE=/mydir/perl 
```

您可以在您的 CPAN.pm 配置中进行设置，以便在您使用 CPAN.pm shell 时模块自动安装在您的私有库目录中：

```
% cpan
cpan> o conf makepl_arg INSTALL_BASE=/mydir/perl
cpan> o conf commit 
```

对于基于 C 的发行版，使用 --install_base 选项：

```
perl Build.PL --install_base /mydir/perl 
```

您也可以将 CPAN.pm 配置为自动使用此选项：

```
% cpan
cpan> o conf mbuild_arg --install_base /mydir/perl
cpan> o conf commit 
```

INSTALL_BASE 告诉这些工具将您的模块放入 F。有关如何运行新安装的模块的详细信息，请参见 L。

不过，INSTALL_BASE 有一个警告，因为它与旧版本的 ExtUtils::MakeMaker 提倡的 PREFIX 和 LIB 设置不同。INSTALL_BASE 不支持在同一目录下安装多个版本的 Perl 或不同体系结构的模块。您应该考虑是否真的需要，如果需要，请使用旧的 PREFIX 和 LIB 设置。有关详细信息，请参阅 ExtUtils::Makemaker 文档。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2014-02-20T14:59:12.273

将包形式 CPAN 下载到文件夹：

```
wget http://search.cpan.org/CPAN/authors/id/S/SZ/SZABGAB/Parallel-ForkManager-1.06.tar.gz
gunzip Parallel-ForkManager-1.06.tar.gz
tar -xvf Parallel-ForkManager-1.06.tar 
```

在此之前在 home 中创建一个文件夹来存储您的本地模块，现在进入下载的文件夹并运行以下命令：

```
perl Makefile.PL PREFIX=/home/username/myModules
make
make test
make install 
```

从已安装的文件夹中获取 ForkManager 的路径，/home/username/myModules 并找到 Parallel 文件夹并获取它的完整路径。

现在在你的 perl 文件中把这些放在开头

```
use lib '/home/username/myModules/bin.../Parallel';
use parallel::ForkManager; 
```

——应该这样做。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-30T21:01:44.363

查看Mark Dominus的[这篇文章](http://blog.plover.com/prog/lib.html)

摘抄：

> *   构建 Makefile 时设置 PREFIX=X
> *   在构建 Makefile 时设置 INSTALLDIRS=vendor 和 VENDORPREFIX=X
>     *   或者，您可能需要设置 INSTALLVENDORLIB 或其他东西，而不是 VENDORPREFIX
>     *   或者也许不是在构建 Makefile 时设置它们，而是在运行 make install 目标时设置它们
> *   构建 Makefile 时设置 LIB=X/lib
> *   使用 PAR
> *   使用本地::lib

Mark还在他的博客中提供了另一个解决方案，它需要更多的空间来描述，但归结为运行make和make test而不是make install，然后使用blib/中的东西。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-30T21:19:30.130

有 PERL5LIB 环境变量，`-I`在使用模块时在命令行上。有告诉 CPAN 和 CPANPLUS 的机制。

CPAN 手册的问题 5 中有信息（perldoc CPAN，或查看[CPAN](http://search.cpan.org/)本身）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-30T21:15:29.547

```
use lib 'directory';
use Parallel::ForkManager; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-30T21:04:16.013

您可以使用`-I`（大写 i）命令行开关，后跟放置模块的目录；或尝试使用“use lib”指令，后跟目录。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-02T09:12:04.383

[是的，即使您可以使用 CPAN](http://perlmonks.org/?node_id=693828)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-08-27T14:52:41.737

```
perl Makefile.PL LIB=/my/perl_modules/lib/
make
make install
PERL5LIB=$PERL5LIB:/my/perl_modules/lib/
perl myperlcode.pl 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-11-01T10:08:10.813

使用`cpanm -l $DIR_NAME`选项。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-09-12T13:25:50.903

[`perlbrew`](https://perlbrew.pl)允许您使用本地 perl 并将其包安装到本地目录。

```
\curl -L https://install.perlbrew.pl | bash

perlbrew init  # put this in .bash_profile etc

perlbrew install 5.27.11

perlbrew switch 5.27.11 
```

另请参阅[https://opensource.com/article/18/7/perlbrew](https://opensource.com/article/18/7/perlbrew)。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-06-13T12:03:23.117

考虑使用 cpanminus，[这是另一个线程上的建议](https://stackoverflow.com/questions/2980297/how-to-use-cpan-as-a-non-root-user)

# visual-studio-2008 - 获取具有特定子元素集的项目（高级查询 - 可能吗？）

> ID：251711
> 
> 赞同：2
> 
> 时间：2008-10-30T20:47:25.173
> 
> 标签：visual-studio-2008, linq, linq-to-sql, .net-3.5

我有一个包含以下设计的 SQL 数据库 (SQL Server 2008)

## 物品

*   ID（整数，身份）
*   名称 (NVarChar(50))
*   说明 (NVarChar(200))

## 元

*   ID（整数，身份）
*   名称 (NVarChar(50))

这两者之间存在 NN 关系，即一个 Item 可以包含零个或多个元引用，而一个元可以与多个 item 相关联。每个元只能与同一个项目关联一次。这意味着我在中间有一张经典的桌子

## 项目美达

*   项目 ID（整数）
*   元ID（整数）

我想执行一个 LinqToSql 查询来提取包含一组特定元链接的所有项目实体。例如，给我所有与它相关联的元项目的项目

*   车
*   福特
*   越野

是否可以借助 LinqToSql 编写这样的查询？让我再提供一些要求

*   我将有一个 Meta 标签列表，我想用它来过滤将要返回的项目（例如在上面的示例中，我有 Car、Ford 和 Offroad）
*   一个项目可以有比我在匹配中提供的更多的元项目，即如果一个项目有 Car、Ford、Offroad 和 Red 关联到它，那么在过滤器中提供它们的任何组合都会导致匹配
*   然而，过滤器中提供的所有元名称必须与一个项目相关联，以便在结果集中返回。因此，发送 Car、Ford、Offroad 和 Red 不应与具有 Car、Ford 和 Offroad（非红色）关联的项目匹配

我希望它清楚我想要实现的目标，我觉得我没有我希望的那么清楚 =/ 让我们希望它足够 :)

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T05:09:22.600

这应该适合你：

```
string[] criteria = new[] { "Car", "Ford", "Offroad" };

var items = 
    from i in db.Item
    let wantedMetas = db.Meta.Where(m => criteria.Contains(m.Name))
    let metas = i.ItemMeta.Select(im => im.Meta)
    where wantedMetas.All(m => metas.Contains(m))
    select i; 
```

基本上，它将“想要的”元数据与每个项目的元数据进行比较，并选择具有所有想要的元数据（或更多）的项目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T22:38:00.160

这会带回与任何元标准匹配的任何内容，然后将其过滤为仅匹配所有条件的内容。（另外，请记住，您需要在数据上下文中定义您的关系）。如果您需要澄清，请告诉我们。

```
var db = new YourDataContext();
var possibleItems = (from m in db.Metas where <meta criteria> select m.ItemMetas.Item);

var items = possibleItems.GroupBy(y=>y).Where(x=>x.Count() == criteriaCount).Select(x=>x.Key); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T23:36:25.753

您可以通过计算过滤后的元数据来过滤项目。

```
List<string> metaList = new List<string>() { "Car", "Ford", "Offroad" };
int metaListCount = metaList.Count;
List<Item> result =
  db.Items
  .Where(i => metaListCount ==
    i.ItemMeta.Meta
    .Where(m => metaList.Contains(m.Name))
    .Count()
  )
  .ToList(); 
```

请注意，此内存中的集合有一个上限。包含由 SqlServer 的参数限制强加（它是 ~200 或 ~2000，我不记得了）。

# c# - Silverlight、Wpf Web App (xbap) 还是 Click Once？优点和缺点

> ID：251718
> 
> 赞同：37
> 
> 时间：2008-10-30T20:48:39.227
> 
> 标签：c#, .net, wpf, silverlight

我们正在开始一个新项目，我正在尝试决定我们应该采用哪种 Wpf 式开发/部署策略。在我们的案例中，我们正在研究一个相当复杂的商业应用程序，它将被 100 人（而不是 1000 人）使用，所以我倾向于点击一次应用程序。我的老板喜欢 Silverlight 应用程序的想法，因为它意味着更容易部署。那么我们应该往哪个方向跳呢？

答案当然是“视情况而定”。那么各有什么优缺点呢？

我将开始滚动（在[artur carvalho](https://stackoverflow.com/users/1013/artur-carvalho "artur carvalho")的一些答案中添加了**编辑**）：

* * *

银光

*   优点

跨浏览器
不需要完整的框架。
更好地控制用户。如果您的用户登录，您不必担心激活密钥或类似的东西。
它适用于 Windows 和 Mac。
您可以轻松更新所有用户的应用程序。

*   缺点

无法与客户端的文件系统等交互 与
完整的 Wpf 相比，功能较少（有人有记录差异的好资源吗？）
单窗口
单版本

* * *

Wpf Web 应用程序 (xbap)

*   优点

完整的 Wpf。

*   缺点

单一浏览器
需要完整的框架
不能与客户端的文件系统等交互
单一窗口
单一版本

* * *

Wpf 单击一次

*   优点

完整的 Wpf
可以离线工作
多个窗口
多个版本 (con?)
更好地访问计算机的低级部分
无需停机维护

*   缺点

单一浏览器
需要完整的框架安装起来
*稍微*困难一些（？）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T20:55:08.387

首先，我会评估一个 Web 客户端（最好是 MVC+jQuery）是否无法完成这项工作......

假设一个完整的客户是有保证的：

如果它是一个需要客户端的商业应用程序，我会倾向于使用完整的框架和 ClickOnce；这里的主要区别（重新部署）是客户端必须安装框架 - 但除此之外，ClickOnce 部署非常轻松。实际上，构建 ClickOnce 清单比 Silverlight 等要*容易*得多，因为 IDE 将为您完成几乎所有工作；您只需将文件托管在某处（可以是 Web URL；可以是网络 UNC）。

这为您在客户端提供*了*更多的控制（和权力），以及更大范围的现有资源可供使用（例如，如果需要，您可以在 WPF 表面上使用一些遗留的 winform 代码）。“需要完整的框架”也是最大的好处之一：“有完整的框架”。

您或许还应该考虑 3.5“客户配置文件”设置；不确定这在现实中有多广泛……但值得了解。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-10T17:31:38.290

您没有说这是仅限公司的应用程序还是面向公众的应用程序。仅此一项将为您决定。

如果只有公司，我会使用完整的 WPF 点击一次。这会给你一切。完整的框架应该不是问题。这是在后台运行的一次性安装，因此您的决定不应依赖于此。缺点：它只能在 Windows 中运行，但如果您的公司只有 Windows，这应该不是问题。

但是 WPF 应用程序可能会占用大量资源，因此您需要知道您的所有客户端计算机是否能够顺利运行 WPF 应用程序。

如果它是 Internet 应用程序，请选择 Silverlight：它在不同的操作系统下运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T16:44:45.623

专业人士

1.  Silverlight 插件意味着开发人员可以针对基于浏览器的应用程序的单一、一致的运行时，而不是处理不同版本的多个浏览器的复杂性。您还可以获得纯 HTML 和 JavaScript 很难或不可能实现的视频和多媒体效果，尽管 Adob​​e Systems 的 Flash 具有相同的优势。
2.  执行 .NET 代码而不部署 .NET 运行时。Silverlight 插件确实包含一个精简的 .NET 运行时，但不是处理大量下载和 Windows 安装程序的复杂性，用户只需下载大约 4MB 的小下载，所有这些都在浏览器中处理。以我目前的经验，安装是顺利和容易的。
3.  业绩可期。Silverlight 在这个素数计算器中表现出色，这无疑要归功于 JIT 编译为本机代码，尽管它在渲染图形方面可能不太好。
4.  对 Moonlight 的支持意味着将有 Silverlight 的官方开源实现，从而减轻专有方面的影响。
5.  Silverlight 直接解释 XAML，而 Adob​​e 的 XML GUI 语言 MXML 在编译时被转换为 SWF。事实上，XAML 页面作为资源包含在用于部署 Silverlight 应用程序的已编译 .XAP 二进制文件中。.XAP 文件只是具有不同扩展名的 ZIP。这也意味着搜索引擎可能会在 Silverlight 应用程序中为文本建立索引，就像使用 Flash 一样。
6.  第三方组件供应商已经很好地使用 Silverlight 附加组件。例如，Infragistics、ComponentOne 和 DevExpress。
7.  让您的 .NET 代码跨平台。随着 Mac 随处可见，将 Visual Basic 或 C# 代码迁移到跨平台、基于浏览器的 Silverlight 客户端的能力将越来越有用。显然，这只适用于现有的 .NET 开发人员——我猜这是 Silverlight 的主要市场，但它是一个很大的市场。这同样适用于下一点：
8.  使用 Visual Studio。Microsoft 的 IDE 是一个成熟且广受欢迎的开发环境，由于它也是 ASP.NET 的工具，因此您可以将其用于服务器端代码以及 Silverlight 客户端。对于不熟悉 Visual Studio 的用户，Silverlight SDK 还支持命令行编译。
9.  选择你的语言。对多种语言的支持从一开始就是 .NET 的一部分，在 Silverlight 2.0 中拥有 .NET 运行时意味着您可以使用 C#、Visual Basic 或动态语言运行时 (DLR) Iron Ruby 编写客户端逻辑或铁蟒。
10.  隔离存储为 Silverlight 应用程序提供本地文件访问权限，但仅限于特定于应用程序的受保护位置，提供了一种相对安全的方式来获得此优势。

缺点

1.  如果 Apple 甚至不允许 iPhone 上使用 Flash，Silverlight 有什么机会？
2.  Silverlight 迟到了。Flash 成熟、值得信赖且无处不在。Silverlight 2 仅在秋季推出测试版（我们希望如此）。这是我们关心的版本 - 包含 .NET 运行时的版本 - 并且仍将缺乏对移动设备的支持，甚至是 Windows Mobile，尽管这将在未指定的某个日期承诺。
3.  设计工具是 Expression Blend 和 Expression Design - 但谁使用它们？设计界使用 Adob​​e PhotoShop。
4.  虽然 Expression Blend 和 Visual Studio 之间的解决方案兼容性听起来不错，但实际上不得不使用两个单独的工具很麻烦，尤其是当存在一些琐碎的不兼容性时，例如在当前的 beta 版本中。
5.  不支持流行的 H.264 视频编解码器。相反，Silverlight 的高清视频必须在 VC-1 中，这不太常见。
6.  这是促进专有技术而不是开放标准的另一项努力。
7.  是的，Linux 将通过 Moonlight 得到支持，但是什么时候？Linux 实现似乎总是落后于 Windows 和 Mac 版本。
8.  Silverlight 支持 SOAP Web 服务或 REST，前提是您不使用 PUT 或 DELETE，但没有像 Adob​​e 的 ActionScript 消息格式 (AMF) 这样的优化二进制协议，这可能意味着在某些情况下性能较慢。
9.  Silverlight 是一种仅限浏览器的解决方案，而 Flash 可以使用 Adob​​e Integrated Runtime (AIR) 部署到桌面。话虽如此，是的，我已经看到了。
10.  您必须在 Windows 上进行开发。这对于 Expression 设计工具来说尤其是一个问题，因为设计人员拥有不成比例的大量 Mac。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-02T16:50:52.540

**PRO 与 ASP.NET Web 表单**

1.  没有 ViewState 或“惊喜废话” o 这也适用于 Silverlight。Silverlight 为最终用户带来了“桌面”体验，并且 Silverlight 中没有使用 ViewState。
2.  更快的服务器端和客户端 o Silverlight 在客户端/服务器端更快，具体取决于您如何看待它。Silverlight 在 Silverlight 的 .NET 子系统中编译。您可以访问多线程、LINQ、复杂数据结构等。与 ASP.NET 或 AJAX/JavaScript 应用程序相比，它的性能要好几倍，因为客户端执行和一些通常在服务器 BLL 中处理的项目可以归结为客户端
3.  多个相关视图的简化模型 o Silverlight 支持数据和 UI 的完全分离。通过为 Silverlight 的另一个消费者创建单独的视图来进一步实现这一点是非常强大的。您可以在 Silverlight 中应用相同的 MVC/MVP 模式并达到此抽象级别。Jason 提到了一个能够为 iPhone 创建单独视图的示例，并且只需要更改 View 组件。这适用于 Silverlight 以及不同的事情。例如，我有想要移植到 SharePoint 的大型 Silverlight 应用程序。我可以为 SharePoint 创建一个“较小的视图”，使其更适合 UI。此外，Silverlight Mobile 现在正在进行私人测试。我会假设同样非常强大的抽象级别也适用于创建“移动视图”
4.  可单元测试 o Silverlight 还包括一个单元测试框架。可以在这里下载：http: [//code.msdn.microsoft.com/silverlightut/](http://code.msdn.microsoft.com/silverlightut/)
5.  不运行 IIS 7 时的挑战 o Silverlight 不关心您是否运行在 IIS 6 或 IIS 7 或 Apache 上。这是 Silverlight 优于 ASP.NET MVC 的一项功能。
6.  客户端缓存 o 在 ASP.NET Web 窗体或 MVC 中，您在服务器上进行缓存。Silverlight 允许您通过独立存储在客户端上进行缓存（如果需要，可以增加到数百兆）。这允许应用程序以超快的速度执行而不会使托管服务器陷入困境。

**CON 与 ASP.NET Web 表单**

1.  难以转换现有代码 o Silverlight 是一个与 ASP.NET WebForms 或 MVC 完全不同的编程平台。不仅很多代码不会转换，您还必须考虑客户端层，并且在大多数情况下，如果您要替换现有 ASP.NET 站点中的大型模块，则需要完全重新架构。
2.  不是开箱即用的最佳 SEO 谷歌几个月前开始抓取 SWF 文件并将它们添加到搜索引擎。我认为 Silverlight 可能还有很长的路要走。您可以为 Silverlight SEO 做的是用基本技巧来很好地描述插件周围的元数据标签。
3.  数据访问 o Silverlight 中的数据访问仅限于 Web 服务/WCF/ADO.NET 数据服务。您不能通过 ADO.NET 或存储过程直接调用数据库。
4.  安全性 o Silverlight 在客户端上运行。然后你的很多比特在互联网上漫游。此外，一些数据访问技术不支持完整的 WS* 标准安全性。因此，除了基于证书的传输安全性之外，您要么编写大量自己的管道代码，要么等待下一个版本。XAML 代码非常不安全；没有多少应用程序在其 UI 中拥有其知识产权。在 Silverlight 中，可以很容易地使用 Silverlight Spy 进行逆向工程。Silverlight 本质上比 ASP.NET MVC 应用程序安全性稍差一些。显然，您可能希望在将 Silverlight 程序集放任自流之前对其进行加密/混淆处理。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-23T14:08:37.593

**1\. Silverlight 可以从托管页面访问**DOM**
2\. 托管页面可以访问 Silverlight 部分。
这对 Silverlight 来说是一个很大的 +**

 ****但是所有其他限制都需要使用 Clickonce***文件访问、鼠标右键、易于数据库访问*的 WPF/Windows-Forms

 ** * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T16:19:44.860

马克，你说 XBAP 的“单一浏览器”是什么意思？例如，XBAP 确实适用于 Firefox。它确实需要 .NET 框架，而且我们不太可能很快（如果有的话）在 Mono 中使用 WPF，所以你会被 Windows 困住，这是对的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-11T01:34:59.560

这些天，通过这个插件在 Firefox 上点击一次不是可用的：[https ://addons.mozilla.org/en-US/firefox/addon/1608](https://addons.mozilla.org/en-US/firefox/addon/1608)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-01T12:46:29.663

如果您不需要所有 WPF，我会先尝试在 Silvelight 中进行，如果以后需要，您可以更轻松地切换到 WPF。

在这里，我认为它应用了“少即是多”的原则：确实，使用 WPF，您有更多的选择，并且可以访问用户计算机，但随着时间的推移，这最终可能成为一个问题而不是帮助。例如，在使用大量“用户计算机”资源的应用程序中，从 Windows XP 到 Vista 需要进行多少更改！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-03T20:58:12.477

我会考虑 WPF ClickOnce 与同步框架支持 ( [www.msdn.com/sync](http://www.msdn.com/sync) )。这将允许您在用户未连接到公司网络时支持有限的功能（这将消除任何基于浏览器的部署方案，例如 Silverlight 和 XBAP）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-30T22:33:49.310

您可以添加在线与离线辩论的常规内容的利弊。一些项目：

**优点**

wpf（离线）：

*   更好地访问计算机的低级部分。
*   cpu 使用是本地的，因此您很少遇到 cpu 负载问题。
*   不依赖网络。
*   无需停机维护。

银光（在线）：

*   更好地控制用户。如果您的用户登录，您不必担心激活密钥或类似的东西。
*   它适用于 Windows 和 Mac。
*   您可以轻松更新所有用户的应用程序。

我稍微简化了一下，列表中有灰色区域。我只修改了 XBAP，所以我会省略一个。在看过专业人士之后，缺点并不难弄清楚。

高温高压

# asp.net - 有没有办法告诉 Web 应用程序项目中没有使用哪些文件

> ID：251724
> 
> 赞同：0
> 
> 时间：2008-10-30T20:51:23.667
> 
> 标签：asp.net, visual-studio, tfs

我有一个项目，其中包含数千个未使用的图像文件。主要问题是它们与图像混合在一起。

有没有办法获取所有未引用的项目工件的列表？

**编辑**：假设我无权访问网络日志......有选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T07:19:20.840

基本上，没有一种简单的、始终有效的方法。您可以根据用户输入或其他上下文构建图像引用。所以爬取你的网站意味着你必须执行所有的代码路径，否则你可能会丢掉你真正需要的东西。

但现在对于 Chris 的具体情况，您可以使用多种方法：

*   在您的代码中搜索图像以查找图像（可能使用 Visual Studio 插件自动执行此操作）
*   删除所有内容并开始浏览您的网站，添加所有未找到的图像。（这取决于未使用图像与已使用图像的比例）
*   在您的代码中搜索所有出现的 .png、.jpg、.gif（等等）并保留这些图像，将其他所有内容都扔掉。
*   ...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T21:12:28.523

另一种方法 -

假设所有图像文件都在一个文件夹下，请尝试重命名该文件夹。Visual Studio 中的警告将告诉您所需的文件。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T21:04:47.463

*   访问您的 Web 服务器日志，解析所需文件模式的 GET，使它们独一无二，然后将它们与您的参考列表进行比较。

*   或者，查看文件访问日期（如果您是管理员，则可能需要打开此功能）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T21:06:19.410

这是从[以前的帖子](https://stackoverflow.com/questions/33242/how-can-i-find-unused-images-and-css-styles-in-a-website)。

> 在文件级别：
> 
> 使用 wget 主动爬取站点，然后处理 http 服务器日志以获取访问的文件列表，将其与站点中的文件进行比较
> 
> diff \ <(sed some_rules httpd_log | sort -u) \ <(ls /var/www/whatever | sort -u) \ | grep 某事

# hibernate - 在 jboss 4.2.1 中启用 ehcache 统计信息

> ID：251727
> 
> 赞同：0
> 
> 时间：2008-10-30T20:52:47.440
> 
> 标签：hibernate, jboss, jakarta-ee, persistence, ehcache

我已经设置了 hibernate.generate_statistics=true 并且现在需要注册 mbean 以便我可以在 jmx 控制台中看到统计信息。我似乎无处可去，这似乎不应该是一个如此困难的问题。也许我让事情变得过于复杂，但无论如何到目前为止我已经尝试过：

*   我复制了 EhCacheProvider 并让它实例化了 CacheManager 的扩展版本，该版本重载了 init() 并在初始化后调用了 ManagementService.registerMBeans(...) 。在实际调用 registerMBeans(...) 之前，代码都运行良好，这将导致提供程序初始化失败并出现一般错误（不幸的是我没有写下来。）这种方法的动机是[this liferay中使用的方法性能演练。](http://www.kanonbra.com/index.php/projects/performance-testing/18-using-visualvm-on-liferay)
*   我使用 start 方法创建了自己的 MBean，该方法运行与[注册 ehcache 的 jmx mbeans 的示例](http://weblogs.java.net/blog/maxpoon/archive/2007/06/extending_the_n_2.html)类似的代码。一切似乎都正常工作，我的 mbean 出现在 jmx 控制台中，但 net.sf.ehcache 没有。
*   我已经将ehcache升级到1.5（我们使用的是1.3，不确定这是特定于jboss 4.2.1还是我们自己选择的东西）并改为使用SingletonEhCacheProvider并尝试手动获取统计信息而不是处理mbean 注册。但它并没有真正变得更好。如果我调用 getInstance()，则返回的 CacheManager 仅具有 StandardQueryCache 的副本，但 jboss 日志显示许多其他缓存已被初始化（一个用于我们应用程序中的每个缓存实体。）

编辑：嗯，我已经想通了一件事......通过 JConsole 连接确实揭示了统计数据 mbean。我猜 ManagementFactory.getPlatformMBeanServer() 并没有为您提供与 jboss 使用的相同的 mbean 服务器。无论如何，看起来我遇到了与尝试手动收集统计信息时类似的问题，因为即使在单击我的应用程序一段时间后我也得到了全零。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-04-07T09:34:38.790

上面给出的答案假设正在使用 SingletonEhcacheProvider 并且它还需要 utilmgr bean，这个其他解决方案使用启动 bean 并且不做单例假设

```
@Name("hibernateStatistics")
@Scope(ScopeType.APPLICATION)
@Startup
public class HibernateUtils {
@In
private EntityManager entityManager;

@Create
public void onStartup() {
    if (entityManager != null) {
        try {
            //lookup the jboss mbean server
            MBeanServer beanServer = org.jboss.mx.util.MBeanServerLocator.locateJBoss();
            StatisticsService mBean = new StatisticsService();
            ObjectName objectName = new ObjectName("Hibernate:type=statistics,application=<application-name>");
            try{
                beanServer.unregisterMBean(objectName);
            }catch(Exception exc) {
                //no problems, as unregister is not important
            }
            SessionFactory sessionFactory = ((HibernateSessionProxy) entityManager.getDelegate()).getSessionFactory();
            mBean.setSessionFactory(sessionFactory);
            beanServer.registerMBean(mBean, objectName);

            if (sessionFactory instanceof SessionFactoryImplementor ){
                CacheProvider cacheProvider = ((SessionFactoryImplementor)sessionFactory).getSettings().getCacheProvider();
                if (cacheProvider instanceof EhCacheProvider)  {
                    try{
                        Field field = EhCacheProvider.class.getDeclaredField("manager");
                        field.setAccessible(true);
                        CacheManager cacheMgr = (CacheManager) field.get(cacheProvider);
                        ManagementService.registerMBeans(cacheMgr, beanServer, true, true, true, true);
                    }catch(Exception exc) {
                        //do nothing
                        exc.printStackTrace();
                    }
                }
            }

        } catch (Exception e) {
            throw new RuntimeException("The persistence context " + entityManager.toString() + "is not properly      configured.", e);
        }
    }
 } 
```

}

我们使用 MbeanServerLocator，因为 jboss mbean 将是 linux 等环境中的第二个 mbean 服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T21:19:34.140

解决了。由于我没有看到我的实体的所有缓存，我怀疑我没有获得正确的 SessionFactory 实例。我从这一行开始（请参阅我在问题中提供的链接中的示例 jmx 注册代码）：

```
SessionFactory sf = (new Configuration()).configure().buildSessionFactory(); 
```

最终结果是我最终得到的缓存管理器是一个新实例，而不是持久性上下文中的那个。所以我尝试重构为：

```
EntityManagerFactory emf = Persistence.createEntityManagerFactory("myPersistenceUnit");
return ((EntityManagerFactoryImpl)emf).getSessionFactory(); 
```

但这只是抛出了一个异常（我不记得确切的文本；“无法初始化持久性上下文”的效果。）所以没有其他选项，我在我的应用程序中添加了一个无状态 bean (UtilMgr) 并让持久性注入正确的 SessionFactory。这是那个豆子：

```
import javax.ejb.Stateless;
import javax.persistence.PersistenceUnit;
import net.sf.ehcache.CacheManager;
import org.hibernate.SessionFactory;

@Stateless
public class UtilMgrBean implements UtilMgr {
    // NOTE: rename as necessary
    @PersistenceUnit(unitName = "myPersistenceCtx")
    private SessionFactory sessionFactory;

    public SessionFactory getSessionFactory() {
        return this.sessionFactory;
    }

    public CacheManager getCacheManager() {
        return CacheManager.getInstance(); // NOTE: assumes SingletonEhCacheProvider
    }
} 
```

这是前面提到的演练中的更正代码：

```
try {
    // NOTE: lookupBean is a utility method in our app we use for jndi lookups.
    //   replace as necessary for your application.
    UtilMgr utilMgr = (UtilMgr)Manager.lookupBean("UtilMgrBean", UtilMgr.class);
    SessionFactory sf = utilMgr.getSessionFactory();
    MBeanServer mbs = ManagementFactory.getPlatformMBeanServer();

    // NOTE: replace myAppName as necessary
    ObjectName on = new ObjectName("Hibernate:type=statistics,application=myAppName");

    // Enable Hibernate JMX Statistics
    StatisticsService statsMBean = new StatisticsService();
    statsMBean.setSessionFactory(sf);
    statsMBean.setStatisticsEnabled(true);
    mbs.registerMBean(statsMBean, on);

    CacheManager cacheMgr = utilMgr.getCacheManager();
    ManagementService.registerMBeans(cacheMgr, mbs, true, true, true, true);
} catch(Throwable t) {
    throw new RuntimeException(t);
} 
```

如果您想手动检索统计信息，您也可以使用 UtilMgr 的 getCacheManager() 方法（无论如何我可能都会这样做。）您可以[在 ehcache 代码示例中找到有关如何使用缓存和统计对象的更多信息。](http://ehcache.sourceforge.net/documentation/samples.html)

如果有人可以告诉我静态查找会话工厂而不需要创建这个额外的会话 bean 的方法，我很想听听。

# javascript - SAAS 席位认证

> ID：251729
> 
> 赞同：7
> 
> 时间：2008-10-30T20:52:54.257
> 
> 标签：javascript, ajax, authentication, ip, saas

我们公司制作基于网络的应用程序，按工作站定价。

这意味着用户/通行证只能在一台特定的机器上使用。

目前正在发生的情况是多个用户正在共享凭据，如果他们不同时执行此操作，我们没有任何方法可以防止这种情况发生。

该应用程序的性质是用户需要偶尔使用它，因此无法同时工作不会对用户造成太大影响，并且公司会失去可能的收入。

该应用程序目前是纯粹的 AJAX，没有 flash/activeX/Java 小程序。

理想的解决方案是使用“Shell.Network”脚本接口通过 javascript 读取客户端的计算机名称或 IP 地址。

但由于 Internet Explorer 中严格的安全设置，这是不可能的。我不得不提一下，跨浏览器功能并不重要，唯一支持的浏览器是 IE。

搜索谷歌我在这里遇到了这个解决方案[http://www.reglos.de/myaddress/MyAddress.html](http://www.reglos.de/myaddress/MyAddress.html)但它需要 JAVA 小程序所以不会很方便。

有没有其他解决方案？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T03:53:20.133

您的许可模式与交付模式不一致。改变其中之一。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T23:15:26.700

在机器上设置一个带有 id 的 cookie。每次用户登录时检索 cookie。如果您看到多个不同的 cookie 交替出现在单个用户中，您就知道发生了一些奇怪的事情。

（当然，一个开关可能只是意味着他们已经一次性转移到了一台新 PC。）

或者，每次使用价格、“查询”或其他一些项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T13:27:20.080

使用 RichH 建议的 Cookie 技术可能会适度有效地检测到这种滥用行为。至少可以很容易地检测到明显的滥用行为（比如 10 个许可用户，100 个真实用户）。

但是，当然，不要将用户拒之门外，只需监控情况并让您的销售人员打电话建议他们购买更多许可证。

我们做的完全一样（在许可和交付方面），我相信你有充分的商业理由不改变你的模型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T08:03:13.613

跟踪每个用户的会话。不允许对单个用户进行多个会话。为此，您必须将会话 ID 保存到数据库中，并在每次用户登录时进行检查。

为了帮助有时浏览器崩溃并使用新会话重新登录的用户，允许他们退出之前的会话......这样您就可以终止旧会话并注册新会话。

希望这是有用的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T23:34:13.603

没有简单的答案，因为您的客户（软件）实际上是匿名的并且用户是自我识别的。

对于 IE “锁定你”（我几乎不是 IE 专家），但不能为特定域设置 IE 设置吗？您可以简单地要求用户配置他们的浏览器，以便为您的应用程序提供卓越的访问权限。

我看不出有什么理由不能对用户浏览器有某些要求（即只有 IE 6/7/8、这些安全设置等）。

# java - 有没有办法将长时间运行（例如压力测试）分开，以便它们在 Maven 2 中默认不运行？

> ID：251730
> 
> 赞同：8
> 
> 时间：2008-10-30T20:53:06.080
> 
> 标签：java, maven-2, build-process, junit, build-automation

我们在这里有一个持续的需求，我不知道如何使用库存的 Maven 2 工具和文档来解决。

我们的一些开发人员有一些运行时间很长的 JUnit 测试（通常是压力测试），在任何情况下都不应该作为构建过程/夜间构建的常规部分运行。

当然，我们可以使用 surefire 插件的排除机制并将它们从构建中剔除，但理想情况下，我们希望开发人员可以通过 Maven 2 随意运行它们。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-30T21:00:13.290

通常，您会将配置文件添加到运行不同测试集的 maven 配置中：

使用 mvn -Pintegrationtest install 运行它

```
 <profile>
        <id>integrationtest</id>
        <build>
            <plugins>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-surefire-plugin</artifactId>
                    <configuration>
                        <argLine>-client -Xmx896m -XX:MaxPermSize=192m</argLine>
                        <forkMode>once</forkMode>
                        <includes>
                            <include>**/**/*Test.java</include>
                            <include>**/**/*IntTest.java</include>
                        </includes>
                        <excludes>
                            <exclude>**/**/*SeleniumTest.java</exclude>
                        </excludes>
                    </configuration>
                </plugin>
            </plugins>
        </build>
        <activation>
            <property>
                <name>integrationtest</name>
            </property>
        </activation>
    </profile> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-09-06T19:54:47.457

添加到**krosenvold**的答案中，为确保没有意外行为，请确保您还有一个默认情况下处于活动状态的默认配置文件，其中*不包括*您要在特殊配置文件中运行的集成或压力测试。

```
<profile>
    <id>normal</id>
    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>**/**/*IntTest.java</exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>
    <activation>
        <activeByDefault>true</activeByDefault>
    </activation>
</profile> 
```

您将需要像这样创建一个配置文件，只需在配置文件之外列出surefire插件将覆盖配置文件，如果它被选择：

```
mvn -P integrationtest clean install 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-14T21:27:14.097

使用诸如[Super Helpful Integration Test Thingy](http://mojo.codehaus.org/shitty-maven-plugin/)之类的集成测试插件将集成测试（长时间运行的、系统的）与单元测试分开（纯粹主义者说所有真正的单元测试最多运行 30 秒）。为您的单元测试和集成测试制作两个 Java 包。

然后不要将此插件绑定到阶段（正常的 maven 生命周期），并且仅在它被显式调用为目标时运行它，如下所示： `mvn shitty:clean shitty:install shitty:test`

```
<plugins>
  <plugin>
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>shitty-maven-plugin</artifactId>
  </plugin>
</plugins> 
```

这样，您的普通开发人员不会受到影响，并且您将能够按需运行集成测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-15T07:29:18.283

另一种选择是让压力测试检测它是否在 Maven 中运行并且只运行一次或两次。即变成一个常规的功能测试。这样可以检查代码还是不错的，但是运行时间长了。

# design-patterns - 是否应该使用 Singleton 设计模式来实现用户界面？

> ID：251732
> 
> 赞同：4
> 
> 时间：2008-10-30T20:53:27.703
> 
> 标签：design-patterns, oop

我想不出应该在桌面应用程序中实例化多个独立用户界面的许多原因（或任何原因）。将 UI 实现为单例是一种好习惯吗？这种方法有优点还是缺点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T20:56:05.983

呃……我总是打开多个 Internet Explorer、Word 和 Excel 副本！

编辑：我还在 Eudora 中同时打开了几封电子邮件

我认为没有充分的理由将用户界面限制为单例......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T21:03:45.670

我能想到一对：

1) 文档接口。如果您的应用程序处理文档，最好让每个文档都有自己的窗口。它使用户可以更轻松地使用操作系统的应用程序切换功能来安排他们的工作区和在文档之间切换。许多 MDI 应用程序通过将多个文档集中到同一个窗口中来防止这种情况，这限制了多显示器场景中屏幕空间的可用性。

2) 意见。通常情况下，UI 背后数据的多个不同视图无法轻松组合在单个 UI 实例中。您无法始终预测用户希望同时看到哪些数据组合，因此最好让他们灵活地实例化多个 UI。

顺便说一句，值得注意的是，许多人认为 Singleton 是一种反模式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T20:56:27.667

单身人士能给你带来什么好处？您是否意识到这种模式的潜在问题（例如所有明显实现的多线程问题）？

在实践中，如果没有令人信服的理由使用它，您可能希望避免使用 Singleton。对于 UI，即使它没有被多次实例化，实际上也没有令人信服的理由。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T21:00:04.150

单例是一个全局变量。您将其设为全局会鼓励您在所有其他类中引用您的控件（想象一下您的数据抽象层从数据库中获取名称/地址对，为了方便起见，在此处更新您的名称/地址文本框）结果代码是脆弱，依赖关系变得难以解决。仅仅将责任限制在某个类的子集上就容易多了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T23:33:31.000

You use a singleton for cases where it's an **error** to have more than one instance of a type of object, not because you can't think of any good reason to have more than one instance.

# windows - 将 Active Directory 对象标记为“只读”？

> ID：251738
> 
> 赞同：1
> 
> 时间：2008-10-30T20:54:32.053
> 
> 标签：windows, dns, active-directory, privileges

昨天我们度过了糟糕的一天。我们的一位域管理员删除了一个 OU，其中包含 700 多个用户和相同数量的计算机以及各种其他有用的东西，如组等。

我们从备份中恢复，但它并不漂亮。

我知道 ADUC 会询问您是否确定等...但是如果无法删除此特定 OU 而无需进入 ADSIEdit 之类的设置以将其设置为“允许”删除 - 从而不允许人们在不实际打开新应用程序的情况下删除并特别指出“是的 - 我知道我在做什么”。这将具有阻止意外错误编码删除关键 AD 对象的额外好处。

你们能想到的任何这样的属性或方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-06-08T17:15:55.690

Win2k3 及更高版本的 AD 中有一个功能可以标记对象以防止意外删除。对象上的此复选框实际上更改了您删除删除权限的基础权限。因此，它不是特定于工具的，必须受到其他工具（如 powershell 和 vbscript）的尊重。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T21:00:15.380

只需删除那些无法正确删除内容的权限即可。您可以在 AD 中提供非常精细的权限。

没有“只读”属性。这就是[ACL](http://en.wikipedia.org/wiki/Access_control_list)的用途。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T21:01:47.903

您可以在根级别通过委派拒绝管理员的删除权限，然后您需要成为企业管理员才能执行删除。确保 Enterprise Admins 组中没有管理员用于日常使用。

# asp.net - 文本框和 ASP.NET 的奇怪问题

> ID：251740
> 
> 赞同：0
> 
> 时间：2008-10-30T20:55:01.413
> 
> 标签：asp.net, search, post

这段代码之前工作正常，基本上我有一个母版页，它有一个用于搜索的文本框，我将它命名为**`searchBox`**. 我有一种方法可以提取**`searchBox`**表单提交的内容并将其设置为变量**`userQuery`**。这是方法：

```
Public Function searchString(ByVal oTextBoxName As String) As String
    If Master IsNot Nothing Then
        Dim txtBoxSrc As New TextBox
        txtBoxSrc = CType(Master.FindControl(oTextBoxName), TextBox)
        If txtBoxSrc IsNot Nothing Then
            Return txtBoxSrc.Text
        End If
    End If
    Return Nothing
End Function 
```

结果显示在 上**`search.aspx`**。但是，现在如果**`searchBox`**在 以外的页面上填写并提交**`search.aspx`**，则文本框的内容不会通过。表格很简单，就是：

`<asp:TextBox ID="searchBox" runat="server"></asp:TextBox>
<asp:Button ID="searchbutton" runat="server" Text="search" UseSubmitBehavior="True" PostBackUrl="~/search.aspx" CssClass="searchBtn" />`.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T23:23:57.523

我同意 Kyle 关于为什么它不起作用以及如果您想继续通过文本控件访问该值的解决方案，但您也可以从 httprequest 中提取表单数据。我是这样想的（我的asp.net有点生疏）

```
Request.Form[txtBoxSrc.UniqueID] 
```

此处记录了此以及其他技术（使用 previouspage 属性）：http: [//msdn.microsoft.com/en-us/library/6c3yckfw](http://msdn.microsoft.com/en-us/library/6c3yckfw(VS.80).aspx) (VS.80).aspx 。看来您需要做的就是：

```
if (Page.PreviousPage != null)
{
    TextBox SourceTextBox = 
        (TextBox)Page.PreviousPage.FindControl("TextBox1");
    if (SourceTextBox != null)
    {
       return SourceTextBox.Text;
    }
} 
```

更新：感谢 Jason Kealey 指出我需要使用 UniqueID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T21:02:25.767

我认为因为您使用的是 PostBackUrl，所以您将需要使用“ [PreviousPage](http://msdn.microsoft.com/en-us/library/system.web.ui.page.previouspage.aspx) ”标识符来引用您的变量。

另一种解决方案是不使用 PostBackUrl 属性并在用户控件中捕获事件（我假设您将其封装在一个位置），然后使用：

```
Response.Redirect("/search.aspx?sQuery=" & Server.URLEncode(searchBox.Text)) 
```

由于您不一定要传递敏感数据，因此这也应该是可以接受的。

# command-line - 如何使用 scalax.io.CommandLineParser？

> ID：251746
> 
> 赞同：3
> 
> 时间：2008-10-30T20:56:35.653
> 
> 标签：command-line, scala

我想创建一个将字符串数组作为构造函数参数并将命令行选项值作为成员 vals 的类。如下所示，但我不明白 Bistate 是如何工作的。

```
import scalax.data._
import scalax.io.CommandLineParser

class TestCLI(arguments: Array[String]) extends CommandLineParser {
    private val opt1Option = new Flag("p", "print") with AllowAll
    private val opt2Option = new Flag("o", "out") with AllowAll
    private val strOption = new StringOption("v", "value") with AllowAll
    private val result = parse(arguments)
    // true or false
    val opt1 = result(opt1Option)
    val opt2 = result(opt2Option)
    val str = result(strOption)
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T22:36:04.533

我个人并不熟悉 Scalax `Bistate`，尤其是，但仅查看 scaladocs，它看起来像是左右分离。Scala 的主库有一个非常像这样的 monad ( `Either`)，所以我很惊讶他们不只是使用标准的。

本质上，`Bistate`和`Either`有点像`Option`，除了它们的“ `None`-equivalent”可以包含一个值。例如，如果我正在使用 编写代码`Either`，我可能会执行以下操作：

```
def div(a: Int, b: Int) = if (b != 0) Left(a / b) else Right("Divide by zero")

div(4, 2) match {
  case Left(x) => println("Result: " + x)
  case Right(e) => Println("Error: " + e)
} 
```

这将打印“ `Result: 2`”。在这种情况下，我们使用`Either`来模拟异常。我们返回一个`Left`包含我们想要的值的实例，除非由于某种原因无法计算该值，在这种情况下，我们返回一个包含在`Right`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T00:28:39.870

以下是该模式匹配的更短的替代方法，以获得布尔值：

```
val opt1 = result(opt1Option).isInstanceOf[Positive[_]]
val opt2 = result(opt2Option).posValue.isDefined 
```

第二个可能更好。**posValue**字段是一个选项（也有**negValue**）。方法**isDefined** from Option 告诉您它是 Some(x) 还是 None。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T07:55:05.943

因此，如果我想分配是否找到标志的变量布尔值，我必须像下面那样做？

```
val opt1 = result(opt1Option) match {
    case Positive(_) => true
    case Negative(_) => false
} 
```

有没有办法用更少的代码编写这个常见的案例？

# xml - 将逗号分隔的字符串转换为 xml 格式的最佳方法？

> ID：251753
> 
> 赞同：2
> 
> 时间：2008-10-30T20:58:33.823
> 
> 标签：xml, .net-2.0, datatable

使用 VB.net (.net 2.0) 我有一个这种格式的字符串：

```
record1_field1,record1_field2,record2_field3,record2_field1,record2_field2, 
```

ETC...

我想知道最好（最简单）的方法是将其转换为 xml 吗？

我可以想到两种方法：

方法 1： - 使用 split 获取数组中的项目 - 遍历数组并使用连接构建 xml 字符串

方法 2： - 使用 split 获取数组中的项目 - 遍历数组以构建数据表 - 使用 writexml 从数据表中输出 xml

第一个听起来很简单，但需要更多的逻辑来构建字符串。

第二个似乎更流畅，更容易理解。

还有其他方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T21:02:32.397

我会做这样的事情：

```
 XmlDocument doc = new XmlDocuent();

string[] data = csv.split(',');

XmlNode = doc.CreateElement("root");
foreach(string str in data)
{
    XmlNode node = doc.CreateElement("data");
    node.innerText = str;
    root.AppendChild(node);
}
Console.WriteLine(doc.InnerXML); 

```

应该返回如下内容：

```
 <root>
    <data>field 1</data>
    <data>field 2</data>
    <data>field 3</data>
</root> 

```

对于嵌套数据，您必须以不同的方式嵌套循环/标记化......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T21:00:48.390

您可以创建一个 XmlDocument 并使用字符串中适当的 XmlElement 和 XmlAttribute 对象填充它，而不是进行字符串连接...然后，写出 XmlDocument 对象...

# c# - 模式匹配和占位符值

> ID：251759
> 
> 赞同：7
> 
> 时间：2008-10-30T21:00:10.780
> 
> 标签：c#, regex

我正在编写一个应用程序，它使用重命名规则根据用户提供的信息重命名文件列表。文件的开头可能不一致，或者文件名可能一致。用户选择文件列表，并输入有关文件的信息（对于 MP3，它们将是艺术家、标题、专辑等）。使用重命名规则（下面的示例），程序使用用户输入的信息来相应地重命名文件。

但是，如果所有或部分文件的命名一致，我想允许程序“猜测”文件信息。这就是我遇到的问题。做这个的最好方式是什么？

示例文件名：

```
Kraftwerk-Kraftwerk-01-RuckZuck.mp3
Kraftwerk-Autobahn-01-Autobahn.mp3
Kraftwerk-Computer World-03-Numbers.mp3 
```

重命名规则：

```
%Artist%-%Album%-%Track%-%Title%.mp3 
```

该程序应正确推断出艺术家、曲目编号、标题和专辑名称。

同样，最好的方法是什么？我在想正则表达式，但我有点困惑。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T21:52:03.373

最简单的方法是将每个替换`%Label%`为`(?<Label>.*?)`，并转义任何其他字符。

```
%Artist%-%Album%-%Track%-%Title%.mp3 
```

变成

```
(?<Artist>.*?)-(?<Album>.*?)-(?<Track>.*?)-(?<Title>.*?)\.mp3 
```

然后，您会将每个组件放入命名的捕获组中。

```
Dictinary<string,string> match_filename(string rule, string filename) {
    Regex tag_re = new Regex(@'%(\w+)%');
    string pattern = tag_re.Replace(Regex.escape(rule), @'(?<$1>.*?)');
    Regex filename_re = new Regex(pattern);
    Match match = filename_re.Match(filename);

    Dictionary<string,string> tokens =
            new Dictionary<string,string>();
    for (int counter = 1; counter < match.Groups.Count; counter++)
    {
        string group_name = filename_re.GroupNameFromNumber(counter);
        tokens.Add(group_name, m.Groups[counter].Value);
    }
    return tokens;
} 
```

但是如果用户忽略了分隔符，或者分隔符可以包含在字段中，您可能会得到一些奇怪的结果。模式将 for`%Artist%%Album%`将成为`(?<Artist>.*?)(?<Album>.*?)`相当于`.*?.*?`. 模式不知道在哪里分裂。

如果您知道某些字段的格式，例如曲目编号，则可以解决此问题。如果您转换`%Track%`为`(?<Track>\d+)`，则该模式将知道文件名中的任何数字都必须是`Track`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T21:05:48.457

不是您提出的问题的答案，但是当您使用 MP3 时， [ID3 标签阅读库可能是更好的方法。](http://en.wikipedia.org/wiki/ID3)一个快速的谷歌想出了：[C# ID3 库](http://sourceforge.net/projects/csid3lib)。

至于猜测哪个字符串位置包含艺术家、专辑和歌曲标题……我首先想到的是，如果你有一个很好的选择，比如说几张专辑，你可以先看看哪个位置重复最多，这将是艺术家，重复第二多（专辑）和重复最少（歌曲标题）。

否则，仅根据文件名中的几个字符串进行猜测似乎很困难……您能否要求用户也输入描述字段顺序的文件名的匹配表达式？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T21:45:38.270

您的示例中的文件名对我来说似乎非常一致。您可以简单地执行 string.Split() 并将结果数组的每个元素添加到其相应的标签信息中。

猜测哪个位置是哪个标签信息将涉及大量启发式方法。

顺便提一句。包含歌曲文件的文件夹的名称通常也有一些模式，fe

1998 - 七

1999 - 潜望镜

2000 - 二氧化碳

这里的格式是 %Year% - %AlbumName%，这可能有助于您识别文件名中的哪个元素是专辑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T21:51:20.097

为了澄清，我**确实**有一个模式来匹配文件名。

我不提前知道文件名或模式，它都是运行时的。

图案：

```
%Artist%-%Album%-%Track%-%Title%.mp3
```

文件名：

```
Kraftwerk-Kraftwerk-01-RuckZuck.mp3
Kraftwerk-Autobahn-01-Autobahn.mp3
Kraftwerk-计算机世界-03-Numbers.mp3
```

预期结果：

```
艺术家专辑曲目名称
Kraftwerk Kraftwerk 01 RuckZuck
Kraftwerk 高速公路 01 高速公路
Kraftwerk 计算机世界 01 数字

```

同样，格式和文件名并不总是相同的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-02T10:16:34.147

我编写了一个命令行文件重命名器 --- [RenameWand](http://renamewand.sourceforge.net/) --- 可以进行您所描述的那种模式匹配。虽然它是用 Java 编写的，但我认为您可能会对某些源代码和使用文档感兴趣。该程序可以做什么的一个简单示例：

源模式（用户指定）：

```
<artist>-<album>-<track>-<title>.mp3 
```

目标模式（用户指定）：

```
<title.upper>-<3|track+10>-<album.lower>-<artist>.mp3 
```

原始文件名：

```
Kraftwerk-Computer World-03-Numbers.mp3 
```

重命名文件名：

```
NUMBERS-013-computer world-Kraftwerk.mp3 
```

# .net - 为什么不直接对引用进行源代码控制？

> ID：251775
> 
> 赞同：4
> 
> 时间：2008-10-30T21:04:28.180
> 
> 标签：.net, asp.net, version-control

我正在为我的组织建立一些新的源代码控制最佳实践，所以过去几天我一直沉浸在 TreeSurgeon 之类的东西中。

我经常看到的一件事是，将引用包含在源代码控制树中是一种最佳实践，但是在单独的目录（树外科医生中的 lib/）中，而不是直接包含在代码中，因为它们自然出现在 ASP.NET 项目中。

我知道直接在 bin 文件夹中对它们进行源代码控制不好的几个原因，但我想了解全局，包括在从源代码控制中提取代码后如何将这些引用重新返回到 ASP.NET 项目中在新机器上。

提前致谢！

布赖恩

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T21:21:12.890

出于以下几个原因，您希望将外部依赖项放在单独的文件夹中：

*   您清楚地了解该特定外部依赖项中包含的内容
*   您可以添加与构建无关的内容，例如站点链接、文档、示例和其他内容，而不会污染您的项目
*   您可以在多个项目之间共享该依赖项
*   您不想将构建工件与源代码混合在一起，因为它使您/您的团队拥有什么以及不拥有什么变得不清楚
*   您希望在构建期间有明确的步骤来引入外部依赖项，以确保您可以控制最终包中的内容
*   如果它们也混合在那里，分支源将创建您的依赖项的多个副本
*   一些新手意外签入文件的另一个版本并弄乱您的外部依赖项的可能性较小，从而破坏了您的项目

回答你的第二个问题：

我们通常在单独的文件夹中拥有外部依赖项的副本，但仍处于源代码控制之下。所有项目引用都使用相对路径指向该文件夹。因此，当人们在新机器上注册时，他们会获得一整套资源以及外部依赖项，以准备构建产品。

此外，我们的构建还有一个额外的步骤，可以在源树之外生成干净的放置文件夹。这是我们的部署副本，它包含最终产品工作所需的所有构建工件和所有源（如 .aspx）的副本。这迫使人们真正思考最终产品中需要包含的内容。

# design-patterns - 误用的设计模式

> ID：251778
> 
> 赞同：20
> 
> 时间：2008-10-30T21:05:44.043
> 
> 标签：design-patterns, oop, anti-patterns

在典型的“四人帮”列表中，是否有任何您经常发现被滥用、误解或过度使用的设计模式（除了备受争议的 Singleton）？换句话说，您是否建议在使用前三思而后行的设计模式？（为什么？）

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-30T21:37:19.923

单例模式..全局状态在测试时经常会导致问题

任何依赖于单例的代码都变得越来越难测试，因为这种依赖不容易被模拟。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-30T21:16:47.780

工厂模式...

在此之前，我被空降到一个项目中，系统中的每一个都具有生成新实例`MyObject`的等价物。`MyObjectFactory`没有抽象或扩展类的概念......只是普通的旧 ClassX 和 ClassXFactory。

没有人能解释为什么......“这就是事情一直以来的做法”

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-30T22:32:20.750

唯一的一个（除了前面提到的 Singleton 和它的犯罪伙伴，工厂）不会是 GoF，当应用于对象的本机属性时，它将是 setter 和 getter。

应用于成员变量的 Setter 和 getter 在功能上与公共成员变量相同。没有 setter 的 getter 更像是一个公共的 final 成员变量——但在这一点上，为什么不只使用一个公共的 final 成员变量，它们没有更多的伤害......

唯一的区别是您“可以”拦截呼​​叫并覆盖它，但人们很少这样做。更多时候，它被用作程序程序员避免 OO 编程的拐杖（这是它成为反模式的真正原因）。

使用 setter 和/或 getter，您仍然将内部成员结构暴露给外部世界（例如，如果您发现需要将 int 更改为 long，则必须重构其他类）并且您几乎可以确保一些应该在您的对象内部的代码被放置在外部。

我能想到的有几个例外：

用于简化对象构造的设置器。有时需要先创建一个对象，然后再设置其他值。为了安全起见，这些值应该是不可变的（您不应该调用 set 两次）。

Getter 用于访问包含的对象。由于包含的对象通常能够确保自己的完整性，因此共享它们非常好。在这种情况下，二传手通常很糟糕，您不希望在您的鼻子下方交换具有特定状态的对象，这使得确保您自己的完整性变得更加困难。

用于屏幕组件的 Java Bean：是的，想不出更好的方法来实现这些“属性球”。反射对于这个组件很方便，模式很有用——它有点老套，但很有效。

DAO/DTO Bean 对象。老实说，我认为这些是模式的不确定用法，但它们就是*模式*。它使得通过元数据而不是代码来操作属性比它应该的要困难得多，因为它必须是反射的。bean 属性总是与某些外部源（数据库格式、数据传输格式、组件属性……）相关联，那么为什么我们要重复定义每个部分的工作呢？

编辑：从 kyoryu 的评论中被盗，被带到帖子上，因为这真的是对我所说的内容的完美总结，可能会在评论中遗漏。需要，因为似乎不是每个人都明白向语言添加访问器只会编码糟糕的 OO 设计模式：

精简版 -

```
if (account1.balance > 1000)
{
    account1.balance = account1.balance - 1000;
    account2.balance = account2.balance + 1000;
}; = BAD CODE. 

account2.deposit(account1.withdraw(1000)); = GOOD CODE. 
```

第二个不需要访问器... – kyoryu（由比尔 k 稍作修改，因为我的空间比他在评论中所做的多一点）。

第二个是在 Account 中移动测试和其他一些数学运算，而不是在您可能进行转移的每个地方都在代码中复制它。

只是为了更详细地说明这一点，请注意，对于“GOOD CODE”样式，很明显 .withdraw 的输出可能是一个 Transaction 对象，其中包含有关整个事务的信息，包括其成功、来源和目的地以及日志记录能力。以“BAD CODE”风格编写代码的人会如何发生这种情况？

另外，您将如何重构 BAD CODE 以使用这样的对象？这只是一团糟。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-30T21:35:05.310

我还要说工厂模式。与 Eoin 类似的经历。在我的例子中，这个项目有很多工厂，因为有些人认为你可能使用对象 A 来实现本地实现，对象 B 来实现远程实现，并且它是通过工厂抽象出来的（这是一个明智的做法）。

但是“远程”实现从来没有被需要或实现过，甚至在未来也没有被预见到......而且，技能较低的工程师开始在许多其他事情上采用这种模式，就像千篇一律......

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-30T21:21:00.223

实际上，我最常看到的是*没有*使用适当的模式。典型场景：我：“嘿，模块A已经有一段代码循环一组对象并对它们执行数据库操作X，你为什么不重用那段代码？” 编码员：“好吧，但我必须对那些对象进行 Y 操作。” 我：“如何使用重构它以使用命令模式来适当地执行 X 或 Y？”

我曾经看到 Subject-Observer 模式的使用失控。它是在使用数据库持久存储主题的进程之间实现的。由于对主题的更新数量和观察者的数量庞大，数据库的负载非常巨大，并导致了无法预料的系统范围内的减速。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-07-30T23:08:31.800

如果各种逻辑都被归为一个庞大的类，那么中介者模式肯定有可能被滥用。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-22T02:20:20.880

实际上，我会说当 KISS (*~~保持简单，愚蠢~~保持简短和简单*）解决方案就是所需要的。

设计模式非常适合使系统灵活，但代价是使实现更加复杂。当灵活性将提供实际优势时，这只是一个值得权衡的选择。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-09-25T04:34:41.183

全部。

不要误会我的意思，我发现它们是一个很好的基础，如果理解得很好，非常有帮助。掌握设计技能以了解何时以及如何在代码中应用它们需要付出很多努力。实际上，这就是创建干净代码的技能的总体情况。

它不是关于不使用，这正是您在“使用前三思而后行”的问题中所说的。很好地理解你在做什么以及为什么。如果您不这样做，请与可以指导您的人交谈-除了大量阅读之外。当心那些知道所有模式但无法清楚地向您解释其中任何一种模式的人 - 特别是有问题的模式。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-09-26T03:50:59.030

在看到一些“所有模式都不好”的答案后，我只想添加另一条评论。

如果你是一个半体面的程序员，正在处理具有中等挑战性的问题，那么几乎所有的模式都应该在某一时刻向你展示自己作为问题的“明显”解决方案。

《设计模式》这本书唯一真正的意义是为我们每天所做的事情命名，这样我们就可以更好地沟通。

我想如果你是一个新手程序员，通读它们会很有帮助，这样当你需要一个时，你就不必自己弄清楚了，它已经在你的工具箱里了，但总的来说——任何其中一个可以由一帮人（任何一个！）计算出来。

如果有任何这些你还不知道，你可能只是从来不需要它。

给模式命名并稍微正式化它们是非常有用的，我一点也不抱怨这本书。如果你没有看到这里几乎所有的模式偶尔需要，你只是没有在编写非常难的代码（或者你重复了很多代码，我认为这是大罪）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-30T22:57:04.490

我看到的最大的一个是单例模式，在这种模式下，对于如何以及何时调用单例的析构函数没有足够的关注和勤奋。

对于这样一个普遍存在的模式，几乎没有任何关于决定一个单例何时必须死亡的正确过程的讨论。

只是我的0.02。

干杯，

抢

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-30T21:21:10.800

观察者模式在 C# 中毫无用处，因为它有事件。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-03-22T03:17:10.807

仅在需要时使用模式。你无法预测未来，所以虽然你可能会加入一个模式以使设计灵活，但当产品采用不同的方向并且你的模式成为阻碍你实现用户想要的东西时会发生什么？

让设计从一开始就尽可能简单。当您更多地了解您的设计需要如何更改时，请使用适当的模式，而不是之前。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-03-22T03:25:18.567

**存储库模式**

大多数人在阅读 Eric Evans 的领域驱动设计书后就开始使用这种模式。

这里有多少人见过像数据访问对象一样构建的存储库？

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-09-25T04:17:26.153

首先，“这取决于”语言——某些语言中的某些结构减少了对某些设计模式的需求。

其次，[设计模式](http://en.wikipedia.org/wiki/Design_pattern_(computer_science)#Documentation)概念的部分模板从一开始就包含了“适用性”和“后果”部分——忽略这些，后果自负。“了解”一种模式不仅意味着您知道如何用您选择的语言对其进行编码 - 它还意味着知道何时使用它，以及使用它可能带来的缺点。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-08-04T17:01:28.267

你不能对这个问题有直接的答案。它主要是主观的，取决于应用程序的要求。

1.  大多数人引用[Singleton_pattern](https://en.wikipedia.org/wiki/Singleton_pattern)不好，但对每个用户和项目来说都不错。对于我的项目要求，它可以达到目的。我需要一个 ConnectionManager 来处理客户端和应用程序之间的会话管理，而 Singleton 可以出色地完成这项工作。

2.  您已经提供了具有良好文档的第三方 jar。jar 包含继承层次结构。现在您必须对每个孩子添加一个操作。由于您没有源代码，因此您无法做到。现在您可以通过使用[Visitor_pattern](https://en.wikipedia.org/wiki/Visitor_pattern)受益。但是如果你有源代码，你可能根本不会使用`Visitor`模式。您可以在父级和每个子级中简单地添加新操作。缺少源代码并不意味着我在滥用`Visitor`模式。

3.  我想限制各种对象之间的通信。我将继续实施[Mediator_pattern](https://en.wikipedia.org/wiki/Mediator_pattern)进行对象通信。我想限制客户接触我的系统以隐藏复杂性。我将继续使用[Facade_pattern](https://en.wikipedia.org/wiki/Facade_pattern)。这并不意味着我在滥用这些模式。这个相同的示例可以扩展到其他模式，如[Proxy_pattern](https://en.wikipedia.org/wiki/Proxy_pattern)等。

# performance - 如何在 O(n) 中找到长度为 n 的未排序数组中的第 k 个最大元素？

> ID：251781
> 
> 赞同：228
> 
> 时间：2008-10-30T21:06:15.760
> 
> 标签：performance, algorithm, big-o

我相信有一种方法可以在 O(n) 中找到长度为 n 的未排序数组中的第 k 个最大元素。或者也许它是“预期的” O(n) 或其他东西。我们应该怎么做？

* * *

## 回答 #1

> 赞同：176
> 
> 时间：2008-10-30T21:48:05.517

这称为找到第**k 阶统计量**。有一个非常简单的随机算法（称为*quickselect*）采用`O(n)`平均时间、`O(n^2)`最坏情况时间，还有一个非常复杂的非随机算法（称为*introselect*）采用`O(n)`最坏情况时间。[维基百科](http://en.wikipedia.org/wiki/Selection_algorithm)上有一些信息，但不是很好。

~~您需要的一切都在[这些 powerpoint 幻灯片](http://web.archive.org/web/20160402214842/http://c3p0demo.googlecode.com/svn/trunk/scalaDemo/script/Order_statistics.ppt)~~中。只是为了提取`O(n)`最坏情况算法的基本算法（introselect）：

```
Select(A,n,i):
    Divide input into ⌈n/5⌉ groups of size 5.

    /* Partition on median-of-medians */
    medians = array of each group’s median.
    pivot = Select(medians, ⌈n/5⌉, ⌈n/10⌉)
    Left Array L and Right Array G = partition(A, pivot)

    /* Find ith element in L, pivot, or G */
    k = |L| + 1
    If i = k, return pivot
    If i < k, return Select(L, k-1, i)
    If i > k, return Select(G, n-k, i-k) 
```

Cormen 等人的《算法简介》一书中也非常详细地介绍了这一点。

* * *

## 回答 #2

> 赞同：121
> 
> 时间：2008-10-31T22:23:11.870

如果你想要一个真正的`O(n)`算法，而不是`O(kn)`类似的，那么你应该使用快速选择（它基本上是快速排序，你扔掉你不感兴趣的分区）。我的教授写了一篇很棒的文章，带有运行时分析：（[参考](http://pine.cs.yale.edu/pinewiki/QuickSelect)）

QuickSelect 算法快速找到未排序的元素数组中的第 k 个最小`n`元素。它是一个[RandomizedAlgorithm](http://pine.cs.yale.edu/pinewiki/RandomizedAlgorithm)，因此我们计算最坏情况下的*预期*运行时间。

这是算法。

```
QuickSelect(A, k)
  let r be chosen uniformly at random in the range 1 to length(A)
  let pivot = A[r]
  let A1, A2 be new arrays
  # split into a pile A1 of small elements and A2 of big elements
  for i = 1 to n
    if A[i] < pivot then
      append A[i] to A1
    else if A[i] > pivot then
      append A[i] to A2
    else
      # do nothing
  end for
  if k <= length(A1):
    # it's in the pile of small elements
    return QuickSelect(A1, k)
  else if k > length(A) - length(A2)
    # it's in the pile of big elements
    return QuickSelect(A2, k - (length(A) - length(A2))
  else
    # it's equal to the pivot
    return pivot 
```

这个算法的运行时间是多少？如果对手为我们抛硬币，我们可能会发现枢轴始终是最大元素并且`k`始终为 1，运行时间为

```
T(n) = Theta(n) + T(n-1) = Theta(n²)
```

但如果选择确实是随机的，则预期运行时间由下式给出

```
T(n) <= Theta(n) + (1/n) ∑<sub>i=1 to nT(max(i, n-i-1))
```

我们做出了一个不完全合理的假设，即递归总是落在 or 中的较大`A1`者`A2`。

让我们猜测`T(n) <= an`一下`a`。然后我们得到

```
T(n) 
 <= cn + (1/n) ∑<sub>i=1 to nT(max(i-1, n-i))
 = cn + (1/n) ∑<sub>i=1 to floor(n/2) T(n-i) + (1/n) ∑<sub>i=floor(n/2)+1 to n T(i)
 <= cn + 2 (1/n) ∑<sub>i=floor(n/2) to n T(i)
 <= cn + 2 (1/n) ∑<sub>i=floor(n/2) to n ai
```

现在不知何故，我们必须在加号右边得到可怕的总和来吸收`cn`左边的。如果我们只是将它绑定为`2(1/n) ∑<sub>i=n/2 to n an`，我们会得到粗略`2(1/n)(n/2)an = an`的 . 但这太大了 - 没有空间可以挤入额外的`cn`. 因此，让我们使用算术级数公式扩展总和：

```
∑<sub>i=floor(n/2) to n i  
 = ∑<sub>i=1 to n i - ∑<sub>i=1 to floor(n/2) i  
 = n(n+1)/2 - floor(n/2)(floor(n/2)+1)/2  
 <= n²/2 - (n/4)²/2  
 = (15/32)n²
```

我们利用 n 的“足够大”来用`floor(n/2)`更干净（更小）的来替换丑陋的因素`n/4`。现在我们可以继续

```
cn + 2 (1/n) ∑<sub>i=floor(n/2) to n ai,
 <= cn + (2a/n) (15/32) n²
 = n (c + (15/16)a)
 <= an
```

提供`a > 16c`.

这给了`T(n) = O(n)`. 很明显`Omega(n)`，所以我们得到了`T(n) = Theta(n)`。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-30T21:12:11.690

一个快速的谷歌（'第k大元素数组'）返回了这个：[http ://discuss.joelonsoftware.com/default.asp?interview.11.509587.17](http://discuss.joelonsoftware.com/default.asp?interview.11.509587.17)

```
"Make one pass through tracking the three largest values so far." 
```

（它专门用于 3d 最大）

这个答案：

```
Build a heap/priority queue.  O(n)
Pop top element.  O(log n)
Pop top element.  O(log n)
Pop top element.  O(log n)

Total = O(n) + 3 O(log n) = O(n) 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-06-23T02:14:15.787

你确实喜欢快速排序。随机选择一个元素并将所有内容推高或推低。此时你会知道你实际选择了哪个元素，如果它是你完成的第 k 个元素，否则你用 bin 重复（更高或更低），第 k 个元素会落入。从统计学上讲，时间需要找到第 k 个元素随 n 增长，O(n)。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-30T21:17:23.210

[A Programmer's Companion to Algorithm Analysis](http://books.google.com/books?id=E6BNGFQ6m_IC&pg=RA2-PA68&lpg=RA2-PA68&dq=kth+largest+element+algorithm&source=web&ots=I_hwqNJre_&sig=aFEdhfpQrfDc0osCC69YyR_HCHc&hl=en&sa=X&oi=book_result&resnum=3&ct=result#PRA2-PA70,M1)给出了 O(n) 的版本，尽管作者指出*常数*因子如此之高，但您可能更喜欢简单的 sort-the-list-then-select 方法。

我回答了你的问题的信:)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-30T22:53:51.923

C++ 标准库几乎完全具有该[函数](http://www.cplusplus.com/reference/algorithm/nth_element.html)调用`nth_element`，尽管它确实修改了您的数据。它预计线性运行时间 O(N)，并且还进行部分排序。

```
const int N = ...;
double a[N];
// ... 
const int m = ...; // m < N
nth_element (a, a + m, a + N);
// a[m] contains the mth element in a 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-01-04T05:43:15.603

我使用动态编程，特别是锦标赛方法，实现了在 n 个未排序元素中找到第 k 个最小值。执行时间为 O(n + klog(n))。使用的机制被列为维基百科页面上关于选择算法的方法之一（如上面的帖子之一所示）。[您可以在我的博客页面Finding Kth Minimum](http://malkit.blogspot.com/2012/07/finding-kth-minimum-partial-ordering.html)上阅读有关该算法的信息并找到代码 (java) 。此外，该逻辑可以对列表进行部分排序 - 在 O(klog(n)) 时间内返回第一个 K min（或 max）。

尽管代码提供了第 k 个最小值，但可以使用类似的逻辑在 O(klog(n)) 中找到第 k 个最大值，忽略为创建锦标赛树所做的准备工作。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-08-18T07:25:06.610

**虽然不太确定 O(n) 复杂度，但肯定会在 O(n) 和 nLog(n) 之间。也肯定比 nLog(n) 更接近 O(n)。函数是用Java编写的**

```
public int quickSelect(ArrayList<Integer>list, int nthSmallest){
    //Choose random number in range of 0 to array length
    Random random =  new Random();
    //This will give random number which is not greater than length - 1
    int pivotIndex = random.nextInt(list.size() - 1); 

    int pivot = list.get(pivotIndex);

    ArrayList<Integer> smallerNumberList = new ArrayList<Integer>();
    ArrayList<Integer> greaterNumberList = new ArrayList<Integer>();

    //Split list into two. 
    //Value smaller than pivot should go to smallerNumberList
    //Value greater than pivot should go to greaterNumberList
    //Do nothing for value which is equal to pivot
    for(int i=0; i<list.size(); i++){
        if(list.get(i)<pivot){
            smallerNumberList.add(list.get(i));
        }
        else if(list.get(i)>pivot){
            greaterNumberList.add(list.get(i));
        }
        else{
            //Do nothing
        }
    }

    //If smallerNumberList size is greater than nthSmallest value, nthSmallest number must be in this list 
    if(nthSmallest < smallerNumberList.size()){
        return quickSelect(smallerNumberList, nthSmallest);
    }
    //If nthSmallest is greater than [ list.size() - greaterNumberList.size() ], nthSmallest number must be in this list
    //The step is bit tricky. If confusing, please see the above loop once again for clarification.
    else if(nthSmallest > (list.size() - greaterNumberList.size())){
        //nthSmallest will have to be changed here. [ list.size() - greaterNumberList.size() ] elements are already in 
        //smallerNumberList
        nthSmallest = nthSmallest - (list.size() - greaterNumberList.size());
        return quickSelect(greaterNumberList,nthSmallest);
    }
    else{
        return pivot;
    }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-30T21:17:49.777

通过跟踪您见过的 k 个最大元素，您可以在 O(n + kn) = O(n)（对于常数 k）和空间的 O(k) 中做到这一点。

对于数组中的每个元素，您可以扫描 k 最大的列表，如果它更大，则用新元素替换最小的元素。

不过，Warren 的优先堆解决方案更简洁。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-07-22T16:52:28.497

Python中的性感快速选择

```
def quickselect(arr, k):
    '''
     k = 1 returns first element in ascending order.
     can be easily modified to return first element in descending order
    '''

    r = random.randrange(0, len(arr))

    a1 = [i for i in arr if i < arr[r]] '''partition'''
    a2 = [i for i in arr if i > arr[r]]

    if k <= len(a1):
        return quickselect(a1, k)
    elif k > len(arr)-len(a2):
        return quickselect(a2, k - (len(arr) - len(a2)))
    else:
        return arr[r] 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2015-09-04T09:09:57.157

根据本文[在 n 个项目](http://cs.indstate.edu/~spitla/abstract2.pdf)的列表中查找第 K 个最大的项目，以下算法`O(n)`在最坏的情况下将需要时间。

1.  将数组分成 n/5 个列表，每个列表有 5 个元素。
2.  在每个包含 5 个元素的子数组中找到中位数。
3.  递归地找到所有中位数的中位数，我们称之为 M
4.  将数组划分为两个子数组 第一个子数组包含大于 M 的元素，假设这个子数组是 a1 ，而其他子数组包含小于 M 的元素，让我们将此子数组称为 a2。
5.  如果 k <= |a1|，则返回选择 (a1,k)。
6.  如果 k− 1 = |a1|，则返回 M。
7.  如果 k> |a1| + 1，返回选择（a2，k -a1 - 1）。

**分析：**正如原始论文中所建议的：

> 我们使用中值将列表分成两半（如果是前半部分，则为`k <= n/2`后半部分）。该算法`cn`在某个常数的第一级递归`c`、`cn/2`下一级（因为我们在大小为 n/2 的列表中递归）、`cn/4`第三级等都需要时间。花费的总时间是`cn + cn/2 + cn/4 + .... = 2cn = o(n)`。

**为什么分区大小取 5 而不是 3？**

如原始[论文](http://cs.indstate.edu/~spitla/abstract2.pdf)中所述：

> 将列表除以 5 可确保在最坏情况下拆分为 70 - 30。中位数的至少一半大于中位数的中位数，因此 n/5 块中的至少一半具有至少 3 个元素，这给出了 `3n/10`拆分，这意味着在最坏的情况下另一个分区是 7n/10。也就是说`T(n) = T(n/5)+T(7n/10)+O(n). Since n/5+7n/10 < 1`，最坏情况下的运行时间是`O(n)`。

现在我尝试将上述算法实现为：

```
public static int findKthLargestUsingMedian(Integer[] array, int k) {
        // Step 1: Divide the list into n/5 lists of 5 element each.
        int noOfRequiredLists = (int) Math.ceil(array.length / 5.0);
        // Step 2: Find pivotal element aka median of medians.
        int medianOfMedian =  findMedianOfMedians(array, noOfRequiredLists);
        //Now we need two lists split using medianOfMedian as pivot. All elements in list listOne will be grater than medianOfMedian and listTwo will have elements lesser than medianOfMedian.
        List<Integer> listWithGreaterNumbers = new ArrayList<>(); // elements greater than medianOfMedian
        List<Integer> listWithSmallerNumbers = new ArrayList<>(); // elements less than medianOfMedian
        for (Integer element : array) {
            if (element < medianOfMedian) {
                listWithSmallerNumbers.add(element);
            } else if (element > medianOfMedian) {
                listWithGreaterNumbers.add(element);
            }
        }
        // Next step.
        if (k <= listWithGreaterNumbers.size()) return findKthLargestUsingMedian((Integer[]) listWithGreaterNumbers.toArray(new Integer[listWithGreaterNumbers.size()]), k);
        else if ((k - 1) == listWithGreaterNumbers.size()) return medianOfMedian;
        else if (k > (listWithGreaterNumbers.size() + 1)) return findKthLargestUsingMedian((Integer[]) listWithSmallerNumbers.toArray(new Integer[listWithSmallerNumbers.size()]), k-listWithGreaterNumbers.size()-1);
        return -1;
    }

    public static int findMedianOfMedians(Integer[] mainList, int noOfRequiredLists) {
        int[] medians = new int[noOfRequiredLists];
        for (int count = 0; count < noOfRequiredLists; count++) {
            int startOfPartialArray = 5 * count;
            int endOfPartialArray = startOfPartialArray + 5;
            Integer[] partialArray = Arrays.copyOfRange((Integer[]) mainList, startOfPartialArray, endOfPartialArray);
            // Step 2: Find median of each of these sublists.
            int medianIndex = partialArray.length/2;
            medians[count] = partialArray[medianIndex];
        }
        // Step 3: Find median of the medians.
        return medians[medians.length / 2];
    } 
```

只是为了完成，另一种算法使用优先队列并需要时间`O(nlogn)`。

```
public static int findKthLargestUsingPriorityQueue(Integer[] nums, int k) {
        int p = 0;
        int numElements = nums.length;
        // create priority queue where all the elements of nums will be stored
        PriorityQueue<Integer> pq = new PriorityQueue<Integer>();

        // place all the elements of the array to this priority queue
        for (int n : nums) {
            pq.add(n);
        }

        // extract the kth largest element
        while (numElements - k + 1 > 0) {
            p = pq.poll();
            k++;
        }

        return p;
    } 
```

这两种算法都可以测试为：

```
public static void main(String[] args) throws IOException {
        Integer[] numbers = new Integer[]{2, 3, 5, 4, 1, 12, 11, 13, 16, 7, 8, 6, 10, 9, 17, 15, 19, 20, 18, 23, 21, 22, 25, 24, 14};
        System.out.println(findKthLargestUsingMedian(numbers, 8));
        System.out.println(findKthLargestUsingPriorityQueue(numbers, 8));
    } 
```

正如预期的输出是： `18 18`

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-04-18T18:21:39.587

在线性时间内找到数组的中位数，然后使用与快速排序完全相同的分区过程将数组分成两部分，中位数左侧的值小于（<）小于中位数，右侧大于（>）中位数，这也可以在线性时间完成，现在，转到第 k 个元素所在的数组部分，现在递归变为：T(n) = T(n/2) + cn，这给了我 O(n) 总体。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-07-19T09:17:41.933

下面是完整实现的链接，其中包含相当广泛的解释，用于在未排序算法中查找第 K 个元素的算法如何工作。基本思想是像快速排序一样对数组进行分区。但是为了避免极端情况（例如，当每个步骤中选择最小元素作为枢轴时，使得算法退化为 O(n^2) 运行时间），应用了特殊的枢轴选择，称为中位数算法。在最坏和平均情况下，整个解决方案在 O(n) 时间内运行。

这是完整文章的链接（它是关于寻找第 Kth 个*最小元素，但寻找第 Kth 个**最大*元素的原理是相同的）：

**[在未排序的数组中查找第 K 个最小的元素](http://www.codinghelmet.com/?path=exercises/kth-smallest)**

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-06-16T09:55:13.347

这种方法怎么样

保持 a`buffer of length k`和 a `tmp_max`，得到 tmp_max 是 O(k) 并且完成 n 次，所以类似于`O(kn)`

[![在此处输入图像描述](https://i.stack.imgur.com/f0P3y.png)](https://i.stack.imgur.com/f0P3y.png)

是对的还是我错过了什么？

*虽然它没有击败快速选择的平均情况和中值统计方法的最坏情况，但它很容易理解和实现。*

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-30T21:10:13.583

遍历列表。如果当前值大于存储的最大值，则将其存储为最大值并将 1-4 向下和 5 从列表中删除。如果不是，将其与 2 号进行比较并做同样的事情。重复，对照所有 5 个存储值检查它。这应该在 O(n) 中完成

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-07-31T16:51:47.017

我想提出一个答案

如果我们取前 k 个元素并将它们排序到 k 个值的链表中

现在对于每个其他值，即使在最坏的情况下，如果我们对剩余的 nk 值进行插入排序，即使在最坏的情况下，比较的数量也将是 k*(nk)，对于要排序的前 k 个值，让它成为 k*(k- 1) 所以结果是 (nk-k)，即 o(n)

干杯

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-02-28T19:50:18.780

可以在此处找到用于查找 n 中第 k 个最大整数的中位数算法的解释：http: [//cs.indstate.edu/~spitla/presentation.pdf](http://cs.indstate.edu/~spitla/presentation.pdf)

c++中的实现如下：

```
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

int findMedian(vector<int> vec){
//    Find median of a vector
    int median;
    size_t size = vec.size();
    median = vec[(size/2)];
    return median;
}

int findMedianOfMedians(vector<vector<int> > values){
    vector<int> medians;

    for (int i = 0; i < values.size(); i++) {
        int m = findMedian(values[i]);
        medians.push_back(m);
    }

    return findMedian(medians);
}

void selectionByMedianOfMedians(const vector<int> values, int k){
//    Divide the list into n/5 lists of 5 elements each
    vector<vector<int> > vec2D;

    int count = 0;
    while (count != values.size()) {
        int countRow = 0;
        vector<int> row;

        while ((countRow < 5) && (count < values.size())) {
            row.push_back(values[count]);
            count++;
            countRow++;
        }
        vec2D.push_back(row);
    }

    cout<<endl<<endl<<"Printing 2D vector : "<<endl;
    for (int i = 0; i < vec2D.size(); i++) {
        for (int j = 0; j < vec2D[i].size(); j++) {
            cout<<vec2D[i][j]<<" ";
        }
        cout<<endl;
    }
    cout<<endl;

//    Calculating a new pivot for making splits
    int m = findMedianOfMedians(vec2D);
    cout<<"Median of medians is : "<<m<<endl;

//    Partition the list into unique elements larger than 'm' (call this sublist L1) and
//    those smaller them 'm' (call this sublist L2)
    vector<int> L1, L2;

    for (int i = 0; i < vec2D.size(); i++) {
        for (int j = 0; j < vec2D[i].size(); j++) {
            if (vec2D[i][j] > m) {
                L1.push_back(vec2D[i][j]);
            }else if (vec2D[i][j] < m){
                L2.push_back(vec2D[i][j]);
            }
        }
    }

//    Checking the splits as per the new pivot 'm'
    cout<<endl<<"Printing L1 : "<<endl;
    for (int i = 0; i < L1.size(); i++) {
        cout<<L1[i]<<" ";
    }

    cout<<endl<<endl<<"Printing L2 : "<<endl;
    for (int i = 0; i < L2.size(); i++) {
        cout<<L2[i]<<" ";
    }

//    Recursive calls
    if ((k - 1) == L1.size()) {
        cout<<endl<<endl<<"Answer :"<<m;
    }else if (k <= L1.size()) {
        return selectionByMedianOfMedians(L1, k);
    }else if (k > (L1.size() + 1)){
        return selectionByMedianOfMedians(L2, k-((int)L1.size())-1);
    }

}

int main()
{
    int values[] = {2, 3, 5, 4, 1, 12, 11, 13, 16, 7, 8, 6, 10, 9, 17, 15, 19, 20, 18, 23, 21, 22, 25, 24, 14};

    vector<int> vec(values, values + 25);

    cout<<"The given array is : "<<endl;
    for (int i = 0; i < vec.size(); i++) {
        cout<<vec[i]<<" ";
    }

    selectionByMedianOfMedians(vec, 8);

    return 0;
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-11-03T23:15:27.967

还有[Wirth 的选择算法](http://mail.scipy.org/pipermail/numpy-discussion/2009-August/044893.html)，它的实现比 QuickSelect 更简单。Wirth 的选择算法比 QuickSelect 慢，但经过一些改进，它变得更快。

更详细。使用 Vladimir Zabrodsky 的 MODIFIND 优化和中值 3 枢轴选择并注意算法分区部分的最后步骤，我提出了以下算法（可以想象命名为“LefSelect”）：

```
#define F_SWAP(a,b) { float temp=(a);(a)=(b);(b)=temp; }

# Note: The code needs more than 2 elements to work
float lefselect(float a[], const int n, const int k) {
    int l=0, m = n-1, i=l, j=m;
    float x;

    while (l<m) {
        if( a[k] < a[i] ) F_SWAP(a[i],a[k]);
        if( a[j] < a[i] ) F_SWAP(a[i],a[j]);
        if( a[j] < a[k] ) F_SWAP(a[k],a[j]);

        x=a[k];
        while (j>k & i<k) {
            do i++; while (a[i]<x);
            do j--; while (a[j]>x);

            F_SWAP(a[i],a[j]);
        }
        i++; j--;

        if (j<k) {
            while (a[i]<x) i++;
            l=i; j=m;
        }
        if (k<i) {
            while (x<a[j]) j--;
            m=j; i=l;
        }
    }
    return a[k];
} 
```

在我在[这里](http://www.beamng.com/entries/86-A-faster-selection)做的基准测试中，LefSelect 比 QuickSelect 快 20-30%。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-01-23T23:42:31.793

哈斯克尔解决方案：

```
kthElem index list = sort list !! index

withShape ~[]     []     = []
withShape ~(x:xs) (y:ys) = x : withShape xs ys

sort []     = []
sort (x:xs) = (sort ls `withShape` ls) ++ [x] ++ (sort rs `withShape` rs)
  where
   ls = filter (<  x)
   rs = filter (>= x) 
```

这通过使用 withShape 方法在不实际计算分区的情况下发现分区的大小来实现中位数解的中位数。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-04-19T11:47:20.393

这是 Randomized QuickSelect 的 C++ 实现。这个想法是随机选择一个枢轴元素。为了实现随机分区，我们使用随机函数 rand() 生成 l 和 r 之间的索引，将随机生成的索引处的元素与最后一个元素交换，最后调用以最后一个元素为基准的标准分区过程。

```
#include<iostream>
#include<climits>
#include<cstdlib>
using namespace std;

int randomPartition(int arr[], int l, int r);

// This function returns k'th smallest element in arr[l..r] using
// QuickSort based method.  ASSUMPTION: ALL ELEMENTS IN ARR[] ARE DISTINCT
int kthSmallest(int arr[], int l, int r, int k)
{
    // If k is smaller than number of elements in array
    if (k > 0 && k <= r - l + 1)
    {
        // Partition the array around a random element and
        // get position of pivot element in sorted array
        int pos = randomPartition(arr, l, r);

        // If position is same as k
        if (pos-l == k-1)
            return arr[pos];
        if (pos-l > k-1)  // If position is more, recur for left subarray
            return kthSmallest(arr, l, pos-1, k);

        // Else recur for right subarray
        return kthSmallest(arr, pos+1, r, k-pos+l-1);
    }

    // If k is more than number of elements in array
    return INT_MAX;
}

void swap(int *a, int *b)
{
    int temp = *a;
    *a = *b;
    *b = temp;
}

// Standard partition process of QuickSort().  It considers the last
// element as pivot and moves all smaller element to left of it and
// greater elements to right. This function is used by randomPartition()
int partition(int arr[], int l, int r)
{
    int x = arr[r], i = l;
    for (int j = l; j <= r - 1; j++)
    {
        if (arr[j] <= x) //arr[i] is bigger than arr[j] so swap them
        {
            swap(&arr[i], &arr[j]);
            i++;
        }
    }
    swap(&arr[i], &arr[r]); // swap the pivot
    return i;
}

// Picks a random pivot element between l and r and partitions
// arr[l..r] around the randomly picked element using partition()
int randomPartition(int arr[], int l, int r)
{
    int n = r-l+1;
    int pivot = rand() % n;
    swap(&arr[l + pivot], &arr[r]);
    return partition(arr, l, r);
}

// Driver program to test above methods
int main()
{
    int arr[] = {12, 3, 5, 7, 4, 19, 26};
    int n = sizeof(arr)/sizeof(arr[0]), k = 3;
    cout << "K'th smallest element is " << kthSmallest(arr, 0, n-1, k);
    return 0;
} 
```

上述解决方案的最坏情况时间复杂度仍然是 O(n2)。在最坏情况下，随机函数可能总是选择一个角元素。上述随机快速选择的预期时间复杂度为 Θ(n)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2016-10-24T04:17:39.953

1.  已创建优先队列。
2.  将所有元素插入堆中。
3.  调用 poll() k 次。

    ```
    public static int getKthLargestElements(int[] arr)
    {
        PriorityQueue<Integer> pq =  new PriorityQueue<>((x , y) -> (y-x));
        //insert all the elements into heap
        for(int ele : arr)
           pq.offer(ele);
        // call poll() k times
        int i=0;
        while(i&lt;k)
         {
           int result = pq.poll();
         } 
       return result;        
    } 
    ```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-02-16T11:39:16.913

还有一种算法优于快速选择算法。它被称为**弗洛伊德铆钉（FR）算法**。

原文：[https ://doi.org/10.1145/360680.360694](https://doi.org/10.1145/360680.360694)

可下载版本：[http ://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.309.7108&rep=rep1&type=pdf](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.309.7108&rep=rep1&type=pdf)

维基百科文章[https://en.wikipedia.org/wiki/Floyd%E2%80%93Rivest_algorithm](https://en.wikipedia.org/wiki/Floyd%E2%80%93Rivest_algorithm)

我尝试在 C++ 中实现快速选择和 FR 算法。此外，我将它们与标准 C++ 库实现 std::nth_element （基本上是快速选择和堆选择的 introselect 混合）进行了比较。结果是快速选择和 nth_element 平均运行相当，但 FR 算法运行大约。比他们快两倍。

我用于 FR 算法的示例代码：

```
template <typename T>
T FRselect(std::vector<T>& data, const size_t& n)
{
    if (n == 0)
        return *(std::min_element(data.begin(), data.end()));
    else if (n == data.size() - 1)
        return *(std::max_element(data.begin(), data.end()));
    else
        return _FRselect(data, 0, data.size() - 1, n);
}

template <typename T>
T _FRselect(std::vector<T>& data, const size_t& left, const size_t& right, const size_t& n)
{
    size_t leftIdx = left;
    size_t rightIdx = right;

    while (rightIdx > leftIdx)
    {
        if (rightIdx - leftIdx > 600)
        {
            size_t range = rightIdx - leftIdx + 1;
            long long i = n - (long long)leftIdx + 1;
            long long z = log(range);
            long long s = 0.5 * exp(2 * z / 3);
            long long sd = 0.5 * sqrt(z * s * (range - s) / range) * sgn(i - (long long)range / 2);

            size_t newLeft = fmax(leftIdx, n - i * s / range + sd);
            size_t newRight = fmin(rightIdx, n + (range - i) * s / range + sd);

            _FRselect(data, newLeft, newRight, n);
        }
        T t = data[n];
        size_t i = leftIdx;
        size_t j = rightIdx;
        // arrange pivot and right index
        std::swap(data[leftIdx], data[n]);
        if (data[rightIdx] > t)
            std::swap(data[rightIdx], data[leftIdx]);

        while (i < j)
        {
            std::swap(data[i], data[j]);
            ++i; --j;
            while (data[i] < t) ++i;
            while (data[j] > t) --j;
        }

        if (data[leftIdx] == t)
            std::swap(data[leftIdx], data[j]);
        else
        {
            ++j;
            std::swap(data[j], data[rightIdx]);
        }
        // adjust left and right towards the boundaries of the subset
        // containing the (k - left + 1)th smallest element
        if (j <= n)
            leftIdx = j + 1;
        if (n <= j)
            rightIdx = j - 1;
    }

    return data[leftIdx];
}

template <typename T>
int sgn(T val) {
    return (T(0) < val) - (val < T(0));
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-09-30T08:13:27.303

这是 Javascript 中的一个实现。

如果释放不能修改数组的约束，可以防止使用额外的内存使用两个索引来标识“当前分区”（经典快速排序风格 - [http://www.nczonline.net/blog/2012/ 11/27/computer-science-in-javascript-quicksort/](http://www.nczonline.net/blog/2012/11/27/computer-science-in-javascript-quicksort/)）。

```
function kthMax(a, k){
    var size = a.length;

    var pivot = a[ parseInt(Math.random()*size) ]; //Another choice could have been (size / 2) 

    //Create an array with all element lower than the pivot and an array with all element higher than the pivot
    var i, lowerArray = [], upperArray = [];
    for (i = 0; i  < size; i++){
        var current = a[i];

        if (current < pivot) {
            lowerArray.push(current);
        } else if (current > pivot) {
            upperArray.push(current);
        }
    }

    //Which one should I continue with?
    if(k <= upperArray.length) {
        //Upper
        return kthMax(upperArray, k);
    } else {
        var newK = k - (size - lowerArray.length);

        if (newK > 0) {
            ///Lower
            return kthMax(lowerArray, newK);
        } else {
            //None ... it's the current pivot!
            return pivot;
        }   
    }
} 
```

如果你想测试它的表现，你可以使用这个变体：

```
 function kthMax (a, k, logging) {
         var comparisonCount = 0; //Number of comparison that the algorithm uses
         var memoryCount = 0;     //Number of integers in memory that the algorithm uses
         var _log = logging;

         if(k < 0 || k >= a.length) {
            if (_log) console.log ("k is out of range"); 
            return false;
         }      

         function _kthmax(a, k){
             var size = a.length;
             var pivot = a[parseInt(Math.random()*size)];
             if(_log) console.log("Inputs:", a,  "size="+size, "k="+k, "pivot="+pivot);

             // This should never happen. Just a nice check in this exercise
             // if you are playing with the code to avoid never ending recursion            
             if(typeof pivot === "undefined") {
                 if (_log) console.log ("Ops..."); 
                 return false;
             }

             var i, lowerArray = [], upperArray = [];
             for (i = 0; i  < size; i++){
                 var current = a[i];
                 if (current < pivot) {
                     comparisonCount += 1;
                     memoryCount++;
                     lowerArray.push(current);
                 } else if (current > pivot) {
                     comparisonCount += 2;
                     memoryCount++;
                     upperArray.push(current);
                 }
             }
             if(_log) console.log("Pivoting:",lowerArray, "*"+pivot+"*", upperArray);

             if(k <= upperArray.length) {
                 comparisonCount += 1;
                 return _kthmax(upperArray, k);
             } else if (k > size - lowerArray.length) {
                 comparisonCount += 2;
                 return _kthmax(lowerArray, k - (size - lowerArray.length));
             } else {
                 comparisonCount += 2;
                 return pivot;
             }
     /* 
      * BTW, this is the logic for kthMin if we want to implement that... ;-)
      * 

             if(k <= lowerArray.length) {
                 return kthMin(lowerArray, k);
             } else if (k > size - upperArray.length) {
                 return kthMin(upperArray, k - (size - upperArray.length));
             } else 
                 return pivot;
     */            
         }

         var result = _kthmax(a, k);
         return {result: result, iterations: comparisonCount, memory: memoryCount};
     } 
```

其余的代码只是创建一些游乐场：

```
 function getRandomArray (n){
        var ar = [];
        for (var i = 0, l = n; i < l; i++) {
            ar.push(Math.round(Math.random() * l))
        }

        return ar;
    }

    //Create a random array of 50 numbers
    var ar = getRandomArray (50); 
```

现在，运行你的测试几次。由于 Math.random() 每次都会产生不同的结果：

```
 kthMax(ar, 2, true);
    kthMax(ar, 2);
    kthMax(ar, 2);
    kthMax(ar, 2);
    kthMax(ar, 2);
    kthMax(ar, 2);
    kthMax(ar, 34, true);
    kthMax(ar, 34);
    kthMax(ar, 34);
    kthMax(ar, 34);
    kthMax(ar, 34);
    kthMax(ar, 34); 
```

如果您对其进行几次测试，您甚至可以根据经验看到迭代次数平均为 O(n) ~= constant * n 并且 k 的值不会影响算法。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-08-06T17:23:24.187

我想出了这个算法，似乎是 O(n)：

假设 k=3，我们想在数组中找到第三大的项目。我将创建三个变量并将数组的每个项目与这三个变量中的最小值进行比较。如果数组 item 大于我们的最小值，我们将用 item 值替换 min 变量。我们继续同样的事情直到数组结束。我们三个变量中的最小值是数组中的第三大项。

```
define variables a=0, b=0, c=0
iterate through the array items
    find minimum a,b,c
    if item > min then replace the min variable with item value
    continue until end of array
the minimum of a,b,c is our answer 
```

而且，要找到第 K 个最大的项目，我们需要 K 个变量。

示例：(k=3)

```
[1,2,4,1,7,3,9,5,6,2,9,8]

Final variable values:

a=7 (answer)
b=8
c=9 
```

有人可以查看这个并让我知道我缺少什么吗？

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-06-02T09:05:39.030

这是eladv建议的算法的实现（我也在这里放了随机枢轴的实现）：

```
public class Median {

    public static void main(String[] s) {

        int[] test = {4,18,20,3,7,13,5,8,2,1,15,17,25,30,16};
        System.out.println(selectK(test,8));

        /*
        int n = 100000000;
        int[] test = new int[n];
        for(int i=0; i<test.length; i++)
            test[i] = (int)(Math.random()*test.length);

        long start = System.currentTimeMillis();
        random_selectK(test, test.length/2);
        long end = System.currentTimeMillis();
        System.out.println(end - start);
        */
    }

    public static int random_selectK(int[] a, int k) {
        if(a.length <= 1)
            return a[0];

        int r = (int)(Math.random() * a.length);
        int p = a[r];

        int small = 0, equal = 0, big = 0;
        for(int i=0; i<a.length; i++) {
            if(a[i] < p) small++;
            else if(a[i] == p) equal++;
            else if(a[i] > p) big++;
        }

        if(k <= small) {
            int[] temp = new int[small];
            for(int i=0, j=0; i<a.length; i++)
                if(a[i] < p)
                    temp[j++] = a[i];
            return random_selectK(temp, k);
        }

        else if (k <= small+equal)
            return p;

        else {
            int[] temp = new int[big];
            for(int i=0, j=0; i<a.length; i++)
                if(a[i] > p)
                    temp[j++] = a[i];
            return random_selectK(temp,k-small-equal);
        }
    }

    public static int selectK(int[] a, int k) {
        if(a.length <= 5) {
            Arrays.sort(a);
            return a[k-1];
        }

        int p = median_of_medians(a);

        int small = 0, equal = 0, big = 0;
        for(int i=0; i<a.length; i++) {
            if(a[i] < p) small++;
            else if(a[i] == p) equal++;
            else if(a[i] > p) big++;
        }

        if(k <= small) {
            int[] temp = new int[small];
            for(int i=0, j=0; i<a.length; i++)
                if(a[i] < p)
                    temp[j++] = a[i];
            return selectK(temp, k);
        }

        else if (k <= small+equal)
            return p;

        else {
            int[] temp = new int[big];
            for(int i=0, j=0; i<a.length; i++)
                if(a[i] > p)
                    temp[j++] = a[i];
            return selectK(temp,k-small-equal);
        }
    }

    private static int median_of_medians(int[] a) {
        int[] b = new int[a.length/5];
        int[] temp = new int[5];
        for(int i=0; i<b.length; i++) {
            for(int j=0; j<5; j++)
                temp[j] = a[5*i + j];
            Arrays.sort(temp);
            b[i] = temp[2];
        }

        return selectK(b, b.length/2 + 1);
    }
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-07-01T10:30:26.587

它类似于快速排序策略，我们选择一个任意的枢轴，并将较小的元素放在其左侧，将较大的元素放在右侧

```
 public static int kthElInUnsortedList(List<int> list, int k)
    {
        if (list.Count == 1)
            return list[0];

        List<int> left = new List<int>();
        List<int> right = new List<int>();

        int pivotIndex = list.Count / 2;
        int pivot = list[pivotIndex]; //arbitrary

        for (int i = 0; i < list.Count && i != pivotIndex; i++)
        {
            int currentEl = list[i];
            if (currentEl < pivot)
                left.Add(currentEl);
            else
                right.Add(currentEl);
        }

        if (k == left.Count + 1)
            return pivot;

        if (left.Count < k)
            return kthElInUnsortedList(right, k - left.Count - 1);
        else
            return kthElInUnsortedList(left, k);
    } 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2016-07-25T17:03:47.067

转到此链接的末尾：......

[http://www.geeksforgeeks.org/kth-smallestlargest-element-unsorted-array-set-3-worst-case-linear-time/](http://www.geeksforgeeks.org/kth-smallestlargest-element-unsorted-array-set-3-worst-case-linear-time/)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2017-10-31T21:45:00.247

您可以在 O(n) 时间和常数空间中找到第 k 个最小的元素。如果我们认为数组仅用于整数。

该方法是对 Array 值的范围进行二进制搜索。如果我们有一个 min_value 和一个 max_value 都在整数范围内，我们可以在该范围内进行二进制搜索。我们可以编写一个比较器函数，它会告诉我们任何值是否是第 k 小或小于第 k 小或大于第 k 小。进行二分查找，直到找到第 k 个最小的数

这是代码

类解决方案：

```
def _iskthsmallest(self, A, val, k):
    less_count, equal_count = 0, 0
    for i in range(len(A)):
        if A[i] == val: equal_count += 1
        if A[i] < val: less_count += 1

    if less_count >= k: return 1
    if less_count + equal_count < k: return -1
    return 0

def kthsmallest_binary(self, A, min_val, max_val, k):
    if min_val == max_val:
        return min_val
    mid = (min_val + max_val)/2
    iskthsmallest = self._iskthsmallest(A, mid, k)
    if iskthsmallest == 0: return mid
    if iskthsmallest > 0: return self.kthsmallest_binary(A, min_val, mid, k)
    return self.kthsmallest_binary(A, mid+1, max_val, k)

# @param A : tuple of integers
# @param B : integer
# @return an integer
def kthsmallest(self, A, k):
    if not A: return 0
    if k > len(A): return 0
    min_val, max_val = min(A), max(A)
    return self.kthsmallest_binary(A, min_val, max_val, k) 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-02-06T03:04:23.567

第 k 个最大元素意味着，我们需要对数组进行排序，然后从数组末尾倒数。例如

```
 const array= [2, 32, 12, 3, 78, 99, 898, 8, 1] // we need to sort this
 const sortedArray= [1,  2,  3,   8, 12, 32, 78, 99, 898] 
```

第 5 个最大元素意味着从最后倒数 5 个元素，即 12。

默认情况下，大多数语言实现快速排序或合并排序，因为它们是最优化的排序。我用快速排序解决了这个问题。快速排序对数组进行就地排序，它不会给我们返回一个新数组，并且像合并排序一样它是递归的。快速排序的缺点，在最坏的情况下，它的时间复杂度是 O(n**2) "n square"。

快速排序是分治算法，通过解决其所有较小的组件来解决问题。我们选择最后一个元素作为枢轴元素（有些算法选择第一个元素作为枢轴，有些算法在开始时选择最后一个元素）。枢轴元素是分区元素。这是我们的数组=[2, 32, 12, 3, 78, 99, 898, 8, 1]

我们使用 2 个指针，i,j 从第一个元素开始。"i" 跟踪枢轴的最终位置。

```
i=j=2 //starting point 
```

“j”将扫描数组，并将每个元素与枢轴进行比较。如果“j”小于pivot，我们将交换“i”和“j”并将“i”和“j”向前移动。当“j”到达枢轴时，我们将“i”与枢轴交换。在我们的示例中，pivot 是`1`，1 是较小的数字，“j”将在`pivot=1`不交换“i”、“j”的情况下到达 。请记住，“i”是枢轴的占位符。因此，当“j”到达枢轴时，1 和 2 将被交换。

此操作的目的是找到所有小于其左侧枢轴的元素。请注意，枢轴左侧的所有元素都小于枢轴，但左侧未排序。然后我们将数组从枢轴分成 2 个子数组并递归地应用快速排序。

```
const quickSort = function (array, left, right) {
  // if left=right, it means we have only one item, it is already sorted
  if (left < right) {
    const partitionIndex = partition(array, left, right);
    quickSort(array, left, partitionIndex - 1); 
    quickSort(array, partitionIndex + 1, right);
  }
}; 
```

使用“i”和“j”指针，这就是我们找到分区索引的方式

```
const partition = function (array, left, right) {
  const pivotElement = array[right];
  let partitionIndex = left;
  for (let j = left; j < right; j++) {
    if (array[j] < pivotElement) {
      swap(array, partitionIndex, j);
      partitionIndex++;
    }
  }
  // if none of the "j" values is smaller than pivot, when "j" reaches the pivot, we swap "i'th" element with pivot
  swap(array, partitionIndex, right);
  return partitionIndex;
}; 
```

这是交换功能的简单实现：

```
const swap = function (array, i, j) {
  const temp = array[i];
  array[i] = array[j];
  array[j] = temp;
}; 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2021-09-07T00:30:30.463

```
 ```
 function nthMax(arr, nth = 1, maxNumber = Infinity) {
      let large = -Infinity;
      for(e of arr) {
        if(e > large && e < maxNumber ) {
          large = e;
        } else if (maxNumber == large) {
          nth++;
        }
      }
      return nth==0 ? maxNumber: nthMax(arr, nth-1, large);
    }

    let array = [11,12,12,34,23,34];

    let secondlargest = nthMax(array, 1);

    console.log("Number:", secondlargest);
``` 
```

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2008-10-30T21:19:00.757

我要做的是：

```
initialize empty doubly linked list l
for each element e in array
    if e larger than head(l)
        make e the new head of l
        if size(l) > k
            remove last element from l

the last element of l should now be the kth largest element 
```

您可以简单地存储指向链表中第一个和最后一个元素的指针。它们仅在对列表进行更新时更改。

更新：

```
initialize empty sorted tree l
for each element e in array
    if e between head(l) and tail(l)
        insert e into l // O(log k)
        if size(l) > k
            remove last element from l

the last element of l should now be the kth largest element 
```

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2013-09-17T11:30:12.817

首先，我们可以从需要 O(n) 时间的未排序数组构建 BST，并且从 BST 中我们可以找到 O(log(n)) 中的第 k 个最小元素，该元素的总计数为 O(n)。

* * *

## 回答 #33

> 赞同：-2
> 
> 时间：2012-10-05T05:21:15.823

对于非常小的 k 值（即当 k << n），我们可以在 ~O(n) 时间内完成。否则，如果 k 与 n 相当，我们在 O(nlogn) 中得到它。

# java - 使用 Junit 4.4 或更高版本运行 Eclipse Junit 插件测试——为什么没有检测到测试？

> ID：251791
> 
> 赞同：23
> 
> 时间：2008-10-30T21:10:11.383
> 
> 标签：java, eclipse, unit-testing, junit, eclipse-pde

我需要在一组 eclipse 插件测试中使用 JUnit 4.4（或更新版本），但我遇到了以下问题：

使用 springsource 中的 junit 4.4 或 4.5 包（[junit44](http://www.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.junit&version=4.4.0)和[junit45](http://www.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.junit&version=4.5.0&searchType=bundlesByName&searchQuery=junit)）运行时未检测到测试。可以用 eclipse 获得的 org.junit4 包提供了 junit 4.3（从 Ganymead / Eclipse 3.4 开始）。org.junit4 包*确实*可以识别和运行测试，但它与最新版本的 JMock 不兼容，我需要使用模拟库。

这是一个示例测试：

```
package testingplugin;

import static org.junit.Assert.*;
import org.junit.Test;

public class ActivatorTest {
   @Test
   public final void testDoaddTest() {
      fail("Not yet implemented");
   }
} 
```

运行此测试时，我收到以下异常：

```
java.lang.Exception: No runnable methods
    at org.junit.internal.runners.TestClassMethodsRunner.run(TestClassMethodsRunner.java:33)
    at org.junit.internal.runners.TestClassRunner$1.runUnprotected(TestClassRunner.java:42)
    at org.junit.internal.runners.BeforeAndAfterRunner.runProtected(BeforeAndAfterRunner.java:34)
    at org.junit.internal.runners.TestClassRunner.run(TestClassRunner.java:52)
    at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:45)
    at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)
    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)
    at org.eclipse.pde.internal.junit.runtime.RemotePluginTestRunner.main(RemotePluginTestRunner.java:62)
    at org.eclipse.pde.internal.junit.runtime.CoreTestApplication.run(CoreTestApplication.java:23)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at org.eclipse.equinox.internal.app.EclipseAppContainer.callMethodWithException(EclipseAppContainer.java:574)
    at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:195)
    at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)
    at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)
    at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:382)
    at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:179)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:597)
    at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:549)
    at org.eclipse.equinox.launcher.Main.basicRun(Main.java:504)
    at org.eclipse.equinox.launcher.Main.run(Main.java:1236)
    at org.eclipse.equinox.launcher.Main.main(Main.java:1212) 
```

但是，如果我将项目依赖项从 com.springsource.org.junit 切换到 org.junit4，则测试运行并失败（如预期的那样）。

我在 Eclipse 中将测试作为 JUnit 插件测试运行，具有以下程序参数：

-os ${target.os} -ws ${target.ws} -arch ${target.arch} -nl ${target.nl}

在启动期间选择了以下插件（由我选择，然后我使用“添加所需的插件”来获取其余的依赖项。）：

```
Workspace:
   testingPlugin
Target Platform:
   com.springsource.org.hamcrest.core (1.1.0)
   com.springsource.org.junit (4.5.0)
   ....and a bunch of others... (nothing related to testing was auto-selected) 
```

这是我的清单.MF：

```
Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: TestingPlugin Plug-in
Bundle-SymbolicName: testingPlugin
Bundle-Version: 1.0.0
Bundle-Activator: testingplugin.Activator
Import-Package: org.osgi.framework;version="1.3.0"
Bundle-RequiredExecutionEnvironment: JavaSE-1.6
Require-Bundle: com.springsource.org.junit;bundle-version="4.5.0" 
```

将最后一行切换为：

```
Require-Bundle: org.junit4;bundle-version="4.3.1" 
```

并在启动时将选定的插件更新为：

```
Workspace:
   testingPlugin
Target Platform:
   org.junit4 (4.3.1)
   ...bunches of auto-selected bundles... (again, nothing else test related) 
```

使测试正常运行（但使用错误的 junit 版本）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T12:42:47.347

根据我的经验，如果包含插件测试的插件不依赖于 junit，就会发生这种情况。将 junit 4.4 依赖项添加到我的 MANIFEST.MF 文件后，错误消失并执行了所有测试。junit 依赖项应该是可选的，因为插件通常只在测试代码中需要它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T08:44:52.077

我现在无法测试这个，因为我没有方便的 Eclipse 3.4 安装，但是我不久前在（我认为）IntelliJ IDEA 7.0.x 中遇到了类似的问题，解决方法是明确指定一个测试亚军。

使用 JUnit 4.5：

```
import org.junit.runners.JUnit4;

@RunWith(JUnit4.class)
public class ActivatorTest {
    //...
} 
```

如果这不起作用，您可能会获得更大的成功`org.junit.runners.BlockJUnit4ClassRunner`

对于 JUnit 4.4，我会尝试`org.junit.internal.runners.JUnit4ClassRunner`

编辑：不太确定这`com.springsource.`部分，因为我不使用 Springsource。从您的问题来看，springsource 似乎将 JUnit 重新打包，`com.springsource.org.junit`但您只`org.junit`在代码中使用，所以我会坚持下去。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T08:03:46.750

我想知道您是否可能需要从 com.springsource.org.junit 而不是从 org.junit 导入 @Test 标记。

沃尔克

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-06T23:18:20.613

I had some similar sounding problems with jMock, JUnit & Eclipse [recently](http://blog.floehopper.org/articles/2009/01/22/climbing-back-onto-the-java-horse), although admittedly not with *plugin* tests.

I'm not sure if it's relevant, but I got it all working with the following versions :-

*   jmock-2.5.1.jar
*   hamcrest-core-1.1.jar
*   hamcrest-library-1.1.jar
*   jmock-junit4-2.5.1.jar

I also found I had to use the [JMock test runner](http://www.jmock.org/javadoc/2.5.1/org/jmock/integration/junit4/JMock.html) like this :-

```
 import org.junit.Test;
  import org.junit.runner.RunWith;

  import org.jmock.Mockery;
  import org.jmock.Expectations;
  import org.jmock.integration.junit4.JUnit4Mockery;
  import org.jmock.integration.junit4.JMock;

  @RunWith(JMock.class)
  public class PublisherTest {

    Mockery context = new JUnit4Mockery();

    @Test 
    public void oneSubscriberReceivesAMessage() { 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-04T08:26:46.113

我不知道它是哪个版本的 JUnit，但要成功找到测试，测试方法名称必须以单词“ **test** ”开头。

在较新的版本中，您可以简单地使用 @Test 标记测试，对我来说，它适用于以下组合：

```
import static junit.framework.Assert.*;
...
@Test
    public void testDummy() throws Exception 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T08:25:50.000

ActivatorTest 需要扩展 TestCase

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-25T08:05:35.360

也许您的 JUnit 包在 MANIFEST.MF 中缺少一个条目：

动态导入包：*

这是从其他包加载类的强制性要求。

贝博

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-21T10:05:28.873

@RunWith(Suite.class) @SuiteClasses( { UserServiceTest.class,ABCServiceTest.class })

公共类 AllTestSuite {

公共静态测试套件（）{

```
 return new JUnit4TestAdapter(AllTestSuite .class);
 } 
```

}

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-21T11:25:28.760

我认为spring测试框架不兼容junit 4.4+

# database - 使用 SQL Server Express 进行开发时如何管理版本控制？

> ID：251795
> 
> 赞同：4
> 
> 时间：2008-10-30T21:10:25.190
> 
> 标签：database, version-control, ddl, sql-server-2005-express

我正在我的开发机器上使用 SQL Server Express 开发一个网站。我的网络托管公司正在为我提供 SQL Server 2005。

目前，我所拥有的只是一个用于开发的数据库和一个位于实时服务器上的数据库。我没有生成架构的原始脚本，但我可以单独或为整个数据库自动生成创建脚本。

我现在将我的代码放入源代码管理中，我想知道我如何管理我的数据库模式。我在里面放什么？创建命令？修改脚本？

目前数据库很小，维护两个数据库并不难，但我担心未来会失控。在部署新代码时，您有什么技巧可以让实时数据库同步吗？

**编辑**关于什么应该进入源代码控制的任何想法？DDL 脚本应该放在这里吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T21:12:26.463

将架构更改部署为 DDL 升级脚本，如果还没有，请添加一个表以包含您在每个升级脚本末尾更新的架构版本号。

编辑：是的，您的所有脚本都应该进入源代码管理，包括 DDL 脚本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T21:14:10.797

我通常会在我的本地或虚拟开发盒上保留一个实时数据库的测试副本，我会定期从 prod 数据库刷新到测试。测试副本是为了我的全面利用。当我有一些我认为可以部署的东西时，我会将其移动到我的开发数据集，该数据集反映了 prod 数据库，而不是用于玩耍。如果开发数据库通过了我的所有测试，我将脚本部署到生产数据库

# c# - 接口的属性

> ID：251806
> 
> 赞同：18
> 
> 时间：2008-10-30T21:14:38.300
> 
> 标签：c#, reflection, attributes, interface

我有一个接口，它定义了一些带有属性的方法。这些属性需要从调用方法中访问，但是我有的方法并没有从接口中拉取属性。我错过了什么？

```
public class SomeClass: ISomeInterface
{
    MyAttribute GetAttribute()
    {
        StackTrace stackTrace = new StackTrace();
        StackFrame stackFrame = stackTrace.GetFrame(1);
        MethodBase methodBase = stackFrame.GetMethod();
        object[] attributes = methodBase.GetCustomAttributes(typeof(MyAttribute), true);
        if (attributes.Count() == 0)
            throw new Exception("could not find MyAttribute defined for " + methodBase.Name);
        return attributes[0] as MyAttribute;
    }

    void DoSomething()
    {
        MyAttribute ma = GetAttribute();
        string s = ma.SomeProperty;
    }
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T21:21:18.817

methodBase 将是类上的方法，而不是接口。您将需要在界面上寻找相同的方法。在 C# 中，这有点简单（因为它必须同名），但您需要考虑诸如显式实现之类的事情。如果你有 VB 代码，那就更棘手了，因为 VB 方法“Foo”可以实现接口方法“Bar”。为此，您需要调查接口映射：

```
using System;
using System.ComponentModel;
using System.Diagnostics;
using System.Reflection;
interface IFoo
{
    void AAA(); // just to push Bar to index 1
    [Description("abc")]
    void Bar();
}
class Foo : IFoo
{
    public void AAA() { } // just to satisfy interface
    static void Main()
    {
        IFoo foo = new Foo();
        foo.Bar();
    }
    void IFoo.Bar()
    {
        GetAttribute();
    }

    void GetAttribute()
    { // simplified just to obtain the [Description]

        StackTrace stackTrace = new StackTrace();
        StackFrame stackFrame = stackTrace.GetFrame(1);
        MethodBase classMethod = stackFrame.GetMethod();
        InterfaceMapping map = GetType().GetInterfaceMap(typeof(IFoo));
        int index = Array.IndexOf(map.TargetMethods, classMethod);
        MethodBase iMethod = map.InterfaceMethods[index];
        string desc = ((DescriptionAttribute)Attribute.GetCustomAttribute(iMethod, typeof(DescriptionAttribute))).Description;
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T14:04:33.470

Mark 的方法适用于非泛型接口。但似乎我正在处理一些具有泛型的

```
interface IFoo<T> {}
class Foo<T>: IFoo<T>
{
  T Bar()
} 
```

看来 T 已替换为 map.TargetMethods 中的实际 classType。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T21:33:26.233

虽然我首先要承认我从未尝试将属性附加到接口，但是像下面这样的东西对你有用吗？

```
public abstract class SomeBaseClass: ISomeInterface
{
     [MyAttribute]
     abstract void MyTestMethod();

}

public SomeClass : SomeBaseClass{

  MyAttribute GetAttribute(){
      Type t = GetType();
      object[] attibutes = t.GetCustomAttributes(typeof(MyAttribute), false);

      if (attributes.Count() == 0)
            throw new Exception("could not find MyAttribute defined for " + methodBase.Name);
        return attributes[0] as MyAttribute;
  }

  ....
} 
```

# java - 以编程方式生成 Eclipse 项目

> ID：251807
> 
> 赞同：17
> 
> 时间：2008-10-30T21:15:18.300
> 
> 标签：java, eclipse

我使用 eclipse 来处理最初独立于 eclipse 创建的应用程序。因此，应用程序的目录结构显然不是 Eclipse 友好的。

我想以编程方式为应用程序生成一个项目。和文件很容易弄清楚，我了解到项目存储在工作区`.project`中`.classpath``<workspace>/.metadata/.plugins/org.eclipse.core.resources/.projects`

不幸的是，这里的一些文件（特别是`.location`）似乎以某种二进制格式编码。凭直觉，我尝试使用`ObjectInputStream`- 没有骰子来反序列化它。所以它似乎不是一个序列化的 java 对象。

我的问题是：有没有办法自动生成这些文件？

出于好奇，我试图反序列化`.location`文件的错误如下：

`java.io.StreamCorruptedException: java.io.StreamCorruptedException: invalid stream header: 40B18B81`

**更新：**我的目标是能够用命令行脚本或程序替换 New Java Project 向导。原因是所讨论的应用程序实际上是一个非常大的 J2EE/weblogic 应用程序，我喜欢将其分解为一个较大的（近 20 个）子项目集合。更复杂的是，我们为 SCM 使用 clearcase 并为每个版本创建一个新分支。这意味着我需要为我创建的每个开发视图（分支）重新创建这些项目。这种情况经常发生，足以实现自动化。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-30T23:46:38.040

您应该能够通过编写一个小的 Eclipse 插件来完成此操作。您甚至可以将其扩展为“无头”RCP 应用程序，并传入您需要的命令行参数。

创建项目的准系统代码是：

```
IProgressMonitor progressMonitor = new NullProgressMonitor();
IWorkspaceRoot root = ResourcesPlugin.getWorkspace().getRoot();
IProject project = root.getProject("DesiredProjectName");
project.create(progressMonitor);
project.open(progressMonitor); 
```

只需查看 Import Project 向导的 eclipse 代码，您就可以更好地了解如何使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T23:54:06.373

使用[AntEclipse](http://ant-eclipse.sourceforge.net)

它可以从 ant 创建 eclipse 项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-09-01T09:48:56.863

要创建 java 项目，您可以使用`org.eclipse.jdt.core.JavaCore`. 作为`sourceProject`您可以使用@James Van Huis 建议的通用项目项目

```
IJavaProject javaSourceProject = JavaCore.create(sourceProject); 
```

# javascript - jQuery 和“有组织的代码”

> ID：251814
> 
> 赞同：51
> 
> 时间：2008-10-30T21:17:34.020
> 
> 标签：javascript, jquery, code-organization

我最近一直在努力理解组织 jQuery 代码的最佳方式。我之前问了另一个问题，我认为我不够具体（[在这个问题中找到](https://stackoverflow.com/questions/247209/javascript-how-do-you-organize-this-mess)）。

我的问题是，您制作的应用程序越丰富，您的客户端越快失控。考虑这种情况...

```
//Let's start some jQuery
$(function() {        
    var container = $("#inputContainer");

    //Okay let's list text fields that can be updated
    for(var i=0; i < 5; i++) {

        //okay let's add an event for when a field changes
        $("<input/>").change(function() {

            //okay something changed, let's update the server
            $.ajax({
                success:function(data) {

                    //Okay - no problem from the server... let's update
                    //the bindings on our input fields
                    $.each(container.children(), function(j,w) {

                        //YIKES!! We're deep in here now!!
                        $(w).unbind().change(function() {

                            //Then insanity starts...

                        }); // end some function

                    }); //end some loop

                } // what was this again?

            }); //ending something... not sure anymore

        }).appendTo(container); //input added to the page... logic WAY split apart

    }; //the first loop - whew! almost out!

});  //The start of the code!! 
```

现在这种情况并非不可能。我并不是说这是正确的做法，但发现自己进入 jQuery 命令的几个级别并开始想知道在屏幕开始融化之前还可以添加多少逻辑的情况并不少见。

**我的问题是人们如何管理或组织以限制其代码的复杂性？**

*[我在另一篇文章中列出了我是如何做到的](https://stackoverflow.com/questions/247209/javascript-how-do-you-organize-this-mess#247382)...*

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-10-31T23:08:22.577

只是想补充一下前面提到的内容：

```
$.each(container.children(), function(j,w) {
    $(w).unbind().change(function() { ... });
}); 
```

可以优化为：

```
container.children().unbind().change(function() { ... }); 
```

这一切都与链接有关，这是一种简化代码的好方法。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-30T21:37:48.533

到目前为止，我这样做是这样的：

```
// initial description of this code block
$(function() {        
    var container = $("#inputContainer");

    for(var i=0; i < 5; i++) {
        $("<input/>").changed(inputChanged).appendTo(container);
    }; 

    function inputChanged() {
        $.ajax({
            success: inputChanged_onSuccess
        });
     } 

     function inputChanged_onSuccess(data) {
        $.each(container.children(), function(j,w) {
          $(w).unbind().changed(function() {
             //replace the insanity with another refactored function
          });
        });
      }
}); 
```

在 JavaScript 中，函数是一等对象，因此可以用作变量。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-30T21:32:10.043

好吧，一方面，拥有一个理解 javascript 的优秀 IDE 可以提供极大的帮助，即使只是为了识别匹配的分界线（大括号、括号等）。

如果您的代码开始变得如此复杂，请考虑创建自己的静态对象来组织混乱 - 您不必费力地工作以保持一切匿名。

```
var aCustomObject = {
    container: $("#inputContainer"),
    initialize: function()
    {
        for(var i=0; i < 5; i++)
        {
            $("<input/>").changed( aCustomObject.changeHandler );
        }
    },
    changeHandler: function( event )
    {
        $.ajax( {success: aCustomObject.ajaxSuccessHandler} );
    },
    ajaxSuccessHandler: function( data )
    {
        $.each( aCustomObject.container.children(), aCustomObject.updateBindings )
    },
    updateBindings: function( j, w )
    {
        $(w).unbind().changed( function(){} );
    }
}
aCustomObject.initialize(); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-02-02T15:14:18.520

有人写了一篇关于类似主题的帖子。

[jQuery 代码不一定是丑陋的](http://weblogs.asp.net/stevewellens/archive/2010/01/25/jquery-code-does-not-have-to-be-ugly.aspx)

例如，作者 Steve Wellens 建议不要使用匿名函数，因为它会使代码更难阅读。相反，将函数引用推送到 jQuery 方法中，如下所示：

```
$(document).ready(DocReady);

function DocReady()
{       
    AssignClickToToggleButtons();
    ColorCodeTextBoxes();
} 
```

这篇文章的另一个收获是将一个 jQuery 对象分配给一个具体的变量，这使得代码看起来更干净，对实际 jQuery 对象的依赖更少，并且更容易分辨出某行代码在做什么：

```
function ColorCodeTextBoxes()
{
    var TextBoxes = $(":text.DataEntry");

    TextBoxes.each(function()
    {
        if (this.value == "")
            this.style.backgroundColor = "yellow";
        else
            this.style.backgroundColor = "White";
    });
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-30T22:59:24.780

在我看来，BaileyP 描述的方法是我开始使用的方法，然后我通常将所有内容抽象为更可重用的块，特别是当某些功能扩展到更容易将其抽象为插件然后将其特定于一个站点。

只要您将大块代码保存在单独的文件中并且编码良好，您就可以得到一些非常干净的语法。

```
// Page specific code
jQuery(function() {
    for(var i = 0; i < 5; i++) {
         $("<input/>").bindWithServer("#inputContainer");
    }
});

// Nicely abstracted code
jQuery.fn.bindWithServer = function(container) {
     this.change(function() {
             jQuery.ajax({
                 url: 'http://example.com/',
                 success: function() { jQuery(container).unbindChildren(); }
             });
     });
}
jQuery.fn.unbindChildren = function() {
    this.children().each(function() {
        jQuery(this).unbind().change(function() {});
    });
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-10-28T02:58:55.353

使用[http://coffeescript.com/](http://coffeescript.com/) ;)

```
$->
  容器 = $ '#inputContainer'
  对于我在 [0...5]
    $('<input/>').change ->
      $.ajax 成功：（数据）->
        在 container.children() 中为 w
          $(w).unbind().change ->
            警报“呃”

```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-30T21:30:05.507

将一些匿名函数粘贴到全局范围函数（或您自己的“命名空间”对象）中，尤其是重用函数，它开始看起来不像您发布的那样。有点像你链接的东西。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-12T20:48:01.230

我[在你的另一篇文章中](https://stackoverflow.com/questions/247209/javascript-how-do-you-organize-this-mess#284700)描述了我的方法。简写：

*   不要混合使用 javascript 和 HTML
*   使用类（基本上开始将您的应用程序视为小部件的集合）
*   只有一个 $(document).ready(...) 块
*   将 jQuery 实例发送到您的类中（而不是使用插件）

# c# - Formview 被清除

> ID：251816
> 
> 赞同：2
> 
> 时间：2008-10-30T21:18:17.467
> 
> 标签：c#, asp.net, gridview, formview

我的问题是，当我点击提交按钮时，我的表单视图的所有文本框都被清除了。

我目前有一个页面，其中有一个小部分，周围有一个更新面板。这个小部分为我的数据库添加了一个地址。在该表单的左侧有一个绑定到表单视图的网格视图。因此，如果我单击 gridview 中的一个项目，它的内容会用正确的数据填充地址部分（formview）。

当我点击添加时，数据在后面的 c# 代码中得到验证，如果所有信息都正确，则插入地址。**如果出现错误，整个表单将被清除**并显示错误消息（标签）。

我已经在其他页面中多次这样做了，但是没有一个将 gridview 绑定到 formview，并且它们都有效。我尝试删除 gridview 并且表单仍然会自行删除。

.net 是否有某些原因认为它应该清除表单？当在其他情况下它决定它不会？如果是这样，这些情况是什么，或者我应该尝试什么一般提示来解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T21:59:46.663

在 page_load 中，您是否使用 if(!Page.IsPostback) { ... } 所以如果它是回发，则不会重新绑定？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T15:43:30.367

是否启用了 ViewState？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T17:29:44.957

是的，许多小时后，我发现围绕该部分的单个面板添加了一个 EnableViewState="false"。可悲的是，我知道我没有添加它，因为直到克雷格在这里提到它之前我什至不知道它是什么。Visual Studio 必须在某个时候添加它。

# ubuntu - 我将如何调查和解决 Mercurial 授权问题？

> ID：251817
> 
> 赞同：0
> 
> 时间：2008-10-30T21:18:38.790
> 
> 标签：ubuntu, mercurial, dvcs

我有一个带有 bitbucket 的私有存储库。

我在 Ubuntu 上使用 Mercurial 分布式 SCM（版本 0.9.3）。

当我尝试克隆我的存储库时，系统会提示我输入正确输入的用户名和密码。

结果我得到：`abort: authorization failed`

这在 Windows 上工作得很好。

我只是想确保在提交错误之前我没有遗漏一些明显的东西。

我是分布式版本控制的新手。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T03:36:49.807

在这一点上，这是一个相当旧的 mercurial 版本。你能安装 1.0.2 看看它是否有效吗？

我一直通过 http 和 ssh 远程克隆，没有任何授权问题。这是一个非常常见的用例，如果它是一个在后来的版本中没有很快修复的错误，我会感到惊讶。

# vb.net - 检索具有最长字符串长度的成员变量的对象

> ID：251834
> 
> 赞同：1
> 
> 时间：2008-10-30T21:24:16.563
> 
> 标签：vb.net, linq-to-objects

给定一个包含字符串成员变量的对象的通用列表，获取包含最长长度字符串的对象的最佳方法是什么？

IE。假设 val1 是我正在比较的字符串：

```
0 : { val1 = "a"   }
1 : { val1 = "aa"  }
2 : { val1 = "aba" }
3 : { val1 = "c"   } 
```

需要返回的是对象 2，因为“aba”的长度最大。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T21:33:45.967

对不起，我再试一次。您可以使用以下聚合：

```
Dim result = elements.Aggregate(Function(a, b) If(a.val1.Length > b.val1.Length, a, b)) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T21:35:33.437

您还可以使用 order-by：

```
var x = myStringArray.OrderBy(s => s.Length).Last(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-28T10:42:24.537

```
Dim longestLength = elements.Max(Function(el) el.val1.Length)
Dim longest = elements.First(Function(el) el.val1.Length = longestLength) 
```

# c# - Asp.Net：扩展范围验证

> ID：251842
> 
> 赞同：4
> 
> 时间：2008-10-30T21:27:02.533
> 
> 标签：c#, asp.net, validation

我正在使用 Asp.Net 2.0。我有一个场景，我需要根据两个范围中的任何一个检查用户输入。例如，我需要根据范围 100-200 或 500-600 检查文本框值。我知道我可以将 2 个 Asp.Net RangeValidators 连接到 TextBox，但这将尝试根据两个范围验证输入，一个 AND 条件，如果你愿意的话。CustomValidator 是一个选项，但我将如何从服务器端传递 2 个范围值。是否可以扩展 RangeValidator 来解决这个特定问题？

[更新]对不起，我没有提到这一点，对我来说问题是范围可能会有所不同。并且页面中的不同控件也会根据某些条件具有不同的范围。我知道我可以将这些值保存在一些 js 变量或隐藏的输入元素中，但它看起来不会很优雅。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T21:47:25.097

CustomValidator 应该可以工作。我不确定“从服务器端传递 2 个范围值”是什么意思。您可以使用如下验证方法在服务器端对其进行验证：

```
void ValidateRange(object sender, ServerValidateEventArgs e)
{
    int input;
    bool parseOk = int.TryParse(e.Value, out input);
    e.IsValid = parseOk &&
                ((input >= 100 || input <= 200) ||
                (input >= 500 || input <= 600));
} 
```

然后，您需要将 CustomValidator 的 OnServerValidate 属性设置为“ValidateRange”，或者您碰巧调用它的任何名称。

这是你追求的那种东西吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T21:45:31.513

您可以使用将 ValidationExpression 属性设置为的 RegularExpressionValidator

编辑：（哎呀，650和201等对旧模式有效）

```
^(1\d{2}|200|5\d{2}|600)$ 
```

这将测试输入的文本是否为 100-200 和 500-600。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T21:45:44.417

我不相信使用标准 RangeValidator 控件可以做到这一点。

我做了一些搜索，我相信您最好的解决方案是创建您自己的 CustomValidator 控件，您可以将其包含在您的项目中以处理这种情况。

[http://www.dotnetjunkies.ddj.com/Article/592CE980-FB7E-4DF7-9AC1-FDD572776680.dcik](http://www.dotnetjunkies.ddj.com/Article/592CE980-FB7E-4DF7-9AC1-FDD572776680.dcik)

只要您正确引用它，您不必编译它只是为了在您的项目中使用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T03:53:07.730

我扩展了 BaseValidator 来实现这一点。一旦你了解了验证器的工作原理，它就相当简单了。我已经包含了一个粗略的代码版本来演示它是如何完成的。请注意，它是针对我的问题量身定制的（例如 int 应该始终 > 0），但您可以轻松扩展它。

```
 public class RangeValidatorEx : BaseValidator
{

    protected override void AddAttributesToRender(System.Web.UI.HtmlTextWriter writer)
    {
        base.AddAttributesToRender(writer);

        if (base.RenderUplevel)
        {
            string clientId = this.ClientID;

            // The attribute evaluation funciton holds the name of client-side js function.
            Page.ClientScript.RegisterExpandoAttribute(clientId, "evaluationfunction", "RangeValidatorEx");

            Page.ClientScript.RegisterExpandoAttribute(clientId, "Range1High", this.Range1High.ToString());
            Page.ClientScript.RegisterExpandoAttribute(clientId, "Range2High", this.Range2High.ToString());
            Page.ClientScript.RegisterExpandoAttribute(clientId, "Range1Low", this.Range1Low.ToString());
            Page.ClientScript.RegisterExpandoAttribute(clientId, "Range2Low", this.Range2Low.ToString());

        }
    }

    // Will be invoked to validate the parameters 
    protected override bool ControlPropertiesValid()
    {
        if ((Range1High <= 0) || (this.Range1Low <= 0) || (this.Range2High <= 0) || (this.Range2Low <= 0))
            throw new HttpException("The range values cannot be less than zero");

        return base.ControlPropertiesValid();
    }

    // used to validation on server-side
    protected override bool EvaluateIsValid()
    {
        int code;
        if (!Int32.TryParse(base.GetControlValidationValue(ControlToValidate), out code))
            return false;

        if ((code < this.Range1High && code > this.Range1Low) || (code < this.Range2High && code > this.Range2Low))
            return true;
        else
            return false;
    }

    // inject the client-side script to page
    protected override void OnPreRender(EventArgs e)
    {
           base.OnPreRender(e);

           if (base.RenderUplevel)
           {
               this.Page.ClientScript.RegisterClientScriptBlock(this.GetType(), "RangeValidatorEx", RangeValidatorExJs(),true);
           }
    }

    string RangeValidatorExJs()
    {
        string js;
        // the validator will be rendered as a SPAN tag on the client-side and it will passed to the validation function.
        js = "function RangeValidatorEx(val){ "
        + " var code=document.getElementById(val.controltovalidate).value; "
        + " if ((code < rangeValidatorCtrl.Range1High && code > rangeValidatorCtrl.Range1Low ) || (code < rangeValidatorCtrl.Range2High && code > rangeValidatorCtrl.Range2Low)) return true; else return false;}";
        return js;
    }

    public int Range1Low
    {
        get {
            object obj2 = this.ViewState["Range1Low"];

            if (obj2 != null)
                return System.Convert.ToInt32(obj2);

            return 0;

        }
        set { this.ViewState["Range1Low"] = value; }
    }

    public int Range1High
    {
        get
        {
            object obj2 = this.ViewState["Range1High"];

            if (obj2 != null)
                return System.Convert.ToInt32(obj2);

            return 0;

        }
        set { this.ViewState["Range1High"] = value; }
    }
    public int Range2Low
    {
        get
        {
            object obj2 = this.ViewState["Range2Low"];

            if (obj2 != null)
                return System.Convert.ToInt32(obj2);

            return 0;

        }
        set { this.ViewState["Range2Low"] = value; }
    }
    public int Range2High
    {
        get
        {
            object obj2 = this.ViewState["Range2High"];

            if (obj2 != null)
                return System.Convert.ToInt32(obj2);

            return 0;

        }
        set { this.ViewState["Range2High"] = value; }
    }
} 
```

# php - 如何检查推进对象是否有 i18n 记录？

> ID：251850
> 
> 赞同：0
> 
> 时间：2008-10-30T21:30:14.523
> 
> 标签：php, internationalization, symfony1, propel

我正在使用 symfony 和推进，我试图在一个对象上调用特定的文化并将该对象的某些字段输出到该特定文化的屏幕上。但是，如果对象的映射数据库记录在该特定文化中没有这些字段，我希望它默认为基本文化（在本例中为 en_US）

我这样做是这样的：

```
$currentLesson = $currentLesson->getCurrentLessonsI18n($lessonCulture); 
```

但是当我输出这样的

```
$currentLesson->getTitle(); 
```

如果没有文化记录，它会输出一个空字符串。我的问题是，如果我指定的对象不可用，有没有办法让对象默认为特定的文化，或者有没有办法查看特定对象是否有文化 i18n 记录？

像这样的东西：

```
if($currentLesson->cultureExists($lessonCulture) $currentLesson = $currentLesson->getCurrentLessonsI18n($lessonCulture); 
```

或者

```
sfConfig::setPropelDefaultCulture("en_US"); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-04T22:47:17.827

您将不得不覆盖 symfony 本身以使其默认为另一种语言。这里有一个很好的工作解决方案[http://www.codemassacre.com/2008/03/10/symfony-default-language-fallback/](http://www.codemassacre.com/2008/03/10/symfony-default-language-fallback/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-09T14:47:35.593

可以测试`i18n`您从中获取的记录，这将告诉您 Propel 是否刚刚制作了它，或者它是否来自数据库。`getTranslation($language)``isNew()``(true)``(false)`

# powershell - 使用 PowerShell 为文件添加扩展名

> ID：251851
> 
> 赞同：17
> 
> 时间：2008-10-30T21:30:23.587
> 
> 标签：powershell

我有一个文件目录，只要它们没有现有的指定扩展名，我想将文件扩展名附加到它们。因此，将 .txt 添加到所有不以 .xyz 结尾的文件名。PowerShell 似乎是一个很好的候选者，但我对此一无所知。我该怎么办？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-30T21:45:40.920

这是Powershell的方式：

```
gci -ex "*.xyz" | ?{!$_.PsIsContainer} | ren -new {$_.name + ".txt"} 
```

或者让它更冗长，更容易理解：

```
Get-ChildItem -exclude "*.xyz" 
    | WHere-Object{!$_.PsIsContainer} 
    | Rename-Item -newname {$_.name + ".txt"} 
```

编辑：DOS方式当然也没有错。:)

EDIT2：Powershell 确实支持隐式（和显式）行继续，正如马特汉密尔顿的帖子所示，它确实使事情更容易阅读。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-30T21:48:32.710

+1 EBGreen，除了（至少在 XP 上）get-childitem 的“-exclude”参数似乎不起作用。帮助文本 (gci -?) 实际上说“此参数在此 cmdlet 中无法正常工作”！

所以你可以像这样手动过滤：

```
gci 
  | ?{ !$_.PSIsContainer -and !$_.Name.EndsWith(".xyz") } 
  | %{ ren -new ($_.Name + ".txt") } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T21:32:28.280

考虑标准 shell 中的 DOS 命令 FOR。

```
C:\Documents and Settings\Kenny>help for
Runs a specified command for each file in a set of files.

FOR %variable IN (set) DO command [command-parameters]

  %variable  Specifies a single letter replaceable parameter.
  (set)      Specifies a set of one or more files.  Wildcards may be used.
  command    Specifies the command to carry out for each file.
  command-parameters
             Specifies parameters or switches for the specified command.

...

In addition, substitution of FOR variable references has been enhanced.
You can now use the following optional syntax:

    %~I         - expands %I removing any surrounding quotes (")
    %~fI        - expands %I to a fully qualified path name
    %~dI        - expands %I to a drive letter only
    %~pI        - expands %I to a path only
    %~nI        - expands %I to a file name only
    %~xI        - expands %I to a file extension only
    %~sI        - expanded path contains short names only
    %~aI        - expands %I to file attributes of file
    %~tI        - expands %I to date/time of file
    %~zI        - expands %I to size of file
    %~$PATH:I   - searches the directories listed in the PATH
                   environment variable and expands %I to the
                   fully qualified name of the first one found.
                   If the environment variable name is not
                   defined or the file is not found by the
                   search, then this modifier expands to the
                   empty string 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-05-16T21:37:38.680

在使用 PowerShell v4 时发现这很有帮助。

```
Get-ChildItem -Path "C:\temp" -Filter "*.config" -File | 
    Rename-Item -NewName { $PSItem.Name + ".disabled" } 
```

# c# - 文本框上的拉绳

> ID：251861
> 
> 赞同：0
> 
> 时间：2008-10-30T21:35:44.373
> 
> 标签：c#, graphics, compact-framework

> **可能重复：**
> [Compact Framework 的水印文本框](https://stackoverflow.com/questions/174796/watermarked-textbox-for-compact-framework)

使用 Visual Studio 2008 SP1、最新的 Compact 框架和 Windows Mobile 5。

我需要使用 DrawString 将字符串放在 TextBox 上。但是，一旦我绘制了字符串，TextBox 控件就会将其写入。（我知道是因为我稍微偏离了控件的边缘，并且我的文本是一半可见（不在控件的位置）和一半消失了（在控件上的位置。）

无论如何我可以让 TextBox 不刷新，以便我可以将文本保留在那里？

注意：我已经研究了 TextBox 的子类化并让它绘制我的文本。但是，TextBox 类的 Paint 事件在 CompactFramework 中是不可捕获的。如果您知道一种无需 Paint 事件即可在 TextBox 上绘画的方法，那么我很想继承 TextBox 类。

--问题结束--

万一你想知道为什么我需要这样做，这就是我正在做的事情：我需要一个文本框，其中必须输入两次数值。我需要一些明确的线索，他们必须再次输入号码。我想在文本框上显示一个稍微变灰的文本，告诉用户重新输入。

我曾尝试使用标签、超链接标签和另一个文本框，但它们掩盖了下面的文本（其默认值必须部分可见）。

如果有人知道重新进入的不同方式提示，那也很棒！

瓦卡诺

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T22:05:10.273

你可以用不同的方式解决这个问题。听起来您想对他们以前的输入进行轮廓化，因此他们必须再次输入。

我不知道 CF 最近取得了哪些进展，但如果有 RichTextBox，那么这种方法将起作用。如果不是，您将不得不从基本控件开始编写自己的实现。

1.  将 RichTextBox 的文本设置为轮廓值，但将所有字符的文本颜色设为灰色。
2.  捕获按键事件，当它们按下正确的键时，将按下的字符的文本颜色从灰色更改为黑色并丢弃该按键，并丢弃所有其他按键。

如果您想允许他们取消预订（例如自由格式文本），此解决方案将不起作用。如果他们输入错误或输入不同的字符，您不会丢弃他们输入的内容，而是不会丢弃按键，而是清除当前和剩余的灰色字符，从而允许他们在没有轮廓的情况下输入。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T23:20:21.197

正如我在封闭的骗局中回答的那样：

你在哪里做 DrawText？在 TextBox 父级上？如果是这样，那么这将是预期的行为。为什么不创建一个自定义 TextBox 控件，该控件第一次绘制（通过覆盖 OnPaint）值，可能是浅灰色，然后第二次将其再次绘制为黑色？

# java - Java -> Apache Commons StringEscapeUtils -> escapeJavaScript

> ID：251865
> 
> 赞同：2
> 
> 时间：2008-10-30T21:38:25.973
> 
> 标签：java, javascript, string, escaping, stringescapeutils

对于一个非常简单的 ajax 名称查找，我将一个 id 从客户端网页发送到服务器（Tomcat 5.5、Java 5），在数据库中查找它并返回一个字符串，该字符串被分配给一个 javascript 变量。客户端（然后显示）。

接收该值的 javascript 代码非常标准：

```
//client code - javascript
xmlHttp.onreadystatechange=function() {
    if (xmlHttp.readyState==4) {
        var result = xmlHttp.responseText;
        alert(result);
        ...
    }
    ...
} 
```

要返回字符串，我最初在服务器中有这个：

```
//server code - java
myString = "...";
out.write(myString.getBytes("UTF-8")); 
```

如果不安全的话，效果很好。后来，我将其替换为：

```
import org.apache.commons.lang.StringEscapeUtils;
...
myString = "...";
out.write(StringEscapeUtils.escapeJavaScript(myString).getBytes("UTF-8")); 
```

但是虽然更安全，但如果结果字符串包含特殊字符（如“ñ”），则无法正确显示。

例如，使用：

```
escapeJavaScript("años").getBytes("UTF-8"); 
```

发送：

```
an\u00F1os 
```

给客户。

问题：是否有一种简单的方法可以在 Javascript 中解析结果字符串，或者是否有可以在 java 中使用的替代转义函数来防止这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T21:45:49.720

以下适用于我尝试过的每个浏览器：

```
javascript:alert("a\u00F1os"); 
```

也许您的字符串被错误地转义了两次。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T21:46:02.933

实际上，既然我读了一遍，我想我实际上*根本*不需要转义我要发回的字符串......也就是说，如果结果值打印在页面中，StringEscapeUtils.escapeJavaScript 会很有用，像：

```
//javascript code with inline struts
var myJavasriptString = "<%=myJavaString%>"; 
```

或者我是否遗漏了一些东西，并且仍然有正当理由在原始情况下进行逃生？（当它作为一系列字节返回给 ajax onreadystatechange 处理程序并分配给 js 变量时）

# c# - 在 C# 4.0 中是否应该使用重载或可选参数声明方法？

> ID：251868
> 
> 赞同：95
> 
> 时间：2008-10-30T21:42:13.643
> 
> 标签：c#, c#-4.0, overloading, optional-parameters

我正在观看[Anders 关于 C# 4.0 和 C# 5.0 预览的谈话](http://channel9.msdn.com/pdc2008/TL16/)，这让我想到了当可选参数在 C# 中可用时，推荐的方式来声明不需要指定所有参数的方法？

例如，类之`FileStream`类的东西有大约 15 个不同的构造函数，它们可以分为逻辑“家族”，例如来自字符串的下面的那些，来自 an`IntPtr`的那些和来自 a 的那些`SafeFileHandle`。

```
FileStream(string,FileMode);
FileStream(string,FileMode,FileAccess);
FileStream(string,FileMode,FileAccess,FileShare);
FileStream(string,FileMode,FileAccess,FileShare,int);
FileStream(string,FileMode,FileAccess,FileShare,int,bool); 
```

在我看来，这种类型的模式可以通过使用三个构造函数来简化，并对可以默认的参数使用可选参数，这将使不同的构造函数家族更加不同[注意：我知道这种变化不会在 BCL 中制造，我是在假设这种情况]。

你怎么看？从 C# 4.0 开始，将密切相关的构造函数和方法组制作成具有可选参数的单个方法会更有意义，还是有充分的理由坚持传统的多重载机制？

* * *

## 回答 #1

> 赞同：126
> 
> 时间：2008-10-30T21:55:12.820

我会考虑以下几点：

*   您是否需要从不支持可选参数的语言中使用您的代码？如果是这样，请考虑包括重载。
*   您的团队中是否有任何成员强烈反对可选参数？（有时，接受一个你不喜欢的决定比争论这个案子更容易。）
*   您是否确信您的默认设置不会在代码构建之间发生变化，或者如果可能，您的调用者会同意吗？

我还没有检查默认值是如何工作的，但我假设默认值将被烘焙到调用代码中，与对`const`字段的引用非常相似。这通常没问题 - 对默认值的更改无论如何都非常重要 - 但这些都是要考虑的事情。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-30T21:47:37.377

当方法重载通常使用不同数量的参数执行相同的操作时，将使用默认值。

当方法重载根据其参数执行不同的功能时，将继续使用重载。

我在我的 VB6 时代使用 optional 并且后来错过了它，它将减少 C# 中的大量 XML 注释重复。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-06-24T16:55:56.270

我一直在使用带有可选参数的 Delphi。我已经改用重载。

因为当你去创建更多的重载时，你总是会与可选的参数形式发生冲突，然后你必须将它们转换为非可选的。

而且我喜欢这样的概念，即通常有一种*超级*方法，其余的是围绕该方法的更简单的包装器。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-06-24T16:53:38.533

我肯定会使用 4.0 的可选参数功能。它摆脱了荒谬...

```
public void M1( string foo, string bar )
{
   // do that thang
}

public void M1( string foo )
{
  M1( foo, "bar default" ); // I have always hated this line of code specifically
} 
```

...并将值放在调用者可以看到它们的地方...

```
public void M1( string foo, string bar = "bar default" )
{
   // do that thang
} 
```

更简单，更不容易出错。我实际上已经将此视为过载情况下的错误...

```
public void M1( string foo )
{
   M2( foo, "bar default" );  // oops!  I meant M1!
} 
```

我还没有玩过 4.0 编译器，但得知编译器只是为您发出重载，我不会感到震惊。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-01-21T01:41:51.757

可选参数本质上是一段元数据，它指导正在处理方法调用的编译器在调用站点插入适当的默认值。相比之下，重载提供了一种方法，编译器可以通过该方法选择多种方法中的一种，其中一些方法本身可能提供默认值。请注意，如果尝试从用不支持可选参数的语言编写的代码中调用指定可选参数的方法，则编译器将要求指定“可选”参数，但是由于在不指定可选参数的情况下调用方法是相当于使用等于默认值的参数调用它，这样的语言调用这样的方法没有障碍。

在调用点绑定可选参数的一个重要结果是，它们将根据编译器可用的目标代码版本分配值。如果程序集`Foo`具有`Boo(int)`默认值为 5 的方法，并且程序集`Bar`包含对 的调用`Foo.Boo()`，则编译器会将其处理为`Foo.Boo(5)`. 如果默认值更改为 6 并`Foo`重新编译程序集，`Bar`则将继续调用`Foo.Boo(5)`，除非或直到使用新版本的`Foo`. 因此，应该避免对可能发生变化的事物使用可选参数。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-05-21T10:16:13.147

是否应该使用可选参数或重载可以争论，但最重要的是，每个都有自己不可替代的领域。

可选参数与命名参数结合使用时，在与 COM 调用的一些长参数列表和所有可选参数结合使用时非常有用。

例如，当方法能够对许多不同的参数类型（只是示例之一）进行操作并在内部进行强制转换时，重载非常有用；您只需使用任何有意义的数据类型（被一些现有的重载接受）提供它。不能用可选参数打败它。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-03-08T08:12:44.893

我最喜欢的可选参数的一个方面是，如果你不提供参数，即使不去方法定义，你也会看到参数会发生什么。**当您键入方法名称时， Visual Studio 将简单地显示**参数的默认值。使用重载方法时，您要么阅读文档（如果可用），要么直接导航到方法的定义（如果可用）和重载包装的方法。

特别是：文档工作可能会随着重载的数量而迅速增加，并且您最终可能会从现有的重载中复制已经存在的注释。这很烦人，因为它不会产生任何价值并违反[DRY 原则](https://en.wikipedia.org/wiki/Don't_repeat_yourself)）。另一方面，使用可选参数，所有参数都记录在*一个地方*，您可以在键入时看到它们的含义以及它们的**默认值。**

最后但同样重要的是，如果您是 API 的使用者，您甚至可能无法检查实现细节（如果您没有源代码），因此没有机会查看重载的超级方法是哪个超级方法正在包装。因此，您坚持阅读文档并希望在那里列出所有默认值，但情况并非总是如此。

当然，这不是一个涵盖所有方面的答案，但我认为它增加了一个迄今为止尚未涵盖的答案。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-30T21:51:09.600

我期待可选参数，因为它使默认值更接近方法。因此，无需为仅调用“扩展”方法的重载提供数十行代码，您只需定义一次方法，您就可以在方法签名中看到可选参数的默认值。我宁愿看：

```
public Rectangle (Point start = Point.Zero, int width, int height)
{
    Start = start;
    Width = width;
    Height = height;
} 
```

而不是这个：

```
public Rectangle (Point start, int width, int height)
{
    Start = start;
    Width = width;
    Height = height;
}

public Rectangle (int width, int height) :
    this (Point.Zero, width, height)
{
} 
```

显然，这个例子非常简单，但是在 OP 中有 5 个重载的情况下，事情会很快变得拥挤。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-06-10T08:58:34.410

在许多情况下，可选参数用于切换执行。例如：

```
decimal GetPrice(string productName, decimal discountPercentage = 0)
{

    decimal basePrice = CalculateBasePrice(productName);

    if (discountPercentage > 0)
        return basePrice * (1 - discountPercentage / 100);
    else
        return basePrice;
} 
```

此处的折扣参数用于提供 if-then-else 语句。存在未被识别的多态性，然后将其实现为 if-then-else 语句。在这种情况下，最好将两个控制流拆分为两个独立的方法：

```
decimal GetPrice(string productName)
{
    decimal basePrice = CalculateBasePrice(productName);
    return basePrice;
}

decimal GetPrice(string productName, decimal discountPercentage)
{

    if (discountPercentage <= 0)
        throw new ArgumentException();

    decimal basePrice = GetPrice(productName);

    decimal discountedPrice = basePrice * (1 - discountPercentage / 100);

    return discountedPrice;

} 
```

通过这种方式，我们甚至保护了班级免于接到零折扣的电话。该调用意味着调用者认为有折扣，但实际上根本没有折扣。这样的误解很容易导致bug。

在这种情况下，我不希望有可选参数，而是强制调用者显式选择适合其当前情况的执行场景。

这种情况与可以为空的参数非常相似。当实现归结为`if (x == null)`.

您可以在这些链接上找到详细的分析：[避免可选参数](http://www.codinghelmet.com/?path=howto/reduce-cyclomatic-complexity-avoiding-optional-parameters)和[避免空参数](http://www.codinghelmet.com/?path=howto/reduce-cyclomatic-complexity-avoiding-null-parameters)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-03-07T23:00:35.147

可选参数的一个警告是版本控制，其中重构会产生意想不到的后果。一个例子：

**初始代码**

```
public string HandleError(string message, bool silent=true, bool isCritical=true)
{
  ...
} 
```

假设这是上述方法的众多调用者之一：

```
HandleError("Disk is full", false); 
```

在这里，事件不是静默的，而是被视为关键的。

现在假设在重构之后我们发现所有错误都会提示用户，所以我们不再需要静默标志。所以我们删除它。

**重构后**

前一个调用仍然可以编译，假设它通过重构没有改变：

```
public string HandleError(string message, /*bool silent=true,*/ bool isCritical=true)
{
  ...
}

...

// Some other distant code file:
HandleError("Disk is full", false); 
```

现在`false`将产生意想不到的效果，该事件将不再被视为关键。

这可能会导致一个细微的缺陷，因为不会出现编译或运行时错误（不像其他一些可选的警告，例如[this](https://haacked.com/archive/2010/08/10/versioning-issues-with-optional-arguments.aspx/)或[this](https://lostechies.com/jimmybogard/2010/05/18/caveats-of-c-4-0-optional-parameters/)）。

请注意，同样的问题有多种形式。[此处](https://haacked.com/archive/2010/08/12/more-optional-versioning-fun.aspx/)概述了另一种形式。

另请注意，在调用方法时严格使用命名参数将避免该问题，例如：`HandleError("Disk is full", silent:false)`. 但是，假设所有其他开发人员（或公共 API 的用户）都会这样做可能是不切实际的。

由于这些原因，除非有其他令人信服的考虑因素，否则我会避免在公共 API 中使用可选参数（或者甚至是公共方法，如果它可能被广泛使用）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-09-14T19:58:34.620

虽然它们（假设是？）两种概念上等效的方式可供您从头开始对 API 进行建模，但不幸的是，当您需要考虑旧客户端的运行时向后兼容性时，它们存在一些细微的差异。我的同事（感谢 Brent！）向我指出了这篇[精彩的帖子：可选参数的版本控制问题](http://haacked.com/archive/2010/08/10/versioning-issues-with-optional-arguments.aspx/)。引用其中的一些话：

> 将可选参数引入 C# 4 的原因首先是为了支持 COM 互操作。就是这样。现在，我们正在了解这一事实的全部含义。如果您有一个带有可选参数的方法，则永远不能添加带有其他可选参数的重载，以免导致编译时中断更改。而且您永远无法删除现有的重载，因为这一直是运行时的重大更改。你几乎需要把它当作一个界面来对待。在这种情况下，您唯一的办法是编写一个具有新名称的新方法。因此，如果您打算在 API 中使用可选参数，请注意这一点。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-12-08T13:52:11.067

要在使用重载而不是可选项时添加一个不费脑筋的问题：

每当您有许多只能一起有意义的参数时，不要在它们上引入可选参数。

或者更一般地说，每当您的方法签名启用没有意义的使用模式时，请限制可能调用的排列数量。例如，通过使用重载而不是可选项（顺便说一句，当您有多个相同数据类型的参数时，此规则也适用；在这里，工厂方法或自定义数据类型等设备会有所帮助）。

例子：

```
enum Match {
    Regex,
    Wildcard,
    ContainsString,
}

// Don't: This way, Enumerate() can be called in a way
//         which does not make sense:
IEnumerable<string> Enumerate(string searchPattern = null,
                              Match match = Match.Regex,
                              SearchOption searchOption = SearchOption.TopDirectoryOnly);

// Better: Provide only overloads which cannot be mis-used:
IEnumerable<string> Enumerate(SearchOption searchOption = SearchOption.TopDirectoryOnly);
IEnumerable<string> Enumerate(string searchPattern, Match match,
                              SearchOption searchOption = SearchOption.TopDirectoryOnly); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-12-31T07:27:37.957

可选参数，方法重载都有自己的优点或缺点。这取决于您在它们之间进行选择的偏好。

可选参数：仅在 .Net 4.0 中可用。可选参数减少您的代码大小。你不能定义 out 和 ref 参数

重载方法：您可以定义 Out 和 ref 参数。代码大小会增加，但重载的方法很容易理解。

# c++ - 结构不属于面向对象的程序

> ID：251885
> 
> 赞同：5
> 
> 时间：2008-10-30T21:48:31.710
> 
> 标签：c++, oop

或者是吗？

如果有一个同样有用的结构可以正确隐藏数据成员，那么面向对象的设计是否应该使用默认公开成员数据的语言结构？

编辑：其中一位响应者提到，如果没有不变量，则可以使用结构。这是一个有趣的观察：结构是一种数据结构，即它包含相关数据。如果结构中的数据成员是相关的，是不是总是有一个不变量？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-30T22:00:18.287

在 C++ 中，**struct** s 和**class** es 是相同的，除了其成员的默认公共/私有性。（这个默认值很容易并且通常被覆盖。）

但是，大多数程序员将结构视为“数据对象”，将类视为“交互对象”。这不是一件坏事。并且实际上应该被利用。如果某些东西只是一个无生命的数据块（即使它有几个检查器方法），请为它使用一个结构；当程序员试图查看它的用途时，它会节省一些精力。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-30T23:58:36.893

不要成为一个隐藏的狂热者。如果您的 get/set 方法只是简单地将值逐字复制到隐藏的私有字段上/从隐藏的私有字段中复制，那么您对公共成员一无所获，只会使您的类不必要地复杂化（并且，根据编译器的智能，速度很慢它的用法有点）。

*当您的 setter 方法进行一些验证时，不允许直接访问，将数据复制到其他地方，在存储之前对其进行一些处理等等。对于实际计算*它们从多个内部源返回的值的 getter 的情况也是如此，并隐藏它的派生方式（我相信 Bertrand Meyer 在他的书中谈到了一点）

或者，如果允许您的类的用户直接更改此类值会产生意想不到的副作用或打破您的某些成员类对这些值的假设。在这些情况下，一定要隐藏你的价值观。

例如，对于一个简单的“Point”类，它只包含几个坐标和颜色，以及在屏幕上“绘制”和“隐藏”它的方法，我认为不允许用户直接设置值是没有意义的为其领域。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-30T21:55:38.187

例如，在 C# 中，我将结构用于一些简单的更好的左值数据类型：

```
public struct Point
{
    int X;
    int Y;
} 
```

对于参数为结构的库的任何 P/Invoke，您必须确定使用它们。

它们是否属于应用程序的一般设计？他们当然会这样做，在有意义的情况下使用结构。就像您在有意义的时候使用带有位标志的枚举一样，而不是使用一些复杂的字符串解析来存储组合值。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-31T00:24:43.487

在 C++ 中，结构和类之间的区别在于其内容的默认可见性（即，对于结构来说是公共的，对于类来说是私有的）。我想这种区别是为了保持 C 兼容性。

但在语义上，我想这需要解释。

## 结构示例

在结构中，一切都是公共的（默认情况下），这意味着用户可以根据需要修改每个数据值，并且结构仍然是有效的对象。结构示例：

```
struct CPoint
{
   int x ;
   int y ;

   CPoint() : x(0), y(0) {}

   int getDistanceFromOrigin() const
   {
      return std::sqrt(x * x + y * y) ;
   }
} ;

inline CPoint operator + (const CPoint & lhs, const CPoint & rhs)
{
   CPoint r(lhs) ;
   r.x += rhs.x ;
   r.y += rhs.y ;
   return r ;
} 
```

您可以更改 CPoint 的 x 值，它仍然是有效的 CPoint。

请注意，与某些人认为的不同，C++ 结构可以（并且应该）在其接口上附加构造函数、方法和非成员函数，如上所示。

## 类的一个例子

在一个类中，一切都是私有的（默认情况下），这意味着用户只能通过定义良好的接口修改数据，因为类必须保持其内部有效。类的例子：

```
class CString
{
   public :
      CString(const char * p) { /* etc. */ } ;
      CString(const CString & p) { /* etc. */ } ;

      const char *     getString() const { return this->m_pString ; }
      size_t           getSize() const { return this->m_iSize ; }

      void             copy { /* code for string copy */ }
      void             concat { /* code for string concatenation */ }

   private :
      size_t           m_iSize ;
      char *           m_pString ;
} ;

inline CString operator + (const CString & lhs, const CString & rhs)
{
   CString r(lhs) ;
   r.concat(rhs) ;
   return r ;
} 
```

您会看到，当您调用 concat 时，指针可能需要重新分配（以增加其大小），并且必须自动更新字符串的大小。您不能让用户手动修改字符串，而忘记更新大小。

因此，该类必须保护其内部，并确保在需要时所有内容都会正确更新。

## 结论

对我来说，结构和类之间的区别在于聚合数据之间的依赖关系。

如果每条数据都独立于所有其他数据，那么也许您应该考虑一个结构（即，具有公共数据成员的类）。

如果没有，或者有疑问，请使用课程。

现在，当然，在 C# 中，结构和类是两种不同类型的对象（即结构的值类型和类的引用类型）。但这超出了这个话题，我猜。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-10T05:29:01.900

事情很简单。如果`class`确实有要保证的不变量，则永远不要将约束不变量的成员公开。

如果你`struct`只是不同*对象*的集合，并且没有不变量来保存，那么你确实可以自由并鼓励放置它的成员`public`。这就是`std::pair<T, U>`C++ 中的方式。

## 那不变的东西是什么？

简单示例：假设您有一个`Point`类，其`x and y`成员必须始终为`>= 0`. 你可以做一个不变的陈述

```
/* x >= 0 && y >= 0 对于这个类的对象。*/
```

如果您现在将这些成员公开，客户可以简单地更改 x 和 y，并且您的不变量很容易被破坏。但是，如果允许成员分别包含适合它们自己的不变量的所有可能值，那么您当然可以将这些成员公开：无论如何您都不会为它们添加任何保护。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-30T22:05:06.810

从技术上讲，结构是具有默认可见性公共的类（真正的类具有默认的私有可见性）。

普通用途有更多区别。

结构通常只是数据的集合，由其他代码检查和处理。

一个类通常更像是一个东西，保持对其数据的某种控制，并具有由相关函数指定的行为。

通常，类更有用，但时常会使用诸如 C 结构之类的东西，并且有一个符号差异来显示它是有用的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T22:10:18.937

结构本质上是一个模型类，但具有不同的语法。

```
public struct Point {
    int x;
    int y;
} 
```

逻辑上等同于：

```
public class Point {
    private int x;
    private int y;
    public void setX(int x) { this.x=x; }
    public int getX(); { return x; }
    public void setY(int y) { this.y=y; }
    public int getY(); { return y; }
} 
```

两者都是一个可变模型，其中包含一对称为 x 和 y 的整数值。所以我会说它是一个有效的面向对象的构造。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-30T23:25:23.560

我经常使用结构——主要用于从网络或硬件接收的数据。它们通常包装在一个类中，供程序的更高级别部分使用。

我的经验法则是结构总是纯数据，除了构造函数。其他任何东西都是一个类。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-04T21:58:27.190

请参阅这些类似的问题：

[什么时候应该在 C++ 中使用类和结构？](https://stackoverflow.com/questions/54585/when-should-you-use-a-class-vs-a-struct-in-c)

[C++中的struct和class有什么区别](https://stackoverflow.com/questions/92859/what-are-the-differences-between-struct-and-class-in-c)

加：

根据[C++ 编程语言](https://rads.stackoverflow.com/amzn/click/com/0201700735)中的 Stroustrup ：

> 您使用哪种风格取决于环境和品味。我通常更喜欢`struct`用于所有数据都公开的类。我认为这样的类“不是很合适的类型，只是数据结构”。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-10T05:07:01.273

使用结构本身并没有错，但如果你发现自己需要它们，你应该问问你的分析有什么问题。例如，考虑上面的 Point 类：它在可读性方面略有改进，因为您总是可以使用

```
Point foo;
//...
foo.x = bar; 
```

代替，比如说，有一个两个元素的数组，如

```
#define X 0
#define Y 1
//...
foo[X] = bar; 
```

但是类旨在隐藏合同背后的细节。如果您的点在某个归一化空间中，则值可能在半开区间 [0.0..1.0) 范围内；如果是屏幕，它们的范围可能在 [0..1023] 内。如果您使用结构代替访问器，您将如何防止某人分配`foo.x = 1023`何时`x`应该无处不在`< 1.0`？

C++ 程序员将结构用于 Points 的唯一原因是，早在 20 年前，当 C++ 还是新事物时，内联处理得并不好，因此`foo.setX(1023)`实际上比`foo.x = 1023`. 这不再是真的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-31T01:14:59.890

大多数答案似乎都支持结构作为可以接受和有用的东西，只要它没有行为（即方法）。这似乎很公平。

但是，您永远无法确定您的对象不会演变成可能需要行为的东西，因此无法对其数据成员进行一些控制。如果您足够幸运，您可以控制结构的所有用户，则可以检查所有数据成员的所有用途。但是，如果您无法访问所有用户怎么办？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-31T01:46:13.743

在 C 或 C++ 中使用的结构和在 C#（或任何 .Net 语言）中使用的结构是如此不同的动物，它们甚至可能不应该有相同的名称......几乎任何关于一种语言中结构的概括在另一个方面很容易是错误的，或者由于完全不相关的原因而为真。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-31T01:59:04.483

如果需要[invariant](http://www.artima.com/intv/goldilocks3.html)，请将其设为类。否则，结构是可以的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-30T21:50:07.153

是的。这就像一个迷你班。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-30T21:53:37.317

形式上，在 C++ 中，结构是一个类，其成员的可见性默认设置为公共。传统上，结构用于对同质数据的集合进行分组，这些数据没有特定原因被特定方法访问。其成员的公开可见性使得结构更倾向于类来实现*策略类*和*元功能*。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-30T21:57:26.857

是的，他们有。它们具有与类不同的语义。结构通常被视为值类型，而类通常被视为引用类型。日常编程中的差异并没有那么明显。然而，当涉及到编组、COM 互操作和传递实例等事情时，这是一个重要的区别。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-10-30T21:53:06.897

只要保持较小的结构就可以了。您可能知道，它们分配在堆栈（而不是堆）上，因此您需要注意大小。对于点、大小等小型数据结构，它们可以派上用场。不过，类通常是更好的选择，因为它是引用类型等等。

# sharepoint - SPCrossListQuery 无法带回结果

> ID：251888
> 
> 赞同：0
> 
> 时间：2008-10-30T21:48:49.010
> 
> 标签：sharepoint, caml, spweb

我在打电话`SPWeb.GetSiteData(anSpCrossListQuery)`。

`<Where></Where>`当我在 CAML 查询子句末尾使用意外空格调用它时，它无法返回任何结果或任何错误。

有人知道为什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T22:24:37.737

因为 SharePoint 打算让开发变得痛苦 ;)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T18:07:29.973

SharePoint 对 CAML 查询非常挑剔，并且会给出非常无用且有时难以理解的错误。显然在这种情况下，一个简单的 String.Trim() 将解决问题。

非常仔细地检查您的查询并确保其格式正确已经解决了我遇到的所有问题。

# c# - 在 VS 2008 中显示单元测试结果

> ID：251890
> 
> 赞同：0
> 
> 时间：2008-10-30T21:49:52.287
> 
> 标签：c#, visual-studio-2008, unit-testing

我是一个菜鸟，正在使用 Visual Studio 2008 内置的单元测试组件，在单元测试中记录或显示结果的最佳方式是什么？

我想在返回 System.GUID 和空 System.GUID 时测试我的服务方法

```
[TestMethod]
public void GetGUID()
{
   MyWcfServiceService.MyWcfServiceClient proxy = new MyWcfServiceService.MyWcfServiceClient();
   string name = "HasGuid";

   System.GUID guid = proxy.GetGUID(name);
}

[TestMethod]
public void GetEmptyGUID()
{
    MyWcfServiceService.MyWcfServiceClient proxy = new MyWcfServiceService.MyWcfServiceClient();
   string name = "HasEmptyGuid";

   System.GUID guid = proxy.GetGUID(name);
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T22:29:35.373

对于 GetGUID()...

```
Assert.IsFalse(guid == Guid.Empty); 
```

同样对于 GetEmptyGUID()...

```
Assert.IsTrue(guid == Guid.Empty); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T21:51:27.850

去年我用了几个月，IIRC没有`Assert`课吗？ `Assert.IsTrue(...)`?

我已经放弃了 VS 测试的东西，转而使用其他单元测试框架（更好的 IMO），所以我的记忆可能很模糊。

# c# - glDrawPixels 导致 AccessViolationException

> ID：251892
> 
> 赞同：1
> 
> 时间：2008-10-30T21:50:32.487
> 
> 标签：c#, opengl, tao-framework

我正在使用 glDrawPixels 来显示图像。我知道，我可能应该使用纹理，但我没有这样做是有原因的。至少现在不是。无论如何，正在显示的图像经常被更新，就好像它正在被扫描一样。只要我让它坐下来完成“扫描”，它就可以正常工作，但是，如果我在“扫描仍在进行中”时单击屏幕我的 glDrawPixels 出现 AccessViolation 异常。

```
Gl.glDrawPixels(mImageWidth, mImageHeight, Gl.GL_LUMINANCE, Gl.GL_UNSIGNED_SHORT, mDisplayBuffer); 
```

mImageWidth 和 mImageHeight 是预期值，因此它们不是这个问题。

在 glDrawPixels 调用之前，我放置了一个 for 循环来查看 mDisplayBuffer 中的每个元素。这里没有发生任何问题，因此访问冲突似乎不是来自 mDisplayBuffer。

所以它一定是 glDrawPixels 中的东西吧？

我正在使用 TAO 框架，以便可以使用 C# 和 OpenGl。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T14:00:26.863

mDisplayBuffer 的类型是什么？它是否在 glDrawPixels 正在进行时被另一个线程更新，或者被垃圾收集器重新定位（尝试在 DrawPixels 调用周围使用范围锁）？

# oracle - 有没有办法对所有 oracle 包和程序进行全文搜索？

> ID：251902
> 
> 赞同：43
> 
> 时间：2008-10-30T21:53:48.690
> 
> 标签：oracle, data-dictionary

我想在我的所有程序包和函数中搜索某个短语。

由于可以使用 toad 检索已编译过程的代码，因此我假设全文存储在某个数据字典表中。有谁知道那会在哪里？

非常感谢

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-10-30T21:58:02.567

你可以做类似的事情

```
SELECT name, line, text
  FROM dba_source
 WHERE upper(text) like upper('%<<your_phrase>>%') escape '\' 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-31T15:09:47.190

Toad 的“对象搜索”例程将查看 ALL_SOURCE（和数据字典的其他部分）。当然，这将仅限于允许连接用户查看的对象。如果您可以访问 DBA 版本，那就太好了。如果没有，您将不会搜索所有内容。

此外，如果您回到 Oracle 7，或者您的数据库从 Oracle 7 迁移到 8i 或 9i（不确定 10 或 11），则触发器源可能不会出现在 user_source 或 all_source 视图中。最好检查一下。我发现让它出现的最简单方法是进行实际修改——例如，添加一个空格——然后重新编译触发器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T21:56:32.710

你的意思是使用PL/SQL？还是只使用 TOAD？我知道您可以使用“查找对象”（或类似的东西）功能手动搜索所有对象，如 procs、表等...

# datetime - 如何使用 Emacs 将当前日期和时间插入文件？

> ID：251908
> 
> 赞同：88
> 
> 时间：2008-10-30T21:56:34.613
> 
> 标签：datetime, emacs, timestamp, text-editor

我可以使用 Emacs 中的哪些命令将当前日期和时间插入文件的文本缓冲区？

*（例如，记事本中的等效功能只是按 F5，这是记事本唯一有用的功能！）*

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2008-11-09T11:44:03.250

```
C-u M-! date 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-10-30T22:01:24.710

放入您的 .emacs 文件：

```
;; ====================
;; insert date and time

(defvar current-date-time-format "%a %b %d %H:%M:%S %Z %Y"
  "Format of date to insert with `insert-current-date-time' func
See help of `format-time-string' for possible replacements")

(defvar current-time-format "%a %H:%M:%S"
  "Format of date to insert with `insert-current-time' func.
Note the weekly scope of the command's precision.")

(defun insert-current-date-time ()
  "insert the current date and time into current buffer.
Uses `current-date-time-format' for the formatting the date/time."
       (interactive)
       (insert "==========\n")
;       (insert (let () (comment-start)))
       (insert (format-time-string current-date-time-format (current-time)))
       (insert "\n")
       )

(defun insert-current-time ()
  "insert the current time (1-week scope) into the current buffer."
       (interactive)
       (insert (format-time-string current-time-format (current-time)))
       (insert "\n")
       )

(global-set-key "\C-c\C-d" 'insert-current-date-time)
(global-set-key "\C-c\C-t" 'insert-current-time) 
```

[参考](http://301south.net/works/plaza.emacs)

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-03-06T16:41:40.330

我使用了这些简短的片段：

```
(defun now ()
  "Insert string for the current time formatted like '2:34 PM'."
  (interactive)                 ; permit invocation in minibuffer
  (insert (format-time-string "%D %-I:%M %p")))

(defun today ()
  "Insert string for today's date nicely formatted in American style,
e.g. Sunday, September 17, 2000."
  (interactive)                 ; permit invocation in minibuffer
  (insert (format-time-string "%A, %B %e, %Y"))) 
```

他们最初来自[journal.el](http://www.emacswiki.org/cgi-bin/wiki/Journal)

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2013-06-13T03:23:21.603

对于插入日期：

```
M-x org-time-stamp 
```

对于插入日期时间：

```
C-u M-x org-time-stamp 
```

您可以为此命令绑定全局键。

`org-mode`的方法非常人性化，您可以从日历中选择任何日期。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-10-30T23:07:25.373

您可以安装[yasnippet](http://code.google.com/p/yasnippet/)，它可以让您输入“时间”和 tab 键，并且还可以做更多的事情。`current-time-string`它只是在幕后调用，因此您可以使用`format-time-string`.

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-30T22:06:52.470

这是我不久前写的一个包，它可以满足您的要求。

[http://github.com/rmm5t/insert-time.el/tree/master/insert-time.el](http://github.com/rmm5t/insert-time.el/tree/master/insert-time.el)

```
(require 'insert-time)
(define-key global-map [(control c)(d)] 'insert-date-time)
(define-key global-map [(control c)(control v)(d)] 'insert-personal-time-stamp) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-03-02T08:59:04.833

M-1 M-！日期

这会导致您运行的 shell 命令被插入到您当前正在编辑的缓冲区中，而不是新的缓冲区中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-04-24T22:48:26.093

最简单的方法可能是：

（插入（当前时间字符串））

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-08-18T05:54:06.430

谢谢，CMS！我的变化，不管它的价值——让我很高兴：

```
(defvar bjk-timestamp-format "%Y-%m-%d %H:%M"
  "Format of date to insert with `bjk-timestamp' function
%Y-%m-%d %H:%M will produce something of the form YYYY-MM-DD HH:MM
Do C-h f on `format-time-string' for more info")

(defun bjk-timestamp ()
  "Insert a timestamp at the current point.
Note no attempt to go to beginning of line and no added carriage return.
Uses `bjk-timestamp-format' for formatting the date/time."
       (interactive)
       (insert (format-time-string bjk-timestamp-format (current-time)))
       ) 
```

我把它放在一个由我的 .emacs 调用的文件中，使用：

```
(load "c:/bjk/elisp/bjk-timestamp.el") 
```

这两者都使修改变得更容易，而不会冒险破坏我的 .emacs 中的其他内容，并且让我可以轻松地进入也许有一天真正了解这个 Emacs Lisp 编程的全部内容。

PS 对我的 n00b 技术的评论非常受欢迎。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-03-31T17:35:16.750

这是我的看法。

```
(defun modi/insert-time-stamp (option)
  "Insert date, time, user name - DWIM.

If the point is NOT in a comment/string, the time stamp is inserted prefixed
with `comment-start' characters.

If the point is IN a comment/string, the time stamp is inserted without the
`comment-start' characters. If the time stamp is not being inserted immediately
after the `comment-start' characters (followed by optional space),
the time stamp is inserted with “--” prefix.

If the buffer is in a major mode where `comment-start' var is nil, no prefix is
added regardless.

Additional control:

        C-u -> Only `comment-start'/`--' prefixes are NOT inserted
    C-u C-u -> Only user name is NOT inserted
C-u C-u C-u -> Both prefix and user name are not inserted."
  (interactive "P")
  (let ((current-date-time-format "%a %b %d %H:%M:%S %Z %Y"))
    ;; Insert a space if there is no space to the left of the current point
    ;; and it's not at the beginning of a line
    (when (and (not (looking-back "^ *"))
               (not (looking-back " ")))
      (insert " "))
    ;; Insert prefix only if `comment-start' is defined for the major mode
    (when (stringp comment-start)
      (if (or (nth 3 (syntax-ppss)) ; string
              (nth 4 (syntax-ppss))) ; comment
          ;; If the point is already in a comment/string
          (progn
            ;; If the point is not immediately after `comment-start' chars
            ;; (followed by optional space)
            (when (and (not (or (equal option '(4)) ; C-u or C-u C-u C-u
                                (equal option '(64))))
                       (not (looking-back (concat comment-start " *")))
                       (not (looking-back "^ *")))
              (insert "--")))
        ;; If the point is NOT in a comment
        (progn
          (when (not (or (equal option '(4)) ; C-u or C-u C-u C-u
                         (equal option '(64))))
            (insert comment-start)))))
    ;; Insert a space if there is no space to the left of the current point
    ;; and it's not at the beginning of a line
    (when (and (not (looking-back "^ *"))
               (not (looking-back " ")))
      (insert " "))
    (insert (format-time-string current-date-time-format (current-time)))
    (when (not (equal option '(16))) ; C-u C-u
      (insert (concat " - " (getenv "USER"))))
    ;; Insert a space after the time stamp if not at the end of the line
    (when (not (looking-at " *$"))
      (insert " ")))) 
```

我更喜欢将此绑定到`C-c d`.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-06-29T21:20:57.500

要插入日期：

```
C-c . RET 
```

选择日期左/右/上/下 - RET（回车）

# visual-studio - DSOFramer 在另一个窗口中关闭 Excel 文档。如果文件中未保存数据，则 dsoframer 无法打开并显示“尝试访问无效地址”

> ID：251909
> 
> 赞同：4
> 
> 时间：2008-10-30T21:56:34.660
> 
> 标签：visual-studio, visual-c++, activex, dsoframer

我正在使用`Microsoft's DSOFramer`控件允许我在对话框中嵌入 Excel 文件，以便用户可以选择他的工作表，然后选择他的单元格范围；它与我对话框上的导入按钮一起使用。

问题是当我调用该`DSOFramer's OPEN`函数时，如果我在另一个窗口中打开 Excel，它会关闭 Excel 文档（但让 Excel 继续运行）。如果它试图关闭的文档有未保存的数据，我会在另一个窗口中看到一个关闭 Excel 文档的对话框。如果文件中未保存数据，`dsoframer`则无法打开并显示消息框：`Attempt to access invalid address`.

我构建了源代码，并逐步完成，并在其`CDsoDocObject::CreateFromFile`函数中进行了调用，调用`BindToObject`了 IMoniker 类的对象。`HR`是`0x8001010a` `The message filter indicated that the application is busy`。_ 失败时，它会尝试`InstantiateDocObjectServer`通过Microsoft Excel 工作表...失败并显示. 只需调用,首先使用，然后（如果失败）使用.`classid``CLSID``HRESULT``0x80040154` `Class not registered``InstantiateDocObjectServer``CoCreateInstance``classid``CLSCTX_LOCAL_SERVER``CLSCTX_INPROC_SERVER`

我知道`DSOFramer`是一个流行的示例项目，用于将 Office 应用程序嵌入到各种对话框和表单中。我希望其他人遇到过这个问题，并且可能对我如何解决这个问题有一些见解。我真的不希望它关闭任何其他打开的 Excel 文档，如果由于未保存的数据而无法关闭文档，我真的不希望它出错。

更新 1：我尝试更改`classid`传入的内容`Excel.Application`（我知道该类会解析），但这没有用。在`CDsoDocObject`中，它尝试打开 key `HKEY_CLASSES_ROOT\CLSID\{00024500-0000-0000-C000-000000000046}\DocObject`，但失败了。我已经在视觉上确认该密钥不存在于我的注册表中；该指南存在密钥，但没有`DocObject`子密钥。然后它会产生一个错误消息框：`The associated COM server does not support ActiveX document embedding`。当我尝试使用`Excel.Workbook programid`.

**更新 2：我尝试启动 Excel 的第二个实例，希望我的自动化将绑定到它（是最近调用的）而不是问题 Excel 实例，但它似乎没有这样做。结果是一样的。我的问题似乎归结为：我正在调用`BindToObject`class 的对象`IMoniker`，并接收`0x8001010A (RPC_E_SERVERCALL_RETRYLATER)` `The message filter indicated that the application is busy`. 我尝试过使用传递给`BindToObject`（通过`SetBindOptions`）的标志，但似乎没有任何区别。**

**更新 3：它首先尝试使用 IMoniker 类进行绑定。如果失败，它会调用as`CoCreateInstance`方法。这可能适用于其他 MS Office 对象，但当它是 Excel 时，该类适用于工作表。我将示例修改为，然后获取工作簿，然后为目标文件调用 ，该文件返回一个 Worksheet 对象。然后我返回该指针并与原始示例代码路径合并。现在都在工作。`clsid``fallback``CoCreateInstance _Application``Workbooks::Open`**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-14T21:22:28.283

假设您使用的是 DSOFRAMER 项目，您需要将此代码添加到 CreateFromFile 函数中的 dsofdocobj.cpp 中，大约在第 348 行：

```
CLSID clsidExcelWS;
hr = CLSIDFromProgID(OLESTR("Excel.Sheet"),clsidExcelWS);                   
if (FAILED(hr)) return hr;

if (clsid == clsidExcelWS)
{
    hr = InstantiateAndLoadExcel(pwszFile, &pole);
    if (FAILED(hr)) return hr;
}
else
{
    <the IMoniker::BindToObject call and it's failure handling from the "stock" sample goes here>
} 
```

然后，在 CDsoDocObject 中定义以下新成员函数：

```
////////////////////////////////////////////////////////////////////////
// CDsoDocObject::InstantiateAndLoadExcel (protected)
//
//  Create an instance of Excel and load the target file into its worksheet
//
STDMETHODIMP CDsoDocObject::InstantiateAndLoadExcel(LPWSTR pwszFile, IOleObject **ppole)
{
    IUnknown *punkApp=NULL;
    Excel::_Application *app=NULL;
    Excel::Workbooks *wbList=NULL;
    Excel::_Workbook *wb;

    CLSID   clsidExcel;
    HRESULT hr = CLSIDFromProgID(OLESTR("Excel.Application"), &clsidExcel);
    if (FAILED(hr)) 
        return hr;

    hr = CoCreateInstance(clsidExcel, NULL, CLSCTX_LOCAL_SERVER,  IID_IUnknown, (void**)&punkApp);
    if (SUCCEEDED(hr)) 
    {
        hr = punkApp->QueryInterface(__uuidof(Excel::_Application),(LPVOID *)&app);
        if (SUCCEEDED(hr))
        {
            hr = app->get_Workbooks(&wbList);

            VARIANT vNoParam;
            VariantInit(&vNoParam);
            V_VT(&vNoParam) = VT_ERROR;
            V_ERROR(&vNoParam) = DISP_E_PARAMNOTFOUND;

            VARIANT vReadOnly;
            VariantInit(&vReadOnly);
            V_VT(&vReadOnly) = VT_BOOL;
            V_BOOL(&vReadOnly) = VARIANT_TRUE;

            BSTR bstrFilename = SysAllocString(pwszFile);

            hr = wbList->Open(bstrFilename, vNoParam,vNoParam,vNoParam,vNoParam,vReadOnly,vNoParam,vNoParam,vNoParam,vNoParam,vNoParam,vNoParam,vNoParam,0,&wb);
            if (SUCCEEDED(hr))
                hr = wb->QueryInterface(IID_IOleObject, (void**)ppole);

            VariantClear(&vReadOnly);
            VariantClear(&vNoParam);
            SysFreeString(bstrFilename);
        }
    }

    if (wb != NULL) wb->Release();
    if (wbList != NULL) wbList->Release();
    if (app != NULL) app->Release();
    if (punkApp != NULL) punkApp->Release();

    return hr;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-18T17:43:05.200

@Jinjin：您是否将导入语句（#import“XL5EN32.olb”）放在使用 Excel::_Application 的 cpp 文件中？如果没有，那就这样做……不能只是将其添加到项目中。如果您已经这样做了，请尝试*将此*语句添加到使用这些映射的 cpp 文件中#import "Debug\XL5EN32.tlh"。tlh 文件是通过运行#import 生成的头文件；您应该在 Debug 目录中找到它（假设您正在执行 Debug 构建）。

将 _Application 重命名为 Application（和其他）不是正确的方法。_Application 结构是具有映射的结构。这就是您没有找到 app->get_Workbooks 的原因。

您正在查找哪个文件，您正在查找 Application 但不是 _Application？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-17T17:28:07.477

@金进

1.  您可以使用#import 指令来导入 Excel 的 OLB 文件。这应该生成（并自动包含一个 Excel .tlh 文件，其中包含 _Application 的结构（以及您需要的其余部分））。理想情况下，您应该找到与您希望支持的最早 Excel 版本相匹配的 OLB 文件。您本地系统上的那个可能在 c:\Program Files\Microsoft Office\Office12 中（假设您安装了 Office 2007）。它可能被命名为 Excel.olb 或 XL5EN32.OLB（不同，显然如果您没有安装 Excel 的美国英语版本。
    因此，将 .olb 文件复制到您的项目源目录，然后在源文件的顶部，为#import "XL5EN32.olb" 添加一行。

2.  是的，打开旧版本。保证这种情况的最佳方法是从您希望支持的最早版本的 Excel 安装中找到一个 OLB 文件（在上面的第 1 项中提到）。我使用 Office 2000 中的 Excel9.olb。从 Office 2007 到最新版本的 Excel 版本都可以正常工作。

3.  是的，您应该在进行这些更改后正常使用 dsoframer。

4.  恐怕由于雇主的限制，我可能无法做到这一点。但是，如果您采用“库存” dsoframer 项目，进行本文第 1 部分中描述的更改，以及我在之前的文章中描述的更改，那么您几乎完全重新创建了我所拥有的。

# c# - string.split 返回一个 string[] 我想要一个 List 是否有一种方法可以将数组转换为列表？

> ID：251924
> 
> 赞同：38
> 
> 时间：2008-10-30T22:02:22.323
> 
> 标签：c#, arrays, generics, list

C# 中的列表具有该`.ToArray()`方法。我想要相反的情况，将数组转换为列表。我知道如何创建一个列表并循环遍历它，但我想要一个班轮将其换回。

我`String.Split`在 .NET 2.0 环境中使用该方法，所以我无法使用 LINQ 等。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-10-30T22:03:43.863

```
string s = ...
new List<string>(s.Split(....)); 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-30T22:24:19.440

在 .Net 3.5 中，`System.Linq`命名空间包含一个名为`ToList<>()`.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-30T22:03:39.247

```
return new List<string>(stringArray); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-31T07:24:28.990

如果您只需要一个实现 IList 接口的对象并且您不需要添加新项目，您也可以这样做：

```
IList<string> list = myString.Split(' '); 
```

# .net - 在编写 .NET 代码时，关于避免内存泄漏的“注意”清单是什么？

> ID：251937
> 
> 赞同：10
> 
> 时间：2008-10-30T22:08:05.557
> 
> 标签：.net, memory-leaks

当您编写数千行 .NET 代码时，您要注意什么以避免内存泄漏？我是预防检查的忠实拥护者，关于这一点有一个著名的例子是使用“StringBuilder”来组合字符串而不是“String1+String2”，那么您的编码经验还有什么？

提前感谢您分享您的想法。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-30T22:15:03.497

事件。始终取消订阅事件，这是 .NET 最容易泄露的一个特性。

订阅事件的意思是“在你还活着的时候通知并持有我”，而不是“在我还活着的时候通知我”。未能取消订阅事件通常会导致大量悬挂对象，尤其是在 UI 中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-30T22:12:17.683

使用后将根引用设置为 null。

更多信息[在这里](http://msdn.microsoft.com/en-us/magazine/cc163491.aspx)：如果我们忘记清空根引用，则 GC 将无法尽快有效地释放内存，从而导致应用程序占用更大的内存。问题可能很微妙，例如在进行远程调用（如数据库查询或对 Web 服务的调用）之前创建临时对象的大图的方法。如果在远程调用期间发生垃圾收集，则整个图都被标记为可达并且不会被收集。这变得更加昂贵，因为在收藏中幸存下来的物品会被提升到下一代，这可能会导致中年危机。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-30T22:11:57.497

确保始终处置 IDisposable 对象。此外，尝试始终使用“使用（...）”块来声明一次性对象。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-30T22:12:51.520

尽可能地意识到你所做的每一件事的复杂性，并考虑每一种情况，而不是依赖教条。例如，还要注意[使用 StringBuilder 并不总是连接字符串的正确方法](http://pobox.com/~skeet/csharp/stringbuilder.html):)

在可能的情况下，尝试流式传输数据而不是缓冲数据 - 当涉及到 LINQ to Objects 时，您需要在这里小心，了解哪些操作符缓冲和哪个流（以及哪些操作都使用不同的序列）。

（这些都不是真正的内存“泄漏” - 但我正在考虑可以快速使用比预期更多的内存的地方。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T23:11:36.690

不完全是内存泄漏，但总是让我明白的一件事：

使用它们后始终**关闭您的 SQL 连接。**

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-30T22:10:37.080

每个 DataTable.NewRow() 都必须有一个匹配的 DaraTable.Rows.Add(...)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T23:16:23.077

如果使用 COM 互操作，请在使用完 COM 对象后使用 Marshal.ReleaseComObject 来释放 Runtime Callable Wrapper (RCW)。

此外，如果您的 COM 对象具有返回另一个 COM 对象的属性或方法，请注意始终将其分配给变量并在之后释放它。

即这将泄漏GetFirstChild接收到的对象：

```
string name = myBigComObject.GetFirstChild().Name; 
```

使用它：

```
ChildComObject firstChild = myBigComObject.GetFirstChild()
string name = firstChild.Name;
Marshal.ReleaseComObject(firstChild); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-30T22:17:14.727

```
something.someEvent += new EventHandler(memoryhog.someMethod);
[...]
something.someEvent += new EventHandler(memoryhog.someMethod);
[...]
something.someEvent -= new EventHandler(memoryhog.someMethod); 
```

如果您错过了从对象中取消所有事件处理程序的操作，那么实现该事件处理程序的对象将在该对象的整个生命周期内停留在内存中。

托管 DirectX 库有这样的错误，这会导致大量内存泄漏。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-30T23:10:01.907

特定于 .NET **Compact** Framework：您必须明确处理所有与图形相关的对象（Graphics、Pen、SolidBrush、Bitmap），否则它们会在内存中徘徊（当您使用低内存设备时效果不佳）。

# svn - 如何使用 maven 从 subversion 导出项目？

> ID：251939
> 
> 赞同：1
> 
> 时间：2008-10-30T22:09:13.587
> 
> 标签：svn, maven-2, export, maven-plugin, maven-scm

Maven 有一个名为[maven-scm-plugin 的插件](http://maven.apache.org/scm/maven-scm-plugin/index.html)，它可以与源代码控制系统进行交互。根据文档，我应该能够像这样导出项目：

```
mvn scm:export -DconnectionUrl=scm:svn:svn://url... -DexportDirectory=./project-export 
```

但是，当我使用 maven 2.0.9 运行此命令时，我从 maven 收到以下错误：

```
[INFO] Required goal not found: scm:export in org.apache.maven.plugins:maven-scm-plugin:1.0-beta-3 
```

所以看起来该插件的 beta-3 版本没有“导出”目标，但它是在 1.1 中添加的。我的 maven repo (.m2\repository\org\apache\maven\plugins\maven-scm-plugin) 中确实有两个版本，但是 maven 坚持使用旧的 beta 版本，并且在找不到时出错“出口”目标。如何强制 maven 使用 1.1 版本的 scm 插件？mvn scm:export 命令是独立使用的，所以没有需要配置的 POM 文件。谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-31T19:02:40.870

自己找到了解决办法。。在插件目录（.m2\repository\org\apache\maven\plugins\maven-scm-plugin）中有一个文件叫maven-metadata-central.xml。我曾经将“1.0-beta-3”作为“最新”和“发布”元素的值，这就是 maven 坚持使用这个旧版本的原因。将它们更改为 1.1 后，我能够运行该命令。

# javascript - 找不到二月十五

> ID：251941
> 
> 赞同：11
> 
> 时间：2008-10-30T22:10:05.100
> 
> 标签：javascript, date

我在 javascript 中，在控制台中运行它

```
d = new Date();             
d.setMonth(1);
d.setFullYear(2009);
d.setDate(15);                                  
d.toString(); 
```

输出这个：

```
"Sun Mar 15 2009 18:05:46 GMT-0400 (EDT)" 
```

为什么会发生这种情况？这似乎是一个浏览器错误。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-30T22:20:32.240

那是因为当你初始化一个新的Date时，它带有今天的日期，所以今天是2008年10月30日，然后你将月份设置为2月，所以没有2月30日，所以先设置日期，然后设置月份，然后再设置年：

```
d = new Date();
d.setDate(15);                    
d.setMonth(1);
d.setFullYear(2009); 
```

但正如[@Jason W](https://stackoverflow.com/questions/251941/the-fifteenth-of-february-isnt-found#251976)所说，最好使用 Date 构造函数：

```
new Date(year, month, date [, hour, minute, second, millisecond ]); 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-10-30T22:20:58.650

最好一步构造一个 Date 对象，以避免 Date 对象处于模棱两可或无效状态：

```
d = new Date(2009, 1, 15); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T22:15:35.103

```
d = new Date();
d.setDate(15);                    
d.setMonth(1);
d.setFullYear(2009);                                                                 
d.toString(); 
```

这行得通。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T22:36:32.237

在使用 Firebug 在 XP 上的 FF3 中进行大量测试后，我可以告诉你以下几点

*   在调用 Date.setMonth()*之后*调用 Date.setDate() 会产生这种奇怪的行为。
*   Date.setMonth() 强制时区为 CST（或某些非 DST 感知区域）
*   Date.setDate() 强制时区为 CDT（或某些 DST 感知区域）

所以，关于时区，setMonth() 和 setDate() 肯定有一些不正常的地方。

我能提供的唯一解决方案是：在设置月份之前设置日期。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-02T13:46:23.577

这通常可以避免javascript Date API的[翻转行为：](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date/setMonth)

```
d.setDate(1);
d.setFullYear(year);
d.setMonth(month);
d.setDate(day); 
```

假设年 + 月 + 日处于“有效”组合中，例如，使用 getFullYear()、getMonth()、getDate() 从另一个 Date 对象中获取。

重要的部分是：

*   从`setDate(1)`当前日期值为 29、30 或 31 时避免可能的翻转开始
*   `setMonth(month)`之前调用`setDate(day)`以避免相同的翻转，以防当前月份值是“有问题的”（因为那样初始值`setDate(1)`将无效）

# image - 如果找不到图像，则为某些图像显示自定义图像 - Lighttpd

> ID：251945
> 
> 赞同：1
> 
> 时间：2008-10-30T22:11:16.190
> 
> 标签：image, http-status-code-404, lighttpd

我有一个网站，可以在创建内容后为某些内容创建图像。我试图弄清楚在创建内容和创建图像之间要做什么。我的想法是我可以设置自定义图像以显示在原始图像上的 404 错误。但是，我不确定如何使用 lighttpd 执行此操作。有什么想法或替代方案吗？

编辑：问题是用户不是创建内容的人，它是由一个过程创建的。基本上，我们将商品添加到目录中，并且我们希望从产品提供商提供的图像中创建标准化的目录图像。但是，我不希望提供商端的慢速服务器减慢新产品的添加速度。因此，一个单独的过程会在以后进行并在可用的情况下创建图像。我想我可以让系统在我们创建产品时创建一个默认图像，然后在我们从提供商提供的图像创建图像时覆盖它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-02T12:10:23.150

客户端的另一种选择是：

```
<img src="/images/generated_image_xyz.png" 
    onerror="this.src='/images/default_image.png'; this.title='Loading...';" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T22:22:20.770

使用`<object>`HTML 中的标记并回退到默认图像。

```
<P>                 <!-- First, try the Python applet -->
<OBJECT title="The Earth as seen from space" 
        classid="http://www.observer.mars/TheEarth.py">
                    <!-- Else, try the MPEG video -->
  <OBJECT data="TheEarth.mpeg" type="application/mpeg">
                    <!-- Else, try the GIF image -->
    <OBJECT data="TheEarth.gif" type="image/gif">
                    <!-- Else render the text -->
     The <STRONG>Earth</STRONG> as seen from space.
    </OBJECT>
  </OBJECT>
</OBJECT>
</P> 
```

（来自 w3.org 的示例）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T23:11:52.027

除了@kentlarsson - 如果你想通过 Javascript 来做，我最近发现了这个代码：http: [//jquery.com/plugins/project/Preload和](http://jquery.com/plugins/project/Preload)[http://demos.flesler.com/jquery/preload](http://demos.flesler.com/jquery/preload/placeholder/)的演示[/placeholder/](http://demos.flesler.com/jquery/preload/placeholder/)按照他的建议执行 - 带有“notFound”选项。

不过，我对 lighttpd 的了解还不够，无法告诉您如何在站点中设置具有一个或多个子目录的自定义图像。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T14:19:28.307

我认为您可能仅在客户端就可以解决此问题。

根据 Jaspers 的回答，您可以这样做：

```
<OBJECT data="/images/generated_image_xyz.png" type="image/png">
     Loading..<blink>.</blink>
</OBJECT> 
```

您还可以使用 CSS 对背景进行分层：

```
<style type="text/css">
    .content_image { width:100px; height: 100px; 
        background: transparent url('/images/default_image.png') no-repeat }
    .content_image div { width:100px; height: 100px; }
</style>

<div class="content_image">
     <div style="background: 
         transparent url('/images/generated_image_xyz.png') no-repeat" />
</div> 
```

后一种解决方案假定您在生成的图像中没有任何透明度。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T22:40:50.153

*据我了解您的问题：您想在生成真实*图像之前显示中间图像？

您可以显示*加载图像*并使用 AJAX 在创建该 DOM 节点时将其更改为*真实*图像。您可以从头开始编写它或使用任何众所周知且稳定的 AJAX 库，如果您没有自己的偏好，请查看[jQuery](http://jquery.com/)。

# git - 如何在没有 IDE 集成的情况下使用源代码控制？

> ID：251946
> 
> 赞同：5
> 
> 时间：2008-10-30T22:11:48.763
> 
> 标签：git, version-control, ide, mercurial

我目前使用 Subversion 作为我的源代码控制系统，主要是因为我发现 ANkhSVN 可以很好地集成到 Visual Studio 中。

但许多人似乎在使用 Git 或 Mercurial 等方面取得了巨大成功。

现在，我想知道如何在没有某种 IDE 集成的情况下使用像 Git 这样的系统。

去命令行做源代码控制对我来说似乎很尴尬，太麻烦了。

**更新：**这引起了相当多的讨论。

我只是想知道你的工作流程是什么样的，我知道如何学习和使用命令行工具。由于重命名/添加文件之类的事情，他们只是感觉不太舒服。我将坚持 AnkhSVN 作为我在 Visual Studio 中选择的 svn 客户端，并将 TortoiseSVN 用于 VS 之外的文件。无论如何，谢谢你的回答！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-30T22:19:51.460

我只是在相关目录中打开一个命令行窗口。在它们之间切换以执行 git 命令并不难。老实说，由于我对 git 还很陌生，因此检查我是否正确使用 git 比切换窗口要花更多的精力：)

不过这里有一个困难（至少对我来说，使用 Visual Studio）：git 和 Visual Studio 都想成为重命名的人。我更喜欢让 git 执行此操作，然后将文件再次添加为 Visual Studio 中的现有项目，但这很*烦人*。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-30T22:46:33.077

我将 Tortoise SVN 与 Windows 资源管理器集成，因此任何不在 IDE 中的文件都可以轻松操作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-30T22:14:21.533

我曾在没有任何 ide 集成的情况下使用版本控制系统。是的，这有点尴尬，特别是如果你习惯了像乌龟这样的出色工具。但最终仍然可以完成您的工作。

[old-geek-mode] 在早期，我们没有 IDE，只有一个编辑器和一个命令行编译器。当然是;-)。[/老极客模式]

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T22:26:20.870

我的大部分项目要么是嵌入式设备，要么是开发工具。我整天都在命令行下，所以对我来说，调出我的源代码控制 GUI 实际上很麻烦。任何乏味或常用的命令都被别名或替换为简单的脚本。

这样做的另一个优点是该过程可以在很大程度上自动化。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T22:16:18.940

大多数 IDE 都可以选择调用外部应用程序，这样您就可以在 IDE 中继续使用源代码控制系统。

此外，大多数版本控制系统都有某种类型的 GUI 系统，您可以保持打开状态，这也是我通常所做的（我大部分时间使用 TortoiseSVN）。

但是，当上述所有方法都失败时，打字`svn add <filename>`并不`svn commit --message <foo>`那么难；-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T22:17:16.443

首先，如果您对 svn 感到满意并且喜欢您正在使用的客户端，为什么要更改？其次，学习/使用命令行有什么问题？你想使用 git 的原因是什么？Git 实际上与其他源代码控制系统配合得很好，您可以同时将内容存储在 git 和 svn 中而不会发生任何冲突。然而，Git 非常以 unix/linux 为中心。**让 git 运行非常**容易（git init、git add、git commit，...）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T22:40:35.147

您可以将 TortoiseHg 与 Mercurial 一起使用。

它与 Windows 集成中的 TortoiseSVN 非常相似，因此您需要更少地进入命令行。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-30T22:44:13.267

主要是在 OS X/linux 上进行 Rails 开发，无论如何，我最终将一半的时间花在命令行上，因为这是运行大多数支持工具的最简单方法，并且在一段时间后它就会成为第二天性。我保持打开 IDE 或文本编辑器（取决于项目的复杂性）打开并在它和命令行之间花费 50/50 的时间。

如果您使用的是 Visual Studio，我猜您是在 Windows 上开发的。难怪使用命令行不是一件自然而然的事情 - 没有冒犯，只是 Windows 控制台很糟糕，使用起来并不令人鼓舞或令人愉快。

做几件事可以让你的生活更轻松：

*   安装[cygwin](http://www.cygwin.com/)或类似工具作为 CMD.exe 的替代 shell，并开始使用 *nix 风格的命令行工具。它们将为您提供比 Windows 更多的功能，并且您会发现使用命令行来处理您过去使用 GUI 处理的许多事情（文件复制/移动操作等，检查日志文件）。

*   然后安装[Console](http://sourceforge.net/projects/console/)作为标准 Windows 命令行终端的替代品。它更具可定制性，支持标签、颜色突出显示等。

当我去一个新的基于客户端站点的项目时，我做了这两件事，我们被迫使用 Windows PC。帮助很大！从命令行使用 SVN/GIT 通常更容易。特别是对于像这样的批量操作，而不是通过 IDE 对话框进行挖掘。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T23:01:48.490

我曾经专门从命令行使用 perforce——当时它是命令行或他们自己的 p4win 控制台。坦率地说，命令行更容易。

但那是在做linux开发，ide是vi。用 IntelliJ 和 SVN 做 java 我喜欢 ide 集成......新类，自动添加。可以管理 ide 中的变更列表、差异、责备、查看历史......我认为非集成源代码控制系统的优势必须非常引人注目，我才能选择它而不是集成系统。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-30T23:02:41.063

就个人而言，在命令行上使用 Tortoise SVN、WinCVS 和 BZR 之后，我最近被迫在 Eclipse 和 Visual Studio 和 Eclipse 中使用 IDE 集成源代码控制。

我认为IDE集成方法是最烦人的，我不希望IDE中的任何东西，我想使用适当的Diff工具等。它看起来不是很直观。

我最喜欢的方法必须是使用文件管理器集成组件，因为它可以很好地模拟我希望文件系统在源代码控制服务器上的外观。

此外，我可以在同一个存储库下拥有多种不同语言的文件，因为它不限于对文件的源代码控制理解。

或者使用命令行，这对您来说似乎不自然，因为您只使用过 IDE 集成，它是由生活和呼吸命令行的人构建的，但它通常是有意义的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-30T23:11:51.340

你试过 git gui 吗？我也很难学习命令，但对 git gui 感觉更舒服。

我已经在 .NET C# 项目中使用 git 超过六个月了，我很高兴。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-19T01:16:58.263

我使用没有插件的eclipse for mercurial。但我配置它以供使用。它看起来像一个插件。我不了解 git，但在 mercurial 中你有 tortoiseHG（如 tortoiseSVN）。在 Visual Studio 中，您可以添加外部工具吗？

如果可以的话，你可以用 tortoisehg 为 mercurial 添加这个：

hgtk log <- 你可以添加/删除标签，更新（签出），版本之间的差异......
hgtk commit <- 你可以看到变化是什么
hgtk synch
hgtk status
hgtk update

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-19T01:25:36.683

TortoiseSVN 的另一个插件，非常好，但没有集成到 IDE 中。

但是在添加/删除必须在 IDE 和 Subversion 中完成的文件时，您必须小心。不幸的是，在 VS 中添加文件并忘记使用 Tortoise 添加它有点容易。

# sql - MS SQL 2005 表到 XML

> ID：251957
> 
> 赞同：3
> 
> 时间：2008-10-30T22:14:57.413
> 
> 标签：sql, sql-server, xml, tsql, xcelsius

我在 SQL Server 2005 中有一个简单的表，我希望将其转换为 XML（使用“FOR XML”子句）。我无法让我的 XML 看起来像所需的输出。

我试过浏览网上的各种教程，但我很挣扎。有人可以帮忙吗？

我的桌子看起来像这样

```
TYPE,GROUP,VALUE
Books,Hardback,56
Books,Softcover,34
CDs,Singles,45
CDS,Multis,78 
```

我需要的输出样式是：

```
<data>
  <variable name="TYPE">
   <row>
     <column>GROUP</column>
     <column>VALUE</column>
   </row>
   <row>
     <column>GROUP</column>
     <column>VALUE</column>
   </row>
  </variable>
 <variable name="TYPE">
   <row>
     <column>GROUP</column>
     <column>VALUE</column>
   </row>
   <row>
     <column>GROUP</column>
     <column>VALUE</column>
   </row>
  </variable>
</data> 
```

**编辑：** 据我所知，我需要多个值。我正在生成与 Xcelsius 一起使用的 XML（[链接 XML 和 Xcelsius](http://xcelsius.files.wordpress.com/2008/05/xml_data_button.pdf)），因此无法控制 XML 的格式。我可以按照链接教程使用 ASP 生成 XML，但我希望直接从 SQL Server 获取它。

**编辑2：** 我希望有一些优雅和整洁的东西......但Godeke的例子最接近。一些摆弄SQL，我想出了：

```
select
   "type" as '@name', 
   "group" as 'row/column',
   null as 'row/tmp', 
   "value" as 'row/column'
from tableName
for xml path('variable'), root('data') 
```

几乎按照我想要的方式输出。null/tmp 行甚至不输出；它只是防止串联。仍然标签`<variable name="TYPE">`为每一行重复，这是我不能拥有的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T22:59:33.097

尽可能接近的是：

```
select "type" as '@name', "group" as 'row/column1', "value" as 'row/column2'
from tableName
for xml path('variable'), root('data') 
```

将两个项目命名为相同（“column”和“column”）并不是我知道如何一次性完成的事情，但另一方面，这是一个奇怪的 XML 模式选择；如果元素包含不同的数据，通常元素具有唯一的名称。显而易见的选择（将它们都命名为“行/列”）只是将它们在输出中连接成一个值。

另请注意，每个返回的行都将是一个不同于其他行的“变量”元素。要获得没有冗余记录的嵌套将需要一个子查询：

```
select distinct "type" as '@name'
from Agent
for xml path('variable'), root('data') 
```

是我的第一个想法，但独特的防止嵌套。

所有这一切让我认为要获得所需的*确切*输出，您可能必须使用 EXPLICIT 模式。也许我的问题是因为我在代码中使用了 DOMDocument :)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T22:41:09.297

我更喜欢使用 XML PATH，它提供了一种更好的方式来控制你的元素等。

[看](http://theengineroom.provoke.co.nz/archive/2007/04/27/using-for-xml-path-a-primer.aspx)

但这很棘手

```
 /*
create table #tablename
(
[type] varchar(20),
[group] varchar(20),
[value] varchar(20)
)

insert into #tablename select 'type1','group11','value111'
insert into #tablename select 'type1','group11','value112'
insert into #tablename select 'type1','group12','value121'
insert into #tablename select 'type1','group12','value122'
insert into #tablename select 'type2','group21','value211'
insert into #tablename select 'type2','group21','value212'
insert into #tablename select 'type2','group22','value221'
insert into #tablename select 'type2','group22','value222'

alter table #tablename add id uniqueidentifier

update #tablename set id = newid()
*/

select [type] as '@name',
    (select     
        (select [column] from
            (
                select [group] as 'column', tbn1.type, tbn2.[group]
               from #tablename tbn3 WHERE tbn3.type = tbn1.type and tbn2.[group] =  tbn3.[group]
               union
         select [value], tbn1.type, tbn2.[group]
              from #tablename tbn3 WHERE tbn3.type = tbn1.type and tbn2.[group] = tbn3.[group]
            ) as s
        for xml path(''),type 
        )
    from #tablename tbn2 
    where tbn2.type = tbn1.type
    for xml path('row3'), type
)

from #tableName tbn1 
GROUP BY [type]
for xml path('variable'), root('data') 
```

给你你想要的我，但优雅和整洁却不是。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T01:40:11.557

**下面的脚本产生所需的格式**

> <DATA>
>     <VARIABLE TYPE="Books">
>       <row TYPE="Books">
>         <GROUP>精装本</GROUP>
>         <VALUE>56</VALUE>
>       </row>
>       <row TYPE="Books">
>         <GROUP>平装</GROUP>
>         <VALUE>34</VALUE>
>       </row>
>     </VARIABLE>
>     <VARIABLE TYPE="CDs">
>       <row TYPE="CDs">
>         <GROUP>单曲</GROUP>
>         <VALUE>45< /VALUE>
>       </row>
>       <row TYPE="CDS">
>         <GROUP>Multis</GROUP>
>         < VALUE>78</VALUE>
>       </row>
>     </VARIABLE>
> </DATA>

**调用**

> `DECLARE @tblItems table (
>     [TYPE] varchar(50)
>     ,[GROUP] varchar(50)
>     ,[VALUE] int
> )
> 
> DECLARE @tblShredded table (
>     [TYPE] varchar(50)
>     ,[XmlItem] xml
> )
> 
> DECLARE @xmlGroupValueTuples xml
> 
> insert into @tblItems([TYPE],[GROUP],[VALUE]) values( 'Books','Hardback',56)
> insert into @tblItems([TYPE],[GROUP],[VALUE]) values( 'Books','Softcover',34)
> insert into @tblItems([TYPE],[GROUP],[VALUE]) values( 'CDs','Singles',45)
> insert into @tblItems([TYPE],[GROUP],[VALUE]) values( 'CDS','Multis',78)
> 
> SET @xmlGroupValueTuples =
>   (
>     SELECT
>       "@TYPE" = [TYPE]
>       ,[GROUP]
>       ,[VALUE]
>     FROM @tblItems
>     FOR XML PATH('row'), root('Root')
>   )
> 
> INSERT @tblShredded([TYPE], XmlItem)
> SELECT
>     [TYPE] = XmlItem.value('./row[1]/@TYPE', 'varchar(50)')
>     ,XmlItem
> FROM dbo.tvfShredGetOneColumnedTableOfXmlItems(@xmlGroupValueTuples)
> 
> SELECT
>   (
>     SELECT
>       VARIABLE =
>         (
>           SELECT
>             "@TYPE" = t.[TYPE]
> 
>             ,(
>               SELECT
>                 tInner.XmlItem.query('./child::*')
>               FROM @tblShredded tInner
>               WHERE tInner.[TYPE] = t.[TYPE]
>               FOR XML PATH(''), ELEMENTS, type
>             )
>           FOR XML PATH('VARIABLE'),type
>         )
>   )
> FROM @tblShredded t
> GROUP BY
>     t.[TYPE]
> FOR XML PATH(''), ROOT('DATA')`

**在哪里**

> `-- Example Inputs
> /*
> DECLARE @xmlListFormat xml
> SET @xmlListFormat =
>     '
>         <XmlListRoot>
>             <Item>004421UB7</Item>
>             <Item>59020UH24</Item>
>             <Item>542514NA8</Item>
>         </XmlListRoot>
>     '
> */
> 
> -- =============================================
> -- Author: 6eorge Jetson
> -- Create date: 01/22/3003
> -- Description: Shreds an input XML list conforming to the expected list schema
> -- =============================================
> CREATE FUNCTION [dbo].[tvfShredGetOneColumnedTableOfXmlItems] (@xmlListFormat xml)
> RETURNS
> @tblResults TABLE (XmlItem xml)
> AS
> BEGIN
> 
>     INSERT @tblResults
>     SELECT
>         tblShredded.colXmlItem.query('.') as XmlItem
>     FROM
>         @xmlListFormat.nodes('/child::*/child::*') as tblShredded(colXmlItem)
> 
>     RETURN
> END`

# sql-server-2005 - 对于长时间运行的插入，我想要哪个 SQL 读取事务隔离级别？

> ID：251960
> 
> 赞同：1
> 
> 时间：2008-10-30T22:15:06.790
> 
> 标签：sql-server-2005, performance, transactions

我有一个长时间运行的插入事务，它将数据插入到几个相关的表中。

当此插入运行时，我无法从 MainTable 执行 select *。选择只是旋转它的轮子，直到插入完成。

我将在相同/重叠的时间执行其中几个插入。为了检查信息是否没有插入两次，我首先查询 MainTable 以查看是否存在条目并且未设置其处理位。

在插入事务期间，它翻转该行的 MainTable 处理位。

所以我需要能够读取表格，并且能够判断特定行当前是否正在更新。

关于如何在 Microsoft SQL 2005 中进行设置的任何想法？我正在查看[SET TRANSACTION ISOLATION LEVEL](http://msdn.microsoft.com/en-us/library/ms173763.aspx)文档。

谢谢你，
基思

**编辑：** 我不认为相同的插入批次会同时发生。这些是正在处理的二进制文件，它们的数据插入到数据库中。在解析和插入数据之前，我检查文件是否未被处理。当我进行检查时，如果在我快速插入 MainTable 之前没有看到该文件，并且已处理的位设置为 false。

有没有办法锁定正在更新的行而不是整个表？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T22:42:27.233

在使用 READ UNCOMMITTED 之前，您可能需要重新考虑您的流程。隔离交易有很多很好的理由。如果您使用 READ UNCOMMITTED 您可能仍然会得到重复，因为两个插入有可能同时检查更新并且都没有发现它们创建重复。尝试将其分成更小的批次或发出定期 COMMITS

编辑

您可以将 MainTable 更新包装在可以更快释放该表的事务中，但您仍然可能会与其他表发生冲突。

IE

```
BEGIN TRANSACTION

SELECT @ProcessedBit = ProcessedBit FROM MainTable WHERE ID = XXX

IF  @ProcessedBit = False
    UPDATE MainTable SET ProcessedBit = True WHERE ID = XXX

COMMIT TRANSACTION

IF  @ProcessedBit = False
BEGIN
    BEGIN TRANSACTION
    -- start long running process
    ...
    COMMIT TRANSACTION
END 
```

编辑以启用错误恢复

```
BEGIN TRANSACTION

SELECT @ProcessedStatus = ProcessedStatus FROM MainTable WHERE ID = XXX

IF  @ProcessedStatus = 'Not Processed'
    UPDATE MainTable SET ProcessedBit = 'Processing' WHERE ID = XXX

COMMIT TRANSACTION

IF  @ProcessedStatus = 'Not Processed'
BEGIN
    BEGIN TRANSACTION
    -- start long running process
    ...

   IF No Errors
   BEGIN
       UPDATE MainTable SET ProcessedStatus = 'Processed' WHERE ID = XXX
       COMMIT TRANSACTION
   ELSE
       ROLLBACK TRANSACTION

END 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T22:35:22.333

允许一个事务读取由另一个正在进行的事务（在它提交之前）执行的更改的唯一隔离级别是：

```
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED 
```

# .net - 与 Flex 共享 .NET 会话/身份验证

> ID：251961
> 
> 赞同：2
> 
> 时间：2008-10-30T22:15:21.330
> 
> 标签：.net, asp.net, apache-flex, session

我有一个用户进行身份验证的 .NET 1.1 应用程序（VB.NET 1.1 购物车）。

我想“固定”一个 Flex 应用程序，但不想让用户重新验证。他们不应该知道这是一个单独的应用程序。

我想通过某种安全通道使用 WebServices (C# 3.5)。

我的主要问题是我如何知道用户在与 Web 服务通信时在 Flex 中进行了身份验证。我看到了使用[EnableSession](https://stackoverflow.com/questions/59945/accessing-net-web-service-securely-from-flex-3)的建议，但我什至不知道这是否可行，因为我不知道 Flex 如何知道发送父浏览器中存在的任何 cookie。

目前，购物车的身份验证理念是在会话中粘贴一个自定义的“用户”对象。我不认为那是真正的 ASP，但无论如何，如果我有会话，我可以得到它。

我有哪些选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T22:35:03.193

Flex 确实共享浏览器的 cookie（不久前我看到了一个演示）。谷歌搜索它；有几篇文章。使用 AJAX 和 Silverlight，如果您在 Web 服务和网站中启用会话，则可以在两个地方使用相同的会话。Flex 应该是一样的，因为它只使用浏览器的 cookie。

如果您有两个不同的 Web 应用程序，一个运行 .Net 1.1，一个运行 .Net 3.5，您**将无法共享进程内会话**。您将不得不使用**[会话状态服务器](http://msdn.microsoft.com/en-us/library/ms178586.aspx)**之类的东西来维护跨应用程序的会话。

# perforce - 有没有办法在不同步到您的客户端的情况下强制删除？

> ID：251964
> 
> 赞同：10
> 
> 时间：2008-10-30T22:16:06.413
> 
> 标签：perforce

我经常不小心创建了一个包含比它需要的更多代码的分支。发生这种情况时，我会删除分支文件、分支标记，然后重新开始。令人讨厌的是必须同步大量数据才能删除它。

有没有办法删除服务器端？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-30T22:49:13.117

是的，使用同步-k。

将要删除的路径添加到客户端，例如

```
//depot/oops/... //your-client/oops/... 
```

然后使用 -k 选项同步该位置：

```
p4 sync -k oops/... 
```

这将告诉 Perforce，您的客户端拥有文件，而没有实际传输它们。然后你可以这样做：

```
p4 delete oops/...
p4 submit oops/... 
```

等等

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-06-04T13:01:17.797

使用删除-v：

```
p4 delete -v oops/... 
```

这将删除文件而不同步到工作区。它比 sync -k 然后删除更快。

# c# - .Net 中的数据绑定下拉控件

> ID：251985
> 
> 赞同：1
> 
> 时间：2008-10-30T22:26:49.467
> 
> 标签：c#, .net, winforms, data-binding, .net-2.0

我正在将下拉列表与 db 实体绑定。

```
ddlCustomer.DataSource = Customer.GetAll();
ddlCustomer.DataTextField = "CustomerName";
ddlCustomer.DataBind(); 
```

我想将“SELECT”添加为下拉列表中的第一个项目列表，然后将实体绑定到下拉列表。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T22:33:27.580

添加：

```
ddlCustomer.Items.Insert(0, "SELECT"); 
```

在 ddlCustomer.DataBind(); 之后

项目必须在数据绑定之后插入，因为数据绑定会清除项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T22:33:21.917

我不知道是否有一个单行解决方案，但我之前所做的是，不使用 DataBind ，首先创建 ListItem 对象，该对象将以“Select”作为文本，然后遍历从返回的集合Customer.GetAll() 并为集合中的每个项目创建一个 ListItem 对象，并使用 "DropDownList.Iems.Add(MyItem)" 将其添加到下拉列表中，我知道它看起来不是很出色，但它可以完成工作，毕竟这是DataBind在后面做的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-01T16:02:50.750

我知道已经有答案了，但你也可以这样做：

```
<asp:DropDownList AppendDataBoundItems="true" ID="ddlCustomer" runat="server">
    <asp:ListItem Value="0" Text="Select"/>
</asp:DropDownList> 
```

这样，您就不必担心何时调用 Databind 以及何时添加选择项。

# c# - 如何在其他页面的代码中从 global.asax 访问属性

> ID：251987
> 
> 赞同：14
> 
> 时间：2008-10-30T22:27:41.897
> 
> 标签：c#, asp.net, global-asax

想象一下，我在 global.asax 中定义了一个属性。

```
public List<string> Roles
{
    get
    {
        ...
    }
    set
    {
        ...
    }
} 
```

我想在另一个页面中使用该值。我如何参考它？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-30T22:39:29.253

您可以像这样访问该类：

```
((Global)this.Context.ApplicationInstance).Roles 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T22:35:17.827

在我看来，这只取决于会话 - 那么为什么不让它成为一对以会话为参数的静态方法呢？然后您可以从页面传入“Session”属性的值。（当然，任何可以访问 HttpApplication 的东西都可以引用它的 Session 属性。*）*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T22:38:59.067

如果这是您需要在所有页面中访问的属性，您最好定义一个所有其他页面都扩展的基本页面......

例如默认情况下

```
public partial class _Default : System.Web.UI.Page 
{
} 
```

您可以做的是将 BasePage.cs 添加到您的 App_Code 文件夹

```
public class BasePage : System.Web.UI.Page 
{
   public List<string> Roles
   {
       get { ... }
       set { ... }
   }
} 
```

然后让你的页面扩展它。

```
public partial class _Default : BasePage
{
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T22:49:56.890

嘿，我正在弹出我的 stackoverflow.com 樱桃！潜伏一个月后我的第一个答案。

要访问 Global 类中定义的属性，请使用以下任一方法：

*   在 HttpApplication 和 Page 类中定义的 Application 属性（例如 Page.Application["TestItem"]）

*   HttpContext.ApplicationInstance 属性（例如 HttpContext.Current.ApplicationInstance）

使用其中任何一个，您都可以将结果转换为您的 Global 类型并访问您需要的属性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-16T12:49:48.777

您还可以使用以下语法：

```
((Global)HttpContext.Current.ApplicationInstance).Roles 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T22:45:18.990

如果值依赖于 Session 那么使用 HttpContext.Items 字典实际上很简单：

将此代码放在 Global.asax 中以存储值：

```
Dim someValue As Integer = 5
Context.Items.Add("dataKey", someValue) 
```

让我们使用以下代码在页面中检索它：

```
Dim someValue As Integer = CType(HttpContext.Current.Items("dataKey"), Integer) 
```

这是一个更详细地描述它的链接：http: [//aspnet.4guysfromrolla.com/articles/060904-1.aspx](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-02T19:04:04.663

在 .net 3.5 的 global.asax 本身上，我使用了 typeof(global_asax) 并且效果很好。而且，真正引导我到这里的是实现 DotNet OpenID 示例。我更改了其中的一些以使用 Will 建议的应用程序缓存。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-07-12T14:45:27.613

对于无法将 Global 作为一个类的其他项目层：

```
dynamic roles= ((dynamic)System.Web.HttpContext.Current.ApplicationInstance).Roles;
if (roles!= null){
   // my codes
} 
```

只是我必须确保 Global 类中的 Roles 属性永远不会改变。另一种方法是通过反射。***~~******