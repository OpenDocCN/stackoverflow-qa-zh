# StackOverflow 问答 000122000-000122999

# python - 我如何用 Ruby/Python 编写这个？或者，你能把我的 LINQ 翻译成 Ruby/Python 吗？

> ID：122033
> 
> 赞同：8
> 
> 时间：2008-09-23T16:10:42.553
> 
> 标签：python, ruby, linq, functional-programming

昨天，我问[了这个](https://stackoverflow.com/questions/119107/how-do-i-generate-a-list-of-n-unique-random-numbers-in-ruby)问题，但从来没有真正得到我真正满意的答案。我真的很想知道如何使用诸如 Ruby 之类的函数式语言来生成一个包含 N 个唯一随机数的列表，而不必在风格上非常迫切。

因为我没有看到任何我真正喜欢的东西，所以我编写了我在 LINQ 中寻找的解决方案：

```
 static void Main(string[] args)
        {
            var temp = from q in GetRandomNumbers(100).Distinct().Take(5) select q;
        }

        private static IEnumerable GetRandomNumbers(int max)
        {
            Random r = new Random();
            while (true)
            {
                yield return r.Next(max);
            }
        } 
```

你能把我的 LINQ 翻译成 Ruby 吗？Python？还有其他函数式编程语言吗？

**注意：**请尽量不要使用太多的循环和条件 - 否则解决方案是微不足道的。另外，我宁愿看到一个解决方案，您不必生成比 N 大得多的数组，这样您就可以删除重复项并将其修剪为 N。

我知道我很挑剔，但我真的很想看到一些优雅的解决方案来解决这个问题。谢谢！

**编辑：**
为什么所有的反对票？

最初我的代码示例在 Take() 之后有 Distinct()，正如许多人指出的那样，这可能会给我留下一个空列表。我已经更改了调用这些方法的顺序，以反映我最初的意思。

**道歉：**
有人告诉我这篇文章相当势利。我并不是要暗示 LINQ 比 Ruby/Python 更好。或者我的解决方案比其他人的解决方案要好得多。我的目的只是学习如何在 Ruby 中做到这一点（有一定的限制）。如果我被认为是个混蛋，我很抱歉。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T16:18:19.447

```
>>> import random
>>> print random.sample(xrange(100), 5)
[61, 54, 91, 72, 85] 
```

这应该在 range 中产生 5 个唯一值`0 — 99`。该`xrange`对象根据请求生成值，因此没有内存用于未采样的值。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T16:27:31.920

在红宝石中：

```
a = (0..100).entries.sort_by {rand}.slice! 0, 5 
```

**更新**：这是一种稍微不同的方式：a = (0...100).entries.sort_by{rand}[0...5]

**编辑：**

在 Ruby 1.9 中，您可以这样做：

```
Array(0..100).sample(5) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T16:24:18.730

嗯...怎么样（Python）：

```
s = set()
while len(s) <= N: s.update((random.random(),)) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T16:17:48.713

我将放弃使用“随机”模块的最简单的解决方案，因为我认为这并不是你真正想要的。这是我认为您在 Python 中寻找的内容：

```
>>> import random
>>> 
>>> def getUniqueRandomNumbers(num, highest):
...     seen = set()
...     while len(seen) < num:
...         i = random.randrange(0, highest)
...         if i not in seen:
...             seen.add(i)  
...             yield i
... 
>>> 
```

向您展示它是如何工作的：

```
>>> list(getUniqueRandomNumbers(10, 100))
[81, 57, 98, 47, 93, 31, 29, 24, 97, 10] 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T16:28:02.340

这是另一个 Ruby 解决方案：

```
a = (1..5).collect { rand(100) }
a & a 
```

我认为，使用您的 LINQ 语句， Distinct 将在 5 个已被占用后删除重复项，因此您不能保证获得 5 个。不过，如果我错了，有人可以纠正我。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T16:38:45.497

编辑：好的，只是为了好玩，一个更短更快的（并且仍在使用迭代器）。

```
def getRandomNumbers(max, size) :
    pool = set()
    return ((lambda x :  pool.add(x) or x)(random.randrange(max)) for x in xrange(size) if len(a) < size)

print [x for x in gen(100, 5)]
[0, 10, 19, 51, 18] 
```

是的，我知道，单行应该留给 perl 爱好者，但我认为这个很强大，不是吗？

旧消息在这里：

天哪，这一切是多么复杂！让我们成为pythonic：

```
import random
def getRandomNumber(max, size, min=0) :
   # using () and xrange = using iterators
   return (random.randrange(min, max) for x in xrange(size))

print set(getRandomNumber(100, 5)) # set() removes duplicates
set([88, 99, 29, 70, 23]) 
```

享受

编辑：正如评论员所注意到的，这是问题代码的精确翻译。

为了避免我们在生成列表后删除重复的问题，导致数据太少，您可以选择另一种方式：

```
def getRandomNumbers(max, size) :
    pool = []
    while len(pool) < size :
        tmp = random.randrange(max)
        if tmp not in pool :
            yield pool.append(tmp) or tmp

print [x for x in getRandomNumbers(5, 5)]
[2, 1, 0, 3, 4] 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-09-25T09:17:24.077

在 Ruby 1.9 中：

```
Array(0..100).sample(5) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T16:13:51.157

带有数字 Python 的 Python：

```
from numpy import *
a = random.random_integers(0, 100, 5)
b = unique(a) 
```

瞧！当然你可以用函数式编程风格做类似的事情，但是......为什么？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T16:31:02.240

```
import random

def makeRand(n):
   rand = random.Random()
   while 1:
      yield rand.randint(0,n)
   yield rand.randint(0,n)      

gen = makeRand(100)      
terms = [ gen.next() for n in range(5) ]

print "raw list"
print terms
print "de-duped list"
print list(set(terms))

# produces output similar to this
#
# raw list
# [22, 11, 35, 55, 1]
# de-duped list
# [35, 11, 1, 22, 55] 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T16:32:42.470

好吧，首先你用 Python 重写 LINQ。那么你的解决方案是单行的:)

```
from random import randrange

def Distinct(items):
    set = {}
    for i in items:
        if not set.has_key(i):
            yield i
            set[i] = 1

def Take(num, items):
    for i in items:
        if num > 0:
            yield i
            num = num - 1
        else:
            break

def ToArray(items):
    return [i for i in items]

def GetRandomNumbers(max):
    while 1:
        yield randrange(max)

print ToArray(Take(5, Distinct(GetRandomNumbers(100)))) 
```

如果你把上面所有的简单方法都放到一个名为 LINQ.py 的模块中，你可以给你的朋友留下深刻印象。

（免责声明：当然，这*实际上*并不是用 Python 重写 LINQ。人们误以为 LINQ 只是一堆琐碎的扩展方法和一些新语法。然而，LINQ 真正高级的部分是自动 SQL 生成，因此当您正在查询数据库，它是实现 Distinct() 而不是客户端的数据库。）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T16:42:27.577

这是从您的解决方案到 Python 的音译。

首先，一个生成随机数的生成器。这不是很 Pythonic，但它与您的示例代码非常匹配。

```
>>> import random
>>> def getRandomNumbers( max ):
...     while True:
...             yield random.randrange(0,max) 
```

这是一个收集一组 5 个不同值的客户端循环。这 - 再次 - 不是最 Pythonic 的实现。

```
>>> distinctSet= set()
>>> for r in getRandomNumbers( 100 ):
...     distinctSet.add( r )
...     if len(distinctSet) == 5: 
...             break
... 
>>> distinctSet
set([81, 66, 28, 53, 46]) 
```

目前尚不清楚为什么要使用随机数生成器——这是少数几件如此简单以至于生成器无法简化它的事情之一。

更 Pythonic 的版本可能类似于：

```
distinctSet= set()
while len(distinctSet) != 5:
    distinctSet.add( random.randrange(0,100) ) 
```

如果要求是生成 5 个值并在这 5 个中找到不同的值，那么类似

```
distinctSet= set( [random.randrange(0,100) for i in range(5) ] ) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-23T16:57:09.180

也许这会满足您的需求，并且看起来更 linqish：

```
from numpy import random,unique

def GetRandomNumbers(total=5):
    while True:
        yield unique(random.random(total*2))[:total]

randomGenerator = GetRandomNumbers()

myRandomNumbers = randomGenerator.next() 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-23T19:33:19.820

这是另一个 python 版本，更接近于 C# 代码的结构。没有提供不同结果的内置函数，所以我添加了一个函数来执行此操作。

```
import itertools, random

def distinct(seq):
    seen=set()
    for item in seq:
        if item not in seen:
            seen.add(item)
            yield item

def getRandomNumbers(max):
    while 1:
        yield random.randint(0,max)

for item in itertools.islice(distinct(getRandomNumbers(100)), 5):
    print item 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-09-23T16:23:30.090

我无法真正阅读您的 LINQ，但我认为您正在尝试获取 5 个最多 100 的随机数，然后删除重复项。

这是一个解决方案：

```
def random(max)
    (rand * max).to_i
end

# Get 5 random numbers between 0 and 100
a = (1..5).inject([]){|acc,i| acc << random( 100)}
# Remove Duplicates
a = a & a 
```

但也许您实际上是在寻找 0 到 100 之间的 5 个不同的随机数。在这种情况下：

```
def random(max)
    (rand * max).to_i
end

a = []
while( a.size < 5)
    a << random( 100)
    a = a & a
end 
```

现在，这可能会违反您“没有太多循环”的感觉，但大概 Take 和 Distinct 只是对您隐藏了循环。只需向 Enumerable 添加方法以隐藏 while 循环就很容易了。

# .net - How to find GridItem from click on PropertyGrid?

> ID：122036
> 
> 赞同：1
> 
> 时间：2008-09-23T16:10:44.627
> 
> 标签：.net, winforms, propertygrid

I'm trying to do some custom UI behavior on a Windows Forms PropertyGrid control. I'd like to be able to respond to clicks and double-clicks on the GridItems to change the state. For example, to flip a binary or ternary variable through its states.

I can get at the underlying view by looking up a child of typename "PropertyGridView" and can hook its Click event. Only problem is then what do I do? I can't find any functions that map mouse coordinates onto grid items.

There is a SelectedGridItem but this isn't helpful. There are many places you can click on a control that do not update this property, and so responding to a Click assuming SelectedGridItem is updated will get a lot of incorrect results.

Aside from purchasing a commercial property grid control or switching to a gridview of some kind, is there anything I can do here? The PropertyGrid is almost exactly what I need. I'm even considering wandering through with Reflector and doing some very unfriendly things with this control to get the data out that I need. :)

More info: I do know about using custom UITypeEditor classes, and am already doing this in other areas (color picker). Unfortunately doing custom UI work requires an extra click (to browse or drop-down some UI). For example, I have embedded a checkbox using UITypeEditor.PaintValue and would really like to be able to just click on it to check/uncheck.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T16:27:46.367

If you need to flip the values of a simple type you can have an enumeration value displayed in the property grid. This will appear automatically as a drop down list. If you need to create some more clever UI editor I suggest you'll take a look at the following articles that explain how to create custom UI in the property grid: [http://msdn.microsoft.com/en-us/library/aa302334.aspx](http://msdn.microsoft.com/en-us/library/aa302334.aspx) [http://msdn.microsoft.com/en-us/library/aa302326.aspx](http://msdn.microsoft.com/en-us/library/aa302326.aspx)

If you want to handle a value change in the property grid to do something in the application or change the values in the property grid you can handle the OnPropertyValueChanged that is raised after each change in the property grid.

Handling the mouse click and the mouse double click are not necessary once you can create your own UI editor. UI editors can be drop down editors or modal editors. Again, I strongly suggest you to read the above articles. They are quite good.

# visual-studio-2008 - Has anyone already done the work to make STLPort build with VS2008 and/or an x64 build with VS2005?

> ID：122057
> 
> 赞同：3
> 
> 时间：2008-09-23T16:16:52.303
> 
> 标签：visual-studio-2008, visual-studio-2005, stl, 64-bit, stlport

At present it seems that VS2008 still isn't supported either in the 5.1.5 release or in the STLPort CVS repository. If someone has already done this work then it would be useful to share, if possible :)

Likewise it would be useful to know about the changes required for a VS2005 or 2008 x64 build.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T22:57:26.117

[Seems so](http://blog.narahome.com/archive/200806).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T09:50:38.863

It turns out that x64 support, whilst not explicitly stated, just works. If you set your environment up to use the x64 tools by running `\Program Files (x86)\Microsoft Visual Studio 9.0\VC\bin\amd64\vcvarsamd64.bat` then run configure.bat for your compiler and build as normal you end up with appropriate libs and dlls.

Unfortunately the x64 libs build to the same names as the x86 libs so it's not possible to have a 'side by side' installation of STLPort to allow you to build with either x86 or x64\.

**Edit:** I've written up what you need to do to provide side-by-side x64 and x86 support as well as packaging up the changes required for vs2008 builds on my blog. See here: [http://www.lenholgate.com/blog/2008/10/stlport-515-and-vs2008-and-x64.html](http://www.lenholgate.com/blog/2008/10/stlport-515-and-vs2008-and-x64.html)

For other versions of Visual Studio see here: [http://www.lenholgate.com/blog/2005/12/stlport-50-and-multiple-vc-versions.html](http://www.lenholgate.com/blog/2005/12/stlport-50-and-multiple-vc-versions.html), here: [http://www.lenholgate.com/blog/2007/05/stlport-513-and-multiple-vc-versions.html](http://www.lenholgate.com/blog/2007/05/stlport-513-and-multiple-vc-versions.html) and here: [http://www.lenholgate.com/blog/2010/07/stlport-521-and-vs2010-and-x64.html](http://www.lenholgate.com/blog/2010/07/stlport-521-and-vs2010-and-x64.html)

# internet-explorer - 图标在 IE 中不起作用

> ID：122067
> 
> 赞同：41
> 
> 时间：2008-09-23T16:19:24.140
> 
> 标签：internet-explorer, favicon

我有一个使用自定义 favicon.ico 的网站。favicon 在除 IE 之外的所有浏览器中都按预期显示。当试图在 IE 中显示图标时，我得到了大红色 x；在另一个浏览器中显示图标时，它显示得很好。页面源包括并且它确实在其他浏览器中工作。谢谢你的想法。

**编辑：已解决：问题的根源是文件是重命名为 ico 的 jpg。我将文件创建为 ico，它按预期工作。感谢您的输入。**

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-09-23T16:26:53.247

是的，你并没有那么有帮助（提供源代码会非常有用！）但是你去......一些事情要检查：

代码是这样的吗：

```
<link rel="icon" href="http://www.example.com/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="http://www.example.com/favicon.ico" type="image/x-icon" /> 
```

是在`<head>`吗？

图片是*真实的*ico文件吗？（重命名位图不是真正的 .ico！格式略有不同）

将页面添加为书签时是否有效？

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-09-11T16:08:48.000

在 IE 和 FireFox 中，favicon.ico 仅在站点上访问的第一个页面上被请求，这意味着如果 favicon.ico 需要登录（例如，您的站点是一个封闭站点并且需要登录），那么图标不会显示。

解决方案是为 favicon.ico 添加一个例外，例如在 ASP.Net 中您在 web.config 中添加：

```
<location path="favicon.ico">
  <system.web>
     <authorization>
       <allow users="*" />
     </authorization>
  </system.web>
</location> 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-08-22T05:51:30.110

```
 <link rel="shortcut icon" type="image/x-icon" href="FolderName/favicon.ico" /> 
```

1.  您的 favicon.ico 必须放在**head**标签之间
2.  尺寸：16 X 16
3.  **对于 Internet Explorer，它必须是透明的（外部白色部分不可见）**

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-07-18T09:23:04.587

如果有人回答这个问题：

同样的问题：在 IE（包括 IE 10）中不起作用，在其他任何地方都起作用。

原来该文件不是“真正的” .ico 文件。我通过将其上传到[http://www.favicon.cc/](http://www.favicon.cc/)然后再次下载来解决此问题。

首先，我通过在这个站点上生成一个随机的 .ico 文件并使用它而不是我的原始文件来测试它。看到它起作用了。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-23T16:28:30.013

您是否尝试将图标放在 URI " `/favicon.ico`" 中？IE 可能不知道引用它的链接标记方式。

[来自 W3](http://www.w3.org/2005/10/howto-favicon)的更多信息。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-08-18T15:15:12.357

如果您尝试了以上所有方法，但在 IE 中仍然无法使用，请检查您的 IIS 设置（如果您使用的是 Windows Server）。确保 HTTP 标头 >“启用内容过期”设置，未设置为“立即过期”

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-07-10T22:58:55.987

我知道这是一个非常古老的话题，但由于它是我的谷歌搜索中出现的第一个话题，我只想添加我的解决方案：

客户提供的图标也有这个问题。它显示在除 IE 之外的所有浏览器中。添加`link`or`meta`标签不起作用，所以我开始查看图标文件的格式。
它似乎是一个有效的图标文件（不仅仅是重命名的图像），但最终修复它的是**将其转换为图像，将其保存为 GIF，然后将其转换回图标**。
还要确保在测试时清除 IE 缓存。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-01-09T15:07:33.863

我遇到了这个确切的问题，但似乎没有任何效果。在无数次清除浏览器缓存甚至将 IE 更新到 v9 之后，我发现了这个： http: [//favicon.htmlkit.com/favicon/](http://favicon.htmlkit.com/favicon/)

上面的链接完美地为我解决了这个问题！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-04-15T10:43:33.637

以上解决方案都不适合我。

首先，我使用网站创建上面建议的图标，确保图标格式正确。

然后我将图标从“favicon.ico”重命名为“myicon.ico”，并将以下代码添加到我的页面（在`<head>`标签内）：

```
<link rel="shortcut icon" href="myicon.ico" type="image/x-icon" /> 
```

该图标与页面位于同一文件夹中。

这为我解决了这个问题。幕后的问题可能与 IE 的缓存有关，但我不确定。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T16:27:17.163

愿意分享网址吗？许多浏览器处理（例如）png 格式的网站图标，而 IE 经常遇到麻烦。- 旧版本的 IE 也不会检查 html 源以获取 favicon 的位置，而只是一心一意地尝试从网络服务器获取“/favicon.ico”。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T16:30:18.403

我曾经使用 PNG 作为 favicon.ico，它显示在除 IE 之外的所有浏览器中。也许文件中的某些内容导致 IE 无法识别它。还要确保它是 32x32。不知道这是否重要。但这是我必须确保在 IE 中看到它的东西。

希望能帮助到你。尝试使用其他地方的 ico 文件，看看是否有效。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-11-08T19:50:25.207

这似乎是一个 ASPX 页面问题，我从来没有能够在 IE 的任何页面中显示图标（所有其他页面是 Chrome、FF 和 safari）我见过的唯一例外的网站是 bing .com、msdn.com 和其他属于 MS 并在 asp.net 上运行的文件，有些事情他们没有告诉我们！即使是世界知名的网站也无法在 IE 中显示，例如：manu.com（世界上浏览量最大的运动队）aspx 网站，并且无法在 IE 上显示 favicon。[http://www.manutd.com/favicon.ico](http://www.manutd.com/favicon.ico)确实显示了图标。

请证明我错了。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-03-26T10:34:14.130

解决方案 ：

*   我通过简单地将图像的扩展名从 png 更改为 ico，从现有的 png 文件创建了一个图标。我使用 drupal 7 bartik 主题，所以我将快捷方式图标上传到服务器，它适用于 Chrome 和 Firefox，但不适用于 IE。此外，图像图标在桌面上是空白的。

*   然后我在这里听取了一些人的建议，并使用图像编辑器将图像的大小减小到 32x32 像素（gimp 2<<

*   我以与之前相同的方式上传了图标，它适用于所有浏览器。

我爱你们在 stackoverflow 上，你们帮我解决了很多问题。谢谢你！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-05-07T13:29:07.213

感谢您的所有帮助。我尝试了不同的选项，但以下选项对我有用。

```
<link rel="shortcut icon" href="/favicon.ico" >
<link rel="icon" type="/image/ico"  href="/favicon.ico" > 
```

我在页面的标题中添加了上述两行，它适用于所有浏览器。

谢谢

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-07-12T09:10:40.213

可能这有助于其他人。

对我来说，即使按照所有步骤操作，ICON 也没有显示在 IE 中。

最后我在 MSDN [Troubleshooting Shortcut Icons](http://msdn.microsoft.com/en-us/library/ms537656%28v=vs.85%29.aspx#Troubleshooting_Shortcut_Icons)中找到了一条注释。

> 验证 Internet Explorer 是否可以将快捷方式图标存储在 Temporary Internet Files 文件夹中。如果您已将 Internet Explorer 设置为不保留缓存，则它将无法存储图标，而是显示默认的 Internet Explorer 快捷方式图标。

在正常模式下验证后，我在“私人”模式下使用 IE.... 收藏图标正确显示。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-01-19T09:14:42.773

关于与 IE9 的不兼容性，我看到了[这篇](http://www.adam-bertrand.com/blog/2011/04/hello-world/)博客文章，其中提供了创建 IE9 识别的网站图标的提示。

本质上，尝试使用以下站点创建一个网站图标：[http ://www.xiconeditor.com/](http://www.xiconeditor.com/)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-07-31T13:32:37.063

检查您的网站图标的响应标头。它们不得包含“Cache-Control: no-cache”。

您可以使用以下命令从命令行检查：

```
curl -I http://example.com/favicon.ico 
```

或者

```
wget --server-response --spider http://example.com/favicon.ico 
```

（或使用其他一些工具来显示响应头）

如果您在那里看到“Cache-Control: no-cache”，请调整您的服务器配置以从网站图标响应中删除该标头或设置 max-age。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-02-15T21:32:40.620

此外 - 证书错误 (https) 可能会阻止网站图标出现。安全团队更改了我们的服务器设置，我开始收到“此网站的安全证书有问题”。单击“继续访问此网站（不推荐）”。带我到网站，但不会显示网站图标。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-04-11T20:51:56.180

我看到 Windows 10 和 Windows Server 2016 之间以及 IE 和 Edge 之间的不同行为。我使用 www.microsoft.com 进行了测试。

Windows Server 2016 IE 11：
收藏夹：站点图标
地址栏：站点图标
浏览器选项卡：站点图标

Windows 10 IE 11：
收藏夹：站点图标
地址栏：通用蓝色-E 图标
浏览器选项卡：通用蓝色-E 图标

Windows 10 Edge：
收藏夹：站点图标
地址栏：无图标
浏览器选项卡：站点图标

显示通用图标的 Windows 10 IE 是怎么回事？

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-03-06T13:40:56.333

我的这个工作跨浏览器（IE11、EDGE、CHROME、FIREFOX、OPERA），使用[https://www.icoconverter.com/](https://www.icoconverter.com/)创建 .ico 文件

```
<link data-senna-track="temporary" href="${favicon_url}" rel="Shortcut Icon" />
<link rel="icon" href="${favicon_url}" type="image/x-icon" />
<link rel="shortcut icon" href="${favicon_url}" type="image/x-icon" /> 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-08-15T05:47:38.833

尝试类似：

添加到html：

```
 <link id="shortcutIcon" rel="shortcut icon" type="image/x-icon">
  <link id="icon" rel="icon" type="image/x-icon"> 
```

在标记后添加缩小脚本：

```
<script type="text/javascript">
(function(b,c,d,a){a=c+d+b,document.getElementById('shortcutIcon').href=a,document.getElementById('icon').href=a;}(Math.random()*100,(document.querySelector('base')||{}).href,'/assets/images/favicon.ico?v='));
</script> 
```

在哪里

*   '/assets/images/favicon.ico' .ico 的相关路径
*   ?v='Math.random()*100' - 强制浏览器更新 favicon.ico

测试前清除历史记录：（ctr + shfit + del）

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2016-03-03T06:35:30.327

以管理员身份运行 Internet Explorer。如果您在正常模式下打开 IE，则 favicon 将不会显示在 IE 11 (Win 7) 上。我不确定其他版本的浏览器上的行为。

# sql - sql查询确定状态？

> ID：122088
> 
> 赞同：3
> 
> 时间：2008-09-23T16:23:54.673
> 
> 标签：sql, sql-server

我在 MSSQL 数据库中有一个如下所示的表：

```
Timestamp (datetime)
Message (varchar(20)) 
```

每天一次，一个特定的进程会在它开始时插入当前时间和消息“已启动”。完成后，它会插入当前时间和消息“完成”。

什么是一个好的查询或一组语句，给定特定日期，返回：

*   0 如果进程从未启动
*   1 如果进程已开始但未完成
*   2 如果进程开始和结束

表中还有其他消息，但“已开始”和“已完成”对于这一过程是唯一的。

编辑：对于奖励业力，如果数据无效，则引发错误，例如有两个“已启动”消息，或者有一个“已完成”而没有“已启动”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T16:28:48.267

```
Select Count(Message) As Status
From   Process_monitor
Where  TimeStamp >= '20080923'
       And TimeStamp < '20080924'
       And (Message = 'Started' or Message = 'Finished') 
```

您可以稍微修改它以检测无效条件，例如多次启动、完成、没有完成的启动等...

```
Select  Case When SumStarted = 0 And SumFinished = 0 Then 'Not Started'
             When SumStarted = 1 And SumFinished = 0 Then 'Started'
             When SumStarted = 1 And SumFinished = 1 Then 'Finished'
             When SumStarted > 1 Then 'Multiple Starts' 
             When SumFinished > 1 Then 'Multiple Finish'
             When SumFinished > 0 And SumStarted = 0 Then 'Finish Without Start'
             End As StatusMessage
From    (
          Select Sum(Case When Message = 'Started' Then 1 Else 0 End) As SumStarted,
                 Sum(Case When Message = 'Finished' Then 1 Else 0 End) As SumFinished
          From   Process_monitor
          Where  TimeStamp >= '20080923'
                 And TimeStamp < '20080924'
                 And (Message = 'Started' or Message = 'Finished')
        ) As AliasName 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T16:31:43.203

```
DECLARE @TargetDate datetime
SET @TargetDate = '2008-01-01'

DECLARE @Messages varchar(max)

SET @Messages = ''

SELECT @Messages = @Messages + '|' + Message
FROM process_monitor
WHERE @TargetDate <= Timestamp and Timestamp < DateAdd(dd, 1, @TargetDate)
   and Message in ('Finished', 'Started')
ORDER BY Timestamp desc

SELECT CASE
  WHEN @Messages = '|Finished|Started' THEN 2
  WHEN @Messages = '|Started' THEN 1
  WHEN @Messages = '' THEN 0
  ELSE -1
END 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T16:48:59.967

您缺少唯一标识该过程的列。让我们添加一个名为 ProcessID 的 int 列。您还需要另一个表来识别进程。如果您依赖原始表，您将永远不会知道从未启动的进程，因为该进程不会有任何行。

```
select
    ProcessID,
    ProcessName,

    CASE
    WHEN 
       (Select 
           COUNT(*) 
        from 
           ProcessActivity 
        where 
           ProcessActivity.processid = Processes.processid 
           and Message = 'STARTED') = 1 

        And
       (Select 
           COUNT(*) 
        from 
           ProcessActivity 
        where 
           ProcessActivity.processid = Processes.processid 
           and Message = 'FINISHED') = 0
     THEN 1

     WHEN
       (Select 
           COUNT(*) 
        from 
           ProcessActivity 
        where 
           ProcessActivity.processid = Processes.processid 
           and Message = 'STARTED') = 1 
       And
       (Select 
           COUNT(*) 
        from 
           ProcessActivity 
        where 
           ProcessActivity.processid = Processes.processid 
           and Message = 'FINISHED') = 1 
THEN 2
     ELSE 0

END as Status

From
    Processes 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-23T16:31:47.743

```
select count(*) from process_monitor 
where timestamp > yesterday and timestamp < tomorrow. 
```

或者，您可以使用带最大值的自连接来显示特定日期的最新消息：

```
select * from process_monitor where 
timestamp=(select max(timestamp) where timestamp<next_day); 
```

# xml - Xsd to rnc (or rng) conversion (unix command line)

> ID：122089
> 
> 赞同：11
> 
> 时间：2008-09-23T16:24:05.970
> 
> 标签：xml, unix, xsd

A brief search shows that all available (uUnix command line) tools that convert from xsd (XML Schema) to rng (RelaxNG) or rnc (compact RelaxNG) have problems of some sort.

First, if I use rngconv:

```
$ wget https://msv.dev.java.net/files/documents/61/31333/rngconv.20060319.zip
$ unzip rngconv.20060319.zip
$ cd rngconv-20060319/
$ java -jar rngconv.jar my.xsd  > my.rng 
```

It does not have a way to de-normalize elements so all end up being alternative start elements (it also seems to be a bit buggy).

Trang is an alternative, but it doesn't support xsd files on the input only on the output (why?). It supports DTD, however. Converting to DTD first comes to mind, but a solid xsd2dtd is hard to find as well. The one below:

```
 $ xsltproc http://crism.maden.org/consulting/pub/xsl/xsd2dtd.xsl in.xsd > out.dtd 
```

Seems to be buggy.

All this is very surprising. For all these years of XML (ab)use, there no decent command line tools for these trivial basic tasks? Are people using only editors? Do those work? I much prefer command line, especially because I'd like to automate these tasks.

Any enlightening comments on this?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T17:25:11.687

转换 XSD 是一项非常艰巨的任务；XSD 规范有点像噩梦，而且极其复杂。从一些快速[研究](http://www.tbray.org/ongoing/When/200x/2006/11/27/Choose-Relax)来看，从 RelaxNG 到 XSD 似乎很容易，但反过来可能不是真的，甚至是不可能的（这解释了你关于 Trang 的问题）。

我不明白你关于编辑器的问题——如果你问的是大多数人最终是否会手动在 XSD 和 RNG 之间进行转换，那么是的，我希望如此。

最好的建议可能是尽可能避免使用 XSD，或者至少使用 RNG 作为最终文档并从中生成 XSD。您可能还想看看[schematron](http://www.schematron.com/)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-07T21:56:31.687

没错，trang 在输入端不接受 xsd。然而， Trang**可以**获取一组应该符合规范的 xml 文件并生成一个 rnc 或 rng 模式，它们都将对其有效。

缺点：

*   它需要许多兼容的 xml 文件（我想越多越好）
*   生成的架构可能仍需要进行一些调整。

**示例案例：**

如果我的兼容 xml 文件隐藏在`1.xml 2.xml 3.xml 4.xml 5.xml`

以下命令将告诉 trang 输出一个对所有这些都有效的 rnc 模式：

```
java -jar trang.jar -I xml -O rnc 1.xml 2.xml 3.xml 4.xml 5.xml foo.rnc 
```

**结论**

如果您有一个很好的 xml 文件测试集满足您的架构（或者您可以轻松创建它们），这可能是最好的选择。

祝你好运。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-02-20T12:12:18.330

有一个在线转换器 ( [XSD -> RNG](http://debeissat.nicolas.free.fr/XSDtoRNG.php) ) 添加到列表中`http://relaxng.org/#conversion`。我试图转换 maven-v4_0_0.xsd 以验证 emacs 中的 pom.xml 文件，但没有任何运气。该站点还包含您可以使用的 XSL 样式表，但`xsltproc`不能保证结果的质量......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:23:57.723

再次，关于编辑：我看到没有办法用 Oxygen 来做到这一点，这似乎是一种流行的工具。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-27T12:24:15.743

另一种可能性可能是[http://www.brics.dk/schematools/](http://www.brics.dk/schematools/)，但我还没有尝试过。

# apache - Apache Mod 重写入门？

> ID：122097
> 
> 赞同：14
> 
> 时间：2008-09-23T16:25:28.757
> 
> 标签：apache, .htaccess, mod-rewrite

我想知道什么引物/指南/教程/等。在那里学习使用 Apache/.htaccess 重写 URL？从哪里开始是个好地方？

我的主要兴趣是学习如何将某些目录指向其他目录，以及如何使用 URL 的某些部分作为脚本的参数（即 "/some/subdirs/like/this" => "script.php?a=some&b=subdirs&c =喜欢&d=这个”）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T16:27:06.820

我发现这非常有用： http: [//www.addedbytes.com/apache/url-rewriting-for-beginners/](http://www.addedbytes.com/apache/url-rewriting-for-beginners/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T16:35:57.343

我会直奔马嘴：

[http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)

但作为一个温和的介绍：

[http://www.workingwith.me.uk/articles/scripting/mod_rewrite](http://www.workingwith.me.uk/articles/scripting/mod_rewrite)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T16:35:17.067

[Apache 文档站点](http://httpd.apache.org/docs/2.2/rewrite/rewrite_intro.html)对使用 mod_rewrite 有很好的介绍。

它涵盖了指令的工作原理，并有很多示例，例如：

```
RewriteRule ^/games.* /usr/local/games/web
RewriteRule ^/product/(.*)/view$ /var/web/productdb/$1 
```

它涵盖了从用于更改 URI 的基本 sytanx （这似乎是您所问的）以及使用正则表达式、条件和响应重定向的所有内容。

apache 文档对我一直很有用。O'Reilly 的[Apache: The Definitive Guide](http://oreilly.com/catalog/9780596002039/)也是一个很好的物理资源。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T16:32:09.570

[手册](http://httpd.apache.org/docs/2.2/rewrite/rewrite_intro.html)有什么问题？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T16:38:08.447

Apache 手册有很多例子。

*   [URL重写指南](http://httpd.apache.org/docs/2.2/rewrite/rewrite_guide.html)
*   [URL 重写指南 - 高级主题](http://httpd.apache.org/docs/2.2/rewrite/rewrite_guide_advanced.html)

# gwt - 参数化 GWT 应用程序的最佳实践？

> ID：122098
> 
> 赞同：6
> 
> 时间：2008-09-23T16:25:39.443
> 
> 标签：gwt

我有一个 Google Web Toolkit (GWT) 应用程序，当我链接到它时，我想传递一些可用于动态检索数据的参数/参数。例如，如果它是一个股票图表应用程序，我希望我的链接包含该符号，然后让 GWT 应用程序读取它并向某些股票服务发出请求。例如[，http://myapp/gwt/StockChart?symbol=GOOG](http://myapp/gwt/StockChart?symbol=GOOG)将是我的 StockChart GWT 应用程序的链接，它会向我的股票信息 Web 服务请求 GOOG 股票。

到目前为止，我一直在使用服务器端代码向页面添加 Javascript 变量，然后我使用 JSNI（JavaScript Native Interface）读取了这些变量。

例如：

在主机 HTML 中：

```
<script type="text/javascript">
  var stockSymbol = '<%= request.getParameter("symbol") %>';
</script> 
```

在 GWT 代码中：

```
public static native String getSymbol() /*-{
    return $wnd.stockSymbol;
}-*/; 
```

（尽管此代码基于有效的真实代码，但我已针对此问题对其进行了修改，因此我可能在某处犯了错误）

但是，这在托管模式下并不总是有效（尤其是数组），并且由于 JSNI 在 1.4 版和之前的版本中不存在，我猜还有另一种/更好的方法。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T18:29:01.677

如果要从请求中读取查询字符串参数，可以使用**com.google.gwt.user.client.Window**类：

```
// returns whole query string 
public static String getQueryString() 
{
    return Window.Location.getQueryString();
}

// returns specific parameter
public static String getQueryString(String name)
{   
    return Window.Location.getParameter(name);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-23T21:26:21.113

使用哈希值“参数化”GWT 应用程序也是一个不错的选择。

所以，而不是

```
 http://myapp/gwt/StockChart?symbol=GOOG 
```

采用

```
 http://myapp/gwt/StockChart#symbol=GOOG 
```

[通过GWT 的 History Mechanism](https://developers.google.com/web-toolkit/doc/latest/DevGuideCodingBasicsHistory)对这些“参数”有一些很好的工具支持。

# user-interface - 你会推荐什么 GUI 框架

> ID：122099
> 
> 赞同：1
> 
> 时间：2008-09-23T16:25:46.730
> 
> 标签：user-interface, frameworks

管理层希望我们转向基础设施。但是我的老板说任何第三者都注定要失败，到那时我们将无能为力。

他是对的还是错的？我不知道。

您的意见是什么，是使用公司内部开发的东西更好，还是您更喜欢 DevExpress、Infragistics、Krypton 之类的东西，还是您会推荐其他更好的东西？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T17:18:38.023

购买 3rd 方控件时，寻找购买源代码的选项（以合理的价格）。使用源代码，您应该能够对组件进行任何必要的更改，以使它们在您的环境中运行良好。

来自 Component Factory 的 Krypton Suite 控件就是这样做的。Phil 以惊人的价格（目前不到 400 美元）提供了整个套件的源代码。我已经在我的开发中使用 Krypton Suite 一年了，我对它非常满意。Krypton 使我能够创建具有 Office 2007 UI 外观和感觉的收缩包装软件，其一致性远远超过我尝试过的任何其他工具包。Phil 在支持论坛中也非常活跃，并为您提供软件开发路径的直接链接。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T16:37:27.560

**.NET3.5 SP1**非常成熟，可以进行**ASP.NET**和独立 UI 开发（**WPF 和 Silverlight**）。您选择第三方组件和框架的主要标准是什么。如果您只需要一些图表或任何其他金融领域的工具和控制，是的，您需要考虑第三方组件以加快周转速度。除此之外，我会看到 .NET 框架本身具有丰富的库来完成大部分工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T16:31:34.813

我不认为依赖第三方是完全坏的。有些人非常有信誉，会很好地支持你。但另一方面，有些人即使继续经营也很糟糕。不过，我对您提到的框架一无所知。

你考虑过开源框架吗？这样，如果其他所有方法都失败了，您仍然可以自己处理它。当然，在执行此操作时您必须考虑许可要求，但我认为如果它适合该项目，您绝对应该考虑它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T16:33:25.027

只要您可以访问该库的源代码并且能够对其进行修改并分发修改后的库而无需支付任何版税，那么您老板的担心是没有根据的。

我自己会选择 DevExpress，但与其他框架相比，它们相当昂贵。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T16:36:56.453

我认为您老板的担忧可以更好地表述为“有一天，我们将需要以需要修改其来源的方式更改第三方控制。” 根据第三方控件附带的许可证，这可能会变得棘手。对于 UI 控件之类的东西，根据我的经验，.NET 可以很容易地制作任何你需要的东西。

也许作为解决辩论的一种方式，您可以提议淘汰您需要借用的任何控件的快速原型。这将使您了解 (a) 是否需要第三方库，以及 (b) 如果您选择朝这个方向发展，您对第三方库有什么要求。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T16:40:13.323

使用 3rd 方控件时要计划的重要事项是连续性。如果他们真的破产了，那对你意味着什么？您在多大程度上依赖他们的框架，以及切换到其他框架需要做多少工作？还有其他东西可以满足您的需要吗？

如果你有相关组件的源代码，它会让你处于一个更好的位置——你至少可以修复错误，甚至可以自己维护/扩展它。另一方面是严格控制的软件，你必须每年更新，如果你不更新，它就会过期。如果你正在使用这样的东西，如果他们陷入困境，它会迫使你的手，你将*不得不*做*一些事情*。

这真的是一个平衡的行为。节省您的工作/金钱与他们消失的可能性与依靠第三者的可能性。

我曾经有一个和你一样的老板。他们想念的是你完全依赖第三者。如果您使用的是 .NET，那么您相信 Microsoft 不会倒闭（可能不会..）、停止使用它（也许）或彻底改变它（很有可能）。当然他现在已经走了，我们已经开始使用一些第三方控件（一些开源），这些控件为我们节省了数百小时的开发时间，或者只是让我们做一些我们永远不会做的功能（因为它会花费太长时间）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T16:50:25.967

如果您的公司制作 UI，那么一定要在内部开发和维护您的控件。如果这不是您的主要业务目标，您应该找到一个提供控件源代码的代码供应商（devexpress，telerik...）并且当您实现这些控件时，给您自己一个抽象层，以便更简单地切换供应商在将来。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T18:19:23.023

非常感谢您的见解。我自己用过氪，但只有免费的部分。我认为这更像是“我们希望它看起来很光滑”。我同意我的老板对使用 3rd 方控件的担忧，但我也同意你们的观点，即专注于任务比提供看起来不错的控件要好得多。

当经理说使用 Infragistics 是一个坏主意时，经理向我的老板提出的问题是“但是你能在合理的时间内做类似的事情吗？”。答案显然是“不”。

我会尝试建议 Krypton Toolkit，正如我之前所说，我过去曾使用过它，但我确实遇到了一些麻烦。我认为数据网格是问题的主要焦点，因为大多数工具包都有自定义外观的选项。

Again, thanks so much for your answers.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-13T14:28:05.733

I think when you buy third party controls you should think about the value you receive for the money you pay. There are dinosaur vendors like Telerik, Syncfusion, DevExpress, Infragistics which offer GUI with good quality and support, but they are not very cheap, because the brand costs money. There are other great WinForms suites coming from a small vendors such as ComponentFactory, DevComponents, VIBlend, Nevron which offer a good looking controls for WinForms in Office2007 style but much cheaper.

# javascript - 在 JavaScript 中深度克隆对象的最有效方法是什么？

> ID：122102
> 
> 赞同：5173
> 
> 时间：2008-09-23T16:26:09.163
> 
> 标签：javascript, object, clone

克隆 JavaScript 对象的最有效方法是什么？我见过`obj = eval(uneval(o));`被使用，但这[是非标准的，仅受 Firefox 支持](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/uneval)。

我做过类似`obj = JSON.parse(JSON.stringify(o));`但质疑效率的事情。

我还看到了具有各种缺陷的递归复制函数。
我很惊讶不存在规范的解决方案。

* * *

## 回答 #1

> 赞同：5387
> 
> 时间：2008-09-23T18:09:37.277

# 本机深度克隆

现在有一个称为[“结构化克隆”](https://developer.mozilla.org/en-US/docs/Web/API/structuredClone)的 JS 标准，它在 Node 11 及更高版本中实验性地工作，将登陆浏览器，并[为现有系统提供 polyfill](https://www.npmjs.com/package/@ungap/structured-clone)。

```
structuredClone(value) 
```

如果需要，首先加载 polyfill：

```
import structuredClone from '@ungap/structured-clone'; 
```

有关更多详细信息，请参阅[此答案](https://stackoverflow.com/questions/122102/what-is-the-most-efficient-way-to-deep-clone-an-object-in-javascript/10916838#10916838)。

# 较早的答案

## 快速克隆数据丢失 - JSON.parse/stringify

如果您在对象中不使用`Date`s、函数`undefined`、、、、`Infinity`RegExps、Maps、Sets、Blob、FileLists、ImageDatas、稀疏数组、类型化数组或其他复杂类型，那么一个非常简单的深度克隆对象的方法是：

`JSON.parse(JSON.stringify(object))`

```
const a = {
  string: 'string',
  number: 123,
  bool: false,
  nul: null,
  date: new Date(),  // stringified
  undef: undefined,  // lost
  inf: Infinity,  // forced to 'null'
  re: /.*/,  // lost
}
console.log(a);
console.log(typeof a.date);  // Date object
const clone = JSON.parse(JSON.stringify(a));
console.log(clone);
console.log(typeof clone.date);  // result of .toISOString()
```

有关基准，请参阅[Corban 的答案](https://stackoverflow.com/questions/122102/what-is-the-most-efficient-way-to-deep-clone-an-object-in-javascript/5344074#5344074)。

## 使用库进行可靠克隆

由于克隆对象并非易事（复杂类型、循环引用、函数等），大多数主要库都提供了克隆对象的函数。**不要重新发明轮子**- 如果您已经在使用库，请检查它是否具有对象克隆功能。例如，

*   lodash - [`cloneDeep`](https://lodash.com/docs#cloneDeep); [可以通过lodash.clonedeep](https://www.npmjs.com/package/lodash.clonedeep)模块单独导入，如果您还没有使用提供深度克隆功能的库，这可能是您的最佳选择
*   AngularJS -[`angular.copy`](https://docs.angularjs.org/api/ng/function/angular.copy)
*   jQuery - [`jQuery.extend(true, { }, oldObject)`](https://api.jquery.com/jquery.extend/#jQuery-extend-deep-target-object1-objectN); `.clone()`只克隆 DOM 元素
*   只是图书馆 - [`just-clone`](https://www.npmjs.com/package/just-clone); 零依赖 npm 模块库的一部分，它只做一件事。适合各种场合的无罪实用程序。

## ES6（*浅*拷贝）

为了完整起见，请注意 ES6 提供了两种浅拷贝机制：[`Object.assign()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)和[扩展语法](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax)。它将所有可枚举自身属性的值从一个对象复制到另一个对象。例如：

```
var A1 = {a: "2"};
var A2 = Object.assign({}, A1);
var A3 = {...A1};  // Spread Syntax 
```

* * *

## 回答 #2

> 赞同：2401
> 
> 时间：2011-03-17T19:19:55.880

查看此基准：http: [//jsben.ch/#/bWfk9](http://jsben.ch/#/bWfk9)

在我之前的测试中，我发现速度是主要问题

```
JSON.parse(JSON.stringify(obj)) 
```

成为深度克隆对象的最慢方法（它比标志设置为 true 的[jQuery.extend](https://api.jquery.com/jQuery.extend/)`deep`慢10-20%）。

`deep`当标志设置为`false`（浅克隆）时，jQuery.extend 非常快。这是一个不错的选择，因为它包含一些用于类型验证的额外逻辑，并且不会复制未定义的属性等，但这也会让你慢一点。

如果你知道你试图克隆的对象的结构或者可以避免深度嵌套数组，你可以编写一个简单的`for (var i in obj)`循环来克隆你的对象，同时检查 hasOwnProperty，它会比 jQuery 快得多。

最后，如果您尝试在热循环中克隆已知对象结构，您可以通过简单地内联克隆过程并手动构造对象来获得更多性能。

JavaScript 跟踪引擎在优化`for..in`循环方面很糟糕，检查 hasOwnProperty 也会减慢你的速度。当速度是绝对必须的时候手动克隆。

```
var clonedObject = {
  knownProp: obj.knownProp,
  ..
} 
```

当心在对象上使用该`JSON.parse(JSON.stringify(obj))`方法-返回 ISO 格式的日期字符串表示，它**不会**转换回对象。[有关更多详细信息，请参阅此答案](https://stackoverflow.com/questions/11491938/issues-with-date-when-using-json-stringify-and-json-parse/11491993#11491993)。`Date``JSON.stringify(new Date())``JSON.parse()` **`Date`**

 **此外，请注意，至少在 Chrome 65 中，本机克隆不是可行的方法。根据 JSPerf 的说法，通过创建新函数执行本机克隆比使用 JSON.stringify 慢近**800 倍**，而 JSON.stringify 的速度非常快。

**[ES6 更新](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)**

如果您使用的是 Javascript ES6，请尝试使用本机方法进行克隆或浅拷贝。

```
Object.assign({}, obj); 
```

* * *

## 回答 #3

> 赞同：545
> 
> 时间：2012-06-06T14:59:04.077

# 结构化克隆

**2022 年更新：**全局[`structuredClone`功能](https://developer.mozilla.org/en-US/docs/Web/API/structuredClone)已在 Firefox 94、Node 17 和 Deno 1.14 中可用

HTML 标准包括[**一个内部结构化克隆/序列化算法**](https://html.spec.whatwg.org/multipage/structured-data.html#safe-passing-of-structured-data)，可以创建对象的深层克隆。它仍然仅限于某些内置类型，但除了 JSON 支持的少数类型之外，它还支持 Dates、RegExps、Maps、Sets、Blobs、FileLists、ImageDatas、稀疏数组、类型化数组，未来可能还会支持更多. 它还保留克隆数据中的引用，允许它支持会导致 JSON 错误的循环和递归结构。

## Node.js 中的支持：

[`structuredClone`全局函数](https://developer.mozilla.org/en-US/docs/Web/API/structuredClone)由Node 17.0 提供：

```
const clone = structuredClone(original); 
```

以前的版本：`v8`Node.js 中的模块（从 Node 11 开始）[直接公开结构化序列化 API](https://nodejs.org/api/all.html#v8_serialization_api)，但此功能仍被标记为“实验性”，并且在未来版本中可能会更改或删除。如果您使用的是兼容版本，则克隆对象非常简单：

```
const v8 = require('v8');

const structuredClone = obj => {
  return v8.deserialize(v8.serialize(obj));
}; 
```

## 浏览器中的直接支持：在 Firefox 94 中可用

所有主流浏览器都将很快提供[`structuredClone`全局功能](https://developer.mozilla.org/en-US/docs/Web/API/structuredClone)（之前已[在 GitHub 上的 whatwg/html#793 中](https://github.com/whatwg/html/issues/793)讨论过）。它看起来/看起来像这样：

```
const clone = structuredClone(original); 
```

在发布之前，浏览器的结构化克隆实现只是间接公开。

## 异步解决方法：可用。

[使用现有 API 创建结构化克隆的开销较低的方法是通过MessageChannels](https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel)的一个端口发布数据。另一个端口将发出`message`带有附加的结构化克隆的事件`.data`。不幸的是，监听这些事件必然是异步的，同步的替代方案不太实用。

```
class StructuredCloner {
  constructor() {
    this.pendingClones_ = new Map();
    this.nextKey_ = 0;

    const channel = new MessageChannel();
    this.inPort_ = channel.port1;
    this.outPort_ = channel.port2;

    this.outPort_.onmessage = ({data: {key, value}}) => {
      const resolve = this.pendingClones_.get(key);
      resolve(value);
      this.pendingClones_.delete(key);
    };
    this.outPort_.start();
  }

  cloneAsync(value) {
    return new Promise(resolve => {
      const key = this.nextKey_++;
      this.pendingClones_.set(key, resolve);
      this.inPort_.postMessage({key, value});
    });
  }
}

const structuredCloneAsync = window.structuredCloneAsync =
    StructuredCloner.prototype.cloneAsync.bind(new StructuredCloner); 
```

### 使用示例：

```
const main = async () => {
  const original = { date: new Date(), number: Math.random() };
  original.self = original;

  const clone = await structuredCloneAsync(original);

  // They're different objects:
  console.assert(original !== clone);
  console.assert(original.date !== clone.date);

  // They're cyclical:
  console.assert(original.self === original);
  console.assert(clone.self === clone);

  // They contain equivalent values:
  console.assert(original.number === clone.number);
  console.assert(Number(original.date) === Number(clone.date));

  console.log("Assertions complete.");
};

main(); 
```

## 同步解决方法：太糟糕了！

同步创建结构化克隆没有好的选择。这里有一些不切实际的技巧。

`history.pushState()`并且`history.replaceState()`都创建了第一个参数的结构化克隆，并将该值分配给`history.state`. 您可以使用它来创建任何对象的结构化克隆，如下所示：

```
const structuredClone = obj => {
  const oldState = history.state;
  history.replaceState(obj, null);
  const clonedObj = history.state;
  history.replaceState(oldState, null);
  return clonedObj;
}; 
```

### 使用示例：

```
'use strict';

const main = () => {
  const original = { date: new Date(), number: Math.random() };
  original.self = original;

  const clone = structuredClone(original);

  // They're different objects:
  console.assert(original !== clone);
  console.assert(original.date !== clone.date);

  // They're cyclical:
  console.assert(original.self === original);
  console.assert(clone.self === clone);

  // They contain equivalent values:
  console.assert(original.number === clone.number);
  console.assert(Number(original.date) === Number(clone.date));

  console.log("Assertions complete.");
};

const structuredClone = obj => {
  const oldState = history.state;
  history.replaceState(obj, null);
  const clonedObj = history.state;
  history.replaceState(oldState, null);
  return clonedObj;
};

main();
```

虽然是同步的，但这可能非常慢。它会产生与操作浏览器历史相关的所有开销。重复调用此方法可能会导致 Chrome 暂时无响应。

[`Notification`构造函数](https://developer.mozilla.org/en-US/docs/Web/API/Notification/Notification)创建其关联数据的结构化克隆。它还尝试向用户显示浏览器通知，但除非您请求通知权限，否则这将静默失败。如果您有其他用途的许可，我们将立即关闭我们创建的通知。

```
const structuredClone = obj => {
  const n = new Notification('', {data: obj, silent: true});
  n.onshow = n.close.bind(n);
  return n.data;
}; 
```

### 使用示例：

```
'use strict';

const main = () => {
  const original = { date: new Date(), number: Math.random() };
  original.self = original;

  const clone = structuredClone(original);

  // They're different objects:
  console.assert(original !== clone);
  console.assert(original.date !== clone.date);

  // They're cyclical:
  console.assert(original.self === original);
  console.assert(clone.self === clone);

  // They contain equivalent values:
  console.assert(original.number === clone.number);
  console.assert(Number(original.date) === Number(clone.date));

  console.log("Assertions complete.");
};

const structuredClone = obj => {
  const n = new Notification('', {data: obj, silent: true});
  n.close();
  return n.data;
};

main();
```

* * *

## 回答 #4

> 赞同：536
> 
> 时间：2011-01-04T08:05:55.877

假设您的对象中只有属性而没有任何函数，您可以使用：

```
var newObject = JSON.parse(JSON.stringify(oldObject)); 
```

* * *

## 回答 #5

> 赞同：359
> 
> 时间：2008-09-23T16:38:51.143

如果没有任何内置的，您可以尝试：

```
function clone(obj) {
    if (obj === null || typeof (obj) !== 'object' || 'isActiveClone' in obj)
        return obj;

    if (obj instanceof Date)
        var temp = new obj.constructor(); //or new Date(obj);
    else
        var temp = obj.constructor();

    for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) {
            obj['isActiveClone'] = null;
            temp[key] = clone(obj[key]);
            delete obj['isActiveClone'];
        }
    }
    return temp;
} 
```

* * *

## 回答 #6

> 赞同：161
> 
> 时间：2015-12-15T07:26:38.073

# 在一行代码中克隆（不是深度克隆）对象的有效方法

[`Object.assign`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)方法是 ECMAScript 2015 (ES6) 标准的一部分，完全符合您的需要。

```
var clone = Object.assign({}, obj); 
```

> Object.assign() 方法用于将所有可枚举自身属性的值从一个或多个源对象复制到目标对象。

[阅读更多...](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)

支持旧浏览器的**polyfill ：**

```
if (!Object.assign) {
  Object.defineProperty(Object, 'assign', {
    enumerable: false,
    configurable: true,
    writable: true,
    value: function(target) {
      'use strict';
      if (target === undefined || target === null) {
        throw new TypeError('Cannot convert first argument to object');
      }

      var to = Object(target);
      for (var i = 1; i < arguments.length; i++) {
        var nextSource = arguments[i];
        if (nextSource === undefined || nextSource === null) {
          continue;
        }
        nextSource = Object(nextSource);

        var keysArray = Object.keys(nextSource);
        for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {
          var nextKey = keysArray[nextIndex];
          var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);
          if (desc !== undefined && desc.enumerable) {
            to[nextKey] = nextSource[nextKey];
          }
        }
      }
      return to;
    }
  });
} 
```

* * *

## 回答 #7

> 赞同：114
> 
> 时间：2009-12-11T22:47:19.153

这就是我正在使用的：

```
function cloneObject(obj) {
    var clone = {};
    for(var i in obj) {
        if(typeof(obj[i])=="object" && obj[i] != null)
            clone[i] = cloneObject(obj[i]);
        else
            clone[i] = obj[i];
    }
    return clone;
} 
```

* * *

## 回答 #8

> 赞同：109
> 
> 时间：2009-06-25T07:53:06.533

代码：

```
// extends 'from' object with members from 'to'. If 'to' is null, a deep clone of 'from' is returned
function extend(from, to)
{
    if (from == null || typeof from != "object") return from;
    if (from.constructor != Object && from.constructor != Array) return from;
    if (from.constructor == Date || from.constructor == RegExp || from.constructor == Function ||
        from.constructor == String || from.constructor == Number || from.constructor == Boolean)
        return new from.constructor(from);

    to = to || new from.constructor();

    for (var name in from)
    {
        to[name] = typeof to[name] == "undefined" ? extend(from[name], null) : to[name];
    }

    return to;
} 
```

测试：

```
var obj =
{
    date: new Date(),
    func: function(q) { return 1 + q; },
    num: 123,
    text: "asdasd",
    array: [1, "asd"],
    regex: new RegExp(/aaa/i),
    subobj:
    {
        num: 234,
        text: "asdsaD"
    }
}

var clone = extend(obj); 
```

* * *

## 回答 #9

> 赞同：105
> 
> 时间：2014-09-18T20:10:38.237

**深度复制按性能：** 从最好到最差排名

*   扩展运算符`...`（原始数组 - 仅限）
*   `splice(0)`（原始数组 - 仅限）
*   `slice()`（原始数组 - 仅限）
*   `concat()`（原始数组 - 仅限）
*   自定义函数，如下所示（任何数组）
*   jQuery `$.extend()`（任何数组）
*   `JSON.parse(JSON.stringify())`（原始数组和文字数组 - 仅限）
*   下划线`_.clone()`（原始数组和文字数组 - 仅限）
*   Lodash `_.cloneDeep()`（任何数组）

在哪里：

*   原语 = 字符串、数字和布尔值
*   字面量 = 对象字面量`{}`，数组字面量`[]`
*   any = 原语、文字和原型

**深拷贝原语数组：**

```
let arr1a = [1, 'a', true]; 
```

要仅使用基元（即数字、字符串和布尔值）深度复制数组，可以使用重新分配`slice()`、、、`concat()`和下划线。`clone()`

传播速度最快的地方：

```
let arr1b = [...arr1a]; 
```

哪里`slice()`的性能比`concat()`：[https ://jsbench.me/x5ktn7o94d/](https://jsbench.me/x5ktn7o94d/)

```
let arr1c = arr1a.splice(0);
let arr1d = arr1a.slice();
let arr1e = arr1a.concat(); 
```

**深拷贝一组原始字面量和对象字面量：**

```
let arr2a = [1, 'a', true, {}, []];
let arr2b = JSON.parse(JSON.stringify(arr2a)); 
```

**深拷贝一组原始数组、对象字面量和原型：**

```
let arr3a = [1, 'a', true, {}, [], new Object()]; 
```

编写一个自定义函数（具有比`$.extend()`or更快的性能`JSON.parse`）：

```
function copy(aObject) {
  // Prevent undefined objects
  // if (!aObject) return aObject;

  let bObject = Array.isArray(aObject) ? [] : {};

  let value;
  for (const key in aObject) {

    // Prevent self-references to parent object
    // if (Object.is(aObject[key], aObject)) continue;

    value = aObject[key];

    bObject[key] = (typeof value === "object") ? copy(value) : value;
  }

  return bObject;
}

let arr3b = copy(arr3a); 
```

或使用第三方实用功能：

```
let arr3c = $.extend(true, [], arr3a); // jQuery Extend
let arr3d = _.cloneDeep(arr3a); // Lodash 
```

注意：jQuery 的`$.extend`性能也比`JSON.parse(JSON.stringify())`：

*   [js-深拷贝](https://jsbench.me/5kktn8f3ss)
*   [jquery-扩展-vs-json-parse](https://jsbench.me/imktn8ppco)

* * *

## 回答 #10

> 赞同：95
> 
> 时间：2018-08-08T08:17:31.580

**JavaScript 中的深拷贝对象（我认为最好也最简单）**

**1\. 使用 JSON.parse(JSON.stringify(object));**

```
var obj = { 
  a: 1,
  b: { 
    c: 2
  }
}
var newObj = JSON.parse(JSON.stringify(obj));
obj.b.c = 20;
console.log(obj); // { a: 1, b: { c: 20 } }
console.log(newObj); // { a: 1, b: { c: 2 } } 
```

**2.使用created方法**

```
function cloneObject(obj) {
    var clone = {};
    for(var i in obj) {
        if(obj[i] != null &&  typeof(obj[i])=="object")
            clone[i] = cloneObject(obj[i]);
        else
            clone[i] = obj[i];
    }
    return clone;
}

var obj = { 
  a: 1,
  b: { 
    c: 2
  }
}
var newObj = cloneObject(obj);
obj.b.c = 20;

console.log(obj); // { a: 1, b: { c: 20 } }
console.log(newObj); // { a: 1, b: { c: 2 } } 
```

**3\. 使用 Lo-Dash 的 _.cloneDeep**链接[lodash](https://lodash.com/docs/4.17.10#cloneDeep)

```
var obj = { 
  a: 1,
  b: { 
    c: 2
  }
}

var newObj = _.cloneDeep(obj);
obj.b.c = 20;
console.log(obj); // { a: 1, b: { c: 20 } }
console.log(newObj); // { a: 1, b: { c: 2 } } 
```

**4\. 使用 Object.assign() 方法**

```
var obj = { 
  a: 1,
  b: 2
}

var newObj = _.clone(obj);
obj.b = 20;
console.log(obj); // { a: 1, b: 20 }
console.log(newObj); // { a: 1, b: 2 } 
```

**但错误的时候**

```
var obj = { 
  a: 1,
  b: { 
    c: 2
  }
}

var newObj = Object.assign({}, obj);
obj.b.c = 20;
console.log(obj); // { a: 1, b: { c: 20 } }
console.log(newObj); // { a: 1, b: { c: 20 } } --> WRONG
// Note: Properties on the prototype chain and non-enumerable properties cannot be copied. 
```

**5.使用Underscore.js _.clone**链接[Underscore.js](https://underscorejs.org/#clone)

```
var obj = { 
  a: 1,
  b: 2
}

var newObj = _.clone(obj);
obj.b = 20;
console.log(obj); // { a: 1, b: 20 }
console.log(newObj); // { a: 1, b: 2 } 
```

**但错误的时候**

```
var obj = { 
  a: 1,
  b: { 
    c: 2
  }
}

var newObj = _.cloneDeep(obj);
obj.b.c = 20;
console.log(obj); // { a: 1, b: { c: 20 } }
console.log(newObj); // { a: 1, b: { c: 20 } } --> WRONG
// (Create a shallow-copied clone of the provided plain object. Any nested objects or arrays will be copied by reference, not duplicated.) 
```

**JSBEN.CH Performance Benchmarking Playground 1~3 [http://jsben.ch/KVQLd](http://jsben.ch/KVQLd)** [![性能在 JavaScript 中深度复制对象](https://i.stack.imgur.com/Assgk.png)](https://i.stack.imgur.com/Assgk.png)

* * *

## 回答 #11

> 赞同：74
> 
> 时间：2017-04-03T15:37:57.703

克隆一个对象在 JS 中一直是一个问题，但这都是在 ES6 之前的问题，我在下面列出了在 JavaScript 中复制对象的不同方法，假设你有下面的对象，并希望得到它的深层副本：

```
var obj = {a:1, b:2, c:3, d:4}; 
```

在不更改原点的情况下复制此对象的方法很少：

1.  ES5+，使用一个简单的函数为你做拷贝：

    ```
    function deepCopyObj(obj) {
        if (null == obj || "object" != typeof obj) return obj;
        if (obj instanceof Date) {
            var copy = new Date();
            copy.setTime(obj.getTime());
            return copy;
        }
        if (obj instanceof Array) {
            var copy = [];
            for (var i = 0, len = obj.length; i < len; i++) {
                copy[i] = deepCopyObj(obj[i]);
            }
            return copy;
        }
        if (obj instanceof Object) {
            var copy = {};
            for (var attr in obj) {
                if (obj.hasOwnProperty(attr)) copy[attr] = deepCopyObj(obj[attr]);
            }
            return copy;
        }
        throw new Error("Unable to copy obj this object.");
    } 
    ```

2.  ES5+，使用`JSON.parse`和`JSON.stringify`。

    ```
    var deepCopyObj = JSON.parse(JSON.stringify(obj)); 
    ```

3.  角度：

    ```
    var deepCopyObj = angular.copy(obj); 
    ```

4.  jQuery：

    ```
    var deepCopyObj = jQuery.extend(true, {}, obj); 
    ```

5.  Underscore.js 和 Lodash：

    ```
    var deepCopyObj = _.cloneDeep(obj); //latest version of Underscore.js makes shallow copy 
    ```

希望这些帮助...</p>

* * *

## 回答 #12

> 赞同：67
> 
> 时间：2009-12-26T14:59:51.560

```
var clone = function() {
    var newObj = (this instanceof Array) ? [] : {};
    for (var i in this) {
        if (this[i] && typeof this[i] == "object") {
            newObj[i] = this[i].clone();
        }
        else
        {
            newObj[i] = this[i];
        }
    }
    return newObj;
}; 

Object.defineProperty( Object.prototype, "clone", {value: clone, enumerable: false}); 
```

* * *

## 回答 #13

> 赞同：62
> 
> 时间：2012-10-17T18:36:31.323

有一个[库（称为“克隆”）](https://github.com/pvorb/node-clone)，它做得很好。它提供了我所知道的最完整的任意对象的递归克隆/复制。它还支持循环引用，其他答案尚未涵盖。

你也可以[在 npm 上找到它](https://npmjs.org/package/clone)。它可以用于浏览器以及 Node.js。

下面是一个关于如何使用它的例子：

安装它

```
npm install clone 
```

或者用[Ender](https://github.com/ender-js/Ender)打包。

```
ender build clone [...] 
```

您也可以手动下载源代码。

然后你可以在你的源代码中使用它。

```
var clone = require('clone');

var a = { foo: { bar: 'baz' } };  // inital value of a
var b = clone(a);                 // clone a -> b
a.foo.bar = 'foo';                // change a

console.log(a);                   // { foo: { bar: 'foo' } }
console.log(b);                   // { foo: { bar: 'baz' } } 
```

（免责声明：我是图书馆的作者。）

* * *

## 回答 #14

> 赞同：54
> 
> 时间：2011-09-24T19:28:11.733

我知道这是一篇旧帖子，但我认为这可能对下一个绊倒的人有所帮助。

只要您不将对象分配给任何对象，它就不会在内存中保持引用。因此，要创建一个要在其他对象之间共享的对象，您必须像这样创建一个工厂：

```
var a = function(){
    return {
        father:'zacharias'
    };
},
b = a(),
c = a();
c.father = 'johndoe';
alert(b.father); 
```

* * *

## 回答 #15

> 赞同：48
> 
> 时间：2011-12-15T15:56:15.577

如果您正在使用它，[Underscore.js](https://underscorejs.org/)库有一个[克隆](https://underscorejs.org/#clone)方法。

```
var newObject = _.clone(oldObject); 
```

* * *

## 回答 #16

> 赞同：45
> 
> 时间：2012-11-11T17:53:39.010

这是上面ConroyP答案的一个版本，即使构造函数具有必需的参数，它也可以工作：

```
//If Object.create isn't already defined, we just do the simple shim,
//without the second argument, since that's all we need here
var object_create = Object.create;
if (typeof object_create !== 'function') {
    object_create = function(o) {
        function F() {}
        F.prototype = o;
        return new F();
    };
}

function deepCopy(obj) {
    if(obj == null || typeof(obj) !== 'object'){
        return obj;
    }
    //make sure the returned object has the same prototype as the original
    var ret = object_create(obj.constructor.prototype);
    for(var key in obj){
        ret[key] = deepCopy(obj[key]);
    }
    return ret;
} 
```

[我的simpleoo](https://github.com/mbrowne/simpleoo.js)库中也提供了此功能。

**编辑：**

这是一个更强大的版本（感谢 Justin McCandless，它现在也支持循环引用）：

```
/**
 * Deep copy an object (make copies of all its object properties, sub-properties, etc.)
 * An improved version of http://keithdevens.com/weblog/archive/2007/Jun/07/javascript.clone
 * that doesn't break if the constructor has required parameters
 * 
 * It also borrows some code from http://stackoverflow.com/a/11621004/560114
 */ 
function deepCopy(src, /* INTERNAL */ _visited, _copiesVisited) {
    if(src === null || typeof(src) !== 'object'){
        return src;
    }

    //Honor native/custom clone methods
    if(typeof src.clone == 'function'){
        return src.clone(true);
    }

    //Special cases:
    //Date
    if(src instanceof Date){
        return new Date(src.getTime());
    }
    //RegExp
    if(src instanceof RegExp){
        return new RegExp(src);
    }
    //DOM Element
    if(src.nodeType && typeof src.cloneNode == 'function'){
        return src.cloneNode(true);
    }

    // Initialize the visited objects arrays if needed.
    // This is used to detect cyclic references.
    if (_visited === undefined){
        _visited = [];
        _copiesVisited = [];
    }

    // Check if this object has already been visited
    var i, len = _visited.length;
    for (i = 0; i < len; i++) {
        // If so, get the copy we already made
        if (src === _visited[i]) {
            return _copiesVisited[i];
        }
    }

    //Array
    if (Object.prototype.toString.call(src) == '[object Array]') {
        //[].slice() by itself would soft clone
        var ret = src.slice();

        //add it to the visited array
        _visited.push(src);
        _copiesVisited.push(ret);

        var i = ret.length;
        while (i--) {
            ret[i] = deepCopy(ret[i], _visited, _copiesVisited);
        }
        return ret;
    }

    //If we've reached here, we have a regular object

    //make sure the returned object has the same prototype as the original
    var proto = (Object.getPrototypeOf ? Object.getPrototypeOf(src): src.__proto__);
    if (!proto) {
        proto = src.constructor.prototype; //this line would probably only be reached by very old browsers 
    }
    var dest = object_create(proto);

    //add this object to the visited array
    _visited.push(src);
    _copiesVisited.push(dest);

    for (var key in src) {
        //Note: this does NOT preserve ES5 property attributes like 'writable', 'enumerable', etc.
        //For an example of how this could be modified to do so, see the singleMixin() function
        dest[key] = deepCopy(src[key], _visited, _copiesVisited);
    }
    return dest;
}

//If Object.create isn't already defined, we just do the simple shim,
//without the second argument, since that's all we need here
var object_create = Object.create;
if (typeof object_create !== 'function') {
    object_create = function(o) {
        function F() {}
        F.prototype = o;
        return new F();
    };
} 
```

* * *

## 回答 #17

> 赞同：31
> 
> 时间：2015-08-21T15:51:17.560

下面创建同一对象的两个实例。我找到了它，目前正在使用它。它简单易用。

```
var objToCreate = JSON.parse(JSON.stringify(cloneThis)); 
```

* * *

## 回答 #18

> 赞同：25
> 
> 时间：2010-10-06T15:08:59.540

Crockford 建议（我更喜欢）使用这个函数：

```
function object(o) {
    function F() {}
    F.prototype = o;
    return new F();
}

var newObject = object(oldObject); 
```

它很简洁，可以按预期工作，并且您不需要库。

* * *

**编辑：**

这是一个 polyfill `Object.create`，所以你也可以使用它。

```
var newObject = Object.create(oldObject); 
```

**注意：** 如果您使用其中的一些，您可能会遇到使用`hasOwnProperty`. 因为，`create`创建继承的新空对象`oldObject`。但它对于克隆对象仍然有用且实用。

例如如果 `oldObject.a = 5;`

```
newObject.a; // is 5 
```

但：

```
oldObject.hasOwnProperty(a); // is true
newObject.hasOwnProperty(a); // is false 
```

* * *

## 回答 #19

> 赞同：23
> 
> 时间：2013-06-22T15:03:59.290

Lodash 有一个不错的[_.cloneDeep(value)](http://lodash.com/docs#cloneDeep)方法：

```
var objects = [{ 'a': 1 }, { 'b': 2 }];

var deep = _.cloneDeep(objects);
console.log(deep[0] === objects[0]);
// => false 
```

* * *

## 回答 #20

> 赞同：22
> 
> 时间：2008-09-23T16:45:39.707

```
function clone(obj)
 { var clone = {};
   clone.prototype = obj.prototype;
   for (property in obj) clone[property] = obj[property];
   return clone;
 } 
```

* * *

## 回答 #21

> 赞同：21
> 
> 时间：2012-07-04T21:44:26.990

浅拷贝单行（[ECMAScript 第 5 版](https://en.wikipedia.org/wiki/ECMAScript#5th_Edition)）：

```
var origin = { foo : {} };
var copy = Object.keys(origin).reduce(function(c,k){c[k]=origin[k];return c;},{});

console.log(origin, copy);
console.log(origin == copy); // false
console.log(origin.foo == copy.foo); // true 
```

和浅拷贝单行（[ECMAScript 第 6 版](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_%E2%80%93_ECMAScript_2015)，2015）：

```
var origin = { foo : {} };
var copy = Object.assign({}, origin);

console.log(origin, copy);
console.log(origin == copy); // false
console.log(origin.foo == copy.foo); // true 
```

* * *

## 回答 #22

> 赞同：18
> 
> 时间：2010-10-17T04:01:53.347

对于类似数组的对象，似乎还没有理想的深度克隆运算符。正如下面的代码所示，John Resig 的 jQuery 克隆器将具有非数字属性的数组转换为非数组的对象，而 RegDwight 的 JSON 克隆器删除了非数字属性。以下测试在多个浏览器上说明了这些要点：

```
function jQueryClone(obj) {
   return jQuery.extend(true, {}, obj)
}

function JSONClone(obj) {
   return JSON.parse(JSON.stringify(obj))
}

var arrayLikeObj = [[1, "a", "b"], [2, "b", "a"]];
arrayLikeObj.names = ["m", "n", "o"];
var JSONCopy = JSONClone(arrayLikeObj);
var jQueryCopy = jQueryClone(arrayLikeObj);

alert("Is arrayLikeObj an array instance?" + (arrayLikeObj instanceof Array) +
      "\nIs the jQueryClone an array instance? " + (jQueryCopy instanceof Array) +
      "\nWhat are the arrayLikeObj names? " + arrayLikeObj.names +
      "\nAnd what are the JSONClone names? " + JSONCopy.names) 
```

* * *

## 回答 #23

> 赞同：18
> 
> 时间：2016-05-13T22:16:35.630

只是因为我没有看到提到[AngularJS](http://en.wikipedia.org/wiki/AngularJS)并认为人们可能想知道......

[`angular.copy`](https://docs.angularjs.org/api/ng/function/angular.copy)还提供了一种深度复制对象和数组的方法。

* * *

## 回答 #24

> 赞同：17
> 
> 时间：2013-05-06T20:45:28.213

根据您的目标是否是克隆“普通的旧 JavaScript 对象”，我有两个很好的答案。

我们还假设您的意图是创建一个完整的克隆，没有原型引用返回到源对象。如果您对完整的克隆不感兴趣，那么您可以使用其他一些答案（Crockford 模式）中提供的许多 Object.clone() 例程。

对于普通的旧 JavaScript 对象，在现代运行时克隆对象的一种经过验证的真正好方法非常简单：

```
var clone = JSON.parse(JSON.stringify(obj)); 
```

请注意，源对象必须是纯 JSON 对象。也就是说，它的所有嵌套属性都必须是标量（如布尔值、字符串、数组、对象等）。任何函数或特殊对象（如 RegExp 或 Date）都不会被克隆。

它有效率吗？哎呀，是的。我们尝试了各种克隆方法，效果最好。我敢肯定一些忍者会想出一个更快的方法。但我怀疑我们谈论的是边际收益。

这种方法简单易行。把它包装成一个方便的函数，如果你真的需要挤出一些收益，以后再去。

现在，对于非纯 JavaScript 对象，没有一个真正简单的答案。事实上，由于 JavaScript 函数和内部对象状态的动态特性，不可能存在。深度克隆包含函数的 JSON 结构需要您重新创建这些函数及其内部上下文。而 JavaScript 根本没有标准化的方式来做到这一点。

再次，正确的方法是通过您在代码中声明和重用的便捷方法。方便方法可以赋予您对自己对象的一些了解，因此您可以确保在新对象中正确地重新创建图形。

我们是自己编写的，但这里介绍了我见过的最好的通用方法：

[http://davidwalsh.name/javascript-clone](http://davidwalsh.name/javascript-clone)

这是正确的想法。作者（David Walsh）已经注释掉了泛化函数的克隆。这是您可能会选择做的事情，具体取决于您的用例。

主要思想是您需要在每种类型的基础上专门处理函数（或原型类，可以这么说）的实例化。在这里，他为 RegExp 和 Date 提供了一些示例。

这段代码不仅简短，而且可读性也很强。它很容易扩展。

这有效率吗？哎呀，是的。鉴于目标是生成真正的深拷贝克隆，那么您将不得不遍历源对象图的成员。使用这种方法，您可以准确调整要处理的子成员以及如何手动处理自定义类型。

所以你去。两种方法。在我看来，两者都很有效。

* * *

## 回答 #25

> 赞同：16
> 
> 时间：2017-10-11T16:02:22.687

我迟到了回答这个问题，但我有另一种克隆对象的方法：

```
function cloneObject(obj) {
    if (obj === null || typeof(obj) !== 'object')
        return obj;
    var temp = obj.constructor(); // changed
    for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) {
            obj['isActiveClone'] = null;
            temp[key] = cloneObject(obj[key]);
            delete obj['isActiveClone'];
        }
    }
    return temp;
}

var b = cloneObject({"a":1,"b":2});   // calling 
```

那更好更快：

```
var a = {"a":1,"b":2};
var b = JSON.parse(JSON.stringify(a)); 
```

和

```
var a = {"a":1,"b":2};

// Deep copy
var newObject = jQuery.extend(true, {}, a); 
```

我已经对代码进行了基准测试，您可以在[这里](http://jsben.ch/vyEky)测试结果：

并分享结果： [![在此处输入图像描述](https://i.stack.imgur.com/K8ztO.png)](https://i.stack.imgur.com/K8ztO.png) 参考：[https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty)

* * *

## 回答 #26

> 赞同：15
> 
> 时间：2011-04-03T02:08:03.017

这通常不是最有效的解决方案，但它可以满足我的需要。下面的简单测试用例...

```
function clone(obj, clones) {
    // Makes a deep copy of 'obj'. Handles cyclic structures by
    // tracking cloned obj's in the 'clones' parameter. Functions 
    // are included, but not cloned. Functions members are cloned.
    var new_obj,
        already_cloned,
        t = typeof obj,
        i = 0,
        l,
        pair; 

    clones = clones || [];

    if (obj === null) {
        return obj;
    }

    if (t === "object" || t === "function") {

        // check to see if we've already cloned obj
        for (i = 0, l = clones.length; i < l; i++) {
            pair = clones[i];
            if (pair[0] === obj) {
                already_cloned = pair[1];
                break;
            }
        }

        if (already_cloned) {
            return already_cloned; 
        } else {
            if (t === "object") { // create new object
                new_obj = new obj.constructor();
            } else { // Just use functions as is
                new_obj = obj;
            }

            clones.push([obj, new_obj]); // keep track of objects we've cloned

            for (key in obj) { // clone object members
                if (obj.hasOwnProperty(key)) {
                    new_obj[key] = clone(obj[key], clones);
                }
            }
        }
    }
    return new_obj || obj;
} 
```

循环阵列测试...

```
a = []
a.push("b", "c", a)
aa = clone(a)
aa === a //=> false
aa[2] === a //=> false
aa[2] === a[2] //=> false
aa[2] === aa //=> true 
```

功能测试...

```
f = new Function
f.a = a
ff = clone(f)
ff === f //=> true
ff.a === a //=> false 
```

* * *

## 回答 #27

> 赞同：14
> 
> 时间：2015-10-22T04:05:41.490

仅当您可以使用[ECMAScript 6](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_%E2%80%93_ECMAScript_2015)或[transpilers 时](https://en.wikipedia.org/wiki/Source-to-source_compiler)。

特征：

*   复制时不会触发 getter/setter。
*   保留 getter/setter。
*   保留原型信息。
*   适用于**对象文字**和**功能** [OO](https://en.wikipedia.org/wiki/Object-oriented_programming)写作风格。

代码：

```
function clone(target, source){

    for(let key in source){

        // Use getOwnPropertyDescriptor instead of source[key] to prevent from trigering setter/getter.
        let descriptor = Object.getOwnPropertyDescriptor(source, key);
        if(descriptor.value instanceof String){
            target[key] = new String(descriptor.value);
        }
        else if(descriptor.value instanceof Array){
            target[key] = clone([], descriptor.value);
        }
        else if(descriptor.value instanceof Object){
            let prototype = Reflect.getPrototypeOf(descriptor.value);
            let cloneObject = clone({}, descriptor.value);
            Reflect.setPrototypeOf(cloneObject, prototype);
            target[key] = cloneObject;
        }
        else {
            Object.defineProperty(target, key, descriptor);
        }
    }
    let prototype = Reflect.getPrototypeOf(source);
    Reflect.setPrototypeOf(target, prototype);
    return target;
} 
```

* * *

## 回答 #28

> 赞同：14
> 
> 时间：2015-10-29T16:09:55.147

对于想要使用`JSON.parse(JSON.stringify(obj))`版本但又不会丢失 Date 对象的人，您可以使用[方法的](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse#Using_the_reviver_parameter)[第二个参数`parse`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse#Using_the_reviver_parameter)将字符串转换回 Date：

```
function clone(obj) {
  var regExp = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/;
  return JSON.parse(JSON.stringify(obj), function(k, v) {
    if (typeof v === 'string' && regExp.test(v))
      return new Date(v)
    return v;
  })
}

// usage:
var original = {
 a: [1, null, undefined, 0, {a:null}, new Date()],
 b: {
   c(){ return 0 }
 }
}

var cloned = clone(original)

console.log(cloned)
```

* * *

## 回答 #29

> 赞同：13
> 
> 时间：2017-06-18T06:34:37.290

我不同意[这里](https://stackoverflow.com/a/5344074/1110941)得票最多的答案。**递归深度**克隆比提到的JSON.parse *(JSON.stringify(obj))*方法**快得多**。

 **   **Jsperf**在这里排名第一：[https ://jsperf.com/deep-copy-vs-json-stringify-json-parse/5](https://jsperf.com/deep-copy-vs-json-stringify-json-parse/5)
*   **上面答案中的Jsben**已更新，以表明递归深度克隆击败了所有其他提到的：http: [//jsben.ch/13YKQ](http://jsben.ch/13YKQ)

这是快速参考的功能：

```
function cloneDeep (o) {
  let newO
  let i

  if (typeof o !== 'object') return o

  if (!o) return o

  if (Object.prototype.toString.apply(o) === '[object Array]') {
    newO = []
    for (i = 0; i < o.length; i += 1) {
      newO[i] = cloneDeep(o[i])
    }
    return newO
  }

  newO = {}
  for (i in o) {
    if (o.hasOwnProperty(i)) {
      newO[i] = cloneDeep(o[i])
    }
  }
  return newO
} 
```

* * *

## 回答 #30

> 赞同：12
> 
> 时间：2010-04-28T11:16:55.327

```
// obj target object, vals source object
var setVals = function (obj, vals) {
    if (obj && vals) {
        for (var x in vals) {
            if (vals.hasOwnProperty(x)) {
                if (obj[x] && typeof vals[x] === 'object') {
                    obj[x] = setVals(obj[x], vals[x]);
                } else {
                    obj[x] = vals[x];
                }
            }
        }
    }
    return obj;
}; 
```

* * *

## 回答 #31

> 赞同：12
> 
> 时间：2012-07-23T21:39:22.093

这是一个全面的 clone() 方法，可以克隆任何 JavaScript 对象。它处理几乎所有的情况：

```
function clone(src, deep) {

    var toString = Object.prototype.toString;
    if (!src && typeof src != "object") {
        // Any non-object (Boolean, String, Number), null, undefined, NaN
        return src;
    }

    // Honor native/custom clone methods
    if (src.clone && toString.call(src.clone) == "[object Function]") {
        return src.clone(deep);
    }

    // DOM elements
    if (src.nodeType && toString.call(src.cloneNode) == "[object Function]") {
        return src.cloneNode(deep);
    }

    // Date
    if (toString.call(src) == "[object Date]") {
        return new Date(src.getTime());
    }

    // RegExp
    if (toString.call(src) == "[object RegExp]") {
        return new RegExp(src);
    }

    // Function
    if (toString.call(src) == "[object Function]") {

        //Wrap in another method to make sure == is not true;
        //Note: Huge performance issue due to closures, comment this :)
        return (function(){
            src.apply(this, arguments);
        });
    }

    var ret, index;
    //Array
    if (toString.call(src) == "[object Array]") {
        //[].slice(0) would soft clone
        ret = src.slice();
        if (deep) {
            index = ret.length;
            while (index--) {
                ret[index] = clone(ret[index], true);
            }
        }
    }
    //Object
    else {
        ret = src.constructor ? new src.constructor() : {};
        for (var prop in src) {
            ret[prop] = deep
                ? clone(src[prop], true)
                : src[prop];
        }
    }
    return ret;
}; 
```

* * *

## 回答 #32

> 赞同：12
> 
> 时间：2016-09-14T13:26:15.817

## AngularJS

好吧，如果您使用的是角度，您也可以这样做

```
var newObject = angular.copy(oldObject); 
```

* * *

## 回答 #33

> 赞同：9
> 
> 时间：2018-11-05T09:43:14.203

> 在 JavaScript 中，您可以编写您的`deepCopy`方法，例如

```
function deepCopy(src) {
  let target = Array.isArray(src) ? [] : {};
  for (let prop in src) {
    let value = src[prop];
    if(value && typeof value === 'object') {
      target[prop] = deepCopy(value);
  } else {
      target[prop] = value;
  }
 }
    return target;
} 
```

* * *

## 回答 #34

> 赞同：7
> 
> 时间：2016-08-05T18:54:20.050

我使用 npm 克隆库。显然它也适用于浏览器。

[https://www.npmjs.com/package/clone](https://www.npmjs.com/package/clone)

```
let a = clone(b) 
```

* * *

## 回答 #35

> 赞同：7
> 
> 时间：2018-06-19T22:06:13.553

根据我的经验，递归版本的性能大大优于`JSON.parse(JSON.stringify(obj))`. 这是一个现代化的递归深度对象复制函数，可以放在一行中：

```
function deepCopy(obj) {
  return Object.keys(obj).reduce((v, d) => Object.assign(v, {
    [d]: (obj[d].constructor === Object) ? deepCopy(obj[d]) : obj[d]
  }), {});
} 
```

这比该方法[快 40 倍左右。](https://www.measurethat.net/Benchmarks/ShowResult/25487)`JSON.parse...`

* * *

## 回答 #36

> 赞同：6
> 
> 时间：2016-07-17T17:10:41.433

单行 ECMAScript 6 解决方案（未处理特殊对象类型，如日期/正则表达式）：

```
const clone = (o) =>
  typeof o === 'object' && o !== null ?      // only clone objects
  (Array.isArray(o) ?                        // if cloning an array
    o.map(e => clone(e)) :                   // clone each of its elements
    Object.keys(o).reduce(                   // otherwise reduce every key in the object
      (r, k) => (r[k] = clone(o[k]), r), {}  // and save its cloned value into a new object
    )
  ) :
  o;                                         // return non-objects as is

var x = {
  nested: {
    name: 'test'
  }
};

var y = clone(x);

console.log(x.nested !== y.nested);
```

* * *

## 回答 #37

> 赞同：6
> 
> 时间：2017-06-04T20:49:53.927

Lodash 有一个函数可以像这样为你处理。

```
var foo = {a: 'a', b: {c:'d', e: {f: 'g'}}};

var bar = _.cloneDeep(foo);
// bar = {a: 'a', b: {c:'d', e: {f: 'g'}}} 
```

[在此处](https://lodash.com/docs/#cloneDeep)阅读文档。

* * *

## 回答 #38

> 赞同：6
> 
> 时间：2018-03-26T17:42:48.277

ES 2017 示例：

```
let objectToCopy = someObj;
let copyOfObject = {};
Object.defineProperties(copyOfObject, Object.getOwnPropertyDescriptors(objectToCopy));
// copyOfObject will now be the same as objectToCopy 
```

* * *

## 回答 #39

> 赞同：5
> 
> 时间：2011-06-24T09:41:38.973

这是我创建的不使用原型的最快方法，因此它将在新对象中维护 hasOwnProperty。

解决方案是迭代原始对象的顶级属性，制作两个副本，从原始对象中删除每个属性，然后重置原始对象并返回新副本。它只需要迭代与顶级属性一样多的次数。这保存了`if`检查每个属性是否为函数、对象、字符串等的所有条件，并且不必迭代每个后代属性。

唯一的缺点是必须为原始对象提供其原始创建的命名空间，才能重置它。

```
copyDeleteAndReset:function(namespace,strObjName){
    var obj = namespace[strObjName],
    objNew = {},objOrig = {};
    for(i in obj){
        if(obj.hasOwnProperty(i)){
            objNew[i] = objOrig[i] = obj[i];
            delete obj[i];
        }
    }
    namespace[strObjName] = objOrig;
    return objNew;
}

var namespace = {};
namespace.objOrig = {
    '0':{
        innerObj:{a:0,b:1,c:2}
    }
}

var objNew = copyDeleteAndReset(namespace,'objOrig');
objNew['0'] = 'NEW VALUE';

console.log(objNew['0']) === 'NEW VALUE';
console.log(namespace.objOrig['0']) === innerObj:{a:0,b:1,c:2}; 
```

* * *

## 回答 #40

> 赞同：5
> 
> 时间：2013-07-29T02:50:25.597

有很多答案，但没有一个能达到我想要的效果。我想利用 jQuery 的深拷贝的力量......但是，当它运行到一个数组时，它只是简单地复制对数组的引用并深拷贝其中的项目。为了解决这个问题，我做了一个很好的小递归函数，它会自动创建一个新数组。

（如果您愿意，它甚至会检查 kendo.data.ObservableArray！不过，如果您希望数组再次可观察，请确保您调用 kendo.observable(newItem)。）

因此，要完全复制现有项目，您只需执行以下操作：

```
var newItem = jQuery.extend(true, {}, oldItem);
createNewArrays(newItem);

function createNewArrays(obj) {
    for (var prop in obj) {
        if ((kendo != null && obj[prop] instanceof kendo.data.ObservableArray) || obj[prop] instanceof Array) {
            var copy = [];
            $.each(obj[prop], function (i, item) {
                var newChild = $.extend(true, {}, item);
                createNewArrays(newChild);
                copy.push(newChild);
            });
            obj[prop] = copy;
        }
    }
} 
```

* * *

## 回答 #41

> 赞同：5
> 
> 时间：2014-04-24T18:35:46.370

我通常使用`var newObj = JSON.parse( JSON.stringify(oldObje) );`但是，这是一个更合适的方法：

```
var o = {};

var oo = Object.create(o);

(o === oo); // => false 
```

观看旧版浏览器！

* * *

## 回答 #42

> 赞同：5
> 
> 时间：2014-08-24T21:09:50.147

为了将来参考，[ECMAScript 6](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_-_ECMAScript_2015)的当前草案引入了[Object.assign](http://people.mozilla.org/~jorendorff/es6-draft.html#sec-object.assign)作为克隆对象的一种方式。示例代码是：

```
var obj1 = { a: true, b: 1 };
var obj2 = Object.assign(obj1);
console.log(obj2); // { a: true, b: 1 } 
```

在撰写本文时，[支持仅限于浏览器中](http://kangax.github.io/compat-table/es6/#Object.assign)的 Firefox 34，因此目前还不能在生产代码中使用（当然，除非您正在编写 Firefox 扩展）。

* * *

## 回答 #43

> 赞同：5
> 
> 时间：2017-09-09T15:08:58.730

有很多方法可以实现这一点，但如果你想在没有任何库的情况下做到这一点，你可以使用以下方法：

```
const cloneObject = (oldObject) => {
  let newObject = oldObject;
  if (oldObject && typeof oldObject === 'object') {
    if(Array.isArray(oldObject)) {
      newObject = [];
    } else if (Object.prototype.toString.call(oldObject) === '[object Date]' && !isNaN(oldObject)) {
      newObject = new Date(oldObject.getTime());
    } else {
      newObject = {};
      for (let i in oldObject) {
        newObject[i] = cloneObject(oldObject[i]);
      }
    }

  }
  return newObject;
} 
```

让我知道你的想法。

* * *

## 回答 #44

> 赞同：4
> 
> 时间：2014-06-16T16:22:31.387

这是我的对象克隆器版本。这是 jQuery 方法的独立版本，只有很少的调整和调整。看看[小提琴](http://jsfiddle.net/eyYJB/)。我已经使用了很多 jQuery，直到有一天我意识到我大部分时间只使用这个函数 x_x。

用法与 jQuery API 中描述的相同：

*   非深度克隆：`extend(object_dest, object_source);`
*   深度克隆：`extend(true, object_dest, object_source);`

一个额外的函数用于定义对象是否适合被克隆。

```
/**
 * This is a quasi clone of jQuery's extend() function.
 * by Romain WEEGER for wJs library - www.wexample.com
 * @returns {*|{}}
 */
function extend() {
    // Make a copy of arguments to avoid JavaScript inspector hints.
    var to_add, name, copy_is_array, clone,

    // The target object who receive parameters
    // form other objects.
    target = arguments[0] || {},

    // Index of first argument to mix to target.
    i = 1,

    // Mix target with all function arguments.
    length = arguments.length,

    // Define if we merge object recursively.
    deep = false;

    // Handle a deep copy situation.
    if (typeof target === 'boolean') {
        deep = target;

        // Skip the boolean and the target.
        target = arguments[ i ] || {};

        // Use next object as first added.
        i++;
    }

    // Handle case when target is a string or something (possible in deep copy)
    if (typeof target !== 'object' && typeof target !== 'function') {
        target = {};
    }

    // Loop trough arguments.
    for (false; i < length; i += 1) {

        // Only deal with non-null/undefined values
        if ((to_add = arguments[ i ]) !== null) {

            // Extend the base object.
            for (name in to_add) {

                // We do not wrap for loop into hasOwnProperty,
                // to access to all values of object.
                // Prevent never-ending loop.
                if (target === to_add[name]) {
                    continue;
                }

                // Recurse if we're merging plain objects or arrays.
                if (deep && to_add[name] && (is_plain_object(to_add[name]) || (copy_is_array = Array.isArray(to_add[name])))) {
                    if (copy_is_array) {
                        copy_is_array = false;
                        clone = target[name] && Array.isArray(target[name]) ? target[name] : [];
                    }
                    else {
                        clone = target[name] && is_plain_object(target[name]) ? target[name] : {};
                    }

                    // Never move original objects, clone them.
                    target[name] = extend(deep, clone, to_add[name]);
                }

                // Don't bring in undefined values.
                else if (to_add[name] !== undefined) {
                    target[name] = to_add[name];
                }
            }
        }
    }
    return target;
}

/**
 * Check to see if an object is a plain object
 * (created using "{}" or "new Object").
 * Forked from jQuery.
 * @param obj
 * @returns {boolean}
 */
function is_plain_object(obj) {
    // Not plain objects:
    // - Any object or value whose internal [[Class]] property is not "[object Object]"
    // - DOM nodes
    // - window
    if (obj === null || typeof obj !== "object" || obj.nodeType || (obj !== null && obj === obj.window)) {
        return false;
    }
    // Support: Firefox <20
    // The try/catch suppresses exceptions thrown when attempting to access
    // the "constructor" property of certain host objects, i.e. |window.location|
    // https://bugzilla.mozilla.org/show_bug.cgi?id=814622
    try {
        if (obj.constructor && !this.hasOwnProperty.call(obj.constructor.prototype, "isPrototypeOf")) {
            return false;
        }
    }
    catch (e) {
        return false;
    }

    // If the function hasn't returned already, we're confident that
    // |obj| is a plain object, created by {} or constructed with new Object
    return true;
} 
```

* * *

## 回答 #45

> 赞同：4
> 
> 时间：2016-01-01T09:35:15.477

由于递归对于 JavaScript 来说太昂贵了，而且我发现的大多数答案都是使用递归，而 JSON 方法将跳过不可转换为 JSON 的部分（函数等）。所以我做了一些研究，发现这种蹦床技术可以避免它。这是代码：

```
/*
 * Trampoline to avoid recursion in JavaScript, see:
 *     https://www.integralist.co.uk/posts/functional-recursive-javascript-programming/
 */
function trampoline() {
    var func = arguments[0];
    var args = [];
    for (var i = 1; i < arguments.length; i++) {
        args[i - 1] = arguments[i];
    }

    var currentBatch = func.apply(this, args);
    var nextBatch = [];

    while (currentBatch && currentBatch.length > 0) {
        currentBatch.forEach(function(eachFunc) {
            var ret = eachFunc();
            if (ret && ret.length > 0) {
                nextBatch = nextBatch.concat(ret);
            }
        });

        currentBatch = nextBatch;
        nextBatch = [];
    }
};

/*
 *  Deep clone an object using the trampoline technique.
 *
 *  @param target {Object} Object to clone
 *  @return {Object} Cloned object.
 */
function clone(target) {
    if (typeof target !== 'object') {
        return target;
    }
    if (target == null || Object.keys(target).length == 0) {
        return target;
    }

    function _clone(b, a) {
        var nextBatch = [];
        for (var key in b) {
            if (typeof b[key] === 'object' && b[key] !== null) {
                if (b[key] instanceof Array) {
                    a[key] = [];
                }
                else {
                    a[key] = {};
                }
                nextBatch.push(_clone.bind(null, b[key], a[key]));
            }
            else {
                a[key] = b[key];
            }
        }
        return nextBatch;
    };

    var ret = target instanceof Array ? [] : {};
    (trampoline.bind(null, _clone))(target, ret);
    return ret;
}; 
```

* * *

## 回答 #46

> 赞同：4
> 
> 时间：2017-10-15T20:01:27.260

`ES2015`这是我使用默认值和扩展运算符深度克隆对象的方法

```
 const makeDeepCopy = (obj, copy = {}) => {
  for (let item in obj) {
    if (typeof obj[item] === 'object') {
      makeDeepCopy(obj[item], copy)
    }
    if (obj.hasOwnProperty(item)) {
      copy = {
        ...obj
      }
    }
  }
  return copy
} 
```

```
const testObj = {
  "type": "object",
  "properties": {
    "userId": {
      "type": "string",
      "chance": "guid"
    },
    "emailAddr": {
      "type": "string",
      "chance": {
        "email": {
          "domain": "fake.com"
        }
      },
      "pattern": ".+@fake.com"
    }
  },
  "required": [
    "userId",
    "emailAddr"
  ]
}

const makeDeepCopy = (obj, copy = {}) => {
  for (let item in obj) {
    if (typeof obj[item] === 'object') {
      makeDeepCopy(obj[item], copy)
    }
    if (obj.hasOwnProperty(item)) {
      copy = {
        ...obj
      }
    }
  }
  return copy
}

console.log(makeDeepCopy(testObj))
```

* * *

## 回答 #47

> 赞同：4
> 
> 时间：2018-07-16T07:58:04.287

希望这可以帮助。

```
function deepClone(obj) {
    /*
     * Duplicates an object 
     */

    var ret = null;
    if (obj !== Object(obj)) { // primitive types
        return obj;
    }
    if (obj instanceof String || obj instanceof Number || obj instanceof Boolean) { // string objecs
        ret = obj; // for ex: obj = new String("Spidergap")
    } else if (obj instanceof Date) { // date
        ret = new obj.constructor();
    } else
        ret = Object.create(obj.constructor.prototype);

    var prop = null;
    var allProps = Object.getOwnPropertyNames(obj); //gets non enumerables also

    var props = {};
    for (var i in allProps) {
        prop = allProps[i];
        props[prop] = false;
    }

    for (i in obj) {
        props[i] = i;
    }

    //now props contain both enums and non enums 
    var propDescriptor = null;
    var newPropVal = null; // value of the property in new object
    for (i in props) {
        prop = obj[i];
        propDescriptor = Object.getOwnPropertyDescriptor(obj, i);

        if (Array.isArray(prop)) { //not backward compatible
            prop = prop.slice(); // to copy the array
        } else
        if (prop instanceof Date == true) {
            prop = new prop.constructor();
        } else
        if (prop instanceof Object == true) {
            if (prop instanceof Function == true) { // function
                if (!Function.prototype.clone) {
                    Function.prototype.clone = function() {
                        var that = this;
                        var temp = function tmp() {
                            return that.apply(this, arguments);
                        };
                        for (var ky in this) {
                            temp[ky] = this[ky];
                        }
                        return temp;
                    }
                }
                prop = prop.clone();

            } else // normal object 
            {
                prop = deepClone(prop);
            }

        }

        newPropVal = {
            value: prop
        };
        if (propDescriptor) {
            /*
             * If property descriptors are there, they must be copied
             */
            newPropVal.enumerable = propDescriptor.enumerable;
            newPropVal.writable = propDescriptor.writable;

        }
        if (!ret.hasOwnProperty(i)) // when String or other predefined objects
            Object.defineProperty(ret, i, newPropVal); // non enumerable

    }
    return ret;
} 
```

[https://github.com/jinujd/Javascript-Deep-Clone](https://github.com/jinujd/Javascript-Deep-Clone)

* * *

## 回答 #48

> 赞同：4
> 
> 时间：2019-05-19T12:22:39.190

我的情况有点不同。我有一个带有嵌套对象和函数的对象。因此，`Object.assign()`并`JSON.stringify()`没有解决我的问题。使用第三方库对我来说也不是一个选择。

因此，我决定创建一个简单的函数来使用内置方法来复制对象及其文字属性、嵌套对象和函数。

```
let deepCopy = (target, source) => {
    Object.assign(target, source);
    // check if there's any nested objects
    Object.keys(source).forEach((prop) => {
        /**
          * assign function copies functions and
          * literals (int, strings, etc...)
          * except for objects and arrays, so:
          */
        if (typeof(source[prop]) === 'object') {
            // check if the item is, in fact, an array
            if (Array.isArray(source[prop])) {
                // clear the copied referenece of nested array
                target[prop] = Array();
                // iterate array's item and copy over
                source[prop].forEach((item, index) => {
                    // array's items could be objects too!
                    if (typeof(item) === 'object') {
                        // clear the copied referenece of nested objects
                        target[prop][index] = Object();
                        // and re do the process for nested objects
                        deepCopy(target[prop][index], item);
                    } else {
                        target[prop].push(item);
                    }
                });
            // otherwise, treat it as an object
            } else {
                // clear the copied referenece of nested objects
                target[prop] = Object();
                // and re do the process for nested objects
                deepCopy(target[prop], source[prop]);
            }
        }
    });
}; 
```

这是一个测试代码：

```
let a = {
    name: 'Human', 
    func: () => {
        console.log('Hi!');
    }, 
    prop: {
        age: 21, 
        info: {
            hasShirt: true, 
            hasHat: false
        }
    },
    mark: [89, 92, { exam: [1, 2, 3] }]
};

let b = Object();

deepCopy(b, a);

a.name = 'Alien';
a.func = () => { console.log('Wassup!'); };
a.prop.age = 1024;
a.prop.info.hasShirt = false;
a.mark[0] = 87;
a.mark[1] = 91;
a.mark[2].exam = [4, 5, 6];

console.log(a); // updated props
console.log(b); 
```

对于与效率相关的问题，我相信这是解决我遇到的问题的最简单和最有效的解决方案。我将不胜感激对此算法的任何评论，以使其更有效。

* * *

## 回答 #49

> 赞同：4
> 
> 时间：2019-05-28T06:17:12.130

`Object.assign({},sourceObj)`仅当对象的属性没有引用类型键时才克隆对象。前任

```
obj={a:"lol",b:["yes","no","maybe"]}
clonedObj = Object.assign({},obj);

clonedObj.b.push("skip")// changes will reflected to the actual obj as well because of its reference type.
obj.b //will also console => yes,no,maybe,skip 
```

所以对于深度克隆是不可能通过这种方式实现的。

最有效的解决方案是

```
var obj = Json.stringify(yourSourceObj)
var cloned = Json.parse(obj); 
```

* * *

## 回答 #50

> 赞同：3
> 
> 时间：2011-03-27T20:29:48.873

如果您想概括您的对象克隆算法，我认为这是最好的解决方案。
它可以与 jQuery 一起使用，也可以不与 jQuery 一起使用，但如果您希望克隆的对象与原始对象具有相同的“类”，我建议您不要使用 jQuery 的扩展方法。

```
function clone(obj){
    if(typeof(obj) == 'function')//it's a simple function
        return obj;
    //of it's not an object (but could be an array...even if in javascript arrays are objects)
    if(typeof(obj) !=  'object' || obj.constructor.toString().indexOf('Array')!=-1)
        if(JSON != undefined)//if we have the JSON obj
            try{
                return JSON.parse(JSON.stringify(obj));
            }catch(err){
                return JSON.parse('"'+JSON.stringify(obj)+'"');
            }
        else
            try{
                return eval(uneval(obj));
            }catch(err){
                return eval('"'+uneval(obj)+'"');
            }
    // I used to rely on jQuery for this, but the "extend" function returns
    //an object similar to the one cloned,
    //but that was not an instance (instanceof) of the cloned class
    /*
    if(jQuery != undefined)//if we use the jQuery plugin
        return jQuery.extend(true,{},obj);
    else//we recursivley clone the object
    */
    return (function _clone(obj){
        if(obj == null || typeof(obj) != 'object')
            return obj;
        function temp () {};
        temp.prototype = obj;
        var F = new temp;
        for(var key in obj)
            F[key] = clone(obj[key]);
        return F;
    })(obj);            
} 
```

* * *

## 回答 #51

> 赞同：3
> 
> 时间：2015-06-19T02:56:44.930

用于`Object.create()`获取`prototype`和支持`instanceof`，并使用`for()`循环获取可枚举键：

```
function cloneObject(source) {
    var key,value;
    var clone = Object.create(source);

    for (key in source) {
        if (source.hasOwnProperty(key) === true) {
            value = source[key];

            if (value!==null && typeof value==="object") {
                clone[key] = cloneObject(value);
            } else {
                clone[key] = value;
            }
        }
    }

    return clone;
} 
```

* * *

## 回答 #52

> 赞同：3
> 
> 时间：2016-11-21T14:05:22.000

供将来参考，可以使用此代码

ES6：

```
_clone: function(obj){
    let newObj = {};
    for(let i in obj){
        if(typeof(obj[i]) === 'object' && Object.keys(obj[i]).length){
            newObj[i] = clone(obj[i]);
        } else{
            newObj[i] = obj[i];
        }
    }
    return Object.assign({},newObj);
} 
```

ES5：

```
function clone(obj){
let newObj = {};
for(let i in obj){
    if(typeof(obj[i]) === 'object' && Object.keys(obj[i]).length){
        newObj[i] = clone(obj[i]);
    } else{
        newObj[i] = obj[i];
    }
}
return Object.assign({},newObj); 
```

}

例如

```
var obj ={a:{b:1,c:3},d:4,e:{f:6}}
var xc = clone(obj);
console.log(obj); //{a:{b:1,c:3},d:4,e:{f:6}}
console.log(xc); //{a:{b:1,c:3},d:4,e:{f:6}}

xc.a.b = 90;
console.log(obj); //{a:{b:1,c:3},d:4,e:{f:6}}
console.log(xc); //{a:{b:90,c:3},d:4,e:{f:6}} 
```

* * *

## 回答 #53

> 赞同：3
> 
> 时间：2016-11-24T11:15:13.070

```
class Handler {
  static deepCopy (obj) {
    if (Object.prototype.toString.call(obj) === '[object Array]') {
      const result = [];

      for (let i = 0, len = obj.length; i < len; i++) {
        result[i] = Handler.deepCopy(obj[i]);
      }
      return result;
    } else if (Object.prototype.toString.call(obj) === '[object Object]') {
      const result = {};
      for (let prop in obj) {
        result[prop] = Handler.deepCopy(obj[prop]);
      }
      return result;
    }
    return obj;
  }
}
```

* * *

## 回答 #54

> 赞同：3
> 
> 时间：2017-04-05T15:06:39.107

在不触及原型继承的情况下，您可以深入孤独的对象和数组，如下所示；

```
function objectClone(o){
  var ot = Array.isArray(o);
  return o !== null && typeof o === "object" ? Object.keys(o)
                                                     .reduce((r,k) => o[k] !== null && typeof o[k] === "object" ? (r[k] = objectClone(o[k]),r)
                                                                                                                : (r[k] = o[k],r), ot ? [] : {})
                                             : o;
}
var obj = {a: 1, b: {c: 2, d: {e: 3, f: {g: 4, h: null}}}},
    arr = [1,2,[3,4,[5,6,[7]]]],
    nil = null,
  clobj = objectClone(obj),
  clarr = objectClone(arr),
  clnil = objectClone(nil);
console.log(clobj, obj === clobj);
console.log(clarr, arr === clarr);
console.log(clnil, nil === clnil);
clarr[2][2][2] = "seven";
console.log(arr, clarr);
```

* * *

## 回答 #55

> 赞同：3
> 
> 时间：2018-01-20T20:26:35.597

由 a 完成的异步对象克隆怎么样`Promise`？

```
async function clone(thingy /**/)
{
    if(thingy instanceof Promise)
    {
        throw Error("This function cannot clone Promises.");
    }
    return thingy;
} 
```

* * *

## 回答 #56

> 赞同：3
> 
> 时间：2018-02-26T04:05:16.723

浏览这个长长的答案列表，几乎所有的解决方案都被涵盖了，除了我知道的一个。这是 VANILLA JS 深度克隆对象的方法列表。

1.  JSON.parse(JSON.stringify(obj));

2.  通过 history.state 和 pushState 或 replaceState

3.  Web Notifications API，但这有向用户询问权限的缺点。

4.  通过对象进行自己的递归循环以复制每个级别。

5.  我没有看到的答案 -> 使用 ServiceWorkers。在页面和 ServiceWorker 脚本之间来回传递的消息（对象）将是任何对象的深度克隆。

* * *

## 回答 #57

> 赞同：3
> 
> 时间：2018-06-24T19:08:38.040

对于浅拷贝，ECMAScript2018 标准中引入了一种很棒的简单方法。它涉及使用*扩展运算符*：

```
let obj = {a : "foo", b:"bar" , c:10 , d:true , e:[1,2,3] };

let objClone = { ...obj }; 
```

我已经在 Chrome 浏览器中对其进行了测试，两个对象都存储在不同的位置，因此在其中一个中更改直接子值不会改变另一个。虽然（在示例中）更改值`e`会影响两个副本。

这种技术非常简单直接。我认为这是一劳永逸地解决这个问题的真正最佳实践。

* * *

## 回答 #58

> 赞同：3
> 
> 时间：2019-08-03T16:36:52.890

这是我的解决方案，不使用任何库或本机 javascript 函数。

```
function deepClone(obj) {
  if (typeof obj !== "object") {
    return obj;
  } else {
    let newObj =
      typeof obj === "object" && obj.length !== undefined ? [] : {};
    for (let key in obj) {
      if (key) {
        newObj[key] = deepClone(obj[key]);
      }
    }
    return newObj;
  }
} 
```

* * *

## 回答 #59

> 赞同：2
> 
> 时间：2015-08-04T19:38:46.340

需要新的浏览器，但是...

让我们扩展原生 Object 并获得一个**真实的** `.extend()`;

```
Object.defineProperty(Object.prototype, 'extend', {
    enumerable: false,
    value: function(){
        var that = this;

        Array.prototype.slice.call(arguments).map(function(source){
            var props = Object.getOwnPropertyNames(source),
                i = 0, l = props.length,
                prop;

            for(; i < l; ++i){
                prop = props[i];

                if(that.hasOwnProperty(prop) && typeof(that[prop]) === 'object'){
                    that[prop] = that[prop].extend(source[prop]);
                }else{
                    Object.defineProperty(that, prop, Object.getOwnPropertyDescriptor(source, prop));
                }
            }
        });

        return this;
    }
}); 
```

只需在任何在对象上使用 .extend() 的代码之前弹出它。

例子：

```
var obj1 = {
    node1: '1',
    node2: '2',
    node3: 3
};

var obj2 = {
    node1: '4',
    node2: 5,
    node3: '6'
};

var obj3 = ({}).extend(obj1, obj2);

console.log(obj3);
// Object {node1: "4", node2: 5, node3: "6"} 
```

* * *

## 回答 #60

> 赞同：2
> 
> 时间：2016-10-30T06:40:27.373

这是一个递归解决方案：

```
obj = {
  a: { b: { c: { d: ['1', '2'] } } },
  e: 'Saeid'
}
const Clone = function (obj) {

  const container = Array.isArray(obj) ? [] : {}
  const keys  = Object.keys(obj)

  for (let i = 0; i < keys.length; i++) {
    const key = keys[i]
    if(typeof obj[key] == 'object') {
      container[key] = Clone(obj[key])
    }
    else
      container[key] = obj[key].slice()
  }

  return container
}
 console.log(Clone(obj))
```

* * *

## 回答 #61

> 赞同：2
> 
> 时间：2018-08-23T09:40:50.690

当您的对象是嵌套的并且它包含数据对象、其他结构化对象或某些属性对象等时，使用`JSON.parse(JSON.stringify(object))`or`Object.assign({}, obj)`或`$.extend(true, {}, obj)`将不起作用。在这种情况下，请使用 lodash。它简单易行。。

```
var obj = {a: 25, b: {a: 1, b: 2}, c: new Date(), d: anotherNestedObject };
var A = _.cloneDeep(obj); 
```

现在 A 将是您的新克隆 obj 没有任何引用..

* * *

## 回答 #62

> 赞同：2
> 
> 时间：2018-10-10T09:21:56.140

如果您发现自己经常做这种事情（例如创建撤消重做功能），那么可能值得研究[Immutable.js](https://facebook.github.io/immutable-js/)

```
const map1 = Immutable.fromJS( { a: 1, b: 2, c: { d: 3 } } );
const map2 = map1.setIn( [ 'c', 'd' ], 50 );

console.log( `${ map1.getIn( [ 'c', 'd' ] ) } vs ${ map2.getIn( [ 'c', 'd' ] ) }` ); // "3 vs 50" 
```

[https://codepen.io/anon/pen/OBpqNE?editors=1111](https://codepen.io/anon/pen/OBpqNE?editors=1111)

* * *

## 回答 #63

> 赞同：2
> 
> 时间：2019-04-16T05:33:51.703

随着一些浏览器的较新版本支持的新方法[Object.fromEntries()的提议（](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries)[参考](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/fromEntries#Browser_compatibility)）。我想为下一个递归方法做出贡献：

```
const obj = {
  key1: {key11: "key11", key12: "key12", key13: {key131: 22}},
  key2: {key21: "key21", key22: "key22"},
  key3: "key3",
  key4: [1,2,3, {key: "value"}]
}

const cloneObj = (obj) =>
{
    if (Object(obj) !== obj)
       return obj;
    else if (Array.isArray(obj))
       return obj.map(cloneObj);

    return Object.fromEntries(Object.entries(obj).map(
        ([k,v]) => ([k, cloneObj(v)])
    ));
}

// Clone the original object.
let newObj = cloneObj(obj);

// Make changes on the original object.
obj.key1.key11 = "TEST";
obj.key3 = "TEST";
obj.key1.key13.key131 = "TEST";
obj.key4[1] = "TEST";
obj.key4[3].key = "TEST";

// Display both objects on the console.
console.log("Original object: ", obj);
console.log("Cloned object: ", newObj);
```

```
.as-console {background-color:black !important; color:lime;}
.as-console-wrapper {max-height:100% !important; top:0;}
```

* * *

## 回答 #64

> 赞同：1
> 
> 时间：2017-08-16T06:16:41.277

由于这个问题在参考 Object.assign 或自定义代码等内置功能方面引起了很多关注和回答，因此我想分享一些库来进行深度克隆，

**1\. 埃克隆**

npm install --savedev esclone [https://www.npmjs.com/package/esclone](https://www.npmjs.com/package/esclone)

ES6 中的使用示例：

```
import esclone from "esclone";

const rockysGrandFather = {
  name: "Rockys grand father",
  father: "Don't know :("
};
const rockysFather = {
  name: "Rockys Father",
  father: rockysGrandFather
};

const rocky = {
  name: "Rocky",
  father: rockysFather
};

const rockyClone = esclone(rocky); 
```

ES5 中的使用示例：

```
var esclone = require("esclone")
var foo = new String("abcd")
var fooClone = esclone.default(foo)
console.log(fooClone)
console.log(foo === fooClone) 
```

**2.深拷贝**

npm install deep-copy [https://www.npmjs.com/package/deep-copy](https://www.npmjs.com/package/deep-copy)

例子：

```
var dcopy = require('deep-copy')

// deep copy object 
var copy = dcopy({a: {b: [{c: 5}]}})

// deep copy array 
var copy = dcopy([1, 2, {a: {b: 5}}]) 
```

**3\. 深克隆**

$ npm install --save clone-deep [https://www.npmjs.com/package/clone-deep](https://www.npmjs.com/package/clone-deep)

例子：

```
var cloneDeep = require('clone-deep');

var obj = {a: 'b'};
var arr = [obj];

var copy = cloneDeep(arr);
obj.c = 'd';

console.log(copy);
//=> [{a: 'b'}] 

console.log(arr); 
```

* * *

## 回答 #65

> 赞同：1
> 
> 时间：2019-02-05T13:46:15.637

```
function clone(obj) {
    var copy;

    // Handle the 3 simple types, and null or undefined
    if (null == obj || "object" != typeof obj) return obj;

    // Handle Date
    if (obj instanceof Date) {
        copy = new Date();
        copy.setTime(obj.getTime());
        return copy;
    }

    // Handle Array
    if (obj instanceof Array) {
        copy = [];
        for (var i = 0, len = obj.length; i < len; i++) {
            copy[i] = clone(obj[i]);
        }
        return copy;
    }

    // Handle Object
    if (obj instanceof Object) {
        copy = {};
        for (var attr in obj) {
            if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr]);
        }
        return copy;
    }

    throw new Error("Unable to copy obj! Its type isn't supported.");
} 
```

使用下面的方法而不是`JSON.parse(JSON.stringify(obj))` 因为它比下面的方法慢

[如何正确克隆 JavaScript 对象？](https://stackoverflow.com/questions/728360/how-do-i-correctly-clone-a-javascript-object)

* * *

## 回答 #66

> 赞同：0
> 
> 时间：2019-02-05T01:11:56.440

如何将对象的*键*与其*值*合并？

```
function deepClone(o) {
    var keys = Object.keys(o);
    var values = Object.values(o);

    var clone = {};

    keys.forEach(function(key, i) {
        clone[key] = typeof values[i] == 'object' ? Object.create(values[i]) : values[i];
    });

    return clone;
} 
```

**注意：** *这种方法不一定要进行浅拷贝*，但它只复制一个内部对象的深度，这意味着当你得到类似的东西时`{a: {b: {c: null}}}`，它只会克隆直接在它们内部的对象， `deepClone(a.b).c`技术上也是如此对`a.b.c`, while的引用`deepClone(a).b`是克隆，*而不是引用*。

* * *

## 回答 #67

> 赞同：-2
> 
> 时间：2016-03-23T11:37:21.453

**使用当今的 JavaScript 克隆对象：[ECMAScript 2015](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_%E2%80%93_ECMAScript_2015)**（以前称为 ECMAScript 6）

```
var original = {a: 1};

// Method 1: New object with original assigned.
var copy1 = Object.assign({}, original);

// Method 2: New object with spread operator assignment.
var copy2 = {...original}; 
```

旧浏览器可能不支持 ECMAScript 2015。一种常见的解决方案是使用 JavaScript 到 JavaScript 编译器（如 Babel）输出 JavaScript 代码的[ECMAScript 5](https://en.wikipedia.org/wiki/ECMAScript#5th_Edition)版本。

正如[@jim-hall 所指出的](https://stackoverflow.com/questions/122102/what-is-the-most-efficient-way-to-clone-an-object-in-javascript?page=2&tab=oldest#comment60081951_36177142)，**这只是一个浅拷贝**。属性的属性被复制作为参考：更改一个将更改另一个对象/实例中的值。

# asp.net-mvc - ASP.Net MVC Keeping action parameters between postbacks

> ID：122104
> 
> 赞同：8
> 
> 时间：2008-09-23T16:26:15.650
> 
> 标签：asp.net-mvc, asp.net-mvc-routing

Say I have a page that display search results. I search for stackoverflow and it returns 5000 results, 10 per page. Now I find myself doing this when building links on that page:

```
<%=Html.ActionLink("Page 1", "Search", new { query=ViewData["query"], page etc..%>
<%=Html.ActionLink("Page 2", "Search", new { query=ViewData["query"], page etc..%>
<%=Html.ActionLink("Page 3", "Search", new { query=ViewData["query"], page etc..%>
<%=Html.ActionLink("Next", "Search", new { query=ViewData["query"], page etc..%> 
```

I dont like this, I have to build my links with careful consideration to what was posted previously etc..

What I'd like to do is

```
<%=Html.BuildActionLinkUsingCurrentActionPostData
        ("Next", "Search", new { Page = 1}); 
```

where the anonymous dictionary overrides anything currently set by previous action.

Essentially I care about what the previous action parameters were, because I want to reuse, it sounds simple, but start adding sort and loads of advance search options and it starts getting messy.

Im probably missing something obvious

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-08-04T15:12:02.623

我在 HtmlHelper 中遇到了类似的问题；我想生成链接到当前页面的链接，对参数进行小幅调整（考虑增加页码）。因此，如果我有 URL /Item/?sort=Name&page=0，我希望能够创建指向同一页面的链接，但只需更改页面参数，并自动包含排序参数（即 /Item/?sort=名称&页面=1)。

我的解决方案是这样的（用于 HtmlHelper 扩展方法，但由于您几乎可以在 MVC 中的任何位置访问相同的数据，因此您可以轻松地调整它以适应您的使用）：

```
private static RouteValueDictionary CreateRouteToCurrentPage(HtmlHelper html)
{
    RouteValueDictionary routeValues 
         = new RouteValueDictionary(html.ViewContext.RouteData.Values);

    NameValueCollection queryString 
         = html.ViewContext.HttpContext.Request.QueryString;

    foreach (string key in queryString.Cast<string>())
    {
        routeValues[key] = queryString[key];
    }

    return routeValues;
} 
```

该方法的作用是获取当前请求的 RouteValueDictionary 并创建它的副本。然后它将在查询字符串中找到的每个查询参数添加到此路由。这样做是因为，出于某种原因，当前请求的 RouteValueDictionary 不包含它们（您认为它会包含它们，但事实并非如此）。

然后，您可以获取结果字典，仅修改其中的一部分，例如：

```
routeValues["page"] = 2; 
```

然后将该字典提供给开箱即用的 HtmlHelper 方法，以便它们为您生成 URL/等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T17:25:56.927

每当您发现自己在视图中编写冗余代码时，请[编写一个 helper](http://blog.wekeroad.com/blog/asp-net-mvc-avoiding-tag-soup/)。帮助器可以显式复制参数，就像您现在所做的那样，或者它可以迭代整个集合并自动复制。如果是我，我可能会选择前者。然后你可以只调用你的新助手，而不是每次建立链接时都重建参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:57:57.250

对于您在这里实际尝试做的事情，我有点不确定。我认为您正在尝试自动化创建链接列表的过程，它们之间只有很小的变化。显然，在您的情况下，“页面”的 ID 号。

一种方法，虽然可能不是最好的，但像这样（我的代码使用了一个基本的和人为的产品列表，并且 ViewPage 和 PartialViewPage 都使用强类型模型）：

在您的 ViewPage 上，您将添加如下代码：

```
<div id="product_list">
        <% foreach (TestMVC.Product product in ViewData.Model)
           { %>
            <% Html.RenderPartial("ProductEntry", product); %>
        <% } %>
</div> 
```

你的部分视图，在我的例子中是“ProductEntry”，看起来像这样：

```
<div class="product">
    <div class="product-name">
        <%= Html.ActionLink(ViewData.Model.ProductName, "Detail", new { id = ViewData.Model.id })%>
    </div> 
    <div class="product-desc">
        <%= ViewData.Model.ProductDescription %>
    </div>       
</div> 
```

我在该部分视图中所做的只是使用通过调用 Html.RenderPartial 从父视图传递的模型/视图数据

在您的父视图中，您可以在调用 Html.RenderPartial 之前修改模型对象上的参数，以便设置您感兴趣的特定值。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-17T11:59:11.987

以下辅助方法就是这样做的：

```
 public static string EnhancedActionLink(this HtmlHelper helper, string linkText, string actionName, string controllerName, bool keepQueryStrings)
    {
        ViewContext context = helper.ViewContext;
        IDictionary<string, object> htmlAttributes = null;
        RouteValueDictionary routeValues = null;
        string actionLink = string.Empty;
        if (keepQueryStrings && context.RequestContext.HttpContext.Request.QueryString.Keys.Count > 0)
        {
            routeValues = new RouteValueDictionary(context.RouteData.Values);
            foreach (string key in context.RequestContext.HttpContext.Request.QueryString.Keys)
            {
                routeValues[key] = context.RequestContext.HttpContext.Request.QueryString[key];
            }
        }            
        actionLink = helper.ActionLink(linkText, actionName, controllerName, routeValues, htmlAttributes);
        return actionLink;
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-14T05:23:31.687

花了几个小时尝试不同的解决方案后，只有这个对我有用： [MVC ActionLink add all (optional) parameters from current url](https://stackoverflow.com/questions/3779932/mvc-actionlink-add-all-optional-paramters-from-current-url)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-03T13:22:46.677

看看这个，这是一个很好的例子： http: [//nerddinnerbook.s3.amazonaws.com/Part8.htm](http://nerddinnerbook.s3.amazonaws.com/Part8.htm)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-16T13:20:54.420

不完全是一个答案，但值得指出：如果您想要分页功能，请使用 PagedList Nuget 包（无需重新发明轮子）。以下链接提供了一个非常好的示例来说明如何使用它：[ASP.NET 教程](http://www.asp.net/mvc/tutorials/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application)

这对您特别有用，因为在页面之间切换时查询字符串会保存在 URL 中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-07-03T06:51:08.943

Here's the actionlink extension

```
 public static class ActionLinkExtension
    {
        public static MvcHtmlString ActionLinkWithQueryString(this HtmlHelper helper, string linkText, string action, string controller, object routeValues)
        {
            var context = helper.ViewContext;

            var currentRouteValues = new RouteValueDictionary(context.RouteData.Values);
            foreach (string key in context.HttpContext.Request.QueryString.Keys)
            {
                currentRouteValues[key] = context.HttpContext.Request.QueryString[key];
            }

            var newRouteValues = new RouteValueDictionary(routeValues);

            foreach (var route in newRouteValues)
            {
                if (!currentRouteValues.ContainsKey(route.Key))
                {
                    currentRouteValues.Add(route.Key, route.Value);
                }
                else
                {
                    currentRouteValues[route.Key] = route.Value;
                }
            }

            return helper.ActionLink(linkText, action, controller, currentRouteValues, null);
        }

    } 

```

# java - 如何过滤 Java 集合（基于谓词）？

> ID：122105
> 
> 赞同：732
> 
> 时间：2008-09-23T16:26:26.383
> 
> 标签：java, collections, filter

我想`java.util.Collection`根据谓词过滤 a 。

* * *

## 回答 #1

> 赞同：785
> 
> 时间：2009-09-06T13:37:49.070

Java 8 ( [2014](https://blogs.oracle.com/thejavatutorials/entry/jdk_8_is_released "Java 8 发布") ) 在一行代码中使用流和 lambdas 解决了这个问题：

```
List<Person> beerDrinkers = persons.stream()
    .filter(p -> p.getAge() > 16).collect(Collectors.toList()); 
```

这是一个[教程](http://zeroturnaround.com/rebellabs/java-8-explained-applying-lambdas-to-java-collections/ "Java 8 集合和 lambda")。

用于[`Collection#removeIf`](https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html#removeIf-java.util.function.Predicate-)就地修改集合。（注意：在这种情况下，谓词将删除满足谓词的对象）：

```
persons.removeIf(p -> p.getAge() <= 16); 
```

* * *

[lambdaj](https://code.google.com/archive/p/lambdaj/)允许在不编写循环或内部类的情况下过滤集合：

```
List<Person> beerDrinkers = select(persons, having(on(Person.class).getAge(),
    greaterThan(16))); 
```

你能想象一些更具可读性的东西吗？

**免责声明：**我是 lambdaj 的贡献者

* * *

## 回答 #2

> 赞同：228
> 
> 时间：2008-09-23T16:41:41.417

假设您使用的是[Java 1.5](http://java.sun.com/j2se/1.5.0/docs/index.html)，并且您无法添加[Google Collections](https://code.google.com/p/guava-libraries/)，我会做一些与 Google 人员所做的非常相似的事情。这与乔恩的评论略有不同。

首先将此接口添加到您的代码库中。

```
public interface IPredicate<T> { boolean apply(T type); } 
```

当某个谓词对某种类型为真时，它的实现者可以回答。例如，如果`T`were`User`和`AuthorizedUserPredicate<User>`implements `IPredicate<T>`，则`AuthorizedUserPredicate#apply`返回传入的是否`User`被授权。

然后在一些实用程序类中，你可以说

```
public static <T> Collection<T> filter(Collection<T> target, IPredicate<T> predicate) {
    Collection<T> result = new ArrayList<T>();
    for (T element: target) {
        if (predicate.apply(element)) {
            result.add(element);
        }
    }
    return result;
} 
```

因此，假设您使用上述内容可能是

```
Predicate<User> isAuthorized = new Predicate<User>() {
    public boolean apply(User user) {
        // binds a boolean method in User to a reference
        return user.isAuthorized();
    }
};
// allUsers is a Collection<User>
Collection<User> authorizedUsers = filter(allUsers, isAuthorized); 
```

如果线性检查的性能值得关注，那么我可能想要一个具有目标集合的域对象。具有目标集合的域对象将具有用于初始化、添加和设置目标集合的方法的过滤逻辑。

更新：

在实用程序类（比如说 Predicate）中，我添加了一个 select 方法，当谓词不返回预期值时，该方法带有一个默认值选项，以及一个用于在新 IPredicate 中使用的 params 的静态属性。

```
public class Predicate {
    public static Object predicateParams;

    public static <T> Collection<T> filter(Collection<T> target, IPredicate<T> predicate) {
        Collection<T> result = new ArrayList<T>();
        for (T element : target) {
            if (predicate.apply(element)) {
                result.add(element);
            }
        }
        return result;
    }

    public static <T> T select(Collection<T> target, IPredicate<T> predicate) {
        T result = null;
        for (T element : target) {
            if (!predicate.apply(element))
                continue;
            result = element;
            break;
        }
        return result;
    }

    public static <T> T select(Collection<T> target, IPredicate<T> predicate, T defaultValue) {
        T result = defaultValue;
        for (T element : target) {
            if (!predicate.apply(element))
                continue;
            result = element;
            break;
        }
        return result;
    }
} 
```

以下示例在集合之间查找缺失的对象：

```
List<MyTypeA> missingObjects = (List<MyTypeA>) Predicate.filter(myCollectionOfA,
    new IPredicate<MyTypeA>() {
        public boolean apply(MyTypeA objectOfA) {
            Predicate.predicateParams = objectOfA.getName();
            return Predicate.select(myCollectionB, new IPredicate<MyTypeB>() {
                public boolean apply(MyTypeB objectOfB) {
                    return objectOfB.getName().equals(Predicate.predicateParams.toString());
                }
            }) == null;
        }
    }); 
```

以下示例在集合中查找实例，并在未找到该实例时将集合的第一个元素作为默认值返回：

```
MyType myObject = Predicate.select(collectionOfMyType, new IPredicate<MyType>() {
public boolean apply(MyType objectOfMyType) {
    return objectOfMyType.isDefault();
}}, collectionOfMyType.get(0)); 
```

更新（Java 8 发布后）：

自从我（艾伦）第一次发布这个答案以来已经有好几年了，我仍然不敢相信我正在为这个答案收集 SO 积分。无论如何，既然 Java 8 已经为该语言引入了闭包，那么我的答案现在会大不相同，而且更简单。使用 Java 8，不需要一个独特的静态实用程序类。因此，如果您想找到与谓词匹配的第一个元素。

```
final UserService userService = ... // perhaps injected IoC
final Optional<UserModel> userOption = userCollection.stream().filter(u -> {
    boolean isAuthorized = userService.isAuthorized(u);
    return isAuthorized;
}).findFirst(); 
```

用于选项的 JDK 8 API 能够使用`get()`、`isPresent()`、和`orElse(defaultUser)`，以及其他“单子”函数，例如、和。`orElseGet(userSupplier)``orElseThrow(exceptionSupplier)``map``flatMap``filter`

如果您只想收集与谓词匹配的所有用户，则使用`Collectors`终止所需集合中的流。

```
final UserService userService = ... // perhaps injected IoC
final List<UserModel> userOption = userCollection.stream().filter(u -> {
    boolean isAuthorized = userService.isAuthorized(u);
    return isAuthorized;
}).collect(Collectors.toList()); 
```

有关 Java 8 流如何工作的更多示例，请参见[此处](http://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/)。

* * *

## 回答 #3

> 赞同：93
> 
> 时间：2008-09-23T16:28:43.867

使用来自 Apache Commons 的[CollectionUtils.filter(Collection,Predicate) 。](https://commons.apache.org/proper/commons-collections/javadocs/api-release/org/apache/commons/collections4/CollectionUtils.html#filter(java.lang.Iterable,%20org.apache.commons.collections4.Predicate))

* * *

## 回答 #4

> 赞同：68
> 
> 时间：2008-09-23T16:41:32.557

“最佳”方式的要求太宽泛了。它是“最短的”吗？“最快的”？“可读”？过滤就地或进入另一个集合？

最简单（但不是最易读）的方法是迭代它并使用 Iterator.remove() 方法：

```
Iterator<Foo> it = col.iterator();
while( it.hasNext() ) {
  Foo foo = it.next();
  if( !condition(foo) ) it.remove();
} 
```

现在，为了使其更具可读性，您可以将其包装到实用程序方法中。然后发明一个 IPredicate 接口，创建该接口的匿名实现并执行以下操作：

```
CollectionUtils.filterInPlace(col,
  new IPredicate<Foo>(){
    public boolean keepIt(Foo foo) {
      return foo.isBar();
    }
  }); 
```

其中 filterInPlace() 迭代集合并调用 Predicate.keepIt() 以了解实例是否保留在集合中。

我真的不认为有理由为这项任务引入第三方库。

* * *

## 回答 #5

> 赞同：62
> 
> 时间：2008-09-23T16:29:49.090

考虑[Google Collections](http://code.google.com/p/google-collections/)以获得支持泛型的更新的 Collections 框架。

**更新**：谷歌收藏库现已弃用。您应该改用最新版本的[Guava](https://github.com/google/guava)。它仍然具有对集合框架的所有相同扩展，包括基于谓词的过滤机制。

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2013-08-29T10:50:37.110

等待 Java 8：

```
List<Person> olderThan30 = 
  //Create a Stream from the personList
  personList.stream().
  //filter the element to select only those with age >= 30
  filter(p -> p.age >= 30).
  //put those filtered elements into a new List.
  collect(Collectors.toList()); 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2013-10-27T21:41:55.647

从 Java 8 的早期版本开始，您可以尝试以下操作：

```
Collection<T> collection = ...;
Stream<T> stream = collection.stream().filter(...); 
```

例如，如果您有一个整数列表，并且想要过滤大于 10 的数字，然后将这些数字打印到控制台，您可以执行以下操作：

```
List<Integer> numbers = Arrays.asList(12, 74, 5, 8, 16);
numbers.stream().filter(n -> n > 10).forEach(System.out::println); 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2014-07-24T02:13:01.357

我将把[RxJava 扔进](https://github.com/ReactiveX/RxJava)戒指，它也可以在[Android](https://github.com/ReactiveX/RxAndroid)上使用。RxJava 可能并不总是最好的选择，但如果您希望在您的集合上添加更多转换或在过滤时处理错误，它将为您提供更大的灵活性。

```
Observable.from(Arrays.asList(1, 2, 3, 4, 5))
    .filter(new Func1<Integer, Boolean>() {
        public Boolean call(Integer i) {
            return i % 2 != 0;
        }
    })
    .subscribe(new Action1<Integer>() {
        public void call(Integer i) {
            System.out.println(i);
        }
    }); 
```

输出：

```
1
3
5 
```

更多关于 RxJava 的细节`filter`可以在[这里](https://github.com/ReactiveX/RxJava/wiki/Filtering-Observables#filter)找到。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-09-23T16:41:08.207

您确定要过滤 Collection 本身，而不是迭代器吗？

见[org.apache.commons.collections.iterators.FilterIterator](http://commons.apache.org/proper/commons-collections/javadocs/api-3.2.1/org/apache/commons/collections/iterators/FilterIterator.html)

或使用版本 4 的 apache commons [org.apache.commons.collections4.iterators.FilterIterator](https://commons.apache.org/proper/commons-collections/apidocs/org/apache/commons/collections4/iterators/FilterIterator.html)

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-09-23T16:41:27.067

设置：

```
public interface Predicate<T> {
  public boolean filter(T t);
}

void filterCollection(Collection<T> col, Predicate<T> predicate) {
  for (Iterator i = col.iterator(); i.hasNext();) {
    T obj = i.next();
    if (predicate.filter(obj)) {
      i.remove();
    }
  }
} 
```

用法：

```
List<MyObject> myList = ...;
filterCollection(myList, new Predicate<MyObject>() {
  public boolean filter(MyObject obj) {
    return obj.shouldFilter();
  }
}); 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2012-09-24T22:28:48.597

让我们看看如何使用[Eclipse Collections过滤内置的 JDK List 和](https://www.eclipse.org/collections/)[MutableList](https://www.eclipse.org/collections/javadoc/10.0.0/org/eclipse/collections/api/list/MutableList.html)。

```
List<Integer> jdkList = Arrays.asList(1, 2, 3, 4, 5);
MutableList<Integer> ecList = Lists.mutable.with(1, 2, 3, 4, 5); 
```

如果您想过滤小于 3 的数字，您会期望得到以下输出。

```
List<Integer> selected = Lists.mutable.with(1, 2);
List<Integer> rejected = Lists.mutable.with(3, 4, 5); 
```

以下是使用 Java 8 lambda 作为`Predicate`.

```
Assert.assertEquals(selected, Iterate.select(jdkList, each -> each < 3));
Assert.assertEquals(rejected, Iterate.reject(jdkList, each -> each < 3));

Assert.assertEquals(selected, ecList.select(each -> each < 3));
Assert.assertEquals(rejected, ecList.reject(each -> each < 3)); 
```

以下是使用匿名内部类作为`Predicate`.

```
Predicate<Integer> lessThan3 = new Predicate<Integer>()
{
    public boolean accept(Integer each)
    {
        return each < 3;
    }
};

Assert.assertEquals(selected, Iterate.select(jdkList, lessThan3));
Assert.assertEquals(selected, ecList.select(lessThan3)); 
```

[以下是使用Predicates](https://www.eclipse.org/collections/javadoc/10.0.0/org/eclipse/collections/impl/block/factory/Predicates.html)工厂过滤 JDK 列表和[Eclipse Collections](https://www.eclipse.org/collections/) MutableLists的一些替代方法。

```
Assert.assertEquals(selected, Iterate.select(jdkList, Predicates.lessThan(3)));
Assert.assertEquals(selected, ecList.select(Predicates.lessThan(3))); 
```

这是一个不为谓词分配对象的版本，通过使用[Predicates2](https://www.eclipse.org/collections/javadoc/10.0.0/org/eclipse/collections/impl/block/factory/Predicates2.html)工厂而不是`selectWith`采用`Predicate2`.

```
Assert.assertEquals(
    selected, ecList.selectWith(Predicates2.<Integer>lessThan(), 3)); 
```

有时你想过滤一个否定的条件。Eclipse Collections 中有一个特殊的方法，叫做`reject`.

```
Assert.assertEquals(rejected, Iterate.reject(jdkList, lessThan3));
Assert.assertEquals(rejected, ecList.reject(lessThan3)); 
```

该方法`partition`将返回两个集合，其中包含由 选择和拒绝的元素`Predicate`。

```
PartitionIterable<Integer> jdkPartitioned = Iterate.partition(jdkList, lessThan3);
Assert.assertEquals(selected, jdkPartitioned.getSelected());
Assert.assertEquals(rejected, jdkPartitioned.getRejected());

PartitionList<Integer> ecPartitioned = gscList.partition(lessThan3);
Assert.assertEquals(selected, ecPartitioned.getSelected());
Assert.assertEquals(rejected, ecPartitioned.getRejected()); 
```

注意：我是 Eclipse Collections 的提交者。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2014-05-12T05:03:57.270

一些简单明了的 Java 怎么样？

```
 List<Customer> list ...;
 List<Customer> newList = new ArrayList<>();
 for (Customer c : list){
    if (c.getName().equals("dd")) newList.add(c);
 } 
```

简单、易读且容易（并且可以在 Android 中使用！）但是如果您使用的是 Java 8，您可以通过简单的一行代码来实现：

```
List<Customer> newList = list.stream().filter(c -> c.getName().equals("dd")).collect(toList()); 
```

注意 toList() 是静态导入的

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-09-23T18:21:13.253

[Google 的 Guava 库](http://code.google.com/p/guava-libraries/)中的[Collections2.filter(Collection,Predicate)](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/collect/Collections2.html#filter%28java.util.Collection,%20com.google.common.base.Predicate%29)方法可以满足您的需求。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2008-12-03T13:45:55.703

使用 ForEach DSL，您可以编写

```
import static ch.akuhn.util.query.Query.select;
import static ch.akuhn.util.query.Query.$result;
import ch.akuhn.util.query.Select;

Collection<String> collection = ...

for (Select<String> each : select(collection)) {
    each.yield = each.value.length() > 3;
}

Collection<String> result = $result(); 
```

给定一个 [The, quick, brown, fox, jumps, over, the,lazy, dog] 的集合，这将导致 [quick, brown, jumps, over, lazy]，即所有长度超过三个字符的字符串。

ForEach DSL 支持的所有迭代样式都是

*   `AllSatisfy`
*   `AnySatisfy`
*   `Collect`
*   `Counnt`
*   `CutPieces`
*   `Detect`
*   `GroupedBy`
*   `IndexOf`
*   `InjectInto`
*   `Reject`
*   `Select`

更多详情请参考[https://www.iam.unibe.ch/scg/svn_repos/Sources/ForEach](https://www.iam.unibe.ch/scg/svn_repos/Sources/ForEach)

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2018-05-24T13:59:00.170

由于启用**了 java 9 ：** `Collectors.filtering`

```
public static <T, A, R>
    Collector<T, ?, R> filtering(Predicate<? super T> predicate,
                                 Collector<? super T, A, R> downstream) 
```

因此过滤应该是：

```
collection.stream().collect(Collectors.filtering(predicate, collector)) 
```

例子：

```
List<Integer> oddNumbers = List.of(1, 19, 15, 10, -10).stream()
            .collect(Collectors.filtering(i -> i % 2 == 1, Collectors.toList())); 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2010-01-21T04:35:30.130

这一点，再加上缺乏真正的闭包，是我对 Java 最大的抱怨。老实说，上面提到的大多数方法都非常容易阅读并且非常有效。然而，在花时间使用 .Net、Erlang 等之后......在语言级别集成的列表理解使一切变得更加清晰。如果没有语言级别的添加，Java 就不能像该领域的许多其他语言一样干净。

如果性能是一个巨大的问题，谷歌集合是要走的路（或编写自己的简单谓词实用程序）。Lambdaj 语法对某些人来说更具可读性，但效率不高。

然后是我写的一个库。我会忽略任何关于它的效率的问题（是的，它很糟糕）......是的，我清楚地知道它是基于反射的，不，我实际上并没有使用它，但它确实有效：

```
LinkedList<Person> list = ......
LinkedList<Person> filtered = 
           Query.from(list).where(Condition.ensure("age", Op.GTE, 21)); 
```

**或者**

```
LinkedList<Person> list = ....
LinkedList<Person> filtered = Query.from(list).where("x => x.age >= 21"); 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2010-04-05T12:43:11.587

我编写[了一个扩展的 Iterable 类](https://github.com/genezys/functional/blob/master/src/main/java/fr/cantor/functional/Iterable.java#L204)，它支持在不复制集合内容的情况下应用功能算法。

用法：

```
List<Integer> myList = new ArrayList<Integer>(){ 1, 2, 3, 4, 5 }

Iterable<Integer> filtered = Iterable.wrap(myList).select(new Predicate1<Integer>()
{
    public Boolean call(Integer n) throws FunctionalException
    {
        return n % 2 == 0;
    }
})

for( int n : filtered )
{
    System.out.println(n);
} 
```

上面的代码将实际执行

```
for( int n : myList )
{
    if( n % 2 == 0 ) 
    {
        System.out.println(n);
    }
} 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2012-04-05T10:46:58.387

JFilter [http://code.google.com/p/jfilter/](http://code.google.com/p/jfilter/)最适合您的要求。

JFilter 是一个用于查询 Java bean 集合的简单且高性能的开源库。

主要特点

*   支持集合（java.util.Collection、java.util.Map 和 Array）属性。
*   支持任意深度的集合内集合。
*   支持内部查询。
*   支持参数化查询。
*   可以在 100 毫秒内过滤 100 万条记录。
*   过滤器（查询）以简单的 json 格式给出，类似于 Mangodb 查询。以下是一些例子。
*   { "id":{"$le":"10"}
    *   其中对象 id 属性小于等于 10。
*   { "id": {"$in":["0", "100"]}}
    *   其中对象 id 属性为 0 或 100。
*   {"lineItems":{"lineAmount":"1"}}
    *   其中参数化类型的 lineItems 集合属性的 lineAmount 等于 1。
*   { "$and":[{"id":"0"}, {"billingAddress":{"city":"DEL"}}]}
    *   其中 id 属性为 0，而 billingAddress.city 属性为 DEL。
*   {"lineItems":{"taxes":{ "key":{"code":"GST"}, "value":{"$gt":"1.01"}}}}
    *   其中参数化类型的 lineItems 集合属性具有参数化类型的税收地图类型属性的代码等于大于 1.01 的 GST 值。
*   {'$or':[{'code':'10'},{'skus': {'$and':[{'price':{'$in':['20', '40']} }, {'code':'RedApple'}]}}]}
    *   选择产品代码为 10 或 sku 价格为 20 和 40 且 sku 代码为“RedApple”的所有产品。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2012-07-29T22:12:45.320

使用[集合查询引擎（CQEngine）](https://github.com/npgall/cqengine)。这是迄今为止最快的方法。

另请参阅：[如何在 Java 中查询对象集合（Criteria/SQL-like）？](https://stackoverflow.com/a/11712925/812018)

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2015-01-07T11:07:38.423

这里有一些非常棒的答案。我，我想保持尽可能简单和可读：

```
public abstract class AbstractFilter<T> {

    /**
     * Method that returns whether an item is to be included or not.
     * @param item an item from the given collection.
     * @return true if this item is to be included in the collection, false in case it has to be removed.
     */
    protected abstract boolean excludeItem(T item);

    public void filter(Collection<T> collection) {
        if (CollectionUtils.isNotEmpty(collection)) {
            Iterator<T> iterator = collection.iterator();
            while (iterator.hasNext()) {
                if (excludeItem(iterator.next())) {
                    iterator.remove();
                }
            }
        }
    }
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2015-12-12T21:47:55.503

使用`java 8`, 具体来说`lambda expression`，您可以像下面的示例一样简单地执行此操作：

```
myProducts.stream().filter(prod -> prod.price>10).collect(Collectors.toList()) 
```

where 对于每个`product`内部`myProducts`集合，如果`prod.price>10`，则将此产品添加到新的过滤列表中。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2018-10-18T13:40:04.420

在 Java 8 中，您可以直接使用此过滤器方法，然后执行此操作。

```
 List<String> lines = Arrays.asList("java", "pramod", "example");

 List<String> result = lines.stream()              
         .filter(line -> !"pramod".equals(line))     
         .collect(Collectors.toList());              

 result.forEach(System.out::println); 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2014-07-03T18:54:39.753

简单的 pre-Java8 解决方案：

```
ArrayList<Item> filtered = new ArrayList<Item>(); 
for (Item item : items) if (condition(item)) filtered.add(item); 
```

不幸的是，这个解决方案不是完全通用的，输出一个列表而不是给定集合的类型。此外，除非条件很复杂，否则引入库或编写包装此代码的函数对我来说似乎有点矫枉过正，但是您可以为该条件编写一个函数。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2014-09-03T12:59:35.897

[https://code.google.com/p/joquery/](https://code.google.com/p/joquery/)

支持不同的可能性，

给定收藏，

```
Collection<Dto> testList = new ArrayList<>(); 
```

类型，

```
class Dto
{
    private int id;
    private String text;

    public int getId()
    {
        return id;
    }

    public int getText()
    {
        return text;
    }
} 
```

**筛选**

***爪哇 7***

```
Filter<Dto> query = CQ.<Dto>filter(testList)
    .where()
    .property("id").eq().value(1);
Collection<Dto> filtered = query.list(); 
```

***爪哇 8***

```
Filter<Dto> query = CQ.<Dto>filter(testList)
    .where()
    .property(Dto::getId)
    .eq().value(1);
Collection<Dto> filtered = query.list(); 
```

还，

```
Filter<Dto> query = CQ.<Dto>filter()
        .from(testList)
        .where()
        .property(Dto::getId).between().value(1).value(2)
        .and()
        .property(Dto::grtText).in().value(new string[]{"a","b"}); 
```

**排序**（也可用于 Java 7）

```
Filter<Dto> query = CQ.<Dto>filter(testList)
        .orderBy()
        .property(Dto::getId)
        .property(Dto::getName)
    Collection<Dto> sorted = query.list(); 
```

**分组**（也可用于 Java 7）

```
GroupQuery<Integer,Dto> query = CQ.<Dto,Dto>query(testList)
        .group()
        .groupBy(Dto::getId)
    Collection<Grouping<Integer,Dto>> grouped = query.list(); 
```

**联接**（也可用于 Java 7）

鉴于，

```
class LeftDto
{
    private int id;
    private String text;

    public int getId()
    {
        return id;
    }

    public int getText()
    {
        return text;
    }
}

class RightDto
{
    private int id;
    private int leftId;
    private String text;

    public int getId()
    {
        return id;
    }

    public int getLeftId()
        {
            return leftId;
        }

    public int getText()
    {
        return text;
    }
}

class JoinedDto
{
    private int leftId;
    private int rightId;
    private String text;

    public JoinedDto(int leftId,int rightId,String text)
    {
        this.leftId = leftId;
        this.rightId = rightId;
        this.text = text;
    }

    public int getLeftId()
    {
        return leftId;
    }

    public int getRightId()
        {
            return rightId;
        }

    public int getText()
    {
        return text;
    }
}

Collection<LeftDto> leftList = new ArrayList<>();

Collection<RightDto> rightList = new ArrayList<>(); 
```

可以加入喜欢，

```
Collection<JoinedDto> results = CQ.<LeftDto, LeftDto>query().from(leftList)
                .<RightDto, JoinedDto>innerJoin(CQ.<RightDto, RightDto>query().from(rightList))
                .on(LeftFyo::getId, RightDto::getLeftId)
                .transformDirect(selection ->  new JoinedDto(selection.getLeft().getText()
                                                     , selection.getLeft().getId()
                                                     , selection.getRight().getId())
                                 )
                .list(); 
```

**表达式**

```
Filter<Dto> query = CQ.<Dto>filter()
    .from(testList)
    .where()
    .exec(s -> s.getId() + 1).eq().value(2); 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2015-04-22T11:18:24.310

`CollectionUtils`我的答案建立在 Kevin Wong 的基础上，这里是使用from *spring*和 Java 8 *lambda*表达式的单行代码。

```
CollectionUtils.filter(list, p -> ((Person) p).getAge() > 16); 
```

这与我见过的任何替代方法一样简洁易读（不使用基于方面的库）

Spring [CollectionUtils](http://docs.spring.io/autorepo/docs/spring/4.0.2.RELEASE/javadoc-api/org/springframework/util/CollectionUtils.html)从 spring 版本 4.0.2.RELEASE 开始可用，记住你需要 JDK 1.8 和语言级别 8+。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2017-06-15T14:28:05.380

我需要根据列表中已经存在的值过滤列表。例如，删除所有小于当前值的值。{2 5 3 4 7 5} -> {2 5 7}。或者例如删除所有重复项 {3 5 4 2 3 5 6} -> {3 5 4 2 6}。

```
public class Filter {
    public static <T> void List(List<T> list, Chooser<T> chooser) {
        List<Integer> toBeRemoved = new ArrayList<>();
        leftloop:
        for (int right = 1; right < list.size(); ++right) {
            for (int left = 0; left < right; ++left) {
                if (toBeRemoved.contains(left)) {
                    continue;
                }
                Keep keep = chooser.choose(list.get(left), list.get(right));
                switch (keep) {
                    case LEFT:
                        toBeRemoved.add(right);
                        continue leftloop;
                    case RIGHT:
                        toBeRemoved.add(left);
                        break;
                    case NONE:
                        toBeRemoved.add(left);
                        toBeRemoved.add(right);
                        continue leftloop;
                }
            }
        }

        Collections.sort(toBeRemoved, new Comparator<Integer>() {
            @Override
            public int compare(Integer o1, Integer o2) {
                return o2 - o1;
            }
        });

        for (int i : toBeRemoved) {
            if (i >= 0 && i < list.size()) {
                list.remove(i);
            }
        }
    }

    public static <T> void List(List<T> list, Keeper<T> keeper) {
        Iterator<T> iterator = list.iterator();
        while (iterator.hasNext()) {
            if (!keeper.keep(iterator.next())) {
                iterator.remove();
            }
        }
    }

    public interface Keeper<E> {
        boolean keep(E obj);
    }

    public interface Chooser<E> {
        Keep choose(E left, E right);
    }

    public enum Keep {
        LEFT, RIGHT, BOTH, NONE;
    }
} 
```

这将像这样使用。

```
List<String> names = new ArrayList<>();
names.add("Anders");
names.add("Stefan");
names.add("Anders");
Filter.List(names, new Filter.Chooser<String>() {
    @Override
    public Filter.Keep choose(String left, String right) {
        return left.equals(right) ? Filter.Keep.LEFT : Filter.Keep.BOTH;
    }
}); 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2021-07-27T14:56:00.407

就我而言，我正在寻找排除特定字段 null 的列表。这可以通过 for 循环来完成，并填充没有空地址的对象的临时列表。但感谢 Java 8 Streams

```
List<Person> personsList = persons.stream()
.filter(p -> p.getAdrress() != null).collect(Collectors.toList()); 
```

#java #collection #collections #java8 #streams

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-12-15T09:20:47.887

与番石榴：

```
Collection<Integer> collection = Lists.newArrayList(1, 2, 3, 4, 5);

Iterators.removeIf(collection.iterator(), new Predicate<Integer>() {
    @Override
    public boolean apply(Integer i) {
        return i % 2 == 0;
    }
});

System.out.println(collection); // Prints 1, 3, 5 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-10-03T10:26:42.190

Java 集合流的替代（更轻量级）替代方案是 Ocl.java 库，它使用 vanilla 集合和 lambda：[https ://github.com/eclipse/agileuml/blob/master/Ocl.java](https://github.com/eclipse/agileuml/blob/master/Ocl.java)

例如，ArrayList 单词的简单过滤器和求和可以是：

```
ArrayList<Word> sel = Ocl.selectSequence(words, 
                             w -> w.pos.equals("NN")); 
int total = Ocl.sumint(Ocl.collectSequence(sel,
                             w -> w.text.length())); 
```

其中 Word 有字符串 pos；字符串文本；属性。效率似乎类似于流选项，例如，两个版本在大约 50 毫秒内处理 10000 个单词。

Python、Swift 等有等效的 OCL 库。基本上，Java 集合流重新发明了 OCL 操作 ->select、->collect 等，这些操作自 1998 年以来就存在于 OCL 中。

# svn - 从 Subversion 签出一个文件

> ID：122107
> 
> 赞同：333
> 
> 时间：2008-09-23T16:26:32.453
> 
> 标签：svn, version-control

**“不可能签出单个文件。您可以执行的最佳签出级别是在目录级别。”**

使用 Subversion 时如何解决这个问题？

我们在 Subversion 中有这个文件夹，我们保存所有的图像。我只想从中签出一个文件（图像）。这个文件夹真的很大，还有很多我现在不需要的东西。

* * *

## 回答 #1

> 赞同：412
> 
> 时间：2008-09-23T16:58:27.773

简单的答案是你`svn export`的文件而不是检查它。

但这可能不是你想要的。您可能想要处理该文件并将其重新签入，而无需下载 GB 的您不需要的垃圾。

如果您有 Subversion 1.5+，则进行稀疏检出：

```
svn checkout <url_of_big_dir> <target> --depth empty
cd <target>
svn up <file_you_want> 
```

对于旧版本的 SVN，您可能会受益于以下内容：

*   使用遥远的过去的修订检查目录，当时它不那么充满你不需要的垃圾。
*   更新您想要的文件，以创建混合修订。即使您签出的修订版中不存在该文件，这也有效。
*   利润！

另一种选择（例如，如果目录在创建它的修订版中包含太多垃圾）是执行 URL-> URL 复制您想要的文件到存储库中的新位置（实际上这是一个工作分支文件）。查看该目录并进行修改。

我不确定您是否可以在没有目标工作副本的情况下将修改后的副本完全合并回存储库中——我从来不需要这样做。如果是这样，那就这样做。

如果不是，那么不幸的是，您可能必须找到其他人已经检查了整个目录并让他们这样做。或者，当您进行修改时，其余部分将完成下载......

* * *

## 回答 #2

> 赞同：116
> 
> 时间：2008-09-23T16:29:12.743

尝试`svn export`代替`svn checkout`. 这适用于单个文件。

限制的原因是`checkout`创建了一个工作副本，其中包含有关存储库、修订、属性等的元信息。该元数据存储在名为“.svn”的子目录中。单个文件没有子目录。

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2008-09-23T16:28:33.867

使用`svn cat`或`svn export`。

为此，您不需要获取工作目录，但您将无法提交您所做的任何更改。如果您需要进行更改并提交它们，您需要一个工作目录，但您不必完全获取它。检查目录仍然/几乎为空的修订版，然后使用“svn cat”从 HEAD 中提取文件。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-10-30T18:21:20.757

您可以分两步完成：

1.  签出仅包含元信息的空 SVN 存储库：

    ```
    $ cd /tmp

    $ svn co --depth empty http://svn.your.company.ca/training/trunk/sql 
    ```

2.  运行`svn up`以更新指定文件：

    ```
    $ svn up http://svn.your.company.ca/training/trunk/sql/showSID.sql 
    ```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-23T16:30:01.743

> 如果您想查看存储库中的 readme.txt 而不签出：
> 
> $ svn cat [http://svn.red-bean.com/repos/test/readme.txt](http://svn.red-bean.com/repos/test/readme.txt)
> 这是一个 README 文件。你应该读这个。
> 
> 提示：如果您的工作副本已过期（或者您有本地修改）并且您想查看工作副本中文件的 HEAD 修订版，则 svn cat 将在您提供路径时自动获取 HEAD 修订版：
> 
> $ cat foo.c
> 这个文件在我的本地工作副本中，并且有我所做的更改。
> 
> $ svn cat foo.c
> 来自存储库的最新版本！

[来源](http://svnbook.red-bean.com/en/1.0/re03.html)

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-12-02T07:37:47.390

下面是一个接受答案的 TortoiseSVN 等效解决方案（我已经在我公司的内部文档中写了这个，因为我们正在新采用 SVN）。我认为在这里分享也会有所帮助：

检出单个文件：Subversion 不支持检出单个文件，它只支持检出目录结构。（参考：[http](http://subversion.tigris.org/faq.html#single-file-checkout) ://subversion.tigris.org/faq.html#single-file-checkout ）。*这是因为对于作为工作副本检出的每个目录，有关修改/文件修订的元数据都存储为内部隐藏文件夹 (.svn/_svn)。目前 (v1.6) 不支持单个文件。*

替代推荐策略：您只需执行一次签出目录部分，然后您可以直接去签出您的单个文件。对父文件夹和目录结构进行稀疏检出。稀疏检出基本上只检出文件夹结构而不填充内容文件。因此，您只需签出目录结构，而无需像关注的那样签出所有文件。参考：[http ://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-checkout.html](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-checkout.html)

**第 1 步**：进入存储库浏览器

**第 2 步**：右键单击存储库中包含您要处理的所有文件的父文件夹，然后选择 Checkout。

**第 3 步**：在新的弹出窗口中，确保结帐目录指向本地 PC 上的正确位置。还将有一个标有“结帐深度”的下拉菜单。根据您的要求选择“仅此项目”或“直接子项，包括文件夹”。建议使用第二个选项，因为如果您想处理嵌套文件夹，您可以下次直接继续，否则您将不得不再次为嵌套文件夹执行整个过程。

**第 4 步**：父文件夹现在应该在您本地选择的文件夹中可用，并且现在正在使用 SVN 进行监视（现在应该存在隐藏文件夹“.svn”或“_svn”）。现在在存储库中，右键单击您希望单独签出的单个文件，然后选择“将项目更新到修订版”选项。现在可以处理单个文件并将其签回存储库。

我希望这有帮助。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-10-20T01:05:33.023

将文件包含在另一个文件夹的签出中可以覆盖您真正需要的更新。

从 SVN 1.6 开始，您可以制作[文件 externals](http://svnbook.red-bean.com/nightly/en/svn.advanced.externals.html)，一种 svn 链接。这意味着您可以拥有另一个包含单个文件的版本化文件夹。也可以在签出此文件夹时提交对文件的更改。

很简单，签出你想要包含文件的文件夹，然后简单的给文件夹添加一个属性

```
svn propedit svn:externals . 
```

内容如下：

```
file.txt /repos/path/to/file.txt 
```

提交后，该文件将出现在该文件夹的未来签出中。基本上它可以工作，但是如上面链接的文档中所述，存在一些限制。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-12-15T20:59:40.660

```
cd C:\path\dir
svn checkout https://server/path/to/trunk/dir/dir/parent_dir--depth empty
cd C:\path\dir\parent_dir
svn update filename.log 
```

（编辑文件名.log）

```
svn commit -m "this is a comment." 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-23T16:31:43.190

我只是浏览它并导出单个文件。如果您有 HTTP 访问权限，只需使用 Web 浏览器查找文件并获取它。

如果您需要在编辑后将其放回，那可能会稍微乏味一些，但我相信可能会有一个`svn import`功能......

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-23T16:39:14.433

转到 repo-browser 右键单击​​该文件并使用“另存为”，不过我使用的是 TortoiseSVN。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-08-28T18:12:31.123

[史蒂夫杰索普的回答](https://stackoverflow.com/questions/122107/checkout-one-file-from-subversion/122291#122291)对我不起作用。我阅读了 SVN 的帮助文件，如果您只有一张图像，除非您正在使用 Photoshop，否则您可能不想再次检入它，因此**导出**是一个比检出更好的命令，因为它是未版本化的（但这是次要的）。

并且**--depth** ARG 不应为**空**，而是用于获取直接目录中的文件的文件**。**因此，您将获得所有字段，而不仅仅是一个，但**empty**不会从存储库中返回*任何内容。*

```
 svn co --depth files <source> <local dest> 
```

或者

```
svn export --depth files <source> <local dest> 
```

至于其他答案，**cat**让您阅读仅对文本有用的内容，而不是所有事物的图像。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-04-25T09:43:49.613

做这样的事情：

```
mkdir <your directory>/repos/test

svn cat http://svn.red-bean.com/repos/test/readme.txt > <your directory>/repos/test/readme.txt 
```

基本上这个想法是创建要从 SVN 获取文件的目录。使用该`svn cat`命令并将输出重定向到相同的命名文件。默认情况下，cat 会将信息转储到 stdio。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-23T16:32:27.977

如果您只想要一个没有修订信息的文件，请使用

```
svn export <URL> 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-23T21:22:33.787

使用 Subversion 1.5，可以签出（所有）目录的文件，而无需签出任何子目录（各种 --depth 标志）。不完全是您要求的，而是一种“少于全部”的形式。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-07-16T06:29:51.093

使用稀疏签出技术，您可以签出一个已经签出或存在的特定文件......使用一个简单的技巧：

使用“仅此项目”选项签出存储库的顶层后，在 Windows 资源管理器中，您必须首先右键单击需要更新的文件；在上下文菜单中选择回购浏览器；在存储库浏览器中再次找到该文件，然后右键单击。您现在应该在上下文菜单中看到“将项目更新到修订版”。

我不确定它是一个未记录的功能还是一个错误。我花了很长的下班时间才终于找到这个技巧。我正在使用[TortoiseSVN](http://en.wikipedia.org/wiki/TortoiseSVN) 1.6.2。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2012-02-04T21:17:12.333

我想将单个文件签出到一个目录，该目录不是工作副本的一部分。

让我们从以下 URL 获取文件：[http://subversion.repository.server/repository/module/directory/myfile](http://subversion.repository.server/repository/module/directory/myfile)

```
svn co  http://subversion.repository.server/repository/module/directory/myfile /**directoryb** 
```

所以我检查了包含目标文件的给定目录，我想进入一个虚拟目录（比如以 . 结尾的 URL 的 etcb `/etc`）。

然后我从我不需要的目标目录的所有文件中清空文件**.svn/entries ，只留下我想要的文件。**在这个**.svn/entries**文件中，您有每个文件的记录及其属性，因此只保留与您要获取和保存的文件有关的记录。

现在您只需将 ''.svn'' 复制到将成为新“工作副本”的目录。然后你只需要：

```
cp .svn /directory
cd /directory
svn update myfile 
```

现在目录**目录**受版本控制。不要忘记删除只是“临时工作副本”的目录**directoryb 。**

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2017-01-03T08:41:21.910

由于没有其他答案对我有用，所以我使用这个 hack 做到了：

```
$ cd /yourfolder
svn co https://path-to-folder-which-has-your-files/ --depth files 
```

这将创建一个新的本地文件夹，其中仅包含远程路径中的文件。然后，您可以在此处创建指向您想要的文件的符号链接。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-12-24T17:04:39.543

此问题涵盖：

[http://subversion.tigris.org/issues/show_bug.cgi?id=823](http://subversion.tigris.org/issues/show_bug.cgi?id=823)

附有一个脚本，可让您从 svn 签出单个文件，进行更改并将更改提交回存储库，但您不能运行“svn up”来签出目录的其余部分。它已经用 svn-1.3、1.4 和 1.6 进行了测试。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-04-06T14:00:54.663

如果您只想导出文件，并且以后不需要更新它，则无需使用 SVN 命令即可。

使用**TortoiseSVN 存储库浏览器**，选择文件，右键单击，然后选择“**复制 URL 到剪贴板**”。将该 URL 粘贴到您的浏览器，登录后系统会提示您下载文件。

这样，您还可以选择所需的修订版并下载文件的旧版本。

*请注意，如果您的 SVN 服务器具有 Web 界面，则这是有效的。*

# asp.net - 如何在 ASP.NET 中使用 WMD 存储降价？

> ID：122108
> 
> 赞同：10
> 
> 时间：2008-09-23T16:26:45.697
> 
> 标签：asp.net, markdown, wmd

我已经在我的项目中实现了 Stack Overflow 使用的 WMD 控件，它**几乎**就像一个魅力，但是当我将更改保存到数据库时，它保存的是 HTML 版本而不是 Markdown 版本。

所以我在我的文本框中有这个：

```
**boldtext** 
```

它真的节省了这个：

```
<b>boldtext</b> 
```

如何让它保存 Markdown 版本？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T17:47:12.367

在包含`wmd.js`或任何您在本地命名的 WMD 编辑器 JavaScript 代码之前，添加一行 JavaScript 代码：

```
wmd_options = {"output": "Markdown"}; 
```

这将强制编辑器的输出为 Markdown。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-20T16:31:18.983

如果您使用来自[http://code.google.com/p/wmd-new/](http://code.google.com/p/wmd-new/)的新 WMD ，请打开**wmd.js**并添加以下行：

```
wmd.wmd_env.output = 'markdown'; 
```

摘抄：

```
...
wmd.ieCachedRange = null; // cached textarea selection
wmd.ieRetardedClick = false; // flag

wmd.wmd_env.output = 'markdown'; // force markdown output

// Returns true if the DOM element is visible, false if it's hidden.
// Checks if display is anything other than none.
util.isVisible = function (elem) {
... 
```

这应该够了吧。

# c# - 如何将 PDF 文件拆分为页面（最好是 C#）

> ID：122109
> 
> 赞同：16
> 
> 时间：2008-09-23T16:26:45.930
> 
> 标签：c#, pdf

我的客户有一个多页的 PDF 文件。他们需要按页面拆分。有谁知道这样做的方法 - 最好在 C# 中。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-23T16:29:47.343

[PDFSharp](http://www.pdfsharp.com/)是一个开源库，可能是您所追求的：

> 主要特点
> 
> *   使用任何 .Net 语言即时创建 PDF 文档
> *   易于理解的对象模型来编写文档
> *   一种用于在 PDF 页面以及窗口或打印机上绘图的源代码
> *   修改、合并和拆分现有 PDF 文件

[此示例](http://www.pdfsharp.com/PDFsharp/index.php?option=com_content&task=view&id=37&Itemid=48)说明如何将具有 n 页的 PDF 文档转换为 n 个文档，每个文档一页。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T16:31:01.723

我使用[ITextSharp](http://itextsharp.sourceforge.net)做到了这一点——有一些商业选项可能有一个很好的 API，但这是开源和免费的，而且不难使用。

查看[这段代码](http://itextsharp.sourceforge.net/examples/Split.cs)，这是他们的代码示例之一——非常好。它在传入的页码处将 PDF 文件拆分为两个文件。您可以将其修改为逐页循环和拆分。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T23:00:54.220

Siberix 提供了一个成本合理的商业库，用于在 .NET 中动态创建 PDF：[http](http://siberix.com) ://siberix.com 您可以通过编程方式或通过 XML 转换（以及两种 IIRC 的组合）创建 PDF。

I've used their library on a couple of projects and have found that not only is their library easy to work with, but their email support is incredible. And the license is quite cheap as well.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T18:00:03.023

没有玩过，但您可以查看[Aspose.Pdf.Kit for .NET 和 Java](http://www.aspose.com/categories/file-format-components/aspose.pdf.kit-for-.net-and-java/default.aspx)。它是商业的，因此您需要支付许可提要，但如果您需要商业支持，它可能对您有用。

# java - 有没有办法让 jadclipse 与 Eclipse 3.4 一起工作？

> ID：122110
> 
> 赞同：8
> 
> 时间：2008-09-23T16:26:47.973
> 
> 标签：java, eclipse, plugins, eclipse-plugin, jad

我是 Jadclipse 插件的忠实粉丝，我真的很想升级到 Eclipse 3.4，但该插件目前无法使用。是否有任何其他程序可以让您使用 jad 查看您从 Eclipse 导航到的代码源？（在深入研究堆栈跟踪中的模棱两可的代码时非常有用）。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-22T07:45:17.260

仔细阅读文档...：

1.  启动 Eclipse 时 JadClipse 插件未激活。您需要使用 -clean 标志启动 Eclipse 以允许环境检测插件。Eclipse 的后续启动不需要 -clean 标志。 **日食-清洁**

2.  打开的是 Eclipse 类文件查看器，而不是 JadClipse 类文件查看器。转到**Window > Preferences... > General > Editors > File Associations** 并确保 JadClipse Class File Viewer 具有 *.class 文件的 DEFAULT 文件关联。（ - 按默认按钮！！！）

这真的很有帮助:)))

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-08T16:11:30.563

从帮助-> 软件更新 [http://webobjects.mdimension.com/jadclipse/3.3](http://webobjects.mdimension.com/jadclipse/3.3)为 jadeclipse 更新 eclipse 3.4 重新启动 eclipse。设置 jadeclipse 属性。它不仅有效..这就是解决方案。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-23T16:29:50.697

我在 Eclipse 3.4 中成功使用 JadClipse

Eclipse 3.4.0.I20080617-2000
JadClipse 3.3.0

它只是工作！

编辑：实际上，如果您像我一样有时忘记阅读文档，请参阅下面[的 OlegSOM 回答](https://stackoverflow.com/questions/122110/is-there-a-way-to-get-jadclipse-working-with-eclipse-3-4/224779#224779)，了解您可能需要记住采取的其他步骤！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T19:06:30.597

没关系我上面的问题 - 我的问题是我对 jad.exe 和临时目录的路径的设置。

如果其他人遇到与我相同的问题，请确保反编译器的路径正确（如“C:...\jad.exe”）并单独保留临时目录（对我来说它是“C:\Documents and设置{用户}.net.sf.jadclipse")。

这是一个非常好的实用程序 - 比默认的类查看器更有用！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-14T13:17:39.413

我无法使插件与 ganymede（linux 版本）一起使用。设置 jadclipse 类查看器时，我在工作区的日志文件 (.metadata/.log) 中收到以下错误

```
java.lang.IncompatibleClassChangeError
        at net.sf.jadclipse.JadclipseClassFileEditor.doOpenBuffer(JadclipseClassFileEditor.java:101)
        at net.sf.jadclipse.JadclipseClassFileEditor.doSetInput(JadclipseClassFileEditor.java:45)
        at net.sf.jadclipse.JadclipseActionBarContributor.setActiveEditor(JadclipseActionBarContributor.java:87)
        at org.eclipse.ui.internal.EditorActionBars.partChanged(EditorActionBars.java:335)
        at org.eclipse.ui.internal.WorkbenchPage$3.run(WorkbenchPage.java:628)
.....(i don't think the rest of the stack trace is important) 
```

也许 jadclipse 与其 eclipse 依赖项的版本不兼容（在这一行上，jadclipse 调用了 JDT 插件中定义的类），但我没有时间弄清楚这一点。

编辑：我只是使用 svn 存储库重新编译了 jar，并为 java 1.5 创建了一个新 jar，它似乎可以工作（[在此处下载](http://lancelotdm.free.fr/files/net.sf.jadclipse_3.2.4.LdM.jar "jadclise 下载")）。只需下载我的jar并放入eclipse的插件文件夹并删除旧的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-28T03:51:15.270

我在 Eclipse Ganymede 中运行 JadClipse 时遇到问题。事实证明 Groovy 插件与 JadClipse 发生冲突。删除 groovy 插件后，JadClipse 运行良好。顺便说一句，这是问题所在：

```
Cannot complete the request.  See the details.
Unsatisfied dependency: [org.codehaus.groovy.eclipse.feature.feature.group 2.0.0.20090814-1100-e34-N] requiredCapability: org.eclipse.equinox.p2.iu/org.codehaus.groovy.eclipse.core.help/[2.0.0.20090814-1100-e34-N,2.0.0.20090814-1100-e34-N]
Unsatisfied dependency: [org.codehaus.groovy.eclipse.feature.feature.group 2.0.0.20090814-1100-e34-N] requiredCapability: org.eclipse.equinox.p2.iu/org.codehaus.groovy.jdt.patch.feature.group/[2.0.0.20090814-1100-e34-N,2.0.0.20090814-1100-e34-N]
Unsatisfied dependency: [org.codehaus.groovy.jdt.patch.feature.group 2.0.0.20090814-1100-e34-N] requiredCapability: org.eclipse.equinox.p2.iu/org.eclipse.jdt.feature.group/[3.4.2.r342_v20081217-7o7tEAoEEDWEm5HTrKn-svO4BbDI,3.4.2.r342_v20081217-7o7tEAoEEDWEm5HTrKn-svO4BbDI]
Unsatisfied dependency: [org.codehaus.groovy.eclipse.core.help 2.0.0.20090814-1100-e34-N] requiredCapability: osgi.bundle/org.eclipse.help/3.3.102 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-07T00:00:22.233

我刚刚能够使用 Ganymede 成功安装 jadclipse。为了做到这一点，我： 1）通过帮助安装-> 软件更新[http://webobjects.mdimension.com/jadclipse/3.3](http://webobjects.mdimension.com/jadclipse/3.3)

2) 将 Jad 可执行文件放入操作系统执行路径中的目录中。或者，您可以在 Window > Preferences... > Java > JadClipse > Path to Decompiler 下配置 Jad 可执行文件的路径。（设置完整路径，例如 C:\Program Files\Jad\jad.exe）

3) 转到 Window > Preferences... > General > Editors > File Associations 并确保 JadClipse Class File Viewer 具有 *.class 文件的默认文件关联。

4) 重启 Eclipse (eclipse -clean)。

它现在对我来说很完美！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-02T12:56:52.903

对我有用的是我去了 Window > Preferences... > General > Editors > File Associations 并重置默认值。我将默认设置为“类文件查看器”并返回到“Jadclipse 类文件查看器”。不，它出于某种原因起作用。:) 如果你运气不好，试试吧。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-02T11:25:29.010

按照此链接中的说明进行操作

[http://www.devx.com/Java/Article/22657](http://www.devx.com/Java/Article/22657)

[但是当从http://sourceforge.net/projects/jadclipse/](http://sourceforge.net/projects/jadclipse/)下载 Eclipse 的 jadclipse 插件时

只需下载这个jar“net.sf.jadclipse_3.3.0.jar”并将它放在Eclipse plugins文件夹中，其余的与第一个链接中的方式相同。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-03T16:47:11.607

我也有它在 Eclipse 上工作：

版本：3.4.1 版本号：M20080911-1700

插件安装步骤很简单 - [http://jadclipse.sourceforge.net/wiki/index.php/Main_Page#Installation](http://jadclipse.sourceforge.net/wiki/index.php/Main_Page#Installation)

我不得不从镜像站点下载 JAD 本身（原始站点已消失？） - [http://www.varaneckas.com/jad](http://www.varaneckas.com/jad)

我在 Windows 机器上，这可能很重要。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-22T13:03:13.243

我遵循 bhupendra 的方法（通过 Help > Software Updates > [http://webobjects.mdimension.com/jadclipse/3.3](http://webobjects.mdimension.com/jadclipse/3.3)添加），它对我有用。直接使用 jar 文件（甚至使用 -clean 重新启动）不起作用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-01-06T12:02:31.077

要解决问题：

转到 Window > Preferences... > General > Editors > File Associations 并确保 JadClipse Class File Viewer 具有 *.class 文件的默认文件关联。

重新启动 Eclipse (eclipse -clean)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-05-12T12:17:31.917

将此更新站点与 myeclipse 8.5 一起使用似乎可以正常工作：

[http://webobjects.mdimension.com/jadclipse/3.3](http://webobjects.mdimension.com/jadclipse/3.3)

仅供参考杰夫

# windows - 在 Windows 中读取和写入子进程的 popen 是什么？

> ID：122115
> 
> 赞同：1
> 
> 时间：2008-09-23T16:27:18.567
> 
> 标签：windows, ruby

Ruby 的标准 popen3 模块不适用于 Windows。是否存在允许分离标准输入、标准输出和标准错误的维护替换？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T16:43:56.873

[POpen4](http://popen4.rubyforge.org/) gem 在 unix 和 Windows 之间有一个通用接口。下面的例子（来自他们的网站）就像一个魅力。

```
require 'rubygems'
require 'popen4'

status =
  POpen4::popen4("cmd") do |stdout, stderr, stdin, pid|
    stdin.puts "echo hello world!"
    stdin.puts "echo ERROR! 1>&2"
    stdin.puts "exit"
    stdin.close

    puts "pid        : #{ pid }"
    puts "stdout     : #{ stdout.read.strip }"
    puts "stderr     : #{ stderr.read.strip }"
  end

puts "status     : #{ status.inspect }"
puts "exitstatus : #{ status.exitstatus }" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-22T18:29:58.550

popen3 适用于 Windows 上的 MRI 1.9.x。请参阅[http://en.wikibooks.org/wiki/Ruby_Programming/Running_Multiple_Processes](http://en.wikibooks.org/wiki/Ruby_Programming/Running_Multiple_Processes)

# sql-server - 如何获取报表在 SQL Server Reporting Services 2005 中使用的数据源

> ID：122127
> 
> 赞同：0
> 
> 时间：2008-09-23T16:28:43.803
> 
> 标签：sql-server, reporting-services

为了创建正确的查询，我需要能够针对报表使用的同一数据源运行查询。如何以**编程**方式获取该信息？最好是连接字符串或用于构建连接字符串的数据片段。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T17:23:15.313

```
DataSourceDefinition dataSourceDefinition 
    = reportingService.GetDataSourceContents("DataSourceName");

string connectionString = dataSourceDefinition.ConnectString; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T16:36:55.110

如果您有适当的权限，您可以访问[http://servername/reports/](http://servername/reports/)并通过那里查看数据源连接详细信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T16:38:59.850

如果您使用的是 Visual Studio，只需查看数据选项卡。

如果您只能访问 SSRS 服务器上的报告，您可以导航到报告，单击“属性”选项卡，然后单击左侧的“数据源”选项。

如果它是自定义数据源，您可以从那里获取连接信息。

如果它是共享的，您需要导航到显示的数据源路径，并且可以从那里获取连接信息。

编辑：另外，如果您只有报告文件本身，您应该能够在记事本中打开它并在其中找到数据源信息。除非它使用共享数据源，否则我猜......在这种情况下，您需要找到它。

编辑：在添加“以编程方式”之前，此答案适用于最初编写的问题。

# wcf - 从 Silverlight 调用 WCF 服务

> ID：122144
> 
> 赞同：4
> 
> 时间：2008-09-23T16:30:58.183
> 
> 标签：wcf, silverlight, securityexception

我从 silverlight 调用本地托管的 wcf 服务，但出现以下异常。

Iv 创建了一个 clientaccesspolicy.xml，它位于我主机的路由中。

```
<?xml version="1.0" encoding="utf-8"?>
<access-policy>
  <cross-domain-access>
    <policy>
      <allow-from http-request-headers="*">
        <domain uri="*"/>
      </allow-from>
      <grant-to>
        <resource path="/" include-subpaths="true"/>
      </grant-to>
    </policy>
  </cross-domain-access>
</access-policy> 
```

> 尝试向 URI“ [http://localhost:8005/Service1.svc](http://localhost:8005/Service1.svc) ”发出请求时出错。这可能是由于跨域配置错误。有关更多详细信息，请参阅内部异常。--->
> 
> {System.Security.SecurityException ---> System.Security.SecurityException：安全错误。在 MS.Internal.InternalWebRequest.Send() 在 System.Net.BrowserHttpWebRequest.BeginGetResponseImplementation() 在 System.Net.BrowserHttpWebRequest.InternalBeginGetResponse(AsyncCallback 回调，对象状态) 在 System.Net.AsyncHelper.<>c__DisplayClass4.b__3(Object sendState ) --- 内部异常堆栈跟踪结束 --- System.Net.AsyncHelper.BeginOnUI(BeginMethod beginMethod, AsyncCallback callback, Object state) at System.Net.BrowserHttpWebRequest.BeginGetResponse(AsyncCallback callback, Object state) at System.ServiceModel System.ServiceModel.Channels.HttpChannelFactory 中的 .Channels.HttpChannelFactory.HttpRequestChannel.HttpChannelAsyncRequest.CompleteSend(IAsyncResult 结果)。

关于如何进步的任何想法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T16:37:35.967

[这里列出了](http://timheuer.com/blog/archive/2008/06/10/silverlight-services-cross-domain-404-not-found.aspx)一些调试技术..一个更有[用的帖子](http://timheuer.com/blog/archive/2008/04/09/silverlight-cannot-access-web-service.aspx)..

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T19:55:40.530

我知道该服务工作正常，因为我将其添加为对基本网站的引用并且它工作正常。我将尝试使用 Fiddler，尽管由于 xaml 控件未嵌入网页中存在一个小问题，它使用内置的测试页渲染器。

这是iv发现需要检查的一些指针：

添加一个clientaccesspolicy.xml，如我的问题所示。

将 crossdomain.xml 添加到主机路由：

```
<!DOCTYPE cross-domain-policy SYSTEM "http://www.adobe.com/xml/dtds/cross-domain-policy.dtd">
<cross-domain-policy>
  <allow-http-request-headers-from domain="*" headers="*"/>
</cross-domain-policy> 
```

确保绑定是 basicHttp，因为这是 silverlight 唯一支持的绑定（当前）

该服务需要此属性：

```
[AspNetCompatibilityRequirements(RequirementsMode = AspNetCompatibilityRequirementsMode.Allowed)] 
```

有用的读物​​： [http ://weblogs.asp.net/tolgakoseoglu/archive/2008/03/18/silverlight-2-0-and-wcf.aspx](http://weblogs.asp.net/tolgakoseoglu/archive/2008/03/18/silverlight-2-0-and-wcf.aspx)

[http://timheuer.com/blog/archive/2008/06/06/changes-to-accessing-services-in-silverlight-2-beta-2.aspx](http://timheuer.com/blog/archive/2008/06/06/changes-to-accessing-services-in-silverlight-2-beta-2.aspx)

[http://silverlight.net/forums/t/19191.aspx](http://silverlight.net/forums/t/19191.aspx)

[http://timheuer.com/blog/archive/2008/04/09/silverlight-cannot-access-web-service.aspx](http://timheuer.com/blog/archive/2008/04/09/silverlight-cannot-access-web-service.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:26:17.937

我通过网络广播提供的一些调试技术试图展示我写的一些技术：[https ://www.livemeeting.com/cc/mseventsbmo/view?id=1032386656&role=attend&pw=F3D2F263](https://www.livemeeting.com/cc/mseventsbmo/view?id=1032386656&role=attend&pw=F3D2F263)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-01T16:13:47.317

不知道您的问题是否相同，但我刚刚写了一篇博客，讲述了我这个周末试图通过我的 SL 应用程序与我的控制台托管的 WCF 服务交谈来实现跨域发生的主要痛苦。

[http://wallism.wordpress.com/2009/03/01/silverlight-communication-exception/](http://wallism.wordpress.com/2009/03/01/silverlight-communication-exception/)

简而言之，您必须有一个 crossdomain.xml 并且没有 'headers="*"'

```
Bad:
    <allow-access-from domain=""*"" headers="*" />

Good:
    <allow-access-from domain=""*"" />
    <allow-http-request-headers-from domain=""*"" headers=""*"" /> 
```

您可以使用“SOAPAction”代替 * 标头（无论哪种方式都可以）

哦，当你让它工作时，你可能想让它更安全一点:-)

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T16:35:45.363

我首先通过使用 Fiddler、FireBug 或类似工具检查网络调用来确保 Silverlight 确实找到了您的客户端访问策略文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T16:38:50.520

如果您在从您提供 Silverlight 应用程序的同一位置使用 WCF 服务，则不需要跨域策略。从多个实体之间存在关系的客户端返回 LINQ to SQL 数据时，我遇到了类似的错误。

首先确保您的 WCF 服务工作正常。通过创建一个简单的 ping 函数来回显其输入来做到这一点。确保你可以先调用它。如果这可行，而您的其他函数不起作用，则无论是参数还是函数的返回。如果第一个功能也失败，请使用 Fiddler 之类的工具查看通过线路发送的数据。用一个 。在主机端查看来自 localhost 的数据。所以像 http//localhost:1234./default.aspx 之类的东西，并为 WCF 地址使用相同的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-06T20:17:13.370

我发现John Papa所著的《 [Data-Driven Services with Silverlight 2 》一书对此进行了广泛的讨论。](https://rads.stackoverflow.com/amzn/click/com/0596523092)我有同样的问题，这本优秀的书解释了这一切。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-22T15:36:40.457

我遇到了类似的问题，删除服务引用并再次添加它为我解决了这个问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-12T18:44:53.103

我有同样的问题。我确实看到silverlight客户端应用程序成功获取了clientaccesspolicy.xml。我确实通过firefox直接请求它来确保clientaccesspolicy.xml没有格式错误。该政策是广泛开放的，与上述相同。

现在奇怪的转折来了。如果我删除 clientaccesspolicy.xml 并添加 Flash 样式的 crossdomain.xml 策略文件，那么它可以工作。我确实通过检查网络看到了如何首先请求 clientaccesspolicy.xml 失败，然后 silverlight 回退到 crossdomain.xml。

所以我确实有一个解决方法，但我更喜欢让 clientaccesspolicy.xml 工作，这样就没有额外的不必要的网络往返。

有什么建议么？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-12-10T08:54:29.633

确保正确定义了 WCF 服务的 Endpoints 和 Binding。从同一个应用程序调用 WCF 服务不需要跨域策略文件。

# tfs - 如何在失败的 Team Foundation Build 结束时禁用工作项创建？

> ID：122154
> 
> 赞同：13
> 
> 时间：2008-09-23T16:32:10.550
> 
> 标签：tfs, msbuild, tfsbuild

我正在使用 Team Foundation Build，但我们尚未使用 TFS 进行问题跟踪，因此我想在失败的构建上禁用工作项创建。有没有办法做到这一点？我尝试在构建类型的 TFSBuild.proj 文件中注释掉工作项信息，但这并没有成功。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-23T18:03:02.517

尝试在 TFSBuild.proj 的 PropertyGroup 中添加它：

```
<SkipWorkItemCreation>true</SkipWorkItemCreation> 
```

* * *

如果您对它的工作原理感到好奇，Microsoft.TeamFoundation.Build.targets 包含以下内容：

```
 <Target Name="CoreCreateWorkItem"
          Condition=" '$(SkipWorkItemCreation)'!='true' and '$(IsDesktopBuild)'!='true' "
          DependsOnTargets="$(CoreCreateWorkItemDependsOn)">

    <PropertyGroup>
      <WorkItemTitle>$(WorkItemTitle) $(BuildNumber)</WorkItemTitle>
      <BuildLogText>$(BuildlogText) &lt;a href='file:///$(DropLocation)\$(BuildNumber)\BuildLog.txt'&gt;$(DropLocation)\$(BuildNumber)\BuildLog.txt&lt;/a &gt;.</BuildLogText>
      <ErrorWarningLogText Condition="!Exists('$(MSBuildProjectDirectory)\ErrorsWarningsLog.txt')"></ErrorWarningLogText>
      <ErrorWarningLogText Condition="Exists('$(MSBuildProjectDirectory)\ErrorsWarningsLog.txt')">$(ErrorWarningLogText) &lt;a href='file:///$(DropLocation)\$(BuildNumber)\ErrorsWarningsLog.txt'&gt;$(DropLocation)\$(BuildNumber)\ErrorsWarningsLog.txt&lt;/a &gt;.</ErrorWarningLogText>
      <WorkItemDescription>$(DescriptionText) %3CBR%2F%3E $(BuildlogText) %3CBR%2F%3E $(ErrorWarningLogText)</WorkItemDescription>
    </PropertyGroup>

    <CreateNewWorkItem
          TeamFoundationServerUrl="$(TeamFoundationServerUrl)"
          BuildUri="$(BuildUri)"
          BuildNumber="$(BuildNumber)"
          Description="$(WorkItemDescription)"
          TeamProject="$(TeamProject)"
          Title="$(WorkItemTitle)"
          WorkItemFieldValues="$(WorkItemFieldValues)"
          WorkItemType="$(WorkItemType)"
          ContinueOnError="true" />

  </Target> 
```

您可以在自己的构建脚本中覆盖任何此功能，但 Microsoft 在顶部提供了方便的 SkipWorkItemCreation 条件，您可以使用它来取消整个目标的执行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-07-19T10:59:08.483

如果您使用的是 tfs2010 或更高版本，您可以在构建定义本身中执行此操作。

在Build Definition的**Process 选项卡**`Create Work Item on failure`中，将属性设置为`false`（在 Advanced 部分下）

# java - 有没有一种简单的方法可以在 Eclipse 中附加源代码？

> ID：122160
> 
> 赞同：133
> 
> 时间：2008-09-23T16:33:21.983
> 
> 标签：java, eclipse

我非常喜欢 Visual Studio 在完成您编写的代码和您正在引用的代码（各种库/程序集）时为您提供注释文档/参数名称的方式。

在完成代码或将鼠标悬停在方法上时，是否有一种简单的方法可以在 Eclipse 中获取内联 javadoc/参数名称？通过插件？通过一些设置？使用大量库（就像在 Java 中经常发生的那样）非常烦人，然后当您将信息放在源 jar 中时必须去网站或本地 javadoc 位置查找信息！

* * *

## 回答 #1

> 赞同：153
> 
> 时间：2008-09-23T16:37:59.633

简短的回答是肯定的。

您可以使用项目的属性附加源。

转到属性（用于项目）-> Java 构建路径-> 库

选择要为其附加源/javadoc 的库，然后展开它，您将看到如下列表：

```
Source Attachment: (none)
Javadoc location: (none)
Native library location: (none)
Access rules: (No restrictions) 
```

选择 Javadoc 位置，然后单击右侧的编辑。从那里开始应该很直截了当。

祝你好运 ：）

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2013-02-01T15:39:36.013

直到昨天，我还在为大量的 jars 下载源 zip 并为每个项目手动附加它们。然后一位同事让我开始使用[The Java Source Attacher](http://marketplace.eclipse.org/content/java-source-attacher)。它做了 eclipse 应该做的事情——一个右键单击上下文菜单，上面写着“附加 Java 源”。

![在此处输入图像描述](https://i.stack.imgur.com/uA7P8.png)

它会自动为您下载源代码并将其附加。我只访问了几个它不知道的库，当发生这种情况时，它可以让您将 url 贡献回社区，这样其他人就不会对该库有任何问题。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2013-03-04T12:03:58.423

一个简单的方法是：

1.  下载相应的 SRC 文件/文件夹。

2.  在 Eclipse 编辑器中，在您需要源代码的方法/类上按 Ctrl+单击或 F3。将打开一个新选项卡，其中显示“未找到附加源”。

3.  单击“附加源”按钮，单击“附加源文件夹”按钮，浏览到下载的 SRC 文件夹的位置。完毕！

（ps：按钮标签可能略有不同，但差不多就是这样。）

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2017-12-13T03:34:09.403

1）按住Control+左键点击你想看的方法。然后 Eclipse 会将您带到 Source Not Found 页面。

2）点击“附加源” [![在此处输入图像描述](https://i.stack.imgur.com/MT3o1.png)](https://i.stack.imgur.com/MT3o1.png)

3)[![在此处输入图像描述](https://i.stack.imgur.com/SxAXz.png)](https://i.stack.imgur.com/SxAXz.png)

4) 导航到 C:\Program Files\Java\jdk-9.0.1\lib\src.zip

5) 点击 OK [![在此处输入图像描述](https://i.stack.imgur.com/aoKuJ.png)](https://i.stack.imgur.com/aoKuJ.png) 现在你应该可以看到源代码了。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-07-20T11:47:11.600

我发现有时，您指向您认为是正确的目录，然后它仍然指出它无法在附加的源代码中找到该文件等等。

这些时候，我意识到最后一个路径元素是“src”。只需删除此路径元素（因此确实指向“org”或“com”文件夹所在的实际路径的上一层）就可以神奇地使其工作。

不知何故，Eclipse 似乎暗示了这个“src”路径元素（如果存在），如果你将它包含在源路径中，Eclipse 就会窒息。或类似的东西。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-11-14T01:59:39.607

是的，有一个简单的方法...转到... [http://sourceforge.net/projects/jdk7src/](http://sourceforge.net/projects/jdk7src/) 并下载 zip 文件。然后将其附加到日食。给出您在 Eclipse 中下载 zip 文件的路径。然后我们可以浏览源代码。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-23T16:39:49.753

当您将 jar 文件添加到类路径时，您可以将源目录或 zip 或 jar 文件附加到该 jar。在 Java Build Path 属性的 Libraries 选项卡上，展开 jar 的条目，您将看到源附件的项目。选择此项，然后单击编辑按钮。这使您可以选择包含源的文件夹、jar 或 zip。

此外，如果您在 jar 中选择一个类或方法并在其上按 CTRL+CLICK（或按 F3），那么您将进入字节码视图，该视图具有附加源代码的选项。

执行这些操作将为您提供所有参数名称以及完整的 javadoc。

如果您没有源代码但有 javadoc，则可以通过第一种方法附加 javadoc。如果您没有下载它，它甚至可以引用外部 URL。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-11-25T06:48:26.797

1.  点击你想看的JAVA代码。（如果要查看 java.util.List 的源代码，请单击 List 打开 List.java）
2.  单击“附加源”按钮。
3.  您将被要求“选择包含 rt.jar 源的位置（文件夹、JAR 或 zip））。
4.  选择“外部位置”选项。找到 src.zip 文件。
5.  src.zip 的路径是：*\Java\jdk1.8.0_45\src.zip

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-06-07T07:12:57.073

1.  将源文件放入 zip 文件中（就像对 java 源文件一样）
2.  转到项目属性-> 库
3.  选择源附件，然后单击“编辑”
4.  在源附件配置上单击“变量”
5.  在“变量选择”上单击“新建”
6.  输入一个有意义的名称并选择在步骤 1 中创建的 zip 文件

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-06-10T14:05:36.270

另一个选项是右键单击位于 (Your Project)->Referenced Libraries->(your jar) 下的 jar 文件，然后单击属性。然后单击 Java 源附件。然后在位置路径中放入源 jar 文件的位置。

这只是附加源文件的另一种方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-12-30T08:14:27.517

另一种方法是将文件夹添加到您的源查找路径： [http ://help.eclipse.org/helios/index.jsp?topic=%2Forg.eclipse.jdt.doc.user%2Freference%2Fviews%2Fdebug%2Fref-编辑sourcelookup.htm](http://help.eclipse.org/helios/index.jsp?topic=%2Forg.eclipse.jdt.doc.user%2Freference%2Fviews%2Fdebug%2Fref-editsourcelookup.htm)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-11-04T23:46:17.847

如果您使用 gradle 构建库，您可以将源附加到您创建的 jar 中，然后 eclipse 将自动使用它们。请参阅@MichaelOryl [How to build sources jar with gradle](https://stackoverflow.com/questions/11474729/how-to-build-sources-jar-with-gradle)的答案。

复制到这里供您参考：

```
jar {
    from sourceSets.main.allSource
} 
```

显示的解决方案适用于 gradle java 插件。如果您不使用该插件，里程可能会有所不同。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-29T18:33:08.510

在使用自动构建时使这更容易的另一个想法：

当您创建一个项目的 jar 时，还要创建一个源文件 jar：
project.jar
project-src.jar

不要进入构建路径选项对话框来为每个 jar 添加源引用，请尝试以下操作：通过对话框添加一个源引用。编辑您的 .classpath 并使用第一个 jar 条目作为模板，将源 jar 文件添加到其他每个 jar。

这样，您可以充分利用 Eclipse 的导航辅助工具，同时仍然使用更独立的东西来构建您的项目。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-07-09T00:57:08.993

我打算寻求一种替代方法来将源附加到多个项目中使用的同一个 JAR。最初，我认为唯一的选择是使用包含的源重新构建 JAR，但是查看“用户库”功能，您不必使用源构建 JAR。

当您有多个项目（相关或不相关）引用同一个 JAR 时，这是一种替代方法。为每个 JAR 创建一个“用户库”并将源附加到它们。下次您需要特定的 JAR 时，不要使用“添加 JAR...”或“添加外部 JAR...”，而是添加您之前创建的“用户库”。

您只需为每个 JAR 附加一次源代码，就可以将其重新用于任意数量的项目。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-09-07T06:50:32.933

对于那些正在编写 Eclipse 插件并希望包含源代码的人......在功能 ExportWizard 中有一个包含源代码的选项： [![在此处输入图像描述](https://i.stack.imgur.com/4QFF4.png)](https://i.stack.imgur.com/4QFF4.png)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-02-19T10:30:53.743

只需单击附加源并选择文件夹路径...名称将与文件夹名称相同（在我的情况下）。记住一件事，您需要选择项目文件夹基本位置的路径，后缀为“\”，例如 D:\MyProject\

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2011-09-13T20:44:07.003

这看起来有点矫枉过正，但如果您使用 maven 并包含源代码，mvn eclipse 插件将生成所需的所有源代码配置，从而为您提供您可能要求的所有内联文档。

# drupal - 在 Drupal 中处理图像的最简单方法是什么？

> ID：122173
> 
> 赞同：1
> 
> 时间：2008-09-23T16:36:56.703
> 
> 标签：drupal

我习惯了 TYPO3，我可以在内容元素中上传图像，然后确定大小等等。

有没有办法像这样处理drupal中的图像？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T05:24:15.063

Drupal 的图像上传支持有点像丛林。

最基本的方法是使用 image.module 和 img_assist。这将在每个允许上传的文本区域下方添加一个链接，当您上传一个链接时，它会在内容正文中插入一个自定义标签，指定图像、标题、大小和对齐方式等。请注意，这会将图像引用插入到节点的正文文本，并让作者控制图像的显示方式和位置。如果该站点仅供您个人使用，并且您希望做一些简单的事情，例如将图像插入到您的博客文章中，那么这可能就是您所需要的。

另一种选择（特别是如果其他人要创建内容并且您希望它始终看起来不错，而无需大量麻烦和用户培训）是限制图像在您的主题中的位置 - 让人们将图像作为附件上传，并渲染正文之外的标准插槽中的图像。这通常使用 CCK 图像字段来完成，以允许指定最多 N 个图像——因此您将单独的字段添加到指定相关图像的创建内容节点。一个可以标记为特殊，您可以将其拉出来作为预告片的缩略图。（IIRC，imagefield 可能还没有为 D6 做好准备。）

为了使这种情况更好地工作，您可能希望图像自动调整为适合您主题的标准尺寸，并自动生成缩略图版本。像 imagecache 这样的模块可以做到这一点，尽管它不是最容易设置的。

IMCE 模块是一个 DHTML/JavaScript 上传器 UI，允许用户浏览服务器上以前上传的图像。（可以控制他们可以看到哪些文件夹。） IMCE 有一个关联的 CCK IMCE ImageField 字段类型来替换常规的 imagefield。IMCE 还与 TinyMCE 和 FCKeditor 集成以替换他们自己的上传器 UI。（IMCE 和 IMCE 的 imagefield 似乎在 D6 上工作。）

有些人对资产模块发誓上传和选择以前上传的内容；我相信它还可以帮助嵌入托管在 Flickr 上的图像和来自 YouTube 的视频。目前仅适用于 Drupal 5。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-09T13:04:21.927

最简单的方法，恕我直言，使用图像辅助模块。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T18:55:47.667

这里有一个[关于这个话题的详细讨论](http://drupal.org/node/316884)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T03:53:03.457

不确定您到底要做什么，但一个好的起点是查看用于 CCK 内容类型的[文件字段](http://drupal.org/project/filefield)和图像[缓存模块。](http://drupal.org/project/imagecache)[Scald](http://drupal.org/project/scald)看起来也很有希望，但仍在等待正式发布。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T16:41:59.733

我刚刚开始了解 drupal，但这里有一些我在 Drupal-image-gallery 部门的发现——也许其中之一会满足你的要求：

[弗里克鲁普](http://www.developmentseed.org/blog/2007/oct/24/unlimited-images-your-content-drupal-and-flickr)

[程序库](http://drupal.org/project/prog_gallery)

[画廊2](http://drupal.org/project/gallery)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-10T22:59:25.377

看看这个截屏视频： [http ://www.youtube.com/watch?v=TLB9-1t_mrE](http://www.youtube.com/watch?v=TLB9-1t_mrE)

它消除了我在第一次解决这个问题时面临的一堆困惑。按照视频中概述的设置可能会非常接近您想要的。

# sharepoint - 将 ASP.Net 3.5 SP1 路由与 SharePoint 2007 一起使用

> ID：122175
> 
> 赞同：2
> 
> 时间：2008-09-23T16:37:17.730
> 
> 标签：sharepoint, sharepoint-2007, moss, asp.net-routing

我正在尝试在 SharePoint 网站上设置一些友好的 URL。我知道我可以使用 RewritePath 执行 ASP.Net 2.0 友好 URL，但我想知道是否可以使用 ASP.NET 3.5 SP1 附带的 System.Web.Routing。

我想我已经想出了如何加载我的路由表，但我不清楚使用什么方法来让正确的 IHttpHandler 传递出去。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T17:04:42.883

我被要求将其视为 Share Point 评估过程的一部分。

我的理解是*uri 模板*本质上是主机名，后跟递归文件夹结构。

Share Point 将 uri 截断为 255 个字符，这使情况变得更加复杂。因此，如果您的文件夹结构特别深或冗长，那么您的 uri 可能会变得无效。

我正在考虑通过遵循人类可读的约定并转换为共享点约定来从本质上美化/整理 uri。IE：

[http://myhostname.com/docs/human-resources/case-files/2009/reviews/ed-blackburn.docx](http://myhostname.com/docs/human-resources/case-files/2009/reviews/ed-blackburn.docx)

转换为共享点数：

[http://myhostname.com/human%20resources/case%20files/2009/reviews/ed%20blackburn.docx](http://myhostname.com/human%20resources/case%20files/2009/reviews/ed%20blackburn.docx)

控制器可以控制任何额外的所需服务。

如果超过 255 个字符，我最初的建议是某种 tinyurl 方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T15:31:29.300

它应该像下面这样简单。

```
var route = new Route("blah/{*path}", new MyRouteHandler());
RouteTable.Routes.Add(route);

public class MyRouteHandler : IRouteHandler
{
    public IHttpHandler GetHttpHandler(RequestContext requestContext)
    {
        // return some HTTP handler here
    }
} 
```

然后在 web.config 中的 HTTP 模块下注册 System.Web.Routing.UrlRoutingModule 就可以了。

```
<add name="Routing" type="System.Web.Routing.UrlRoutingModule, System.Web.Routing, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-04T13:43:57.423

我最终接受了 Ryan 所拥有的：

```
var route = new Route("blah/{*path}", new MyRouteHandler());
RouteTable.Routes.Add(route);
public class MyRouteHandler : IRouteHandler
{    
public IHttpHandler GetHttpHandler(RequestContext requestContext)    
{        
     //rewrite to some know sharepoint path
     HttpContext.Current.RewritePath("~/Pages/Default.aspx");

     // return some HTTP handler here  
     return new DefaultHttpHandler();  

}} 
```

这对我来说似乎没问题。

# ruby-on-rails - Ruby on Rails 中基于环境的配置文件的最佳实践是什么

> ID：122178
> 
> 赞同：1
> 
> 时间：2008-09-23T16:37:32.583
> 
> 标签：ruby-on-rails, ruby, capistrano

我有几个属性取决于应用程序运行的环境。例如，有指向正在同时开发的另一个应用程序的链接，这些链接显示在页眉和页脚中。我希望这些链接根据它们所处的环境而有所不同。

这与我们使用开箱即用的环境配置文件的方式略有不同，因为我们的系统管理员甚至在开发服务器上也让 mongrel 在“生产”模式下运行。我只在笔记本电脑上以“开发”模式运行 mongrel。

有处理这种情况的标准方法吗？或者我们应该在开发服务器上以“开发”模式运行 mongrel 等等。在这种情况下，如果在我们的 env 层次结构中有一个额外的级别会发生什么。（开发、测试、UAT、生产）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T16:49:51.227

您可以使用自定义配置文件。看看[这个线程](https://stackoverflow.com/questions/110078/what-is-the-best-way-to-store-app-specific-configuration-in-rails#110834)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T17:48:02.163

在 UAT 上以生产模式运行绝对是正确的，您希望它尽可能地接近生产。

我假设测试服务器不是您在项目测试套件上运行 CI 的服务器，而是更多某种​​集成服务器，团队内部的人员可以在其中测试新功能，然后用户开始使用它：这更像是一个混合情况，但如果只是为了更清晰的错误消息和改进的日志记录，我可能会让它在开发模式下运行（肯定会在那里找到很多错误，你会想要最大的信息）

我猜开发服务器是开发人员自己的某种集成服务器，同样，在开发模式下运行它可能会更有益于引发的错误和日志。

至于你的具体问题的答案，我肯定会看看@webmat提到的线程，因为你应该在那里找到你的答案，你也可以看看[这里](http://kpumuk.info/ruby-on-rails/flexible-application-configuration-in-ruby-on-rails/)

# build-process - 如何最好地更新远程机器上正在运行的应用程序

> ID：122187
> 
> 赞同：0
> 
> 时间：2008-09-23T16:38:41.550
> 
> 标签：build-process, continuous-integration

所以我的构建机器吐出一个新的可执行文件，我想用新的构建更新我的测试机器。为了做到这一点，我需要以某种方式终止远程机器上的进程，复制新的二进制文件并开始运行。

由于某些奇怪的 IT 设置，出于某种原因 pskill 和 psexec 无法工作。

什么是这样做的好方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T17:29:53.377

您可以让您的可执行文件定期轮询某个放置位置是否存在新版本，并在发现某个放置位置时干净地关闭并将控制权传递给新版本，例如使用 exec() 调用。

# linux - 对于列表控件，find-as-you-type 是否应该在条目的开头或条目中的任何位置匹配？

> ID：122192
> 
> 赞同：0
> 
> 时间：2008-09-23T16:39:05.900
> 
> 标签：linux, user-interface, gtk, usability, hig

我在 GTK+ 中有一个列表控件（`gtk.TreeView`只有一列），启用了“键入时查找”（因此键入任何文本都会打开一个小的搜索字段以搜索列表条目）。现在，如果用户输入一些搜索文本，如“abc”，我应该只搜索以“abc”*开头*的条目，还是应该搜索在其文本中某处包含“abc”的条目？

（感谢相关人机界面指南的链接）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T17:30:03.963

正如 Omer Kooheji 所说，正确答案很大程度上取决于*列表*框包含的内容。但是，基于[最小惊讶原则](http://en.wikipedia.org/wiki/Principle_of_least_astonishment)，我建议在条目开始时进行匹配；这是大多数列表框发生的方式（例如，在 Web 中，在 Linux 安装中的时区选择中，等等），所以这是大多数用户所期望的行为。

但是，这是一个通用建议，不知道确切的应用程序。如果您的应用程序是这样的，人们可能不知道确切的开始，但可能知道中间的一些子字符串，那么在任何地方匹配输入显然更有意义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T16:48:22.353

作为用户，我欣赏“包含”搜索而不是“开始于”。有时您无法准确记住要查找的内容，建议与您的搜索查询相似的内容比将其用作直接过滤器更有帮助。

有时也有多种方法可以列出某些内容，即：

```
Shining, The - King, Stephen
The Shining - Stephen King
King, Stephen - The Shining 
```

等等。在我看来，输入“Shining”应该会返回任何这些结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T16:49:00.340

当然正确的答案取决于它吗？你的主题是什么？

如果您感到懒惰，我会投票支持文本中的任何位置或匹配文本中的任何整个单词（即不必匹配单词的中间）。

尽管在某些情况下，与第一个单词完全匹配是更可取的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:39:36.220

理想情况下，您键入时的查找将对有序字符进行部分匹配，直到达到单词边界。例如（在伪代码中）：

```
var input =  getInput();
    input =~ s/(.)/$1.*/g;
return find_items(input); // Assuming this takes a regexp as its input 
```

这意味着对于`input = "Shing"`

和一个包含`{..., Sine, Shining, 'The Shining', ...}`

输出将是`{Shining, 'The Shining'}`

当达到单词边界时，匹配应该改变以匹配连续的单词部分。大致：

```
var input =  getInput();
    input =~ s/(\w+)/$1.*/g;
return find_items(input); // Assuming this takes a regexp as its input 
```

这样对于`input = "Th Shi"`

和上面一样的数据库

输出将是`{'The Shining'}`

编辑（解决 UI 指南请求）：您可能比观看[此视频做得更糟](http://www.vimeo.com/1013263)

# testing - 自动化测试框架 - Windows CE

> ID：122198
> 
> 赞同：8
> 
> 时间：2008-09-23T16:40:23.730
> 
> 标签：testing, automation, windows-ce

正在寻找一种方法来驱动在 CE 设备上运行的 Compact Framework 应用程序。我们基本上需要的是能够编写按下按钮并单击事物的小脚本。任何人都知道这样的工具，或者最好自己破解一个？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T18:47:12.163

不幸的是，没有用于测试 CF 应用程序的好用的统一工具（无论如何我都找到了）。没有人提供嘲笑，因为 CF CLR 缺少 Emit 之类的东西，这使得小市场的任务变得困难。

微软在 Studio 和 Team Foundation Server 中为智能设备应用程序提供了单元测试功能，但它们不做 UI，调试测试非常痛苦，而且仅仅运行测试很慢，所以它们往往对回归测试有好处，而不是其他.

[微软在CE 测试套件](http://msdn.microsoft.com/en-us/library/ms895007.aspx)(CETK)中提供了一些用于桌面驱动测试的工具和工具框架，包括 Alan 提到的[DATK](http://msdn.microsoft.com/en-us/library/aa463276.aspx)。他们还提供了[Hopper Test Tool](http://msdn.microsoft.com/en-us/library/bb158517.aspx)之类的东西，他们将其用作徽标测试的一部分。

如果这些似乎都不适合您，那么一种相当快速的方法来设置仍然由 PC 驱动的测试（我认为所有测试都应该这样做，否则运行起来往往很痛苦，难以自动化，而且很难记录通过/失败数据），您可以使用[CoreCon API](http://blogs.msdn.com/vsdteam/archive/2007/11/20/corecon-api-part-1.aspx)或[远程工具框架](http://msdn.microsoft.com/en-us/library/bb509851.aspx)来构建您的通信管道和测试框架。

我真诚地希望[VSD](http://blogs.msdn.com/vsdteam/)（设备工作室）团队正在测试 TFS，并希望我们在 Studio 的下一个版本中获得更丰富的工具集。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T17:29:02.537

Windows Mobile 6 SDK（假设您是基于 CE6 的）附带了 Windows Mobile TestKit - 它具有编写 UI 自动化的工具。

如果您是基于 CE5 的，平台构建器（用于构建设备的工具）附带称为 DATK（设备自动化工具包）的东西 - 这是上面提到的 WMTK 的前身。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T12:44:36.947

Look at [TestComplete](http://www.automatedqa.com/products/testcomplete/) - they said that new version 7 would be able to test Windows Mobile applications

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T13:08:11.827

您可以使用 Eggplant等工具与 SOTI 袖珍控制器或 MS Remote Display Controller 等远程控制工具[在](http://www.redstonesoftware.com/)[GUI](http://www.soti.net/)级别自动化 CE 和 Windows mobile 。就个人而言，出于稳健性和可维护性的原因，我更喜欢基于对象的工具而不是图像匹配工具。

您也可以直接使用 SOTI 进行自动化，但我发现它很麻烦，如此[处所述](http://www.sqaforums.com/showflat.php?Cat=0&Number=244205&an=0&page=0#Post244205)

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-03T13:21:05.793

有点跑题了，但是我们（www.orbiz.biz，如果它还活着的话）做了一种 NUnit 的移植，所以我们在设备上有一个运行器，在设备上执行 CF 代码并运行测试。

效果很好——我不认为它与原来的相比有很大的变化，所以较新的 NUnit 可能适用于较新的 CF。

Sorry, I dont have the code, and the company kinda doesn't exist anymore, otherwise, I'd be happy to share what we had :(

# sharepoint - 如何将 SharePoint 2007 功能挂接到网站的 Application_Start？

> ID：122205
> 
> 赞同：5
> 
> 时间：2008-09-23T16:41:29.953
> 
> 标签：sharepoint, sharepoint-2007, global-asax, application-start

我想知道在开发功能时是否有一种很好的方法可以连接到 SharePoint 2007 网站的 Application_Start？我知道我可以直接在站点根目录中编辑 Global.asax 文件，但是有没有办法做到这一点，以便使用该功能进行部署？

谢谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-25T02:31:07.560

这实际上是可能的，但它不涉及 Global.asax 文件。

Microsoft 的许多示例都演示了通过 Global.asax 连接代码，但这并不是 SharePoint 的最佳实践方法。理想情况下，您的代码应该打包为功能并通过 WSP 部署（如您所知）。

关键在于将相关代码实现为 HttpModule（即，实现 IHttpModule 接口的类型）并将其连接到为您的 SharePoint 应用程序提供服务的 ASP.NET 管道中。粗略地说，这些是步骤：

1.  创建一个实现 IHttpModule 接口的类。
2.  在你的 HttpModule 中实现 Init 方法；这是在设置 HttpApplication（在本例中为 SPHttpApplication）时调用的，它使您有机会执行处理、为其他管道事件连接事件委托等。
3.  创建一个 SPFeatureReceiver，它将分别在激活和停用时从目标 web.config 文件中添加和删除您的 HttpModule。这是使用 SPWebConfigModification 类型更新目标 web.config 文件中的 <httpModules> 节点来执行的。
4.  将所有内容打包为功能并通过 WSP 进行部署。

有关 HttpModule 开发的更多信息，请参阅[http://msdn.microsoft.com/en-us/library/ms227673.aspx](http://msdn.microsoft.com/en-us/library/ms227673.aspx)。有关 SPWebConfigModification 类型的更多详细信息，请参阅[http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spwebconfigmodification.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spwebconfigmodification.aspx)。

结果：一个可以处理应用程序启动并且可以通过 Feature 部署的类。无需手动破解文件。

我已经在许多场景中成功地使用了它——最近使用了一个自定义缓存提供程序 (IVaryByCustomHandler)，该提供程序需要在 SPHttpApplication 启动时注册自己以进行回调。

虽然你的问题有点老了，但我希望这会有所帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T15:48:00.290

我的直觉是这不可能。Application_Start 在 asp.net 引擎启动时由运行时调用，因此除了修改 Global.asax 之外，很可能没有任何方法可以挂钩处理程序 - 例如，挂钩必须是声明性和持久性的，因为它必须在应用程序停止/卸载后幸存下来。因此，如果您必须写入 global.asax，我想您可以编写一个 Feature EventReceiver 来执行修改。

除此之外，您能否详细说明原因？也许还有其他攻击角度。即时修改 global.asax 的想法让我感到不舒服。那可不好。

奥辛

# c++ - 如何获取本地计算机的 IP 地址？

> ID：122208
> 
> 赞同：58
> 
> 时间：2008-09-23T16:41:42.073
> 
> 标签：c++, sockets, networking

在 C++ 中，获取本地计算机的 IP 地址和子网掩码的最简单方法是什么？

我希望能够在我的本地网络中检测到本地机器的 IP 地址。在我的特殊情况下，我有一个子网掩码为 255.255.255.0 的网络，我的计算机的 IP 地址是 192.168.0.5。我需要以编程方式获取这些有两个值，以便向我的网络发送广播消息（对于我的特殊情况，格式为 192.168.0.255）

编辑：许多答案没有给出我预期的结果，因为我有两个不同的网络 IP。[Torial](https://stackoverflow.com/questions/122208/get-the-ip-address-of-local-computer#122235)的代码成功了（它给了我两个 IP 地址）。

编辑 2：感谢[Brian R. Bondy](https://stackoverflow.com/questions/122208/get-the-ip-address-of-local-computer#122225)提供有关子网掩码的信息。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-08-22T23:17:02.030

这个问题比看起来更棘手，因为在许多情况下，没有“本地计算机的 IP 地址”，而是有许多不同的 IP 地址。例如，我现在正在输入的 Mac（这是一个非常基本的标准 Mac 设置）具有以下关联的 IP 地址：

```
fe80::1%lo0  
127.0.0.1 
::1 
fe80::21f:5bff:fe3f:1b36%en1 
10.0.0.138 
172.16.175.1
192.168.27.1 
```

......这不仅仅是弄清楚以上哪个是“真实IP地址”的问题，或者......它们都是“真实的”和有用的；有些比其他更有用，具体取决于您要使用这些地址的目的。

根据我的经验，为本地计算机获取“IP 地址”的最佳方法通常不是查询本地计算机，而是询问您的程序正在与之通信的计算机，它认为您的计算机的 IP 地址是什么。例如，如果您正在编写客户端程序，请向服务器发送一条消息，要求服务器将您的请求来自的 IP 地址作为数据发送回。这样，您将知道*相关*IP 地址是什么，给定您正在与之通信的计算机的上下文。

也就是说，该技巧可能不适用于某些目的（例如，当您不与特定计算机通信时），因此有时您只需要收集与您的计算机关联的所有 IP 地址的列表。在 Unix/Mac (AFAIK) 下最好的方法是调用 getifaddrs() 并迭代结果。在 Windows 下，尝试 GetAdaptersAddresses() 以获得类似的功能。有关两者的用法示例，请参阅[此文件](https://public.msli.com/lcs/muscle/muscle/util/NetworkUtilityFunctions.cpp)中的 GetNetworkInterfaceInfos() 函数。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2012-05-31T18:04:25.173

基于 gethostbyname 的所有方法的问题在于，您不会获得分配给特定机器的所有 IP 地址。服务器通常有不止一个适配器。

下面是一个如何遍历主机上所有 Ipv4 和 Ipv6 地址的示例：

```
void ListIpAddresses(IpAddresses& ipAddrs)
{
  IP_ADAPTER_ADDRESSES* adapter_addresses(NULL);
  IP_ADAPTER_ADDRESSES* adapter(NULL);

  // Start with a 16 KB buffer and resize if needed -
  // multiple attempts in case interfaces change while
  // we are in the middle of querying them.
  DWORD adapter_addresses_buffer_size = 16 * KB;
  for (int attempts = 0; attempts != 3; ++attempts)
  {
    adapter_addresses = (IP_ADAPTER_ADDRESSES*)malloc(adapter_addresses_buffer_size);
    assert(adapter_addresses);

    DWORD error = ::GetAdaptersAddresses(
      AF_UNSPEC, 
      GAA_FLAG_SKIP_ANYCAST | 
        GAA_FLAG_SKIP_MULTICAST | 
        GAA_FLAG_SKIP_DNS_SERVER |
        GAA_FLAG_SKIP_FRIENDLY_NAME, 
      NULL, 
      adapter_addresses,
      &adapter_addresses_buffer_size);

    if (ERROR_SUCCESS == error)
    {
      // We're done here, people!
      break;
    }
    else if (ERROR_BUFFER_OVERFLOW == error)
    {
      // Try again with the new size
      free(adapter_addresses);
      adapter_addresses = NULL;

      continue;
    }
    else
    {
      // Unexpected error code - log and throw
      free(adapter_addresses);
      adapter_addresses = NULL;

      // @todo
      LOG_AND_THROW_HERE();
    }
  }

  // Iterate through all of the adapters
  for (adapter = adapter_addresses; NULL != adapter; adapter = adapter->Next)
  {
    // Skip loopback adapters
    if (IF_TYPE_SOFTWARE_LOOPBACK == adapter->IfType)
    {
      continue;
    }

    // Parse all IPv4 and IPv6 addresses
    for (
      IP_ADAPTER_UNICAST_ADDRESS* address = adapter->FirstUnicastAddress; 
      NULL != address;
      address = address->Next)
    {
      auto family = address->Address.lpSockaddr->sa_family;
      if (AF_INET == family)
      {
        // IPv4
        SOCKADDR_IN* ipv4 = reinterpret_cast<SOCKADDR_IN*>(address->Address.lpSockaddr);

        char str_buffer[INET_ADDRSTRLEN] = {0};
        inet_ntop(AF_INET, &(ipv4->sin_addr), str_buffer, INET_ADDRSTRLEN);
        ipAddrs.mIpv4.push_back(str_buffer);
      }
      else if (AF_INET6 == family)
      {
        // IPv6
        SOCKADDR_IN6* ipv6 = reinterpret_cast<SOCKADDR_IN6*>(address->Address.lpSockaddr);

        char str_buffer[INET6_ADDRSTRLEN] = {0};
        inet_ntop(AF_INET6, &(ipv6->sin6_addr), str_buffer, INET6_ADDRSTRLEN);

        std::string ipv6_str(str_buffer);

        // Detect and skip non-external addresses
        bool is_link_local(false);
        bool is_special_use(false);

        if (0 == ipv6_str.find("fe"))
        {
          char c = ipv6_str[2];
          if (c == '8' || c == '9' || c == 'a' || c == 'b')
          {
            is_link_local = true;
          }
        }
        else if (0 == ipv6_str.find("2001:0:"))
        {
          is_special_use = true;
        }

        if (! (is_link_local || is_special_use))
        {
          ipAddrs.mIpv6.push_back(ipv6_str);
        }
      }
      else
      {
        // Skip all other types of addresses
        continue;
      }
    }
  }

  // Cleanup
  free(adapter_addresses);
  adapter_addresses = NULL;

  // Cheers!
} 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-09-23T16:44:57.837

您可以使用 gethostname 后跟 gethostbyname 来获取本地接口内部 IP。

但是，此返回的 IP 可能与您的外部 IP 不同。要获取您的外部 IP，您必须与外部服务器通信，该服务器会告诉您您的外部 IP 是什么。因为外部 IP 不是您的，而是您的路由器。

```
//Example: b1 == 192, b2 == 168, b3 == 0, b4 == 100
struct IPv4
{
    unsigned char b1, b2, b3, b4;
};

bool getMyIP(IPv4 & myIP)
{
    char szBuffer[1024];

    #ifdef WIN32
    WSADATA wsaData;
    WORD wVersionRequested = MAKEWORD(2, 0);
    if(::WSAStartup(wVersionRequested, &wsaData) != 0)
        return false;
    #endif

    if(gethostname(szBuffer, sizeof(szBuffer)) == SOCKET_ERROR)
    {
      #ifdef WIN32
      WSACleanup();
      #endif
      return false;
    }

    struct hostent *host = gethostbyname(szBuffer);
    if(host == NULL)
    {
      #ifdef WIN32
      WSACleanup();
      #endif
      return false;
    }

    //Obtain the computer's IP
    myIP.b1 = ((struct in_addr *)(host->h_addr))->S_un.S_un_b.s_b1;
    myIP.b2 = ((struct in_addr *)(host->h_addr))->S_un.S_un_b.s_b2;
    myIP.b3 = ((struct in_addr *)(host->h_addr))->S_un.S_un_b.s_b3;
    myIP.b4 = ((struct in_addr *)(host->h_addr))->S_un.S_un_b.s_b4;

    #ifdef WIN32
    WSACleanup();
    #endif
    return true;
} 
```

您也可以始终只使用代表本地计算机的 127.0.0.1。

**Windows 中的子网掩码：**

您可以通过查询此注册表项的子项来获取子网掩码（以及网关和其他信息）：

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces

查找注册表值 SubnetMask。

**Windows中获取接口信息的其他方法：**

您还可以使用以下选项检索您要查找的信息： [WSAIoctl](http://msdn.microsoft.com/en-us/library/ms741621(VS.85).aspx)与此选项：SIO_GET_INTERFACE_LIST

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2015-03-04T08:16:29.890

## 你不能在标准 C++ 中做到这一点。

我发布这个是因为它是唯一正确的答案。您的问题询问如何在 C++ 中执行此操作。好吧，你不能在 C++ 中做到这一点。您可以在 Windows、POSIX、Linux、Android 中执行此操作，但所有这些都是**特定于操作系统的解决方案**，而不是语言标准的一部分。

标准 C++**根本没有网络层**。

我假设您有一个错误的假设，即 C++ 标准定义了与其他语言标准 Java 相同的功能范围。虽然 Java 可能在语言自己的标准库中具有内置网络（甚至是 GUI 框架），但 C++ 没有。

虽然有 C++ 程序可以使用的第三方 API 和库，但这绝不等同于说您可以在 C++ 中完成。

这是一个例子来澄清我的意思。您可以在 C++ 中打开文件，因为它有一个`fstream`类作为其标准库的一部分。这与 using 不同`CreateFile()`，后者是特定于 Windows 的函数，仅适用于 WINAPI。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-23T16:47:55.100

Winsock 具体：

```
// Init WinSock
WSADATA wsa_Data;
int wsa_ReturnCode = WSAStartup(0x101,&wsa_Data);

// Get the local hostname
char szHostName[255];
gethostname(szHostName, 255);
struct hostent *host_entry;
host_entry=gethostbyname(szHostName);
char * szLocalIP;
szLocalIP = inet_ntoa (*(struct in_addr *)*host_entry->h_addr_list);
WSACleanup(); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-21T11:40:18.737

另外，请注意“本地 IP”可能不是一个特别独特的东西。如果您在多个物理网络上（例如有线+无线+蓝牙，或者有很多以太网卡的服务器等），或者设置了 TAP/TUN 接口，您的机器可以轻松拥有一整套接口。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T16:49:59.120

> > 来自 torial：如果你使用 winsock，这里有一个方法：[http ://tangentsoft.net/wskfaq/examples/ipaddr.html](http://tangentsoft.net/wskfaq/examples/ipaddr.html)

至于问题的子网部分；没有平台无关的方法来检索子网掩码，因为 POSIX 套接字 API（所有现代操作系统都实现）没有指定这一点。因此，您必须使用您正在使用的平台上可用的任何方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T16:45:24.077

[如何获得网络上本地机器的IP地址](http://windows-programming.suite101.com/article.cfm/socket_programming_gethostbyname "如何获取网络上本地机器的IP地址")似乎很好地描述了解决方案......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-10-09T16:11:47.383

我可以使用 VS2013 下的 DNS 服务来实现它，代码如下：

```
#include <Windns.h>

WSADATA wsa_Data;

int wsa_ReturnCode = WSAStartup(0x101, &wsa_Data);

gethostname(hostName, 256);
PDNS_RECORD pDnsRecord;

DNS_STATUS statsus = DnsQuery(hostName, DNS_TYPE_A, DNS_QUERY_STANDARD, NULL, &pDnsRecord, NULL);
IN_ADDR ipaddr;
ipaddr.S_un.S_addr = (pDnsRecord->Data.A.IpAddress);
printf("The IP address of the host %s is %s \n", hostName, inet_ntoa(ipaddr));

DnsRecordListFree(&pDnsRecord, DnsFreeRecordList); 
```

我不得不在链接器选项中添加 Dnsapi.lib 作为成瘾依赖项。

参考[这里](https://msdn.microsoft.com/en-us/library/windows/desktop/ms682016%28v=vs.85%29.aspx)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-04-05T14:33:24.493

[此答案](https://stackoverflow.com/a/10838854/1106547)的修改版本。
添加了头文件和库。

它还基于以下页面：
[GetAdaptersAddresses](https://docs.microsoft.com/en-us/windows/win32/api/iphlpapi/nf-iphlpapi-getadaptersaddresses)
[IP_ADAPTER_ADDRESSES_LH](https://docs.microsoft.com/en-us/windows/win32/api/iptypes/ns-iptypes-ip_adapter_addresses_lh)
[IP_ADAPTER_UNICAST_ADDRESS_LH](https://docs.microsoft.com/en-us/windows/win32/api/iptypes/ns-iptypes-ip_adapter_unicast_address_lh)

简而言之，要获取 IPv4 地址，您需要调用`GetAdaptersAddresses()`以获取适配器，然后遍历以`IP_ADAPTER_UNICAST_ADDRESS`开头的结构`FirstUnicastAddress`并获取`Address`字段，然后将其转换为具有`inet_ntop()`.

以以下格式打印信息：

```
[ADAPTER]: Realtek PCIe
[NAME]:    Ethernet 3
[IP]:      123.123.123.123 
```

可以编译：

```
cl test.cpp 
```

或者，如果您需要在命令行中添加 libs 依赖项：

```
cl test.cpp Iphlpapi.lib ws2_32.lib 
```

```
#include <winsock2.h>
#include <iphlpapi.h>
#include <stdio.h>
#include <ws2tcpip.h>

// Link with Iphlpapi.lib and ws2_32.lib
#pragma comment(lib, "Iphlpapi.lib")
#pragma comment(lib, "ws2_32.lib")

void ListIpAddresses() {
  IP_ADAPTER_ADDRESSES* adapter_addresses(NULL);
  IP_ADAPTER_ADDRESSES* adapter(NULL);

  DWORD adapter_addresses_buffer_size = 16 * 1024;

  // Get adapter addresses
  for (int attempts = 0; attempts != 3; ++attempts) {
    adapter_addresses = (IP_ADAPTER_ADDRESSES*) malloc(adapter_addresses_buffer_size);

    DWORD error = ::GetAdaptersAddresses(AF_UNSPEC, 
      GAA_FLAG_SKIP_ANYCAST | 
        GAA_FLAG_SKIP_MULTICAST | 
        GAA_FLAG_SKIP_DNS_SERVER | 
        GAA_FLAG_SKIP_FRIENDLY_NAME,
      NULL, 
      adapter_addresses,
      &adapter_addresses_buffer_size);

    if (ERROR_SUCCESS == error) {
      break;
    }
    else if (ERROR_BUFFER_OVERFLOW == error) {
      // Try again with the new size
      free(adapter_addresses);
      adapter_addresses = NULL;
      continue;
    }
    else {
      // Unexpected error code - log and throw
      free(adapter_addresses);
      adapter_addresses = NULL;
      return;
    }
  }

  // Iterate through all of the adapters
  for (adapter = adapter_addresses; NULL != adapter; adapter = adapter->Next) {
    // Skip loopback adapters
    if (IF_TYPE_SOFTWARE_LOOPBACK == adapter->IfType) continue;

    printf("[ADAPTER]: %S\n", adapter->Description);
    printf("[NAME]:    %S\n", adapter->FriendlyName);

    // Parse all IPv4 addresses
    for (IP_ADAPTER_UNICAST_ADDRESS* address = adapter->FirstUnicastAddress; NULL != address; address = address->Next) {
      auto family = address->Address.lpSockaddr->sa_family;
      if (AF_INET == family) {
        SOCKADDR_IN* ipv4 = reinterpret_cast<SOCKADDR_IN*>(address->Address.lpSockaddr);
        char str_buffer[16] = {0};
        inet_ntop(AF_INET, &(ipv4->sin_addr), str_buffer, 16);

        printf("[IP]:      %s\n", str_buffer);
      }
    }
    printf("\n");
  }

  free(adapter_addresses);
  adapter_addresses = NULL;
}

int main() {
  ListIpAddresses();
  return 0;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-01-09T01:30:55.027

我建议我的代码。

```
DllExport void get_local_ips(boost::container::vector<wstring>& ips)
{
   IP_ADAPTER_ADDRESSES*       adapters  = NULL;
   IP_ADAPTER_ADDRESSES*       adapter       = NULL;
   IP_ADAPTER_UNICAST_ADDRESS* adr           = NULL;
   ULONG                       adapter_size = 0;
   ULONG                       err           = 0;
   SOCKADDR_IN*                sockaddr  = NULL;

   err = ::GetAdaptersAddresses(AF_UNSPEC, GAA_FLAG_SKIP_ANYCAST | GAA_FLAG_SKIP_MULTICAST | GAA_FLAG_SKIP_DNS_SERVER | GAA_FLAG_SKIP_FRIENDLY_NAME, NULL, NULL, &adapter_size);
   adapters = (IP_ADAPTER_ADDRESSES*)malloc(adapter_size);
   err = ::GetAdaptersAddresses(AF_UNSPEC, GAA_FLAG_SKIP_ANYCAST | GAA_FLAG_SKIP_MULTICAST | GAA_FLAG_SKIP_DNS_SERVER | GAA_FLAG_SKIP_FRIENDLY_NAME, NULL, adapters, &adapter_size);

   for (adapter = adapters; NULL != adapter; adapter = adapter->Next)
   {
       if (adapter->IfType     == IF_TYPE_SOFTWARE_LOOPBACK) continue; // Skip Loopback
       if (adapter->OperStatus != IfOperStatusUp) continue;            // Live connection only  

       for (adr = adapter->FirstUnicastAddress;adr != NULL; adr = adr->Next)
       {
           sockaddr = (SOCKADDR_IN*)(adr->Address.lpSockaddr);
           char    ipstr [INET6_ADDRSTRLEN] = { 0 };
           wchar_t ipwstr[INET6_ADDRSTRLEN] = { 0 };
           inet_ntop(AF_INET, &(sockaddr->sin_addr), ipstr, INET_ADDRSTRLEN);
           mbstowcs(ipwstr, ipstr, INET6_ADDRSTRLEN);
           wstring wstr(ipwstr);
           if (wstr != "0.0.0.0") ips.push_back(wstr);                      
       }
   }

   free(adapters);
   adapters = NULL; } 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-09-23T17:44:51.517

你不能只发送到[INADDR_BROADCAST](http://msdn.microsoft.com/en-us/library/ms740148(VS.85).aspx)吗？诚然，这将在所有接口上发送 - 但这很少有问题。

否则，ioctl 和 SIOCGIFBRDADDR 应该在 *nix 上为您提供地址，在 win32 上[为 WSAioctl 和 SIO_GET_BROADCAST_ADDRESS](http://msdn.microsoft.com/en-us/library/ms741621(VS.85).aspx)。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-08-22T22:51:07.107

在 DEV C++ 中，我使用带有 WIN32 的纯 C 语言，以及这段给定的代码：

```
case IDC_IP:

             gethostname(szHostName, 255);
             host_entry=gethostbyname(szHostName);
             szLocalIP = inet_ntoa (*(struct in_addr *)*host_entry->h_addr_list);
             //WSACleanup(); 
             writeInTextBox("\n");
             writeInTextBox("IP: "); 
             writeInTextBox(szLocalIP);
             break; 
```

当我单击“显示 ip”按钮时，它可以工作。但是第二次，程序退出（没有警告或错误）。当我做：

```
//WSACleanup(); 
```

即使以最快的速度多次单击同一个按钮，程序也不会退出。所以 WSACleanup() 可能不适用于 Dev-C++ ..

# c# - 如何在没有公共构造函数的情况下模拟/伪造/存根密封 OracleException？

> ID：122215
> 
> 赞同：11
> 
> 时间：2008-09-23T16:43:21.960
> 
> 标签：c#, .net, oracle, mocking, oracleclient

在我的测试中，我需要测试抛出 OracleException 时会发生什么（由于存储过程失败）。我正在尝试将 Rhino Mocks 设置为

```
Expect.Call(....).Throw(new OracleException()); 
```

然而，无论出于何种原因，OracleException 似乎被密封而没有公共构造函数。我能做些什么来测试这个？

**编辑：**这正是我要实例化的内容：

```
public sealed class OracleException : DbException {
  private OracleException(string message, int code) { ...}
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2014-10-09T22:22:20.257

对于 oracle 的托管数据访问（v 4.121.1.0），构造函数再次更改

```
var ci = typeof(OracleException).GetConstructor(BindingFlags.NonPublic | BindingFlags.Instance, null, new Type[] { typeof(int), typeof(string), typeof(string), typeof(string) }, null);
var c = (OracleException)ci.Invoke(new object[] { 1234, "", "", "" }); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T17:30:04.297

这是您的操作方法：

```
 ConstructorInfo ci = typeof(OracleException).GetConstructor(BindingFlags.NonPublic | BindingFlags.Instance, null, new Type[] {typeof(string), typeof(int)}, null);
    var c = (OracleException)ci.Invoke(new object[] { "some message", 123 }); 
```

感谢所有帮助，您已被投票

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T16:48:01.027

使用反射来实例化 OracleException。请参阅[此博客文章](http://webcache.googleusercontent.com/search?q=cache:http://www.canerten.com/reflection-with-private-members/&hl=en&strip=1)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-07-01T17:10:09.947

我正在使用 Oracle.DataAccess.Client 数据提供程序客户端。我在构造 OracleException 对象的新实例时遇到问题，但它一直告诉我没有公共构造函数。我尝试了上面显示的所有想法并不断收到空引用异常。

```
object[] args = { 1, "Test Message" };
ConstructorInfo ci = typeof(OracleException).GetConstructor(BindingFlags.NonPublic 
     | BindingFlags.Instance, null, System.Type.GetTypeArray(args), null);
var e = (OracleException)ci.Invoke(args); 
```

在调试测试代码时，我总是得到 'ci' 的 NULL 值。

Oracle 是否已将库更改为不允许这样做？我做错了什么，我需要做什么来实例化一个 OracleException 对象以与 NMock 一起使用？

顺便说一句，我正在使用版本 10g 的客户端库。

谢谢，

查理

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-05-06T08:03:01.007

似乎Oracle在以后的版本中更改了他们的构造函数，因此上面的解决方案将不起作用。

如果您只想设置错误代码，以下将为 2.111.7.20 解决问题：

```
ConstructorInfo ci = typeof(OracleException)
            .GetConstructor(
                BindingFlags.NonPublic | BindingFlags.Instance, 
                null, 
                new Type[] { typeof(int) }, 
                null
                );

Exception ex = (OracleException)ci.Invoke(new object[] { 3113 }); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-23T16:45:36.323

使用反射来实例化 OracleException 对象？代替

```
new OracleException() 
```

和

```
object[] args = ... ;
(OracleException)Activator.CreateInstance(typeof(OracleException), args) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-06-29T09:03:18.907

你总是可以像这样得到所有的构造函数

```
ConstructorInfo[] all = typeof(OracleException).GetConstructors(
  BindingFlags.NonPublic | BindingFlags.Instance);` 
```

对于`Oracle.DataAccess`4.112.3.0，这返回了 7 个构造函数

[![在此处输入图像描述](https://i.stack.imgur.com/FAEdJ.png)](https://i.stack.imgur.com/FAEdJ.png)

我想要的是列表中的第二个，它带有 5 个参数，`int, string, string, string, int`. 我对第五个参数感到惊讶，因为在 ILSpy 中它看起来像这样

```
internal OracleException(int errCode, string dataSrc, string procedure, string errMsg)
{
    this.m_errors = new OracleErrorCollection();
    this.m_errors.Add(new OracleError(errCode, dataSrc, procedure, errMsg));
} 
```

所以，为了得到我想要的构造函数，我最终使用了

```
ConstructorInfo constructorInfo =
  typeof(OracleException).GetConstructor(
    BindingFlags.NonPublic | BindingFlags.Instance,
    null,
    new Type[] { typeof(int), typeof(string), typeof(string), typeof(string), typeof(int) },
    null);` 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-17T03:22:46.660

很好的解决方案乔治。这也适用于 SqlException：

```
 ConstructorInfo ci = typeof( SqlErrorCollection ).GetConstructor( BindingFlags.NonPublic | BindingFlags.Instance, null, new Type[] {  }, null );
        SqlErrorCollection errorCollection = (SqlErrorCollection) ci.Invoke(new object[]{});

        ci = typeof( SqlException ).GetConstructor( BindingFlags.NonPublic | BindingFlags.Instance, null, new Type[] { typeof( string ), typeof( SqlErrorCollection ) }, null );
        return (SqlException) ci.Invoke( new object[] { "some message", errorCollection } ); 
```

-戴夫

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-23T16:44:49.507

你能写一个每次都失败/错误的简单存储过程，然后用它来测试吗？

# php - PHP 反序列化不断抛出相同的错误超过 100 次第 2 部分

> ID：122216
> 
> 赞同：-2
> 
> 时间：2008-09-23T16:43:24.470
> 
> 标签：php, serialization

所以我有一个我序列化的大型二维数组，但是当我尝试反序列化数组时，它只会抛出相同的错误，导致 Firefox 几乎崩溃。

错误是：

```
Warning: unserialize() [function.unserialize]: Node no longer exists in /var/www/dev/wc_paul/inc/analyzerTester.php on line 24 
```

我会包含我回显的整个序列化数组，但上次我在这个表单上尝试它时它使我的 Firefox 崩溃。

有谁知道为什么会发生这种情况？

我确定这是一个数组。但是，它最初是来自另一台服务器的 XML 响应，然后我从中提取值来构建数组。如果它不能被序列化，我可以接受我猜......但是我应该如何去保存它呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T16:48:04.507

通常，当您收到错误消息时，只需在网络上搜索该消息即可找出很多信息。例如，当您将[Node 不再存在](http://www.google.co.uk/search?q=Node+no+longer+exists)到 Google 中时，您最终会得到[一个关于为什么会发生这种情况的简明解释，以及一个解决方案](http://www.rhinocerus.net/node/16347)，作为第一个命中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T16:47:59.967

回答关于如何保存数据的第二个问题

为什么不将xml响应直接输出到文件并保存在本地，然后在需要时从本地文件中读取。

# windows - Windows 上 Git 的文件描述符无效问题

> ID：122226
> 
> 赞同：3
> 
> 时间：2008-09-23T16:45:04.157
> 
> 标签：windows, git, version-control, push

我已经在 Linux 上使用 Git 大约一年了，一切正常。最近，一位同事加入了开发，他正在使用 Windows。那里一切正常，但有时当他尝试将更改推送到 Linux 服务器上的远程存储库（裸机）时，它会以“无效的文件描述符”消息退出。

我使用 Linux git 更新了同一个远程存储库，没有任何问题。我们尝试了 WinGit 0.2 和[MSysGit](http://code.google.com/p/msysgit/)（今天下载，使用 Git 1.5.6）。两者都有同样的问题。

我应该提一下，网络运行没有任何问题。我可以从头开始克隆整个存储库。我只是无法对其进行任何更改。

有没有人见过这样的东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T00:36:04.273

我不是 git 用户，所以这是一个完整的猜测：TCP 连接是否已断开？尝试使用 Wireshark 捕获网络流量。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T13:04:13.953

也许您的防病毒软件有问题。我在我的机器上遇到了同样的问题，我（仍然）使用 nod32，只是禁用线程保护模块 IMON，这可以解决问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T20:35:17.047

众所周知，Win32 上的 git 是不确定的。你试过[最新的 msysgit](http://code.google.com/p/msysgit/downloads/list)吗？它是 1.6.0.2 的一个端口（9 月 23 日发布）。另外，有没有什么方法可以从失败的 git 命令中获得更详细/跟踪的输出？

# asp.net - .NET 在某些情况下找不到我在经典 asp 中创建的 cookie

> ID：122229
> 
> 赞同：2
> 
> 时间：2008-09-23T16:45:23.000
> 
> 标签：asp.net, internet-explorer, cookies, asp-classic

我是唯一支持混合了经典 asp 和 .NET 的网站的开发人员。我不得不将一些 .net 页面添加到经典的 asp 应用程序中。此应用程序需要用户登录。登录页面以经典 asp 编写，创建一个 cookie，.net 页面使用该 cookie 来识别登录用户，并将信息存储在会话变量中以供其他经典 asp 页面使用。在经典的 asp 中，cookie 代码如下：

```
response.cookies("foo")("value1") = value1
response.cookies("foo")("value2") = value2
response.cookies("foo").Expires = DateAdd("N", 15, Now())
response.cookies("foo").Path = "/" 
```

在 .NET 代码隐藏 Page_Load 代码中，我使用下面的代码检查 cookie。

> if(!IsPostBack) {
> if(Request.Cookies["foo"] != null) { ... } else { //重定向到cookie创建页面，cookiefoo.asp } }

绝大多数情况下，这都没有问题。但是，我们有一些用户被重定向到 cookie 创建页面，因为 Page_Load 代码找不到 cookie。无论用户被重定向到 cookie 创建页面多少次，引用页面仍然可以找到 cookie，foo。问题发生在 IE7 中，我尝试修改浏览器中的隐私和 cookie 设置，但似乎无法重现用户遇到的问题。

有谁知道为什么 IE7 会发生这种情况？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T16:49:35.517

使用[Fiddler](http://www.fiddlertool.com/fiddler/)是尝试弄清楚发生了什么的好方法。您可以看到浏览器获取的确切 Set-Cookie。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-25T17:31:20.770

关于 cookie 可能很难调试的一件事是，当涉及到域时，cookie 是区分大小写的。因此，如果用户键入“www.abc.com/dir1/Alpha/”，则无法从代码访问为“www.abc.com/dir1/alpha/”发布的 cookie。

在 ASP.NET 页面中要注意的另一件事是

```
Page.Response.Redirect("~/alpha"); 
```

ASP.NET 会根据实际文件路径的大小写修改相对 URL 的大小写。如果您的目录结构中有混合大小写，请使用

```
Page.Response.Redirect(Page.ResolveUrl("~/alpha").ToLower()); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T16:50:15.267

跨平台 cookie 测试的一般规则：将所有 cookie 转储到屏幕上，以便您查看数据。它可能无法准确解释它发生的原因，但它应该告诉您正在发生的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T17:00:43.633

好的第二个答案：如果它是一小部分用户，您可能想查看他们在计算机上安装了哪些软件。在他们所有的机器上可能有一个常见的反间谍软件/广告软件应用程序会弄乱您的 cookie。

如果您无法从这些用户那里得到答案，或者没有任何疑问，那么可能值得创建一个特殊的小测试脚本来编写一个 cookie 并将结果在下一个页面加载时发回给您。

你想让它尽可能简单（加载链接后没有用户交互），所以让它：

1.  在经典 ASP 中设置 cookie
2.  重定向到另一个 ASP 页。
3.  阅读 cookie 并将其通过电子邮件发送给您。
4.  重定向到 ASPNET 页。
5.  阅读 cookie 并通过电子邮件发送。

您可能还想在 ASPNET 中设置一个 cookie 并尝试将其读回。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T20:42:56.713

如果 IE7 隐私设置设置为阻止第一方 cookie，则您发布的代码应该会中断。你在实验中尝试过吗？

正如 Lou 所说，使用 Fiddler 是一个好主意，尽管 Set-Cookie 响应标头不如后续 Cookie 请求标头有趣，以查看客户端是否将它们转发到服务器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-27T05:43:11.393

我记得这发生在我写的一个类似的应用程序中；一些页面是经典的 ASP，而另一些是 ASP.NET。cookie 似乎在 .NET 和经典 ASP 页面之间消失了。

IIRC，.NET 端需要 Server.HTMLEncode/HTMLDecode cookie。对不起，但我没有我使用的确切代码，但这应该会让你朝着正确的方向前进。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-08-26T15:31:56.343

*几十年后*（这肯定值得一枚奖牌）

对我来说，这是**cookie key 中的特殊字符**。

具体来说，引起我注意的是一个带有钥匙的饼干`utlização`，它总是像`null`.

因此，我们`.Replace("ç", "c").Replace("ã", "a")`在生成 cookie 密钥时添加了故障保护。它修复了它。

*cookie 一直显示在浏览器中，因此需要一段时间才能观察到这种模式。谢谢女士。*

# c++builder - C++ Builder 版本的相对稳健性如何？

> ID：122234
> 
> 赞同：3
> 
> 时间：2008-09-23T16:46:30.313
> 
> 标签：c++builder, c++builder-2009

我们的开发团队使用 Borland C++ Builder 6 和 CodeGear C++ Builder 2007（以及 Visual Studio）。我听到很多评论说 Builder 2007 IDE 比 BCB6 崩溃的次数要多得多。有没有人有任何 C++ Builder 2009 IDE 的经验，特别是有一个相当大的应用程序，如果有的话，在整体健壮性方面与 6 或 2007 相比如何？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T10:08:23.043

到目前为止，我对 BCB2009 的体验大多是积极的。IDE 看起来很稳定，安装等速度要快得多。

但是，我还没有将一个主要项目转移到 2009 年，但我几乎可以向您保证，由于 Unicode 的变化，这将是不平凡的。您将需要切换到您使用的任何第三方库/组件的新版本，以及对现有代码中使用的所有字符串进行完整性检查。也没有这样做的“最佳实践”指南。

当然，如果你不使用 VCL，这不会是一个问题 - 但是，你为什么要使用 BCB ......？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T08:04:52.807

我没有使用过 C++ Builder 2009，但也许这会对你有所帮助。

根据 Chris Pattinson（CodeGear 的 QA 经理）的说法，他们在 Delphi 和 C++ Builder 2009 中进行了 4000 多个修复（请参阅此博客：http: [//blogs.codegear.com/chrispattinson/2008/09/19/38897](http://blogs.codegear.com/chrispattinson/2008/09/19/38897)）

他链接到 cn.codegear.com 上的一篇文章，该文章详细介绍了 C++ Builder 的所有修复，请参阅[http://dn.codegear.com/article/38715](http://dn.codegear.com/article/38715)

# css - 在 CSS 选择器中处理元素 ID 中的冒号

> ID：122238
> 
> 赞同：156
> 
> 时间：2008-09-23T16:47:20.453
> 
> 标签：css, jsf, css-selectors

JSF 将输入字段的 ID 设置为`search_form:expression`. 我需要在该元素上指定一些样式，但是该冒号看起来像是浏览器的伪元素的开头，因此它被标记为无效并被忽略。反正有没有逃避冒号之类的？

```
input#search_form:expression {
  ///...
} 
```

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2008-09-23T16:52:40.847

反斜杠：

```
input#search_form\:expression {  ///...} 
```

*   另请参阅*[将命名空间与 CSS 一起使用](http://msdn.microsoft.com/en-us/library/ms762307(VS.85).aspx)*(MSDN)

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2009-03-17T23:52:11.037

在许多版本的 IE（尤其是 6 和 7；可能还有其他版本）中，在冒号前使用反斜杠不起作用。

一种解决方法是使用冒号的十六进制代码 - 即 \3A

例子：

```
input#search_form\3A expression {  } 
```

这适用于所有浏览器：包括 IE6+（可能更早？）、Firefox、Chrome、Opera 等。它是[CSS2 标准](http://www.w3.org/TR/CSS2/syndata.html#characters)的一部分。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-06-05T08:56:41.660

[本文](http://mathiasbynens.be/notes/css-escapes)将告诉您如何在 CSS 中转义任何字符。

现在，甚至还有一个工具： http: [//mothereff.in/css-escapes#0search%5fform%3Aexpression](http://mothereff.in/css-escapes#0search%5fform%3Aexpression)

TL;DR 这个问题的所有其他答案都不正确。您需要同时转义下划线（以防止 IE6 在某些极端情况下完全忽略该规则）和冒号字符，以便选择器在不同的浏览器中正常工作。

从技术上讲，冒号字符可以转义为`\:`，但这在 IE < 8 中不起作用，因此您必须使用`\3a`：

```
#search\_form\3a expression {} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-23T16:53:30.033

你可以用反斜杠转义它

```
input#search_form\:expression {
  ///...
} 
```

来自[CSS 规范](http://www.w3.org/TR/CSS21/syndata.html#characters)

4.1.3 字符和大小写

以下规则始终成立：

所有 CSS 样式表都不区分大小写，除了不受 CSS 控制的部分。例如，HTML 属性“id”和“class”、字体名称和 URI 的值的大小写敏感性超出了本规范的范围。请特别注意，元素名称在 HTML 中不区分大小写，但在 XML 中区分大小写。在 CSS 中，标识符（包括选择器中的元素名称、类和 ID）只能包含字符 [a-z0-9] 和 ISO 10646 字符 U+00A1 及更高，加上连字符 (-) 和下划线 (_) ; 它们不能以数字或连字符后跟数字开头。标识符还可以包含转义字符和任何 ISO 10646 字符作为数字代码（请参阅下一项）。例如，标识符“B&W？” 可以写成“B\&W\?” 或者 ”

在 CSS 2.1 中，反斜杠 () 字符表示三种类型的字符转义。首先，在字符串中，后跟换行符的反斜杠被忽略（即，字符串被认为不包含反斜杠或换行符）。

其次，它取消了特殊 CSS 字符的含义。任何字符（十六进制数字除外）都可以用反斜杠转义以消除其特殊含义。例如，"\"" 是一个由一个双引号组成的字符串。样式表预处理器不能从样式表中删除这些反斜杠，因为这会改变样式表的含义。

第三，反斜杠转义允许作者引用他们不能轻易放入文档的字符。在这种情况下，反斜杠后跟最多六个十六进制数字 (0..9A..F)，代表带有该数字的 ISO 10646 ([ISO10646]) 字符，该数字不得为零。（在 CSS 2.1 中未定义如果样式表确实包含 Unicode 代码点为零的字符会发生什么。）如果 [0-9a-f] 范围内的字符跟在十六进制数字后面，则需要将数字结尾清除。有两种方法可以做到这一点：

带有空格（或其他空白字符）：“\26 B”（“&B”）。在这种情况下，用户代理应将“CR/LF”对 (U+000D/U+000A) 视为单个空白字符。通过提供正好 6 个十六进制数字： "\000026B" ("&B") 实际上，这两种方法可以结合使用。十六进制转义后仅忽略一个空白字符。请注意，这意味着转义序列之后的“真实”空间本身必须被转义或加倍。

如果数字超出 Unicode 允许的范围（例如，“\110000”高于当前 Unicode 允许的最大 10FFFF），UA 可以用“替换字符”（U+FFFD）替换转义。如果要显示字符，UA 应该显示一个可见符号，例如“缺失字符”字形（参见 15.2，第 5 点）。

注意：在允许的情况下，反斜杠转义总是被认为是标识符或字符串的一部分（即，“\7B”不是标点符号，即使“{”是，并且“\32”允许在开头类名，即使“2”不是）。标识符“te\st”与“test”完全相同。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-02-09T11:42:09.840

我在使用冒号时遇到了同样的问题，我无法更改它们（无法访问输出冒号的代码），我想使用带有 jQ​​uery 的 CSS3 选择器来获取它们。

我把它放在这里，因为它可能对某人有帮助

`input[id="something:something"]` 在 jQuery 选择器中运行良好，它也可以在样式表中运行（可能存在浏览器问题）

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-01-24T01:35:14.353

在 JSF 2,0 中，您可以使用 web.xml 文件将分隔符指定为 javax.faces.SEPARATOR_CHAR 的 init-param

读这个：

*   [是否可以更改 JSF 中的元素 id 分隔符？](https://stackoverflow.com/questions/2142929/is-it-possible-to-change-the-element-id-separator-in-jsf)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-10-18T14:50:33.783

我在 ADF 框架中工作，并且经常不得不使用 JQuery 来选择元素。这种格式对我有用。这也适用于 IE8。

```
$('[id*="gantt1::majorAxis"]').css('border-top', 'solid 1px ' + mediumGray); 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2011-06-03T19:22:48.877

我发现只有这种格式适用于 IE7（也适用于 Firefox），并且我使用 JSF/Icefaces 1.8.2。

```
说表格id=FFF，元素id=EEE

var jq=jQuery.noConflict();
jq（文档）.ready（函数（）{
jq("[id=FFF:EEE]").someJQueryLibFunction({ jQuery lib 函数选项到这里 })
});

```

# css - 浮动 div 服从/不服从垂直对齐

> ID：122239
> 
> 赞同：6
> 
> 时间：2008-09-23T16:47:27.287
> 
> 标签：css

在一个垂直对齐的表格单元格中：底部，我有一个或两个 div。每个 div 都向右浮动。
据说，div 不应该与底部对齐，但它们确实如此（我不明白，但很好）。
但是，当我在单元格中有两个浮动 div 时，它们会将自身对齐到同一条顶线。
我希望第一个较小的 div 一直位于底部。另一种可接受的解决方案是使其与表格单元格齐高。

很难解释，所以代码如下：

> ```
> <style type="text/css"> 
> table {
>    border-collapse: collapse;
> }
> td {
>    border:1px solid black;
>    vertical-align:bottom;
> }
> .h {
>    float:right;
>    background: #FFFFCC;
> }
> .ha {
>    float:right;
>    background: #FFCCFF;
> }
> </style> 
> 
> <table> 
>   <tr> 
>     <td> 
>       <div class="ha">@</div> 
>       <div class="h">Title Text<br />Line 2</div> 
>     </td> 
>     <td> 
>       <div class="ha">@</div> 
>       <div class="h">Title Text<br />Line 2<br />Line 3</div> 
>     </td> 
>     <td> 
>       <div class="h">Title Text<br />Line 2</div> 
>     </td> 
>     <td> 
>       <div class="h">Title Text<br />Line 2</div> 
>     </td> 
>     <td> 
>       <div class="h">Title Text<br />Line 2</div> 
>     </td> 
>   </tr> 
>   <tr> 
>     <td> 
>       <div class="d">123456789</div> 
>     </td> 
>     <td> 
>       <div class="d">123456789</div> 
>     </td> 
>     <td> 
>       <div class="d">123456789</div> 
>     </td> 
>     <td> 
>       <div class="d">123456789</div> 
>     </td> 
>     <td> 
>       <div class="d">123456789</div> 
>     </td> 
>   </tr> 
> </table> 
> ```

以下是问题：

1.  为什么 @ 符号与黄色 div 位于同一级别？
2.  据说垂直对齐不适用于块元素（如浮动 div） 1\. 但它确实如此！
3.  如何使 @ 位于底部或使其与表格单元格齐高？

我在 IE7 和 FF2 中进行测试。目标支持是 IE6/7、FF2/3。

**澄清：**目标是在表格单元格的底线，黄色框*旁边有红色@。*在任一 div 上使用 clear 会将它们放在不同的行上。此外，单元格可以有可变的文本行 - 因此，*行高*将无济于事。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T16:56:06.657

我发现这篇文章对于理解和排除垂直对齐非常有用：

[了解垂直对齐，或“如何（不）垂直居中内容”](http://phrogz.net/CSS/vertical-align/index.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T13:54:12.810

我从来没有回答过前两个问题，所以请随时在下面给出你的答案。但我*确实*解决了最后一个问题，即如何使它工作。

我在表格单元格内的两个 div 中添加了一个包含 div，如下所示：

> ```
> <table>
>   <tr>
>     <td>
>       <div class="t">
>         <div class="h">Title Text<br />Line 2</div>
>         <div class="ha">@</div>
>       </div>
>     </td> 
> ```

然后我使用了以下CSS

> ```
> <style type="text/css">
> table {
>   border-collapse: collapse;
> }
> td {
>   border:1px solid black;
>   vertical-align:bottom;
> }
> .t {
>   position: relative;
>   width:150px;
> }
> .h {
>   background: #FFFFCC;
>   width:135px;
>   margin-right:15px;
>   text-align:right;
> }
> .ha {
>   background: #FFCCFF;
>   width:15px;
>   height:18px;
>   position:absolute;
>   right:0px;
>   bottom:0px;
> }
> </style> 
> ```

这一切的关键是**div 的位置绝对相对于它的*父级*，父级必须声明为 position:relative**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T16:52:17.023

添加`clear: both`到第二个元素。如果您想 @ 位于黄色框下方，请将其放在 HTML 代码的最后。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T16:53:30.343

如果您不希望两个 div 在同一行上，则不要将它们都浮动。如果您将 @ 放在标记中的文本下方，然后将浮动设置为“清除”，它会将其放在文本下方。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T16:58:09.817

> > [http://www.w3.org/TR/CSS2/visudet.html#line-height](http://www.w3.org/TR/CSS2/visudet.html#line-height)
> > 
> > 此属性影响由行内元素生成的框的行框内的垂直定位。以下值仅对父内联级元素或父块级元素有意义，前提是该元素生成匿名内联框；如果不存在这样的父级，则它们无效。

CSS 中的 vertical-align 属性总是令人困惑，因为在大多数情况下，它并没有按照您的预期做。这是因为它与许多 HTML 4 标签中允许的 valign 不同。

有关更多信息，您可以查看：

[http://www.ibloomstudios.com/articles/vertical-align_misuse/](http://www.ibloomstudios.com/articles/vertical-align_misuse/) [http://www.ibloomstudios.com/articles/applied_css_vertical-align/](http://www.ibloomstudios.com/articles/applied_css_vertical-align/)

David Alpert 发布的链接在这件事上非常有用。

# visual-studio - VS2005“添加新项目...”对话框 - 默认项目

> ID：122253
> 
> 赞同：5
> 
> 时间：2008-09-23T16:49:36.110
> 
> 标签：visual-studio, ide, visual-studio-2005, development-environment

安装第三方 SDK 后，如果它的模板成为 Visual Studio 2005 中“添加新项...”对话框中的默认项，它会非常不礼貌地将其设置为默认项。所有其他类似对话框也是如此 - “添加类.. .”、“添加用户控制...”等。

有没有办法改变这种行为？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-07T17:10:20.873

您可能必须自己手动修改 Item 模板上的 SortOrder。您可以按照以下说明执行此操作：

1) 找到项目模板

VS2005 的项目模板存储在以下位置：

 `````
 (Installed Templates) <VisualStudioInstallDir>\Common7\IDE\ItemTemplates\Language\Locale\
 (Custom Templates) My Documents\Visual Studio 2005\Templates\ItemTemplates\Language\ 
````  `2) 打开模板 zip 文件以修改 .vstemplate 文件。

每个项目模板都存储在一个 .zip 文件中，因此您需要打开与要修改的模板相关的 zip 文件。

打开模板的 .vstemplate 文件并在 TemplateData 部分下找到 SortOrder 属性。以下是一个示例文件：

 ``<TemplateData>
<Name>SomeITem</Name>
<Description>Description</Description>
<ProjectType>>CSharp</ProjectType>
**<SortOrder>1000</SortOrder>**
<DefaultName></DefaultName>
<ProvideDefaultName>true</ProvideDefaultName>
</TemplateData>`  `使用以下规则修改 SortOrder 值：

*   默认值为 100，所有值必须是 10 的倍数。
*   对于用户创建的模板，将忽略 SortOrder 元素。所有用户创建的模板都按字母顺序排序。
*   排序顺序值较低的模板出现在“新建项目”或“新建添加项”对话框中，位于排序顺序值较高的模板之前。

对模板定义进行编辑后，您需要打开命令提示符并导航到包含 devenv.exe 的目录，然后键入“devenv /setup”。这可能会重建一些内部设置，在您这样做之前，您不会看到任何差异。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T10:00:09.520

我刚刚在我的电脑上注意到了这个文件：

```
C:\Program Files\Microsoft Visual Studio 8\VC\VCNewItems\NewItems.vsdir 
```

这是一个文本文件，因此您可以检查是否存在有问题的第三方内容。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-23T16:53:31.560

尝试查看下的注册表

```
HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\ 
```

我在我的机器上看到了一些相关条目

```
HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\9.0 
```

对于 VS2008。

# java - 访问 JSP 中的常量（没有 scriptlet）

> ID：122254
> 
> 赞同：28
> 
> 时间：2008-09-23T16:49:41.790
> 
> 标签：java, jsp, session, jstl

我有一个定义各种会话属性名称的类，例如

```
class Constants {
    public static final String ATTR_CURRENT_USER = "current.user";
} 
```

我想在 JSP 中使用这些常量来测试这些属性是否存在，例如：

```
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page import="com.example.Constants" %>

<c:if test="${sessionScope[Constants.ATTR_CURRENT_USER] eq null}">
    <%-- Do somthing --%>
</c:if> 
```

但我似乎无法正确获取语法。此外，为了避免在多个地方重复上面相当冗长的测试，我想将结果分配给本地（页面范围）变量，并改为引用它。我相信我可以用 来做到这一点`<c:set>`，但我再次努力寻找正确的语法。

**更新：**根据以下建议，我尝试了：

```
<c:set var="nullUser" scope="session"
value="${sessionScope[Constants.ATTR_CURRENT_USER] eq null}" /> 
```

这没有用。因此，我尝试替换常量的字面值。我还将常量添加到页面的内容中，以便在呈现页面时验证常量的值

```
<c:set var="nullUser" scope="session"
value="${sessionScope['current.user'] eq null}" />
<%= "Constant value: " + WebHelper.ATTR_CURRENT_PARTNER %> 
```

这工作正常，它在页面上打印了预期值“current.user”。我无法解释为什么使用 String 文字有效，但是当两者似乎具有相同的值时，对常量的引用却不起作用。帮助.....

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-24T02:58:00.967

它在您的示例中不起作用，因为该`ATTR_CURRENT_USER`常量对 JSTL 标记不可见，这些标记期望属性由 getter 函数公开。我还没有尝试过，但是公开常量的最简洁方法似乎是[unstandard tag library](http://jakarta.apache.org/taglibs/sandbox/doc/unstandard-doc/index.html#useConstants "来自 Apache 的非标准标签库")。

ETA：我给的旧链接不起作用。可以在此答案中找到新链接：[JSP 中的 Java 常量](https://stackoverflow.com/questions/127328/java-constants-in-jsp)

用于阐明您所看到的行为的代码片段：示例类：

```
package com.example;

public class Constants
{
    // attribute, visible to the scriptlet
    public static final String ATTR_CURRENT_USER = "current.user";

    // getter function;
    // name modified to make it clear, later on, 
    // that I am calling this function
    // and not accessing the constant
    public String getATTR_CURRENT_USER_FUNC()
    {
        return ATTR_CURRENT_USER;
    }

} 
```

JSP 页面的片段，显示了示例用法：

```
<%-- Set up the current user --%>
<%
    session.setAttribute("current.user", "Me");
%>

<%-- scriptlets --%>
<%@ page import="com.example.Constants" %>
<h1>Using scriptlets</h1>
<h3>Constants.ATTR_CURRENT_USER</h3>
<%=Constants.ATTR_CURRENT_USER%> <br />
<h3>Session[Constants.ATTR_CURRENT_USER]</h3>
<%=session.getAttribute(Constants.ATTR_CURRENT_USER)%>

<%-- JSTL --%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<jsp:useBean id="cons" class="com.example.Constants" scope="session"/>

<h1>Using JSTL</h1>
<h3>Constants.getATTR_CURRENT_USER_FUNC()</h3>
<c:out value="${cons.ATTR_CURRENT_USER_FUNC}"/>
<h3>Session[Constants.getATTR_CURRENT_USER_FUNC()]</h3>
<c:out value="${sessionScope[cons.ATTR_CURRENT_USER_FUNC]}"/>
<h3>Constants.ATTR_CURRENT_USER</h3>
<c:out value="${sessionScope[Constants.ATTR_CURRENT_USER]}"/>
<%--
Commented out, because otherwise will error:
The class 'com.example.Constants' does not have the property 'ATTR_CURRENT_USER'.

<h3>cons.ATTR_CURRENT_USER</h3>
<c:out value="${sessionScope[cons.ATTR_CURRENT_USER]}"/>
--%>
<hr /> 
```

这输出：

# 使用小脚本

### 常量.ATTR_CURRENT_USER

当前用户

### 会话[常量.ATTR_CURRENT_USER]

我

* * *

# 使用 JSTL

### 常量.getATTR_CURRENT_USER_FUNC()

当前用户

### 会话[Constants.getATTR_CURRENT_USER_FUNC()]

我

### 常量.ATTR_CURRENT_USER

* * *

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-07-15T03:19:04.000

您可以使用 c:set 将 Constants.ATTR_CURRENT_USER 定义为变量，如下所示：

```
<c:set var="ATTR_CURRENT_USER" value="<%=Constants.ATTR_CURRENT_USER%>" />
<c:if test="${sessionScope[ATTR_CURRENT_USER] eq null}">     
    <%-- Do somthing --%> 
</c:if> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-08-19T09:32:04.537

这个话题很老了，但无论如何..:)

我找到了通过 JSTL 提供常量的很好的解决方案。您应该使用反射准备地图并将其放置在您想要的任何位置。

该映射将始终包含您在 Constants 类中定义的所有常量。您可以使用侦听器将其放入 ServletContext 并享受 JSTL 中的常量，例如：

```
${CONSTANTS["CONSTANT_NAME_IN_JAVA_CLASS_AS_A_STRING"]} 
```

这里的 CONSTANTS 是您将地图放入 Context 时使用的键 :-)

* * *

以下是我构建常量字段映射的一段代码：

```
Map<String, Object> map = new HashMap<String, Object>();
Class c = Constants.class;
Field[] fields = c.getDeclaredFields();
for (Field field : fields) {
   int modifier = field.getModifiers();
   if (Modifier.isPublic(modifier) && Modifier.isStatic(modifier) && Modifier.isFinal(modifier)) {
      try {
         map.put(field.getName(), field.get(null));//Obj param of get method is ignored for static fields
      } catch (IllegalAccessException e) { /* ignorable due to modifiers check */ }
   }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-19T09:15:09.397

将自定义 EL 解析器插入 EL 解析器链，它将解析常量。EL Resolver 是扩展[javax.el.E​​LResolver](http://docs.oracle.com/javaee/6/api/javax/el/ELResolver.html)类的 Java类。

谢谢，

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-07-16T20:53:47.687

在 EL 中无法访问静态属性。我使用的解决方法是创建一个将自身分配给静态值的非静态变量。

```
public final static String MANAGER_ROLE = 'manager';
public String manager_role = MANAGER_ROLE; 
```

我使用 lombok 来生成 getter 和 setter，这样就很好了。你的 EL 看起来像这样：

```
${bean.manager_role} 
```

完整代码在[https://rogerkeays.com/access-java-static-methods-and-constants-from-el](https://rogerkeays.com/access-java-static-methods-and-constants-from-el)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-08-28T20:34:26.000

我迟到了讨论，但我的方法有点不同。我使用自定义标记处理程序为 JSP 页面提供所需的常量值（数字或字符串）。这是我的做法：

假设我有一个保留所有常量的类：

```
public class AppJspConstants implements Serializable {
    public static final int MAXLENGTH_SIGNON_ID = 100;
    public static final int MAXLENGTH_PASSWORD = 100;
    public static final int MAXLENGTH_FULLNAME = 30;
    public static final int MAXLENGTH_PHONENUMBER = 30;
    public static final int MAXLENGTH_EXTENSION = 10;
    public static final int MAXLENGTH_EMAIL = 235;
} 
```

我也有这个非常简单的自定义标签：

```
public class JspFieldAttributes extends SimpleTagSupport {
    public void doTag() throws JspException, IOException {
        getJspContext().setAttribute("maxlength_signon_id", AppJspConstants.MAXLENGTH_SIGNON_ID);
        getJspContext().setAttribute("maxlength_password", AppJspConstants.MAXLENGTH_PASSWORD);
        getJspContext().setAttribute("maxlength_fullname", AppJspConstants.MAXLENGTH_FULLNAME);
        getJspContext().setAttribute("maxlength_phonenumber", AppJspConstants.MAXLENGTH_PHONENUMBER);
        getJspContext().setAttribute("maxlength_extension", AppJspConstants.MAXLENGTH_EXTENSION);
        getJspContext().setAttribute("maxlength_email", AppJspConstants.MAXLENGTH_EMAIL);

        getJspBody().invoke(null);
    }
} 
```

然后我有一个 StringHelper.tld。在里面，我有这个：

```
<tag>
    <name>fieldAttributes</name>
    <tag-class>package.path.JspFieldAttributes</tag-class>
    <body-content>scriptless</body-content>
    <info>This tag provide HTML field attributes that CCS is unable to do.</info>
</tag> 
```

在 JSP 上，我以正常方式包含 StringHelper.tld：

```
<%@ taglib uri="/WEB-INF/tags/StringHelper.tld" prefix="stringHelper" %> 
```

最后，我使用标签并使用 EL 应用所需的值。

```
 <stringHelper:fieldAttributes>
[snip]
            <form:input path="emailAddress" cssClass="formeffect" cssErrorClass="formEffect error" maxlength="**${maxlength_email}**"/>&nbsp;
            <form:errors path="emailAddress" cssClass="error" element="span"/>
[snip]
        </stringHelper:fieldAttributes> 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-23T18:33:41.430

首先，您的语法有一个额外的“]”，这会导致错误。

要解决这个问题，并设置一个变量，你可以这样做：

```
<c:set var="nullUser" 
    scope="session" 
    value="${sessionScope[Constants.ATTR_CURRENT_USER] eq null}" />

<c:if test="${nullUser}">
     <h2>First Test</h2>
</c:if>
<c:if test="${nullUser}">
     <h2>Another Test</h2>
</c:if> 
```

# imap - IMAP：如何将邮件从一个文件夹移动到另一个文件夹

> ID：122267
> 
> 赞同：22
> 
> 时间：2008-09-23T16:52:47.990
> 
> 标签：imap

（使用 IMAP 命令，不借助任何其他邮件包）

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2013-04-04T15:57:57.243

有多种方法可以做到这一点。最好的是2013 年初在[RFC 6851](https://www.rfc-editor.org/rfc/rfc6851)`UID MOVE`中定义的命令：

```
C: a UID MOVE 42:69 foo
S: * OK [COPYUID 432432 42:69 1202:1229]
S: * 22 EXPUNGE
S: (more expunges)
S: a OK Done 
```

该扩展的存在由`MOVE`能力指示。

如果它不可用，但`UIDPLUS`( [RFC 4315](https://www.rfc-editor.org/rfc/rfc4315) ) 可用，则第二好的选择是使用`UID STORE`,`UID COPY`和的组合`UID EXPUNGE`：

```
C: a01 UID COPY 42:69 foo
S: a01 OK [COPYUID 432432 42:69 1202:1229] Copied
C: a02 UID STORE 42:69 +FLAGS.SILENT (\Deleted)
S: a02 OK Stored
C: a03 UID EXPUNGE 42:69
S: * 10 EXPUNGE
S: * 10 EXPUNGE
S: * 10 EXPUNGE
S: a03 Expunged 
```

如果`UIDPLUS`缺少 ，则您无能为力 - 该`EXPUNGE`命令将永久删除所有标记为删除的消息，包括您未触及的消息。最好的办法是在这种情况下只使用`UID COPY`and `UID STORE`。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-23T16:59:10.580

我不确定您对 imap-speak 的精通程度，但基本上在登录后，“选择”源邮箱，“复制”邮件，然后“删除”邮件（或“删除”旧邮箱，如果它现在是空的:-)。

```
a login a s
b select source
c copy 1 othermbox
d store 1 +flags (\Deleted)
e expunge 
```

将是要发送的消息的示例。（**注意**：imap 消息在每个命令之前都需要一个唯一的前缀，因此前面的“ab c”）

有关详细信息，请参阅[RFC 2060](http://james.apache.org/server/rfclist/imap4/rfc2060.txt)。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2010-07-01T09:28:21.453

如果您有要移动的电子邮件的 uid。

```
import imaplib

obj = imaplib.IMAP4_SSL('imap.gmail.com', 993)
obj.login('username', 'password')
obj.select(src_folder_name)
apply_lbl_msg = obj.uid('COPY', msg_uid, desti_folder_name)
if apply_lbl_msg[0] == 'OK':
    mov, data = obj.uid('STORE', msg_uid , '+FLAGS', '(\Deleted)')
    obj.expunge() 
```

其中**msg_uid**是邮件的 uid。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T16:58:03.577

我猜您将消息复制到新文件夹，然后在旧文件夹中删除（删除）它。

[RFC3501](http://www.networksorcery.com/enp/rfc/rfc3501.txt)

**提示**没有 DELETE 命令可以执行您的意思，您必须将邮件标记为已删除，然后删除邮箱。看看 RFC。小心 DELETE，因为它会删除整个邮箱，而不是单个邮件。

# wpf - WPF hosting windows forms elements inside a ScrollViewer

> ID：122271
> 
> 赞同：4
> 
> 时间：2008-09-23T16:53:43.200
> 
> 标签：wpf

when putting a ScrollViewer inside a window(not keeping all the window's size) inside the ScrollViewer there's (with other stuff) a WinFormsHost and a control inside (let's say a DateTimePicker). when scrolling, the inner winforms control keeps being visible when there's no longer a reason (it's outside of the scrolling region), so it "floats" above what's outside of the ScrollViewer

any solutions for that?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T18:15:56.760

According to [this msdn link](http://msdn.microsoft.com/en-us/library/ms752027.aspx)

> WindowsFormsHost elements are always drawn on top of other WPF elements, and they are unaffected by z-order

I don't think there's an easy solution. You might want to consider having the windows forms control handle the scrolling itself instead of using WPF's ScrollViewer.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2016-10-31T12:55:45.203

Yes, there's a solution. Use the following custom WindowsFormsHost class.

```
class WindowsFormsHostEx : WindowsFormsHost
    {
        private PresentationSource _presentationSource;

        public WindowsFormsHostEx()
        {
            PresentationSource.AddSourceChangedHandler(this, SourceChangedEventHandler);
        }

        protected override void OnWindowPositionChanged(Rect rcBoundingBox)
        {
            base.OnWindowPositionChanged(rcBoundingBox);

            ParentScrollViewer.ScrollChanged += ParentScrollViewer_ScrollChanged;
            ParentScrollViewer.SizeChanged += ParentScrollViewer_SizeChanged;
            ParentScrollViewer.Loaded += ParentScrollViewer_Loaded;

            if (Scrolling || Resizing)
            {
                if (ParentScrollViewer == null)
                    return;
                GeneralTransform tr = RootVisual.TransformToDescendant(ParentScrollViewer);
                var scrollRect = new Rect(new Size(ParentScrollViewer.ViewportWidth, ParentScrollViewer.ViewportHeight));

                var intersect = Rect.Intersect(scrollRect, tr.TransformBounds(rcBoundingBox));
                if (!intersect.IsEmpty)
                {
                    tr = ParentScrollViewer.TransformToDescendant(this);
                    intersect = tr.TransformBounds(intersect);
                }
                else
                    intersect = new Rect();

                int x1 = (int)Math.Round(intersect.Left);
                int y1 = (int)Math.Round(intersect.Top);
                int x2 = (int)Math.Round(intersect.Right);
                int y2 = (int)Math.Round(intersect.Bottom);

                SetRegion(x1, y1, x2, y2);
                this.Scrolling = false;
                this.Resizing = false;

            }

        }

        private void ParentScrollViewer_Loaded(object sender, RoutedEventArgs e)
        {
            this.Resizing = true;
        }

        private void ParentScrollViewer_SizeChanged(object sender, SizeChangedEventArgs e)
        {
            this.Resizing = true;
        }

        private void ParentScrollViewer_ScrollChanged(object sender, ScrollChangedEventArgs e)
        {
            if (e.VerticalChange != 0 || e.HorizontalChange != 0 || e.ExtentHeightChange != 0 || e.ExtentWidthChange != 0)
                Scrolling = true;
        }

        protected override void Dispose(bool disposing)
        {
            base.Dispose(disposing);

            if (disposing)
                PresentationSource.RemoveSourceChangedHandler(this, SourceChangedEventHandler);
        }

        private void SourceChangedEventHandler(Object sender, SourceChangedEventArgs e)
        {
            ParentScrollViewer = FindParentScrollViewer();
        }

        private ScrollViewer FindParentScrollViewer()
        {
            DependencyObject vParent = this;
            ScrollViewer parentScroll = null;
            while (vParent != null)
            {
                parentScroll = vParent as ScrollViewer;
                if (parentScroll != null)
                    break;

                vParent = LogicalTreeHelper.GetParent(vParent);
            }
            return parentScroll;
        }

        private void SetRegion(int x1, int y1, int x2, int y2)
        {
            SetWindowRgn(Handle, CreateRectRgn(x1, y1, x2, y2), true);
        }

        private Visual RootVisual
        {
            get
            {
                _presentationSource = PresentationSource.FromVisual(this);
                return _presentationSource.RootVisual;
            }
        }

        private ScrollViewer ParentScrollViewer { get; set; }

        private bool Scrolling { get; set; }
        private bool Resizing { get; set; }

        [DllImport("User32.dll", SetLastError = true)]
        static extern int SetWindowRgn(IntPtr hWnd, IntPtr hRgn, bool bRedraw);

        [DllImport("gdi32.dll")]
        static extern IntPtr CreateRectRgn(int nLeftRect, int nTopRect, int nRightRect, int nBottomRect);
    } 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-04-14T15:17:01.407

Just add in ScrollViewer control property:

```
VerticalScrollBarVisibility="Auto" 
```

and set Height to Your max height. That's all.

# c# - 用于 ASP.NET MVC 的没有 DI 容器的控制器的构造函数参数

> ID：122273
> 
> 赞同：9
> 
> 时间：2008-09-23T16:54:14.353
> 
> 标签：c#, .net, asp.net-mvc

有没有人有任何代码示例说明如何创建具有除使用依赖注入容器以外的参数的控制器？

我看到很多使用诸如 StructureMap 之类的容器的示例，但如果您想自己传递依赖类，则什么也没有。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-24T12:46:03.737

一种方法是创建 ControllerFactory：

```
public class MyControllerFactory : DefaultControllerFactory
{
    public override IController CreateController(
        RequestContext requestContext, string controllerName)
    {
        return [construct your controller here] ;
    }
} 
```

然后，在 Global.asax.cs 中：

```
 private void Application_Start(object sender, EventArgs e)
    {
        RegisterRoutes(RouteTable.Routes);
        ControllerBuilder.Current.SetControllerFactory(
            new MyNamespace.MyControllerFactory());
    } 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-23T17:10:11.473

你可以使用穷人的依赖注入：

```
public ProductController() : this( new Foo() )
{
  //the framework calls this
}

public ProductController(IFoo foo)
{
  _foo = foo;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T20:47:48.457

您可以创建一个 IModelBinder 从工厂启动实例 - 或者，是的，容器。=)

# unix - 快速检查sudo权限是否可用

> ID：122276
> 
> 赞同：3
> 
> 时间：2008-09-23T16:55:16.300
> 
> 标签：unix, sudo

我希望能够快速检查我是否都有 sudo 访问权限并且我的密码已经过身份验证。我不担心专门为我将要执行的操作拥有 sudo 访问权限，但这将是一个不错的奖励。

具体来说，我试图将其用于一个脚本，我希望该脚本可由一系列用户运行。有些有 sudo 访问权限。都知道root密码。

当他们运行我的脚本时，如果可能的话，我希望它使用 sudo 权限而不提示输入密码，否则回退到询问*root*密码（因为他们可能没有 sudo 访问权限）。

我的第一次非工作尝试是在关闭`sudo -S true`STDIN 或从 /dev/null 读取的情况下分叉。但这仍然提示输入密码并等待几秒钟。

我尝试了其他几件事，包括等待 0.3 秒以查看它是否立即成功，但我尝试的一切最终都在某些情况下失败。（并不是因为我的超时时间太短。）很难弄清楚发生了什么，因为我不能像往常一样只是 strace。

我*知道*不起作用的一件事是在运行之前关闭 STDIN 或将其附加到管道上`sudo -S true`。我希望这会使密码提示立即失败，但它仍然提示并且行为奇怪。我认为它可能需要一个终端。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2014-03-10T21:00:40.607

使用较新版本的[`sudo`](http://www.sudo.ws/sudo/sudo.man.html)有一个用于此目的的选项：

```
sudo -n true 
```

我`true`在这里使用无操作，但您可以使用任何命令。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T16:59:56.600

我不知道需要这样做的最终原因是什么，但我认为也许你可能需要重新考虑核心原因是什么。尝试使用权限执行复杂、不寻常的事情经常会导致安全漏洞。

更具体地说，无论脚本试图做什么，使用 setuid 而不是 sudo 可能会更好。（我还想知道为什么这么多人拥有 root 密码。Sudo 专门用来避免给人们提供 root 密码。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-04T22:31:03.087

跑步

```
sudo -S true < /dev/null &>/dev/null 
```

似乎有效，尽管它在失败前延迟了一秒钟。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-23T17:05:19.863

```
getent group admin | grep $particular_user 
```

您可以使用 whoami 来获取当前用户。

编辑：但这并不能帮助您确定您是否仍然有权执行 sudo 任务...嗯..

# python - 你如何将这个正则表达式习语从 Perl 翻译成 Python？

> ID：122277
> 
> 赞同：48
> 
> 时间：2008-09-23T16:55:18.670
> 
> 标签：python, regex, perl

大约一年前我从 Perl 切换到 Python 并且没有回头。我发现只有*一个习语在 Perl 中比在 Python 中更容易做到：*

```
if ($var =~ /foo(.+)/) {
  # do something with $1
} elsif ($var =~ /bar(.+)/) {
  # do something with $1
} elsif ($var =~ /baz(.+)/) {
  # do something with $1
} 
```

相应的 Python 代码并不那么优雅，因为 if 语句不断嵌套：

```
m = re.search(r'foo(.+)', var)
if m:
  # do something with m.group(1)
else:
  m = re.search(r'bar(.+)', var)
  if m:
    # do something with m.group(1)
  else:
    m = re.search(r'baz(.+)', var)
    if m:
      # do something with m.group(2) 
```

有没有人有一种优雅的方式在 Python 中重现这种模式？我见过使用匿名函数调度表，但对于少数正则表达式，这些表对我来说似乎有点笨拙......

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-23T16:58:53.810

使用命名组和调度表：

```
r = re.compile(r'(?P<cmd>foo|bar|baz)(?P<data>.+)')

def do_foo(data):
    ...

def do_bar(data):
    ...

def do_baz(data):
    ...

dispatch = {
    'foo': do_foo,
    'bar': do_bar,
    'baz': do_baz,
}

m = r.match(var)
if m:
    dispatch[m.group('cmd')](m.group('data')) 
```

通过一点内省，您可以自动生成正则表达式和调度表。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-23T19:04:53.617

是的，这有点烦人。也许这对您的情况有用。

```
 import re

class ReCheck(object):
    def __init__(self):
        self.result = None
    def check(self, pattern, text):
        self.result = re.search(pattern, text)
        return self.result

var = 'bar stuff'
m = ReCheck()
if m.check(r'foo(.+)',var):
    print m.result.group(1)
elif m.check(r'bar(.+)',var):
    print m.result.group(1)
elif m.check(r'baz(.+)',var):
    print m.result.group(1) 
```

**编辑：**布赖恩正确地指出我的第一次尝试没有奏效。不幸的是，这种尝试更长。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-25T20:10:55.407

```
r"""
This is an extension of the re module. It stores the last successful
match object and lets you access it's methods and attributes via
this module.

This module exports the following additional functions:
    expand  Return the string obtained by doing backslash substitution on a
            template string.
    group   Returns one or more subgroups of the match.
    groups  Return a tuple containing all the subgroups of the match.
    start   Return the indices of the start of the substring matched by
            group.
    end     Return the indices of the end of the substring matched by group.
    span    Returns a 2-tuple of (start(), end()) of the substring matched
            by group.

This module defines the following additional public attributes:
    pos         The value of pos which was passed to the search() or match()
                method.
    endpos      The value of endpos which was passed to the search() or
                match() method.
    lastindex   The integer index of the last matched capturing group.
    lastgroup   The name of the last matched capturing group.
    re          The regular expression object which as passed to search() or
                match().
    string      The string passed to match() or search().
"""

import re as re_

from re import *
from functools import wraps

__all__ = re_.__all__ + [ "expand", "group", "groups", "start", "end", "span",
        "last_match", "pos", "endpos", "lastindex", "lastgroup", "re", "string" ]

last_match = pos = endpos = lastindex = lastgroup = re = string = None

def _set_match(match=None):
    global last_match, pos, endpos, lastindex, lastgroup, re, string
    if match is not None:
        last_match = match
        pos = match.pos
        endpos = match.endpos
        lastindex = match.lastindex
        lastgroup = match.lastgroup
        re = match.re
        string = match.string
    return match

@wraps(re_.match)
def match(pattern, string, flags=0):
    return _set_match(re_.match(pattern, string, flags))

@wraps(re_.search)
def search(pattern, string, flags=0):
    return _set_match(re_.search(pattern, string, flags))

@wraps(re_.findall)
def findall(pattern, string, flags=0):
    matches = re_.findall(pattern, string, flags)
    if matches:
        _set_match(matches[-1])
    return matches

@wraps(re_.finditer)
def finditer(pattern, string, flags=0):
    for match in re_.finditer(pattern, string, flags):
        yield _set_match(match)

def expand(template):
    if last_match is None:
        raise TypeError, "No successful match yet."
    return last_match.expand(template)

def group(*indices):
    if last_match is None:
        raise TypeError, "No successful match yet."
    return last_match.group(*indices)

def groups(default=None):
    if last_match is None:
        raise TypeError, "No successful match yet."
    return last_match.groups(default)

def groupdict(default=None):
    if last_match is None:
        raise TypeError, "No successful match yet."
    return last_match.groupdict(default)

def start(group=0):
    if last_match is None:
        raise TypeError, "No successful match yet."
    return last_match.start(group)

def end(group=0):
    if last_match is None:
        raise TypeError, "No successful match yet."
    return last_match.end(group)

def span(group=0):
    if last_match is None:
        raise TypeError, "No successful match yet."
    return last_match.span(group)

del wraps  # Not needed past module compilation 
```

例如：

```
if gre.match("foo(.+)", var):
  # do something with gre.group(1)
elif gre.match("bar(.+)", var):
  # do something with gre.group(1)
elif gre.match("baz(.+)", var):
  # do something with gre.group(1) 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-23T21:50:45.607

我建议这样做，因为它使用最少的正则表达式来实现您的目标。它仍然是函数式代码，但并不比你的旧 Perl 差。

```
import re
var = "barbazfoo"

m = re.search(r'(foo|bar|baz)(.+)', var)
if m.group(1) == 'foo':
    print m.group(1)
    # do something with m.group(1)
elif m.group(1) == "bar":
    print m.group(1)
    # do something with m.group(1)
elif m.group(1) == "baz":
    print m.group(2)
    # do something with m.group(2) 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2019-04-28T06:06:16.713

开始`Python 3.8`，并引入[赋值表达式（PEP 572）](https://www.python.org/dev/peps/pep-0572/)（`:=`运算符），我们现在可以捕获`re.search(pattern, text)`变量`match`中的条件值，以便检查它是否不是`None`，然后在条件主体中重新使用它：

```
if match := re.search(r'foo(.+)', text):
  # do something with match.group(1)
elif match := re.search(r'bar(.+)', text):
  # do something with match.group(1)
elif match := re.search(r'baz(.+)', text)
  # do something with match.group(1) 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-11-27T01:05:41.953

多亏了[这个其他的问题](https://stackoverflow.com/questions/1663995/python-variable-assignment-and-if-statement)：

```
import re

class DataHolder:
    def __init__(self, value=None, attr_name='value'):
        self._attr_name = attr_name
        self.set(value)
    def __call__(self, value):
        return self.set(value)
    def set(self, value):
        setattr(self, self._attr_name, value)
        return value
    def get(self):
        return getattr(self, self._attr_name)

string = u'test bar 123'
save_match = DataHolder(attr_name='match')
if save_match(re.search('foo (\d+)', string)):
    print "Foo"
    print save_match.match.group(1)
elif save_match(re.search('bar (\d+)', string)):
    print "Bar"
    print save_match.match.group(1)
elif save_match(re.search('baz (\d+)', string)):
    print "Baz"
    print save_match.match.group(1) 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-23T17:07:16.863

或者，根本不使用正则表达式的东西：

```
prefix, data = var[:3], var[3:]
if prefix == 'foo':
    # do something with data
elif prefix == 'bar':
    # do something with data
elif prefix == 'baz':
    # do something with data
else:
    # do something with var 
```

这是否合适取决于您的实际问题。不要忘记，正则表达式并不是 Perl 中的瑞士军刀。Python 有不同的结构来进行字符串操作。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-23T17:11:09.070

```
def find_first_match(string, *regexes):
    for regex, handler in regexes:
        m = re.search(regex, string):
        if m:
            handler(m)
            return
    else:
        raise ValueError

find_first_match(
    foo, 
    (r'foo(.+)', handle_foo), 
    (r'bar(.+)', handle_bar), 
    (r'baz(.+)', handle_baz)) 
```

为了加快速度，可以在内部将所有正则表达式转换为一个并动态创建调度程序。理想情况下，这将变成一个类。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-01-07T14:42:19.283

这是我解决这个问题的方法：

```
matched = False;

m = re.match("regex1");
if not matched and m:
    #do something
    matched = True;

m = re.match("regex2");
if not matched and m:
    #do something else
    matched = True;

m = re.match("regex3");
if not matched and m:
    #do yet something else
    matched = True; 
```

不像原来的图案那么干净。但是，它简单、直接，不需要额外的模块或更改原始的正则表达式。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-11-16T15:33:00.777

用字典怎么样？

```
match_objects = {}

if match_objects.setdefault( 'mo_foo', re_foo.search( text ) ):
  # do something with match_objects[ 'mo_foo' ]

elif match_objects.setdefault( 'mo_bar', re_bar.search( text ) ):
  # do something with match_objects[ 'mo_bar' ]

elif match_objects.setdefault( 'mo_baz', re_baz.search( text ) ):
  # do something with match_objects[ 'mo_baz' ]

... 
```

但是，您必须确保没有重复的 match_objects 字典键 ( mo_foo, mo_bar, ... )，最好为每个正则表达式赋予其自己的名称并相应地命名 match_objects 键，否则 match_objects.setdefault() 方法将返回现有的匹配对象而不是通过运行 re_xxx.search(text) 创建新的匹配对象。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-08-09T11:11:22.797

稍微扩展一下 Pat Notz 的解决方案，我发现它更加优雅：
  - 将方法命名为与提供的相同`re`（例如`search()`vs. `check()`）和
  - 实现必要的方法，例如`group()`在持有者对象本身上：

```
class Re(object):
    def __init__(self):
        self.result = None

    def search(self, pattern, text):
        self.result = re.search(pattern, text)
        return self.result

    def group(self, index):
        return self.result.group(index) 
```

* * *

### 例子

而不是例如这个：

```
m = re.search(r'set ([^ ]+) to ([^ ]+)', line)
if m:
    vars[m.group(1)] = m.group(2)
else:
    m = re.search(r'print ([^ ]+)', line)
    if m:
        print(vars[m.group(1)])
    else:
        m = re.search(r'add ([^ ]+) to ([^ ]+)', line)
        if m:
            vars[m.group(2)] += vars[m.group(1)] 
```

一个人这样做：

```
m = Re()
...
if m.search(r'set ([^ ]+) to ([^ ]+)', line):
    vars[m.group(1)] = m.group(2)
elif m.search(r'print ([^ ]+)', line):
    print(vars[m.group(1)])
elif m.search(r'add ([^ ]+) to ([^ ]+)', line):
    vars[m.group(2)] += vars[m.group(1)] 
```

最后看起来很自然，从 Perl 迁移时不需要太多的代码更改，并且像其他一些解决方案一样避免了全局状态的问题。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-06-30T00:58:52.463

一个极简的DataHolder：

```
class Holder(object):
    def __call__(self, *x):
        if x:
            self.x = x[0]
        return self.x

data = Holder()

if data(re.search('foo (\d+)', string)):
    print data().group(1) 
```

或作为单例函数：

```
def data(*x):
    if x:
        data.x = x[0]
    return data.x 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-06-12T09:33:08.220

我的解决方案是：

```
import re

class Found(Exception): pass

try:        
    for m in re.finditer('bar(.+)', var):
        # Do something
        raise Found

    for m in re.finditer('foo(.+)', var):
        # Do something else
        raise Found

except Found: pass 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-08-21T13:30:32.557

这是一个 RegexDispatcher 类，它通过正则表达式调度其子类方法。

每个可调度的方法都使用正则表达式进行注释，例如

```
def plus(self, regex: r"\+", **kwargs):
... 
```

在这种情况下，注释称为“正则表达式”，其值是要匹配的正则表达式，“\+”，即+号。这些带注释的方法放在子类中，而不是在基类中。

当对字符串调用 dispatch(...) 方法时，该类会找到带有与字符串匹配的注释正则表达式的方法并调用它。这是课程：

```
import inspect
import re

class RegexMethod:
    def __init__(self, method, annotation):
        self.method = method
        self.name = self.method.__name__
        self.order = inspect.getsourcelines(self.method)[1] # The line in the source file
        self.regex = self.method.__annotations__[annotation]

    def match(self, s):
        return re.match(self.regex, s)

    # Make it callable
    def __call__(self, *args, **kwargs):
        return self.method(*args, **kwargs)

    def __str__(self):
        return str.format("Line: %s, method name: %s, regex: %s" % (self.order, self.name, self.regex))

class RegexDispatcher:
    def __init__(self, annotation="regex"):
        self.annotation = annotation
        # Collect all the methods that have an annotation that matches self.annotation
        # For example, methods that have the annotation "regex", which is the default
        self.dispatchMethods = [RegexMethod(m[1], self.annotation) for m in
                                inspect.getmembers(self, predicate=inspect.ismethod) if
                                (self.annotation in m[1].__annotations__)]
        # Be sure to process the dispatch methods in the order they appear in the class!
        # This is because the order in which you test regexes is important.
        # The most specific patterns must always be tested BEFORE more general ones
        # otherwise they will never match.
        self.dispatchMethods.sort(key=lambda m: m.order)

    # Finds the FIRST match of s against a RegexMethod in dispatchMethods, calls the RegexMethod and returns
    def dispatch(self, s, **kwargs):
        for m in self.dispatchMethods:
            if m.match(s):
                return m(self.annotation, **kwargs)
        return None 
```

要使用此类，请将其子类化以创建带有注释方法的类。例如，这里是一个简单的 RPNCalculator，它继承自 RegexDispatcher。要分派的方法（当然）是带有“正则表达式”注释的方法。父 dispatch() 方法在 call 中**调用**。

```
from RegexDispatcher import *
import math

class RPNCalculator(RegexDispatcher):
    def __init__(self):
        RegexDispatcher.__init__(self)
        self.stack = []

    def __str__(self):
        return str(self.stack)

    # Make RPNCalculator objects callable
    def __call__(self, expression):
        # Calculate the value of expression
        for t in expression.split():
            self.dispatch(t, token=t)
        return self.top()  # return the top of the stack

    # Stack management
    def top(self):
        return self.stack[-1] if len(self.stack) > 0 else []

    def push(self, x):
        return self.stack.append(float(x))

    def pop(self, n=1):
        return self.stack.pop() if n == 1 else [self.stack.pop() for n in range(n)]

    # Handle numbers
    def number(self, regex: r"[-+]?[0-9]*\.?[0-9]+(?:[eE][-+]?[0-9]+)?", **kwargs):
        self.stack.append(float(kwargs['token']))

    # Binary operators
    def plus(self, regex: r"\+", **kwargs):
        a, b = self.pop(2)
        self.push(b + a)

    def minus(self, regex: r"\-", **kwargs):
        a, b = self.pop(2)
        self.push(b - a)

    def multiply(self, regex: r"\*", **kwargs):
        a, b = self.pop(2)
        self.push(b * a)

    def divide(self, regex: r"\/", **kwargs):
        a, b = self.pop(2)
        self.push(b / a)

    def pow(self, regex: r"exp", **kwargs):
        a, b = self.pop(2)
        self.push(a ** b)

    def logN(self, regex: r"logN", **kwargs):
        a, b = self.pop(2)
        self.push(math.log(a,b))

    # Unary operators
    def neg(self, regex: r"neg", **kwargs):
        self.push(-self.pop())

    def sqrt(self, regex: r"sqrt", **kwargs):
        self.push(math.sqrt(self.pop()))

    def log2(self, regex: r"log2", **kwargs):
        self.push(math.log2(self.pop()))

    def log10(self, regex: r"log10", **kwargs):
        self.push(math.log10(self.pop()))

    def pi(self, regex: r"pi", **kwargs):
        self.push(math.pi)

    def e(self, regex: r"e", **kwargs):
        self.push(math.e)

    def deg(self, regex: r"deg", **kwargs):
        self.push(math.degrees(self.pop()))

    def rad(self, regex: r"rad", **kwargs):
        self.push(math.radians(self.pop()))

    # Whole stack operators
    def cls(self, regex: r"c", **kwargs):
        self.stack=[]

    def sum(self, regex: r"sum", **kwargs):
        self.stack=[math.fsum(self.stack)]

if __name__ == '__main__':
    calc = RPNCalculator()

    print(calc('2 2 exp 3 + neg'))

    print(calc('c 1 2 3 4 5 sum 2 * 2 / pi'))

    print(calc('pi 2 * deg'))

    print(calc('2 2 logN')) 
```

我喜欢这个解决方案，因为没有单独的查找表。要匹配的正则表达式嵌入在要作为注释调用的方法中。对我来说，这是应该的。如果 Python 允许更灵活的注解会更好，因为我宁愿将正则表达式注解放在方法本身上，而不是将其嵌入到方法参数列表中。但是，目前这是不可能的。

感兴趣的可以看看 Wolfram 语言，其中函数在任意模式上是多态的，而不仅仅是在参数类型上。正则表达式上的多态函数是一个非常强大的想法，但我们无法在 Python 中干净利落地实现这一点。RegexDispatcher 类是我能做的最好的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-01-17T14:27:05.110

```
import re

s = '1.23 Million equals to 1230000'

s = re.sub("([\d.]+)(\s*)Million", lambda m: str(round(float(m.groups()[0]) * 1000_000))+m.groups()[1], s)

print(s) 
```

* * *

1230000 等于 1230000

# visual-studio-2008 - Silverlight 开发 [Visual Studio 2008 与 Expression Blend]

> ID：122278
> 
> 赞同：2
> 
> 时间：2008-09-23T16:55:31.383
> 
> 标签：visual-studio-2008, silverlight, expression-blend

我是一名 .Net 开发人员，希望开始开发 Silverlight 应用程序。我有 VS 2008 但想知道我是否应该/需要表达混合。与边 VS 混合的优点/缺点是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T16:57:38.853

我并不是要提出自己的问题，但这可能会对您有所帮助，尤其是如果您不熟悉 Expression Studio 或 Expression Blend：“ [Microsoft Expression Studio 到底是什么以及它如何与 Visual Studio 集成？](https://stackoverflow.com/questions/28826/what-exactly-is-microsoft-expression-studio-and-how-does-it-integrate-with-visu) ”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T18:27:59.120

主要优点是它是 Silverlight 的 XAML 的视觉设计表面。目前，VS for Silverlight 中的视觉设计界面是只读的。我总是将 Blend 描述为图形 XAML 编辑器。它非常强大，可以帮助您理解 XAML、轻松创建可能需要的动画、模板控件、定位应用程序元素等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T00:58:58.727

如果您打算做最少的 XAML 工作，那么免费且出色的工具 KaXAML 将为您提供帮助。在这里深入了解[http://www.kaxaml.com/](http://www.kaxaml.com/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T17:28:44.847

Blend对于设计非常有用，它的控制视觉状态编辑的新功能非常有用。但是，它生成的 XAML 可能比自定义编写的更难维护。

就个人而言，每当我需要生成某种视觉效果时，我都会使用 blend ，然后将 XAML 复制到实际的解决方案中，但是在理想的环境中，您应该向设计人员提供在 VS 中生成的原始 XAML，并且他应该对其进行编辑与混合。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T20:57:27.480

您将需要混合来制作动画原型、制作模板、更改颜色。我不是每天都使用它，一旦你放入一个 valueconverter，它就会使该元素无法渲染。

为了用 Blend 做任何事情，我在 Blend 中创建了一个新项目，模拟我想要的东西并剪掉 xaml。所以我很少使用它。

不过你不需要它。获取 6 月预览版或从 MSDN 获取，但不要去购买它。如果您获得预览，您可以使用它来学习动画和 xaml。在您使用 xaml 足够多之后，转到 xaml 并且不使用任何工具会更快。

设计师使用 Adob​​e 产品和 Mac……所以您唯一需要的就是转换器。

# java - Java File 方法“canWrite()”能否支持锁定？

> ID：122282
> 
> 赞同：12
> 
> 时间：2008-09-23T16:56:24.080
> 
> 标签：java, xml, file-io

我有一个 Java 应用程序，它监视传入 XML 文件的文件夹。当检测到新文件时，我需要测试该文件当前未更新并已关闭。我的想法是使用[File.canWrite()](http://java.sun.com/j2se/1.5.0/docs/api/java/io/File.html#canWrite())来测试它。这样做有什么问题吗？这是测试文件是否已完全写入的好方法吗？

我抛出的其他想法是：

*   解析传入的 XML 文件并测试结束标记是否存在。
*   检查 EoF 字符。

我只是不确定这些方法中的任何一种都可以处理所有情况。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-23T17:04:14.267

不，canWrite 不适合此目的。通常，即使另一个进程正在写入，该文件也是可写的。

您需要更高级别的协议来协调锁定。如果您计划在单个平台上使用此代码，您可以使用[NIO 的 FileLock 设施](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/channels/FileLock.html)。但请仔细阅读文档，并注意在许多平台上，锁只是建议性的。

另一种方法是让一个进程使用您的进程无法识别的名称写入文件，然后在写入完成后将文件重命名为可识别的名称。在大多数平台上，如果源和目标是相同的文件系统卷，则重命名操作是原子操作。名称更改可能使用不同的文件扩展名，甚至将文件从一个目录移动到另一个目录（在同一卷上）。

由于在这种情况下您只使用 XML，因此寻找关闭标记会起作用，但它并非万无一失——如果在最终标记之后有注释，或者作者或根本没有编写有效的 XML，该怎么办？

寻找 EOF 是*行不通*的。总会有一个 EOF，即使作者刚刚打开文件并且还没有写任何东西。如果不是这样，最简单的方法是让读者在文件出现后立即开始解析；它只会阻塞，直到作者关闭文件。但是文件系统不能这样工作。每个文件都有一个结束，即使某个进程当前正在移动它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T17:13:15.787

此外，如果您先进行检查，然后再进行写入，那么您就会遇到竞争条件。状态可能会在检查和写入之间发生变化。有时最好尝试做你想做的事情并优雅地处理错误。可能是具有增加的回退延迟时间的 n 次尝试重试机制。

或者重新定义你的测试。在这种情况下，您也许可以在处理文件之前测试文件大小在一段时间内没有改变。

另一种选择是将代码分成两部分，你可以有另一个线程——也许是一个石英任务——负责将完成的文件移动到你的主代码处理的不同目录中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-30T13:47:44.377

在 Windows 中似乎可以工作的一件事是 - 创建一个表示相关文件的 File() 对象（使用具有完整文件名的构造函数） - 以相同的方式创建第二个相同的文件对象。- 尝试 firstFile.renameTo(secondFile)

这个虚拟重命名练习似乎成功地处理了未打开以供另一个应用程序编辑的文件（我用 Word 测试过），但如果它们打开则失败。

并且作为 nw 文件名 = 旧文件名，它不会创建任何其他工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T17:04:15.607

据我所知，没有办法判断另一个进程当前是否具有来自 Java 的文件的打开句柄。一种选择是使用来自 new io的[FileLock类。](http://java.sun.com/j2se/1.4.2/docs/api/java/nio/channels/FileLock.html)并非所有平台都支持此功能，但如果文件是本地文件并且写入文件的进程配合，则这应该适用于任何支持锁的平台。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T17:52:13.713

如果您同时控制读取器和写入器，那么潜在的锁定技术将是创建一个锁定**目录**（通常是原子操作）以用于读取和写入过程持续时间。如果您采用这种方法，您必须管理导致“挂起”锁定目录的进程的潜在故障。

正如 Cheekysoft 提到的，文件不是原子的，不适合锁定。

如果您不控制编写器（例如，如果它是由 FTP 守护程序生成的），那么重命名技术或时间跨度延迟技术是您的最佳选择。

# database - 如何在 CouchDB 中安排索引更新

> ID：122298
> 
> 赞同：18
> 
> 时间：2008-09-23T16:59:35.227
> 
> 标签：database, couchdb, scaling

据我了解，查询视图时会更新 CouchDB 索引。假设读比写多，这对扩展不是很不利吗？我将如何配置 CouchDB 以按计划更新写入索引，或者更好的是？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-23T17:25:20.517

CouchDB 确实会在更新时重新生成视图，但仅针对自上次读取视图后发生的更改。假设您的读取量大大超过您的写入量，这应该不是问题。

当您一次更改大量文档时，这可能会导致第一次读取请求花费大量时间。为了减轻这种情况，已经提出了几种不同的可能性。大多数依赖于注册 CouchDB 的更新通知并自动触发读取。

CouchDB wiki [1] 上提供了一个示例脚本，用于执行此操作。

[1] [http://wiki.apache.org/couchdb/RegeneratingViewsOnUpdate](http://wiki.apache.org/couchdb/RegeneratingViewsOnUpdate)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-23T17:27:35.253

a）“缩放”是一个超载的术语。您指的是什么“类型”的缩放？（不管怎样，我看不出它对你有什么负面影响）。

b) 写入更新：只需在写入后查询您的视图。请注意，将一堆数据添加到索引中对资源更友好（并非特定于 CouchDB）。因此，您可能希望每 N 次写入触发您的视图。

c) 预定：设置每 M 分钟查询一次视图的 cronjob。

d) 等待 CouchDB 发展为您提供允许您使用配置参数进行设置的基础架构。

e) （最佳选择）。弄脏你的手，帮助我们完善 CouchDB！任何贡献都受到高度赞赏。

d) [RTFM (*闪烁*:)](http://wiki.apache.org/couchdb/FrequentlyAskedQuestions#update_views_more_often)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-23T17:25:42.467

你不能而且，你为什么要那样？

这样想：

*   当您将数据导入 MySQL 时，您可以关闭 indizes，因为为插入的每一行更新索引比在一次运行中更新 100 次写入（或无论您导入多少行）的索引更昂贵。
*   这就是 CouchDB 在读取时更新索引的原因，因为同时集成这 100 个更改的成本更低，然后在写入时每次更改。

这是 CouchDB 的优势之一！:) 我并不是说这是 CouchDB 独有的功能，但在阅读时这样做很聪明。

您可以做的一件事是使用 update=false 进行读取，这是一种脏读，可能不会返回您期望的结果。如果您总是这样做，您可以安排通过 cronjob 进行“定期”读取并用它来更新您的索引。我只是不认为这是有道理的。

# version-control - 在命令行上进行 cvs 更新时，如何获得 cvs 冲突的摘要？

> ID：122301
> 
> 赞同：3
> 
> 时间：2008-09-23T16:59:58.770
> 
> 标签：version-control, command-line, merge, cvs, conflict

运行后是否有一种简单的方法来获取冲突摘要`cvs update`？

我在一个大型项目上工作，在做了一些工作之后，我需要进行更新。从 cvs update 命令返回的更改列表有几页长，我只想看到在 cvs update 命令输出末尾重复的冲突列表（以“C”开头）。

该解决方案需要从命令行工作。

如果我的正常输出是：

```
M src/file1.txt
M src/file2.txt
cvs server: conflicts found ...
C src/file3.txt
M src/file4.txt
M src/file5.txt 
```

我希望我的新输出是：

```
M src/file1.txt
M src/file2.txt
cvs server: conflicts found ...
C src/file3.txt
M src/file4.txt
M src/file5.txt

Conflict Summary:
C src/file3.txt 
```

我希望这是一个单一的命令（可能是一个简短的脚本或别名），它在发生时输出正常的 cvs 输出，然后是冲突摘要。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T02:00:55.323

鉴于规范，您似乎需要对 Martin York 的解决方案稍作修改（因为它只显示冲突而不是正常的日志信息）。像这样的东西 - 可能被称为“cvsupd”：

```
tmp=${TMPDIR:-/tmp}/cvsupd.$$
trap "rm -f $tmp; exit 1" 0 1 2 3 13 15
cvs update "$@" | tee $tmp
if grep -s '^C' $tmp
then
    echo
    echo Conflict Summary:
    grep '^C' $tmp
fi
rm -f $tmp
trap 0
exit 0 
```

陷阱命令确保不会留下日志文件。它捕获正常信号 - HUP、INT、QUIT、PIPE 和 TERM（分别）并且 0 捕获外壳的任何其他退出。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T17:06:48.907

我手边没有 cvs cvs update 输出的确切格式是什么

我似乎记得 C <filename>
如果是这样，您可以使用：

> 简历更新 | 三通日志 | grep "^C"

cvs 的完整输出保存到日志中以供其他时间使用。然后我们 grep 查找所有以 'C'**开头的行**

希望有帮助。

# sql - 作为Sqlplus中的系统，我如何查询另一个用户的表？

> ID：122302
> 
> 赞同：5
> 
> 时间：2008-09-23T17:00:09.750
> 
> 标签：sql, oracle, sqlplus, ora-00942

根据从 system_privilege_map 中选择名称系统已被授予：

```
SELECT ANY TABLE 
```

...以及许多其他 * 任何表格。

平淡无奇

```
select * from the_table;
select * from the_table; 
```

...网给定的响应：

> 第 1 行出现错误：ORA-00942：表或视图不存在

我可以以该用户身份登录并运行相同的命令。

我假设我应该能够针对一般用户的数据库表运行查询（在本例中为选择）。我的假设是否正确，如果是，我该怎么做？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-24T13:33:38.743

正如前面的回复所说，您可以在对象名称前加上模式名称：

```
SELECT * FROM schema_name.the_table; 
```

或者您可以使用同义词（私有或公共）：

```
CREATE (PUBLIC) SYNONYM the_table FOR schema_name.the_table; 
```

或者，您可以发出 alter session 命令将默认模式设置为您想要的模式：

```
ALTER SESSION SET current_schema=schema_name; 
```

请注意，这只是设置默认模式，相当于在所有（非限定）对象名称前加上`schema_name`. 您仍然可以使用不同的模式名称为对象添加前缀，以从另一个模式访问对象。使用`SET current_schema`不会影响您的权限：您仍然拥有登录用户的权限，而不是您设置的架构。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-23T17:01:33.337

如果 the_table 归用户“some_user”所有，则：

```
select * from some_user.the_table; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T17:01:40.573

你需要做：

```
SELECT * FROM schema_name.the_table; 
```

或者使用同义词...

```
CREATE SYNONYM the_table FOR schema_name.the_table; 
```

# svn - 您如何在 Subversion 下包含/排除某种类型的文件？

> ID：122313
> 
> 赞同：48
> 
> 时间：2008-09-23T17:02:57.437
> 
> 标签：svn, version-control

我对包含/排除行话感到困惑，而我实际的 SVN 客户端似乎没有（或者我一直无法轻松找到）添加或删除特定类型文件以进行版本控制的简单选项.

例如，假设我添加了整个 Visual Studio 文件夹及其解决方案、项目、调试文件等，但我只想对实际的源文件进行版本控制。最简单的方法是什么？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-09-23T17:06:32.293

您可能最安全地排除特定文件类型，而不是选择您想要包含的文件类型，因为您可以添加一个新类型而不会意识到它没有被版本化。

在每个目录的基础上，您可以编辑[svn:ignore](http://svnbook.red-bean.com/en/1.1/ch07s02.html#svn-ch-7-sect-2.3.3)属性。

跑

```
svn propedit svn:ignore . 
```

为每个相关目录调出一个编辑器，其中包含要忽略的模式列表。

然后在每一行上放置一个与您要忽略的文件类型相对应的模式：

```
*.user
*.exe
*.dll 
```

你有什么。

或者，正如建议的那样，您可以将这些模式添加到`global-ignores`~/.subversion/config 文件中的属性中（或`"%APPDATA%\Subversion\config"`在 Windows 上 - 请参阅[红豆书中的配置区域布局以获取更多信息](http://svnbook.red-bean.com/en/1.1/ch07.html#svn-ch-7-sect-1.1)）。在这种情况下，用空格分隔模式。这是我的。`#`在该行的开头引入了注释。我忽略了 Ankh .Load 文件和所有 *.resharper.user 文件：

```
### Set global-ignores to a set of whitespace-delimited globs
### which Subversion will ignore in its 'status' output, and
### while importing or adding files and directories.
# global-ignores = *.o *.lo *.la #*# .*.rej *.rej .*~ *~ .#* .DS_Store
global-ignores = Ankh.Load *.resharper.user 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T17:05:25.323

这可以使用[svn:ignore](http://svnbook.red-bean.com/en/1.1/ch07s02.html#svn-ch-7-sect-2.3.3)属性或`~/.subversion/config`文件中的 global-ignores 属性来实现。（滚动到第一个链接的顶部以查看有关编辑属性的说明。）

通过在目录上使用`svn propset`or `svn propedit`，您将能够使 Subversion 忽略特定目录中与该模式匹配的所有文件。但是，如果您在`~/.subversion/config`'s`[miscellany]`部分更改 global-ignores，Subversion 将忽略这些文件，无论它们位于何处。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T17:07:08.313

请参阅博客文章*[svn:ignore](http://athenageek.wordpress.com/2008/04/16/svnignore/)*。

我知道使用 TortoiseSVN 可以单击已签出的根文件夹，并可以通过选择“属性”菜单项添加任意属性。在这种情况下，您只需指定要排除的文件模式。

命令行内容的博客文章，但我确信它可以与您使用的任何客户端一起正常工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T17:05:05.200

在最低级别，SVN 允许您使用[svn:ignore](http://www.petefreitag.com/item/662.cfm)属性忽略某些文件或模式。用于 SVN 的 VS 插件（例如[VisualSVN](http://www.visualsvn.com/) ）将自动代表您忽略这些文件。如果您使用的是[TortoiseSVN](http://tortoisesvn.tigris.org/)，您可以在资源管理器中右键单击文件和文件夹，然后选择*Add to Ignore List*。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T17:05:37.913

使用该`svn:ignore`属性，您可以使用通配符。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-09-19T18:28:59.460

另一种方式，当使用 TortoiseSVN 时，您可以选择“提交...”，然后右键单击文件并移动到更改列表“忽略提交”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-02-04T13:41:28.447

如果您使用 Eclipse（我使用 Spring Tool Suite）：

```
Preferences > Team > Ignored Resources 
```

单击`Add Pattern`，写入**.DS_Store**（或其他）并保存。这会在您的工作区全局执行。

# c++ - 模板约束 C++

> ID：122316
> 
> 赞同：79
> 
> 时间：2008-09-23T17:03:14.050
> 
> 标签：c++, templates, constraints

在 C# 中，我们可以定义一个泛型类型，它对可用作泛型参数的类型施加约束。以下示例说明了通用约束的用法：

```
interface IFoo
{
}

class Foo<T> where T : IFoo
{
}

class Bar : IFoo
{
}

class Simpson
{
}

class Program
{
    static void Main(string[] args)
    {
        Foo<Bar> a = new Foo<Bar>();
        Foo<Simpson> b = new Foo<Simpson>(); // error CS0309
    }
} 
```

有没有一种方法可以在 C++ 中对模板参数施加约束。

* * *

C++0x 对此有本机支持，但我说的是当前的标准 C++。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2014-04-08T11:00:21.493

如果你使用 C++11，你可以使用`static_assert`with`std::is_base_of`来达到这个目的。

例如，

```
#include <type_traits>

template<typename T>
class YourClass {

    YourClass() {
        // Compile-time check
        static_assert(std::is_base_of<BaseClass, T>::value, "type parameter of this class must derive from BaseClass");

        // ...
    }
} 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-09-23T17:15:53.987

“隐式”是正确答案。由于它们的编译方式，模板有效地创建了“鸭子打字”场景。您可以在模板类型的值上调用您想要的任何函数，并且唯一将被接受的实例是为其定义了该方法的实例。例如：

```
template <class T>
int compute_length(T *value)
{
    return value->length();
} 
```

我们可以在指向任何声明该方法的类型的指针上调用此方法`length()`以返回一个`int`. 因此：

```
string s = "test";
vector<int> vec;
int i = 0;

compute_length(&s);
compute_length(&vec); 
```

...但不是指向*未*声明的类型的指针`length()`：

```
compute_length(&i); 
```

这第三个示例将无法编译。

这是因为 C++ 为每个实例化编译模板化函数（或类）的新版本。当它执行该编译时，它会在类型检查之前将模板实例化直接、几乎类似于宏的替换到代码中。如果一切仍然适用于该模板，则编译继续进行，我们最终会得到结果。如果有任何事情失败（比如`int*`没有声明`length()`），那么我们会得到可怕的六页模板编译时错误。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2008-09-23T17:12:18.210

正如其他人所提到的，C++0x 正在将其内置到语言中。在那之前，我会推荐[Bjarne Stroustrup](http://en.wikipedia.org/wiki/Bjarne_Stroustrup)[关于模板约束](http://www.stroustrup.com/bs_faq2.html#constraints)的建议。

编辑：[Boost](http://boost.org)也有[自己的替代方案](http://www.boost.org/doc/libs/1_36_0/libs/concept_check/concept_check.htm)。

Edit2：看起来[概念已从 C++0x 中删除](http://www.informit.com/guides/content.aspx?g=cplusplus&seqNum=441)。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-09-23T17:19:55.913

您可以在 IFoo 上放置一个不执行任何操作的保护类型，确保它在 Foo 中的 T 上：

```
class IFoo
{
public:
    typedef int IsDerivedFromIFoo;
};

template <typename T>
class Foo<T>
{
    typedef typename T::IsDerivedFromIFoo IFooGuard;
} 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-23T17:08:13.257

查看[升压](http://www.boost.org/doc/libs/1_36_0/libs/concept_check/concept_check.htm)

> Boost 概念检查库 (BCCL)
> 
> [概念检查库允许以提议的 C++ 语言扩展](http://www.generic-programming.org/languages/conceptcpp/specification/)的风格添加显式声明和[概念](http://www.boost.org/more/generic_programming.html#concept)检查。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T17:09:18.700

有点。如果您将 static_cast 转换为 IFoo*，则无法实例化模板，除非调用者传递一个可以分配给 IFoo * 的类。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T12:03:58.163

你能行的。创建基础模板。使其只有 Private 构造函数。然后为您想要允许的每种情况创建专业化（或者如果不允许的列表远小于允许的列表，则进行相反的处理）。

编译器将不允许您实例化使用带有私有构造函数的版本的模板。

此示例仅允许使用 int 和 float 进行实例化。

```
template<class t> class FOO { private: FOO(){}};

template<> class FOO<int>{public: FOO(){}};

template<> class FOO<float>{public: FOO(){}}; 
```

它不是一种简短而优雅的方式，但它是可能的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T17:07:24.397

只是隐含的。
您在实际调用的方法中使用的任何方法都被强加在模板参数上。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2022-02-13T12:41:29.493

使用 C++20，是的，有：[约束和概念](https://en.cppreference.com/w/cpp/language/constraints)

也许你想保证一个模板是从一个特定的类派生的：

```
#include <concepts>

template<class T, class U>
concept Derived = std::is_base_of<U, T>::value;

class ABase { };
class ADerived : ABase { };

template<Derived<ABase> T>
class AClass {
    T aMemberDerivedFromABase;
}; 
```

然后像往常一样编译以下内容：

```
int main () {
    AClass<ADerived> aClass;
    return 0;
} 
```

但是现在当你做一些违背约束的事情时：

```
class AnotherClass {

};
int main () {
    AClass<AnotherClass> aClass;
    return 0;
} 
```

AnotherClass 不是从 ABase 派生的，因此我的编译器 (GCC) 大致给出以下错误：

> 在函数'int main()'中：注意：不满足约束注意：表达式'std::is_base_of<U, T>::value [with U = ABase; T = AnotherClass]' 评估为'假' 9 | 概念派生 = std::is_base_of<U, T>::value;

正如您可以想象的那样，此功能非常有用，并且可以做的不仅仅是将类限制为具有特定的基础。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-12-04T18:33:55.683

查看 CRTP 模式（Curiously Recursive Template Pattern）。它旨在帮助支持静态继承。

# c# - 为什么 VB.NET 9 没有像 C# 3 这样的自动属性？

> ID：122324
> 
> 赞同：11
> 
> 时间：2008-09-23T17:04:22.737
> 
> 标签：c#, vb.net, properties, language-features

是否有一个不错的小功能可以更快地编写像自动属性这样的代码非常适合 VB.NET 的口头禅？

像这样的东西会很完美：

```
Public Property FirstName() As String
    Get
    Set
End Property 
```

**更新：** VB.NET 10（与 Visual Studio 2010 和 .NET 4.0 一起提供）将具有自动属性。这是一个显示有关该功能的一些信息的链接：http: [//geekswithblogs.net/DarrenFieldhouse/archive/2008/12/01/new-features-in-vb.net-10-.net-4.0.aspx](http://geekswithblogs.net/DarrenFieldhouse/archive/2008/12/01/new-features-in-vb.net-10-.net-4.0.aspx)

在 VB.NET 10 中，自动属性的定义如下：

```
Public Property CustomerID As Integer 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T17:19:39.597

许多功能在 VB 中被延迟的原因之一是开发结构与 C# 有很大不同，此外，通常更多地考虑细节。[正如保罗维克](http://www.panopticoncentral.net/archive/2008/03/27/23050.aspx)关于此事的帖子所暗示的那样，在这种情况下似乎也是如此。这是不幸的，因为它在许多情况下意味着延迟（自动属性、迭代器方法、多行 lambda，仅举几例），但另一方面，从长远来看，VB 开发人员通常会获得更成熟的功能（查看讨论，这对于迭代器方法尤其如此）。

所以，长话短说：VB 10 将（希望！）看到自动属性。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T20:35:30.773

这在 vb.net 中也没有那么大的痛点，因为 Visual Studio 会自动为您创建 90% 的属性骨架代码，而使用 C# 时您必须全部输入。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T17:15:20.620

如果您想更快地完成属性，请尝试代码片段。类型：属性，然后在键入“y”后，按 Tab 键 :-)。

我意识到这并没有回答特定的问题，但确实为您提供了 VB 团队提供的内容......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-05T09:32:17.523

我知道这篇文章很旧，所以你可能已经知道了，但是 VB 在下一版本的 VS 中获得了自动属性。

基于对[反馈](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=354620&wa=wsignin1.0)和[Channel9](http://channel9.msdn.com/posts/Dan/Lucian-Wischik-and-Lisa-Feigenbaum-Whats-new-in-Visual-Basic-10/)的响应。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T17:06:56.070

C# 和 VB.NET 在它们的第一个版本中并没有完全符合新特性。通常，到下一个版本 C# 会赶上一些 VB.NET 功能，反之亦然。我有点喜欢来自 VB.NET 的文字 XML，并希望他们将其添加到 C#。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T17:15:21.557

真的没有什么特别的原因。即使 VB.NET 和 C# 被吹捧为同样强大（公平地说，它们确实如此），它们的语法和某些结构有时也会有所不同，这种情况总是*如此*。你有两个不同的开发团队在开发这些语言，所以这是你可以期待的。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2010-03-27T20:05:13.320

vb 中不需要自动属性，使用自动属性做出的让步是您不能修改 Get 和 Set。

如果您不需要这些，只需创建一个公共数据字段。

VB 多年来一直具有自动属性。他们只是叫他们别的东西。

# python - 如何找到我的 Python 站点包目录的位置？

> ID：122327
> 
> 赞同：1207
> 
> 时间：2008-09-23T17:04:43.937
> 
> 标签：python, installation

如何找到我的站点包目录的位置？

* * *

## 回答 #1

> 赞同：837
> 
> 时间：2017-09-06T09:24:00.913

有两种类型的站点包目录，*全局*和*每个用户*。

1.  **运行时会列出**全局**站点包（“ [dist-packages](https://stackoverflow.com/questions/9387928/whats-the-difference-between-dist-packages-and-site-packages)`sys.path` ”）目录：**

     **```
    python -m site 
    ```

    `getsitepackages`要从Python 代码中的[站点模块](https://docs.python.org/3/library/site.html#site.getsitepackages)运行更简洁的列表：

    ```
    python -c 'import site; print(site.getsitepackages())' 
    ```

    *注意：*使用 virtualenvs [getsitepackages is not available](https://github.com/pypa/virtualenv/issues/228)，尽管如此，`sys.path`上面将正确列出 virtualenv 的 site-packages 目录。在 Python 3 中，您可以改用[sysconfig 模块](https://docs.python.org/3/library/sysconfig.html#using-sysconfig-as-a-script)：

    ```
    python3 -c 'import sysconfig; print(sysconfig.get_paths()["purelib"])' 
    ```** 
***   每个**用户**的站点包目录（[PEP 370](https://www.python.org/dev/peps/pep-0370/)）是 Python 安装本地包的位置：

    ```
    python -m site --user-site 
    ```

    如果这指向一个不存在的目录，请检查 Python 的退出状态并查看`python -m site --help`解释。

    *提示：*运行`pip list --user`或`pip freeze --user`为您提供*每个用户*安装的所有站点包的列表。** 

 *** * *

## 实用技巧

*   `<package>.__path__`让您识别特定包裹的位置：（[详细信息](https://stackoverflow.com/questions/2699287/what-is-path-useful-for)）

    ```
    $ python -c "import setuptools as _; print(_.__path__)"
    ['/usr/lib/python2.7/dist-packages/setuptools'] 
    ```

*   `<module>.__file__`让您识别特定模块的位置：（[差异](https://softwareengineering.stackexchange.com/questions/111871/module-vs-package)）

    ```
    $ python3 -c "import os as _; print(_.__file__)"
    /usr/lib/python3.6/os.py 
    ```

*   运行`pip show <package>`以显示 Debian 风格的软件包信息：

    ```
    $ pip show pytest
    Name: pytest
    Version: 3.8.2
    Summary: pytest: simple powerful testing with Python
    Home-page: https://docs.pytest.org/en/latest/
    Author: Holger Krekel, Bruno Oliveira, Ronny Pfannschmidt, Floris Bruynooghe, Brianna Laugher, Florian Bruhin and others
    Author-email: None
    License: MIT license
    Location: /home/peter/.local/lib/python3.4/site-packages
    Requires: more-itertools, atomicwrites, setuptools, attrs, pathlib2, six, py, pluggy 
    ```

* * *

## 回答 #2

> 赞同：687
> 
> 时间：2012-10-18T08:19:45.187

```
>>> import site; site.getsitepackages()
['/usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages'] 
```

（或只是第一个项目`site.getsitepackages()[0]`）

* * *

## 回答 #3

> 赞同：351
> 
> 时间：2008-09-23T17:06:59.080

一个解决方案：

*   在 virtualenv 之外 - 提供**全局**站点包的路径，
*   insidue a virtualenv - 提供**virtualenv 的**站点包

...这是单行：

```
python -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())" 
```

为可读性而格式化（而不是用作单行），如下所示：

```
from distutils.sysconfig import get_python_lib
print(get_python_lib()) 
```

*资料来源：*[“如何安装 Django”文档](http://web.archive.org/web/20100723105725/http://docs.djangoproject.com/en/1.2/topics/install#removing-old-versions-of-django)的一个非常旧的版本（尽管这不仅对 Django 安装有用）

* * *

## 回答 #4

> 赞同：106
> 
> 时间：2011-01-06T03:08:09.357

*对于 Ubuntu*，

```
python -c "from distutils.sysconfig import get_python_lib; print get_python_lib()" 
```

...是不正确的。

它会指向你`/usr/lib/pythonX.X/dist-packages`

此文件夹仅包含您的操作系统为运行程序而自动安装的软件包。

*在 ubuntu*上，包含通过 setup_tools\easy_install\pip 安装的包的 site-packages 文件夹将位于`/usr/local/lib/pythonX.X/dist-packages`

如果用例与安装或阅读源代码有关，第二个文件夹可能更有用。

如果您不使用 Ubuntu，您可能可以安全地将第一个代码框复制粘贴到终端中。

* * *

## 回答 #5

> 赞同：75
> 
> 时间：2012-05-22T00:08:55.807

这对我有用：

```
python -m site --user-site 
```

* * *

## 回答 #6

> 赞同：43
> 
> 时间：2018-10-04T04:11:48.300

现代标准库方法是使用[`sysconfig`](https://docs.python.org/3/library/sysconfig.html)模块，在 2.7 和 3.2+ 版本中可用。**与当前接受的答案不同，无论您是否激活了虚拟环境，此方法仍然有效。**

*注意*：（[source](https://github.com/python/cpython/blob/master/Lib/sysconfig.py) ）不要与此处其他几个答案中提到的子模块（`sysconfig`source [）](https://github.com/python/cpython/blob/master/Lib/distutils/sysconfig.py)混淆。后者是一个完全不同的模块，它缺少下面讨论的功能。`distutils.sysconfig``get_paths`

Python 当前使用*八个*路径（[docs](https://docs.python.org/3/library/sysconfig.html#installation-paths)）：

> *   *stdlib*：包含非平台特定的标准 Python 库文件的目录。
> *   *platstdlib*：包含特定于平台的标准 Python 库文件的目录。
> *   *platlib*：特定于站点、特定于平台的文件的目录。
> *   *purelib*：特定于站点的、非特定于平台的文件的目录。
> *   *include* : 非平台特定头文件的目录。
> *   *platinclude*：特定于平台的头文件的目录。
> *   *scripts*：脚本文件的目录。
> *   *data*：数据文件的目录。

在大多数情况下，发现此问题的用户会对“purelib”路径感兴趣（在[某些情况下](https://stackoverflow.com/a/122387/674039)，您可能也对“platlib”感兴趣）。purelib 路径是普通 Python 包将通过[`pip`](https://pip.pypa.io/en/stable/).

在系统级别，您会看到如下内容：

```
# Linux
$ python3 -c "import sysconfig; print(sysconfig.get_path('purelib'))"
/usr/local/lib/python3.8/site-packages

# macOS (brew installed python3.8)
$ python3 -c "import sysconfig; print(sysconfig.get_path('purelib'))"
/usr/local/Cellar/python@3.8/3.8.3/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages

# Windows
C:\> py -c "import sysconfig; print(sysconfig.get_path('purelib'))"
C:\Users\wim\AppData\Local\Programs\Python\Python38\Lib\site-packages 
```

使用 venv，你会得到这样的东西

```
# Linux
/tmp/.venv/lib/python3.8/site-packages

# macOS
/private/tmp/.venv/lib/python3.8/site-packages

# Windows
C:\Users\wim\AppData\Local\Temp\.venv\Lib\site-packages 
```

该函数[`sysconfig.get_paths()`](https://docs.python.org/3/library/sysconfig.html#sysconfig.get_paths)返回所有相关安装路径的字典，Linux 上的示例：

```
>>> import sysconfig
>>> sysconfig.get_paths()
{'stdlib': '/usr/local/lib/python3.8',
 'platstdlib': '/usr/local/lib/python3.8',
 'purelib': '/usr/local/lib/python3.8/site-packages',
 'platlib': '/usr/local/lib/python3.8/site-packages',
 'include': '/usr/local/include/python3.8',
 'platinclude': '/usr/local/include/python3.8',
 'scripts': '/usr/local/bin',
 'data': '/usr/local'} 
```

还可以使用 shell 脚本来显示这些详细信息，您可以通过`sysconfig`作为模块执行来调用它：

```
python -m sysconfig 
```

* * *

## 回答 #7

> 赞同：34
> 
> 时间：2011-02-23T18:32:10.357

假设您已经安装了包“django”。导入它并输入 dir(django)。它将向您展示该模块的所有功能和属性。输入python解释器 -

```
>>> import django
>>> dir(django)
['VERSION', '__builtins__', '__doc__', '__file__', '__name__', '__package__', '__path__', 'get_version']
>>> print django.__path__
['/Library/Python/2.6/site-packages/django'] 
```

如果你安装了 mercurial，你可以做同样的事情。

这是给雪豹的。但我认为它通常也应该起作用。

* * *

## 回答 #8

> 赞同：25
> 
> 时间：2008-09-23T17:14:02.557

正如其他人所指出`distutils.sysconfig`的，具有相关设置：

```
import distutils.sysconfig
print distutils.sysconfig.get_python_lib() 
```

...虽然默认值`site.py`做了一些更粗略的事情，解释如下：

```
import sys, os
print os.sep.join([sys.prefix, 'lib', 'python' + sys.version[:3], 'site-packages']) 
```

（如果常数不同，它也会添加`${sys.prefix}/lib/site-python`和添加两条路径`sys.exec_prefix`）。

也就是说，上下文是什么？你不应该`site-packages`直接搞乱你的；setuptools/distutils 将用于安装，并且您的程序可能在 virtualenv 中运行，您的 pythonpath 完全是用户本地的，因此它也不应该直接使用系统站点包。

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2013-08-08T16:05:17.297

在基于 Debian 的系统中使用 python 安装安装的本机系统包可以在以下位置找到：

> /usr/lib/python2.7/dist-packages/

在 OSX -`/Library/Python/2.7/site-packages`

通过使用这个小代码：

```
from distutils.sysconfig import get_python_lib
print get_python_lib() 
```

`pip`但是，可以在以下位置找到通过安装的软件包列表：

> /usr/local/bin/

或者可以简单地编写以下命令来列出 python 包所在的所有路径。

```
>>> import site; site.getsitepackages()
['/usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages'] 
```

*注意：位置可能因您的操作系统而异，例如在 OSX 中*

```
>>> import site; site.getsitepackages()
['/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages', '/System/Library/Frameworks/Python.framework/Versions/2.7/lib/site-python', '/Library/Python/2.7/site-packages'] 
```

* * *

## 回答 #10

> 赞同：18
> 
> 时间：2019-01-03T09:59:11.173

pip show 将提供有关软件包的所有详细信息： [https](https://pip.pypa.io/en/stable/reference/pip_show/) ://pip.pypa.io/en/stable/reference/pip_show/ [pip show][1]

要获取位置：

```
pip show <package_name>| grep Location 
```

在 Linux 中，您可以通过以下方式转到 site-packages 文件夹：

```
cd $(python -c "import site; print(site.getsitepackages()[0])") 
```

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2009-11-10T22:49:28.780

附注：建议的解决方案 ( `distutils.sysconfig.get_python_lib()`) 在有多个站点包目录时不起作用（如[本文所推荐的那样](http://pythonsimple.noucleus.net/python-install/python-site-packages-what-they-are-and-where-to-put-them)）。它只会返回主站点包目录。

唉，我也没有更好的解决方案。Python 似乎不跟踪站点包目录，只跟踪其中的包。

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2012-02-06T02:40:22.307

所有答案（或：一遍又一遍地重复相同的答案）都是不充分的。你想要做的是：

```
from setuptools.command.easy_install import easy_install
class easy_install_default(easy_install):
  """ class easy_install had problems with the fist parameter not being
      an instance of Distribution, even though it was. This is due to
      some import-related mess.
      """

  def __init__(self):
    from distutils.dist import Distribution
    dist = Distribution()
    self.distribution = dist
    self.initialize_options()
    self._dry_run = None
    self.verbose = dist.verbose
    self.force = None
    self.help = 0
    self.finalized = 0

e = easy_install_default()
import distutils.errors
try:
  e.finalize_options()
except distutils.errors.DistutilsError:
  pass

print e.install_dir 
```

最后一行显示安装目录。可以在 Ubuntu 上运行，而上面的则不行。不要问我有关 windows 或其他 dist 的问题，但由于它与 easy_install 默认使用的目录完全相同，因此它可能在 easy_install 工作的任何地方都是正确的（所以，在任何地方，甚至是 mac）。玩得开心。注意：原始代码中有很多脏话。

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2012-03-30T16:01:24.873

这对我有用。它将为您提供 dist-packages 和 site-packages 文件夹。如果该文件夹不在 Python 的路径上，那么无论如何它都不会对您有多大好处。

```
import sys; 
print [f for f in sys.path if f.endswith('packages')] 
```

输出（Ubuntu 安装）：

```
['/home/username/.local/lib/python2.7/site-packages',
 '/usr/local/lib/python2.7/dist-packages',
 '/usr/lib/python2.7/dist-packages'] 
```

* * *

## 回答 #14

> 赞同：13
> 
> 时间：2015-03-15T15:43:40.320

由于其“低技术”性质，这应该适用于进出虚拟环境的所有发行版。os 模块始终位于“site-packages”的父目录中

```
import os; print(os.path.dirname(os.__file__) + '/site-packages') 
```

要将 dir 更改为 site-packages 目录，我使用以下别名（在 *nix 系统上）：

```
alias cdsp='cd $(python -c "import os; print(os.path.dirname(os.__file__))"); cd site-packages' 
```

* * *

## 回答 #15

> 赞同：12
> 
> 时间：2008-09-23T17:16:22.833

对已经提到的功能的附加说明`get_python_lib`：在某些平台上，不同的目录用于特定于平台的模块（例如：需要编译的模块）。如果您传递`plat_specific=True`给该函数，您将获得平台特定包的站点包。

* * *

## 回答 #16

> 赞同：10
> 
> 时间：2008-09-23T17:09:54.563

```
from distutils.sysconfig import get_python_lib
print get_python_lib() 
```

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2019-05-06T19:15:12.200

您应该尝试使用此命令来确定 pip 的安装位置

蟒蛇2

```
pip show six | grep "Location:" | cut -d " " -f2 
```

蟒蛇**3**

```
pip3 show six | grep "Location:" | cut -d " " -f2 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2016-07-18T09:12:47.957

回答老问题。但是为此使用 ipython。

```
pip install ipython
ipython 
import imaplib
imaplib? 
```

这将给出关于 imaplib 包的以下输出 -

```
Type:        module
String form: <module 'imaplib' from '/usr/lib/python2.7/imaplib.py'>
File:        /usr/lib/python2.7/imaplib.py
Docstring:  
IMAP4 client.

Based on RFC 2060.

Public class:           IMAP4
Public variable:        Debug
Public functions:       Internaldate2tuple
                        Int2AP
                        ParseFlags
                        Time2Internaldate 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2020-11-19T18:33:42.673

对于那些使用[诗歌](https://python-poetry.org/)的人，您可以通过以下方式找到您的虚拟环境路径`poetry debug`：

```
$ poetry debug

Poetry
Version: 1.1.4
Python:  3.8.2

Virtualenv
Python:         3.8.2
Implementation: CPython
Path:           /Users/cglacet/.pyenv/versions/3.8.2/envs/my-virtualenv
Valid:          True

System
Platform: darwin
OS:       posix
Python:   /Users/cglacet/.pyenv/versions/3.8.2 
```

使用此信息，您可以列出站点包：

```
ls /Users/cglacet/.pyenv/versions/3.8.2/envs/my-virtualenv/lib/python3.8/site-packages/ 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2021-07-18T07:15:15.723

# 我做了一个非常简单的函数来完成工作

```
import site

def get_site_packages_dir():
        return [p for p  in site.getsitepackages()
                if p.endswith(("site-packages", "dist-packages"))][0]

get_site_packages_dir()
# '/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages' 
```

# 如果要使用终端检索结果：

```
python3 -c "import site;print([p for p in site.getsitepackages() if p.endswith(('site-packages', 'dist-packages')) ][0])"

/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2017-12-16T09:49:25.617

我必须为我正在处理的项目做一些稍微不同的事情：找到相对于基本安装前缀的*相对*站点包目录。如果 site-packages 文件夹位于 中`/usr/lib/python2.7/site-packages`，我想要该`/lib/python2.7/site-packages`部分。事实上，我遇到了`site-packages`in的系统`/usr/lib64`，并且接受的答案在这些系统上不起作用。

与作弊者的回答类似，我的解决方案深入 Distutils 的内部，以找到实际在内部传递的路径`setup.py`。弄清楚我不想让任何人再次弄清楚这一点真是太痛苦了。

```
import sys
import os
from distutils.command.install import INSTALL_SCHEMES

if os.name == 'nt':
    scheme_key = 'nt'
else:
    scheme_key = 'unix_prefix'

print(INSTALL_SCHEMES[scheme_key]['purelib'].replace('$py_version_short', (str.split(sys.version))[0][0:3]).replace('$base', '')) 
```

那应该打印类似`/Lib/site-packages`or的东西`/lib/python3.6/site-packages`。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-09-16T15:42:56.223

一些我认为有用的没有提到的东西，如果你安装了两个版本的 Python，例如 3.8 和 3.5，你的机器上可能有两个名为 site-packages 的文件夹。在这种情况下，您可以使用以下命令指定 python 版本：

```
py -3.5 -c "import site; print(site.getsitepackages()[1]) 
```

# latex - 缩小图像，但不能在乳胶中放大

> ID：122348
> 
> 赞同：17
> 
> 时间：2008-09-23T17:07:31.667
> 
> 标签：latex

我有一个包含 includegraphics 命令的命令 - 我可以将图像传递给我的命令，它会在实际包含图像之前为我做一些标准格式。我通过此命令包含的一些图像小于 \textwidth，而有些则更大。我想将较大的图像缩小到 \textwidth，而不是将较小的图像放大 - 这意味着我不能这样做

```
\includegraphics[width=\textwidth]{img} 
```

有没有办法指定最大宽度？或者，我可以以某种方式获得图像的宽度，以便我可以做类似的事情

```
\ifthenelse{\imagewidth > \textwidth}{%
    \includegraphics[width=\textwidth]{img}}{%
    \includegraphics{img}} 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-23T19:20:58.213

要获取图像的宽度，您可以使用以下代码：

```
\newlength{\imgwidth}
\settowidth{\imgwidth}{\includegraphics{img}} 
```

您可以在文档序言中使用它来创建一个新命令来自动设置宽度：

```
\usepackage{graphicx}
\usepackage{calc}

\newlength{\imgwidth}

\newcommand\scalegraphics[1]{%   
    \settowidth{\imgwidth}{\includegraphics{#1}}%
    \setlength{\imgwidth}{\minof{\imgwidth}{\textwidth}}%
    \includegraphics[width=\imgwidth]{#1}%
} 
```

然后，在您的文档中：

```
\scalegraphics{img} 
```

我希望这有帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-20T15:33:26.207

我喜欢一个附加参数，可以选择缩小或放大图像，所以我的 \scalegraphics 版本如下所示：

```
\newcommand\scalegraphics[2][]{%
    \settowidth{\imgwidth}{\includegraphics{#2}}%
    \setlength{\imgwidth}{\minof{#1\imgwidth}{\textwidth}}%
    \includegraphics[width=\imgwidth]{#2}%
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-28T14:54:12.703

该[`adjustbox`](http://get-software.net/macros/latex/contrib/adjustbox/adjustbox.pdf)软件包对此很有用。您将在下面找到一个简短的示例。它允许以下操作（除了修剪、剪裁、添加边距和相对缩放：

```
\documentclass[a4paper]{article}

\usepackage[demo]{graphicx}
\usepackage[export]{adjustbox}

\begin{document}

\adjustbox{max width=\linewidth}{\includegraphics[width=.5\linewidth,height=3cm]{}}

\adjustbox{max width=\linewidth}{\includegraphics[width=2\linewidth,height=3cm]{}}

\includegraphics[width=2\linewidth,height=3cm,max width=\linewidth]{}
\end{document} 
```

如果您使用`export`package 选项，它的大部分密钥都可以直接与`\includegraphics`. 例如与您相关的密钥，`max width`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-05T10:31:51.073

如果您要约束的不是图像而是独立`.tex`文件，则可以将 ChrisN 稍微修改`\scalegraphics`为

```
\newlength{\inputwidth}
\newcommand\maxwidthinput[2][\linewidth]{%   
    \settowidth{\inputwidth}{#2}%
    \setlength{\inputwidth}{\minof{\inputwidth}{#1}}%
    \resizebox{\inputwidth}{!}{#2}
} 
```

然后像这样使用它

```
\maxwidthinput{\input{standalone}}
\maxwidthinput[0.5\textwidth]{\input{standalone}} 
```

当然，`adjustbox`正如 ted 所建议的那样：

```
\usepackage{adjustbox}
...
\adjustbox{max width=\linewidth}{\input{standalone}} 
```

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2008-09-23T18:02:21.677

在通过 CTAN 手册和谷歌搜索结果几分钟后，我想我可以有把握地说，你想做的事情要么是不可能的，要么是非常困难的。我唯一的建议是你有两个命令，一个用于小图像，一个用于大图像，或者一个带有选项的命令。

可能有办法，但我把它留给其他 SO LaTeX 向导来提供更好的答案。

编辑：我错了，见上文。

# asp.net - 如何创建 ASP.NET 复选框列表的数组或列表

> ID：122359
> 
> 赞同：3
> 
> 时间：2008-09-23T17:09:50.850
> 
> 标签：asp.net, user-interface

我知道如何使用 ASP.NET 中的复选框列表来显示从数据库中检索到的选项。我不知道该怎么做是制作这个二维的。也就是说，我需要一个复选框列表列表，我不知道列表有多长；复选框列表的两个维度将由

人员列表（从数据库中提取） 任务列表（从数据库中提取）

并且网页的用户将在列/行中单击以指定哪些人将被分配哪些任务。

现在我在想我唯一的选择是通过创建一个表格并用自己的复选框填充每个单元格来强制它。（恶心）

有没有更优雅的方法来创建带有行和列标签的二维复选框数组？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T17:12:28.940

我会使用中继器和复选框列表。根据您的数据库的设置方式，您可以将每个复选框列表数据绑定。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T19:07:05.717

If you're looking for a quick and dirty way, you can use the AJAX Control Toolkit with the two controls and can populate one based on the other. If that's not what you're looking for, I'd do it the brute force way.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T17:12:34.153

我以前做过这个，并采用了你建议的蛮力方法。

它没有你想的那么恶心。其他声明性和数据绑定的解决方案可能同样令人费解和困惑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T17:12:55.070

您可以通过编程方式使用**GridView**控件。它本质上是二维的，您可以为此使用数据绑定**CheckBoxField**。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T17:20:53.290

我使用 DevExpress 的 ASPxGridView。它有一个 Selected （或类似的）控制列类型，它将在列中显示一个复选框，另一列从您的绑定数据源填充。用户可以通过选中行上的复选框来选择所需的任何行，您可以轻松地获取所有选定的行而不是要处理的集合。DevExpress 组件确实摆脱了很多蛮力编程。

# c# - 如何在 C# 中清空/刷新 Windows READ 磁盘缓存？

> ID：122362
> 
> 赞同：9
> 
> 时间：2008-09-23T17:10:40.740
> 
> 标签：c#, .net, caching, disk, flush

如果我试图确定驱动器的读取速度，我可以编写一个例程来将文件写入文件系统，然后将这些文件读回。不幸的是，这并不能提供准确的读取速度，因为 Windows 会进行磁盘读取缓存。

有没有办法在 C# / .Net 中刷新驱动器的磁盘读取缓存（或者可能使用 Win32 API 调用），以便我可以直接从驱动器读取文件而不缓存它们？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T17:30:10.920

康斯坦丁：谢谢！该链接有一个命令行 EXE，它执行我正在寻找的测试。

我还在该页面上找到了一个链接，指向该页面上更有趣的文章（Word 和 PDF）：[Sequential File Programming Patterns and Performance with .NET](http://research.microsoft.com/research/pubs/view.aspx?type=Technical%20Report&id=841)

在本文中，它讨论了无缓冲文件性能（iow，没有读/写缓存——只是原始磁盘性能。）

直接引用文章：

> 在 V2 .NET 框架中没有简单的方法来禁用 FileStream 缓冲。必须直接调用 Windows 文件系统以获取未缓冲的文件句柄，然后将结果“包装”在 FileStream 中，如下所示在 C# 中：

```
 [DllImport("kernel32", SetLastError=true)]
    static extern unsafe SafeFileHandle CreateFile(
        string FileName,           // file name
        uint DesiredAccess,        // access mode
        uint ShareMode,            // share mode
        IntPtr SecurityAttributes, // Security Attr
        uint CreationDisposition,  // how to create
        uint FlagsAndAttributes,   // file attributes
        SafeFileHandle  hTemplate // template file  
        );

    SafeFileHandle handle = CreateFile(FileName,
                            FileAccess.Read,
                            FileShare.None,
                            IntPtr.Zero,
                            FileMode.Open,
                             FILE_FLAG_NO_BUFFERING,
                            null);

    FileStream stream = new FileStream(handle, 
                    FileAccess.Read, 
                    true, 
                    4096); 
```

> 使用 FILE_FLAG_NO_BUFFERING 标志调用 CreateFile() 会告诉文件系统绕过文件的所有软件内存缓存。作为第三个参数传递给 FileStream 构造函数的 'true' 值表明流应该拥有文件句柄的所有权，这意味着当流关闭时文件句柄将自动关闭。在这个 hocus-pocus 之后，以与任何其他方式相同的方式读取和写入未缓冲的文件流。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-09-03T15:31:05.293

Fix 的响应几乎是正确的，并且比 PInvoke 更好。 **但是它有错误**并且不起作用......

要打开不带缓存的文件，需要执行以下操作：

```
const FileOptions FileFlagNoBuffering = (FileOptions)0x20000000;

FileStream file = new FileStream(fileName, fileMode, fileAccess, fileShare, blockSize,
    FileFlagNoBuffering | FileOptions.WriteThrough | fileOptions); 
```

* * *

几条规则：

1.  blockSize 必须与硬盘集群大小对齐（大多数情况下为 4096）
2.  文件位置更改必须与簇大小对齐
3.  您不能读取/写入小于 blockSize 或块未与其大小对齐

并且不要忘记 - 还有 HDD 缓存（它比 OS 缓存更慢且更小），您无法关闭它（但有时 FileOptions.WriteThrough 有助于不缓存写入）。使用这些选项，您没有理由刷新，但请确保您已经正确测试过这种方法不会减慢速度，以防您的缓存实现速度较慢。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T19:16:12.887

**为什么要DIY？**

如果您只需要确定驱动器速度并且对学习如何从 .NET 刷新 I/O 缓冲区并不真正感兴趣，您可以只使用[http://research.microsoft.com/barc/Sequential_IO/](http://research.microsoft.com/barc/Sequential_IO/)中的 DiskSpd 实用程序。它具有带和不带缓冲区刷新的随机/顺序模式。

该页面还包含一些您可能会发现有用的 I/O 相关研究报告。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-21T19:37:49.850

```
const int FILE_FLAG_NO_BUFFERING = 0x20000000;
return new FileStream(path, FileMode.Open, FileAccess.Read, FileShare.Read,64 * 1024,
(FileOptions)FILE_FLAG_NO_BUFFERING | FileOptions.Asynchronous
& FileOptions.SequentialScan); 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-23T17:17:36.090

我找到[了这篇](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3127219&SiteID=1)文章，这似乎是一个复杂的程序，因为您还必须刷新其他缓存。

# windows - 在 Vista 和 XP 中模拟 Control-Alt-Delete 键序列

> ID：122367
> 
> 赞同：5
> 
> 时间：2008-09-23T17:12:07.600
> 
> 标签：windows, winapi, windows-vista

我可以在 Vista 中模拟 C#/C ++ 代码++`Control`序列吗？何时启用/禁用 UAC？它是如何在 XP 中完成的？`Alt``Delete`

你能提供一个适用于 Vista 的代码示例吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-11T19:03:02.840

用于模拟安全注意序列 (SAS) 的现有代码（大多数人将其称为 control alt delete 或 ctrl-alt-del）在 Windows Vista 中不再有效。微软似乎提供了一个库来导出一个名为 SimulateSAS() 的函数。它不是公开的，应该通过向 saslib@microsoft.com 发送邮件来请求它。

有一个[类似的库](http://www.remkoweijnen.nl/blog/2009/03/30/sending-ctrl-alt-del-simulate-sas-in-windows-vista/)可用，具有以下功能：

*   使用和不使用用户帐户控制 (UAC) 均可
*   支持当前、控制台和任何终端服务器会话
*   不需要司机
*   调用应用程序不需要签名或具有特殊清单
*   支持多种编程语言

请注意，这个库不是免费的。同时，如果您对此感兴趣，可以联系[info@simulatesas.com 。](http://mailto:info@simulatesas.com)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-01-21T01:37:18.510

请使用以下信息，“saslib@microsoft.com”已被弃用，不太可能得到任何回复。以下信息就足够了。

从 Windows 7 操作系统和随附的软件开发工具包 (SDK) 的公共可用性开始，Vista 应用程序的 SAS 功能将只能通过 Windows SDK 提供。通过电子邮件对 SASLIB 包的发布支持，并且将停止使用 saslib。

有关如何下载平台 SDK 的信息，请访问以下链接的“Windows SDK for Windows 7 and .Net Framework 3.5 SP1”的 Microsoft 下载中心页面：http: [//www.microsoft.com/downloads/details .aspx?FamilyID=c17ba869-9671-4330-a63e-1fd44e0e2505&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=c17ba869-9671-4330-a63e-1fd44e0e2505&displaylang=en)。

安装此 SDK 后，您将在 redist 目录中找到可再发行的 sas.dll：

\Program Files\Microsoft SDKs\Windows\v7.0\redist\x86\sas.dll

\Program Files\Microsoft SDKs\Windows\v7.0\redist\amd64\sas.dll

\Program Files\Microsoft SDKs\Windows\v7.0\redist\ia64\sas.dll

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-31T08:07:44.177

我已将此网址添加为书签，希望对您有所帮助。 [http://softltd.wordpress.com/simulate-ctrl-alt-del-in-windows-vista-7-and-server-2008/](http://softltd.wordpress.com/simulate-ctrl-alt-del-in-windows-vista-7-and-server-2008/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T17:15:26.657

PostMessage(HWND_BROADCAST, WM_HOTKEY, 0, MAKELONG(MOD_ALT | MOD_CONTROL, VK_DELETE));

您从 user32 dll 获得 PostMessage

编辑：[包含代码的 CodeProject 文章](http://www.codeproject.com/KB/system/alt_control_delete.aspx?fid=14112&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2634100&fr=26)

编辑：[VNC 讨论](http://www.uvnc.com/vista/)了为什么这在 Vista 中不起作用以及如何设置 UAC 以允许它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-12-05T15:01:42.147

您只需从服务进程中调用下一个代码

```
HDESK desktop = OpenDesktopW(L"Winlogon", 0, TRUE,
    DESKTOP_CREATEMENU | DESKTOP_CREATEWINDOW | DESKTOP_ENUMERATE | 
    DESKTOP_HOOKCONTROL | DESKTOP_WRITEOBJECTS | DESKTOP_READOBJECTS |
    DESKTOP_SWITCHDESKTOP | GENERIC_WRITE);
int result = SetThreadDesktop(desktop);
if (result)
{
    HMODULE sasdll = LoadLibraryA("sas.dll");
    if (sasdll)
    {
        typedef void(__stdcall * SendSAS_t)(BOOL);
        SendSAS_t sendSAS = (SendSAS_t)GetProcAddress(sasdll, "SendSAS");
        if (sendSAS)
            sendSAS(FALSE);
    }
}
CloseDesktop(desktop); 
```

# winforms - 您将如何在 Windows 窗体应用程序中实现 MVC？

> ID：122388
> 
> 赞同：68
> 
> 时间：2008-09-23T17:16:24.813
> 
> 标签：winforms, model-view-controller

我没有开发太多桌面/Windows Forms 应用程序，但我想到使用 MVC（模型视图控制器）模式进行 Windows Forms .NET 开发可能会有一些好处。

有没有人在 Windows 窗体中实现 MVC？如果是这样，您对设计有什么建议吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-23T17:45:42.810

我过去所做的是使用类似的东西[Mo​​del-View-Presenter](http://download.microsoft.com/download/3/a/7/3a7fa450-1f33-41f7-9e6d-3aa95b5a6aea/MSDNMagazineAugust2006en-us.chm)。

[注意：这篇文章曾经可以在网络上找到。要立即查看，您需要下载 CHM，然后查看文件属性并单击取消阻止。然后您可以打开 CHM 并找到该文章。感谢一百万，微软！ *叹息*]

表单就是视图，我有一个 IView 接口。所有的处理都发生在 Presenter 中，它只是一个类。表单创建一个新的演示者，并将自己作为演示者的 IView 传递。通过这种方式进行测试，您可以改为传入一个假的 IView，然后从演示者向它发送命令并检测结果。

如果我要使用成熟的模型-视图-控制器，我想我会这样做：

*   形式就是**视图**。它向模型发送命令，引发控制器可以订阅的事件，并从模型订阅事件。
*   **控制器**是一个订阅视图事件并向视图和模型发送命令的类。
*   **模型**引发视图订阅的事件。

这符合[经典的 MVC 图](http://en.wikipedia.org/wiki/Model-view-controller)。最大的缺点是，对于事件，很难分辨谁在订阅什么。MVP 模式使用方法而不是事件（至少我实现它的方式）。当表单/视图引发事件（例如 someButton.Click）时，表单只需调用演示者上的方法来运行它的逻辑。视图和模型根本没有任何直接联系；他们都必须通过主持人。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-23T17:28:22.243

好吧，实际上 Windows 窗体实现了 MVC 的“自由风格”版本，就像一些电影实现了一些经典书籍的一些蹩脚的“自由风格”解释（我想到了罗密欧与朱丽叶）。

我并不是说 Windows 窗体的实现很糟糕，它只是......不同。

如果您使用 Windows 窗体和适当的 OOP 技术，并且可能使用像 EntitySpaces 这样的 ORM 来访问数据库，那么您可以这样说：

1.  ORM/OOP 基础设施是模型
2.  形式就是观点
3.  事件处理程序是控制器

尽管 View 和 Controller 都由同一个对象表示，使得从表示中分离代码变得更加困难（没有简单的方法可以在派生自 Microsoft.Windows.Forms.Form 的类中插入“GTK+ 视图”）。

如果你足够小心，你能做什么。通过仅在事件处理程序中编写与 GUI 相关的内容以及在单独的类中编写所有其他业务逻辑，使您的表单代码与控制器/模型代码*完全*分离。在这种情况下，如果您想使用 GTK+ 编写另一个视图层，您只需要重写 GUI 代码。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-23T17:32:13.807

Windows 窗体并非从一开始就设计为使用 MVC。你有两个选择。

首先，您可以推出自己的 MVC 实现。

其次，您可以使用为 Windows 窗体设计的 MVC 框架。

第一个很容易开始做，但你越深入，它就越复杂。我建议寻找一个良好的、预先存在且经过良好测试的 MVC 框架，旨在与 Windows 窗体一起使用。我相信[这篇博文](https://web.archive.org/web/20170306034615/http://rdn-consulting.com/blog/2008/02/01/selecting-a-mvcmvp-implementation-for-a-winforms-project/)是一个不错的起点。

对于刚开始的任何人，如果您可以选择，我建议跳过 Windows 窗体并针对 WPF 进行开发。这是一个更好的创建 UI 的框架。有许多 MVC 框架正在为 WPF 开发，包括[这个](https://web.archive.org/web/20150905201753/http://devlicio.us/blogs/rob_eisenberg/archive/2008/01/07/introducing-caliburn-an-mvc-mvp-wpf-framework.aspx)和[那个](http://www.codeplex.com/Wrails)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T23:06:03.880

据微软称，@jasonbunting 提到的 UIP 应用程序块已“存档”。相反，请查看[Smart Client Application Block](http://msdn.microsoft.com/en-us/library/aa480450.aspx)或更新的[Smart Client Software Factory](http://msdn.microsoft.com/en-us/library/aa480482.aspx)，它同时支持 WinForms 和 WPF SmartParts。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T17:30:42.703

检查[**用户界面进程 (UIP) 应用程序块**](http://msdn.microsoft.com/en-us/library/ms979213.aspx)。我对它了解不多，但几年前看过它。可能有更新的版本，请检查。

“UIP 应用程序块基于模型-视图-控制器 (MVC) 模式。”

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T19:39:05.143

查看 MS Patterns and Practices Smart Client 应用程序块，其中包含一些指导和类，可引导您在 Windows 窗体中实现模型视图演示者模式 - 查看包含的参考应用程序。

对于 WPF，这将被[prism](http://www.codeplex.com/CompositeWPF)项目取代

软件工厂方法是学习最佳实践的好方法

# networking - 路由器处理多个公共 IP 地址

> ID：122394
> 
> 赞同：7
> 
> 时间：2008-09-23T17:17:13.283
> 
> 标签：networking, routing, hardware, router

我目前正在从我的家庭网络运行几个网站和一个邮件服务器。我有一个带有 8 个公共 IP 地址的企业 DSL 帐户（1 个单独，7 个在一个块中）。为了处理路由/防火墙/网关，我目前使用 Windows 2003 中的 RRAS、DNS 和 DHCP，在一台古老的（大约 2001 年）PC 上运行——我怀疑现在任何时候都会失败。

我想做的是用一个简单的路由器代替它。有一个消费者型号的 LinkSys Wifi 路由器，我目前只是用作接入点（手边没有型号，但它是他们的标准型号之一）。它似乎能够处理所有 NAT/防火墙/DHCP 任务——除了处理路由多个公共地址。（例如，我需要 xxx123，端口 21 连接到一台机器，但是 xxx123 和 xxx124 的端口 80 连接到另一台机器，而 xxx123，端口 5000 连接到另一台机器等等）。

所以我的问题是：

*   这可以用标准的 Linksys 路由器来完成吗，他们只是在消费者手册中没有解释吗？*   可以做到这一点...如果我用社区/操作系统版本替换固件（如果是的话，是哪一个？）*   如果以上都不是，有人可以推荐一个专业的路由器（最好有wifi）可以做到这一点，接近消费者水平的价格点。*   或者，是否有可靠的 OS/3rd 方替代 RRAS 来处理这个问题（因为 RRAS 是造成最大麻烦的部分）*   Alternate-Alternately，有人可以指出一个非常简单的HOWTO来做到这一点（即按照这些步骤并忘记它），安装一个LINUX系统来做到这一点）（因为我假设我可以在旧机器上运行Linux更长时间） ?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T17:37:09.803

这不能在具有库存固件的 Linksys 路由器上完成。如果您加载第三方固件就可以完成，但是没有 GUI (afaik) 来完成它，所以您将破解非常麻烦的系统 shell 脚本。我建议购买低功耗或更旧的 PC 并安装[PFSense](http://www.pfsense.com/)。

PFSense 是一个开源路由器设备操作系统发行版，具有非常易于使用的 Web 前端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-27T22:22:12.430

在您的 linksys 机器上安装 DD-wrt。我相信这将拥有您需要的一切[链接文本](http://www.dd-wrt.com/site/index)

# filesystems - 各种平台的保留文件名是什么？

> ID：122400
> 
> 赞同：14
> 
> 时间：2008-09-23T17:18:36.087
> 
> 标签：filesystems, naming

我不是在询问文件名的一般语法规则。我的意思是会突然跳出来咬你的陷阱。例如，尝试在 Windows 上将文件命名为“COM<n>”？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-23T17:24:53.577

来自：[http](http://www.grouplogic.com/knowledge/index.cfm/fuseaction/view_Info/docID/111) ://www.grouplogic.com/knowledge/index.cfm/fuseaction/view_Info/docID/111 。

> 以下字符在使用 NTFS 的 Windows 上作为文件或文件夹名称无效：`/` `?` `<` `>` `\` `:` `*` `|` `"`以及您可以使用 Ctrl 键键入的任何字符。
> 
> 除了上述非法字符之外，在`^`使用 FAT 文件系统的 Windows 操作系统下也不允许使用插入符号。
> 
> 在使用 FAT 文件系统的 Windows 下，文件和文件夹名称最长可达 255 个字符。
> 
> 在使用 NTFS 文件系统的 Windows 下，文件和文件夹名称最长可达 256 个字符。
> 
> 在 Window 下，两个系统下的完整路径长度均为 260 个字符。
> 
> 除了这些字符之外，以下约定也是非法的：
> 
> *   在名称末尾放置一个空格
> *   在名称的末尾放置一个句点
> 
> Windows 下也保留以下文件名：
> 
> *   `aux`,
> *   `com1`,
> *   `com2`,
> *   ...
> *   `com9`,
> *   `lpt1`,
> *   `lpt2`,
> *   ...
> *   `lpt9`,
> *   `con`,
> *   `nul`,
> *   `prn`

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T17:27:03.493

Windows 上合法和非法文件名的完整描述：[http://msdn.microsoft.com/en-us/library/aa365247.aspx](http://msdn.microsoft.com/en-us/library/aa365247.aspx)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-23T17:24:01.627

当你不知道时，一个棘手的 Unix 陷阱：

以 - 或 - 开头的文件是合法的，但使用起来很麻烦，因为许多命令行工具认为您正在为它们提供选项。

其中许多工具都有一个特殊的标记“--”来表示选项的结束：

```
gzip -9vf -- -mydashedfilename 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-01-12T23:34:00.363

正如其他人所说，像 COM1 这样的设备名称在 Windows 下不可能作为文件名，因为它们是保留设备。

但是，有一种转义方法可以创建和访问具有这些保留名称的文件，例如，此命令会将命令的输出重定向`ver`到名为 COM1 的文件中：

```
ver > "\\?\C:\Users\username\COM1" 
```

现在您将拥有一个名为 COM1 的文件，99% 的程序将无法打开它，如果您尝试访问它可能会冻结。

这是解释此“文件命名空间”如何工作[的 Microsoft 文章。](http://msdn.microsoft.com/en-us/library/windows/desktop/aa365247%28v=vs.85%29.aspx#win32_file_namespaces)基本上，它告诉 Windows 不要对文本进行任何字符串处理并将其直接传递给文件系统。此技巧还可用于处理超过 260 个字符的路径。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-23T17:29:43.800

boost::filesystem[可移植性指南](http://www.boost.org/doc/libs/1_36_0/libs/filesystem/doc/portability_guide.htm)有很多很好的信息。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T17:21:28.017

好吧，对于 MSDOS/Windows，NUL、PRN、LPT<n> 和 CON。如果与扩展名一起使用，它们甚至会导致问题：“NUL.TXT”

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T17:24:13.953

除非您要接触特殊目录，否则 Linux 上唯一的非法名称是 ' `.`' 和 ' `..`'。任何其他名称都是可能的，尽管从 shell 访问其中一些名称需要使用转义序列。

`-`编辑：正如 Vinko Vrsalovic 所说，以 ' ' 和 ' '开头的文件`--`对 shell 来说是一种痛苦，因为这些字符序列是由应用程序解释的，而不是 shell。

# c# - 是否有通过选择所需区域从文本中创建正则表达式的应用程序？

> ID：122402
> 
> 赞同：5
> 
> 时间：2008-09-23T17:18:56.430
> 
> 标签：c#, regex, automation

我希望这是与程序员相关的问题。我从事 C# 编程的业余爱好。出于我自己的目的，我需要解析 html 文件，最好的想法是..正则表达式。正如许多人发现的那样，学习它们非常耗时，因此如果您知道一些能够接受**输入**的应用程序（任何代码），**了解我需要什么**（通过我选择一个我需要“删除”的代码），并**为我提供正确的正则表达式**或更多选项。

正如我所听说的，Regex 本身就是一门小科学，所以它可能不像我想象的那么容易。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T17:22:45.407

是的，罗伊·奥舍罗夫（Roy Osherove）写的正是您要找的[东西-regulazy](http://files.osherove.com/Regulazy/Regulazy.103.zip)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T17:22:07.000

不是您的问题的真正答案，因为它与正则表达式无关，但[HtmlAgilityPack](http://www.codeplex.com/htmlagilitypack)可以帮助您进行解析。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-26T13:19:33.803

您可能还想尝试 txt2re : [http://txt2re.com/](http://txt2re.com/)，它尝试识别用户提供的字符串中的模式并允许从中构建正则表达式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T13:29:48.457

我必须同意 Sunny 在这一点上：如果您正在解析 html，最好将其转换为 XML（使用 HTML Agility 包非常简单），然后您可以使用 XPATH 表达式而不是正则表达式，这要好得多适合这份工作。

# editor - 如何在没有富文本格式的情况下复制和粘贴代码？

> ID：122404
> 
> 赞同：76
> 
> 时间：2008-09-23T17:19:10.797
> 
> 标签：editor, copy-paste

我过去常常发现自己处理来自网站/Word 文档等的一段代码，却发现在粘贴时我会得到所需的代码以及一些额外的 HTML 标签/文本，基本上是额外的格式信息。

为了摆脱多余的镇流器，我会将文本粘贴到记事本，然后再次复制，然后粘贴到所需的目的地。

就在最近，我发现了一个简单且免费的 Windows 工具，名为[PureText](http://www.stevemiller.net/puretext/)，它可以让我减少记事本步骤。它基本上添加了一个额外的键盘快捷键，例如 WinKey + V 将执行粘贴操作而无需格式化；只是纯文本。我觉得很方便。

我想知道您自己会使用什么方法？他们是否更好/更容易使用周围的工具？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-04-24T10:14:35.483

**总结一下可用的选项：**

**工具**

*   [PureText](http://www.stevemiller.net/puretext/) - 适用于 Windows 的免费工具
*   使用[AutoHotkey并按照](http://www.autohotkey.com)[Dean](https://stackoverflow.com/questions/122404/#132826)的建议编写自己的宏

**浏览器**

*   从浏览器**复制纯文本：**[复制为纯文本](https://addons.mozilla.org/en-US/firefox/addon/copy-as-plain-text)或[CopyPlainText](https://addons.mozilla.org/en-US/firefox/addon/134?id=134&vid=654)（由[cori](https://stackoverflow.com/questions/122404/#122416)建议）- Firefox 扩展
*   要在不格式化的情况下**粘贴**到浏览器（至少是 Firefox/Chrome）： Windows/Linux 上的`CTRL`+ `⇧ Shift`+ `V`，请参阅下面的 Mac OS X。

**其他**

*   [在**Mac OS X**](http://support.apple.com/kb/HT1343)下，您可以`⇧ Shift`+ `⌥ Alt`+ `⌘ Command`+`V`以“当前”格式粘贴（*编辑*->*粘贴和匹配样式*）；或`⌘ Command`+ `⇧ Shift`+`V`粘贴而不格式化（通过[Kamafeather](https://stackoverflow.com/questions/122404/#comment81395440_122475)）
*   粘贴到记事本（或其他文本编辑器），然后从记事本复制并再次粘贴
*   对于单行文本：粘贴到任何非富文本字段（浏览器 URL、文本区域、搜索/查找输入等）

**请随时编辑/添加新项目**

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-09-23T17:31:30.317

仅供参考，在 Mac OS X 下，您可以使用++`⌘ Command`不格式化或以“当前”格式粘贴。`⇧ Shift``V`

注意：在某些应用程序中它是`⌘ Command`+ `⇧ Shift`+ `⌥ Alt`+ `V`（请参阅“编辑”菜单 →“粘贴和匹配样式”）

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-25T11:54:02.513

[我是Autohotkey](http://www.autohotkey.com.)的忠实粉丝。我定义了一个适用于任何应用程序的“粘贴纯文本”宏。当我按下 Ctrl+Shift+V 并粘贴剪贴板上任何内容的普通版本时，它就会运行。Autohotkey 的好处是：您可以编写代码以按照您希望它们在所有应用程序中工作的方式工作。

```
^+v::
    ; Convert any copied files, HTML, or other formatted text to plain text
    Clipboard = %Clipboard%

    ; Paste by pressing Ctrl+V
    SendInput, ^v
return 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-23T17:22:36.950

在网站上，使用 Firefox，我使用[CopyPlainText](https://addons.mozilla.org/en-US/firefox/addon/134?id=134&vid=654)扩展。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-23T17:22:48.760

如果要粘贴到 Word 中，可以使用“选择性粘贴”命令。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T11:40:22.263

我将[**Far.exe**](http://www.farmanager.com/?l=en)作为开始菜单中的第一项。

剪贴板中的富文本 ->

```
ctrl-escape,arrdown,enter,shift-f4,$,enter
shift-insert,ctrl-insert,alt-backspace,
f10,enter 
```

-> 剪贴板中的纯文本

优点：没有鼠标，只是盲打，在我之前的位置结束

缺点：ANSI 编码 - 国际符号丢失

幸运的是，我不必经常这样做:)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T17:24:02.703

用你的 PureText 很好地找到。在更改键盘之前，我已经构建了一个运行宏的键，该宏在记事本中复制-粘贴-复制以完成此任务！我会试试你的软件，因为我现在没有任何宏键:(

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-25T11:35:36.037

我编写了一个未发布的 Java 应用程序来监视剪贴板，将提供文本以及其他更丰富格式的项目替换为仅提供纯文本格式的项目。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T17:22:50.803

寻找一个在您粘贴的材料末尾弹出的小剪贴板图标。单击它并选择“仅保留文本”。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T17:23:01.943

我使用 OpenOffice.org，它提供了一个特殊的粘贴选项，您可以在其中完全省略格式设置。如果您不受 MS Word 的约束，IMO 值得一试，而且它是免费的 :-)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T17:52:29.470

每当这些插件和选项不可用时，我都会使用我的好朋友记事本。将内容粘贴到记事本中，它不会接受额外的格式，然后将其复制回来。有点老套，但很好。有用！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-23T17:57:37.740

我通常使用记事本2，我从网上复制的所有文本都粘贴在那里然后重复使用，这允许我清理它（从格式和进行修改）。

[你可以在这里下载 Notepad2](http://www.flos-freeware.ch/notepad2.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-25T11:41:13.667

如果您使用的是 MS Word，请尝试 ALT+E、S、U、Enter（使用选择性粘贴）

# java - Java 中最接近函数指针的替代品是什么？

> ID：122407
> 
> 赞同：305
> 
> 时间：2008-09-23T17:20:10.700
> 
> 标签：java, closures, function-pointers

我有一个大约十行代码的方法。我想创建更多的方法来做同样的事情，除了一个小的计算会改变一行代码。这是一个完美的应用程序，用于传递函数指针以替换该行，但 Java 没有函数指针。我最好的选择是什么？

* * *

## 回答 #1

> 赞同：272
> 
> 时间：2008-09-23T17:21:43.927

匿名内部类

假设您希望传入一个带有`String`返回`int`.
首先，如果您不能重用现有接口，则必须定义一个接口，该接口作为其唯一成员。

```
interface StringFunction {
    int func(String param);
} 
```

采用指针的方法将只接受`StringFunction`如下实例：

```
public void takingMethod(StringFunction sf) {
   int i = sf.func("my string");
   // do whatever ...
} 
```

并会这样称呼：

```
ref.takingMethod(new StringFunction() {
    public int func(String param) {
        // body
    }
}); 
```

*编辑：*在 Java 8 中，您可以使用 lambda 表达式调用它：

```
ref.takingMethod(param -> bodyExpression); 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-09-23T17:27:06.597

对于每个“函数指针”，我会创建一个小型[仿函数类](http://en.wikipedia.org/wiki/Function_object#In_Java)来实现您的计算。定义一个所有类都将实现的接口，并将这些对象的实例传递给更大的函数。这是“[命令模式](http://en.wikipedia.org/wiki/Command_pattern)”和“[策略模式](https://stackoverflow.com/questions/91932/how-does-the-strategy-pattern-work)”的组合。

@sblundy 的例子很好。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-03-27T00:16:31.537

当您可以在该行中执行预定义数量的不同计算时，使用枚举是实现策略模式的一种快速而清晰的方法。

```
public enum Operation {
    PLUS {
        public double calc(double a, double b) {
            return a + b;
        }
    },
    TIMES {
        public double calc(double a, double b) {
            return a * b;
        }
    }
     ...

     public abstract double calc(double a, double b);
} 
```

显然，策略方法声明以及每个实现的一个实例都定义在单个类/文件中。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-09-23T17:30:21.567

您需要创建一个接口来提供您想要传递的功能。例如：

```
/**
 * A simple interface to wrap up a function of one argument.
 * 
 * @author rcreswick
 *
 */
public interface Function1<S, T> {

   /**
    * Evaluates this function on it's arguments.
    * 
    * @param a The first argument.
    * @return The result.
    */
   public S eval(T a);

} 
```

然后，当您需要传递一个函数时，您可以实现该接口：

```
List<Integer> result = CollectionUtilities.map(list,
        new Function1<Integer, Integer>() {
           @Override
           public Integer eval(Integer a) {
              return a * a;
           }
        }); 
```

最后，map函数使用传入的Function1如下：

```
 public static <K,R,S,T> Map<K, R> zipWith(Function2<R,S,T> fn, 
         Map<K, S> m1, Map<K, T> m2, Map<K, R> results){
      Set<K> keySet = new HashSet<K>();
      keySet.addAll(m1.keySet());
      keySet.addAll(m2.keySet());

      results.clear();

      for (K key : keySet) {
         results.put(key, fn.eval(m1.get(key), m2.get(key)));
      }
      return results;
   } 
```

如果您不需要传入参数，您通常可以使用 Runnable 代替您自己的接口，或者您可以使用各种其他技术来减少参数数量的“固定”，但这通常是与类型安全的权衡。（或者你可以覆盖你的函数对象的构造函数，以这种方式传递参数。有很多方法，有些在某些情况下效果更好。）

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2014-02-23T20:37:30.963

## `::`使用运算符的方法引用

*您可以在方法接受功能接口*的方法参数中使用方法引用。功能接口是任何只包含一个抽象方法的接口。（功能接口可能包含一个或多个默认方法或静态方法。）

[`IntBinaryOperator`](http://docs.oracle.com/javase/8/docs/api/java/util/function/IntBinaryOperator.html)是一个功能接口。它的抽象方法[`applyAsInt`](http://docs.oracle.com/javase/8/docs/api/java/util/function/IntBinaryOperator.html#applyAsInt-int-int-)接受两个`int`s 作为其参数并返回一个`int`。[`Math.max`](http://docs.oracle.com/javase/8/docs/api/java/lang/Math.html#max-int-int-)也接受两个`int`s 并返回一个`int`. 在此示例中，`A.method(Math::max);`make`parameter.applyAsInt`将其两个输入值发送到`Math.max`并返回 that 的结果`Math.max`。

```
import java.util.function.IntBinaryOperator;

class A {
    static void method(IntBinaryOperator parameter) {
        int i = parameter.applyAsInt(7315, 89163);
        System.out.println(i);
    }
} 
```

```
import java.lang.Math;

class B {
    public static void main(String[] args) {
        A.method(Math::max);
    }
} 
```

一般来说，您可以使用：

```
method1(Class1::method2); 
```

代替：

```
method1((arg1, arg2) -> Class1.method2(arg1, arg2)); 
```

简称：

```
method1(new Interface1() {
    int method1(int arg1, int arg2) {
        return Class1.method2(arg1, agr2);
    }
}); 
```

有关更多信息，请参阅[Java 8 中的 ::（双冒号）运算符](https://stackoverflow.com/q/20001427/2846923)和[Java 语言规范 §15.13](http://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.13)。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2009-03-26T21:39:48.387

您也可以这样做（在某些***罕见***的情况下这是有道理的）。问题（这是一个大问题）是您失去了使用类/接口的所有类型安全性，并且您必须处理该方法不存在的情况。

它确实具有“好处”，您可以忽略访问限制并调用私有方法（示例中未显示，但您可以调用编译器通常不允许您调用的方法）。

同样，这是有道理的罕见情况，但在这些情况下，它是一个不错的工具。

```
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

class Main
{
    public static void main(final String[] argv)
        throws NoSuchMethodException,
               IllegalAccessException,
               IllegalArgumentException,
               InvocationTargetException
    {
        final String methodName;
        final Method method;
        final Main   main;

        main = new Main();

        if(argv.length == 0)
        {
            methodName = "foo";
        }
        else
        {
            methodName = "bar";
        }

        method = Main.class.getDeclaredMethod(methodName, int.class);

        main.car(method, 42);
    }

    private void foo(final int x)
    {
        System.out.println("foo: " + x);
    }

    private void bar(final int x)
    {
        System.out.println("bar: " + x);
    }

    private void car(final Method method,
                     final int    val)
        throws IllegalAccessException,
               IllegalArgumentException,
               InvocationTargetException
    {
        method.invoke(this, val);
    }
} 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-03-26T21:56:05.243

如果您只有一行不同，您可以添加一个参数，例如一个标志和一个 if(flag) 语句，它调用一行或另一行。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2008-09-23T21:22:33.037

您可能也有兴趣了解 Java 7 正在进行的涉及闭包的工作：

[Java中闭包的当前状态是什么？](https://stackoverflow.com/questions/116865/whats-the-current-state-of-closures-in-java)

[http://gafter.blogspot.com/2006/08/closures-for-java.html](http://gafter.blogspot.com/2006/08/closures-for-java.html)
[http://tech.puredanger.com/java7/#closures](http://tech.puredanger.com/java7/#closures)

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2014-08-19T10:43:24.917

**使用运算符的新 Java 8*功能接口*和*方法引用*`::`。**

Java 8 能够使用“ *@Functional Interface* ”指针维护方法引用（MyClass::new）。不需要相同的方法名称，只需要相同的方法签名。

例子：

```
@FunctionalInterface
interface CallbackHandler{
    public void onClick();
}

public class MyClass{
    public void doClick1(){System.out.println("doClick1");;}
    public void doClick2(){System.out.println("doClick2");}
    public CallbackHandler mClickListener = this::doClick;

    public static void main(String[] args) {
        MyClass myObjectInstance = new MyClass();
        CallbackHandler pointer = myObjectInstance::doClick1;
        Runnable pointer2 = myObjectInstance::doClick2;
        pointer.onClick();
        pointer2.run();
    }
} 
```

那么，我们这里有什么？

1.  *功能接口 - 这是一个接口，用@FunctionalInterface*注释与否，它只包含一个方法声明。
2.  方法引用 - 这只是特殊语法，看起来像这样*objectInstance::methodName*，仅此而已。
3.  用法示例 - 只是一个赋值运算符，然后是接口方法调用。

你应该只为听众使用功能接口，而且只为那个！

因为所有其他此类函数指针对代码的可读性和理解能力都非常不利。但是，直接方法引用有时会派上用场，例如 foreach。

有几个预定义的功能接口：

```
Runnable              -> void run( );
Supplier<T>           -> T get( );
Consumer<T>           -> void accept(T);
Predicate<T>          -> boolean test(T);
UnaryOperator<T>      -> T apply(T);
BinaryOperator<T,U,R> -> R apply(T, U);
Function<T,R>         -> R apply(T);
BiFunction<T,U,R>     -> R apply(T, U);
//... and some more of it ...
Callable<V>           -> V call() throws Exception;
Readable              -> int read(CharBuffer) throws IOException;
AutoCloseable         -> void close() throws Exception;
Iterable<T>           -> Iterator<T> iterator();
Comparable<T>         -> int compareTo(T);
Comparator<T>         -> int compare(T,T); 
```

对于早期的 Java 版本，您应该尝试 Guava Libraries，它具有类似的功能和语法，正如 Adrian Petrescu 上面提到的那样。

如需更多研究，请查看[Java 8 Cheatsheet](http://www.java8.org/)

感谢 The Guy with The Hat 提供[Java 语言规范 §15.13](http://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.13)链接。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2010-05-04T18:44:01.753

@sblundy 的答案很好，但匿名内部类有两个小缺陷，主要是它们往往不可重用，次要是笨重的语法。

好消息是他的模式扩展到完整的类，而主类（执行计算的类）没有任何变化。

当您实例化一个新类时，您可以将参数传递给该类，这些参数可以在您的方程式中充当常量——因此，如果您的内部类之一看起来像这样：

```
f(x,y)=x*y 
```

但有时你需要一个：

```
f(x,y)=x*y*2 
```

也许三分之一是：

```
f(x,y)=x*y/2 
```

与其创建两个匿名内部类或添加“passthrough”参数，不如创建一个实例化为的 ACTUAL 类：

```
InnerFunc f=new InnerFunc(1.0);// for the first
calculateUsing(f);
f=new InnerFunc(2.0);// for the second
calculateUsing(f);
f=new InnerFunc(0.5);// for the third
calculateUsing(f); 
```

它只是将常量存储在类中并在接口中指定的方法中使用它。

事实上，如果知道你的函数不会被存储/重用，你可以这样做：

```
InnerFunc f=new InnerFunc(1.0);// for the first
calculateUsing(f);
f.setConstant(2.0);
calculateUsing(f);
f.setConstant(0.5);
calculateUsing(f); 
```

但是不可变类更安全——我无法提出使这样的类成为可变类的理由。

我真的只是发布这个，因为每当我听到匿名内部类时我都会畏缩 - 我已经看到很多“必需”的冗余代码，因为程序员做的第一件事就是在他应该使用实际类时匿名重新考虑了自己的决定。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2010-12-16T21:32:14.177

变得非常流行的 Google [Guava 库](http://code.google.com/p/guava-libraries/)有一个通用的[Function](http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Function.html)和[Predicate](http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/base/Predicate.html)对象，它们已经在他们的 API 的许多部分中工作。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2010-01-28T03:20:55.163

在使用 Java 编程时，我真正怀念的一件事是函数回调。需要这些不断呈现的一种情况是递归处理层次结构，您希望在其中为每个项目执行一些特定操作。就像遍历目录树或处理数据结构一样。我内心的极简主义者讨厌必须定义一个接口，然后为每个特定情况定义一个实现。

有一天，我发现自己想知道为什么不呢？我们有方法指针 - Method 对象。通过优化 JIT 编译器，反射调用确实不再带来巨大的性能损失。除了将文件从一个位置复制到另一个位置之外，反射方法调用的成本微不足道。

当我想得更多时，我意识到 OOP 范式中的回调需要将对象和方法绑定在一起 - 进入 Callback 对象。

查看我的基于反射的[Java 回调](http://www.softwaremonkey.org/Code/Callback)解决方案。免费供任何使用。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-25T03:21:47.003

对我来说，这听起来像是一种策略模式。查看 fluffycat.com Java 模式。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2011-03-18T02:53:57.243

在没有接口的情况下为一组函数做同样的事情：

```
class NameFuncPair
{
    public String name;                // name each func
    void   f(String x) {}              // stub gets overridden
    public NameFuncPair(String myName) { this.name = myName; }
}

public class ArrayOfFunctions
{
    public static void main(String[] args)
    {
        final A a = new A();
        final B b = new B();

        NameFuncPair[] fArray = new NameFuncPair[]
        {
            new NameFuncPair("A") { @Override void f(String x) { a.g(x); } },
            new NameFuncPair("B") { @Override void f(String x) { b.h(x); } },
        };

        // Go through the whole func list and run the func named "B"
        for (NameFuncPair fInstance : fArray)
        {
            if (fInstance.name.equals("B"))
            {
                fInstance.f(fInstance.name + "(some args)");
            }
        }
    }
}

class A { void g(String args) { System.out.println(args); } }
class B { void h(String args) { System.out.println(args); } } 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2011-11-09T14:59:09.500

好的，这个线程已经足够老了，所以我的回答*很可能*对这个问题没有帮助。但是由于这个线程帮助我找到了我的解决方案，所以无论如何我都会把它放在这里。

我需要使用具有已知输入和已知输出（均为**double**）的变量静态方法。那么，知道方法包和名称，我可以按如下方式工作：

```
java.lang.reflect.Method Function = Class.forName(String classPath).getMethod(String method, Class[] params); 
```

对于接受一个 double 作为参数的函数。

所以，在我的具体情况下，我用

```
java.lang.reflect.Method Function = Class.forName("be.qan.NN.ActivationFunctions").getMethod("sigmoid", double.class); 
```

然后在更复杂的情况下调用它

```
return (java.lang.Double)this.Function.invoke(null, args);

java.lang.Object[] args = new java.lang.Object[] {activity};
someOtherFunction() + 234 + (java.lang.Double)Function.invoke(null, args); 
```

其中活动是任意双精度值。我正在考虑可能会像 SoftwareMonkey 所做的那样更抽象和概括它，但目前我对它的方式感到满意。三行代码，不需要类和接口，还不错。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-09-12T07:39:12.667

查看 lambdaj

[http://code.google.com/p/lambdaj/](http://code.google.com/p/lambdaj/)

尤其是它的新关闭功能

[http://code.google.com/p/lambdaj/wiki/Closures](http://code.google.com/p/lambdaj/wiki/Closures)

你会发现一种非常易读的方式来定义闭包或函数指针，而无需创建无意义的接口或使用丑陋的内部类

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2011-03-02T04:11:04.413

哇，考虑到我已经为 java 做过的事情，为什么不直接创建一个并不那么难的 Delegate 类，并使用它来传递参数，其中 T 是返回类型。我很抱歉，但作为一个 C++/C# 程序员，一般只是学习 java，我需要函数指针，因为它们非常方便。如果你熟悉任何处理方法信息的类，你就可以做到。在 java.lang.reflect.method 的 java 库中。

如果你总是使用一个接口，你总是必须实现它。在事件处理中，从处理程序列表中注册/注销确实没有更好的方法，但是对于需要传入函数而不是值类型的委托，使委托类处理它以超越接口。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2016-10-07T17:08:44.000

Java 8 的答案都没有给出一个完整的、有凝聚力的例子，所以它来了。

声明接受“函数指针”的方法如下：

```
void doCalculation(Function<Integer, String> calculation, int parameter) {
    final String result = calculation.apply(parameter);
} 
```

通过为函数提供 lambda 表达式来调用它：

```
doCalculation((i) -> i.toString(), 2); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2014-06-10T23:02:32.423

如果有人正在努力传递一个函数，该函数需要一组参数来定义其行为，但要执行另一组参数，例如 Scheme 的：

```
(define (function scalar1 scalar2)
  (lambda (x) (* x scalar1 scalar2))) 
```

请参阅[Java 中具有参数定义行为的传递函数](https://stackoverflow.com/questions/24148175/pass-function-with-parameter-defined-behavior-in-java "在 Java 中传递具有参数定义行为的函数")

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-05-10T12:50:18.987

从 Java8 开始，您可以使用 lambdas，它在官方 SE 8 API 中也有库。

**用法：** 你需要使用一个只有一个抽象方法的接口。像这样创建一个实例（您可能希望使用已经提供的 java SE 8）：

```
Function<InputType, OutputType> functionname = (inputvariablename) {
... 
return outputinstance;
} 
```

有关更多信息，请查看文档：[https ://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html](https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2015-06-23T11:06:06.977

在 Java 8 之前，最接近类似函数指针的功能的替代品是匿名类。例如：

```
Collections.sort(list, new Comparator<CustomClass>(){
    public int compare(CustomClass a, CustomClass b)
    {
        // Logic to compare objects of class CustomClass which returns int as per contract.
    }
}); 
```

但是现在在 Java 8 中，我们有一个非常简洁的替代方案，称为[lambda 表达式](https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html)，它可以用作：

```
list.sort((a, b) ->  { a.isBiggerThan(b) } ); 
```

其中 isBiggerThan 是`CustomClass`. 我们也可以在这里使用方法引用：

```
list.sort(MyClass::isBiggerThan); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-09-07T10:58:08.637

开源[安全镜像](https://github.com/Hervian/safety-mirror)项目将上述一些解决方案推广到一个库中，该库向 Java 添加了函数、委托和事件。

有关功能的备忘单，请参阅 README 或[此 stackoverflow 答案。](https://stackoverflow.com/a/63775875/6095334)

至于函数，该库引入了一个 Fun 接口，以及一些子接口（与泛型一起）构成了一个流畅的 API，用于将方法用作类型。

```
Fun.With0Params<String> myFunctionField = "   hello world   "::trim;`  
Fun.With2Params<Boolean, Object, Object> equals = Objects::equals;`  

public void foo(Fun.With1ParamAndVoid<String> printer) throws Exception {
    printer.invoke("hello world);
}  

public void test(){
    foo(System.out::println);
} 
```

注意：

1.  您必须选择与您所定位的签名中的参数数量相匹配的子接口。Fx，如果只有一个参数，选择Fun.With1Param。
2.  泛型用于定义 A）返回类型和 B）签名的参数。

另外，请注意传递给 foo() 方法调用的方法引用的签名必须与方法 Foo 定义的 Fun 匹配。如果没有，编译器将发出错误。

# excel - 将 Excel 文件导入 Access 时更改数据类型

> ID：122422
> 
> 赞同：6
> 
> 时间：2008-09-23T17:23:06.373
> 
> 标签：excel, ms-access, import

将 Excel 文件导入 Access 时，有什么方法可以更改默认数据类型？（顺便说一下，我使用的是 Access 2003）。

我知道有时我可以自由地将任何数据类型分配给正在导入的每一列，但这只能在我导入非 Excel 文件时进行。

**编辑：**要清楚，我知道在导入过程中有一个步骤允许您更改导入列的数据类型。

事实上，这就是我要问的。出于某种原因 - 也许它总是 Excel 文件，也许还有其他东西 - 我有时不允许更改数据类型：下拉框显示为灰色，我只需要使用 Access 假定正确的任何数据类型。

例如，我刚刚尝试在 Access 中导入一个大型 Excel 文件（**12000+ 行，~200 列**），其中第 105 列（或类似的东西）填充了大部分数字（代码：`1=foo, 2=bar`等），尽管有少数那里也有 alpha 代码（A=boo，B=far 等）。Access 假设它是一种`Number`数据类型（即使在我更改了`Format`Excel 文件本身的值之后），因此在这些 alpha 代码上给了我错误。如果允许我在导入时更改数据类型，那会为我省去一些麻烦。

我是在要求 Access 不会做的事情，还是我错过了什么？谢谢。

**编辑：**下面有两个答案可以提供有用的建议。将 Excel 文件保存为 CSV，然后像[Chris OC](https://stackoverflow.com/questions/122422/change-datatype-when-importing-excel-file-into-access#122588)所说的那样导入效果很好并且很简单。保存导入规范的建议也很有帮助。[但是，我选择了DK](https://stackoverflow.com/questions/122422/change-datatype-when-importing-excel-file-into-access#122504)的注册表设置答案作为“接受的答案”。我喜欢它作为答案，因为它是*一次性的步骤*，可用于解决我的主要问题（让 Access 错误地分配了数据类型）。简而言之，这个解决方案不允许我自己更改数据类型，但它可以让 Access 准确猜测数据类型，从而减少问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T17:50:37.727

有几种方法可以做到这一点。最直接的方法是在 Excel 中将 .xls 文件转换为 .csv 文件，这样您就可以使用“导入文本向导”导入 Access，该向导允许您在导入期间选择每列的数据类型。

*这样*做的另一个好处是导入 csv（或文本）文件比导入 xls 文件快得多。如果您要多次执行此导入，请将导入设置设置保存为导入规范。（在导入文本向导中，单击左下角的“高级...”按钮，然后单击“另存为”并提供规范名称以保存您刚刚所做的更改。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T17:36:21.210

这*可能*是由 Excel Jet 驱动程序默认设置引起的。查看以下注册表项并将其值从默认的 8 更改为 0，这意味着“根据所有值猜测列数据类型，而不仅仅是前 8 行”。

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Jet\4.0\Engines\Excel]
"TypeGuessRows"=dword:00000000 
```

请告诉这是否有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-02-21T02:18:27.293

打开你的excel文件。在主页选项卡中，将格式从常规更改为文本。然后导入访问

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T19:56:35.537

Access 可以满足您的需求，但没有直接的方法。您必须管理一些记录集，一个是您的 Excel 数据，另一个是您的最终 Access 表。打开两个记录集后，您可以通过浏览 Excel 数据并将其添加到 Access 表中，将数据从一个记录集传输到另一个记录集。在这个阶段，可以根据要求更改数据类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T09:11:10.883

从 CSV 文件导入时，您还可以查看[schema.ini](http://msdn.microsoft.com/en-us/library/ms709353.aspx)，您会发现通过它您可以控制导入过程的各个方面。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-05-02T00:59:14.863

Access 将允许您在导入过程中指定数据类型。问题出在以下时间的“追加”过程中，它不会询问导入数据类型，它会忘记您更改它。我认为这是 MS Access 中的一个错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-08-18T14:28:58.993

这是一个旧帖子，但问题仍然存在！我同意迪帕克的观点。继续这个想法：

Access 根据 Excel 中的字段类型确定链接或导入 Excel 文件时的字段类型。如果它们都是默认值，它会查看前 X 行数据。解决此问题的几种方法：

1.  打开 Excel 文件并添加大约 6 行（如果有，则在字段标题下）模拟您想要的类型。如果您喜欢所有文本，请在前六行的每个单元格中输入“abcdef”。

2.  打开 Excel 文件，突出显示所有单元格，右键单击，然后将格式更改为“文本”或您喜欢的任何格式。保存，然后链接/导入到 Access。

3.  每次使用宏（VBA 脚本）为您执行第 2 步：

```
Public Function fcn_ChangeExcelFormat()
On Error GoTo ErrorExit

Dim strExcelFile As String
Dim XL_App As Excel.Application
Dim XL_WB As Excel.Workbook
Dim XL_WS As Excel.Worksheet

strExcelFile = "C:\My Files\MyExcelFile.xlsx"

Set XL_App = New Excel.Application

Set XL_WB = XL_App.Workbooks.Open(strExcelFile, , False)
Set XL_WS = XL_WB.Sheets(1)  '  1 can be changed to "Your Worksheet Name"

With XL_WS
   .Cells.NumberFormat = "@"  'Equiv to Right Click...Format Cells...Text
End With

XL_WB.Close True
XL_App.Quit

NormalExit:
Set XL_WB = Nothing
Set XL_App = Nothing
Exit Function

ErrorExit:
strMsg = "There was an error updating the Excel file!  " & vbCr & vbCr & _
         "Error " & Err.Number & ": " & Err.Description
MsgBox strMsg, vbExclamation, "Error"
Resume NormalExit
End Function 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-23T17:26:04.743

Access 将执行此操作。

在您的导入过程中，您可以定义每列的数据类型。

# git - 使用分布式版本控制时的构建顺序

> ID：122424
> 
> 赞同：29
> 
> 时间：2008-09-23T17:23:32.830
> 
> 标签：git, build-process, dvcs

现在，我们正在使用 Perforce 进行版本控制。它有一个方便的特性，即严格增加的更改编号，我们可以使用它来引用构建，例如“如果您的构建至少为 44902，您将获得错误修复”。

我想改用分布式系统（可能是 git），以便更轻松地进行分支和在家工作。（Perforce 完全可以实现这两者，但 git 工作流有一些优势。）因此，尽管“附属开发”将是分布式的，而不是指通用的修订顺序，但我们仍然会维护一个主 git 存储库，所有更改都会需要在创建构建之前输入。

保留严格增加的构建 ID 的最佳方法是什么？我能想到的最直接的方法是有某种 post-commit 钩子，只要主 repo 更新就会触发，它会注册（哈希）新树对象（或提交对象？我是新手git) 带有一个分发 id 的集中式数据库。（我说“数据库”，但我可能会用 git 标签来做，只是寻找下一个可用的标签号或其他东西。所以“数据库”实际上是 .git/refs/tags/build-id/。 )

这是可行的，但我想知道是否有更简单、已经实现或标准/“最佳实践”的方式来实现这一点。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2013-02-21T08:42:00.380

可以生成与当前提交对应的单调递增数字

```
git log --pretty=oneline | wc -l 
```

它返回一个数字。您还可以将当前 sha1 附加到该数字，以添加唯一性。

这种方法比 更好`git describe`，因为它不需要您添加任何标签，并且它会自动处理合并。

变基可能会出现问题，但是变基无论如何都是“危险的”操作。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-24T00:35:04.167

我赞同使用`git describe`. 假设您有一个健全的版本控制策略，并且您没有对您的存储库做任何疯狂的事情，那么您`git describe`将始终是单调的（至少尽可能单调，当您的修订历史是 DAG 而不是树时）并且是唯一的.

一个小示范：

```
git init
git commit --allow-empty -m'Commit One.'
git tag -a -m'Tag One.' 1.2.3
git describe    # => 1.2.3
git commit --allow-empty -m'Commit Two.'
git describe    # => 1.2.3-1-gaac161d
git commit --allow-empty -m'Commit Three.'
git describe    # => 1.2.3-2-g462715d
git tag -a -m'Tag Two.' 2.0.0
git describe    # => 2.0.0 
```

的输出`git describe`由以下组件组成：

1.  您要求描述的提交中可访问的最新标签
2.  提交和标签之间的提交次数（如果非零）
3.  提交的（缩写）id（如果 #2 非零）

#2 是使输出单调的原因，#3 是使其独特的原因。#2 和#3 省略，当commit*为*标签时，`git describe`也适用于生产版本。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2014-02-27T23:32:03.833

```
 git rev-list BRANCHNAME --count 
```

这比资源密集型要少得多

```
 git log --pretty=oneline | wc -l 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T18:05:00.033

`git tag`可能足以满足您的需要。选择每个人都同意不使用的标签格式。

注意：在本地标记时，a`git push`不会更新服务器上的标记。为此使用`git push --tags`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T20:17:41.290

你应该调查一下`git describe`。它给出了一个唯一的字符串，该字符串根据最新的注释标签、自该标签以来的提交次数和分支头部的缩写提交 id 来描述当前分支（或任何传递的提交 id）。

大概你有一个分支来执行受控的构建版本。在这种情况下，我将使用已知标记格式标记早期提交，然后使用带有 --match 选项的 git describe 来描述相对于已知标记的当前 HEAD。然后，您可以按原样使用 git describe 的结果，或者如果您真的只想要一个数字，您可以使用正则表达式将数字从标签中剔除。

假设您从不回滚分支，则后续提交的数量将始终标识分支历史记录中的唯一点。

例如（使用 bash 或类似的）

```
# make an annotated tag to an early build in the repository:
git tag -a build-origin "$some_old_commitid"

# describe the current HEAD against this tag and pull out a build number
expr "$(git describe --match build-origin)" : 'build-origin-\([0-9]*\)-g' 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T17:37:27.820

我会使用“标签”每当您成功（甚至不成功）构建时创建一个标签，您将能够永远识别该构建。它并不完全相同，但它确实提供了这些内部版本号，同时仍然提供了分布式开发的好处。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T00:03:18.127

你可能知道，git 会计算一个哈希（一个数字）来唯一标识历史的一个节点。使用这些，虽然它们没有严格增加，但似乎就足够了。（更好的是，它们*总是*对应于源，所以如果你有哈希，你就有相同的代码。）它们是大数字，但大多数情况下你可以用 6 个左右的前导数字来解决。

例如，

> 该错误已在 064f2ea 处修复...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-26T12:48:35.387

使用 Mercurial，您可以使用以下命令：

```
# get the parents id, the local revision number and the tags
[yjost@myhost:~/my-repo]$ hg id -nibt
03b6399bc32b+ 23716+ default tip 
```

见[汞识别](http://www.selenic.com/mercurial/hg.1.html#identify)

# ruby-on-rails - ziya 图表的主题化是如何工作的？

> ID：122445
> 
> 赞同：1
> 
> 时间：2008-09-23T17:26:55.117
> 
> 标签：ruby-on-rails, ruby, charts

我正在使用[The Ziya Charts Gem](http://www.ziya.liquidrail.com/)实现图表。不幸的是，文档并没有真正的帮助，或者我没有足够的咖啡来弄清楚主题。我知道我可以使用设置主题

```
chart.add(:theme, 'whatever') 
```

问题：我没有找到任何预定义的主题，也没有找到对所需格式的引用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T19:10:47.330

如果您将 ZiYa 插件安装到 Rails 应用程序中，那么您所说的应该有一个主题目录。只需复制现有主题之一，将其名称更改为您想要的任何名称，然后根据需要进行修改。

漂亮的 Flash 图表的另一个选项是[Open Flash Chart](http://teethgrinder.co.uk/open-flash-chart/)。在我正在开发的 Rails 应用程序中处理 Flash 图表时，我从 Ziya/SWF Charts 转到了 Open Flash Chart。Open Flash Chart还有一个[Rails 插件](http://pullmonkey.com/projects/open_flash_chart)。除了更容易使用之外，Open Flash Chart 是开源的，所以如果你能破解 Flash，你可以自定义它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T18:24:35.010

据我了解，通过在您的 ziya.rb 文件中初始化主题目录来使用主题，如下所示：

`Ziya.initialize(:themes_dir => File.join( File.dirname(__FILE__), %w[.. .. public charts themes]) )`

您需要设置正确的目录，在本例中为 public/charts/themes。我记得它没有任何东西开始。你过去有问题吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T17:33:59.000

为了部分回答我自己的问题，网站资源中有一些主题可以在以下位置查看

```
svn co svn://rubyforge.org/var/svn/liquidrail/samples/charting 
```

（然后转到 /public/charts/themes/）

# visual-c++ - 为 ClickOnce 先决条件指定 VC++ Redistributable 版本

> ID：122451
> 
> 赞同：8
> 
> 时间：2008-09-23T17:28:19.950
> 
> 标签：visual-c++, clickonce, versions, redistributable, prerequisites

我的 ClickOnce 应用程序使用需要 Visual C++ 2005 可再发行组件的第三方工具。如果仅安装了 VC++ 2008 可再发行组件，则第三方工具将无法工作。但是，在 Visual Studio 2008 中，ClickOnce 先决条件不允许为 VC++ 可再发行组件指定版本；它将添加一个 VC++ 2008 先决条件，这在大多数情况下都是有意义的。但是，在这种情况下，需要较早的版本。ClickOnce 是必需的，所以合并模块是不可能的。关于如何指定版本的任何想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T17:08:32.610

如果你能找到一台安装了 VS 2005 的机器，解决方案应该不会太难。您可以自定义项目“发布”选项卡上的“先决条件”对话框中显示的内容。

1.  在安装了 VS 2005 的机器上，转到**\Program Files\Microsoft Visual Studio 8\SDK\v2.0\BootStrapper\Packages**并将**vsredist_x86**文件夹复制到您从中发布的机器上。
2.  重命名文件夹，将其命名为**vsredist `_`x86 `_`2005**或类似名称。
3.  在文件夹中，编辑**\en\package.xml**文件。将标记更改为**`<String Name="DisplayName">`**有意义的内容（**Visual C++ *2005* Runtime Libraries (x86)**）以将其与现有的 2008 包区分开来。
4.  将文件夹复制到**C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bootstrapper\Packages**。
5.  如果 Visual Studio 已打开，请重新启动它。

现在，当您打开先决条件对话框时，您应该会看到 2005 软件包的新条目。我没有完全测试这个解决方案，所以我可能错过了一些细节，但希望这能让你开始。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T02:55:44.360

我相信您可以打开您的应用程序的清单文件并修改您的应用程序应该链接的 redist 版本。清单中的清单应该与您在 C:\Windows\WinSxS 目录中的内容相匹配。有一个[CodeProject 页面](http://www.codeproject.com/KB/cpp/vcredists_x86.aspx)很好地描述了使用不同的可再发行组件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-08-13T05:08:13.150

我刚刚安装了 Visual Studio 2005。这是一个原始的引导程序：

C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\BootStrapper\Packages\vcredist_x86\

\en\package.xml

```
<?xml version="1.0" encoding="utf-8" ?>

<Package
  xmlns="http://schemas.microsoft.com/developer/2004/01/bootstrapper"
  Name="DisplayName"
  Culture="Culture"
>

    <!-- Defines a localizable string table for error messages-->
    <Strings>
        <String Name="DisplayName">Visual C++ Runtime Libraries (x86)</String>
        <String Name="Culture">en</String>
        <String Name="AdminRequired">You do not have the permissions required to install Visual C++ Runtime Libraries (x86). Please contact your administrator.</String>
        <String Name="InvalidPlatformWin9x">Installation of Visual C++ Runtime Libraries (x86) is not supported on Windows 95\. Contact your application vendor.</String>
        <String Name="InvalidPlatformWinNT">Installation of Visual C++ Runtime Libraries (x86) is not supported on Windows NT 4.0\. Contact your application vendor.</String>
        <String Name="GeneralFailure">A failure occurred attempting to install Visual C++ Runtime Libraries (x86).</String>
    </Strings>

</Package> 
```

\产品.xml

```
<?xml version="1.0" encoding="utf-8" ?> 

<Product
  xmlns="http://schemas.microsoft.com/developer/2004/01/bootstrapper"
  ProductCode="Microsoft.Visual.C++.8.0.x86"
>

  <!-- Defines list of files to be copied on build -->
  <PackageFiles>
    <PackageFile Name="vcredist_x86.exe"/>
  </PackageFiles>

  <InstallChecks>
    <MsiProductCheck Property="VCRedistInstalled" Product="{A49F249F-0C91-497F-86DF-B2585E8E76B7}"/>
  </InstallChecks>

  <!-- Defines how to invoke the setup for the Visual C++ 8.0 redist -->
  <!-- TODO: Needs EstrimatedTempSpace, LogFile, and an update of EstimatedDiskSpace -->
  <Commands Reboot="Defer">
    <Command PackageFile="vcredist_x86.exe" 
         Arguments=' /q:a ' 
         >

      <!-- These checks determine whether the package is to be installed -->
      <InstallConditions>
        <BypassIf Property="VCRedistInstalled" Compare="ValueGreaterThanOrEqualTo" Value="3"/>
        <!-- Block install if user does not have admin privileges -->
        <FailIf Property="AdminUser" Compare="ValueEqualTo" Value="false" String="AdminRequired"/>

        <!-- Block install on Win95 -->
        <FailIf Property="Version9X" Compare="VersionLessThan" Value="4.10" String="InvalidPlatformWin9x"/>

        <!-- Block install on NT 4 or less -->
        <FailIf Property="VersionNT" Compare="VersionLessThan" Value="5.00" String="InvalidPlatformWinNT"/>

      </InstallConditions>

      <ExitCodes>
        <ExitCode Value="0" Result="Success"/>
        <ExitCode Value="3010" Result="SuccessReboot"/>
        <DefaultExitCode Result="Fail" FormatMessageFromSystem="true" String="GeneralFailure" />
      </ExitCodes>

    </Command>
  </Commands>
</Product> 
```

\vcredist_x86.exe

```
SHA1: 95040f80b0d203e1abaec4e06e0ec0e01c507d03 
```

# algorithm - one-element-too-large array/queue 的含义和含义是什么？

> ID：122453
> 
> 赞同：0
> 
> 时间：2008-09-23T17:28:43.583
> 
> 标签：algorithm, arrays

只是想知道它是什么。

编辑：我知道它不是一种数组，而只是一个功能。那么 one-element-too-large 是什么意思呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T17:30:27.337

对特定语言索引约定的误解？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T17:31:12.000

打算使用“数据结束”标记？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T17:44:50.487

也许是经典的栅栏柱/栅栏板计数问题？

# c++ - 跨平台处理文件路径

> ID：122455
> 
> 赞同：15
> 
> 时间：2008-09-23T17:28:47.467
> 
> 标签：c++, windows, linux, cross-platform, gnu

是否存在任何处理跨平台路径的 C++ GNU 独立类？我的应用程序构建在 Windows 和 LLinux 上。我们的配置文件引用了单独目录中的另一个文件。我希望能够将其他配置文件的路径读入一个可以在 Linux 或 Windows 上运行的类。

哪个类将提供最小的占用空间来转换在任一系统上使用的路径？谢谢

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-23T17:33:13.213

除非您使用绝对路径，否则根本不需要翻译 - Windows 会自动将正斜杠转换为反斜杠，因此如果您使用带有正斜杠路径分隔符的相对路径，那么您将是黄金。如果可能的话，你真的应该避免绝对路径。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-23T17:33:24.337

试试[boost::filesystem](http://www.boost.org/doc/libs/1_36_0/libs/filesystem/doc/index.htm)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-23T17:33:37.237

boost 中的[文件系统库可能会对您有所帮助。](http://www.boost.org/doc/libs/1_36_0/libs/filesystem/doc/index.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-12-06T09:13:48.900

有很多方法，恕我直言，正确的答案是重新设计您的程序以避免操纵路径。我在这里发布了一个答案：[https](https://stackoverflow.com/a/40980510/2345997) ://stackoverflow.com/a/40980510/2345997这是相关的。

**方法：**

1.  添加一个命令行选项，允许用户指定有问题的路径，而不是从配置文件中读取它。
2.  添加命令行选项，以便用户可以指定基本路径。配置文件中的路径将被解释为位于此基本路径下。
3.  将您的配置文件分成三个。一个文件将具有跨平台配置，另一个文件将具有仅 Windows 配置，最终文件将具有仅 Linux 配置。然后用户可以为 Windows 和 Linux 指定正确的路径。在 Windows 上，您的程序将读取跨平台配置文件和仅限 Windows 的配置文件。在 Linux 上，它将读取跨平台文件和仅限 Linux 的配​​置文件。
4.  将预处理添加到您的配置文件解析中。这将允许您拥有一个配置文件，用户可以在其中使您的程序忽略文件中的某些行，具体取决于程序在哪个操作系统上运行。因此，用户将能够两次指定文件的路径。一次用于 Linux，一次用于 Windows。
5.  更改设计，使文件始终与可执行文件位于同一目录中 - 然后用户仅在配置文件中指定文件名而不是文件路径。
6.  使用将“/”切换为“\”的简单函数。然后向用户记录他们必须将路径指定为 Linux 路径，并且此转换将应用于 Windows。
7.  为此创建您自己的路径迷你语言并将其记录给用户。例如：“/” - 指定目录分隔符，{root} - 展开到文件系统的根目录，{cwd} - 展开到当前目录，{app} - 展开到您的应用程序的路径等...然后用户可以在两个平台上指定文件路径，例如：{root}/myfiles/bob.txt。
8.  一些路径将在两个平台上都有效。例如：相对路径，如 ../my files/bill.txt。限制您的应用程序仅使用这些路径。记录此限制以及您的应用程序如何处理用户的路径。

# xml - 如何使用 Xpath 检索 XML 文件中的命名空间

> ID：122463
> 
> 赞同：40
> 
> 时间：2008-09-23T17:29:38.540
> 
> 标签：xml, xpath, namespaces

我有一个这样开头的 XML 文件：

```
<Elements name="Entities" xmlns="XS-GenerationToolElements"> 
```

我将不得不打开很多这些文件。它们中的每一个都有不同的命名空间，但一次只能有一个命名空间（我永远不会在一个 xml 文件中找到两个定义的命名空间）。

使用 XPath，我希望有一种自动方式将给定的命名空间添加到命名空间管理器。到目前为止，我只能通过解析 xml 文件来获取命名空间，但我有一个 XPathNavigator 实例，它应该有一种很好且干净的方式来获取命名空间，对吧？

- 或者 -

鉴于我只有一个命名空间，以某种方式使 XPath 使用 xml 中唯一存在的命名空间，从而通过始终附加命名空间来避免代码混乱。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-09-23T18:53:32.460

您可以尝试一些技巧；您使用哪一个将取决于您需要从文档中获取哪些信息、您想要的严格程度以及您使用的 XPath 实现的一致性程度。

获取与特定前缀关联的命名空间 URI 的一种方法是使用`namespace::`轴。这将为您提供一个名称空间节点，其名称是前缀，其值是名称空间 URI。例如，您可以使用以下路径获取文档元素上的默认命名空间 URI：

```
/*/namespace::*[name()=''] 
```

您也许可以使用它来为您的 XPathNavigator 设置名称空间关联。但是请注意，`namespace::`轴是 XPath 1.0 中并不总是实现的那些角落之一。

获取该命名空间 URI 的第二种方法是使用`namespace-uri()`文档元素上的函数（您说过将始终在该命名空间中）。表达方式：

```
namespace-uri(/*) 
```

会给你那个命名空间。

另一种方法是忘记将前缀与该名称空间相关联，而只是使您的路径无名称空间。`local-name()`每当您需要引用一个您不知道其名称空间的元素时，您都可以使用该函数来做到这一点。例如：

```
//*[local-name() = 'Element'] 
```

如果您真的想要，您可以更进一步，针对文档元素之一测试元素的命名空间 URI：

```
//*[local-name() = 'Element' and namespace-uri() = namespace-uri(/*)] 
```

考虑到名称空间对您似乎没有任何意义，最后一个选择是通过一个过滤器运行您的 XML，该过滤器去除名称空间。然后，您根本不必担心 XPath 中的它们。最简单的方法是简单地`xmlns`使用正则表达式删除属性，但如果您需要同时进行其他整理，您可以做一些更复杂的事情。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-14T02:56:27.517

**这个 40 行的 xslt 转换提供了有关给定 XML 文档中名称空间的所有有用信息**：

```
 <xsl:stylesheet version="1.0"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
       xmlns:ext="http://exslt.org/common"
       exclude-result-prefixes="ext"
    >

    <xsl:output omit-xml-declaration="yes" indent="yes"/>

    <xsl:strip-space elements="*"/>

    <xsl:key name="kNsByNsUri" match="ns" use="@uri"/>

    <xsl:variable name="vXmlNS" 
        select="'http://www.w3.org/XML/1998/namespace'"/>

    <xsl:template match="/">
      <xsl:variable name="vrtfNamespaces">
        <xsl:for-each select=
          "//namespace::*
                 [not(. = $vXmlNS)
                 and
                  . = namespace-uri(..)
               ]">
          <ns element="{name(..)}"
              prefix="{name()}" uri="{.}"/>
        </xsl:for-each>
      </xsl:variable>

      <xsl:variable name="vNamespaces"
        select="ext:node-set($vrtfNamespaces)/*"/>

      <namespaces>
              <xsl:for-each select=
               "$vNamespaces[generate-id()
                            =
                             generate-id(key('kNsByNsUri',@uri)[1])
                            ]">
                <namespace uri="{@uri}">
                  <xsl:for-each select="key('kNsByNsUri',@uri)/@element">
                    <element name="{.}" prefix="{../@prefix}"/>
                  </xsl:for-each>
                </namespace>
              </xsl:for-each>
      </namespaces>
    </xsl:template>
   </xsl:stylesheet> 
```

应用于以下 XML 文档时：

```
<a xmlns="my:def1" xmlns:n1="my:n1"
   xmlns:n2="my:n2" xmlns:n3="my:n3">
  <b>
    <n1:d/>
  </b>
  <n1:c>
    <n2:e>
      <f/>
    </n2:e>
  </n1:c>
  <n2:g/>
</a> 
```

产生了想要的结果：

```
<namespaces>
   <namespace uri="my:def1">
      <element name="a" prefix=""/>
      <element name="b" prefix=""/>
      <element name="f" prefix=""/>
   </namespace>
   <namespace uri="my:n1">
      <element name="n1:d" prefix="n1"/>
      <element name="n1:c" prefix="n1"/>
   </namespace>
   <namespace uri="my:n2">
      <element name="n2:e" prefix="n2"/>
      <element name="n2:g" prefix="n2"/>
   </namespace>
</namespaces> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T18:23:41.970

不幸的是，XPath 没有任何“默认命名空间”的概念。您需要在 XPath 上下文中注册带有前缀的名称空间，然后在 XPath 表达式中使用这些前缀。这意味着非常冗长的 xpath，但它是 XPath 1 的一个基本缺点。显然 XPath 2 将解决这个问题，但现在这对您没有用处。

我建议您以编程方式检查 XML 文档中的名称空间，将该名称空间与 XPath 上下文中的前缀相关联，然后在 xpath 表达式中使用该前缀。

# java - 如何配置项目以使用最新的 Derby DB 版本 (10.4)？

> ID：122468
> 
> 赞同：3
> 
> 时间：2008-09-23T17:30:03.813
> 
> 标签：java, netbeans, derby

每次我尝试运行使用 Derby DB 的小型应用程序时，都会收到以下错误消息：

> **消息：位于 /path/to/db/TheDB 的数据库的格式与当前版本的软件不兼容。该数据库由版本 10.4 创建或升级。**

我已经从 Netbeans 添加了库，但仍然有同样的问题。
我不确定在这里做什么。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T20:58:41.037

Netbeans 包含的版本可能是旧的（从 NB 6.0 开始的 Derby 10.2）。如果您通过项目属性添加了 Derby 并添加了“库”，那么您可能使用的是旧版本。

您可以通过转到工具 -> 库来更新库。选择“Java DB 驱动程序”。删除 jar 引用并更新它们以指向您的 10.4 版本。

如果您将 JAR 文件添加到项目属性并添加了库，那么 NB 可能已经抓取了它在列表中找到的第一个/最后一个 JAR...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T17:34:25.503

嗯，我所要做的就是**手动**将正确的 derby.jar 添加到项目中。
一个简单的复制命令操作：

> cp /opt/Apache/derbyinstall/lib/derby.jar / **path** /to/project/ **dist/lib/**

......完成了工作。问题是：我*从*Netbeans 做了这个操作，*我不知道为什么*，Netbeans 没有更新 jar 文件。奇怪，但固定。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-07-20T03:24:37.157

from the where you locate the derby's bin directory import derby.jar and everything will be ok. and don't forget to lower your derby's driver's jar version

# cron - 在 crontab 中指定“所有奇数值”？

> ID：122483
> 
> 赞同：78
> 
> 时间：2008-09-23T17:32:25.057
> 
> 标签：cron, crontab

在 crontab 中，我可以使用星号来表示每个值，或者使用“*/2”来表示每个偶数值。

有没有办法指定每个**奇**数值？（像“1+*/2”这样的东西有用吗？）

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-09-23T17:35:04.190

根据您的 cron 版本，您应该能够（例如几个小时）：

```
 1-23/2 
```

通过 crontab(5) 联机帮助页中的 EXTENSIONS 部分：

```
 Ranges can include "steps", so "1-9/2" is the same as "1,3,5,7,9". 
```

对于更便携的解决方案，我怀疑您只需要使用简单的列表：

```
 1,3,5,7,9,11,13,15,17,19,21,23 
```

但是将您的命令包装在一个 shell 脚本中可能会更容易，如果它在奇数分钟内没有被调用，它将立即退出。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2011-02-21T21:27:53.387

每一分钟都是：

```
1-59/2 * * * * 
```

每一个偶数分钟都是：

```
0-58/2 * * * * 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T17:34:46.377

尝试

```
1-23/2 
```

根据您的问题，我假设 Vixie Cron。我怀疑这是否适用于任何其他 cron。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-23T17:35:54.907

当我阅读手册时，“1-23/2”（几个小时）就可以了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-07-01T16:41:34.153

我意识到这已经快 10 年了，但是我很难在每两小时的零时工作中获得 1-23/2。

对于所有不需要*精确*奇数小时精度的用户。我做了以下适合我的团队需要的事情。

```
59 */2 * * * 
```

在第 59 分钟每两小时执行一次作业。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-03T08:07:06.633

即使间隔 5 分钟也可以在 Cronie 上工作，例如

```
3-58/5 * * * * /home/test/bin/do_some_thing_every_five_minute 
```

# c# - 数据绑定的 C# 序列化和事件丢失

> ID：122514
> 
> 赞同：3
> 
> 时间：2008-09-23T17:38:05.387
> 
> 标签：c#, data-binding, serialization

我已经在[这里](https://stackoverflow.com/questions/118051/c-grid-binding-not-update)发布了类似的内容，但我想在这里提出更笼统的问题。

您是否尝试序列化实现 INotifyPropertyChanged 的​​对象并将其从序列化中取回并将其绑定到 DataGridView？当我这样做时，我没有从更改的值中刷新（我需要最小化窗口并将其打开）。

你有什么诀窍吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T17:10:36.297

使用`DataContractSerializer`并为 OnDeserialized 创建一个方法

```
[OnDeserialized]
private void OnDeserialized(StreamingContext c) {} 
```

这将让您在反序列化完成时引发 PropertyChanged 事件

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T17:39:19.313

拥有自己的[事件并在序列化后绑定它](https://stackoverflow.com/questions/118051/c-grid-binding-not-update#118438)的技巧有效但并不优雅，因为需要另一个我不想拥有的事件......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T17:51:21.547

当您处理具有内部状态的对象时，序列化接口会变得很棘手。您可以发布您正在谈论的序列化代码的示例吗？

# c# - 为什么 SQL 浮点数与 C# 浮点数不同

> ID：122523
> 
> 赞同：48
> 
> 时间：2008-09-23T17:39:28.363
> 
> 标签：c#, .net, sql, casting, dataset

你好，我从 DataSet 中的 DataTable 中提取了一个 DataRow。我正在访问在 SQL 中定义为浮点数据类型的列。我正在尝试将该值分配给局部变量（c#float 数据类型），但得到一个 InvalidCastExecption

```
DataRow exercise = _exerciseDataSet.Exercise.FindByExerciseID(65);
_AccelLimit = (float)exercise["DefaultAccelLimit"]; 
```

现在，玩弄这个我确实让它工作了，但它没有任何意义，而且感觉不对。

```
_AccelLimit = (float)(double)exercise["DefaultAccelLimit"]; 
```

谁能解释我在这里缺少什么？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-09-23T17:41:20.340

根据[SQLDbType 的文档，](http://msdn.microsoft.com/en-us/library/system.data.sqldbtype.aspx#Mtps_DropDownFilterText) SQL 浮点数是双精度数。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-23T17:49:43.687

SQL 中的浮点数是 CLR (C#/VB) 中的[Double](http://msdn.microsoft.com/en-us/library/system.double.aspx)。MSDN 上有[一个带有 CLR 等效项的 SQL 数据类型表。](http://msdn.microsoft.com/en-us/library/ms131092.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T18:17:12.560

如果您计划对数据执行数学计算，通常您永远不会希望在 SQL Server（或真实）中使用浮点数，因为它是不精确的数据类型，并且会引入计算错误。如果您需要精度，请改用十进制数据类型。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T18:05:48.547

Microsoft SQL Server 中的浮点数相当于 C# 中的 Double。原因是浮点数只能逼近十进制数，浮点数的**精度决定了该数****逼近**十进制数的准确程度。Double 类型表示双精度 64 位浮点数，其值范围从负 1.79769313486232e308 到正 1.79769313486232e308，以及正或负零、PositiveInfinity、NegativeInfinity 和 Not-a-Number (NaN)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-10-08T13:28:51.733

我认为这里已经回答了主要问题，但我觉得有必要为问题的部分添加一些内容，说明这很有效。

> _AccelLimit = (float)(double)exercise["DefaultAccelLimit"];

这个“有效”的原因和它“感觉不对”的原因是你正在通过第二次强制转换（左边的那个）将双精度降级为浮点数，所以你正在失去精度并有效地告诉编译器它可以截断返回的值。

换句话说，这行说明...获取一个对象（在这种情况下恰好包含一个双精度）将对象转换为双精度（丢失所有对象包装）将双精度转换为浮点数（丢失所有精细精度双）

例如，如果值是 0.0124022806089461 并且您执行上述操作，那么 AccelLimit 的值将是 0.01240228

因为这是 c# 中的浮点数可以从双精度值中获得的程度。这是一件危险的事情，我很确定它也是截断而不是四舍五入，但有人可能想确认这一点，因为我不确定。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-10-14T18:58:17.367

它“感觉不对”的原因是因为 C# 使用相同的语法进行*拆箱*和*强制转换*，这是两个非常不同的东西。`exercise["DefaultAccelLimit"]`包含一个双精度值，装箱为一个对象。`(double)`需要将对象*拆箱*回双。前面`(float)`的然后*将*双精度转换为浮点值。C# 不允许在同一操作中进行装箱和强制转换，因此您必须先取消装箱，然后再进行强制转换。

即使演员表是非破坏性的，情况也是如此。如果一个浮点数被装箱为一个你想转换成双精度的对象，你会这样做`(double)(float)object_var`：

# python - 是否有 Eclipse 插件来构建用于分发的 python 可执行文件？

> ID：122524
> 
> 赞同：2
> 
> 时间：2008-09-23T17:39:32.340
> 
> 标签：python, eclipse, bytecode

我想构建一个可执行文件来分发给没有在他们的机器上安装 python 的人。

是否有 Eclipse 的附加组件允许这样做？我找不到一个。

如果没有，您是否有推荐的构建器，可以轻松转到我在 Eclipse 中创建的 python 项目目录并将其捆绑在一起？

谢谢，马克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T17:50:47.617

这不是 Eclipse，但 ActiveState 的[ActivePython FAQ](http://docs.activestate.com/activepython/2.5/faq/windows/index.html#where-is-freeze-for-windows)提到了 freeze 实用程序，听起来它可能接近您的要求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T19:04:16.973

对于 Windows，有[py2exe](http://www.py2exe.org/)项目。

还有[bbfreeze](http://systemexit.de/bbfreeze/README.html)、[PyInstaller](http://pyinstaller.python-hosting.com/)和[py2app](http://www.undefined.org/python/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T21:23:46.187

[看到](https://stackoverflow.com/questions/2933/an-executable-python-app) [这些](https://stackoverflow.com/questions/106725/how-to-bundle-a-python-application-including-dependencies-for-windows) [问题](https://stackoverflow.com/questions/116657/how-do-you-create-an-osx-applicationdmg-from-a-python-package)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-10T05:34:45.790

还有 PyInstaller： [http ://www.pyinstaller.org/](http://www.pyinstaller.org/)

# svn - 如何降级 Subversion 存储库的格式？

> ID：122533
> 
> 赞同：4
> 
> 时间：2008-09-23T17:40:38.593
> 
> 标签：svn

有什么方法可以降低 Subversion 存储库的格式以避免出现这样的消息：

```
svn：存储库的预期格式“3”；找到格式“5”

```

当您从多台机器访问存储库时会发生这种情况，并且您无法在所有这些机器上使用一致的 Subversion 版本。

更糟糕的是，在不同的服务器上有多个不同格式的存储库，我不能随意升级其中的一些服务器。~~~

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T17:54:35.330

如果您不能在所有机器上使用相同版本的 Subversion，那么您应该设置一个服务器进程（svnserve 或 Apache）并仅通过服务器访问存储库。服务器可以在不同版本的 Subversion 之间进行调解；只有当您使用直接存储库访问时才会遇到此问题。

如果服务器将是比当前存储库格式更旧的版本（我不推荐），那么您需要使用较新版本导出存储库并使用旧版本导入它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T14:24:19.167

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T17:43:24.390

我怀疑您必须导出存储库并将其重新导入旧版本。虽然导出格式中可能存在一些格式不兼容 - 但由于它只是一个大文本文件，因此希望将其删除不会太困难。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T17:47:26.097

根据 Subversion 的书，没有办法做到这一点。您必须导出整个存储库，然后在启动并运行旧版本时继续重新导入它。

无论如何，我建议您在客户端机器上相应地升级您的 SVN 工具，而不是在您的存储库中玩危险的游戏。

确定一个版本，在您准备好升级到新版本之前不要碰它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-01T13:17:49.690

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-09-03T14:50:25.787

如果您降级到 v1.4x，这里有另一种可能对您有所帮助的方法： [https ://www.admon.org/scripts/downgrade-svn-from-1-6-to-1-4/](https://www.admon.org/scripts/downgrade-svn-from-1-6-to-1-4/)

# .net - 如何在运行时为类型解析添加额外的逻辑？

> ID：122544
> 
> 赞同：2
> 
> 时间：2008-09-23T17:42:42.160
> 
> 标签：.net, clr, types

是否有一种通用方法，无需创建和管理您自己的 CLR 主机，就可以在找不到该类型时接管定位和加载该类型？

**下面只是一个例子。在您急于成为第一个答案时，不要建议使用新的插件框架或 MEF 作为我的问题的解决方案。**

一个示例是带有加载项的示例。您的应用程序会读取一个文件，其中列出了用于特定功能的类型。该应用程序尝试实例化这些类型。如果它们当前尚未加载到 appdomain 中，则该方法将失败。我正在寻找一个我可以处理的事件或一个我可以提供我自己的实现的组件，这将使我能够优雅地处理这些情况并为加载这些程序集提供额外的逻辑。

* * *

据我所知（除非有人有一个有效的例子）到目前为止提到的 AppDomain 事件都不会在找不到类型时触发。

* * *

等等，显然[这是有效的](http://msdn.microsoft.com/en-us/library/system.appdomain.typeresolve.aspx)！不知道我之前做错了什么，但这个事件很好而且很好。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T17:44:44.853

您可以使用[AppDomain](http://msdn.microsoft.com/en-us/library/system.appdomain_events.aspx)上的事件。

您可能需要[TypeResolve](http://msdn.microsoft.com/en-us/library/system.appdomain.typeresolve.aspx)事件，也可能需要[AssemblyResolve](http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyresolve.aspx)事件。

此外，您可以阅读有关[.net 运行时如何解析程序集](http://msdn.microsoft.com/en-us/library/yx7xezcf.aspx)的更多信息，因此您可以在探测部分定义此信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T17:44:55.383

仅通过使用 AppDomain 事件就不可能吗？

# javascript - 当 IE 的 moveToElementText 吐出 Invalid Argument 异常时该怎么办

> ID：122546
> 
> 赞同：5
> 
> 时间：2008-09-23T17:43:00.787
> 
> 标签：javascript, html, internet-explorer

我们为 Xinha 文本编辑器编写了一个插件来处理脚注。你可以看看： [http ://www.nicholasbs.com/xinha/examples/Newbie.html](http://www.nicholasbs.com/xinha/examples/Newbie.html)

为了处理 Webkit 和 IE 在行尾处理链接的方式的一些问题（没有办法使用光标离开同一行的链接），我们插入一个空白元素并将选择移动到那个，比崩溃对。这在 Webkit 和 Gecko 中运行良好，但由于某种原因 moveToElementText 吐出 Invalid Argument 异常。我们传递给它的元素无关紧要，该功能似乎完全被破坏了。但是，在其他代码路径中，此功能似乎有效。

要使用上面的链接重现错误，请单击主文本输入区域，键入任何内容，然后单击带有绿色加号的黄色页面图标，在灯箱对话框中键入任何内容，然后单击“插入”。导致问题的代码示例如下：

```
 if (Xinha.is_ie)
  {
    var mysel = editor.getSelection();
    var myrange = doc.body.createTextRange();
    myrange.moveToElementText(newel);
  } else
  {
    editor.selectNodeContents(newel, false);
  } 
```

有问题的代码位于 svn 中： [https ://svn.openplans.org/svn/xinha_dev/InsertNote](https://svn.openplans.org/svn/xinha_dev/InsertNote)

这个插件是针对 Xinha 的一个分支构建的，可以从 svn 获得： [http ://svn.xinha.webfactional.com/branches/new-dialogs](http://svn.xinha.webfactional.com/branches/new-dialogs)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T18:35:08.290

它在上面的代码片段中不可见，但 newel 已使用另一个元素附加到 dom，该元素本身附加到 DOM。插入 dom 元素时，如果要引用其兄弟元素，则必须重新检索句柄，因为句柄无效（我不确定，但我认为它指的是文档片段内的 DOM 元素，而不是文档内部的那个。）从插入操作中重新检索句柄后，moveToElementText 停止抛出异常。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T03:01:04.487

在实现 WYSIWYG 编辑器时，我曾多次调试此 IE 异常的不幸经历，它总是由访问 DOM 节点（例如 .parentNode）上的属性或将 DOM 节点传递给函数（例如moveToElementText)，而 DOM 节点当前不在正在呈现的文档中。

正如您所说，有时 DOM 节点是文档片段的一部分，已从浏览器呈现的“实际”DOM 中删除，有时节点还没有被插入。 **无论哪种方式，DOM 节点上的许多属性和方法都无法在 IE6 中安全地访问，除非该节点已正确插入并呈现在“实际”DOM 中。**

真正的问题是，这种 IE6 的“无效参数”异常的表现通常无法通过 try/catch 进行保护。

# project-management - Bugzilla 在管理 Scrum 项目方面表现如何？

> ID：122547
> 
> 赞同：6
> 
> 时间：2008-09-23T17:43:06.060
> 
> 标签：project-management, scrum, bugzilla

我们有 MS Sharepoint——这对于管理任务列表来说还不错。数据是公开的，人们会收到更改和分配的通知。

我认为 Bugzilla 对于管理和报告目的可能会更容易一些。虽然有一些不错的开源 Scrum 管理工具，但我已经用光了很多政治资本，不能要求比我们现在拥有的更多的东西了。金钱不是目标——显然——这是我的团队拥有太多专业工具的想法。

Bugzilla 是否会成为一个更通用的项目管理工具——在错误修复用例之外？

我会非常失望并希望我下载其他东西并为更好的项目管理工具辩护吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-23T17:54:45.797

Bugzilla 是一个很棒的错误跟踪系统。我们曾尝试将其用于其他项目管理任务，但结果并不那么出色。我建议找到一些设计时考虑到你的目标的东西。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T18:14:14.753

自己试试吧。

在 wush.net 上获得一个每月 15 美元的帐户并自己使用一段时间（除了满意的客户之外没有任何业务关系）。

Bugzilla 功能强大并且有很多配置选项，这可能会让人感到困惑。

三年前，我个人在我正在从事的一个项目中使用了它。我没有项目经理，我是开发人员，所以我需要一个开销很小的系统。Bugzilla 给了我这个。我将我的主要目标作为增强“生产化系统”，然后我建立了依赖关系以达到这一点。我最终有 160 个节点都相互依赖。这本质上是一个工作分解结构。我没有费心估算时间，也没有费心创建任何其他类型的项目文档。

一个很酷的优势是，当我编写代码时，如果我发现需要做某事，我只需将其放入 bugzilla（设置完成后需要 20 秒的进程），将其作为依赖项绑定，然后回到我正在做的事情。

每当我完成一项任务时，我都会查看依赖关系图并找到最外层的叶子（阻止其他人但自己没有被阻止的错误），然后处理它。

这种方法对我来说的好处是，如果一个任务看起来很简单并且有一个与之关联的节点，但是当我自己做这件事时，我意识到它更复杂，我会把它分成不同的子任务。这只花了一分钟，而且绝对不涉及与项目经理的会面。

团队中的其他人可以通过查看打开的错误、按日期排序的关闭的错误等来跟踪我的进度。他们看到了行动，他们让我一个人呆着。当我有外部依赖时，我会做一个错误，详细说明工作，并通过电子邮件向那个人发送一个链接。然后他们可以通过查看依赖关系图来了解为什么需要这样做。

请注意，除非事先达成一致，否则我不会将错误分配给他们。

它运行得非常好，系统提前一个月准备就绪。

它将如何与 SCRUM 一起工作？我只是粗略地看了一眼 scrum，我不能告诉你。但那是我的经验。

使用专用主机将为您带来三件事：

*   支持
*   轻松升级（除非您有内部专家，否则 bugzilla 管理并不容易——至少对我而言）
*   跨组织边界的用户。

请注意，bugzilla 具有各种安全功能，因此很容易将用户锁定到他们需要查看的内容。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-12-16T22:44:46.797

My stand-alone solution is DokuWiki + MantisBT + Subversion + Review Board, which can be integrated with relative ease. Hosted alternative is Bitbucket.org. The rationale is you write user stories on Wiki and can reference them specific tasks. Larger bugs can be collaboratively designed and the "wiki" link is provided on the bug report by Mantis. Review board lets you do peer code reviews against svn diff before change is committed.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-23T17:55:58.463

我们已经在几个项目中非常成功地使用了 Trac 和 Subversion。

这里的主要优势是能够定制报告，一些非常特定于 Scrum，以向管理层提供信息。

# java - 何时使用 Hibernate/JPA/Toplink？

> ID：122571
> 
> 赞同：7
> 
> 时间：2008-09-23T17:46:37.860
> 
> 标签：java, hibernate, orm, jpa, toplink

现在我正在制作一个非常简单的网站——大约 5 页。问题是集成某种数据库映射解决方案是否过于矫枉过正并且值得花时间，或者是否最好只使用普通的旧 JNDI。我可能需要从数据库中读取/写入十几个东西。我想我对这些技术有基本的了解，但仍然需要大量参考文档。其他人之前面临过这个决定吗？

编辑：对不起，我应该指定 JNDI 来查找数据库连接和 JDBC 来执行操作。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-23T18:37:28.050

简短回答：这取决于您要支持的复杂性。

长答案：

首先，ORM（对象关系映射——你称之为数据库映射）和 JNDI（Java 命名和目录接口）是两个不同的东西。

如您所知，第一个用于将数据库表映射到类和对象。二是提供资源查找机制，可以是DataSources、Ejb、Queues等。

也许你的意思是“JDBC”。

现在至于您的问题：如果就这么简单，可能就没有必要实现 ORM。数字表最多约为 5 - 10，我猜操作非常简单。

可能使用普通的 JDBC 就足够了。

如果您使用 DAO 模式，您可以稍后根据需要对其进行更改以支持 ORM 策略。

像这样：假设你有 Employee 表

您使用数据库的所有字段手动创建 Employee.java（它不应该花费太长时间）和一个具有以下方法的 EmployeeDaO.java：

```
+findById( id ): Employee
+insert( Employee ) 
+update( Employee )
+delete( Employee ) 
+findAll():List<Employee> 
```

实现非常简单：

```
select * from employee where id = ?
insert into employee ( bla, bla, bla ) values ( ? , ? , ? )
update etc. etc 
```

当（和如果）您的应用程序变得过于复杂时，您可能会更改 DAO 实现。例如，在“选择”方法中，您更改代码以使用执行操作的 ORM 对象。

```
public Employee selectById( int id ) {
      // Commenting out the previous implementation...
      // String query = select * from employee where id = ? 
      // execute( query )  

      // Using the ORM solution

       Session session = getSession();
       Employee e = ( Employee ) session.get( Employee.clas, id );
       return e;
} 
```

这只是一个例子，在现实生活中你可以让抽象工厂创建 ORM DAO，但那是题外话。关键是您可以从简单开始，通过使用设计模式，您可以在以后根据需要更改实现。

当然，如果您想学习这项技术，您甚至可以从一张桌子开始。

选择一种或另一种（即 ORM 解决方案）基本上取决于您使用的技术。例如，对于 JBoss 或其他开源产品，Hibernate 非常棒。它是开源的，有很多资源可以学习。但是，如果您正在使用已经具有 Toplink 的东西（例如 oracle 应用程序服务器），或者如果基础已经构建在 Toplink 上，您应该继续使用该框架。

顺便说一句，自从甲骨文收购了 BEA，他们说他们正在用现在称为“甲骨文 Weblogic 应用服务器”的 toplink 替换 Kodo（weblogic 持久性框架）。

我给你留下了一些资源，你可以在其中获得更多信息：

* * *

在这本“企业应用程序架构的模式”一书中，Martin Fowler 解释了在哪里使用一个或另一个，这里是目录。看看数据源架构模式与对象关系行为模式：

[PEAA 目录](http://martinfowler.com/eaaCatalog/index.html)

* * *

DAO（数据访问对象）是核心 J2EE 模式目录的一部分：

[DAO 模式](http://java.sun.com/blueprints/corej2eepatterns/Patterns/DataAccessObject.html)

* * *

这是 Hibernate 的入门教程：

[休眠](http://hibernate.org/152.html)

* * *

Toplink官方页面：

[顶联](http://www.oracle.com/technology/products/ias/toplink/index.html)

* * *

最后，我“认为”JPA 的好处是您最近可能会更换提供者。

从简单开始，然后发展。

我希望这有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T18:10:16.370

对于一个非常简单的应用程序来说，这似乎有点过头了，特别是如果你没有计划扩展它的话。但是，将它们与这个简单的应用程序一起使用似乎也是值得的，这样您就可以更好地了解它们是如何工作的，以便下次您有可以使用它们的东西时。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:14:54.860

你的意思是普通的旧 JDBC 吗？一个小项目可能是学习其中一个 ORM 框架的好机会，特别是如果你有时间的话。

然而，如果没有更多信息，很难以一种或另一种方式提供推荐。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T21:36:08.497

我的经验法则是，如果它是只读的，我愿意在 JDBC 中进行，尽管我更喜欢使用带有 SQLQuery 的空 Hibernate 项目来利用 Hibernate 的类型映射。一旦我必须进行写入，我就会使用 Hibernate，因为设置一些属性然后调用 save 比单独设置每一列要容易得多。当您必须开始优化以避免更新未更改的对象时，最好使用 OR/M 及其脏检查。处理外键关系是您需要映射一次然后使用 getter 的另一个标志。相同的逻辑也适用于 Toplink，尽管除非他们在我使用它的 3 年内添加了类似 HQL 的东西，否则 Hibernate 对于这种从纯 SQL 的过渡会好得多。请记住，你不 不必映射每个对象/表，只需映射具有明显优势的对象/表。根据我的经验，大多数不使用现有 OR/M 的项目最终都会构建一个新的，这是一个坏主意。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T02:20:30.857

学习 ORM的**最好**方法是在一个小项目上。开始这个项目。

一旦你掌握了它的窍门，你就会对一切使用 ORM。

对于 ORM 来说，没有什么太小了。在你的前几个项目之后，你会发现你不能以任何其他方式工作。ORM 映射通常比几乎任何其他工作方式更有意义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-11-22T20:19:23.733

在这里查看各种 toplink 指南，它们有介绍、示例、场景等

[http://docs.oracle.com/cd/E14571_01/web.1111/b32441/toc.htm](http://docs.oracle.com/cd/E14571_01/web.1111/b32441/toc.htm)

# gis - 具有纬度/经度 SRID 的 PostGIS 中的真实（大圆）距离？

> ID：122582
> 
> 赞同：6
> 
> 时间：2008-09-23T17:49:26.310
> 
> 标签：gis, postgis

我在我的 PostGIS 数据库 (-4326) 中使用 lat/long SRID。我想以有效的方式找到离给定点最近的点。我试着做一个

```
ORDER BY    ST_Distance(point, ST_GeomFromText(?,-4326)) 
```

这在较低的 48 个州给了我好的结果，但在阿拉斯加它给了我垃圾。有没有办法在 PostGIS 中进行实际距离计算，还是我必须提供一个合理大小的缓冲区，然后计算大圆距离，然后在代码中对结果进行排序？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-23T20:37:13.287

您正在寻找 ST_distance_sphere(point,point) 或 st_distance_spheroid(point,point)。

看：

[http://postgis.refractions.net/documentation/manual-1.3/ch06.html#distance_sphere](http://postgis.refractions.net/documentation/manual-1.3/ch06.html#distance_sphere) [http://postgis.refractions.net/documentation/manual-1.3/ch06.html#distance_spheroid](http://postgis.refractions.net/documentation/manual-1.3/ch06.html#distance_spheroid)

这通常被称为测地线或测地线距离......虽然这两个术语的含义略有不同，但它们往往可以互换使用。

或者，您可以投影数据并使用标准 st_distance 函数......这仅适用于短距离（使用 UTM 或状态平面）或所有距离都相对于一个或两个点（等距投影）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-02-08T03:34:44.810

PostGIS 1.5 使用经纬度和米来处理真实的地球距离。它知道纬度/经度本质上是有角度的，并且有 360 度线

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T19:17:03.713

这是来自 SQL Server，我使用 Haversine 的距离可能会受到阿拉斯加问题的影响（可能会偏离一英里）：

```
ALTER function [dbo].[getCoordinateDistance]
    (
    @Latitude1  decimal(16,12),
    @Longitude1 decimal(16,12),
    @Latitude2  decimal(16,12),
    @Longitude2 decimal(16,12)
    )
returns decimal(16,12)
as
/*
fUNCTION: getCoordinateDistance

    Computes the Great Circle distance in kilometers
    between two points on the Earth using the
    Haversine formula distance calculation.

Input Parameters:
    @Longitude1 - Longitude in degrees of point 1
    @Latitude1  - Latitude  in degrees of point 1
    @Longitude2 - Longitude in degrees of point 2
    @Latitude2  - Latitude  in degrees of point 2

*/
begin
declare @radius decimal(16,12)

declare @lon1  decimal(16,12)
declare @lon2  decimal(16,12)
declare @lat1  decimal(16,12)
declare @lat2  decimal(16,12)

declare @a decimal(16,12)
declare @distance decimal(16,12)

-- Sets average radius of Earth in Kilometers
set @radius = 6366.70701949371

-- Convert degrees to radians
set @lon1 = radians( @Longitude1 )
set @lon2 = radians( @Longitude2 )
set @lat1 = radians( @Latitude1 )
set @lat2 = radians( @Latitude2 )

set @a = sqrt(square(sin((@lat2-@lat1)/2.0E)) + 
    (cos(@lat1) * cos(@lat2) * square(sin((@lon2-@lon1)/2.0E))) )

set @distance =
    @radius * ( 2.0E *asin(case when 1.0E < @a then 1.0E else @a end ) )

return @distance

end 
```

Vicenty 很慢，但精确到 1 毫米以内（我只找到了它的 javascript imp）：

```
/*
 * Calculate geodesic distance (in m) between two points specified by latitude/longitude (in numeric degrees)
 * using Vincenty inverse formula for ellipsoids
 */
function distVincenty(lat1, lon1, lat2, lon2) {
  var a = 6378137, b = 6356752.3142,  f = 1/298.257223563;  // WGS-84 ellipsiod
  var L = (lon2-lon1).toRad();
  var U1 = Math.atan((1-f) * Math.tan(lat1.toRad()));
  var U2 = Math.atan((1-f) * Math.tan(lat2.toRad()));
  var sinU1 = Math.sin(U1), cosU1 = Math.cos(U1);
  var sinU2 = Math.sin(U2), cosU2 = Math.cos(U2);

  var lambda = L, lambdaP = 2*Math.PI;
  var iterLimit = 20;
  while (Math.abs(lambda-lambdaP) > 1e-12 && --iterLimit>0) {
    var sinLambda = Math.sin(lambda), cosLambda = Math.cos(lambda);
    var sinSigma = Math.sqrt((cosU2*sinLambda) * (cosU2*sinLambda) + 
      (cosU1*sinU2-sinU1*cosU2*cosLambda) * (cosU1*sinU2-sinU1*cosU2*cosLambda));
    if (sinSigma==0) return 0;  // co-incident points
    var cosSigma = sinU1*sinU2 + cosU1*cosU2*cosLambda;
    var sigma = Math.atan2(sinSigma, cosSigma);
    var sinAlpha = cosU1 * cosU2 * sinLambda / sinSigma;
    var cosSqAlpha = 1 - sinAlpha*sinAlpha;
    var cos2SigmaM = cosSigma - 2*sinU1*sinU2/cosSqAlpha;
    if (isNaN(cos2SigmaM)) cos2SigmaM = 0;  // equatorial line: cosSqAlpha=0 (§6)
    var C = f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha));
    lambdaP = lambda;
    lambda = L + (1-C) * f * sinAlpha *
      (sigma + C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)));
  }
  if (iterLimit==0) return NaN  // formula failed to converge

  var uSq = cosSqAlpha * (a*a - b*b) / (b*b);
  var A = 1 + uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));
  var B = uSq/1024 * (256+uSq*(-128+uSq*(74-47*uSq)));
  var deltaSigma = B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-
    B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM)));
  var s = b*A*(sigma-deltaSigma);

  s = s.toFixed(3); // round to 1mm precision
  return s;
} 
```

# ms-access - Microsoft Jet 的 64 位替代方案

> ID：122583
> 
> 赞同：3
> 
> 时间：2008-09-23T17:49:37.527
> 
> 标签：ms-access, 64-bit

Microsoft 选择不发布 Jet 的 64 位版本，这是他们的 Access 数据库驱动程序。有谁知道一个好的选择？

以下是我需要的 Jet 支持的特定功能：

*   多个用户可以通过网络连接到数据库。
*   用户可以在数据库打开时使用 Windows 资源管理器复制数据库，而不会造成损坏。Access 目前以足够的可靠性来满足我的客户的需求。
*   在不需要 .Net 的情况下在 C++ 中运行良好。

我认为我认为行不通的替代方案（尽管我的理解可能不正确）：

*   SQLite：如果多个用户通过网络连接到数据库，它将被损坏。
*   Firebird：复制正在使用的数据库可能会损坏原始数据库。
*   SQL Server：正在使用的文件被锁定，无法复制。
*   VistaDB：这似乎是特定于 .Net 的。
*   在 32 位中编译并使用 WOW64：还有另一个依赖项要求我们在 64 位中编译，即使我们不使用任何 64 位功能。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-06-15T21:50:31.020

幸运的是，过去两年情况发生了变化：

由于 Office 2010 有 64 位版本，Microsoft 必须创建 Jet Engine 的 64 位版本。根据[Microsoft 客户服务博客](https://docs.microsoft.com/en-us/archive/blogs/psssql/how-to-get-a-x64-version-of-jet)，[Microsoft Access 数据库引擎 2010 Redistributable](https://www.microsoft.com/en-us/download/details.aspx?id=13255)包含一个 64 位驱动程序，它能够访问 Microsoft Access 数据库格式的最新版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T18:31:03.993

*   用户可以在数据库打开时复制数据库，而不会有损坏的风险。

您不能对*任何*具有多个用户和/或修改它的进程的数据库文件执行此操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T17:50:54.763

您正在寻找的是带有可移植 .mdf 文件的 SQL Server Express。要绕过复制限制，您需要确保相关软件不会保持连接打开（即创建断开连接的数据访问层）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T17:53:11.543

试着看看[http://www.vistadb.net/](http://www.vistadb.net/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T17:58:55.477

@Orion：同意，建议 OP 使用 SQL 2005 Express（如果可能）。交易破坏者能够在使用/附加时复制数据库，这对于 SQL 来说是不可能的，而无需使用某种可以复制“使用中”文件的备份工具。

另一种方法是自动备份和恢复到漫游机器，但这距离仅获取文件副本还有很长的路要走。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T18:25:14.757

您可以查看的另一个替代方案是 SQL Server Compact Edition (CE)。我相信这有 64 位二进制文​​件。

我也同意 Orion 和 Kev 关于复制数据库的观点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T01:50:59.943

我要做的是创建一个单独的 32 位可执行文件，它连接到 Jet，我的 64 位应用程序可以通过 COM 与之通信。

这满足了我对“像 Jet 一样工作”的一般要求，因为它是 Jet。我的客户没有获得 64 位的好处，但其他要求更为重要。

# c# - ASP.NET：未找到 ICollection 构造函数？

> ID：122589
> 
> 赞同：0
> 
> 时间：2008-09-23T17:50:45.293
> 
> 标签：c#, asp.net

我有一个在远程 Web 服务器上运行的 ASP.NET 应用程序，我刚刚开始收到此错误。我似乎无法在我的开发环境中重现它：

```
Method not found: 'Void System.Collections.Generic.ICollection`1..ctor()'. 
```

这可能是由于 .NET Framework 或 IIS 6 的一些错误配置造成的吗？

更新：我反汇编了 DLL 中的代码，似乎编译器错误地优化了代码。（请注意，Set 是一个实现一组唯一对象的类。它继承自 IEnumerable。）这一行：

```
Set<int> set = new Set<int>(); 
```

编译成这一行：

```
Set<int> set = (Set<int>) new ICollection<CalendarModule>(); 
```

日历类是一个完全不相关的类！！以前有没有人注意到 .NET 错误地编译了这样的代码？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T17:53:36.767

两个系统上的 .NET 版本是否相同？相同的服务包？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T17:53:19.873

您的 IIS 设置是否使用 .NET 2.0？如果没有，请将其更改为 2.0。如果您在列表中看不到 2.0，那么您需要从 2.0 框架目录运行 aspnet_regiis。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T18:15:09.450

这是由 aspnet 合并工具中的错误引起的，该错误错误地合并了优化的程序集。它可以通过不合并程序集或不优化它们来解决。

# java - 从 JSP 抛出异常

> ID：122593
> 
> 赞同：4
> 
> 时间：2008-09-23T17:51:04.200
> 
> 标签：java, exception, jsp

是否可以在不使用 scriptlet 代码的情况下在 JSP 中引发异常？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-23T17:59:23.260

你真的不应该在 JSP 层做任何明确抛出异常的事情。您不想在 JSP 中使用 scriptlet 的原因是因为这会将应用程序逻辑置于您的视图中。抛出异常本质上是应用程序逻辑，因此它不属于您的 JSP，无论是否属于 scriptlet。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T17:54:17.953

如果你这样做，你可以抛出一个异常：

```
<c:out value="${1/0}" /> 
```

或类似“非法”的东西

但理想情况下，由于 JSP 与视图相关联……您不想抛出异常。你想抓住他们`<c:catch>`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T17:58:06.693

您可以拥有一个带有 getter 方法的 bean，该方法抛出代码，然后让 JSP 访问 bean 属性。我不确定这是否是对 scriptlet 的实际改进。

# nlp - NLP：定性“正面”与“负面”句子

> ID：122595
> 
> 赞同：13
> 
> 时间：2008-09-23T17:51:47.707
> 
> 标签：nlp, text-analysis

我需要您的帮助来确定分析“正面”与“负面”行业特定句子（即电影评论）的最佳方法。我以前见过诸如 OpenNLP 之类的库，但它太低级了——它只是给了我基本的句子组成；我需要的是一个更高级别的结构： - 希望有单词列表 - 希望可以在我的数据集上训练

谢谢！

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-24T10:22:13.177

您要查找的内容通常称为[情绪分析](http://en.wikipedia.org/wiki/Sentiment_analysis)。通常，情绪分析无法处理微妙的微妙之处，例如讽刺或讽刺，但如果您向其投入大量数据，它的表现会非常好。

情感分析通常需要相当多的预处理。至少标记化、句子边界检测和词性标注。有时，句法解析可能很重要。正确地做到这一点是计算语言学研究的一个完整分支，除非你花时间先研究这个领域，否则我不会建议你提出自己的解决方案。

OpenNLP 有一些工具可以帮助进行情绪分析，但是如果你想要更严肃的东西，你应该研究一下[LingPipe](http://alias-i.com/lingpipe)工具包。它有一些内置的 SA 功能和一个不错的[教程](http://alias-i.com/lingpipe/demos/tutorial/sentiment/read-me.html)。您可以根据自己的数据集对其进行训练，但不要认为这完全是微不足道的 :-)。

谷歌搜索该术语可能还会为您提供一些资源来使用。如果您有任何更具体的问题，请问，我正在密切关注 nlp-tag ;-)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-24T21:38:26.483

一些情感分析方法使用在其他文本分类任务中流行的策略。最常见的是将您的电影评论转换为词向量，并将其作为训练数据输入分类算法。最流行的数据挖掘包可以在这里为您提供帮助。您可以查看本[关于情绪分类的教程](http://kmandcomputing.blogspot.com/2008/06/opinion-mining-with-rapidminer-quick.html)，该教程说明了如何使用开源[RapidMiner 工具包](http://rapid-i.com/content/blogcategory/38/69/)进行实验。

顺便说一句，有一个[很好的数据集](http://www.cs.cornell.edu/People/pabo/movie-review-data/)可用于与检测电影评论意见相关的研究目的。它基于 IMDB 用户评论，您可以查看该领域的许多[相关研究工作](http://www.cs.cornell.edu/People/pabo/movie-review-data/otherexperiments.html)以及他们如何使用数据集。

值得记住的是，这些方法的有效性只能从统计的角度来判断，所以你几乎可以假设会有错误分类和意见难以察觉的情况。正如在这个线程中已经注意到的那样，检测讽刺和讽刺之类的东西确实非常困难。

# web-services - 如何从 VB6 使用 Web 服务？

> ID：122607
> 
> 赞同：15
> 
> 时间：2008-09-23T17:54:11.760
> 
> 标签：web-services, deployment, vb6, soap

我需要从我的 VB6 程序中使用外部 Web 服务。如果可能的话，我希望能够在没有 SOAP 工具包的情况下部署我的程序，但这不是必需的。我没有 Web 服务源，也没有创建它。它是供应商提供的服务。

那么在 SOAP 工具包之外，从 VB6 使用 Web 服务的最佳方式是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-23T19:39:43.253

我使用此函数从 Web 服务获取数据。

```
Private Function HttpGetRequest(url As String) As DOMDocument
    Dim req As XMLHTTP60
    Set req = New XMLHTTP60
    req.Open "GET", url, False
    req.send ""

    Dim resp As DOMDocument
    If req.responseText <> vbNullString Then
        Set resp = New DOMDocument60
        resp.loadXML req.responseText
    Else
        Set resp = req.responseXML
    End If
    Set HttpGetRequest = resp
End Function 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T18:06:15.677

.NET 从一开始就对 Web 服务有很好的支持，因此您可以在 .NET 中将 Web 服务客户端逻辑开发为 .dll 库/程序集，并通过 COM Interop 在 VB6 应用程序中使用它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T18:01:19.073

假设您在 Windows XP Professional 或更高版本上运行，一种有趣的方法是使用 SOAP 名字对象。这是一个示例，取自一些 MSDN 页面。我不知道这个特定的服务是否有效，但你明白了......

```
 set SoapObj = GetObject
       ("soap:wsdl=http://www.xmethods.net/sd/TemperatureService.wsdl")
   WScript.Echo "Fairbanks Temperature = " & SoapObj.getTemp("99707") 
```

这种机制也适用于 VBScript。这很好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T21:43:02.177

[Pocketsoap](http://www.pocketsoap.com/)工作得很好。要生成您的对象，请使用[WSDL 生成器](http://www.pocketsoap.com/wsdl/)。使用它你不必自己解析任何东西，而且一切都很好并且是强类型的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-22T23:28:12.473

查看 Scott Swigart 在 MSDN VB 6.0 资源中心的这篇文章。

[从 Visual Basic 6 调用 Web 服务，简单的方法](http://msdn.microsoft.com/en-us/library/aa730836.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-31T19:57:06.223

到目前为止，我已经使用 PocketSOAP 连接到 Salesforce API 取得了一定程度的成功。我无法使用 WSDL 向导，因为它使用调用名称的前 23 个字符生成包装类文件名，这会导致重复。尽管如此，PocketSOAP 在没有向导的情况下对我来说已经足够好了，而且它比将 XMLHTTP 与 DOMDocument 一起使用要简单得多。

我还研究了在 .NET 中制作包装器或使用“MS Office {MSO 版本} Web 服务工具包”库之一，但这些选项存在很大的部署麻烦。PocketSOAP 是一个简单的 COM DLL，不依赖于某些特定版本的 MS Office，并在 MPL 下获得许可。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T17:58:49.890

SOAP 工具包可以说是你能得到的最好的。在没有它的情况下尝试做同样的事情将需要相当大的额外努力。你需要有非常严肃的理由才能这样做。

SOAP 消息的格式很难手动读取或写入，强烈建议使用第三方库。

# .net - 是否有与 Perl 的 LWP / WWW::Mechanize 等效的 .NET？

> ID：122614
> 
> 赞同：5
> 
> 时间：2008-09-23T17:56:46.417
> 
> 标签：.net, html, forms, web-crawler

在使用 .NET 的`HttpWebRequest`/`Response`对象之后，我宁愿自己开枪也不愿用它来爬取网站。我正在寻找一个现有的 .NET 库，它可以获取 URL，并让您能够跟踪链接、提取/填写/提交页面上的表单等。Perl`LWP`和`WWW::Mechanize`模块做得很好，但我正在工作使用 .NET 项目。

我遇到了[HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)，它看起来很棒，但它没有模拟链接/表单。

这样的工具是否已经存在？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T19:08:40.613

有人构建了一些代码作为 HTML Agility Pack（我也很喜欢）的插件运行，它允许您进行一些表单修补：

[http://apps.ultravioletconsulting.com/projects/uvcwebtransform/docs/class_html_agility_pack_1_1_add_ons_1_1_form_processor_1_1_form_processor.html](http://apps.ultravioletconsulting.com/projects/uvcwebtransform/docs/class_html_agility_pack_1_1_add_ons_1_1_form_processor_1_1_form_processor.html)

我读过一篇评论说它不是 WWW::Mechanize，但这是一个很好的开始。提供了代码，因此您可以轻松扩展它。

# asp.net - ASP.Net 网站无法编译，但仍然可以工作？

> ID：122615
> 
> 赞同：1
> 
> 时间：2008-09-23T17:57:02.250
> 
> 标签：asp.net, visual-studio, debugging, dotnetnuke

我有一个 ASP.Net 2.0 网站，使用 DotNetNuke 框架 (4.09)，它不会编译，但是当我在浏览器中点击该网站时，它可以工作。即使不编译的部分也可以工作。当 Visual Studio 不能时，IIS 是如何编译和运行这个站点的？两个地方的一切都是一样的......我将整个网站从远程服务器复制到我的本地机器上，然后我以同样的方式在 IIS 中设置它。在我的本地计算机上，Visual Studio 无法编译该站点，但它仍然可以运行。这怎么可能？

具体错误并不重要，因为站点的每个可能部分都有 189 个错误。我不是要修复错误……我想知道的是，无论错误如何，Web 服务器都可以运行该站点。请注意我写的内容 - 两个地方的一切都完全相同。没有丢失的 DLL，没有不同的配置，机器本身没有任何内容……请记住，该站点在我的本地机器上运行良好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T17:59:00.313

这是一个网站还是一个网络应用程序？如果它是一个 Web 应用程序，您可能仍在使用垃圾箱中最后成功构建的位。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T17:58:44.680

该站点正在使用旧的 dll，或者您的本地版本中可能缺少服务器可以正常使用的引用。

正如 Mitchel 所说，我们需要先查看错误，然后才能真正回答您的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T17:57:45.837

为了给你一个答案，我们需要知道错误是什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:07:48.480

您的本地计算机缓存了“工作”副本并且可能正在使用它？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-07T00:44:43.367

该站点在远程服务器上运行时曾一度成功编译。因此，将其复制到本地计算机并访问本地站点也可以。但是，您无法在本地计算机上重新编译它可能有多种原因，包括：缺少参考、web.config 条目、第三方控制许可等。

我知道您并没有尝试纠正 189 错误，但是错误列表中的线索（如果没有答案）将使您朝着正确的方向前进。

# c - 如何以标准方式修剪前导/尾随空格？

> ID：122616
> 
> 赞同：193
> 
> 时间：2008-09-23T17:57:15.043
> 
> 标签：c, string, whitespace, trim

是否有一种干净的，最好是标准的方法从 C 中的字符串中修剪前导和尾随空格？我会自己动手，但我认为这是一个同样常见的解决方案的常见问题。

* * *

## 回答 #1

> 赞同：186
> 
> 时间：2008-09-23T18:12:32.883

如果可以修改字符串：

```
// Note: This function returns a pointer to a substring of the original string.
// If the given string was allocated dynamically, the caller must not overwrite
// that pointer with the returned value, since the original pointer must be
// deallocated using the same allocator with which it was allocated.  The return
// value must NOT be deallocated using free() etc.
char *trimwhitespace(char *str)
{
  char *end;

  // Trim leading space
  while(isspace((unsigned char)*str)) str++;

  if(*str == 0)  // All spaces?
    return str;

  // Trim trailing space
  end = str + strlen(str) - 1;
  while(end > str && isspace((unsigned char)*end)) end--;

  // Write new null terminator character
  end[1] = '\0';

  return str;
} 
```

如果你不能修改字符串，那么你可以使用基本相同的方法：

```
// Stores the trimmed input string into the given output buffer, which must be
// large enough to store the result.  If it is too small, the output is
// truncated.
size_t trimwhitespace(char *out, size_t len, const char *str)
{
  if(len == 0)
    return 0;

  const char *end;
  size_t out_size;

  // Trim leading space
  while(isspace((unsigned char)*str)) str++;

  if(*str == 0)  // All spaces?
  {
    *out = 0;
    return 1;
  }

  // Trim trailing space
  end = str + strlen(str) - 1;
  while(end > str && isspace((unsigned char)*end)) end--;
  end++;

  // Set output size to minimum of trimmed string length and buffer size minus 1
  out_size = (end - str) < len-1 ? (end - str) : len-1;

  // Copy trimmed string and add null terminator
  memcpy(out, str, out_size);
  out[out_size] = 0;

  return out_size;
} 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-09-23T18:48:09.787

这是将字符串移动到缓冲区的第一个位置的方法。您可能需要这种行为，以便如果您动态分配字符串，您仍然可以在 trim() 返回的同一指针上释放它：

```
char *trim(char *str)
{
    size_t len = 0;
    char *frontp = str;
    char *endp = NULL;

    if( str == NULL ) { return NULL; }
    if( str[0] == '\0' ) { return str; }

    len = strlen(str);
    endp = str + len;

    /* Move the front and back pointers to address the first non-whitespace
     * characters from each end.
     */
    while( isspace((unsigned char) *frontp) ) { ++frontp; }
    if( endp != frontp )
    {
        while( isspace((unsigned char) *(--endp)) && endp != frontp ) {}
    }

    if( frontp != str && endp == frontp )
            *str = '\0';
    else if( str + len - 1 != endp )
            *(endp + 1) = '\0';

    /* Shift the string so that it starts at str so that if it's dynamically
     * allocated, we can still free it on the returned pointer.  Note the reuse
     * of endp to mean the front of the string buffer now.
     */
    endp = str;
    if( frontp != str )
    {
            while( *frontp ) { *endp++ = *frontp++; }
            *endp = '\0';
    }

    return str;
} 
```

测试正确性：

```
#include <stdio.h>
#include <string.h>
#include <ctype.h>

/* Paste function from above here. */

int main()
{
    /* The test prints the following:
    [nothing to trim] -> [nothing to trim]
    [    trim the front] -> [trim the front]
    [trim the back     ] -> [trim the back]
    [    trim front and back     ] -> [trim front and back]
    [ trim one char front and back ] -> [trim one char front and back]
    [ trim one char front] -> [trim one char front]
    [trim one char back ] -> [trim one char back]
    [                   ] -> []
    [ ] -> []
    [a] -> [a]
    [] -> []
    */

    char *sample_strings[] =
    {
            "nothing to trim",
            "    trim the front",
            "trim the back     ",
            "    trim front and back     ",
            " trim one char front and back ",
            " trim one char front",
            "trim one char back ",
            "                   ",
            " ",
            "a",
            "",
            NULL
    };
    char test_buffer[64];
    char comparison_buffer[64];
    size_t index, compare_pos;

    for( index = 0; sample_strings[index] != NULL; ++index )
    {
        // Fill buffer with known value to verify we do not write past the end of the string.
        memset( test_buffer, 0xCC, sizeof(test_buffer) );
        strcpy( test_buffer, sample_strings[index] );
        memcpy( comparison_buffer, test_buffer, sizeof(comparison_buffer));

        printf("[%s] -> [%s]\n", sample_strings[index],
                                 trim(test_buffer));

        for( compare_pos = strlen(comparison_buffer);
             compare_pos < sizeof(comparison_buffer);
             ++compare_pos )
        {
            if( test_buffer[compare_pos] != comparison_buffer[compare_pos] )
            {
                printf("Unexpected change to buffer @ index %u: %02x (expected %02x)\n",
                    compare_pos, (unsigned char) test_buffer[compare_pos], (unsigned char) comparison_buffer[compare_pos]);
            }
        }
    }

    return 0;
} 
```

源文件是 trim.c。使用“cc -Wall tr​​im.c -o trim”编译。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-09-23T20:42:16.037

我的解决方案。字符串必须是可变的。其他一些解决方案的优势在于它将非空格部分移动到开头，因此您可以继续使用旧指针，以防您以后必须 free() 它。

```
void trim(char * s) {
    char * p = s;
    int l = strlen(p);

    while(isspace(p[l - 1])) p[--l] = 0;
    while(* p && isspace(* p)) ++p, --l;

    memmove(s, p, l + 1);
} 
```

此版本使用 strndup() 创建字符串的副本，而不是就地编辑它。strndup() 需要 _GNU_SOURCE，所以也许你需要用 malloc() 和 strncpy() 制作自己的 strndup()。

```
char * trim(char * s) {
    int l = strlen(s);

    while(isspace(s[l - 1])) --l;
    while(* s && isspace(* s)) ++s, --l;

    return strndup(s, l);
} 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-06-15T04:34:02.660

这是我的 C 迷你库，用于修剪左、右、两者、全部、就地和单独，并修剪一组指定的字符（或默认情况下的空白）。

## **strlib.h 的内容：**

```
#ifndef STRLIB_H_
#define STRLIB_H_ 1
enum strtrim_mode_t {
    STRLIB_MODE_ALL       = 0, 
    STRLIB_MODE_RIGHT     = 0x01, 
    STRLIB_MODE_LEFT      = 0x02, 
    STRLIB_MODE_BOTH      = 0x03
};

char *strcpytrim(char *d, // destination
                 char *s, // source
                 int mode,
                 char *delim
                 );

char *strtriml(char *d, char *s);
char *strtrimr(char *d, char *s);
char *strtrim(char *d, char *s); 
char *strkill(char *d, char *s);

char *triml(char *s);
char *trimr(char *s);
char *trim(char *s);
char *kill(char *s);
#endif 
```

## strlib.c 的内容：

```
#include <strlib.h>

char *strcpytrim(char *d, // destination
                 char *s, // source
                 int mode,
                 char *delim
                 ) {
    char *o = d; // save orig
    char *e = 0; // end space ptr.
    char dtab[256] = {0};
    if (!s || !d) return 0;

    if (!delim) delim = " \t\n\f";
    while (*delim) 
        dtab[*delim++] = 1;

    while ( (*d = *s++) != 0 ) { 
        if (!dtab[0xFF & (unsigned int)*d]) { // Not a match char
            e = 0;       // Reset end pointer
        } else {
            if (!e) e = d;  // Found first match.

            if ( mode == STRLIB_MODE_ALL || ((mode != STRLIB_MODE_RIGHT) && (d == o)) ) 
                continue;
        }
        d++;
    }
    if (mode != STRLIB_MODE_LEFT && e) { // for everything but trim_left, delete trailing matches.
        *e = 0;
    }
    return o;
}

// perhaps these could be inlined in strlib.h
char *strtriml(char *d, char *s) { return strcpytrim(d, s, STRLIB_MODE_LEFT, 0); }
char *strtrimr(char *d, char *s) { return strcpytrim(d, s, STRLIB_MODE_RIGHT, 0); }
char *strtrim(char *d, char *s) { return strcpytrim(d, s, STRLIB_MODE_BOTH, 0); }
char *strkill(char *d, char *s) { return strcpytrim(d, s, STRLIB_MODE_ALL, 0); }

char *triml(char *s) { return strcpytrim(s, s, STRLIB_MODE_LEFT, 0); }
char *trimr(char *s) { return strcpytrim(s, s, STRLIB_MODE_RIGHT, 0); }
char *trim(char *s) { return strcpytrim(s, s, STRLIB_MODE_BOTH, 0); }
char *kill(char *s) { return strcpytrim(s, s, STRLIB_MODE_ALL, 0); } 
```

一个主要程序可以完成所有工作。*如果src* == *dst* ，它将就地修剪，否则，它就像`strcpy`例程一样工作。它修剪字符串*delim中指定的一组字符*, 如果为空，则为空格。它修剪左、右、两者和所有（如 tr）。它没有太多内容，它只遍历字符串一次。有些人可能会抱怨修剪右侧从左侧开始，但是，无论如何都不需要从左侧开始的 strlen。（你必须以一种或另一种方式到达字符串的末尾以进行正确的修剪，所以你最好边做边做。）关于流水线和缓存大小等可能会有争论——谁知道呢. 由于该解决方案从左到右工作并且只迭代一次，因此它也可以扩展到流上工作。限制：它不适**用于**unicode**字符串**。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2010-10-20T07:08:26.423

这是我对一个简单但正确的就地修剪功能的尝试。

```
void trim(char *str)
{
    int i;
    int begin = 0;
    int end = strlen(str) - 1;

    while (isspace((unsigned char) str[begin]))
        begin++;

    while ((end >= begin) && isspace((unsigned char) str[end]))
        end--;

    // Shift all characters back to the start of the string array.
    for (i = begin; i <= end; i++)
        str[i - begin] = str[i];

    str[i - begin] = '\0'; // Null terminate string.
} 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2014-11-17T23:38:52.653

装饰派对迟到了

特点：
1\. 快速修剪开头，就像许多其他答案一样。
2\. 走到尽头后，修剪右边，每个循环只做1次测试。与@jfm3 类似，但适用于全空白字符串）
3\. 为避免未定义的行为，当`char`是有符号时`char`，`*s`转换为`unsigned char`.

> **字符处理** “在所有情况下，参数都是一个`int`，其值应表示为`unsigned char`或应等于宏的值`EOF`。如果参数具有任何其他值，则行为未定义。” C11 §7.4 1

```
#include <ctype.h>

// Return a pointer to the trimmed string
char *string_trim_inplace(char *s) {
  while (isspace((unsigned char) *s)) s++;
  if (*s) {
    char *p = s;
    while (*p) p++;
    while (isspace((unsigned char) *(--p)));
    p[1] = '\0';
  }

  // If desired, shift the trimmed string

  return s;
} 
```

* * *

[@chqrlie](https://stackoverflow.com/users/4593267/chqrlie)评论以上内容不会改变修剪后的字符串。这样做......

```
// Return a pointer to the (shifted) trimmed string
char *string_trim_inplace(char *s) {
  char *original = s;
  size_t len = 0;

  while (isspace((unsigned char) *s)) {
    s++;
  } 
  if (*s) {
    char *p = s;
    while (*p) p++;
    while (isspace((unsigned char) *(--p)));
    p[1] = '\0';
    // len = (size_t) (p - s);   // older errant code
    len = (size_t) (p - s + 1);  // Thanks to @theriver
  }

  return (s == original) ? s : memmove(original, s, len + 1);
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-12-22T01:47:36.693

这是一个类似于@adam-rosenfields 就地修改例程的解决方案，但无需使用 strlen()。像@jkramer 一样，字符串在缓冲区内左调整，因此您可以释放相同的指针。对于大字符串来说不是最优的，因为它不使用 memmove。包括@jfm3 提到的 ++/-- 运算符。 [包括基于FCTX](http://fctx.wildbearsoftware.com)的单元测试。

```
#include <ctype.h>

void trim(char * const a)
{
    char *p = a, *q = a;
    while (isspace(*q))            ++q;
    while (*q)                     *p++ = *q++;
    *p = '\0';
    while (p > a && isspace(*--p)) *p = '\0';
}

/* See http://fctx.wildbearsoftware.com/ */
#include "fct.h"

FCT_BGN()
{
    FCT_QTEST_BGN(trim)
    {
        { char s[] = "";      trim(s); fct_chk_eq_str("",    s); } // Trivial
        { char s[] = "   ";   trim(s); fct_chk_eq_str("",    s); } // Trivial
        { char s[] = "\t";    trim(s); fct_chk_eq_str("",    s); } // Trivial
        { char s[] = "a";     trim(s); fct_chk_eq_str("a",   s); } // NOP
        { char s[] = "abc";   trim(s); fct_chk_eq_str("abc", s); } // NOP
        { char s[] = "  a";   trim(s); fct_chk_eq_str("a",   s); } // Leading
        { char s[] = "  a c"; trim(s); fct_chk_eq_str("a c", s); } // Leading
        { char s[] = "a  ";   trim(s); fct_chk_eq_str("a",   s); } // Trailing
        { char s[] = "a c  "; trim(s); fct_chk_eq_str("a c", s); } // Trailing
        { char s[] = " a ";   trim(s); fct_chk_eq_str("a",   s); } // Both
        { char s[] = " a c "; trim(s); fct_chk_eq_str("a c", s); } // Both

        // Villemoes pointed out an edge case that corrupted memory.  Thank you.
        // http://stackoverflow.com/questions/122616/#comment23332594_4505533
        {
          char s[] = "a     ";       // Buffer with whitespace before s + 2
          trim(s + 2);               // Trim "    " containing only whitespace
          fct_chk_eq_str("", s + 2); // Ensure correct result from the trim
          fct_chk_eq_str("a ", s);   // Ensure preceding buffer not mutated
        }

        // doukremt suggested I investigate this test case but
        // did not indicate the specific behavior that was objectionable.
        // http://stackoverflow.com/posts/comments/33571430
        {
          char s[] = "         foobar";  // Shifted across whitespace
          trim(s);                       // Trim
          fct_chk_eq_str("foobar", s);   // Leading string is correct

          // Here is what the algorithm produces:
          char r[16] = { 'f', 'o', 'o', 'b', 'a', 'r', '\0', ' ',                     
                         ' ', 'f', 'o', 'o', 'b', 'a', 'r', '\0'};
          fct_chk_eq_int(0, memcmp(s, r, sizeof(s)));
        }
    }
    FCT_QTEST_END();
}
FCT_END(); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-06-11T17:16:13.347

另一个，用一条线做真正的工作：

```
#include <stdio.h>

int main()
{
   const char *target = "   haha   ";
   char buf[256];
   sscanf(target, "%s", buf); // Trimming on both sides occurs here
   printf("<%s>\n", buf);
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-11-17T12:46:02.503

我不喜欢这些答案中的大多数，因为他们做了以下一项或多项......

1.  在原始指针的字符串中返回了一个不同的指针（将两个不同的指针同时指向同一事物有点痛苦）。
2.  无偿使用诸如**strlen()**之类的东西来预迭代整个字符串。
3.  使用了非便携式操作系统特定的库函数。
4.  反向扫描。
5.  使用与**' ' 的**比较而不是**isspace()**以便保留 TAB / CR / LF。
6.  使用大型静态缓冲区浪费内存。
7.  **像sscanf/sprintf**这样的高成本函数浪费了周期。

这是我的版本：

```
void fnStrTrimInPlace(char *szWrite) {

    const char *szWriteOrig = szWrite;
    char       *szLastSpace = szWrite, *szRead = szWrite;
    int        bNotSpace;

    // SHIFT STRING, STARTING AT FIRST NON-SPACE CHAR, LEFTMOST
    while( *szRead != '\0' ) {

        bNotSpace = !isspace((unsigned char)(*szRead));

        if( (szWrite != szWriteOrig) || bNotSpace ) {

            *szWrite = *szRead;
            szWrite++;

            // TRACK POINTER TO LAST NON-SPACE
            if( bNotSpace )
                szLastSpace = szWrite;
        }

        szRead++;
    }

    // TERMINATE AFTER LAST NON-SPACE (OR BEGINNING IF THERE WAS NO NON-SPACE)
    *szLastSpace = '\0';
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-23T18:39:59.917

我不确定你认为什么是“无痛”。

C弦非常痛苦。我们可以很容易地找到第一个非空白字符的位置：

```
而 (isspace(* p)) p++;

```

我们可以通过两个类似的简单移动找到最后一个非空白字符的位置：

```
而 (* q) q++;
做{ q--; } 而 (isspace(* q));

```

（我已经免除了您同时使用`*`和`++`运算符的痛苦。）

现在的问题是你怎么处理这个？手头的数据类型实际上并不是一个`String`很容易思考的强大的抽象抽象，而实际上只是一个存储字节数组。由于缺乏稳健的数据类型，因此不可能编写出与 PHperytonby 的函数相同的`chomp`函数。C 中的这样一个函数会返回什么？

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-24T04:07:53.343

使用[字符串库](http://www.and.org/vstr/comparison)，例如：

```
Ustr *s1 = USTR1(\7, " 12345 ");

ustr_sc_trim_cstr(&s1, " ");
assert(ustr_cmp_cstr_eq(s1, "12345"));
```

...正如您所说，这是一个“常见”问题，是的，您需要包含一个 #include 左右，并且它不包含在 libc 中，但不要发明您自己的 hack 作业来存储随机指针和 size_t 那样只会导致缓冲区溢出。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-10-08T11:00:15.803

如果您正在使用`glib`，那么您可以使用[g_strstrip](https://developer.gnome.org/glib/stable/glib-String-Utility-Functions.html#g-strstrip)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2018-07-06T17:20:34.000

*派对迟到了……*

无回溯的单程前向扫描解决方案。源字符串中的每个字符都只测试~~一次~~两次。（所以它应该比这里的大多数其他解决方案更快，特别是如果源字符串有很多尾随空格。）

这包括两种解决方案，一种是将源字符串复制并修剪为另一个目标字符串，另一种是将源字符串修剪到位。这两个函数使用相同的代码。

（可修改的）字符串被原地移动，因此指向它的原始指针保持不变。

```
#include <stddef.h>
#include <ctype.h>

char * trim2(char *d, const char *s)
{
    // Sanity checks
    if (s == NULL  ||  d == NULL)
        return NULL;

    // Skip leading spaces        
    const unsigned char * p = (const unsigned char *)s;
    while (isspace(*p))
        p++;

    // Copy the string
    unsigned char * dst = (unsigned char *)d;   // d and s can be the same
    unsigned char * end = dst;
    while (*p != '\0')
    {
        if (!isspace(*dst++ = *p++))
            end = dst;
    }

    // Truncate trailing spaces
    *end = '\0';
    return d;
}

char * trim(char *s)
{
    return trim2(s, s);
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-03-16T06:08:51.597

比赛有点晚了，但我会把我的套路投入到战斗中。它们可能不是最绝对有效的，但我相信它们是正确的并且它们很简单（`rtrim()`推动复杂性信封）：

```
#include <ctype.h>
#include <string.h>

/*
    Public domain implementations of in-place string trim functions

    Michael Burr
    michael.burr@nth-element.com
    2010
*/

char* ltrim(char* s) 
{
    char* newstart = s;

    while (isspace( *newstart)) {
        ++newstart;
    }

    // newstart points to first non-whitespace char (which might be '\0')
    memmove( s, newstart, strlen( newstart) + 1); // don't forget to move the '\0' terminator

    return s;
}

char* rtrim( char* s)
{
    char* end = s + strlen( s);

    // find the last non-whitespace character
    while ((end != s) && isspace( *(end-1))) {
            --end;
    }

    // at this point either (end == s) and s is either empty or all whitespace
    //      so it needs to be made empty, or
    //      end points just past the last non-whitespace character (it might point
    //      at the '\0' terminator, in which case there's no problem writing
    //      another there).    
    *end = '\0';

    return s;
}

char*  trim( char* s)
{
    return rtrim( ltrim( s));
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-11-08T21:03:26.743

为了保持这种增长，还有一个带有可修改字符串的选项：

```
void trimString(char *string)
{
    size_t i = 0, j = strlen(string);
    while (j > 0 && isspace((unsigned char)string[j - 1])) string[--j] = '\0';
    while (isspace((unsigned char)string[i])) i++;
    if (i > 0) memmove(string, string + i, j - i + 1);
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-08-09T05:18:58.407

我知道有很多答案，但我在这里发布我的答案，看看我的解决方案是否足够好。

```
// Trims leading whitespace chars in left `str`, then copy at almost `n - 1` chars
// into the `out` buffer in which copying might stop when the first '\0' occurs, 
// and finally append '\0' to the position of the last non-trailing whitespace char.
// Reture the length the trimed string which '\0' is not count in like strlen().
size_t trim(char *out, size_t n, const char *str)
{
    // do nothing
    if(n == 0) return 0;    

    // ptr stop at the first non-leading space char
    while(isspace(*str)) str++;    

    if(*str == '\0') {
        out[0] = '\0';
        return 0;
    }    

    size_t i = 0;    

    // copy char to out until '\0' or i == n - 1
    for(i = 0; i < n - 1 && *str != '\0'; i++){
        out[i] = *str++;
    }    

    // deal with the trailing space
    while(isspace(out[--i]));    

    out[++i] = '\0';
    return i;
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-04-29T13:22:43.350

跳过字符串中前导空格的最简单方法是，恕我直言，

```
#include <stdio.h>

int main()
{
char *foo="     teststring      ";
char *bar;
sscanf(foo,"%s",bar);
printf("String is >%s<\n",bar);
    return 0;
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-10-06T01:00:01.080

好的，这是我对这个问题的看法。我相信这是最简洁的解决方案，它可以修改字符串（`free`将起作用）并避免任何 UB。对于小字符串，它可能比涉及 memmove 的解决方案更快。

```
void stripWS_LT(char *str)
{
    char *a = str, *b = str;
    while (isspace((unsigned char)*a)) a++;
    while (*b = *a++)  b++;
    while (b > str && isspace((unsigned char)*--b)) *b = 0;
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-12-31T15:53:59.937

```
#include <ctype.h>
#include <string.h>

char *trim_space(char *in)
{
    char *out = NULL;
    int len;
    if (in) {
        len = strlen(in);
        while(len && isspace(in[len - 1])) --len;
        while(len && *in && isspace(*in)) ++in, --len;
        if (len) {
            out = strndup(in, len);
        }
    }
    return out;
} 
```

`isspace`有助于修剪所有空白。

*   运行第一个循环以从最后一个字节检查空格字符并减少长度变量
*   运行第二个循环以从第一个字节开始检查空格字符并减少长度变量并增加 char 指针。
*   最后，如果长度变量大于 0，则用于`strndup`通过排除空格来创建新的字符串缓冲区。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-09-19T18:24:45.973

这一个简短而简单，使用 for 循环并且不会覆盖字符串边界。`isspace()`如果需要，您可以将测试替换为。

```
void trim (char *s)         // trim leading and trailing spaces+tabs
{
 int i,j,k, len;

 j=k=0;
 len = strlen(s);
                    // find start of string
 for (i=0; i<len; i++) if ((s[i]!=32) && (s[i]!=9)) { j=i; break; }
                    // find end of string+1
 for (i=len-1; i>=j; i--) if ((s[i]!=32) && (s[i]!=9)) { k=i+1; break;} 

 if (k<=j) {s[0]=0; return;}        // all whitespace (j==k==0)

 len=k-j;
 for (i=0; i<len; i++) s[i] = s[j++];   // shift result to start of string
 s[i]=0;                // end the string

}//_trim 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-23T18:16:02.487

就个人而言，我会自己动手。您可以使用 strtok，但您需要注意这样做（特别是如果您要删除前导字符），您知道什么是内存。

删除尾随空格很容易，而且非常安全，因为您可以在最后一个空格的顶部放一个 0，从末尾倒数。摆脱领先空间意味着移动事物。如果您想在原地执行此操作（可能是明智的），您可以继续将所有内容移回一个字符，直到没有前导空格。或者，为了更有效，您可以找到第一个非空格字符的索引，然后将所有内容移回该数字。或者，您可以只使用指向第一个非空格字符的指针（但是您需要像使用 strtok 一样小心）。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-23T18:49:55.807

我只包括代码，因为到目前为止发布的代码似乎不是最理想的（而且我还没有代表发表评论。）

```
void inplace_trim(char* s)
{
    int start, end = strlen(s);
    for (start = 0; isspace(s[start]); ++start) {}
    if (s[start]) {
        while (end > 0 && isspace(s[end-1]))
            --end;
        memmove(s, &s[start], end - start);
    }
    s[end - start] = '\0';
}

char* copy_trim(const char* s)
{
    int start, end;
    for (start = 0; isspace(s[start]); ++start) {}
    for (end = strlen(s); end > 0 && isspace(s[end-1]); --end) {}
    return strndup(s + start, end - start);
} 
```

`strndup()`是一个 GNU 扩展。如果您没有它或类似的东西，请自己滚动。例如：

```
r = strdup(s + start);
r[end-start] = '\0'; 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-12-04T05:46:21.090

```
#include "stdafx.h"
#include "malloc.h"
#include "string.h"

int main(int argc, char* argv[])
{

  char *ptr = (char*)malloc(sizeof(char)*30);
  strcpy(ptr,"            Hel  lo    wo           rl   d G    eo rocks!!!    by shahil    sucks b i          g       tim           e");

  int i = 0, j = 0;

  while(ptr[j]!='\0')
  {

      if(ptr[j] == ' ' )
      {
          j++;
          ptr[i] = ptr[j];
      }
      else
      {
          i++;
          j++;
          ptr[i] = ptr[j];
      }
  }

  printf("\noutput-%s\n",ptr);
        return 0;
}
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2011-05-06T19:34:30.497

到目前为止，大多数答案都执行以下操作之一：

1.  回溯到字符串的末尾（即找到字符串的末尾，然后向后搜索，直到找到一个非空格字符）或
2.  首先调用`strlen()`，然后通过整个字符串进行第二次传递。

这个版本只做一次，不回溯。因此，它可能比其他的性能更好，尽管只有在通常有数百个尾随空格的情况下（这在处理 SQL 查询的输出时并不罕见。）

```
static char const WHITESPACE[] = " \t\n\r";

static void get_trim_bounds(char  const *s,
                            char const **firstWord,
                            char const **trailingSpace)
{
    char const *lastWord;
    *firstWord = lastWord = s + strspn(s, WHITESPACE);
    do
    {
        *trailingSpace = lastWord + strcspn(lastWord, WHITESPACE);
        lastWord = *trailingSpace + strspn(*trailingSpace, WHITESPACE);
    }
    while (*lastWord != '\0');
}

char *copy_trim(char const *s)
{
    char const *firstWord, *trailingSpace;
    char *result;
    size_t newLength;

    get_trim_bounds(s, &firstWord, &trailingSpace);
    newLength = trailingSpace - firstWord;

    result = malloc(newLength + 1);
    memcpy(result, firstWord, newLength);
    result[newLength] = '\0';
    return result;
}

void inplace_trim(char *s)
{
    char const *firstWord, *trailingSpace;
    size_t newLength;

    get_trim_bounds(s, &firstWord, &trailingSpace);
    newLength = trailingSpace - firstWord;

    memmove(s, firstWord, newLength);
    s[newLength] = '\0';
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2013-02-20T11:33:06.173

这是我能想到的最短的实现：

```
static const char *WhiteSpace=" \n\r\t";
char* trim(char *t)
{
    char *e=t+(t!=NULL?strlen(t):0);               // *e initially points to end of string
    if (t==NULL) return;
    do --e; while (strchr(WhiteSpace, *e) && e>=t);  // Find last char that is not \r\n\t
    *(++e)=0;                                      // Null-terminate
    e=t+strspn (t,WhiteSpace);                           // Find first char that is not \t
    return e>t?memmove(t,e,strlen(e)+1):t;                  // memmove string contents and terminator
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2013-05-22T13:49:06.197

这些函数会修改原始缓冲区，因此如果动态分配，原始指针可以被释放。

```
#include <string.h>

void rstrip(char *string)
{
  int l;
  if (!string)
    return;
  l = strlen(string) - 1;
  while (isspace(string[l]) && l >= 0)
    string[l--] = 0;
}

void lstrip(char *string)
{
  int i, l;
  if (!string)
    return;
  l = strlen(string);
  while (isspace(string[(i = 0)]))
    while(i++ < l)
      string[i-1] = string[i];
}

void strip(char *string)
{
  lstrip(string);
  rstrip(string);
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-10-18T03:34:05.497

您如何看待使用头文件 Shlwapi.h. 中定义的 StrTrim 函数？它是直截了当的，而不是您自己定义的。
详细信息请参见：http:
[//msdn.microsoft.com/en-us/library/windows/desktop/bb773454 (v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/bb773454(v=vs.85).aspx)

如果你有这
`char ausCaptain[]="GeorgeBailey ";`
`StrTrim(ausCaptain," ");`
将给`ausCaptain`不。`"GeorgeBailey"``"GeorgeBailey "`

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-02-23T10:12:27.903

为了从两边修剪我的字符串，我使用 oldie 但 gooody ;) 它可以修剪任何 ascii 小于空格的东西，这意味着控制字符也将被修剪！

```
char *trimAll(char *strData)
{
  unsigned int L = strlen(strData);
  if(L > 0){ L--; }else{ return strData; }
  size_t S = 0, E = L;
  while((!(strData[S] > ' ') || !(strData[E] > ' ')) && (S >= 0) && (S <= L) && (E >= 0) && (E <= L))
  {
    if(strData[S] <= ' '){ S++; }
    if(strData[E] <= ' '){ E--; }
  }
  if(S == 0 && E == L){ return strData; } // Nothing to be done
  if((S >= 0) && (S <= L) && (E >= 0) && (E <= L)){
    L = E - S + 1;
    memmove(strData,&strData[S],L); strData[L] = '\0';
  }else{ strData[0] = '\0'; }
  return strData;
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2018-02-01T12:41:09.087

这里我使用动态内存分配将输入字符串修剪为函数 trimStr。首先，我们找出输入字符串中有多少个非空字符。然后，我们分配一个具有该大小的字符数组并处理空终止字符。当我们使用这个函数时，我们需要释放主函数内部的内存。

```
#include<stdio.h>
#include<stdlib.h>

char *trimStr(char *str){
char *tmp = str;
printf("input string %s\n",str);
int nc = 0;

while(*tmp!='\0'){
  if (*tmp != ' '){
  nc++;
 }
 tmp++;
}
printf("total nonempty characters are %d\n",nc);
char *trim = NULL;

trim = malloc(sizeof(char)*(nc+1));
if (trim == NULL) return NULL;
tmp = str;
int ne = 0;

while(*tmp!='\0'){
  if (*tmp != ' '){
     trim[ne] = *tmp;
   ne++;
 }
 tmp++;
}
trim[nc] = '\0';

printf("trimmed string is %s\n",trim);

return trim; 
 }

int main(void){

char str[] = " s ta ck ove r fl o w  ";

char *trim = trimStr(str);

if (trim != NULL )free(trim);

return 0;
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2018-06-15T18:57:19.410

这是我的做法。它会在适当的位置修剪字符串，因此不必担心释放返回的字符串或丢失指向已分配字符串的指针。这可能不是最短的答案，但对大多数读者来说应该很清楚。

```
#include <ctype.h>
#include <string.h>
void trim_str(char *s)
{
    const size_t s_len = strlen(s);

    int i;
    for (i = 0; i < s_len; i++)
    {
        if (!isspace( (unsigned char) s[i] )) break;
    }

    if (i == s_len)
    {
        // s is an empty string or contains only space characters

        s[0] = '\0';
    }
    else
    {
        // s contains non-space characters

        const char *non_space_beginning = s + i;

        char *non_space_ending = s + s_len - 1;
        while ( isspace( (unsigned char) *non_space_ending ) ) non_space_ending--;

        size_t trimmed_s_len = non_space_ending - non_space_beginning + 1;

        if (s != non_space_beginning)
        {
            // Non-space characters exist in the beginning of s

            memmove(s, non_space_beginning, trimmed_s_len);
        }

        s[trimmed_s_len] = '\0';
    }
} 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2018-08-06T23:35:25.320

```
char* strtrim(char* const str)
{
    if (str != nullptr)
    {
        char const* begin{ str };
        while (std::isspace(*begin))
        {
            ++begin;
        }

        auto end{ begin };
        auto scout{ begin };
        while (*scout != '\0')
        {
            if (!std::isspace(*scout++))
            {
                end = scout;
            }
        }

        auto /* std::ptrdiff_t */ const length{ end - begin };
        if (begin != str)
        {
            std::memmove(str, begin, length);
        }

        str[length] = '\0';
    }

    return str;
} 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2019-12-05T20:05:53.220

由于其他答案似乎没有直接改变字符串指针，而是依赖于返回值，我想我会提供这种方法，它另外不使用任何库，因此适用于操作系统风格的编程：

```
// only used for printf in main
#include <stdio.h>

// note the char ** means we can modify the address
char *trimws(char **strp) { 
  char *str;
  // check if empty string
  if(!*str)
    return;
  // go to the end of the string
  for (str = *strp; *str; str++) 
    ;
  // back up one from the null terminator
  str--; 
  // set trailing ws to null
  for (; *str == ' '; str--) 
    *str = 0;
  // increment past leading ws
  for (str = *strp; *str == ' '; str++) 
    ;
  // set new begin address of string
  *strp = str; 
}

int main(void) {
  char buf[256] = "   whitespace    ";
  // pointer must be modifiable lvalue so we make bufp
  char **bufp = &buf;
  // pass in the address
  trimws(&bufp);
  // prints : XXXwhitespaceXXX
  printf("XXX%sXXX\n", bufp); 
  return 0;
} 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2021-04-24T05:05:02.890

IMO，它可以在没有`strlen`and的情况下完成`isspace`。

```
char *
trim (char * s, char c)
{
    unsigned o = 0;
    char * sb = s;

    for (; *s == c; s++)
        o++;

    for (; *s != '\0'; s++)
        continue;
    for (; s - o > sb && *--s == c;)
        continue;

    if (o > 0)
        memmove(sb, sb + o, s + 1 - o - sb);
    if (*s != '\0')
        *(s + 1 - o) = '\0';

    return sb;
} 
```

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2008-09-23T18:24:20.143

这是一个做你想做的事情的功能。它应该处理字符串都是空格的退化情况。您必须传入一个输出缓冲区和缓冲区的长度，这意味着您必须传入一个您分配的缓冲区。

```
void str_trim(char *output, const char *text, int32 max_len)
{
    int32 i, j, length;
    length = strlen(text);

    if (max_len < 0) {
        max_len = length + 1;
    }

    for (i=0; i<length; i++) {
        if ( (text[i] != ' ') && (text[i] != '\t') && (text[i] != '\n') && (text[i] != '\r')) {
            break;
        }
    }

    if (i == length) {
        // handle lines that are all whitespace
        output[0] = 0;
        return;
    }

    for (j=length-1; j>=0; j--) {
        if ( (text[j] != ' ') && (text[j] != '\t') && (text[j] != '\n') && (text[j] != '\r')) {
            break;
        }
    }

    length = j + 1 - i;
    strncpy(output, text + i, length);
    output[length] = 0;
} 
```

循环中的 if 语句可能可以替换为**isspace(text[i])**或**isspace(text[j])**以使这些行更易于阅读。我认为我将它们设置为这种方式是因为有些字符我不想测试，但看起来我现在覆盖了所有空格:-)

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2014-09-26T15:44:26.707

以下是我披露的关于 Linux 内核代码中的问题：

```
/**
 * skip_spaces - Removes leading whitespace from @s.
 * @s: The string to be stripped.
 *
 * Returns a pointer to the first non-whitespace character in @s.
 */
char *skip_spaces(const char *str)
{
    while (isspace(*str))
            ++str;
    return (char *)str;
}

/**
 * strim - Removes leading and trailing whitespace from @s.
 * @s: The string to be stripped.
 *
 * Note that the first trailing whitespace is replaced with a %NUL-terminator
 * in the given string @s. Returns a pointer to the first non-whitespace
 * character in @s.
 */
char *strim(char *s)
{
    size_t size;
    char *end;

    size = strlen(s);

    if (!size)
            return s;

    end = s + size - 1;
    while (end >= s && isspace(*end))
            end--;
    *(end + 1) = '\0';

    return skip_spaces(s);
} 
```

由于起源，它应该没有错误；-)

我猜我的一件更接近 KISS 原则：

```
/**
 * trim spaces
 **/
char * trim_inplace(char * s, int len)
{
    // trim leading
    while (len && isspace(s[0]))
    {
        s++; len--;
    }

    // trim trailing
    while (len && isspace(s[len - 1]))
    {
        s[len - 1] = 0; len--;
    }

    return s;
} 
```

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2016-02-10T00:54:51.500

```
void trim(char* const str)
{
    char* begin = str;
    char* end = str;
    while (isspace(*begin))
    {
        ++begin;
    }
    char* s = begin;
    while (*s != '\0')
    {
        if (!isspace(*s++))
        {
            end = s;
        }
    }
    *end = '\0';
    const int dist = end - begin;
    if (begin > str && dist > 0)
    {
        memmove(str, begin, dist + 1);
    }
} 
```

就地修改字符串，因此您仍然可以将其删除。

不使用花哨的裤子库函数（除非您认为 memmove 很花哨）。

处理字符串重叠。

修剪前后（不是中间，抱歉）。

如果字符串很大，则速度很快（memmove 通常用汇编语言编写）。

仅在需要时移动字符（我发现在大多数用例中都是如此，因为字符串很少有前导空格并且通常没有尾随空格）

我想对此进行测试，但我迟到了。享受寻找错误... :-)

* * *

## 回答 #37

> 赞同：-2
> 
> 时间：2012-07-18T10:18:57.130

```
#include<stdio.h>
#include<ctype.h>

main()
{
    char sent[10]={' ',' ',' ','s','t','a','r','s',' ',' '};
    int i,j=0;
    char rec[10];

    for(i=0;i<=10;i++)
    {
        if(!isspace(sent[i]))
        {

            rec[j]=sent[i];
            j++;
        }
    }

printf("\n%s\n",rec);

} 
```

* * *

## 回答 #38

> 赞同：-2
> 
> 时间：2016-01-13T12:14:30.027

C++ STL 风格

```
std::string Trimed(const std::string& s)
{
    std::string::const_iterator begin = std::find_if(s.begin(),
                                                 s.end(),
                                                 [](char ch) { return !std::isspace(ch); });

    std::string::const_iterator   end = std::find_if(s.rbegin(),
                                                 s.rend(),
                                                 [](char ch) { return !std::isspace(ch); }).base();
    return std::string(begin, end);
} 
```

[http://ideone.com/VwJaq9](http://ideone.com/VwJaq9)

* * *

## 回答 #39

> 赞同：-2
> 
> 时间：2016-03-09T18:25:10.690

```
void trim(char* string) {
    int lenght = strlen(string);
    int i=0;

    while(string[0] ==' ') {
        for(i=0; i<lenght; i++) {
            string[i] = string[i+1];
        }
        lenght--;
    }

    for(i=lenght-1; i>0; i--) {
        if(string[i] == ' ') {
            string[i] = '\0';
        } else {
            break;
        }
    }
} 
```

# sql - 插入...选择*，如何忽略身份？

> ID：122639
> 
> 赞同：13
> 
> 时间：2008-09-23T18:00:56.110
> 
> 标签：sql, sql-server

我有一个具有混凝土表确切结构的临时表`T`。它是这样创建的：

```
select top 0 * into #tmp from T 
```

处理并填写内容后`#tmp`，我想将内容复制回`T`如下：

```
insert into T select * from #tmp 
```

只要`T`没有身份列就可以了，但在我的情况下是这样。有什么方法可以忽略从`#tmp`我复制到的自动增量标识列`T`？我的动机是避免在“插入到”列表中拼出每个列名。

编辑：切换 identity_insert 不起作用，因为如果行被插入到我的脚本之外，那么 pkey`#tmp`可能会与那些pkey 发生冲突，也就是说，如果首先自动增加 pkey 以与 T 同步。`T``T``#tmp`

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T18:02:26.637

设置 IDENTITY_INSERT ON

插入命令

设置 IDENTITY_INSERT 关闭

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-23T18:12:17.707

由于无论如何都会在插入过程中生成标识，您是否可以在将数据插入回 T 之前简单地从 #tmp 中删除此列？

```
alter table #tmp drop column id 
```

**UPD：**这是我在 SQL Server 2008 中测试过的示例：

```
create table T(ID int identity(1,1) not null, Value nvarchar(50))
insert into T (Value) values (N'Hello T!')
select top 0 * into #tmp from T
alter table #tmp drop column ID
insert into #tmp (Value) values (N'Hello #tmp')
insert into T select * from #tmp
drop table #tmp
select * from T
drop table T 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2017-06-19T15:09:33.233

[在此处](https://dba.stackexchange.com/a/936/116268)和[此处](https://dba.stackexchange.com/a/925/116268)查看答案：

```
select * into without_id from with_id
union all
select * from with_id where 1 = 0 
```

原因：

> 将现有标识列选择到新表中时，新列将继承 IDENTITY 属性，除非以下条件之一为真：
> 
> *   SELECT 语句包含连接、GROUP BY 子句或聚合函数。
> *   使用 UNION 连接多个 SELECT 语句。
> *   标识列在选择列表中多次列出。
> *   标识列是表达式的一部分。
> *   标识列来自远程数据源。
> 
> 如果其中任何一个条件为真，则创建的列不是 NULL，而不是继承 IDENTITY 属性。如果新表中需要标识列但这样的列不可用，或者您需要与源标识列不同的种子或增量值，请使用 IDENTITY 函数在选择列表中定义该列。请参阅下面示例部分中的“使用 IDENTITY 函数创建标识列”。

所有功劳归功于[Eric Humphrey](https://dba.stackexchange.com/users/247/eric-humphrey-lotsahelp)和[bernd_k](https://dba.stackexchange.com/users/136/bernd-k)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T18:03:06.463

```
set identity_insert on 
```

用这个。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T18:08:31.880

不是`SELECT *`- 如果您选择了除身份之外的每一列，那就没问题了。我能看到的唯一方法是您可以通过动态构建`INSERT`语句来做到这一点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T18:11:12.060

只需列出要重新插入的列，无论如何都不要使用 select *。如果您不想键入它们，只需从对象浏览器中拖动它们（如果您展开表格并拖动单词，列，您将获得所有这些，只需删除 id 列）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-03-17T18:26:37.230

INSERT INTO #Table SELECT MAX(Id) + ROW_NUMBER() OVER(ORDER BY Id)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T18:12:40.777

“更新 T.ID = #tmp.ID”可能有效吗？

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-23T18:42:27.510

> 1.  它让我有机会在插入之前预览数据
> 2.  作为计算的一部分，我在临时表之间加入了连接；临时表允许我专注于我正在使用的确切数据集。我想就是这样。有什么建议/意见吗？

对于第 1 部分，正如 Kolten 在其中一条评论中提到的，将您的语句封装在事务中并添加一个参数以在显示和提交之间切换将满足您的需求。对于第 2 部分，我需要查看您正在尝试什么“计算”。将数据限制在临时表中可能会使情况过于复杂。

# c# - 如何在 C# 中解码 HTML 字符？

> ID：122641
> 
> 赞同：425
> 
> 时间：2008-09-23T18:01:15.017
> 
> 标签：c#

我有用 HTML 字符实体编码的电子邮件地址。.NET 中有什么东西可以将它们转换为纯字符串吗？

* * *

## 回答 #1

> 赞同：649
> 
> 时间：2008-09-23T18:02:52.907

您可以使用[`HttpUtility.HtmlDecode`](http://msdn.microsoft.com/en-us/library/7c5fyk1k.aspx)

如果您使用的是 .NET 4.0+，您也可以使用[`WebUtility.HtmlDecode`](http://msdn.microsoft.com/en-us/library/ee388354.aspx)不需要额外的程序集引用，因为它在`System.Net`命名空间中可用。

* * *

## 回答 #2

> 赞同：200
> 
> 时间：2010-04-14T17:40:19.010

在 .Net 4.0 上：

```
System.Net.WebUtility.HtmlDecode() 
```

无需包含 C# 项目的程序集

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2008-09-23T18:29:05.967

正如@CQ 所说，您需要使用[HttpUtility.HtmlDecode](http://msdn.microsoft.com/en-us/library/7c5fyk1k.aspx)，但默认情况下它在非 ASP .NET 项目中不可用。

对于非 ASP .NET 应用程序，您需要添加对`System.Web.dll`. 在解决方案资源管理器中右键单击您的项目，选择“添加引用”，然后浏览列表以查找`System.Web.dll`.

现在添加了引用，您应该能够使用完全限定名称访问方法`System.Web.HttpUtility.HtmlDecode`或插入`using`语句 for`System.Web`以使事情变得更容易。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-09-23T18:04:10.237

如果没有服务器上下文（即离线运行），您可以使用[HttpUtility](http://msdn.microsoft.com/en-us/library/system.web.httputility.aspx)。[html解码](http://msdn.microsoft.com/en-us/library/7c5fyk1k.aspx)。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-06-25T03:36:12.030

还值得一提的是，如果你像我一样使用 HtmlAgilityPack，你应该使用`HtmlAgilityPack.HtmlEntity.DeEntitize()`. 它需要 a`string`并返回 a `string`。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2016-11-17T10:01:01.617

要解码 HTML，请查看以下代码

```
string s = "Svendborg V&#230;rft A/S";
string a = HttpUtility.HtmlDecode(s);
Response.Write(a); 
```

输出就像

```
 Svendborg Værft A/S 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-23T18:02:12.910

用于`Server.HtmlDecode`解码 HTML 实体。如果要*转义*HTML，即向用户显示`<`and`>`字符，请使用`Server.HtmlEncode`.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-05-25T09:34:42.937

将静态方法写入某个实用程序类，该类接受字符串作为参数并返回解码后的 html 字符串。

包括在`using System.Web.HttpUtility`你的课堂上

```
public static string HtmlEncode(string text)
    {
        if(text.length > 0){

           return HttpUtility.HtmlDecode(text);
        }else{

         return text;
        }

    } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-10-03T13:00:39.760

对于.net **4.0**

添加`System.net.dll`对项目的引用，`using System.Net;`然后使用以下扩展

```
// Html encode/decode
    public static string HtmDecode(this string htmlEncodedString)
    {
        if(htmlEncodedString.Length > 0)
        {
            return System.Net.WebUtility.HtmlDecode(htmlEncodedString);
        }
        else
        {
            return htmlEncodedString;
        }
    }

    public static string HtmEncode(this string htmlDecodedString)
    {
        if(htmlDecodedString.Length > 0)
        {
            return System.Net.WebUtility.HtmlEncode(htmlDecodedString);
        }
        else
        {
            return htmlDecodedString;
        }
    } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-03-11T19:14:49.787

对于包含 的字符串 我不得不对字符串进行双重解码。第一次解码会将其转换为第二遍将其正确解码为预期的字符。

# sharepoint - WSS 3.0：更改内容类型的父类型

> ID：122642
> 
> 赞同：2
> 
> 时间：2008-09-23T18:01:15.547
> 
> 标签：sharepoint, wss

我创建了内容类型的层次结构。我的层次结构的根具有内容类型“文档”作为父级。我的根目录中还有大约 20 种其他内容类型。

现在，我想将父级从“文档”更改为其他内容。是否可以？在 Web 界面中还是在代码中？内容类型的定义可以转储到文本文件然后重新创建吗？还是有什么其他技巧？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T23:03:30.673

如果您可以创建包含所有自定义内容类型的功能，您将能够更改定义每种内容类型及其列的 XML。

这将使您能够通过删除该功能并使用更改重新安装它来更改您网站的内容类型（最好使用解决方案）。

请注意，任何使用旧内容类型的内容在更新功能后仍将使用它们（内容类型存储在站点级别、列表级别和实际项目上）。

# c - 在 C 中对字符数组进行 alpha 排序的最简单方法是什么？

> ID：122649
> 
> 赞同：1
> 
> 时间：2008-09-23T18:01:57.060
> 
> 标签：c, arrays, sorting, character

我正在寻找一种简单、易于理解的算法来按字母顺序对 C 中的字符数组进行排序。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T18:05:12.403

C 中的字符具有恰好按顺序排列的数值，因此您只需将字符视为整数即可。C 标准库包含一个“qsort”函数。使用它（`man qsort`在类似 linux 的系统上）。您可能必须将大写字母转换为小写以简化操作，但这很简单。如果您想了解快速排序算法（这是您应该学习的算法，因为您将实际使用它），请参阅[Wikipedia](http://en.wikipedia.org/wiki/Quicksort)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T18:08:23.377

使用 qsort 方法：

```
#include <stdlib.h>

int char_compare (const void * a, const void * b)
{
  return *(const char *)a - *(const char *)b;
}

int main(){
  const char char_array[] = { 'c', 'a', 'b' };

  qsort (char_array, 3, sizeof(char), char_compare);

  return 0;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T18:20:51.023

如果结果是针对人类的，最好使用 strcoll。它比 strcmp 或 strcasecmp 慢，但它占非英语字符。如果您要使用它，请不要忘记为 LC_COLLATE 设置您的语言环境，即

setlocale(LC_COLLATE, "");

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T18:05:21.263

试试[冒泡排序](http://en.wikibooks.org/wiki/Data_Structures/bubble_sort)，这是最简单的排序算法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T18:08:40.180

我想知道您是否真的在寻找一种算法或只是一种解决问题的方法？如果是后者，则使用[C 的 qsort](http://www.manpagez.com/man/3/qsort/)。

如果您需要算法，请选择[Insertion sort](http://en.wikipedia.org/wiki/Insertion_sort)或[Selection sort](http://en.wikipedia.org/wiki/Selection_sort)，因为它们很容易理解。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T18:04:36.977

简单的？做一个冒泡排序。

这是 java 和 int 而不是 char，但您可以轻松适应它...

```
int[] bubble(int a[])
    {
    for (int i = a.length; --i>=0; )
        {
        for (int j = 0; j<i; j++)
            {
            if (a[j] > a[j+1])
                {
                int T = a[j];
                a[j] = a[j+1];
                a[j+1] = T;
                }
            }
        }
    return(a);
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-26T06:51:43.693

这是非常简单且渐近最快的（N 是数组的大小）：

```
const unsigned char in[N];
unsigned char out[N], *p=out;
size_t cnt[N]={0}, i, j;
for (i=0; i<COUNT; i++) cnt[in[i]]++;
for (i=0; i<256; i++) for (j=cnt[i]; j; j--) *p++=i; 
```

# .net - 内爆/加入字符串数组的 LINQ 方法是什么？

> ID：122670
> 
> 赞同：46
> 
> 时间：2008-09-23T18:04:36.943
> 
> 标签：.net, linq, string

我有以下字符串数组：

```
var sa = new string[] {"yabba","dabba","doo"}; 
```

我可以使用 string.Join() 将其转换为“yabba, dabba, doo”，但是超酷的 LINQ 方法是什么？Join 扩展方法看起来很有希望，但对于像我这样的新手来说非常困惑。

# visual-studio - 无论如何要从 Visual Studio 2005/2008 中删除设计（和拆分）视图？

> ID：122684
> 
> 赞同：5
> 
> 时间：2008-09-23T18:06:30.917
> 
> 标签：visual-studio, visual-studio-2008, visual-studio-2005

我正在尝试找到一种方法来禁用设计/拆分视图出现在 Visual Studio 中。我认为没有办法完全禁用它，但我似乎仍然找不到删除快捷方式 (F7) 或从底部栏中删除按钮的方法。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-01T14:50:22.543

我发现的最好的是：

对于 HTML/ASPX - 选项 -> HTML 设计器 -> 源视图中的起始页

对于 XAML -> 选项 -> 文本编辑器 -> XAML -> 杂项 -> 始终以完整 XAML 视图打开文档

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-07T21:33:47.410

键盘快捷键列在 View.ToggleDesigner 下。

我只想能够禁用设计视图；在进行 Web 开发时，F7 快捷方式对于在源代码和后面的代码之间进行交换非常方便。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-30T12:58:25.960

这里的简短博客文章显然可以解决这个问题 [http://renaissauce.com/thoughts/visual-studio-2008-tip-remove-the-design-split-source-button-bar/](http://renaissauce.com/thoughts/visual-studio-2008-tip-remove-the-design-split-source-button-bar/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T00:02:56.873

您应该能够在键盘自定义屏幕中删除 F7 的键盘分配。所有热键分配都是可定制的 AFAIK。

我怀疑有什么办法可以摆脱 UI 上的按钮。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-09T11:13:40.530

[这是 XAML 的解决方案](http://weblogs.asp.net/fmarguerie/archive/2009/01/29/life-changer-xaml-tip-for-visual-studio.aspx)

# java - 哪个 Java 库可用于通过 WebDAV 访问数据？

> ID：122685
> 
> 赞同：17
> 
> 时间：2008-09-23T18:06:40.027
> 
> 标签：java, webdav

这就是问题所在：哪个库可以帮助我在我的 Java 程序中通过 WebDAV 访问可用数据？开源是首选。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-02-02T06:36:56.680

我创建了一个非常易于使用的 java webdav 客户端：[http ://sardine.googlecode.com/](http://sardine.googlecode.com/)

现在转移到 github： [https ://github.com/lookfirst/sardine](https://github.com/lookfirst/sardine)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-24T07:38:06.410

现在已弃用的[Apache Jakarta Slide](http://jakarta.apache.org/slide/)项目包括一个 Java [WebDAV 客户端库](http://jakarta.apache.org/slide/clientjavadoc/index.html)- 但由于缺乏开发人员社区，该项目已退役。

[Apache Jackrabbit](http://jackrabbit.apache.org/)被提及作为 Slide 的替代品。您可能想检查是否可以改用其[WebDAV 库。](http://jackrabbit.apache.org/jackrabbit-webdav-library.html)

如果您只想访问 WebDAV 存储库中的文件，您可以简单地使用 HTTP 库，因为 WebDAV 是基于 HTTP 构建的。如果您想使用锁定、目录列表或访问属性（元数据）等 WebDAV 功能，您只需要一个 WebDAV 客户端库。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-05-30T09:53:57.037

已经存在一段时间的库是：

*   [万维网Dav](http://milton.io/)
*   [JackRabbit WebDav](http://jackrabbit.apache.org/jcr/components/jackrabbit-webdav-library.html)
*   [Apache wink WebDav 扩展](http://wink.apache.org/1.0/html/5.6%20WebDAV%20Extension.html)

需要 DAV 2 时，Milton 需要许可证。

在[WikiPedia 上](https://en.wikipedia.org/wiki/Comparison_of_WebDAV_software)，您可以找到可用库的简短摘要。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-10-18T22:13:25.027

[http://sourceforge.net/projects/webdavclient4j/](http://sourceforge.net/projects/webdavclient4j/)基于已退役的 Apache Jakarta Slide 项目的 Java webdav 客户端，并包括 VFS WebDAV 提供程序。它与 HttpClient 3.0.1 打包在一起。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-02-09T09:21:42.203

这是一个用于 webdav 操作的更好的库。它被称为托管在谷歌代码中的沙丁鱼。

[https://github.com/lookfirst/sardine](https://github.com/lookfirst/sardine)（以前是[http://code.google.com/p/sardine](http://code.google.com/p/sardine)）

我在这里找到了它： [Java：如何将文件从 servlet 上传到 WebDAV 服务器？](https://stackoverflow.com/questions/2261507/java-how-to-upload-a-file-to-a-webdav-server-from-a-servlet)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-23T18:17:55.477

从来没有用过，但也许 apache commons [vfs](http://commons.apache.org/vfs/)？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-23T18:15:16.187

[Apache 的 Jakarta Project](http://jakarta.apache.org/)有一个[WebDav 构建工具包](http://jakarta.apache.org/slide/wck.html)，应该可以满足这个需求。

# .net - 在 IIS 6 上使用 ASP.NET MVC 站点的客户端证书

> ID：122687
> 
> 赞同：4
> 
> 时间：2008-09-23T18:06:52.743
> 
> 标签：.net, asp.net, asp.net-mvc, iis, iis-6

想要通过客户端证书实现身份验证我遇到了一些问题。

**首先一些事实**

整个站点都在使用 SSL。我正在使用 IIS 6（在 Windows Server 2003 上）并且已将站点配置为接受客户端证书，而不需要它们。然而，大多数浏览器都以某种方式实现，以便它们仅在严格要求时才要求用户提供证书。因此，身份验证模型并不是真正有用。

**我自己的建议**

我的第一个想法是设置`HttpResponse.Status`属性，但它要求第一个空格之前的字符是整数。让浏览器发送客户端证书的有用状态是`403.7 Client certificate required`，这将不起作用（除非您可以覆盖它）。

我还认为我只需将 IIS 配置为要求特定路径的客户端证书，但这 - 当然 - 仅适用于物理文件而不适用于路由。

一种可能的解决方案是创建一个特定的文件夹并要求为其提供客户端证书，这更像是一种黑客攻击而不是一种解决方案。因此，如果有人有更好的建议，我想避免这种情况。

## 澄清

我测试了 Internet Explorer、Firefox 和 Chrome 的浏览器响应（我使用 Chrome 作为主要浏览器，使用 Firefox 作为辅助浏览器）。除非我在 IIS 中根据需要进行配置，否则所有浏览器都不会要求提供客户端证书。

由于我的理解允许 HTTP 状态代码 403.7，因为 RFC 2616 仅将状态代码定义为前三位数字。由于 IIS 6 在需要客户端证书时返回 403.7，我认为发送它会强制 IIS 进入触发要求的特殊模式。

我想现在的问题是如何配置 IIS 以在给定虚拟路径而不是物理路径的情况下要求证书。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T18:16:26.807

当证书只是被请求而不是被要求时，服务器发送的 CertificateRequest 消息没有区别。服务器在这两种情况下都发出相同的请求，并且在客户端未能提供所需证书时简单地终止握手。因此，如果您的浏览器似乎忽略了“请求”，它也应该似乎忽略了“要求”。

检查以下内容：

*   您的浏览器是否配置为忽略所有证书请求，从不发送？
*   您的浏览器是否配置为使用给定证书而不提示用户？（换句话说，你怎么知道浏览器没有发送证书？）
*   您的服务器实际上是否在请求证书？

我测试最后一种情况的方法是使用[OpenSSL](http://www.openssl.org/)（也可在[Cygwin](http://www.cygwin.com/)中使用）工具：

```
openssl s_client -connect server.y.com:443 -msg 
```

服务器发送证书消息后，将插入一个 CertificateRequest 方法，如果它不请求客户端身份验证，则该方法不存在。s_client 输出如下所示：

```
<<< TLS 1.0 Handshake [length 0008], CertificateRequest
    0d 00 00 04 01 01 00 00 
```

如果服务器仅在特定路径上使用客户端身份验证，我不确定它是如何工作的，因为初始 SSL 握手在客户端传输 HTTP 请求之前完成。服务器此时请求新的握手是合理的，但我从未测试过哪些服务器支持这一点。

您可以通过 s_client 手动伪造 HTTP 请求，输入：

```
GET /your/path/here HTTP/1.1[Enter]
Host: server.y.com:443[Enter]
[Enter] 
```

如果您根本没有看到 CertificateRequest 消息，则说明您的服务器设置不正确。

基于目录结构指定安全约束是很常见的，实际上可以很好地简化安全管理。如果这为您提供了解决方案，请不要为此感到难过。

403.7 不是 HTTP 状态码。这是微软“拥抱、扩展和消灭”的诡计吗？无论如何，这听起来不像是正确的方向，因为这是传输层问题，而不是应用层问题。

# wcf - 如何对 IIS 6 托管的 WCF 服务进行负载平衡？

> ID：122688
> 
> 赞同：7
> 
> 时间：2008-09-23T18:07:07.063
> 
> 标签：wcf, iis-6, hostheaders

我们使用 BigIP 在我们的两个 IIS 服务器之间进行负载平衡。我们最近在这两个 Windows Server 2003R2 服务器上部署了由 IIS 6 托管的 WCF 服务。

每台服务器都配置了两个主机头：一个用于负载平衡器地址，第二个主机头仅指向该服务器。这样我们就可以引用负载均衡组中的特定服务器进行调试。

所以当我们运行时我们立即得到了错误：

> **这个集合已经包含一个带有 http 方案的地址。此集合中的每个方案最多可以有一个地址。参数名称：项目**

我做了一些研究，我们可以实现一个过滤器来告诉它忽略其中一个主机，但是我们无法从该地址访问服务器。

```
<serviceHostingEnvironment>
    <baseAddressPrefixFilters>
        <add prefix="http://domain.com:80"/>
    </baseAddressPrefixFilters>
</serviceHostingEnvironment> 
```

[在这种情况下，允许我们通过http://domain.com/service.svc](http://domain.com/service.svc)和[http://server1.domain.com/service.svc 访问](http://server1.domain.com/service.svc)WCF 服务的最佳解决方案是什么？

如果我们应该按照某些网站的建议创建自己的 ServiceFactory，是否有人对此有任何示例代码？

任何帮助深表感谢。

编辑：如果可能的话，我们将需要能够从两个地址中的任何一个访问 WCF 服务。

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T23:18:40.507

在你的 bigIP 上创建 2 个新的虚拟服务器 [http://server1.domain.com/](http://server1.domain.com/) [http://server2.domain.com/](http://server2.domain.com/)

为每个 VS 创建一个池，其中只有特定的服务器 - 因此不会有实际的负载平衡并以这种方式访问​​它。如果您缺少外部 IP，您仍然可以使用与生产域名相同的 IP，并且只需使用 irule 将流量引导到适当的池

希望这可以帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T18:17:54.540

它使用的 URL 基于 IIS 中的绑定。网站是否有多个绑定？如果是，还是多个站点使用 WCF 服务？如果是，那么您就是 SOL AFAIK。我们遇到了这个问题。基本上，HTTP 只能有一个 IIS 绑定，否则它会爆炸。

此外，这里是关于[实现 ServiceHostFactory](http://www.robzelt.com/blog/2007/01/24/WCF+This+Collection+Already+Contains+An+Address+With+Scheme+Http.aspx)的信息。如果您的 WCF 服务可能只能通过 1 个地址访问（不幸的是，这对我们来说是不可能的），那么这将起作用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T09:23:00.390

当您需要测试特定机器时，您可以“绕过”负载平衡并确保发送正确的主机头以通过编辑您正在测试的机器上的“主机”文件来保持 WCF 满意，例如：

10.0.0.11 到 10.0.0.16 是集群“cluster.mycompany.local”中的六台主机，负载平衡 IP 地址为 10.0.0.10。测试时，您可以在机器主机文件中添加一行“10.0.0.13 cluster.mycompany.local”，以便能够直接访问集群中的第三台机器。

# sql-server - 什么是备份 SQL Server 数据库的简单命令行程序或脚本？

> ID：122690
> 
> 赞同：100
> 
> 时间：2008-09-23T18:07:47.233
> 
> 标签：sql-server, command-line, scripting, backup

在我们的内部服务器上执行数据库备份时，我太松懈了。

是否有一个简单的命令行程序可以用来备份 SQL Server 2005 中的某些数据库？还是有一个简单的VBScript？

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2008-09-23T18:15:38.337

要从命令行备份单个数据库，请使用[osql](https://msdn.microsoft.com/en-us/library/ms162806.aspx)或[sqlcmd](https://msdn.microsoft.com/en-us/library/ms162773.aspx)。

```
"C:\Program Files\Microsoft SQL Server\90\Tools\Binn\osql.exe" 
    -E -Q "BACKUP DATABASE mydatabase TO DISK='C:\tmp\db.bak' WITH FORMAT" 
```

您还需要阅读有关[BACKUP](https://msdn.microsoft.com/en-us/library/ms186865.aspx)和[RESTORE](https://msdn.microsoft.com/en-us/library/ms190372.aspx)以及[一般过程](https://msdn.microsoft.com/en-us/library/ms187048.aspx)的文档。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-25T16:14:15.463

我使用[ExpressMaint](http://www.codeplex.com/ExpressMaint)。

例如，要备份所有用户数据库：

```
C:\>ExpressMaint.exe -S (local)\sqlexpress -D ALL_USER -T DB -BU HOURS -BV 1 -B c:\backupdir\ -DS 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-23T18:09:48.007

安排以下备份所有数据库：

```
Use Master

Declare @ToExecute VarChar(8000)

Select @ToExecute = Coalesce(@ToExecute + 'Backup Database ' + [Name] + ' To Disk =     ''D:\Backups\Databases\' + [Name]   + '.bak'' With Format;' + char(13),'')
From
Master..Sysdatabases
Where
[Name] Not In ('tempdb')
and databasepropertyex ([Name],'Status') = 'online'

Execute(@ToExecute) 
```

我的博客上还有更多详细信息：如何[自动化 SQL Server Express 备份](http://gatekiller.co.uk/Post/Automate_SQL_Server_Express_Backups)。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-05-25T22:09:49.223

我在 Microsoft 支持页面[http://support.microsoft.com/kb/2019698](http://support.microsoft.com/kb/2019698)上找到了这个。

效果很好！而且由于它来自微软，我觉得它很合法。

基本上有两个步骤。

1.  在您的主数据库中创建一个存储过程。请参阅 msft 链接，或者如果它已损坏，请在此处尝试：http: [//pastebin.com/svRLkqnq](http://pastebin.com/svRLkqnq)
2.  从您的任务计划程序计划备份。您可能希望先放入 .bat 或 .cmd 文件，然后安排该文件。

    ```
    sqlcmd -S YOUR_SERVER_NAME\SQLEXPRESS -E -Q "EXEC sp_BackupDatabases @backupLocation='C:\SQL_Backup\', @backupType='F'"  1>c:\SQL_Backup\backup.log 
    ```

显然，将 YOUR_SERVER_NAME 替换为您的计算机名称，或者选择尝试 .\SQLEXPRESS 并确保备份文件夹存在。在这种情况下，它试图将其放入 c:\SQL_Backup

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2017-11-30T15:04:43.407

您可以通过 ApexSQL 使用备份应用程序。虽然它是一个 GUI 应用程序，但它的所有功能都在 CLI 中支持。可以执行一次性备份操作，也可以创建一个定期备份指定数据库的作业。您可以查看文章中的切换规则和示例：

*   [ApexSQL 备份 CLI 支持](https://knowledgebase.apexsql.com/apexsql-backup-cli-support/)
*   [ApexSQL 备份 CLI 示例](https://knowledgebase.apexsql.com/apexsql-backup-cli-examples/)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-06-12T18:08:47.933

我在 Linux/UNIX 基础架构上使用 tsql 来访问 MSSQL 数据库。这是一个将表转储到文件的简单 shell 脚本：

```
#!/usr/bin/ksh
#
#.....
(
tsql -S {database} -U {user} -P {password} <<EOF
select * from {table}
go
quit
EOF
) >{output_file.dump} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-06-25T12:49:44.207

最终，如果您没有 –E 开关声明的受信任连接

使用以下命令行

`"[program dir]\[sql server version]\Tools\Binn\osql.exe" -Q "BACKUP DATABASE mydatabase TO DISK='C:\tmp\db.bak'" -S [server] –U [login id] -P [password]`

在哪里

[program dir]是osql.exe所在的目录

```
在 32 位操作系统上 c:\Program Files\Microsoft SQL Server\
```

```
在 64 位操作系统上 c:\Program Files (x86)\Microsoft SQL Server\
```

[sql server version] 你的sql server version 110 or 100 or 90 or 80 开头最大数

[服务器] 你的服务器名称或服务器 ip

[登录 id] 你的 ms-sql 服务器用户登录名

[密码] 所需的登录密码

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-05-06T20:27:10.630

Microsoft 对在 SQL Express 上备份所有用户数据库的回答[如下](https://support.microsoft.com/en-us/help/2019698/how-to-schedule-and-automate-backups-of-sql-server-databases-in-sql-se)：

该过程是：复制、粘贴和执行他们的代码（见下文。我在顶部注释了一些奇怪的未注释行）作为数据库服务器上的查询。这意味着您应该首先安装 SQL Server Management Studio（或者使用 SSMS 连接到您的数据库服务器）。此代码执行将在您的数据库服务器上创建一个存储过程。

创建一个批处理文件来执行存储过程，然后使用任务计划程序来安排该批处理文件的定期（例如每晚）运行。我的代码（有效）是他们第一个示例的略微修改版本：

```
sqlcmd -S .\SQLEXPRESS -E -Q "EXEC sp_BackupDatabases @backupLocation='E:\SQLBackups\', @backupType='F'" 
```

这对我有用，我喜欢它。每次运行它时，都会创建新的备份文件。您需要设计一种定期删除旧备份文件的方法。我已经有一个做这种事情的例程，所以我会在磁盘上保留几天的备份（足够长的时间让他们得到我的正常备份例程的备份），然后我会删除它们。换句话说，我手头上总是有几天的备份，而不必从我的备份系统中恢复。

我将在下面粘贴 Microsoft 的存储过程创建脚本：

```
--// Copyright © Microsoft Corporation.  All Rights Reserved.
--// This code released under the terms of the
--// Microsoft Public License (MS-PL, http://opensource.org/licenses/ms-pl.html.)

USE [master] 
GO 

/****** Object:  StoredProcedure [dbo].[sp_BackupDatabases] ******/ 

SET ANSI_NULLS ON 
GO 

SET QUOTED_IDENTIFIER ON 
GO 

-- ============================================= 
-- Author: Microsoft 
-- Create date: 2010-02-06
-- Description: Backup Databases for SQLExpress
-- Parameter1: databaseName 
-- Parameter2: backupType F=full, D=differential, L=log
-- Parameter3: backup file location
-- =============================================

CREATE PROCEDURE [dbo].[sp_BackupDatabases]  
            @databaseName sysname = null,
            @backupType CHAR(1),
            @backupLocation nvarchar(200) 
AS 

       SET NOCOUNT ON; 

            DECLARE @DBs TABLE
            (
                  ID int IDENTITY PRIMARY KEY,
                  DBNAME nvarchar(500)
            )

             -- Pick out only databases which are online in case ALL databases are chosen to be backed up

             -- If specific database is chosen to be backed up only pick that out from @DBs

            INSERT INTO @DBs (DBNAME)
            SELECT Name FROM master.sys.databases
            where state=0
            AND name=@DatabaseName
            OR @DatabaseName IS NULL
            ORDER BY Name

           -- Filter out databases which do not need to backed up

           IF @backupType='F'
                  BEGIN
                  DELETE @DBs where DBNAME IN ('tempdb','Northwind','pubs','AdventureWorks')
                  END
            ELSE IF @backupType='D'
                  BEGIN
                  DELETE @DBs where DBNAME IN ('tempdb','Northwind','pubs','master','AdventureWorks')
                  END
            ELSE IF @backupType='L'
                  BEGIN
                  DELETE @DBs where DBNAME IN ('tempdb','Northwind','pubs','master','AdventureWorks')
                  END
            ELSE
                  BEGIN
                  RETURN
                  END

            -- Declare variables

            DECLARE @BackupName varchar(100)
            DECLARE @BackupFile varchar(100)
            DECLARE @DBNAME varchar(300)
            DECLARE @sqlCommand NVARCHAR(1000) 
        DECLARE @dateTime NVARCHAR(20)
            DECLARE @Loop int                  

            -- Loop through the databases one by one

            SELECT @Loop = min(ID) FROM @DBs
       WHILE @Loop IS NOT NULL
      BEGIN

-- Database Names have to be in [dbname] format since some have - or _ in their name

      SET @DBNAME = '['+(SELECT DBNAME FROM @DBs WHERE ID = @Loop)+']'

-- Set the current date and time n yyyyhhmmss format

      SET @dateTime = REPLACE(CONVERT(VARCHAR, GETDATE(),101),'/','') + '_' +  REPLACE(CONVERT(VARCHAR, GETDATE(),108),':','')  

-- Create backup filename in path\filename.extension format for full,diff and log backups

      IF @backupType = 'F'
            SET @BackupFile = @backupLocation+REPLACE(REPLACE(@DBNAME, '[',''),']','')+ '_FULL_'+ @dateTime+ '.BAK'
      ELSE IF @backupType = 'D'
            SET @BackupFile = @backupLocation+REPLACE(REPLACE(@DBNAME, '[',''),']','')+ '_DIFF_'+ @dateTime+ '.BAK'
      ELSE IF @backupType = 'L'
            SET @BackupFile = @backupLocation+REPLACE(REPLACE(@DBNAME, '[',''),']','')+ '_LOG_'+ @dateTime+ '.TRN'

-- Provide the backup a name for storing in the media

      IF @backupType = 'F'
            SET @BackupName = REPLACE(REPLACE(@DBNAME,'[',''),']','') +' full backup for '+ @dateTime

      IF @backupType = 'D'
            SET @BackupName = REPLACE(REPLACE(@DBNAME,'[',''),']','') +' differential backup for '+ @dateTime

      IF @backupType = 'L'
            SET @BackupName = REPLACE(REPLACE(@DBNAME,'[',''),']','') +' log backup for '+ @dateTime

-- Generate the dynamic SQL command to be executed

       IF @backupType = 'F' 
                  BEGIN
               SET @sqlCommand = 'BACKUP DATABASE ' +@DBNAME+  ' TO DISK = '''+@BackupFile+ ''' WITH INIT, NAME= ''' +@BackupName+''', NOSKIP, NOFORMAT'
                  END

       IF @backupType = 'D'
                  BEGIN
               SET @sqlCommand = 'BACKUP DATABASE ' +@DBNAME+  ' TO DISK = '''+@BackupFile+ ''' WITH DIFFERENTIAL, INIT, NAME= ''' +@BackupName+''', NOSKIP, NOFORMAT'        
                  END

       IF @backupType = 'L' 
                  BEGIN
               SET @sqlCommand = 'BACKUP LOG ' +@DBNAME+  ' TO DISK = '''+@BackupFile+ ''' WITH INIT, NAME= ''' +@BackupName+''', NOSKIP, NOFORMAT'        
                  END

-- Execute the generated SQL command

       EXEC(@sqlCommand)

-- Goto the next database

SELECT @Loop = min(ID) FROM @DBs where ID>@Loop

END​ 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-10-08T10:42:34.620

**这是一个示例，它将备份数据库，使用7zip压缩并删除备份文件，因此与存储相关的问题也解决了。在这个例子中，我使用 7zip，它是免费的**

```
@echo off

CLS

echo Running dump ...

sqlcmd -S SERVER\SQLEXPRESS -U username -P password -Q "BACKUP DATABASE master TO DISK='D:\DailyDBBackup\DB_master_%date:~-10,2%%date:~-7,2%%date:~-4,4%.bak'"

echo Zipping ...

"C:\Program Files\7-Zip\7z.exe" a -tzip "D:\DailyDBBackup\DB_master_%date:~-10,2%%date:~-7,2%%date:~-4,4%_%time:~0,2%%time:~3,2%%time:~6,2%.bak.zip" "D:\DailyDBBackup\DB_master_%date:~-10,2%%date:~-7,2%%date:~-4,4%.bak"

echo Deleting the SQL file ...

del "D:\DailyDBBackup\DB_master_%date:~-10,2%%date:~-7,2%%date:~-4,4%.bak"

echo Done! 
```

将此保存为 sqlbackup.bat 并安排它每天运行。

如果您只想进行备份，那么您可以创建脚本而无需压缩和删除。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-09-11T20:10:41.260

您可以使用我专门为此目的编写的 VB 脚本： [https ://github.com/ezrarieben/mssql-backup-vbs/](https://github.com/ezrarieben/mssql-backup-vbs/)

在“任务计划程序”中安排任务以根据需要执行脚本，它将整个数据库备份到 BAK 文件并将其保存在您指定的任何位置。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-04-10T09:29:02.500

```
SET NOCOUNT ON;
declare @PATH VARCHAR(200)='D:\MyBackupFolder\'
 -- path where you want to take backups
IF OBJECT_ID('TEMPDB..#back') IS NOT NULL

DROP TABLE #back

CREATE TABLE #back
(
RN INT IDENTITY (1,1),
DatabaseName NVARCHAR(200)

)

INSERT INTO #back 
SELECT       'MyDatabase1'
UNION SELECT 'MyDatabase2'
UNION SELECT 'MyDatabase3'
UNION SELECT 'MyDatabase4'

-- your databases List

DECLARE @COUNT INT =0 ,  @RN INT =1, @SCRIPT NVARCHAR(MAX)='',  @DBNAME VARCHAR(200)

PRINT '---------------------FULL BACKUP SCRIPT-------------------------'+CHAR(10)
SET @COUNT = (SELECT COUNT(*) FROM #back)
PRINT 'USE MASTER'+CHAR(10)
WHILE(@COUNT > = @RN)
BEGIN

SET @DBNAME =(SELECT DatabaseName FROM #back WHERE RN=@RN)
SET @SCRIPT ='BACKUP DATABASE ' +'['+@DBNAME+']'+CHAR(10)+'TO DISK =N'''+@PATH+@DBNAME+ N'_Backup_'
+ REPLACE ( REPLACE ( REPLACE ( REPLACE ( CAST ( CAST ( GETDATE () AS DATETIME2 ) AS VARCHAR ( 100 )), '-' , '_' ), ' ' , '_' ), '.' , '_' ), ':' , '' )+'.bak'''+CHAR(10)+'WITH COMPRESSION, STATS = 10'+CHAR(10)+'GO'+CHAR(10)
PRINT @SCRIPT
SET @RN=@RN+1
END

 PRINT '---------------------DIFF BACKUP SCRIPT-------------------------'+CHAR(10)

  SET  @COUNT  =0 SET  @RN  =1 SET @SCRIPT ='' SET @DBNAME =''
 SET @COUNT = (SELECT COUNT(*) FROM #back)
PRINT 'USE MASTER'+CHAR(10)
WHILE(@COUNT > = @RN)
BEGIN
SET @DBNAME =(SELECT DatabaseName FROM #back WHERE RN=@RN)
SET @SCRIPT ='BACKUP DATABASE ' +'['+@DBNAME+']'+CHAR(10)+'TO DISK =N'''+@PATH+@DBNAME+ N'_Backup_'
+ REPLACE ( REPLACE ( REPLACE ( REPLACE ( CAST ( CAST ( GETDATE () AS DATETIME2 ) AS VARCHAR ( 100 )), '-' , '_' ), ' ' , '_' ), '.' , '_' ), ':' , '' )+'.diff'''+CHAR(10)+'WITH DIFFERENTIAL, COMPRESSION, STATS = 10'+CHAR(10)+'GO'+CHAR(10)
PRINT @SCRIPT
SET @RN=@RN+1
END 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-04-14T18:38:05.950

当您在日常工作中处理 dockerised mssql 容器并希望从表中快速转储数据时，这会很有帮助。当您非常频繁地重新构建 db 容器并且不想在重新构建后丢失测试数据时，我特别发现它很有用。

```
Export data using bcp utility
/opt/mssql-tools/bin/bcp <Table_Name> out /tmp/MyData.bcp -d <database_name> -c -U <user_name> -P "<password>" -S <server_name>

Import data using bcp utility

/opt/mssql-tools/bin/bcp <Table_Name> IN /tmp/MyData.bcp -d <database_name> -c -U <user_name> -P "<password>" -S <server_name> 
```

* * *

## 回答 #13

> 赞同：-10
> 
> 时间：2008-09-23T18:14:48.557

如果你能找到数据库文件...“cp DBFiles backup/”

*在大多数情况下几乎可以肯定是**不可取***的，但这就像所有的起床一样简单。

# c# - 如何在 ASP.NET 2.0 中读取 HttpResponse？

> ID：122695
> 
> 赞同：3
> 
> 时间：2008-09-23T18:08:13.940
> 
> 标签：c#, asp.net, httpresponse

例如，我有一个由另一个 aspx 调用的 ASP.NET 表单：

```
string url = "http://somewhere.com?P1=" + Request["param"];
Response.Write(url); 
```

我想做这样的事情：

```
string url = "http://somewhere.com?P1=" + Request["param"];
string str = GetResponse(url);
if (str...) {} 
```

我需要得到任何 Response.Write 得到的结果或去 url，操纵那个响应，然后发回其他东西。

任何帮助或正确方向的观点将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T18:10:06.557

```
WebClient client = new WebClient();
string response = client.DownloadString(url); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T18:11:39.330

Webclient.DownloadString() 可能是你想要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:10:50.393

您将需要使用 HttpWebRequest 和 HttpWebResponse 对象。您还可以使用 WebClient 对象

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:13:13.820

HttpResponse 是响应 HttpRequest 发送回客户端的内容。如果您想在服务器上处理某些内容，那么您可以使用 Web 服务调用或页面方法来完成。但是，我不完全确定我首先了解您要做什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T18:32:20.513

WebClient.DownloadString 完全成功了。我把自己也卷入了这个..当我过去使用 WebClient.DownloadFile 时，我正在查看 HttpModule 和 HttpHandler。

非常感谢所有回复的人。

# java - 帮助在 Tomcat 5.5.x 中使用嵌入式 JBoss 配置 JNDI

> ID：122714
> 
> 赞同：5
> 
> 时间：2008-09-23T18:11:09.707
> 
> 标签：java, jboss, seam, jndi, embedded-jboss

当我在我的代码中尝试以下查找时：

```
Context initCtx = new InitialContext();
Context envCtx = (Context) initCtx.lookup("java:comp/env");
return (DataSource) envCtx.lookup("jdbc/mydb"); 
```

我得到以下异常：

```
java.sql.SQLException: QueryResults: Unable to initialize naming context: 
    Name java:comp is not bound in this Context at 
    com.onsitemanager.database.ThreadLocalConnection.getConnection
    (ThreadLocalConnection.java:130) at     
    ... 
```

我按照 JBoss [wiki 说明](http://wiki.jboss.org/wiki/Tomcat5.5.x?action=e&windowstate=normal&mode=view)安装了嵌入式 JBoss 。我使用[配置 wiki 页面](http://wiki.jboss.org/wiki/EmbeddedAndTomcat)中指定的“默认扫描每个 WAR”部署来配置 Tomcat 。

引用配置页面：

> JNDI
> 
> 嵌入式 JBoss 组件（如连接池、EJB、JPA 和事务）广泛使用 JNDI 来发布服务。嵌入式 JBoss 通过将自身置于 Tomcat 的 JNDI 实例之上来覆盖 Tomcat 的 JNDI 实现。> 原因有以下几点：
> 
> 1.  为了避免必须在 server.xml 中声明这些服务中的每一项
> 2.  允许在 Web 应用程序和 EJB 之间无缝集成 java:comp 命名空间。
> 3.  Tomcat 的 JNDI 实现中存在一些严重的错误，这些错误会妨碍某些 JBoss 组件的工作能力
> 4.  我们希望为您提供远程 EJB 和其他可以远程查找的服务的选项

任何人对我如何配置 JBoss 命名服务有任何想法，根据上面的引用，它会覆盖 Tomcat 的 JNDI 实现，以便我可以在 java:comp/env 上进行查找？

仅供参考 - 我的环境 Tomcat 5.5.9，Seam 2.0.2sp，嵌入式 JBoss（Beta 3），

注意：我确实有一个 -ds.xml 文件，用于根据说明正确设置并在类路径上访问我的数据库连接。

另请注意：我已经在嵌入式 Jboss 论坛和 seam 用户论坛中发布了这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T19:33:23.830

感谢您的响应工具包....是的，我可以通过直接访问 java:jdbc/mydb 来访问我的数据源，但我使用的是通过 ENC 连接的现有代码库。这是我发现的一些有趣的信息......

1.  上面的代码适用于**JBoss 4.2.2.GA**，这里是使用的 JNDI ctx 参数：
    java.naming.factory.initial=org.jnp.interfaces.NamingContextFactory java.naming.factory.url.pkgs=org.jboss.naming :org.jnp.interfaces: org.jboss.naming:org.jnp.interfaces

2.  上面的代码适用于**Tomcat 5.5.x**，这里是使用的 JNDI ctx 参数：
    java.naming.factory.initial=org.apache.naming.java.javaURLContextFactory java.naming.factory.url.pkgs=org.apache.naming

3.  上述代码在 Tomcat 5.5.x 中使用**Embedded JBoss (Beta 3)**失败，并显示上述错误消息。
    java.naming.factory.initial=org.apache.naming.java.javaURLContextFactory java.naming.factory.url.pkgs=org.apache.naming上面的代码在tomcat 5.5.x中使用JBoss Embedded时出现上述错误

有人对我配置嵌入式 JBoss JNDI 配置需要做什么有任何想法吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T18:26:31.027

java:comp/env 被称为企业命名上下文 (ENC)，它不是全局可见的。请参阅[此处](http://www.informit.com/articles/article.aspx?p=384904)了解更多信息。您将需要找到您的数据源注册所在的全局 JNDI 名称。

最简单的方法是导航到 JBoss 的基于 Web 的 JMX 控制台并查找“JNDIView”（不完全确定名称 - 目前在家里）mbean。这个 mbean 应该有一个可以调用的 list 方法，它将显示所有 JNDI 绑定对象的上下文路径。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-07T10:58:22.473

我在 Jboss Embedded 上遇到了一些类似的问题，我终于修复了在文件中播放的问题：test-Datasource-ds.xml

添加

```
<mbean code="org.jboss.naming.NamingAlias" name="jboss.jmx:alias=testDatasource">
    <attribute name="FromName">jdbc/Example DataSource</attribute>
    <attribute name="ToName">java:/testDatasource</attribute>
</mbean> 
```

问题是 jboss 为声明的所有数据源添加前缀 java:/。所以最后我有一个名为 testDatasource 的数据源，用 jdbc/Example DataSource 的指令覆盖

希望它有效

# java - .Net System.Data 是否有 Java 等价物？

> ID：122724
> 
> 赞同：4
> 
> 时间：2008-09-23T18:13:47.593
> 
> 标签：java, .net, database

是否有提供类似 .Net System.Data 命名空间的功能的 Java 包？特别是 DataSet 和 Adapter 类？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T12:16:38.403

将[java.util](http://java.sun.com/javase/6/docs/api/java/util/package-summary.html)用于集合。 [java.sql](http://java.sun.com/javase/6/docs/api/java/sql/package-summary.html)用于数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T13:39:02.327

与 ADO.NET 等效的是 JDBC。你可以在这里得到它的味道：

[http://www.heimetli.ch/jdbc/JDBCQuery.html](http://www.heimetli.ch/jdbc/JDBCQuery.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T18:33:38.310

ADO.NET 是一个具有多种用途的框架，DataSet 是主要的抽象之一。告诉我们更多关于您想要实现的目标，我相信有人会为此目的找到一个 Java 框架。

如果您想要一种将 Java 对象映射到数据后端（如 XML 文件）的简单方法，请查看一些 POJO（普通旧 Java 对象）框架。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T19:05:15.147

[Hibernate](http://hibernate.org/)是 Java 世界中流行的框架。对象到表的非常简单的映射等等。

# java - pl sql & java - 创建动态查询

> ID：122728
> 
> 赞同：2
> 
> 时间：2008-09-23T18:14:30.010
> 
> 标签：java, plsql

我进退两难，我正在使用 Java 和 Oracle，并试图在 PL/SQL 端保留查询。一切都很好，直到我有这些可能有条件也可能没有条件的复杂查询。

在 Java 中将`WHERE`子句与条件放在一起并不难，但这并不好。在 PL/SQL 方面，我还发现唯一的可能性`dynamic queries`是字符串操作，例如

```
IF inputname IS NOT NULL THEN    
    query := query ||' and NAME=' || inputname; 
END IF; 
```

现在我在想，我将在 PL/SQL 中留下查询并发送`WHERE`带有函数参数的子句。请问有什么好的建议或例子吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T18:18:23.947

[SQLBuilder](http://openhms.sourceforge.net/sqlbuilder/)在 Java 方面可能对您有用。它允许您编写动态构建 sql 的编译时检查 Java 代码：

```
String selectQuery =
  (new SelectQuery())
  .addColumns(t1Col1, t1Col2, t2Col1)
  .addJoin(SelectQuery.JoinType.INNER_JOIN, joinOfT1AndT2)
  .addOrderings(t1Col1)
  .validate().toString(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T18:25:16.270

正如您所发现的，PL/SQL 不适合创建动态 SQL，它的字符串操作很痛苦。您可以从客户端发送 where 子句，但您必须确保检查 SQL 注入，即确保该短语以“where”开头，没有分号或仅在末尾（如果它可能出现在中间您需要从字符串分隔符中查看，并且只允许在其中使用）等。另一个选项是一个存储过程，它采用字段过滤器的预定义参数列表，对参数字段应用每列的“喜欢”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T19:12:58.950

I think its better to have the whole logic of the query creation in one place, Java or Oracle. I asume that you know how to do it in Java. In Oracle if the query only retrieves a row you can use the EXECUTE IMMEDIATE ... INTO clause.

If the query return multiple rows and has single parameters (no use the IN operator ) you can use the REF CURSOR strategy to loop the query results or return the cursor itself to the Java program (you must import Oracle java clases if you use it). [First Ref Cursor answer in Google](http://www.oradev.com/ref_cursor.jsp)

If you must use the IN parameter ( or in another rare cases) you must parse the query with the DBMS_SQL package, which is TOO verbose and a little tricky to use, but it's VERY flexible. [DBMS_SQL doc](http://www.psoug.org/reference/dbms_sql.html) (watch the flow diagram BEFORE read the methods)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:21:38.870

在 PL/SQL 中使用：

```
EXECUTE IMMEDIATE lString; 
```

这使您可以将 lString（一个 VARCHAR2）构建到您想要使用的大部分 SQL 中。例如

```
 EXECUTE IMMEDIATE 'SELECT  value
                     FROM    TABLE
                     WHERE   '||pWhereClause
  INTO    lValue; 
```

您还可以在 EXECUTE IMMEDIATE 中返回多行并执行 DDL 语句。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T18:55:29.880

是的，EXECUTE IMMEDIATE 也是我的朋友。感谢您的建议。我想这次我尝试只发送带参数的 WHERE 子句

# oracle - 解释存储过程中的查询计划

> ID：122736
> 
> 赞同：8
> 
> 时间：2008-09-23T18:15:34.873
> 
> 标签：oracle

我有一个存储过程，它由一个选择查询组成，该查询基于对过程中的参数进行的一些次要数学运算插入到另一个表中。我可以通过以某种方式引用该过程来生成用于此查询的计划，还是我必须复制并粘贴查询并为输入参数创建绑定变量？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T18:26:21.510

使用[SQL Trace 和 TKPROF](http://68.142.116.68/docs/cd/B19306_01/server.102/b14211/sqltrace.htm#i4640)。例如，打开 SQL*Plus，然后发出以下代码：-

```
alter session set tracefile_identifier = 'something-unique'
alter session set sql_trace = true;
alter session set events '10046 trace name context forever, level 8';

select 'right-before-my-sp' from dual;
exec your_stored_procedure

alter session set sql_trace = false; 
```

完成此操作后，请在数据库的 UDUMP 目录中查找文件名中带有“something-unique”的 TRC 文件。用 TKPROF 格式化这个 TRC 文件，然后打开格式化的文件并搜索字符串“right-before-my-sp”。您的存储过程发出的 SQL 命令应该在本节之后不久，并且紧接在该 SQL 语句的下方将是 SQL 语句的计划。

**编辑：**为了充分披露，我应该感谢上周在[这个线程上给我答案的所有那些帮助我学习如何做到这一点的人。](https://stackoverflow.com/questions/104066/how-do-i-troubleshoot-performance-problems-with-an-oracle-sql-statement)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T18:24:09.783

据我了解，这是故意的。这个想法是优化器单独考虑过程中的各个查询，因此 EXPLAIN PLAN 对于可能包含多个查询/语句的存储过程没有意义。

当前的答案是否定的，您不能针对 proc 运行它，并且必须针对各个语句本身运行它。当你有变量和计算时会很棘手，但事实就是这样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:25:29.390

许多工具（例如 Toad 或 SQL Developer）会在您执行解释计划时提示您输入绑定变量值。您必须在 SQL*Plus 或其他工具中手动执行此操作。

您还可以打开 SQL 跟踪并执行存储过程，然后从跟踪文件中检索解释计划。

请注意不要只检索 SELECT 语句的解释计划。INSERT 子句的存在可以将优化器目标从第一行更改为所有行。

# error-handling - SQL Try-Catch 块可以处理抛出的 CLR 错误吗？

> ID：122739
> 
> 赞同：3
> 
> 时间：2008-09-23T18:16:00.397
> 
> 标签：error-handling, clr, try-catch

我们正在使用 SQL 2005 和 try-catch 功能来处理数据库中的所有错误处理。我们目前正在部署一个 .NET CLR 函数以在数据库中进行一些 WCF 调用。此 WCF 过程在 CLR 中编写，然后部署到 SQL。如果我在 CLR 代码中放置一个 try-catch 块，它会很好地捕获错误。但是，我似乎无法将错误抛出到 SQL 中的 try-catch 块。SQL 似乎忽略了我抛出的内容并捕获了它发现的错误。两者之间是否没有关系（即我不能从一个扔到另一个？）

如果我可以从 CLR 中抛出到 SQL 中的调用过程，是否需要任何特殊格式？我尝试了捕获抛出的错误，然后抛出不同的错误的特定情况，但是 SQL 忽略了我抛出的错误并捕获了原始错误，就好像它忽略了抛出的错误一样。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T18:44:48.330

这是一篇高层次的博客文章： [SQLCLR 中的异常处理](http://blogs.msdn.com/sqlclr/archive/2006/06/29/651649.aspx "SQL Server 2005：关于异常处理的 CLR 集成博客文章")

> 当 SQL Server 执行在 CLR 中实现的用户函数/过程/触发器（即托管代码）时，我们将在用户代码周围安装一个托管异常处理程序。因此，如果用户代码泄露了一个异常，服务器将捕获它并抛出一个包装用户异常的 TSQL 异常。

这似乎意味着它会起作用。

# unit-testing - 测试随机值 - 对这种方法的想法？

> ID：122741
> 
> 赞同：8
> 
> 时间：2008-09-23T18:16:23.390
> 
> 标签：unit-testing, testing, random, automated-tests

好的，我一直在研究随机图像选择器和队列系统（所以你不会经常看到相同的图像）。

一切都在顺利进行（就我糟糕的代码而言）**，直到**我到达随机位。我想测试它，但你如何测试它？没有`Debug.Assert(i.IsRandom)`（可悲）：D

所以，我在用茶给它浇水后开始思考它并想出了以下内容，我只是想知道我是否可以有你的想法？

*   基本上我知道**随机**位是问题所在，所以我把它撕掉给一个委托（然后将它传递给对象构造函数）。
*   然后我创建了一个类，它执行的逻辑几乎与*实时*代码相同，但会记住在私有变量中选择的值。
*   然后我把那个代表扔到了现场课堂上并对此进行了测试：

IE

```
Debug.Assert(myObj.RndVal == RndIntTester.ValuePassed); 
```

但我忍不住想，**我是在浪费时间吗？**我通过大量的迭代运行它，看看它是否会在任何时候倒下等。

你认为我在这件事上浪费时间吗？或者我可以逃脱：

![真棒随机数生成器](https://imgs.xkcd.com/comics/random_number.png)

[GateKiller 的回答](https://stackoverflow.com/questions/122741/testing-for-random-value-thoughts-on-this-approach#122765)让我想起了这一点：

![呆伯特随机](https://www.random.org/analysis/dilbert.jpg)

## 更新澄清

*   **我应该补充一点，我基本上不想从 Y 大小的池中看到相同的结果超过 X 次。**
*   测试容器的添加基本上让我可以查看之前选择的任何图像是否是“随机”选择的。
*   从技术上讲，我猜这里正在测试的东西不是 RNG（因为我从未编写过该代码），而是我期望来自有限池的*随机*结果，并且我想跟踪它们。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T18:49:18.397

从要求测试：“所以你不会经常看到相同的图像”

要求 100 张图片。您是否经常看到图像？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T19:01:44.263

维基百科上有一个[统计随机性](http://en.wikipedia.org/wiki/Statistical_randomness)测试和[相关研究的方便列表。](http://en.wikipedia.org/wiki/Randomness_tests)请注意，您无法确定其中大多数来源是真正随机的，您只是排除了一些可能很容易预测的方式。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-23T18:31:46.333

如果您有一组固定的项目，并且您不希望它们过于频繁地重复，请随机打乱集合。然后您将确保您不会连续两次看到相同的图像，感觉就像您正在收听 Top 20 广播等。您将在重复之前完整浏览该集合。

```
Item[] foo = …
for (int idx = foo.size(); idx > 1; --idx) {
  /* Pick random number from half-open interval [0, idx) */
  int rnd = random(idx); 
  Item tmp = foo[idx - 1];
  foo[idx - 1] = foo[rnd];
  foo[rnd] = tmp;
} 
```

如果您有太多的项目需要一次收集和洗牌（存储库中有成千上万的图像），您可以在相同的方法中添加一些分而治之的方法。洗牌图像组，然后洗牌每组。

听起来可能适用于您修改后的问题陈述的稍微不同的方法是让您的“图像选择器”实现将其最近的选择历史保留在最多`Y`长度的队列中。在返回一张图片之前，它会测试它是否`X`已经在队列中，如果是，它会随机选择另一个，直到找到一个通过。

如果您真的要问测试随机数生成器的质量，我将不得不打开统计书。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T18:20:43.113

不可能测试一个值是否真的是随机的。您能做的最好的事情就是多次执行测试并测试您是否获得了适当的分布，但如果结果确实是随机的，那么即使这也有（非常小）失败的机会。

如果您正在进行白盒测试，并且您知道随机种子，那么您实际上可以计算预期结果，但您可能需要单独的测试来测试 RNG 的随机性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T18:38:16.817

> 随机数的生成太重要了，不能靠运气。——罗伯特·R·科维尤

解决心理问题：

防止明显重复的一个不错的方法是从全套中随机选择一些项目，丢弃重复项。播放这些，然后选择另外几个。“几”是多少取决于你玩它们的速度和整套的大小，但例如避免在“20”中的较大者内重复，“5 分钟”可能没问题。做用户测试——作为程序员，你会厌倦幻灯片，你不是一个好的测试对象。

要测试随机化代码，我会说：

第 1 步：指定代码必须如何将原始随机数映射到您的域中的选择，并确保您的代码正确使用随机数生成器的输出。通过模拟生成器来测试它（或者如果它是 PRNG，则使用已知的测试值播种它）。

第 2 步：确保生成器对于您的目的足够随机。如果你使用了库函数，你可以通过阅读文档来做到这一点。如果你自己写，为什么？

第 3 步（仅限高级统计学家）：对生成器的输出运行一些随机性统计测试。确保您知道测试中错误失败的概率是多少。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T06:59:14.913

有一整本书可以写关于随机性和评估某些东西是否*看起来*是随机的，但我会为你保存数学页面。简而言之，您可以使用[卡方检验](http://en.wikipedia.org/wiki/Pearson%27s_chi-square_test)来确定明显的“随机”分布与您的期望的匹配程度。

如果您使用 Perl，您可以使用[Statistics::ChiSquare](http://search.cpan.org/perldo?Statistics::ChiSquare)模块为您完成繁重的工作。

但是，如果您想确保图像分布均匀*，*那么您可能不希望它们真正随机。相反，我建议您获取整个图像列表，对该列表进行洗牌，然后在需要“随机”图像时从中删除一个项目。当列表为空时，您重新构建它，重新洗牌并重复。

这种技术意味着给定一组图像，每个单独的图像在您的列表中每次迭代都不能出现多次。您的图像不能不均匀分布。

祝一切顺利，

保罗

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T19:09:47.023

*Random*和类似函数给您的只是伪随机数，即通过函数产生的一系列数字。通常，您给该函数提供第一个输入参数（也称为“种子”），用于产生第一个“随机”数字。之后，每个最后一个值都用作循环下一次迭代的输入参数。您可以查看有关“伪随机数生成器”的维基百科文章，那里的解释非常好。

所有这些算法都有一个共同点：**该系列在多次迭代后会重复自身**。请记住，这些并不是真正的随机数，只是*看似*随机的一系列数字。要选择一个发电机而不是另一个，你需要问自己：你想要它做什么？

你如何测试随机性？确实可以。有很多测试。当然，第一个也是最简单的方法是大量运行伪随机数生成器，并编译每个结果出现的次数。最后，每个结果应该出现多次非常接近（迭代次数）/（可能结果的数量）。这个标准偏差越大，你的发电机越差。

第二个是：你当时使用了多少随机数？2、3? 将它们成对（或三胞胎）并重复之前的实验：经过非常长的迭代次数后，每个预期结果应该至少出现一次，并且每个结果出现的次数应该不会太远预期的。有一些生成器一次可以使用一个或 2 个，但是当您使用 3 个或更多时会发生惊人的故障（RANDU 有人吗？）。

还有其他更复杂的测试：有些涉及以对数刻度绘制结果，或者在中间有一个圆圈的平面上，然后计算有多少图落在其中，其他......我相信上面的 2 应该足够了大多数时候（除非你是一个挑剔的数学家）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T18:19:36.737

随机就是随机。即使同一张图片连续出现 4 次，它仍然可以被认为是随机的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T18:22:13.533

我的观点是，任何随机的东西都无法正确测试。

当然你可以尝试测试它，但是有很多组合可以尝试，你最好只依靠 RNG 并抽查大量案例。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T18:25:46.770

好吧，问题在于定义上的随机数*可以*重复（因为它们是......等待它：随机）。也许您想要做的是保存最新的随机数并将计算出的随机数与该随机数进行比较，如果相等，则计算另一个...但是现在您的数字不*那么随机*了（我知道没有“或多或少”之类的东西随机性，但这次让我使用这个词），因为它们保证不会重复。

无论如何，你永远不应该过多考虑随机数。:)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T18:27:37.623

正如其他人指出的那样，不可能真正测试随机性。您可以（并且应该）将随机性包含在一个特定方法中，然后为其他所有方法编写单元测试。这样，您可以测试所有其他功能，假设您可以从最后一部分中获得一个随机数。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-23T18:35:16.543

存储随机值，在使用下一个生成的随机数之前，检查存储的值。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-23T18:40:43.067

任何好的伪随机数生成器都可以让你播种生成器。如果您使用相同的数字作为生成器的种子，则生成的随机数流将是相同的。那么为什么不播种随机数生成器，然后根据特定的数字流创建单元测试呢？

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-23T19:06:34.610

要获得一系列不重复的随机数：

1.  创建一个随机数列表。
2.  为每个随机数添加一个序列号
3.  按原始随机数对有序列表进行排序
4.  使用您的序列号作为新的随机数。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-23T19:09:07.663

不要测试随机性，测试你得到的结果是否合意（或者，在接受你的结果可能是合意的之前，尝试获得不合意的结果几次）。如果您正在测试随机输出，将不可能确保您永远不会得到不想要的结果，但您至少可以增加您注意到它发生的机会。

我要么取 N 个 Y 大小的池，检查出现超过 X 次的任何结果，要么取一个 N*Y 大小的池，检查每组 Y 大小的任何结果出现超过 X 次（1到 Y、2 到 Y + 1、3 到 Y + 2 等）。N 是多少取决于您希望测试的可靠性。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-23T19:25:16.110

随机数是从分布中生成的。在这种情况下，每个值都应该具有相同的出现概率。如果你计算无限数量的随机数，你会得到精确的分布。

在实践中，多次调用该函数并检查结果。如果您希望有 N 个图像，请计算 100*N 个随机数，然后计算找到每个预期数字的数量。大多数应该出现70-130次。用不同的随机种子重新运行测试，看看结果是否不同。

如果您发现您现在使用的生成器不够好，您可以轻松找到一些东西。谷歌搜索“Mersenne Twister”——这比你需要的要随机得多。

为避免图像重新出现，您需要一些不那么随机的东西。一种简单的方法是检查不允许的值，如果是其中之一，则重新计算。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-23T19:31:52.587

虽然您无法测试随机性，但您可以测试数字序列的相关性或分布。

难以测试的目标：每次我们需要一张图片时，随机选择 4 张图片中的 1 张。

易于测试的目标：对于我们选择的每 100 张图片，4 张图片中的每张都必须至少出现 20 次。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-23T19:57:43.240

我同意亚当·罗森菲尔德的观点。对于您正在谈论的情况，您唯一可以有效测试的是整个范围内的分布。

我经常遇到的情况是我用我最喜欢的语言的 PRNG 生成伪随机数，然后将它们操纵到所需的范围内。为了检查我的操作是否影响了分布，我生成了一堆数字，对其进行操作，然后检查结果的分布。

要获得良好的测试，您应该生成至少比您的范围多几个数量级的数字。您使用的值越多，测试就越好。显然，如果你有一个非常大的范围，这是行不通的，因为你必须生成太多的数字。但是在您的情况下，它应该可以正常工作。

这是 Perl 中的一个示例，说明了我的意思：

```
for (my $i=0; $i<=100000; $i++) {
   my $r = rand;        # Get the random number
   $r = int($r * 1000); # Move it into the desired range
   $dist{$r} ++;        # Count the occurrences of each number
}

print "Min occurrences: ", (sort { $a <=> $b } values %dist)[1], "\n";
print "Max occurrences: ", (sort { $b <=> $a } values %dist)[1], "\n"; 
```

如果最小和最大出现之间的差异很小，那么您的分布是好的。如果它很宽，那么您的分布可能很糟糕。您还可以使用这种方法来检查您的范围是否被覆盖以及是否遗漏了任何值。

同样，您生成的数字越多，结果就越有效。我倾向于从小处着手，然后在合理的时间内（例如五分钟）完成我的机器所能处理的任何事情。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-23T20:57:05.627

假设您正在测试整数范围内的随机性，验证这一点的一种方法是创建一个数以百万计（嗯，可能是 10,000 左右）的“随机”数，并将它们的出现绘制在直方图上。

```
 ******    ******           ****
***********************************************
*************************************************
*************************************************
*************************************************
*************************************************
*************************************************
*************************************************
*************************************************
*************************************************
         1         2         3         4         5
12345678901234567890123456789012345678901234567890 
```

上面显示了一个“相对”的正态分布。

如果它看起来更偏斜，例如：

```
 ******    ******           ****
    ************  ************  ************
    ************  ************  ***************
    ************  ************  ****************
    ************  ************  *****************
    ************  ************  *****************
   ***************************  ******************
   **************************** ******************
******************************* ******************
**************************************************
         1         2         3         4         5
12345678901234567890123456789012345678901234567890 
```

然后你可以看到随机性减少了。正如其他人所提到的，还有重复的问题需要解决。

如果您要使用生成器编写一个包含 10,000 个随机数的二进制文件，例如从 1 到 1024 的随机数，并尝试使用某种压缩（zip、gzip 等）压缩该文件，那么您可以比较这两个文件尺寸。如果有“大量”压缩，那么它就不是特别随机的。如果大小没有太大变化，那么它是“非常随机的”。

**为什么这有效**

压缩算法寻找模式（重复和其他）并以某种方式减少它。查看这些压缩算法的一种方法是衡量文件中的信息量。高度压缩的文件信息少（例如随机性），压缩程度低的文件信息多（随机性）

# ide - 用于原型设计的最快速 RAD 环境

> ID：122745
> 
> 赞同：2
> 
> 时间：2008-09-23T18:17:10.860
> 
> 标签：ide, rad, prototyping

对于工作原型，您认为最快速的 RAD 环境是什么？不是为了辩论。

*   语
*   平台
*   IDE
*   D B
*   （个人笔记）

谢谢你。

PS1 我对 PERL 的后端原型设计非常满意……我在处理 UI 时卡住了……这似乎并不容易……

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T19:30:00.250

我想这都是很主观的，但是当你问“*你*认为什么”时，所以......

*   Delphi 7 以后（我猜从技术上讲是对象 pascal 或 Delphi 语言）
*   视窗 2003/XP
*   版本 7 是经典的，较新的版本似乎并不容易在（对我而言）中制作原型
*   SQL Express
*   相比之下，我使用过 VB6、MS VC++（很久以前）、FoxPro/Windows 和 Visual FoxPro，以及少量的 VS2005 (C#)。对我来说，德尔福每次都是全能之王。:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T18:19:35.380

对于 Windows 上的原型，Visual Basic 很难被击败。如果您需要支持另一个平台（或多个平台），那么 Tcl/Tk 也相当高效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T18:24:14.213

我一直认为 Perl 是我选择的原型语言，原因如下：

1.  CPAN - 几乎任何东西都有一个模块。
2.  很容易创建黑客来模仿、伪造或做一些快速而肮脏的事情。
3.  它无处不在。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T18:29:32.687

我认为“最快”是非常主观的。拥有多年 VB 经验的开发人员可能会最快地使用 VB 进行原型设计。Java中的Java开发人员。红宝石中的红宝石。那么，“最快”将受到您内部已有的资产（代码库、开发人员经验和工具）的严重影响。

您定义为“原型”的内容也会严重影响事物。在 Flash 中模拟的一组伪工作屏幕截图是否具有足够的导航可点击性？所需的功能集是什么？原型的目标受众是什么？

正如您所看到的，“最佳”将有很大的不同。可能几乎可以肯定该语言将是高级语言，并且 IDE 工具将拥有出色的 UI 设计师（假设原型具有 UI）。如果您有大量的数据库工作，那么为您执行 SQL 繁重工作的数据库向导将节省时间并生成合理的（如果未优化）对象。该平台可能是原型应该用于的任何平台——毕竟在 Linux 下为 Windows 应用程序或 Palm OS 下的 Symbian 应用程序设计原型可能不会给您带来太多好处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-03T14:44:22.503

VFP 非常适合原型设计。我看过微软团队的帖子（抱歉，没有链接），他们说 WPF 允许为他们进行快速原型设计。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-28T12:25:58.363

[深思熟虑的 Python 发行版](http://www.enthought.com/products/epd.php)。您在 python 中创建问题的模型，然后在一行代码中说“为此创建一个 UI”。如果您不喜欢 UI 的某些部分，则覆盖这些部分的默认值（仅此*而已*）。

如果你正在做一个桌面应用程序，没有比这更快的了。

生成的原型可以在 Windows、Linux 和 Mac 上运行。

如果您正在寻找网络 RAD，我建议您试试 Grails 或 TurboGears。TurboGears 更易于使用，Grails 让您可以访问 Java Web 框架的广阔空间（难以超越）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T19:01:57.867

I find that prototyping using the [Netbeans](http://www.netbeans.org) GUI builder gives me a great start. I'm a Java programmer mostly though.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-29T06:58:02.463

试用**Axure RP Pro**。

我们确实试了一下，发现它真的非常好。它使用一些 JavaScript 以 HTML 格式生成整个原型，因此分发原型变得很容易。

一定要检查一下。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T18:45:15.723

我会说 Python 和[wxPython](http://wxpython.org/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-10-15T13:54:47.670

[手工](http://handcraft.com)

当您在浏览器中交互式地对任何 GUI 进行原型设计时，您可以根据需要从低保真度或高保真度开始。Handcraft 完全专注于原型设计，因此它比 IDE 有意做的要少得多。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-06-18T23:38:55.757

对于工作原型：

*   非gui：python
*   gui: Ruby on rails

对于模型不使用 IDE，而是使用一些专门的模型工具，请在此处阅读以下内容：[创建交互式应用程序原型的最佳方法是什么？](https://stackoverflow.com/questions/139555/whats-the-best-way-to-create-interactive-application-prototypes/17120734#17120734)

对于混合方法（模型然后编码）：QT 设计器是我发现的唯一可行的选择，因为它是特定的架构

你去吧。

# c# - 如何摆脱 MMC 3.0 管理单元中的“控制台根”节点？

> ID：122749
> 
> 赞同：3
> 
> 时间：2008-09-23T18:17:13.980
> 
> 标签：c#, mmc, mmc3

我一直在使用新的 MMC 3.0 类和 C# 创建管理单元。在创建 *.msc 文件时，我似乎找不到任何关于如何摆脱“控制台根”节点的示例。我查看了 SDK 中的示例，但似乎找不到任何相关内容。

我见过其他可以做我想做的事，但我不知道他们使用的是什么版本的 MMC。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-30T03:37:28.817

如果我的理解正确，这不是 MMC3 特有的，但我确实花了一段时间才意识到。右键单击节点，然后单击`New Window from Here`。然后切换回控制台根窗口，并关闭它 (Ctrl+F4)。

在 .msc 中，它是 //View/BookMark/@NodeID，它需要是“2”（等等），而不是“1”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-15T20:14:03.037

我知道这是一篇较旧的帖子，因此可能不需要回复，但您尝试做的事情需要保存自定义的 MSC 文件。正如一个回复所述，添加您的 SnapIn，选择从此处打开新窗口，然后保存 MSC 文件。这是您的控制台，配置为将您的管理单元显示为 RootNode 而不是控制台根。在文件菜单下是一个选项...对话框。从那里您可以更改该特定控制台文件的设置以向最终用户提供非作者模式控制台，然后他们将无法更改您的布局。注意：这只是针对特定控制台文件（例如 C:\temp\MyCustomConsole.msc）的设置，任何人都可以打开控制台并使用添加/删除对话框在他们想要的任何其他控制台中打开 SnapIn。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T20:23:58.980

据我所知，MMC 总是显示控制台根目录。即使您在没有管理单元的情况下打开它，您仍然会看到控制台根目录。管理单元只添加在它下面，并且可以同时加载几个，它们都将在控制台根目录下，这只是树的根目录。

# xml - 用于格式化 XML DocBook 的推荐工具链是什么？

> ID：122752
> 
> 赞同：24
> 
> 时间：2008-09-23T18:17:20.033
> 
> 标签：xml, apache, pdf, apache-fop, docbook

我见过[Best tools for working with DocBook XML 文档](https://stackoverflow.com/questions/55622/best-tools-for-working-with-docbook-xml-documents)，但我的问题略有不同。当前推荐的 XML DocBook 格式化工具链（与编辑工具相对）是哪个？

在 Eric Raymond 的2003 年的[“The Art of Unix Programming”](https://rads.stackoverflow.com/amzn/click/com/0131429019)（一本优秀的书！）中，建议是 XML-FO（XML 格式化对象），但我在这里看到的建议表明 XML-FO 不再处于开发阶段（虽然我在 StackOverflow 上找不到那个问题，所以可能是错误的）。

假设我主要对 Unix/Linux（包括 MacOS X）感兴趣，但我不会自动忽略仅限 Windows 的解决方案。

[Apache 的 FOP](http://xmlgraphics.apache.org/fop/)是最好的方法吗？有没有其他选择？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-23T18:40:46.950

我一直在 cygwin 下使用 DocBook 进行一些手动编写，以生成单页 HTML、多页 HTML、CHM 和 PDF。

我安装了以下内容：

1.  [docbook](http://www.docbook.org)样式表(xsl) 存储库。
2.  xmllint，测试 xml 是否正确。
3.  xsltproc，使用样式表处理 xml。
4.  [Apache 的 fop](http://xmlgraphics.apache.org/fop/download.html)，用于生成 PDF。我确保将安装的文件夹添加到 PATH。
5.  Microsoft 的[HTML Help Workshop](http://www.microsoft.com/downloads/details.aspx?FamilyID=00535334-c8a6-452f-9aa0-d597d16580cc&displaylang=en)，用于制作 CHM 的。我确保将安装的文件夹添加到 PATH。

**编辑**：在下面的代码中，我使用的不仅仅是 2 个文件。如果有人想要脚本和文件夹结构的清理版本，请联系我：guscarreno (squiggly/at) googlemail (period/dot) com

然后我使用configure.in：

```
AC_INIT(Makefile.in)

FOP=fop.sh
HHC=hhc
XSLTPROC=xsltproc

AC_ARG_WITH(fop, [  --with-fop  Where to find Apache FOP],
[
    if test "x$withval" != "xno"; then
        FOP="$withval"
    fi
]
)
AC_PATH_PROG(FOP,  $FOP)

AC_ARG_WITH(hhc, [  --with-hhc  Where to find Microsoft Help Compiler],
[
    if test "x$withval" != "xno"; then
        HHC="$withval"
    fi
]
)
AC_PATH_PROG(HHC,  $HHC)

AC_ARG_WITH(xsltproc, [  --with-xsltproc  Where to find xsltproc],
[
    if test "x$withval" != "xno"; then
        XSLTPROC="$withval"
    fi
]
)
AC_PATH_PROG(XSLTPROC,  $XSLTPROC)

AC_SUBST(FOP)
AC_SUBST(HHC)
AC_SUBST(XSLTPROC)

HERE=`pwd`
AC_SUBST(HERE)
AC_OUTPUT(Makefile)

cat > config.nice <<EOT
#!/bin/sh
./configure \
    --with-fop='$FOP' \
    --with-hhc='$HHC' \
    --with-xsltproc='$XSLTPROC' \

EOT
chmod +x config.nice 
```

和一个 Makefile.in：

```
FOP=@FOP@
HHC=@HHC@
XSLTPROC=@XSLTPROC@
HERE=@HERE@

# Subdirs that contain docs
DOCS=appendixes chapters reference 

XML_CATALOG_FILES=./build/docbook-xsl-1.71.0/catalog.xml
export XML_CATALOG_FILES

all:    entities.ent manual.xml html

clean:
@echo -e "\n=== Cleaning\n"
@-rm -f html/*.html html/HTML.manifest pdf/* chm/*.html chm/*.hhp chm/*.hhc chm/*.chm entities.ent .ent
@echo -e "Done.\n"

dist-clean:
@echo -e "\n=== Restoring defaults\n"
@-rm -rf .ent autom4te.cache config.* configure Makefile html/*.html html/HTML.manifest pdf/* chm/*.html chm/*.hhp chm/*.hhc chm/*.chm build/docbook-xsl-1.71.0
@echo -e "Done.\n"

entities.ent: ./build/mkentities.sh $(DOCS)
@echo -e "\n=== Creating entities\n"
@./build/mkentities.sh $(DOCS) > .ent
@if [ ! -f entities.ent ] || [ ! cmp entities.ent .ent ]; then mv .ent entities.ent ; fi
@echo -e "Done.\n"

# Build the docs in chm format

chm:    chm/htmlhelp.hpp
@echo -e "\n=== Creating CHM\n"
@echo logo.png >> chm/htmlhelp.hhp
@echo arrow.gif >> chm/htmlhelp.hhp
@-cd chm && "$(HHC)" htmlhelp.hhp
@echo -e "Done.\n"

chm/htmlhelp.hpp: entities.ent build/docbook-xsl manual.xml build/chm.xsl
@echo -e "\n=== Creating input for CHM\n"
@"$(XSLTPROC)" --output ./chm/index.html ./build/chm.xsl manual.xml

# Build the docs in HTML format

html: html/index.html

html/index.html: entities.ent build/docbook-xsl manual.xml build/html.xsl
@echo -e "\n=== Creating HTML\n"
@"$(XSLTPROC)" --output ./html/index.html ./build/html.xsl manual.xml
@echo -e "Done.\n"

# Build the docs in PDF format

pdf:    pdf/manual.fo
@echo -e "\n=== Creating PDF\n"
@"$(FOP)" ./pdf/manual.fo ./pdf/manual.pdf
@echo -e "Done.\n"

pdf/manual.fo: entities.ent build/docbook-xsl manual.xml build/pdf.xsl
@echo -e "\n=== Creating input for PDF\n"
@"$(XSLTPROC)" --output ./pdf/manual.fo ./build/pdf.xsl manual.xml

check: manual.xml
@echo -e "\n=== Checking correctness of manual\n"
@xmllint --valid --noout --postvalid manual.xml
@echo -e "Done.\n"

# need to touch the dir because the timestamp in the tarball
# is older than that of the tarball :)
build/docbook-xsl: build/docbook-xsl-1.71.0.tar.gz
@echo -e "\n=== Un-taring docbook-xsl\n"
@cd build && tar xzf docbook-xsl-1.71.0.tar.gz && touch docbook-xsl-1.71.0 
```

自动生成上述文件输出。

我更喜欢使用 nix 方法编写脚本，只是因为工具集更容易找到和使用，更不用说更容易链接。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-17T17:25:57.020

我们使用[XMLmind XmlEdit](http://www.xmlmind.com/xmleditor/)进行编辑，并使用 Maven 的[docbkx](http://docs.codehaus.org/display/MAVENUSER/Docbkx+Maven+Plugin)插件在构建期间创建输出。有关一组好的模板，请查看[Hibernate](http://www.hibernate.org)或[Spring](http://www.springframework.org)提供的模板。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-18T19:19:59.267

对于 HTML 输出，我使用带有 XSLT 处理器 xsltproc的[Docbook XSL 样式表。](http://docbook.sourceforge.net/)

对于 PDF 输出，我使用[dblatex](http://dblatex.sourceforge.net/)，它转换为 LaTeX，然后使用 pdflatex 将其编译为 PDF。（我之前使用过 Jade、DSSSL 样式表和 jamtex。）

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-01-29T20:52:19.853

我们用

*   [Serna XML 编辑器](http://www.serna-xmleditor.com/)
*   Eclipse（纯xml编辑，多为技术人员使用）
*   自己的特定 Eclipse 插件（仅用于我们的发行说明）
*   Maven docbkx 插件
*   具有特定公司样式表的 Maven jar，基于标准 docbook 样式表
*   用于将 csv 转换为 DocBook 表的 Maven 插件
*   用于提取 BugZilla 数据并从中创建 DocBook 部分的 Maven 插件
*   Hudson（生成 PDF 文档）
*   Nexus 部署创建的 PDF 文档

我们有一些想法：

部署每个产品版本不仅是 PDF，还包括原始完整的 DocBook 文档（因为我们部分编写文档并部分生成它们）。保存完整的 DocBook 文档使它们独立于未来系统设置的更改。这意味着，如果系统发生变化，从中提取内容（或被差异系统替换），我们将无法再生成确切的内容。如果我们需要重新发布（使用不同的样式表）整个产品系列的手册，这可能会导致问题。和罐子一样；这些已编译的 Java 类也放在 Nexus 中（您不想将它们存储在 SCM 中）；我们也将使用生成的 DocBook 文档来执行此操作。

**更新：**

Fresh 创建了一个*Maven HTML Cleaner Plug-in*，它可以[将 DocBook 内容添加到 Maven 项目站点](http://docbook-utils.sourceforge.net/maven-html-cleaner-plugin_1.0/docbook/article-quick-start-docbook.html)（提供 Beta 版）。欢迎通过[开放讨论](https://sourceforge.net/projects/docbook-utils/forums/forum/1123044)论坛提供反馈。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-05T18:24:54.983

DocBook 样式表和 FOP 运行良好，但我最终决定选择 RenderX，它更全面地涵盖了标准并且有一些 DocBook 样式表利用的不错的扩展。

Bob Stayton 的书[DocBook XSL: The Complete Guide](http://www.sagehill.net/index.html)描述了几个替代工具链，包括在 Linux 或 Windows 上工作的工具链（几乎可以肯定是 MacOS，尽管我没有亲自使用过 Mac）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-23T18:24:11.233

一种流行的方法是使用[DocBook XSL 样式表](http://docbook.sourceforge.net/)。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-23T19:49:47.567

关于 Apache 的 FOP 的问题：当我们建立我们的工具链（类似于 Gustavo 建议的）时，我们使用[RenderX XEP 引擎](http://www.renderx.com/tools/xep.html)获得了非常好的结果。XEP 的输出看起来更精致一些，据我回忆，FOP 在表格方面存在一些问题（虽然这是几年前的事，但可能已经改变了）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-03-08T17:44:26.010

使用 FOP，您可以获得某些人认为他们想要实现的功能。我想说，没有一个认真对待出版的人在生产中使用它。使用 RenderX 或 Antenna House 或[Arbortext](http://single-sourcing.com/products/arbortext/publishing.html?utm_source=stackoverflow&utm_medium=comment&utm_term=fop&utm_content=ati&utm_campaign=us)会好得多。（在过去十年的实施项目中，我一直在使用它们。）这取决于您的业务需求、您想要自动化的程度，以及您的团队的技能、时间和资源情况。这不仅仅是一个技术问题。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-06-12T22:15:08.250

如果你使用的是 Red Hat、Ubuntu 或 Windows，你可以看看 Publican，它应该是一个相当完整的命令行工具链。Red Hat 广泛使用它。

*   维基在这里：[https ://fedorahosted.org/publican/](https://fedorahosted.org/publican/)
*   文档在这里：http: [//jfearn.fedorapeople.org/Publican/](http://jfearn.fedorapeople.org/Publican/)
*   在此处获取 tarball 和 exe：[https ://fedorahosted.org/releases/p/u/publican/](https://fedorahosted.org/releases/p/u/publican/)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-05-24T23:31:51.030

名为[The DocBook toolchain](http://en.tldp.org/HOWTO/DocBook-Demystification-HOWTO/x128.html)的文章也可能很有用。它是Eric Raymond 在 DocBook 上编写的[HOWTO的一部分。](http://en.tldp.org/HOWTO/DocBook-Demystification-HOWTO/index.html)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2012-10-22T20:22:45.313

我一直在使用两个 CLI 实用程序来简化我的 docbook 工具链：xmlto 和 publican。

Publican 对我来说看起来很优雅，但足以满足 Fedora 和 Redhat 的发布需求。

*   [https://fedorahosted.org/xmlto/](https://fedorahosted.org/xmlto/)
*   [https://fedorahosted.org/publican/](https://fedorahosted.org/publican/)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-03-28T21:20:20.020

我发布/正在开发一个名为 bookshop 的开源项目，它是一个安装完整 Docbook-XSL 管道/工具链的 RubyGem。它包括创建和编辑 Docbook 源文件和输出不同格式（当前为 pdf 和 epub，并且发展迅速）所需的一切。

我的目标是在 10 分钟内从您的 Docbook 源中实现从零到导出（pdf 或其他）。

摘要：

bookShop 是一个基于 OSS ruby​​ 的框架，用于 docbook 工具链的快乐和可持续的生产力。该框架经过优化，可帮助开发人员快速升级，使他们能够更快地加入并开发他们的 DocBook-to-Output 流程，通过支持约定优于配置，从一开始就为他们设置最佳实践、标准和工具.

这是宝石的位置：[https ://rubygems.org/gems/bookshop](https://rubygems.org/gems/bookshop)

以及源代码：[https ://github.com/blueheadpublishing/bookshop](https://github.com/blueheadpublishing/bookshop)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-09-02T05:51:26.840

我更喜欢在我的大部分内容创建（Notepad++ 编辑器）中使用 Windows。Linux 中的 Publican 是一个很好的工具链，可以创建良好的文档结构和流程输出。我在我的 Windows 机器和虚拟 Linux 机器上使用 Dropbox（还有其他文档共享服务，应该在两个平台上都可以正常工作）。通过这种设置，我已经能够实现对我来说非常有用的组合。一旦在 Windows 中完成编辑工作（立即同步到 Linux 机器），我切换到 Linux 运行 publican build 并创建 HTML 和 PDF 输出，这些输出再次由 Dropbox 在我的 Windows 文件夹中更新。

# python - 需要从平面创建分层字典

> ID：122763
> 
> 赞同：8
> 
> 时间：2008-09-23T18:19:25.083
> 
> 标签：python, algorithm, performance

我有一个字典，看起来像这样：

```
{
    'foo': {
        'opt1': 1,
        'opt2': 2,
        },
    'foo/bar': {
        'opt3': 3,
        'opt4': 4,
        },
    'foo/bar/baz': {
        'opt5': 5,
        'opt6': 6,
        }
    } 
```

我需要让它看起来像：

```
{
    'foo': {
        'opt1': 1,
        'opt2': 2,
        'bar': {
            'opt3': 3,
            'opt4': 4,
            'baz': {
                'opt5': 5,
                'opt6': 6,
                }
            }
        }
    } 
```

我应该指出，可以并且将会有多个顶级键（在这种情况下为“foo”）。我可能会拼凑一些东西来获得我需要的东西，但我希望有一个更有效的解决方案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T18:23:31.923

像这样：

```
def nest(d):
    rv = {}
    for key, value in d.iteritems():
        node = rv
        for part in key.split('/'):
            node = node.setdefault(part, {})
        node.update(value)
    return rv 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T18:25:51.450

```
def layer(dict):
  for k,v in dict:
    if '/' in k:
      del dict[k]
      subdict = dict.get(k[:k.find('/')],{})
      subdict[k[k.find('/')+1:]] = v
      layer(subdict) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-11-23T05:59:33.890

得到这个库以更好的方式打印你的字典。`pprint`. `https://docs.python.org/3.2/library/pprint.html`

# cygwin - 在 cygwin 中挂载软盘映像

> ID：122767
> 
> 赞同：4
> 
> 时间：2008-09-23T18:20:15.440
> 
> 标签：cygwin, command

如何使用 cygwin 挂载软盘映像文件。我想挂载映像，将文件复制到挂载的驱动器，然后从命令行卸载它。

我知道您可以在 Windows 中使用[虚拟软盘驱动器](http://chitchat.at.infoseek.co.jp/vmware/vfd.html#beta)，但是在 Cygwin 中有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T18:23:57.227

你不能只使用虚拟软盘驱动器吗？Cygwin 并没有真正做文件系统。它让 Windows 来处理这个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T18:25:48.017

如果您在线查看（谷歌），Cygwin 似乎不支持这种功能。另一种选择，虽然更努力，是使用类似[VirtualBox](http://www.virtualbox.org/)或 VMWare 的免费版本并运行轻量级 Linux 发行版，您可以在其中使用环回挂载功能并通过 samba 将其公开为 Windows 共享。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-05-11T22:21:05.787

Use ImDisk Virtual Disk Driver 是由 Olof Lagerkvist 创建的磁盘映像模拟器。它可以将设备模拟为硬盘驱动器、软盘驱动器或 CD/DVD 驱动器。它是免费软件，包含一些在 GPL 下许可的代码，以及一些在 BSD 下许可的代码。

网址下载：[ImDisk](http://www.ericklan.com/main/drupal/node/49)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-06-29T06:17:10.547

Cygwin 只是一个标准的 Win32 DLL，它依赖于 windows 内核来处理与文件系统相关的一切。这意味着它不能自行*安装*或*卸载*任何东西。[但是，您仍然可以使用mtools](https://www.gnu.org/software/mtools/)从命令行读取和写入软盘映像。

请注意，为了编译，我必须手动编辑 Makefile（在`./configure`步骤之后）来修改这一行：

```
LIBS = -liconv 
```

# wcf - 如何在 SQL CLR 中为 WCF 加载不同的端点？

> ID：122768
> 
> 赞同：3
> 
> 时间：2008-09-23T18:20:19.293
> 
> 标签：wcf, clr, endpoints

我们正在使用 CLR 在 SQL 2005 DB 中部署一些新的 WCF 调用。在测试中，我在代码中硬编码要连接的端点，并将其部署到我们的测试服务器。当我们将其部署到生产环境时，我们会将其部署到许多不同的 SQL DB，并使用不同的端点连接（在不同的服务器上运行相同的服务）。这样的事情怎么能做到？是否有可以参考的配置文件将 dll 部署到 SQL 中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T22:25:40.843

上述解决方案可行，但我们发现最佳实践方法是创建一个新表，将所有不同的端点存储到数据库中。然后，我们更新了 CLR 以调用此表以获取所需的端点。因此，每台服务器都会为其加载适当的元数据，并且都将从数据库中检索。这种方式无需硬编码，也无需担心 SQL 服务器上的外部文本文件。它都包含在数据库中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T18:22:50.473

[从 SQL CLR 访问应用程序配置设置](http://www.sqljunkies.ddj.com/Article/6CA864E9-E107-408E-B30A-4BA15B0CD11C.scuk)

另一种[技术](http://blogs.neudesic.com/blogs/shaun_collett/archive/2007/04/29/6050.aspx)..

# oracle - 如何在 Oracle SQL*Plus 中显示 LOB 列的全部内容？

> ID：122772
> 
> 赞同：27
> 
> 时间：2008-09-23T18:21:12.490
> 
> 标签：oracle, blob, sqlplus, clob, lob

当我尝试在 SQL*Plus 中显示 LOB（大对象）列的内容时，它会被截断。如何显示整个内容？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-09-23T18:21:43.160

```
SQL> set long 30000
SQL> show long
long 30000 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-09-01T15:32:43.957

您可能还需要：

```
SQL> set longchunksize 30000 
```

否则 LOB/CLOB 将换行。

# .net - 在组中重复标题

> ID：122775
> 
> 赞同：1
> 
> 时间：2008-09-23T18:21:40.337
> 
> 标签：.net, regex

我正在解析具有标题的文本，然后是适用于该标题的数据。我需要将每个数据字段分成组，并且标题也适用于这些组。这是一个例子：

（更新：以下文本已更新，以更好地反映其当前布局，并指示注释。）

```
标题 1
标题 2 标题 3
（第 1 组）
数据1 数据2
数据3 数据4
数据5
（第 2 组）
数据1 数据2
数据3 数据4
数据5
（第 3 组）
数据1 数据2
数据3 数据4
数据5
** 标题在这里变成不同的值 ***（这不是数据的一部分）
新标题 1
新标题 2 新标题 3
（第 4 组）
数据1 数据2
数据3 数据4
数据5
（第 5 组）
数据1 数据2
数据3 数据4
数据5
**ETC

```

输出应该是这样的：

```
(组 1) 标题 1 标题 2 标题 3 数据 1 数据 2 数据 3 数据 4 数据 5
(组 2) 标题 1 标题 2 标题 3 数据 1 数据 2 数据 3 数据 4 数据 5
(组 3) 标题 1 标题 2 标题 3 数据 1 数据 2 数据 3 数据 4 数据 5
(第 4 组) 新标题 1 新标题 2 新标题 3 数据 1 数据 2 数据 3 数据 4 数据 5
(第 5 组) 新标题 1 新标题 2 新标题 3 数据 1 数据 2 数据 3 数据 4 数据 5

```

标记的字段（第 1-5 组）只是行的标签，它们并不意味着是返回集的一部分。Headings 更改为“NewHeading”仅表示标题值已更改，应应用于其后的数据。

在过去的几个小时里，我做了一些阅读来寻找这叫什么，但我没有任何运气。有任何想法吗？这是针对 .Net 正则表达式引擎的。

更新：添加了注释，并显示文件的标题发生了变化。我也做了一些研究，相信我可以通过两种模式完成几乎同样简单的事情。一个用于标题，一个用于数据。然后我可以将标头和数据匹配索引（即：在文件中的位置）相互比较并以这种方式组合它们。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T19:41:44.510

1) 逐行循环。这不是正则表达式的地方

2）你真的需要澄清你的问题。目前尚不清楚 (Group 1) 和 ** The headings become different here ** 是否是您输入的一部分，或者您是否正在对其进行注释。

# testing - apache-jmeter 可以检查 URL 的返回值以获得正确的响应吗？

> ID：122777
> 
> 赞同：6
> 
> 时间：2008-09-23T18:21:52.440
> 
> 标签：testing, automated-tests, jmeter

apache-jmeter 的设置允许将 URL 发送到多个线程上的 Web 服务器。我有兴趣首先确定响应代码是否为 200-500，然后确定返回的内容是否为预期内容。这个详细的配置可以吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-24T00:28:14.713

是的，它确实。您只需将两个响应断言添加到您的 HTTP 采样器。

一个检查响应代码，另一个检查响应消息。

然后这些通过或失败将在摘要报告中可见。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T18:40:38.840

[我相信从这里](http://jakarta.apache.org/jmeter/usermanual/component_reference.html#Response_Assertion)所说的

# c# - 捕获控制台输出以在 VS 中进行调试？

> ID：122778
> 
> 赞同：12
> 
> 时间：2008-09-23T18:22:04.610
> 
> 标签：c#, visual-studio, debugging

在 VS 的外部工具设置下，有一个“使用输出窗口”复选框，用于捕获工具命令行输出并将其转储到 VS 选项卡。

问题是：*当我按下 F5 时，我可以对我的程序进行相同的处理吗？*

**编辑：** FWIW 我在 C# 中，但如果这对你的答案有影响，那么你的答案不太可能是我正在寻找的。

我想要的是获取程序的输出流并使用输出重定向（'|'和'>'）在cmd提示符中使用的相同设备将其传输到VS中的输出选项卡。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T05:00:02.673

您应该能够在文本文件中捕获输出并使用它。

我手边没有VS，所以这是凭记忆的：

1.  创建 C++ 项目
2.  打开项目设置，调试选项卡
3.  启用托管调试
4.  编辑命令行以添加“ `> output.txt`”
5.  在调试器下运行你的程序

如果事情按照我记得的方式工作，这会将 STDOUT 重定向到文件，即使您实际上并未在 CMD.EXE 下运行。

（调试器有自己的重定向语法实现，和cmd不是100%一样，但是已经很不错了。）

现在，如果您在 VS 中打开此文件，您仍然可以在 VS 中看到输出，尽管不是在您希望的完全相同的窗口中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-07T08:01:35.010

控制台可以将其输出重定向到任何文本编写器。如果您实现了一个写入 Diagnostics.Debug 的文本编写器，那么一切就绪。

这是一个写入调试器的文本编写器。

```
using System.Diagnostics;
using System.IO;
using System.Text;

namespace TestConsole
{
    public class DebugTextWriter : TextWriter
    {
        public override Encoding Encoding
        {
            get { return Encoding.UTF8; }
        }

        //Required
        public override void Write(char value)
        {
            Debug.Write(value);
        }

        //Added for efficiency
        public override void Write(string value)
        {
            Debug.Write(value);
        }

        //Added for efficiency
        public override void WriteLine(string value)
        {
            Debug.WriteLine(value);
        }
    }
} 
```

由于它使用 Diagnostics.Debug，因此它会遵守您的编译器设置，以确定它是否应该写入任何输出。此输出也可以在 Sysinternals DebugView 中看到。

以下是你如何使用它：

```
using System;

namespace TestConsole
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.SetOut(new DebugTextWriter());
            Console.WriteLine("This text goes to the Visual Studio output window.");
        }
    }
} 
```

如果您想在发布模式下编译时在 Sysinternals DebugView 中查看输出，可以使用写入 OutputDebugString API 的 TextWriter。它可能看起来像这样：

```
using System.IO;
using System.Runtime.InteropServices;
using System.Text;

namespace TestConsole
{
    public class OutputDebugStringTextWriter : TextWriter
    {
        [DllImport("kernel32.dll")]
        static extern void OutputDebugString(string lpOutputString);

        public override Encoding Encoding
        {
            get { return Encoding.UTF8; }
        }

        //Required
        public override void Write(char value)
        {
            OutputDebugString(value.ToString());
        }

        //Added for efficiency
        public override void Write(string value)
        {
            OutputDebugString(value);
        }

        //Added for efficiency
        public override void WriteLine(string value)
        {
            OutputDebugString(value);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:02:34.123

我将在这里做一些假设。首先，我假设您正在谈论应用程序的 printf 输出（无论是来自控制台应用程序还是来自 Windows GUI 应用程序）。我的第二个假设是 C 语言。

*据我所知，您不能将 printf 输出直接输出到 dev studio 的输出窗口，也不能直接输出。* [[OP添加的重点]]

可能有办法，但我不知道。您可以做的一件事是将 printf 函数调用定向到您自己的例程，这将

1.  调用 printf 并打印字符串
2.  调用 OuputDebugString() 将字符串打印到输出窗口

你可以做几件事来实现这个目标。首先是编写自己的 printf 函数，然后调用 printf 和 OuputDebugString()

```
void my_printf(const char *format, ...)
{
    char buf[2048];

    // get the arg list and format it into a string
    va_start(arglist, format);
    vsprintf_s(buf, 2048, format, arglist);
    va_end(arglist); 

    vprintf_s(buf);            // prints to the standard output stream
    OutputDebugString(buf);    // prints to the output window
} 
```

上面的代码大部分都未经测试，但它应该可以理解概念。

如果您不是在 C/C++ 中执行此操作，那么此方法对您不起作用。:-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T05:06:46.773

也许这对你有用：在关闭`}`时设置一个断点`Main`，然后在控制台窗口关闭之前查看它。如果需要，您甚至可以从中复制文本。

在我用于开发的每台机器上，我都以某种方式配置我的控制台窗口，这恰好使这种方法更好地工作：

1.  运行 cmd.exe
2.  ALT-空格，D
3.  在选项中，启用快速编辑模式。
4.  在布局中，将缓冲区高度设置为 9999
5.  点击确定
6.  退出 CMD 窗口。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T18:50:22.543

System.Diagnostics.Debug.Writeline() 或 Trace.Writeline()

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T18:51:32.167

您可以使用 Systems.Diagnostics.Trace 类将您的输出写入输出窗口，而不是（或除了）控制台。它需要一些配置，但它可以工作。这符合你想要的吗？

[您也可以根据本文](http://www.knowdotnet.com/articles/outputwindow.html)添加自己的标签，但我从未尝试过。

# 2d - 2d 图形效果 101：扔东西

> ID：122781
> 
> 赞同：0
> 
> 时间：2008-09-23T18:22:29.647
> 
> 标签：2d

我的桌面应用程序中有一个页面，并且我实现了简单的抓取和平移。它工作得很好。

当您以这种方式平移并释放时，页面会在您放置它的地方停止。

我希望它以某种势头稍微继续，并最终停止。我猜这更像是 iPhone UI 中的“投掷”。

我并不是真的在追求完美，只是一种能够“扔”那个页面的非常粗略的简单感觉。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-28T21:35:42.797

您可以通过跟踪位置来计算运动的速度。由于缺乏精确性，并且出于平滑的原因，您将希望平均最后的多个位置，假设它们是在彼此相隔几乎均匀的时间范围内进行的。

一旦你得到了这些的平均值，你就可以根据你想要的效果显示多少来调整你的速度。计算出平均值后，只需在平均值上添加一个常数乘数。

从这里开始，您将以这个速度移动窗口，降低速度直到它达到 0。降低的速度还取决于个人喜好。如果您希望窗口移动更长的时间，您将以比您希望它更快停止的速度更慢的速度降低速度。

如果您想要“反弹”效果，只需检查窗口何时碰到屏幕的一侧。如果它撞到左侧或右侧（即 WindowX <= 0 或 WindowX + WindowWidth >= ScreenWidth），则将 X 速度乘以 -1 以将其发送到另一个方向。Y轴也是如此。如果你不添加“反弹”效果，我建议至少做同样的检查，但是当它碰到屏幕的一侧时，你强制它回到屏幕中（即 WindowX >= 0 和 WindowX <= ScreenWidth - WindowWidth) 将速度设置为 0，完全停止动画。

我也建议您在最大速度上添加一个上限（即在 -x 和 x 单位之间）。这将防止“某事”发生并且速度最终达到一个疯狂的数字，并且屏幕以每小时一百万英里的速度弹跳的奇怪情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T18:25:34.587

除了位置之外，只需跟踪页面的当前速度。当用户释放时，将速度设置为您平移的最后一个量。然后，在随后的帧中，继续以当前速度平移，并将当前速度降低某个固定量（幅度），直到它达到零。

# c++ - 如何将 BOOST 包装在单独的命名空间中？

> ID：122782
> 
> 赞同：9
> 
> 时间：2008-09-23T18:22:39.037
> 
> 标签：c++, boost, namespaces

我希望同时将两个版本的 BOOST 编译到一个项目中。理想情况下，它们应该可以按照以下方式使用：

```
boost_1_36_0::boost::shared_ptr<SomeClass> someClass = new SomeClass();
boost_1_35_0::boost::regex expression("[0-9]", boost_1_35_0::boost::regex_constants::basic); 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T19:29:00.673

我通过[开发列表讨论](http://thread.gmane.org/gmane.comp.lib.boost.devel/180008)阅读（仔细阅读） 。没有简单的解决方案。总结一下：

1.  在命名空间声明中包装头文件

    ```
    namespace boost_1_36_0 {
        #include <boost_1_36_0/boost/regex.hpp>
    }
    namespace boost_1_35_0 {
        #include <boost_1_35_0/boost/shared_ptr.hpp>
    } 
    ```

    *   需要修改源文件
    *   由于宏不尊重命名空间，因此不允许将两个版本包含在同一个翻译单元中。
2.  在包含标题之前定义提升

    ```
    #define boost boost_1_36_0
        #include <boost_1_36_0/boost/regex.hpp>
    #undef boost
    #define boost boost_1_35_0
        #include <boost_1_35_0/boost/shared_ptr.hpp>
    #undef boost 
    ```

    *   源文件可以简单地编译`-Dboost=boost_1_36_0`
    *   仍然没有解决单个翻译单元中的宏冲突。
    *   一些内部头文件包含可能会被搞砸，因为这种事情确实会发生。

        ```
        #if defined(SOME_CONDITION)
        #  define HEADER <boost/some/header.hpp>
        #else
        #  define HEADER <boost/some/other/header.hpp>
        #endif 
        ```

        但解决这些情况可能很容易。

3.  修改整个 boost 库以替换`namespace boost {..}`，`namespace boost_1_36_0 {...}`然后提供命名空间别名。用宏替换所有`BOOST_XYZ`宏及其用途`BOOST_1_36_0_XYZ`。
    *   如果您愿意付出努力，这可能会奏效。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-01-28T18:01:37.807

使用[bcp](http://www.boost.org/doc/libs/1_55_0b1/tools/bcp/doc/html/index.html)可以将 boost 库安装到特定位置，并且可以将其代码中的所有“命名空间 boost”替换为自定义别名。假设我们的别名是“boost_1_36_0”，所有“命名空间提升”代码块都以“boost_1_36_0”开头。就像是

```
bcp --namespace=boost_1_36_0 --namespace-alias shared_ptr regex /path/to/install 
```

，但自己检查链接中的文档，因为我不确定它是否是合法的语法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:29:52.140

@Josh：虽然我同意颤抖，但我仍然相信这是更好的做法。否则，链接问题是肯定的。我曾经遇到过这样的情况，我不得不使用它来破解编译的库`objcopy`以避免定义冲突。由于平台互操作性的原因，这是一场噩梦，因为即使在相同编译器的不同版本（在我的例子中，GCC）中，名称修饰的工作方式也非常不同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:25:08.563

您将在链接方面遇到麻烦，因为损坏的名称会有所不同。是的，我知道你知道这一点，但它似乎到处都是麻烦。

# data-structures - 从常见数据结构中索引、插入和删除的时间复杂度是多少？

> ID：122799
> 
> 赞同：35
> 
> 时间：2008-09-23T18:25:01.403
> 
> 标签：data-structures, complexity-theory, big-o

对于最常见的数据结构（包括数组、链表、哈希表等）的操作，没有可用的大 O 表示法的总结。

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2013-07-01T17:12:59.870

现在可以在 Wikipedia 上找到有关此主题的信息：[搜索数据结构](http://en.wikipedia.org/wiki/Search_data_structure)

```
+----------------------+----------+------------+----------+--------------+
|                      |  Insert  |   Delete   |  Search  | Space Usage  |
+----------------------+----------+------------+----------+--------------+
| Unsorted array       | O(1)     | O(1)       | O(n)     | O(n)         |
| Value-indexed array  | O(1)     | O(1)       | O(1)     | O(n)         |
| Sorted array         | O(n)     | O(n)       | O(log n) | O(n)         |
| Unsorted linked list | O(1)*    | O(1)*      | O(n)     | O(n)         |
| Sorted linked list   | O(n)*    | O(1)*      | O(n)     | O(n)         |
| Balanced binary tree | O(log n) | O(log n)   | O(log n) | O(n)         |
| Heap                 | O(log n) | O(log n)** | O(n)     | O(n)         |
| Hash table           | O(1)     | O(1)       | O(1)     | O(n)         |
+----------------------+----------+------------+----------+--------------+

 * The cost to add or delete an element into a known location in the list 
   (i.e. if you have an iterator to the location) is O(1). If you don't 
   know the location, then you need to traverse the list to the location
   of deletion/insertion, which takes O(n) time. 

** The deletion cost is O(log n) for the minimum or maximum, O(n) for an
   arbitrary element. 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-23T18:37:53.637

我想我将从链表的时间复杂度开始：

Indexing---->O(n)
Inserting / Delete at end---->O(1) or O(n)
Inserting / Delete in middle--->O(1) with iterator O(n) with out

最后插入的时间复杂度取决于你是否有最后一个节点的位置，如果你有，那将是 O(1) 否则你将不得不搜索链表，时间复杂度会跳到 O (n)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T22:22:09.890

请记住，除非您正在编写自己的数据结构（例如 C 中的链表），否则它可能很大程度上取决于您选择的语言/框架中数据结构的实现。例如，[在 Ridiculous Fish 上查看 Apple CFArray 的基准测试](http://ridiculousfish.com/blog/?p=27)。在这种情况下，数据类型（来自 Apple 的 CoreFoundation 框架的 CFArray）实际上会根据数组中实际存在的对象数量来改变数据结构——从线性时间变为恒定时间（大约 30,000 个对象）。

这实际上是面向对象编程的美妙之处之一——您不需要知道它是*如何*工作的，只需*知道*它是如何工作的，并且“它是如何工作的”可以根据需求而改变。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T21:04:18.777

红黑树：

*   插入 - O(log n)
*   检索 - O(log n)
*   删除 - O(log n)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-09-17T08:41:04.853

没有比这更有用的了：[通用数据结构操作](http://bigocheatsheet.com/)：

[![在此处输入图像描述](https://i.stack.imgur.com/Gv0Xc.jpg)](https://i.stack.imgur.com/Gv0Xc.jpg)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T21:01:11.013

哈希表的摊销 Big-O：

*   插入 - O(1)
*   检索 - O(1)
*   删除 - O(1)

请注意，散列算法有一个常数因子，摊销意味着实际测量的性能可能会有很大差异。

# .net - 有人用过 Boo，你能评论一下你的经历吗？

> ID：122815
> 
> 赞同：3
> 
> 时间：2008-09-23T18:26:14.973
> 
> 标签：.net, dynamic-languages, boo

我正在.NET [http://boo.codehaus.org/上寻找一个时髦的等价物](http://boo.codehaus.org/)

到目前为止，Boo 看起来很有趣，但它是静态类型的，但确实包含一些我正在寻找的元编程功能。

任何人都可以评论使用 Boo 的体验吗？在 1.0 版本中是否值得研究更多的爱好？

*编辑*：将 BOO 更改为 Boo

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T18:29:39.257

我最近一直在使用 Boo。它非常灵活且功能强大。元编程运行良好，但它不像 Nemerle 那样容易使用。此外，缺少任意表达式嵌套（例如 def foo = if(bar) match(baz) { ... } else 0;) 使某些事情变得比它必须的更难，但这不是你要做的事情除非您来自 Nemerle、OCaml、Haskell 或类似的其他公司，否则请错过。

总的来说，我会说试一试。我想你不会失望的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T18:34:24.657

我为我的编程语言课写了一篇关于它的论文。我对它印象深刻。这很有趣，他们已经开始在 BooLangStudio 上工作。SharpDevelop 也有一些支持。

我喜欢它的很多地方。当 BooLangStudio 与代码编译一起发布时，boo 编译器达到 1.0（这意味着编译器将用纯 boo 编写：D）我肯定会考虑使用 C#。它太棒了，所以你不会后悔看它！

# c# - ASP.NET - 在 RenderContent 调用中将事件处理程序添加到中继器内的 LinkBut ton

> ID：122821
> 
> 赞同：4
> 
> 时间：2008-09-23T18:26:33.913
> 
> 标签：c#, asp.net, sharepoint, web-parts

我有一个加载自定义用户控件的 Sharepoint WebPart。用户控件包含一个Repeater，而Repeater 又包含几个LinkBut​​tons。

在 Webpart 的 RenderContent 调用中，我有一些代码来添加事件处理程序：

```
 ArrayList nextPages = new ArrayList();
        //populate nextPages ....
        AfterPageRepeater.DataSource = nextPages;
        AfterPageRepeater.DataBind();

        foreach (Control oRepeaterControl in AfterPageRepeater.Controls)
        {
            if (oRepeaterControl is RepeaterItem)
            {
                if (oRepeaterControl.HasControls())
                {
                    foreach (Control oControl in oRepeaterControl.Controls)
                    {
                        if (oControl is LinkButton)
                        {
                            ((LinkButton)oControl).Click += new EventHandler(PageNavigateButton_Click);
                        }
                    }
                }
            }
        } 
```

然而，函数 PageNavigateButton_Click 永远不会被调用。但是，我可以看到它被添加为调试器中的事件处理程序。

有任何想法吗？我很难过如何做到这一点。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T18:44:14.383

在调用 RenderContent() 时，框架已经调用了所有已注册的事件处理程序。您需要在较早的方法中添加事件处理程序，例如 OnLoad()：

```
protected override void OnLoad(EventArge e)
 { base.OnLoad(e);
   EnsureChildControls();

   var linkButtons = from c in AfterPageRepeater.Controls
                                                .OfType<RepeaterItem>()
                     where c.HasControls()
                     select c into ris
                        from lb in ris.OfType<LinkButton>()
                        select lb;

   foreach(var linkButton in linkButtons)
    { linkButton.Click += PageNavigateButton_Click
    }                          
 } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T18:32:23.477

您是否尝试在迭代时将 CommandName 和 CommandArgument 属性分配给每个按钮？Repeater 控件支持 ItemCommand 事件，该事件将在点击具有 CommandName 属性的控件时引发。

从那里处理起来很容易，因为 CommandName 和 CommandArgument 值被传递到事件中并且很容易访问。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:29:47.447

您需要确保将链接按钮重新添加到控件树和/或在事件触发之前将事件重新连接到控件。

[文章@4guysfromrolla](http://aspnet.4guysfromrolla.com/articles/092904-1.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T18:31:24.633

我从未做过 SharePoint WebPart，所以我不知道这是否适用。但如果它是一个普通的 apsx 页面，我会说当它呈现时，为时已晚。尝试在控件的 Init 或 PreInit 事件中添加事件处理程序。

* * *

**编辑：**等等，我认为 Dilli-O 可能是对的。请参阅[http://www.ondotnet.com/pub/a/dotnet/2003/03/03/repeater.html](http://www.ondotnet.com/pub/a/dotnet/2003/03/03/repeater.html)末尾的*向中继器添加按钮控件*部分。它在 VB.NET 中，但您可以在 C# 中轻松地做同样的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T22:38:18.033

正如其他人指出的那样，您在页面生命周期中添加事件处理程序为时已晚。对于 SharePoint WebParts，您通常希望重写类的 OnInit/CreateChildControls 方法来处理活动。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-26T15:35:47.967

你需要你的 webpart 来实现[INamingContainer](http://msdn.microsoft.com/en-us/library/system.web.ui.inamingcontainer.aspx)标记接口，框架使用它来允许回发返回到正确的控件......而且你的 webpart 中的控件都需要有一个 ID。

# c++ - 减少大型不熟悉代码库的内存占用

> ID：122826
> 
> 赞同：4
> 
> 时间：2008-09-23T18:28:18.353
> 
> 标签：c++, winapi, optimization, visual-c++, memory-management

假设您有一个相当大（~2.2 MLOC）、相当老（10 多年前开始）C/C++ 的 Windows 桌面应用程序。大约 10% 的模块是外部的，没有源代码，只有调试符号。

您将如何将应用程序的内存占用减少一半？至少，你会怎么做才能找出内存消耗的地方？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T18:54:58.837

用包装器覆盖 malloc()/free() 和 new()/delete()，这些包装器跟踪分配的大小以及（通过记录调用堆栈并稍后根据符号表解析）它们的来源。在关机时，让你的包装器显示任何仍然分配的内存。

这应该使您能够确定最大的分配在哪里并捕获任何泄漏。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T18:59:05.487

这是我用来将我们游戏的内存消耗减少 20% 的内存跟踪应用程序[的描述/骨架。](http://msinilo.pl/blog/?cat=7)它帮助我跟踪外部模块完成的许多分配。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T18:51:37.847

这不是一件容易的事。首先追查您能找到的任何内存泄漏（一个好的工具是[Rational Purify](http://www-01.ibm.com/software/awdtools/purify/)）。浏览源代码并尝试优化数据结构和/或算法。
对不起，如果这听起来很悲观，但将内存使用量减少 50% 听起来并不现实。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T19:02:22.733

There is a chance is you can find some significant inefficiencies very fast. First you should check what is the memory used for. A tool which I have found very handy for this is [Memory Validator](http://www.vmvalidator.com/cpp/memory/index.html)

Once you have this "memory usage map", you can check for Low Hanging Fruit. Are there any data structures consuming a lot of memory which could be represented in a more compact form? This is often possible, esp. when the data access is well encapsulated and when you have a spare CPU power you can dedicate to compressing / decompressing them on each access.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T18:38:36.550

我不认为你的问题提出得很好。

源代码的大小与内存占用没有直接关系。当然，编译后的代码会占用一些内存，但应用程序可能会有自己的内存需求。静态（代码中声明的变量）和动态（应用程序创建的对象）。

我建议您分析程序执行并仔细研究代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T19:00:51.350

对我来说，首先要开始的地方是：

应用程序是否做了很多预分配内存以供以后使用？这段记忆是否经常闲置而未使用，从未分发过？考虑根据需要切换到新/删除（或更好地使用 smart_ptr）。

代码是否使用静态数组，例如

```
Object arrayOfObjs[MAX_THAT_WILL_EVER_BE_USED]; 
```

并分发这个数组中的 objs？如果是这样，请考虑手动管理此内存。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T11:59:36.813

内存使用分析工具之一是 LeakDiag，可[从 Microsoft 免费下载](ftp://ftp.microsoft.com/PSS/Tools/Developer%20Support%20Tools/LeakDiag/)。它显然允许将所有用户模式分配器挂接到 VirtualAlloc 并随时将进程分配快照转储到 XML。然后可以使用这些快照来确定哪些调用堆栈分配了大部分内存以及哪些调用堆栈正在泄漏。它缺少用于快照分析的漂亮前端（除非您可以通过 Microsoft Premier Support 获得 LDParser/LDGrapher），但所有数据都在那里。

还要注意的一件事是，由于缓存，您可能会从 BSTR 分配器中获得误报泄漏，请参阅[“嘿，为什么我要泄漏所有 BSTR？”](http://blogs.msdn.com/larryosterman/archive/2004/09/28/235304.aspx)

# php - PHP：如何将信息返回到等待脚本并继续处理

> ID：122834
> 
> 赞同：6
> 
> 时间：2008-09-23T18:29:04.950
> 
> 标签：php

假设有两个脚本 Requester.php 和 Provider.php，Requester 需要 Provider 处理并向它发出 http 请求（Provider.php?data="data"）。在这种情况下，Provider 很快就找到了答案，但是为了维护系统必须在整个数据库中执行各种更新。有没有办法立即将值返回给Requester，然后在Provider中继续处理。

伪代码

```
Provider.php 
{
   $answer = getAnswer($_GET['data']);
   echo $answer;
   //SIGNAL TO REQUESTER THAT WE ARE FINISHED
   processDBUpdates();
   return;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T18:38:08.127

您可以使用 flush() 命令刷新输出缓冲区。[阅读PHP 手册](http://se.php.net/manual/en/function.flush.php)
中的注释以获取更多信息

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T18:49:38.367

我使用[此代码](https://stackoverflow.com/questions/45953/php-execute-a-background-process#45966)在后台运行进程（适用于 Linux）。

该进程运行时将其输出重定向到一个文件。

这样，如果我需要在进程上显示状态，只需编写少量代码来读取和显示输出文件的内容。

我喜欢这种方法，因为这意味着您可以完全关闭浏览器，稍后可以轻松返回查看状态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:48:42.237

我认为您需要在提供者上发送数据（确保刷新），然后在请求者上，使用 fopen/fread 读取预期数量的数据，以便您可以断开与提供者的连接并继续。如果您没有指定预期的数据量，我认为请求者会坐在那里等待提供者关闭连接，这可能直到它运行结束时才会发生（即所有次要工作密集型任务完成）。你需要尝试一些 POC 的..

祝你好运。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T18:52:40.807

您基本上想要发出 1 个进程结束的信号（返回原始`Requester.php`进程）并生成一个新进程（完成`Provider.php`）。可能有一种更优雅的方式来实现这一点，但我已经通过几种不同的方式进行了管理。所有这些基本上都会导致执行命令以屏蔽第二个进程。

将以下内容添加`> /dev/null 2>&1 &`到命令的末尾将允许它在后台运行，而不会阻止当前脚本的实际执行

以下内容可能对您有用：

```
exec("wget -O - \"$url\" > /dev/null 2>&1 &"); 
```

-- 尽管您也可以将其作为命令行 PHP 进程来执行。

您还可以保存需要处理的信息，并在 cron 作业上处理剩余的处理，该作业无需执行即可重新创建相同类型的功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T18:46:40.370

将 Provider 分成两部分：`ProviderCore`和`ProviderInterface`. 在`ProviderInterface`只做“快速和简单”的部分，还在数据库中保存一个最近请求尚未处理的标志。`ProviderCore`作为搜索该标志并完成处理的 cron 作业运行。如果无事可做，`ProviderCore`将在（比如说）2 分钟后终止并重试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-03T03:54:28.267

我在这里有点困难，但也许您应该尝试 cURL 或使用套接字来更新请求者？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-07-02T20:10:05.250

您可以使用 pcntl_fork() 在 Provider.php 中启动另一个 php 进程

```
Provider.php 
{
    // Fork process
    $pid = pcntl_fork();

    // You are now running both a daemon process and the parent process
    // through the rest of the code below

    if ($pid > 0) {
        // PARENT Process
        $answer = getAnswer($_GET['data']);
        echo $answer;    
        //SIGNAL TO REQUESTER THAT WE ARE FINISHED
        return;
    }

    if ($pid == 0) {
        // DAEMON Process
        processDBUpdates();
        return;
    }

    // If you get here the daemon process failed to start
    handleDaemonErrorCondition();
    return;

} 
```

# ssis - 简单的数据转换工具

> ID：122838
> 
> 赞同：-1
> 
> 时间：2008-09-23T18:29:29.973
> 
> 标签：ssis

我经常有需要进入 SqlServer 的 Excel 或文本中的数据。我可以使用 ODBC 来查询 Excel 文件，我可以解析文本文件。不过，我想要的是一些工具，它可以轻松地抓取数据并将其放入表格中。有人知道这样的工具吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T18:34:13.270

如果您使用的是 Sql Server，请查看[Integration Services](http://www.microsoft.com/sql/technologies/integration/default.mspx) (SSIS)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T18:34:44.517

你也可以看看[parse-o-matic](http://www.parse-o-matic.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:08:03.360

您是否尝试过**SQL Server 导入/导出向导**？

在 SQL Server Management Studio 中，右键单击您的数据库名称，然后选择**任务**菜单、**导入数据**。对于数据源，选择**Microsoft Excel**，浏览到**.XLS** ...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:34:25.093

似乎很容易编写一个读取文本文件的脚本，并将其转换为“INSERT * into TABLE”Sql 语句。我怀疑这已经完成了，但是使用您最喜欢的脚本语言，一个简单的实现将少于 100 行代码。

嘿，谷歌说 SQLServer 带有这样一个工具，[BULK INSERT](http://sqlserver2000.databases.aspfaq.com/how-do-i-load-text-or-csv-file-data-into-sql-server.html)：

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T18:35:02.393

根据您拥有的 SQL Server 版本使用 DTS 或 SSIS。有一个导入向导可以帮助您入门，但数据导入很少是简单的，并且通常涉及某种数据清理，以便您的传入数据可以被您打算存储它的表接受。根据我的经验，Excel 数据在这方面通常特别糟糕，因为它通常一开始就没有正确存储在 Excel 中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T18:39:41.540

我还没有看到这样做的商业工具。我一直在工作中创建这种工具，并且数据验证并非易事。这只是确保您没有错误的数据进入您的数据库。

我发现对于简单的数据转换需要像[FileHelpers](http://filehelpers.com/)这样的东西是相当不错的。它仍然需要编程。这个框架相当容易使用，有一点经验的人可以为你解决一些问题。

进一步考虑，您可以使用 SQL Server [bcp 实用程序](http://msdn.microsoft.com/en-us/library/ms162802.aspx)上传文本文件的内容。这是一个命令行实用程序，有很多开关。我建议您在生产表中使用它之前先在测试表上进行试验。

好久没用了，不记得能不能直接用Excel电子表格。在任何情况下，文本文件总是最容易处理的。

# .net - ClickOnce 应用程序不适用于 Office 2007

> ID：122841
> 
> 赞同：0
> 
> 时间：2008-09-23T18:29:41.220
> 
> 标签：.net, exception, clickonce, office-2007

我是使用 ClickOnce 进行部署的 .net 应用程序的开发人员。我已经部署了 60 多次，并且计算机在下载最新版本时没有任何问题。但是，当我今天早上部署时，安装了 Office 2007 的计算机尝试启动应用程序时出现以下错误：

> 无法安装或运行应用程序。该应用程序要求首先在全局程序集缓存 (GAC) 中安装程序集 stdole 版本 7.0.3300.0。请联系您的系统管理员。

但是，装有 Office 2003 的计算机可以毫无问题地启动该应用程序。

有人对解决此问题有任何建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T18:45:29.373

据我所知，安装 Office2k7 时会删除此版本的 stdole。您可以通过 gacutil 在所有目标机器上单独安装它，*或者*通过 ClickOnce 包引导程序以某种方式包含它。现在在mac上，所以我无法测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-26T03:03:51.593

一旦我们公司开始推出 Office 2007，我就遇到了完全相同的问题。我的第一个快速解决方案是将 stdole 复制到出现问题的两台计算机的 GAC。

经过调查，我发现我们的应用程序实际上并没有使用 stdole。当我测试我在测试后删除的 COM dll 时，它可能已经添加了引用。所以我的解决方案只是将它从“发布”选项卡下的“应用程序文件”对话框中排除。所以首先确定你需要它。

据我了解，当您引用 Office 等一些 COM dll 时，它是必需的。如果您遇到这种情况，我发现一些帖子说通过将应用程序文件对话框上的发布状态从先决条件更改为包含，并将下载组从无更改为必需，解决了问题。在我的情况下，stdole 默认添加为先决条件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T18:37:29.003

我不确定您的特定问题，但 Office 12 版本的 stdole 库与您使用 Office 2003 时的版本不同（并且 - 根据我的经验 - 并不总是向后兼容）。

我们使用 Office DLL 的包装器来使用 Office 必须提供的 Mailmerge 功能，不管你信不信，微软**再次**更改了接口，因此我们必须编译*两个*不同的包装器，链接到*两个*不同的 Office 版本。简而言之，一个 PITA。

在他们不提供托管库之前，我不会再次针对 MS Office 进行编码。

尽管咆哮，我认为您应该在您的计算机中安装 Office 12 并从那里进行测试。您会注意到所有 Office 的东西都是不同的。如果你可以让它在 Office 12 下工作，它**可能**与带有 Office 11（也称为 2003）的机器兼容，但不要指望它并在部署任何东西之前对其进行测试。

我不认为这与 ClickOnce 有任何关系。这更像是一个 GAC/OfficeVersion 问题。此外，检查可能的 Vista 问题，因为 UAC 和 DEP 的东西往往会干扰“旧”应用程序的工作方式。

# web-services - 我可以使用什么方法从 VBA 调用 Web 服务？

> ID：122846
> 
> 赞同：2
> 
> 时间：2008-09-23T18:30:19.723
> 
> 标签：web-services, excel, excel-2002, vba

从 Excel 调用 Web 服务的最简单方法是什么（我使用的是 2002 版）？请不要使用第三方工具或库。这必须很容易使用一些 VBA，我可以粘贴到那里，使用它，并且可以触摸。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T19:54:56.570

我认为没有任何特别简单的方法可以直接从 VBA 与 SOAP 对话，但是具有 RESTful 接口的 Web 服务（即整个事情可以通过 URL 完成）更容易：我今天正在看[这篇文章](http://www.onlamp.com/pub/wlg/5619). 我刚刚找到的另一篇文章在[这里](http://www.automateexcel.com/2005/03/17/excel_rest_and_winhttp_thoughts/)。

但是，如果您被 SOAP 困扰，您可以从阅读[this](http://www.webcontinuum.net/ws_4.aspx)和[this](http://www.automateexcel.com/2004/11/14/excel_vba_consume_web_services/)开始。坦率地说，这一切看起来有点恶心。

# java - Java Web 应用程序中的静态层

> ID：122847
> 
> 赞同：2
> 
> 时间：2008-09-23T18:30:24.107
> 
> 标签：java, data-access-layer, business-logic-layer

我正在使用相当标准的 Web/服务/数据访问分层设计构建一个用于娱乐/学习的小型网站。

为了使我不必经常创建服务层/数据访问层类的实例，我将它们中的方法全部设为静态。我不应该遇到并发问题，因为它们使用局部变量等并且不共享任何资源（目前事情很简单）。

据我所知，唯一的权衡是我并没有真正遵循真正的 OO 方法，但它再次使代码更加简洁。

有什么理由这不是一种可行的方法吗？以后可能会出现什么样的问题？有一个“工厂”类可以根据需要返回服务和数据层类的实例会更好吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T19:14:41.143

你知道那些游乐园里的游乐设施，他们说“请始终把你的手和脚放在游乐设施内”吗？事实证明，如果你不这样做，骑行会更有趣。唯一真正的权衡是，您并没有真正遵循真正的“始终保持双手双脚”的方法。

重点是——你应该遵循“真正的 OO 方法”是有原因的，就像你有理由让你的手和脚保持在骑行中一样——这很有趣，直到你开始到处流血。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T19:18:59.620

您描述它的方式，这本身并不是“错误”的方法，但我并没有真正看到您试图避免的问题。您不能在服务器启动时创建这些业务对象的单个实例并根据需要将它们传递给您的 servlet 吗？

如果您准备好将 OO 扔出窗外，您可能还想查看 Singleton 模式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-29T20:18:18.670

缺点：

*   您将无法编写单元测试，因为您将无法编写模拟数据访问/业务逻辑对象来进行测试。
*   当不同的线程尝试同时访问静态代码时，您将遇到并发问题 - 或者如果您使用同步的静态方法，您最终会遇到线程排队使用静态方法。
*   您将无法使用实例变量，随着代码变得更加复杂，这将成为一种限制。
*   如果需要，替换业务或数据访问层的元素会更加困难。
*   如果您打算以这种方式编写您的应用程序，您最好使用一种旨在以这种方式工作的语言，例如 PHP。

您最好通过以下方式选择非静态业务/数据访问层类：

*   使用单例模式（创建每个类的单个实例并在线程之间共享它们）......
*   或者在需要时在每个线程中创建类的实例。

请记住，连接到您的应用程序的每个用户/会话都将在其自己的线程中运行 - 因此您的 Web 应用程序本质上是多线程的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T19:28:15.573

我真的看不出你的设计有什么优势，而且有很多事情可能会出错。您正在节省一行代码，也许？以下是您的方法的一些缺点：

*   您无法轻松替换业务逻辑的实现
*   您不能定义实例变量以方便将逻辑分解为多个方法
*   您认为不会出现多线程问题的假设几乎肯定是错误的
*   你不能轻易地模拟它们进行测试

我真的不认为遗漏一行代码会给你带来任何好处。

这并不是真正的“OO 设计”问题，而更多的是适当性。你为什么还要以这种程序化的方式使用 Java？当然，PHP 更适合这种设计（实际上通过不必编译和部署来节省您的时间）。

我只会让您的业务层非静态；它将使维护、更改和发展您的应用程序变得更加容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T19:31:47.530

您可能难以使用这种类型的架构对您的对象进行单元测试。例如，如果您有一个引用静态数据访问层的业务对象层，则可能难以测试业务层，因为您将无法轻松使用模拟数据访问对象。也就是说，在测试业务层时，您可能不想使用数据访问层中的“真实”方法，因为它们会对您的数据库进行不必要的更改。如果您的数据访问层不是静态的，您可以为业务层提供模拟数据访问对象以进行测试。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-23T18:38:22.963

我认为您将遇到具有多个用户的所有静态方法的并发问题。Web 层将线程化并发用户。你所有的静态方法都可以处理这个吗？也许，但他们不会一直被锁定在单个文件中的请求队列中吗？我不确定，从来没有尝试过你的想法。

# c# - 如何从 http 标头获取文件大小

> ID：122853
> 
> 赞同：69
> 
> 时间：2008-09-23T18:31:42.917
> 
> 标签：c#, http, download, http-headers

我想在下载之前获取 http:/.../file 的大小。该文件可以是网页、图像或媒体文件。这可以用 HTTP 标头完成吗？如何仅下载文件 HTTP 标头？

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-09-23T18:49:26.010

是的，假设您正在与之交谈的 HTTP 服务器支持/允许：

```
public long GetFileSize(string url)
{
    long result = -1;

    System.Net.WebRequest req = System.Net.WebRequest.Create(url);
    req.Method = "HEAD";
    using (System.Net.WebResponse resp = req.GetResponse())
    {
        if (long.TryParse(resp.Headers.Get("Content-Length"), out long ContentLength))
        {
            result = ContentLength;
        }
    }

    return result;
} 
```

如果不允许使用 HEAD 方法，或者服务器回复中不存在 Content-Length 标头，则确定服务器上内容大小的唯一方法是下载它。由于这不是特别可靠，因此大多数服务器都会包含此信息。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-23T18:35:02.673

> 这可以用 HTTP 标头完成吗？

是的，这是要走的路。*如果*提供了信息，则它在标题中作为`Content-Length`. 但是请注意，情况不一定如此。

可以使用`HEAD`请求而不是`GET`. 也许下面的代码有帮助：

```
HttpWebRequest req = (HttpWebRequest)WebRequest.Create("http://example.com/");
req.Method = "HEAD";
long len;
using(HttpWebResponse resp = (HttpWebResponse)(req.GetResponse()))
{
    len = resp.ContentLength;
} 
```

注意对象内容长度的`HttpWebResponse`属性——无需`Content-Length`手动解析标题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2018-07-18T03:28:26.687

请注意，并非每个服务器都接受`HTTP HEAD`请求。获取文件大小的另一种方法是`HTTP GET`调用服务器，仅请求文件的一部分以保持响应较小，并从作为响应内容标头的一部分返回的元数据中检索文件大小。

该标准`System.Net.Http.HttpClient`可用于实现此目的。通过在请求消息头上设置字节范围来请求部分内容：

```
 request.Headers.Range = new RangeHeaderValue(startByte, endByte) 
```

服务器以包含请求范围以及整个文件大小的消息进行响应。此信息在响应内容标头 ( `response.Content.Header`) 中返回，键为“Content-Range”。

以下是响应消息内容标头中内容范围的示例：

```
 {
       "Key": "Content-Range",
       "Value": [
         "bytes 0-15/2328372"
       ]
    } 
```

在此示例中，标头值意味着响应包含字节 0 到 15（即总共 16 个字节），并且文件总共有 2,328,372 个字节。

这是此方法的示例实现：

```
public static class HttpClientExtensions
{
    public static async Task<long> GetContentSizeAsync(this System.Net.Http.HttpClient client, string url)
    {
        using (var request = new System.Net.Http.HttpRequestMessage(System.Net.Http.HttpMethod.Get, url))
        {
            // In order to keep the response as small as possible, set the requested byte range to [0,0] (i.e., only the first byte)
            request.Headers.Range = new System.Net.Http.Headers.RangeHeaderValue(from: 0, to: 0);

            using (var response = await client.SendAsync(request))
            {
                response.EnsureSuccessStatusCode();

                if (response.StatusCode != System.Net.HttpStatusCode.PartialContent) 
                    throw new System.Net.WebException($"expected partial content response ({System.Net.HttpStatusCode.PartialContent}), instead received: {response.StatusCode}");

                var contentRange = response.Content.Headers.GetValues(@"Content-Range").Single();
                var lengthString = System.Text.RegularExpressions.Regex.Match(contentRange, @"(?<=^bytes\s[0-9]+\-[0-9]+/)[0-9]+$").Value;
                return long.Parse(lengthString);
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-10-29T11:42:49.807

```
WebClient webClient = new WebClient();
webClient.OpenRead("http://stackoverflow.com/robots.txt");
long totalSizeBytes= Convert.ToInt64(webClient.ResponseHeaders["Content-Length"]);
Console.WriteLine((totalSizeBytes)); 
```

# java - 没有硬件设备的java声音

> ID：122855
> 
> 赞同：3
> 
> 时间：2008-09-23T18:31:48.907
> 
> 标签：java, audio

任何人都知道是否可以在实际上没有硬件声音设备的系统上编写使用 Java Sound API 的应用程序？

我有一些基于 API 编写的代码，用于处理一些音频并播放结果，但我现在尝试在服务器环境中运行它，其中音频将被记录到文件中，而不是播放出来。

我正在运行的服务器没有声卡，如果没有支持它的混音器，我似乎遇到了 Java Sound 无法分配任何线路的障碍。（而且没有硬件设备，我没有混音器。）

任何信息将不胜感激 -

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T18:43:08.770

对于 linux，您可以使用[OSS Virtual Mixer](http://www.opensound.com/virtmix.html)，它将为您提供虚拟声道。

在 Windows 上，有一些声音驱动程序可以做到这一点，一个是[Virtual Audio Cable](http://software.muzychenko.net/eng/vac.html)，虽然不是免费的，但它的成本大约是声卡的成本，所以它不应该是一个困难。

如果这些都不适合您，那么制作您自己的 Java 声音库并替换内置功能可能比为您的操作系统实现声卡更容易。

-亚当

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T19:01:30.740

所有java需要的是声卡的驱动程序。JVM 依赖于操作系统来处理直接的硬件管理，所有 JVM 需要的只是一种告诉操作系统它想要播放声音的方法（因此是驱动程序）。

# c# - 使用 C# 解析 HTML 链接

> ID：122856
> 
> 赞同：7
> 
> 时间：2008-09-23T18:31:52.107
> 
> 标签：c#, .net, html

是否有一个内置的 dll 会给我一个字符串中的链接列表。我想发送一个带有有效 html 的字符串并让它解析所有链接。我似乎记得 .net 或非托管库中内置了一些东西。

我发现了几个看起来很有前途的开源项目，但我认为有一个内置模块。如果不是，我可能不得不使用其中之一。如果没有必要，我现在只是不想要外部依赖。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T23:22:10.770

我不知道任何内置的东西，从你的问题来看，你正在寻找的东西有点模棱两可。您想要整个锚标记，还是只需要 href 属性中的 URL？

如果您有格式良好的 XHtml，您也许可以使用 XmlReader 和 XPath 查询来查找所有锚标记 ( `<a>`)，然后点击地址的 href 属性。由于这不太可能，因此您最好使用 RegEx 来下拉您想要的内容。

使用 RegEx，您可以执行以下操作：

```
List<Uri> findUris(string message)
{
    string anchorPattern = "<a[\\s]+[^>]*?href[\\s]?=[\\s\\\"\']+(?<href>.*?)[\\\"\\']+.*?>(?<fileName>[^<]+|.*?)?<\\/a>";
    MatchCollection matches = Regex.Matches(message, anchorPattern, RegexOptions.IgnorePatternWhitespace | RegexOptions.IgnoreCase | RegexOptions.Multiline | RegexOptions.Compiled);
    if (matches.Count > 0)
    {
        List<Uri> uris = new List<Uri>();

        foreach (Match m in matches)
        {
            string url = m.Groups["url"].Value;
            Uri testUri = null;
            if (Uri.TryCreate(url, UriKind.RelativeOrAbsolute, out testUri))
            {
                uris.Add(testUri);
            }
        }
        return uris;
    }
    return null;
} 
```

请注意，我想检查 href 以确保该地址实际上作为有效的 Uri 是有意义的。如果您实际上不打算在任何地方追求链接，则可以消除这种情况。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T18:37:42.777

我认为没有内置库，但[Html Agility Pack](http://www.codeplex.com/htmlagilitypack)对于您想做的事情很受欢迎。

使用原始 .NET 框架且没有外部依赖项的方法是使用正则表达式来查找字符串中的所有“a”标签。您可能需要处理很多边缘情况。例如 href = " [http://url](http://url) " vs href= [http://url](http://url)等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:44:37.533

[SubSonic.Sugar.Web.ScrapeLinks](http://web.archive.org/web/20090510122547/http://subsonichelp.com/html/d4d577b3-5089-17a2-c667-db50ad3c9ff9.htm)似乎做了你想要的一部分，但是它从 url 中获取 html，而不是从字符串中。[你可以在这里](https://github.com/subsonic/SubSonic-2.0/blob/master/SubSonic/Sugar/Web.cs)查看他们的实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:36:14.967

谷歌给了我这个模块： http: [//www.majestic12.co.uk/projects/html_parser.php](http://www.majestic12.co.uk/projects/html_parser.php)

似乎是.NET 的 HTML 解析器。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-23T18:37:30.423

一个简单的正则表达式 -

> @"<a.*?>"

传递给[Regex.Matches](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.regex.matches(VS.71).aspx)应该做你需要的。那个正则表达式可能需要一点点调整，但我认为它非常接近。

# wpf - WPF 透明边框导致 UI 停止重绘

> ID：122857
> 
> 赞同：2
> 
> 时间：2008-09-23T18:32:07.050
> 
> 标签：wpf, user-interface, transparency

[作为我之前问题](https://stackoverflow.com/questions/104224/how-do-you-troubleshoot-wpf-ui-problems)的后续，我想知道如何正确使用透明窗口。如果我已将窗口设置为使用透明度，则 UI 偶尔会出现停止响应。实际发生的是 UI 并没有按应有的方式更新。不会出现动画，页面似乎无法导航；但是，如果您看到调试器单击按钮、链接等...确实可以正常工作。最小化和恢复窗口再次“赶上” UI，用户可以继续工作，直到行为恢复。

如果我删除透明边框，则不会发生该行为。我是做错了什么还是有一些其他设置、代码等我需要实现才能正确使用透明边框？

这是我失败的代码的窗口声明。

```
<Window x:Class="MyProject.MainContainer"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="WPF APplication" Height="600" Width="800"    
    xmlns:egc="ControlLibrary" Background="{x:Null}"
    BorderThickness="0"
    AllowsTransparency="True"
    MinHeight="300" MinWidth="400" WindowStyle="None" > 
```

以及没有表现出行为的代码

```
<Window x:Class="MyProject.MainContainer"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="WPF Application" Height="600" Width="800"    
    xmlns:egc="ControlLibrary" Background="{x:Null}"
    BorderThickness="0"
    AllowsTransparency="False"
    MinHeight="300" MinWidth="400" WindowStyle="None" > 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T18:56:36.257

您是在 Windows XP SP2 上使用 .NET 3.0 还是 .NET 3.5？如果是这样，这是已在 .NET 3.5 和 XP 的 SP3（我认为是 Vista 的 SP1）中修复的透明窗口 API 的一个已知问题。基本上，当您将 AllowsTransparency 设置为 True 时，WPF 管道必须以纯软件模式呈现。这将导致大多数系统的性能显着下降。

不幸的是，解决此问题的唯一方法是升级到 .NET 3.0 SP1（包含在 .NET 3.5 中），并安装适用于 Windows 的相应服务包。请注意，透明窗口仍然较慢，但没有那么糟糕。[你可以在这里](http://blogs.msdn.com/dwayneneed/archive/2008/09/08/transparent-windows-in-wpf.aspx)找到更深入的讨论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T22:42:31.380

我想我终于找到了解决方法。从我读过的所有内容来看，XP SP3 和 .NET 3.5 SP1 不应该出现这个问题，但确实如此。

[此博客文章](http://jerryclin.wordpress.com/2007/11/13/creating-non-rectangular-windows-with-interop/)中的示例展示了如何使用 Win32 API 函数创建一个不规则形状的窗口，这就是我正在做的事情。在重新设计我的主窗口以使用这些技术之后，事情似乎按预期工作并且行为已经没有返回。

还需要注意的是，作者推荐这种方法的原因是由于 WPF 和透明窗口的性能问题。虽然我相信它在 .NET 3.5 SP1 中可能会更好，但这并不难实现，而且性能应该更好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T18:59:28.857

我在 Windows XP Pro SP3 上运行并使用 .NET 3.5 SP1。我还验证了该项目的目标是框架的 3.5 版。

# css - 元素的 z-index 值无法克服 iframe 内容的值

> ID：122865
> 
> 赞同：4
> 
> 时间：2008-09-23T18:34:06.373
> 
> 标签：css, z-index

我在页面上有一个`div`和一个`iframe``div`

```
z-index: 0; 
```

它的`iframe`内容带有一个`z-index`1000的弹出窗口

```
z-index: 1000; 
```

然而，`div`仍然掩盖了 IE 中的弹出窗口（但在 Firefox 中工作正常）。

有谁知道我能做什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T19:04:33.930

[Explorer Z-index 错误](http://www.quirksmode.org/bugreports/archives/2006/01/Explorer_z_index_bug.html)

一般来说，[http://www.quirksmode.org/](http://www.quirksmode.org/)是这类事情的绝佳参考。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T18:58:26.627

哪个版本的IE？

我不是 javascript 专家，但我认为在弹出窗口时隐藏 div 可能会完成您需要的操作。

在创建应该显示顶部下拉框和列表框的 javascript 菜单时，我不得不使用 div 和 iframe——其他菜单实现只是隐藏这些项目，它们在 IE6 中的默认行为是显示在任何 DIV 之上，无论 z -指数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:05:07.767

我面临同样的问题。我的问题是 iframe 中的内容不是由 IE 直接控制，而是由 Acrobat 控制，因为它是一个 pdf 文件。您可以尝试显示没有内容的 iframe，在这种情况下，弹出窗口会正常显示。由于某种原因，IE 无法控制外部助手的 z-index。

用IE7测试过

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T19:24:00.590

没有看到您的代码，很难确定问题所在。但值得注意的是 z-index 仅在元素已定位时才有效（例如`position: absolute;`），所以也许这可能是一个问题？

Mozilla 开发者中心有[一篇关于 CSS Z-index 的好文章。](http://developer.mozilla.org/en/Understanding_CSS_z-index)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T19:18:59.293

如果没有看到代码片段，就很难确定问题所在。您可能想尝试在弹出窗口下附加一个与弹出窗口大小相同的 iframe。使用 IE7，如果您在另一个 iframe 已经加载后渲染 iframed 弹出窗口，您应该能够覆盖下面的元素。如果您正在寻找示例，我相信一些 JS 日历和一些灯箱/厚箱代码可以做到这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T19:26:22.677

永远不要将你的 z-index 设置为低于 1 的任何值，除非你想隐藏它。我不确定 7.0 但旧版本的 IE 我在这样做时遇到了问题。IE 不太喜欢 z-index。还要检查你的定位。定位可能是您的问题。抱歉，我没有足够的信息来进一步帮助您。

# c - 为什么 strcpy 会触发全局变量的分段错误？

> ID：122877
> 
> 赞同：7
> 
> 时间：2008-09-23T18:35:16.543
> 
> 标签：c, scope, pointers, segmentation-fault, character

所以我有一些C代码：

```
#include <stdio.h>
#include <string.h>

/* putting one of the "char*"s here causes a segfault */
void main() {
  char* path = "/temp";
  char* temp;
  strcpy(temp, path);
} 
```

这会编译、运行并按其外观运行。但是，如果将一个或两个字符指针声明为全局变量，则 strcpy 会导致分段错误。为什么会这样？显然我对范围的理解存在错误。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-23T18:43:36.600

正如其他海报所提到的，问题的根源在于 temp 未初始化。当声明为堆栈上的自动变量时，它将包含该内存位置中发生的任何垃圾。显然，对于您正在运行的编译器+CPU+OS，该位置的垃圾是一个有效的指针。strcpy “成功”在于它没有段错误，但实际上它将字符串复制到内存中其他位置的任意位置。这种内存损坏问题让世界各地的 C 程序员感到恐惧，因为它非常难以调试。

当您将临时变量声明移动到全局范围时，它被放置在 BSS 部分并自动归零。尝试取消引用 *temp 然后会导致段错误。

当您将 *path 移动到全局范围时， *temp 会在堆栈上向上移动一个位置。该位置的垃圾显然不是有效的指针，因此取消引用 *temp 会导致段错误。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-23T18:39:46.143

temp 变量不指向任何存储（内存）并且未初始化。

如果 temp 声明为，`char temp[32];`则无论在何处声明代码都将起作用。但是，用这样的固定大小声明 temp 还有其他问题，但这是另一天的问题。

现在，为什么它在全局而不是本地声明时会崩溃。运气...

当在本地声明时， temp 的值来自当时可能在堆栈上的任何值。幸运的是它指向了一个不会导致崩溃的地址。但是，它正在破坏其他人使用的内存。

当全局声明时，在大多数处理器上，这些变量将存储在将使用需求零页的数据段中。因此`char *temp`看起来好像它被宣布了`char *temp=0`。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-23T18:36:27.150

您忘记分配和初始化 temp：

```
temp = (char *)malloc(TEMP_SIZE); 
```

只要确保 TEMP_SIZE 足够大。你也可以在运行时计算这个，然后确保大小足够（至少应该是 strlen(path)）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-23T18:43:09.613

如上所述，您忘记为 temp 分配空间。我更`strdup`喜欢`malloc+strcpy`. 它做你想做的事。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T18:43:29.143

不 - 无论变量如何，这都不起作用 - 它看起来就像它那样，因为你（不）幸运。您需要分配空间来存储字符串的内容，而不是让变量未初始化。

堆栈上未初始化的变量将指向几乎随机的内存位置。如果这些地址碰巧是有效的，那么您的代码将践踏那里的所有内容，但您不会收到错误消息（但可能会在代码的其他地方出现与内存损坏相关的令人讨厌的错误）。

全局变量总是失败，因为它们通常被设置为指向未映射内存的特定模式。尝试取消引用这些会立即给您一个段错误（这更好 - 将其留到以后会使错误很难追踪）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T18:57:04.337

我想将第一个亚当的片段重写为

```
// Make temp a static array of 256 chars
char temp[256];
strncpy(temp, sizeof(temp), path);
temp[sizeof(temp)-1] = '\0'; 
```

这样你：

```
1\. don't have magic numbers laced through the code, and
2\. you guarantee that your string is null terminated. 
```

第二点是丢失源字符串的最后一个字符，如果它的长度 >=256 个字符。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T18:39:09.747

需要注意的重要部分：
**目标字符串 dest 必须足够大以接收副本。**
在您的情况下， temp 没有分配要复制到的内存。

从 strcpy 的手册页复制：

```
DESCRIPTION
   The  strcpy()  function  copies the string pointed to by src (including
   the terminating '\0' character) to the array pointed to by  dest.   The
   strings  may not overlap, and the destination string dest must be large
   enough to receive the copy. 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T18:39:53.647

您正在调用未定义的行为，因为您没有初始化`temp`变量。它指向内存中的一个随机位置，因此您的程序*可能会*工作，但很可能会出现段错误。你需要让你的目标字符串是一个数组，或者让它指向动态内存：

```
// Make temp a static array of 256 chars
char temp[256];
strncpy(temp, 256, path);

// Or, use dynamic memory
char *temp = (char *)malloc(256);
strncpy(temp, 256, path); 
```

此外，使用`strncpy()`而不是`strcpy()`避免缓冲区溢出。

# .net - .NET：如何让后台线程信号主线程数据可用？

> ID：122882
> 
> 赞同：11
> 
> 时间：2008-09-23T18:35:51.207
> 
> 标签：.net, multithreading, asynchronous

**让ThreadA向某个事件的****ThreadB**发出信号，而不让**ThreadB**被阻塞等待事件发生的正确技术是什么？

我有一个后台线程将填充一个共享列表<T>。我正在尝试找到一种方法来异步向“主”线程发出信号，表明有数据可供提取。

* * *

我考虑使用 EventWaitHandle 对象设置一个事件，但我不能让我的主线程坐在 Event.WaitOne() 上。

* * *

我考虑有一个委托回调，但是a）我不希望主线程在委托中工作：线程需要重新开始工作添加更多的东西——我不希望它在委托执行时等待，并且b ) 委托需要编组到主线程上，但我没有运行 UI，我没有控制权来 .Invoke 委托反对。

* * *

我认为有一个委托回调，它只是启动一个零间隔 System.Windows.Forms.Timer（线程访问同步的定时器）。这样线程只需要在调用时被卡住

`Timer.Enabled = true;`

但这似乎是一个黑客行为。

在过去，我的对象会创建一个隐藏窗口，并让线程将消息发布到该隐藏窗口的 HWND。我考虑过创建一个隐藏控件，但我认为你不能在没有创建句柄的控件上调用。另外，我没有 UI：我的对象可能是在 Web 服务器、服务或控制台上创建的，我不希望出现图形控件 - 我也不希望编译对 System.Windows 的依赖项。形式。

* * *

我考虑让我的对象公开一个 ISynchronizeInvoke 接口，但是我需要实现 .Invoke()，这就是我的问题。

* * *

让线程 A 向某个事件的线程 B 发出信号，而不让线程 B 被阻塞等待事件发生的正确技术是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-23T20:37:57.433

这是 System.ComponentModel.BackgroundWorker 类的代码示例。

```
 private static BackgroundWorker worker = new BackgroundWorker();
    static void Main(string[] args)
    {
        worker.DoWork += worker_DoWork;
        worker.RunWorkerCompleted += worker_RunWorkerCompleted;
        worker.ProgressChanged += worker_ProgressChanged;
        worker.WorkerReportsProgress = true;

        Console.WriteLine("Starting application.");
        worker.RunWorkerAsync();

        Console.ReadKey();
    }

    static void worker_ProgressChanged(object sender, ProgressChangedEventArgs e)
    {
        Console.WriteLine("Progress.");
    }

    static void worker_DoWork(object sender, DoWorkEventArgs e)
    {
        Console.WriteLine("Starting doing some work now.");

        for (int i = 0; i < 5; i++)
        {
            Thread.Sleep(1000);
            worker.ReportProgress(i);
        }
    }

    static void worker_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
    {
        Console.WriteLine("Done now.");
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T20:37:46.420

我在这里结合了一些回应。

理想情况下使用线程安全标志，例如`AutoResetEvent`. 您不必在调用时无限期地阻塞`WaitOne()`，实际上它有一个允许您指定超时的重载。`false`如果在间隔期间未设置标志，则此重载返回。

A`Queue`是一种更理想的生产者/消费者关系结构，但如果您的要求迫使您使用`List`. 主要区别在于您必须确保您的消费者在提取项目时锁定对集合的访问；最安全的可能是使用该`CopyTo`方法将所有元素复制到数组中，然后释放锁。当然，请确保您的生产者`List`在锁定期间不会尝试更新。

这是一个简单的 C# 控制台应用程序，它演示了如何实现它。如果你玩弄时间间隔，你可能会导致各种事情发生；在这个特定的配置中，我试图让生产者在消费者检查项目之前生成多个项目。

```
using System;
using System.Collections.Generic;
using System.Threading;

namespace ConsoleApplication1
{
    class Program
    {
        private static object LockObject = new Object();

        private static AutoResetEvent _flag;
        private static Queue<int> _list;

        static void Main(string[] args)
        {
            _list = new Queue<int>();
            _flag = new AutoResetEvent(false);

            ThreadPool.QueueUserWorkItem(ProducerThread);

            int itemCount = 0;

            while (itemCount < 10)
            {
                if (_flag.WaitOne(0))
                {
                    // there was an item
                    lock (LockObject)
                    {
                        Console.WriteLine("Items in queue:");
                        while (_list.Count > 0)
                        {
                            Console.WriteLine("Found item {0}.", _list.Dequeue());
                            itemCount++;
                        }
                    }
                }
                else
                {
                    Console.WriteLine("No items in queue.");
                    Thread.Sleep(125);
                }
            }
        }

        private static void ProducerThread(object state)
        {
            Random rng = new Random();

            Thread.Sleep(250);

            for (int i = 0; i < 10; i++)
            {
                lock (LockObject)
                {
                    _list.Enqueue(rng.Next(0, 100));
                    _flag.Set();
                    Thread.Sleep(rng.Next(0, 250));
                }
            }
        }
    }
} 
```

如果您根本不想阻止生产者，那就有点棘手了。在这种情况下，我建议让生产者成为自己的类，同时具有私有和公共缓冲区以及公共`AutoResetEvent`。生产者默认将项目存储在私有缓冲区中，然后尝试将它们写入公共缓冲区。当消费者使用公共缓冲区时，它会重置生产者对象上的标志。在生产者尝试将项目从私有缓冲区移动到公共缓冲区之前，它会检查此标志并仅在消费者不处理项目时复制项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:45:03.320

如果您使用后台工作者启动第二个线程并使用 ProgressChanged 事件通知另一个线程数据已准备好。其他事件也可用。 [这篇 MSDN 文章应该可以帮助您入门](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.progresschanged.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T18:48:18.947

有很多方法可以做到这一点，具体取决于您想要做什么。[生产者/消费者队列](http://www.albahari.com/threading/part2.aspx#_ProducerConsumerQWaitHandle)可能是您想要的。要深入了解线程，请参阅优秀书籍[C# 3.0 in a Nutshell 中关于](https://rads.stackoverflow.com/amzn/click/com/0596527578)[线程](http://www.albahari.com/threading/)的章节（可在线获得）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T19:24:47.877

您可以使用 AutoResetEvent（或 ManualResetEvent）。如果你使用 AutoResetEvent.WaitOne(0, false)，它不会阻塞。例如：

```
AutoResetEvent ev = new AutoResetEvent(false);
...
if(ev.WaitOne(0, false)) {
  // event happened
}
else {
 // do other stuff
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T21:42:15.423

在这种情况下，BackgroundWorker 类是答案。它是唯一能够将消息异步发送到创建 BackgroundWorker 对象的*线程的线程构造。*通过调用方法在内部`BackgroundWorker`使用类。`AsyncOperation``asyncOperation.Post()`

```
this.asyncOperation = AsyncOperationManager.CreateOperation(null);
this.asyncOperation.Post(delegateMethod, arg); 
```

.NET 框架中的一些其他类也使用 AsyncOperation：

*   后台工作者
*   SoundPlayer.LoadAsync()
*   SmtpClient.SendAsync()
*   Ping.SendAsync()
*   WebClient.DownloadDataAsync()
*   WebClient.DownloadFile()
*   WebClient.DownloadFileAsync()
*   网络客户端...
*   图片框.LoadAsync()

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T20:14:44.807

如果您的“主”线程是 Windows 消息泵 (GUI) 线程，那么您可以使用 Forms.Timer 进行轮询 - 根据您需要让 GUI 线程“注意到”来自工作线程的数据的速度调整计时器间隔.

`List<>`如果要使用，请记住同步对共享的访问`foreach`，以避免`CollectionModified`异常。

我将这种技术用于实时交易应用程序中的所有市场数据驱动的 GUI 更新，并且效果很好。

# oop - 为什么我似乎无法掌握接口？

> ID：122883
> 
> 赞同：54
> 
> 时间：2008-09-23T18:36:08.583
> 
> 标签：oop, interface

有人可以为我揭开界面的神秘面纱或指出一些好的例子吗？我不断地看到接口弹出来这里和那里，但我从来没有真正接触过关于接口或何时使用它们的良好解释。

我在接口与抽象类的上下文中谈论接口。

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-09-23T18:47:20.990

接口允许您根据“描述”而不是类型进行编程，这允许您更松散地关联软件的元素。

可以这样想：您想与您旁边的立方体中的某人共享数据，因此您拔出闪存棒并复制/粘贴。你走到隔壁，那个人说“那是USB吗？” 你说是的 - 一切就绪。闪存棒的大小和制造商无关紧要 - 重要的是它是 USB。

以同样的方式，接口允许您对您的开发进行通用化。使用另一个类比 - 假设您想创建一个虚拟绘制汽车的应用程序。你可能有这样的签名：

```
public void Paint(Car car, System.Drawing.Color color)... 
```

这将一直有效，直到您的客户说“现在我想画卡车”，所以您可以这样做：

```
public void Paint (Vehicle vehicle, System.Drawing.Color color)... 
```

这将扩大您的应用程序......直到您的客户说“现在我想画房子！” 您可以从一开始就创建一个界面：

```
public interface IPaintable{
   void Paint(System.Drawing.Color color);
} 
```

...并将其传递给您的例程：

```
public void Paint(IPaintable item, System.Drawing.Color color){
   item.Paint(color);
} 
```

希望这是有道理的——这是一个非常简单的解释，但希望能深入人心。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-09-23T18:53:21.447

接口在类和调用它的代码之间建立了契约。它们还允许您拥有实现相同接口但执行不同操作或事件的类似类，而不必知道您实际使用的是哪个类。作为一个例子，这可能更有意义，所以让我在这里尝试一个。

假设您有几个名为 Dog、Cat 和 Mouse 的类。这些类中的每一个都是一个 Pet，理论上你可以从另一个名为 Pet 的类中继承它们，但问题就在这里。宠物本身不做任何事情。你不能去商店买宠物。你可以去买一只狗或一只猫，但宠物是一个抽象的概念，而不是具体的。

所以你知道宠物可以做某些事情。他们可以睡觉或吃饭等。所以你定义了一个名为 IPet 的接口，它看起来像这样（C# 语法）

```
public interface IPet
{
    void Eat(object food);
    void Sleep(int duration);
} 
```

您的每个 Dog、Cat 和 Mouse 类都实现了 IPe。

```
public class Dog : IPet 
```

所以现在每个类都必须有自己的 Eat 和 Sleep 实现。是的，你有合同......现在有什么意义。

接下来假设您要创建一个名为 PetStore 的新对象。这不是一个很好的 PetStore，所以他们基本上只是向您出售随机宠物（是的，我知道这是一个人为的例子）。

```
public class PetStore
{
     public static IPet GetRandomPet()
     {    
          //Code to return a random Dog, Cat, or Mouse
     } 
}

IPet myNewRandomPet = PetStore.GetRandomPet();
myNewRandomPet.Sleep(10); 
```

问题是你不知道它会是什么类型的宠物。多亏了界面，尽管您知道它会吃什么和睡什么。

所以这个答案可能根本没有帮助，但一般的想法是接口可以让你做一些简洁的事情，比如依赖注入和控制反转，你可以在其中获取一个对象，有一个明确定义的对象可以做的事情列表真的没有知道该对象的具体类型是什么。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2008-09-23T18:43:37.427

最简单的答案是接口定义了你的类可以做什么。这是一份“合同”，规定您的班级将能够执行该操作。

```
Public Interface IRollOver
    Sub RollOver()
End Interface

Public Class Dog Implements IRollOver
    Public Sub RollOver() Implements IRollOver.RollOver
        Console.WriteLine("Rolling Over!")
    End Sub
End Class

Public Sub Main()
    Dim d as New Dog()
    Dim ro as IRollOver = TryCast(d, IRollOver)
    If ro isNot Nothing Then
        ro.RollOver()
    End If
End Sub 
```

基本上，只要 Dog 类继续实现该接口，您就可以保证它始终具有翻转的能力。如果猫获得了 RollOver() 的能力，它们也可以实现该接口，并且当要求 Dogs 和 Cats 进行 RollOver() 时，您可以同质对待它们。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-09-23T18:51:34.617

当你开朋友的车时，你或多或少知道该怎么做。这是因为传统汽车都有一个非常相似的界面：方向盘、踏板等等。将此接口视为汽车制造商和驾驶员之间的合同。作为驾驶员（软件术语中界面的用户/客户端），您无需了解不同汽车的详细信息即可驾驶它们：例如，您只需要知道转动方向盘会使汽车转弯。作为汽车制造商（软件方面接口实现的提供者），您清楚地知道您的新车应该具备什么以及它应该如何表现，以便驾驶员可以在没有太多额外培训的情况下使用它们。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-23T23:33:04.987

接口是一种减少系统不同、可能不同部分之间耦合的机制。

从[.NET](http://en.wikipedia.org/wiki/.NET_Framework)的角度来看

*   接口定义是操作和/或属性的列表。
*   接口方法总是公开的。
*   接口本身不必是公开的。

创建*实现*接口的类时，必须提供接口定义的所有方法和属性的显式或隐式实现。

此外，.NET 只有单一继承，并且接口是对象向其他不知道或位于其类层次结构之外的对象公开方法的必要条件。这也称为暴露行为。

### 一个更具体的例子：

考虑一下我们有许多 DTO（数据传输对象），它们具有最后更新的人员以及更新时间的属性。问题是并非所有 DTO 都具有此属性，因为它并不总是相关的。

同时，我们需要一种通用机制来保证这些属性在提交到工作流时设置（如果可用），但工作流对象应该与提交的对象松散耦合。即提交工作流方法不应该真正了解每个对象的所有细节，并且工作流中的所有对象不一定都是DTO 对象。

```
// First pass - not maintainable
void SubmitToWorkflow(object o, User u)
{
  if (o is StreetMap)
  {
     var map = (StreetMap)o;
     map.LastUpdated = DateTime.UtcNow;
     map.UpdatedByUser = u.UserID;
  }
  else if (o is Person)
  {
     var person = (Person)o;
     person.LastUpdated = DateTime.Now; // Whoops .. should be UtcNow
     person.UpdatedByUser = u.UserID;
  }
  // Whoa - very unmaintainable. 
```

在上面的代码中，`SubmitToWorkflow()`必须了解每个对象。此外，代码中包含大量 if/else/switch，违反了[不重复](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)(DRY) 原则，并且要求开发人员在每次将新对象添加到系统时记住复制/粘贴更改。

```
// Second pass - brittle
void SubmitToWorkflow(object o, User u)
{
  if (o is DTOBase)
  {
     DTOBase dto = (DTOBase)o;
     dto.LastUpdated = DateTime.UtcNow;
     dto.UpdatedByUser = u.UserID;
  } 
```

它稍微好一点，但它仍然很脆。如果我们要提交其他类型的对象，我们还需要更多的case语句。等等

```
// Third pass pass - also brittle
void SubmitToWorkflow(DTOBase dto, User u)
{
  dto.LastUpdated = DateTime.UtcNow;
  dto.UpdatedByUser = u.UserID; 
```

它仍然很脆弱，并且这两种方法都施加了约束，即所有 DTO 都必须实现这个我们指出的属性并不普遍适用。一些开发人员可能很想编写什么都不做的方法，但这闻起来很糟糕。我们不希望类假装他们支持更新跟踪但不支持。

### 接口，它们有什么帮助？

如果我们定义一个非常简单的接口：

```
public interface IUpdateTracked
{
  DateTime LastUpdated { get; set; }
  int UpdatedByUser { get; set; }
} 
```

任何需要这种自动更新跟踪的类都可以实现该接口。

```
public class SomeDTO : IUpdateTracked
{
  // IUpdateTracked implementation as well as other methods for SomeDTO
} 
```

工作流方法可以变得更通用、更小、更易于维护，并且无论有多少类实现接口（DTO 或其他），它都将继续工作，因为它只处理接口。

```
void SubmitToWorkflow(object o, User u)
{
  IUpdateTracked updateTracked = o as IUpdateTracked;
  if (updateTracked != null)
  {
     updateTracked.LastUpdated = DateTime.UtcNow;
     updateTracked.UpdatedByUser = u.UserID;
  }
  // ... 
```

*   我们可以注意到这种变化`void SubmitToWorkflow(IUpdateTracked updateTracked, User u)`将保证类型安全，但是在这些情况下它似乎并不相关。

在我们使用的一些生产代码中，我们有代码生成来从数据库定义中创建这些 DTO 类。开发人员唯一要做的就是必须正确创建字段名称并使用接口装饰类。只要属性被称为 LastUpdated 和 UpdatedByUser，它就可以工作。

也许您在问*如果我的数据库是遗留数据库并且这是不可能的会发生什么？*你只需要多打字一点；接口的另一个重要特性是它们可以让您在类之间创建一座桥梁。

在下面的代码中，我们有一个虚构的`LegacyDTO`，一个具有类似名称字段的预先存在的对象。它正在实现 IUpdateTracked 接口以桥接现有但名称不同的属性。

```
// Using an interface to bridge properties
public class LegacyDTO : IUpdateTracked
{
    public int LegacyUserID { get; set; }
    public DateTime LastSaved { get; set; }

    public int UpdatedByUser
    {
        get { return LegacyUserID; }
        set { LegacyUserID = value; }
    }
    public DateTime LastUpdated
    {
        get { return LastSaved; }
        set { LastSaved = value; }
    }
} 
```

您可能会*觉得很酷，但是拥有多个属性不会令人困惑吗？*或者*如果已经有这些属性，但它们意味着别的东西，会发生什么？*.NET 使您能够显式实现接口。

这意味着 IUpdateTracked 属性仅在我们使用对 IUpdateTracked 的引用时才可见。请注意声明中没有 public 修饰符，并且声明包含接口名称。

```
// Explicit implementation of an interface
public class YetAnotherObject : IUpdatable
{
    int IUpdatable.UpdatedByUser
    { ... }
    DateTime IUpdatable.LastUpdated
    { ... } 
```

拥有如此多的灵活性来定义类如何实现接口为开发人员提供了很大的自由来将对象与使用它的方法分离。接口是打破耦合的好方法。

接口不仅仅是这个。这只是一个简化的现实生活示例，它利用了基于接口的编程的一个方面。

正如我之前提到的，以及其他响应者，您可以创建获取和/或返回接口引用而不是特定类引用的方法。如果我需要在列表中查找重复项，我可以编写一个方法，该方法接受并返回一个`IList`（定义对列表工作的操作的接口），并且我不限于具体的集合类。

```
// Decouples the caller and the code as both
// operate only on IList, and are free to swap
// out the concrete collection.
public IList<T> FindDuplicates( IList<T> list )
{
    var duplicates = new List<T>()
    // TODO - write some code to detect duplicate items
    return duplicates;
} 
```

### 版本控制警告

如果它是一个公共接口，你声明*我保证接口 x 看起来像这样！*一旦你发布了代码并发布了界面，你就永远不应该改变它。一旦消费者代码开始依赖该接口，您就不想在现场破坏他们的代码。

请参阅[此 Haacked 帖子](http://haacked.com/archive/2008/02/20/versioning-issues-with-abstract-base-classes-and-interfaces.aspx)以进行很好的讨论。

### 接口与抽象（基）类

抽象类可以提供实现，而接口不能。如果您遵循一些准则，例如 NVPI（非虚拟公共接口）模式，抽象类在某些方面在版本控制方面更加灵活。

值得重申的是，在 .NET 中，一个类只能从一个类继承，但一个类可以实现任意多个接口。

## 依赖注入

接口和依赖注入 (DI) 的快速总结是，接口的使用使开发人员能够编写针对接口编程的代码以提供服务。在实践中，您最终会得到很多小接口和小类，一种想法是，只做一件事且只做一件事的小类更容易编码和维护。

```
class AnnualRaiseAdjuster
   : ISalaryAdjuster
{
   AnnualRaiseAdjuster(IPayGradeDetermination payGradeDetermination) { ...  }

   void AdjustSalary(Staff s)
   {
      var payGrade = payGradeDetermination.Determine(s);
      s.Salary = s.Salary * 1.01 + payGrade.Bonus;
   }
} 
```

简而言之，上述代码段中显示的好处是薪酬等级确定只是注入到年度加薪调整器中。如何确定工资等级对这个班级实际上并不重要。测试时，开发人员可以模拟薪资等级确定结果，以确保薪资调整器按预期运行。测试也很快，因为测试只测试类，而不是其他所有东西。

这不是 DI 入门读物，因为有整本书专门讨论这个主题。上面的例子非常简化。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-23T18:57:13.543

这是一个相当“长”的主题，但让我试着简单地说。

一个接口是——正如“他们所说的”——一个合同。但是忘了那个词。

理解它们的最好方法是通过某种伪代码示例。这就是我很久以前对它们的理解。

假设您有一个处理消息的应用程序。消息包含一些内容，例如主题、文本等。

因此，您编写 MessageController 来读取数据库并提取消息。直到您突然听说传真也将很快实施，这非常好。因此，您现在必须阅读“传真”并将它们作为消息处理！

这很容易变成 Spagetti 代码。因此，您所做的不是使用 MessageController 而不是仅控制“消息”，而是使其能够与名为 IMessage 的**接口**一起使用（I 只是常见用法，但不是必需的）。

您的 IMessage 界面包含一些您*需要*的基本数据，以确保您能够处理 Message 本身。

因此，当您创建 EMail、Fax、PhoneCall 类时，您让它们**实现**名为*IMessage*的**接口**。

 *所以在你的 MessageController 中，你可以有一个这样的方法：

```
private void ProcessMessage(IMessage oneMessage)
{
    DoSomething();
} 
```

如果您没有使用过接口，则必须：

```
private void ProcessEmail(Email someEmail);
private void ProcessFax(Fax someFax);
etc. 
```

因此，通过使用**通用**接口，您只需确保 ProcessMessage 方法能够使用它，无论它是传真、电子邮件还是电话呼叫等。

*为什么或如何*？

因为接口是一个*契约*，它指定了一些你**必须**遵守（或实现）才能使用它的东西。把它想象成一个*徽章*。如果您的对象“Fax”没有 IMessage 接口，那么您的 ProcessMessage 方法将无法使用它，它会给您一个无效的类型，因为您将 Fax 传递给一个需要 IMessage 的方法目的。

你明白重点了吗？

将接口视为您将可用的方法和属性的“子集”，**尽管**是真实的对象类型。如果原始对象（Fax、Email、PhoneCall 等）实现了该接口，您可以安全地将其传递给需要该接口的方法。

那里隐藏着更多的魔法，你可以将接口转换回它们的原始对象：

传真 myFax = (Fax)SomeIMessageThatIReceive;

.NET 1.1 中的 ArrayList() 有一个很好的接口，称为 IList。如果你有一个 IList（非常“通用”），你可以将它转换成一个 ArrayList：

```
ArrayList ar = (ArrayList)SomeIList; 
```

野外有数千个样本。

ISortable、IComparable 等接口定义了您**必须**在类中实现的方法和属性，以实现该功能。

为了扩展我们的示例，如果类型是 IMessage，您可以在同一个列表中拥有一个包含电子邮件、传真、电话呼叫的 List<>，但如果对象只是电子邮件、传真等，则不能将它们全部放在一起.

如果您想对对象进行排序（例如枚举），则需要它们来实现相应的接口。在 .NET 示例中，如果您有一个“传真”对象列表，并且希望能够使用 MyList.Sort() 对它们进行*排序，则***需要**使您的传真类如下所示：

```
public class Fax : ISorteable 
{
   //implement the ISorteable stuff here.
} 
```

我希望这能给你一个提示。其他用户可能会发布其他好的示例。祝你好运！拥抱接口的力量。

**警告**：接口并非一切都好，它们存在*一些*问题，OOP 纯粹主义者会对此展开战争。我将留在一边。Interfce 的一个缺点（至少在 .NET 2.0 中）是您不能拥有 PRIVATE 成员或受保护的成员，它*必须*是公共的。这是有道理的，但有时您希望您可以简单地将内容声明为私有或受保护。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-23T19:01:44.640

除了编程语言中的功能接口外，它们也是向他人表达设计思想时的强大语义*工具*。

具有良好设计接口的代码库突然变得更容易讨论。“是的，您需要一个 CredentialsManager 来注册新的远程服务器。” “将 PropertyMap 传递给 ThingFactory 以获取工作实例。”

用一个词解决复杂事物的能力非常有用。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-23T18:55:34.920

接口允许您以通用方式对对象进行编码。例如，假设您有一个发送报告的方法。现在假设您有一个新要求，您需要编写新报告。如果您可以重用您已经编写的方法，那会很好吗？接口使这很容易：

```
interface IReport
{
    string RenderReport();
}

class MyNewReport : IReport
{
    public string RenderReport()
    {
        return "Hello World Report!";

    }
}

class AnotherReport : IReport
{
    public string RenderReport()
    {
        return "Another Report!";

    }
}

//This class can process any report that implements IReport!
class ReportEmailer()
{
     public void EmailReport(IReport report)
     {
         Email(report.RenderReport());
     }
}

class MyApp()
{
    void Main()
    {
        //create specific "MyNewReport" report using interface
        IReport newReport = new MyNewReport();

        //create specific "AnotherReport" report using interface
        IReport anotherReport = new AnotherReport();

        ReportEmailer reportEmailer = new ReportEmailer();

        //emailer expects interface
        reportEmailer.EmailReport(newReport);
        reportEmailer.EmailReport(anotherReport);

    }

} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-23T19:09:28.927

接口也是多态性的关键，多态性是“OOD 的三大支柱”之一。

有些人在上面提到过，多态性只是意味着给定的类可以采用不同的“形式”。意思是，如果我们有两个类，“Dog”和“Cat”并且都实现了接口“INeedFreshFoodAndWater”（呵呵）——你的代码可以做这样的事情（伪代码）：

```
INeedFreshFoodAndWater[] array = new INeedFreshFoodAndWater[];
array.Add(new Dog());
array.Add(new Cat());

foreach(INeedFreshFoodAndWater item in array)
{
   item.Feed();
   item.Water();
} 
```

这很强大，因为它允许您抽象地处理不同类别的对象，并允许您做一些事情，例如使您的对象更松散耦合等。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-23T19:00:35.030

好的，所以它是关于抽象类与接口的......

从概念上讲，抽象类被用作基类。很多时候，它们自己已经提供了一些基本功能，而子类必须提供它们自己的抽象方法实现（那些是在抽象基类中没有实现的方法）。

接口主要用于将客户端代码与特定实现的细节分离。此外，有时在不更改客户端代码的情况下切换实现的能力使客户端代码更加通用。

在技​​术层面上，很难在抽象类和接口之间划清界限，因为在某些语言（例如，C++）中，没有语法差异，或者因为您也可以将抽象类用于解耦或泛化的目的。使用抽象类作为接口是可能的，因为根据定义，每个基类都定义了一个其所有子类都应遵循的接口（即，应该可以使用子类而不是基类）。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-23T18:41:50.210

接口是一种强制对象实现一定数量功能的方法，而不必使用继承（这导致代码强耦合，而不是松散耦合，可以通过使用接口来实现）。

接口描述的是功能，而不是实现。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-10-21T17:26:56.387

Most of the interfaces you come across are a collection of method and property signatures. Any one who implements an interface must provide definitions to what ever is in the interface.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-23T18:50:14.463

简单地说：接口是一个定义了方法但没有实现的类。相反，抽象类实现了一些方法，但不是全部。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-23T18:55:24.450

将接口视为合同。当一个类实现一个接口时，它本质上是同意遵守该合同的条款。作为消费者，您只关心您拥有的物品能否履行其合同义务。他们的内部运作和细节并不重要。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-23T18:55:51.673

这是我经常使用的一个与数据库相关的示例。假设您有一个对象和一个容器对象，例如列表。让我们假设有时您可能希望以特定顺序存储对象。假设序列与数组中的位置无关，而是对象是更大对象集的子集，并且序列位置与数据库 sql 过滤有关。

要跟踪您的自定义序列位置，您可以使您的对象实现自定义接口。自定义界面可以调解维护此类序列所需的组织工作。

例如，您感兴趣的序列与记录中的主键无关。对于实现接口的对象，您可以说 myObject.next() 或 myObject.prev()。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-23T18:57:19.970

假设您指的是静态类型的面向对象语言中的接口，主要用途是断言您的类遵循特定的合同或协议。

假设你有：

```
public interface ICommand
{
    void Execute();
}
public class PrintSomething : ICommand
{
    OutputStream Stream { get; set; }
    String Content {get; set;}
    void Execute()
    { 
        Stream.Write(content);
    }
} 
```

现在你有了一个可替代的命令结构。实现 IExecute 的类的任何实例都可以存储在某种列表中，比如实现 IEnumerable 的内容，您可以循环并执行每一个，知道每个对象都会做正确的事情。您可以通过实现 CompositeCommand 创建一个复合命令，该命令将具有自己的要运行的命令列表，或者一个 LoopingCommand 重复运行一组命令，然后您将拥有大部分简单的解释器。

当您可以将一组对象简化为它们都具有的共同行为时，您可能有理由提取接口。此外，有时您可以使用接口来防止对象意外侵入该类的关注点；例如，您可以实现一个只允许客户端检索而不是更改对象中的数据的接口，并且让大多数对象只接收对检索接口的引用。

当您的界面相对简单并且很少做假设时，界面效果最好。

查阅 Liskov 替代原则以更清楚地理解这一点。

一些像 C++ 这样的静态类型语言不支持将接口作为一等概念，因此您使用纯抽象类创建接口。

**更新** 由于您似乎在询问抽象类与接口，这是我首选的过度简化：

*   接口定义功能和特性。
*   抽象类定义核心功能。

通常，我会在构建抽象类之前进行提取接口重构。如果我认为应该有一个创建契约（特别是子类应该始终支持特定类型的构造函数），我更有可能构建一个抽象类。但是，我很少在 C#/java 中使用“纯”抽象类。我更有可能用至少一个包含有意义行为的方法来实现一个类，并使用抽象方法来支持该方法调用的模板方法。那么抽象类是一种行为的基本实现，所有具体的子类都可以利用它而无需重新实现。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-23T19:24:33.913

简单的回答：接口是一堆方法签名（+返回类型）。当一个对象说它*实现*了一个接口时，你就知道它公开了那组方法。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-23T19:30:28.313

在 Java 中使用接口与抽象类的一个很好的理由是子类不能扩展多个基类，但它可以实现多个接口。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-23T19:39:40.897

Java 不允许多重继承（有很好的理由，请查看可怕的菱形）但是如果你想让你的类提供多组行为怎么办？假设您希望任何使用它的人都知道它可以被序列化，并且它可以在屏幕上绘制自己。答案是实现两个不同的接口。

因为接口不包含它们自己的实现，也不包含实例成员，所以在同一个类中实现它们中的几个是安全的，没有歧义。

不利的一面是，您必须分别在每个类中实现。因此，如果您的层次结构很简单，并且所有继承类的实现部分应该相同，请使用抽象类。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-23T19:46:33.610

就像其他人在这里所说的那样，接口定义了一个契约（使用接口的类将如何“看起来”），抽象类定义共享功能。

让我们看看代码是否有帮助：

```
public interface IReport
{
    void RenderReport(); // This just defines the method prototype
}

public abstract class Reporter
{
    protected void DoSomething()
    {
        // This method is the same for every class that inherits from this class
    }
}

public class ReportViolators : Reporter, IReport
{
    public void RenderReport()
    {
        // Some kind of implementation specific to this class
    }
}

public class ClientApp
{
    var violatorsReport = new ReportViolators();

    // The interface method
    violatorsReport.RenderReport();

    // The abstract class method
    violatorsReport.DoSomething();
} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-23T21:04:08.027

接口是一种以仍然是强类型和多态的方式实现约定的方法。

一个很好的现实世界示例是 .NET 中的 IDisposable。实现 IDisposable 接口的类强制该类实现 Dispose() 方法。如果该类未实现 Dispose()，则在尝试构建时会出现编译器错误。此外，此代码模式：

```
using (DisposableClass myClass = new DisposableClass())
  {
  // code goes here
  } 
```

将导致 myClass.Dispose() 在执行退出内部块时自动执行。

但是，这很重要，对于您的 Dispose() 方法应该做什么没有强制执行。您可以让您的 Dispose() 方法从文件中选择随机配方并将它们通过电子邮件发送到分发列表，编译器不在乎。IDisposable 模式的目的是使清理资源更容易。如果一个类的实例将保留文件句柄，那么 IDisposable 可以很容易地将释放和清理代码集中在一个地方，并促进一种确保释放总是发生的使用风格。

这就是接口的关键。它们是一种简化编程约定和设计模式的方法。如果使用得当，它会促进更简单、更易于使用、更易于维护和更正确的自文档化代码。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2010-09-05T16:47:32.570

我和你有同样的问题，我觉得“合同”的解释有点混乱。

如果您指定一个方法将 IEnumerable 接口作为参数，您可以说这是一个约定，指定参数必须是继承自 IEnumerable 接口的类型，因此支持 IEnumerable 接口中指定的所有方法。如果我们使用抽象类或普通类，情况也是如此。从这些类继承的任何对象都可以作为参数传入。在任何情况下，您都可以说继承的对象支持基类中的所有公共方法，无论基类是普通类、抽象类还是接口。

具有所有抽象方法的抽象类与接口基本相同，因此您可以说接口只是一个没有实现方法的类。您实际上可以从语言中删除接口，而只使用带有抽象方法的抽象类。我认为我们将它们分开的原因是出于语义原因，但出于编码原因，我没有看到原因并且发现它只是令人困惑。

另一个建议可能是将接口重命名为接口类，因为接口只是类的另一种变体。

在某些语言中存在细微的差异，允许一个类仅继承 1 个类但有多个接口，而在其他语言中，您可以同时拥有很多，但这是另一个问题，我认为没有直接关系

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2012-08-06T15:16:21.827

理解接口的最简单方法是从考虑类继承的含义开始。它包括两个方面：

1.  派生类的成员可以使用基类的公共或受保护成员作为自己的成员。
2.  派生类的成员可以由需要基类成员的代码使用（这意味着它们是可替换的）。

这两个特性都很有用，但是因为很难让一个类使用多个类的成员作为自己的成员，所以许多语言和框架只允许类从单个基类继承。另一方面，让一个类可以替代多个其他不相关的东西并没有什么特别的困难。

此外，由于继承的第一个好处可以在很大程度上通过封装来实现，因此允许第一种类型的多重继承的相对好处是有限的。另一方面，能够用一个对象代替多种不相关类型的事物是一种有用的能力，如果没有语言支持，这种能力就无法轻易实现。

Interfaces provide a means by which a language/framework can allow programs to benefit from the second aspect of inheritance for multiple base types, without requiring it to also provide the first.

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2014-07-07T05:01:56.873

Interface is like a fully abstract class. That is, an abstract class with only abstract members. You can also implement multiple interfaces, it's like inheriting from multiple fully abstract classes. Anyway.. this explanation only helps if you understand what an abstract class is.

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-09-23T18:58:53.367

接口要求实现它们的任何类包含接口中定义的方法。

目的是，无需查看类中的代码，您就可以知道它是否可用于特定任务。比如Java中的Integer类实现了Comparable接口，所以，如果你只看到方法头（公共类String实现Comparable），你就知道它包含了一个compareTo()方法。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2012-08-05T16:35:59.260

`show()`在您的简单情况下，您可以通过使用实现（或可能将其定义为抽象）的公共基类来实现与接口所获得的类似的东西。让我将您的通用名称更改为更具体的名称，*Eagle*和*Hawk*而不是*MyClass1*和*MyClass2*。在这种情况下，您可以编写如下代码

```
Bird bird = GetMeAnInstanceOfABird(someCriteriaForSelectingASpecificKindOfBird);
bird.Fly(Direction.South, Speed.CruisingSpeed); 
```

这使您可以编写可以处理任何东西*的代码* *Bird*。然后，您可以编写代码，使*Bird*执行其操作（飞行、进食、产卵等），该操作作用于它视为*Bird*的实例。无论*Bird*是否真的是*Eagle*、*Hawk或其他任何从**Bird*派生的东西，该代码都可以使用。

但是，当您没有真正*的*关系时，这种范式开始变得混乱。假设您想编写在天空中飞行的代码。如果您编写该代码以接受*Bird*基类，则突然很难将该代码演变为在*JumboJet*实例上工作，因为虽然*Bird*和*JumboJet*肯定都可以飞行，但*JumboJet*肯定不是*Bird*。

进入界面。

Bird （和*Eagle*和*Hawk*）的*共同点*是它们都能飞*。*如果您编写上面的代码而不是作用于接口*IFly*，则该代码可以应用于任何提供该接口实现的东西。

 ***# c++ - 快速平面旋转算法？

> ID：122886
> 
> 赞同：5
> 
> 时间：2008-09-23T18:36:45.493
> 
> 标签：c++, c, geometry, rotation, planerotation

我正在开发一个应用程序，它检测图像中最突出的矩形，然后试图旋转它，使矩形的左下角位于原点，类似于 IUPR 的[OSCAR](http://demo.iupr.org/oscar/oscar.php "奥斯卡")系统的工作方式。但是，一旦检测到最突出的矩形，我不确定如何考虑深度分量或 z 轴，因为矩形并不总是“正面”。任何能加深我理解的例子都将不胜感激。下面是 IUPR 的 OSCAR 系统的一个示例。

[替代文字 http://quito.informatik.uni-kl.de/oscar/oscar.php?serverimage=img_0324.jpg&montage=use](http://quito.informatik.uni-kl.de/oscar/oscar.php?serverimage=img_0324.jpg&montage=use "旋转示例")

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T18:43:14.667

在这种情况下，您实际上不需要处理 3D 信息，它只是一个映射函数，从一组坐标到另一组坐标。

看看仿射变换，它们能够纠正简单的倾斜和透视效果。您应该能够在某处找到代码，该代码将根据矩形角的 4 个点计算变换。

差点忘了——如果“快速”真的很重要，您可以简化系统以仅组合使用简单的剪切变换，尽管这会对高度倾斜的对象的图像质量产生不良影响。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T18:59:10.027

实际上，我认为您可以使用比[Mark 的方法简单得多的方法](https://stackoverflow.com/questions/122886/fast-plane-rotation-algorithm#122937)。

1.  在倾斜图像上获得 2D 坐标后，将这些坐标重新用作纹理坐标。

2.  在渲染器中，绘制一个简单的矩形，其中每个角的顶点都被纹理映射到倾斜的 2D 图像上的顶点（归一化并以其他方式转换为渲染系统的纹理坐标平面）。

现在您可以依靠硬件（使用 OpenGL 或类似工具）为您进行校正，或者您可以编写自己的纹理映射器：

由于我们正在处理实际的 3D 信息，因此需要猜测纵横比。但是，您只需获取倾斜矩形的最大宽度和最大高度即可。

[Chris Hecker 的透视纹理映射](http://www.gamers.org/dEngine/quake/papers/checker_texmap.html)

# asp.net - 使用 jQuery 的优缺点是什么？

> ID：122902
> 
> 赞同：24
> 
> 时间：2008-09-23T18:39:04.553
> 
> 标签：asp.net, jquery, reference

作为一个只精通 javascript 的人，jQuery 适合我吗？有没有更好的库可以使用？我看过很多与 jQuery 相关的帖子，它似乎是将 javascript 合并到 ASP.NET 应用程序中的最有效方式。

我去过[jQuery 的](http://jquery.com/)网站，找到了教程和其他有用的信息。任何其他参考资料（即书籍、博客等）都会有所帮助。

谢谢！

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-23T18:42:37.307

像[jQuery](http://www.jquery.com)和[Prototype](http://www.prototypejs.org)这样的库的伟大之处在于，它们处理了许多跨浏览器的 kwirks，这些 kwirks 会使 Javascript 编写起来如此痛苦。其中任何一个或什至[mootools](http://www.mootools.net)都会对您有好处，它们各自的网站与将要获得的资源一样好。

**编辑**：至于在你的页面上有额外的加载大小的“骗局”，我建议使用[谷歌](http://code.google.com/apis/ajaxlibs/documentation/)为你托管这些。乐观地说，有些人会从其他网站缓存它，而且谷歌会为你处理版本/压缩。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-20T11:36:40.867

**优点**：jQuery 是一个很棒的库，它可以让你用少得多的代码完成你想做的事情，少***得多的****麻烦* 。插件架构非常简单，生产插件的社区非常强大和活跃。如果你能想“如果我能......不是很好”，那么很可能有一个插件。

 ***缺点**：您正在从原始 Javascript 中抽象出来。不要低估这个“骗局”的影响。尽管在 vanilla JS（即没有库的 javascript）中工作可能会很痛苦，但它可以让您更好地了解您实际在做什么。您可能会发现您的基于 jQuery 的解决方案实际上可以在 vanilla JS 中完成，而且开销要少得多。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-23T18:42:00.380

优点：您不必处理跨平台 Javascript 兼容性的混乱局面。您不必担心哪些浏览器支持标准事件处理程序，哪些有自己的事件系统。您不必使用 HugeLongFunctionNamesFromHell 编写 200 行 DOM 操作来获得漂亮的动态页面。

缺点：这是您的用户在第一次加载您的页面时必须下载的额外 15KB 代码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-07T06:14:10.387

刚开始学习 JavaScript 时，我惊奇地看着各种库。然后我更仔细地查看了 jQuery 并被迷住了。如果不加载 jQuery，我将不再使用 DOM。jQuery 不仅适用于网站，还带来了强大的实用程序、减少的代码以及对本地管理员 JavaScript 的简单处理。

本地 JavaScripts + jQuery + msHta = 很棒的界面驱动脚本！

有关在本地管理员脚本上使用 jQuery 的更多信息，请查看我关于[使用 jQuery 和 HTA 的](http://www.dscoduc.com/2008/11/jquery-and-htas/)帖子...

克里斯

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-23T18:45:41.277

我也刚开始使用 jQuery，并且发现它非常有用。对我来说，最大的优势是在 VS 中有一些非常好的智能感知，并且不必查找世界上所有古老的方法来完成简单的任务。对我来说，它似乎比普通的旧 javascript 组织得更好，而且就像其他人所说的那样，它有很多好的内置库。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-24T09:09:01.660

优点：少写，多做。

缺点：你必须学习它（只有 VS 得到智能感知，而不是大脑 [:)]）

如果你对 jQuery 感兴趣，这里是[Rick Strahl 对 jQuery Books 的一个很好的评论](http://www.west-wind.com/WebLog/posts/370180.aspx "jQuery 书评")

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-23T18:43:53.510

我发现对学习 jQuery 最有帮助的是其他人的插件。我会找到一些你喜欢的东西，然后阅读插件代码。你可能会发现一些很酷的东西来学习。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-11T00:48:37.733

Jquery 也是我使用的第一个 javascript 框架。我发现语法很适合用来学习，插件库和用户的支持对学习这种语言很有帮助。虽然最后我还是继续借用javascript方面的书籍，但我觉得jquery或许是一个展示javascript强大的好方法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-22T19:37:12.987

优点：跨浏览器，用户友好的函数名称。

```
 Many plug-Ins.

  Only 15KB on the client Side.

  Community is pretty huge to guide you.

  Easy to work with Services(.svc,asmx) etc. I believe it is wonderful. 
```

缺点：

```
You may forget JavaScripting 
```

所以，我建议初学者，先学习 JavaScript，然后为[JQuery](http://jquery.com)拉你的袜子。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-21T12:44:03.960

如果您只是在寻找与浏览器兼容且体积非常小的 JavaScript 工具来进行 DOM 操作和 ajax，那么 jQuery 可能就是您正在寻找的工具。

但是 jQuery 在这两个方面都缺乏：

1.  成熟的小部件（想想 extjs）。注意：jQuery-UI 并不完整而且速度很慢。
2.  面向对象的支持（Mootools）。

# oracle - 使用 PL/SQL 如何将文件的内容放入 blob？

> ID：122909
> 
> 赞同：4
> 
> 时间：2008-09-23T18:39:45.050
> 
> 标签：oracle, file-io, plsql, blob

我有一个文件。我想将其内容放入我的 oracle 数据库中的 blob 列或放入我的 PL/SQL 程序中的 blob 变量中。最好的方法是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-23T19:00:25.703

要完全在 PL/SQL 中完成，该文件需要在服务器上，位于您需要在数据库中定义的目录中。创建以下对象：

```
CREATE OR REPLACE DIRECTORY
    BLOB_DIR
    AS
    '/oracle/base/lobs'
/

CREATE OR REPLACE PROCEDURE BLOB_LOAD
AS

    lBlob  BLOB;
    lFile  BFILE := BFILENAME('BLOB_DIR', 'filename');

BEGIN

    INSERT INTO table (id, your_blob)
        VALUES (xxx, empty_blob())
        RETURNING your_blob INTO lBlob;

    DBMS_LOB.OPEN(lFile, DBMS_LOB.LOB_READONLY);

    DBMS_LOB.OPEN(lBlob, DBMS_LOB.LOB_READWRITE);

    DBMS_LOB.LOADFROMFILE(DEST_LOB => lBlob,
                          SRC_LOB  => lFile,
                          AMOUNT   => DBMS_LOB.GETLENGTH(lFile));

    DBMS_LOB.CLOSE(lFile);
    DBMS_LOB.CLOSE(lBlob);

    COMMIT;

END;
/ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T18:55:48.210

取决于你的环境。在Java中你可以这样做......

```
// Need as OracleConnection in mConnection

// Set an EMPTY_BLOB()
String update = "UPDATE tablename"+
                " SET   blob_column = EMPTY_BLOB()"+
                " WHERE  ID = "+id;
CallableStatement stmt = mConnection.prepareCall(update);
stmt.executeUpdate();

// Lock the row FOR UPDATE
String select    = "BEGIN " +
                        "  SELECT " + blob_column
                        "  INTO ? " +
                        "  FROM " + tablename +
                        "  WHERE  ID = '" + id + "'" +
                        "  FOR UPDATE; " +
                        "END;";

stmt = mConnection.prepareCall(select);
stmt.registerOutParameter(1, java.sql.Types.BLOB);
stmt.executeUpdate();

BLOB blob = (BLOB) stmt.getBlob(1);
OutputStream bos = blob.setBinaryStream(0L);
FileInputStream fis = new FileInputStream(file);
//  Code needed here to copy one stream to the other
fis.close();
bos.close();
stmt.close();

mConnection.commit(); 
```

但这真的取决于您使用的环境/工具。需要更多信息。

# c++ - 对象的通用缓存

> ID：122914
> 
> 赞同：12
> 
> 时间：2008-09-23T18:40:31.257
> 
> 标签：c++, stl, boost

有谁知道对象模板缓存的任何实现？

*   您使用一个键来查找对象（与 std::map<> 中的相同）
*   您指定可以同时在缓存中的最大对象数
*   有一些工具可以创建在缓存中找不到的对象
*   有一些工具可以知道何时从缓存中丢弃对象

例如 ：

```
typedef cache<int, MyObj*> MyCache;
MyCache oCache;
oCache.SetSize(1);
oCache.Insert(make_pair(1, new MyObj());
oCache.Touch(1);
MyObj* oldObj = oCache.Delete(1);

... 
```

它可以像 LRU 或 MRU 缓存一样简单。

欢迎任何建议！

网卡

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2016-04-07T12:24:01.343

您可以使用[Boost.MultiIndex](http://www.boost.org/doc/libs/1_60_0/libs/multi_index/doc/index.html)库。[实现MRU 缓存](http://www.boost.org/doc/libs/1_60_0/libs/multi_index/doc/examples.html#example9)很容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-02-03T20:49:29.313

我已经将一个相对简单的 LRU 缓存放在一起，它是由一个映射和一个链表构建的：

```
template<typename K, typename V, typename Map = std::unordered_map<K, typename std::list<K>::iterator>>
class LRUCache
{
    size_t maxSize;
    Map data;
    std::list<K> usageOrder;
    std::function<void(std::pair<K, V>)> onEject = [](std::pair<K, V> x){};

    void moveToFront(typename std::list<K>::iterator itr)
    {
        if(itr != usageOrder.begin())
            usageOrder.splice(usageOrder.begin(), usageOrder, itr);
    }

    void trimToSize()
    {
        while(data.size() > maxSize)
        {
            auto itr = data.find(usageOrder.back());

            onEject(std::pair<K, V>(itr->first, *(itr->second)));
            data.erase(usageOrder.back());
            usageOrder.erase(--usageOrder.end());
        }
    }

public:
    typedef std::pair<const K, V> value_type;
    typedef K key_type;
    typedef V mapped_type;

    LRUCache(size_t maxEntries) : maxSize(maxEntries)
    {
        data.reserve(maxEntries);
    }

    size_t size() const
    {
        return data.size();
    }

    void insert(const value_type& v)
    {
        usageOrder.push_front(v.first);
        data.insert(typename Map::value_type(v.first, usageOrder.begin()));

        trimToSize();
    }

    bool contains(const K& k) const
    {
        return data.count(k) != 0;
    }

    V& at(const K& k)
    {
        auto itr = data.at(k);
        moveToFront(itr);
        return *itr;
    }

    void setMaxEntries(size_t maxEntries)
    {
        maxSize = maxEntries;
        trimToSize();
    }

    void touch(const K& k)
    {
        at(k);
    }

    template<typename Compute>
    V& getOrCompute(const K& k)
    {
        if(!data.contains(k)) insert(value_type(k, Compute()));
        return(at(k));
    }

    void setOnEject(decltype(onEject) f)
    {
        onEject = f;
    }
}; 
```

我认为符合您的标准。有什么需要添加或更改的吗？

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2008-09-23T20:41:01.857

在一个应用程序中，我几乎无法想象它会加速/提高性能来存储显然可以重新创建的对象（臀部：因为当缓存达到顶峰时它们可以被自动丢弃）。sw 缓存需要通过关联代码获取内存，这肯定比内存分配和构造函数运行（主要是内存初始化）慢。

除了手动用户配置以避免分页机制（精确地提高性能，顺便说一句），大多数操作系统为您在磁盘上“缓存”内存......它是“分页”，一种“高成本缓存”的形式，因为没有东西被扔掉，它是由特定的硬件完成的，一个称为内存管理单元的子处理单元......

从大局来看，缓存代码会在冗余的同时减慢进程。

# javascript - jQuery onClick 执行

> ID：122919
> 
> 赞同：1
> 
> 时间：2008-09-23T18:40:39.527
> 
> 标签：javascript, jquery, animation, onclick

我有这段用 jQuery 1.2.5 编写的 javascript。它包含在我编写的插件的 main function() 中。该插件是一个与 jCarousel 非常相似的水平画廊滚动器。它会自动计算宽度，并根据它和图像的大小确定要滚动的数量，这是所有计算正在进行的内容。

我的问题是，如何防止在之前的执行完成之前触发它。例如，如果我得到一点点快乐，然后疯狂地捣碎`.digi_next`. 当这种情况发生时，UI 中的事情不会那么顺利，我想修复它 :) 我认为答案可能在于`queue`，但我所有使用它的尝试都没有任何价值。

```
 var self = this;
    $(".digi_next", this.container).click(function(){

        var curLeft = $(".digi_container", self.container).css("left").split("px")[0];
        var newLeft = (curLeft*1) - (self.containerPad + self.containerWidth) * self.show_photos;

        if (newLeft < ((self.digi_gal_width - (self.containerPad + self.containerWidth) * self.show_photos)) * -1) {
            newLeft = ((self.digi_gal_width - (self.containerPad + self.containerWidth) * self.show_photos)) * -1;
        }

        $(".digi_container", self.container).animate({
            left: newLeft + "px"
        }, self.rotateSpeed);
    }); 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T19:06:00.587

只需使用全局繁忙标志。当您输入您的点击处理程序时，请检查它，并且仅在它为 false 时继续。立即将其设置为 true，然后在动画结束时将其设置回 false。JavaScript 是单线程的，因此无需担心竞争条件。

```
var busy = false;
$("...").onclick(function() {
    if (busy) return false;
    busy = true;
    $("...").animate(..., ..., ..., function() {
        busy= false;
    });
    return false;
}); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T19:32:37.827

看看[jQuery UI](http://ui.jquery.com/)。特别是插件[的效果部分。我在](http://docs.jquery.com/UI/Effects/Slide)[我的个人网站](http://roosteronacid.com/)上使用幻灯片效果（单击框两侧的箭头）。

[**我使用一个**事件处理程序](http://docs.jquery.com/Events/one#typedatafn)和一个回调函数防止用户在效果结束之前多次触发效果。

[这是源代码](http://roosteronacid.com/index.js)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T19:47:06.683

作为上述全局标志的替代方案，您可以将值分配给 DOM 元素，这样可以使页面上的多个元素具有相同的行为：

```
$("...").onclick(function(el) {
    var self = el;
    if (self.busy) return false;
    self.busy = true;
    $("...").animate(..., ..., ..., function() {
        self.busy= false;
    });
    return false;
}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T18:51:49.093

由于 JavaScript 函数调用是异步的，因此您可以将在前一个调用结束时调用的回调函数作为 in 参数传递（对于错误也是如此）。

您可以将您在这篇文章中编写的函数作为之前触发的函数的回调传递。

希望这可以帮助。

问候

# javascript - 如何在 CSS 中可调整大小的空间中排列不同长度的项目？

> ID：122920
> 
> 赞同：1
> 
> 时间：2008-09-23T18:40:42.223
> 
> 标签：javascript, jquery, css, css-tables

我想排列大约像这样的项目：

```
item1      item2           i3           longitemname
i4         longitemname2   anotheritem  i5 
```

基本上不同长度的项目排列在一个类似表格的结构中。棘手的部分是这些容器的大小可能会有所不同，我想在每一行中尽可能多地容纳 - 换句话说，我不会事先知道一行中有多少项目，以及页面是否调整大小后，项目应自行重新流动以适应。例如，最初每行可以容纳 10 个项目，但在调整大小时可以减少到 5 个。

我不认为我可以使用 html 表格，因为我不知道列数（因为我不知道一行可以容纳多少列）。我可以使用 css 来浮动它们，但由于它们的大小不同，它们不会对齐。

到目前为止，我唯一能想到的就是使用 javascript 来获取最大项目的大小，将所有项目的大小设置为该大小，然后将剩下的所有内容浮动。

有更好的建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T19:53:57.493

这可以使用浮动 div、计算最大宽度并将所有宽度设置为最大值来完成。这是执行此操作的 jquery 代码：

html:

```
<div class="item">something</div>
<div class="item">something else</div> 
```

CSS：

```
div.item { float: left; } 
```

jQuery：

```
var max_width=0;
$('div.item').each( function() { if ($(this).width() > max_width) { max_width=$(this).width(); } } ).width(max_width); 
```

不太丑但也不太漂亮，我仍然愿意接受更好的建议......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T20:00:31.377

当你得到一件大得离谱的东西而让其余的看起来很小时会发生什么？我会考虑两种解决方案：

1.  你已经想出的涉及 float:left; 规则和 jQuery，但也具有最大 max_width 或
2.  只需根据您期望的值预先确定所有项目的预设宽度

然后添加一个溢出：隐藏；规则，以便较长的项目不会扭曲表格外观。您甚至可以更改 jQuery 函数来修剪较长的项目，在末尾添加省略号 (...)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T18:44:58.003

您可以使用向左浮动的块级元素，但您需要一些 javascript 来检查尺寸，找到最大的，并将它们全部设置为该宽度。

编辑：刚刚阅读了你帖子的后半部分，看到你提出了这个修复建议。将此帖子视为您当前想法的 +1 :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T19:38:29.137

您实际上需要计算 maxWidth 和 maxHeight ，然后在页面加载后使用 Javascript 中的 resize 函数。我必须为之前的项目执行此操作，如果 div 的高度不同，其中一个浏览器（FF？）将阻止/偏移下面的浏览器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T19:44:32.460

好吧，您可以为每个“项目”创建一个浮动 div，然后循环遍历其属性并使用换行符吗？然后当你完成对属性的循环时，关闭 div 并开始一个新的？这样它们就会像柱子一样，彼此相邻浮动。如果窗口很小，它们将下降到下一个“行”，并且在调整大小时，将向上浮动到右侧（实际上是左侧:-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T19:52:33.690

您可以浮动几个无序列表，如下所示：

```
<ul style="float: left;">
    <li>Short</li>
    <li>Loooong</li>
    <li>Even longer</li>
</ul>
<ul style="float: left;">
    <li>Loooong</li>
    <li>Short</li>
    <li>...</li>
</ul>
<ul style="float: left;">
    <li>Semi long</li>
    <li>...</li>
    <li>Short</li>
</ul> 
```

这将需要您对应该将多少列表中的多少列表项推入 DOM 进行一些计算，但是这样 - 当您重新调整包含列表的容器的大小时 - 列表将浮动以适合该容器.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T20:01:44.917

您可以在每列具有相同宽度的情况下使用以下内容。

您将拥有固定的列宽，但列表会自动重排。我添加了一些额外的 HTML，但现在它可以在 FF en IE 中使用。

html:

```
<ul class="ColumnBasedList">
  <li><span>Item1 2</span></li>
  <li><span>Item2 3</span></li>
  <li><span>Item3 5</span></li>
  <li><span>Item4 6</span></li>
  <li><span>Item5 7</span></li>
  <li><span>Item6 8</span></li>
</ul> 
```

CSS：

```
.ColumnBasedList
{
    width: 80%;
    margin: 0;
    padding: 0;
}

.ColumnBasedList li
{
    list-style-type: none;
    display:inline;
}

.ColumnBasedList li span
{
    display: -moz-inline-block;
    display: inline-block;
    width: 20em;
    margin: 0.3em;
} 
```

# architecture - 设立建筑部门

> ID：122931
> 
> 赞同：13
> 
> 时间：2008-09-23T18:42:31.067
> 
> 标签：architecture

一些上下文：

想象一下，一家拥有 200 多名开发人员的公司最终成立了一个或多或少独立的架构团队/部门。由 20 多个不同规模的“项目”/生产应用程序组成的软件组合由负责和负责项目“架构”的团队负责人/技术负责人负责。

出于整合和控制架构以及对整个系统进行某些必要的大规模返工的必要性，除了所有急需的知识交流之外，公司决定成立一个架构部门。

*   **这种事业的“做**”和“**不做**”是什么？

*   组成这样一个架构团队的人是谁？

*   他们的职责应该是什么？

*   什么超出了他们的范围？

*   对公司有用的过渡策略是什么？

*   每当有人提到“架构团队”时，如何防止那些歪歪扭扭的表情？

*   贵公司是否已经成功地进行了这样的变革？
    为什么失败了？
    为什么会成功？

那**不**应该是关于“什么是架构？”的讨论（这是非常密切相关的；）。

真正有趣的一点是可以接受/现实的，甚至是安装这样一个团队的无摩擦方式，当然除了一些关于战斗的警告，最好不要开始。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T18:59:52.130

这里有几个需要思考的问题：

*   架构团队的确切任务是什么？
*   架构团队的可交付成果是什么？一个框架、指导方针、实施帮助......或者他们只是[架构宇航员](http://www.joelonsoftware.com/items/2008/05/01.html)？
*   这是否仅适用于未来的应用程序，或者这将是一个向后移植？
*   谁将负责反向移植？（我们的意思是这里的预算......）
*   是否会分配资源来测试反向移植？
*   架构团队是否有真正的实力，或者当第一组抱怨实施变更需要 4 个月时，管理层是否会放弃......
*   您将如何处理各个项目组和架构团队之间的摩擦（是否会有摩擦？）。机会主义者会以此为契机，争夺位置……
*   请注意，这将主要是一场政治游戏......

我的朋友，你的前路很艰难...

**第一步**是明确架构团队应该实现的目标。
你为什么要安排团队？
你想统一所有的应用程序，开发一个通用的框架，什么？
这个团队的任务和愿景是什么？

无论谁在这支球队中担任领导者的人际交往能力更好。可以吹口哨星球大战主题曲并发出光剑声的**不**
应该是才华横溢的程序员……但他可能应该以技术身份加入团队。

 **您可能应该让熟悉大多数项目的人员组成团队。我会谨慎选择*所有*当前的潜在客户，因为这可能需要当前团队的大量知识。让我们面对现实吧，当架构团队提出自己的可交付成果时，这些团队必须富有成效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T19:47:30.613

架构很难做到正确。

“架构师”需要完成工作的权力，但需要足够精明，不会滥用这种权力并完全疏远公司的其他人。

我曾在两个实施架构团队的地方工作过——一个很成功，另一个看起来不太好。在成功的地方，这是一个相对较小的环境，首席架构师被认为是技术领导者，而团队的其他成员则具有出色的写作和政治能力。每个人都为组织的最大利益行事。

在效果不太好的地方，架构师清楚地代表了组织中的特定派系，并没有赢得整个地方的信任或尊重。结果是花更多的时间来编造借口绕过架构，而不是从中收集任何价值。在这种情况下，沮丧变成了被动/攻击性和其他反社会行为。

我认为您提出的有关范围/职责/过渡的其他问题都由“取决于”来回答。这取决于公司、人员、资金和日程安排。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:04:49.810

有趣的问题。

首先，你必须清楚这个“架构”团队正在解决什么问题。如果你不能清楚地定义团队的“使命”，它就会失败并以巨大的爆发力来完成。:)

话虽如此，第一步是定义您要解决的问题。你想跟上技术的步伐吗？您是否尝试在项目之间合并一些代码重用？您是否正在努力利用您的开发人员以达到最佳效果？实施架构团队有几个原因，并且根据您的设置，其中任何一个可能就足够了。从您的问题来看，您的目标似乎是重新设计现有的应用程序，这是一个很好的第一步。

由于您已经拥有一组对应用程序具有良好特定知识的潜在客户，因此从他们开始是一个好主意。将它们放在一起，并讨论出新的全球架构应该是什么样子。此时，您可能还想找一位顾问来帮助促进对话。定义返工的目标，并提出每个人都同意的“大图”。

在那之后，我会挑选一些潜在客户并将他们（从开发人员池中回填潜在客户）推广给架构团队。然后，他们将与领导会面，以确保事情按照“大局”进行。

我不会从外部引入一个全新的团队。这会产生一种不受欢迎的“我们与他们”的动态，这种动态永远不会很好。局外人也不知道事情应该如何工作，或者为什么事情不能按照逻辑暗示的方式工作。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T19:12:20.493

在这种情况下，“架构”本身没有任何意义。它的意思是“横向主题的专家”。

只要你有一个“架构团队”，你就会有一个横向团队，为许多项目提供服务。

正如前面的答案所述，您需要知道“建筑系”这样的主题必须解决的问题。

现在，这是一个基于几个主题的架构团队组织示例：

*   业务和功能架构团队：编写许多与业务相关的规范，并检查现有应用程序和功能工作流之间的一致性，以完成应用程序的连贯性制图。
*   应用程序架构团队：提供制图，但也决定如何将业务和功能架构团队决定的功能规范组织到应用程序中。
    例如，您需要一个用于“组合流程”的功能模块，但应用程序架构团队可以决定将其拆分为“启动器”、“调度程序”、GUI 等。
*   技术架构团队，始终由以下人员组成：
    *   执行架构团队，针对所有非业务纯技术主题（日志记录、KPI、框架......）
    *   开发架构团队（工具评估和支持、技术调查、版本库管理和配置控制）
    *   OA（操作架构）使环境“可执行”（即了解正确的进程、正确的服务器和正确的网络，以便部署您的系统进行认证或生产。）

您可能希望为服务器和网络的所有管理添加一个物流团队，负责备份和 DRP 策略的任务。以及基于良好案例系统的支持策略。

你很高兴。

现在，不要忘记，当您开始一些“大型返工”时，您的功能架构将承担以下**任务**：

*   重新设计的项目以确保它们保持在固定的功能范围内
*   **遗留**项目，以确保其维护不涉及与应用于返工项目的*选择相反的选择。*

在这种规模的商店中进行任何返工确实意味着能够在等待返工生产第一个版本的同时*对遗留项目进行必要的演变。*（遗产不能在 2-3 年的返工中等待并保持静止）

大型返工应涉及三个主要里程碑：

*   1/ 与旧版对话
*   2/ 完成遗产
*   3/ 替换旧版

这意味着任何给定的组件实际上都经过了三次开发！;)

祝你好运，晚安。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T19:10:17.473

一般来说，要非常小心与架构组相关的政治和其他方面的激励措施。“建筑审查委员会”（或任何你想叫它的名字）成为进步的障碍绝非易事。所需要的只是零激励来改进事物，而当事情发生变化并且没有立即改进时，则需要负激励。

意识到会犯错误，一些“伟大的新技术”将变成不成熟的时尚，并鼓励变革和创新。这可能会导致偶尔的短期动荡和失败的转型，但这总比停滞好。

而替代方案不可避免地会导致停滞；在较大的组织中，我看到职业生涯被毁掉，因为经理对他的团队有足够的信心来支持他们对新技术的建议一直到最高层，提供案例研究来证明这一点，并支持它。当新技术最终获得批准时（经过近一年的政治内讧），CTO（一直反对它）声称对这项创新功不可没，并将经理调到了一个偏远地区的部门。在另一个事件中，提出了一项新技术，在同一业务领域有许多成功的例子，并成立了一个委员会来研究这个问题。*五年后*他们还在研究这个问题，什么都没做

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T19:15:31.173

我认为架构团队需要有足够资深的人来了解所有开发团队的内部运作，并且能够对请求/指导方针说不。我曾与优秀的开发人员一起工作，但没有足够的权限，最终跟随来自不同团队的更高级别的开发人员经理，并产生了不一致的框架。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T20:37:57.513

**您需要完成业务场景 A) 和 B)**

A) 如果您不进行设置，即什么都不做怎么办：
估计返工的持续维护成本

B）您确实设置了：
由于资源转移而中断近期可交付成果。
风险多个产品可能在短期内被淘汰。
感知到的额外人力成本。
如果产品因锻炼而变弱（表现或感觉不灵活），谁会举报

接下来让产品团队进行同样的练习，比较结果。

**如果你证明它是合理的，这里有两条我见过的路线**：
1\. 选择一个主导产品来驱动架构并向这个项目添加资源。
然后准备添加更多资源，并耐心等待，否则主导产品会受到影响。
你用这条路线冒险，当主导产品占收入的 40% 时，它就起作用了。
2\. 建立一个小团队，从内部发生的最有希望的讨论中汲取灵感，逐步将新架构包装在每个产品中。
将这个团队的工作融入产品工作中。

**您需要考虑的一些问题**：
1\. 您需要多长时间才能实现架构融合才能获得业务利益。
2\. 已经在讨论架构融合的团队成员是谁，他们是否在询问/建议其重要性，您需要将这个问题放在 80% 的团队负责人的“次要位置”。

**不该做什么**
* 从外部聘请专家（除非你现在真的一团糟）
* 几个月后放弃，这是长期的。
*一次更改所有项目。
* 开始，直到您拥有可以实现这一目标的三个核心。
* 让架构部门变得比它必须的更大
* 让人们认为架构部门将解决产品团队的问题
* 让任何产品看起来都在“等待新架构”
* 让架构部门“定义所有”或范围蔓延
* 强制所有产品进入架构，有些可能不适合（例如，不在同一个国家开发）

**做什么：**
* 从第一个问题得到充分的理由，让高级管理层接受并要求产品团队报告进度
* 逐步改变产品与架构图
的一致性 * 致力于最有希望或低风险的一致性首先是产品线
* 设置指标，以便您可以展示增值（请参阅第一组问题的理由）
* 为所有产品制定路线图以实现融合或不融合。
* 思考核心架构提供了什么以及谁维护其
产品 * 允许产品团队在核心规范、代码和维护方面为核心做出贡献
* 为新手和现有团队设置如何使用架构团队的工作的培训

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T10:36:58.500

仅建筑就有可能把人变成宇航员/僵尸。因此，即使这是基本的原型设计，他们肯定也应该进行一些编码。事实上，他们原型的成功必须是明确的审查因素。

他们应该按月发布报告/经常发布跟踪他们工作的博客，以便组织中的其他人可以学习。

应该有学术目标，例如熟悉某些平台/工具/书籍和设计理念。

如果他们愿意，应该给他们时间在现有项目中追求新工具/项目/职责。

他们将有责任对关键模块进行至少 3-4 次代码审查，并提出代码风格指南。

他们有责任至少审查关键模块的低级设计。

作为个人或团队，他们应该有空闲时间来构建他们认为可能有用的东西。

如果他们愿意，他们应该可以选择放弃建筑并返回正常工作，而不会涉及任何处罚。

他们应该有关于组织中运行的所有项目发生的事情的信息。至少应该密切关注一个项目，以便他们可以将其他地方发生的事情告知自己的同行。这可能是他们执行代码审查等的项目。

他们应该有一个技术含量高的人作为他们的经理。

一旦架构师非常熟悉其中一个项目，他们就应该在项目之间切换，并允许他们在处理原始项目时遵循他们所遵循的任何原型。

每 1 年至少有一个真正的目标（比如将项目中的所有共性整合到一个库中）

投入时间和培训，以确保建筑师不会受到自我约束并以相当专业的方式行事。肯定也需要解决冲突和其他软技能培训以及技术会议和培训的预算。

# sql - 如何在一列中返回多个值（T-SQL）？

> ID：122942
> 
> 赞同：51
> 
> 时间：2008-09-23T18:43:43.573
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我有一个表`UserAliases`（`UserId, Alias`），每个用户有多个别名。我需要查询它并返回给定用户的所有别名，诀窍是将它们全部返回在一列中。

例子：

```
UserId/Alias  
1/MrX  
1/MrY  
1/MrA  
2/Abc  
2/Xyz 
```

我想要以下格式的查询结果：

```
UserId/Alias  
1/ MrX, MrY, MrA  
2/ Abc, Xyz 
```

谢谢你。

我正在使用 SQL Server 2005。

ps 实际的 T-SQL 查询将不胜感激:)

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-09-23T18:56:29.237

您可以将函数与 COALESCE 一起使用。

```
CREATE FUNCTION [dbo].[GetAliasesById]
(
    @userID int
)
RETURNS varchar(max)
AS
BEGIN
    declare @output varchar(max)
    select @output = COALESCE(@output + ', ', '') + alias
    from UserAliases
    where userid = @userID

    return @output
END

GO

SELECT UserID, dbo.GetAliasesByID(UserID)
FROM UserAliases
GROUP BY UserID

GO 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-07T03:40:50.627

嗯......我看到一个答案已经被接受......但我认为你应该看到另一个解决方案：

```
/* EXAMPLE */
DECLARE @UserAliases TABLE(UserId INT , Alias VARCHAR(10))
INSERT INTO @UserAliases (UserId,Alias) SELECT 1,'MrX'
     UNION ALL SELECT 1,'MrY' UNION ALL SELECT 1,'MrA'
     UNION ALL SELECT 2,'Abc' UNION ALL SELECT 2,'Xyz'

/* QUERY */
;WITH tmp AS ( SELECT DISTINCT UserId FROM @UserAliases )
SELECT 
    LEFT(tmp.UserId, 10) +
    '/ ' +
    STUFF(
            (   SELECT ', '+Alias 
                FROM @UserAliases 
                WHERE UserId = tmp.UserId 
                FOR XML PATH('') 
            ) 
            , 1, 2, ''
        ) AS [UserId/Alias]
FROM tmp

/* -- OUTPUT
  UserId/Alias
  1/ MrX, MrY, MrA
  2/ Abc, Xyz    
*/ 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T05:32:37.100

```
DECLARE @Str varchar(500)

SELECT @Str=COALESCE(@Str,'') + CAST(ID as varchar(10)) + ','
FROM dbo.fcUser

SELECT @Str 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:46:21.913

您可以使用游标遍历行并附加到临时表中的字段，也可以使用 COALESCE 函数连接字段。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T18:48:41.097

对不起，第一次读错了问题。你可以这样做：

```
declare @result varchar(max)

--must "initialize" result for this to work
select @result = ''

select @result = @result + alias
FROM aliases
WHERE username='Bob' 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-23T18:45:28.233

group_concat() 听起来像你在找什么。

[http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat](http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html#function_group-concat)

因为您使用的是 mssql，所以我刚刚搜索了“group_concat mssql”并找到了一堆重新创建 group_concat 功能的命中。这是我发现的热门歌曲之一：

[http://www.stevenmapes.com/index.php?/archives/23-Recreating-MySQL-GROUP_CONCAT-In-MSSQL-Cross-Tab-Query.html](http://www.stevenmapes.com/index.php?/archives/23-Recreating-MySQL-GROUP_CONCAT-In-MSSQL-Cross-Tab-Query.html)

# c# - 组名无效：组名必须以单词字符开头

> ID：122951
> 
> 赞同：3
> 
> 时间：2008-09-23T18:44:51.403
> 
> 标签：c#, regex, exception

当我将 Regex 类与正则表达式一起使用时，我收到以下异常： (?'named a'asdf)

```
System.ArgumentException: parsing \"(?'named a'asdf)\" - Invalid group name: Group names must begin with a word character. 
```

我的正则表达式有什么问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T18:54:41.113

问题是捕获名称中的空格。删除空间，它工作正常。

来自 MSDN 文档：“用于名称的字符串不得包含任何标点符号，并且不能以数字开头。您可以使用单引号代替尖括号；例如，(?'name')。”

使用尖括号 <> 或单引号 '' 来表示组名并不重要。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-28T06:33:27.787

vengafoo 提到的 MSDN 文档的参考在这里： [Regular Expression Grouping Constructs](http://msdn.microsoft.com/en-us/library/bs2twtah.aspx)

> **`(?<name> subexpression)`**
> 将匹配的子表达式捕获为组名或号码名。用于名称的字符串不能包含任何标点符号，并且不能以数字开头。**您可以使用单引号代替尖括号；例如，(?'name')。**

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-23T18:47:44.890

问题是您在命名捕获组名称周围的引号。试试这个字符串： (?<Named>asdf)

# php - 使用 php/MySQL 的定时事件

> ID：122954
> 
> 赞同：4
> 
> 时间：2008-09-23T18:45:12.993
> 
> 标签：php, sql, mysql, events, timing

在经过一定时间后，我需要一种方法来修改表中的值。我目前的方法如下：

*   在表中插入等待期的结束时间
*   当用户加载请求更改值的页面时，检查当前 >= 结束时间
*   如果是，则更改值并删除结束时间字段，如果不是，则不执行任何操作

这将成为该网站的主要功能，因此效率是关键；考虑到这一点，您可能会看到我如何做的问题。每次有人访问需要信息的页面时，都会调用相同的代码块。

任何改进或更好方法的建议将不胜感激，最好是在 php 或 perl 中。

作为对 cron 工作答案的回应：谢谢，如果可能的话，我想做类似的事情，但是主机限制是问题所在。由于这是应用程序的主要部分，因此不能受到限制。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T18:48:13.907

为什么不使用 cron 在幕后更新这些信息呢？这样您就可以卸载每个页面点击的检查，并且实际上可以安排时间以满足您的应用程序的要求。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T19:47:22.640

您的解决方案听起来很合乎逻辑，因为您无权访问 cron。另一种方法是将值存储在文件中，下次加载页面时检查上次修改的时间（filemtime（“checkfile.txt”）），并决定是否需要再次修改。您应该测试这两种方法的性能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T18:48:11.130

您可以使用 cron 作业定期检查数据库中的每个字段并以这种方式进行更新吗？

其中很大一部分是需要更新的频率。许多共享主机限制了 cron 检查的频率，例如不超过每 15 分钟一次，这可能会影响应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T21:16:48.370

您可以在每个页面加载时使用某种触发器。我真的不知道这会如何影响性能，但也许其他人可以提供一些启示。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T21:12:27.977

如果性能真的开始成为问题，（这意味着比你可能意识到的要多得多）你可以使用 memchached 来存储信息......

# algorithm - 强大而快速的校验和算法？

> ID：122982
> 
> 赞同：37
> 
> 时间：2008-09-23T18:48:56.883
> 
> 标签：algorithm, image, checksum

在以下用例中，您可以推荐哪种校验和算法？

我想生成小型 JPEG 文件（每个约 8 kB）的校验和，以检查内容是否更改。不幸的是，使用文件系统的*修改日期*不是一种选择。
校验和**不需要**在密码学上很强大，但它应该能够可靠地指示任何大小的变化。

第二个标准是**速度**，因为它应该可以每秒处理至少*数百*张图像（在现代 CPU 上）。

计算将在具有多个客户端的服务器上完成。客户端通过千兆 TCP 将图像发送到服务器。所以**没有磁盘 I/O**作为瓶颈。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-23T18:55:59.753

如果你有很多小文件，你的瓶颈将是文件 I/O，可能不是校验和算法。

[可以在此处](http://en.wikipedia.org/wiki/List_of_hash_functions)找到哈希函数列表（可以将其视为校验和）。

您是否有任何理由不能使用文件系统的修改日期来确定文件是否已更改？那可能会更快。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-23T18:59:54.470

有很多快速 CRC 算法可以解决问题： [http ://www.google.com/search?hl=en&q=fast+crc&aq=f&oq=](http://www.google.com/search?hl=en&q=fast+crc&aq=f&oq=)

**编辑：**为什么仇恨？正如其他答案所证明的那样，CRC是完全合适的。谷歌搜索也是合适的，因为没有指定语言。这是一个老问题，已经解决了很多次，不可能有一个明确的答案。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-02-26T12:39:37.973

如果您通过网络接收文件，您可以在接收文件时计算校验和。这将确保您在数据在内存中时计算校验和。因此，您不必将它们从磁盘加载到内存中。

我相信如果你应用这种方法，你会在你的系统上看到几乎为零的开销。

这是我在嵌入式系统上使用的例程，它对固件和其他东西进行校验和控制。

```
static const uint32_t crctab[] = {
    0x0,
    0x04c11db7, 0x09823b6e, 0x0d4326d9, 0x130476dc, 0x17c56b6b,
    0x1a864db2, 0x1e475005, 0x2608edb8, 0x22c9f00f, 0x2f8ad6d6,
    0x2b4bcb61, 0x350c9b64, 0x31cd86d3, 0x3c8ea00a, 0x384fbdbd,
    0x4c11db70, 0x48d0c6c7, 0x4593e01e, 0x4152fda9, 0x5f15adac,
    0x5bd4b01b, 0x569796c2, 0x52568b75, 0x6a1936c8, 0x6ed82b7f,
    0x639b0da6, 0x675a1011, 0x791d4014, 0x7ddc5da3, 0x709f7b7a,
    0x745e66cd, 0x9823b6e0, 0x9ce2ab57, 0x91a18d8e, 0x95609039,
    0x8b27c03c, 0x8fe6dd8b, 0x82a5fb52, 0x8664e6e5, 0xbe2b5b58,
    0xbaea46ef, 0xb7a96036, 0xb3687d81, 0xad2f2d84, 0xa9ee3033,
    0xa4ad16ea, 0xa06c0b5d, 0xd4326d90, 0xd0f37027, 0xddb056fe,
    0xd9714b49, 0xc7361b4c, 0xc3f706fb, 0xceb42022, 0xca753d95,
    0xf23a8028, 0xf6fb9d9f, 0xfbb8bb46, 0xff79a6f1, 0xe13ef6f4,
    0xe5ffeb43, 0xe8bccd9a, 0xec7dd02d, 0x34867077, 0x30476dc0,
    0x3d044b19, 0x39c556ae, 0x278206ab, 0x23431b1c, 0x2e003dc5,
    0x2ac12072, 0x128e9dcf, 0x164f8078, 0x1b0ca6a1, 0x1fcdbb16,
    0x018aeb13, 0x054bf6a4, 0x0808d07d, 0x0cc9cdca, 0x7897ab07,
    0x7c56b6b0, 0x71159069, 0x75d48dde, 0x6b93dddb, 0x6f52c06c,
    0x6211e6b5, 0x66d0fb02, 0x5e9f46bf, 0x5a5e5b08, 0x571d7dd1,
    0x53dc6066, 0x4d9b3063, 0x495a2dd4, 0x44190b0d, 0x40d816ba,
    0xaca5c697, 0xa864db20, 0xa527fdf9, 0xa1e6e04e, 0xbfa1b04b,
    0xbb60adfc, 0xb6238b25, 0xb2e29692, 0x8aad2b2f, 0x8e6c3698,
    0x832f1041, 0x87ee0df6, 0x99a95df3, 0x9d684044, 0x902b669d,
    0x94ea7b2a, 0xe0b41de7, 0xe4750050, 0xe9362689, 0xedf73b3e,
    0xf3b06b3b, 0xf771768c, 0xfa325055, 0xfef34de2, 0xc6bcf05f,
    0xc27dede8, 0xcf3ecb31, 0xcbffd686, 0xd5b88683, 0xd1799b34,
    0xdc3abded, 0xd8fba05a, 0x690ce0ee, 0x6dcdfd59, 0x608edb80,
    0x644fc637, 0x7a089632, 0x7ec98b85, 0x738aad5c, 0x774bb0eb,
    0x4f040d56, 0x4bc510e1, 0x46863638, 0x42472b8f, 0x5c007b8a,
    0x58c1663d, 0x558240e4, 0x51435d53, 0x251d3b9e, 0x21dc2629,
    0x2c9f00f0, 0x285e1d47, 0x36194d42, 0x32d850f5, 0x3f9b762c,
    0x3b5a6b9b, 0x0315d626, 0x07d4cb91, 0x0a97ed48, 0x0e56f0ff,
    0x1011a0fa, 0x14d0bd4d, 0x19939b94, 0x1d528623, 0xf12f560e,
    0xf5ee4bb9, 0xf8ad6d60, 0xfc6c70d7, 0xe22b20d2, 0xe6ea3d65,
    0xeba91bbc, 0xef68060b, 0xd727bbb6, 0xd3e6a601, 0xdea580d8,
    0xda649d6f, 0xc423cd6a, 0xc0e2d0dd, 0xcda1f604, 0xc960ebb3,
    0xbd3e8d7e, 0xb9ff90c9, 0xb4bcb610, 0xb07daba7, 0xae3afba2,
    0xaafbe615, 0xa7b8c0cc, 0xa379dd7b, 0x9b3660c6, 0x9ff77d71,
    0x92b45ba8, 0x9675461f, 0x8832161a, 0x8cf30bad, 0x81b02d74,
    0x857130c3, 0x5d8a9099, 0x594b8d2e, 0x5408abf7, 0x50c9b640,
    0x4e8ee645, 0x4a4ffbf2, 0x470cdd2b, 0x43cdc09c, 0x7b827d21,
    0x7f436096, 0x7200464f, 0x76c15bf8, 0x68860bfd, 0x6c47164a,
    0x61043093, 0x65c52d24, 0x119b4be9, 0x155a565e, 0x18197087,
    0x1cd86d30, 0x029f3d35, 0x065e2082, 0x0b1d065b, 0x0fdc1bec,
    0x3793a651, 0x3352bbe6, 0x3e119d3f, 0x3ad08088, 0x2497d08d,
    0x2056cd3a, 0x2d15ebe3, 0x29d4f654, 0xc5a92679, 0xc1683bce,
    0xcc2b1d17, 0xc8ea00a0, 0xd6ad50a5, 0xd26c4d12, 0xdf2f6bcb,
    0xdbee767c, 0xe3a1cbc1, 0xe760d676, 0xea23f0af, 0xeee2ed18,
    0xf0a5bd1d, 0xf464a0aa, 0xf9278673, 0xfde69bc4, 0x89b8fd09,
    0x8d79e0be, 0x803ac667, 0x84fbdbd0, 0x9abc8bd5, 0x9e7d9662,
    0x933eb0bb, 0x97ffad0c, 0xafb010b1, 0xab710d06, 0xa6322bdf,
    0xa2f33668, 0xbcb4666d, 0xb8757bda, 0xb5365d03, 0xb1f740b4
};

typedef struct crc32ctx
{
    uint32_t crc;
    uint32_t length;
} CRC32Ctx;

#define COMPUTE(var, ch)    (var) = (var) << 8 ^ crctab[(var) >> 24 ^ (ch)]

void crc32_stream_init( CRC32Ctx* ctx )
{
    ctx->crc = 0;
    ctx->length = 0;
}

void crc32_stream_compute_uint32( CRC32Ctx* ctx, uint32_t data )
{
    COMPUTE( ctx->crc, data & 0xFF );
    COMPUTE( ctx->crc, ( data >> 8 ) & 0xFF );
    COMPUTE( ctx->crc, ( data >> 16 ) & 0xFF );
    COMPUTE( ctx->crc, ( data >> 24 ) & 0xFF );
    ctx->length += 4;
}

void crc32_stream_compute_uint8( CRC32Ctx* ctx, uint8_t data )
{
    COMPUTE( ctx->crc, data );
    ctx->length++;
}

void crc32_stream_finilize( CRC32Ctx* ctx )
{
    uint32_t len = ctx->length;
    for( ; len != 0; len >>= 8 )
    {
        COMPUTE( ctx->crc, len & 0xFF );
    }
    ctx->crc = ~ctx->crc;
}

/*** pseudo code ***/
CRC32Ctx crc;
crc32_stream_init(&crc);

while((just_received_buffer_len = received_anything()))
{
    for(int i = 0; i < just_received_buffer_len; i++)
    {
        crc32_stream_compute_uint8(&crc, buf[i]); // assuming buf is uint8_t*
    }
}
crc32_stream_finilize(&crc);
printf("%x", crc.crc); // ta daaa 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-23T18:58:29.217

*   [想到CRC-32](http://en.wikipedia.org/wiki/Cyclic_redundancy_check)主要是因为计算成本低

*   想到任何类型的 I/O 主要是因为这将是此类任务的限制因素；）

*   问题不在于计算校验和，问题在于将图像放入内存以计算校验和。

*   我建议“分阶段”监控：

    *   第 1 阶段：检查文件时间戳的更改，如果您检测到更改，则移交给...
        （在您的情况下不需要，如编辑版本中所述）

    *   第 2 阶段：将图像放入内存并计算校验和

*   当然也很重要：**多线程**：设置一个管道，如果有多个 CPU 内核可用，则可以并行处理多个图像。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-23T18:58:23.757

[CRC](http://en.wikipedia.org/wiki/Cyclic_redundancy_check)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-23T19:06:58.730

zlib 头文件中提供的 adler32 被宣传为比 crc32 快得多，但准确度稍差。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-23T19:14:52.627

CRC32 可能已经足够好，尽管您可能会遇到冲突的可能性*很小*，因为两个版本生成相同的校验和，因此已修改的文件可能看起来像没有被修改过。为了避免这种可能性，我建议使用 MD5，它很容易足够快，并且发生碰撞的机会减少到几乎无限小的程度。

正如其他人所说，对于大量小文件，您真正的性能瓶颈将是 I/O，因此问题正在处理。如果您发布更多详细信息，有人可能还会建议一种整理方式。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-02T03:29:38.367

您最重要的要求是“检查内容是否更改”。

如果最重要的是检测文件中的任何更改，MD-5、SHA-1 甚至 SHA-256 应该是您的选择。

鉴于您指出校验和在密码学上不好，我会出于三个原因推荐 CRC-32。CRC-32 在 8K 文件上提供了良好的汉明距离。CRC-32 的计算速度至少比 MD-5 快一个数量级（您的第二个要求）。有时同样重要的是，CRC-32 只需要 32 位来存储要比较的值。MD-5 需要 4 倍的存储空间，SHA-1 需要 5 倍的存储空间。

顺便说一句，任何技术都将通过在计算哈希时预先添加文件长度来加强。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-30T17:42:14.123

根据 Luke 所指的 Wiki[页面](http://en.wikipedia.org/wiki/List_of_hash_functions)，MD5 实际上比 CRC32 快！

我自己尝试过在 Windows Vista 上使用 Python 2.6，并得到了相同的结果。

以下是一些结果：

crc32：162.481544276 MBps md5：224.489791549 MBps

crc32：168.332996575 MBps md5：226.089336532 MBps

crc32：155.851515828 MBps md5：194.943289532 MBps

我也在考虑同样的问题，我很想使用 Rsync 的 Adler-32 变体来检测文件差异。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-18T20:07:10.560

只是上面的一个附言；jpeg 使用有损压缩，压缩程度可能取决于用于创建 jpeg 的程序、系统上的调色板和/或位深度、显示 Gamma、图形卡和用户设置的压缩级别/颜色设置。因此，在字节级别比较构建在不同计算机/平台上或使用不同软件的 jpeg 将非常困难。

# sql - 如何确定每个来源中的记录是否代表同一个人

> ID：122990
> 
> 赞同：3
> 
> 时间：2008-09-23T18:51:21.933
> 
> 标签：sql, algorithm, etl, textmatching, record-linkage

我有几个包含个人数据的表格来源，如下所示：

```
SOURCE 1
ID, FIRST_NAME, LAST_NAME, FIELD1, ...
1, jhon, gates ...

SOURCE 2
ID, FIRST_NAME, LAST_NAME, ANOTHER_FIELD1, ...
1, jon, gate ...

SOURCE 3
ID, FIRST_NAME, LAST_NAME, ANOTHER_FIELD1, ...
2, jhon, ballmer ... 
```

因此，假设来自来源 1 和 2 的 ID 为 1 的记录是同一个人，我的问题**是如何确定每个来源中的记录是否代表同一个人**。此外，确保并非所有记录都存在于所有来源中。所有的名字，主要是用西班牙语写的。

在这种情况下，需要放宽精确匹配，因为我们假设*数据源没有经过国家*官方身份验证局的严格检查。此外，我们需要假设*拼写错误是常见*的，因为收集数据的过程的性质。更重要的是，每个来源的记录数量约为 2 或 3 百万……

我们的团队曾考虑过这样的事情：首先，强制在 ID NUMBER 和 NAMES 等选定字段中进行精确匹配，以了解问题的难度。第二，放宽匹配条件，数一数还能匹配多少条记录，但是问题来了：**如何放宽匹配条件，既不会产生太大的噪音，又不会限制太多？**

什么工具可以更有效地处理这个问题？例如，您是否知道某些数据库引擎中的某些特定扩展以支持这种匹配？您是否知道诸如[soundex 之](http://en.wikipedia.org/wiki/Soundex)类的巧妙算法来处理这种近似匹配，但对于西班牙语文本？

任何帮助，将不胜感激！

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T19:00:10.087

这听起来像是[客户数据集成](http://en.wikipedia.org/wiki/Customer_Data_Integration)问题。搜索该术语，您可能会找到更多信息。此外，在[The Data Warehousing Institude](http://www.tdwi.org/)中四处逛逛，您也可能会在那里找到一些答案。

**编辑：**此外，[这里](http://www.javalobby.org/java/forums/t16936.html)有一篇文章可能会让您对西班牙语语音匹配感兴趣。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T19:04:12.683

我以前也做过类似的事情，我所做的是对名字使用[双变](http://en.wikipedia.org/wiki/Double_Metaphone)音位语音搜索。

不过，在比较名称之前，我尝试通过在我创建的昵称表中查找名称来规范化任何名称/昵称差异。（我用我在网上找到的人口普查数据填充了表格）所以叫 Bob 的人变成了 Robert，Alex 变成了 Alexander，Bill 变成了 William，等等。

**编辑**：Double Metaphone 专门设计为比 Soundex 更好，并且可以使用英语以外的其他语言。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T20:20:35.900

问题的关键是计算每对条目之间的一个或多个距离度量，然后当其中一个距离小于某个可接受的阈值时认为它们是相同的。关键是设置分析，然后改变可接受的距离，直到达到您认为是假阳性和假阴性之间的最佳权衡。

一种距离测量可以是语音。您可能会考虑的另一个是[Levenshtein 或](http://en.wikipedia.org/wiki/Levenshtein_distance)整体之间的编辑距离，它会尝试测量拼写错误。

如果您对应该拥有多少人有一个合理的想法，那么您的目标就是找到您获得正确人数的最佳位置。让你的匹配太模糊，你就会太少。把它限制起来，你会有太多的。

如果您大致知道一个人应该拥有多少条目，那么您可以将其用作衡量您何时接近的指标。或者，您可以将记录数除以每个人的平均记录数，并获得您要拍摄的粗略人数。

如果您没有任何数字可供使用，那么您就只能从分析中挑选出多组记录并手动检查它们是否看起来像同一个人。所以这是猜测和检查。

我希望这会有所帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T18:53:09.153

SSIS，尝试使用模糊查找转换

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T19:04:39.107

只是为了添加一些细节来解决这个问题，我发现这个模块适用于 Postgresql 8.3

*   [模糊字符串匹配](http://www.postgresql.org/docs/8.3/static/fuzzystrmatch.html)
*   [八卦](http://www.postgresql.org/docs/8.3/static/pgtrgm.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-26T12:53:48.590

您可能会尝试通过将名称与字典进行比较来规范化这些名称。
这将允许您发现一些常见的拼写错误并更正它们。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-11T10:18:06.323

听起来你有一个[记录链接](http://www.answers.com/topic/record-linkage)问题。您可以使用链接中的参考资料。*********````***