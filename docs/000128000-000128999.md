# StackOverflow 问答 000128000-000128999

# java - 使用 HashMap 时，值和键在迭代时是否保证顺序相同？

> ID：128008
> 
> 赞同：9
> 
> 时间：2008-09-24T15:53:45.970
> 
> 标签：java, collections, hashmap

当我遍历值或键时，它们会关联吗？第二个键会映射到第二个值吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T15:58:14.960

不，不一定。为此，您应该真正使用 entrySet().iterator()。使用此迭代器，您将遍历 Map 中的所有 Map.Entry 对象，并且可以访问每个键和关联的值。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T16:07:13.583

使用@Cuchullain 提到的entrySet：

```
Map<String, String> map = new HashMap<String, String>();

// populate hashmap

for (Map.Entry<String, String> entry : map.entrySet()) {
  String key = entry.getKey();
  String value = entry.getValue();
  // your code here
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-24T16:21:57.493

您想使用这个[LinkedHashMap](http://java.sun.com/javase/6/docs/api/java/util/LinkedHashMap.html)来进行可预测的迭代顺序

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-11-09T15:19:21.123

```
public class Test {
 public static void main(String[] args) {
  HashMap <String,String> hashmap = new HashMap<String,String>();
  hashmap.put("one", "1");
  hashmap.put("two", "2");
  hashmap.put("three", "3");
  hashmap.put("four", "4");
  hashmap.put("five", "5");
  hashmap.put("six", "6");

  Iterator <String> keyIterator   = hashmap.keySet().iterator();
  Iterator <String> valueIterator = hashmap.values().iterator();

  while(keyIterator.hasNext()) {
   System.out.println("key: "+keyIterator.next());
  }

  while(valueIterator.hasNext()) {
   System.out.println("value: "+valueIterator.next());
  }
 }
}

key: two
key: five
key: one
key: three
key: four
key: six
value: 2
value: 5
value: 1
value: 3
value: 4
value: 6 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T16:07:06.093

values() 和 keySet() 都委托给 entrySet() 迭代器，因此它们将以相同的顺序返回。但就像 Alex 所说，直接使用 entrySet() 迭代器要好得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-03T12:37:07.603

我同意 pmac72。不要假设您会从无序集合中获得有序值或键。如果它不时起作用，那只是纯粹的危险。如果要保留订单，请使用 LinkedHashMap 或 TreeMap 或公共集合 OrderedMap。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T15:56:43.827

这个问题起初让我感到困惑，但@Matt 为我解决了这个问题。

考虑使用 entrySet() 方法，该方法返回一个集合，其中包含 Map 上的键值对。

```
Map<Integer, Integer> a = new HashMap<Integer, Integer>(2);
a.put(1, 2);
a.put(2, 3);
for (Map.Entry<Integer, Integer> entry : a.entrySet()) {
    System.out.println(entry.getKey() + " => " + entry.getValue());
} 
```

这输出：

```
1 => 2
2 => 3
3 => 3 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T18:07:10.830

我第二个@basszero。尽管

```
for (Map.Entry<Integer, Integer> entry : a.entrySet()) 
```

会起作用，我发现使用自动执行此操作的数据结构更好。现在，您可以“正常”迭代

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T18:41:36.177

HashMap的keySet方法返回一个Set，不保证顺序。
HashMap 的 values() 方法返回一个 Collection，它不保证顺序。

也就是说，问题是“它们是否会相关”，所以从技术上讲，答案是可能的，但不要依赖它。

# php - 在 CakePHP 中向 session-flash() 输出添加解除控制

> ID：128011
> 
> 赞同：0
> 
> 时间：2008-09-24T15:54:11.633
> 
> 标签：php, cakephp, cakephp-1.2

在一个`CakePHP 1.2`应用程序中，我正在使用

```
<?php $session->flash();?> 
```

输出诸如“记录已编辑”之类的消息。它工作得很好。

但是，我想添加一个名为“Dismiss”的链接，它将淡出消息。我知道如何构造链接，但我不知道如何插入到flas 消息的输出中。

flash 消息将自身包装在一个`DIV tag`. 我想将我的关闭代码插入到该 div 中，但我不知道如何。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T15:58:22.607

想通了：在您的布局文件夹中创建一个新布局：

```
layouts/message.ctp 
```

在该布局中，包括输出内容的调用：

```
<?php echo $content_for_layout; ?> 
```

然后在设置 flash 消息时，指定要使用的布局：

```
$this->Session->setFlash('Your record has been created! Wicked!','message'); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T16:08:35.077

您想使用[setflash](http://api.cakephp.org/class_session_component.html)功能。如果您为 setflash 传递一个空字符串 $default 它不会将您的消息包装在 div 中，而是按原样存储。这样您就可以显示您想要的任何标记，或者正如 Justin 发布的那样，您可以使用另一个视图页面来显示您的消息，这样您就不会混合视图和控制器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-14T12:04:09.280

您可以使用 jQuery 实现此目的：

```
$(document).ready(function() {

    $("#flashMessage").each(function() {
        $close = $("<span class='close'>Close</span>");
        $close.click(function () {
            $(this).parent().hide("slow");
        });
        $(this).append($close);
    });

}); 
```

你需要用一点 CSS 来美化它，但我相信你明白了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T14:43:38.587

默认的做法是在 /app/views/layouts 中创建一个 flash.ctp。这将覆盖您可以在 /cake/libs/view/layouts 中找到的默认 flash.ctp。所以你不需要使用额外的参数。

顺便说一句：这适用于所有 CakePHP 标准视图和布局。

# iphone - 带有子视图的可变 UITableCellView 高度

> ID：128012
> 
> 赞同：8
> 
> 时间：2008-09-24T15:54:26.390
> 
> 标签：iphone, cocoa-touch, uitableview, user-interface

我想创建一个具有不同行高的 UITableView，我试图通过在 UITableViewCells 中创建 UILabel 来实现这一点。

到目前为止，这是我的代码：

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    static NSString *MyIdentifier = @"EntryCell";
    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:MyIdentifier];
    if (cell == nil) {
        cell = [[[UITableViewCell alloc] initWithFrame:CGRectZero reuseIdentifier:MyIdentifier] autorelease];
    }

    UILabel *textView = [[UILabel alloc] initWithFrame:CGRectMake(10, 0, 300, 40)];
    textView.numberOfLines = 0;
    textView.text = [entries objectAtIndex:[indexPath row]];
    [cell.contentView addSubview:textView];
    [textView release];

    return cell;
} 
```

这给了我每个单元格 2 行文本。但是，每个“条目”都有不同的行数，我希望 UITableViewCells 自动调整大小，根据需要包装文本，而不更改字体大小。

`[textView sizeToFit]`和/或`[cell sizeToFit]`似乎不起作用。

这是我希望 UITableView 的外观：

```
----------------
Lorem ipsum
----------------
Lorem ipsum
Lorem ipsum
----------------
Lorem ipsum
Lorem ipsum
Lorem ipsum
----------------
Lorem ipsum
----------------
Lorem ipsum
Lorem ipsum
---------------- 
```

有谁知道如何正确地做到这一点？

谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-24T16:53:06.297

UITableViewDelegate 定义了一个可选方法 heightForRowAtIndexPath，它将帮助您入门。然后您需要使用 sizeWithFont。

这里有一些关于你的确切问题的讨论：

[http://www.v2ex.com/2008/09/18/how-to-make-uitableviewcell-have-variable-height/](http://www.v2ex.com/2008/09/18/how-to-make-uitableviewcell-have-variable-height/)

[此线程](https://stackoverflow.com/questions/50467/how-do-i-size-a-uitextview-to-its-content)中还讨论了文本大小

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-01T19:07:54.877

这段代码对我有用。不知道它是否完美，但有效。

```
- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{

    if(indexPath.row<[notesModel numberOfNotes]){
        NSString *cellText = [@"Your text..."];
        UIFont *cellFont = [UIFont fontWithName:@"Helvetica" size:12.0];
        CGSize constraintSize = CGSizeMake([UIScreen mainScreen].bounds.size.width - 100, MAXFLOAT);
        CGSize labelSize = [cellText sizeWithFont:cellFont constrainedToSize:constraintSize lineBreakMode:UILineBreakModeWordWrap];

        return labelSize.height + 20;
    }
    else {
        return 20;
    }
} 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-12-10T21:43:04.690

textView.numberOfLines = 2？numberOflines 设置最大行数，所以也许 2 会为你工作？

# cocoa - 使 OSX 应用程序在未聚焦时响应第一次鼠标单击

> ID：128015
> 
> 赞同：13
> 
> 时间：2008-09-24T15:55:06.403
> 
> 标签：cocoa, macos, click-through

正常的 OSX 应用程序在未聚焦时会首先单击鼠标以首先聚焦应用程序。然后应用程序处理未来的点击。iTunes 播放/暂停按钮和 Finder 的行为不同，即使没有聚焦，第一次点击也会起作用。我正在寻找一种方法来强制现有应用程序（远程桌面连接.app）在第一次点击时采取行动，而不仅仅是关注。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T19:01:09.703

检查 NSView 的acceptsFirstMouse，它可能就是你要找的。

接受FirstMouse：如果应该向接收者发送mouseDown：初始鼠标按下事件的消息，则由子类覆盖以返回YES，否则返回NO。

*   (BOOL)acceptsFirstMouse:(NSEvent *)theEvent

参数 theEvent 初始鼠标按下事件，它必须在其窗口中的接收器上方。

讨论 接收者可以无条件地返回一个值，也可以使用事件的位置来确定它是否需要该事件。默认实现忽略 theEvent 并返回 NO。

在子类中重写此方法以允许实例响应点击。这允许用户单击非活动窗口中的视图，只需单击即可激活视图，而不是先单击以使窗口处于活动状态，然后再单击视图。大多数视图对象拒绝点击尝试，因此事件只是激活窗口。然而，许多控件对象（例如 NSButton 和 NSSlider 的实例）确实接受它们，因此用户可以立即操作控件而无需释放鼠标按钮。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T16:04:48.330

在未聚焦时响应第一次鼠标单击称为“单击通过”。它的价值也引起了激烈的争论，例如[这里](http://danielshusta.com/post/39545060/click-through)和[这里](http://daringfireball.net/2003/05/much_ado_about_clickthrough)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-02-07T01:03:00.303

// 假设你有 1 个一直挂着的视图控制器。超越加载视图。注意这在优胜美地之前是行不通的。

```
- (void)loadView {
    NSLog(@"loadView");

    self.view = [[NSView alloc] initWithFrame:
                 [[app.window contentView] frame]];
    [self.view setAutoresizingMask:NSViewWidthSizable | NSViewHeightSizable];

    int opts = (NSTrackingMouseEnteredAndExited | NSTrackingActiveAlways);
    trackingArea0 = [[NSTrackingArea alloc] initWithRect:self.view.bounds
                                                 options:opts
                                                   owner:self
                                                userInfo:nil];
    [self.view addTrackingArea:trackingArea0];

}
- (void)mouseEntered:(NSEvent *)theEvent {
    NSLog(@"entered");

        if ([[NSApplication sharedApplication] respondsToSelector:@selector(activateIgnoringOtherApps:)]) {
            [[NSApplication sharedApplication] activateIgnoringOtherApps:YES];
        }

} 
```

# java - Java，Swing：如何设置 JTextField 的最大宽度？

> ID：128016
> 
> 赞同：9
> 
> 时间：2008-09-24T15:55:16.530
> 
> 标签：java, swing, jtextfield

我正在编写一个自定义文件选择组件。在我的 UI 中，首先用户单击一个按钮，该按钮会弹出一个`JFileChooser`; 当它关闭时，所选文件的绝对路径被写入一个`JTextField`.

问题是，绝对路径通常很长，这会导致文本字段放大，使其容器太宽。

我试过这个，但它没有做任何事情，文本字段仍然太宽：

```
fileNameTextField.setMaximumSize(new java.awt.Dimension(450, 2147483647)); 
```

目前，当它为空时，它已经是 400px 长，因为它是`GridBagConstraints`附加的。

我希望它像 HTML 页面中的文本字段一样，具有固定大小并且在输入太长时不会放大。

那么，如何设置 a 的最大尺寸`JTextField`？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-24T16:00:00.840

这可能取决于您的文本字段所在的布局管理器。有些布局管理器会扩展，有些则不会。有些仅在某些情况下扩展，有些则始终。

我假设你在做

```
filedNameTextField = new JTextField(80); // 80 == columns 
```

如果是这样，对于大多数合理的布局，该字段不应该改变大小（至少，它不应该增长）。布局管理器通常在放入`JScrollPane`s 时表现不佳。

以我的经验，试图通过`setMaximumSize`等来控制大小`setPreferredWidth`充其量是不稳定的。Swing 由布局管理器自行决定，您对此无能为力。

话虽如此，我没有遇到您遇到的问题，这使我相信明智地使用布局管理器将解决问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T16:23:00.377

我通过设置文本字段容器的最大宽度来解决这个问题，使用`setMaximumSize`.

根据 davetron 的回答，这是一个脆弱的解决方案，因为布局管理器可能会忽略该属性。就我而言，容器是最顶层的，并且在第一次测试中它起作用了。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T20:01:20.400

不要在文本字段上设置任何大小。而是通过 setColumns 或使用带有 column 参数的构造函数将列大小设置为非零值。

发生的情况是，当列为零时，JTextComponent 报告的首选大小是呈现文本所需的全部空间量。当 columns 设置为非零值时，首选大小是显示许多标准列宽所需的大小。（对于可变间距字体，它通常接近小写“m”的大小）。将列设置为零时，文本字段会请求尽可能多的空间并伸展整个容器。

由于您已经在带有填充的 GridBagLayout 中拥有它，您可能只需将列设置为 1 并让填充根据其他组件或其他适当的低数字将其拉伸。

# javascript - 安全读取查询字符串参数的最佳方法？

> ID：128028
> 
> 赞同：4
> 
> 时间：2008-09-24T15:57:33.497
> 
> 标签：javascript, security, parameters

我们有一个项目可以生成可用于其他各种项目的代码片段。代码的目的是从查询字符串中读取两个参数并将它们分配给 iframe 的“src”属性。

例如，URL 为[http://oursite/Page.aspx?a=1&b=2](http://oursite/Page.aspx?a=1&b=2)的页面将包含 JavaScript 以读取“a”和“b”参数。然后，JavaScript 将根据这些参数设置 iframe 的“src”属性。例如，“<iframe src="http://someothersite/Page.aspx?a=1&b=2" />”

我们目前正在使用使用 Microsoft 的 Anti Cross-Scripting 库来检查参数的服务器端代码执行此操作。但是，一个新的要求来了，我们需要使用 JavaScript，并且不能使用任何第三方 JavaScript 工具（例如 jQuery 或 Prototype）。

我知道的一种方法是在使用参数之前替换参数中的任何“<”、单引号和双引号，但这对我来说似乎不够安全。

其中一个参数始终是“P”，后跟 9 个整数。另一个参数始终是 15 个字母数字字符。（感谢利亚姆建议我说清楚）。

有人对我们有什么建议吗？

非常感谢您的宝贵时间。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T17:55:18.517

不要使用escape和unescape，使用decodeURIComponent。例如

```
function queryParameters(query) {
  var keyValuePairs = query.split(/[&?]/g);
  var params = {};
  for (var i = 0, n = keyValuePairs.length; i < n; ++i) {
    var m = keyValuePairs[i].match(/^([^=]+)(?:=([\s\S]*))?/);
    if (m) {
      var key = decodeURIComponent(m[1]);
      (params[key] || (params[key] = [])).push(decodeURIComponent(m[2]));
    }
  }
  return params;
} 
```

并传入 document.location.search。

就将 < 转换为 < 而言，这不足以确保内容可以安全地注入 HTML 而不允许脚本运行。确保您转义了以下 <、>、& 和 "。

它不能保证参数没有被欺骗。如果您需要验证您的一台服务器是否生成了 URL，请搜索 URL 签名。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T16:00:40.137

我猜使用白名单方法会更好。避免只删除“坏”的东西。去掉任何你认为“安全”的东西。

此外，我强烈建议对参数进行 HTMLEncode。应该有很多 Javascript 函数可以做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T16:05:00.717

您可以使用 javascript 的 escape() 和 unescape() 函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T16:25:54.817

你应该做的几件事：

*   根据类型、格式、范围等，将您接受的值严格列入白名单
*   如果您的白名单不能非常严格，则将某些字符显式列入黑名单（即使这通常是可以绕过的）。
*   在输出之前对值进行编码，如果您使用的是 Anti-XSS，您已经知道简单的 HtmlEncode 是不够的
*   通过 DOM 设置 src 属性 - 而*不是*通过生成 HTML 片段
*   *仅*将动态值用作查询字符串参数，而不用于任意站点；即硬编码服务器名称、目标页面等。
*   您的网站是否使用 SSL？如果是这样，使用框架可能会导致与 SSL UI 不一致...
*   通常使用命名帧，可以允许帧欺骗；如果在安全站点上，这可能是相关的攻击媒介（用于网络钓鱼等）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T17:56:27.580

您可以使用正则表达式来验证您有一个 P 后跟 9 个整数以及您有 15 个字母数字值。我认为我在 RegEx 办公桌上的那本书有一些 JavaScript 示例可以帮助你。

将字符集限制为仅 ASCII 值会有所帮助，并遵循上述所有建议（白名单、通过 DOM 设置 src 等）

# javascript - 为什么要使用 Flex？

> ID：128034
> 
> 赞同：14
> 
> 时间：2008-09-24T15:58:23.057
> 
> 标签：javascript, apache-flex

在最近的一次谈话中，我提到我正在将 JavaScript 用于 Web 应用程序。该评论引发了回应：“您应该改用 Flex。它会缩短您的开发时间，而且 JavaScript 很难调试和维护。您需要使用正确的工具来完成正确的工作。” 现在，我对 Flex 的了解并不多，但我个人并不觉得 JavaScript 很难调试或维护，尤其是在使用框架的情况下。JavaScript 也是目前最常用的语言之一，因此在这方面它似乎也是一个更好的选择。然而，他的回答激起了我的兴趣。对于第三方开发人员可以为其构建附加组件的可分发 Web 应用程序，Flex 是否是一个不错的选择？与 JavaScript 框架相比，使用它有什么优势？有哪些缺点？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T16:03:31.953

我最近开始开发 Flex 应用程序，我个人觉得它是一个令人耳目一新的 Web 框架。

您将获得一个完全在客户端运行的有状态应用程序。您不必担心使用 JavaScript 所做的跨浏览器可移植性，并且您会得到一些非常简洁的东西，例如效果、图形和丰富的用户界面组件。

Flex 还使与 Web 服务的通信变得容易，并且通过 ECMA 进行的 XML 解析非常强大和简单。

我很高兴我做出了改变。至于它有多受欢迎......我不太确定，但我相当肯定开发人员基础正在迅速扩大。

我能想到的唯一真正的缺点是 Flash 播放器的要求，但我会说假设大多数浏览器支持 Flash 播放器是非常安全的；甚至支持 Linux 中的 konquerer；比 Silverlight 运行时更重要（我从不打算安装）

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-25T11:29:52.447

这是我的经验：您确实需要分别考虑两件事 - 开发和最终用户体验。Flex 在第一个领域大放异彩：

*   ActionScript 是 Java 和 JavaScript 的完美结合，因此您会获得一种熟悉的语言，并对 OOP 提供强大的支持
*   调试比在 JavaScript 中实现的要容易得多
*   Flex 框架是面向组件和事件驱动的，有助于创建丰富的用户界面（HTML 并不是真正为支持应用程序 UI 场景而创建的）

另一方面，与 AJAX 应用程序相比，运行 Flex 应用程序时的最终用户体验更差。首先，您需要安装 Flash Player，但这对于当今的大多数计算机来说可能不是问题。更大的问题在于可用性 - Flash Player 处理所有 UI 交互（而不是浏览器），因此密码管理器不起作用，文本字段不记得以前的条目，Ctrl+T 和中键不起作用，文本搜索不工作等等等等。

我的建议是 - 如果您正在开发*一个应用程序*（丰富的 UI，与 Web 的其余部分相对分离），请选择 Flex，因为它可以节省您的时间和金钱，并通过提供更丰富的功能和更短的时间间隔让您的用户更快乐新版本。另一方面，如果您的应用程序需要与 Web 紧密集成，并且您希望您的用户能够使用其浏览器的功能，请使用 AJAX。

很好的例子是 Google Docs vs Buzzword。Buzzword 的功能要丰富得多（例如，文本可以从两侧围绕图像流动，这是您在 DHTML 中永远无法实现的）但 Google 仍然决定使用 AJAX 版本，因为它们是“网络公司”。以一种或另一种方式做这件事没有对错之分，它只是不同，重要的是要考虑你的最终用户是谁。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-24T17:05:44.487

在大多数情况下，我会推动您使用标准的 Web 开发技术。Javascript 不再是一个巨大的挑战，使用 jQuery/Prototype 等优秀的库进行调试或维护以消除一些浏览器的不一致性，并使用 Firebug 和 MS 脚本调试器等工具来帮助调试。

在某些情况下，Flash 是更好的选择，但仅限于您制作复杂动画的情况。而且，如果您愿意付出努力，大多数动画都可以在不借助 Flash 的情况下实现。[几个](http://www.hudsonstreetservices.com/)[例子](http://www.hudsonstreetservices.com/hudsonstreet/services/index.asp)... _ _

**Flash 内容不像其他内容那样易于访问。**
这不仅会影响没有闪光灯的人，还会影响搜索引擎蜘蛛。现在可能有一些技巧可以帮助解决这个问题，但我认为大多数 Flash 内容永远不会被谷歌索引。

**Flash 破坏了 Web UI。**
例如：

*   如果我在链接上单击鼠标滚轮，该链接将在后台选项卡中打开。在 Flash 应用程序中，无法模拟这种行为。
*   如果我在浏览器中选择文本并右键单击，我会得到浏览器提供的选项，其中包括“在 Google 上搜索此文本”之类的内容。在 Flash 应用程序中，这些选项不再存在。
*   如果我右键单击链接或图像，我会得到一组不同的选项，这些选项在 Flash 应用程序中不可用。这对于不“精通闪存”的用户来说可能非常令人沮丧。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T16:09:36.137

GWT 允许您在大多数情况下执行与 Flex 相同的工作，并处理所有浏览器兼容性问题，并允许您使用自己喜欢的 IDE 在 Java 中进行编码/调试。

所有这些都无需学习一门新语言（或为您需要做任何实际事情的 flex IDE 支付 Adob​​e $$$）。

Flex 有一些比 GWT 开箱即用的更漂亮的 UI 小部件，但是您可以使用大量的 3rd 方小部件（例如 GWT-EXT-JS）——或者，您可以将现有的最喜欢的 JS 小部件与 GWT 一起使用。

如果您还没有，请查看：[http ://code.google.com/webtoolkit/](http://code.google.com/webtoolkit/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T16:11:45.740

我不能确定是我自己还是其他人发表了这种说法，但我肯定会说“为工作使用正确的工具”。

Flex 背后有一个庞大的社区，并且受到 Adob​​e 平台宣传团队的大力宣传。现在，就替换 JavaScript 而言，这听起来像是一个非常广泛的讨论点。Flex*不是*JavaScript 的替代品。然而，它做了什么，它做得很好。即3D、绘图和数据渲染，无论是图表还是表格形式。Flex 背后还拥有 ActionScript 3 的强大功能，它允许您与 MXML 前端组件合作完成 Flash 所做的大部分工作，而无需触及时间线或关键帧。

在某种程度上，Flex 是 Fl​​ash 和富 Internet 应用程序开发的 .NET。它使用相同的数据源概念和以组件为中心的设计结构，使其易于快速开发。

真正的问题是，你想达到什么目的？最终目标是什么？

至于调试点，Flex 在 Flex Builder IDE 中有一个真正的调试器和分析器。不幸的是，由于现代浏览器中 JavaScript 引擎的性质，JavaScript 在浏览器之间具有不同的语法和执行。Flex，因为它本质上是 Flash，由于使用了 Flash 插件，所以在所有浏览器中使用相同的渲染引擎。

希望能解决一些问题。:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T16:53:58.790

Flex 有很多额外的开销：

*   新语言
*   客户端必须安装闪存（可能需要安装，可能无法安装）
*   客户端必须下载 flex 框架（几百千字节）
*   Flex 内容没有被搜索引擎索引（与 Google 可能声称的相反）

Flex 有一个主要优势： - 更擅长构建丰富的界面（参见 Picnik.com 等）

例如，在 Flex 中，很容易创建自定义样式的对话框，包括阴影、内部发光、动画打开等任何您想要的。

总之，如果您需要额外的丰富性，请使用 Flex。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T17:18:21.167

除了这里已经提到的，另一个主要区别是 JavaScript 是动态类型的，而 ActionScript 是静态类型的。这是好是坏取决于你的观点:)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T22:01:26.133

如果您希望您的 Web 应用程序看起来不是一个 Web 应用程序，那么 Flex 非常好。您还可以避开让 HTML+JS 看起来像一个真正的应用程序的所有麻烦。对于本质上是一个网站的东西，Flex 可能不是最佳选择，但如果你真的想编写一个恰好可以通过浏览器访问的应用程序，它可以快速开发并提供漂亮的结果。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-27T07:05:18.063

您应该改用 Google Gears。创建您的应用程序，为其添加一些 Gears，您可以大大提高应用程序的速度（和可靠性）。

[http://gears.google.com/](http://gears.google.com/)

从本质上讲，Google gears 让您可以访问任何应用程序的两个有用的东西：离线数据存储和本机线程控制（允许更新/计算在后台运行并且不会降低用户计算机的速度）。

真正好的事情是，你可以为你的应用程序使用你喜欢的任何框架，只要数据存储/检索和服务器端通信是用 JavaScript 处理的。

它还允许您在客户端缓存所需的任何文件，这在您想要避免浏览器中的“闪烁”外观时特别有用，同时浏览器正在下载一些所需的图像。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-03T02:30:33.290

考虑使用 Flex 的几个原因：

1.  Flex 中的控件库比使用 JS/DHTML 所能做的任何事情都要丰富得多。图表控件是业务应用程序的杀手，DataGrid / AdvancedDataGrid 之类的东西远远领先于您可以使用 HTML 执行的任何操作。

2.  Flex 框架是为构建应用程序而设计的。它抽象出 Flash Player 中的“基于帧”的概念，从而真正使构建应用程序变得容易。它具有精心设计的组件层次结构，可以轻松扩展任何标准控件。它还有一个非常直观的事件模型来处理用户输入，并且可以轻松地让您的任何控件调度自定义事件，这些事件可以冒泡到父组件或通过中央事件调度程序进行路由。虽然使用 JS/DHTML 可以做到这一点，但我认为这并不容易，而且它肯定不是为它设计的。

3.  您可以使用 AIR 运行时将 Flex 应用程序快速部署到桌面。AIR 还为本地系统访问、嵌入式 SQLite DB 等提供了额外的 API。Gears 提供了类似的东西，但它确实需要浏览器。当然，AIR 需要 AIR 运行时，但至少它的目的是构建桌面应用程序。

4.  您可以构建一个非常丰富、非常性感的 UI，让您的用户大吃一惊。作为程序员，我们可能不关心用户体验，但我们的用户关心。苹果最近取得巨大成功的部分原因是他们非常重视用户体验，用户/消费者也注意到了这一点。

我认为最大的问题是，如果您真的习惯 Java 或 C#，ActionScript 语言似乎会有点限制。如果你比较它的 JavaScript，它是相当的，或者可能稍微好一点。

很多人会抱怨 Flash Player（或 AIR），因为它不是“基于标准的”。如果我们只愿意使用 100% 符合标准且没有插件的网站，我们今天就没有 YouTube。或者几乎任何其他网站都可以进行有趣的数据可视化，而您无法使用 HTML/JS （或者至少，没有理智的努力）。Adobe 在开放 Flex 框架、Blaze DS（用于后端 Java 开发）、发布 AMF 规范和启动 Open Screen Alliance 以将 Flash Player 推向移动设备方面取得了相当大的进步。Flash Player、Flex、Flex Builder 和 Blaze DS 都有公共 JIRA 错误跟踪器。我会说 Flash Player 本身很有可能在未来 2-3 年内开源。我认为 Adob​​e 正在继续朝着非常开放的方向发展，并且对平台“封闭”和“专有”的批评变得不那么相关了。我认为，如果开发人员以开放的心态接触 Flex/FP，他们会真正对它们如何组合在一起印象深刻。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-31T12:50:09.063

这个比较表足以让我决定使用什么。我更喜欢 javascript:)

[http://askmeflash.com/article_m.php?p=article&id=11](http://askmeflash.com/article_m.php?p=article&id=11)

# git - 如何通过 HTTP 代理从 Git 存储库中提取？

> ID：128035
> 
> 赞同：518
> 
> 时间：2008-09-24T15:58:32.607
> 
> 标签：git, proxy, git-submodules

注意：虽然描述的用例是关于在项目中使用子模块，但这同样适用于`git clone`通过 HTTP 的存储库的正常情况。

我有一个受 Git 控制的项目。我想添加一个子模块：

```
git submodule add http://github.com/jscruggs/metric_fu.git vendor/plugins/metric_fu 
```

但我明白了

```
...
got 1b0313f016d98e556396c91d08127c59722762d0
got 4c42d44a9221209293e5f3eb7e662a1571b09421
got b0d6414e3ca5c2fb4b95b7712c7edbf7d2becac7
error: Unable to find abc07fcf79aebed56497e3894c6c3c06046f913a under http://github.com/jscruggs/metri...
Cannot obtain needed commit abc07fcf79aebed56497e3894c6c3c06046f913a
while processing commit ee576543b3a0820cc966cc10cc41e6ffb3415658.
fatal: Fetch failed.
Clone of 'http://github.com/jscruggs/metric_fu.git' into submodule path 'vendor/plugins/metric_fu' 
```

我设置了 HTTP_PROXY：

```
c:\project> echo %HTTP_PROXY%
http://proxy.mycompany:80 
```

我什至有一个用于 http 代理的全局 Git 设置：

```
c:\project> git config --get http.proxy
http://proxy.mycompany:80 
```

有没有人通过代理获得 HTTP 提取以始终如一地工作？真正奇怪的是，GitHub 上的一些项目运行良好（[`awesome_nested_set`](http://github.com/collectiveidea/awesome_nested_set/)例如），但其他项目始终失败（例如[rails ）。](http://github.com/rails/rails/)

* * *

## 回答 #1

> 赞同：611
> 
> 时间：2010-08-04T14:55:19.200

您还可以在全局配置属性中设置 Git 使用的 HTTP 代理`http.proxy`：

```
git config --global http.proxy http://proxy.mycompany:80 
```

要使用代理进行身份验证：

```
git config --global http.proxy http://mydomain\\myusername:mypassword@myproxyserver:8080/ 
```

（认证格式[归功于@EugeneKulabuhov](https://stackoverflow.com/users/215809/eugene-kulabuhov)和[@JaimeReynoso](https://stackoverflow.com/users/3067848/jaime-reynoso)。）

* * *

## 回答 #2

> 赞同：151
> 
> 时间：2013-02-07T11:33:16.900

已经有一些很好的答案。但是，我想我会加入，因为某些代理服务器要求您使用用户 ID 和密码进行身份验证。有时这可以在域上。

因此，例如，如果您的代理服务器配置如下：

```
Server: myproxyserver
Port: 8080
Username: mydomain\myusername
Password: mypassword 
```

然后，`.gitconfig`使用以下命令添加到您的文件中：

```
git config --global http.proxy http://mydomain\\myusername:mypassword@myproxyserver:8080 
```

别担心`https`。只要指定的代理服务器支持 http 和 https，那么配置文件中的一项就足够了。

然后，您可以通过执行以下操作验证该命令是否已`.gitconfig`成功将条目添加到您的文件中`cat .gitconfig`：

在文件末尾，您将看到如下条目：

```
[http]
    proxy = http://mydomain\\myusername:mypassword@myproxyserver:8080 
```

就是这样！

* * *

## 回答 #3

> 赞同：134
> 
> 时间：2008-12-29T12:34:18.373

最终起作用的是设置`http_proxy`环境变量。我设置`HTTP_PROXY`正确，但 git 显然更喜欢小写版本。

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2014-12-24T01:45:28.503

如果您只想在指定的存储库上使用代理，则不需要在其他存储库上。更可取的方式是`-c, --config <key=value>`当您`git clone`使用存储库时的选项。例如

```
$ git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git --config "http.proxy=proxyHost:proxyPort" 
```

* * *

## 回答 #5

> 赞同：53
> 
> 时间：2008-09-24T16:24:51.373

看起来您正在 Windows 上使用 Git 的 mingw 编译（或者可能是我没听说过的另一个）。有一些调试方法：我相信 git 的所有 http 代理工作都是由 curl 完成的。在运行 git 之前设置这个环境变量：

```
GIT_CURL_VERBOSE=1 
```

这至少应该让您了解幕后发生的事情。

* * *

## 回答 #6

> 赞同：26
> 
> 时间：2013-03-11T15:10:15.793

当您的网络团队通过重写证书进行 ssl-inspection 时，然后使用 http url 而不是 https ，并结合设置此 var 对我有用。

```
git config --global http.proxy http://proxy:8081 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2015-09-23T16:30:15.030

对我来说 git:// 只是不能通过代理工作，尽管 https:// 可以。这引起了一些头痛，因为我正在运行所有使用 git:// 的脚本，所以我不能轻易地全部更改它们。但是我发现了这个 GEM

```
git config --global url."https://github.com/".insteadOf git://github.com/ 
```

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2012-10-19T08:35:10.647

您也可以**编辑**位于 Windows 系统上的 %userprofile% 目录（*记事本 %userprofile%.gitconfig*）或 Linux 系统上的 ~ 目录（*vi ~/.gitconfig*）中的 .gitconfig 文件，并**添加一个 http 部分**，如下所示。

.gitconfig 文件的内容：

```
[http]
        proxy = http://proxy.mycompany:80 
```

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2011-04-19T11:51:04.473

这是一个老问题，但如果您使用的是 Windows，请考虑设置 HTTPS_PROXY 以及通过 https URL 检索。为我工作！

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2013-05-28T14:21:23.037

我发现我的经过身份验证的 http 代理既不工作`http.proxy`也不`GIT_PROXY_COMMAND`工作。代理不会以任何一种方式触发。但我找到了解决这个问题的方法。

1.  安装[开瓶器](http://www.agroman.net/corkscrew/)，或您想要的其他替代品。
2.  创建一个授权文件。格式为`authfile`：`user_name:password`, 和`user_name`,`password`是您访问代理的用户名和密码。要创建这样的文件，只需运行如下命令：`echo "username:password" > ~/.ssh/authfile`.

3.  编辑`~/.ssh/config`，并确保其权限为`644`：`chmod 644 ~/.ssh/config`

以 github.com 为例，添加如下几行`~/.ssh/config`：

```
Host    github.com
        HostName        github.com
        ProxyCommand    /usr/local/bin/corkscrew <your.proxy> <proxy port> %h %p <path/to/authfile>
        User            git 
```

现在，每当您对 进行任何操作时`git@github.com`，它都会自动使用代理。[您也可以轻松地对Bitbucket](https://bitbucket.org)执行相同的操作。

这不像其他方法那么优雅，但它就像一种魅力。

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2014-02-20T09:46:31.890

在 Windows 上，如果您不想将密码以纯文本形式放在 .gitconfig 中，可以使用

*   cntml ( [http://cntlm.sourceforge.net/](http://cntlm.sourceforge.net/) )

它针对普通甚至 Windows NTLM 代理对您进行身份验证，并在没有身份验证的情况下启动 localhost-proxy。

为了让它运行：

*   安装 Cntml
*   根据文档配置 Cntml 以通过您的代理身份验证
*   将 git 指向新的 localhost 代理：

    ```
    [http]
        proxy = http://localhost:3128       # change port as necessary 
    ```

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2015-04-09T09:23:59.670

对我来说，它的作用是：

```
sudo apt-get install socat 
```

在 $BIN_PATH/gitproxy 中创建一个文件：

```
#!/bin/sh 
_proxy=192.168.192.1 
_proxyport=3128 
exec socat STDIO PROXY:$_proxy:$1:$2,proxyport=$_proxyport 
```

不要忘记给它执行权限

```
chmod a+x gitproxy 
```

运行以下命令来设置环境：

```
export PATH=$BIN_PATH:$PATH
git config --global core.gitproxy gitproxy 
```

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2016-11-24T13:21:17.450

# 设置代理到 git

### 命令

```
git config --global http.proxy http://user:password@domain:port 
```

### 例子

```
git config --global http.proxy http://clairton:123456@proxy.clairtonluz.com.br:8080 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2018-08-15T23:31:30.533

将 Git credential.helper 设置为 wincred。

```
git config --global credential.helper wincred 
```

确保只有 1 个 credential.helper

```
git config -l 
```

如果超过 1 个并且未设置为 wincred，请将其删除。

```
git config --system --unset credential.helper 
```

现在设置没有密码的代理。

```
git config --global http.proxy http://<YOUR WIN LOGIN NAME>@proxy:80 
```

检查您添加的所有设置是否正常......

```
git config --global -l 
```

现在你可以走了！

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2012-02-26T02:13:22.567

我遇到了同样的问题，但修复方法略有不同：**REBUILDING GIT WITH HTTP SUPPORT**

该`git:`协议无法通过我的公司防火墙工作。

例如，这超时：

```
git clone git://github.com/miksago/node-websocket-server.git 
```

`curl github.com`不过，工作得很好，所以我知道我的`http_proxy`环境变量是正确的。

我尝试使用`http`，如下所示，但立即出现错误。

```
git clone http://github.com/miksago/node-websocket-server.git

->>>  fatal: Unable to find remote helper for 'http' <<<- 
```

我尝试像这样重新编译git：

```
./configure  --with-curl --with-expat 
```

但仍然出现致命错误。

最后，经过几个令人沮丧的小时后，我阅读了配置文件，看到了这个：

> # 定义 CURLDIR=/foo/bar 如果你的 curl 头文件和库文件在
> 
> # /foo/bar/include 和 /foo/bar/lib 目录。

我当时想起来，我没有`curl`从源头上编译，所以去找头文件。果然，它们没有安装。这就是问题所在。Make 没有抱怨丢失的头文件。所以我没有意识到该`--with-curl`选项什么也没做（实际上是我的版本中的默认值`git`）。

我做了以下修复它：

1.  添加了 make 所需的标头：

    ```
    yum install curl-devel
    (expat-devel-1.95.8-8.3.el5_5.3.i386  was already installed). 
    ```

2.  `git`从中删除`/usr/local`（因为我希望新安装在那里）。

    我只是`git*`从`/usr/local/share`和`/usr/local/libexec`

3.  搜索包含头文件`curl`和`expat`头文件的包含目录，然后（因为我已经通读`configure`）将这些添加到环境中，如下所示：

    ```
    export CURLDIR=/usr/include 
    export EXPATDIR=/usr/include 
    ```

4.  使用`configure`以下选项运行，这些选项再次在`configure`文件本身中进行了描述，也是默认设置，但到底是什么：

    ```
    ./configure  --with-curl --with-expat 
    ```

5.  现在`http`可以`git`通过我的公司防火墙使用：

    ```
    git clone http://github.com/miksago/node-websocket-server.git
    Cloning into 'node-websocket-server'...
    * Couldn't find host github.com in the .netrc file, using defaults
    * About to connect() to proxy proxy.entp.attws.com port 8080
    *   Trying 135.214.40.30... * connected
    ... 
    ```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2016-10-24T03:22:03.083

这对我有用。

```
git config --global http.proxy proxy_user:proxy_passwd@proxy_ip:proxy_port 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2011-08-26T14:56:53.027

只是为了发布这个，因为它是 Google 上的第一个结果，我发现这篇博文通过更新 curl 证书为我解决了这个问题。

[http://www.simplicidade.org/notes/archives/2011/06/github_ssl_ca_errors.html](http://www.simplicidade.org/notes/archives/2011/06/github_ssl_ca_errors.html)

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2017-03-22T14:52:40.913

使用[代理链](http://proxychains.sourceforge.net/)

```
proxychains git pull ... 
```

**更新：** proxychains 已停用，请改用[proxychains-ng](https://github.com/rofl0r/proxychains-ng)。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2019-12-11T09:36:58.687

值得一提的是：网络上的大多数示例都显示了[类似的示例](https://stackoverflow.com/a/40210253)

```
git config --global http.proxy proxy_user:proxy_passwd@proxy_ip:proxy_port 
```

看来，如果您的代理需要身份验证，您**必须**将公司密码留在 git-config 中。这不是很酷。

但是，如果您只是配置没有密码的用户：

```
git config --global http.proxy proxy_user@proxy_ip:proxy_port 
```

Git 似乎（至少在我没有凭据助手的 Windows 机器上）可以识别并提示在 repo-access 时输入代理密码。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2017-02-21T17:29:37.347

您可以使用：

```
git config --add http.proxy http://user:password@proxy_host:proxy_port 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2019-11-27T04:11:39.010

以下方法对我有用：

```
echo 'export http_proxy=http://username:password@roxy_host:port/' >> ~/.bash_profile
echo 'export https_proxy=http://username:password@roxy_host:port' >> ~/.bash_profile 
```

*   Zsh 注意：修改你的 ~/.zshenv 文件而不是 ~/.bash_profile。
*   Ubuntu 和 Fedora 注意：修改你的 ~/.bashrc 文件而不是 ~/.bash_profile。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2016-02-02T08:50:06.130

对于 Windows

转到 --> C:/Users/user_name/gitconfig

使用以下详细信息更新 gitconfig 文件

[http]

[https]

```
proxy = https://your_proxy:your_port 
```

[http]

```
proxy = http://your_proxy:your_port 
```

**如何检查您的代理和端口号？**

Internet Explorer -> 设置 -> Internet 选项 -> 连接 -> LAN 设置

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-09-24T19:02:45.563

这不是您的代理的问题。这是github（或git）的问题。在 Linux 上的 git-1.6.0.1 对我来说也失败了。 [错误](http://logicalawesome.lighthouseapp.com/projects/8570/tickets/992-git-submodule-add-fails)已被报告（由您报告）。

确保删除你的馅饼，它们已经在谷歌上。编辑：一定是在做梦，我猜你不能删除它们。改用[Gist](http://gist.github.com/)吗？

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2013-04-19T07:27:36.600

$http_proxy 用于[http://github.com](http://github.com) .... $https_proxy 用于[https://github.com](https://github.com) ...

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2013-08-10T01:40:01.900

当我的代理不需要身份验证时，上述答案对我有用。如果您使用需要您进行身份验证的代理，那么您可以尝试 CCProxy。我有关于如何在这里设置它的小教程，

[http://blog.praveenkumar.co.in/2012/09/proxy-free-windows-xp78-and-mobiles.html](http://blog.praveenkumar.co.in/2012/09/proxy-free-windows-xp78-and-mobiles.html)

我能够推送、拉取、创建新的存储库。一切正常。如果您像我一样遇到 Git 问题，请确保您彻底卸载并重新安装新版本。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2016-04-07T08:05:13.600

正如@user2188765 已经指出的那样，尝试将`git://`存储库的协议替换为`http[s]://`. 另请参阅[此答案](https://stackoverflow.com/a/36469864/1150303)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2021-03-31T14:28:48.390

有一种方法可以为特定 URL 设置代理，请参阅手册中的http [.<url>.* 部分](https://git-scm.com/docs/git-config#Documentation/git-config.txt-httplturlgt)`git config`。例如，对于`https://github.com/`一个可以做

```
git config --global 'http.https://github.com/.proxy' http://proxy.mycompany:80 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2014-03-19T16:58:28.223

我使用 https 绕过代理...有些代理甚至不检查 https。

```
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

c:\git\meantest>git clone http://github.com/linnovate/mean.git
Cloning into 'mean'...
fatal: unable to access 'http://github.com/linnovate/mean.git/': Failed connect
to github.com:80; No error

c:\git\meantest>git clone https://github.com/linnovate/mean.git
Cloning into 'mean'...
remote: Reusing existing pack: 2587, done.
remote: Counting objects: 27, done.
remote: Compressing objects: 100% (24/24), done.
rRemote: Total 2614 (delta 3), reused 4 (delta 0)eceiving objects:  98% (2562/26

Receiving objects: 100% (2614/2614), 1.76 MiB | 305.00 KiB/s, done.
Resolving deltas: 100% (1166/1166), done.
Checking connectivity... done 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2016-03-02T15:05:18.410

正如许多人回答的那样，但这仅适用于具有身份验证的代理背后的**Winodws USER。**

重新安装（第一次失败，不要删除）。

```
Goto ->
**Windows**
1\. msysgit\installer-tmp\etc\gitconfig
    Under [http]
        proxy = http://user:pass@url:port

**Linux**
1\. msysgit\installer-tmp\setup-msysgit.sh
      export HTTP_PROXY="http://USER:PASS@proxy.abc.com:8080" 
```

如果您在用户/密码中有任何特殊字符，请使用[url_encode](https://superuser.com/questions/273799/how-to-use-special-characters-in-username-password-for-http-proxy)

# java - 如何使用 java 锁定文件（如果可能）

> ID：128038
> 
> 赞同：128
> 
> 时间：2008-09-24T15:59:23.040
> 
> 标签：java, file-io

我有一个使用 FileReader 打开文件的 Java 进程。如何防止另一个（Java）进程打开此文件，或者至少通知第二个进程该文件已打开？如果文件打开（这解决了我的问题），这是否会自动使第二个进程出现异常，还是我必须在第一个进程中使用某种标志或参数显式打开它？

### 澄清：

我有一个 Java 应用程序，它列出了一个文件夹并打开列表中的每个文件进行处理。它一个接一个地处理每个文件。每个文件的处理包括读取它并根据内容进行一些计算，大约需要 2 分钟。我还有另一个 Java 应用程序，它做同样的事情，而是写在文件上。我想要的是能够同时运行这些应用程序，所以场景是这样的。ReadApp 列出文件夹并找到文件 A、B、C。它打开文件 A 并开始读取。WriteApp 列出文件夹并找到文件 A、B、C。它打开文件 A，看到它是打开的（通过异常或任何方式）并转到文件 B。ReadApp 完成文件 A 并继续到 B。它看到它是开放的，并继续到 C。WriteApp 不这样做是至关重要的 t 在 ReadApp 读取同一文件时写入，反之亦然。它们是不同的过程。

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2008-09-24T16:20:47.403

FileChannel.lock 可能是您想要的。

```
try (
    FileInputStream in = new FileInputStream(file);
    java.nio.channels.FileLock lock = in.getChannel().lock();
    Reader reader = new InputStreamReader(in, charset)
) {
    ...
} 
```

（免责声明：代码未经编译，当然也未经测试。）

[请注意FileLock](https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/nio/channels/FileLock.html#pdep)的 API 文档中标题为“平台依赖项”的部分。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2012-01-26T15:20:33.737

不要使用`java.io`包中的类，而是使用`java.nio`包。后者有一个`FileLock`类。您可以对`FileChannel`.

```
 try {
        // Get a file channel for the file
        File file = new File("filename");
        FileChannel channel = new RandomAccessFile(file, "rw").getChannel();

        // Use the file channel to create a lock on the file.
        // This method blocks until it can retrieve the lock.
        FileLock lock = channel.lock();

        /*
           use channel.lock OR channel.tryLock();
        */

        // Try acquiring the lock without blocking. This method returns
        // null or throws an exception if the file is already locked.
        try {
            lock = channel.tryLock();
        } catch (OverlappingFileLockException e) {
            // File is already locked in this thread or virtual machine
        }

        // Release the lock - if it is not null!
        if( lock != null ) {
            lock.release();
        }

        // Close the file
        channel.close();
    } catch (Exception e) {
    } 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-24T16:13:36.577

如果您可以使用**Java NIO**（*JDK 1.4 或更高*版本），那么我认为您正在寻找`java.nio.channels.FileChannel.lock()`

[FileChannel.lock()](http://java.sun.com/j2se/1.5.0/docs/api/java/nio/channels/FileChannel.html#lock(long,%20long,%20boolean))

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-24T16:14:07.467

将[java.nio.channels.FileLock](http://java.sun.com/javase/6/docs/api/java/nio/channels/FileLock.html)与[java.nio.channels.FileChannel结合使用](http://java.sun.com/javase/6/docs/api/java/nio/channels/FileChannel.html)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-25T03:48:21.743

这可能不是您要寻找的，而是为了从另一个角度解决问题....

这两个 Java 进程可能想要访问同一个应用程序中的同一个文件吗？也许您可以通过一个同步的方法（或者，甚至更好，使用[JSR-166](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/package-summary.html)）过滤对文件的所有访问？这样，您就可以控制对文件的访问，甚至可以对访问请求进行排队。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-25T03:40:36.537

使用 RandomAccessFile，获取它的频道，然后调用 lock()。输入或输出流提供的通道没有足够的权限来正确锁定。确保在 finally 块中调用 unlock() （关闭文件不一定释放锁）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-05-24T03:57:39.147

下面是一个示例代码片段，用于锁定文件，直到它的进程由 JVM 完成。

```
 public static void main(String[] args) throws InterruptedException {
    File file = new File(FILE_FULL_PATH_NAME);
    RandomAccessFile in = null;
    try {
        in = new RandomAccessFile(file, "rw");
        FileLock lock = in.getChannel().lock();
        try {

            while (in.read() != -1) {
                System.out.println(in.readLine());
            }
        } finally {
            lock.release();
        }
    } catch (FileNotFoundException e) {
        e.printStackTrace();
    } catch (IOException e) {
        e.printStackTrace();
    }finally {
        try {
            in.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-08-12T15:44:04.847

如果您使用 winscp 或 ftp 传输，请将此用于 unix：

```
public static void isFileReady(File entry) throws Exception {
        long realFileSize = entry.length();
        long currentFileSize = 0;
        do {
            try (FileInputStream fis = new FileInputStream(entry);) {
                currentFileSize = 0;
                while (fis.available() > 0) {
                    byte[] b = new byte[1024];
                    int nResult = fis.read(b);
                    currentFileSize += nResult;
                    if (nResult == -1)
                        break;
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
            System.out.println("currentFileSize=" + currentFileSize + ", realFileSize=" + realFileSize);
        } while (currentFileSize != realFileSize);
    } 
```

# java - compare() 中的空字段怎么办？

> ID：128042
> 
> 赞同：23
> 
> 时间：2008-09-24T16:00:09.293
> 
> 标签：java, comparison, null

在 Java 中，我使用了一个类，其中一些字段可以是`null`. 例如：

```
class Foo {
    String bar;
    //....
} 
```

我想为这个类写一个 BarComparator，

```
 private static class BarComparator
            implements Comparator<Foo> {
        public int compare( final Foo o1, final Foo o2 )
        {
            // Implementation goes here
        }
    } 
```

有没有一种标准的方法来处理任何 , `o1`, `o2`,`o1.bar`中的任何一个`o2.bar`都可以`null`，而无需编写大量嵌套的`if`... `else`？

干杯!

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-24T16:30:06.103

我想你可以用一个小的静态方法来包装对字段 compareTo 方法的调用，以对空值进行高低排序：

```
static <T extends Comparable<T>> int cp(T a, T b) {
     return
         a==null ?
         (b==null ? 0 : Integer.MIN_VALUE) :
         (b==null ? Integer.MAX_VALUE : a.compareTo(b));
} 
```

简单用法（多个字段与您通常一样）：

```
public int compare( final Foo o1, final Foo o2 ) {
    return cp(o1.field, o2.field);
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-25T14:25:09.263

感谢您的回复！通用方法和 Google 比较器看起来很有趣。

我发现[Apache Commons Collections](http://commons.apache.org/collections/api-release/index.html)中有一个[NullComparator](http://commons.apache.org/collections/api-release/org/apache/commons/collections/comparators/NullComparator.html)（我们目前正在使用）：

```
private static class BarComparator
        implements Comparator<Foo>
{
    public int compare( final Foo o1, final Foo o2 )
    {
        // o1.bar & o2.bar nulleness is taken care of by the NullComparator.
        // Easy to extend to more fields.
        return NULL_COMPARATOR.compare(o1.bar, o2.bar);
    }

    private final static NullComparator NULL_COMPARATOR =
                                            new NullComparator(false);
} 
```

注意：我在这里专注于该`bar`领域以保持重点。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-24T16:12:05.707

这取决于您是否认为空条目是值得比较的有效字符串值。为 null < 或 > “苹果”。我唯一可以肯定的是 null == null。如果您可以定义 null 适合排序的位置，那么您可以适当地编写代码。

在这种情况下，我可能会选择抛出 NullPointerExcpetion 或 IllegalArgumentException 并尝试在更高级别处理 null，方法是首先不将其放在比较中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T17:17:45.410

这里的关键是弄清楚您希望如何处理空值。一些选项是：a) 假设 null 在排序顺序中位于所有其他对象之前 b) 假设 null 在排序顺序中位于所有其他对象之后 c) 将 null 视为等效于某个默认值 d) 将 null 视为错误条件。您选择哪一个将完全取决于您正在处理的应用程序。

当然，在最后一种情况下，您会抛出异常。对于其他人，您需要一个四向 if/else 案例（大约三分钟的编码一个您已经制定出您想要的结果）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T18:54:21.230

如果您使用的是 Google 集合，您可能会发现[Comparators](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/Comparators.html#nullGreatestOrder())类很有帮助。If 具有将 null 排序为集合中最大或最小元素的辅助方法。您可以使用[复合比较器](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/Comparators.html#compound(java.util.Comparator,%20java.util.Comparator))来帮助减少代码量。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-10-02T18:58:09.720

你可以为它写你的比较器。假设您有一个以字符串名称作为私有字段的类 Person。getName() 和 setName() 方法来访问字段名称。下面是 Person 类的比较器。

```
 Collections.sort(list, new Comparator<Person>() {
        @Override
        public int compare(Person a, Person b) {
            if (a == null) {
                if (b == null) {
                    return 0;
                }
                return -1;
            } else if (b == null) {
                return 1;
            }
            return a.getName().compareTo(b.getName());
        }
    }); 
```

更新：

从 Java 8 开始，您可以将以下 API 用于 List。

```
// Push nulls at the end of List
Collections.sort(subjects1, Comparator.nullsLast(String::compareTo));

// Push nulls at the beginning of List
Collections.sort(subjects1, Comparator.nullsFirst(String::compareTo)); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-10-28T13:14:17.713

您还可以使用 Spring Framework 中的类`org.springframework.util.comparator.NullSafeComparator`。

示例（Java 8）：

```
SortedSet<Foo> foos = new TreeSet<>( ( o1, o2 ) -> {
        return new NullSafeComparator<>( String::compareTo, true ).compare( o1.getBar(), o2.getBar() );
    } );

    foos.add( new Foo(null) );
    foos.add( new Foo("zzz") );
    foos.add( new Foo("aaa") );

    foos.stream().forEach( System.out::println ); 
```

这将打印：

```
Foo{bar='null'}
Foo{bar='aaa'}
Foo{bar='zzz'} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-01-12T14:08:45.953

将客户视为 POJO。我的回答是：

```
Comparator<Customer> compareCustomer = Comparator.nullsLast((c1,c2) -> c1.getCustomerId().compareTo(c2.getCustomerId())); 
```

或者

```
Comparator<Customer> compareByName = Comparator.comparing(Customer::getName,nullsLast(String::compareTo)); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-25T17:06:22.217

您不应该按照您的方式使用 NullComparator - 您正在为每个比较操作创建该类的新实例，并且如果您正在对包含 1000 个条目的列表进行排序，那么这将是 1000 * log2(1000) 对象完全是多余的。这很快就会出现问题。

要么继承它，要么委托给它，或者简单地实现你自己的空检查——它真的没有那么复杂：

```
private static class BarComparator
        implements Comparator<Foo> {
    private NullComparator delegate = new NullComparator(false);

    public int compare( final Foo o1, final Foo o2 )
    {
        return delegate.compare(o1.bar, o2.bar);
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T16:07:09.060

我认为早期返回语句将是许多 if 的另一种选择

例如

```
if(o1==null) return x;
if(o2==null) return x;
if(o1.getBar()==null) return x;
if(o2.getBar()==null) return x;

// No null checks needed from this point. 
```

# java - 合并大文件的算法

> ID：128043
> 
> 赞同：4
> 
> 时间：2008-09-24T16:00:15.347
> 
> 标签：java, sorting, file, merge

我有几个事件日志文件（每行一个事件）。日志可能会重叠。日志是在可能来自多个时区的单独客户端计算机上生成的（但我假设我知道时区）。每个事件都有一个标准化为公共时间的时间戳（通过使用适合日志文件的时区实例化每个日志解析器日历实例，然后使用 getTimeInMillis 获取 UTC 时间）。日志已经按时间戳排序。多个事件可以同时发生，但它们绝不是相等的事件。

这些文件可能比较大，例如单个日志中有 500000 个或更多事件，因此将日志的全部内容读入一个简单的 Event[] 是不可行的。

我正在尝试做的是将每个日志中的事件合并到一个日志中。这有点像一个合并排序任务，但每个日志都已经排序，我只需要将它们放在一起。第二个组件是可以在每个单独的日志文件中见证相同的事件，我想在文件输出日志中“删除重复事件”。

这可以“就地”完成吗，例如在每个日志文件的一些小缓冲区上按顺序工作？我不能简单地将所有文件读入 Event[]，对列表进行排序，然后删除重复项，但到目前为止，我有限的编程能力只能让我将其视为解决方案。当我同时从每个日志中读取事件时，是否可以使用一些更复杂的方法来执行此操作？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-24T16:09:10.177

1.  从每个日志文件中读取第一行

2.  环形

    一种。找到“最早的”行。

    湾。将“最早”行插入主日志文件

    C。从包含最早行的文件中读取下一行

您可以检查 b 和 c 之间的重复项，推进每个文件的指针。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T16:09:14.140

当然 - 打开每个日志文件。将每一行的第一行读入一个“当前”行数组。然后从当前数组中重复选择时间戳最低的行。将其写入输出，并从相应的源文件中读取一个新行来替换它。

这是 Python 中的一个示例，但它也可以生成很好的伪代码：

```
def merge_files(files, key_func):
    # Populate the current array with the first line from each file
    current = [file.readline() for file in files]
    while len(current) > 0:
        # Find and return the row with the lowest key according to key_func
        min_idx = min(range(len(files)), key=lambda x: return key_func(current[x]))
        yield current[min_idx]
        new_line = files[min_idx].readline()
        if not new_line:
            # EOF, remove this file from consideration
            del current[min_idx]
            del files[min_idx]
        else:
            current[min_idx] = new_line 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-29T00:51:36.300

查看此链接： http: [//www.codeodor.com/index.cfm/2007/5/10/Sorting-really-BIG-files/1194](http://www.codeodor.com/index.cfm/2007/5/10/Sorting-really-BIG-files/1194)

*   使用堆（基于数组）。此堆/数组中的元素数量将等于您拥有的日志文件的数量。

*   从所有文件中读取第一条记录并将它们插入到您的堆中。

*   循环直到（任何文件中都没有更多记录）

```
      > 从堆中删除最大元素
      > 将其写入输出
      > 从（前一个）最大元素所属的文件中读取下一条记录
          如果该文件中没有更多记录
              从文件列表中删除它
              继续
      > 如果它与（前一个）最大元素不同，则将其添加到堆中

```

现在您将所有事件都放在一个日志文件中，它们已排序，并且没有重复。该算法的时间复杂度为 (n log k)，其中 n 是记录总数，k 是日志文件数。

在读取和读取文件时，您应该使用缓冲的读取器和缓冲的写入器对象，以最大限度地减少磁盘读取和写入的次数，从而优化时间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-25T06:26:30.753

我们需要按时间顺序合并多个日志文件，每个日志条目具有多行（Java 应用程序经常这样做 - 它们的堆栈跟踪是相同的）。我决定实现简单的 shell+perl 脚本。它涵盖了我们的任务。如果您对此感兴趣 - 请点击链接[http://code.google.com/p/logmerge/](http://code.google.com/p/logmerge/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T16:15:25.950

从两个源文件中一次只读取一行。比较这些行并将较旧的行写入输出文件（并前进到下一行）。执行此操作，直到您到达两个文件的末尾并且您已合并文件。

并确保删除重复项:)

我想 C# 中的这段代码可以说明这种方法：

```
 StringReader fileStream1;
        StringReader fileStream2;
        Event eventCursorFile1 = Event.Parse(fileStream1.ReadLine());
        Event eventCursorFile2 = Event.Parse(fileStream2.ReadLine());

        while !(fileStream1.EOF && fileStream2.EOF)
        {
            if (eventCursorFile1.TimeStamp < eventCursorFile2.TimeStamp)
            {
                WriteToMasterFile(eventCursorFile1);
                eventCursorFile1 = Event.Parse(fileStream1.ReadLine());
            }
            else if (eventCursorFile1.TimeStamp == eventCursorFile2.TimeStamp)
            {
                WriteToMasterFile(eventCursorFile1);
                eventCursorFile1 = Event.Parse(fileStream1.ReadLine());
                eventCursorFile2 = Event.Parse(fileStream2.ReadLine());
            }
            else
            {
                WriteToMasterFile(eventCursorFile1);
                eventCursorFile2 = Event.Parse(fileStream2.ReadLine());
            }  
        } 
```

中断条件并不完全正确，因为这只是 Quick'n'dirty，但它应该看起来相似..

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T19:00:02.403

或者，您可以从开源网站统计工具 Awstats 借用日志合并实用程序。

[logresolvemerge.pl](http://awstats.cvs.sourceforge.net/awstats/awstats/tools/logresolvemerge.pl?view=markup)是一个可以合并多个日志文件的 perl 脚本：您甚至可以使用多个线程来合并日志文件（需要有 perl 5.8 才能使用多线程）。您为什么不尝试使用现成的工具而不是构建一个？

# database - 在哪些情况下，您会针对内存数据库而不是开发数据库进行测试？

> ID：128048
> 
> 赞同：5
> 
> 时间：2008-09-24T16:01:53.347
> 
> 标签：database, testing, tdd, mocking, integration-testing

您何时针对[内存数据库](http://martinfowler.com/bliki/InMemoryTestDatabase.html)与开发数据库进行测试？

另外，作为一个相关的附带问题，当您使用开发数据库时，您是使用个人开发数据库、集成开发数据库还是两者都使用？

此外 ++，对于单元测试，您何时使用内存数据库而不是模拟您的存储库/DAL 等？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T16:24:42.900

当数据很容易为您的给定测试用例播种并且正在测试非常特殊的操作时，内存中是您的*单元*测试的绝佳选择。真正的数据库更适合*集成*测试，其中数据先决条件更复杂，并且在测试完成后保留基础数据是有价值的。

对我们来说，我们在 JUnit 测试的“快速”测试套件中唯一允许的东西是那些没有任何外部依赖项（数据库、文件、网络等）的东西，这样开发人员和开发人员都可以快速有效地运行该套件。签入时的持续集成。如果有某个测试绝对需要去数据库，那么内存中的测试是唯一的方法。

要记住几点：

*   如果您需要在单元测试中使用数据库，请仔细考虑。这可能表明设计不佳，因为数据访问层与您尝试测试的业务逻辑耦合得太紧密，无法模拟出来。
*   如果使用真实数据库进行集成测试，请确保测试完成后始终将数据恢复到原始状态。我见过很多浪费时间和失败的集成测试，因为其他一些测试弄乱了数据。

至于你的其他问题，这真的取决于你的需要。一个好的经验法则是每个代码分支一个开发数据库，​​因为可能需要与另一个代码分支无关的模式更改。拥有一个专门的开发数据库很重要*；*我很惊讶有多少开发团队必须与 QA 团队共享数据库等。能够在不影响其他团队或阻止其他团队工作的沙盒环境中进行更改非常重要，所以如果你已经满足了那些你做得很好的要求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T16:04:40.610

对于我的团队来说，它在开发机器上的内存中，而在持续集成服务器上的真实数据库。

# functional-programming - 函数式编程有什么好处？

> ID：128057
> 
> 赞同：102
> 
> 时间：2008-09-24T16:03:25.277
> 
> 标签：functional-programming

你认为函数式编程的好处是什么？它们如何适用于今天的程序员？

函数式编程和 OOP 之间最大的区别是什么？

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-09-24T16:14:36.327

函数式编程的风格是描述你想要什么，而不是如何得到它。即：而不是创建一个带有迭代器变量的for循环并通过一个数组对每个单元格做一些事情，你会说相当于“这个标签是指这个数组的一个版本，这个函数已经在所有的元素。”

函数式编程将更多基本的编程思想转移到编译器中，例如列表推导和缓存等思想。

函数式编程的最大好处是简洁，因为代码可以更简洁。函数式程序不会创建迭代器变量作为循环的中心，因此可以从代码中消除这种和其他类型的开销。

另一个主要好处是并发性，这更容易通过函数式编程实现，因为编译器正在处理大多数过去需要手动设置状态变量的操作（如循环中的迭代器）。

在单处理器的上下文中也可以看到一些性能优势，这取决于程序的编写方式，因为大多数函数式语言和扩展都支持惰性求值。在 Haskell 中，你可以说“这个标签代表一个包含所有偶数的数组”。这样的数组无限大，但您可以随时请求该数组的第 100,000 个元素，而无需知道 - 在数组初始化时 - 您需要的最大值是多少。该值仅在您需要时计算，不再计算。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-24T16:16:53.653

最大的好处是它不是你习惯的。选择一门像 Scheme 这样的语言并学习用它解决问题，你将成为使用你已经知道的语言的更好的程序员。这就像学习第二人类语言。您假设其他人基本上是您自己的变体，因为您没有什么可以与之比较的。与他人接触，特别是与你已经知道的无关的，是有启发性的。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-05-23T18:29:55.057

**为什么函数式编程很重要**
[http://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf](http://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf)

> **抽象的**
> 
> 随着软件变得越来越复杂，良好的结构变得越来越重要。结构良好的软件易于编写和调试，并提供一组可重复使用的模块，以降低未来的编程成本。
> 
> 在本文中，我们展示了函数式语言的两个特性，特别是高阶函数和惰性求值，可以显着促进模块化。作为示例，我们操作列表和树，编写多种数值算法，并实现 alpha-beta 启发式（人工智能中用于游戏程序的算法）。我们得出结论，由于模块化是成功编程的关键，因此函数式编程为软件开发提供了重要优势。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-05-23T18:31:16.770

> 因此，一个好的起点是尝试理解一些在命令式语言中不可能但在函数式语言中可能的事情。

如果您在谈论可计算性，那么在函数式编程中当然没有什么是可能的但不是命令式编程（反之亦然）。

不同编程范式的重点不是让以前不可能的事情成为可能，而是让以前很难的事情变得容易。

函数式编程旨在让您更轻松地编写简洁、无错误和可并行化的程序。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-24T16:10:46.880

它不必是其中之一：使用像 C#3.0 这样的语言可以让您混合每种最好的元素。OO可用于类级及以上的大规模结构，Functional style用于方法级的小规模结构。

使用Functional风格可以写出明确表达意图的代码，而不会与控制流语句等混淆。由于无副作用编程等原则，更容易对代码进行推理，并检查其正确性.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-05-23T18:25:04.947

我认为需要函数式编程的最实际例子是并发性——函数式程序自然是线程安全的，并且考虑到多核硬件的兴起，这是极其重要的。

函数式编程还增加了模块化——你经常可以看到命令式的方法/函数太长——你几乎永远不会看到一个函数超过几行。而且由于一切都是解耦的 - 可重用性得到了很大改善，并且单元测试非常容易。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-08-10T20:40:55.930

一旦程序增长，我们词汇表中的命令数量就会变得过多，从而使其非常难以使用。这就是面向对象编程让我们的生活更轻松的地方，因为它允许我们以更好的方式组织命令。我们可以将所有涉及客户的命令与某个客户实体（一个类）相关联，这使得描述更加清晰。但是，该程序仍然是一系列命令，指定它应该如何进行。

函数式编程提供了一种完全不同的扩展词汇表的方式。不限于添加新的原始命令；我们还可以添加新的控制结构——指定如何将命令组合在一起以创建程序的原语。在命令式语言中，我们能够按顺序或使用有限数量的内置结构（例如循环）来编写命令，但是如果您查看典型的程序，您仍然会看到许多重复的结构；组合命令的常用方法

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-05-23T18:37:33.193

不要从“需要”的角度来考虑函数式编程。相反，将其视为另一种编程技术，就像 OOP、模板、汇编语言等在您学习它们时（如果）完全改变了您的思维方式一样，它会打开您的思维。最终，学习函数式编程会让你成为一个更好的程序员。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-19T04:59:48.043

如果您还不了解函数式编程，那么学习它可以为您提供更多解决问题的方法。

FP 是一种简单的泛化，将函数提升为一流的值，而 OOP 用于代码的大规模结构化。然而，存在一些重叠，其中 OOP 设计模式可以直接使用一流的函数更简洁地表示。

许多语言同时提供 FP 和 OOP，包括 OCaml、C# 3.0 和 F#。

干杯，乔恩·哈罗普。

# asp.net - 在 ASP.NET Repeater 中动态添加控件

> ID：128083
> 
> 赞同：6
> 
> 时间：2008-09-24T16:07:06.563
> 
> 标签：asp.net, controls, repeater

我发现我自己有一个转发器控件，它被数据绑定到一个 xml 文档。我的客户现在要求作为转发器的文本框可以是文本框或复选框。

我似乎找不到一种简单的方法来基本上执行以下操作：

```
if ((System.Xml.XmlNode)e.Item.DataItem.Attributes["type"] == "text")
<asp:TextBox runat="server" ID="txtField" Text='<%#((System.Xml.XmlNode)Container.DataItem).InnerText %>' CssClass="std"></asp:TextBox>
else
<asp:CheckBox runat="server" ID="txtField" Text='<%#((System.Xml.XmlNode)Container.DataItem).InnerText %>' CssClass="std"></asp:TextBox> 
```

有没有一种很好的方法可以扩展我当前的实现而不必重写逻辑。如果我可以通过“OnItemDataBound”注入控件也可以。但我似乎无法让它发挥作用

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T16:14:28.667

在您的转发器中，放置一个面板，然后为转发器的数据绑定事件创建一个事件处理程序，并以编程方式创建 TextBox 或 CheckBox 并将其添加为面板的子控件。您应该能够从事件 args 中获取 DataItem 以获取诸如“类型”属性或值之类的信息，以提供您的 Text 属性或 css 信息等。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T03:21:33.927

我会接受 mspmsp 的建议。这是一个快速而肮脏的代码作为示例：

把它放在你的 aspx 中：

```
<asp:Repeater ID="myRepeater" runat="server" OnItemCreated="myRepeater_ItemCreated">
    <ItemTemplate>
        <asp:PlaceHolder ID="myPlaceHolder1" runat="server"></asp:PlaceHolder>
        <br />
    </ItemTemplate>
</asp:Repeater> 
```

这在你的代码隐藏中：

```
dim plh as placeholder
dim uc as usercontrol
protected sub myRepeater_ItemCreated(object sender, RepeaterItemEventArgs e)
    if TypeOf e Is ListItemType.Item Or TypeOf e Is ListItemType.AlternatingItem Then
        plh = ctype(e.item.findcontrol("myPlaceHolder1"), Placeholder)
        uc = Page.LoadControl("~/usercontrols/myUserControl.ascx")
        plh.controls.add(uc)
    end if
end sub 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T16:09:57.773

在每个文本框和复选框控件中的标记中与此类似的内容如何？

> ```
> Visible=<%= Eval("type").tostring() == "text") %> 
> ```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-05-26T15:41:07.603

如果需要根据数据添加控件，那么可以使用这种方法：

```
<asp:Repeater ID="ItemsRepeater" runat="server" OnItemDataBound="ItemRepeater_ItemDataBound">
    <itemtemplate>
        <div>
            <asp:PlaceHolder ID="ItemControlPlaceholder" runat="server"></asp:PlaceHolder>
        </div>
    </itemtemplate>
</asp:Repeater> 
```

```
protected void ItemRepeater_ItemDataBound(object sender, RepeaterItemEventArgs e)
{
    var placeholder = e.Item.FindControl("ItemControlPlaceholder") as PlaceHolder;
    var col = (ItemData)e.Item.DataItem;

    placeholder.Controls.Add(new HiddenField { Value = col.Name });
    placeholder.Controls.Add(CreateControl(col));
} 
```

# .net - 如何为使用 winforms 的控制器类编写单元测试？

> ID：128086
> 
> 赞同：5
> 
> 时间：2008-09-24T16:07:20.617
> 
> 标签：.net, winforms, unit-testing, model-view-controller, mocking

有没有人能够成功地对必须耦合到 System.Windows.Forms.Form 类的方法进行单元测试？

我最近一直在开发 C# winforms 应用程序，尝试使用 MVC 结构构建它。这已经够难了，因为框架并没有真正考虑到这一点。

但是，当您将单元测试加入其中时，它会变得更加困难。我一直在确保我的控制器没有耦合到具体的视图类，以便我可以使用存根/模拟进行单元测试。**但是在某处**引用 Form 类是不可避免的，这些方法确实需要测试。

我一直在使用[Moq](http://code.google.com/p/moq/)，因为它有一些很好的类型安全特性，并且允许模拟具体类型。但不幸的是，它不允许我“期望”调用既不是虚拟也不是抽象的具体类型的方法或属性。而且由于 Form 类在构建时没有考虑到子类化，所以这是一个大问题。例如，我需要能够模拟 Form 类以防止创建真正的窗口，例如通过“预期”ShowDialog。

因此，我无法运行任何与 Form 的子类进行大量交互的单元测试，我的观点是。

有没有人成功地对这种类型的代码进行了单元测试？你是怎么做到的？

这是其他模拟框架可以解决的问题吗？其他模拟框架使用的基于字符串的方法是否会受到相同的约束？我可以编写自己的显式长手模拟类，还是缺少虚拟成员会阻止我也能够以这种方式抑制窗口行为？

或者是否有某种我没有想到的方法来构建我的类，以便表单耦合代码最终以简单复杂的方法和类结束，这样我就可以在不明确对它们进行单元测试的情况下逃脱，而不会被我的良心打败为了它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T16:16:52.280

我听说过/用于使用 GUI 元素进行单元测试的最佳方法是[Humble Dialog](http://www.objectmentor.com/resources/articles/TheHumbleDialogBox.pdf)模式/方法。本质上，Forms 只是接口，所有真正的工作都在其他类中完成。您对提供功能的类进行单元测试，然后将您的 GUI 事件与这些类中的适当方法联系起来。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T16:13:14.020

我目前的想法是我可能必须使用组合而不是继承 Form 类，以将控制器与它分离。

这样做的缺点是每次我需要使用我没有计划的 Form 类的成员时，我都需要将它显式添加到我的视图界面中。

# java - 确定表单项的索引 (J2ME)

> ID：128103
> 
> 赞同：0
> 
> 时间：2008-09-24T16:10:25.557
> 
> 标签：java, java-me, lcdui

给定`Item`已附加到 a 的 a `Form`，找出该项目在表单上的索引的最佳方法是什么？

`Form.append(Item)`会给我最初添加的索引，但如果我稍后在此之前插入项目，索引将不同步。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T16:58:47.127

这是我能想到的最好的：

```
private int getItemIndex(Item item, Form form) {
    for(int i = 0, size = form.size(); i < size; i++) {
        if(form.get(i).equals(item)) {
            return i;
        }
    }
    return -1;
} 
```

我还没有实际测试过这个，但它应该可以工作，我只是不喜欢枚举每个项目，但不应该有那么多，所以我想它没问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T11:38:52.840

好吧，只有两种方法可以做到这一点，因为 API 没有`indexOf(Item)`方法：

1.  添加`Item`. 因此，当您在其他项目之前插入另一个时`Item`，您必须更新这些项目的索引。你可以为此保留某种影子阵列，但这似乎有点过头了。
2.  `size`使用 的和`get`方法遍历表单的所有项目`Form`。

# function - 您如何在 VBA 中找到闰年？

> ID：128104
> 
> 赞同：13
> 
> 时间：2008-09-24T16:10:30.843
> 
> 标签：function, vba, excel, code-snippets

什么是 VBA 中 IsLeapYear 函数的良好实现？

**编辑：**我运行 if-then 和 DateSerial 实现，迭代包含在计时器中，DateSerial 平均快了 1-2 毫秒（5 次运行 300 次迭代，1 个平均单元格工作表公式也有效）。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-24T16:10:43.857

```
Public Function isLeapYear(Yr As Integer) As Boolean  

    ' returns FALSE if not Leap Year, TRUE if Leap Year  

    isLeapYear = (Month(DateSerial(Yr, 2, 29)) = 2)  

End Function 
```

我最初是从 Chip Pearson 的 Excel 网站获得这个功能的。

[皮尔逊的网站](http://www.cpearson.com/excel/MainPage.aspx)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-24T16:16:09.943

```
public function isLeapYear (yr as integer) as boolean
    isLeapYear   = false
    if (mod(yr,400)) = 0 then isLeapYear  = true
    elseif (mod(yr,100)) = 0 then isLeapYear  = false
    elseif (mod(yr,4)) = 0 then isLeapYear  = true
end function 
```

维基百科了解更多... [http://en.wikipedia.org/wiki/Leap_year](http://en.wikipedia.org/wiki/Leap_year)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T21:28:55.183

如果效率是一个考虑因素并且预期年份是随机的，那么先做最常见的情况可能会稍微好一些：

```
public function isLeapYear (yr as integer) as boolean
    if (mod(yr,4)) <> 0 then isLeapYear  = false
    elseif (mod(yr,400)) = 0 then isLeapYear  = true
    elseif (mod(yr,100)) = 0 then isLeapYear  = false
    else isLeapYear = true
end function 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T00:50:08.927

[我在CodeToad](http://www.codetoad.com/vb_leap_year.asp)上发现了这个有趣的：

```
Public Function IsLeapYear(Year As Varient) As Boolean
  IsLeapYear = IsDate("29-Feb-" & Year)
End Function 
```

虽然我很确定在函数中使用 IsDate 可能比几个 if、elseif 慢。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-08-08T05:15:28.440

作为 Chip Pearson 解决方案的一种变体，您也可以尝试

```
Public Function isLeapYear(Yr As Integer) As Boolean  

  ' returns FALSE if not Leap Year, TRUE if Leap Year  

  isLeapYear = (DAY(DateSerial(Yr, 3, 0)) = 29)  

End Function 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-06-05T04:28:51.683

解决性能问题的迟到答案。

TL/DR：**数学**版本**快 5 倍左右**

* * *

我在这里看到两组答案

1.  闰年定义的数学解释
2.  利用 Excel 日期/时间函数来检测 2 月 29 日（这些分为两个阵营：将日期构建为字符串的阵营，以及不将日期构建为字符串的阵营）

我对所有发布的答案进行了时间测试，发现**数学**方法比日期/时间方法快约**5 倍。**

* * *

然后我对方法进行了一些优化并想出了（信不信由你 `Integer`比`Long`在这种情况下要快一点，不知道为什么。）

```
Function IsLeapYear1(Y As Integer) As Boolean
    If Y Mod 4 Then Exit Function
    If Y Mod 100 Then
    ElseIf Y Mod 400 Then Exit Function
    End If
    IsLeapYear1 = True
End Function 
```

为了比较，我想出了（与发布的版本几乎没有区别）

```
Public Function IsLeapYear2(yr As Integer) As Boolean
    IsLeapYear2 = Month(DateSerial(yr, 2, 29)) = 2
End Function 
```

将日期构建为字符串的日期/时间版本被打折，因为它们再次慢得多。

测试是获得`IsLeapYear`100..9999 年，重复 1000 次

**结果**

*   数学版本：640ms
*   日期/时间版本：3360ms

* * *

测试代码是

```
Sub Test()
    Dim n As Long, i As Integer, j As Long
    Dim d As Long
    Dim t1 As Single, t2 As Single
    Dim b As Boolean

    n = 1000

    Debug.Print "============================="
    t1 = Timer()
    For j = 1 To n
    For i = 100 To 9999
        b = IsYLeapYear1(i)
    Next i, j
    t2 = Timer()
    Debug.Print 1, (t2 - t1) * 1000

    t1 = Timer()
    For j = 1 To n
    For i = 100 To 9999
        b = IsLeapYear2(i)
    Next i, j
    t2 = Timer()
    Debug.Print 2, (t2 - t1) * 1000
End Sub 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-28T15:30:34.270

```
Public Function ISLeapYear(Y As Integer) AS Boolean
 ' Uses a 2 or 4 digit year
'To determine whether a year is a leap year, follow these steps:
'1    If the year is evenly divisible by 4, go to step 2\. Otherwise, go to step 5.
'2    If the year is evenly divisible by 100, go to step 3\. Otherwise, go to step 4.
'3    If the year is evenly divisible by 400, go to step 4\. Otherwise, go to step 5.
'4    The year is a leap year (it has 366 days).
'5    The year is not a leap year (it has 365 days).

If Y Mod 4 = 0 Then ' This is Step 1 either goto step 2 else step 5
    If Y Mod 100 = 0 Then ' This is Step 2 either goto step 3 else step 4
        If Y Mod 400 = 0 Then ' This is Step 3 either goto step 4 else step 5
            ISLeapYear = True ' This is Step 4 from step 3
                Exit Function
        Else: ISLeapYear = False ' This is Step 5 from step 3
                Exit Function
        End If
    Else: ISLeapYear = True ' This is Step 4 from Step 2
            Exit Function
    End If
Else: ISLeapYear = False ' This is Step 5 from Step 1
End If

End Function 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-08-19T06:13:21.010

```
Public Function isLeapYear(Optional intYear As Variant) As Boolean

    If IsMissing(intYear) Then
        intYear = Year(Date)
    End If

    If intYear Mod 400 = 0 Then
        isLeapYear = True
    ElseIf intYear Mod 4 = 0 And intYear Mod 100 <> 0 Then
        isLeapYear = True
    End If

End Function 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-04-13T02:54:25.453

我看到许多伟大的概念表明对日期函数的额外理解和使用非常值得学习......在代码效率方面......考虑执行函数所需的机器代码

而不是复杂的日期函数只使用相当快的整数函数 BASIC 是建立在 GOTO 上的 我怀疑像下面这样的东西更快

```
 Function IsYLeapYear(Y%) As Boolean
     If Y Mod 4 <> 0 Then GoTo NoLY ' get rid of 75% of them
     If Y Mod 400 <> 0 And Y Mod 100 = 0 Then GoTo NoLY
     IsYLeapYear = True 
```

没有：

```
 End Function 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-11-19T16:10:50.513

这是另一个简单的选择。

```
Leap_Day_Check = Day(DateValue("01/03/" & Required_Year) - 1) 
```

如果 Leap_Day_Check = 28 则不是闰年，如果是 29 则是闰年。

VBA 知道 3 月 1 日之前的日期是一年中的日期，因此我们会将其设置为 2 月 28 日或 29 日。

# windows - 汇编器文件作为使用 WDK 工具构建驱动程序的输入

> ID：128120
> 
> 赞同：7
> 
> 时间：2008-09-24T16:13:46.313
> 
> 标签：windows, assembly, build, driver, wdk

如何获取要编译并链接到驱动程序构建的汇编程序文件。

澄清一点

源文件：

```
TARGETTYPE=DRIVER
DRIVERTYPE=WDM
TARGETPATH=obj

TARGETNAME=bla

INCLUDES=$(DDK_INC_PATH)
TARGETLIBS=$(DDK_LIB_PATH)\ks.lib

SOURCES=x.cpp y.cpp z.asm 
```

问题出现在`z.asm file`. `NMAKE`抱怨它不知道如何构建`z.obj`。

所以问题是，如何将 asm 文件组装`build`并链接到`bla.sys`.

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-24T17:25:44.987

你试过 I386_SOURCES 吗？

例如

```
SOURCES=x.cpp y.cpp
I386_SOURCES=i386\z.asm 
```

并将文件放在 i386 目录中。
另请参阅有关 SOURCES 宏的[MSDN](http://msdn.microsoft.com/en-us/library/ms792148.aspx)

# sql-server - SQL Server 2005 中的“创建统计信息”有什么作用？

> ID：128129
> 
> 赞同：43
> 
> 时间：2008-09-24T16:14:59.070
> 
> 标签：sql-server, tsql, statistics, database-tuning-advisor

数据库优化顾问建议我在我的数据库中创建一堆统计信息。我有点像 SQL n00b，所以这是我第一次遇到这样的生物。MSDN 中的条目有点迟钝 - 有人可以解释一下这到底是做什么的，为什么这是一个好主意？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-24T16:58:53.927

[基于成本的查询优化](http://en.wikipedia.org/wiki/Query_optimizer)是一种使用直方图和行数来启发式估计执行查询计划的成本的技术。当您向 SQL Server 提交查询时，它会对其进行评估并生成一系列[查询计划](http://en.wikipedia.org/wiki/Query_plan)，并使用启发式方法来估算成本。然后它选择最便宜的查询计划。

查询优化器使用统计信息来计算查询计划的成本。如果统计数据丢失或过时，则没有正确的数据来估计计划。在这种情况下，它可以生成中等或高度次优的查询计划。

SQL Server 将（在大多数情况下）自动生成大多数表和索引的统计信息，但您可以补充这些信息或强制刷新。查询调优向导可能在查询中发现了一些缺失的统计信息或识别出应该为其添加统计信息的连接。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T16:21:44.343

优化器使用统计信息来确定是否为您的查询使用特定索引。如果没有统计信息，优化器无法知道有多少行将匹配给定条件，导致它必须针对“多行”情况进行优化，这可能不是最优的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T16:16:12.563

简而言之，它使您的数据库准备好有效工作。通过准备好统计数据，您的数据库（在它需要计算出执行计划之前）知道什么可能是其最有效的路线。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T16:16:15.853

基本上只是用你拥有的索引类型、行数等来更新 SQL。这有助于 SQL 更好地估计如何执行你的查询。保持统计数据更新是一件好事。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T16:16:18.677

从 BOL...

> 在提供的列或表或索引视图的列集上创建直方图和关联的密度组（集合）。字符串摘要统计信息还基于 char、varchar、varchar(max)、nchar、nvarchar、nvarchar(max)、text 和 ntext 列构建的统计信息创建。查询优化器使用此统计信息来选择最有效的计划来检索或更新数据。最新的统计数据使优化器能够准确评估不同查询计划的成本，并选择一个高质量的计划。

# pdf - PDF 中的 Unicode

> ID：128162
> 
> 赞同：36
> 
> 时间：2008-09-24T16:19:35.673
> 
> 标签：pdf, unicode, utf-8, pdf-generation

我的程序根据要求生成相对简单的 PDF 文档，但是我遇到了 unicode 字符的问题，比如汉字或奇怪的数学符号。要在 PDF 中编写普通字符串，请将其放在括号中：

```
(something) 
```

还可以选择使用八进制代码转义字符：

```
(\527) 
```

但这最多只能包含 512 个字符。你如何编码或转义更高的字符？我看过对字节流和十六进制编码字符串的引用，但我读过的所有引用似乎都不愿意告诉我如何实际去做。

* * *

**编辑：**或者，给我指出一个很好的 Java PDF 库，它将为我完成这项工作。我目前使用的是 gnujpdf 的一个版本（我已经修复了几个错误，因为原作者似乎已经离开了），它允许您针对 AWT 图形界面进行编程，理想情况下任何替换都应该这样做相同。

替代方案似乎是 HTML -> PDF，或基于段落和框的编程模型，感觉非常像 HTML。iText 是后者的一个例子。这意味着重写我现有的代码，我不相信他们会给我同样的布局灵活性。

* * *

**编辑 2：**我之前没有意识到，但是 iText 库有一个 Graphics2D API，并且似乎可以完美地处理 unicode，所以这就是我将要使用的。虽然这不是问题的答案，但它为我解决了问题。

* * *

**编辑 3：** iText 对我来说工作得很好。我想教训是，当面对看似毫无意义的困难时，寻找比你更了解它的人。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-02T15:39:12.637

在第 3 章的 PDF 参考中，这是他们对 Unicode 的评价：

> 文本字符串以 PDFDocEncoding 或 Unicode 字符编码进行编码。PDFDocEncoding 是 ISO Latin 1 编码的超集，并记录在附录 D 中。Unicode 联盟在 Unicode 标准中描述了 Unicode（参见参考书目）。对于以 Unicode 编码的文本字符串，前两个字节必须是 254，后跟 255。这两个字节代表 Unicode 字节顺序标记，U+FEFF，表示该字符串采用 UTF-16BE（big-endian）编码方案进行编码在 Unicode 标准中指定。（此机制排除了使用 PDFDocEncoding 以两个字符 thorn ydieresis 开头的字符串，这不太可能是一个词或短语的有意义的开头）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-27T14:28:03.880

简单的答案是没有简单的答案。如果你看一下 PDF 规范，你会看到一整章——而且其中有一章很长——专门讨论文本显示的机制。我为我的公司实现了所有的 PDF 支持，而处理文本是迄今为止最复杂的练习部分。您发现的解决方案 - 使用 3rd 方库为您完成工作 - 确实是最佳选择，除非您对 PDF 文件有非常具体的特殊用途要求。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2016-04-24T07:03:33.443

Algoman 的回答在很多方面都是**错误的。**您**可以**制作包含 Unicode 的 PDF 文档，这不是火箭科学，尽管它需要一些工作。是的，他是对的，要在一种字体中使用超过 255 个字符，您必须创建一个复合字体 (CIDFont) pdf 对象。然后，您只需提及要用作 CIDFont 的 DescendatFont 条目的实际 TrueType 字体。诀窍是在那之后你必须使用字体的**字形索引**而不是字符代码。要获取此索引映射，您必须解析`cmap`字体的部分 - 使用函数获取字体的内容`GetFontData`并掌握 TTF 规范。就是这样！我刚刚做了，现在我有了一个 Unicode PDF！

解析部分的示例代码`cmap`在这里： https://web.archive.org/web/20150329005245/http: [//support.microsoft.com/en-us/kb/241020](https://web.archive.org/web/20150329005245/http://support.microsoft.com/en-us/kb/241020)

是的，不要忘记@user2373071 指出的/ToUnicode 条目，否则用户将无法搜索您的PDF 或从中复制文本。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-08-17T22:57:00.170

正如dredkin 指出的那样，您必须在页面内容流中使用字形索引而不是Unicode 字符值。这足以在 PDF 中显示 Unicode 文本，但无法搜索 Unicode 文本。要使文本可搜索或对其进行复制/粘贴，您还需要包含 /ToUnicode 流。此流应将文档中的每个字形转换为实际的 Unicode 字符。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-02T15:31:06.150

请参阅 PDF 规范的附录 D（第 995 页）。PDF 消费者应用程序中预定义的字体和字符集数量有限。要显示其他字符，您需要嵌入包含它们的字体。为了减小文件大小，最好只嵌入字体的一个子集，包括只需要的字符。我也在努力在 PDF 中显示 Unicode 字符，这很麻烦。

查看 PDFBox 或 iText。

[http://www.adobe.com/devnet/pdf/pdf_reference.html](http://www.adobe.com/devnet/pdf/pdf_reference.html)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-08-05T11:23:22.197

我现在已经在这个主题上工作了几天，我了解到 unicode 在 pdf 中是（同样好）不可能的。使用 2 字节字符的底座描述的方式仅适用于 CID 字体。

看起来，CID-Fonts 是一个 pdf 内部结构，在这个意义上它们并不是真正的字体 - 它们似乎更像是图形子例程，可以通过寻址它们（使用 16 位地址）来调用。

**所以直接**在pdf中使用unicode

 **1.  您必须将普通字体转换为 CID-Fonts，这可能非常困难 - 您必须从原始字体（？）生成图形例程，提取字符度量等。
2.  你不能像普通字体一样使用 CID-Fonts - 你不能像加载和缩放普通字体一样加载或缩放它们
3.  此外，2 字节字符甚至无法覆盖完整的 Unicode 空间

恕我直言，这些点使得**直接**使用 unicode 绝对不可行。

* * *

* * *

我现在正在做的是通过以下方式**间接**使用字符：对于每种字体，我生成一个代码页（和一个用于快速查找的查找表） - 在 c++ 中，这类似于

```
std::map<std::string, std::vector<wchar_t> > Codepage;
std::map<std::string, std::map<wchar_t, int> > LookupTable; 
```

然后，每当我想在页面上放置一些 unicode 字符串时，我都会迭代它的字符，在查找表中查找它们 - 如果它们是新的，我将它们添加到代码页中，如下所示：

```
for(std::wstring::const_iterator i = str.begin(); i != str.end(); i++)
{                
    if(LookupTable[fontname].find(*i) == LookupTable[fontname].end())
    {
        LookupTable[fontname][*i] = Codepage[fontname].size();
        Codepage[fontname].push_back(*i);
    }
} 
```

然后，我生成一个新字符串，其中原始字符串中的字符被替换为它们在代码页中的位置，如下所示：

```
static std::string hex = "0123456789ABCDEF";
std::string result = "<";
for(std::wstring::const_iterator i = str.begin(); i != str.end(); i++)
{                
    int id = LookupTable[fontname][*i] + 1;
    result += hex[(id & 0x00F0) >> 4];
    result += hex[(id & 0x000F)];
}
result += ">"; 
```

例如，“你好世界！” 可能会变成 <01020303040506040703080905> ，现在您可以像往常一样使用 Tj 运算符将该字符串放入 pdf 并打印...

但是你现在有一个问题：pdf 不知道你的意思是 01 的“H”。要解决这个问题，你还必须在 pdf 文件中包含代码页。这是通过向 Font 对象添加**/Encoding**并设置其**差异来完成的**

为了“你好世界！” 例如，这个 Font-Object 可以工作：

```
5 0 obj 
<<
    /F1
    <<
        /Type /Font
        /Subtype /Type1
        /BaseFont /Times-Roman
        /Encoding
        <<
          /Type /Encoding
          /Differences [ 1 /H /Euro /l /o /space /W /r /d /exclam ]
        >>
    >> 
>>
endobj 
```

我用这段代码生成它：

```
ObjectOffsets.push_back(stream->tellp()); // xrefs entry
(*stream) << ObjectCounter++ << " 0 obj \n<<\n";
int fontid = 1;
for(std::list<std::string>::iterator i = Fonts.begin(); i != Fonts.end(); i++)
{
    (*stream) << "  /F" << fontid++ << " << /Type /Font /Subtype /Type1 /BaseFont /" << *i;

    (*stream) << " /Encoding << /Type /Encoding /Differences [ 1 \n";
    for(std::vector<wchar_t>::iterator j = Codepage[*i].begin(); j != Codepage[*i].end(); j++)
        (*stream) << "    /" << GlyphName(*j) << "\n";
    (*stream) << "  ] >>";

    (*stream) << " >> \n";
}
(*stream) << ">>\n";
(*stream) << "endobj \n\n"; 
```

*请注意，我使用了一个全局字体寄存器——我在整个 pdf 文档中使用了相同的字体名称 /F1、/F2、...。**所有页面的/Resources**条目中都引用了相同的 font-register 对象。如果您以不同的方式执行此操作（例如，您每页使用一个字体寄存器） - 您可能必须根据您的情况调整代码......*

那么如何找到字形的名称（/Euro 表示“€”，/exclam 表示“！”等）？在上面的代码中，这是通过简单地调用“GlyphName(*j)”来完成的。我已经用 BASH 脚本从列表中找到了这个方法

[http://www.jdawiseman.com/papers/trivia/character-entities.html](http://www.jdawiseman.com/papers/trivia/character-entities.html)

它看起来像这样

```
const std::string GlyphName(wchar_t UnicodeCodepoint)
{
    switch(UnicodeCodepoint)
    {
        case 0x00A0: return "nonbreakingspace";
        case 0x00A1: return "exclamdown";
        case 0x00A2: return "cent";
        ...
    }
} 
```

我没有解决的一个**主要问题是，这****仅在您使用最多 254 个**来自同一字体的不同字符时才有效。要使用超过 254 个不同的字符，您必须为相同的字体创建多个代码页。

在 pdf 中，不同的代码页由不同的字体表示，因此要在代码页之间切换，您必须切换字体，理论上这可能会使您的 pdf 文件炸毁很多，但我可以忍受...

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-24T16:57:31.840

我不是 PDF 专家，而且（正如 Ferruccio 所说）Adobe 的 PDF 规范应该告诉你一切，但我的脑海中突然冒出一个想法：

您确定您使用的字体支持您需要的所有字符吗？

在我们的应用程序中，我们从 HTML 页面（使用第三方库）创建 PDF，我们遇到了西里尔字符的问题......

# sql - 用于压缩和传输数据库备份文件的示例 sql 脚本

> ID：128166
> 
> 赞同：5
> 
> 时间：2008-09-24T16:20:14.673
> 
> 标签：sql, database, copy, zip, maintenance

我正在寻找一个示例 sql 脚本来压缩我的数据库备份文件 (.bak) 并传输到远程位置。如果你随身携带，请分享。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T16:22:32.437

您可以使用[xp_cmdshell](http://msdn.microsoft.com/en-us/library/aa260689(SQL.80).aspx)调用压缩和复制命令。在此处的示例中，我使用 winzip 命令行（用于压缩/解压缩）和 xcopy 用于传输文件。

```
EXEC master..xp_cmdshell 'C:\"Program Files"\WinZip\wzzip C:\Database.bak.zip C:\Database.bak';
EXEC master..xp_cmdshell 'C:\"Program Files"\WinZip\wzunzip -o "C:\Database.bak.zip" "C:\Database"';
EXEC master..xp_cmdshell 'xcopy "C:\Database.bak.zip" "\\networkshare\Backups" /Y' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-24T01:39:17.070

xp_cmdshell 是一种方法，尽管它并不理想，因为启用它会使服务器的安全性降低。

我的开源项目[SQL Server Compressed Backup](https://sourceforge.net/projects/mssqlcompressed/)可以一步完成您想要的：

```
msbp.exe backup "db(database=model)" "zip64" "local(path=\\server\share\path\model.full.bak.zip)" 
```

SQL Server 压缩备份的安装只是“xcopy”部署——无需安装/卸载，如果您只需要这样做一次，这是理想的选择。

它使用 zip64，因为标准 zip 格式有 4 GB 的限制。可用的替代压缩格式是 gzip 和 bzip2，它们没有限制。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-09T09:25:21.393

为什么不使用像[SqlBackupAndFtp](http://sqlbackupandftp.com)这样简单的工具呢？它们通过简单的界面完全满足您的需求（sql 备份 + 移动到远程位置），您无需编写任何脚本。

# asp.net - 从 SQL Server 2000 错误中检索错误文本

> ID：128190
> 
> 赞同：0
> 
> 时间：2008-09-24T16:22:52.890
> 
> 标签：asp.net, sql-server, error-handling

我需要帮助在 SQL Server 2000 中记录来自 T-SQL 的错误。我们需要记录我们捕获的错误，但是在获取与我们在 SQL Server Management Studio 前面会得到的相同信息时遇到了麻烦。

我可以在没有任何参数替换的情况下收到这样的消息：

```
SELECT MSG.description from master.dbo.sysmessages MSG
INNER JOIN sys.syslanguages LANG ON MSG.msglangID=LANG.msglangid
WHERE MSG.error=@err AND LANG.langid=@@LANGID 
```

但我还没有找到任何找出错误参数的方法。我想看看：

表 MYTABLE7 上的约束违反 MYCONSTRAINT2

不是

表 %s 上的约束违反 %s

谷歌搜索只发现了使用 DBCC OUTPUTBUFFER 的奇异方案，这些方案需要管理员访问权限并且不适合生产代码。如何获得带有参数替换的错误消息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T16:38:13.493

在 .Net 中，从 sql server 检索错误消息（以及*print*或*raiserror的任何输出）就像在 SqlConnection (* *.FireInfoMessageEventOnUserErrors = True* )上设置一个属性并处理连接的 InfoMessage 事件一样简单。.Net 接收的数据与您在 SQL Server Management Studio 结果网格的“*消息*”窗口中获得的数据相匹配。

所有代码都在处理事件的函数中，您可以将其抽象化，以便所有连接都指向同一个方法，因此除了创建时的两行代码外，应用程序的其余部分没有任何其他更改设置属性和事件的新连接（*你已经把它抽象出来了，所以你只需要在一个地方做，对吧？*）

这是我认为[SQL Server 的权威错误指南](http://www.sommarskog.se/error-handling-I.html)的链接。
[http://www.sommarskog.se/error-handling-I.html](http://www.sommarskog.se/error-handling-I.html)

在某些情况下，即使发生错误，SQL Server 也会继续处理。*[请参阅标有“发生错误时会发生什么](http://www.sommarskog.se/error-handling-I.html#whathappens)*”的标题？从上一个链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T17:09:56.070

在在线书籍中查找 Raiserror（已描述）

您会发现语法如下所示：

```
RAISERROR ( { msg_id | msg_str } { , severity , state } 
    [ , argument [ ,...n ] ] ) 
    [ WITH option [ ,...n ] ] 
```

错误参数如下：

```
d or I Signed integer 
o Unsigned octal 
p Pointer 
s String 
u Unsigned integer 
x or X Unsigned hexadecimal 
```

从 VB 开始的任何语言都有能力捕捉这些并让您采取适当的行动。

戴夫·J

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-08T04:37:58.003

[FORMATMESSAGE](http://msdn.microsoft.com/en-us/library/ms186788(SQL.90).aspx)（它也存在于 SQL Server 2000 中）允许您从上述 sysmessages 模板将消息构建为最终格式。

但是，RAISERROR 命令（当您遇到错误时，这几乎是数据库引擎本身在内部调用的内容）已经发送了完整的文本，这些文本可以被捕获并记录在客户端中。SSMS 是一个客户端，不会生成它自己的消息：所有消息都来自数据库引擎。

但是，我认为您想使用 T-SQL 记录 T-SQL 错误。坦率地说，你不能在 SQL Server 2000 上。太多的错误是批处理和范围中止，无法可靠地记录任何内容。

您必须在 SQL Server 2005 上才能使用 TRY/CATCH/ERROR_MESSAGE，或者您在客户端中捕获，然后使用类似 log4net 的东西重新登录到 SQL Server。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T16:25:22.963

您有可能很快升级到 SQL2005 吗？如果是这样，您可能可以利用他们的 TRY/CATCH 模型来更轻松地完成您想要做的事情。

catch 中公开的变量可以为您提供引发错误的对象、行号、错误消息、严重性等。从那里，您可以记录它、发送电子邮件等。

# c# - 在 DataGridView 中嵌入非编辑小部件

> ID：128203
> 
> 赞同：1
> 
> 时间：2008-09-24T16:25:36.753
> 
> 标签：c#, visual-studio, user-interface

当它不处于编辑模式时，有什么方法可以将小部件嵌入数据绑定的*DataGridViewCell中？*

例如，我们希望在单元格中显示现有的日历小部件。该单元格包含一个逗号分隔的日期列表。我们想显示日历而不是文本。

我们可以创建一个自定义单元格并覆盖*Draw*方法，以便它在单元格中绘制日历，但这不会处理我们在现有日历小部件中已有的鼠标悬停工具提示。

[更新] 我尝试了 TcKs 的建议，但无法创建有效的解决方案。请参阅有关该答案的评论。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T08:21:35.597

[您应该从DataGridViewColumn](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewcolumn.aspx)派生您自己的类型（例如*DataGridViewCalendarColumn*）并返回一个*DataGridViewCalendarCell*（您也必须自己创建）作为 CellTemplate。
详细描述可以在 MSDN 文章[Build a Custom RadioButton Cell and Column for the DataGridView 控件中找到](http://msdn.microsoft.com/en-us/library/aa730882.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T16:36:44.900

您可以不绘制日历，而是使用日历控件，将网格设置为父级，并将它们设置为与单元格相同的边界（左、上、宽、高）。

# c++ - 在 Windows 中使用事件进行调试

> ID：128217
> 
> 赞同：1
> 
> 时间：2008-09-24T16:29:15.387
> 
> 标签：c++, c, windows, multithreading, visual-studio

如果我在 Windows 中使用创建事件`CreateEvent`，如何使用 Visual Studio 中的调试器检查该事件是否已发出信号？ `CreateEvent`返回一个句柄，它不会让我访问太多信息。在调用之前`WaitForSingleObject()`，我想在进入函数之前检查是否已发出事件信号。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T16:44:20.827

You can use the Process Explorer tool ([http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)) to manually check the event outside of the debugger. It helps if the event is named, so that you can find it easier.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T03:58:52.700

使用句柄命令。这是一个示例

以下命令显示有关句柄 0x8 的详细信息。

```
0:000> !handle 8 f 
```

句柄 8 类型事件属性 0 GrantedAccess 0x100003：同步 QueryState,ModifyState HandleCount 2 PointerCount 3 名称对象特定信息 事件类型 自动重置 事件正在等待

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T16:31:25.427

如果事件发出信号并且您使用 WaitForSingleObject()，它将立即返回。此外，您可以调用等待时间为 0 的 WaitForSingleObject() 来确定是否发出信号。但是，这不是必需的——在 CreateEvent() 调用中设置初始状态（到目前为止，您的问题尚不清楚）。

# oracle - 如何在 SQL*PLUS 中定义持久变量

> ID：128232
> 
> 赞同：0
> 
> 时间：2008-09-24T16:33:01.757
> 
> 标签：oracle, plsql

我正在尝试`SQL*PLUS`在`ORACLE`.

*   创建变量
*   将其作为输出变量传递给我的方法调用
*   打印输出变量的值

我明白了

> *未声明的变量*

错误。我正在尝试创建一个在会话中持续存在的变量，直到我关闭`SQL*PLUS`窗口。

```
variable subhandle number;
exec MYMETHOD - (CHANGE_SET => 'SYNC_SET', - DESCRIPTION => 'Change data for emp', 
                                           - SUBSCRIPTION_HANDLE => :subhandle);

print subhandle; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T16:42:59.720

It should be OK - check what you did carefully against this:

```
SQL> create procedure myproc (p1 out number)
  2  is
  3  begin
  4     p1 := 42;
  5  end;
  6  /

Procedure created.

SQL> variable subhandle number
SQL> exec myproc(:subhandle)

PL/SQL procedure successfully completed.

SQL> print subhandle

 SUBHANDLE
----------
        42 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T16:41:07.153

Please can you re-post, but formatting the code with the code tag.... (ie the 101 010 button) I think some extra "-" characters came through which means it more difficult to interpret.

Might also be helpful to see SQL*Plus reporting the error if you could copy the contents of the SQL*Plus window instead/too?

But it looks correct.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T17:59:02.853

我不确定这是否是您要查找的内容，但是您尝试过`&&variable`语法吗？你可以做

```
select &&subhandle from dual 
```

或脚本开头的一些类似的东西，那么`subhandle`应该在会话的其余部分绑定到该值。

# image - 在运行时动态更改 Crystal Report 中的图像

> ID：128239
> 
> 赞同：13
> 
> 时间：2008-09-24T16:36:06.010
> 
> 标签：image, crystal-reports, report

我正在使用VisualStudio 2005 中包含的Crystal Reports。我想通过构建图像文件的路径来更改运行时显示在报表上的图像，然后将该图像显示在报表上。

有没有人能用这个版本的 Crystal Reports 做到这一点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-21T03:45:50.787

在工作中，我们通过将图像作为数据表的字段推送到报告中来做到这一点。它不漂亮，但它完成了工作。当然，此解决方案要求您通过 DataSet 将数据推送到报表中。我一直觉得这充其量只是一个hack。我真的希望图像参数是 CR 的可能性。

**编辑：**值得注意的是，如果您将水晶报表绑定到普通旧对象，您希望为报表公开一个 byte[] 属性以将其视为图像。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T22:36:57.157

我也有这个问题（并投了你的票）！

[我已经通过 C# Object 属性找到了使用字节数组的解决方案 - 请参阅单独的答案。将此答案留在这里以供参考...]

这是我看到的建议（但我在 C#-2005 和 C#-2008 中都尝试过但失败了）。

1.  选择一个目录并在其中放置一个 BMP（例如，“C:\Temp\image.bmp”）。
2.  从 CR-Designer a) 右键单击​​->插入->OLE 对象... b) 选择“从文件创建” c) 选中“链接”复选框 d) 浏览并选择在步骤 1 中定义的 bmp e) 单击好的 f) 将图像放在表格上。
3.  在 C# 代码中在运行时覆盖/更新图像。理论上，由于您插入了指向图像文件的***链接***，因此刷新表单时会更新它。

我对这种方法没有运气。当我第一次设计表单时出现图像（第 2 步）。但在运行时，图像不会为我更新。从这一点开始，***事情变得非常奇怪***。似乎 CR 缓存了某种不会消失的图像。我可以在 CR-Designer 中删除 OLE 对象链接，但如果我重新创建它，我总是会得到一个与原始图像大小相同的黑框（即使我更改了 image.bmp 的大小）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-24T16:30:09.847

我终于使用`byte[]`Josh 在此处发布的提示找到了解决方案。

如果您使用普通的旧 C# 对象来填充 Crystal Reports，则此解决方案适用（请参阅[http://www.aspfree.com/c/a/C-Sharp/Crystal-Reports-for-Visual-Studio-2005-in -CSharp/](http://www.aspfree.com/c/a/C-Sharp/Crystal-Reports-for-Visual-Studio-2005-in-CSharp/)有关此方法的信息）。

在您的 C# 类中，插入以下代码：

```
private static byte[] m_Bitmap = null;

public byte[] Bitmap
{
   get
   {
      FileStream fs = new FileStream(bitmapPath, FileMode.Open);
      BinaryReader br = new BinaryReader(fs);
      int length = (int)br.BaseStream.Length;
      m_Bitmap = new byte[length];
      m_Bitmap = br.ReadBytes(length);
      br.Close();
      fs.Close();
      return m_Bitmap;
   }
} 
```

现在，使用“验证数据库”选项更新 CR 中的 C# 对象映射。然后，您应该将该`Bitmap`属性视为 CR 字段。只需将其拖到表单上即可。它将是 IBlobFieldObject 类型。当你运行时，你应该看到你的图像。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T17:27:17.227

尝试结合使用包含图像路径的参数和此页面上的教程：[http ://www.idautomation.com/crystal/streaming_crystal.html](http://www.idautomation.com/crystal/streaming_crystal.html)

然后在步骤 #8 中，使用参数而不是硬编码路径。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-15T20:23:18.543

您还可以使用条件公式来设置图像的位置。请参阅[Crystal Reports：动态图像](http://cogniza.com/wordpress/2010/03/15/crystal-reports-dynamic-images/)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-04-28T12:29:13.723

我发现另一个有用的选项是插入您想要使用的图片。相应地定位图形，然后右键单击图形并转到设置图形格式 > 通用。选中 Suppress 框，然后单击公式按钮，如 x-2 所示。进入公式窗口后，只需添加代码以确定是否应隐藏图形。

就我而言，我正在为多个实体构建一个发票模板。在公式窗口中，我只写了 COMPANY <> 1100，这意味着每次为 1100 以外的公司运行发票时，1100 图形都会被隐藏。

希望这能让生活更轻松......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-11-20T16:35:37.467

我在 Visual Studio 2015 中使用的当前版本的 Crystal Reports（适用于 Visual Studio 2012+）支持此功能。请按照以下步骤操作：

1.  在报告中插入图片。这将作为您的占位符。
2.  右键单击您的图片并选择格式化对象 [![右键单击图像](https://i.stack.imgur.com/heoI4.png)](https://i.stack.imgur.com/heoI4.png)
3.  选择图片选项卡并按下公式按钮 [![图片选项卡](https://i.stack.imgur.com/tUyKZ.png)](https://i.stack.imgur.com/tUyKZ.png)
4.  将打开一个公式窗口。输入一个公式，将您的图片作为链接查找。

    if({@isDonor}="1") 那么“ [http://www.ny.org/images/aaf/picture1.jpg](http://www.ny.org/images/aaf/picture1.jpg) ”“否则” [http://www.ny.org/images/aaf/picture2.jpg](http://www.ny.org/images/aaf/picture2.jpg) “ [![公式编辑器](https://i.stack.imgur.com/ptgUn.png)](https://i.stack.imgur.com/ptgUn.png) 然后你就完了！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-21T03:54:02.980

就像 Josh 说的那样。您将不得不使用数据集推送图像。或者，将图像放入数据库表一次，然后使用子报表将其多次拉入。

# css - 使用左右设置宽度寻求CSS浏览器兼容性信息

> ID：128241
> 
> 赞同：1
> 
> 时间：2008-09-24T16:36:30.063
> 
> 标签：css, cross-browser, resize, compatibility, positioning

这是一个困扰我一年的问题。根本问题是如何设置元素相对于其父元素的大小，以便它从每个边缘插入 N 个像素？设置宽度会很好，但您不知道父级的宽度，并且您希望元素随窗口调整大小。（您不想使用百分比，因为您需要特定数量的像素。）

编辑我还需要防止内容（或缺少内容）拉伸或收缩两个元素。我得到的第一个答案是在父级上使用填充，这会很好用。我希望父级的宽度正好为 25%，并且与浏览器客户区的高度完全相同，而子级不能推动它并获得滚动条。/编辑

我尝试使用 {top:Npx;left:Npx;bottom:Npx;right:Npx;} 解决这个问题，但它只适用于某些浏览器。

我可能会用 jquery 编写一些 javascript 来修复每个页面调整大小的所有元素，但我对那个解决方案并不满意。（如果我想要顶部偏移 10px 但底部只有 5px 怎么办？它变得复杂了。）

我想知道的是如何以跨浏览器的方式解决这个问题，或者是一些允许简单 CSS 解决方案的浏览器列表。也许有人有一个技巧可以让这件事变得简单。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T16:50:26.083

如果您只关心水平间距，那么您可以通过给父元素填充来使父块元素中的所有子块元素“插入”一定量。您可以通过给元素边距在父块元素“插入”中制作单个子块元素。如果您使用后一种方法，您可能需要在父元素上设置边框或轻微填充，以防止边距折叠。

如果您也关心垂直间距，那么您需要使用定位。父元素需要定位；如果您不想将其移动到任何地方，请使用`position: relative`并且不要打扰设置`top`或`left`；它会留在原地。然后在子元素上使用绝对定位，并设置`top`、`right`、`bottom`和`left`相对于父元素的边缘。

例如：

```
#outer {
    width: 10em;
    height: 10em;
    background: red;
    position: relative;
}

#inner {
    background: white;
    position: absolute;
    top: 1em;
    left: 1em;
    right: 1em;
    bottom: 1em;
} 
```

如果要避免内容扩展元素的宽度，则应使用`overflow`属性，例如`overflow: auto`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T23:17:38.687

[CSS Box 模型](http://www.hicksdesign.co.uk/journal/3d-css-box-model)可能会为您提供洞察力，但我的猜测是您无法仅使用 CSS 实现像素完美的布局。

如果我理解正确，您希望父级宽度为 25%，并且与浏览器显示区域的高度完全相同。然后，您希望孩子的宽度为 25% - 2n 像素，高度为 100%-2n 像素，周围有 n 个像素。当前的 CSS 规范不支持这些类型的计算（尽管 IE5、IE6 和 IE7 对 CSS 表达式有非标准[支持，](http://msdn.microsoft.com/en-us/library/ms531196(VS.85).aspx)并且[IE8 正在放弃](http://support.microsoft.com/kb/949787)对 IE8 标准模式下的 CSS 表达式的支持）。

您可以强制父母浏览器区域的 100% 和 25% 的宽度，但你不能将孩子的高度拉伸到像素完美...

```
<style type="text/css">
html { height: 100%; }
body { font: normal 11px verdana; height: 100%; }
#one { background-color:gray; float:left; height:100%; padding:5px; width:25%; }
#two { height: 100%; background-color:pink;}
</style>
</head>
<body>
<div id="one">
<div id="two">
<p>content ... content ... content</p>
</div>
</div> 
```

...但会出现一个水平滚动条。此外，如果内容被挤压，父背景将不会超过 100%。这可能是您在问题本身中提出的填充示例。

您可以通过图像和其他 div 实现您正在寻找的*错觉*，但我不相信仅 CSS 可以在满足高度要求的情况下实现像素完美。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T16:38:19.937

只需对父元素应用一些填充，而在子元素上没有宽度。假设他们都是`display:block`，那应该可以正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T16:45:31.697

或者反过来：设置`margin`子元素的。

[Floatutorial](http://css.maxdesign.com.au/floatutorial/)是此类内容的绝佳资源。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T16:48:07.853

试试这个：

```
.parent {padding:Npx; display:block;}
.child {width:100%; display:block;} 
```

它应该在所有边都有一个 Npx 空间，拉伸以填充父元素。

编辑：当然，在父母身上，你也可以使用

```
{padding-top:Mpx; padding-bottom:Npx; padding-right:Xpx; padding-left:Ypx;} 
```

# c# - 带有自定义边框的 UI 性能

> ID：128243
> 
> 赞同：0
> 
> 时间：2008-09-24T16:36:40.983
> 
> 标签：c#, .net, user-interface

我在 C# 中创建一个用户控件，并添加我自己的边框和背景。目前背景是 16 个小图像，我会根据对象的状态进行更改。性能方面，使用 GDI+ 而不是图像会更好吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T16:40:03.317

我怀疑它会有所作为。

如果你只是用 GDI 和 GDI+ 对一堆图像进行 blit 处理就可以了

# .net - 在 .net winforms 中显示表格类型数据

> ID：128258
> 
> 赞同：0
> 
> 时间：2008-09-24T16:38:56.160
> 
> 标签：.net, winforms

我想显示表格类型的数据，但它不会来自单个数据源。我目前正在使用标签，但对齐看起来不太好。

有任何想法吗？

同样，数据不是从数据网格或任何东西加载的，每一行基本上是一个标签和一个数字，例如

总用户数：10123 总登录数：234

显示这个的最佳方式是什么，我应该使用的任何内置控件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T16:42:30.223

选项：

1.  将数据组织到数据表中并使用网格控件。
2.  使用[TableLayoutPanel](http://msdn.microsoft.com/en-us/library/system.windows.forms.tablelayoutpanel.aspx)对齐您的信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T17:28:15.057

如果您不想使用数据网格来显示数据，我建议您至少使用具有等宽字体的文本框，例如 courier new。

# python - 在 Python 中存储集合数据的最佳方式是什么？

> ID：128259
> 
> 赞同：4
> 
> 时间：2008-09-24T16:39:08.030
> 
> 标签：python, dictionary, data-structures, set

我有以下形式的数据列表：

`[(id\__1_, description, id\_type), (id\__2_, description, id\_type), ... , (id\__n_, description, id\_type))`

数据是从属于同一组的文件中加载的。在每个组中，可能有多个相同的 id，每个来自不同的文件。我不关心重复项，所以我认为存储所有这些内容的好方法是将其放入 Set 类型。但是有一个问题。

有时对于相同的 id，描述可能会略有不同，如下所示：

IPI00110753

*   微管蛋白 alpha-1A 链
*   微管蛋白 alpha-1 链
*   α-微管蛋白 1
*   α-微管蛋白同种型 M-α-1

（请注意，此示例取自[uniprot 蛋白质数据库](http://www.uniprot.org/uniprot/P68369)。）

我不在乎描述是否不同。我不能把它们扔掉，因为我使用的蛋白质数据库可能不包含某个标识符的列表。如果发生这种情况，我希望能够向生物学家显示人类可读的描述，以便他们大致了解他们正在研究的蛋白质。

我目前正在通过使用字典类型来解决这个问题。但是我不太喜欢这个解决方案，因为它使用了大量内存（我有很多这些 ID）。这只是它们的中间列表。在将 ID 放入数据库之前，还需要进行一些额外的处理，所以我想保持我的数据结构更小。

我真的有两个问题。首先，我会为此使用 Set 类型（而不是字典类型）获得更小的内存占用，还是应该使用排序列表，每次插入列表时检查 ID 是否存在，或者是否存在我没有想到的第三个解决方案？其次，如果 Set 类型是更好的答案，我如何键入它以仅查看元组的第一个元素而不是整个元素？

感谢您阅读我的问题，
蒂姆

**更新**

根据我收到的一些评论，让我稍微澄清一下。我对数据结构所做的大部分工作都是插入其中。我只读了两次，一次是用附加信息注释它，一次是要插入到数据库中。然而，在我插入数据库之前，可能会有额外的注释。不幸的是，我不知道此时是否会发生这种情况。

现在我正在研究将这些数据存储在不基于哈希表（即字典）的结构中。我希望新结构在插入时相当快，但读取它可以是线性的，因为我实际上只做了两次。我试图远离哈希表以节省空间。是否有更好的结构或者哈希表是否尽可能好？

*该信息是我通过查询 uniprot 获得的 Swiss-Prot 蛋白质标识符列表。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T16:59:10.230

Sets don't have keys. The element **is** the key.

If you think you want keys, you have a mapping. More-or-less by definition.

Sequential list lookup can be slow, even using a binary search. Mappings use hashes and are fast.

Are you talking about a dictionary like this?

```
{ 'id1': [ ('description1a', 'type1'), ('description1b','type1') ], 
  'id2': [ ('description2', 'type2') ],
...
} 
```

This sure seems minimal. ID's are only represented once.

Perhaps you have something like this?

```
{ 'id1': ( ('description1a', 'description1b' ), 'type1' ),
  'id2': ( ('description2',), 'type2' ),
...
} 
```

I'm not sure you can find anything more compact unless you resort to using the `struct` module.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T19:40:55.160

如果您正在通过删除重复项进行 n 路合并，则以下内容可能就是您要查找的内容。

该生成器将合并任意数量的源。每个源都必须是一个序列。键必须在位置 0。它一次生成一个合并序列。

```
def merge( *sources ):
    keyPos= 0
    for s in sources:
        s.sort()
    while any( [len(s)>0 for s in sources] ):
        topEnum= enumerate([ s[0][keyPos] if len(s) > 0 else None for s in sources ])
        top= [ t for t in topEnum if t[1] is not None ]
        top.sort( key=lambda a:a[1] )
        src, key = top[0]
        #print src, key
        yield sources[ src ].pop(0) 
```

此生成器从序列中删除重复项。

```
def unique( sequence ):
    keyPos= 0
    seqIter= iter(sequence)
    curr= seqIter.next()
    for next in seqIter:
        if next[keyPos] == curr[keyPos]:
            # might want to create a sub-list of matches
            continue
        yield curr
        curr= next
    yield curr 
```

这是一个脚本，它使用这些函数来生成一个结果序列，该序列是所有源的并集，其中删除了重复项。

```
for u in unique( merge( source1, source2, source3, ... ) ):
    print u 
```

每个序列中的完整数据集必须在内存中存在一次，因为我们在内存中进行排序。但是，生成的序列实际上并不存在于内存中。实际上，它通过消耗其他序列来工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T17:32:59.523

我假设您尝试通过减少使用的内存来解决的问题是进程的地址空间限制。此外，您搜索允许快速插入和合理顺序读出的数据结构。

## 使用较少的结构，除了字符串 (str)

您提出的问题是如何在一个进程中构建数据以使用更少的内存。对此的一个规范答案是（只要您仍然需要关联查找），尽可能少地使用其他结构，然后使用 python 字符串（str，而不是 unicode）。python 哈希（字典）相当有效地存储对字符串的引用（它不是 b-tree 实现）。

但是，我认为您使用这种方法不会走得太远，因为您面临的是巨大的数据集，这些数据集最终可能会超出您正在使用的机器的进程地址空间和物理内存。

## 替代解决方案

我会提出一个不同的解决方案，它不涉及将您的数据结构更改为更难插入或解释的东西。

*   将您的信息拆分为多个进程，每个进程都包含任何适合的数据结构。
*   使用套接字实现进程间通信，以便进程可能完全驻留在其他机器上。
*   尝试划分您的数据，以尽量减少进程间通信（与 cpu 周期相比，i/o 速度非常慢）。

我概述的方法的优点是

*   您可以在一台机器上完全使用两个或更多内核来提高性能
*   你不受一个进程的地址空间的限制，甚至不受一台机器的物理内存的限制

分布式处理有许多包和方法，其中一些是

*   [琳达](http://pypi.python.org/pypi/linda/0.5.1)
*   [加工](http://pypi.python.org/pypi/processing/0.52)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T17:04:11.963

用`{id: (description, id_type)}`字典怎么样？或`{(id, id_type): description}`字典，如果 (id,id_type) 是键。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T17:30:36.270

Python 中的集合是使用哈希表实现的。在早期版本中，它们实际上是使用集合实现的，但这已经改变了 AFAIK。然后，您使用集合保存的唯一内容就是每个条目的指针大小（指向值的指针）。

要仅将元组的一部分用于哈希码，您必须继承元组并覆盖哈希码方法：

```
class ProteinTuple(tuple):
     def __new__(cls, m1, m2, m3):
         return tuple.__new__(cls, (m1, m2, m3))

     def __hash__(self):
         return hash(self[0]) 
```

请记住，`__hash__`在这种情况下，您需要为额外的函数调用付费，否则它将是 C 方法。

我会听取康斯坦丁的建议并从元组中取出 id ，看看有多大帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T17:36:20.233

它仍然很模糊，但听起来你有几个 [(id, description, type)...] 列表

id 在列表中是唯一的，并且在列表之间是一致的。

您想创建一个 UNION：一个列表，其中每个 id 出现一次，可能有多个描述。

出于某种原因，您认为映射可能太大。你有这方面的证据吗？不要在没有实际测量的情况下过度优化。

这可能是（如果我没猜错的话）来自多个来源的标准“合并”操作。

```
source1.sort()
source2.sort()
result= []
while len(source1) > 0 or len(source2) > 0:
    if len(source1) == 0:
        result.append( source2.pop(0) )
    elif len(source2) == 0:
        result.append( source1.pop(0) )
    elif source1[0][0] < source2[0][0]:
        result.append( source1.pop(0) )
    elif source2[0][0] < source1[0][0]:
        result.append( source2.pop(0) )
    else:
        # keys are equal
        result.append( source1.pop(0) )
        # check for source2, to see if the description is different. 
```

这通过排序和合并组装了两个列表的并集。没有映射，没有哈希。

# php - 您如何确定有效的 SoapAction？

> ID：128263
> 
> 赞同：17
> 
> 时间：2008-09-24T16:39:51.397
> 
> 标签：php, web-services, soap

我正在`webservice`使用`NuSoap PHP library`. `webservice`似乎使用`.NET`; 每次我调用它时，我都会收到有关使用无效`SoapAction header`. 发送的标头是一个空字符串。我怎样才能找到`SoapAction`服务器所期望的？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-24T17:17:57.343

通过查看服务的 WSDL，您可以看到正在调用的服务操作所期望的 SoapAction。对于 .NET 服务，您可以通过打开 Web 浏览器访问服务的 url 并在末尾附加 ?wsdl 来访问 WSDL。

在 WSDL 文档中，您可以看到在“操作”节点下（在“绑定”下）定义的 SoapAction。例如：

```
<wsdl:operation name="Execute">
  <soap:operation soapAction="http://tempuri.org/Execute" style="document" /> 
```

找到您尝试调用的操作的操作节点，您将在那里找到它所期望的 Soap Action。

# java - 在ant中无条件执行任务？

> ID：128267
> 
> 赞同：6
> 
> 时间：2008-09-24T16:40:15.453
> 
> 标签：java, unit-testing, ant

我正在尝试定义一个在目标完成执行时发出（使用回显）消息的任务，无论该目标是否成功。具体来说，目标执行一个任务来运行一些单元测试，我想发出一条消息，指示结果在哪里可用：

```
<target name="mytarget">
  <testng outputDir="${results}" ...>
    ...
  </testng>
  <echo>Tests complete.  Results available in ${results}</echo>
</target> 
```

不幸的是，如果测试失败，任务就会失败并且执行会中止。因此，只有在测试通过时才会输出消息——这与我想要的相反。我知道我可以把任务放在任务之前，但这会让用户更容易错过这条消息。我正在尝试做的事情可能吗？

**更新：**事实证明我很愚蠢。我的 <testng> 任务中有 haltOnFailure="true" ，这解释了我看到的行为。现在的问题是，即使测试失败，将其设置为 false 也会导致整个 ant 构建成功，这不是我想要的。下面使用任务的答案看起来可能是我想要的..

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T16:51:27.767

根据[Ant 文档](http://ant.apache.org/manual/Tasks/exec.html)，如果 testng 任务失败，有两个属性控制构建过程是否停止：

> **haltonfailure** - 如果在测试运行期间发生故障，则停止构建过程。默认为假。
> 
> **haltonskipped** - 如果至少有一个跳过的测试，则停止构建过程。默认为假。

我无法从片段中判断您是否设置了此属性。如果当前设置为 true，则可能值得尝试将 haltonfailure 显式设置为 false。

此外，假设您在 Ant 中使用 <exec> 功能，有类似的属性可以控制如果执行的命令失败会发生什么：

> **failonerror** - 如果命令退出并返回代码信号失败，则停止构建过程。默认为假。
> 
> **failifexecutionfails** - 如果我们无法启动程序，则停止构建。默认为真。

根据您帖子中的部分代码片段无法判断，但我猜测最可能的罪魁祸首是**failonerror**或**haltonfailure**设置为true。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T16:52:01.650

您可以像这样使用[try-catch](http://ant-contrib.sourceforge.net/tasks/tasks/trycatch.html)块：

```
<target name="myTarget">
    <trycatch property="foo" reference="bar">
        <try>
            <testing outputdir="${results}" ...>
                ...
            </testing>
        </try>

        <catch>
            <echo>Test failed</echo>
        </catch>

        <finally>
            <echo>Tests complete.  Results available in ${results}</echo>
        </finally>
    </trycatch>
</target> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-25T17:05:04.357

您的问题的解决方案是`failureProperty`结合使用`haltOnFailure`testng 任务的属性，如下所示：

```
<target name="mytarget">
  <testng outputDir="${results}" failureProperty="tests.failed" haltOnFailure="false" ...>
    ...
  </testng>
  <echo>Tests complete.  Results available in ${results}</echo>
</target> 
```

然后，当您希望构建失败时，您可以在其他地方添加这样的 ant 代码：

```
<target name="doSomethingIfTestsWereSuccessful" unless="tests.failed">
   ...
</target>

<target name="doSomethingIfTestsFailed" if="tests.failed">
   ...
   <fail message="Tests Failed" />
</target> 
```

然后，您可以在希望 ant 构建失败的地方调用 doSomethingIfTestsFailed。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T17:02:28.707

尽管您在示例中显示了一个名为“testng”的假任务，但我认为您正在使用 junit 目标。

在这种情况下，您看到这些结果很奇怪，因为 junit 目标默认情况下不会在测试失败时中止执行。

有一种方法可以通过使用停止属性来实际告诉 ant 在 junit 失败或错误时停止构建，例如。*停机故障*：

```
<target name="junit" depends="junitcompile">
    <junit printsummary="withOutAndErr" fork="yes" haltonfailure="yes"> 
```

但是，*haltonfailure*和*haltonerror*默认设置为关闭。我想您可以检查您的构建文件以查看是否设置了这些标志中的任何一个。它们甚至可以全局设置，因此您可以尝试的一件事是在您的任务中明确将其设置为“否”，以确保在全局范围内设置它时将其覆盖。

[http://ant.apache.org/manual/Tasks/junit.html](http://ant.apache.org/manual/Tasks/junit.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T18:16:15.910

你可以分叉 testng 任务吗？如果是，那么您可能想要使用该功能，以便 testng 任务将在不同的 JVM 上运行。

# php - 错误地为 PHP 设置 APC？

> ID：128274
> 
> 赞同：2
> 
> 时间：2008-09-24T16:41:06.527
> 
> 标签：php, apache, caching, apc

我决定安装`APC`以加快我工作的网站。可悲的是，我发现它已经安装并启用（最初在服务器上工作的开发人员已经继续前进）。

然后我决定检查它的使用情况，看看它是否需要分配更多的内存。这时我发现了一些奇怪的东西。带有此代码的简单文件：

```
<?php
    print_r(apc_cache_info());
?> 
```

从 apache 提供服务时它不起作用。我得到`Error 320 (net::ERR_INVALID_RESPONSE): Unknown error.`并且错误日志中没有任何内容。从`cl`服务器上的 i ，它工作正常。但它只说我的`check_apc.php`文件已缓存（我正在运行的脚本的名称）。

所以看起来`APC`没有完全/正确设置。任何人都知道问题可能是什么？

/etc/php.d/apc.ini 的内容：

```
; Enable apc extension module
extension = apc.so
; Options for the apc module
apc.enabled=1
apc.shm_segments=1
apc.optimization=0
apc.shm_size=32
apc.ttl=7200
apc.user_ttl=7200
apc.num_files_hint=1024
apc.mmap_file_mask=/tmp/apc.XXXXXX
apc.enable_cli=1
apc.cache_by_default=1 
```

服务器正在运行`CentOS`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T17:28:56.477

自创建 apc.so 以来，是否有人升级了服务器上的 php 版本？可能 apc.so 是针对不同版本的 php 编译的。

如果可能，请尝试针对当前版本的 php 重新编译 apc.so。或者，如果您使用的是包管理器，请尝试完全删除 apc 包并重新安装。

# asp.net - LINQ：自定义列名

> ID：128277
> 
> 赞同：19
> 
> 时间：2008-09-24T16:41:39.070
> 
> 标签：asp.net, linq, linq-to-sql, datagridview

**更新**

我基本上将查询绑定到 WinForms `DataGridView`。我希望列标题合适，并在需要时有空格。例如，我想要一个列标题`First Name`而不是`FirstName`.

* * *

如何在 LINQ 中创建自己的自定义列名？

例如：

```
Dim query = From u In db.Users _
            Select u.FirstName AS 'First Name' 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-24T17:03:51.950

正如 CQ 所说，您不能为字段名称留出空格，但是您可以返回新列。

```
var query = from u in db.Users
            select new
            {
                FirstName = u.FirstName,
                LastName = u.LastName,
                FullName = u.FirstName + " " + u.LastName
            }; 
```

然后你可以从上面绑定到变量查询或循环遍历它......

```
foreach (var u in query)
{
   // Full name will be available now 
   Debug.Print(u.FullName); 
} 
```

如果您想重命名列，可以，但不允许使用空格。

```
var query = from u in db.Users
            select new
            {
                First = u.FirstName,
                Last = u.LastName
            }; 
```

将 FirstName 重命名为 First，LastName 重命名为 Last。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-14T15:55:53.463

我解决了自己的问题，但是您的所有答案都非常有帮助，并为我指明了正确的方向。

在我的`LINQ`查询中，如果列名有多个单词，我会用下划线分隔单词：

```
Dim query = From u In Users _
            Select First_Name = u.FirstName 
```

然后，在 的`Paint`方法中`DataGridView`，我用空格替换了标题中的所有下划线：

```
Private Sub DataGridView1_Paint(ByVal sender As Object, ByVal e As System.Windows.Forms.PaintEventArgs) Handles DataGridView1.Paint
    For Each c As DataGridViewColumn In DataGridView1.Columns
        c.HeaderText = c.HeaderText.Replace("_", " ")
    Next
End Sub 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-24T18:26:49.690

如果要更改标题文本，可以在 GridView 定义中进行设置...

```
<asp:GridView ID="GridView1" runat="server" AutoGenerateColumns="false">
    <Columns>
        <asp:BoundField DataField="FirstName" HeaderText="First Name" />
    </Columns>
</asp:GridView> 
```

在后面的代码中，您可以绑定到用户，它将标头设置为名字。

```
protected void Page_Load(object sender, EventArgs e)
{
     // initialize db datacontext
     var query = from u in db.Users
                 select u;
     GridView1.DataSource = query;
     GridView1.DataBind();
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-28T01:09:53.833

您还可以添加一个事件处理程序来为您替换那些下划线！

对于那些喜欢 C# 的人：

```
datagrid1.ItemDataBound += 
    new DataGridItemEventHandler(datagrid1_HeaderItemDataBound); 
```

您的处理程序应如下所示：

```
private void datagrid1_HeaderItemDataBound(object sender, DataGridItemEventArgs e)
{

    if (e.Item.ItemType == ListItemType.Header)
    {
        foreach(TableCell cell in e.Item.Cells)
            cell.Text = cell.Text.Replace('_', ' ');
    }

} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-08T18:01:06.513

我会使用：

```
var query = from u in db.Users
            select new
            {
                FirstName = u.FirstName,
                LastName = u.LastName,
                FullName = u.FirstName + " " + u.LastName
            }; 
```

（来自斯科特尼科尔斯）

以及一个读取骆驼大小写字符串并在每个新大写字母之前插入空格的函数（您可以为 ID 等添加规则）。我现在没有那个函数的代码，但是写起来相当简单。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T18:16:19.827

您可以使结果在列名中包含下划线，并在 TemplateField 中使用 HeaderTemplate 将下划线替换为空格。或者子类化 GridView 的 DataControlField 并覆盖 HeaderText 属性：

```
namespace MyControls 
{
public SpacedHeaderTextField : System.Web.UI.WebControls.BoundField
 { public override string HeaderText
    { get 
       { string value = base.HeaderText;
         return (value.Length > 0) ? value : DataField.Replace(" ","");
       }
      set
       { base.HeaderText = value;
       }     
    }
 } 
 } 
```

ASPX：

```
<%@Register TagPrefix="my" Namespace="MyControls" %>

<asp:GridView DataSourceID="LinqDataSource1" runat='server'>
  <Columns>
     <my:SpacedHeaderTextField DataField="First_Name" />
  </Columns>
</asp:GridView> 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T16:44:08.190

我不明白为什么你必须这样做，如果你试图为网格或其他东西这样做，为什么不直接在 HTML 中命名标题？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-24T16:52:17.623

您实际上要做的是设置对返回的变量引用，没有办法用空格命名变量。您这样做是否有最终结果的原因，也许如果我们知道最终目标，我们可以帮助您提出适合的解决方案。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-11-19T16:32:07.387

使用 Linq 扩展方法：

```
SomeDataSource.Select(i => new { NewColumnName = i.OldColumnName, NewColumnTwoName = i.OldColumnTwoName}); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-25T03:26:19.177

正如其他人已经指出的那样，如果在设计时已知标题等，请关闭 AutoGeneratedColumns 并在字段定义中设置标题等，而不是使用自动生成的列。从您的示例看来，查询是静态的，并且标题在设计时是已知的，因此这可能是您的最佳选择。

但是[，尽管您的问题没有指定此要求] -*如果*标题文本（和格式等）在设计时*未知*，但将在运行时确定，并且您需要自动生成列（使用 AutoGenerateColumns=true"）是解决方法。

一种方法是创建一个继承gridview 的新控件类。然后，您可以通过覆盖 gridview 的“CreateAutoGeneratedColumn”来为自动生成的字段设置标题、格式等。例子：

```
//gridview with more formatting options
namespace GridViewCF
{
    [ToolboxData("<{0}:GridViewCF runat=server></{0}:GridViewCF>")]
    public class GridViewCF : GridView
    {
        //public Dictionary<string, UserReportField> _fieldProperties = null;

        public GridViewCF()
        {
        }

        public List<FieldProperties> FieldProperties
        {
            get
            {
                return (List<FieldProperties>)ViewState["FieldProperties"];
            }
            set
            {
                ViewState["FieldProperties"] = value;
            }
        }

        protected override AutoGeneratedField CreateAutoGeneratedColumn(AutoGeneratedFieldProperties fieldProperties)
        {
            AutoGeneratedField field = base.CreateAutoGeneratedColumn(fieldProperties);
            StateBag sb = (StateBag)field.GetType()
                .InvokeMember("ViewState",
                BindingFlags.GetProperty |
                BindingFlags.NonPublic |
                BindingFlags.Instance,
                null, field, new object[] {});

            if (FieldProperties != null)
            {
                FieldProperties fps = FieldProperties.Where(fp => fp.Name == fieldProperties.Name).Single();
                if (fps.FormatString != null && fps.FormatString != "")
                {
                    //formatting
                    sb["DataFormatString"] = "{0:" + fps.FormatString + "}";
                    field.HtmlEncode = false;
                }

                //header caption
                field.HeaderText = fps.HeaderText;

                //alignment
                field.ItemStyle.HorizontalAlign = fps.HorizontalAlign;
            }

            return field;
       }
    }

    [Serializable()]
    public class FieldProperties
    {
        public FieldProperties()
        { }

        public FieldProperties(string name, string formatString, string headerText, HorizontalAlign horizontalAlign)
        {
            Name = name;
            FormatString = formatString;
            HeaderText = headerText;
            HorizontalAlign = horizontalAlign;
        }

        public string Name { get; set; }
        public string FormatString { get; set; }
        public string HeaderText { get; set; }
        public HorizontalAlign HorizontalAlign { get; set; }
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-05-23T10:11:21.303

我相信这可以使用显式名称类型来实现

```
 system.Name,
 sysentity.Name 
 //change this to 
 entity = sysentity.Name 
```

* * *

## 回答 #12

> 赞同：-8
> 
> 时间：2008-09-24T17:41:58.957

我的VS2008现在坏了，所以我无法检查。在 C# 中，您将使用“=” - 怎么样

```
Dim query = From u In db.Users _
            Select 'First Name' = u.FirstName 
```

# installation - 如何最好地在 WiX 中定义自定义操作？

> ID：128279
> 
> 赞同：14
> 
> 时间：2008-09-24T16:42:35.777
> 
> 标签：installation, wix

我有一个[WiX](http://en.wikipedia.org/wiki/WiX)安装程序和一个使用安装程序属性的自定义操作（加上撤消和回滚）。自定义操作必须在所有文件都在硬盘上之后发生。为此，您似乎需要 WXS 文件中的 16 个条目；根内有八个，如下所示：

```
<CustomAction Id="SetForRollbackDo" Execute="immediate" Property="RollbackDo" Value="[MYPROP]"/>
<CustomAction Id="RollbackDo" Execute="rollback" BinaryKey="MyDLL" DllEntry="UndoThing" Return="ignore"/>
<CustomAction Id="SetForDo" Execute="immediate" Property="Do" Value="[MYPROP]"/>
<CustomAction Id="Do" Execute="deferred" BinaryKey="MyDLL" DllEntry="DoThing" Return="check"/>
<CustomAction Id="SetForRollbackUndo" Execute="immediate" Property="RollbackUndo" Value="[MYPROP]"/>
<CustomAction Id="RollbackUndo" Execute="rollback" BinaryKey="MyDLL" DllEntry="DoThing" Return="ignore"/>
<CustomAction Id="SetForUndo" Execute="immediate" Property="Undo" Value="[MYPROP]"/>
<CustomAction Id="Undo" Execute="deferred" BinaryKey="MyDLL" DllEntry="UndoThing" Return="check"/> 
```

中的八个`InstallExecuteSequence`，如下所示：

```
<Custom Action="SetForRollbackDo" After="InstallFiles">REMOVE&lt;>"ALL"</Custom>
<Custom Action="RollbackDo" After="SetForRollbackDo">REMOVE&lt;>"ALL"</Custom>
<Custom Action="SetForDo" After="RollbackDo">REMOVE&lt;>"ALL"</Custom>
<Custom Action="Do" After="SetForDo">REMOVE&lt;>"ALL"</Custom>
<Custom Action="SetForRollbackUndo" After="InstallInitialize">REMOVE="ALL"</Custom>
<Custom Action="RollbackUndo" After="SetForRollbackUndo">REMOVE="ALL"</Custom>
<Custom Action="SetForUndo" After="RollbackUndo">REMOVE="ALL"</Custom>
<Custom Action="Undo" After="SetForUndo">REMOVE="ALL"</Custom> 
```

有没有更好的办法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T13:13:12.037

WiX 自定义操作是一个很好的模型。在这种情况下，您只需声明`CustomAction`立即操作、延迟操作和回滚操作。您只需使用 调度`Custom`立即操作，其中立即操作作为本机 DLL 中的代码实现。

然后，在立即操作的**代码**中，您调用`MsiDoAction`以安排回滚和延迟操作：由于它们是延迟的，它们会在您调用时写入脚本中，`MsiDoAction`而不是立即执行。您还需要调用`MsiSetProperty`以设置自定义操作数据。

例如，下载 WiX 源代码并研究其`IISExtension`工作原理。WiX 操作通常会解析自定义表并基于该表为延迟操作的属性生成数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-27T23:06:37.533

如果您有需要支持回滚的复杂自定义操作，您可以考虑编写一个 Wix 扩展。扩展通常提供创作支持（即映射到 MSI 表条目的新 XML 标记），以及自定义操作的自动调度。

这不仅仅是编写自定义操作，但一旦您的 CA 达到一定程度的复杂性，扩展提供的易于创作是值得的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-06-16T12:27:07.213

我在编写 WiX 安装程序时遇到了同样的问题。我解决这个问题的方法很像 Mike 建议的，我有一篇博文*[实现 WiX 自定义操作第 2 部分：使用自定义表](http://technicaltrack.wordpress.com/2011/06/15/implmenting-wix-custom-actions-part-2-using-custom-tables/)*。

简而言之，您可以为您的数据定义一个自定义表格：

```
<CustomTable Id="LocalGroupPermissionTable">
    <Column Id="GroupName" Category="Text" PrimaryKey="yes" Type="string"/>
    <Column Id="ACL" Category="Text" PrimaryKey="no" Type="string"/>
    <Row>
        <Data Column="GroupName">GroupToCreate</Data>
        <Data Column="ACL">SeIncreaseQuotaPrivilege</Data>
    </Row>
</CustomTable> 
```

然后编写一个立即自定义操作来安排延迟、回滚和提交自定义操作：

```
extern "C" UINT __stdcall ScheduleLocalGroupCreation(MSIHANDLE hInstall)
{
    try {
        ScheduleAction(hInstall,L"SELECT * FROM CreateLocalGroupTable", L"CA.LocalGroupCustomAction.deferred", L"create");
        ScheduleAction(hInstall,L"SELECT * FROM CreateLocalGroupTable", L"CA.LocalGroupCustomAction.rollback", L"create");
    }
    catch( CMsiException & ) {
        return ERROR_INSTALL_FAILURE;
    }
    return ERROR_SUCCESS;
} 
```

以下代码显示了如何安排单个自定义操作。基本上你只需打开自定义表，读取你想要的属性（你可以通过调用**MsiViewGetColumnInfo()**获取任何自定义表的架构），然后将所需的属性格式化为**CustomActionData**属性（我使用 form `/propname:value`，尽管你可以使用任何东西你要）。

```
void ScheduleAction(MSIHANDLE hInstall,
            const wchar_t *szQueryString,
            const wchar_t *szCustomActionName,
            const wchar_t *szAction)
{
    CTableView view(hInstall,szQueryString);
    PMSIHANDLE record;

    //For each record in the custom action table
    while( view.Fetch(record) ) {
        //get the "GroupName" property
        wchar_t recordBuf[2048] = {0};
        DWORD    dwBufSize(_countof(recordBuf));
        MsiRecordGetString(record, view.GetPropIdx(L"GroupName"), recordBuf, &dwBufSize);

        //Format two properties "GroupName" and "Operation" into
        //the custom action data string.
        CCustomActionDataUtil formatter;
        formatter.addProp(L"GroupName", recordBuf);
        formatter.addProp(L"Operation", szAction );

        //Set the "CustomActionData" property".
        MsiSetProperty(hInstall,szCustomActionName,formatter.GetCustomActionData());

        //Add the custom action into installation script. Each
        //MsiDoAction adds a distinct custom action into the
        //script, so if we have multiple entries in the custom
        //action table, the deferred custom action will be called
        //multiple times.
        nRet = MsiDoAction(hInstall,szCustomActionName);
    }
} 
```

至于实现延迟、回滚和提交自定义操作，我更喜欢只使用一个函数并使用**MsiGetMode()**来区分应该做什么：

```
extern "C" UINT __stdcall LocalGroupCustomAction(MSIHANDLE hInstall)
{
    try {
        //Parse the properties from the "CustomActionData" property
        std::map<std::wstring,std::wstring> mapProps;
        {
            wchar_t szBuf[2048]={0};
            DWORD dwBufSize = _countof(szBuf); MsiGetProperty(hInstall,L"CustomActionData",szBuf,&dwBufSize);
            CCustomActionDataUtil::ParseCustomActionData(szBuf,mapProps);
        }

        //Find the "GroupName" and "Operation" property
        std::wstring sGroupName;
        bool bCreate = false;
        std::map<std::wstring,std::wstring>::const_iterator it;
        it = mapProps.find(L"GroupName");
        if( mapProps.end() != it ) sGroupName = it->second;
        it = mapProps.find(L"Operation");
        if( mapProps.end() != it )
            bCreate = wcscmp(it->second.c_str(),L"create") == 0 ? true : false ;

        //Since we know what opeartion to perform, and we know whether it is
        //running rollback, commit or deferred script by MsiGetMode, the
        //implementation is straight forward
        if( MsiGetMode(hInstall,MSIRUNMODE_SCHEDULED) ) {
            if( bCreate )
                CreateLocalGroup(sGroupName.c_str());
            else
                DeleteLocalGroup(sGroupName.c_str());
        }
        else if( MsiGetMode(hInstall,MSIRUNMODE_ROLLBACK) ) {
            if( bCreate )
                DeleteLocalGroup(sGroupName.c_str());
            else
                CreateLocalGroup(sGroupName.c_str());
        }
    }
    catch( CMsiException & ) {
        return ERROR_INSTALL_FAILURE;
    }
    return ERROR_SUCCESS;
} 
```

通过使用上述技术，对于典型的自定义操作集，您可以将自定义操作表减少到五个条目：

```
<CustomAction Id="CA.ScheduleLocalGroupCreation"
              Return="check"
              Execute="immediate"
              BinaryKey="CustomActionDLL"
              DllEntry="ScheduleLocalGroupCreation"
              HideTarget="yes"/>
<CustomAction Id="CA.ScheduleLocalGroupDeletion"
              Return="check"
              Execute="immediate"
              BinaryKey="CustomActionDLL"
              DllEntry="ScheduleLocalGroupDeletion"
              HideTarget="yes"/>
<CustomAction Id="CA.LocalGroupCustomAction.deferred"
              Return="check"
              Execute="deferred"
              BinaryKey="CustomActionDLL"
              DllEntry="LocalGroupCustomAction"
              HideTarget="yes"/>
<CustomAction Id="CA.LocalGroupCustomAction.commit"
              Return="check"
              Execute="commit"
              BinaryKey="CustomActionDLL"
              DllEntry="LocalGroupCustomAction"
              HideTarget="yes"/>
<CustomAction Id="CA.LocalGroupCustomAction.rollback"
              Return="check"
              Execute="rollback"
              BinaryKey="CustomActionDLL"
              DllEntry="LocalGroupCustomAction"
              HideTarget="yes"/> 
```

而InstallSquence 表中只有两个条目：

```
<InstallExecuteSequence>
    <Custom Action="CA.ScheduleLocalGroupCreation" 
            After="InstallFiles">
        Not Installed
    </Custom>
    <Custom Action="CA.ScheduleLocalGroupDeletion" 
            After="InstallFiles">
        Installed
    </Custom>
</InstallExecuteSequence> 
```

此外，只要稍加努力，大部分代码都可以编写为可重用（例如从自定义表中读取、获取属性、格式化所需的属性并设置为 CustomActionData 属性），现在自定义操作表中的条目是不是特定于应用程序的（特定于应用程序的数据写入自定义表中），我们可以将自定义操作表放在自己的文件中，然后将其包含在每个 WiX 项目中。

对于自定义动作 DLL 文件，由于应用程序数据是从自定义表中读取的，因此我们可以将应用程序特定的细节排除在 DLL 实现之外，因此自定义动作表可以成为一个库，从而更容易重用。

这就是我目前编写 WiX 自定义操作的方式，如果有人知道如何进一步改进，我将不胜感激。:)

（您还可以在我的博客文章中找到完整的源代码，*[实现 Wix 自定义操作第 2 部分：使用自定义表格](http://technicaltrack.wordpress.com/2011/06/15/implmenting-wix-custom-actions-part-2-using-custom-tables/)*。）。

# vb.net - 如何在 VB.NET 中调用异步 Web 请求？

> ID：128282
> 
> 赞同：3
> 
> 时间：2008-09-24T16:43:06.087
> 
> 标签：vb.net, web-services

我目前正在使用以下代码来创建 Web 请求：

```
Dim myRequest As WebRequest = WebRequest.Create("http://foo.com/bar")
Dim myResponse As WebResponse = myRequest.GetResponse() 
```

问题是这会“锁定”程序直到请求完成（如果请求永远不会完成，程序将挂起）。你如何改变这样的事情以异步执行，以便在 Web 请求完成时可以完成其他任务？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T16:51:24.537

您将使用 BeginGetResponse 添加 AsyncCallback，它基本上指向代码中将在 WebRequest 返回时调用的其他方法。这里有一个很好的[样本](http://www.sitepoint.com/forums/showpost.php?p=3753215)。

[http://www.sitepoint.com/forums/showpost.php?p=3753215](http://www.sitepoint.com/forums/showpost.php?p=3753215)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T16:44:38.423

myRequest.BeginGetResponse()

您还需要在请求完成时调用 EndGetReponse()（通过 WaitHandle、回调或轮询确定）。

# unit-testing - JavaME 中最好的单元测试框架是什么？

> ID：128287
> 
> 赞同：2
> 
> 时间：2008-09-24T16:44:11.513
> 
> 标签：unit-testing, java-me, frameworks

目前 JavaME 单元测试的最佳工具是什么？我以前从未真正使用过单元测试（真丢脸！），所以学习曲线很重要。我会很感激你的回答有一些利弊。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T04:11:26.040

我认为这将取决于您打算进行什么样的测试。你会使用持续集成吗？必须在手机上运行测试。

如果测试是更多的逻辑/数据处理测试，你可以用 JUnit 做的很好。但是如果你需要使用 javax.microedition.* 中的一些类，那么事情会变得有点棘手，但并非不可能。

一些示例：屏幕上的文本换行测试，需要 javax.microedition.lcdui.Font。您不能只使用 WTK 附带的 jar 来创建字体类，因为在初始化时它将调用一些不可用的本地方法。

对于这类测试，我创建了 J2ME 的存根实现。基本上这些是我自己对 J2ME 类的解释。我可以在那里设置一些先决条件（例如每个字符都是 5 像素宽等）。而且它工作得非常好，因为我的测试只需要知道 J2ME 类如何响应，而不是它们是如何在内部实现的。

对于网络测试，我使用[了 MicroEmulator 的](http://www.microemu.org/index.html)网络实现，而且效果也很好。

单元测试的另一个问题 - 最好将您的移动项目作为使用 Java 4、5、6 的 java 项目，因为在 1.3 中编写测试至少对我来说是一种痛苦......

我相信，从 JUnit 开始会很好，可以启动并运行。如果出现其他一些要求（在手机上运行测试），那么您可以探索替代方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T16:50:31.810

老实说，我在 Java 中使用的唯一单元测试器是[JUnit](http://www.junit.org/)和一个名为[DBUnit](http://www.dbunit.org/)的子项目，用于数据库测试......我假设你在 J2ME 下不需要它。

JUnit 很容易用于单元测试，只要您的 IDE 支持它（Eclipse 内置了对 JUnit 的支持）。您只需使用 @Test 注释标记测试（我认为是 org.junit.Test）。您还可以指定应该运行`@Before`或`@After`每个测试的方法，以及在整个类之前或之后（使用`@BeforeClass`and `@AfterClass`）。

不过，我从未在 J2ME 下使用过 JUnit……我在工作中使用 J2EE。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T16:51:41.837

从来没有找到一个优秀的。您可以尝试阅读此文档： [如何使用它](https://developer.sonyericsson.com/getDocument.do?docId=87520) 以及此处的链接：[下载](https://developer.sonyericsson.com/site/global/newsandevents/latestnews/newsjuly06/p_mobile_juint1.0_javame_cldc.jsp)

由索尼爱立信制作，但适用于任何 J2ME 开发。

我建议您在攻击移动平台上的单元测试之前花一些时间学习纯 Java 中的单元测试。这可能是一个大到吞下一个芽。

祝你好运！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T17:00:37.590

有一个名为 J2MEUnit 的框架，您可以尝试一下，但它看起来不像仍在积极开发中：

[http://j2meunit.sourceforge.net](http://j2meunit.sourceforge.net)

# .net - 为了创建 64 位 .NET 应用程序，我需要什么

> ID：128294
> 
> 赞同：1
> 
> 时间：2008-09-24T16:45:37.920
> 
> 标签：.net, visual-studio, 64-bit

如果我想为 64 位环境编译我的 .NET 应用程序。我需要

*   64 位操作系统版本
    或
*   64 位 Visual Studio 版本
    或两者兼而有之？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T16:48:58.647

您实际上不需要这些来*构建*应用程序。纯 .NET 2.0+ 应用程序将——在没有相反的特定编译器标志的情况下——在 64 位操作系统下作为 64 位应用程序运行，在 32 位操作系统下作为 32 位应用程序运行。

**编辑：**此外，没有 64 位版本的 Visual Studio 之类的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T16:50:30.360

实际上**，您不需要任何东西**，因为 .NET 应用程序已编译为[CIL](http://en.wikipedia.org/wiki/Common_Intermediate_Language)。虚拟机在运行时将 CIL 编译为本机代码。因此，如果您在 64 位平台上运行您的应用程序，它将生成本机 64 位代码，但如果您在 32 位平台上运行它，它将生成 32 位代码。

但是，如果您想在 64 位环境中调试/分析/测试您的应用程序，那么您需要：

*   64 位操作系统
*   64 位 .NET 虚拟机

Visual Studio 可以调试在 64 位模式下运行的应用程序。对于分析，您可能需要一个 64 位分析器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T16:47:41.910

您还需要一个 64 位 CPU。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T16:49:04.357

我正在工作的 32 位机器上运行 Visual Studio 2005，在我的项目属性的构建部分下，我可以选择 x64 作为我的平台目标。

所以我认为您不需要 64 位操作系统或特殊版本的 VS。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T16:48:53.077

这应该有你需要的一切：

[http://msdn.microsoft.com/en-us/library/ms241066.aspx](http://msdn.microsoft.com/en-us/library/ms241066.aspx)

不过，我会从安装 64 位操作系统开始（显然必须在 64 位 CPU 上运行！）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T00:02:33.157

Java 开始了这个，它非常好。.NET 更进一步。平台独立性。

# javascript - Tag images in the image itself? HOW-TO

> ID：128305
> 
> 赞同：6
> 
> 时间：2008-09-24T16:47:42.067
> 
> 标签：javascript, image, tags

How to tag images in the image itself in a web page?

I know [Taggify](http://www.taggify.net/), but... is there other options?

[Orkut](http://en.blog.orkut.com/2008/06/tag-thats-me.html) also does it to tag people faces... How is it done?

Anyone knows any public framework that is able to do it?

See a sample bellow from Taggify:

![alt text](https://i.stack.imgur.com/gT1zq.jpg "Taggify Sample")

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T17:29:51.373

我知道这不是 javascript，但 C# 3.0 有一个 API 可以做到这一点。**System.Windows.Media.Imaging**命名空间有一个名为**BitmapMetadata**的类，可用于读取和写入图像元数据（存储在图像本身中）。这是一种在给定文件路径的情况下检索图像元数据的方法：

```
public static BitmapMetadata GetMetaData(string path)
{
    using (Stream s = new System.IO.FileStream(path, FileMode.Open, FileAccess.ReadWrite, FileShare.ReadWrite))
    {
        var decoder = BitmapDecoder.Create(s, BitmapCreateOptions.None, BitmapCacheOption.OnDemand);
        var frame = decoder.Frames.FirstOrDefault();
        if (frame != null)
        {
            return frame.Metadata as BitmapMetadata;
        }
        return null;
    }
} 
```

BitmapMetadata 类具有标签以及其他常见图像元数据的属性。要将元数据保存回图像，您可以使用[InPlaceBitmapMetadataWriter 类](http://msdn.microsoft.com/en-us/library/system.windows.media.imaging.inplacebitmapmetadatawriter.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T11:45:23.917

HTML 中有一个地图标记，可以与 Javascript 结合使用来“标记”图像的不同部分。

您可以在[此处](http://www.w3schools.com/TAGS/tag_map.asp)查看详细信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-17T20:51:45.583

我将重新激活这个问题并提供一些帮助。目前我发现的唯一内容是[http://www.sanisoft.com/downloads/imgnotes-0.2/example.html](http://www.sanisoft.com/downloads/imgnotes-0.2/example.html)。一个 jQuery 标记实现。如果有人知道另一种方式，请告诉我们。

;)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T17:38:36.873

[您可以在http://www.imageinfocards.com](http://www.imageinfocards.com)查看 Image.InfoCards (IIC) 。使用 IIC 元数据实用程序，您可以在称为“卡片”的非常用户友好的组中添加元数据。

提供的实用程序（包括 Java 小程序）允许您标记 GIF、JPEG 和 PNG，而无需在视觉上更改它们。

IIC 目前是专有的，但计划在 2009 年第一季度将其作为开放协议。

IIC 与 IPTC/DIG35/DublinCore/etc 等其他公司的区别在于它更加以消费者为中心，并且不需要 CS 学位即可理解和使用它......

# silverlight - Rich Text Editing in Silverlight 2

> ID：128333
> 
> 赞同：1
> 
> 时间：2008-09-24T16:53:18.620
> 
> 标签：silverlight, silverlight-2.0

We've looked in Silverlight 2 recently and found no way to edit formatted text there. Is this really true, and are there any (maybe commercial) external rich text editors available?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T17:47:57.747

Vectorlight 有一个[富文本框](http://www.vectorlight.net/silverlight_rich_textbox_demo.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T17:01:49.863

I haven't tried it myself yet but this is one I know of.

[http://www.codeplex.com/richtextedit](http://www.codeplex.com/richtextedit)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T00:25:33.620

ComponentOne 也有一个 RichTextBox 控件正在开发中：

[http://www.componentone.com/SuperProducts/RichTextBoxSilverlight/](http://www.componentone.com/SuperProducts/RichTextBoxSilverlight/)

# javascript - Display DIV at Cursor Position in Textarea

> ID：128342
> 
> 赞同：60
> 
> 时间：2008-09-24T16:55:29.147
> 
> 标签：javascript, dom

For a project of mine I would love to provide auto completion for a specific textarea. Similar to how intellisense/omnicomplete works. For that however I have to find out the absolute cursor position so that I know where the DIV should appear.

Turns out: that's (nearly I hope) impossible to achieve. Does anyone has some neat ideas how to solve that problem?

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-02T16:47:34.453

**我的 Hacky 实验的第 2 版**

*这个新版本适用于任何字体，可以按需调整，以及任何文本区域大小。*

在注意到你们中的一些人仍在努力让它发挥作用后，我决定尝试一种新方法。这次我的结果要好得多——至少在 linux 上的 google chrome 上。我不再有可用的 Windows PC，所以我只能在 Ubuntu 上的 chrome / firefox 上进行测试。我的结果在 Chrome 上 100% 一致，假设在 Firefox 上大约 70-80%，但我不认为找到不一致会非常困难。

这个新版本依赖于一个 Canvas 对象。在我的[示例](http://enobrev.info/cursor2/)中，我实际上展示了那个画布 - 只是为了让您可以看到它的实际效果，但可以很容易地使用隐藏的画布对象来完成。

这肯定是一个 hack，我提前为我相当拼凑的代码道歉。至少，在谷歌浏览器中，它始终如一地工作，无论我将它设置为什么字体，或者 textarea 的大小。我使用[Sam Saffron](https://stackoverflow.com/users/17174/sam-saffron)的示例来显示光标坐标（灰色背景 div）。我还添加了一个“随机化”链接，因此您可以看到它以不同的字体/texarea 大小和样式工作，并实时观察光标位置更新。我建议您查看[完整页面演示](http://enobrev.info/cursor2/)，以便您可以更好地看到伴随画布的播放。

*我将总结它是如何工作*的......

基本思想是我们试图在画布上重绘文本区域，尽可能接近。由于浏览器对 texarea 和 texarea 都使用相同的字体引擎，我们可以使用 canvas 的字体测量功能来确定事物的位置。从那里，我们可以使用我们可用的画布方法来计算我们的坐标。

首先，我们调整画布以匹配文本区域的尺寸。这完全是出于视觉目的，因为画布大小并没有真正影响我们的结果。由于 Canvas 实际上并没有提供自动换行的方法，所以我不得不想出一种方法（一起窃取/借用/混淆）分解行以尽可能匹配文本区域。这是您可能会发现需要进行最多跨浏览器调整的地方。

自动换行后，其他一切都是基础数学。我们将这些行拆分为一个数组来模拟自动换行，现在我们想要遍历这些行并一直向下直到我们当前选择结束的点。为了做到这一点，我们只计算字符数，一旦超过`selection.end`，我们就知道我们已经走得够远了。将直到该点的行数乘以行高，您就有了一个`y`坐标。

坐标非常相似，`x`除了我们使用`context.measureText`. 只要我们打印出正确数量的字符，这将为我们提供绘制到 Canvas 的线条的宽度，该线条恰好在最后一个写出的字符之后结束，即当前`selection.end`位置之前的字符。

当尝试为其他浏览器调试时，要寻找的是线路没有正确中断的地方。您会在某些地方看到画布中一行的最后一个单词可能已经覆盖在文本区域上，反之亦然。这与浏览器如何处理自动换行有关。只要您在画布中进行包装以匹配文本区域，您的光标就应该是正确的。

我将在下面粘贴源代码。您应该能够复制和粘贴它，但如果您这样做了，我要求您下载自己的 jquery-fieldselection 副本，而不是点击我服务器上的那个。

我还增加[了一个新的演示](http://enobrev.info/cursor2/)和[小提琴](http://jsfiddle.net/9QAtz/)。

祝你好运！

```
<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <title>Tooltip 2</title>
        <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script type="text/javascript" src="http://enobrev.info/cursor/js/jquery-fieldselection.js"></script>
        <style type="text/css">
            form {
                float: left;
                margin: 20px;
            }

            #textariffic {
                height: 400px;
                width: 300px;
                font-size: 12px;
                font-family: 'Arial';
                line-height: 12px;
            }

            #tip {
                width:5px;
                height:30px;
                background-color: #777;
                position: absolute;
                z-index:10000
            }

            #mock-text {
                float: left;
                margin: 20px;
                border: 1px inset #ccc;
            }

            /* way the hell off screen */
            .scrollbar-measure {
                width: 100px;
                height: 100px;
                overflow: scroll;
                position: absolute;
                top: -9999px;
            }

            #randomize {
                float: left;
                display: block;
            }
        </style>
        <script type="text/javascript">
            var oCanvas;
            var oTextArea;
            var $oTextArea;
            var iScrollWidth;

            $(function() {
                iScrollWidth = scrollMeasure();
                oCanvas      = document.getElementById('mock-text');
                oTextArea    = document.getElementById('textariffic');
                $oTextArea   = $(oTextArea);

                $oTextArea
                        .keyup(update)
                        .mouseup(update)
                        .scroll(update);

                $('#randomize').bind('click', randomize);

                update();
            });

            function randomize() {
                var aFonts      = ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Impact', 'Times New Roman', 'Verdana', 'Webdings'];
                var iFont       = Math.floor(Math.random() * aFonts.length);
                var iWidth      = Math.floor(Math.random() * 500) + 300;
                var iHeight     = Math.floor(Math.random() * 500) + 300;
                var iFontSize   = Math.floor(Math.random() * 18)  + 10;
                var iLineHeight = Math.floor(Math.random() * 18)  + 10;

                var oCSS = {
                    'font-family':  aFonts[iFont],
                    width:          iWidth + 'px',
                    height:         iHeight + 'px',
                    'font-size':    iFontSize + 'px',
                    'line-height':  iLineHeight + 'px'
                };

                console.log(oCSS);

                $oTextArea.css(oCSS);

                update();
                return false;
            }

            function showTip(x, y) {
                $('#tip').css({
                      left: x + 'px',
                      top: y + 'px'
                  });
            }

            // https://stackoverflow.com/a/11124580/14651
            // https://stackoverflow.com/a/3960916/14651

            function wordWrap(oContext, text, maxWidth) {
                var aSplit = text.split(' ');
                var aLines = [];
                var sLine  = "";

                // Split words by newlines
                var aWords = [];
                for (var i in aSplit) {
                    var aWord = aSplit[i].split('\n');
                    if (aWord.length > 1) {
                        for (var j in aWord) {
                            aWords.push(aWord[j]);
                            aWords.push("\n");
                        }

                        aWords.pop();
                    } else {
                        aWords.push(aSplit[i]);
                    }
                }

                while (aWords.length > 0) {
                    var sWord = aWords[0];
                    if (sWord == "\n") {
                        aLines.push(sLine);
                        aWords.shift();
                        sLine = "";
                    } else {
                        // Break up work longer than max width
                        var iItemWidth = oContext.measureText(sWord).width;
                        if (iItemWidth > maxWidth) {
                            var sContinuous = '';
                            var iWidth = 0;
                            while (iWidth <= maxWidth) {
                                var sNextLetter = sWord.substring(0, 1);
                                var iNextWidth  = oContext.measureText(sContinuous + sNextLetter).width;
                                if (iNextWidth <= maxWidth) {
                                    sContinuous += sNextLetter;
                                    sWord = sWord.substring(1);
                                }
                                iWidth = iNextWidth;
                            }
                            aWords.unshift(sContinuous);
                        }

                        // Extra space after word for mozilla and ie
                        var sWithSpace = (jQuery.browser.mozilla || jQuery.browser.msie) ? ' ' : '';
                        var iNewLineWidth = oContext.measureText(sLine + sWord + sWithSpace).width;
                        if (iNewLineWidth <= maxWidth) {  // word fits on current line to add it and carry on
                            sLine += aWords.shift() + " ";
                        } else {
                            aLines.push(sLine);
                            sLine = "";
                        }

                        if (aWords.length === 0) {
                            aLines.push(sLine);
                        }
                    }
                }
                return aLines;
            }

            // http://davidwalsh.name/detect-scrollbar-width
            function scrollMeasure() {
                // Create the measurement node
                var scrollDiv = document.createElement("div");
                scrollDiv.className = "scrollbar-measure";
                document.body.appendChild(scrollDiv);

                // Get the scrollbar width
                var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;

                // Delete the DIV
                document.body.removeChild(scrollDiv);

                return scrollbarWidth;
            }

            function update() {
                var oPosition  = $oTextArea.position();
                var sContent   = $oTextArea.val();
                var oSelection = $oTextArea.getSelection();

                oCanvas.width  = $oTextArea.width();
                oCanvas.height = $oTextArea.height();

                var oContext    = oCanvas.getContext("2d");
                var sFontSize   = $oTextArea.css('font-size');
                var sLineHeight = $oTextArea.css('line-height');
                var fontSize    = parseFloat(sFontSize.replace(/[^0-9.]/g, ''));
                var lineHeight  = parseFloat(sLineHeight.replace(/[^0-9.]/g, ''));
                var sFont       = [$oTextArea.css('font-weight'), sFontSize + '/' + sLineHeight, $oTextArea.css('font-family')].join(' ');

                var iSubtractScrollWidth = oTextArea.clientHeight < oTextArea.scrollHeight ? iScrollWidth : 0;

                oContext.save();
                oContext.clearRect(0, 0, oCanvas.width, oCanvas.height);
                oContext.font = sFont;
                var aLines = wordWrap(oContext, sContent, oCanvas.width - iSubtractScrollWidth);

                var x = 0;
                var y = 0;
                var iGoal = oSelection.end;
                aLines.forEach(function(sLine, i) {
                    if (iGoal > 0) {
                        oContext.fillText(sLine.substring(0, iGoal), 0, (i + 1) * lineHeight);

                        x = oContext.measureText(sLine.substring(0, iGoal + 1)).width;
                        y = i * lineHeight - oTextArea.scrollTop;

                        var iLineLength = sLine.length;
                        if (iLineLength == 0) {
                            iLineLength = 1;
                        }

                        iGoal -= iLineLength;
                    } else {
                        // after
                    }
                });
                oContext.restore();

                showTip(oPosition.left + x, oPosition.top + y);
            }

        </script>
    </head>
    <body>

        <a href="#" id="randomize">Randomize</a>

        <form id="tipper">
            <textarea id="textariffic">Aliquam urna. Nullam augue dolor, tincidunt condimentum, malesuada quis, ultrices at, arcu. Aliquam nunc pede, convallis auctor, sodales eget, aliquam eget, ligula. Proin nisi lacus, scelerisque nec, aliquam vel, dictum mattis, eros. Curabitur et neque. Fusce sollicitudin. Quisque at risus. Suspendisse potenti. Mauris nisi. Sed sed enim nec dui viverra congue. Phasellus velit sapien, porttitor vitae, blandit volutpat, interdum vel, enim. Cras sagittis bibendum neque. Proin eu est. Fusce arcu. Aliquam elit nisi, malesuada eget, dignissim sed, ultricies vel, purus. Maecenas accumsan diam id nisi.

Phasellus et nunc. Vivamus sem felis, dignissim non, lacinia id, accumsan quis, ligula. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Sed scelerisque nulla sit amet mi. Nulla consequat, elit vitae tempus vulputate, sem libero rhoncus leo, vulputate viverra nulla purus nec turpis. Nam turpis sem, tincidunt non, congue lobortis, fermentum a, ipsum. Nulla facilisi. Aenean facilisis. Maecenas a quam eu nibh lacinia ultricies. Morbi malesuada orci quis tellus.

Sed eu leo. Donec in turpis. Donec non neque nec ante tincidunt posuere. Pellentesque blandit. Ut vehicula vestibulum risus. Maecenas commodo placerat est. Integer massa nunc, luctus at, accumsan non, pulvinar sed, odio. Pellentesque eget libero iaculis dui iaculis vehicula. Curabitur quis nulla vel felis ullamcorper varius. Sed suscipit pulvinar lectus.</textarea>

        </form>

        <div id="tip"></div>

        <canvas id="mock-text"></canvas>
    </body>
</html> 
```

**漏洞**

*我记得有一个错误。如果将光标放在一行的第一个字母之前，它会将“位置”显示为上一行的最后一个字母。这与 selection.end 的工作方式有关。我认为寻找那个案例并相应地修复它应该不会太难。*

* * *

**版本 1**

*将其留在这里，这样您就可以查看进度，而无需深入了解编辑历史记录。*

它并不完美，它绝对是一个 hack，但我让它在 WinXP IE、FF、Safari、Chrome 和 Opera 上运行良好。

据我所知，没有办法在任何浏览器上直接找出光标的 x/y。[Adam Bellaire](https://stackoverflow.com/users/21632/adam-bellaire)[提到](https://stackoverflow.com/questions/128342/display-div-at-cursor-position-in-textarea#128461)的[IE 方法](http://weblogs.asp.net/skillet/archive/2005/03/24/395838.aspx)很有趣，但不幸的是不是跨浏览器。我认为下一个最好的方法是将字符用作网格。

不幸的是，任何浏览器都没有内置字体度量信息，这意味着等宽字体是唯一具有一致度量的字体类型。此外，没有可靠的方法可以从字体高度找出字体宽度。起初我尝试使用高度的百分比，效果很好。然后我改变了字体大小，一切都变糟了。

我尝试了一种计算字符宽度的方法，即创建一个临时文本区域并继续添加字符，直到滚动高度（或滚动宽度）发生变化。这似乎是合理的，但在这条路的一半左右，我意识到我可以只使用 textarea 上的 cols 属性，并认为在这个考验中有足够的 hack 可以添加另一个。这意味着您不能通过 css 设置 textarea 的宽度。你必须使用 cols 才能工作。

我遇到的下一个问题是，即使您通过 css 设置字体，浏览器也会以不同的方式报告字体。不设置字体时，mozilla`monospace`默认使用，IE使用`Courier New`，Opera `"Courier New"`（带引号），Safari，`'Lucida Grand'`（带单引号）。当您确实将字体设置为`monospace`, mozilla 并接受您提供的内容时，Safari 会出现，`-webkit-monospace`而 Opera 会保留`"Courier New"`.

所以现在我们初始化一些变量。确保在 css 中也设置行高。Firefox 报告正确的行高，但 IE 报告“正常”，我没有打扰其他浏览器。我只是在我的css中设置了行高，这就解决了差异。我没有使用 ems 代替像素进行测试。字符高度只是字体大小。可能也应该在你的css中预先设置它。

此外，在我们开始放置角色之前还要进行一项预设——这真的让我摸不着头脑。对于 ie 和 mozilla，texarea 字符是 < cols，其他的都是 <= 字符。因此 Chrome 可以容纳 50 个字符，但 mozilla 和 ie 会中断最后一个单词。

现在我们将为每一行创建一个首字符位置数组。我们遍历文本区域中的每个字符。如果它是换行符，我们将一个新位置添加到我们的行数组中。如果它是一个空格，我们会尝试确定当前的“单词”是否适合我们所在的行，或者它是否会被推到下一行。标点符号算作“单词”的一部分。我没有测试过制表符，但是有一行可以为制表符添加 4 个字符。

一旦我们有一个行位置数组，我们循环并尝试找到光标在哪一行。我们使用选择的“结束”作为光标。

x = (光标位置 - 光标行的第一个字符位置) * 字符宽度

y = ((光标行 + 1) * 行高) - 滚动位置

我正在使用[jquery 1.2.6](http://docs.jquery.com/Downloading_jQuery)、[jquery-fieldselection](http://laboratorium.0xab.cd/jquery/fieldselection/0.1.0/test.html)和[jquery-dimensions](http://plugins.jquery.com/project/dimensions)

演示：[http ://enobrev.info/cursor/](http://enobrev.info/cursor/)

和代码：

```
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Tooltip</title>
        <script type="text/javascript" src="js/jquery-1.2.6.js"></script>
        <script type="text/javascript" src="js/jquery-fieldselection.js"></script>
        <script type="text/javascript" src="js/jquery.dimensions.js"></script>
        <style type="text/css">
            form {
                margin: 20px auto;
                width: 500px;
            }

            #textariffic {
                height: 400px;
                font-size: 12px;
                font-family: monospace;
                line-height: 15px;
            }

            #tip {
                position: absolute;
                z-index: 2;
                padding: 20px;
                border: 1px solid #000;
                background-color: #FFF;
            }
        </style>
        <script type="text/javascript">
            $(function() {
                $('textarea')
                    .keyup(update)
                    .mouseup(update)
                    .scroll(update);
            });

            function showTip(x, y) {                
                y = y + $('#tip').height();

                $('#tip').css({
                    left: x + 'px',
                    top: y + 'px'
                });
            }

            function update() {
                var oPosition = $(this).position();
                var sContent = $(this).val();

                var bGTE = jQuery.browser.mozilla || jQuery.browser.msie;

                if ($(this).css('font-family') == 'monospace'           // mozilla
                ||  $(this).css('font-family') == '-webkit-monospace'   // Safari
                ||  $(this).css('font-family') == '"Courier New"') {    // Opera
                    var lineHeight   = $(this).css('line-height').replace(/[^0-9]/g, '');
                        lineHeight   = parseFloat(lineHeight);
                    var charsPerLine = this.cols;
                    var charWidth    = parseFloat($(this).innerWidth() / charsPerLine);

                    var iChar = 0;
                    var iLines = 1;
                    var sWord = '';

                    var oSelection = $(this).getSelection();
                    var aLetters = sContent.split("");
                    var aLines = [];

                    for (var w in aLetters) {
                        if (aLetters[w] == "\n") {
                            iChar = 0;
                            aLines.push(w);
                            sWord = '';
                        } else if (aLetters[w] == " ") {    
                            var wordLength = parseInt(sWord.length);

                            if ((bGTE && iChar + wordLength >= charsPerLine)
                            || (!bGTE && iChar + wordLength > charsPerLine)) {
                                iChar = wordLength + 1;
                                aLines.push(w - wordLength);
                            } else {                
                                iChar += wordLength + 1; // 1 more char for the space
                            }

                            sWord = '';
                        } else if (aLetters[w] == "\t") {
                            iChar += 4;
                        } else {
                            sWord += aLetters[w];     
                        }
                    }

                    var iLine = 1;
                    for(var i in aLines) {
                        if (oSelection.end < aLines[i]) {
                            iLine = parseInt(i) - 1;
                            break;
                        }
                    }

                    if (iLine > -1) {
                        var x = parseInt(oSelection.end - aLines[iLine]) * charWidth;
                    } else {
                        var x = parseInt(oSelection.end) * charWidth;
                    }
                    var y = (iLine + 1) * lineHeight - this.scrollTop; // below line

                    showTip(oPosition.left + x, oPosition.top + y);
                }
            }

        </script>
    </head>
    <body>
        <form id="tipper">
            <textarea id="textariffic" cols="50">
Aliquam urna. Nullam augue dolor, tincidunt condimentum, malesuada quis, ultrices at, arcu. Aliquam nunc pede, convallis auctor, sodales eget, aliquam eget, ligula. Proin nisi lacus, scelerisque nec, aliquam vel, dictum mattis, eros. Curabitur et neque. Fusce sollicitudin. Quisque at risus. Suspendisse potenti. Mauris nisi. Sed sed enim nec dui viverra congue. Phasellus velit sapien, porttitor vitae, blandit volutpat, interdum vel, enim. Cras sagittis bibendum neque. Proin eu est. Fusce arcu. Aliquam elit nisi, malesuada eget, dignissim sed, ultricies vel, purus. Maecenas accumsan diam id nisi.

Phasellus et nunc. Vivamus sem felis, dignissim non, lacinia id, accumsan quis, ligula. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Sed scelerisque nulla sit amet mi. Nulla consequat, elit vitae tempus vulputate, sem libero rhoncus leo, vulputate viverra nulla purus nec turpis. Nam turpis sem, tincidunt non, congue lobortis, fermentum a, ipsum. Nulla facilisi. Aenean facilisis. Maecenas a quam eu nibh lacinia ultricies. Morbi malesuada orci quis tellus.

Sed eu leo. Donec in turpis. Donec non neque nec ante tincidunt posuere. Pellentesque blandit. Ut vehicula vestibulum risus. Maecenas commodo placerat est. Integer massa nunc, luctus at, accumsan non, pulvinar sed, odio. Pellentesque eget libero iaculis dui iaculis vehicula. Curabitur quis nulla vel felis ullamcorper varius. Sed suscipit pulvinar lectus. 
            </textarea>

        </form>

        <p id="tip">Here I Am!!</p>
    </body>
</html> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-10-26T08:23:48.027

**我不会再解释与这些东西相关的问题，因为它们在其他帖子中有很好的解释。只是会指出一个可能的解决方案，它有一些错误，但它是一个起点。**

幸运的是，Github 上有一个脚本可以计算插入符号相对于其容器的位置，但它需要 jQuery。**GitHub 页面在这里： [jquery-caret-position-getter，](https://github.com/beviz/jquery-caret-position-getter)**感谢 Bevis.Zhao。

基于它，我实现了下一个代码：**[在 jsFiddle.net](http://jsfiddle.net/mjerez/kBY75/)****中检查它**

```
<html><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>- jsFiddle demo by mjerez</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.js"></script>
    <link rel="stylesheet" type="text/css" href="http://jsfiddle.net/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="http://jsfiddle.net/css/result-light.css">   
    <script type="text/javascript" src="https://raw.github.com/beviz/jquery-caret-position-getter/master/jquery.caretposition.js"></script>     
    <style type="text/css">
        body{position:relative;font:normal 100% Verdana, Geneva, sans-serif;padding:10px;}
        .aux{background:#ccc;opacity: 0.5;width:50%;padding:5px;border:solid 1px #aaa;}
        .hidden{display:none}
        .show{display:block; position:absolute; top:0px; left:0px;}
    </style>
    <script type="text/javascript">//<![CDATA[ 
    $(document).keypress(function(e) {
        if ($(e.target).is('input, textarea')) {
            var key = String.fromCharCode(e.which);
            var ctrl = e.ctrlKey;
            if (ctrl) {
                var display = $("#autocomplete");
                var editArea = $('#editArea');            
                var pos = editArea.getCaretPosition();
                var offset = editArea.offset();
                // now you can use left, top(they are relative position)
                display.css({
                    left: offset.left + pos.left,
                    top:  offset.top + pos.top,
                    color : "#449"
                })
                display.toggleClass("show");
                return false;
            }
        }

    });
    window.onload = (function() {
        $("#editArea").blur(function() {
            if ($("#autocomplete").hasClass("show")) $("#autocomplete").toggleClass("show");
        })
    });
    //]]>  
    </script>
</head>
<body>
    <p>Click ctrl+space to while you write to diplay the autocmplete pannel.</p>
    </br>
    <textarea id="editArea" rows="4" cols="50"></textarea>
    </br>
    </br>
    </br>
    <div id="autocomplete" class="aux hidden ">
        <ol>
            <li>Option a</li>
            <li>Option b</li>
            <li>Option c</li>
            <li>Option d</li>
        </ol>
    </div>
</body> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-02-18T17:26:30.560

我在俄罗斯 JavaScript 网站上发布了一个与此问题相关的主题。

如果您不懂俄语，请尝试使用 Google 版本翻译：http://translate.google.ru/translate?js=y&prev=_t&hl=ru&ie=UTF-8&layout=1&eotf=1&u=http: [//javascript.ru/forum /events/7771-poluchit-koordinaty-kursora-v-tekstovom-pole-v-pikselyakh.html&sl=ru&tl=en](http://translate.google.ru/translate?js=y&prev=_t&hl=ru&ie=UTF-8&layout=1&eotf=1&u=http://javascript.ru/forum/events/7771-poluchit-koordinaty-kursora-v-tekstovom-pole-v-pikselyakh.html&sl=ru&tl=en)

翻译版本的代码示例中存在一些标记问题，因此您可以[阅读原始俄语帖子中的代码](http://javascript.ru/forum/events/7771-poluchit-koordinaty-kursora-v-tekstovom-pole-v-pikselyakh.html&sl=ru&tl=en)。

这个想法很简单。没有简单、通用和跨浏览器的方法来获取以像素为单位的光标位置。坦率地说，有，但仅适用于 Internet Explorer。

在其他浏览器中，如果您确实需要计算它，您必须...

*   创建一个不可见的 DIV
*   将文本框的所有样式和内容复制到该 DIV
*   然后在文本框中插入符号所在的文本中完全相同的位置插入 HTML 元素
*   获取该 HTML 元素的坐标

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-03-17T12:50:26.357

请注意，此问题与一个月前提出的问题重复，我已在**[此处](https://stackoverflow.com/a/22446703/1269037)**回答。我只会在那个链接上保留答案，因为这个问题应该在几年前就已经被关闭了。

### *答案副本*

[我已经为meteor-autocomplete](https://github.com/mizzao/meteor-autocomplete)寻找一个 textarea caret 坐标插件，所以我评估了 GitHub 上的所有 8 个插件。到目前为止，获胜者是来自**Component**[的 textarea-caret-position](https://github.com/component/textarea-caret-position)。

 **## 特征

*   像素精度
*   没有任何依赖
*   浏览器兼容性：Chrome、Safari、Firefox（尽管有[两个](https://bugzilla.mozilla.org/show_bug.cgi?id=753662) [错误](https://bugzilla.mozilla.org/show_bug.cgi?id=984275)）、IE9+；可以工作，但未在 Opera、IE8 或更早版本中测试
*   支持任何字体系列和大小，以及文本转换
*   文本区域可以有任意填充或边框
*   不会被文本区域中的水平或垂直滚动​​条弄糊涂
*   支持硬回车、制表符（IE 除外）和文本中的连续空格
*   比文本区域中的列长的行上的正确位置
*   换行时在行尾的[空白处](https://github.com/component/textarea-caret-position/blob/06d2197f85f96405b43724e56dc56f220c0092a5/test/position_off_after_wrapping_with_whitespace_before_EOL.gif)没有“幽灵”位置

### 这是一个演示 - [http://jsfiddle.net/dandv/aFPA7/](http://jsfiddle.net/dandv/aFPA7/)

![在此处输入图像描述](https://i.stack.imgur.com/LJiUS.png)

## 这个怎么运作

镜子`<div>`是在屏幕外创建的，其样式与`<textarea>`. 然后，直到插入符号的文本区域的文本被复制到 div 中，并在`<span>`其后插入 a。然后，将 span 的文本内容设置为 textarea 中文本的其余部分，以便忠实地再现假 div 中的换行。

这是保证处理所有与换行长线有关的边缘情况的唯一方法。GitHub 也使用它来确定其@user 下拉列表的**位置**。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-10-24T21:48:31.967

这个[博客](http://kirblog.idetalk.com/2010/03/calculating-cursor-position-in-textarea.html)似乎也很接近回答这个问题。我自己没有尝试过，但作者说它在 FF3、Chrome、IE、Opera、Safari 上进行了测试。代码在[GitHub 上](https://github.com/kir/js_cursor_position)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-10-27T20:51:43.230

在这里修复它：http: [//jsfiddle.net/eMwKd/4/](http://jsfiddle.net/eMwKd/4/)

唯一的缺点是已经提供的功能`getCaret()`解决了键按下的错误位置。因此，除非您松开按键，否则红色光标似乎位于真实光标的后面。

我会再调查一下。

更新：嗯，如果行太长，自动换行不准确..

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T17:18:41.960

[这篇](http://geekswithblogs.net/svanvliet/archive/2005/03/24/textarea-cursor-position-with-javascript.aspx)博文似乎解决了你的问题，但不幸的是作者承认他只在 IE 6 中测试过。

> IE 中的 DOM 不提供有关字符相对位置的信息；但是，它确实为浏览器呈现的控件提供了边界和偏移值。因此，我使用这些值来确定字符的相对边界。然后，使用 JavaScript TextRange，我创建了一种机制来使用这些度量来计算给定 TextArea 内固定宽度字体的行和列位置。
> 
> 首先，必须根据所使用的固定宽度字体的大小来计算 TextArea 的相对边界。为此，必须将 TextArea 的原始值存储在本地 JavaScript 变量中并清除该值。然后，创建一个 TextRange 以确定 TextArea 的顶部和左侧边界。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-10-30T19:14:05.753

有关于插入符号偏移的一种技巧的描述： [Textarea X/Y 插入符号坐标 - jQuery 插件](https://stackoverflow.com/questions/3510009/textarea-caret-coordinates-jquery)

`contenteditable`如果您可以使用 html5 功能，那么使用带有属性的 div 元素会更好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-26T00:06:13.177

我不知道解决方案，`textarea`但它确实适用于`div`with **`contenteditable`**。

您可以使用`Range`API。像这样：（是的，你真的只需要这 3 行代码）

```
// get active selection
var selection = window.getSelection();
// get the range (you might want to check selection.rangeCount
// to see if it's popuplated)
var range = selection.getRangeAt(0);

// will give you top, left, width, height
console.log(range.getBoundingClientRect()); 
```

我不确定浏览器的兼容性，但我发现它适用于最新的 Chrome、Firefox 甚至 IE7（我想我测试了 7，否则是 9）。

你甚至可以做这样的“疯狂”事情：如果你正在打字`"#hash"`并且光标在最后一个`h`，你可以在当前范围内查找`#`字符，将范围向后移动一个`n`字符并获取该范围的*边界矩形*，这将使popup-div 似乎“坚持”这个词。

一个小缺点是`contenteditable`有时可能有点错误。光标喜欢去不可能的地方，你现在必须处理 HTML 输入。但我确信浏览器供应商会解决这些问题，因为更多的网站开始使用它们。

我可以给出的另一个提示是：查看[`rangy`](http://code.google.com/p/rangy/)库。它试图成为一个功能齐全的交叉兼容范围库。你*不需要*它，但如果你正在处理旧浏览器，它可能值得你花时间。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-10-28T18:13:54.287

也许这会让你满意，它会告诉你选择的位置和光标的位置，所以尝试检查计时器以获得自动位置或通过单击获取选择按钮取消选中以获得位置

```
 <form>
 <p>
 <input type="button" onclick="evalOnce();" value="Get Selection">
timer:
<input id="eval_switch" type="checkbox" onclick="evalSwitchClicked(this)">
<input id="eval_time" type="text" value="200" size="6">
ms
</p>
<textarea id="code" cols="50" rows="20">01234567890123456789012345678901234567890123456789 01234567890123456789012345678901234567890123456789 01234567890123456789012345678901234567890123456789 01234567890123456789012345678901234567890123456789 01234567890123456789012345678901234567890123456789 Sample text area. Please select above text. </textarea>
<textarea id="out" cols="50" rows="20"></textarea>
</form>
<div id="test"></div>
<script>

function Selection(textareaElement) {
this.element = textareaElement;
}
Selection.prototype.create = function() {
if (document.selection != null && this.element.selectionStart == null) {
return this._ieGetSelection();
} else {
return this._mozillaGetSelection();
}
}
Selection.prototype._mozillaGetSelection = function() {
return {
start: this.element.selectionStart,
end: this.element.selectionEnd
 };
 }
Selection.prototype._ieGetSelection = function() {
this.element.focus();
var range = document.selection.createRange();
var bookmark = range.getBookmark();
var contents = this.element.value;
var originalContents = contents;
var marker = this._createSelectionMarker();
while(contents.indexOf(marker) != -1) {
marker = this._createSelectionMarker();
 }
var parent = range.parentElement();
if (parent == null || parent.type != "textarea") {
return { start: 0, end: 0 };
}
range.text = marker + range.text + marker;
contents = this.element.value;
var result = {};
result.start = contents.indexOf(marker);
contents = contents.replace(marker, "");
result.end = contents.indexOf(marker);
this.element.value = originalContents;
range.moveToBookmark(bookmark);
range.select();
return result;
}
Selection.prototype._createSelectionMarker = function() {
return "##SELECTION_MARKER_" + Math.random() + "##";
}

var timer;
var buffer = "";
function evalSwitchClicked(e) {
if (e.checked) {
evalStart();
} else {
evalStop();
}
}
function evalStart() {
var o = document.getElementById("eval_time");
timer = setTimeout(timerHandler, o.value);
}
function evalStop() {
clearTimeout(timer);
}
function timerHandler() {
clearTimeout(timer);
var sw = document.getElementById("eval_switch");
if (sw.checked) {
evalOnce();
evalStart();
}
}
function evalOnce() {
try {
var selection = new Selection(document.getElementById("code"));
var s = selection.create();
var result = s.start + ":" + s.end;
buffer += result;
flush();
 } catch (ex) {
buffer = ex;
flush();
}
}
function getCode() {
// var s.create()
// return document.getElementById("code").value;
}
function clear() {
var out = document.getElementById("out");
out.value = "";
}
function print(str) {
buffer += str + "\n";
}
function flush() {
var out = document.getElementById("out");
out.value = buffer;
buffer = "";
 } 
</script> 
```

看这里的演示：[jsbin.com](http://jsbin.com/obekot/2/edit)

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2012-10-31T05:11:08.630

将 span 元素附加到克隆 div 并根据此 span 的偏移量设置假光标怎么样？我在[这里](http://jsfiddle.net/2Rzfb/2/)更新了你的小提琴。这里也只是 JS 位

```
// http://stackoverflow.com/questions/263743/how-to-get-caret-position-in-textarea
var map = [];
var pan = '<span>|</span>'

//found @ http://davidwalsh.name/detect-scrollbar-width

function getScrollbarWidth() {
    var scrollDiv = document.createElement("div");
    scrollDiv.className = "scrollbar-measure";
    document.body.appendChild(scrollDiv);

    // Get the scrollbar width
    var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;

    // Delete the DIV 
    document.body.removeChild(scrollDiv);

    return scrollbarWidth;
}

function getCaret(el) {
    if (el.selectionStart) {
        return el.selectionStart;
    } else if (document.selection) {
        el.focus();

        var r = document.selection.createRange();
        if (r == null) {
            return 0;
        }

        var re = el.createTextRange(),
            rc = re.duplicate();
        re.moveToBookmark(r.getBookmark());
        rc.setEndPoint('EndToStart', re);

        return rc.text.length;
    }
    return 0;
}

$(function() {
    var span = $('#pos span');
    var textarea = $('textarea');

    var note = $('#note');

    css = getComputedStyle(document.getElementById('textarea'));
    try {
        for (i in css) note.css(css[i]) && (css[i] != 'width' && css[i] != 'height') && note.css(css[i], css.getPropertyValue(css[i]));
    } catch (e) {}

    note.css('max-width', '300px');
    document.getElementById('note').style.visibility = 'hidden';
    var height = note.height();
    var fakeCursor, hidePrompt;

    textarea.on('keyup click', function(e) {
        if (document.getElementById('textarea').scrollHeight > 100) {
            note.css('max-width', 300 - getScrollbarWidth());
        }

        var pos = getCaret(textarea[0]);

        note.text(textarea.val().substring(0, pos));
        $(pan).appendTo(note);
        span.text(pos);

        if (hidePrompt) {
            hidePrompt.remove();
        }
        if (fakeCursor) {
            fakeCursor.remove();
        }

        fakeCursor = $("<div style='width:5px;height:30px;background-color: #777;position: absolute;z-index:10000'>&nbsp;</div>");

        fakeCursor.css('opacity', 0.5);
        fakeCursor.css('left', $('#note span').offset().left + 'px');
        fakeCursor.css('top', textarea.offset().top + note.height() - (30 + textarea.scrollTop()) + 'px');

        hidePrompt = fakeCursor.clone();
        hidePrompt.css({
            'width': '2px',
            'background-color': 'white',
            'z-index': '1000',
            'opacity': '1'
        });

        hidePrompt.appendTo(textarea.parent());
        fakeCursor.appendTo(textarea.parent());

        return true;
    });
}); 
```

**更新** ：如果第一行不包含硬换行符，我可以看到有一个错误，但如果它确实运行良好。

# c# - 有没有更好的方法在不使用 Add 方法的情况下在 .NET 中初始化 Hastable？

> ID：128343
> 
> 赞同：22
> 
> 时间：2008-09-24T16:55:45.837
> 
> 标签：c#

我目前正在通过以下方式初始化 Hashtable：

```
Hashtable filter = new Hashtable();
filter.Add("building", "A-51");
filter.Add("apartment", "210"); 
```

我正在寻找一种更好的方法来做到这一点。

我尝试了类似的东西

```
Hashtable filter2 = new Hashtable() {
    {"building", "A-51"},
    {"apartment", "210"}
}; 
```

但是上面的代码无法编译。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-24T17:07:46.963

您发布的确切代码：

```
 Hashtable filter2 = new Hashtable()
        {
            {"building", "A-51"},
            {"apartment", "210"}
        }; 
```

在 C# 3 中完美编译。鉴于您报告了编译问题，我猜您正在使用 C# 2？在这种情况下，您至少可以这样做：

```
 Hashtable filter2 = new Hashtable();
        filter2["building"] = "A-51";
        filter2["apartment"] = "210"; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-24T16:59:49.510

在 C# 3 中，它应该像这样编译：

```
Hashtable table = new Hashtable {{1, 1}, {2, 2}}; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T17:02:02.890

（不是 C# 专家）

这是语法糖，如果它是语法糖，我希望映射（在哈希表中）很好且明显：

```
Hashtable filter2 = new Hashtable() { "building" => "A-51", "apartment" => "210"};

```

但是我认为这并没有真正的需要，只需在初始化后调用 add 并没有太大的问题。

（我知道人们在过去使用 Java 编译器来为 Java 实现类似的事情（这导致几年后迁移到 Java 5 的主要问题），但我希望这不是 C# 的选项！）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T17:23:56.363

我不知道 C# 3.0`Hashtable table = new Hashtable {{1, 1}, {2, 2}};`会编译。

无论如何，穷人的实现：

嗯，你可以扩展 Hashtable 类：

```
class MyHashTable : System.Collections.Hashtable    
{
    public MyHashTable(string [,] values)
    {
        for (int i = 0; i < (values.Length)/2; i++)
        {
            this.Add(values[i,0], values[i,1]);
        }
    }
} 
```

然后从控制台应用程序：

```
 class Program
{
    static void Main(string[] args)
    {
        string[,] initialize = { { "building", "A-51" }, { "apartment", "210" }, {"wow", "nerf Druids"}};

        MyHashTable myhashTable = new MyHashTable(initialize);
        Console.WriteLine(myhashTable["building"].ToString());
        Console.WriteLine(myhashTable["apartment"].ToString());
        Console.WriteLine(myhashTable["wow"].ToString());
        Console.ReadKey();

    }
} 
```

将导致：
A-51
210
nerf Druids

这是很快完成的，所以它可能会在某些情况下爆炸，但又一次..

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-24T17:21:57.507

我认为被问到的真正问题可能是关于可想象的构造函数，例如：

HashTable ht = new HashTable(MyArray) ; // 从数组中填充

HashTable ht = new HashTable(MyDataTable) ; // 从数据表中填充

AFAIK，答案是“不”，但你可以自己写。我认为此类方法不在库中的原因是 Array 或 DataTable 必须正确形成。这并不是什么大损失，因为这些方法的任何实现都可能在循环中使用 Add 方法。

# language-agnostic - How do I find the center of a number of geographic points?

> ID：128348
> 
> 赞同：19
> 
> 时间：2008-09-24T16:56:45.803
> 
> 标签：language-agnostic, geometry, gis, point, arcgis-js-api

If I have a series of points as longitude and latitude, how would I calculate the center of all of those points?

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-24T17:42:12.997

[Geomidpoint](http://www.geomidpoint.com/calculation.html)涵盖了 3 种不同的计算方法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-24T17:24:54.643

有几个人回答要取经纬度的平均值。这是一种正确的想法，但[在 sphere 上的手段更加复杂](http://en.wikipedia.org/wiki/Directional_statistics)。

纬度/经度表示本质上是人为的并且有不连续性（在两极，如果你不小心的话，在本初子午线对面），所以它似乎不太可能（对我来说）有一个合理的几何解释. 我认为你需要做一些事情，比如在地心坐标中平均矢量，然后对结果进行归一化以将其放回球体上。

我希望在这些问题上有更多经验的人可以更具体地发表评论。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T18:37:18.120

不要只取平均值。

您可以转换为 3d 坐标，然后取平均值（x、y 和 z 坐标），然后将其投影回球体并将其转换回纬度/经度。

[关于球坐标](http://en.wikipedia.org/wiki/Spherical_coordinate_system)的维基百科页面有转换算法。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T17:03:12.933

First off, you need to define which centre you're interested in. Take these two points:

```
A.                          .B 
```

The centre is easy, it's halfway between them. Now add a third point:

```
A. C.                       .B 
```

Is the centre still halfway between A and B or is it weighted towards A because of C? So is the centre the point nearest to all points or just the points on the enclosing polygon?

Also, as it's long/lat you're dealing with the points are on a surface of a sphere so the distance between long 0 and long 90 degrees is much greater at lat 0 than at lat 45 degrees.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T17:04:09.937

您可能正在寻找由点定义的简单多边形的[质心。](http://en.wikipedia.org/wiki/Centroid)该文章中有关于如何计算各种几何形状的信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-10-24T20:31:42.793

如果您以下列形式提出问题，Wolfram Alpha 将为您执行此操作： 具有顶点的多边形的质心：(X, Y), (X, Y), (X, Y), (X, Y), (X, Y) 等。

只需记住先将每个“（X，Y）”转换为十进制形式。Wolfram Alpha 将以十进制形式返回答案，然后您可以将其复制并粘贴到 Google 地球中。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-24T16:59:25.580

See Moe's answer, although if your points are distributed across the globe, you'll have to be satisfied that your center tends towards the Prime Meridian and not the International Date Line.

# .net - 字符串格式日期 - C# 或 VB.NET

> ID：128349
> 
> 赞同：3
> 
> 时间：2008-09-24T16:56:48.767
> 
> 标签：.net, string, formatting

从数据库中出来的日期，需要格式化为“mm/dd/yy”

```
For Each dr as DataRow in ds.Tables(0).Rows

Response.Write(dr("CreateDate"))

Next 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-24T17:00:01.600

```
string.Format( "{0:MM/dd/yy}", dr("CreateDate") ) 
```

编辑：如果 dr("CreateDate") 是 DBNull，则返回 ""。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T16:59:01.680

Convert.ToDateTime(dr("CreateDate")).ToShortDate()

有关可从 DateTime 数据类型获得的其他功能，请参阅 MSDN 文档，包括可通过“ToString”功能获得的自定义格式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T16:58:49.963

```
Response.Write(DateTime.Parse(dr("CreateDate").ToString()).ToString("MM/dd/yyyy")) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T16:59:25.843

简单的：

```
((DateTime)dr["CreateDate"]).ToString("MM/dd/yyyy") 
```

// 我也会在做之前检查它是否不是 dbnull

```
if (! DBNull.Value.Equals(dr["CreateDate"])) // blah blah 
```

# php - PHP：将 preg_replace 与 htmlentities 一起使用

> ID：128350
> 
> 赞同：3
> 
> 时间：2008-09-24T16:57:11.823
> 
> 标签：php, regex

我正在写一个`RSS`to `JSON parser`，作为其中的一部分，我需要`htmlentities()`在 description 标签内找到的任何标签上使用。目前，我正在尝试使用`preg_replace()`，但我有点挣扎。我当前的（非工作）代码如下所示：

```
$pattern[0] = "/\<description\>(.*?)\<\/description\>/is";
$replace[0] = '<description>'.htmlentities("$1").'</description>';
$rawFeed = preg_replace($pattern, $replace, $rawFeed); 
```

如果您对此也有更优雅的解决方案，请分享。谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T17:00:36.107

简单的。使用`preg_replace_callback`：

```
function _handle_match($match)
{
    return '<description>' . htmlentities($match[1]) . '</description>';
}

$pattern = "/\<description\>(.*?)\<\/description\>/is";
$rawFeed = preg_replace_callback($pattern, '_handle_match', $rawFeed); 
```

它接受任何回调类型，类中的方法也是如此。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T17:09:13.480

更优雅的解决方案是使用[SimpleXML](http://php.net/simplexml)。或者第三方库，例如[XML_Feed_Parser](http://pear.php.net/package/XML_Feed_Parser)或[Zend_Feed](http://framework.zend.com/manual/en/zend.feed.html)来解析提要。

这是一个 SimpleXML 示例：

```
<?php
$rss = file_get_contents('http://rss.slashdot.org/Slashdot/slashdot');
$xml = simplexml_load_string($rss);

foreach ($xml->item as $item) {
    echo "{$item->description}\n\n";
}
?> 
```

请记住，RSS、RDF 和 Atom 看起来不同，这就是为什么使用我提到的上述库之一是有意义的。

# windows-vista - 开发时，Vista中是否关闭UAC？

> ID：128352
> 
> 赞同：6
> 
> 时间：2008-09-24T16:57:49.170
> 
> 标签：windows-vista, uac

我直到 5 月左右才升级到 Vista，而我在现实生活中经常听到的开发人员说的其中一件事是“你应该做的第一件事就是关闭 UAC 垃圾”

好吧，出于几个原因，我一直把它放在一边。首先，如果我做了一些愚蠢的事情，比如暂时失去理智并运行电子邮件中的附件，或者如果我查看某个站点遇到了一些未修补的漏洞，则可以作为故障保险。其次，作为一项大型实验，看看它到底是好是坏。

最后，我认为它强制执行了一些更好的实践。我曾经在 Windows 中直接在 inetpub\wwwroot 中开发每个网站（Visual Studio .NET 2003 或多或少需要这个），但现在我在其他地方开发它们，因为 UAC clickfest 是一场噩梦。我认为这是微软的说法“你*真的*应该这样做”。

打个比方——如果您编写了一个在 XP 和 2000 上运行的 Web 应用程序，但需要关闭 Server 2003 的 50 种不同的安全功能，那么真正的解决方案可能是只修复应用程序，使其不会t 要求关闭安全功能。

但是现在我不得不使用一个应用程序，该应用程序实际上并不是为了**在**inetpub/wwwroot 之外开发而设计的，所以 UAC 真的很麻烦。纠正这一点超出了项目的范围。我想坚持我的立场并让 UAC 保持打开状态，但我也担心每次需要修改文件时都会自动单击“是”或“允许”三次。

我只是头脑简单吗？Vista 上的大多数开发人员是打开还是关闭 UAC？对于上面描述的例子，有没有更好/更简单的方法？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-24T16:59:14.440

我认为有必要在测试机器上保留 UAC，这样您就可以看到真实用户在使用您的应用程序时会看到什么。然而，我在我的开发机器上关闭了它，因为我发现它会分散注意力，并且我相信自己足够不需要它。

（希望您的测试机器！=您的开发机器，对吗？）

说了这么多，我支持 UAC，我不建议其他人关闭它，尤其是“普通用户”。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-28T00:51:27.423

我在标准用户帐户中编码，并打开了 UAC。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T16:58:34.910

不，我不关闭 UAC。

使用 IIS 编程 C# winform 和 web。数据库是progresql。无需为 UAC 烦恼。有些程序只需要1个授权，没什么大不了的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T18:21:21.560

我保持 UAC 开启。我发现在类似于我的最终用户的环境中进行开发很有用。这样，如果我编写任何试图从受限区域读取/写入的代码，我会更快地了解它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T17:08:33.873

刚开始使用新系统时，UAC 非常烦人。问题是，当您第一次开始新安装时，您需要设置各种程序并调整设置。您似乎每 5 分钟看到一次 UAC 提示。

过了一会儿，发生了两件事：

1.  你没有设置那么多新东西。
2.  你已经习惯了提示。

在这一点上，UAC 不再那么糟糕了。我开启了 UAC，但在过去几周内我只看到了一两个提示。完美是正确的：如果我看到一个我没想到的提示，我会确保我*真的*想继续。

我会争辩说，第二种效果会破坏目的。他们*应该*做的是默认禁用 UAC，但仅限第一个月。在第一个月提示您打开 UAC 之后，不真正阅读内容的人的默认选项是打开它。这样人们就不会在他们的设置期间感到烦恼，并且更容易对你想用 UAC 做什么做出明智的选择。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T17:00:17.357

我把它留在

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T17:04:58.967

我将其保持打开状态，但将其设置为在必要时自动提升权限。这是一个很好的区别，但仍然是一个区别。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T17:06:55.077

Microsoft SQL Server 等服务以管理员权限运行。另一方面，Visual Studio 没有。大多数开发人员工具也没有。

我大量使用虚拟机来**1)**确保我的开发环境始终是安全的，以及**2)**测试有可能离开我的机器 FUBAR 的软件。**3）**为了限制停机时间，恢复我的开发环境，“*如果我做了一些愚蠢的事情，比如暂时失去理智并从电子邮件中运行附件”* :)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-24T17:16:17.643

[按照http://www.win2008workstation.com/wordpress/](http://www.win2008workstation.com/wordpress/)上的建议，我一直在我的工作站中使用 Windows 2008，它对我来说非常有用。我不记得关闭了 UAC，但我肯定没有遭受过这种情况，所以我猜它已经关闭了。

正如其他人所说，您确实需要将测试 [虚拟] 机器配置为尽可能接近您的用户将拥有的机器，这样您在部署应用程序时不会有任何意外。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-24T17:21:07.603

我认为您是否这样做应该取决于您的应用程序的目标受众，尽管我完全可以理解人们禁用它。

如果您的所有用户都在禁用 UAC 的情况下运行 Vista，那么我认为您可以关闭它，但这可能是不现实的 - 或可取的。另一方面，我们的应用程序被大量的人使用，从 Win2k 开始，Windows 的每个可能的版本和配置，显然包括 Vista 和 Server 2008。因为我们是一个无法控制用户的 ISV ' 环境，或者关于管理它们的权限和管理的策略，我总是让 UAC 处于启用状态——即使它有时让我非常恼火——因为这样我就知道它可能会导致人们更快地使用我们的应用程序而不是之后。

免责声明：我的大部分实际编码时间都花在了 Windows XP 上，尽管我的桌下有一台 Vista 64 位测试机，我每天都用它来进行测试。一般来说，我会在 20-30% 的时间里使用这个盒子。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-24T17:50:07.080

开发还是不开发——是我安装 vista 后做的第一件事。充其量只是看起来很烦人。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-24T17:51:29.400

而不是运行防病毒软件来消耗我的 CPU 周期（我需要尽可能多的 RDP 和 VM 一直在运行）。我只是让 UAC 保持打开状态，以确保仔细检查并确保只有某些东西运行。它不仅如此，它还限制程序对敏感区域的访问，因此如果没有您通过 UAC 允许，程序基本上不能破坏您的系统。我还没有遇到问题，我的系统只运行我需要它运行的东西，快速而平稳。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-24T17:07:06.543

这对我来说太烦人了，一安装Vista就关闭了。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-24T17:19:36.810

我一安装操作系统就关闭它。无休止的模态对话框的安全性根本没有安全性。普通用户在几周左右后习惯于点击更多的“确定”按钮。

编辑：哇，被否决了是吧？一定是附近的一些微软员工......当然它应该留在测试机器上，可能应该提到这一点。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-24T18:02:10.890

我在我正在使用的计算机上将其关闭。

测试时，我在目标环境中进行测试，这意味着我可能会打开或关闭 UAC。

我认为使用它进行开发没有任何好处。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-24T18:19:01.363

我发现它非常烦人并一直将其关闭，我相信自己足够不必安装故障保险柜。如果我搞砸并运行一些狡猾的应用程序，那是我的坏事，我将承担后果。与此同时，我不会花 5 分钟的时间来点击一些该死的烦人的弹出窗口。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-26T07:41:44.000

我把它关掉了，但那是因为我太相信自己了。虽然很有趣，但它似乎让普通用户（我住在德克萨斯州的 Jourdanton，我们这里有很多“普通用户”在偏僻的地方）害怕控制面板，因为它会导致所有这些奇怪的提示出现如果他们开始四处寻找，每 5 分钟想要一次他们的密码。

也就是说，我认为这取决于您对该系统的专业知识水平。在您的开发机器上，是的，绝对要关闭该死的东西。这周我没有一天不需要安装或更新一些软件，而且我不喜欢不得不将自己提升到管理员身份来这样做。

我*真正*想要的是让它提升一段时间的能力，或者说在我注销时自动重新打开，这样我就可以在不被打扰的情况下完成整个会话的安装工作，然后是安全的再次当我完成并且（不可避免地）不得不重新启动机器时，这似乎是现在 Windows 安装程序的常见做法。

除了所有的咆哮之外，我认为对于您的测试机器，它绝对应该开启。不是因为我一定同意该功能（就像我同意管理员帐户应该永久禁用一样，我太喜欢该帐户了），而是因为用户很可能将其打开，并且您需要查看您的通过他们的眼睛编程。如果您的程序需要提升，例如更改设置或修改某个目录，则尤其如此，以便您可以提示用户接受程序中的 UAC 警告，这为用户增加了一层额外的舒适感我认为。

哦，至于一个节目，让我稍微谈谈你。程序不应该在主头文件中的某处有一个定义，告诉它它的“工作目录”在哪里吗？如果情况已经如此，那么为什么将工作目录更改到其他地方这么难呢？如果不是这种情况，那就太丢脸了，你应该去解决这个问题。^_^ 那会为你省去很多麻烦。

-尼古拉斯

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-26T12:25:30.670

我遇到了我们的构建脚本执行操作注册表项或向 GAC 添加内容等问题。我们正试图摆脱这些东西，但在我们这样做之前，它就在那里并且需要特权升级。因此，构建脚本从管理员命令窗口运行。当我打开 Visual Studio 2008 并尝试构建应用程序的一部分时，问题就出现了 - 我不能作为普通用户，因为输出文件无法被覆盖，因为管理控制台中的构建以更高的速度生成了相同的文件特权级别。这让我很沮丧，我认为最好的方法是暂时关闭 UAC，但我非常不愿意这样做。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-28T00:40:25.793

因为我有构建后脚本可以将可执行文件复制到 Program Files 目录中进行测试，所以我以提升的权限运行 Visual Studio。

我发现一个让生活更轻松的技巧是，使用提升的权限快速启动命令提示符，您可以：

1.  按窗口键
2.  键入“命令”
3.  按 Ctrl+Shift+Enter
4.  左光标键（右小指）移动到 UAC 对话框上的“继续”按钮
5.  进入

我总是打开一个来启动我的 IDE 和运行构建脚本。

我发现的唯一缺点是提升的窗口不会与我的一些窗口调整软件（如[KatMouse](http://ehiti.de/katmouse/)和[Switcher](http://insentient.net/) ）进行交互。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-28T00:45:09.293

不，但我确实更改了一些设置：

*   如果不在管理员组中，则不要提示提升。
*   如果您是 [machine]\administrator，则自动升级

我不把自己放在管理员组中。突出一个普通的老用户，没有提升提示。

在开发服务器上使用 Run As 开发/调试 Web 应用程序

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-28T01:01:19.817

我在关闭 UAC 的情况下进行编码。当我打开visual studio或star uml，或者只是想更改我机器中的设置时，我发现看到所有这些弹出窗口很烦人。我一直在安装一个很好的互联网安全套件，让我在我的机器上保持“无病毒”多年，我认为在我做的每项任务上总是提示“你确定”没有意义。我同意 Ed 的观点，因为每个人都点击确定。

示例：为您的某些家庭成员安装防火墙。当他们被提示应用程序 XYZ 是否可以连接到互联网时，他们将单击是。他们不会区分好的应用程序和间谍软件/病毒。UAC 也是如此。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2012-03-12T07:30:50.037

我打开 UAC，但将 VS 设置为始终以管理员身份运行。我这样做的唯一真正原因是我主要从事需要管理员权限才能运行的软件。（是的，我知道这应该是少数，但我的应用恰好是其中之一——它是一个软实时硬件控制器。）

对于通用应用程序，您必须至少在启用 UAC 的情况下进行测试；虽然您可以在单独的机器上执行此操作，但在您的开发机器上进行测试更容易。而且提示并不是那么强加，特别是如果您禁用“安全桌面”选项（启用时大多数显卡的反应非常缓慢）。

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2012-07-26T14:25:01.737

如果您继续使用 Vista，请关闭 UAC 并依靠 Microsoft Security Essentials 的实时监视器来拦截任何想要更改您的系统的内容。或者，升级到 Win7，您可以在其中保留 UAC 并控制您希望 UAC 通知和中断执行的级别。

编辑：无论如何，利用 Windows 计算机非常容易，那么如果 UAC 真的不能保证保护，那么打开 UAC 有什么意义呢？

# bash - 计算文件中令牌出现的次数

> ID：128365
> 
> 赞同：9
> 
> 时间：2008-09-24T16:59:26.157
> 
> 标签：bash, shell, grep

我有一个服务器访问日志，带有每个 http 请求的时间戳，我想获得每秒请求数的计数。使用`sed`, 和`cut -c`，到目前为止，我已经设法将文件缩减为时间戳，例如：

> 2008 年
> 9 月 22 日 20:00:21 +0000 2008 年 9 月22 日 20:00:22 +0000
> 2008 年 9 月 22 日 20:00:22 +0000 2008 年
> 9 月 22 日 20:00:22 +0000
> 22- 2008 年 9 月 20:00:24 +0000
> 2008 年 9 月 22 日 20:00:24 +0000

我想得到的是每个唯一时间戳在文件中出现的次数。例如，对于上面的示例，我希望得到如下所示的输出：

> 2008 年 9 月 22 日 20:00:21 +0000：1
> 2008 年 9 月 22 日 20:00:22 +0000：3 2008 年
> 9 月 22 日 20:00:24 +0000:2

我曾经`sort -u`将时间戳列表过滤为唯一令牌列表，希望我可以使用 grep 之类的

```
grep -c -f <file containing patterns> <file> 
```

但这只会产生全部匹配行中的一行。

我知道这可以在一行中完成，将几个实用程序串在一起......但我想不出哪个。有人知道吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-24T17:04:23.227

我想你正在寻找

```
uniq --count 
```

> -c, --count 前缀行的出现次数

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T17:08:21.080

将 AWK 与关联数组一起使用可能是解决此类问题的另一种方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T17:15:51.623

以防万一您希望以最初指定的格式输出（最后出现的次数）：

```
uniq -c logfile | sed 's/\([0-9]+\)\(.*\)/\2: \1/' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T08:11:25.943

使用[awk](http://www.gnu.org/software/gawk/manual/gawk.html)：

```
cat file.txt | awk '{count[$1 " " $2]++;} \
                    END {for(w in count){print w ": " count[w]};}' 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-10-01T13:05:55.733

汤姆的解决方案：

```
awk '{count[$1 " " $2]++;} END {for(w in count){print w ": " count[w]};}' file.txt 
```

工作更普遍。

我的文件没有排序：

```
name1 
name2 
name3 
name2 
name2 
name3 
name1 
```

因此，事件并没有相互跟踪，并且`uniq`无法正常工作：

```
1 name1 
1 name2 
1 name3 
2 name2 
1 name3 
1 name1 
```

但是，使用 awk 脚本：

```
name1:2 
name2:3 
name3:2 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-24T17:04:50.777

也许使用xargs？不能在这里当场将所有内容放在我的脑海中，但是在您的 sort -u 上使用 xargs 以便对于每个唯一的秒，您可以 grep 原始文件并执行 wc -l 来获取数字。

# flash - 使用 Silverlight 或 Flash 查看 SVG

> ID：128372
> 
> 赞同：1
> 
> 时间：2008-09-24T17:00:20.053
> 
> 标签：flash, silverlight, svg

有没有办法使用 Silver light 或 flash 从文件或网页中动态查看 SVG？

**编辑：** 我目前正在使用 inkscape 在服务器上转换它们。唯一的麻烦是制作所有 60 多页目录所需的时间有点慢。制作需要 5 分钟，一些客户（包括老板）希望这个过程更快。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T21:31:36.643

此外，Inkscape 支持将 SVG 图像导出到 XAML 输出。当然，两者都不是您所要求的，因为两者都以某种方式“转换”，而是直接回答——不，Silverlight 不直接解释 SVG。不过我不确定Flash。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T18:28:08.487

[XamlTune](http://www.codeplex.com/XamlTune)可以将 SVG 转换为 XAML，以便在 Silverlight 控件中查看。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T03:35:52.880

**timheuer：** 您知道是否有用于制作 XAML 文件的命令行选项吗？

**编辑：**似乎 svg 不能直接转换为 xaml 格式，因为我的图表会在 XP 和 Vista 中使 IE 崩溃。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T03:12:05.053

milhous：我不熟悉 Inkscape 的命令行界面（如果有的话），但您可以使用 SVG 并保存为 Microsoft XAML。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-18T12:57:51.543

[codeplex](http://www.codeplex.com/svg/)的SVG 项目可以读取 SVG 文件并将其渲染为图形对象，您可以在 Silverlight 中使用该对象。或者，您可以只使用 HttpHandler 以 PNG 格式将 SVG 直接呈现给浏览器。

# java - 使用 Spring 和 Hibernate 跨多个数据库执行分布式事务的“最佳”方法是什么

> ID：128377
> 
> 赞同：35
> 
> 时间：2008-09-24T17:01:40.177
> 
> 标签：java, hibernate, spring, transactions, xa

我有一个应用程序 - 更像是一个实用程序 - 它位于角落并定期更新两个不同的数据库。

这是一个使用 Spring Application Context 构建的小型独立应用程序。上下文中配置了两个 Hibernate Session Factories，依次使用 Spring 中配置的 Commons DBCP 数据源。

目前没有事务管理，但我想补充一些。对一个数据库的更新取决于对另一个数据库的成功更新。

该应用程序不位于 Java EE 容器中 - 它由从 shell 脚本调用的静态启动器类引导。启动器类实例化应用程序上下文，然后调用其中一个 bean 上的方法。

围绕数据库更新进行事务处理的“最佳”方式是什么？

我将把“最佳”的定义留给您，但我认为它应该是“易于设置”、“易于配置”、“便宜”和“易于打包和重新分发”的一些功能。自然开源软件会很好。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-05-20T11:38:48.053

在多个数据库上分发事务的最佳方式是：不要。

有些人会将您指向 XA，但 XA（或两阶段提交）是谎言（或市场化）。

想象一下：在第一阶段告诉 XA 管理器它可以发送最终提交后，到其中一个数据库的网络连接失败。怎么办？超时？这会使其他数据库损坏。回滚？两个问题：你不能回滚提交，你怎么知道第二个数据库发生了什么？也许在成功提交数据后网络连接失败，只有“成功”消息丢失？

最好的方法是将数据复制到一个地方。使用允许您随时中止复制并继续复制的方案（例如，忽略您已有的数据或按 ID 订购选择并仅请求副本的记录 > MAX(ID)）。通过交易保护这一点。这不是问题，因为您只是从源中读取数据，因此当事务因任何原因失败时，您可以忽略源数据库。因此，这是一个普通的旧单源交易。

复制数据后，在本地进行处理。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T17:20:28.883

在您的上下文中设置事务管理器。Spring 文档有示例，非常简单。然后当你想执行一个事务时：

```
try { 
    TransactionTemplate tt = new TransactionTemplate(txManager);

    tt.execute(new TransactionCallbackWithoutResult(){
    protected void doInTransactionWithoutResult(
            TransactionStatus status) {
        updateDb1();
        updateDb2();
    }
} catch (TransactionException ex) {
    // handle 
} 
```

有关更多示例和信息，请参阅： [XA transactions using Spring](http://www.javaworld.com/javaworld/jw-04-2007/jw-04-xa.html?page=1)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-28T12:11:20.050

当您说“两个不同的数据库”时，您是指不同的数据库服务器，还是同一个数据库服务器中的两个不同的模式？

如果是前者，那么如果您想要完整的事务性，那么您需要提供完整的两阶段提交的 XA 事务 API。但更重要的是，您还需要一个事务协调器/监视器来管理不同数据库系统之间的事务传播。这是 JavaEE 规范的一部分，并且是其中非常稀少的一部分。TX 协调器本身是一个复杂的软件。您的应用程序软件（如果您愿意，可以通过 Spring）与协调器对话。

但是，如果您只是指同一数据库服务器中的两个数据库，那么普通 JDBC 事务应该可以正常工作，只需在单个事务中对两个数据库执行操作即可。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-28T17:15:07.247

在这种情况下，您需要一个事务监视器（支持 XA 协议的服务器）并确保您的数据库也支持 XA。大多数（全部？）J2EE 服务器都内置了事务监视器。如果您的代码不在 J2EE 服务器中运行，那么有很多独立的替代方案 - Atomicos、Bitronix 等。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-06-12T00:08:28.850

您可以尝试支持分布式数据库事务的 Spring ChainedTransactionManager - [http://docs.spring.io/spring-data/commons/docs/1.6.2.RELEASE/api/org/springframework/data/transaction/ChainedTransactionManager.html](http://docs.spring.io/spring-data/commons/docs/1.6.2.RELEASE/api/org/springframework/data/transaction/ChainedTransactionManager.html)。这可能是 XA 的更好替代方案

# iphone - Upload photo to arbitrary FTP with iPhone app

> ID：128378
> 
> 赞同：4
> 
> 时间：2008-09-24T17:01:44.373
> 
> 标签：iphone, upload, ftp, photo

I'd like to upload a photo from my iphone to an arbitrary ftp. How can I do this with Cocoa / Xcode ?

Thanks!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T17:41:11.220

你会想看看关于 iPhone 的[CFFTPStream](https://developer.apple.com/iphone/library/documentation/CoreFoundation/Reference/CFFTPStreamRef/Reference/reference.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-30T19:41:06.887

有一个很好的框架，叫做[ConnectionKit](http://opensource.utr-software.com/connection/)。个人没用过，听说还不错。

# lighttpd - 在 lighttpd 中包含许多重写指令

> ID：128381
> 
> 赞同：3
> 
> 时间：2008-09-24T17:02:11.983
> 
> 标签：lighttpd

我在并行子目录中有一堆项目，它们都有 etc/lighttpd.conf 文件。文件非常简单；它们只包含一个如下所示的指令：

```
url.rewrite-once = ("^/project(.*)$"=>"project/router.php?args=$1") 
```

不幸的是，我刚刚发现我不能简单地遍历它们，因为我会得到一个“重复的配置变量”错误。我看到我应该使用它的方式是这样的：

```
url.rewrite-once = (
    "^/project1(.*)$"=>"project1/router.php?args=$1"
    ,"^/project2(.*)$"=>"project2/router.php?args=$1"
) 
```

但是，如果我让我的每个目录配置文件只包含重写，并让一个 shell 脚本构建它们，我真的不能在每个目录文件中放置任何其他轻量级指令。再说一次，我是 lighty 的新手，所以也许我不需要也只是没有意识到。

这样做的“正确方法”是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T17:14:37.167

尝试：

```
url.rewrite-once += ("^/project1(.*)$"=>"project1/router.php?args=$1") 
```

将您的新配置附加到现有变量而不是再次定义它。

# xml - XML 命名空间有什么用？

> ID：128389
> 
> 赞同：75
> 
> 时间：2008-09-24T17:03:37.550
> 
> 标签：xml, xsd, namespaces, schema, xml-namespaces

我总是觉得很难向其他人解释这一点：为什么存在 XML 名称空间？我们什么时候应该使用它们，什么时候不应该使用它们？在 XML 中使用命名空间时常见的陷阱是什么？

此外，它们与 XML 模式有什么关系？XSD 模式是否应该始终与命名空间相关联？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-24T17:08:26.603

它们用于允许组合多种标记语言，而不必担心元素和属性名称的冲突。

例如，查看任何一点 XSLT 代码，然后想想如果您不使用名称空间并尝试编写输出必须包含“模板”、“for-each”等元素的 XSLT 会发生什么. 语法错误，是什么。

我会把建议和陷阱留给比我更有经验的人。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2013-04-18T14:27:24.430

*为什么存在 XML 命名空间？*

因为，早在 1997 年，W3C 中一些非常有影响力的人想要他们，并且不会拒绝。即使它被证明，我敢肯定地说，有更好的方法来解决他们认为他们遇到的“问题”，他们仍然发挥着自己的影响力，将他们的愿望写入 W3C 建议。

在目前围绕 XML 命名空间的广泛神话中，最大的谎言是它们具有技术优势。（这是建议书的下游效应，它只是存在并因此占据了思维空间——“哎呀，一定有一个（好的）理由！”——而不是某处被遗忘的脚注。）

[多痛苦，一无所获](http://www.nyct.net/~aray/sgo/bogosity.txt)。

*我们什么时候应该使用它们，什么时候不应该使用它们？*

如果你能提供帮助，你永远不应该使用它们。不幸的是，感兴趣的各方对这种 BAD[*] 设备的不懈推广已经促成了今天的大量规范，这使得在某些时候不必与 XML 命名空间抗衡几乎是不可能的。因此，即使您自己避开了 XML 命名空间，您也会发现包裹着命名空间的杂物从四面八方涌来，或者更糟的是，除非您向它们提供这种杂物，否则这些工具集根本拒绝工作。

*在 XML 中使用命名空间时常见的陷阱是什么？*

一个非常常见的缺陷是在将 Xpath 表达式与命名空间已“默认”的文档一起使用时：命名空间必须在表达式中显式。另一个问题是在构建文档时“正确”使用它们：[它们会凭空产生问题](http://lists.xml.org/archives/xml-dev/200210/msg00824.html)。

*此外，它们与 XML 模式有什么关系？XSD 模式是否应该始终与命名空间相关联？*

没有必要的关系，只是 XSD Schema 规范是在委员会中几乎每个人都对 XML 命名空间咬牙切齿的时候开发的。所以他们尽可能深入地研究它。尽管如此，使用没有命名空间的 XSD 模式是可能的，但这是一个陡峭的上坡路，因为几乎每个支持 XSD 模式的工具集都假定您将“想要”使用命名空间。

[*] BAD = 按设计损坏

更新：[一篇关于这个非问题非解决方案的旧文章](http://www.nyct.net/~aray/ns/ns.html)。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-24T17:11:19.340

这几乎与问“为什么我们使用 Java/C# 的包？”相同：

*   **可重用性**：您可以在不同类型的 xml 文档中重用您定义的一组标签/属性。
*   **模块化**：如果您需要在 XML 中添加一些“方面”；将命名空间添加到 xml 文档比更改整个 xml 架构定义更简单。
*   **避免污染“主”命名空间**：您不会强制解析器使用庞大的模式定义，只需使用您需要的命名空间即可。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-09-24T17:27:02.457

恕我直言，最大的缺陷是人机交互解释文档，例如开发代码来处理 XML 文档。太容易关注文档的文字表达，而不是解析文档的信息集结果。

例如以下节点

```
<a xmlns="uri:foo"/>
<foo:a xmlns:foo="uri:foo"/>
<bar:a xmlns:bar="uri:foo"/> 
```

在语义上都是相同的 - 但与天真的眼睛非常不同。

第一个示例在开发 XPath 时产生了一个非常常见的错误——忽略了“a”在命名空间中这一事实——因此 //a 不会产生匹配项。（或者更糟糕的是仍然匹配不同命名空间中的节点！）

第三个例子在理解上打开了另一个缺陷——前缀文本在语义上很重要。使用 XPATH 解析文档时，我可以声明我喜欢的任何前缀进行匹配，只要它的 uri 与文档的前缀匹配即可。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-24T17:16:51.573

将它们视为元素类型的姓氏。如果您有两个朋友，都叫 Bob，并且您正在谈论其中一个，那么有人可能会问您在谈论哪个 Bob。只说“鲍勃”不是很有帮助，所以你说“鲍勃史密斯”或“鲍勃琼斯”。

元素类型也是如此。有时一个简短的名字是不够的，因为不同的人可以选择相同的名字。因此，您将 URI 作为“姓氏”包含在内，以区分那里的不同 Bob。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-24T17:18:20.963

XML 是一种超级语言，这意味着它是任何基于 XML 的语言的基础（有意义，对吗？）。将 XML 想象成一支可以用任何语言书写任何句子的笔。这完全取决于作者，最好读者应该知道该语言。

XML**命名空间**基本上是语言的名称，很像“English”或“עברית”。我帮助 XML 文档的接收者解析它并提取其中的信息。

假设我有一家家具厂，你有一家家具店。你的存储应用程序和我的供应应用程序完全不相关，但是当它们通过 XML 消息进行通信时，消息应该是双方都可以理解和易于解析的

因此，两个系统都需要知道**Schema**，它定义了语言语法和约定的限制。将模式视为字典和语法教科书。模式是两个系统都应该知道的文档，在每个系统中编写解析代码的人都必须知道，并且包括命名空间的声明。

每个命名空间都被命名为一个 URI，在大多数情况下，它是定义它的架构文档的位置。

当然，并不是每个 XML 文档都需要命名空间，尤其是当它不用于向远程系统传递信息时。例如，当您将对象序列化为 XML 以保存在数据库中时。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-22T02:16:52.847

我们使用命名空间是因为人们想在他们自己的私人爱达荷州使用相同的词来表示不同的事物。通常，您可以根据上下文确定一个人的含义。在人事数据库中，XML 是人事记录。在车辆登记数据库中，XML 是车辆登记记录。

两者都保留一个名为“位置”的标签，但该标签对每个人的含义不同，并且包含不同的字段。

现在，这很酷：但是如果您需要或想要将两者的 XML 存储在同一个数据库中怎么办？或者，更有趣的是，如果两个数据库都想存储来自其他一些通用数据库（例如：Accounts 数据库）的 XML 块怎么办。

XML 命名空间与每个 XML 标记关联一个 URI，这样标记名称本身前面就有一个 url，这是标记名称的一部分（当然，实际的 XML 文档使用简写来做到这一点）。通过仔细选择 URI，很容易确信标签名称不会发生冲突 - 就好像两个位置标签的名称完全不同，所以不会混淆。作为奖励，两个完全不同的位置标签可以包含来自帐户数据库的内容，并明确声明它们在谈论同一件事。

**使这一切变得有用的是 XPATH。**

有了上面的内容，你可以开始编写 XPATH 表达式，比如：`accounts:account overdue`在这个 xml 中的任何地方找到我的任何部分。或者：在这个特定的 XML 块中的任何位置找到我的任何项目，其中警告消息是节点或节点`accounts:warning message`的子节点（无论多么深）。`personnel:payment``vehicle:status`

该 XPATH 表达式可能在 XSLT 文档中的某处使用，其工作是将 XML 转换为 XHTML 或 XPDF 以供显示。

回报是什么？为什么这样做？因为您可以搜索 XML 日志文件，所以无论出现在何处都可以提取所有帐户过期消息，*而不会将它们与其他系统生成的“消息”标签混淆*，将它们转换为 xhtml，并通过 css 标签以粗体红色显示它们：**全部无需编写一点程序代码**。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T17:15:20.673

例如：示例[XML 命名空间](http://www.xml.com/pub/a/1999/01/namespaces.html)

用我的话来说：如果您必须为外部公司（例如）使用某种 XML 格式，并且您需要在 XML 文档中提供一些具有相同名称的信息，那么您需要一个命名空间。例子：

```
<sampleDoc>
   <header title="Hello world!">
      <items>
         <item name="Volvo" color="Blue"/>
      </items>
   </header>
</sampleDoc> 
```

并且您想将一些数据合并到此文档中，该文档具有相同的名称，但具有另一种意义（因此值），您应该使用命名空间：

```
<sampleDoc>
   <header title="Hello world!">
      <items>
         <item name="Volvo" color="White" my_unique_namespace:color="#FFFFFF"/>
      </items>
   </header>
</sampleDoc> 
```

当然 - 您可以更改属性的名称。例如“my_unique_color”。芽在另一个文件中，可以再有同名的属性。因此，如果您有一个唯一的命名空间（例如我们的 Web 域），您始终可以使用相同的元素和/或属性名称，而不会出现任何问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T17:07:56.103

从[W3 推荐](http://www.w3.org/TR/REC-xml-names/)...

> XML 名称空间提供了一种简单的方法来限定可扩展标记语言文档中使用的元素和属性名称，方法是将它们与由 URI 引用标识的名称空间相关联。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T17:11:02.103

命名空间用于消除您在文档中使用的名称的歧义。它还使您能够将短名称绑定到名称空间，然后可以使用该名称空间来引用远程元素或属性。名称空间本身是指定义您在文档中使用的元素和属性的位置。还有很多要知道的，但这就是它的核心。[这里](http://www.w3.org/TR/REC-xml-names/#concepts)有更多信息。

# sql - SQL 查询 - Select * from view 或 Select col1, col2, ... colN from view

> ID：128412
> 
> 赞同：10
> 
> 时间：2008-09-24T17:08:22.313
> 
> 标签：sql, sql-server

我们使用的是 SQL Server 2005，但这个问题可以针对任何[RDBMS](http://en.wikipedia.org/wiki/Relational_database_management_system)。

从视图中选择所有列时，以下哪项更有效？

```
Select * from view 
```

或者

```
Select col1, col2, ..., colN from view 
```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-09-24T17:13:18.243

永远不要使用“SELECT *”！！！！

这是查询设计的基本规则！

这有多种原因。其中之一是，如果您的表上只有三个字段，并且您在调用查询的代码中使用了所有三个字段，那么随着应用程序的增长，您很可能会向该表添加更多字段，如果您的 select * 查询只是为了返回调用代码的这 3 个字段，然后您从数据库中提取的数据比您需要的多得多。

另一个原因是性能。在查询设计中，不要像以下口头禅那样考虑可重用性：

尽你所能吃，但吃尽你所能。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-24T17:10:59.623

最佳做法是按名称选择每一列。将来，您的数据库架构可能会更改为添加特定查询不需要的列。我建议按名称选择每一列。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T17:44:27.843

选择 * 是一种糟糕的编程习惯。它既可能导致事物破裂，也可能使事物免于破裂。如果您只查询一个表或视图，则可能不会提高效率（尽管如果您不打算实际使用每个字段，也有可能）。如果您有内部连接，那么您至少有两个字段返回相同的数据（连接字段），因此您正在浪费网络资源将冗余数据发送回应用程序。一开始您不会注意到这一点，但随着结果集越来越大，您很快就会拥有一个已满且不需要的网络管道。我想不出 select * 能给你带来任何好处的例子。如果添加了一个新列并且您不需要转到代码来对其进行处理，那么该列应该' t 根据定义由您的查询返回。如果有人删除并以不同的顺序重新创建列的表，那么您的所有查询都将显示错误的信息或给出错误的结果，例如将价格放入新记录中的部件号字段。

另外，从对象浏览器中快速拖动列名，这只是纯粹的懒惰而不是编码效率。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T09:52:10.840

只是为了澄清几个人已经提出的观点， Select * 效率低下的原因是因为必须对数据库进行初始调用以准确找出可用的字段，然后在使用查询的位置进行第二次调用显式列。

当您在调试、运行临时查询或处于开发查询的早期阶段时，请随意使用 Select *，但一旦您知道所需的列，请明确说明它们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-17T08:51:09.093

这取决于。视图的继承可能是一件方便且易于维护的事情（SQL Anywhere）：

```
create view v_fruit as select F.id, S.strain from F key join S; 
create view v_apples as select v_fruit.*, C.colour from v_fruit key join C; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T17:10:12.043

如果您真的选择了所有列，那么无论您要求 * 还是明确表示，都不应该有任何明显的区别。SQL 服务器将在几乎相同的时间内以相同的方式解析请求。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T17:12:05.393

始终从视图中选择 col1、col2 等。我知道的两种方法之间没有效率差异，但是使用“select *”可能很危险。如果您修改视图定义添加新列，您可以使用“select *”中断程序，而选择一组预定义的列（甚至所有列，命名）仍然有效。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T17:13:08.743

我想这一切都取决于查询优化器的作用。

如果我想获取行中的每条记录，我通常会使用“SELECT *...”选项，因为我不必担心是否应该更改底层表结构。同样，对于维护代码的人来说，看到“SELECT *”会告诉他们该查询旨在返回每一列，而单独列出这些列并不能传达相同的意图。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T17:51:02.897

对于性能 - 查看查询计划（应该没有区别）。

为了可维护性。- 始终提供一个字段列表（也适用于 INSERT INTO）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-06-13T06:33:26.187

```
select 
column1
,column2
,column3
.
.
.
from Your-View 
```

这个比使用更优化

```
select *
from Your View 
```

# wpf - DataGrid 是 WPF 中的必需品吗？

> ID：128414
> 
> 赞同：24
> 
> 时间：2008-09-24T17:08:31.783
> 
> 标签：wpf, datagrid

我已经看到很多讨论正在进行，人们询问 WPF 的 DataGrid，并抱怨微软迄今为止还没有与他们的 WPF 框架一起使用。我们知道 WPF 是一种很棒的 UI 技术，并且有 ItemsControl、DataTemplate 等概念来制作出色的 UX。甚至 WPF 也有一个更匹配的控件——ListView，它可以很容易地被模板化，以提供比传统的 Datagrid 类显示更好的用户体验。我想说一个现成的 DataGrid 控件会扼杀或隐藏很多创造力，它肯定会减少用户体验领域的创新。

那么您对 ​​WPF 中的 DataGrid 作为框架组件的需求有何看法？如果你觉得有必要，难道只是因为多年来世界已经习惯了 DatGrid 的数据显示方式吗？

其他一些讨论 DatGrid 的线程在[这里](https://stackoverflow.com/questions/112518/what-wpf-datagrid-controls-are-worth-the-money-andor-effort#112623)和[这里](https://stackoverflow.com/questions/127647/what-is-the-best-free-datagrid-for-wpf#127740)

链接到[WPF ToolKit](http://www.codeplex.com/wpf/Release/ProjectReleases.aspx?ReleaseId=14963) - 最新的 WPF DatGrid

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-24T17:20:00.757

DataGrids 非常适合显示绑定到后备存储的大量表格数据。

但是在 WinForms 世界中发生的事情是人们经常将它们用于需要多元素滚动列表的所有事情。改进后的第三方 DataGrid 很快就可以使用，它允许列和字段包含按钮、组合框和图标等。

DataGrid 之所以成为主力，是因为需要一些可以被哄骗的东西。在通用集合出现之前，DataTables 也发生了类似的情况——当您使用大量 DataTables 时，使用 DataGrid 在 UI 中呈现它是阻力最小的路径。

我想，当 WPF 出来的时候，很多像我一样的程序员还在这样思考，寻找 DataGrid 概念的 WPF 端口。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T17:39:34.343

想不出更好的控件来显示表格数据，尤其是在您不想通过模板/开发 (Headered)ItemsControl 以使其表现得像旧的 DGV 一样重新发明轮子的业务应用程序中。我确定你看到了[这个](http://www.codeplex.com/wpf/Release/ProjectReleases.aspx?ReleaseId=14963)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-05T10:50:53.710

没有人质疑您可以自己在 WPF 中制作 DataGrid 控件。WinForms 可能也是如此，尽管它会更困难。我已经用 ListView 实现了一些功能——显示表格数据很容易，你甚至可以说它得到了很好的支持。但是，编辑 ListView 所需的代码量（手动编写的代码）是巨大的。

业务应用程序通常需要编辑许多表格，而您不想有创意，您想要快速。这就是我认为需要 DataGrid 的原因。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-13T03:12:08.170

是的，DataGrids 永远不会作为基本的业务 UI 组件消失。人们喜欢他们的电子表格，我们希望分享这种爱！

请注意，MS**正在提供**这些额外的控件 - 他们在 CodePlex 上创建了[WPF 工具包](http://www.codeplex.com/wpf)，以提供快速周转、开源的部署风格。

它已经包含一个 DataGrid 和 Calendar。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T15:07:24.047

是的！在 ms 未能提供的许多其他控件中。（日期选择器、数字控件）

MS 应该首先为我们提供完成工作的工具，这是我对 wpf 大肆宣传的编程环境的最低期望。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-26T13:30:34.180

这是必不可少的，但是您可以使用使用 GridView 的 ListView 实现几乎相同的效果，不是吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T17:17:06.433

在使用 WPF 大约 2 年后。我会说 DataGrid 实际上只是一个美化的 ListBox（因为 [几乎] WPF 中的所有内容都是无样式的）。

可以设置 ListBox 的样式以获取某种实体，并为每个条目显示一个“记录”控件。根据它们的灵活程度，它们可以根据传递的实体自动调整。

# 3d - 将 2D 点反向投影到 3D

> ID：128430
> 
> 赞同：13
> 
> 时间：2008-09-24T17:12:34.597
> 
> 标签：3d, geometry, reverseprojection

假设我们有一个 3d 空间，上面有一个平面，上面有一个任意方程： ax+by+cz+d=0 现在假设我们在该平面上选择 3 个随机点： (x0,y0,z0) (x1,y1,z1 ) (x1,y1,z1)

现在我对这架飞机有不同的观点（相机）。我的意思是我有一个不同的相机，可以从不同的角度看这架飞机。从该相机的角度来看，这些点具有不同的位置。例如 (x0,y0,z0) 将是 (x0',y0') 并且 (x1,y1,z1) 将是 (x1',y1') 并且 (x2,y2,z2) 将是 (x2',y2 ') 从新相机的角度来看。

所以这是我的一个小难题！我想从新相机的角度选择一个点，例如（X，Y），并告诉它在那个平面上的位置。我所知道的是 3d 空间上的 3 个点及其位置以及它们在新相机视图上的投影位置。

* * *

你知道平面方程的系数和相机位置（连同投影），还是你只有六个点？- 尼尔斯

我知道前 3 个点的位置。因此我们可以计算平面的系数。所以我们从（0,0,0）的角度确切地知道飞机的位置。然后我们有了只能看到点的相机！所以相机看到的唯一东西是 3 个点，而且它知道它们在 3d 空间中的位置（并且肯定它们在 2d 相机视图平面上的位置）。毕竟我想看看相机视图，选择一个点（例如（x1，y1））并告诉那个点在那个平面上的位置。（当然这个（X，Y，Z）点应该适合平面方程）。我也对相机位置一无所知。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T17:20:33.017

你在问如何使一条线和一个平面相交？见这里[http://paulbourke.net/geometry/pointlineplane/](http://paulbourke.net/geometry/pointlineplane/)

附言。你的老师知道这个网站！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-10-08T14:01:57.910

不可能对这个问题给出明确的解决方案。但是，这是我提取不同解决方案的方法：

[1) 使用原始RANSAC 论文](http://www.ai.sri.com/pubs/files/836.pdf)中的 P3P（Perspective-3-Point）算法求解相机位置和方向，该算法给出了四种可能的可行解（相机前面的点）。

2）以相机位置为原点投影一条射线，以（X，Y）作为相机中的投影并计算其与平面的交点。

# amazon-ec2 - 在 Windows 中运行 Amazon EC2 AMI

> ID：128431
> 
> 赞同：24
> 
> 时间：2008-09-24T17:13:00.210
> 
> 标签：amazon-ec2, amazon-ami

有没有办法在 Windows 中运行 Amazon EC2 AMI 映像？我希望能够在本地进行一些测试和配置。我正在寻找类似 Virtual PC 的东西。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T20:09:57.617

如果您从头开始构建映像，则可以使用 VMware 来完成（或在此处插入您最喜欢的 VM 软件）。

根据需要构建和安装您的 linux 机器，然后*在*来宾中运行 AMI 打包/上传工具。然后，只需将您的 VM 映像的备份副本与您上传的不同 AMI 保持同步。

一些警告：您需要确保您使用的是兼容的内核，或者至少在 VM 中有兼容的内核模块，否则您的实例将无法在 EC2 网络上启动。您还必须确保您的系统也可以自动配置（网络、挂载等）。

如果您想使用现有的 AMI，那就有点棘手了。您需要下载 AMI 并将其解压缩到 VM 映像中，添加内核并启动它。据我所知，没有“一键式”方法可以让它工作。此外，AMI 可能已加密（我知道它们至少已签名）。

您可以通过设置“引导”虚拟机来使用 AMI 工具专门将 AMI 提取到虚拟磁盘中，然后单独启动该虚拟磁盘来执行此操作。

我知道这很模糊，但这些是你必须经历的步骤。您可能可以编写一些脚本来自动化将 AMI 转换为 vdks 的过程。

亚马逊论坛也很有帮助。例如，请参阅[这篇文章](http://developer.amazonwebservices.com/connect/message.jspa?messageID=61772)。

哦，[这篇文章](http://www.thewebfellas.com/blog/2008/9/1/creating-an-new-ec2-ami-from-within-vmware-or-from-vmdk-files)也详细讲了其中的一些过程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T15:25:56.437

带有 Windows Server 的 Amazon EC2 - 今天早上宣布，非常令人兴奋

[http://aws.amazon.com/windows/](http://aws.amazon.com/windows/)

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2009-09-10T17:09:48.987

它有点像圆孔中的方钉……有点像在 Linux 上运行 MS-Office。

根据您如何珍惜时间，购买另一台 PC 并安装 Linux 和 Xen 会更便宜。

# c# - .NET 货币格式化程序：我可以指定使用银行家的四舍五入吗？

> ID：128443
> 
> 赞同：5
> 
> 时间：2008-09-24T17:15:17.367
> 
> 标签：c#, .net, formatting, bankers-rounding

有谁知道我如何获得格式字符串以使用[银行家四舍五入](http://en.wikipedia.org/wiki/Rounding#Round-to-even_method)？我一直在使用“{0:c}”，但这与银行家四舍五入的方式不同。该[`Math.Round()`](http://msdn.microsoft.com/en-us/library/system.math.round.aspx)方法对银行家进行四舍五入。我只需要能够使用格式字符串复制它的舍入方式。

* * *

**注意：**最初的问题相当具有误导性，提到正则表达式的答案就来源于此。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T17:31:26.000

你不能简单地在字符串输入上调用 Math.Round() 来获得你想要的行为吗？

代替：

```
string s = string.Format("{0:c}", 12345.6789); 
```

做：

```
string s = string.Format("{0:c}", Math.Round(12345.6789)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T17:17:41.730

~~正则表达式是一种模式匹配语言。您不能在 Regexp 中进行算术运算。~~

用 IFormatProvider 和 ICustomFormatter 做一些实验。这是一个链接，可能会为您指明正确的方向。[http://codebetter.com/blogs/david.hayden/archive/2006/03/12/140732.aspx](http://codebetter.com/blogs/david.hayden/archive/2006/03/12/140732.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T17:17:45.613

这是不可能的，正则表达式没有任何“数字”的概念。您可以使用[匹配评估器](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.matchevaluator(VS.71).aspx)，但您将添加命令式 c# 代码，并且会偏离您的正则表达式唯一要求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T19:54:18.793

.Net 内置了对算术和银行家四舍五入的支持：

```
//midpoint always goes 'up': 2.5 -> 3
Math.Round( input, MidpointRounding.AwayFromZero );

//midpoint always goes to nearest even: 2.5 -> 2, 5.5 -> 6
//aka bankers' rounding
Math.Round( input, MidpointRounding.ToEven ); 
```

“均匀”舍入实际上是默认设置，尽管“远离零”是您在学校学到的。

这是因为在后台计算机处理器也会进行银行家的四舍五入。

```
//defaults to banker's
Math.Round( input ); 
```

我原以为任何舍入格式字符串都会默认为银行家的舍入，不是这样吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T20:10:28.333

如果您使用的是 .NET 3.5，您可以定义一个扩展方法来帮助您执行此操作：

```
public static class DoubleExtensions
{
    public static string Format(this double d)
    {
        return String.Format("{0:c}", Math.Round(d));
    }
} 
```

然后，当你调用它时，你可以这样做：

```
12345.6789.Format(); 
```

# .net - 从 64 位进程调用 32 位代码

> ID：128445
> 
> 赞同：52
> 
> 时间：2008-09-24T17:15:51.530
> 
> 标签：.net, migration, x86, 64-bit, fortran

我有一个我们正在尝试从 32 位迁移到 64 位的应用程序。它是 .NET，使用 x64 标志编译。但是，我们有大量用 FORTRAN 90 编写的 DLL，为 32 位编译。FORTRAN DLL 中的函数相当简单：你把数据放进去，你把数据拉出来；没有任何状态。我们也不会花很多时间在那里，总共可能 3%，但它执行的计算逻辑是无价的。

我可以以某种方式从 64 位代码调用 32 位 DLL 吗？MSDN 建议我不能，期间。我做了一些简单的黑客攻击并验证了这一点。一切都会抛出一个无效的入口点异常。到目前为止，我发现的唯一可能的解决方案是为所有 32 位 DLL 函数创建 COM+ 包装器并从 64 位进程调用 COM。这似乎很让人头疼。我们也可以在 WoW 仿真中运行该过程，但内存上限不会增加，上限约为 1.6gb。

有没有其他方法可以从 64 位 CLR 进程调用 32 位 DLL？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-24T17:21:19.613

您需要将 32 位 dll 加载到单独的 32 位进程中，并让您的 64 位进程通过进程间通信与其通信。我认为没有任何方法可以将 32 位 dll 加载到 64 位进程中。

这里有一篇很好的文章：

[从 64 位代码访问 32 位 DLL](http://blog.mattmags.com/2007/06/30/accessing-32-bit-dlls-from-64-bit-code/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T17:24:42.617

您需要将您的可执行进程编写为 32 位进程（相对于任何 CPU 或 x64），以便将它们与 WoW32 for Vista 一起加载。这将以 32 位仿真模式加载它们，并且您不会遇到入口点问题。你可以让你的库处于 AnyCPU 模式，但你的可执行文件必须编译为 x86。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-06T02:50:05.303

如果您不想重新编译现有的 dll，John 的回答是正确的；但是，这也可能是您的选择。

我们的团队目前正在将我们的 x86 FORTRAN 代码迁移到 x64 以增加内存上限。

# ruby-on-rails - 在 Ruby on Rails 中的控制器之间重用代码的最佳实践

> ID：128450
> 
> 赞同：84
> 
> 时间：2008-09-24T17:16:46.550
> 
> 标签：ruby-on-rails, ruby

我有一些我想分享的控制器方法。在 ruby​​ on rails 中执行此操作的最佳实践是什么？我应该创建一个我的控制器扩展的抽象类，还是应该创建模块并将其添加到每个控制器中？以下是我要分享的控制器方法：

```
def driving_directions
  @address_to = params[:address_to]
  @address_from = params[:address_from]
  @map_center = params[:map_center_start]

  # if we were not given a center point to start our map on
  # let's create one.
  if !@map_center && @address_to
    @map_center = GeoKit::Geocoders::MultiGeocoder.geocode(@address_to).ll
  elsif !@map_center && @address_from
    @map_center = GeoKit::Geocoders::MultiGeocoder.geocode(@address_from).ll
  end
end

def printer_friendly
  starting_point = params[:starting_point].split(',').collect{|e|e.to_f}
  ne = params[:ne].split(',').collect{|e|e.to_f}
  sw = params[:sw].split(',').collect{|e|e.to_f}
  size = params[:size].split(',').collect{|e|e.to_f}
  address = params[:address]

  @markers = retrieve_points(ne,sw,size,false)
  @map = initialize_map([[sw[0],sw[1]],[ne[0],ne[1]]],[starting_point[0],starting_point[1]],false,@markers,true)
  @address_string = address
end 
```

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2008-09-25T00:35:50.303

在我看来，正常的 OO 设计原则适用：

*   如果代码真的是一组不需要访问对象状态的实用程序，我会考虑将它放在一个单独调用的模块中。例如，如果代码都是映射实用程序，则创建一个模块`Maps`，并访问以下方法： `Maps::driving_directions`.
*   如果代码需要状态并在每个控制器中使用或可以使用，则将代码放在 ApplicationController 中。
*   如果代码需要状态并且在逻辑上密切相关的所有控制器的子集中使用（即所有关于地图），则创建一个基类（`class MapController < ApplicationController`）并将共享代码放在那里。
*   如果代码需要状态并且用于所有不密切相关的控制器的子集，则将其放入模块中并将其包含在必要的控制器中。

在您的情况下，方法需要状态（`params`），因此选择取决于需要它的控制器之间的逻辑关系。此外：

还：

*   尽可能对重复代码使用部分代码，并将其放置在通用的“部分”目录中或通过特定路径包含。
*   尽可能坚持使用 RESTful 方法（对于方法），如果您发现自己创建了很多非 RESTful 方法，请考虑将它们提取到自己的控制器中。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2014-05-18T14:21:21.757

我知道这个问题是 6 年前提出的。只是想指出，在 Rails 4 中，现在有控制器问题，这是一个开箱即用的解决方案。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-24T18:02:26.723

我实际上认为模块是在控制器之间共享代码的最佳方式。如果您想在视图之间共享代码，助手是很好的选择。助手基本上是美化的模块，所以如果你不需要视图级别的访问，我建议在你的 lib 文件夹中放置一个模块。

创建模块后，您必须使用 include 语句将其包含在所需的控制器中。

[http://www.rubyist.net/~slagell/ruby/modules.html](http://www.rubyist.net/~slagell/ruby/modules.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T18:44:07.123

我同意模块方法。在您的 lib 目录中创建一个单独的 Ruby 文件并将模块放入新文件中。

最明显的方法是将这些方法添加到您的 ApplicationController，但我相信您已经知道这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-02T12:53:36.303

如果你想在控制器和助手之间共享代码，那么你应该尝试在库中创建一个模块。您也可以使用@template 和@controller 来访问控制器和助手中的方法。检查此以获取更多详细信息[http://www.shanison.com/?p=305](http://www.shanison.com/?p=305)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T21:55:22.240

另一种可能：

如果您的公共代码需要状态并且您想在控制器之间共享行为，您可以将它放在您的`model`or`lib`目录中的一个普通的旧 ruby​​ 类中。请记住，`model`即使所有 ActiveRecord 类都是持久的，类也不必是持久的。换句话说，拥有瞬态`model`类是可以接受的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-09T01:43:40.730

我发现在控制器之间共享相同代码的一种有效方法是让一个控制器从另一个控制器（代码所在的位置）继承。我使用这种方法与另一组命名空间控制器共享在我的控制器中定义的相同方法。

# sql - 典型的 Kimball 星型模式数据仓库 - 模型视图可行吗？以及如何编写代码

> ID：128456
> 
> 赞同：3
> 
> 时间：2008-09-24T17:17:54.020
> 
> 标签：sql, sql-server, tsql, code-generation, data-warehouse

我有一个包含典型星型模式的数据仓库，还有一大堆代码可以做这样的事情（显然要大得多，但这只是说明性的）：

```
SELECT cdim.x
    ,SUM(fact.y) AS y
    ,dim.z
FROM fact
INNER JOIN conformed_dim AS cdim
    ON cdim.cdim_dim_id = fact.cdim_dim_id
INNER JOIN nonconformed_dim AS dim
    ON dim.ncdim_dim_id = fact.ncdim_dim_id
INNER JOIN date_dim AS ddim
    ON ddim.date_id = fact.date_id
WHERE fact.date_id = @date_id
GROUP BY cdim.x
    ,dim.z 
```

我正在考虑用一个视图（`MODEL_SYSTEM_1`例如）替换它，这样它就变成了：

```
SELECT m.x
    ,SUM(m.y) AS y
    ,m.z
FROM MODEL_SYSTEM_1 AS m
WHERE m.date_id = @date_id
GROUP BY m.x
    ,m.z 
```

但是视图`MODEL_SYSTEM_1`必须包含唯一的列名，如果我继续这样做，我还担心优化器的性能，因为我担心 WHERE 子句中跨不同事实和维度的所有项目都会得到优化，因为视图将跨越整个恒星，并且视图无法参数化（男孩，那不是很酷！）

所以我的问题是——

1.  这种方法可以吗，或者它只是一种抽象，会损害性能并且除了更好的语法之外没有给我任何东西？

2.  考虑到所有适当的 PK 和 FK 都已到位，对这些视图进行代码生成、消除重复的列名（即使稍后需要手动调整视图）的最佳方法是什么？我是否应该只编写一些 SQL 将其从其中提取出来，`INFORMATION_SCHEMA`或者是否已经有一个很好的示例可用。

**编辑：**我已经对其进行了测试，即使在更大的过程中，性能似乎也是一样的——甚至加入了多个使用这些视图的星星。

自动化主要是因为数据仓库里面有很多这样的star，设计者已经做好了FK/PK，但我不想把所有的表格或文档都挑一遍。我编写了一个脚本来生成视图（它还生成表格的缩写），它可以很好地从 自动生成骨架`INFORMATION_SCHEMA`，然后可以在提交视图创建之前对其进行调整。

如果有人想要代码，我可能会在这里发布。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T18:36:48.910

1.  我已经在我负责的几个数据仓库中使用了这种技术。在运行基于视图的报告与直接使用表格方法时，我没有注意到任何性能下降，但从未进行过详细分析。

2.  我使用 SQL Server 管理工作室中的设计器创建了视图，没有使用任何自动化方法。我无法想象架构经常发生变化，以至于自动化它无论如何都是值得的。您可能会花费与首先将所有表格拖到视图上一样长的时间来调整结果！

为了消除歧义，一个好的方法是在列名前加上它所属的维度的名称。这对报告编写者和运行临时查询的任何人都有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T17:24:11.090

将一个或多个视图变成一个或多个汇总事实表并将其具体化。这些仅在刷新主事实表时才需要刷新。物化视图的查询速度会更快，如果您有很多可以通过摘要满足的查询，这可能是一个胜利。

如果您有大量此类摘要或希望经常更改它们，则可以使用数据字典或信息模式视图生成 SQL 以创建表。

但是，我猜您不太可能经常更改这些内容，因此自动生成视图定义可能不值得麻烦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-26T15:46:54.760

如果您碰巧使用 MS SQL Server，您可以尝试一个内联 UDF，它尽可能接近[参数化视图](http://msdn.microsoft.com/en-us/library/ms189294.aspx)。

# vbscript - 从 VBScript 使用剪贴板

> ID：128463
> 
> 赞同：20
> 
> 时间：2008-09-24T17:19:08.823
> 
> 标签：vbscript, windows-xp, clipboard

我正在寻找一种使用[VBScript](http://en.wikipedia.org/wiki/VBScript)将一些文本放到剪贴板上的方法。有问题的 VBScript 将作为我们登录脚本的一部分进行部署。我想避免使用在干净的 Windows XP 系统上不可用的任何东西。

**编辑：** 回答有关此用途的问题。

我们希望鼓励我们组织内的用户使用文件服务器来传输文档，而不是不断地通过电子邮件发送附件。最大的障碍之一是人们并不总是清楚文件/文件夹的正确网络路径是什么。我们开发了一个快速脚本，并将其附加到 Windows 上下文菜单中，以便用户可以右键单击任何文件/文件夹，并获取一个 URL，他们可以通过电子邮件将其发送给我们组织内的某个人。

我希望对话框中显示的 URL 也可以放在剪贴板上。

[获取网络路径](http://francyci.googlepages.com/getnetworkpath)

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-26T00:17:45.237

我发现在我看来并不完美但没有烦人的安全警告的另一个解决方案是使用来自 w2k3 服务器的 clip.exe。

```
Set WshShell = WScript.CreateObject("WScript.Shell")
WshShell.Run "cmd.exe /c echo hello world | clip", 0, TRUE 
```

根据以下问题的多行字符串示例： [Link1](http://www.petri.co.il/quickly_copy_error_and_display_messages.htm)

```
Dim string
String = "text here" &chr(13)& "more text here"
Set WshShell = WScript.CreateObject("WScript.Shell")
WshShell.Run "cmd.exe /c echo " & String & " | clip", 0, TRUE 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-05-15T23:18:20.987

使用 Microsoft 的 clip.exe 是最接近于拥有干净的 Windows XP 系统的解决方案。但是，您不必调用 CMD.EXE 来托管它以使用它。您可以直接调用它并在脚本代码中写入其输入流。关闭输入流后，clip.exe 会将内容直接写入剪贴板。

```
Set WshShell = CreateObject("WScript.Shell")
Set oExec = WshShell.Exec("clip")
Set oIn = oExec.stdIn
oIn.WriteLine "Something One"
oIn.WriteLine "Something Two"
oIn.WriteLine "Something Three"
oIn.Close 
```

如果您需要等待剪辑完成才能继续处理脚本，然后添加

```
' loop until we're finished working.
Do While oExec.Status = 0
    WScript.Sleep 100
Loop 
```

不要忘记释放你的对象

```
Set oIn = Nothing
Set oExec = Nothing 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-24T17:23:14.617

到目前为止，我发现的最接近的解决方案是使用 IE 在剪贴板上获取和设置内容的方法。此解决方案的问题是用户收到安全警告。我很想将“about:blank”移动到本地计算机安全区域，所以我没有收到警告，但我不确定这会带来什么安全隐患。

```
Set objIE = CreateObject("InternetExplorer.Application")
objIE.Navigate("about:blank")
objIE.document.parentwindow.clipboardData.SetData "text", "Hello This Is A Test"
objIE.Quit 
```

[http://www.microsoft.com/technet/scriptcenter/resources/qanda/dec04/hey1215.mspx](http://www.microsoft.com/technet/scriptcenter/resources/qanda/dec04/hey1215.mspx)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-26T17:27:08.653

为了避免与 Internet Explorer 和剪贴板访问相关的安全警告，我建议您使用 Word 应用程序对象及其方法将数据放到剪贴板上。当然，您只能在安装了 MS Word 的机器上使用它，但现在大部分都是这样。（*尽管您要求在“干净”系统上提供东西:) *）

```
' Set what you want to put in the clipboard '
strMessage = "Imagine that, it works!"

' Declare an object for the word application '
Set objWord = CreateObject("Word.Application")

' Using the object '
With objWord
   .Visible = False         ' Don't show word '
   .Documents.Add           ' Create a document '
   .Selection.TypeText strMessage   ' Put text into it '
   .Selection.WholeStory        ' Select everything in the doc '
   .Selection.Copy          ' Copy contents to clipboard '
   .Quit False          ' Close Word, don't save ' 
End With 
```

您可以在此处找到有关 MS Word 应用程序对象及其方法的详细信息：http: [//msdn.microsoft.com/en-us/library/aa221371 (office.11​​).aspx](http://msdn.microsoft.com/en-us/library/aa221371(office.11).aspx)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-12-19T17:32:22.320

没有安全警告，完全允许和获取访问权限：

```
'create a clipboard thing
 Dim ClipBoard
 Set Clipboard = New cClipBoard

 ClipBoard.Clear  
 ClipBoard.Data = "Test"

Class cClipBoard
        Private objHTML

                Private Sub Class_Initialize
                        Set objHTML = CreateObject("htmlfile")
                End Sub

                Public Sub Clear()
                        objHTML.ParentWindow.ClipboardData.ClearData()
                End Sub

                Public Property Let Data(Value)
                        objHTML.ParentWindow.ClipboardData.SetData "Text" , Value
                End Property

                Public Property Get Data()
                        Data = objHTML.ParentWindow.ClipboardData.GetData("Text")
                End Property

                Private Sub Class_Terminate
                        Set objHTML = Nothing
                End Sub

End Class 
```

示例用法。

```
' Create scripting object
Dim WShell, lRunUninstall
Set WShell = CreateObject("WScript.Shell")
WShell.sendkeys "^c"
WScript.Sleep 250
bWindowFound = WShell.AppActivate("Microsoft Excel")
 WShell.sendkeys ClipBoard.Data 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-06T15:19:53.413

Microsoft 没有让 VBScript 直接访问剪贴板。如果你`'clipboard'`在[这个](http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dninvbs/html/keydifferencesbetweenvisualbasicforapplicationsvbscript.asp)网站上搜索，你会看到：

> 尽管 Visual Basic for Applications 支持 Screen、Printer、App、Debug、Err 和 Clipboard 对象，但 VBScript 仅支持 Err 对象。因此，VBScript 不允许您访问诸如鼠标指针或剪贴板之类的有用对象。但是，您可以使用 Err 对象为您的应用程序提供运行时错误处理。

因此，间接使用记事本可能是您仅使用 VBScript 所能做的最好的事情。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-05-19T14:59:13.410

这是使用“clip”命令的另一个版本，它避免在字符串末尾添加回车、换行：

```
strA= "some character string" 
```

* * *

```
Set objShell = WScript.CreateObject("WScript.Shell")
objShell.Run "cmd /C echo . | set /p x=" & strA & "| c:\clip.exe", 2 
```

* * *

```
s = "String: """ & strA & """ is on the clipboard."
Wscript.Echo s 
```

我只在XP中测试过。clip.exe 从[Link](http://www.petri.co.il/downloads/clip.zip)下载并放置在`C:\`.

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-12-18T08:07:56.233

我找到了一种通过 vbscript/cmd 将多行信息复制到剪贴板的方法。

顺序：

*   使用 VBS 生成您需要复制到剪贴板的最终“格式化字符串”
*   使用“格式化字符串”生成（txt）文件
*   使用 cmd 中的 type 命令将信息粘贴到通过管道进行剪辑

示例脚本：

```
Function CopyToClipboard( sInputString )

    Dim oShell: Set oShell = CreateObject("WScript.Shell")
    Dim sTempFolder: sTempFolder = oShell.ExpandEnvironmentStrings("%TEMP%")
    Dim sFullFilePath: sFullFilePath = sTempFolder & "\" & "temp_file.txt"

    Const iForWriting = 2, bCreateFile = True
    Dim oFSO: Set oFSO = CreateObject("Scripting.FileSystemObject")
    With oFSO.OpenTextFile(sFullFilePath, iForWriting, bCreateFile)
        .Write sInputString
        .Close
    End With

    Const iHideWindow = 0, bWaitOnReturnTrue = True
    Dim sCommand: sCommand = "CMD /C TYPE " & sFullFilePath & "|CLIP"
    oShell.Run sCommand, iHideWindow, bWaitOnReturnTrue

    Set oShell = Nothing
    Set oFSO = Nothing

End Function

Sub Main

    Call CopyToClipboard( "Text1" & vbNewLine & "Text2" )

End Sub

Call Main 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-05-02T20:38:54.607

最简单的方法是使用内置`mshta.exe`功能：

```
sText = "Text Content"
CreateObject("WScript.Shell").Run "mshta.exe ""javascript:clipboardData.setData('text','" & Replace(Replace(sText, "\", "\\"), "'", "\'") & "');close();""", 0, True 
```

要将包含双引号 char 的字符串放入剪贴板`"`，请使用以下代码：

```
sText = "Text Content and double quote "" char"
CreateObject("WScript.Shell").Run "mshta.exe ""javascript:clipboardData.setData('text','" & Replace(Replace(Replace(sText, "\", "\\"), """", """"""), "'", "\'") & "'.replace('""""',String.fromCharCode(34)));close();""", 0, True 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-04-25T13:51:59.170

我设计了另一种使用 IE 的方法，但又避免了安全警告......

顺便说一句..这个函数是在 JavaScript 中的.. 但是你可以很容易地将它转换为 VBScript..

```
function CopyText(sTxt) {
    var oIe = WScript.CreateObject('InternetExplorer.Application');
    oIe.silent = true;
    oIe.Navigate('about:blank');
    while(oIe.ReadyState!=4) WScript.Sleep(20);
    while(oIe.document.readyState!='complete') WSript.Sleep(20);
    oIe.document.body.innerHTML = "<textarea id=txtArea wrap=off></textarea>";
    var oTb = oIe.document.getElementById('txtArea');
    oTb.value = sTxt;
    oTb.select();
    oTb = null;
    oIe.ExecWB(12,0);
    oIe.Quit();
    oIe = null;
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-10-10T13:35:51.933

这是Srikanth的方法翻译成vbs

```
function SetClipBoard(sTxt)
    Set oIe = WScript.CreateObject("InternetExplorer.Application")
    oIe.silent = true
    oIe.Navigate("about:blank")
    do while oIe.ReadyState <> 4
        WScript.Sleep 20
    loop

    do while oIe.document.readyState <> "complete"
        WScript.Sleep 20
    loop

    oIe.document.body.innerHTML = "<textarea id=txtArea wrap=off></textarea>"
    set oTb = oIe.document.getElementById("txtArea")
    oTb.value = sTxt
    oTb.select
    set oTb = nothing
    oIe.ExecWB 12,0
    oIe.Quit
    Set oIe = nothing
End function

function GetClipBoard()
    set oIe = WScript.CreateObject("InternetExplorer.Application")
    oIe.silent = true
    oIe.Navigate("about:blank")
    do while oIe.ReadyState <> 4
        WScript.Sleep 20
    loop

    do while oIe.document.readyState <> "complete"
        WScript.Sleep 20
    loop 

    oIe.document.body.innerHTML = "<textarea id=txtArea wrap=off></textarea>"
    set oTb = oIe.document.getElementById("txtArea")
    oTb.focus   
    oIe.ExecWB 13,0
    GetClipBoard = oTb.value
    oTb.select
    set oTb = nothing
    oIe.Quit
    Set oIe = nothing
End function 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-12-03T16:34:28.270

看看[这个帖子](http://bangbangsoundslikemachinery.blogspot.com/2011/08/reading-clipboard-from-vbscript.html)。*它描述了一种从剪贴板读取*的 hacky 方法，但我想它也可以适用于写入剪贴板，例如将 Ctrl+V 更改为 Ctrl+A 然后 Ctrl+C。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-09-10T12:48:35.930

在您的 Class`ClipBoard`中， Clear 子和 Let Data 子都不起作用。我的意思是它们对 Windows 没有影响`Clipboard`。实际上，具有讽刺意味的是，唯一有效的子程序是您的示例中未包含的子程序，即获取数据！（我已经多次测试了这段代码。）

然而，这不是你的错。我曾尝试使用 ClipboardData.SetData 将数据复制到剪贴板，但这是不可能的。至少不是通过创建“htmlfile”对象。正如我在少数情况下看到的那样，它可能通过创建“InternetExplorer.Application”的实例来工作，但我还没有尝试过。我讨厌为如此简单的任务创建应用程序实例！

阿尔基斯

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-06T15:23:38.850

如果只是文本，您不能简单地创建一个文本文件并在需要时读取内容吗？

另一种选择，显然是一个杂凑，将是使用该`SendKeys()`方法。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-08-27T15:01:32.740

行尾没有安全警告和回车

```
' value to put in Clipboard
mavaleur = "YEAH"

' current Dir
path = WScript.ScriptFullName
GetPath = Left(path, InStrRev(path, "\"))

' Put the value in a file
Set objFSO=CreateObject("Scripting.FileSystemObject")
outFile=GetPath & "fichier.valeur"
Set objFile = objFSO.CreateTextFile(outFile,True)
objFile.Write mavaleur
objFile.Close

' Put the file in the Clipboard
Set WshShell = WScript.CreateObject("WScript.Shell")
WshShell.Run "cmd.exe /c clip < " & outFile, 0, TRUE

' Erase the file
Set objFSO = CreateObject("Scripting.FileSystemObject")
objFSO.DeleteFile outFile 
```

# python - 从 Django 0.96 升级到 1.0 的最佳方式是什么？

> ID：128466
> 
> 赞同：8
> 
> 时间：2008-09-24T17:19:38.743
> 
> 标签：python, django

我应该尝试实际升级我现有的应用程序，还是只是从头开始重写它，我可以保存哪些部分（模板等）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T17:26:05.920

尽管这取决于您在做什么，但大多数应用程序应该能够升级然后修复所有损坏的东西。根据我的经验，升级后我必须修复的主要问题是

1.  使用模型更改了一些时髦的东西，例如跟随外键的语法。

2.  一小部分模板更改，最显着的是自动转义。

3.  任何取决于 Django 内部结构的具体结构。这不应该是一个问题，除非你正在做一些事情，比如动态修改 Django 内部，以对你的项目来说必要/方便的方式改变它们的行为。

总而言之，除非您正在做很多非常奇怪和/或复杂的事情，否则简单的升级应该相对轻松，并且只需要进行一些更改。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T17:23:18.750

升级。对我来说这很简单：更改`__str__()`为`__unicode__()`，编写 basic `admin.py`，然后完成。只需开始在 1.0 上运行您的应用程序，对其进行测试，当您遇到错误时，请使用有关[向后不兼容更改](http://code.djangoproject.com/wiki/BackwardsIncompatibleChanges)的文档来查看如何解决该问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T19:08:01.480

只需升级您的应用程序。从 0.96 到 1.0 的转变是巨大的，但就向后不兼容的变化而言，我怀疑你的应用程序甚至有 10%。

我在 Django 1.0 之前就在主干上，所以我的过渡是随着时间的推移，但即便如此，我必须改变的唯一主要事情是 newforms、newforms-admin、**str** () 到**unicode** () 和 maxlength 到 max_length

大多数其他更改是新功能或后端重写或构建基本网站的人甚至无法接近的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T10:40:03.960

只有最简单的站点才易于升级。

如果您的网站碰巧位于世界上的*非 ASCII*部分（阅读：美国和英国以外的任何地方），那么您会感到非常痛苦。Django 中最痛苦的变化是在内部从字节串转换为 unicode 对象——现在您必须找到所有使用字节串的地方并将其更改为 unicode。最坏的情况是模板渲染，你永远不会知道你忘记改变一个变量，直到你得到 UnicodeError。

其他值得注意的事情：操纵器（*oldforms ）已经消失，除了用表单（* *newforms* ）重写所有部分之外别无他法。

如果这是您的情况，并且您的项目大于 2-3 个应用程序，那么在真正必要之前，我将不愿意升级。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-04T12:52:44.033

我们在一个多步骤过程中进行了升级，对此我感到非常满意。Question 中的应用程序大约有 100.000 LoC，并运行多个核心业务功能，并与遗留系统有很多接口。我们是这样工作的：

1.  更新到 django 0.97-post unicode 合并。修复所有 unicode 问题
2.  将应用程序重构为可重用的应用程序，添加测试。这在主应用程序/项目中留下了 40.000 LoC
3.  升级到 django 0.97-post autoexcape 合并。修复3中创建的可重用应用中的自动转义。然后修复mian应用程序中剩余的自动转义问题。
4.  升级到 1.0。剩下的主要是修复管理的东西。

整个过程花了大约 6 个月的时间，我们在服务器上运行旧版生产分支，同时将另一个分支移植到 1.0。在这样做的同时，我们还向生产分支添加功能。

最终的合并比预期的要少得多，4 名编码人员合并、审查、测试和修复花了大约一周的时间。然后我们推出了，大约一周的时间被以前意想不到的错误所困扰。

总而言之，我对结果很满意。我们现在有一个更好的代码库以供进一步开发。

# com - 如何为 Windows Vista 编写有效的 IThumbnailProvider

> ID：128470
> 
> 赞同：10
> 
> 时间：2008-09-24T17:20:04.890
> 
> 标签：com, windows-vista, thumbnails

我已经按照 MSDN 上指定的接口编写了缩略图提供程序。但是，我一直无法弄清楚如何以 Vista 实际调用它的方式注册它。有没有人找到为 Vista 工作的缩略图提供商？示例代码或链接将特别有用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T14:30:08.923

[记录](http://msdn.microsoft.com/en-us/library/cc144118(VS.85).aspx#reg)的注册 IThumbnailProvider 的方法是在 HKCR\.ext\ShellEx\{E357FCCD-A995-4576-B01F-234630154E96} 创建一个注册表项，并将（默认）字符串值设置为 IThumbnailProvider 的 GUID。

您的程序集需要先注册。如果使用 .NET，这意味着您需要使用 RegAsm.exe 工具来注册它。

这里有示例代码：[http ://www.benryves.com/?mode=filtered&single_post=3189294](http://www.benryves.com/?mode=filtered&single_post=3189294)

# python - import 语句是否应该始终位于模块的顶部？

> ID：128478
> 
> 赞同：482
> 
> 时间：2008-09-24T17:21:47.757
> 
> 标签：python, optimization, pep8

[PEP 8](http://www.python.org/dev/peps/pep-0008/)指出：

> 导入总是放在文件的顶部，就在任何模块注释和文档字符串之后，模块全局变量和常量之前。

但是，如果我正在导入的类/方法/函数仅在极少数情况下使用，那么在需要时进行导入肯定会更有效吗？

这不就是：

```
class SomeClass(object):

    def not_often_called(self)
        from datetime import datetime
        self.datetime = datetime.now() 
```

比这更有效率？

```
from datetime import datetime

class SomeClass(object):

    def not_often_called(self)
        self.datetime = datetime.now() 
```

* * *

## 回答 #1

> 赞同：345
> 
> 时间：2008-09-24T17:38:00.760

模块导入非常快，但不是即时的。这意味着：

*   将导入放在模块的顶部很好，因为这是一个微不足道的成本，只需支付一次。
*   将导入放在函数中会导致对该函数的调用花费更长的时间。

因此，如果您关心效率，请将进口放在首位。仅当您的分析显示有帮助时才将它们移动到一个函数中（您**进行了**分析以查看在哪里可以最好地提高性能，对吗？？）

* * *

我见过执行惰性导入的最佳原因是：

*   可选的库支持。如果您的代码有多个使用不同库的路径，如果未安装可选库，请不要中断。
*   在`__init__.py`插件中，它可能被导入但未实际使用。示例是 Bazaar 插件，它使用`bzrlib`' 的延迟加载框架。

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2008-09-24T20:36:46.977

将 import 语句放在函数内部可以防止循环依赖。例如，如果您有 2 个模块，X.py 和 Y.py，并且它们都需要相互导入，那么当您导入其中一个模块导致无限循环时，这将导致循环依赖。如果您在其中一个模块中移动 import 语句，那么在调用该函数之前它不会尝试导入另一个模块，并且该模块已经被导入，因此没有无限循环。阅读此处了解更多信息 - [effbot.org/zone/import-confusion.htm](http://effbot.org/zone/import-confusion.htm)

* * *

## 回答 #3

> 赞同：73
> 
> 时间：2008-09-24T18:16:13.397

我采用了将所有导入放在使用它们的函数中的做法，而不是放在模块的顶部。

我得到的好处是能够更可靠地重构。当我将一个函数从一个模块移动到另一个模块时，我知道该函数将继续使用其所有遗留的测试功能完好无损。如果我在模块的顶部有我的导入，当我移动一个函数时，我发现我最终会花费大量时间来完成新模块的导入并且最小化。重构 IDE 可能使这无关紧要。

如其他地方所述，存在速度惩罚。我在我的应用程序中测量了这一点，发现它对我的目的来说微不足道。

无需借助搜索（例如 grep）就能够预先查看所有模块依赖项也很不错。但是，我关心模块依赖关系的原因通常是因为我正在安装、重构或移动包含多个文件的整个系统，而不仅仅是单个模块。在这种情况下，无论如何我都将执行全局搜索以确保我具有系统级依赖项。所以我没有找到全局导入来帮助我理解实践中的系统。

我通常将 import of`sys`放在`if __name__=='__main__'`检查中，然后将参数（如`sys.argv[1:]`）传递给`main()`函数。这使我可以在尚未导入`main`的上下文中使用。`sys`

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2008-09-24T17:31:08.780

大多数情况下，这对于清晰和明智的做法很有用，但并非总是如此。以下是模块导入可能存在于其他地方的几个示例。

首先，您可以拥有一个带有以下形式的单元测试的模块：

```
if __name__ == '__main__':
    import foo
    aa = foo.xyz()         # initiate something for the test 
```

其次，您可能需要在运行时有条件地导入一些不同的模块。

```
if [condition]:
    import foo as plugin_api
else:
    import bar as plugin_api
xx = plugin_api.Plugin()
[...] 
```

在其他情况下，您可能会将导入放在代码的其他部分。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-09-24T17:30:04.570

当函数被调用零次或一次时，第一个变体确实比第二个更有效。然而，对于第二次和随后的调用，“导入每个调用”方法实际上效率较低。有关延迟加载技术，请参阅[此链接](http://wiki.python.org/moin/PythonSpeed/PerformanceTips#head-c849d5d5d94bc3eacbff9d5746af4083443cf2ca)，该技术通过“延迟导入”结合了两种方法的优点。

但是，除了效率之外，还有其他原因导致您可能更喜欢其中一个。一种方法是让阅读代码的人更清楚地了解该模块所具有的依赖关系。它们也有非常不同的失败特征——如果没有“datetime”模块，第一个将在加载时失败，而第二个在调用方法之前不会失败。

**补充说明：**在 IronPython 中，导入的成本可能比在 CPython 中高很多，因为代码基本上是在导入时编译的。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-24T17:32:50.647

Curt 提出了一个很好的观点：第二个版本更清晰，并且会在加载时失败，而不是稍后，并且出乎意料。

通常我不担心加载模块的效率，因为它（a）非常快，并且（b）大部分只发生在启动时。

`__import__`如果您必须在意外的时间加载重量级模块，使用函数动态加载它们可能更有意义，并**确保**捕获`ImportError`异常并以合理的方式处理它们。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-09-24T17:30:34.320

我不会担心过多地预先加载模块的效率。模块占用的内存不会很大（假设它足够模块化），启动成本可以忽略不计。

在大多数情况下，您希望在源文件的顶部加载模块。对于阅读您的代码的人来说，它可以更容易地分辨出哪个函数或对象来自哪个模块。

在代码的其他地方导入模块的一个很好的理由是它是否在调试语句中使用。

例如：

```
do_something_with_x(x) 
```

我可以使用以下方法进行调试：

```
from pprint import pprint
pprint(x)
do_something_with_x(x) 
```

当然，在代码的其他地方导入模块的另一个原因是如果您需要动态导入它们。这是因为你几乎别无选择。

我不会担心过多地预先加载模块的效率。模块占用的内存不会很大（假设它足够模块化），启动成本可以忽略不计。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-24T17:31:17.093

这是一个权衡，只有程序员才能决定做出。

案例 1 通过在需要之前不导入 datetime 模块（并执行它可能需要的任何初始化）来节省一些内存和启动时间。请注意，“仅在调用时”进行导入也意味着“每次调用时”都进行导入，因此第一次调用之后的每个调用仍然会产生额外的导入开销。

*案例 2 通过预先导入 datetime 来节省一些执行时间和延迟，这样 not_often_called()在*调用时会更快地返回，并且不会在每次调用时产生导入开销。

除了效率之外，如果 import 语句是……预先看到的，就更容易预先看到模块依赖关系。将它们隐藏在代码中会使更难找到某些模块所依赖的模块。

就个人而言，我通常遵循 PEP，除了单元测试之类的东西，我不想总是加载，因为我*知道*除了测试代码之外它们不会被使用。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-24T17:48:02.827

这是一个示例，其中所有导入都位于最顶部（这是我唯一需要这样做的时间）。我希望能够终止 Un*x 和 Windows 上的子进程。

```
import os
# ...
try:
    kill = os.kill  # will raise AttributeError on Windows
    from signal import SIGTERM
    def terminate(process):
        kill(process.pid, SIGTERM)
except (AttributeError, ImportError):
    try:
        from win32api import TerminateProcess  # use win32api if available
        def terminate(process):
            TerminateProcess(int(process._handle), -1)
    except ImportError:
        def terminate(process):
            raise NotImplementedError  # define a dummy function 
```

（审查：[约翰·米利金](https://stackoverflow.com/questions/128478/should-python-import-statements-always-be-at-the-top-of-a-module#128577)所说的。）

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-09-24T17:49:54.477

这就像许多其他优化一样——你牺牲了一些可读性来换取速度。正如 John 所提到的，如果您已经完成了分析作业并发现这是一个非常有用的更改**，并且**您需要额外的速度，那么就去做吧。与所有其他导入一起记下可能会很好：

```
from foo import bar
from baz import qux
# Note: datetime is imported in SomeClass below 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-24T17:52:54.843

模块初始化只发生一次 - 在第一次导入时。如果有问题的模块来自标准库，那么您也可能会从程序中的其他模块导入它。对于像 datetime 这样流行的模块，它也可能是许多其他标准库的依赖项。由于模块初始化已经发生，因此导入语句的成本非常低。此时它所做的只是将现有的模块对象绑定到本地范围。

将该信息与可读性参数结合起来，我会说最好在模块范围内使用 import 语句。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2018-05-10T22:23:49.773

我很惊讶没有看到已经发布的重复负载检查的实际成本数字，尽管对预期结果有很多很好的解释。

如果你在顶部导入，无论如何你都会承受负载。这非常小，但通常以毫秒为单位，而不是纳秒。

如果您在函数中导入，那么只有在*首次*调用其中一个函数时*才会加载。*正如许多人指出的那样，如果根本没有发生这种情况，您可以节省加载时间。但是如果函数被调用了很多次，你会重复一次，但要小得多（用于检查它*是否*已加载；而不是实际重新加载）。另一方面，正如@aaronasterling 指出的那样，您还可以节省一点，因为在函数中导入可以让函数使用稍快的*局部变量*查找来稍后识别名称（[http://stackoverflow.com/questions/477096/python-导入编码样式/4789963#4789963](http://stackoverflow.com/questions/477096/python-import-coding-style/4789963#4789963)）。

 ***这是从函数内部导入一些东西的简单测试的结果。报告的时间（在 2.3 GHz 英特尔酷睿 i7 上的 Python 2.7.14 中）如下所示（第二次调用比后来的调用多似乎是一致的，尽管我不知道为什么）。

```
 0 foo:   14429.0924 µs
 1 foo:      63.8962 µs
 2 foo:      10.0136 µs
 3 foo:       7.1526 µs
 4 foo:       7.8678 µs
 0 bar:       9.0599 µs
 1 bar:       6.9141 µs
 2 bar:       7.1526 µs
 3 bar:       7.8678 µs
 4 bar:       7.1526 µs 
```

编码：

```
from __future__ import print_function
from time import time

def foo():
    import collections
    import re
    import string
    import math
    import subprocess
    return

def bar():
    import collections
    import re
    import string
    import math
    import subprocess
    return

t0 = time()
for i in xrange(5):
    foo()
    t1 = time()
    print("    %2d foo: %12.4f \xC2\xB5s" % (i, (t1-t0)*1E6))
    t0 = t1
for i in xrange(5):
    bar()
    t1 = time()
    print("    %2d bar: %12.4f \xC2\xB5s" % (i, (t1-t0)*1E6))
    t0 = t1 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2013-07-01T14:41:01.067

只是为了完成[Moe 的回答](https://stackoverflow.com/a/129810/955619)和原始问题：

**当我们必须处理循环依赖时，我们可以做一些“技巧”。**假设我们正在使用分别包含`a.py`和b的模块。然后：`b.py``x()``y()`

1.  我们可以移动`from imports`模块底部的其中一个。
2.  我们可以移动`from imports`实际上需要导入的函数或方法的内部之一（这并不总是可能的，因为您可能会在多个地方使用它）。
3.  我们可以将两者之一更改`from imports`为如下所示的导入：`import a`

所以，总结一下。如果您没有处理循环依赖并采取某种技巧来避免它们，那么最好将所有导入放在顶部，因为该问题的其他答案中已经解释了原因。并且请在执行此“技巧”时包含评论，它总是受欢迎的！:)

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2016-04-04T14:56:03.900

除了已经给出的出色答案之外，值得注意的是，导入的位置不仅仅是风格问题。有时，模块具有需要首先导入或初始化的隐式依赖项，而顶级导入可能会导致违反所需的执行顺序。

这个问题经常出现在 Apache Spark 的 Python API 中，您需要在导入任何 pyspark 包或模块之前初始化 SparkContext。最好将 pyspark 导入放在 SparkContext 保证可用的范围内。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2016-11-29T09:36:53.970

我不想提供完整的答案，因为其他人已经做得很好了。当我发现在函数中导入模块特别有用时，我只想提一个用例。我的应用程序使用存储在特定位置的 python 包和模块作为插件。在应用程序启动期间，应用程序遍历该位置中的所有模块并导入它们，然后它查看模块内部，如果它找到插件的一些安装点（在我的情况下，它是某个基类的子类，具有唯一ID）它注册它们。插件的数量很大（现在有几十个，但将来可能有数百个），而且每个插件都很少使用。在我的插件模块顶部导入第三方库在应用程序启动期间会受到一点惩罚。尤其是一些第三方库的导入很重（例如，plotly 的导入甚至尝试连接到互联网并下载一些在启动时增加了大约一秒钟的东西）。通过优化插件中的导入（仅在使用它们的函数中调用它们），我设法将启动时间从 10 秒缩短到 2 秒左右。这对我的用户来说是一个很大的不同。

所以我的回答是否定的，不要总是将导入放在模块的顶部。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2018-04-09T23:50:26.103

有趣的是，到目前为止，没有一个答案提到并行处理，当序列化的函数代码被推送到其他内核时，可能需要导入在函数中，例如在 ipyparallel 的情况下。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2021-11-11T12:37:02.123

这是对此 [和](https://stackoverflow.com/questions/1188640)[相关](https://stackoverflow.com/questions/1024049) 问题的答案的更新**摘要。**

*   **PEP 8** [建议](https://www.python.org/dev/peps/pep-0008/#imports) 将导入放在顶部。
*   当你第一次运行你的程序而不是当你的程序第一次调用你的函数时 获取s通常更[方便。](https://stackoverflow.com/a/128522/38281)`ImportError`
*   顶部的导入增强了*可读性*，因为您可以一目了然地看到所有*依赖项。*
*   如果导入位于 *使用它们的函数中*（便于将其移动到另一个模块），[重构可能会更容易。](https://stackoverflow.com/a/128859/38281)也可以说这有利于*可读性*。
*   将导入放在函数范围内可以帮助避免[循环导入](https://stackoverflow.com/a/129810/)的问题。
*   将导入放在函数范围内有助于保持模块*命名空间干净*，这样它就不会出现在选项卡完成建议中。
*   [启动时间](https://stackoverflow.com/a/40862317/)：函数中的导入在（如果）调用该函数之前不会运行。使用重量级库可能会变得很重要。
*   即使 import 语句在随后的运行中速度非常快，但 如果函数很简单但经常使用，它们仍然会导致[速度损失，这可能会很严重。](https://stackoverflow.com/a/1189199/)
*   进口`__name__ == "__main__"`看守[似乎很合理](https://stackoverflow.com/a/128532/)。
*   似乎还不清楚*动态*或*条件*导入是否更喜欢一种风格而不是另一种风格。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2020-01-19T18:11:30.240

# 可读性

除了启动性能之外，还有一个可读性参数用于本地化`import`语句。例如，在我当前的第一个 python 项目中取 python 行号 1283 到 1296：

```
listdata.append(['tk font version', font_version])
listdata.append(['Gtk version', str(Gtk.get_major_version())+"."+
                 str(Gtk.get_minor_version())+"."+
                 str(Gtk.get_micro_version())])

import xml.etree.ElementTree as ET

xmltree = ET.parse('/usr/share/gnome/gnome-version.xml')
xmlroot = xmltree.getroot()
result = []
for child in xmlroot:
    result.append(child.text)
listdata.append(['Gnome version', result[0]+"."+result[1]+"."+
                 result[2]+" "+result[3]]) 
```

如果`import`语句在文件的顶部，我将不得不向上滚动很长一段路，或者按`Home`，找出是什么`ET`。然后我必须导航回第 1283 行继续阅读代码。

实际上，即使该`import`语句位于函数（或类）的顶部，正如许多人所放置的那样，也需要向上和向后翻页。

很少会显示 Gnome 版本号，因此`import`文件顶部会引入不必要的启动延迟。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-11-06T09:15:53.293

通过在函数内部导入变量/局部范围可以提高性能。这取决于函数内部导入的东西的用法。如果您要循环多次并访问模块全局对象，则将其作为本地导入会有所帮助。

# 测试.py

```
X=10
Y=11
Z=12
def add(i):
  i = i + 10 
```

# 运行本地文件

```
from test import add, X, Y, Z

    def callme():
      x=X
      y=Y
      z=Z
      ladd=add 
      for i  in range(100000000):
        ladd(i)
        x+y+z

    callme() 
```

# 运行.py

```
from test import add, X, Y, Z

def callme():
  for i in range(100000000):
    add(i)
    X+Y+Z

callme() 
```

在 Linux 上的时间显示了一点收获

```
/usr/bin/time -f "\t%E real,\t%U user,\t%S sys" python run.py 
    0:17.80 real,   17.77 user, 0.01 sys
/tmp/test$ /usr/bin/time -f "\t%E real,\t%U user,\t%S sys" python runlocal.py 
    0:14.23 real,   14.22 user, 0.01 sys 
```

真实的是挂钟。用户在程序中的时间。sys 是系统调用的时间。

[https://docs.python.org/3.5/reference/executionmodel.html#resolution-of-names](https://docs.python.org/3.5/reference/executionmodel.html#resolution-of-names)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2021-09-14T02:42:13.147

虽然[PEP](https://pep8.org/#imports)鼓励在模块顶部导入，但在其他级别导入也不是错误。这表明进口应该在顶部，但也有例外。

在使用模块时加载模块是一种微优化。导入缓慢的代码如果能产生相当大的差异，可以在以后进行优化。

不过，您可能会引入标志以有条件地在尽可能靠近顶部的位置导入，从而允许用户使用配置来导入他们需要的模块，同时仍然立即导入所有内容。

尽快导入意味着如果任何导入（或导入的导入）丢失或存在语法错误，程序将失败。如果所有导入都发生在所有模块的顶部，则 python 分两步工作。编译。跑。

内置模块可以在任何导入它们的地方工作，因为它们设计得很好。你写的模块应该是一样的。将您的导入移动到顶部或第一次使用可以帮助确保没有副作用并且代码正在注入依赖项。

无论您是否将导入放在顶部，当导入位于顶部时，您的代码应该仍然可以工作。因此，首先立即导入，然后根据需要进行优化。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-07-05T19:37:34.383

我想提一下我的一个用例，与@John Millikin 和@VK 提到的非常相似：

# 可选导入

我使用 Jupyter Notebook 进行数据分析，并使用相同的 IPython notebook 作为所有分析的模板。在某些情况下，我需要导入 Tensorflow 来进行一些快速的模型运行，但有时我会在没有设置 tensorflow / 导入速度慢的地方工作。在这些情况下，我将依赖于 Tensorflow 的操作封装在一个辅助函数中，在该函数中导入 tensorflow，并将其绑定到一个按钮。

这样，我可以执行“重新启动并运行所有”操作，而无需等待导入，也不必在失败时恢复其余单元。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-09-16T08:33:02.053

这是一个有趣的讨论。像许多其他人一样，我什至从未考虑过这个话题。由于想在我的一个库中使用 Django ORM，我不得不在函数中进行导入。我不得不`django.setup()`在导入我的模型类之前调用​​，因为它位于文件的顶部，由于 IoC 注入器构造，它被拖到完全非 Django 库代码中。

我稍微修改了一下，最终将`django.setup()`单例构造函数和相关导入放在每个类方法的顶部。现在这工作正常，但让我感到不安，因为进口不在顶部，而且我开始担心进口的额外时间打击。然后我来到这里，怀着极大的兴趣阅读了每个人对此的看法。

我有很长的 C++ 背景，现在使用 Python/Cython。我对此的看法是，为什么不将导入放入函数中，除非它会导致您遇到瓶颈。这就像在您需要变量之前为变量声明空间。问题是我有数千行代码，所有导入都在顶部！所以我想我会从现在开始做，当我路过并有时间时，在这里和那里改变奇怪的文件。

# internet-explorer - 恢复浏览器文本区域

> ID：128480
> 
> 赞同：2
> 
> 时间：2008-09-24T17:22:49.687
> 
> 标签：internet-explorer, firefox, browser

有没有办法恢复浏览器文本区域的内容？比如说，您输入了一个很长的帖子，然后不小心点击了一个链接。然后，当您返回时，文本字段诱人地保留了您输入的文本，但文本区域是空白的。IE 和 Firefox 将预填充的内容存储在哪里？textarea可以带回来吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T17:31:55.190

您可以尝试一件事（虽然我没有尝试过，所以我不能说这种方法有多有效）*立即*尝试在浏览器的内存空间中搜索文本 - 也许它没有被释放，甚至如果它被释放，也许它没有被其他数据覆盖。

您可以在 Windows 上执行此操作，例如使用[HXD Hex Editor](http://mh-nexus.de/en/hxd/)，它可以打开其他进程的地址空间，您可以使用它来搜索字符串。

最后一点：您还应该尝试搜索字符串的 Unicode 变体，因为浏览器完全有可能在内部将其保留为 Unicode。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T17:28:23.590

有一个[Greasemonkey 脚本](http://userscripts.org/scripts/show/7671)可以自动备份 textareas，但据我所知，浏览器只是将文本存储在内存中而不将其写入磁盘。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-08T14:57:09.867

尽管这不能解决您的问题，我只能建议扫描内存并查找文本的某些部分，但**Firefox**的此扩展可能可以防止将来丢失文本的情况。

[https://addons.mozilla.org/en-US/firefox/addon/5761](https://addons.mozilla.org/en-US/firefox/addon/5761)

页面描述：

> 当用户键入时，此扩展程序将自动将内容保存在页面上的 textarea 中。用户可以恢复缓存窗口中保存的文本，即使选项卡或窗口意外关闭。
> 
> 当文本保存在缓存中时，用户将在状态栏中看到一个图标。单击该图标可打开缓存窗口。
> 
> 在工具栏中添加 Textarea Cache 按钮会很有用。此按钮可以帮助用户进行高级设置或打开缓存窗口。

**2014 年更新**：Chrome 和 Firefox 也有一个更新的扩展：Lazarus: **Form Recovery**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T17:26:41.520

每当我输入很长的内容时，我总是在提交表单之前将其复制到剪贴板以防万一。或者，有时我在记事本中输入它，完成后将其复制过来。这可能不是您正在寻找的答案，但它可能会有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T17:28:12.810

这部分取决于浏览器。我知道在某些情况下文本字段仍然存在。差异似乎与连接是否为 HTTPS 有关。

如果您是相关站点的开发人员，您可以定期执行某种 ajax 自动保存来帮助用户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T17:29:58.657

据我所知，它已经消失了。如果浏览器将它存放在某个地方，那么当您返回时它会将其保存在文本区域中。要解决此问题，您可以：

*   在您自己的机器上安装键盘记录器（可能是个坏主意）
*   编写一个 Firefox 插件来实际将这些数据缓存在可恢复的地方（也许我们可以问 StackOverflow 如何做到这一点。）
*   正如 VirtuosiMedia 建议的那样，将其组合到其他地方，然后在完成后将其粘贴到浏览器中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T17:35:52.277

如果您开发站点，您可以添加一个 onblur 事件来及时存储数据（ajax、cookie）并检查加载页面是否有以前输入的文本。

# .net - 如何让 ImageMagick 与 Ghostscript 对话

> ID：128499
> 
> 赞同：1
> 
> 时间：2008-09-24T17:26:31.520
> 
> 标签：.net, image, pdf, magicknet

我在 Windows XP 上。

我正在使用 ImageMagick (MagickNet) 将 PDF 转换为 TIF。

我的问题是，当我在 MagicNet.Image 对象中加载 PDF 时，它不会抛出错误，但是当我查看属性时，很明显它没有加载 PDF（它不包含任何数据）。

我的猜测是 ImageMagick 没有与 Ghostscript 交谈。

有任何想法吗？

--我忘了提，我确实安装了Ghost Script，并将它的bin文件夹添加到PATH

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T17:40:22.627

你确定安装了[Ghostscript](http://pages.cs.wisc.edu/~ghost/)吗？默认情况下，它不包含在 ImageMagick 包中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T18:35:16.270

也许您已经做过类似的事情，但是为了确保您已经将问题隔离到 ImageMagick 和 GhostScript（而不是 MagickNet，它只是一个包装器），您可以查看 ImageMagick 的命令行 convert.exe能够将您的 PDF 转换为 TIFF 吗？我从来没有见过 convert.exe 不能做一些可以通过基于 API 的方法完成的事情（我没有使用过 MagickNet，但我已经广泛使用了 convert.exe 实用程序，并通过互操作使用了 ImageMagickObject COM DLL ）。对于一个简单的测试，它应该很简单：

```
c:\PATH_TO_IMAGEMAGICK\convert YourInput.pdf YourOutput.tif 
```

如果可行，那么您的 ImageMagick 和 GhostScript 安装基本没问题，需要在 MagickNet 或您的应用程序中进行一些操作；如果它不起作用，那么您的 ImageMagick 和/或 GhostScript 安装/配置有问题。

如果事实证明 MagickNet 是问题所在，那么使用 ImageMagickObject 通过互操作进行转换也不错。您只需创建一个实例，然后在其上调用“convert”，就好像它是一个静态方法，其参数与命令行 convert.exe 的参数几乎相同：

```
ImageMagickObject.MagickImage img = new MagickImage();

object[] parms = new object[2];
parms[0] = "YourInput.pdf";
parms[1] = "YourOuput.tif";
img.Convert(ref parms); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-10-29T17:20:53.977

我在想如果你在转换之前设置了 ghostScript 目录。代码应该是`MagickNET.SetGhostscriptDirectory(@"your path here");`

# ruby - 来自 cgi.rb 的 Ruby 错误“类 Cookie 的超类不匹配”

> ID：128502
> 
> 赞同：4
> 
> 时间：2008-09-24T17:26:51.537
> 
> 标签：ruby, eruby

我刚刚将我的 gentoo 服务器上的 ruby​​ 安装更新到 ruby​​ 1.8.6 补丁级别 287，并且我的一个 eRuby 应用程序开始出现错误。apache error_log 文件中给出的错误是：

```
[error] mod_ruby: /usr/lib/ruby/1.8/cgi.rb:774: superclass mismatch for class Cookie (TypeError) 
```

奇怪的是，它有时似乎可以工作-但有时我会收到该错误。有人有什么想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-17T04:08:24.237

正如错误消息所说，在代码中的某处打开了 Cookie 类，它使用的超类与先前定义或打开 Cookie 类中使用的超类不同。

即使一个没有明确指定超类的类定义仍然有一个超类：

```
class Cookie
end 
```

这用 Object 的超类定义了 Cookie 类。

我之前遇到过这个错误，当你有一些代码试图重新打开一个类而不指定超类时会发生这种错误，而程序员的假设是这个类（在本例中为 Cookie）已经定义了，并且他只是重新打开它以添加一些功能。但是，如果重新打开和定义的顺序相反，您将收到该错误，因为该类已经被定义为 Object 的子类，但正在尝试重新定义或使用不同的超类重新打开。在 irb 中试试这个：

```
% irb
irb(main):001:0> class C < String; end
=> nil
irb(main):002:0> class C; end
=> nil
irb(main):003:0> exit
% irb
irb(main):001:0> class C; end
=> nil
irb(main):002:0> class C < String; end
TypeError: superclass mismatch for class C
        from (irb):2 
```

So, you probably just have to grep for definitions of the Cookie class and try to ensure files are always being require-d in the correct order. This may or may not be easy. :)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T18:48:40.840

当您重新声明一个已经声明的类时，就会出现该错误，这很可能是因为您正在加载 cgi.rb 的两个不同副本。请参阅[Rails 中的类似问题](http://209.85.173.104/search?q=cache:wbXLBotEIvUJ:railsforum.com/viewtopic.php%3Fid%3D10993+superclass+mismatch+for&hl=en&ct=clnk&cd=3&gl=us&client=safari)。

# c# - 子类函数中 NotSupportedException 的编译时错误

> ID：128512
> 
> 赞同：1
> 
> 时间：2008-09-24T17:28:32.060
> 
> 标签：c#, exception, inheritance

如果我有一个尚未实现基类提供的函数的子类，我可以重写该函数并让它抛出一个`NotSupportedException`. 有没有办法为此生成编译时错误以避免仅在运行时遇到此错误？

更新：我不能使基类抽象。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T17:30:42.807

您可以使基类抽象：

```
abstract class Foo
{
    public abstract void Bar();
} 
```

现在，任何子类都必须实现`Bar()`，否则将无法编译。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T17:29:55.287

使其抽象而没有实现，并且无法在派生类中实现它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T17:33:26.167

[Obsolete("这仍然需要实现", true/false)] 如果您不希望构建成功，则为 true，如果您只需要警告，则为 false

有点骇人听闻……但它在编译时起到了警告的作用。

# c# - 根据构建常量修改配置文件

> ID：128513
> 
> 赞同：2
> 
> 时间：2008-09-24T17:28:41.233
> 
> 标签：c#, .net, configuration-files

我有一个依赖于一些内部 Web 服务的应用程序，因此我们希望我们的开发和登台配置指向 Web 服务的开发和登台服务器。

现在，这意味着手动编辑我的 app.config 文件以指向适当的 URL。这不仅麻烦，而且容易出现人为错误（“哎呀，我没有删除那个生产 URL 吗？”可能会导致很多问题）。

在代码中的少数几个地方，我使用

```
#if DEBUG
    // do something
#endif 
```

预处理语句，并且想知道是否可以对 app.config 中的值执行类似的操作。我已经能够使用我的应用程序设置很好地做到这一点，因为这些值可以在代码中访问。

我知道构建后脚本，但似乎有一种比编写例程更简单的方法来处理 app.config XML 每次我进行构建时。有什么建议么？

这适用于 C# 和 .NET 3.5，包括旧的“Web 引用”以及较新的 WCF“Web 服务”引用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T17:39:59.273

我们使用 SourceForge 的一个名为[XmlPreprocessor](http://xmlpreprocess.sourceforge.net/content/default.htm)的程序来处理这个问题。它允许您在配置文件和不同的值文件中创建参数以填充它们。

给定以下文件：

应用程序配置

```
...
<importantSetting>$importantSettingValue$</importantSetting>
... 
```

qavalues.xml

```
...
<importantSettingValue>QAvalue</importantSettingValue>
... 
```

产品价值.xml

```
...
<importantSettingValue>PRODvalue</importantSettingValue>
... 
```

遵循以下行的命令行是在正确位置获取正确值所需的全部内容。

```
XmlPreProcess.exe app.config qavalues.xml 
```

# artificial-intelligence - 任何使用马尔可夫链的商业例子？

> ID：128517
> 
> 赞同：19
> 
> 时间：2008-09-24T17:29:41.840
> 
> 标签：artificial-intelligence, markov-chains

使用马尔可夫链有哪些商业案例？我已经看到将马尔可夫链的游戏区域应用于某人的博客以撰写虚假帖子。我想要一些实际的例子吗？例如，在商业或股票市场预测等方面有用......

**编辑**：感谢所有提供示例的人，我对每个示例都投了赞成票，因为它们都很有用。
**Edit2**：我选择了最详细的答案作为接受的答案。我赞成的所有答案。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-24T17:32:11.710

显而易见的一个：Google 的 PageRank。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-24T17:53:06.107

[隐马尔可夫模型](http://en.wikipedia.org/wiki/Hidden_Markov_models)基于马尔可夫链，广泛用于语音识别，尤其是生物信息学。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-24T17:33:21.410

我已经看到垃圾邮件显然是使用马尔可夫链生成的——当然这符合“商业用途”的条件。:)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-24T17:41:49.377

我们使用日志文件链分析来获取和促进指向我们帮助系统（10m 文档的集合）中其他不相关文档的二级和三级链接。

这对于桥接其他单独的分类法特别有用。例如 SQL 文档与 IIS 文档。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-30T14:23:16.797

有一类基于[马尔可夫链蒙特卡罗](http://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo)（MCMC）方法的优化方法。这些已应用于各种实际问题，例如信号和图像处理应用到数据分割和分类。语音和图像识别，时间序列分析，许多类似的例子都来自计算机视觉和模式识别。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-24T17:59:00.210

我知道 AccessData 在他们的[取证密码破解工具](http://accessdata.com/decryptionTool.html)中使用了它们。它可以让您首先探索更有可能的密码短语，从而更快地恢复密码（平均而言）。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-03-24T16:34:47.447

有一些商业的光线追踪系统实现了**Metropolis Light Transport**（由 Eric Veach 发明，基本上他将 Metropolis hastings 应用于光线追踪），并且**双向**和**重要性采样** **路径**追踪器使用马尔可夫链。

粗体文本是可搜索的，为了这个线程，我省略了进一步的解释。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-10-28T08:09:24.300

像 bing 这样的搜索公司使用马尔可夫链从用户在结果页面上的点击序列推断文档的相关性。典型查询会话中的基本用户行为被建模为马尔可夫链，特定行为为状态转换......例如，如果文档是相关的，用户可能仍然检查更多文档（但概率较小），否则他可能会检查更多文档（概率更大）。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-24T16:52:17.593

我们计划将其用于手持设备上的预测文本输入，以便在工业环境中输入数据。在词汇量合理的情况下，可以根据频率建议转换到下一个单词。我们的初步测试表明，这将很好地满足我们的需求。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-05T03:56:13.507

IBM 有 CELM。查看此链接： [http ://www.research.ibm.com/journal/rd/513/labbi.pdf](http://www.research.ibm.com/journal/rd/513/labbi.pdf)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-09-16T00:24:22.547

我最近偶然发现了一个使用马尔可夫链创建测试数据的博客示例......

[http://github.com/emelski/code.melski.net/blob/master/markov/main.cpp](http://github.com/emelski/code.melski.net/blob/master/markov/main.cpp)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-06-19T07:44:08.973

马尔可夫模型是一种描述经历一系列状态的过程的方法。

HMM 可以应用于许多领域，其目标是恢复不能立即观察到的数据序列（但取决于该序列上的一些其他数据）。

常见的应用包括：

*密码分析、语音识别、词性标注、机器翻译、股票预测、基因预测、生物序列对齐、手势识别、活动识别、检测用户在网站上的浏览模式。*

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-12-23T11:37:14.857

马尔可夫链可用于模拟用户交互，fg 浏览服务时。

我的朋友正在使用马尔可夫链写作文凭工作抄袭识别（他说输入数据必须是整本书才能成功）。

它可能不是很“商业”，但马尔可夫链可用于生成虚构的地名和人名，尤其是在 RPG 游戏中。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-04-21T21:51:07.593

马尔可夫链用于人寿保险，特别是在永久性残疾模型中。有3个状态

*   0 - 生活健康
*   1 - 生活变得残疾
*   2 - 生命消逝

In a permanent disability model the insurer may pay some sort of benefit if the insured becomes disabled and/or the life insurance benefit when the insured dies. The insurance company would then likely run a monte carlo simulation based on this Markov Chain to determine the likely cost of providing such an insurance.

# oracle - 当连接变坏时，有什么方法可以让 JBoss 连接池重新连接到 Oracle？

> ID：128527
> 
> 赞同：32
> 
> 时间：2008-09-24T17:30:40.247
> 
> 标签：oracle, jboss, connection-pooling, reconnect

我们的 JBoss 和 Oracle 在不同的服务器上。连接似乎已断开，并导致 JBoss 出现问题。如果连接不好，我如何让 JBoss 重新连接到 Oracle，而我们首先要弄清楚为什么连接会被丢弃？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-28T13:59:14.033

虽然您可以使用旧的“从双重选择 1”技巧，但这样做的缺点是每次从池中借用连接时都会发出额外的查询。对于大容量，这是浪费的。

JBoss 提供了一个特殊的连接验证器，应该用于 Oracle：

```
<valid-connection-checker-class-name>
    org.jboss.resource.adapter.jdbc.vendor.OracleValidConnectionChecker
</valid-connection-checker-class-name> 
```

这利用了 Oracle JDBC Connection 类上的专有 ping() 方法，并使用驱动程序的底层网络代码来确定连接是否仍然有效。

但是，每次借用连接时都运行它仍然很浪费，因此您可能希望使用后台线程检查池中连接并静默丢弃死连接的工具。这更有效，但意味着如果连接*确实*死了，在后台线程运行其检查之前使用它们的任何尝试都将失败。

有关如何配置背景检查的信息，请参阅[wiki 文档](http://community.jboss.org/wiki/configdatasources)`background-validation-millis`（查找）。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-24T19:30:08.323

池中通常有一个配置选项，可以在借用时执行验证查询。如果验证查询成功执行，池将返回该连接。如果查询未成功执行，池将创建一个新连接。

[JBoss Wiki](http://community.jboss.org/wiki/ConfigDataSources)记录了池的各种属性。

```
<check-valid-connection-sql>select 1 from dual</check-valid-connection-sql> 
```

似乎它应该做的伎俩。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2014-06-20T16:56:08.957

没有足够的代表发表评论，所以它是一个答案的形式。`'Select 1 from dual'`和 skaffman 的方法`org.jboss.resource.adapter.jdbc.vendor.OracleValidConnectionChecker`是等价的，尽管连接检查确实提供了一个抽象级别。我们必须反编译 oracle jdbc 驱动程序以进行故障排除练习，Oracle 的 ping 内部实现是执行`'Select 'x' from dual'`. 纳奇。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-06-22T22:04:29.480

JBoss 提供 2 种验证连接的方法： - 基于 Ping 和 - 基于查询

您可以根据需要使用。这是由单独的线程根据数据源配置文件中定义的持续时间安排的。

```
<background-validation>true</background-validation> <background-validation-minutes>1</background-validation-minutes> 
```

有时，如果您在 Jboss 上没有正确的 oracle 驱动程序，您可能会收到类转换或相关错误，并且该连接可能会开始从连接池中丢失。`org.jboss.resource.adapter.jdbc.ValidConnectionChecker`您可以尝试通过实现接口来创建自己的 ConnectionValidator 类。此接口仅提供单一方法“ `isValidConnection()`”，并期望“NULL”作为有效连接的回报。

前任：

```
public class OracleValidConnectionChecker implements ValidConnectionChecker, Serializable {

   private Method ping;

   // The timeout (apparently the timeout is ignored?)
   private static Object[] params = new Object[] { new Integer(5000) };

   public SQLException isValidConnection(Connection c) {

       try {
           Integer status = (Integer) ping.invoke(c, params);

           if (status.intValue() < 0) {
               return new SQLException("pingDatabase failed status=" + status);
           }

       }
       catch (Exception e) {
           log.warn("Unexpected error in pingDatabase", e);
       }

       // OK
       return null;
   }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-12-08T15:24:44.080

@skaffman 的回答有一点更新。在 JBoss 7 中，您必须在设置有效连接检查器时使用“类名”属性，并且包也不同：

`<valid-connection-checker class-name="org.jboss.jca.adapters.jdbc.extensions.oracle.OracleValidConnectionChecker" />`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-09-29T12:38:34.670

我们最近遇到了一些浮动请求处理失败，原因是孤立的 oracle`DBMS_LOCK`会话锁无限期地保留在客户端连接池中。

因此，这是一个强制会话在 30 分钟内到期但不影响应用程序运行的解决方案：

```
<check-valid-connection-sql>select case when 30/60/24 > sysdate-LOGON_TIME then 1 else 1/0 end 
from V$SESSION where AUDSID = userenv('SESSIONID')</check-valid-connection-sql> 
```

这可能涉及从池中获取连接的过程中的一些减慢。确保在负载下进行测试。

# php - PHP 异步 Web 服务

> ID：128537
> 
> 赞同：4
> 
> 时间：2008-09-24T17:31:23.100
> 
> 标签：php, web-services, asynchronous

如何使用 ? 对 Web 服务进行异步调用`PHP SOAP Extension`？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T17:59:47.243

我的直接答案应该是：你不能。
PHP 不具备可在“用户空间”中使用的线程能力。

现在，如果你真的想这样做，有一些方法可以绕过它：

1.  使用 exec 函数在后台生成另一个进程，并通过数据库/文件系统或其他方式对其进行监视。
2.  使用 fork 函数生成另一个进程并通过数据库/文件系统或其他方式对其进行监视。

这两种方法的缺点是您可以使其异步，但如果您想要回调，那么它将非常棘手，而且一点也不简单。好吧，它甚至不会是回调，因为您将无法在进行异步调用的脚本上等待它。这意味着您只能拥有某种监控方案。我建议使用 AJAX。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-10-03T04:40:58.887

您需要编写一个在客户端断开连接后继续处理的 SoapServer 类。[本文](http://quickshiftin.com/blog/2011/04/non-blocking-web-service-processing-in-php/)将为您提供一个起点，但您必须在 SoapServer 类中封装类似的内容。

它看起来大致像这样（注意：我没有在 SoapServer 内部测试过这个，但这给了你一个想法）

```
class NonBlockingSoapServer extends SoapServer
{
    public function handle()
    {
        // this script can run forever
        set_time_limit(0);

        // tell the client the request has finished processing
        header('Location: index.php');  // redirect (optional)
        header('Status: 200');          // status code
        header('Connection: close');    // disconnect

        // clear ob stack 
        @ob_end_clean();

        // continue processing once client disconnects
        ignore_user_abort();

        ob_start();
        /* ------------------------------------------*/
        /* this is where regular request code goes.. */
        $result = parent::handle();
        /* end where regular request code runs..     */
        /* ------------------------------------------*/
        $iSize = ob_get_length();
        header("Content-Length: $iSize");

        // if the session needs to be closed, persist it
        // before closing the connection to avoid race
        // conditions in the case of a redirect above
        session_write_close();

        // send the response payload to the client
        @ob_end_flush();
        flush();

        /* ------------------------------------------*/
        /* code here runs after the client diconnect */
        /* YOUR ASYNC CODE HERE ......               */

        return $result;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-12T11:07:36.807

如果您使用 curl，它有一组“多”调用以允许并行调用多个服务器......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-10T19:36:11.147

这可能会有所帮助，（并行远程过程调用）：[http ://en.dklab.ru/lib/Dklab_SoapClient/](http://en.dklab.ru/lib/Dklab_SoapClient/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-11-28T09:49:39.703

一种方法是使用`select()`CURL 的“multi”包提供的 ing 方法，通过扩展`SoapClient`类并实现您自己的`__doRequest`.

我发现的最小的工作示例可以下载[https://github.com/halonsecurity/sp-enduser/blob/master/inc/soap.php](https://github.com/halonsecurity/sp-enduser/blob/master/inc/soap.php)并使用如下

```
$client1 = new SoapClientAsync('some-systems-wsdl', $options);
$client2 = new SoapClientAsync('another-systems-wsdl', $options);
$client1->someFunction($arguments);
$client2->anotherFunction($arguments);
soap_dispatch();
$result1 = $client1->someFunction($arguments);
$result2 = $client1->anotherFunction($arguments); 
```

如此处所述[http://www.halon.se/blogs/making-phps-soap-client-asynchronous/](http://www.halon.se/blogs/making-phps-soap-client-asynchronous/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T22:36:14.023

使用 AJAX 类型调用在客户端而不是服务器端进行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T18:14:03.870

如果您有能力在 Linux 中执行命令行 php 调用，则可以执行[pnctl_fork](http://www.php.net/manual/en/function.pcntl-fork.php)命令并从分叉的子进程调用 Web 服务。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T23:52:03.327

试试他们在我的问题中给我的方法： [异步 PHP 调用？](https://stackoverflow.com/questions/124462/asynchronous-php-calls)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-02T09:07:31.503

我不知道为什么古斯塔沃被改装了，因为他的答案是正确的。

我使用 exec 来运行一个用 PHP 编写的与 google API 联系的 shell 脚本。我这样启动脚本：

run.php 参数1=1 参数2=2 &> ajax.txt

运行的最后一行是

回声“完成”

然后我的 ajax 不断轮询 'ajax.txt' 直到它发现进程已经完成。

哈克，但简单（亲吻）

和尚男孩

# entity-framework - SQL Anywhere 11 (Sybase) 与 Visual Studio SP1 中的实体框架？

> ID：128543
> 
> 赞同：2
> 
> 时间：2008-09-24T17:32:00.633
> 
> 标签：entity-framework, .net-3.5, sqlanywhere

好吧，这个问题几乎就在标题中。我刚刚安装了 Visual Studio SP1，现在当我想从数据库中导入实体模型时，它不再显示 SQL Anywhere 提供程序。

有谁知道是否有补丁或某种方法可以使其与 SP1 一起使用？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-28T09:37:49.870

[ASP.NET 团队博客](http://blogs.msdn.com/adonet/archive/2008/08/11/third-party-provider-support-for-the-entity-framework-rtm.aspx)上有一篇文章说它将在 2008 年第三季度至第四季度推出。所​​以我猜 SP1 确实需要新版本的 SQL Anywhere 组件。

您是否尝试重新安装集成组件以防万一？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-11T23:33:09.213

尝试安装最新版本的 SA。并且您需要在 SP1 之后安装它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-10T10:43:26.183

我遇到了同样的问题并做了以下事情：

1.  控制面板 -> 卸载程序
2.  选定的 SQL Anywhere 12 - 客户端单击修复。这使我无法从 Sybase Central 连接到任何数据库，并显示有关 JDBC 的错误消息。
3.  选择 SQL Anywhere 12 并单击修复。

之后，提供程序出现在 Visual Studio 中，我能够创建一个新连接来创建一个实体框架模型。

# sql - 在 ClearQuest 中，我如何在 SQL 编辑器中生成一个允许我提示用户输入值的查询？

> ID：128555
> 
> 赞同：2
> 
> 时间：2008-09-24T17:33:38.977
> 
> 标签：sql, clearquest

我使用查询向导生成一个 ClearQuest 查询。在查询编辑器中，我可以为给定字段选择过滤器。但是，我想使用 SQL 编辑器细化查询，但是我失去了拥有动态过滤器的能力。我该如何解决这个问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T04:00:15.180

很确定答案是“你不能”，因为生成的 SQL 包括为构建查询时设置的任何动态过滤器输入的值，正如你所说，编辑 SQL 的行为会阻止使用查询编辑器进行进一步变化。

最好的办法是找出一种方法来使用查询编辑器来完成您需要 SQL 编辑器的工作。开始另一个问题。

# c# - 有没有办法在工具箱中对我的自定义控件进行分类？

> ID：128558
> 
> 赞同：0
> 
> 时间：2008-09-24T17:34:27.273
> 
> 标签：c#, asp.net, custom-server-controls

我已经在类库中构建了许多 asp.net 服务器控件，并且我希望当我团队的其他成员引用我的 dll 时，它们以某种方式分组。那可能吗？如何？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-24T17:41:16.070

[这里](http://blogs.msdn.com/chetanc/archive/2006/01/19/515016.aspx)有一个博客讨论如何将控件添加到 Visual Studio 2005 工具箱 - 包括创建选项卡以对控件进行分组。

我制作了一个可以在自定义操作中使用的版本，如果您想了解更多详细信息，请告诉我。

# php - 什么时候使用 PHP 常量“PHP_EOL”？

> ID：128560
> 
> 赞同：395
> 
> 时间：2008-09-24T17:34:39.067
> 
> 标签：php, eol

什么时候使用是个好主意[`PHP_EOL`](http://us3.php.net/manual/en/reserved.constants.php)？

我有时会在 PHP 的代码示例中看到这一点。这是否处理 DOS/Mac/Unix 端行问题？

* * *

## 回答 #1

> 赞同：390
> 
> 时间：2008-09-24T17:35:53.433

是的，`PHP_EOL`表面上用于以跨平台兼容的方式查找换行符，因此它可以处理 DOS/Unix 问题。

注意[PHP_EOL](http://php.net/manual/en/reserved.constants.php)代表*当前*系统的结束符。例如，在类 Unix 系统上执行时，它不会找到 Windows 结束行。

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2011-07-12T15:15:55.800

从`main/php.h`PHP 版本 7.1.1 和版本 5.6.30 开始：

```
#ifdef PHP_WIN32
#   include "tsrm_win32.h"
#   include "win95nt.h"
#   ifdef PHP_EXPORTS
#       define PHPAPI __declspec(dllexport)
#   else
#       define PHPAPI __declspec(dllimport)
#   endif
#   define PHP_DIR_SEPARATOR '\\'
#   define PHP_EOL "\r\n"
#else
#   if defined(__GNUC__) && __GNUC__ >= 4
#       define PHPAPI __attribute__ ((visibility("default")))
#   else
#       define PHPAPI
#   endif
#   define THREAD_LS
#   define PHP_DIR_SEPARATOR '/'
#   define PHP_EOL "\n"
#endif 
```

如您所见`PHP_EOL`，可以是`"\r\n"`（在 Windows 服务器上）或`"\n"`（在其他任何东西上）。**在 5.4.0RC8之前**的PHP 版本中，可能有第三个值`PHP_EOL`：（`"\r"`在 MacOSX 服务器上）。这是错误的，已在 2012-03-01 修复，[错误为 61193](https://bugs.php.net/bug.php?id=61193)。

正如其他人已经告诉您的那样，您可以在需要统一[换行符](http://en.wikipedia.org/wiki/End_of_line)`PHP_EOL`的任何类型的输出中使用（其中**任何**这些值都是有效的 - 例如：HTML、XML、日志......） 。请记住，确定值的是服务器，而不是客户端。您的 Windows 访问者会从您的 Unix 服务器获得价值，这有时对他们来说很不方便。

我只是想显示`PHP_EOL`由 PHP 源支持的可能值，因为它还没有在这里显示......

* * *

## 回答 #3

> 赞同：84
> 
> 时间：2008-09-24T19:35:52.957

当您`PHP_EOL`想要一条新线路并且想要跨平台时使用。

这可能是当您将文件写入文件系统（日志、导出等）时。

如果您希望生成的 HTML 可读，可以使用它。因此，您可以`<br />`使用`PHP_EOL`.

如果您将 php 作为 cron 脚本运行，并且需要输出一些内容并将其格式化为屏幕，则可以使用它。

如果您正在构建一封电子邮件以发送需要一些格式的电子邮件，则可以使用它。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2013-01-07T13:06:26.720

> PHP_EOL (string) 此平台的正确“行尾”符号。自 PHP 4.3.10 和 PHP 5.0.2 起可用

当您在服务器的文件系统上读取或写入文本文件时，您可以使用此常量。

在大多数情况下，行尾无关紧要，因为大多数软件都能够处理文本文件，无论其来源如何。您应该与您的代码保持一致。

如果行尾很重要，请明确指定行尾而不是使用常量。例如：

*   HTTP 标头*必须*由`\r\n`
*   CSV 文件*应用*作`\r\n`行分隔符

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2013-05-15T11:20:33.147

我想提出一个解决“何时*不*使用它”的答案，因为它尚未被涵盖，并且可以想象它被盲目使用，直到后来没有人注意到存在问题。其中一些与现有的一些答案有些矛盾。

如果以 HTML 格式输出到网页，尤其是 中的文本`<textarea>`，`<pre>`或者`<code>`您可能总是想使用`\n`而不是`PHP_EOL`.

这样做的原因是，虽然代码可能在一个服务器上运行良好 - 这恰好是一个类 Unix 平台 - 如果部署在 Windows 主机（如 Windows Azure 平台）上，那么它可能会改变页面在某些浏览器中的显示方式（特别是 Internet Explorer - 某些版本会同时看到 \n 和 \r）。

我不确定自 IE6 以来这是否仍然是一个问题，所以它可能相当有争议，但如果它有助于人们提示考虑上下文，似乎值得一提。可能还有其他情况（例如严格的 XHTML）`\r`在某些平台上突然输出 ' 可能会导致输出出现问题，我相信还有其他类似的边缘情况。

正如有人已经指出的那样，在返回 HTTP 标头时您不希望使用它 - 因为它们应该始终遵循任何平台上的 RFC。

我不会将它用于 CSV 文件的分隔符（正如有人建议的那样）。运行服务器的平台不应确定生成或使用文件中的行结尾。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2015-08-23T11:35:08.103

不，PHP_EOL 不处理 endline 问题，因为您使用该常量的系统与您将输出发送到的系统不同。

我根本不建议使用 PHP_EOL。Unix/Linux 使用 \n，MacOS / OS X 也从 \r 更改为 \n，在 Windows 上，许多应用程序（尤其是浏览器）也可以正确显示它。在 Windows 上，将现有的客户端代码更改为仅使用 \n 并且仍然保持向后兼容性也很容易：只需将行修剪的分隔符从 \r\n 更改为 \n 并将其包装在类似 trim() 的函数中.

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2010-10-04T07:59:53.720

我发现 PHP_EOL 对于文件处理非常有用，特别是当您将多行内容写入文件时。

例如，您有一个长字符串，您想在写入纯文件时将其分成多行。使用 \r\n 可能不起作用，因此只需将 PHP_EOL 放入您的脚本中，结果就很棒。

看看下面这个简单的例子：

```
<?php

$output = 'This is line 1' . PHP_EOL .
          'This is line 2' . PHP_EOL .
          'This is line 3';

$file = "filename.txt";

if (is_writable($file)) {
    // In our example we're opening $file in append mode.
    // The file pointer is at the bottom of the file hence
    // that's where $output will go when we fwrite() it.
    if (!$handle = fopen($file, 'a')) {
         echo "Cannot open file ($file)";
         exit;
    }
    // Write $output to our opened file.
    if (fwrite($handle, $output) === FALSE) {
        echo "Cannot write to file ($file)";
        exit;
    }
    echo "Success, content ($output) wrote to file ($file)";
    fclose($handle);
} else {
    echo "The file $file is not writable";
}
?> 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-04-21T22:06:16.043

PHP_EOL 的定义是它为您提供正在使用的操作系统的换行符。

在实践中，你几乎不需要这个。考虑几个案例：

*   当您输出到网络时，除了您应该保持一致之外，实际上没有任何约定。由于大多数服务器都是 Unixy，所以无论如何您都需要使用“\n”。

*   如果要输出到文件，PHP_EOL 似乎是个好主意。但是，您可以通过在文件中添加文字换行符来获得类似的效果，如果您尝试在 Unix 上运行一些 CRLF 格式的文件而不破坏现有的换行符（作为具有双引导系统的人），这将帮助您，我可以说我更喜欢后一种行为）

PHP_EOL 太长了，真的不值得使用它。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-02-09T11:03:15.283

有一个明显的地方它可能有用：当您编写主要使用单引号字符串的代码时。关于是否：

```
echo 'A $variable_literal that I have'.PHP_EOL.'looks better than'.PHP_EOL;  
echo 'this other $one'."\n"; 
```

它的艺术是一致的。混合匹配 '' 和 "" 的问题在于，当你得到长字符串时，你真的不想去寻找你使用的引用类型。

与生活中的所有事物一样，这取决于上下文。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-09-08T15:01:38.193

我在必须编写的一些命令行脚本中使用 PHP_EOL 常量。我在本地 Windows 机器上开发，然后在 Linux 服务器上进行测试。使用常量意味着我不必担心为每个不同的平台使用正确的行尾。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2011-01-14T17:15:44.183

DOS/Windows 标准“换行符”是 CRLF (= \r\n) 而不是 LFCR (\n\r)。如果我们把后者放在后面，它可能会产生一些意想不到的（嗯，事实上，有点预期！:D）行为。

如今，几乎所有（编写良好的）程序都接受 UNIX 标准 LF (\n) 作为换行代码，甚至是邮件发送者守护进程（RFC 将 CRLF 设置为标题和消息正文的*换行）。*

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-06-22T12:25:22.853

如果您要输出多行，则使用 error_log() 很方便。

我发现很多调试语句在我的 Windows 安装中看起来很奇怪，因为开发人员在分解字符串时假设了 unix 结尾。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-07-18T08:16:43.610

我有一个站点，在用户执行操作后，日志记录脚本将新行文本写入文本文件，用户可以使用任何操作系统。

在这种情况下，使用 PHP_EOL 似乎不是最佳选择。如果用户在 Mac OS 上并写入文本文件，它将放置 \n。在 Windows 计算机上打开文本文件时，它不显示换行符。出于这个原因，我使用“\r\n”代替它在任何操作系统上打开文件时都有效。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-11-06T18:24:40.193

我正在使用 WebCalendar 并发现 Mac iCal barfs 在导入生成的 ics 文件时因为行尾在 xcal.php 中被硬编码为“\r\n”。我进去并用 PHP_EOL 替换了所有出现的地方，现在 iCal 很高兴！我还在 Vista 上对其进行了测试，Outlook 也能够导入文件，即使行尾字符是“\n”。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-03-13T11:54:22.807

您正在编写主要使用单引号字符串的代码。

```
echo 'A $variable_literal that I have'.PHP_EOL.'looks better than'.PHP_EOL;  
echo 'this other $one'."\n"; 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-11-05T04:44:48.703

我刚刚在输出到 Windows 客户端时遇到了这个问题。当然，PHP_EOL 用于服务器端，但 php 的大多数内容输出是用于 Windows 客户端的。所以我必须把我的发现放在这里给下一个人。

A）回声“我的文字”。PHP_EOL；// 不好，因为这只是输出 \n 并且大多数版本的 windows 记事本将其显示在一行上，并且大多数 windows 会计软件无法导入这种类型的行尾字符。

B) 回显“我的文本\r\n”；//不好，因为单引号 php 字符串不解释 \r\n

C）回显“我的文本\r\n”；// 是的，它有效！在记事本中看起来正确，并且在将文件导入其他 Windows 软件（如 Windows 会计和 Windows 制造软件）时工作。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-05-18T02:20:20.657

当 jumi（PHP 的 joomla 插件）出于某种原因编译您的代码时，它会从您的代码中删除所有反斜杠。这样的东西`$csv_output .= "\n";`变成`$csv_output .= "n";`

很烦人的bug！

改用 PHP_EOL 来获得你想要的结果。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-03-10T09:16:38.083

在某些系统上使用此常量可能很有用，因为例如，如果您正在发送电子邮件，您可以使用 PHP_EOL 让跨系统脚本在更多系统上工作......但即使它有时很有用，您也可以找到这个恒定的未定义，具有最新 php 引擎的现代主机没有这个问题，但我认为编写一些代码来保存这种情况是一件好事：

```
<?php
  if (!defined('PHP_EOL')) {
    if (strtoupper(substr(PHP_OS,0,3) == 'WIN')) {
      define('PHP_EOL',"\r\n");
    } elseif (strtoupper(substr(PHP_OS,0,3) == 'MAC')) {
      define('PHP_EOL',"\r");
    } elseif (strtoupper(substr(PHP_OS,0,3) == 'DAR')) {
      define('PHP_EOL',"\n");
    } else {
      define('PHP_EOL',"\n");
    }
  }
?> 
```

所以你可以毫无问题地使用 PHP_EOL... 很明显 PHP_EOL 应该用在应该同时在更多系统上工作的脚本上，否则你可以使用 \n 或 \r 或 \r\n ...

注意：PHP_EOL 可以

```
1) on Unix    LN    == \n
2) on Mac     CR    == \r
3) on Windows CR+LN == \r\n 
```

希望这个答案有所帮助。

* * *

## 回答 #19

> 赞同：-2
> 
> 时间：2009-12-11T01:17:31.637

我更喜欢使用\n\r。此外，我在 Windows 系统上，\n 根据我的经验工作得很好。

由于 PHP_EOL 不适用于正则表达式，而这些是处理文本最有用的方法，所以我真的从未使用过或不需要使用它。

# c# - 从 C# 注册一个自定义的 win32 窗口类

> ID：128561
> 
> 赞同：14
> 
> 时间：2008-09-24T17:35:00.253
> 
> 标签：c#, windows, winapi, interop

我有一个用 WPF 编写的新应用程序，它需要支持一个旧 API，允许它接收已发布到隐藏窗口的消息。通常，另一个应用程序使用 FindWindow 来使用其自定义窗口类的名称来识别隐藏窗口。

**1）我假设要实现一个自定义窗口类，我需要使用老式的 win32 调用？**

我的旧 c++ 应用程序使用 RegisterClass 和 CreateWindow 来制作最简单的隐形窗口。

我相信我应该能够在 c# 中做同样的事情。我不希望我的项目必须编译任何非托管代码。

我尝试从 System.Windows.Interop.HwndHost 继承并使用 System.Runtime.InteropServices.DllImport 来引入上述 API 方法。

这样做我可以成功地在 WPF 中托管一个标准的 win32 窗口，例如“列表框”。但是，当我为自定义窗口调用 CreateWindowEx 时，它总是返回 null。

我对 RegisterClass 的调用成功，但我不确定应该将 WNDCLASS.lpfnWndProc 成员设置为什么。

**2）有谁知道如何成功地做到这一点？**

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-26T09:30:44.033

为了记录，我终于得到了这个工作。原来我遇到的困难归结为字符串编组问题。我必须更精确地导入 win32 函数。

下面是在 c# 中创建自定义窗口类的代码 - 对于支持您可能拥有的依赖自定义窗口类的旧 API 很有用。

只要消息泵在线程上运行，它就应该在 WPF 或 Winforms 中工作。

编辑：更新以修复由于包装回调的委托的早期收集而报告的崩溃。委托现在作为成员持有，并且委托显式编组为函数指针。这解决了问题，并更容易理解行为。

```
class CustomWindow : IDisposable
{
    delegate IntPtr WndProc(IntPtr hWnd, uint msg, IntPtr wParam, IntPtr lParam);

    [System.Runtime.InteropServices.StructLayout(
        System.Runtime.InteropServices.LayoutKind.Sequential,
       CharSet = System.Runtime.InteropServices.CharSet.Unicode
    )]
    struct WNDCLASS
    {
        public uint style;
        public IntPtr lpfnWndProc;
        public int cbClsExtra;
        public int cbWndExtra;
        public IntPtr hInstance;
        public IntPtr hIcon;
        public IntPtr hCursor;
        public IntPtr hbrBackground;
        [System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServices.UnmanagedType.LPWStr)]
        public string lpszMenuName;
        [System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServices.UnmanagedType.LPWStr)]
        public string lpszClassName;
    }

    [System.Runtime.InteropServices.DllImport("user32.dll", SetLastError = true)]
    static extern System.UInt16 RegisterClassW(
        [System.Runtime.InteropServices.In] ref WNDCLASS lpWndClass
    );

    [System.Runtime.InteropServices.DllImport("user32.dll", SetLastError = true)]
    static extern IntPtr CreateWindowExW(
       UInt32 dwExStyle,
       [System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServices.UnmanagedType.LPWStr)]
       string lpClassName,
       [System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServices.UnmanagedType.LPWStr)]
       string lpWindowName,
       UInt32 dwStyle,
       Int32 x,
       Int32 y,
       Int32 nWidth,
       Int32 nHeight,
       IntPtr hWndParent,
       IntPtr hMenu,
       IntPtr hInstance,
       IntPtr lpParam
    );

    [System.Runtime.InteropServices.DllImport("user32.dll", SetLastError = true)]
    static extern System.IntPtr DefWindowProcW(
        IntPtr hWnd, uint msg, IntPtr wParam, IntPtr lParam
    );

    [System.Runtime.InteropServices.DllImport("user32.dll", SetLastError = true)]
    static extern bool DestroyWindow(
        IntPtr hWnd
    );

    private const int ERROR_CLASS_ALREADY_EXISTS = 1410;

    private bool m_disposed;
    private IntPtr m_hwnd;

    public void Dispose() 
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    private void Dispose(bool disposing) 
    {
        if (!m_disposed) {
            if (disposing) {
                // Dispose managed resources
            }

            // Dispose unmanaged resources
            if (m_hwnd != IntPtr.Zero) {
                DestroyWindow(m_hwnd);
                m_hwnd = IntPtr.Zero;
            }

        }
    }

    public CustomWindow(string class_name){

        if (class_name == null) throw new System.Exception("class_name is null");
        if (class_name == String.Empty) throw new System.Exception("class_name is empty");

        m_wnd_proc_delegate = CustomWndProc;

        // Create WNDCLASS
        WNDCLASS wind_class = new WNDCLASS();
        wind_class.lpszClassName = class_name;
        wind_class.lpfnWndProc = System.Runtime.InteropServices.Marshal.GetFunctionPointerForDelegate(m_wnd_proc_delegate);

        UInt16 class_atom = RegisterClassW(ref wind_class);

        int last_error = System.Runtime.InteropServices.Marshal.GetLastWin32Error();

        if (class_atom == 0 && last_error != ERROR_CLASS_ALREADY_EXISTS) {
            throw new System.Exception("Could not register window class");
        }

        // Create window
        m_hwnd = CreateWindowExW(
            0,
            class_name,
            String.Empty,
            0,
            0,
            0,
            0,
            0,
            IntPtr.Zero,
            IntPtr.Zero,
            IntPtr.Zero,
            IntPtr.Zero
        );
    }

    private static IntPtr CustomWndProc(IntPtr hWnd, uint msg, IntPtr wParam, IntPtr lParam) 
    {
        return DefWindowProcW(hWnd, msg, wParam, lParam);
    }

    private WndProc m_wnd_proc_delegate;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-08-05T11:21:43.787

我想评论morechilli的答案：

```
public CustomWindow(string class_name){

    if (class_name == null) throw new System.Exception("class_name is null");
    if (class_name == String.Empty) throw new System.Exception("class_name is empty");

    // Create WNDCLASS
    WNDCLASS wind_class = new WNDCLASS();
    wind_class.lpszClassName = class_name;
    wind_class.lpfnWndProc = CustomWndProc;

    UInt16 class_atom = RegisterClassW(ref wind_class);

    int last_error = System.Runtime.InteropServices.Marshal.GetLastWin32Error();

    if (class_atom == 0 && last_error != ERROR_CLASS_ALREADY_EXISTS) {
        throw new System.Exception("Could not register window class");
    }

    // Create window
    m_hwnd = CreateWindowExW(
        0,
        class_name,
        String.Empty,
        0,
        0,
        0,
        0,
        0,
        IntPtr.Zero,
        IntPtr.Zero,
        IntPtr.Zero,
        IntPtr.Zero
    );
} 
```

在我上面复制的构造函数中，有一个小错误：创建了 WNDCLASS 实例，但没有保存。它最终将被垃圾收集。但是 WNDCLASS 拥有 WndProc 委托。一旦 WNDCLASS 被垃圾回收，这就会导致错误。WNDCLASS 的实例应该保存在一个成员变量中，直到窗口被销毁。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T17:45:08.683

**1）**你可以只继承一个普通的Windows Forms类......不需要所有那些win32调用，你只需要手动解析WndProc消息......就是全部。

**2）**您可以导入 System.Windows.Forms 命名空间并将其与 WPF 一起使用，我相信只要您不将过多的 windows 窗体交织到您的 WPF 应用程序中，我相信不会有任何问题。您只想实例化您的自定义隐藏表单以接收消息，对吗？

WndProc 子类化的示例：

```
protected override void WndProc(ref System.Windows.Forms.Message m)
{
   // *always* let the base class process the message
   base.WndProc(ref m);

   const int WM_NCHITTEST = 0x84;
   const int HTCAPTION = 2;
   const int HTCLIENT = 1;

   // if Windows is querying where the mouse is and the base form class said
   // it's on the client area, let's cheat and say it's on the title bar instead
   if ( m.Msg == WM_NCHITTEST && m.Result.ToInt32() == HTCLIENT )
      m.Result = new IntPtr(HTCAPTION);
} 
```

既然你已经知道 RegisterClass 和所有那些 Win32 调用，我认为 WndProc 消息对你来说不会是一个问题......

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2013-01-04T18:39:55.067

WNDCLASS 风类；将定义放在类中，而不是函数中，崩溃将得到修复。

# asp.net - 在 .net 3.5 解决方案中发布到 web 服务

> ID：128570
> 
> 赞同：2
> 
> 时间：2008-09-24T17:36:41.417
> 
> 标签：asp.net, web-services, post, ektron

我在这里束手无策。我正在尝试使用 asp.net ajax 扩展工具包中的自动完成扩展器，该工具包由沼泽标准 Web 服务填充。该应用程序是一个 .net 3.5 网站，在子目录中托管 web 服务（真实的，而不是虚拟的）。

每当我尝试发布到 Web 服务时，我都会收到以下错误： **不允许使用 HTTP 动词 POST 访问路径“/Workarea/webservices/FindAdvisorNameService.asmx/FindAdvisorName”。**

使事情复杂化的是，我的一位同事取消了解决方案并且可以正常运行。

做了一些谷歌搜索后，似乎 URL 重写存在一些问题，所以我让他尝试使用我的 web.config - 他仍然没有问题，我仍然没有成功。

有人对可能发生的事情有任何想法，或者从哪里开始寻找？

更复杂的是，这是一个`<a href="http://www.ektron.com">Ektron CMS400.Net</a>`解决方案，但他安装了与我相同版本的 Ektron。该项目最近从 2.0 升级到 3.5 框架，但在他的机器上仍然是 3.5。

我检查了 IIS 映射，并且在 ASMX 文件上允许使用 GET、POST 和 DEBUG。

帮帮我Obi-Wan KeSObi，你是我唯一的希望！

编辑：哦，是的，更复杂的是，这是我拥有的全新机器，所以注册表中不太可能有那么多奇怪的东西等等。同事的机器几乎和新机器一样。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T19:20:00.997

好的，在同事的帮助下发现了问题。似乎 Ektron CMS 在 IIS 中添加了一个映射——它映射 * 到 aspnet_isapi.dll。这覆盖了所有其他映射。我删除了它，现在一切正常。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T18:38:21.643

你在重写 URL 吗？您需要从重写中排除您的 Web 服务。

# python - 在类方法上使用 property()

> ID：128573
> 
> 赞同：238
> 
> 时间：2008-09-24T17:37:11.447
> 
> 标签：python, oop

我有一个带有两个类方法（使用`classmethod()`函数）的类，用于获取和设置本质上是静态变量的内容。我尝试将`property()`函数与这些一起使用，但会导致错误。我能够在解释器中使用以下内容重现错误：

```
class Foo(object):
    _var = 5
    @classmethod
    def getvar(cls):
        return cls._var
    @classmethod
    def setvar(cls, value):
        cls._var = value
    var = property(getvar, setvar) 
```

我可以演示类方法，但它们不能用作属性：

```
>>> f = Foo()
>>> f.getvar()
5
>>> f.setvar(4)
>>> f.getvar()
4
>>> f.var
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
TypeError: 'classmethod' object is not callable
>>> f.var=5
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
TypeError: 'classmethod' object is not callable 
```

是否可以使用`property()`带有`@classmethod`装饰功能的功能？

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2009-11-26T00:58:17.720

### 蟒蛇> = 3.9

只需同时使用两个装饰器。看到[这个答案](https://stackoverflow.com/a/64738850/674039)。

### 蟒蛇 < 3.9

属性是在类上创建的，但会影响实例。因此，如果您想要一个类方法属性，请在元类上创建该属性。

```
>>> class foo(object):
...     _var = 5
...     class __metaclass__(type):  # Python 2 syntax for metaclasses
...         pass
...     @classmethod
...     def getvar(cls):
...         return cls._var
...     @classmethod
...     def setvar(cls, value):
...         cls._var = value
...     
>>> foo.__metaclass__.var = property(foo.getvar.im_func, foo.setvar.im_func)
>>> foo.var
5
>>> foo.var = 3
>>> foo.var
3 
```

但是由于您无论如何都在使用元类，因此如果您将类方法移到那里，它会更好地阅读。

```
>>> class foo(object):
...     _var = 5
...     class __metaclass__(type):  # Python 2 syntax for metaclasses
...         @property
...         def var(cls):
...             return cls._var
...         @var.setter
...         def var(cls, value):
...             cls._var = value
... 
>>> foo.var
5
>>> foo.var = 3
>>> foo.var
3 
```

或者，使用 Python 3 的`metaclass=...`语法，以及在`foo`类主体之外定义的元类，以及负责设置初始值的元类`_var`：

```
>>> class foo_meta(type):
...     def __init__(cls, *args, **kwargs):
...         cls._var = 5
...     @property
...     def var(cls):
...         return cls._var
...     @var.setter
...     def var(cls, value):
...         cls._var = value
...
>>> class foo(metaclass=foo_meta):
...     pass
...
>>> foo.var
5
>>> foo.var = 3
>>> foo.var
3 
```

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2020-11-08T13:53:10.150

**Python 3.9 2020 更新**

您可以一起使用它们：

```
class G:
    @classmethod
    @property
    def __doc__(cls):
        return f'A doc for {cls.__name__!r}' 
```

顺序很重要 - 由于描述符的交互方式，`@classmethod`必须放在首位。

见[https://docs.python.org/3.9/library/functions.html#classmethod](https://docs.python.org/3.9/library/functions.html#classmethod)

* * *

## 回答 #3

> 赞同：74
> 
> 时间：2009-09-05T14:12:14.037

阅读[Python 2.2 发行](http://www.python.org/download/releases/2.2/descrintro/#property)说明，我发现以下内容。

> 当属性作为类属性 (Cx) 而不是作为实例属性 (C().x) 访问时，不会调用 [属性] 的 get 方法。如果您想在用作类属性时覆盖属性的 __get__ 操作，您可以子类化属性 - 它本身就是一种新型类型 - 以扩展其 __get__ 方法，或者您可以通过创建一个新的从头开始定义描述符类型- 定义 __get__、__set__ 和 __delete__ 方法的样式类。

**注意：以下方法实际上不适用于 setter，仅适用于 getter。**

因此，我相信规定的解决方案是创建一个 ClassProperty 作为属性的子类。

```
class ClassProperty(property):
    def __get__(self, cls, owner):
        return self.fget.__get__(None, owner)()

class foo(object):
    _var=5
    def getvar(cls):
        return cls._var
    getvar=classmethod(getvar)
    def setvar(cls,value):
        cls._var=value
    setvar=classmethod(setvar)
    var=ClassProperty(getvar,setvar)

assert foo.getvar() == 5
foo.setvar(4)
assert foo.getvar() == 4
assert foo.var == 4
foo.var = 3
assert foo.var == 3 
```

但是，设置器实际上不起作用：

```
foo.var = 4
assert foo.var == foo._var # raises AssertionError 
```

`foo._var`没有改变，您只是用新值覆盖了该属性。

您还可以`ClassProperty`用作装饰器：

```
class foo(object):
    _var = 5

    @ClassProperty
    @classmethod
    def var(cls):
        return cls._var

    @var.setter
    @classmethod
    def var(cls, value):
        cls._var = value

assert foo.var == 5 
```

* * *

## 回答 #4

> 赞同：72
> 
> 时间：2012-11-29T11:32:12.063

我希望这个非常简单的只读`@classproperty`装饰器可以帮助寻找类属性的人。

```
class classproperty(object):

    def __init__(self, fget):
        self.fget = fget

    def __get__(self, owner_self, owner_cls):
        return self.fget(owner_cls)

class C(object):

    @classproperty
    def x(cls):
        return 1

assert C.x == 1
assert C().x == 1 
```

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2016-09-17T04:21:19.917

> # 是否可以将 property() 函数与 classmethod 修饰函数一起使用？

不。

然而，类方法只是一个类的绑定方法（部分函数），可以从该类的实例访问。

由于实例是类的函数，并且您可以从实例派生类，因此您可以从类属性中获得所需的任何行为`property`：

```
class Example(object):
    _class_property = None
    @property
    def class_property(self):
        return self._class_property
    @class_property.setter
    def class_property(self, value):
        type(self)._class_property = value
    @class_property.deleter
    def class_property(self):
        del type(self)._class_property 
```

此代码可用于测试 - 它应该通过而不会引发任何错误：

```
ex1 = Example()
ex2 = Example()
ex1.class_property = None
ex2.class_property = 'Example'
assert ex1.class_property is ex2.class_property
del ex2.class_property
assert not hasattr(ex1, 'class_property') 
```

请注意，我们根本不需要元类——无论如何，您也不能通过其类的实例直接访问元类。

## 写一个`@classproperty`装饰器

`classproperty`实际上，您可以通过子类化在几行代码中创建一个装饰器（它是在 C 中实现的，但您可以[在此处](https://docs.python.org/3/howto/descriptor.html#properties)`property`看到等效的 Python ）：

```
class classproperty(property):
    def __get__(self, obj, objtype=None):
        return super(classproperty, self).__get__(objtype)
    def __set__(self, obj, value):
        super(classproperty, self).__set__(type(obj), value)
    def __delete__(self, obj):
        super(classproperty, self).__delete__(type(obj)) 
```

然后将装饰器视为结合了属性的类方法：

```
class Foo(object):
    _bar = 5
    @classproperty
    def bar(cls):
        """this is the bar attribute - each subclass of Foo gets its own.
        Lookups should follow the method resolution order.
        """
        return cls._bar
    @bar.setter
    def bar(cls, value):
        cls._bar = value
    @bar.deleter
    def bar(cls):
        del cls._bar 
```

这段代码应该可以正常工作：

```
def main():
    f = Foo()
    print(f.bar)
    f.bar = 4
    print(f.bar)
    del f.bar
    try:
        f.bar
    except AttributeError:
        pass
    else:
        raise RuntimeError('f.bar must have worked - inconceivable!')
    help(f)  # includes the Foo.bar help.
    f.bar = 5

    class Bar(Foo):
        "a subclass of Foo, nothing more"
    help(Bar) # includes the Foo.bar help!
    b = Bar()
    b.bar = 'baz'
    print(b.bar) # prints baz
    del b.bar
    print(b.bar) # prints 5 - looked up from Foo!

if __name__ == '__main__':
    main() 
```

但我不确定这会是多么明智。一篇旧的邮件列表[文章](https://mail.python.org/pipermail/python-ideas/2011-January/008959.html)表明它不应该工作。

## 让属性在课堂上工作：

上面的缺点是“类属性”不能从类中访问，因为它只会覆盖类中的数据描述符`__dict__`。

但是，我们可以使用元类中定义的属性来覆盖它`__dict__`。例如：

```
class MetaWithFooClassProperty(type):
    @property
    def foo(cls):
        """The foo property is a function of the class -
        in this case, the trivial case of the identity function.
        """
        return cls 
```

然后元类的类实例可以有一个属性，该属性使用前面部分已经演示的原理访问类的属性：

```
class FooClassProperty(metaclass=MetaWithFooClassProperty):
    @property
    def foo(self):
        """access the class's property"""
        return type(self).foo 
```

现在我们看到了两个实例

```
>>> FooClassProperty().foo
<class '__main__.FooClassProperty'> 
```

和班级

```
>>> FooClassProperty.foo
<class '__main__.FooClassProperty'> 
```

可以访问类属性。

* * *

## 回答 #6

> 赞同：34
> 
> 时间：2017-11-16T16:07:26.770

# 蟒蛇3！

有关python >= 3.9 中更清洁方法的信息，请参阅[@Amit Portnoy 的答案](https://stackoverflow.com/a/64738850/1446048)

* * *

老问题，很多观点，非常需要一种真正的 Python 3 方式。

幸运的是，使用`metaclass`kwarg 很容易：

```
class FooProperties(type):

    @property
    def var(cls):
        return cls._var

class Foo(object, metaclass=FooProperties):
    _var = 'FOO!' 
```

然后，`>>> Foo.var`

> “喂！”

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2008-09-24T20:38:47.877

没有合理的方法可以使这个“类属性”系统在 Python 中工作。

这是使其工作的一种不合理的方法。你当然可以通过越来越多的元类魔法让它变得更加无缝。

```
class ClassProperty(object):
    def __init__(self, getter, setter):
        self.getter = getter
        self.setter = setter
    def __get__(self, cls, owner):
        return getattr(cls, self.getter)()
    def __set__(self, cls, value):
        getattr(cls, self.setter)(value)

class MetaFoo(type):
    var = ClassProperty('getvar', 'setvar')

class Foo(object):
    __metaclass__ = MetaFoo
    _var = 5
    @classmethod
    def getvar(cls):
        print "Getting var =", cls._var
        return cls._var
    @classmethod
    def setvar(cls, value):
        print "Setting var =", value
        cls._var = value

x = Foo.var
print "Foo.var = ", x
Foo.var = 42
x = Foo.var
print "Foo.var = ", x 
```

问题的关键在于属性是 Python 所说的“描述符”。没有简单的方法来解释这种元编程是如何工作的，所以我必须向您指出[描述符 howto](http://users.rcn.com/python/download/Descriptor.htm)。

如果你正在实现一个相当高级的框架，你只需要了解这类事情。就像一个透明的对象持久性或 RPC 系统，或一种特定领域的语言。

但是，在对先前答案的评论中，您说您

> 需要修改一个属性，以使类的所有实例都可以看到，并且在调用这些类方法的范围内没有对类的所有实例的引用。

在我看来，您真正想要的是[观察者](http://en.wikipedia.org/wiki/Observer_pattern)设计模式。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2010-03-30T10:07:36.133

如果您想通过实例化对象访问类属性，仅在元类上设置它没有帮助，在这种情况下，您还需要在对象上安装一个普通属性（它分派到类属性）。我认为以下内容更清楚：

```
#!/usr/bin/python

class classproperty(property):
    def __get__(self, obj, type_):
        return self.fget.__get__(None, type_)()

    def __set__(self, obj, value):
        cls = type(obj)
        return self.fset.__get__(None, cls)(value)

class A (object):

    _foo = 1

    @classproperty
    @classmethod
    def foo(cls):
        return cls._foo

    @foo.setter
    @classmethod
    def foo(cls, value):
        cls.foo = value

a = A()

print a.foo

b = A()

print b.foo

b.foo = 5

print a.foo

A.foo = 10

print b.foo

print A.foo 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-24T18:08:52.260

半个解决方案，类上的 __set__ 仍然不起作用。解决方案是实现属性和静态方法的自定义属性类

```
class ClassProperty(object):
    def __init__(self, fget, fset):
        self.fget = fget
        self.fset = fset

    def __get__(self, instance, owner):
        return self.fget()

    def __set__(self, instance, value):
        self.fset(value)

class Foo(object):
    _bar = 1
    def get_bar():
        print 'getting'
        return Foo._bar

    def set_bar(value):
        print 'setting'
        Foo._bar = value

    bar = ClassProperty(get_bar, set_bar)

f = Foo()
#__get__ works
f.bar
Foo.bar

f.bar = 2
Foo.bar = 3 #__set__ does not 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-24T20:47:07.980

> 因为我需要修改一个属性，以使类的所有实例都可以看到，并且在调用这些类方法的范围内没有对类的所有实例的引用。

您是否有权访问该类的至少一个实例？我可以想办法做到这一点：

```
class MyClass (object):
    __var = None

    def _set_var (self, value):
        type (self).__var = value

    def _get_var (self):
        return self.__var

    var = property (_get_var, _set_var)

a = MyClass ()
b = MyClass ()
a.var = "foo"
print b.var 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-24T21:28:15.137

试一试，它无需更改/添加大量现有代码即可完成工作。

```
>>> class foo(object):
...     _var = 5
...     def getvar(cls):
...         return cls._var
...     getvar = classmethod(getvar)
...     def setvar(cls, value):
...         cls._var = value
...     setvar = classmethod(setvar)
...     var = property(lambda self: self.getvar(), lambda self, val: self.setvar(val))
...
>>> f = foo()
>>> f.var
5
>>> f.var = 3
>>> f.var
3 
```

该`property`函数需要两个`callable`参数。给他们 lambda 包装器（它将实例作为第一个参数传递），一切都很好。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-06-28T20:28:49.777

这是一个解决方案，它既适用于通过类进行访问，也适用于通过使用元类的实例进行访问。

```
In [1]: class ClassPropertyMeta(type):
   ...:     @property
   ...:     def prop(cls):
   ...:         return cls._prop
   ...:     def __new__(cls, name, parents, dct):
   ...:         # This makes overriding __getattr__ and __setattr__ in the class impossible, but should be fixable
   ...:         dct['__getattr__'] = classmethod(lambda cls, attr: getattr(cls, attr))
   ...:         dct['__setattr__'] = classmethod(lambda cls, attr, val: setattr(cls, attr, val))
   ...:         return super(ClassPropertyMeta, cls).__new__(cls, name, parents, dct)
   ...:

In [2]: class ClassProperty(object):
   ...:     __metaclass__ = ClassPropertyMeta
   ...:     _prop = 42
   ...:     def __getattr__(self, attr):
   ...:         raise Exception('Never gets called')
   ...:

In [3]: ClassProperty.prop
Out[3]: 42

In [4]: ClassProperty.prop = 1
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-4-e2e8b423818a> in <module>()
----> 1 ClassProperty.prop = 1

AttributeError: can't set attribute

In [5]: cp = ClassProperty()

In [6]: cp.prop
Out[6]: 42

In [7]: cp.prop = 1
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-7-e8284a3ee950> in <module>()
----> 1 cp.prop = 1

<ipython-input-1-16b7c320d521> in <lambda>(cls, attr, val)
      6         # This makes overriding __getattr__ and __setattr__ in the class impossible, but should be fixable
      7         dct['__getattr__'] = classmethod(lambda cls, attr: getattr(cls, attr))
----> 8         dct['__setattr__'] = classmethod(lambda cls, attr, val: setattr(cls, attr, val))
      9         return super(ClassPropertyMeta, cls).__new__(cls, name, parents, dct)

AttributeError: can't set attribute 
```

这也适用于元类中定义的设置器。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2021-07-12T14:24:15.407

我找到了一个干净的解决方案来解决这个问题。它是一个名为**classutilities** ( `pip install classutilities`) 的包，请参阅[PyPi 上](https://pypi.org/project/classutilities/)的文档。

考虑示例：

```
import classutilities

class SomeClass(classutilities.ClassPropertiesMixin):
    _some_variable = 8  # Some encapsulated class variable

    @classutilities.classproperty
    def some_variable(cls):  # class property getter
        return cls._some_variable

    @some_variable.setter
    def some_variable(cls, value):  # class property setter
        cls._some_variable = value 
```

您可以在类级别和实例级别使用它：

```
# Getter on class level:
value = SomeClass.some_variable
print(value)  # >>> 8
# Getter on instance level
inst = SomeClass()
value = inst.some_variable
print(value)  # >>> 8

# Setter on class level:
new_value = 9
SomeClass.some_variable = new_value
print(SomeClass.some_variable)   # >>> 9
print(SomeClass._some_variable)  # >>> 9
# Setter on instance level
inst = SomeClass()
inst.some_variable = new_value
print(SomeClass.some_variable)   # >>> 9
print(SomeClass._some_variable)  # >>> 9
print(inst.some_variable)        # >>> 9
print(inst._some_variable)       # >>> 9 
```

如您所见，它在所有情况下都能正常工作。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-11-12T00:01:47.977

基于[https://stackoverflow.com/a/1800999/2290820](https://stackoverflow.com/a/1800999/2290820)

```
 class MetaProperty(type):

    def __init__(cls, *args, **kwargs):
        super()

    @property
    def praparty(cls):
        return cls._var

    @praparty.setter
    def praparty(cls, val):
        cls._var = val

class A(metaclass=MetaProperty):
    _var = 5

print(A.praparty)
A.praparty = 6
print(A.praparty) 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2021-12-10T23:35:58.447

对于 Python 3.9 之前的功能方法，您可以使用以下方法：

```
def classproperty(fget):
  return type(
      'classproperty',
      (),
      {'__get__': lambda self, _, cls: fget(cls), '__module__': None}
  )()

class Item:
  a = 47

  @classproperty
  def x(cls):
    return cls.a

Item.x 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-10-18T20:42:31.410

在搜索了不同的地方后，我找到了一种定义对 Python 2 和 3 有效的类属性的方法。

```
from future.utils import with_metaclass

class BuilderMetaClass(type):
    @property
    def load_namespaces(self):
        return (self.__sourcepath__)

class BuilderMixin(with_metaclass(BuilderMetaClass, object)):
    __sourcepath__ = 'sp'        

print(BuilderMixin.load_namespaces) 
```

希望这可以帮助某人:)

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2020-10-24T05:57:14.973

这是我的解决方案，它还缓存了类属性

```
class class_property(object):
    # this caches the result of the function call for fn with cls input
    # use this as a decorator on function methods that you want converted
    # into cached properties

    def __init__(self, fn):
        self._fn_name = fn.__name__
        if not isinstance(fn, (classmethod, staticmethod)):
            fn = classmethod(fn)
        self._fn = fn

    def __get__(self, obj, cls=None):
        if cls is None:
            cls = type(obj)
        if (
            self._fn_name in vars(cls) and
            type(vars(cls)[self._fn_name]).__name__ != "class_property"
        ):
            return vars(cls)[self._fn_name]
        else:
            value = self._fn.__get__(obj, cls)()
            setattr(cls, self._fn_name, value)
            return value 
```

* * *

## 回答 #18

> 赞同：-35
> 
> 时间：2008-09-24T17:45:17.497

这是我的建议。不要使用类方法。

严重地。

在这种情况下使用类方法的原因是什么？为什么没有普通类的普通对象？

* * *

如果您只是想更改值，那么属性并不是很有帮助，是吗？只需设置属性值并完成它。

只有在有东西要隐藏时才应该使用属性——在未来的实现中可能会改变的东西。

也许您的示例被简化了，并且您遗漏了一些地狱般的计算。但看起来该物业并没有增加显着的价值。

受 Java 影响的“隐私”技术（在 Python 中，以 _ 开头的属性名称）并不是很有帮助。从谁私下？当您拥有源代码时（就像在 Python 中所做的那样），私有的意义有点模糊。

受 Java 影响的 EJB 风格的 getter 和 setter（通常在 Python 中作为属性完成）用于促进 Java 的原始内省以及通过静态语言编译器的集合。所有这些 getter 和 setter 在 Python 中都没有那么有用。

# embedded - 如何定义自己的 errno 值？

> ID：128579
> 
> 赞同：0
> 
> 时间：2008-09-24T17:38:06.063
> 
> 标签：embedded, vxworks

在开发将在内核空间中运行的模块（设备驱动程序、中间件等）时，我们希望有一些方法来捕获操作可能失败的原因。

在 VxWorks 中，errno 机制似乎是一个很好的方法。

是否可以定义我自己的 errno 值？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T17:48:52.637

在 VxWorks 的上下文中，errno 被定义为两个 16 位：

*   高 16 位标识发生错误的“模块”。
*   低 16 位代表该模块的特定错误。

官方的 vxWorks 模块值（用于 errno）位于 ../h/vwModNum.h 文件中。他们目前正在使用几百个号码。这些模块号都有以下形式

```
#define M_something (nn << 16)

```

强烈**建议**不要修改这个（或任何）vxWorks 头文件。

您可以做的是创建自己的模块头文件并从足够大的数量开始，以免引起冲突。

```
/* myModNum.h */
#define M_MyModule (10000 << 16)
#define M_MyNextModule (10001 << 16)
...

```

在各个模块头文件中，创建各个 errno 值。

```
/* myModule.h */
#define S_MyModule_OutOfResources (M_MyModule | 1)
#define S_MyModule_InvalidHandle (M_MyModule | 2)
...

```

在您的代码中，您可以将 errno 设置为您定义的宏。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T17:46:12.127

Errno 只是一个数字，类似 strerror() 的函数会返回描述文本。如果你想扩展它，只需提供一个类似于 strerror() 的函数，它会查看你的错误列表或委托给 strerror()。

# javascript - 使用 jQuery $().find 解析带有命名空间的 XML

> ID：128580
> 
> 赞同：21
> 
> 时间：2008-09-24T17:38:36.467
> 
> 标签：javascript, jquery, xml, namespaces

我正在尝试获取 XML 文档元素的内容，但该元素的名称中有一个冒号。

此行适用于每个元素，但名称中带有冒号的元素除外：

```
$(this).find("geo:lat").text(); 
```

我认为冒号需要转义。我该如何解决？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-24T17:41:19.940

使用反斜杠，它本身应该被转义，这样 JavaScript 就不会吃掉它：

```
$(this).find("geo\\:lat").text(); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-24T17:47:48.287

这不仅仅是一个普通的元素名称。这是一个限定名称，这意味着它是一个专门引用命名空间中元素类型的名称。元素类型名称为“lat”，命名空间前缀为“geo”。

现在，jQuery 不能很好地处理命名空间，详情请参阅[bug 155](http://dev.jquery.com/ticket/155)。

现在，作为一种解决方法，您应该能够仅使用本地名称选择这些元素：

```
$(this).find("lat").text(); 
```

如果必须区分具有相同本地名称的元素类型，则可以使用`filter()`：

```
var NS = "http://example.com/whatever-the-namespace-is-for-geo";
$(this).find("lat").filter(function() { return this.namespaceURI == NS; }).text(); 
```

**编辑：**我的错误，我的印象是补丁已经登陆。使用 Adam 对选择器的建议，`filter()`如果您也需要命名空间：

```
var NS = "http://example.com/whatever-the-namespace-is-for-geo";
$(this).find("geo\\:lat").filter(function() { return this.namespaceURI == NS; }).text(); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-03-19T15:28:40.483

如果您有**chrome 或 webkit 没有选择它的 jquery 选择器问题，**请尝试

```
$(this).find('[nodeName=geo:lat]').text(); 
```

这种方式适用于所有浏览器

# parsing - 递归下降解析 - 从 LL(1) 向上

> ID：128584
> 
> 赞同：9
> 
> 时间：2008-09-24T17:39:16.217
> 
> 标签：parsing, compilation, recursive-descent

以下简单的“计算器表达式”文法（BNF）可以很容易地用一个简单的递归下降解析器来解析，它是预测性的 LL(1)：

```
<expr>      :=  <term> + <term>
            |   <term> - <term>
            |   <term>
<term>      :=  <factor> * <factor>
                <factor> / <factor>
                <factor>
<factor>    :=  <number>
            |   <id>
            |   ( <expr> )
<number>    :=  \d+
<id>        :=  [a-zA-Z_]\w+ 
```

因为看到下一个标记总是足以知道要选择的规则。但是，假设我添加了以下规则：

```
<command>   :=  <expr>
            |   <id> = <expr> 
```

为了在命令行上与计算器进行交互，使用变量，如下所示：

```
calc> 5+5
=> 10
calc> x = 8
calc> 6 * x + 1
=> 49 
```

我不能使用简单的 LL(1) 预测解析器来解析`<command>`规则，这是真的吗？我试图为它编写解析器，但似乎我需要知道更多的令牌。是使用回溯的解决方案，还是我可以只实现 LL(2) 并始终向前看两个令牌？

RD 解析器生成器如何处理这个问题（例如，ANTLR）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T17:58:02.943

问题

```
<command>   :=  <expr>
            |   <id> = <expr> 
```

是当您“看到”时，`<id>`您无法判断它是分配的开始（第二条规则）还是“ `<factor>`”。您只会知道何时阅读下一个令牌。

AFAIK ANTLR 是 LL(*) （如果我没记错的话，它也能够生成老鼠包解析器）所以它可能会同时考虑两个标记来处理这个语法。

如果您可以使用语法，我建议您为作业添加一个关键字（例如`let x = 8`）：

```
<command>   :=  <expr>
            |   "let" <id> "=" <expr> 
```

或使用`=`表示评估：

```
<command>   :=  "=" <expr>
            |   <id> "=" <expr> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-10-13T11:06:09.073

我认为使用递归下降解析器有两种方法可以解决这个问题：使用（更多）前瞻或回溯。

### 展望

```
command() {
    if (currentToken() == id && lookaheadToken() == '=') {
        return assignment();
    } else {
        return expr();
    }
} 
```

### 回溯

```
command() {
    savedLocation = scanLocation();
    if (accept( id )) {
         identifier = acceptedTokenValue();
         if (!accept( '=' )) {
             setScanLocation( savedLocation );
             return expr();
         }
         return new assignment( identifier, expr() );
    } else {
         return expr();
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T17:50:49.653

问题是语法：

```
 <command>   :=  <expr>
            |   <id> = <expr> 

```

不是一个相互递归的过程。对于递归体面的解析器，您将需要确定非递归等价物。

rdentato post's 展示了如何解决这个问题，假设你可以使用语法。这个 powerpoint 更详细地说明了这个问题并展示了如何纠正它： [http://www.google.com/url?sa=t&source=web&ct=res&cd=7&url=http%3A%2F%2Fxml.cs。 nccu.edu.tw%2Fcourses%2Fcompiler%2Fcp2006%2Fslides%2Flec3-Parsing%26TopDownParsing.ppt&ei=-YLaSPrWGaPwhAK5ydCqBQ&usg=AFQjCNGAFrODJxoxkgJEwDMQ8A8594vn0Q&sig2=nlYKQVfakmqy_57137x](http://www.google.com/url?sa=t&source=web&ct=res&cd=7&url=http%3A%2F%2Fxml.cs.nccu.edu.tw%2Fcourses%2Fcompiler%2Fcp2006%2Fslides%2Flec3-Parsing%26TopDownParsing.ppt&ei=-YLaSPrWGaPwhAK5ydCqBQ&usg=AFQjCNGAFrODJxoxkgJEwDMQ8A8594vn0Q&sig2=nlYKQVfakmqy_57137XzrQ)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T18:05:25.217

[ANTLR 3](http://www.artima.com/lejava/articles/antlr_3.html)使用“LL(*)”解析器而不是 LL(k) 解析器，因此如果必须使用特别优化的确定性有限自动机（ DFA)。

# sdlc - 你如何激励好的代码？

> ID：128586
> 
> 赞同：4
> 
> 时间：2008-09-24T17:39:23.423
> 
> 标签：sdlc

您是否有任何方法/系统来激励您的开发团队成员编写“好”代码并向他们的代码添加注释？我认识到“好”是一个主观术语，它与一个较早的问题有关，即[衡量代码的可维护性](https://stackoverflow.com/questions/127360/is-there-a-rating-system-for-the-maintainability-of-source-code)作为衡量好代码的一种方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T17:44:42.037

这很难，因为[奖励性薪酬被认为是有害](http://www.joelonsoftware.com/articles/fog0000000070.html)的。我最好的建议是选择几个必须同时实现的目标，而不是一个可以利用的目标。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T18:31:06.030

虽然大多数人回应说代码审查是确保高质量代码的好方法，而且理所当然，但在我看来，它们似乎不是实现目标的直接动力。然而，为好的代码提出积极的激励是很困难的，因为好的代码的概念有很大的范围属于意见领域，几乎任何系统都可以被博弈。

在我从事的所有工作中，优秀的开发人员都有编写优秀代码的内在动力。先有鸡还是先有蛋，反馈，抓到 22 条，随便你怎么称呼它，获得好代码的最好方法是雇佣有动力的开发人员。创造一个优秀的开发人员想要工作的环境可能是我能想到的最好的激励措施。我不确定哪个更难，创建环境或寻找开发人员。两者都不容易，但从长远来看，两者都是值得的。

我发现创建优秀开发人员想要工作的环境的一部分包括确保开发人员谈论代码的情况。我不认识一个熟练的程序员不欣赏对他的代码的良好批评。这有助于那些喜欢成为最好的人变得更好。作为这项工作的一个较小的子部分，因此是创建好代码的间接激励，我认为代码审查工作得很好。是的，您的代码质量也应该获得一些直接的好处。

我和同事用来传达良好编码习惯的另一种技术是对代码进行小组审查。它不那么正式，允许人们展示新技术、工具和功能。提出了批评，公开给予了赞誉，大多数开发人员似乎并不介意在他们认识每个人的小型开发人员小组面前发言。如果管理层看不到这方面的好处，那就去买小面包，称其为棕色袋子。开发人员也会喜欢免费食物。

我们还努力让人们参加编码活动。诚然，根据你们对这个主题的熟悉程度，你可能不会学到太多东西，但它会让人们思考代码一段时间，让人们在更轻松的环境中交谈。如果您在之后提供一两杯饮料，大多数开发人员也会出现。

Wait a second, I noticed another theme. Free food! Seriously though, the point is to create an environment where people that already write good code and those that are eager to learn want to work.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T17:43:09.623

代码审查做得好，可以产生巨大的影响。没有人愿意成为那个提出让每个人都流血的代码的人。

不幸的是，审查并不总是很好地扩大（太多厨师等）或缩小（我们太忙于编码而无法审查代码）。[值得庆幸的是，在 Stack Overflow 上](https://stackoverflow.com/questions/89163/how-to-conduct-a-successful-code-review)有一些提示。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T17:42:22.277

我认为正式的代码审查满足了这个目的。我知道我的团队中至少有两个其他开发人员将审查它，所以我更加小心不要提交看起来很糟糕的代码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T17:49:50.577

公开标准，**不要将激励措施与任何类型的自动化联系起来**。宣传您正在寻找的示例。善待并鼓励人们公开他们自己的坏例子（以及他们如何纠正这些例子）。

团队文化的一部分是什么是“好代码”；这对许多人来说是主观的，但是一个正常运作的团队应该有一个团队中每个人都同意的明确答案。任何不同意的人都会让团队失望。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T17:47:47.383

这是针对您的建议，而不是您的老板。

总是提醒自己一个事实，如果你加倍努力，写出尽可能好的代码，那么当你一周没有重构你的东西时，这将得到回报。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T17:49:28.110

我认为编写好代码的最佳动机是一起编写好代码。在项目的同一领域编写代码的人越多，代码约定、异常处理、注释、缩进和一般思维过程就越可能相互接近。

并不是所有的代码都是统一的，但是当人们一起编写大量代码时，维护通常会变得更容易，因为您可以掌握样式并作为一个团队提出最佳实践。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T17:52:44.000

我不认为钱是个好主意。原因是它是一种外在的动力。人们将开始遵守规则，因为这样做有经济上的激励，但这并不总是奏效。研究表明，随着人们年龄的增长，经济激励不再是激励因素。话虽如此，在这种情况下的工作质量只会等于您为获得奖励而设定的水平。这是一个短期的胜利，仅此而已。

激励人们做正确事情的真正方法是让他们相信他们的工作会变得更有价值。他们会在他们的工作和效率方面做得更好。激励人们的唯一真正方法是让他们愿意去做。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-24T17:59:39.867

你摆脱了那些不写好的代码的人。

我是认真的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-24T18:14:00.737

我同意比尔蜥蜴。但我想补充比尔不得不说的话......

可以做的事情（假设资源可用）是让其他一些开发人员（可能 1 个对您的工作有所了解，1 个对您的工作非常了解，也许 1 个对它知之甚少）一起走他们通过你的代码。您可以使用投影仪并将它们放在房间里，然后您可以完成所有更改。这样，您就有了一个混合的人群，可以提供输入、提出问题，最重要的是让您成为更好的开发人员。

不需要只有负面反馈；但是，它有时会发生。重要的是，将消极视为建设性的，并在提供反馈时尝试以建设性的方式表达您的反馈。

这里的想法是，如果您的函数有注释块，或者解释一些棘手的数学运算的注释块，或者解释为什么需要根据所选语言更改日期格式的简单注释行...那么您将不需要逐行指示该组您的代码在做什么。这是一种注释您所做更改的方法，它允许其他开发人员继续思考您在之前的函数中的模糊逻辑，因为他们可以阅读您的评论并查看您在其他地方做了什么。

这一切都来自真实的生活经历，我们在我的工作中继续使用这种方法。

希望这会有所帮助，好问题！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T17:43:26.580

嗯。

也许开发团队应该对彼此的代码进行代码审查。这可以激励他们编写更好的注释代码。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-24T17:47:18.053

代码质量可能就像色情 - 正如波特斯图尔特大法官的名言所说，“我一看到就知道了”

所以一种方法是向其他人询问代码质量。这样做的一些方法是......

他们的同行的代码审查（以及他们对其他代码的审查），易于理解是审查清单中的标准之一（我个人认为这并不一定意味着评论；有时没有它们，代码可以非常清晰）

要求在回顾会上提出由代码质量引起的问题（你确实举行回顾，对吧？）

跟踪他们的代码第一次更改的频率，或者是否需要多次尝试？

在 annuak（或其他）评审时间要求同行评审，并包括一个关于使用被评审者的代码有多容易的问题作为问题之一。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-24T17:47:24.950

激励时要非常小心：“得到衡量就会完成”。如果你奖励代码行，你会得到臃肿的代码。如果你奖励评论，你会得到不必要的评论。如果您奖励在代码中没有发现错误，您的开发人员将做他们自己的 QA 工作，而这些工作应该由收入较低的 QA 专家完成。与其对流程的某些部分进行激励，不如为整个团队或整个公司的成功提供奖金。

IMO，良好的代码审查流程是确保高代码质量的最佳方式。根据团队的不同，结对编程也可以作为传播良好实践的一种方式。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-24T17:58:16.500

最后一个破坏构建或交付代码并导致技术支持呼叫的人必须先泡茶，直到其他人下一个这样做。问题是这个人可能不会给予茶制作真正好的茶所需的关注。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-24T18:03:21.057

我通常不为我的团队提供金钱奖励，因为他们做的不多而且我们真的负担不起，但我通常会和每个团队成员坐下来，单独和他们一起检查代码，指出什么是有效的（ “好”代码）和什么不是（“坏”代码）。这似乎工作得很好，因为在我们开始这个过程之前，我得到的垃圾代码几乎没有。

# .net - 在 .Net winforms 应用程序中，如何获取当前用户的临时文件夹的路径？

> ID：128588
> 
> 赞同：4
> 
> 时间：2008-09-24T17:39:59.240
> 
> 标签：.net, winforms

看起来很基础，我不敢相信我不知道这个！我只需要一个临时文件夹来转储一些临时文件。我不在乎它是否在使用之间被清除，而且我认为我不应该经历创建一个并在我的应用程序中自己维护它的麻烦。那是过分的要求？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-24T17:41:15.917

使用[`System.IO.Path.GetTempPath()`](http://msdn.microsoft.com/en-us/library/system.io.path.gettemppath.aspx).

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T17:42:22.340

[Environment.GetFolderPath](https://docs.microsoft.com/en-us/dotnet/api/system.environment.getfolderpath?view=netframework-4.7.2#System_Environment_GetFolderPath_System_Environment_SpecialFolder_) ( [Environment.SpecialFolder.LocalApplicationData](https://docs.microsoft.com/en-us/dotnet/api/system.environment.specialfolder?view=netframework-4.7.2) ) 或`Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData)`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T17:43:55.473

这是针对 VB.NET

```
My.Computer.FileSystem.SpecialDirectories.Temp 
```

不确定C#中是否有类似的

# c# - 文件大小格式提供程序

> ID：128618
> 
> 赞同：72
> 
> 时间：2008-09-24T17:44:34.957
> 
> 标签：c#, formatting, filesize

有没有简单的方法来创建一个使用**IFormatProvider**的类来写出用户友好的文件大小？

```
public static string GetFileSizeString(string filePath)
{
    FileInfo info = new FileInfo(@"c:\windows\notepad.exe");
    long size = info.Length;
    string sizeString = size.ToString(FileSizeFormatProvider); // This is where the class does its magic...
} 
```

它应该产生格式为“ *2,5 MB* ”、“ *3,9 GB* ”、“ *670 字节*”等格式的字符串。

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-09-24T17:52:47.370

我用这个，我从网上得到的

```
public class FileSizeFormatProvider : IFormatProvider, ICustomFormatter
{
    public object GetFormat(Type formatType)
    {
        if (formatType == typeof(ICustomFormatter)) return this;
        return null;
    }

    private const string fileSizeFormat = "fs";
    private const Decimal OneKiloByte = 1024M;
    private const Decimal OneMegaByte = OneKiloByte * 1024M;
    private const Decimal OneGigaByte = OneMegaByte * 1024M;

    public string Format(string format, object arg, IFormatProvider formatProvider)
    {    
        if (format == null || !format.StartsWith(fileSizeFormat))    
        {    
            return defaultFormat(format, arg, formatProvider);    
        }

        if (arg is string)    
        {    
            return defaultFormat(format, arg, formatProvider);    
        }

        Decimal size;

        try    
        {    
            size = Convert.ToDecimal(arg);    
        }    
        catch (InvalidCastException)    
        {    
            return defaultFormat(format, arg, formatProvider);    
        }

        string suffix;
        if (size > OneGigaByte)
        {
            size /= OneGigaByte;
            suffix = "GB";
        }
        else if (size > OneMegaByte)
        {
            size /= OneMegaByte;
            suffix = "MB";
        }
        else if (size > OneKiloByte)
        {
            size /= OneKiloByte;
            suffix = "kB";
        }
        else
        {
            suffix = " B";
        }

        string precision = format.Substring(2);
        if (String.IsNullOrEmpty(precision)) precision = "2";
        return String.Format("{0:N" + precision + "}{1}", size, suffix);

    }

    private static string defaultFormat(string format, object arg, IFormatProvider formatProvider)
    {
        IFormattable formattableArg = arg as IFormattable;
        if (formattableArg != null)
        {
            return formattableArg.ToString(format, formatProvider);
        }
        return arg.ToString();
    }

} 
```

一个使用示例是：

```
Console.WriteLine(String.Format(new FileSizeFormatProvider(), "File size: {0:fs}", 100));
Console.WriteLine(String.Format(new FileSizeFormatProvider(), "File size: {0:fs}", 10000)); 
```

[http://flimflan.com/blog/FileSizeFormatProvider.aspx](http://flimflan.com/blog/FileSizeFormatProvider.aspx)的学分

ToString() 存在问题，它需要实现 IFormatProvider 的 NumberFormatInfo 类型，但 NumberFormatInfo 类是密封的:(

如果您使用的是 C# 3.0，则可以使用扩展方法来获得所需的结果：

```
public static class ExtensionMethods
{
    public static string ToFileSize(this long l)
    {
        return String.Format(new FileSizeFormatProvider(), "{0:fs}", l);
    }
} 
```

你可以像这样使用它。

```
long l = 100000000;
Console.WriteLine(l.ToFileSize()); 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2008-09-24T18:56:26.610

好的，我不打算将其包装为格式提供程序，而是重新发明轮子，而是使用 Win32 api 调用来根据我在各种应用程序中多次使用的提供的字节格式化大小字符串。

```
[DllImport("Shlwapi.dll", CharSet = CharSet.Auto)]
public static extern long StrFormatByteSize( long fileSize, [MarshalAs(UnmanagedType.LPTStr)] StringBuilder buffer, int bufferSize ); 
```

所以我想你应该能够使用它作为核心转换代码来组合一个提供程序。

这是StrFormatByteSize 的 MSDN 规范的链接[。](http://msdn.microsoft.com/en-us/library/bb759974(VS.85).aspx)

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2010-10-19T12:52:37.693

我现在意识到您实际上是在要求可以与 String.Format() 一起使用的东西-我想我应该在发布之前阅读该问题两次；-)

我不喜欢每次都必须显式传入格式提供程序的解决方案——据我从[本文](http://msdn.microsoft.com/en-us/library/26etazsy.aspx)中收集到的信息，解决此问题的最佳方法是实现 FileSize 类型，实现 IFormattable 接口。

我继续实现了一个支持此接口的结构，并且可以从整数转换。在我自己的文件相关 API 中，我将让我的 .FileSize 属性返回一个 FileSize 实例。

这是代码：

```
using System.Globalization;

public struct FileSize : IFormattable
{
    private ulong _value;

    private const int DEFAULT_PRECISION = 2;

    private static IList<string> Units;

    static FileSize()
    {
        Units = new List<string>(){
            "B", "KB", "MB", "GB", "TB"
        };
    }

    public FileSize(ulong value)
    {
        _value = value;
    }

    public static explicit operator FileSize(ulong value)
    {
        return new FileSize(value);
    }

    override public string ToString()
    {
        return ToString(null, null);
    }

    public string ToString(string format)
    {
        return ToString(format, null);
    }

    public string ToString(string format, IFormatProvider formatProvider)
    {
        int precision;

        if (String.IsNullOrEmpty(format))
            return ToString(DEFAULT_PRECISION);
        else if (int.TryParse(format, out precision))
            return ToString(precision);
        else
            return _value.ToString(format, formatProvider);
    }

    /// <summary>
    /// Formats the FileSize using the given number of decimals.
    /// </summary>
    public string ToString(int precision)
    {
        double pow = Math.Floor((_value > 0 ? Math.Log(_value) : 0) / Math.Log(1024));
        pow = Math.Min(pow, Units.Count - 1);
        double value = (double)_value / Math.Pow(1024, pow);
        return value.ToString(pow == 0 ? "F0" : "F" + precision.ToString()) + " " + Units[(int)pow];
    }
} 
```

还有一个简单的单元测试演示了它是如何工作的：

```
 [Test]
    public void CanUseFileSizeFormatProvider()
    {
        Assert.AreEqual(String.Format("{0}", (FileSize)128), "128 B");
        Assert.AreEqual(String.Format("{0}", (FileSize)1024), "1.00 KB");
        Assert.AreEqual(String.Format("{0:0}", (FileSize)10240), "10 KB");
        Assert.AreEqual(String.Format("{0:1}", (FileSize)102400), "100.0 KB");
        Assert.AreEqual(String.Format("{0}", (FileSize)1048576), "1.00 MB");
        Assert.AreEqual(String.Format("{0:D}", (FileSize)123456), "123456");

        // You can also manually invoke ToString(), optionally with the precision specified as an integer:
        Assert.AreEqual(((FileSize)111111).ToString(2), "108.51 KB");
    } 
```

如您所见，现在可以正确格式化 FileSize 类型，还可以指定小数位数，以及在需要时应用常规数字格式。

我想您可以更进一步，例如允许显式格式选择，例如“{0:KB}”以强制以千字节为单位进行格式化。但我将把它留在这里。

我还将在下面留下我的初始帖子，因为这两个不喜欢使用格式化 API ...

* * *

给猫剥皮的 100 种方法，但这是我的方法 - 为 int 类型添加扩展方法：

```
public static class IntToBytesExtension
{
    private const int PRECISION = 2;

    private static IList<string> Units;

    static IntToBytesExtension()
    {
        Units = new List<string>(){
            "B", "KB", "MB", "GB", "TB"
        };
    }

    /// <summary>
    /// Formats the value as a filesize in bytes (KB, MB, etc.)
    /// </summary>
    /// <param name="bytes">This value.</param>
    /// <returns>Filesize and quantifier formatted as a string.</returns>
    public static string ToBytes(this int bytes)
    {
        double pow = Math.Floor((bytes>0 ? Math.Log(bytes) : 0) / Math.Log(1024));
        pow = Math.Min(pow, Units.Count-1);
        double value = (double)bytes / Math.Pow(1024, pow);
        return value.ToString(pow==0 ? "F0" : "F" + PRECISION.ToString()) + " " + Units[(int)pow];
    }
} 
```

在您的程序集中使用此扩展名，要格式化文件大小，只需使用类似 (1234567).ToBytes() 的语句

以下 MbUnit 测试准确地阐明了输出的样子：

```
 [Test]
    public void CanFormatFileSizes()
    {
        Assert.AreEqual("128 B", (128).ToBytes());
        Assert.AreEqual("1.00 KB", (1024).ToBytes());
        Assert.AreEqual("10.00 KB", (10240).ToBytes());
        Assert.AreEqual("100.00 KB", (102400).ToBytes());
        Assert.AreEqual("1.00 MB", (1048576).ToBytes());
    } 
```

而且您可以轻松地将单位和精度更改为适合您需要的任何内容:-)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2014-01-16T23:41:02.747

这是我知道的最简单的格式化文件大小的实现：

```
public string SizeText
{
    get
    {
        var units = new[] { "B", "KB", "MB", "GB", "TB" };
        var index = 0;
        double size = Size;
        while (size > 1024)
        {
            size /= 1024;
            index++;
        }
        return string.Format("{0:2} {1}", size, units[index]);
    }
} 
```

而 Size 是未格式化的文件大小（以字节为单位）。

问候基督徒

[http://www.wpftutorial.net](http://www.wpftutorial.net)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-11-18T14:49:02.730

我的代码...感谢肖恩奥斯汀。

```
[DllImport("Shlwapi.dll", CharSet = CharSet.Auto)]
public static extern long StrFormatByteSize(long fileSize, [MarshalAs(UnmanagedType.LPTStr)] StringBuilder buffer, int bufferSize);

public void getFileInfo(string filename)
{
    System.IO.FileInfo fileinfo = new FileInfo(filename);
    this.FileName.Text = fileinfo.Name;
    StringBuilder buffer = new StringBuilder();
    StrFormatByteSize(fileinfo.Length, buffer, 100);
    this.FileSize.Text = buffer.ToString();
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-03-11T13:59:56.190

因为换档是一种非常便宜的操作

```
public static string ToFileSize(this long size)
{
    if (size < 1024)
    {
        return (size).ToString("F0") + " bytes";
    }
    else if ((size >> 10) < 1024)
    {
        return (size/(float)1024).ToString("F1") + " KB";
    }
    else if ((size >> 20) < 1024)
    {
        return ((size >> 10) / (float)1024).ToString("F1") + " MB";
    }
    else if ((size >> 30) < 1024)
    {
        return ((size >> 20) / (float)1024).ToString("F1") + " GB";
    }
    else if ((size >> 40) < 1024)
    {
        return ((size >> 30) / (float)1024).ToString("F1") + " TB";
    }
    else if ((size >> 50) < 1024)
    {
        return ((size >> 40) / (float)1024).ToString("F1") + " PB";
    }
    else
    {
        return ((size >> 50) / (float)1024).ToString("F0") + " EB";
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-08-20T09:32:02.833

我需要一个可以针对不同文化进行本地化的版本（十进制分隔符、“字节”翻译）并支持所有可能的[二进制前缀](http://en.wikipedia.org/wiki/Binary_prefix)（最多 Exa）。这是一个演示如何使用它的示例：

```
// force "en-US" culture for tests
Thread.CurrentThread.CurrentCulture = CultureInfo.GetCultureInfo(1033); 

// Displays "8.00 EB"
Console.WriteLine(FormatFileSize(long.MaxValue)); 

// Use "fr-FR" culture. Displays "20,74 ko", o is for "octet"
Console.WriteLine(FormatFileSize(21234, "o", null, CultureInfo.GetCultureInfo(1036))); 
```

这是代码：

```
 /// <summary>
    /// Converts a numeric value into a string that represents the number expressed as a size value in bytes, kilobytes, megabytes, gigabytes, terabytes, petabytes or exabytes, depending on the size
    /// </summary>
    /// <param name="size">The size.</param>
    /// <returns>
    /// The number converted.
    /// </returns>
    public static string FormatFileSize(long size)
    {
        return FormatFileSize(size, null, null, null);
    }

    /// <summary>
    /// Converts a numeric value into a string that represents the number expressed as a size value in bytes, kilobytes, megabytes, gigabytes, terabytes, petabytes or exabytes, depending on the size
    /// </summary>
    /// <param name="size">The size.</param>
    /// <param name="byteName">The string used for the byte name. If null is passed, "B" will be used.</param>
    /// <param name="numberFormat">The number format. If null is passed, "N2" will be used.</param>
    /// <param name="formatProvider">The format provider. May be null to use current culture.</param>
    /// <returns>The number converted.</returns>
    public static string FormatFileSize(long size, string byteName, string numberFormat, IFormatProvider formatProvider)
    {
        if (size < 0)
            throw new ArgumentException(null, "size");

        if (byteName == null)
        {
            byteName = "B";
        }

        if (string.IsNullOrEmpty(numberFormat))
        {
            numberFormat = "N2";
        }

        const decimal K = 1024;
        const decimal M = K * K;
        const decimal G = M * K;
        const decimal T = G * K;
        const decimal P = T * K;
        const decimal E = P * K;

        decimal dsize = size;

        string suffix = null;
        if (dsize >= E)
        {
            dsize /= E;
            suffix = "E";
        }
        else if (dsize >= P)
        {
            dsize /= P;
            suffix = "P";
        }
        else if (dsize >= T)
        {
            dsize /= T;
            suffix = "T";
        }
        else if (dsize >= G)
        {
            dsize /= G;
            suffix = "G";
        }
        else if (dsize >= M)
        {
            dsize /= M;
            suffix = "M";
        }
        else if (dsize >= K)
        {
            dsize /= K;
            suffix = "k";
        }
        if (suffix != null)
        {
            suffix = " " + suffix;
        }
        return string.Format(formatProvider, "{0:" + numberFormat + "}" + suffix + byteName, dsize);
    } 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-11-27T02:41:16.040

这是一个更精确的扩展：

```
 public static string FileSizeFormat(this long lSize)
    {
        double size = lSize;
        int index = 0;
        for(; size > 1024; index++)
            size /= 1024;
        return size.ToString("0.000 " + new[] { "B", "KB", "MB", "GB", "TB" }[index]);          
    } 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-12-03T10:48:09.900

可以在此处找到域驱动方法：[https ://github.com/Corniel/Qowaiv/blob/master/src/Qowaiv/IO/StreamSize.cs](https://github.com/Corniel/Qowaiv/blob/master/src/Qowaiv/IO/StreamSize.cs)

StreamSize 结构是流大小的表示，允许您使用适当的扩展名自动格式化，还可以指定您希望它以 KB/MB 或其他形式显示。这有很多优点，不仅因为您可以开箱即用地进行格式化，还可以帮助您制作更好的模型，因为很明显，方法的属性或结果表示流大小。它还具有文件大小的扩展名：GetStreamSize（此 FileInfo 文件）。

## 简写法

*   新 StreamSize(8900).ToString("s") => 8900b
*   新 StreamSize(238900).ToString("s") => 238.9kb
*   新 StreamSize(238900).ToString("S") => 238.9 kB
*   新 StreamSize(238900).ToString("0000.00 S") => 0238.90 kB

## 完整的符号

*   新 StreamSize(8900).ToString("0.0 f") => 8900.0 字节
*   新 StreamSize(238900).ToString("0 f") => 234 KB
*   新 StreamSize(1238900).ToString("0.00 F") => 1.24 兆字节

## 风俗

*   新 StreamSize(8900).ToString("0.0 kb") => 8.9 kb
*   新 StreamSize(238900).ToString("0.0 MB") => 0.2 MB
*   新 StreamSize(1238900).ToString("#,##0.00 千字节") => 1,239.00 千字节
*   新 StreamSize(1238900).ToString("#,##0") => 1,238,900

有一个 NuGet 包，所以你可以使用那个：[https ://www.nuget.org/packages/Qowaiv](https://www.nuget.org/packages/Qowaiv)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-03-18T03:56:13.173

我采用了 Eduardo 的回答，并将其与其他地方的类似示例结合起来，为格式设置提供了额外的选项。

```
public class FileSizeFormatProvider : IFormatProvider, ICustomFormatter
{
   public object GetFormat(Type formatType)
   {
      if (formatType == typeof(ICustomFormatter))
      {
         return this;
      }

      return null;
   }

   private const string fileSizeFormat = "FS";
   private const string kiloByteFormat = "KB";
   private const string megaByteFormat = "MB";
   private const string gigaByteFormat = "GB";
   private const string byteFormat = "B";
   private const Decimal oneKiloByte = 1024M;
   private const Decimal oneMegaByte = oneKiloByte * 1024M;
   private const Decimal oneGigaByte = oneMegaByte * 1024M;

   public string Format(string format, object arg, IFormatProvider formatProvider)
   {
      //
      // Ensure the format provided is supported
      //
      if (String.IsNullOrEmpty(format) || !(format.StartsWith(fileSizeFormat, StringComparison.OrdinalIgnoreCase) ||
                                            format.StartsWith(kiloByteFormat, StringComparison.OrdinalIgnoreCase) ||
                                            format.StartsWith(megaByteFormat, StringComparison.OrdinalIgnoreCase) ||
                                            format.StartsWith(gigaByteFormat, StringComparison.OrdinalIgnoreCase)))
      {
         return DefaultFormat(format, arg, formatProvider);
      }

      //
      // Ensure the argument type is supported
      //
      if (!(arg is long || arg is decimal || arg is int))
      {
         return DefaultFormat(format, arg, formatProvider);
      }

      //
      // Try and convert the argument to decimal
      //
      Decimal size;

      try
      {
         size = Convert.ToDecimal(arg);
      }
      catch (InvalidCastException)
      {
         return DefaultFormat(format, arg, formatProvider);
      }

      //
      // Determine the suffix to use and convert the argument to the requested size
      //
      string suffix;

      switch (format.Substring(0, 2).ToUpper())
      {
         case kiloByteFormat:
            size = size / oneKiloByte;
            suffix = kiloByteFormat;
            break;
         case megaByteFormat:
            size = size / oneMegaByte;
            suffix = megaByteFormat;
            break;
         case gigaByteFormat:
            size = size / oneGigaByte;
            suffix = gigaByteFormat;
            break;
         case fileSizeFormat:
            if (size > oneGigaByte)
            {
               size /= oneGigaByte;
               suffix = gigaByteFormat;
            }
            else if (size > oneMegaByte)
            {
               size /= oneMegaByte;
               suffix = megaByteFormat;
            }
            else if (size > oneKiloByte)
            {
               size /= oneKiloByte;
               suffix = kiloByteFormat;
            }
            else
            {
               suffix = byteFormat;
            }
            break;
         default:
            suffix = byteFormat;
            break;
      }

      //
      // Determine the precision to use
      //
      string precision = format.Substring(2);

      if (String.IsNullOrEmpty(precision))
      {
         precision = "2";
      }

      return String.Format("{0:N" + precision + "}{1}", size, suffix);
   }

   private static string DefaultFormat(string format, object arg, IFormatProvider formatProvider)
   {
      IFormattable formattableArg = arg as IFormattable;

      if (formattableArg != null)
      {
         return formattableArg.ToString(format, formatProvider);
      }

      return arg.ToString();
   }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-12-08T13:23:29.700

如果你改变：

```
 if (String.IsNullOrEmpty(precision))
      {
         precision = "2";
      } 
```

进入

```
 if (String.IsNullOrEmpty(precision))
      {
        if (size < 10)
        {
           precision = "2";
        }
        else if (size < 100)
        {
            precision = "1";
        }
        else
        {
           precision = "0";
        }
      } 
```

没有额外精度说明符的结果（所以只有 0:fs 而不是 0:fs3）将开始通过调整精度来模仿 Win32 的 StrFormatByteSize() 大小。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-05-31T09:53:13.013

使用 C# 9.0 的语法可以这样写：

```
public static string ToFormatSize(ulong size)
{
  return size switch
  {
    ulong s when s < 1024 => $"{size} bytes",
    ulong s when s < (1024 << 10) => $"{Math.Round(size / 1024D, 2)} KB",
    ulong s when s < (1024 << 20) => $"{Math.Round(size * 1D / (1024 << 10), 2)} MB",
    ulong s when s < (1024 << 30) => $"{Math.Round(size * 1D / (1024L << 20), 2)} GB",
    ulong s when s < (1024 << 40) => $"{Math.Round(size * 1D / (1024L << 30), 2)} TB",
    ulong s when s < (1024 << 50) => $"{Math.Round(size * 1D / (1024L << 40), 2)} PB",
    ulong s when s < (1024 << 60) => $"{Math.Round(size * 1D / (1024L << 50), 2)} EB",
    _ => $"{size} bytes"
  };
} 
```

# sql - 禁用Oracle中的所有表约束

> ID：128623
> 
> 赞同：98
> 
> 时间：2008-09-24T17:45:09.573
> 
> 标签：sql, oracle

如何使用单个命令禁用 Oracle 中的所有表约束？这可以是单个表、表列表或所有表。

* * *

## 回答 #1

> 赞同：152
> 
> 时间：2008-09-25T05:26:55.737

最好避免写出临时假脱机文件。使用 PL/SQL 块。您可以从 SQL*Plus 运行它或将它放入包或过程中。与 USER_TABLES 的连接是为了避免视图约束。

您不太可能真的想要禁用所有约束（包括 NOT NULL、主键等）。您应该考虑将 constraint_type 放在 WHERE 子句中。

```
BEGIN
  FOR c IN
  (SELECT c.owner, c.table_name, c.constraint_name
   FROM user_constraints c, user_tables t
   WHERE c.table_name = t.table_name
   AND c.status = 'ENABLED'
   AND NOT (t.iot_type IS NOT NULL AND c.constraint_type = 'P')
   ORDER BY c.constraint_type DESC)
  LOOP
    dbms_utility.exec_ddl_statement('alter table "' || c.owner || '"."' || c.table_name || '" disable constraint ' || c.constraint_name);
  END LOOP;
END;
/ 
```

再次启用约束有点棘手 - 您需要先启用主键约束，然后才能在外键约束中引用它们。这可以使用约束类型上的 ORDER BY 来完成。'P' = 主键，'R' = 外键。

```
BEGIN
  FOR c IN
  (SELECT c.owner, c.table_name, c.constraint_name
   FROM user_constraints c, user_tables t
   WHERE c.table_name = t.table_name
   AND c.status = 'DISABLED'
   ORDER BY c.constraint_type)
  LOOP
    dbms_utility.exec_ddl_statement('alter table "' || c.owner || '"."' || c.table_name || '" enable constraint ' || c.constraint_name);
  END LOOP;
END;
/ 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-02-22T08:37:13.930

要计算约束之间的依赖关系：

```
SET Serveroutput ON
BEGIN
    FOR c IN
    (SELECT c.owner,c.table_name,c.constraint_name
    FROM user_constraints c,user_tables t
    WHERE c.table_name=t.table_name
    AND c.status='ENABLED'
    ORDER BY c.constraint_type DESC,c.last_change DESC
    )
    LOOP
        FOR D IN
        (SELECT P.Table_Name Parent_Table,C1.Table_Name Child_Table,C1.Owner,P.Constraint_Name Parent_Constraint,
            c1.constraint_name Child_Constraint
        FROM user_constraints p
        JOIN user_constraints c1 ON(p.constraint_name=c1.r_constraint_name)
        WHERE(p.constraint_type='P'
        OR p.constraint_type='U')
        AND c1.constraint_type='R'
        AND p.table_name=UPPER(c.table_name)
        )
        LOOP
            dbms_output.put_line('. Disable the constraint ' || d.Child_Constraint ||' (on table '||d.owner || '.' ||
            d.Child_Table || ')') ;
            dbms_utility.exec_ddl_statement('alter table ' || d.owner || '.' ||d.Child_Table || ' disable constraint ' ||
            d.Child_Constraint) ;
        END LOOP;
    END LOOP;
END;
/ 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-24T18:03:59.463

这不是一个命令，但我是这样做的。以下脚本设计为在 SQL*Plus 中运行。请注意，我特意将其编写为仅在当前架构中工作。

```
set heading off

spool drop_constraints.out

select
    'alter table ' || 
    owner || '.' || 
    table_name || 
    ' disable constraint ' || -- or 'drop' if you want to permanently remove
    constraint_name || ';'
from
    user_constraints;

spool off

set heading on

@drop_constraints.out 
```

要限制您删除的内容，请在 select 语句中添加一个 where 子句：-

*   过滤约束类型以仅删除特定类型的约束
*   对 table_name 进行过滤以仅对一个或几个表执行此操作。

要在当前模式之外运行，请将 select 语句修改为 select from all_constraints 而不是 user_constraints。

**注意**- 由于某种原因，我无法让下划线不像上一段中的斜体。如果有人知道如何解决它，请随时编辑此答案。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-10-25T11:37:38.003

使用以下光标禁用所有约束..并更改查询以启用约束...

```
DECLARE

cursor r1 is select * from user_constraints;
cursor r2 is select * from user_tables;

BEGIN
  FOR c1 IN r1
  loop
    for c2 in r2
    loop
       if c1.table_name = c2.table_name and c1.status = 'ENABLED' THEN
        dbms_utility.exec_ddl_statement('alter table ' || c1.owner || '.' || c1.table_name || ' disable constraint ' || c1.constraint_name);
       end if;
    end loop;
  END LOOP;
END;
/ 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-24T18:09:07.457

这可以非常简单地基于 DBA/ALL/USER_CONSTRAINTS 系统视图在 PL/SQL 中编写脚本，但各种细节并不像听起来那么简单。您必须注意它的完成顺序，并且您还必须考虑唯一索引的存在。

顺序很重要，因为您不能删除由外键引用的唯一键或主键，并且其他模式中的表上可能存在引用您自己的主键的外键，因此除非您具有 ALTER ANY TABLE 特权，否则您不能丢弃那些 PK 和 UK。此外，您不能将唯一索引切换为非唯一索引，因此您必须删除它才能删除约束（因此，将唯一约束实现为非唯一约束支持的“真实”约束几乎总是更好） -唯一索引）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-02-06T13:38:01.113

```
SELECT 'ALTER TABLE '||substr(c.table_name,1,35)|| 
' DISABLE CONSTRAINT '||constraint_name||' ;' 
FROM user_constraints c, user_tables u 
WHERE c.table_name = u.table_name; 
```

此语句返回关闭所有约束的命令，包括主键、外键和其他约束。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T17:50:56.330

看起来你不能用一个命令来做到这一点，但这是我能找到[的](http://oracle.ittoolbox.com/documents/popular-q-and-a/how-to-disable-all-constraints-via-single-sql-command-1948)最接近它的东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-08T23:24:17.003

在“禁用”脚本中，order by 子句应该是：

```
ORDER BY c.constraint_type DESC, c.last_change DESC 
```

此子句的目标是以正确的顺序禁用约束。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-10-27T09:48:04.813

这是禁用约束的另一种方法（它来自 [https://asktom.oracle.com/pls/asktom/f?p=100:11:2402577774283132::::P11_QUESTION_ID:399218963817](https://asktom.oracle.com/pls/asktom/f?p=100:11:2402577774283132::::P11_QUESTION_ID:399218963817)）

```
WITH qry0 AS
       (SELECT    'ALTER TABLE '
               || child_tname
               || ' DISABLE CONSTRAINT '
               || child_cons_name
                 disable_fk
              ,   'ALTER TABLE '
               || parent_tname
               || ' DISABLE CONSTRAINT '
               || parent.parent_cons_name
                 disable_pk
          FROM (SELECT a.table_name child_tname
                      ,a.constraint_name child_cons_name
                      ,b.r_constraint_name parent_cons_name
                      ,LISTAGG ( column_name, ',') WITHIN GROUP (ORDER BY position) child_columns
                  FROM user_cons_columns a
                      ,user_constraints b
                 WHERE a.constraint_name = b.constraint_name AND b.constraint_type = 'R'
                GROUP BY a.table_name, a.constraint_name
                        ,b.r_constraint_name) child
              ,(SELECT a.constraint_name parent_cons_name
                      ,a.table_name parent_tname
                      ,LISTAGG ( column_name, ',') WITHIN GROUP (ORDER BY position) parent_columns
                  FROM user_cons_columns a
                      ,user_constraints b
                 WHERE a.constraint_name = b.constraint_name AND b.constraint_type IN ('P', 'U')
                GROUP BY a.table_name, a.constraint_name) parent
         WHERE child.parent_cons_name = parent.parent_cons_name
           AND (parent.parent_tname LIKE 'V2_%' OR child.child_tname LIKE 'V2_%'))
SELECT DISTINCT disable_pk
  FROM qry0
UNION
SELECT DISTINCT disable_fk
  FROM qry0; 
```

奇迹般有效

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-07-04T12:04:18.747

带光标循环（用户 = 'TRANEE'，表 = 'D'）

```
declare
    constr all_constraints.constraint_name%TYPE;
begin
    for constr in
        (select constraint_name from all_constraints
        where table_name = 'D'
        and owner = 'TRANEE')
    loop
        execute immediate 'alter table D disable constraint '||constr.constraint_name;
    end loop;
end;
/ 
```

（如果将禁用更改为启用，则可以使所有约束启用）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-10-24T12:01:58.223

您可以执行以下查询返回的所有命令：

选择'ALTER TABLE'||substr(c.table_name,1,35)|| '禁用约束'||constraint_name||' ;' 来自 user_constraints c --其中 c.table_name = 'TABLE_NAME' ；

# editor - 具有 Visual Studio 编辑器功能的独立文本编辑器

> ID：128625
> 
> 赞同：5
> 
> 时间：2008-09-24T17:45:43.410
> 
> 标签：editor, text-editor

有人知道任何具有 Visual Studio 编辑器功能的文本编辑器吗？具体来说，我正在寻找以下功能：

CTRL+C 在行的任意位置，没有选择文本 -> 整行被复制

CTRL+X 或 SHIFT+DEL 在行的任意位置，没有选择文本 -> 整行剪切 谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T17:57:38.123

[Komodo Edit](http://www.activestate.com/Products/komodo_ide/komodo_edit.mhtml)执行您指定的两件事。

我一直将它用作辅助编辑器，用于各种脚本和其他编程任务。大量功能，免费，开源。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T04:14:45.550

[Zeus](http://www.zeusedit.com)可以模拟 Visual Studio 键盘。

要更改键盘映射，只需使用**选项**、**编辑器选项**菜单并在**键盘**面板中选择 MSVC 作为活动键盘映射。

[![替代文字](https://i.stack.imgur.com/vg6aK.jpg)](https://i.stack.imgur.com/vg6aK.jpg)
[（来源：[zeusedit.com](http://www.zeusedit.com/images/_lookmain.jpg)）]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T17:47:02.157

Notepad++、UltraEdit 和 TextPad 都是不错的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T14:22:10.933

当没有选择文本时，[EditPad Pro将剪切或复制光标所在的行。](http://www.editpadpro.com/)人们有时将其报告为错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-05-10T11:55:34.780

[Twistpad](http://www.carthagosoft.net/twistpad/index.htm)看起来有点像 Visual Studio 2005/2008 编辑器，并且似乎具有相同的键绑定，包括 Ctrl-X 如果没有标记文本则剪切整行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T17:51:28.230

[滑动编辑](http://www.slickedit.com/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T18:03:29.747

不要因为 Chris 对 Notepad++、UltraEdit 和 TextPad 的建议而抢走 Chris 的风头，但我想指出的是，有一个[UltraEdit](http://www.ultraedit.com/products/ue3.html)版本可以从拇指驱动器上运行（适用于那些在工作中缺乏管理员权限的人和无法安装程序）。

# visual-studio - 如何在 VS 2008 Post-Build 事件中使用系统环境变量？

> ID：128634
> 
> 赞同：22
> 
> 时间：2008-09-24T17:47:21.360
> 
> 标签：visual-studio, build-process

如何在我的项目构建后事件中使用系统环境变量，而无需编写和执行外部批处理文件？我认为这就像创建一个名为的新环境变量`LHDLLDEPLOY`并在我的构建后事件文本框中编写以下内容一样简单：

```
copy $(TargetPath) %LHDLLDEPLOY%\$(TargetFileName) /Y
copy $(TargetName).pdb %LHDLLDEPLOY%\$(TargetName).pdb /Y 
```

......但是，唉，不。构建输出显示它将文件写入“ `%LHDLLDEPLOY%`”文件夹（`1 file(s) copied`两次“”），但文件不在等价路径中，并且没有名为“ `LHDLLDEPLOY`”的新文件夹

他们实际上去了哪里，我该如何正确地做到这一点？

（更新：**Xavier**`$(LHDLLDEPLOY)`做到了。此外，在我重新启动机器以刷新环境变量后，他的变量格式有效。）

（更新 2：原来我不必重新启动我的机器。我只需要确保我 a）关闭了环境变量列表窗口，并且 b）关闭/重新启动了 Visual Studio。）

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-24T17:49:42.680

您是否尝试过 $(LHDLLDEPLOY) 而不是 %LHDLLDEPLOY%？

# c# - .Net 数据结构：ArrayList、List、HashTable、Dictionary、SortedList、SortedDictionary——速度、内存以及何时使用它们？

> ID：128636
> 
> 赞同：220
> 
> 时间：2008-09-24T17:47:27.897
> 
> 标签：c#, .net, vb.net, arrays, data-structures

.NET 有很多复杂的数据结构。不幸的是，其中一些非常相似，我并不总是确定什么时候使用一个，什么时候使用另一个。我的大部分 C# 和 VB 书籍都在一定程度上谈到了它们，但它们从未真正深入任何真正的细节。

Array、ArrayList、List、Hashtable、Dictionary、SortedList 和 SortedDictionary 有什么区别？

哪些是可枚举的（IList -- 可以执行“foreach”循环）？哪些使用键/值对（IDict）？

内存占用呢？插入速度？检索速度？

还有其他值得一提的数据结构吗？

我仍在寻找有关内存使用和速度的更多详细信息（Big-O 表示法）

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2008-09-24T18:00:25.870

在我的头顶上：

*   `Array`* - 代表一个老式的内存数组 - 有点像普通`type[]`数组的别名。可以列举。不能自动生长。我会假设非常快的插入和检索速度。

*   `ArrayList`- 自动增长的数组。增加更多开销。可以枚举，可能比普通数组慢，但仍然相当快。这些在 .NET 中被大量使用

*   `List`- 我的最爱之一 - 可以与泛型一起使用，因此您可以拥有一个强类型数组，例如`List<string>`. 除此之外，行为非常像`ArrayList`

*   `Hashtable`- 普通的旧哈希表。O(1) 到 O(n) 最坏的情况。可以枚举 value 和 keys 属性，并做 key/val 对

*   `Dictionary`- 与上述相同，仅通过泛型进行强类型化，例如`Dictionary<string, string>`

*   `SortedList`- 排序的通用列表。插入速度变慢，因为它必须弄清楚把东西放在哪里。可以枚举，在检索时可能相同，因为它不必求助，但删除会比普通的旧列表慢。

我倾向于一直使用`List`-`Dictionary`一旦你开始使用泛型强类型的它们，就很难回到标准的非泛型。

还有很多其他的数据结构——`KeyValuePair`你可以用它来做一些有趣的事情，还有一个`SortedDictionary`也很有用。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-24T17:52:02.583

**如果可能，请使用泛型。** 这包括：

*   列表而不是 ArrayList
*   字典而不是 HashTable

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-09-24T17:58:05.720

首先，.NET 中的所有集合都实现了 IEnumerable。

其次，很多集合都是重复的，因为泛型是在 2.0 版框架中添加的。

因此，尽管通用集合可能会添加功能，但在大多数情况下：

*   List 是 ArrayList 的通用实现。
*   Dictionary<T,K> 是 Hashtable 的通用实现

数组是一个固定大小的集合，您可以更改存储在给定索引处的值。

SortedDictionary 是一个基于键排序的 IDictionary<T,K>。SortedList 是一个 IDictionary<T,K>，它根据所需的 IComparer 进行排序。

因此，IDictionary 实现（那些支持 KeyValuePairs）是：

*   哈希表
*   字典<T,K>
*   排序列表<T,K>
*   排序字典<T,K>

.NET 3.5 中添加的另一个集合是 Hashset。它是一个支持集合操作的集合。

此外，LinkedList 是一个标准的链表实现（List 是一个用于更快检索的数组列表）。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-09-24T18:05:04.533

这里有一些一般性的提示给你：

*   您可以`foreach`在实现`IEnumerable`. `IList`本质上是一个`IEnumberable`with `Count`and `Item`（使用从零开始的索引访问项目）属性。`IDictionary`另一方面意味着您可以通过任何哈希索引访问项目。

*   `Array`，`ArrayList`并`List`全部实施`IList`。 `Dictionary`, `SortedDictionary`, 和`Hashtable`实施`IDictionary`。

*   如果您使用的是 .NET 2.0 或更高版本，建议您使用上述类型的通用对应项。

*   对于这些类型的各种操作的时间和空间复杂性，您应该查阅他们的文档。

*   .NET 数据结构位于`System.Collections`命名空间中。有一些类型库，例如[PowerCollections](http://www.wintellect.com/PowerCollections.aspx)，它们提供了额外的数据结构。

*   要全面了解数据结构，请查阅[CLRS](http://mitpress.mit.edu/algorithms/)等资源。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2014-10-13T14:56:55.193

## .NET 数据结构：

### 更多关于为什么 ArrayList 和 List 实际上不同的对话

### 数组

正如一位用户所说，数组是“老派”集合（是的，数组被认为是一个集合，尽管不是 的一部分`System.Collections`）。但是，与其他集合相比，数组的“老派”是什么，即您在标题中列出的那些（这里是 ArrayList 和 List(Of T)）？让我们从数组的基础开始。

首先， Microsoft .NET 中的[数组](http://msdn.microsoft.com/en-us/magazine/cc301755.aspx)是“允许您将多个 [逻辑相关] 项视为单个集合的机制”（请参阅​​链接文章）。这意味着什么？数组按顺序存储各个成员（元素），一个接一个地存储在内存中，并具有起始地址。通过使用数组，我们可以轻松地访问从该地址开始的顺序存储的元素。

除此之外，与编程 101 个常见概念相反，数组确实可以非常复杂：

数组可以是单维的、多维的或加法的（交错的数组值得一读）。数组本身不是动态的：一旦初始化，一个*n*大小的数组就会保留足够的空间来容纳*n*个对象。数组中的元素数量不能增加或减少。`Dim _array As Int32() = New Int32(100)`在内存块上为数组保留足够的空间以包含 100 个 Int32 原始类型对象（在这种情况下，数组被初始化为包含 0）。该块的地址返回到`_array`。

根据这篇文章，[公共语言规范](https://en.wikipedia.org/wiki/Common_Language_Infrastructure#Overview)(CLS) 要求所有数组都是从零开始的。.NET 中的数组支持非从零开始的数组；但是，这种情况不太常见。由于零基数组的“共性”，微软花**了很多时间优化它们的性能**；因此，单维、从零开始的 (SZ) 数组是“特殊的”——并且实际上是数组的最佳实现（与多维等相反）——因为 SZ 具有用于操作它们的特定中间语言指令。

数组总是通过引用传递（作为内存地址）——这是数组难题的一个重要部分。虽然他们进行边界检查（会抛出错误），但也可以在数组上禁用边界检查。

同样，数组的最大障碍是它们无法重新调整大小。它们具有“固定”容量。在我们的历史中介绍 ArrayList 和 List(Of T)：

### ArrayList - 非泛型列表

[ArrayList](http://msdn.microsoft.com/en-us/library/system.collections.arraylist(v=vs.110).aspx)（连同——尽管这里`List(Of T)`有一些关键的区别，稍后解释）——也许最好被认为是集合的下一个补充（在广义上）。ArrayList 继承自[IList](http://msdn.microsoft.com/en-us/library/system.collections.ilist(v=vs.110).aspx)（'ICollection' 的后代）接口。ArrayLists 本身比 Lists更[庞大](https://stackoverflow.com/questions/4823684/dont-use-arraylist)- 需要更多[开销。](http://blogs.msdn.com/b/joshwil/archive/2004/04/13/112598.aspx)

`IList`确实使实现能够将 ArrayLists 视为固定大小的列表（如 Arrays）；然而，除了 ArrayLists 添加的额外功能之外，使用固定大小的 ArrayLists 并没有真正的优势，因为在这种情况下 ArrayLists（相对于 Arrays）明显更慢。

根据我的阅读，ArrayLists 不能是锯齿状的：“不支持使用多维数组作为元素......”。再一次，ArrayLists 棺材上的另一个钉子。ArrayLists 也不是“类型化的”——这意味着，在一切之下，ArrayList 只是一个动态的对象数组：`Object[]`. 这在实现 ArrayList 时需要大量装箱（隐式）和拆箱（显式），再次增加了它们的开销。

*未经证实的想法：我想我记得我读过或听过我的一位教授说 ArrayList 是试图从 Arrays 转移到 List 类型 Collections 的混蛋概念孩子，即曾经对 Arrays 进行了很大改进，它们不再是最好的选择，因为已经对收藏进行了进一步的开发*

### List(Of T)：ArrayList 变成了什么（并希望变成什么）

内存使用量的差异足以让 List(Of Int32) 消耗的内存比包含相同原始类型的 ArrayList 少 56%（在上述绅士的链接演示中为 8 MB 对 19 MB：再次，链接[在这里](http://blogs.msdn.com/b/joshwil/archive/2004/04/13/112598.aspx)） - 虽然这是 64 位机器的复杂结果。这种差异确实表明了两件事：第一（1），装箱的 Int32 类型“对象”（ArrayList）比纯 Int32 原始类型（List）大得多；第二 (2)，由于 64 位机器的内部工作，差异是指数级的。

那么，有什么区别，什么是[List(Of T)](http://msdn.microsoft.com/en-us/library/6sh2ey19(v=vs.110).aspx)？[MSDN](http://en.wikipedia.org/wiki/Microsoft_Developer_Network)将 a 定义`List(Of T)`为“……一个可以通过索引访问的强类型对象列表”。这里的重要性是“强类型”位： List(Of T) '识别'类型并将对象存储为它们的类型。因此， an`Int32`存储为 an`Int32`而不是`Object`类型。这消除了装箱和拆箱引起的问题。

**MSDN 指定这种差异仅在存储原始类型而不是引用类型时发挥作用。**同样，差异确实发生在大规模上：超过 500 个元素。更有趣的是，MSDN 文档中写道：“使用 List(Of T) 类的特定于类型的实现而不是使用 ArrayList 类对您有利......”

本质上，List(Of T) 是 ArrayList，但更好。它是 ArrayList 的“通用等价物”。像 ArrayList 一样，在排序之前不能保证排序（见图）。List(Of T) 还具有一些附加功能。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-11-11T08:56:14.557

我对这个问题表示同情 - 我也发现（发现？）这个选择令人困惑，所以我开始科学地查看哪种数据结构最快（我使用 VB 进行了测试，但我想 C# 会是一样的，因为两种语言在 CLR 级别做同样的事情）。你可以[在这里看到我进行的一些基准测试结果](http://www.wiseowl.co.uk/blog/s166/visual-basic-data-types.htm)（还有一些关于哪种数据类型最适合在哪种情况下使用的讨论）。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2020-06-06T06:41:18.143

我发现 Microsoft Docs on Collection and Data Structure 页面上的“Choose a Collection”部分非常有用

[C# 集合和数据结构：选择一个集合](https://docs.microsoft.com/en-us/dotnet/standard/collections/#choose-a-collection)

[![在此处输入图像描述](https://i.stack.imgur.com/olvrQ.png)](https://i.stack.imgur.com/olvrQ.png)

还有下面的矩阵来比较一些其他的特性

[![在此处输入图像描述](https://i.stack.imgur.com/iTb4d.png)](https://i.stack.imgur.com/iTb4d.png)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-24T17:54:32.390

它们在智能感知中的拼写很好。只需键入*System.Collections。*或*System.Collections.Generics*（首选），您将获得可用内容的列表和简短描述。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-24T21:04:16.677

哈希表/字典是 O(1) 性能，这意味着性能不是大小的函数。知道这一点很重要。

编辑：实际上，Hashtable/Dictionary<> 查找的平均时间复杂度为 O(1)。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-28T15:05:34.077

泛型集合将比它们的非泛型集合表现更好，尤其是在迭代许多项目时。这是因为不再发生装箱和拆箱。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-08-27T19:59:50.620

关于高频系统交易工程的哈希表与字典的重要说明：线程安全问题

Hashtable 是线程安全的，可供多个线程使用。字典公共静态成员是线程安全的，但不保证任何实例成员都是如此。

因此 Hashtable 在这方面仍然是“标准”选择。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-05-09T22:46:12.340

**最流行的 C# 数据结构和集合**

*   **大批**
*   **数组列表**
*   **列表**
*   **链表**
*   **字典**
*   **哈希集**
*   **堆**
*   **队列**
*   **排序列表**

**C#.NET**有很多不同的数据结构，例如，最常见的一种是数组。然而，C# 带有更多基本的数据结构。选择要使用的正确数据结构是编写结构良好且高效的程序的一部分。

在本文中，我将介绍内置的 C# 数据结构，包括 C#.NET 3.5 中引入的新数据结构。请注意，其中许多数据结构适用于其他编程语言。

**大批**

也许最简单和最常见的数据结构是数组。AC# 数组基本上是一个对象列表。它的定义特征是所有对象都是相同的类型（在大多数情况下）并且它们的数量是特定的。数组的性质允许根据元素在列表中的位置（也称为索引）快速访问元素。AC# 数组定义如下：

```
[object type][] myArray = new [object type][number of elements] 
```

一些例子：

```
 int[] myIntArray = new int[5];
 int[] myIntArray2 = { 0, 1, 2, 3, 4 }; 
```

正如您从上面的示例中看到的那样，可以不使用任何元素或从一组现有值初始化数组。将值插入数组很简单，只要它们适合。当元素的数量超过数组的大小时，该操作变得昂贵，此时需要扩展数组。这需要更长的时间，因为必须将所有现有元素复制到新的更大的数组中。

**数组列表**

C# 数据结构 ArrayList 是一个动态数组。这意味着 ArrayList 可以有任意数量的对象和任何类型。此数据结构旨在简化将新元素添加到数组中的过程。在底层，ArrayList 是一个数组，每次空间不足时，其大小都会翻倍。将内部数组的大小加倍是一种非常有效的策略，从长远来看可以减少元素复制的数量。我们不会在这里证明这一点。数据结构使用起来非常简单：

```
 ArrayList myArrayList = new ArrayList();
    myArrayList.Add(56);
    myArrayList.Add("String");
    myArrayList.Add(new Form()); 
```

ArrayList 数据结构的缺点是必须将检索到的值转换回其原始类型：

```
int arrayListValue = (int)myArrayList[0] 
```

**您可以在此处找到来源和更多信息**：

*   [C# 数据结构](http://www.vcskicks.com/csharp_data_structures.php)
*   [集合和数据结构](https://docs.microsoft.com/en-us/dotnet/standard/collections/)
*   [List vs IEnumerable vs IQueryable vs ICollection vs IDictionary](https://www.codeproject.com/Articles/832189/List-vs-IEnumerable-vs-IQueryable-vs-ICollection-v)
*   [System.Collections.Generic 命名空间](https://msdn.microsoft.com/en-us/library/system.collections.generic(v=vs.110).aspx)
*   [System.Collections 命名空间](https://msdn.microsoft.com/en-us/library/system.collections(v=vs.110).aspx)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-24T21:11:02.480

泛型和非泛型集合之间存在微妙和不那么微妙的差异。它们只是使用不同的底层数据结构。例如，Hashtable 保证一个写者多读者不同步。字典没有。

# c# - 在 UpdatePanel 内时菜单控件 CSS 中断

> ID：128658
> 
> 赞同：2
> 
> 时间：2008-09-24T17:50:23.897
> 
> 标签：c#, asp.net, asp.net-ajax

我在更新面板中有一个菜单控件。当我将鼠标悬停在选定的项目上，然后移开它时，css 类被设置为 staticSubMenuItem 而不是 staticSubMenuItemSelected。有解决办法吗？

```
 <asp:UpdatePanel runat="server">
                <ContentTemplate>
                     <asp:Menu ID="SubMenu" runat="server" SkinID="subMenu" OnMenuItemClick="SubMenu_Click"
                CssClass="floatRight" StaticMenuItemStyle-CssClass="staticSubMenuItem" StaticSelectedStyle-CssClass="staticSubMenuItemSelected"
                StaticHoverStyle-CssClass="staticSubMenuItemSelected">
                <Items>
                    <asp:MenuItem Text="Item 1" Value="0" Selected="true" />
                    <asp:MenuItem Text="Item 2" Value="1" />
                </Items>
            </asp:Menu>
                </ContentTemplate>
            </asp:UpdatePanel> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T18:06:45.307

问题在这里：

StaticSelectedStyle-CssClass="staticSubMenuItemSelected"
StaticHoverStyle-CssClass="staticSubMenuItemSelected"

如果您为 Selected 和 Hover 设置了不同的 CssClass，则问题已得到解决。创建一个“悬停”css 类并将上面的内容更改为：

StaticSelectedStyle-CssClass="staticSubMenuItemSelected"
StaticHoverStyle-CssClass="staticSubMenuItemHover"

# c# - AJAX.NET Reorderlist 控件 - “它不是数据源，也没有实现 IList。”

> ID：128659
> 
> 赞同：0
> 
> 时间：2008-09-24T17:50:25.160
> 
> 标签：c#, .net, asp.net, asp.net-ajax, reorderlist

尝试重新排序 ReorderList 控件中的项目时，我不断收到此错误。

“重新订购失败，请参阅下面的详细信息。

无法访问数据源。它不是数据源，也没有实现 IList。”

我现在正在将数据源设置为 DataTable，并且目前正在尝试使用 ArrayList 数据源，但由于其他地方的互联网上的[这篇文章而气馁。](http://www.codeplex.com/AjaxControlToolkit/WorkItem/View.aspx?WorkItemId=7589)该控件存在于更新面板中，但没有订阅其他事件。OnItemReorder 事件应该有什么特别之处吗？只是对它的工作原理感到困惑。

我的问题是，有没有人对这个问题有任何直接的经验？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T20:10:11.487

我想到了。我将 DataTable 转换为 ArrayList 然后绑定到控件。感谢大家阅读！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-09T14:41:58.250

我得到了同样的错误信息。就我而言，它发生是因为我试图将该`SortOrder`字段设置为非数字字段。控件只能按类型为整数（或类似）的字段对列表进行排序。不是字符串或日期。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T18:00:54.480

我过去成功使用过它，没有太多问题（绑定到列表）。你能发布一些你在前端和代码隐藏中的片段吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T18:13:08.523

```
 <cc1:ReorderList id="ReorderList1" runat="server" CssClass="Sortables" Width="400" >
                            <ItemTemplate>
                            <div class="sortablelineitem">
                            <a href="#" class="albmCvr" id="song13">
                            <img src="/images/plalbumcvr.jpg" alt="Name of Album" class="cvrAlbum" width="10"
                                height="10" />
                            Song 1 <span>by</span> Artist 1 </a>
                             <asp:ImageButton ID="ImageButton13" runat="server" ImageUrl="/images/btn_play_icon.gif"
                            ToolTip="Play Clip" CssClass="playClip" />
                             </div>
                            </ItemTemplate>
                            <EditItemTemplate>
                                <h1>WHOA THE ITEM IS BEING DRAGGED!!</h1>
                            </EditItemTemplate>
                            <ReorderTemplate>
                            <div style="width:400px; height:20px; border:dashed 2px #CCC;"></div>
                            </ReorderTemplate>
                            <DragHandleTemplate>
                            <div style="height:15px; width:15px; background-color:Black;"></div>
                            </DragHandleTemplate>
                            <EmptyListTemplate>
                            There are no items in this playlist yet...
                            </EmptyListTemplate>
                        </cc1:ReorderList>

                        </ContentTemplate>
                            </asp:UpdatePanel> 
```

是我的前端，而在后端我只是获取一个数据表对象并将其绑定到非回发的 OnLoad ...

```
ReorderList1.DataSource = ds.Tables[1];
ReorderList1.DataBind(); 
```

重新排序项目时是否需要再次设置数据源？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-09T11:38:48.297

当我试图排序的表没有分配给 DataKeyField 的初始值时，我发现了同样的错误。当它在我的测试环境中工作时，这让我把头发扯掉了，但当我把它推到现场时却没有。我还注意到它在我的网络服务器控制台上抛出了一个带有相同消息的对话框。这有一个中止/重试/忽略按钮设置，因此有效地杀死了一切。现在这只是粗鲁！

解决方案是在使用控件之前对字段值进行连续编号。

# ruby - 如何使 Ruby 的 SOAP::RPC::Driver 与自签名证书一起使用？

> ID：128660
> 
> 赞同：3
> 
> 时间：2008-09-24T17:50:46.703
> 
> 标签：ruby, soap, ssl

在对使用自签名证书的服务器进行肥皂调用时，如何防止此异常？

```
require "rubygems"
gem "httpclient", "2.1.2"
require 'http-access2'
require 'soap/rpc/driver'
client = SOAP::RPC::Driver.new( url, 'http://removed' )
client.options[ 'protocol.http.ssl_config.verify_mode' ] = OpenSSL::SSL::VERIFY_NONE
client.options[ 'protocol.http.basic_auth' ] << [ url, user, pass ]

at depth 0 - 18: self signed certificate
/opt/local/lib/ruby/1.8/soap/streamHandler.rb:200:in `send_post': 415:  (SOAP::HTTPStreamError)
    from /opt/local/lib/ruby/1.8/soap/streamHandler.rb:109:in `send'
    from /opt/local/lib/ruby/1.8/soap/rpc/proxy.rb:170:in `route'
    from /opt/local/lib/ruby/1.8/soap/rpc/proxy.rb:141:in `call'
    from /opt/local/lib/ruby/1.8/soap/rpc/driver.rb:178:in `call' 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T21:08:44.910

尝试：

```
client.options["protocol.http.ssl_config.verify_mode"] = nil 
```

# c# - 在 C# 中将字节数组保存为磁盘上的文件的最有效方法是什么？

> ID：128674
> 
> 赞同：70
> 
> 时间：2008-09-24T17:51:47.107
> 
> 标签：c#, .net

很简单的场景。我有一个 Web 服务，它接收一个字节数组，该数组将被保存为磁盘上的特定文件类型。在 C# 中执行此操作的最有效方法是什么？

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2008-09-24T17:53:48.053

那将是[`File.WriteAllBytes()`](http://msdn.microsoft.com/en-us/library/system.io.file.writeallbytes.aspx)。

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2008-09-24T17:54:11.097

`System.IO.File.WriteAllBytes(path, data)`应该做得很好。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-25T10:51:47.263

而 WriteAllBytes 只是执行

```
using (FileStream stream = new FileStream(path, FileMode.Create, FileAccess.Write, FileShare.Read))
{
    stream.Write(bytes, 0, bytes.Length);
} 
```

BinaryWriter 有一个误导性的名称，它旨在将原语编写为字节表示形式，而不是编写二进制数据。它的所有 Write(byte[]) 方法所做的就是在其使用的流上执行 Write()，在本例中为 FileStream。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-24T17:54:36.787

不确定在这种情况下您所说的“高效”是什么意思，但我会使用[System.IO.File.WriteAllBytes(string path, byte[] bytes)](http://msdn.microsoft.com/en-us/library/system.io.file.writeallbytes.aspx) - 就 LOC 而言肯定是有效的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T17:56:34.863

也许 System.IO.BinaryWriter 和 BinaryReader 类会有所帮助。

[http://msdn.microsoft.com/en-us/library/system.io.binarywriter.aspx](http://msdn.microsoft.com/en-us/library/system.io.binarywriter.aspx)

“以二进制形式将原始类型写入流，并支持以特定编码写入字符串。”

[http://msdn.microsoft.com/en-us/library/system.io.binaryreader.aspx](http://msdn.microsoft.com/en-us/library/system.io.binaryreader.aspx)

“以特定编码将原始数据类型读取为二进制值。”

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T18:18:50.367

我在将 300 MB 字节数组转储到磁盘文件时遇到了类似的问题......
我使用了**StreamWriter**，我花了 30 分钟来转储文件。
使用**FilePut**花了我大约 3-4 分钟，当我使用**BinaryWriter**时，文件在 50-60 秒内被转储。
如果您使用 BinaryWriter，您将获得更好的性能。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T18:35:33.523

实际上，最有效的方法是流式传输数据并在收到数据时将其写入。WCF 支持流式传输，因此这可能是您想要研究的内容。如果您对大文件执行此操作，这一点尤其重要，因为您几乎肯定不希望服务器和客户端上的文件内容都在内存中。

# visual-studio - 如何在 Visual Studio 2005 和 2003 中设置非管理员开发

> ID：128687
> 
> 赞同：4
> 
> 时间：2008-09-24T17:53:13.547
> 
> 标签：visual-studio, ide, visual-studio-2005, installation, visual-studio-2003

我们得到了指示，以确保在开发时我们会用完管理员和超级用户组以防止安全漏洞。需要采取哪些步骤才能使这成为可能，但仍然能够在需要时进行调试、编码和安装？

我们开发 ASP.NET 以及 VB.NET 应用程序。

谢谢！

布鲁克杰克逊

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T22:12:55.747

I have been developing a web application in a team of 5+ developers using ASP.NET 2.0 using Visual C# 2005 and Visual Web Developer 2005 for 6+ months. It was an internal application for our client and was targeted at Internet Explorer 6.0\. I have been always using a non-administrator account on my machine and have never run into any problems. Specifically, I have not experienced any problems with debugging. Right now I am switching to a Visual Studio 2008 and I hope everything will work just as it does now.

I am using a laptop for development. A the same time I am moving around and connecting to the internet in different places and I use my admin account only when necessary. I really believe that running an admin account for every day tasks is the single greatest security threat, just because it is so common.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T00:36:34.910

使用Vista，并利用UAC，因为那是UAC 允许你做的。您可以在需要时授予 VS 完全权限，以及应用程序/网站的有限权限。

我在启用 UAC 的 Vista 上运行 VS2008。我只有一个问题值得一提。

当我以提升的权限运行 VS 然后在没有它们的情况下运行它时，我偶尔会遇到奇怪的文件权限问题。VS 将无法删除旧的构建文件，但如果我从资源管理器中删除它们就可以了。同样，这只发生在提升权限和非提升权限之间切换时。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T18:01:27.880

对我来说似乎很愚蠢。以管理员/超级用户身份在本地运行 VS，使用您在网络上发布给用户所需的任何最低权限等等。

只需确保您使用 VS 创建的应用程序在没有这些额外权限的情况下仍然可以工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T17:55:43.197

[请注意，以非管理员身份运行 VS](http://msdn.microsoft.com/en-us/vs2005/aa972193.aspx)似乎存在很多问题。

# python - 在 Turbogears 中进行 CRUD

> ID：128689
> 
> 赞同：3
> 
> 时间：2008-09-24T17:53:29.863
> 
> 标签：python, crud, turbogears

在 Turbogears 框架中是否有任何好的包或方法可以进行广泛的 CRUD（创建-检索-更新-删除）接口。FastDataGrid 小部件太黑了，没有用，而且 CRUDTemplate 看起来比滚动我自己的更麻烦。想法？建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-15T15:50:29.757

你真的应该看看 sprox ( [http://sprox.org/](http://sprox.org/) )。

它建立在 RESTController 之上，非常直接，有据可查（imo），从您的数据库“神奇地”生成表单和验证，并让您编写最少的代码。我真的很喜欢和它一起工作。

希望对你有帮助:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-02T06:47:32.370

所以你需要 CRUD。实现这一点的最好方法是使用一个工具来消除所有蹩脚的代码。这个工具叫做[tgext.admin](http://www.turbogears.org/2.0/docs/main/Extensions/Admin/index.html)。但是，您可以在多个级别上使用它。

*   [Catwalk2](http://pypi.python.org/pypi/Catwalk)， tgext.admin 的默认配置，它知道您的快速启动模型。
*   [AdminController](http://www.turbogears.org/2.0/docs/main/Extensions/Admin/index.html#adding-admincontroller-to-your-tg-application)，这将获取您的所有模型（或它们的列表）并为所有模型创建 CRUD。
*   [CrudRestController](http://turbogears.org/2.0/docs/main/Extensions/Crud/index.html)将获取一个对象并为其创建 CRUD。
*   [RestController](http://turbogears.org/2.0/docs/main/RestControllers.html)将接受一个对象并只为您提供 REST API，即没有表单或数据显示。
*   普通[的 Sprox](http://sprox.org)，您将给它一个对象，并且根据您使用的基类，您将获得 neww 表单或编辑或表格视图或单个记录视图。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T16:56:35.720

在进行了更多的挖掘和修改之后，将 Cakewalk 接口放入应用程序并不是很困难。如果没有大量工作，它并不漂亮，但它可以立即工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-27T01:30:15.043

虽然[CRUDTemplate](http://docs.turbogears.org/1.0/CRUDTemplate)看起来有点复杂，但我想说您可以使用您选择的任何 ORM 来实现 CRUD/ABCD。这仅取决于您要自动化多少（这通常意味着提前定义模型/模式）。如果您使用 SQLAlchemy 或 SQLObject 将您自己的东西放在一起，您可能会学到更多并拥有更好的控制，这些都与 TurboGears 配合得很好。

# java - 可视化 GML 片段的最佳 Java 开源工具包

> ID：128699
> 
> 赞同：4
> 
> 时间：2008-09-24T17:54:33.327
> 
> 标签：java, gml

我正在寻找一种方法来可视化我收到的一段 GML。用于此任务的最佳免费 Java 库是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T21:19:34.020

[GeoTools](http://geotools.codehaus.org/)提供了一个用于读取 GML 文件的库。它们还提供 UI 组件，用于显示其库支持的地理空间格式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-09T03:38:08.790

警告您 GML 实际上并没有定义文件格式。它为定义您自己的 xml 模式提供了一个抽象的起点。我们使用模式来整理出哪些 xml 元素映射到哪些 Java 类（因此日期显示为 Date，几何显示为 JTS Geometry，等等......）。

这对只提供 GML“文件”的人造成了足够的悲痛。我最近向 GeoTools 添加了一个实用程序类（称为 GML），它将假定任何未定义的元素都是一个字符串。

以下是测试用例的示例：

```
 URL url = TestData.getResource(this, "states.gml");
        InputStream in = url.openStream();

        GML gml = new GML(Version.GML3);
        SimpleFeatureCollection featureCollection = gml.decodeFeatureCollection(in); 
```

您可以获取生成的 featureCollection 并使用 JMapPane 类，如 GeoTools 快速入门中所示：

```
 MapContext map = new DefaultMapContext();
    map.setTitle("Quickstart");
    map.addLayer(featureCollection, null);

    // Now display the map
    JMapFrame.showMap(map); 
```

# diagramming - 软件系统图表的最佳工具

> ID：128710
> 
> 赞同：15
> 
> 时间：2008-09-24T17:56:13.243
> 
> 标签：diagramming

多年来，我多次尝试为一些基本的软件系统图表找到一个好的、易于使用的、跨平台的工具。我尝试过的 UML 工具对我的阻碍似乎不仅仅是帮助。到目前为止，我一直返回的解决方案是 Visio，它既仅限 Windows，又昂贵。虽然它远非理想，但它确实提供了一些基本的构建块，并允许网格放置和缩放等事情。我想看看是否有一个很棒的工具，我只是想念它，它至少符合提到的一些标准。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T18:07:09.333

[Graphviz](http://www.graphviz.org/) FTW！

有什么比编写文本文件以转换为图表等更核心的...

GUI，我们不需要臭的 GUI！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T18:01:22.967

你可以试试 DIA，虽然它有点基础，但在做纯图表时它不会妨碍你。

[http://www.gnome.org/projects/dia/](http://www.gnome.org/projects/dia/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T18:06:42.390

好吧，我猜你的意思是Windows。否则对于 Mac，我所知道的一切都无法击败[OmniGraffle](http://www.omnigroup.com/applications/OmniGraffle/)。我的祖母不仅可以轻松使用它，而且它实际上可以制作非常“漂亮”的图表。它真的不太贵（第 5 版现在是 99 美元，但以前的版本不到 40 美元；仍然有一个便宜的），它可以做所有事情，网络图、流程图、UML 图、UI 模型等。该应用程序很聪明，它以某种方式为您着想，例如，它会检测您尝试将对象对齐在一条线上或它们之间具有相等的空间，并为您提供暗示拖放以确保满足这些标准。正如我所说，与 OG 合作真的很容易。

它甚至还可以现有的 Xcode 项目（程序员的标准 Mac IDE）并自动从您的源代码生成图形。只需将您的 Xcode 项目拉到图标上即可获得完整的 UML 图表 :-) 我想如果他们可以将其移植到 Linux 或 Windows 会很棒，但我担心它永远不会发生。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T18:11:47.557

Enterprise Architect ( [http://sparxsystems.com](http://sparxsystems.com) ) 是最好的而且非常实惠。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T18:00:29.177

我用过[Edge Diagrammer](http://www.pacestar.com/edge/index.html) ...它可以简单快速地完成您想要的工作。支持网格放置和缩放。它仅适用于 Windows，而且价格比我记忆中的要贵，但仍然比 Visio 便宜。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T18:03:10.667

我喜欢 Visio

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T18:07:18.037

如果你必须使用软件，Visio 是我的最爱。（我通过学校的 CS 项目免费获得）

但是...我发现最好的工具是 17" x 11" 的画板，它肯定是为艺术家制作的，但没有什么比一张大纸更能解决设计问题的了。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T18:08:50.997

根据我的经验，最有效的图表是在白板上完成的。

不过，我在 Visio 中捕获了它，它比其他任何人都拥有更多的工具和形状，并且您可以扩展它来进行代码生成。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-24T20:38:54.490

有时我使用[yEd](http://www.yworks.com/en/products_yed_about.html "是的")。它是一个图形编辑器，但它完全可以用作图表工具。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T17:59:40.147

[MagicDraw](http://www.magicdraw.com/)是相当不错的恕我直言。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T18:04:23.270

我知道的最好的免费解决方案是[Dia](http://www.gnome.org/projects/dia/)。它作为休闲 Visio 替代品销售。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-24T18:07:01.517

还有[Kivio](http://www.koffice.org/kivio/)，我听说过好东西，但没有亲自使用过。那是多平台和免费的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-15T18:03:42.203

我的大部分图表都使用[Violet UML Editor 。](http://alexdp.free.fr/violetumleditor/page.php)它没有乱七八糟的代码逆向工程和代码生成功能，使创建优雅的简单图表变得非常容易。最棒的是它是免费的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-07-06T15:39:04.267

TopCased [http://www.topcased.org/index.php](http://www.topcased.org/index.php)

BOUML：[http ://bouml.free.fr/index.html](http://bouml.free.fr/index.html)

# c - 有没有办法让类变量像虚拟变量一样带有 setter/getter？

> ID：128718
> 
> 赞同：2
> 
> 时间：2008-09-24T17:57:23.367
> 
> 标签：c, ruby, api

我将 Ruby 嵌入到我的 C 项目中，并希望加载几个文件，这些文件定义了从我自己的父类继承的类。每个继承的类都需要在初始化时设置一些变量，我不想为 Ruby 和 C 设置两个不同的变量。

有没有办法定义一个具有自己的自定义 setter/getter 的类变量，或者这是一种愚蠢的处理方式？也许使用自定义数据类型会更好？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-26T22:35:53.387

我不确定你在问什么。当然，类变量可以有 getter 和 setter（在幕后你可以以任何你喜欢的方式存储值）。这个片段是否有助于说明任何事情？

```
>> class TestClass
>>   def self.var
>>     @@var ||= nil
>>   end
>>   def self.var=(value)
>>     @@var = value
>>   end
>> end
=> nil
>> 
?> TestClass::var
=> nil
>> TestClass::var = 5
=> 5
>> TestClass::var
=> 5 
```

如果你对整个元编程感兴趣，你可以实现一个类似于 attr_accessor 方法的[class_attr_accessor](http://ruby-doc.org/core/classes/Module.html#M001704)方法。下面等价于上面的代码。

```
class Module
  def class_attr_accessor(attribute_name)
    class_eval <<-CODE
      def self.#{attribute_name}
        @@#{attribute_name} ||= nil
      end
      def self.#{attribute_name}=(value)
        @@#{attribute_name} = value
      end
    CODE
  end
end

class TestClass
  class_attr_accessor :var
end 
```

# keyboard - 科技主题礼篮

> ID：128719
> 
> 赞同：-1
> 
> 时间：2008-09-24T17:57:31.930
> 
> 标签：keyboard, mouse, media

对于今年的客户服务周，我有一项特权任务是创建一个以科技为主题的礼品篮。我试图将篮子保持在 50 美元以下，因为我有一个蓝牙键盘/鼠标组合，我将添加到它。除了罐装空气和显示器湿巾，对于基于 PC 的篮子还有其他建议吗？我在考虑 USB 拇指驱动器和/或空白 CD/DVD 媒体。还有其他想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T18:01:02.983

LED手电筒和多功能工具。您永远不会拥有太多的 LED 手电筒和多功能工具！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T18:02:19.157

这可能会使您超出预算，但我肯定会查看 www.thinkgeek.com。他们有很多非常有趣和现成的礼物，比如含咖啡因的肥皂、有趣的 T 恤、笔式驱动器等。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T18:10:36.017

如果您正在为帮助台/客户服务代表寻找礼物，那么这些都很好。

*   一个远程电击设备，可以在电话的另一端发出 id10ts 的嗡嗡声。
*   杀人执照。
*   当呼叫者被搁置时，David Spade 没有做任何广告的录音。
*   [（为男生）娜塔莉·波特曼、罗宾·佩奇 ( http://www.simple-talk.com/author/robyn-page/](http://www.simple-talk.com/author/robyn-page/) ) 或莎拉·奇普斯 ( [http://girldeveloper.com/](http://girldeveloper.com/) )的高质量照片

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T18:00:11.673

我非常想要来自[http://www.thinkgeek.com的一切](http://www.thinkgeek.com)

# backup - AIX 5.3：如何将整机备份到单个可引导磁带？

> ID：128783
> 
> 赞同：0
> 
> 时间：2008-09-24T18:03:48.920
> 
> 标签：backup, aix, bootable

是否可以使用 AIX 的 mksysb 和 savevg 创建带有 rootvg 的可引导磁带，然后附加所有其他 VG？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-24T16:17:25.013

回答我自己的问题：

要备份，请使用与此类似的脚本：

```
tctl -f/dev/rmt0 倒带
/usr/bin/mksysb -p -v /dev/rmt0.1
/usr/bin/savevg -p -v -f/dev/rmt0.1 vg01
/usr/bin/savevg -p -v -f/dev/rmt0.1 vg02
/usr/bin/savevg -p -v -f/dev/rmt0.1 vg03
   ...ETC...
tctl -f/dev/rmt0 倒带

```

注意：
- mksysb 备份 rootvg 并创建可引导磁带。
- 使用“rmt0.1”可防止操作后自动倒带。

此外，mkszfile 和 mkvgdata 以前用于创建“image.data”和各种“vgdata”和地图文件。我这样做是因为我的系统运行所有镜像的磁盘，并且我希望能够在只有一半磁盘数量的情况下进行恢复。我所有的 image.dat、vgdata 和 map 文件都是未镜像的，以便在还原期间提供更大的灵活性。

要恢复，过程如下：

对于 rootvg，从磁带引导并按照屏幕提示操作（正常的 mksysb 恢复）。

对于其他卷组，它是这样的：

```
tctl -f/dev/rmt0.1 倒带
tctl -f/dev/rmt0.1 fsf 4
restvg -f/dev/rmt0.1 hdisk[n]

```

“fsf 4”将把磁带放在 mksysb 备份后第一个保存的 VG 上。第二个使用“fsf 5”，第三个使用“fsf 6”，依此类推。

如果restvg 抱怨缺少磁盘，您可以添加“-n”标志以放弃“exact map”默认参数。

如果你需要恢复单个文件，你可以这样做：

```
tctl -f/dev/rmt0 倒带
恢复 -x -d -v -s4 -f/dev/rmt0.1 ./[路径]/[文件]

```

“-s4”是rootvg，替换为“-s5”代表第一个VG，“-s6”代表第二个等。文件恢复到您当前的文件夹中。

这种技术为您提供了一个可用于恢复任何单个文件或文件夹的磁带；也可用于从头开始完全重建您的系统。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T21:01:21.783

首先，使用 savevg 将任何额外的卷组备份到 rootvg 上的文件系统：

```
savevg -f /tmp/vgname 
```

如果它太大，请压缩它，或使用 -i 选项排除文件。最简单的方法是排除卷组上的所有文件并从常规备份设备中恢复这些文件。完成后，创建您的正常 mksysb。

出于 DR 目的，使用 mksysb 恢复系统，然后使用 restvg 从备份文件中恢复卷组。恢复任何可能已被排除的额外文件，然后您将再次运行。

# xml - Web 服务框架与基于 HTTP 协议的自定义 XML？

> ID：128789
> 
> 赞同：1
> 
> 时间：2008-09-24T18:05:18.213
> 
> 标签：xml, web-services

我正在寻找有关何时使用 Web 服务框架与使用 XML over HTTP 进行通信的文档完善的自定义协议的**具体指南。**

我不太关心性能，而是关心客户端和服务器端代码的可维护性和易于开发。例如，我可以开发一个自定义协议来处理 XML，而无需编写 Web 服务框架似乎需要的大量描述符文件。

请列出Web 服务带来的**具体功能。**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T18:14:21.203

WS 的优势通常来自生成客户端、服务器存根和描述符的工具支持，以及安全、加密和其他可扩展性等管道优势。如果没有工具，滚动和处理 WS 请求的负担很重，而且对结果的价值相对较低。

如果您没有工具，IMO - 这两种方法似乎都需要很高的维护成本。选择最短路径。如果您确实有工具支持，请走 WS 路线，让工具完成繁重的工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T18:08:45.973

RESTful Web 服务是非常低俗的。如果像[Atom Publishing Protocol](http://en.wikipedia.org/wiki/AtomPub)之类的东西适合您，那么我会采取这种方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T18:16:25.863

如果您没有性能问题或其他怀疑 WS 无法完成这项工作，您为什么要考虑重新发明轮子？

对于客户来说，这将（在大多数情况下）是使用您的服务的最简单方法。

无论如何（至少在 .NET 世界中）描述符文件都应该从服务器处理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T18:22:48.983

这是经典的构建与购买问题。即使框架是免费的，也需要在学习和配置方面进行投资。收购的框架具有规模经济，因为它会从维护它的实体那里获得增强，但你并没有推动这个过程。它可能会添加您想要的功能，或者破坏您的代码的功能，您无法提前知道。建立自己意味着启动时间和以后的维护。根据您的劳动力，专家可能会继续前进，并且随着代码变得陈旧，维护它的知识也将如此。这个问题有很多优点和缺点，在选择方向之前你应该考虑所有这些。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T19:06:54.447

I would say it's a good idea to design the business logic with the ability to plug in different access methods or frameworks at a later time. It is not unheard of to have different end users that want/require different access methods (say SOAP, REST or some other technique that hasn't been invented yet).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T19:11:37.697

We make heavy use of internal web services between our production systems, and they are all vanilla XML-over-HTTP, no SOAP in sight. We found that the cumbersome nature of WS stacks, even the better ones like XFire, just wasn't worth it.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T19:47:00.077

I've been on the client side before of a web service that was just XML sent over HTTP. I found it pretty straightforward to work with. I used [JiBX](http://jibx.sourceforge.net/) to create my XML requests from a Java object and unpacked the XML response to a Java object using JiBX too.

# routing - 搜索页面的漂亮 URL

> ID：128796
> 
> 赞同：9
> 
> 时间：2008-09-24T18:06:42.767
> 
> 标签：routing

我真的很喜欢拥有“漂亮”的 URL（例如`/Products/Edit/1`，而不是`/products.aspx?productID=1`），但是对于让您通过大量变量进行搜索的页面，我不知道如何做到这一点。

例如，假设您有一个页面，允许用户搜索具有特定名称和特定地址附近的特定类型的所有产品。你会用很长的“漂亮”网址来做这件事吗

```
/Products/Search/Type/{producttype}/Name/{name}/Address/{address} 
```

或者只是诉诸使用 url 参数

```
/Products/Search?productType={producttype}&name={name}&address={address} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T18:27:26.570

这个问题主要是关于 URL 设计的，只是偶然地关于重写。一旦你将你的 URL 设计的[很酷](http://www.w3.org/Provider/Style/URI)，有很多方法可以让它们工作，包括在服务器级别重写或使用基于 URL 调度的 web 框架（我认为现在大多数现代 web 框架都这样做）。

美丽在情人眼中，但我同意你的观点，很多搜索网址都很丑陋。是什么让他们如此？我认为使 URL 变得丑陋的主要因素是 URL 中的杂乱无章，它没有添加语义含义，而是实现细节的结果，例如 (.aspx) 或其他扩展。我的规则是，如果一个 URL 返回 (X)HTML，那么它不应该有扩展名，否则它应该有。

在搜索的情况下，事实是标准搜索语法确实增加了含义：它表明该页面是一个搜索，它表明参数已命名且可重新排序。丑陋主要来自？像蜘蛛、缓存代理服务器或其他东西。

因此，请仔细考虑不使用标准语法，并确保您有充分的理由这样做。我认为，如果您的参数具有自然顺序*并且*必须全部定义以使搜索有意义*且*紧凑，您可以将其推送到 URL 中。例如，在博客 URL 中，您可能有：

```
/weblog/entries/2008
/weblog/entries/2008/11
/weblog/entries/2008/11/22 
```

对于分别定义 2008 年、2008 年 11 月和 2008 年 11 月 22 日的条目的搜索。您的 URL 应该是唯一且明确的；有时人们会输入 /-/ 来查找缺少的搜索参数，我认为这非常紧凑。但是，我会避免将可能很长的参数（例如自由格式的文本查询）推送到 URL 中。/weblog/entries/ contains/here%20is%20some%20freeform%20text%20blah%20blah 并不比使用查询语法更具吸引力。

如果您打算使用标准查询语法，那么选择有意义的参数名称*可能会*在一定程度上提高吸引力。products/search?description="blah" 虽然更长，但可能比 products/search?q="blah" 更好。在这一点上，我认为收益递减。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T18:20:48.783

您可以获得“漂亮”的网址，但不是通过最漂亮的方式..

您可以将您的网址设置为：

```
/Products/Search/Type/{producttype}/Name_{name}/Address_{address} 
```

然后是[mod_rewrite](http://www.workingwith.me.uk/articles/scripting/mod_rewrite)规则，例如：

```
RewriteRule ^Products/Search/Type/([a-z]+)(.*)?$ product_lookup.php?type=$1&params=$2 [NC,L] 
```

这将在您的`product_lookup`文件中为您提供 2 个参数：

```
$type = {producttype}
$params = "/Name_{name}/Address_{address}" 
```

然后，您可以在`product_lookup.php`文件中实现一些逻辑以循环`$params`，将其拆分为“/”，根据“_”之前的任何内容对其进行标记，然后在搜索中正常使用结果参数，例如

```
// Split request params first on /, then figure out key->val pairs
$query_parts = explode("/", $params);
foreach($params as $param)
{
    $param_parts = explode("_", $param);
    // Build up associative array of params
    $query[$param_parts[0]] = $param_parts[1];
}
// $query should now contain the search parameters in an assoc. array, e.g.
// $query['Name'] = {name}; 
```

将参数设置为“漂亮”的 url 而不是 POST 可以让用户更轻松地为特定搜索添加书签。

这方面的一个例子是 `[http://www.property.ie/property-for-sale/dublin/ashington/price_200000-550000/beds_1/](http://www.property.ie/property-for-sale/dublin/ashington/price_200000-550000/beds_1/)` - 用户选择的参数由“_”（价格范围和床位）表示，可以在内部翻译成您需要的任何参数格式，同时保持一个很好的可读 url。

上面的代码是一个没有错误检查（输入中的恶意分隔符等）的简单示例，但应该让您知道从哪里开始。

它还假设了一个 LAMP 堆栈（用于 mod_rewrite 和 PHP 的 Apache），但可以使用 asp.net 和[IIS mod_rewrite 等效的](https://stackoverflow.com/questions/60857/modrewrite-equivalent-for-iis-70).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T18:14:26.023

MVC（模型视图控制器）框架是专门为解决这个问题而设计的。它使用一种 url 重写的形式将操作重定向到页面，并仅提供您正在寻找的功能。它使处理漂亮的网址变得轻而易举。

关于 URL 的长度，id 仍然使用漂亮的 url，但特别长的 URL 可能表明您可能需要重新考虑您的项目分组，如果您愿意，请更改分类 Products/{NAME}/{Address}没有中间网址部分。

MVC 框架的示例可以在以下位置找到：

.Net - [http://www.asp.net/mvc/](http://www.asp.net/mvc/)

PHP - [http://www.phpmvc.net/](http://www.phpmvc.net/)

Java - [http://struts.apache.org/](http://struts.apache.org/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T18:16:49.667

我们有类似的 url 重写，并且使用 IIS 6，我们将重定向定义为：

/content.aspx?url=$S&$P

这需要表单的 url

/content/page/press_room 并使其格式为

/content.aspx/url=/page/pressroom&

我不确定 IIS 有完整的 synyax 选项，但我确定你想要的可以用类似的方式完成。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T18:20:00.940

如前所述 - 使用 HTTP Post 是最好的，但是您将失去人们将链接发送给人们/将其添加书签的能力。将查询字符串留在 URL 中并不会太糟糕。我已经设置好了，所以 url 字符串是这样的：

`http://example.com/search/?productType={producttype}&name={name}&address={address}`

然后对搜索结果进行分页，在查询字符串之前添加页码（因此如果需要，可以自定义查询字符串。

*   第 1 页： [http](http://example.com/search/?productType=) ://example.com/search/ ?productType= {producttype}&name={name}
*   第 2 页： [http](http://example.com/search/2/?productType=) ://example.com/search/2/ ?productType= {producttype}&name={name}
*   第 3 页： [http](http://example.com/search/3/?productType=) ://example.com/search/3/ ?productType= {producttype}&name={name}

ETC...

归根结底 - 搜索之王“谷歌”不介意将查询字符串留在 URL 中，因此不会太糟糕 :)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T18:18:20.773

**您可以在此处找到有关.NET 中路由**的答案：

[在 ASP.Net 中实现动态 URL 重写的最佳方法是什么？](https://stackoverflow.com/questions/125826/what-is-the-best-method-to-achieve-dynamic-url-rewriting-in-aspnet#126426)

在那里，您可以找到有关该主题的不同资源。

# vb.net - 将 COM 组件引用添加到 VB.NET 项目时出现问题

> ID：128807
> 
> 赞同：2
> 
> 时间：2008-09-24T18:08:24.837
> 
> 标签：vb.net, visual-studio, com, dll, reference

我有一个第三方 COM dll 正在尝试添加到 vb.net (2008 express) 项目中。我将 dll 放入 C:\WINDOWS\system32\ 并使用“regsvr32 vxncom.dll”注册它。当我转到项目 > 添加参考并转到 COM 选项卡时，它会显示在可用组件/库的列表中。但是，当我选择库并点击确定时，Visual Studio 会抱怨：“无法添加对‘vxncom 4.0 库’的引用。无法注册 ActiveX 类型库‘C:\WINDOWS\system32\vxncom.dll’。”

我正在做的项目是分发 dll 的人提供的一个示例。当我启动一个新的（空白）vb.net 项目时，该组件也无法添加。

更新 1：

我在有问题的 dll 上运行了dependency walker，这是我在错误日志中得到的内容：

**错误：由于隐式依赖模块中缺少导出函数，至少一个模块具有未解析的导入。**

有问题的模块似乎是 libeay32.dll，但它已经存在于 C:\WINDOWS\system32 中。

更新 2：

我去了[openssl 站点](http://www.slproweb.com/products/Win32OpenSSL.html)并下载并使用他们的安装程序来更新 libeay32.dll。我在 vxncom.dll 上再次运行了dependency walker，没有错误。回到视觉工作室，它仍然不想添加参考。与之前完全相同的错误。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T18:35:32.290

也许 DLL VB 正在尝试注册取决于另一个不存在的 DLL。[您可以使用来自http://www.dependencywalker.com/](http://www.dependencywalker.com/)的免费 Dependency Walker 工具来确认（或排除）

对更新 1 的响应：听起来您的系统上安装的 libeay32.dll 版本与您的组件所期望的版本不匹配——这取决于您的组件正在寻找不存在的功能。我会检查 libeay32 的版本号，然后联系供应商并询问他们支持哪些版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-09T13:00:27.497

只是一个想法 - 如果您使用 tlbimp.exe 创建自己的 PIA，而不是依靠 IDE 为您完成，您可能会收到更详细的错误消息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-20T21:13:58.650

假设您尚未修复它或已转向替代方案；继 jeffm 的回答之后，libeay32.dll 是否已在操作系统中正确注册？重新安装/修复通常可以解决这类问题（我在 MS Office 和 MapPoint 中看到了很多，其中 COM 对象偶尔会出于某种原因注销自己。）

# python - Django 是否支持多值 cookie？

> ID：128815
> 
> 赞同：2
> 
> 时间：2008-09-24T18:09:14.303
> 
> 标签：python, django, cookies

我想通过 Django 设置一个 cookie，它有几个不同的值，类似于 .NET 的[HttpCookie.Values](http://msdn.microsoft.com/en-us/library/system.web.httpcookie_members(VS.80).aspx)属性。查看[文档](http://docs.djangoproject.com/en/dev/ref/request-response/#django.http.HttpResponse.set_cookie)，我不知道这是否可能。看起来它只需要一个字符串，那么还有其他方法吗？

我尝试将数组 ( `[10, 20, 30]`) 和字典 ( `{'name': 'Scott', 'id': 1}`) 传递给它，但它们只是被转换为它们的字符串格式。我目前的解决方案是只使用任意分隔符，然后在读入时解析它，这感觉很恶心。如果多值是不可能的，有没有更好的方法？我宁愿不要使用大量的 cookie，因为那样会很烦人。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T18:35:11.277

.NET 多值 cookie 的工作方式与您在 django 中使用分隔符的方式完全相同。他们只是为您抽象了这些内容。您所做的一切都很好，而且我认为 Django 没有任何特定的东西可以“解决”这个问题。

我会说你在做正确的事，不使用多个 cookie。通过做你正在做的事情来降低网络开销。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T01:44:18.767

如果您正在寻找更抽象的东西，请尝试使用[sessions](http://docs.djangoproject.com/en/dev/topics/http/sessions/#examples)。我相信它们的工作方式是在 cookie 中存储一个与数据库记录匹配的 id。您可以在其中存储任何您想要的东西。它与您正在寻找的内容并不完全相同，但如果您不介意少量的数据库开销，它可能会起作用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-04T23:24:10.510

**（迟到的答案！）**

这会更笨重，但你调用总是使用 python 的内置序列化。

你总是可以做类似的事情：

```
import pickle
class MultiCookie():
    def __init__(self,cookie=None,values=None):
        if cookie != None:
            try:
                self.values = pickle.loads(cookie)
            except:
                # assume that it used to just hold a string value
                self.values = cookie
        elif values != None:
            self.values = values
        else:
            self.values = None

    def __str__(self):
        return pickle.dumps(self.values) 
```

然后，您可以获取 cookie：

```
newcookie = MultiCookie(cookie=request.COOKIES.get('multi'))
values_for_cookie = newcookie.values 
```

或设置值：

```
mylist = [ 1, 2, 3 ]
newcookie = MultiCookie(values=mylist)
request.set_cookie('multi',value=newcookie) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T21:03:05.370

Django 不支持它。最好的方法是用任意分隔符分隔值，然后只拆分字符串，就像你已经说过的那样。

# javascript - Visual Studio 2008 中的 JavaScript 智能感知

> ID：128816
> 
> 赞同：5
> 
> 时间：2008-09-24T18:09:14.787
> 
> 标签：javascript, visual-studio-2008

在 Visual Studio 2008 中充分利用 JavaScript 智能感知选项，你们有什么技巧或窍门吗？

Visual Studio 向我展示了“命名空间”并使用了文档功能（`<param>`和`<summary>`）。但是，我无法使`<return>`文档功能正常工作。

现在，这一切都很好。但是当我调用一个特权函数时，Visual Studio 不知道它，因此我没有得到任何文档。

有什么方法可以将公共变量和特权函数公开给 Visual Studios 智能感知功能，同时仍然创建具有私有成员的对象？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T18:29:21.807

就识别函数成员而言，Javascript Intellisense 绝对是不稳定的。我使用原型范例取得了一些成功，所以你可以检查一下。但很多时候，我发现它仍然不能可靠地列出 Intellisense 中的函数。
编辑：正如原始海报在下面的评论中建议的那样，在原型模型中获得相同的“私有”功能是不可能的*。*Javascript 没有私有成员的概念，但是您可以通过在函数构造函数中声明它们来模拟成员隐私和闭包。这意味着如果你有需要访问成员的函数，它们也必须在构造函数中，所以它们不能是原型。
因此，虽然使用原型模型可能（或可能不会）为您提供更好的 VS Intellisense，但它仅对影响公共成员的公共函数有用，不能用于改进私有或特权函数的智能感知。无论如何，您可能不想要智能感知的私有功能，但您可能会拥有特权。

# c# - 为什么 try {...} finally {...} 好；尝试 {...} catch{} 不好？

> ID：128818
> 
> 赞同：204
> 
> 时间：2008-09-24T18:10:23.100
> 
> 标签：c#, .net, exception-handling, try-catch, try-catch-finally

我见过有人说不带参数使用 catch 是不好的形式，特别是如果那个 catch 没有做任何事情：

```
StreamReader reader=new  StreamReader("myfile.txt");
try
{
  int i = 5 / 0;
}
catch   // No args, so it will catch any exception
{}
reader.Close(); 
```

但是，这被认为是好的形式：

```
StreamReader reader=new  StreamReader("myfile.txt");
try
{
  int i = 5 / 0;
}
finally   // Will execute despite any exception
{
  reader.Close();
} 
```

据我所知，将清理代码放在 finally 块中和将清理代码放在 try..catch 块之后的唯一区别是，如果你的 try 块中有 return 语句（在这种情况下，finally 中的清理代码将运行，但 try..catch 之后的代码不会）。

不然最后有什么特别的？

* * *

## 回答 #1

> 赞同：365
> 
> 时间：2008-09-24T18:12:51.533

最大的区别是它`try...catch`会吞下异常，隐藏发生错误的事实。`try..finally`将运行您的清理代码，然后异常将继续运行，由知道如何处理它的东西处理。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-09-24T18:12:34.950

“最后”是“您必须始终做的事情以确保程序状态正常”的声明。因此，如果有任何异常可能会抛出程序状态，那么拥有一个总是一种很好的形式。编译器还竭尽全力确保您的 finally 代码运行。

“Catch”是“我可以从这个异常中恢复”的声明。你应该只从你真正可以纠正的异常中恢复——不带参数的 catch 说“嘿，我可以从任何事情中恢复！”，这几乎总是不正确的。

*如果*有可能从每个异常中恢复，那么这真的是一个语义上的狡辩，关于你声明你的意图是什么。然而，事实并非如此，而且几乎可以肯定，您的框架之上的框架将能够更好地处理某些异常。因此，使用 finally，让您的清理代码免费运行，但仍然让更多知识渊博的处理程序处理该问题。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2008-09-24T18:14:23.900

因为当单行抛出异常时，您不会知道。

使用第一块代码，异常将被简单地**吸收**，即使程序状态可能错误，程序也会继续执行。

对于第二个块，将**抛出异常**并冒泡，但*仍*`reader.Close()`保证运行。

如果没有预料到异常，那么不要这样放置 try..catch 块，当程序进入错误状态并且您不知道原因时，以后将很难调试。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-09-24T18:14:50.907

finally 无论如何都会执行。因此，如果您的 try 块成功，它将执行，如果您的 try 块失败，它将执行 catch 块，然后执行 finally 块。

此外，最好尝试使用以下构造：

```
using (StreamReader reader=new  StreamReader("myfile.txt"))
{
} 
```

由于 using 语句自动包装在 try / finally 中，并且流将自动关闭。（如果您想实际捕获异常，则需要在 using 语句周围放置一个 try / catch）。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-24T20:55:21.970

虽然以下 2 个代码块是等价的，但它们并不相等。

```
try
{
  int i = 1/0; 
}
catch
{
  reader.Close();
  throw;
}

try
{
  int i = 1/0;
}
finally
{
  reader.Close();
} 
```

1.  'finally' 是意图揭示代码。您向编译器和其他程序员声明此代码无论如何都需要运行。
2.  如果你有多个 catch 块并且你有清理代码，你需要 finally。如果没有 finally，您将在每个 catch 块中复制您的清理代码。（干燥原理）

finally 块是特殊的。CLR 将 finally 块与 catch 块分开识别和处理代码，并且 CLR 竭尽全力保证 finally 块将始终执行。它不仅仅是来自编译器的语法糖。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-24T18:28:06.740

我同意这里似乎达成的共识——空的“catch”是不好的，因为它掩盖了 try 块中可能发生的任何异常。

另外，从可读性的角度来看，当我看到一个“try”块时，我假设会有一个相应的“catch”语句。如果您只使用“尝试”以确保在“最终”块中取消分配资源，则可以考虑使用[“使用”语句](http://msdn.microsoft.com/en-us/library/yh598w02(VS.80).aspx)：

```
using (StreamReader reader = new StreamReader('myfile.txt'))
{
    // do stuff here
} // reader.dispose() is called automatically 
```

您可以对任何实现 IDisposable 的对象使用“使用”语句。对象的 dispose() 方法在块结束时自动调用。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-09-20T05:56:32.500

如果`Try..Catch..Finally`您的方法知道如何在本地处理异常，请使用 。异常发生在 Try 中，在 Catch 中处理，然后在 finally 中完成清理。

如果您的方法不知道如何处理异常，但一旦发生就需要清理，请使用`Try..Finally`

这样，如果调用方法中有任何合适的 Catch 语句，异常就会传播到调用方法并进行处理。如果当前方法或任何调用方法中没有异常处理程序，则应用程序崩溃。

通过`Try..Finally`确保在将异常传播到调用方法之前完成本地清理。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-24T18:16:01.010

try..finally 块仍然会抛出任何引发的异常。`finally`所做的只是确保在引发异常之前运行清理代码。

带有空 catch 的 try..catch 将完全消耗任何异常并隐藏它发生的事实。读者将被关闭，但不知道是否发生了正确的事情。如果您的意图是将*i*写入文件怎么办？在这种情况下，您将无法访问该部分代码，并且*myfile.txt*将为空。所有下游方法都正确处理了吗？当您看到空文件时，您是否能够正确猜测它是空的，因为抛出了异常？最好抛出异常并让它知道你做错了什么。

另一个原因是这样的 try..catch 是完全不正确的。你这样做的意思是，“无论发生什么，我都能应付。” 怎么样`StackOverflowException`，那你能清理干净吗？怎么样`OutOfMemoryException`？通常，您应该只处理您期望并知道如何处理的异常。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-24T18:13:20.737

如果您不知道要捕获什么异常类型或如何处理它，那么使用 catch 语句是没有意义的。你应该把它留给可能有更多关于这种情况的信息的上级来电者知道该怎么做。

如果出现异常，您仍然应该有一个 finally 语句，以便您可以在该异常被抛出给调用者之前清理资源。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-24T18:14:15.993

从可读性的角度来看，它更明确地告诉未来的代码阅读者“这里的东西很重要，无论发生什么都需要完成。” 这很好。

此外，空的 catch 语句往往对它们有某种“气味”。它们可能表明开发人员没有考虑可能发生的各种异常以及如何处理它们。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-24T18:14:39.597

finally 是可选的——如果没有要清理的资源，就没有理由设置“Finally”块。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-24T18:14:42.823

取自：[这里](http://www.experts-exchange.com/Programming/Languages/C_Sharp/Q_21336581.html)

引发和捕获异常不应作为成功执行方法的一部分而经常发生。在开发类库时，必须让客户端代码有机会在执行可能导致引发异常的操作之前测试错误情况。例如，System.IO.FileStream 提供了一个 CanRead 属性，可以在调用 Read 方法之前对其进行检查，从而防止引发潜在的异常，如下面的代码片段所示：

Dim str As Stream = GetStream() If (str.CanRead) Then '读取流的代码 End If

在调用可能引发异常的特定方法之前是否检查对象状态的决定取决于对象的预期状态。如果使用应该存在的文件路径和应该以读取模式返回文件的构造函数创建 FileStream 对象，则不需要检查 CanRead 属性；无法读取 FileStream 将违反所进行的方法调用的预期行为，并且应该引发异常。相反，如果方法被记录为返回可能或可能不可读的 FileStream 引用，建议在尝试读取数据之前检查 CanRead 属性。

为了说明使用“运行直到异常”编码技术可能导致的性能影响，将在转换失败时抛出 InvalidCastException 的转换的性能与 C# as 运算符进行比较，如果转换失败则返回空值。这两种技术的性能在强制转换有效的情况下是相同的（参见测试 8.05），但是对于强制转换无效并且使用强制转换导致异常的情况，使用强制转换比使用作为操作员（见测试 8.06）。抛出异常技术的高性能影响包括分配、抛出和捕获异常的成本以及异常对象后续垃圾回收的成本，这意味着抛出异常的瞬时影响并没有这么高。随着更多的异常被抛出，

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-09-27T12:48:15.527

添加一个 catch 子句只是为了重新抛出异常是不好的做法。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-04-29T10:33:10.840

如果你[为程序员阅读 C#，](https://books.google.com.ph/books?id=euV7e2f-RzsC&pg=PA443&lpg=PA443&dq=throwing%20exception%20memory%20leak%20C%23&source=bl&ots=LEya1iGiLH&sig=G6ALwAG6X8WrJ4EIOpJD8en8EKc&hl=en&sa=X&ved=0ahUKEwjc17H_u_vLAhWHGpQKHSZqAhcQ6AEISTAH#v=onepage&q=throwing%20exception%20memory%20leak%20C%23&f=false)你就会明白，finally 块是为了优化应用程序和防止内存泄漏而设计的。

> CLR 不能完全消除泄漏...如果程序无意中保留对不需要的对象的引用，可能会发生内存泄漏

例如，当您打开文件或数据库连接时，您的机器将分配内存来满足该事务，并且除非执行了弃置或关闭命令，否则不会保留该内存。`try.. finally..`但是如果在交易过程中发生了错误，除非它在块内，否则将不会终止进行中的命令。

`catch`不同于从`finally`某种意义上说，catch 的设计目的是让你有方法来处理/管理或解释它自己的错误。把它想象成一个告诉你“嘿，我抓到了一些坏人，你想让我对他们做什么？”的人。while`finally`旨在确保您的资源正确放置。想想一个人，不管有没有坏人，他都会确保你的财产仍然安全。

你应该让这两者永远合作。

例如：

```
try
{
  StreamReader reader=new  StreamReader("myfile.txt");
  //do other stuff
}
catch(Exception ex){
 // Create log, or show notification
 generic.Createlog("Error", ex.message);
}
finally   // Will execute despite any exception
{
  reader.Close();
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-24T18:14:18.473

使用 finally，您可以清理资源，即使您的 catch 语句将异常抛出给调用程序。您的示例包含空的 catch 语句，几乎没有什么区别。但是，如果在你的 catch 中，你做了一些处理并抛出错误，或者甚至根本没有 catch，finally 仍然会运行。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-24T18:18:17.713

一方面，捕获您不想处理的异常是一种不好的做法。从*提高 .NET 应用程序性能和可扩展性*中查看[关于 .Net 性能的第 5 章](http://msdn.microsoft.com/en-us/library/ms998547.aspx)。旁注，您可能应该在 try 块中加载流，这样，如果失败，您可以捕获相关的异常。在 try 块之外创建流会破坏其目的。

 ** * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-24T18:14:41.390

在可能的许多原因中，异常执行起来非常慢。如果这种情况经常发生，您可以轻松地缩短执行时间。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-24T18:14:48.940

捕获所有异常的 try/catch 块的问题在于，如果发生未知异常，您的程序现在处于不确定状态。这完全违反了快速失败规则——如果发生异常，您不希望程序继续运行。上面的 try/catch 甚至会捕获 OutOfMemoryExceptions，但这绝对是您的程序不会运行的状态。

Try/finally 块允许您在快速失败的同时执行清理代码。在大多数情况下，您只想在全局级别捕获所有异常，以便您可以记录它们，然后退出。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-24T18:28:06.240

只要没有引发异常，您的示例之间的有效差异就可以忽略不计。

但是，如果在 'try' 子句中抛出异常，第一个示例将完全吞下它。第二个示例将异常引发到调用堆栈的下一步，因此所述示例的不同之处在于，一个完全掩盖了任何异常（第一个示例），另一个（第二个示例）保留了异常信息以供以后可能处理，而仍在执行“finally”子句中的内容。

例如，如果您将代码放在第一个引发异常的示例的“catch”子句中（无论是最初引发的异常，还是新异常），读取器清理代码将永远不会执行。*无论*'catch' 子句中发生什么，最终都会执行。

因此，'catch' 和 'finally' 之间的主要区别在于，'finally' 块的内容（有一些罕见的异常）可以被认为是*保证*执行，即使面对意外的异常，而后面的任何代码“catch”子句（但在“finally”子句之外）不会提供这样的保证。

顺便说一句，Stream 和 StreamReader 都实现了 IDisposable，并且可以包装在“使用”块中。“使用”块是 try/finally 的语义等价物（没有“catch”），因此您的示例可以更简洁地表示为：

```
using (StreamReader reader = new  StreamReader("myfile.txt"))
{
  int i = 5 / 0;
} 
```

...当 StreamReader 实例超出范围时，它将关闭并处理它。希望这可以帮助。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-24T22:26:20.223

try {...} catch{} 并不总是坏事。这不是一种常见的模式，但是当我无论如何都需要关闭资源时，我确实倾向于使用它，比如在线程结束时关闭（可能）打开的套接字。

# sql - SQL sp_help_operator

> ID：128830
> 
> 赞同：0
> 
> 时间：2008-09-24T18:13:02.673
> 
> 标签：sql, sp-help-operator

任何人都知道我需要属于哪个组显示在`sp_help_operator`列表中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T18:17:31.943

从 docs 来看`sp_help_operator`，您似乎需要使用`sp_add_operator`and显式添加/删除运算符`sp_delete_operator`。

[http://msdn.microsoft.com/en-us/library/aa238703(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa238703(SQL.80).aspx)

# sql-server - 从 SQL Server 触发器生成进程的最佳方法

> ID：128836
> 
> 赞同：0
> 
> 时间：2008-09-24T18:13:52.467
> 
> 标签：sql-server, triggers

我将如何使用 SQL Server 05/08 触发器生成一个单独的进程？理想情况下，我想生成进程并让 SQL Server 不等待进程完成执行。我需要从触发进程的插入中传递几个参数，但可执行文件会处理其余的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T18:29:42.163

一点 CLR 集成，结合 SQL Service Broker 可以帮助你。

[http://microsoft.apress.com/feature/70/asynchronous-stored-procedures-in-sql-server-2005](http://microsoft.apress.com/feature/70/asynchronous-stored-procedures-in-sql-server-2005)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T18:17:18.433

你想使用系统存储过程 xp_cmdshell

这里的信息：http: [//msdn.microsoft.com/en-us/library/ms175046.aspx](http://msdn.microsoft.com/en-us/library/ms175046.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T18:19:24.780

我看到了那篇特定的文章，但没有看到“生成并忘记”的选项。似乎它正在等待返回输出。

> xp_cmdshell 同步运行。在 command-shell 命令完成之前，控制权不会返回给调用者。

# linux - 如何在循环中运行命令，直到在标准输出中看到一些字符串？

> ID：128853
> 
> 赞同：15
> 
> 时间：2008-09-24T18:15:11.327
> 
> 标签：linux, bash, shell

我敢肯定，perl、ruby、bash 有一些微不足道的单行代码，可以让我在循环中运行命令，直到我在 stdout 中观察到一些字符串，然后停止。理想情况下，我也想捕获标准输出，但如果它要控制台，那可能就足够了。

目前有问题的特定环境是 RedHat Linux，但有时在 Mac 上也需要同样的东西。因此，通用和 *nixy 将是最好的。不关心 Windows - 大概一个 *nixy 的东西可以在 cygwin 下工作。

更新：请注意，“观察一些字符串”是指“stdout 包含一些字符串”而不是“stdout 是一些字符串”。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-24T18:26:22.000

在 Perl 中：

```
#!/usr/local/bin/perl -w

if (@ARGV != 2)
{
    print "Usage: watchit.pl <cmd> <str>\n";
    exit(1);
}

$cmd = $ARGV[0];
$str = $ARGV[1];

while (1)
{
    my $output = `$cmd`;
    print $output; # or dump to file if desired
    if ($output =~ /$str/)
    {
        exit(0);
    }
} 
```

例子：

```
[bash$] ./watchit.pl ls stop
watchit.pl
watchit.pl~
watchit.pl
watchit.pl~
... # from another terminal type "touch stop"
stop 
watchit.pl
watchit.pl~ 
```

不过，您可能想在其中添加一个睡眠。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-24T18:18:13.020

有很多方法可以做到这一点，首先想到的是：

```
OUTPUT=""; 
while [ `echo $OUTPUT | grep -c somestring` = 0 ]; do 
  OUTPUT=`$cmd`; 
done 
```

$cmd 是您要执行的命令。

最重要的是，这里有一个 BASH 函数版本，所以如果你想定期从交互式 shell 调用它，你可以更容易地调用它：

```
function run_until () {
  OUTPUT="";
  while [ `echo $OUTPUT | grep -c $2` = 0 ]; do
    OUTPUT=`$1`;
    echo $OUTPUT;
  done
} 
```

*免责声明：仅经过轻微测试，如果您的命令有很多参数或字符串包含特殊字符，可能需要进行一些额外的转义等。*

**编辑**：根据亚当评论的反馈 - 如果您出于任何原因*不需要*输出（即不想显示输出），那么您可以使用这个较短的版本，减少反引号的使用，因此减少开销：

```
OUTPUT=0; 
while [ "$OUTPUT" = 0 ]; do 
  OUTPUT=`$cmd | grep -c somestring`;
done 
```

BASH 函数版本还有：

```
function run_until () {
  OUTPUT=0; 
  while [ "$OUTPUT" = 0 ]; do 
    OUTPUT=`$1 | grep -c $2`; 
  done
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-02T03:39:29.247

我很惊讶我没有看到这里提到的简短的 Perl 单行代码：

```
perl -e 'do { sleep(1); $_ = `command`; print $_; } until (m/search/);' 
```

Perl 是一种非常好的语言，可以处理这样的事情。将“命令”替换为您要重复运行的命令。将“搜索”替换为您要搜索的内容。如果要搜索带有斜线的内容，请`m/search/`用`m#search`字符串替换`/es#`。

此外，Perl 可以在许多不同的平台上运行，包括 Win32，无论您在哪里安装了 Perl，它都可以工作。只需适当地更改您的命令。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-25T12:35:27.343

`grep -c 99999`将为匹配打印 99999 行上下文（我认为这已经足够了）：

```
while true; do /some/command | grep expected -C 99999 && break; done 
```

或者

```
until /some/command | grep expected -C 9999; do echo -n .; done 
```

...这将打印一些漂亮的点来指示进度。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T18:18:23.703

```
while (/bin/true); do
  OUTPUT=`/some/command`
  if [[ "x$OUTPUT" != "x" ]]; then
    echo $OUTPUT
    break
  fi

  sleep 1
done 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T18:21:39.127

编辑：我原来的答案是假设“一些字符串”的意思是“任何字符串”。如果你需要寻找一个特定的，Perl 可能是你最好的选择，因为在 REGEX 匹配方面几乎没有什么能比 Perl 更好。

然而，如果你因为任何原因不能使用 Perl（你可以期望 Perl 存在于大多数 Linux 发行版中，但没有人强迫用户安装它，尽管 Perl 可能不可用），你可以在grep。但是，到目前为止我看到的一些 grep 解决方案不是最理想的（它们比必要的要慢）。在这种情况下，我宁愿执行以下操作：

```
MATCH=''; while [[ "e$MATCH" == "e" ]]; do MATCH=`COMMAND | grep "SOME_STRING"`; done; echo $MATCH 
```

将*COMMAND*替换为要运行的实际命令，将*SOME_STRING*替换为要搜索的字符串。如果在 COMMAND 的输出中找到 SOME_STRING，则循环将停止并打印找到 SOME_STRING 的输出。

原始答案：

可能不是最好的解决方案（我不是一个好的 bash 程序员），但它会起作用:-P

```
RUN=''; while [[ "e$RUN" == "e" ]]; do RUN=`XXXX`; done ; echo $RUN 
```

只需将 XXXX 替换为您的命令调用，例如尝试使用“ *echo* ”，它将永远不会返回（因为 echo 永远不会将任何内容打印到标准输出），但是如果您使用“ *echo test* ”，它将立即终止并最终打印出 test。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T22:46:58.927

```
CONT=1; while [ $CONT -gt 0 ]; do $CMD | tee -a $FILE | grep -q $REGEXP; CONT=$? ; done 
```

tee 命令可以在仍然传递数据的同时捕获管道中的标准输出，并`-a`使其附加到文件而不是每次都覆盖它。如果有匹配则将，`grep -q`否则不会向标准输出写入任何内容。是上一条命令的返回值，所以在这种情况下将是 grep 的返回值。`return 0``1``$?``$CONT`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T23:10:30.930

一个简单的方法是

```
until `/some/command`
do
  sleep 1
done 
```

命令周围的反引号使`until`测试返回某些输出，而不是测试命令的退出值。

# c# - 这是获取 WebProfile 的正确方法吗？

> ID：128857
> 
> 赞同：1
> 
> 时间：2008-09-24T18:16:00.950
> 
> 标签：c#, asp.net, asp.net-ajax

我有一个用户报告说，当他们使用后退按钮返回一个网页时，他们会以另一个人的身份返回。似乎他们可能正在访问不同的用户个人资料。

以下是代码的重要部分：

```
//here's the code on the web page

public static WebProfile p = null;

protected void Page_Load(object sender, EventArgs e)
{
    p = ProfileController.GetWebProfile();
    if (!this.IsPostBack)
    {
         PopulateForm();
    }       
}

//here's the code in the "ProfileController" (probably misnamed)
public static WebProfile GetWebProfile()
{
    //get shopperID from cookie
    string mscsShopperID = GetShopperID();
    string userName = new tpw.Shopper(Shopper.Columns.ShopperId,        mscsShopperID).Email;
    p = WebProfile.GetProfile(userName); 
    return p;
} 
```

我使用静态方法和 a`static WebProfile`因为我需要在`static WebMethod`(ajax `pageMethod`) 中使用配置文件对象。

*   这会导致不同用户“共享”配置文件对象吗？
*   我没有正确使用静态方法和对象吗？

* * *

我将`WebProfile`对象更改为`static`对象的原因是因为我需要访问 a 中的配置文件对象`[WebMethod]`（从页面上的 javascript 调用）。

*   有没有办法在 a 中访问配置文件对象`[WebMethod]`？
*   如果没有，我有什么选择？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T18:24:15.797

静态对象在应用程序的所有实例之间共享，因此如果您更改静态对象的值，该更改将反映在访问该对象的应用程序的所有实例中。因此，如果您的网络配置文件在您为当前用户设置它之间由另一个线程（即第二个用户访问页面）重新分配，它将包含与您预期不同的信息。

要解决此问题，您的代码应类似于：

```
public WebProfile p = null;

protected void Page_Load(object sender, EventArgs e)
{
    p = ProfileController.GetWebProfile();
    if (!this.IsPostBack)
    {
         PopulateForm();
    }       
}

public static WebProfile GetWebProfile()
{
    //get shopperID from cookie
    string mscsShopperID = GetShopperID();
    string userName = new tpw.Shopper(Shopper.Columns.ShopperId,        mscsShopperID).Email;
    return WebProfile.GetProfile(userName); 
} 
```

请注意，静态对象尚未设置，返回值应在调用方法中分配给 Web 配置文件类的 NON STATIC 实例。

另一种选择是在使用的整个过程中锁定静态变量，但这会导致性能严重下降，因为锁定会阻塞对资源的任何其他请求，直到当前锁定线程完成 - 这在网络应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T08:54:18.607

@Geri

如果用户的配置文件不经常更改，您可以选择将其存储在当前会话状态中。这将引入一些内存开销，但取决于配置文件的大小和同时用户的数量，这很可能不是问题。你会做这样的事情：

```
public WebProfile p = null;
private readonly string Profile_Key = "CurrentUserProfile"; //Store this in a config or suchlike

protected void Page_Load(object sender, EventArgs e)
{
    p = GetProfile();

    if (!this.IsPostBack)
    {
        PopulateForm();
    }       
}

public static WebProfile GetWebProfile() {} // Unchanged

private WebProfile GetProfile()
{
    if (Session[Profile_Key] == null)
    {
        WebProfile wp = ProfileController.GetWebProfile();
        Session.Add(Profile_Key, wp);
    }
    else
        return (WebProfile)Session[Profile_Key];
}

[WebMethod]
public MyWebMethod()
{
    WebProfile wp = GetProfile();
    // Do what you need to do with the profile here
} 
```

以便在必要时从会话中检索配置文件状态，并且应该绕过对静态变量的需求。

# java - 如何从对象的地址计算 hashCode()？

> ID：128888
> 
> 赞同：5
> 
> 时间：2008-09-24T18:21:58.953
> 
> 标签：java, hash, equals, hashcode

在 Java 中，我有一个`Vertex`Java3D 类的子类`Point3f`。现在根据其坐标值进行`Point3f`计算，但对于我的类，我想更严格：两个顶点只有在它们是同一个对象时才相等。到现在为止还挺好：`equals()``Vertex`

```
class Vertex extends Point3f {

    // ...

    public boolean equals(Object other) {
        return this == other;
    }
} 
```

我知道这违反了 的合同`equals()`，但是因为我只会将顶点与其他顶点进行比较，所以这不是问题。

现在，为了能够将顶点放入 a`HashMap`中，该`hashCode()`方法必须返回与 一致的结果`equals()`。它目前是这样做的，但它的返回值可能基于 的字段`Point3f`，因此会为`Vertex`具有相同坐标的不同对象提供哈希冲突。

因此，我想基于对象的地址，而不是从的字段`hashCode()`中计算它。`Vertex`我知道这个`Object`类是这样做的，但我不能调用它的`hashCode()`方法，因为`Point3f`它会覆盖它。

所以，实际上我的问题是双重的：

*   我什至要这么浅`equals()`？
*   如果是，那么，我如何获取对象的地址来计算哈希码？

编辑：我只是想到了一些东西......我可以`int`在对象创建时生成一个随机值，并将其用于哈希码。这是一个好主意吗？为什么不）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-24T18:29:26.190

使用 System.identityHashCode() 或使用 IdentityHashMap。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T18:31:13.113

[`System.identityHashCode()`](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/System.html#identityHashCode(java.lang.Object))为给定对象返回与默认方法返回的相同的哈希码`hashCode()`，无论给定对象的类是否覆盖`hashCode()`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T18:38:51.347

即使这个[答案](https://stackoverflow.com/questions/128888/how-to-compute-the-hashcode-from-the-objects-address#128926)可能更好，您也可以使用委托。

```
 class Vertex extends Point3f{
   private final Object equalsDelegate = new Object();
   public boolean equals(Object vertex){
      if(vertex instanceof Vertex){
         return this.equalsDelegate.equals(((Vertex)vertex).equalsDelegate);
      }
      else{
         return super.equals(vertex);
      }
   }
   public int hashCode(){
      return this.equalsDelegate.hashCode();
   }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T18:44:10.350

仅供参考，您的 equals 方法不违反 equals 合同（对于基本 Object 的合同）......这基本上是基本 Object 方法的 equals 方法，所以如果你想要身份 equals 而不是 Vertex equals，那就是美好的。

至于哈希码，您实际上不需要更改它，尽管接受的答案是一个不错的选择，如果您的哈希表包含许多具有相同值的顶点键，效率会更高。

您不需要更改它的原因是因为哈希码将为等于返回 false 的对象返回相同的值是完全没问题的......它甚至是一个有效的哈希码，每次只返回 0实例。这对哈希表是否有效是完全不同的问题......如果您的许多对象具有相同的哈希码（如果您单独留下哈希码并且有很多顶点，可能就是这种情况）具有相同的值）。

当然，请不要接受这个作为答案（你选择的更实用），我只是想给你一些关于哈希码和等于的背景信息;-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T19:43:44.297

为什么首先要覆盖 hashCode() ？如果您想使用其他一些平等定义，您会想要这样做。例如

公共类 A { int id;

public boolean equals(A other) { return other.id==id} public int hashCode() {return id;}

您想清楚的是，如果 id 相同，则对象相同，并且您覆盖哈希码，因此您不能这样做：

HashSet hash=new HashSet(); hash.add(新 A(1)); hash.add(新 A(1)); 并获得 2 个相同的（从您对平等的定义的角度来看）A。正确的行为是您在哈希中只有 1 个对象，第二次写入将覆盖。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T22:43:23.600

由于您不是使用等于作为逻辑比较，而是使用物理比较（即，它是同一个对象），所以保证哈希码返回唯一值的唯一方法是实现您自己建议的变体。不是生成随机数，而是使用 UUID 为每个对象生成一个实际的唯一值。

System.identityHashCode() 在**大多数**情况下都可以工作，但不能保证，因为 Object.hashCode() 方法**不能**保证为每个对象返回唯一值。我已经看到发生了边缘情况，它可能取决于 VM 实现，这不是您希望代码依赖的东西。

Object.hashCode() 的 javadocs 摘录：尽可能合理地实用，由 Object 类定义的 hashCode 方法确实为不同的对象返回不同的整数。（这通常通过将对象的内部地址转换为整数来实现，但 JavaTM 编程语言不需要这种实现技术。）

这个解决的问题是两个独立的点对象在插入哈希图中时不会相互覆盖，因为它们都具有相同的哈希值。由于没有逻辑上的等号，伴随着对 hashCode() 的覆盖，identityHashCode 方法实际上会导致这种情况发生。在逻辑案例只会替换相同逻辑点的哈希条目的情况下，使用基于系统的哈希可能会导致它与任何两个对象一起发生，相等（甚至类）不再是一个因素。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-24T18:27:14.683

函数 hashCode() 继承自 Object 并且完全按照您的意图工作（在对象级别，而不是坐标级别）。应该没有必要改变它。

至于您的 equals 方法，甚至没有理由使用它，因为您可以在代码中执行 obj1 == obj2 而不是使用 equals，因为它是用于排序和类似的，比较坐标更有意义。

# objective-c - setPrimitiveValue:forKey: 和多对多关系

> ID：128894
> 
> 赞同：11
> 
> 时间：2008-09-24T18:23:42.833
> 
> 标签：objective-c, cocoa, core-data

在使用它来管理多对多关系时，Apple 的[文档在两个方面是模糊的。`-setPrimitiveValue:forKey:`](http://developer.apple.com/documentation/Cocoa/Reference/CoreDataFramework/Classes/NSManagedObject_Class/Reference/NSManagedObject.html#//apple_ref/occ/instm/NSManagedObject/setPrimitiveValue:forKey:)

他们首先声明：

> 如果您尝试为新的 NSMutableSet 对象设置一对多关系，它将（最终）失败。

***最终？！***那有什么意思？以后会不会失败`-[NSManagedObjectContext save:]`？当一个托管对象变成一个故障然后又被分页回来？什么时候？我可以编写一个测试用例来始终如一地按需重新创建故障吗？

其次，提供示例代码来正确处理这种情况，他们写道：

> 首先使用获取现有集合`primitiveValueForKey:`（确保方法不返回`nil`）

如果/当方法返回 nil 时我该怎么*办*？`assert()`它并立即失败，因为这意味着整个对象图已损坏并且保存会导致数据丢失？`NSAssert()`在它上作为对呼叫者的警告但按下（默默地什么都不做）？

现在我只是`NS[Mutable]Set`在这种情况下直接分配我想要的，如下所示：

```
- (void)setChildren:(NSSet*)value_ {
    NSMutableSet *mutableRelationshipSet = [[[self primitiveValueForKey:@"children"] mutableCopy] autorelease];
    if (mutableRelationshipSet) {
        [mutableRelationshipSet setSet:value_];
        [self setPrimitiveValue:mutableRelationshipSet forKey:@"children"];
    } else {
        [self setPrimitiveValue:value_ forKey:@"children"];
    }
} 
```

那是错的吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-27T21:48:24.367

只需将 的返回值变异`-primitiveValueForKey:`为可变集，相信它的返回值会做正确的事情。

一定要使用`-willChangeValueForKey:withSetMutation:usingObjects:`和`-didChangeValueForKey:withSetMutation:usingObjects:`围绕你的操作；您没有在上面的代码中显示这一点。

```
- (void)setChildren:(NSSet *)value {
    [self willChangeValueForKey:@"children" withSetMutation:NSKeyValueSetSetMutation usingObjects:value];

    NSMutableSet *primitiveValue = [self primitiveValueForKey:@"children"];

    [primitiveValue setSet:value];

    [self didChangeValueForKey:@"children" withSetMutation:NSKeyValueSetSetMutation usingObjects:value];
} 
```

如果你能瞄准 Leopard，你就不必担心这个；您可以改用 Core Data 的内置属性支持：

```
#import <CoreData/CoreData.h>

@interface Folder : NSManagedObject
@property (readwrite, retain) NSSet *children;
@end

@implementation Folder
@dynamic children;
@end 
```

Core Data 不仅会为属性生成 getter/setter 对，还会生成`children`mutable-set 访问器，因此您可以使用`-mutableSetValueForKey:`它并以最小的开销操作结果。

# mysql - 您使用查询处理程序吗？如果是这样，它为您执行了哪些任务？

> ID：128914
> 
> 赞同：0
> 
> 时间：2008-09-24T18:27:56.473
> 
> 标签：mysql, handlers

几个月前，我的工作部署了一个内部函数，该函数将标准、php、mysql_query() 函数与其他选项和功能一起包装起来。一个示例功能是我们可以打开/关闭的一些方便的调试工具。

我想知道查询处理程序有多受欢迎，以及人们喜欢在其中内置哪些功能。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T18:35:36.330

出于类似的原因，我使用了像[MDB2](http://pear.php.net/package/MDB2)、[Zend_Db](http://framework.zend.com/manual/en/zend.db.html)或[Doctrine这样的 DBAL。](http://www.doctrine-project.org/)主要是为了能够利用它提供的所有快捷方式，而不是因为它支持不同的数据库。

例如，旧的：

```
<?php
$query  = "SELECT * FROM table";
$result = mysql_query($query);
if (!$result) {
  echo mysql_error();
} else {
  if (mysql_num_rows($result) > 0) {
    while ($row = mysql_fetch_obj($result)) {
      ...
    }
  }
}
?> 
```

与（Zend_Db）：

```
<?php
try {
  $result = $db->fetchAll("SELECT * FROM table");
  foreach($result as $row) {
    ...
  }
} catch (Zend_Exception $e) {
  echo $e->getMessage();
}
?> 
```

恕我直言，更直观。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T03:41:43.717

我们也在我的办公室实施了类似的措施。事实证明，对于它提供的相关处理功能来说，它是一个非常宝贵的工具。错误跟踪，预先格式化的输出，它也可以作为 MsSQL 和 MySQL 之间的“AL”。

除了上述功能之外，我认为拥有一些低资源密集型性能监控或跟踪会很酷。对于更大或更复杂的数据集，查询可能非常重要，并且能够实时监控（或发布）将有助于大型网站所需的任何优化。

只是我的两分钱。

# database - 极限分片：每个用户一个 SQLite 数据库

> ID：128919
> 
> 赞同：39
> 
> 时间：2008-09-24T18:28:36.270
> 
> 标签：database, sqlite, architecture, scalability, sharding

我正在开发一个介于电子邮件服务和社交网络之间的网络应用程序。我觉得它有潜力在未来变得非常大，所以我担心可扩展性。

我决定为每个活动用户创建一个单独的 SQLite 数据库，而不是使用一个集中式 MySQL/InnoDB 数据库，然后在那个时候对其进行分区：每个“分片”一个活动用户。

这样备份数据库就像每天一次将每个用户的*小型*数据库文件复制到远程位置一样简单。

扩大规模就像添加额外的硬盘来存储新文件一样简单。

当应用程序超出单个服务器时，我可以使用 GlusterFS 在文件系统级别将服务器链接在一起并保持不变地运行应用程序，或者安装一个简单的 SQLite 代理系统，允许每个服务器操作相邻服务器中的 sqlite 文件。

并发问题将是最小的，因为每个 HTTP 请求一次只会触及一个或两个数据库文件，在数千个中，而且 SQLite 无论如何只会阻塞读取。

我敢打赌，这种方法将使我的应用程序能够优雅地扩展并支持许多很酷和*独特的*功能。我赌错了吗？我错过了什么吗？

**更新**我决定采用一个不太极端的解决方案，到目前为止效果很好。我正在使用固定数量的分片 - 准确地说是 256 个 sqlite 数据库。每个用户都通过一个简单的散列函数分配并绑定到一个随机分片。

我的应用程序的大多数功能只需要每个请求访问一到两个分片，但有一个特别需要对 256 个分片中的 10 到 100 个不同的分片执行简单查询，具体取决于用户。测试表明，如果所有数据都缓存在 RAM 中，大约需要 0.02 秒或更短的时间。我想我可以忍受它！

**更新 2.0**我将应用程序移植到 MySQL/InnoDB 并且能够获得与常规请求大致相同的性能，但是对于需要分片遍历的请求，innodb 快 4-5 倍。出于这个原因，以及其他原因，我放弃了这个架构，但我希望有人能在某个地方找到它的用途......谢谢。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-24T18:35:01.747

这将失败的地方是，如果您必须执行所谓的“分片行走”——即找出一堆不同用户的所有数据。这种特定类型的“查询”必须以编程方式完成，依次询问每个 SQLite 数据库——并且很可能是您网站中最慢的方面。在任何将数据“分片”到单独数据库中的系统中，这都是一个常见问题。

如果所有数据对用户来说都是独立的，那么这应该可以很好地扩展 - 使其成为有效设计的关键是了解数据可能会被如何使用以及来自一个人的数据是否会交互来自另一个人的数据（在您的上下文中）。

您可能还需要注意文件系统资源——SQLite 非常棒、很棒、速度快等——但是当使用“标准数据库”（即 MySQL、PostgreSQL 等）时，您确实会获得一些缓存和写入优势，因为它们是如何实现的'被设计。在您提出的设计中，您将错过其中的一些。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T18:33:55.650

对我来说，这听起来像是一场维护噩梦。当所有这些数据库上的架构发生变化时会发生什么？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-24T12:00:51.677

[http://freshmeat.net/projects/sphivedb](http://freshmeat.net/projects/sphivedb)

SPHiveDB 是一个用于 sqlite 数据库的服务器。它使用 JSON-RPC over HTTP 来公开网络接口以使用 SQLite 数据库。它支持将多个 SQLite 数据库合并到一个文件中。它还支持使用多个文件。它是为极端分片模式设计的——每个用户一个 SQLite 数据库。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-25T12:15:06.800

一个可能的问题是，为每个用户使用一个数据库将非常低效地使用磁盘空间和 RAM，并且随着用户群的增长，使用轻量级和快速数据库引擎的好处将完全丧失。

这个问题的一个可能的解决方案是创建“**迷你分片**”，其中可能包含 1024 个 SQLite 数据库，每个数据库最多可容纳*100 个用户*。这将比每个用户的 DB 方法更有效，因为数据的打包效率更高。而且比 Innodb 数据库服务器方法更轻，因为我们使用的是 Sqlite。

并发性也会很好，但查询会不太优雅（shard_id yuckiness）。你怎么看？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T18:37:51.910

如果您为每个用户创建一个单独的数据库，听起来您没有建立关系......那么为什么要使用关系数据库呢？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T18:39:43.763

如果你的数据这么容易分片，为什么不使用标准的数据库引擎，如果你的规模足够大以至于数据库成为瓶颈，那么对数据库进行分片，在不同的实例中使用不同的用户？效果是一样的，但是您没有使用许多很小的数据库。

实际上，您可能至少有一些不属于任何单个用户的共享数据，并且您可能经常需要访问多个用户的数据。但是，这将导致任一系统出现问题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-30T04:00:14.817

我正在考虑使用相同的架构，因为我基本上想使用服务器端 SQLLIte 数据库作为客户端的备份和同步副本。我对所有数据进行查询的想法是使用 Sphinx 进行全文搜索，并从所有数据的平面转储到 Scribe 运行 Hadoop 作业，然后将结果作为 Web 服务公开。然而，这篇文章让我停下来思考，所以我希望人们继续用他们的意见作出回应。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-28T17:05:13.947

每个用户拥有一个数据库当然可以很容易地恢复单个用户的数据，但正如[@John](https://stackoverflow.com/users/1786/john-sheehan)所说，模式更改需要一些工作。

不足以让它变得困难，但足以让它变得不平凡。

# sharepoint - Sharepoint：是否有支持通配符的 webpart 过滤器？

> ID：128921
> 
> 赞同：2
> 
> 时间：2008-09-24T18:28:52.260
> 
> 标签：sharepoint

我有一个文档库，其中包含一个名为“compound”的自定义列，它只是文本。

我想在该文档库页面上放置一个过滤器（输入文本框），以便视图仅显示复合列包含我输入的文本的项目。最好使用通配符，例如 * 或 ? 或者可以支持完整的正则表达式......但现在，我只需要一个“包含”。

开箱即用的文本过滤器似乎只支持完全匹配。

如果我创建一个新视图并添加一个带有“包含”子句的过滤器，结果输出将与我看到的相同。

第三方解决方案是可以接受的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T19:20:37.720

KWizCom 有一个过滤器 Web 部件，看起来它可以做你想做的事： [KWizCom SharePoint List Filter Plus](http://www.kwizcom.com/ProductPage.asp?ProductID=404&ProductSubNodeID=405)

另一个尝试的选项是使用 SharePoint Designer 数据视图 Web 部件。我相信您可以使用 SPD 的“包含”来编写过滤器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T20:43:58.707

我知道如果您将普通列表视图添加到页面并使用 SharePoint Designer 进行编辑，您可以更轻松地设置这种过滤器。在 SPD 中，您可以设置“开始于”过滤器。这是一个[讨论](http://social.msdn.microsoft.com/Forums/en-US/sharepointcustomization/thread/fbd25b4b-abb4-431c-b8c2-7385639a0b51/)，有人提出了同样的建议。

# javascript - 在点击事件监听器中添加“return false”有什么效果？

> ID：128923
> 
> 赞同：394
> 
> 时间：2008-09-24T18:28:54.803
> 
> 标签：javascript, html

很多时候，我在 HTML 页面中看到过这样的链接：

```
<a href='#' onclick='someFunc(3.1415926); return false;'>Click here !</a> 
```

里面有什么作用`return false`？

另外，我通常不会在按钮中看到它。

这是在任何地方指定的吗？在 w3.org 的某些规范中？

* * *

## 回答 #1

> 赞同：337
> 
> 时间：2008-09-24T18:36:17.873

事件处理程序的返回值决定了默认浏览器行为是否也应该发生。在点击链接的情况下，这将是跟随链接，但差异在表单提交处理程序中最为明显，如果用户输入信息错误，您可以取消表单提交。

我不相信有这方面的 W3C 规范。所有像这样的古老 JavaScript 接口都被赋予了“DOM 0”的绰号，并且大多未指定。阅读旧的 Netscape 2 文档可能会有一些运气。

实现这种效果的现代方式是调用`event.preventDefault()`，这在[DOM 2 事件规范](http://www.w3.org/TR/DOM-Level-2-Events/events.html#Events-flow-cancelation)中指定。

* * *

## 回答 #2

> 赞同：181
> 
> 时间：2008-09-25T09:52:16.597

您可以通过以下示例看到差异：

```
<a href="http://www.google.co.uk/" onclick="return (confirm('Follow this link?'))">Google</a> 
```

单击“确定”返回 true，并跟随链接。单击“取消”会返回 false 并且不会跟随链接。如果 javascript 被禁用，则链接将正常访问。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2014-08-19T07:26:34.667

## ***“return false”***到底在做什么？

当您调用它时，return false 实际上是在做三件非常不同的事情：

1.  event.preventDefault();
2.  event.stopPropagation();
3.  停止回调执行并在调用时立即返回。

有关更多信息，请参阅[jquery-events-stop-misusing-return-false](http://fuelyourcoding.com/jquery-events-stop-misusing-return-false/)。

*例如 ：*

单击此链接时，返回 false 将***取消浏览器的默认行为***。

```
<a href='#' onclick='someFunc(3.1415926); return false;'>Click here !</a> 
```

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2008-09-24T19:59:39.607

这是一个更强大的例程来取消所有浏览器中的默认行为和事件冒泡：

```
// Prevents event bubble up or any usage after this is called.
eventCancel = function (e)
{
    if (!e)
        if (window.event) e = window.event;
        else return;
    if (e.cancelBubble != null) e.cancelBubble = true;
    if (e.stopPropagation) e.stopPropagation();
    if (e.preventDefault) e.preventDefault();
    if (window.event) e.returnValue = false;
    if (e.cancel != null) e.cancel = true;
} 
```

一个如何在事件处理程序中使用它的示例：

```
// Handles the click event for each tab
Tabstrip.tabstripLinkElement_click = function (evt, context) 
{
    // Find the tabStrip element (we know it's the parent element of this link)
    var tabstripElement = this.parentNode;
    Tabstrip.showTabByLink(tabstripElement, this);
    return eventCancel(evt);
} 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2008-09-24T18:30:30.680

从 JavaScript 事件中重新调整 false 通常会取消“默认”行为 - 在链接的情况下，它会告诉浏览器不要跟随链接。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-09-24T18:30:01.727

我相信它会导致标准事件不会发生。

在您的示例中，浏览器不会尝试转到#。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-09-24T18:33:57.193

返回 false 将在 javascript 运行后停止跟踪超链接。这对于优雅降级的不显眼的 javascript 很有用 - 例如，您可以有一个缩略图图像，它使用 javascript 打开全尺寸图像的弹出窗口。当 javascript 关闭或图像被中键单击（在新选项卡中打开）时，这会忽略 onClick 事件并通常将图像作为全尺寸图像打开。

如果未指定 return false，则图像将启动弹出窗口并正常打开图像。有些人不使用 return false 而是使用 javascript 作为 href 属性，但这意味着当 javascript 被禁用时，链接将什么也不做。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-24T18:31:20.833

在 onclick 事件中使用 return false 会阻止浏览器处理执行堆栈的其余部分，其中包括跟随 href 属性中的链接。

换句话说，添加 return false 会使 href 停止工作。在您的示例中，这正是您想要的。

在按钮中，这不是必需的，因为 onclick 是它会执行的全部 - 没有要处理和转到的 href。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-09-24T18:31:10.773

return false 表示不采取默认操作，在 an 的情况下`<a href>`是跟随链接。当您向 onclick 返回 false 时，href 将被忽略。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-09-24T18:32:25.433

浏览器破解：http: [//jszen.blogspot.com/2007/03/return-false-to-prevent-jumping.html](http://jszen.blogspot.com/2007/03/return-false-to-prevent-jumping.html)

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-24T18:30:38.933

返回 false 将阻止导航。否则，该位置将成为 someFunc 的返回值

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-03-08T14:59:00.080

我很惊讶没有人`onmousedown`提到`onclick`. 这

`onclick='return false'`

没有捕捉到浏览器的默认行为，导致（有时是不需要的）文本选择发生在`mousedown`但

`onmousedown='return false'`

做。

换句话说，当我点击一个按钮时，它的文本有时会被意外选中，从而改变按钮的外观，这可能是不需要的。这是我们在这里试图阻止的默认行为。但是，该`mousedown`事件是在之前注册的`click`，因此如果您只在`click`处理程序内部阻止该行为，它不会影响由`mousedown`事件引起的不需要的选择。所以文本仍然被选中。但是，防止`mousedown`事件的默认值将完成这项工作。

另请参阅[event.preventDefault() 与 return false](https://stackoverflow.com/questions/1357118/event-preventdefault-vs-return-false)

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2016-03-30T17:13:19.013

这`return false`可以防止页面被导航和不需要的窗口滚动到顶部或底部。

```
onclick="return false" 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2019-11-23T19:35:59.073

我的 HTML 页面上有这个链接：

```
<a href = "" 
onclick = "setBodyHtml ('new content'); return false; "
> click here </a> 
```

函数 setBodyHtml() 定义为：

```
function setBodyHtml (s)
{ document.body.innerHTML = s;
} 
```

当我单击链接时，链接消失，浏览器中显示的文本变为“新内容”。

但是，如果我从链接中删除“假”，则单击该链接（似乎）没有任何作用。这是为什么？

这是因为如果我不返回 false，则单击链接并显示其目标页面的默认行为不会被取消。但是，这里超链接的href是“”，所以它链接回相同的当前页面。所以页面实际上只是刷新了，似乎什么也没发生。

在后台，函数 setBodyHtml() 仍然会被执行。它将其参数分配给 body.innerHTML。但是因为页面会立即刷新/重新加载，所以修改后的正文内容可能不会保持可见超过几毫秒，所以我不会看到它。

这个例子说明了为什么有时使用“return false”是有用的。

我确实想为链接分配一些 href，以便它显示为链接，显示为带下划线的文本。但我不希望点击链接有效地重新加载页面。我希望取消默认的 navigation=behavior 以及调用我的函数引起的任何副作用并保持有效。因此我必须“返回假”。

上面的例子是你在开发过程中很快就会尝试的东西。对于生产，您更有可能在 JavaScript 中分配一个点击处理程序并调用 preventDefault() 代替。但是为了快速尝试一下，上面的“return false”可以解决问题。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-12-20T02:53:24.053

使用表单时，我们可以使用'return false'来阻止提交。

```
function checkForm() {
    // return true to submit, return false to prevent submitting
}
<form onsubmit="return checkForm()">
    ...
</form> 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-11-19T03:49:49.513

默认情况下，当您单击按钮时，无论您输入什么值，表单都会发送到服务器。

但是，这种行为在大多数情况下不太合适，因为我们可能希望在将其发送到服务器之前进行一些检查。

因此，当侦听器收到“false”时，提交将被取消。基本上，它的目的是对前端进行一些检查。

# c# - C# Day from Week 选择器组件

> ID：128924
> 
> 赞同：1
> 
> 时间：2008-09-24T18:29:16.720
> 
> 标签：c#, winforms

这个问题是针对 C# 2.0 Winform 的。

目前我使用复选框来选择这样的：Monday[x]、Thuesday[x]¸...等。

它工作正常，但**它是获得星期几的更好方法吗？**（可以采摘一天以上）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T18:36:57.000

复选框是允许选择多个项目时使用的标准 UI 组件。来自 UI 可用性大师[Jakob Nielsen](http://www.useit.com/jakob/)关于 [复选框与单选按钮](http://www.useit.com/alertbox/20040927.html)的文章：

> “当有选项列表时使用复选框，并且用户可以选择任意数量的选项，包括零个、一个或多个选项。换句话说，每个复选框都独立于列表中的所有其他复选框，因此选中一个框不会”不要取消选中其他的。”

在设计 UI 时，为给定任务使用标准或常规组件非常重要。[使用非标准组件通常会造成混乱](http://www.useit.com/alertbox/20040913.html)。例如，可以使用允许选择多个项目的组合框。但是，这将要求用户使用 Ctrl + 单击所需的项目，这对大多数人来说并不是非常直观的操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T18:32:05.420

复选框似乎合适。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T18:35:40.123

您还可以在...上使用带有[CheckBoxes的](http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.checkboxes.aspx)[ListView](http://msdn.microsoft.com/en-us/library/system.windows.forms.listview_members.aspx)

少一点硬编码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T18:36:37.017

复选框可以正常工作，并且在 Windows 计划任务中已经存在这种用法的范例。要查看该示例，请创建计划任务并选择每周作为频率。

# python - 从组中删除用户的 Perl 或 Python 脚本

> ID：128933
> 
> 赞同：3
> 
> 时间：2008-09-24T18:30:36.123
> 
> 标签：python, perl, sysadmin, centos, redhat

我正在将一个基于 Samba 的服务器组合为主域控制器，但遇到了一个本应多次解决的可爱小问题。但多次搜索并没有产生结果。我需要能够使用命令行脚本从现有组中删除现有用户。看来 usermod 很容易让我使用以下命令将用户添加到补充组：

```
usermod -a -G supgroup1,supgroup2 username 
```

如果没有“-a”选项，如果用户当前是未列出的组的成员，则该用户将从该组中删除。有没有人有允许删除用户和组的规范的 perl（或 Python）脚本？我是否错过了一个明显的现有命令，或为此而闻名的解决方案？提前致谢！

感谢 JJ 提供指向 Unix::Group 模块的指针，该模块是 Unix-ConfigFile 的一部分。看起来命令 deluser 会做我想做的事，但不在我现有的任何存储库中。我继续使用 Unix:Group 模块编写了 perl 脚本。这是您的系统管理乐趣的脚本。

```
#!/usr/bin/perl
#
# Usage:   removegroup.pl login group
# Purpose: Removes a user from a group while retaining current primary and
#          supplementary groups.
# Notes:   There is a Debian specific utility that can do this called deluser,
#          but I did not want any cross-distribution dependencies
#
# Date:   25 September 2008

# Validate Arguments (correct number, format etc.)
if ( ($#ARGV < 1) || (2 < $#ARGV) ) {
  print "\nUsage: removegroup.pl login group\n\n";
  print "EXIT VALUES\n";
  print "     The removeuser.pl script exits with the following values:\n\n";
  print "     0 success\n\n";
  print "     1 Invalid number of arguments\n\n";
  print "     2 Login or Group name supplied greater than 16 characters\n\n";
  print "     3 Login and/or Group name contains invalid characters\n\n";
  exit 1;
}

# Check for well formed group and login names
if ((16 < length($ARGV[0])) ||(16 < length($ARGV[1])))
{
  print "Usage: removegroup.pl login group\n";
  print "ERROR: Login and Group names must be less than 16 Characters\n";
  exit 2;
}

if ( ( $ARGV[0] !~ m{^[a-z_]+[a-z0-9_-]*$}) || ( $ARGV[0] !~ m{^[a-z_]+[a-z0-9_-]*$} ) )
{
  print "Usage: removegroup.pl login group\n";
  print "ERROR: Login and/or Group name contains invalid characters\n";
  exit 3;
}

# Set some variables for readability
$login=$ARGV[0];
$group=$ARGV[1];

# Requires the GroupFile interface from perl-Unix-Configfile
use Unix::GroupFile;

$grp = new Unix::GroupFile "/etc/group";
$grp->remove_user("$group", "$login");
$grp->commit();
undef $grp;
exit 0; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T19:15:32.600

我为你找到了[这个](http://search.cpan.org/~ssnodgra/Unix-ConfigFile-0.06/GroupFile.pm)。它应该做你需要的。据我所知，Perl 没有任何用于从组中删除用户的内置函数。它有几个用于查看用户或进程的组 ID。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T18:42:40.460

网页链接： [http ://www.ibm.com/developerworks/linux/library/l-roadmap4/](http://www.ibm.com/developerworks/linux/library/l-roadmap4/)

要将成员添加到组，请使用带有 -a 开关的 gpasswd 命令和您要添加的用户 ID：

gpasswd -a userid mygroup

使用相同的命令从组中删除用户，但使用 -d 开关而不是 -a：

gpasswd -d userid mygroup

“man gpasswd”了解更多信息...

我找了很久才找到这个。有时不重新发明轮子需要付出太多的努力......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T18:42:35.317

看起来*deluser --group [groupname]*应该这样做。

如果不是，*groups*命令会列出用户所属的组。想出一些 Perl 来将该列表捕获到一个数组中（或将其*映射*到一个哈希中），删除不需要的组，并将其反馈给*usermod*应该是相当简单的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T19:54:07.470

这是一个非常简单的 Perl 小脚本，它应该为您提供所需的组列表：

```
my $user = 'user';
my $groupNoMore = 'somegroup';
my $groups = join ',', grep { $_ ne $groupNoMore } split /\s/, `groups $user`; 
```

获取和清理所需的参数留给读者作为练习。

# ruby-on-rails - 上限调用和 sudo

> ID：128938
> 
> 赞同：7
> 
> 时间：2008-09-24T18:31:08.963
> 
> 标签：ruby-on-rails, ruby, capistrano

我想在我的所有应用程序服务器上安装 gem，但是 gem install 需要 sudo 访问权限 - 我如何才能启用 sudo 仅用于运行此 capistrano 命令？

换句话说，我不希望在我的所有部署方案中都使用 sudo，就在我在命令行上调用此命令时。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-24T19:03:16.500

找到它 - cap invoke COMMAND=" *command that requires sudo* " SUDO=1

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T18:36:32.523

我不太确定我是否理解这个问题，但我认为您是在问如何将 sudo 限制为一个特定的命令，而不必授予所有 Ruby 开发人员无限的恶作剧能力。

可以设置 /etc/sudoers 来限制允许用户以 root 身份调用的命令。它通常设置为 ALL，但您可以只提供允许的命令列表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-25T22:23:33.577

最好为此使用 unix ACL 或类似权限。授予部署用户 sudoer 访问权限，然后您可以调用`run "sudo do_something"`，它将仅对该调用具有 sudo 级别的访问权限。

# javascript - JavaScript 支持什么好的模板语言？

> ID：128949
> 
> 赞同：18
> 
> 时间：2008-09-24T18:33:11.517
> 
> 标签：javascript, templates

模板在已建立的编程语言中是一项相当健康的业务，但是有没有可以用 JavaScript 处理的好的业务？

“模板”是指接受数据对象作为输入、将数据插入某种序列化标记语言并输出标记的文档。著名的例子有[JSP](http://en.wikipedia.org/wiki/JavaServer_Pages)、原始的 PHP 和[XSLT](http://en.wikipedia.org/wiki/XSLT)。

我所说的“好”是指 HTML 作者编写的声明性和容易性，它是健壮的，并且它也支持其他语言。比我知道的选项更好的东西。“不好”的一些例子：

* * *

字符串数学：

```
element.innerHTML = "<p>Name: " + data.name
    + "</p><p>Email: " + data.email + "</p>"; 
```

显然太笨重，HTML 结构不明显。

* * *

XSLT：

```
<p><xsl:text>Name: </xsl:text><xsl:value-of select="//data/name"></p>
<p><xsl:text>Email: </xsl:text><xsl:value-of select="//data/email"></p> 
```

// 从结构上看，这很好用，但让我们面对现实吧，XSLT 让 HTML 开发人员感到困惑。

* * *

修剪路径：

```
<p>Name: ${data.name}</p><p>Email: ${data.email}</p> 
```

// 这很好，但处理器仅在 JavaScript 中受支持，并且语言有点原始（[http://code.google.com/p/trimpath/wiki/JavaScriptTemplateSyntax](http://code.google.com/p/trimpath/wiki/JavaScriptTemplateSyntax)）。

* * *

我希望看到 JSP 或 ASP 或 PHP 的一个子集被移植到浏览器，但我还没有找到。

这些天人们在 JavaScript 中使用什么作为模板？

## 附录 1 (2008)

几个月后，这里发布了大量可用的模板语言，但其中大多数不能用于任何其他语言。这些模板中的大多数都不能在 JavaScript 引擎之外使用。

Microsoft 的例外——您可以在浏览器或任何其他 ASP 引擎中处理相同的 ASP。这有其自身的一系列可移植性问题，因为您必须使用 Microsoft 系统。我将其标记为答案，但仍然对更便携的解决方案感兴趣。

## 附录 2 (2020)

抛开这个老问题，十年过去了，Mustache 得到了数十种语言的广泛支持。现在是当前答案，以防有人仍在阅读此内容。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-24T18:38:38.523

[John Resig在](http://ejohn.org/)[http://ejohn.org/blog/javascript-micro-templating/](http://ejohn.org/blog/javascript-micro-templating/)上有一个迷你 javascript 模板引擎

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-04-21T23:56:00.890

您可能想查看[Mustache](http://mustache.github.com/) - 它是真正可移植且简单的模板语言，在其他语言中支持 javascript。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-21T02:27:38.773

我今天遇到了这个，虽然我还没有尝试过......

[http://beebole.com/pure/](http://beebole.com/pure/)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-07-03T05:43:17.813

[闭包模板](http://code.google.com/closure/templates/)是来自 Google 的一个相当强大的模板系统，它们适用于 Javascript 和 Java。我有很好的使用它们的经验。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T20:45:47.353

[ExtJS](http://extjs.com)有一个名为 Ext.XTemplate 的特殊模板类：[http ://extjs.com/deploy/dev/docs/?class=Ext.XTemplate](http://extjs.com/deploy/dev/docs/?class=Ext.XTemplate)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-01-26T05:21:22.793

我使用[Google Closure](http://en.wikipedia.org/wiki/Google_Closure_Tools)模板。[http://code.google.com/closure/templates/docs/helloworld_js.html](http://code.google.com/closure/templates/docs/helloworld_js.html)

简单的模板，[双向](http://en.wikipedia.org/wiki/Bi-directional_text#Unicode_support)支持，自动转义，针对速度进行了优化。此外，模板解析作为构建步骤发生，因此不会减慢客户端的速度。另一个好处是您可以使用 Java 中的相同模板，以防您需要在服务器上为禁用 JavaScript 的用户生成 HTML。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T18:39:15.980

天神 [http://www.kuwata-lab.com/tenjin/](http://www.kuwata-lab.com/tenjin/)可能就是您要找的。没用过，不过看着不错。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-24T18:49:50.337

我写了[http://google-caja.googlecode.com/svn/changes/mikesamuel/string-interpolation-29-Jan-2008/trunk/src/js/com/google/caja/interp/index.html](http://google-caja.googlecode.com/svn/changes/mikesamuel/string-interpolation-29-Jan-2008/trunk/src/js/com/google/caja/interp/index.html)描述了一个模板系统，通过根据前面的上下文选择正确的转义方案，以防止 XSS 攻击的方式将字符串插值固定到 javascript 上。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-25T02:47:30.063

即将到来的 ASP.NET AJAX 4.0 中包含客户端模板功能。

[http://encosia.com/2008/07/23/sneak-peak-aspnet-ajax-4-client-side-template/](http://encosia.com/2008/07/23/sneak-peak-aspnet-ajax-4-client-side-templating/)

此外，您可以单独使用 Microsoft AJAX 库（它是 ASP.NET AJAX 的 JavaScript 部分），而无需使用 ASP.NET。

[http://www.asp.net/ajax/downloads/](http://www.asp.net/ajax/downloads/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-03T15:31:41.660

我很喜欢[使用 jTemplates](http://encosia.com/2008/06/26/use-jquery-and-aspnet-ajax-to-build-a-client-side-repeater/)：

[http://jtemplates.tpython.com/](http://jtemplates.tpython.com/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-07-06T10:21:28.960

这是一个用 jQuery 实现的 Smarty 模板语言。[http://www.balupton.com/sandbox/jquery-smarty/demo/](http://www.balupton.com/sandbox/jquery-smarty/demo/)

一个令人印象深刻的功能是支持动态更新。因此，如果您更新模板变量，它将更新模板中使用该变量的任何位置。很漂亮。

您还可以使用 onchange 事件挂钩变量更改。因此，当说变量“页面”发生变化时，这对于说执行效果或 AJAX 很有用；-)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-28T20:39:18.590

[QueryTemplates](http://code.google.com/p/querytemplates/) 演示：[http ://sandbox.meta20.net/querytemplates-js/demo.html](http://sandbox.meta20.net/querytemplates-js/demo.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-01-17T01:50:50.213

如果您使用的是[Script#](http://projects.nikhilk.net/ScriptSharp)，您可能需要考虑[SharpTemplate](http://xtreemgeek.net/projects/sharptemplate/)，这是一个强类型、超高效的 HTML 模板引擎。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-08-24T06:50:41.197

如果您使用[Rhino](http://www.mozilla.org/rhino/)（JavaScript 的 Java 实现），您也可以在服务器上运行您选择的 JavaScript 模板语言。

您还确定服务器和浏览器模板结果是相同的。（如果模板以 2 种语言实现，则实现之间可能存在一些细微差别。）

...但是现在 5 年后（即 2016 年），使用 Java 8，您将使用 Nashorn，而不是 Rhino。这是 Nashorn 的介绍，如果您向下滚动一点，您会发现 Nashorn + Mustahce 模板语言的示例： [http ://www.oracle.com/technetwork/articles/java/jf14-nashorn-2126515 .html](http://www.oracle.com/technetwork/articles/java/jf14-nashorn-2126515.html)

（我个人通过 Nashorn 使用 React.js 服务器端（但 React 不是模板语言）。）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-07-20T04:42:17.413

远端模板[http://code.google.com/p/distal](http://code.google.com/p/distal) 有点像您的 XSLT 演示，但更简单：

```
<p>Name: <span data-qtext="data.name"></span></p>
<p>Email: <span data-qtext="data.email"></span></p> 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-11-27T06:23:51.647

一个可能有趣的选择是[https://github.com/rexxars/react-markdown](https://github.com/rexxars/react-markdown)，这是一种在基于 React 的 Web UI 中包含 markdown 的相当有趣的方式。我已经对其进行了测试，效果相当不错，尽管文档让我了解到 HTML 渲染在 3.x 分支中遇到了一些问题。尽管如此，对于某些用途来说，这似乎是一个可行的选择。

# javascript - 访问创建的 DOM 元素

> ID：128954
> 
> 赞同：2
> 
> 时间：2008-09-24T18:34:09.610
> 
> 标签：javascript, jquery, html, dom

我有代码可以在单击按钮时创建另一个“行”（带输入的 div）。我正在创建新的输入元素，一切正常，但是，我找不到访问这些新元素的方法。

示例：我有输入元素（下面的 name_1）。然后我使用 javascript 的`createElement`函数创建另一个输入元素（下面的 name_2）。

```
<input type='text' id='name_1' name="name_1" />
<input type='text' id='name_2' name="name_2" /> 
```

同样，我很好地创建了元素，但我希望能够在用户创建和修改 name_2 后访问它的值。例子：`document.getElementById('name_2');`

这行不通。如何让 DOM 识别新元素？是否可以？

我的代码示例（使用 jQuery）：

```
function addName(){
var parentDiv = document.createElement("div");
$(parentDiv).attr( "id", "lp_" + id );

var col1 = document.createElement("div");
var input1 = $( 'input[name="lp_name_1"]').clone(true);
$(input1).attr( "name", "lp_name_" + id );
$(col1).attr( "class", "span-4" );
$(col1).append( input1 );

$(parentDiv).append( col1 );

$('#main_div').append(parentDiv);
} 
```

我使用过 jQuery 和 JavaScript 选择器。示例：`$('#lp_2').html()`返回 null。也一样`document.getElementById('lp_2');`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T18:36:21.710

您必须使用 appendChild 等函数创建元素并将其添加到 DOM。有关详细信息，请参见[此处](http://www.w3schools.com/htmldom/dom_methods.asp)。

我的猜测是您调用了 createElement() 但从未将它添加到您的 DOM 层次结构中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T18:37:09.510

如果它被正确添加到 dom 树中，您将能够使用 document.getElementById 查询它。但是浏览器错误可能会引起麻烦，因此请使用像 jQuery 这样的 JavaScript 工具包来解决浏览器错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T19:07:57.923

> var input1 = $('input[name="lp_name_1"]').clone(true);

您发布的代码未指示任何具有该名称属性的元素。在这部分之前，您创建了一个具有相似**id**`$("#lp_1")`属性的元素，但您将使用它来选择它，即使在您将其插入文档之前也无法正常工作，直到之后您才这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T19:08:57.030

```
var input1 = $( 'input[name="lp_name_1"]').clone(true); 
```

应该

```
var input1 = $( 'input[@name="lp_name_1"]').clone(true); 
```

首先尝试一下，检查 input1 是否确实返回了某些内容（可能是某种调试语句），以确保这不是问题。

编辑：刚刚被告知这仅适用于旧版本的 JQuery，所以请忽略我的建议。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T19:40:13.167

非常感谢您的回答。在离开并回到我的代码后，我注意到我犯了一个错误。我有两个以不同方式添加行的函数。我“100% 确定”我调用的是正确的（我发布的代码示例），但可惜我不是。

对于那些也遇到问题的人，我想说我收到的所有答案都是一个很好的开始，并且我已经将它们用于调试，它们将确保您的代码的正确性。

我的代码示例对于我的需要是 100% 正确的，我只需要调用它。（呃！）

再次感谢你的帮助，

-杰米

# sql - 在 SQL 或 MySQL 中不使用 JOIN 关键字的连接是否有问题？

> ID：128965
> 
> 赞同：42
> 
> 时间：2008-09-24T18:36:12.320
> 
> 标签：sql, mysql, join

当我开始编写数据库查询时，我还不知道 JOIN 关键字，自然我只是扩展了我已经知道的内容并编写了如下查询：

```
SELECT a.someRow, b.someRow 
FROM tableA AS a, tableB AS b 
WHERE a.ID=b.ID AND b.ID= $someVar 
```

现在我知道这与 INNER JOIN 相同，我在我的代码中找到了所有这些查询，并问自己是否应该重写它们。它们有异味还是它们很好？

* * *

**我的答案摘要**：这个查询没有任何问题，但是使用关键字很可能会使代码更具可读性/可维护性。

**我的结论**：我不会改变我的旧查询，但我会更正我的写作风格并在未来使用关键字。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-24T19:43:40.067

在某些常见情况下，仅使用过滤连接`WHERE`可能效率极低。例如：

```
SELECT * FROM people p, companies c 
    WHERE p.companyID = c.id AND p.firstName = 'Daniel' 
```

大多数数据库将直接执行此查询，首先获取and表的[笛卡尔积](http://en.wikipedia.org/wiki/Cartesian_product)，*然后*通过具有匹配和字段的那些进行过滤。虽然完全无约束的乘积只存在于内存中，并且只存在片刻，但它的计算确实需要一些时间。`people``companies`*`companyID``id`*

 *更好的方法是将约束与`JOIN`相关的 s 分组。这不仅在主观上更容易阅读，而且效率更高。因此：

```
SELECT * FROM people p JOIN companies c ON p.companyID = c.id
    WHERE p.firstName = 'Daniel' 
```

它有点长，但数据库能够查看该`ON`子句并使用它直接计算完全约束`JOIN`，而不是从*所有内容*开始然后限制。这计算速度更快（尤其是对于大型数据集和/或多表连接）并且需要更少的内存。

我更改了我看到的每个使用“逗号`JOIN`”语法的查询。在我看来，它存在的唯一目的是简洁。考虑到性能影响，我认为这不是一个令人信服的理由。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-24T18:41:26.067

更详细`INNER JOIN, LEFT OUTER JOIN, RIGHT OUTER JOIN, FULL OUTER JOIN`的来自用于连接的 ANSI SQL/92 语法。对我来说，这种冗长使开发人员/DBA 更清楚地了解加入的意图。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-24T18:51:31.067

在 SQL Server 中总是有查询计划要检查，文本输出可以如下：

```
SET SHOWPLAN_ALL ON
GO

DECLARE @TABLE_A TABLE
(
    ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    Data VARCHAR(10) NOT NULL
)
INSERT INTO @TABLE_A
SELECT 'ABC' UNION 
SELECT 'DEF' UNION
SELECT 'GHI' UNION
SELECT 'JKL' 

DECLARE @TABLE_B TABLE
(
    ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    Data VARCHAR(10) NOT NULL
)
INSERT INTO @TABLE_B
SELECT 'ABC' UNION 
SELECT 'DEF' UNION
SELECT 'GHI' UNION
SELECT 'JKL' 

SELECT A.Data, B.Data
FROM
    @TABLE_A AS A, @TABLE_B AS B
WHERE
    A.ID = B.ID

SELECT A.Data, B.Data
FROM
    @TABLE_A AS A
    INNER JOIN @TABLE_B AS B ON A.ID = B.ID 
```

现在我将省略表变量创建的计划，但两个查询的计划是相同的：

```
 SELECT A.Data, B.Data  FROM   @TABLE_A AS A, @TABLE_B AS B  WHERE   A.ID = B.ID
  |--Nested Loops(Inner Join, OUTER REFERENCES:([A].[ID]))
       |--Clustered Index Scan(OBJECT:(@TABLE_A AS [A]))
       |--Clustered Index Seek(OBJECT:(@TABLE_B AS [B]), SEEK:([B].[ID]=@TABLE_A.[ID] as [A].[ID]) ORDERED FORWARD)
 SELECT A.Data, B.Data  FROM   @TABLE_A AS A   INNER JOIN @TABLE_B AS B ON A.ID = B.ID
  |--Nested Loops(Inner Join, OUTER REFERENCES:([A].[ID]))
       |--Clustered Index Scan(OBJECT:(@TABLE_A AS [A]))
       |--Clustered Index Seek(OBJECT:(@TABLE_B AS [B]), SEEK:([B].[ID]=@TABLE_A.[ID] as [A].[ID]) ORDERED FORWARD) 
```

所以，简短的回答 - 无需重写，除非您每次维护它们时都花很长时间尝试阅读它们？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-24T18:41:18.937

它更像是一种语法选择。我更喜欢将我的连接条件与我的连接分组，因此我使用 INNER JOIN 语法

```
SELECT a.someRow, b.someRow
FROM tableA AS a
INNER JOIN tableB AS b
  ON a.ID = b.ID
WHERE b.ID = ? 
```

（？作为占位符）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-24T18:40:27.630

您的示例中的语法没有任何问题。'INNER JOIN' 语法通常被称为 'ANSI' 语法，并出现在您的示例中说明的样式之后。它的存在是为了澄清连接的类型/方向/成分，但通常在功能上与您所拥有的没有什么不同。

对“ANSI”连接的支持是每个数据库平台的，但如今它或多或少是通用的。

附带说明一下，“ANSI”语法的一个新增功能是“FULL OUTER JOIN”或“FULL JOIN”。

希望这可以帮助。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-24T19:46:40.327

一般来说：

使用 JOIN 关键字链接（即“加入”）主键和外键。

使用 WHERE 子句将结果集限制为仅包含您感兴趣的记录。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-24T19:49:26.247

可能出现的一个问题是，当您尝试在同一查询中将旧的“逗号样式”联接与 SQL-92 联接混合使用时，例如，如果您需要一个内部联接和另一个外部联接。

```
SELECT *
FROM table1 AS a, table2 AS b
 LEFT OUTER JOIN table3 AS c ON a.column1 = c.column1
WHERE a.column2 = b.column2; 
```

问题是最近的 SQL 标准说 JOIN 在逗号连接之前进行评估。因此，在 ON 子句中对“a”的引用会产生错误，因为尚未定义相关名称，因为正在评估该 ON 子句。这是一个非常令人困惑的错误。

解决方案是不要混合这两种连接方式。您可以在旧代码中继续使用逗号样式，但如果您编写新查询，请将所有联接转换为 SQL-92 样式。

```
SELECT *
FROM table1 AS a
 INNER JOIN table2 AS b ON a.column2 = b.column2
 LEFT OUTER JOIN table3 AS c ON a.column1 = c.column1; 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-17T22:00:42.137

在旧的连接语法中要考虑的另一件事是，由于没有 on 子句，因此很容易意外地获得笛卡尔连接。如果 Distinct 关键字在查询中并且它使用旧式连接，请将其转换为 ANSI 标准连接，然后查看是否仍需要 distinct。如果您以这种方式修复意外的笛卡尔连接，则可以通过重写以指定连接和连接字段来极大地提高性能。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-24T18:40:51.560

我避免隐式连接；当查询非常大时，它们会使代码难以破译

使用显式连接和良好的格式，代码在不需要注释的情况下更具可读性和可理解性。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-24T18:59:30.393

这还取决于您是以这种方式进行内部联接还是外部联接。例如，用于 WHERE 子句（=* 和 *=）中的外部连接的 MS SQL Server 语法可能会产生与 OUTER JOIN 语法不同的结果，并且不再受支持 ( [http://msdn.microsoft.com/en-us /library/ms178653(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms178653(SQL.90).aspx) ) 在 SQL Server 2005 中。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-11-10T09:48:46.267

**表演呢？？？**

事实上，性能是 RDBMS 中一个非常重要的问题。

所以问题是*什么是最高效的......使用 JOIN 或在 WHERE 子句中加入表？*

因为优化器（或PG中所说的planer ...）普通的做得很好，两个执行计划是相同的，所以执行查询时的性能将是相同的......

**但魔鬼隐藏在一些细节中......**

所有优化器都有有限的时间或有限的工作量来找到最佳计划......当达到限制时，结果是所有计算计划中的最佳计划，而不是所有可能的计划中更好的计划！

现在的问题是*，当我使用 WHERE 子句而不是 JOIN 来连接表时，我是否会浪费时间？*

答案是**肯定**的！

是的，因为关系引擎使用的关系代数只知道 JOIN 运算符，而不是 WHERE 子句中的伪连接。因此，优化器（实际上是解析器或 algrebriser）所做的第一件事就是重写查询……这会失去一些获得最佳计划的机会！

在我漫长的 RDBMS 职业生涯中（40 年......），我已经两次看到这个问题

# c - 如何在 fopen 中使用 scanf()

> ID：128981
> 
> 赞同：1
> 
> 时间：2008-09-24T18:38:44.577
> 
> 标签：c, fopen, scanf

我正在编写一个程序，并且无法同时使用 scanf 和 fopen 。

据我所知，我的错误线路似乎是：

```
FiLE * DataFile
DataFile = fopen("StcWx.txt","r");
scanf(DataFile, "%i %i %i %.2f %i %i", &Year, &Month, &Day, &Precip, &High, &Low); 
```

它打开的文件有一个天气数据列表，如下所示：

```
1944    4   12  0   58  24
1944    4   13  0.4 58  29
1944    4   14  0.54    42  29
1944    4   15  0   43  27 
```

（这些空格是制表符）

显示的错误是“[警告]从不兼容的指针类型传递 `scanf' 的 arg 1”

谁能帮我？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-24T18:39:52.047

我想你想要[**fscanf**](http://en.wikipedia.org/wiki/Scanf#fscanf)而不是[**scanf**](http://en.wikipedia.org/wiki/Scanf)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-26T07:00:55.487

您的代码看起来应该使用 fscanf，而不是 scanf。

我强烈建议使用 fgets 和 sscanf 而不是直接调用 fscanf。

fscanf 可能会以使您怀疑文件指针所在位置的方式失败。使用 fgets 获取整行并使用 sscanf 扫描字符串意味着您始终知道文件指针的状态，并且很容易备份到行的开头（字符串仍在内存中）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T18:40:11.030

您使用了错误的功能。你应该使用`fscanf`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-08T10:42:59.600

怎么样：

`freopen ("StcWx.txt","r",stdin);`

`scanf("%i %i %i %.2f %i %i", &Year, &Month, &Day, &Precip, &High, &Low);`

[http://www.cplusplus.com/reference/cstdio/freopen/](http://www.cplusplus.com/reference/cstdio/freopen/)

# c# - 来自 C# 中的基本 URL + 相对 URL 的绝对 URL

> ID：128990
> 
> 赞同：29
> 
> 时间：2008-09-24T18:39:51.283
> 
> 标签：c#, .net, url, path

我有一个基本网址：

```
http://my.server.com/folder/directory/sample 
```

还有一个相对的：

```
../../other/path 
```

如何从中获取绝对 URL？使用字符串操作非常简单，但我想以安全的方式使用`Uri`类或类似的东西来做到这一点。

它适用于标准的 C# 应用程序，而不是 ASP.NET 应用程序。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-24T18:41:13.337

```
var baseUri = new Uri("http://my.server.com/folder/directory/sample");
var absoluteUri = new Uri(baseUri,"../../other/path"); 
```

或者

```
Uri uri;
if ( Uri.TryCreate("http://base/","../relative", out uri) ) doSomething(uri); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-07-19T15:22:58.597

有些人可能正在寻找允许在调试时“即时”转换 url 的 Javascript 解决方案

```
var absoluteUrl = function(href) {
    var link = document.createElement("a");
    link.href = href;
    return link.href;
} 
```

像这样使用：

`absoluteUrl("http://google.com")`

> `http://google.com/`

或者

`absoluteUrl("../../absolute")`

> `http://stackoverflow.com/absolute`

# visual-studio - Visual Studio 相对参考路径

> ID：128998
> 
> 赞同：6
> 
> 时间：2008-09-24T18:40:41.030
> 
> 标签：visual-studio

我通常格式化我的项目目录，如 JP Boodhoo。一个包含解决方案文件的主目录，然后是所有第三方库的 lib 文件夹，一个 src 目录，一个用于不会部署的第三方的工具库....[有关更多信息，请查看此处](http://blog.jpboodhoo.com/DirectoryStructureForProjects.aspx)

我在我的项目中为所有需要的文件夹设置了参考路径，但是如果开发人员签出主干，他必须设置所有参考路径。有没有办法简化这个？

我使用的是 Visual Studio 2008。

谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T18:55:09.233

我不确定您使用哪种 Visual Studio 语言，但如果它是 C++，那么文件路径将存储在项目文件中，该`.vcproj`项目文件也应受版本控制。（注意：`.sln`解决方案文件不存储路径设置）如果您小心使用相对路径，而不是绝对路径，它应该很容易在多个开发人员之间共享。

在 Visual C++ 2008 中，[项目文件是 XML](http://msdn.microsoft.com/en-us/library/2208a1f2.aspx)，因此您可以直接编辑它们。如果您想变得非常花哨，可以使用[`.vsprops`属性表](http://msdn.microsoft.com/en-us/library/a4xbdz1e.aspx)进行额外控制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T21:32:28.667

我使用网络上的共享文件夹来存储类似的东西。并给予该文件夹完全信任。在 PDC 上，我只有一个适当映射的登录脚本。它可能不是最好的方法，但它对我有用，没有任何问题。

我过去使用的另一个解决方案是在每台机器上的所有依赖项所在的公共文件夹，并让它与某种工具同步。我使用带有同步功能的台式机和笔记本电脑选项附带的 Backup Exec，但其他东西也可以。*********