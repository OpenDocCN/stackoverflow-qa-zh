# StackOverflow 问答 11000-11999

# sql - SQL中显式Join Transitive Closure的优点是什么？

> ID：11028
> 
> 赞同：4
> 
> 时间：2008-08-14T13:44:43.357
> 
> 标签：sql

当我通过一个公共列将三个或更多表连接在一起时，我会这样写我的查询：

```
SELECT *
FROM   a, b, c
WHERE  a.id = b.id
AND    b.id = c.id 
```

一位同事最近问我为什么我没有在这样的查询中明确*加入传递闭包*：

```
SELECT *
FROM   a, b, c
WHERE  a.id = b.id
AND    b.id = c.id
AND    c.id = a.id 
```

这真的有什么好处吗？优化器肯定可以为自己暗示这一点吗？

*编辑：我知道这是邪恶的语法，但它是合法遗留代码的一个快速而肮脏的例子 +1 [@Stu](https://stackoverflow.com/questions/11028/what-are-the-advantages-of-explicit-join-transitive-closure-in-sql#11114)清理它*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-14T13:53:33.963

您不需要在当今的数据库引擎中执行此操作，但曾经有一段时间，这样的事情会为查询优化器提供更多关于可能的索引路径的提示，从而获得更快的结果。

如今，无论如何，整个语法都会消失。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-14T14:30:39.007

这是肮脏、邪恶的遗留语法。你把它写成

> ```
> Select
>   *  -- Oh, and don't ever use *, either
> From
>   A 
>   Inner Join B On A.ID = B.ID
>   Inner Join C On B.ID = C.ID 
> ```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-14T13:46:23.790

没有这种语法源于加入语言之前的日子。不确定与它相关的问题，但肯定有更支持连接表的语言结构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-14T13:48:30.777

如果您从数学的角度来看它，您的示例应该会产生相同的结果。

a = b = c

因此，您的第一个示例将产生与第二个示例相同的结果，因此无需做额外的工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-14T13:50:39.430

我只想说，这种加入是魔鬼的工作。
考虑一下; 加入和过滤的条件在 where 语句中混合在一起。
当您需要连接 20 个表并过滤 15 个值时会发生什么？

再一次，只是我的 $.02

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-14T13:51:24.250

在 Microsoft SQL 中，这两个查询的查询计划是相同的——它们以相同的方式执行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-06T11:10:02.300

这个问题与这里的这个问题相似，并有非常深入的解释：

[来自 Joel Spolsky 文章的 SQL 问题](https://stackoverflow.com/questions/397089/sql-question-from-joel-spolsky-article)

简短的回答是，传递性属性的显式声明可能会加快查询速度。这是因为查询优化不是一项简单的任务，某些 SQL 服务器可能会遇到问题。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-08-14T17:46:36.303

不过，该语法有其用途……有时您会发现需要在多个字段上连接两个表

# sql - SQL 表别名 - 好还是坏？

> ID：11043
> 
> 赞同：44
> 
> 时间：2008-08-14T13:53:33.467
> 
> 标签：sql, alias

在 SQL 中使用表别名的优缺点是什么？我个人尽量避免使用它们，因为我认为它们会降低代码的可读性（尤其是在阅读大型 where/and 语句时），但我很想听听对此的任何反驳。什么时候使用表别名通常是个好主意，你有什么首选的格式吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-08-14T13:56:45.207

在处理高度规范化的模式时，表别名是必不可少的。例如，我不是这个数据库的架构师，所以请多多包涵，它可能需要 7 次连接才能得到一个干净完整的记录，其中包括一个人的姓名、地址、电话号码和公司隶属关系。

我倾向于使用短词别名，而不是标准的单字符别名，所以上面示例的 SQL 最终看起来像：

```
select person.FirstName
      ,person.LastName
      ,addr.StreetAddress
      ,addr.City
      ,addr.State
      ,addr.Zip
      ,phone.PhoneNumber
      ,company.CompanyName
from tblPeople person
left outer join tblAffiliations affl on affl.personID = person.personID
left outer join tblCompany company on company.companyID = affl.companyID 
```

... ETC

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-08-14T13:55:54.100

好吧，在某些情况下您*必须*使用它们，例如当您需要在一个查询中两次连接到同一个表时。

它还取决于您是否在表中具有唯一的列名。在我们的旧数据库中，所有列都有 3 个字母的前缀，源自表中的缩写形式，仅仅是因为我们曾经兼容的一个古老的数据库系统并不能很好地支持表别名。

如果您的列名出现在多个表中，则必须将表名指定为列引用的一部分，因此表别名将允许使用更短的语法。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2011-06-09T21:40:25.507

我是这里唯一真正讨厌他们的人吗？

通常，除非必须，否则我不会使用它们。我真的很讨厌不得不阅读类似的东西

```
select a.id, a.region, a.firstname, a.blah, b.yadda, b.huminahumina, c.crap
from table toys as a
inner join prices as b on a.blah = b.yadda
inner join customers as c on c.crap = something else
etc 
```

当我阅读 SQL 时，我想确切地知道我在阅读时选择了什么；别名实际上让我更加困惑，因为在我真正得到表名之前，我必须通过列的行，这通常表示有关别名没有的数据的信息。如果你做了别名也许没关系，但我经常阅读 StackOverflow 上的问题，其中的代码似乎无缘无故地使用别名。（此外，有时，有人会在语句中创建别名但不使用它。为什么？）

我认为表格别名被使用得如此之多，因为很多人不喜欢打字。不过，我不认为这是一个很好的借口。这个借口是我们最终得到糟糕的变量命名、糟糕的函数首字母缩写词、糟糕的代码的原因......我会花时间输入全名。不过，我是一个快速打字员，所以也许这与它有关。（也许将来，当我有腕管时，我会重新考虑我对别名的看法。：P）我特别讨厌在 PHP 代码中运行表别名，我相信绝对没有理由必须这样做 -你只需要输入一次！

我总是在我的语句中使用列限定符，但我不反对输入很多，所以我很乐意多次输入全名。（当然，我确实滥用了 MySQL 的制表符补全。）除非这是我必须使用别名的情况（如其他答案中描述的一些），否则我发现额外的抽象层很麻烦且不必要。

**编辑：（**一年多后）我正在处理一些使用别名的存储过程（我没有写它们，我是这个项目的新手），它们有点痛苦。我意识到我不喜欢别名的原因是因为它们是如何定义的。您知道在作用域的顶部声明变量通常是一种很好的做法吗？（通常在一行的开头？） SQL 中的别名不遵循这个约定，这让我咬牙切齿。因此，我必须在整个代码中搜索单个别名以找出它的位置（令人沮丧的是，我必须在找到别名声明之前通读逻辑）。如果不是这样，老实说，我可能会更喜欢这个系统。

如果我曾经编写过其他人必须处理的存储过程，我会将别名定义放在文件开头的注释块中，作为参考。老实说，我无法理解没有它你们怎么不会发疯。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-05T17:34:30.577

# 好的

正如之前多次提到的那样，为*所有*列名添加前缀以轻松查看哪个列属于哪个表是一个好习惯 - 别名比完整的表名短，因此查询更易于阅读和理解。当然，如果您使用良好的别名方案。

如果您创建或阅读应用程序的代码，该应用程序使用外部存储或动态生成的表名，那么如果没有别名，乍一看真的很难分辨出所有这些“%s”或其他占位符代表什么。这不是极端情况，例如许多 Web 应用程序允许在安装时自定义表名前缀。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-08-14T14:00:26.570

Microsoft SQL 的查询优化器受益于使用完全限定名称或别名。

我个人更喜欢别名，除非我有很多表，否则它们往往是单字母的。

```
--seems pretty readable to me ;-)
select a.Text
from Question q
    inner join Answer a
        on a.QuestionId = q.QuestionId 
```

Sql 字符串的执行时间也有实际限制——别名使这个限制更容易避免。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-08-14T14:02:40.153

如果我自己编写查询（通过在编辑器中输入而不是使用设计器），我总是为表名使用别名，这样我只需要输入一次完整的表名。

我真的很讨厌阅读由设计人员生成的查询，其中完整的表名作为每个列名的前缀。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-08-18T10:00:42.597

我想唯一真正反对他们的是过度抽象。如果您对别名所指的内容有一个很好的了解（良好的命名会有所帮助；“a”、“b”、“c”可能会产生很大的问题，尤其是当您在数月或数年后阅读该声明时），我认为没有错有别名。

正如其他人所说，如果您多次使用同一个表（或视图） ，则连接*需要它们，但即使在这种情况之外，别名也可以用来阐明数据源在特定上下文中的用途。*在别名的名称中，尝试回答您访问特定数据的*原因，而不是数据是**什么*。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-11-08T17:50:52.997

我喜欢别名！！！！我已经使用它们与不使用它们进行了一些测试，并且已经看到了一些处理收益。我的猜测是，当您处理更大的数据集和复杂的嵌套查询时，处理增益会比没有处理时更高。如果我能够对此进行测试，我会告诉你的。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-08-14T13:57:54.813

如果要将表连接到自身，或者在子查询中再次使用该列，则需要它们...

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-08-25T18:40:45.393

如果您认为我的组织具有如下表名，则别名非常好：SchemaName.DataPointName_SubPoint_Sub-SubPoint_Sub-Sub-SubPoint... 我的团队使用一组非常标准的缩写，因此可以最大限度地减少猜测。我们会说 ProgramInformationDataPoint 缩短为 pidp，而提交只是 sub。

好消息是，一旦你以这种方式开始并且人们同意它，它会使那些 HAYUGE 文件更小并且更易于管理。至少对我来说，用更少的字符来传达相同的信息似乎对我的大脑来说更容易一些。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-14T13:56:07.517

恕我直言，有意义的短表名并不重要，我有时在数据库中工作过，其中表名可能是 VWRECOFLY 或其他一些真正代表用户的随机字符串（由公司政策规定），所以在在那种情况下，我发现别名确实有助于使代码更易读。（users.username 比 VWRECOFLY.username 更有意义）

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-08-14T13:57:33.957

我喜欢长的显式表名（超过 100 个字符并不少见），因为我使用了许多表，如果名称不明确，我可能会对每个表存储的内容感到困惑。

因此，当我编写查询时，我倾向于使用在查询范围内有意义的较短别名，这使代码更具可读性。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-08-18T20:07:51.030

我总是在查询中使用别名，它是我公司代码指南的一部分。首先，当连接表中存在具有相同名称的列时，您需要别名或表名。在我看来，别名提高了复杂查询的可读性，让我可以快速查看每列的位置。我们甚至在单表查询中使用别名，因为经验表明单表查询不会长时间保持单表。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-08-14T14:33:56.753

我总是使用别名，因为要在 MSSQL 上获得适当的性能，您需要始终使用模式作为前缀。所以你会看到很多

> 从 dbo.Person 中选择
> Person.Name 作为 Person

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-08-18T09:47:16.757

我在编写查询时总是使用别名。通常我会尝试将表名缩写为 1 或 2 个代表字母。所以用户变成了你，债务人交易变成了dt等等......

它节省了打字时间，但仍然具有一定的意义。

较短的名称也使我更容易阅读。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-14T17:57:24.983

如果您不使用别名，那么它就是您的代码中的一个错误，它正在等待发生。

```
SELECT Description -- actually in a
 FROM
 table_a a,
 table_b b
 WHERE
 a.ID = b.ID 
```

当您执行一些小操作时会发生什么，例如向 Table_B 添加一个名为 Description 的列。没错，你会得到一个错误。添加一列不需要破坏任何东西。我从未将编写好的代码、无错误的代码视为必要的邪恶。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-08-15T15:45:37.147

连接具有相同名称的列的表时需要别名。

# excel - 刷新 Excel VBA 函数结果

> ID：11045
> 
> 赞同：77
> 
> 时间：2008-08-14T13:54:43.947
> 
> 标签：excel, vba, user-defined-functions

如何让用户定义的函数根据电子表格中更改的数据重新评估自己？

我试过**`F9`**了**`Shift`+`F9`**。

唯一可行的方法是使用函数调用编辑单元格，然后按 Enter。

* * *

## 回答 #1

> 赞同：132
> 
> 时间：2008-08-15T06:18:51.387

您应该`Application.Volatile`在函数的顶部使用：

```
Function doubleMe(d)
    Application.Volatile
    doubleMe = d * 2
End Function 
```

然后，只要工作簿更改（如果您的计算设置为自动），它将重新评估。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-09-07T16:11:58.090

有关在 Excel 中计算的 F9 键盘快捷键的更多信息

*   `F9` 重新计算所有打开的工作簿中的所有工作表
*   `Shift`+`F9` 重新计算活动工作表
*   `Ctrl`+ `Alt`+`F9` 重新计算所有打开的工作簿中的所有工作表（完全重新计算）
*   `Shift`+ `Ctrl`+ `Alt`+`F9`重建依赖树并进行完整的重新计算

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-08-14T13:59:21.643

好的，我自己找到了这个。您可以使用`Ctrl`++`Alt`来`F9`完成此操作。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-23T11:12:34.080

如果您在 UDF 参数列表中包含对电子表格数据的所有引用，则每当引用的数据发生更改时，Excel 都会重新计算您的函数：

```
Public Function doubleMe(d As Variant)
    doubleMe = d * 2
End Function 
```

您也可以使用`Application.Volatile`，但这具有使您的 UDF 始终重新计算的缺点 - 即使它不需要，因为引用的数据没有更改。

```
Public Function doubleMe()
    Application.Volatile
    doubleMe = Worksheets("Fred").Range("A1") * 2
End Function 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-12-03T19:22:59.960

要切换到自动：

```
Application.Calculation = xlCalculationAutomatic 
```

要切换到手动：

```
Application.Calculation = xlCalculationManual 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-06-10T00:29:57.110

这比 刷新计算更好`Range(A:B).Calculate`：

```
Public Sub UpdateMyFunctions()
    Dim myRange As Range
    Dim rng As Range

    ' Assume the functions are in this range A1:B10.
    Set myRange = ActiveSheet.Range("A1:B10")

    For Each rng In myRange
        rng.Formula = rng.Formula
    Next
End Sub 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-11-21T08:20:20.443

`Application.Volatile`不适用于使用我自己的函数重新计算公式。我使用以下功能： `Application.CalculateFull`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-09-13T20:17:47.507

我发现最好只在更改特定单元格时更新计算。这是放置在“工作表”“更改”事件中的示例 VBA 代码：

```
Private Sub Worksheet_Change(ByVal Target As Range)
  If Not Intersect(Target, Range("F3")) Is Nothing Then
    Application.CalculateFull
  End If
End Sub 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-22T12:01:38.523

```
Public Sub UpdateMyFunctions()
    Dim myRange As Range
    Dim rng As Range

    'Considering The Functions are in Range A1:B10
    Set myRange = ActiveSheet.Range("A1:B10")

    For Each rng In myRange
        rng.Formula = rng.Formula
    Next
End Sub 
```

# database - 这样的数据库会有多大？

> ID：11055
> 
> 赞同：4
> 
> 时间：2008-08-14T13:57:20.227
> 
> 标签：database, oracle

我试图弄清楚某个数据库有多大（它尚未创建）。我知道有多少行和表格。Oracle 中是否有一个功能可以告诉我这种理论数据库的大小？我可以使用一个已知的数学公式吗？我知道有一个功能可以确定现有数据库的大小，但我想在创建它之前知道它有多大。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-14T14:34:49.763

您可以尝试对您的设计进行原型设计 - 创建数据库的初始版本并编写一些脚本（或使用工具）以使用合理数量的数据填充表。然后您将确定 X 行占用了多少空间。如果太多，你可以带着你的设计回到绘图板上。我知道您在创建数据库之前需要一个数字，但是您永远无法解释引擎盖下物理数据文件发生的所有事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-14T14:07:27.307

您可以从表中列的数据类型的大小。然后，您可以粗略估计该表中行的大小。然后对于 1 到 n 个表，然后对于 1 个表中的 1 行，对于 x 个表中的 x 行 = 给定行大小的数据库估计值。

长手我知道，但这就是我通常这样做的方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-14T14:36:30.477

准确地说，这可能会变得非常复杂。例如，这就是您在 MS SQL Server 上执行此操作的方式：

[http://msdn.microsoft.com/en-us/library/aa933068(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa933068(SQL.80).aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-17T23:22:37.067

您还需要在估算中包含索引。我见过索引与数据一样大的系统。我相信答案的唯一方法是像 Eric Z Beard 建议的那样进行原型设计。不同的数据库系统有不同的开销，但它们都有。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-14T15:21:51.867

有一个确切的尺寸并不太重要，所以我采用了 littlegeek 的方法。我弄清楚了我的表和列将是什么，并[查看了数据类型的大小](http://lbd.epfl.ch/f/teaching/courses/oracle8i/server.815/a68003/01_04blt.htm)，然后做了一些很好的 'ole 乘法。

# c++ - 我应该如何对代码生成器进行单元测试？

> ID：11060
> 
> 赞同：28
> 
> 时间：2008-08-14T13:59:21.533
> 
> 标签：c++, python, unit-testing, code-generation, swig

我知道这是一个困难且开放式的问题，但我想我会把它扔到地板上，看看是否有人有任何有趣的建议。

我开发了一个代码生成器，它将我们的 python 接口与我们的 C++ 代码（通过 SWIG 生成）相结合，并生成将其公开为 WebServices 所需的代码。当我开发这段代码时，我是使用 TDD 完成的，但我发现我的测试非常脆弱。因为每个测试本质上都想验证对于给定的输入代码位（恰好是 C++ 标头）我会得到给定的输出代码位我编写了一个小引擎，它从 XML 输入文件中读取测试定义并生成测试来自这些期望的案例。

问题是我根本不敢修改代码。那以及单元测试本身是a：复杂和b：脆弱的事实。

所以我试图想出解决这个问题的替代方法，这让我感到震惊，我可能是以错误的方式解决它。也许我需要更多地关注结果，IE：我生成的代码是否真正运行并执行我想要的操作，而不是代码看起来像我想要的那样。

有没有人有类似的经历，他们愿意分享？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-14T14:04:25.800

我开始用我自己的代码生成器写下我的经验总结，然后回去重新阅读你的问题，发现你自己已经触及了同样的问题，专注于执行结果而不是代码布局/外观。

问题是，这很难测试，生成的代码可能不适合在单元测试系统的环境中实际运行，你如何编码预期的结果？

我发现您需要将代码生成器分解成更小的部分并对它们进行单元测试。如果你问我，单元测试一个完整的代码生成器更像是集成测试而不是单元测试。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-14T18:15:42.733

回想一下，“单元测试”只是一种测试。您应该能够对代码生成器的**内部**部分进行单元测试。您在这里真正看到的是系统级测试（也称为回归测试）。这不仅仅是语义......还有不同的心态、方法、期望等。当然还有更多的工作，但你可能需要硬着头皮建立一个端到端的回归测试套件：固定 C++ 文件 -> SWIG接口-> python 模块-> 已知输出。您真的想检查已知输入（固定 C++ 代码）与预期输出（最终 Python 程序的输出）。直接检查代码生成器结果就像区分目标文件......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-14T14:38:19.630

是的，结果是唯一重要的事情。真正的苦差事是编写一个框架，让您生成的代码能够独立运行……花时间在那里。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-14T15:46:01.927

如果您在 *nux 上运行，您可能会考虑转储 unittest 框架以支持 bash 脚本或 makefile。在 Windows 上，您可能会考虑构建一个运行生成器的 shell 应用程序/函数，然后使用代码（作为另一个进程）并对其进行单元测试。

第三种选择是生成代码，然后从中构建一个应用程序，其中只包含一个单元测试。同样，您需要一个 shell 脚本或诸如此类的东西来为每个输入运行它。至于如何对预期行为进行编码，我突然想到，它可以以与仅使用生成的接口而不是 C++ 接口的 C++ 代码相同的方式完成。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T09:41:03.870

只是想指出，您仍然可以在验证结果的同时实现细粒度测试：您可以通过将单个代码块嵌套在一些设置和验证代码中来测试它们：

```
int x = 0;
GENERATED_CODE
assert(x == 100); 
```

如果您将生成的代码由较小的块组装而成，并且这些块不会经常更改，那么您可以练习更多条件并进行更好的测试，并希望在您更改一个块的细节时避免所有测试都中断。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-05-19T23:17:11.220

单元测试就是测试一个特定的单元。因此，如果您正在为 A 类编写规范，那么如果 A 类没有 B 类和 C 类的真正具体版本，那将是理想的。

好的，我后来注意到这个问题的标签包括 C++ / Python，但原理是一样的：

```
 public class A : InterfaceA 
    {   
      InterfaceB b;

      InterfaceC c;

      public A(InterfaceB b, InterfaceC c)   {
          this._b = b;
          this._c = c;   }

      public string SomeOperation(string input)   
      {
          return this._b.SomeOtherOperation(input) 
               + this._c.EvenAnotherOperation(input); 
      } 
    } 
```

由于上述系统 A 向系统 B 和 C 注入了接口，因此您可以只对系统 A 进行单元测试，而无需任何其他系统执行真正的功能。这是单元测试。

这是一种从创建到完成处理系统的巧妙方法，每个行为都有不同的 When 规范：

```
public class When_system_A_has_some_operation_called_with_valid_input : SystemASpecification
{
    private string _actualString;

    private string _expectedString;

    private string _input;

    private string _returnB;

    private string _returnC;

    [It]
    public void Should_return_the_expected_string()
    {
        _actualString.Should().Be.EqualTo(this._expectedString);
    }

    public override void GivenThat()
    {
        var randomGenerator = new RandomGenerator();
        this._input = randomGenerator.Generate<string>();
        this._returnB = randomGenerator.Generate<string>();
        this._returnC = randomGenerator.Generate<string>();

        Dep<InterfaceB>().Stub(b => b.SomeOtherOperation(_input))
                         .Return(this._returnB);
        Dep<InterfaceC>().Stub(c => c.EvenAnotherOperation(_input))
                         .Return(this._returnC);

        this._expectedString = this._returnB + this._returnC;
    }

    public override void WhenIRun()
    {
        this._actualString = Sut.SomeOperation(this._input);
    }
} 
```

所以总而言之，一个单元/规范可以有多种行为，并且规范随着您开发单元/系统而增长；如果您的测试系统依赖于其中的其他具体系统，请当心。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-25T23:56:06.117

我的建议是找出一组已知的输入输出结果，例如您已经拥有的一些更简单的案例，并对*生成的代码进行单元测试*。完全有可能当您更改生成器时，生成的确切字符串可能会略有不同......但您真正关心的是它是否以相同的方式解释。因此，如果您像测试代码一样测试结果，如果它是您的功能，您会发现它是否以您想要的方式成功。

基本上，您真正想知道的是您的生成器是否会产生您期望的结果，而无需对所有可能的组合进行物理测试（也：不可能）。通过确保您的生成器以您期望的方式保持一致，您可以更好地感觉生成器将在越来越复杂的情况下取得成功。

通过这种方式，您还可以构建一套回归测试（需要保持正常工作的单元测试）。这将帮助您确保对生成器的更改不会破坏其他形式的代码。当您遇到单元测试未捕获的错误时，您可能希望包含它以防止类似的破坏。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-07-20T04:10:25.057

我发现你需要测试你正在生成的东西，而不是你如何生成它。

在我的例子中，该程序会生成多种类型的代码（C#、HTML、SCSS、JS 等），这些代码会编译成 Web 应用程序。我发现总体上减少回归错误的最佳方法是测试 Web 应用程序本身，而不是测试生成器。

不要误会我的意思，仍然有单元测试检查一些生成器代码，但我们最大的收获是对生成的应用程序本身的 UI 测试。

由于我们正在生成它，我们还在 JS 中生成了一个很好的抽象，我们可以用它来以编程方式测试应用程序。我们遵循了这里列出的一些想法：http: [//code.tutsplus.com/articles/maintainable-automated-ui-tests--net-35089](http://code.tutsplus.com/articles/maintainable-automated-ui-tests--net-35089)

最重要的是它真正端到端地测试您的系统，从代码生成到您实际生成的内容。一旦测试失败，很容易追踪到发电机坏的地方。

它很甜。

祝你好运！

# perl - 如何在 Perl 中确定祝福引用的类型？

> ID：11085
> 
> 赞同：20
> 
> 时间：2008-08-14T14:11:42.913
> 
> 标签：perl, reference, types

在 Perl 中，对象只是对已被赋予特定类的任何基本 Perl 数据类型的引用。当您在 unblessed 引用上使用 ref() 函数时，您会被告知引用指向的数据类型。但是，当您在祝福引用上调用 ref() 时，您将返回该引用已被祝福的包的名称。

我想知道祝福参考的实际基础类型。我怎样才能确定这一点？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-15T15:54:08.240

`Scalar::Util::reftype()`是最干净的解决方案。该[`Scalar::Util`](http://search.cpan.org/dist/Scalar-List-Utils/lib/Scalar/Util.pm)模块在 5.7 版中添加到 Perl 核心，但可用于 CPAN 的旧版本（5.004 或更高版本）。

您还可以使用以下方法进行探测`UNIVERSAL::isa()`：

```
$x->isa('HASH')             # if $x is known to be an object
UNIVERSAL::isa($x, 'HASH')  # if $x might not be an object or reference 
```

显然，您还必须检查`ARRAY`和`SCALAR`类型。自 Perl 5.003 以来，UNIVERSAL 模块（作为所有对象的基类）一直是核心的一部分。

另一种方法——简单但有点脏——是对引用进行字符串化。假设该类没有重载字符串化，您将得到类似的东西`Class=HASH(0x1234ABCD)`，您可以对其进行解析以提取底层数据类型：

```
my $type = ($object =~ /=(.+)\(0x[0-9a-f]+\)$/i); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-05T12:18:09.637

你可能不应该这样做。对象的底层类型是您不应该混淆的实现细节。你为什么想知道这个？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-03T18:09:51.777

我对此的第一个想法是：“Perl 中的对象总是哈希引用，那么有什么技巧呢？”

但是，Scalar::Util::reftype 就是答案。感谢您在这里提出问题。

这是证明这一点的代码片段..（以防它对任何人有用）。

```
$> perl -e '使用严格；使用警告“全部”；
            我的 $x = [1]; 祝福 ($x, "ABC::Def");
            使用 Data::Dumper；打印转储器 $x;
            打印参考（$x）。"\n";
            使用 Scalar::Util "reftype"; 打印 reftype($x) 。"\n"'`

```

输出：

```
$VAR1 = 祝福（[
                 1
               ], 'ABC::Def' );
ABC::定义
大批

```

# java - 解决所有 Java 字节都已签名这一事实的最佳方法是什么？

> ID：11088
> 
> 赞同：59
> 
> 时间：2008-08-14T14:14:03.940
> 
> 标签：java, byte, unsigned, signed

在 Java 中，没有无符号字节之类的东西。

处理一些低级代码时，有时您需要处理无符号值大于 128 的字节，这会导致 Java 将它们解释为负数，因为 MSB 用于符号。

解决这个问题的好方法是什么？（说不使用 Java 不是一种选择）

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2008-08-21T01:17:45.400

如果您这样做，实际上可以摆脱 if 语句和添加。

```
byte[] foobar = ..;
int value = (foobar[10] & 0xff); 
```

这样，Java 就不会将字节解释为负数，也不会翻转整数上的符号位。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-08-14T14:24:50.453

从数组中读取任何单个值时，将其复制为 short 或 int 之类的内容，然后手动将负数转换为应有的正值。

```
byte[] foobar = ..;
int value = foobar[10];
if (value < 0) value += 256 // Patch up the 'falsely' negative value 
```

您可以在写入数组时进行类似的转换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-19T08:03:27.637

使用 int 通常比使用 short 更好，因为 java 在内部无论如何都使用 32 位值（即使是字节，除非在数组中），因此使用 int 将避免不必要地转换到字节码中的短值/从短值转换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-14T14:22:24.997

可能您最好的选择是使用整数而不是字节。它有空间允许大于 128 的数字，而无需创建特殊对象来替换字节的开销。

这也是比我聪明的人建议的（每个人）

*   [http://www.darksleep.com/player/JavaAndUnsignedTypes.html](http://www.darksleep.com/player/JavaAndUnsignedTypes.html)
*   [http://www.jguru.com/faq/view.jsp?EID=13647](http://www.jguru.com/faq/view.jsp?EID=13647)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-19T03:39:43.473

进行位操作/无符号字节的最佳方法是使用**int** s。即使它们是有符号的，它们也有大量的备用位（总共 32 个）可以视为无符号字节。此外，所有数学运算符都会将较小的固定精度数转换为**int**。例子：

```
short a = 1s;
short b = 2s;
int c = a + b; // the result is up-converted
short small = (short)c; // must cast to get it back to short 
```

因此，最好只使用整数并对其进行屏蔽以获取您感兴趣的位。示例：

```
int a = 32;
int b = 128;
int foo = (a + b) | 255; 
```

这是有关 Java 原始类型的更多信息[http://mindprod.com/jgloss/primitive.html](http://mindprod.com/jgloss/primitive.html)

最后一点，Java 中有一个无符号的固定精度数。那是**char**原语。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-18T23:33:42.293

我知道这是一个很晚的回应，但我在尝试做同样的事情时遇到了这个线程。问题只是试图确定 Java 字节是否 >127。

简单的解决方案是：

```
if((val & (byte)0x80) != 0) { ... } 
```

如果真正的问题是 >128，那么只需在该 if 语句中添加另一个条件即可。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-08-14T14:17:48.847

我想你可以用一个短的来存储它们。效率不是很高，但除了我所见过的一些艰巨的努力之外，它确实是唯一的选择。

# language-agnostic - 单一决策和行动陈述的首选风格是什么？

> ID：11099
> 
> 赞同：3
> 
> 时间：2008-08-14T14:23:11.237
> 
> 标签：language-agnostic, language-features, readability

对于支持不带括号的单一决策和动作的语言，例如以下示例：

```
if (var == true)
    doSomething(); 
```

写这个的首选方式是什么？应该始终使用括号，还是应该将它们的使用保留为个人开发人员的偏好？此外，这种做法是否取决于代码块的大小，例如以下示例：

```
if (var == 1)
    doSomething(1);
else if (var > 1 && var < 10)
    doSomething(2);
else
{
    validate(var);
    doSomething(var);
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-14T14:27:26.750

真的没有一个正确的答案。这就是公司内部的编码标准。如果您可以在整个公司中保持一致，那么它将很容易阅读。我个人喜欢

```
if ( a == b)    {
    doSomething();
}
else {
    doSomething();
} 
```

但这是一场圣战。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-14T14:31:55.773

我建议

```
if(a==b)
{
    doSomething();
} 
```

因为我发现在向成功条件添加第二条语句时尝试记住添加大括号要容易得多...

```
if(a==b)
    doSomething();
    doSomethingElse(); 
```

非常不同

```
if(a==b)
{
    doSomething();
    doSomethingElse();
} 
```

有关详细信息，请参阅[Joel 的文章](http://www.joelonsoftware.com/articles/Wrong.html)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-08-14T14:32:35.913

我倾向于一直使用牙套。您可能会在开始时遇到一些细微的错误，例如：

```
if(something)
 DoOneThing();
else
  DoItDifferently(); 
```

然后决定在`else`子句中添加另一个操作并忘记将其包裹在大括号中：

```
if(something)
 DoOneThing();
else
  DoItDifferently();
  AlwaysGetsCalled(); 
```

`AlwaysGetsCalled()`总是会被调用，如果你在凌晨 3 点坐在那里想知道为什么你的代码表现得很奇怪，那么类似的事情可能会让你在很长一段时间内都无法理解。仅出于这个原因，我总是使用大括号。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-14T14:27:17.047

我的偏好是保持一致，例如，如果你在一个块上使用括号，即使只有一个语句，也要始终使用括号：

```
if (cond1)
{
   SomeOperation();
   Another();
}
elseif (cond2)
{
   DoSomething();
}
else
{
   DoNothing();
   DoAnother();
} 
```

但是，如果您只有一堆衬里：

```
if (cond1)
    DoFirst();
elseif (cond2)
    DoSecond();
else
    DoElse(); 
```

这样看起来更干净（如果您不介意虚拟方法名称；），但这只是我。

这也适用于循环结构等：

```
foreach (var s as Something)
    if (s == someCondition)
        yield return SomeMethod(s); 
```

您还应该考虑到这是一个可能更适合 .NET 的约定（请注意，Java peepz 喜欢将第一个花括号放在与 if 相同的行中）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-14T19:19:40.920

将此归咎于缺乏经验，但在我作为代码猴子的七年时间里，我*从未*真正见过有人在将代码添加到没有大括号的块时犯了不添加大括号的错误。这恰好是*零*次。

在说俏皮话之前，不，原因不是“每个人都总是使用大括号”。

所以，一个诚实的问题——我真的很想得到实际的答复，而不仅仅是投反对票：这真的发生过吗？

**（编辑：我听过足够多的外包恐怖故事来澄清一下：有能力的程序员**真的发生过这种情况吗？）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-14T14:25:17.443

没关系，只要你坚持就好。

似乎确实有一种在单个语句中要求相同的趋势，即如果一个分支中有括号，那么括号无处不在。例如，Linux 内核编码标准要求这样做。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-14T14:32:51.560

我强烈主张*始终*使用大括号，即使它们是可选的。为什么？以这段 C++ 代码为例：

```
if (var == 1)
  doSomething();
doSomethingElse(); 
```

现在，有人出现，他并没有真正关注并决定如果 (var == 1) 需要发生一些额外的事情，所以他们这样做：

```
if (var == 1)
  doSomething();
  doSomethingExtra();
doSomethingElse(); 
```

它仍然是精美的缩进，但它不会达到预期的效果。

通过始终使用大括号，您更有可能避免这种错误。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-02T12:50:15.047

我个人支持麦康奈尔对 Code Complete 的解释。

尽可能使用它们。它们增强了代码的可读性并消除了可能发生的少数和稀缺的混淆。

不过，有一件事更重要……一致性。无论您使用哪种风格，请确保您始终以相同的方式进行操作。

开始写类似的东西：

```
 If A == true
   FunctA();

If B == "Test"
{
   FunctB();
} 

```

您最终会寻找一个奇怪的错误，编译器无法理解您正在尝试做什么，而且很难找到。

基本上找到你每次都写得舒服的那个并坚持下去。我确实相信尽可能多地使用块分隔符（'{'，'}'）是要走的路。

我不想在另一个问题中开始一个问题，但是我想提一些与此相关的事情，以使您的精神活力。已做出使用括号的决定之一。你把开口支架放在哪里？在语句的同一行或下方。是否缩进括号？

```
 If A == false {
  //calls and whatnot
}
//or
If B == "BlaBla"
{
  //calls and whatnot
}
//or
If C == B
  {
  //calls and whatnot
  } 

```

请不要回答这个问题，因为这将是一个新问题。如果我对此感兴趣，我将打开一个新问题，您的意见。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-14T14:28:36.903

我一直都使用方括号，除了在释放变量之前检查变量是否为 NULL 的情况，就像在 C 中是必需的那样

在这种情况下，我通过将所有内容放在一行中来确保它是一个单一的语句，如下所示：

```
if (aString) free(aString); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-14T14:32:48.707

写上面的语句没有对错之分。有很多公认的编码[风格](http://en.wikipedia.org/wiki/Indent_style)。然而，对我来说，我更喜欢在整个项目中保持编码风格。IE。如果项目使用 K&R 风格，则应使用 K&R。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-14T16:29:24.447

Ruby 很好地避免了讨论中的一个问题。单线的标准是：

```
do_something if (a == b) 
```

对于多行：

```
if (a == b)
  do_something
  do_something_else
end 
```

这允许简洁的单行语句，但如果您从单行变为多行，它会迫使您重新组织语句。

这（还）在 Java 中不可用，在许多其他语言中也不可用，AFAIK。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-08-14T19:14:11.790

正如其他人所提到的，在没有大括号的两行中执行 if 语句可能会导致混淆：

```
if (a == b)
    DoSomething();
    DoSomethingElse(); <-- outside if statement 
```

因此，如果可以在不影响可读性的情况下将其放在一行上：

```
if (a == b) DoSomething(); 
```

在所有其他时间我都使用大括号。

三元运算符有点不同。大多数时候我在一行上做：

```
var c = (a == b) ? DoSomething() : DoSomethingElse(); 
```

但有时这些语句有嵌套的函数调用或 lambda 表达式，这使得单行语句难以在视觉上解析，所以我更喜欢这样的东西：

```
var c = (a == b)
    ? AReallyReallyLongFunctionName()
    : AnotherReallyReallyLongFunctionOrStatement(); 
```

仍然比 if/else 块更简洁，但很容易看到发生了什么。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-16T22:42:24.490

Sun 的[Java 编程语言代码约定是](http://java.sun.com/docs/codeconv/)这样[说](http://java.sun.com/docs/codeconv/html/CodeConventions.doc6.html#449)的：

> if-else 类语句应具有以下形式：
> 
> ```
> if (condition) {
>     statements;
> }
> 
> if (condition) {
>     statements;
> } else {
>     statements;
> }
> 
> if (condition) {
>     statements;
> } else if (condition) {
>     statements;
> } else {
>     statements;
> } 
> ```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-08-14T14:27:03.383

我们的老板让我们无论如何都要把 { } 放在一个决策声明之后，即使它是一个单一的声明。多加两行真的很烦人。唯一的例外是三元运算符。

我想我的代码监视器以 1200x1600 纵向显示是件好事。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-08-14T14:33:00.063

我倾向于同意 Joel Spolsky 的那篇文章（[Making Wrong Code Look Wrong](http://www.joelonsoftware.com/articles/Wrong.html)）和下面的代码示例：

```
if (i != 0)
bar(i);
foo(i); 
```

Foo 现在是无条件的。威奇真的很糟糕！

我总是在决策陈述中使用方括号。它有助于代码的可维护性，并使代码不易出错。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-08-14T14:42:47.670

我更喜欢

```
if (cond)
   {
   //statement
   } 
```

即使只有一个语句。如果你打算写一次东西，毫无疑问它是有效的，并且从未计划过让另一个程序员查看该代码，那么继续使用你想要的任何格式。但是，额外的包围真的让你付出了什么？一年的时间比写这篇文章的时间还短。

是的，我也喜欢将括号缩进到块的水平。

Python 很好，因为缩进定义了块。这个问题在这样的语言中是没有实际意义的。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-08-14T15:08:51.503

我曾经像 apparatchik 一样遵循“始终使用花括号”这一行。但是，我已经修改了我的样式以允许在单行条件表达式中省略它们：

```
if(!ok)return; 
```

对于任何多语句场景，尽管我仍然认为大括号应该是强制性的：

```
if(!ok){

    do();

    that();

    thing();
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-16T21:50:42.633

当且仅当至少有一个语句需要它时，我才会在每个语句周围使用花括号。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-17T18:02:54.527

在 Perl 中，如果您正在做一个简单的测试，有时您会以这种形式编写它：

```
do_something if condition;

do_something unless condition; 
```

这对于在子程序开始时检查参数非常有用。

```
sub test{
  my($self,@args) = @_;

  return undef unless defined $self;

  # rest of code goes here

} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-03-12T18:02:30.867

黄金法则是，在现有项目中工作时，遵循这些编码标准。

当我在家时，我有两种形式。

第一个是单行：

```
if (condition) doThis(); 
```

第二个是多行：

```
if (condition) {
   doThis();
} 
```

# iphone - 移动用户的最佳 Wiki

> ID：11112
> 
> 赞同：7
> 
> 时间：2008-08-14T14:30:17.277
> 
> 标签：iphone, wiki, mobile-website

大多数 wiki 软件我都在他们的页面上展示了很多“功能”。这对桌面用户来说很好，但在使用 iPhone 或其他移动设备时很烦人。

我更喜欢只有内容的页面，可能还有一个编辑按钮和一个搜索按钮。对于移动用户来说，编辑器也往往过于花哨；对于移动用户来说，一个简单的多行编辑字段比一堆格式控件更好。

对于移动用户来说，什么是好的 wiki 包？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-14T14:39:56.960

我发现 Fogbugz 中的 wiki 非常适合在 iPhone 上使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-14T16:38:00.870

用您自己的皮肤覆盖 mediawiki 皮肤非常容易。您可以毫无问题地删除任何您想要删除的内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-01-08T16:11:47.593

Steven Frank（恐慌，Transmit 的制造商）的 W2 很棒。
它完全针对 iPhone 进行了精简——只是必需品。
它支持 markdown 和基本的 Wiki 样式格式。
[https://github.com/panicsteve/w2wiki](https://github.com/panicsteve/w2wiki)
该页面有一个演示站点的链接。

# c++ - 在 C++/Windows 中，如何获取我所在计算机的网络名称？

> ID：11127
> 
> 赞同：8
> 
> 时间：2008-08-14T14:37:27.120
> 
> 标签：c++, windows-xp, networking, windows-nt

在我正在处理的 C++ Windows（XP 和 NT，如果有区别）应用程序中，我需要获取与正在执行代码的计算机关联的网络名称，以便我可以从 C:\ 转换本地文件名文件名.ext 到 \\network_name\C$\filename.ext。我该怎么做？

或者，如果有一个函数可以进行我描述的转换，那就更好了。我查看了 WNetGetUniversalName，但这似乎不适用于本地（C 驱动器）文件。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-14T15:22:23.067

有不止一种选择：

一种。按照 Stu 的建议使用 Win32 的 GetComputerName()。
示例：[http](http://www.techbytes.ca/techbyte97.html)
://www.techbytes.ca/techbyte97.html 或
b。使用 Winsock 下的函数 gethostname()。此功能是跨平台的，如果您的应用程序要在 Windows 以外的其他平台上运行，可能会有所帮助。
MSDN 参考： http: [//msdn.microsoft.com/en-us/library/ms738527](http://msdn.microsoft.com/en-us/library/ms738527(VS.85).aspx)
(VS.85).aspx 或
c。使用函数 getaddrinfo()。
MSDN 参考： http: [//msdn.microsoft.com/en-us/library/ms738520 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms738520(VS.85).aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-14T14:40:31.217

你会想要 Win32 的 GetComputerName：

[http://msdn.microsoft.com/en-us/library/ms724295(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms724295(VS.85).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T11:21:34.953

我同意 Pascal 关于使用 winsock 的 gethostname() 函数的观点。干得好：

```
#include <winsock2.h> //of course this is the way to go on windows only

#pragma comment(lib, "Ws2_32.lib")

void GetHostName(std::string& host_name)
{
    WSAData wsa_data;
    int ret_code;

    char buf[MAX_PATH];

    WSAStartup(MAKEWORD(1, 1), &wsa_data);
    ret_code = gethostname(buf, MAX_PATH);

    if (ret_code == SOCKET_ERROR)
        host_name = "unknown";
    else
        host_name = buf;

    WSACleanup();

} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-10-08T07:04:58.477

如果您只想要本地计算机的名称（NetBIOS）使用`GetComputerName`函数。当系统从注册表中读取它时，它只检索在系统启动时建立的本地计算机名称。

```
BOOL WINAPI GetComputerName(
  _Out_   LPTSTR  lpBuffer,
 _Inout_ LPDWORD lpnSize
); 
```

更多关于[GetComputerName](https://msdn.microsoft.com/en-us/library/windows/desktop/ms724295%28v=vs.85%29.aspx)

如果要获取 DNS 主机名、DNS 域名或完全限定的 DNS 名称，请调用该`GetComputerNameEx`函数。

```
BOOL WINAPI GetComputerNameEx(
  _In_    COMPUTER_NAME_FORMAT NameType,
  _Out_   LPTSTR               lpBuffer,
  _Inout_ LPDWORD              lpnSize
); 
```

更多关于[GetComputerNameEx](https://msdn.microsoft.com/en-us/library/windows/desktop/ms724301%28v=vs.85%29.aspx)

# asp-classic - 如何从 ASP 页面运行远程 shell 脚本？

> ID：11135
> 
> 赞同：1
> 
> 时间：2008-08-14T14:42:50.887
> 
> 标签：asp-classic, vbscript

我需要创建一个 ASP 页面（经典，而不是 ASP.NET），它在 UNIX 服务器上运行远程 shell 脚本，然后将输出捕获到页面本身内 VBScript 中的变量中。

我以前从未做过 ASP 或 VBScipt。我试图用谷歌搜索这些东西，但我发现的只是对远程服务器端脚本的引用，没有什么具体的。

我真的可以使用：

1.  如何做到这一点的一个基本示例。
2.  以安全方式实现此目的的任何其他更好的选择。

* * *

这些库是否有任何免费软件/开源替代品？有什么例子吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-08-14T15:17:54.217

如果 shell 脚本通常在 telnet 会话上运行，那么您可以筛选并解析响应。那里有商业 COM 组件，例如 Dart telnet 库：[http](http://www.dart.com/pttel.aspx) ://www.dart.com/pttel.aspx可以让您执行此操作。

或者你可以使用 AspSock [http://www.15seconds.com/component/pg000300.htm自己滚动](http://www.15seconds.com/component/pg000300.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-14T16:29:37.083

@Pascal，遗憾的是我不知道有任何 F/OSS 替代品。我们通常只购买这些类型的库，前提是它们不是非常昂贵，而且成本通常包含在客户的整体项目成本中。

如果服务器上有 .NET，则可以构建一个 COM 包装的组件来完成 System.Net.Sockets.TcpClient 的繁重工作。只是一个想法。

# asp.net - ASP.NET 缓存

> ID：11141
> 
> 赞同：2
> 
> 时间：2008-08-14T14:46:30.317
> 
> 标签：asp.net, sql, caching

最近我一直在研究 ASP.NET 中缓存的可能性。

我滚动了自己的“缓存”，因为我不知道更好，它看起来有点像这样：

```
public class DataManager
{

      private static DataManager s_instance;

      public static DataManager GetInstance()
      {
      }

      private Data[] m_myData;
      private DataTime m_cacheTime;

      public Data[] GetData()
      {
            TimeSpan span = DateTime.Now.Substract(m_cacheTime);

            if(span.TotalSeconds > 10)
            {
                  // Do SQL to get data
                  m_myData = data;
                  m_cacheTime = DateTime.Now;
                  return m_myData;     
            }
            else
            {
                  return m_myData;
            }
      }

} 
```

所以这些值会在一个单例中存储一段时间，当时间到期时，这些值会被更新。如果时间尚未到期，并且完成了对数据的请求，则返回字段中存储的值。

使用真正的方法（[http://msdn.microsoft.com/en-us/library/aa478965.aspx](http://msdn.microsoft.com/en-us/library/aa478965.aspx)）而不是这个有什么好处？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-14T14:52:54.267

我认为格言“让计算机来做；它比你更聪明”在这里适用。就像内存管理和其他复杂的事情一样，计算机比你更了解它在做什么；因此，能够获得比您更多的性能。

微软已经有一个工程师团队致力于它，他们可能已经设法从系统中挤出比你所能做到的更多的性能。ASP.NET 的内置缓存也可能在不同的级别（您的应用程序无法访问）运行，从而使其速度更快。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-14T14:55:42.777

ASP.NET 缓存机制已经存在了一段时间，所以它很稳定并且很好理解。有很多资源可以帮助您充分利用它。

根据您的要求，自己滚动可能是正确的解决方案。

缓存的难点在于选择什么时候可以安全缓存。对于数据经常变化的应用程序，你可以引入一些难以解决的缓存问题，所以要小心。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-14T14:57:32.727

ASP.NET 中的缓存功能丰富，您可以以非常精细的方式配置缓存。

在您的情况下（数据缓存），您错过的功能之一是如果 SQL 服务器上的数据以某种方式更新（SQL 缓存依赖关系），则能够使缓存无效和刷新。

[http://msdn.microsoft.com/en-us/library/ms178604.aspx](http://msdn.microsoft.com/en-us/library/ms178604.aspx)

# ruby - Ruby 绘图库

> ID：11145
> 
> 赞同：15
> 
> 时间：2008-08-14T14:51:28.217
> 
> 标签：ruby, graphics, drawing

我正在尝试为使用 Ruby 的语言编写流程图生成器。

我想知道是否有任何库可用于为各种流程图元素绘制各种形状并将文本写入这些形状。

如果可以的话，我真的更希望不必编写代码来绘制基本形状。

有人可以向我指出一些参考文档以及使用该库的示例吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-23T13:51:52.073

[在Graphviz](http://www.graphviz.org/About.php)中将您的流程图写成有向图或无向图。Graphviz 有一种语言[dot](http://www.graphviz.org/Documentation.php)可以很容易地生成图形。只需生成点文件，通过 Graphiviz 运行它，即可获得图像。

```
graph {
  A -- B -- C;
  B -- D;
  C -- D [constraint=false];
} 
```

呈现为
[![无向的](../Images/09c7e0a7880c5b51f7ab7c56a0025582.png)](http://www.flickr.com/photos/rampion/3130993214/ "在 Flickr 上，由 rampion 指导")

```
digraph {
  A [label="start"];
  B [label="eat"];
  C [label="drink"];
  D [label="be merry"];

  A -> B -> C;
  C -> D [constraint=false];
  B -> D [ arrowhead=none, arrowtail=normal]; // reverse this edge
} 
```

呈现为
[![定向](../Images/46c7502b24904c8149e8e302be39f75d.png)](http://www.flickr.com/photos/rampion/3130162313/ "由 rampion 执导，在 Flickr 上")

您可以在 Graphviz 中控制节点形状等等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-14T15:19:21.543

听起来您将主要受到您正在构建的任何用户代理的功能的限制；如果这是一个 Web 项目，绘图功能将取决于浏览器。由于 Ruby 在服务器端运行，您至少需要一些 JavaScript 来允许拖动/缩放等。有很多 JavaScript 用于矢量绘图的示例（只是谷歌“javascript 图形库”），但都需要编码，并且我还没有看到任何优雅地抽象这个的库。

ImageMagick 有一个名为 RMagick 的 Ruby 绑定（有时也有其他名称，具体取决于存储库）。（[链接](http://rmagick.rubyforge.org/)）我自己没有使用过它，但我相信它会满足您的需求。你需要做一些编码，但它是沿着

```
draw.rectangle(x1, y1, x2, y2)
draw.polygon(x1, y1,...,xN, yN) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-15T10:07:39.113

简单的答案是（在撰写本文时）您想要的几乎肯定不存在。对不起！

如果您是基于 Windows 的，那么我会在 .NET 空间中寻找产品，我希望您会在其中找到一些东西。不过，您可能需要支付真金白银。我想，如果你够勇敢，你也许可以使用 IronRuby 与它交谈。

在非 MS 环境中，我希望有一个基于 Java 的解决方案。如前所述，在 Web 世界中，您将希望一些基于 JavaScript 的东西，或者更有可能的是来自 Flash（或者甚至是 Silverlight？）世界的东西。

实际上，如果您想留在 Ruby 中并且不介意一些风险，Silverlight 可能是一种可行的方法 - 假设 DLR 的东西确实有效（这里没有经验）。Ruby——尽管我很喜欢它——几乎没有围绕它的最成熟的 GUI 结构。

更新：自从写这篇文章（接近 5 年前）以来，情况有所改善 - 一点点。虽然我仍然不知道任何特定的 Ruby 图形绘制库，但[这里 (Github](https://github.com/glejeune/Ruby-Graphviz/) [)](http://www.graphviz.org/) 或. 我发现对于简单的图表，直接从 Ruby 编写脚本是完全可能的。`gem install ruby-graphviz`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T07:31:17.087

我完全确定，但请查看 cairo bindings for ruby​​。用于文本的 Pango。我目前正在调查并遇到此页面。

# .net - 如何基于外部事件可靠地创建工作流实例？

> ID：11152
> 
> 赞同：3
> 
> 时间：2008-08-14T14:56:30.123
> 
> 标签：.net, workflow, workflow-foundation

对 Windows 工作流程的东西有点新，所以很容易:)

我希望设计一个具有高可用性的工作流主机环境——在不同的硬件上至少有 2 个 WF 运行时主机，它们都指向相同的持久性或跟踪 SQL 数据库。

我正在寻找一种模式，通过这种模式我可以基于一些外部事件异步创建新的工作流实例（即，一些数据由不同的应用程序在 DB 中更新）。对于每个事件，我都需要准确地创建一个工作流实例，而不管该实例是在哪个主机上创建的。关于事件之间的持续时间和实际创建工作流实例的时间也有一些灵活性。

我正在考虑的一种解决方案是在 WF 主机上使用 WCF 接口，并将它们放在某种负载平衡器后面。然后由系统的任何部分触发“事件”来进行 WCF 调用。

我对此并不满意，因为如果所有 WF 主机都关闭或不可用，则该事件可能会“丢失”。此外，我将无法按照我想要的方式管理负载。我设想这样一种情况，在短时间内可能会发生很多事件，但在一段时间后处理这些事件是完全可以接受的。

所以我认为我需要以某种方式持久化事件并将事件创建与事件处理分离。

将这些事件放入 MSMQ 或 SQL Server 中的简单事件表中，并让 WF 主机定期轮询队列是可行的解决方案吗？投票似乎是一个如此肮脏的词......

NServiceBus 和持久消息传递在这里有用吗？

任何见解将不胜感激。

**附录**

该数据库将使用共享光纤通道存储进行集群。网络也将是冗余的。为了使 WF 运行时实例具有故障转移，它们必须指向一个公共持久性服务，在这种情况下是一个 SQL 后端。这是高可用性，而不是总可用性 :)

[MSDN 关于 WF 可靠性和高可用性的文章](http://msdn.microsoft.com/en-us/library/aa663362.aspx#hostingwwf_topic4)

此外，WF 运行时的每个实例都必须运行完全相同的位，因此升级需要同时将它们全部关闭。如果需要，我喜欢能够做到这一点的想法，而无需关闭整个系统。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T21:07:09.217

如果将 WCF 服务与 netMsmqBinding 一起使用，则无需轮询即可接收排队的消息。如果没有服务运行来接收消息，消息将等待。如果主排队机出现故障，您可能需要确保使用集群队列以提高可靠性。

升级时还要注意，您无法从旧版本的服务中恢复实例。因此，要升级长时间运行的工作流，您需要阻止它们接收新请求并等到所有实例都完成后再更改位，否则旧实例将永远卡在您的持久性存储中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-14T15:56:19.490

我会选择 MSMQ/事件表。如果你做错了，轮询只是肮脏的。

要记住一件事：您说您想要多个 WF 服务器以实现高可用性，*但它们都使用相同的 SQL 后端*？仅当您消除*所有*单点故障时，高可用性才有效，而不仅仅是其中的一些。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T16:55:44.120

这就是我解决它的方法。

我正在使用 NServiceBus 并且每个 WF 运行时主机都指向相同的消息总线（使用 MSMQ 作为传输）。NServiceBus 支持事务性读取消息总线和回滚。如果一条消息从总线上取下，但进程在消息完全处理之前终止，它仍保留在队列中，并且不同的运行时主机将接收它。

为了让 WF 运行时主机在不同的机器上运行，messagebus\queue 必须驻留在 Windows 2008 服务器 (MSMQ 4.0) 或更高版本上，因为早期版本的 MSMQ 不支持远程事务读取。另请注意，为了执行远程事务读取，执行读取的机器还需要安装 MSMQ 4.0（即 Windows Server 2008）

# c# - 如何有条件地应用 Linq 运算符？

> ID：11194
> 
> 赞同：96
> 
> 时间：2008-08-14T15:20:26.973
> 
> 标签：c#, linq, linq-to-sql

我们正在开发一个日志查看器。用户可以选择按用户、严重性等进行过滤。在 Sql 日子里，我会添加到查询字符串中，但我想用 Linq 来做。如何有条件地添加 where 子句？

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2008-08-14T15:27:09.297

如果您只想过滤是否通过了某些条件，请执行以下操作

```
var logs = from log in context.Logs
           select log;

if (filterBySeverity)
    logs = logs.Where(p => p.Severity == severity);

if (filterByUser)
    logs = logs.Where(p => p.User == user); 
```

这样做将使您的表达式树完全符合您的要求。这样，创建的 SQL 将正是您所需要的，仅此而已。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-05-09T19:36:13.150

如果您需要基于列表/数组进行过滤，请使用以下内容：

```
 public List<Data> GetData(List<string> Numbers, List<string> Letters)
    {
        if (Numbers == null)
            Numbers = new List<string>();

        if (Letters == null)
            Letters = new List<string>();

        var q = from d in database.table
                where (Numbers.Count == 0 || Numbers.Contains(d.Number))
                where (Letters.Count == 0 || Letters.Contains(d.Letter))
                select new Data
                {
                    Number = d.Number,
                    Letter = d.Letter,
                };
        return q.ToList();

    } 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-08-21T13:50:32.143

我最终使用了一个类似于 Daren 的答案，但使用了 IQueryable 接口：

```
IQueryable<Log> matches = m_Locator.Logs;

// Users filter
if (usersFilter)
    matches = matches.Where(l => l.UserName == comboBoxUsers.Text);

 // Severity filter
 if (severityFilter)
     matches = matches.Where(l => l.Severity == comboBoxSeverity.Text);

 Logs = (from log in matches
         orderby log.EventTime descending
         select log).ToList(); 
```

这会在访问数据库之前建立查询。该命令直到 .ToList() 最后才会运行。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-08-14T22:03:19.997

当谈到条件 linq 时，我非常喜欢过滤器和管道模式。
[http://blog.wekeroad.com/mvc-storefront/mvcstore-part-3/](http://blog.wekeroad.com/mvc-storefront/mvcstore-part-3/)

基本上，您为每个接受 IQueryable 和参数的过滤器案例创建一个扩展方法。

```
public static IQueryable<Type> HasID(this IQueryable<Type> query, long? id)
{
    return id.HasValue ? query.Where(o => i.ID.Equals(id.Value)) : query;
} 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2018-07-11T06:50:53.500

我通过扩展方法解决了这个问题，允许在流畅的表达式中间有条件地启用 LINQ。`if`这消除了用语句分解表达式的需要。

`.If()`扩展方法：

```
public static IQueryable<TSource> If<TSource>(
        this IQueryable<TSource> source,
        bool condition,
        Func<IQueryable<TSource>, IQueryable<TSource>> branch)
    {
        return condition ? branch(source) : source;
    } 
```

这使您可以这样做：

```
return context.Logs
     .If(filterBySeverity, q => q.Where(p => p.Severity == severity))
     .If(filterByUser, q => q.Where(p => p.User == user))
     .ToList(); 
```

这也是一个`IEnumerable<T>`可以处理大多数其他 LINQ 表达式的版本：

```
public static IEnumerable<TSource> If<TSource>(
    this IEnumerable<TSource> source,
    bool condition,
    Func<IEnumerable<TSource>, IEnumerable<TSource>> branch)
    {
        return condition ? branch(source) : source;
    } 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-06-13T12:20:12.010

这样做：

```
bool lastNameSearch = true/false; // depending if they want to search by last name, 
```

在`where`声明中有这个：

```
where (lastNameSearch && name.LastNameSearch == "smith") 
```

意味着当创建最终查询时，如果`lastNameSearch`是`false`查询将完全省略任何用于姓氏搜索的 SQL。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-08-14T23:21:45.800

另一种选择是使用[这里](http://www.albahari.com/nutshell/predicatebuilder.html)讨论的 PredicateBuilder 之类的东西。它允许您编写如下代码：

```
var newKids  = Product.ContainsInDescription ("BlackBerry", "iPhone");

var classics = Product.ContainsInDescription ("Nokia", "Ericsson")
                  .And (Product.IsSelling());

var query = from p in Data.Products.Where (newKids.Or (classics))
            select p; 
```

请注意，我只能使用 Linq 2 SQL。EntityFramework 不实现 Expression.Invoke，这是此方法工作所必需的。[我在这里](https://stackoverflow.com/questions/10524/expressioninvoke-in-entity-framework)有一个关于这个问题的问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-14T15:53:50.837

这不是最漂亮的事情，但您可以使用 lambda 表达式并选择性地传递您的条件。在 TSQL 中，我做了很多以下操作来使参数可选：

> WHERE 字段 = @FieldVar 或 @FieldVar 为 NULL

您可以使用以下 lambda 复制相同的样式（检查身份验证的示例）：

> MyDataContext db = new MyDataContext();
> 
> void RunQuery（字符串参数 1，字符串参数 2，int？参数 3）{
> 
> > 功能检查用户 = 用户 =>
> > 
> > > ((param1.Length > 0)? user.Param1 == param1 : 1 == 1) &&
> > > 
> > > ((param2.Length > 0)? user.Param2 == param2 : 1 == 1) &&
> > > 
> > > ((param3 != null)? user.Param3 == param3 : 1 == 1);
> > 
> > 用户 foundUser = db.Users.SingleOrDefault(checkUser);
> 
> }

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-18T13:12:06.440

我最近有类似的要求，最终在他的 MSDN 中找到了这个。 [Visual Studio 2008 的 CSharp 示例](http://code.msdn.microsoft.com/csharpsamples)

下载的 DynamicQuery 示例中包含的类允许您在运行时以以下格式创建动态查询：

```
var query =
db.Customers.
Where("City = @0 and Orders.Count >= @1", "London", 10).
OrderBy("CompanyName").
Select("new(CompanyName as Name, Phone)"); 
```

使用它，您可以在运行时动态构建查询字符串并将其传递给 Where() 方法：

```
string dynamicQueryString = "City = \"London\" and Order.Count >= 10"; 
var q = from c in db.Customers.Where(queryString, null)
        orderby c.CompanyName
        select c; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-04-17T16:48:26.673

您可以创建和使用此扩展方法

```
public static IQueryable<TSource> WhereIf<TSource>(this IQueryable<TSource> source, bool isToExecute, Expression<Func<TSource, bool>> predicate)
{
    return isToExecute ? source.Where(predicate) : source;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-14T15:26:12.780

只需使用 C# 的 && 运算符：

```
var items = dc.Users.Where(l => l.Date == DateTime.Today && l.Severity == "Critical") 
```

编辑：啊，需要更仔细地阅读。您想知道如何*有条件*地添加附加子句。在那种情况下，我不知道。:) 我可能会做的只是准备几个查询，然后执行正确的查询，这取决于我最终需要什么。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-14T15:27:15.880

您可以使用外部方法：

```
var results =
    from rec in GetSomeRecs()
    where ConditionalCheck(rec)
    select rec;

...

bool ConditionalCheck( typeofRec input ) {
    ...
} 
```

这可行，但不能分解为表达式树，这意味着 Linq to SQL 将对每条记录运行检查代码。

或者：

```
var results =
    from rec in GetSomeRecs()
    where 
        (!filterBySeverity || rec.Severity == severity) &&
        (!filterByUser|| rec.User == user)
    select rec; 
```

这可能适用于表达式树，这意味着 Linq to SQL 将得到优化。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-14T15:39:33.063

好吧，我认为您可以将过滤条件放入谓词的通用列表中：

```
 var list = new List<string> { "me", "you", "meyou", "mow" };

    var predicates = new List<Predicate<string>>();

    predicates.Add(i => i.Contains("me"));
    predicates.Add(i => i.EndsWith("w"));

    var results = new List<string>();

    foreach (var p in predicates)
        results.AddRange(from i in list where p.Invoke(i) select i); 
```

这会产生一个包含“me”、“meyou”和“mow”的列表。

您可以通过对所有谓词进行 OR 运算的完全不同的函数中的谓词进行 foreach 来优化它。

# .net - .NET 框架依赖项

> ID：11199
> 
> 赞同：5
> 
> 时间：2008-08-14T15:25:44.637
> 
> 标签：.net, frameworks, dependencies

在 .NET 中开发桌面应用程序时，是否可以不需要 .NET Framework？在 .NET 中开发软件是开发桌面应用程序的首选方式吗？软件公司用来开发桌面应用程序的最常用的编程语言是什么？

.NET Framework 的要求是否只是基于您安装的 Windows 操作系统而假设的，因此他们为什么列出 Windows 操作系统版本要求？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-14T15:32:49.410

您仍然可以使用 C/C++ 为 Windows 桌面开发应用程序，消除对 .NET 框架的要求，但您需要确保系统上已经存在或安装了必要的库。

.NET 框架的好处是 Windows XP SP2 和 Vista 默认安装了 3.0 框架运行时。

在很多方面，这是微软的“开发标准”，并且已经有一段时间了。这使您不必担心将一堆库附加到您的应用程序中。如果您坚持使用 .NET 提供的所有库，那么您最终只需要担心部署可执行文件，这是一个很大的缓解方法。当您还必须部署一堆库时，您在编写更新时开始遇到麻烦，因为您必须确保将这些更新推送到现有安装程序以及所有现有安装的应用程序中.

至于“首选”，有时总是会惹恼人，但在我经常访问的求职网站上，越来越多的 .NET 开发人员需要网络和桌面。8^D

编辑：非常感谢 Orion 指出我对框架的困惑。如果您使用的是 XP SP2 或 Vista，您将获得 3.0"。其他一切都需要简单下载或运行 Windows 更新。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-14T15:28:11.463

如果没有 .Net 框架，您将无法运行 .Net 应用程序。该框架负责处理一些更繁琐的后台任务，因此您无法在没有框架的情况下运行应用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-14T15:30:17.123

在 Windows 平台上使用 .NET 是开发桌面应用程序的首选方式。.NET 的 WinForms 模型是开发传统或胖客户端应用程序的一种方式，而 .NET 的 Windows Presentation Foundation 是 MS 的最新技术方向。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-14T15:33:04.467

我想我想说的是，当我查看某些软件的系统要求时，我很少将 .NET Framework 视为一项要求。所以，我总是想知道他们如何在没有要求的情况下度过难关（如果他们用 .NET 开发软件）。所以，我只是假设大多数商业软件不是用 .NET 编写的，所以这就是我问这个问题的原因。希望能澄清一些事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-14T15:40:03.657

[Mono](http://www.go-mono.com/mono-downloads/download.html)有一个 Windows 版本，如果您绝对必须避免依赖 .NET。

但是，无论您怎么看，您都需要在运行您的应用程序的任何计算机上安装与 .NET 兼容的运行时。因此，如果您想完全避免使用 .NET，您可能必须将 Mono 运行时与您的应用程序一起分发。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-14T15:44:38.577

.NET 应用程序分发的最佳实践是安装程序以某种方式使用所需框架的 .NET Redistributable 安装程序进行引导，因此如果尚未安装所需框架（例如，您在 Windows XP 中需要 3.5），那么安装程序将把它放进去。

.NET 运行时的安装足够小，这是可行的（.NET 2.0 大约为 24MB，尚未检查 .NET 3.5 有多大）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-14T16:01:14.737

> 我想我想说的是，当我查看某些软件的系统要求时，我很少将 .NET Framework 视为一项要求。所以，我总是想知道他们如何在没有要求的情况下度过难关（如果他们用 .NET 开发软件）。所以，我只是假设大多数商业软件不是用 .NET 编写的，所以这就是我问这个问题的原因。希望能澄清一些事情。

我没有任何数字，但我猜测由于大多数人在他们的桌面上运行 XP 和 Vista，列出 .NET 框架是没有实际意义的，特别是如果他们的目标是 2.0 框架应用程序本身。过去，您看到有多少应用程序说“需要 vbrun50.dll”或与此相关的内容，因为它是默认放入 Windows 安装的？

另外，对于那些不是非常精通计算机的人来说，它不那么“可怕”。他们想要做的就是下载、安装和运行应用程序。我有几个应用程序需要 2.0 框架，我确实让一些人问那是什么，我如何获得它，它是否花费了我任何东西？我给他们的典型答案是“如果您运行的是 XP 或 Vista，则无需担心”，他们似乎也喜欢这样。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-14T18:52:03.097

我认为，如果您能够执行静态链接 .NET 框架之类的操作，而不必开发它，那么您将违反微软提供的 EULA！

拥有如此丰富的开发者经验，这是我们必须付出的代价！当您考虑回到 MFC 编程的困难时，这是值得的！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-14T23:31:35.327

Remotesoft 提供了一个链接器 - 单个开发人员许可证 1250 美元：[http ://www.remotesoft.com/linker/index.html](http://www.remotesoft.com/linker/index.html)

如果您的应用程序将在 Mono 上运行（并且 Mono 的 Winform 桌面支持现在非常好），您可以将您的应用程序打包为 Mono 包，这是一个单一的可执行文件。有两个选项 - 默认包括运行时但不静态链接到它，另一个静态链接到 Mono 运行时。您可能不想静态链接的原因是它会将您的应用程序置于 LGPL 之下；非静态链接的捆绑包（仍然只是一个 exe）没有这个要求。 [http://www.mono-project.com/Mono:Runtime#Bundles](http://www.mono-project.com/Mono:Runtime#Bundles)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-15T08:11:31.893

您可以考虑使用[“ClickOnce 部署”](http://www.15seconds.com/issue/041229.htm)，这样可以很容易地将 .Net 2.0、3.0 和/或 3.5 可再发行安装程序添加到您的应用程序中。只需单击项目属性中的复选框，安装程序将自动检测是否已安装必备框架，如果未安装，则安装它。

它并不适合所有情况，但如果你能利用它，它可能会非常巧妙。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-14T18:20:57.187

我在 .NET 中进行了一些编程（使用 C#），我意识到我经常渴望对许多控件进行更多控制。这些需要超出 .NET 框架的知识。

例如，当我使用 WebBrowser 控件为 Web 应用程序生成自动化测试工具时，我意识到在某些情况下需要来自较低级别的 axWebBrowser ActiveX 控件的事件处理程序，并且文档很少/代码示例包含很多COM 互操作概念。那么，也许对 COM 有一些了解会有用吗？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-14T18:49:56.813

> 我想我想说的是，当我查看某些软件的系统要求时，我很少将 .NET Framework 视为一项要求。所以，我总是想知道他们如何在没有要求的情况下度过难关（如果他们用 .NET 开发软件）。所以，我只是假设大多数商业软件不是用 .NET 编写的，所以这就是我问这个问题的原因。希望能澄清一些事情。

许多使用 C++/MFC 为 Windows 桌面开发的应用程序需要特定版本的 MFC 运行时 DLL，即使它可能未明确列为要求。我相信对于需要 .NET 的应用程序来说也是如此。

例如，我处理的应用程序附带了可再分发的文件，用于 .NET 和我们需要的特定版本的 MFC 以及许多其他必需的组件。我们的安装程序将安装当前未安装在用户系统上的任何组件。过去几年的每个版本都使用了比前一个版本更多的 .NET 代码。

我认为假设大多数商业软件不使用 .NET 只是因为它没有被列为要求是不准确的。我认为你不能准确地假设任何事情。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-14T23:06:40.620

> .NET 框架的好处是 Windows XP 默认安装了 2.0 框架运行时库

从何时起？我不得不告诉很多我们的 Windows XP 用户来安装它。是的，您可以通过 Windows 更新将其拉下来，但我非常有信心这是一个可选安装，而不是自动发生的事情。

> Vista 安装了 3.5

不，它已安装 3.0。你得到了 WPF，但你*没有*得到 linq

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-02-19T21:31:54.330

是的，您可以在不使用框架的情况下构建一个内置于 dot NET 的应用程序。您可以使用 ESS dotNET FuZe 之类的程序将任何 dll（包括框架 dll）合并到应用程序中。生成的 EXE 不再需要框架。

请到这个链接：[http](http://essaver.net/fuze.html) ://essaver.net/fuze.html 来看看 FuZe。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-08-14T15:28:59.623

可以不需要 .NET Framework；有一些公司出售（请注意，数千美元）解决方案，可以让您做到这一点。然而，这些是完整的黑客攻击，不受 Microsoft 支持。

您如何开发桌面应用程序（即，是否使用 .NET）取决于您的要求。没有首选的方式。

最常用的语言可能是 C#。

# tsql - 自上一个纪元以来的秒数的 T-Sql 日期格式/sqlite 输入的格式

> ID：11200
> 
> 赞同：1
> 
> 时间：2008-08-14T15:26:11.327
> 
> 标签：tsql, sqlite, date

我猜它需要是这样的：

```
CONVERT(CHAR(24), lastModified, 101) 
```

但是我不确定第三个参数的正确值。

谢谢！

* * *

好吧，我正在尝试编写一个脚本来将我的 sql server db 复制到一个 sqlite 文件，该文件被下载到一个 air 应用程序，然后将数据同步到另一个 sqlite 文件。我在约会方面遇到了很多麻烦。如果我在空中选择一个日期并尝试插入它，它会失败，因为它的格式不正确......即使它是一个有效的开始日期。我想我会尝试使用 unix 时间，因为这是迄今为止唯一有效的方法。我正在考虑将它们保留为 varchar，因为无论如何我都不按它们排序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-14T15:33:02.703

最后一个时代是格林威治标准时间 1970 年？

```
SELECT DATEDIFF(s,'19700101 05:00:00:000',lastModified) 
```

另请参阅[纪元日期](http://wiki.lessthandot.com/index.php/Epoch_Date)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-27T19:35:35.793

sqlite>**选择日期时间（）；**
2011-01-27 19:32:57

sqlite> **select strftime('%Y-%m-%d %H:%M:%S','now');**
2011-01-27 19:33:57

**参考：（**
日期时间函数）[http://sqlite.org/lang_datefunc.html]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-14T15:52:17.237

我最终在 MS SQL 中使用了 120 格式：

```
convert(char(24), lastModified, 120) 
```

每次我需要在 SQLite 中选择一个日期以用于非显示目的时，我都会使用：

```
strftime(\"%Y-%m-%d %H:%M:%S\", dateModified) as dateModified 
```

现在我只需要一种可读/友好的方式来向用户显示日期！

编辑：接受答案给向我展示如何从 sqlite 很好地显示日期的人；p

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-14T15:32:00.770

定义“最后一个时代”。这接近了吗？

选择 Cast(lastModified 为整数)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-14T15:41:30.127

如果将它们存储为 varchar，请将它们存储为 YYYYMMDD。这样，您以后可以根据需要对它们进行排序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-14T15:45:00.760

SQL 服务器只有 2 种故障安全日期格式

ISO = YYYYMMDD，运行这个看看

```
 select convert(varchar(10),getdate(),112) 
```

ISO8601 = yyyy-mm-dd Thh:mm:ss:mmm(no spaces) 运行这个看看

```
select convert(varchar(30),getdate(),126) 
```

要了解有关日期如何存储在 SQL Server 中的更多信息，我写了[日期如何存储在 SQL Server 中？](http://blogs.lessthandot.com/index.php/DataMgmt/DataDesign/how-are-dates-stored-in-sql-server)

# web-services - 从经典的 asp 页面调用 REST Web 服务

> ID：11219
> 
> 赞同：27
> 
> 时间：2008-08-14T15:34:26.757
> 
> 标签：web-services, rest, asp-classic

我想开始将我们的应用程序业务层移动到 REST Web 服务的集合中。但是，我们的大部分 Intranet 都是使用 Classic ASP 构建的，而我工作的大多数开发人员都使用 Classic ASP 进行编程。理想情况下，为了让他们受益于一组独特的 Web API 的优势，必须从经典 ASP 页面调用它。

我一点也不知道该怎么做。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-08-14T15:49:27.413

您可以结合使用 JQuery 和 JSON 调用来使用来自客户端的 REST 服务

或者

如果您需要与 ASP 层的 REST 服务进行交互，您可以使用

MSXML2.ServerXMLHTTP

像：

```
Set HttpReq = Server.CreateObject("MSXML2.ServerXMLHTTP")
HttpReq.open "GET", "Rest_URI", False
HttpReq.send 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-14T15:59:58.110

@KP [_](https://stackoverflow.com/questions/11219/calling-rest-web-services-from-a-classic-asp-page#11238)

您实际上应该`MSXML2.ServerXMLHTTP`从 ASP/服务器端应用程序中使用。`XMLHTTP`只能在客户端使用，因为它使用不支持在服务器/服务应用程序中使用的 WinInet。

请参阅[http://support.microsoft.com/kb/290761](http://support.microsoft.com/kb/290761)，问题 3、4 和 5 以及

[http://support.microsoft.com/kb/238425/](http://support.microsoft.com/kb/238425/)。

这一点非常重要，否则您将体验到您的 Web 应用程序挂起和各种奇怪的废话。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-14T15:49:01.750

这里有几篇描述如何从类 ASP 页面调用 Web 服务的文章：

*   [将 ASP.NET XML Web 服务与“经典”ASP 应用程序集成](http://www.4guysfromrolla.com/webtech/070302-1.shtml)
*   [在经典 ASP 中使用 XML Web 服务](http://www.dotnetjunkies.com/Tutorial/99CA4563-FBD4-411F-A9C6-FF9E8A0E664F.dcik)
*   [从 ASP 使用 WSDL Web 服务](http://www.aspfree.com/c/a/ASP/Consuming-a-WSDL-Webservice-from-ASP/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-01-12T15:39:19.303

这里提供的一些答案似乎涵盖了如何使用 ClassicASP 来使用 Web 服务和 REST 调用。

在我看来，一个更简洁的解决方案可能是让您的 ClassicASP 仅以 REST 格式提供数据。如果可能，让您的基于浏览器的客户端代码处理“混搭”。您应该能够在不合并任何其他 ASP 组件的情况下执行此操作。

所以，这就是我如何在 ClassicASP 中模拟闪亮的新 REST 支持：

1.  提供一个单一的 ASP 网页作为登陆平台
2.  登陆板将处理两个参数：动词和 URL，以及一组表单内容
3.  使用某种开关块检查 URL 并将动词（和表单内容）定向到相关处理程序
4.  然后，处理程序将处理动词（PUT/POST/GET/DELETE）和表单内容，返回成功/失败代码和适当的数据。
5.  您的着陆台将检查成功/失败代码并返回相应的 HTTP 状态以及任何返回的数据

您将从将表单数据从/到 JSON 解码/编码的支持类中受益，因为这将简化您的客户端实现（并可能简化传递的数据量）。请参阅[任何用于在 Classic ASP 中解析 JSON 的好库？](https://stackoverflow.com/questions/1019223/any-good-libraries-for-parsing-json-in-classic-asp)

最后，在客户端，提供一个接受 Verb、Url 和数据负载的方法。在短期内，该方法将整理参数并将它们转发到您的着陆台。从长远来看（一旦您从 Classic ASP 切换），您的方法可以将数据发送到“真实”网址。

祝你好运...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-11-21T21:02:43.043

另一种可能的解决方案是编写一个 .NET DLL 进行调用并返回结果（也许包装类似 RESTSharp 的东西 - 给它一个根据您的需要定制的简单 API）。然后将 DLL 注册为 COM DLL 并通过 CreateObject 方法在 ASP 代码中使用它。

我已经为创建签名的 JWT 以及加盐和散列密码之类的事情做到了这一点。它工作得很好（当你疯狂地重写 ASP 时）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-14T15:54:08.557

您只需要一个 HTTP 客户端。在 .Net 中，WebRequest 运行良好。[对于经典 ASP，您将需要一个像这样](http://web.archive.org/web/20140829190201/http://www.coalesys.com/products/httpclient/features/default.asp)的特定组件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-13T05:14:17.513

另一种可能性是[通过 WinHttpRequest COM 对象使用 WinHttp COM 对象](http://msdn.microsoft.com/en-us/library/aa384079(VS.85).aspx)。

WinHttp 旨在从服务器代码中使用。

# user-interface - 你知道 GUI 编程的任何模式吗？（不是设计 GUI 的模式）

> ID：11263
> 
> 赞同：6
> 
> 时间：2008-08-14T16:09:55.030
> 
> 标签：user-interface, design-patterns

我正在寻找涉及 GUI 编码部分的模式。**不像**我非常熟悉的**MVC**那样全球化，而是关于单个控件和输入的模式、好的想法和最佳实践。

假设我想制作一个显示一些可能重叠的对象的控件。现在，如果我单击一个对象，我需要找出要做什么（只需找到我可以通过多种方式执行的对象，例如四叉树和 Z 顺序，这不是问题）。而且我可能会按住修改键，或者某些对象从一开始就处于活动状态，从而使选择或其他任何事情变得更复杂。我应该有一个表示屏幕对象的对象实例，单击时处理用户操作还是主类。等等。这样的问题有什么样的模式或解决方案？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-14T16:18:10.553

老实说，我认为你最好只了解你的标准设计模式并将它们应用于你在开发 UI 时面临的个别问题。

虽然有常见的 UI“主题”（例如处理修饰键），但实际实现可能会有很大差异。

我有 O'Reilly 的[Head First Design Patterns](http://www.amazon.co.uk/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.co.uk%2FHead-First-Design-Patterns%2Fdp%2F0596007124%2Fref%3Dpd_bbs_sr_1%3Fie%3DUTF8%26s%3Dbooks%26qid%3D1218730650%26sr%3D1-1&tag=robcthegeek-21&linkCode=ur2&camp=1634&creative=6738)和[The Poster](http://www.amazon.co.uk/gp/redirect.html?ie=UTF8&location=http%3A%2F%2Fwww.amazon.co.uk%2FHead-First-Design-Patterns-Poster%2Fdp%2F0596102143%2Fref%3Dpd_bbs_sr_3%3Fie%3DUTF8%26s%3Dbooks%26qid%3D1218730650%26sr%3D1-3&tag=robcthegeek-21&linkCode=ur2&camp=1634&creative=6738)，我发现它们非常宝贵！

### 无耻插件：这些链接使用我的同事 ID。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-06-08T16:41:41.927

Cay Horstmann 的面向对象设计和模式有一章题为“模式和 GUI 编程”。在该章中，Horstmann 涉及以下模式：

*   观察者布局管理器和
*   策略模式组件，
*   容器和复合模式
*   滚动条和装饰器模式

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-14T16:19:21.360

我不认为设计模式的好处来自于尝试找到适合问题的设计模式。但是，您可以使用一些启发式方法来帮助清理您的设计，例如使 UI 与系统中的其他对象尽可能分离。

在这种情况下，有一种模式可能会有所帮助，即[观察者模式](http://en.wikipedia.org/wiki/Observer_pattern)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-21T08:58:04.227

也许您正在寻找类似于我在一些关于 codeproject 的文章中看到的“MouseTrap”（搜索 UI 平台）？

我还发现这个系列非常有用[http://codebetter.com/jeremymiller/2007/07/26/the-build-your-own-cab-series-table-of-contents/](http://codebetter.com/jeremymiller/2007/07/26/the-build-your-own-cab-series-table-of-contents/)在那里你可以看看嵌入式控制器等等

米查。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-26T20:07:14.547

我知道你说的不像 MVC 那样全球化，但是 MVC 有一些变化——特别是 HMVC 和 PAC——我认为它们可以回答你提出的问题。

除此之外，即使您不直接应用它们，也要尝试“本着现有模式的精神”编写新代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-08-06T09:03:44.940

您正在寻找专业的应用程序编程。我搜索了很长时间的技巧和窍门，但没有成功。不幸的是，您不会发现任何有用的东西，这是一个复杂的话题，只有拥有多年的经验，您才能理解如何高效地编写应用程序。例如，几乎每个程序都会打开一个文件、提取信息、以不同的形式显示它、允许处理、保存……但没有人确切地解释什么是好的策略等等。此外，如果您正在编写一个大型应用程序，则需要考虑一些减少编译时间的策略（否则您将在每次编译时等待数小时）。例如，C++ 中的 Impls 习语可以帮助您。然后还有更多。出于这个原因，软件开发人员的薪水很高，而且有很多工作:-)

# c# - ASP.NET UserControl 和 DefaultEvent

> ID：11267
> 
> 赞同：5
> 
> 时间：2008-08-14T16:14:36.427
> 
> 标签：c#, asp.net, user-controls, attributes

# 大纲

好的，我已经用谷歌搜索了这个，并且已经期待一个大胖子了**！**但我想我应该问一下，因为我知道有时人们的脑海中可能会潜伏着奇怪的小知识宝石^_^

我正在研究一本书中的一些练习，这个特定的练习是用户控制。我拼凑了一个控件，并希望为其设置 DefaultEvent（已为以前的控件完成此操作），因此当我双击它时，创建的默认事件就是我指定的任何事件。

**注意：**这是标准的用户控件 (.ascx)，而*不是*自定义呈现的控件。

## 当前代码

这是类和事件定义：

```
[System.ComponentModel.DefaultEvent("OKClicked")]
public partial class AddressBox : System.Web.UI.UserControl
{
    public event EventHandler OKClicked; 
```

## 当前结果

现在，当我在 ASPX 页面上双击该控件时，将创建以下内容：

```
 protected void AddressBox1_Load(object sender, EventArgs e)
    {

    } 
```

不完全是我所期待的！所以，我的问题：

## 是否可以为 UserControl 定义 DefaultEvent？是黑客吗？如果 [不] 支持，有什么原因吗？

* * *

**旁注**：我们如何在代码中添加下划线？我似乎无法将 char 放入和转义？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-08-14T16:42:13.093

这是一个*可能的*答案，无需测试（就像马丁所做的那样）。

在反射器中，您将看到 DefaultEventAttribute 允许自身被继承。在反射器中，您会看到 UserControl 类将其默认事件设置为 Load 事件。

所以可能的原因是，即使你使用默认事件 OKClick 来装饰你的用户控件，VS 可能仍然认为默认事件是加载，因为它是从默认事件是加载的 UserControl 继承的。

只是对可能发生的事情的高度猜测。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T08:22:42.447

好的，我检查了这一点，继承自 WebControl 而不是 UserControl.. 一切正常。

看起来达伦·科普（ [Darren Kopp](https://stackoverflow.com/questions/11267/aspnet-usercontrols-and-defaultevent#11307)）为此夺冠！感谢您的输入！

# outlook - 使用 Exchange Server 对消息中的文本进行标准签名

> ID：11275
> 
> 赞同：2
> 
> 时间：2008-08-14T16:19:49.613
> 
> 标签：outlook, exchange-server

任何人都知道如何在不使用第三方程序的情况下做到这一点？如果无法使用附加组件来做到这一点，有人可以推荐一个吗？

编辑：我需要在服务器中添加它，以便所有用户都具有相同的签名。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-14T17:59:49.753

您需要创建自己的交换消息接收器来执行此操作。这是来自 MS KB 的经典 VB 示例：

[http://support.microsoft.com/kb/317327](http://support.microsoft.com/kb/317327)

和一个 VB 脚本：

[http://support.microsoft.com/kb/317680](http://support.microsoft.com/kb/317680)

MSDN 中关于 Exchange 2003 传输事件接收器的许多优点：

[http://msdn.microsoft.com/en-us/library/ms526223(EXCHG.10).aspx](http://msdn.microsoft.com/en-us/library/ms526223(EXCHG.10).aspx)

如果您运行的是 Exchange 2007，则可以使用传输规则：

[http://msexchangeteam.com/archive/2006/12/12/431879.aspx](http://msexchangeteam.com/archive/2006/12/12/431879.aspx)

[http://www.msexchange.org/tutorials/Using-Transport-Rules-Creating-Disclaimers-Exchange-Server-2007.html](http://www.msexchange.org/tutorials/Using-Transport-Rules-Creating-Disclaimers-Exchange-Server-2007.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T06:50:38.187

我们在 Exchange 2003 上使用了一段时间[的 CodeTwo-s](http://codetwo.com/) Exchange 规则。

但是，它存在一个已知问题：如果邮件在队列中停留 2-3 分钟，Exchange 本身会发送没有页脚的邮件。大多数时候这不是问题，但我们的组织中有大约 700 人。如果有很多电子邮件并且其中一些包含附件，则病毒扫描程序会停止它们一段时间（MS Antigen）。

否则，如果您要管理的用户组较小，这是一个完美的解决方案。

从另一个角度来看：我们的用户喜欢对签名进行某种控制。我们生成它们并将其放入他们的 Outlook 中。他们喜欢他们知道并看到签名在那里以及它的样子。

# vb.net - 自动增加的修订号不会显示在“关于”框中

> ID：11279
> 
> 赞同：2
> 
> 时间：2008-08-14T16:25:12.457
> 
> 标签：vb.net, visual-studio

我有一个小型 VB.NET 应用程序，我正在使用完整版的 Visual Studio 2005 进行开发。在项目的**Publish**属性中，我将其设置为*Automatically increase revision with each publish*。

问题是它只会增加安装文件中的修订。它似乎没有更新 About Box 中的版本号（这是通用的内置 About Box 模板）。该版本号似乎来自*My.Application.Info.Version*。

我应该改用什么，以便我的自动递增修订号显示在 about 框中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-14T16:35:52.903

将“关于”框的代码更改为

```
Me.LabelVersion.Text = String.Format("Version {0}", My.Application.Deployment.CurrentVersion.ToString) 
```

请注意，对于“我如何获得我的程序集版本”，所有其他答案都是正确的，而不是“如何显示我的发布版本”的陈述问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-14T16:41:22.720

我花了一秒钟才找到这个，但我相信这就是你要找的：

```
using System;
using System.Reflection;
public class VersionNumber
{
   public static void Main()
   {
      System.Reflection.Assembly assembly = System.Reflection.Assembly.GetExecutingAssembly();
      Version version = assembly.GetName().Version;
      Console.WriteLine ("Version: {0}", version);
      Console.WriteLine ("Major: {0}", version.Major);
      Console.WriteLine ("Minor: {0}", version.Minor);
      Console.WriteLine ("Build: {0}", version.Build);
      Console.WriteLine ("Revision: {0}", version.Revision);
      Console.Read();
   }
} 
```

它基于以下站点提供的代码 - [http://en.csharp-online.net/Display_type_version_number](http://en.csharp-online.net/Display_type_version_number)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-14T16:29:30.827

我不是 VB.NET 专家，但您是否尝试将值设置为例如 1.0.0.*？这应该会增加修订号（至少在 C# 的 AssemblyInfo.cs 中会增加）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-14T16:29:45.240

您选择的选项仅用于更新设置编号。要更新程序编号，您必须修改 AssemblyInfo。

C# [程序集：AssemblyVersion("XY *")] [程序集：AssemblyFileVersion("XY* ")]

VB.NET 程序集：AssemblyVersion("XY*")

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-14T16:57:12.907

4 个值中的每一个的最大值为 65535，但是当使用 1.0.* 或 1.0.*.* 时，Assembly Linker 将使用编码时间戳（因此它不是简单的自动增量，它可以重复！）适合 65535。

有关更多链接和详细信息，请参阅我对[这个问题的回答。](https://stackoverflow.com/questions/650/automatically-update-version-number#655)

# c# - 对复合集合进行排序

> ID：11288
> 
> 赞同：7
> 
> 时间：2008-08-14T16:30:49.933
> 
> 标签：c#, .net, wpf, data-binding, collections

因此 WPF 不支持 CompositeCollections 视图的标准排序或过滤行为，那么解决此问题的最佳实践是什么。

有两个或多个不同类型的对象集合。您希望将它们组合成一个可排序和可过滤的集合（必须手动实现排序或过滤）。

我考虑过的一种方法是创建一个只有几个核心属性的新对象集合，包括我希望对集合进行排序的那些，以及每种类型的对象实例。

```
class MyCompositeObject
{
    enum           ObjectType;
    DateTime       CreatedDate;
    string         SomeAttribute;
    myObjectType1  Obj1;
    myObjectType2  Obj2;
{
class MyCompositeObjects : List<MyCompositeObject> { } 
```

然后循环遍历我的两个对象集合以构建新的复合集合。显然，这是一种蛮力方法，但它会起作用。我将在我的新复合对象集合上获得所有默认视图排序和过滤行为，并且我可以在其上放置一个数据模板以根据实际存储在该复合项目中的类型正确显示我的列表项。

以更优雅的方式执行此操作有什么建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-14T16:38:03.430

您提到的“蛮力”方法实际上是理想的解决方案。请注意，所有对象都在 RAM 中，没有 I/O 瓶颈，因此您几乎可以在任何现代计算机上在一秒钟内对数百万个对象进行排序和过滤。

使用集合最优雅的方式是 .NET 3.5 中的 System.Linq 命名空间

> 谢谢 - 我也考虑过 LINQ to objects，但我担心类型化数据模板失去了灵活性，我需要在列表中显示对象。

如果您目前无法预测人们将如何对您的对象集合进行排序和过滤，那么您应该查看**System.Linq.Expressions**命名空间以在运行时按需构建您的 lambda 表达式（首先让用户构建表达式，然后编译，运行，最后你使用反射命名空间来枚举结果）。将你的头绕在它周围更棘手，但它是无价的特性，可能（对我来说肯定）比 LINQ 本身更具开创性的特性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-14T18:37:22.613

我对 WPF 还不是很熟悉，但我认为这是一个关于排序和过滤`List<T>`集合的问题。

> （不得不手动实现排序或过滤）

您会重新考虑实现自己的排序或过滤功能吗？根据我的经验，它很容易使用。下面的示例使用匿名委托，但您可以轻松定义自己的方法或类来实现复杂的排序或过滤。这样的类甚至可以具有动态配置和更改排序和过滤的属性。

`List<T>.Sort(Comparison<T> comparison)`与您的自定义比较功能一起使用：

```
// Sort according to the value of SomeAttribute
List<MyCompositeObject> myList = ...;
myList.Sort(delegate(MyCompositeObject a, MyCompositeObject b) 
{
    // return -1 if a < b
    // return 0 if a == b
    // return 1 if a > b
    return a.SomeAttribute.CompareTo(b.SomeAttribute);
}; 
```

从列表中获取项目子集合的类似方法。

`List<T>.FindAll(Predicate<T> match)`与您的自定义过滤器功能一起使用：

```
// Select all objects where myObjectType1 and myObjectType2 are not null
myList.FindAll(delegate(MyCompositeObject a)
{
    // return true to include 'a' in the sub-collection
    return (a.myObjectType1 != null) && (a.myObjectType2 != null);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-23T03:48:11.093

更新：我找到了一个更优雅的解决方案：

```
class MyCompositeObject
{
    DateTime    CreatedDate;
    string      SomeAttribute;
    Object      Obj1;
{
class MyCompositeObjects : List<MyCompositeObject> { } 
```

我发现由于反射，存储在 Obj1 中的特定类型在运行时被解析，并且类型特定的 DataTemplate 按预期应用！

# objective-c - 在 NSTextView 中捕获关键事件的最佳方法？

> ID：11291
> 
> 赞同：15
> 
> 时间：2008-08-14T16:32:22.957
> 
> 标签：objective-c, cocoa, events

我正在慢慢学习 Objective-C 和 Cocoa，到目前为止，我看到的在文本视图中捕获关键事件的唯一方法是使用委托，但是我很难找到有关如何实现这种解决方案的有用文档和示例。谁能指出我正确的方向或提供一些第一手帮助？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-08-14T16:43:05.883

通常，您实现它的方式只是将所需的功能添加到视图的控制器，并设置其委托。例如，如果您希望代码在视图加载时运行，您只需将视图委托给控制器，并实现 awakeFromNib 函数。

因此，要检测文本视图中的按键，请确保您的控制器是文本视图的委托，然后实现：

```
- (void)keyUp:(NSEvent *)theEvent 
```

请注意，这是继承的 NSResponder 方法，而不是 NSTextView 方法。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-16T10:35:10.017

只是语法高亮的提示：

不要一次突出显示整个文本视图 - 它*非常*慢。也不要使用 -editedRange 突出显示最后编辑的文本 - 如果用户将大量文本粘贴到文本视图中，它也会非常慢。

相反，您需要突出显示如下所示的可见文本：

```
NSRect visibleRect = [[[textView enclosingScrollView] contentView] documentVisibleRect];
NSRange visibleRange = [[textView layoutManager] glyphRangeForBoundingRect:visibleRect inTextContainer:[textView textContainer]]; 
```

然后你将 visibleRange 提供给你的高亮代码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-15T05:41:51.943

告诉我们你真正想要完成的事情很重要——你认为在 NSTextView 中捕获关键事件将解决的更高级别的目标。

例如，当有人问我如何在 NSText**字段**中捕获关键事件时，他们真正想知道的是如何验证字段中的输入。这是通过将字段的格式化程序设置为 NSFormatter 的实例（无论是 Cocoa 中包含的格式化程序之一还是自定义格式化程序），而不是直接处理击键来完成的。

鉴于这个例子，你真正想要完成什么？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-15T23:12:13.267

我做了一些艰苦的挖掘，我确实找到了我自己问题的答案。我会在下面得到它，但感谢两个回答的家伙。我认为 Stack Overflow 已经是一个很棒的网站——我希望更多的 Mac 开发人员在测试版结束后找到自己的方式——这对于希望过渡到该平台的其他开发人员来说可能是一个很好的资源。

因此，按照 Danny 的建议，我确实在代表团中找到了答案。我从 Danny 的帖子中不明白的是，委托对象中有一组启用委托的方法，并且委托必须实现所述事件。因此，对于 TextView，我能够找到 textDidChange 方法，它以一种比简单捕获按键更好的方式完成了我想要的工作。所以如果我在我的控制器中实现这个：

```
- (void)textDidChange:(NSNotification *)aNotification; 
```

我可以回复正在编辑的文本。当然，还有其他可用的方法，我很高兴与它们一起玩，因为我知道我会学到很多东西。再次感谢各位。

# xml - 如何使用 vba 解析 XML

> ID：11305
> 
> 赞同：81
> 
> 时间：2008-08-14T16:41:25.903
> 
> 标签：xml, vba, parsing, xml-parsing

我在 VBA 中工作，并想解析一个字符串，例如

```
<PointN xsi:type='typens:PointN' 
xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' 
xmlns:xs='http://www.w3.org/2001/XMLSchema'>
    <X>24.365</X>
    <Y>78.63</Y>
</PointN> 
```

并将 X 和 Y 值放入两个单独的整数变量中。

我是 XML 的新手，因为我在 VB6 和 VBA 中工作，因为我工作的领域。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-08-14T17:40:24.100

感谢您的指点。

我不知道这是否是解决问题的最佳方法，但这是我如何让它工作的。我在我的 VBA 中引用了 Microsoft XML、v2.6 dll，然后下面的代码片段为我提供了所需的值

```
Dim objXML As MSXML2.DOMDocument

Set objXML = New MSXML2.DOMDocument

If Not objXML.loadXML(strXML) Then  'strXML is the string with XML'
    Err.Raise objXML.parseError.ErrorCode, , objXML.parseError.reason
End If

Dim point As IXMLDOMNode
Set point = objXML.firstChild

Debug.Print point.selectSingleNode("X").Text
Debug.Print point.selectSingleNode("Y").Text 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2008-08-14T16:47:07.437

这是一个有点复杂的问题，但似乎最直接的方法是通过 MSXML2.DOMDocument 加载 XML 文档或 XML 字符串，然后允许您访问 XML 节点。

您可以在以下站点找到有关 MSXML2.DOMDocument 的更多信息：

*   [使用 Excel VBA 和 Xpath 操作 XML 文件](https://web.archive.org/web/20161217090033/http://en.allexperts.com/q/XML-1469/Manipulating-XML-files-Excel.htm)
*   MSXML - [http://msdn.microsoft.com/en-us/library/ms763742(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms763742(VS.85).aspx)
*   [MSXML 4.0 概述](https://web.archive.org/web/20161030020427/http://www.xml.com:80/lpt/a/979)

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2015-10-13T13:29:42.870

添加参考 Project->References Microsoft XML, 6.0，您可以使用示例代码：

```
 Dim xml As String

    xml = "<root><person><name>Me </name> </person> <person> <name>No Name </name></person></root> "
    Dim oXml As MSXML2.DOMDocument60
    Set oXml = New MSXML2.DOMDocument60
    oXml.loadXML xml
    Dim oSeqNodes, oSeqNode As IXMLDOMNode

    Set oSeqNodes = oXml.selectNodes("//root/person")
    If oSeqNodes.length = 0 Then
       'show some message
    Else
        For Each oSeqNode In oSeqNodes
             Debug.Print oSeqNode.selectSingleNode("name").Text
        Next
    End If 
```

注意 xml 节点 //Root/Person 与 //root/person 不同，selectSingleNode("Name").text 也与 selectSingleNode("name").text 不同

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2014-12-30T11:24:13.157

您可以使用 XPath 查询：

```
Dim objDom As Object        '// DOMDocument
Dim xmlStr As String, _
    xPath As String

xmlStr = _
    "<PointN xsi:type='typens:PointN' " & _
    "xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' " & _
    "xmlns:xs='http://www.w3.org/2001/XMLSchema'> " & _
    "    <X>24.365</X> " & _
    "    <Y>78.63</Y> " & _
    "</PointN>"

Set objDom = CreateObject("Msxml2.DOMDocument.3.0")     '// Using MSXML 3.0

'/* Load XML */
objDom.LoadXML xmlStr

'/*
' * XPath Query
' */        

'/* Get X */
xPath = "/PointN/X"
Debug.Print objDom.SelectSingleNode(xPath).text

'/* Get Y */
xPath = "/PointN/Y"
Debug.Print objDom.SelectSingleNode(xPath).text 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-05-09T02:19:29.950

这是一个使用 FeedDemon opml 文件的示例 OPML 解析器：

```
Sub debugPrintOPML()

' http://msdn.microsoft.com/en-us/library/ms763720(v=VS.85).aspx
' http://msdn.microsoft.com/en-us/library/system.xml.xmlnode.selectnodes.aspx
' http://msdn.microsoft.com/en-us/library/ms256086(v=VS.85).aspx ' expressions
' References: Microsoft XML

Dim xmldoc As New DOMDocument60
Dim oNodeList As IXMLDOMSelection
Dim oNodeList2 As IXMLDOMSelection
Dim curNode As IXMLDOMNode
Dim n As Long, n2 As Long, x As Long

Dim strXPathQuery As String
Dim attrLength As Byte
Dim FilePath As String

FilePath = "rss.opml"

xmldoc.Load CurrentProject.Path & "\" & FilePath

strXPathQuery = "opml/body/outline"
Set oNodeList = xmldoc.selectNodes(strXPathQuery)

For n = 0 To (oNodeList.length - 1)
    Set curNode = oNodeList.Item(n)
    attrLength = curNode.Attributes.length
    If attrLength > 1 Then ' or 2 or 3
        Call processNode(curNode)
    Else
        Call processNode(curNode)
        strXPathQuery = "opml/body/outline[position() = " & n + 1 & "]/outline"
        Set oNodeList2 = xmldoc.selectNodes(strXPathQuery)
        For n2 = 0 To (oNodeList2.length - 1)
            Set curNode = oNodeList2.Item(n2)
            Call processNode(curNode)
        Next
    End If
        Debug.Print "----------------------"
Next

Set xmldoc = Nothing

End Sub

Sub processNode(curNode As IXMLDOMNode)

Dim sAttrName As String
Dim sAttrValue As String
Dim attrLength As Byte
Dim x As Long

attrLength = curNode.Attributes.length

For x = 0 To (attrLength - 1)
    sAttrName = curNode.Attributes.Item(x).nodeName
    sAttrValue = curNode.Attributes.Item(x).nodeValue
    Debug.Print sAttrName & " = " & sAttrValue
Next
    Debug.Print "-----------"

End Sub 
```

这个采用多级文件夹树（Awasu，NewzCrawler）：

```
...
Call xmldocOpen4
Call debugPrintOPML4(Null)
...

Dim sText4 As String

Sub debugPrintOPML4(strXPathQuery As Variant)

Dim xmldoc4 As New DOMDocument60
'Dim xmldoc4 As New MSXML2.DOMDocument60 ' ?
Dim oNodeList As IXMLDOMSelection
Dim curNode As IXMLDOMNode
Dim n4 As Long

If IsNull(strXPathQuery) Then strXPathQuery = "opml/body/outline"

' http://msdn.microsoft.com/en-us/library/ms754585(v=VS.85).aspx
xmldoc4.async = False
xmldoc4.loadXML sText4
If (xmldoc4.parseError.errorCode <> 0) Then
   Dim myErr
   Set myErr = xmldoc4.parseError
   MsgBox ("You have error " & myErr.reason)
Else
'   MsgBox xmldoc4.xml
End If

Set oNodeList = xmldoc4.selectNodes(strXPathQuery)

For n4 = 0 To (oNodeList.length - 1)
    Set curNode = oNodeList.Item(n4)
    Call processNode4(strXPathQuery, curNode, n4)
Next

Set xmldoc4 = Nothing

End Sub

Sub processNode4(strXPathQuery As Variant, curNode As IXMLDOMNode, n4 As Long)

Dim sAttrName As String
Dim sAttrValue As String
Dim x As Long

For x = 0 To (curNode.Attributes.length - 1)
    sAttrName = curNode.Attributes.Item(x).nodeName
    sAttrValue = curNode.Attributes.Item(x).nodeValue
    'If sAttrName = "text"
    Debug.Print strXPathQuery & " :: " & sAttrName & " = " & sAttrValue
    'End If
Next
    Debug.Print ""

If curNode.childNodes.length > 0 Then
    Call debugPrintOPML4(strXPathQuery & "[position() = " & n4 + 1 & "]/" & curNode.nodeName)
End If

End Sub

Sub xmldocOpen4()

Dim oFSO As New FileSystemObject ' Microsoft Scripting Runtime Reference
Dim oFS
Dim FilePath As String

FilePath = "rss_awasu.opml"
Set oFS = oFSO.OpenTextFile(CurrentProject.Path & "\" & FilePath)
sText4 = oFS.ReadAll
oFS.Close

End Sub 
```

或更好：

```
Sub xmldocOpen4()

Dim FilePath As String

FilePath = "rss.opml"

' function ConvertUTF8File(sUTF8File):
' http://www.vbmonster.com/Uwe/Forum.aspx/vb/24947/How-to-read-UTF-8-chars-using-VBA
' loading and conversion from Utf-8 to UTF
sText8 = ConvertUTF8File(CurrentProject.Path & "\" & FilePath)

End Sub 
```

但我不明白，为什么每次都要加载 xmldoc4。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-04-21T16:30:39.850

**更新**

下面介绍的过程给出了一个使用 XML DOM 对象通过 VBA 解析 XML 的示例。代码基于[XML DOM 的初学者指南](https://msdn.microsoft.com/en-us/library/Aa468547.aspx)。

```
Public Sub LoadDocument()
    Dim xDoc As MSXML.DOMDocument
    Set xDoc = New MSXML.DOMDocument
    xDoc.validateOnParse = False
    If xDoc.Load("C:\My Documents\sample.xml") Then
        ' The document loaded successfully.
        ' Now do something intersting.
        DisplayNode xDoc.childNodes, 0
    Else
        ' The document failed to load.
        ' See the previous listing for error information.
    End If
End Sub

Public Sub DisplayNode(ByRef Nodes As MSXML.IXMLDOMNodeList, _
   ByVal Indent As Integer)

   Dim xNode As MSXML.IXMLDOMNode
   Indent = Indent + 2

   For Each xNode In Nodes
      If xNode.nodeType = NODE_TEXT Then
         Debug.Print Space$(Indent) & xNode.parentNode.nodeName & _
            ":" & xNode.nodeValue
      End If

      If xNode.hasChildNodes Then
         DisplayNode xNode.childNodes, Indent
      End If
   Next xNode
End Sub 
```

> **Nota Bene** - 这个最初的答案显示了我能想象的最简单的事情（当时我正在研究一个非常具体的问题）。使用内置于 VBA XML Dom 中的 XML 工具自然会好得多。请参阅上面的更新。

**原始回复**

我知道这是一篇非常古老的帖子，但我想分享我对这个复杂问题的简单解决方案。我主要使用基本字符串函数来访问 xml 数据。

这假设您有一些已在 VBA 函数中返回的 xml 数据（在 temp 变量中）。有趣的是，还可以看到我如何链接到 xml Web 服务来检索值。图像中显示的函数也采用查找值，因为可以使用 = FunctionName(value1, value2) 从单元格内访问此 Excel VBA 函数，以通过 Web 服务将值返回到电子表格中。

![样本函数](../Images/77e33f4d510431d146b03e861d4dc69d.png)

```
 openTag = ""
closeTag = "" 

' Locate the position of the enclosing tags
startPos = InStr(1, temp, openTag)
endPos = InStr(1, temp, closeTag)
startTagPos = InStr(startPos, temp, ">") + 1
' Parse xml for returned value
Data = Mid(temp, startTagPos, endPos - startTagPos) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-01-12T18:30:13.497

这是解析包含结构钢形状数据的 MicroStation Triforma XML 文件的简短子项。

```
'location of triforma structural files
'c:\programdata\bentley\workspace\triforma\tf_imperial\data\us.xml

Sub ReadTriformaImperialData()
Dim txtFileName As String
Dim txtFileLine As String
Dim txtFileNumber As Long

Dim Shape As String
Shape = "w12x40"

txtFileNumber = FreeFile
txtFileName = "c:\programdata\bentley\workspace\triforma\tf_imperial\data\us.xml"

Open txtFileName For Input As #txtFileNumber

Do While Not EOF(txtFileNumber)
Line Input #txtFileNumber, txtFileLine
    If InStr(1, UCase(txtFileLine), UCase(Shape)) Then
        P1 = InStr(1, UCase(txtFileLine), "D=")
        D = Val(Mid(txtFileLine, P1 + 3))

        P2 = InStr(1, UCase(txtFileLine), "TW=")
        TW = Val(Mid(txtFileLine, P2 + 4))

        P3 = InStr(1, UCase(txtFileLine), "WIDTH=")
        W = Val(Mid(txtFileLine, P3 + 7))

        P4 = InStr(1, UCase(txtFileLine), "TF=")
        TF = Val(Mid(txtFileLine, P4 + 4))

        Close txtFileNumber
        Exit Do
    End If
Loop
End Sub 
```

从这里您可以使用这些值在 MicroStation 2d 中绘制形状或在 3d 中绘制形状并将其拉伸为实体。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-11-30T22:13:25.023

当您不想启用宏时，通常在没有 VBA 的情况下更容易解析。这可以通过替换功能来完成。在单元格 B1 和 C1 中输入您的开始和结束节点。

```
Cell A1: {your XML here}
Cell B1: <X>
Cell C1: </X>
Cell D1: =REPLACE(A1,1,FIND(A2,A1)+LEN(A2)-1,"")
Cell E1: =REPLACE(A4,FIND(A3,A4),LEN(A4)-FIND(A3,A4)+1,"") 
```

结果行 E1 将具有您的解析值：

```
Cell A1: {your XML here}
Cell B1: <X>
Cell C1: </X>
Cell D1: 24.365<X><Y>78.68</Y></PointN>
Cell E1: 24.365 
```

# winforms - 格式化 WinForm 标签中的文本

> ID：11311
> 
> 赞同：23
> 
> 时间：2008-08-14T16:43:03.903
> 
> 标签：winforms, text, formatting, label

是否可以在 WinForm 标签中格式化某些文本，而不是将文本分成多个标签？请忽略标签文本中的 HTML 标签；它只是用来说明我的观点。

例如：

```
Dim myLabel As New Label
myLabel.Text = "This is <b>bold</b> text.  This is <i>italicized</i> text." 
```

这会将标签中的文本生成为：

> 这是**粗体**文本。这是 *斜体*文本。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-08-14T16:45:50.810

这对于 WinForms 标签是不可能的。标签必须只有一种字体，一种尺寸和一张脸。你有几个选择：

1.  使用单独的标签
2.  创建一个新的 Control 派生类，该类通过 GDI+ 进行自己的绘图并使用它而不是 Label；这可能是您最好的选择，因为它使您可以完全控制如何指示控件格式化其文本
3.  使用第三方标签控件，它可以让您插入 HTML 片段（有一堆 - 检查 CodeProject）；这将是其他人对#2 的实现。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-08-14T17:07:39.970

不是真的，但你可以用只读的没有边框的 RichTextBox 来伪造它。RichTextBox 支持富文本格式 (rtf)。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2014-06-13T14:28:16.537

另一种解决方法，迟到了：如果您不想使用第三方控件，并且您只是想引起对标签中某些文本的注意，*并且*您可以使用下划线，您可以使用一个[链接标签](http://msdn.microsoft.com/en-us/library/system.windows.forms.linklabel(v=vs.110).aspx)。

请注意，许多人认为这是一种“[可用性犯罪](https://ux.stackexchange.com/a/18088)”，但如果您不是为最终用户消费而设计的东西，那么它可能是您准备好在您的良心上拥有的东西。

诀窍是将禁​​用的链接添加到您想要下划线的文本部分，然后全局设置链接颜色以匹配标签的其余部分。您可以在设计时设置几乎所有必要的属性，除了`Links.Add()`片段，但这里它们在代码中：

```
linkLabel1.Text = "You are accessing a government system, and all activity " +
                  "will be logged.  If you do not wish to continue, log out now.";
linkLabel1.AutoSize = false;
linkLabel1.Size = new Size(365, 50);
linkLabel1.TextAlign = ContentAlignment.MiddleCenter;
linkLabel1.Links.Clear();
linkLabel1.Links.Add(20, 17).Enabled = false;   // "government system"
linkLabel1.Links.Add(105, 11).Enabled = false;  // "log out now"
linkLabel1.LinkColor = linkLabel1.ForeColor;
linkLabel1.DisabledLinkColor = linkLabel1.ForeColor; 
```

结果：

![在此处输入图像描述](../Images/cd4f6bc6951f34a3d66a47d224be596f.png)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-02-25T20:20:12.347

为我工作的解决方案 - 使用自定义 RichEditBox。使用正确的属性，它将被视为带有粗体支持的简单标签。

**1）**首先，添加带有禁用插入符号的自定义 RichTextLabel 类：

```
public class RichTextLabel : RichTextBox
{
    public RichTextLabel()
    {
        base.ReadOnly = true;
        base.BorderStyle = BorderStyle.None;
        base.TabStop = false;
        base.SetStyle(ControlStyles.Selectable, false);
        base.SetStyle(ControlStyles.UserMouse, true);
        base.SetStyle(ControlStyles.SupportsTransparentBackColor, true);

        base.MouseEnter += delegate(object sender, EventArgs e)
        {
            this.Cursor = Cursors.Default;
        };
    }

    protected override void WndProc(ref Message m)
    {
        if (m.Msg == 0x204) return; // WM_RBUTTONDOWN
        if (m.Msg == 0x205) return; // WM_RBUTTONUP
        base.WndProc(ref m);
    }
} 
```

**2）**将您的句子拆分为带有 IsSelected 标志的单词，以确定该单词是否应该是粗体：

```
 private void AutocompleteItemControl_Load(object sender, EventArgs e)
    {
        RichTextLabel rtl = new RichTextLabel();
        rtl.Font = new Font("MS Reference Sans Serif", 15.57F);
        StringBuilder sb = new StringBuilder();
        sb.Append(@"{\rtf1\ansi ");
        foreach (var wordPart in wordParts)
        {
            if (wordPart.IsSelected)
            {
                sb.Append(@"\b ");
            }
            sb.Append(ConvertString2RTF(wordPart.WordPart));
            if (wordPart.IsSelected)
            {
                sb.Append(@"\b0 ");
            }
        }
        sb.Append(@"}");

        rtl.Rtf = sb.ToString();
        rtl.Width = this.Width;
        this.Controls.Add(rtl);
    } 
```

**3)**添加将文本转换为有效 rtf 的功能（支持 unicode！）：

```
 private string ConvertString2RTF(string input)
    {
        //first take care of special RTF chars
        StringBuilder backslashed = new StringBuilder(input);
        backslashed.Replace(@"\", @"\\");
        backslashed.Replace(@"{", @"\{");
        backslashed.Replace(@"}", @"\}");

        //then convert the string char by char
        StringBuilder sb = new StringBuilder();
        foreach (char character in backslashed.ToString())
        {
            if (character <= 0x7f)
                sb.Append(character);
            else
                sb.Append("\\u" + Convert.ToUInt32(character) + "?");
        }
        return sb.ToString();
    } 
```

![样本](../Images/1a807c44e5ade2f62f399838ce951196.png)

对我来说就像一个魅力！解决方案编译自：

[如何在 C# 中将字符串转换为 RTF？](https://stackoverflow.com/questions/4795709/how-to-convert-a-string-to-rtf-in-c)

[格式化富文本框中的文本](https://stackoverflow.com/questions/4077582/format-text-in-rich-text-box)

[如何在 RichTextBox 中隐藏插入符号？](https://stackoverflow.com/questions/582312/how-to-hide-the-caret-in-a-richtextbox)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-10-21T16:58:53.433

1.  在写字板中将文本创建为 RTF 文件
2.  创建没有边框且可编辑的富文本控件 = false
3.  将 RTF 文件作为资源添加到项目中
4.  在 Form1_load 中做

    myRtfControl.Rtf = Resource1.MyRtfControlText

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-10-19T09:52:48.530

# 自动富集标签

      [![带有格式化 RTF 内容的 AutoRichLabel](../Images/f7295c0ff5e4b296b35adb88d8c2c08c.png)](https://i.stack.imgur.com/cETHe.png)

我通过构建一个`UserControl`包含`TransparentRichTextBox`只读的一个来解决这个问题。这`TransparentRichTextBox`是一个`RichTextBox`允许透明的：

透明富文本框.cs：

```
public class TransparentRichTextBox : RichTextBox
{
    [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
    static extern IntPtr LoadLibrary(string lpFileName);

    protected override CreateParams CreateParams
    {
        get
        {
            CreateParams prams = base.CreateParams;
            if (TransparentRichTextBox.LoadLibrary("msftedit.dll") != IntPtr.Zero)
            {
                prams.ExStyle |= 0x020; // transparent 
                prams.ClassName = "RICHEDIT50W";
            }
            return prams;
        }
    }
} 
```

final`UserControl`充当`TransparentRichTextBox`. 不幸的是，我不得不将它限制`AutoSize`在我自己的方式上，因为它`AutoSize`已经`RichTextBox`坏了。

AutoRichLabel.designer.cs：

```
partial class AutoRichLabel
{
    /// <summary> 
    /// Required designer variable.
    /// </summary>
    private System.ComponentModel.IContainer components = null;

    /// <summary> 
    /// Clean up any resources being used.
    /// </summary>
    /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
    protected override void Dispose(bool disposing)
    {
        if (disposing && (components != null))
        {
            components.Dispose();
        }
        base.Dispose(disposing);
    }

    #region Component Designer generated code

    /// <summary> 
    /// Required method for Designer support - do not modify 
    /// the contents of this method with the code editor.
    /// </summary>
    private void InitializeComponent()
    {
        this.rtb = new TransparentRichTextBox();
        this.SuspendLayout();
        // 
        // rtb
        // 
        this.rtb.BorderStyle = System.Windows.Forms.BorderStyle.None;
        this.rtb.Dock = System.Windows.Forms.DockStyle.Fill;
        this.rtb.Location = new System.Drawing.Point(0, 0);
        this.rtb.Margin = new System.Windows.Forms.Padding(0);
        this.rtb.Name = "rtb";
        this.rtb.ReadOnly = true;
        this.rtb.ScrollBars = System.Windows.Forms.RichTextBoxScrollBars.None;
        this.rtb.Size = new System.Drawing.Size(46, 30);
        this.rtb.TabIndex = 0;
        this.rtb.Text = "";
        this.rtb.WordWrap = false;
        this.rtb.ContentsResized += new System.Windows.Forms.ContentsResizedEventHandler(this.rtb_ContentsResized);
        // 
        // AutoRichLabel
        // 
        this.AutoScaleDimensions = new System.Drawing.SizeF(6F, 13F);
        this.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font;
        this.AutoSizeMode = System.Windows.Forms.AutoSizeMode.GrowAndShrink;
        this.BackColor = System.Drawing.Color.Transparent;
        this.Controls.Add(this.rtb);
        this.Name = "AutoRichLabel";
        this.Size = new System.Drawing.Size(46, 30);
        this.ResumeLayout(false);

    }

    #endregion

    private TransparentRichTextBox rtb;
} 
```

AutoRichLabel.cs：

```
/// <summary>
/// <para>An auto sized label with the ability to display text with formattings by using the Rich Text Format.</para>
/// <para>­</para>
/// <para>Short RTF syntax examples: </para>
/// <para>­</para>
/// <para>Paragraph: </para>
/// <para>{\pard This is a paragraph!\par}</para>
/// <para>­</para>
/// <para>Bold / Italic / Underline: </para>
/// <para>\b bold text\b0</para>
/// <para>\i italic text\i0</para>
/// <para>\ul underline text\ul0</para>
/// <para>­</para>
/// <para>Alternate color using color table: </para>
/// <para>{\colortbl ;\red0\green77\blue187;}{\pard The word \cf1 fish\cf0  is blue.\par</para>
/// <para>­</para>
/// <para>Additional information: </para>
/// <para>Always wrap every text in a paragraph. </para>
/// <para>Different tags can be stacked (i.e. \pard\b\i Bold and Italic\i0\b0\par)</para>
/// <para>The space behind a tag is ignored. So if you need a space behind it, insert two spaces (i.e. \pard The word \bBOLD\0  is bold.\par)</para>
/// <para>Full specification: http://www.biblioscape.com/rtf15_spec.htm </para>
/// </summary>
public partial class AutoRichLabel : UserControl
{
    /// <summary>
    /// The rich text content. 
    /// <para>­</para>
    /// <para>Short RTF syntax examples: </para>
    /// <para>­</para>
    /// <para>Paragraph: </para>
    /// <para>{\pard This is a paragraph!\par}</para>
    /// <para>­</para>
    /// <para>Bold / Italic / Underline: </para>
    /// <para>\b bold text\b0</para>
    /// <para>\i italic text\i0</para>
    /// <para>\ul underline text\ul0</para>
    /// <para>­</para>
    /// <para>Alternate color using color table: </para>
    /// <para>{\colortbl ;\red0\green77\blue187;}{\pard The word \cf1 fish\cf0  is blue.\par</para>
    /// <para>­</para>
    /// <para>Additional information: </para>
    /// <para>Always wrap every text in a paragraph. </para>
    /// <para>Different tags can be stacked (i.e. \pard\b\i Bold and Italic\i0\b0\par)</para>
    /// <para>The space behind a tag is ignored. So if you need a space behind it, insert two spaces (i.e. \pard The word \bBOLD\0  is bold.\par)</para>
    /// <para>Full specification: http://www.biblioscape.com/rtf15_spec.htm </para>
    /// </summary>
    [Browsable(true)]
    public string RtfContent
    {
        get
        {
            return this.rtb.Rtf;
        }
        set
        {
            this.rtb.WordWrap = false; // to prevent any display bugs, word wrap must be off while changing the rich text content. 
            this.rtb.Rtf = value.StartsWith(@"{\rtf1") ? value : @"{\rtf1" + value + "}"; // Setting the rich text content will trigger the ContentsResized event. 
            this.Fit(); // Override width and height. 
            this.rtb.WordWrap = this.WordWrap; // Set the word wrap back. 
        }
    }

    /// <summary>
    /// Dynamic width of the control. 
    /// </summary>
    [Browsable(false)]
    public new int Width
    {
        get
        {
            return base.Width;
        } 
    }

    /// <summary>
    /// Dynamic height of the control. 
    /// </summary>
    [Browsable(false)]
    public new int Height
    {
        get
        {
            return base.Height;
        }
    }

    /// <summary>
    /// The measured width based on the content. 
    /// </summary>
    public int DesiredWidth { get; private set; }

    /// <summary>
    /// The measured height based on the content. 
    /// </summary>
    public int DesiredHeight { get; private set; }

    /// <summary>
    /// Determines the text will be word wrapped. This is true, when the maximum size has been set. 
    /// </summary>
    public bool WordWrap { get; private set; }

    /// <summary>
    /// Constructor. 
    /// </summary>
    public AutoRichLabel()
    {
        InitializeComponent();
    }

    /// <summary>
    /// Overrides the width and height with the measured width and height
    /// </summary>
    public void Fit()
    {
        base.Width = this.DesiredWidth;
        base.Height = this.DesiredHeight;
    }

    /// <summary>
    /// Will be called when the rich text content of the control changes. 
    /// </summary>
    private void rtb_ContentsResized(object sender, ContentsResizedEventArgs e)
    {
        this.AutoSize = false; // Disable auto size, else it will break everything
        this.WordWrap = this.MaximumSize.Width > 0; // Enable word wrap when the maximum width has been set. 
        this.DesiredWidth = this.rtb.WordWrap ? this.MaximumSize.Width : e.NewRectangle.Width; // Measure width. 
        this.DesiredHeight = this.MaximumSize.Height > 0 && this.MaximumSize.Height < e.NewRectangle.Height ? this.MaximumSize.Height : e.NewRectangle.Height; // Measure height. 
        this.Fit(); // Override width and height. 
    }
} 
```

富文本格式的语法非常简单：

段落：

```
{\pard This is a paragraph!\par} 
```

粗体/斜体/下划线文本：

```
\b bold text\b0
\i italic text\i0
\ul underline text\ul0 
```

使用颜色表替换颜色：

```
{\colortbl ;\red0\green77\blue187;}
{\pard The word \cf1 fish\cf0  is blue.\par 
```

但请注意：始终将每个文本都包含在一个段落中。此外，可以堆叠不同的标签（即`\pard\b\i Bold and Italic\i0\b0\par`）并忽略标签后面的空格字符。因此，如果您需要在其后面留一个空格，请插入两个空格（即`\pard The word \bBOLD\0 is bold.\par`）。要转义`\`或`{`或`}`，请使用前导`\`。有关详细信息[，请参阅在线富文本格式的完整规范](http://www.biblioscape.com/rtf15_spec.htm)。

使用这种非常简单的语法，您可以生成类似于第一张图片中看到的内容。在第一张图片中附加到`RtfContent`my 属性的富文本内容是：`AutoRichLabel`

```
{\colortbl ;\red0\green77\blue187;}
{\pard\b BOLD\b0  \i ITALIC\i0  \ul UNDERLINE\ul0 \\\{\}\par}
{\pard\cf1\b BOLD\b0  \i ITALIC\i0  \ul UNDERLINE\ul0\cf0 \\\{\}\par} 
```

> [![带有格式化 RTF 内容的 AutoRichLabel](../Images/f7295c0ff5e4b296b35adb88d8c2c08c.png)](https://i.stack.imgur.com/cETHe.png)

如果要启用自动换行，请将最大宽度设置为所需大小。但是，即使文本较短，这也会将宽度固定为最大宽度。

玩得开心！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-12-30T08:19:41.117

2009 年有一篇关于代码项目的优秀文章，名为“[您将使用的专业 HTML 渲染器](http://www.codeproject.com/KB/GDI-plus/HtmlRenderer.aspx)”，它实现了与原始发帖人想要的类似的东西。

我在我们的几个项目中成功地使用了它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-04-16T15:42:09.957

非常简单的解决方案：

1.  在表单上添加 2 个标签，LabelA 和 LabelB
2.  转到 LabelA 的属性并将其停靠在左侧。
3.  转到 LabelB 的属性并将其停靠在左侧。
4.  将 LabelA 的字体设置为粗体。

现在 LabelB 将根据 LabelA 的文本长度发生变化。

就这样。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-14T16:45:14.430

我也有兴趣了解它是否可能。

当我们找不到解决方案时，我们求助于 Component Ones 'SuperLabel' 控件，该控件允许在标签中添加 HTML 标记。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-02-27T15:36:14.237

意识到这是一个老问题，我的答案更多是为了像我这样仍在寻找这样的解决方案并偶然发现这个问题的人。

除了已经提到的，DevExpress 的[LabelControl](https://documentation.devexpress.com/#windowsforms/clsDevExpressXtraEditorsLabelControltopic)是一个支持这种行为的标签 - [demo here](https://documentation.devexpress.com/#windowsforms/CustomDocument9536)。唉，它是付费图书馆的一部分。

如果您正在寻找免费的解决方案，我相信[HTML Renderer](http://htmlrenderer.codeplex.com/)是下一个最佳选择。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-08-27T12:34:37.827

FlowLayoutPanel 可以很好地解决您的问题。如果您将标签添加到流程面板并格式化每个标签的字体和边距属性，那么您可以拥有不同的字体样式。开始工作的非常快速和简单的解决方案。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-04-01T15:45:41.760

是的。您可以使用 HTML Render 来实现。如你所见，请点击链接：[https](https://htmlrenderer.codeplex.com/) ://htmlrenderer.codeplex.com/ 我希望这很有用。

# .net - WinForms 中的简单动画

> ID：11318
> 
> 赞同：24
> 
> 时间：2008-08-14T16:44:42.060
> 
> 标签：.net, winforms, animation

想象一下，您想为 WinForm 上的某个对象设置动画。您设置一个计时器来更新状态或模型，并覆盖 Form 的绘制事件。但是从那里开始，为动画不断重新绘制表单的最佳方法是什么？

*   完成绘图后立即使表格无效？
*   设置第二个计时器并定期使表单无效？
*   也许这件事有一个共同的模式？
*   是否有任何有用的 .NET 类可以提供帮助？

每次我需要这样做时，我都会发现一种具有新缺点的新方法。SO 社区的经验和建议是什么？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-07-20T21:10:10.663

我创建了一个可能对此有所帮助的库。它被称为过渡，可以在这里找到：[https](https://github.com/UweKeim/dot-net-transitions) ://github.com/UweKeim/dot-net-transitions 。在 nuget 上作为[dot-net-transitions 包提供](https://www.nuget.org/packages/dot-net-transitions/)

它使用在后台线程上运行的计时器来为对象设置动画。该库是开源的，所以如果它对您有用，您可以查看代码以了解它在做什么。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-14T17:39:43.307

在某些情况下，不使用绘制事件进行绘制，而是从控件/表单获取 Graphics 对象并“在”其上绘制会更快、更方便。这可能会给不透明度/抗锯齿/文本等带来一些麻烦，但就不必重新绘制整个沙邦而言，这可能是值得的。类似于以下内容：

```
private void AnimationTimer_Tick(object sender, EventArgs args)
{
    // First paint background, like Clear(Control.Background), or by
    // painting an image you have previously buffered that was the background.
    animationControl.CreateGraphics().DrawImage(0, 0, animationImages[animationTick++])); 
} 
```

我自己在一些控件中使用它，并在感兴趣的对象移动或需要移除时缓冲图像以“清除”背景。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-14T16:50:10.753

您正在做的是我在 WinForms 中使用过的唯一解决方案（一个不断重绘的计时器）。您可以使用许多技术来使用户体验更流畅（例如双缓冲）。

您可能想尝试一下 WPF。在 WPF 中有用于制作动画的内置工具，它们比基于计时器的解决方案更流畅（并且需要更少的代码并且不需要同步）。

请注意，对于该解决方案，您不需要在整个应用程序中使用 WPF；可以将此功能打包到 WPF 控件中，并将控件嵌入 WinForms 应用程序（或非托管应用程序，就此而言）：

[http://www.codeproject.com/KB/WPF/WPF_UserControls.aspx](http://www.codeproject.com/KB/WPF/WPF_UserControls.aspx)

# c - 在 C 函数指针中传递更多参数

> ID：11330
> 
> 赞同：9
> 
> 时间：2008-08-14T16:51:07.180
> 
> 标签：c, architecture, pointers

假设我正在创建一个国际象棋程序。我有一个功能

```
void foreachMove( void (*action)(chess_move*), chess_game* game); 
```

这将在每次有效移动时调用函数指针操作。这一切都很好，但是如果我需要向动作函数传递更多参数怎么办？例如：

```
chess_move getNextMove(chess_game* game, int depth){
  //for each valid move, determine how good the move is
  foreachMove(moveHandler, game);
}

void moveHandler(chess_move* move){
  //uh oh, now I need the variables "game" and "depth" from the above function
} 
```

重新定义函数指针并不是最优解。foreachMove 函数用途广泛，代码中的许多不同位置都引用了它。这些引用中的每一个都必须更新它们的函数以包含它们不需要的参数是没有意义的。

如何将额外的参数传递给我通过指针调用的函数？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-14T17:19:28.183

啊，要是只有 C 支持闭包就好了……

安东尼奥是对的；如果您需要传递额外的参数，则需要重新定义函数指针以接受额外的参数。如果您不确切知道需要哪些参数，那么您至少有三个选择：

1.  让原型中的最后一个参数为 void*。这使您可以灵活地传递您需要的任何其他内容，但它绝对不是类型安全的。
2.  使用可变参数 (...)。鉴于我缺乏 C 中可变参数的经验，我不确定您是否可以将其与函数指针一起使用，但这比第一个解决方案提供了更大的灵活性，尽管仍然缺乏类型安全性。
3.  升级到 C++ 并使用[函数对象](http://en.wikipedia.org/wiki/Function_object)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-14T16:58:47.600

您可能需要重新定义函数指针以获取其他参数。

```
void foreachMove( void (*action)(chess_move*, int), chess_game* game ) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-14T17:32:18.967

如果您愿意使用一些 C++，您可以使用“函数对象”：

```
struct MoveHandler {
    chess_game *game;
    int depth;

    MoveHandler(chess_game *g, int d): game(g), depth(d) {}

    void operator () (chess_move*) {
         // now you can use the game and the depth
    }
}; 
```

并将您的`foreachMove`变成模板：

```
template <typename T>
void foreachMove(T action, chess_game* game); 
```

你可以这样称呼它：

```
chess_move getNextMove(chess_game* game, int depth){
    //for each valid move, determine how good the move is
    foreachMove(MoveHandler(game, depth), game);
} 
```

但它不会破坏您对`MoveHandler`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-14T17:24:57.423

如果我没看错，我建议让你的函数将指向结构的指针作为参数。然后，您的结构可以在需要它们时具有“游戏”和“深度”，并在不需要它们时将它们设置为 0 或 Null。

该功能发生了什么？你有一个条件说，

```
if (depth > -1) //some default
  {
  //do something
  } 
```

该功能是否总是需要“游戏”和“深度”？然后，它们应该始终是参数，并且可以进入您的原型。

您是否表示该功能仅有时需要“游戏”和“深度”？好吧，也许可以制作两个功能，并在需要时使用每个功能。

但是，将结构作为论据可能是最简单的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-14T18:15:26.447

我建议使用一个 void* 数组，最后一个条目总是无效的。说你需要 3 个参数，你可以这样做：

```
void MoveHandler (void** DataArray)
{
    // data1 is always chess_move
    chess_move data1 = DataArray[0]? (*(chess_move*)DataArray[0]) : NULL; 
    // data2 is always float
    float data1 = DataArray[1]? (*(float*)DataArray[1]) : NULL; 
    // data3 is always char
    char data1 = DataArray[2]? (*(char*)DataArray[2]) : NULL; 
    //etc
}

void foreachMove( void (*action)(void**), chess_game* game); 
```

接着

```
chess_move getNextMove(chess_game* game, int depth){
    //for each valid move, determine how good the move is
    void* data[4];
    data[0] = &chess_move;
    float f1;
    char c1;
    data[1] = &f1;
    data[2] = &c1;
    data[3] = NULL;
    foreachMove(moveHandler, game);
} 
```

如果所有参数都是相同的类型，那么您可以避免使用 void* 数组，而只需发送您需要的任何类型的以 NULL 结尾的数组。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-14T18:39:46.617

+1 给安东尼奥。您需要更改函数指针声明以接受其他参数。

另外，请不要开始传递 void 指针或（尤其是）void 指针数组。那只是自找麻烦。如果您开始传递 void 指针，您还必须传递某种消息来指示指针类型是什么（或类型是什么）。这种技术*很少*适用。

如果您的参数始终相同，只需将它们添加到您的函数指针参数中（或者可能将它们打包到一个结构中并在有很多参数时将其用作参数）。如果您的参数发生变化，请考虑对多个调用场景使用多个函数指针，而不是传递 void 指针。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-14T20:22:54.740

如果您的参数发生变化，我会更改函数指针声明以使用“...”技术来设置可变数量的参数。它可以节省您的可读性，并且还必须对要传递给函数的每个参数进行更改。它肯定比传递 void 安全得多。

[http://publications.gbdirect.co.uk/c_book/chapter9/stdarg.html](http://publications.gbdirect.co.uk/c_book/chapter9/stdarg.html)

仅供参考，关于链接中的示例代码：有些地方有“n args”，有些地方是“n_args”，带有下划线。他们都应该有下划线。我认为语法看起来有点滑稽，直到我意识到他们在某些地方删除了下划线。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T14:57:42.703

Use a typedef for the function pointer. See my [answer](https://stackoverflow.com/questions/9410/how-do-you-pass-a-function-as-a-parameter-in-c#9421) for [this question](https://stackoverflow.com/questions/9410/how-do-you-pass-a-function-as-a-parameter-in-c)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-08T05:08:22.313

另一种选择是修改`chess_move`结构而不是函数原型。该结构大概只在一个地方定义过。将成员添加到结构中，并在使用它的任何调用之前用适当的数据填充结构。

# java - 让 Java 和 TWAIN 很好地协同工作

> ID：11338
> 
> 赞同：12
> 
> 时间：2008-08-14T17:04:25.310
> 
> 标签：java, java-native-interface, twain, image-scanner

我正在构建一个应用程序以直接从 TWAIN 扫描仪扫描到 Java 小程序。我已经知道[Morena](http://www.gnome.sk/Twain/jtp.html)和[JTwain 了](http://asprise.com/product/jtwain/)，但它们要花钱。我需要免费的。我可以使用 JNI 重新发明轮子，但似乎有人可能已经将其作为 FOSS 工具完成了。

有没有人熟悉可以让 Java 小程序直接从 TWAIN 扫描仪读取的**免费工具？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-10T22:28:10.557

从除 C/C++ 之外的任何东西调用 TWAIN API 将是一个很大的痛苦，它完全依赖于您必须在内存中精确复制的复杂 C 结构。如果您只需要相当基本的扫描，您可以使用[GitHub 站点](https://github.com/twall/jna/)之类的东西来调用我旧的免费“EZTwain Classic”DLL（google for eztw32.dll）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-18T13:50:13.197

嗯。我可能在可以检查的地方有一些可用的自制软件，但现在：在我们公司，我们基本上放弃了这个问题并实施了一个（不幸的是只赢了）ActiveX 解决方案：[Site Link](http://www.chestysoft.com/ximage/default.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-02-28T14:26:03.717

我实际上已经购买了chestysoft activeX 控件。已经使用它大约3年了。效果很好，但与所有 ActiveX 一样，您只能使用 IE。而这个只有 32 位。我现在正在研究一种快速方法。既然闪光灯可以从相机捕捉，为什么不能从扫描仪捕捉。如果我记得，我会报告我的发现。

# java - 从 WebObjects 中的多页表单创建 PDF

> ID：11341
> 
> 赞同：2
> 
> 时间：2008-08-14T17:06:46.493
> 
> 标签：java, pdf, webobjects

我想基于多页表单从[WebObjects自动生成 PDF 文档。](https://en.wikipedia.org/wiki/WebObjects)假设我有一个可以组装相关表单（java/wod 文件）的类，是否有一种好方法可以将单个表单解析为 PDF 而不是进入屏幕？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-17T00:40:16.287

当被问及来自 WebObjects 的 PDF 时，典型的回答通常是[ReportMill](http://www.reportmill.com/)。它是一个 PDF 文档生成框架，其工作方式与 WebObjects 非常相似，并且包括其自己的图形 PDF 构建器工具，类似于 WebObjects Builder 和 Interface Builder。您可以将生成的 PDF 中的元素绑定到应用程序中的动态数据，就像对`WOComponent`.

他们在[ReportMill 产品页面](http://reportmill.com/product/)上有几个教程视频，可以让您了解该工具的工作原理。这可能比尝试以编程方式使用 FOP 容易得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-14T17:37:17.040

我不熟悉 WebObjects，但我看到你在那里列出了 java。 [iText](http://www.lowagie.com/iText/)是一个用于构建 pdf 的 java api。如果您可以从 WebObjects 访问 java api，您应该能够以这种方式构建 pdf。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-19T16:09:42.653

Project Wonder 中的 ERPDFWrapper 组件：[站点链接](http://webobjects.mdimension.com/hudson/job/Wonder/javadoc/er/pdf/ERPDFWrapper.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-17T00:07:04.887

射手2>>

我研究了动态创建 PDF 的不同途径，包括 FOP 和一些 Java 库。我想我真正要问的是是否有人已经在 WebObjects 框架中做到了这一点。我希望熟悉 WebObjects 的人可能已经这样做了，并且有一些见解可以节省我一些时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-17T17:40:54.673

您可以使用 ReportMill 或 Jasper 报告。与 ReportMill 相比，Jasper Reports 是免费的，但需要学习庞大的库。您可以使用 IReport 或 Jasper Assistant eclipse 插件（如果您使用 WOLips）来构建报告模板。我的体验都很好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-09-14T02:10:05.083

Jasper Reports 支持已在一周前添加到 Project Wonder 中：

[网站链接视频](http://www.wocommunity.org/podcasts/wowodc/2010/IntegratingJasperReports.mov)

在 WOWODC 2010 上进行了有关该新框架的讨论，并将其记录下来。检查 wocommunity.org 和 10 月份的邮件列表。

# c# - XPATHS 和默认命名空间

> ID：11345
> 
> 赞同：16
> 
> 时间：2008-08-14T17:09:43.867
> 
> 标签：c#, xml, xpath, namespaces

XPath 背后的故事和对命名空间的支持是什么？XPath 作为规范是否先于命名空间？如果我有一个文档，其中元素被赋予了默认命名空间：

```
<foo xmlns="uri" /> 
```

似乎某些 XPath 处理器库`//foo`由于命名空间而无法识别，而其他处理器库则可以。我的团队考虑的选项是使用正则表达式向 XPath 添加名称空间前缀（您可以通过 XmlNameTable 添加名称空间前缀），但这似乎很脆弱，因为 XPath 在节点测试方面是如此灵活的语言。

有适用于此的标准吗？

我的方法有点老套，但似乎效果很好；我使用搜索/替换删除`xmlns`声明，然后应用 XPath。

```
string readyForXpath = Regex.Replace(xmldocument, "xmlns=\".+\"", String.Empty ); 
```

这是一种公平的方法还是有人以不同的方式解决了这个问题？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-08-14T17:15:17.927

您需要本地名称（）：

[http://www.w3.org/TR/xpath#function-local-name](http://www.w3.org/TR/xpath#function-local-name)

从[http://web.archive.org/web/20100810142303/http://jcooney.net:80/archive/2005/08/09/6517.aspx](http://web.archive.org/web/20100810142303/http://jcooney.net:80/archive/2005/08/09/6517.aspx)到婴儿床：

```
<foo xmlns='urn:foo'>
  <bar>
    <asdf/>
  </bar>            
</foo> 
```

此表达式将匹配“bar”元素：

```
 //*[local-name()='bar'] 
```

这个不会：

```
 //bar 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-29T15:09:35.493

我尝试了类似于白马提议的方法，但无法使其正常工作。由于我从已发布的服务中获取数据，因此无法更改 xml。我最终像这样使用 XmlDocument 和 XmlNamespaceManager ：

```
XmlDocument doc = new XmlDocument();
doc.LoadXml(xmlWithBogusNamespace);            
XmlNamespaceManager nSpace = new XmlNamespaceManager(doc.NameTable);
nSpace.AddNamespace("myNs", "http://theirUri");

XmlNodeList nodes = doc.SelectNodes("//myNs:NodesIWant",nSpace);
//etc 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-19T14:38:33.190

问题是没有命名空间的元素被声明为在 NULL 命名空间中 - 因此，如果 //foo 与您认为是“默认”的命名空间匹配，则无法引用 null 命名空间中的元素。

还要记住，命名空间的前缀只是一个简写约定，真正的元素名称（Qualified Name，简称 QName）由完整的命名空间和本地名称组成。更改命名空间的前缀不会改变元素的“身份”——如果它位于相同的命名空间和相同的本地名称中，那么即使前缀不同，它也是同一种元素。

XPath 2.0（或者更确切地说是 XSLT 2.0）具有“默认 xpath 命名空间”的概念。您可以在 xsl:stylesheet 元素上设置 xpath-default-namespace 属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-14T17:22:27.943

如果您尝试使用 xslt，您可以将命名空间添加到样式表声明中。如果这样做，则必须确保有前缀，否则它将不起作用。如果源 XML 没有前缀，那仍然可以，您可以在样式表中添加自己的前缀。

*样式表*

```
<xsl:stylesheet
    xmlns:fb="uri"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">

    <xsl:template match="fb:foo/bar">
        <!--  do stuff here -->
    </xsl:template>
</xsl:stylsheet> 
```

或类似的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-03-01T07:07:42.003

使用 libxml 似乎这有效：

[http://xmlsoft.org/examples/xpath1.c](http://xmlsoft.org/examples/xpath1.c)

```
 int 
register_namespaces(xmlXPathContextPtr xpathCtx, const xmlChar* nsList) {
    xmlChar* nsListDup;
    xmlChar* prefix;
    xmlChar* href;
    xmlChar* next;

    assert(xpathCtx);
    assert(nsList);

    nsListDup = xmlStrdup(nsList);
    if(nsListDup == NULL) {
    fprintf(stderr, "Error: unable to strdup namespaces list\n");
    return(-1); 
    }

    next = nsListDup; 
    while(next != NULL) {
    /* skip spaces */
    while((*next) == ' ') next++;
    if((*next) == '\0') break;

    /* find prefix */
    prefix = next;
    next = (xmlChar*)xmlStrchr(next, '=');
    if(next == NULL) {
        fprintf(stderr,"Error: invalid namespaces list format\n");
        xmlFree(nsListDup);
        return(-1); 
    }
    *(next++) = '\0';   

    /* find href */
    href = next;
    next = (xmlChar*)xmlStrchr(next, ' ');
    if(next != NULL) {
        *(next++) = '\0';   
    }

    /* do register namespace */
    if(xmlXPathRegisterNs(xpathCtx, prefix, href) != 0) {
        fprintf(stderr,"Error: unable to register NS with prefix=\"%s\" and href=\"%s\"\n", prefix, href);
        xmlFree(nsListDup);
        return(-1); 
    }
    }

    xmlFree(nsListDup);
    return(0);
} 
```

# windows - 有什么好的Windows服务器性能监控软件？

> ID：11359
> 
> 赞同：8
> 
> 时间：2008-08-14T17:17:30.013
> 
> 标签：windows, performance, sysadmin

我正在寻找一些软件来监视单个服务器的性能警报。最好是免费的并具有合理的默认配置。

编辑：为了澄清，我想在 Windows 机器上运行这个软件并监控远程 Windows 服务器的 CPU/内存/等。使用警报（不是单个应用程序）。

编辑：我想这个软件没有必要远程运行，如果有警报，我也会满足于在服务器上运行的东西并通过电子邮件发送给我。似乎 Windows 性能日志和警报可能会以某种方式用于此目的，但对我来说并不是很明显。

编辑：在编码恐怖博客上找到了一个简洁的工具，对远程监控没有那么有用，但对于您作为服务器管理员担心的事情非常有用：http: [//www.winsupersite.com/showcase/winvista_ff_rmon.asp](http://www.winsupersite.com/showcase/winvista_ff_rmon.asp)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-20T07:29:28.310

我一直在尝试使用 munin 来监视大约 8 个 Windows 2003 服务器。

[http://munin.projects.linpro.no/](http://munin.projects.linpro.no/)

它是一个免费的基于 linux 的系统，Windows 代理运行良好且易于扩展。如果您对 Linux 有一些了解，那么设置很简单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T13:33:17.007

对于性能监视器 - 在服务器上启动它（`Win`+`R`并输入“perfmon”）。选择“性能日志和警报”并展开。选择“警报”。选择“操作”，然后选择“新警报”。给警报命名，单击“添加”添加一个计数器（有数百个计数器，例如 CPU %），然后给它一些限制。

选择“操作”选项卡，然后决定您要做什么。您可能需要第三方程序 - 例如 Blat 来发送电子邮件 - 但基本上任何脚本都可以运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-14T17:40:31.713

如果你想要免费的东西，试试 Nagios。

[http://www.nagios.org/](http://www.nagios.org/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-01T00:00:50.363

您可以配置 perfmon 以收集硬盘驱动器上“跟踪日志”文件的特定计数器。我们通常会保留重要计数器的每日日志：

*   生命体征（CPU、内存、硬盘空间）
*   特定于应用程序（ASP.Net 计数器/SQL 计数器）
*   如果您的应用程序暴露了这样的自定义计数器

您可以为特定计数器/计数器组添加“警报”，并在这些警报触发时定义操作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-02T11:48:34.663

来自[High Scalability 博客的](http://highscalability.com/)[监控工具](http://highscalability.com/blog/category/monitoring)列表

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-14T17:58:45.203

MS 的解决方案曾经被称为 MOM。自从我上次使用它以来，它看起来已经[重新设计了一点。](http://www.microsoft.com/systemcenter/operationsmanager/en/us/default.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-23T02:59:18.980

我自己有点喜欢 Perfmon。它带有开箱即用的窗口，并支持许多不同的测量。

# algorithm - 制作人类可读的整数表示

> ID：11381
> 
> 赞同：5
> 
> 时间：2008-08-14T17:25:29.747
> 
> 标签：algorithm, numbers

对于那些喜欢这种事情的人来说，这是一个编码问题。让我们看看你对一个函数的实现（当然是用你选择的语言），它返回一个指定整数的人类可读的字符串表示。例如：

*   humanReadable(1) 返回“一”。
*   humanReadable(53) 返回“五十三”。
*   humanReadable(723603) 返回“七十二万三千六百零三”。
*   humanReadable(1456376562) 返回“十亿、四亿五千六百万、三十七万六千、五百六十二”。

特别聪明/优雅的解决方案的奖励积分！

这似乎是一个毫无意义的练习，但这种算法在现实世界中有很多应用程序（尽管支持高达 10 亿的数字可能有点矫枉过正:-)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-08-14T17:49:35.190

已经有一个关于这个的问题： [将整数转换为书面数字](https://stackoverflow.com/questions/3213/c-convert-integers-into-written-numbers)

答案是针对 C#，但我认为您可以弄清楚。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-14T17:58:24.627

```
import math

def encodeOnesDigit(num):
   return ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'][num]

def encodeTensDigit(num):
   return ['twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'][num-2]

def encodeTeens(num):
   if num < 10:
      return encodeOnesDigit(num)
   else:
      return ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'][num-10]

def encodeTriplet(num):
   if num == 0: return ''
   str = ''
   if num >= 100:
      str = encodeOnesDigit(num / 100) + ' hundred'
   tens = num % 100
   if tens >= 20:
      if str != '': str += ' '
      str += encodeTensDigit(tens / 10)
      if tens % 10 > 0:
         str += '-' + encodeOnesDigit(tens % 10)
   elif tens != 0:
      if str != '': str += ' '
      str += encodeTeens(tens)
   return str

def zipNumbers(numList):
   if len(numList) == 1:
      return numList[0]
   strList = ['', ' thousand', ' million', ' billion'] # Add more as needed
   strList = strList[:len(numList)]
   strList.reverse()
   joinedList = zip(numList, strList)
   joinedList = [item for item in joinedList if item[0] != '']
   return ', '.join(''.join(item) for item in joinedList)

def humanReadable(num):
   if num == 0: return 'zero'
   negative = False
   if num < 0:
      num *= -1
      negative = True
   numString = str(num)
   tripletCount = int(math.ceil(len(numString) / 3.0))
   numString = numString.zfill(tripletCount * 3)
   tripletList = [int(numString[i*3:i*3+3]) for i in range(tripletCount)]
   readableList = [encodeTriplet(num) for num in tripletList]
   readableStr = zipNumbers(readableList)
   return 'negative ' + readableStr if negative else readableStr 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-14T17:51:24.407

最多支持9.99亿，但没有负数：

```
String humanReadable(int inputNumber) {
  if (inputNumber == -1) {
    return "";
  }
  int remainder;
  int quotient;
  quotient = inputNumber / 1000000;
  remainder = inputNumber % 1000000;
  if (quotient > 0) {
    return humanReadable(quotient) + " million, " + humanReadable(remainder);
  }
  quotient = inputNumber / 1000;
  remainder = inputNumber % 1000;
  if (quotient > 0) {
    return humanReadable(quotient) + " thousand, " + humanReadable(remainder);
  }
  quotient = inputNumber / 100;
  remainder = inputNumber % 100;
  if (quotient > 0) {
    return humanReadable(quotient) + " hundred, " + humanReadable(remainder);
  }
  quotient = inputNumber / 10;
  remainder = inputNumber % 10;
  if (remainder == 0) {
    //hackish way to flag the algorithm to not output something like "twenty zero"
    remainder = -1;
  }
  if (quotient == 1) {
    switch(inputNumber) {
    case 10:
      return "ten";
    case 11:
      return "eleven";
    case 12:
      return "twelve";
    case 13:
      return "thirteen";
    case 14:
      return "fourteen";
    case 15:
      return "fifteen";
    case 16:
      return "sixteen";
    case 17:
      return "seventeen";
    case 18:
      return "eighteen";
    case 19:
      return "nineteen";
    }
  }
  switch(quotient) {
  case 2:
    return "twenty " + humanReadable(remainder);
  case 3:
    return "thirty " + humanReadable(remainder);
  case 4:
    return "forty " + humanReadable(remainder);
  case 5:
    return "fifty " + humanReadable(remainder);
  case 6:
    return "sixty " + humanReadable(remainder);
  case 7:
    return "seventy " + humanReadable(remainder);
  case 8:
    return "eighty " + humanReadable(remainder);
  case 9:
    return "ninety " + humanReadable(remainder);
  }
  switch(inputNumber) {
  case 0:
    return "zero";
  case 1:
    return "one";
  case 2:
    return "two";
  case 3:
    return "three";
  case 4:
    return "four";
  case 5:
    return "five";
  case 6:
    return "six";
  case 7:
    return "seven";
  case 8:
    return "eight";
  case 9:
    return "nine";
  }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-14T18:17:02.433

```
using System;

namespace HumanReadable
{
    public static class HumanReadableExt
    {
        private static readonly string[] _digits = {
                                                       "", "one", "two", "three", "four", "five",
                                                       "six", "seven", "eight", "nine", "eleven", "twelve",
                                                       "thirteen", "fourteen", "fifteen", "sixteen", "seventeen",
                                                       "eighteen", "nineteen"
                                                   };

        private static readonly string[] _teens = {
                                                      "", "", "twenty", "thirty", "forty", "fifty",
                                                      "sixty", "seventy", "eighty", "ninety"
                                                  };

        private static readonly string[] _illions = {
                                                        "", "thousand", "million", "billion", "trillion"
                                                    };

        private static string Seg(int number)
        {
            var work = string.Empty;

            if (number >= 100) 
                work += _digits[number / 100] + " hundred ";

            if ((number % 100) < 20)
                work += _digits[number % 100];
            else
                work += _teens[(number % 100) / 10] + "-" + _digits[number % 10];

            return work;
        }

        public static string HumanReadable(this int number)
        {
            if (number == 0)
                return "zero";
            var work = string.Empty;

            var parts = new string[_illions.Length];

            for (var ind = 0; ind < parts.Length; ind++)
                parts[ind] = Seg((int) (number % Math.Pow(1000, ind + 1) / Math.Pow(1000, ind)));

            for (var ind = 0; ind < parts.Length; ind++)
                if (!string.IsNullOrEmpty(parts[ind]))
                    work = parts[ind] + " " + _illions[ind] + ", " + work;

            work = work.TrimEnd(',', ' ');

            var lastSpace = work.LastIndexOf(' ');
            if (lastSpace >= 0)
                work = work.Substring(0, lastSpace) + " and" + work.Substring(lastSpace);

            return work;
        }
    }

    class Program
    {

        static void Main(string[] args)
        {
            Console.WriteLine(1.HumanReadable());
            Console.WriteLine(53.HumanReadable());
            Console.WriteLine(723603.HumanReadable());
            Console.WriteLine(1456376562.HumanReadable());
            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T13:18:47.590

这个函数的实现存在一个大问题。这是它未来的本地化。该功能由英语为母语的人编写，很可能不适用于英语以外的任何其他语言。几乎不可能为世界上的任何人类语言方言编写通用的易于本地化的函数，除非你真的需要保持它的通用性。实际上，在现实世界中，您不需要使用巨大的整数进行操作，因此您可以将所有数字保存在一个大（甚至不是那么大）的字符串数组中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-18T01:30:01.370

同意有许多现实世界的应用程序。因此，已经有许多现实世界的实现。

它几乎永远是 bsdgames 的一部分......

```
> man number 
```

# c++ - GCC 问题：使用依赖于模板参数的基类成员

> ID：11405
> 
> 赞同：37
> 
> 时间：2008-08-14T17:39:46.520
> 
> 标签：c++, templates, base-class, class-members, name-lookup

以下代码不能用 gcc 编译，但可以用 Visual Studio 编译：

```
template <typename T> class A {
public:
    T foo;
};

template <typename T> class B: public A <T> {
public:
    void bar() { cout << foo << endl; }
}; 
```

我得到错误：

> test.cpp：在成员函数'void B::bar()'中：
> 
> test.cpp:11：错误：“foo”未在此范围内声明

但它应该是！如果我`bar`改为

```
void bar() { cout << this->foo << endl; } 
```

然后它*会*编译，但我认为我不必这样做。GCC 在此处遵循的 C++ 官方规范中有什么内容，还是只是一个怪癖？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-08-14T18:09:55.413

大卫乔伊纳有历史，这就是原因。

编译时的问题`B<T>`是它的基类`A<T>`对于编译器是未知的，是一个模板类，所以编译器无法知道基类中的任何成员。

早期版本通过实际解析基本模板类进行了一些推断，但 ISO C++ 声明这种推断可能会导致不应该发生的冲突。

在模板中引用基类成员的解决方案是使用`this`（像您一样）或专门命名基类：

```
template <typename T> class A {
public:
    T foo;
};

template <typename T> class B: public A <T> {
public:
    void bar() { cout << A<T>::foo << endl; }
}; 
```

[gcc 手册](http://gcc.gnu.org/onlinedocs/gcc-3.4.6/gcc/Name-lookup.html)中的更多信息。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-08-14T18:05:09.510

哇。C++ 的怪异总是让我感到惊讶。

> 在模板定义中，非限定名称将不再找到依赖基的成员（如 C++ 标准中的 [temp.dep]/3 所指定）。例如，

```
template <typename T> struct B {
  int m;
  int n;
  int f ();
  int g ();
};
int n;
int g ();
template <typename T> struct C : B<T> {
  void h ()
  {
    m = 0; // error
    f ();  // error
    n = 0; // ::n is modified
    g ();  // ::g is called
  }
}; 
```

> 您必须使名称依赖，例如通过在它们前面加上 this->。这是 C::h 的更正定义，

```
template <typename T> void C<T>::h ()
{
  this->m = 0;
  this->f ();
  this->n = 0
  this->g ();
} 
```

> 作为替代解决方案（不幸的是不向后兼容 GCC 3.3），您可以使用 using 声明而不是 this->：

```
template <typename T> struct C : B<T> {
  using B<T>::m;
  using B<T>::f;
  using B<T>::n;
  using B<T>::g;
  void h ()
  {
    m = 0;
    f ();
    n = 0;
    g ();
  }
}; 
```

这简直是​​各种疯狂。谢谢，大卫。

这是他们所指的标准 [ISO/IEC 14882:2003] 的“temp.dep/3”部分：

> 在类模板或类模板成员的定义中，如果类模板的基类依赖于模板参数，则在类定义点的非限定名称查找期间不会检查基类范围模板或成员，或在类模板或成员的实例化期间。[例子：

```
typedef double A; 
template<class T> class B { 
    typedef int A; 
}; 
template<class T> struct X : B<T> { 
    A a; // a has typedouble 
}; 
```

> `A`定义中的类型名称`X<T>`绑定到全局命名空间范围中定义的 typedef 名称，而不是基类中定义的 typedef 名称`B<T>`。] [例子：

```
struct A { 
    struct B { /* ... */ }; 
    int a; 
    int Y; 
}; 
int a; 
template<class T> struct Y : T { 
    struct B { /* ... */ }; 
    B b; //The B defined in Y 
    void f(int i) { a = i; } // ::a 
    Y* p; // Y<T> 
}; 
Y<A> ya; 
```

> 模板参数的成员`A::B`、`A::a`和不影响 中名称的绑定。]`A::Y``A``Y<A>`

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-08-14T17:50:24.750

这在[gcc-3.4](http://gcc.gnu.org/gcc-3.4/changes.html#cplusplus)中发生了变化。C++ 解析器在那个版本中变得更加严格——按照规范，但对于拥有遗留或多平台代码库的人来说仍然有点烦人。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-08-14T21:06:41.360

C++ 在这里不能假设任何东西的主要原因是基本模板可以在以后专门用于一种类型。继续原来的例子：

```
template<>
class A<int> {};

B<int> x; 
x.bar();//this will fail because there is no member foo in A<int> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-17T13:21:45.927

VC 没有实现两阶段查找，而 GCC 有。因此 GCC 在实例化模板之前对其进行解析，从而发现比 VC 更多的错误。在您的示例中， foo 是一个从属名称，因为它取决于“T”。除非你告诉编译器它来自哪里，否则在你实例化它之前它根本无法检查模板的有效性。这就是为什么你必须告诉编译器它来自哪里。

# c# - 如何在 MFC 应用程序中托管 WPF 表单

> ID：11423
> 
> 赞同：13
> 
> 时间：2008-08-14T18:04:45.237
> 
> 标签：c#, wpf, mfc

我正在寻找有关在现有 MFC 应用程序中托管 WPF 表单的任何资源。谁能指出我如何做到这一点的正确方向？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-14T18:06:36.700

据我了解（我自己没有尝试过），这几乎就像让 WPF 控制父句柄一样简单。这是一个[演练：在 Win32 中托管 WPF 内容](https://docs.microsoft.com/en-us/dotnet/framework/wpf/advanced/walkthrough-hosting-wpf-content-in-win32)。

# sql-server - SQL Server 2008 附带的 .Net 框架版本是什么？

> ID：11430
> 
> 赞同：6
> 
> 时间：2008-08-14T18:08:00.567
> 
> 标签：sql-server, sql-server-2008

SQL Server 2008 是否附带 .NET 3.5 CLR，以便用 CLR 编写的存储过程可以使用 3.5 功能？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-14T18:09:59.627

实际上它随 .NET 3.5 SP1 一起提供。所以是的，存储过程可以使用 3.5 特性和库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-18T19:45:09.547

我发誓这不是迂腐，而是一个重要的区别——当你说“.NET 3.5 CLR”时，我不知道你具体需要什么——可能是 .NET 3.5 框架？可能是 C# 3.0 语言特性？但是 .NET 3.5 运行的 CLR[仍然是 CLR 2.0。](http://msdn.microsoft.com/en-us/netframework/aa663314.aspx) （链接指向相同的解释：.NET 3.0；我无法立即在 3.5 上找到此信息。实际上，关于 CLR 与框架与语言版本号的最佳解释是我尚未找到的第 12 页[*在 24 小时内自学 WPF*](https://rads.stackoverflow.com/amzn/click/com/0672329859) *)

所以，我的观点是，您甚至可以在 SQL 2005 CLR 存储过程上使用 .NET 3.5 和 C# 3.0 的特性——我们在我的公司这样做——而且它甚至没有任何技巧。您所要做的就是在您的服务器上安装免费的 3.5 框架。显然 SQL 2005 的答案与您的特定问题无关，但希望这对最终通过 Google 浏览此页面的人有所帮助。

*披露：我是作者的朋友

# .net - Visual Studio 设置项目自定义对话框

> ID：11439
> 
> 赞同：6
> 
> 时间：2008-08-14T18:11:31.400
> 
> 标签：.net, visual-studio, windows-installer, installation, projects

[我使用此处](http://www.codeproject.com/KB/install/vsSetupCustomDialogs.aspx?fid=419622&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2640482&fr=26)描述的步骤为 Visual Studio 安装项目创建了一个自定义对话框

现在我的一个对话框中有一个组合框。我想用本地网络上运行的所有 SQL Server 实例的列表填充组合框。获取服务器列表很简单......但我完全不知道如何让它们显示在组合框中。我会很感激你的帮助，因为我是初学者，所以一些代码也可能很好:)。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-14T18:17:36.613

我一直发现 Visual Studio 设置项目中的自定义对话框非常有限，几乎没有功能。

相比之下，我通常会创建自定义操作，以在设置期间为任何远程困难任务显示 winforms gui。效果非常好，您可以通过创建自定义操作并传递一些参数来做任何您想做的事情。

在日常工作中，我们为应用程序配置和数据库创建/脚本执行等任务构建了一组常见的自定义操作，以绕过自定义对话框的限制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T08:10:12.423

我想您将不得不超越开箱即用的设置和部署包并尝试第三方应用程序。

你可能想看看：

*   [蜡](http://wix.sourceforge.net/)
*   [Nullsoft 脚本安装系统](http://nsis.sourceforge.net/Main_Page)

两者都是免费的；他们可能会为您提供所需的定制。

# .net - ASP.NET 代理应用程序

> ID：11460
> 
> 赞同：3
> 
> 时间：2008-08-14T18:28:42.990
> 
> 标签：.net, asp.net, iis

让我试着解释一下我需要什么。我有一个可以从互联网上看到的服务器。我需要创建一个 ASP.NET 应用程序来获取网站的请求并发送到内部服务器，然后它获取响应并发布信息。对于客户来说，这应该是完全透明的。

由于不同的原因，我无法将端口重定向到内部服务器。我能做但不知道如何做——也许答案就在那里——是创建一个新的网站，将其托管在另一台服务器上。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-14T18:38:24.513

为什么任何旧的代理软件都不能为此工作？为什么它需要是 ASP.NET 应用程序？有大量的工具（Windows 和 *nix）可以很容易地完成工作。检查[Squid](http://www.squid-cache.org/)或[NetProxy](https://web.archive.org/web/20090601113940/http://www.grok.co.uk:80/netproxy/)的初学者。

如果您需要与 IIS 集成，[IISProxy](http://www.iisproxy.net/)看起来也可以解决问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-14T19:12:55.987

我使用 apache mod_proxy 和 mod_proxy_balancer。运行 5 个域的 4 个 web 框的集群非常棒。

# sharepoint - 共享点维基

> ID：11462
> 
> 赞同：22
> 
> 时间：2008-08-14T18:30:01.160
> 
> 标签：sharepoint, automation, sharepoint-wiki

好的，我看到一些帖子*提到*了其他一些关于不使用 SP wiki 因为它们很烂的帖子。

既然我们正在考虑在*SP*中做我们的 wiki ，我需要知道为什么我们不应该为 6 名自动化开发人员组来记录各种自动化流程中的步骤以及必须不时进行的更改.

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-08-14T19:42:02.840

以下是我遇到的一些警告，如果您使用 Sharepoint 以外的 wiki，这些警告将会消失。

Sharepoint 可让您创建大量独立的 wiki，但我建议您为所有内容创建一个大型 wiki。我的公司为每个项目/功能制作了一堆小 wiki，但只有管理员可以创建单独的 wiki，所以如果我想写一些与预定义类别不匹配的东西，我必须找到一个经理首先创建 wiki。

其次，如果您使用 Sharepoint，请确保您的员工中的每个人都只使用 IE，因为 Firefox 不支持 WYSIWIG 编辑器。这对大多数 wiki 来说是件*好事*，但在 Sharepoint 中很难进行协作。想象一下整天在一个小盒子里编辑自动生成的 HTML。

第三，尝试在 wiki 中编写您的项目文档，并抵制将 Word 文档上传到 Sharepoint 库的诱惑。将所有文档写两次并看着事情越来越不同步是没有意义的。

最后，Sharepoint wiki 中的图像支持很糟糕。您必须在某处将文件添加到文档库并输入 URL。我的图像永远被删除，因为它们似乎没有多大意义脱离上下文。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-02T20:16:35.213

我对微软的 Sharepoint Wiki 有更积极的看法。在很多方面它让我想起了 FrontPage 98——那是一个受到不公平诽谤的产品。

关于使用列表的评论是错误的。Sharepoint Wiki 是 Sharepoint 列表，其中每个页面都是带有 HTML 附件的列表项。

确实不能链接到页面，但如果页面很短，我不认为这是一个问题。SP Wiki 使拥有短页面变得非常容易。

如果您愿意，您可以从 access 2008 操作 Wiki 属性，并且您可以根据需要将属性添加到 wiki 列表项。例如——你想要分类吗？只需通过编辑列表来添加它们。想要具体观点？列表项。也创建它们。

微软在 Sharepoint 列表上构建 Wiki 框架的方式确实是天才——不可否认，这做得很好。

Famerchris 提到了 Sharepoint Wiki 的真正缺点。图像管理的方法非常糟糕。这是一个非常严重的问题，您应该仅出于这个原因考虑其他 Wiki。

我使用了一个复杂的解决方法。它利用了与 Windows Live Writer 集成的出色的 Sharepoint 支持和图像编辑。

1.  创建一个 SP 博客，其中包含将在 wiki 中引用的图像。
2.  使用 Windows Live Writer 发布到 wiki-image-blog。将您的图像放入 WLW，根据需要调整其大小等。如果您愿意，也可以使用 WLW 编写与图像相关的 wiki 文本初稿。
3.  发布到 Wiki 后，将图像和文本复制并粘贴到 Wiki 编辑器富文本字段中。

这花费的时间非常少，远远少于我读过的任何其他选项。我承认，这很复杂。

除了图像问题，我对产品感到满意和印象深刻。如果微软在图像问题上更加努力……如果只是……

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-08-14T18:42:16.067

Sharepoint 附带的默认 wiki 根本不支持常见的 wiki 功能。无法编辑页面的单个部分，也无法直接链接到另一个页面上的特定部分。后端是 HTML，因此您无法使用简单的语法以纯文本形式进行编辑。差异功能不能跨越多个版本。所见即所得编辑的跨浏览器支持较差。无法自动插入目录...

但是，我无法断然拒绝 Sharepoint 的其他 wiki 插件，例如[Confluence](http://www.atlassian.com/software/confluence/)为 Sharepoint制作了[插件](http://www.atlassian.com/sharepoint/)。我自己还没有评估过这个软件，而且 Confluence 有点贵（25 个用户许可证需要 1,200 美元），尽管如果你已经在 Sharepoint 上，我会感觉到大公司的金库：P。似乎也有一些免费的加载项，如[CKS Enhanced Wiki](http://www.codeplex.com/CKS/Wiki/View.aspx?title=Enhanced%20Wiki%20Edition&referringTitle=Home)，但似乎有很多上面提到的相同问题。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-17T04:52:14.430

我们总是遇到这个话题，我问*人们*的第一个问题是“你为什么需要一个 wiki”？几乎总是答案是“易于编辑”、“多个贡献者”和“Word 是重量级的”。 *我们很少*看到有人询问我认为独特的类似 wiki 的功能（特殊的“神奇”标记、显示更改的细粒度版本历史记录等）。此外，他们通常希望对事物进行某种分类，而不仅仅是完全自由格式的页面。

在 SharePoint 世界中，如果您已经使用该工具一段时间，这些东西应该会向您发出“列表”的声音。基本上没有特别的理由为这些知识库风格的应用程序使用 wiki，特别是因为“易于编辑”通常与大多数用户学习特殊标记语言的想法直接冲突。通过其中的几个富文本列，您就完成了。如果您真的不喜欢内置的富文本编辑器（是的，图像上传过程很笨拙，并且在 Firefox 中不起作用），请让您的组织中的某个人放弃 8 Benjamins 并获取[RadEditor for SharePoint](http://www.telerik.com/products/sharepoint/radeditor.aspx) . 它应该几乎可以解决这些问题。

一般来说，一旦我们克服了“但它必须是一个 wiki”的教条，我们就已经有了很好的客户接待，只使用列表。在某些情况下，如果需要更多的页面模板工具，我们会转向使用 MOSS 的 WCM 功能，这需要对模板进行更多的前期思考，但也有更好的开箱即用体验，例如内容片段和图像处理。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-04-23T09:07:33.557

因为默认实现**不是**wiki，它是一个*HTML 编辑器*。

如果您使用过 wiki，您就会知道其中的区别。只需查看本页底部的“您的答案”即可了解不同之处。您在 wiki 中使用标记，这相对容易阅读和编辑。格式化的 HTML 完全掩盖了所写的内容。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2012-01-31T04:20:05.653

作为 wiki 内容创建者和超级用户，而不是管理员或开发人员，我的两分钱价值：

我目前正在在 Sharepoint Wiki 中编辑一个文档，因为我输入了这个，它是迄今为止我遇到过的最糟糕的编辑器。准确地说，我使用的是 Sharepoint Foundation 2010（以前称为 WSS），使用 IE 9 编辑页面。

总结一下我所面临的问题： 创建 wiki 内容时，您希望专注于内容，并且 wiki 引擎应该易于使用，几乎不可见。对于 Sharepoint，情况并非如此。我真的与伪所见即所得编辑器作斗争，不得不修复频繁的格式问题。

**我估计我使用 Sharepoint 编写 wiki 内容的效率比使用ScrewTurn 或 Wikimedia 低 15%，因为我必须处理格式问题。** 如果我花一天时间写 wiki 页面，我会浪费大约一个小时来尝试修复格式问题。

背景：我在我们公司创建了四个内部 wiki——第一个在 Wikimedia 中，Wikipedia 背后的 wiki 引擎，接下来的两个在螺丝转，最后一个在 Sharepoint。在每个 wiki 中，我写了大约 50-100 页。

在ScrewTurn 和Wikimedia 中，编辑器看起来相当原始——一个使用简单的wiki 标记代码进行格式化的纯文本编辑器。每个都有一排按钮，可以将标记代码应用于粗体和斜体格式等简单的事情，并创建链接，因此初学者不需要记住标记代码。虽然编辑器看起来很简单，但实际上使用起来非常简单，尤其是在修复格式问题时。

另一方面，Sharepoint Wiki 看起来很漂亮，但编辑起来很**糟糕**。与使用带有 wiki 标记的纯文本编辑器不同，它有一个 WYSIWYG 编辑器，看起来比其他 wiki 编辑器复杂得多。然而它有个性，一种邪恶的个性。它经常添加空行或更改文本颜色。当我选择要格式化的文本然后转到标记样式下拉菜单来格式化它时，有时从下拉列表中选择一个项目的行为会取消选择选定的文本，因此格式会应用于随机位置的文本。插入从 Word 复制的文本有时会导致编辑器在页面其他位置的段落之间的空白行上加倍或加倍。除了编写 HTML 之外，似乎没有简单的方法来创建表格。

然而，编辑器最大的问题是你不能轻易看到幕后发生的事情，因此很难修复它。是的，可以编辑页面的 HTML，但这确实违背了 wiki 的目的。

作为用户，我得到的总体印象是，这是由暑期实习生敲出的 alpha 级代码。我知道 Foundation 是免费版本，所以也许我得到了我们付出的代价，但我无法相信一家专业的软件公司推出了这个产品。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-08-14T19:31:49.163

对于将“不时”进行编辑的 6 人小组，内置 wiki 就可以了。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-08-14T20:53:07.457

Sharepoint Wiki 本质上是一个静态 HTML 页面列表，唯一的 Wiki 功能是 [[article]] 链接。没有模板，没有类别，什么都没有。

我们最终拥有了一个单独的 MediaWiki，并且只将 Sharepoint wiki 用于不需要太多布局的基于文本的内容。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-23T23:14:50.583

不要忘记[Sharepoint 增强版 Wiki 版](http://www.codeplex.com/CKS/Wiki/View.aspx?title=Enhanced%20Wiki%20Edition&referringTitle=Home)的社区工具包。这为开箱即用的版本添加了一些功能。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2010-12-21T15:13:23.837

在咆哮之前，这是我将 SharePoint 作为 wiki 的总体经验。

这是一个实施不佳的功能，但由于根本上缺乏对当前 wiki 环境提供的内容的调查而失败。这就是它在编辑器中失败的原因，以及它在以下方面遗漏的原因：标记、历史比较和生成不良的 html 代码。

您需要跳过它并获取其他可以更好地完成工作并从 SharePoint 链接到它的东西。

拥有这两种产品的**生产**经验，我会推荐ScrewTurn over SharePoint。

*查看 rant 的编辑历史*

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-08-14T18:48:32.073

我的公司最近推出了 sharepoint，我不得不说我的用户体验***非常糟糕***。而且我不只是说我对使用它感到担心：我以开放的心态进入并尝试了它，许多事情只是觉得它们并没有真正正常工作。

卢克提到的原因或多或少涵盖了它。

您为什么不考虑使用 Jeff 不久前捐赠给的诸如Screwturn [Wiki](http://www.codinghorror.com/blog/archives/001098.html)[之](http://www.screwturn.eu/Default.aspx?AspxAutoDetectCookieSupport=1)类的其他东西？我自己没有使用过Screwturn，但它是免费和开源的，并且可能是满足您需要的更快的轻量级解决方案。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-08-14T22:31:38.380

几个月前，我们查看了 Sharepoint 的部门 wiki。尽管我们主要是一家 MS 商店，但我们还是选择了[DokuWiki](http://www.dokuwiki.org/dokuwiki)。开源，很容易保持最新，很棒的插件和基于文件的后端。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-01-20T04:01:08.790

我还会根据此处作者的技术水平调整 OOB wiki 的评级及其缺乏功能的程度。

我同意 SP wiki 可能只是名义上的资格 - 当然与一些更强大的产品相比 - 但请记住，作为管理员 - 您的主要成功取决于最终用户的采用。简而言之 - 对于像 Confluence 这样的 wiki 添加的每个功能，它还添加了用户教育、语法等。

虽然我希望 SP wiki 有更多的“类似 wiki”——当你的 CIO 在公司 wiki 中添加条目时，你可以获得某种难以形容的满足——或者你被一群发现新的行政助理认可维基“革命”。

简而言之 - 内置功能可能对我们这些技术专业人士厌倦的眼睛来说是缺乏的，但对于技术天真的人来说，它很容易训练，并且可以让他们接触到他们可能听说过但从未听说过的技术（在此之前) 理解或想象使用。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-08-14T21:07:05.790

我已经简单地玩过[SharePoint Wiki Plus](http://www.kwizcom.com/ProductPage.asp?ProductID=524&ProductSubNodeID=525)。它是向 SharePoint Wiki 添加功能的第三方扩展。对于认真的 Wiki 用户，您可能需要的不仅仅是 SharePoint 提供的 Wiki - 通过扩展或专用 Wiki 产品。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-08-22T04:58:49.613

也许尝试[http://wordtosharepoint.codeplex.com/](http://wordtosharepoint.codeplex.com/)将您的 Word 内容迁移到 SharePoint？它负责链接图像和大多数其他事情。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2010-05-11T19:36:06.623

Screwturn 非常棒 - 它是 C# / .Net。

Sharepoint 2010 应该有更好的 wiki 功能，并且总是有 sharepoint 的社区工具包。如果您能够放弃 Sharepoint Wiki - 您可以随时前往[http://www.wikimatrix.org](http://www.wikimatrix.org)找到适合您的 wiki。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2011-01-18T00:43:09.073

我完全同意上述（Keng）。无论 SharePoint（当前使用 2010）中的内容是什么，它都不是 Wiki。

我正在实现一个自动化文档解决方案，我从源代码和 XML 配置文件中提取配置和其他信息（如 perldoc 标记）。它将信息插入到一组 DokuWIKI 页面中，并带有格式标记（包括表格）。它的格式完美，可以使用几十行 perl，包括手动编辑的静态文档页面的内部链接，以及对命名空间的支持，这样我就可以有逻辑地组织我的信息。我无法在 SharePoint 中做到这一点（叹气 - 公司方向）......

我能做的最好的事情是尝试使 DokuWIKI 模板类似于 SharePoint 网站（以保持外观和感觉相似）并链接到 SharePoint。:-(

# c++ - C ++中的字符串到下/上

> ID：11491
> 
> 赞同：26
> 
> 时间：2008-08-14T18:49:47.703
> 
> 标签：c++, string, unicode

人们发现在 C++ 中将字符串转换为小写/大写的最佳方法是什么？

由于 C++ 不是纯英语的编程语言，这个问题变得复杂了。有没有好的多语言方法？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-08-14T18:53:43.530

```
#include <algorithm>
std::string data = "Abc";
std::transform(data.begin(), data.end(), data.begin(), ::toupper); 
```

[http://notfaq.wordpress.com/2007/08/04/cc-convert-string-to-upperlower-case/](http://notfaq.wordpress.com/2007/08/04/cc-convert-string-to-upperlower-case/)

此外，常见字符串方法的 CodeProject 文章：http: [//www.codeproject.com/KB/stl/STL_string_util.aspx](http://www.codeproject.com/KB/stl/STL_string_util.aspx)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-08-21T23:05:23.650

```
> std::string data = “Abc”; 
> std::transform(data.begin(), data.end(), data.begin(), ::toupper); 
```

这将起作用，但这将使用标准的“C”语言环境。如果您需要为其他语言环境获取 tolower，则可以使用构面。上面使用构面的代码将是：

```
locale loc("");
const ctype<char>& ct = use_facet<ctype<char> >(loc);
transform(str.begin(), str.end(), std::bind1st(std::mem_fun(&ctype<char>::tolower), &ct)); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-11-12T19:02:13.187

对于希望使用 Nic Strong 答案的复制粘贴者，请注意“use_factet”中的拼写错误以及 std::transform 缺少的第三个参数：

```
locale loc("");
const ctype<char>& ct = use_factet<ctype<char> >(loc);
transform(str.begin(), str.end(), std::bind1st(std::mem_fun(&ctype<char>::tolower), &ct)); 
```

应该

```
locale loc("");
const ctype<char>& ct = use_facet<ctype<char> >(loc);
transform(str.begin(), str.end(), str.begin(), std::bind1st(std::mem_fun(&ctype<char>::tolower), &ct)); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-16T20:25:51.290

您还应该查看[这个问题](https://stackoverflow.com/questions/11635/case-insensitive-string-comparison-in-c)。基本上问题在于标准 C/C++ 库不是为处理 Unicode 数据而构建的，因此您必须查看其他库。

这可能会随着 C++ 标准的更新而改变。我知道 Borland 的下一个编译器 (CodeGear) 将支持 Unicode，我猜微软的 C++ 编译器将支持或已经支持支持 Unicode 的字符串库。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-17T13:30:59.770

正如 Darren 告诉你的，最简单的方法是使用 std::transform。

但请注意，在某些语言中，例如德语，小写和大写之间并不总是一对一的映射。“esset”小写字符（看起来像希腊字符 beta）被转换为大写的“SS”。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-12-02T14:40:00.760

如果你有 Boost，那么它有最简单的方法。查看[Boost 字符串算法中的 to_upper()/to_lower()](http://www.boost.org/doc/libs/1_45_0/doc/html/string_algo/usage.html#id2570604)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-03-01T05:34:06.827

我找到了一种转换 unicode（和多语言）字符大小写的方法，但是您需要知道/找到（以某种方式）字符的语言环境：

```
#include <locale.h>

_locale_t locale = _create_locale(LC_CTYPE, "Greek");
AfxMessageBox((CString)""+(TCHAR)_totupper_l(_T('α'), locale));
_free_locale(locale); 
```

我还没有找到一种方法来做到这一点......我有人知道怎么做，让我知道。

将语言环境设置为 NULL 不起作用...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-01-27T17:40:20.057

The `VCL`has a `SysUtils.hpp`which has `LowerCase(unicodeStringVar)`and `UpperCase(unicodeStringVar)`which may work for you。我在 C++ Builder 2009 中使用它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-26T18:58:13.440

史蒂夫说的是对的，但我想如果你的代码必须支持多种语言，你可以有一个工厂方法，它封装了一组基于该语言执行相关 toUpper 或 toLower 的方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-10-18T06:22:51.753

基于[Kyle_the_hacker 的](https://stackoverflow.com/users/1689664/kyle-the-hacker)----->[回答](https://stackoverflow.com/a/17993266/3158594)我的额外内容。

# Ubuntu

在终端列出所有语言环境
`locale -a`

安装所有语言环境
`sudo apt-get install -y locales locales-all`

编译 main.cpp
`$ g++ main.cpp`

运行编译好的程序
`$ ./a.out`

**结果**

```
Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë
Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë
ZOË SALDAÑA PLAYED IN LA MALDICIÓN DEL PADRE CARDONA. ËÈÑ ΑΩ ÓÓCHLOË
ZOË SALDAÑA PLAYED IN LA MALDICIÓN DEL PADRE CARDONA. ËÈÑ ΑΩ ÓÓCHLOË
zoë saldaña played in la maldición del padre cardona. ëèñ αω óóchloë
zoë saldaña played in la maldición del padre cardona. ëèñ αω óóchloë 
```

[![Ubuntu Linux - 来自 VSCODE 的 WSL](../Images/26f73077c7d4a369af52ff952c7fdfad.png)](https://i.stack.imgur.com/9KdHH.png)

[![Ubuntu Linux - WSL](../Images/4fc1445ffd732a4798c23ebfa2ed9792.png)](https://i.stack.imgur.com/wRHnw.png)

# 视窗

在 cmd 中运行 VCVARS 开发者工具
`"C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"`

编译 main.cpp
`> cl /EHa main.cpp /D "_DEBUG" /D "_CONSOLE" /D "_UNICODE" /D "UNICODE" /std:c++17 /DYNAMICBASE "kernel32.lib" "user32.lib" "gdi32.lib" "winspool.lib" "comdlg32.lib" "advapi32.lib" "shell32.lib" "ole32.lib" "oleaut32.lib" "uuid.lib" "odbc32.lib" "odbccp32.lib" /MTd`

```
Compilador de optimización de C/C++ de Microsoft (R) versión 19.27.29111 para x64
(C) Microsoft Corporation. Todos los derechos reservados.

main.cpp
Microsoft (R) Incremental Linker Version 14.27.29111.0
Copyright (C) Microsoft Corporation.  All rights reserved.

/out:main.exe
main.obj
kernel32.lib
user32.lib
gdi32.lib
winspool.lib
comdlg32.lib
advapi32.lib
shell32.lib
ole32.lib
oleaut32.lib
uuid.lib
odbc32.lib
odbccp32.lib 
```

运行 main.exe
`>main.exe`

**结果**

```
Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë
Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë
ZOË SALDAÑA PLAYED IN LA MALDICIÓN DEL PADRE CARDONA. ËÈÑ ΑΩ ÓÓCHLOË
ZOË SALDAÑA PLAYED IN LA MALDICIÓN DEL PADRE CARDONA. ËÈÑ ΑΩ ÓÓCHLOË
zoë saldaña played in la maldición del padre cardona. ëèñ αω óóchloë
zoë saldaña played in la maldición del padre cardona. ëèñ αω óóchloë 
```

[![视窗](../Images/35d465cdf6f833f749af75a3d15c2c15.png)](https://i.stack.imgur.com/c1Kpn.png)

## 代码 - main.cpp

> **此代码仅在 Windows x64 和 Ubuntu Linux x64 上进行了测试。**

```
/*
 * Filename: c:\Users\x\Cpp\main.cpp
 * Path: c:\Users\x\Cpp
 * Filename: /home/x/Cpp/main.cpp
 * Path: /home/x/Cpp
 * Created Date: Saturday, October 17th 2020, 10:43:31 pm
 * Author: Joma
 *
 * No Copyright 2020
 */

#include <iostream>
#include <set>
#include <string>
#include <locale>

// WINDOWS
#if (_WIN32)
#include <Windows.h>
#include <conio.h>
#define WINDOWS_PLATFORM 1
#define DLLCALL STDCALL
#define DLLIMPORT _declspec(dllimport)
#define DLLEXPORT _declspec(dllexport)
#define DLLPRIVATE
#define NOMINMAX

//EMSCRIPTEN
#elif defined(__EMSCRIPTEN__)
#include <emscripten/emscripten.h>
#include <emscripten/bind.h>
#include <unistd.h>
#include <termios.h>
#define EMSCRIPTEN_PLATFORM 1
#define DLLCALL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))

// LINUX - Ubuntu, Fedora, , Centos, Debian, RedHat
#elif (__LINUX__ || __gnu_linux__ || __linux__ || __linux || linux)
#define LINUX_PLATFORM 1
#include <unistd.h>
#include <termios.h>
#define DLLCALL CDECL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))
#define CoTaskMemAlloc(p) malloc(p)
#define CoTaskMemFree(p) free(p)

//ANDROID
#elif (__ANDROID__ || ANDROID)
#define ANDROID_PLATFORM 1
#define DLLCALL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))

//MACOS
#elif defined(__APPLE__)
#include <unistd.h>
#include <termios.h>
#define DLLCALL
#define DLLIMPORT
#define DLLEXPORT __attribute__((visibility("default")))
#define DLLPRIVATE __attribute__((visibility("hidden")))
#include "TargetConditionals.h"
#if TARGET_OS_IPHONE && TARGET_IPHONE_SIMULATOR
#define IOS_SIMULATOR_PLATFORM 1
#elif TARGET_OS_IPHONE
#define IOS_PLATFORM 1
#elif TARGET_OS_MAC
#define MACOS_PLATFORM 1
#else

#endif

#endif

typedef std::string String;
typedef std::wstring WString;

#define EMPTY_STRING u8""s
#define EMPTY_WSTRING L""s

using namespace std::literals::string_literals;

class Strings
{
public:
    static String WideStringToString(const WString& wstr)
    {
        if (wstr.empty())
        {
            return String();
        }
        size_t pos;
        size_t begin = 0;
        String ret;

#if WINDOWS_PLATFORM
        int size;
        pos = wstr.find(static_cast<wchar_t>(0), begin);
        while (pos != WString::npos && begin < wstr.length())
        {
            WString segment = WString(&wstr[begin], pos - begin);
            size = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), NULL, 0, NULL, NULL);
            String converted = String(size, 0);
            WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), &converted[0], converted.size(), NULL, NULL);
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = wstr.find(static_cast<wchar_t>(0), begin);
        }
        if (begin <= wstr.length())
        {
            WString segment = WString(&wstr[begin], wstr.length() - begin);
            size = WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), NULL, 0, NULL, NULL);
            String converted = String(size, 0);
            WideCharToMultiByte(CP_UTF8, WC_ERR_INVALID_CHARS, &segment[0], segment.size(), &converted[0], converted.size(), NULL, NULL);
            ret.append(converted);
        }
#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        size_t size;
        pos = wstr.find(static_cast<wchar_t>(0), begin);
        while (pos != WString::npos && begin < wstr.length())
        {
            WString segment = WString(&wstr[begin], pos - begin);
            size = wcstombs(nullptr, segment.c_str(), 0);
            String converted = String(size, 0);
            wcstombs(&converted[0], segment.c_str(), converted.size());
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = wstr.find(static_cast<wchar_t>(0), begin);
        }
        if (begin <= wstr.length())
        {
            WString segment = WString(&wstr[begin], wstr.length() - begin);
            size = wcstombs(nullptr, segment.c_str(), 0);
            String converted = String(size, 0);
            wcstombs(&converted[0], segment.c_str(), converted.size());
            ret.append(converted);
        }
#else
        static_assert(false, "Unknown Platform");
#endif
        return ret;
    }

    static WString StringToWideString(const String& str)
    {
        if (str.empty())
        {
            return WString();
        }

        size_t pos;
        size_t begin = 0;
        WString ret;
#ifdef WINDOWS_PLATFORM
        int size = 0;
        pos = str.find(static_cast<char>(0), begin);
        while (pos != std::string::npos) {
            std::string segment = std::string(&str[begin], pos - begin);
            std::wstring converted = std::wstring(segment.size() + 1, 0);
            size = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, &segment[0], segment.size(), &converted[0], converted.length());
            converted.resize(size);
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = str.find(static_cast<char>(0), begin);
        }
        if (begin < str.length()) {
            std::string segment = std::string(&str[begin], str.length() - begin);
            std::wstring converted = std::wstring(segment.size() + 1, 0);
            size = MultiByteToWideChar(CP_UTF8, MB_ERR_INVALID_CHARS, segment.c_str(), segment.size(), &converted[0], converted.length());
            converted.resize(size);
            ret.append(converted);
        }

#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        size_t size;
        pos = str.find(static_cast<char>(0), begin);
        while (pos != String::npos)
        {
            String segment = String(&str[begin], pos - begin);
            WString converted = WString(segment.size(), 0);
            size = mbstowcs(&converted[0], &segment[0], converted.size());
            converted.resize(size);
            ret.append(converted);
            ret.append({ 0 });
            begin = pos + 1;
            pos = str.find(static_cast<char>(0), begin);
        }
        if (begin < str.length())
        {
            String segment = String(&str[begin], str.length() - begin);
            WString converted = WString(segment.size(), 0);
            size = mbstowcs(&converted[0], &segment[0], converted.size());
            converted.resize(size);
            ret.append(converted);
        }
#else
        static_assert(false, "Unknown Platform");
#endif
        return ret;
    }

    static WString ToUpper(const WString& data)
    {
        WString result = data;
        auto& f = std::use_facet<std::ctype<wchar_t>>(std::locale());

        f.toupper(&result[0], &result[0] + result.size());
        return result;
    }

    static String  ToUpper(const String& data)
    {
        return WideStringToString(ToUpper(StringToWideString(data)));
    }

    static WString ToLower(const WString& data)
    {
        WString result = data;
        auto& f = std::use_facet<std::ctype<wchar_t>>(std::locale());
        f.tolower(&result[0], &result[0] + result.size());
        return result;
    }

    static String ToLower(const String& data)
    {
        return WideStringToString(ToLower(StringToWideString(data)));
    }

};

enum class ConsoleTextStyle
{
    DEFAULT = 0,
    BOLD = 1,
    FAINT = 2,
    ITALIC = 3,
    UNDERLINE = 4,
    SLOW_BLINK = 5,
    RAPID_BLINK = 6,
    REVERSE = 7,
};

enum class ConsoleForeground
{
    DEFAULT = 39,
    BLACK = 30,
    DARK_RED = 31,
    DARK_GREEN = 32,
    DARK_YELLOW = 33,
    DARK_BLUE = 34,
    DARK_MAGENTA = 35,
    DARK_CYAN = 36,
    GRAY = 37,
    DARK_GRAY = 90,
    RED = 91,
    GREEN = 92,
    YELLOW = 93,
    BLUE = 94,
    MAGENTA = 95,
    CYAN = 96,
    WHITE = 97
};

enum class ConsoleBackground
{
    DEFAULT = 49,
    BLACK = 40,
    DARK_RED = 41,
    DARK_GREEN = 42,
    DARK_YELLOW = 43,
    DARK_BLUE = 44,
    DARK_MAGENTA = 45,
    DARK_CYAN = 46,
    GRAY = 47,
    DARK_GRAY = 100,
    RED = 101,
    GREEN = 102,
    YELLOW = 103,
    BLUE = 104,
    MAGENTA = 105,
    CYAN = 106,
    WHITE = 107
};

class Console
{
private:
    static void EnableVirtualTermimalProcessing()
    {
#if defined WINDOWS_PLATFORM
        HANDLE hOut = GetStdHandle(STD_OUTPUT_HANDLE);
        DWORD dwMode = 0;
        GetConsoleMode(hOut, &dwMode);
        if (!(dwMode & ENABLE_VIRTUAL_TERMINAL_PROCESSING))
        {
            dwMode |= ENABLE_VIRTUAL_TERMINAL_PROCESSING;
            SetConsoleMode(hOut, dwMode);
        }
#endif
    }

    static void ResetTerminalFormat()
    {
        std::cout << u8"\033[0m";
    }

    static void SetVirtualTerminalFormat(ConsoleForeground foreground, ConsoleBackground background, std::set<ConsoleTextStyle> styles)
    {
        String format = u8"\033[";
        format.append(std::to_string(static_cast<int>(foreground)));
        format.append(u8";");
        format.append(std::to_string(static_cast<int>(background)));
        if (styles.size() > 0)
        {
            for (auto it = styles.begin(); it != styles.end(); ++it)
            {
                format.append(u8";");
                format.append(std::to_string(static_cast<int>(*it)));
            }
        }
        format.append(u8"m");
        std::cout << format;
    }
public:
    static void Clear()
    {

#ifdef WINDOWS_PLATFORM
        std::system(u8"cls");
#elif LINUX_PLATFORM || defined MACOS_PLATFORM
        std::system(u8"clear");
#elif EMSCRIPTEN_PLATFORM
        emscripten::val::global()["console"].call<void>(u8"clear");
#else
        static_assert(false, "Unknown Platform");
#endif
    }

    static void Write(const String& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
#ifndef EMSCRIPTEN_PLATFORM
        EnableVirtualTermimalProcessing();
        SetVirtualTerminalFormat(foreground, background, styles);
#endif
        String str = s;
#ifdef WINDOWS_PLATFORM
        WString unicode = Strings::StringToWideString(str);
        WriteConsole(GetStdHandle(STD_OUTPUT_HANDLE), unicode.c_str(), static_cast<DWORD>(unicode.length()), nullptr, nullptr);
#elif defined LINUX_PLATFORM || defined MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        std::cout << str;
#else
        static_assert(false, "Unknown Platform");
#endif

#ifndef EMSCRIPTEN_PLATFORM
        ResetTerminalFormat();
#endif
    }

    static void WriteLine(const String& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
        Write(s, foreground, background, styles);
        std::cout << std::endl;
    }

    static void Write(const WString& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
#ifndef EMSCRIPTEN_PLATFORM
        EnableVirtualTermimalProcessing();
        SetVirtualTerminalFormat(foreground, background, styles);
#endif
        WString str = s;

#ifdef WINDOWS_PLATFORM
        WriteConsole(GetStdHandle(STD_OUTPUT_HANDLE), str.c_str(), static_cast<DWORD>(str.length()), nullptr, nullptr);
#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        std::cout << Strings::WideStringToString(str);
#else
        static_assert(false, "Unknown Platform");
#endif

#ifndef EMSCRIPTEN_PLATFORM
        ResetTerminalFormat();
#endif
    }

    static void WriteLine(const WString& s, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
        Write(s, foreground, background, styles);
        std::cout << std::endl;
    }

    static void WriteLine()
    {
        std::cout << std::endl;
    }

    static void Pause()
    {
        char c;
        do
        {
            c = getchar();
            std::cout << "Press Key " << std::endl;
        } while (c != 64);
        std::cout << "KeyPressed" << std::endl;
    }

    static int PauseAny(bool printWhenPressed = false, ConsoleForeground foreground = ConsoleForeground::DEFAULT, ConsoleBackground background = ConsoleBackground::DEFAULT, std::set<ConsoleTextStyle> styles = {})
    {
        int ch;
#ifdef WINDOWS_PLATFORM
        ch = _getch();
#elif LINUX_PLATFORM || MACOS_PLATFORM || EMSCRIPTEN_PLATFORM
        struct termios oldt, newt;
        tcgetattr(STDIN_FILENO, &oldt);
        newt = oldt;
        newt.c_lflag &= ~(ICANON | ECHO);
        tcsetattr(STDIN_FILENO, TCSANOW, &newt);
        ch = getchar();
        tcsetattr(STDIN_FILENO, TCSANOW, &oldt);
#else
        static_assert(false, "Unknown Platform");
#endif
        if (printWhenPressed)
        {
            Console::Write(String(1, ch), foreground, background, styles);
        }
        return ch;
    }
};

int main()
{
    std::locale::global(std::locale(u8"en_US.UTF-8"));
    String dataStr = u8"Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë";
    WString dataWStr = L"Zoë Saldaña played in La maldición del padre Cardona. ëèñ αω óóChloë";
    std::string locale = u8"";
    //std::string locale = u8"de_DE.UTF-8";
    //std::string locale = u8"en_US.UTF-8";
    Console::WriteLine(dataStr);
    Console::WriteLine(dataWStr);
    dataStr = Strings::ToUpper(dataStr);
    dataWStr = Strings::ToUpper(dataWStr);
    Console::WriteLine(dataStr);
    Console::WriteLine(dataWStr);
    dataStr = Strings::ToLower(dataStr);
    dataWStr = Strings::ToLower(dataWStr);
    Console::WriteLine(dataStr);
    Console::WriteLine(dataWStr);

    Console::WriteLine(u8"Press any key to exit"s, ConsoleForeground::DARK_GRAY);
    Console::PauseAny();

    return 0;
} 
```

# asp.net - 加速 ASP.Net 网站或应用程序

> ID：11500
> 
> 赞同：25
> 
> 时间：2008-08-14T18:52:54.017
> 
> 标签：asp.net, ajax, optimization, performance

我有一个启用 Ajax.Net 的 ASP.Net 2.0 网站。网站和数据库的托管和数据库的架构一样不受我控制。在对硬件进行测试时，我确实控制了该站点的性能，但是在客户端的硬件上，重新加载或更改页面时会出现明显的延迟。

我想做的是让我的应用程序在交付时尽可能紧凑和快速。一种想法是为站点的所有静态资源设置到期日期，这样它们就不会在页面加载时被调用。资源是指图像、链接样式表和 JavaScript 源文件。是否有捷径可寻？

还有哪些其他方法可以优化 .Net 网站？

更新：我在网站上运行了 YSlow，而我受到打击最大的领域是加载的 JavaScript 和样式表的数量（23 个 JS 文件和 5 个样式表）。Ajax.net 和 Asp 已插入除一个（主样式表）之外的所有内容。为什么这么多？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-08-14T19:03:58.720

1.  [.net 3.5 SP1 中的脚本组合](http://weblogs.asp.net/scottgu/archive/2008/05/12/visual-studio-2008-and-net-framework-3-5-service-pack-1-beta.aspx)
2.  [快速网站的最佳实践](http://developer.yahoo.com/performance/rules.html)
3.  HTTP 压缩 (gzip)
4.  压缩 JS/CSS（不同于 http 压缩，缩小 javascript）
    1.  [YUI 压缩机](http://developer.yahoo.com/yui/compressor/)
    2.  [.NET YUI 压缩器](http://www.codeplex.com/YUICompressor)

我最好的建议是查看[YUI 内容](http://developer.yahoo.com/YUI)。他们有一些很棒的文章谈论[CSS sprites](http://www.alistapart.com/articles/sprites/)之类的东西，并且有一些[很好的 javascript 库来帮助减少](http://developer.yahoo.com/yui/imageloader/)浏览器发出的请求数量。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-14T19:11:07.507

如果您正在使用 Firefox 来测试您的网站，您可能想尝试使用 Yahoo! 提供的漂亮的 Firefox 扩展程序。称为[YSlow](http://web.archive.org/web/20101208124338/https://addons.mozilla.org/en-US/firefox/addon/5369/)。

它会分析您的网页，并为高性能网站的每个最佳实践提供 AF 等级（A 表示最佳，F 表示最差）。它将帮助您追踪您可以优化以获得加速的网站元素。

**更新**

现在[YSlow](http://yslow.org/)扩展与所有现代浏览器兼容，如 Firefox、Chrome、Opera、Safari 等，请[在此处](http://yslow.org/)阅读更多信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-14T19:06:44.753

默认情况下关闭视图状态，即使是最简单的页面也会有昼夜差异。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-15T02:53:37.370

几个月前，我写了[一篇关于提高 ASP.NET 页面性能的博客文章。](http://terrapinstation.wordpress.com/2008/06/12/aspnet-http-comression-and-reducing-response-size/)这里有一些快速简便的方法 -

*   关闭视图状态
*   关闭事件验证
*   实施 HTTP gzip/deflate 压缩以减少响应大小（服务器必须发送回客户端的字节数）
*   尝试优化/最小化每个请求的数据库调用

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-14T19:10:06.947

我认为您确实需要能够在生产中运行时从应用程序中获取一些实际的 PerfMon 数据/遥测数据，以便能够就优化什么做出明智的决定。

作为一次性提示，我会确保您的应用程序部署为*发布版本，并在 web.config 的“**编译*”部分中设置 debug="false" 。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-14T19:28:00.280

您似乎开始假设您的问题是下载大小 - 不一定是这种情况。您应该对您的 ASP.NET 站点进行一些试验，以确定您的代码中是否存在导致过度延迟的区域。如果事实证明下载大小不是您的问题，您将需要找到缓存结果的方法（查看输出缓存，这是 ASP.NET 的一项功能）或优化您的代码。

无论如何 - 查看性能问题的第一步*始终*是首先验证您的假设，然后决定行动方案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-14T19:53:55.437

你试过这些技巧吗？

[http://weblogs.asp.net/haroonwaheed/archive/2008/06/30/ASP.NET-Performance-Tips.aspx](http://weblogs.asp.net/haroonwaheed/archive/2008/06/30/ASP.NET-Performance-Tips.aspx)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-28T11:43:02.253

您可以开始研究缓存策略。CSS（甚至是压缩的）和图像（甚至是优化的）等静态文件应该只需要在一段时间内由浏览器下载一次。

已经提到了用于 AJAX 的脚本组合，但我没有注意到对 ScriptReferenceProfiler MS 的引用已在 codeplex 上发布以帮助确定要组合的内容。Mike Ormond[在这方面有一个很好的起点](http://blogs.msdn.com/mikeormond/archive/2008/06/26/asp-net-ajax-scriptreferenceprofiler.aspx)。

如果您对数据库执行大量插入操作，另一个提示是仔细检查服务器的磁盘缓存是否已打开。例如，我有一个数据导入器在运行期间执行了 120 万次插入。花了 4 个小时，在没有缓存的情况下进行了更改。开了16分钟。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-20T09:06:08.110

一起使用 ASP.NET 和 Ajax（任何 Ajax 库）时，一般的事情是避免让您的 Page_Load 和 Page_Init（以及它们的方法对应物）的事情变得笨拙，因为它们将在每个 Ajax 请求上执行。

话虽如此，我会认真放弃 ASP.NET AJAX 并使用*其他任何*东西......

Anthem.NET、AjaxPRO.NET、jQuery 或除 ASP.NET AJAX 之外的其他任何东西......

当然，我自己会使用[Ra-Ajax](http://ra-ajax.org)，因为那是我的项目。但话说回来，我有偏见......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-14T18:55:21.343

您可以根据您的客户支持它打开压缩。见这篇文章：[链接文字](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/d52ff289-94d3-4085-bc4e-24eb4f312e0e.mspx?mfr=true)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-14T18:55:58.050

除非更改，否则不应重新发送静态资源。IIS 将发送一个响应代码，告诉浏览器使用缓存版本。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-17T22:58:58.980

您还可以查看 ASP.NET 输出缓存，它可以相当精细地应用于页面的不同部分：

[http://msdn.microsoft.com/en-us/library/xsbfdd8c(VS.71).aspx](http://msdn.microsoft.com/en-us/library/xsbfdd8c(VS.71).aspx)

# keyboard - 是否有可能成为 ambikeyboardrous？

> ID：11514
> 
> 赞同：14
> 
> 时间：2008-08-14T19:00:16.793
> 
> 标签：keyboard, dvorak, qwerty

大约一年前，我切换到了 dvorak 键盘布局。我现在在工作和家里全职使用[dvorak 。](https://en.wikipedia.org/wiki/Dvorak_Simplified_Keyboard)

最近，我去秘鲁度假，发现自己陷入了一个难题。网吧只有 qwerty （和西班牙的 qwerty 一样）。我被困在一个很快就变老的狩猎和啄食习惯中。

也就是说，是否有可能同时在 qwerty 和 dvorak 中“流利”？如果没有，是否有任何好的解决方案来解决我发现自己所处的情况？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-08-14T19:29:11.820

> 我从来没有使用过公共计算机，但携带键盘和（/或，如果你足够好）只需更改机器上的设置。

对于在公共计算机上更改键盘映射的人来说，地狱中有一个特殊的地方。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-10T04:21:55.433

## 网络

对于您在公共计算机上无法打开键盘布局的情况，您可以访问此网站： [http ://www.dvzine.org/type/DVconverter.html](http://www.dvzine.org/type/DVconverter.html)

使用它来翻译您的输入，然后使用复制粘贴。当我在国外并且不得不在公共计算机上写一堆电子邮件时，我发现这非常有用。

## USB驱动器

将此[Dvorak 实用程序](http://typedvorak.com/2007/07/22/the-best-way-to-use-dvorak-on-windows-dvassist/)放在您的 USB 驱动器上。

运行此应用程序，它将在 Windows 的系统托盘中放置一个图标。此图标将在两种键盘布局之间切换计算机并且它可以工作。（如果您尝试过从 dvorak 到 qwerty 来回切换，您就会明白我的意思。Windows 在这一项功能上做得最差。）

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-03T19:15:08.450

很有可能。虽然在学习了 Dvorak 后我变成了单键盘，但我的妻子在这两个方面都同样迅速。她建议慢慢学习另一种布局，经常休息以重新熟悉以前的布局。

[USB 记忆棒上的DVAssist](http://clabs.org/dvorak.htm)应该可以轻松地在随机计算机上切换布局。一世

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-03T19:20:07.377

是的，很有可能。只要记住每隔一段时间使用一次Qwerty。我自己已经靠 Dvorak 学习了大约 2 周，平均功率达到 75wpm。我每天都使用 Qwerty，但大部分时间我都在使用 Dvorak。我的 Qwerty 速度仍然平均在 100wpm 左右。

几年前我还学习了韩国 Dubeolshik 布局，我的平均速度也在 100wpm 左右。

学习不同的键盘布局比学习多种语言要容易得多。人们仍然设法记住他们的母语！因此，如果您曾经了解 Qwerty，通过良好的练习，您应该能够很快恢复速度。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-01T17:34:55.757

> 也就是说，是否有可能同时在 qwerty 和 dvorak 中“流利”？如果没有，是否有任何好的解决方案来解决我发现自己所处的情况？

几年前我改用了 Dvorak，从那以后我大部分时间都精通 qwerty 和 dvorak（qwerty 只比以前慢一点；比我以前使用 dvorak 时快得多） .

我发现来回切换真正困难的唯一部分是开始：我需要几个月的时间，直到 dvorak 感觉足够自然，这样来回切换不会让我感到困惑（并损害学习曲线）。几个月后，来回切换有点尴尬，但习惯后很快就完全自然了（学校电脑和一些游戏并不容易让我换成dvorak，所以很高兴能够无论哪种方式工作）。所以我认为如果你练习一下，应该没问题:)

顺便说一句，一旦我对这两种布局都感到满意，与学习 dvorak 相比，学习其他布局非常容易。我只用了几个小时就觉得输入日文字符（平假名直接输入）比拼出它们更舒服，尽管我必须通过敲击所有键并查看产生哪个字符来学习它。感觉有点像语言——一旦你熟悉了两种语言，学习其他类似的语言就会比第二种语言容易得多:)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-08-14T19:52:10.463

FWIW，我终于找到了解决这种情况的方法。在我口授的时候，我让我的旅行伙伴（他仍然停留在 qwerty 石器时代）打字。这比我的狩猎和啄食速度提高了 10 倍。而且也容易得多。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-11T21:43:30.583

我是 ambidkeyboardwhatever，但是用两种不同的语言，所以这有助于某人提到的肌肉记忆。我在英语中使用 Qwerty，在法语中使用 Azerty。我的同事每次尝试使用我的电脑时都会诅咒！

我简要介绍了学习 Dvorak，但那只能替代 Qwerty，因为它没有重音字符。

说了这么多，无论你选择什么样的键盘布局，最重要的还是要学会触控！

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-23T20:08:16.987

我自己，我输入 40wpm Dvorak 与 80wpm QWERTY，这与我使用这些布局的频率大致相关。我需要大约一分钟的打字时间才能完全切换。

我姐姐已经设法训练自己在全尺寸键盘上键入 QWERTY，但在华硕 Eee 上的微型键盘上键入 Dvorak，并且可以随意在两个键盘之间切换。在尝试在全尺寸键盘上使用 Dvorak 或在 Eee 上使用 QWERTY 时，她确实遇到了重大问题，所以我猜这与肌肉记忆有关。

所以，有一些资格，我会说**是**的，完全有可能成为“ *ambikeyboardrous* ”。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-03-14T17:18:16.970

是的，完全有可能同时流利地使用 Dvorak 和 Qwerty，但您必须专门研究它以发展双重流利度。当我开始学习 Dvorak 时，它最初在 Qwerty 中使我瘫痪，因此我无法在任何一种布局中轻松打字。但是我正在处理腕管，无论如何也不能做很多打字，所以学习德沃夏克并不能让我变慢。在 Dvorak 和 Qwerty 之间越来越频繁地切换了几个月后，每次切换都变得越来越容易。

*现在我可以立即*切换。就好像我的潜意识里有一个键盘布局模式切换。我看不到它，但我可以告诉我的大脑我想使用什么布局，剩下的就交给我的手指了。

但是，如果您对学习德沃夏克感兴趣，请考虑是否值得努力：

*   如果您对 Dvorak 感兴趣以提高您的打字速度，我的建议是不要抱太大希望。学习需要很长时间，我不相信它会提高打字速度。它使诸如剪切/复制/粘贴之类的基本快捷键更加烦人。

*   如果您对 Dvorak 感兴趣，因为它看起来很酷，或者在 CV 上看起来不错，请不要打扰。学习外语要有趣得多。

*   如果您对 Dvorak 减轻手部疼痛感兴趣，请尝试一下。我不确定它是否减轻了我的手部疼痛，但我可以相信它会，因为它确实减少了手指必须移动的距离。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-02-03T09:59:45.803

我已经输入 Dvorak 大约 10 年了。我发现几分钟后我可以非常流畅地切换回 qwerty。我必须先看看键盘，但它又回来了。有趣的是，如果我使用不是我的计算机或键盘，我只能切换回 Qwerty。如果我在自己的笔记本电脑上将模式切换到 Qwerty，我会很挣扎。它必须在德沃夏克。=)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-11T21:54:29.500

是的。我在台式机上的 Kinesis Advantage 键盘上键入 Dvorak，但在我的 Macbook 上键入 qwerty。它们如此不同可能会有所帮助，我的肌肉会弄清楚它们在打字的是什么。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-14T19:03:36.553

我会说不。我两者都用过，它们的不同是有充分理由的（警告，历史课）

Dvorak 键盘是最佳选择，qwerty 布局的设计使打字机上的钉子不会发生碰撞（因此通常彼此相邻的字母会分开）

因为这些是如此不同，所以真的不可能两者都很好。你会发现，即使你在打字时看着键盘，你最终也会发展出肌肉记忆，让你知道按键在哪里。如果您开始移动钥匙所在的位置，这将变得一团糟。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-14T19:17:22.063

@Thomas Owens - 在你之后的那个咖啡馆里的人会很困惑:-D

我想两者都很好，你必须一直交替。我在笔记本电脑和台式机键盘之间切换时遇到了很多麻烦:-)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-03T18:42:58.060

我在家里和工作中使用自制版本的 QWERTY（所有法语字母都映射）。当我必须在这里使用通常的布局（AZERTY）时，我个人被困住了。我感觉到你的痛苦。

据我所见，每个人都习惯了单一的映射，而尝试使用其他布局非常困难。

* * *

## 回答 #15

> 赞同：-5
> 
> 时间：2008-08-14T19:01:20.380

我从来没有使用过公共计算机，但携带键盘和（/或，如果你足够好）只需更改机器上的设置。

# c# - WPF 中的变量绑定

> ID：11516
> 
> 赞同：5
> 
> 时间：2008-08-14T19:01:02.737
> 
> 标签：c#, wpf, data-binding

我正在为丰富的 TreeView 创建一个 UserControl（具有用于重命名节点、添加子节点等的上下文菜单）。我希望能够使用此控件来管理或导航我将创建的任何分层数据结构。我目前让它适用于实现以下接口的任何数据结构（实际上不需要实现接口，但是，只需要这些成员的存在）：

```
interface ITreeItem
{
    string Header { get; set; }
    IEnumerable Children { get; }
} 
```

然后在我的 UserControl 中，我使用模板将我的树绑定到数据结构，如下所示：

```
<TextBlock x:Name="HeaderTextBlock" Text="{Binding Path=Header}" /> 
```

我想做的是在我的 RichTreeView 中定义每个成员的名称，使其适应一系列不同的数据结构，如下所示：

```
class MyItem
{
    string Name { get; set; }
    ObservableCollection<MyItem> Items;
}

<uc:RichTreeView ItemSource={Binding Source={StaticResource MyItemsProvider}} 
    HeaderProperty="Name" ChildrenProperty="Items" /> 
```

有没有办法将 UserControl 内的绑定路径公开为该 UserControl 的公共属性？有没有其他方法可以解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-15T11:08:05.780

也许这可能会有所帮助：

在 Header 依赖属性上设置 HeaderProperty 属性时创建一个新的 Binding：

Header 属性是您日常的 DependencyProperty：

```
 public string Header
    {
        get { return (string)GetValue(HeaderProperty); }
        set { SetValue(HeaderProperty, value); }
    }

    public static readonly DependencyProperty HeaderProperty =
        DependencyProperty.Register("Header", typeof(string), typeof(ownerclass)); 
```

并且您的 HeaderProperty 的属性如下所示：

```
 public static readonly DependencyProperty HeaderPropertyProperty =
        DependencyProperty.Register("HeaderProperty", typeof(string), typeof(ownerclass), new PropertyMetadata(OnHeaderPropertyChanged));

    public string HeaderProperty        
    {
        get { return (string)GetValue(HeaderPropertyProperty); }
        set { SetValue(HeaderPropertyProperty, value); }
    }

   public static void OnHeaderPropertyChanged(DependencyObject obj, DependencyPropertyChangedEventArgs args)
    {
        if (args.NewValue != null)
        {
            ownerclass c = (ownerclass) obj;

            Binding b = new Binding();
            b.Path = new PropertyPath(args.NewValue.ToString());
            c.SetBinding(ownerclass.HeaderProperty, b);
        }
    } 
```

HeaderProperty 是您日常的 DependencyProperty，带有一个在 HeaderProperty 更改时立即调用的方法。因此，当它更改时，它会在 Header 上创建一个绑定，该绑定将绑定到您在 HeaderProperty 中设置的路径。:)

# .net - 我应该考虑哪些类似 Resharper 的 VS 插件列表？

> ID：11520
> 
> 赞同：3
> 
> 时间：2008-08-14T19:03:53.590
> 
> 标签：.net, visual-studio

我的 Whole Tomatoes Visual AssistX 许可证即将到期，我真的不打算续订它。我用它来检查拼写，但仅此而已。重构能力有点令人失望。在我进入 Resharper 之前，您对其他可能的插件有什么想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-14T19:11:33.837

除了试用 Visual AssistX，我唯一尝试过的另一个是 ReSharper（我强烈推荐）。如果您确实决定使用 ReSharper，您可能会注意到它缺少代码拼写检查器 - 但是[Agent Smith 插件](http://www.agentsmithplugin.com/)修复了这个问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-14T19:45:43.520

您应该看看[Visual Studio Gallery](http://www.visualstudiogallery.com/)，它*是 Visual Studio 扩展的一站式商店*。

在这里，您会发现 Visual Studio 的所有类别的大量扩展，从智能感知和重构到设计器和文档构建器。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-14T20:07:46.050

一旦你进入 resharper，你真的不想离开，它为提高我的工作效率做了很多工作。

这取决于你在做什么。当您编写测试、编写代码然后重构时，您是否进行了大量的 TDD？

除非您非常热衷于重构，否则我建议您可能无法充分利用 R#。

作为插件的插件，我使用 R# 的 RGreatX 插件。将字符串值转移到资源文件以进行软件本地化真的很方便.....为我节省了大量时间！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-14T19:06:54.020

另一个主要参与者是 DevExpress 及其 CodeRush 和 Refactor 产品。[在这里找到。](http://www.devexpress.com/Products/Visual_Studio_Add-in/Refactoring/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-28T17:25:56.593

[MZ-Tools](http://mztools.com/index.aspx)也非常好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T20:12:50.483

您是否尝试过模型[制造商代码浏览器](http://www.modelmakertools.com/code-explorer-vs/index.html)？

它在 delphi 中是一个很棒的工具，而且 Visual Studio 版本看起来也很漂亮。不过，仍在尝试找出 VS 的最佳选择是什么。

# php - 如何在 PHP 项目中找到未使用的函数

> ID：11532
> 
> 赞同：67
> 
> 时间：2008-08-14T19:08:21.503
> 
> 标签：php

如何在 PHP 项目中找到任何未使用的函数？

PHP 中是否有内置的功能或 API 可以让我分析我的代码库 - 例如[反射](http://ie.php.net/manual/en/language.oop5.reflection.php)，[`token_get_all()`](http://php.net/manual/en/function.token-get-all.php)？

这些 API 的功能是否足够丰富，让我不必依赖第三方工具来执行此类分析？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2011-01-25T09:50:51.017

你可以试试 Sebastian Bergmann 的死代码检测器：

> `phpdcd`是 PHP 代码的死代码检测器 (DCD)。它扫描 PHP 项目中所有声明的函数和方法，并将它们报告为至少没有调用一次的“死代码”。

来源：[https ://github.com/sebastianbergmann/phpdcd](https://github.com/sebastianbergmann/phpdcd)

请注意，它是一个静态代码分析器，因此它可能会为仅动态调用的方法提供误报，例如它无法检测到`$foo = 'fn'; $foo();`

您可以通过 PEAR 安装它：

```
pear install phpunit/phpdcd-beta 
```

之后，您可以使用以下选项：

```
Usage: phpdcd [switches] <directory|file> ...

--recursive Report code as dead if it is only called by dead code.

--exclude <dir> Exclude <dir> from code analysis.
--suffixes <suffix> A comma-separated list of file suffixes to check.

--help Prints this usage information.
--version Prints the version and exits.

--verbose Print progress bar. 
```

更多工具：

*   [https://phpqa.io/](https://phpqa.io/)

* * *

**注意：**根据存储库通知，*此项目不再维护，其存储库仅用于存档目的*。所以你的里程可能会有所不同。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-08-18T13:47:41.860

感谢 Greg 和 Dave 的反馈。不是我想要的，但我决定花点时间研究它，并想出了这个快速而肮脏的解决方案：

```
<?php
    $functions = array();
    $path = "/path/to/my/php/project";
    define_dir($path, $functions);
    reference_dir($path, $functions);
    echo
        "<table>" .
            "<tr>" .
                "<th>Name</th>" .
                "<th>Defined</th>" .
                "<th>Referenced</th>" .
            "</tr>";
    foreach ($functions as $name => $value) {
        echo
            "<tr>" . 
                "<td>" . htmlentities($name) . "</td>" .
                "<td>" . (isset($value[0]) ? count($value[0]) : "-") . "</td>" .
                "<td>" . (isset($value[1]) ? count($value[1]) : "-") . "</td>" .
            "</tr>";
    }
    echo "</table>";
    function define_dir($path, &$functions) {
        if ($dir = opendir($path)) {
            while (($file = readdir($dir)) !== false) {
                if (substr($file, 0, 1) == ".") continue;
                if (is_dir($path . "/" . $file)) {
                    define_dir($path . "/" . $file, $functions);
                } else {
                    if (substr($file, - 4, 4) != ".php") continue;
                    define_file($path . "/" . $file, $functions);
                }
            }
        }       
    }
    function define_file($path, &$functions) {
        $tokens = token_get_all(file_get_contents($path));
        for ($i = 0; $i < count($tokens); $i++) {
            $token = $tokens[$i];
            if (is_array($token)) {
                if ($token[0] != T_FUNCTION) continue;
                $i++;
                $token = $tokens[$i];
                if ($token[0] != T_WHITESPACE) die("T_WHITESPACE");
                $i++;
                $token = $tokens[$i];
                if ($token[0] != T_STRING) die("T_STRING");
                $functions[$token[1]][0][] = array($path, $token[2]);
            }
        }
    }
    function reference_dir($path, &$functions) {
        if ($dir = opendir($path)) {
            while (($file = readdir($dir)) !== false) {
                if (substr($file, 0, 1) == ".") continue;
                if (is_dir($path . "/" . $file)) {
                    reference_dir($path . "/" . $file, $functions);
                } else {
                    if (substr($file, - 4, 4) != ".php") continue;
                    reference_file($path . "/" . $file, $functions);
                }
            }
        }       
    }
    function reference_file($path, &$functions) {
        $tokens = token_get_all(file_get_contents($path));
        for ($i = 0; $i < count($tokens); $i++) {
            $token = $tokens[$i];
            if (is_array($token)) {
                if ($token[0] != T_STRING) continue;
                if ($tokens[$i + 1] != "(") continue;
                $functions[$token[1]][1][] = array($path, $token[2]);
            }
        }
    }
?> 
```

我可能会花更多时间在上面，以便我可以快速找到函数定义和引用的文件和行号；正在收集此信息，只是未显示。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2012-04-02T15:43:35.823

这段 bash 脚本可能会有所帮助：

```
grep -rhio ^function\ .*\(  .|awk -F'[( ]'  '{print "echo -n " $2 " && grep -rin " $2 " .|grep -v function|wc -l"}'|bash|grep 0 
```

这基本上递归地 greps 函数定义的当前目录，将命中传递给 awk，它形成一个命令来执行以下操作：

*   打印函数名
*   再次递归地 grep
*   管道输出到 grep -v 以过滤掉函数定义，以便保留对函数的调用
*   将此输出通过管道传输到 wc -l 以打印行数

然后将此命令发送到 bash 以执行，并将输出 grep 为 0，这表示对该函数的调用为 0。

请注意，这*不会*解决上面 calebbrown 引用的问题，因此输出中可能存在一些误报。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-08-20T16:57:40.640

用法：**find_unused_functions.php <root_directory>**

注意：这是解决问题的“快速-n-dirty”方法。此脚本仅对文件执行词法传递，并且不考虑不同模块定义相同名称的函数或方法的情况。如果您使用 IDE 进行 PHP 开发，它可能会提供更全面的解决方案。

需要 PHP 5

为了节省您的复制和粘贴、直接下载和任何新版本，都**[可以在此处获得](https://github.com/andreybutov/find-unused-php-functions)**。

```
#!/usr/bin/php -f

<?php

// ============================================================================
//
// find_unused_functions.php
//
// Find unused functions in a set of PHP files.
// version 1.3
//
// ============================================================================
//
// Copyright (c) 2011, Andrey Butov. All Rights Reserved.
// This script is provided as is, without warranty of any kind.
//
// http://www.andreybutov.com
//
// ============================================================================

// This may take a bit of memory...
ini_set('memory_limit', '2048M');

if ( !isset($argv[1]) ) 
{
    usage();
}

$root_dir = $argv[1];

if ( !is_dir($root_dir) || !is_readable($root_dir) )
{
    echo "ERROR: '$root_dir' is not a readable directory.\n";
    usage();
}

$files = php_files($root_dir);
$tokenized = array();

if ( count($files) == 0 )
{
    echo "No PHP files found.\n";
    exit;
}

$defined_functions = array();

foreach ( $files as $file )
{
    $tokens = tokenize($file);

    if ( $tokens )
    {
        // We retain the tokenized versions of each file,
        // because we'll be using the tokens later to search
        // for function 'uses', and we don't want to 
        // re-tokenize the same files again.

        $tokenized[$file] = $tokens;

        for ( $i = 0 ; $i < count($tokens) ; ++$i )
        {
            $current_token = $tokens[$i];
            $next_token = safe_arr($tokens, $i + 2, false);

            if ( is_array($current_token) && $next_token && is_array($next_token) )
            {
                if ( safe_arr($current_token, 0) == T_FUNCTION )
                {
                    // Find the 'function' token, then try to grab the 
                    // token that is the name of the function being defined.
                    // 
                    // For every defined function, retain the file and line
                    // location where that function is defined. Since different
                    // modules can define a functions with the same name,
                    // we retain multiple definition locations for each function name.

                    $function_name = safe_arr($next_token, 1, false);
                    $line = safe_arr($next_token, 2, false);

                    if ( $function_name && $line )
                    {
                        $function_name = trim($function_name);
                        if ( $function_name != "" )
                        {
                            $defined_functions[$function_name][] = array('file' => $file, 'line' => $line);
                        }
                    }
                }
            }
        }
    }
}

// We now have a collection of defined functions and
// their definition locations. Go through the tokens again, 
// and find 'uses' of the function names. 

foreach ( $tokenized as $file => $tokens )
{
    foreach ( $tokens as $token )
    {
        if ( is_array($token) && safe_arr($token, 0) == T_STRING )
        {
            $function_name = safe_arr($token, 1, false);
            $function_line = safe_arr($token, 2, false);;

            if ( $function_name && $function_line )
            {
                $locations_of_defined_function = safe_arr($defined_functions, $function_name, false);

                if ( $locations_of_defined_function )
                {
                    $found_function_definition = false;

                    foreach ( $locations_of_defined_function as $location_of_defined_function )
                    {
                        $function_defined_in_file = $location_of_defined_function['file'];
                        $function_defined_on_line = $location_of_defined_function['line'];

                        if ( $function_defined_in_file == $file && 
                             $function_defined_on_line == $function_line )
                        {
                            $found_function_definition = true;
                            break;
                        }
                    }

                    if ( !$found_function_definition )
                    {
                        // We found usage of the function name in a context
                        // that is not the definition of that function. 
                        // Consider the function as 'used'.

                        unset($defined_functions[$function_name]);
                    }
                }
            }
        }
    }
}

print_report($defined_functions);   
exit;

// ============================================================================

function php_files($path) 
{
    // Get a listing of all the .php files contained within the $path
    // directory and its subdirectories.

    $matches = array();
    $folders = array(rtrim($path, DIRECTORY_SEPARATOR));

    while( $folder = array_shift($folders) ) 
    {
        $matches = array_merge($matches, glob($folder.DIRECTORY_SEPARATOR."*.php", 0));
        $moreFolders = glob($folder.DIRECTORY_SEPARATOR.'*', GLOB_ONLYDIR);
        $folders = array_merge($folders, $moreFolders);
    }

    return $matches;
}

// ============================================================================

function safe_arr($arr, $i, $default = "")
{
    return isset($arr[$i]) ? $arr[$i] : $default;
}

// ============================================================================

function tokenize($file)
{
    $file_contents = file_get_contents($file);

    if ( !$file_contents )
    {
        return false;
    }

    $tokens = token_get_all($file_contents);
    return ($tokens && count($tokens) > 0) ? $tokens : false;
}

// ============================================================================

function usage()
{
    global $argv;
    $file = (isset($argv[0])) ? basename($argv[0]) : "find_unused_functions.php";
    die("USAGE: $file <root_directory>\n\n");
}

// ============================================================================

function print_report($unused_functions)
{
    if ( count($unused_functions) == 0 )
    {
        echo "No unused functions found.\n";
    }

    $count = 0;
    foreach ( $unused_functions as $function => $locations )
    {
        foreach ( $locations as $location )
        {
            echo "'$function' in {$location['file']} on line {$location['line']}\n";
            $count++;
        }
    }

    echo "=======================================\n";
    echo "Found $count unused function" . (($count == 1) ? '' : 's') . ".\n\n";
}

// ============================================================================

/* EOF */ 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2020-10-20T10:34:20.583

# 2020 更新

我已经使用了上面列出的其他方法，即使**这里的 2019 更新答案也已过时**。

Tomáš Votruba 的回答让我找到了 Phan，因为 ECS 路线现已被弃用。Symplify 已删除已死的公共方法检查器。

## Phan 是 PHP 的静态分析器

我们可以利用 Phan 来搜索死代码。以下是使用 composer 安装的步骤。这些步骤也可以在[phan 的 git repo 中](https://github.com/phan/phan)找到。这些说明假设您位于项目的根目录。

## 第 1 步 - 使用 composer 安装 Phan

```
composer require phan/phan 
```

## 第 2 步 - 安装 php-ast

`PHP-AST`是 Phan 的要求 因为我使用的是 WSL，所以我已经能够使用 PECL 进行安装，但是，`php-ast`可以在 git repo 中找到其他安装方法

```
pecl install ast 
```

## 第 3 步 - 找到并编辑 php.ini 以使用 php-ast

定位当前`php.ini`

```
php -i | grep 'php.ini' 
```

现在获取该文件位置和 nano（或您选择的任何一个来编辑此文档）。找到所有扩展的区域并添加以下行：

```
extension=ast.so 
```

## 第 4 步 - 为 Phan 创建一个配置文件

配置文件的步骤可以在 Phan 的关于[如何创建配置文件](https://github.com/phan/phan/wiki/Getting-Started#creating-a-config-file)的文档中找到。 您将希望使用他们的示例文件，因为这是一个很好的起点。编辑以下数组以在 `directory_list`&上添加您自己的路径`exclude_analysis_directory_list`。请注意，它`exclude_analysis_directory_list`仍然会被解析但不会被验证，例如。在此处添加 Wordpress 目录意味着，主题中调用的 wordpress 函数的误报不会出现，因为它在 wordpress 中找到了该函数，但同时它不会验证 wordpress 文件夹中的函数。我的看起来像这样

```
......

'directory_list' => [
  'public_html'
],

......

'exclude_analysis_directory_list' => [
    'vendor/',
    'public_html/app/plugins',
    'public_html/app/mu-plugins',
    'public_html/admin'
],
...... 
```

## 第 5 步 - 使用死代码检测运行 Phan

现在我们已经安装了 phan 和 ast，配置了我们希望解析的文件夹，是时候运行 Phan。我们将向 phan 传递一个`--dead-code-detection`不言自明的参数。

```
./vendor/bin/phan --dead-code-detection 
```

该输出需要使用细齿梳进行验证，但它肯定是最好的起点

控制台中的输出将如下所示

```
the/path/to/php/file.php:324 PhanUnreferencedPublicMethod Possibly zero references to public method\the\path\to\function::the_funciton()
the/path/to/php/file.php:324 PhanUnreferencedPublicMethod Possibly zero references to public method\the\path\to\function::the_funciton()
the/path/to/php/file.php:324 PhanUnreferencedPublicMethod Possibly zero references to public method\the\path\to\function::the_funciton()
the/path/to/php/file.php:324 PhanUnreferencedPublicMethod Possibly zero references to public method\the\path\to\function::the_funciton() 
```

请随时添加到此答案或纠正我的错误:)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-29T02:12:51.910

如果我没记错的话，你可以使用[phpCallGraph](http://phpcallgraph.sourceforge.net/)来做到这一点。它会为您生成一个漂亮的图表（图像），其中包含所有涉及的方法。如果一个方法没有与任何其他方法连接，这是一个很好的迹象，表明该方法是孤立的。

这是一个示例：[classGallerySystem.png](http://phpcallgraph.sourceforge.net/examples/refactoring-candidates/class_GallerySystem.png)

该方法`getKeywordSetOfCategories()`是孤立的。

顺便说一句，您不必拍摄图像——phpCallGraph 还可以*生成*文本文件，或者 PHP 数组等。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-06-01T00:38:22.250

因为 PHP 函数/方法可以动态调用，所以没有编程方式可以确定某个函数是否永远不会被调用。

唯一确定的方法是通过人工分析。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-03-16T11:55:43.177

## 2019+ 更新

我受到[安德烈的回答的](https://stackoverflow.com/questions/11532/how-can-i-find-unused-functions-in-a-php-project/7133253#7133253)启发，并将其变成了编码标准嗅探。

检测非常简单但功能强大：

*   找到所有方法`public function someMethod()`
*   然后找到所有方法调用`${anything}->someMethod()`
*   并简单地**报告那些从未被调用的公共函数**

它帮助我删除[了](https://github.com/Symplify/Symplify/commit/fa21855694d933716117b2a2db13acac55b86d69) [20 多种](https://github.com/Symplify/Symplify/commit/3f08ed1fb2f22dd6c4a7b46d680adf4ab5a0907d)我必须维护和测试的方法。

## 找到它们的 3 个步骤

安装 ECS：

```
composer require symplify/easy-coding-standard --dev 
```

设置`ecs.yaml`配置：

```
# ecs.yaml
services:
    Symplify\CodingStandard\Sniffs\DeadCode\UnusedPublicMethodSniff: ~ 
```

运行命令：

```
vendor/bin/ecs check src 
```

查看报告的方法并删除那些你不认为有用的方法

* * *

您可以在此处阅读更多相关信息：[从您的代码中删除已死的公共方法](https://www.tomasvotruba.cz/blog/2019/03/14/remove-dead-public-methdos-from-your-code/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-01T08:59:49.243

[phpxref](http://phpxref.sourceforge.net/)将识别从哪里调用函数，这将有助于分析 - 但仍然涉及一定数量的手动工作。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2010-06-01T21:19:14.670

afaik 没有办法。要知道哪些函数“属于谁”，您需要执行系统（运行时后期绑定函数查找）。

但是重构工具是基于静态代码分析的。我真的很喜欢动态类型语言，但在我看来它们很难扩展。大型代码库和动态类型语言缺乏安全重构是可维护性和处理软件演化的主要缺点。

# java - 使用 Web 服务时，端点、服务和端口之间有什么区别？

> ID：11561
> 
> 赞同：23
> 
> 时间：2008-08-14T19:23:54.547
> 
> 标签：java, .net, web-services, cxf, axis

我使用 Apache CXF 将大约十个 Java 类公开为 Web 服务。

我已经使用 CXF、Axis 和 .NET 生成了客户端。

在 Axis 和 CXF 中会生成“服务”或“定位器”。从此服务中，您可以获得“端口”。“端口”用于对 Web 服务公开的方法进行单独调用。

在 .NET 中，“服务”直接公开对 Web 服务的调用。

当涉及到 Web 服务时，有人可以解释端口、服务、定位器和端点之间的区别吗？

轴：

```
PatientServiceImplServiceLocator locator = 
    new PatientServiceImplServiceLocator();
PatientService service = locator.getPatientServiceImplPort(); 
```

CXF：

```
PatientServiceImplService locator = new PatientServiceImplService();
PatientService service = locator.getPatientServiceImplPort(); 
```

。网：

```
PatientServiceImplService service = new PatientServiceImplService(); 
```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-08-14T20:03:09.647

我根据凯文肯尼的回答找到了这些信息，但我想我会把它贴在这里供其他人使用。

WSDL 文档将服务定义为网络端点或端口的集合。在 WSDL 中，端点和消息的抽象定义与其具体的网络部署或数据格式绑定是分开的。这允许重用抽象定义：消息，它是正在交换的数据的抽象描述，以及端口类型，它是操作的抽象集合。特定端口类型的具体协议和数据格式规范构成可重用绑定。通过将网络地址与可重用绑定相关联来定义端口，并且端口集合定义服务。因此，WSDL 文档在网络服务的定义中使用以下元素：

*   **类型**——使用某种类型系统（例如 XSD）的数据类型定义的容器。
*   **消息**- 正在传达的数据的抽象、类型化定义。
*   **操作**——服务支持的操作的抽象描述。
*   **端口类型**——一个或多个端点支持的一组抽象操作。
*   **绑定**——特定端口类型的具体协议和数据格式规范。
*   **端口**——定义为绑定和网络地址组合的单个端点。
*   **服务**——相关端点的集合。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-14T19:54:23.860

我会跳到[http://www.w3.org/TR/wsdl.html](http://www.w3.org/TR/wsdl.html)，我认为它很好地解释了端口、服务和端点。定位器是一种特定于实现的机制，某些 WS 堆栈使用它来提供对服务端点的访问。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-04-14T17:23:31.683

我想添加它`<port>`并`<endpoint>`用于相同的目的，但`port`被 WSDL 1.1 和`endpoint`WSDL 2.0 使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-14T19:26:35.570

正如您已经提到的，这些术语在不同的堆栈中意味着不同的东西——对于 Web 服务，没有一个正确的通用答案。

# c++ - 如何重载 std::swap()

> ID：11562
> 
> 赞同：122
> 
> 时间：2008-08-14T19:24:17.260
> 
> 标签：c++, performance, optimization, stl, c++-faq

`std::swap()`在排序甚至赋值期间被许多 std 容器（例如`std::list`and ）使用。`std::vector`

但是 std 的实现`swap()`非常通用，对于自定义类型来说效率很低。

因此，可以通过重载`std::swap()`自定义类型特定的实现来获得效率。但是如何实现它以便 std 容器使用它呢？

* * *

## 回答 #1

> 赞同：144
> 
> 时间：2010-04-21T16:02:22.350

重载`std::swap`实现（也就是专门化它）的正确方法是将它写在与你交换的相同的命名空间中，以便可以通过[参数相关查找（ADL）](https://en.cppreference.com/w/cpp/language/adl)找到它。一件特别容易做的事情是：

```
class X
{
    // ...
    friend void swap(X& a, X& b)
    {
        using std::swap; // bring in swap for built-in types

        swap(a.base1, b.base1);
        swap(a.base2, b.base2);
        // ...
        swap(a.member1, b.member1);
        swap(a.member2, b.member2);
        // ...
    }
}; 
```

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2011-12-08T23:52:13.473

**注意 Mozza314**

这是对泛型`std::algorithm`调用效果的模拟`std::swap`，并让用户在命名空间 std 中提供交换。由于这是一个实验，因此此模拟使用`namespace exp`而不是`namespace std`.

```
// simulate <algorithm>

#include <cstdio>

namespace exp
{

    template <class T>
    void
    swap(T& x, T& y)
    {
        printf("generic exp::swap\n");
        T tmp = x;
        x = y;
        y = tmp;
    }

    template <class T>
    void algorithm(T* begin, T* end)
    {
        if (end-begin >= 2)
            exp::swap(begin[0], begin[1]);
    }

}

// simulate user code which includes <algorithm>

struct A
{
};

namespace exp
{
    void swap(A&, A&)
    {
        printf("exp::swap(A, A)\n");
    }

}

// exercise simulation

int main()
{
    A a[2];
    exp::algorithm(a, a+2);
} 
```

对我来说，这打印出来：

```
generic exp::swap 
```

如果你的编译器打印出不同的东西，那么它没有正确地为模板实现“两阶段查找”。

如果您的编译器符合（符合 C++98/03/11 中的任何一个），那么它将给出与我显示的相同的输出。在那种情况下，你担心会发生的事情，确实会发生。并将您的`swap`放入命名空间`std`( `exp`) 并没有阻止它的发生。

Dave 和我都是委员会成员，并且已经在该标准领域工作了十年（并不总是彼此一致）。但是这个问题已经解决了很长时间，我们都同意它是如何解决的。无视戴夫在该领域的专家意见/回答，后果自负。

这个问题是在 C++98 发布之后才暴露出来的。大约从 2001 年开始，戴夫和我开始在[这个领域工作](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2001/n1289.html)。这是现代解决方案：

```
// simulate <algorithm>

#include <cstdio>

namespace exp
{

    template <class T>
    void
    swap(T& x, T& y)
    {
        printf("generic exp::swap\n");
        T tmp = x;
        x = y;
        y = tmp;
    }

    template <class T>
    void algorithm(T* begin, T* end)
    {
        if (end-begin >= 2)
            swap(begin[0], begin[1]);
    }

}

// simulate user code which includes <algorithm>

struct A
{
};

void swap(A&, A&)
{
    printf("swap(A, A)\n");
}

// exercise simulation

int main()
{
    A a[2];
    exp::algorithm(a, a+2);
} 
```

输出是：

```
swap(A, A) 
```

**更新**

已观察到：

```
namespace exp
{    
    template <>
    void swap(A&, A&)
    {
        printf("exp::swap(A, A)\n");
    }

} 
```

作品！那么为什么不使用它呢？

考虑您`A`是类模板的情况：

```
// simulate user code which includes <algorithm>

template <class T>
struct A
{
};

namespace exp
{

    template <class T>
    void swap(A<T>&, A<T>&)
    {
        printf("exp::swap(A, A)\n");
    }

}

// exercise simulation

int main()
{
    A<int> a[2];
    exp::algorithm(a, a+2);
} 
```

现在它不再起作用了。:-(

因此，您可以放入`swap`命名空间 std 并让它工作。`swap`但是，`A`当您有模板时，您需要记住将's 命名空间： `A<T>`。`swap`而且由于如果您放入's 命名空间，这两种情况都可以工作`A`，因此更容易记住（并教其他人）以一种方式来做。

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2008-08-14T19:46:32.113

不允许（根据 C++ 标准）重载 std::swap，但是特别允许您将自己的类型的模板特化添加到 std 命名空间。例如

```
namespace std
{
    template<>
    void swap(my_type& lhs, my_type& rhs)
    {
       // ... blah
    }
} 
```

那么 std 容器（以及其他任何地方）中的用法将选择您的专业而不是一般专业。

另请注意，提供交换的基类实现对于您的派生类型来说还不够好。例如，如果你有

```
class Base
{
    // ... stuff ...
}
class Derived : public Base
{
    // ... stuff ...
}

namespace std
{
    template<>
    void swap(Base& lha, Base& rhs)
    {
       // ...
    }
} 
```

这将适用于基类，但是如果您尝试交换两个派生对象，它将使用 std 的通用版本，因为模板交换是完全匹配的（并且它避免了仅交换派生对象的“基”部分的问题）。

注意：我已对此进行了更新，以从我上一个答案中删除错误的位。哦！（感谢 puetzk 和 j_random_hacker 指出）

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-09-20T22:24:12.633

虽然通常不应该向 std:: 命名空间添加东西是正确的，但特别允许为用户定义的类型添加模板特化。重载函数不是。这是一个微妙的区别:-)

> 17.4.3.1/1 除非另有说明，否则未定义 C++ 程序将声明或定义添加到命名空间 std 或具有命名空间 std 的命名空间。程序可以将任何标准库模板的模板特化添加到命名空间 std。标准库的这种特化（完全或部分）会导致未定义的行为，除非声明依赖于用户定义的外部链接名称，并且除非模板特化满足原始模板的标准库要求。

std::swap 的特殊化如下所示：

```
namespace std
{
    template<>
    void swap(myspace::mytype& a, myspace::mytype& b) { ... }
} 
```

如果没有 template<> 位，它将是未定义的重载，而不是允许的特化。@Wilka 建议的更改默认命名空间的方法可能适用于用户代码（由于 Koenig 查找更喜欢无命名空间版本），但不能保证，实际上也不应该这样做（STL 实现应该完全使用-限定的 std::swap)。

[comp.lang.c++.moderated 上](http://groups.google.ca/group/comp.lang.c++.moderated/browse_thread/thread/b396fedad7dcdc81)有一个线程，对该主题进行了**长时间**的讨论。不过，其中大部分是关于部分专业化的（目前没有好的方法）。

# macos - 通过 AppleScript 添加 InDesign XMLElements 时如何提高性能？

> ID：11574
> 
> 赞同：7
> 
> 时间：2008-08-14T19:32:03.190
> 
> 标签：macos, adobe, applescript, adobe-indesign

我有一个 AppleScript 程序，它在 Adob​​e InDesign 文档中创建 XML 标记和元素。数据在表格中，标记每个单元格需要 0.5 秒。整个脚本需要几个小时才能完成。

我可以发布内部循环代码，但我不确定 SO 应该是通用的还是特定的。我会让暴徒决定。

[编辑] 代码构建了一个列表（在此循环之前），其中包含表中每行一个项目。还有一个列表，其中包含表中每一列的一个字符串。对于每个单元格，程序通过连接两个列表的 [row]/[column] 位置中的项目来创建一个 XML 元素和一个 XML 标记。它还将该单元格中的文本与新创建的元素相关联。

我对 AppleScript 完全陌生，因此其中一些代码是从 Adob​​e 的示例中粗略修改的。如果代码很糟糕，我不会生气。

这是代码：

```
repeat with columnNumber from COL_START to COL_END

    select text of cell ((columnNumber as string) & ":" & (rowNumber as string)) of ThisTable

    tell activeDocument

        set thisXmlTag to make XML tag with properties {name:item rowNumber of symbolList & "_" & item columnNumber of my histLabelList}

        tell rootXmlElement

            set thisXmlElement to make XML element with properties {markup tag:thisXmlTag}

        end tell

        set contents of thisXmlElement to (selection as string)

    end tell

end repeat 
```

编辑：我已经改写了这个问题以更好地反映正确的答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-26T17:07:13.487

问题几乎可以肯定是选择。无论如何，您可以一次提取所有文本然后迭代内部变量吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-23T15:33:52.443

我想出了这个。

该文档包含一堆数据表。总共有大约 7,000 个数据点需要导出。我正在创建一个包含 7,000 个子元素的根元素。

不要那样做。将每个子元素添加到根元素变得越来越慢，直到大约 5,000 个子元素 AppleScript 超时并且程序中止。

解决方案是通过创建大约 480 个子节点来使我的代码更脆弱，每个子节点大约有 16 个孙子节点。相同数量的节点，但代码现在运行得足够快。（处理文档仍然需要大约 40 分钟，但这比无穷大的时间要少得多。）

顺便说一句，最初的 7000 名儿童计划并不像看起来那样愚蠢或懒惰。新的解决方案迫使我使用我无法控制的表中的数据将两个表链接在一起。如果有这么多不应该有的空间，程序现在就会中断。（但它有效。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-14T19:34:54.040

> 我可以发布内部循环代码，但我不确定 SO 应该是通用的还是特定的。我会让暴徒决定。

您作为示例发布的代码可以像您（或您的老板）所接受的那样具体 - 通常情况下，更具体的细节更容易帮助您。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-14T19:34:54.197

如果内部循环代码的长度合理，我看不出有任何理由不能发布它。我认为 Stack Overflow 旨在涵盖一般问题和特定问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-08T20:52:00.140

您使用的是 InDesign 还是 InDesign Server？您的文档有多少页（或者您可以告诉我们有关您的文档/ID 设置的其他信息）？

我做了很多 InDesign Server 开发。由于一些不一定与代码相关的原因，您可能会看到速度变慢。

现在，我在大约 100 秒内几乎完全从 script/xml 生成了 100-300 页文档（您可能正在做更大的事情）。

# c# - 在 ASP.NET 中清除页面缓存

> ID：11585
> 
> 赞同：51
> 
> 时间：2008-08-14T19:39:32.033
> 
> 标签：c#, asp.net, outputcache

对于我的博客，我想使用输出缓存将特定帖子的缓存版本保存大约 10 分钟，这很好......

```
<%@OutputCache Duration="600" VaryByParam="*" %> 
```

但是，如果有人发表评论，我想清除缓存，以便刷新页面并且可以看到评论。

如何在 ASP.Net C# 中执行此操作？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-08-14T20:04:36.290

我找到了我正在寻找的答案：

```
HttpResponse.RemoveOutputCacheItem("/caching/CacheForever.aspx"); 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2010-05-20T18:24:31.887

如果您知道要清除缓存的页面，则上述内容很好。在我的实例（ASP.NET MVC）中，我引用了来自各地的相同数据。因此，当我执行 [save] 时，我想清除站点范围内的缓存。这对我有用： http: [//aspalliance.com/668](http://aspalliance.com/668)

这是在 OnActionExecuting 过滤器的上下文中完成的。它可以通过在 BaseController 或其他东西中覆盖 OnActionExecuting 来轻松完成。

```
HttpContextBase httpContext = filterContext.HttpContext;
httpContext.Response.AddCacheItemDependency("Pages"); 
```

设置：

```
protected void Application_Start()
{
    HttpRuntime.Cache.Insert("Pages", DateTime.Now);
} 
```

小调整：我有一个助手，它添加了“闪存消息”（错误消息、成功消息 - “此项目已成功保存”等）。为了避免 flash 消息出现在每个后续的 GET 中，我必须在写完 flash 消息后使其无效。

清除缓存：

```
HttpRuntime.Cache.Insert("Pages", DateTime.Now); 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-06T13:55:03.047

使用 Response.AddCacheItemDependency 清除所有输出缓存。

```
 public class Page : System.Web.UI.Page
  {
    protected override void OnLoad(EventArgs e)
    {
        try
        {
            string cacheKey = "cacheKey";
            object cache = HttpContext.Current.Cache[cacheKey];
            if (cache == null)
            {
              HttpContext.Current.Cache[cacheKey] = DateTime.UtcNow.ToString();
            }

            Response.AddCacheItemDependency(cacheKey);
        }
        catch (Exception ex)
        {
            throw new SystemException(ex.Message);
        }

        base.OnLoad(e);
    }     
 }

  // Clear All OutPutCache Method    

    public void ClearAllOutPutCache()
    {
        string cacheKey = "cacheKey";
        HttpContext.Cache.Remove(cacheKey);
    } 
```

这也可以在 ASP.NET MVC 的 OutputCachedPage 中使用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-06-22T12:24:06.220

在母版页加载事件中，请编写以下内容：

```
Response.Cache.SetExpires(DateTime.UtcNow.AddMinutes(-1));
Response.Cache.SetCacheability(HttpCacheability.NoCache);
Response.Cache.SetNoStore(); 
```

并在注销按钮中单击：

```
Session.Abandon();
Session.Clear(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-14T19:51:50.683

唔。您可以在 OutputCache 项上指定 VaryByCustom 属性。this 的值作为参数传递给您可以在 global.asax 中实现的 GetVaryByCustomString 方法。此方法返回的值用作缓存项的索引 - 例如，如果您返回页面上的评论数，则每次添加评论时都会缓存一个新页面。

需要注意的是，这实际上并没有清除缓存。如果博客条目获得大量评论使用，则使用此方法您的缓存可能会爆炸。

或者，您可以将页面的不可更改位（导航、广告、实际博客条目）实现为用户控件，并在每个用户控件上实现部分页面缓存。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-14T19:55:31.847

如果您将“*”更改为缓存应该变化的参数（PostID？），您可以执行以下操作：

```
//add dependency
string key = "post.aspx?id=" + PostID.ToString();
Cache[key] = new object();
Response.AddCacheItemDependency(key); 
```

当有人添加评论时......

```
Cache.Remove(key); 
```

我想这甚至可以使用 VaryByParam *，因为所有请求都将绑定到相同的缓存依赖项。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-02T00:17:48.347

为什么不在posts 表上使用sqlcachedependency？

[sqlcache依赖msdn](http://msdn.microsoft.com/en-us/library/ms178604.aspx)

这样你就没有实现自定义缓存清除代码，只是随着数据库中内容的变化而刷新缓存？

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2011-01-18T18:55:57.207

`HttpRuntime.Close()`..我尝试了所有方法，这是唯一对我有用的方法

# language-agnostic - 你使用设计模式吗？

> ID：11586
> 
> 赞同：29
> 
> 时间：2008-08-14T19:39:32.813
> 
> 标签：language-agnostic, design-patterns

设计模式在现实世界中的渗透率如何？你是在日常工作中使用它们——与你的同事讨论如何以及在哪里应用它们——还是它们更多地是一个学术概念？

他们真的为你的工作提供了实际价值吗？或者它们只是人们谈论听起来很聪明的东西？

注意：出于这个问题的目的，请忽略像*Singleton*这样的“简单”设计模式。我说的是设计您的代码，以便您可以利用*Model View Controller*等。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-08-14T19:54:09.633

任何编写良好的大型程序都会使用设计模式，即使它们没有被命名或识别为这样。这就是设计模式，重复*自然*发生的设计。如果您正在与丑陋的 API 交互，您可能会发现自己实现了一个`Facade`来清理它。如果您有需要解耦的组件之间的消息传递，您可能会发现自己使用`Observer`. 如果您有几种可互换的算法，您最终可能会使用`Strategy`.

了解设计模式是值得的，因为您更有可能识别它们，然后更快地集中在一个干净的解决方案上。然而，即使你根本不知道它们，你最终还是会创建它们（如果你是一个体面的程序员）。

当然，如果您使用的是现代语言，您可能会被迫在某些事情上使用它们，因为它们已被纳入标准库。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-14T20:16:55.733

在我看来，“你**使用**设计模式吗？”这个问题本身就有一点缺陷，因为答案普遍是肯定的。

让我解释一下，我们，程序员和设计师，都在使用设计模式……只是我们并不总是意识到这一点。我知道这听起来很陈词滥调，但你不去寻找模式，模式会来找你。你设计的东西，它可能看起来像一个现有的模式，你这样命名它是为了让每个人都能理解你在说什么，并且你的设计决策背后的理由更有说服力，因为知道它之前已经被讨论过，*令人作呕*。

我个人使用模式作为交流工具。就是这样。它们不是设计解决方案，它们不是最佳实践，它们不是工具箱中的工具。

不要误会我的意思，如果您是初学者，有关模式的书籍将向您展示如何“使用”他们的模式而不是另一个有缺陷的设计来最好地解决解决方案。你可能会从练习中学到东西。但是，您必须意识到，这并不意味着每种情况都需要相应的模式来解决它。每种情况都有一个怪癖，这将要求您考虑替代方案并做出没有完美答案的艰难决定。**这就是**设计。

然而，反模式是完全不同的类别。您实际上**想**积极**避免**反模式。这就是为什么命名反模式如此有争议的原因。

回到你最初的问题：
“我使用设计模式吗？”，是的！
“我是否积极地倾向于设计模式？”，不。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-02-14T14:03:20.153

是的。如果使用得当，设计模式会很精彩。正如您所提到的，我现在在我的所有 Web 项目中都使用模型-视图-控制器 (MVC)。这是 Web 空间中非常常见的模式，它使服务器端代码更加清晰和组织良好。

除此之外，还有一些其他可能有用的模式：

*   MVVM（模型-视图-视图模型）：类似于 MVC 的模式；用于 WPF 和 Silverlight 应用程序。

*   组合：非常适合需要使用对象层次结构的情况。

*   Singleton：比使用全局变量更优雅地存储真正需要单个实例的项目。正如你所提到的，一个简单的模式，但它确实有它的用途。

值得注意的是，设计模式还可以突出语言功能的缺乏和/或语言的缺陷。例如，迭代器现在作为新语言的一部分内置。

一般来说，设计模式非常有用，但你不应该在任何地方都使用它们；正是它们非常适合您的需求。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-14T19:41:40.330

我尝试，是的。它们确实有助于代码的可维护性和可读性。但是，有些人确实滥用它们，通常（据我所见）通过强迫系统进入不存在的模式。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-14T19:46:04.597

如果适用，我会尝试使用模式。我认为看到开发人员仅仅为了它而在代码中实现设计模式有点令人难过。但是，对于正确的任务，设计模式可能非常有用和强大。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-14T19:42:32.840

在“现实世界”中使用了许多超越简单的设计模式。很好的例子 Stackoverflow 使用模型视图控制器模式。我在我的雇主的项目中多次使用 Class Factories，我也看到许多已经编写好的项目也在使用它们。

我并不是说每个设计模式都在使用，但很多都在使用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-14T19:44:40.667

是的，我们这样做了，这通常发生在我们开始设计某些东西然后有人注意到它类似于现有模式时。然后我们看一下它，看看它如何帮助我们实现目标。

我们还使用没有记录但在大量设计中出现的模式。

请注意，我们不经常使用它们。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-08-14T19:44:48.467

是的，工厂、责任链、命令、代理、访问者和观察者等都在我每天使用的代码库中使用。[就 MVC 而言，这个网站似乎很好地使用了它，开发人员在最新的播客](http://itc.conversationsnetwork.org/shows/detail3787.html)中说不出足够多的好话。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-14T19:47:18.010

是的，我使用了很多众所周知的设计模式，但我最终也构建了一些软件，后来我发现这些软件使用了“命名”设计模式。最优雅、可重复使用的设计可以称为“模式”。这很像舞蹈动作。我们都知道华尔兹和两步舞，但并不是每个人都有“颠簸和滑行”的名字，尽管我们大多数人都这样做。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-14T19:47:20.880

MVC 是众所周知的，所以是的，我们经常使用设计模式。现在，如果您询问 Gang of Four 模式，我会使用几种模式，因为其他维护人员会知道设计以及我们在代码中的工作目标。虽然有几个对于我们所做的事情仍然相当模糊，所以如果我使用一个，我就无法获得使用模式的全部好处。

它们是否重要，是的，因为它为您提供了一种以快速有效且普遍接受的方式谈论软件设计的方法。你能做更好的定制解决方案吗，是的（排序）？

最初的 GoF 模式是从生产代码中提取的，因此他们对已经在野外使用的内容进行了分类。它们不是纯粹的，甚至主要是学术的东西。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-14T19:50:15.007

我发现 MVC 模式对于隔离您的模型逻辑非常有用，它可以被重用或在没有太多麻烦的情况下工作。它还有助于解耦你的类并使单元测试更容易。[我最近](http://blog.lonestardeveloper.com/2008/07/mvc-pattern-and-me.html)写过它（是的，无耻的插件在这里......）

此外，我最近使用来自基类的工厂模式使用[LINQ](http://msdn.microsoft.com/en-us/netframework/aa904594.aspx)生成并返回我即时需要的正确 DataContext 类。

在尝试将两种不同的技术粘合在一起时使用桥接器（例如Mac 上的[Cocoa 和 Ruby ）](http://rubycocoa.sourceforge.net/HomePage)

然而，我发现，每当我实现一个模式时，都是因为我事先就知道它。因为我发现我必须稍微修改原始模式以适应我的需要，所以通常会考虑一些额外的想法。

你只需要小心不要成为[建筑宇航员](http://www.joelonsoftware.com/articles/fog0000000018.html)！

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-08-27T17:50:05.980

是的，设计模式在现实世界中大量使用——而且每天都被我共事的许多人使用。

在我看来，设计模式提供的最大价值在于它们为您提供了一种通用的高级语言，可以将软件设计传达给其他程序员。

例如，与其将您的新类描述为“基于某种输入标准组合创建其他几个类之一的实用程序”，您可以简单地说它是一个*“抽象工厂”*，每个人都会立即理解您在说什么。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-03-30T11:56:41.200

是的，设计模式或抽象模式是我生活的一部分，我在哪里看，我就开始看到它们。因此，我被他们包围了。但是，如您所知，知之甚少是一件危险的事情。因此，我强烈推荐你阅读 GoF 的书。

关于设计模式的主要问题之一，大多数开发人员只是不明白，或者不相信它们。大多数时候，他们争论的是变量、循环或开关。但是，我坚信，如果你不会说模式语言，你的软件就不会走得太远，你会发现自己陷入了维护的噩梦。

如您所知，反模式也是危险的事情，当您对设计模式缺乏专业知识时就会发生这种情况。并且重构反模式更加困难。作为关于这个问题的推荐书籍，请阅读“AntiPatterns: Refactoring Software, Architectures, and Projects in Crisis”。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-10-19T08:45:20.830

是的。

我们甚至在我目前的工作中使用它们：使用 COBOL 和 PL/I 进行大型机编码。

到目前为止，我已经看到了 Adaptor、Visitor、Facade、Module、Observer 以及非常接近 Composite 和 Iterator 的东西。由于语言的性质，它主要使用结构模式。此外，我并不总是确定使用它们的人是否有意识地这样做：D

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-08-14T21:50:32.910

我绝对使用设计模式。在这一点上，我认为 MVC 作为一种设计模式是理所当然的。我使用它们的主要原因是我足够谦虚，知道我可能不是第一个遇到特定问题的人。我很少开始一段代码知道我将使用哪种模式；我不断地观察代码，看它是否自然地发展成现有的模式。

我也很喜欢[Martin Fowler 的](http://martinfowler.com/) [企业应用架构模式](https://rads.stackoverflow.com/amzn/click/com/0321127420)。当一个问题或任务出现时，我会翻到相关部分（它主要是一本参考书）并阅读一些模式概述。一旦我对一般问题和现有解决方案有了更好的了解，我就会开始通过其他人的经验看到我的代码可能会采取的长期路径。我最终会做出更好的决定。

设计模式肯定在我所有的“面向未来”的想法中发挥了重要作用。

# email - 有没有支持通过电子邮件创建页面的 wiki 引擎？

> ID：11612
> 
> 赞同：6
> 
> 时间：2008-08-14T19:51:52.010
> 
> 标签：email, wiki, mime, wiki-engine

我想将我工作的公司的所有松散信息整合到一个知识库中。wiki 似乎是要走的路，但大多数相关信息都隐藏在 PST 文件中，并且需要很长时间才能说服人们手动将他们的电子邮件（包括附件）一一翻译成 wiki 页面。所以我正在寻找一个支持通过电子邮件创建页面的wiki引擎，即能够接收电子邮件（支持纯文本、html和附件）然后创建相应的页面。支持文件索引和查找重复文件将是一个巨大的好处。

我尝试使用[WikiMatrix](http://www.wikimatrix.org/)，但没有找到我想要的东西。我不介意构建自己的引擎（在这里和那里借几个片段用于[MIME 解码](http://www.codeproject.com/KB/cs/MIME_De_Encode_in_C_.aspx)），但我不认为这是一个罕见的问题，所以没有实现。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-14T20:06:44.180

Jotspot 和 MediaWiki 都允许您这样做。后者支持很多插件，这是其中之一。格式本质上是 PageTitle@something。Jotspot 是一个托管解决方案，您可以在其中获得自己的电子邮件地址，MediaWiki 是自托管的，您可以给它一个邮箱来监控传入。

如果文章已经存在，则将它们附加到页面，如果不存在，则创建新页面。这确实需要一定程度的命名约定纪律，但对于抄送非常有用。

我们在这里使用 MediaWiki，我非常喜欢它。它与许多其他 Wiki 软件包有相同的缺陷（例如，如果没有孤立页面就难以重组），但与我使用过的其他 Wiki 软件包一样好，如果不是更好的话。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-16T22:37:46.453

我不知道这是否正是您想要的，但我知道 37 Signals 的许多产品都支持通过电子邮件添加数据。我使用 Highrise 来跟踪我的一些商业信函，我可以抄送或转发电子邮件给 Highrise，它们会被添加到适当的联系人中。

# sql - 关系数据库设计的好资源

> ID：11615
> 
> 赞同：13
> 
> 时间：2008-08-14T19:52:54.847
> 
> 标签：sql, database, performance

我正在寻找一本关于关系数据库设计、性能调整等最佳实践的书/网站/教程。事实证明，这种资源有点难找；有很多“这里是规范化，这里是 ER 图，有它”，但在实际示例中并不多。有人有想法么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-14T19:54:23.113

书：[为凡人设计的数据库](https://rads.stackoverflow.com/amzn/click/com/0201752840)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-14T20:05:06.740

看看[免费数据模型库](http://www.databaseanswers.org/data_models/index.htm)。有大量示例数据库设计，其中包含涵盖真实场景的图表（还有一些只是有趣/有趣的）。我从来没有按原样使用过，但是了解如何解决将情况需求映射到数据模型中的问题通常很方便。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T18:34:09.237

查看“ [SQL 的艺术](http://oreilly.com/catalog/9780596008949/)”。很高兴阅读。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-14T20:07:39.217

以下是我可以在网上找到的一些资源。它们包括您正在寻找的示例：

*   [设计和创建关系数据库 - Lorna Scammell 博士：纽卡斯尔大学数据库顾问](http://databases.ncl.ac.uk/databases/Design/default.aspx)
*   [用于关系数据库设计的示例数据模型](http://www.databasedev.co.uk/data_models.html)

# sql-server - 如何终止与 SQL Server 2005 数据库的所有当前连接？

> ID：11620
> 
> 赞同：290
> 
> 时间：2008-08-14T19:54:25.187
> 
> 标签：sql-server, sql-server-2005

我想重命名数据库，但不断收到数据库上“无法获得排他锁”的错误，这意味着有一些连接仍然处于活动状态。

如何终止与数据库的所有连接以便重命名它？

* * *

## 回答 #1

> 赞同：382
> 
> 时间：2008-08-14T19:56:56.633

[Adam 建议](https://stackoverflow.com/questions/11620/how-do-you-kill-all-current-connections-to-a-sql-server-2005-database/11627#11627)的方法行不通的原因是，在您循环活动连接期间，可以建立新的连接，而您会错过这些连接。您可以改用以下没有此缺点的方法：

```
-- set your current connection to use master otherwise you might get an error

use master
ALTER DATABASE YourDatabase SET SINGLE_USER WITH ROLLBACK IMMEDIATE 

--do you stuff here 

ALTER DATABASE YourDatabase SET MULTI_USER 
```

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2008-08-14T19:57:15.073

完成此操作的脚本，将“DB_NAME”替换为数据库以终止所有连接：

```
USE master
GO

SET NOCOUNT ON
DECLARE @DBName varchar(50)
DECLARE @spidstr varchar(8000)
DECLARE @ConnKilled smallint
SET @ConnKilled=0
SET @spidstr = ''

Set @DBName = 'DB_NAME'
IF db_id(@DBName) < 4
BEGIN
PRINT 'Connections to system databases cannot be killed'
RETURN
END
SELECT @spidstr=coalesce(@spidstr,',' )+'kill '+convert(varchar, spid)+ '; '
FROM master..sysprocesses WHERE dbid=db_id(@DBName)

IF LEN(@spidstr) > 0
BEGIN
EXEC(@spidstr)
SELECT @ConnKilled = COUNT(1)
FROM master..sysprocesses WHERE dbid=db_id(@DBName)
END 
```

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2010-05-12T10:40:36.627

杀死它，用火杀死它：

```
USE master
go

DECLARE @dbname sysname
SET @dbname = 'yourdbname'

DECLARE @spid int
SELECT @spid = min(spid) from master.dbo.sysprocesses where dbid = db_id(@dbname)
WHILE @spid IS NOT NULL
BEGIN
EXECUTE ('KILL ' + @spid)
SELECT @spid = min(spid) from master.dbo.sysprocesses where dbid = db_id(@dbname) AND spid > @spid
END 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2008-08-14T19:58:03.947

使用 SQL Management Studio Express：

在对象资源管理器树中，在 Management 下向下钻取到“Activity Monitor”（如果在其中找不到它，则右键单击数据库服务器并选择“Activity Monitor”）。打开活动监视器，您可以查看所有进程信息。您应该能够找到您感兴趣的数据库的锁并终止这些锁，这也会终止连接。

之后您应该可以重命名。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2008-08-14T20:00:23.427

我一直用：

```
 ALTER DATABASE DB_NAME SET SINGLE_USER WITH ROLLBACK IMMEDIATE 
GO 
SP_RENAMEDB 'DB_NAME','DB_NAME_NEW'
Go 
ALTER DATABASE DB_NAME_NEW  SET MULTI_USER -- set back to multi user 
GO 
```

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2012-07-18T08:02:36.680

```
ALTER DATABASE [Test]
SET OFFLINE WITH ROLLBACK IMMEDIATE

ALTER DATABASE [Test]
SET ONLINE 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2011-01-05T14:49:27.437

下线需要一段时间，有时我会遇到一些问题。

我认为最可靠的方式：

**分离** 右键单击​​ DB -> 任务 -> 分离...检查“删除连接”确定

**重新** 附加 右键单击​​数据库 -> 附加.. 添加... -> 选择您的数据库，然后将附加为列更改为您想要的数据库名称。行

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2012-02-01T09:30:22.690

```
Select 'Kill '+ CAST(p.spid AS VARCHAR)KillCommand into #temp
from master.dbo.sysprocesses p (nolock)
join master..sysdatabases d (nolock) on p.dbid = d.dbid
Where d.[name] = 'your db name'

Declare @query nvarchar(max)
--Select * from #temp
Select @query =STUFF((                              
            select '  ' + KillCommand from #temp
            FOR XML PATH('')),1,1,'') 
Execute sp_executesql @query 
Drop table #temp 
```

使用“主”数据库并运行此查询，它将终止数据库中的所有活动连接。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-08-15T15:52:24.463

当我尝试恢复数据库时，我通常会遇到该错误我通常只是转到 Management Studio 中树的顶部，然后右键单击并重新启动数据库服务器（因为它在开发机器上，这在生产中可能并不理想）。这是关闭所有数据库连接。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-08-14T19:56:56.540

在对象资源管理器上的 MS SQL Server Management Studio 中，右键单击数据库。在随后的上下文菜单中选择“任务 -> 脱机”

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-11-12T04:30:46.740

以下是如何在 MS SQL Server Management Studio 2008 中可靠地执行此类操作（也可能适用于其他版本）：

1.  在对象资源管理器树中，右键单击根数据库服务器（带有绿色箭头），然后单击活动监视器。
2.  打开活动监视器中的进程选项卡，选择“数据库”下拉菜单，然后按所需的数据库进行过滤。
3.  右键单击对象资源管理器中的数据库并启动“任务-> 脱机”任务。让这个在后台运行，而你...
4.  尽可能安全地关闭。
5.  从进程选项卡中终止所有剩余进程。
6.  使数据库重新联机。
7.  重命名数据库。
8.  使您的服务重新联机并将其指向新数据库。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2011-08-18T22:16:24.600

另一种“用火杀死它”的方法是重新启动 MSSQLSERVER 服务。我喜欢从命令行做事。将其准确粘贴到 CMD 中即可：NET STOP MSSQLSERVER & NET START MSSQLSERVER

或者打开“services.msc”，找到“SQL Server (MSSQLSERVER)”并右键单击，选择“重新启动”。

这将“肯定，肯定”终止与该实例上运行的所有数据库的所有连接。

（我比许多更改和更改服务器/数据库上的配置的方法更喜欢这个）

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2011-12-28T09:18:26.237

在这种情况下为我工作的选项如下：

1.  对有问题的数据库启动“分离”操作。这将打开一个窗口（在 SQL 2005 中），显示阻止对 DB 执行操作的活动连接。
2.  终止活动连接，取消分离操作。
3.  数据库现在应该可用于恢复。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-08-14T19:58:13.777

试试这个：

```
ALTER DATABASE [DATABASE_NAME]
SET SINGLE_USER
WITH ROLLBACK IMMEDIATE 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2010-11-15T11:13:29.100

右键单击数据库名称，单击属性以获取属性窗口，打开选项选项卡并将“限制访问”属性从多用户更改为单用户。当你点击确定按钮时，它会提示你关闭所有打开的连接，选择“是”，你就可以重命名数据库了……

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2012-05-01T03:10:41.877

这些对我不起作用（SQL2008 Enterprise），我也看不到任何正在运行的进程或连接到数据库的用户。重新启动服务器（右键单击 Management Studio 中的 Sql Server 并选择重新启动）允许我恢复数据库。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2012-06-12T11:04:08.253

我正在使用 SQL Server 2008 R2，我的数据库已经设置为单用户，并且有一个连接限制了对数据库的任何操作。因此，推荐[的 SQLMenace 的](https://stackoverflow.com/a/11624/1451048)解决方案以错误响应。[这是在我的情况下工作的一个](http://blog.tech-cats.com/2008/01/kill-all-database-connections-to-sql.html)。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-05-07T09:42:40.280

我使用 sp_who 来获取数据库中所有进程的列表。这更好，因为您可能想要查看要终止的进程。

```
declare @proc table(
    SPID bigint,
    Status nvarchar(255),
    Login nvarchar(255),
    HostName nvarchar(255),
    BlkBy nvarchar(255),
    DBName nvarchar(255),
    Command nvarchar(MAX),
    CPUTime bigint,
    DiskIO bigint,
    LastBatch nvarchar(255),
    ProgramName nvarchar(255),
    SPID2 bigint,
    REQUESTID bigint
)

insert into @proc
exec sp_who2

select  *, KillCommand = concat('kill ', SPID, ';')
from    @proc 
```

**结果**
您可以使用 KillCommand 列中的命令来终止您想要的进程。

```
SPID    KillCommand
26      kill 26;
27      kill 27;
28      kill 28; 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2014-06-02T09:58:11.040

您可以使用 SP_Who 命令并杀死所有使用您的数据库的进程，然后重命名您的数据库。

# c# - C# 和 VB.NET 之间最重要的功能差异是什么？

> ID：11632
> 
> 赞同：33
> 
> 时间：2008-08-14T19:59:40.090
> 
> 标签：c#, vb.net, comparison

当然，一般语法存在差异，但还存在哪些其他关键区别？有*一些*不同，对吧？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-08-14T20:23:55.457

链接的比较非常彻底，但就主要区别而言，我会注意到以下几点：

*   ~~C# 有匿名方法~~VB 现在也有这些
*   ~~C#有yield关键字（迭代器块）~~ VB11添加了这个
*   VB 支持[隐式后期绑定](http://smartypeeps.blogspot.com/2006/06/late-binding-in-c-and-vbnet.html)（C# 现在通过 dynamic 关键字有显式后期绑定）
*   VB 支持 XML 文字
*   VB 不区分大小写
*   更多开箱即用的 VB 代码片段
*   ~~更多适用于 C# 的现成重构工具~~Visual Studio 2015 现在为 VB 和 C# 提供相同的重构工具。

一般来说，MS 关注的内容各不相同，因为这两种语言的目标受众非常不同。[这篇博](http://blogs.msdn.com/ericlippert/archive/2004/03/02/cargo-cultists-part-three-is-mort-a-cargo-cultist.aspx)文很好地总结了目标受众。确定您所在的受众群体可能是一个好主意，因为这将决定您将从 Microsoft 获得什么样的工具。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-14T20:02:47.197

自从 .Net 2.0 发布以来，这个话题已经有很多面子了。有关可读摘要，请参阅此[Wikipedia](http://en.wikipedia.org/wiki/Comparison_of_C_sharp_and_Visual_Basic_.NET)文章。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-08-15T02:44:56.683

这可能被认为是语法，但 VB.NET 区分大小写*，*而 C# 区分*大小写*。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-14T20:03:21.033

[这](http://www.codeproject.com/KB/dotnet/vbnet_c__difference.aspx)是一个非常全面的参考。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-14T20:23:49.323

由于我假设您可以 google，因此我认为您正在寻找的不是指向更多网站的链接。

我的回答：根据你的开发者的历史来选择。C# 更类似于 JAVA，并且可能类似于 C++。VB.NET 对 VB 程序员来说更容易，但我想这不再是一个真正的问题，因为没有来自旧 VB 的新 .NET 程序员。

我的观点是 VB 比 C# 更高效，似乎它在生产力工具（例如 intelisense）方面总是领先，我会向有人问的人推荐 vb 而不是 c#。当然，知道他更喜欢 c# 的人不会问，而 c# 对他来说可能是正确的选择。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-17T18:21:27.780

尽管 C#3 上的语法糖确实推动了标准的发展，但我必须说 VB.Net 中的一些 Linq to XML 的东西看起来相当不错，并且使得处理复杂的、深度嵌套的 XML 更容易接受。只是一点点。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-17T18:32:08.353

一个明显的区别是它们如何处理扩展方法（Vb.Net 实际上允许 C# 不允许的东西 - 将扩展方法定义为 ref 的类型传递）：http: [//blog.gadodia.net/extension-方法-in-vbnet-and-c/](http://blog.gadodia.net/extension-methods-in-vbnet-and-c/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-14T20:34:32.283

除了语法之外没有那么多了。它们都编译为完全相同的 IL，因此您可以将某些内容编译为 VB 并将其反映到 C# 中。

大多数明显的差异是语法糖。例如，VB 似乎支持动态类型，但实际上它们与 C# 一样是静态的——VB 编译器会识别它们。

Visual Studio 使用 VB 的行为与使用 C# 不同 - 它隐藏了许多功能，但添加了后台编译（非常适合小型项目，大型项目占用资源）和更好的代码段支持。

随着 C#3 中越来越多的编译器“魔术”，VB.Net 确实落后了。VB 现在唯一有 C# 没有的就是`handles`关键字——这是有争议的好处。

@Tom - 这真的很有用，但有点过时了 - VB.Net 现在也支持 XML 文档`'''`

@Luke - VB.Net 仍然没有匿名方法，但现在支持 lambdas。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-08-26T20:27:49.543

在我看来，最大的不同是能够用 C# 编写不安全的代码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-12-20T20:58:55.510

虽然 VB.NET 支持 try...catch 类型的异常处理，但它还是有一些类似于 VB6 的 ON ERROR 的东西。ON ERROR 可能会被严重滥用，在绝大多数情况下，try...catch 要好得多；但是在处理 COM 超时操作时，ON ERROR 可能很有用，其中可以捕获、解码错误，并且最后的“重试”是简单的一行。你可以用 try...catch 做同样的事情，但代码更混乱。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-01-14T07:01:43.293

该主题在 wikipedia 和 harding 中有简要描述。

[http://en.wikipedia.org/wiki/Comparison_of_C_Sharp_and_Visual_Basic_.NET](http://en.wikipedia.org/wiki/Comparison_of_C_Sharp_and_Visual_Basic_.NET) http://www.harding.edu/fmccown/vbnet_csharp_comparison.html

只是通过并做你的笔记。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-15T04:18:07.557

当它到达 IL 时，它只是位。这种不区分大小写只是预编译器通过。但普遍的共识是，vb 更冗长。如果您可以编写 c#，为什么不节省您的眼睛和双手，并编写更少量的代码来做同样的事情。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-17T18:30:56.653

一个明显的区别是它们如何处理扩展方法（Vb.Net 实际上允许 C# 不允许的东西 - 将扩展方法定义为 ref 的类型传递）：http: [//blog.gadodia.net/extension-方法-in-vbnet-and-c/](http://blog.gadodia.net/extension-methods-in-vbnet-and-c/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-01-03T02:10:09.283

是的，VB.NET 修复了大部分 VB6 问题，并使其成为一种适当的 OOP 语言——即。与 C# 的能力相似。虽然我更喜欢 C#，但我确实发现旧的 VB ON ERROR 构造对于处理 COM 互操作超时很有用。不过要明智地使用一些东西 - ON ERROR 很容易被滥用！

# c++ - C ++中不区分大小写的字符串比较

> ID：11635
> 
> 赞同：372
> 
> 时间：2008-08-14T20:01:28.497
> 
> 标签：c++, string

在 C++ 中进行不区分大小写的字符串比较而不将字符串转换为全部大写或全部小写的最佳方法是什么？

请说明这些方法是否对 Unicode 友好以及它们的可移植性。

* * *

## 回答 #1

> 赞同：325
> 
> 时间：2008-11-24T21:03:58.740

Boost 包括一个方便的算法：

```
#include <boost/algorithm/string.hpp>
// Or, for fewer header dependencies:
//#include <boost/algorithm/string/predicate.hpp>

std::string str1 = "hello, world!";
std::string str2 = "HELLO, WORLD!";

if (boost::iequals(str1, str2))
{
    // Strings are identical
} 
```

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2010-05-22T01:36:53.010

利用标准`char_traits`。回想一下，a`std::string`实际上是 的类型`std::basic_string<char>`定义，或者更明确地说，`std::basic_string<char, std::char_traits<char> >`。该`char_traits`类型描述了字符如何比较、它们如何复制、它们如何转换等。您需要做的就是在 上键入一个新字符串`basic_string`，并为其提供您自己的`char_traits`不区分大小写比较的自定义。

```
struct ci_char_traits : public char_traits<char> {
    static bool eq(char c1, char c2) { return toupper(c1) == toupper(c2); }
    static bool ne(char c1, char c2) { return toupper(c1) != toupper(c2); }
    static bool lt(char c1, char c2) { return toupper(c1) <  toupper(c2); }
    static int compare(const char* s1, const char* s2, size_t n) {
        while( n-- != 0 ) {
            if( toupper(*s1) < toupper(*s2) ) return -1;
            if( toupper(*s1) > toupper(*s2) ) return 1;
            ++s1; ++s2;
        }
        return 0;
    }
    static const char* find(const char* s, int n, char a) {
        while( n-- > 0 && toupper(*s) != toupper(a) ) {
            ++s;
        }
        return s;
    }
};

typedef std::basic_string<char, ci_char_traits> ci_string; 
```

详细信息在[第 29 周的 Guru 上](http://www.gotw.ca/gotw/029.htm)。

* * *

## 回答 #3

> 赞同：111
> 
> 时间：2010-11-07T21:49:17.233

boost的问题在于你必须与boost链接并依赖boost。在某些情况下并不容易（例如android）。

使用 char_traits 意味着您的*所有*比较都不区分大小写，这通常不是您想要的。

这应该足够了。它应该是相当有效的。不处理 unicode 或任何东西。

```
bool iequals(const string& a, const string& b)
{
    unsigned int sz = a.size();
    if (b.size() != sz)
        return false;
    for (unsigned int i = 0; i < sz; ++i)
        if (tolower(a[i]) != tolower(b[i]))
            return false;
    return true;
} 
```

更新：奖励 C++14 版本（`#include <algorithm>`）：

```
bool iequals(const string& a, const string& b)
{
    return std::equal(a.begin(), a.end(),
                      b.begin(), b.end(),
                      [](char a, char b) {
                          return tolower(a) == tolower(b);
                      });
} 
```

* * *

更新：C++20 版本使用`std::ranges`：

```
#include <ranges>
#include <algorithm>
#include <string>

bool iequals(const std::string_view& lhs, const std::string_view& rhs) {
    auto to_lower{ std::ranges::views::transform(std::tolower) };
    return std::ranges::equal(lhs | to_lower, rhs | to_lower);
} 
```

* * *

## 回答 #4

> 赞同：60
> 
> 时间：2008-08-14T20:46:03.803

如果您在 POSIX 系统上，则可以使用[strcasecmp](http://www.opengroup.org/onlinepubs/009695399/functions/strcasecmp.html)。但是，此函数不是标准 C 的一部分，在 Windows 上也不可用。只要语言环境是 POSIX，这将对 8 位字符执行不区分大小写的比较。如果语言环境不是 POSIX，则结果未定义（因此它可能会进行本地化比较，也可能不会）。没有等效的宽字符。

如果做不到这一点，大量历史 C 库实现都具有函数 stricmp() 和 strnicmp()。Windows 上的 Visual C++ 通过在它们前面加上下划线来重命名所有这些，因为它们不是 ANSI 标准的一部分，因此在该系统上它们被称为[_stricmp 或 _strnicmp](http://msdn.microsoft.com/en-us/library/k59z8dwe.aspx)。一些库还可能具有宽字符或多字节等效函数（通常命名为例如 wcsicmp、mbcsicmp 等）。

C 和 C++ 在很大程度上都对国际化问题一无所知，所以除了使用第三方库外，没有很好的解决方案。如果您需要一个健壮的 C/C++ 库，请查看[IBM ICU（Unicode 国际组件） 。](http://www.icu-project.org/)ICU 适用于 Windows 和 Unix 系统。

* * *

## 回答 #5

> 赞同：55
> 
> 时间：2008-08-14T20:31:35.300

您是在谈论不区分大小写的愚蠢比较还是完全规范化的 Unicode 比较？

愚蠢的比较不会找到可能相同但二进制不相等的字符串。

例子：

```
U212B (ANGSTROM SIGN)
U0041 (LATIN CAPITAL LETTER A) + U030A (COMBINING RING ABOVE)
U00C5 (LATIN CAPITAL LETTER A WITH RING ABOVE). 
```

都是等价的，但它们也有不同的二进制表示。

也就是说，[Unicode 规范化](http://unicode.org/reports/tr15/)应该是必读的，特别是如果您计划支持韩文、泰文和其他亚洲语言。

此外，IBM 几乎为最优化的 Unicode 算法申请了专利，并将其公开发布。他们还维护一个实现：[IBM ICU](http://site.icu-project.org/)

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2008-08-26T11:51:28.737

我对非 unicode 版本的第一个想法是做这样的事情：

```
bool caseInsensitiveStringCompare(const string& str1, const string& str2) {
    if (str1.size() != str2.size()) {
        return false;
    }
    for (string::const_iterator c1 = str1.begin(), c2 = str2.begin(); c1 != str1.end(); ++c1, ++c2) {
        if (tolower(static_cast<unsigned char>(*c1)) != tolower(static_cast<unsigned char>(*c2))) {
            return false;
        }
    }
    return true;
} 
```

* * *

## 回答 #7

> 赞同：32
> 
> 时间：2012-04-26T08:51:29.660

boost::iequals 在字符串的情况下不兼容 utf-8。您可以使用[boost::locale](http://www.boost.org/doc/libs/1_49_0/libs/locale/doc/html/index.html)。

```
comparator<char,collator_base::secondary> cmpr;
cout << (cmpr(str1, str2) ? "str1 < str2" : "str1 >= str2") << endl; 
```

*   主要的——忽略重音和字符大小写，只比较基本字母。例如，“facade”和“Façade”是相同的。
*   次要的——忽略字符大小写但考虑重音。“立面”和“立面”是不同的，但“立面”和“立面”是相同的。
*   第三——考虑大小写和重音：“Façade”和“façade”是不同的。忽略标点符号。
*   Quaternary - 考虑所有大小写、重音符号和标点符号。就 Unicode 表示而言，这些词必须相同。
*   相同 - 作为四元，但也比较代码点。

* * *

## 回答 #8

> 赞同：26
> 
> 时间：2008-12-02T00:51:17.953

您可以`strcasecmp`在 Unix 或`stricmp`Windows 上使用。

到目前为止还没有提到的一件事是，如果您将 stl 字符串与这些方法一起使用，首先比较两个字符串的长度很有用，因为您已经可以在字符串类中获得这些信息。如果您要比较的两个字符串一开始的长度甚至不同，这可以防止进行代价高昂的字符串比较。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-08-14T20:35:17.180

我正在尝试从所有帖子中拼凑出一个好的答案，所以请帮我编辑一下：

这是一种执行此操作的方法，虽然它确实转换了字符串，并且对 Unicode 不友好，但它应该是可移植的，这是一个优点：

```
bool caseInsensitiveStringCompare( const std::string& str1, const std::string& str2 ) {
    std::string str1Cpy( str1 );
    std::string str2Cpy( str2 );
    std::transform( str1Cpy.begin(), str1Cpy.end(), str1Cpy.begin(), ::tolower );
    std::transform( str2Cpy.begin(), str2Cpy.end(), str2Cpy.begin(), ::tolower );
    return ( str1Cpy == str2Cpy );
} 
```

根据我的阅读，这比 stricmp() 更便携，因为 stricmp() 实际上不是 std 库的一部分，而是仅由大多数编译器供应商实现。

要获得真正对 Unicode 友好的实现，您似乎必须走出 std 库。一个很好的第三方库是[IBM ICU（Unicode 的国际组件）](http://www.icu-project.org/)

**boost::iequals**也为进行这种比较提供了相当好的实用程序。

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2008-08-14T20:11:48.070

支持 unicode 的 Visual C++ 字符串函数：http: [//msdn.microsoft.com/en-us/library/cc194799.aspx](http://msdn.microsoft.com/en-us/library/cc194799.aspx)

您可能正在寻找的那个是`_wcsnicmp`

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2015-09-16T21:54:51.137

见[`std::lexicographical_compare`](http://www.cplusplus.com/reference/algorithm/lexicographical_compare/)：

```
// lexicographical_compare example
#include <iostream>  // std::cout, std::boolalpha
#include <algorithm>  // std::lexicographical_compare
#include <cctype>  // std::tolower

// a case-insensitive comparison function:
bool mycomp (char c1, char c2) {
    return std::tolower(c1) < std::tolower(c2);
}

int main () {
    char foo[] = "Apple";
    char bar[] = "apartment";

    std::cout << std::boolalpha;

    std::cout << "Comparing foo and bar lexicographically (foo < bar):\n";

    std::cout << "Using default comparison (operator<): ";
    std::cout << std::lexicographical_compare(foo, foo + 5, bar, bar + 9);
    std::cout << '\n';

    std::cout << "Using mycomp as comparison object: ";
    std::cout << std::lexicographical_compare(foo, foo + 5, bar, bar + 9, mycomp);
    std::cout << '\n';

    return 0;
} 
```

[演示](http://coliru.stacked-crooked.com/a/d38d82d1255c8f71)

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2017-04-05T09:18:49.980

```
str1.size() == str2.size() && std::equal(str1.begin(), str1.end(), str2.begin(), [](auto a, auto b){return std::tolower(a)==std::tolower(b);}) 
```

如果您无法使用 boost，则可以在 C++14 中使用上述代码。你必须使用`std::towlower`宽字符。

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2008-08-14T20:29:24.867

仅供参考，`strcmp()`并且`stricmp()`容易受到缓冲区溢出的影响，因为它们只会处理直到遇到空终止符。使用`_strncmp()`和更安全[`_strnicmp()`](http://msdn.microsoft.com/en-us/library/chd90w8e(VS.80).aspx)。

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2016-09-30T15:51:56.657

简短而美好。*除了扩展*的标准 C 库之外，没有其他依赖项。

```
strcasecmp(str1.c_str(), str2.c_str()) == 0 
```

如果和相等 则返回**真。**可能不存在，可能有类似物,等。`str1``str2``strcasecmp``stricmp``strcmpi`

示例代码：

```
#include <iostream>
#include <string>
#include <string.h> //For strcasecmp(). Also could be found in <mem.h>

using namespace std;

/// Simple wrapper
inline bool str_ignoreCase_cmp(std::string const& s1, std::string const& s2) {
    if(s1.length() != s2.length())
        return false;  // optimization since std::string holds length in variable.
    return strcasecmp(s1.c_str(), s2.c_str()) == 0;
}

/// Function object - comparator
struct StringCaseInsensetiveCompare {
    bool operator()(std::string const& s1, std::string const& s2) {
        if(s1.length() != s2.length())
            return false;  // optimization since std::string holds length in variable.
        return strcasecmp(s1.c_str(), s2.c_str()) == 0;
    }
    bool operator()(const char *s1, const char * s2){ 
        return strcasecmp(s1,s2)==0;
    }
};

/// Convert bool to string
inline char const* bool2str(bool b){ return b?"true":"false"; }

int main()
{
    cout<< bool2str(strcasecmp("asd","AsD")==0) <<endl;
    cout<< bool2str(strcasecmp(string{"aasd"}.c_str(),string{"AasD"}.c_str())==0) <<endl;
    StringCaseInsensetiveCompare cmp;
    cout<< bool2str(cmp("A","a")) <<endl;
    cout<< bool2str(cmp(string{"Aaaa"},string{"aaaA"})) <<endl;
    cout<< bool2str(str_ignoreCase_cmp(string{"Aaaa"},string{"aaaA"})) <<endl;
    return 0;
} 
```

输出：

```
true
true
true
true
true 
```

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2010-05-22T00:57:43.227

[Boost.String](http://www.boost.org/doc/libs/1_43_0/doc/html/string_algo.html)库有很多算法可以进行不区分大小写的比较等等。

您可以实现自己的，但既然已经完成了，为什么还要麻烦呢？

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2013-06-26T21:29:22.863

对于我基本的不区分大小写的字符串比较需求，我不希望使用外部库，也不希望使用与所有其他字符串不兼容的不区分大小写特征的单独字符串类。

所以我想出的是：

```
bool icasecmp(const string& l, const string& r)
{
    return l.size() == r.size()
        && equal(l.cbegin(), l.cend(), r.cbegin(),
            [](string::value_type l1, string::value_type r1)
                { return toupper(l1) == toupper(r1); });
}

bool icasecmp(const wstring& l, const wstring& r)
{
    return l.size() == r.size()
        && equal(l.cbegin(), l.cend(), r.cbegin(),
            [](wstring::value_type l1, wstring::value_type r1)
                { return towupper(l1) == towupper(r1); });
} 
```

一个简单的函数，一个重载用于 char，另一个用于重载 whar_t。不使用任何非标准的东西，所以在任何平台上都应该没问题。

相等比较不会考虑可变长度编码和 Unicode 规范化等问题，但 basic_string 不支持我知道的那些问题，这通常不是问题。

如果需要对文本进行更复杂的字典操作，那么您只需使用像 Boost 这样的第三方库，这是意料之中的。

* * *

## 回答 #17

> 赞同：9
> 
> 时间：2016-01-12T09:08:49.330

在不使用 Boost 的情况下执行此操作可以通过使用`c_str()`和使用获取 C 字符串指针来完成`strcasecmp`：

```
std::string str1 ="aBcD";
std::string str2 = "AbCd";;
if (strcasecmp(str1.c_str(), str2.c_str()) == 0)
{
    //case insensitive equal 
} 
```

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2008-08-14T20:10:37.807

假设您正在寻找一种方法而不是已经存在的魔术功能，坦率地说，没有更好的方法。我们都可以为有限的字符集编写带有巧妙技巧的代码片段，但在一天结束时，您必须转换字符。

这种转换的最佳方法是在比较之前进行。当涉及到编码方案时，这为您提供了很大的灵活性，您的实际比较运算符应该不知道。

您当然可以在您自己的字符串函数或类后面“隐藏”这种转换，但您仍然需要在比较之前转换字符串。

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2008-11-17T23:32:10.440

我编写了一个不区分大小写的 char_traits 版本，用于 std::basic_string 以便在使用内置的 std::basic_string 成员函数进行比较、搜索等时生成一个不区分大小写的 std::string。

所以换句话说，我想做这样的事情。

```
std::string a = "Hello, World!";
std::string b = "hello, world!";

assert( a == b ); 
```

... std::string 无法处理。这是我的新 char_traits 的用法：

```
std::istring a = "Hello, World!";
std::istring b = "hello, world!";

assert( a == b ); 
```

...这是实现：

```
/*  ---

        Case-Insensitive char_traits for std::string's

        Use:

            To declare a std::string which preserves case but ignores case in comparisons & search,
            use the following syntax:

                std::basic_string<char, char_traits_nocase<char> > noCaseString;

            A typedef is declared below which simplifies this use for chars:

                typedef std::basic_string<char, char_traits_nocase<char> > istring;

    --- */

    template<class C>
    struct char_traits_nocase : public std::char_traits<C>
    {
        static bool eq( const C& c1, const C& c2 )
        { 
            return ::toupper(c1) == ::toupper(c2); 
        }

        static bool lt( const C& c1, const C& c2 )
        { 
            return ::toupper(c1) < ::toupper(c2);
        }

        static int compare( const C* s1, const C* s2, size_t N )
        {
            return _strnicmp(s1, s2, N);
        }

        static const char* find( const C* s, size_t N, const C& a )
        {
            for( size_t i=0 ; i<N ; ++i )
            {
                if( ::toupper(s[i]) == ::toupper(a) ) 
                    return s+i ;
            }
            return 0 ;
        }

        static bool eq_int_type( const int_type& c1, const int_type& c2 )
        { 
            return ::toupper(c1) == ::toupper(c2) ; 
        }       
    };

    template<>
    struct char_traits_nocase<wchar_t> : public std::char_traits<wchar_t>
    {
        static bool eq( const wchar_t& c1, const wchar_t& c2 )
        { 
            return ::towupper(c1) == ::towupper(c2); 
        }

        static bool lt( const wchar_t& c1, const wchar_t& c2 )
        { 
            return ::towupper(c1) < ::towupper(c2);
        }

        static int compare( const wchar_t* s1, const wchar_t* s2, size_t N )
        {
            return _wcsnicmp(s1, s2, N);
        }

        static const wchar_t* find( const wchar_t* s, size_t N, const wchar_t& a )
        {
            for( size_t i=0 ; i<N ; ++i )
            {
                if( ::towupper(s[i]) == ::towupper(a) ) 
                    return s+i ;
            }
            return 0 ;
        }

        static bool eq_int_type( const int_type& c1, const int_type& c2 )
        { 
            return ::towupper(c1) == ::towupper(c2) ; 
        }       
    };

    typedef std::basic_string<char, char_traits_nocase<char> > istring;
    typedef std::basic_string<wchar_t, char_traits_nocase<wchar_t> > iwstring; 
```

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2008-08-14T20:29:47.707

我在使用[Unicode 库的国际组件](http://icu-project.org/userguide/)方面有很好的经验——它们非常强大，并提供了转换方法、语言环境支持、日期和时间渲染、大小写映射（您似乎不想要）和[排序规则](http://icu-project.org/userguide/Collate_Intro.html)，其中包括不区分大小写和重音的比较（等等）。我只使用了 C++ 版本的库，但它们似乎也有 Java 版本。

存在执行@Coincoin 所指的标准化比较的方法，甚至可以考虑语言环境 - 例如（这是一个排序示例，不是严格相等），传统上在西班牙语中（在西班牙），字母组合“ll”在“l”和“m”，所以“lz”<“ll”<“ma”。

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2013-07-25T18:47:35.253

仅`strcmp()`用于区分大小写和`strcmpi()`/或`stricmp()`不区分大小写的比较。两者都在头文件中`<string.h>`

**格式：**

```
int strcmp(const char*,const char*);    //for case sensitive
int strcmpi(const char*,const char*);   //for case insensitive 
```

**用法：**

```
string a="apple",b="ApPlE",c="ball";
if(strcmpi(a.c_str(),b.c_str())==0)      //(if it is a match it will return 0)
    cout<<a<<" and "<<b<<" are the same"<<"\n";
if(strcmpi(a.c_str(),b.c_str()<0)
    cout<<a[0]<<" comes before ball "<<b[0]<<", so "<<a<<" comes before "<<b; 
```

**输出**

*苹果和苹果是一样的*

*a在b之前，所以apple在ball之前*

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2015-09-29T00:25:21.060

迟到了，但这是一个使用 的变体，`std::locale`因此可以正确处理土耳其语：

```
auto tolower = std::bind1st(
    std::mem_fun(
        &std::ctype<char>::tolower),
    &std::use_facet<std::ctype<char> >(
        std::locale())); 
```

为您提供了一个仿函数，它使用活动区域设置将字符转换为小写，然后您可以使用它`std::transform`来生成小写字符串：

```
std::string left = "fOo";
transform(left.begin(), left.end(), left.begin(), tolower); 
```

这也适用于`wchar_t`基于字符串。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2008-11-25T07:26:28.140

只需说明您最终选择的任何方法，如果该方法恰好包括使用`strcmp`一些答案建议的方法：

`strcmp`通常不适用于 Unicode 数据。一般来说，它甚至不适用于基于字节的 Unicode 编码，例如 utf-8，因为`strcmp`只能进行逐字节比较，而 utf-8 编码的 Unicode 代码点可能占用超过 1 个字节。唯一正确处理的特定 Unicode 情况`strcmp`是，当使用基于字节的编码编码的字符串仅包含低于 U+00FF 的代码点时——那么逐字节比较就足够了。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2013-04-01T17:58:52.253

截至 2013 年初，由 IBM 维护的 ICU 项目是一个很好的答案。

[http://site.icu-project.org/](http://site.icu-project.org/)

ICU 是一个“完整的、可移植的 Unicode 库，密切跟踪行业标准”。对于字符串比较的具体问题，Collat​​ion 对象为所欲为。

Mozilla 项目于 2012 年年中在 Firefox 中采用 ICU 进行国际化；您可以在此处跟踪工程讨论，包括构建系统和数据文件大小的问题：

*   [https://groups.google.com/forum/#!topic/mozilla.dev.platform/sVVpS2sKODw](https://groups.google.com/forum/#!topic/mozilla.dev.platform/sVVpS2sKODw)
*   [https://bugzilla.mozilla.org/show_bug.cgi?id=724529](https://bugzilla.mozilla.org/show_bug.cgi?id=724529)（跟踪器）
*   [https://bugzilla.mozilla.org/show_bug.cgi?id=724531](https://bugzilla.mozilla.org/show_bug.cgi?id=724531)（构建系统）

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2017-08-26T19:57:43.683

看起来上面的解决方案没有使用 compare 方法并再次实现 total 所以这是我的解决方案，希望它对你有用（它工作正常）。

```
#include<iostream>
#include<cstring>
#include<cmath>
using namespace std;
string tolow(string a)
{
    for(unsigned int i=0;i<a.length();i++)
    {
        a[i]=tolower(a[i]);
    }
    return a;
}
int main()
{
    string str1,str2;
    cin>>str1>>str2;
    int temp=tolow(str1).compare(tolow(str2));
    if(temp>0)
        cout<<1;
    else if(temp==0)
        cout<<0;
    else
        cout<<-1;
} 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2018-04-18T09:33:57.343

在 C++ 中比较两个字符串（针对 Windows 测试）的一种简单方法是使用**_stricmp**

```
// Case insensitive (could use equivalent _stricmp)  
result = _stricmp( string1, string2 ); 
```

如果您希望与 std::string 一起使用，例如：

```
std::string s1 = string("Hello");
if ( _stricmp(s1.c_str(), "HELLO") == 0)
   std::cout << "The string are equals."; 
```

在此处了解更多信息：[https ://msdn.microsoft.com/it-it/library/e0z9k731.aspx](https://msdn.microsoft.com/it-it/library/e0z9k731.aspx)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2018-04-26T21:40:34.990

如果您不想使用**Boost 库**，那么这里是仅使用 C++ 标准 io 标头的解决方案。

```
#include <iostream>

struct iequal
{
    bool operator()(int c1, int c2) const
    {
        // case insensitive comparison of two characters.
        return std::toupper(c1) == std::toupper(c2);
    }
};

bool iequals(const std::string& str1, const std::string& str2)
{
    // use std::equal() to compare range of characters using the functor above.
    return std::equal(str1.begin(), str1.end(), str2.begin(), iequal());
}

int main(void)
{
    std::string str_1 = "HELLO";
    std::string str_2 = "hello";

    if(iequals(str_1,str_2))
    {
        std::cout<<"String are equal"<<std::endl;   
    }

    else
    {
        std::cout<<"String are not equal"<<std::endl;
    }

    return 0;
} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-03-06T13:55:25.730

如果您必须更频繁地将源字符串与其他字符串进行比较，那么一种优雅的解决方案是使用正则表达式。

```
std::wstring first = L"Test";
std::wstring second = L"TEST";

std::wregex pattern(first, std::wregex::icase);
bool isEqual = std::regex_match(second, pattern); 
```

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2015-03-05T02:40:46.587

```
bool insensitive_c_compare(char A, char B){
  static char mid_c = ('Z' + 'a') / 2 + 'Z';
  static char up2lo = 'A' - 'a'; /// the offset between upper and lowers

  if ('a' >= A and A >= 'z' or 'A' >= A and 'Z' >= A)
      if ('a' >= B and B >= 'z' or 'A' >= B and 'Z' >= B)
      /// check that the character is infact a letter
      /// (trying to turn a 3 into an E would not be pretty!)
      {
        if (A > mid_c and B > mid_c or A < mid_c and B < mid_c)
        {
          return A == B;
        }
        else
        {
          if (A > mid_c)
            A = A - 'a' + 'A'; 
          if (B > mid_c)/// convert all uppercase letters to a lowercase ones
            B = B - 'a' + 'A';
          /// this could be changed to B = B + up2lo;
          return A == B;
        }
      }
} 
```

这可能会变得更有效率，但这是一个笨重的版本，它的所有部分都是裸露的。

不是那么便携，但适用于我电脑上的任何东西（不知道，我是图片而不是文字）

* * *

## 回答 #30

> 赞同：-4
> 
> 时间：2015-05-12T14:17:42.140

比较仅小写和大写字符不同的字符串的一种简单方法是进行 ascii 比较。所有大写和小写字母在 ascii 表中相差 32 位，使用此信息我们有以下...

```
 for( int i = 0; i < string2.length(); i++)
    {
       if (string1[i] == string2[i] || int(string1[i]) == int(string2[j])+32 ||int(string1[i]) == int(string2[i])-32) 
    {
      count++;
      continue;
    }
    else 
    {
      break;
    }
    if(count == string2.length())
    {
      //then we have a match
    }
} 
```

# apache-flex - 如何重新设置 Adob e Flex Accordion 的样式以在每个画布标题中包含一个按钮？

> ID：11665
> 
> 赞同：2
> 
> 时间：2008-08-14T20:25:07.840
> 
> 标签：apache-flex, actionscript-3

这是我的手风琴的示例代码：

```
<mx:Accordion x="15" y="15" width="230" height="599" styleName="myAccordion">
    <mx:Canvas id="pnlSpotlight" label="SPOTLIGHT" height="100%" width="100%" horizontalScrollPolicy="off">
        <mx:VBox width="100%" height="80%" paddingTop="2" paddingBottom="1"  verticalGap="1">
            <mx:Repeater id="rptrSpotlight" dataProvider="{aSpotlight}">            
                <sm:SmallCourseListItem 
                    viewClick="PlayFile(event.currentTarget.getRepeaterItem().fileID);"
                    Description="{rptrSpotlight.currentItem.fileDescription}"
                    FileID = "{rptrSpotlight.currentItem.fileID}"   
                    detailsClick="{detailsView.SetFile(event.currentTarget.getRepeaterItem().fileID,this)}" 
                    Title="{rptrSpotlight.currentItem.fileTitle}"
                    FileIcon="{iconLibrary.getIcon(rptrSpotlight.currentItem.fileExtension)}" />
            </mx:Repeater>
        </mx:VBox>
    </mx:Canvas>
</mx:Accordion> 
```

我想在每个标题中包含一个按钮，如下所示：

![如意](../Images/198c35e76135499c71b3ff6be3c68d26.png)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-15T14:47:51.863

谢谢，我使用[FlexLib](http://code.google.com/p/flexlib/)的 CanvasButtonAccordionHeader 让它工作了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T14:00:53.270

您必须创建一个自定义标题渲染器，向其中添加一个按钮并手动定位它。尝试这样的事情：

```
<mx:Accordion>
    <mx:headerRenderer>
        <mx:Component>
            <AccordionHeader xmlns="mx.containers.accordionClasses.*">
                <mx:Script>
                <![CDATA[

                import mx.controls.Button;

                private var extraButton : Button;

                override protected function createChildren( ) : void {
                    super.createChildren();

                    if ( extraButton == null ) {
                        extraButton = new Button();

                        addChild(extraButton);
                    }
                }

                override protected function updateDisplayList( unscaledWidth : Number, unscaledHeight : Number ) : void {
                    super.updateDisplayList(unscaledWidth, unscaledHeight);

                    extraButton.setActualSize(unscaledHeight - 6, unscaledHeight - 6);
                    extraButton.move(unscaledWidth - extraButton.width - 3, (unscaledHeight - extraButton.height)/2);
                }

                ]]>
                </mx:Script>
            </AccordionHeader>
        </mx:Component>
    </mx:headerRenderer>

    <mx:HBox label="1"><Label text="Text 1"/></HBox>
    <mx:HBox label="1"><Label text="Text 2"/></HBox>
    <mx:HBox label="1"><Label text="Text 3"/></HBox>
</mx:Accordion> 
```

# sharepoint - 为 SharePoint 创建开发环境

> ID：11676
> 
> 赞同：5
> 
> 时间：2008-08-14T20:34:07.727
> 
> 标签：sharepoint

我已经很多年没有碰过sharepoint了。如果我想设置一个开发环境以加快速度，我有哪些选择？我没有 MSDN 许可证，无论如何我可以免费启动和运行吗？（仅用于开发）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-14T20:49:08.633

你**需要**一个 Windows 2003 Server（或 2008 Server，但我没有这方面的经验），没有办法。如果这是您的目标，您当然可以使用 Visual C# 2005 Express 和 SHarepoint Services 3.0。

如果您想在 Sharepoint 2007 上进行开发，您必须购买 Sharepoint 2007 许可证，该许可证附带相当高的费用。

作为 SQL，SQL 2005 Express 非常适合开发。

有一篇很好的文章如何在单个服务器上设置 Sharepoint：

[http://blogs.msdn.com/martinearn/archive/2007/03/28/how-to-install-sharepoint-server-2007-on-a-single-machine.aspx](http://blogs.msdn.com/martinkearn/archive/2007/03/28/how-to-install-sharepoint-server-2007-on-a-single-machine.aspx)

您可以使用 Windows 2003 和 Sharepoint 2007 的试用版，但如果它只在有限的时间内需要（我相信试用版会运行 180 天）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-14T20:43:58.410

您无法免费获得 MOSS 2007/WSS 3.0 开发，但[Microsoft Action Pact](https://partner.microsoft.com/40016455)的价格非常便宜。:)

有一篇不错的博客可供阅读，以了解获取完整 MOSS 2007 映像的要求和步骤：[如何创建 MOSS 2007 VPC 映像：整个 9 码](http://www.pptspaces.com/sharepointreporterblog/Lists/Posts/Post.aspx?ID=28)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-24T04:16:11.063

该操作包物超所值，您可以从中使用 Windows Server 以及 SharePoint Enterprise/Standard。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-24T05:28:13.077

如果您只是（重新）开始进行 SharePoint 开发，那么仅使用 WSS 3.0 而不是（尚未）使用 MOSS 2007 会有很多价值。基本词汇在开发级别将完全相同，并且你可以完成大量的工作，而不会觉得你需要 MOSS 来学习。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-24T22:32:53.270

[您可以随时在此处](http://www.microsoft.com/downloads/details.aspx?FamilyID=67f93dcb-ada8-4db5-a47b-df17e14b2c74&displaylang=en)下载 Sharepoint 试用 VM ，然后安装 Visual Studio 的[快速版本](http://www.microsoft.com/Express/)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T21:55:28.463

您可以从 Microsoft 下载 Office SharePoint Server VHD。这允许您使用虚拟服务器在您的个人计算机上运行虚拟 Windows Server 和 SharePoint Server。

我最近经历了这个过程并写了一篇博客文章，描述[了如何设置虚拟 Office SharePoint Server](http://blogs.telerik.com/GabeSumner/Posts/08-09-24/Exploring_Office_SharePoint_Server_using_only_your_Machine.aspx)。

# design-patterns - 解析二进制文件数据并存储在数据库中的设计模式

> ID：11680
> 
> 赞同：6
> 
> 时间：2008-08-14T20:36:07.380
> 
> 标签：design-patterns, fileparse

有没有人推荐一种设计模式来获取二进制数据文件，将其部分解析为对象并将结果数据存储到数据库中？

我认为类似的模式可用于获取 XML 或制表符分隔的文件并将其解析为它们的代表对象。

一个常见的数据结构将包括：

> (标题) (DataElement1) (DataElement1SubData1) (DataElement1SubData2)(DataElement2) (DataElement2SubData1) (DataElement2SubData2) (EOF)

我认为一个好的设计将包括一种根据文件类型或标题中包含的一些已定义元数据更改解析定义的方法。因此，[工厂模式](http://www.oodesign.com/factory-method-pattern.html)将成为 Parser 部分整体设计的一部分。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-08-14T21:20:18.213

1.  只需编写您的文件解析器，使用想到的任何技术
2.  为其编写大量单元测试以确保涵盖所有边缘情况

完成此操作后，您实际上将对问题/解决方案有一个合理的想法。

现在你脑子里只有一些理论，其中大部分会被误导。

第 3 步：无情地重构。您的目标应该是删除大约一半的代码

您会发现您的代码最终会类似于现有的设计模式，或者您将创建一个新的设计模式。然后你就有资格回答这个问题:-)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-24T16:03:41.410

我完全同意 Orion Edwards，这通常是我处理问题的方式；但最近我开始看到一些疯狂的模式（！）。

对于更复杂的任务，我通常使用[解释器](http://en.wikipedia.org/wiki/Interpreter_pattern)（或[策略](http://en.wikipedia.org/wiki/Strategy_pattern)）之类的东西，它使用一些[构建器](http://en.wikipedia.org/wiki/Builder_pattern)（或[工厂](http://en.wikipedia.org/wiki/Factory_method_pattern)）来创建数据的每个部分。

对于流数据，整个解析器看起来像一个[适配器](http://en.wikipedia.org/wiki/Adapter_pattern)，从一个流对象适应一个对象流（通常只是一个队列）。

对于您的示例，可能会有一个完整数据结构（从头到 EOF）的构建器，它在内部使用构建器来构建内部数据元素（由解释器提供）。一旦遇到 EOF，就会发出一个对象。

However, objects created in a switch statement in some factory function is probably the simplest way for many lesser tasks. Also, I like keeping my data-objects immutable as you never know when someone shoves concurrency down your throat :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-14T20:37:15.193

策略模式可能是您想要查看的一种。策略是文件解析算法。

然后，您需要一个单独的数据库插入策略。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-26T04:15:37.537

Use [Lex](http://en.wikipedia.org/wiki/Lex_programming_tool) and YACC. Unless you devote the next ten years exclusively to this subject, they will produce better and faster code every time.

# mysql - MySQL是否有任何类型的非文本界面？

> ID：11686
> 
> 赞同：4
> 
> 时间：2008-08-14T20:47:06.860
> 
> 标签：mysql, api

我有一个 MySQL 查询，它返回一个包含单列整数的结果。有没有办法让 MySQL C API 将其作为实际整数而不是 ASCII 文本传输？就此而言，有一种方法可以让 MySQL 执行 /any/ 的 API 内容，而不是 ASCII 文本。我认为这会在 sprintf/sscanf 或其他任何使用的以及带宽方面节省一些时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-14T21:59:12.767

老实说，你可能不走运。查看 MySQL C API ( [http://dev.mysql.com/doc/refman/5.0/en/mysql-fetch-row.html](http://dev.mysql.com/doc/refman/5.0/en/mysql-fetch-row.html) , [http://dev.mysql.com/doc/refman/5.0/en /c-api-datatypes.html](http://dev.mysql.com/doc/refman/5.0/en/c-api-datatypes.html)，看看 MYSQL_ROW）似乎没有一种机制可以返回实际类型的数据……我猜是使用结构的乐趣。

你总是可以实现一个包装器来检查 MYSQL_ROW 的类型属性（[http://dev.mysql.com/doc/refman/5.0/en/c-api-datatypes.html](http://dev.mysql.com/doc/refman/5.0/en/c-api-datatypes.html)）并返回一个 C 联合，但这可能很差建议; 不要那样做。

# architecture - 设计辩论：存储和操作版本化对象的好方法是什么？

> ID：11689
> 
> 赞同：2
> 
> 时间：2008-08-14T20:50:11.847
> 
> 标签：architecture, time, rdbms, versions

我一开始是故意让这个很模糊的。我正在寻找讨论以及哪些问题比我寻找硬性答案更重要。

我正在设计一个执行投资组合管理之类的应用程序。我到目前为止的设计是

*   问题：需要解决的问题
*   解决方案：针对一个或多个问题提出的解决方案
*   关系：两个问题、两个解决方案或一个问题和一个解决方案之间的关系。进一步细分为：
    *   父子 - 某种分类/树层次结构
    *   重叠 - 两个解决方案或两个问题真正解决同一概念的程度
    *   地址 - 问题解决解决方案的程度

我的问题是关于这些事物的时间性质。问题突然出现，然后消失。解决方案有一个预期的解决日期，但在开发过程中可能会进行修改。随着问题和解决方案的发展，关系的程度可能会随着时间而改变。

那么问题来了：对这些东西进行版本控制的最佳设计是什么，这样我就可以同时了解我的投资组合的当前和历史观点？

*后来：也许我应该提出一个更具体的问题，尽管@Eric Beard 的回答值得一提。*

我考虑了三种数据库设计。我将充分展示它们的缺点。我的问题是：选择哪个，或者你能想出更好的东西吗？

## 1：问题（以及单独的解决方案）在版本控制中是自引用的。

```
table problems
  int id | string name | text description | datetime created_at | int previous_version_id

  foreign key previous_version_id -> problems.id 
```

这是有问题的，因为每次我想要一个新版本时，我都必须复制整行，包括那个长`description`列。

## 2：新建关系类型：版本。

```
table problems
  int id | string name | text description | datetime created_at 
```

这只是将关系从问题和解决方案表移动到关系表中。同样的重复问题，但可能有点“干净”，因为我已经有了一个抽象的关系概念。

## 3：使用更类似于Subversion的结构；将所有问题和解决方案属性移动到单独的表中并对其进行版本控制。

```
table problems
  int id

table attributes
  int id | int thing_id | string thing_type | string name | string value | datetime created_at | int previous_version_id

  foreign key (thing_id, thing_type) -> problems.id or solutions.id
  foreign key previous_version_id -> attributes.id 
```

这意味着要加载问题或解决方案的当前版本，我必须获取属性的所有版本，按日期对它们进行排序，然后使用最新版本。那可能并不可怕。对我来说真正糟糕的是我无法在数据库中对这些属性进行类型检查。该`value`列必须是自由文本。我可以将该`name`列作为对具有列的单独`attribute_names`表的引用`type`，但这不会*强制*表中的类型正确`attributes`。

*稍后：回复@Eric Beard 关于多表外键的评论：*

唉，我所描述的很简单：只有两种类型的事物（问题和解决方案）。我实际上有大约 9 或 10 种不同类型的事物，因此在您的策略下我将有 9 或 10 列外键。我想使用单表继承，但事物的共同点太少了，将它们组合到一个表中会*非常浪费。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-14T20:57:36.573

嗯，听起来有点像这个网站...

就数据库设计而言，类似于 SVN 的版本控制系统，您实际上从不进行任何更新，只是在事情发生变化时插入（带有版本号），这可能是您所需要的。这称为 MVCC，多值并发控制。wiki 是另一个很好的例子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T13:22:01.477

@盖乌斯

```
foreign key (thing_id, thing_type) -> problems.id or solutions.id 
```

小心这些“多向”外键。我的经验表明，当您的连接条件必须在确定要连接的表之前检查类型时，查询性能会显着下降。它看起来并不优雅但可以为空

```
problem_id and solution_id 
```

会工作得更好。

当然，当您必须添加检查以获取最新版本的记录时，查询性能也会受到 MVCC 设计的影响。权衡是您永远不必担心更新争用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-18T08:55:54.107

你怎么看这个：

表问题
int id | 字符串名称 | 文字说明 | 日期时间 created_at

表问题
_revisions int 修订 | 内部 ID | 字符串名称 | 文字说明 | datetime created_at
外键 id -> questions.id

在更新之前，您必须在修订表中执行额外的插入。这个额外的插入速度很快，但是，这是你必须支付的

1.  高效访问当前版本 - 像往常一样选择问题
2.  直观且接近您要建模的现实的模式
3.  架构中表之间的连接保持高效
4.  使用每个业务事务的修订号，您可以对表记录进行版本控制，就像 SVN 对文件所做的那样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T14:19:17.320

我想有

## 选项4：混合

将常用事物属性移动到单继承表中，然后添加`custom_attributes`表。这使得外键更简单，减少了重复，并允许灵活性。它没有解决附加属性的类型安全问题。它还增加了一点复杂性，因为现在有两种方式可以让事物具有属性。

但是，如果`description`和其他大字段保留在 Things 表中，它也不能解决重复空间问题。

```
table things
  int id | int type | string name | text description | datetime created_at | other common fields...
  foreign key type -> thing_types.id

table custom_attributes
  int id | int thing_id | string name | string value
  foreign key thing_id -> things.id 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T09:50:35.683

选择一种数据结构是一个好主意，它可以使您对模型提出的常见问题易于回答。大多数时候，您很可能对当前职位感兴趣。有时，您会想要深入了解特定问题和解决方案的历史记录。

我会有代表当前位置的问题、解决方案和关系表。还有一个`problem_history`, `solution_history`, 等表。这些将是问题的子表，但也包含用于`VersionNumber`和的额外列`EffectiveDate`。关键是 ( `ProblemId`, `VersionNumber`)。

当您更新问题时，您会将旧值写入`problem_history`表中。因此，可以进行时间点查询，因为您可以挑选出`problem_history`在特定日期有效的记录。

在我之前做过的地方，我还创建了一个 UNION 视图`problem`，`problem_history`因为这有时在各种查询中很有用。

选项 1 使查询当前情况变得困难，因为您的所有历史数据都与当前数据混合在一起。

Option 3 is going to be bad for query performance and nasty to code against as you'll be accessing lots of rows for what should just be a simple query.

# internet-explorer - 如何在 IE7 中为 IMG ALT 的工具提示正确显示 Unicode 字符？

> ID：11690
> 
> 赞同：6
> 
> 时间：2008-08-14T20:50:31.470
> 
> 标签：internet-explorer, unicode

我在 ALT 属性中有一些日语，但工具提示向我显示了工具提示中丑陋的块字符。页面上的其余内容正确呈现。到目前为止，它似乎仅限于工具提示。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-14T21:04:22.160

这是因为工具提示中使用的字体不包括您要显示的字符。尝试安装包含这些字符的字体包。我担心除了使用 javascript 自己实现工具提示之外，您无法为网站的访问者做太多事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-14T20:56:08.183

我不确定 unicode 问题，但如果你想要工具提示效果，你应该使用 title 属性，而不是 alt。

Alt 用于您希望屏幕阅读器朗读的文本，如果无法加载图像，则会显示该文本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-14T22:43:07.733

你的日语输入来自哪里？可能是它采用非 unicode（例如[http://en.wikipedia.org/wiki/JIS_X_0208](http://en.wikipedia.org/wiki/JIS_X_0208)）编码，而您的文件是 unicode，因此浏览器尝试将非 unicode 字符解释为 unicode 并感到困惑. 我试着拼凑一个例子来重现你的问题：

```
<img src="test.png" alt="日本語" /> 
```

工具提示在安装了日语语言包的 IE7 下正确显示。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-19T21:15:18.990

请注意，alt 属性并非旨在作为工具提示。Alt 用于描述图像本身不可用的图像。如果要使用工具提示，请改用 title 属性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-14T21:21:07.523

您能否清理替代文本以使其中没有字符，最好用有用的东西替换整个文本（而不是仅仅过滤字符串）？这并不理想，但也不会显示损坏的字符，也不会告诉您的用户安装新的字体包。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T00:51:00.780

在 Win2000/WinXP/Vista 上的 IE 和 Firefox 中，通过区域选项安装了日语支持，这可以正常工作。在 Win95/98/ME 上，由于非 NT 系统中 Windows 工具提示控件的限制，它只能在日文操作系统上运行，至少在 IE 上是这样。（关于引导您使用 title 属性的其他答案：与 title 属性应用的行为相同）。

但是，如果您尚未安装语言支持，或者您刚刚将某些字体复制到字体文件夹，则字体链接/字体映射可能不会启动。也有可能您的工具提示的默认字体选择不支持日语，尽管 GDI 字体链接回退应该在 Win2000 或更高版本上启动，除非字体与它支持的字体有关。

“空方格”现象通常暗示字体映射问题，尽管编码错误的可能性很小。

您的用户会说日语吗？在具有日语默认系统区域设置的系统上是否会出现此问题？

# windows-vista - EFS 加密密钥弹出

> ID：11699
> 
> 赞同：14
> 
> 时间：2008-08-14T21:04:11.740
> 
> 标签：windows-vista, encrypting-file-system

我收到通知以在 Vista 中备份我的 EFS 加密密钥，但是我没有启用位锁定器或驱动器加密。

任何人都知道如何找出哪些文件可能被加密或解释为什么它会通知我？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-24T07:24:11.857

要找出系统上的哪些文件已使用 EFS 加密，您只需运行以下命令：

```
CIPHER.EXE /U /N 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-14T22:10:37.720

是的，它是 EFS：

[窗口标题] 加密文件系统

[主要说明] 备份您的文件加密证书和密钥

[内容] 创建此备份文件可帮助您避免在原始证书和密钥丢失或损坏时永久失去对加密文件的访问权限。

[立即备份（推荐）] [稍后备份] [从不备份] [取消]

[Footer] 为什么要备份证书和密钥？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T00:53:11.727

EFS 加密通常是通过“文件属性”对话框的“高级”选项卡实现的，最好在文件夹级别进行。
但是在 Vista 上，我记得在我的新计算机上看到了这条消息，绝对没有加密过单个文件。所以我同意在第一次使用 EFS 之前，要求您备份密钥是令人困惑的。Windows-7 从来没有问过我，所以可能这就是它未来的工作方式。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-01T16:42:54.940

在使用 Windows 7 几个月后，我第一次收到同样的消息。如上所述运行 cipher.exe 显示我下载的字体文件（[Anonymous Pro](http://www.ms-studio.com/FontSales/anonymouspro.html)）设置了加密属性（右键单击文件，属性，常规选项卡，单击高级）。它还具有授予未知帐户读取和执行权限的安全设置。（！）我不知道为什么字体文件会设置加密标志。

如果您突然收到此消息，则可能是对您刚刚下载的内容的响应。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-14T21:17:27.750

Clippy 注意到您的文件中有敏感信息并自动对其进行加密。

你确定是EFS吗？我之前有一些事情提示我备份我的密钥，但我不知道它们到底是做什么用的。我假设它就像一个受 DRM 保护的文件或其他东西。那是前一阵子，所以我不记得确切的细节是什么。我从来没有备份过它，也没有被任何东西锁定。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-04T06:54:41.440

解压缩 DroidDraw (http://www.droiddraw.org/) 后，我收到了相同的消息。这是一个普通的（我认为）zip文件。右键单击它，全部提取。生成的文件夹/文件已加密。立即 Win 提示我备份 EFS 密钥。
Win Vista 和 Win 7 上的行为相同。

# msbuild - 如何使用 MSBuild 和 MS 虚拟服务器和/或 Hyper-V 服务器虚拟化创建虚拟机作为构建过程的一部分？

> ID：11720
> 
> 赞同：15
> 
> 时间：2008-08-14T21:32:34.287
> 
> 标签：msbuild, virtualization, hyper-v

我想做的是创建一个干净的虚拟机映像作为应用程序构建的输出。

因此将创建一个新的虚拟机（从模板很好，安装了操作系统，并安装了一些基础软件）--- 将在 IIS 中创建一个新网站，并将 Web 应用程序构建输出复制到虚拟机硬盘和 IIS 配置正确，虚拟机将启动并运行。

我知道有 MSBuild 任务可以为 IIS 中的所有管理操作编写脚本，但是如何使用虚拟机编写所有操作的脚本？具体来说，从模板创建一个新的虚拟机，对其进行唯一命名，启动它，配置它等等......

具体来说，我想知道是否有人成功地将任何 VM 脚本作为构建过程的一部分实现。

更新：我假设使用 Hyper-V，有一组不同的库/API 来编写虚拟机脚本，有人玩过这个吗？任何有真正实践经验的人做这样的事情？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-14T22:08:31.360

您实际上可以在 MS 虚拟服务器中编写大量任务：

[http://www.microsoft.com/technet/scriptcenter/scripts/vs/default.mspx?mfr=true](http://www.microsoft.com/technet/scriptcenter/scripts/vs/default.mspx?mfr=true)

[http://msdn.microsoft.com/en-us/library/aa368876(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa368876(VS.85).aspx)

此外，Virtual PC 的家伙在他的博客上有很多关于脚本 Virtual Server/PC 和现在 Hyper-V 的内容：

[http://blogs.msdn.com/virtual_pc_guy/default.aspx](http://blogs.msdn.com/virtual_pc_guy/default.aspx)

VMware 具有类似的功能：

[http://www.vmware.com/support/developer/scripting-API/](http://www.vmware.com/support/developer/scripting-API/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-23T16:50:42.273

签[出 CodePlex 上 Hyper-V 的 Powershell 管理库](http://www.codeplex.com/PSHyperv)。一些特点：

> 查找 VM
> 连接到 VM
> 发现和操作机器状态
> 备份、导出和快照 VM
> 添加和删除 VM，配置主板设置。
> 操作磁盘控制器、驱动器和磁盘映像
> 操作网络接口卡
> 处理 VHD 文件

# visual-studio - 在 Visual Studio 中，您必须是调试用户或管理员的成员才能开始调试。如果你是，但它不起作用怎么办？

> ID：11724
> 
> 赞同：0
> 
> 时间：2008-08-14T21:48:45.660
> 
> 标签：visual-studio, debugging, permissions

在我的**Windows XP**机器上，Visual Studio 2003 2005 和 2008 都抱怨我无法开始调试我的**Web 应用程序**，因为我必须是 Debug Users 组或 Administrators 组的成员。所以，我是管理员，为了以防万一，我添加了调试用户，但它仍然抱怨。

没有重新格式化我的机器并重新开始，有没有人遇到过这个并修复它[使用一些未记录的命令]？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-16T04:29:43.047

哪些用户和/或组在您的“调试程序”权限中（在用户权限分配下）？也许该设置被组策略（丹尼尔的回答）覆盖，或者由于某种原因而失控。显然，它应该包括“调试用户”组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T01:11:30.290

我们遇到了这样的问题，发现是组策略问题。需要启用用于调试的组策略设置。它覆盖了您在正确的组中的事实。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T00:50:17.103

您可以尝试`VsJITDebugger.exe -p <PID>`在命令行上运行“”。我遇到过类似的情况，并且能够使用上述方法调试应用程序。

" `VsJITDebugger.exe /?`" 将显示所有选项。

PID 可以在任务管理器（视图-> 选择列...）或 Visual Studio 的附加到进程中找到。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-22T21:01:06.190

太棒了，我从来没有真正了解过 XP 下的“管理工具 -> 本地安全设置 -> 本地策略 -> 用户权限分配”。我的“调试程序”策略仅设置为“管理员”，但现在尝试调试刚刚工作，这是安装 .NET 框架 3.5 几天后，所以也许安装在后台修复了问题。

# windows - 如何拦截和取消应用程序的自动播放？

> ID：11734
> 
> 赞同：1
> 
> 时间：2008-08-14T22:29:57.633
> 
> 标签：windows, disk

我正在开发一个应用程序来安装来自多张 DVD 的大量数据文件。应用程序将提示用户插入下一个磁盘，但 Windows 将自动尝试在资源管理器窗口中打开该磁盘或询问用户如何处理新磁盘。
如何拦截和取消来自我的应用程序的自动播放消息？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-14T22:30:37.570

我知道有两种方法。第一个也是最简单的方法是注册特殊的 Windows 消息“QueryCancelAutoPlay”，并在处理消息时简单地返回 1。这仅适用于当前窗口，不适用于后台应用程序。

第二种方法需要将实现COM接口`IQueryCancelAutoPlay`COM接口的对象插入到运行对象表中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-19T18:37:28.793

或者，您可以以编程方式保存自动播放的当前状态并在程序启动时将其关闭，然后在程序关闭时恢复原始状态。这会简单得多。查看[NoDriveTypeAutoRun 键](http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/regentry/93502.mspx?mfr=true)。

# .net - 带有 .Net OR/M 的可配置表前缀？

> ID：11740
> 
> 赞同：4
> 
> 时间：2008-08-14T22:32:58.860
> 
> 标签：.net, orm

在 wiki 或论坛或博客软件等 Web 应用程序中，将数据存储在关系数据库中通常很有用。由于许多托管公司在其托管计划中提供单个数据库（额外的数据库需要额外付费），因此当您的数据库对象（表、视图、约束和存储过程）具有公共前缀时，这对您的用户非常有用。意识到数据库稀缺性的应用程序通常具有硬编码的表前缀。然而，我想要更多。具体来说，我希望有一个用户可以指定的表前缀——比如在 web.config 文件中（当然，使用适当的默认值）。

因为我讨厌手动编写[CRUD](https://en.wikipedia.org/wiki/Create%2C_read%2C_update_and_delete)操作，所以我更喜欢通过有能力的 OR/M 工作，并且使用（并喜欢）LINQ to SQL、Subsonic 和 ADO.Net。但是，在将表前缀放入用户的 web.config 文件中时，我在一个新项目中遇到了一些麻烦。是否有任何基于 .Net 的 OR/M 产品可以优雅地处理这种情况？

到目前为止，我能想到的最好的方法是使用带有外部映射文件的 LINQ to SQL，我必须根据一个尚未假设的 web.config 设置以某种方式更新该文件。

有人有更好的解决方案吗？我试图在实体框架中实现它，但很快就变成了一团糟。（由于我对 EF 不熟悉？可能。） SubSonic 怎么样？除了在代码生成时，它是否可以选择应用表前缀？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-28T14:49:41.663

我现在研究了在 Entity Framework 和 LINQ to SQL 中执行此操作需要什么，并[记录了每个](http://theruntime.com/blogs/jacob/archive/2008/08/27/changing-table-names-in-an-orm.aspx). 它比这里的答案要长得多，所以我会满足于答案的链接，而不是在这里复制它。每个都相对涉及，但 LINQ to SQL 是更灵活的解决方案，也是最容易实现的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-14T23:04:50.530

[LightSpeed](https://www.mindscape.co.nz/products/LightSpeed/default.aspx)允许您指定一个*INamingStrategy*，让您在运行时动态解析表名。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-15T08:56:02.473

而不是使用表前缀，而是拥有一个属于 a 的应用程序用户`schema`（在 MS Sql 2005 或更高版本中）。

这意味着，而不是：

```
select * from dbo.clientAProduct
select * from dbo.clientBroduct 
```

你有：

```
select * from clientA.Product
select * from clientB.Product 
```

# .net - 在 .NET Web 服务中保存数据的最佳方式

> ID：11761
> 
> 赞同：4
> 
> 时间：2008-08-14T23:13:32.493
> 
> 标签：.net, web-services, json, memory, persistence

我有一个从这个 json 文件查询数据的 Web 服务，但我不希望 Web 服务每次都访问该文件。我在想也许我可以将数据存储在其他地方（也许在内存中），这样 Web 服务下次尝试查询相同数据时就可以从那里获取数据。我有点明白需要做什么，但我只是不确定如何实际去做。我们如何在 Web 服务中持久化数据？

**更新：** 缓存和使用静态变量的建议看起来都不错。也许我应该同时使用两个，这样我就可以先看一个，如果它不在那里，使用第二个，如果它也不在那里，那么我会看看 json 文件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-15T00:32:04.923

扩展[Ice^^Heat](https://stackoverflow.com/questions/11761/persisting-data-in-net-web-service-memory#11779)的想法，您可能需要考虑缓存的位置 - 或者将 json 文件的内容缓存在 Application 缓存中，如下所示：

```
Context.Cache.Insert("foo", _
                 Foo, _
                 Nothing, _
                 DateAdd(DateInterval.Minute, 30, Now()), _
                 System.Web.Caching.Cache.NoSlidingExpiration) 
```

然后在每次点击时生成您需要的结果。或者，您可以在函数定义上缓存 Web 服务输出：

```
<WebMethod(CacheDuration:=60)> _
Public Function HelloWorld() As String
    Return "Hello World"
End Function 
```

[从XML Web Service Caching Strategies](http://msdn.microsoft.com/en-us/library/aa480499.aspx)收集的信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-14T23:39:07.497

使用全局或静态集合对象怎么样？这是一个好主意吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-14T23:29:27.500

ASP.NET 缓存同样适用于 Web 服务，因此您可以按照此处的说明实现常规缓存：http: [//msdn.microsoft.com/en-us/library/aa478965.aspx](http://msdn.microsoft.com/en-us/library/aa478965.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-15T02:36:03.660

为了回应[klughing](https://stackoverflow.com/questions/11761/persisting-data-in-net-web-service-memory#11789)，如果您的 JSON 数据预计不会经常更改，我认为缓存它的最简单方法是使用某种静态集合 - 也许是 DataTable。

首先，将您的 JSON 数据解析为 System.Data.DataTable，并在您的 Web 服务类中将其设为静态。然后，访问静态对象。数据应保持缓存，直到 IIS 回收您的应用程序池。

```
public class WebServiceClass
{
    private static DataTable _myData = null;
    public static DataTable MyData
    {
        get
        {
            if (_myData == null)
            {
                _myData = ParseJsonDataReturnDT();
            }
            return _myData;
        }
    }

    [WebMethod]
    public string GetData()
    {
        //... do some stuff with MyData and return a string ...
        return MyData.Rows[0]["MyColumn"].ToString();
    }
} 
```

# c# - 为什么密码错误会导致“填充无效，无法删除”？

> ID：11762
> 
> 赞同：40
> 
> 时间：2008-08-14T23:14:38.823
> 
> 标签：c#, .net, exception, encryption

[我需要一些简单的字符串加密，所以我编写了以下代码（这里](http://www.codeproject.com/KB/security/DotNetCrypto.aspx)有很多“灵感” ）：

```
 // create and initialize a crypto algorithm
    private static SymmetricAlgorithm getAlgorithm(string password) {
        SymmetricAlgorithm algorithm = Rijndael.Create();
        Rfc2898DeriveBytes rdb = new Rfc2898DeriveBytes(
            password, new byte[] {
            0x53,0x6f,0x64,0x69,0x75,0x6d,0x20,             // salty goodness
            0x43,0x68,0x6c,0x6f,0x72,0x69,0x64,0x65
        }
        );
        algorithm.Padding = PaddingMode.ISO10126;
        algorithm.Key = rdb.GetBytes(32);
        algorithm.IV = rdb.GetBytes(16);
        return algorithm;
    }

    /* 
     * encryptString
     * provides simple encryption of a string, with a given password
     */
    public static string encryptString(string clearText, string password) {
        SymmetricAlgorithm algorithm = getAlgorithm(password);
        byte[] clearBytes = System.Text.Encoding.Unicode.GetBytes(clearText);
        MemoryStream ms = new MemoryStream();
        CryptoStream cs = new CryptoStream(ms, algorithm.CreateEncryptor(), CryptoStreamMode.Write);
        cs.Write(clearBytes, 0, clearBytes.Length);
        cs.Close();
        return Convert.ToBase64String(ms.ToArray());
    }

    /*
     * decryptString
     * provides simple decryption of a string, with a given password
     */
    public static string decryptString(string cipherText, string password) {
        SymmetricAlgorithm algorithm = getAlgorithm(password);
        byte[] cipherBytes = Convert.FromBase64String(cipherText);
        MemoryStream ms = new MemoryStream();
        CryptoStream cs = new CryptoStream(ms, algorithm.CreateDecryptor(), CryptoStreamMode.Write);
        cs.Write(cipherBytes, 0, cipherBytes.Length);
        cs.Close();            
        return System.Text.Encoding.Unicode.GetString(ms.ToArray());
    } 
```

代码似乎工作正常，除了在使用不正确的密钥解密数据时，我在解密字符串的 cs.Close() 行上收到 CryptographicException - “填充无效且无法删除”。

示例代码：

```
 string password1 = "password";
    string password2 = "letmein";
    string startClearText = "The quick brown fox jumps over the lazy dog";
    string cipherText = encryptString(startClearText, password1);
    string endClearText = decryptString(cipherText, password2);     // exception thrown 
```

我的问题是，这是可以预期的吗？我原以为用错误的密码解密只会导致无意义的输出，而不是异常。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-08-25T15:46:00.960

尽管这已经得到了回答，但我认为解释**为什么**会出现这种情况是一个好主意。

通常应用填充方案，因为大多数加密过滤器在语义上并不安全并且可以防止某些形式的加密攻击。例如，通常在 RSA 中使用[OAEP](http://en.wikipedia.org/wiki/Optimal_Asymmetric_Encryption_Padding)填充方案来防止某些类型的攻击（例如选择明文攻击或[致盲](http://en.wikipedia.org/wiki/Blinding_(cryptography))）。

填充方案在发送消息之前将一些（通常）随机垃圾附加到消息 m 中。例如，在 OAEP 方法中，使用了两个 Oracle（这是一个简单的解释）：

1.  给定模数的大小，您用 0 填充 k1 位，用随机数填充 k0 位。
2.  然后通过对消息应用一些转换，您将获得加密并发送的填充消息。

这为您提供了消息的随机化，并提供了一种测试消息是否为垃圾的方法。由于填充方案是可逆的，当您解密消息时，虽然您无法说明消息本身的完整性，但实际上您可以对填充做出一些断言，因此您可以知道消息是否已正确解密或者您做错了什么（即有人篡改了消息或您使用了错误的密钥）

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2013-11-07T11:44:56.370

我遇到了类似的“填充无效，无法删除”。例外，但在我的情况下，密钥 IV 和填充是正确的。

事实证明，只缺少刷新加密流。

像这样：

```
 MemoryStream msr3 = new MemoryStream();
            CryptoStream encStream = new CryptoStream(msr3, RijndaelAlg.CreateEncryptor(), CryptoStreamMode.Write);
            encStream.Write(bar2, 0, bar2.Length);
            // unless we flush the stream we would get "Padding is invalid and cannot be removed." exception when decoding
            encStream.FlushFinalBlock();
            byte[] bar3 = msr3.ToArray(); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-02-20T02:01:15.980

如果您希望您的使用正确，您应该向您的密文添加[身份验证](http://en.wikipedia.org/wiki/Authenticated_encryption)，以便您可以验证它是正确的密码或密文没有被修改。如果最后一个字节没有解密为 16 个有效的填充值之一（0x01-0x10），您使用[ISO10126的填充只会引发异常。](http://en.wikipedia.org/wiki/Padding_%28cryptography%29#ISO_10126)因此，您有 1/16 的机会不会使用错误的密码引发异常，如果您对其进行身份验证，您就有一种确定的方式来判断您的解密是否有效。

使用crypto api看似简单，实际上却很容易出错。例如，您为密钥和 iv 派生使用固定盐，这意味着使用相同密码加密的每个密文都将使用该密钥重用它的 IV，这会破坏 CBC 模式的语义安全性，IV 需要既不可预测又是唯一的给定的密​​钥。

出于容易出错的原因，我有一个代码片段，我试图保持审查和更新（评论，欢迎问题）：

[字符串 C# 的对称身份验证加密的现代示例。](https://stackoverflow.com/a/10366194/637783)

如果你在使用`AESThenHMAC.AesSimpleDecryptWithPassword(ciphertext, password)`错误密码时使用它，`null`则返回，如果密文或iv已被修改后加密`null`返回，你将永远不会得到垃圾数据，或者填充异常。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-10-13T10:40:01.477

如果您已经排除了键不匹配，那么除此之外`FlushFinalBlock()`（请参阅 Yaniv 的回答），调用will 也足够 `Close()`了。`CryptoStream`

如果您严格使用块清理资源`using`，请确保为`CryptoStream`自身嵌套块：

```
using (MemoryStream ms = new MemoryStream())
using (var enc = RijndaelAlg.CreateEncryptor())
{
  using (CryptoStream encStream = new CryptoStream(ms, enc, CryptoStreamMode.Write))
  {
    encStream.Write(bar2, 0, bar2.Length);
  } // implicit close
  byte[] encArray = ms.ToArray();
} 
```

我被这个（或类似的）咬了：

```
using (MemoryStream ms = new MemoryStream())
using (var enc = RijndaelAlg.CreateEncryptor())
using (CryptoStream encStream = new CryptoStream(ms, enc, CryptoStreamMode.Write))
{
  encStream.Write(bar2, 0, bar2.Length);
  byte[] encArray = ms.ToArray();
} // implicit close -- too late! 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-14T23:25:22.470

是的，这是意料之中的，或者至少，当我们的加密程序获得不可解密的数据时会发生这种情况

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-10-10T10:43:12.170

异常的另一个原因可能是使用解密逻辑的多个线程之间的竞争条件 - ICryptoTransform 的本机实现*不是线程安全的*（例如 SymmetricAlgorithm），因此应该将它放在独占部分，例如使用*lock*。请参阅此处了解更多详细信息：http: [//www.make-awesome.com/2011/07/system-security-cryptography-and-thread-safety/](http://www.make-awesome.com/2011/07/system-security-cryptography-and-thread-safety/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-08-04T09:16:27.087

CryptoStream 中可能有一些未读字节。在完全读取流之前关闭导致我的程序出错。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-02-02T12:13:46.263

我有一个类似的问题，解密方法的问题是初始化一个空的内存流。当我用这样的密文字节数组初始化它时它起作用了：

```
MemoryStream ms = new MemoryStream(cipherText) 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2015-04-15T20:12:47.603

用户“atconway”更新的答案对我有用。

问题不在于填充，而在于加密和解密期间不同的密钥。在加密和解密相同的值期间，密钥和 iv 应该相同。

# iis - 发布到 IIS - 最佳实践

> ID：11764
> 
> 赞同：5
> 
> 时间：2008-08-14T23:15:59.447
> 
> 标签：iis, publish

我对网络发布并不陌生，但我对针对经常使用的网站进行发布并不陌生。以前，此服务器上的应用程序不经常被点击，但我们正在推出一个高需求的应用程序。那么，发布到实时 Web 服务器的最佳实践是什么？

1.  最好等到半夜没有人上网（是的，我几乎可以依赖它——它是一个内部网，因此会有时间不使用）
2.  在对主干进行新更新时发布（当然取决于构建成功）
3.  如果 2 为真，那么如果有人正在使用该特定页面或 DLL 并且它被覆盖，那似乎很糟糕。

...我敢肯定这种事情有很多好地方，但我没有使用正确的谷歌搜索词。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-14T23:21:58.387

> **@Nick DeVore 写道：**
> 
> 如果 2 为真，那么如果有人正在使用该特定页面或 DLL 并且它被覆盖，那似乎很糟糕。

如果您使用的是 ASP.NET 堆栈（Webforms、MVC 或滚动您自己的堆栈），这并不是真正的问题，因为您的所有 aspx 文件都会被编译，因此不会被网络服务器触及。/bin/ 文件夹完全隐藏在其他地方，因此网络服务器也不使用其中的库。

IIS 将等到所有请求都完成（尽管有一些超时），然后将继续编译（如果需要）并重新启动 AppDomain。如果只更改了几个文件，甚至不会重新启动 AppDomain。IIS 会将新程序集（或编译的 aspx/asmx/ascx 文件）加载到现有的 AppDomain 中。

> **@Nick DeVore 写道：**
> 
> 帮助我更多地理解这一点。将我指向微软解释这一点的地方。谢谢！

尝试用谷歌搜索“IIS AppDomain”关键字。我找到了[ASP.NET 程序员应该了解的关于应用程序域](http://www.odetocode.com/articles/305.aspx)的知识。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T00:07:21.917

我们在凌晨进行大部分更新。

方便的提示，如果这是一个 ASP.NET 站点，无论您在一天中的什么时间推出，放入一个 App_Offline.htm 文件，其中包含一条消息，向用户解释该站点因维护而关闭。

斯科特·格思里在这里有更多信息：

[http://weblogs.asp.net/scottgu/archive/2006/04/09/442332.aspx](http://weblogs.asp.net/scottgu/archive/2006/04/09/442332.aspx)

# c# - 在 C# 中浏览目录

> ID：11767
> 
> 赞同：62
> 
> 时间：2008-08-14T23:18:52.543
> 
> 标签：c#, .net, directory

如何向用户提供允许他/她选择目录的控件？

似乎没有任何本机 .net 控件可以做到这一点？

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2011-10-03T11:07:05.837

```
string folderPath = "";
FolderBrowserDialog folderBrowserDialog1 = new FolderBrowserDialog();
if (folderBrowserDialog1.ShowDialog() == DialogResult.OK) {
    folderPath = folderBrowserDialog1.SelectedPath ;
} 
```

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-08-14T23:25:12.967

[FolderBrowserDialog 类](http://msdn.microsoft.com/en-us/library/system.windows.forms.folderbrowserdialog.aspx)是最好的选择。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2015-11-20T00:39:37.427

^([*注意：不保证此代码将在 .Net 框架的未来版本中工作。在这里通过反射使用私有 .Net 框架内部可能并不好。使用底部提到的互操作解决方案，因为 Windows API 不太可能更改。*])

如果您正在寻找一个看起来更像 Windows 7 对话框的文件夹选择器，并且能够从底部的文本框和左侧的导航窗格中复制和粘贴收藏夹和常用位置，那么您可以访问它以一种非常轻量级的方式。

FolderBrowserDialog UI 非常小：

[![在此处输入图像描述](../Images/6025dd38f92784ddf9aacd80a0cd5861.png)](https://i.stack.imgur.com/T5qBb.png)

但是您可以改为：

[![在此处输入图像描述](../Images/cddaaa7d2ea907f7d6990de40f355d5d.png)](https://i.stack.imgur.com/T95kd.png)

这是一个使用 .Net 私有接口打开 Vista 风格的文件夹选择器的类`IFileDialog`，而不直接在代码中使用互操作（.Net 会为您处理）。如果 Windows 版本不够高，它会退回到 Vista 之前的对话框。应该在 Windows 7、8、9、10 和更高版本（理论上）中工作。

```
using System;
using System.Reflection;
using System.Windows.Forms;

namespace MyCoolCompany.Shuriken {
    /// <summary>
    /// Present the Windows Vista-style open file dialog to select a folder. Fall back for older Windows Versions
    /// </summary>
    public class FolderSelectDialog {
        private string _initialDirectory;
        private string _title;
        private string _fileName = "";

        public string InitialDirectory {
            get { return string.IsNullOrEmpty(_initialDirectory) ? Environment.CurrentDirectory : _initialDirectory; }
            set { _initialDirectory = value; }
        }
        public string Title {
            get { return _title ?? "Select a folder"; }
            set { _title = value; }
        }
        public string FileName { get { return _fileName; } }

        public bool Show() { return Show(IntPtr.Zero); }

        /// <param name="hWndOwner">Handle of the control or window to be the parent of the file dialog</param>
        /// <returns>true if the user clicks OK</returns>
        public bool Show(IntPtr hWndOwner) {
            var result = Environment.OSVersion.Version.Major >= 6
                ? VistaDialog.Show(hWndOwner, InitialDirectory, Title)
                : ShowXpDialog(hWndOwner, InitialDirectory, Title);
            _fileName = result.FileName;
            return result.Result;
        }

        private struct ShowDialogResult {
            public bool Result { get; set; }
            public string FileName { get; set; }
        }

        private static ShowDialogResult ShowXpDialog(IntPtr ownerHandle, string initialDirectory, string title) {
            var folderBrowserDialog = new FolderBrowserDialog {
                Description = title,
                SelectedPath = initialDirectory,
                ShowNewFolderButton = false
            };
            var dialogResult = new ShowDialogResult();
            if (folderBrowserDialog.ShowDialog(new WindowWrapper(ownerHandle)) == DialogResult.OK) {
                dialogResult.Result = true;
                dialogResult.FileName = folderBrowserDialog.SelectedPath;
            }
            return dialogResult;
        }

        private static class VistaDialog {
            private const string c_foldersFilter = "Folders|\n";

            private const BindingFlags c_flags = BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic;
            private readonly static Assembly s_windowsFormsAssembly = typeof(FileDialog).Assembly;
            private readonly static Type s_iFileDialogType = s_windowsFormsAssembly.GetType("System.Windows.Forms.FileDialogNative+IFileDialog");
            private readonly static MethodInfo s_createVistaDialogMethodInfo = typeof(OpenFileDialog).GetMethod("CreateVistaDialog", c_flags);
            private readonly static MethodInfo s_onBeforeVistaDialogMethodInfo = typeof(OpenFileDialog).GetMethod("OnBeforeVistaDialog", c_flags);
            private readonly static MethodInfo s_getOptionsMethodInfo = typeof(FileDialog).GetMethod("GetOptions", c_flags);
            private readonly static MethodInfo s_setOptionsMethodInfo = s_iFileDialogType.GetMethod("SetOptions", c_flags);
            private readonly static uint s_fosPickFoldersBitFlag = (uint) s_windowsFormsAssembly
                .GetType("System.Windows.Forms.FileDialogNative+FOS")
                .GetField("FOS_PICKFOLDERS")
                .GetValue(null);
            private readonly static ConstructorInfo s_vistaDialogEventsConstructorInfo = s_windowsFormsAssembly
                .GetType("System.Windows.Forms.FileDialog+VistaDialogEvents")
                .GetConstructor(c_flags, null, new[] { typeof(FileDialog) }, null);
            private readonly static MethodInfo s_adviseMethodInfo = s_iFileDialogType.GetMethod("Advise");
            private readonly static MethodInfo s_unAdviseMethodInfo = s_iFileDialogType.GetMethod("Unadvise");
            private readonly static MethodInfo s_showMethodInfo = s_iFileDialogType.GetMethod("Show");

            public static ShowDialogResult Show(IntPtr ownerHandle, string initialDirectory, string title) {
                var openFileDialog = new OpenFileDialog {
                    AddExtension = false,
                    CheckFileExists = false,
                    DereferenceLinks = true,
                    Filter = c_foldersFilter,
                    InitialDirectory = initialDirectory,
                    Multiselect = false,
                    Title = title
                };

                var iFileDialog = s_createVistaDialogMethodInfo.Invoke(openFileDialog, new object[] { });
                s_onBeforeVistaDialogMethodInfo.Invoke(openFileDialog, new[] { iFileDialog });
                s_setOptionsMethodInfo.Invoke(iFileDialog, new object[] { (uint) s_getOptionsMethodInfo.Invoke(openFileDialog, new object[] { }) | s_fosPickFoldersBitFlag });
                var adviseParametersWithOutputConnectionToken = new[] { s_vistaDialogEventsConstructorInfo.Invoke(new object[] { openFileDialog }), 0U };
                s_adviseMethodInfo.Invoke(iFileDialog, adviseParametersWithOutputConnectionToken);

                try {
                    int retVal = (int) s_showMethodInfo.Invoke(iFileDialog, new object[] { ownerHandle });
                    return new ShowDialogResult {
                        Result = retVal == 0,
                        FileName = openFileDialog.FileName
                    };
                }
                finally {
                    s_unAdviseMethodInfo.Invoke(iFileDialog, new[] { adviseParametersWithOutputConnectionToken[1] });
                }
            }
        }

        // Wrap an IWin32Window around an IntPtr
        private class WindowWrapper : IWin32Window {
            private readonly IntPtr _handle;
            public WindowWrapper(IntPtr handle) { _handle = handle; }
            public IntPtr Handle { get { return _handle; } }
        }
    }
} 
```

[我将其开发为.NET Win 7 风格的文件夹选择对话框](http://www.lyquidity.com/devblog/?p=136)的清理版本，由[lyquidity.com](http://lyquidity.com)的 Bill Seddon开发（我没有从属关系）。我自己编写了自己的解决方案，因为他的解决方案需要一个额外的 Reflection 类，该类不需要这个重点目的，使用基于异常的流控制，不缓存其反射调用的结果。请注意，嵌套的静态类是这样的，如果从不调用该方法，则`VistaDialog`不会尝试填充其静态反射变量。`Show`

它在 Windows 窗体中的使用方式如下：

```
var dialog = new FolderSelectDialog {
    InitialDirectory = musicFolderTextBox.Text,
    Title = "Select a folder to import music from"
};
if (dialog.Show(Handle)) {
    musicFolderTextBox.Text = dialog.FileName;
} 
```

您当然可以使用它的选项以及它公开的属性。例如，它允许在 Vista 风格的对话框中进行多选。

另外，请注意，[Simon Mourier 给出了一个答案](https://stackoverflow.com/a/15386992/57611)，显示了如何直接使用针对 Windows API 的互操作来完成完全相同的工作，尽管如果在旧版本的 Windows 中使用旧样式对话框，则必须补充他的版本。不幸的是，当我制定解决方案时，我还没有找到他的帖子。说出你的毒药！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-14T23:32:21.720

您可以只使用命名空间中的`FolderBrowserDialog`类`System.Windows.Forms`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-15T00:03:45.700

请不要尝试使用 TreeView/DirectoryInfo 类自行开发。一方面，您可以使用 SHBrowseForFolder 免费获得许多不错的功能（图标/右键单击/网络）。另一方面，您可能不会意识到一些边缘情况/问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-04-24T13:30:19.870

甚至更好，您可以将此代码放在类文件中

```
using System;
using System.IO;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
using System.Windows.Forms;

internal class OpenFolderDialog : IDisposable {

    /// <summary>
    /// Gets/sets folder in which dialog will be open.
    /// </summary>
    public string InitialFolder { get; set; }

    /// <summary>
    /// Gets/sets directory in which dialog will be open if there is no recent directory available.
    /// </summary>
    public string DefaultFolder { get; set; }

    /// <summary>
    /// Gets selected folder.
    /// </summary>
    public string Folder { get; private set; }

    internal DialogResult ShowDialog(IWin32Window owner) {
        if (Environment.OSVersion.Version.Major >= 6) {
            return ShowVistaDialog(owner);
        } else {
            return ShowLegacyDialog(owner);
        }
    }

    private DialogResult ShowVistaDialog(IWin32Window owner) {
        var frm = (NativeMethods.IFileDialog)(new NativeMethods.FileOpenDialogRCW());
        uint options;
        frm.GetOptions(out options);
        options |= NativeMethods.FOS_PICKFOLDERS | NativeMethods.FOS_FORCEFILESYSTEM | NativeMethods.FOS_NOVALIDATE | NativeMethods.FOS_NOTESTFILECREATE | NativeMethods.FOS_DONTADDTORECENT;
        frm.SetOptions(options);
        if (this.InitialFolder != null) {
            NativeMethods.IShellItem directoryShellItem;
            var riid = new Guid("43826D1E-E718-42EE-BC55-A1E261C37BFE"); //IShellItem
            if (NativeMethods.SHCreateItemFromParsingName(this.InitialFolder, IntPtr.Zero, ref riid, out directoryShellItem) == NativeMethods.S_OK) {
                frm.SetFolder(directoryShellItem);
            }
        }
        if (this.DefaultFolder != null) {
            NativeMethods.IShellItem directoryShellItem;
            var riid = new Guid("43826D1E-E718-42EE-BC55-A1E261C37BFE"); //IShellItem
            if (NativeMethods.SHCreateItemFromParsingName(this.DefaultFolder, IntPtr.Zero, ref riid, out directoryShellItem) == NativeMethods.S_OK) {
                frm.SetDefaultFolder(directoryShellItem);
            }
        }

        if (frm.Show(owner.Handle) == NativeMethods.S_OK) {
            NativeMethods.IShellItem shellItem;
            if (frm.GetResult(out shellItem) == NativeMethods.S_OK) {
                IntPtr pszString;
                if (shellItem.GetDisplayName(NativeMethods.SIGDN_FILESYSPATH, out pszString) == NativeMethods.S_OK) {
                    if (pszString != IntPtr.Zero) {
                        try {
                            this.Folder = Marshal.PtrToStringAuto(pszString);
                            return DialogResult.OK;
                        } finally {
                            Marshal.FreeCoTaskMem(pszString);
                        }
                    }
                }
            }
        }
        return DialogResult.Cancel;
    }

    private DialogResult ShowLegacyDialog(IWin32Window owner) {
        using (var frm = new SaveFileDialog()) {
            frm.CheckFileExists = false;
            frm.CheckPathExists = true;
            frm.CreatePrompt = false;
            frm.Filter = "|" + Guid.Empty.ToString();
            frm.FileName = "any";
            if (this.InitialFolder != null) { frm.InitialDirectory = this.InitialFolder; }
            frm.OverwritePrompt = false;
            frm.Title = "Select Folder";
            frm.ValidateNames = false;
            if (frm.ShowDialog(owner) == DialogResult.OK) {
                this.Folder = Path.GetDirectoryName(frm.FileName);
                return DialogResult.OK;
            } else {
                return DialogResult.Cancel;
            }
        }
    }

    public void Dispose() { } //just to have possibility of Using statement.

}

internal static class NativeMethods {

    #region Constants

    public const uint FOS_PICKFOLDERS = 0x00000020;
    public const uint FOS_FORCEFILESYSTEM = 0x00000040;
    public const uint FOS_NOVALIDATE = 0x00000100;
    public const uint FOS_NOTESTFILECREATE = 0x00010000;
    public const uint FOS_DONTADDTORECENT = 0x02000000;

    public const uint S_OK = 0x0000;

    public const uint SIGDN_FILESYSPATH = 0x80058000;

    #endregion

    #region COM

    [ComImport, ClassInterface(ClassInterfaceType.None), TypeLibType(TypeLibTypeFlags.FCanCreate), Guid("DC1C5A9C-E88A-4DDE-A5A1-60F82A20AEF7")]
    internal class FileOpenDialogRCW { }

    [ComImport(), Guid("42F85136-DB7E-439C-85F1-E4075D135FC8"), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
    internal interface IFileDialog {
        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        [PreserveSig()]
        uint Show([In, Optional] IntPtr hwndOwner); //IModalWindow 

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetFileTypes([In] uint cFileTypes, [In, MarshalAs(UnmanagedType.LPArray)] IntPtr rgFilterSpec);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetFileTypeIndex([In] uint iFileType);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint GetFileTypeIndex(out uint piFileType);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint Advise([In, MarshalAs(UnmanagedType.Interface)] IntPtr pfde, out uint pdwCookie);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint Unadvise([In] uint dwCookie);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetOptions([In] uint fos);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint GetOptions(out uint fos);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        void SetDefaultFolder([In, MarshalAs(UnmanagedType.Interface)] IShellItem psi);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetFolder([In, MarshalAs(UnmanagedType.Interface)] IShellItem psi);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint GetFolder([MarshalAs(UnmanagedType.Interface)] out IShellItem ppsi);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint GetCurrentSelection([MarshalAs(UnmanagedType.Interface)] out IShellItem ppsi);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetFileName([In, MarshalAs(UnmanagedType.LPWStr)] string pszName);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint GetFileName([MarshalAs(UnmanagedType.LPWStr)] out string pszName);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetTitle([In, MarshalAs(UnmanagedType.LPWStr)] string pszTitle);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetOkButtonLabel([In, MarshalAs(UnmanagedType.LPWStr)] string pszText);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetFileNameLabel([In, MarshalAs(UnmanagedType.LPWStr)] string pszLabel);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint GetResult([MarshalAs(UnmanagedType.Interface)] out IShellItem ppsi);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint AddPlace([In, MarshalAs(UnmanagedType.Interface)] IShellItem psi, uint fdap);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetDefaultExtension([In, MarshalAs(UnmanagedType.LPWStr)] string pszDefaultExtension);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint Close([MarshalAs(UnmanagedType.Error)] uint hr);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetClientGuid([In] ref Guid guid);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint ClearClientData();

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint SetFilter([MarshalAs(UnmanagedType.Interface)] IntPtr pFilter);
    }

    [ComImport, Guid("43826D1E-E718-42EE-BC55-A1E261C37BFE"), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
    internal interface IShellItem {
        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint BindToHandler([In] IntPtr pbc, [In] ref Guid rbhid, [In] ref Guid riid, [Out, MarshalAs(UnmanagedType.Interface)] out IntPtr ppvOut);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint GetParent([MarshalAs(UnmanagedType.Interface)] out IShellItem ppsi);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint GetDisplayName([In] uint sigdnName, out IntPtr ppszName);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint GetAttributes([In] uint sfgaoMask, out uint psfgaoAttribs);

        [MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime)]
        uint Compare([In, MarshalAs(UnmanagedType.Interface)] IShellItem psi, [In] uint hint, out int piOrder);
    }

    #endregion

    [DllImport("shell32.dll", CharSet = CharSet.Unicode, SetLastError = true)]
    internal static extern int SHCreateItemFromParsingName([MarshalAs(UnmanagedType.LPWStr)] string pszPath, IntPtr pbc, ref Guid riid, [MarshalAs(UnmanagedType.Interface)] out IShellItem ppv);

} 
```

并像这样使用它

```
using (var frm = new OpenFolderDialog()) {
                if (frm.ShowDialog(this)== DialogResult.OK) {
                    MessageBox.Show(this, frm.Folder);
                }
            } 
```

# .net - 通过 Web 服务上传文件

> ID：11782
> 
> 赞同：4
> 
> 时间：2008-08-14T23:33:01.253
> 
> 标签：.net, web-services, file-upload, upload

是否可以通过 Web 服务将文件从客户端计算机上传到服务器？客户端可以运行任何东西，从本地桌面应用程序到瘦 ajax 客户端。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-18T11:42:22.500

当然可以通过 Web 服务（例如 SOAP）发送二进制文件，但是您通常必须进行某种编码，例如 base64，这会增加要发送的数据量。发送任意二进制文件的最有效方法之一是通过 HTTP PUT 操作，因为没有编码开销。并非所有客户都一定有简单的方法来做到这一点，但值得一看。

硬币的另一面是如何从用户的磁盘上获取数据并连接到网络连接上。“瘦 ajax 客户端”可能没有从用户磁盘读取文件的必要权限。另一方面，桌面应用程序实现将能够毫无问题地做到这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-18T11:35:32.187

我不是“webservice”的大师，但是如果你开发 webservice（和客户端），你总是可以在客户端将二进制文件转换为[BASE64](http://en.wikipedia.org/wiki/Base64)（可以在 java 中做......我也用 ajax 做）并作为“字符串”传输，另一方面，在 web 服务中从 BASE64 编码为二进制...

这是一个想法，这是可行的，但在所有环境中可能都不是“正确的”。

# .net - 在 .NET 中，是否会优化空方法调用？

> ID：11783
> 
> 赞同：25
> 
> 时间：2008-08-14T23:33:35.010
> 
> 标签：.net, performance

给定一个空的方法体，JIT 是否会优化调用（我知道 C# 编译器不会）。我将如何去发现？我应该使用什么工具，我应该在哪里寻找？

因为我确定它会被问到，所以空方法的原因是预处理器指令。

* * *

@Chris：有道理，但它可以优化对方法的调用。所以该方法仍然存在，但可以删除对它的静态调用（或至少内联......）

@Jon：这只是告诉我语言编译器没有做任何事情。我认为我需要做的是通过 ngen 运行我的 dll 并查看程序集。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-08-14T23:43:29.903

这个章节对 JIT 优化有很好的处理，在页面上搜索“方法为空”，它大约在文章的一半 -

[http://www.codeproject.com/KB/dotnet/JITOptimizations.aspx](http://www.codeproject.com/KB/dotnet/JITOptimizations.aspx)

显然，空方法确实通过内联实际上没有代码的内容得到优化。

@Chris：我确实意识到这些方法仍然是二进制文件的一部分，并且这些是 JIT 优化:-)。在一个半相关的注释中，Scott Hanselman 有一篇关于在 Release 构建调用堆栈中内联的非常有趣的文章：

[http://www.hanselman.com/blog/ReleaseISNOTDebug64bitOptimizationsAndCMethodInliningInReleaseBuildCallStacks.aspx](http://www.hanselman.com/blog/ReleaseISNOTDebug64bitOptimizationsAndCMethodInliningInReleaseBuildCallStacks.aspx)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-08-15T08:38:41.137

我猜你的代码是这样的：

```
void DoSomethingIfCompFlag() {
#if COMPILER_FLAG
    //your code
#endif
} 
```

但是，这不会得到优化：

```
partial void DoSomethingIfCompFlag();

#if COMPILER_FLAG
partial void DoSomethingIfCompFlag() {
    //your code
}
#endif 
```

第一个空方法是部分的，C#3 编译器会对其进行优化。

* * *

顺便说一句：这基本上就是部分方法的用途。微软向他们的 Linq 设计器添加了代码生成器，这些代码生成器需要调用默认情况下不执行任何操作的方法。

与其强迫您重载方法，不如使用部分方法。

这样，如果不使用，部分将被完全优化，并且不会损失性能，而不是增加额外的空方法调用的开销。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-14T23:39:53.377

不，空方法永远不会被优化。以下是几个原因：

*   该方法可以从派生类调用，可能在不同的程序集中
*   可以使用反射调用该方法（即使它被标记为私有）

编辑：是的，通过查看那个（出色的）代码项目文档，JITer 将消除对空方法的调用。但是由于我列出的原因，这些方法本身仍将被编译并成为您的二进制文件的一部分。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-14T23:41:30.080

一切都是平等的，是的，它应该被优化出来。JIT 在适当的地方内联函数，没有什么比空函数更合适了:)

如果您真的想确定，请更改您的空方法以引发异常并打印出它包含的堆栈跟踪。

# windows - 支持 Windows 2000 的普遍共识是什么？

> ID：11801
> 
> 赞同：5
> 
> 时间：2008-08-15T00:05:13.760
> 
> 标签：windows, deployment, compatibility

支持 Windows 2000 进行软件分发的普遍共识是什么？人们是否支持 Windows XP SP2+ 进行新软件开发，或者这仍然过于严格？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-08-15T00:07:22.867

“OK”是主观判断。您需要查看您的客户群，看看他们在使用什么。

话虽如此，一年多前我放弃了对 Win2K 的支持，没有任何负面影响。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-16T14:03:35.603

如果他们自己在 .NET 3.5 中不支持它，我会说 MS 已经为您做出了决定。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-16T14:16:29.273

最新版本的WinRAR仍然支持Windows 95。想一想，这是为什么呢？这是因为 WinRAR 解决了一个极其常见的问题——解压文件。人们仍然使用旧系统不是因为他们喜欢它们，而是因为他们被迫使用硬件。如果您正在制作视频游戏，当然，请放弃对 XP SP2 以下任何内容的支持，但如果您正在制作解决特定任务的程序，例如将 RTF 转换为 PDF，我看不出不支持的理由其他系统。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-24T00:15:31.503

这不仅仅是“OK”；这是个好主意。任何鼓励落后者保持现状的事情都是一件好事。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-15T00:09:02.100

我公司的很多电脑都使用 Win2k，所以我们真的不能放弃支持。这一切都取决于客户群。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-15T00:09:46.683

现在 XP 已经 5/6 岁了，我想大多数家庭用户都会使用它，但许多企业用户可能仍在使用它。总而言之，这取决于您的目标受众。我个人认为 Windows 2000 支持是一种奖励，而不是一种要求。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-15T00:10:10.770

这是非常主观的，它真的取决于你卖给谁。

如果是普通的 Joe，那么 Windows 2K 用户最多只能占目标市场的一到两个百分点。如果是军队（我相信他们仍然在他们的硬皮书上运行 2K），那么你就有麻烦了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-15T00:31:58.373

对我来说很好 :) 我为（采矿和建筑）工作的公司员工少于 15,000，我们不支持 Wink2k 并且有一段时间不支持。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-16T14:05:34.320

我会说是的，因为大多数人已经切换到 XP 或 vista，据我所知。

# c# - 通过 Web 服务返回大结果

> ID：11804
> 
> 赞同：9
> 
> 时间：2008-08-15T00:08:15.533
> 
> 标签：c#, .net, web-services

我目前正在开发 Web 服务，返回的结果可能会非常大（> 5mb）。

这组数据这么大是完全有效的，并且 Web 服务可以称为同步或异步，但我想知道人们对以下方面的想法是什么：

1.  如果连接丢失，则必须重新生成整个结果集并再次发送。如果连接丢失或重置，有什么办法可以做任何类型的“恢复”？

2.  发送这么大的结果集是否合适？实现某种“分页”会更好吗？结果集生成并存储在服务器上，然后客户端可以以较小的数量下载结果集的块并在其末端重新组装集？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-28T13:47:30.103

我见过所有三种方法，**分页**、**存储和检索**以及**大规模推送**。

我认为您的问题的解决方案在某种程度上取决于您的结果集为何如此之大以及它是如何生成的。您的结果是否会随着时间的推移而增长，它们是一次计算然后推送的，您是否想在获得它们后立即将它们流回？

## **分页方式**

根据我的经验，当客户端需要快速访问与搜索结果中的页面类似的结果集中大小合理的块时，使用分页方法是合适的。此处的考虑因素是您的协议的整体健谈性、客户端页面请求之间整个结果集的缓存和/或生成结果页面所需的处理时间。

## **存储和检索**

当结果不是随机访问并且结果集随着查询的处理而增长时，存储和检索很有用。这里要考虑的问题是客户端的复杂性，以及是否可以为用户提供部分结果，或者是否需要在将任何内容返回给客户端之前计算所有结果（考虑对来自分布式搜索引擎的结果进行排序）。

## **大规模推动**

大规模推送方法几乎可以肯定是有缺陷的。即使客户端需要所有信息并且需要将其推送到一个单一的结果集中，我还是建议采用`WS-ReliableMessaging`（直接或通过您自己的简化版本）并将结果分块的方法。通过这样做你

1.  确保碎片到达客户手中
2.  一旦您从客户那里收到收据，就可以丢弃该块
3.  可以减少内存消耗的可能问题，因为必须在服务器和客户端保留 5MB 的 XML、DOM 或内存中的任何内容（假设您没有以流方式处理结果）。

就像其他人所说的那样，在您知道结果集大小、生成方式以及整体性能成为实际问题之前，不要做任何事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-15T00:18:19.303

作为结果集大小，没有严格的法律规定 5 Mb。超过 400 Mb 可能[很难发送](http://msdn.microsoft.com/en-us/library/aa528822.aspx)。

您将自动获得异步处理程序（因为您使用的是 .net）

> 实现某种“分页”，其中生成结果集并将其存储在服务器上，然后客户端可以以较小的数量下载结果集的块并在其末端重新组装结果集

这已经发生在你身上——它被称为 tcp/ip ;-) 重新实现可能是矫枉过正。

相似地 -

> 整个结果集必须重新生成并再次发送

例如，如果生成大部分结果集的是 MS-SQL，那么重新生成它将利用 SQL Server 中的一些隐式缓存，并且后续生成会更快。

在某种程度上，您可以不必担心这些问题，直到它们作为“真正的”问题浮出水面——因为您使用的平台为您解决了很多性能瓶颈。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T00:31:36.360

我有点不同意secretGeek 的评论：

> 这已经发生在你身上——它被称为 tcp/ip ;-) 重新实现可能是矫枉过正。

有时您可能只想这样做，但实际上只是从 UI 角度来看。如果您实现某种方式将数据流式传输到客户端（通过类似 pushlets 机制），或者按照您的建议将其分块到页面中，然后您可以在客户端上加载一些非常小的子集，然后慢慢构建 UI全部数据量。

这使得 UI 更流畅、更快速（从用户的角度来看），但您必须评估额外的努力是否值得……因为我认为这不会是微不足道的工作量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T01:40:05.410

因此，听起来您会对将“起始记录号”和“最终记录号”参数添加到您的 Web 方法的解决方案感兴趣。（或“页码”和“每页结果”）

如果后备存储是 sql server（甚至 mysql），这应该不会太难，因为它们内置了对行编号的支持。

尽管如此，您应该能够避免在服务器上进行任何会话管理，避免对结果集进行任何显式缓存，并且只依靠后备存储的缓存来保持简单。

# c# - 如何在 Powershell 中模拟 Active Directory 用户？

> ID：11806
> 
> 赞同：12
> 
> 时间：2008-08-15T00:09:16.407
> 
> 标签：c#, asp.net, powershell, active-directory

我正在尝试通过 Web 界面 (ASP.NET/C#) 运行 powershell 命令，以便在 Exchange 2007 上创建邮箱/等。当我使用 Visual Studio (Cassini) 运行页面时，页面加载正确。但是，当我在 IIS (v5.1) 上运行它时，我收到错误“未知用户名或密码错误”。我注意到的最大问题是 Powershell 是以 ASPNET 而不是我的 Active Directory 帐户登录的。如何强制我的 Powershell 会话使用另一个 Active Directory 帐户进行身份验证？

基本上，我到目前为止的脚本看起来像这样：

```
RunspaceConfiguration rc = RunspaceConfiguration.Create();
PSSnapInException snapEx = null;
rc.AddPSSnapIn("Microsoft.Exchange.Management.PowerShell.Admin", out snapEx);

Runspace runspace = RunspaceFactory.CreateRunspace(rc);
runspace.Open();

Pipeline pipeline = runspace.CreatePipeline();
using (pipeline)
{
   pipeline.Commands.AddScript("Get-Mailbox -identity 'user.name'");
   pipeline.Commands.Add("Out-String");

   Collection<PSObject> results = pipeline.Invoke();

   if (pipeline.Error != null && pipeline.Error.Count > 0)
   {
       foreach (object item in pipeline.Error.ReadToEnd())
          resultString += "Error: " + item.ToString() + "\n";
   }

   runspace.Close();

   foreach (PSObject obj in results)
      resultString += obj.ToString();
}

return resultString; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-15T17:58:18.483

这是我用来模拟用户的类。

```
using System;
using System.Data;
using System.Configuration;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;

namespace orr.Tools
{

    #region Using directives.
    using System.Security.Principal;
    using System.Runtime.InteropServices;
    using System.ComponentModel;
    #endregion

    /// <summary>
    /// Impersonation of a user. Allows to execute code under another
    /// user context.
    /// Please note that the account that instantiates the Impersonator class
    /// needs to have the 'Act as part of operating system' privilege set.
    /// </summary>
    /// <remarks>   
    /// This class is based on the information in the Microsoft knowledge base
    /// article http://support.microsoft.com/default.aspx?scid=kb;en-us;Q306158
    /// 
    /// Encapsulate an instance into a using-directive like e.g.:
    /// 
    ///     ...
    ///     using ( new Impersonator( "myUsername", "myDomainname", "myPassword" ) )
    ///     {
    ///         ...
    ///         [code that executes under the new context]
    ///         ...
    ///     }
    ///     ...
    /// 
    /// Please contact the author Uwe Keim (mailto:uwe.keim@zeta-software.de)
    /// for questions regarding this class.
    /// </remarks>
    public class Impersonator :
        IDisposable
    {
        #region Public methods.
        /// <summary>
        /// Constructor. Starts the impersonation with the given credentials.
        /// Please note that the account that instantiates the Impersonator class
        /// needs to have the 'Act as part of operating system' privilege set.
        /// </summary>
        /// <param name="userName">The name of the user to act as.</param>
        /// <param name="domainName">The domain name of the user to act as.</param>
        /// <param name="password">The password of the user to act as.</param>
        public Impersonator(
            string userName,
            string domainName,
            string password)
        {
            ImpersonateValidUser(userName, domainName, password);
        }

        // ------------------------------------------------------------------
        #endregion

        #region IDisposable member.

        public void Dispose()
        {
            UndoImpersonation();
        }

        // ------------------------------------------------------------------
        #endregion

        #region P/Invoke.

        [DllImport("advapi32.dll", SetLastError = true)]
        private static extern int LogonUser(
            string lpszUserName,
            string lpszDomain,
            string lpszPassword,
            int dwLogonType,
            int dwLogonProvider,
            ref IntPtr phToken);

        [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        private static extern int DuplicateToken(
            IntPtr hToken,
            int impersonationLevel,
            ref IntPtr hNewToken);

        [DllImport("advapi32.dll", CharSet = CharSet.Auto, SetLastError = true)]
        private static extern bool RevertToSelf();

        [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
        private static extern bool CloseHandle(
            IntPtr handle);

        private const int LOGON32_LOGON_INTERACTIVE = 2;
        private const int LOGON32_PROVIDER_DEFAULT = 0;

        // ------------------------------------------------------------------
        #endregion

        #region Private member.
        // ------------------------------------------------------------------

        /// <summary>
        /// Does the actual impersonation.
        /// </summary>
        /// <param name="userName">The name of the user to act as.</param>
        /// <param name="domainName">The domain name of the user to act as.</param>
        /// <param name="password">The password of the user to act as.</param>
        private void ImpersonateValidUser(
            string userName,
            string domain,
            string password)
        {
            WindowsIdentity tempWindowsIdentity = null;
            IntPtr token = IntPtr.Zero;
            IntPtr tokenDuplicate = IntPtr.Zero;

            try
            {
                if (RevertToSelf())
                {
                    if (LogonUser(
                        userName,
                        domain,
                        password,
                        LOGON32_LOGON_INTERACTIVE,
                        LOGON32_PROVIDER_DEFAULT,
                        ref token) != 0)
                    {
                        if (DuplicateToken(token, 2, ref tokenDuplicate) != 0)
                        {
                            tempWindowsIdentity = new WindowsIdentity(tokenDuplicate);
                            impersonationContext = tempWindowsIdentity.Impersonate();
                        }
                        else
                        {
                            throw new Win32Exception(Marshal.GetLastWin32Error());
                        }
                    }
                    else
                    {
                        throw new Win32Exception(Marshal.GetLastWin32Error());
                    }
                }
                else
                {
                    throw new Win32Exception(Marshal.GetLastWin32Error());
                }
            }
            finally
            {
                if (token != IntPtr.Zero)
                {
                    CloseHandle(token);
                }
                if (tokenDuplicate != IntPtr.Zero)
                {
                    CloseHandle(tokenDuplicate);
                }
            }
        }

        /// <summary>
        /// Reverts the impersonation.
        /// </summary>
        private void UndoImpersonation()
        {
            if (impersonationContext != null)
            {
                impersonationContext.Undo();
            }
        }

        private WindowsImpersonationContext impersonationContext = null;

        // ------------------------------------------------------------------
        #endregion
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-15T00:16:34.347

在您的 ASP.NET 应用程序中，您需要模拟具有正确权限的有效 AD 帐户：

[http://support.microsoft.com/kb/306158](http://support.microsoft.com/kb/306158)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T19:12:44.033

出于安全原因，Exchange 2007 不允许您模拟用户。这意味着（目前）不可能通过模拟用户来创建邮箱。为了解决这个问题，我创建了一个在 AD 用户下运行的 Web 服务，该用户有权创建电子邮件帐户等。然后您可以访问此 Web 服务以访问 Powershell。请记住添加必要的安全性，因为这可能是一个巨大的安全漏洞。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-30T18:35:51.107

你可能需要一个补丁。

来自： http: [//support.microsoft.com/kb/943937](http://support.microsoft.com/kb/943937)

> **应用程序无法模拟用户然后在 Exchange Server 2007 环境中运行 Windows PowerShell 命令**
> 
> 若要解决此问题，请安装 Exchange Server 2007 Service Pack 1 的更新汇总 1。

# html - 如何在跨度的 CSS 中创建所有浏览器兼容的悬挂缩进样式

> ID：11809
> 
> 赞同：33
> 
> 时间：2008-08-15T00:12:20.923
> 
> 标签：html, css, indentation

我唯一发现的是；

```
.hang {
    text-indent: -3em;
    margin-left: 3em;
} 
```

唯一可行的方法是将文本放在一个段落中，这会导致那些可怕的难看的额外行。我宁愿把它们放在一种`<span class="hang"></span>`东西里。

我也在寻找一种方法来进一步缩进，而不仅仅是单层悬挂。使用段落来堆叠缩进是行不通的。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-08-15T00:20:58.440

`<span>`是一个内联元素。除非您在谈论段落（通常表示块元素），否则术语*悬挂缩进是没有意义的。*当然，您可以更改`<p>`or`<div>`或任何其他块元素的边距，以消除段落之间的额外垂直空间。

您可能想要类似的东西`display: run-in`，其中标签将根据上下文变为块或内联......遗憾的是，这还[没有被浏览器普遍支持](http://quirksmode.org/css/css2/display.html)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-11-11T06:41:49.443

找到了一种很酷的方法来做到这一点，减去讨厌的跨度。

```
p {
  padding-left: 20px; 
} 

p:first-letter {
  margin-left: -20px;
} 
```

很好很简单：D

如果换行符在 p 块中打扰您，您可以添加

```
p {
  margin-top: 0px;
  margin-bottom: 0px;
} 
```

[JSFiddle 示例](http://jsfiddle.net/agweber/9dmtfhw2/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-04-29T00:17:36.707

ysth 的答案最好有一个有争议的例外；度量单位应对应于字体的大小。

```
p {
  text-indent: -2en; 
  padding-left: 2en;
} 
```

“3”也可以很好地工作；不推荐使用“em”，因为它比字母集中的平均字符宽。仅当您打算对齐具有不同字体大小的文本块的挂起时，才应使用“px”。

# xml - 通过 Web 服务将文件作为字节数组发送时会产生多少额外开销？

> ID：11820
> 
> 赞同：4
> 
> 时间：2008-08-15T00:29:57.563
> 
> 标签：xml, web-services

此[问答](https://stackoverflow.com/questions/11782/file-uploads-via-web-services)展示了如何通过 XML Web 服务将文件作为字节数组发送。使用这种方法进行文件传输会产生多少开销？我假设数据看起来像这样：

```
<?xml version="1.0" encoding="UTF-8" ?>
<bytes>
    <byte>16</byte>
    <byte>28</byte>
    <byte>127</byte>
    ...
</bytes> 
```

如果此格式正确，则必须首先将字节转换为 UTF-8 字符。这些字符中的每一个分配 8 个字节。字节是以 10 为基数、十六进制还是二进制字符存储的？由于 XML 数据和字符编码，文件在发送时看起来要大多少？压缩是内置在 Web 服务中的吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-15T00:39:05.987

通常，字节数组作为`base64`编码字符串发送，而不是标签中的单个字节。

[http://en.wikipedia.org/wiki/Base64](http://en.wikipedia.org/wiki/Base64)

`base64`编码版本约为原始内容大小的**137%**。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T00:36:54.073

我将这种方法用于一些内部公司 Web 服务，我没有注意到任何重大的减速（但这并不意味着它不存在）。

您可能可以使用众多网络流量分析工具中的任何一种来测量数据的大小，并据此做出判断。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T00:40:14.033

我不确定所有细节（压缩、编码等），但我通常只使用[WireShark](http://www.wireshark.org/)来分析网络流量（同时尝试各种方法），然后您就可以准确地看到它是如何发送的。

例如，如果它被压缩，则数据包的数据块不应该作为纯文本读取......但是如果它没有被压缩，你只会看到普通的旧 xml 文本......就像你会看到 HTTP 流量，甚至 FTP在某些情况下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T00:48:55.420

为了回应 Kevin 所说的，在 .net Web 服务中，如果你有一个字节数组，默认情况下它会作为 base64 编码的字符串发送。您还可以预先指定字节数组的编码。

显然，一旦它到达服务器（或客户端），您需要手动将字符串解码回字节数组，因为不幸的是，这不会自动为您完成。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-23T19:24:17.067

主要的性能损失不会来自编码文件的传输，而是服务器必须对文件进行预传输进行编码的处理（除非文件不经常更改并且编码版本可以以某种方式缓存）。

# language-agnostic - 单身人士：好的设计还是拐杖？

> ID：11831
> 
> 赞同：68
> 
> 时间：2008-08-15T00:39:01.150
> 
> 标签：language-agnostic, design-patterns, singleton

单例是一种备受争议的设计模式，所以我对 Stack Overflow 社区对它们的看法很感兴趣。

请为您的观点提供理由，而不仅仅是“单身人士适合懒惰的程序员！”

这是一篇关于这个问题的相当好的文章，虽然它反对使用单例： [scientificninja.com:performant-singletons](http://web.archive.org/web/20090303174418/http://scientificninja.com/advice/performant-singletons)。

有没有人有其他关于他们的好文章？也许支持单身人士？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-09-15T17:38:23.497

为单身人士辩护：

*   **它们没有全局变量那么糟糕，**因为全局变量没有标准强制的初始化顺序，而且由于幼稚或意外的依赖顺序，您很容易看到不确定的错误。单例（假设它们是在堆上分配的）是在所有全局变量之后创建的，并且位于代码中一个非常可预测的位置。
*   **它们对于资源惰性/缓存系统非常有用，**例如连接到慢速 I/O 设备的接口。如果你智能地为一个慢速设备构建一个单例接口，并且没有人调用它，你就不会浪费任何时间。如果另一段代码从多个地方调用它，您的单例可以同时优化两者的缓存，并避免任何重复查找。您还可以轻松避免单例控制资源上的任何死锁情况。

反对单身人士：

*   **在 C++ 中，在单例之后没有自动清理的好方法。** 有一些变通方法，以及稍微有点老套的方法，但是没有简单、通用的方法来确保你的单例的析构函数总是被调用。这在记忆方面并不是那么糟糕——为此目的，只需将其视为更多的全局变量。但是，如果您的单例分配了其他资源（例如锁定某些文件）并且不释放它们，则可能会很糟糕。

我自己的看法：

我使用单例，但如果有合理的选择，请避免使用它们。到目前为止，这对我来说效果很好，而且我发现它们是可测试的，尽管需要做更多的测试工作。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-08-15T02:40:44.337

Google 有一个用于 Java 的[Singleton Detector](http://code.google.com/p/google-singleton-detector/)，我相信它最初是一个工具，必须在 Google 生成的所有代码上运行。删除单例的简单原因：

> 因为它们会使测试变得困难并隐藏设计中的问题

有关更明确的解释，请参阅 Google 的“[为什么单身人士有争议](http://code.google.com/p/google-singleton-detector/wiki/WhySingletonsAreControversial)”。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-08-15T02:12:11.260

单例只是一堆花哨的全局变量。

全局变量和单例一样有它们的用途，但是如果您认为使用单例而不是使用令人讨厌的全局变量（每个人都知道全局变量是不好的），那么您会被误导。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-08-15T00:48:40.523

单例的目的是确保一个类只有一个实例，并提供对它的全局访问点。大多数时候，重点是单个实例点。想象一下，如果它被称为 Globalton。这听起来不那么吸引人，因为这强调了（通常）全局变量的负面含义。

大多数反对单例的好论据都与它们在测试中存在的困难有关，因为为它们创建测试替身并不容易。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2008-09-15T17:52:06.537

在 Google 测试博客中， [Miško Hevery 写](http://misko.hevery.com/about/)了三篇关于单例的非常好的博客文章。

1.  [单身人士是病态的骗子](http://googletesting.blogspot.com/2008/08/by-miko-hevery-so-you-join-new-project.html)
2.  [所有单身人士都去哪儿了？](http://googletesting.blogspot.com/2008/08/where-have-all-singletons-gone.html)
3.  [单身人士的根本原因](http://googletesting.blogspot.com/2008/08/root-cause-of-singletons.html)

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2009-02-19T22:33:43.710

单例模式**并不是**一个可怕的模式，尽管它被**滥用**了很多。我认为这种误用是因为它是一种更简单的模式，而且大多数单身人士都被全局副作用所吸引。

[Erich Gamma](http://www.se-radio.net/podcast/2007-12/episode-81-interview-erich-gamma)曾说过，单例模式是他希望 GOF 书中没有包含的模式，这是一个糟糕的设计。我倾向于不同意。

如果在任何给定时间使用该模式来创建对象的单个实例，则该模式被正确使用。如果为了产生全局效果而使用单例，那么它的使用不正确。

缺点：

*   您在整个调用单例的代码中耦合到一个类
    *   单元测试很麻烦，因为很难用模拟对象替换实例
    *   如果由于需要多个实例而需要稍后重构代码，这比将单例类传递给使用它的对象（使用接口）更痛苦

优点：

*   在任何给定时间点都表示一个类的实例。
    *   按照设计，您正在执行此操作
*   需要时创建实例
*   全局访问是一个副作用

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2009-09-09T17:14:22.987

小鸡们喜欢我，因为我很少使用单例，而且当我这样做时，它通常是不寻常的。不，说真的，我喜欢单例模式。你知道为什么？因为：

1.  我很懒。
2.  什么都不会出错。

当然，“专家”会抛出一堆关于“单元测试”和“依赖注入”的讨论，但这都是野狗的肾脏负担。你说单例很难进行单元测试？没问题！只需将所有内容都公开，然后将您的班级变成一个有趣的全球善良之家。你还记得 1990 年代的汉兰达节目吗？单例有点像这样，因为： A. 它永远不会死；B. 只能有一个。所以不要再听那些 DI 小鬼了，放弃实现你的单例。这里有一些更充分的理由......

*   每个人都在做。
*   单例模式让你立于不败之地。
*   Singleton 与“win”（或“fun”，取决于你的口音）押韵。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-08-27T01:20:26.250

我认为对于单例模式的使用存在很大的误解。这里的大多数评论都将其称为访问全局数据的地方。我们需要在这里小心——单例模式**不是**用于访问全局变量。

单例应该用于**只有一个给定类的实例**。[Pattern Repository](http://www.netobjectivesrepository.com/)有很多关于[Singleton](http://www.netobjectivesrepository.com/TheSingletonPattern)的信息。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-22T11:48:58.713

我曾与之共事的一位同事非常有单身主义思想。每当有什么像经理或老板这样的对象时，他都会把它变成一个单身人士，因为他认为应该只有一个老板。每次系统接受一些新要求时，结果证明有完全正当的理由允许多个实例。

如果域模型规定（不是“建议”）有一个，我会说应该使用单例。所有其他情况只是一个类的偶然的单个实例。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-08-15T02:54:53.653

我一直在想办法在这里拯救可怜的辛格尔顿，但我必须承认这很难。我很少看到它们的合法用途，并且在当前驱动进行依赖注入和单元测试的情况下，它们很难使用。它们绝对是使用设计模式进行编程的“货物崇拜”表现形式。我曾与许多从未破解过“GoF”书但他们知道“Singelton”的程序员一起工作，因此他们知道“模式”。

不过，我确实不得不不同意 Orion，大多数时候我看到单人过度使用它不是连衣裙中的全局变量，而更像是连衣裙中的全局服务（方法）。有趣的是，如果您尝试通过 CLR 接口在安全模式下使用 SQL Server 2005 中的 Singeltons，系统将标记代码。问题是您拥有超出可能运行的任何给定事务的持久数据，当然，如果您将实例变量设置为只读，您可以解决这个问题。

这个问题导致了我一年的大量返工。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-08-23T17:22:32.087

圣战！好的让我看看..上次我检查设计警察说..

单例是不好的，因为它们阻碍了自动测试——不能为每个测试用例重新创建实例。相反，逻辑应该在可以轻松实例化和测试的类 (A) 中。另一个类 (B) 应该负责约束创建。单一责任原则脱颖而出！应该是团队知识，您应该通过 B 访问 A - 一种团队约定。

我主要同意。。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-02-18T19:52:09.283

许多应用程序要求某个类只有一个实例，因此只有一个类实例的模式很有用。*但是该模式的实现*方式存在差异。

有**静态单例**，其中类强制每个进程只能有一个类的实例（在 Java 中实际上每个 ClassLoader 一个）。另一种选择是**只创建一个实例**。

静态单例是*邪恶*的——一种全局变量。它们使测试变得更加困难，因为不可能完全隔离地执行测试。您需要复杂的设置和拆卸代码来在每次测试之间清理系统，并且很容易忘记正确清理某些全局状态，这反过来可能会导致测试中出现未指定的行为。

只创建一个实例是*好的*。您只需在程序启动时创建一个实例，然后将指向该实例的指针传递给需要它的所有其他对象。依赖注入框架使这很容易——您只需配置对象的范围，DI 框架将负责创建实例并将其传递给所有需要它的人。例如，在 Guice 中，您将使用 @Singleton 注释该类，并且 DI 框架将只创建该类的一个实例（每个应用程序 - 您可以在同一个 JVM 中运行多个应用程序）。这使测试变得容易，因为您可以为每个测试创建一个新的类实例，并让垃圾收集器在不再使用该实例时将其销毁。没有全局状态会从一个测试泄漏到另一个测试。

欲了解更多信息： [清洁代码会谈 - “全球状态和单身人士”](http://www.youtube.com/watch?v=-FRm3VPhseI)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-02-18T19:49:34.360

单例作为实现细节很好。单例作为接口或访问机制是一个巨大的 PITA。

不带参数返回对象实例的静态方法与仅使用全局变量略有不同。相反，如果一个对象通过构造函数或其他方法对传入的单例对象具有引用，那么实际创建单例的方式并不重要，整个模式也无关紧要。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-16T10:55:57.993

单例的最大问题是它们使单元测试变得*困难*，特别是当您想要并行但独立地运行测试时。

第二个是人们通常认为带有双重检查锁定的延迟初始化是实现它们的好方法。

最后，除非您的单例是不可变的，否则当您尝试扩展应用程序以在多个处理器上的多个线程中运行时，它们很容易成为性能问题。在大多数环境中，竞争同步的成本很高。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-08-15T05:22:48.177

> 这不仅仅是一堆花里胡哨的变量，因为它有几十个职责，比如与持久层通信以保存/检索有关公司的数据，处理员工和价格集合等。

我必须说，您并没有真正描述应该是单个对象的东西，而且除了数据序列化之外，它们中的任何一个都应该是一个单例，这是值得商榷的。

我可以看到至少 3 组我通常会在其中设计的类，但我倾向于更小、更简单的对象，它们可以很好地完成一组狭窄的任务。我知道这不是大多数程序员的天性。（是的，我每天都在研究 5000 行类的怪物，我特别喜欢有人写的 1200 行方法。）

我认为关键在于，在大多数情况下，您不需要单刀，而且通常只会让您的生活更加艰难。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-08-15T01:48:54.927

单例有其用途，但在使用和公开它们时必须小心，因为它们[太容易被滥用](http://dotnet.kapenilattex.com/?p=35)，难以真正进行单元测试，并且很容易基于两个相互访问的单例创建循环依赖。

然而，这很有帮助，因为当您想确保所有数据在多个实例之间同步时，例如，分布式应用程序的配置可能依赖单例来确保所有连接都使用相同的 up-to-日期数据集。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-08-15T02:50:15.003

我发现你必须非常小心**为什么**决定使用单例。正如其他人所提到的，这与使用全局变量本质上是相同的问题。您必须非常谨慎，并考虑使用一个可以做什么。

很少使用它们，通常有更好的方法来做事。我遇到过这样的情况，我用一个单例做了一些事情，然后在我发现它使事情变得更糟之后（或者在我想出了一个更好、更理智的解决方案之后，我不得不筛选我的代码以将其取出） )

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-08-27T18:14:06.783

我已经多次将单例与[Spring](http://www.springframework.org/)结合使用，并且不认为它是拐杖或懒惰的。

这种模式允许我为一堆配置类型值创建一个类，然后在我的 Web 应用程序的多个用户之间共享该特定配置实例的单个（非可变）实例。

就我而言，单例包含特定于该客户端的客户端配置条件——css 文件位置、数据库连接条件、功能集等。这些类通过 Spring 实例化和访问，并由具有相同配置的用户（即来自同一公司的 2 个用户）共享。* **我知道这种类型的应用程序有一个名称，但它在逃避我*

我觉得为应用程序的每个用户创建（然后是垃圾收集）这些“常量”对象的新实例会很浪费。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-10-22T05:18:53.267

我正在阅读很多关于“Singleton”、它的问题、何时使用它等内容，这些是我到现在为止的结论：

*   单例的经典实现和真正的需求之间的混淆：只有一个类的实例！

*   实施起来通常很糟糕。如果您想要一个唯一的实例，请不要使用返回静态对象的静态 GetInstance() 方法的（反）模式。这使得一个类负责实例化自身的单个实例并执行逻辑。这打破了[单一职责原则](http://en.wikipedia.org/wiki/Single_responsibility_principle)。相反，这应该由一个负责确保只存在一个实例的工厂类来实现。

*   它在构造函数中使用，因为它易于使用并且不能作为参数传递。这应该使用[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)来解决，这是实现良好且可测试的对象模型的绝佳模式。

*   不是[TDD](http://en.wikipedia.org/wiki/Test-driven_development)。如果您使用 TDD，则会从实现中提取依赖项，因为您希望测试易于编写。这使您的对象模型更好。如果您使用 TDD，则不会编写静态 GetInstance =)。顺便说一句，如果您考虑具有明确职责的对象而不是类，您将获得相同的效果 =)。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-08-15T03:40:26.870

我真的不同意*化装*创意中的一堆全局变量。当用于解决正确的问题时，单例非常有用。让我给你一个真实的例子。

我曾经为我工作的地方开发了一个小软件，有些表格必须使用有关公司、员工、服务和价格的一些信息。在它的第一个版本中，每次打开表单时，系统都会不断地从数据库中加载数据。当然，我很快意识到这种方法不是最好的。

然后我创建了一个名为*company*的单例类，它封装了关于这个地方的所有内容，并且在系统打开时它已经完全填充了数据。

这不仅仅是一堆花里胡哨的变量，因为它有几十个职责，比如与持久层通信以保存/检索有关公司的数据，处理员工和价格集合等。

此外，它是一个固定的、系统范围的、易于访问的公司数据点。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-02-18T19:25:37.570

编写普通的、可测试的、可注入的对象，让 Guice/Spring/whatever 处理实例化。严重地。

这甚至适用于缓存或单例的任何自然用例。**没有必要重复编写代码来尝试强制执行一个实例的恐怖。**让您的依赖注入框架处理它。（如果您还没有使用轻量级 DI 容器，我推荐 Guice）。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-17T20:04:45.420

例如 Java 中的单例的一件可怕的事情是，在某些情况下，您最终可能会得到同一个单例的多个实例*。*JVM 基于*两个*元素唯一标识：一个类的完全限定名，以及负责加载它的类加载器。

这意味着同一个类可以由两个彼此不知道的类加载器加载，并且应用程序的不同部分将具有与之交互的此单例的不同实例。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-15T17:24:18.210

单例非常有用，使用它们本身并不是一种反模式。然而，他们之所以声名狼藉，主要是因为他们强迫任何消费代码承认他们是单例的，以便与他们进行交互。这意味着如果您需要“取消单一化”它们，对您的代码库的影响可能非常显着。

相反，我建议要么将 Singleton 隐藏在工厂后面。这样，如果您将来需要更改服务的实例化行为，您可以只更改工厂而不是使用 Singleton 的所有类型。

更好的是，使用控制容器的反转！它们中的大多数允许您将实例化行为与类的实现分开。

# c++ - 继承和多态 - 易用性 vs 纯度

> ID：11854
> 
> 赞同：6
> 
> 时间：2008-08-15T01:00:47.690
> 
> 标签：c++, inheritance, oop, polymorphism

在一个项目中，我们的团队正在使用对象列表对应该以类似方式处理的数据集执行大规模操作。特别是，不同的对象在理想情况下会表现相同，这很容易通过多态性实现。我遇到的问题是继承意味着*是一种*关系，而不是*有一种*关系。例如，几个对象*有一个*伤害计数器，但是为了使它易于在对象列表中使用，可以使用多态性——除非这意味着一个不正确*的*关系。（人*不是*伤害计数器。）

我能想到的唯一解决方案是让类的成员在隐式转换时返回正确的对象类型，而不是依赖于继承。放弃*is a* / *has a* Ideal 以换取易于编程会更好吗？

编辑：更具体地说，我使用的是 C++，因此使用多态性将允许不同的对象“行为相同”，因为派生类可以驻留在单个列表中并由基的虚函数操作班级。使用接口（或通过继承模仿它们）似乎是我愿意使用的解决方案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-15T01:54:52.993

我认为您应该实现接口以便能够强制执行您*的*关系（我在 C# 中这样做）：

```
public interface IDamageable
{
    void AddDamage(int i);
    int DamageCount {get;}
} 
```

你可以在你的对象中实现它：

```
public class Person : IDamageable

public class House : IDamageable 
```

并且您可以确定 DamageCount 属性并有一种方法可以让您增加损坏，而不会暗示人和房屋在某种层次结构中相互关联。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-15T03:41:05.930

这可以使用多重继承来完成。在您的特定情况下（C++），您可以使用纯虚拟类作为接口。这允许您在不产生范围/歧义问题的情况下进行多重继承。例子：

```
class Damage {
    virtual void addDamage(int d) = 0;
    virtual int getDamage() = 0;
};

class Person : public virtual Damage {
    void addDamage(int d) {
        // ...
        damage += d * 2;
    }

    int getDamage() {
        return damage;
    }
};

class Car : public virtual Damage {
    void addDamage(int d) {
        // ...
        damage += d;
    }

    int getDamage() {
        return damage;
    }
}; 
```

现在 Person 和 Car 'is-a' Damage 都实现了，这意味着它们实现了 Damage 接口。使用纯虚拟类（因此它们就像接口）是关键，应该经常使用。它将未来的变化与改变整个系统隔离开来。阅读开闭原则以获取更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T09:56:36.310

我同意 Jon 的观点，但假设您仍然需要单独的伤害计数器类，您可以这样做：

```
class IDamageable {
  virtual DamageCounter* damage_counter() = 0;
};
class DamageCounter {
  ...
}; 
```

然后，每个可损坏类都需要提供自己的 damage_counter() 成员函数。这样做的缺点是它为每个可损坏类创建一个 vtable。您可以改为使用：

```
class Damageable {
 public:
  DamageCounter damage_counter() { return damage_counter_; }
 private:
  DamageCounter damage_counter_;
}; 
```

但是当多个父级具有成员变量时，许多人对多重继承**并不酷。**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T01:13:01.660

有时为了现实放弃理想是值得的。如果它会导致一个巨大的问题来“做对”而没有真正的好处，那么我会做错事。话虽如此，我经常认为值得花时间把它做好，因为不必要的多重继承会增加复杂性，并且*会*导致系统的可维护性降低。你真的必须决定什么是最适合你的情况。

一种选择是让这些对象实现一个`Damageable`接口，而不是继承自`DamageCounter`. 这样，一个人*就有了一个*伤害计数器，但*它是*可损坏的。（我经常发现接口作为形容词比名词更有意义。）然后你可以在`Damageable`对象上有一个一致的损坏接口，而不是暴露损坏计数器是底层实现（除非你需要）。

如果你想走模板路线（假设 C++ 或类似的），你可以用 mixins 来做这件事，但如果做得不好，那会很快变得丑陋。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-15T01:15:32.417

通常，当我们谈论“is a”与“has a”时，我们谈论的是继承与组合。

嗯...损害计数器只是您的派生类之一的属性，并且不会就您的问题以“一个人是损害计数器”的方式进行讨论。

看到这个：

[http://www.artima.com/designtechniques/compoinh.html](http://www.artima.com/designtechniques/compoinh.html)

这可能会帮助你一路走来。

@ **[Derek](https://stackoverflow.com/questions/11854/inheritance-and-polymorphism-ease-of-use-vs-purity#11864)**：从措辞来看，我认为有*一个*基本条件，重新阅读了我现在有点明白他在说什么的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-15T01:17:13.803

这个问题真的很混乱：/

您的粗体问题非常开放，并且答案是“取决于”，但是您的示例并没有真正提供有关您所询问的上下文的太多信息。这些台词让我感到困惑；

> > 应该以类似方式处理的数据集

有什么办法？集合是否由函数处理？另一个班级？通过数据上的虚函数？

> > 特别是，不同的对象在理想情况下会表现相同，这很容易通过多态性实现

“行为相同”的理想和多态性是绝对无关的。多态性如何使其易于实现？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-15T01:22:11.953

@凯文

> 通常，当我们谈论“is a”与“has a”时，我们谈论的是继承与组合。
> 
> 嗯...损害计数器只是您的派生类之一的属性，并且不会就您的问题以“一个人是损害计数器”的方式进行讨论。

将伤害指示物作为一个属性不允许他将具有伤害指示物的不同对象合并到一个集合中。例如，一个人和一辆车可能都有损坏计数器，但在大多数语言中你不能有 a`vector<Person|Car>`或 a或任何类似的东西。`vector<with::getDamage()>`如果您有一个通用的 Object 基类，那么您可以以这种方式推送它们，但是您不能`getDamage()`一般地访问该方法。

当我读到它时，这就是他问题的本质。“我是否应该违反`is-a`并且`has-a`为了将某些对象视为相同，即使它们不是相同的？”

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-15T01:29:00.770

从长远来看，“做对”会带来好处，只是因为以后维护系统的人会发现如果一开始就做对了，就会更容易理解。

根据语言的不同，您可能会选择多重继承，但通常简单的接口最有意义。我所说的“简单”是指制作一个不想要太多的界面。最好有很多简单的接口和一些单一的接口。当然，总有一个权衡，太多的接口可能会导致那些被“遗忘”...

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-15T01:29:19.193

@安德鲁

> “行为相同”的理想和多态性是绝对无关的。多态性如何使其易于实现？

它们都具有例如一个共同的功能。让我们称之为`addDamage()`。如果你想做这样的事情：

```
foreach (obj in mylist)
    obj.addDamage(1) 
```

然后您需要一种动态语言，或者您需要它们从一个公共父类（或接口）扩展。例如：

```
class Person : DamageCounter {}
class Car : DamageCounter {}

foreach (DamageCounter d in mylist)
    d.addDamage(1) 
```

然后，您可以在某些非常有用的情况下进行相同的`Person`处理。`Car`

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-01-18T21:29:48.753

多态性*不需要继承*。当多个对象实现相同的消息签名（方法）时，就会得到多态性。

# svn - 您使用什么来替代 Team System？

> ID：11857
> 
> 赞同：28
> 
> 时间：2008-08-15T01:05:30.520
> 
> 标签：svn, tfs, cruisecontrol.net, fogbugz

我想评估其他人为获得 Team System 功能而采取的解决方案。我们都知道 Team System 对我们中的一些人来说可能很昂贵。我知道他们提供带有 MSDN 订阅的五个许可证的小型团队版本，但是如果您的团队大于五个或者您不想使用 Team System，该怎么办？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-06T08:23:52.187

令我震惊的是，没有人提到 JetBrains 提供的**免费**且出色的[TeamCity](http://www.jetbrains.com/teamcity/index.html)产品。这包括：

*   持续集成
*   软件构建管理
*   项目管理、监测和统计报告
*   与许多 IDE、源代码控制系统和测试框架集成

对于项目管理/错误跟踪/Git 或 Subversion 存储库，我还使用[Unfuddle](http://unfuddle.com/)（对于小型个人项目**免费！）**

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-15T22:17:09.210

我将第二次 Trac + Subversion。虽然没有什么是完美的，但这种组合对我来说效果很好，而且价格合适。

即使对于我独自工作的项目，将这两者结合起来也很不错。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-15T01:44:36.103

我在 SourceGear vault 和 FogBugz 之间的良好集成方面取得了很大的成功。

用于构建自动化的 MS Build 满足了我的需求。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-19T06:28:34.437

将我的答案从问题中取出，并将其作为 StackOverflow FAQ 的答案之一发布。

这是我使用的解决方案，效果很好：

*   源代码控制的[颠覆](http://subversion.tigris.org/)
*   我的 Subversion Web 浏览器的[仓库](http://warehouseapp.com/)
*   [FogBugz](http://www.fogcreek.com/fogbugz/)用于功能和错误跟踪，它与 Subversion、Visual Studio 和 Warehouse 集成
*   用于将 Subversion 集成到 Visual Studio 的[VisualSVN](http://www.visualsvn.com/visualsvn/)
*   [CruiseControl.Net](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)和[nAnt](http://nant.sourceforge.net/)用于我的 .Net 项目自动构建系统
*   [CruiseControl.rb](http://cruisecontrolrb.thoughtworks.com/)和[Capistrano](http://www.capify.org/)用于我的 Ruby on Rails 项目的自动构建系统

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-15T03:44:10.153

Sourcegear 的产品套件是一个非常不错的选择。Vault + Dragnet + Fortress 很不错，但是如果你买不起所有这些，Vault + FogBugz 是一个相当不错的选择。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-08-15T15:24:57.390

[追踪](http://trac.edgewall.org)

它似乎针对开源/社区类型的项目，但它只是作为内部开发人员内部网工作。它将 Wiki、Bug 跟踪器和 SVN 源浏览器集成到一个漂亮的包中，并且非常易于配置。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-15T01:44:11.003

我在家用电脑上使用 SourceGear 的 Fortress 进行个人开发。它对单个用户免费。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-08-15T03:03:14.387

我使用[VisualSVN Server](http://www.visualsvn.com/)进行源代码控制，使用[Mingle](http://studios.thoughtworks.com/mingle-project-intelligence)进行项目管理和错误跟踪，使用[Team City](http://www.jetbrains.com/teamcity/)进行持续集成。我仍然习惯它，但到目前为止它工作得很好。对于小型团队来说，这是一个很好的免费设置。对于大型团队来说，许可 Mingle 和 Team City 会花钱。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-16T17:20:08.523

Seapine CM - 跨平台问题管理和版本控制

[http://www.seapine.com](http://www.seapine.com)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-17T06:18:38.910

For a lightweight & completely free option, you can use Springloops integrated with Basecamp (+ an SVN client).

*   Hosted SVN: SpringLoops: [http://www.springloops.com/](http://www.springloops.com/) (free for a single project & user)
*   Basecamp: [http://basecamphq.com/](http://basecamphq.com/) (also free for a single project)

Note: SpringLoops integration with Basecamp is not available in their free setup.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-18T00:54:23.213

我也在 Linux 上进行开发，这也是我想出我所拥有的解决方案的原因之一。我想知道 SourceGear 选项在这方面是如何工作的？我以前使用过 Vault，以我的经验来说还不错，但我知道它主要是基于 Windows 的。我想我曾经读到他们有一个可以在 Linux 上运行的客户端，但我从未使用过它。我只是想进一步展开对话，所以提出这个问题的人可以希望根据他们的需要找到最适合他们的答案。

如果 Vault 客户端可以在 Linux 和 Mac 上运行并且运行良好，那么使用 Vault 和 Fortress 作为 Team System 的良好低成本替代方案肯定是公认的答案。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-16T18:06:33.483

带有 TortoiseSVN 插件的 SVN 提供了一个可靠且易于使用的界面。WinMerge 也是一个很好的工具。

# .net - 频繁更改数据库的最佳 .NET 解决方案

> ID：11878
> 
> 赞同：8
> 
> 时间：2008-08-15T01:50:02.473
> 
> 标签：.net, database, change-management

我目前正在构建一个小型 CRUD 应用程序。他们的数据库是一团糟，在接下来的 6 个月到一年的时间里会经常变化。你会为我的数据层推荐什么：

1）ORM（如果是，是哪一个？）

2）Linq2Sql

3) 存储过程

4) 参数化查询

我真的需要一个足够动态（既快速又简单）的解决方案，我可以在其中经常替换表和添加/删除列。

注意：我对 ORM 没有太多经验（只有一点 SubSonic），并且通常倾向于使用存储过程，所以也许这就是要走的路。我很想学习 Ling2Sql 或 NHibernate，如果两者都允许我上面描述的情况。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-15T03:37:32.430

这里要注意的一件关键事情是，如果数据库模式经常更改，您希望具有某种程度的编译时类型安全性。我发现这是 NHibernate 的一个问题，因为它使用 xml 映射文件，因此如果您更改数据库模式中的某些内容，直到运行时您才知道映射已损坏。

存储过程也将是一个问题。

使用 Linq2Sql 的优势在于，当您在编译时更改架构时，您可以知道代码到底在哪里中断。对我来说，如果我正在使用经常更改的架构，这将优先于其他所有事情

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-15T03:57:06.273

我会使用构建提供程序（网站项目）设置来查看 SubSonic。这很有效，因为它会在您每次构建项目时自动重新生成 DAL 对象，因此如果数据库以破坏代码的方式发生更改，您会收到构建错误。

在数据库模式变得非常复杂并且我们达到了 ActiveRecord 模式的限制之前，它运行良好，但只要模式不是非常复杂，它就可以很好地工作。架构稳定后，您可以切换以便仅在需要时构建 DAL。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T18:40:41.747

你肯定想使用 ORM。任何 ORM 都可以，但您需要能够生成强类型类的东西。当从表中添加、修改或删除字段时，您希望能够重新生成这些类，并且只处理修复编译时错误。如果您使用动态模型，您可能会遇到许多令人讨厌的运行时错误。这个非常重要！我是 sourceforge 的[MyGeneration](http://www.mygenerationsoftware.com/)开发团队的一员，我认为这是解决您问题的好方法。您可以生成 dOOdads、NHibernate、EasyObjects、EntitySpaces 等。如果您想使用更昂贵的解决方案，请使用[CodeSmith](http://www.codesmithtools.com/)或[LLBLGen Pro](http://www.llblgen.com/defaultgeneric.aspx)。祝你好运 - 任何有兴趣使用 MyGeneration 的人，如有问题请随时与我联系。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-15T02:00:55.353

[NHibernate](http://www.hibernate.org/343.html)，但前提是您愿意采用对象优先的方法来定义类，然后在映射文件中定义所需的表结构，然后使用 NHibernate 的内置模式生成类创建数据库模式。

反过来做（例如，你有一堆表，然后你的对象设计以此为基础）我发现[MyGeneration](http://www.mygenerationsoftware.com/) + NHibernate 可以工作，尽管我对结果类不太满意（主要是因为我是真正的面向对象编程的忠实拥护者）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-19T16:54:48.487

如果我站在你的立场上，我会尝试将我所知道的（存储过程）与 Linq2Sql 结合起来。Linq2Sql 仍然可以使用你的存储过程，但是你有一个额外的好处，那就是在你的腰带上放一个新工具。我认为掌握 Linq2XXX（X 是一种随机技术而不是成人娱乐......现在我认为这不是一个坏主意）语法和方法将成为你使用技能的一个很好的补充在对象集合上的 Linq 非常甜蜜。

但从长远来看，最终像 NHibernate 这样的东西会更适合你。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T14:30:23.527

EntitySpaces 可以在一分钟内重新生成您的 DAL/业务层，并且不会丢失代码，请参阅试用版 ==>[这里](http://www.entityspaces.net/portal/TrialDownload/tabid/177/Default.aspx)

无需注册，也可在 Visual Studio 下运行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-05-08T21:09:21.907

使用实体空间。你会送我花，保证。就是棒。根据需要更改数据库。按下按钮，砰。您的所有更改都已完成。无需更改您的自定义代码。我喜欢它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-05-08T22:00:21.673

应用程序有多简单？如果我要在几个月内使用架构/设计的东西，而不是真正担心实际的应用程序。. . 我会考虑使用 EDM 和动态数据实体 Web 应用程序项目。在我看来，这可以让你以最少的努力去做。这让你专注于模式、数据和其他时髦的东西。我希望不会从这个中得到太多的负面影响！

新项目对话框如下[所示](http://www.flickr.com/photos/markandjamie/4590272584/sizes/o/in/set-72157623895271809/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-15T02:05:46.747

您已经对存储过程感到满意，它们可能足以抽象出不断变化的模式。如果 ORM 对存储过程不满意，那么他们可能会使用在不断变化的架构上保持最新的视图。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T18:54:35.160

如果数据库架构经常更改，则首选实体框架而不是 LINQ2SQL。如果架构发生变化，使用 L2S，您必须
1）删除并重新添加您的表（失去您的自定义）
2）手动修改模型（如在 stackoverflow 中所做的）

EF 是 L2S 的超集，为您提供更大的使用灵活性和 dbms 独立性

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-17T19:06:27.783

看看它为什么会发生变化，看看你是否可以预测和概括即将发生的变化类型，这样它们就不会破坏你的代码

框架可能使适应变化更容易，但更深入的分析将有长期的好处

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-17T19:13:22.137

任何解决方案都可以工作，您真正需要的是一组测试，以保证插入、选择、更新和删除等基本操作有效。这样您就可以简单地运行测试并检查映射是否是最新的。

# web-services - 是否可以从 WebService 返回对象？

> ID：11879
> 
> 赞同：6
> 
> 时间：2008-08-15T01:51:48.663
> 
> 标签：web-services

有没有办法返回经典对象，而不是返回一个公共字符串？如果不是：最佳实践是什么？您是否将对象转换为 xml 并在另一侧重建对象？其他的可能性是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-15T02:23:16.150

如前所述，您可以通过序列化在 .net 中执行此操作。默认情况下，所有本机类型都是可序列化的，因此这会自动为您发生。

但是，如果您有复杂的类型，则需要使用 [Serializable] 属性标记对象。复杂类型作为属性也是如此。

因此，例如，您需要：

```
[Serializable]
public class MyClass
{
    public string MyString {get; set;}

    [Serializable]
    public MyOtherClass MyOtherClassProperty {get; set;}
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-15T01:57:01.367

如果对象可以序列化为 XML 并且可以在 WSDL 中描述，那么可以从 Web 服务返回对象。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-15T01:56:31.540

是的：在 .NET 中，他们称之为序列化，其中对象被序列化为 XML，然后由消费服务重构回其原始对象类型或具有相同数据结构的代理。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-15T02:26:02.463

在可能的情况下，我将对象转置为 XML——这意味着 Web 服务更具可移植性——然后我可以使用任何语言访问服务，我只需要使用该语言创建解析器/对象转置器。

因为我们有描述服务的 WSDL 文件，所以这在某些系统中几乎是自动化的。

（例如，我们有一个用纯python编写的服务器，它正在替换一个用C编写的服务器，一个用C++/gSOAP编写的客户端，以及一个用Cocoa/Objective-C编写的客户端。我们使用soapUI作为测试框架，即用Java编写）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-15T03:22:56.140

可以使用 XML 从 Web 服务返回对象。但是 Web 服务应该与平台和操作系统无关。序列化对象只允许您从字节流（例如文件）中存储和检索对象。例如，您可以序列化一个 Java 对象，将该二进制流转换（可能通过 Base 64 编码转换为 CDATA 字段）并将其传输到服务的客户端。

但是，如果该对象是基于 Java 的，则客户端只能恢复该对象。此外，需要一个深拷贝来序列化一个对象并准确地恢复它。深拷贝可能很昂贵。

最好的方法是创建一个表示文档的 XML 模式，并使用对象细节创建该模式的实例。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-15T02:24:07.583

.NET 自动对可序列化的对象执行此操作。我很确定 Java 的工作方式相同。

这是一篇讨论 .NET 中的对象序列化的文章：http: [//www.codeguru.com/Csharp/Csharp/cs_syntax/serialization/article.php/c7201](http://www.codeguru.com/Csharp/Csharp/cs_syntax/serialization/article.php/c7201/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-15T03:31:00.507

@Brian：我不知道Java中的事情是如何工作的，但是在.net中，对象被序列化为XML，而不是base64字符串。Web 服务发布一个 wsdl 文件，其中包含 Web 服务所需的方法和对象定义。

我希望没有人创建简单地创建 base64 字符串的 web 服务

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-21T15:31:53.133

> > **Daniel Auger：**
> > 正如其他人所说，这是可能的。但是，如果服务和客户端都使用在双方都具有完全相同的域行为的对象，那么您可能一开始就不需要服务。
> 
> **lomax：** 我不同意这一点，因为这是一个有点狭隘的评论。使用可以将域对象序列化为 XML 的 Web 服务意味着它使使用相同域对象的客户端更容易，但这也意味着这些客户端仅限于使用您公开的特定 Web 服务，并且它也适用于通过允许其他客户端不知道您的域对象但仍通过 XML 与您的服务交互来反转。

@Lomax：您已经描述了两种情况。**场景 1：**客户端将 xml 消息重新合成回完全相同的域对象。我认为这是“返回对象”。根据我的经验，这是一个糟糕的选择，我将在下面解释这一点。**场景 2：**客户端将 xml 消息重新水化为完全相同的域对象以外的其他内容：我 100% 支持这一点，但我不认为这会返回域对象。它实际上是在发送消息或 DTO。

现在让我解释一下为什么跨 Web 服务的真/纯/非 DTO 对象序列化*通常是*一个坏主意。一个断言：为了首先做到这一点，您要么必须是客户端和服务的所有者，要么为客户端提供要使用的库，以便他们可以将对象重新水化回它的真实类型。问题：这个域对象作为一种类型现在存在于并属于两个半相关的域。随着时间的推移，可能需要在一个域中添加在另一个域中没有意义的行为，这会导致污染和潜在的痛苦问题。

我通常默认使用方案 2。我只在有压倒性理由时才使用方案 1。

对于我最初的回复如此简洁，我深表歉意。我希望这能在一定程度上解决我的观点。Lomax，我们似乎有一半同意；）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-21T16:15:26.337

JSON 是一种在网络上传递对象的非常标准的方式（作为 javascript 的子集）。许多语言都有一个库，可以将 JSON 代码转换为原生对象——例如Python 中的[simplejson](http://undefined.org/python/#simplejson)。

有关 JSON 使用的更多库，请参阅[JSON 网页](http://www.json.org/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-18T02:21:44.473

正如其他人所说，这是可能的。但是，如果服务和客户端都使用在双方都具有完全相同的域行为的对象，那么您可能一开始就不需要服务。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-19T01:43:35.220

> 正如其他人所说，这是可能的。但是，如果服务和客户端都使用在双方都具有完全相同的域行为的对象，那么您可能一开始就不需要服务。

我不得不不同意这一点，因为这是一个有点狭隘的评论。使用可以将域对象序列化为 XML 的 Web 服务意味着它使使用相同域对象的客户端更容易，但这也意味着这些客户端仅限于使用您公开的特定 Web 服务，并且它也适用于通过允许其他客户端不知道您的域对象但仍通过 XML 与您的服务交互来反转。

# .net - sn.exe 失败并显示拒绝访问错误消息

> ID：11887
> 
> 赞同：15
> 
> 时间：2008-08-15T02:01:13.217
> 
> 标签：.net, strongname, sn.exe

当我使用强名称工具创建新密钥以对 .NET 程序集进行签名时，我收到拒绝访问错误消息。这在 Windows XP 机器上运行良好，但在我的 Vista 机器上不起作用。

```
PS C:\users\brian\Dev\Projects\BELib\BELib> sn -k keypair.snk

Microsoft (R) .NET Framework Strong Name Utility  Version 3.5.21022.8
Copyright (c) Microsoft Corporation.  All rights reserved.

Failed to generate a strong name key pair -- Access is denied. 
```

是什么导致了这个问题，我该如何解决？

* * *

> 您是否以管理员身份运行 PowerShell 或命令提示符？在您习惯用户访问控制或关闭用户访问控制之前，我发现这是第一个查看的地方。

是的，我尝试以管理员身份运行 PS 和常规命令提示符。出现相同的错误消息。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-08-15T02:22:18.227

> 是的，我尝试以管理员身份运行 PS 和常规命令提示符。出现相同的错误消息。

另一种可能的解决方案可能是您需要让您的用户帐户访问位于 C:\Documents and Settings\All Users\Application Data\Microsoft\Crypto\RSA\MachineKeys 的密钥容器

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-15T02:06:02.830

您是否以管理员身份运行 PowerShell 或命令提示符？在您习惯用户访问控制或关闭用户访问控制之前，我发现这是第一个查看的地方。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-15T03:43:15.350

为什么不启动 sysinternals Process Monitor 来看看你能看到什么，当我收到任何类型的访问被拒绝消息时，这是我总是做的第一件事？

[http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-11-29T21:08:14.660

只是更新一下：我在 Vista 上遇到了同样的问题。我在 PC 上的本地用户没有问题，但随后我们切换到域，我的域用户（尽管具有本地管理员权限）得到“拒绝访问”。**我授予我的域用户对C:\Users\All Users\Microsoft\Crypto\RSA\MachineKeys**的访问权限并修复了它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-24T05:53:48.643

有些人重建他们的机器来解决这个问题，但是可以通过让用户访问密钥容器来解决这个问题**C:\Documents and Settings\All Users\Application Data\Microsoft\Crypto\RSA\MachineKeys** 每个使用 sn.exe 创建的容器-i 位于 MachineKeys 目录中（除非您在其他地方指定）。sn.exe 使用的默认密钥容器也在该位置。

如果您将密钥容器重置为新的，却忘记了它在哪里......您可以使用 sn.exe -c 重置强名称实用程序的密钥容器。因此，如果帐户访问修复不起作用，您可能正在使用备用密钥存储，因此可能需要进行重置。

# authentication - OpenID 属性交换 - 我应该使用它吗？

> ID：11903
> 
> 赞同：10
> 
> 时间：2008-08-15T02:29:50.553
> 
> 标签：authentication, openid

我的网站将仅使用 OpenID 进行身份验证。我想通过属性交换来拉取用户详细信息，但是属性交换似乎给 StackOverflow 带来了很多痛苦。

行业现状如何？是否有任何 OpenID 提供商在属性交换方面做得不错？

我应该完全避开 OpenID 属性交换吗？

如何处理对功能的不一致支持？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-08-17T18:42:03.340

在 Stack Overflow 上，我们现在只使用[简单注册](http://openid.net/specs/openid-simple-registration-extension-1_0.html)扩展，因为属性交换 (AX) 存在一些问题。

最大的问题是 OpenID 提供者 (OP) 不同意使用哪种[属性类型的 url](http://www.axschema.org/types/)。AX 的最终规范说属性 url 应该来自[http://www.axschema.org/](http://www.axschema.org/) 但是，一些 OP，尤其是我们最喜欢的[http://myopenid.com](http://myopenid.com)，可以识别[其他](http://openid.net/pipermail/general/2008-February/004158.html) [url](http://rakuto.blogspot.com/2008/03/ruby-fetch-some-attributes-from.html)。我不打算列出哪些是淘气的，哪些是好的！

另一个问题是，我尝试过的大多数 OP 在使用 AX 查询时都没有返回信息——我可能做错了什么（经常发生:)），但我已经在我的个人资料中公开了相关细节，我们'重新使用最新、最优秀的 .NET 库[DotNetOpenId](http://code.google.com/p/dotnetopenid/)。

当我们有更多时间时，我们肯定会在 Stack Overflow 上重新访问 AX，因为无缝的用户体验对我们来说非常重要！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T14:23:14.597

虽然属性交换有它的问题（我相信 SO 的人可以告诉你更多），但它确实有[很多好处](http://blogs.gnome.org/jamesh/2007/11/26/openid-ax/)。在某种程度上，这取决于您是否真的需要它。简单注册似乎可以完成这项工作，只需向用户询问某些值可能是有意义的。使用常识，不要陷入把所有事情都推到一个真正的道路上。

# asp.net-mvc - ASP.NET MVC 中的 RSS 源

> ID：11915
> 
> 赞同：114
> 
> 时间：2008-08-15T02:56:41.030
> 
> 标签：asp.net-mvc, rss

您建议如何在 ASP.NET MVC 中处理 RSS 源？使用第三方库？使用 BCL 中的 RSS 内容？只是制作一个呈现 XML 的 RSS 视图？还是完全不同的东西？

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-01-11T16:34:26.927

.NET 框架公开了处理联合的类：SyndicationFeed 等。因此，与其自己进行渲染或使用其他一些建议的 RSS 库，为什么不让框架来处理它呢？

基本上，您只需要以下自定义 ActionResult 即可：

```
public class RssActionResult : ActionResult
{
    public SyndicationFeed Feed { get; set; }

    public override void ExecuteResult(ControllerContext context)
    {
        context.HttpContext.Response.ContentType = "application/rss+xml";

        Rss20FeedFormatter rssFormatter = new Rss20FeedFormatter(Feed);
        using (XmlWriter writer = XmlWriter.Create(context.HttpContext.Response.Output))
        {
            rssFormatter.WriteTo(writer);
        }
    }
} 
```

现在在您的控制器操作中，您可以简单地返回以下内容：

```
return new RssActionResult() { Feed = myFeedInstance }; 
```

我的博客上有一个完整的示例[http://www.developerzen.com/2009/01/11/aspnet-mvc-rss-feed-action-result/](http://www.developerzen.com/2009/01/11/aspnet-mvc-rss-feed-action-result/)

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2008-08-15T03:12:49.623

这是我的建议：

1.  创建一个名为 RssResult 的类，该类继承抽象基类 ActionResult。
2.  重写 ExecuteResult 方法。
3.  ExecuteResult 具有由调用者传递给它的 ControllerContext，您可以通过它获取数据和内容类型。
4.  将内容类型更改为 rss 后，您需要将数据序列化为 RSS（使用您自己的代码或其他库）并写入响应。

5.  在要返回 rss 的控制器上创建一个操作，并将返回类型设置为 RssResult。根据您想要返回的内容从模型中获取数据。

6.  然后对该操作的任何请求都将收到您选择的任何数据的 rss。

这可能是返回 rss 的最快和可重用的方式，它对 ASP.NET MVC 中的请求作出响应。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2008-08-17T15:05:47.177

我同意哈克德的观点。我目前正在使用 MVC 框架实现我的站点/博客，并且我采用了为 RSS 创建新视图的简单方法：

```
<%@ Page ContentType="application/rss+xml" Language="C#" AutoEventWireup="true" CodeBehind="PostRSS.aspx.cs" Inherits="rr.web.Views.Blog.PostRSS" %><?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
<channel>
<title>ricky rosario's blog</title>
<link>http://<%= Request.Url.Host %></link>
<description>Blog RSS feed for rickyrosario.com</description>
<lastBuildDate><%= ViewData.Model.First().DatePublished.Value.ToUniversalTime().ToString("r") %></lastBuildDate>
<language>en-us</language>
<% foreach (Post p in ViewData.Model) { %>
    <item>
    <title><%= Html.Encode(p.Title) %></title>
    <link>http://<%= Request.Url.Host + Url.Action("ViewPostByName", new RouteValueDictionary(new { name = p.Name })) %></link>
    <guid>http://<%= Request.Url.Host + Url.Action("ViewPostByName", new RouteValueDictionary(new { name = p.Name })) %></guid>
    <pubDate><%= p.DatePublished.Value.ToUniversalTime().ToString("r") %></pubDate>
    <description><%= Html.Encode(p.Content) %></description>
    </item>
<% } %>
</channel>
</rss> 
```

欲了解更多信息，请查看（无耻插件）[http://rickyrosario.com/blog/creating-an-rss-feed-in-asp-net-mvc](http://rickyrosario.com/blog/creating-an-rss-feed-in-asp-net-mvc)

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-08-15T05:49:33.317

另一种疯狂但有其优势的方法是使用普通的 .aspx 视图来呈现 RSS。在您的操作方法中，只需设置适当的内容类型。这种方法的一个好处是很容易理解正在渲染的内容以及如何添加自定义元素，例如地理位置。

再说一次，列出的其他方法可能更好，我只是没有使用它们。;)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-04-10T17:19:23.120

我从 Eran Kampf 和 Scott Hanselman vid（忘记链接）那里得到了这个，所以它与这里的其他一些帖子略有不同，但希望对您有所帮助并准备好复制粘贴作为示例 rss 提要。

[从我的博客](http://achadwick.com/Blog/Result/MVC%20RSS%20Feed)

[伊兰·坎普夫](http://www.developerzen.com/2009/01/11/aspnet-mvc-rss-feed-action-result/)

```
using System;
using System.Collections.Generic;
using System.ServiceModel.Syndication;
using System.Web;
using System.Web.Mvc;
using System.Xml;

namespace MVC3JavaScript_3_2012.Rss
{
    public class RssFeed : FileResult
    {
        private Uri _currentUrl;
        private readonly string _title;
        private readonly string _description;
        private readonly List<SyndicationItem> _items;

        public RssFeed(string contentType, string title, string description, List<SyndicationItem> items)
            : base(contentType)
        {
            _title = title;
            _description = description;
            _items = items;
        }

        protected override void WriteFile(HttpResponseBase response)
        {
            var feed = new SyndicationFeed(title: this._title, description: _description, feedAlternateLink: _currentUrl,
                                           items: this._items);
            var formatter = new Rss20FeedFormatter(feed);
            using (var writer = XmlWriter.Create(response.Output))
            {
                formatter.WriteTo(writer);
            }
        }

        public override void ExecuteResult(ControllerContext context)
        {
            _currentUrl = context.RequestContext.HttpContext.Request.Url;
            base.ExecuteResult(context);
        }
    }
} 
```

和控制器代码....

```
 [HttpGet]
public ActionResult RssFeed()
{
    var items = new List<SyndicationItem>();
    for (int i = 0; i < 20; i++)
    {
        var item = new SyndicationItem()
        {
            Id = Guid.NewGuid().ToString(),
            Title = SyndicationContent.CreatePlaintextContent(String.Format("My Title {0}", Guid.NewGuid())),
            Content = SyndicationContent.CreateHtmlContent("Content The stuff."),
            PublishDate = DateTime.Now
        };
        item.Links.Add(SyndicationLink.CreateAlternateLink(new Uri("http://www.google.com")));//Nothing alternate about it. It is the MAIN link for the item.
        items.Add(item);
    }

    return new RssFeed(title: "Greatness",
                       items: items,
                       contentType: "application/rss+xml",
                       description: String.Format("Sooper Dooper {0}", Guid.NewGuid()));

} 
```

# php - 如何让 PHP 和 MySQL 在 IIS 7.0 上运行？

> ID：11919
> 
> 赞同：10
> 
> 时间：2008-08-15T03:05:13.273
> 
> 标签：php, mysql, iis-7

好的，我已经在互联网上寻找了一个让 PHP 和 MySQL 在 IIS7.0 上工作的好解决方案。这几乎是不可能的，我已经尝试了很多次并且徒劳地放弃了。请通过链接一些很棒的分步教程来帮助从头开始在 IIS7.0 上添加 PHP 和 MySQL。PHP 和 MySQL 对于安装任何 CMS 都是必不可少的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-15T03:24:09.337

你有没有看过这个：

[http://learn.iis.net/page.aspx/246/using-fastcgi-to-host-php-applications-on-iis7/](http://learn.iis.net/page.aspx/246/using-fastcgi-to-host-php-applications-on-iis7/)

MySQL 应该非常简单。

让我们知道您遇到了什么问题...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T16:46:13.267

我得到了一个 PHP / MySQL 网站，我将在 64 位 Windows Server 2008 上使用 IIS 7.0 托管该网站。

我是 .NET / MSSQL 开发人员，不熟悉 PHP 或 MySQL。

> **[凯夫](https://stackoverflow.com/users/419/kev)**写道：
> 
> 你有没有看过这个……

我不知道 Win64 PHP 的任何一种实现是否比另一种更权威或更流行。

我将尝试按照 Kev 的[Enable FastCGI support in IIS7.0](http://learn.iis.net/page.aspx/246/using-fastcgi-to-host-php-applications-on-iis-70/)文章中的步骤使用[fusion-x lan中的](http://www.fusionxlan.com/PHPx64.php)*php-5.2.5-x64-2007-11-12.zip*文件。

它是“PHP 版本 5.2.5 (x64)”，但根据[php.net](http://www.php.net/downloads.php)，最新版本是 PHP 5.2.6。那好吧。

* * *

1.  确保在 IIS 中安装了“ISAPI Extensions”（我的是）。

2.  下载并解压*php-5.2.5-x64-2007-11-12.zip*

3.  将文件夹*php-5.2.5 (x64) 的*内容复制到 *C:\php*

4.  将文件*C:\php\php.ini-dist*复制到文件夹 *C:\Windows*

5.  将文件*C:\Windows\php.ini-dist*重命名为*php.ini*

6.  在记事本中编辑*php.ini*。从行中删除前导分号 (;)：

    ```
    ;extension=php_mysql.dll 
    ```

7.  保存并关闭

8.  将文件*C:\php\ext\php_mysql.dll*复制到文件夹 *C:\Windows\System32*

9.  在 IIS 管理器的“处理程序映射”中，选择“添加脚本映射...”

    ```
    Request path: *.php
    Executable:   C:\php\php5isapi.dll
    Name:         PHP 
    ```

10.  安装 MySQL（有人已经为我安装了[MySQL 5.0](http://dev.mysql.com/downloads/mysql/5.0.html)）。

11.  创建文件*C:\inetpub\wwwroot\test.php*为

    ```
    <html>
    <head>
    <title>PHP Information</title>
    </head>
    <body>
    <?php phpInfo(); ?>
    </body>
    </html> 
    ```

12.  在 Web 浏览器中导航到*[http://localhost/test.php 。](http://localhost/test.php)*您将看到有关 PHP 的信息页面。

* * *

路障：[如何让 PHP 与 ADOdb 和 MySQL 一起工作？](https://stackoverflow.com/questions/155308/how-do-i-get-php-to-work-with-adodb-and-mysql)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T03:20:12.293

它应该通过 FastCGI 工作。但我没有取得很大的成功（使用 Vista）。我可以让 PHP 运行，但它在页面加载后崩溃（FastCGI 会）。所以我正在改装你。我希望自己看到一个可靠的答案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T06:52:22.643

根据我对 windows/apache 的经验，这只是安装 MySQL 的问题，我无法想象 IIS/Apache 与此有关。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-17T01:13:30.930

Apache 是在 Vista 中运行的一大难题。并且 II7（和 6）应该可以正常运行 PHP。那么，为什么要打扰 Apache 呢？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-22T05:19:48.183

我建议您是否要安装 PHP 和 MySQL 来改用[WAMP](http://www.wampserver.com/en/ "WAMP")。它工作得很好，很容易添加扩展和修改一切。我用它来工作并且喜欢它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-22T05:21:11.173

一位 IIS 开发人员在这里进行了出色的演练：

[http://blogs.iis.net/bills/archive/2006/10/31/PHP-on-IIS.aspx](http://blogs.iis.net/bills/archive/2006/10/31/PHP-on-IIS.aspx)

然而，为了上帝的爱，为什么？

# c# - ASP.Net MVC 路由映射

> ID：11926
> 
> 赞同：13
> 
> 时间：2008-08-15T03:25:31.657
> 
> 标签：c#, asp.net, asp.net-mvc, routing

我是 MVC（和 ASP.Net 路由）的新手。我正在尝试映射`*.aspx`到一个名为`PageController`.

```
routes.MapRoute(
   "Page",
   "{name}.aspx",
   new { controller = "Page", action = "Index", id = "" }
); 
```

上面的代码不会将 *.aspx 映射到`PageController`吗？当我运行它并输入任何 .aspx 页面时，我收到以下错误：

> 找不到路径“/Page.aspx”的控制器，或者它没有实现 IController 接口。参数名称：controllerType

有什么我不在这里做的吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-15T03:54:03.080

我只是回答了我自己的问题。我有向后的路线（默认在页面上方）。下面是正确的顺序。所以这带来了下一个问题......“默认”路由如何匹配（我假设他们在这里使用正则表达式）“页面”路由？

```
routes.MapRoute(
            "Page",
            "{Name}.aspx",
            new { controller = "Page", action = "Display", id = "" }
        );

        routes.MapRoute(
            "Default",                                              // Route name
            "{controller}/{action}/{id}",                           // URL with parameters
            new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
        ); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-15T04:24:44.190

> 我只是回答了我自己的问题。我有向后的路线（默认在页面上方）。

是的，您必须将所有自定义路由放在默认路由之上。

> 所以这带来了下一个问题......“默认”路由如何匹配（我假设他们在这里使用正则表达式）“页面”路由？

默认路由匹配基于我们所说的约定优于配置。Scott Guthrie 在他关于 ASP.NET MVC 的第一篇博文中很好地解释了这一点。我建议您通读它以及他的其他帖子。请记住，这些是基于第一个 CTP 发布的，并且框架已更改。您还可以在 Scott Hanselman 的 asp.net 站点上找到有关 ASP.NET MVC 的网络广播。

*   [http://weblogs.asp.net/scottgu/archive/2007/11/13/asp-net-mvc-framework-part-1.aspx](http://weblogs.asp.net/scottgu/archive/2007/11/13/asp-net-mvc-framework-part-1.aspx)
*   [http://www.asp.net/MVC/](http://www.asp.net/MVC/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-15T04:27:58.410

在 Rob Conery 的 MVC Storefront[截屏视频](http://www.asp.net/learn/3.5-SP1/video-356.aspx)中，他遇到了这个确切的问题。如果你有兴趣，它在 23 分钟左右。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T03:43:38.110

不确定您的控制器的外观，错误似乎指向它找不到控制器的事实。创建 PageController 类后，您是否继承了 Controller ？PageController 是否位于 Controllers 目录中？

这是我在 Global.asax.cs 中的路线

```
routes.MapRoute(
    "Page", 
    "{Page}.aspx", 
    new { controller = "Page", action = "Index", id = "" }
); 
```

这是我的控制器，它位于 Controllers 文件夹中：

```
using System.Web.Mvc;

namespace MvcApplication1.Controllers
{
    public class PageController : Controller
    {
        public void Index()
        {
            Response.Write("Page.aspx content.");
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-30T01:41:16.560

```
public class AspxRouteConstraint : IRouteConstraint
{
    #region IRouteConstraint Members

    public bool Match(HttpContextBase httpContext, Route route, string parameterName, RouteValueDictionary values, RouteDirection routeDirection)
    {
        return values["aspx"].ToString().EndsWith(".aspx");
    }

    #endregion
} 
```

注册所有 aspx 的路由

```
 routes.MapRoute("all", 
                "{*aspx}",//catch all url 
                new { Controller = "Page", Action = "index" }, 
                new AspxRouteConstraint() //return true when the url is end with ".aspx"
               ); 
```

[您可以通过MvcRouteVisualizer](http://mvcroutevisualizer.codeplex.com)测试路线

# java - 如何在 Java 中确定我的路由器/网关的 IP？

> ID：11930
> 
> 赞同：17
> 
> 时间：2008-08-15T03:32:28.897
> 
> 标签：java, sockets, ip, router

如何在 Java 中确定我的路由器/网关的 IP？我可以很容易地获得我的IP。我可以使用网站上的服务获取我的互联网 IP。但是我怎样才能确定我的网关的 IP 呢？

如果您知道自己的方式，这在 .NET 中有点容易。但是你如何在 Java 中做到这一点？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-29T15:21:25.580

在 Windows、OSX、Linux 等上，Chris Bunch 的答案可以通过使用得到很大改善

```
netstat -rn 
```

代替`traceroute`命令。

您的网关的 IP 地址将出现在以`default`或开头的行的第二个字段中`0.0.0.0`。

这解决了尝试使用的一些问题`traceroute`：

1.  在 Windows`traceroute`上实际上是`tracert.exe`，因此代码中不需要 O/S 依赖项
2.  这是一个快速运行的命令——它从操作系统获取信息，而不是从网络获取信息
3.  `traceroute`有时会被网络屏蔽

唯一的缺点是有必要从`netstat`输出中读取行，直到找到正确的行，因为会有不止一行的输出。

**编辑：**如果您使用的是 MAC（在 Lion 上测试），默认网关的 IP 地址位于以“default”开头的行的第二个字段中，或者以“0.0.0.0”开头的行的**第三个字段**中（在 Windows 7 上测试）

视窗：

> > 网络目标网络掩码网关接口指标
> > 
> > 0.0.0.0 0.0.0.0 **192.168.2.254** 192.168.2.46 10

苹果电脑：

> > 目标网关标志 Refs 使用 Netif 过期
> > 
> > 默认 **192.168.2.254** UGSc 104 4 en1

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-08-15T06:38:21.813

不幸的是，Java 并不像其他语言那样令人愉快。这是我所做的：

```
import java.io.*;
import java.util.*;

public class ExecTest {
    public static void main(String[] args) throws IOException {
        Process result = Runtime.getRuntime().exec("traceroute -m 1 www.amazon.com");

        BufferedReader output = new BufferedReader(new InputStreamReader(result.getInputStream()));
        String thisLine = output.readLine();
        StringTokenizer st = new StringTokenizer(thisLine);
        st.nextToken();
        String gateway = st.nextToken();
        System.out.printf("The gateway is %s\n", gateway);
    }
} 
```

这假定网关是第二个令牌而不是第三个。如果是这样，您需要添加一个额外的`st.nextToken();`以将标记器再提升一个位置。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-14T12:54:43.780

在 Windows 上解析 IPConfig 的输出将为您提供默认网关，而无需等待跟踪。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-29T19:52:22.163

```
 try{
        String gateway;
        Process result = Runtime.getRuntime().exec("netstat -rn");

        BufferedReader output = new BufferedReader(new InputStreamReader(result.getInputStream()));

        String line = output.readLine();
        while(line != null){
            if ( line.trim().startsWith("default") == true || line.trim().startsWith("0.0.0.0") == true )
                break;      
            line = output.readLine();
        }
        if(line==null) //gateway not found;
            return;

        StringTokenizer st = new StringTokenizer( line );
        st.nextToken();
        st.nextToken();
        gateway = st.nextToken();
        System.out.println("gateway is: "+gateway);

    } catch( Exception e ) { 
        System.out.println( e.toString() );
        gateway = new String();
        adapter = new String();
    } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-15T06:15:16.823

你最好使用 checkmyip.org 之类的东西，它会确定你的公共 IP 地址——不一定是你的第一跳路由器：在 Uni，我有一个“真实”IP 地址，而在家里，它是我本地路由器的公共 IP 地址。

您可以解析返回的页面，或者找到另一个站点，该站点允许您将 IP 地址作为唯一的字符串返回。

（我的意思是用 Java/其他方式加载这个 URL，然后获取你需要的信息）。

这应该完全独立于平台。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-05T21:42:54.303

关于 UPnP：请注意，并非所有路由器都支持 UPnP。如果他们这样做，它可能会被关闭（出于安全原因）。因此，您的解决方案可能并不总是有效。

您还应该看看 NatPMP。

一个简单的 UPnP 库可以在[http://miniupnp.free.fr/](http://miniupnp.free.fr/)找到，虽然它是在 C 中...

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-14T11:51:59.797

要克服 traceroute 提到的问题（基于 ICMP，广域命中），您可以考虑：

1.  跟踪路由到您的公共 IP（避免广域命中，但仍然是 ICMP）
2.  使用 ifconfig/ipconfig 之类的非 ICMP 实用程序（尽管存在可移植性问题）。
3.  目前看来最好和最便携的解决方案是 shell 和解析 netstat（请参见[此处](http://forums.sun.com/thread.jspa?threadID=5289135)的代码示例）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-23T10:58:39.517

netstat -rn 的输出是特定于语言环境的。在我的系统 (locale=de) 上，输出看起来像： ... Standardgateway: 10.22.0.1

所以没有以“默认”开头的行。

所以使用 netstat 可能不是一个好主意。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-01-25T15:46:50.010

此版本连接到 www.whatismyip.com，读取站点内容并通过正则表达式搜索 ip 地址并将其打印到 cmd。它是对 MosheElishas 代码的一点改进

```
import java.io.BufferedReader;  
import java.io.IOException;  
import java.io.InputStreamReader; 
import java.net.URL;  
import java.util.regex.Matcher;  
import java.util.regex.Pattern;  

public class Main {

    public static void main(String[] args) {
        BufferedReader buffer = null;
        try {
            URL url = new URL(
                    "http://www.whatismyip.com/tools/ip-address-lookup.asp");
            InputStreamReader in = new InputStreamReader(url.openStream());
            buffer = new BufferedReader(in);
            String line = buffer.readLine();
            Pattern pattern = Pattern
                    .compile("(.*)value=\"(\\d+).(\\d+).(\\d+).(\\d+)\"(.*)");
            Matcher matcher;
            while (line != null) {
                matcher = pattern.matcher(line);
                if (matcher.matches()) {
                    line = matcher.group(2) + "." + matcher.group(3) + "."
                            + matcher.group(4) + "." + matcher.group(5);
                    System.out.println(line);
                }
                line = buffer.readLine();
            }
        } catch (IOException e) {
            e.printStackTrace();

        } finally {
            try {
                if (buffer != null) {
                    buffer.close();
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}

import java.io.BufferedReader;  
import java.io.IOException;  
import java.io.InputStreamReader; 
import java.net.URL;  
import java.util.regex.Matcher;  
import java.util.regex.Pattern;  

public class Main {

    public static void main(String[] args) {
        BufferedReader buffer = null;
        try {
            URL url = new URL(
                    "http://www.whatismyip.com/tools/ip-address-lookup.asp");
            InputStreamReader in = new InputStreamReader(url.openStream());
            buffer = new BufferedReader(in);
            String line = buffer.readLine();
            Pattern pattern = Pattern
                    .compile("(.*)value=\"(\\d+).(\\d+).(\\d+).(\\d+)\"(.*)");
            Matcher matcher;
            while (line != null) {
                matcher = pattern.matcher(line);
                if (matcher.matches()) {
                    line = matcher.group(2) + "." + matcher.group(3) + "."
                            + matcher.group(4) + "." + matcher.group(5);
                    System.out.println(line);
                }
                line = buffer.readLine();
            }
        } catch (IOException e) {
            e.printStackTrace();

        } finally {
            try {
                if (buffer != null) {
                    buffer.close();
                }
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-15T03:49:48.800

这并不像听起来那么容易。Java 是独立于平台的，所以我不确定如何在 Java 中做到这一点。我*猜想*.NET 联系了一些网站，该网站将其报告回来。有几种方法可以走。首先，深入了解 ICMP 协议可能会为您提供所需的信息。您还可以跟踪您经过的 IP（您的路线）。当您遇到不在以下范围内的 IP 时：

*   10.0.0.0 – 10.255.255.255
*   172.16.0.0 - 172.31.255.255
*   192.168.0.0 - 192.168.255.255

它与您的 IP 相距一跳，并且可能与您的 IP 共享几个八位字节的信息。

祝你好运。我很想听到这个问题的明确答案。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-15T04:25:23.160

如果你有的话，试着去追踪路由。

'traceroute -m 1 www.amazon.com' 将发出如下内容：

```
traceroute to www.amazon.com (72.21.203.1), 1 hops max, 40 byte packets
 1  10.0.1.1 (10.0.1.1)  0.694 ms  0.445 ms  0.398 ms 
```

解析第二行。是的，它很丑陋，但它会让你继续前进，直到有人发布更好的东西。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-08-15T06:31:38.100

马修：是的，这就是我所说的“我可以使用网站上的服务获取我的互联网 IP”的意思。对不起，我很流利。

Brian/Nick：Traceroute 会很好，除了这些路由器中的许多都禁用了 ICMP，因此它总是停止。

我认为 traceroute 和 uPnP 的组合会奏效。这就是我计划做的，我只是希望我错过了一些明显的东西。

谢谢大家的评论，所以听起来我没有遗漏任何明显的东西。为了发现网关，我已经开始实施一些 uPnP。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-08T18:05:28.783

您可以查询网址“ [http://whatismyip.com/automation/n09230945.asp](http://whatismyip.com/automation/n09230945.asp) ”。例如：

```
 BufferedReader buffer = null;
    try {
        URL url = new URL("http://whatismyip.com/automation/n09230945.asp");
        InputStreamReader in = new InputStreamReader(url.openStream());
        buffer = new BufferedReader(in);

        String line = buffer.readLine();
        System.out.println(line);
    } catch (IOException e) {
        e.printStackTrace();
    } finally {
        try {
            if (buffer != null) {
                buffer.close();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    } 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-12-27T19:01:17.050

在 Windows 中，您只需使用以下命令：

```
ipconfig | findstr /i "Gateway" 
```

这将为您提供如下输出：

```
Default Gateway . . . . . . . . . : 192.168.2.1
Default Gateway . . . . . . . . . : :: 
```

但是我不能用 Java 运行这个命令，当我弄清楚这一点时会发布。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-04-17T17:24:23.343

您可以使用`netstat -rn`Windows、OSX、Linux 等平台上可用的命令。这是我的代码：

```
private String getDefaultAddress() {
        String defaultAddress = "";
        try {
            Process result = Runtime.getRuntime().exec("netstat -rn");

            BufferedReader output = new BufferedReader(new InputStreamReader(
                    result.getInputStream()));

            String line = output.readLine();
            while (line != null) {
                if (line.contains("0.0.0.0")) {

                    StringTokenizer stringTokenizer = new StringTokenizer(line);
                    stringTokenizer.nextElement(); // first element is 0.0.0.0
                    stringTokenizer.nextElement(); // second element is 0.0.0.0
                    defaultAddress = (String) stringTokenizer.nextElement();
                    break;
                }

                line = output.readLine();

            } // while
        } catch (IOException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }

        return defaultAddress;

} // getDefaultAddress 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-02-14T22:12:52.487

我不确定它是否适用于每个系统，但至少在这里我发现了这个：

```
import java.net.InetAddress;
import java.net.UnknownHostException;
public class Main
{
    public static void main(String[] args)
    {
        try
        {
            //Variables to find out the Default Gateway IP(s)
            String canonicalHostName = InetAddress.getLocalHost().getCanonicalHostName();
            String hostName = InetAddress.getLocalHost().getHostName();

            //"subtract" the hostName from the canonicalHostName, +1 due to the "." in there
            String defaultGatewayLeftover = canonicalHostName.substring(hostName.length() + 1);

            //Info printouts
            System.out.println("Info:\nCanonical Host Name: " + canonicalHostName + "\nHost Name: " + hostName + "\nDefault Gateway Leftover: " + defaultGatewayLeftover + "\n");
            System.out.println("Default Gateway Addresses:\n" + printAddresses(InetAddress.getAllByName(defaultGatewayLeftover)));
        } catch (UnknownHostException e)
        {
            e.printStackTrace();
        }
    }
    //simple combined string out of the address array
    private static String printAddresses(InetAddress[] allByName)
    {
        if (allByName.length == 0)
        {
            return "";
        } else
        {
            String str = "";
            int i = 0;
            while (i < allByName.length - 1)
            {
                str += allByName[i] + "\n";
                i++;
            }
            return str + allByName[i];
        }
    }
} 
```

对我来说，这会产生：

```
Info:
Canonical Host Name: PCK4D-PC.speedport.ip
Host Name: PCK4D-PC
Default Gateway Leftover: speedport.ip

Default Gateway Addresses:
speedport.ip/192.168.2.1
speedport.ip/fe80:0:0:0:0:0:0:1%12 
```

我需要对其他系统/配置/PC-Gateway-Setups 进行更多测试，以确认它是否适用于任何地方。有点怀疑，但这是我发现的第一个。

# asp.net - 如何在 ASP.NET 应用程序中记录错误（异常）？

> ID：11950
> 
> 赞同：29
> 
> 时间：2008-08-15T04:05:10.843
> 
> 标签：asp.net, error-handling, nlog, health-monitoring

我正在寻找在 ASP.NET 应用程序中记录错误的最佳方法。我希望能够在我的应用程序中发生错误时接收电子邮件，其中包含有关异常和当前请求的详细信息。

在我的公司中，我们曾经有自己的 ErrorMailer，可以捕获 Global.asax Application_Error 中的所有内容。这是“好的”，但不是很灵活也不是可配置的。

我们最近切换到 NLog。它更具可配置性，我们可以为错误定义不同的目标，过滤它们，缓冲它们（尚未尝试）。这是一个非常好的改进。

但我最近发现.Net 框架中有一个完整的命名空间用于此目的：[System.Web.Management](http://msdn.microsoft.com/en-us/library/system.web.management.aspx)，它可以在 web.config 的[healthMonitoring](http://msdn.microsoft.com/en-us/library/2fwh2ss9(VS.80).aspx)部分进行配置。

您曾经使用过 .Net 健康监控吗？您的错误记录解决方案是什么？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-08-15T04:34:49.817

我用[elmah](http://code.google.com/p/elmah/)。它有一些非常好的特性，这里有一篇关于它的[CodeProject](http://www.codeproject.com/KB/aspnet/ELMAHDemo.aspx)文章。我认为 StackOverflow 团队也使用 elmah！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-15T06:31:07.070

我一直在使用[Log4net](http://logging.apache.org/log4net/index.html)，配置为通过电子邮件发送致命错误的详细信息。它还设置为将所有内容记录到日志文件中，这在尝试调试问题时非常有用。另一个好处是，如果该标准功能不能满足您的要求，那么编写一个可以根据需要处理日志信息的自定义附加程序相当容易。

话虽如此，我将它与自定义错误处理程序结合使用，该错误处理程序发送的 html 电子邮件包含比标准 log4net 电子邮件中包含的更多信息 - 页面、会话变量、cookie、http 服务器变量等。

这些都在 Application_OnError 事件中连接起来，其中异常在 log4net 中被记录为致命异常（然后将其通过电子邮件发送到指定的电子邮件地址），并且还使用自定义错误处理程序进行处理。

第一次听说[Elmah](http://code.google.com/p/elmah/)是从 Coding Horror 博客条目[Crash Responsibly](http://www.codinghorror.com/blog/archives/001118.html)中得知的，虽然它看起来很有希望，但我还没有在任何项目中实现它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-15T06:11:57.937

我一直在使用 Enterprise Library 的 Logging 对象。它允许您拥有不同类型的日志记录（平面文件、电子邮件和/或数据库）。它非常可定制，并且有一个非常好的界面来更新您的 web.config 以配置日志记录。通常我从 Global.asax 中的 On Error 调用我的日志记录。

[这是 MSDN 的链接](http://msdn.microsoft.com/en-us/library/cc511708.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-23T09:56:20.210

我使用 log4net，并且在我*期望*异常的地方将其记录到适当的级别。我倾向于不重新抛出异常，因为它并不能真正提供良好的用户体验，在当前状态下您可以提供的信息较少。

我还会将 Application_Error 配置为捕获任何未预料到的异常，并通过 log4net 将错误记录为致命优先级（好吧，404 被检测到并记录为 Info，因为它们的严重性不高）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-15T04:26:53.653

我们使用我们编写的自定义本土日志记录工具。它要求您在任何需要的地方自行实现日志记录。但是，它还允许您捕获更多内容，而不仅仅是异常。

例如，我们的代码如下所示：

```
Try
  Dim p as New Person()
  p.Name = "Joe"
  p.Age = 30
Catch ex as Exception
  Log.LogException(ex,"Err creating person and assigning name/age")
  Throw ex
End Try 
```

这样，我们的记录器会将我们需要的所有信息写入 SQL 数据库。我们在数据库级别设置了电子邮件警报，以查找某些错误或经常发生的错误。它可以帮助我们准确识别错误的来源。

这可能不是您正在寻找的。与使用 Global.asax 类似的另一种方法是使用代码注入技术，例如带有[PostSharp的](http://www.postsharp.org/)[AOP](http://en.wikipedia.org/wiki/Aspect-oriented_programming)。这允许您在每个方法的开头和结尾或每个异常处注入自定义代码。这是一种有趣的方法，但我相信它可能会产生很大的性能开销。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-15T04:33:02.613

我的团队使用Apache 的[log4net](http://logging.apache.org/log4net/index.html)。它非常轻巧且易于设置。最重要的是，它完全可以从 web.config 文件进行配置，因此一旦您在代码设置中获得了钩子，您就可以通过更改 web.config 文件来完全改变日志记录的方式。

log4net 支持记录到各种位置 - 数据库、电子邮件、文本文件、Windows 事件日志等。我的团队将其配置为将详细的错误信息发送到数据库，并向整个团队发送一封包含足够信息的电子邮件我们来确定错误源自代码的哪一部分。然后我们知道谁负责那段代码，他们可以去数据库获取更详细的信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-15T17:22:49.150

我最近用 NLog 构建了一个 asp.net 网络服务，用于我的所有桌面应用程序。当我在 Visual Studio 中调试时，日志记录工作正常，但是一旦我切换到 IIS，就不会创建日志文件；我还没有确定原因，但是我需要寻找解决方案的事实让我想尝试其他东西来满足我的 asp.net 需求！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-08-09T16:52:46.750

我们使用 EnterpriseLibrary.ExceptionHandling.Logging。我比 log4net 更喜欢它，因为我们不仅可以完全控制日志记录，而且还可以在配置中控制 Throw/NoThrow 决策。

# virtualization - 为 vmware 付费还是使用开源？

> ID：11964
> 
> 赞同：3
> 
> 时间：2008-08-15T04:32:29.883
> 
> 标签：virtualization

我应该使用什么来虚拟化我的桌面、vmx、xen 或 vmware？

**需要在 linux 或 windows 主机上工作，抱歉 virtual pc。**

@Derek Park：像演讲一样免费，不是啤酒。我希望能够从我自己的许可 Windows 副本中创建一个新的虚拟机，因为 vmware 有点贵。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-15T04:43:48.440

试试[VirtualBox](http://www.virtualbox.org/)。它是免费的开源软件，可在 Windows、Linux、Macintosh 和 OpenSolaris 上运行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-15T04:57:09.367

@ChanChan，当您询问是否应该“为 vmware 付费”时，我认为您不能声称只对自由感兴趣。我不得不假设你在那里谈论的是金钱，而不是自由。:p

尽管如此，我给了你一个糟糕的链接。 [VMware Server](http://www.vmware.com/download/server/)是免费的（就像在啤酒中一样），可以很好地运行 Windows 虚拟机。

对于它的价值，我也使用过 Xen，它也非常好。

编辑：我重读了这篇文章，听起来真的很讨厌和粗鲁。所以，我很抱歉，ChanChan，我的回复没有多加注意。（我会在私信中道歉，但我们还没有。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-15T04:36:54.180

我只使用过[VMware ESX](http://www.vmware.com/products/vi/esx/)，虽然它是一个相当昂贵的产品，但它也非常强大。如果你有资源，我肯定会推荐它。根据您的需要，他们还有一个更基本（免费）的版本，[VMware Server](http://www.vmware.com/products/server/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-15T04:36:51.403

我已经使用 vmware 大约 8 年了。目前我在 Mac 上使用它并且对它非常满意。我的旧 Windows 95 仍然处于假死状态，我每隔一段时间就会启动它，向我的孩子们展示 32M 和 256 色的真棒。

话虽如此，您可能应该在您将使用的特定环境和应用程序中试用它们，看看哪一个最适合您。

我真正喜欢的 vmware 的一项功能是对系统进行快照的能力。我在每个软件安装之前都这样做，当其中一个出错时，我只是将虚拟盒恢复到安装前的状态。这很棒！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-28T12:18:19.067

我们已经在生产环境中使用 VMWare Server 2 年了，明年将迁移到 ESX。对于您的桌面，免费的 VMWare 版本非常适合您。还有一个实用程序可以将现有机器转换为 VM 片。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-03T03:00:56.660

我尝试过 VirtualBox、VMWare Server（免费）和 Virtual PC。在这三个中，VMWare 似乎是最快的。另外两个对我来说太慢了。我不喜欢 VMWare 的一件事是每个 vm 只能获得一个快照。当然，如果我购买了 VMWorkstation 产品，我可以获得更多，但 200 美元的价格已经超出了我现在的承受能力。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-08-15T04:36:17.037

嗯，[VMware 是免费的](http://info.vmware.com/content/GLP_VMwarePlayer)。

# html - 使用 Web 表单通过 HTTP POST 上传文件的最佳方式是什么？

> ID：11974
> 
> 赞同：5
> 
> 时间：2008-08-15T04:54:05.613
> 
> 标签：html, http, forms, post, upload

基本上，比这更好的东西：

```
<input type="file" name="myfile" size="50"> 
```

首先，`browse`每个浏览器上的按钮看起来都不同。与`submit`表单上的按钮不同，您必须想出一些[hack-y](http://www.quirksmode.org/dom/inputfile.html)方式来设置它的样式。

其次，没有进度指示器显示文件上传了多少。您通常必须实现某种客户端方式来禁用多次提交（例如，将提交按钮更改为显示“表单提交...请稍候。”的禁用按钮）或发出巨大的警告。

有什么不使用 Flash 或 Java 的好的解决方案吗？

[Yaakov](https://stackoverflow.com/questions/11974/what-is-the-best-way-to-upload-a-file-via-an-http-post-with-a-web-form#12005)：那个产品看起来正是我想要的，但成本是 1000 美元，而且它专门用于`ASP.NET.` 是否有任何开源项目涵盖相同或相似的功能？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-15T07:54:33.063

如果您不想涉及 Flash、Java 或 ActiveX 等其他技术，文件上传框就是我们目前所处的位置。

使用纯 HTML，您几乎受限于您所描述的体验（没有进度条、重复提交等）。如果您愿意使用一些 javascript，您可以通过提供上传正在进行的反馈甚至[显示上传进度](http://www.raditha.com/php/progress.php)来解决一些问题（这是一个 hack，因为您不应该进行完整的往返服务器并返回，但至少它可以工作）。

如果您愿意使用 Flash（几乎可以在任何地方和许多平台上使用），您几乎可以克服所有这些问题。快速谷歌搜索发现了[两个](http://www.downloadsquad.com/2006/11/16/swfupload-open-source-flash-multi-file-upload/) [这样](http://www.codeproject.com/KB/aspnet/FlashUpload.aspx)的组件，它们都是免费*和*开源的。我从来没有用过它们，但它们看起来不错。顺便说一句，Flash 也不是没有问题，例如，当使用多文件上传器进行幻灯片共享时，浏览器不断在我身上崩溃:-(

目前最好的解决方案可能是动态检测用户是否有 Flash，如果是这样，给她上传器的 Flash 版本，同时仍然可以选择基本的 HTML 版本。

高温高压

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T07:58:28.830

您可以查看[Fancy Upload](http://digitarald.de/project/fancyupload/)脚本。虽然它使用闪光灯，但它仍然看起来很棒。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-15T08:52:06.397

这里的问题是浏览器专门阻止任何更改基本文件上传输入控件的内容。例如，您无法使用 javascript 更改它。

原因是安全性 - 如果我可以编写脚本，我可以构建一个页面，当您访问它时，它会从您的硬盘向我发送各种文件。不太好。

目前有各种解决方法，但在 IE 和 FX 之间是不同的（我不知道 Safari、Opera 等）。

当您将某些内容附加到电子邮件时，请查看[http://www.gmail.com在 IE 和 FX 中的作用。](http://www.gmail.com)

我想看看那个垃圾的“浏览”按钮——它告诉我我不会让任何意外的东西进来。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T05:56:22.227

诚然，文件上传控制绝对是落伍了。希望这将在未来的 asp.net 版本中得到解决。

虽然要花一些钱，但我发现[Telerik 上传控件](http://www.telerik.com/products/aspnet-ajax/controls/upload/overview.aspx)具有您正在寻找的所有功能，包括样式和进度更新（它还优化了大型上传的内存）。

# localization - 处理存储中的时区？

> ID：11975
> 
> 赞同：20
> 
> 时间：2008-08-15T04:54:59.510
> 
> 标签：localization, internationalization, timezone, globalization

将所有内容存储在 GMT 中？

以嵌入偏移量输入的方式存储所有内容？

每次渲染时都要进行数学运算吗？

显示相对时间“1 分钟前”？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-08-15T05:19:37.603

您必须以 UTC 存储 - 如果您不这样做，那么您在夏令时之类的历史报告和行为会......很有趣。GMT 是本地时间，受制于相对于 UTC 的夏令时（不是）。

如果您要存储本地时间，则向不同时区的用户展示可能是一个真正的混蛋。如果您的原始数据采用 UTC，则很容易调整到本地 - 只需添加用户的偏移量即可！

Joel 在其中一个播客中谈到了这一点（以一种迂回的方式）——他说要[尽可能以最高分辨率存储您的数据](https://stackoverflow.fogbugz.com/default.asp?W12621)（搜索“保真度”），因为当它再次消失时，您总是可以对其进行处理。这就是为什么我说将其存储为 UTC，作为当地时间，您需要针对不在该时区的任何人进行调整，这是一项艰巨的工作。并且您需要存储，例如，当您存储时间时，夏令时是否有效。玉。

过去我经常在数据库中存储两个 - UTC 用于排序，本地时间用于显示。这样用户和计算机都不会感到困惑。

现在，至于显示：当然，您可以执行“3 分钟前”的操作，但前提是您存储 UTC - 否则，在不同时区输入的数据将执行诸如显示为“-4 小时前”之类的操作，这将吓坏人。如果您要显示实际时间，人们喜欢在本地时间使用它 - 如果在多个时区输入数据，您只有在存储 UTC 时才能轻松做到这一点。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-25T02:44:22.023

一如既往，答案是“取决于”。

这取决于您所描述的时间以及数据是如何提供给您的。决定如何存储时间值的关键是决定是否通过删除时区来丢失信息，以及不要让用户感到惊讶。

在 UTC time_t 中存储数据有一定的好处——它是一个单一的整数，允许快速排序和轻松存储。

我认为问题被分解为特定领域：

1.  历史数据
2.  未来，短期数据
3.  未来的长期数据

每个都有以下子类：

1.  系统提供
2.  用户提供

让我们一次看一个。

**提供的系统**：我建议在 UTC 中运行系统，然后避免时区问题，并且不会出现任何信息丢失（它始终是 UTC）。

**历史数据**：这些是系统日志文件、进程统计信息、跟踪、评论日期/时间等。数据不会更改，时区描述符不会追溯更改。对于这种类型的数据，无论在哪个时区中提供信息，将信息存储在 UTC 中都不会丢失任何信息。因此，请删除时区。

**未来，长期数据**：这些事件要么在未来足够远，要么将继续发生。如果它们保持足够长的时间，则时区描述符保证会发生变化。这类数据的一个很好的例子是“每周管理会议”。这是输入一次的数据，并有望永久有效。对于这些值，重要的是确定它是系统提供的还是用户提供的。对于用户提供的数据，时间应该与创建者的时区一起存储，否则会导致信息丢失。当时区定义发生变化并且时间向创建者显示为具有完全不同的值时，这种信息丢失变得明显！

正如 Bwooce 所指出的，创建者和查看者位于不同的时区时存在一些混淆。在这种情况下，我希望应用程序指出哪些时间值由于时区从其先前位置的偏移而发生了移动。

**未来，短期数据**：这是很快将成为历史的数据，或者仅在短时间内有效。示例可能是间隔计时器、评级转换等。对于这些数据，由于定义在值创建和历史时间之间发生变化的可能性很低，因此可能会放弃时区。但是，我发现这些值有成为“未来，长期数据”的坏习惯。

一旦您决定存储时区，就必须注意它的存储方式。

*   不要将时区存储为偏移量或完整描述符。

如果您将时区存储为偏移量，如果时区发生变化，您会怎么做？您是否通过系统并对现有数据进行全面更改？如果这样做，那么您现在已经使任何历史值不正确。Oracle 和 iCal 就是这种故障的典型例子。Oracle 将时区信息存储为与 UTC 的偏移量，iCal 包含创建时区的完整描述符。

*   将其存储为名称。

这允许更改时区的定义，而无需修改您拥有的现有值。它确实使排序更加困难，因为如果时区数据发生变化，生成的任何索引都可能无效。

如果开发人员继续以 UTC 存储所有内容，而不考虑时区，我们将继续看到我们在最后一批时区更改中看到的问题。

在一个组织中，秘书必须在夏令时之前为他们的团队打印日历，然后在更改后再次打印。最后，他们比较了两者并重新创建了所有已移动的约会。当然，他们错过了好几次，而且有好几个星期的痛苦，直到旧的夏令时日期到了，时间又变得正确了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-25T01:30:01.903

乔希在上面是完全正确的，但我有一个微妙的警告要解释。这是一个关于未来事件和时区没有正确答案的案例。

考虑重复约会的情况。它发生在 GMT 0000（为简单起见），即 1200 NZST（新西兰标准时间）和澳大利亚悉尼的 1000 AEST。

当夏令时在一个区域生效时，约会应该发生什么？应该是：

1a。如果 TZ 更改位于约会的“所有者”（预订者）的区域内，那么尝试保持相同的桌面时钟时间（例如上午 10:00）？
1b。如果 TZ 更改位于其他会议参加者的区域之一，则没有更改

后果：由于所有者 TZ 的变化，它出乎意料地为其他所有人移动，但就所有者而言，它仍然是“上午 10 点会议”。

'2。同上，但反过来。

后果：它为会议所有者移动（上午 10 点的会议变成了上午 9 点的会议，或 v/v），这可能是意料之中的，但不方便。在其他与会者完成自己的 TZ 转换之前，它与其他与会者保持相同的桌面时钟时间。

两者都不完美。考虑两个约会的情况，一个由 A 预订，发生在当地时间上午 10 点，另一个由 B 预订，A 参加，发生在上午 9 点。如果 A 人和 B 人在不同的 TZ 中，那么 DST 更改很容易导致他们变成重复预订。

如果你的想法在这一点上有点弯曲，那么我很理解。

此示例背后的要点是，要正确执行这些行为中的任何一个，您不仅需要知道本地时间的 UTC 版本，还需要知道所有者在预订时所在的 TZ（而不是偏移量）。否则，您别无选择，只能默默地选择选项 2，甚至不通知任何人自从格林威治标准时间以来事情已经发生变化并没有改变，只有演示文稿发生变化......对吗？（不，这是陷阱，当您的上午 10 点会议自行进行时，演示文稿很重要）

我必须感谢我的同事和朋友 Jason Pollock 的这一见解。在此处阅读[他的观点，以及在此处讨论](http://blog.jason.pollock.ca/2008/03/timezones-and-future.html)[iCal 和 VTIMEZONE](http://blog.jason.pollock.ca/2008/03/ical-how-can-you-do-this-to-me.html)的后续内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-09T14:46:44.473

以 GMT/UTC 存储所有内容对我来说似乎是最合乎逻辑的。然后，您可以在所需的每个时区显示日期和时间。

一些注意事项：

1.  如果时间仅被指定为挂钟时间并且这是领先的表示，那么它不是绝对指定的时间。您应该（并且不能）将其转换为任何 GMT 表示形式。每天早上 9:00 AM。换句话说：这不是（日期）时间。
2.  如果您保存未来约会的日期和时间，您应该使用输入时区和*时间本身*指定的 GMT 偏移量。因此，如果是夏季预约，例如西欧的冬季，则为 +2:00，尽管正常（冬季时间）偏移量为 +1:00。这将解决 Bwooce 提到的日历问题。
3.  当然，在转换为 GMT 时使用正确的偏移量同样适用于转换回任何特定时区的日期和时间。

幸运的是，如果使用得当，（.NET）DateTime 类型会为您处理保存日历等所有血腥细节，当您知道它是如何工作时，所有这些都应该非常容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-15T05:05:56.947

就个人而言，我看不出有任何理由不将所有内容存储在 GMT 中，然后使用用户本地时区来显示与他们相关的时间。

如果您想显示相对时间，您显然仍然需要时间并进行翻译，但如果您确实想要进行翻译，我认为 GMT 仍然是您的最佳选择。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-15T05:23:13.260

所以我用 MSSQL 服务器做了一个小实验。

我创建了一个表并添加了一行包含当前本地化时区（澳大利亚）的行。然后我将日期时间更改为 GMT 并添加了另一行。

即使这些行相隔大约 10 秒添加，它们也会出现在 SQL Server 中，因为它们相隔 10 小时。

如果不出意外，它至少告诉我应该以一致的方式存储日期，这对我来说增加了将它们存储为 GMT 的论点的权重。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-15T05:27:40.413

MS Dynamics 存储 GMT，然后在用户级别知道您相对于 GMT 的时区。然后它会在您的时区向您显示项目。

只是想我会把它扔在那里，因为那是 MS 的一个相当大的团队，这就是他们决定处理它的方式。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-16T07:13:48.387

我更喜欢使用时区存储所有内容。客户可以决定以后应该以哪种方式呈现。我最喜欢的转换库是[PostgreSQL-Database](http://www.postgresql.org/docs/8.3/interactive/functions-datetime.html)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-09-19T11:18:58.957

看看这里，w3c 在回答这个问题方面做得很好。

看看用例。

[http://www.w3.org/TR/timezone/](http://www.w3.org/TR/timezone/)

请注意，他们建议将日期时间存储为 UTC 而不是 GMT，GMT 受夏令时限制。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-15T05:15:29.237

我喜欢在 GMT 中存储并且只显示相对的（“大约 10 秒前”、“5 个月前”）。对于大多数用例，用户不需要查看实际时间戳。

当然也有例外，一个单独的应用程序可能有很多例外，所以它不能是一个“单向”的答案。需要强大审计能力的事物（例如投票），以及时间是话语领域一部分的系统（天文学、科学研究）可能需要向用户显示真实的时间戳。

但是，大多数应用程序通过简单的相对时间更容易理解。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-15T06:20:14.160

我通常只使用 Unix 时间。不一定未来安全，但它运作良好。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-16T20:26:25.987

始终以 GMT（或 UTC）存储。从那里很容易转换为任何本地时区值。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-02-22T20:24:08.567

日期应存储为 UTC，除非它是用户提供的数据，并且您无法知道用户希望该数据位于哪个时区。有时（非常非常罕见）您只需要存储小时、分钟、秒、日、月和年没有任何时区的组件，因此您可以将其吐回给用户。现在对于新开发人员或者如果您不确定，请存储 UTC，您将 99% 正确。

但是不要误以为这在所有情况下都 100% 有效。它不是。

# ruby-on-rails - 为什么 sqlite3-ruby-1.2.2 在 OS X 上不起作用？

> ID：11986
> 
> 赞同：3
> 
> 时间：2008-08-15T05:23:02.153
> 
> 标签：ruby-on-rails, ruby, sqlite

我在跑步

*   OS X 10.5,
*   红宝石 1.8.6,
*   导轨 2.1,
*   sqlite3-ruby 1.2.2

并且在尝试`db:migrate`查找连接到 MySQL 的应用程序时出现以下错误。

> 耙中止！没有要加载的文件 -- sqlite3/database

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-15T05:24:54.943

看起来 1.2.2 有一个[错误](http://rubyforge.org/tracker/index.php?func=detail&aid=20533&group_id=254&atid=1043)。只需使用以下命令回滚到 1.2.1：

> 宝石安装 sqlite3-ruby -v=1.2.1

这将解决问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-28T17:48:16.883

Jamis 刚刚发布了 1.2.4，关于该错误的评论历史表明该修复存在于 1.2.3 和更高版本中。作为一个快速测试，我在一个装有 Ruby 1.8.6 的 OS X 10.5 机器上执行了以下操作：

```
sudo gem install sqlite3-ruby 
```

（验证版本号为1.2.4）

```
rails test 
```

（默认`database.yml`使用 sqlite3）

```
cd test
./script/generate model Person name:string
rake db:migrate 
```

跑得很好。在迁移完成之前sqlite3 是 d 时会发生错误`require`，所以看起来他们已经解决了这个问题。