# StackOverflow 问答 000248000-000248999

# licensing - 将 GPL 代码包装在服务、内核驱动程序或其他许可避免机制中

> ID：248005
> 
> 赞同：4
> 
> 时间：2008-10-29T19:00:58.757
> 
> 标签：licensing, gpl

关于[此评论](https://stackoverflow.com/questions/247389/please-help-me-understand-the-specifics-of-the-gpl#247428)的以下摘录：

> AFAIK，通过网络适配器与 GPL 代码交互很好。拥有比这更紧密耦合的代码通常是不行的（再次，AFAIK），特别是如果您的代码没有 GPL 代码就无法运行，但这是一个灰色区域。

因此，如果我想使用 GPL（而不是 LGPL）的图形库，我是否可以决定让它成为 linux 计算机上图形服务的一部分，只要我发布使用这个库实现此服务的代码？

假设库实现了 SVG，我决定用 SVG 来绘制矢量图形的所有屏幕。我没有将 SVG 滚动到我的几个应用程序中（并因此打开它们的源代码），而是创建了一个服务（或内核驱动程序），它侦听套接字（或实现图形设备），该套接字获取 SVG 数据并将其渲染到屏幕使用图书馆。我根据库的 GPL 发布服务/内核驱动程序代码。我不会为使用该服务或内核驱动程序的任何程序发布代码。我发布了服务/内核驱动程序的 API，以便其他人可以实现、替换它，并且仍然使用不同的服务/驱动程序运行我的二进制文件，或者开发反射器等。

*   我是否违反了 GPL 的法律条款
*   我是否违反了 GPL 的精神

我敢肯定其他人已经考虑过这一点 - 它是否发生过，社区的反应是什么？

-亚当

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T19:41:00.003

我同意之前的评论，即就 GPL 的精神而言，这看起来很糟糕。无论如何，这样做可能会在社区中遇到一些阻力，其形式可能如下：

*   不将您的工作重新检入项目主干
*   如果单独发表，不分发您的作品
*   签入，然后根据他们认为合适的方式修改 API，而不考虑它如何影响您关闭的程序，并通过正常渠道分发更改后的版本（实际上保证了您的用户的 dll 地狱）

而且当然

*   编写、分发和推动竞争性前端。

所以你可能会问自己是否值得。（请记住，基于声誉的社区可能会对某些轻视有很长的记忆。）

* * *

过去社区对 GPL 的狡猾方法的反应包括：

*   GPLv3 的结构使得其中一些技巧更加困难
*   linux 内核社区中的一个广泛联盟，反对包含加载封闭固件的模块。
*   点名和羞辱违规者，以及（同样重要的）公开承认那些已经清理了他们的行为的人。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T19:17:50.940

迟早你可能会想请律师来解决这么深的问题。关于你的第二个问题：对我来说，你在给定的情况下违反了 GPL 的精神。

当我将 MySql 许可与此进行比较时，我看到许多商业应用程序已通过商业许可分发并安装了 GPL 版本的 MySql。我不想判断这是否合法，但是对于数据库服务器和现有的抽象来说，它或多或少是自然的：应用程序接口与通用数据库接口（odbc、jdbc、任何 perl/php/ruby 等价物）这是通过驱动程序与许多应用程序之一交谈。

心甘情愿地将 GPL 软件变成服务器，创建接口层并将 GPL 版本作为该接口的唯一实现感觉很糟糕。

与作者取得联系并要求获得商业或更宽松的开源许可证可能更容易。当然，如果它对您有任何价值，您应该主动提出付款。从您的深层问题来看，它似乎对您具有更高的价值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T19:24:15.620

义务 我不是律师。

您是否违反了 GPL 的法律条款？可能不是。ATI 和 nVidia 用他们的 Linux 图形驱动程序来做这种事情。但是，重要的是要注意 Linux 是 GPLv2；这可能已经随着 GPLv3 改变了。

你违反了 GPL 的精神吗？是的，从你写问题的方式来看，你已经知道了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T19:30:42.677

一个好的经验法则是：如果你想知道你是否违反了 GPL 的精神，那么你可能是。

# html - 如何在 pre 标签中换行？

> ID：248011
> 
> 赞同：848
> 
> 时间：2008-10-29T19:03:23.353
> 
> 标签：html, css

`pre`标签对于 HTML 中的代码块和在编写脚本时调试输出非常有用，但是如何使文本自动换行而不是打印出一长行呢？

* * *

## 回答 #1

> 赞同：1173
> 
> 时间：2008-10-29T19:04:14.383

答案来自CSS 中的[这个页面：](https://longren.io/wrapping-text-inside-pre-tags/)

```
pre {
    white-space: pre-wrap;       /* Since CSS 2.1 */
    white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
    white-space: -pre-wrap;      /* Opera 4-6 */
    white-space: -o-pre-wrap;    /* Opera 7 */
    word-wrap: break-word;       /* Internet Explorer 5.5+ */
} 
```

* * *

## 回答 #2

> 赞同：203
> 
> 时间：2011-05-23T13:45:34.170

`pre`这非常适合包装文本并在-tag中保持空白：

```
pre {
    white-space: pre-wrap;
} 
```

* * *

## 回答 #3

> 赞同：77
> 
> 时间：2013-12-16T19:04:08.373

我发现跳过 pre 标记并在 div 上使用 white-space: pre-wrap 是一个更好的解决方案。

```
 <div style="white-space: pre-wrap;">content</div> 
```

* * *

## 回答 #4

> 赞同：62
> 
> 时间：2018-09-01T17:22:48.853

最简洁的是，这会强制内容包含在`pre`标签内而不会破坏单词。

```
pre {
    white-space: pre-wrap;
    word-break: keep-all
} 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2014-01-20T18:35:11.980

这就是我需要的。它可以防止单词中断，但允许在前置区域中使用动态宽度。

```
word-break: keep-all; 
```

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2011-05-15T12:26:20.740

我建议忘记 pre 并将其放在 textarea 中。

您的缩进将保留，并且您的代码不会在路径或其他东西的中间进行自动换行。

如果要复制到剪贴板，也更容易在文本区域中选择文本范围。

以下是 php 摘录，因此如果您不在 php 中，那么打包 html 特殊字符的方式会有所不同。

```
<textarea style="font-family:monospace;" onfocus="copyClipboard(this);"><?=htmlspecialchars($codeBlock);?></textarea> 
```

有关如何在 js 中将文本复制到剪贴板的信息，请参阅：[如何在 JavaScript 中复制到剪贴板？](https://stackoverflow.com/questions/400212/how-to-copy-to-clipboard-in-javascript).

然而...

我刚刚检查了 stackoverflow 代码块，它们用 <pre> 标签包装在 <code> 标签中，并带有 css ...

```
code {
  background-color: #EEEEEE;
  font-family: Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;
}
pre {
  background-color: #EEEEEE;
  font-family: Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;
  margin-bottom: 10px;
  max-height: 600px;
  overflow: auto;
  padding: 5px;
  width: auto;
} 
```

此外，stackoverflow 代码块的内容是使用（我认为）[http://code.google.com/p/google-code-prettify/](http://code.google.com/p/google-code-prettify/)突出显示的语法。

这是一个不错的设置，但我现在只使用 textareas。

* * *

## 回答 #7

> 赞同：19
> 
> 时间：2017-08-20T15:35:05.930

我结合了@richelectron 和@user1433454 的答案。
它工作得很好，并保留了文本格式。

```
<pre  style="white-space: pre-wrap; word-break: keep-all;">

</pre> 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2008-10-29T19:06:35.783

您可以：

```
pre { white-space: normal; } 
```

保持等宽字体但添加自动换行，或者：

```
pre { overflow: auto; } 
```

这将允许固定大小的长线水平滚动。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-29T19:10:14.323

尝试使用

```
<pre style="white-space:normal;">. 
```

或者更好地抛出 CSS。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2019-12-04T22:05:59.933

使用`white-space: pre-wrap`and 一些前缀在`pre`s 中自动换行。

不要使用`word-wrap: break-word`，因为这当然会将一个单词分成两半，这可能是您不想要的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-05-18T09:26:04.137

-Element 代表“`<pre>`预格式化文本”，旨在保持其标签之间的文本（或其他）格式。因此，实际上并不打算在 -Tag 中自动换行或换`<pre>`行

> 元素中的文本以固定宽度的字体（通常是 Courier）显示，并且**保留了空格*和换行符***。

[来源：w3schools.com](http://www.w3schools.com/tags/tag_pre.asp)，强调自己制作。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-07-17T01:01:11.593

**最佳跨浏览器方式对我有用，可以换行并显示准确的代码或文本：**（chrome、internet explorer、Firefox）

CSS：

```
xmp{ white-space:pre-wrap; word-wrap:break-word; } 
```

HTML：

```
<xmp> your text or code </xmp> 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-07-02T07:55:26.760

以下帮助了我：

```
pre {
    white-space: normal;
    word-wrap: break-word;
} 
```

谢谢

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-10-12T19:46:06.137

如果您使用 prism 或任何代码格式化库，那么您将需要修改展位前和代码标签，如下所示：

```
pre {
    overflow-x: auto !important;
    white-space: pre-wrap !important;       /* Since CSS 2.1 */
    white-space: -moz-pre-wrap !important;  /* Mozilla, since 1999 */
    white-space: -pre-wrap !important;      /* Opera 4-6 */
    white-space: -o-pre-wrap !important;    /* Opera 7 */
    word-wrap: break-word !important;       /* Internet Explorer 5.5+ */
}

code{
    white-space: normal !important;
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-12-22T21:43:42.897

`<pre>`它的工作，但代码有`<code>`标签。

# .net - .NET 是否消除了各种语言之间的区别？

> ID：248014
> 
> 赞同：2
> 
> 时间：2008-10-29T19:04:32.493
> 
> 标签：.net, programming-languages, idioms

我们总是有更适合在特定场景中使用的语言。对于快速原型开发，VB6 是一个显而易见的选择。在具有简单桌面用户界面和标准且不复杂的数据库交互要求的项目中选择了 VB6。如果您想使用低级例程开发设备驱动程序，您可能依赖于 C 或 Visual C++。ASP 是开发 Web 界面的标准选择。粗略地说，每种语言都有特定的“领域”或“专业化”。

使用 .NET 框架，所有语言都可以互操作并且可能是一致的。您可以拥有一个项目，其中包含来自不同语言的模块，但最终都被相当相似地对待（都被编译为 IL）。

这是否意味着我们之前的区别不再存在？这种差异不一定是坏事，而是设计上存在的，而不是由于任何限制。随着 .NET 框架及其对各种语言的处理，这显然有所减少。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T19:10:20.783

区别仍然存在。例如，VB.NET 目前以比 C#（不包括 C# 4.0）更好的方式支持 IDispatch 后期绑定，并且 VB.NET 具有与代码内联的 XML 文字，与其他 .NET 语言相比，这使其成为操作 XML 的便捷工具。C++ 往往不太适合 .NET，即使使用 C++/CLI 变体也是如此，但它非常适合本机编程（一如既往）以及在托管和非托管代码之间提供互操作层。

每种语言的语法都有细微差别，可以更容易地表达某些概念。即使它们都归结为 IL，但它们都归结为组装时与以前没有什么不同。无论编译到何种平台，您都可以选择语法最能支持您尝试执行的任务的语言。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-29T19:20:43.367

语言差异仍然存在。将语言编译为汇编代码还是 MSIL 并没有真正的区别，只是 MSIL 的抽象级别可能高于汇编的抽象级别。

不过，.Net 的一大优势（这可能引发了这个问题）是，您可以在以语言 2 编写的库中使用语言 1 的目标代码，该库由以语言 3 编写的应用程序链接。

很久以前，在电力和汽车出现之前，你不能简单地在 Pascal 或 Delphi 应用程序中使用 C 生成的 .obj 文件（反之亦然）而不将它们显式包装在 DLL 中（并注意调用方法和参数序列和参数兼容性），或调用另一个可执行文件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T19:10:53.573

不，它没有框架的功能与语言功能不同。说 .Net 消除了语言之间的区别就像说汇编代码消除了语言之间的区别。

语言仍然有不同的特点，一些语言的语法更擅长解决一些问题，否则整个 .Net 框架会在单一语言上同质化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T21:17:03.647

如果有的话，我认为它可能*加深*了语言之间的区别，正是*因为*它们具有如此互操作性。现在的重点是**语言**。

相同的基础服务和基类可用这一事实意味着您可以根据*语言*提供的内容而不是与语言合作的框架提供的内容来对语言做出明智的决定。

例如，为了使用后期绑定的 COM，我可能（不情愿地）选择 VB（或者我可能等待 C# 4.0）。对于一些特定的财务/模拟工作，我可能会认真考虑 F#。对于常规业务编程，我完全的选择是 C#。

但是您可以根据适合不同块的*语言*进行这些选择，并从不同语言的不同 dll 中将完成的应用程序编织在一起。以前您可能不得不处理部分代码，因为您*必须*使用语言*x*才能使其与其余代码互操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T21:33:57.607

我认为这实际上取决于提出问题的背景。

假设您正在开发一个供客户使用的库。`CLSCompliant`您使用属性标记此程序集。这意味着编译器将强制您使用 CLR 保证的功能，并且如果您使用特定于语言的功能则无法编译。

在考虑符合 CLS 的库时，.NET 消除了语言之间的区别。每种 .NET 语言都必须符合 CLS，因此您可以保证平等地支持每种 .NET 语言。

现在，假设您正在用 VB .NET 编写库，并且您决定使用可选参数而不是方法重载。在这种情况下，.NET 突出了语言之间的区别，因为可选参数不符合 CLS（尽管 C# 显然在 .NET 4.0 中支持它们。）对于使用不支持可选参数的语言的人，您的库可能是不可能或充其量难以使用。每种语言都有一些不符合 CLS 的功能，当使用这些功能时，您可能会使某些 .NET 语言的用户更难使用您的库。

所以，我觉得这是一个棘手的问题。如果您正在编写符合 CLS 的代码，那么 .NET 语言之间只有语法差异。如果您不是，那么您可能会编写某些 .NET 语言无法使用的方法。

# email - SMTP 中继限制

> ID：248016
> 
> 赞同：0
> 
> 时间：2008-10-29T19:05:00.013
> 
> 标签：email, dynamic

我们已经建立了一个系统，通知通过以下发件人地址格式发送给用户： user-{0} **@aol.com**（将 {0} 替换为 ID）

这样我们就可以跟踪我们最初将消息发送给了哪个用户。由于各种原因，这种格式不太可能改变。我们遇到的问题是：我们发送的每封带有动态地址的电子邮件都在创建一个新的 SMTP 中继。

我对继电器的了解非常有限。我们的主机 (GoDaddy) 将 SMTP 中继限制为每天 250 个。这是一个可能每天发送数千封电子邮件的应用程序。

*我假设我们使用的每个“未注册”电子邮件地址都会打开一个新的中继，对吗？如果是这样，是否有任何服务或主机以合理的价格提供无限中继？*

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-29T19:14:02.490

> 所以我假设我们使用的每个“未注册”电子邮件地址都会打开一个新的中继，对吗？

继电器基本上是一个分类。通过中继发送的每封电子邮件都会在邮件服务器上打开一个 SMTP 连接，而不是“新中继”……也就是说，如果可以的话，设置自己的发送 SMPT 服务器可能会更便宜。它是 IIS 的一个组件。如果您需要有关设置的任何其他信息，请告诉我。

Godaddy，是的，因为计划不同。您也可以尝试任何其他电子邮件提供商，例如 google 和 yahoo。只需确保为未送达的邮件和任何回复设置“捕获”所有邮箱即可。

# internet-explorer - 如何在 IE 上获得图像透明度

> ID：248018
> 
> 赞同：1
> 
> 时间：2008-10-29T19:05:28.157
> 
> 标签：internet-explorer, transparency, firefox-3

我有一个设置了 alpha 的 GIF 图像，当我的网站在 Firefox 3.0 中加载时，它会透明地作用于图像中应有的部分。但是，当我尝试在 IE7 中加载 GIF 图像时，它会以实心块的形式返回。实际上，它就像图像中的颜色渗入透明区域一样。

有人对解决此类问题有任何建议吗？关于要查看的内容的指针，或者您用来解决此类问题的路线。

我一直在 CSS 中控制这一点——虽然我想避免使用条件注释路由和多个 CSS，但如果该建议能切实表明我可以如何解决 IE 兼容性问题，我会愿意的。

谢谢，肖恩

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T19:13:02.803

我不记得 IE（任何版本）中的透明 gif 有问题。

首先尝试自行加载图像 - 这将告诉您是图像还是某些 CSS 规则出错了。

如果仍然错误，请尝试使用其他程序重新保存。gimp会做的。

编辑：它在 CSS 级别，所以我会检查哪些规则具有正在出现的背景颜色......希望它应该很容易找到一个可能的候选人。将颜色更改为 #ff0000 并检查图像是否按预期更改。然后找出为什么该规则显示在 IE 而不是 FF 上。如果您有该页面的 URL，我可以看一下。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T19:11:24.260

试试这两个——把数字弄乱，直到你做对为止。i 4get 用于 IE 和 FF/chrome

```
opacity: 7;
filter: alpha(Opacity=7); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T19:16:01.957

我通过切换到 png 修复了 gif 透明度问题。IE7 正确渲染 png alpha 通道。

在 IE7 中打印透明 png 仍然无法正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T19:26:22.777

这很**奇怪**——我在我认为在 CSS 文件中被注释掉的语句中发现了问题：

```
//margin-top: 46px;
//background-color: #377696; 
```

这是在包含两个图像的元素中。

我赞成每个答案。谢谢！

# .net - 使用 SQLExpress 部署应用程序

> ID：248022
> 
> 赞同：2
> 
> 时间：2008-10-29T19:06:24.033
> 
> 标签：.net, sql-server-express

我一直在使用 SQLExpress 创建一些应用程序，并发现自己在应用程序安装后编写数据库创建、表和其他实体等脚本。这是正常的方式吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T19:36:42.070

仅当您在保留（大部分）数据的同时不需要升级数据库时，制作模板数据库并进行恢复才有效。

尽管它很麻烦，但我实际上使用了一些类来检查数据库版本并运行必要的脚本（安装 SQLExpress、安装数据库或进行升级）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T19:16:47.900

一种更快的方法是备份模板数据库，并将其作为安装的一部分进行恢复。

AFAIK，这就是 MS 和 Orcl（尤其是）如何做到的。

# c# - 我完成了这个链接列表代码吗？

> ID：248031
> 
> 赞同：4
> 
> 时间：2008-10-29T19:09:24.607
> 
> 标签：c#, linked-list

嗨，我正在尝试使用链接列表进行一些练习。

我定义了一个名为的对象类`Student`：

```
public class Student
{
      protected string  Student_Name;
      protected int Student_ID;
      protected int Student_Mark;
      protected char    Student_Grade;

      public Student()  // default Constructor
      {
         Student_Name = "           ";
         Student_ID = 0;
         Student_Mark = 0;
         Student_Grade = ' ';
        }

      public Student(string Sname, int Sid, int Smark, char Sgrade) // Constructor
      {
         int len = sname.Length;
         Student_Name = sname.Substring(0, len);
         //Student_Name = sname.Substring(0, sname.Length);
         Student_ID = Sid;
         Student_Mark = Smark;
         Student_Grade = Sgrade;
      }
} 
```

然后是一个`Node`类：

```
public class S_Node
{
      public Student    Element;
      public S_Node Link;

      public S_Node()
      {
         Element = new Student();
         Link = null;
      }

      public Node(Student theElement)
      {
         Element = theElement;
         Link = null;
      }
} 
```

和`LinkedList`：

```
public class S_LinkedList
{
    protected S_Node header;
    protected S_Node tail;

    public S_LinkedList()
    {
       header = new S_Node();
       Tail = new S_Node();
       header.Link = Tail;
    }

    // METHODS which i don't know how to do it (never use linkedlist before)
} 
```

我需要使用“链表数据结构类型”来组织这些数据。

包含linkedlist的所有方法作为我学到的添加节点到列表->（插入），从列表中删除节点，正如我所学到的-->（（删除），遍历我学到的列表- ->((PrintList),根据我的学习在列表中找到一个节点->((Find , FindPrevious) 我正在自学的问题，我试图搜索网络并从愚蠢的 C# 中阅读更多内容是一场灾难。我做了太多，以至于我很难过，以至于我不知道如何完成它。

我正在努力使用这些类来编写可执行程序并对其进行测试。

如果你不想帮助完成这个程序（希望不是），至少给我一些真实的例子或想法，毕竟我是一个自学极客 :-)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-30T00:18:44.980

```
列表的头部。
 （第 1 项
   元素：student1
   下一个------------> ( item2
  ) 元素：student2
                        下一个------------> ( item3
                      ) 元素：student3
                                             下一个：空
                                           )
                                           列表的尾部。

```

首先，为了能够编写 StudentList 类，您需要先编写客户端代码。客户端代码是使用您的学生列表的代码。另外，不要一次只写一件事然后扔掉。而是编写一大堆 [测试] 案例来练习与 StudentList 交互*所需的不同方式。*也写特例。但是不要试图写一把瑞士军刀，因为它可以做任何事情。编写完成工作的最少代码量。

您需要如何使用该类将在很大程度上决定该类的构造方式。这是 TDD 或测试驱动设计的本质。

我可以看到你最大的问题是你不知道你想如何使用这个类。所以让我们先这样做。

```
// create a list of students and print them back out.
StudentList list = new StudentList();
list.Add( new Student("Bob", 1234, 2, 'A') );
list.Add( new Student("Mary", 2345, 4, 'C') );

foreach( Student student in list)
{
    Console.WriteLine(student.Name);
} 
```

我将学生添加到列表中，然后打印出来。

我不需要我的客户端代码在 StudentList 中查看。因此 StudentList 隐藏了它是如何实现链表的。让我们编写 StudentList 的基础知识。

```
public class StudentList 
{
    private ListNode _firstElement; // always need to keep track of the head.

    private class ListNode
    {
        public Student Element { get; set; }
        public ListNode Next { get; set; }
    }

    public void Add(Student student) { /* TODO */ }

} 
```

StudentList 非常基础。在内部，它跟踪第一个或头节点。显然总是需要跟踪第一个节点。

您可能还想知道为什么在 StudentList 中声明 ListNode。发生的情况是 ListNode 类只能由 StudentList 类访问。这样做是因为 StudentList 不想将细节透露给它的内部实现，因为它控制着对列表的所有访问。StudentList 从不透露列表是如何实现的。实现隐藏是一个重要的面向对象概念。

如果我们确实允许客户端代码直接操作列表，那么将 StudentList 放在首位就毫无意义。

让我们继续实现 Add() 操作。

```
public void Add(Student student)
{
    if (student == null)
        throw new ArgumentNullException("student");

    // create the new element
    ListNode insert = new ListNode() { Element = student };

    if( _firstElement == null )
    {
        _firstElement = insert;
        return;
    }

    ListNode current = _firstElement;
    while (current.Next != null)
    {
        current = current.Next;
    }

    current.Next = insert;
} 
```

Add 操作必须找到列表中的最后一项，然后将新的 ListNode 放在末尾。不过效率不是很高。目前是 O(N) 并且随着列表变长，添加会变慢。

让我们为插入优化一点并重写 Add 方法。为了使 Add 更快，我们需要做的就是让 StudentList 跟踪列表中的最后一个元素。

```
private ListNode _lastElement;  // keep track of the last element: Adding is O(1) instead of O(n)

public void Add(Student student)
{
    if( student == null )
        throw new ArgumentNullException("student");

    // create the new element
    ListNode insert = new ListNode() { Element = student };

    if (_firstElement == null)
    {
        _firstElement = insert;
        _lastElement = insert;
        return;
    }

    // fix up Next reference
    ListNode last = _lastElement;
    last.Next = insert;
    _lastElement = insert;
} 
```

现在，当我们添加时，我们不会迭代。我们只需要跟踪头部和尾部引用。

接下来：foreach 循环。StudentList 是一个集合，作为一个集合，我们想要枚举它并使用 C# 的`foreach`. C# 编译器不能神奇地迭代。为了使用 foreach 循环，我们需要为编译器提供一个枚举器以供使用，即使我们编写的代码没有明确显示使用该枚举器。

不过，首先，让我们重新回顾一下我们是如何遍历链表的。

```
// don't add this to StudentList
void IterateOverList( ListNode current )
{
    while (current != null)
    {
        current = current.Next;
    }
} 
```

好的。所以让我们挂钩到 C# 的 foreach 循环并返回一个枚举器。为此，我们更改 StudentList 以实现 IEnumerable。这有点先进，但你应该能够弄清楚发生了什么。

```
// StudentList now implements IEnumerable<Student>
public class StudentList : IEnumerable<Student>
{
    // previous code omitted

    #region IEnumerable<Student> Members
    public IEnumerator<Student> GetEnumerator()
    {
        ListNode current = _firstElement;

        while (current != null)
        {
            yield return current.Element;
            current = current.Next;
        }
    }
    #endregion

    #region IEnumerable Members
    IEnumerator IEnumerable.GetEnumerator()
    {
        return GetEnumerator();
    }
    #endregion
} 
```

您应该能够在其中发现链表迭代。不要被`yield`关键字抛出。yield 所做的只是将当前学生返回到 foreach 循环。当枚举器到达链表的末尾时，它会停止返回学生。

就是这样！代码按照我们想要的方式工作。

* * *

* 这绝不是实现列表的唯一方法。我选择将列表逻辑放在 StudentList 中并保持 ListNode 非常基本。但是代码只做我的第一个单元测试需要的，仅此而已。您可以进行更多优化，并且还有其他构建列表的方法。

展望未来：你需要做的是首先为你的代码需要做的事情创建[单元]测试，然后添加你需要的实现。

* * *

* 仅供参考，我还重写了 Student 类。来自 C# 透视的错误命名和奇怪的大小写，更不用说您提供的代码无法编译。我更喜欢`_`作为领导者而不是私有成员变量。有些人不喜欢这样，但是你是新手，所以我会把它们留在里面，因为它们很容易被发现。

```
public class Student
{
    private string _name;
    private int _id;
    private int _mark;
    private char _letterGrade;

    private Student()  // hide default Constructor
    { }

    public Student(string name, int id, int mark, char letterGrade) // Constructor
    {
        if( string.IsNullOrEmpty(name) )
            throw new ArgumentNullException("name");
        if( id <= 0 )
            throw new ArgumentOutOfRangeException("id");

        _name = name;
        _id = id;
        _mark = mark;
        _letterGrade = letterGrade;
    }
    // read-only properties - compressed to 1 line for SO answer.
    public string Name { get { return _name; } }
    public int Id { get { return _id; } }
    public int Mark { get { return _mark; } }
    public char LetterGrade { get { return _letterGrade; } }
} 
```

*   检查参数
*   注意属性、类和变量的不同大小写。
*   隐藏默认构造函数。为什么我要创建没有真实数据的学生？
*   提供一些只读属性。
    *   这个类在书面上是不可变的（即一旦你创建了一个学生，你就不能改变它）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T19:30:17.560

我给你做一个！您需要将每个节点绘制为一个框，并计算出您需要使用哪些代码来更改每个操作的列表。看看这个以获得一些灵感：

[http://en.wikipedia.org/wiki/Linked_list](http://en.wikipedia.org/wiki/Linked_list)

那里的图表没有将主列表类显示为您应该拥有的框，其中有两个箭头用于标题和尾部。

在 Insert 方法中为这两种情况绘制一些图表，以了解发生了什么。一个图表表示列表中没有任何内容且标题为空，另一个图表表示列表中已有内容。然后从那里进行其他操作。

```
public class S_LinkedList {

    protected S_Node header = null;

    protected S_Node tail = null;

    public S_LinkedList()
    {
    }

    // METHODS which i don't know how to do it (never use linkedlist before)
    void Insert(Student s)
    {
        if( header == null )
        {
            header = new S_Node(s);
            tail = header;
        }
        else
        {
            tail.Link = new S_Node(s);
            tail = tail.Link;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T19:30:28.543

您缺少的操作是：

**添加：**

将尾节点的链接设置为添加节点，将尾节点设置为新节点。

**删除/删除：**

如果您没有双向链表但使用单链表从头开始遍历列表，直到找到需要将前一个节点保存在单独变量中的节点，这有点棘手。当您找到要删除的节点时，将前一个节点的链接设置为该节点链接。优化可能是检查它是否不是您要查找的链接。或者使它成为一个双向链表，您不需要跟踪前一个节点。

**寻找：**

从一个节点到另一个节点遍历列表，直到找到您要查找的那个。

阅读这篇[维基百科文章了解更多信息。](http://en.wikipedia.org/wiki/Linked_list)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T19:37:08.810

看看[这个...](http://www.csharphelp.com/archives3/archive478.html)

虽然如果你真的想学习如何做到这一点，你应该至少用 c 或 c++ 编写它，然后你会做一些有用的事情......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T19:13:13.397

实际上，我没有理由用 C# 编写自己的链表（除了学习它是如何工作的），因为 .NET 已经包含 LinkedList 泛型类。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T20:16:23.987

链表的概念并不难理解。另一方面，实施......可能会有点棘手。

我也可以理解您尝试在网络上查找有关它的信息的挫败感。我以前在你的船上，一切都因地点而异。您可能真的想投资一本数据结构书，因为我认为您找到的信息将比您在野外找到的大多数信息更加清晰和有用。

如果您以前从未使用过 ll，在 Java/C# 中实现链表会容易得多。然而，一旦你对它有了更好的感觉，你就会通过在 C/C++ 中创建它们来更好地理解 ll。

从上面的代码中，您最好将每个 S_Node 视为包含 Student 对象的常规节点，而不是将其视为 Student 节点（希望这是有道理的）。相同的规则适用于您的 S_LinkedList 类。链表是节点的列表模式。这些节点包含学生对象。

希望这可以帮助。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-29T20:22:05.567

**试试这个作为你的学生课程。**

```
public class Student
{
    protected string Name;
    protected int ID;
    protected int Mark;
    protected char Grade;

    public Student()  // default Constructor
    {
        Name = "";
        ID = 0;
        Mark = 0;
        Grade = '';
    }

    public Student(string Name, int ID, int Mark, char Grade) // Constructor
    {
        this.Name = Name;
        this.ID = ID;
        this.Mark = Mark;
        this.Grade = Grade;
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T19:14:26.407

你的问题，正如我所读的那样，太模糊了。我会从谷歌搜索“链接列表”或拿起一本关于“数据结构”的书开始。当您遇到特定问题时，请在此处提出，我相信有人会帮助您。

# reporting-services - 如何在 Reporting Services 2005 中更改单个单元格的背景颜色

> ID：248035
> 
> 赞同：1
> 
> 时间：2008-10-29T19:10:20.737
> 
> 标签：reporting-services

我正在尝试根据字符串值更改单个单元格的背景颜色，并希望查看此表达式代码。

[我在这里](https://stackoverflow.com/questions/44376/add-alternating-row-color-to-sql-server-reporting-services-report)阅读了一个类似的问题，但这与我要解决的问题不完全相同。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T19:31:36.807

如果您传递要用作字符串的颜色名称，则只需在表达式中引用该列：

示例查询：

```
SELECT 'Green' as BG_Color 
```

背景颜色表达式：

```
=Fields!BG_Color.Value 
```

# oracle - Oracle 是否允许在 IN 子句中使用 ORDER BY？

> ID：248046
> 
> 赞同：0
> 
> 时间：2008-10-29T19:12:16.597
> 
> 标签：oracle, plsql, ora-00907

当我运行此查询时，Oracle 给我一个错误（ORA-00907：缺少右括号）：

```
select * 
from reason_for_appointment 
where reason_for_appointment_id in 
(
    select reason_for_appointment_id 
    from appointment_reason 
    where appointment_id = 11 
    order by appointment_reason_id
) 
```

但是，当我只运行子查询时，没有错误。

谁能解释问题是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-29T19:13:16.440

内部查询结果将永远不会显示，因此在嵌套选择中进行排序是没有意义的。而是将其应用于外部查询。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T21:40:15.457

问题是在这样的子查询中不允许使用 ORDER BY。你为什么想要一个？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T00:42:12.517

看起来您希望使用在另一个表中定义的顺序来显示一个表的结果。内部连接就足够了。

```
select reason_for_appointment.*
from reason_for_appointment rfa, appointment_reason ar
where rfa.reason_for_appointment_id = ar.reason_for_appointment_id
and ar.appointment_id = 11
order by ar.appointment_reason_id; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T14:10:50.087

select * from reason_for_appointment where reason_for_appointment_id in (select reason_for_appointment_id fromointment_reason whereointment_id = 11 order by modify_reason_id）

尝试类似：使用辅助作为（从约会原因中选择reason_for_appointment_id，其中约会ID = 11按约会原因ID订购）从约会原因中选择reason_for_appointment_id where reason_for_appointment_id in（从辅助中选择reason_for_appointment_id）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T16:16:17.167

如果您的目标是对输出进行排序，您只需将 ORDER BY 移到子查询之外：

```
select * from reason_for_appointment where reason_for_appointment_id in
 (select reason_for_appointment_id from appointment_reason where appointment_id = 11)
 order by reason_for_appointment_id 
```

（我假设你写“appointment_reason_id”的地方是“reason_for_appointment_id”。如果真的有两个不同的列有这些名字......哎呀。）

# sql - 如何改进此 SQL 查询？

> ID：248052
> 
> 赞同：1
> 
> 时间：2008-10-29T19:13:47.263
> 
> 标签：sql, postgresql

我正在检查 in_fmd 中是否存在一行，我查找的 ISBN 可以是 ISBN 参数，也可以是交叉编号表中可能有也可能没有行的另一个 ISBN。

```
select count(*)
from in_fmd i
where (description='GN')
    and ( i.isbn in
    (
        select bwi_isbn from bw_isbn where orig_isbn = ?
        union all
        select cast(? as varchar) as isbn
    )
) 
```

我实际上并不关心行数，而仅仅关心至少一行的存在。

这曾经是三个单独的查询，我将它压缩为一个，但我认为还有更多改进的空间。如果重要的话，它是 PostgreSQL 8.1。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T19:19:18.003

为什么要打扰`UNION ALL`

```
select count(*)
from in_fmd i
where (description='GN')
    and (
        i.isbn in (
            select bwi_isbn from bw_isbn where orig_isbn = ?
        )
        or i.isbn = cast(? as varchar)
    ) 
```

我可能会使用`LEFT JOIN`-style 查询而不是`IN`，但这更符合个人喜好：

```
select count(*)
from in_fmd i
left join bw_isbn
    on bw_isbn.bwi_isbn = i.isbn
    and bw_isbn.orig_isbn = ?
where (i.description='GN')
    and (
        bw_isbn.bwi_isbn is not null
        or i.isbn = cast(? as varchar)
    ) 
```

通过 IM 讨论的倒置：

```
SELECT SUM(ct)
FROM (
    select count(*) as ct
    from in_fmd i
    inner join bw_isbn
        on bw_isbn.bwi_isbn = i.isbn
        and bw_isbn.orig_isbn = ?
        and i.isbn <> cast(? as varchar)
        and i.description = 'GN'

    UNION

    select count(*) as ct
    from in_fmd i
    where i.isbn = cast(? as varchar)
        and i.description = 'GN'
) AS x 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T19:20:37.033

> 我实际上并不关心行数，而仅仅关心至少一行的存在。

那么`SELECT ... LIMIT 1`在调用程序中查询和检查你是否得到一个结果行呢？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T06:03:07.010

```
SELECT SUM(ct)
FROM (select count(*) as ct
      from in_fmd i
      inner join bw_isbn
         on bw_isbn.bwi_isbn = i.isbn
        and bw_isbn.orig_isbn = ?
        and i.isbn <> cast(? as varchar)
        and i.description = 'GN'
      UNION
      select count(*) as ct
      from in_fmd i
      where i.isbn = cast(? as varchar)
        and i.description = 'GN'
     ) AS x 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T06:13:09.690

除了其他海报所指出的，只是改变了

选择计数（*）

到

存在（..）

会[改善](http://www.postgresql.org/docs/7.4/interactive/functions-subquery.html)很多

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T19:20:36.487

```
select count(*)
from in_fmd i
where description = 'GN'
  and exists (select 1 
              from bwi_isbn 
              where bw_isbn.bwi_isbn = in_fmd.isbn) 
```

# asp.net - 在 DotNetNuke 中，如果我只有一个 ModuleId（而不是 TabId），我如何获得一个 ModuleInfo 对象

> ID：248067
> 
> 赞同：3
> 
> 时间：2008-10-29T19:18:31.373
> 
> 标签：asp.net, .net, dotnetnuke, dotnetnuke-module

DNN 框架提供的唯一通过 ID 获取模块的方法还需要一个选项卡 ID。如果我没有*标签*ID，我该怎么办？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-29T19:18:42.013

如果您没有选项卡 ID，DotNetNuke.Entities.Modules.ModuleController 类的 GetModule 方法将接受选项卡 ID 的“null”值。也就是说，尝试以下操作：

```
new ModuleController().GetModule(moduleId, DotNetNuke.Common.Utilities.Null.NullInteger) 
```

另请参阅[我关于该主题的博客文章](http://weblogs.asp.net/briandukes/archive/2008/10/29/get-module-by-moduleid.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T05:13:11.413

将 null TabId 传递给 GetModule 时要注意的一件事是，如果您有一个安装在多个不同选项卡上的模块，您将得到第一个，因此 TabId、TabModuleId 和 ModuleOrder 的值将是基于第一个实例，它可能是也可能不是您想要的实例。

高温下，

大学教师

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-11-01T19:39:51.637

Brian，我刚刚查看了 GetModule() 的代码，框架中没有任何特定的 VB 代码检查 tabid 是否为空。有趣的是，作为 SqlDataProvider 一部分的存储过程从 Modules 视图中选择具有匹配 moduleid 的行，无论 tabid 是什么......

```
ALTER PROCEDURE [dbo].[dnn_GetModule]

    @ModuleId int,
    @TabId    int

AS
SELECT  * 
FROM dbo.dnn_vw_Modules
WHERE   ModuleId = @ModuleId
AND     (TabId = @TabId or @TabId is null) 
```

如果我理解正确，这将返回 moduleid 是您指定的行的所有行，无论 @tabid 是否为空。这使得@TabId 变得毫无意义，你不觉得吗？

# .net - 如何在 C# 中检索程序集的版本？

> ID：248069
> 
> 赞同：8
> 
> 时间：2008-10-29T19:18:50.063
> 
> 标签：.net, assemblies

我有一个类型的引用，我想检索它所在的程序集的版本号。

做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-29T19:24:56.633

您可以使用，

```
x.GetType().Assembly.GetName().Version 
```

# c# - 在“空”引用（即没有订阅者的事件）上调用扩展方法是邪恶的吗？

> ID：248072
> 
> 赞同：59
> 
> 时间：2008-10-29T19:19:43.947
> 
> 标签：c#, events, extension-methods

恶还是不恶？

```
public static void Raise(this EventHandler handler, object sender, EventArgs args)
{
   if (handler != null)
   {
      handler(sender, args);
   }
}

// Usage:
MyButtonClicked.Raise(this, EventArgs.Empty);

// This works too! Evil?
EventHandler handler = null;
handler.Raise(this, EVentArgs.Empty); 
```

请注意，由于扩展方法的性质，如果 MyButtonClicked 为 null，MyButtonClicked.Raise 将不会抛出 NullReferenceException。（例如，没有 MyButtonClicked 事件的侦听器）。

恶不恶？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-29T19:24:28.663

不邪恶。我希望事件默认以这种方式工作。有人可以解释为什么没有订阅者的事件为空吗？

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-29T19:29:18.293

你总是可以这样声明你的事件（不是我推荐的）：

```
public event EventHandler<EventArgs> OnClicked = delegate { }; 
```

这样，当您调用它们时，它们就会分配给它们，因此它们不会引发空指针异常。

您可能可以摆脱 C# 3.0 中的委托关键字...

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-16T03:19:44.273

不要忘记使用`[MethodImpl(MethodImplOptions.NoInlining)]`，否则它可能不是线程安全的。

（很久以前在某处读过，记得它，谷歌搜索并找到[http://blog.quantumbitdesigns.com/tag/events/](http://blog.quantumbitdesigns.com/tag/events/)）

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-11T11:48:40.947

来自 java 背景，这对我来说总是很奇怪。我认为没有人听一个事件是完全有效的。特别是在动态添加和删除侦听器时。

对我来说，这似乎是 C# 的问题之一，当人们不知道/忘记每次都检查 null 时会导致错误。

隐藏这个实现细节似乎是一个不错的计划，因为每次都检查空值对可读性没有帮助。我敢肯定，MSFT 会说，如果没有人在听，不构造事件会带来性能提升，但恕我直言，在大多数业务代码中，毫无意义的空指针异常/可读性降低远远超过了它。

我还将这两种方法添加到类中：

```
 public static void Raise(this EventHandler handler, object sender)
    {
        Raise(handler, sender, EventArgs.Empty);
    }

    public static void Raise<TA>(this EventHandler<TA> handler, object sender, TA args)
        where TA : EventArgs
    {
        if (handler != null)
        {
            handler(sender, args);
        }
    } 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-29T19:27:02.993

为什么会是邪恶的？

它的目的很明确：它引发 MyButtonClicked 事件。

它确实增加了函数调用开销，但在 .NET 中，它要么被优化掉，要么非常快。

这有点微不足道，但它解决了我对 C# 的最大抱怨。

总的来说，我认为这是一个绝妙的主意，并且可能会窃取它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T19:32:22.953

我不会说它是邪恶的，但我对你的扩展方法如何适应

```
protected virtual OnSomeEvent(EventArgs e){ } 
```

模式以及它如何通过继承处理可扩展性。它是否假定所有子类都将处理事件而不是覆盖方法？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-18T11:04:27.433

尽管我不会将其描述为*evil*，但它仍然具有负面影响，因为它增加了不必要的开销：

打电话时

`myEvent.Raise(this, new EventArgs());`

对象 EventArgs 在所有情况下都会被初始化，即使没有人订阅 myEvent。

使用时

```
if (myEvent!= null) {
   myEvent(this, new EventArgs());
} 
```

仅当有人订阅 myEvent 时才会初始化 EventArgs。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2011-09-07T07:24:05.227

在没有处理程序时抛出异常并不是最可取的。如果它没有处理程序，最好为空而不是 null。

# java - 是否有更新使用 EJB 的应用程序的首选方法？

> ID：248094
> 
> 赞同：1
> 
> 时间：2008-10-29T19:26:57.410
> 
> 标签：java, deployment, ejb, maintenance, release-management

我有一个适用于 EJB 的 java 应用程序，但是如果：

1.  EJB 得到更新，应用程序损坏。
2.  应用服务器已更新，应用已损坏。

在没有人工参与的情况下，是否有一种首选方法来更新应用服务器和 bean 的客户端 jar？

如果首选方法取决于应用服务器，则假设为 jboss。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-29T23:54:28.650

这就是人们迁移到 Web 服务的原因之一 :) 或者也使用 JMS。

确实，如果您的应用服务器升​​级或供应商更改，您的旧/外国存根将无法在服务器端使用新代码。:-(

还记得 EJB 声明应该有一个应用程序部署者角色吗？由他为客户端应用程序准备 client.jar 并分发它（或者可能是应用程序打包器？没关系；关键是：这不是**自动**操作）。

一些技巧可能是可能的（例如要求将 client.jar 放在服务器上的特定位置以先由客户端下载，然后使用类加载器来使用），但这些技巧比既定做法更多。

至于 JBoss 的细节，我没有任何信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T18:50:34.970

你的基本问题是，如果一个组件之间的接口合同发生变化，它会破坏另一个组件。这不是仅限于应用程序和 EJB 的问题，它只是编译器不安全。

我所知道的唯一自动化方法是以使 App 项目依赖于 EJB 项目（在 IDE 和构建文件中）的方式设置您的项目，从而为您提供编译器检查。并将它们一起部署为 EAR。

如果这不是一个选项，并且它们必须单独部署，那么您的 EJB 开发人员需要在他的游戏中保持向后兼容的接口完好无损。

# vim - 是否有任何命令可以切换启用自动文本换行？

> ID：248102
> 
> 赞同：25
> 
> 时间：2008-10-29T19:28:53.880
> 
> 标签：vim

默认情况下，我认为我的 vimrc 设置启用了自动换行。但是，有时，我希望看到文本行不换行。是否有任何命令可以切换启用和禁用文本换行？这将避免我退出并更改设置。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-10-29T19:49:24.760

我想你想要的是：

```
:set wrap! 
```

这将切换换行。

更多关于使用！（bang）更改命令可以在以下位置找到：

```
:help :_! 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-29T19:36:57.360

在你的 vimrc 中，创建一个函数，如下所示：

```
:function ToggleWrap()
: if (&wrap == 1)
:   set nowrap
: else
:   set wrap
: endif
:endfunction 
```

然后映射一个键（比如 F9）来调用这个函数，像这样：

```
map <F9> :call ToggleWrap()<CR>
map! <F9> ^[:call ToggleWrap()<CR> 
```

每当您按 F9 时，它都会打开和关闭换行。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-29T19:34:37.940

```
:set nowrap 
```

还有一个`linebreak`选项可以控制包装文本是否在单词边界处被破坏。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-02-18T21:53:46.940

添加以下内容以使 CTRL+W 切换换行。如果您不想`w`成为它，您可以将其更改为其他键。

```
map <C-w> :set wrap!<CR> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T19:36:49.620

[quickref](http://www.vim.org/htmldoc/quickref.html)建议（不）换行

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-02-19T04:25:24.360

我碰巧喜欢 tpope 的 unimpaired 插件，它`yow`会在哪里切换换行设置。

# c++ - 如何使用 Eclipse 在 Linux 上调试 C++ 程序？

> ID：248104
> 
> 赞同：12
> 
> 时间：2008-10-29T19:29:50.587
> 
> 标签：c++, eclipse, debugging, eclipse-cdt

我不使用 Eclipse 作为 IDE，也没有兴趣这样做。但是，我确实喜欢它的源代码级调试。

有什么方法可以使用它来调试 C++ Linux 应用程序，而无需经历创建项目的仪式？（实际上，我可以像 gdb 的前端一样使用它吗？）

如果没有，我需要遵循哪些步骤来创建一个项目，我可以使用该项目来调试使用 Makefile 或其他工具（SCons、CMake 等）构建的现有 C++ 程序。我不想在 Eclipse 中“开发”；我需要做的就是调试。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-29T19:35:50.123

看看[这个问题](https://stackoverflow.com/questions/204345/how-to-setup-a-linux-c-project-in-eclipse#204353)。创建一个 C/C++ 项目，使用项目的源目录作为项目目录，选择使用外部构建器，然后将“make”更改为您想要的任何工具。

棘手的部分是让索引器正常工作并找到所有头文件。

编辑：CMake 2.6.x 支持生成 CDT 项目文件，这可能是一个更直接的解决方案。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-02-02T12:00:36.063

我不知道自问题发布以来的 4 年多来这是否发生了变化，但有一种更简单的方法可以做到这一点。我在 Eclipse Luna (4.4.2) 上。

```
> eclipse& 
```

然后

`File`> `Import`> `C/C++`> `C/C++ Executable`> `Next`> 浏览到可执行文件 > `Next`> 选择项目名称 >`Finish`

不需要其他项目设置，没有源路径（应该在目标代码中）。就像运行 gdb/insight/etc 一样。几乎值得安装 Java。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-09-11T12:39:17.930

在 Eclipse 中进行调试的配置。

在日食中，

1.  转到窗口->首选项
2.  将出现一个弹出窗口，然后选择 C/C++，单击下拉箭头，然后选择调试并单击下拉箭头。
3.  选择源查找路径，然后单击添加。
4.  单击添加后，单击路径映射，然后单击确定。
5.  指定映射路径名称，然后单击添加。
6.  在编译路径中选择 Cygwin 路径（需要安装），然后单击 ok 。
7.  在调试选项中，单击源查找路径并选择 `Path Mapping:Project source and click on apply and then ok`。

# c# - 用于检测特定打印机托盘上缺纸的 Windows API

> ID：248111
> 
> 赞同：4
> 
> 时间：2008-10-29T19:32:29.847
> 
> 标签：c#, printing

我正在寻找一种方法来确定 Windows 中给定打印机上的特定托盘是否缺纸。目前我正在使用 WMI Win32_Printer 对象来获取整个打印机的状态，如果其中一个纸盘缺纸，我会得到一个状态，告诉我整个打印机缺纸。

但我想知道一个特定的托盘是否缺纸。大量的谷歌搜索一无所获。

我正在用 c# 编写应用程序，但指向任何语言的示例都可以。

提前致谢..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T19:37:53.143

那是因为它们通常是特定于硬件的接口。如果您使用像惠普或戴尔这样的硬件供应商，那么您可能会找到一种方法来解决这个问题。但 Windows 界面似乎只允许通知打印机完全用完纸。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T14:27:58.060

我还没有这样做，但我似乎记得你可以通过 SNMP 做到这一点。

# c# - 如何从控件调用 ac# windows 应用程序？

> ID：248112
> 
> 赞同：0
> 
> 时间：2008-10-29T19:32:35.433
> 
> 标签：c#

我需要在我的 c# 控件中调用 ac# 应用程序，因为我不想将应用程序重写为控件。

我可以使用 System.Diagnostics.Process.Start 启动应用程序。

现在我如何从/通过 c# 控件调用我的应用程序中的方法，因为这是我使用 System.Diagnostics.Process.Start 调用应用程序的地方

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T19:35:09.547

最简单的方法是将应用程序从 .exe 更改为 .dll，然后像普通库一样在项目中引用该应用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T20:40:35.407

You could modify your .exe application and add a remoting interface to it, making it a server-process, and then let your "control" act as client-process and call methods on the server.

This is a hacky design and I wouldn't recommend it, but since you asked :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T20:09:37.603

由于您拥有源代码，请将其复制到新项目中或按照@Nick Berardi 的建议创建一个 DLL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T19:51:57.017

您不能调用另一个进程的“方法”，因为它在完全不同的操作系统进程中运行。您基本上必须要求流程为您执行一个方法，等待结果，然后将信息编组回您的流程。当然，您必须通过某种进程间通信技术（如 WCF、COM+ 等）公开这些方法。如果您对执行程序有这种访问权限，您也可以直接使用程序集。

如果你能帮助它，你真的不想经历那个。会麻烦很多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T22:15:19.630

无论 EXE 或 DLL 格式如何，您都可以使用 System.Reflection 进入任何程序集。

例如，要运行另一个应用程序，

```
string fileName = "MainApp.exe";
string className = "Program";
string methodName = "Main";
string[] args = {"arg1", "arg2"};

Assembly asm = Assembly.LoadFrom(fileName);
foreach (Type typ in asm.GetTypes())
{
    if (typ.Name == className) 
    {
        BindingFlags flags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Static;
        MethodInfo method = typ.GetMethod(methodName, flags);
        method.Invoke(null, new object[] { args });
    }
} 
```

要使用其他方法，请相应地更改名称。

这是基于我最初从[这个示例](http://www.codeproject.com/KB/codegen/Run-Time_Code_Generation2.aspx "运行时代码生成 II：使用 System.Reflection 调用方法")派生的实际工作代码。

不过，可能有更好的方法来编写它——[这个线程建议使用 Activator 类](http://forums.asp.net/t/1036046.aspx "使用 System.Reflection 在不同的程序集中调用方法")来获得更简洁的代码。

# c# - System.IO.IOException：无法遵循符号链接，因为它的类型已禁用

> ID：248118
> 
> 赞同：3
> 
> 时间：2008-10-29T19:35:41.247
> 
> 标签：c#

这到底是什么意思？我正在做这样的事情：

```
File.Copy(@"\\foo\bar\baz.txt", @"c:\test\baz.txt"); 
```

MSDN 没有描述这个异常，除非是笼统的，谷歌搜索只会产生错误代码表。

我已经确认源文件存在，并且我 99% 确定我有权将文件复制到目标位置。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T14:07:11.530

查看这篇文章以获取有关在 .Net 中使用符号链接的一些信息：“ [Manipulating NTFS Junction Points in .NET](http://www.codeproject.com/KB/files/JunctionPointsNet.aspx) ”。

根据这篇文章：

> “特别是 .NET 库不包含任何用于创建或查询连接点属性的功能”

但是有一种方法可以实际获取符号链接的目标，然后您就可以使用 File.Copy 了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-01T10:32:40.490

默认情况下，远程符号链接的本地评估被禁用。

您可以使用 fsutil 更改该设置，或者您可以深入研究非托管代码并自己解决链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T23:53:10.523

如果目标文件已存在，您将收到此错误。我还要确认您运行代码的帐户有权访问 UNC \foo\bar\baz.txt

# sql - 将值插入 SQL 浮点列会产生奇怪的结果

> ID：248122
> 
> 赞同：4
> 
> 时间：2008-10-29T19:36:45.347
> 
> 标签：sql, sql-server, floating-point

我正在开发一个遗留的 ASP 应用程序。我试图将一个值 (40.33) 插入 SQL Server 2000 中恰好是浮点类型的字段中。我在应用程序中可以看到的每个地方（通过一些日志记录）都将 40.33 发送到存储过程。当我在调用时对数据库运行 SQL Profiler 时，我在跟踪中看到的值为 4.033000183105469e+001

所有额外的垃圾从哪里来（183105469）？

为什么当我通过 40 或 40.25 时没有任何额外内容？

这只是使用浮动的奇怪副作用之一吗？当我写东西时，我通常使用金钱或小数或其他东西，所以对浮点数据类型不太熟悉。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-29T19:43:00.153

是的，这是使用 FLOAT 的一个奇怪但[众所周知的](http://en.wikipedia.org/wiki/Floating_point#Accuracy_problems)副作用。

在 Microsoft SQL Server 中，如果您需要带刻度的精确数字，则应使用精确的数字数据类型，例如[NUMERIC、DECIMAL](http://msdn.microsoft.com/en-us/library/ms187746(SQL.90).aspx)、[MONEY 或 SMALLMONEY 。](http://msdn.microsoft.com/en-us/library/ms179882(SQL.90).aspx)

不要使用浮点数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T19:42:45.413

我认为这可能只是一个精度问题——数字的 0.33 部分不能用二进制精确表示——这可能是你能得到的最接近的值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T19:43:59.747

问题是浮点数不是 100% 准确的。如果您需要准确的数字（特别是在处理货币价值时）......您应该使用 Decimal 类型。

# c++ - 如何尝试垃圾收集？

> ID：248134
> 
> 赞同：10
> 
> 时间：2008-10-29T19:39:58.350
> 
> 标签：c++, c, garbage-collection

我对垃圾收集的工作原理很感兴趣。我已经阅读了一些工作，如标记和清除、停止和复制、分代 GC 等......我想尝试实现其中的一些并比较它们的行为。什么是开始尝试我自己的好方法？理想情况下是 C、Java 或 Python 中的东西（尽管最后两个本身是垃圾收集的，所以似乎很难使用它们......）

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-29T19:44:45.767

我自己从来没有玩过它，但总是提到与 C/C++ 一起使用的是[Hans Boehm 的](http://www.hpl.hp.com/personal/Hans_Boehm/gc/).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T19:43:38.407

.NET 运行时和 Java 运行时现在是开源的，因此如果您想使用当前支持的编程语言，可以自行试验运行时。但是，如果您想自己执行此操作，您可能必须创建自己的运行时，它有自己的语言。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T23:32:42.390

[Parrot](http://parrotcode.org)有[多个垃圾收集器](http://docs.parrot.org/parrot/latest/html/docs/pdds/pdd09_gc.pod.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T19:43:19.700

实现自己的 JVM。没有什么花哨的，只是基本的。有很多程序/编译器/语言可以生成 JVM 代码，因此您有大量材料可供测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T19:58:57.953

玩起来很有趣，但垃圾收集是一门黑暗的艺术。不是让它工作，而是让它以最新 VM 的效率工作。

我们谈论的是多阶段和魔法，它使分配速度比 malloc 更接近堆栈分配。

整个伊甸园概念震撼人心。

您可能想阅读一些有关所使用技术的白皮书。

这是一篇似乎有很好概述的文章（仅来自快速谷歌/扫描）

[http://www.devx.com/Java/Article/21977/0/page/1](http://www.devx.com/Java/Article/21977/0/page/1)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T23:28:44.833

开发[Factor 编程语言的](http://www.factorcode.org/)[Slava Pestov](http://factor-language.blogspot.com/search?q=garbage+collection)写了许多关于他实现垃圾收集器的帖子。你可以通过这个链接找到关于它的帖子：

[http://factor-language.blogspot.com/search?q=garbage+collection](http://factor-language.blogspot.com/search?q=garbage+collection)

特别是从 2006 年 9 月 24 日星期日的帖子开始。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-03T04:47:02.723

[MMTk](http://jikesrvm.org/MMTk)包含大量高性能垃圾收集器。这包括：

*   复制收藏家
*   追踪收集器
*   引用计数收集器

它也有：

*   阻止世界收藏家
*   并发收集器

Since it is a research platform it has some advance collectors such as the [generation reference counting collector](http://cs.anu.edu.au/~Steve.Blackburn/pubs/papers/urc-oopsla-2003.pdf).

# c# - 从图像中删除周围的空白

> ID：248141
> 
> 赞同：28
> 
> 时间：2008-10-29T19:42:20.030
> 
> 标签：c#, vb.net, graphics

我有一组我们从客户那里收到的产品图片。每个产品图片都是某物的图片，并且是在白色背景下拍摄的。我想裁剪图像的所有周围部分，但只在中间留下产品。这可能吗？

例如：[ [http://www.5dnet.de/media/catalog/product/d/r/dress_shoes_5.jpg][1]](http://www.5dnet.de/media/catalog/product/d/r/dress_shoes_5.jpg][1])

我不希望删除所有白色像素，但是我确实希望裁剪图像，以便最顶部的像素行包含一个非白色像素，最左侧的垂直像素行包含一个非白色像素，底部 -大多数水平行像素包含一个非白色像素等。

C# 或 VB.net 中的代码将不胜感激。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2012-05-01T01:05:19.267

I found I had to adjust Dmitri's answer to ensure it works with images that don't actually need cropping (either horizontally, vertically or both)...

```
 public static Bitmap Crop(Bitmap bmp)
    {
        int w = bmp.Width;
        int h = bmp.Height;

        Func<int, bool> allWhiteRow = row =>
        {
            for (int i = 0; i < w; ++i)
                if (bmp.GetPixel(i, row).R != 255)
                    return false;
            return true;
        };

        Func<int, bool> allWhiteColumn = col =>
        {
            for (int i = 0; i < h; ++i)
                if (bmp.GetPixel(col, i).R != 255)
                    return false;
            return true;
        };

        int topmost = 0;
        for (int row = 0; row < h; ++row)
        {
            if (allWhiteRow(row))
                topmost = row;
            else break;
        }

        int bottommost = 0;
        for (int row = h - 1; row >= 0; --row)
        {
            if (allWhiteRow(row))
                bottommost = row;
            else break;
        }

        int leftmost = 0, rightmost = 0;
        for (int col = 0; col < w; ++col)
        {
            if (allWhiteColumn(col))
                leftmost = col;
            else
                break;
        }

        for (int col = w - 1; col >= 0; --col)
        {
            if (allWhiteColumn(col))
                rightmost = col;
            else
                break;
        }

        if (rightmost == 0) rightmost = w; // As reached left
        if (bottommost == 0) bottommost = h; // As reached top.

        int croppedWidth = rightmost - leftmost;
        int croppedHeight = bottommost - topmost;

        if (croppedWidth == 0) // No border on left or right
        {
            leftmost = 0;
            croppedWidth = w;
        }

        if (croppedHeight == 0) // No border on top or bottom
        {
            topmost = 0;
            croppedHeight = h;
        }

        try
        {
            var target = new Bitmap(croppedWidth, croppedHeight);
            using (Graphics g = Graphics.FromImage(target))
            {
                g.DrawImage(bmp,
                  new RectangleF(0, 0, croppedWidth, croppedHeight),
                  new RectangleF(leftmost, topmost, croppedWidth, croppedHeight),
                  GraphicsUnit.Pixel);
            }
            return target;
        }
        catch (Exception ex)
        {
            throw new Exception(
              string.Format("Values are topmost={0} btm={1} left={2} right={3} croppedWidth={4} croppedHeight={5}", topmost, bottommost, leftmost, rightmost, croppedWidth, croppedHeight),
              ex);
        }
    } 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-26T09:20:19.420

Here's my (rather lengthy) solution:

```
public Bitmap Crop(Bitmap bmp)
{
  int w = bmp.Width, h = bmp.Height;

  Func<int, bool> allWhiteRow = row =>
  {
    for (int i = 0; i < w; ++i)
      if (bmp.GetPixel(i, row).R != 255)
        return false;
    return true;
  };

  Func<int, bool> allWhiteColumn = col =>
  {
    for (int i = 0; i < h; ++i)
      if (bmp.GetPixel(col, i).R != 255)
        return false;
    return true;
  };

  int topmost = 0;
  for (int row = 0; row < h; ++row)
  {
    if (allWhiteRow(row))
      topmost = row;
    else break;
  }

  int bottommost = 0;
  for (int row = h - 1; row >= 0; --row)
  {
    if (allWhiteRow(row))
      bottommost = row;
    else break;
  }

  int leftmost = 0, rightmost = 0;
  for (int col = 0; col < w; ++col)
  {
    if (allWhiteColumn(col))
      leftmost = col;
    else
      break;
  }

  for (int col = w-1; col >= 0; --col)
  {
    if (allWhiteColumn(col))
      rightmost = col;
    else
      break;
  }

  int croppedWidth = rightmost - leftmost;
  int croppedHeight = bottommost - topmost;
  try
  {
    Bitmap target = new Bitmap(croppedWidth, croppedHeight);
    using (Graphics g = Graphics.FromImage(target))
    {
      g.DrawImage(bmp,
        new RectangleF(0, 0, croppedWidth, croppedHeight),
        new RectangleF(leftmost, topmost, croppedWidth, croppedHeight),
        GraphicsUnit.Pixel);
    }
    return target;
  }
  catch (Exception ex)
  {
    throw new Exception(
      string.Format("Values are topmost={0} btm={1} left={2} right={3}", topmost, bottommost, leftmost, rightmost),
      ex);
  }
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2015-04-22T00:48:11.603

I needed a solution that worked on large images (GetPixel is slow), so I wrote the extension method below. It seems to work well in my limited testing. The drawback is that "Allow Unsafe Code" has to be checked in your project.

```
public static Image AutoCrop(this Bitmap bmp)
{
    if (Image.GetPixelFormatSize(bmp.PixelFormat) != 32)
        throw new InvalidOperationException("Autocrop currently only supports 32 bits per pixel images.");

    // Initialize variables
    var cropColor = Color.White;

    var bottom = 0;
    var left = bmp.Width; // Set the left crop point to the width so that the logic below will set the left value to the first non crop color pixel it comes across.
    var right = 0;
    var top = bmp.Height; // Set the top crop point to the height so that the logic below will set the top value to the first non crop color pixel it comes across.

    var bmpData = bmp.LockBits(new Rectangle(0, 0, bmp.Width, bmp.Height), ImageLockMode.ReadOnly, bmp.PixelFormat);

    unsafe
    {
        var dataPtr = (byte*)bmpData.Scan0;

        for (var y = 0; y < bmp.Height; y++)
        {
            for (var x = 0; x < bmp.Width; x++)
            {
                var rgbPtr = dataPtr + (x * 4);

                var b = rgbPtr[0];
                var g = rgbPtr[1];
                var r = rgbPtr[2];
                var a = rgbPtr[3];

                // If any of the pixel RGBA values don't match and the crop color is not transparent, or if the crop color is transparent and the pixel A value is not transparent
                if ((cropColor.A > 0 && (b != cropColor.B || g != cropColor.G || r != cropColor.R || a != cropColor.A)) || (cropColor.A == 0 && a != 0))
                {
                    if (x < left)
                        left = x;

                    if (x >= right)
                        right = x + 1;

                    if (y < top)
                        top = y;

                    if (y >= bottom)
                        bottom = y + 1;
                }
            }

            dataPtr += bmpData.Stride;
        }
    }

    bmp.UnlockBits(bmpData);

    if (left < right && top < bottom)
        return bmp.Clone(new Rectangle(left, top, right - left, bottom - top), bmp.PixelFormat);

    return null; // Entire image should be cropped, so just return null
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-29T20:00:07.483

我自己编写了代码来完成这项工作 - 掌握基础知识并不难。

本质上，您需要扫描像素行/列以检查非白色像素并隔离产品图像的边界，然后创建仅包含该区域的新位图。

请注意，虽然该`Bitmap.GetPixel()`方法有效，但速度相对较慢。如果处理时间很重要，您需要使用`Bitmap.LockBits()`将位图锁定在内存中，然后在`unsafe { }`块内使用一些简单的指针直接访问像素。

[这篇](http://www.codeproject.com/KB/GDI-plus/csharpgraphicfilters11.aspx?fid=3488&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=76&select=1123224)关于 CodeProject 的文章提供了一些您可能会觉得有用的详细信息。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-03-15T02:21:13.227

fix remaining 1px white space at the top and left

```
 public Bitmap Crop(Bitmap bitmap)
    {
        int w = bitmap.Width;
        int h = bitmap.Height;

        Func<int, bool> IsAllWhiteRow = row =>
        {
            for (int i = 0; i < w; i++)
            {
                if (bitmap.GetPixel(i, row).R != 255)
                {
                    return false;
                }
            }
            return true;
        };

        Func<int, bool> IsAllWhiteColumn = col =>
        {
            for (int i = 0; i < h; i++)
            {
                if (bitmap.GetPixel(col, i).R != 255)
                {
                    return false;
                }
            }
            return true;
        };

        int leftMost = 0;
        for (int col = 0; col < w; col++)
        {
            if (IsAllWhiteColumn(col)) leftMost = col + 1;
            else break;
        }

        int rightMost = w - 1;
        for (int col = rightMost; col > 0; col--)
        {
            if (IsAllWhiteColumn(col)) rightMost = col - 1;
            else break;
        }

        int topMost = 0;
        for (int row = 0; row < h; row++)
        {
            if (IsAllWhiteRow(row)) topMost = row + 1;
            else break;
        }

        int bottomMost = h - 1;
        for (int row = bottomMost; row > 0; row--)
        {
            if (IsAllWhiteRow(row)) bottomMost = row - 1;
            else break;
        }

        if (rightMost == 0 && bottomMost == 0 && leftMost == w && topMost == h)
        {
            return bitmap;
        }

        int croppedWidth = rightMost - leftMost + 1;
        int croppedHeight = bottomMost - topMost + 1;

        try
        {
            Bitmap target = new Bitmap(croppedWidth, croppedHeight);
            using (Graphics g = Graphics.FromImage(target))
            {
                g.DrawImage(bitmap,
                    new RectangleF(0, 0, croppedWidth, croppedHeight),
                    new RectangleF(leftMost, topMost, croppedWidth, croppedHeight),
                    GraphicsUnit.Pixel);
            }
            return target;
        }
        catch (Exception ex)
        {
            throw new Exception(string.Format("Values are top={0} bottom={1} left={2} right={3}", topMost, bottomMost, leftMost, rightMost), ex);
        }
    } 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-29T20:05:47.380

这当然是可能的。在伪代码中：

```
topmost = 0
for row from 0 to numRows:
    if allWhiteRow(row): 
        topmost = row
    else:
        # found first non-white row from top
        break

botmost = 0
for row from numRows-1 to 0:
    if allWhiteRow(row): 
        botmost = row
    else:
        # found first non-white row from bottom
        break 
```

左右两边也是如此。

The code for `allWhiteRow` would involve looking at the pixels in that row and making sure they're all *close* to 255,255,255.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-09-25T06:47:23.340

```
public void TrimImage() {
    int threshhold = 250;

    int topOffset = 0;
    int bottomOffset = 0;
    int leftOffset = 0;
    int rightOffset = 0;
    Bitmap img = new Bitmap(@"e:\Temp\Trim_Blank_Image.png");

    bool foundColor = false;
    // Get left bounds to crop
    for (int x = 1; x < img.Width && foundColor == false; x++)
    {
        for (int y = 1; y < img.Height && foundColor == false; y++)
        {
            Color color = img.GetPixel(x, y);
            if (color.R < threshhold || color.G < threshhold || color.B < threshhold)
                foundColor = true;
        }
        leftOffset += 1;
    }

    foundColor = false;
    // Get top bounds to crop
    for (int y = 1; y < img.Height && foundColor == false; y++)
    {
        for (int x = 1; x < img.Width && foundColor == false; x++)
        {
            Color color = img.GetPixel(x, y);
            if (color.R < threshhold || color.G < threshhold || color.B < threshhold)
                foundColor = true;
        }
        topOffset += 1;
    }

    foundColor = false;
    // Get right bounds to crop
    for (int x = img.Width - 1; x >= 1 && foundColor == false; x--)
    {
        for (int y = 1; y < img.Height && foundColor == false; y++)
        {
            Color color = img.GetPixel(x, y);
            if (color.R < threshhold || color.G < threshhold || color.B < threshhold)
                foundColor = true;
        }
        rightOffset += 1;
    }

    foundColor = false;
    // Get bottom bounds to crop
    for (int y = img.Height - 1; y >= 1 && foundColor == false; y--)
    {
        for (int x = 1; x < img.Width && foundColor == false; x++)
        {
            Color color = img.GetPixel(x, y);
            if (color.R < threshhold || color.G < threshhold || color.B < threshhold)
                foundColor = true;
        }
        bottomOffset += 1;
    }

    // Create a new image set to the size of the original minus the white space
    //Bitmap newImg = new Bitmap(img.Width - leftOffset - rightOffset, img.Height - topOffset - bottomOffset);

    Bitmap croppedBitmap = new Bitmap(img);
    croppedBitmap = croppedBitmap.Clone(
                    new Rectangle(leftOffset - 3, topOffset - 3, img.Width - leftOffset - rightOffset + 6, img.Height - topOffset - bottomOffset + 6),
                    System.Drawing.Imaging.PixelFormat.DontCare);

    // Get a graphics object for the new bitmap, and draw the original bitmap onto it, offsetting it do remove the whitespace
    //Graphics g = Graphics.FromImage(croppedBitmap);
    //g.DrawImage(img, 1 - leftOffset, 1 - rightOffset);
    croppedBitmap.Save(@"e:\Temp\Trim_Blank_Image-crop.png", ImageFormat.Png);
} 
```

I have got code from other post in ms, but that has **bugs**, I have **changed something**, now it works good.

*The post from [http://msm2020-sc.blogspot.com/2013/07/c-crop-white-space-from-around-image.html](http://msm2020-sc.blogspot.com/2013/07/c-crop-white-space-from-around-image.html)*

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-30T08:38:27.860

The `pnmcrop` utility from the `netpbm` graphics utilities library does exactly that.

I suggest looking at their code, available from [http://netpbm.sourceforge.net/](http://netpbm.sourceforge.net/)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2021-12-05T19:03:29.113

I copied to a version that works with SkiaSharp.

```
using SkiaSharp;
using System;

//
// Based on the original stackoverflow post:  https://stackoverflow.com/questions/248141/remove-surrounding-whitespace-from-an-image
//
namespace BlahBlah
{

  public static class BitmapExtensions
  {
    public static SKBitmap TrimWhitespace(this SKBitmap bmp)
    {
      int w = bmp.Width;
      int h = bmp.Height;

      // get all the pixels here - this can take a while so dont want it in the loops below
      // maybe theres a more efficient way?  loading all the pixels could be greedy
      var pixels = bmp.Pixels;

      bool IsTransparent(SKColor color)
      {
        return (color.Red == 0 && color.Green == 0 && color.Blue == 0 && color.Alpha == 0) || 
          (color == SKColors.Transparent);
      }

      Func<int, bool> allWhiteRow = row =>
      {
        for (int i = 0; i < w; ++i)
        {
          var px = row * w + i;
          if (!IsTransparent(pixels[px]))
            return false;
        }
        return true;
      };

      Func<int, bool> allWhiteColumn = col =>
      {
        for (int i = 0; i < h; ++i)
        {
          var px = col * h + i;
          if (!IsTransparent(pixels[px]))
            return false;
        }
        return true;
      };

      int topmost = 0;
      for (int row = 0; row < h; ++row)
      {
        if (allWhiteRow(row))
          topmost = row;
        else break;
      }

      int bottommost = 0;
      for (int row = h - 1; row >= 0; --row)
      {
        if (allWhiteRow(row))
          bottommost = row;
        else break;
      }

      int leftmost = 0, rightmost = 0;
      for (int col = 0; col < w; ++col)
      {
        if (allWhiteColumn(col))
          leftmost = col;
        else
          break;
      }

      for (int col = w - 1; col >= 0; --col)
      {
        if (allWhiteColumn(col))
          rightmost = col;
        else
          break;
      }

      if (rightmost == 0) rightmost = w; // As reached left
      if (bottommost == 0) bottommost = h; // As reached top.

      int croppedWidth = rightmost - leftmost;
      int croppedHeight = bottommost - topmost;

      if (croppedWidth == 0) // No border on left or right
      {
        leftmost = 0;
        croppedWidth = w;
      }

      if (croppedHeight == 0) // No border on top or bottom
      {
        topmost = 0;
        croppedHeight = h;
      }

      try
      {
        var target = new SKBitmap(croppedWidth, croppedHeight);

        using var canvas = new SKCanvas(target);
        using var img = SKImage.FromBitmap(bmp);
        canvas.DrawImage(img,
          new SKRect(leftmost, topmost, rightmost, bottommost),
          new SKRect(0, 0, croppedWidth, croppedHeight));

        return target;
      }
      catch (Exception ex)
      {
        throw new Exception(
          string.Format("Values are topmost={0} btm={1} left={2} right={3} croppedWidth={4} croppedHeight={5}", topmost, bottommost, leftmost, rightmost, croppedWidth, croppedHeight),
          ex);
      }
    }

  }
} 
```

# java - 我应该捕获关闭 java.sql.Connection 时抛出的异常吗

> ID：248149
> 
> 赞同：17
> 
> 时间：2008-10-29T19:43:28.953
> 
> 标签：java, jdbc, coding-style

`Connection.close()`可能会抛出`SqlException`，但我一直认为忽略任何此类异常是安全的（而且我从未见过不忽略它们的代码）。

通常我会写：

```
 try{
    connection.close();
 }catch(Exception e) {} 
```

或者

```
 try{
    connection.close();
 }catch(Exception e) {
     logger.log(e.getMessage(), e); 
 } 
```

问题是：

1.  这是不好的做法（并且在忽略此类异常时是否有人遇到问题）。
2.  什么`Connection.close()`时候抛出任何异常。
3.  如果不好，我应该如何处理异常。

评论：

我知道丢弃异常是邪恶的，但我只提到关闭连接时抛出的异常（正如我所见，这在这种情况下相当普遍）。

有谁知道什么时候`Connection.close()`可以扔东西？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-30T02:52:32.660

实际上，您所做的是（几乎）最佳实践 :-) 这是我在 Spring 的 JdbcUtils.java 中看到的。因此，您可能想要添加另一个 Catch 块。

```
/**
 * Close the given  ResultSet and ignore any thrown exception.
 * This is useful for typical finally blocks in manual  code.
 * @param resultSet the  ResultSet to close
 * @see javax.resource.cci.ResultSet#close()
 */
private void closeResultSet(ResultSet resultSet) {
  if (resultSet != null) {
    try {
      resultSet.close();
    }
    catch (SQLException ex) {
      logger.debug("Could not close  ResultSet", ex);
    }
    catch (Throwable ex) {
      // We don't trust the  driver: It might throw RuntimeException or Error.
      logger.debug("Unexpected exception on closing  ResultSet", ex);
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-29T19:49:45.383

总的来说，我有很多天被人们扔掉这样的异常所浪费。

我建议遵循一些基本规则，但有例外：

如果您绝对确定您永远不会导致检查异常出现问题，请捕获该异常并准确注释您不需要处理它的原因。（Sleep 会抛出一个 InterruptedException，除非你真的对它感兴趣，否则它总是可以被忽略，但老实说，这是我通常忽略的唯一情况——即使那样，如果你从来没有得到它，那么记录它的成本是多少？）

如果您不确定，但您可能偶尔会得到它，请捕获并记录堆栈跟踪，以便在它导致问题时可以找到它。同样，只捕获您需要的异常。

如果您看不到任何可以抛出已检查异常的方式，请捕获它并将其作为未检查异常重新抛出。

如果您确切知道是什么导致了异常，捕获它并准确记录原因，如果您非常清楚导致它的原因，那么在这种情况下您实际上不需要堆栈跟踪（并且您可能会提到记录它的类，如果你还没有使用 log4j 什么的。

听起来你的问题属于最后一类，对于这种捕获，永远不要做你写的事情（异常 e），总是做特定的异常，以防抛出一些未经检查的异常（错误的参数，空指针， ...)

**更新：**这里的主要问题是 Checked Exceptions 不好。它们存在的唯一高度使用的语言是Java。它们在理论上很整洁，但实际上它们会导致这种捕获和隐藏的行为，而未经检查的异常是不会出现的。

很多人评论说，我说有时隐藏它们是可以的。具体来说，我能想到的一种情况是：

```
try {
    Thread.sleep(1000);
catch (InterruptedException e) {
    // I really don't care if this sleep is interrupted!
} 
```

我想我觉得这种用法没问题的主要原因是因为这种 InterruptedException 的使用首先是对检查异常模式的滥用，它传达的睡眠结果不仅仅是指示异常条件。

拥有以下内容会更有意义：

```
boolean interrupted=Thread.sleep(1000); 
```

但是当他们第一次创建 Java 时，他们为他们新的检查异常模式感到非常自豪（可以理解，它在概念上非常简洁——只是在实践中失败了）

我无法想象另一种可以接受的情况，所以也许我应该将其列为可以忽略异常的唯一情况**。**

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-30T00:32:27.387

至少，*始终* **始终** ***记录***您正在捕获但未采取行动的异常。

无声无息地捕捉到的异常是最糟糕的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-29T19:51:08.733

我个人喜欢您至少记录错误的第二个想法。因为您正在捕获异常，所以理论上可以捕获除 SQL 异常之外的其他内容。我不确定会发生什么或有多罕见（如内存不足异常等），但抑制所有错误对我来说似乎不合适。

如果您想抑制错误，我只会对您知道应该以这种方式处理的非常具体的错误进行处理。

假设情况：如果您的 sql 有一个打开的事务，并且因此关闭连接导致异常，您想抑制该错误怎么办？即使抑制 SQLExceptions 也可能有点危险。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T20:02:20.723

您必须处理异常。这不是一个坏习惯。想象一下，您在关闭数据库连接之前丢失了网络。它可能会抛出异常。

稀有吗？是的。我想这就是他们所谓的异常，这不是忽略它的理由。请记住，如果它可能失败，它就会失败。

您还应该考虑此时是否可能有一个空连接（它会导致 NullPointerException）。

```
if (connection != null) {
   try { 
      connection.close(); 
   } catch (SQLException sqle) { 
      logger.log(e.getMessage(), e); 
   }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T21:03:02.817

在理想世界中，您永远不应该对异常不做任何事情，当然，在理想世界中，您也永远不会得到异常 8-)

因此，您必须检查各种选项的影响。

仅记录：数据库操作已全部完成，除了清理资源外无事可做。如果此时发生异常，它很可能对执行的工作没有影响，因此记录错误就足够了。当然，如果在记录过程中发生错误，那么您基本上必须处理实际上并未失败的失败数据库操作。

Empty handler：数据库操作全部完成，除了清理资源，别无他法。如果此时出现异常，很可能对执行的工作没有影响，所以方法成功返回。下一次数据库访问可能会遇到同样的问题，但它应该发生在事务开始时，它会正确地失败，然后得到适当的处理。如果问题已自行解决，则不会有任何迹象表明曾经出现过任何问题。

这是一个非常典型的场景，将 close() 操作放在 finally 块中以确保发生清理，因为我们不希望任何其他故障阻止资源清理。如果没有发生错误，那么当它的操作成功完成时，你的方法不应该失败。在这种情况下，空异常处理是很正常的。

当然意见会有所不同。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T01:39:10.700

你也可以抛出一个 RuntimeException：

```
try {
    connection.close();
 } catch(Exception e) {
     throw new RuntimeException(e); 
 } 
```

您不必更改您的方法签名，并且稍后可以使用 Exception.getCause 方法来查找问题的原因。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-09T14:26:48.863

请注意，[Apache Commons DButils](http://commons.apache.org/dbutils/apidocs/org/apache/commons/dbutils/DbUtils.html)提供了一种`closeQuietly()`方法，您可以使用该方法来避免使用“冗余”捕获使代码混乱。注意我不提倡吞咽异常，但对于这种`close()`情况，我认为它通常是可以接受的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-29T20:07:59.370

根据我的经验，忽略异常绝不是一个好主意。相信我，如果您记录了异常，生产支持工程师和分析师会非常感谢您。

此外，如果您使用正确的 Logging 框架，则异常对性能的影响为零或最小。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-30T01:21:55.447

如果这是一个“永远不会发生的错误”的情况，那么我将重新抛出一个异常并希望没有人能捕捉到它。
如果这是任何其他情况，我可能会记录它

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-04-04T10:04:58.343

如果你能处理它，那么就这样做（如果它是意外的，请记录它）。如果您无法处理它，请正确重新抛出它，以便上面的一些代码可以处理它。

默默地吞下异常是为修复代码的人留下了关键信息。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-09-22T13:16:37.573

在关闭与数据库的连接时处理异常是一种更好的做法。因为，稍后在您的代码中的某个时间点，如果您尝试访问语句或结果集对象，那么它将自动引发异常。所以，最好处理异常。

# macos - openCV 不能在 Leopard 上编译

> ID：248157
> 
> 赞同：0
> 
> 时间：2008-10-29T19:45:44.313
> 
> 标签：macos, opencv, compilation, osx-leopard

在过去的几个小时里，我一直在试图弄清楚为什么`openCV`不能在 leopard 上编译。我一直在搜索参考资料，但都指向一个死掉的谷歌小组。

所以我的问题很简单：我已经阅读了 INSTALL 文件，阅读了*我*能找到的所有文档，但仍然无法找到解决方案。

编译在这里中断（这是通过 Makefile 生成的）：

> `rm -fr` `.libs/libcxcore.lax/lib_cxcore.a mkdir` `.libs/libcxcore.lax/lib_cxcore.a` `Extracting /Users/fmsf/Projects/Motion` `Tracking/Libs/opencv-1.1.0/cxcore/src/./.libs/lib_cxcore.a (cd .libs/libcxcore.lax/lib_cxcore.a` `&& ar x /Users/fmsf/Projects/Motion` `Tracking/Libs/opencv-1.1.0/cxcore/src/./.libs/lib_cxcore.a) ar: /Users/fmsf/Projects/Motion: No` `such file or directory make[2]: ***` `[libcxcore.la] Error 1 make[1]: ***` `[check-recursive] Error 1 make: ***` `[check-recursive] Error 1`

有谁知道*我*可以做些什么来建造它？我正在使用 mac os 1.5 leopard，在阅读时*我*发现 Mac OS 的完整端口仍未完成，但我真的不相信这是这个库的缺失。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T20:09:35.360

基于错误，我的建议是：

尝试在名称中没有空格的文件夹中构建它。

（“/Users/fmsf/Projects/Motion Tracking/” vs “ar: /Users/fmsf/Projects/Motion: 没有这样的文件或目录”）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T19:56:34.807

您可能正在尝试 1.1。这很新。考虑尝试 1.0。我已经在 windows 和 ubuntu 上构建了 1.0。

# dynamics-gp - Dynamics GP 中的新检查签名文件

> ID：248158
> 
> 赞同：0
> 
> 时间：2008-10-29T19:45:49.947
> 
> 标签：dynamics-gp, gpsignaturefile

如何在 Microsofts Dynamics GP 中添加新的签名文件。我已经将签名扫描到 .bmp 文件中。接下来我需要做什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T19:42:48.110

文件需要为 .bmp 格式

注意：在第一页第一步菜单选择应该是

工具>设置>采购>MICR应付账款设置>签名ID

（工具被排除在序列之外）

[http://www.mekorma.com/documents/058_Setting%20Up%20a%20Signature%20ID.pdf](http://www.mekorma.com/documents/058_Setting%20Up%20a%20Signature%20ID.pdf)

# algorithm - 回文检测效率

> ID：248161
> 
> 赞同：15
> 
> 时间：2008-10-29T19:46:35.123
> 
> 标签：algorithm, performance, palindrome

我对[Jon Limjap 的面试事故](http://dotnet.kapenilattex.com/?p=93)感到好奇，并开始寻找有效的方法来进行回文检测。我检查了[回文高尔夫](https://stackoverflow.com/questions/228518/palindrome-golf)答案，在我看来，答案中只有两种算法，反转字符串并从尾部和头部检查。

```
def palindrome_short(s):
    length = len(s)
    for i in xrange(0,length/2):
        if s[i] != s[(length-1)-i]: return False
    return True

def palindrome_reverse(s):
    return s == s[::-1] 
```

我认为这些方法都不能用于检测巨大 DNA 序列中的精确回文。我环顾四周，并没有找到任何免费文章，说明这可能是一种超有效的方法。

一个好的方法可能是以分而治之的方法并行化第一个版本，将一对 char 数组 1..n 和 length-1-n..length-1 分配给每个线程或处理器。

有什么更好的方法？

你知道任何？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T20:03:52.967

只给一个回文，你将不得不在 O(N) 中完成，是的。如您所说，您可以通过拆分字符串来提高多处理器的效率。

现在说你想做精确的 DNA 匹配。这些字符串有数千个字符长，而且非常重复。这给了我们优化的机会。

假设您将一个 1000 字符长的字符串分成 5 对 100,100。代码将如下所示：

```
isPal(w[0:100],w[-100:]) and isPal(w[101:200], w[-200:-100]) ... 
```

等等...第一次进行这些匹配时，您将不得不处理它们。但是，您可以将您所做的所有结果添加到一个哈希表映射对到布尔值：

```
isPal = {("ATTAGC", "CGATTA"): True, ("ATTGCA", "CAGTAA"): False} 
```

等等......不过，这会占用太多内存。对于 100,100 对，哈希映射将有 2*4^100 个元素。假设您只存储两个 32 位的字符串哈希作为键，您将需要 10^55 兆字节，这很荒谬。

也许如果您使用较小的字符串，问题可能会很容易解决。然后你将有一个巨大的哈希图，但至少回文对于假设 10x10 对将花费 O(1)，因此检查 1000 字符串是否是回文将需要 100 次查找而不是 500 次比较。它仍然是 O(N)，虽然......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T08:24:34.800

您的第二个功能的另一个变体。我们不需要检查正常字符串和反向字符串的正确部分是否相等。

```
def palindrome_reverse(s):
  l = len(s) / 2
  return s[:l] == s[l::-1] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T19:53:48.683

没有，除非您进行模糊匹配。这可能是他们在 DNA 中所做的（我已经用 smith-waterman 在 DNA 中进行了 EST*搜索*，但这显然比匹配回文或序列中的反向补码要困难得多）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T19:54:06.433

显然，你不会比 O(n) 渐近效率更好，因为每个字符必须至少检查一次。不过，您可以获得更好的乘法常数。

对于单线程，您可以使用汇编获得加速。您还可以通过一次检查大于一个字节的块中的数据来做得更好，但是由于对齐方面的考虑，这可能会很棘手。如果您可以一次检查大至 16 字节的块，则使用 SIMD 会做得更好。

如果你想并行化它，你可以将字符串分成 N 部分，并让处理器`i`将段`[i*n/2, (i+1)*N/2)`与段进行比较`[L-(i+1)*N/2, L-i*N/2)`。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T19:54:51.770

它们都在 O(N) 中，所以我认为这些解决方案中的任何一个都没有任何特别的效率问题。也许我不够有创意，但我看不出如何在少于 N 个步骤中比较 N 个元素，所以像 O(log N) 这样的东西绝对不可能恕我直言。

Pararellism 可能会有所帮助，但它仍然不会改变算法的 big-Oh 等级，因为它相当于在更快的机器上运行它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-20T00:34:11.857

从中心进行比较总是更有效，因为您可以在未命中的早期退出，但它允许您进行更快的最大回文搜索，无论您是在寻找最大半径还是所有非重叠回文。

唯一真正的并行化是如果您有多个独立的字符串要处理。拆分成块会为每次未命中浪费大量工作，而且未命中总是比命中多得多。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-01-28T02:33:17.813

使用 Python，短代码可以更快，因为它将负载放入更快的 VM 内部（还有整个缓存和其他类似的东西）

```
def ispalin(x):
   return all(x[a]==x[-a-1] for a in xrange(len(x)>>1)) 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2017-07-30T06:44:37.633

您可以使用哈希表来放置字符并有一个计数器变量，每次您找到不在表/映射中的元素时，其值都会增加。如果您检查并找到表中已经存在的元素，请减少计数。

```
For odd lettered string the counter should be back to 1 and for even it should hit 0.I hope this approach is right.

See below the snippet.
s->refers to string
eg: String s="abbcaddc";
Hashtable<Character,Integer> textMap= new Hashtable<Character,Integer>();
        char charA[]= s.toCharArray();
        for(int i=0;i<charA.length;i++)
        {

            if(!textMap.containsKey(charA[i]))
            {   
                textMap.put(charA[i], ++count);

            }
            else
                {
                textMap.put(charA[i],--count);

        }
        if(length%2 !=0)
        {
            if(count == 1)
            System.out.println("(odd case:PALINDROME)");
            else
                System.out.println("(odd case:not palindrome)");
        }
        else if(length%2==0)    
        {
            if(count ==0)
                System.out.println("(even case:palindrome)");
            else
                System.out.println("(even case :not palindrome)");
        } 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2018-11-29T06:55:43.960

```
public class Palindrome{
    private static boolean isPalindrome(String s){
        if(s == null)
            return false;   //unitialized String ? return false
        if(s.isEmpty())     //Empty Strings is a Palindrome 
            return true;
        //we want check characters on opposite sides of the string 
        //and stop in the middle <divide and conquer>
        int left = 0;  //left-most char    
        int right = s.length() - 1; //right-most char

        while(left < right){  //this elegantly handles odd characters string 
            if(s.charAt(left) != s.charAt(right)) //left char must equal 
                return false; //right else its not a palindrome
            left++; //converge left to right 
            right--;//converge right to left 
        }
        return true; // return true if the while doesn't exit 
    }
} 
```

虽然我们正在进行 n/2 计算，但它仍然是 O(n)，这也可以使用线程来完成，但是计算会变得混乱，最好避免它。这不会测试特殊字符并且区分大小写。我有代码可以做到这一点，但是可以修改此代码以轻松处理。

# wcf - WCF 回调和网络流量

> ID：248162
> 
> 赞同：8
> 
> 时间：2008-10-29T19:47:49.473
> 
> 标签：wcf

我喜欢尽可能使用 WCF 回调，因为对我来说它比客户端轮询服务器要好，而且它比轮询更实时。我的问题是，当我订阅 WCF 服务事件时，是否有任何类型的心跳保持客户端和服务器之间的连接处于活动状态。我开始认为没有因为当服务器消失时订阅丢失并且客户端没有抛出异常（可能是异常被 WCF 运行时吞噬）。服务器也是如此，当客户端离开并且服务器尝试调用回调并且抛出异常时。有什么想法吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-04T18:38:30.997

[此链接](http://msdn.microsoft.com/en-us/library/ms731184.aspx)中对双工合同（WCF 回调）有很好的简短描述。双工合约基本上是两个单向通道，没有隐含的消息关联。你是对的，不涉及“心跳”消息，在进行双工呼叫时只发生正常的 wsHTTP 握手流量。

[我启动了名为Fiddler2](http://www.fiddler2.com "HTTP 嗅探器")（一个不受支持的 Microsoft 工具）的 HTTP 流量嗅探器来验证会话流量。在服务调用期间和之后没有看到任何底层 HTTP“心跳”通信。我让客户端运行了一段时间。好问题，它让我挖掘了一下。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-15T20:36:22.410

我继续为订阅的客户端创建了一个重复的心跳（基本上是对他们托管的函数的调用）。

我已经运行了几个小时并且它有效，这有助于确保连接。

# c# - 将包含复选框的 DataList 绑定到字典

> ID：248166
> 
> 赞同：1
> 
> 时间：2008-10-29T19:49:41.780
> 
> 标签：c#, asp.net, .net-3.5

我有一个像这样的 DataList：

```
<asp:DataList ID="dlMyList" runat="server" RepeatColumns="5" 
        RepeatDirection="Horizontal" CellSpacing="5" >
    <ItemTemplate>
        <asp:CheckBox ID="cbMyBox" Runat="server" Text='<%# Container.DataItem%>' ToolTip=''></asp:CheckBox>
    </ItemTemplate>
</asp:DataList> 
```

我将其绑定到字典：

```
Dictionary<string, string> l_CheckboxData = GetCheckboxData();
this.dlMyList.DataSource = l_CheckboxData;
this.dlMyList.DataBind(); 
```

目前，字典中的键和值都设置为每个复选框的文本。我希望他们字典的键是文本属性，字典的值是工具提示。我该怎么办？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T19:52:10.650

您可以绑定到 DataItem 上的属性，在这种情况下，它是[KeyValuePair](http://msdn.microsoft.com/en-us/library/5tbh8a42(VS.80).aspx)，具有 Key 和 Value 属性。

```
<asp:CheckBox ID="cbMyBox" Runat="server" Text='<%# Eval("Key")%>' ToolTip='<%#Eval("Value")'></asp:CheckBox> 
```

# asp.net-mvc - 有没有完美的代码生成工具来生成 MVC Storefront？

> ID：248168
> 
> 赞同：3
> 
> 时间：2008-10-29T19:49:52.230
> 
> 标签：asp.net-mvc, code-generation, ddd-repositories

有没有人知道一个好的代码生成工具（除了 Subsonic，因为它在当前版本中不支持 IQueryable）以 Rob Conery 在 MVC Storefront 中工作的方式生成存储库和其他项目？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T01:19:38.477

Rob Conery 推出了一个 Visual Studio 插件，它使用使用 IQueryable 的存储库生成 MVC 代码，尽管我相信该模型是使用 Visual Studio 中的 Linq to SQL 类生成的，而 MVC Storefront 中并非如此。

你可以在[这里](http://blog.wekeroad.com/blog/subsonic-mvc-adding-updated-for-beta-1/)找到它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T19:02:47.863

S#arp 架构可能有点矫枉过正，但如果你还没有检查过，我会推荐。它有一个非常好的教程作为下载的一部分，以及一个有效的 Northwind 示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T20:03:07.040

[T4](http://www.olegsych.com/2008/09/t4-tutorial-creating-reusable-code-generation-templates/)能满足您的需求吗？

# visual-studio - 创建 VS .Net 2003 属性宏/变量

> ID：248172
> 
> 赞同：2
> 
> 时间：2008-10-29T19:50:31.153
> 
> 标签：visual-studio

我想为我的项目属性创建一个宏/变量，类似于`$(ConfigurationName)`,`$(OutDir)`等 - 不创建环境变量。我发现这可以在更高版本的 Visual Studio 中完成，但我没有更新我的 IDE 的选项。这可以在 .Net 2003 版本中完成（如果可以，怎么做？） - 或者是通过环境变量做到这一点的唯一方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T14:08:45.570

事实证明，除了使用环境变量之外，这在 VS .Net 2003 中无法完成。

# syntax - Lisp DO 变量语法推理

> ID：248180
> 
> 赞同：6
> 
> 时间：2008-10-29T19:52:44.083
> 
> 标签：syntax, lisp, let, do-loops

在 Peter Seibel 的*Practical Common Lisp*中，他给出了这个例子：

```
(do ((nums nil) (i 1 (1+ i)))
    ((> i 10) (nreverse nums))
  (push i nums)) 
```

我可以看到它是如何工作的，在循环中使用 nums 但不给它一个步骤形式。为什么要将 nums 放在变量定义中而不是这样做：

```
(let (nums) (do ((i 1 (+ i 1)))
         ((> i 10) (nreverse nums))
       (push i nums))) 
```

我确信有一个很好的理由，但我还不明白。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-29T20:56:21.707

因为它既方便又节省缩进。此外，累加器在概念上属于循环，那么为什么不把它放在那里呢？

# svn - 使用 Subversion 和 Apache

> ID：248181
> 
> 赞同：7
> 
> 时间：2008-10-29T19:52:45.690
> 
> 标签：svn, version-control, apache2, webdav

尽管我理解这个概念，但我以前从未使用过任何类型的源代码控制。我感到困惑（也许只是不知道）是我能获得什么好处和/或为什么要配置 Subversion 和 Apache？我是否需要使用 Apache 对其进行配置才能通过网络从其他计算机访问我的存储库？请随时提供您认为相关的任何其他详细信息？

我现在的设置是一台笔记本电脑（Windows XP Pro）和一台虚拟机（Windows XP Pro）。在我的虚拟机上，我有 Apache 2.2、MySQL 5 和 PHP 5。这个设置是我主要关心的问题，尽管我很高兴听到偏离我的场景的示例/情况。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T19:58:41.433

查看[SVNBook 条目：选择服务器配置](http://svnbook.red-bean.com/en/1.5/svn.serverconfig.choosing.html)。它讨论了访问 Subversion 服务器的不同方式的优缺点。

SVN 协议的设置和管理最简单，但可能无法跨企业防火墙工作（但 Apache 可以，通过 HTTP）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T19:59:46.813

当需要关闭端口 3690 时，它会很有用。它还允许用户使用浏览器浏览代码，这有利有弊。您不需要 Subversion 客户端即可查看代码，但 Web 浏览器会产生糟糕的存储库浏览器。

设置它并不太棘手。[我发现这个页面很有用](http://ubuntuforums.org/showthread.php?t=51753)。

但是，如果您只是在本地 VM 环境中使用它，那`svnserve`对您来说没问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-16T06:32:44.247

如果您希望在您的存储库上使用 ACL，那么通过 Apache 托管您的 SVN 存储库的优势就会发挥作用。

您可以配置基本身份验证，并在每个目录（或每个文件，如果您觉得需要）的基础上限制权限。例如，您可以将存储库配置为允许访客签出，但任何写入存储库都需要特定的有效用户。

使用 Apache 验证您的用户的结果意味着您不必在 .htpasswd 中定义您的用户。Apache 可以连接到 LDAP、大多数任何类型的 SQL 服务器，甚至可以使用 Kerberos 身份验证。

使用简单化`svnserve`可能就足够了。但是，无法应用细粒度权限，并且您将无法连接到另一个用户数据库进行身份验证。

但从你的描述来看，以上所有可能都是矫枉过正的。Apache 提供的优势在很大程度上对单个用户来说毫无用处，而且不值得麻烦。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T19:54:24.610

无需使用 Apache 设置 Subversion。我使用 Subversion 已经很多年了，而且从来没有这样做过（尽管你会这样做是有原因的，主要与身份验证基础设施有关）。由于您在 Windows 世界中，我已经看到强烈推荐使用[VisualSVN Server](http://www.visualsvn.com/server/)，并且易于设置和使用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T19:56:37.053

我认为您遇到的情况是，如果您想使用 WebDAV 协议访问您的 SVN 存储库。在这种情况下，您基本上允许 Apache 作为 SVN 本身的中介来处理文件访问（与存储库没有直接连接）。

我听说这很有效，但有几种选择。查看 SVN Book（查看 Google）作为起点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T19:58:40.263

使用 Apache，您可以通过 WebDAV 访问您的存储库，即通过标准端口上的 HTTP，因此您可以在例如可能不允许该`svnserve`端口的企业防火墙后面访问/发布您的存储库。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-29T20:14:15.553

我们在一个小团队（6 人）环境中使用 Subversion，使用 Visual SVN 存储库。最初我们没有 Apache Web 服务器，只有 IIS，但现在我们也运行 Apache，但没有令人信服的理由将 Apache 用于存储库。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-29T20:17:15.857

如果您希望与其他人**共享**您的代码， SVN*可以是一个客户端-服务器系统。*但是，如果您想*单独*处理您的代码（即使是在多台计算机上！），您根本不需要**任何**服务器！

 *****您可以在几乎所有 SVN 客户端和本地 SVN 存储库中使用 file://-protocol 构建。

您的 SVN 存储库也可以通过网络共享工作。但是，**仅**当您单独使用此方法时才应使用此方法！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T00:15:36.390

您不必使用 Apache。有一个自定义服务器 - 可以使用 svnserve.exe 代替。默认情况下它在端口 3690 上运行，但可以在设置`--port`时使用开关将其设置为不同的端口。

Greg Hewgill 给了你一个链接，它会告诉你要使用哪个版本的 Subversion 服务器，以及不同的用例。它基本上归结为`svnserve`您是否不需要与任何类型的身份验证集成。如果您需要更复杂的场景，请使用 Apache。

我有一个处理 svnserve 的商业 Windows 控制台。我的个人资料有一个链接可以查看该实用程序。如果您决定使用 Apache，我建议您使用[VisualSVN Server](http://visualsvn.com/server/)。

# c++ - 我的 C++ ActiveMQ 客户端可以发送消息，但不能接收消息

> ID：248182
> 
> 赞同：1
> 
> 时间：2008-10-29T19:52:52.617
> 
> 标签：c++, activemq, activemq-cpp

我已经编译并运行了 ActiveMQ-CPP 2.2.1 Visual Studio 2005 项目。在控制台窗口中，它显示消息正在发送，尽管它们没有被接收。我可以使用 ActiveMQ-CPP 2.0.1 发送和接收消息，但不能使用 2.2.1。我是 ActiveMQ 的新手，甚至不知道从哪里开始进行故障排除。任何想法/建议/开始的好地方都会有很大的帮助。

如果有帮助，我正在使用 ActiveMQ 5.1.0 二进制文件。

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T07:20:48.093

我建议将此发布到[用户论坛](http://activemq.apache.org/discussion-forums.html)，以获得 ActiveMQ C++ 开发人员的帮助。甚至可以[用测试用例提出 JIRA](http://activemq.apache.org/support.html)

# c# - 服务需要检测工作站是否被锁定，并且屏幕保护程序是否处于活动状态

> ID：248186
> 
> 赞同：8
> 
> 时间：2008-10-29T19:53:42.160
> 
> 标签：c#, .net

我正在开发一项服务，该服务需要检测登录到单台机器的所有用户的用户状态。具体来说，我想检查屏幕保护程序是否处于活动状态以及他们的会话是否被锁定。

此代码将在系统级服务下运行，并且没有可见的 UI，因此可能会排除几个选项（捕获 WM 消息等）。

除了普通的工作站，我希望它可以在有多个用户登录的终端服务器上工作。由于这些要求，我想知道是否需要涉及多个 Win32 API。

关于从哪里开始的任何想法？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-09T12:40:13.863

作为一项服务，您可以使用事件 OnSessionChange 来捕捉所有相关时刻。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.ServiceProcess;
using System.Diagnostics;

namespace MyCode
{
    class MyService : ServiceBase
    {
        public MyService()
        {
            this.CanHandleSessionChangeEvent = true;
        }

        protected override void OnSessionChange(SessionChangeDescription changeDescription)
        {
            switch (changeDescription.Reason)
            {
                case SessionChangeReason.SessionLogon:
                    Debug.WriteLine(changeDescription.SessionId + " logon");
                    break;
                case SessionChangeReason.SessionLogoff:
                    Debug.WriteLine(changeDescription.SessionId + " logoff");
                    break;
                case SessionChangeReason.SessionLock:
                    Debug.WriteLine(changeDescription.SessionId + " lock");
                    break;
                case SessionChangeReason.SessionUnlock:
                    Debug.WriteLine(changeDescription.SessionId + " unlock");
                    break;
            }

            base.OnSessionChange(changeDescription);
        }
    }
} 
```

我确信可以根据 changeDescription.SessionId 来识别用户。但目前我不知道如何...

编辑：这应该是一种可能性

```
 public static WindowsIdentity GetUserName(int sessionId)
    {
        foreach (Process p in Process.GetProcesses())
        {
            if(p.SessionId == sessionId) {                    
                return new WindowsIdentity(p.Handle);                          
            }                
        }
        return null;
    } 
```

MSDN 链接

*   [system.serviceprocess.servicebase.onsessionchange](http://msdn.microsoft.com/de-de/library/system.serviceprocess.servicebase.onsessionchange(VS.80).aspx)
*   [system.serviceprocess.sessionchangedescription](http://msdn.microsoft.com/de-de/library/system.serviceprocess.sessionchangedescription(VS.80).aspx)
*   [system.serviceprocess.sessionchangereason](http://msdn.microsoft.com/de-de/library/system.serviceprocess.sessionchangereason(VS.80).aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T20:01:59.197

最直接的方法是在每个用户的会话中运行一个小应用程序。此应用程序的每个实例都可以与服务的主实例进行通信。

Windows 非常努力地将登录会话分开——在服务和交互式桌面之间，以及在各个终端服务会话之间——因此访问有关用户会话的此类信息变得非常棘手，除非您的应用程序正在该会话中运行首先。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T12:15:55.810

一个更简单的解决方案是使用包装了各种 TS API 的[Cassia](http://cassia.googlecode.com/)来检查用户空闲了多长时间：

```
using Cassia;

foreach (ITerminalServicesSession session in new TerminalServicesManager().GetSessions())
{
    if ((session.CurrentTime - session.LastInputTime > TimeSpan.FromMinutes(10)) &&
        (!string.IsNullOrEmpty(session.UserName)))
    {
        Console.WriteLine("Session {0} (User {1}) is idle", session.SessionId, session.UserName);
    }
} 
```

# mysql - mysql 通过 cli 从远程服务器导入 sql

> ID：248219
> 
> 赞同：7
> 
> 时间：2008-10-29T20:05:31.123
> 
> 标签：mysql, import, command-line-interface

我知道如何通过 cli 导入 sql 文件：

```
mysql -u USER -p DBNAME < dump.sql 
```

但那是如果dump.sql 文件是本地的。我如何使用远程服务器上的文件？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-29T20:39:43.363

你没有说你对远程服务器有什么网络访问权限。

假设您对远程服务器具有 SSH 访问权限，您可以将远程 mysqldump 的结果通过管道传输到 mysql 命令。我刚刚测试了这个，它工作正常：

```
ssh remote.com "mysqldump remotedb" | mysql localdb 
```

我把用户、密码、主机之类的东西放进去，`.my.cnf`这样我就不会经常输入它们——在多用户系统上很烦人而且对安全性不利，你将密码以明文形式放入你的 bash_history ！但是，如果需要，您可以轻松地将这些`-u -p -h`东西重新添加到两端：

```
ssh remote.com "mysqldump -u remoteuser -p'remotepass' remotedb" | mysql -u localuser -p'localpass' localdb 
```

最后，您可以通过管道通过`gzip`网络压缩数据：

```
ssh remote.com "mysqldump remotedb | gzip" | gzip -d | mysql localdb 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-07-30T15:19:05.250

只是想我会添加这个，因为我的本地 VM 上的空间严重不足，但是如果远程服务器上已经存在 .sql 文件，你可以这样做；

```
ssh <ip-address> "cat /path/to/db.sql" | mysql -u <user> -p<password> <dbname> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T20:08:08.637

我会使用[wget](http://www.gnu.org/software/wget/)将其下载到文件或通过管道输入。

# com - x64 上的 COM 调用约定

> ID：248221
> 
> 赞同：7
> 
> 时间：2008-10-29T20:06:08.297
> 
> 标签：com, assembly, 64-bit, calling-convention

我试图获得关于 COM 在 x64 机器上的行为方式的明确答案。在向 x64 机器上的 COM 接口调度调用时，Windows 是否使用正常的 x64 调用约定（假设 COM 实现是 64 位）？具体来说，我动态生成我的 vtbl 条目以指向在运行时动态加载的程序集块。这个程序集需要知道如何正确地从调用它的人那里获取参数。因此，我想知道 COM 是否使用标准 x64 调用约定（几乎是 fastcall）设置对我的程序集的调用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T21:54:19.407

COM 调用约定是 STDMETHOD/STDMETHODIMP 宏（及其变体）定义的任何内容。在 IA-32 上，它`stdcall`适用于大多数人；我不知道在 x86-64 上使用什么（我只安装了 32 位 mingw 交叉编译器）。

# c# - 方法重载。你能过度使用它吗？

> ID：248222
> 
> 赞同：40
> 
> 时间：2008-10-29T20:06:34.303
> 
> 标签：c#, java, methods, overloading

定义几个使用不同过滤器返回相同形状数据的方法时，有什么更好的做法？显式方法名称或重载方法？

例如。如果我有一些产品并且我正在从数据库中提取

显式方式：

```
public List<Product> GetProduct(int productId) {    // return a List    }
public List<Product> GetProductByCategory(Category category) {    // return a List    }
public List<Product> GetProductByName(string Name ) {    // return a List    } 
```

重载方式：

```
public List<Product> GetProducts() {    // return a List of all products    }
public List<Product> GetProducts(Category category) { // return a List by Category }
public List<Product> GetProducts(string searchString ) { // return a List by search string } 
```

我意识到您可能会遇到**类似签名**的问题，但如果您传递的是对象而不是基本类型（字符串、int、char、DateTime 等），这将不是问题。**所以...重载方法**以减少您拥有的方法数量并为了清楚起见是一个好主意，**还是****每个**以不同方式过滤数据的方法都应该**具有不同的方法名称**？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-30T09:05:57.240

是的，重载很容易被过度使用。

我发现确定是否需要重载的关键是考虑受众——不是编译器，而是维护程序员，他们将在数周/数月/数年内出现并且必须了解代码是什么试图达到。

像 GetProducts() 这样的简单方法名称是清晰易懂的，但它确实留下了很多未说明的地方。

在许多情况下，如果传递给 GetProducts() 的参数命名良好，维护人员将能够计算出重载的作用——但这依赖于使用时良好的命名规则，而您无法强制执行。您可以强制执行的是他们正在调用的方法的名称。

我遵循的准则是仅在方法可互换时才重载方法——如果它们做同样的事情。这样，我不介意我的班级的消费者调用哪个版本，因为它们是等价的。

为了说明，我很乐意为 DeleteFile() 方法使用重载：

```
void DeleteFile(string filePath);
void DeleteFile(FileInfo file);
void DeleteFile(DirectoryInfo directory, string fileName); 
```

但是，对于您的示例，我将使用单独的名称：

```
public IList<Product> GetProductById(int productId) {...}
public IList<Product> GetProductByCategory(Category category) {...}
public IList<Product> GetProductByName(string Name ) {...} 
```

拥有全名可以让维护人员（很可能是我）的代码更加明确。它避免了签名冲突的问题：

```
// No collisions, even though both methods take int parameters
public IList<Employee> GetEmployeesBySupervisor(int supervisorId);
public IList<Employee> GetEmployeesByDepartment(int departmentId); 
```

还有机会为每个目的引入重载：

```
// Examples for GetEmployees

public IList<Employee> GetEmployeesBySupervisor(int supervisorId);
public IList<Employee> GetEmployeesBySupervisor(Supervisor supervisor);
public IList<Employee> GetEmployeesBySupervisor(Person supervisor);

public IList<Employee> GetEmployeesByDepartment(int departmentId);
public IList<Employee> GetEmployeesByDepartment(Department department);

// Examples for GetProduct

public IList<Product> GetProductById(int productId) {...}
public IList<Product> GetProductById(params int[] productId) {...}

public IList<Product> GetProductByCategory(Category category) {...}
public IList<Product> GetProductByCategory(IEnumerable<Category> category) {...}
public IList<Product> GetProductByCategory(params Category[] category) {...} 
```

阅读的代码比编写的要多得多——即使您在最初签入源代码控制后再也没有回到代码中，您仍然会在编写代码时阅读该行代码几十次下面的代码。

最后，除非您正在编写一次性代码，否则您需要允许其他人从其他语言调用您的代码。似乎大多数业务系统最终都停留在生产中，远远超过了它们的使用日期。可能是在 2016 年使用您的课程的代码最终是用 VB.NET、C# 6.0、F# 或尚未发明的全新的东西编写的。可能是该语言不支持重载。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-29T20:09:29.400

据我所知，你不会有更少的方法，只有更少的名字。我通常更喜欢命名的重载方法系统，但我认为只要您很好地注释和记录您的代码（无论哪种情况都应该这样做），我认为它并没有太大的区别。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-29T20:13:27.533

你能过度使用它吗？嗯，是的，这是真的。

但是，您给出的示例是何时使用方法重载的完美示例。它们都执行相同的功能，为什么仅仅因为您向它们传递不同的类型而给它们不同的名称。

主要规则是做最清晰、最容易理解的事情。不要仅仅为了巧妙或聪明而使用重载，在有意义的时候使用。其他开发人员也可能正在处理此代码。您希望让他们尽可能轻松地获取和理解代码，并能够在不实现错误的情况下实现更改。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-29T20:10:51.830

我喜欢重载我的方法，以便稍后在智能感知中我没有一百万个相同的方法。对我来说，让它重载而不是让它多次命名似乎更合乎逻辑。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-29T20:10:12.097

您可能需要一些项目范围的标准。就个人而言，我发现重载的方法更容易阅读。如果你有 IDE 支持，那就去吧。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-29T20:23:15.127

您可能会考虑的一件事是，您不能将重载方法公开为 WCF Web 服务中的操作协定。因此，如果您认为您可能需要这样做，这将是使用不同方法名称的一个论据。

不同方法名称的另一个论点是，使用智能感知可能更容易发现它们。

但是这两种选择都有利有弊——所有的设计都是权衡取舍。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-29T21:24:59.123

重载的目的是为了减轻使用您的代码的人的学习曲线......并允许您使用命名方案来告知用户该方法的作用。

如果您有十个不同的方法都返回一个员工集合，然后生成十个不同的名称，（特别是如果它们以不同的字母开头！）会使它们在用户的智能感知下拉列表中显示为多个条目，从而延长下拉，并隐藏所有返回员工集合的十个方法集与您的类中的任何其他方法之间的区别......

想想 .Net 框架已经为构造函数和索引器强制执行的内容......它们都被迫具有相同的名称，您只能通过重载它们来创建多个......

如果您超载它们，它们将全部显示为一个，它们的不同签名和评论放在一边。

如果它们执行不同或不相关的功能，则不应重载两个方法...

至于当您想按类型重载具有相同签名的两个方法时可能存在的混淆，如

```
public List<Employee> GetEmployees(int supervisorId);
public List<Employee> GetEmployees(int departmentId); // Not Allowed !! 
```

好吧，您可以创建单独的类型作为有问题的核心类型的包装器来区分签名。

```
 public struct EmployeeId 
  { 
      private int empId;
      public int EmployeeId { get { return empId; } set { empId = value; } }
      public EmployeeId(int employeId) { empId = employeeId; }
  }

  public struct DepartmentId 
  {
   // analogous content
  }

 // Now it's fine, as the parameters are defined as distinct types...
 public List<Employee> GetEmployees(EmployeeId supervisorId);
 public List<Employee> GetEmployees(DepartmentId  departmentId); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-29T22:00:50.000

简要浏览一下框架应该会让您相信，大量的重载是一种公认​​的状态。面对无数的重载，Microsoft 框架设计指南（Kwalina 和 Abrams，2006 年）的第 5.1.1 节直接解决了可用性重载的*设计。*以下是该部分的简要介绍：

*   **请**尝试使用描述性参数名称来指示较短重载使用的默认值。

*   **避免**在重载中任意改变参数名称。

*   **避免**重载成员中参数的顺序不一致。

*   **只**使最长的重载虚拟化（如果需要可扩展性）。较短的重载应该简单地调用较长的重载。

*   **不要**使用`ref`or`out`参数来重载成员。

*   **允许**`null`为可选参数传递。

*   **请**使用成员重载，而不是使用默认参数定义成员。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-29T20:09:47.933

另一种选择是使用查询对象来构建“WHERE 子句”。所以你只有一种这样的方法：

```
public List<Product> GetProducts(Query query) 
```

Query 对象包含以面向对象的方式表达的条件。GetProducts 通过“解析” Query 对象来获取查询。

[http://martinfowler.com/eaaCatalog/queryObject.html](http://martinfowler.com/eaaCatalog/queryObject.html)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-29T20:23:04.643

当方法的参数只有细微差别时，我已经看到过度使用重载。例如：

```
public List<Product> GetProduct(int productId) { // return a List  }
public List<Product> GetProduct(int productId, int ownerId ) { // return a List  }
public List<Product> GetProduct(int productId, int vendorId, boolean printInvoice) { // return a List  } 
```

在我的小例子中，很快就不清楚第二个`int`参数应该是所有者还是客户 ID。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-29T20:18:57.883

是的，你可以过度使用它，但是这里有另一个概念可以帮助控制它的使用......

如果您使用的是 .Net 3.5+ 并且需要应用多个过滤器，您可能最好使用 IQueryable 和链接，即

```
GetQuery<Type>().ApplyCategoryFilter(category).ApplyProductNameFilter(productName); 
```

这样，您就可以在任何需要的地方反复重用过滤逻辑。

```
public static IQueryable<T> ApplyXYZFilter(this IQueryable<T> query, string filter)
{
     return query.Where(XYZ => XYZ == filter);
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-29T21:49:57.480

您可以根据需要尽可能多地使用重载。同样从最佳实践的角度来看，如果您尝试对数据执行相同的“操作”（整体上），建议您使用重载。例如 getProduct()

此外，如果您看到 Java API，重载无处不在。你不会找到比这更大的认可。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-29T22:33:40.653

重载是理想的多态行为。它可以帮助人类程序员记住方法名称。如果显式与类型参数是多余的，那就不好了。如果类型参数不暗示方法正在做什么，那么显式开始有意义。

在您的示例中， getProductByName 是明确可能有意义的唯一情况，因为您可能希望通过其他字符串获取产品。这个问题是由原始类型的歧义引起的；getProduct(Name n) 在某些情况下可能是更好的重载解决方案。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-30T13:33:03.130

是的，你可以过度使用它。在您的示例中，似乎第一个和第三个可能会返回一个项目，而第二个会返回几个。如果这是正确的，那么我会调用第一个和第三个 GetProduct 和第二个 GetProducts 或 GetProductList

如果不是这种情况并且所有三个都返回几个（如果您将它传递给 productID 5，它会返回 productid 中包含 5 的任何项目，或者返回名称中包含字符串参数的任何项目），那么我将调用所有三个 GetProducts或 GetProductList 并覆盖所有这些。

无论如何，名称应该反映函数的作用，因此当它返回产品列表时调用它 GetProduct（单数）并不是一个好的函数名称。明示

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-14T07:42:27.220

我是“显式”方式的忠实拥护者：给每个函数一个不同的名称。我什至将一些`Add(...)`过去有很多功能的代码重构为`AddRecord(const Record&)`、`AddCell(const Cell&)`等。

我认为这有助于避免一些混淆、无意的强制转换（至少在 C++ 中）和编译器警告，并且提高了清晰度。

也许在某些情况下，您需要其他策略。我还没有遇到过。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-05-17T11:47:00.967

怎么样

```
public IList<Product> GetProducts() { /* Return all. */}

public IList<Product> GetProductBy(int productId) {...}
public IList<Product> GetProductBy(Category category) {...}
public IList<Product> GetProductBy(string Name ) {...} 
```

等等？

# visual-studio - CodeRush Xpress 颜色

> ID：248224
> 
> 赞同：3
> 
> 时间：2008-10-29T20:07:12.477
> 
> 标签：visual-studio, color-scheme, visual-studio-addins, coderush, coderush-xpress

我下载了免费的 CodeRush Xpress 版本来试用它。有没有办法改变它用于突出显示和画线的颜色？即匹配的大括号。我有一个深色的配色方案，我有 VS 的显示器一定很糟糕，因为我看不到线条。然而在液晶显示器上我可以。有没有办法改变颜色？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-14T11:34:13.740

我使用*CodeRush Xpress 9.2*。*可以在CodeRush Xpress*的选项菜单中配置一些用于突出显示的颜色。*您可以在Visual Studio中的**DevExpress* -> *Options*下找到菜单。转到*Editor项的**Painting*子项以控制使用的一些颜色（其中包括*Navigation Fields*、*Navigation Links*和*Text fields*）。

 ***如果您的*Visual Studio*安装中没有出现*DevExpress*菜单，只需按下即可直接转到 DevExpress 选项。或者，如果您永久需要*Visual Studio中的**DevExpress*菜单项，请设置以下注册表项并重新启动它：*`Alt+Ctrl+Shift+O`*

 ***```
[HKEY_LOCAL_MACHINE\SOFTWARE\Developer Express\CodeRush for VS\9.2]
    "HideMenu"=dword:00000000 
```

这至少适用于*Visual Studio 2005*和*2008*。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-16T18:34:05.653

刚在网上找到这个……你可以用这个组合键打开他们的控制菜单：ctrl+alt+shift+o

我正在使用 VS 2008 进行记录和 CodeRush xpress 9.2。我在任何地方都没有在 Visual Studio 中看到菜单，也没有找到该注册表设置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-26T20:58:46.940

如果您使用的是 64 位机器，则路径会有所不同：

`HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Developer Express\CodeRush for VS`

# xml - 在文本（XML）文件中查找重复部分的工具？

> ID：248227
> 
> 赞同：0
> 
> 时间：2008-10-29T20:08:03.007
> 
> 标签：xml, text, find, duplicates

我有一个 XML 文件，我想查找具有重复 CDATA 的节点。是否有任何工具可以帮助我做到这一点？

我可以使用通常用于文本文档的工具。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T16:33:24.900

这是第一次尝试，用 Python 编写，只使用标准库。您可以通过多种方式改进它（修剪前导和结束空格，计算文本的哈希以减少内存需求，更好地显示元素及其行号等）：

```
import xml.etree.ElementTree as ElementTree
import sys

def print_elem(element):
    return "<%s>" % element.tag

if len(sys.argv) != 2:
    print >> sys.stderr, "Usage: %s filename" % sys.argv[0]
    sys.exit(1)
filename = sys.argv[1]    
tree = ElementTree.parse(filename)
root = tree.getroot()
chunks = {}
iter = root.findall('.//*')
for element in iter:
    if element.text in chunks:
        chunks[element.text].append(element)
    else:
        chunks[element.text] = [element,]
for text in chunks:
    if len(chunks[text]) > 1:
        print "\"%s\" is a duplicate: found in %s" % \
              (text, map(print_elem, chunks[text])) 
```

如果你给它这个 XML 文件：

```
<foo>
<bar>Hop</bar><quiz>Gaw</quiz>
<sub>
<und>Hop</und>
</sub> 
```

它将输出：

```
"Hop" is a duplicate: found in ['<bar>', '<und>'] 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-23T15:50:55.627

不容易。我的第一个想法是 XSLT，但它很难实现。您必须遍历每个节点，然后在每个具有相同数据的节点上进行 XPATH 选择。这会找到它们，但您最终也会在以后处理所有具有相同数据的节点（即，无法跟踪您已经处理过哪些节点数据并忽略它）。您可以使用真正的编程语言来做到这一点，但这超出了我的经验。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T15:53:22.780

您可以编写一个简单的 C# 应用程序，该应用程序使用 Linq 将所有节点作为单独的实体读取两次，然后找到所有相等的值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T21:18:43.863

never heard about anything like that, but it might be an intresting task to write such a program based on a [dictionary coder](http://en.wikipedia.org/wiki/Dictionary_coder) as used in archivers.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-07-21T19:38:41.410

[一个非常相似的问题](https://stackoverflow.com/q/1800634/562978)（*在此问题之后一年提出*）有一些答案，其中包含用于区分同一文件中的块的非常好的工具，包括[Atomiq](https://stackoverflow.com/a/3006324/562978)。

# ruby - Ruby 对 XML 命名空间的支持

> ID：248232
> 
> 赞同：7
> 
> 时间：2008-10-29T20:08:59.963
> 
> 标签：ruby, xml, namespaces

我在一家小公司工作，我们的生产系统使用手动 RESTful API，用 Java 和 JAXB 实现。我们现在发现我们正在接受使用 Ruby on Rails 的客户，我必须提出一个参考实现来向客户展示如何在 Ruby 中使用我们的 API。我希望能够告诉他们使用 ActiveResource，但我们的 API 所需的 XML 使用（并且绝对需要）命名空间。不幸的是，我们已经有许多其他客户已经集成了这个 API，所以删除命名空间的使用是不可能的。在 Ruby 中使用命名空间生成 XML 的最佳方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-29T20:13:36.193

“最佳”显然取决于您的需求。

在 ruby​​ 中生成任何 XML的*最快方法是使用*[libxml-ruby](http://libxml.rubyforge.org/) -[链接到 rdoc](http://libxml.rubyforge.org/rdoc/)。如果您的服务器有任何类型的负载，这将是要走的路。

在 ruby​​ 中生成任何 XML 的最简单方法是使用REXML *，*[因为](http://www.germane-software.com/software/rexml/doc/)它是标准库的一部分，因此它“可以正常工作”。如果您的 XML 生成几乎从未被使用过，那么使用 rexml 可能更容易。

两者都支持 XML 命名空间 - 检查 rdocs 以了解如何设置和获取命名空间

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-09T20:54:03.413

我发现自己的情况与您的情况几乎相同（使用带有名称空间的 JAXB 完成的 RESTful API）。

我认为在 Ruby 中使用 XML 最有前途的项目是 HappyMapper。它是一种 XML 绑定库（类似于早期的 JAXB 类型的实现）。它最近获得了很大的关注，我们中的一些人一直致力于提供良好的命名空间支持。

该项目驻留在此处： [http ://happymapper.rubyforge.org/](http://happymapper.rubyforge.org/)

来源在这里：http: [//github.com/jnunemaker/happymapper/tree/master](http://github.com/jnunemaker/happymapper/tree/master)

该项目目前不支持从 Ruby 对象创建 XML，并且原作者表示不希望提供这种支持，但我将在我的 fork 中为此提交一些功能：http: [//github.com/jimmyz /happymapper/树/主](http://github.com/jimmyz/happymapper/tree/master)

希望这可以帮助。

——吉米·齐默尔曼

# c - 如何解决有关大文件支持的兼容性问题？

> ID：248243
> 
> 赞同：0
> 
> 时间：2008-10-29T20:12:39.767
> 
> 标签：c, large-file-support

使用 off_t 作为一个函数 (seek) 参数的库。库和应用程序的编译方式不同，一种关闭了大文件支持，另一种关闭了大文件支持。这种情况会导致奇怪的运行时错误，因为两者对 off_t 的解释不同。库如何在运行时检查应用程序的 off_t 大小？或者是否有另一种解决方案，以便至少用户得到一个有意义的错误？

编辑：该库（用 c 和 autoconf 编程）已经存在，并且一些第三方应用程序使用它。该库可以使用大文件支持进行编译（默认情况下通过 AC_SYS_LARGEFILE）。它是多平台的，不仅仅是linux。如何检测/防止已安装的应用程序会因 LFS 的变化而损坏？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T20:33:10.553

You could add an API to the library to return the sizeof(off_t) and then check it from the client. Alternatively the library could require every app to provide the API in order to successfully link:

library.c:

```
size_t lib_get_off_t_size (void)
{
    return (sizeof(off_t));
} 
```

client.c (init_function):

```
if (lib_get_off_t_size() != sizeof(off_t) {
    printf("Oh no!\n");
    exit();
} 
```

If the library has an init function then you could put the check there, but then the client would have to supply the API to get the size of its off_t, which generally isn't how libraries work.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T21:42:47.557

在 Linux 上，当在打开大文件支持的情况下编译库时，`off_t`定义为与`off64_t`. 因此，如果该库是使用大文件支持编译的库，您可以将其接口更改为始终使用`off64_t`而不是`off_t`（这可能需要`_LARGEFILE64_SOURCE`）并完全避免该问题。

您还可以检查应用程序是否正在使用大文件支持进行编译（通过查看是否`_FILE_OFFSET_BITS`未定义或），如果编译方式错误，则`32`拒绝编译（使用）；`#error`请参阅`/usr/include/features.h`和[功能测试宏](http://www.gnu.org/software/libc/manual/html_node/Feature-Test-Macros.html#Feature-Test-Macros)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T21:07:56.083

As said before, the library will not be able to know how the application (being client to the library) is compiled, but the other way round has to work. Besides, I think you are talking about dynamic linking, since static linking certainly would not have different switches at same build time.

Similar to the already given answer by "Andrew Johnson", the library could provide a method for finding out whether it was compiled with large file support or not. Knowing that such build-time switches are mostly done with defines in C, this could be looking like this:

```
//in library:
BOOL isLargeFileSupport (void)
{
#ifdef LARGE_FILE_SUPPORT
    return TRUE;
#else
    return FALSE;
#endif
} 
```

The application then knows how to handle file sizes reported by that lib, or can refuse to work when incompatible:

```
//in application
BOOL bLibLFS = lib_isLargeFileSupport();
BOOL bAppLFS = FALSE;
#ifdef LARGE_FILE_SUPPORT
    bAppLFS = TRUE;
#endif

if (bLibLFS != bAppLFS)
    //incompatible versions, bail out
    exit(0); 
```

# sql - 是否需要 RIGHT JOIN？

> ID：248246
> 
> 赞同：14
> 
> 时间：2008-10-29T20:13:19.330
> 
> 标签：sql

是否存在任何需要 RIGHT JOIN 的查询，或者它们总是可以用 LEFT JOIN 重写？

更具体地说，你如何在没有正确连接的情况下重写这个（我隐含地猜测没有任何子查询或其他幻想）：

```
 SELECT *
FROM t1
LEFT JOIN t2 ON t1.k2 = t2.k2
RIGHT JOIN t3 ON t3.k3 = t2.k3 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-29T20:14:57.453

您始终可以重新编写它们以获得相同的结果集。但是，有时执行计划可能在显着方面（性能）不同，有时右连接让您以更有意义的方式表达查询。

让我说明性能差异。程序员倾向于考虑同时发生的 sql 语句。但是，保持一个心理模型是有用的，即复杂查询发生在一系列步骤中，其中表通常按列出的顺序连接。所以你可能会有这样的查询：

```
SELECT * /* example: don't care what's returned */
FROM LargeTable L
LEFT JOIN MediumTable M ON M.L_ID=L.ID
LEFT JOIN SmallTable S ON S.M_ID=M.ID
WHERE ... 
```

服务器通常会通过将 WHERE 子句中的任何内容应用到列出的第一个表（在本例中为大表）来开始，以减少它需要加载到内存中的内容。然后它将加入下一个表（MediumTable），然后是之后的一个（SmallTable），依此类推。

我们想要做的是使用一种策略来考虑每个连接表对结果的预期影响。通常，您希望尽可能长时间地保持结果集尽可能小。将该原则应用于上面的示例查询，我们看到它显然比它需要的要慢得多。它从较大的集合（表）开始，然后向下工作。我们想从较小的系列开始并逐步完善。这意味着首先使用 SmallTable，而这样做的方法是通过 RIGHT JOIN。

这里的另一个关键是，在连接完成之前，服务器通常不知道需要 SmallTable 中的哪些行。因此，只有 SmallTable 比 LargeTable 小得多，才重要的是，将整个 SmallTable 加载到内存中比从 LargeTable 开始的任何内容都便宜（作为一个大表，它可能具有良好的索引，并且可能在一个或三个字段上进行过滤在 where 子句中）。

还需要指出的是，在绝大多数情况下，优化器会关注这一点并以最有效的方式处理事情，而且大多数时候优化器会比你做得更好。

但是优化器并不完美。有时您需要帮助它：特别是如果您的一个或多个“表”是视图（可能是链接服务器！）或嵌套的 select 语句，例如。嵌套子查询也是一个很好的例子，您可能希望出于表达原因使用右连接：它允许您移动查询的嵌套部分，以便您可以更好地对事物进行分组。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-29T21:03:18.790

您始终只能使用左联接...

```
SELECT * FROM t1
    LEFT JOIN t2 ON t1.k2 = t2.k2
    RIGHT JOIN t3 ON t3.k3 = t2.k3 
```

相当于：

```
Select * From t3 
   Left Join (t1 Left Join t2 
                  On t2.k2 = t1.k2)
      On T2.k3 = T3.K3 
```

一般来说，我总是尝试仅使用左连接，因为左连接中左侧的表是其行全部包含在输出中的表，我喜欢将其（左侧）视为“基础" 设置我正在执行 cartesion product (join) 对...所以我喜欢在 SQL 中首先使用它...

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-29T20:20:45.413

是的！每时每刻！（不得不承认，主要是在你严格要求先调用哪个表时使用）

关于这个主题：[这里有一个很好的关于 joins 的视觉指南](https://blog.codinghorror.com/a-visual-explanation-of-sql-joins/)。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-29T20:19:17.977

这有点像询问是否需要使用大于。使用更适合手头任务的那个。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T20:14:33.663

您始终可以交换表顺序以将 RIGHT JOIN 转换为 LEFT JOIN。有时，以一种或另一种方式做会更有效率。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-29T21:06:14.887

我`LEFT JOIN`大约有 99.999% 的时间使用 s，但我的一些动态代码生成使用`RIGHT JOIN`s，这意味着连接之外的内容不需要反转。

我还想补充一点，您给出的具体示例我相信会产生交叉连接，这可能不是您的意图，甚至不是一个好的设计。

即我认为它实际上与：

```
SELECT *
FROM t1
CROSS JOIN t3
LEFT JOIN t2
    ON t1.k2 = t2.k2
    AND t3.k3 = t2.k3 
```

而且，因为它是一个交叉连接，所以优化器不能做很多事情。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-10-29T21:08:19.500

许多编程语言的许多元素并不是实现正确结果的严格要求，但它们允许 a) 更清楚地表达意图 b) 提高​​性能。示例包括数字、字符、循环、开关、类、连接、类型、过滤器等等。

# perl - 有状态的尾巴（仅显示上次执行的新行）

> ID：248254
> 
> 赞同：5
> 
> 时间：2008-10-29T20:15:37.967
> 
> 标签：perl, tail, persistent, stateful

我希望能够查看自上次查询以来向文件添加了多少行，而无需再次读取整个文件。

就像是 ：

```
ptail my_file | fgrep "[ERROR]" | wc -l 
```

最好使用简单的 Perl 解决方案，因为我无法轻松访问编译器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T20:30:59.870

[因为](http://welz.org.za/projects/since)确实做到了，尽管它是在 C 中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T20:55:10.023

可能这个 Perl 包可以帮助你：

[文件::尾::多](http://cpan.uwinnipeg.ca/module/File::Tail::Multi)

派生自 MultiTail，这个 perl 库可以很容易地使用完整的正则表达式跟踪文件的动态列表和匹配/排除行，甚至在本地维护它们的状态。

示例使用 File::Tail::Multi;

```
$tail1=File::Tail::Multi->new (  OutputPrefix => "f", 
                                 Debug => "$True", 
                                 Files => ["/var/adm/messages"]
                              );
while(1) {
    $tail1->read;
    #
    $tail1->print;
    sleep 10;
} 
```

*   `$tail1=File::Tail::Multi->new`: 创建新的 ptail 对象
*   `Files`=> 尾文件 /var/adm/messages
*   `OutputPrefix`=> 在对象属性“LineArray”中每行的开头添加文件名
*   `$tail1->read`: 从文件中读取所有行
*   `$tail1->print`：打印对象属性“LineArray”中的所有行；

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T23:50:02.340

尽管它出于其他目的消耗了这些行，但我之前已经编写了基本上这样做的代码。

您需要做的就是在尾部完成后记录每个文件的字节偏移量（使用**tell**）和 inode （使用**stat**）。下次针对文件运行时，首先再次检查 inode（使用**stat**）。如果 inode 已更改或文件小于记录的偏移量，则它是不同的文件（删除并重新创建，日志已旋转等），因此您应该从头开始显示；否则，**寻找**记录的偏移量并从那里显示它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T13:18:04.143

我实现了一个纯 Perl 版本的最小版本：

```
#! /usr/bin/perl
# Perl clone of since(1)
# http://welz.org.za/projects/since
#

use strict;
use warnings;

use Fcntl qw/ SEEK_SET O_RDWR O_CREAT /;
use NDBM_File;

my $state_file = "$ENV{HOME}/.psince";

my %states;
tie(%states, 'NDBM_File', $state_file, O_CREAT | O_RDWR, 0660)
        or die("cannot tie state to $state_file : $!");

while (my $filename = shift) {
        if (! -r $filename) {
                # Ignore
                next;
        }
        my @file_stats = stat($filename);
        my $device = $file_stats[0];
        my $inode = $file_stats[1];
        my $size = $file_stats[7];
        my $state_key = $device . "/" .$inode;
        print STDERR "state_key=$state_key\n";

        if (! open(FILE, $filename) ) {
                print STDERR "cannot open $filename : $!";
                next;
        }

        # Reverting to the last cursor position
        my $offset = $states{$state_key} || 0;
        if ($offset <= $size) {
                sysseek(FILE, $offset, SEEK_SET);
        } else {
                # file was truncated, restarting from the beginning
                $offset = 0;
        }

        # Reading until the end
        my $buffer;
        while ((my $read_count = sysread(FILE, $buffer, 4096)) > 0) {
                $offset += $read_count;
                print $buffer;
        }
        # Nothing to read
        close(FILE);
        $states{$state_key} = $offset;
}

# Sync the states
untie(%states); 
```

@Dave：这几乎就像你的算法，除了我不使用**tell**，而是一个内部维护的计数器。

# c# - 为什么我不能将 C# 方法声明为虚拟和静态？

> ID：248263
> 
> 赞同：65
> 
> 时间：2008-10-29T20:17:40.927
> 
> 标签：c#, oop

我有一个助手类，它只是一堆静态方法，并且想子类化助手类。根据子类，某些行为是唯一的，因此我想从基类调用虚拟方法，但由于所有方法都是静态的，我无法创建普通的虚拟方法（需要对象引用才能访问虚拟方法）。

有没有办法解决？我想我可以使用单例。HelperClass.Instance.HelperMethod() 并不比 HelperClass.HelperMethod() 差多少。任何可以指出一些支持虚拟静态方法的语言的人都可以加分。

**编辑：**好的，是的，我疯了。谷歌搜索结果让我觉得我不在那里。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2010-03-10T23:31:59.163

我不认为你疯了。您只想使用 .NET 目前不可能实现的功能。

如果我们谈论泛型，您对虚拟静态方法的请求将非常有意义。例如，我未来对 CLR 设计师的要求是允许我编写这样的接口：

```
public interface ISumable<T>
{
  static T Add(T left, T right);
} 
```

并像这样使用它：

```
public T Aggregate<T>(T left, T right) where T : ISumable<T>
{
  return T.Add(left, right);
} 
```

但现在不可能，所以我这样做：

```
 public static class Static<T> where T : new()
    {
      public static T Value = new T();
    }

    public interface ISumable<T>
    {
      T Add(T left, T right);
    }

    public T Aggregate<T>(T left, T right) where T : ISumable<T>, new()
    {
      return Static<T>.Value.Add(left, right);
    } 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-10-29T20:21:26.363

虚拟静态方法没有意义。如果我打电话`HelperClass.HelperMethod();`，为什么我会期望调用一些随机子类的方法？当您有 2 个子类时，解决方案真的会崩溃`HelperClass`——您会使用哪一个？

如果您想拥有可覆盖的静态类型方法，您可能应该使用：

*   如果您希望全局使用相同的子类，则为单例。
*   如果您希望应用程序的不同部分具有不同的行为，则使用带有工厂或依赖注入的传统类层次结构。

选择对您的情况更有意义的解决方案。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-29T20:46:12.117

事实上，这可以在 Delphi 中完成。一个例子：

```
type
  TForm1 = class(TForm)
    procedure FormShow(Sender: TObject);
  end;

  TTestClass = class
  public
    class procedure TestMethod(); virtual;
  end;

  TTestDerivedClass = class(TTestClass)
  public
    class procedure TestMethod(); override;
  end;

  TTestMetaClass = class of TTestClass;

var
  Form1: TForm1;

implementation

{$R *.dfm}

class procedure TTestClass.TestMethod();
begin
  Application.MessageBox('base', 'Message');
end;

class procedure TTestDerivedClass.TestMethod();
begin
  Application.MessageBox('descendant', 'Message');
end;

procedure TForm1.FormShow(Sender: TObject);
var
  sample: TTestMetaClass;
begin
  sample := TTestClass;
  sample.TestMethod;
  sample := TTestDerivedClass;
  sample.TestMethod;
end; 
```

很有趣。我不再使用 Delphi，但我记得能够使用元类功能在自定义设计器画布上非常轻松地创建不同类型的控件：控件类，例如。TButton、TTextBox 等是一个参数，我可以使用实际的元类参数调用适当的构造函数。

那种穷人的工厂模式:)

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2012-08-22T20:00:19.130

您可以通过使用常规静态方法来实现相同的效果，然后使用`new`关键字对其进行隐藏

```
public class Base 
{
    //Other stuff

    public static void DoSomething()
    {
        Console.WriteLine("Base");
    }
}

public class SomeClass : Base
{
    public new static void DoSomething()
    {
        Console.WriteLine("SomeClass");
    }
}
public class SomeOtherClass : Base
{
} 
```

然后你可以像这样调用方法

```
Base.DoSomething(); //Base
SomeClass.DoSomething(); //SomeClass
SomeOtherClass.DoSomething(); //Base 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-07-06T18:00:45.803

我来自 Delphi，这是我在 c# 中非常想念的许多功能中的一个。Delphi 将允许您创建类型化类型引用，并且您可以在需要父类类型的任何地方传递派生类的类型。这种将类型视为对象的处理具有强大的实用性。特别是允许元数据的运行时确定。我在这里可怕地混合了语法，但在 c# 中它看起来像：

```
 class Root {
       public static virtual string TestMethod() {return "Root"; }
    }
    TRootClass = class of TRoot; // Here is the typed type declaration

    class Derived : Root {
       public static overide string TestMethod(){ return "derived"; }
    }

   class Test {
        public static string Run(){
           TRootClass rc;
           rc = Root;
           Test(rc);
           rc = Derived();
           Test(rc);
        }
        public static Test(TRootClass AClass){
           string str = AClass.TestMethod();
           Console.WriteLine(str);
        }
    } 
```

> 将产生：根派生

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-29T20:21:31.560

静态方法存在于类的实例之外。它不能使用任何非静态数据。

根据实例的**类型**，虚拟方法将被重载函数“覆盖” 。

所以你在静态和虚拟之间有明显的矛盾。

这不是支持的问题，这是一个概念。

**更新：**我在这里被证明是错误的（见评论）：

> 所以我怀疑你会找到任何支持虚拟静态方法的 OOP 语言。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-30T19:45:08.807

你没疯。您所指的称为后期静态绑定；它最近被添加到 PHP 中。有一个很棒的线程来描述它 - 在这里：[你什么时候需要使用后期静态绑定？](https://stackoverflow.com/questions/87192/when-would-you-need-to-use-late-static-binding#87351)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-29T20:26:29.473

我听说德尔福支持这样的东西。似乎它是通过使类成为元类的对象实例来实现的。

我还没有看到它起作用，所以我不确定它是否起作用，或者这样做有什么意义。

PS如果我错了，请纠正我，因为它不是我的域。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-29T20:51:36.850

因为虚方法使用实例化对象的定义类型来确定执行哪个实现，（与引用变量的声明类型相反）

...当然，静态就是根本不在乎是否有该类的实例化实例...

所以这些是不相容的。

底线是，如果您想根据实例是哪个子类来更改行为，那么方法应该是基类上的虚拟方法，而不是静态方法。

但是，由于您已经拥有这些静态方法，现在需要覆盖它们，您可以通过以下方式解决您的问题：将虚拟实例方法添加到简单地委托给静态方法的基类，然后覆盖这些虚拟实例包装器方法（不是静态的）在每个派生子类中，视情况而定......

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-11-06T19:07:59.790

实际上可以通过使用关键字`new`而不是`virtual`.

这是一个例子：

```
class Car
{
    public static int TyreCount = 4;
    public virtual int GetTyreCount() { return TyreCount; }
}
class Tricar : Car
{
    public static new int TyreCount = 3;
    public override int GetTyreCount() { return TyreCount; }
}

...

Car[] cc = new Car[] { new Tricar(), new Car() };
int t0 = cc[0].GetTyreCount(); // t0 == 3
int t1 = cc[1].GetTyreCount(); // t1 == 4 
```

显然，该`TyreCount`值可以在被覆盖的`GetTyreCount`方法中设置，但这避免了重复该值。可以从类和类实例中获取值。

现在有人可以找到该功能的真正智能用法吗？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-05-30T16:44:46.590

Mart 用“新”关键字来做对了。我实际上来到这里是因为我需要这种类型的功能，而 Mart 的解决方案运行良好。事实上，我把它做得更好，并将我的基类方法抽象化，以强制程序员提供这个字段。

我的情况如下：

我有一个基类 HouseDeed。每个房屋类型都来自 HouseDeed，必须有一个价格。

这是部分基础的 HouseDeed 类：

```
public abstract class HouseDeed : Item
{
    public static int m_price = 0;
    public abstract int Price { get; }
    /* more impl here */
} 
```

现在让我们看看两种派生的房屋类型：

```
public class FieldStoneHouseDeed : HouseDeed
{
    public static new int m_price = 43800;
    public override int Price { get { return m_price; } }
    /* more impl here */
} 
```

和...

```
public class SmallTowerDeed : HouseDeed
{
    public static new int m_price = 88500;
    public override int Price { get { return m_price; } }
    /* more impl here */
} 
```

如您所见，我可以通过类型 SmallTowerDeed.m_price 和实例 new SmallTowerDeed().Price 访问房屋的价格，并且是抽象的，这种机制使程序员为每种新的派生房屋类型提供价格。

有人指出“静态虚拟”和“虚拟”在概念上是如何相互矛盾的。我不同意。在此示例中，静态方法不需要访问实例数据，因此满足以下要求：(1) 仅通过 TYPE 可获得价格，以及 (2) 提供价格。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-09-18T09:04:00.527

覆盖方法提供了从基类继承的成员的新实现。被覆盖声明覆盖的方法称为被覆盖的基方法。被覆盖的基方法必须与覆盖方法具有相同的签名。您不能覆盖非虚拟或静态方法。被覆盖的基方法必须是虚拟的、抽象的或覆盖的。

覆盖声明不能改变虚方法的可访问性。覆盖方法和虚拟方法都必须具有相同的访问级别修饰符。

您不能使用 new、static 或 virtual 修饰符来修改覆盖方法。

覆盖属性声明必须指定与继承属性完全相同的访问修饰符、类型和名称，并且被覆盖的属性必须是虚拟的、抽象的或覆盖的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-11-14T16:48:38.410

有一种方法可以强制从抽象泛型类继承“抽象静态”方法。见如下：

```
public abstract class Mother<T> where T : Mother<T>, new()
{
    public abstract void DoSomething();

    public static void Do()
    {
        (new T()).DoSomething();
    }

}

public class ChildA : Mother<ChildA>
{
    public override void DoSomething() { /* Your Code */ }
}

public class ChildB : Mother<ChildB>
{
    public override void DoSomething() { /* Your Code */ }
} 
```

示例（使用以前的母亲）：

```
public class ChildA : Mother<ChildA>
{
    public override void DoSomething() { Console.WriteLine("42"); }
}

public class ChildB : Mother<ChildB>
{
    public override void DoSomething() { Console.WriteLine("12"); }
}

public class Program
{
    static void Main()
    {
        ChildA.Do();  //42
        ChildB.Do();  //12
        Console.ReadKey();
    }
} 
```

这不是很好，因为您只能从一个抽象类继承，并且它会要求您对 new() 实现宽容。

此外，我认为根据继承类的大小，这将是昂贵的内存。如果您有内存问题，您将不得不在新的公共方法中设置每个属性/变量，这是一种具有默认值的糟糕方式。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-04-03T15:55:29.993

您可以使用新关键字

```
namespace AspDotNetStorefront
{
    // This Class is need to override StudioOnlineCommonHelper Methods in a branch
    public class StudioOnlineCommonHelper : StudioOnlineCore.StudioOnlineCommonHelper
    {
        //
        public static new void DoBusinessRulesChecks(Page page)
        {
            StudioOnlineCore.StudioOnlineCommonHelper.DoBusinessRulesChecks(page);
        }
    }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-08-04T12:02:00.697

**可以通过在派生类中使用new**关键字并在基类中抛出**NotSupportedException()**来模拟功能。

```
public class BaseClass{
    public static string GetString(){
        throw new NotSupportedException();   // This is not possible
    }
}

public class DerivedClassA : BaseClass {
    public static new string GetString(){
        return "This is derived class A";
    }
}

public class DerivedClassB : BaseClass {
    public static new string GetString(){
        return "This is derived class B";
    }
}

static public void Main(String[] args)
{
    Console.WriteLine(DerivedClassA.GetString());  // Prints "This is derived class A"
    Console.WriteLine(DerivedClassB.GetString());  // Prints "This is derived class B"
    Console.WriteLine(BaseClass.GetString());      // Throws NotSupportedException
} 
```

由于在编译时无法检测到这种情况，并且 IntelliSense 不会建议在派生类中实现此类功能，这可能是一个令人头疼的问题。

一条评论还建议使用**NotImplementedException()**。Microsoft 的文档表明不应处理这些异常，因此它们中的任何一个都应该起作用。

**NotSupportedException**和**NotImplementedException**之间的区别在[此博客](https://blog.excastle.com/2004/10/15/notimplementedexception-vs-notsupportedexception/)中进行了评论。

# deployment - 支持 SOCKS 的 Windows FTP 客户端

> ID：248271
> 
> 赞同：0
> 
> 时间：2008-10-29T20:19:47.053
> 
> 标签：deployment, proxy, ftp

有人知道支持 SOCKS 的 Windows FTP 客户端吗？

我需要它来构建部署脚本......我尝试了 Filezilla，但它的命令行支持似乎很差，我需要一些完全非交互式的东西。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-29T20:42:12.920

没关系，我刚刚发现 cURL 支持 FTP 上传。

# java - ASP.NET MVC framework port for Java EE?

> ID：248272
> 
> 赞同：8
> 
> 时间：2008-10-29T20:20:06.850
> 
> 标签：java, asp.net-mvc, jakarta-ee

So I've played some with the new, not yet final release of ASP.NET MVC framework and I find it to be very nice and elegant. However at work we are tied to Java for the time being, so I'm wondering this: is there a port of the framework out there for Java people like myself? I realize that webforms isn't going to be available unfortunately but what about the routing framework?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-29T21:06:18.973

Take your pick:

[http://en.wikipedia.org/wiki/Model-view-controller#Java](http://en.wikipedia.org/wiki/Model-view-controller#Java)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-30T00:30:29.950

看看[Spring MVC](http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html)。就像 Spring 本身一样，它非常易于使用。Spring 官方文档包含一个非常好的 Spring MVC[分步教程。](http://static.springframework.org/docs/Spring-MVC-step-by-step/)

我对 ASP.NET MVC 不是很熟悉，但应该很相似。

您实现一个`Controller`包含一个方法的`handleRequest(HttpServletRequest, HttpServletResponse)`方法，该方法返回一个`ModelAndView`对象。然后将响应分派到您的视图（可能是一个 jsp 文件），允许您将代码与实际的 JSP 文件完全分开。

我知道 ASP.NET MVC 自动通过 URL 将请求映射到控制器，并且不同的 URL 映射到不同的“操作”（我认为像 Ruby on Rails？） - Spring MVC 不会这样做（除非您更改`DispatchServlet`， 我认为）。相反，您将所有`*.htm`请求（或`*.jsp`，或`*.do`，或您想要的任何扩展名）映射到 Spring 的`DispatchServlet`，它读取`ApplicationContext`（一个 XML 文件）以确定将哪个控制器映射到您的`hello.htm`请求。

Spring MVC 还为您提供了一系列[其他控制器](http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html#mvc-controller-command)，如果您希望添加更多功能，例如创建具有多个页面/流的类似向导的表单，`SimpleFormController`您可以使用这些控制器。`AbstractWizardFormController`

我希望在工作中使用 Spring MVC 来替换一系列应用程序，这些应用程序不过是几十个 JSP 文件，没有中间层或业务层，代码在 HTML 内容旁边的 scriptlet 标记中并排存在。这是一个维护混乱。我很高兴看到 Spring MVC 会为我们做些什么来取代它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-07-27T06:03:33.080

看看 Play 框架——http: [//www.playframework.org/](http://www.playframework.org/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T20:58:58.130

查看[条纹框架](http://www.stripesframework.org)。这是一个基于请求的模型视图控制器框架，效果非常好，并且易于使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T20:30:47.110

Actually ASP .Net MVC is more a port from other succesfull framework to the .Net platfrom.

You could actually run [Rails over jRuby.](http://wiki.jruby.org/wiki/JRuby_on_Rails)

Or [I heard great thing about JBoss Seam.](http://www.jboss.com/products/seam)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T20:40:39.260

The [Oracle ADF](http://www.oracle.com/technology/products/adf/index.html) for Java EE is a fully Model-View-Controller oriented web framework. You'll also need [Oracle JDeveloper](http://www.oracle.com/technology/products/jdev/index.html) to work with it.

I don't recommend the framework however (although I adore JDeveloper for everything else Java)

# c# - 计算给定日期范围内的星期一数

> ID：248273
> 
> 赞同：25
> 
> 时间：2008-10-29T20:20:27.660
> 
> 标签：c#, datetime, date, datediff

给定日期范围，我需要知道该范围内有多少个星期一（或星期二、星期三等）。

我目前正在使用 C#。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-10-29T21:40:02.273

试试这个：

```
static int CountDays(DayOfWeek day, DateTime start, DateTime end)
{
    TimeSpan ts = end - start;                       // Total duration
    int count = (int)Math.Floor(ts.TotalDays / 7);   // Number of whole weeks
    int remainder = (int)(ts.TotalDays % 7);         // Number of remaining days
    int sinceLastDay = (int)(end.DayOfWeek - day);   // Number of days since last [day]
    if (sinceLastDay < 0) sinceLastDay += 7;         // Adjust for negative days since last [day]

    // If the days in excess of an even week are greater than or equal to the number days since the last [day], then count this one, too.
    if (remainder >= sinceLastDay) count++;          

    return count;
} 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-29T20:47:32.053

由于您使用的是 C#，如果您使用的是 C#3.0，则可以使用 LINQ。

假设您有一个 Array/List/IQueryable 等，其中包含您的日期作为 DateTime 类型：

```
DateTime[] dates = { new DateTime(2008,10,6), new DateTime(2008,10,7)}; //etc....

var mondays = dates.Where(d => d.DayOfWeek == DayOfWeek.Monday); // = {10/6/2008} 
```

添加：

不确定您是否意味着对它们进行分组并计算它们，但这里也是在 LINQ 中执行此操作的方法：

```
var datesgrouped = from d in dates
                   group d by d.DayOfWeek into grouped
                   select new { WeekDay = grouped.Key, Days = grouped };

foreach (var g in datesgrouped)
{
    Console.Write (String.Format("{0} : {1}", g.WeekDay,g.Days.Count());
} 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-29T20:50:10.800

看看计算星期几的不同算法很有趣，@Gabe Hollombe 在这个主题上指向 WP 是一个好主意（我记得大约 20 年前在 COBOL 中实现了[Zeller 的同余](http://en.wikipedia.org/wiki/Zeller%27s_congruence)），但它更像是当他们问现在几点时，递给某人一张时钟的蓝图。

在 C# 中：

```
 private int CountMondays(DateTime startDate, DateTime endDate)
    {
        int mondayCount = 0;

        for (DateTime dt = startDate; dt < endDate; dt = dt.AddDays(1.0))
        {
            if (dt.DayOfWeek == DayOfWeek.Monday)
            {
                mondayCount++;
            }
        }

        return mondayCount;
    } 
```

这当然不会评估“星期一”的结束日期，因此如果需要，请让 for 循环评估

```
dt < endDate.AddDays(1.0) 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-29T20:48:29.883

这是一些伪代码：

```
DifferenceInDays(Start, End) / 7   // Integer division discarding remainder
+ 1 if DayOfWeek(Start) <= DayImLookingFor
+ 1 if DayOfWeek(End)   >= DayImLookingFor
- 1 
```

where以天为单位返回，并`DifferenceInDays`以整数形式返回星期几。映射使用什么并不重要，只要它不断增加并与.`End - Start``DayOfWeek``DayOfWeek``DayImLookingFor`

请注意，此算法假定日期范围包含在内。如果`End`不应该是范围的一部分，则必须稍微调整算法。

翻译成 C# 留给读者作为练习。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-29T20:24:24.253

任何特定的语言和日期格式？

如果日期表示为天数，则两个值之间的差加一（天）除以 7 就是大部分答案。如果两个结束日期都是相关日期，则添加一个。

*已编辑：*将“模 7”更正为“除以 7”-谢谢。那就是整数除法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-12-06T09:02:07.740

你可以试试这个，如果你想在两个日期之间获得特定的工作日

```
public List<DateTime> GetSelectedDaysInPeriod(DateTime startDate, DateTime endDate, List<DayOfWeek> daysToCheck)
{
    var selectedDates = new List<DateTime>();

    if (startDate >= endDate)
        return selectedDates; //No days to return

    if (daysToCheck == null || daysToCheck.Count == 0)
        return selectedDates; //No days to select

    try
    {
        //Get the total number of days between the two dates
        var totalDays = (int)endDate.Subtract(startDate).TotalDays;

        //So.. we're creating a list of all dates between the two dates:
        var allDatesQry = from d in Enumerable.Range(1, totalDays)
                             select new DateTime(
                                                  startDate.AddDays(d).Year,
                                                  startDate.AddDays(d).Month,
                                                  startDate.AddDays(d).Day);

        //And extracting those weekdays we explicitly wanted to return
        var selectedDatesQry = from d in allDatesQry
                                  where daysToCheck.Contains(d.DayOfWeek)
                                  select d;

        //Copying the IEnumerable to a List
        selectedDates = selectedDatesQry.ToList();
    }
    catch (Exception ex)
    {
        //Log error
        //...

        //And re-throw
        throw;
    }
    return selectedDates;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-29T20:33:06.917

添加可能的最小数字以使第一天成为星期一。减去可能的最小数字，使最后一天成为星期一。计算天数的差异并除以 7。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-29T20:50:37.040

将日期转换为儒略日数，然后做一些数学运算。由于星期一是零 mod 7，你可以这样计算：

```
JD1=JulianDayOf(the_first_date)
JD2=JulianDayOf(the_second_date)
Round JD1 up to nearest multiple of 7
Round JD2 up to nearest multiple of 7
d = JD2-JD1
nMondays = (JD2-JD1+7)/7    # integer divide 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-08-24T14:45:39.650

我今天也有同样的需要。我从*cjm*函数开始，因为我不了解*JonB*函数，而且*Cyber​​herbalist*函数不是线性的。

我不得不纠正

```
DifferenceInDays(Start, End) / 7   // Integer division discarding remainder
+ 1 if DayOfWeek(Start) <= DayImLookingFor
+ 1 if DayOfWeek(End)   >= DayImLookingFor
- 1 
```

到

```
DifferenceInDays(Start, End) / 7   // Integer division discarding remainder
+ 1 if DayImLookingFor is between Start.Day and End.Day 
```

如果从开始日开始，我们在 endDay 之前首先遇到 dayImLookingFor，则使用返回 true 的 between 函数。

我通过计算从 startDay 到另外两天的天数来完成 between 函数：

```
private int CountDays(DateTime start, DateTime end, DayOfWeek selectedDay)
{
    if (start.Date > end.Date)
    {
        return 0;
    }
    int totalDays = (int)end.Date.Subtract(start.Date).TotalDays;
    DayOfWeek startDay = start.DayOfWeek;
    DayOfWeek endDay = end.DayOfWeek;
    ///look if endDay appears before or after the selectedDay when we start from startDay.
    int startToEnd = (int)endDay - (int)startDay;
    if (startToEnd < 0)
    {
        startToEnd += 7;
    }
    int startToSelected = (int)selectedDay - (int)startDay;
    if (startToSelected < 0)
    {
        startToSelected += 7;
    }
    bool isSelectedBetweenStartAndEnd = startToEnd >= startToSelected;
    if (isSelectedBetweenStartAndEnd)
    {
        return totalDays / 7 + 1;
    }
    else
    {
        return totalDays / 7;
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-02-23T18:01:36.940

这将返回一个整数集合，显示在一个日期范围内一周中的每一天发生了多少次

```
 int[] CountDays(DateTime firstDate, DateTime lastDate)
    {
        var totalDays = lastDate.Date.Subtract(firstDate.Date).TotalDays + 1;
        var weeks = (int)Math.Floor(totalDays / 7);

        var result = Enumerable.Repeat<int>(weeks, 7).ToArray();
        if (totalDays % 7 != 0)
        {
            int firstDayOfWeek = (int)firstDate.DayOfWeek;
            int lastDayOfWeek = (int)lastDate.DayOfWeek;
            if (lastDayOfWeek < firstDayOfWeek)
                lastDayOfWeek += 7;
            for (int dayOfWeek = firstDayOfWeek; dayOfWeek <= lastDayOfWeek; dayOfWeek++)
                result[dayOfWeek % 7]++;
        }
        return result;
    } 
```

或稍有变化，可让您执行 FirstDate.TotalDaysOfWeeks(SecondDate) 并返回 Dictionary

```
 public static Dictionary<DayOfWeek, int> TotalDaysOfWeeks(this DateTime firstDate, DateTime lastDate)
    {
        var totalDays = lastDate.Date.Subtract(firstDate.Date).TotalDays + 1;
        var weeks = (int)Math.Floor(totalDays / 7);

        var resultArray = Enumerable.Repeat<int>(weeks, 7).ToArray();
        if (totalDays % 7 != 0)
        {
            int firstDayOfWeek = (int)firstDate.DayOfWeek;
            int lastDayOfWeek = (int)lastDate.DayOfWeek;
            if (lastDayOfWeek < firstDayOfWeek)
                lastDayOfWeek += 7;
            for (int dayOfWeek = firstDayOfWeek; dayOfWeek <= lastDayOfWeek; dayOfWeek++)
                resultArray[dayOfWeek % 7]++;
        }
        var result = new Dictionary<DayOfWeek, int>();
        for (int dayOfWeek = 0; dayOfWeek < 7; dayOfWeek++)
            result[(DayOfWeek)dayOfWeek] = resultArray[dayOfWeek];
        return result;
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-07-07T05:57:16.717

修改后的代码在这里有效并由我测试

```
 private int CountDays(DayOfWeek day, DateTime startDate, DateTime endDate)
        {
            int dayCount = 0;

            for (DateTime dt = startDate; dt < endDate; dt = dt.AddDays(1.0))
            {
                if (dt.DayOfWeek == day)
                {
                    dayCount++;
                }
            }

            return dayCount;
        } 
```

例子：

```
int Days = CountDays(DayOfWeek.Friday, Convert.ToDateTime("2019-07-04"), 
             Convert.ToDateTime("2019-07-27")).ToString(); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-29T20:52:36.083

我有一个类似的报告问题。我需要两个日期之间的工作日数。我本可以循环浏览日期并数数，但我的离散数学训练不允许我这样做。这是我在 VBA 中编写的一个函数，用于获取两个日期之间的工作日数。我确定 .net 具有类似的 WeekDay 功能。

```
 1  
   2  ' WorkDays
   3  ' returns the number of working days between two dates
   4  Public Function WorkDays(ByVal dtBegin As Date, ByVal dtEnd As Date) As Long
   5  
   6     Dim dtFirstSunday As Date
   7     Dim dtLastSaturday As Date
   8     Dim lngWorkDays As Long
   9  
  10     ' get first sunday in range
  11     dtFirstSunday = dtBegin + ((8 - Weekday(dtBegin)) Mod 7)
  12  
  13     ' get last saturday in range
  14     dtLastSaturday = dtEnd - (Weekday(dtEnd) Mod 7)
  15  
  16     ' get work days between first sunday and last saturday
  17     lngWorkDays = (((dtLastSaturday - dtFirstSunday) + 1) / 7) * 5
  18  
  19     ' if first sunday is not begin date
  20     If dtFirstSunday <> dtBegin Then
  21  
  22        ' assume first sunday is after begin date
  23        ' add workdays from begin date to first sunday
  24        lngWorkDays = lngWorkDays + (7 - Weekday(dtBegin))
  25  
  26     End If
  27  
  28     ' if last saturday is not end date
  29     If dtLastSaturday <> dtEnd Then
  30  
  31        ' assume last saturday is before end date
  32        ' add workdays from last saturday to end date
  33        lngWorkDays = lngWorkDays + (Weekday(dtEnd) - 1)
  34  
  35     End If
  36  
  37     ' return working days
  38     WorkDays = lngWorkDays
  39  
  40  End Function 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-29T21:57:14.517

```
private System.Int32 CountDaysOfWeek(System.DayOfWeek dayOfWeek, System.DateTime date1, System.DateTime date2)
{
  System.DateTime EndDate;
  System.DateTime StartDate;

  if (date1 > date2)
  {
    StartDate = date2;
    EndDate = date1;
  }
  else
  {
    StartDate = date1;
    EndDate = date2;
  }

  while (StartDate.DayOfWeek != dayOfWeek)
    StartDate = StartDate.AddDays(1);

  return EndDate.Subtract(StartDate).Days / 7 + 1;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-01-26T22:04:38.940

四年后，我想我会做一个测试：

```
[TestMethod]
public void ShouldFindFridaysInTimeSpan()
{
    //reference: http://stackoverflow.com/questions/248273/count-number-of-mondays-in-a-given-date-range

    var spanOfSixtyDays = new TimeSpan(60, 0, 0, 0);
    var setOfDates = new List<DateTime>(spanOfSixtyDays.Days);
    var now = DateTime.Now;

    for(int i = 0; i < spanOfSixtyDays.Days; i++)
    {
        setOfDates.Add(now.AddDays(i));
    }

    Assert.IsTrue(setOfDates.Count == 60,
        "The expected number of days is not here.");

    var fridays = setOfDates.Where(i => i.DayOfWeek == DayOfWeek.Friday);

    Assert.IsTrue(fridays.Count() > 0,
        "The expected Friday days are not here.");
    Assert.IsTrue(fridays.First() == setOfDates.First(i => i.DayOfWeek == DayOfWeek.Friday),
        "The expected first Friday day is not here.");
    Assert.IsTrue(fridays.Last() == setOfDates.Last(i => i.DayOfWeek == DayOfWeek.Friday),
        "The expected last Friday day is not here.");
} 
```

我的使用`TimeSpan`有点矫枉过正——实际上我想`TimeSpan`直接查询。

# jquery - JQuery: how to add XML node?

> ID：248287
> 
> 赞同：3
> 
> 时间：2008-10-29T20:24:11.053
> 
> 标签：jquery, xml

Assume parentNode exists and I want to add an element "Child" to it. Following intutive code won't work:

```
$("<Child>").appendTo(parentNode); 
```

Because jQuery will create a node and append to parentNode.

So I am wondering, how do you add xml child node in jQuery?

p.s. Following ugly code will work, but it is really really ugly:

```
parentNode.appendChild(parentNode.ownerDocument.createElement("Child")); 
```

p.s.2 `$(parentNode).append('<Child >)` won't append the child node with jQuery 1.2.6 on FireFox 3\. Actually it append nothing. If use `appendTo()`, it will append a node with name CHILD (all capital).

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-07T14:22:02.823

JQuery 并不意味着处理 xml。当您使用`$("<Child/>")`JQuery 时，使用隐藏的 div innerHTML 来构建子节点，这就是大小写不同的原因。

# jquery - jQuery: how to get xml system independently?

> ID：248297
> 
> 赞同：2
> 
> 时间：2008-10-29T20:27:56.227
> 
> 标签：jquery, xml

Suppose `xmlNode` is a XML DOM node, how do you get its XML system independently?

For IE, it is `xmlNode.xml;`

For Netscape, it is `new XMLSerializer().serializeToString(xmlNode)`.

In jQuery, is there any built-in method I can leverage?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T16:50:15.940

我不知道可以使用本机 JQuery 函数，但是有一种跨浏览器的 JavaScript 方法可以从 XML DOM 节点获取 XML。查看此 Stack Overflow 问题的答案中的 xml2Str 函数： [Serialize a DOM node to XML text using JavaScript](https://stackoverflow.com/questions/43455/how-do-i-serialize-a-dom-to-xml-text-using-javascript-in-a-cross-browser-way)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T05:17:21.410

```
$(xmlNode).html(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T17:42:17.203

```
var xmlContent = $(xmlNode) 
```

如需更详细的说明，请查看 IBM 开发人员关于[AJAX with jQuery的文章](http://www.ibm.com/developerworks/library/x-ajaxjquery.html)

# c# - C# 中用于获取 CPU ID 和驱动器/卷序列号的 API

> ID：248305
> 
> 赞同：4
> 
> 时间：2008-10-29T20:31:52.897
> 
> 标签：c#, .net, winapi, wmi

我知道我可以通过查询 WMI 来获取物理驱动器的 CPU 标识符和卷序列号，但 WMI 通常会花很多时间。如果有的话，还有哪些更快的选项可用于检索此信息？是否有 Win32 API 可以做到这一点？

**编辑：**请允许我澄清一下。通过 CPU 标识符，我指的是通过查询以下 WMI 实例属性获得的相同值：

*   Win32_Processor::ProcessorId
*   Win32_LogicalDisk::VolumeSerialNumber

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T23:44:41.367

请记住，CPU 的 ID 并不总是可用的。

顺便说一句，你想完成什么？如果要为计算机实例生成唯一密钥，请查看Codeproject 的 Sowkot Osman[为计算机生成用于许可目的的唯一密钥（指纹） ；](http://www.codeproject.com/KB/cs/GenerateUniqueKey.aspx)它可以给你一些提示（也可以阅读评论）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-12T19:18:46.130

您可以查询 Windows 注册表以获取驱动器信息，但不确定 CPU。似乎您的问题已在此 SO q/a 中得到解决（演示了多种获取此信息的方法，但为了速度，也许从注册表中获取它是您最好的选择）：

[如何列出物理磁盘？](https://stackoverflow.com/questions/327718/how-to-list-physical-disks)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-16T21:48:53.017

WMI 实际上从注册表中获取了很大一部分数据。该系统在其中存储了大量有关该系统的信息，并且响应速度显然非常快。

如果您出于许可原因希望锁定到主板、CPU 和/或 HDD，请查看以下值：
HKLM\HARDWARE\DESCRIPTION\System\BIOS\BaseBoardManufacturer
HKLM\HARDWARE\DESCRIPTION\System\BIOS\BaseBoardProduct
HKLM\ HARDWARE\DESCRIPTION\System\CentralProcessor\0\Identifier
HKLM\HARDWARE\DESCRIPTION\System\CentralProcessor\0\ProcessorNameString
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\DigitalProductId
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProductId
HKLM\ SOFTWARE\Microsoft\Windows NT\CurrentVersion\BuildLabEx
HKLM\HARDWARE\DESCRIPTION\System\MultifunctionAdapter\0\DiskController\0\DiskPeripheral\0
（可能特定于使用 RAID 的板）

如果您想在没有 WMI 的情况下获取磁盘序列，请向物理驱动器设备发出 DeviceIoControl 调用。VB.NET 中的示例代码：[http ://www.dreamincode.net/code/snippet429.htm](http://www.dreamincode.net/code/snippet429.htm)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-10-29T21:16:45.597

我喜欢[GetSystemInfo](http://msdn.microsoft.com/en-us/library/ms724381(VS.85).aspx)但这不包括物理驱动器..

# tsql - How do i update a table column based on a condition?

> ID：248312
> 
> 赞同：0
> 
> 时间：2008-10-29T20:34:17.523
> 
> 标签：tsql

Two table:

```
StoreInfo:
UserId uniqueidentifier
StoreNo nvarchar
UserName nvarchar
Password nvarchar

UserInfo:
UserId uniqueidentifier
UserName nvarchar
Password nvarchar 
```

the UserId on StoreInfo is currently null. How do i update StoreInfo's UserId with UserInfo's UserId based on StoreInfo's UserName and Password is match to the UserName and Password from UserInfo.

the following is the query that i wrote which update the entire UserId in StoreInfo with the first UserId from UserInfo so i know it's wrong.

```
declare @UserName nvarchar(255)
declare @Password nvarchar(25)
declare @UserId uniqueidentifier

select @UserName = UserName, @Password = Password, @UserId = UserId
from UserInfo

select UserId, Password 
   from FranchiseInfo 
   where UserID = @UserName and Password = @Password

update FranchiseInfo
set UserI = @UserId 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T20:38:44.113

The update would look like this

```
update storeinfo
set userid = u.userid
from userinfo u 
inner join storeinfo s on (s.username = u.username and s.password = u.password)
where userid is null 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T20:38:42.100

```
UPDATE StoreInfo
 set UserId = ui.UserId
 from StoreInfo si
  inner join UserInfo ui
   on ui.UserName = si.UserName
    and ui.Password = si.Password
 where si.UserId is null 
```

This will update all rows in the table where UserId is not set. Build out the where clause if you only want to update selected rows. (I haven't tested this, so watch for typos!)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T20:38:46.890

The most efficient way is the `UPDATE ... FROM` syntax, e.g.

```
UPDATE StoreInfo
SET
    UserId = ui.UserId
FROM
    StoreInfo si
    INNER JOIN UserInfo ui ON ui.UserName = si.UserName AND ui.Password = si.Password; 
```

# apache-flex - Strange behaviour when dynamically resizing Flash / Flex embed object

> ID：248315
> 
> 赞同：0
> 
> 时间：2008-10-29T20:36:00.530
> 
> 标签：apache-flex, actionscript-3

I have a simple Flex application that is a panel with a repeater inside of it; albeit a little simplified, it is like such:

```
 <mx:Panel id="pnl">
    <mx:Repeater id="rp">
        <mx:Label text = "foo" />
    </mx:Repeater>
</mx:Panel> 

```

I am then embedding this Flex application into an HTML wrapper. I am then attempting to dynamically re size the embedded Flash object in the HTML as the Flex panel changes size (thus allowing the Flex application to consume as much of the HTML page as it needs).

I am doing this by doing the following actionscipt:

```
 pnl.addEventListener(ResizeEvent.RESIZE,function(event:Event):void {
    ExternalInterface.call("resize",event.target.height);
}); 

```

which in turn calls this javascript function:

```
 function resize(height) {
    // the embed or object that contains the flex app
    var e = document.getElementById('flex_object');
    if(e) e.height = height;
} 

```

This seems to work perfect in IE, however I get strange results in Firefox / Safari, the repeater works for *n* number of times, and then the text seems to get cut off / disappear in the repeater, see the attached image: [alt text http://img528.imageshack.us/img528/9538/rpre0.jpg](http://img528.imageshack.us/img528/9538/rpre0.jpg)

Can anyone explain why this is happening, and if there are any workarounds / ways of doing the same thing?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-30T13:48:08.740

我目前正在做同样的事情（一个 swf 会根据它当前持有的内容动态改变它的高度）。我在尝试制作多行按钮时也遇到了与您类似的问题。

我是 flex 新手，但我设法手动调用容器的 updateDisplayList() 解决了这个问题......我认为它“强制”在某处渲染......它的参数是更改的某个区域的宽度和高度发生。很抱歉不知道细节......但这对我有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-03T12:42:07.080

为什么不简单地在您的 Flash 对象的 HTML 页面上使用百分比宽度和高度？这样你就不必做任何事情来调整你的 SWF...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T02:50:31.547

这很奇怪——看起来 Firefox/Safari 正在扩展嵌入的绘制区域，但不知何故，Flash 没有收到它需要渲染新像素的消息。

您可能可以通过做一些事情来强制 Flash 自我更新来解决这个问题，但由于浏览器和嵌入之间的通信似乎很混乱，采用适合浏览器事件流的不同方法可能会不那么骇人听闻没有窃听。

例如，您可以尝试将 Flash`DIV`放在`DIV`. 这似乎不太可能行为不端。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T18:24:12.387

我的经验是，Flex 的大小调整能力……很有趣。有时他们会按照人们期望的方式工作，有时则不然。您可以尝试几件事：首先，跟踪您期望在 Flex 中获得的高度值，甚至是 ExternalInterface.call("alert",event.target.height); 这会让您确定是 JavaScript 还是 Flex 问题（但我怀疑是 Flex）。

您的问题可能与组件的缩放有关：

> 设置 [the height] 属性会导致调度 resize 事件。有关何时调度此事件的详细信息，请参阅调整大小事件。如果组件的 scaleY 属性不是 100，则组件与其内部坐标的高度将不匹配。因此，一个 100 像素高且 scaleY 为 200 的组件将在父级中占用 100 像素，但在内部会认为它是 50 像素高。

如果它是 Flex 并且没有帮助，我会尝试在 ExternalInterface 调用之前使用 callLater，这通常会让 Flex 有足够的时间来弄清楚它到底在做什么。有时需要 setTimeout，但我觉得这很尴尬。

# javascript - 在 jQuery 选择器中使用“this”

> ID：248320
> 
> 赞同：25
> 
> 时间：2008-10-29T20:37:21.323
> 
> 标签：javascript, jquery, css-selectors

我有一些看起来像这样的 HTML：

```
<ul class="faq">
    <li class="open">
        <a class="question" href="">This is my question?</a>
        <p>Of course you can, it will be awesome. </p>
    </li>
</ul> 
```

使用 CSS 我将`p`标签设置为`display:none;`. 我想在单击`p`时使用 jQuery 来显示或隐藏标签`anchor`，但是我在使用同级选择器时遇到了一些问题。

只是想让选择器工作，我试过：

```
$("a.question").click(function () {
    $(this + " ~ p").css("background-color", "red");
}); 
```

来测试一下。看起来，兄弟选择器不能真正那样使用，而且由于我对 jQuery 完全陌生，我不知道实现这一点的适当方法。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-29T20:40:21.757

尝试使用：

```
$(this).siblings('p').css() 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-29T20:40:08.260

```
$(this).next("p").css("...") 
```

如果您只想要 DOM 中的下一个非空白节点，则上面的“p”是可选的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-29T20:45:32.430

> 单击锚点时，我想使用 jQuery 显示或隐藏“p”标签

既然您提到您想在单击锚点时切换“p”标签，我会这样做：

```
 $("a.question").click(function (event) {
      $(this).siblings('p').show(); //toggle the p tags that are siblings to the clicked element
      event.preventDefault(); //stop the browser from following the link
  }); 
```

# sql-server - SQL Server 2000 的最佳存储是什么？

> ID：248327
> 
> 赞同：0
> 
> 时间：2008-10-29T20:39:17.233
> 
> 标签：sql-server, storage

我想访问 INTEL SS4000-E 存储中的我的 sql server 数据库文件。它是 NAS 存储。是否可以将其用作 sql server 2000 的存储？如果不是，最好的解决方案是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T03:45:00.150

我强烈建议不要这样做。

使用 RAID 镜像驱动器将您的数据文件本地放在服务器本身上。原因有两个：

*   SQL Server 对于除最小工作负载之外的所有工作负载都会运行得更快
*   万一到 NAS 的链接被破坏，SQL Server 将不太容易损坏。

使用 NAS 存储 SQL Server 的备份，而不是托管数据文件。我不知道你的数据库大小是多少，或者你的使用模式是什么，所以我不能告诉你必须拥有什么。对于将在生产环境中承担任何重大负载的数据库，我建议至少使用两个逻辑驱动器（一个用于数据，一个用于事务日志），每个都包含一个 RAID 1 阵列，其中包含您可以承受的最快驱动器买。如果这太过分了，请将您的数据库放在两个物理驱动器上（一个用于事务日志，一个用于数据）。如果这超出了预算，请将您的数据放在一个驱动器上，并经常备份。但是，如果您选择单驱动器或 NAS 解决方案，IMO 您相信祈祷的力量（这可能不是一件坏事，它只是'

请注意，NAS 与 SAN 不同（人们通常会在 SAN 上放置数据库文件）。NAS 通常比 SAN 连接慢得多，带宽也少得多，SAN 连接旨在实现非常高的可靠性、高速、高级管理和低延迟。NAS 更适合降低网络存储成本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T03:56:20.720

我的直觉反应 - 我认为您在 NAS 上冒着数据风险是疯了。SQL 的期望是对存储子系统的持续低延迟不间断访问。几乎可以肯定，NAS 不是这些东西——您的本地或 SAN 存储（按照性能、简单性和偏好的顺序）——将 NAS 留作离线文件存储/备份。

以下 KB 列出了尝试将 NAS 与 SQL 一起使用时遇到的一些限制和问题 - 虽然 KB 涵盖了 SQL 7 到 2005，但许多信息仍然适用于 SQL 2008。

> [http://support.microsoft.com/kb/304261](http://support.microsoft.com/kb/304261)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T20:42:46.180

本地几乎总是比网络存储快。

您的 sql 性能将取决于您的对象、文件和文件组是如何定义的，以及消费者如何使用数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T03:54:28.523

好吧，“最佳”对不同的人意味着不同的东西，但我认为“最佳”性能将是 TMS RAMSAN 或 SSD 的 RAID ......等等

使用大型 HDD 的 RAID 可以实现最佳容量...

通过跨多个驱动器进行镜像和定期备份（最好是异地备份）可以实现最佳可靠性/数据安全性......

最佳可用性...我不知道...也许克隆系统并随时准备好热备份。

最好的安全性需要加密，但主要限制对机器（及其备份）的物理访问就足够了，除非它连接了互联网。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T04:50:33.140

正如其他答案所指出的，这里会有性能损失。

还值得一提的是，这些东西有时会实现 RAM 缓存以提高 I/O 性能，如果是这种情况并且您尝试了此配置，则 NAS 应该与服务器硬件处于相同的电源保护/UPS 上，否则在在断电的情况下，NAS 可能会“丢失”缓存中的文件部分。哎哟！

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-29T20:57:42.063

它可以工作，但专用光纤连接的 SAN 会更好。

本地通常会更快，但它的大小有限并且不容易扩展。

我对硬件不熟悉，但我们最初在共享 NAS 上部署了一个仓库。这是我们发现的。

我们经常在主机上争夺资源——它只能处理这么多的带宽。海量仓库查询和数据负载受到严重影响。

我们的仓库（数据/索引/日志）需要 1.5 TB，我们将这些资源中的每一个都放在一组单独的 LUN 上（就像您可能对附加存储所做的那样）。数据仅跨越 10 个磁盘。我们遇到了各种各样的 IO 瓶颈。更好的解决方案是在许多小磁盘上创建一个大分区，并将数据、索引和日志存储在同一个地方。这大大加快了速度。

如果您正在处理一个中等使用的 OLTP 系统，您可能没问题，但 NAS 可能会很麻烦。

# perl - 在 Ksh 和 Perl 中并行执行任务的最佳方式是什么？

> ID：248332
> 
> 赞同：4
> 
> 时间：2008-10-29T20:40:13.033
> 
> 标签：perl, makefile, parallel-processing, ksh

我有一个大型 C++ 项目，我需要在没有并行 make 的平台上构建它（比如 Linux 上的 make -j）。服务器有 6 个 CPU，我想手动进行并行构建。

我可以为大约 300 个目标文件生成这样的任务列表。我使用 Makefile 进行依赖检查和增量构建：

make -f Makefile obj1.o

make -f Makefile obj2.o

make -f Makefile obj3.o ...

在使用 Ksh 和 Perl 一次运行不超过 6 个任务的情况下，我将如何并行执行这些任务？（Java 或 Python 不可用 :-( ）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T21:16:49.607

在 Perl 中，您应该查看[Parallel::ForkManager](http://search.cpan.org/perldoc?Parallel::ForkManager)。你可以这样做：

```
my @make_obj = qw(
  obj1.o
  obj2.o
  obj3.o
  ...
);

my $fm = $pm = new Parallel::ForkManager(6);
foreach my $obj (@make_obj) {
  $fm->start and next;
  system("make -f Makefile $make_obj");
  $fm->finish();
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T00:13:01.933

分叉的另一种方法是在自己的线程中运行每个 make。

```
use threads;

my $max_threads = 5;

my @targets = qw(obj1.o obj2.o obj3.o ...);
while(@targets) {
    my $num_threads = threads->list(threads::running);
    if( $num_threads < $max_threads ) {
        my $target = shift @targets;
        threads->create(sub { return system "make $target" });
    }
} 
```

不幸的是，我正在挥动两个位。首先是让循环安静地等待，直到线程完成。我相信这是使用threads::shared 的cond_wait() 和信号量变量来完成的。

第二个是从 make 获取返回值，这样你就知道是否有什么失败并停止构建。为此，您必须 join() 每个线程以获得 system() 的结果，即进程的退出代码。

很抱歉仓促回复。希望社区将填补其余部分。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T00:42:58.817

HPUX 上的 gnu make 没有 -j 标志吗？

[http://hpux.connect.org.uk/hppd/hpux/Gnu/make-3.81/](http://hpux.connect.org.uk/hppd/hpux/Gnu/make-3.81/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-11-05T21:31:45.677

使用 GNU Parallel，您可以编写：

```
parallel -j6 make -f Makefile obj{}.o ::: {1..500} 
```

10秒安装：

```
(wget -O - pi.dk/3 || curl pi.dk/3/ || fetch -o - http://pi.dk/3) | bash 
```

了解更多：[http ://www.gnu.org/software/parallel/parallel_tutorial.html](http://www.gnu.org/software/parallel/parallel_tutorial.html) [https://www.youtube.com/playlist?list=PL284C9FF2488BC6D1](https://www.youtube.com/playlist?list=PL284C9FF2488BC6D1)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-29T20:49:39.803

如果操作系统正确处理处理器间通信和调度，只要不存在相互依赖关系，您就应该能够将所有的 make 投入到后台进程中。

如果它们都是独立的，我会发出一系列这样的命令：

```
make -f Makefile obj1.o &
make -f Makefile obj2.o &
...
make -f Makefile objn.o & 
```

对于依赖项，用双与号 ( `&&`) 将它们串起来，这样依赖项在其“父项”完成之前不会启动。

我意识到这不是您要求的解决方案，但这是我解决问题的方式:)

# asp.net - 在数据库或文件中配置值？

> ID：248340
> 
> 赞同：6
> 
> 时间：2008-10-29T20:42:54.200
> 
> 标签：asp.net, configuration

我有一些 asp.net web 应用程序的配置值。一旦系统上线，它们将由系统管理员维护。我应该将这些值存储在数据库中还是配置文件中？这种事情有最佳实践吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-29T20:51:21.280

创建一个健壮的界面来编辑数据库中的值既简单又方便。

为配置文件创建一个好的文件并不容易。

因此，我通常希望将您希望用户/管理员稍后能够在数据库中编辑的所有内容存储起来。仅在重新安装等严重更改期间才需要触及的所有内容都最好在配置文件中进行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T20:53:47.703

我总是推荐数据库，因为您可以相对容易地构建管理 UI 并以类似的轻松方式审核所有更改。尽管您可以通过更改文件来完成相同的操作，但具有某种管理控制区域的数据库路由总是更可取。尤其是当你想知道谁在什么时候改变了什么。

同样在我们的环境中，如果出现错误更改配置文件，涉及整个更改管理流程的批准/等，这非常痛苦。因此，如果您花时间将配置设置合并到数据库中，我认为从长远来看它会更好。只是我的 0.02 美元。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T22:02:53.320

出于以下两个原因，我更喜欢文本配置文件、.ini 样式或 XML 样式：

1 - 您可以在文本文件中添加注释。

2 - 文本编辑器有一个“撤消”命令。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T20:46:50.633

根据配置信息的上下文，您可以选择将其保留在 web.config 中，也可以在数据库中为其创建维护表。我通常会在 web.config 中保留更多特定于后端的内容，例如连接字符串、ftp 位置、用户名/密码（用于应用程序，而不是用户权限）。

我通常会在数据库中保留更多与数据库中的信息相关的相关信息，而不是与应用程序本身相关的信息。

尽管这一切都是松散的，但并非总是如此。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T20:48:46.323

如果可以并且我不需要性能，我更愿意避免使用数据库。如果您需要/拥有一个数据库，那么我会说尽可能多地放在一个地方。一件事要管理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T13:51:07.383

我认为数据库是分布式应用程序配置值的好地方，无论他们使用哪台计算机，您都希望用户设置可供他们使用。

存储在文件中的配置值对于特定于计算机的配置非常有用（例如，如果您使用映射驱动器来识别位置，并且每个用户可能有不同的映射，例如 CD/DVD 驱动器）。

但是，如果您还没有用于您正在开发的应用程序的数据库，那么拥有一个专门用于应用程序配置的数据库可能有点过头了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-01T02:44:26.327

我更喜欢文本`.ini`文件。它们易于编辑，并且在您的应用程序移动时易于移动。这是一个您可能会发现有用的示例[`Setting`类。](https://stackoverflow.com/questions/577782/where-to-store-configuration-information/597835#597835)

# latex - 乳胶中的“虚假”领先

> ID：248341
> 
> 赞同：5
> 
> 时间：2008-10-29T20:43:14.447
> 
> 标签：latex

以下乳胶输入：

```
\rule{1cm}{1cm}\\
\rule{1cm}{1cm} 
```

在盒子之间留下约 0.35 毫米的间隙。定义这个间隙的长度是多少？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T21:07:19.220

**编辑**：起初我只是部分正确，但 GoogleBooks 知道。它向我指出了 Raymond Seroul、Silvio Levy、Silvio Vieira Ferreira Levy 撰写*的 A Beginner's Book of TeX ，其中说：*

> 三个变量控制这种行为`\baselineskip`，`\lineskip`和`\lineskiplimit`。

行的默认分隔是`\baselineskip`，但不允许框比`\lineskiplimit`. 如果他们愿意，则调整垂直间距，直到`\lineskip`它们之间存在空间......

# .net - Winform 在 RichTextBox 控件中创建表格

> ID：248342
> 
> 赞同：3
> 
> 时间：2008-10-29T20:43:15.587
> 
> 标签：.net, winforms, richtextbox

我需要在 Windows 窗体应用程序中使用 RichTextBox 控件创建一个简单的编辑器，该应用程序包括创建表格的能力。

是否可以在 RichTextBox 控件中创建表格？

如果是这样，任何有关执行此操作的最佳方法的指针将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T20:56:42.813

winforms RichTextbox 控件利用 RTF 作为它的丰富格式语言。由于此类表格是控件的固有部分，因此您只需了解足够的 RTF 即可对表格进行编码。

这是[1.9.1 规范](http://www.microsoft.com/downloads/details.aspx?FamilyId=DD422B8D-FF06-4207-B476-6B5396A18A2B&displaylang=en)。享受。

[维基百科](http://en.wikipedia.org/wiki/Rich_Text_Format#External_links)上列出了所有规格

# language-agnostic - 程序的功能体

> ID：248349
> 
> 赞同：2
> 
> 时间：2008-10-29T20:46:18.687
> 
> 标签：language-agnostic

什么是程序的“功能体”？

我以为是它的函数原型，是吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T20:49:26.027

它是实际执行的代码，所以这将是您方法中的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T23:38:36.233

不幸的是，许多程序没有功能部分。

说真的，你想多了。这并不意味着什么。实际生成机器代码的是人类代码。机器会发现我们所有的评论都毫无用处且不起作用。

# jasper-reports - How do I change the locale that JasperReports uses?

> ID：248350
> 
> 赞同：39
> 
> 时间：2008-10-29T20:46:23.787
> 
> 标签：jasper-reports, locale

The windows installed on my machine has the locale `en_AU` and that's what JasperReports uses. I already tried changing the locale of all users, including the Administrator but it still uses `en_AU`.

How can I change that locale? Is it possible to change the `REPORT_LOCALE` parameter on my report?

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-04-21T12:48:21.517

语言环境是在执行期间设置的，而不是在 JRXML 中。

使用 Java，`REPORT_LOCALE`为报表的参数映射设置参数。例如：

```
InputStream reportTemplate = getReportTemplate();
JRDataSource dataSource = getDataSource();

java.util.Map parameters = getParameters();
java.util.Locale locale = new Locale( "en", "US" );
parameters.put( JRParameter.REPORT_LOCALE, locale );

JasperFillManager.fillReport( reportTemplate, parameters, dataSource ); 
```

使用 Jaspersoft Studio，打开**Report Execution**区域的项目属性对话框：

[![项目属性](https://i.stack.imgur.com/DRjFS.png)](https://i.stack.imgur.com/DRjFS.png)

使用 iReport，在“常规”选项卡的“报告执行选项”部分下的“选项”窗口中设置报告区域设置。这将在运行时设置报告区域设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-10-29T18:20:40.070

最简单的方法是`net.sf.jasperreports.default.locale`在文件中设置语言环境属性`jasperreports.properties`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-01-22T16:25:26.520

`JasperFillManager`如果您不想更改代码，可以在执行代码的 JVM 上设置语言环境：

```
java -Duser.language=de -Duser.country=CH ... 
```

# javascript - How can I create a javascript badge or widget?

> ID：248351
> 
> 赞同：4
> 
> 时间：2008-10-29T20:46:43.910
> 
> 标签：javascript

I want to create a javascript badge that displays a list of links. We host the javascript on our domain. Other sites can put an empty div tag on their page and at the bottom a reference to our javascript that would render the content in the div tag. How do you implement something like this?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T21:17:25.173

I would give the SCRIPT tag an ID and replace the script tag itself with the DIV + contents, making it so they only have to include one line of code. Something along the lines of the following:

```
<script id="my-script" src="http://example.com/my-script.js"></script> 
```

In your script, you can swap out the SCRIPT tag for your DIV in one fell swoop, like so:

```
var scriptTag, myDiv;
scriptTag = document.getElementById('my-script');
myDiv = document.createElement('DIV');
myDiv.innerHTML = '<p>Wow, cool!</p>';
scriptTag.parentNode.replaceChild(myDiv, scriptTag); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T20:53:48.623

正如您所说，让他们在页面底部放置一个 div：

```
<div id="mywidget"></div> 
```

然后让它们链接到您的 javascript：

```
<script type="text/javascript" src="http://yourdomain.com/mywidget.js"></script> 
```

然后让他们改变他们的身体标签，或者 onload 来调用你的脚本

```
<script type="text/javascript">
  document.body.onload = loadYourWidget();
</script> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T21:35:30.957

你不需要一个初始的 div 来填充你的链接列表。

*`document.write`*只需在放置脚本的位置创建 div 。

```
<script type="text/javascript" src="http://domain.com/badge.js"></script> 
```

...并在您的脚本中：

```
var links = [
  '<a href="#">One</a>',
  '<a href="#">Two</a>', 
  '<a href="#">Three</a>'
];

document.write("<div>" + links.join(", ") + "</div>"); 
```

另一个好处是您不必等待页面完全加载。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T20:58:08.053

就像@Owen 说的那样，除了为什么不制作你的 javascript

```
<script type="text/javascript" src="http://yourdomain.com/mywidget.js"></script> 
```

如果您在 html 源代码中的 mywidget div 之后立即包含脚本标记，则它们会自行完成填充工作`<div id="mywidget"></div>`，因此不需要他们从 DOM 加载中调用 loadYourWidget() 。这并不是一个真正的最佳实践，但我认为它会起作用。

mywidget.js 代码示例：

```
document.getElementById('mywidget').innerHTML = "<a href=''>LinkOne</a> <a href=''>LinkTwo</a>"; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-03T17:01:52.450

[我花了一些时间在 Stackexchange 上](https://stackoverflow.com/questions/8256083/how-does-the-facebook-like-button-work "Facebook Like 按钮是如何工作的？")找到这个答案，因为我使用了不同的搜索词。我相信该链接建议的答案比这里已经给出的答案更完整：

[如何构建 Web 小部件（使用 jQuery）](http://alexmarandon.com/articles/web_widget_jquery/)

它涵盖：

> *   确保小部件的代码不会意外地弄乱页面的其余部分，
> *   动态加载外部 CSS 和 JavaScript 文件，
> *   使用 JSONP 绕过浏览器的单源策略。

# java - Java GUI LayoutManagers

> ID：248353
> 
> 赞同：1
> 
> 时间：2008-10-29T20:47:06.983
> 
> 标签：java, swing, user-interface

I'm busy with an asignment where i have to make a graphical interface for a simple program. But i'm strugling with the layout.

This is the idea:
![Layout Example](https://i.stack.imgur.com/a3Xk7.png "Layout Example")

What is the easiest way to accomplish such a layout?

And what method do you use to make layouts in java. Just code it, or use an IDE like netbeans?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T20:54:07.907

> And what method do you use to make layouts in java. Just code it, or use an IDE like netbeans?

NetBeans for GUI developers is like a calculator for grade schoolers: you really shouldn't use it until you know how to do things without it, but then it will save you a lot of time.

(I'd love to answer your primary question, but the firewall I'm behind is blocking the picture.)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T21:14:10.330

Well considering how simple the layout is I would suggest you use a BorderLayout with NORTH set to the top section in a container and the JTable in the CENTER of the BorderLayout. For the Top it appears to be a simple BorderLayout again with NORTH as the Instruction: south as the black box (possibly in a container with a FlowLayout). The center of the top pane appears to be 2 Containers of GridLayouts with 2 rows and 2 columns, so put thos in another container with a GirdLayout.

So in pseudo:

```
Container(BorderLayout)
{
  @NORTH
    Container(BorderLayout)
    {
       @NORTH
         Label(Instruction);
       @CENTER
         Container(GridLayout(2,1))
         {
            Container(GirdLayout(2,2))
            {
              Label() TextField()
              Label() TextField() 
            }
            Container(GirdLayout(2,2))
            {
              Label() TextField()
              Label() TextField()
            }
         }
       @SOUTH
         Container(FlowLayout())
         {
           JButton() //shaded thing?
         }
    }
  @CENTER
    {
      JTable
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T21:42:29.897

I build everything by hand. Like Christian, I've had bad experiences with GUI builders; they always either refused to configure a couple of components quite right, or they generated huge amounts of unnecessary code which made later maintenance impractical, or both.

I used to do build a lot of UIs using GridBagLayout, but for years, I've never seen an office-environment UI that couldn't be built with nested BorderLayouts, GridLayouts, and the occasional BoxLayout or FlowLayout. About 98% of the stuff I've seen is doable with nested BorderLayouts.

In your case, the layout organization will be as bmeck says. Speaking from memory, using CENTER for the JTable (remember to put it in a JScrollPane!) and NORTH for everything else ensures that if you resize your JFrame, the JTable will get all of the extra space, and that should be exactly what you want. For the top labels and fields, the nested GridLayouts should ensure that each "column" of labels and fields will take up equal horizontal space. (They'll get only enough vertical space to be completely visible, and no more, since the JTable is taking up everything else.)

Everything else is just a matter of adding borders and setting the GridLayout padding reasonably.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T21:03:36.107

For myself gui-builders for swing or swt never worked that well that's why i code layouts myself using layout managers. Your question doesn't mention which gui-system you are using but i assume you want to use swing. If that's the case I would recommend to use GridBagLayout for your layout. It is not that easy to use in the beginning but as soon as you know how it works you can do most layouts in the way you want it to be and i think it is also the layoutmanager of choice for the layout you want to do.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-02T03:17:34.180

I've used GUI layout generating tools for super rapid development (maybe get the first 2 or 3 iterations of an interface out of the way). I've ultimately found that using a simple fixed layout (no layout manager) with these tools is the best approach. Once we are starting to hone in on a design, we switch to manual layout.

Whenever I've tried to use GUI generators to create code for layout managers, I've almost always been bitten eventually where the layout would just stop working and I spent more time debugging the impossible to read auto-generated code than if I'd done the layout by hand anyway. For what it's worth, when we are doing the early phase of layouts, we use the Jigloo plugin for Eclipse. It's very inexpensive, and does a good job.

I'm a big fan of [MiGLayout](http://www.miglayout.com/). I've found that it is incredibly easy to use for simple layouts, and is capable of doing extremely complicated layouts. All without the need to resort to nested panels, etc... JGoodies Forms is also good, but harder to use.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-03T17:32:02.627

I wrote an article a while back on layout managers:

[http://developer.java.sun.com/developer/onlineTraining/GUI/AWTLayoutMgr](http://developer.java.sun.com/developer/onlineTraining/GUI/AWTLayoutMgr)

It describes how nesting (as bmeck above demonstrates) can be used very effectively for many UI designs.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-11T19:10:27.540

Try table layout. Works great.

[https://tablelayout.dev.java.net/](https://tablelayout.dev.java.net/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-11T19:17:24.590

Use [GroupLayout](http://java.sun.com/javase/6/docs/api/javax/swing/GroupLayout.html)

:)

All the alignments are pretty easy to do

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-29T20:55:39.993

I used to love Motif's XmForm for this sort of thing. In Java, I usually put Boxes inside of boxes. So I have a vertical box. First row of the box contains a JLabel for the Instruction. Second row contains something for the label/result stuff, possibly some sort of grid. Third row contains whatever that blacked out thing, Fourth row contains the JTable. Then I'd spend some time to try to figure out how to do the lable/result stuff. Then I'd probably end up saying "dammit", and doing it as a GridBagLayout.

# sql-server - 如何找出发生错误的存储过程的哪一行？

> ID：248354
> 
> 赞同：6
> 
> 时间：2008-10-29T20:47:11.693
> 
> 标签：sql-server, stored-procedures

当我尝试在我的 MS SQL 2005 数据库上运行特定的存储过程时，我收到如下错误：

```
Subquery returned more than 1 value. This is not permitted when
the subquery follows =, !=, <, <= , >, >= or when the subquery
is used as an expression 
```

查询中的SP很长，会调用其他SP。这个错误显然是由 SQL 本身产生的，并且一直返回到调用堆栈，但没有提及是哪个 SP 或行号导致了问题。我怎样才能找出错误是从哪里引发的，以便更容易地调试它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T20:49:51.533

使用[Try/Catch 块](http://msdn.microsoft.com/en-us/library/ms175976.aspx)应该可以满足您的需求。

在 CATCH 块的范围内，可以使用以下系统函数来获取有关导致 CATCH 块执行的错误的信息：

```
* ERROR_NUMBER() returns the number of the error.
* ERROR_SEVERITY() returns the severity.
* ERROR_STATE() returns the error state number.
* ERROR_PROCEDURE() returns the name of the stored procedure or trigger where the error occurred.
* ERROR_LINE() returns the line number inside the routine that caused the error.
* ERROR_MESSAGE() returns the complete text of the error message. The text includes the values supplied for any substitutable parameters, such as lengths, object names, or times. 
```

所以，在你的情况下， ERROR_LINE() 和 ERROR_PROCEDURE() 应该是你想要的......

# c# - 如何在 C# 代码中构建 DataTemplate？

> ID：248362
> 
> 赞同：84
> 
> 时间：2008-10-29T20:48:53.657
> 
> 标签：c#, wpf, datatemplate

我正在尝试为 winform 互操作构建一个下拉列表，并且我正在代码中创建下拉列表。但是，我在根据我指定的 DataTemplate 获取要绑定的数据时遇到问题。

我错过了什么？

```
drpCreditCardNumberWpf = new ComboBox();  
DataTemplate cardLayout = new DataTemplate {DataType = typeof (CreditCardPayment)};   
StackPanel sp = new StackPanel
{
    Orientation = System.Windows.Controls.Orientation.Vertical
};   

TextBlock cardHolder = new TextBlock {ToolTip = "Card Holder Name"};
cardHolder.SetBinding(TextBlock.TextProperty, "BillToName");
sp.Children.Add(cardHolder);

TextBlock cardNumber = new TextBlock {ToolTip = "Credit Card Number"};
cardNumber.SetBinding(TextBlock.TextProperty, "SafeNumber");
sp.Children.Add(cardNumber);

TextBlock notes = new TextBlock {ToolTip = "Notes"};
notes.SetBinding(TextBlock.TextProperty, "Notes");
sp.Children.Add(notes);

cardLayout.Resources.Add(sp, null);

drpCreditCardNumberWpf.ItemTemplate = cardLayout; 
```

* * *

## 回答 #1

> 赞同：155
> 
> 时间：2008-10-29T22:19:15.270

假设您已经`ItemsSource`为`drpCreditCardNumberWpf`...

```
//create the data template
DataTemplate cardLayout = new DataTemplate();
cardLayout.DataType = typeof(CreditCardPayment);

//set up the stack panel
FrameworkElementFactory spFactory = new FrameworkElementFactory(typeof(StackPanel));
spFactory.Name = "myComboFactory";
spFactory.SetValue(StackPanel.OrientationProperty, Orientation.Horizontal);

//set up the card holder textblock
FrameworkElementFactory cardHolder = new FrameworkElementFactory(typeof(TextBlock));
cardHolder.SetBinding(TextBlock.TextProperty, new Binding("BillToName"));
cardHolder.SetValue(TextBlock.ToolTipProperty, "Card Holder Name");
spFactory.AppendChild(cardHolder);

//set up the card number textblock
FrameworkElementFactory cardNumber = new FrameworkElementFactory(typeof(TextBlock));
cardNumber.SetBinding(TextBlock.TextProperty, new Binding("SafeNumber"));
cardNumber.SetValue(TextBlock.ToolTipProperty, "Credit Card Number");
spFactory.AppendChild(cardNumber);

//set up the notes textblock
FrameworkElementFactory notes = new FrameworkElementFactory(typeof(TextBlock));
notes.SetBinding(TextBlock.TextProperty, new Binding("Notes"));
notes.SetValue(TextBlock.ToolTipProperty, "Notes");
spFactory.AppendChild(notes);

//set the visual tree of the data template
cardLayout.VisualTree = spFactory;

//set the item template to be our shiny new data template
drpCreditCardNumberWpf.ItemTemplate = cardLayout; 
```

您可以使用我`ToolTip`在`TextBlock`s 上设置的相同方式来设置其他属性，例如边距。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2019-08-12T12:16:20.640

完整版

```
var ms = new MemoryStream(Encoding.UTF8.GetBytes(@"<DataTemplate xmlns=""http://schemas.microsoft.com/winfx/2006/xaml/presentation""
                                                                 xmlns:x=""http://schemas.microsoft.com/winfx/2006/xaml""                                                                             
                                                                 xmlns:c=""clr-namespace:MyApp.Converters;assembly=MyApp"">
        <DataTemplate.Resources>
            <c:MyConverter x:Key=""MyConverter""/>
        </DataTemplate.Resources>
        <TextBlock Text=""{Binding ., Converter={StaticResource MyConverter}}""/>
      </DataTemplate>"));
var template = (DataTemplate)XamlReader.Load(ms);

var cb = new ComboBox { };
//Set the data template
cb.ItemTemplate = template; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-07-05T19:52:35.970

嗯，其实我们还有一个办法，你不喜欢那些*`FrameworkElementFactory`*东西你就真的喜欢了。

而且我认为它只是对自然代码进行了微小的更改，即声明 a*`UserControl`*并将您的控件放入其中，然后仅使用一个*`FrameworkElementFactory`*来调用*`UserControl`*.

简单的演示代码（在 F# 中）：

```
let buildView()=StackPanel()
//Build it with natural code
type MyView()=inherit UserControl(Content=buildView())
let factory=FrameworkElementFactory(typeof<MyView>)
let template=DataTemplate(VisualTree=factory)
let list=ItemsControl(ItemsSource=makeData(),ItemTemplate=template) 
```

# c# - C# 数据集、分页和大量数据

> ID：248381
> 
> 赞同：3
> 
> 时间：2008-10-29T20:54:41.447
> 
> 标签：c#, dataset

我想在数据集中显示大量数据，100,000 条记录大约 10 列，这会消耗大量 ram 700MB。我也尝试过使用分页，这可以减少大约 15-20%，但我不太喜欢使用分页时涉及的上一个/下一个按钮。我目前没有将数据写入磁盘，应该是吗？如果是这样，最常用的方法是什么？数据不会在查看时永久存储，然后可能会运行新查询并查看另外 70,000 条记录。最好的方法是什么？

感谢您的建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T21:01:51.633

The reality is that the end-user rarely needs to see the totality of their dataset, so I would use which method you like for presenting the data (listview) and build a custom pager so that the dataset is only fed with the results of the number of records desired. Otherwise, each page load would result in re-calling the dataset.

The XML method to a temp file or utilizing a temp table created through a stored proc are alternatives but you still must sift and present the data.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T21:05:03.733

An important question is where this data comes from. That will help determine what options are available to you. Writing to disk would work, but it probably isn't the best choice, for three reasons:

1.  As a user, I'd be pretty annoyed if your app suddenly chewed up 700Mb of disk space with no warning at all. But, then, I'd notice such things. I suppose a lot of users wouldn't. Still: it's a lot of space.
2.  Depending on the source of the data, even the initial transfer could take longer than your really want to allow.
3.  Again, as a user, there's NO WAY I'm manually digging through 700Mb worth of data. That means you almost certainly never need to show it. You want to only load the requested page, one (or a couple) pages at a time.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T21:03:22.007

That is a lot of data to be working with and keeping aroudn in memory.

Is this a ASP.NET app? Or a Windows app?

I personally have found that going with a custom pager setup (to control, next previous links) and paging at the database level to be the only possible way to get the best performance, only get the data needed....

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T21:03:45.310

implement [paging in SQL](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) if you want to reduce the memory footprint

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T20:58:58.113

我建议使用内存映射文件...不确定 .NET 是否包含对它的支持。

# workflow - 工作流程工具比较？

> ID：248393
> 
> 赞同：4
> 
> 时间：2008-10-29T20:58:41.920
> 
> 标签：workflow, workflow-foundation

我们非常需要围绕各种流程设计一些工作流程。问题是我们中没有人真正了解任何工作流技术，并且找到好的数据来比较可用选项是乏味的，而且并不完全富有成效。

所以我想我会问你们。

我们正在研究的主要技术是 Windows Workflow Foundation 和 eDocs Workflow。还有哪些其他选择？Sharepoint 2007 也有工作流功能，对吧？那只是基于WF吗？

各种技术的优缺点是什么？他们如何比较？

编辑：此外，与 eDocs Workflow 类似的管理类型的一个特点是它为他们提供了一种自己编辑它的方法。我相信 Sharepoint '07 也是如此。有没有其他方法可以通过直接的 WWF 实施来实现这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T06:10:07.470

Sharepoint 和 WF 更像是互补技术，被设计为同一生态系统中的两种不同的工作流创作工具。有一个 Sharepoint 工作流设计器和一个 WF（Windows Workflow Foundation）工作流设计器。

Sharepoint 设计器旨在提供类似 Office 的工作流编辑体验，更易于上手，适用于非技术类型，并自动生成所有 Web 表单。

另一方面，“WF”工作流设计器实际上是 Visual Studio 的一个组件（默认情况下 - 正如 Bernie 所说，您可以重新托管它），旨在让程序员能够完全自定义工作流，并将其与任何其他代码集成/所需的系统。通过使用“Sharepoint 活动”，以这种方式构建和部署共享点站点仍然是可能的，但更复杂。

如果您采取前一种方式，您可以希望让管理类型进行自己的基本自定义（直到该环境的限制），而不会造成完全混乱。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T22:20:57.950

可以在您自己的应用程序中“重新托管”WF 设计器（来自 Visual Studio 的设计器），以便用户可以创作工作流。网上有很多代码示例，其中最重要的一个来自 MS 本身：http: [//msdn.microsoft.com/en-us/library/aa480213.aspx](http://msdn.microsoft.com/en-us/library/aa480213.aspx)）。

在某些时候，在评估 WF 时，我实现了一个演示应用程序，它做到了这一点并添加了一些功能，并发现虽然它有效，但并不是每个人都能理解和使用需要了解规则的更困难的活动（如策略活动）发动机工作。

# command-line - 用批处理文件搜索和替换

> ID：248396
> 
> 赞同：2
> 
> 时间：2008-10-29T20:59:04.243
> 
> 标签：command-line, batch-file

我正在使用 Windows 命令编写一个批处理文件脚本，并且想用“，”更改每次出现的一些空格，最简单的方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T23:35:03.603

如果您的用户是文本文件中一行的单词列表，以空格分隔，例如：

```
one two three four 
```

创建批处理文件 SpaceToComma.bat，如下所示：

```
@echo off
setlocal
for /F "tokens=* delims= " %%a in (%1) do @set data=%%a
echo %data: =,%
endlocal 
```

然后运行它，你会得到用逗号分隔的单词。这是你想要的吗？

```
C:\>SpaceToComma.bat data.txt
one,two,three,four 
```

如果您有一个多行文件，则可以这样做：

数据.txt

```
one two three four
five six seven 
```

SpaceToComma.bat

```
@echo off
setlocal
for /F "tokens=* delims= " %%a in (%1) do @call :processaline %%a
endlocal
goto :eof
:processaline
setlocal
set data=%*
echo %data: =,%
endlocal
goto:eof 
```

输出

```
C:\>SpaceToComma.bat data.txt
one,two,three,four
five,six,seven 
```

（在没有子例程的情况下，可能有一种聪明的方法，使用 !data! 语法来延迟变量扩展，但我无法让它与替换语法一起工作。）

如果这不是您想要的，请解释一下，我可以尽力提供帮助。

（PS：我喜欢在人们坚持无法完成的情况下使用批处理文件。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T21:28:20.847

[您可以从http://unxutils.sourceforge.net/](http://unxutils.sourceforge.net/)下载 sed.exe并运行以下命令：

```
sed -e "s/ /,/" infile.txt >outfile.txt 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T21:02:47.077

好吧，这在很大程度上取决于您如何获取数据，但是您可以使用 For-Do 构造来解决问题。将字段分隔符设为空格，然后在每个标记之间用 , 将字符串重新构建到 do 中。我可以建议一种更强大的脚本语言吗？您应该在几乎任何相对现代的 Windows 弓上安装 VBScript。

# filtering - MDX：计算尺寸？

> ID：248397
> 
> 赞同：1
> 
> 时间：2008-10-29T20:59:58.330
> 
> 标签：filtering, mdx, where, dimensions

我不知道这是否可能，或者我对 MDX 的有限知识是否将我推向了错误的方向......

我正在处理的多维数据集有两个不同的日期维度`[Statement Dates]`和`[Premium Dates]`. 进一步在每个层次结构中看起来像这样：

```
[Statement Dates].[Statement Year].[2008]  
[Payment Dates].[Payment Year].[2008] 
```

对于我正在实现的业务逻辑，我需要执行以下操作：

```
select
  ({ [Measures].[Commission] }) on columns,
  ({[Products].[Product Category]}) on rows
from [Cube]
where
(
  IIF( [Products].[Product Category].CurrentMember.Name = "Some Category",
       [Statement Dates].[Statement Year].[2008], 
       [Payment Dates].[Payment Year].[2008] )
) 
```

所以我需要它来区分使用哪个维度来根据正在使用的产品类别过滤年份。

这可以解析并运行查询，但数字似乎表明该`IIF`语句始终返回 false。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-10T02:16:47.247

因为首先评估 WHERE 子句，所以 IIF 中的 .CurrentMember 函数只会看到“所有产品类别”。在这种情况下，[Products].[Product Category].CurrentMember.Name 永远不会等于“Some Category”，因为上下文中唯一的产品类别是“All Product Category”。

一种可能的解决方法是进行如下计算：

```
WITH MEMBER Measures.Commission2 as 
SUM(
{[Products].[Product Category].[Product Category].Members}
, IIF( [Products].[Product Category].CurrentMember.Name = "Some Category"
   , ([Statement Dates].[Statement Year].[2008],[Measures].[Commission])
   , ([Payment Dates].[Payment Year].[2008].[Measures].[Commission]) )
)
select  
   ({ [Measures].[Commission2] }) on columns
,  ({[Products].[Product Category]}) on rows
from [Cube] 
```

您还可以在多维数据集的计算脚本中执行范围分配来执行此类操作。

# comments - 请推荐一个开源项目，有质量好的英文评论

> ID：248398
> 
> 赞同：2
> 
> 时间：2008-10-29T21:01:11.730
> 
> 标签：comments

英语不是我的母语。但是，我必须用英文写评论。我想通过研究一段用好英语评论的代码来提高我的“评论英语”。请推荐一个开源项目，其中包含大量由精通语言的人撰写的有意义的评论。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T21:05:50.580

我不认为评论是一个学习的好地方，即使你必须效仿这种风格。评论通常甚至不是正确的英语，而且好的项目不会有太多评论，因此没有太多可学习的地方。

另一方面，如果您采用一个被广泛评论的项目，您几乎可以肯定它不是一个很好的榜样，因为程序员无法传达简洁的含义。当然，这是一个概括。但是，我相信它（几乎？）总是正确的。YMMV。

相反，通过学习专家来学习英语。有[一个](https://stackoverflow.com/questions/55992/learn-how-to-become-a-better-writer)关于这个的问题。我推荐[了威廉·辛瑟 (William Zinsser) 的《写得好》](https://stackoverflow.com/questions/55992/learn-how-to-become-a-better-writer#56230)，我会再推荐一次。

（顺便说一句，英语也不是我的母语。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-11T07:40:41.970

我可以推荐 Simon Tatham 的拼图系列。

我读过的评论对我来说看起来像是正确的英语。此外，它们写得很清楚，并包含有用的信息，说明为什么事情会以它们的方式完成。

开发人员文档也易于阅读和理解，作为附带的好处，您将阅读具有良好且简单架构的系统的文档。

如果您的目标是阅读某些内容然后在没有明确理解为什么这样做是个好主意的情况下模仿它，我绝对可以推荐 ST 的谜题。如果你想清楚地了解什么是好的写作，我认为 ST 的谜题将是一个很好的*例子*，但你真的想阅读像 Strunk and White 这样的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T21:37:40.017

我只看过其中的一小部分，但我听说 linux 内核的评论非常好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T21:51:14.310

我一直认为[Angband](http://www.thangorodrim.net/)的评论很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T21:52:49.457

我相当好评的开源项目是 Drupal 。[在Drupal.org](http://www.drupal.org)上查看。我在其中开发了几个门户网站，您实际上可以通过阅读模块和主题中的评论来学到很多东西。实际上，它们比文档提供的信息要多一些。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T00:55:46.950

[Minix](https://gforge.cs.vu.nl/plugins/scmsvn/viewcvs.php/?root=minix)的评论非常好。它们在某些地方可能有点简洁，但评论非常有帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T00:59:24.603

另外，如果你想提高你的写作水平……关于英语有很多令人困惑的事情。你如何掌握这些要点是平庸作家与优秀作家的区别。最好的、最小的和最简洁的书（每个人都应该有一本！）被[Strunk 和 White 称为风格元素](https://rads.stackoverflow.com/amzn/click/com/020530902X)。请注意，您可以在亚马逊上以 2 美元的价格购买它。你会花的最好的 2 美元！

# c++ - 寻找合数

> ID：248400
> 
> 赞同：1
> 
> 时间：2008-10-29T21:02:08.403
> 
> 标签：c++, primes, sieve

我有一系列随机数。范围实际上由用户确定，但最多为 1000 个整数。它们被放置在这个：

```
vector<int> n 
```

并且值是这样插入的：

```
srand(1);

for (i = 0; i < n; i++)
  v[i] = rand() % n; 
```

我正在创建一个单独的函数来查找所有非质数。这就是我现在所拥有的，但我知道这是完全错误的，因为我在这个系列中得到了素数和复合数。

```
void sieve(vector<int> v, int n)
{
  int i,j;

  for(i = 2; i <= n; i++)
     {
        cout << i << " % ";
        for(j = 0; j <= n; j++)
           {
              if(i % v[j] == 0)
                 cout << v[j] << endl;
           }
     }
} 
```

这种方法通常在我只有从 0 到 1000 的一系列数字时有效，但是当我的数字乱序和重复时，它现在似乎不起作用。有没有更好的方法来查找向量中的非素数？我很想创建另一个向量，用 n 个数字填充它，然后以这种方式找到非素数，但这会效率低下吗？

好的，由于范围是 0-1000，我想知道创建 0-n 排序的向量是否更容易，然后使用筛子找到素数，这是否更接近？

```
void sieve(vector<int> v, BST<int> t, int n)
{
  vector<int> v_nonPrime(n);
  int i,j;
  for(i = 2; i < n; i++)
      v_nonPrime[i] = i;

  for(i = 2; i < n; i++)
     {

        for(j = i + 1; j < n; j++)
           {
              if(v_nonPrime[i] % j == 0)
                 cout << v_nonPrime[i] << endl;
           }
     }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-29T21:26:29.790

在这段代码中：

```
if(i % v[j] == 0)
  cout << v[j] << endl; 
```

您正在测试您的索引以查看它是否可以被 v[j] 整除。我认为你的意思是反过来做，即：

```
if(v[j] % i == 0) 
```

现在，您正在打印 i 的随机除数。您没有打印出已知不是素数的随机数。此外，您的输出中会有重复项，也许没关系。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T21:15:08.440

首先，我认为 Knuth 首先说过：过早的优化是许多 bug 的原因。先做慢版本，然后想办法让它变快。

其次，对于您的外部循环，您实际上只需要转到 sqrt(n) 而不是 n。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T21:14:58.673

基本上，你有很多不相关的数字，所以对于每一个你都必须检查它是否是素数。

如果您事先知道数字的范围，则可以生成该范围（或其平方）内*可能出现的所有素数，并测试容器中的每个数字是否可被任何一个生成的素数整除。*

生成素数最好由 Erathostenes Sieve 完成——该算法的许多示例都可以找到。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T21:14:12.530

您应该尝试使用[初筛](http://en.wikipedia.org/wiki/Prime_sieve)。您需要知道创建筛子的 最大数量`O(n)`（`O(max_element)``O(1000) == O(1)`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T21:29:15.930

您的代码完全错误。首先，您正在测试 i % v[j] == 0，这是倒数的，也解释了为什么您会得到所有数字。其次，您的输出将包含重复项，因为您正在测试并在每次未通过（损坏的）可分性测试时输出每个输入数字。

其他建议：

使用 n 作为向量中的最大值和向量中的元素个数是令人困惑且毫无意义的。您不需要传入向量中的元素数量 - 您只需查询向量的大小。而且您可以相当快地计算出最大值（但如果您提前知道它，您也可以将它传递给它）。

如上所述，您只需要测试到 sqrt(n) [其中 n 是 vecotr 中的最大值]

您可以使用筛子生成直到 n 的所有素数，然后从输入向量中删除这些值，如上所述。这可能会更快更容易理解，尤其是如果您将素数存储在某个地方。

如果您要单独测试每个数字（我猜是使用反筛），那么我建议按顺序单独测试每个数字。恕我直言，它比您编写它的方式更容易理解 - 测试每个数字是否可被 k < n 整除以不断增加 k。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T21:15:47.330

您尝试实施的筛子的想法取决于您从质数 (2) 开始并删除该数字的多个这一事实 - 因此，预先排除了依赖于质数“2”的所有数字。

这是因为所有非素数都可以分解为素数。而素数不能用模 0 整除，除非你将它们除以 1 或它们自己。

所以，如果你想依赖这个算法，你需要一些手段来真正恢复算法的这个属性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T21:40:27.733

您的代码似乎有很多问题：

1.  如果你想测试你的数字是素数还是非素数，你需要检查 v[j] % i == 0，而不是反过来
2.  您没有检查您的号码是否自行划分
3.  你不断地一次又一次地检查你的号码。这是非常低效的。

正如其他人建议的那样，你需要做一些像埃拉托色尼筛子这样的事情。

因此，您的问题的伪 C 代码将是（我尚未通过编译器运行此代码，因此请忽略语法错误。此代码仅用于说明算法）

```
vector<int> inputNumbers;

// First, find all the prime numbers from 1 to n
bool isPrime[n+1] = {true};
isPrime[0]= false;
isPrime[1]= false;
for (int i = 2; i <= sqrt(n); i++)
{
  if (!isPrime[i])
    continue;
  for (int j = 2; j <= n/i; j++)
    isPrime[i*j] = false;
}

// Check the input array for non-prime numbers
for (int i = 0; i < inputNumbers.size(); i++)
{
   int thisNumber = inputNumbers[i];
   // Vet the input to make sure we won't blow our isPrime array
   if ((0<= thisNumber) && (thisNumber <=n))
   {
      // Prints out non-prime numbers
      if (!isPrime[thisNumber])
         cout<< thisNumber;
   }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T21:43:00.880

首先对数字进行排序可能是一个好的开始 - 您可以在 nLogN 时间内完成。这是对您的另一个问题的一个小补充（我认为） - 找出一个数字是否是素数。
（实际上，使用这样的一小组数字，您可以使用向量/集合大小的副本更快地进行排序并进行哈希/桶排序/其他）

然后我会找到集合中的最高数字（我假设这些数字可以是无界的 - 在你排序之前不知道上限 - 或者单次通过以找到最大值）

然后用筛子去 - 正如其他人所说

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-29T22:26:23.367

杰里米是对的，基本问题是你的`i % v[j]`而不是`v[j] % i`.

试试这个：

```
void sieve(vector<int> v, int n) {
  int i,j;

  for(j = 0; j <= n; j++) {
    cout << v[j] << ": ";

    for(i = 2; i < v[j]; i++) {
      if(v[j] % i == 0) {
        cout << "is divisible by " << i << endl;
        break;
      }
    }

    if (i == v[j]) {
      cout << "is prime." << endl;
    }
  }
} 
```

这不是最优的，因为它试图除以小于的所有数字，`v[j]`而不是仅仅达到 的平方根`v[j]`。它正在尝试除以所有数字，而不仅仅是素数。

但它会起作用。

# java - 代码性能比较，线程与非线程

> ID：248405
> 
> 赞同：2
> 
> 时间：2008-10-29T21:03:23.317
> 
> 标签：java, multithreading, concurrency

假设以下代码，我有一些与线程相关的问题。请忽略代码可能效率低下，我只对线程部分感兴趣。

```
//code without thread use
public static int getNextPrime(int from) {
    int nextPrime = from+1;
    boolean superPrime = false;
    while(!superPrime) {
        boolean prime = true;
        for(int i = 2;i < nextPrime;i++) {
            if(nextPrime % i == 0) {
                prime = false;
            }
        }
        if(prime) {
            superPrime = true;
        } else {
            nextPrime++;
        }
    }
    return nextPrime;
}

public static void main(String[] args) {
   int primeStart = 5;
   ArrayList list = new ArrayList();
   for(int i = 0;i < 10000;i++) {
       list.add(primeStart);
       primeStart = getNextPrime(primeStart);
   }
} 
```

如果我运行这样的代码，大约需要 56 秒。但是，如果我有以下代码（作为替代）：

```
public class PrimeRunnable implements Runnable {

    private int from;
    private int lastPrime;

    public PrimeRunnable(int from) {
        this.from = from;
    }

    public boolean isPrime(int number) {
        for(int i = 2;i < from;i++) {
            if((number % i) == 0) {
                return false;
            }
        }
        lastPrime = number;
        return true;
    }

    public int getLastPrime() {
        return lastPrime;
    }

    public void run() {
        while(!isPrime(++from))
            ;
    }
}

public static void main(String[] args) {
   int primeStart = 5;
   ArrayList list = new ArrayList();
   for(int i = 0;i < 10000;i++) {
     PrimeRunnable pr = new PrimeRunnable(primeStart);
     Thread t = new Thread(pr);
     t.start();
     t.join();
     primeStart = pr.getLastPrime();
     list.add(primeStart);
   }
} 
```

整个操作大约需要 7 秒。我几乎可以肯定，即使我一次只创建一个线程，一个线程并不总是在创建另一个线程时完成。是对的吗？我也很好奇：为什么手术结束的这么快？

当我加入一个线程时，其他线程是否继续在后台运行，还是加入的线程是唯一一个在运行的线程？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T01:38:13.433

通过将 join() 放入循环中，您将启动一个线程，然后等待该线程停止，然后再运行下一个线程。我想你可能想要更像这样的东西：

```
public static void main(String[] args) {
   int primeStart = 5;

   // Make thread-safe list for adding results to
   List list = Collections.synchronizedList(new ArrayList());

   // Pull thread pool count out into a value so you can easily change it
   int threadCount = 10000;
   Thread[] threads = new Thread[threadCount];

   // Start all threads
   for(int i = 0;i < threadCount;i++) {
     // Pass list to each Runnable here
     // Also, I added +i here as I think the intention is 
     //    to test 10000 possible numbers>5 for primeness - 
     //    was testing 5 in all loops
     PrimeRunnable pr = new PrimeRunnable(primeStart+i, list);
     Thread[i] threads = new Thread(pr);
     threads[i].start();  // thread is now running in parallel
   }

   // All threads now running in parallel

   // Then wait for all threads to complete
   for(int i=0; i<threadCount; i++) {
     threads[i].join();
   }
} 
```

顺便说一下 pr.getLastPrime() 将在没有素数的情况下返回 0，因此您可能希望在将其添加到列表之前将其过滤掉。PrimeRunnable 必须承担添加到最终结果列表的工作。另外，我认为 PrimeRunnable 实际上被破坏了，因为它仍然有递增的代码。我认为这是固定的，但我实际上并没有编译它。

```
public class PrimeRunnable implements Runnable {    
    private int from;
    private List results;   // shared but thread-safe

    public PrimeRunnable(int from, List results) {
        this.from = from;
        this.results = results;
    }

    public void isPrime(int number) {
        for(int i = 2;i < from;i++) {
                if((number % i) == 0) {
                        return;
                }
        }
        // found prime, add to shared results
        this.results.add(number);
    }

    public void run() {
        isPrime(from);      // don't increment, just check one number
    }    
} 
```

并行运行 10000 个线程并不是一个好主意。创建一个合理大小的固定线程池并让它们从共享队列中提取工作是一个更好的主意。基本上每个工作人员都从同一个队列中提取任务，处理它们并将结果保存在某个地方。与 Java 5+ 最接近的端口是使用由线程池支持的 ExecutorService。您还可以使用 CompletionService 将 ExecutorService 与结果队列相结合。

ExecutorService 版本如下所示：

```
public static void main(String[] args) {
   int primeStart = 5;

   // Make thread-safe list for adding results to
   List list = Collections.synchronizedList(new ArrayList());

   int threadCount = 16;  // Experiment with this to find best on your machine
   ExecutorService exec = Executors.newFixedThreadPool(threadCount);

   int workCount = 10000;  // See how # of work is now separate from # of threads?
   for(int i = 0;i < workCount;i++) {
     // submit work to the svc for execution across the thread pool 
     exec.execute(new PrimeRunnable(primeStart+i, list));
   }

   // Wait for all tasks to be done or timeout to go off
   exec.awaitTermination(1, TimeUnit.DAYS);
} 
```

希望能给你一些想法。我希望最后一个例子看起来比第一个好很多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T21:27:14.110

您可以通过使用线程运行第一个示例中的确切代码来更好地测试这一点。用这个子你的主要方法：

```
 private static int currentPrime;
public static void main(String[] args) throws InterruptedException {
    for (currentPrime = 0; currentPrime < 10000; currentPrime++) {
        Thread t = new Thread(new Runnable() {
            public void run() {
                getNextPrime(currentPrime);
            }});
        t.run();
        t.join();
    }
} 
```

这将与原始版本同时运行。

回答您的“加入”问题：是的，当您使用“加入”时，其他线程可以在后台运行，但在这种特殊情况下，您一次只有一个活动线程，因为您正在阻止新线程的创建直到最后一个线程执行完毕。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T21:45:39.533

JesperE 是对的，但我不相信只给出提示（至少在课堂外）：

请注意非线程版本中的此循环：

```
for(int i = 2;i < nextPrime;i++) {
  if(nextPrime % i == 0) {
    prime = false;
  }
} 
```

在线程版本中与此相反：

```
for(int i = 2;i < from;i++) {
  if((number % i) == 0) {
    return false;
  }
} 
```

第一个循环将始终完全运行，而第二个循环将在找到除数时提前退出。

您可以通过添加这样的 break 语句使第一个循环也提前退出：

```
for(int i = 2;i < nextPrime;i++) {
  if(nextPrime % i == 0) {
    prime = false;
    break;
  }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T21:13:29.753

仔细阅读您的代码。这两种情况不是在做同样的事情，它与线程无关。

当您加入一个线程时，其他线程将在后台运行，是的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T21:18:29.993

运行测试，第二个似乎不需要 9 秒——事实上，它至少和第一个一样长（这是意料之中的，threding 无法帮助它在您的示例中实现。

Thread.join 只会在 thread.joined 终止时返回，然后当前线程将继续，您调用 join 的线程将死亡。

作为快速参考——在开始一个迭代时考虑线程并不依赖于前一个迭代的结果。

# c++ - Matlab引擎API的线程安全

> ID：248421
> 
> 赞同：8
> 
> 时间：2008-10-29T21:08:49.873
> 
> 标签：c++, matlab, thread-safety, matlab-engine

我通过反复试验发现 MATLAB 引擎函数不是完全线程安全的。

有人知道规则吗？

通过反复试验发现：

在 Windows 上，与 MATLAB 的连接是通过 COM 进行的，因此适用 COM Apartment 线程规则。所有调用都必须发生在同一个线程中，但是多个连接可以发生在多个线程中，只要每个连接都是隔离的。

从下面的答案来看，在 UNIX 上似乎不是这种情况，只要调用是串行进行的，就可以从多个线程进行调用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-06-16T13:46:40.923

从[文档](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_external/f29148.html)中，

> MATLAB 库不是线程安全的。如果您创建多线程应用程序，请确保只有一个线程访问引擎应用程序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T20:25:11.020

当我第一次开始使用引擎时，我没有遇到任何关于线程安全的文档，所以我认为它不是线程安全的。

我使用 C++ 类来同步对引擎实例的访问。对于更多并行处理设计，我实例化了引擎类的多个实例。

（编辑）我在 Solaris 上使用 MATLAB R14。我使用“engOpen”调用打开引擎，并使用“engClose”关闭它。当调用关闭的线程与调用打开的线程不同时，我的平台不会崩溃。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T23:13:33.630

从用户的角度来看，Matlab 的解释器是纯单线程的。为了安全起见，您可能需要从单个线程对引擎进行所有访问。

请注意，在内部，Matlab 使用了大量线程。有 GUI 线程，在最近的几个版本中，解释器可以在幕后使用多个线程。但是，解释器在语义上等同于单线程解释器（带有中断）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-11T16:43:18.420

您可以使用`engOpenSingleUse`而不是使用`engOpen`来使多个线程单独工作。（仅限 Windows）

# asp.net - Global.asax 和处理衍生线程中发生的异常

> ID：248423
> 
> 赞同：3
> 
> 时间：2008-10-29T21:09:04.037
> 
> 标签：asp.net, exception-handling, global-asax

我有一个异常处理程序。在我的 asp.net 应用程序中。它是用 Global.asax 编写的。在 Application_Error() 方法中。

它适用于由于对应用程序的请求而调用的页面和类的上下文中发生的异常。但是，如果由于请求（或其他原因，例如基于应用程序的计时器）和该线程中的异常而产生了一个线程。它不由 Global.asax 处理。它会导致 Asp.net 的工作进程杀死我的应用程序。死的。如果我插入 AppDomain.CurrentDomain.UnhandledException 处理程序，我会看到我的线程中发生的异常，但可惜，这为时已晚。并且应用程序仍然死亡。死的。有什么建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T21:18:30.493

未处理的异常事件不会报告辅助线程中的异常

使用[SafeThread](http://www.codeproject.com/KB/threads/SafeThread.aspx)作为辅助线程

警告：我是 SafeThread 文章的作者，也是应用程序监控产品 CALM

# django - 遵循 Subversion 存储库主干的最佳实践：Git (Mirror)、Git-Svn、Subversion？

> ID：248425
> 
> 赞同：3
> 
> 时间：2008-10-29T21:10:04.380
> 
> 标签：django, svn, git, git-svn

我想检查Mac OS X Leopard 10.5.5 机器上的[Django Subversion 主干，然后根据需要进行更新。](http://code.djangoproject.com/)

我只对在我的 Mac 上更新 Django 代码感兴趣。我对为 Django 项目贡献补丁不感兴趣。我不需要 Django 主干的 Subversion 历史记录。

我计划将 Git 用作我所有个人项目的 DVCS/SCM。

* * *

**使用最新的 Django 主干更新我的 Mac 的最佳做法是什么？为什么？**

我是 Git 新手，因此了解您选择选项的原因将非常有帮助。

1.  使用安装在我的 Mac 上的 Subversion 1.4.4：svn co [http://code.djangoproject.com/svn/django/trunk/](http://code.djangoproject.com/svn/django/trunk/)。本质上是使用 Subversion 为我的个人项目获取 Subversion 存储库和 Git。

2.  使用 Git SVN 获取[Django Subversion 存储库](http://code.djangoproject.com/svn/django/trunk/)。有关如何为 Git 新手执行此操作的说明？

3.  使用 Git 获取[Django 存储库的 Git 镜像](http://spinlock.ch/pub/git/?p=django/django.git;a=summary)。我有点担心镜子将来可能会消失，但如果它是最好的选择，我愿意使用它。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-29T21:15:36.303

如果您不打算对 Django 代码进行更改，那么就没有理由将其导入 Git。只需使用选项 1。

`git-svn`如果您想对使用 Subversion 的项目进行本地修改（无论您是否将任何这些修改发送回项目），使用（通过自己运行或通过克隆其他人的存储库）很有用。但是，如果您不进行任何本地修改，那么它只是不必要的复杂性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T22:25:03.447

好吧，如果您在所有项目中都使用 git，并且您对它相当熟悉，我建议您使用 git mirror，因为它似乎是最新的。Git 也应该比使用 Subversion 更快。如果镜像消失/过时，您总是可以只使用**svn co / svn up**来获取当前源。

但是，由于您还安装了 Subversion - 您也可以直接使用它......并没有太大的区别，而且更多的是个人喜好问题。

Git-svn 的设置和保持同步有点繁琐——你必须首先使用**git svn fetch**获取 subversion 更新，然后执行**git svn rebase**以将更改应用到 git 存储库。它还会占用更多的磁盘空间。这有点容易出错，如果你真的想在源代码树上进行开发，我只建议使用 git-svn。如果您喜欢冒险并想尝试一下，请查看[本教程](http://utsl.gen.nz/talks/git-svn/intro.html)- 我发现使用 git-svn 非常有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-21T19:16:04.503

迟到总比没有好......也许......我不得不不同意目前的获胜答案。我会去

> 1.  使用 Git 获取 Django 存储库的 Git 镜像

关于*反对*它的论点：对 Git 感到满意（或想要）的人不应该发现它“只是不必要的复杂性”。注意：对于某些人（不适用于我），该参数可能对 git-svn 案例有效。

一些*原因*：

*   速度

*   强大的查询（日志）和可视化（gitk 甚至更高级的表亲）

*   大多数情况下磁盘空间较少

*   平分 - 例如。试图隔离回归，帮助提供更好的错误报告

*   一致性 - 如果所有其他项目都在 git 中

*   即使您不打算做出贡献，您也可以更轻松地尝试本地更改

*   如果你改变主意 - 你仍然可以离贡献更近一步

即使那个镜像消失了，你仍然可以切换到另一个镜像，无需再次克隆。

顺便说一句，当前镜像在[https://github.com/django/django](https://github.com/django/django)，据说是官方的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T21:24:47.343

我同意@cjm。如果您只想要一份 Django 源代码的副本，请使用普通的 Subversion。

我对 git-svn 的经验是，它对于喜欢和更熟悉 Git 且必须跟踪 Subversion 存储库的人最有用，而对于了解 Subversion 但想要更好的 git 新手的人来说不是那么有用颠覆。git-svn 有几个限制，因为 Subversion 的合并跟踪较差，除非你有丰富的 git 经验，否则这些限制有时会跳起来咬你。

# vsto - How can I improve cold startup performance for a VSTO2SE MS Office add-in?

> ID：248427
> 
> 赞同：4
> 
> 时间：2008-10-29T21:11:26.170
> 
> 标签：vsto, add-in, office-2007, office-2003

If you create a simple "Hello World" VSTO2SE add-in targeting Microsoft Office Excel 2003, it takes 15 seconds to load on a cold startup. During that time, Excel is completely unresponsive.

The cold-startup time is always poor in Excel 2003\. I have seen one test machine where the startup time is instant in Excel 2007, but all my other test machines take 15 seconds to initialize. (test environment - windows xp pro + VSTO2SE runtime + XP SP3)

How can this performance be improved?

Things I've already tried with no success:

1.  Disasble CRL (certificate revoke list) checking - this doesn't seem to help, plus I can't expect users to do this.

2.  Use NGEN to create native assemblies.
    a) It seems that Office 2003 never uses the native assemblies. b) My office 2007 test client that starts fast, does so even with IL assemblies. c) Even if I NGEN my entire depencency tree, there are still VSTO dependencies that may not have native images.

3.  Delay load the add-in - this is the workaround "stock response" i get from Microsoft. The thing is, my add-in is launched from a menu item - how can I delay load the add-in and still get my menus? I could use a VB6 add-in to draw the menus and forward the calls via interop, but then why would I even write a VSTO add-in in the first place?

Edit - Yes, that is the only line on the "connection" event in the add-in. (actually messagebox).. It takes a full 15 seconds before the message box appears. – J Davis

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T19:02:24.190

您将在冷启动时受到打击，因为它必须第一次加载所有程序集。

如果热启动明显更快，那么您唯一真正的选择是

1）当windows启动时有一个单独的程序加载，并在后台为您加载所有程序集。

2）尽量减少你正在使用的程序集的数量。当然，你不应该在 Hello World 中使用太多。

3) Excel 启动时预加载所有内容。这会影响 Excel 的启动时间，但会使您的菜单选择更快。您还可以在后台预加载所有内容，以提供帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T22:22:41.487

您是否验证了实际的滞留量是多少？如果将 Debug.Write() 语句作为 VSTO 插件的第一行，是否需要 15 秒才能显示在调试窗口中？

我们正在与 VSTO 合作，每当我们遇到问题时，通常不是实际运行时导致减速的原因。我们已经解决了这个问题，方法是关闭后台线程以执行缓慢的操作，同时不阻塞阻止 Excel 启动的主线程。

附言。我们也不是 VSTO 技术的忠实拥护者。我们 100% 接受了这一愿景，但实施仍有很多不足之处。

# filesize - Total download size of *initial* page of major websites

> ID：248428
> 
> 赞同：-3
> 
> 时间：2008-10-29T21:12:39.443
> 
> 标签：filesize

I'm quite surprised how large some major websites homepages are. This is the total amount downloaded just when opening the homepage.

```
cnn.com - 845kb
microsoft.com - 470kb
yahoo.com - 235kb
gillette.com (flash) - 3.8Mb
abc.com - 3.4Mb
nbc.com - 1.4Mb
youtube.com - 530kb 
```

Anyone care to add to the list? I'm just trying to justify the size of a site by comparing it to major sites out there. Obviously some of these sites are quite media intensive and wouldn't be much fun at 200kb. Im quite surprised how huge some sites actually are.

To do this I used [fiddler](http://fiddlertool.com). **Clear your cache first**, go to the site, select all the items in fiddler and under the 'statistics' tab it will show the total.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T21:14:37.130

You shouldn't need another site to justify the size of yours. Just because your site is not as big as, say, nbc.com, does not mean that the size is ok. You should still be trying to make it as small as possible.

# .net - Hooking into Windows with C# to Produce Windows 7 New Feature

> ID：248433
> 
> 赞同：2
> 
> 时间：2008-10-29T21:13:47.180
> 
> 标签：.net, windows-7, pinvoke, hook

I just saw a really useful UI feature of the forthcoming Windows 7 ( visit [http://www.gizmodo.com.au/2008/10/windows_7_walkthrough_boot_video_and_impressions-2.html](http://www.gizmodo.com.au/2008/10/windows_7_walkthrough_boot_video_and_impressions-2.html) and scroll down to the video entitled Super Scientific Video of New Window Resizing Feature)

In a nutshell you can drag a window by the title bar to the top of the screen to maximise it, drag it back down to restore and drag it to the left edge or the right edge of the screen to have it snap into position butted up against the edge you dragged it to, and resized to occupy half the screen.

Now I know there are a bunch of keyboard-based apps that do "similar" things but I've not seen a mouse-based program that does JUST the above, simple, useful and nothing more. If you know of one (or are smart enough to write one) please post the URL :)

Anyway, if I wanted to try and write a small app to do this I have a question:

**If I wanted to try and write a small app to do this, could I write it as a .NET app? I guess hooking into Windows' window drag/drop handling is pretty low-level and maybe not something that could be done in C#.NET?**

*any smartypants here who can knock a small app like this out in their lunchbreak? ;) I'm sure anything mimicing Windows 7 features would prove very popular, at least pre Windows 7's launch.*

**Edit:** The AeroSnap guys ([http://www.aerosnap.de/index_eng.htm](http://www.aerosnap.de/index_eng.htm)) have done a nice job of implementing this feature and judging by the number of downloads, it was a popular feature!

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-08-12T09:55:43.020

有一种官方方式：[Windows API 代码包](http://code.msdn.microsoft.com/WindowsAPICodePack)

适用于 Microsoft® .NE​​T Framework 的 Windows® API 代码包提供了一个源代码库，可用于从托管代码访问一些新的 Windows 7 功能（以及旧版 Windows 操作系统的一些现有功能）。目前 .NET Framework 中的开发人员无法使用这些 Windows 功能。

此版本 (v1.0) 库中支持的各个功能是：

Windows 7 任务栏跳转列表、图标覆盖、进度条、选项卡式缩略图和缩略图工具栏。Windows 7 库、已知文件夹、非文件系统容器。Windows Shell 搜索 API 支持、Shell 命名空间实体的层次结构以及 Shell 对象的拖放功能。资源管理器浏览器控件。壳牌财产系统。Windows Vista 和 Windows 7 通用文件对话框，包括自定义控件。Windows Vista 和 Windows 7 任务对话框。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T04:48:07.870

如果您的目标是创建一个适用于所有应用程序以及桌面上所有窗口的挂钩，那么您不能使用托管代码程序集。您将不得不使用生成传统 DLL 的语言（例如 C++）进行编写。

为了在系统级别挂钩，然后挂钩到所有正在运行的应用程序，您必须提供一个可以放置到所有正在运行的应用程序的地址空间中的 dll。我敢说大多数人的日常应用程序中有很大一部分不是托管的 .net 框架应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T00:32:27.917

感谢您花时间回答。我将使用 PInvoke 结帐。我假设我需要点击 Windows API 来连接窗口以及实际执行拖动窗口的移动/调整大小？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T10:30:51.490

试着检查一下这个，你有解释、源代码和官方 MSDN 文档的参考。

[http://www.josefcobonnin.com/post/2007/06/19/Hook-Keyboard-and-Mouse.aspx](http://www.josefcobonnin.com/post/2007/06/19/Hook-Keyboard-and-Mouse.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T13:26:46.950

尝试查看这些文章：

*   [http://www.codeproject.com/KB/system/WilsonSystemGlobalHooks.aspx](http://www.codeproject.com/KB/system/WilsonSystemGlobalHooks.aspx)（可能最有用）
*   [http://www.codeproject.com/KB/system/globalsystemhook.aspx](http://www.codeproject.com/KB/system/globalsystemhook.aspx)（另一种产生与上述类似结果的方法）
*   [http://msdn.microsoft.com/en-us/magazine/cc188966.aspx（MSDN](http://msdn.microsoft.com/en-us/magazine/cc188966.aspx)文章有一些旧代码但很好的解释）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T21:47:56.253

[pinvoke.net](http://pinvoke.net/)

这是一个很好的参考网站，用于在 .NET 应用程序中通过 PInvoke 使用 Windows API。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-29T21:44:46.103

是的，您可以通过 PInvoke 从 C# 执行此操作。Tbh，学习此类 API 的最佳方法是查看 Bblean 之类的源代码。这将向您展示您需要了解的内容，并且将其暴露给 PInvoke 非常简单。

# platform - What framework?

> ID：248434
> 
> 赞同：2
> 
> 时间：2008-10-29T21:13:54.823
> 
> 标签：platform

My friend runs a small herbal remedies business and doesn't have any software to help him do anything. I created him some spreadsheets that work in the short term, but ideally he needs a database with some forms.

He needs a basic system for inputting and tracking his orders/inventory, grouping that inventory together into herbal formulas (which are ratios of the herbs), a bit of math using the formulas, etc. It's not very complicated and all inputs could be done using basic forms.

I have drawn the basic database scheme and forms that are required, but I'm wondering what the best way to implement this is. I was thinking about using a framework like Django because it's so easy to create basic forms and has good object-relational mapping. But if I do it this way, I will have to install Django on his computer, and he'll run it through a web browser. I'd do this because HTML forms seem simple, compared to making something like a Swing GUI.

Does anybody have any suggestions? It just needs to be simple and done quickly.

Thanks.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T21:20:28.383

I'm kinda scared to suggest it, but if it's just a simple system, and they already have microsoft office, why not just use access? I'd shy away from it if you think it would grow beyond the capabilities of access, but if it's a pretty basic DB app, sounds like the easiest approach (especially if they already have the software)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T21:33:16.237

早在过去，这就是人们一直使用 Hypercard 的目的。

诚实的事实是，任何小型数据库程序（如 Access、FileMaker 或 Bento）都应该足以满足您朋友的需求，并且可能比任何针对 Web 开发的程序（如 Django）更易于维护或带有 Active Record 的 Ruby-on-Rails。

如果他使用的是 Mac，我会快速看一下[Bento](http://www.filemaker.com/products/bento/overview.html)（有一个免费演示），它不是超级复杂，但它便宜、简单、更好地与他习惯的集成，并且可能更容易他要长期维持。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T21:36:21.300

考虑到 OP 对此[答案](https://stackoverflow.com/questions/248434/what-framework#248464)的评论，为什么不是 FileMaker Pro？诚然，它会让你或你的朋友花费大约 300 美元，但它是一个桌面级数据库，（我上次检查过）并不完全糟糕，而且肯定会让你很快离开。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T21:20:48.303

A web application will do nicely for this kind of job. Installing a framework such as Django shouldn't be at all difficult. In fact, it's a matter of copying the file. Setting up a web server is the main problem and there are already some pretty neat configurations for this (e.g. XAMPP for general purpose), some even don't need any installing and can be run from a USB drive.

Now, I don't really know Django but I know that Ruby on Rails ships with an own web server that can be launched via a simple script command. Installing here is *really* a matter of copying the files and launching one script.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T21:51:44.483

对于小型企业用户来说，作为有天赋的技术朋友，最好的做法是支持和现实。企业主拥有固定数量的资源，相当于现金储备和时间。他们的业务是在他们的商店里运送货物，而不是浪费宝贵的时间来建设基础设施。

如果他有 Quickbooks，我会建议以象征性的成本（而不是那些花费大量资金）的库存管理插件。如果他没有 Quickbooks……我希望上帝他有其他一些 SOLID 会计软件。

此外，还有一些资源可用于使用 MSAccess 连接到这样的专有系统，您可能无需购买额外的软件就可以开发这些系统，但之前已经提到过。如果您走这条路，则必须在发布之前、期间和之后建立坚实的文档基础，以便您、业务所有者或未来的 PS 可以帮助业务迁移，如果业务飞速发展并且需要更多需要强大的库存控制系统。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T21:52:32.937

这真的取决于你知道什么框架/平台，听起来你知道 Django。

此外，您可能希望考虑将其构建（如果您真的需要构建自定义的东西）作为 Web 应用程序，这样他就不必安装任何东西；只需从网络浏览器使用它。而且，有很多非常实惠的托管服务提供商可供选择。例如：[GoDaddy.com 托管](http://godaddy.com)

请记住，购买一些满足他需要的现有软件包可能会更便宜。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T21:25:50.743

Hmm .. why not just a desktop DB (Access or OpenOffice equivalent)?

If there's something wrong with that, then PythonCard was originally conceived of for doing this kind of application. (Python + PythonCard (which wraps wxWindows) + SQLite )

Or even just use the browser as UI as you intended (here's an example : [http://www.mindview.net/WebLog/log-0045](http://www.mindview.net/WebLog/log-0045) )

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-29T21:29:25.150

Well, you will have to decide what suits you/him best. Django is nice, you may also want to check out codeigniter php framework, or even .NET that may run as a standalone application.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-29T21:32:58.093

我没用过，不过DabbleDB的功能看起来不错。 [http://www.dabbledb.com/](http://www.dabbledb.com/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-29T22:00:25.370

看来您需要一个简单的客户端服务器解决方案。

带有 MS Access DB 的 Visual Basic 将是一个不错的选择。

然而，随着系统开始呼吸，软件需求变得雄心勃勃的情况并不少见。[特别是当业务增长时]

我会推荐 3 层基于 Web 的解决方案。为了保持可扩展性，这是我的建议

HTML/JavaScript ]-----[ ApacheTomcat(JSP) / IIS(ASP) ]-----[ MS Access

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-29T22:02:55.207

带有 SQLite 数据库的 .NET Windows 窗体应用程序。使用 subsonic 或类似的东西来生成数据库访问代码（subsonic 支持 SQLite）。通常，.NET 为您提供了一些快速的开发和强大的功能。SQLite 是一个不需要安装的数据库引擎，并且有提供完整 ADO 支持的 .NET 项目。

我不会将 Access 用于任何事情。最终，假设您朋友的业务增长，应用程序的需求也会增长。维护了一些旧的 Access 97 应用程序后，我不推荐它。

对我来说，Access 只适合作为报告/查询工具——不适用于应用程序开发。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-29T22:12:07.640

记住这一点 - 如果它已经很好，为什么还要建造一个更好的捕鼠器。并建造！？Saleesforce.com, SugarCRM, Compiere CRM (over kill IMO), Goldmine, 等等...

如果有现成的东西有效，而你又不想竞争，为什么不提供呢！？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-29T22:51:48.480

为什么不直接买现成的东西？周围有很多便宜的订单、库存、库存控制类型的系统。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-08-20T18:12:09.587

我建议你看看[Viravis](http://www.viravis.com "在线数据库应用平台")。它可以帮助您快速轻松地开发您想要的应用程序。

# asp.net - ASP.NET 将原始 HTML 解析为控件

> ID：248437
> 
> 赞同：3
> 
> 时间：2008-10-29T21:14:13.077
> 
> 标签：asp.net

是否可以在 ASP.NET 中获取包含一些 HTML 的字符串并让 ASP.NET 解析它并为我创建一个控件？例如：

```
string rawHTML = "<table><td><td>Cell</td></tr></table>";
HTMLTable table = MagicClass.ParseTable(rawHTML); 
```

我知道这是一件坏事，但不幸的是，这确实是我能够实现我需要的唯一方法（因为我无法修改这个特定同事的代码）。

另外，我知道 LiteralControl 允许您在其中拥有一个带有任意 HTML 的控件，但不幸的是，我需要将它们转换为适当的控件。

不幸的是，HTMLTable 不支持 InnerHTML 属性。我需要完全保留 HTML 树，所以我不能将它放入`<div>`标签中。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T21:43:47.587

我认为你会得到最接近的是[Page.ParseControl](http://msdn.microsoft.com/en-us/library/kz3ffe28.aspx)，它是 ASP.NET 解析器。缺点是你拥有的文本*是*一个 LiteralControl，因为它没有 runat="server" - 所以你会事先做一点点字符串操作。

换句话说：

```
this.ParseControl("<table><tr><td>Cell</td></tr></table>") 
```

将产生：

```
Control
 LiteralControl 
```

然而：

```
this.ParseControl("<table runat=\"server\"><tr><td>Cell</td></tr></table>") 
```

将产生：

```
Control
 HtmlTable
  HtmlTableRow
   HtmlTableCell
    LiteralControl 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T21:20:20.597

您可以一次遍历 HTML 字符串一个标记（此处的标记定义为 HTML Element 或 HTML InnerText），并确定需要实例化哪些控件以及它需要哪些属性。但是，那将是非常……邪恶的写作。

为什么你需要它成为一个“适当的”控件而不是文字控件内的文本？

# .net - Windows 窗体 - 多个事件循环

> ID：248449
> 
> 赞同：7
> 
> 时间：2008-10-29T21:17:05.613
> 
> 标签：.net, winforms

我有一个可以同时打开多个文档的 Windows 窗体 (.NET) 应用程序。

让每个文档（表单）运行自己的事件循环会很方便。通过简短的实验，在他们自己的 STA 线程中启动几个事件循环似乎可以工作。有什么理由说明这是一个坏主意吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T14:56:57.690

我认为在不同的线程上创建多个消息循环是非常好的。唯一需要注意的是在处理 3rd 方 UI 工具包时，它们有时将句柄存储为静态（而不是 ThreadStatic）成员，如果您的应用程序中有多个 UI 线程，它会出现问题（在我的情况下，我发现菜单/工具栏键盘加速器无法正常工作）。

这样做的一个重要原因是，如果您有显示在不同无模式对话框上的模式对话框。如果您将所有内容放在同一个消息循环中，那么如果其中一个无模式对话框具有模态对话框，则整个应用程序（所有窗口）都会被阻止，直到您关闭模态对话框。

而且，就像凯文所说的那样，注意跨窗口（跨线程）调用。您可以使用 Control.BeginInvoke 或 Control.Invoke 在其他 UI 线程上发布委托调用。

要考虑的另一件事是您将如何退出您的流程。您很可能需要跟踪消息循环，以便在您想要关闭所有内容时停止它们。如果您不关心并且只想在所有窗口关闭时结束该过程，您也可以这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T21:36:55.760

使用 MDI（多文档界面）容器和子表单可能更聪明。在这种情况下，每个文档都有自己的形式，这在技术上意味着每个文档都有自己的消息队列。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T21:20:19.927

请小心从线程中访问 GUI 元素。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T21:24:08.407

无模式表单可能更适合您的目的。使用 form.Show() 而不是 form.ShowDialog()。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T22:53:52.720

为什么你认为你需要不止一个消息循环？一个消息循环可以处理任意数量的窗口。

如果您发现在一个窗口中长时间运行的操作能够挂起整个应用程序，那么答案是将长时间运行的工作拆分为[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.drawing.printing.aspx)之类的东西，让 UI 响应。

使用多个线程进行编程，每个线程都有自己的 UI，要复杂得多，因为一个线程无法访问从另一个线程创建的窗口和控件。

# asp.net - Authenticating a Web Service

> ID：248459
> 
> 赞同：0
> 
> 时间：2008-10-29T21:19:34.423
> 
> 标签：asp.net, authentication, ssl, service

We are deploying our ASP.NET 3.5 app to a production server for beta testing.

Each page is secured using SSL.

On our homepage (default.aspx) we have web services which populate flash objects.

I am getting an error:

The HTTP request is unauthorized with client authentication scheme 'Anonymous'. The authentication header received from the server was 'Negotiate,NTLM'.

Also, when using firefox, receive the Windows Login pop up screen.

Does anyone have any clue what or why this is happening?

Much thanks!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T00:42:18.397

我认为从 Flash 到安全 Web 服务的请求没有凭据，或者无法验证响应中的安全证书。

大概两者兼而有之。

所以在闪存中可能需要一些代码，例如：

```
request.Username = "xyz"
request.Password = "***" 
```

或类似的东西

在 .net 中有一种方法可以手动覆盖对请求的证书验证。我不确定你会如何在 Flash 中做到这一点。

如果我找到 .net 方式的示例，我会更新它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T21:31:23.867

Sounds like IIS isn't configured for [anonymous access](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/9ded7af2-fcb7-4ed2-b007-e19f971f6e13.mspx?mfr=true).

If you believe you have it setup correctly (sounds like it isn't), then you might try troubleshooting your connection with [Wfetch](http://support.microsoft.com/kb/284285).

# state - 设计或绘制状态的好方法是什么？

> ID：248460
> 
> 赞同：1
> 
> 时间：2008-10-29T21:19:41.193
> 
> 标签：state, diagram, dataflow-diagram

促使我提出这个问题的问题是一个 Web 表单，它没有按照我预期的方式保存数据。这很模糊，但重点是，您喜欢对状态、数据流等进行建模吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T21:25:31.727

我将支持白板答案并补充说解释*应该*发生的事情，然后用语言描述代码*实际*在做什么，以及基本图形对任何项目都非常有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T21:29:08.303

白板也是如此，但要熟悉 UML 图。我对序列图很幸运——它们很好地描述了系统各部分之间的交互。

我见过人们使用状态图，但它们没有包含那么多详细的信息——当我第一次看到序列图时，它们给我留下了深刻的印象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T21:36:31.157

UML 有 2 个图表可能有用

用于建模状态的状态[图。](http://www.agilemodeling.com/artifacts/stateMachineDiagram.htm)

用于建模数据流的[活动图。](http://www.agilemodeling.com/style/activityDiagram.htm)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T21:20:21.487

我会给出我明显的（对我来说）答案，那就是使用白板。喜欢白板。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T21:29:41.797

[Graphviz](http://graphviz.org)是一个用于绘制状态机图表的好工具（一旦你在白板上完成了它们）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T21:33:42.287

我认为典型的模型工作正常：

例如 - 状态图

[http://en.wikipedia.org/wiki/State_diagram](http://en.wikipedia.org/wiki/State_diagram)

我支持白板的使用。他们在状态、流程等方面的工作是首屈一指的。

# bash - Bash 脚本，匹配日期？

> ID：248470
> 
> 赞同：2
> 
> 时间：2008-10-29T21:24:39.857
> 
> 标签：bash, unix, shell, scripting

我正在编写一个脚本来删除一些超过 1 周的构建工件。

这些文件的名称格式为*artifact-1.1-200810391018.exe*。

如何仅删除超过 1 周的文件，不包括日期时间戳末尾的小时和分钟时间？

目前它正在删除目录中的所有文件。

```
#!/bin/sh

NIGHTLY_LOCATIONS=( "/foo" "/bar" )

ARTIFACT_PREFIX="artifact-*-"

NUM_TO_KEEP=7

for home in $(seq 0 $((${#NIGHTLY_LOCATIONS[@]} - 1))); do
        echo "Removing artifacts for" ${NIGHTLY_LOCATIONS[$location]}

        for file in `find ${NIGHTLY_LOCATIONS[$location]} -name "$ARTIFACT_PREFIX*"`; do

                keep=true

                for day in $(seq 0 $((${NUM_TO_KEEP} - 1))); do
                        date=`date --date="$day days ago" +%Y%m%d`

                        echo $(basename $file ".exe") " = " $ARTIFACT_PREFIX$date

                        if [ "$(basename $file ".exe")" != "$ARTIFACT_PREFIX$date" ]; then
                                keep=false
                        fi
                done

                if [ !$keep ]; then
                        echo "Removing file"
                        rm -f $file
                fi
        done done 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T21:28:11.503

你的意思是，沿着这条线的东西：

```
find /path/to/files -name "artifact*" -type f -mtime +7 -exec rm {} \; 
```

?

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T21:28:54.527

如果您信任文件的 mtime，您可以使用 find 进行简单的扫描：

```
find "${NIGHTLY_LOCATIONS}" -name $ARTIFACT_PREFIX -type f -mtime +7 -delete 
```

# php - PHP 的 session_set_save_handler 中的回调方法可以是私有的吗？

> ID：248478
> 
> 赞同：3
> 
> 时间：2008-10-29T21:26:25.967
> 
> 标签：php, class, session, scope, handler

我正在用 PHP 编写自定义会话处理程序，并尝试将 session_set_save_handler 中定义的方法设为私有。

```
session_set_save_handler(
    array('Session','open'),
    array('Session','close'),
    array('Session','read'),
    array('Session','write'),
    array('Session','destroy'),
    array('Session','gc')
); 
```

例如，我可以将 open 函数设置为私有而没有任何错误，但是当我将 write 方法设为私有时，它会向我吠叫。

> 致命错误：从第 0 行的未知上下文中调用私有方法 Session::write()

我只是想知道这是一个错误还是有办法解决这个问题。除非我当然可以将其公开，但我宁愿不公开。去年在 php.net 上有一个帖子回避了类似的事情，但只是想知道是否有人有任何想法。真的有关系吗？我在我的开发箱上使用 PHP 5.2.0，但肯定可以升级。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T22:21:36.980

他们必须是公开的。您的类将按照您在自己的代码中的方式进行实例化和调用。

所以，除非你能弄清楚如何在任何类上公开调用私有方法，否则没有 =P

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-13T17:01:59.120

将实例化对象作为回调数组的第一个参数传递。

```
$session = new Session();
session_set_save_handler(
    array($session,'open'),
    array($session,'close'),
    array($session,'read'),
    array($session,'write'),
    array($session,'destroy'),
    array($session,'gc')
); 
```

# html - IE CSS Fieldset 边框向右延伸太远：为什么？

> ID：248483
> 
> 赞同：3
> 
> 时间：2008-10-29T21:27:20.443
> 
> 标签：html, css, internet-explorer

我在 HTML 中定义了一个字段集，并对其应用了以下（简单）CSS 规则：

```
fieldset 
{
    margin: 2em 0;
    position:relative;
    padding: 1em;
    border:1px solid #ccc;
} 
```

一切都很好，没什么大不了的，除了 IE 的所有版本（嗯，据我所知最多 7 个）向右约 25 像素，超出该侧的垂直边框。

值得注意的是，当在 Firebug 中查看时，此元素的宽度导致其向右宽度方向超出其父元素。

是什么导致 IE 出现这个问题？这是一个已知问题吗？如果是，修复/破解/解决方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-03-10T06:11:24.050

我已经为此苦苦挣扎了一段时间；今晚我终于找到了答案。

[http://www.sitepoint.com/forums/showthread.php?t=526881](http://www.sitepoint.com/forums/showthread.php?t=526881)

引用娜塔莉麦克的话：

> 似乎如果字段集中有一个元素溢出到字段集的右侧，它会扩展顶部边框。我有一个容器设置为 100% 的宽度，没有 IE7 认为由于某种原因溢出的填充或边距（即使该容器内的内容是右对齐的并且在字段集的边界内可见）。
> 
> 我可以通过在字段集中添加溢出：隐藏来修复它。

我可以确认这确实也为我解决了这个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T21:35:34.420

您能否发布更多代码，例如围绕字段集的 HTML 以及相应的 CSS 规则？

您提到您可以看到它比 Firebug 中的父元素更宽。这几乎肯定是相关的。您可以更改父元素的 CSS 以使其足够宽以包含字段集吗？

如果没有更多的上下文，可能很难更准确地诊断这个......

# sql-server - 如何在 SQL Server 中将纪元时间与 24 小时前进行比较？

> ID：248501
> 
> 赞同：3
> 
> 时间：2008-10-29T21:31:46.597
> 
> 标签：sql-server, time, epoch

我正在使用 MS SQL Server 2005，我将日期存储在纪元时间（从 1970 年开始）我需要创建一个语句，该语句将影响过去 24 小时内未更新的任何记录。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T21:44:10.160

要将当前日期时间转换为纪元格式，请使用（[via](http://wiki.lessthandot.com/index.php/Epoch_Date)）：

```
SELECT DATEDIFF(s,'19700101 05:00:00:000',GETUTCDATE()) 
```

要获得现在的纪元时间 - 24 小时使用：

```
SELECT DATEDIFF(s,'19700101 05:00:00:000', DATEADD(DAY, -1, GETUTCDATE())) 
```

所以，你可以这样做：

```
DECLARE @24_hours_ago AS INT
SELECT @24_hours_ago = DATEDIFF(s,'19700101 05:00:00:000', DATEADD(DAY, -1, GETUTCDATE()))

UPDATE table SET col = value WHERE last_updated < @24_hours_ago 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T21:38:35.570

您可以通过计算自 1970 年 1 月 1 日以来经过的秒数，将 SQL Server DateTime 转换为纪元时间，如下所示。

`Select DateDiff(Second, '19700101', GetDate())`

要获取过去 24 小时内的行......

```
Select Columns
From   Table
Where  EpochColumn Between DateDiff(Second, '19700101', GetDate()) And DateDiff(Second, '19700101, GetDate()-1) 
```

# .net - .NET 中是否存在阻塞 StreamReader、TextReader 或 StringReader？

> ID：248502
> 
> 赞同：3
> 
> 时间：2008-10-29T21:31:46.783
> 
> 标签：.net, input

我想运行一个后台任务，从 TextReader 读取输入并一次处理一行。我希望后台任务阻止，直到用户在字段中键入一些文本并单击提交按钮。是否有一些 TextReader 会阻塞直到文本可用，并让您以某种方式向底层源添加更多文本？

我认为指向同一个 MemoryStream 的 StreamReader 和 StreamWriter 可能有效，但似乎没有。StreamReader 在开始时看到 MemoryStream 是空的，并且不再检查。

我意识到编写 ProcessLine() 方法并在用户单击提交按钮时调用它会更容易。但是，我正在尝试设计一个插件架构，我希望插件看起来像带有输入流和输出流的老式控制台应用程序。我希望插件的输入流只是阻塞，直到用户单击带有一些输入文本的提交按钮。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-29T22:48:46.347

似乎没有实现这一点 - 这很奇怪，因为我同意这将是一个有用的构造。但是写起来应该很简单。像这样的东西应该工作：

```
 public class BlockingStream: Stream
  {
    private readonly Stream _stream;

    public BlockingStream(Stream stream)
    {
      if(!stream.CanSeek)
        throw new ArgumentException("Stream must support seek", "stream");
      _stream = stream;
    }

    public override void Flush()
    {
      lock (_stream)
      {
        _stream.Flush();
        Monitor.Pulse(_stream);
      }
    }

    public override long Seek(long offset, SeekOrigin origin)
    {
      lock (_stream)
      {
        long res = _stream.Seek(offset, origin);
        Monitor.Pulse(_stream);
        return res;
      }
    }

    public override void SetLength(long value)
    {
      lock (_stream)
      {
        _stream.SetLength(value);
        Monitor.Pulse(_stream);
      }
    }

    public override int Read(byte[] buffer, int offset, int count)
    {
      lock (_stream)
      {
        do
        {
          int read = _stream.Read(buffer, offset, count);
          if (read > 0)
            return read;
          Monitor.Wait(_stream);
        } while (true);
      }
    }

    public override void Write(byte[] buffer, int offset, int count)
    {
      lock (_stream)
      {
        long currentPosition = _stream.Position;
        _stream.Position = _stream.Length;
        _stream.Write(buffer, offset, count);
        _stream.Position = currentPosition;
        Monitor.Pulse(_stream);
      }
    }

    public override bool CanRead
    {
      get
      {
        lock (_stream)
        {
          return _stream.CanRead;
        }
      }
    }

    public override bool CanSeek
    {
      get
      {
        lock (_stream)
        {
          return _stream.CanSeek;
        }
      }
    }

    public override bool CanWrite
    {
      get
      {
        lock (_stream)
        {
          return _stream.CanWrite;
        }
      }
    }

    public override long Length
    {
      get
      {
        lock (_stream)
        {
          return _stream.Length;
        }
      }
    }

    public override long Position
    {
      get
      {
        lock (_stream)
        {
          return _stream.Position;
        }
      }
      set
      {
        lock (_stream)
        {
          _stream.Position = value;
          Monitor.Pulse(_stream);
        }
      }
    }
  } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-29T21:50:15.500

我认为您最好在主应用程序中创建一个在用户点击提交时引发的事件。文本数据将在事件 args 中传递。每个插件都会为事件注册一个事件处理程序，并在事件引发时处理传入的数据。这允许许多插件处理来自单个提交的数据，而无需您进行大量的管道工作，这意味着插件能够闲置直到引发事件。

# mysql - MySQL 中货币的最佳数据类型是什么？

> ID：248512
> 
> 赞同：12
> 
> 时间：2008-10-29T21:34:16.250
> 
> 标签：mysql, types, currency

我想以多种货币存储价值，而且我不太热衷于浮动的不精确性。能够在查询中直接对它们进行数学运算也是一项要求。

十进制是去这里的方式吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-29T21:35:28.167

十进制是最好的方法。

您仍然可以在查询中进行数学运算。

# button - YUI 菜单位于 div 后面

> ID：248523
> 
> 赞同：2
> 
> 时间：2008-10-29T21:38:00.047
> 
> 标签：button, menu, css-position

我已经实现了一个带有菜单的 YUI 拆分按钮。带有菜单的按钮出现在页眉和页脚 div 之间的滚动 div 中。当在页脚 div 附近显示菜单时，菜单会出现在 div 后面。

我尝试使用 -1 的 z-index 定位页脚 div。我尝试使用 z-index 为 500 定位包含菜单按钮的 div（在滚动 div 内）。菜单始终出现在页脚 div 后面。

我没有使用 YUI 布局。然而。如果我这样做会有帮助吗？>

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T21:48:33.910

除了设置**z-index**属性之外，您还必须更改**position**属性。将其更改为最简单的方法是**position:relative**。

尝试设置这两个属性。

我认为 YUI 布局不会帮助您解决这个特定问题。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-24T08:46:21.193

我开始使用 YUI 布局，我的问题不再存在。

# c# - 如何有条件地抑制写入事件日志的应用程序异常？

> ID：248527
> 
> 赞同：2
> 
> 时间：2008-10-29T21:40:18.653
> 
> 标签：c#, exception, windows-services, event-log

我正在开发一项 Windows 服务，该服务每 15 秒轮询一次与启用网络的设备的连接。如果服务无法连接到设备，则会引发异常并在 15 秒后重试。所有这一切都很好。

但是，假设其中一个设备停机了一天或更长时间。我每 15 秒用相同的异常填充我的异常日志。如果抛出的异常在过去 x 小时内没有改变，是否有一种标准方法可以防止将异常写入事件日志？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T09:16:27.203

实现所需的一种好方法是使用断路器设计模式。

我第一次读到这一点是在 Michael T. Nygard 所著的“发布它！设计和部署生产就绪软件”一书中，来自 Pragmatic Press，第 104-107 页。

断路器的想法是它位于系统之间的连接路径中，通过连接，观察“中断条件”。例如，它可能仅在连续五个连接都失败时触发。

一旦电路断开，所有通过断路器的调用都会立即失败，无需咨询外部服务。这一直持续到发生超时，此时断路器进入半开状态。尝试下一次调用 - 失败导致超时被重置，断路器闭合成功并且系统恢复操作。

一个快速的谷歌发现[了蒂姆罗斯的一篇文章](http://timross.wordpress.com/2008/02/10/implementing-the-circuit-breaker-pattern-in-c/)，读起来很好，而且更详细。

在您的情况下，您可以使用超时为 10 分钟并触发 5 次故障的断路器。然后，在全天失败的情况下，您的日志文件将包含为原始问题记录的 5 个异常，然后每小时仅记录 6 个（与 15 秒间隔的 240 个相比），表明问题仍然存在。

根据您的要求，您可以包括手动“重置”断路器，或者您可以让它在 10 分钟超时显示一切恢复正常时自动重置。这可能很有用——通常系统管理员需要做的事情越少，他们就越喜欢它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T22:36:45.483

也许有一个工作流程，如果轮询失败一定次数，轮询间隔就会增加。例如，每 15 秒轮询 3 次，如果失败则将轮询间隔增加到一分钟，如果失败 n 次则将时间增加到一小时。

老实说，上面的工作流程并没有真正解决您的问题。如果我是你，我会颠倒工作流程。而不是服务器轮询设备，为什么不反过来呢？当设备连接到联网机器时，您的客户端服务会向服务器发送消息，以便服务器知道该设备已连接并处于活动状态。

希望这可以帮助...

温迪

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T22:56:07.177

如果您在应用程序中使用异常处理块，我假设您这样做，您可以在不同的异常处理策略之间切换。首先是将异常信息写入事件日志的策略，然后在 n 次尝试或时间段后，您可以切换到不记录到事件日志的策略。

增加尝试连接之间的持续时间可能会解决您的问题。例如 newTimeout = n*atomicTimeout 其中 n 是尝试次数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-12T13:22:43.833

关于什么...

```
 int count = 0;
 while (true)
 {
      try
      {
           AttemptStuff()
      }
      catch (Exception ex)
      {
           if(count < 10)
           {
                EventLog.WriteEntry("my service", ex.ToString(), EventLogEntryType.Error);
                count++;
           }
      }
 } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-17T10:45:12.053

断路器模式是个好主意，我说

查看 PHP 实现的一些设计，但可以应用于任何语言

[http://artur.ejsmont.org/blog/PHP-Circuit-Breaker-initial-Zend-Framework-proposal](http://artur.ejsmont.org/blog/PHP-Circuit-Breaker-initial-Zend-Framework-proposal)

# java - 从 Java 程序打开浏览器窗口

> ID：248534
> 
> 赞同：6
> 
> 时间：2008-10-29T21:41:13.800
> 
> 标签：java, linux, browser, x11, daemon

**问题**

我有一个用 Java 编写的应用程序。它旨在独立运行在 Linux 机器上。我正在尝试生成一个新的*Firefox*窗口。但是，*Firefox*永远不会打开。它的 shell 退出代码始终为 1。我可以使用*gnome-terminal*运行相同的代码，并且可以正常打开。

**背景**

所以，这里是它的初始化过程：

1.  启动 X "Xorg :1 -br -terminate -dpms -quiet vt7"
2.  启动窗口管理器“metacity --display=:1 --replace”
3.  配置资源“xrdb -merge /etc/X11/Xresources”
4.  成为守护进程并断开与控制终端的连接

一旦程序开始运行，用户可以单击一个按钮，该按钮应该会生成一个 firefox 窗口。这是我的代码。请记住 X 正在显示 :1 上运行。

**代码**

```
 public boolean openBrowser()
{
  try {
    Process oProc = Runtime.getRuntime().exec( "/usr/bin/firefox --display=:1" );
    int bExit = oProc.waitFor();  // This is always 1 for some reason

    return true;

  } catch ( Exception e ) {
    oLogger.log( Level.WARNING, "Open Browser", e );
    return false;
  }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-29T21:47:30.013

如果可以将范围缩小到 Java 6，则可以使用桌面 API：

[http://java.sun.com/developer/technicalArticles/J2SE/Desktop/javase6/desktop_api/](http://java.sun.com/developer/technicalArticles/J2SE/Desktop/javase6/desktop_api/)

应该看起来像：

```
 if (Desktop.isDesktopSupported()) {
        Desktop desktop = Desktop.getDesktop();
        if (desktop.isSupported(Desktop.Action.BROWSE)) {
            try {
                desktop.browse(new URI("http://localhost"));
            }
            catch(IOException ioe) {
                ioe.printStackTrace();
            }
            catch(URISyntaxException use) {
                use.printStackTrace();
            }
        }
    } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T22:07:00.957

使用[BrowserLauncher](http://browserlaunch2.sourceforge.net/)。

调用它很容易，去吧

```
new BrowserLauncher().openURLinBrowser("http://www.google.com"); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T03:03:50.950

在阅读了各种答案和各种评论（来自提问者）之后，这就是我要做的

1）尝试这种java方法 [http://java.sun.com/j2se/1.5.0/docs/api/java/lang/ProcessBuilder.html](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/ProcessBuilder.html)

```
ProcessBuilder pb = new ProcessBuilder("myCommand", "myArg1", "myArg2");
Map<String, String> env = pb.environment();
env.put("VAR1", "myValue");
env.remove("OTHERVAR");
env.put("VAR2", env.get("VAR1") + "suffix");
pb.directory("myDir");
Process p = pb.start(); 
```

查看更多关于这个类：

[http://java.sun.com/developer/JDCTechTips/2005/tt0727.html#2](http://java.sun.com/developer/JDCTechTips/2005/tt0727.html#2)
[http://www.javabeat.net/tips/8-using-the-new-process-builder-class.html](http://www.javabeat.net/tips/8-using-the-new-process-builder-class.html)

2) 尝试从 C/C++/ruby/python 执行此操作（启动 firefox），看看是否成功。

3）如果一切都失败了，我会启动一个shell程序，那个shell程序会启动firefox！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T22:04:21.493

如果您阅读并显示标准输出/错误流，您可能会有更好的运气，这样您就可以捕捉到 firefox 可能打印的任何错误消息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-12T08:52:40.347

```
try {
     String url = "http://www.google.com";
     java.awt.Desktop.getDesktop().browse(java.net.URI.create(url));
} catch (java.io.IOException e) {
     System.out.println(e.getMessage());
} 
```

# asp.net - 使用 StateServer 时如何查找活动用户数

> ID：248535
> 
> 赞同：4
> 
> 时间：2008-10-29T21:41:52.067
> 
> 标签：asp.net, stateserver

使用 StateServer 时如何找出活跃用户的数量？也可以查询 StateServer 并检索 Session State 中的内容吗？

我知道如果您使用 SqlServer 作为后备存储，这一切都是可能的，但我希望它们在内存中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-01-20T21:53:36.427

状态服务器中的活动*会话*数可以通过运行状态服务器的服务器上的性能计数器轻松查看。这并不直接等同于活跃用户（由于会话超时时间）

活动会话的计数器是：“Asp.net”-“状态服务器会话活动”

作为参考，这里是所有与状态服务器相关的性能计数器，来自[http://msdn.microsoft.com/en-us/library/fxk122b4.aspx](http://msdn.microsoft.com/en-us/library/fxk122b4.aspx)

**State Server Sessions Abandoned** 已明确放弃的用户会话数。这些是由特定用户操作（例如关闭浏览器或导航到另一个站点）结束的会话。此计数器仅在运行状态服务器服务 (aspnet_state) 的计算机上可用。

**State Server Sessions Active** 当前活动的用户会话数。此计数器仅在运行状态服务器服务 (aspnet_state) 的计算机上可用。

**State Server Sessions Timed Out** 由于用户不作为而变为非活动状态的用户会话数。此计数器仅在运行状态服务器服务 (aspnet_state) 的计算机上可用。

**State Server Sessions Total** 在进程生命周期内创建的会话数。此计数器是 State Server Sessions Active、State Server Sessions Abandoned 和 State Server Sessions Timed Out 的总值。此计数器仅在运行状态服务器服务 (aspnet_state) 的计算机上可用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T22:33:25.270

跟踪用户数量需要在应用程序级别完成，而不是会话级别。

您应该能够通过以下内容查看当前会话中的内容：

```
StringBuilder builder = new StringBuilder();
foreach ( String key in Session.Contents ) {
    builder.AppendFormat("{0}: {1}<br />", key, Session[key]);
}
Response.Write(builder.ToString()); 
```

# .net - 使用 WCF MSMQ 的观察者模式

> ID：248541
> 
> 赞同：3
> 
> 时间：2008-10-29T21:43:46.823
> 
> 标签：.net, wcf, msmq, observer-pattern

MSMQ 携带的消息是否可以有多个侦听器？

WCF 似乎在服务方面构建了一切，使通信成为点对点事务。我想使用消息队列来缓冲另一个进程的传入流量，该进程在数据库中记录日志。

可能有任何数量的其他进程对监视传入流量感兴趣，这肯定需要观察者模式，但我看不出如何表达观察者模式，至少不通过 WCF 使用 MSMQ。

谁能给我建议？

* * *

关于我为什么关心的一些背景，这也可能有助于说明问题：我有一个 Windows 服务，它接受来自现场小黑盒的连接请求。它设置套接字，黑匣子发送描述事件的消息，并在时间和空间上用 GPS 位置进行注释。

我从套接字流中解析消息包，并通过 MSMQ 将它们发送到另一个过滤重复数据包并将数据包写入数据库表的进程。

任何数量的后处理都将受益于响应传入流量的增量计算，并且用户工具也会执行用户通知以响应传入流量。

所以，我真的很想让一个进程发送消息，而几个进程接收它们。其中一个接收器负责解析数据包内容并将消息转录到数据库中；这显然是最终从队列中删除消息的责任的候选者，但问题是如何确保这是处理消息的最后一个处理程序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T21:56:55.453

我不相信 MSMQ 被适当地设计为自行处理这种情况。您只能对消息执行 2 件事 - Peek() 或 Get()。AFAIK，没有很好的方法来跟踪消息是否已被所有处理程序处理。

可能的工作是让您转录消息的过程成为被观察者，并在转录消息并写入数据库之前将消息发布（可能使用 .NET 事件架构）给所有感兴趣的观察者。这将保证所有感兴趣的观察者都能看到消息，并且消息会被适当地写入数据库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-01-24T21:15:34.853

我认为您需要一个[Publish-Subscribe Channel](http://www.enterpriseintegrationpatterns.com/PublishSubscribeChannel.html)：

> **发送者如何向所有感兴趣的接收者广播事件？** *在 Publish-Subscribe Channel 上发送事件，该通道将特定事件的副本传递给每个接收者。*
> 
> Publish-Subscribe Channel 的工作原理如下：它有一个输入通道，该通道分为多个输出通道，每个订阅者一个。当事件发布到通道中时，发布-订阅通道将消息的副本传递到每个输出通道。每个输出通道只有一个订阅者，只允许使用一次消息。这样，每个订阅者只收到一次消息，并且消费的副本从他们的频道中消失。

此模式由[MassTransit](http://docs.masstransit-project.com/en/latest/#)和[NServiceBus](http://nservicebus.com/)在 MSMQ 之上实现。

# wpf - 列表框项目的 DataTemplate 中 IsSelected 的 WPF 触发器

> ID：248545
> 
> 赞同：59
> 
> 时间：2008-10-29T21:44:26.510
> 
> 标签：wpf, triggers, listbox, itemtemplate, event-triggers

我有一个列表框，并且我有以下 ItemTemplate ：

```
<DataTemplate x:Key="ScenarioItemTemplate">
    <Border Margin="5,0,5,0"
            Background="#FF3C3B3B"
            BorderBrush="#FF797878"
            BorderThickness="2"
            CornerRadius="5">
        <DockPanel>
            <DockPanel DockPanel.Dock="Top"
                       Margin="0,2,0,0">
                <Button HorizontalAlignment="Left"
                        DockPanel.Dock="Left"
                        FontWeight="Heavy"
                        Foreground="White" />
                <Label Content="{Binding Path=Name}"
                       DockPanel.Dock="Left"
                       FontWeight="Heavy"
                       Foreground="white" />
                <Label HorizontalAlignment="Right"
                       Background="#FF3C3B3B"
                       Content="X"
                       DockPanel.Dock="Left"
                       FontWeight="Heavy"
                       Foreground="White" />
            </DockPanel>
            <ContentControl Name="designerContent"
                            Visibility="Collapsed"
                            MinHeight="100"
                            Margin="2,0,2,2"
                            Content="{Binding Path=DesignerInstance}"
                            Background="#FF999898">
            </ContentControl>
        </DockPanel>
    </Border>
</DataTemplate> 
```

如您所见，ContentControl 将 Visibility 设置为折叠。

我需要定义一个触发器，导致可见性设置为“可见”

选择 ListItem 时，但我无法弄清楚。

有任何想法吗？

更新：当然，我可以简单地复制 DataTemplate 并将触发器添加到有问题的 ListBox 以使用其中一个或另一个，但我想防止复制此代码。

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2008-10-29T21:58:49.273

您可以设置 ContentControl 的样式，以便在其容器（ListBoxItem）被选中时触发触发器：

```
<ContentControl 
    x:Name="designerContent"
    MinHeight="100"
    Margin="2,0,2,2"
    Content="{Binding Path=DesignerInstance}"
    Background="#FF999898">
    <ContentControl.Style>
        <Style TargetType="{x:Type ContentControl}">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
                <DataTrigger
                        Binding="{Binding
                            RelativeSource={RelativeSource
                                Mode=FindAncestor,
                                AncestorType={x:Type ListBoxItem}},
                                Path=IsSelected}"
                        Value="True">
                    <Setter Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </ContentControl.Style>
</ContentControl> 
```

或者，我认为您可以将触发器添加到模板本身并按名称引用控件。我不太了解这种技术，无法从内存中输入它并假设它会起作用，但它是这样的：

```
<DataTemplate x:Key="ScenarioItemTemplate">
    <DataTemplate.Triggers>
        <DataTrigger
                Binding="{Binding
                    RelativeSource={RelativeSource
                        Mode=FindAncestor,
                        AncestorType={x:Type ListBoxItem}},
                        Path=IsSelected}"
                Value="True">
            <Setter
                TargetName="designerContent"
                Property="Visibility"
                Value="Visible"/>
        </DataTrigger>
    </DataTemplate.Triggers>

    ...
</DataTemplate> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T22:14:56.823

@马特，谢谢！！！

只需为 IsSelected == false 添加一个触发器，现在它就像一个魅力！

```
<ContentControl.Style>
<Style TargetType="{x:Type ContentControl}">
    <Setter Property="Visibility" Value="Collapsed"/>
    <Style.Triggers>
        <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ListBoxItem}},Path=IsSelected}" Value="True">
            <Setter Property="Visibility" Value="Visible"/>
        </DataTrigger>
        <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=FindAncestor,AncestorType={x:Type ListBoxItem}},Path=IsSelected}" Value="False">
            <Setter Property="Visibility" Value="Collapsed"/>
        </DataTrigger>
    </Style.Triggers>
</Style> 
```

# sql - LinqToSQL 不更新数据库

> ID：248557
> 
> 赞同：2
> 
> 时间：2008-10-29T21:49:24.987
> 
> 标签：sql, linq, linq-to-sql

```
// goal: update Address record identified by "id", with new data in "colVal"

string cstr = ConnectionApi.GetSqlConnectionString("SwDb"); // get connection str
using (DataContext db = new DataContext(cstr)) {
    Address addr = (from a in db.GetTable<Address>()
                    where a.Id == id
                    select a).Single<Address>();
    addr.AddressLine1 = colValue.Trim();
    db.SubmitChanges(); // this seems to have no effect!!!
} 
```

在调试器中，addr 具有 db 表中的所有当前值，并且我可以在调用 db.SubmitChanges() 之前验证 AddressLine1 是否已更改... SQL Profiler 在 SubmitChanges 行执行时仅显示“重置连接”。任何人都知道为什么这不起作用？谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-29T22:00:11.813

您可以使用[GetChangeSet](http://msdn.microsoft.com/en-us/library/bb882650.aspx)方法快速查看要提交的更改。

还要确保您的表定义了一个主键，并且映射知道这个主键。否则您将无法执行更新。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T16:27:12.797

好的，这是结果。我不能使用 db.Address 表单，因为我没有使用设计器来创建我的数据库对象，而是将它们定义为如下类：

```
[Table(Name = "Addresses")]
public class Address
{
    [Column(Name = "Id",IsPrimaryKey=true)]
     public int Id { get; set; }
    [Column(Name = "AddressLine1")]
    public string AddressLine1 { get; set; }
        ... 
```

最初，我没有在数据库中将“Id”列设置为 PK，也没有在上面的 [Column...] 说明符中使用 IsPrimaryKey=true 对其进行标识。两者都是必需的！一旦我进行了更改，ChangeSet 找到了我想做的更新，并做了，但在此之前它告诉我需要更新 0 行并拒绝提交更改。

谢谢你的帮助！——S。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T22:01:51.997

有趣的是，使用 GetTable 和 Single。我本来希望代码看起来像这样：

```
string cstr = ConnectionApi.GetSqlConnectionString("SwDb"); // get connection str
using (DataContext db = new DataContext(cstr)) 
{    
  Address addr = (from a in db.Address where a.Id == id select a).Single();    
  addr.AddressLine1 = colValue.Trim();    
  db.SubmitChanges(); // this seems to have no effect!!!
} 
```

我不知道 GetTable 会对你做什么。

另一件事，调试 Linq2SQL 尝试添加

```
db.Log = Console.Out; 
```

在 SubmitChanges() 之前，这将向您显示执行的 SQL。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T14:22:26.417

谢谢 - 你的评论将帮助我解决这个问题，我敢肯定！我没有将“Id”列定义为 PrimaryKey，所以这显然不是首发。我原以为更新失败时 LinqToSQL 会抛出错误。——S。

# java - 使用 Spring Security 时，在 bean 中获取当前用户名（即 SecurityContext）信息的正确方法是什么？

> ID：248562
> 
> 赞同：301
> 
> 时间：2008-10-29T21:50:17.637
> 
> 标签：java, spring, spring-mvc, spring-security

我有一个使用 Spring Security 的 Spring MVC Web 应用程序。我想知道当前登录用户的用户名。我正在使用下面给出的代码片段。这是公认的方式吗？

我不喜欢在这个控制器中调用静态方法——这违背了 Spring 的全部目的，恕我直言。有没有办法将应用程序配置为注入当前的 SecurityContext 或当前的身份验证？

```
 @RequestMapping(method = RequestMethod.GET)
  public ModelAndView showResults(final HttpServletRequest request...) {
    final String currentUser = SecurityContextHolder.getContext().getAuthentication().getName();
    ...
  } 
```

* * *

## 回答 #1

> 赞同：270
> 
> 时间：2011-03-18T12:14:49.503

如果您使用的是[Spring 3](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/mvc.html#mvc-ann-requestmapping-arguments)，最简单的方法是：

```
 @RequestMapping(method = RequestMethod.GET)   
 public ModelAndView showResults(final HttpServletRequest request, Principal principal) {

     final String currentUser = principal.getName();

 } 
```

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2009-05-19T21:40:09.747

自从回答了这个问题以来，Spring 世界发生了很多变化。Spring 简化了在控制器中获取当前用户的过程。对于其他bean，Spring采纳了作者的建议，简化了'SecurityContextHolder'的注入。更多细节在评论中。

* * *

这是我最终采用的解决方案。我不想在我的控制器中使用`SecurityContextHolder`，而是想注入一些`SecurityContextHolder`在引擎盖下使用但从我的代码中抽象出类似单例的类的东西。除了滚动我自己的界面之外，我发现没有其他方法可以做到这一点，如下所示：

```
public interface SecurityContextFacade {

  SecurityContext getContext();

  void setContext(SecurityContext securityContext);

} 
```

现在，我的控制器（或任何 POJO）将如下所示：

```
public class FooController {

  private final SecurityContextFacade securityContextFacade;

  public FooController(SecurityContextFacade securityContextFacade) {
    this.securityContextFacade = securityContextFacade;
  }

  public void doSomething(){
    SecurityContext context = securityContextFacade.getContext();
    // do something w/ context
  }

} 
```

而且，由于接口是解耦点，单元测试很简单。在此示例中，我使用 Mockito：

```
public class FooControllerTest {

  private FooController controller;
  private SecurityContextFacade mockSecurityContextFacade;
  private SecurityContext mockSecurityContext;

  @Before
  public void setUp() throws Exception {
    mockSecurityContextFacade = mock(SecurityContextFacade.class);
    mockSecurityContext = mock(SecurityContext.class);
    stub(mockSecurityContextFacade.getContext()).toReturn(mockSecurityContext);
    controller = new FooController(mockSecurityContextFacade);
  }

  @Test
  public void testDoSomething() {
    controller.doSomething();
    verify(mockSecurityContextFacade).getContext();
  }

} 
```

接口的默认实现如下所示：

```
public class SecurityContextHolderFacade implements SecurityContextFacade {

  public SecurityContext getContext() {
    return SecurityContextHolder.getContext();
  }

  public void setContext(SecurityContext securityContext) {
    SecurityContextHolder.setContext(securityContext);
  }

} 
```

最后，生产 Spring 配置如下所示：

```
<bean id="myController" class="com.foo.FooController">
     ...
  <constructor-arg index="1">
    <bean class="com.foo.SecurityContextHolderFacade">
  </constructor-arg>
</bean> 
```

看起来有点傻，Spring，一个所有东西的依赖注入容器，没有提供一种注入类似东西的方法。我知道`SecurityContextHolder`是从 acegi 继承的，但仍然如此。问题是，它们是如此接近——如果只有`SecurityContextHolder`一个 getter 来获取底层`SecurityContextHolderStrategy`实例（这是一个接口），你就可以注入它。事实上，我什至为此[打开了一个 Jira 问题](http://jira.springsource.org/browse/SEC-1188)。

最后一件事 - 我刚刚大大改变了我之前在这里的答案。如果您好奇，请查看历史记录，但正如一位同事向我指出的那样，我之前的答案在多线程环境中不起作用。默认情况下，`SecurityContextHolderStrategy`使用的底层是 的实例，它将s 存储在 a 中。因此，在初始化时直接将 bean 注入 bean 不一定是一个好主意-在多线程环境中，可能需要每次都从 bean 中检索它，因此检索到正确的。`SecurityContextHolder``ThreadLocalSecurityContextHolderStrategy``SecurityContext``ThreadLocal``SecurityContext``ThreadLocal`

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-01-26T16:57:37.383

我同意必须查询当前用户的 SecurityContext 很臭，这似乎是一种非常非 Spring 的方式来处理这个问题。

我写了一个静态的“助手”类来处理这个问题；这很脏，因为它是一种全局和静态方法，但我认为如果我们更改与安全性相关的任何内容，至少我只需要在一个地方更改细节：

```
/**
* Returns the domain User object for the currently logged in user, or null
* if no User is logged in.
* 
* @return User object for the currently logged in user, or null if no User
*         is logged in.
*/
public static User getCurrentUser() {

    Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal()

    if (principal instanceof MyUserDetails) return ((MyUserDetails) principal).getUser();

    // principal object is either null or represents anonymous user -
    // neither of which our domain User object can represent - so return null
    return null;
}

/**
 * Utility method to determine if the current user is logged in /
 * authenticated.
 * <p>
 * Equivalent of calling:
 * <p>
 * <code>getCurrentUser() != null</code>
 * 
 * @return if user is logged in
 */
public static boolean isLoggedIn() {
    return getCurrentUser() != null;
} 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2012-03-18T23:58:04.707

要使其仅显示在您的 JSP 页面中，您可以使用 Spring Security Tag Lib：

[http://static.springsource.org/spring-security/site/docs/3.0.x/reference/taglibs.html](http://static.springsource.org/spring-security/site/docs/3.0.x/reference/taglibs.html)

要使用任何标签，您必须在 JSP 中声明安全标签库：

```
<%@ taglib prefix="security" uri="http://www.springframework.org/security/tags" %> 
```

然后在一个jsp页面中做这样的事情：

```
<security:authorize access="isAuthenticated()">
    logged in as <security:authentication property="principal.username" /> 
</security:authorize>

<security:authorize access="! isAuthenticated()">
    not logged in
</security:authorize> 
```

注意：正如@SBerg413 评论中提到的，您需要添加

> 使用表达式=“真”

到 security.xml 配置中的“http”标签以使其正常工作。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2016-05-25T19:32:56.440

如果您使用的是 Spring Security ver >= 3.2，则可以使用`@AuthenticationPrincipal`注解：

```
@RequestMapping(method = RequestMethod.GET)
public ModelAndView showResults(@AuthenticationPrincipal CustomUser currentUser, HttpServletRequest request) {
    String currentUsername = currentUser.getUsername();
    // ...
} 
```

在这里，`CustomUser`是一个自定义对象，它实现`UserDetails`了由 custom 返回`UserDetailsService`。

更多信息可以在Spring Security 参考文档的[@AuthenticationPrincipal章节中找到。](http://docs.spring.io/spring-security/site/docs/4.0.x/reference/htmlsingle/#mvc-authentication-principal)

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2010-07-08T03:34:38.653

我通过 HttpServletRequest.getUserPrincipal(); 获得了经过身份验证的用户；

例子：

```
import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.web.authentication.preauth.RequestHeaderAuthenticationFilter;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.servlet.support.RequestContext;

import foo.Form;

@Controller
@RequestMapping(value="/welcome")
public class IndexController {

    @RequestMapping(method=RequestMethod.GET)
    public String getCreateForm(Model model, HttpServletRequest request) {

        if(request.getUserPrincipal() != null) {
            String loginName = request.getUserPrincipal().getName();
            System.out.println("loginName : " + loginName );
        }

        model.addAttribute("form", new Form());
        return "welcome";
    }
} 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2014-04-02T21:23:23.940

在 Spring 3+ 中，您有以下选项。

选项1 ：

```
@RequestMapping(method = RequestMethod.GET)    
public String currentUserNameByPrincipal(Principal principal) {
    return principal.getName();
} 
```

选项 2：

```
@RequestMapping(method = RequestMethod.GET)
public String currentUserNameByAuthentication(Authentication authentication) {
    return authentication.getName();
} 
```

选项 3：

```
@RequestMapping(method = RequestMethod.GET)    
public String currentUserByHTTPRequest(HttpServletRequest request) {
    return request.getUserPrincipal().getName();

} 
```

选项 4：花式一个：[查看此以获取更多详细信息](https://stackoverflow.com/a/8769670/286588)

```
public ModelAndView someRequestHandler(@ActiveUser User activeUser) {
  ...
} 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2010-04-01T19:44:15.950

我会这样做：

```
request.getRemoteUser(); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2010-02-04T13:03:56.047

是的，静态通常很糟糕 - 通常，但在这种情况下，静态是您可以编写的最安全的代码。由于安全上下文将 Principal 与当前运行的线程相关联，因此最安全的代码将尽可能直接地从线程访问静态。将访问隐藏在注入的包装类后面，为攻击者提供了更多攻击点。他们不需要访问代码（如果 jar 已签名，他们将很难更改代码），他们只需要一种覆盖配置的方法，这可以在运行时完成或将一些 XML 滑入类路径。即使在签名代码中使用注解注入也可以被外部 XML 覆盖。此类 XML 可能会向正在运行的系统注入恶意主体。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-30T23:08:59.380

对于我编写的最后一个 Spring MVC 应用程序，我没有注入 SecurityContext 持有者，但我确实有一个基本控制器，我有两个与此相关的实用方法... isAuthenticated() 和 getUsername()。在内部，他们执行您描述的静态方法调用。

至少，如果您以后需要重构，它只会出现一次。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-31T13:03:48.037

您可以使用 Spring AOP 方法。例如，如果您有一些服务，则需要知道当前的委托人。您可以引入自定义注释，即 @Principal ，这表明该服务应该依赖于主体。

```
public class SomeService {
    private String principal;
    @Principal
    public setPrincipal(String principal){
        this.principal=principal;
    }
} 
```

然后在我认为需要扩展 MethodBeforeAdvice 的建议中，检查特定服务是否具有 @Principal 注释并注入 Principal 名称，或者将其设置为“ANONYMOUS”。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-29T07:41:18.860

唯一的问题是，即使在使用 Spring Security 进行身份验证后，容器中也不存在用户/主体 bean，因此依赖注入将很困难。在我们使用 Spring Security 之前，我们将创建一个具有当前 Principal 的会话范围 bean，将其注入到“AuthService”中，然后将该服务注入到应用程序中的大多数其他服务中。所以这些服务只需调用 authService.getCurrentUser() 来获取对象。如果您的代码中有一个位置可以在会话中获得对同一主体的引用，则可以简单地将其设置为会话范围 bean 上的属性。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-12-09T05:06:01.467

如果您使用 Spring 3 并且需要控制器中经过身份验证的主体，最好的解决方案是执行以下操作：

```
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.userdetails.User;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;

    @Controller
    public class KnoteController {
        @RequestMapping(method = RequestMethod.GET)
        public java.lang.String list(Model uiModel, UsernamePasswordAuthenticationToken authToken) {

            if (authToken instanceof UsernamePasswordAuthenticationToken) {
                user = (User) authToken.getPrincipal();
            }
            ...

    } 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-11-18T09:00:36.347

试试这个

> 身份验证身份验证 = SecurityContextHolder.getContext().getAuthentication();
> String userName = authentication.getName();

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-07-30T23:40:27.670

我`@AuthenticationPrincipal`在类和带注释的`@Controller`类中`@ControllerAdvicer`使用注释。前任。：

```
@ControllerAdvice
public class ControllerAdvicer
{
    private static final Logger LOGGER = LoggerFactory.getLogger(ControllerAdvicer.class);

    @ModelAttribute("userActive")
    public UserActive currentUser(@AuthenticationPrincipal UserActive currentUser)
    {
        return currentUser;
    }
} 
```

我用于登录用户服务的类在哪里`UserActive`，并从`org.springframework.security.core.userdetails.User`. 就像是：

```
public class UserActive extends org.springframework.security.core.userdetails.User
{

    private final User user;

    public UserActive(User user)
    {
        super(user.getUsername(), user.getPasswordHash(), user.getGrantedAuthorities());
        this.user = user;
    }

     //More functions
} 
```

真的很容易。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-11-10T11:29:11.713

在您的控制器方法中定义`Principal`为依赖项，spring 将在调用时将当前经过身份验证的用户注入您的方法中。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2013-06-29T15:35:05.813

我喜欢在 freemarker 页面上分享我支持用户详细信息的方式。一切都非常简单并且工作完美！

您只需在`default-target-url`（表单登录后的页面）上放置身份验证重新请求这是我对该页面的 Controler 方法：

```
@RequestMapping(value = "/monitoring", method = RequestMethod.GET)
public ModelAndView getMonitoringPage(Model model, final HttpServletRequest request) {
    showRequestLog("monitoring");

    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
    String userName = authentication.getName();
    //create a new session
    HttpSession session = request.getSession(true);
    session.setAttribute("username", userName);

    return new ModelAndView(catalogPath + "monitoring");
} 
```

这是我的 ftl 代码：

```
<@security.authorize ifAnyGranted="ROLE_ADMIN, ROLE_USER">
<p style="padding-right: 20px;">Logged in as ${username!"Anonymous" }</p>
</@security.authorize> 
```

就是这样，用户名将在授权后出现在每个页面上。

# c# - Vista Ultimate 64 中的 VS2005 SP1 断点不起作用

> ID：248568
> 
> 赞同：0
> 
> 时间：2008-10-29T21:52:59.737
> 
> 标签：c#, visual-studio-2005, vista64

我刚刚迁移到 Windows Ultimate 64 SP1，因为我的系统硬盘崩溃了。我安装了 Visual Studio 2005 SP1 和微软推荐的所有补丁。我终于从我的 SCM 中获得了我的源代码，但现在调试不会在我设置的任何断点上停止。这只是一个普通的 Winforms 应用程序，没什么特别的。

我做的第一件事是将构建目标更改为 x86。没有骰子。然后我去下载了 x64 的调试工具，仍然没有骰子。我将调试器设置为中断所有已处理和未处理的异常。也没有骰子。

我一直在查看谷歌搜索结果，但也没有运气。我已经在这里呆了3天了，没有运气。以前有人处理过这个问题吗？

**更新：**

这些项目都设置为调试（x86）。

调试会话开始时断点保持正常。

我已经重新安装了，也没有用。

我以管理员身份运行并关闭了 UAC。

我使用“附加到流程”附加到项目，并且能够以这种方式进入代码。我希望找出它为什么不自动附加，以避免每次都必须手动执行此操作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T22:14:03.907

几个问题。

当您的代码启动时，断点是否会变成一个带有工具提示的空圆圈，指示断点不会被命中？或者它是否变成了一个带有工具提示的完整圆圈，指示它所附加的过程？

您可以尝试手动附加调试器，看看您是否获得任何牵引力。只需启动应用程序，一旦它运行，转到调试菜单并选择“附加到进程” - 选择您的应用程序正在运行的进程，然后单击“附加”。

不过，我运行 Vista64 没有问题 - VS2008。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T23:48:51.080

这被列为[Vista 上 VS2005 的已知问题（通过 MSDN）：](http://msdn.microsoft.com/en-us/vstudio/aa964140.aspx#question20a)

> **标题**: 提升进程的即时 (JIT) 调试将失败
> 
> **说明**：提升的进程无法通过 VS 2005 进行 JIT 调试。这包括系统进程，例如 IIS，以及通过选择“以管理员身份运行”启动的应用程序。
> 
> **解决方法**：必须手动附加调试器，然后调试器才能捕获未处理的异常或用户断点（System.Diagnostics.Debugger.Break、__debugbreak 等）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T21:56:12.210

我在 Windows Server 2008 x64 和 Vista x64 SP1 上使用具有相同补丁级别的 Visual Studio 2005，没有任何问题。

您是否以管理员身份运行它？当所有其他方法都失败时，请尝试卸载并重新安装。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T22:16:22.107

确保项目设置为调试编译而不是发布编译，因为发布编译不包含您的调试信息。

# command-line - 启动 Outlook 并从命令行预填充电子邮件

> ID：248569
> 
> 赞同：25
> 
> 时间：2008-10-29T21:53:27.990
> 
> 标签：command-line, outlook

这可能吗？我希望预先填充 To:、Body 和 Attachment，因此用户所要做的就是单击发送。谢谢！

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-29T22:03:39.030

打开一个新的邮件消息（`ipm.note`是电子邮件的[消息类](https://msdn.microsoft.com/en-gb/en-en/library/office/ff861573.aspx)）

```
outlook.exe /c ipm.note 
```

打开一封新邮件并填充发件人：

```
outlook.exe /c ipm.note /m someone@microsoft.com 
```

打开带有附件的新邮件：

```
 outlook.exe /c ipm.note /a filename 
```

组合：（下面的第一个在 Office 2016 中不起作用，第二个起作用）

```
 outlook.exe /c ipm.note /m someone@microsoft.com&subject=test%20subject&body=test%20body
 outlook.exe /c ipm.note /m "someone@microsoft.com&subject=test%20subject&body=test%20body" 
```

必须使用 %20 来生成空格。

*   [有关创建预寻址电子邮件的命令行的](https://support.microsoft.com/en-gb/help/287573/how-to-use-command-line-switches-to-create-a-pre-addressed-e-mail-message-in-outlook)更多详细信息
*   命令行开关可以在[这里找到](https://support.office.com/en-gb/article/Command-line-switches-for-Outlook-for-Windows-079164cd-4ef5-4178-b235-441737deb3a6)

例如，这适用于经典 Outlook 2016（内部版本 16.0.4849.1000）。

但是，正如[Snozzlebert](https://stackoverflow.com/users/2294031/snozzlebert)[在评论](https://stackoverflow.com/questions/248569/starting-outlook-and-having-an-email-pre-populated-from-command-line/248598#comment106314209_248598)中指出的那样，对于 Outlook 365 版本 2001（内部版本 12430.20184），语法为：

```
outlook.exe /c ipm.note /m "someone@microsoft.com?subject=test" 
```

> 罪魁祸首是`&`电子邮件地址之后 - 将其替换为`?`解决了问题。
> 微软似乎将语法更改为 HTML mailto 语法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-01-30T04:11:54.173

如果您只需在命令后面加上“”引号，您就可以附加文件并预先填写到/正文`/m`

例子：

```
outlook.exe /c ipm.note /m "someone@microsoft.com&subject=test%20subject&body=test%20body" /a test.txt 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-05T16:59:36.920

VonC 的解决方案有效，但正如 skbergam 的评论中所述，它不允许附件。

如果像我一样，这是一个大问题，那么下面的 WSH 代码就可以了。

```
Set olApp = CreateObject("Outlook.Application")
Set olMsg = olApp.CreateItem(0)

With olMsg
  .To = "test@testing.com"
  '.CC = "cc@testing.com"
  '.BCC = "bcc@testing.com"
  .Subject = "Subject"
  .Body = "Body"
  .Attachments.Add "C:\path\to\attachment\test.txt" 

  .Display
End With 
```

我已经用 Outlook2003 试过了

# java - Netbeans GUI 设计器和固定大小的应用程序面板

> ID：248580
> 
> 赞同：3
> 
> 时间：2008-10-29T21:57:19.230
> 
> 标签：java, user-interface, netbeans, designer

我有一个问题，为必须占据整个屏幕的触摸屏 GUI 应用程序创建一个固定大小的整体面板。简而言之，触摸屏是 800 x 600 像素，因此我希望主 GUI 面板是那个大小。

当我在 NetBeans 中启动一个新的 GUI 项目时，我将主面板的最小/最大/首选大小的属性设置为 800 x 600，并且“设计”视图中的面板会更改大小。但是，当我启动应用程序时，它会调整为原始默认大小。

在 initComponents() 之后添加此代码无济于事：

```
this.mainPanel.setSize(new Dimension(800,600));
this.mainPanel.setMaximumSize(new Dimension(800,600));
this.mainPanel.setMinimumSize(new Dimension(800,600));
this.mainPanel.repaint(); 
```

我已经查看了所有资源文件，似乎找不到可以覆盖这些文件的值（这似乎有点不可能，因为我是在 initComponents() 完成工作之后设置它们的）。我正在使用 FreeDesign 布局，因为我想完全控制我放置东西的位置。

我怀疑布局管理器正在根据屏幕上有多少小部件来调整大小，因为不同的原型屏幕以不同的尺寸出现。

帮助表示赞赏！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T09:58:55.963

你试过[java全屏模式](http://java.sun.com/docs/books/tutorial/extra/fullscreen/index.html)吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T07:06:58.450

我使用这种方法来完成任务，不确定它是否最好，您需要等待调用它，直到框架实际出现在屏幕上。

```
protected void growBig()
  {
    int screenWidth = java.awt.Toolkit.getDefaultToolkit().getScreenSize().width;
    int screenHeight = java.awt.Toolkit.getDefaultToolkit().getScreenSize().height;
    Rectangle rectangle = getFrame().getBounds();
    rectangle.setSize(screenWidth, screenHeight);
    getFrame().setBounds(0, 0, screenWidth, screenHeight);
    getFrame().setSize(screenWidth, screenHeight);
    getFrame().doLayout();
    getFrame().validate();
    updateUI();
  } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T11:29:29.027

我不确定您的触摸屏设备是如何工作的。但是，如果您使用 Netbeans 预览，您的面板将被放置在 JFrame/JWindow 等外部容器中。也许您将框架设置为 800x600。

如果是这样，那么问题可能是框架为自己的边框占用了几个像素，从而使您的面板尺寸 < 800x600。在这种情况下，您的面板将无法使用您的最小/最大设置并恢复为默认尺寸。

# html - 一个在悬停时显示对象和元素结构的 Firefox 工具？

> ID：248585
> 
> 赞同：1
> 
> 时间：2008-10-29T22:00:09.877
> 
> 标签：html, firefox, layout

在网页中的任何元素上。我需要看看元素和子元素是什么。

例如

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-29T22:02:38.127

[Firebug 的](http://addons.mozilla.org/en-US/firefox/addon/1843)Inspect 工具听起来像您正在寻找的东西。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-29T22:15:55.243

此外，[Web Developer 扩展](http://chrispederick.com/work/web-developer/)在 DOM 检查方面做得很好......

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-29T22:03:07.203

查看 Firebug [http://getfirebug.com](http://getfirebug.com)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T09:46:45.350

你也可以使用 Firefox [DOM Inspector](https://addons.mozilla.org/en-US/firefox/addon/1806)。在应用程序中单击左上角的图标，然后单击页面上所需的元素，它应该会自动滚动到 DOM 树中的相关节点。

# mysql - 编写用于测试 SQL 存储过程的单元测试框架

> ID：248587
> 
> 赞同：10
> 
> 时间：2008-10-29T22:00:22.483
> 
> 标签：mysql, unit-testing, frameworks

今天我有了一个想法，想为 MySQL 中的存储过程编写一个单元测试框架。完整的想法写在我博客上最近的一篇文章中。简而言之，它是这样的：我想自动化我的程序测试，我想使用一种标准化的方式来测试我的程序。单元测试被广泛记录，并且有无数的 XUnit 框架，为什么不为 MySQL（或任何其他数据库）编写一个。它当然是开源的。你怎么看？这是愚蠢的，愚蠢的，不必要的还是什么？或者另一个想法是用 SQL 编写一个通用的数据库框架。嗯，我真的很想和某人讨论一下，收集想法和想法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T22:12:23.987

已经有一个用于 Sql Server 的测试框架 - [TSQLUnit](http://tsqlunit.sourceforge.net/)。也许你可以从中得到一些有用的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-25T22:59:29.293

Yes, great idea. I've been having a fair bit of success with [pgTAP](http://pgtap.org/ "pgTAP: Unit testing for PostgreSQL"). I've used it in a number of projects, both for [test driven database development](http://www.oscon.com/oscon2010/public/schedule/detail/14168) and to write tests for existing procedures in order to be able to effectively refactor them.

I have often been asked if there's something like it for MySQL. Maybe you've written something by now?

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-11T19:03:02.057

已经有单元测试了。除了 dbUnit 和 sqlUnit，尝试：

MyTAP：[https](https://github.com/hepabolu/mytap) [:](http://datacharmer.blogspot.com/2006/01/mysql-5-general-purpose-routine_27.html)
//github.com/hepabolu/mytap datacharmer.org：http://datacharmer.blogspot.com/2006/01/mysql-5-general-purpose-routine_27.html

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T22:08:04.403

我倾向于对数据访问层进行单元测试，这总是让人头疼，因为您必须使用适当的数据设置适当的数据库。有数据生成器可以帮助（如 RedGate 的数据生成器）使设置过程更简单。

我只是测试 DAL 背后的想法是，您实际上是在使用添加的 .Net DB 代码测试存储过程本身，我认为我们不需要担心单元测试。通过这种方式，您可以利用已有的所有工具和流程进行单元测试。为可以（恕我直言）与现有工具同样出色执行的东西开发一个单独的框架似乎需要付出很多努力。

不过我有一个开放的心态。如果有我忽略的好处，请告诉我。

干杯，V

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-29T22:19:51.617

好处之一是测试将在与存储过程编写和执行的环境相同的环境中编写，由主应用程序外部的专业数据库开发人员维护。应用程序开发人员无需成为关系数据库编程的大师，数据库开发人员也无需掌握现代应用程序开发语言。你现在对每一件事都进行了测试。为什么不让它们为数据库编写 sql 并在任何内部开发的应用程序之外执行。

如果您正在开发一个多层应用程序，那么将每个部分分开并单独测试它是有意义的。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-06-16T07:54:25.230

试试 TST：[http ://tst.codeplex.com](http://tst.codeplex.com)

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2008-10-29T23:32:50.517

数据库中不应该有足够的逻辑来使测试变得有价值。

# java - 查找 Eclipse 项目中使用的未使用的 jar

> ID：248589
> 
> 赞同：67
> 
> 时间：2008-10-29T22:00:42.107
> 
> 标签：java, eclipse, jar

是否有任何插件/工具可用于通过 Eclipse 项目（或工作区）的类路径并突出显示任何未使用的 jar？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-10-29T22:11:02.337

[ClassPathHelper](http://classpathhelper.sourceforge.net/)是一个好的开始。

它会自动识别孤儿罐等等。

唯一的限制是没有在类中定义的依赖关系，例如在依赖注入框架配置文件中。

您还有其他选择/补充，例如：

*   [workingfrog "Relief"](http://web.archive.org/web/20120507193800/http://www.workingfrog.org/)，它依赖于通过检查它们的形状、大小或空间中的相对位置来处理真实对象的能力，它提供了关于 java 包、类型和字段及其关系的“物理”视图，使它们更容易处理。
*   [不必要的代码检测器](http://www.ucdetector.org/)：一个 Eclipse 插件工具，用于查找不必要的（死）公共 java 代码。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2011-03-16T09:47:37.503

**UCDetector 对此**没有帮助：它不适用于 JAR。对于**classpathHelper**，我无法找到一种简单的方法来列出孤儿 JAR（顺便说一句，如果有人有这方面的教程，我很感兴趣）。

所以，如果你也像我一样使用 Maven，我发现了[这个很棒的 Maven 插件](http://maven.apache.org/plugins/maven-dependency-plugin/analyze-mojo.html)，我想和你分享这个解决方案。只需输入：

```
mvn dependency:analyze 
```

您将立即获得依赖项中未使用的 JAR 列表。非常便利 ！

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2015-07-23T09:13:48.673

我找到了一个非常快速和有趣的工具来归档这个目标：

[http://tattletale.jboss.org/](http://tattletale.jboss.org/)

只需解压缩程序并运行：

```
java -Xmx512m -jar tattletale.jar ~/myjavaproject/mydistribution output 
```

这将生成一个非常令人印象深刻的报告，其中包含不同的点（来自他们网站的文本）：

*   识别 JAR 文件之间的依赖关系
*   从类路径中查找缺失的类
*   发现一个类/包是否位于多个 JAR 文件中
*   发现同一个 JAR 文件是否位于多个位置
*   每个 JAR 文件需要和提供的列表
*   验证类的 SerialVersionUID
*   查找具有不同版本号的类似 JAR 文件
*   查找没有版本号的 JAR 文件
*   **查找未使用的 JAR 档案**
*   识别密封/签名的 JAR 档案
*   在 JAR 文件中找到一个类
*   获取项目的 OSGi 状态
*   删除列入黑名单的 API 使用
*   并为您的 .WAR 和 .EAR 档案生成相同的报告

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-29T22:22:39.850

您可以使用以下插件之一： [UCDetector](http://www.ucdetector.org/)或[Classpath Helper](http://classpathhelper.sourceforge.net/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-11T13:12:48.540

我知道这是一个旧的，但如果其他人偶然发现这一点，Eclipse 会自行完成。

导航到 Project properties->Java Code Style->Clean Up 选择 Eclipse [Built-in]，它会执行以下操作：

*   使用声明类型更改对静态成员的非静态访问
*   将对静态成员的间接访问更改为直接访问（通过子类型访问）
*   删除未使用的导入
*   添加缺少的“@Override”注释
*   向接口方法的实现添加缺少的“@Override”注释
*   添加缺少的“@Deprecated”注释
*   删除不必要的演员表
*   删除不必要的“$NON-NLS$”标签

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-07-22T06:47:47.107

在 Maven 和 Gradle 项目中，您可以使用这些插件来识别未使用的依赖项。

*   对于 Maven：[链接](https://www.baeldung.com/maven-unused-dependencies)

在 pom.xml 文件插件中使用它。

```
<build>
<plugins>
    <plugin>
        <artifactId>maven-dependency-plugin</artifactId>
        <version>3.1.2</version>
    </plugin>
</plugins>
</build> 
```

这将作为输出。在这种情况下，我们将 commons-collections 依赖添加到 pom.xml，但不要在代码中使用。 [![在此处输入图像描述](https://i.stack.imgur.com/bELWk.png)](https://i.stack.imgur.com/bELWk.png)

*   对于 Gradle：[链接](https://github.com/gradle-dependency-analyze/gradle-dependency-analyze)

在 build.gradle 文件插件中使用它。

```
plugins {
  id "ca.cutterslade.analyze" version "1.7.1"
} 
```

使用旧版插件应用程序：

[![在此处输入图像描述](https://i.stack.imgur.com/xQGLB.png)](https://i.stack.imgur.com/xQGLB.png)

这将作为输出。在这种情况下，我们将依赖项未使用DeclaredArtifacts 添加到 gradlefile，但不要在代码中使用。 [![在此处输入图像描述](https://i.stack.imgur.com/tuc1k.png)](https://i.stack.imgur.com/tuc1k.png)

# c# - C#中的自然排序顺序

> ID：248603
> 
> 赞同：139
> 
> 时间：2008-10-29T22:04:33.753
> 
> 标签：c#, sorting, file, natural-sort

任何人都有很好的资源或在 C# 中为`FileInfo`数组提供自然顺序排序的示例？我正在`IComparer`以我的方式实现接口。

* * *

## 回答 #1

> 赞同：155
> 
> 时间：2008-10-29T22:09:13.447

最简单的做法就是 P/Invoke Windows 中的内置函数，并将其用作您的比较函数`IComparer`：

```
[DllImport("shlwapi.dll", CharSet = CharSet.Unicode)]
private static extern int StrCmpLogicalW(string psz1, string psz2); 
```

Michael Kaplan 在这里提供了一些[关于此功能如何工作的示例](http://www.siao2.com/2006/10/01/778990.aspx)，以及为使 Vista 更直观地工作而进行的更改。此功能的优点是它的行为与其运行的 Windows 版本相同，但这确实意味着它在 Windows 版本之间有所不同，因此您需要考虑这是否对您来说是个问题。

所以一个完整的实现将是这样的：

```
[SuppressUnmanagedCodeSecurity]
internal static class SafeNativeMethods
{
    [DllImport("shlwapi.dll", CharSet = CharSet.Unicode)]
    public static extern int StrCmpLogicalW(string psz1, string psz2);
}

public sealed class NaturalStringComparer : IComparer<string>
{
    public int Compare(string a, string b)
    {
        return SafeNativeMethods.StrCmpLogicalW(a, b);
    }
}

public sealed class NaturalFileInfoNameComparer : IComparer<FileInfo>
{
    public int Compare(FileInfo a, FileInfo b)
    {
        return SafeNativeMethods.StrCmpLogicalW(a.Name, b.Name);
    }
} 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2012-07-30T11:40:17.553

只是想我会添加到这个（用我能找到的最简洁的解决方案）：

```
public static IOrderedEnumerable<T> OrderByAlphaNumeric<T>(this IEnumerable<T> source, Func<T, string> selector)
{
    int max = source
        .SelectMany(i => Regex.Matches(selector(i), @"\d+").Cast<Match>().Select(m => (int?)m.Value.Length))
        .Max() ?? 0;

    return source.OrderBy(i => Regex.Replace(selector(i), @"\d+", m => m.Value.PadLeft(max, '0')));
} 
```

上面将字符串中的任何数字填充到所有字符串中所有数字的最大长度，并使用结果字符串进行排序。

转换为 ( `int?`) 是为了允许没有任何数字的字符串集合（`.Max()`在空的可枚举项上抛出一个`InvalidOperationException`）。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2011-08-13T01:45:10.070

现有的实现都不是很好，所以我自己写了。结果几乎与现代版本的 Windows Explorer (Windows 7/8) 使用的排序相同。我看到的唯一区别是 1）虽然 Windows 过去（例如 XP）处理任何长度的数字，但现在限制为 19 位数字 - 我的数字是无限的，2）Windows 给出的结果与某些 Unicode 数字集不一致 - 我的工作很好（尽管它不会在数字上比较代理对中的数字；Windows 也不会），并且 3）如果它们出现在不同的部分（例如“e-1é”与“ é1e-" - 数字前后的部分有变音符号和标点符号的重量差异）。

```
public static int CompareNatural(string strA, string strB) {
    return CompareNatural(strA, strB, CultureInfo.CurrentCulture, CompareOptions.IgnoreCase);
}

public static int CompareNatural(string strA, string strB, CultureInfo culture, CompareOptions options) {
    CompareInfo cmp = culture.CompareInfo;
    int iA = 0;
    int iB = 0;
    int softResult = 0;
    int softResultWeight = 0;
    while (iA < strA.Length && iB < strB.Length) {
        bool isDigitA = Char.IsDigit(strA[iA]);
        bool isDigitB = Char.IsDigit(strB[iB]);
        if (isDigitA != isDigitB) {
            return cmp.Compare(strA, iA, strB, iB, options);
        }
        else if (!isDigitA && !isDigitB) {
            int jA = iA + 1;
            int jB = iB + 1;
            while (jA < strA.Length && !Char.IsDigit(strA[jA])) jA++;
            while (jB < strB.Length && !Char.IsDigit(strB[jB])) jB++;
            int cmpResult = cmp.Compare(strA, iA, jA - iA, strB, iB, jB - iB, options);
            if (cmpResult != 0) {
                // Certain strings may be considered different due to "soft" differences that are
                // ignored if more significant differences follow, e.g. a hyphen only affects the
                // comparison if no other differences follow
                string sectionA = strA.Substring(iA, jA - iA);
                string sectionB = strB.Substring(iB, jB - iB);
                if (cmp.Compare(sectionA + "1", sectionB + "2", options) ==
                    cmp.Compare(sectionA + "2", sectionB + "1", options))
                {
                    return cmp.Compare(strA, iA, strB, iB, options);
                }
                else if (softResultWeight < 1) {
                    softResult = cmpResult;
                    softResultWeight = 1;
                }
            }
            iA = jA;
            iB = jB;
        }
        else {
            char zeroA = (char)(strA[iA] - (int)Char.GetNumericValue(strA[iA]));
            char zeroB = (char)(strB[iB] - (int)Char.GetNumericValue(strB[iB]));
            int jA = iA;
            int jB = iB;
            while (jA < strA.Length && strA[jA] == zeroA) jA++;
            while (jB < strB.Length && strB[jB] == zeroB) jB++;
            int resultIfSameLength = 0;
            do {
                isDigitA = jA < strA.Length && Char.IsDigit(strA[jA]);
                isDigitB = jB < strB.Length && Char.IsDigit(strB[jB]);
                int numA = isDigitA ? (int)Char.GetNumericValue(strA[jA]) : 0;
                int numB = isDigitB ? (int)Char.GetNumericValue(strB[jB]) : 0;
                if (isDigitA && (char)(strA[jA] - numA) != zeroA) isDigitA = false;
                if (isDigitB && (char)(strB[jB] - numB) != zeroB) isDigitB = false;
                if (isDigitA && isDigitB) {
                    if (numA != numB && resultIfSameLength == 0) {
                        resultIfSameLength = numA < numB ? -1 : 1;
                    }
                    jA++;
                    jB++;
                }
            }
            while (isDigitA && isDigitB);
            if (isDigitA != isDigitB) {
                // One number has more digits than the other (ignoring leading zeros) - the longer
                // number must be larger
                return isDigitA ? 1 : -1;
            }
            else if (resultIfSameLength != 0) {
                // Both numbers are the same length (ignoring leading zeros) and at least one of
                // the digits differed - the first difference determines the result
                return resultIfSameLength;
            }
            int lA = jA - iA;
            int lB = jB - iB;
            if (lA != lB) {
                // Both numbers are equivalent but one has more leading zeros
                return lA > lB ? -1 : 1;
            }
            else if (zeroA != zeroB && softResultWeight < 2) {
                softResult = cmp.Compare(strA, iA, 1, strB, iB, 1, options);
                softResultWeight = 2;
            }
            iA = jA;
            iB = jB;
        }
    }
    if (iA < strA.Length || iB < strB.Length) {
        return iA < strA.Length ? 1 : -1;
    }
    else if (softResult != 0) {
        return softResult;
    }
    return 0;
} 
```

签名与`Comparison<string>`委托匹配：

```
string[] files = Directory.GetFiles(@"C:\");
Array.Sort(files, CompareNatural); 
```

这是一个包装类，用作`IComparer<string>`：

```
public class CustomComparer<T> : IComparer<T> {
    private Comparison<T> _comparison;

    public CustomComparer(Comparison<T> comparison) {
        _comparison = comparison;
    }

    public int Compare(T x, T y) {
        return _comparison(x, y);
    }
} 
```

例子：

```
string[] files = Directory.EnumerateFiles(@"C:\")
    .OrderBy(f => f, new CustomComparer<string>(CompareNatural))
    .ToArray(); 
```

这是我用于测试的一组很好的文件名：

```
Func<string, string> expand = (s) => { int o; while ((o = s.IndexOf('\\')) != -1) { int p = o + 1;
    int z = 1; while (s[p] == '0') { z++; p++; } int c = Int32.Parse(s.Substring(p, z));
    s = s.Substring(0, o) + new string(s[o - 1], c) + s.Substring(p + z); } return s; };
string encodedFileNames =
    "KDEqLW4xMiotbjEzKjAwMDFcMDY2KjAwMlwwMTcqMDA5XDAxNyowMlwwMTcqMDlcMDE3KjEhKjEtISox" +
    "LWEqMS4yNT8xLjI1KjEuNT8xLjUqMSoxXDAxNyoxXDAxOCoxXDAxOSoxXDA2NioxXDA2NyoxYSoyXDAx" +
    "NyoyXDAxOCo5XDAxNyo5XDAxOCo5XDA2Nio9MSphMDAxdGVzdDAxKmEwMDF0ZXN0aW5nYTBcMzEqYTAw" +
    "Mj9hMDAyIGE/YTAwMiBhKmEwMDIqYTAwMmE/YTAwMmEqYTAxdGVzdGluZ2EwMDEqYTAxdnNmcyphMSph" +
    "MWEqYTF6KmEyKmIwMDAzcTYqYjAwM3E0KmIwM3E1KmMtZSpjZCpjZipmIDEqZipnP2cgMT9oLW4qaG8t" +
    "bipJKmljZS1jcmVhbT9pY2VjcmVhbT9pY2VjcmVhbS0/ajBcNDE/ajAwMWE/ajAxP2shKmsnKmstKmsx" +
    "KmthKmxpc3QqbTAwMDNhMDA1YSptMDAzYTAwMDVhKm0wMDNhMDA1Km0wMDNhMDA1YSpuMTIqbjEzKm8t" +
    "bjAxMypvLW4xMipvLW40P28tbjQhP28tbjR6P28tbjlhLWI1Km8tbjlhYjUqb24wMTMqb24xMipvbjQ/" +
    "b240IT9vbjR6P29uOWEtYjUqb245YWI1Km/CrW4wMTMqb8KtbjEyKnAwMCpwMDEqcDAxwr0hKnAwMcK9" +
    "KnAwMcK9YSpwMDHCvcK+KnAwMipwMMK9KnEtbjAxMypxLW4xMipxbjAxMypxbjEyKnItMDAhKnItMDAh" +
    "NSpyLTAwIe+8lSpyLTAwYSpyLe+8kFwxIS01KnIt77yQXDEhLe+8lSpyLe+8kFwxISpyLe+8kFwxITUq" +
    "ci3vvJBcMSHvvJUqci3vvJBcMWEqci3vvJBcMyE1KnIwMCEqcjAwLTUqcjAwLjUqcjAwNSpyMDBhKnIw" +
    "NSpyMDYqcjQqcjUqctmg2aYqctmkKnLZpSpy27Dbtipy27Qqctu1KnLfgN+GKnLfhCpy34UqcuClpuCl" +
    "rCpy4KWqKnLgpasqcuCnpuCnrCpy4KeqKnLgp6sqcuCppuCprCpy4KmqKnLgqasqcuCrpuCrrCpy4Kuq" +
    "KnLgq6sqcuCtpuCtrCpy4K2qKnLgrasqcuCvpuCvrCpy4K+qKnLgr6sqcuCxpuCxrCpy4LGqKnLgsasq" +
    "cuCzpuCzrCpy4LOqKnLgs6sqcuC1puC1rCpy4LWqKnLgtasqcuC5kOC5lipy4LmUKnLguZUqcuC7kOC7" +
    "lipy4LuUKnLgu5UqcuC8oOC8pipy4LykKnLgvKUqcuGBgOGBhipy4YGEKnLhgYUqcuGCkOGClipy4YKU" +
    "KnLhgpUqcuGfoOGfpipy4Z+kKnLhn6UqcuGgkOGglipy4aCUKnLhoJUqcuGlhuGljCpy4aWKKnLhpYsq" +
    "cuGnkOGnlipy4aeUKnLhp5UqcuGtkOGtlipy4a2UKnLhrZUqcuGusOGutipy4a60KnLhrrUqcuGxgOGx" +
    "hipy4bGEKnLhsYUqcuGxkOGxlipy4bGUKnLhsZUqcuqYoFwx6pilKnLqmKDqmKUqcuqYoOqYpipy6pik" +
    "KnLqmKUqcuqjkOqjlipy6qOUKnLqo5UqcuqkgOqkhipy6qSEKnLqpIUqcuqpkOqplipy6qmUKnLqqZUq" +
    "cvCQkqAqcvCQkqUqcvCdn5gqcvCdn50qcu+8kFwxISpy77yQXDEt77yVKnLvvJBcMS7vvJUqcu+8kFwx" +
    "YSpy77yQXDHqmKUqcu+8kFwx77yO77yVKnLvvJBcMe+8lSpy77yQ77yVKnLvvJDvvJYqcu+8lCpy77yV" +
    "KnNpKnPEsSp0ZXN02aIqdGVzdNmi2aAqdGVzdNmjKnVBZS0qdWFlKnViZS0qdUJlKnVjZS0xw6kqdWNl" +
    "McOpLSp1Y2Uxw6kqdWPDqS0xZSp1Y8OpMWUtKnVjw6kxZSp3ZWlhMSp3ZWlhMip3ZWlzczEqd2Vpc3My" +
    "KndlaXoxKndlaXoyKndlacOfMSp3ZWnDnzIqeSBhMyp5IGE0KnknYTMqeSdhNCp5K2EzKnkrYTQqeS1h" +
    "Myp5LWE0KnlhMyp5YTQqej96IDA1MD96IDIxP3ohMjE/ejIwP3oyMj96YTIxP3rCqTIxP1sxKl8xKsKt" +
    "bjEyKsKtbjEzKsSwKg==";
string[] fileNames = Encoding.UTF8.GetString(Convert.FromBase64String(encodedFileNames))
    .Replace("*", ".txt?").Split(new[] { "?" }, StringSplitOptions.RemoveEmptyEntries)
    .Select(n => expand(n)).ToArray(); 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2010-03-12T14:52:09.987

linq orderby 的纯 C# 解决方案：

[http://zootfroot.blogspot.com/2009/09/natural-sort-compare-with-linq-orderby.html](http://zootfroot.blogspot.com/2009/09/natural-sort-compare-with-linq-orderby.html)

```
public class NaturalSortComparer<T> : IComparer<string>, IDisposable
{
    private bool isAscending;

    public NaturalSortComparer(bool inAscendingOrder = true)
    {
        this.isAscending = inAscendingOrder;
    }

    #region IComparer<string> Members

    public int Compare(string x, string y)
    {
        throw new NotImplementedException();
    }

    #endregion

    #region IComparer<string> Members

    int IComparer<string>.Compare(string x, string y)
    {
        if (x == y)
            return 0;

        string[] x1, y1;

        if (!table.TryGetValue(x, out x1))
        {
            x1 = Regex.Split(x.Replace(" ", ""), "([0-9]+)");
            table.Add(x, x1);
        }

        if (!table.TryGetValue(y, out y1))
        {
            y1 = Regex.Split(y.Replace(" ", ""), "([0-9]+)");
            table.Add(y, y1);
        }

        int returnVal;

        for (int i = 0; i < x1.Length && i < y1.Length; i++)
        {
            if (x1[i] != y1[i])
            {
                returnVal = PartCompare(x1[i], y1[i]);
                return isAscending ? returnVal : -returnVal;
            }
        }

        if (y1.Length > x1.Length)
        {
            returnVal = 1;
        }
        else if (x1.Length > y1.Length)
        { 
            returnVal = -1; 
        }
        else
        {
            returnVal = 0;
        }

        return isAscending ? returnVal : -returnVal;
    }

    private static int PartCompare(string left, string right)
    {
        int x, y;
        if (!int.TryParse(left, out x))
            return left.CompareTo(right);

        if (!int.TryParse(right, out y))
            return left.CompareTo(right);

        return x.CompareTo(y);
    }

    #endregion

    private Dictionary<string, string[]> table = new Dictionary<string, string[]>();

    public void Dispose()
    {
        table.Clear();
        table = null;
    }
} 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2014-03-11T10:46:27.417

Matthews Horsleys 的回答是最快的方法，它不会根据您的程序运行的 Windows 版本而改变行为。但是，通过创建一次正则表达式并使用 RegexOptions.Compiled 可以更快。我还添加了插入字符串比较器的选项，以便您可以在需要时忽略大小写，并稍微提高了可读性。

```
 public static IEnumerable<T> OrderByNatural<T>(this IEnumerable<T> items, Func<T, string> selector, StringComparer stringComparer = null)
    {
        var regex = new Regex(@"\d+", RegexOptions.Compiled);

        int maxDigits = items
                      .SelectMany(i => regex.Matches(selector(i)).Cast<Match>().Select(digitChunk => (int?)digitChunk.Value.Length))
                      .Max() ?? 0;

        return items.OrderBy(i => regex.Replace(selector(i), match => match.Value.PadLeft(maxDigits, '0')), stringComparer ?? StringComparer.CurrentCulture);
    } 
```

使用人

```
var sortedEmployees = employees.OrderByNatural(emp => emp.Name); 
```

排序 100,000 个字符串需要 450 毫秒，而默认的 .net 字符串比较需要 300 毫秒 - 非常快！

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2012-07-24T05:09:16.763

我的解决方案：

```
void Main()
{
    new[] {"a4","a3","a2","a10","b5","b4","b400","1","C1d","c1d2"}.OrderBy(x => x, new NaturalStringComparer()).Dump();
}

public class NaturalStringComparer : IComparer<string>
{
    private static readonly Regex _re = new Regex(@"(?<=\D)(?=\d)|(?<=\d)(?=\D)", RegexOptions.Compiled);

    public int Compare(string x, string y)
    {
        x = x.ToLower();
        y = y.ToLower();
        if(string.Compare(x, 0, y, 0, Math.Min(x.Length, y.Length)) == 0)
        {
            if(x.Length == y.Length) return 0;
            return x.Length < y.Length ? -1 : 1;
        }
        var a = _re.Split(x);
        var b = _re.Split(y);
        int i = 0;
        while(true)
        {
            int r = PartCompare(a[i], b[i]);
            if(r != 0) return r;
            ++i;
        }
    }

    private static int PartCompare(string x, string y)
    {
        int a, b;
        if(int.TryParse(x, out a) && int.TryParse(y, out b))
            return a.CompareTo(b);
        return x.CompareTo(y);
    }
} 
```

结果：

```
1
a2
a3
a4
a10
b4
b5
b400
C1d
c1d2 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-09-01T19:24:06.743

您确实需要小心——我隐约记得读过 StrCmpLogicalW 或类似的东西不是严格传递的，而且我观察到如果比较函数违反该规则，.NET 的排序方法有时会陷入无限循环。

如果 a < b 且 b < c，传递比较将始终报告 a < c。存在一个执行自然排序顺序比较的函数，它并不总是符合该标准，但我不记得它是 StrCmpLogicalW 还是其他东西。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2016-10-27T17:26:26.437

这是我对同时具有字母和数字字符的字符串进行排序的代码。

一、这个扩展方法：

```
public static IEnumerable<string> AlphanumericSort(this IEnumerable<string> me)
{
    return me.OrderBy(x => Regex.Replace(x, @"\d+", m => m.Value.PadLeft(50, '0')));
} 
```

然后，只需在代码中的任何位置使用它，如下所示：

```
List<string> test = new List<string>() { "The 1st", "The 12th", "The 2nd" };
test = test.AlphanumericSort(); 
```

它是如何工作的？通过用零替换：

```
 Original  | Regex Replace |      The      |   Returned
    List    | Apply PadLeft |    Sorting    |     List
            |               |               |
 "The 1st"  |  "The 001st"  |  "The 001st"  |  "The 1st"
 "The 12th" |  "The 012th"  |  "The 002nd"  |  "The 2nd"
 "The 2nd"  |  "The 002nd"  |  "The 012th"  |  "The 12th" 
```

适用于倍数：

```
 Alphabetical Sorting | Alphanumeric Sorting
                      |
 "Page 21, Line 42"   | "Page 3, Line 7"
 "Page 21, Line 5"    | "Page 3, Line 32"
 "Page 3, Line 32"    | "Page 21, Line 5"
 "Page 3, Line 7"     | "Page 21, Line 42" 
```

希望这会有所帮助。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-09-23T15:36:50.320

添加到[Greg Beech 的答案](https://stackoverflow.com/questions/248603/natural-sort-order-in-c/248613#248613)（因为我一直在寻找那个），如果你想从 Linq 使用这个，你可以使用`OrderBy`需要一个`IComparer`. 例如：

```
var items = new List<MyItem>();

// fill items

var sorted = items.OrderBy(item => item.Name, new NaturalStringComparer()); 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2016-12-15T15:53:03.403

这是一个相对简单的示例，它不使用 P/Invoke 并避免在执行期间进行任何分配。

随意使用此处的代码，或者如果更简单，可以使用 NuGet 包：

[https://www.nuget.org/packages/NaturalSort](https://www.nuget.org/packages/NaturalSort)

[https://github.com/drewnoakes/natural-sort](https://github.com/drewnoakes/natural-sort)

```
internal sealed class NaturalStringComparer : IComparer<string>
{
    public static NaturalStringComparer Instance { get; } = new NaturalStringComparer();

    public int Compare(string x, string y)
    {
        // sort nulls to the start
        if (x == null)
            return y == null ? 0 : -1;
        if (y == null)
            return 1;

        var ix = 0;
        var iy = 0;

        while (true)
        {
            // sort shorter strings to the start
            if (ix >= x.Length)
                return iy >= y.Length ? 0 : -1;
            if (iy >= y.Length)
                return 1;

            var cx = x[ix];
            var cy = y[iy];

            int result;
            if (char.IsDigit(cx) && char.IsDigit(cy))
                result = CompareInteger(x, y, ref ix, ref iy);
            else
                result = cx.CompareTo(y[iy]);

            if (result != 0)
                return result;

            ix++;
            iy++;
        }
    }

    private static int CompareInteger(string x, string y, ref int ix, ref int iy)
    {
        var lx = GetNumLength(x, ix);
        var ly = GetNumLength(y, iy);

        // shorter number first (note, doesn't handle leading zeroes)
        if (lx != ly)
            return lx.CompareTo(ly);

        for (var i = 0; i < lx; i++)
        {
            var result = x[ix++].CompareTo(y[iy++]);
            if (result != 0)
                return result;
        }

        return 0;
    }

    private static int GetNumLength(string s, int i)
    {
        var length = 0;
        while (i < s.Length && char.IsDigit(s[i++]))
            length++;
        return length;
    }
} 
```

它不会忽略前导零，所以`01`在`2`.

对应的单元测试：

```
public class NumericStringComparerTests
{
    [Fact]
    public void OrdersCorrectly()
    {
        AssertEqual("", "");
        AssertEqual(null, null);
        AssertEqual("Hello", "Hello");
        AssertEqual("Hello123", "Hello123");
        AssertEqual("123", "123");
        AssertEqual("123Hello", "123Hello");

        AssertOrdered("", "Hello");
        AssertOrdered(null, "Hello");
        AssertOrdered("Hello", "Hello1");
        AssertOrdered("Hello123", "Hello124");
        AssertOrdered("Hello123", "Hello133");
        AssertOrdered("Hello123", "Hello223");
        AssertOrdered("123", "124");
        AssertOrdered("123", "133");
        AssertOrdered("123", "223");
        AssertOrdered("123", "1234");
        AssertOrdered("123", "2345");
        AssertOrdered("0", "1");
        AssertOrdered("123Hello", "124Hello");
        AssertOrdered("123Hello", "133Hello");
        AssertOrdered("123Hello", "223Hello");
        AssertOrdered("123Hello", "1234Hello");
    }

    private static void AssertEqual(string x, string y)
    {
        Assert.Equal(0, NaturalStringComparer.Instance.Compare(x, y));
        Assert.Equal(0, NaturalStringComparer.Instance.Compare(y, x));
    }

    private static void AssertOrdered(string x, string y)
    {
        Assert.Equal(-1, NaturalStringComparer.Instance.Compare(x, y));
        Assert.Equal( 1, NaturalStringComparer.Instance.Compare(y, x));
    }
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2017-11-20T20:44:23.407

我实际上已经将它实现为扩展方法，`StringComparer`以便您可以执行以下操作：

*   `StringComparer.CurrentCulture.WithNaturalSort()`或者
*   `StringComparer.OrdinalIgnoreCase.WithNaturalSort()`.

结果`IComparer<string>`可以在所有地方使用，如`OrderBy`, `OrderByDescending`, `ThenBy`, `ThenByDescending`,`SortedSet<string>`等。您仍然可以轻松调整区分大小写、文化等。

该实现相当简单，即使在大型序列上也应该表现得相当好。

* * *

我也将它发布为一个小的**[NuGet 包](https://www.nuget.org/packages/NaturalSort.Extension/)**，所以你可以这样做：

```
Install-Package NaturalSort.Extension 
```

[NaturalSort.Extension](https://github.com/tompazourek/NaturalSort.Extension) [**GitHub 存储库**](https://github.com/tompazourek/NaturalSort.Extension)中提供了包括 XML 文档注释和[测试套件的](https://github.com/tompazourek/NaturalSort.Extension/blob/master/tests/NaturalSort.Extension.Tests/NaturalSortComparerTests.cs)代码。[](https://github.com/tompazourek/NaturalSort.Extension)

 *** * *

整个代码是这样的（如果你还不能使用 C# 7，只需安装 NuGet 包）：

```
public static class StringComparerNaturalSortExtension
{
    public static IComparer<string> WithNaturalSort(this StringComparer stringComparer) => new NaturalSortComparer(stringComparer);

    private class NaturalSortComparer : IComparer<string>
    {
        public NaturalSortComparer(StringComparer stringComparer)
        {
            _stringComparer = stringComparer;
        }

        private readonly StringComparer _stringComparer;
        private static readonly Regex NumberSequenceRegex = new Regex(@"(\d+)", RegexOptions.Compiled | RegexOptions.CultureInvariant);
        private static string[] Tokenize(string s) => s == null ? new string[] { } : NumberSequenceRegex.Split(s);
        private static ulong ParseNumberOrZero(string s) => ulong.TryParse(s, NumberStyles.None, CultureInfo.InvariantCulture, out var result) ? result : 0;

        public int Compare(string s1, string s2)
        {
            var tokens1 = Tokenize(s1);
            var tokens2 = Tokenize(s2);

            var zipCompare = tokens1.Zip(tokens2, TokenCompare).FirstOrDefault(x => x != 0);
            if (zipCompare != 0)
                return zipCompare;

            var lengthCompare = tokens1.Length.CompareTo(tokens2.Length);
            return lengthCompare;
        }

        private int TokenCompare(string token1, string token2)
        {
            var number1 = ParseNumberOrZero(token1);
            var number2 = ParseNumberOrZero(token2);

            var numberCompare = number1.CompareTo(number2);
            if (numberCompare != 0)
                return numberCompare;

            var stringCompare = _stringComparer.Compare(token1, token2);
            return stringCompare;
        }
    }
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-04-23T13:19:27.777

这是一种天真的单行无正则表达式的 LINQ 方式（从 python 借来的）：

```
var alphaStrings = new List<string>() { "10","2","3","4","50","11","100","a12","b12" };
var orderedString = alphaStrings.OrderBy(g => new Tuple<int, string>(g.ToCharArray().All(char.IsDigit)? int.Parse(g) : int.MaxValue, g));
// Order Now: ["2","3","4","10","11","50","100","a12","b12"] 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2018-09-13T16:40:22.490

受 Michael Parker 解决方案的启发，这里有一个`IComparer`实现，您可以使用任何 linq 排序方法：

```
private class NaturalStringComparer : IComparer<string>
{
    public int Compare(string left, string right)
    {
        int max = new[] { left, right }
            .SelectMany(x => Regex.Matches(x, @"\d+").Cast<Match>().Select(y => (int?)y.Value.Length))
            .Max() ?? 0;

        var leftPadded = Regex.Replace(left, @"\d+", m => m.Value.PadLeft(max, '0'));
        var rightPadded = Regex.Replace(right, @"\d+", m => m.Value.PadLeft(max, '0'));

        return string.Compare(leftPadded, rightPadded);
    }
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-02-24T16:07:55.787

这是 .NET Core 2.1+ / .NET 5.0+ 的版本，使用 span 来避免分配

```
public class NaturalSortStringComparer : IComparer<string>
{
    public static NaturalSortStringComparer Ordinal { get; } = new NaturalSortStringComparer(StringComparison.Ordinal);
    public static NaturalSortStringComparer OrdinalIgnoreCase { get; } = new NaturalSortStringComparer(StringComparison.OrdinalIgnoreCase);
    public static NaturalSortStringComparer CurrentCulture { get; } = new NaturalSortStringComparer(StringComparison.CurrentCulture);
    public static NaturalSortStringComparer CurrentCultureIgnoreCase { get; } = new NaturalSortStringComparer(StringComparison.CurrentCultureIgnoreCase);
    public static NaturalSortStringComparer InvariantCulture { get; } = new NaturalSortStringComparer(StringComparison.InvariantCulture);
    public static NaturalSortStringComparer InvariantCultureIgnoreCase { get; } = new NaturalSortStringComparer(StringComparison.InvariantCultureIgnoreCase);

    private readonly StringComparison _comparison;

    public NaturalSortStringComparer(StringComparison comparison)
    {
        _comparison = comparison;
    }

    public int Compare(string? x, string? y)
    {
        // Let string.Compare handle the case where x or y is null
        if (x is null || y is null)
            return string.Compare(x, y, _comparison);

        var xSegments = GetSegments(x);
        var ySegments = GetSegments(y);

        while (xSegments.MoveNext() && ySegments.MoveNext())
        {
            bool xIsNumber = int.TryParse(xSegments.Current, out var xValue);
            bool yIsNumber = int.TryParse(ySegments.Current, out var yValue);

            int cmp;

            // If they're both numbers, compare the value
            if (xIsNumber && yIsNumber)
            {
                cmp = xValue.CompareTo(yValue);
                if (cmp != 0)
                    return cmp;
            }
            // If x is a number and y is not, x is "lesser than" y
            else if (xIsNumber)
            {
                return -1;
            }
            // If y is a number and x is not, x is "greater than" y
            else if (yIsNumber)
            {
                return 1;
            }

            // OK, neither are number, compare the segments as text
            cmp = xSegments.Current.CompareTo(ySegments.Current, _comparison);
            if (cmp != 0)
                return cmp;
        }

        // At this point, either all segments are equal, or one string is shorter than the other

        // If x is shorter, it's "lesser than" y
        if (x.Length < y.Length)
            return -1;
        // If x is longer, it's "greater than" y
        if (x.Length > y.Length)
            return 1;

        // If they have the same length, they're equal
        return 0;
    }

    private static StringSegmentEnumerator GetSegments(string s) => new StringSegmentEnumerator(s);

    private struct StringSegmentEnumerator
    {
        private readonly string _s;
        private int _start;
        private int _length;
        private int _currentPosition;

        public StringSegmentEnumerator(string s)
        {
            _s = s;
            _start = -1;
            _length = 0;
            _currentPosition = 0;
        }

        public ReadOnlySpan<char> Current => _s.AsSpan(_start, _length);

        public bool MoveNext()
        {
            if (_currentPosition >= _s.Length)
                return false;

            int start = _currentPosition;
            bool isFirstCharDigit = Char.IsDigit(_s[_currentPosition]);

            while (++_currentPosition < _s.Length && Char.IsDigit(_s[_currentPosition]) == isFirstCharDigit)
            {
            }

            _start = start;
            _length = _currentPosition - start;
            return true;
        }
    }
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-09-23T20:25:22.417

扩展之前的几个答案并使用扩展方法，我想出了以下内容，其中没有潜在的多个可枚举枚举的警告，或者与使用多个正则表达式对象或不必要地调用正则表达式有关的性能问题，即话虽如此，它确实使用了 ToList()，它可以否定更大集合中的好处。

选择器支持泛型类型以允许分配任何委托，源集合中的元素由选择器改变，然后使用 ToString() 转换为字符串。

```
 private static readonly Regex _NaturalOrderExpr = new Regex(@"\d+", RegexOptions.Compiled);

    public static IEnumerable<TSource> OrderByNatural<TSource, TKey>(
        this IEnumerable<TSource> source, Func<TSource, TKey> selector)
    {
        int max = 0;

        var selection = source.Select(
            o =>
            {
                var v = selector(o);
                var s = v != null ? v.ToString() : String.Empty;

                if (!String.IsNullOrWhiteSpace(s))
                {
                    var mc = _NaturalOrderExpr.Matches(s);

                    if (mc.Count > 0)
                    {
                        max = Math.Max(max, mc.Cast<Match>().Max(m => m.Value.Length));
                    }
                }

                return new
                {
                    Key = o,
                    Value = s
                };
            }).ToList();

        return
            selection.OrderBy(
                o =>
                String.IsNullOrWhiteSpace(o.Value) ? o.Value : _NaturalOrderExpr.Replace(o.Value, m => m.Value.PadLeft(max, '0')))
                     .Select(o => o.Key);
    }

    public static IEnumerable<TSource> OrderByDescendingNatural<TSource, TKey>(
        this IEnumerable<TSource> source, Func<TSource, TKey> selector)
    {
        int max = 0;

        var selection = source.Select(
            o =>
            {
                var v = selector(o);
                var s = v != null ? v.ToString() : String.Empty;

                if (!String.IsNullOrWhiteSpace(s))
                {
                    var mc = _NaturalOrderExpr.Matches(s);

                    if (mc.Count > 0)
                    {
                        max = Math.Max(max, mc.Cast<Match>().Max(m => m.Value.Length));
                    }
                }

                return new
                {
                    Key = o,
                    Value = s
                };
            }).ToList();

        return
            selection.OrderByDescending(
                o =>
                String.IsNullOrWhiteSpace(o.Value) ? o.Value : _NaturalOrderExpr.Replace(o.Value, m => m.Value.PadLeft(max, '0')))
                     .Select(o => o.Key);
    } 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-03-21T23:52:13.657

我们需要一种自然排序来处理具有以下模式的文本：

```
"Test 1-1-1 something"
"Test 1-2-3 something"
... 
```

出于某种原因，当我第一次查看 SO 时，我没有找到这篇文章并实现了我们自己的。与这里介绍的一些解决方案相比，虽然在概念上相似，但它可能具有更简单和更容易理解的好处。但是，虽然我确实尝试查看性能瓶颈，但它的实现仍然比默认的慢得多`OrderBy()`。

这是我实现的扩展方法：

```
public static class EnumerableExtensions
{
    // set up the regex parser once and for all
    private static readonly Regex Regex = new Regex(@"\d+|\D+", RegexOptions.Compiled | RegexOptions.Singleline);

    // stateless comparer can be built once
    private static readonly AggregateComparer Comparer = new AggregateComparer();

    public static IEnumerable<T> OrderByNatural<T>(this IEnumerable<T> source, Func<T, string> selector)
    {
        // first extract string from object using selector
        // then extract digit and non-digit groups
        Func<T, IEnumerable<IComparable>> splitter =
            s => Regex.Matches(selector(s))
                      .Cast<Match>()
                      .Select(m => Char.IsDigit(m.Value[0]) ? (IComparable) int.Parse(m.Value) : m.Value);
        return source.OrderBy(splitter, Comparer);
    }

    /// <summary>
    /// This comparer will compare two lists of objects against each other
    /// </summary>
    /// <remarks>Objects in each list are compare to their corresponding elements in the other
    /// list until a difference is found.</remarks>
    private class AggregateComparer : IComparer<IEnumerable<IComparable>>
    {
        public int Compare(IEnumerable<IComparable> x, IEnumerable<IComparable> y)
        {
            return
                x.Zip(y, (a, b) => new {a, b})              // walk both lists
                 .Select(pair => pair.a.CompareTo(pair.b))  // compare each object
                 .FirstOrDefault(result => result != 0);    // until a difference is found
        }
    }
} 
```

这个想法是将原始字符串拆分为数字块和非数字块（`"\d+|\D+"`）。由于这是一项潜在的昂贵任务，因此每个条目仅执行一次。然后我们使用可比较对象的比较器（抱歉，我找不到更合适的说法）。它将每个块与另一个字符串中的相应块进行比较。

我希望得到有关如何改进以及主要缺陷是什么的反馈。请注意，在这一点上，可维护性对我们来说很重要，我们目前没有在非常大的数据集中使用它。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-10-10T18:13:09.410

更易于阅读/维护的版本。

```
public class NaturalStringComparer : IComparer<string>
{
    public static NaturalStringComparer Instance { get; } = new NaturalStringComparer();

    public int Compare(string x, string y) {
        const int LeftIsSmaller = -1;
        const int RightIsSmaller = 1;
        const int Equal = 0;

        var leftString = x;
        var rightString = y;

        var stringComparer = CultureInfo.CurrentCulture.CompareInfo;

        int rightIndex;
        int leftIndex;

        for (leftIndex = 0, rightIndex = 0;
             leftIndex < leftString.Length && rightIndex < rightString.Length;
             leftIndex++, rightIndex++) {
            var leftChar = leftString[leftIndex];
            var rightChar = rightString[leftIndex];

            var leftIsNumber = char.IsNumber(leftChar);
            var rightIsNumber = char.IsNumber(rightChar);

            if (!leftIsNumber && !rightIsNumber) {
                var result = stringComparer.Compare(leftString, leftIndex, 1, rightString, leftIndex, 1);
                if (result != 0) return result;
            } else if (leftIsNumber && !rightIsNumber) {
                return LeftIsSmaller;
            } else if (!leftIsNumber && rightIsNumber) {
                return RightIsSmaller;
            } else {
                var leftNumberLength = NumberLength(leftString, leftIndex, out var leftNumber);
                var rightNumberLength = NumberLength(rightString, rightIndex, out var rightNumber);

                if (leftNumberLength < rightNumberLength) {
                    return LeftIsSmaller;
                } else if (leftNumberLength > rightNumberLength) {
                    return RightIsSmaller;
                } else {
                    if(leftNumber < rightNumber) {
                        return LeftIsSmaller;
                    } else if(leftNumber > rightNumber) {
                        return RightIsSmaller;
                    }
                }
            }
        }

        if (leftString.Length < rightString.Length) {
            return LeftIsSmaller;
        } else if(leftString.Length > rightString.Length) {
            return RightIsSmaller;
        }

        return Equal;
    }

    public int NumberLength(string str, int offset, out int number) {
        if (string.IsNullOrWhiteSpace(str)) throw new ArgumentNullException(nameof(str));
        if (offset >= str.Length) throw new ArgumentOutOfRangeException(nameof(offset), offset, "Offset must be less than the length of the string.");

        var currentOffset = offset;

        var curChar = str[currentOffset];

        if (!char.IsNumber(curChar))
            throw new ArgumentException($"'{curChar}' is not a number.", nameof(offset));

        int length = 1;

        var numberString = string.Empty;

        for (currentOffset = offset + 1;
            currentOffset < str.Length;
            currentOffset++, length++) {

            curChar = str[currentOffset];
            numberString += curChar;

            if (!char.IsNumber(curChar)) {
                number = int.Parse(numberString);

                return length;
            }
        }

        number = int.Parse(numberString);

        return length;
    }
} 
```

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2018-11-15T16:13:47.433

让我解释一下我的问题以及我是如何解决它的。

问题：- 根据从目录中检索的 FileInfo 对象中的 FileName 对文件进行排序。

解决方案：- 我从 FileInfo 中选择了文件名并修剪了文件名的“.png”部分。现在，只需执行 List.Sort()，它以自然排序顺序对文件名进行排序。根据我的测试，我发现 .png 会打乱排序顺序。看看下面的代码

```
var imageNameList = new DirectoryInfo(@"C:\Temp\Images").GetFiles("*.png").Select(x =>x.Name.Substring(0, x.Name.Length - 4)).ToList();
imageNameList.Sort(); 
```

# user-interface - UI 是否受版权保护？

> ID：248606
> 
> 赞同：15
> 
> 时间：2008-10-29T22:06:28.867
> 
> 标签：user-interface

或多或少地“复制”（或委婉地说，非常“受其启发”）受版权保护程序的想法和 UI 是否合法？当我看到“ [Things](http://culturedcode.com/things/) ”这是一个仅限 Mac 的程序时，这个问题突然出现在我的脑海中。

使用基本相同的 UI 设计和功能集制作该程序的 Windows 版本是否合法？侵犯版权的法律界限在哪里？

除非您另有说明，否则我假设任何答案都是“IANAL”，因此您不必写。;)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-29T22:12:09.167

设计的特定元素可以受版权保护。苹果赢得了“垃圾桶”图标，但在微软/苹果的诉讼中，外观和感觉实际上没有其他任何东西。只要代码完全是您自己的，图形就是您自己的（是的，复制太近的*特定*图形元素如垃圾桶可能是一个问题）并且您没有在克隆与商标/商标相关的元素，您应该在法律范围内（在美国）。

当然，这并不意味着有人不能*起诉*你。无理取闹的官司无时无刻不在进行恐吓。另请注意，专利可以涵盖用户与 UI 的交互，因此在某些情况下版权可能不是您的主要问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T22:14:36.153

在软件中，版权涵盖代码本身以及文本内容或图像等内容。您应该担心的问题不是版权或商标，而是专利。复制通用设计和功能集可能会与他们提交的任何专利发生冲突。尽管小公司不太可能申请足够多的专利来真正阻碍制作 Windows 或 Linux 的克隆。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T23:25:35.243

如果您正在寻找设计灵感，而不是尝试使用现有的位图，那么您可能没问题。但是可能存在保护特定产品免受“复制”混淆的设计专利和商标问题。也可能有保护软件工作方式的特定专利。

这里有一个实际的方面——如果你正在为（嗯）鼓舞人心的作品的所有者写一些“小薯条”，你永远不必担心它。但是，如果您的业务依赖它，您可能应该咨询律师......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T23:09:00.927

阅读来自主要 LLBLGen 应用程序开发人员的[此](http://weblogs.asp.net/fbouma/archive/2008/07/20/the-evil-of-the-office-ui-ribbon-license.aspx)博客条目。尽管 Microsoft 严格不对其许可证进行版权保护，但它使用法律手段来保护其在此特定 UI 元素中的创新/演变。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T23:15:37.183

我可能在这里暴露了我的年龄。

有很多灰色地带，但“外观”一词几乎起源于一场诉讼。

[外观诉讼](http://www.duke.edu/eng169s2/group1/lex4/prot8.htm)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T23:04:55.007

阅读[Apple 与 Microsoft](http://en.wikipedia.org/wiki/Apple_v._Microsoft)的对比。只要 UI*不是*创建此类界面的唯一方式，它就具有版权。顺便说一句，Apple vs. Microsoft 并不是一个很好的判断方法，因为微软已经从 Apple 获得了很大一部分 UI 的授权：

> Apple 提出了一个包含 189 个 GUI 元素的列表；法官裁定，其中 179 个元素已在 Windows 1.0 协议中授权给 Microsoft，其余 10 个元素中的大多数都没有版权——它们不是 Apple 原创的，或者它们是表达特定想法的唯一可能方式。

就算不违法，也肯定是不道德的。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-29T22:13:35.670

我认为总的来说答案是否定的，这不会是非法的。苹果试图起诉微软窃取 Mac OS 的“外观和感觉”，结果败诉了……有很多 linux 程序，几乎完全复制了类似 windows 程序的 UI……

# c# - 基于 const 值强制 C# 编译器错误

> ID：248615
> 
> 赞同：2
> 
> 时间：2008-10-29T22:10:32.230
> 
> 标签：c#, compiler-construction

我在 C# 类中定义了一个私有 const int。如果这个 int mod 3 != 0 的值，我希望编译失败并出现错误。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T22:24:57.097

Timothy Khouri 几乎明白了。应该是这样的：

```
int compilerError = 1 / (MY_CONST % 3 == 0 ? 1 : 0); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T22:18:58.250

尽管有一个[*#error*](http://msdn.microsoft.com/en-us/library/x5hedts0.aspx)预处理器指令用于生成编译时错误，但它无法基于 const 值的存在。它仅适用于无法为其分配值的编译器符号，例如“DEBUG”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T22:20:55.857

抱歉，我在下面说的代码不起作用，但这会:)

```
int pointless = 1 / (MY_CONST % 3); 
```

这会起作用的原因是因为你会得到一个编译时间，“不能除以零”的错误。您的“MY_CONST”字段必须是（一旦修改为 3）不等于零的任何内容。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-29T22:18:59.497

试试这个：

```
if (MY_CONST % 3 != 0) { int compilerError = 1 / 0; } 
```

# c++ - c ++将方法添加到头文件中定义的类

> ID：248617
> 
> 赞同：13
> 
> 时间：2008-10-29T22:11:11.930
> 
> 标签：c++, file, class, header, methods

我想知道是否可以将主程序中的方法添加到头文件中定义的现有类中。例如：`class CFun`在文件中定义了`CFun.hpp`，但是在我们的中`party.cpp`我们要添加一个方法`void hello() {cout << "hello" << endl;};`而不需要编辑`CFun.hpp`

显然（不幸的是）构造：

```
#include "CFun.hpp"

class CFun
{
  public:
    void hello() {cout << "hello" << endl;};
}; 
```

不起作用返回错误`Multiple declaration for 'CFun'`

是否可以在没有类继承的情况下使其工作？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-29T22:20:44.627

不，但是您可以添加一个方法来获取 CFun 类的引用/指针 - 您只是无法访问私有数据：

```
void Hello(CFun &fun)
{
    cout << "hello" << endl;
} 
```

这可能是你能做到的最好的。正如 litb 所指出的 - 此函数必须与 CFun 位于相同的命名空间中。幸运的是，与类不同，命名空间可以添加到多个位置。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-01-21T09:35:13.483

您可以像这样重新定义类：

```
#define CFun CLessFun
#include "CFun.hpp"
#undef CFun

class CFun : CLessFun
{
   public:
    void hello() {cout << "hello" << endl;};
}; 
```

把它放在一个新的头文件中`CMoreFun.hpp`并包含它而不是`CFun.hpp`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T22:20:49.617

不，那是不可能的。任何特定类只能有一个定义，并且必须是完整的定义，这意味着您不能在不同的地方有部分定义，向类添加成员。

如果您需要将成员函数添加到类中，那么您必须更改类定义（编辑 CFun.hpp），或者从中派生一个新类`CFun`并将其放在`hello()`那里。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-29T22:33:38.390

与 C++ 中这种构造（向预定义类添加功能）最接近的类似物是装饰器模式。这不完全是你所追求的，但它可能会让你做你需要的事情。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-09-15T14:24:15.770

这似乎是一个明显的继承用例。定义一个新类：

```
#include "CFun.hpp"

class CFun2 : public CFun
{
  public:
    void hello() {cout << "hello" << endl;};
}; 
```

然后在源代码中使用`CFun2`而不是。`CFun`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-29T22:30:55.260

仔细考虑之后，您可能会做一些可怕的事情：在 CFun 中找到一些具有您想要的返回类型的函数，并且在整个标头中只提及一次。比方说`void GoodBye()`。

现在创建一个包含以下内容的文件 CFunWrapper.hpp：

```
#define GoodBye() Hello() { cout << "hello" << endl; } void GoodBye()
#include "CFun.hpp"
#undef GoodBye 
```

然后只包含 CFunWrapper.hpp 而不是 CFun.hpp。

但是不要这样做，除非有一些非常好的理由这样做。根据 CFun.hpp 的内容，它非常容易损坏，甚至可能不可能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T22:12:39.760

据我所知不是。虽然，您可以进行某种陪审团操纵并制定命名空间解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-28T01:26:56.537

```
class Party : class CFun 
```

（你的派对.cpp）

继承 CFun 的东西，包括 hello() 函数。

所以...

```
Party p;
p.hello(); 
```

不？

# sql - 针对网页的 SQL 查询（或高级查找）

> ID：248618
> 
> 赞同：1
> 
> 时间：2008-10-29T22:11:40.260
> 
> 标签：sql, html, find

假设我有[一张桌子](http://www.eia.doe.gov/emeu/aer/txt/ptb0808.html)。现在，我对轻松获取有用数据很感兴趣。这意味着我宁愿不要将它放入 Excel 并经过扭曲，也不要以某种方式将其放入 CSV，然后放入 DB，然后放入 SQL。

我希望能够直接针对 HTML 中的表执行 SQL 查询。

有没有人听说过这样的工具？我从来没有见过一个。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T22:33:33.930

据我所知，没有工具可以使用 SQL 查询 HTML 表，但[XQuery](http://www.w3schools.com/xquery/)是一种标准语言，您可以使用它在 XML 或 XHTML 源中查找元素，其方式与使用 SQL 查询数据库非常相似。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T22:17:36.880

不，绝对没有工具可以让您对 HTML 表运行 SQL 查询……但如果您有想要完成的特定查询，您可以轻松编写一些简单的 JavaScript。

# asp.net - ASP.NET 中是否存在共享会话的概念？

> ID：248640
> 
> 赞同：3
> 
> 时间：2008-10-29T22:19:39.807
> 
> 标签：asp.net, wcf, silverlight, caching, duplex

我正在开发一个由单个页面组成的 Web 应用程序 (ASP.NET) 游戏，在该页面上，会有一个类似于 Monopoly 的游戏板。我正在尝试确定最好的架构方法是什么。到目前为止，我确定的主要要求是：

*   最多六个用户共享一个游戏状态对象。
*   用户需要保持（相对）最新的游戏当前状态，即轮到谁了，活跃用户刚刚滚动了什么，其他用户有多少钱，等等。

我曾考虑将游戏状态保存在数据库中，但是当游戏状态对象（例如，在缓存中）可以保持最新时，继续更新数据库似乎有点过头了。例如，流程可能是这样的：

1.  接收来自用户的数据请求。
2.  在数据库中查找数据。从该数据创建对象。
3.  验证用户是否有权根据游戏状态执行请求（即确保确实轮到他们或有足够的钱购买该属性）。
4.  更新游戏对象。
5.  将游戏对象写回数据库。
6.  对每个请求重复。

*考虑到单个服务器将服务多个并发游戏。*

1.  我曾考虑过使用 AJAX 向 ASP.NET 页面发出请求。

2.  我曾考虑过使用 Silverlight 对 Web 服务使用 AJAX 请求。

3.  我曾考虑在 Silverlight 中使用 WCF 双工通道。

我无法弄清楚最好的方法是什么。似乎都有自己的缺点。有没有人有这种事情的经验并愿意分享这些经验？如果我太模棱两可，请随时提出您自己的问题！谢谢。

**更新：是否有人对如何根据我上面提到的三个选项实现与服务器的连接有任何建议？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T22:28:51.257

您可以使用 ASP.Net 缓存或应用程序状态来存储游戏对象，因为它们是在用户之间共享的。缓存可能是最好的地方，因为可以从中删除对象以节省内存。

如果您使用唯一密钥将游戏对象存储在缓存中，则可以将密钥存储在每个访问者会话中，并使用它来检索共享的游戏对象。如果缓存已被清除，您将从数据库中重新创建对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T22:41:52.290

虽然更新数据库看起来有点矫枉过正，但它在扩大规模时具有优势，因为您可以让多个 Webhead 与一个后端通信。

一个更大的问题是您如何将游戏状态传达给客户端。虽然不时全面更新游戏状态可确保捕获任何更改并且所有客户端即使错过消息也保持同步，但游戏状态通常非常大。

还要考虑通常您希望游戏状态消息触发动画或其他显示更新来描绘动作（例如，一块移动，它不应该在大多数情况下只出现在目的地......它应该全面移动）。

正因为如此，结合了两全其美的解决方案是保留一个数据库，该数据库收集在表中执行的所有*操作*，并具有顺序 ID。当客户端请求更新时，它可以给出它所知道的最后一个动作*之后的所有动作，并且客户端可以“执行”这些动作。*这意味着即使请求失败，它也可以简单地重试请求，并且不会丢失任何操作。

然后，服务器也可以根据相同的数据维护游戏状态的内部视图。它还可以拒绝非法动作并阻止它们进入游戏动作表（从而防止其他客户端被错误更新）。

最后，因为服务器确实有“一个真正的”游戏状态，客户端可以定期检查（这将允许您在客户端或服务器代码中发现错误）。因为服务器数据库应该被认为是主要的，所以您可以将整个游戏状态重新传输到任何获得不正确状态的客户端，因此轻微的客户端错误不会（可能）破坏体验（除了可能在下载状态时暂停）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T22:50:38.607

为什么不创建一个应用程序级对象来存储您的详细信息。有关详细信息，请参阅[ASP.NET 中的应用程序状态和全局变量](http://www.dotnetheaven.com/UploadFile/mahesh/ApplicationState05102005051501AM/ApplicationState.aspx?ArticleID=e42f0985-9927-4fba-86bb-0012e072a0dc)。您可以使用 sessionID 作为每个玩家数据的键。

您也可以使用缓存来做同样的事情，但需要很长时间。这样做的好处是，可以在一段时间（即 6 小时或其他时间）后从缓存中刷新旧数据。

# gridview - GridView 项目文本换行

> ID：248642
> 
> 赞同：2
> 
> 时间：2008-10-29T22:20:37.903
> 
> 标签：gridview, word-wrap

我有一个在运行时动态创建的 GridView 控件。我正在创建这样的所有列。

```
foreach (GridColumnConfig column in columns)
{
    BoundField boundField = new BoundField();
    boundField.HeaderText = column.Title;
    boundField.DataField = column.FieldName;
    boundField.SortExpression = column.FieldName;
    boundField.ItemStyle.Wrap = false;
    boundField.ItemStyle.Width = new Unit(column.Width, UnitType.Pixel);
    boundField.ItemStyle.HorizontalAlign = TextToAlign(column.Align);
    m_GenericListView.Grid.Columns.Add(boundField);        
} 
```

然而，即使我已指定该项目不换行文本，它仍然在 IE6 中这样做。在 FireFox 中，它只是创建了一个非常宽的列，即使宽度已经指定，也可能不是这样。

有什么方法可以真正控制这些宽度并在 GridView 中包装列？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T22:24:23.667

当我想控制换行时，自动换行 CSS 样式对我有用。这是一个很好的讨论。

[http://bytes.com/forum/thread627827.html](http://bytes.com/forum/thread627827.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-01-06T16:13:21.560

您可以将其添加到 gridview - Style="white-space: nowrap"

Gridview 没有名为 style 的属性，但您可以添加它，它会起作用。

或者您可以声明一个 CSS 类并将其分配给 gridview

# activemq - 如何观察 ActiveMQ 底层发生的事情？

> ID：248664
> 
> 赞同：4
> 
> 时间：2008-10-29T22:27:40.073
> 
> 标签：activemq

我遇到了ActiveMQ[问题](https://stackoverflow.com/questions/248182/my-c-activemq-client-can-send-messages-but-not-receive-messages)，想跟踪/查看所有 ActiveMQ 活动。我能找到的唯一日志文件是与持久数据相关联的（如果打开的话）。我是否查看或生成了任何其他日志文件来告诉我 ActiveMQ 底层发生了什么以及为什么我的消费者不使用消息？还有其他建议吗？

提前致谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T23:03:09.487

activemq 有一个可以连接的 jmx 接口。

这使我们可以访问排队出队的消费者计数消息以及有关内存使用情况等的各种数据。

[http://activemq.apache.org/jmx.html](http://activemq.apache.org/jmx.html)

拥有让您入门的所有详细信息。

我发现它非常适合找出 activemq 的情况。

A quick firing up of jconsole and you will be well on your way to finding out what is going on.

Paul

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T07:19:31.700

Agreed. Also you can add the [logging interceptor](http://activemq.apache.org/logging-interceptor.html) which helps.

Finally for browsing messages, moving them, creating/deleting queues and sending message I highly recommend the new web console for ActiveMQ, Camel and many other [plugins](http://hawt.io/plugins/index.html): [hawtio](http://hawt.io/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-11-26T18:14:53.703

Try [HawtIO](http://hawt.io/). Assuming you are not using Active MQ 5.9 you can add this feature to your broker. It is a much better web console and a good JMX monitoring utility as well.

[http://www.christianposta.com/blog/?p=315](http://www.christianposta.com/blog/?p=315)

# iphone - 在 iPhone 上切片 UIImage

> ID：248667
> 
> 赞同：13
> 
> 时间：2008-10-29T22:28:56.623
> 
> 标签：iphone, objective-c, cocoa-touch, image-manipulation

目标：取一个 UIImage，在中间裁剪一个正方形，将正方形的大小更改为 320x320 像素，将图像切成 16 个 80x80 的图像，将 16 个图像保存在一个数组中。

这是我的代码：

```
CGImageRef originalImage, resizedImage, finalImage, tmp;
float imgWidth, imgHeight, diff;
UIImage *squareImage, *playImage;
NSMutableArray *tileImgArray;
int r, c;

originalImage = [image CGImage];

imgWidth = image.size.width;
imgHeight = image.size.height;
diff = fabs(imgWidth - imgHeight);

if(imgWidth > imgHeight){
    resizedImage = CGImageCreateWithImageInRect(originalImage, CGRectMake(floor(diff/2), 0, imgHeight, imgHeight));
}else{
    resizedImage = CGImageCreateWithImageInRect(originalImage, CGRectMake(0, floor(diff/2), imgWidth, imgWidth));
}
CGImageRelease(originalImage);

squareImage = [UIImage imageWithCGImage:resizedImage];      
if(squareImage.size.width != squareImage.size.height){
    NSLog(@"image cutout error!");
    //*code to return to main menu of app, irrelevant here
}else{
    float newDim = squareImage.size.width;
    if(newDim != 320.0){
        CGSize finalSize = CGSizeMake(320.0, 320.0);
        UIGraphicsBeginImageContext(finalSize);
        [squareImage drawInRect:CGRectMake(0, 0, finalSize.width, finalSize.height)];
        playImage = UIGraphicsGetImageFromCurrentImageContext();
        UIGraphicsEndImageContext();
    }else{
        playImage = squareImage;
    }
}

finalImage = [playImage CGImage];
tileImgArray = [NSMutableArray arrayWithCapacity:0];
for(int i = 0; i < 16; i++){
    r = i/4;
    c = i%4;
    //*
    tmp = CGImageCreateWithImageInRect(finalImage, CGRectMake(c*tileSize, r*tileSize, tileSize, tileSize));
    [tileImgArray addObject:[UIImage imageWithCGImage:tmp]];
} 
```

当原始（可变图像）的较小尺寸大于或小于 320 像素时，代码可以正常工作。当它正好是 320 时，生成的 80x80 图像几乎完全是黑色的，有些边缘有几个像素（我无法确定）来自原始图像。

我通过直接显示完整图像进行了测试：

```
[UIImage imageWithCGImage:finalImage]; 
```

间接地：

```
[UIImage imageWithCGImage:CGImageCreateWithImageInRect(finalImage, CGRectMake(0, 0, 320, 320))]; 
```

在这两种情况下，显示都有效。只有当我尝试切出图像的某些部分时才会出现问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T03:11:14.540

经过更多的实验，我找到了以下解决方案（虽然我仍然不知道为什么它没有像最初写的那样工作。）但是无论如何，即使不需要调整大小，在调整大小代码到位后切片仍然有效：

```
if(newDim != 320.0){
            CGSize finalSize = CGSizeMake(320.0, 320.0);
            UIGraphicsBeginImageContext(finalSize);
            [squareImage drawInRect:CGRectMake(0, 0, finalSize.width, finalSize.height)];
            playImage = UIGraphicsGetImageFromCurrentImageContext();
            UIGraphicsEndImageContext();
}else{
            CGSize finalSize = CGSizeMake(320.0, 320.0);
            UIGraphicsBeginImageContext(finalSize);
            [squareImage drawInRect:CGRectMake(0, 0, finalSize.width, finalSize.height)];
            playImage = UIGraphicsGetImageFromCurrentImageContext();
            UIGraphicsEndImageContext();
} 
```

任何人都知道为什么会这样？

PS 是的，这里不再需要 if/else。但是，在我知道它会起作用**之前**将其删除是愚蠢的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-07T18:14:49.743

只是出于好奇，当您知道要在其中放入 16 个东西时，为什么要使可变数组的边界为 0？

好吧，除此之外，我已经尝试了您用于调整大小和切片的基本技术（我不需要裁剪，因为我正在处理已经是方形的图像）并且我无法在模拟器。您可能想尝试将代码分解为三个单独的函数（裁剪为正方形、调整大小和切片），然后分别测试这三个函数，以便找出三个步骤中的哪一个导致问题（即输入图像您已经在普通的图形程序中进行操作，而不是使用目标 c，然后检查您得到的结果！）。

我将在下面附上我的调整大小和切片功能版本，希望对您有所帮助。很高兴看到你的版本，因为我不必一次就自己找到所有的方法。:)

需要注意的是，提到的二维数组是我自己用 NSMutableArrays 构建的类，但您可以轻松实现自己的版本或使用平面 NSMutableArray。;)

```
// cut the given image into a grid of equally sized smaller images
// this assumes that the image can be equally divided in the requested increments
// the images will be stored in the return array in [row][column] order
+ (TwoDimensionalArray *) chopImageIntoGrid : (UIImage *) originalImage : (int) numberOfRows : (int) numberOfColumns
{   
// figure out the size of our tiles
int tileWidth = originalImage.size.width / numberOfColumns;
int tileHeight = originalImage.size.height / numberOfRows;

// create our return array
TwoDimensionalArray * toReturn = [[TwoDimensionalArray alloc] initWithBounds : numberOfRows 
                                                                             : numberOfColumns];

// get a CGI image version of our image
CGImageRef cgVersionOfOriginal = [originalImage CGImage];

// loop to chop up each row
for(int row = 0; row < numberOfRows ; row++){
    // loop to chop up each individual piece by column
    for (int column = 0; column < numberOfColumns; column++)
    {
        CGImageRef tempImage = 
                CGImageCreateWithImageInRect(cgVersionOfOriginal, 
                                             CGRectMake(column * tileWidth, 
                                                        row * tileHeight, 
                                                        tileWidth, 
                                                        tileHeight));
        [toReturn setObjectAt : row : column : [UIImage imageWithCGImage:tempImage]];
    }
}

// now return the set of images we created
return [toReturn autorelease];
}

// this method resizes an image to the requested dimentions
// be a bit careful when using this method, since the resize will not respect
// the proportions of the image
+ (UIImage *) resize : (UIImage *) originalImage : (int) newWidth : (int) newHeight
{   
// translate the image to the new size
CGSize newSize = CGSizeMake(newWidth, newHeight); // the new size we want the image to be
UIGraphicsBeginImageContext(newSize); // downside: this can't go on a background thread, I'm told
[originalImage drawInRect : CGRectMake(0, 0, newSize.width, newSize.height)];
UIImage* newImage = UIGraphicsGetImageFromCurrentImageContext(); // get our new image
UIGraphicsEndImageContext();

// return our brand new image
return newImage;
} 
```

伊娃·希弗

# perl - 有没有一种简单的方法来进行批量文件文本替换？

> ID：248668
> 
> 赞同：12
> 
> 时间：2008-10-29T22:29:02.987
> 
> 标签：perl, search, command-line, replace, bulk

我一直在尝试编写一个 Perl 脚本来替换我项目的所有源文件中的一些文本。我需要类似的东西：

```
perl -p -i.bak -e "s/thisgoesout/thisgoesin/gi" *.{cs,aspx,ascx} 
```

**但这会递归地**解析目录的**所有**文件。

 **我刚刚开始了一个脚本：

```
use File::Find::Rule;
use strict;

my @files = (File::Find::Rule->file()->name('*.cs','*.aspx','*.ascx')->in('.'));

foreach my $f (@files){
    if ($f =~ s/thisgoesout/thisgoesin/gi) {
           # In-place file editing, or something like that
    }
} 
```

但现在我被困住了。有没有一种简单的方法可以使用 Perl 编辑所有文件？

请注意，我不需要保留每个修改文件的副本；我把他们都颠覆了=）

**更新：我在**[Cygwin](http://en.wikipedia.org/wiki/Cygwin)上试过这个，

```
perl -p -i.bak -e "s/thisgoesout/thisgoesin/gi" {*,*/*,*/*/*}.{cs,aspx,ascx 
```

但看起来我的参数列表已爆炸到允许的最大大小。事实上，我在 Cygwin 上遇到了非常奇怪的错误......

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-29T23:46:25.967

如果您`@ARGV`在使用之前分配`*ARGV`（又名菱形`<>`），`$^I`/`-i`将处理这些文件而不是命令行上指定的文件。

```
use File::Find::Rule;
use strict;

@ARGV = (File::Find::Rule->file()->name('*.cs', '*.aspx', '*.ascx')->in('.'));
$^I = '.bak';  # or set `-i` in the #! line or on the command-line

while (<>) {
    s/thisgoesout/thisgoesin/gi;
    print;
} 
```

这应该完全符合您的要求。

如果您的模式可以跨越多行，请`undef $/;`在 the 之前添加一个，`<>`以便 Perl 一次对整个文件进行操作，而不是逐行操作。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-29T23:19:24.273

您可能对[File::Transaction::Atomic](http://search.cpan.org/perldoc?File::Transaction::Atomic)或[File::Transaction感兴趣](http://search.cpan.org/perldoc?File::Transaction)

F::T::A 的 SYNOPSIS 看起来与您尝试执行的操作非常相似：

```
 # In this example, we wish to replace 
  # the word 'foo' with the word 'bar' in several files, 
  # with no risk of ending up with the replacement done 
  # in some files but not in others.

  use File::Transaction::Atomic;

  my $ft = File::Transaction::Atomic->new;

  eval {
      foreach my $file (@list_of_file_names) {
          $ft->linewise_rewrite($file, sub {
               s#\bfoo\b#bar#g;
          });
      }
  };

  if ($@) {
      $ft->revert;
      die "update aborted: $@";
  }
  else {
      $ft->commit;
  } 
```

再加上 File::Find 你已经写好了，你应该很高兴。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-29T23:28:14.053

您可以使用 Tie::File 可扩展地访问大文件并就地更改它们。请参阅联机帮助页（man 3perl Tie::File）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-29T23:19:08.313

改变

```
foreach my $f (@files){
    if ($f =~ s/thisgoesout/thisgoesin/gi) {
           #inplace file editing, or something like that
    }
} 
```

到

```
foreach my $f (@files){
    open my $in, '<', $f;
    open my $out, '>', "$f.out";
    while (my $line = <$in>){
        chomp $line;
        $line =~ s/thisgoesout/thisgoesin/gi
        print $out "$line\n";
    }
} 
```

这假设该模式不跨越多行。如果模式可能跨行，您需要在文件内容中啜饮。（“slurp”是一个非常常见的 Perl 术语）。

chomp 实际上并不是必需的，我只是被那些没有被`chomp`ed 一次的线条咬了太多次（如果你放弃`chomp`，更改`print $out "$line\n";`为`print $out $line;`）。

同样，您可以更改`open my $out, '>', "$f.out";`为`open my $out, '>', undef;`打开一个临时文件，然后在替换完成后将该文件复制回原始文件。事实上，特别是如果你在整个文件中啜饮，你可以简单地在内存中进行替换，然后覆盖原始文件。但是我犯了足够多的错误，我总是写入一个新文件，并验证内容。

* * *

**请注意**，我最初在该代码中有一个 if 语句。那很可能是错误的。那只会复制与正则表达式“thisgoesout”匹配的行（当然用“thisgoesin”替换），同时默默地吞噬其余部分。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T22:35:36.093

你可以使用`find`：

```
find . -name '*.{cs,aspx,ascx}' | xargs perl -p -i.bak -e "s/thisgoesout/thisgoesin/gi" 
```

这将递归列出所有文件名，然后`xargs`将读取其标准输入并运行命令行的其余部分，并在末尾附加文件名。一件好事`xargs`是，如果它构建的命令行太长而无法一次性运行，它将多次运行命令行。

请注意，我不确定是否`find`完全理解选择文件的所有 shell 方法，所以如果上述方法不起作用，那么也许尝试：

```
find . | grep -E '(cs|aspx|ascx)$' | xargs ... 
```

当使用这样的管道时，我喜欢在继续之前构建命令行并单独运行每个部分，以确保每个程序都能获得它想要的输入。因此，您无需`xargs`先检查即可运行该部件。

我突然想到，尽管您没有这么说，但由于您要查找的文件后缀，您可能在 Windows 上。在这种情况下，可以使用 Cygwin 运行上述管道。可以编写一个 Perl 脚本来做同样的事情，就像您开始做的那样，但是您必须自己进行就地编辑，因为在这种情况下您无法利用`-i`开关。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T23:30:56.573

感谢 ehemient on this question 和 on [this answer](https://stackoverflow.com/questions/125171/passing-a-regex-substitution-as-a-variable-in-perl#125329)，我得到了这个：

```
use File::Find::Rule;
use strict;

sub ReplaceText {
    my $regex = shift;
    my $replace = shift;

    @ARGV = (File::Find::Rule->file()->name('*.cs','*.aspx','*.ascx')->in('.'));
    $^I = '.bak';
    while (<>) {
        s/$regex/$replace->()/gie;
        print;
    }
}

ReplaceText qr/some(crazy)regexp/, sub { "some $1 text" }; 
```

现在我什至可以遍历包含 regexp=>subs 条目的散列！

# c# - 使用字符串动态创建 (LLBLGen) Linq 查询

> ID：248682
> 
> 赞同：2
> 
> 时间：2008-10-29T22:37:08.760
> 
> 标签：c#, linq, dynamic, runtime, llblgenpro

我们需要生成在编码期间（设计时）100% 未知的 LINQ 查询。这是因为逻辑在我们的框架中可用，它与任何数据项目 100% 分离。对于数据，我们使用 LLBLGen 生成的数据访问代码。

通常通过在 DLL 上使用调用，我们指定给框架（而不是引用），我们可以创建代码来检索数据。但是现在我们需要通过 linq 来做这件事。我们如何创建如下查询：

```
var q = from customer in m.Customer
        select new
        {                   
            customer.Number,
            customer.City,
            customer.CountryEntity.Name             
        }; 
```

仅来自字符串。我们将有一个名为“customer”的字符串，所以我们知道我们必须从 Customer 中检索。然后我们会有一个包含我们想要检索的字段名的字符串[]。如您所见，这些列可能包含复杂类型（相关字段）。

任何建议，尤其是与 LLBLGen 结合使用时，都会很棒！

谢谢， 加布

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T23:02:31.953

我不确定这是否正是您要寻找的，但 Scott Gu 在他的博客上有一篇关于使用动态 LINQ 的文章。[http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)

它可能无法满足您的所有需求，但它可能会为您提供一些帮助。

编辑。我只是看了一下 Scott Gu 的一些示例代码，发现它可以完成您需要的选择部分。示例（这是 Scotts 代码）：

```
Dim query = db.Customers.Where("City == @0 and Orders.Count >= @1", "London", 10). _
                OrderBy("CompanyName"). _
                Select("New(CompanyName as Name, Phone)") 
```

如您所见，底部位有一个动态选择。

为了解决在运行时动态知道要查询哪个对象的问题，您可以这样做：

```
 Sub query(Of T)(ByVal Myobject As IQueryable(Of T))
    Dim i = Myobject.Select("New(customer.Number)")
 End Sub 
```

然后，您可以在从数据库中读取名称后进行一点切换，如下所示：

```
Sub PassIt()
    Dim name = "customer"
    Select Case name
        Case "customer"
            query(m.Customer)
    End Select
End Sub 
```

希望这可以帮助。笔记！会有更好的方法来完成最后一部分（passit 方法），但要在一大早就想到它。

抱歉，答案在 VB 中，我应该在 C# 中完成

# sql - 如何在 MySQL 的两列上执行布尔逻辑？

> ID：248683
> 
> 赞同：6
> 
> 时间：2008-10-29T22:38:43.217
> 
> 标签：sql, mysql, select, boolean

我想在 MySql 中做一个选择，它结合了几列......像这样的伪代码：

```
SELECT payment1_paid AND payment2_paid AS paid_in_full 
FROM denormalized_payments 
WHERE payment1_type = 'check'; 
```

**编辑**： payment1_paid 和 payment2_paid 是布尔值。

除了MySql，我不能使用任何其他语言来解决这个特定问题。

谢谢你的帮助！

**编辑**：对于所有给我求和和连接建议的人，我很抱歉，但我已经投票赞成那些早期的答案，因为它们无论如何都是有用的。感谢**大家**的快速回答！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T22:50:55.813

好的，为了合乎逻辑，你可以做

```
Select (payment1_paid && payment2_paid) as paid_in_full 
from denormalized_payments 
where payment1_type = 'check'; 
```

[如此处](http://dev.mysql.com/doc/refman/5.0/en/logical-operators.html#operator_and)所见。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T22:42:06.190

做就是了

```
Select CONCAT(payment1_paid, payment2_paid) as paid_in_full 
from denormalized_payments 
where payment1_type = 'check'; 
```

您可以连接任意数量的字段。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T22:43:29.633

如果通过组合你的意思是连接，那么这将起作用：

```
select concat(payment1_paid, payment2_paid) as paid_in_full
from denormalized_payments where payment1_type = 'check'; 
```

如果通过组合你的意思是添加，那么这应该工作：

```
select payment1_paid + payment2_paid as paid_in_full
from denormalized_payments where payment1_type = 'check'; 
```

[编辑]

对于布尔 AND：

```
select payment1_paid && payment2_paid as paid_in_full
from denormalized_payments where payment1_type = 'check'; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T22:44:05.250

我不确定，但你的意思是连接吗？

```
SELECT CONCAT(ColumnA, ColumnB) AS ColumnZ
FROM Table 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T22:46:51.530

`SELECT IF(payment1_paid = 1 AND payment2_paid = 1, 1, 0) AS paid_in_fill`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T22:48:58.593

如果是字符串（或者您想将要组合的列视为字符串），您可以使用[CONCAT](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_concat)和[CONCAT_WS](http://dev.mysql.com/doc/refman/5.0/en/string-functions.html#function_concat-ws)。祝你好运！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-29T23:12:35.723

```
select (payment1_paid && payment2_paid) as paid_in_full
from denormalized_payments where payment1_type = 'check'; 
```

# ajax - 最喜欢经典 ASP 的 AJAX 库？

> ID：248688
> 
> 赞同：2
> 
> 时间：2008-10-29T22:43:24.143
> 
> 标签：ajax, json, asp-classic, vbscript

只是想知道对于经典 ASP（VBScript）是否有任何好的 AJAX 服务器端库（更喜欢 JSON 而不是 XML，但任何东西都很好）......

如果它已经在工作和调试，而不是重新发明轮子。

干杯，加斯帕德

编辑：服务器端 ASP VBScript... 我已经看到了许多 javascript 客户端库。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T22:45:38.680

试试[jQuery](http://jquery.com/)。太奇妙了！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T08:37:38.093

我正在使用[ajaxed](http://www.webdevbros.net/ajaxed/)，它似乎是为数不多的仍然为经典 asp 维护的 ajax 库之一。它对我来说工作得很好。它使用prototypejs 作为它的js 库。完全支持 JSON。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T17:15:29.233

您实际上并不需要服务器端库。接受来自 AJAX 的 POST 和 GET 与以“老式”方式接受它们相同。这里的关键是好的设计模式。

我通常使用单个函数在 Javascript 中调度我的简单 Ajax 调用（我使用[Prototype](http://prototypejs.org)）：

```
function fetch(elelment,cmd,id) {
    //general purpose AJAX function
    $(elelment).innerHTML='Loading...<br /><img src="/images/spinner.gif">'
    now = new Date()
    url = 'http://..../Ajax.asp?CMD='+cmd+'&ID='+pid+'&now='+now
    new Ajax.Updater(elelment, url, { method: 'get' });
} 
```

然后在服务器端，我通常使用选择案例，通过命令将其分解，通过传递的 ID 获取记录，然后输出一个 HTML 片段。我通常会构建一个函数来分别吐出我需要的任何 JSON。

# asp.net-mvc - 涵盖 Asp.Net Web Apps 的功能测试软件/框架？

> ID：248692
> 
> 赞同：2
> 
> 时间：2008-10-29T22:44:19.540
> 
> 标签：asp.net-mvc, testing, automated-tests, functional-testing

我最近开始使用[NexusLight](http://www.codeplex.com/aspnet/Wiki/View.aspx?title=ASP.NET%20QA)，一个功能测试自动化框架。是否有更多的框架可以做类似的工作？

相关问题：[从用户角度进行端到端应用程序测试](https://stackoverflow.com/questions/91703/end-to-end-application-testing-from-a-users-standpoint)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T21:37:21.390

我多年来一直测试 asp.net 网络应用程序，我使用的唯一工具是[Watir](http://wtr.rubyforge.org/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T23:04:14.070

我还没有真正研究过 NexusLight，但我认为[InCisif.net](http://www.incisif.net/)也应该提供一个功能测试框架。你可以调查一下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-18T14:47:22.010

如果您正在寻找功能测试自动化，VSTT 2010 应该是一个不错的选择。Web 服务测试、UI 测试、Biztalk 测试和数据驱动测试支持。请查看 VSTT - [http://msdn.microsoft.com/en-us/library/ee338734(v=vs.90).aspx](http://msdn.microsoft.com/en-us/library/ee338734(v=vs.90).aspx)

您也可以尝试 VSTT - [http://blogs.msdn.com/b/slumley/archive/2009/05/28/vsts-2010-feature-enhancements-for-web-test-playback-ui.aspx](http://blogs.msdn.com/b/slumley/archive/2009/05/28/vsts-2010-feature-enhancements-for-web-test-playback-ui.aspx)

Telerik 测试工具 - [http://www.telerik.com/automated-testing-tools.aspx](http://www.telerik.com/automated-testing-tools.aspx)

Visual Studio UI 测试可扩展性——场景和指导原则 - [http://blogs.msdn.com/b/mathew_aniyan/archive/2011/03/28/visual-studio-ui-test-extensibility-scenarios-amp-guiding-principles .aspx](http://blogs.msdn.com/b/mathew_aniyan/archive/2011/03/28/visual-studio-ui-test-extensibility-scenarios-amp-guiding-principles.aspx)

VSTS Web 测试分步入门 - [http://blogs.msdn.com/b/jimmymay/archive/2009/02/23/vsts-web-test-step-by-step-primer-7-minute- video-by-microsoft-ace-performance-engineer-chris-lundquist-with-copious-notes-screen-shots-from-your-humble-correspondent.aspx](http://blogs.msdn.com/b/jimmymay/archive/2009/02/23/vsts-web-test-step-by-step-primer-7-minute-video-by-microsoft-a-c-e-performance-engineer-chris-lundquist-with-copious-notes-screen-shots-from-your-humble-correspondent.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-28T01:50:21.030

阅读Scott Hanselman[制作的列表](http://www.hanselman.com/blog/ScottHanselmans2007UltimateDeveloperAndPowerUsersToolListForWindows.aspx)，我发现了这两个工具：

*   [WatiN](http://watin.sourceforge.net/)，自动化测试；
*   [WatiN 测试记录器](http://watintestrecord.sourceforge.net/)，用于自动生成测试代码。

从 WatiN 页面：

> [...]WatiN（发音为 What-in）网站。受 Watir 的启发，WatiN 的开发始于 2005 年 12 月，旨在为 .Net 语言提供类似的 Web 应用程序测试。

来自 WatiN 测试记录器：

> 该应用程序的目的是生成与 WatiN（.NET 中的 Web 应用程序测试）项目兼容的代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T03:13:17.530

也找到了这个：

[http://www.automatedqa.com/products/testcomplete/index.asp](http://www.automatedqa.com/products/testcomplete/index.asp)

不幸的是，它不是免费的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-04T08:20:26.510

看看[塞莱诺](http://teststack.github.com/TestStack.Seleno/)。它在引擎盖下使用 Selenium，但将所有浏览器自动化抽象为[Page Objects](http://code.google.com/p/selenium/wiki/PageObjects)，这导致结构良好和流畅的基于 C# 的测试。

它特别适合 ASP.NET MVC，因为每个页面对象都可以强类型化（使用泛型）到等效的 MVC 视图模型，从而导致视图、视图模型和页面对象之间的关系保持一致。

查看 Seleno 代码库中的一些示例以了解其实际效果。

# c++ - C++中的双重否定

> ID：248693
> 
> 赞同：136
> 
> 时间：2008-10-29T22:45:00.613
> 
> 标签：c++, boolean

我刚刚进入一个拥有非常庞大的代码库的项目。

我主要处理 C++ 并且他们编写的许多代码都使用双重否定作为布尔逻辑。

```
 if (!!variable && (!!api.lookup("some-string"))) {
       do_some_stuff();
 } 
```

我知道这些人是聪明的程序员，很明显他们这样做不是偶然的。

我不是经验丰富的 C++ 专家，我对他们为什么这样做的唯一猜测是他们想要绝对肯定被评估的值是实际的布尔表示。所以他们否定它，然后再次否定它以使其回到它的实际布尔值。

这是正确的，还是我错过了什么？

* * *

## 回答 #1

> 赞同：132
> 
> 时间：2008-10-29T22:47:07.023

转换为布尔值是一个技巧。

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2008-10-30T04:50:27.413

在某些情况下，它实际上是一个非常有用的习语。使用这些宏（来自 Linux 内核的示例）。对于 GCC，它们的实现方式如下：

```
#define likely(cond)   (__builtin_expect(!!(cond), 1))
#define unlikely(cond) (__builtin_expect(!!(cond), 0)) 
```

为什么他们必须这样做？GCC`__builtin_expect`将其参数视为`long`和 not `bool`，因此需要进行某种形式的转换。由于他们不知道`cond`在编写这些宏时是什么，因此最普遍的做法是简单地使用`!!`成语。

他们可能可以通过与 0 进行比较来做同样的事情，但在我看来，进行双重否定实际上更直接，因为这是最接近 C 的转换为布尔值的方法。

这段代码也可以在 C++ 中使用……这是最低公分母的事情。如果可能的话，做在 C 和 C++ 中都有效的事情。

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2008-10-29T23:00:47.337

编码人员认为它将操作数转换为布尔值，但因为 && 的操作数已经隐式转换为布尔值，所以完全是多余的。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-29T22:49:55.130

是的，它是正确的，不，你没有错过什么。 `!!`是转换为布尔值。有关更多讨论，请参阅[此问题](https://stackoverflow.com/questions/206106/is-a-safe-way-to-convert-to-bool-in-c)。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-29T22:56:27.830

这是一种避免写入（变量！= 0）的技术 - 即从任何类型转换为布尔值。

像这样的 IMO 代码在需要维护的系统中没有位置 - 因为它不是立即可读的代码（因此首先是问题）。

代码必须清晰易读 - 否则你会为未来留下时间债务遗产 - 因为理解一些不必要的复杂事物需要时间。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-31T10:56:39.420

它避开了编译器警告。试试这个：

```
int _tmain(int argc, _TCHAR* argv[])
{
    int foo = 5;
    bool bar = foo;
    bool baz = !!foo;
    return 0;
} 
```

'bar' 行在 MSVC++ 上生成一个“强制值 bool 'true' 或 'false'（性能警告）”，但 'baz' 行可以很好地通过。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-12-03T00:13:20.457

传统 C 开发人员没有布尔类型，因此他们经常`#define TRUE 1`使用`#define FALSE 0`任意数字数据类型进行布尔比较。现在我们有了`bool`，当使用数字类型和布尔类型的混合进行某些类型的赋值和比较时，许多编译器会发出警告。在处理遗留代码时，这两种用法最终会发生冲突。

为了解决这个问题，一些开发人员使用以下布尔标识：`!num_value`返回`bool true`if `num_value == 0`; `false`除此以外。如果`!!num_value`返回；除此以外。单个否定足以转换为; 然而，双重否定是恢复布尔表达式的原始意义所必需的。`bool false``num_value == 0``true``num_value``bool`

这种模式被称为*成语*，即熟悉该语言的人常用的东西。因此，我不认为它是一种反模式，就像我一样`static_cast<bool>(num_value)`。强制转换很可能会给出正确的结果，但是一些编译器会发出性能警告，所以你仍然必须解决这个问题。

解决这个问题的另一种方法是，`(num_value != FALSE)`. 我也同意，但总而言之，`!!num_value`它不那么冗长，可能更清晰，并且不会在您第二次看到它时感到困惑。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-29T22:48:48.440

是运营商！超载？
如果不是，他们可能这样做是为了将变量转换为布尔值而不产生警告。这绝对不是标准的做事方式。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-08-25T23:14:12.823

`!!`用于处理没有布尔类型的原始 C++（C 也没有）。

* * *

示例问题：

在内部`if(condition)`，`condition`需要评估某种类型，例如`double, int, void*`等，但不存在，`bool`因为它还不存在。

假设存在一个类`int256`（一个 256 位整数）并且所有整数转换/转换都被重载。

```
int256 x = foo();
if (x) ... 
```

要测试`x`是“真”还是非零，`if (x)`将转换`x`为某个整数，*然后*评估它是否`int`非零。的典型重载`(int) x`将仅返回 的 LSbits `x`。 `if (x)`当时只测试`x`.

但是 C++ 有`!`运算符。重载`!x`通常会评估`x`. 所以要回到非反相逻辑`if (!!x)`。

参考[旧版本的 C++ 在评估“if()”语句中的条件时是否使用了类的“int”运算符？](https://stackoverflow.com/questions/16994263/did-older-versions-of-c-use-the-int-operator-of-a-class-when-evaluating-the)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-29T23:08:24.077

正如[Marcin](https://stackoverflow.com/questions/248693/double-negation-in-c-code#248701)所提到的，运算符重载是否在起作用可能很重要。否则，在 C/C++ 中，这无关紧要，除非您正在执行以下操作之一：

*   直接比较`true`（或在 C 中类似于`TRUE`宏），这几乎总是一个坏主意。例如：

    `if (api.lookup("some-string") == true) {...}`

*   您只是希望将某些东西转换为严格的 0/1 值。在 C++ 中，对 a 的赋值`bool`会隐式执行此操作（对于那些可以隐式转换为 的东西`bool`）。在 C 语言中，或者如果您正在处理非布尔变量，这是我见过的一个习语，但我`(some_variable != 0)`自己更喜欢这种变化。

我认为在更大的布尔表达式的上下文中，它只会使事情变得混乱。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-05-11T19:24:09.393

如果*变量*是对象类型，它可能有一个！运算符已定义，但没有强制转换为 bool（或更糟糕的是，隐式强制转换为具有不同语义的 int。两次调用 ! 运算符会导致转换为 bool，即使在奇怪的情况下也能正常工作。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-10-12T14:53:46.583

这可能是**双爆技巧**的一个例子（有关更多详细信息，请参阅[The Safe Bool Idiom](http://www.artima.com/cppsource/safebool.html)）。这里我总结一下文章的第一页。

在 C++ 中，有多种方法可以为类提供布尔测试。

> 一个明显的方法是`operator bool`转换运算符。

```
// operator bool version
class Testable {
    bool ok_;
    public:
    explicit Testable(bool b = true) : ok_(b) {}

    operator bool() const { // use bool conversion operator
      return ok_;
    }
}; 
```

我们可以这样测试这个类：

```
Testable test;
if (test) {
    std::cout << "Yes, test is working!\n";
}
else { 
    std::cout << "No, test is not working!\n";
} 
```

但是，`operator bool`它被认为是不安全的，因为它允许无意义的操作，例如`test << 1;`or `int i = test`。

> 使用`operator!`更安全，因为我们避免了隐式转换或重载问题。

实现很简单，

```
bool operator!() const { // use operator!
    return !ok_;
} 
```

`Testable`测试对象的两种惯用方法是

```
Testable test;
if (!!test) {
    std::cout << "Yes, test is working!\n";
}
if (!test) {
    std::cout << "No, test is not working!\n";
} 
```

第一个版本`if (!!test)`就是一些人所说的**双爆技巧**。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-29T23:02:55.133

这是正确的，但在 C 语言中，这里没有意义——'if' 和 '&&' 在没有 '!!' 的情况下会以同样的方式处理表达式。

我想，在 C++ 中这样做的原因是 '&&' 可能会被重载。但是，'!' 也可以，所以它并不能*真正*保证你得到一个布尔值，而无需查看`variable`and类型的代码`api.call`。也许有更多 C++ 经验的人可以解释一下；也许这意味着作为一种纵深防御措施，而不是保证。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-29T23:31:08.960

也许程序员正在考虑这样的事情......

!!myAnswer 是布尔值。在上下文中，它应该变成布尔值，但我只是喜欢用砰砰来确定，因为从前有一个神秘的虫子咬了我，砰砰，我杀了它。

# asp.net - 将主键从 PKID 更改为 UserID 后出错

> ID：248696
> 
> 赞同：0
> 
> 时间：2008-10-29T22:46:25.433
> 
> 标签：asp.net, vb.net, sqldatasource

我有一个 ASP.NET/VB，它有一个 GridView 来显示用户表中的用户列表。

我将数据库中的主键列名从 PKID 更改为 UserID，并更新了声明和后面代码中对 PKID 的所有旧引用。我还删除了保存网站视觉工作室缓存的 WebsiteCache 文件夹。

当我在页面上放置一个新的 SQLDatasource 并尝试对其进行配置时，旧的 PKID 仍然存在，但是当我通过服务器资源管理器连接时，UserID 列按预期显示。

是否还有其他缓存或我在这一切中缺少的东西？

错误是：

UserID 既不是 DataColumn 也不是表 DefaultView 的 DataRelation

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T22:51:34.423

您是否尝试在服务器资源管理器中刷新架构？此外，如果您已添加连接，请在添加 SqlDataSource 之前尝试删除或刷新它。

# visual-studio-2008 - 类构造函数从未在发布模式下执行

> ID：248714
> 
> 赞同：0
> 
> 时间：2008-10-29T22:55:01.233
> 
> 标签：visual-studio-2008, visual-c++, class, constructor, release

正是标题所说的。我正在使用 MSVC++ 2008 express，并且在发布模式下编译时，我的类构造函数永远不会执行。它确实在调试模式下工作。

我正在做类似的事情：

```
ClassTest test;
test.DoIt(); 
```

`DoIt();`触发器上的断点，但没有断点`ClassTest::ClassTest();`。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T23:01:19.583

只是一个想法 - 它可能是发布模式下的编译器优化，可以防止断点被击中。如果构造函数没有做任何事情（即它是无操作的），这可能会发生。尝试在构造函数中添加一些简单的语句，例如

1.  声明一个局部变量
2.  初始化变量
3.  以某种方式使用它（例如打印出来）

然后在上面的步骤（3）上添加一个断点，看看这个断点是否被命中。

由于进行了优化，您可以看到在发布模式下触发断点的方式出现了各种奇怪的调试问题。

# jakarta-ee - 如何管理和应对一群知识水平不同的开发者？

> ID：248719
> 
> 赞同：0
> 
> 时间：2008-10-29T22:56:22.777
> 
> 标签：jakarta-ee

我们是一群在计算机科学领域攻读硕士学位的学生。

这个学期我们应该按照下面的底部解释做一个软件工程项目。

我们应该完全作为一个真正的软件工程团队来行动和报告。

我被选为这个小组的项目经理，我擅长编写java代码但我没有做项目经理任务的经验，无论如何我必须尽我所能与我的小组成员一起完成这个项目尽可能好。

问题是我需要处理不同层次的知识，但所有成员都应该参与实施部分。

如果有人指导我如何做这个项目以及如何管理这个小组以及从哪里开始，我会很高兴？如何鼓励成员，如何在实践中执行我的计划？

请看一下解释并帮助我为这个项目选择什么技术？

## 项目说明

项目应该作为所谓的网络应用程序来实施。由于 MVC 的要求，这不仅仅是一个服务器-客户端架构——我们（至少）称其为三层架构。

应根据客户的要求动态创建视图。因此，内容必须由服务器（服务器端）计算。除了标记语言之外，视图内部不应存在任何类型的源代码（如“脚本”、Java 代码等）。

这应该确保视图可以由网页设计师创建，其中内容由程序员负责。

反之亦然，源代码不应包含任何标记语言（如 HTML）。

为了存储信息（使持久化），系统应该使用数据库。但是源代码中不应该存在特定于数据库的查询——因为源代码非常依赖于该数据库的使用。系统应与对象关系映射器一起工作，以将数据库中存储的信息映射到特殊类型的对象（bean）上。

所有配置，如数据库、实体、配置、初始化都应该使用 XML 文件（或类似的方式，如注释）来实现，这样更改就不需要重新编译系统的源代码。

可用技术（建议）：

```
 J2EE:
          JSP, Servlets, JSP EL,
          JSTL, JSF, Facelets,
          Custom JSF Components, Custom Facelets TagLibs,
          JUnit (unit testing)

  Persistence:
          Hibernate, JDO
  IDE:
          Eclipse, NetBeans
  Servlet Container:
          Apache Tomcat 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T23:10:07.617

您的描述与您最初的问题有些不同，因此有点令人困惑。我会尽力回答并给你一些提示......

作为**项目经理或领导者**，您应该努力让团队**中的每个人都发挥出最好的水平。**他们每个人都会擅长某件事，所以试着找出那是什么，然后让他们去努力。

当您分配工作时，您还应该分配一些**自由和责任/责任**。他们是该领域的专家，所以让他们尽可能地处理它。尽可能提供支持、鼓励和指导，但要听他们说什么。

如果您有一些技能较低但愿意学习（或贡献）的团队成员，请将他们与其他人配对。让他们**一起**研究一个组件，让经验丰富的人“指导”经验不足的人。如果有一种方法可以让这部分成为您项目的“成功标准”，那就更好了，因为它可以激励他们一起工作。

然后是所有**技术项目管理任务**。这些是规格、甘特图、时间表、评论等。这些很重要，但在我看来，不如人员管理方面重要。让您的团队为您提供这些文档的数据。例如，询问组件 A 的开发人员需要多长时间来开发和测试，而不是试图自己弄清楚。

希望这对您有所帮助，并为您提供一些思考。抱歉，我无法为您的作业提供更多技术/架构方面的帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T23:36:57.420

也许结对编程（两个人坐在同一个终端一起编程）会有所帮助？

第二个人进行了一次很好的“健全性检查”——错误将大大减少。两位程序员将相得益彰，如果其中一位的经验明显少于另一位，他将学得很快。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T17:59:49.737

Explanation of the Project: **( Full explanation here )**

* * *

General Description (customer): UcooP is meant as a system for exchange of knowledge and experiences in the context of universities. This contains multiple levels of exchange.

```
 (A) Administrative Staff Exchange
  (B) Scientific Employee Exchange
  (C) Student Exchange
  (D) Public Exchange

  Universities can get registered to participate in that platform by sending a corresponding request
  to administration of that platform (e.g. MoHE). After an university has become member of that
  platform, students, employees and administration staff can register themselves as member of
  that university with the related role (student, employee or administrative staff).
  The content that is accessible for members than depends on their role. So, students can't access
  content that is tagged as employee content – and so on. Content that is tagged as public is accessible for members of all roles.
  Content inside of that platform can mean two different things.

  (A) Forum (Discussions on topics)
  (B) Wiki (Best practices)

  So besides the topic, Wiki pages and Forum topics have to be categorized to administration,
  employee, student or public content. 
```

For motivating the universities to participate and to publish their experiences and knowledge – the system should contain a ranking system. Universities can get certificates (e.g. Level One Node, Level Two Node, etc. the higher the better) depending on the number of topics, answers in discussion and/or published wiki pages – created by the university members. Defining the details of the system – means creating the concept and prototype of that system – is up to you.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T01:49:07.233

“如果有人指导我如何做这个项目，如何管理这个小组，从哪里开始？如何鼓励成员，以及如何在实践中执行我的计划，我会很高兴？”

这是所有团体努力的核心问题。这个问题太模糊了，没有具体的答案。[这是有关IT 项目管理](http://books.google.com/books?q=IT+project+management&source=bll&sa=X&oi=book_group&resnum=11&ct=title&cad=bottom-3results)的书籍列表。随便挑一个读一读。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T02:01:25.977

“请看解释，帮我为这个项目选择什么技术？”

由于没有说明项目将构建什么，因此任何技术列表都可以。没有“要求”，没有“概念”，没有“目标”或“目的”。没有任何目的是不可能评估技术的。

您的“项目解释”不是对您的项目的解释。它主要是一堆架构原则。一个项目必须不仅仅是一堆技术。必须有一些目标或目的。

您的“可用技术”列表中包含太多内容。

Struts 和 Hibernate 是您所需要的。其他东西（JSP、servlet 等）是 Struts 的一部分。我推荐 iBatis 而不是 Hibernate。

JUnit 是必需的，并不是真正的选择。将 JUnit 视为 Java 的必需部分。

选择 NetBeans 或 Eclipse——不要浪费时间来回折腾，它们都是免费的，而且几乎相同。随便挑一个。

您的技术列表中的其余内容只是分散注意力。当然，除非您的项目有一些功能需求，而这些技术是一个方便的解决方案。

# .net - 如何使用 Click Once 构建单实例应用程序？

> ID：248721
> 
> 赞同：15
> 
> 时间：2008-10-29T22:56:58.187
> 
> 标签：.net, clickonce, single-instance

我需要有一个单实例应用程序（根据这个[答案](https://stackoverflow.com/questions/19147/what-is-the-correct-way-to-create-a-single-instance-application#19326)），但它需要通过单击一次来部署。

问题是我要求单击一次不会自动检测更新并在应用程序运行时尝试加载较新版本。如果它正在运行，那么我需要激活另一个实例。通常，在选择单击一次链接时，它的第一件事是尝试找到更新。我想在启动正常更新过程**之前**拦截它并检查已经运行的实例。

有谁知道这在 Click Once 部署方案中是如何实现的？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-27T05:16:26.293

为了解决这个问题，我们构建了一个原型应用程序，它具有以下两个功能。

1.  一台电脑上的多个实例被禁用。通过 clickonce 部署单实例应用程序。当用户尝试启动应用程序的第二个实例时，将弹出一条消息，指示“另一个实例已在运行”。

2.  异步检查更新，如果存在则安装更新。如果用户运行新实例时有可用更新，则会弹出一条消息：“有可用更新”。

构建演示应用程序的过程如下：

## **第 1 步：使用 Mutex 类检测活动实例应用程序。**

```
namespace ClickOnceDemo
{
    static class Program
    {
        /// summary>
        /// The main entry point for the application.
        /// /summary>
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault( false );
            bool ok;
            var m = new System.Threading.Mutex( true, "Application", out ok );
            if ( !ok )
            {
                MessageBox.Show( "Another instance is already running.", ApplicationDeployment.CurrentDeployment.CurrentVersion.ToString() );
                return;
            }
           Application.Run( new UpdateProgress() );
        }
    }
} 
```

## **第 2 步：以编程方式处理更新**

在我们这样做之前，我们应该禁用自动 ClickOnce 更新检查（在 Publish -- Updates... 对话框中）。

然后我们创建两个表单：UpdateProgress 和 mainForm，其中 UpdateProgress 表示下载进度，mainForm 表示主应用程序。

当用户运行应用程序时，首先会启动 updateProgress 以检查更新。更新完成后，mainForm 将启动，updateProgress 将被隐藏。

```
namespace ClickOnceDemo
{
public partial class UpdateProgress : Form
 {
  public UpdateProgress()
        {
            InitializeComponent();
            Text = "Checking for updates...";

            ApplicationDeployment ad = ApplicationDeployment.CurrentDeployment;
            ad.CheckForUpdateCompleted += OnCheckForUpdateCompleted;
            ad.CheckForUpdateProgressChanged += OnCheckForUpdateProgressChanged;

            ad.CheckForUpdateAsync();
       }

        private void OnCheckForUpdateProgressChanged(object sender, DeploymentProgressChangedEventArgs e)
        {
            lblStatus.Text = String.Format( "Downloading: {0}. {1:D}K of {2:D}K downloaded.", GetProgressString( e.State ), e.BytesCompleted / 1024, e.BytesTotal / 1024 );
            progressBar1.Value = e.ProgressPercentage;
        }

        string GetProgressString( DeploymentProgressState state )
        {
            if ( state == DeploymentProgressState.DownloadingApplicationFiles )
            {
                return "application files";
            }
            if ( state == DeploymentProgressState.DownloadingApplicationInformation )
            {
                return "application manifest";
            }
            return "deployment manifest";
        }

        private void OnCheckForUpdateCompleted(object sender, CheckForUpdateCompletedEventArgs e)
        {
            if ( e.Error != null )
            {
                MessageBox.Show( "ERROR: Could not retrieve new version of the application. Reason: \n" + e.Error.Message + "\nPlease report this error to the system administrator." );
                return;
            }
            if ( e.Cancelled )
            {
                MessageBox.Show( "The update was cancelled." );
            }

            // Ask the user if they would like to update the application now.
            if ( e.UpdateAvailable )
            {
                if ( !e.IsUpdateRequired )
                {
                    long updateSize = e.UpdateSizeBytes;
                    DialogResult dr = MessageBox.Show( string.Format("An update ({0}K) is available. Would you like to update the application now?", updateSize/1024), "Update Available", MessageBoxButtons.OKCancel );
                    if ( DialogResult.OK == dr )
                    {
                        BeginUpdate();
                    }
                }
                else
                {
                    MessageBox.Show( "A mandatory update is available for your application. We will install the update now, after which we will save all of your in-progress data and restart your application." );
                    BeginUpdate();
                }
            }
            else
            {
                ShowMainForm();
            }
        }

        // Show the main application form
        private void ShowMainForm()
        {
            MainForm mainForm = new MainForm ();
            mainForm.Show();
            Hide();
        }

        private void BeginUpdate()
        {
            Text = "Downloading update...";
            ApplicationDeployment ad = ApplicationDeployment.CurrentDeployment;
            ad.UpdateCompleted += ad_UpdateCompleted;
            ad.UpdateProgressChanged += ad_UpdateProgressChanged;

            ad.UpdateAsync();
        }

        void ad_UpdateProgressChanged( object sender, DeploymentProgressChangedEventArgs e )
        {
            String progressText = String.Format( "{0:D}K out of {1:D}K downloaded - {2:D}% complete", e.BytesCompleted / 1024, e.BytesTotal / 1024, e.ProgressPercentage );
            progressBar1.Value = e.ProgressPercentage;
            lblStatus.Text = progressText;
        }

        void ad_UpdateCompleted( object sender, AsyncCompletedEventArgs e )
        {
            if ( e.Cancelled )
            {
                MessageBox.Show( "The update of the application's latest version was cancelled." );
                return;
            }
            if ( e.Error != null )
            {
                MessageBox.Show( "ERROR: Could not install the latest version of the application. Reason: \n" + e.Error.Message + "\nPlease report this error to the system administrator." );
                return;
            }

            DialogResult dr = MessageBox.Show( "The application has been updated. Restart? (If you do not restart now, the new version will not take effect until after you quit and launch the application again.)", "Restart Application", MessageBoxButtons.OKCancel );
            if ( DialogResult.OK == dr )
            {
                Application.Restart();
            }
            else
            {
                ShowMainForm();
            }
        }
    }
} 
```

该应用程序运行良好，我们希望它是解决问题的好方法。
特别感谢[Timothy Walters](http://timothywalters-devthoughts.blogspot.com)提供源代码

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-29T23:53:16.123

**当然**- 您可以禁用自动 ClickOnce 更新检查（在 Publish -> Updates.. 对话框中），然后使用[System.Deployment.Application](http://msdn.microsoft.com/en-us/library/system.deployment.application.aspx)命名空间中的对象和命令实用地检查更新。

查看：

*   [System.Deployment.Application.ApplicationDeployment.CheckForUpdate()](http://msdn.microsoft.com/en-us/library/system.deployment.application.applicationdeployment.checkforupdate.aspx)
*   [System.Deployment.Application.ApplicationDeployment.CheckForUpdateAsync()](http://msdn.microsoft.com/en-us/library/system.deployment.application.applicationdeployment.checkforupdateasync.aspx)

如果有更新，您可以在实际更新之前执行单实例应用程序检查，方法是调用：

*   [System.Deployment.Application.ApplicationDeployment.Update()](http://msdn.microsoft.com/en-us/library/system.deployment.application.applicationdeployment.update.aspx)
*   [System.Deployment.Application.ApplicationDeployment.UpdateAsync()](http://msdn.microsoft.com/en-us/library/system.deployment.application.applicationdeployment.updateasync.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T23:04:14.040

我认为您无法像这样执行此操作，因为运行前的检查不在您的代码范围内。

但是，您可以更改 clickonce 部署选项以在代码执行期间检查更新。

如果您需要更多控制，则可以使用[ApplicationDeployment Update](http://msdn.microsoft.com/en-us/library/system.deployment.application.applicationdeployment.update.aspx)或[CheckForUpdate](http://msdn.microsoft.com/en-us/library/ms136935.aspx)方法来绝对控制更新过程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-03T17:37:04.250

我在我的 WPF ClickOnce 应用程序中使用了[http://wpfsingleinstance.codeplex.com/](http://wpfsingleinstance.codeplex.com/)并取得了巨大的成功。我不必改变任何东西。

# python - 普通用户帐户和root之间有什么关系吗？

> ID：248730
> 
> 赞同：3
> 
> 时间：2008-10-29T23:02:30.690
> 
> 标签：python, linux, root

我正在开发一个代表用户管理网络接口的应用程序，它调用了几个需要 root 进行更改的外部程序（例如 ifconfig）。（具体来说，更改本地接口的 IP 地址等）在开发过程中，我一直以 root 身份运行 IDE（呃），以 root 身份运行调试器（double-ugh）。最终用户是否有一种在非 root 帐户下运行这些的好方法？我非常不喜欢 GTK、wxPython、Python 和我的应用程序在以 root 身份运行时所呈现的攻击面的大小。

我已经研究过功能，但它们看起来不成熟，我不确定我是否能够在 Python 中使用它们，特别是如果它们是基于线程的。我没有探索的唯一选项是设置了 setuid 位并代表 UI 执行所有根类型的东西的守护进程。我不愿在项目的早期引入这种复杂性，因为以 root 身份运行对用户来说并不是一个破坏者。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T23:11:01.310

尽管它引入了复杂性，但您对守护程序的想法有很多优点。只要这些操作不需要*以 root 身份*进行一些用户界面交互，守护程序就允许您控制允许和禁止哪些操作。

但是，您可以使用 SUDO 在 ROOT 和普通用户之间创建一个受控的折衷方案……只需将 SUDO 访问权限授予相关用户以获取他们需要的特定工具。通过只允许“允许的”根启动来减少攻击面。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T23:11:35.100

你想要的是一个“组”

您创建一个组，指定要执行该操作的帐户属于该组，然后指定您要访问的资源是该组的成员。

有时组管理可能有点烦人，但它应该允许你做任何你想做的事情，而且是用户被授权，而不是你的程序。

（如果您希望您的程序获得授权，您可以创建一个特定用户来运行它并为该用户提供适当的组成员资格，然后在您的程序中 su 到该组以执行操作，而不赋予正在运行的用户权限。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T23:10:17.023

您可以为您的应用程序创建和分发 selinux 策略。Selinux 允许您需要的那种细粒度的访问。如果您不能或不会使用 selinux，那么守护程序就是您要走的路。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T23:10:23.730

我不会以 root 身份全时运行应用程序，但您可能想探索使您的应用程序 setuid 成为 root，或者将 setuid 设置为可以使用 sudo 之类的特定应用程序成为 root 的某个 id。您可能可以设置一个无法登录的帐户，使用 setuid 更改程序的 ID（在需要时临时），并将 sudo 设置为不提示输入密码，但始终允许访问该帐户以执行特定任务。

这样你的程序在正常运行时没有特殊权限，只在需要时提升它的权限，并且被 sudo 限制为只运行某些程序。

自从我做了很多 Unix 开发以来已经有一段时间了，所以我不确定是否可以将 sudo 设置为不提示输入密码（或者即使有 API），但作为后备你可以仅在需要时将 setuid 启用为 root。

[编辑] 看起来[sudo](http://www.sudo.ws/sudo/sudo.html)有一个 NOPASSWD 模式，所以我认为它应该可以工作，因为你将程序作为外部命令运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T00:08:28.480

传统的方法是创建和使用 setuid 助手来做任何你需要的事情。但是请注意，正确编写 setuid 助手是很棘手的（您必须防范多种攻击向量）。

现代方法是使用一个守护进程（以 root 身份运行，在启动时启动），它监听来自应用程序其余部分的请求。这样，您的攻击面主要限于您选择的任何 IPC（我建议使用 d-bus，这似乎是现代方式）。

最后，如果你正在管理网络接口，你所做的与 network-manager 在现代发行版中所做的非常相似。尝试以某种方式将您正在做的事情与 network-manager 集成（这样它不会与您的操作冲突），或者至少看看它是如何工作的，这将是一个好主意。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-29T23:06:28.183

没有一个用户介于“普通”用户和 root 之间。你有root，然后你有用户；用户可以拥有不同级别的能力。如果您想要比“普通”用户更强大但不如 root 强大的东西，您只需创建一个具有您想要的功能的新用户，但不要给它您不希望它拥有的特权。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T00:04:26.507

我对 Python 不够熟悉，无法告诉您该语言中必要的命令是什么，但您应该能够通过分叉和使用管道在父进程和子进程之间进行通信来完成此操作。类似于以下内容：

*   通过 sudo 或 suid 以 root 身份运行程序
*   启动时，程序立即分叉并建立父子进程之间通信的管道
*   子进程保留根权限，但只是坐在那里等待来自管道的输入
*   父进程删除 root（将其 uid 更改回运行它的用户的 uid），然后显示 GUI，与用户交互，并处理非特权用户可用的所有操作
*   当要执行需要root权限的操作时，（非root）父进程将命令沿管道发送到（root）子进程，该子进程执行它并可选地向父进程报告

这可能比独立的守护程序更容易编写，并且运行起来更方便（因为您无需担心守护程序是否正在运行），同时还允许 GUI 和其他东西不需要 root 权限以非 root 身份运行。

# css - 在 SharePoint 中链接到外部样式表的最佳方式是什么

> ID：248738
> 
> 赞同：1
> 
> 时间：2008-10-29T23:04:54.193
> 
> 标签：css, sharepoint

我在 SharePoint 中加载了一些用户控件，我希望将所有这些样式包含在外部样式表中。在 CSS 中链接到外部样式表的最佳方式是什么？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T00:58:05.167

您不能在头部添加 <link rel...> 吗？如果没有，你可以 this.page.header.controls.add 吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T09:58:43.907

此代码将确保您只向页面添加 1 个样式表引用，无论您有多少 Web 部件 - 相同的代码片段可用于 javascript。

```
protected override void OnPreRender(EventArgs e)
   {
      const string stylesheet = "YourStylesheet.css";
      if (!Page.IsClientScriptBlockRegistered(stylesheet))
         {
         Page.RegisterClientScriptBlock(stylesheet, 
            string.Format(@"<link href=""{0}/{1}"" rel=""stylesheet""/>",
                         this.ClassResourcePath, stylesheet));
         }
       base.OnPreRender(e);
   } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T01:23:03.620

谢谢，

我看着那样的方式太复杂了。您的回答解决了我的问题，并且实际上会比我打算使用的方法好得多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T16:15:39.777

如果您使用的是 MOSS，则可以使用 SharePoint 的内置备用样式表属性从代码中完全删除此配置。

1.  下拉*站点操作*菜单，然后选择*站点设置->修改所有站点设置*。
2.  在结果页面上，单击**外观**列中的*母版页*链接。
***   在*站点母版页设置*页面上，滚动到底部的**备用 CSS URL**部分。选择*指定 CSS 文件...*单选按钮并输入样式表的 URL。我把我的放在主页站点的样式库中，但你几乎可以把它放在你想要的地方。*   如果您愿意，您可以通过选中*重置所有子网站以继承此备用 CSS URL*复选框来为所有子网站设置它。*   单击*确定*按钮。**

 **遗憾的是，此配置不适用于 WSS 站点。但是对象模型确实有它。因此，您可以在 WSS 和 MOSS 中使用代码应用它，无论是在 Web 部件中还是通过 PowerShell 之类的东西。

在代码中，一旦您引用了 SPWeb 对象，例如在一个名为 的巧妙命名的变量`theWeb`中，您就可以使用以下代码分配样式表的 URL：
theWeb.AlternateCssUrl = " [http://server/site/library/样式表.css](http://server/site/library/stylesheet.css) "; theWeb.Update();

# ajax - AJAX 站点的文件结构/架构？

> ID：248748
> 
> 赞同：3
> 
> 时间：2008-10-29T23:08:52.313
> 
> 标签：ajax, information-architecture, file-location

我正在使用 ajax 构建一个站点，并试图决定将提供 ajax 请求数据的文件放在哪里。

例如，我将有一个 .js 文件，该文件可以包含在将创建国家/州选择框的页面中。我将在 /inc/js 下拥有 .js 文件。

但是，我不确定要将基于所选国家/地区提供状态数据的 ajax 文件放在哪里。我可以把它放在它支持的文件旁边，为 ajax 数据请求文件创建一个文件夹等。

你怎么做才能让你的 ajax 请求按文件组织？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T23:16:19.990

如果您计划使用模型-视图-控制器架构，那么您可以将您的 ajax 处理程序脚本放置在您维护站点的其余控制器脚本的位置。

例如：

```
/应用
    /默认
        /控制器
            索引.php
            索引.ajax.php
       /意见
         索引.tpl
         索引.ajax.tpl
    /行政

```

使用这样的模型，您可以自由决定是为您的 ajax 调用创建处理程序脚本还是将您的 ajax 调用的处理程序脚本集成到其他现有的控制器脚本中更有意义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T23:15:39.447

创建一个单独的站点（同一服务器或另一个），该站点仅用作 REST 服务，为您的请求生成输出。当您使用 AJAX 时，您实质上是在使用已发布的 Web 服务。

# mysql - 如何在 MySql 中的两列上执行布尔逻辑，其中一列是 Varchar？

> ID：248753
> 
> 赞同：2
> 
> 时间：2008-10-29T23:09:44.357
> 
> 标签：mysql, select, field

这是[这个问题](https://stackoverflow.com/questions/248683/how-can-i-do-boolean-logic-on-two-columns-in-mysql)的后续。

我想在 MySql 选择中将三列合并为一列。前两列是布尔值，第三列是字符串，有时为空。这会导致奇怪的结果：

```
Select *, (payment1_paid && ((payment2_paid || payment2_type ="none"))) as paid_in_full from payments 
```

**注意：** `payment1_paid`是布尔值，`payment2_paid`是布尔值，`payment2_type`是varchar。

**注意：**请忽略此表的结构多么荒谬。每一段糟糕的代码背后都有一个很长的解释:)

**编辑：**对于 varchar 值，我对 Null 不感兴趣。我只想知道它是否真的“无”。

在此先感谢您的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T23:25:54.010

如果 null 不感兴趣，那么对您来说：

```
Select *, 
      (payment1_paid && ((payment2_paid || (payment_type IS NOT NULL && payment_type="none"))) 
         as paid_in_full 
from payments 
```

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T23:12:49.247

我猜你希望 NULL 是假的？尝试 `(payment_paid IS NULL || payment2_type = "none")`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T23:13:06.737

```
Select *, 
      (payment1_paid && ((payment2_paid || coalesce(payment2_type,"null") ="none"))) 
         as paid_in_full 
from payments 
```

# firefox - 用于查找下载来源的浏览器插件

> ID：248754
> 
> 赞同：1
> 
> 时间：2008-10-29T23:09:47.787
> 
> 标签：firefox, browser, plugins, download

早在互联网的早期，我记得在某些浏览器中，每次下载图像或文件时，下载该文件的 URL 都会写入该文件的属性（我猜是摘要选项卡？）。如果我没记错的话，我认为 Netscape v2 就是这样做的。

我真的很怀念那种功能，因为每隔一段时间我就会遇到一个存储在硬盘深处某处的整洁的小程序，并想知道我最初是从哪里得到它的。

我四处搜索，但我不太确定用什么术语来描述我正在寻找的东西。所以我想知道是否有人知道 Firefox 插件或类似的东西可以做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T23:51:39.077

如果您使用[DownThemAll](https://addons.mozilla.org/en-US/firefox/addon/201)！Firefox 的扩展名，您可以告诉它在下载的文件名前添加站点的 URL...

因此你最终得到如下文件：

```
download.com_utils_compression_ABCD32.exe 
```

当您想要下载/排队一堆文件时，它也非常有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T00:03:18.913

您下载`http://example.com/foo`到`~/Desktop/foo`，并且想在本地文件的属性中查看原始 URL `foo`？

回到我使用 OS X 的时候，我记得 Safari 曾经在下载文件的资源分支中记录原始 URL。不记得命名的 fork 是什么，好吧，命名，但它会显示在 Finder 的属性面板中。既然它在那里，Spotlight 可能也会索引它，但我从 10.3 开始就没有使用过 OS X。

如果您使用 Opera，并且尚未从下载管理器中清除文件，请选择下载，它会在属性窗格中显示该文件的原始 URL。

这是你想要的吗？如果是这样......好吧，我不知道类似的 Firefox 扩展，但它会澄清这个问题。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-29T23:27:32.823

对于 IE 浏览器，我使用 Fidler 来查看所有通过网络的流量。

对于 FireFox，您可以使用 FireBug 插件。有一个“网络”选项卡将向您显示通过网络传输的请求信息。

大多数情况下，您可以使用其中一种工具来查看请求的 URL 以开始下载。您还可以查看可能需要发送以使您的请求成功的所有获取和发布信息。

提琴手在这里：[http ://www.fiddlertool.com/fiddler/](http://www.fiddlertool.com/fiddler/)

FireBug 在这里：[https ://addons.mozilla.org/en-US/firefox/addon/1843](https://addons.mozilla.org/en-US/firefox/addon/1843)

祝你好运！

# ide - VB6编辑器改变变量名的大小写

> ID：248760
> 
> 赞同：41
> 
> 时间：2008-10-29T23:11:37.143
> 
> 标签：ide, vb6

我不是一个 Visual Basic 人，但我的任务是维护一个旧的 VB6 应用程序。每当我签出文件时，编辑器都会自动将一堆大写的变量名替换为小写。我怎么能让这个停止！？我不想把它们全部改回来，当我试图找到真正的差异时，让这些更改显示在 SourceSafe“差异”中是一件很痛苦的事情。

它也在定义中自动更改它： `Dim C as Control`成为`Dim c as Control`. `Dim X&`变成`Dim x&`. 但它并不总是这样做。例如，从 , 向下的三行`Dim x&`，有一个`Dim Y&`, 大写，它没有改变。为什么要这样对我？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2016-01-27T15:06:08.417

由于我总是发现这个线程首先寻找**解决方案**来解决混乱的外壳，因此这是[Simon D在](https://stackoverflow.com/a/1064894/2822719)[相关问题](https://stackoverflow.com/q/1064858/2822719)中提出的一个：

如果您只需要**修复一个变量的大小写**（例如，您不小心创建了一个`cOrrectCAse`变量，现在它们到处都是），您可以通过添加

```
#If False Then
    Dim CorrectCase
#End If 
```

到模块的开头。如果您保存项目并稍后删除该语句，则大小写保持正确。

使用 Excel VBA，我经常不小心将某个函数内的变量变暗，从而意外更改`Range.Row`为- 在 Simon D 的解决方案的帮助下，我现在可以解决这个问题。`Range.row``row`

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-29T23:53:17.653

继续[DJ 的回答](https://stackoverflow.com/questions/248760/vb6-editor-changing-case-of-variable-names#248773)...

而且它不仅会改变同一范围内变量的大小写。

它将改变整个项目中所有同名变量的大小写。因此，即使它们在一个地方以大写形式声明，另一个模块也可能有不同的变量使用相同的小写变量名，导致项目中的所有变量都变为小写，这取决于加载了哪个声明（？）或最后编辑。

因此，您的 C 和 X 变量改变大小写而 Y 没有改变的原因可能是因为 C 和 X 也在项目中的其他地方声明，但以小写形式声明，而 Y 没有。

[这里](http://www.programmingtalk.com/showthread.php?t=47839)还提到了它，当使用大小写区分局部变量和全局变量时，他们似乎主要关心这些变量名冲突。他们最终改为使用前缀。

我能想到的唯一选择是使用其他具有 VB6 突出显示功能的编辑器来进行编辑......

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-17T14:56:43.340

枚举甚至更糟。在使用枚举的任何地方弄错大小写都会改变定义的大小写。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-30T03:21:51.337

要摆脱痛苦的文件差异体验，请在差异对话框中设置 VSS 选项以进行不区分大小写的比较。这样你只会看到“真正的”变化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T23:15:41.753

它必须以小写形式定义/声明。找到声明并在那里修复它。IDE 将始终更改大小写以匹配声明。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-04-22T17:08:24.497

关闭所有 VB 项目，用文本编辑器打开表单文件，更改所有名称的大小写，然后用 VB IDE 重新打开项目。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-09-15T09:40:45.647

**防止 VB6 自动更正枚举值**

作为我的一般规则，我以大写形式声明常量。由于枚举本质上是常量，因此我也喜欢以大写形式声明枚举的值。我注意到 VB6 IDE 也会自动更正这些。

我发现在值名称中使用数字和下划线“_”时，IDE 不会更正这些值。

例子：

```
Public Enum myEnum
  VALUE      'Will be corrected to: Value
  VALUE1     'Will not be corrected
  VALUE_     'Will not be corrected
End Enum 
```

* * *

我不知道这是否普遍有效，以及这是否扩展到变量名的命名/自动更正。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-08-11T19:37:29.583

我有一个类似的枚举问题，没有明显的原因将大写更改为 MixedCase。

```
Enum eRowDepths
    BD = 1
    CF = 1
    Separator = 1
    Header = 3
    subTotal = 2
End Enum 
```

当我更改为以下（尾随不合格变量的最后一个字符）时，我没有问题

```
Enum eRowDepths
    BD = 1
    CF = 1
    SEPARATO = 1
    HEADE = 3
    SUBTOTA = 2
End Enum 
```

原来，这是一个尾巴摇狗的案例。我有以下代码，不是我承认的最优雅的代码，但仍然可以工作（请原谅格式问题）：-

```
'insert 3 rows
  iSubTotalPlaceHolder = i      
  rows(ActiveSheet.Range(rangeDMirrorSubTotals).Cells.Count +  _
                                                        Header _
                                                         & ":" _
      & ActiveSheet.Range(rangeDMirrorSubTotals).Cells.Count + _
                                                      Header + _
                                                    subTotal + _
                                           Separator).Insert 
```

因此，编译器似乎不会接受显式大写常量作为该语句的一部分。

这是可以接受的

```
Dim fred as Integer
fred = SEPARATO + HEADE + SUBTOTA 
```

因此，如果我想遵守保持枚举常量大写的规则，我的解决方法是使用变量而不是常量作为复杂插入语句的一部分。

我希望这是有用的

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-10-29T23:36:07.390

DJ 在现场... VB 总是更改变量的大小写以匹配原始声明。这是一个“功能”。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-02-18T14:40:04.963

继续墨卡托的出色回答......

我建议：

1.  查看所有文件（我假设您将 VSS 用于 VB6 应用程序）
2.  重建整个项目组
3.  重新检查 VSS

现在，您是真正的差异，而不是 VB6 尝试应用的“自动”更改。

# sql - SQL 查询帮助 - 任务排序、分组和状态+日期条件问题

> ID：248761
> 
> 赞同：2
> 
> 时间：2008-10-29T23:12:26.613
> 
> 标签：sql, oracle

希望我能公正地解决问题，因为在标题中总结它太难了！（欢迎在评论中提出建议）

对，这是我的桌子：

```
Tasks
  task_id        (number)
  job_id         (number)
  to_do_by_date  (date)
  task_name      (varchar / text)
  status         (number)
  completed_date (date) 
```

为了论证，让我们设定状态值：

```
1 = New
2 = InProgress
3 = Done 
```

我在尝试做的事情是创建一个可以撤回所有任务的查询：

*   a 的任何任务`job_id`都有一个`status`<> 完成
    *   除非 a 的所有任务`job_id`都已完成，但一个或多个任务有 a`completed_date`的今天
*   按`to_be_done_by`日期排序，但将所有 job_id 任务组合在一起
    *   所以`job_id`首先显示下一个“to_do_by_date”任务

有关数据的一些信息：

*   a`job_id`可以有任意数量的任务

**这是我试图获得的输出示例：**

```
task_id   job_id   to_do_by_date   task_name   status   completed_date
   1        1        yesterday        -          3        yesterday
   2        1        today            -          3        today
   3        2        now              -          3        today
   4        2        2 hours time     -          2        {null}
   5        2        4 hours time     -          2        {null}
   6        2        tomorrow         -          1        {null}
   7        3        3 hours time     -          2        {null}
   8        3        tomorrow         -          1        {null}
   9        3        tomorrow         -          1        {null} 
```

我正在使用 Oracle 10g，因此 Oracle 或 ANSI SQL 的答案，或有关如何解决此问题的提示将是理想的，如果您的解决方案需要，我可以创建视图或将其包装在存储过程中以从应用程序中卸载逻辑它。

这是一个 sql 脚本，它将创建上面显示的示例测试数据：

```
create table tasks (task_id number, job_id number, to_do_by_date date, task_name varchar2(50), status number, completed_date date);
insert into tasks values (0,0,sysdate -2,    'Job 0, Task 1 - dont return!', 3, sysdate -2);
insert into tasks values (1,1,sysdate -1,    'Job 1, Task 1', 3, sysdate -1);
insert into tasks values (2,1,sysdate -2/24, 'Job 1, Task 2', 3, sysdate -2/24);
insert into tasks values (3,2,sysdate,       'Job 2, Task 1', 3, sysdate);
insert into tasks values (4,2,sysdate +2/24, 'Job 2, Task 2', 2, null);
insert into tasks values (5,2,sysdate +4/24, 'Job 2, Task 3', 2, null);
insert into tasks values (6,2,sysdate +1,    'Job 2, Task 4', 1, null);
insert into tasks values (7,3,sysdate +3/24, 'Job 3, Task 1', 2, null);
insert into tasks values (8,3,sysdate +1,    'Job 3, Task 2', 1, null);
insert into tasks values (9,3,sysdate +1,    'Job 3, Task 3', 1, null);
commit; 
```

非常非常感谢您的帮助:o)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T23:51:14.210

显然你将不得不解决这个问题，但我希望你明白这一点。

```
SELECT 
    task_id, job_id, to_do_by_date, task_name, status, completed_date
FROM
    Tasks
WHERE
    job_id IN (
        SELECT job_id 
        FROM Tasks 
        WHERE status <> 'Done' 
        GROUP BY job_id)
    OR
    job_id IN (
        SELECT job_id 
        FROM Tasks 
        WHERE status = 'Done' AND completed_date = 'Today'
            AND job_id NOT IN (SELECT job_id FROM Tasks WHERE status <> 'Done' GROUP BY job_id)
        GROUP BY job_id)
ORDER BY
    job_id, to_do_by_date 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T00:10:21.113

我同意贾斯汀的观点——我不明白为什么会返回 2。

这是一个使用分析函数根据逻辑描述返回正确行的查询。

```
select * from
(
select t.*,
       min(status) over (partition by job_id) min_status_over_job,
       max(status) over (partition by job_id) max_status_over_job,
       sum(case when trunc(completed_date) = trunc(sysdate)-1 then 1 else 0 end) 
                   over (partition by job_id) num_complete_yest
from   tasks t
)
where  max_status_over_job < 3
       or (min_status_over_job = 3 and num_complete_yest > 0)
/ 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T23:46:22.037

鉴于您的要求，我不清楚为什么应在结果中返回 job_id 2 。有一个任务的状态为完成，因此它不符合第一个条件

> job_id 的所有任务都有状态 <> 完成

并且有些任务的状态不是完成，因此它不符合第二个标准

> 除非 job_id 的所有任务都已完成，但一项或多项任务的完成日期为今天

还有其他原因应该包括 job_id = 2 吗？

```
SQL> ed
Wrote file afiedt.buf

  1  select task_id, job_id, to_do_by_date, task_name, status, completed_date
  2    from tasks t1
  3   where not exists( select 1
  4                       from tasks t2
  5                      where t1.job_id = t2.job_id
  6                        and t2.status  = 3)
  7      or ((not exists( select 1
  8                        from tasks t3
  9                       where t1.job_id  = t3.job_id
 10                         and t3.status != 3))
 11          and
 12          exists (select 1
 13                    from tasks t4
 14                   where t1.job_id = t4.job_id
 15                     and trunc(t4.completed_date) = trunc(sysdate)))
 16*   order by job_id, to_do_by_date
SQL> /

   TASK_ID     JOB_ID TO_DO_BY_ TASK_NAME           STATUS COMPLETED
---------- ---------- --------- --------------- ---------- ---------
         1          1 28-OCT-08 Job 1, Task 1            3 28-OCT-08
         2          1 29-OCT-08 Job 1, Task 2            3 29-OCT-08
         7          3 29-OCT-08 Job 3, Task 1            2
         8          3 30-OCT-08 Job 3, Task 2            1
         9          3 30-OCT-08 Job 3, Task 3            1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T23:47:12.987

我不做 Oracle，也没有手边的 Sql Server - 但这应该让你非常接近。

```
SELECT Tasks.*
FROM Tasks
JOIN (
   --Undone
   SELECT Job_Id
   FROM Tasks
   WHERE
     Status <> 3
   UNION
   --Done today
   SELECT Job_Id
   FROM Tasks
   WHERE
     Status = 3
     AND Completed_Date = TODAY()
) as UndoneOrDoneToday ON
   Tasks.Job_Id = UndoneOrDoneToday.Job_Id
JOIN (
   SELECT Job_Id, MIN(to_do_by_date) as NextToDoByDate
   FROM Tasks
   GROUP BY Job_id
) as NextJob ON
   Tasks.Job_Id = NextJob.Job_id
ORDER BY
   NextJob.NextToDoByDate, 
   Tasks.Job_Id, --If NextToDoByDate isn't unique, this should order jobs together
   Tasks.to_do_by_date, --This may not be needed, but would put eg., task 7 due today higher than task 6 due tomorrow
   Tasks.Task_Id --this should be last 
```

编辑：大多数其他答案似乎按 job_id、to_do_by 排序。这看起来适用于示例数据，但不符合以下要求：

> 按 to_be_done_by 日期排序，但将所有 job_id 任务组合在一起，以便首先显示下一个 to_do_by_date 任务的 job_id

# .net - 是否有与 Java Web Start 等效的 .NET？

> ID：248767
> 
> 赞同：14
> 
> 时间：2008-10-29T23:13:50.527
> 
> 标签：.net, java-web-start

是否有与 Java Web Start 等效的 .NET？

我想要从 Web 上单击轻量级安装一组 .NET 程序集和资源。希望该链接将继续让用户使用最新版本进行更新，类似于 Java Web Start 所做的。

该应用程序是用 F# 编写的，物有所值。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-29T23:19:23.697

我认为您在谈论 ClickOnce 部署

[http://msdn.microsoft.com/en-us/library/t71a733d(VS.80).aspx](http://msdn.microsoft.com/en-us/library/t71a733d(VS.80).aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T23:20:31.090

微软的[ClickOnce](http://msdn.microsoft.com/en-us/library/t71a733d(VS.80).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T14:06:05.280

啊哈，您可以使用 .NET 框架（不是 Visual Studio）附带的 msbuild.exe 发布 .NET 应用程序。您可以使用免费工具从命令行完成所有操作。

关于使用 msbuild 从命令行发布的文档在这里：http: [//msdn.microsoft.com/en-us/library/ms165431 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms165431(VS.80).aspx)

创建正确 ClickOnce 清单和证书的说明在这里：http: [//msdn.microsoft.com/en-us/library/xc3tc5xx (VS.80).aspx](http://msdn.microsoft.com/en-us/library/xc3tc5xx(VS.80).aspx)

# c# - 如何遍历 PDFSharp 中的 Pdf 对象树？

> ID：248768
> 
> 赞同：8
> 
> 时间：2008-10-29T23:14:28.323
> 
> 标签：c#, pdf, pdf-generation, pdfsharp

我正在尝试使用 c# 中的 PDFSharp 遍历现有 PDF 文档中的 PdfItem 对象树。

我想在进行过程中创建所有对象的层次结构——类似于“PDF Explorer”示例所做的——但我希望它是一棵树，而不是所有对象的平面列表。

根节点是 document.Internals.Catalog。我想遍历所有 document.Internals.Catalog.Elements，直到我访问了每个元素。

我遇到的问题之一是树中有循环引用，我不知道如何检测它们。

那里有任何代码示例吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-11-13T22:20:48.337

marihanzo 在 PDFSharp 论坛上发表的这篇文章对我们有用：

[http://forum.pdfsharp.net/viewtopic.php?f=2&t=527&p=1603](http://forum.pdfsharp.net/viewtopic.php?f=2&t=527&p=1603)

我们遇到的唯一问题是处理其中包含 \r\n 的字段。这是代码的副本，以防论坛帖子丢失。

PDFParser.cs

```
public class PDFParser
{
    /// BT = Beginning of a text object operator
    /// ET = End of a text object operator
    /// Td move to the start of next line
    ///  5 Ts = superscript
    /// -5 Ts = subscript

    #region Fields

    #region _numberOfCharsToKeep
    /// <summary>
    /// The number of characters to keep, when extracting text.
    /// </summary>
    private static int _numberOfCharsToKeep = 15;
    #endregion

    #endregion

    #region ExtractTextFromPDFBytes
    /// <summary>
    /// This method processes an uncompressed Adobe (text) object
    /// and extracts text.
    /// </summary>
    /// <param name="input">uncompressed</param>
    /// <returns></returns>
    public string ExtractTextFromPDFBytes(byte[] input)
    {
        if (input == null || input.Length == 0) return "";

        try
        {
            string resultString = "";

            // Flag showing if we are we currently inside a text object
            bool inTextObject = false;

            // Flag showing if the next character is literal
            // e.g. '\\' to get a '\' character or '\(' to get '('
            bool nextLiteral = false;

            // () Bracket nesting level. Text appears inside ()
            int bracketDepth = 0;

            // Keep previous chars to get extract numbers etc.:
            char[] previousCharacters = new char[_numberOfCharsToKeep];
            for (int j = 0; j < _numberOfCharsToKeep; j++) previousCharacters[j] = ' ';

            for (int i = 0; i < input.Length; i++)
            {
                char c = (char)input[i];

                if (inTextObject)
                {
                    // Position the text
                    if (bracketDepth == 0)
                    {
                        if (CheckToken(new string[] { "TD", "Td" }, previousCharacters))
                        {
                            resultString += "\n\r";
                        }
                        else
                        {
                            if (CheckToken(new string[] { "'", "T*", "\"" }, previousCharacters))
                            {
                                resultString += "\n";
                            }
                            else
                            {
                                if (CheckToken(new string[] { "Tj" }, previousCharacters))
                                {
                                    resultString += " ";
                                }
                            }
                        }
                    }

                    // End of a text object, also go to a new line.
                    if (bracketDepth == 0 &&
                        CheckToken(new string[] { "ET" }, previousCharacters))
                    {

                        inTextObject = false;
                        resultString += " ";
                    }
                    else
                    {
                        // Start outputting text
                        if ((c == '(') && (bracketDepth == 0) && (!nextLiteral))
                        {
                            bracketDepth = 1;
                        }
                        else
                        {
                            // Stop outputting text
                            if ((c == ')') && (bracketDepth == 1) && (!nextLiteral))
                            {
                                bracketDepth = 0;
                            }
                            else
                            {
                                // Just a normal text character:
                                if (bracketDepth == 1)
                                {
                                    // Only print out next character no matter what.
                                    // Do not interpret.
                                    if (c == '\\' && !nextLiteral)
                                    {
                                        nextLiteral = true;
                                    }
                                    else
                                    {
                                        if (((c >= ' ') && (c <= '~')) ||
                                            ((c >= 128) && (c < 255)))
                                        {
                                            resultString += c.ToString();
                                        }

                                        nextLiteral = false;
                                    }
                                }
                            }
                        }
                    }
                }

                // Store the recent characters for
                // when we have to go back for a checking
                for (int j = 0; j < _numberOfCharsToKeep - 1; j++)
                {
                    previousCharacters[j] = previousCharacters[j + 1];
                }
                previousCharacters[_numberOfCharsToKeep - 1] = c;

                // Start of a text object
                if (!inTextObject && CheckToken(new string[] { "BT" }, previousCharacters))
                {
                    inTextObject = true;
                }
            }
            return resultString;
        }
        catch
        {
            return "";
        }
    }
    #endregion

    #region CheckToken
    /// <summary>
    /// Check if a certain 2 character token just came along (e.g. BT)
    /// </summary>
    /// <param name="search">the searched token</param>
    /// <param name="recent">the recent character array</param>
    /// <returns></returns>
    private bool CheckToken(string[] tokens, char[] recent)
    {
        foreach (string token in tokens)
        {
            if (token.Length > 1)
            {
                if ((recent[_numberOfCharsToKeep - 3] == token[0]) &&
                    (recent[_numberOfCharsToKeep - 2] == token[1]) &&
                    ((recent[_numberOfCharsToKeep - 1] == ' ') ||
                    (recent[_numberOfCharsToKeep - 1] == 0x0d) ||
                    (recent[_numberOfCharsToKeep - 1] == 0x0a)) &&
                    ((recent[_numberOfCharsToKeep - 4] == ' ') ||
                    (recent[_numberOfCharsToKeep - 4] == 0x0d) ||
                    (recent[_numberOfCharsToKeep - 4] == 0x0a))
                    )
                {
                    return true;
                }
            }
            else
            {
                return false;
            }

        }
        return false;
    }
    #endregion
} 
```

和调用代码：

```
 public override String ExtractText()
    {
        String outputText = "";
        try
        {
            PdfDocument inputDocument = PdfReader.Open(this._sDirectory + this._sFileName, PdfDocumentOpenMode.ReadOnly);

            foreach (PdfPage page in inputDocument.Pages)
            {
                for (int index = 0; index < page.Contents.Elements.Count; index++)
                {

                    PdfDictionary.PdfStream stream = page.Contents.Elements.GetDictionary(index).Stream;
                    outputText += new PDFParser().ExtractTextFromPDFBytes(stream.Value);
                }
            }

        }
        catch (Exception e)
        {
            PDF_ParseException oEx = new PDF_ParseException(this, e);
            oEx.Log();
            oEx.ToPdf(this._sDirectoryException);
        }
        return outputText;
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-01T05:27:58.050

阅读和分析整个集合，并构建您自己的内存树。然后走那棵树。

# php - PHP IDE--想用FTP同步本地存储

> ID：248769
> 
> 赞同：4
> 
> 时间：2008-10-29T23:14:48.370
> 
> 标签：php, ide, tortoisesvn, notepad++, aptana

我目前在我的大部分开发中都使用 Notepad++。我一直在检查其他功能更齐全的选项，并想切换（到目前为止，我特别喜欢 Aptana），但我真的很喜欢 Notepad++ 的一件事，但我一直没能得到至今。

我 当前的工作[流程](http://evanalyze.com/images/workflow)[是](http://evanalyze.com/images/workflow.jpg)这样的：

过程是这样的：

1.  从网络服务器下载文件
2.  在 NP++ 中进行编辑
3.  保存（这会自动将本地副本保存在我的默认目录中，这也是我使用 Subversion 和 Tourtise SVN 设置的文件夹）
4.  当我想提交对 SVN 的更改时，请浏览具有最新副本的本地文件夹

我不知道如何使用 Aptana 自动存储我从服务器下载的文件的本地副本，编辑并保存回服务器。有没有办法做到这一点？如果是这样，那将立即解决我的问题。

其他选项将是一个更好的方法来管理我的服务器、我的编辑器和我的 SVN 存储库之间的关系的建议。我知道 Aptana 也可以访问我的 SVN 存储库。有没有一种简单的方法可以在我想要的时候从 Aptana 中提交更改（这意味着我可以将 Tourtise 排除在我猜的等式之外）？

任何建议表示赞赏。谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-30T00:47:56.047

我觉得你做的事情有点奇怪。

您已经在 SVN 存储库中拥有所有信息，那么为什么不利用它呢？

您在计算机上保留一份工作副本以进行开发和测试。保存并提交您对 SVN 的更改。在你的服务器上，做一个 SVN `export`（或者`checkout`，使用适当的服务器规则来阻止对文件夹的 Web 访问`.svn`），你很可爱！

```
---------- ------------ ---------------
| 本地工作副本 | <---> | SVN 回购 | <---> | 直播服务器 |
---------- ------------ ---------------

```

这意味着您永远不必担心 FTP，也不必弄清楚哪些文件已在本地更改，因此需要更新。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T23:26:59.657

不太确定，但我发现[PhpEd](http://www.nusphere.com/)在这类东西上比 Zend 更好——特别容易保存到 FTP。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T23:49:55.040

如果您想要免费的通用 IDE（支持多种语言以及 Php） - 那么您应该尝试 PsPad www.pspad.com。它可以很好地处理 ftp 如果你要做大量的 Php 编程 - 那么你有几个专用的（但不是免费的）Php IDE。PhpEd、PhpEdit、Php Designer、WeBuilder——各有优劣，都支持ftp。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T23:43:51.150

Eclipse 有一个名为[RSE](http://www.eclipse.org/dsdp/tm/)的插件，允许您通过 ssh、ftp 等处理远程源。您可以使用[PDT](http://www.eclipse.org/pdt)，但我想它也可以在 Aptana 上工作。

我正在使用内置了 SVN 和 RSE 的 Zend Studio For Eclipse。我猜它在 PDT 中是一样的（在安装 RSE 插件之后），您可以直接在 RSE 透视图中工作，也可以添加一个删除文件夹到您的项目（只有在 RSE 中添加连接后才能执行此操作）

顺便说一句，我发现以下链接可以为您提供更多远程机器选项： [http ://wiki.eclipse.org/index.php/TM_and_RSE_FAQ#Working_with_TM_.2F_RSE_as_a_User](http://wiki.eclipse.org/index.php/TM_and_RSE_FAQ#Working_with_TM_.2F_RSE_as_a_User)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-29T23:56:55.273

我目前安装了带有 Aptana 插件的 Eclipse，因此我可以访问 Aptana 的所有很酷的功能。

您可以安装 Subclipse 或 Subversive for Eclipse，这将有效地处理需要 TortoiseSVN。看：[http://subclipse.tigris.org/install.html](http://subclipse.tigris.org/install.html)

此外，您可以选择为 Eclipse 安装和配置 PDT 或使用 Aptana PHP 插件（我都使用过，但我发现我不一定更喜欢其中一个）。

最后，Aptana 和 Eclipse 都提供 ftp 和 sftp 支持：

[http://www.aptana.com/plugins](http://www.aptana.com/plugins)

[http://www.eclipseplugincentral.com/Web_Links-index-req-viewlink-cid-857.html](http://www.eclipseplugincentral.com/Web_Links-index-req-viewlink-cid-857.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T00:18:36.713

我发现[Scooter Software 的 Beyond Compare 是](http://www.scootersoftware.com/)满足此类需求的绝佳工具。
Beyond Compare 是一个非常有价值的文件和目录，适用于 Windows 和 Linux 的不同和合并，它也能够将其中一个目录作为 ftp-link。

Beyond Compare 甚至有一个用于源代码控制系统的特殊插件，不幸的是它不与服务器交互，但能够理解例如冲突。

# wordpress - 与 Wordpress 博客集成的最佳论坛软件是什么？

> ID：248787
> 
> 赞同：7
> 
> 时间：2008-10-29T23:22:17.140
> 
> 标签：wordpress, integration, forum, bbpress

如果您想将用户论坛添加到您的软件站点，并使其看起来和工作起来像您的 WordPress 博客，您会选择哪种论坛软件？

显然 bbPress 与 WordPress 具有相同的起源，但它是最好的还是有其他更好的选择？

* * *

跟进：

我的最终解决方案是将 bbPress 0.99 与 WordPress 2.6 集成。对于博客评论和论坛帖子，我有单一登录、集成搜索和相同的样式，并结合了用户统计信息。

这使用了 bbPress 0.99 允许的与 WordPress 的基本集成，并包含了几个 bbPress 插件（[许多由 _ ck _ 提供）](http://bbshowcase.org/forums/)，这些插件根据我的喜好进行了高度定制（读错了）。最棘手的部分是让 cookie 在两者之间工作。

唯一的缺点是我无法在没有大量工作的情况下升级 WordPress 或 bbPress。但在那些停止工作之前，我很好。

如果您有兴趣，请参阅：[www.beholdgenealogy.com/blog](http://www.beholdgenealogy.com/blog)和[www.beholdgenealogy.com/forum](http://www.beholdgenealogy.com/forum)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-29T23:49:43.947

bbPress 似乎是最好的。你可以让它与 wordpress 上的评论集成，但不是以一种干净的方式。bbPress 虽然非常有限。

没有任何东西可以简单地做到这一点。尤其是外观和感觉 - WordPress 中主题的工作方式允许完全自定义 PHP/HTML/CSS，因此任何论坛都很难自动匹配。

我在我的博客上连接了 punbb。它有效，但它非常简单。我主要选择它是因为我在共享主机上，而且它比其他 PHP 论坛占用的空间更小。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-29T23:44:37.937

请参阅blogHelper 中[的将论坛与 WordPress集成。](http://bloghelper.is-there.net/integrating-a-forum-with-wordpress/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-15T08:56:44.930

我最近写[了一篇](http://pwnwear.com/forum/forum-integration-with-wordpress-t554.html)关于将论坛与 Wordpress 集成的文章，并回顾了一些与我自己的经历相关的选择。它考虑了 bbpress、phpbb、simplepress 等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-15T10:17:44.900

[http://simplepressforum.com/](http://simplepressforum.com/)具有比 bbPress 更多的功能，并且作为插件运行。它使用站点成员列表，您可以从那里指定子组。很多选项，都在选项菜单中。开发人员似乎也非常敏感和活跃。他们有一个支持论坛。当然，它是可主题化的——有自己的 CSS 文件。

绝对值得一试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-07T18:33:07.793

bbPress 1.0“最终版”现已发布。 [http://bbpress.org/blog/2009/07/bbpress-1-0-final-finally-released/ 本](http://bbpress.org/blog/2009/07/bbpress-1-0-final-finally-released/) 机集成，但尚未经过充分测试。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-17T21:17:03.987

查看这篇关于在 WordPress 中使用自定义帖子类型在本地构建论坛的博文。[http://justintadlock.com/archives/2010/07/16/a-wordpress-forum-plugin-using-custom-post-types](http://justintadlock.com/archives/2010/07/16/a-wordpress-forum-plugin-using-custom-post-types)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-10-12T21:43:26.207

我是[WordPress 论坛插件](http://www.wordpressplugin.com/)的首席开发人员，这是一个功能齐全的 WordPress 博客论坛插件。我同样对 WordPress 管理员可用的论坛插件感到沮丧，并决定研究解决方案。我的插件使用 MyBB 作为基础论坛包，但与 WordPress 无缝集成。目标是为用户提供丰富的论坛体验，同时为博客所有者保持简单的管理和升级。

我们还没有完全准备好发布，但我们正在寻找更多的 beta 测试人员。更多信息可以在我们的网站上找到。我们应该有望在未来几个月内推出。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-05T01:09:01.753

我想我必须添加我自己的答案。

“集成论坛与 WordPress 文章”非常好。但它有点老了，新版本的 WordPress 工作方式不一样，尤其是 cookie。

最好的选择可能是等到 bbPress 1.0 版发布。他们正在努力使用更多与 WordPress 中相同的代码，并将尝试修复[WordPress 2.6 发布时发生的一些集成问题](http://bbpress.org/forums/topic/wordpress-and-bbpress-integration-101)。正如*ck*在那篇文章中所说：“集成的定义是两个软件作为一个软件运行”。如果这是目标，那么似乎最好等待。

他们正在到达那里。[bbPress 1.0-alpha-2 于](http://bbpress.org/blog/2008/10/bbpress-10-alpha-2-released/)一个月前发布，并且开始包含集成功能，

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-15T20:43:20.637

我认为他们现在已经达到了 alpha 6。它看起来很稳定，您可以将用户等与 2.7 wordpress 集成。

我发现的两个问题是。

1.  一些关于 BBPress 的插件中断。我不记得是哪些，但有些记得。我认为是站点地图。

2.  有一个集成主题的示例，以便 wordpress 页眉和页脚环绕论坛。我无法让它工作。它破坏了 wp-admin 的风格，我无法再登录。没有时间破解解决方案。

无论如何，我在这里建立了一个 BBPress 论坛[http://www.stephenbaugh.com/blog/forums/](http://www.stephenbaugh.com/blog/forums/)

应该希望尽快修复其余的集成，因为我想要一个集成的主题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-04-06T10:35:31.383

是的，[bbPress](http://www.forum-software.org/bbpress/review)绝对是与 Wordpress 集成的最佳论坛。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-05-14T14:10:30.173

我刚刚安装了 WP-Forum 2.4。非常基础和简单，但它很容易安装、设置和使用。它在选项和自定义方面绝对是有限的，但是您可以从可以集成到您网站中的免费论坛中获得什么。这真的是最重要的部分——它集成得如此容易，而且看起来我花时间让它成为我网站的一部分。

我还在寻找另一个，接下来可能会尝试简单的按下。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-06-05T00:32:18.540

我知道 Bppress 是与 Wordpress 博客集成的最佳论坛软件。但是该软件在维护与会员帐户的会话方面仍然存在问题。

我正在运行两个或多个由 Wordpress 提供支持的社区站点，并且我正在使用“SimplePress-免费插件”，它对我来说非常有用。

如果您想查看论坛软件如何与我的 IT 专业人员社区页面配合使用？看看这里 [http://avanthu.com/forum](http://avanthu.com/forum) 它与现有成员和新成员完美配合，在使用该软件之前，我尝试了许多支持 wordpress 的插件，但没有比这更好的了。我强烈推荐简单的新闻论坛插件。

# ajax - JSONP 和跨域查询 - 如何更新/操作而不是仅仅阅读

> ID：248789
> 
> 赞同：1
> 
> 时间：2008-10-29T23:24:11.190
> 
> 标签：ajax, security, jsonp

所以我正在阅读 The Art & Science of Javascript，这是一本好书，它有一个关于 JSONP 的好部分。我今天一直在阅读所有关于它的内容，甚至在 StackOverflow 上查看了所有问题。*JSONP 是个好主意，但它似乎只解决了获取*数据的“同源问题” ，而没有解决*更改*数据的问题。

我只是错过了所有讨论这个问题的博客，还是 JSONP**不是**我希望的解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T23:39:05.560

JSONP 会导致向另一个服务器生成一个 SCRIPT 标记，其中包含 GET 请求可能需要的任何参数。例如

```
<script src="http://myserver.com/getjson?customer=232&callback=jsonp543354" type="text/javascript">
</script> 
```

从技术上讲，没有什么可以阻止这种请求更改服务器上的数据，例如指定 newName=Tony。您的回答可能是更新是否成功。您将受到查询字符串的限制。如果您要使用这种方法，请添加一些随机元素作为参数，以便代理不会缓存它。

有些人可能认为这违背了 GET 的工作方式，即它们不应该导致数据发生变化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T01:27:48.663

是的，老实说，我想坚持这种范式。但是，我可能会改变规则并说，不更改/处理 CRUCIAL 数据的请求将可以通过 GET 调用访问......嗯......

例如，我正在构建一个购物车系统，我认为允许在购物车中添加/删除/等项目可以很容易地通过 GET 公开，因为即使您可以更改数据，您也不能做任何关键的事情用它。如果有人恶意将 1,000 台纯平显示器添加到您的购物车中，则至少有一个验证步骤不会受到任何攻击（此时是标准 ASP.NET 页面，带有验证和所有这些爵士乐）。

在任何人看来，这是一个好的/可行的解决方案吗？

# c# - 有没有办法在 c# 中强制执行函数内联？

> ID：248799
> 
> 赞同：6
> 
> 时间：2008-10-29T23:31:13.907
> 
> 标签：c#, optimization, call, overhead, inlining

据我所知，没有办法暗示 c# 编译器内联一个特定的函数，我猜它是这样设计的。

我还认为不让程序员指定要内联的内容和不内联的内容通常是一个好主意，因为这意味着您认为自己比 JIT 编译器更聪明（我对那些实际上是的人表示敬意），但是，什么如果我想指定代码的关键部分需要不惜一切代价非常快，无论如何在目标机器上实现它？到目前为止，您还不能做这样的事情，我想知道 c# 语言和 JIT 是否都将支持此功能。

就我而言，我知道目标机器是什么，而且我知道函数内联将有助于提高性能。这让我认为，执行函数内联的唯一方法是了解 JIT 在什么情况下会这样做，但我认为这也不是一个好主意，

任何关于这个主题的光都将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-29T23:39:58.820

简短的回答：没有

长答案：http: [//blogs.msdn.com/ericgu/archive/2004/01/29/64644.aspx](http://blogs.msdn.com/ericgu/archive/2004/01/29/64644.aspx)

内联标准：http: [//blogs.msdn.com/davidnotario/archive/2004/11/01/250398.aspx](http://blogs.msdn.com/davidnotario/archive/2004/11/01/250398.aspx)和[http://blogs.msdn.com/ericgu/archive/2004/01/29/64717。 aspx](http://blogs.msdn.com/ericgu/archive/2004/01/29/64717.aspx)

请注意，在关于内联标准的最后两个链接中，关于结构不是内联的链接已经过时；更新信息可在以下网址找到：http: [//blogs.msdn.com/vancem/archive/2008/05/12/what-s-coming-in-net-runtime-performance-in-version-v3-5-sp1 .aspx](http://blogs.msdn.com/vancem/archive/2008/05/12/what-s-coming-in-net-runtime-performance-in-version-v3-5-sp1.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T23:43:52.260

我最近对此进行了基准测试：

[http://www.gfilter.net/junk/BubblesortBenchmark.jpg](http://www.gfilter.net/junk/BubblesortBenchmark.jpg)（越高越差）

如您所知，CLR 和 JVM 在方法内联方面都比以往任何时候都好得多。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-12-14T10:40:12.540

随着 .Net 4.5 的出现，情况发生了一些变化。

您现在可以使用该属性装饰一个方法，[`[MethodImplAttribute(MethodImplOptions.AggressiveInlining)]`](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.methodimploptions%28v=vs.110%29.aspx)如果可能的话，它将使其被 JIT 内联。

有关更多详细信息，请参阅[此博客](http://blogs.microsoft.co.il/blogs/sasha/archive/2012/01/20/aggressive-inlining-in-the-clr-4-5-jit.aspx)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-30T00:43:23.230

```
if(performance < ACCEPTABLE){
   if(profiler.showsAffectOfMethodCallOverhead() && seriouslyWeDoubleChecked()){
      if(runtimeContext.isReallyStableAndNotProneToChange() && weNeedToGetThisThingBatOutOfHellFast()){
          return thisIsOneOfTheFewTimesWhenANativeExternalFunctionMayBeWorthIt();
      }
   }
 }
 return dontWorryAboutIt(); 
```

如果您正在执行那条罕见的路径，请打破您的 C 或 ASM。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-29T23:54:39.040

[替代文字 http://web.ics.purdue.edu/~ssanty/images/1.gif](http://web.ics.purdue.edu/~ssanty/images/1.gif)

# flash - 如何启用将 SWF 中文件上传的超时设置为大于 3 分钟？

> ID：248820
> 
> 赞同：0
> 
> 时间：2008-10-29T23:43:13.663
> 
> 标签：flash, timeout, file-upload

我正在使用 SWFUpload 处理文件上传，但遇到了一个问题，即任何文件上传 >= 3 分钟都会超时。据我所知，Apache 和 PHP 已正确配置以处理大文件。Flash 是否有任何可能影响此的设置？Flash 是否有某种我可以更改的超时值？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T04:46:36.423

如果 PHP 脚本超时，那么您可以通过调用 set_time_limit(int seconds) 来调整 php time_limit。如果将其设置为 -1，则脚本将无限期执行，如果这是您想要/需要的。

如果 Flash 超时，您可能需要查看以下内容：

[http://www.aflax.org/forums/topic.php?id=38](http://www.aflax.org/forums/topic.php?id=38)

[http://www.kirupa.com/forum/archive/index.php/t-262299.html](http://www.kirupa.com/forum/archive/index.php/t-262299.html)

# svn - 在 TortoiseSVN 中撤销提交

> ID：248821
> 
> 赞同：102
> 
> 时间：2008-10-29T23:43:50.840
> 
> 标签：svn, tortoisesvn, undo

我不小心提交了一堆文件（不同文件夹中的数十个文件）。什么是“撤消”该提交而无需从我的工作目录中删除文件的最简单、最干净（也是最安全！）的方法？

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2008-10-29T23:51:30.950

转到**Show Log** Screen，选择要撤消的修订，右键单击它并选择**Revert changes from this revision**，这将执行[反向合并](http://svnbook.red-bean.com/en/1.8/svn.branchmerge.basicmerging.html#svn.branchmerge.basicmerging.undo)。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-29T23:52:26.297

您可能需要使用命令行，但您可以使用 SVN 合并命令并反向指定修订以有效恢复提交。假设你的错误提交是 r1123，你会这样做：

```
svn merge -r1123:1122 <url of your working copy> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-29T23:49:16.897

您可以将工作副本恢复到提交之前的修订版。恢复工作副本后，只需提交更改，您将有效地回滚意外提交。

在像你这样的情况下，我可能会检查我想要回滚到新工作副本的修订，然后将工作副本提交给头修订。

# c# - 有时以管理员身份运行

> ID：248824
> 
> 赞同：3
> 
> 时间：2008-10-29T23:43:55.613
> 
> 标签：c#, windows-vista, uac

我有一个程序大部分时间都需要以普通用户的身份运行，但有时我需要停止并启动一项服务。如何制作一个大多数时间以普通用户身份运行但针对某些功能提升为管理员模式的程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T04:06:25.500

一旦进程运行，您将无法提升进程，但您可以：-

## 以提升的身份重新启动进程

```
private void elevateCurrentProcess()
{
    ProcessStartInfo startInfo = new ProcessStartInfo();
    startInfo.UseShellExecute = true;
    startInfo.WorkingDirectory = Environment.CurrentDirectory;       
    startInfo.FileName = Application.ExecutablePath;
    startInfo.Verb = "runas";

    try
    {
        Process p = Process.Start(startInfo);
    }
    catch
    {
        // User didn't allow UAC
        return;
    }
    Application.Exit();
} 
```

这种方法意味着您的流程继续运行提升并且不再有 UAC 提示 - 好事和坏事取决于您的受众。

## 将需要提升的代码放入单独的exe中

将清单设置为 requireAdministrator 并将其作为单独的进程启动。请参阅此[示例代码](http://www.microsoft.com/downloads/details.aspx?FamilyID=2cd92e43-6cda-478a-9e3b-4f831e899433&DisplayLang=en)

此方法意味着每次运行操作时都会出现 UAC 提示。

最佳方法取决于您的受众（管理员类型与否）和提升操作的频率。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T00:45:00.483

据我所知，您需要启动一个以管理员身份运行的单独进程。一旦一个进程已经启动，你就不能提升它。

看到[这个问题](https://stackoverflow.com/questions/78696/vista-uac-access-elevation-and-net)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T00:38:43.927

您需要使用所谓的模拟..

[ [http://support.microsoft.com/kb/306158][1]](http://support.microsoft.com/kb/306158][1])

上面显示了如何为 ASP.Net 应用程序实现它，但代码可能与您的需求几乎相同。

# eclipse - 在 Windows 上使用 Wascana 编译 FFMPEG

> ID：248828
> 
> 赞同：1
> 
> 时间：2008-10-29T23:45:29.587
> 
> 标签：eclipse, ffmpeg

有没有人尝试过，或者成功地让 Wascana（Eclipse CDT + MinGW for Windows）在 Windows 下编译 FFMPEG。显然这是可能的，[克雷格肖的网站上什至有一个教程，](http://www.craigshaw.com/2007/07/25/BuildingFFMPEGUsingCDTForWindows.aspx)但我无法让它工作。

我在 FFMPEG 源代码上运行 ./configure 然后在 Eclipse 中创建一个新项目并将其指向源代码，但它不会将其识别为 Makefile 项目。我认为我需要创建一个与 MinGW 一起使用的构建器，但到目前为止我微弱的尝试都没有成功。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T01:26:48.120

嘿，我可以回答我自己的问题！经过大量的摆弄，我想出了程序：

*注意：这是针对 Wascana 0.9.3 和 2008 年 9 月 SVN 版本的 FFMPEG。*

**准备环境**

安装 Wascana 后，您需要更新各种 MinGW 和 MSYS 软件包。下载并解压以下内容（您可以从 MinGW 网站下载它们）：

MSYS 软件包：

*   bash-3.1
*   coreutils-5.97
*   m4-1.4.7
*   制作 3.81

MinGW 软件包：

*   w32api-3.12
*   MinGW 运行时 3.15

**建造**

1.  解压 FFMPEG 源代码并像这样配置（暂时不要编译）：

./configure --enable-memalign-hack --disable-shared --enable-static --disable-mmx --disable-mmx2 --disable-optimizations --disable-stripping

2.  启动 Wascana/Eclipse 并创建一个新的 C 项目。
3.  不要选择“Hello World”项目，只需选择一个 Makefile 项目并选择 MinGW 工具链。
4.  将项目路径设置为 FFMPEG 源代码所在的位置。
5.  单击完成，源应自行构建！

**安装**

1.  右键单击项目并选择 Make Targets > Create。
2.  在对话框中，将 Make Target 和 Target name 都设置为“install”。
3.  运行您刚刚创建的目标。这将安装 FFMPEG 库。

**执行和调试**

1.  打开调试对话框
2.  右键单击“C/C++ 本地应用程序”并选择“新建”
3.  填写项目名称并选择要运行的EXE（在我的例子中是ffplay_g.exe）
4.  转到调试器选项卡并将调试器更改为“MinGW gdb Debugger”

我还必须确保 SDL.dll 的副本位于 ffmpeg 目录中。

呸，何等的煎熬。这一切都对我有用，希望它也对你有用！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T15:32:56.920

安装最后一个 MSYS 和 MinGW Cf。 [链接文本](http://ffmpeg.arrozcru.com/wiki/index.php?title=MSys_MinGW)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-27T12:12:43.937

当我运行调试时，我得到“gdb.exe 遇到问题，需要关闭....”

我更新到 gdb 6.8 并成功调试

# python - Python：使用递归算法作为生成器

> ID：248830
> 
> 赞同：101
> 
> 时间：2008-10-29T23:45:56.357
> 
> 标签：python, recursion, generator

最近我写了一个函数来生成具有非平凡约束的某些序列。问题来自一个自然的递归解决方案。现在碰巧的是，即使对于相对较小的输入，序列也是数千个，因此我更愿意使用我的算法作为生成器，而不是使用它来填充所有序列的列表。

这是一个例子。假设我们想用递归函数计算一个字符串的所有排列。以下朴素算法采用额外的参数“存储”，并在找到时附加一个排列：

```
def getPermutations(string, storage, prefix=""):
   if len(string) == 1:
      storage.append(prefix + string)   # <-----
   else:
      for i in range(len(string)):
         getPermutations(string[:i]+string[i+1:], storage, prefix+string[i])

storage = []
getPermutations("abcd", storage)
for permutation in storage: print permutation 
```

（请不要在意效率低下，这只是一个例子。）

现在我想把我的函数变成一个生成器，即产生一个排列而不是将它附加到存储列表中：

```
def getPermutations(string, prefix=""):
   if len(string) == 1:
      yield prefix + string             # <-----
   else:
      for i in range(len(string)):
         getPermutations(string[:i]+string[i+1:], prefix+string[i])

for permutation in getPermutations("abcd"):
   print permutation 
```

此代码不起作用*（*该函数的行为类似于一个空生成器）。

我错过了什么吗？有没有办法将上述递归算法变成生成器*而不用迭代算法替换它*？

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2008-10-29T23:53:47.840

```
def getPermutations(string, prefix=""):
    if len(string) == 1:
        yield prefix + string
    else:
        for i in xrange(len(string)):
            for perm in getPermutations(string[:i] + string[i+1:], prefix+string[i]):
                yield perm 
```

或者没有蓄能器：

```
def getPermutations(string):
    if len(string) == 1:
        yield string
    else:
        for i in xrange(len(string)):
            for perm in getPermutations(string[:i] + string[i+1:]):
                yield string[i] + perm 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-31T00:05:38.003

这避免了`len(string)`-deep 递归，并且通常是处理 generators-inside-generators 的好方法：

```
from types import GeneratorType

def flatten(*stack):
    stack = list(stack)
    while stack:
        try: x = stack[0].next()
        except StopIteration:
            stack.pop(0)
            continue
        if isinstance(x, GeneratorType): stack.insert(0, x)
        else: yield x

def _getPermutations(string, prefix=""):
    if len(string) == 1: yield prefix + string
    else: yield (_getPermutations(string[:i]+string[i+1:], prefix+string[i])
            for i in range(len(string)))

def getPermutations(string): return flatten(_getPermutations(string))

for permutation in getPermutations("abcd"): print permutation 
```

`flatten`允许我们通过简单地 ing 它来继续在另一个生成器中取得进展`yield`，而不是遍历它并`yield`手动 ing 每个项目。

* * *

Python 3.3 将添加[`yield from`](http://docs.python.org/dev/whatsnew/3.3.html#pep-380-syntax-for-delegating-to-a-subgenerator)到语法中，允许自然委托给子生成器：

```
def getPermutations(string, prefix=""):
    if len(string) == 1:
        yield prefix + string
    else:
        for i in range(len(string)):
            yield from getPermutations(string[:i]+string[i+1:], prefix+string[i]) 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-29T23:54:51.923

getPermutations 的内部调用——它也是一个生成器。

```
def getPermutations(string, prefix=""):
   if len(string) == 1:
      yield prefix + string            
   else:
      for i in range(len(string)):
         getPermutations(string[:i]+string[i+1:], prefix+string[i])  # <----- 
```

您需要使用 for 循环遍历它（请参阅@MizardX 帖子，它让我领先几秒钟！）

# c# - 你能在类型数组上写扩展方法吗？

> ID：248838
> 
> 赞同：2
> 
> 时间：2008-10-29T23:49:38.830
> 
> 标签：c#, arrays, extension-methods

我需要在 byte[] 上写一个扩展方法。那可能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-29T23:59:25.987

是的，只需这样做：

```
public static class Extensions
{
    public static void Method(this byte[] current)
    {

    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T23:51:11.027

当然，只需制作 type 的第一个参数`byte[]`。

# vbscript - 使用 VBScript 和 FileSystemObject 对日志文件的独占文件访问

> ID：248859
> 
> 赞同：4
> 
> 时间：2008-10-29T23:55:23.373
> 
> 标签：vbscript, file-permissions, file-access, filesystemobject

我有一个当前写入日志文件的 VBS 脚本。这个脚本可以启动我的多个同时进程，所以现在我担心并发性。

我目前`FileSystemObject`用来打开和写入这个文件。FSO 是否支持独占文件访问？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T02:02:06.613

是的，FileSystemObject 确实支持独占文件访问。如果在您调用 OpenTextFile 时另一个进程锁定了该文件，您将收到错误消息（权限被拒绝错误）。您应该能够捕获错误并适当地处理它（在调用 OpenTextFile 之后检查 Err.Number <> 0 是您可以做到的一种方法）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T00:29:46.623

如果可能的话，我建议您在每次需要写入文件时关闭句柄并重新打开它，以避免可能的独占文件访问问题。前任：

```
set objFile = objFSO.OpenTextFile("somefile.txt",8,True)
objFSO.WriteLine "jfdskfdkls"
objFSO.Close
'something something
set objFile = objFSO.OpenTextFile("somefile.txt",8,True)
objFSO.WriteLine "gfdgfdgfd"
objFSO.Close
'something else
set objFile = objFSO.OpenTextFile("somefile.txt",8,True)
objFSO.WriteLine "ddsgfgdfsgdfs"
objFSO.Close 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T11:53:04.097

我不知道 Windows API 对你来说有多容易访问，但你应该看看 Windows API 中的调试基础结构。

[这里](http://www.codeproject.com/KB/winsdk/OutputDebugString.aspx)有一篇很好的代码项目文章 基本上使用 OutputDebugString 并使用 DebugView 捕获它，或者将其传送到文件将消除锁定日志文件的问题，还将消除排队写入日志文件的多个脚本的瓶颈。

希望这可以帮助。

# sql - 如何在我的 MySQL varchar 列中创建最常见子字符串的有序列表？

> ID：248864
> 
> 赞同：0
> 
> 时间：2008-10-29T23:57:42.870
> 
> 标签：sql, mysql, statistics

我有一个包含几千行的 MySQL 数据库表。该表设置如下：

`id | text`

该`id`列是一个自动递增的整数，并且该`text`列是一个 200 个字符的 varchar。

假设我有以下行：

`3 | I think I'll have duck tonight`

`4 | Maybe the chicken will be alright`

`5 | I have a pet duck now, awesome!`

`6 | I love duck`

那么我想要生成的列表可能是这样的：

*   “鸭子”出现 3 次
*   “我”出现 3 次
*   出现 2 次“有”
*   “鸡”出现 1 次
*   等

另外，我可能想要维护一个从列表中忽略的子字符串列表，例如'I'、'will'和'have。重要的是要注意，我不知道人们会发布什么。

我没有要监视的单词列表，我只想找到最常见的子字符串。然后，我将通过编辑查询手动从列表中过滤掉任何不感兴趣的错误子字符串。

谁能建议最好的方法来做到这一点？谢谢大家！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T05:44:03.560

MySQL 已经为你做到了。

首先确保您的表是 MyISAM 表

在列上定义 FULLTEXT 索引

在 shell 命令行上导航到存储 MySQL 数据的文件夹，然后键入：

```
myisam_ftdump -c yourtablename 1 >wordfreq.dump 
```

然后，您可以处理 wordfreq.dump 以消除不需要的列并按频率降序排序。

毫无疑问，您可以使用单个命令行和一些 sed/awk 魔法来完成上述所有操作。您可以将其合并到您的程序中，而无需转储文件。

关于 myisam_ftdump 的更多信息：http: [//dev.mysql.com/doc/refman/5.0/en/myisam-ftdump.html](http://dev.mysql.com/doc/refman/5.0/en/myisam-ftdump.html)

哦...还有一件事，MySQL 的停用词已预编译到引擎中。并且不索引具有 3 个或更少字符的单词。完整列表在这里：

[http://dev.mysql.com/doc/refman/5.0/en/fulltext-stopwords.html](http://dev.mysql.com/doc/refman/5.0/en/fulltext-stopwords.html)

如果此列表不能满足您的需要，或者您需要计算少于 3 个字符的单词，唯一的方法是使用不同的 FULLTEXT 规则重新编译 MySQL。我不建议这样做！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T00:03:59.037

解压到平面文件，然后使用您喜欢的快速语言、perl、python、ruby 等来处理平面文件。

如果您的技能组合中没有一种这些语言，那么开始使用一种语言是一项完美的小任务，而且不会花费您很长时间。

一些数据库任务在数据库之外执行起来要容易得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T00:10:28.227

您可能想查看 MySQL [Full-Text Parser Plugins](http://dev.mysql.com/doc/refman/5.1/en/plugin-full-text-plugins.html)

# apache - 如何验证 mod_rewrite 是否正常工作

> ID：248883
> 
> 赞同：3
> 
> 时间：2008-10-30T00:08:31.397
> 
> 标签：apache, mod-rewrite

我在使用 mod_rewrite 时遇到了很多麻烦，有一段时间我一直在进行，但由于某种原因，一切都停止了工作。

有没有我可以做的任何基本测试来确保它不是根本性的破坏。

它确实出现在 phpinfo();

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T01:51:29.397

没有人提到的一个秘密是 mod_rewrite 令人困惑，部分原因是它有*问题*。

一旦你确定你理解它，它就会做一些奇怪的事情，你会感到沮丧，发誓再也不会碰它。今年早些时候，我发现了一个[2001 年描述](http://archive.apache.org/gnats/7879)的错误。没错，*2001*。它有一个2006 年的[bugzilla 条目](https://issues.apache.org/bugzilla/show_bug.cgi?id=38642)。还有几个重复项。该错误很容易重现，但仍未修复。

甚至还有一个补丁，但尚未合并到代码中。

当然，mod_rewrite 是 mod_rewrite，很有可能对正在发生的事情有一个合乎逻辑的、简单的解释。代码和示例可能会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T00:19:35.823

RewriteLog 和 RewriteLogLevel 应该可以帮助您了解发生了什么。

[http://httpd.apache.org/docs/2.0/mod/mod_rewrite.html#rewritelog](http://httpd.apache.org/docs/2.0/mod/mod_rewrite.html#rewritelog)

至于测试，使用 curl 设置一个 shell 脚本，运行它，然后查看日志。

为了更加健壮，您可以通过使用您选择的脚本语言解析生成的日志文件来编写实际测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T00:14:49.467

使用 .htaccess 文件创建一些规则。如果他们不工作，那么有些东西坏了:)

# sql-server - 经典 ASP：从 SQL 表翻译的页面文本，更快的方法？

> ID：248889
> 
> 赞同：1
> 
> 时间：2008-10-30T00:11:42.313
> 
> 标签：sql-server, asp-classic, vbscript, language-features, ado

使用经典的 ASP VBScript，与 MS SQL Server 耦合，我们有一个接受 3 个整数的函数，`page_id`, `heading_id`,`language_id`

它在翻译表中查找页面标题...

该表包含大约 10,000 行...

标题列是 nvarchar(1000) 加上 3 个 int 列，这意味着它每行最大大约 2KiB...

所以我的问题是，是否值得使用 ADO 的 GetRows 或通过其他方法将此表复制到内存（例如应用程序对象）中，或者由于“大”数据大小而不值得这样做。

每页大约有 1 到 250 个标题，462 页，平均每页 34 个标题。

因此，为了节省大约 34 个数据库调用一个页面，我使用了一大块内存，并调用了应用程序，而且它可能更慢？

想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T00:23:03.943

可能，保存电话。

此外，34 次数据库调用不必是 34 次往返。批处理您的数据库调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T00:20:23.807

对于大多数数据驱动的应用程序，通常最昂贵的部分是数据库连接。在每行 2k 和 10k 行时，仍然只有 20 兆。如果数据使用非常频繁，那么为消除不必要的数据库命中付出的代价似乎很小。

# css - 在 VS 2008 中评论 CSS 的快捷方式

> ID：248900
> 
> 赞同：4
> 
> 时间：2008-10-30T00:18:52.080
> 
> 标签：css, visual-studio

当我在编辑 CSS 文件时按 VS2008 中的标准 Ctrl + E、C（其他变体）时，它说该命令不可用。如何设置快捷方式以将普通的旧 /* */ 注释应用于 VS 中的选定文本？谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T05:16:30.420

在 Visual Studio 中，按 Alt-F11 打开宏 IDE 并通过右键单击 MyMacros 并选择 Add|Add Module... 添加一个新模块

在源代码编辑器中粘贴以下内容：

```
Imports System
Imports EnvDTE
Imports EnvDTE80
Imports EnvDTE90
Imports System.Diagnostics

Public Module CommentCSS
    Sub CommentCSS()
        Dim selection As TextSelection
        selection = DTE.ActiveDocument.Selection

        Dim selectedText As String
        selectedText = selection.Text

        If selectedText.Length > 0 Then
            selection.Text = "/*" + selectedText + "*/"
        End If
    End Sub
End Module 
```

您可以通过转到工具|选项...并在左侧导航的**环境**部分下选择**键盘来创建键盘快捷键。**选择您的宏并分配您喜欢的任何快捷方式。

 **您还可以通过转到工具|自定义...并选择左侧导航中的**宏部分来将宏添加到菜单或工具栏。**一旦你在列表中找到你的宏，你可以将它拖到任何菜单或工具栏，它的文本或图标可以自定义为你想要的任何东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-03T18:01:28.343

这是一个更简单的解决方案：

```
Sub CommentCSS()
    DTE.ActiveDocument.Selection.StartOfLine(VsStartOfLineOptions.VsStartOfLineOptionsFirstText)
    DTE.ActiveDocument.Selection.Text = "/*"
    DTE.ActiveDocument.Selection.EndOfLine()
    DTE.ActiveDocument.Selection.Text = "*/"
End Sub 
```

您可以使用 ctrl+shift+R 自己录制

1.  将光标放在要评论的行上
2.  按键盘上的“主页”
3.  类型 /*
4.  按键盘上的“结束”
5.  类型 */
6.  保存您的录音

# c# - 如果对象是通用列表

> ID：248903
> 
> 赞同：14
> 
> 时间：2008-10-30T00:20:13.043
> 
> 标签：c#, .net, vb.net, list, generics

有没有办法确定一个对象是否是一个通用列表？我不会知道列表的类型，我只知道它是一个列表。我怎样才能确定呢？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-30T00:32:03.143

这将返回“真”

```
List<int> myList = new List<int>();

Console.Write(myList.GetType().IsGenericType && myList is IEnumerable); 
```

您是否想知道它是否完全是一个“列表”......或者您是否可以接受它是 IEnumerable 和 Generic？

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-30T00:32:32.847

以下方法将返回泛型集合类型的项目类型。如果该类型未实现 ICollection<>，则返回 null。

```
static Type GetGenericCollectionItemType(Type type)
{
    if (type.IsGenericType)
    {
        var args = type.GetGenericArguments();
        if (args.Length == 1 &&
            typeof(ICollection<>).MakeGenericType(args).IsAssignableFrom(type))
        {
            return args[0];
        }
    }
    return null;
} 
```

**编辑：**上述解决方案假定指定的类型有自己的泛型参数。这不适用于使用硬编码泛型参数实现 ICollection<> 的类型，例如：

```
class PersonCollection : List<Person> {} 
```

这是一个处理这种情况的新实现。

```
static Type GetGenericCollectionItemType(Type type)
{
    return type.GetInterfaces()
        .Where(face => face.IsGenericType &&
                       face.GetGenericTypeDefinition() == typeof(ICollection<>))
        .Select(face => face.GetGenericArguments()[0])
        .FirstOrDefault();
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-02-21T17:06:47.677

接受的答案不保证 IList<> 的类型。检查这个版本，它对我有用：

```
private static bool IsList(object value)
{
    var type = value.GetType();
    var targetType = typeof (IList<>);
    return type.GetInterfaces().Any(i => i.IsGenericType 
                                      && i.GetGenericTypeDefinition() == targetType);
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T00:30:57.810

尝试：

```
if(yourList.GetType().IsGenericType)
{
  var genericTypeParams = yourList.GetType().GetGenericArguments;
  //do something interesting with the types..
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T13:53:36.037

这个问题是模棱两可的。

答案取决于您所说的通用列表的含义。

*   一个列表<SomeType> ？

*   从 List<SomeType> 派生的类？

*   实现 IList<SomeType> 的类（在这种情况下，可以将数组视为通用列表 - 例如 int[] 实现 IList<int>）？

*   一个通用并实现 IEnumerable 的类（这是在[接受的答案](https://stackoverflow.com/questions/248903/if-object-is-generic-list#248918)中提出的测试）？但这也会将以下相当病态的类视为通用列表：

.

```
public class MyClass<T> : IEnumerable
{
    IEnumerator IEnumerable.GetEnumerator()
    {
        return null;
    }
} 
```

最佳解决方案（例如是否使用 GetType、IsAssignableFrom 等）将取决于您的意思。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-30T00:30:05.690

System.Object 类中有一个 GetType() 函数。你试过吗？

# synchronization - 如何同步两个进程？

> ID：248911
> 
> 赞同：7
> 
> 时间：2008-10-30T00:29:46.550
> 
> 标签：synchronization, hardware, process, pthreads, named-pipes

我有一个硬件接口，我想在同一个工作站上的两个应用程序（进程）中使用。硬件需要一个初始化调用，然后任何一个应用程序都使用相同的函数（在同一个库中）与硬件进行许多事务。

所以每个应用程序都应该像这样：

```
main()
    // I don't know if another app already init'ed the HW
    ret = hw_init_lock(non-blocking)

    if ret = OK
        // no one else has done this, I have to
        init_hw()
    else
       //someone else has already init'ed the HW, I gotta make sure it stays that way
       //as long as I'm alive
       increment_hw_init_ref_counter()

    hw_trans_lock(blocking)
    hw_trans()
    hw_trans_unlock()
    ....

    //exit app, uninit hw if we are last out
    ret = decrement_hw_init_ref_counter()
    if ret == 0
        uninit_hw()

    exit(0) 
```

我可以在两个应用程序之间共享的锁和引用计数调用中使用什么机制？我正在考虑命名管道，即 mkfifo()。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-30T02:02:13.073

[POSIX 信号量](http://linux.die.net/man/7/sem_overview)是要走的路。由于您希望跨进程共享相同的信号量，因此您需要使用命名信号量。：

> 命名信号量由 /somename 形式的名称标识。通过将相同的名称传递给 sem_open(3)，两个进程可以对同一个命名的信号量进行操作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T06:09:24.023

信号量和互斥体/条件变量是很好的、非常高性能的原语，适用于线程之间或进程之间。

所有这些都基于在共享内存上执行的测试和设置或其他原子操作的想法（并且通常基于现实）。

如果您希望通过网络分发您的进程，那么信号量和互斥锁可能不适合您——它们只在一台机器上工作。管道和套接字通常是网络可扩展的。

互斥量、条件变量和信号量的简要总结：

**互斥体**

互斥锁是可以锁定或解锁的原语。锁定它的进程/线程必须是解锁它的进程/线程。这种*所有权*方面允许操作系统应用一些有趣的优化，例如优先级继承和优先级上限协议（以避免优先级倒置）。 **但是**，互斥体没有与之关联的计数。一般来说，你不能锁定一个已经锁定的互斥体，并保留它被“锁定两次”的内存（我认为有一些扩展允许这样做，但它们并非在任何地方都可用）

**条件变量**

互斥锁非常适合......嗯，互斥。但是，如果您需要阻止与您具有互斥的对象相关联的条件怎么办？为此，您使用条件变量或 CV。CV 与互斥锁相关联。例如，假设我有一个我的进程想要访问的输入数据队列。一个人抓住互斥锁，这样它就可以查看队列而不必担心干扰。但是，它发现队列是空的，并希望等待队列中的某些内容。因此，它等待“队列非空”条件变量。这里有趣的部分是，因为 CV 与互斥锁相关联，互斥锁会*自动重新获取*一旦条件变量发出信号。因此，一旦进程在等待 CV 后唤醒，它就知道它再次拥有对队列的独占访问权。它不*知道*队列上是否真的有任何东西——也许两个进程在 CV 上等待——一个东西进来了——第一优先级进入并在第二个东西醒来之前将“东西”出队。因此，无论何时使用 CV，都需要重新检查条件，如下所示：

```
mutex_enter(m);
while (! condition) {
   cond_wait(m, c); // drop mutex lock;  wait on cv;  reacquire mutex
}
//processing related to condition
mutex_exit(m); 
```

**信号量**

好的，那就是互斥锁和条件变量。信号量更简单。它们可以通过任何进程递增和递减。它们有记忆——它们会计数——因此您可以使用它们来确定发生了多少情况。条件变量并非如此。此外，因为信号量可以由一个进程递减并由另一个进程递增，所以它们没有所有权方面——因此没有优先级继承，也没有优先级反转避免是可能的。

现在，最后——所有这些机制都需要共享内存才能有效地实现。这对您来说可能很好，但请注意——如果您认为您的应用程序最终可能会被分发，那么互斥锁、条件变量和信号量可能不适合您。管道和套接字虽然开销要高得多，但有可能相当直接地在网络上扩展。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T00:39:57.280

使用[POSIX 信号量](http://www.opengroup.org/onlinepubs/000095399/basedefs/semaphore.h.html)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T01:14:39.470

由于您只需要一个信号量计数，因此互斥体就足够了。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-03-25T19:48:47.843

我想如果我们想要同步多个正在运行的进程，那么我们可以使用一种非常简单的技术，称为文件锁。

更多详情请参考这篇文章：http: [//blog.markedup.com/2014/07/easy-mode-synchronizing-multiple-processes-with-file-locks/](http://blog.markedup.com/2014/07/easy-mode-synchronizing-multiple-processes-with-file-locks/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T02:05:43.457

我假设

> ...在两个应用程序之间共享？

意味着您希望这两个东西作为单独的进程运行？如果这不是真的，并且它们作为单个进程（具有多个线程）运行，那么信号量和互斥体的建议是最好的选择，并且应该非常简单。

请注意，答案将取决于您访问此硬件的方式。例如，如果它通过文件公开，则可以使用正常的文件锁定。

但是，如果您尝试跨两个进程同步对硬件的访问，那就另当别论了。我想首先要说的是，如果可以的话，同步会更容易，让一个进程负责访问硬件。在此模型中，您可能有一个进程充当硬件的服务器 - 接受来自其他进程的请求并代表它们执行读取和写入。几乎任何形式的进程间通信都适用，但为简单起见，消息队列（[链接](http://tldp.org/LDP/tlk/ipc/ipc.html)）之类的东西可能适合一些适当的数据结构（例如，指示它是读操作还是写操作的标志，从基地址偏移您的硬件、字节数、缓冲区（在写入的情况下））

如果将所有直接硬件访问放到一个进程中是不合适的，那么您将不得不使用适当的同步方案。我会调查文件锁的使用（并实现一个基本的互斥锁方案），或者使用命名信号量（正如 albertb 所建议的那样）

# c# - Windows 工作流 - Web 服务 - App_Data 目录 - 数据库

> ID：248923
> 
> 赞同：2
> 
> 时间：2008-10-30T00:33:38.553
> 
> 标签：c#, asp.net, web-services, workflow

解决方案
-- WorkflowProject
  -- Workflow1
  -- Workflow2
-- WebProject (WAP)
  -- App_Data
    -- MyDatabase.vdb3
  -- MyWebService.asmx
  -- Web.Config

好的，所以..这是项目的基本“大纲”。该数据库存储在网站中，是一个 VistaDB 数据库（也可以是 MSAccess 或 SQLite 数据库）。在网站上，我可以针对数据库进行编码。我可能有 |DataDirectory| 在我的连接字符串中。

WORKFLOW 项目与网站是分开的。MyWebService.asmx 是一个“存根”，用于调用基于工作流的 Web 服务。

***如何****打开网站**App_Data**目录中的数据库？现在，我有硬编码的值（即@"E:\datadirectory\database.vdb3"），但这不是首选，只能在我的开发机器上工作。*

我什至无法传递数据库的位置，因为 web 服务（.asmx 文件）只有 1 行，并且是用于让调用者进入工作流的存根代码。我真的不知道如何进行。

解决方案 ？最佳实践？链接？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T00:46:53.880

你应该看看“ [VirtualPathUtility](http://msdn.microsoft.com/en-us/library/system.web.virtualpathutility.aspx) ”

替换结果：

```
VirtualPathUtility.ToAbsolute("~/App_Data/db.vdb3"); 
```

进入您的连接字符串。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-12T16:50:06.343

我无法让 VirtualPathUtility 工作。这是我最终发现有效的解决方案：

```
string s = AppDomain.CurrentDomain.GetData("DataDirectory") as string; 
```

这将获得 App_Data 目录的绝对路径。

# java - 替代已弃用的 javax.servlet.http.HttpUtils.parseQueryString？

> ID：248938
> 
> 赞同：10
> 
> 时间：2008-10-30T00:42:59.440
> 
> 标签：java, url, parsing, query-string

我正在寻找解析 URL 以获取 Java 中查询字符串参数的集合。需要明确的是，我需要解析给定的 URL（或 URL 对象的字符串值），而不是来自 servlet 请求的 URL。

看起来该`javax.servlet.http.HttpUtils.parseQueryString`方法似乎是显而易见的选择，但它已被弃用。

是否有我遗漏的替代方法，或者它只是在没有等效替换/增强功能的情况下被弃用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T01:01:28.780

我认为这个想法是改用 HttpServletRequest 。有 getParameterMap()、getParameterNames() 和 getParameterValues() 方法可以启动。

还有 getParameter(String paramname) 方法来获取特定方法的值。

这些在查询字符串参数和表单参数之间没有区别，因此，如果您的意图是特别查找查询字符串，那么我想这将无济于事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T10:47:52.543

好吧，正如您提到的 URL 不是来自 servlet 请求，正确的答案是，像往常一样，**它取决于**.

url 的查询部分的问题是没有关于如何处理参数重复的明确规范。

例如，考虑这样一个 url：

```
http://www.example.com?param1=value1&param2=value2&param1=value3 
```

您期望 param1 的值是多少？第一个值，最后一个值，一个数组？问题是，根据规范，所有这些答案都是有效的，服务器供应商可以自由地支持其中一个或另一个。有些人使用 param1[] 表示法来表示它必须被视为一个数组，但同样，这不是一个统一的解决方案。

因此，“最佳”解决方案是了解您的目的地如何处理参数，并使用自制的实用程序类来模仿行为。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-05-12T02:58:11.210

使用[org.apache.http.client.utils.URLEncodedUtils.html#parse(org.apache.http.HttpEntity)](http://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/utils/URLEncodedUtils.html#parse%28org.apache.http.HttpEntity%29)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T10:44:45.577

据我所知，没有。

不过自己写一个应该不会太难。我想，最难的部分是解码 URL 名称/值（如果你仔细想想，这真的不难），你可以使用[`java.net.URLDecoder#decodeURL(String,String)`](http://java.sun.com/j2se/1.4.2/docs/api/java/net/URLDecoder.html#decode(java.lang.String,%20java.lang.String))它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-12-02T14:07:23.883

对于所有 Kotlin 爱好者，我想出了这个：

```
fun splitQuery(url: URL): Map<String, List<String?>> = url.query?.let {
        it.split("&").map {
            it.split("=").let {
                Pair(it[0], it.getOrNull(1))
            }
        }.groupBy({ it.first }, {
            it.second
        })
    } ?: emptyMap() 
```

# visual-studio - 如何重新安装 Visual Studio.net 的试用版？

> ID：248945
> 
> 赞同：2
> 
> 时间：2008-10-30T00:48:00.117
> 
> 标签：visual-studio

我正在努力获得 VS 2008 的完整许可证（或者我的老板是），但我的试用版已过期，我需要做一些工作。

如何重新安装？

或者，如果我安装在另一台机器（或虚拟机）上 - 我如何在不再次从 MS 完成整个下载过程的情况下获得另一个密钥？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T00:57:04.903

我认为您可能可以在免费的[Express Edition](http://www.microsoft.com/Express/)中完成大部分相同的工作，直到您获得完整许可证。

# excel - 用于软件测试的最佳交互式分析和绘图工具是什么？

> ID：248946
> 
> 赞同：2
> 
> 时间：2008-10-30T00:48:02.410
> 
> 标签：excel, plot, data-analysis

我的实时应用程序生成一个数据日志：100 个字的数据@10Khz。我需要对其进行分析并生成一些结果图。涉及中间计算 - 我需要采取一些差异，平均值等。Excel可以正常工作，除了：

*   图形数据系列的 32000 项限制太小 - 只有 3 秒的数据。
*   它处理包含大型数据系列的图形的变化的冰川速度令人难以忍受。

处理和绘制大量数据的 Excel 有哪些好的替代品？我正在寻找互动的东西，而不是图书馆。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T02:05:13.130

对于这类东西，我们通常会自己推出，但我知道这不是您想要的解决方案。您可以使用优质数据库（例如 Oracle）进行操作，然后将汇总数据放回 Excel 中进行绘图吗？我相信这些天 Excel 会链接到数据库，所以你可以让它变得非常自动化。

否则有 [SAS][1] 之类的统计工具，但请先拿出您的支票簿。

[1]： http: [//www.sas.com/technologies/analytics/statistics/stat/index.html](http://www.sas.com/technologies/analytics/statistics/stat/index.html) SAS

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T09:00:22.413

还有一些用于分析和绘图的免费工具（见下文）。但我不确定他们是否有组件来实时处理数据。

1.  R（类似于 SAS）用于统计计算
2.  octave（类似于 Matlab）用于数学计算

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-09T00:14:07.507

R（用于数据操作）及其用于创建性感图形的 ggplot2 模块。非常有用。

如果您需要实时图形，那么我会考虑使用 matplotlib 构建一些东西。它是一个 Python 模块，如果需要，您可以使用 rpy2 将其链接到 R。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T21:12:04.230

在粒子和核物理学中，大工具是[ROOT](http://root.cern.ch/)，我已经看到它在**“数据进入时每两秒更新一次”**模式中使用，其中*包含大量*数据和适量的中间处理。

请注意，编写该模块的学生是一位*非常*精明的程序员，即使如此，也需要一段时间才能消除错误。

ROOT 是免费提供的，并提供各种工具和支持。

# lcd - LCD 8 位模式到 4 位模式

> ID：248949
> 
> 赞同：2
> 
> 时间：2008-10-30T00:50:21.063
> 
> 标签：lcd, color-depth

我们有一个字符 LCD (www.cloverlcd.com/pdf/S6A0069.pdf)，我们必须在 8 位模式下工作。然而，现在我们正试图让它在 4 位模式下工作，但它似乎没有显示任何内容。我认为没有编写功能集指令。有人可以检查我是否以正确的方式接近这个？我将发布我的 8 位代码（正在工作）和我的 4 位代码（我正在尝试开始工作）

```
     //8位工作
    COMPortC(0x3C); //函数集                                          
    延迟1KTCYx(10);
    COMPortC（0x0F）；//开启显示并配置光标设置         
    延迟1KTCYx(10);
    COMPortC(0x01); //清除显示
    延迟1KTCYx(10);
    COMPortC(0x06); //增量模式和增量方向（入口模式设置）
    延迟1KTCYx(10);
    COMPortC(0x02); //回家

       //4位
    COMPortC(0x20); //函数集                                          
    延迟1KTCYx(10);
    COMPortC(0x20); //函数集                                          
    延迟1KTCYx(10);
    COMPortC(0x80); //函数集                                          
    延迟1KTCYx(10);

    COMPortC(0x00); //开启显示并配置光标设置         
    延迟1KTCYx(10);
    COMPortC(0xF0); //开启显示并配置光标设置         
    延迟1KTCYx(10);

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T08:08:28.980

我不确定你的 4 位是如何连接的，但我的猜测是......因为你在上半字节（0x*0 - 星星所在的位置）发送位，你可能想要使用较低的或最低有效半字节，即 0x0*。

```
COMPortCWithoutBusy(0x02);      //function set first nibble                                     
Delay1KTCYx(10);
COMPortCWithoutBusy(0x02);      //function set second nibble                                    
Delay1KTCYx(10);
BusyEnable();
Delay1KTCYx(10);
... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T01:12:45.217

在某种程度上它看起来不错，但我想知道几件事：

1/ 为什么要输出两次 0x20 来设置 4-bit 部分的 CGRAM 地址？当然，这只需要一次。

2/其他两个写入（0x00 和 0xf0），我从文档中不明白。你能修正评论以表明它们的意图吗？

3/ 一旦切换到 4 位模式，是否需要重做其他指令（递增和返回原点）？切换模式可能会重置所有数据。

4/ 我注意到的一件事是忙标志表明系统还不能接收另一条指令。可能是您传递它们的速度太快了。当您将延迟从 10 增加到 100 时会发生什么。

只是一些事情要尝试 - 让我们知道结果。

=====

回复：

谢谢回复

1 和 2) 我正在根据数据表 (www.cloverlcd.com/pdf/S6A0069.pdf) 的第 29 页编写这些值。

3）你是对的，我确实需要做其他指令，但现在，我只是想让光标在 4 位模式下闪烁（所以前两条指令就足够了）

4）我刚试了100次延迟，没用。

很抱歉评论不好，下次我会尝试发布更好的代码。

谢谢

=====

编辑：

我现在看到它是如何工作的。在 4 位模式下，它只使用 d7,d6,d5,d4 但每条指令都是 2 次写入（形成一条 8 位指令）。因此，它使用一种技巧来编写指令 20（8 位模式）或 22（4 位模式下的 2020），这两个指令都将模式设置为 4 位。很聪明，三星，让我印象深刻。

尝试遍历整个初始化序列。可能是在初始化完成之前显示器没有完全启动。

所以你需要输出（十六进制） 20,20,80,00,f0, **00,10,00,60,00,20**。粗体是您需要添加的。

另外，我需要再问两个问题（请作为对此答案的评论回复，而不是发布另一个答案）

1/ COMPortC() 在输出数据之前是否真的检查忙信号？

2/ 10 的延迟，它是什么单位，毫秒、微秒等？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T04:33:14.077

```
无效液晶显示器初始化（无效）
{

    COMPortCWithoutBusy(0x20); //函数设置第一个半字节                                     
    延迟1KTCYx(10);
    COMPortCWithoutBusy(0x20); //函数设置第二个半字节                                    
    延迟1KTCYx(10);
    BusyEnable();
    延迟1KTCYx(10);

    COMPortCWithoutBusy(0x80); //函数设置第三个半字节                                        
    延迟1KTCYx(10);
    BusyEnable();
    延迟1KTCYx(10);

    COMPortCWithoutBusy(0x00); //开启显示并配置光标设置第一个半字节
    延迟1KTCYx(10);
    COMPortCWithoutBusy(0xF0); //开启显示并配置光标设置第二个半字节
    延迟1KTCYx(10);
    BusyEnable();
    延迟1KTCYx(10);

    COMPortCWithoutBusy(0x00); //disp 清除第一个半字节                                       
    延迟1KTCYx(10);
    COMPortCWithoutBusy(0x10); //disp 清除第二个半字节                                  
    延迟1KTCYx(10);
    BusyEnable();
    延迟1KTCYx(10);

    COMPortCWithoutBusy(0x00); //进入模式设置第一个半字节                                       
    延迟1KTCYx(10);
    COMPortCWithoutBusy(0x60); //进入模式设置第二个半字节                                  
    延迟1KTCYx(10);
    BusyEnable();
    延迟1KTCYx(10);

    COMPortCWithoutBusy(0x20); //20 第一个半字节                                       
    延迟1KTCYx(10);
    BusyEnable();
    延迟1KTCYx(10);
}
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T01:43:07.743

这是 4 位模式的一段更好的注释代码

```
    COMPortC(0x20); //函数设置第一个半字节                                     
    延迟1KTCYx(10);
    COMPortC(0x20); //函数设置第二个半字节                                    
    延迟1KTCYx(10);
    COMPortC(0x80); //函数设置第三个半字节                                        
    延迟1KTCYx(10);

    COMPortC(0x00); //开启显示并配置光标设置第一个半字节
    延迟1KTCYx(10);
    COMPortC(0xF0); //开启显示并配置光标设置第二个半字节
    延迟1KTCYx(10);

```

我仍然不知道出了什么问题。此外，在数据表的第 18 页上，它显示了与 8 位模式的时序图几乎相同的时序图，只是有一个 AC3。AC3是什么意思？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T18:52:22.850

这只是 HD44780 LCD 驱动程序的另一种变体，因此它应该可以与以下初始化例程一起正常工作：

```
void initlcd(void)
{
    delayms(20);    // Wait for LCD to power up ( >15ms )
    RS=0;       // Set RS low for instruction 
    write4(3);  // Set interface to 8 bits 
    delayms(5); // Wait for LCD execute instruction ( >4.1ms )
    write4(3);  // Set interface to 8 bits 
    delayms(1); // Wait for LCD execute instruction ( >100us )
    write4(3);  // Set interface to 8 bits 
    delayms(5);     // Wait for LCD execute instruction (At this point 
            // we could actually start using the busy flag) 
    write4(2);  // Set the display to 4 bit interface 
    delayms(5); // Wait for LCD execute instruction 
    write8(0x28);   // Set the display to two line and ???
    delayms(5); // Wait for LCD execute instruction 
    write8(6);  // ???
    delayms(5); // Wait for LCD execute instruction 
    write8(1);  // Clear the LCD
    delayms(5); // Wait for LCD execute instruction
    write8(0xf);    // ???
    delayms(5); // Wait for LCD execute instruction
    return;
} 
```

您需要定义自己的 write4、write8 和 delayms 函数，但它们相对容易。确保将寄存器选择 (RS) 设置为命令模式。write4 发送一个 4 位命令，而 write 8 连续发送两个 4 位命令，先是高半字节，然后是低半字节：

```
void write8(uns8 byte)
{
    uns8 nibble;
    nibble = (byte & 0xf0) >> 4;    // Rotate the high 4 bits (7-4) of byte into bits (3-0) of nibble
    write4(nibble);         // Write the high 4 bits to the LCD
    nibble = byte & 0xf;        // Copy the low four bits of byte into the low four bits of nibble
    write4(nibble);         // Write the low 4 bits to the LCD
} 
```

我编写的[代码](http://ubasics.com/adam/electronics/lcd/cc5xlcd.c)适用于 PIC 微控制器，使用免费版本的 cc5x 编译器。应该可以理解并移植到其他语言。

通过多年的 LCD 初始化，初始化例程大量借鉴了许多其他例程 - 发现并克服了 HD44780 和变体的各种怪癖。它应该适用于大多数类似的 LCD。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-30T01:18:33.830

1 和 2) 我正在根据数据表 (www.cloverlcd.com/pdf/S6A0069.pdf) 的第 29 页编写这些值。

3）你是对的，我确实需要做其他指令，但现在，我只是想让光标在 4 位模式下闪烁（所以前两条指令就足够了）

4）我刚试了100次延迟，没用。

# search - 二进制搜索或 Btree 索引更新问题

> ID：248952
> 
> 赞同：4
> 
> 时间：2008-10-30T00:52:08.050
> 
> 标签：search, tree, binary-search-tree, binary-search, b-tree

想象一下，您每天都会收到一位作者的新书。这本书正在进行中。他没有告诉你他改变或增加了什么。

您的工作是识别更改和添加内容，并仅将它们传递给出版商（他们没有时间每天阅读整本书）

出于这个问题的目的，这本书由 1m 行的 ascii 文本组成，并且还在不断增长（实际上是一个 MySQL 备份文件）。

我目前的想法是对每行（1k 个字符）进行安全哈希（例如 SHA256）并将其存储在 HD 上。由于散列只有 32 字节，因此文件只有 32MB。

然后当我们明天得到下一个文件时，我们逐行检查它，为每一行创建一个新的散列，并将其与前一天的散列进行比较。

当该过程完成后，我们会覆盖为第二天准备的哈希文件。

比较使用字符串比较（ > < 操作数）的二进制搜索方法，这将返回平均四次迭代的结果。

我还没有编写 btree 索引解决方案，但你将如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T00:58:06.417

我会使用[diff](http://www.freebsd.org/cgi/man.cgi?query=diff&apropos=0&sektion=0&manpath=Unix+Seventh+Edition&format=html)。

如果我需要在自己的程序中实现它，我会使用其中一种算法来查找两个序列的[最长公共子](http://en.wikipedia.org/wiki/Longest_common_subsequence_problem)序列，将每个文件视为一个行序列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T01:20:42.580

“然后当我们明天得到下一个文件时，我们逐行检查它，为每一行创建一个新的哈希值，并将其与前一天的哈希值进行比较。”

明白了：今天的 100 万行哈希值与昨天的 100 万行哈希值相比。

是否插入或删除行？如果不是，这是一组简单的并行读取，以查看哈希是否不同。

如果有添加或删除，则必须使用 diff 算法来确定更改的范围。

这一切都很好。实施起来难度不大。

在这种情况下，以下内容毫无意义。

> 比较使用字符串比较（ > < 操作数）的二进制搜索方法，这将返回平均四次迭代的结果。

哈希值是否有某种排序？还是一些树结构？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T01:23:06.817

100 万行的书是巨大的：每页可能有 30 到 50 行，所以让我们大方地假设每页 100 行，这意味着书中有 10,000 页。

1 KB 的行也比正常的大得多；基本的可读性表明每行的字符数远不及那么多。您打算散列最多 1 KB 的行，还是将文件分块为 1 KB 块？您的方案的一个问题是任何重复的行都会有重复的散列；您永远无法确定何时添加或删除了这些行之一。

您可能还需要通知发布者删除的行。

与 Glomek 一样，我会`diff`在文件上使用。如果您将文件保留在 RCS 或 CVS 控制下，您将只保存文件的当前版本以及存储先前版本之间的差异。有了这个，您也可以提供一周或一个月的累积差异。

而且我可能不会开发自己的 B-Tree 索引。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T01:34:10.523

您描述的解决方案有点类似于 rsync 算法。重要的一点是 rsync 必须识别目标文件中任何位置的现有块，与原始文件的任何偏移量。

如果您的文件确实是记录结构，您可以按照您的建议进行一些简化。如果没有，您需要滚动校验和。

另外，您是否必须识别重新排序？还是只有插入/删除/替换？

最通用的情况是完整的 rsync 算法，如下所示：

*   参数定义：

    1.  选择块大小 512 或 1k 通常可以。
        *   选择一个“强”校验和。类似于 MD4 左右的东西。64位就足够了。
        *   选择一个“弱”滚动校验和。一个可以让您“减去”尾字节并“添加”头字节以向前获取块 1 字节的校验和的方法。通常 16 位校验和可以正常工作。
*   旧文件的签名：

    1.  遍历整个旧文件，在每个块计算弱校验和强校验和。具有 16 位和 64 位校验和，以及 512 字节块，这意味着每块 10 字节，或每兆字节 20KB。这是“签名”
*   使用新文件和旧文件签名创建“补丁”：

    1.  加载旧文件的签名，最好是哈希表，以弱校验和为键，强校验和块位置为值。
        *   读取新文件的第一个块
        *   计算加载块的弱校验和
        *   检查哈希表以查看是否存在弱校验和。
        *   如果找到，则计算强校验和并与哈希中找到的进行比较
        *   如果两个校验和匹配，用哈希中的块引用标记为“得到它”，推进一个完整的块大小并返回步骤 3
        *   如果强校验和不匹配，或者弱校验和不在散列中，则“滚动”弱校验和，即“添加”块后的下一个字节，并“减去”第一个字节尾巴。
        *   将尾部“减去”字节添加到补丁中的“新”字节列表中
        *   返回第 4 步
*   将补丁应用于旧文件

    1.  “补丁”是滚动校验和时丢弃的“新”字节列表，加上与旧文件匹配的“得到它”块的列表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T08:44:40.047

这是一种用于数据仓库[增量加载的技术。](http://www.dmreview.com/issues/19980501/609-1.html)在您无法识别源系统中更改的数据的情况下，您可以取出数据的快照并将其与上一个快照进行比较以识别差异。[这种技术甚至在Ralph Kimball 关于该主题的书中](https://rads.stackoverflow.com/amzn/click/com/0471200247)得到了提及，并被用于[我参与设计的应用程序中。](http://www.roomsolutions.net/insurance-software/data-warehouse/acumen-advantage.aspx)

您需要一个具有非常宽密钥的散列算法，因为这种方法容易受到[生日攻击](http://en.wikipedia.org/wiki/Birthday_attack)。MD5 或任何 SHA 系列都可以。如果没有通过差异寻找丢失的自然键的后处理，它也无法检测到删除。这种计算实际上需要知道表结构。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T07:47:22.517

> 您的方案的一个问题是任何重复的行都会有重复的散列；您永远无法确定何时添加或删除了这些行之一

很好的一点，但不是问题。重复的行是重复的，所有重复的都在下一个处理阶段被删除。所以是的，你是对的，但这不是问题。

“差异”链接将我带到一个页面，其中描述了我认为是应用程序的内容？没有下载链接，没有任何语言的代码......我在这里错过了什么？

你们中的一些人谈到了字节级粒度。这不是必需的。只需要行级别的粒度，因为如果行中的任何内容发生了更改，则必须重新处理整行（记录），因为行内的任何更改都会影响整行。

因此，我们在两个文件（今天的快照和昨天的快照）中比较大约 1000 个字符（无二进制）的行，每个文件大约 1m 行。

因此，使用 SHA256 之类的安全哈希（MD5 有冲突，相比之下速度较慢）我可以在我的 HO 笔记本电脑上处理大约 30MB/秒。服务器当然会更快地咀嚼它。

因此，如果文件是 1GB 左右，那么制作所有的 hases 大约需要 33 秒，而使用 Windows 页面内存读取 1Gb 文件大约需要 30 秒。不可怕

现在我们有两个哈希数组，代表每个文件中的行。如果我们对它们进行排序，我们现在可以使用二进制搜索，因此我们遍历新文件哈希以寻找旧文件哈希中的匹配项。如果我们没有找到它，该行将添加到更改文件中。

请记住，行书（遗留数据库）在各个方面都是未知的。无法保证行的顺序、更改的位置、更改的类型。

逐页阅读前文的建议很好，但假设这两个文件在第一次更改之前是按 smae 顺序排列的。这是不能假设的。行（行）可以是任何顺序。选择任意块大小也违反了行的粒度。出于此任务的目的，行是不可变的。

来自关于 invrementa 加载的优秀链接：文件比较捕获：此方法也称为快照差异方法。此方法通过保留与数据仓库相关的文件的前后图像来工作。比较记录以查找更改，比较记录键以查找插入和删除。由于触发器通常不存在并且事务日志不存在或采用专有格式，因此该技术最适合遗留系统的情况。由于大多数遗留数据库都有一些将数据转储到文件中的机制，因此该技术会创建定期快照，然后比较结果以生成更改记录。当然，静态捕获的所有问题都存在于此。比较整行信息以及密钥识别和匹配的挑战引入了额外的复杂性。这种技术本质上很复杂，通常是不可取的，但在某些情况下，它可能是唯一的解决方案。

这一点在这里最为相关：随着我们进入 TB 级数据仓库领域，每晚从头开始重建数据仓库的能力将步履蹒跚。更新数据仓库的逻辑和有效方法涉及某种形式的增量更新策略。

所以我想我是在正确的轨道上？btree 索引没有优势吗？

# iphone - 如何将 Picasa API 集成到我的 iPhone 应用程序中？

> ID：248956
> 
> 赞同：4
> 
> 时间：2008-10-30T00:56:34.313
> 
> 标签：iphone, picasa

我尝试在 iphone 上集成 Picasa API，编译正常，但我在启动时看到以下错误。

dyld：库未加载：@loader_path/../Frameworks/GData.framework/Versions/A/GData 引用自：/Users/jacksu/Library/Application Support/iPhone Simulator/User/Applications/9A7E3F54-022F-4771-BD6A -E458F5545144/PicasaTest.app/PicasaTest 原因：找不到图片

我不确定可能是什么问题。

我从 Source/build/Debug/GData.framework 导入了 GDataFramework。我已经在 Source 目录下构建了项目。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T02:21:29.103

iPhone 不允许加载动态库。您使用的外部库/框架必须构建为静态库并在构建时编译到您的应用程序中。

为了首先实现这一点，您需要创建 GDATA 的静态库版本：

*   将新目标添加到 GData 项目（例如 GDataIPhoneLibrary）

    *   您可以通过右键单击目标并选择“添加新目标”来执行此操作。在对话框中，从 IPhoneOS - Cocoa Touch 部分中选择静态库模板。
*   然后您需要将源 .m 文件拖到目标的 Compile Sources 部分。（确保不要拖动 .h 文件，否则您会收到警告。）此外，如果您只是为 Picasa 构建，那么命令和照片组下的文件就足够了。也不要添加单元测试和测试工具组。

*   接下来进入项目下的 Frameworks and Libraries 组，添加 Foundation 框架，这是 Cocoa Touch 的必要框架。当您添加它时，请确保仅检查您新创建的目标以供使用。（你不想弄乱 Mac 版的 GData）

*   现在在 Targets 下，选择您创建的 GDataIPhoneLibrary 并单击 (i) 按钮（或直接双击它）

*   在 Build 选项卡下搜索“header”，找到“Header Search Paths”后，添加以下内容（对于 libxml2）作为标题路径

/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS2.1.sdk/usr/include/libxml2

*   现在关闭对话框。

*   选择您的活动目标作为 GDataIPhoneLibrary

*   将您的 ActiveSDK 设置为 Project-> SetActiveSDK -> Simulator - iPhone OS 2.1

*   现在你准备好了 -> 只需点击构建，你将拥有默认的 libGDataIPhoneLibrary.a 文件。

现在您可以将此静态库添加到您的 iPhone 应用程序中：

*   转到您自己的应用程序项目并选择目标（您可能有一个）并双击它以打开对话框。

*   在“构建”选项卡中搜索“库”，找到“库搜索路径”后，将路径添加到您刚刚在上一步中构建的库。

*   然后将“-lGDataIPhoneLibrary”（省略 lib 前缀和 .a 扩展名）添加到“Other Linker Flags”选项（您可以通过在搜索框中搜索链接器来找到该选项。

现在这应该有望建立。希望这对你有用。

干杯，凯雷姆

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T06:45:13.843

如果您保留 GData.framework，那么您需要确保它不是必需的框架，而是一个弱框架。弱框架意味着，应用程序在首次启动时不需要它，并且仅在引用对框架的函数调用时才尝试加载它，但在您的情况下，由于库是静态编译的，因此调用的函数将在不需要的情况下被解析加载框架。（注意目标 C 消息是运行时的函数调用......）

为此，请尝试以下操作：

*   双击您的应用程序目标（如前所述）

*   这次看看General标签

*   找到 GData.framework 并将其从“必需”更改为“弱”

您可能会在不添加框架的情况下遇到编译错误，因为没有解析 GDATA 头文件。您还可以在“头文件搜索路径”中放置指向“头文件”的链接，而不需要添加框架。

与上述无关，我之前忘记了一件事情。将 -ObjC 添加到您的“其他链接器标志”中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T01:37:27.693

您不能在 iPhone 上使用动态库（当然，在 Apple 的框架之外）。所有库都必须静态链接。

# c# - C# using 语句捕获错误

> ID：248961
> 
> 赞同：28
> 
> 时间：2008-10-30T00:58:20.470
> 
> 标签：c#, using, using-statement

我只是在看 using 语句，我一直都知道它的作用，但直到现在还没有尝试使用它，我想出了以下代码：

```
 using (SqlCommand cmd = 
     new SqlCommand(reportDataSource, 
         new SqlConnection(Settings.Default.qlsdat_extensionsConnectionString)))
 {
     cmd.CommandType = CommandType.StoredProcedure;
     cmd.Parameters.Add("@Year", SqlDbType.Char, 4).Value = year;
     cmd.Parameters.Add("@startDate", SqlDbType.DateTime).Value = start;
     cmd.Parameters.Add("@endDate", SqlDbType.DateTime).Value = end;
     cmd.Connection.Open();

     DataSet dset = new DataSet();
     new SqlDataAdapter(cmd).Fill(dset);
     this.gridDataSource.DataSource = dset.Tables[0];
 } 
```

这似乎可行，但是这有什么意义，因为据我所知，我仍然需要将其包含在 try catch 块中以捕获不可预见的错误，例如 sql server 关闭。我错过了什么吗？

据我目前所见，它只是阻止我关闭和处理 cmd，但由于仍然需要 try catch，所以会有更多的代码行。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-10-30T01:23:48.517

在进行 IO 工作时，我编写代码以*期望*出现异常。

```
SqlConnection conn = null;
SqlCommand cmd = null;

try
{
    conn = new SqlConnection(Settings.Default.qlsdat_extensionsConnectionString)
    cmd = new SqlCommand(reportDataSource, conn);
    cmd.CommandType = CommandType.StoredProcedure;
    cmd.Parameters.Add("@Year", SqlDbType.Char, 4).Value = year;
    cmd.Parameters.Add("@startDate", SqlDbType.DateTime).Value = start;
    cmd.Parameters.Add("@endDate", SqlDbType.DateTime).Value = end;

        conn.Open(); //opens connection

    DataSet dset = new DataSet();
    new SqlDataAdapter(cmd).Fill(dset);
    this.gridDataSource.DataSource = dset.Tables[0];
}
catch(Exception ex)
{
    Logger.Log(ex);
    throw;
}
finally
{
    if(conn != null)
        conn.Dispose();

        if(cmd != null)
        cmd.Dispose();
} 
```

**编辑：**明确地说，我在这里避免*使用 using*块，因为我认为登录这样的情况很重要。经验告诉我，你永远不知道会出现什么样的奇怪异常。在这种情况下登录可能会帮助您检测死锁，或找出架构更改影响了您的代码库中很少使用和很少测试的部分，或任何数量的其他问题。

**编辑 2：**有人可能会争辩说，在这种情况下 using 块可以包装 try/catch，这是完全有效且功能等效的。这真的归结为偏好。您是否想以处理自己的处置为代价来避免额外的嵌套？或者您是否会产生额外的嵌套以进行自动处理。我觉得前者更干净，所以我这样做。但是，如果我在我正在工作的代码库中找到后者，我不会重写后者。

**编辑 3：**我真的非常希望 MS 已经创建了一个更明确的 using() 版本，它可以更直观地了解实际发生的情况，并在这种情况下提供更大的灵活性。考虑以下虚构代码：

```
SqlConnection conn = null;
SqlCommand cmd = null;

using(conn = new SqlConnection(Settings.Default.qlsdat_extensionsConnectionString),
          cmd = new SqlCommand(reportDataSource, conn)
{
    conn = new SqlConnection(Settings.Default.qlsdat_extensionsConnectionString);
    cmd = new SqlCommand(reportDataSource, conn);
    cmd.CommandType = CommandType.StoredProcedure;
    cmd.Parameters.Add("@Year", SqlDbType.Char, 4).Value = year;
    cmd.Parameters.Add("@startDate", SqlDbType.DateTime).Value = start;
    cmd.Parameters.Add("@endDate", SqlDbType.DateTime).Value = end;
        cmd.Open();

    DataSet dset = new DataSet();
    new SqlDataAdapter(cmd).Fill(dset);
    this.gridDataSource.DataSource = dset.Tables[0];
}
catch(Exception ex)
{
    Logger.Log(ex);
    throw;
} 
```

using 语句只是在 finally 中使用 Dispose() 调用创建 try/finally。为什么不给开发者一个统一的处理方式和异常处理方式呢？

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-30T01:18:13.987

此代码应如下所示，以确保及时关闭连接。仅关闭命令不会关闭连接：

```
using (SqlConnection con = new SqlConnection(Settings.Default.qlsdat_extensionsConnectionString))
using (SqlCommand cmd = new SqlCommand(reportDataSource, con))
         {
             cmd.CommandType = CommandType.StoredProcedure;
             cmd.Parameters.Add("@Year", SqlDbType.Char, 4).Value = year;
             cmd.Parameters.Add("@startDate", SqlDbType.DateTime).Value = start;
             cmd.Parameters.Add("@endDate", SqlDbType.DateTime).Value = end;
             cmd.Connection.Open();

             DataSet dset = new DataSet();
             new SqlDataAdapter(cmd).Fill(dset);
             this.gridDataSource.DataSource = dset.Tables[0];
         } 
```

要回答您的问题，您可以在 finally 块中执行相同操作，但这很好地限定了代码范围并确保您记得清理。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-30T04:05:52.340

`using`在这种情况下，如果您无论如何都要有一个 // 块，那么在这种情况下使用语句`try`可能没有`catch`任何好处。`finally`如您所知，该语句是处理对象的/`using`的语法糖。如果你要拥有自己的/无论如何，你当然可以自己做。`try``finally``IDisposable``try``finally``Dispose`

这实际上主要归结为样式 - 您的团队可能对语句更满意，`using`或者`using`语句可能会使代码看起来更干净。

但是，如果`using`声明将隐藏的样板文件仍然存在，那么如果这是您的偏好，请继续自己处理事情。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-30T03:11:39.720

如果您的代码如下所示：

```
using (SqlCommand cmd = new SqlCommand(...))
{
  try
  {
    /* call stored procedure */
  }
  catch (SqlException ex)
  {
    /* handles the exception. does not rethrow the exception */
  }
} 
```

然后我会重构它以使用 try.. catch.. finally 代替。

```
SqlCommand cmd = new SqlCommand(...)
try
{
  /* call stored procedure */
}
catch (SqlException ex)
{
  /* handles the exception and does not ignore it */
}
finally
{
   if (cmd!=null) cmd.Dispose();
} 
```

在这种情况下，我将处理异常，所以我别无选择，只能添加该 try..catch，我不妨放入 finally 子句并为自己保存另一个嵌套级别。请注意，我必须在 catch 块中做一些事情，而不仅仅是忽略异常。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-30T02:31:11.080

C# 规范（ECMA-334 第 4 版）第 15.13 节详细阐述了 Chris Ballance 所说的“一条 using 语句被翻译成三个部分：获取、使用和处置。资源的使用隐式包含在 try 语句中，其中包括finally 子句。这个 finally 子句处理资源。如果获取了 null 资源，则不会调用 Dispose，也不会引发异常。

描述接近 2 页 - 值得一读。

根据我的经验，SqlConnection/SqlCommand 可以以多种方式生成错误，以至于您几乎需要处理抛出的异常而不是处理预期的行为。我不确定我是否想要在这里使用 using 子句，因为我希望能够自己处理 null 资源案例。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-30T01:01:57.313

using 不是关于捕获异常。这是关于正确处理垃圾收集器视图之外的资源。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-06-21T21:56:41.233

“使用”的一个问题是它不处理异常。如果“using”的设计者可以选择在其语法中添加“catch”，如下面的伪代码，它会更有用：

```
using (...MyDisposableObj...)
{

   ... use MyDisposableObj ...

catch (exception)

   ... handle exception ...

}

it could even have an optional "finally" clause to cleanup anything other than the "MyDisposableObj" allocated at the beginning of the "using" statement... like:

using (...MyDisposableObj...)
{

   ... use MyDisposableObj ...
   ... open a file or db connection ...

catch (exception)

   ... handle exception ...

finally

   ... close the file or db connection ...

} 
```

仍然没有必要编写代码来处理`MyDisposableObj`b/c 它将由`using`...处理

怎么会这样？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-30T01:03:11.350

是的，您仍然需要捕获异常。using 块的好处是您正在为代码添加范围。你是说，“在这段代码中做一些事情，当它结束时，关闭并处理资源”

这根本不是完全必要的，但它确实定义了您对使用您的代码的任何其他人的意图，并且它还有助于避免错误地打开连接等。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-30T02:39:40.330

这里有很多很好的答案，但我认为这还没有说出来。

无论如何......“处理”方法将在“使用”块中的对象上调用。如果你放一个 return 语句，或者抛出一个错误，“Dispose”将被调用。

例子：

我创建了一个名为“MyDisposable”的类，它实现了 IDisposable 并简单地执行了 Console.Write。即使在所有这些情况下，它也*总是*写入控制台：

```
using (MyDisposable blah = new MyDisposable())
{
    int.Parse("!"); // <- calls "Dispose" after the error.

    return; // <-- calls Dispose before returning.
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-30T01:25:22.693

using 语句实际上被编译器更改为 try/finally 块，其中只要实现 IDisposable 接口， using 块的参数就会被释放。除了确保指定的对象在超出范围时被正确处理之外，使用此构造实际上不会获得错误捕获。

正如上面*TheSoftwareJedi*所提到的，您需要确保 SqlConnection 和 SqlCommand 对象都被正确处理。将两者堆叠到一个 using 块中有点混乱，并且可能不会像您认为的那样做。

另外，请注意使用 try/catch 块作为逻辑。这是我的鼻子特别讨厌的代码气味，并且经常被新手或我们这些急于赶上最后期限的人使用。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-30T02:12:03.613

仅供参考，在这个特定示例中，因为您使用的是 ADO.net 连接和 Command 对象，请注意 using 语句只执行 Command.Dispose 和 Connection.Dispose() ，它们实际上并没有关闭连接，但是只需将其释放回 ADO.net 连接池以供下一个 connection.open 重用......这很好，而且绝对正确的做法，如果你不这样做，连接将一直不可用，直到垃圾收集器将其释放回池中，这可能要等到许多其他连接请求之后，否则即使有一个未使用的连接等待被垃圾收集，它们也会被迫创建新连接。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-06-28T21:07:12.153

我会根据我正在处理的资源来决定何时以及何时不使用 using 语句。在资源有限的情况下，例如 ODBC 连接，我更喜欢使用 T/C/F，这样我就可以在它们发生时记录有意义的错误。让数据库驱动程序错误冒泡回到客户端并可能在更高级别的异常包装中丢失是次优的。

T/C/F 让您放心，资源正在按照您希望的方式处理。正如一些人已经提到的， using 语句不提供异常处理，它只是确保资源被破坏。异常处理是一种未被充分利用和被低估的语言结构，通常是解决方案成功与失败之间的区别。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-30T03:45:55.703

如果你的函数的调用者负责处理任何异常，那么 using 语句是一种确保资源被清理的好方法，无论结果如何。

它允许您在层/程序集边界放置异常处理代码，并有助于防止其他功能变得过于混乱。

当然，这实际上取决于您的代码抛出的异常类型。有时你应该使用 try-catch-finally 而不是 using 语句。我的习惯是始终从 IDisposables 的 using 语句开始（或者让包含 IDisposables 的类也实现该接口）并根据需要添加 try-catch-finally。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-03-25T16:57:29.520

因此，基本上，“使用”与“尝试/捕获/最终”完全相同，只是在错误处理方面更加灵活。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-08-12T19:21:42.773

对示例的小修正：`SqlDataAdapter`也需要在`using`语句中实例化：

```
using (SqlConnection con = new SqlConnection(Settings.Default.qlsdat_extensionsConnectionString))
using (SqlCommand cmd = new SqlCommand(reportDataSource, con))
{
    cmd.CommandType = CommandType.StoredProcedure;
    cmd.Parameters.Add("@Year", SqlDbType.Char, 4).Value = year;
    cmd.Parameters.Add("@startDate", SqlDbType.DateTime).Value = start;
    cmd.Parameters.Add("@endDate", SqlDbType.DateTime).Value = end;
    con.Open();

    DataSet dset = new DataSet();
    using (SqlDataAdapter adapter = new SqlDataAdapter(cmd))
    {
        adapter.Fill(dset);
    }
    this.gridDataSource.DataSource = dset.Tables[0];
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-06-27T13:08:41.410

首先，您的代码示例应该是：

```
using (SqlConnection conn = new SqlConnection(Settings.Default.qlsdat_extensionsConnectionString))
using (SqlCommand cmd = new SqlCommand(reportDataSource, conn))
{
    cmd.CommandType = CommandType.StoredProcedure;
    cmd.Parameters.Add("@Year", SqlDbType.Char, 4).Value = year;
    cmd.Parameters.Add("@startDate", SqlDbType.DateTime).Value = start;
    cmd.Parameters.Add("@endDate", SqlDbType.DateTime).Value = end;
    cmd.Connection.Open();

    DataSet dset = new DataSet();
    new SqlDataAdapter(cmd).Fill(dset);
    this.gridDataSource.DataSource = dset.Tables[0];
} 
```

使用您问题中的代码，创建命令的异常将导致刚刚创建的连接未被释放。通过以上，正确地布置了连接。

如果您需要在*构建*连接和命令（以及使用它们时）处理异常，是的，您必须将整个事物包装在 try/catch 中：

```
try
{
    using (SqlConnection conn = new SqlConnection(Settings.Default.qlsdat_extensionsConnectionString))
    using (SqlCommand cmd = new SqlCommand(reportDataSource, conn))
    {
        cmd.CommandType = CommandType.StoredProcedure;
        cmd.Parameters.Add("@Year", SqlDbType.Char, 4).Value = year;
        cmd.Parameters.Add("@startDate", SqlDbType.DateTime).Value = start;
        cmd.Parameters.Add("@endDate", SqlDbType.DateTime).Value = end;
        cmd.Connection.Open();

        DataSet dset = new DataSet();
        new SqlDataAdapter(cmd).Fill(dset);
        this.gridDataSource.DataSource = dset.Tables[0];
    }
}
catch (RelevantException ex)
{
    // ...handling...
} 
```

但是您不需要处理清理`conn`或`cmd`; 它已经为你完成了。

与没有 的相同事物对比`using`：

```
SqlConnection conn = null;
SqlCommand cmd = null;
try
{
    conn = new SqlConnection(Settings.Default.qlsdat_extensionsConnectionString);
    cmd = new SqlCommand(reportDataSource, conn);
    cmd.CommandType = CommandType.StoredProcedure;
    cmd.Parameters.Add("@Year", SqlDbType.Char, 4).Value = year;
    cmd.Parameters.Add("@startDate", SqlDbType.DateTime).Value = start;
    cmd.Parameters.Add("@endDate", SqlDbType.DateTime).Value = end;
    cmd.Connection.Open();

    DataSet dset = new DataSet();
    new SqlDataAdapter(cmd).Fill(dset);
    this.gridDataSource.DataSource = dset.Tables[0];
}
catch (RelevantException ex)
{
    // ...handling...
}
finally
{
    if (cmd != null)
    {
        try
        {
            cmd.Dispose();
        }
        catch { }
        cmd = null;
    }
    if (conn != null)
    {
        try
        {
            conn.Dispose();
        }
        catch { }
        conn = null;
    }
}
// And note that `cmd` and `conn` are still in scope here, even though they're useless 
```

我知道我更愿意写哪个。:-)

# asp.net - 如何在 App_Code 之外编译 C# 文件？

> ID：248973
> 
> 赞同：3
> 
> 时间：2008-10-30T01:11:22.287
> 
> 标签：asp.net, web-config

我想在我的文件夹层次结构中保留一个类。这个场景太微不足道了，不能保证它有自己的项目或单独的网站。但是，我讨厌将我的顶级 App_Code 与站点的一个小角落使用的东西混在一起。

web.config 中有没有办法在编译过程中包含另一个文件或文件夹？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T01:52:52.233

听起来您正在使用“网站”项目类型。您可能会考虑切换到更像传统项目的“Web 应用程序”项目类型，让您拥有更灵活的文件夹结构（代码可以放在您喜欢的任何地方，并且 App_Code 不是特殊文件夹）。

这篇文章对网站与 Web 应用程序项目的优缺点进行了简要讨论和链接：

[http://forums.asp.net/p/1233004/2232697.aspx#2232697](http://forums.asp.net/p/1233004/2232697.aspx#2232697)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T01:27:29.943

```
<configuration>
   <system.web>
      <compilation>
         <assemblies>
            <add assembly="<AssemblyName>, Version=<Version>, Culture=<Culture>, PublicKeyToken=<PublicKeyToken>"/>
         </assemblies>
      </compilation>
   </system.web>
</configuration> 
```

# iphone - 以编程方式设置 iPhone 壁纸（锁定屏幕背景）？

> ID：248982
> 
> 赞同：5
> 
> 时间：2008-10-30T01:16:34.880
> 
> 标签：iphone, ios, native, wallpaper

我有一个应用程序，它可以受益于用户能够选择将图像设置为墙纸（“滑动解锁”屏幕上的背景图像）。

非越狱第三方应用程序有没有办法做到这一点？在 iPhone 文档中搜索“壁纸”不会返回任何结果。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T02:16:16.227

目前的 SDK 没有办法做到这一点，如果你想这样做，你应该提交一个[bug](http://bugreporter.apple.com)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-31T00:09:00.867

如果您正在编写越狱应用程序，您可以写入`/var/mobile/Library/LockBackground.jpg`然后终止 Springboard。

# c# - 从列表框中删除数据绑定项会导致刷新问题

> ID：248983
> 
> 赞同：1
> 
> 时间：2008-10-30T01:16:45.160
> 
> 标签：c#, .net

我将一个列表框数据绑定到一个简单的自定义对象集合。接下来，我添加了一个按钮以从对象集合中删除选定的项目。问题是当某些项目被删除并且列表框显示垂直滚动条时，滚动条似乎重置到一个新位置，尽管我真正认为正在发生的是控件正在重新绘制。

以下代码示例演示了该问题。将此代码添加到表单中，确保出现垂直滚动条。选择集合中间的一个项目，使滚动条居中，然后按删除按钮。当控件重绘时，项目和滚动条位于不同的位置。我希望列表框的行为与非数据绑定项目一样。我最好不使用数据绑定，还是有一个解决方案可以让我保持控件绑定？

谢谢。

```
public partial class Form1 : Form
{
    private BindingList<ItemData> m_bList = new BindingList<ItemData>();

    public Form1()
    {
        InitializeComponent();
    }

    private void Form1_Load(object sender, EventArgs e)
    {
        for (int i = 0; i < 50; i++)
        {
            m_bList.Add(new ItemData("Name " + i.ToString(), i)); 
        }
        this.listBox1.DisplayMember = "Name";
        this.listBox1.DataSource = m_bList;
    }

    private void btnRemove_Click(object sender, EventArgs e)
    {
        m_bList.Remove(listBox1.SelectedItem as ItemData);
    }
}

public class ItemData
{
    public string Name { get; set; }
    public int Position { get; set; }

    public ItemData(string name, int position)
    {
        Name = name;
        Position = position;
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T10:38:57.397

删除项目时，您需要保留列表框的 TopIndex 属性。保留 SelectedIndex 不会阻止滚动条跳跃。下面的代码做了我认为你想要的。

```
 private void btnRemove_Click(object sender,EventArgs e)
    {
        int topIndex = listBox1.TopIndex;

        m_bList.Remove(listBox1.SelectedItem as ItemData);

        if(listBox1.Items.Count>topIndex)
            listBox1.TopIndex = topIndex;
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T02:04:11.757

我可以想出一种方法来抑制错误（注意这可能不是最准确的解决方案）。我只是在按钮单击事件中添加了一些东西。我不确定他们是否完全解决了您的要求，因为您将是最好的判断者，但仍然可以。

```
 private void btnRemove_Click(object sender, EventArgs e)
    {
        int s = listBox1.SelectedIndex;
        m_bList.Remove(listBox1.SelectedItem as ItemData);
        listBox1.Refresh();
        listBox1.SelectedIndex = s;
     } 
```

# iphone - -[NSOperationQueue 操作] 不应该返回一个空数组？

> ID：248985
> 
> 赞同：12
> 
> 时间：2008-10-30T01:18:29.713
> 
> 标签：iphone, cocoa, multithreading

我正在编写一个将图像异步加载到屏幕上的应用程序。我将它设置为非并发的（也就是说，它产生一个线程并一次执行一个线程），所以我只覆盖了`[NSOperation main]`我的 NSOperation 子类中的函数。

无论如何，所以当我添加所有这些操作时，我希望以后能够访问排队的操作以更改它们的优先级。不幸的是，每当我打电话时`-[NSOperationQueue operations]`，我得到的只是一个空数组。最好的部分是，在放入一些控制台打印语句后，尽管数组为空，但线程仍在队列中并正在执行（由打印指示）！

是什么赋予了？我还查看了 theadcount 以确保它们都没有立即执行，而且情况似乎并非如此。

有任何想法吗？把我的头发拉出来。

编辑：还值得一提的是，相同的代码在模拟器中运行时提供了一个完整的数组:(

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-03T22:23:21.547

我走过`-operations`，发现它基本上是在做：

```
[self->data->lock lock];
NSString* copy = [[self->data->operations copy] autorelease];
[self->data->lock unlock];
return copy; 
```

除了在调用 之后`-autorelease`，后续指令会覆盖包含指向操作队列新副本的唯一指针的寄存器。然后调用者只得到一个`nil`返回值。" `data`" 字段是一个名为的内部类的实例，`_NSOperationQueueData`它具有以下字段：

```
NSRecursiveLock* lock;
NSArray* operations; 
```

我的解决方案是 subclass 和 override `-operations`，遵循相同的逻辑，但实际上返回数组副本。`NSOperationQueue`如果内部与此修复程序不兼容，我添加了一些健全性检查以解决问题。`[super operations]`仅当调用确实返回时才调用此重新实现`nil`。

如果 Apple 要更改内部结构，但在某种程度上避免实际修复此错误，这可能会在未来的操作系统版本中中断。

```
#if TARGET_OS_IPHONE

#import <objc/runtime.h>

@interface _DLOperationQueueData : NSObject {
@public
    id lock; // <NSLocking>
    NSArray* operations;
}
@end
@implementation _DLOperationQueueData; @end

@interface _DLOperationQueueFix : NSObject {
@public
    _DLOperationQueueData* data;
}
@end
@implementation _DLOperationQueueFix; @end

#endif

@implementation DLOperationQueue

#if TARGET_OS_IPHONE

-(NSArray*) operations
{
    NSArray* operations = [super operations];
    if (operations != nil) {
        return operations;
    }

    _DLOperationQueueFix* fix = (_DLOperationQueueFix*) self;
    _DLOperationQueueData* data = fix->data;

    if (strcmp(class_getName([data class]), "_NSOperationQueueData") != 0) {
        // this hack knows only the structure of _NSOperationQueueData
        // anything else, bail
        return operations;
    }
    if ([data->lock conformsToProtocol: @protocol(NSLocking)] == NO) {
        return operations; // not a lock, bail
    }

    [data->lock lock];
    operations = [[data->operations copy] autorelease];
    [data->lock unlock];
    return operations; // you forgot something, Apple.
}

#endif

@end 
```

头文件是：

```
@interface DLOperationQueue : NSOperationQueue {}
#if TARGET_OS_IPHONE
-(NSArray*) operations;
#endif
@end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-04T02:40:51.273

我只是不相信这里有足够的背景来说明发生了什么。显然有些地方出了问题，但你没有说你是如何限制并发性的，你是如何测试对象正在运行的，等等。

至于模拟器与 iPhone，NSOperations 在两者之间的行为可能完全不同，因为所有基于 Intel 的 Mac 都是多处理器的，而没有 iPhone 是。根据您尝试限制并发性的方式，您可能会处于无法在第二个核心上执行阻止东西运行等情况。但如果没有更多细节，就不可能知道。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-01T08:42:38.843

不知道为什么您会看到这种行为，但作为一种纯粹的解决方法，您可以在将单个操作添加到队列中时保留对它们的引用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T13:16:46.743

我在内存不足的情况下看到了类似的行为。你用了多少内存？当您收到*didReceiveMemoryWarning*消息时，您是否正确清除了缓存和其他临时数据？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-13T23:10:19.300

我刚刚遇到了同样的问题。比我在 OS X 应用程序上使用的代码更简单，但 [myoperationqueue 操作] 总是返回 nil。我打算使用它来避免重复查询。这是在 iPhone OS 2.2.1 上。当然看起来像一个错误。感谢您的代码，我可以使用它，或者只使用我自己的队列镜像。

这不在模拟器上，我确认我添加了 20 个或完全相同的作业副本，它们都很好地排列并且完成了 19 次太多的作业！

这是非常简单的代码。我几乎没有使用任何内存 - 这是在启动一个还没有 ui 的应用程序时。

——汤姆

# c# - 在 C# 中引发事件的单元测试（按顺序）

> ID：248989
> 
> 赞同：166
> 
> 时间：2008-10-30T01:21:41.063
> 
> 标签：c#, unit-testing, events

我有一些引发`PropertyChanged`事件的代码，我希望能够对事件是否正确引发进行单元测试。

引发事件的代码就像

```
public class MyClass : INotifyPropertyChanged
{
   public event PropertyChangedEventHandler PropertyChanged;  

   protected void NotifyPropertyChanged(String info)
   {
        if (PropertyChanged != null)
        {
            PropertyChanged(this, new PropertyChangedEventArgs(info));
        }
   }  

   public string MyProperty
   {
       set
       {
           if (_myProperty != value)
           {
               _myProperty = value;
               NotifyPropertyChanged("MyProperty");
           }
       }
   }
} 
```

在我的单元测试中，我从以下代码中得到了一个很好的绿色测试，它使用了委托：

```
[TestMethod]
public void Test_ThatMyEventIsRaised()
{
    string actual = null;
    MyClass myClass = new MyClass();

    myClass.PropertyChanged += delegate(object sender, PropertyChangedEventArgs e)
    {
         actual = e.PropertyName;
    };

    myClass.MyProperty = "testing";
    Assert.IsNotNull(actual);
    Assert.AreEqual("MyProperty", actual);
} 
```

但是，如果我然后尝试将属性设置链接在一起，如下所示：

```
public string MyProperty
{
    set
    {
        if (_myProperty != value)
        {
            _myProperty = value;
            NotifyPropertyChanged("MyProperty");
            MyOtherProperty = "SomeValue";
        }
    }
}

public string MyOtherProperty
{
    set
    {
        if (_myOtherProperty != value)
        {
            _myOtherProperty = value;
            NotifyPropertyChanged("MyOtherProperty");
        }
    }
} 
```

我对事件的测试失败 - 它捕获的事件是 MyOtherProperty 的事件。

我很确定事件会触发，我的 UI 会像它一样做出反应，但我的委托只捕获最后一个触发的事件。

所以我想知道：
1.我测试事件的方法是否正确？
2\. 我提出*连锁*事件的方法正确吗？

* * *

## 回答 #1

> 赞同：200
> 
> 时间：2008-10-30T01:45:26.053

您所做的一切都是正确的，前提是您希望您的测试询问“引发的最后一个事件是什么？”

您的代码按此顺序触发这两个事件

*   财产已更改（...“我的财产”...）
*   属性已更改（...“MyOtherProperty”...）

这是否“正确”取决于这些事件的目的。

如果您想测试引发的事件数量以及引发它们的顺序，您可以轻松扩展现有测试：

```
[TestMethod]
public void Test_ThatMyEventIsRaised()
{
    List<string> receivedEvents = new List<string>();
    MyClass myClass = new MyClass();

    myClass.PropertyChanged += delegate(object sender, PropertyChangedEventArgs e)
    {
        receivedEvents.Add(e.PropertyName);
    };

    myClass.MyProperty = "testing";
    Assert.AreEqual(2, receivedEvents.Count);
    Assert.AreEqual("MyProperty", receivedEvents[0]);
    Assert.AreEqual("MyOtherProperty", receivedEvents[1]);
} 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2010-04-23T13:04:15.627

如果您正在执行 TDD，那么事件测试可能会开始生成*大量*重复代码。我编写了一个事件监视器，它为这些情况提供了一种更简洁的单元测试编写方法。

```
var publisher = new PropertyChangedEventPublisher();

Action test = () =>
{
    publisher.X = 1;
    publisher.Y = 2;
};

var expectedSequence = new[] { "X", "Y" };

EventMonitor.Assert(test, publisher, expectedSequence); 
```

有关详细信息，请参阅我对以下内容的回答。

[使用反射在 C# 中引发事件的单元测试](https://stackoverflow.com/questions/2567047/unit-testing-that-an-event-is-raised-in-c-using-reflection/2697721#2697721)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-08-13T18:41:06.963

这是非常古老的，甚至可能不会被阅读，但我创建了一个 INPC Tracer 类，它允许使用一些很酷的新 .net 功能：

```
[Test]
public void Test_Notify_Property_Changed_Fired()
{
    var p = new Project();

    var tracer = new INCPTracer();

    // One event
    tracer.With(p).CheckThat(() => p.Active = true).RaisedEvent(() => p.Active);

    // Two events in exact order
    tracer.With(p).CheckThat(() => p.Path = "test").RaisedEvent(() => p.Path).RaisedEvent(() => p.Active);
} 
```

见要点：[https ://gist.github.com/Seikilos/6224204](https://gist.github.com/Seikilos/6224204)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-12-06T21:04:24.927

下面是一个稍有改动的 Andrew 的代码，它不仅仅是记录引发事件的序列，而是计算特定事件被调用的次数。虽然它基于他的代码，但我发现它在我的测试中更有用。

```
[TestMethod]
public void Test_ThatMyEventIsRaised()
{
    Dictionary<string, int> receivedEvents = new Dictionary<string, int>();
    MyClass myClass = new MyClass();

    myClass.PropertyChanged += delegate(object sender, PropertyChangedEventArgs e)
    {
        if (receivedEvents.ContainsKey(e.PropertyName))
            receivedEvents[e.PropertyName]++;
        else
            receivedEvents.Add(e.PropertyName, 1);
    };

    myClass.MyProperty = "testing";
    Assert.IsTrue(receivedEvents.ContainsKey("MyProperty"));
    Assert.AreEqual(1, receivedEvents["MyProperty"]);
    Assert.IsTrue(receivedEvents.ContainsKey("MyOtherProperty"));
    Assert.AreEqual(1, receivedEvents["MyOtherProperty"]);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-11-28T14:07:17.820

基于这篇文章，我创建了这个简单的断言助手：

```
private void AssertPropertyChanged<T>(T instance, Action<T> actionPropertySetter, string expectedPropertyName) where T : INotifyPropertyChanged
    {
        string actual = null;
        instance.PropertyChanged += delegate (object sender, PropertyChangedEventArgs e)
        {
            actual = e.PropertyName;
        };
        actionPropertySetter.Invoke(instance);
        Assert.IsNotNull(actual);
        Assert.AreEqual(propertyName, actual);
    } 
```

使用这个方法助手，测试变得非常简单。

```
[TestMethod()]
public void Event_UserName_PropertyChangedWillBeFired()
{
    var user = new User();
    AssertPropertyChanged(user, (x) => x.UserName = "Bob", "UserName");
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-01-14T10:08:36.203

不要为每个成员编写测试 - 这是很多工作

（也许这个解决方案并不适合所有情况 - 但它显示了一种可能的方式。您可能需要根据您的用例对其进行调整）

可以在库中使用反射来测试您的成员是否都正确响应您的属性更改事件：

*   在 setter 访问时引发 PropertyChanged 事件
*   事件正确引发（属性名称等于引发事件的参数）

以下代码可用作库并显示如何测试以下泛型类

```
using System.ComponentModel;
using System.Linq;

/// <summary>
/// Check if every property respons to INotifyPropertyChanged with the correct property name
/// </summary>
public static class NotificationTester
    {
        public static object GetPropertyValue(object src, string propName)
        {
            return src.GetType().GetProperty(propName).GetValue(src, null);
        }

        public static bool Verify<T>(T inputClass) where T : INotifyPropertyChanged
        {
            var properties = inputClass.GetType().GetProperties().Where(x => x.CanWrite);
            var index = 0;

            var matchedName = 0;
            inputClass.PropertyChanged += (o, e) =>
            {
                if (properties.ElementAt(index).Name == e.PropertyName)
                {
                    matchedName++;
                }

                index++;
            };

            foreach (var item in properties)
            { 
                // use setter of property
                item.SetValue(inputClass, GetPropertyValue(inputClass, item.Name));
            }

            return matchedName == properties.Count();
        }
    } 
```

你的类的测试现在可以写成。（也许您想将测试拆分为“事件存在”和“使用正确名称引发的事件” - 您可以自己执行此操作）

```
[TestMethod]
public void EveryWriteablePropertyImplementsINotifyPropertyChangedCorrect()
{
    var viewModel = new TestMyClassWithINotifyPropertyChangedInterface();
    Assert.AreEqual(true, NotificationTester.Verify(viewModel));
} 
```

班级

```
using System.ComponentModel;

public class TestMyClassWithINotifyPropertyChangedInterface : INotifyPropertyChanged
{
        public event PropertyChangedEventHandler PropertyChanged;

        protected void NotifyPropertyChanged(string name)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, new PropertyChangedEventArgs(name));
            }
        }

        private int id;

        public int Id
        {
            get { return id; }
            set { id = value;
                NotifyPropertyChanged("Id");
            }
        }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-02-17T13:21:54.973

我在这里做了一个扩展：

```
public static class NotifyPropertyChangedExtensions
{
    private static bool _isFired = false;
    private static string _propertyName;

    public static void NotifyPropertyChangedVerificationSettingUp(this INotifyPropertyChanged notifyPropertyChanged,
      string propertyName)
    {
        _isFired = false;
        _propertyName = propertyName;
        notifyPropertyChanged.PropertyChanged += OnPropertyChanged;
    }

    private static void OnPropertyChanged(object sender, PropertyChangedEventArgs e)
    {
        if (e.PropertyName == _propertyName)
        {
            _isFired = true;
        }
    }

    public static bool IsNotifyPropertyChangedFired(this INotifyPropertyChanged notifyPropertyChanged)
    {
        _propertyName = null;
        notifyPropertyChanged.PropertyChanged -= OnPropertyChanged;
        return _isFired;
    }
} 
```

有这样的用法：

```
 [Fact]
    public void FilesRenameViewModel_Rename_Apply_Execute_Verify_NotifyPropertyChanged_If_Succeeded_Through_Extension_Test()
    {
        //  Arrange
        _filesViewModel.FolderPath = ConstFolderFakeName;
        _filesViewModel.OldNameToReplace = "Testing";
        //After the command's execution OnPropertyChanged for _filesViewModel.AllFilesFiltered should be raised
        _filesViewModel.NotifyPropertyChangedVerificationSettingUp(nameof(_filesViewModel.AllFilesFiltered));
        //Act
        _filesViewModel.ApplyRenamingCommand.Execute(null);
        // Assert
        Assert.True(_filesViewModel.IsNotifyPropertyChangedFired());

    } 
```

# sql - 汇总汇总数据

> ID：248990
> 
> 赞同：4
> 
> 时间：2008-10-30T01:21:48.723
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我有一个如下表：

```
软件名称计数国家
项目 15 加拿大
Visio 12 加拿大
项目 10 美国
Visio 5 美国

```

我如何查询它给我一个总结，比如......

```
软件名称 加拿大 美国 总计
项目 15 10 25
视觉 12 5 17

```

在 T-SQL 中怎么做？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T01:38:44.540

```
SELECT SoftwareName, 
  SUM( CASE Country WHEN 'Canada' THEN [Count] ELSE 0 END ) AS Canada,
  SUM( CASE Country WHEN 'USA'    THEN [Count] ELSE 0 END ) AS USA,
  SUM( [Count] ) AS Total
FROM [Table] 
GROUP BY SoftwareName; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T04:25:30.833

好的...这是使用 PIVOT 的方法：

```
SELECT Softwarename, Canada, USA, Canada + USA As TOTAL from SoftwareDemo 
PIVOT 
    (
     SUM([Count])
     FOR Country
     IN (Canada, USA)
    ) AS x

Softwarename                                       Canada      USA         TOTAL
-------------------------------------------------- ----------- ----------- -----------
Project                                            15          10          25
Visio                                              12          5           17

(2 row(s) affected) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T01:40:08.000

这称为表格旋转。在您的简单情况下，只有两列；一般来说，可能有200个左右的国家，在这种情况下，转向变得相当困难。

网上有很多资源描述了如何做到这一点：Google for 'pivot table sql'。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T02:46:42.500

在 SQL 2005 或更高版本中，为您执行此操作的 SQL 关键字“Pivot”，请查看以下链接：

[http://msdn.microsoft.com/en-us/library/ms177410.aspx](http://msdn.microsoft.com/en-us/library/ms177410.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-15T07:20:04.660

我认为您可以使用此链接：

[唯一记录的总和 - 比游标更好的性能](https://stackoverflow.com/questions/17165381/sum-of-unique-records-better-performance-than-a-cursor/18657739#18657739)

我认为使用 PIVOT 函数具有最佳性能评估器 SUM() 函数。！

# html - Internet Explorer 7 对“加号”字符 (+) 的奇怪处理

> ID：248998
> 
> 赞同：-1
> 
> 时间：2008-10-30T01:24:41.120
> 
> 标签：html, internet-explorer

这真的很奇怪......当我在 Internet Explorer 7.0.5730.11（在 Windows Server 2003 Web Edition SP2 上）中打开以下简单的 HTML 文档时

```
<html>
  <body>
    <p>+</p>
  </body>
</html> 
```

它向我展示了一个完全空白的页面。FWIW，这只是一个微不足道的“复制”样本。在真实的 HTML 文档中，我观察到了其他更奇怪的效果，这些效果是由标记后面的“加号”字符引起的。

**注意：**这个问题似乎非常间歇性。大多数时候它确实可以正常工作（即显示“加号”字符），我仍然找不到任何方法来随意重现这个问题。

基于最近评论的一些额外细节：

*   没有涉及服务器。我正在打开磁盘上的文件（即使用**file://**协议）。

*   除了上面显示的五行之外，该文件不包含任何内容。没有文档类型声明，没有字符编码，没有任何东西。

看起来像 IE 中的一个错误。有没有人遇到相同或类似的问题？

**注意：**我很欣赏到目前为止收到的所有回复，但没有一个回复者遇到这个问题。有些东西告诉我，99.(9)% 的 StackOverflow 观众将无法重现它。:-)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T01:44:12.610

如果您使用数字字符引用表示法，它是否有效？

```
<html>
  <body>
     <p>&#43;</p>
  </body>
</html> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T22:13:58.727

这可能是由于服务器造成的，尤其是当它试图将页面解析为脚本时。去检查：

*   当效果发生时，您会看到哪些 HTTP 标头？
*   当你在那个时候“查看源代码”时，你看到了什么？
*   当您将页面直接加载为文件时，是否会出现这种效果？
*   这种效果是否曾经在其他浏览器中出现过？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T11:30:11.973

不管它值多少钱，我只是在 IE 7 (7.0.5730.13C0) 上测试了它，即使有几次刷新（至少 10 或 12 次），它也始终显示“+”。您没有提到操作系统，但在我的情况下它是 Windows XP SP2（帮助显示版本 5.1（内部版本 2600.xpsp_sp2_qfe.070227-2300：Service Pack 2）。操作系统在这种情况下可能会有所不同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T15:35:15.100

如果您使用 Doctype，它会起作用吗？如果您不使用 doctype（在此处插入 no-right-to-be-picky 双关语），IE 确实会有点挑剔。

间歇性是指使用相同的代码，它出现和不出现吗？这听起来*真的很*奇怪。

*已关闭 - 不是复制*...呃我的意思是我只得到 +，无论我刷新多少次。我建议使用 HTML 实体参考 - 但如果其他人也无法重现，这可能是您的系统/浏览器的问题。*******************