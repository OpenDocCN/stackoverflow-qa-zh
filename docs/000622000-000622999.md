# StackOverflow 问答 000622000-000622999

# c# - 处理实例字段的静态方法

> ID：622002
> 
> 赞同：1
> 
> 时间：2009-03-07T15:34:35.317
> 
> 标签：c#

我见过编写的静态方法（但我从未运行过代码），它使用来自另一个类的实例数据（基于实例）。

通常，实例数据适用于实例方法，同样适用于静态字段/方法。在实例方法中处理静态数据意味着什么？我假设它是不受欢迎的，但我找不到任何关于引擎盖下会发生什么的细节。另外，使用静态数据的实例方法呢？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T15:42:32.677

我没有看到在静态方法中处理来自另一个对象的实例数据的问题。

我假设您的意思是，例如，通过参数将对象的实例变量传递给静态方法，然后该方法处理该变量。

静态只是意味着你没有得到**这个**，但你可以得到**otherobject->something**

我认为它不会比首先使用静态方法更令人不悦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T16:24:20.050

静态方法使用对象实例或使用静态数据的实例方法没有问题。

该框架充满了证明这一点的方法。例如，非常常用`String.Concat`的方法是采用一个或多个对象实例的静态方法。（`Concat`每当您使用 + 运算符连接字符串时，编译器都会生成方法调用。）

这`Int32.MaxValue`是一个静态属性，在实例方法中使用它显然没有问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T15:38:10.207

基本上，实例方法有一个隐藏`this`参数，用于传递该方法应该处理的实例。这就是静态方法在没有显式引用的情况下无法访问实例数据的原因（因为它们不知道应该访问哪个对象实例）。

考虑到这一点，我看不出静态方法和实例方法之间有什么特别的区别。它们都是方法，并且相似之处多于差异。

静态数据和实例数据都容易出现线程问题，但是，实例不太可能在线程之间使用。因此，访问静态字段可能需要更加小心（关于同步问题）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T15:50:09.897

应该没有问题。最近我有一个场景，我需要一个类的每个实例都有一个不同但可重现的随机种子。我在类中保留了一个私有静态 int，并在每次实例化时递增它，并将其用作种子。

它工作得很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T15:54:46.797

我认为在实例方法中使用静态数据本身没有任何问题，但我认为您需要真正限制您使用的数据类型。这种方法的优点/缺点是单个数据更改可以改变特定类型的所有对象的行为。这使得更改该类型的数据非常危险。我倾向于将它的使用限制在以下场景中

1.  不可变的值 - 没有什么可以改变，所以没有什么可担心的
2.  全局对象——我**强烈**避免这样做，但我发现有时拥有一个全局对象的弊端大于风险。这些对象虽然经过仔细监控并经过严格测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-07T17:32:39.807

在实例方法中处理静态数据时，我能想到的唯一含义是多线程应用程序中的同步。在处理来自静态方法的实例数据时，我想不出任何不利影响。然而，仅仅因为某事*可以*做并不意味着它*应该*做。

这是您提供的具体示例。

> A 类是基于实例的，并且有一个名为 ProductPrice 的实例字段。B类是静态的，有一个叫做PlayAroundWithPrice(double price)的静态方法，编码器传入ProductPrice字段。

显然，这个例子在技术上没有任何*违法*之处，但它对我来说是违反规定的。首先，A 类的 ProductPrice 字段显然是公开的，因为 B 类可以对其进行操作。出于封装的目的，我个人总是将字段设为私有并使用公共属性来访问它们。其次，因为 ProductPrice 是一个公共字段而不是公共属性，所以 A 类无法防止 ProductPrice 被设置为无效值（例如负值）。第三（如上所述），如果此示例发生在多线程程序中，则可能存在同步问题。第四，我想这是真正的问题，为什么B类上有一个静态方法来操作A类的字段？为什么不把静态方法放在 A 类上呢？

我不知道我是否会把它作为一个硬性规则（也许只是一个经验法则），但是当你不想支付时我会限制使用静态方法只是为了使用该方法而构造一个对象的成本。

例如，在我从事的项目中，我有一个 IPHeader 类，它将完全从字节缓冲区构造一个 IPHeader 实例。但是，在大多数情况下，我只需要 IPHeader 中的几个值。因此，为了避免与创建和垃圾收集 IPHeader 实例相关的成本，我添加了几个静态方法，它们将直接从字节缓冲区中提取值。

我希望我已经正确理解了你的问题。

# c# - 仅显示 DataGrid 中的 X 行

> ID：622006
> 
> 赞同：0
> 
> 时间：2009-03-07T15:38:58.753
> 
> 标签：c#, xml, datagrid, rss, twitter

我想在我的网站上发布我最近的 5 条推特。我在 C# 中使用 XMLTextReader 构建了一个数据网格，它读取提要，但我面临的问题是它显示了所有提要，我找不到只显示 5 的方法。有什么想法吗？

```
 XmlTextReader reader = new XmlTextReader("http://some.rss/feed.rss");
        DataSet ds = new DataSet();
        ds.ReadXml(reader);
        dg.DataSource = ds.Tables[2];
        dg.AutoGenerateColumns = false;
        dg.AllowPaging = false;
        dg.DataBind(); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T16:31:06.570

直接回答你的问题：

```
<asp:GridView ID="gv" runat="server"
              PageSize="5" AllowPaging="true">
   <PagerSettings Visible="false" />
</asp:GridView> 
```

但我只是想知道，为什么不尝试为 Twitter API 使用 C# 包装器呢？

像：

[http://devblog.yedda.com/index.php/2007/05/16/twitter-c-library/](http://devblog.yedda.com/index.php/2007/05/16/twitter-c-library/)

或关注 Petar 的精彩帖子

[http://blogs.vertigo.com/personal/petar/Blog/archive/2008/06/23/twitter-wcf-client.aspx](http://blogs.vertigo.com/personal/petar/Blog/archive/2008/06/23/twitter-wcf-client.aspx)

**PS 将推特**添加到您的标签中！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T15:43:58.820

从 DataTable 中手动删除除前 5 行之外的所有行的简单解决方案怎么样？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T15:58:11.640

更好的是，Twitter API 允许您指定“自 ID”值。这样，您只能请求自您拥有的最新版本以来的更新。

# iphone - iPhone调试：变量不是最新的？

> ID：622011
> 
> 赞同：0
> 
> 时间：2009-03-07T15:44:14.920
> 
> 标签：iphone, xcode, gdb

我最近才开始广泛使用调试器，所以我不确定这是否是一个限制。

当我在 iPhone 上调试时，变量不是最新的，除非我明确查看它 ( `ctrl`+ `click`-> `view variable as expression`)。有没有办法在不显式查看的情况下查看实际变量？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T16:09:53.080

你能澄清你的问题吗？您应该只在程序停止时查看数据——在程序运行时检查数据（如果它确实有效的话）的用处要少得多。确保设置断点，然后在遇到断点后检查数据。

使用 Xcode 内置调试​​功能的替代方法是使用 gdb 控制台。键入 ⌘-Shift-R，或从菜单中选择“调试控制台”以打开控制台。然后，您可以键入以下命令：

```
# View a variable
print var
# View this object's member variable
print self->memberVar
# Ask an Objective-C object to print itself:
print-object self 
```

您应该使用`print`原始类型（`int`、`char*`等）和 POD 类型（结构）；您应该`print-object`与 Objective-C 对象（`NSString`等）一起使用。有关 and 的更多信息`print`，请`print-object`键入

```
help print
help print-object 
```

您还可以分别使用缩写`p`和`po`for`print`和`print-object`。

# c++ - 公共函数/类的列表及其对应的头文件

> ID：622017
> 
> 赞同：0
> 
> 时间：2009-03-07T15:47:59.233
> 
> 标签：c++, stl

我试图找到一个地方，在那里我可以找到准备复制每个 stl 头文件中可用的所有函数和类的列表。

浏览 /usr/include/c++ 并不像我预期的那么方便。

谷歌经常显示 [http://www.cplusplus.com/reference/](http://www.cplusplus.com/reference/) ，复制粘贴不太方便。

有谁知道看的好地方吗？谢谢。

**编辑：**
这是一个“auto stl header”插件。所以我不需要例子。只是每个 std::xxx 与 <yyy> 的对应关系。

**对于 Vim 用户和那些可能感兴趣的人**
使用一半给定的链接和我创建的 std 头文件 auto std include vim 插件。我现在无法选择正确的答案。但如何更自动地接收到这种信息，我还在考虑中。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T15:55:56.263

我不确定我是否理解正确，但是如果您需要标题中的参考和功能列表，那么可能[是 dinkumware](http://www.dinkumware.com/manuals/)手册。如果你想要例子，那么试试[这个](http://www.java2s.com/Code/Cpp/CatalogCpp.htm)。如果您想要绝对和真实的参考，请转到 ISO 标准。

我忘了提到[SGI STL 程序员指南](http://www.sgi.com/tech/stl/)...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T16:00:46.130

我一直认为对 STL 有用的一个站点是[SGI 的 STL 页面](http://www.sgi.com/tech/stl/)。

查看“索引”页面和“按类别索引”页面。

高温高压

干杯，

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T16:10:35.370

SGI 拥有最全面的 STL 文档（流除外）

大多数事物的列表在这里按类别组织：
[http ://www.sgi.com/tech/stl/table_of_contents.html](http://www.sgi.com/tech/stl/table_of_contents.html)

完整列表在这里：
[http ://www.sgi.com/tech/stl/stl_index.html](http://www.sgi.com/tech/stl/stl_index.html)

我只是使用这个页面：
[http ://www.sgi.com/tech/stl](http://www.sgi.com/tech/stl)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T15:58:16.120

为什么不通过像 Doxygen 这样的工具运行您自己的实现的标头？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T16:01:22.943

好吧，每个人的 STL 可能并不完全是 ISO 标准，但 GCC doxygen 输出可能仍然符合您的需求。从这里开始：http: [//gcc.gnu.org/onlinedocs/libstdc++/](http://gcc.gnu.org/onlinedocs/libstdc++/)

向下浏览输出，我找不到将所有类及其函数一起列出的任何单个页面*，*但也许您可以编写一个基于 wget 的小脚本以您想要的格式聚合它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-07T16:01:41.213

我喜欢 SGI 文档。[分类索引](http://www.sgi.com/tech/stl/stl_index_cat.html)看起来很接近您想要的列表。[主页](http://www.sgi.com/tech/stl/index.html)。_

# c++ - 如何获得更好的分析？

> ID：622019
> 
> 赞同：4
> 
> 时间：2009-03-07T15:48:33.507
> 
> 标签：c++, c, macos, gcc, profiling

我需要对程序进行概要分析，以查看是否需要对性能进行任何更改。我怀疑有必要，但首先测量是要走的路。这不是那个程序，但它说明了我遇到的问题：

```
#include <stdio.h>
int main (int argc, char** argv)
{
  FILE* fp = fopen ("trivial.c", "r");
  if (fp)
  {
    char line[80];
    while (fgets (line, 80, fp))
      printf (line);

    fclose (fp);
  }
  return 0;
} 
```

这是我用它做的：

```
% gcc trivial.c -pg -o trivial
% ./trivial
...
% gprof trivial gmon.out 
```

诚然，这是一个微不足道的程序，但我原以为它会在分析雷达上产生某种昙花一现。它没有：

```
 called/total       parents 
index  %time    self descendents  called+self    name       index
                                  called/total       children

                0.00        0.00       1/1           __start [1704]
[105]    0.0    0.00        0.00       1         _main [105]

-----------------------------------------------

  %   cumulative   self              self     total           
 time   seconds   seconds    calls  ms/call  ms/call  name    
  0.0       0.00     0.00        1     0.00     0.00  _main [105]

Index by function name

 [105] _main 
```

有人可以在这里指导我吗？我希望输出反映它至少调用了 fgets 和 printf 14 次，而且它确实击中了磁盘 - 当然应该有一些测量的时间。

当我在真实程序上运行相同的命令时，我会列出更多功能，但即便如此，它也不是一个完整的列表——只是一个示例。

也许 gprof 不是正确使用的工具。什么是？

这是在 OS X Leopard 上。

编辑：我运行了真正的程序并得到了这个：

```
% time real_program
real      4m24.107s
user      2m34.630s
sys       0m38.716s 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-07T16:09:56.980

我认为您可以尝试各种 Valgrind 工具，尤其是`callgrind`（用于获取程序中发生的每个呼叫的呼叫计数和包含成本）。

valgrind 输出有各种不错的可视化工具。我不知道 OS X 的特定工具。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-07T16:10:35.560

默认情况下`gprof`向您显示有限的数据。哪个好。查看您的输出 - 它仅提及 main （这是默认设置）。现在，看一下`calls`专栏——这就是你想要的。但是对于其他功能，请尝试：

```
gprof -e main -f printf -f fgets trivial > gprof.output 
```

这是一些命令的[链接。](http://www.math.utah.edu/docs/info/gprof_4.html)另外，试试`man gprof`你的系统。[以下](http://www.cs.utah.edu/dept/old/texinfo/as/gprof.html#SEC6)是如何解释数据。

另外，查找`ltrace`，`strace`并且`ptrace`（如果有的话——我不再记得它们是否都在 OSX 上）——它们很有趣！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-07T15:57:55.777

[Shark](http://developer.apple.com/tools/sharkoptimize.html)是包含在开发人员工具中的分析器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-07T18:13:11.647

在分析代码之前，您需要查看程序将时间花在哪里。在 time(1) 下运行它可以查看对应的用户、系统和挂钟时间。仅当用户时间接近挂钟时间时，分析您的代码才有意义。如果用户和系统时间与挂钟时间相比非常小，那么您的程序是 I/O 绑定的；如果系统时间接近挂钟时间，则您的程序受内核限制。在这两种情况下，在 strace -c 或合适的 dtrace 脚本下运行您的程序，以确定每个系统调用所花费的时间。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-07T17:40:06.687

分析并不表示磁盘访问，只是调用了哪些函数，并且由于 VM 缓存，这些函数不具有代表性。

[Valgrind 在 OS X 上不能很好地工作。](http://www.sealiesoftware.com/valgrind/)

使用 Leopard，您拥有[Dtrace](http://www.mactech.com/articles/mactech/Vol.23/23.11/ExploringLeopardwithDTrace/index.html)实用程序；我没有使用它，但它可能会为您提供您正在寻找的信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-07T18:34:04.590

缺少某些函数通常意味着这些函数不是为分析而编译的。具体来说，要分析使用标准函数（例如`printf`（我猜几乎总是））的代码，您需要使用分析支持编译的 C 库版本。我不熟悉 OS X，但在 Linux 上我需要安装一个包含 libc_p 库的 libc6-prof 包。

顺便说一句，我确实相信 OS X（或者可能是 XCode？）带有一个分析工具。它不如该`gprof`方法精确，因为它使用采样，但是您可以在任何程序上运行它而无需特殊编译。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-09T01:58:39.320

查看您的程序，因为您正在使用文件处理（仅），它还取决于启用的任何缓存。因此，请注意，您的分析结果可能会根据您的缓存行为而有所不同。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-08T02:25:25.363

在这个行业有一些普遍接受的信念，我建议你仔细研究一下。

一个是发现性能问题的最好（如果不是唯一）方法是测量每个子例程所花费的时间并计算它被调用的次数。

那是自上而下的。它源于一种信念，即森林比树木更重要。它基于关于“代码速度”和“瓶颈”的神话。这不是很科学。

性能问题更像是一个错误，而不是一个定量的问题。它做错了什么是*浪费时间*，需要修复。它基于一个简单的观察：

**缓慢包括因不良原因而花费的时间。**

要找到它，请在时钟时间的随机片段中对程序状态进行采样，并调查其原因。

如果某些事情导致缓慢，那么仅这一事实就会将其暴露给您的样本。所以如果你拿了足够多的样本，你就会看到它。通过显示它的样本比例，您将大致了解它花费了多少时间。

判断是否有充分理由花费了一小段时间的一个好方法是仔细查看调用堆栈。堆栈上的每个函数调用都有一个隐含的原因，如果这些原因中的任何一个是糟糕的，那么整个样本的原因就是糟糕的。

一些分析器会在语句级别告诉您每个语句的成本。

就个人而言，我只是随机停止程序几次。出现在多个样本上的任何调用都可能引起怀疑。它永远不会失败。

你可能会说“这不准确”。它非常准确。它精确地指出了导致问题的指令。它不会为您提供 3 位小数的计时精度。即，它对于测量来说很糟糕，但对于诊断来说却是极好的。

你可能会说“递归呢？”。那么，它呢？

你可能会说“我认为这只能在玩具程序上起作用”。那只是希望。事实上，大型程序往往有更多的性能问题，因为它们有更深的堆栈，因此有更多的机会进行不合理的调用，并且采样发现它们很好，谢谢。

很抱歉成为一个脾气暴躁的人。我只是讨厌在应该以科学为基础的领域中看到神话。

[更多的](https://stackoverflow.com/questions/566014/why-does-my-c-code-run-slow/567926#567926)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-15T19:56:40.993

对于您上面给出的示例代码，如果您对调用堆栈进行多次采样，您基本上会看到这些堆栈，按一定比例：

```
-------------------------------------
...
main.c:  4 call _fopen
...        call _main
-------------------------------------
...
main.c:  8 call _fgets
...        call _main
-------------------------------------
...
main.c:  9 call _printf
...        call _main
-------------------------------------
...
main.c: 11 call _fclose
...        call _main 
```

并且比例将大致告诉您每次通话花费的时间比例。您可能不会看到太多其他内容，因为与 I/O 库调用相比，“独占”时间基本上为零。这就是堆栈样本可以告诉您的内容 - 无论程序有多大，花费您最多的精确语句，以及大致多少。

# windows - 用于解压缩的免费 JPEG2000 库或 SDK

> ID：622020
> 
> 赞同：6
> 
> 时间：2009-03-07T15:48:54.893
> 
> 标签：windows, sdk, jpeg2000

我编写了代码来使用专有 SDK 压缩和解压缩图像文件，以便通过卫星从飞机传输。不幸的是，必须购买许可证才能进行解压缩和压缩。到目前为止，我的应用程序主要在内部使用，因此我可以跟踪许可证和分发。现在我需要为外人提供应用程序，我既不能控制分发，也不想为许可证付费。

有人知道免费的解压缩程序、SDK 或库吗？我用 C++ 为 Windows NT、2000、XP 编程。

我的图像文件是原始数据，单色，具有 16 位无符号像素，并且使用的压缩是无损或非常轻微的有损。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-16T21:12:16.893

这只是一个想法，但事实上 JPEG2000 的标准是[Kakadu](http://www.kakadusoftware.com/)，因为 Taubman 博士几乎编写了 JPEG2000 标准。虽然要花一些钱，但它是我所知道的最好的图书馆。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-07T15:59:07.363

也许这可能是一个很好的起点：[OpenJPEG](http://www.openjpeg.org/)。如果它不符合您的要求，请在他们的论坛上寻求一些提示。

我大学的一些人使用[jj2000](http://jj2000.epfl.ch/)进行各种测试。但是它是在Java中...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T17:50:23.993

还有 libjasper： [链接文本](http://www.ece.uvic.ca/~mdadams/jasper/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-18T03:22:52.987

查看[j2k-codec](http://j2k-codec.com/) 它不是免费的，但也不昂贵。

我自己买了它（v1.7）并使用了 4 年。解码速度非常快，目前没有遇到任何错误。

对于编码，我使用 ER Mapper SDK。

我不知道这些年来有多少改进`Jasper`或`OpenJPEG`表现出来，但那些免费库对我来说太慢了。（编码和解码都慢）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-02T14:02:25.750

Magick++ 是 ImageMagick 的 C++ 绑定，我*认为*它公开了 ImageMagick 的 JPEG-2000 功能。ImageMagick 使用了 Doug 提到的 libjasper。这可能对你有用（希望对我也有用）。

* * *

## 回答 #6

> 赞同：-9
> 
> 时间：2009-03-14T17:33:17.967

当 GdiPlus 已经这样做了，为什么有人会在 Windows 平台上为 Jpeg 库付费？

[http://msdn.microsoft.com/en-us/library/ms533844(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms533844(VS.85).aspx)

应该是一个很好的起点。gdiplus 在 jpeg 解压缩速度方面排名第二（在我的测试中，无论什么重要）。并作为 Windows 5 及更高版本的操作系统组件分发。即 Windows XP 和更高版本。

如果出于任何原因，GdiPlus 是不可接受的......

Intel曾经发布过一个jpeg解压*压缩库，创造性地命名为“intel jepg library”或ijl。可再发行组件由单个 dll ijl15.dll 组成，如果您能找到原始发行版，则其许可免费分发和使用。英特尔只是不再托管它。它已被 intel 性能原语库所取代，该库确实包含 jpeg 压缩和解压缩，但每席位许可非常公平，并且对*coff*可再发行文件的再分发没有限制。

# sockets - 将 xxxclass 编码/解码为 byte[]，然后使用 C# 将其发送到 Remote PC

> ID：622030
> 
> 赞同：0
> 
> 时间：2009-03-07T15:57:02.690
> 
> 标签：sockets

嗨，我有一个 TCP/IP 套接字项目。

我可以通过客户端向服务器发送字符串消息，并且可以从服务器获取响应。但是得到一个字符串消息并且只发送一个字符串（或任何其他对象）。我想在从服务器端发送到客户端后将 Personel 类编码为字节数组。然后解码它。而不是从我的班级获得价值。

//服务器端代码 Connect() 在表单加载时开始

```
 private void Connect()         
 {
        // start listen socket
        dinleyiciSoket = new TcpListener(System.Net.IPAddress.Any, 10048);
        dinleyiciSoket.Start();
        Socket istemciSoketi = dinleyiciSoket.AcceptSocket();
        NetworkStream agAkisi = new NetworkStream(istemciSoketi);
        BinaryReader binaryOkuyucu = new BinaryReader(agAkisi);
        BinaryWriter binaryYazici = new BinaryWriter(agAkisi);
        string alinanMetin = binaryOkuyucu.ReadString();
        MessageBox.Show(alinanMetin, "Yeni Genelge", MessageBoxButtons.OK);
        binaryYazici.Write(true);
        dinleyiciSoket.Stop();
        Connect();
    } 
```

////////// 客户端 //////////////

```
 private string IpAdresi(string host)
    {
        string address = "";
        IPAddress[] addresslist = Dns.GetHostAddresses(host);

        foreach (IPAddress theaddress in addresslist)
        {
            if (theaddress.AddressFamily == AddressFamily.InterNetwork)
            {
                address = theaddress.ToString();
            }

        }
        return address;
    }

    bool onay;
    private void button1_Click(object sender, EventArgs e)
    {
        //create socket connection
        Socket istemciBaglantisi = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
        //Bağlantıyı gerçekleştir
        if (istemciBaglantisi.Connected != true)
        {
            istemciBaglantisi.Connect(IPAddress.Parse(IpAdresi(txtHost.Text)), 10048);
        }

        agAkisi = new NetworkStream(istemciBaglantisi);
        binaryYazici = new BinaryWriter(agAkisi);
        binaryOkuyucu = new BinaryReader(agAkisi);
        binaryYazici.Write(txtMesaj.Text);
        onay = binaryOkuyucu.ReadBoolean();
        MessageBox.Show(onay.ToString());
        istemciBaglantisi.Close();

    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T16:23:13.640

看看对象序列化。[有关示例，请参见此处](http://www.codeproject.com/KB/cs/objserial.aspx)。这应该让你朝着正确的方向前进。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T16:34:03.910

您可以使用 google 的协议缓冲区。它是一种用于序列化对象的快速而紧凑的机制。.NET 上有两种实现：[protobuf-net](http://code.google.com/p/protobuf-net/)和[protobuf](http://code.google.com/p/protobuf/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T16:39:33.307

我会使用对象序列化或 XmlSerialization，它们都在 .NET 中可用。我不会看 Google 的协议缓冲区，因为 RPC 编码与 .NET 中已有的相比几乎没有优势，但它是模糊的，尤其是在 .NET 世界中，尤其是现在。我不会打赌它会成为 .net 开发人员的主流。因此，使用这种 RPC 编码只会使代码更难维护。

当互连的应用程序是同质的并且不在 Google 数据中心的规模上时，我真的不认为需要 protobufs。即使异质性是规则，我也不认为有必要，因为我们已经有了 JSON 和 XML。它们既可读又可服务，而 protobuf 则不是。

在任何情况下，.NET 都有你所需要的，内置的。

# database - 在大列表中查找字母位置

> ID：622031
> 
> 赞同：0
> 
> 时间：2009-03-07T15:57:53.500
> 
> 标签：database, search, alphabetized

我有一个 as400 表，其中包含大约 100 万行全名/公司名称，我想将其转换为使用另一个数据存储，同时仍与原始数据存储相匹配。

目前，用户输入搜索并几乎立即获得搜索词在表中的字母位置和匹配页面。然后，用户可以非常快速地向上或向下分页记录。

几乎没有数据更新，每周大约有 50 次插入。我认为任何数据库都可以维护名称的字母索引，但我不确定如何在数据集中快速找到搜索的位置。非常感谢任何建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T16:20:34.707

这听起来就像结果的常规分页，除了它不是根据请求的页码或偏移量转到特定页面，而是根据用户搜索在结果中的字母顺序进入特定页面。

假设您想在该位置之后获取 10 行，之前获取 10 行。

如果用户搜索“Smith”，您可以进行两次选择：

```
SELECT
  name
FROM
  companies
WHERE
  name < 'Smith'
ORDER BY
  name DESC
LIMIT 10 
```

进而

```
SELECT
  name
FROM
  companies
WHERE
  name >= 'Smith'
ORDER BY
  name
LIMIT 10 
```

你可以做一个 UNION 来在一个查询中获取它，上面只是简化了。

用户搜索的术语将适合这些结果的一半。如果有任何精确匹配，则第一个精确匹配将被定位为第十一个。

请注意，如果用户搜索“aaaaaaaa”，那么他们可能只会得到前 10 个结果，而之前没有任何内容，而对于“zzzzzzzz”，他们可能只会得到最后的 10 个结果。

*我假设有问题的 SQL 引擎允许 >= 和 < 字符串之间的比较（并且可以在索引中优化它），但我没有测试过，也许你不能这样做。如果像 MySQL 一样，它支持国际化排序规则，那么您甚至可以为非 ascii 字符正确排序。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T16:57:01.827

如果“搜索的位置”是指按字母顺序枚举的记录编号，您可能想尝试以下操作：

```
select count(*) from companies where name < 'Smith' 
```

大多数数据库应该可以很好地优化这一点（但试试吧——你在网上读到的理论并不胜过经验数据）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T17:32:39.323

只是添加到订购建议：

*   如果这是您的标准数据检索方式，请在名称中添加索引。
*   您可以通过结合[LIMIT 和 OFFSET](http://www.postgresql.org/docs/7.2/static/queries-limit.html)来有效地进行分页。

# jquery - 如何在jQuery中更改具有特定类的图像的一部分img src？

> ID：622042
> 
> 赞同：1
> 
> 时间：2009-03-07T16:06:34.197
> 
> 标签：jquery

基本上尝试执行以下操作：

我有三种颜色：蓝色、绿色和红色

我有一组应根据所选颜色链接加载的图像。所有图像的格式都完全相同，除了颜色：

蓝色：img1.blue.jpg、img2.blue.jpg。img3.blue.jpg 绿色：img1.green.jpg、img2.green.jpg、img3.green.jpg

我知道用“。”分割 src，但是如何更改所有具有特定类的图像的颜色部分？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T16:13:45.537

我认为它是这样的：

```
$(".MYCLASSNAME").each(function(i){
    var ar = i.attr("src").split(".");
    ar[1] = newColor; // red, green, or blue
    i.attr("src", join(ar, "."));
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T19:01:29.220

像这样的东西？你有这样的链接

```
<a href='#' customColor='blue' class='colorChangeLink'>Blue</a> 
```

和这样的图像：

```
<img src='img1.red.jpg' class='imgChangeColor'>
<img src='img2.red.jpg' class='imgChangeColor'> 
```

然后将更改图像颜色。

```
$('.colorChangeLink').click(function () {
    var color = $(this).attr('customColor');
    $('.imgChangeColor').each(function (i) {
        //Note, this is pretty much Ithi's answer from here on.
        var arr = i.attr('src').split('.');
        arr[1] = color;
        i.attr('src', join(arr, '.'));
    });
    return false;
}); 
```

# winforms - 我应该为 WinForm 对话框使用的最大尺寸是多少？

> ID：622044
> 
> 赞同：2
> 
> 时间：2009-03-07T16:07:39.357
> 
> 标签：winforms, user-interface, usability, resolution

我正在设计一些对话框，并且很难适应所有内容。（并且它必须在设计上适合单个对话框，所以请不要告诉我我应该制作两个对话框而不是一个:)）

我想知道在让最终用户烦恼之前，对话框的最大尺寸是多少。当然不应该大于他的分辨率，但是还有其他的界限需要考虑吗？

我试图限制在 800x580（以便它可以在 800x600 屏幕上正常显示而不隐藏任务栏），但我希望我的用户使用 1024x768 或更好的屏幕分辨率。

是 800x580 的对话框，还是太大了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T16:12:27.723

您是否考虑过使用选项卡式布局？

另外，我认为最小的主流屏幕分辨率是1024x600。

我会说任何事情都太大了。我尝试坚持低于 1000x500。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T16:29:35.513

我在分辨率为 1024 x 600 的上网本 (ASUS) 上写这篇文章。我还注意到这也是大多数其他上网本的事实标准。

另一种选择：您可以创建一个自动调整大小以填充当前桌面的对话框（任务栏除外）。

它还可以为其子控件强制执行“流”式布局。这将确保充分利用可用空间。

要在 Windows 窗体中“流动”，您可以使用流布局控件或（对于更丰富的界面）WebBrowser 控件。

顺便说一句，如今，模态对话框作为一种用户交互方式似乎不太流行。尤其是包含大量信息/控件的大型对话框。这篇文章有[一些不错的选择](http://discuss.joelonsoftware.com/default.asp?design.4.665311.26)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T23:16:26.300

无论您的逐个像素大小如何，如果熟练的用户需要几秒钟以上的时间才能完成对窗口的使用，那么它不应该是一个对话框。再长一点就烦了。你会要求你的用户做太多的工作，这些工作太容易丢失（例如，通过意外点击取消）并且太难重新进入（例如，在会话之间）。如果你有这么多控件，对话框需要800个，那么控件太多了。200,000 平方像素和 40 个控件是您应该考虑的最多对话框。选项卡是自然的方式来说明你的对话太复杂了。

对话框用于输入参数以在对话框的主窗口中可见的一个或多个数据对象上执行单个命令，这就是对话框需要小而简单的原因。我怀疑这不是你在做什么。相反，您使用“对话框”来表示主要数据对象并执行主要任务，而不是单个命令。

您想要的是一个*主窗口*，而不是一个对话框，它具有您为用户设置的复杂任务所需的所有支持。这包括为用户提供一种保存、检索和复制其作品的方法。这意味着带有所有标准命令的菜单栏和工具栏，包括帮助。窗口绝对应该是无模式的，并且可以调整大小、最大化和最小化。

主窗口应设计为在大多数（超过一半）用户屏幕的尺寸下工作得最好。1024x768 通常适用于当今的笔记本电脑/台式机屏幕，并不是说您不需要使用那么多空间。如果用户的屏幕较小，或者用户出于任何原因将窗口的大小调整为低于设计大小，那么滚动条应该允许完全访问表单中的所有控件和内容——就像任何主窗口一样。网络上的经验表明，滚动并不是表单的亮点。

除此之外，可以在主窗口中使用选项卡来增加其上的控件数量。您说您不想听到有关多个窗口的信息，但是如果用户要跨选项卡/窗口比较数据，则应该使用多个窗口而不是选项卡。您还可以通过使用紧凑的演示文稿（我在[http://www.zuschlogin.com/?p=42](http://www.zuschlogin.com/?p=42)对此进行了描述）更适合给定的主窗口大小，但在提交之前对您的用户测试这种方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T16:47:02.227

我认为，如果用户需要同时在屏幕上查看所有数据……并且您可以将所有内容都放在 800x580 中……我认为这是一个很好的尺寸。

如果您知道所有用户都有更大的分辨率，所以不要挣扎......这个尺寸是可以的。

但是...显示大量信息并能够对其进行编辑的一种方式...可能是[PropertyGrid](http://msdn.microsoft.com/en-us/library/aa302326.aspx)控件（[此处为示例](http://www.c-sharpcorner.com/UploadFile/mgold/PropertyGridInCSharp11302005004139AM/PropertyGridInCSharp.aspx)）...如果您不满意，可能会缩小表单它这么大。考虑到您的客户/用户的需求，不知道这是否有可能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T18:49:50.170

只是希望没有人尝试在通过标准清晰度显示器运行的媒体中心上使用您的应用程序。NTSC 是 640x480。我在很多应用程序中都遇到了这个问题。

# c++ - Functor 类在构造函数中工作

> ID：622048
> 
> 赞同：0
> 
> 时间：2009-03-07T16:10:08.773
> 
> 标签：c++, templates, functor, strategy-pattern

我正在使用 C++ 模板来传递策略函子来改变我的函数的行为。它工作正常。我传递的仿函数是一个没有存储的无状态类，它只是以经典仿函数的方式重载了 () 运算符。

```
template <typename Operation> int foo(int a) 
{
int b=Operation()(a);
/* use b here, etc */
} 
```

我经常这样做，而且效果很好，而且我经常使用传入的 6 或 7 个模板化仿函数来制作模板！

但是我担心代码的优雅和效率。函子是无状态的，所以我假设 Operation() 构造函数是免费的，并且对函子的评估与内联函数一样有效，但像所有 C++ 程序员一样，我总是有一些挥之不去的疑问。

我的第二个问题是我是否可以使用另一种仿函数方法.. 一种不会覆盖 () 运算符的方法，而是将构造函数中的所有内容作为副作用！就像是：

```
struct Operation {
  Operation(int a, int &b) { b=a*a; }
};
template <typename Operation> int foo(int a) 
 {
   int b;
   Operation(a,b);
    /* use b here, etc */
 } 
```

我从未见过有人使用构造函数作为仿函数的“工作”，但它似乎应该工作。有什么优势吗？有什么缺点吗？我确实喜欢删除奇怪的双括号 "Operator()(a)" ，但这可能只是美观。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T16:22:14.250

> 有什么缺点吗？

*   Tors 不返回任何有用的值——不能在链式调用中使用（例如 foo(bar()）。
*   他们可以扔。
*   设计观点——ctors 是对象创建函数，并不是真正的主力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T16:21:56.873

1.  编译器实际上内联了 Operation 的空构造函数（至少 gcc 在类似情况下会这样做，除非您关闭优化）
2.  在构造函数中做所有事情的缺点是您不能以这种方式创建具有某种内部状态的函子 - 例如。用于计算满足谓词的元素数量的函子。此外，使用真实对象的方法作为函子允许您存储它的实例以供以后执行，这是您的构造函数方法无法做到的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T16:30:48.223

从性能方面来看，演示的代码使用 VC 和 GCC 进行了完全优化。然而，更好的策略通常是将函子作为参数，这样您可以获得更多的灵活性和相同的性能特征。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T17:32:47.810

我建议定义与 STL 容器一起工作的仿函数，即它们应该实现 operator()。（遵循您使用的语言的 API 始终是一个好主意。）

这使您的算法非常通用（传入函数、仿函数、stl-bind、boost::function、boost::bind、boost::lambda，...），这是人们通常想要的。

这样，就不需要将仿函数类型指定为模板参数，只需构造一个实例并传入即可：

```
my_algorithm(foo, bar, MyOperation()) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T12:52:31.737

在另一个类中实现构造函数似乎没有任何意义。
您所做的就是打破封装并设置您的课程以供滥用。

构造函数应该将对象初始化为类定义的良好状态。您正在允许另一个对象初始化您的类。你有什么保证这个模板类知道如何正确初始化你的类？您的类的用户可以提供任何可能以非预期方式扰乱对象内部状态的对象。

该类应该是自包含的，并将自身初始化为一个良好的状态。你似乎在做的是玩模板只是为了看看他们能做什么。

# xml - 如何在 Yahoo! 中使用 Xpath 遍历树的小部件？

> ID：622058
> 
> 赞同：0
> 
> 时间：2009-03-07T16:16:20.273
> 
> 标签：xml, xpath, children, yahoo-widgets

我正在创建一个**Yahoo! 小部件**，并且之前没有任何问题（创建小部件）。我正在通过网络链接获取**xml 文档**，并希望将所有节点引入树中。我正在这样做：

```
var request = new XMLHttpRequest();
        request.open( "GET", url, false );
        request.send();
        if ( request.status == 200 )
        {
            doc = request.responseXML;
            tree = doc.evaluate("/lfm");
            status = tree.item(0).getAttribute("status")
            if(status == "ok")
            {
                print ("status is ok!");
                tracks = doc.evaluate("/lfm/recenttracks[1]/track");
                for(i=0;i<tracks.length;i++)
                {
                    artist = tracks.item(i).firstChild.firstChild.data;
                }
            }
        }
    } 
```

这样您就可以将节点**艺术家**从**树**中取出。但是，如果您想拥有**下一个兄弟姐妹**，那就有问题了。你必须打电话

```
tracks.item(i).firstChild.nextSibling.firstChild.data;
tracks.item(i).firstChild.nextSibling.nextSibling.firstChild.data;
tracks.item(i).firstChild.nextSibling.nextSibling.nextSibling.firstChild.data; 
```

完成这项工作。旁边的节点会为其添加**“nextsibling”**，依此类推。我不想继续添加这些节点，并认为可以像这样使用**childNodes[i]**：

```
artist = tracks.item(i).childNodes[0].firstChild.data;
nextitem = tracks.item(i).childNodes[1].firstChild.data; 
```

这虽然行不​​通。它以我使用它的任何方式返回**“childNodes [0] 没有属性”**。**现在我认为Xpath**中还有一种方法可以在 for 循环中执行此操作：

```
name = doc.evaluate("string(/lfm/recenttracks[1]/track["+i+"]/name)");
                    print(name);
othernode = doc.evaluate("string(/lfm/recenttracks[1]/track["+i+"]/album)");
                    print(othernode); 
```

然后为下一首曲目增加**i 。**但不知何故，这只返回**一项**。它不会在**for**循环中检索更多项目。**i-1**也不起作用。

任何人都知道如何使用带有我的 i 值的 Xpath 表达式来选择一个节点，然后获取每个超节点的子节点？每**首曲目**我想获取**艺术家、姓名、流媒体、mbid、专辑、网址、图像（小）、图像（中）、图像（大）**和**日期。**

我的 xml 文件如下所示：

```
<lfm status="ok">
   <recenttracks user="xaddict">
      <track nowplaying="true"> 
         <artist mbid="f5b8ea5f-c269-45dd-9936-1fedf3c56851">The Presets</artist>
         <name>Girl (You Chew My Mind Up)</name>
         <streamable>1</streamable>
         <mbid></mbid>
         <album mbid="b150d099-b0f3-4feb-9a05-34e693c6dd24">Beams</album>
         <url>http://www.last.fm/music/The+Presets/_/Girl+%28You+Chew+My+Mind+Up%29</url>
         <image size="small">http://userserve-ak.last.fm/serve/34s/8696437.jpg</image>
         <image size="medium">http://userserve-ak.last.fm/serve/64s/8696437.jpg</image>
         <image size="large">http://userserve-ak.last.fm/serve/126/8696437.jpg</image>
         <date uts="1236440600">7 Mar 2009, 15:43</date>
      </track>
      <track > 
         <artist mbid="f5b8ea5f-c269-45dd-9936-1fedf3c56851">The Presets</artist>
         <name>Get Outta Here</name>
         <streamable>1</streamable>
         <mbid></mbid>
         <album mbid="0469956f-d895-4120-8ec5-29ad41b9e2fd">Blow Up</album>
         <url>http://www.last.fm/music/The+Presets/_/Get+Outta+Here</url>
         <image size="small">http://userserve-ak.last.fm/serve/34s/20923179.png</image>
         <image size="medium">http://userserve-ak.last.fm/serve/64s/20923179.png</image>
         <image size="large">http://userserve-ak.last.fm/serve/126/20923179.png</image>
         <date uts="1236440242">7 Mar 2009, 15:37</date>
      </track>
   </recenttracks>
</lfm> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T19:44:56.947

试试这个

```
 for (var i = 0; i < xmlDoc.getElementsByTagName('track').length; i++)
            {
                alert(xmlDoc.getElementsByTagName('track')[i].getElementsByTagName('name')[0].childNodes[0].nodeValue); 
            } 
```

* * *

如果您想使用 xpath，您也可以尝试以下解决方案。

```
var s = xmlDoc.evaluate( '//track' ,xmlDoc, null, XPathResult.ANY_TYPE, null );
var track = s.iterateNext();

while (track)
{
     alert(track.getElementsByTagName('name')[0].textContent );
     track = s.iterateNext();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T16:34:35.890

您可以发布相关的 XML 片段吗？我们正在查看解析它的代码，但如果我们有 XML 本身，那么构建 Xpath 查询会更容易。最有用的是具有以下元素的位

```
<lfm>
    <recenttracks>
        <track>
            <album> 
```

ETC

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T15:33:30.347

完全启用 Xpath 的方法是使用 Xpath 中的字符串转换。我已经将此代码发布为另一个问题的答案，并将再次执行此操作。我很高兴我发现了这种做事方式。

```
var entries = xmlDoc.evaluate("lfm/recenttracks/track");
var length = entries.length;
for(var i = 0; i &lt; length; i++) {
   var entry = entries.item(i);
   var obj = {
      artist: entry.evaluate("string(artist)"),
      name: entry.evaluate("string(name)"),
      url: entry.evaluate("string(url)"),
      image: entry.evaluate("string(image[@size='medium'])")
   };
posts[i] = obj;
} 
```

# windows - 密码保护 IIS 目录

> ID：622061
> 
> 赞同：5
> 
> 时间：2009-03-07T16:18:24.277
> 
> 标签：windows, iis, passwords

我正在寻找一种方法来密码保护 IIS 中的目录。我知道对此的标准答案是为此目录创建一个 Windows 用户帐户，然后授予该用户对该目录的读取权限......但我担心的是，通过创建一个 Windows 用户，这不会给他们执行诸如登录到计算机（远程桌面）、ftp 到服务器以及各种其他事情的权限？IE 有没有办法创建这样一个受限用户，以至于他们唯一能做的就是查看受密码保护的目录中的网页？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-07T16:34:39.293

这是标准答案是有原因的……这是最好的方法。默认情况下，用户帐户受到限制，并且没有远程访问权限，除非您明确将其设置为，因此不必担心。此外，任何 FTP 服务都应该单独运行，因此该帐户不会登录。如果您只想保护目录，那么只需确保它是只读的并且禁用匿名访问即可。

此外，创建用户帐户还有其他好处，例如让您可以在事件日志中监控该帐户的事件，并让您选择一个强大、安全的密码。

另一种方法是使用简单的登录 cgi 脚本（例如 perl、php、asp 等）来保护页面，如果您只有一个帐户要添加，那么这将是微不足道的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T16:27:48.560

您可以通过设置用户名和密码为此目录启用[基本身份验证。](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/abbca505-6f63-4267-aac1-1ea89d861eb4.mspx?mfr=true)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T16:26:54.223

不，您可以限制用户执行其他选项。在“用户管理”面板中创建用户时，您可以设置几个选项。一是不允许远程登录。我对 ftp 服务在 Windows 上的工作方式有点模糊，但我相信它也可以受到限制。关键是要确保它不会被添加到您不希望该用户拥有访问权限的任何组中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T16:28:14.487

首先，您可以完全控制创建的用户。您可以轻松拒绝远程登录（默认情况下它实际上被拒绝，但不要相信我并检查文档）。

其次，“密码保护”不是正确的方法，因为系统已经内置了访问控制的方法 - 使用它，它已经过测试并且是可靠的。

对于核心问题：我认为您可以尝试将用户权限限制在该级别，当他们只能在本地登录并且只能看到一个目录时。但是没有办法阻止他们对 Windows 文件夹具有读取权限（例如），因为这个文件夹是引导操作系统和登录所必需的。

# cvs - 我可以为 cvs root 使用符号链接来简化服务器整合吗？

> ID：622064
> 
> 赞同：1
> 
> 时间：2009-03-07T16:20:33.647
> 
> 标签：cvs, symlink

我们正在将两台旧的 cvs 服务器合并到一个新机器上。

我曾希望：更改 oldserver1 和 oldserver2 的 dns 条目（以及一些用户帐户维护）将使移动对 cvs 用户透明。

**问题：**
由于每台旧服务器上的 cvs 根目录不同，我遇到了问题。

**背景**
旧服务器具有以下 cvs 存储库目录：

*   旧 server1 cvs 根目录：/cvshome
*   旧 server2 cvs 根目录：/usr/local/cvs

在发行版中，我们使用的默认存储库目录是 /var/cvs。我选择坚持这一点，即：

*   新服务器 cvs 根目录：/var/cvs

**目标**
我希望对现有签出项目的干扰最小，即不必查找/替换公司每个硬盘驱动器上的所有“根”文件。

澄清一下，旧 server1 的 CVSROOT 和 CVS/Root 条目如下所示：

```
pserver:username@oldserver1:/cvshome 
```

**我试过这个的尝试**
：在新服务器上创建一个符号链接

```
/cvshome points to /var/cvs
ln -s /var/cvs /cvshome 
```

但是，当我尝试更新（即从指向旧服务器 1 的工作站）时，我收到此错误：

```
/cvshome : no such repository 
```

**总结**
我可以使用链接到“别名”一个 cvs 存储库吗？

*还是我需要“咬紧牙关”并更改所有硬盘驱动器上的所有“根”文件*？**

 *谢谢，
比尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T16:29:34.267

在 Linux 上，当您为命令提供指向目录的符号链接的路径时，是否附加斜杠会有所不同：

```
$ ls -l /cvsroot 
```

将列出符号链接的 inode，而

```
$ ls -l /cvsroot/ 
```

将列出符号链接指向的目录的内容。这种行为不同于 cvsroot 是实际目录时所看到的行为。

我不确定这是否是您的问题，但请尝试附加斜线。如果有帮助，您应该能够对存储库根目录下的所有内容进行检查、更新等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-03-28T07:55:34.540

这可能对某人有所帮助，很抱歉对旧线程发表评论。

对我有用的是更改 /etc/xinetd.conf 中的 --allow-root ：

```
server_args = -f --allow-root /usr/local/cvsroot pserver 
```

符号链接/别名现在可以在我移动存储库的这个新服务器上工作。

# drupal-6 - 如何禁用在drupal中显示创作信息？

> ID：622069
> 
> 赞同：2
> 
> 时间：2009-03-07T16:22:43.267
> 
> 标签：drupal-6, themes

我在drupal中做一个本地网站。我已经应用了主题“Acquia Marina”（[http://drupal.org/node/315555](http://drupal.org/node/315555)）。

在“管理”>“主题”>“配置”下，对于“页面”类型，我已取消选中“在显示以下类型的帖子时启用或禁用*由用户名提交的日期*文本”，并且为“故事”启用了相同的功能（我没有自己的内容类型）

但是我仍然在所有“页面”上的日期文本上收到*用户名提交的内容*

我已经尝试过，清除性能缓存，在相关复选框上尝试所有（4）组合，但无济于事。但此设置在默认主题中完美运行。

我猜它是我需要覆盖的主题的一些行为。但是一点头绪都没有。

有什么建议么？谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-01-16T09:13:23.317

如果它对任何人都有帮助，可以在以下每个内容类型设置中禁用创作信息：“admin/structure/types/manage/your_content_type”> 显示设置并取消选中“显示作者和日期信息。”。另一种选择是在 node.tpl.php 中将条件“”设置为“”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T17:27:07.043

转到 index.php?q=admin/build/themes/settings/acquia_marina，>“主题特定设置”>“Acquia Marina 设置”>**展开**“节点设置”（这是我一开始错过的）>“作者和日期"，并禁用所有内容类型或特定内容类型的作者姓名和日期。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-21T15:40:37.090

只需剪下模板。

```
<?php print $submitted; ?> 
```

# iphone - Objective C IBOutlets

> ID：622072
> 
> 赞同：2
> 
> 时间：2009-03-07T16:24:04.543
> 
> 标签：iphone, objective-c, uibutton

在多个按钮调用 IBOutlet 的情况下，IBOutlet 是否可以确定按下了哪个按钮？

编辑：

所有固定和接线。关键点：对象 ID 不是发件人标签！标签是属性的第一页上的独立值。

```
- (IBAction)buttonPressed:(id)sender
{
    switch ( [sender tag] )
    {
        case 109:
            NSLog(@"Button 1");
            break;

        case 108:
            NSLog(@"Button 2");
            break;
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-07T16:32:57.410

> 在多个按钮调用 IBOutlet 的情况下

也许是 IBAction？

冷杉如果全部

```
- (IBAction) actionPerformed:(id)sender 
```

所以，*发件人*是你的按钮

二是UIView的每个子类都有一个*tag*字段，所以可以使用

```
int tag = [sender tag]; 
```

您可以在 IB 中设置标签

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T16:30:02.313

通常，您会将按钮事件（Touch Down）连接到您希望在控制器中调用的 IBAction 方法。

方法原型如下所示：

```
-(IBAction) doStuff:(id)sender; 
```

然后，如果需要，可以使用“发送者”来验证进行调用的对象的身份。

IBOutlet 将用于从您的代码中联系 UIButton，例如设置其文本或属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-15T02:25:56.760

更好的是，为 UI 中的每个按钮定义一个 IBAction 方法。然后，您可以使用 IB 将按钮单独连接到方法，并避免将 const 整数硬编码到您的代码中。

# c# - 检查应用程序安装后是否首次运行的条件

> ID：622108
> 
> 赞同：7
> 
> 时间：2009-03-07T16:46:02.773
> 
> 标签：c#, deployment

C# 2008/3.5 SP1

我想检查应用程序是否是第一次运行。我开发了一个应用程序，一旦安装在客户端计算机上。我想检查它是否是第一次运行。

我已经使用 Windows 安装程序项目进行了安装。

```
 if (System.Deployment.Application.ApplicationDeployment.CurrentDeployment.IsFirstRun)
 {
      // Do something here
 } 
```

上面的代码适用于 clickonce 开发。但是我怎么能用 Windows 安装程序做类似的事情。

我正在考虑在应用程序安装时添加一个注册表。然后在程序第一次运行时检查这个注册表项（true）。首次运行后，将注册表编辑为 (false)。

但是，与其使用注册表，还有更好的方法可以使用吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-07T17:17:48.393

只需在您的应用程序设置中添加一个布尔值。最简单的方法是使用 IDE 和设置设计器。它必须是用户范围，但应用程序范围不可写。

首次检测时不要忘记切换值并保存设置。

代码如下所示：

```
 if (Properties.Settings.Default.FirstUse)
 {
     Properties.Settings.Default.FirstUse = false;
     Properties.Settings.Default.Save();

     // do things first-time only
 } 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-07T17:16:01.050

在注册表之外存储应用程序数据的一个好地方是应用程序数据文件夹。如果您在第一次运行时创建此目录，那么您只需要在后续加载时对其进行测试。此外，如果您的应用程序需要它，那么您就有了一个很好的数据存储位置。

```
string data = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
string name = System.Reflection.Assembly.GetExecutingAssembly().GetName().Name;
string path = Path.Combine(data, name);

if (Directory.Exists(path))
{
  // application has been run
}
else
{
  // create the directory on first run
  DirectoryInfo di = Directory.CreateDirectory(path);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T16:50:35.230

注册表听起来不错。您可能希望确保在将值设置为 false 之前正确执行所有首次初始化，并且您可以选择让用户在必要时重置它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T16:55:25.887

您可以只在用户的帐户文件夹中存储一个文件，而不是搞乱注册表。我不记得确切的位置，但是您可以拨打电话来获取用户设置文件夹的位置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-08T15:42:32.130

为了确定是否曾经执行过应用程序，我在可执行目录中检查文件**FirstTime.txt 。**我将该文件放在可执行目录中，因为我知道该目录在卸载过程中被删除。因此，当重新部署应用程序时，我确信该文件不会存在，因此我将使用**静态**应用程序设置来初始配置我的用户设置，用户可以通过应用程序更改这些设置，因为它们就是用户设置.

当 form_closure 事件被触发时，我会保存这些用户设置。即使有以前部署的用户设置，知道**FirstTime.txt**不存在（因此让我知道这是应用程序第一次启动），我确信用户设置被重置为静态应用程序设置第一次运行应用程序时（当然，除非用户在关闭应用程序之前更改了这些设置）。

无论如何，这里有一段代码来检查应用程序是否已经被执行：

```
 /// <summary>
    /// Check if this is the first time ADDapt has ever executed
    /// </summary>
    /// <remarks>
    /// We know that ADDapt has run before with the existence of FirstTime.txt.
    /// </remarks>
    /// <returns>
    /// False - this was the first time the application executed
    /// </returns>
    /// <param name="ADDaptBinDirectory">
    /// Application base directory
    /// </param>
    public bool CheckFirstTime(String ADDaptBinDirectory)
    {
        bool bADDaptRunFirstTime = false;

        String FirstTimeFileName = string.Format("{0}//FirstTime.txt", ADDaptBinDirectory);
        // Find FirstTime.txt in Bin Directory

        if (File.Exists(FirstTimeFileName))
            bADDaptRunFirstTime = true;
        else
        {
            // Create FirstTime file
        }

        return bADDaptRunFirstTime;
    }

    /// <summary>
    /// Create the FirstTime file
    /// </summary>
    /// <remarks>
    /// Saving the creation date in the first time documents when the app was initially executed
    /// </remarks>
    /// <param name="FirstTimeFN">
    /// Full windows file name (Directory and all)
    /// </param>
    private void CreateFirstTimeFile(String FirstTimeFN)
    {
        FileInfo fi = new FileInfo(FirstTimeFN);
        DateTime dt = DateTime.Now;

        using (TextWriter w = fi.CreateText())
        {
            w.WriteLine(string.Format("Creation Date: {0:g} ", dt));
        }
    } 
```

# c# - Default ValueConverter for a class in WPF

> ID：622117
> 
> 赞同：1
> 
> 时间：2009-03-07T16:48:28.697
> 
> 标签：c#, wpf, default, converter

I'm just about to start a new project of mine and am currently evaluating some techniques for localization, modularity etc.

I have (at least in my opinion) a pretty good approach to localization but now I struggle to find a good solution for databinding.

I want to bind values of textfields etc. (UIElements in general) to a specific method in the DataContext of the form. The method looks like this:

`public void GetValue(string name)`

where name is a "path" in the form of "node/subnode/subsubnode". I thought about using a ValueConverter for the binding and this worked out pretty good till now.

My binding expression looks like that:

`{Binding Path=Localization, Converter={StaticResource LocalizationConverter}, ConverterParameter=PrismBreak/Shell.xaml/New}`

I think that this binding expression although doing its job is kinda blown up to use for every single UIElement. So I thought if it was possible to define a default ValueConverter for a certain type (--> whenever that type is bound to somewhere that ValueConverter is used).

Is that possible in WPF?

If it's not possible is there any other good way to bind to a method with dynamic parameters?

Thanks in advance and best regards,

Chris

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T21:27:11.523

The prescribed way of doing localization for WPF, is to create localized BAML in satellite assemblies; this is achieved by adding the [x:Uid](http://msdn.microsoft.com/en-us/library/bb613571.aspx) attached property to elements you wished to be localized. There is a nice [WPF Globalization and Localizatio](http://msdn.microsoft.com/en-us/library/ms753931.aspx)n section on MSDN describing the techniques.

Another approach I would suggest would be to create a static 'Localization Dictionary' type, and to implement [ICustomTypeDescriptor](http://msdn.microsoft.com/en-us/library/system.componentmodel.icustomtypedescriptor.aspx), to redirect incoming property binds to strings in your dictionary. You could end up doing something like this:

```
<Button Content="
    {Binding Source={x:Static local:MyStaticType.Localization}, 
             Path=HelloButtonTitle}" /> 
```

And you could continue to leverage existing technologies such as RESX + Satellite assemblies.

# jquery - 如何使用 jQuery 更改 css 类规则？

> ID：622122
> 
> 赞同：52
> 
> 时间：2009-03-07T16:52:55.020
> 
> 标签：jquery, css

任何人都可以帮助我，我的问题有两个部分。

1.  我想要做的是使用 jQuery 即时更改 css 类规则。

    ```
    .classname{颜色：红色；字体大小：14px;}
    ```

    在上面的示例中，我现在使用 jQuery 命名了一个类，我只想通过添加 css 内联`.classname`来更改字体大小而不是颜色。`.classname`

2.  我想创建并将`.classname`更改保存到文件中，请记住将有完整的样式表或没有将保存在文件中的类名。

我怎样才能以最简单和更好的方式做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-03-07T17:35:46.087

据我所知，没有 jQuery 方法可以做到这一点。可能有一些 jQuery 插件，但我不知道。

基本上，您在第一个问题中试图实现的目标可以使用对象的`styleSheets`属性`document`。它比这要复杂一些，因为您需要走到一个相当深的对象链，但仍然适用于包括 Internet Explorer 6 在内的所有主要浏览器。下面是一个概念证明。CSS 位于 STYLE 标记内，但也可以与外部 CSS 一起使用。我会让你做抽象。

### 概念证明

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
<title></title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="imagetoolbar" content="false">
<meta http-equiv="imagetoolbar" content="no">
<style type="text/css">
.classname {
 color: red;
 font-size: 14px;
}
</style>
<script type="text/javascript">
window.onload = function() {
    document.getElementById("button").onclick = function() {
        var ss = document.styleSheets;

        for (var i=0; i<ss.length; i++) {
            var rules = ss[i].cssRules || ss[i].rules;

            for (var j=0; j<rules.length; j++) {
                if (rules[j].selectorText === ".classname") {
                    rules[j].style.color = "green";
                }
            }
        }
    };
}
</script>
</head>
<body>

<h1 class="classname">Some red text</h1>

<button id="button">Make text green</button>

</body>
</html> 
```

对于您的第二个问题，我没有时间编写解决方案，但它将涉及阅读上面的 CSS 声明并使用`cssText`CssRule 对象的属性来构建最终将使用 a 发送到服务器的字符串Ajax POST 请求。服务器端是您的业务。

参考：

*   [document.styleSheets (Mozilla)](https://developer.mozilla.org/En/DOM/Document.styleSheets)
*   [样式表对象 (Mozilla)](https://developer.mozilla.org/en/DOM/stylesheet)
*   [CssRule 对象 (Mozilla)](https://developer.mozilla.org/en/DOM/cssRule)
*   [文档样式表（MSDN）](http://msdn.microsoft.com/en-us/library/ms531200(VS.85).aspx)
*   [CssRule 对象 (MSDN)](http://msdn.microsoft.com/en-us/library/ms531199(VS.85).aspx)

希望能帮助到你

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2011-10-18T16:00:50.413

最近我需要为 Autocomplete 小部件修复一些 jquery 主题问题。我想更改自动完成小部件的背景颜色。

于是查了一下css，发现自动补全类是这样定义的

```
.ui-autocomplete { position: absolute; cursor: default; } 
```

因此，在我的程序中，我发出以下语句通过添加背景属性来更改类。请注意，我保留其他属性，否则会破坏现有功能

```
$("<style type='text/css'> .ui-autocomplete { position: absolute; cursor: default; background:black; color:white} </style>").appendTo("head"); 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-12-01T16:58:12.473

只有在以下情况下，您才应该采用这种方法：

*   您需要将值设置为使用类名无法枚举的值（即以像素为单位的不同宽度）
*   并且您想将此样式应用于将来将插入 DOM 中的元素

有一个 jQuery 插件可以做到这一点： http: [//plugins.jquery.com/project/jquerycssrule](http://plugins.jquery.com/project/jquerycssrule)

对于我从事的一个小项目，我提取了基本要素并创建了以下函数：

```
function addCSSRule(sel, prop, val) {
    for(var i = 0; i < document.styleSheets.length; i++){
        var ss    = document.styleSheets[i];
        var rules = (ss.cssRules || ss.rules);
        var lsel  = sel.toLowerCase();

        for(var i2 = 0, len = rules.length; i2 < len; i2++){
            if(rules[i2].selectorText && (rules[i2].selectorText.toLowerCase() == lsel)){
                if(val != null){
                    rules[i2].style[prop] = val;
                    return;
                }
                else{
                    if(ss.deleteRule){
                        ss.deleteRule(i2);
                    }
                    else if(ss.removeRule){
                        ss.removeRule(i2);
                    }
                    else{
                        rules[i2].style.cssText = '';
                    }
                }
            }
        }
    }

    var ss = document.styleSheets[0] || {};
    if(ss.insertRule) {
        var rules = (ss.cssRules || ss.rules);
        ss.insertRule(sel + '{ ' + prop + ':' + val + '; }', rules.length);
    }
    else if(ss.addRule){
        ss.addRule(sel, prop + ':' + val + ';', 0);
    }
} 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-03-07T17:01:40.943

如果我正确理解您的问题，您想通读 CSS 文件，对类进行更改，然后通过保存文件来保留这些更改？

你不能用从客户端运行的 JavaScript/jQuery 来做到这一点；您当然可以***更改 DOM 中与 CSS 类匹配的每个单独元素的字体大小*** `.classname`，如下所示

```
$('.classname').css('font-size','14px'); 
```

但是客户端 JavaScript 无法从 Web 浏览器访问文件系统，因此您需要一些其他方式（即服务器端代码）来更改 CSS 文件本身。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-07-14T19:11:21.053

您也可以尝试 JSS，它对我来说非常有用：[https ://github.com/Box9/jss](https://github.com/Box9/jss)

> 下载 jss.js 并将其包含在您的 HTML 中：
> 
> ```
> <script type="text/javascript" src="jss.js"></script> 
> ```
> 
> 添加新规则（或扩展现有规则）：
> 
> ```
> jss('.special', {
>     color: 'red',
>     fontSize: '2em',
>     padding: '10px'
> }); 
> ```
> 
> 检索现有规则：
> 
> ```
> jss('.special').get(); 
> ```
> 
> 回报：
> 
> ```
> {
>     'color': 'red',
>     'font-size': '2em',
>     'padding-bottom': '10px',
>     'padding-left': '10px',
>     'padding-right': '10px',
>     'padding-top': '10px'
> } 
> ```
> 
> 删除现有规则：
> 
> ```
> jss('.special').remove(); 
> ```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-05-21T08:38:16.860

DOM Level 2 允许直接操作样式表的 css 规则。前任 ：

```
var ss = document.styleSheets[1];  // ref to the first stylesheet
ss.cssRules[0].style.backgroundColor="blue";  // modification of the 1rst rule 
```

有2个接口：

*   [CSS样式表](https://developer.mozilla.org/en/DOM/CSSStyleSheet)
*   [样式表](https://developer.mozilla.org/en/DOM/stylesheet)

这使得激活/停用样式表、删除规则、添加规则等成为可能... MDM 中的所有详细信息：[Using_dynamic_styling_information](https://developer.mozilla.org/en/DOM/Using_dynamic_styling_information)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-07T18:19:55.840

您要做的是通过在服务器上设置几个主题（theme1.css、theme2.css、theme3.css 等）并让用户选择他喜欢的主题来完成。然后，您可以使用用户配置文件将用户选择的主题 (theme2.css) 保存在数据库中。当用户随后显示他的页面时，您在页面顶部包含 theme2.css 而不是主题 default.css。

这适用于服务器端技术，例如 PHP 或 ASP.NET 或任何您喜欢的。当然，您可能会使用 javascript 在用户计算机上保存一个[cookie](http://www.quirksmode.org/js/cookies.html)以记住他的选择，并再次使用 javascript 来[包含](http://www.hunlock.com/blogs/Howto_Dynamically_Insert_Javascript_And_CSS)您通过 cookie 记住的文件。

如果您想让用户准确管理适用于设计的特定元素的内容（例如标题的颜色、字体等），您可以再次使用服务器端技术（我认为在这种情况下更好) 或 javascript 保存诸如 header=blue、font=Arial 之类的内容并使用[jQuery](http://docs.jquery.com/CSS/css#namevalue)将存储的内容应用到您的页面。

希望它能给你一个概述。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-04T23:41:46.613

在半相关的注释中，另请参阅我关于更改 LESS 变量的答案，这将导致更新的 CSS 规则。根据您的情况，这可能更有用，因为单个 LESS 变量可以驱动许多 CSS 规则...... [https://stackoverflow.com/a/9491074/255961](https://stackoverflow.com/a/9491074/255961)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-03-07T09:15:28.607

不确定更改类属性我来这里寻找自己的答案，似乎已经有一些答案，至于保存，您可以使用 jquery $.post 方法发送包含更改或 $.get 的表单url 编码值，然后使用 PHP fwrite 或 file_put_contents 写入新的 css 文件。在存储任何数据之前，请确保您限制对此功能的访问或确保值符合特定标准。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-04-12T21:51:35.497

对于第一部分，我通常指定一个样式块并使用 jQuery 打开/关闭它。例如：

```
<style type="text/css" id="my-style" media="all">
    .classname{color:red; font-size:14px;}
</style> 
```

然后可以通过设置 disabled 属性来进行切换，如：

```
$('#my-style').prop('disabled', true);
$('#my-style').prop('disabled', false); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-11-06T08:00:05.777

您可以使用 YUI 样式表实用程序。

[http://yuilibrary.com/yui/docs/stylesheet/](http://yuilibrary.com/yui/docs/stylesheet/)

它工作得很好！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-11-11T21:26:10.260

由于应用于头部的样式相互“重载”，`append()`因此将使用所有相关元素的后期样式，除非之前`!important`涉及。

用于分配 css-content 的功能`text()`不应该是`html()`防止意外注入代码

```
var dynamic_css = function(class_name){
  return '.' + class_name + ' {color:red; font-size:14px;}';
}
var styles = $('<style type="text/css">');
styles.text(dynamic_css('my_classname'));
$('html head').append(styles); 
```

之后：

```
styles.remove(); 
```

将类分配给样式元素以在以后识别它也很有效

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-03-07T17:34:41.660

我很确定您不能更改现有样式中的规则。即使萤火虫也不会让你这样做。您可以设置一个元素或一组元素的样式，可以分配和取消分配类，但我认为您不能更改现有的类。为了执行您所要求的操作，您需要维护某种关联数组来记录对现有类的提议更改，然后保存这些更改，您需要上传到服务器，然后服务器可以提供下载到客户端的链接.

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2010-02-18T10:34:55.757

我使用了 jquery 的 addClass ：[http://api.jquery.com/addClass/](http://api.jquery.com/addClass/) 然后将类设置为我要更改的属性。

# sql-server - 如何在 SQL Server 2008 Express 中启用全文搜索

> ID：622123
> 
> 赞同：3
> 
> 时间：2009-03-07T16:54:51.693
> 
> 标签：sql-server, sql-server-2008, full-text-search, sql-server-express

当我下载 SQL Server 2008 Express 时，我认为我不需要使用全文搜索。

现在我想使用 AdventureWorks 示例数据库，但如果没有全文搜索就无法安装它。

有没有办法在不重新安装 SQL Server 2008 Express 的情况下安装它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T17:04:55.460

如果您下载并运行 SQL2008 的高级版本，它将提供添加功能的选项。我会建议包含管理工作室的版本。

编辑：菜单顺序是：安装、新建 Sql-Server 单机或添加功能

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T17:39:27.937

[本博](http://www.arguingwithmyself.com/archives/106-how-to-install-sql-server-2008-express-with-visual-web-developer-2008-express)文底部提供了如何通过附加功能升级 SQL 2008 Express 的分步说明。

# c++ - 错误记录 C++ 预处理器宏 __LINE__、__FUNCTION__

> ID：622129
> 
> 赞同：4
> 
> 时间：2009-03-07T16:57:34.730
> 
> 标签：c++, logging, c-preprocessor

我试图将一个简单的错误记录合并到我现有的应用程序中，目前它报告错误只是使用`cout`所以我希望使用操作员保持类似的界面`<<`。但是我希望它记录发生错误的行和函数，但我不想`__LINE__, __FUNCTION__`每次需要记录时都必须输入。有谁知道我可以用来允许`__LINE__`宏在另一个函数中使用的技巧，而不是报告调用行？希望这是有道理的。

```
class myLogClass {
    uint8_t level;                  
public:                 
    bool operator<<( const char * input );          
};

bool myLogClass::operator<<( const char * input ) {
    logItInSQL( input );
    return true;
} 
```

而不是每次都这样

```
myLogClass << "Line No: " << __LINE__
    << " Function: " << __FUNCTION__
    << " Error: " << "This is my error to be logged"; 
```

我只想能够做到：

```
myLogClass << "This is my error to be logged";

bool myLogClass::operator<<( const char * input ) {
    logItInSQL( " Line No: __LINE__" );
    logItInSQL( " Function: __FUNCTION__" );
    logItInSQL( " Error: " + input );
    return true;
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-07T17:03:20.143

```
myLogClass << "Line No: " << __LINE__ ... 
```

使用您的`operator <<`链接将不起作用，因为它返回一个`bool`.

```
bool myLogClass::operator << (const char * input) 
```

通常将流插入定义如下：

```
std::ostream& myLogClass::operator << (std::ostream& o, const char * input) {
    // do something
    return o;
} 
```

做这个：

```
#define log(o, s) o << "Line No: " << __LINE__ << \
                   " Function: " << __FUNCTION__ << \
                   " Error: " << s // note I leave ; out 
```

此外，您可以将宏包装在一个`do-while`循环中：

```
#define log(o, s) do { o << "Line No: " << __LINE__ << \
                   " Function: " << __FUNCTION__ << \
                   " Error: " << s; \ 
                  } while(0) // here, I leave ; out 
```

然后就可以愉快的写了：

```
 myLogClass myLogger; // do this

 // use it
log(myLogger, "This is my error to be logged"); // note the ; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-04-13T11:37:47.217

在 ANSI C（我假设它也应该在 C++ 中工作）中，您可以使用可变参数函数和预处理器宏来做到这一点。请参见下面的示例：

```
#include <stdio.h>
#include <stdarg.h>

#define MAXMSIZE 256
#define MyDebug(...) MyInternalDebug(__FILE__,__FUNCTION__,__LINE__,__VA_ARGS__)

void MyInternalDebug( char *file, char *function, const int line, const char *format, ... )
{
    char message[MAXMSIZE];
    // Variable argument list (VA)
    va_list ap;
    // Initialize VA
    // args : Name of the last named parameter in the function definition.
    // The arguments extracted by subsequent calls to va_arg are those after 'args'.
    va_start(ap, format);

    // Composes a string with the same text that would be printed if 'format' was used on printf,
    // but using the elements in the variable argument list identified by 'ap' instead of
    // additional function arguments and storing the resulting content as a C string in the buffer pointed by 'message'.
    // * The state of arg is likely to be altered by the call.
    vsprintf(message, format, ap);
    // Custom print function
    printf("%s\t%s\t%d\t%s\n",file, function, line, message);

    // Finzalize use of VA
    va_end(ap);
}

int main ()
{  
    MyInternalDebug(__FILE__, __FUNCTION__, __LINE__, "An error occured with message = '%s'", "Stack Overflow");
    MyDebug("Another error occured with code = %d", 666);

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T16:59:05.770

不，这就是使用宏完成日志记录的原因。 `__LINE__`需要由有问题的行上的预处理器进行扩展，而不是在常见的日志记录功能中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T17:03:16.617

正如 Adam Mitz 提到的，您需要在呼叫位置使用 __LINE__。
我建议您添加一个额外的参数，如“additionalInfo”，并创建一个宏，该宏将使用 __LINE__ 和 __FUNCTION__ 生成此“additionalInfo”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-09T18:55:36.600

我无法在第一个答案中获得代码进行编译。我使用这个简单的宏来很好地完成任务：

`#define qlog(s) std::cerr << __FUNCTION__ << "::" << __LINE__ << "\t" << s << endl`

# c# - 什么是虚拟方法？

> ID：622132
> 
> 赞同：84
> 
> 时间：2009-03-07T17:01:11.570
> 
> 标签：c#, virtual, keyword

为什么要将方法声明为“虚拟”。

使用虚拟有什么好处？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-03-07T17:02:46.073

[Virtual](http://msdn.microsoft.com/en-us/library/9fkccyh4.aspx) Modifier 用于标记方法\property(ect) 可以在派生类中使用override[修饰符](http://msdn.microsoft.com/en-us/library/ebca9ah3(VS.80).aspx)进行修改。

例子：

```
class A
{
    public virtual void Foo()
       //DoStuff For A
}

class B : A
{
    public override void Foo()
    //DoStuff For B

    //now call the base to do the stuff for A and B 
    //if required
    base.Foo()
} 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-10-02T20:57:41.393

Virtual 允许继承类替换基类随后使用的方法。

```
public class Thingy
{
    public virtual void StepA()
    {
        Console.Out.WriteLine("Zing");
    }

    public void Action()
    {
        StepA();
        Console.Out.WriteLine("A Thingy in Action.");
    }
}

public class Widget : Thingy
{
    public override void StepA()
    {
        Console.Out.WriteLine("Wiggy");
    }
}

class Program
{
    static void Main(string[] args)
    {
        Thingy thingy = new Thingy();
        Widget widget = new Widget();

        thingy.Action();
        widget.Action();

        Console.Out.WriteLine("Press any key to quit.");
        Console.ReadKey();
    }
 } 
```

当您运行程序时，您的输出将是：

```
Zing 
A Thingy in Action. 
Wiggy 
A Thingy in Action. 
```

请注意，即使 Widget 调用了在 Thingy 级别定义的 Action() 方法，Thingy 在内部也调用了 Widget 的 StepA() 方法。

基本答案是它为类的继承者提供了更大的灵活性。当然，你必须很好地设计你的课程，否则它可能会造成严重破坏。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-03-07T20:03:29.273

虚拟方法是一种方法，其中实际方法调用取决于底层对象的运行时类型。

非虚拟方法是一种方法，其中调用的实际方法取决于方法调用时对象的引用类型。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-03-07T17:04:38.877

[MSDN 上的虚拟方法](http://msdn.microsoft.com/en-us/library/9fkccyh4(VS.71).aspx)

> virtual 关键字用于修改方法或属性声明，在这种情况下，方法或属性称为虚拟成员。虚拟成员的实现可以通过派生类中的覆盖成员进行更改。
> 
> 调用虚拟方法时，将检查对象的运行时类型以查找覆盖成员。调用最派生类中的重写成员，如果没有派生类重写该成员，则该成员可能是原始成员。（有关运行时类型和大多数派生实现的更多信息，请参阅 10.5.3 虚拟方法。）
> 
> 默认情况下，方法是非虚拟的。您不能覆盖非虚拟方法。
> 
> 您不能将 virtual 修饰符与以下修饰符一起使用：
> 
> **静态** **抽象** **覆盖**
> 
> 虚拟属性的行为类似于抽象方法，除了声明和调用语法不同。
> 
> *   在静态属性上使用 virtual 修饰符是错误的。
> *   通过包含使用 override 修饰符的属性声明，可以在派生类中覆盖虚拟继承属性。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-07T17:04:22.137

虚拟方法类似于基类中的抽象方法，只是它们在派生类上的实现是可选的。您也可以将逻辑放在虚拟方法中并在派生类中覆盖它们。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-07T17:06:14.363

即使您不打算从该类派生，也可能需要将方法标记为 virtual 以模拟该类。一些模拟框架只允许你模拟虚拟方法。请注意，实现接口的方法是隐式虚拟的。

我使用具有此限制的 RhinoMocks，并且出于这个原因默认将我的方法标记为虚拟。对我来说，这可能是使用虚拟方法的最大原因，因为继承发挥作用的情况要少得多。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-12-30T23:22:13.147

一个简短的问题，一个简短的答案！如果您认为您将继承它所属的类，请将您的方法限定为“虚拟”。

更长的答案：“虚拟使您能够覆盖，以在派生类中赋予您的方法的另一种含义。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-07T17:04:20.500

为了能够在继承类中覆盖它。

查看关键字的[MSDN 条目](http://msdn.microsoft.com/en-us/library/9fkccyh4(VS.71).aspx)。这更深入地解释了它。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-02-20T07:09:38.947

在 C# 中，为了在派生类中重写基类方法，您必须将基类方法声明为虚拟，并将派生类方法声明为 override，如下所示：

```
using System;
namespace Polymorphism
{
 class A
 {
 public virtual void Test() { Console.WriteLine("A::Test()"); }
 }

 class B : A
 {
 public override void Test() { Console.WriteLine("B::Test()"); }
 }

 class C : B
 {
 public override void Test() { Console.WriteLine("C::Test()"); }
 }

 class Program
 {
 static void Main(string[] args)
 {

 A a = new A();
 B b = new B();
 C c = new C();
 a.Test(); // output --> "A::Test()"
 b.Test(); // output --> "B::Test()"
 c.Test(); // output --> "C::Test()"

 a = new B();
 a.Test(); // output --> "B::Test()"

 b = new C();
 b.Test(); // output --> "C::Test()"

 Console.ReadKey();
 }
 }
} 
```

您还可以使用 virtual 和 new 关键字混合方法隐藏和方法覆盖，因为派生类的方法可以同时是 virtual 和 new。当您想进一步将派生类方法覆盖到下一个级别时，这是必需的，因为我正在覆盖 Class B，Class C 中的 Test() 方法，如下所示：

```
using System;
namespace Polymorphism
{
 class A
 {
 public void Test() { Console.WriteLine("A::Test()"); }
 }

 class B : A
 {
 public new virtual void Test() { Console.WriteLine("B::Test()"); }
 }

 class C : B
 {
 public override void Test() { Console.WriteLine("C::Test()"); }
 }

 class Program
 {
 static void Main(string[] args)
 {

 A a = new A();
 B b = new B();
 C c = new C();

 a.Test(); // output --> "A::Test()"
 b.Test(); // output --> "B::Test()"
 c.Test(); // output --> "C::Test()"

 a = new B();
 a.Test(); // output --> "A::Test()"

 b = new C();
 b.Test(); // output --> "C::Test()"

 Console.ReadKey();
 }
 }
} 
```

金字：virtual 关键字用于修改基类中声明的方法、属性、索引器或事件，并允许在派生类中覆盖它。

override 关键字用于将基类的虚拟/抽象方法、属性、索引器或事件扩展或修改为派生类。

new 关键字用于将基类的方法、属性、索引器或事件隐藏到派生类中。

请享用 ：-）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-07T17:10:58.330

不用说，当您的代码试图遵守[开放封闭原则时，虚拟方法会派上用场](http://en.wikipedia.org/wiki/Open/closed_principle)

[在此处](http://www.objectmentor.com/resources/articles/ocp.pdf)阅读有关 Open Closed 原则的更多信息，鲍勃叔叔的原始 OCP 白皮书。

另请注意，与 Java 不同，C# 中的方法默认*不是虚拟的。*

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-03-31T04:30:49.597

虚函数是实际上并不存在的函数。派生类可以通过重写来修改虚函数。虚函数是实现运行时多态性的方法之一

```
 public class sample {
      public virtual void fun(){
        Console.WriteLine("base sample class \n");
      }
    }
    public class A : sample{
      public override void fun(){
        Console.WriteLine("Class A \n");
      }
    }
    public class B : sample{
      public override void fun(){
        Console.WriteLine("Class B \n");
      }
    }
    class run{
      public static void main(String[] args){
        sample obj = new sample();
        sample obj1 = new A();
        sample obj2 = new B();
        obj.fun();
        obj1.fun();
        obj2.fun();
      }
    } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-01-26T16:28:47.787

[这里用示例C# Virtual Method](https://www.dotnetperls.com/virtual)清楚地解释了它

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-05-23T17:43:13.437

运行时发生在编译时。
当您将方法声明为虚拟时，在派生类中声明它需要您添加`override`or`new`修饰符。
我们可以看到当`TrySpeak`. 传入child和father，都调用Speak of Father，while `TryScream`，会调用各个方法。
要理解这一点，我们应该知道一些事情，在 Child 的实例中，有`Scream`来自 Child 类或 Father 类的两种方法。我们可以调用`Scream` from Child 类或 Father 类。因为`Virtaul`修饰符标记了方法，所以它可以被派生类覆盖，这意味着即使`Scream`是从父类调用的，它也是被覆盖的，如果使用新修饰符会有所不同。

```
using System;
class Father
{
    Speak()
    {
        Console.Writeline("Father is speaking") 
    }
    virtual Scream()
    {
        Console.Writeline("Father is screaming")    
    }
}
class Child: father
{
    Speak()
    {
        Console.Writeline("Child is speaking")  
    }
    override Scream()
    {
        Console.Writeline("Child is screaming") 
    }
}
class APP
{
    public static void Main()
    {
        // We new two instances here
        Father father = new Father();
        Child child = new Child();        
        // Here we call their scream or speak through TryScream or TrySpeak
        TrySpeak(father);
        TrySpeak(child);
        //>>>"Father is speaking"
        //>>>"Father is speaking"
        TryScream(father);
        TryScream(child);
        //>>>"Father is screaming"
        //>>>"Child is screaming"
    }
    // when your method take an Parameter who type is Father
    // You can either pass in a Father instance or
    // A instance of a derived Class from Father
    // which could be Child
    public static void TrySpeak(Father person)
    {
        person.Scream();
    }
    public static void TryScream(Father person)
    {
        person.Speak();
    }
} 
```

# actionscript-3 - 从旋转的矩形计算边界框坐标

> ID：622140
> 
> 赞同：78
> 
> 时间：2009-03-07T17:03:41.127
> 
> 标签：actionscript-3, math, geometry, rotation, bounding-box

我有一个矩形左上角的坐标，以及它的宽度、高度和从 0 到 180 和 -0 到 -180 的旋转。

我正在尝试获取矩形周围实际框的边界坐标。

计算边界框坐标的简单方法是什么

*   最小 y，最大 y，最小 x，最大 x？

A 点并不总是在最小界限上，它可以在任何地方。

如果需要，我可以在 as3 中使用矩阵转换工具包。

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2009-03-07T17:20:36.357

*   变换所有四个角的坐标
*   找出所有四个 x 中最小的一个`min_x`
*   找出所有四个 x 中最大的一个并将其命名为`max_x`
*   与 y 同上
*   你的边界框是`(min_x,min_y), (min_x,max_y), (max_x,max_y), (max_x,min_y)`

AFAIK，没有任何王道可以让你更快地到达那里。

如果您想知道如何转换坐标，请尝试：

```
x2 = x0+(x-x0)*cos(theta)+(y-y0)*sin(theta)
y2 = y0-(x-x0)*sin(theta)+(y-y0)*cos(theta) 
```

其中 (x0,y0) 是您旋转的中心。您可能需要根据您的三角函数（他们期望度数或弧度）、坐标系的感觉/符号与您指定角度的方式等来修改这个。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2012-02-06T22:22:35.643

我知道您要求的是 ActionScript，但是，以防万一有人来这里寻找 iOS 或 OS-X 答案，它是这样的：

```
+ (CGRect) boundingRectAfterRotatingRect: (CGRect) rect toAngle: (float) radians
{
    CGAffineTransform xfrm = CGAffineTransformMakeRotation(radians);
    CGRect result = CGRectApplyAffineTransform (rect, xfrm);

    return result;
} 
```

如果您的操作系统可以为您完成所有艰苦的工作，那就顺其自然吧！:)

迅速：

```
func boundingRectAfterRotatingRect(rect: CGRect, toAngle radians: CGFloat) -> CGRect {
    let xfrm = CGAffineTransformMakeRotation(radians)
    return CGRectApplyAffineTransform (rect, xfrm)
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-03-08T18:47:47.077

MarkusQ 概述的方法非常有效，但请记住，如果您已经有 A 点，则不需要转换其他三个角。

另一种更有效的方法是测试您的旋转角度在哪个象限，然后简单地直接计算答案。这更有效，因为您只有两个 if 语句（检查角度）的最坏情况，而另一种方法的最坏情况是 12 个（在检查其他三个角以查看它们是否大于当前时，每个组件 6 个）最大值或小于当前最小值）我认为。

基本算法仅使用毕达哥拉斯定理的一系列应用，如下所示。我用 theta 表示旋转角度，并用度数表示检查，因为它是伪代码。

```
ct = cos( theta );
st = sin( theta );

hct = h * ct;
wct = w * ct;
hst = h * st;
wst = w * st;

if ( theta > 0 )
{
    if ( theta < 90 degrees )
    {
        // 0 < theta < 90
        y_min = A_y;
        y_max = A_y + hct + wst;
        x_min = A_x - hst;
        x_max = A_x + wct;
    }
    else
    {
        // 90 <= theta <= 180
        y_min = A_y + hct;
        y_max = A_y + wst;
        x_min = A_x - hst + wct;
        x_max = A_x;
    }
}
else
{
    if ( theta > -90 )
    {
        // -90 < theta <= 0
        y_min = A_y + wst;
        y_max = A_y + hct;
        x_min = A_x;
        x_max = A_x + wct - hst;
    }
    else
    {
        // -180 <= theta <= -90
        y_min = A_y + wst + hct;
        y_max = A_y;
        x_min = A_x + wct;
        x_max = A_x - hst;
    }
} 
```

这种方法假设您拥有您所说的，即点 A 和位于 [-180, 180] 范围内的 theta 值。我还假设 theta 沿顺时针方向增加，因为这就是图表中旋转 30 度的矩形似乎表明您正在使用的东西，我不确定右边的部分试图表示什么。如果这是错误的方法，那么只需交换对称条款以及 st 条款的符号。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-10-06T02:38:49.550

```
 fitRect: function( rw,rh,radians ){
            var x1 = -rw/2,
                x2 = rw/2,
                x3 = rw/2,
                x4 = -rw/2,
                y1 = rh/2,
                y2 = rh/2,
                y3 = -rh/2,
                y4 = -rh/2;

            var x11 = x1 * Math.cos(radians) + y1 * Math.sin(radians),
                y11 = -x1 * Math.sin(radians) + y1 * Math.cos(radians),
                x21 = x2 * Math.cos(radians) + y2 * Math.sin(radians),
                y21 = -x2 * Math.sin(radians) + y2 * Math.cos(radians), 
                x31 = x3 * Math.cos(radians) + y3 * Math.sin(radians),
                y31 = -x3 * Math.sin(radians) + y3 * Math.cos(radians),
                x41 = x4 * Math.cos(radians) + y4 * Math.sin(radians),
                y41 = -x4 * Math.sin(radians) + y4 * Math.cos(radians);

            var x_min = Math.min(x11,x21,x31,x41),
                x_max = Math.max(x11,x21,x31,x41);

            var y_min = Math.min(y11,y21,y31,y41);
                y_max = Math.max(y11,y21,y31,y41);

            return [x_max-x_min,y_max-y_min];
        } 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-25T09:41:37.340

如果您使用的是 GDI+ ，您可以创建一个新的 GrpaphicsPath -> 向其添加任何点或形状 -> 应用旋转变换 -> 使用 GraphicsPath.GetBounds() ，它将返回一个限制旋转形状的矩形。

### （编辑）VB.Net 示例

```
Public Shared Sub RotateImage(ByRef img As Bitmap, degrees As Integer)
' http://stackoverflow.com/questions/622140/calculate-bounding-box-coordinates-from-a-rotated-rectangle-picture-inside#680877
'
Using gp As New GraphicsPath
  gp.AddRectangle(New Rectangle(0, 0, img.Width, img.Height))

  Dim translateMatrix As New Matrix
  translateMatrix.RotateAt(degrees, New PointF(img.Width \ 2, img.Height \ 2))
  gp.Transform(translateMatrix)

  Dim gpb = gp.GetBounds

  Dim newwidth = CInt(gpb.Width)
  Dim newheight = CInt(gpb.Height)

  ' http://www.codeproject.com/Articles/58815/C-Image-PictureBox-Rotations
  '
  Dim rotatedBmp As New Bitmap(newwidth, newheight)

  rotatedBmp.SetResolution(img.HorizontalResolution, img.VerticalResolution)

  Using g As Graphics = Graphics.FromImage(rotatedBmp)
    g.Clear(Color.White)
    translateMatrix = New Matrix
    translateMatrix.Translate(newwidth \ 2, newheight \ 2)
    translateMatrix.Rotate(degrees)
    translateMatrix.Translate(-img.Width \ 2, -img.Height \ 2)
    g.Transform = translateMatrix
    g.DrawImage(img, New PointF(0, 0))
  End Using
  img.Dispose()
  img = rotatedBmp
End Using 
```

结束子

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-18T00:30:43.997

尽管 Code Guru 说明了 GetBounds() 方法，但我注意到问题被标记为 as3, flex，所以这里有一个 as3 片段来说明这个想法。

```
var box:Shape = new Shape();
box.graphics.beginFill(0,.5);
box.graphics.drawRect(0,0,100,50);
box.graphics.endFill();
box.rotation = 20;
box.x = box.y = 100;
addChild(box);

var bounds:Rectangle = box.getBounds(this);

var boundingBox:Shape = new Shape();
boundingBox.graphics.lineStyle(1);
boundingBox.graphics.drawRect(bounds.x,bounds.y,bounds.width,bounds.height);
addChild(boundingBox); 
```

我注意到有两种方法似乎做同样的事情：getBounds() 和 getRect()

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-02-20T21:02:01.093

```
/**
     * Applies the given transformation matrix to the rectangle and returns
     * a new bounding box to the transformed rectangle.
     */
    public static function getBoundsAfterTransformation(bounds:Rectangle, m:Matrix):Rectangle {
        if (m == null) return bounds;

        var topLeft:Point = m.transformPoint(bounds.topLeft);
        var topRight:Point = m.transformPoint(new Point(bounds.right, bounds.top));
        var bottomRight:Point = m.transformPoint(bounds.bottomRight);
        var bottomLeft:Point = m.transformPoint(new Point(bounds.left, bounds.bottom));

        var left:Number = Math.min(topLeft.x, topRight.x, bottomRight.x, bottomLeft.x);
        var top:Number = Math.min(topLeft.y, topRight.y, bottomRight.y, bottomLeft.y);
        var right:Number = Math.max(topLeft.x, topRight.x, bottomRight.x, bottomLeft.x);
        var bottom:Number = Math.max(topLeft.y, topRight.y, bottomRight.y, bottomLeft.y);
        return new Rectangle(left, top, right - left, bottom - top);
    } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-07T17:19:45.143

将旋转矩阵应用于您的角点。然后分别使用获得的 x,y 坐标的最小值/最大值来定义新的边界框。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-09-19T01:57:39.043

这是我的开源库中的三个函数。这些函数在 Java 中经过全面测试，但公式可以很容易地翻译成任何语言。

签名是：

public static float getAngleFromPoint(final Point centerPoint, final Point touchPoint)

公共静态浮动 getTwoFingerDistance（浮动 firstTouchX，浮动 firstTouchY，浮动 secondTouchX，浮动 secondTouchY）

Point getPointFromAngle（最终双角，最终双半径）

该解决方案假设像素密度是均匀分布的。在旋转对象之前，请执行以下操作：

1.  使用 getAngleFromPoint 计算从中心到右上角的角度（假设返回 20 度），这意味着左上角是 -20 度或 340 度。

2.  使用 getTwoFingerDistance 返回中心点和右上角之间的对角线距离（这个距离显然应该对所有角都相同，这个距离将在下一次计算中使用）。

3.  现在假设我们将对象顺时针旋转 30 度。我们现在知道右上角必须是 50 度，左上角是 10 度。

4.  您现在应该可以使用左上角和右上角的 getPointFromAngle 函数了。使用从步骤 2 返回的半径。从右上角乘以 2 的 X 位置应该给你新的宽度，从左上角的 Y 位置乘以 2 应该给你新的高度。

上述 4 个步骤应根据您旋转对象的距离来设置，否则您可以将高度作为宽度返回，将宽度作为高度返回。

请记住，角度函数以 0-1 而不是 0-360 的因数表示（只需在适当的情况下乘以或除以 360）：

//从两点获取角度，表示为 0 -1 的因数（0 表示 0/360，0.25 表示 90 度等）

```
public float getAngleFromPoint(final Point centerPoint, final Point touchPoint) {

    float returnVal = 0;

    //+0 - 0.5
    if(touchPoint.x > centerPoint.x) {

        returnVal = (float) (Math.atan2((touchPoint.x - centerPoint.x), (centerPoint.y - touchPoint.y)) * 0.5 / Math.PI);

    }
    //+0.5
    else if(touchPoint.x < centerPoint.x) {

        returnVal = (float) (1 - (Math.atan2((centerPoint.x - touchPoint.x), (centerPoint.y - touchPoint.y)) * 0.5 / Math.PI));

    }//End if(touchPoint.x > centerPoint.x)

    return returnVal;

} 
```

//测量两点之间的对角线距离

```
public float getTwoFingerDistance(final float firstTouchX, final float firstTouchY, final float secondTouchX, final float secondTouchY) {

    float pinchDistanceX = 0;
    float pinchDistanceY = 0;

    if(firstTouchX > secondTouchX) {

        pinchDistanceX = Math.abs(secondTouchX - firstTouchX);

    }
    else if(firstTouchX < secondTouchX) {

        pinchDistanceX = Math.abs(firstTouchX - secondTouchX);

    }//End if(firstTouchX > secondTouchX)

    if(firstTouchY > secondTouchY) {

        pinchDistanceY = Math.abs(secondTouchY - firstTouchY);

    }
    else if(firstTouchY < secondTouchY) {

        pinchDistanceY = Math.abs(firstTouchY - secondTouchY);

    }//End if(firstTouchY > secondTouchY)

    if(pinchDistanceX == 0 && pinchDistanceY == 0) {

        return 0;

    }
    else {

        pinchDistanceX = (pinchDistanceX * pinchDistanceX);
        pinchDistanceY = (pinchDistanceY * pinchDistanceY);
        return (float) Math.abs(Math.sqrt(pinchDistanceX + pinchDistanceY));

    }//End if(pinchDistanceX == 0 && pinchDistanceY == 0)

} 
```

//从给定半径的角度获取XY坐标（角度以0-1 0表示0/360度，0.75表示270等）

```
public Point getPointFromAngle(final double angle, final double radius) {

    final Point coords = new Point();
    coords.x = (int) (radius * Math.sin((angle) * 2 * Math.PI));
    coords.y = (int) -(radius * Math.cos((angle) * 2 * Math.PI));

    return coords;

} 
```

这些代码片段来自我的开源库：[https](https://bitbucket.org/warwick/hgdialrepo) ://bitbucket.org/warwick/hgdialrepo和[https://bitbucket.org/warwick/hacergestov2](https://bitbucket.org/warwick/hacergestov2)。一个是安卓的手势库，另一个是安卓的拨号控件。还有一个拨号控件的 OpenGLES 2.0 实现：[https ://bitbucket.org/warwick/hggldial](https://bitbucket.org/warwick/hggldial)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-07T17:12:55.893

我不确定我是否理解，但复合变换矩阵将为您提供所有相关点的新坐标。如果您认为矩形可能会溢出变换后的可成像区域，请应用剪切路径。

如果您不熟悉矩阵的确切定义，请查看[此处](http://en.wikipedia.org/wiki/Transformation_matrix#Examples_in_2D_graphics)。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-04-27T10:04:46.450

我使用区域首先旋转矩形，然后使用该旋转区域来检测该矩形

```
 r = new Rectangle(new Point(100, 200), new Size(200, 200));         
        Color BorderColor = Color.WhiteSmoke;
        Color FillColor = Color.FromArgb(66, 85, 67);
        int angle = 13;
        Point pt = new Point(r.X, r.Y);
        PointF rectPt = new PointF(r.Left + (r.Width / 2),
                               r.Top + (r.Height / 2));
       //declare myRegion globally 
        myRegion = new Region(r);

        // Create a transform matrix and set it to have a 13 degree

        // rotation.
        Matrix transformMatrix = new Matrix();
        transformMatrix.RotateAt(angle, pt);

        // Apply the transform to the region.
        myRegion.Transform(transformMatrix);
        g.FillRegion(Brushes.Green, myRegion);
        g.ResetTransform(); 
```

现在检测那个矩形

```
 private void panel_MouseMove(object sender, MouseEventArgs e)
    {

        Point point = e.Location;
        if (myRegion.IsVisible(point, _graphics))
        {
            // The point is in the region. Use an opaque brush.
            this.Cursor = Cursors.Hand;
        }
        else {
            this.Cursor = Cursors.Cross;
        }

    } 
```

# sockets - 如何在 Silverlight 2 中使用套接字？

> ID：622141
> 
> 赞同：1
> 
> 时间：2009-03-07T17:03:56.880
> 
> 标签：sockets, silverlight-2.0

我正在尝试实现一个 Silverlight 2 客户端应用程序，该应用程序通过基于套接字的通信从服务器获取数据。

我听说在 Silverlight 2 中，这个过程更加复杂，因为它需要使用策略服务器，这可能会减慢我的应用程序，更不用说通过套接字的每个字符串都必须是与策略服务器核对。

我想知道是否确实如此，以及编写服务器是否将是一项艰巨的任务。您建议使用 Silverlight 1 吗？我知道在 Silverlight 1 中，套接字通信必须在 ASP.NET 中完成。我的目标是在 C# 中完成客户端逻辑，但使用 Silverlight 1，我相信我只能使用 Javascript 并与 ASP.NET 进行通信......

感谢您的回复！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T17:31:37.627

根据文档，您可以使用套接字连接到立即下载 Silverlight 应用程序的服务器。如果您需要使用套接字连接到另一台服务器，则需要提供一个策略文件。
[此 MSDN 文章](http://msdn.microsoft.com/en-us/library/cc645032(VS.95).aspx)介绍了如何创建策略文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T20:05:38.893

我想了一下，我将使用 ASP.NET 通过套接字与服务器连接，然后使用 WebClient 访问连接到 Web 服务器，因为它是源站点，所以不需要任何策略。我仍然需要构建一个提供与 SL 2 客户端类似功能的 html 页面，所以这没什么大不了的。

# file - 文件签名：如何确保 Windows DLL 未被修改？

> ID：622147
> 
> 赞同：3
> 
> 时间：2009-03-07T17:05:34.257
> 
> 标签：file, signature, verify

[我曾经在这里](https://stackoverflow.com/questions/386066/are-windows-dlls-signed-by-microsoft-can-i-detect-if-theyve-been-tampered-with)问过一个问题，如果 Windows DLL 是由 Microsoft 签名的。我意识到是这样，一位好朋友告诉我，[SigCheck](http://technet.microsoft.com/en-us/sysinternals/bb897441.aspx)实用程序可以提供有关文件签名的信息；但还有一个问题：

虽然 SigCheck 会告诉我文件是否已签名，但我需要确保 Microsoft 签署了该文件，并且以后没有其他人更改它。我的意思是，如果有人篡改了文件，然后再次对文件进行签名（当然是在签名上使用 Microsoft 的名称）怎么办？

我怎样才能绝对确定该文件是真实的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T17:09:09.723

> “我的意思是，如果有人篡改了文件，然后再次对文件进行签名（当然是在签名上使用 Microsoft 的名称）怎么办？”

由于数字签名的性质，这是不可能的。为了生成数字签名，Microsoft 对文件进行了哈希处理，然后使用他们的私钥（只有他们知道）对该哈希进行加密。据我了解，其他供应商将使用Windows 配置为默认信任的[其他证书颁发机构的私钥。](http://support.microsoft.com/kb/931125)

当 Windows 检查文件时，它使用相应的公钥解密签名。然后将该签名与当前签名进行比较。如果它们匹配，则该文件来自 Microsoft。如果它们不匹配，则文件已被篡改。

因此，使文件看起来像是被微软“签名”的唯一方法就是窃取他们的私钥。阅读[Wikipedia 上的数字签名文章](http://en.wikipedia.org/wiki/Digital_signature)。

有关该过程实际如何工作的更多详细信息，请阅读MSDN 上的[“使用 Authenticode 签名和检查代码”](http://msdn.microsoft.com/en-us/library/ms537364(VS.85).aspx)和[“代码签名简介” 。](http://msdn.microsoft.com/en-us/library/ms537361.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T17:18:29.733

从记忆中，签名过程使用[公钥密码术](http://en.wikipedia.org/wiki/Public-key_cryptography)。

来自维基百科的[这张图表最好地解释了这个过程。](http://en.wikipedia.org/wiki/File:Digital_Signature_diagram.svg)

总之，

> “使用发件人的私钥签名的消息可以由有权访问发件人公钥的任何人验证，从而证明发件人有权访问私钥（因此很可能是与使用的公钥相关联的人） ，以及消息中未被篡改的部分。”

IE。Sigcheck 使用 Microsoft 的公钥对之前使用 Microsoft 的私钥签名的文件执行验证（当然只有 Microsoft 可以访问私钥）。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-07T18:53:09.397

以其他人已经发布的内容为基础：

*免责声明：MS 使用公钥/私钥术语 wrt 数字签名曾经让我很困惑。我刚刚有一个“啊哈！” 片刻。我会尝试分享我的想法，以防它对某人有所帮助。*

**输入 PPK**

* * *

一般的公钥-私钥方案通过生成一对不对称的密钥来工作。你不能从另一个中推导出一个（通过可行的方式）。其中一个称为私钥，另一个称为公钥。

对于一对多通信，您将保留私钥并共享公钥。想要与您共享文档的朋友将使用您的公钥对其进行签名。您将使用您的私钥解密这些。请注意，您保留哪个特定密钥以及分发哪个密钥并不重要。只是不要同时放弃。

**为什么 DigSig 不同？**

* * *

数字签名有点奇怪。这是一个多对一的情况。继续前面的示例：想想您想与朋友共享文档的情况。您需要对它们进行签名，即加密，而您的朋友需要能够解密。因此，您仍然共享您的公钥，但使用您的公钥签名并将其发送出去。你的朋友已经有了这个密钥，他们很乐意解密。在这种情况下，*您的公钥*充当私钥，而*您的私钥*充当公钥。

以上是 MS 对其 dll 所做的事情。

**客户端验证**

* * *

现在，对于验证部分。MS 生成的证书在证书颁发机构说它是好的之前是无效的。这适用于任何人。如果您想安全地开展业务，您必须从 CA 获得证书。*一旦您的客户端安装了您的应用程序，操作系统的验证程序就会提取您的证书，并通过验证称为信任链的*东西对其进行测试。它将检查谁认证了您的签名。这是父母证明。如果系统可以识别父母，他们就完成了，你被接受了。然而，如果无法验证父级，则调用父级的父级。并且链继续，直到可以找到可以验证的节点。如果没有找到节点，他们会将其报告为未签名、不安全。

请注意，证书可以被吊销。所以，证书并不意味着你很好。这是验证过程变得重要的另一个原因。

# python - Python 反射和类型转换

> ID：622161
> 
> 赞同：7
> 
> 时间：2009-03-07T17:15:41.097
> 
> 标签：python, reflection, type-conversion, introspection, python-datamodel

在 Python 中，str()、int()、float() 等函数通常用于执行类型转换。但是，这些要求您在开发时知道要转换为哪种类型。我正在尝试编写的一些 Python 代码的子问题如下：

给定两个变量`foo`和`bar`，找出 的类型`foo`。（在开发时不知道，因为这是通用代码。）然后，尝试转换`bar`为任何类型`foo`。如果无法做到这一点，则抛出异常。

例如，假设您调用了执行此操作的函数`conv`。它的签名看起来像

```
def conv(foo, bar) :
    # Do stuff. 
```

它会被称为：

```
result = conv(3.14, "2.718")  # result is now 2.718, as a float. 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-07T17:57:32.010

那将是最好的：

```
type(foo)(bar) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-07T17:21:42.800

用于`foo.__class__`获取`foo`. 然后调用它将 bar 转换为 foo 的类型：

```
def conv(foo, bar) :
    return foo.__class__(bar) 
```

当然，这只有在类型`foo`有一个知道如何转换 bar 的构造函数时才有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-05T19:50:20.217

```
type(foo) 
```

绝对是最好的，如果你想检查一个类型，那么“类型”是最好的方法，我的`python 2.7 - 3.2.2, type()`工作很完美。

# winapi - 用于访问文件信息（标题、主题、作者）的 COM 接口？

> ID：622167
> 
> 赞同：0
> 
> 时间：2009-03-07T17:18:38.390
> 
> 标签：winapi, file, shell, properties

在 NTFS 上，任何文件都可以具有基于备用数据流的扩展文件信息。资源管理器将其显示为文件属性对话框中的选项卡。我很确定有一个用于读取/修改此信息的 COM 接口，但我似乎无法为我的搜索找到正确的术语。

谁能给我一个简短的指针？提前致谢！

最好的问候，马丁

![截屏](https://www.dont-panic.cc/capi/files/stackoverflow/file-properties-screenshot.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T17:29:47.943

我不认为备用数据流用于此目的。它更有可能基于微软所谓的[结构化存储](http://msdn.microsoft.com/en-us/library/aa380369%28VS.85%29.aspx)（以前称为[复合文件二进制格式](http://en.wikipedia.org/wiki/Compound_File_Binary_Format)）。

# asp.net-mvc - N2 MVC 控制器动作缓存？

> ID：622174
> 
> 赞同：0
> 
> 时间：2009-03-07T17:22:25.213
> 
> 标签：asp.net-mvc, caching, n2

[将N2](http://www.codeplex.com/n2)与 MVC 一起使用时，我遇到了一个非常奇怪的问题。它似乎与事物的 N2 方面有关，因为它不会发生在我编写测试的纯 MVC 唯一应用程序中。基本上，当从页面中调用控制器操作时，如果控制器操作参数被多次调用，它们的行为就好像它们被缓存了一样。

例如，我有包含评论的文章。如果用户希望添加评论，则调用 CommentController 的 AddComment 操作方法。用户第一次添加评论时，效果很好。但是，对于同一路由路径的每次后续调用，使用一组不同的参数（即 - 有人提出另一个不同的评论），最终传递给 AddComment 操作的参数与第一次完全相同叫。

阻止这种情况的唯一方法是基本上杀死应用程序并重新启动它。然后，当有人像以前一样添加评论时，它会正常工作，但所有后续评论最终都是一样的。我完全不知道为什么会发生这种情况。

有没有人知道为什么会这样？

非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T08:12:42.923

终于找到了答案。我们一直在使用 Castle 来处理依赖关系，并且没有将任何控制器设置为瞬态的。嗬！

# gtk - pygtk中按钮的定时禁用

> ID：622177
> 
> 赞同：1
> 
> 时间：2009-03-07T17:25:00.403
> 
> 标签：gtk, pygtk

我想显示一个带有“确定”按钮的对话框，该按钮在短时间内（可能 5 秒）被禁用。在此期间，其他按钮仍需要响应。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T17:56:09.377

为此，您需要 GTK+ 超时。首先让按钮被禁用。超时将调用一个函数来启用按钮。

请注意，出于可用性原因，用户应该可以看到计时器正在运行。您可以通过倒计时来执行此操作，例如“OK (5)”、“Ok (4)”等，直到您启用该按钮。

见这里： http: [//graphics.sci.ubu.ac.th/api/pygtk/tutorials/pygtk2tutorial/ch-TimeoutsIOAndIdleFunctions.html](http://graphics.sci.ubu.ac.th/api/pygtk/tutorials/pygtk2tutorial/ch-TimeoutsIOAndIdleFunctions.html)

这个想法是将超时设置为 1 秒（1000 毫秒）。每次调用回调时，您都会更改按钮标签并返回 TRUE。当您的回调被第 5 次调用时，您启用它并返回 FALSE。这将消除超时。

# apache-flex - 如何在 Vbox 中拖放画布以重新排序？

> ID：622178
> 
> 赞同：0
> 
> 时间：2009-03-07T17:25:44.037
> 
> 标签：apache-flex, actionscript-3

我正在加快使用 Flex 的速度，我正在寻找在 vbox 容器中实现拖放重新排序的任何示例。基本上我有一个 Vbox，其中包含许多全宽和 35px 高的画布。我希望能够拖放它们以在 vbox 中重新排序。

非常感谢任何帮助 - 谢谢，

b

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-07T17:58:36.220

如果我是你，我会首先查看在线提供的 Flex 文档。有[这个](http://livedocs.adobe.com/flex/3/html/help.html?content=dragdrop_7.html)例子。您必须为列表控件的 itemeditor 自定义此项。还有另一个[例子](http://livedocs.adobe.com/flex/3/html/help.html?content=dragdrop_4.html)，你应该看看。如果您有问题，请告诉我们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T20:04:31.577

您是否尝试过使用 mx:List - 拖放支持已经内置并且非常易于使用 - 我使用您提到的尺寸为您整理了一个示例：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" creationComplete="init()">

    <mx:Script>
        <![CDATA[
            import mx.controls.Alert;
            import mx.events.DragEvent;
            import mx.collections.ArrayCollection;

            [Bindable]
            private var _source:ArrayCollection = new ArrayCollection();

            private function init():void{

                var n:int = 10;
                for(var i:int = 0; i < n; i++){ _source.addItem({value:Math.random()}); }

            }

            private function handleReorder(event:DragEvent):void{

                Alert.show("A change was made!");

            }

        ]]>
    </mx:Script>

    <mx:List dataProvider="{_source}" width="250" height="500" dragMoveEnabled="true" 
             dragEnabled="true" dropEnabled="true" dragDrop="handleReorder(event)">
        <mx:itemRenderer>
            <mx:Component>
                <mx:Canvas width="100%" height="35">
                    <mx:Text text="{data.value}" width="100%" height="100%" selectable="false" />
                </mx:Canvas>
            </mx:Component>
        </mx:itemRenderer>
    </mx:List>

</mx:Application> 
```

当然还有更多信息：http: [//livedocs.adobe.com/flex/3/langref/mx/controls/List.html](http://livedocs.adobe.com/flex/3/langref/mx/controls/List.html)

祝你好运！

# ruby-on-rails - 向许多模型添加评论的最佳实践是什么？

> ID：622181
> 
> 赞同：4
> 
> 时间：2009-03-07T17:29:13.887
> 
> 标签：ruby-on-rails, database-design

嗨 Stack Overflowers：我正在构建一个 Ruby on Rails 应用程序，它有几个不同的模型（例如电影、歌曲、照片），我正在存储电影剪辑、mp3 和照片。我希望用户能够对这些模型中的任何一个发表评论，并控制发布哪些评论。

创建评论模型的最佳实践是：

```
belongs_to :movie
belongs_to :song
belongs_to :photo 
```

然后将每个模型与：

```
has_many :comments 
```

然后，我猜在 Comment 表中，我需要每个模型的外键：

```
comment, movie_id, song_id, photo_id 
```

这是构建这样的东西的正确方法，还是有更好的方法？在此先感谢您的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T17:56:39.937

使用[`acts_as_commentable`](http://www.juixe.com/techknow/index.php/2006/06/18/acts-as-commentable-plugin/). 它创建一个带有`commentable_type`（被评论项目的模型名称）和`commentable_id`（模型的 ID）的评论表。然后你需要在你的模型中做所有事情：

```
class Photo < ActiveRecord::Base
  acts_as_commentable
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T20:24:18.670

我个人会这样建模：

```
Media table (media_id, type_id, content, ...)
.
MediaType table (type_id, description, ... )
.
MediaComments table ( comment_id, media_id, comment_text, ...) 
```

毕竟，歌曲、电影或照片之间的数据库没有区别。这只是二进制数据。使用此模型，您可以添加新的“媒体类型”而无需重新编码。添加新的“MediaType”记录，折腾Media表中的数据。

这样灵活得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T18:06:55.793

创建一个表来保存每种评论类型的关系：

```
movie_comments, song_comments, photo_comments 
```

然后使用：

```
class Movie < ActiveRecord::Base

  has_many :movie_comments
  has_many :comments, :through => :movie_comments

end

class MovieComment < ActiveRecord::Base
  include CommentRelationship
  belongs_to :comment
  belongs_to :movie
end 
```

您可以使用模块 (CommentRelationship) 来保存关系表 (movie_comments) 之间的所有常见功能

这种方法允许灵活地根据类型以不同的方式处理您的评论，同时允许每个评论之间具有相似的功能。此外，您不会在每列中得到大量的 NULL 条目：

```
comment            | movie_id | photo_id | song_id
----------------------------------------------------
Some comment            10         null      null
Some other comment     null        23        null 
```

这些空值绝对是您应该以不同方式构建数据库的标志。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T20:11:01.463

最好的办法可能是按照 Sarah 的建议去做，并使用现有的处理评论的插件之一。

如果你想自己动手，或者只是了解幕后发生的事情，你需要阅读单表继承，Rails 处理继承的方式。基本上，你需要一个单`comments`表ala：

```
# db/migrate/xxx_create_comments
create_table :comments do |t|
  t.string :type, :null => false
  t.references :movies, :songs, :photos
end 
```

现在您可以将您的评论类型定义为

```
class Comment < ActiveRecord::Base
  validates_presence_of :body, :author
  # shared validations go here
end

class SongComment < Comment
  belongs_to :song
end

class MovieComment < Comment
  belongs_to :movie
end

class PhotoComment < Comment
  belongs_to :photo
end 
```

您的所有评论都将存储在一个表中`comments`，但`PhotoComment.all`仅返回`type == "Photo"`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T17:39:57.577

我没有 RoR 经验，但在这种情况下，您最好在数据库级别使用继承，假设您的 dbms 支持：

```
CREATE TABLE item (int id, ...);
CREATE TABLE movie (...) INHERITS (item);
CREATE TABLE song (...) INHERITS (item);
[...]
CREATE TABLE comments (int id, int item_id REFERENCES item(id)); 
```

另一种方法可能是具有类型列的单个表：

```
CREATE TABLE item (int id, int type...);
CREATE TABLE comments (int id, int item_id REFERENCES item(id)); 
```

如前所述，我无法告诉您如何使用 RoR 准确地实现这一点。

# c# - .Net 远程处理与 WCF

> ID：622190
> 
> 赞同：14
> 
> 时间：2009-03-07T17:34:40.427
> 
> 标签：c#, wcf, performance, remoting

我正在开发一个 .Net 网站，该网站将拥有 1000 多个并发用户。

我正在考虑将业务组件保留在应用服务器上，将 UI 组件保留在 Web 服务器上。数据库 (MS SQL Server 2005) 将托管在另一台服务器上。我也打算使用负载平衡。

鉴于此，如果我想获得最佳的应用程序性能和可扩展性，从 Web 服务器到应用程序服务器的最佳通信方式是什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-07T17:47:45.373

您可以[在此处](http://msdn.microsoft.com/en-us/library/bb310550.aspx)查看WCF 与其他通信技术（包括 .Net 远程处理）之间的性能比较。结论是：WCF 更快。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-07T17:42:03.390

.NET 远程处理或多或少已被“弃用”，它已被溶解到 WCF 中。所以这不是一个非此即彼的问题。我想你应该问：什么样的 WCF（绑定）或者是否有其他选择。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-07T17:53:10.540

我们在高流量站点上使用带有硬件负载平衡的 net.tcp 绑定。它似乎工作得很好，我们没有遇到任何问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-30T22:21:42.163

我有一个项目使用 2 台应用程序服务器和 2 台前端服务器加上负载平衡：完全没有问题。像一个想法一样快速运行。

我公司的另一个团队正在使用相同的基础架构。他们有很多问题……特别是安全问题！

# php - PHP 警告：标头已在未知中发送

> ID：622192
> 
> 赞同：9
> 
> 时间：2009-03-07T17:35:23.593
> 
> 标签：php, error-reporting

我正在寻找可能触发以下 PHP 警告的内容：

> PHP 警告：无法修改标头信息 - 标头已在第 0 行的未知中发送

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-07T20:19:29.300

原来是这条线

```
ob_start("ob_gzhandler"); 
```

导致警告。这似乎已在 2001 年报告并修复，但由于某种原因，它不断出现。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T17:39:30.633

我认为发生的事情是内置的 php 函数之一正在输出一些东西。我已经在几个 IMAP 函数中看到了这一点，它们只放了一个“”（空格字符），它把事情搞砸了。您可以尝试使用 Xdebug 或 Zend 调试器对其进行跟踪，但如果您都没有尝试将输出缓冲包装在您认为可能导致它的某些函数周围。

```
ob_start();
callYourFunction();
ob_end_clean(); 
```

一次执行一个功能，当错误消失时，您将知道哪个功能导致您出现问题，然后您可以提交错误报告或将其作为 hack 保留。但至少你知道是什么功能导致了这个问题。

**编辑：说你的输出发生在第 0 行的事实意味着它是一个 C 级函数执行输出，而不是任何使用 PHP 编写的代码。**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-07T18:06:59.320

可能有很多东西，但正如其他人所说，它通常只是某个地方的一个空间，它被输出，然后[`header()`](http://www.php.net/header)发送一个命令，这通常很好，但在开始发回内容之后（可能只是一个空间）这个案例）。

使用[`ob_start()`](http://www.php.net/ob_start)通过缓冲它来阻止输出立即消失。因此，这是一个潜在的解决方案，或者至少可以像[zodeus 所说](https://stackoverflow.com/questions/622192/php-warning-headers-already-sent-in-unknown/622199#622199)的那样诊断它的来源。

* * *

在这种情况下，导致这些丢失空间的一个常见原因是。

**全局.php**

```
<?php
  $variable = 1;
  $database = 'something else';
?> <-- A space here
 <-- Or here 
```

**索引.php**

```
<?php

  require('global.php');
  $var = dosomething();
  header('Location: http://www.example.com/');

?> 
```

解决此问题的一种方法是删除 global.php 文件末尾的 ?> 。您不需要这些，它们仅在您开始将 HTML 例如放在 PHP 代码之后才有用。所以你会有：

```
<?php
  $variable = 1;
  $database = 'something else'; 
```

而当你做的时候`require()`，之前的空格是不会输出的`header()`。

* * *

只是为了说明输出的内容和标题的问题是其他常见的情况，它给出了类似的错误。当您使用重定向后忘记停止处理时，就会发生这种情况`header()`。

```
if ($notLoggedIn) {
  header('Location: http://www.example.com/login.php');
}
echo 'Welcome to my website'; // this will be outputted, 
                              // you should have an exit() 
                              // right after the header() 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T17:40:19.633

您是否检查过文件中是否存在意外[的 UTF-8 BOM](http://en.wikipedia.org/wiki/Byte-order_mark#Representations_of_byte_order_marks_by_encoding)？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T20:06:32.123

该错误告诉您某些内容已发送输出，这将强制发送标头，因为标头必须写在 http 消息正文之前。

我发现最常见的问题是标题中的文本。可见：

```
<?php // myfile.php
  include 'header.php';
?> 
```

在 header.php 中：

```
<?php // header.php
   ....
 ?> 
```

您在这里看不到的是有一个空白 - 在结束“ `?>`”之后有一个空格或 CR/LF。这是输出，因为 php 标准规定 php 标记之外的任何内容都输出为 html。

解决方案是确保您确保在关闭 ' `?>`'后擦除所有内容

# c++ - 在 .lib 中调用函数时出现问题

> ID：622210
> 
> 赞同：3
> 
> 时间：2009-03-07T17:50:09.390
> 
> 标签：c++, virtual

我有一个带有静态方法的类，大致如下：

```
class X {
    static float getFloat(MyBase& obj) {
        return obj.value();  // MyBase::value() is virtual
    }
}; 
```

我用 MyDerived 的一个实例来调用它，它是 MyBase 的子类：

```
MyDerived d;
float f = X::getFloat(d); 
```

如果我将包含 X 的 obj 文件链接到我的可执行文件中，一切都会按预期工作。如果我期望得到 3.14，我明白了。

如果我创建一个包含 X.obj 文件并在 .lib 中链接的 .lib，它会中断。当我调用 getFloat() 时，它返回**-1.#IND00**。这是某种类型的哨兵值，应该告诉我这里出了什么问题吗？

当您在 lib 中链接而不是直接在 obj 中链接时，有什么不同吗？

我没有收到任何编译器警告或错误。

**编辑：**
我在 Windows XP Pro SP3 上使用 Visual Studio 2005。为了确保我没有链接旧文件，我将 value() 方法克隆到一个新的 value2() 方法中并改为调用它。行为是一样的。

**编辑#2：**
因此，如果我使用调试器跟踪调用，我发现它根本不会进入我的 value() 方法。相反，它进入了一种不同的（不相关的）方法。这让我觉得我的 vtable 已损坏。我认为我看到的行为一定是其他问题的副作用。

* * *

**解决了！**（感谢弗拉德）
事实证明我违反了单一定义规则（ODR），尽管从我发布的代码中并不明显。[这](http://blogs.msdn.com/vcblog/archive/2007/05/17/diagnosing-hidden-odr-violations-in-visual-c-and-fixing-lnk2022.aspx)是来自 Visual C++ 人员的一篇很棒的文章，它解释了这个问题以及一种追踪它的方法。*/d1reportSingleClassLayout*编译器标志是一个很棒的学习工具。

当我在两个不同的项目中为 MyBase 和 MyDerived 倾倒我的类布局时，我发现调用代码和库代码之间存在差异。事实证明，我的头文件中有一些*#ifdef*块，相应的*#define*语句位于主项目的预编译头文件中，但不在子项目（库）中。我有没有提到我认为预处理器宏有多邪恶？

无论如何，我只是发布这些东西，因为它可能对其他人有帮助。[这个问题](https://stackoverflow.com/questions/302446/how-can-one-inspect-a-vtable-in-visual-c)对我也很有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T18:23:44.990

由于 lib 只是一个容器，如果您在两种情况下都链接相同的 .obj 文件，那么正如 Brian 所说，它们不应该（不能？）有区别。

需要注意的一件事是，如果您更改了 MyBase 的定义，您显然需要重新编译库和使用它的代码。例如，如果您在 value 方法之前向 MyBase 添加了一个新的虚拟方法，那么这会弄乱库，因为 value 的 v-table 偏移量会不同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T20:28:52.707

**当使用不同的类****定义`MyDerived`**编译 lib 和可执行文件时会出现此问题（即声明 . 的 // 文件`.h`的不同版本。完全清理并重建您的项目。除此之外，不同的编译器选项*可能*是负责任的，但这有点不太可能。`.hh``.hpp``MyDerived`

 *如果从头开始重建所有内容后问题仍然存在，则通过在库中实例化一个虚拟`MyDerived`对象来解决问题。`getFloat`使用调试器比较`vtable`dummy `MyDerived`（在库中实例化）和作为参数传递`vtable`的`MyDerived`对象引用（在可执行文件中实例化）。有些东西应该立即浮现在眼前。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T17:51:58.297

应该没有区别。只需确保您包含的 .h 文件与您要链接到的 .lib 完全对应。我怀疑您可能正在链接到旧的 .lib 文件。

如果您使用的是 Visual Studio，而不是显式指定 .lib 文件，只需右键单击项目并将依赖项设置为 .lib 项目。这样您就可以确保它使用正确的 .lib 文件。

# sql-server - SQL Server 2008 中的用户定义聚合 - 如何使用 MaxByteSize = -1 进行部署？

> ID：622218
> 
> 赞同：3
> 
> 时间：2009-03-07T17:58:07.190
> 
> 标签：sql-server, sql-server-2008, clr, user-defined-aggregate

[我在这里](http://www.halhayes.com/blog/PermaLink,guid,127faa81-511d-462f-9b48-3272142837f9.aspx)（和其他地方）读到，在 SQL Server 2008 中，可以构建一个用户定义的聚合，它可以返回一个超过 8000 个字符的字符串。这正是我所需要的。

据说，方法是将 maxByteSize 设置为 -1 而不是数字 btw 1 和 8000；这应该允许最大为 2GB 的任何大小。

显然，出于某种原因，如果使用此设置，则无法直接从 Visual Studio 2008 进行部署；所以你需要手动部署。

所以：我构建了我的项目——GroupConcat（它应该模拟 MySQL 的 group_concat 聚合器）——它在项目的 bin 文件夹中为我提供了一个文件“SqlClassLibrary.dll”。根据上述链接页面上的说明，我在 SQL Server 中构建程序集。命令执行成功。但是，当我尝试实际*使用*groupconcat 聚合器时：

**`select department, dbo.groupconcat(projectNumber) from projectleads group by department`**

...它说它找不到。如果我将 maxByteSize 设置为 8000 并直接从 VS2008 中部署，这一切都可以正常工作，但我需要 >8000。有人知道我在做什么错吗？

谢谢-丹

**注意：** 我确实需要一个 groupconcat 聚合函数，而不是使用一些我经常看到的 SQL Server 技巧。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-05-03T16:28:18.733

或者，您可以使用`MaxSize`属性`SqlFacetAttribute`来指示 varchar 大小。请注意，在下面的示例中，我将此属性应用于方法中的`SqlString`参数和`Accumulate`方法的返回值`Terminate`。这会产生以下 SQL 签名：

`AGGREGATE [dbo].[Concatenate] (@value nvarchar(max), @order int, @seperator nvarchar(max)) RETURNS nvarchar(max)`

```
[Serializable]
[SqlUserDefinedAggregate(
    Format.UserDefined,
    IsInvariantToOrder      = true,
    IsInvariantToNulls      = true,
    IsInvariantToDuplicates = false,
    IsNullIfEmpty           = false,
    MaxByteSize             = -1)]
public struct Concatenate : IBinarySerialize
{
    public void Init();

    public void Accumulate([SqlFacet(MaxSize = -1)] SqlString value,
                                                    SqlInt32  order,
                           [SqlFacet(MaxSize = -1)] SqlString seperator);

    public void Merge(Concatenate group);

    [return: SqlFacet(MaxSize = -1)]
    public SqlString Terminate();

    public void Read(BinaryReader r);

    public void Write(BinaryWriter w);
} 
```

我不知道这是否比你最终做的更“正确”，但它似乎更自然。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T12:43:53.393

想通了...在 Vis Studio 中构建解决方案后，假设我已将它创建的 .dll 放入 c:\temp 并将其命名为 GroupConcat.dll：

```
CREATE ASSEMBLY GroupConcat from 'C:\temp\GroupConcat.dll' with permission_set = safe
GO

CREATE AGGREGATE groupconcat(@input nvarchar(max))
RETURNS nvarchar(max)
EXTERNAL NAME GroupConcat
GO 
```

这样做。

# php - PHP：返回当前会话的生命周期

> ID：622220
> 
> 赞同：1
> 
> 时间：2009-03-07T17:59:26.093
> 
> 标签：php, session

我正在寻找一种方法来检查 PHP 会话的生命周期，并返回会话“活动”的秒数。

有没有我错过的 PHP 函数？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-07T18:06:09.727

您可以存储会话初始化的时间并返回该值：

```
session_start();
if (!isset($_SESSION['CREATED'])) {
    $_SESSION['CREATED'] = time();
} 
```

并从任意会话中检索该信息：

```
function getSessionLifetime($sid)
{
    $oldSid = session_id();
    if ($oldSid) {
        session_write_close();
    }
    session_id($sid);
    session_start();
    if (!isset($_SESSION['CREATED'])) {
        return false;
    }
    $created = $_SESSION['CREATED'];
    session_write_close();
    if ($oldSid) {
        session_id($oldSid);
        session_start();
    }
    return time() - $created;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T18:06:24.907

我认为有两个选择都不是很好，但他们在这里。

1）如果您有权访问文件系统，则可以检查会话文件的创建时间戳。

2）将创建时间存储在会话中，例如

```
session_start();
if( ! isset($_SESSION['generated'])) {
    $_SESSION['generated'] = time();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-07T18:05:23.160

您可以简单地将创建会话的时间戳存储在会话中

# .net - 什么是最好的 .NET 游戏开发框架？

> ID：622226
> 
> 赞同：11
> 
> 时间：2009-03-07T18:03:47.673
> 
> 标签：.net

[我曾涉足 Microsoft XNA 游戏开发框架，它看起来相当不错，只是想知道是否有人对 The Game Creators 的Dark GDK.NET](http://gdk.thegamecreators.com/?f=dgdk_net)或任何其他人有任何经验。

任何开始的建议都会很棒。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-07T18:11:10.590

我会说坚持XNA。它与VS很好地集成，它有很好的社区支持，你也可以为Xbox和社区游戏程序开发。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-08T06:34:50.787

查看[Unity3D](http://unity3d.com/)。它支持三种脚本语言：

*   JavaScript
*   C＃
*   [Boo](http://boo.codehaus.org/)（Python 的一种方言）

所有游戏逻辑都运行在开源 .NET 平台[Mono](http://mono-project.com/Main_Page)上。您的游戏可以在 Mac、Windows、Wii 甚至 iPhone 上运行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-07T18:58:05.733

XNA 毫无疑问。它对其他 SDK 迫使您处理的许多痛苦的较低级别的东西进行了大量抽象。当然，VS 和 Xbox 的集成以及庞大的社区也有帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T19:24:41.067

对于 3D 游戏，我建议使用 XNA（虽然它缺乏对固定功能管道的支持，但您必须自己编写所有着色器。）

对于 2D 游戏，[SDL.NET](http://cs-sdl.sourceforge.net/index.php/Main_Page)是一个不错的选择，因为它比较容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-17T12:19:42.953

试试[http://www.neoaxis.com/](http://www.neoaxis.com/)，那里有令人印象深刻的演示，可以定制。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-07-30T21:36:54.160

考虑到 XNA 缺乏对 Windows 8 的喜爱（支持被取消，应用程序将无法在应用程序商店中出售）——我会选择 SlimDX——无论如何它都比 XNA 更好——唯一的缺点是你不能用它制作 Xbox 应用程序。

# php - 如何在 Zend Framework 中获取所有响应段？

> ID：622227
> 
> 赞同：1
> 
> 时间：2009-03-07T18:04:55.377
> 
> 标签：php, zend-framework

我正在使用几个响应段，我将它们推送到我的操作堆栈上，如下所示：

```
$userlogAction = clone($request);
$userlogAction->setActionName('userlog')->setControllerName('index');
$actionStack->pushStack($userlogAction); 
```

现在，当我在我看来测试当前操作时：

```
$request = Zend_Controller_Front::getInstance()->getRequest();
$action = $request->getActionName(); 
```

我得到一个（随机？）动作的名称，但我想测试另一个。

我如何测试某个动作是否在堆栈中的动作中，而不是仅获取堆栈中的最后一个动作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T22:33:34.513

返回的请求`Zend_Controller_Front::getRequest()`当然不是随机的，而是调度程序当前正在处理的请求，即。导致你的动作控制器的动作方法被调用并因此你的视图脚本被执行的请求。使用动作堆栈插件，您只需添加更多请求以由调度程序一一处理。

如果要获取动作堆栈上的所有请求，则必须直接查询动作堆栈插件：

```
<?php
$front = Zend_Controller_Front::getInstance();
$plugin = $front->getPlugin('Zend_Controller_Plugin_ActionStack');

if ($plugin) {
    $stack = $plugin->getStack();

    foreach ($stack as $request) {
        $action = $request->getActionName();
        // Do whatever you want with $action
    }
} else {
    // Not using the action stack
    $action = $front->getRequest()->getActionName();
}
?> 
```

# c++ - 错误 LNK2005：已定义 - C++

> ID：622229
> 
> 赞同：15
> 
> 时间：2009-03-07T18:05:48.480
> 
> 标签：c++, linker

**背景**

我有一个名为*PersonLibrary*的项目，它有两个文件。

1.  人.h
2.  个人.cpp

该库生成一个静态库文件。另一个项目是使用*PersonLibrary的**TestProject*（通过 VS008 中的项目依赖项添加）。*一切正常，直到我向Person.h*添加了一个非成员函数。*Person.h*看起来像

 ***```
class Person
{
public:
    void SetName(const std::string name);

private:
    std::string personName_;
};

void SetPersonName(Person& person,const std::string name)
{
    person.SetName(name);
} 
```

*Person.cpp*定义了*SetName*函数。当我尝试从*TestProject使用**SetPersonName*时，我收到*错误 LNK2005: already defined*。这是我如何使用它

 **```
#include "../PersonLibrary/Person.h"
int main(int argc, char* argv[])
{
    Person person;
    SetPersonName(person, "Bill");
    return 0;
} 
```

**尝试过的变通方法**

1 - 我删除了*Person.cpp并在**Person.h*中定义了整个类。错误消失了，一切正常。

2 - 将*SetPersonName*修饰符更改为*static*。像下面这样

```
static void SetPersonName(Person& person,const std::string name)
{
    person.SetName(name);
} 
```

**问题**

1.  为什么首先显示的代码没有按我的预期工作？
2.  *静态*在这里有什么不同？
3.  这个问题的适当解决方案是什么？

谢谢

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-07T18:11:46.843

你要么必须

*   move`SetPersonName`的定义到 .cpp 文件，编译并链接到生成的目标
*   内`SetPersonName`联

这是一个众所周知的违反单一定义规则的案例。

static 关键字使函数的链接成为内部的，即仅对包含它的翻译单元可用。然而，这隐藏了真正的问题。我建议将函数的定义移到它自己的实现文件中，但将声明保留在标题中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T18:22:04.353

当你编译你的库时，它的 lib 文件包含 SetPersonName 的定义。当您编译使用该库的程序时，由于它包含标头，并且您已在标头中内联编写代码，因此它还会在 SetPersonName 的定义中进行编译。（通常）不允许对同一函数进行两个定义。static 关键字告诉编译器该函数不应暴露在当前翻译单元之外（您正在编译的离散代码段），因此库中的定义对链接器不可见。

此问题的适当解决方案取决于您的目标。带有静态函数声明的头文件几乎从来都不是您想要的。从设计的角度来看，我建议完全摆脱 SetPersonName，而只使用 Person::SetName。

但是，如果做不到这一点，我将像您对其余功能、标头中的声明和 .cpp 中的实现所做的那样来实现它。与库相关的内联函数往往会首先削弱使用库的许多优势。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T18:09:22.497

1.  函数 SetPersonName 将被编译到每个包含 Person.h 文件的目标文件中，从而使链接器看到几个函数并给出错误。

2.  通过编写 static 您声明该函数仅在单个对象文件中可见。你仍然会在你的二进制文件中得到几个函数，但现在你不会得到错误。

3.  尝试`inline`在函数之前写

    ```
    inline void SetPersonName(Person& person,const std::string name)
    {
        person.SetName(name);
    } 
    ```

    ...因为该功能非常简单，所以我认为可以将其作为内联。内联将在使用函数的地方放置必要的代码，而无需实际创建要调用的函数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T18:12:50.617

通过将函数声明为静态，您将其范围限定为当前翻译单元，因此实际上您已在主文件中添加了一个新的 SetPersonName 函数，并且将调用该函数而不是库中定义的函数。

正确的解决方案是在 person.h 中将 SetPersonName 声明为 extern 并在 person.cpp 中实现

**人.h**

```
extern void SetPersonName(Person& person,const std::string name); 
```

**个人.cpp**

```
void SetPersonName(Person& person,const std::string name)
{
    person.SetName(name);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T18:18:32.397

一个解决方案是使该函数成为静态方法。这将停止“已经定义”的错误。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-01-27T16:22:46.890

正如上面@logan-capaldo 清楚描述的那样，我遇到了类似的情况。

CPP 源文件 (myfile.cpp) 包含一个函数 MyFunction。在构建时，它被编译到 myfile.obj 中。但主 CPP 文件 (main.cpp) 也包含 myfile.cpp，因此函数 MyFunction 被包含/编译/链接两次，导致“LNK2005 已定义”错误。

这很混乱，但我没有时间正确修复它。最快的修复（在 VS Express 2012 中）是在解决方案资源管理器中右键单击 myfile.cpp，转到“属性”并将“从构建中排除”更改为“是”。我想这可以防止创建和/或链接其中一个 OBJ 文件，从而消除错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-09-13T21:18:17.330

对于在 Qt 项目中处理此错误的任何人，请确保您`signals:`的头文件中没有定义任何非信号函数。

`LNK2005`不正确，抛出`Foo::promiseData()`：

```
class Foo : public QObject {
        Q_OBJECT

    public:
        explicit Foo(QObject* parent = nullptr);

    signals:
        void dataReady(QList<QObject*> data) const;

        void promiseData() const; // <-- This function is not supposed to be a signal. 
```

正确的：

```
class Foo : public QObject {
        Q_OBJECT

    public:
        explicit Foo(QObject* parent = nullptr);

        void promiseData() const;

    signals:
        void dataReady(QList<QObject*> data) const; 
```

# asp.net - 我可以在 XP Pro 上运行 KiGG 吗？

> ID：622237
> 
> 赞同：0
> 
> 时间：2009-03-07T18:11:06.113
> 
> 标签：asp.net, asp.net-mvc, iis, .net-3.5, kigg

我有安装了 .Net 3.5 和 IIS 5.0 和 MVC RC 2 的 XP 专业版 我可以在这台机器上运行 KiGG 吗？

我的托管服务器上还有 IIS 6 和 .Net 3.5，它可以在那里运行吗？如果不是，有没有办法让它工作？

谢谢，

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-07T18:17:22.103

您需要安装 SQL 服务器，但是可以，您可以在 IIS 5/XP 上运行 KIGG。

ASP.NET MVC 是可二进制部署的，因此您应该也可以在您的主机上运行它。我认为对于共享主机，您需要完全信任，因为它在代码中使用了一些反射，否则您会遇到异常。

# sockets - “Microsoft Visual Studio 8\VC\PlatformSDK\Include\WinSock2”中是否有宽字符版本的 WSABUF 结构

> ID：622243
> 
> 赞同：0
> 
> 时间：2009-03-07T18:13:27.667
> 
> 标签：sockets, winsock, winsockets

winsock 中是否有宽字符版本的 WSABUF 结构？

我想在套接字上写日语数据。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-29T08:41:03.580

正如另一个答案所述，`WSABUF`用于`char *`表示字节。

TCP 提供了一个字节流，由您决定这些字节的组成。因此，只要您提供某种协议框架以便您可以在远端读取正确数量的数据，只需将您的宽字符串转换为`char *`.

如果您要按照您的问题得出其合乎逻辑的结论，那么您接下来会问`WSABUF`支持 PNG 图像的那个在哪里，或者`WSABUF`支持您最喜欢的数据结构的那个在哪里。您可以将拥有的数据转换为字节流（在宽字符串的情况下，它只是简单的框架和转换）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T18:17:31.043

可能不是。您很可能需要将宽字符串转换为其他格式，例如 UTF7 或其他格式，然后通过网络发送，然后再转换回另一端。

# jquery - 使用 jquery 的 asp.net mvc RC 中的模态表单

> ID：622248
> 
> 赞同：6
> 
> 时间：2009-03-07T18:19:08.683
> 
> 标签：jquery, asp.net-mvc, modal-dialog, simplemodal

我是 ajax / jquery 的新手，很难找到包含以下内容的简单示例：

*   ASP.Net MVC RC1（或 2）
*   jQuery
*   情态形式

我希望用户能够单击视图（父级）中的链接/按钮，并出现一个包含表单的模态表单。模态对话框的内容应该是 MVC 视图（子视图）。

提交表单后，我希望模式对话框消失并更新父视图的一部分。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-07T18:55:34.990

因此，您无需一次考虑所有问题。首先在 html 中将表单放在页面的前面和中心，附加一个动作，让它在没有模态幻想的情况下工作。
一旦你的表单逻辑工作，你就可以在 jQuery 中循环。无论您是想从模态和弹出窗口开始，还是从 jQuery 异步发布开始，都取决于您。我通常喜欢在让它变得漂亮之前让它工作，所以我们会走那条路。如果您使用标准 <% Html.BeginForm... { %> 语法来定义您的表单，请将其删除。去老学校的html！（我知道您可以进一步自定义 Html.Beginform 但只使用 html 更容易）

```
<form action="<%= Url.ActionLink(...)%>" id="SomeForm"> 
```

现在您可以在您的 document.ready 或任何您初始化 JS 的地方连接 jQuery。

```
$('#SomeForm').bind('submit', youractionfunction); 
```

在您的操作表单中，您可能会调用 jQuery 的帖子，其中帖子的回调隐藏您的表单并更新页面的其余部分。[API 文档](http://docs.jquery.com/Ajax/jQuery.post)

```
function youractionfunction(e){
  $.post($(e).attr('action'), // we get the action attribute (url) from the form
         { title : $('#titleBox').val()}, // the values we're passing
         yourCallbackFunction); 
  return false;  // This is important, this will stop the event from bubbling and your form from submitting twice.
} 
```

现在您有了一个 ajaxy 表单，因此您可以处理回调。

```
function yourCallbackFunction(data)
{
    // do something with the result.
} 
```

现在我们可以谈谈模态了。这通常有点痛苦，但您可以使用像[这样](http://dev.iceburg.net/jquery/jqModal/)的 jQuery 插件或类似的东西来为您做这件事。然后只需连接事件以显示和隐藏弹出窗口，就可以了。

如果您的意图是在单击“显示”链接时异步加载该表单，那会有点麻烦，但仍然可行。您可以使用 jQuery.Load ( [Api Documentation](http://docs.jquery.com/Ajax/load#urldatacallback) ) 来拉取 html 并将其注入到 dom 中，但您仍然必须连接事件（同样，使用上述的 bind('submit'...) ）。

# ruby-on-rails - 如何本地化 Rails 插件？

> ID：622250
> 
> 赞同：2
> 
> 时间：2009-03-07T18:20:37.133
> 
> 标签：ruby-on-rails, plugins, internationalization

我想将 OpenIdAuthentication 插件翻译成另一种语言，但我不想直接更改插件。

这是我要翻译的消息的基本结构：

```
模块 OpenIdAuthentication

  班级成绩
    ERROR_MESSAGES = {
      :missing => "抱歉，找不到 OpenID 服务器",
      :invalid => "抱歉，这似乎不是一个有效的 OpenID",
      :canceled => "OpenID 验证被取消",
      :failed => "OpenID 验证失败",
      :setup_needed => "OpenID 验证需要设置"
    }
  结尾

结尾
```

可以在不直接更改插件的情况下翻译它们吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T20:08:06.813

`OpenIdAuthentication::Result::ERROR_MESSAGES`您可以在插件加载后随时通过重新定义来简单地覆盖它。

您可以通过不同的插件（在 之后加载`OpenIdAuthentication`）或从插件加载后所需的文件（例如`require lib/open_id_authentication_suppl.rb`in `environment.rb`）执行此操作：

该代码本质上将是一个复制粘贴作业，如下所示：

```
module OpenIdAuthentication

  class Result
    ERROR_MESSAGES = {
      :missing      => "<message in foreign language>",
      :invalid      => "<message in foreign language>",
      :canceled     => "<message in foreign language>",
      :failed       => "<message in foreign language>",
      :setup_needed => "<message in foreign language>"
    } 
  end 
```

要将其与[I18N-rails](http://rails-i18n.org/wiki/pages/i18n-rails-guide)（内置于 Rails 2.2.2，在以前的版本中作为 gem/插件提供）集成，请执行以下操作：

```
 class I18NResultMessages
    def [](key)
      I18n.t(key, :scope => 'openidauthentication.errors.messages')
    end
  end

  class Result
    ERROR_MESSAGES = I18NResultMessages.new
  end 
```

然后为 Rails 启动的各种语言环境定义并加载您的 I18n yml 文件`openidauthentication.errors.messages`，并且不要忘记在`I18n.locale`每次开始处理基于登录用户的语言环境的控制器操作时设置您的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T20:11:45.713

将该代码复制到 中的文件中`/lib`，然后在`environment.rb`. 它真的很容易。

# c# - “其中 T : somevalue”是什么意思？

> ID：622264
> 
> 赞同：11
> 
> 时间：2009-03-07T18:29:12.653
> 
> 标签：c#, generics, constraints

是什么`where T : somevalue`意思？我刚刚看到一些代码说`where T : Attribute`。我认为这与泛型有关，但我不确定这意味着什么或它在做什么。

有人知道吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-07T18:30:18.220

它是[**对类型参数的约束**](http://msdn.microsoft.com/en-us/library/d5x73970.aspx)，这意味着`T`赋予泛型类或方法的类型必须从该类继承。`Attribute`

例如：

```
public class Foo<T> : 
   where T : Attribute
{
    public string GetTypeId(T attr) { return attr.TypeId.ToString(); }
 // ..
}

Foo<DescriptionAttribute> bar; // OK, DescriptionAttribute inherits Attribute
Foo<int> baz; // Compiler error, int does not inherit Attribute 
```

这很有用，因为它允许泛型类`T`在知道任何是 a 的对象`T`也必须是一个`Attribute`.

在上面的示例中，`GetTypeId`查询`TypeId`of是可以的，`attr`因为`TypeId`是 an 的属性`Attribute`，并且因为`attr`是 a`T`它必须是继承自 的类型`Attribute`。

约束也可以用于泛型方法，效果相同：

```
public static void GetTypeId<T>(T attr) where T : Attribute
{
   return attr.TypeId.ToString();
} 
```

您可以对类型施加其他约束；来自[MSDN](http://msdn.microsoft.com/en-us/library/d5x73970.aspx)：

> `where T: struct`
> 
> 类型参数必须是值类型。可以指定除 Nullable 之外的任何值类型。
> 
> `where T : class`
> 
> 类型参数必须是引用类型；这也适用于任何类、接口、委托或数组类型。
> 
> `where T : new()`
> 
> 类型参数必须有一个公共的无参数构造函数。当与其他约束一起使用时，必须最后指定 new() 约束。
> 
> `where T : <base class name>`
> 
> 类型参数必须是或派生自指定的基类。
> 
> `where T : <interface name>`
> 
> 类型参数必须是或实现指定的接口。可以指定多个接口约束。约束接口也可以是通用的。
> 
> `where T : U`
> 
> 为 T 提供的类型参数必须是或派生自为 U 提供的参数。这称为裸类型约束。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-07T18:33:14.593

此外，其他人所说的，您也有以下内容：

*   new() - T 必须有默认构造函数
*   class - T 必须是引用类型
*   struct - T 必须是值类型

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T18:30:33.147

[**where**](http://msdn.microsoft.com/en-us/library/6b0scde8(VS.80).aspx)子句用于限制使用泛型时可以传递的参数。创建泛型类时，根据您计划如何在类中使用 T 来指定参数类型可能符合您的最佳利益。如果它除了 System.Object 可以做的任何事情之外，那么最好使用[**约束**](http://msdn.microsoft.com/en-us/library/d5x73970.aspx)，因为您将获得编译时错误与运行时错误。

例子

如果你创建一个类

```
class Person<T> where T : System.IComparable<T>
{
   //can now use CompareTo
} 
```

您不能不传递任何不实现 IComparable 的类。因此，现在可以安全地对传递给 Person 类的任何内容使用 CompareTo。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T18:31:09.870

这是一种限制用作泛型参数的类型的方法。所以：

```
where T : SomeType 
```

意味着 T 必须要么从**SomeType**派生，要么实现接口**SomeType**

# asp.net-mvc - MVC 中的“母版页”逻辑应该放在哪里？

> ID：622265
> 
> 赞同：3
> 
> 时间：2009-03-07T18:29:15.897
> 
> 标签：asp.net-mvc, model-view-controller, session, webforms, master-pages

我正在尝试使用 MVC，我的问题是 -**我在带有 WebForms 的母版页中有 Page_Load 逻辑，它应该放在 MVC 中的哪个位置？**这是商业案例：

*   不同的主机标题应该导致在站点的（一个）母版页上显示不同的页面标题，因此所有页面。例如，如果主机标头是 hello.mydomain.com，则所有页面/视图的页面标题应为“Hello World”，而所有页面/视图的 goodbye.mydomain.com 应为“Goodbye World”。
*   如果主机标头与列表中的任何内容不同，则无论应用程序在何处，它都应重定向到 /Error/NoHostHeader。

以前，我将它放在 MasterPage Load() 事件中，看起来在 MVC 中，我可以在每个控制器中执行此操作（感觉必须在每个控制器中调用此功能是不对的），或者在某个地方Global.asax（似乎太……全球性的？）。

**编辑：**我已经成功地使用 Global.asax 方法和控制器来实际处理数据。此时唯一的问题是，所有主机头信息都在数据库中。如果您将“租户”信息存储在 Session 变量中，我通常会存储它，并且只在它不存在时进行 DB 调用；有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-07T20:13:02.230

出于某种原因，MVC 中没有 1:1 等价物，让我们概括一下如何以 MVC 的方式思考它：

**模型**：“这个站点的页面总是在特定的上下文中被请求，我们称它为租户（或用户、主题或您的子域代表的任何内容）。域模型具有代表当前请求的租户的属性。”

**查看**：“根据模型中设置的租户渲染页面标题。”

**控制器**：“根据主机头设置模型中的租户”。

请记住，我们要避免*混合*控制器、视图和业务逻辑。将控制器逻辑放在多个地方或一个地方，即不称为“控制器”的地方不是问题，只要它保持分离即可。

现在是好事：**即使使用 Web Forms 也可以实现这种“MVC 风格”**，并且该解决方案仍然适用于 ASP.NET MVC！

您仍然拥有请求生命周期（而不是页面生命周期），因此您可以实现一个自定义 HttpModule，其中包含所有请求的控制器逻辑的这一部分。它处理 BeginRequest 事件，检查主机标头，并将租户存储到类似 HttpContext.Current.Items["tenant"] 的内容中。（当然，你可以为这个字典条目设置一个静态的、类型化的包装器。）

然后，您的所有模型对象（或模型基类，或任何适合您的解决方案）都可以访问 HttpContext 以提供对这些信息的访问，如下所示：

```
public string Tenant
{
    get { return HttpContext.Current.Items["tenant"]; }
} 
```

好处：

*   您已经分离了原因（主机标题）和结果（渲染页面标题），提高了可维护性和可测试性
*   因此，您可以轻松地基于此状态向域模型添加其他行为，例如根据当前租户从数据库加载内容。
*   您可以轻松地使视图的更多部分取决于租户，例如您包含的 CSS 文件、徽标图像等。
*   您可以稍后更改控制器逻辑以在模型中设置租户，不仅基于子域，而且可能基于 cookie、引用者、搜索词、用户代理的语言或您能想到的任何内容，而无需修改任何您的代码取决于型号。

**更新您的编辑**：我不喜欢在会话中保持状态的想法，特别是如果您的会话 cookie 可能不仅适用于每个子域，而且适用于所有域。在这种情况下，如果用户之前访问过另一个子域，您可能会提供不一致的内容。将主机标头映射到租户的数据库中的信息可能不会经常更改，因此您可以缓存它并且不需要为每个请求进行数据库查找。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T18:59:02.860

您可以创建一个基本控制器，为您的 MVC 母版页视图提供正确的 ViewData，然后从该控制器派生每个实际控制器。如果您将逻辑放入 ActionExecuting 方法中，您应该能够在必要时生成异常或重定向到错误页面。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-07T19:39:43.433

您也在考虑“WebForms”而没有足够的 MVC。母版页只是视图的包装器，它应该只包含布局 html。你可以把东西寄给你的主人，但这是一条路，你应该争取不可知论的观点。底线：忘记 WebForms 的事件，因为它们不会在这里使用。

由于您正在处理主机标头，我想您可以将其放在 Global.asax 中...太好了，现在我很困惑：P

[从http://forums.asp.net/t/1226272.aspx](http://forums.asp.net/t/1226272.aspx)窃取的代码

```
protected void Application_BeginRequest(object sender, EventArgs e)
        {
            string host = string.Empty;

            if (this.Request.ServerVariables["HTTP_HOST"] == this.Request.Url.DnsSafeHost)
            {
                host = this.Request.Url.DnsSafeHost;
            }
            else
            {
                Regex regex = new Regex("http://[^/]*.host/([^/]*)(/.*)");
                Match match = regex.Match(this.Request.Url.AbsoluteUri);

                if (match.Success)
                {
                    host = match.Groups[1].Value;
                    Context.RewritePath(match.Groups[2].Value);
                }
            }

            // Match the host with the portal in the database
            ...
        } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-17T00:23:42.293

你需要的是这里[http://www.asp.net/mvc/tutorials/passing-data-to-view-master-pages-cs](http://www.asp.net/mvc/tutorials/passing-data-to-view-master-pages-cs)

# asp.net - 为母版页/无 Machine.Config 编写自定义角色提供程序

> ID：622269
> 
> 赞同：2
> 
> 时间：2009-03-07T18:30:52.803
> 
> 标签：asp.net, provider, role

我想为我的应用程序编写一个自定义角色提供程序，它具有现有的用户和角色表。我正在寻找一个参考，其中：

*   不需要 machine.config 更改（我在自定义角色架构中看到了很多），
*   支持可应用于需要不同权限的子页面的母版页。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T19:09:47.920

权限的配置和提供者本身可以在 web.config 中定义。要将权限应用于不同的子页面，您只需通过 web.config 中的 Location.System.Web.Authorization 节点锁定内容页面（更多信息[在这里](http://weblogs.asp.net/gurusarkar/archive/2008/09/29/setting-authorization-rules-for-a-particular-page-or-folder-in-web-config.aspx)）。

要创建自定义提供程序，您只需从 (System.Web.Security)RoleProvider 抽象类继承并实现您需要的方法（通常是 IsUserInRole、GetUsersInRole 和 GetRolesForUser，尽管我现在对 Asp. Net 开箱即用地调用基于角色的授权，因此您可能希望全部实现它们）。更多信息[在这里](http://msdn.microsoft.com/en-us/library/system.web.security.roleprovider.aspx)。

完成后，在 web.config 中注册要使用的提供程序：

```
<configuration>
  <system.web>
    <roleManager enabled="true"
      defaultProvider="YourRoleProviderHere">
      <providers>
        <add name="YourRoleProviderHere"
          type="YourRoleProviderHere, YourRoleProviderAssembly"
          description="Your totally awesome role provider"
        />
      </providers>
    </roleManager>
    ... 
```

这将使您的应用程序设置为使用您的角色提供者，并且几乎不需要任何工作，您就可以启动并运行。所有标准授权方法仍然有效 (User.IsInRole)，并且您已与 Asp.Net 集成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-18T19:13:47.843

您也可以尝试使用[HttpModule](http://www.codeproject.com/KB/aspnet/http-module-ip-security.aspx)： - 修改示例应用程序中的代码，以便请求知道要请求哪个页面 - 显然您需要以下 DbTables 结构： - 此[链接](http://msdn.microsoft.com/en-us/magazine/bb985530.aspx)将为您提供一个良好的开始

现在这个粗略的创建表语句将为您提供以下集合：

*   每个用户将拥有一个或多个 UserRoles
*   每个页面都可以配置为每个 UserRole 访问

围绕这个想法的一些 DDL SQL：

```
CREATE TABLE [User](
    [UserId] [int] IDENTITY(1,1) NOT NULL,
    [FirstName] [varchar](100) NOT NULL,
    [SecondName] [varchar](100) NULL,
    [LastName] [varchar](100) NOT NULL,
    [DomainName] [varchar](100) NOT NULL,
    [UserRoleId] [int] NOT NULL,
    [Password] [nvarchar](100) NOT NULL
) ON [PRIMARY]

GO

 CREATE TABLE [dbo].[UserRole](
    [UsersRoleId] [int] IDENTITY(1,1) NOT NULL,
    [RoleId] [int] NOT NULL,
    [UserId] [int] NOT NULL
) ON [PRIMARY]

 CREATE TABLE [ga].[Roles](
    [RoleId] [int] IDENTITY(1,1) NOT NULL,
    [RoleName] [varchar](50) NOT NULL,
    [RoleDefinition] [varchar](1000) NULL
) ON [PRIMARY]

GO

 CREATE TABLE [dbo].[Page](
[PageId] [int] IDENTITY(1,1) NOT NULL,
[PageName] [varchar](200) NOT NULL,
[PageDescription] [varchar](max) NOT NULL,
[PageTitle] [varchar](50) NOT NULL
) ON [PRIMARY]

GO

CREATE TABLE [dbo].[PagePerUserRole](
    [PageForRoleId] [int] IDENTITY(1,1) NOT NULL,
    [UserRoleId] [int] NOT NULL,
    [PageId] [int] NOT NULL
) ON [PRIMARY]

GO 
```

或[CustomBaseClass](http://www.codeproject.com/KB/aspnet/CustomBaseClass.aspx)

基本相同，但会检查用户是否有权访问 asp.net 页面生命周期的一些非常早期的事件 - 例如 OnInit

后者是更非正统的方式 - 但我已经使用复杂的身份验证机制（使用 3-rd 软件系统）编写了一个应用程序，它似乎在生产中工作了一段时间；)

# asp.net - SQL 脚本作用于主数据库而不是练习数据库

> ID：622274
> 
> 赞同：1
> 
> 时间：2009-03-07T18:34:13.827
> 
> 标签：asp.net, sql-server, sql-server-2005, tsql, ado.net

我写了一些 sql 脚本来创建数据库和存储数据。我刚刚注意到新表和数据将进入主数据库。

我发现如果我将数据库范围划分为这样，我可以解决正确的数据库：

```
CREATE TABLE Practice1.dbo.Experiments
(   
    ID int IDENTITY (100,1) PRIMARY KEY,  
    CompanyName nvarchar (50)                 
) 
```

但我宁愿不必限定每个命令。有没有办法在脚本中设置数据库，这样我就不必将所有内容都排除在外？

```
INSERT INTO Practice1.dbo.EXPERIMENTS
VALUES 
(
'hello world'
)

SELECT * FROM Practice1.dbo.EXPERIMENTS 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T18:38:05.580

您的工具栏上有一个下拉列表，可让您选择要在哪个数据库上执行脚本。此外，您可以在脚本顶部声明要使用的数据库。

例子：

> 句法
> 
> ```
> USE {database} 
> ```

[http://doc.ddart.net/mssql/sql70/ua-uz_7.htm](http://doc.ddart.net/mssql/sql70/ua-uz_7.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T18:46:05.560

在 SQL Server 2005 上，要切换数据库上下文，请使用以下命令：

使用数据库名称

在上面的示例中，数据库名称是 Practice1，因此：

使用实践1

# c# - 是否有任何事件告诉应用程序何时发生垃圾收集？

> ID：622276
> 
> 赞同：4
> 
> 时间：2009-03-07T18:36:19.047
> 
> 标签：c#, events, garbage-collection

我正在尝试找到一种了解垃圾收集的方法。无论是开始、完成还是正在进行中。我真的只需要一些与收藏本身相关的事件（我认为）。

我的问题是我有一个 WeakEventManager（从头开始编写）并且我有删除方法和不再存在的 WeakReferences（WeakReferences 在字典中）。

问题是我必须知道什么时候该“清理”。当收集器在做它的事情时清理它会很好。即使是在垃圾回收之后，至少下一次回收会移除这些旧对象。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-07T18:50:21.807

System.GC 类提供了一个 RegisterForFullGCNotification 方法，该方法允许在垃圾收集即将完成和完成时发出通知。

这并不理想，因为使用此方法有一些注意事项，例如必须禁用并发垃圾收集才能使此方法起作用。

有关完整信息，请参阅以下链接：

[垃圾收集通知](http://msdn.microsoft.com/en-us/library/cc713687.aspx)

[GC.RegisterForFullGCNotification 方法](http://msdn.microsoft.com/en-us/library/system.gc.registerforfullgcnotification.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-07T18:45:45.577

您可以监视 .NET 内存性能计数器对象。gen 0、1 和 2 集合的数量有计数。

通常在基于 GC 的系统上，直接引用 GC 是一种反模式。当您尝试使用已清除的 WeakReference 时，您可能会更好（鉴于有限的描述）只是懒惰地清理。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-07T19:17:08.700

这是我用来记录发生 GC 的 SmartInspect 的类。您应该能够轻松更改此类的功能。

要开始使用，只需调用`GCLog.Register();`.

```
#region File Header
// This file Copyright © 2007 Lasse Vågsæther Karlsen, All rights reserved.
//
// $Id: GCLog.cs 135 2008-05-28 11:28:37Z lassevk $
#endregion

#region Using

using System;
using System.Collections.Generic;
using System.Text;
using System.Diagnostics;
using Gurock.SmartInspect;

#endregion

namespace PresentationMode
{
    /// <summary>
    /// This class is used to get a running log of the number of garbage collections that occur,
    /// when running with logging.
    /// </summary>
    public sealed class GCLog
    {
        #region Construction & Destruction

        /// <summary>
        /// Releases unmanaged resources and performs other cleanup operations before the
        /// <see cref="GCLog"/> is reclaimed by garbage collection.
        /// </summary>
        ~GCLog()
        {
            SiAuto.Main.LogMessage("GARBAGE COLLECTED");
            if (!AppDomain.CurrentDomain.IsFinalizingForUnload() && !Environment.HasShutdownStarted)
                new GCLog();
        }

        #endregion

        #region Public Static Methods

        /// <summary>
        /// Registers this instance.
        /// </summary>
        public static void Register()
        {
#if DEBUG
            if (SiAuto.Si.Enabled)
                new GCLog();
#endif
        }

        #endregion
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T19:07:27.973

如果您创建一个对您的对象具有传出引用但没有传入引用的一次性对象，即

```
new MyGcMonitor(this);  // don't store result 
```

如果您确保 MyGcMonitor 有一个终结器（析构函数），那么该终结器将在 GC fase 完成后在一个单独的线程上调用。终结器可以调用一个方法来告诉您的类终结已完成。

棘手的部分是如果您再次需要它，例如如果您决定不释放您的对象。然后，您必须设置一个序列，在运行的 GC 线程之外创建另一个 MyGcMonitor 实例。我想您可以使用delegate.invoke 并在该委托中首先调用GC.WaitForPendingFinalizers()。

恢复 MyGcMonitor 将有一个类似的问题，即稍后删除（静态）引用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-20T10:44:25.163

在低优先级的线程中，您可以使用这个简单的静态方法检查应用程序是否需要清理。

```
 private static bool NeedsCleaning ()
    {
        if (DummyRef.IsAlive) {
            return false;
        }
        DummyRef = new WeakReference (new object ());
        return true;
    } 
```

# c# - 使用 HTMLDocumentClass 插入一些 java 脚本

> ID：622281
> 
> 赞同：0
> 
> 时间：2009-03-07T18:38:08.200
> 
> 标签：c#, html, xml

我想将自定义 javascript 插入页面的头部，我只有这个 HTMLDocumentClass 对象，

有谁知道这是怎么做到的吗？

有安全限制吗？？？

我可以更改页面附带的元素的 ID 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T22:05:30.590

.NET 中无法直接在文档头中设置脚本元素。作为一种解决方法，您可以引用 mshtml.dll 并使用 IHTMLDocument2 接口。此外，您也可以只使用包装类来公开您需要的功能。（即脚本元素的 Text 或 src 属性，以便您可以设置脚本代码）。然后你只需要一个实现自定义包装接口的方法。如下图所示...

```
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;

/// <summary>
/// A COM interface is needed because .NET does not provide a way
/// to set the properties of a HTML script element.
/// This class negates the need to refrence mshtml in its entirety
/// </summary>
[ComImport, Guid("3050F536-98B5-11CF-BB82-00AA00BDCE0B"),
InterfaceType((short)2),
TypeLibType((short)0x4112)]
public interface IHTMLScriptElement
{
    /// <summary>
    /// Sets the text property
    /// </summary>
    [DispId(1006)]
    string Text
    {
        [param: MarshalAs(UnmanagedType.BStr)]
        [PreserveSig,
        MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime),
        DispId(-2147417085)]
        set;
    }

    /// <summary>
    /// Sets the src property
    /// </summary>
    [DispId(1001)]
    string Src
    {
        [param: MarshalAs(UnmanagedType.BStr)]
        [PreserveSig,
        MethodImpl(MethodImplOptions.InternalCall, MethodCodeType = MethodCodeType.Runtime),
        DispId(-1001)]
        set;
    }
}

// Inject script element
public static void InjectJavascript(string javascript, HTMLDocument doc)
{
    if (doc != null)
    {
        try
        {
            // find the opening head tag
            HtmlElement head =  doc.GetElementsByTagName("head")[0];
            // create the script element
            HtmlElement script =  doc.CreateElement("script");
            // set it to javascirpt
            script.SetAttribute("type", "text/javascript");
            // cast the element to our custom interface
            IHTMLScriptElement element = (IHTMLScriptElement)script.DomElement;
            // add the script code to the element
            element.Text = "/* <![CDATA[ */ " + javascript + " /* ]]> */";
            // add the element to the document
            head.AppendChild(script);
        }
        catch (Exception e)
        {
            MessageBox.show(e.message);
        }
    }
} 
```

你会像这样使用它，其中 myDoc 是你的 html 文档......

```
InjectJavascript("function foo(bar) { alert(bar); }", myDoc); // inject the 'foo' function 
```

并像这样测试它......

```
myDoc.InvokeScript("foo", new object[] { "Hello!" }); // alerts 'hello!' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T19:01:37.893

使用 HTMLDocument::Window 属性获取 HTMLWindow 类，使用 HTMLWindow::DomWindow 属性获取原生 IE 界面。然后调用 IHTMLWindow2::execScript。

[http://msdn.microsoft.com/en-us/library/aa741364(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa741364(VS.85).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T21:16:23.547

HtmlDocument 有一个[Window](http://msdn.microsoft.com/en-us/library/system.windows.forms.htmldocument.window.aspx)属性。

或者，您可以使用 HtmlDocument 的[CreateElement](http://msdn.microsoft.com/en-us/library/system.windows.forms.htmldocument.createelement.aspx)方法将脚本注入当前文档。

# vim - 复制匹配的文本进行注册

> ID：622285
> 
> 赞同：5
> 
> 时间：2009-03-07T18:40:11.660
> 
> 标签：vim, editing

有谁知道是否可以将搜索结果连接到单个寄存器中？例如，我有一个包含以下内容的文件：

```
aaa :xxx 123
bb :y 8
ccccc :zzzzz 1923 
```

现在我想要的是在其他地方复制以“：”开头的列。不幸的是我不能使用可视块模式，因为第一列没有固定宽度。我认为我可以搜索第二列 (:\w+) 并将机器存储到寄存器中。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-07T21:44:06.833

其他方式：

```
:g/:/norm f:"Aye 
```

Per `:h quote_alpha`，如果您使用大写的寄存器名称，它会附加而不是替换寄存器的内容。如果你运行它并检查 register 的内容`"a`，你会看到

```
:xxx:y:zzzzz 
```

（可能带有换行符，具体取决于您的`cpoptions`设置方式。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T19:55:17.797

你可以做一个宏：

qa（制作一个宏并将其存储在寄存器 a 中）。

“Rye（拉到词尾并将其附加到寄存器 r - 大写表示附加，小写覆盖。）

n（下一场比赛）

q（结束录音）

如果有 10 个匹配项，请执行 10@a 确保在开始时寄存器 r 为空。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T21:12:52.227

将此添加到您的 .vimrc 或在 vim 插件文件夹中创建具有以下内容的任何文件。
通过 .vimrc 或插件执行此行后，使用 :CopyTextAfterColon 命令，然后简单地从系统缓冲区中插入所需的文本。

```
 function! s:copy_after_colon()
    let values = ''

    let pattern = '^.*:\(\w\+\).*$'

    for line_number in range(1, line('$'))
        let line = getline(line_number)
        if line =~ pattern
            let value = substitute(line, pattern, '\1', '')
            let values .= value."\n"
        endif
    endfor

    let @* = values
endfunction

command! -nargs=0 CopyTextAfterColon call <SID>copy_after_colon() 
```

您可以稍后针对不同目的进行调整。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T19:47:40.263

我将首先从解析文件开始。为此，请使用[TextFieldReader](http://msdn.microsoft.com/en-us/library/microsoft.visualbasic.fileio.textfieldparser.aspx)而不是发明自己的 CSV 解析器：

```
using Microsoft.VisualBasic.FileIO;

TextFieldParser reader = new TextFieldReader("C:\MyFile.txt");
reader.Delimiters = new string[] { " " };
string[] currentRow = null;
while (!reader.EndOfData)
{
    try
    {
        currentRow = reader.ReadFields();
        foreach(string field in currentRow)
        {
            //save this field...
        }
    }
    catch (MalformedLineException ex)
    {
        //handle exception the way you want
    }
} 
```

获得数据后，我将仅提取我感兴趣的列。如果您可以假设每一行具有相同的模式，那么您可以在解析第一行时找出正确的列，然后在解析其余行时您可以只保存相应的列。您不必将整个文件保存到内存中。

编辑：*非常抱歉，我以为问题是关于 C# 编程的。我的错误 - 对不起。*

# java - 圆与长方形相交的面积

> ID：622287
> 
> 赞同：23
> 
> 时间：2009-03-07T18:40:36.680
> 
> 标签：java, math, intersection, area

我正在寻找一种快速的方法来确定矩形和圆形之间的相交区域（我需要进行数百万次这样的计算）。

一个特定的属性是，在所有情况下，圆和矩形总是有 2 个交点。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-03-07T19:11:31.800

给定2个交点：

**0 个顶点在圆内：**[圆段](http://mathworld.wolfram.com/CircularSegment.html)的面积

```
 XXXXX              -------------------
   X     X               X            X Circular segment
  X       X               XX        XX 
+-X-------X--+              XXXXXXXX 
|  X     X   |
|   XXXXX    | 
```

**1 个顶点**在圆内：圆线段和三角形的面积之和。

```
 XXXXX                   XXXXXXXXX
   X     X       Triangle ->X     _-X
  X       X                 X   _-  X 
  X    +--X--+              X _-   X <- Circular segment 
   X   | X   |              X-  XXX 
    XXXXX    |              XXXX
       |     | 
```

**2个顶点**在圆内：两个三角形和一个圆的面积之和

```
 XXXXX                   +------------X
   X     X                  |      _--'/'X 
  X    +--X---    Triangle->|   _--   / X
  X    |  X                 |_--     /XX <- Circular segment
   X   +-X----              +-------XX
    XXXXX                 Triangle^ 
```

**圆内有3个顶点**：矩形的面积减去三角形的面积加上圆弧段的面积

```
 XXXXX
   X  +--X+             XXX
  X   |   X         -------XXX-----+ <- Triangle outside
 X    |   |X        Rect ''.  XXX  |
 X    +---+X                ''.  XX|  
 X         X                   ''. X <- Circular segment inside 
  X       X                       ^|X 
   X     X                         | X 
    XXXXX 
```

要计算这些区域：

*   您需要使用的大部分点都可以通过找到[一条线和一个圆的交点来找到](http://mathworld.wolfram.com/Circle-LineIntersection.html)

*   您需要计算的面积可以通过[计算圆弧](http://mathworld.wolfram.com/CircularSegment.html)的面积和[三角形的面积](http://mathworld.wolfram.com/TriangleArea.html)来找到。

*   您可以通过计算顶点到中心的距离是否小于半径来确定顶点是否在圆内。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2015-09-21T15:25:56.527

我意识到这已在不久前得到解答，但我正在解决同样的问题，但我找不到可以使用的开箱即用的可行解决方案。请注意，我的框是[轴对齐](https://en.wikipedia.org/wiki/Axis-aligned_object)的，OP 并没有完全指定。下面的解决方案是完全通用的，适用于任意数量的交叉点（不仅仅是两个）。请注意，如果您的框不是轴对齐的（但仍然是直角框，而不是一般的[quads](https://en.wikipedia.org/wiki/Quadrilateral)），您可以利用圆形的优势，旋转所有内容的坐标，使框最终轴对齐，*然后*使用此代码。

我想使用集成——这似乎是个好主意。让我们从写一个明显的画圆公式开始：

```
x = center.x + cos(theta) * radius
y = center.y + sin(theta) * radius

^
|
|**###        **
| #*  #      *          * x
|#  *  #    *           # y
|#  *  #    *     
+-----------------------> theta
     *  #  *  # 
     *  #  *  #
      *  #*  #
       ***### 
```

这很好，但我无法将那个圆圈的面积整合到`x`or `y`; 这些是不同的数量。我只能在角度上积分`theta`，产生披萨片的区域。不是我想要的。让我们尝试改变论点：

```
(x - center.x) / radius = cos(theta) // the 1st equation
theta = acos((x - center.x) / radius) // value of theta from the 1st equation
y = center.y + sin(acos((x - center.x) / radius)) * radius // substitute to the 2nd equation 
```

这还差不多。现在给定 的范围`x`，我可以对 进行积分`y`，得到一个圆的上半部分的面积。这仅适用于`x`in `[center.x - radius, center.x + radius]`（其他值将导致虚输出）但我们知道该范围之外的区域为零，因此很容易处理。为简单起见，我们假设单位圆，我们可以稍后再插入中心和半径：

```
y = sin(acos(x)) // x in [-1, 1]
y = sqrt(1 - x * x) // the same thing, arguably faster to compute http://www.wolframalpha.com/input/?i=sin%28acos%28x%29%29+

               ^ y
               |
            ***|***     <- 1
        ****   |   ****
      **       |       **
     *         |         *
    *          |          *
----|----------+----------|-----> x
   -1                     1 
```

这个函数确实有 的积分`pi/2`，因为它是单位圆的上半部分（半圆的面积是`pi * r^2 / 2`，我们已经说过*单位*，意思是`r = 1`）。现在我们可以通过积分 over 计算半圆和无限高的盒子的交点面积，该盒子位于 x 轴上（圆心也位于 x 轴上）`y`：

```
f(x): integral(sqrt(1 - x * x) * dx) = (sqrt(1 - x * x) * x + asin(x)) / 2 + C // http://www.wolframalpha.com/input/?i=sqrt%281+-+x*x%29
area(x0, x1) = f(max(-1, min(1, x1))) - f(max(-1, min(1, x0))) // the integral is not defined outside [-1, 1] but we want it to be zero out there

        ~         ~
        |      ^  |
        |      |  |
        |   ***|***     <- 1
        ****###|##|****
      **|######|##|    **
     *  |######|##|      *
    *   |######|##|       *
----|---|------+--|-------|-----> x
   -1   x0        x1      1 
```

这可能不是很有用，因为无限高的盒子不是我们想要的。为了能够释放无限高盒子的底部边缘，我们需要再添加一个参数：

```
g(x, h): integral((sqrt(1 - x * x) - h) * dx) = (sqrt(1 - x * x) * x + asin(x) - 2 * h * x) / 2 + C // http://www.wolframalpha.com/input/?i=sqrt%281+-+x*x%29+-+h
area(x0, x1, h) = g(min(section(h), max(-section(h), x1))) - g(min(section(h), max(-section(h), x0)))

        ~         ~
        |      ^  |
        |      |  |
        |   ***|***     <- 1
        ****###|##|****
      **|######|##|    **
     *  +------+--+      *   <- h
    *          |          *
----|---|------+--|-------|-----> x
   -1   x0        x1      1 
```

`h`我们的无限盒子的底部边缘到 x 轴的（正）距离在哪里。该`section`函数计算单位圆与给出的水平线相交的（正）位置，`y = h`我们可以通过求解来定义它：

```
sqrt(1 - x * x) = h // http://www.wolframalpha.com/input/?i=sqrt%281+-+x+*+x%29+%3D+h
section(h): (h < 1)? sqrt(1 - h * h) : 0 // if h is 1 or above, then the section is an empty interval and we want the area integral to be zero

               ^ y
               |  
            ***|***     <- 1
        ****   |   ****  
      **       |       **
-----*---------+---------*------- y = h
    *          |          *
----||---------+---------||-----> x
   -1|                   |1
-section(h)          section(h) 
```

现在我们可以让事情顺利进行了。那么如何计算有限框与x轴上方单位圆相交的面积：

```
area(x0, x1, y0, y1) = area(x0, x1, y0) - area(x0, x1, y1) // where x0 <= x1 and y0 <= y1

        ~         ~                              ~         ~
        |      ^  |                              |      ^  |
        |      |  |                              |      |  |
        |   ***|***                              |   ***|*** 
        ****###|##|****                          ****---+--+****      <- y1
      **|######|##|    **                      **       |       **
     *  +------+--+      *   <- y0            *         |         *
    *          |          *                  *          |          *
----|---|------+--|-------|-----> x      ----|---|------+--|-------|-----> x
        x0        x1                             x0        x1

               ^
               |
            ***|***
        ****---+--+****      <- y1
      **|######|##|    **
     *  +------+--+      *   <- y0
    *          |          *
----|---|------+--|-------|-----> x
        x0        x1 
```

那很好。那么一个不在 x 轴上方的盒子呢？我想说不是所有的盒子都是。出现了三种简单的情况：

*   框在 x 轴上方（使用上面的等式）
*   该框位于 x 轴下方（翻转 y 坐标的符号并使用上述等式）
*   盒子与 x 轴相交（将盒子分成上下两部分，使用上面的方法计算两者的面积并将它们相加）

够容易吗？让我们写一些代码：

```
float section(float h, float r = 1) // returns the positive root of intersection of line y = h with circle centered at the origin and radius r
{
    assert(r >= 0); // assume r is positive, leads to some simplifications in the formula below (can factor out r from the square root)
    return (h < r)? sqrt(r * r - h * h) : 0; // http://www.wolframalpha.com/input/?i=r+*+sin%28acos%28x+%2F+r%29%29+%3D+h
}

float g(float x, float h, float r = 1) // indefinite integral of circle segment
{
    return .5f * (sqrt(1 - x * x / (r * r)) * x * r + r * r * asin(x / r) - 2 * h * x); // http://www.wolframalpha.com/input/?i=r+*+sin%28acos%28x+%2F+r%29%29+-+h
}

float area(float x0, float x1, float h, float r) // area of intersection of an infinitely tall box with left edge at x0, right edge at x1, bottom edge at h and top edge at infinity, with circle centered at the origin with radius r
{
    if(x0 > x1)
        std::swap(x0, x1); // this must be sorted otherwise we get negative area
    float s = section(h, r);
    return g(max(-s, min(s, x1)), h, r) - g(max(-s, min(s, x0)), h, r); // integrate the area
}

float area(float x0, float x1, float y0, float y1, float r) // area of the intersection of a finite box with a circle centered at the origin with radius r
{
    if(y0 > y1)
        std::swap(y0, y1); // this will simplify the reasoning
    if(y0 < 0) {
        if(y1 < 0)
            return area(x0, x1, -y0, -y1, r); // the box is completely under, just flip it above and try again
        else
            return area(x0, x1, 0, -y0, r) + area(x0, x1, 0, y1, r); // the box is both above and below, divide it to two boxes and go again
    } else {
        assert(y1 >= 0); // y0 >= 0, which means that y1 >= 0 also (y1 >= y0) because of the swap at the beginning
        return area(x0, x1, y0, r) - area(x0, x1, y1, r); // area of the lower box minus area of the higher box
    }
}

float area(float x0, float x1, float y0, float y1, float cx, float cy, float r) // area of the intersection of a general box with a general circle
{
    x0 -= cx; x1 -= cx;
    y0 -= cy; y1 -= cy;
    // get rid of the circle center

    return area(x0, x1, y0, y1, r);
} 
```

还有一些基本的单元测试：

```
printf("%f\n", area(-10, 10, -10, 10, 0, 0, 1)); // unit circle completely inside a huge box, area of intersection is pi
printf("%f\n", area(-10, 0, -10, 10, 0, 0, 1)); // half of unit circle inside a large box, area of intersection is pi/2
printf("%f\n", area(0, 10, -10, 10, 0, 0, 1)); // half of unit circle inside a large box, area of intersection is pi/2
printf("%f\n", area(-10, 10, -10, 0, 0, 0, 1)); // half of unit circle inside a large box, area of intersection is pi/2
printf("%f\n", area(-10, 10, 0, 10, 0, 0, 1)); // half of unit circle inside a large box, area of intersection is pi/2
printf("%f\n", area(0, 1, 0, 1, 0, 0, 1)); // unit box covering one quadrant of the circle, area of intersection is pi/4
printf("%f\n", area(0, -1, 0, 1, 0, 0, 1)); // unit box covering one quadrant of the circle, area of intersection is pi/4
printf("%f\n", area(0, -1, 0, -1, 0, 0, 1)); // unit box covering one quadrant of the circle, area of intersection is pi/4
printf("%f\n", area(0, 1, 0, -1, 0, 0, 1)); // unit box covering one quadrant of the circle, area of intersection is pi/4
printf("%f\n", area(-.5f, .5f, -.5f, .5f, 0, 0, 10)); // unit box completely inside a huge circle, area of intersection is 1
printf("%f\n", area(-20, -10, -10, 10, 0, 0, 1)); // huge box completely outside a circle (left), area of intersection is 0
printf("%f\n", area(10, 20, -10, 10, 0, 0, 1)); // huge box completely outside a circle (right), area of intersection is 0
printf("%f\n", area(-10, 10, -20, -10, 0, 0, 1)); // huge box completely outside a circle (below), area of intersection is 0
printf("%f\n", area(-10, 10, 10, 20, 0, 0, 1)); // huge box completely outside a circle (above), area of intersection is 0 
```

这个的输出是：

```
3.141593
1.570796
1.570796
1.570796
1.570796
0.785398
0.785398
0.785398
0.785398
1.000000
-0.000000
0.000000
0.000000
0.000000 
```

这对我来说似乎是正确的。如果您不相信您的编译器会为您执行此操作，您可能希望内联这些函数。

对于不与 x 轴相交的框，这使用 6 sqrt、4 asin、8 div、16 mul 和 17 add，对于与 x 轴相交的框使用两倍（以及另外 1 个 add）。请注意，除法是按半径划分的，可以减少为两个除法和一堆乘法。如果有问题的框与 x 轴相交但不与 y 轴相交，您可以将所有内容旋转`pi/2`并以原始成本进行计算。

我将它用作调试亚像素精确抗锯齿圆光栅化器的参考。它慢得要命:)，我需要计算圆的边界框中每个像素与圆的交点面积才能得到 alpha。您可以看到它有效，并且似乎没有出现任何数字伪影。下图是一堆半径从 0.3 px 增加到大约 6 px 的圆，呈螺旋状排列。

[![界](https://i.stack.imgur.com/v7L92.png)](https://i.stack.imgur.com/v7L92.png)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-08-18T13:25:25.213

我希望发布这样一个老问题的答案还不错。我查看了上述解决方案并制定了一个类似于 Daniels 第一个答案的算法，但更严格一些。

简而言之，假设整个区域都在矩形中，减去外部半平面中的四个段，然后添加四个外部象限中的任何区域，沿途丢弃琐碎的情况。

pseudocde（我的实际代码只有~12行..）

```
find the signed (negative out) normalized distance from the circle center
to each of the infinitely extended rectangle edge lines,
ie.
d_1=(xcenter-xleft)/r
d_2=(ycenter-ybottom)/r
etc

for convenience order 1,2,3,4 around the edge. If the rectangle is not
aligned with the cartesian coordinates this step is more complicated but
the remainder of the algorithm is the same

If ANY d_i <=- 1 return 0

if ALL d_i >=  1 return Pi r^2

this leave only one remaining fully outside case: circle center in
an external quadrant, and distance to corner greater than circle radius:

for each adjacent i,j (ie. i,j=1,2;2,3;3,4;4,1)
     if d_i<=0 and d_j <= 0 and d_i^2+d_j^2 > 1 return 0

now begin with full circle area  and subtract any areas in the
four external half planes

Area= Pi r^2
for each  d_i>-1
     a_i=arcsin( d_i )  #save a_i for next step
     Area -= r^2/2 (Pi - 2 a_i - sin(2 a_i)) 

At this point note we have double counted areas in the four external
quadrants, so add back in:

for each adjacent i,j
   if  d_i < 1 and   d_j < 1  and d_i^2+d_j^2 < 1
       Area += r^2/4 (Pi- 2 a_i - 2 a_j -sin(2 a_i) -sin(2 a_j) + 4 sin(a_i) sin(a_j))

return Area 
```

顺便说一句，平面象限中包含的圆的面积的最后一个公式很容易导出为圆段、两个直角三角形和一个矩形的总和。

享受。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-07T20:18:05.120

以下是如何计算圆心位于矩形外的圆和矩形之间的重叠区域。其他情况可以归结为这个问题。

面积可以通过积分圆方程*y = sqrt[a^2 - (xh)^2] + k*来计算，其中 a 是半径，(h,k) 是圆心，求曲线下面积。您可以使用计算机集成，将区域划分为许多小矩形并计算它们的总和，或者在这里仅使用封闭形式。

![替代文字](https://lh4.ggpht.com/_5XDoB4MglkY/SbLMR8H-NoI/AAAAAAAAFME/kHjrFNTNmSM/s400/Calculus.jpg)

这是实现上述概念的 C# 源代码。请注意，有一种特殊情况，指定的 x 位于圆的边界之外。我只是在这里使用一个简单的解决方法（在所有情况下都不会产生正确的答案）

```
public static void RunSnippet()
{
    // test code
    double a,h,k,x1,x2;
    a = 10;
    h = 4;
    k = 0;
    x1 = -100;
    x2 = 100;

    double r1 = Integrate(x1, a, h, k);
    double r2 = Integrate(x2, a, h, k);

    Console.WriteLine(r2 - r1);

}

private static double Integrate(double x, double a,double h, double k)
{
    double a0 = a*a - (h-x)*(h-x);

    if(a0 <= 0.0){
        if(k == 0.0)
            return Math.PI * a * a / 4.0 * Math.Sign(x);
        else
            throw new Exception("outside boundaries");
    }

    double a1 = Math.Sqrt(a*a - (h-x)*(h-x)) * (h-x);
    double area = 0.5 * Math.Atan(a1 / ((h-x)*(h-x) - a*a))*a*a - 0.5 * a1 + k * x;
    return area;
} 
```

**注意：这个问题与**[Google Code Jam 2008 资格赛中](http://code.google.com/codejam/contest/)的一个问题非常相似：*Fly Swatter*。您也可以点击分数链接下载解决方案的源代码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-08T16:53:03.747

感谢您的回答，

我忘了提到面积估计就足够了。那; 这就是为什么最后，在查看了所有选项之后，我使用了蒙特卡罗估计，我在圆圈中生成随机点并测试它们是否在框中。

就我而言，这可能更高效。（我在圆上放置了一个网格，我必须测量属于每个网格单元的圆的比率。）

谢谢

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-07T19:02:58.857

也许您可以使用[这个问题](https://stackoverflow.com/questions/540014/compute-the-area-of-intersection-between-a-circle-and-a-triangle)的答案，其中询问圆形和三角形之间的相交区域。将您的矩形分成两个三角形并使用那里描述的算法。

另一种方法是在两个交点之间画一条线，这会将您的区域分成一个多边形（3 或 4 条边）和一个[圆形段](http://en.wikipedia.org/wiki/Circular_segment)，因为您应该能够更轻松地找到库或自己进行计算。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-08-16T06:53:27.303

这是该问题的另一种解决方案：

```
public static bool IsIntersected(PointF circle, float radius, RectangleF rectangle)
{

        var rectangleCenter = new PointF((rectangle.X +  rectangle.Width / 2),
                                         (rectangle.Y + rectangle.Height / 2));

        var w = rectangle.Width  / 2;
        var h = rectangle.Height / 2;

        var dx = Math.Abs(circle.X - rectangleCenter.X);
        var dy = Math.Abs(circle.Y - rectangleCenter.Y);

        if (dx > (radius + w) || dy > (radius + h)) return false;

        var circleDistance = new PointF
                                 {
                                     X = Math.Abs(circle.X - rectangle.X - w),
                                     Y = Math.Abs(circle.Y - rectangle.Y - h)
                                 };

        if (circleDistance.X <= (w))
        {
            return true;
        }

        if (circleDistance.Y <= (h))
        {
            return true;
        }

        var cornerDistanceSq = Math.Pow(circleDistance.X - w, 2) + 
                    Math.Pow(circleDistance.Y - h, 2);

        return (cornerDistanceSq <= (Math.Pow(radius, 2)));
} 
```

# iphone - 如何用手指或 iPhone 绘图

> ID：622288
> 
> 赞同：0
> 
> 时间：2009-03-07T18:41:58.097
> 
> 标签：iphone

有没有人有一个工作示例项目，显示用户如何用手指在 iPhone 上绘制简单的草图？类似于 GLPaint，但更简单，无需 Open GL。仅具有基本绘图功能的东西。我知道之前有一个 FingerSketches 示例，但它似乎不再可用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T19:35:46.533

你是对的，有一个 FingerSketch 的例子；我不确定它是否仍然有效，而且我认为在这里发布整个示例并不是一个好主意。但我认为您可以使用 Touches 或 MoveMe 样本作为起点来学习如何对触摸做出反应。

基本上，您必须记住每个触摸事件的最后一个位置，并在 touchesMoved 和 touchesEnded 中从最后一个位置到当前位置画一条线。像往常一样，FingerSketch 不会直接绘制到屏幕上，而是绘制到单独的绘制上下文中，然后调用`[self setNeedsDisplay]`重绘自身。

# oracle - 如何检查 Oracle 数据库是否有长时间运行的查询

> ID：622289
> 
> 赞同：106
> 
> 时间：2009-03-07T18:43:40.247
> 
> 标签：oracle

我使用 Oracle 数据库的应用程序运行缓慢或似乎已完全停止。

如何找出最昂贵的查询，以便我可以进一步调查？

* * *

## 回答 #1

> 赞同：147
> 
> 时间：2009-03-09T05:49:28.233

这个显示了当前处于“活动”状态的 SQL：-

```
select S.USERNAME, s.sid, s.osuser, t.sql_id, sql_text
from v$sqltext_with_newlines t,V$SESSION s
where t.address =s.sql_address
and t.hash_value = s.sql_hash_value
and s.status = 'ACTIVE'
and s.username <> 'SYSTEM'
order by s.sid,t.piece
/ 
```

这显示了锁。有时事情进展缓慢，但这是因为它被阻塞等待锁定：

```
select
  object_name, 
  object_type, 
  session_id, 
  type,         -- Type or system/user lock
  lmode,        -- lock mode in which session holds lock
  request, 
  block, 
  ctime         -- Time since current mode was granted
from
  v$locked_object, all_objects, v$lock
where
  v$locked_object.object_id = all_objects.object_id AND
  v$lock.id1 = all_objects.object_id AND
  v$lock.sid = v$locked_object.session_id
order by
  session_id, ctime desc, object_name
/ 
```

这是查找长操作（例如全表扫描）的好方法。如果是因为很多短的操作，什么都不会出现。

```
COLUMN percent FORMAT 999.99 

SELECT sid, to_char(start_time,'hh24:mi:ss') stime, 
message,( sofar/totalwork)* 100 percent 
FROM v$session_longops
WHERE sofar/totalwork < 1
/ 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-03-07T19:03:25.223

试试这个，它会给你当前运行超过 60 秒的查询。请注意，如果 SQL 有多行，它会在每个正在运行的查询中打印多行。查看 sid,serial# 以查看属于一起的内容。

```
select s.username,s.sid,s.serial#,s.last_call_et/60 mins_running,q.sql_text from v$session s 
join v$sqltext_with_newlines q
on s.sql_address = q.address
 where status='ACTIVE'
and type <>'BACKGROUND'
and last_call_et> 60
order by sid,serial#,q.piece 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-07T21:44:28.550

v$session_longops

如果你寻找 sofar != totalwork 你会看到那些还没有完成的，但是当操作完成时条目不会被删除，所以你也可以在那里看到很多历史。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-01-17T08:20:07.660

```
Step 1:Execute the query

column username format 'a10'
column osuser format 'a10'
column module format 'a16'
column program_name format 'a20'
column program format 'a20'
column machine format 'a20'
column action format 'a20'
column sid format '9999'
column serial# format '99999'
column spid format '99999'
set linesize 200
set pagesize 30
select
a.sid,a.serial#,a.username,a.osuser,c.start_time,
b.spid,a.status,a.machine,
a.action,a.module,a.program
from
v$session a, v$process b, v$transaction c,
v$sqlarea s
Where
a.paddr = b.addr
and a.saddr = c.ses_addr
and a.sql_address = s.address (+)
and to_date(c.start_time,'mm/dd/yy hh24:mi:ss') <= sysdate - (15/1440) -- running for 15 minutes
order by c.start_time
/   

Step 2: desc v$session

Step 3:select sid, serial#,SQL_ADDRESS, status,PREV_SQL_ADDR from v$session where sid='xxxx' //(enter the sid value)

Step 4: select sql_text from v$sqltext where address='XXXXXXXX';

Step 5: select piece, sql_text from v$sqltext where address='XXXXXX' order by piece; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-05-03T05:32:17.847

您可以从数据库生成 AWR（自动工作负载存储库）报告。

从 SQL*Plus 命令行运行：

```
SQL> @$ORACLE_HOME/rdbms/admin/awrrpt.sql 
```

阅读与如何生成和理解 AWR 报告相关的文档。它将提供数据库性能和资源问题的完整视图。一旦我们熟悉了 AWR 报告，找到消耗资源的 Top SQL 将很有帮助。

此外，在 12C EM Express UI 中，我们可以生成 AWR。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-05-29T11:02:18.693

您可以使用以下查询检查长时间运行的查询详细信息，例如已完成百分比和剩余时间：

```
 SELECT SID, SERIAL#, OPNAME, CONTEXT, SOFAR, 
 TOTALWORK,ROUND(SOFAR/TOTALWORK*100,2) "%_COMPLETE" 
 FROM V$SESSION_LONGOPS 
 WHERE OPNAME NOT LIKE '%aggregate%' 
       AND TOTALWORK != 0 
       AND SOFAR <> TOTALWORK; 
```

有关故障排除步骤的完整列表，您可以在此处查看：[对长时间运行的会话进行故障排除](https://orahow.com/find-long-running-queries-in-oracle/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-09-03T16:47:52.277

您可以使用 v$sql_monitor 视图来查找运行时间超过 5 秒的查询。这可能仅在 Oracle 企业版中可用。例如，此查询将识别来自我的 TEST_APP 服务的运行缓慢的查询：

```
select to_char(sql_exec_start, 'dd-Mon hh24:mi'), (elapsed_time / 1000000) run_time,
       cpu_time, sql_id, sql_text 
from   v$sql_monitor
where  service_name = 'TEST_APP'
order  by 1 desc; 
```

注意 elapsed_time 以微秒为单位，因此 / 1000000 以获得更具可读性的内容

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-02-05T11:47:16.663

```
select sq.PARSING_SCHEMA_NAME, sq.LAST_LOAD_TIME, sq.ELAPSED_TIME, sq.ROWS_PROCESSED, ltrim(sq.sql_text), sq.SQL_FULLTEXT
  from v$sql sq, v$session se
 order by sq.ELAPSED_TIME desc, sq.LAST_LOAD_TIME desc; 
```

# php - 在 PHP 页面之间传递信息

> ID：622297
> 
> 赞同：5
> 
> 时间：2009-03-07T18:51:52.987
> 
> 标签：php, forms

如何在 PHP 页面之间传递信息？

例如，我有一个 PHP 脚本来处理来自表单的登录输入，然后有一个单独的 PHP 脚本来处理用户的进一步输入。但是，我希望第二个 PHP 文件接收来自登录表单的输入。本质上，我不希望相同的脚本为登录运行两次。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-07T19:50:30.680

您正在寻找 POST 和 GET 变量，这是在 HTML 表单的方法参数中完成的：

**登录.php**

```
<form name="myform" action="secondpage.php" method="post">
    <div>Username: <input type="text" name="username" value="" /></div>
    <div>Password: <input type="password" name="password" value="" /></div>
</form> 
```

然后在另一个页面中：

**第二页.php**

```
$username = isset($_POST['username']) ? $_POST['username'] : '';
$password = isset($_POST['password']) ? $_POST['password'] : '';
if ($username != '') {       
    // do your validations here
} 
```

## 解释

当您使用 GET 方法时，参数在 URL 中可见，因此假设我们更改 login.php 中的 method="GET"，您最终会得到类似 secondpage.php?username=jsmith&password=1234 的内容。然后你可以使用`$_GET['username']`.

使用 POST 可以发送更大量的数据（对 URL 的大小有一个[模糊的限制](http://www.boutell.com/newfaq/misc/urllength.html)）并且它在 URL 中不可见。您应该注意，**它仍然以明文形式发送**，因此并不意味着它是安全的。

POST 和 GET 是为了不同的目的而制作的。应该使用 GET 来提取您将来可能想要再次提取的信息，这些信息对于这一刻并不特殊。设置 mypage.php?product=123 很有用，因为您可能希望将此 URL 发送给朋友。当您要修改数据状态时应使用 POST：更新产品、创建新用户、删除文章等。这是你想要发生一次的事情。

## 结构

总之，我只想补充一点，通常您不一定要使用另一个 PHP 脚本来避免某些代码运行或不运行。因此，在不知道您的项目细节的情况下，我仍然可以说您可能想要做类似的事情以从相同的代码（例如表单的 HTML）中受益。

请注意它是简化的代码。

**登录.php**

```
<?php

    $error = false;
    $username = isset($_POST['username']) ? $_POST['username'] : '';
    $password = isset($_POST['password']) ? $_POST['password'] : '';
    // if, and only if something was posted... so not on first display
    if ($username != '') {       
        // do your validations here
        if ($properlyLogged) {
            session_start();
            $_SESSION['loggedAt'] = time();
            header('Location: http://localhost/secondpage.php');
            exit();
        } else {
            $error = true;
        }
    }

?>

<?php if($error): ?>Login failed. Please try again.<?php endif; ?>
<form name="myform" action="login.php" method="post">
    <div>Username: <input type="text" name="username" value="<?php echo($username) ?>" /></div>
    <div>Password: <input type="password" name="password" value="" /></div>
</form> 
```

**第二页.php**

```
<?php
    session_start();
    if (!isset($_SESSION['loggedAt'])) {
        // if not properly logged in, return user to login
        header('Location: http://localhost/login.php');
        exit();
    }
?>
You are now logged in! 
```

希望这就是你要找的！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-07T18:55:59.187

您可以使用 GET 或 POST 方法在页面之间传递信息。GET 会将您希望作为查询字符串传递的信息附加到 url，例如：

loginprocess.php?id=JSmith&pword=HelloThere（不完全推荐用于私人信息）

另一种方法是通过 POST 发送信息，使其对查询字符串隐藏。

更多示例可以在这里看到：[http ://www.tizag.com/phpT/postget.php](http://www.tizag.com/phpT/postget.php)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T12:17:09.170

只是对之前编写的内容的一个小补充：GET（参数化 URL）的限制是完整的 URL，这意味着 1024 个字符。如果您需要更多，则必须使用 post。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T18:55:44.257

如果数据不是那么大，您可以使用通过 URL（GET 变量）传递的数据将用户重定向到第二页。否则，只需在同一页面中运行 seconds 方法，并使用函数对可以包含的数据进行最终解析，如上述用户建议的那样。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T13:04:44.750

您可以利用 PHP 会话在 PHP 脚本之间共享数据。下面的基本示例，请[在此处](http://us2.php.net/manual/en/book.session.php)阅读更多内容。

**登录.php：**

```
<?php

// initializes the session //
session_start();

// save user name and password to session //
$_SESSION["username"] = 'someuser';
$_SESSION["password"] = 'somepassword';
$_sESSION["valid"] = true;

?> 
```

**第二页.php：**

```
<?php

// start session handler //
session_start();

// check for a valid session //
if (!isset($_SESSION["valid"])) header("Location: login.php\n\n");

// continue page code here //

?> 
```

# c - 将内存公开为只读

> ID：622300
> 
> 赞同：2
> 
> 时间：2009-03-07T18:54:02.327
> 
> 标签：c, memory-management, pointers

在 C 中，一个函数可以将它在较低级别“管理”的内存公开为只读给那些调用该函数的人（公开其地址）。`return * const`无效，但我想知道我是否忽略了编程滴答声？

谢谢。

```
const uint8_t * get_value(int index) 
{
static uint8_t data[2] = {0, 0};
return (const uint8_t *)&data[index];
}

int main(void)
{
uint8_t * value;
value = get_value(1);

*value += 1;
return 0;
} 
```

> **@j_random_hacker**对我的问题提出了一个很好的折衷方案，这给了我正在寻找的额外障碍，以防止随意滥用该数据。

```
typedef struct
{
    const uint8_t * value;
    const uint8_t size;

} readonly_t;

readonly_t get_value(int index, int size) 
{
    static uint8_t data[2] = {0, 0};
    uint8_t rsize;

    /* ... validate index, size params */

    readonly_t r = { &data[index], rsize };
    return r;
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-07T18:56:42.507

是C！你不能:)总有办法绕过它。做吧`const`，希望有人不会改变它。

如果您正在托管加载项或其他内容，则应在单独的进程中运行它以限制其对内存的访问。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T18:56:35.770

使用 VirtualProtect： http: [//msdn.microsoft.com/en-us/library/aa366898 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa366898(VS.85).aspx)

使用 PAGE_READONLY： http: [//msdn.microsoft.com/en-us/library/aa366786 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa366786(VS.85).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T18:58:21.380

不要返回指针，返回指向对象的值，如下所示：

```
uint8_t get_value(int index) 
{
    static uint8_t data[2] = {0, 0};
    return data[index];
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T01:54:06.863

内存保护不是'C'中的语言结构，它与硬件有关。例如，如果指针指向的内存在某个 ROM 区域之类的地方，则无法写入。反过来说，我们甚至可以在硬件级别上制作 ReadOnly 的部分，然后您可以预期会出现一些内存异常。

# php - 在 IIS 中使用 PHP 上传图片时的权限问题

> ID：622318
> 
> 赞同：2
> 
> 时间：2009-03-07T19:05:59.710
> 
> 标签：php, iis, imagemagick

我们刚刚将一个网站移到了一个新服务器上，两台服务器都是运行 IIS 作为 Web 服务器的 Windows Server 2003。

上传图片时，我们要求上传的文件对 NETWORK SERVICE 账户有一定的权限。图像使用 PHP 上传，然后 ImageMagick 使用 mogrify.exe 二进制文件过滤它们以调整大小，并放置在 PHP 创建的新文件夹中。

我们遇到的问题是上传的文件没有继承 NETWORK SERVICE 权限，尽管文件夹有。

我运行 filemon 以查看任何错误并得到以下信息：

mogrify.exe:6396 OPEN C:\inetpub\wwwroot\example.com\data\334480\test.jpg 访问被拒绝 NT AUTHORITY\NETWORK SERVICE

我们需要 NETWORK SERVICE 访问权限的原因是我们使用 ASP.NET 脚本来动态调整图像大小。我搜索了谷歌，但找不到解决方案。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T20:54:44.410

设法解决了这个问题，我将 php.ini 中的上传 tmp 目录更改为 C:\Test 并为测试提供了我需要的权限，我已经进行了此更改，但进一步检查 upload_tmp_dir 在 php.ini 文件中设置了两次。上传的文件继承临时目录的权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T19:09:41.713

您是否确保“网络服务”ACL 适用于“此文件夹、子文件夹和文件”，无论它被应用到哪里。另外，尝试使用相同的 ACL 在其他地方创建一个新文件夹，并查看 PHP 创建的文件是否继承了权限。

# ruby - 如何使用反射获取参数名称

> ID：622324
> 
> 赞同：22
> 
> 时间：2009-03-07T19:10:37.217
> 
> 标签：ruby, reflection

我想在 Ruby 中做一些相当繁重的反射。我想创建一个函数，该函数返回调用堆栈更高层的各种调用函数的参数名称（仅高一个就足够了，但为什么要停在那里呢？）。我可以使用`Kernel.caller`, 转到文件并解析参数列表，但这会很丑陋且不可靠。

我想要的功能将以下列方式工作：

```
module A
  def method1( tuti, fruity) 
    foo
  end
  def method2(bim, bam, boom)  
    foo
  end
  def foo
    print caller_args[1].join(",") #the "1" mean one step up the call stack
  end

end

A.method1
 #prints "tuti,fruity"
A.method2
 #prints "bim, bam, boom" 
```

我不介意使用[ParseTree](http://rubyforge.org/projects/parsetree/)或一些类似的工具来完成这项任务，但是看看 Parsetree，如何将它用于此目的并不明显。创建像[这样](http://eigenclass.org/hiki/ruby+backtrace+data)的 C 扩展是另一种可能性，但如果有人已经为我完成了它会很好。

我可以看到我可能需要某种 C 扩展。我想这意味着我的问题是 C 扩展的哪种组合最容易工作。我不认为 caller+ParseTree 本身就足够了。

至于我为什么要这样做，与其说“自动调试”，也许我应该说我想使用这个功能来自动检查函数的调用和返回条件：

```
def add x, y 
  check_positive
  return x + y
end 
```

如果不是肯定的，哪里`check_positive`会抛出异常。显然，它会比这更多，但希望这能提供足够的动力。`x``y`

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2010-03-16T05:30:51.370

在 Ruby 1.9.2 中，您可以通过以下方式轻松获取 any `Proc`（当然也包括 any `Method`or `UnboundMethod`）的参数列表`Proc#parameters`：

```
A.instance_method(:method1).parameters # => [[:req, :tuti], [:req, :fruity]] 
```

格式是符号对的数组：类型（必需、可选、剩余、块）和名称。

对于您想要的格式，请尝试

```
A.instance_method(:method1).parameters.map(&:last).map(&:to_s)
  # => ['tuti', 'fruity'] 
```

当然，这仍然无法让您访问调用者。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-09T06:36:41.240

我建议你看看 Merb 的 action-args 库。

```
require 'rubygems'
require 'merb'

include GetArgs

def foo(bar, zed=42)
end

method(:foo).get_args # => [[[:bar], [:zed, 42]], [:zed]] 
```

如果你不想依赖 Merb，你可以从[github 的源代码中](http://github.com/wycats/merb/tree/master/merb-action-args)选择和挑选最好的部分。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-07T19:42:01.183

我有一种非常昂贵的方法，而且几乎只能奏效。

```
 $shadow_stack = []

 set_trace_func( lambda {
   |event, file, line, id, binding, classname|
   if event == "call"
     $shadow_stack.push( eval("local_variables", binding) )
   elsif event == "return"
     $shadow_stack.pop
   end
 } )

 def method1( tuti, fruity )
   foo
 end
 def method2(bim, bam, boom)
   foo
   x = 10
   y = 3
 end

 def foo
   puts $shadow_stack[-2].join(", ")
 end

 method1(1,2)
 method2(3,4,4) 
```

输出

```
 tuti, fruity
 bim, bam, boom, x, y 
```

我很好奇为什么你会以如此普遍的方式想要这样的功能。

我很好奇您认为此功能如何允许自动调试？您仍然需要向“foo”函数注入调用。事实上，基于的东西`set_trace_func`更能够自动化，因为你不需要接触现有的代码。实际上，这就是 debug.rb 的实现方式，就 set_trace_func 而言。

正如您概述的那样，您的精确问题的解决方案基本上是。使用调用者+分析树，或打开文件并以这种方式获取数据。我知道没有反射功能可以让您获得参数的名称。您可以通过获取关联的方法对象并调用`#arity`然后推断`local_variables`参数是什么来批准我的解决方案，但是尽管看起来该函数的结果是有序的，但我不确定依赖它是否安全。如果你不介意我问，一旦你有了你描述的数据和界面，你打算用它做什么？当我想象使用此功能时，最初想到的并不是自动调试，尽管这可能是我的想象力失败。

* * *

啊哈！

那时我会以不同的方式处理这个问题。已经有几个 ruby​​ 库用于按合同进行设计，包括 ruby​​-contract、rdbc 等。

另一种选择是编写如下内容：

```
 def positive
   lambda { |x| x >= 0 }
 end

 def any
   lambda { |x| true }
 end

 class Module
   def define_checked_method(name, *checkers, &body)
     define_method(name) do |*args|
       unless checkers.zip(args).all? { |check, arg| check[arg] }
         raise "bad argument"
       end
       body.call(*args)
     end
   end
 end

 class A
   define_checked_method(:add, positive, any) do |x, y|
     x + y
   end
 end

 a = A.new
 p a.add(3, 2)
 p a.add(3, -1)
 p a.add(-4, 2) 
```

输出

```
 5
 2
 checked_rb.rb:13:in `add': bad argument (RuntimeError)
         from checked_rb.rb:29 
```

当然，这可以做得更加复杂，这确实是我提到的库所提供的一些内容，但也许这是一种让你到达你想去的地方而不必走你计划用来到达那里的路径的方法？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-18T16:32:22.593

如果您也想要默认值的值，那么还有“参数”gem

```
$ gem install rdp-arguments
$ irb
>> require 'arguments'
>> require 'test.rb' # class A is defined here
>> Arguments.names(A, :go) 
```

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2009-03-07T21:07:24.940

> 实际上，您描述的方法显然无法区分参数和局部变量，同时也无法自动工作

那是因为您尝试做的事情不受支持。这是可能的（在 ruby​​ 中一切皆有可能），但没有记录或已知的方法可以做到这一点。

您可以像 logan 建议的那样评估回溯，或者您可以破坏 C 编译器并破解 ruby​​ 的源代码。我有理由相信没有其他方法可以做到这一点。

# mysql - 如何制作阈值或限制 mysql 表？

> ID：622326
> 
> 赞同：1
> 
> 时间：2009-03-07T19:12:55.370
> 
> 标签：mysql

我有一个表，我只想有**20 个最近的条目**，因为该表每 0.50 秒添加一行。

我将如何在查询数据库（mysql）时完成此操作。

每当我想推入新值时，是否应该添加新行并删除最旧的行？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T19:15:14.243

您可以创建一个[视图](http://dev.mysql.com/doc/refman/5.1/de/create-view.html)。为了保证按最近性排序，请引入一个带有时间戳的列以进行排序（或在使用顺序编号时使用主键，例如 AUTO_INCREMENT）。

```
CREATE VIEW latest_entries AS 
SELECT ... FROM TABLE foo ORDER BY created_time LIMIT 20; 
```

此外，不要忘记不时“清理”基础表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T19:39:25.043

如果您真的想在插入新行时清除表的第 20 行，则必须在插入时删除该行。最好的方法是创建一个[触发器](http://dev.mysql.com/doc/refman/5.1/en/create-trigger.html)来为您完成这项工作。

```
CREATE TRIGGER Deleter AFTER INSERT on YourTable FOR EACH ROW
BEGIN
    Delete from yourTable where ID = (Select max(id) from yourTable);
END; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T19:30:19.480

*是的，如果您总是*必须在表中只有最新的 20 行，则每次插入时都需要删除比第 20 个最旧的行更早的所有行。

您可以有一个返回最新 20 行的视图，但如果您所做的只是插入，您的表仍会增长。

最好的解决方案可能是使用视图进行查询，不要在每次插入时都删除，而是每天在休息时间运行一次删除，只留下最新的 20 行。

只要确保时间戳列被索引。

# .net - 网站部署中的文件

> ID：622329
> 
> 赞同：1
> 
> 时间：2009-03-07T19:14:17.990
> 
> 标签：.net, asp.net, asp.net-mvc, deployment

当我进行 ASP.NET（MVC 或非 MVC）部署时，我必须交付哪些文件？我只想知道绝对必要的文件。另外，我怎样才能混淆其中的一些以防止反编译？我不想使用发布向导，因为它需要在服务器上安装 FrontPage 扩展。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T19:21:08.080

为什么不直接使用发布向导？

构建->发布

至于混淆，它并没有真正阻止很多人，但是 Visual Studio Pro 和更高版本包含一个免费版本的 dotFuscator。如果您没有专业版，那么您可以使用 {smartassembly} 或 .NET Reactor 之类的东西，但老实说，这几乎不值得费心，因为混淆不会阻止任何坚定的一方。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T19:28:33.400

如果您编译您的 ASP.NET 应用程序，那么您可以省略 CS 文件（那些已经编译成 DLL）。为什么要混淆文件？他们只会在网络服务器上。要对 DLL 进行模糊处理，您可以使用 Visual Studio 中的 Dotfuscator。如果你用谷歌搜索，你会发现许多其他（甚至是免费的）混淆器（但如果你真的想要一个严重的混淆，那么你需要购买商业产品）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T18:59:58.527

发布选项是要走的路。如果没有，您很可能会犯错误并发布错误的文件。它不需要 Front Page 扩展，并允许您使用 Ftp 或您有权访问的任何文件夹位置进行发布。

如果您确实需要手动部署，请复制整个网站，并在需要时删除文件背后的代码（.cs 或 .vb 文件）。

# asp.net - 在 localhost 中设置 IIS 作为 Web 开发服务器

> ID：622336
> 
> 赞同：8
> 
> 时间：2009-03-07T19:25:23.530
> 
> 标签：asp.net, asp.net-mvc, iis

如何在 Visual Studio 2008 中将 IIS 5.1 设置为我的 Web 开发服务器？我使用的是 Win XP，我使用的是 Cassini，但我想给 IIS 一个托盘而不是。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-07T19:30:33.190

1.  进入控制面板 -> 添加删除程序 -> 启用/禁用 Windows 功能，找到 IIS 并安装它。

2.  转到开始 -> 附件 -> 管理工具 -> IIS 管理器

3.  右键单击网站，添加一个新网站，将主目录指向您网站的根目录。

4.  打开本地主机

5.  ？？？

6.  利润！

您可能必须将 Visual Studio 附加到 ASP.NET 辅助进程才能进行调试。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-07T19:33:54.277

它位于 Web 项目的属性页中，位于 Web-> 服务器->“使用本地 IIS Web 服务器”下

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T23:06:05.997

要将 Visual Studio 附加到 ASP.NET 辅助进程以进行调试，请转到菜单工具\附加到进程或按 CTRL + ALT + P 并选择 aspnet_wp.exe 或 w3wp.exe。

更多信息[在这里](http://www.learn2debug.com/articles/visual-studio-net/debugging-an-asp-net-web-application-with-visual-studio-net.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-01T17:26:46.360

要使用带有 IIS 而不是“ASP.NET 开发服务器”的 Visual developer 2008 开发网站，请在“位置”下的新网站窗口中单击“浏览”以查看不同的服务器选项，包括 IIS 服务器。用户可以选择服务器作为 IIS 服务器而不是“文件系统”，那么“位置”选项将是“HTTP”而不是“文件系统”。

在 Visual developer 2008 下的 Properties->Start Option->Server->"Use local IIS server" 选项没有显示，即使 IIS 服务器已成功安装和配置。显示的唯一选项是“使用默认服务器”和“使用带有基本 URL 的自定义服务器”。

所以在 Visual developer 2008 中要在 IIS 服务器上运行（如果安装了 IIS 服务器），需要执行以下操作：

新建网站 -> 在 Locations 下点击“浏览” -> 点击“Local IIS”，然后选择“IIS Virtual Directory”（IIS 虚拟目录，即用户在配置 IIS 服务器时创建的目录） -> 打开

在运行/调试时，您在创建网站时选择的服务器，将使用同一台服务器打开网站，也就是说，在创建网站时，如果您选择“IIS 服务器”，那么网站将通过 IIS 服务器打开。

还有一件事是，在安装 Visual developer 2008 和 IIS 服务器时，如果您在安装 Visual Studio 之后安装了 IIS 服务器，那么您需要在创建新网站之前执行以下操作：

运行->cmd 按回车（然后输入以下命令）-> C:\WINDOWS\Microsoft.NET\Framework\Version# aspnet_regiis -i 按回车 3 秒后收到消息“ASP.net 安装成功”。（*版本号在大多数情况下为 v2.0.50727）

在一切之前，请确保您已经安装并配置了 IIS 服务器。要了解如何安装和配置 IIS 服务器，请查看以下链接： [http ://chalaki.com/install-iis6-windows-xp-professional-sp3-setup-run-csharp-cgi/425/](http://chalaki.com/install-iis6-windows-xp-professional-sp3-setup-run-csharp-cgi/425/)

希望这可以帮助。

# java - Java中有没有类似RhinoMocks的东西？

> ID：622337
> 
> 赞同：2
> 
> 时间：2009-03-07T19:25:50.190
> 
> 标签：java, mocking, rhino-mocks

最接近的相似之处是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T19:30:50.413

你也可以试试[EasyMock](http://www.easymock.org/)。RhinoMocks 是基于 EasyMock.NET 引擎构建的，因此有很多相似之处。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T19:27:51.280

我知道[JMock](http://www.jmock.org/)与 RhinoMocks 非常相似。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-21T11:45:04.940

看看 Mockito（.net 和 java 模拟）

[http://code.google.com/p/mockito/](http://code.google.com/p/mockito/)

# xml - 为什么在 AS3 中，XML 和 XMList 是不相关的（继承方面）类？

> ID：622338
> 
> 赞同：2
> 
> 时间：2009-03-07T19:26:44.527
> 
> 标签：xml, actionscript-3, e4x

我不禁认为，使 XML 和 XMLList 都无关，因为两者都直接扩展 Object，这是 AS3 核心库中的设计缺陷。当然，让 XML 扩展 XMLList 会是一个更简洁的系统，其中 XML 被认为是只有一个成员的 XMLList？

这也将避免 E4X 查询可能返回 XML 或 XMLList 的非常烦人的做法，这可能会导致转换错误。

那么有什么理由我不认为 XML 和 XMLList 被设计为仅将 Object 作为一种通用类型？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T08:16:43.223

似乎根据E4X (p22)的[ECMA 规范和](http://www.ecma-international.org/publications/standards/Ecma-357.htm)[XMLList 文档](http://livedocs.adobe.com/flex/2/langref/XMLList.html)，*XMLList*类确实包含*XML*类的方法，但仅当有一个成员时。因此，在执行 E4X 查询时，结果应始终存储在*XMLList*类型的变量中。

之前，由于这些对象的命名，我假设一个*XML*对象代表一个 XML 元素数据的复杂树，但根据[规范](http://www.ecma-international.org/publications/standards/Ecma-357.htm)（p12），这不是真的，“每个*XML*类型的值代表一个 XML 元素，属性、注释、处理指令或文本节点”。

应该将*XMLList*类用作两者中更通用的类型：“ *XMLList*类型的值表示 XML 文档、XML 片段或 XML 对象的任意集合（例如，查询结果）”

所以这解决了我的转换问题，因为我不应该将 E4X 查询存储为*XML*类型的变量。我应该只使用*XML*类来迭代*XMLLists*和分解 XML 元素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-11T09:08:12.140

所以我对这个问题的简洁回答是，从继承树看来，是的，这两个类（*XMLList*，*XML*）是不相关的。

但是，通过查看 ECMA 脚本/AS3 文档，它们是相关的，很可能使用 ECMA 脚本/AS3 的原型系统。

当一个*XMLList*只有一个成员时，它可以被视为一个 XML 节点。我假设 XML 类的方法和字段是由 AVM2 插入到 XMLList 原型中的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-20T22:58:02.330

正如您所注意到的，自动更改的 XML 和 XMLList 类型会变得相当混乱。当聪明的程序员（在这里指向 Adob​​e ..）制作方便的包装器时，就会发生这种事情。

正在发生的是一种“自动类型转换”。它并不止于 XML 类型。考虑这个示例 XML：

```
<myXml>
    <sound id="0">Boogaloo</sound>
    <sound id="1">Bond theme</sound>
    <sound id="2">2001</sound>
</myXml> 
```

假设我在一个名为`myXml`. 在以下示例中，E4X 返回一个带有一个项目的 XMLList，我们使用以下命令访问第一个 XML 项目`[0]`：

```
trace(myXml.sound.(@id == 0)[0] == <sound id="0">Boogaloo</sound>);
// traces true 
```

在这个例子中，我们省略了`[0]`部分，依赖于 Flash 的自动类型转换。返回的一项将转换为 XML：

```
trace(myXml.sound.(@id == 0) == <sound id="0">Boogaloo</sound>);
// traces true 
```

但是如果这个匹配的 XML 节点包含一个简单的文本节点，Flash 会自动将该类型进一步转换为字符串：

```
trace(myXml.sound.(@id == 0) == "Boogaloo");
// traces true 
```

如果文本节点可以解释为数字（ID 为 2 的 XML 节点），Flash 会进一步将其*转换*为数字！

```
trace(myXml.sound.(@id == 2) == 2001);
// traces true 
```

哇！

**那么，该怎么办呢？**

正如您所注意到的，您必须非常小心类型和“方便”的 XML 处理。一个建议的做法是始终使用数组访问运算符来指向 E4X 结果的第一个 XML 项，当您知道您需要单个结果时：

```
config.users.admin[0].settings[0].email.(@type == "work")[0]; 
```

一开始它看起来很奇怪，并且给代码增加了冗长，但好处是你明确地说你正在寻找*一个* `admin`元素、*一个* `settings`元素和*一个* `email`type 元素`"work"`。而且你习惯了它的外观。

另一个提示是始终记住转换为您期望使用的类型。一些例子：

```
allUsers       = XMLList(config.users);
adminSettings  = XML(config.users.admin[0].settings[0]);
adminWorkEmail = String(config.users.admin[0].settings[0].email.(@type == "work")[0]);
adminBirthYear = int(config.users.admin[0].birthdate[0].@year[0]); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-22T14:59:51.420

在 ActionScript 3.0 中，XMLList 是处理 xml 的新方法，因为 XML 类是 AS 2 的东西，所以它被包含以提供向后兼容性。

如果您编写新代码，您现在应该使用 XMLList。

希望这可以帮助

乔恩

# c++ - 哪个是最好的、标准的（并且希望是免费的）C++ 编译器？

> ID：622339
> 
> 赞同：5
> 
> 时间：2009-03-07T19:27:24.883
> 
> 标签：c++, debugging, compiler-construction, standards

Saludos a todos en stackoverflow.com！

所以...我是一个 C++ 新手，目前正在研究数据结构，我想和你们咨询一些事情：

自从我开始学习系统工程以来，我一直在为我的所有编程项目使用最新版本的 Dev-C++。到目前为止它做得很好，但它有一个致命的缺陷......试图在其中调试你的代码它只是......非常痛苦！每次激活调试模式时，您都必须交叉手指并希望它不会在您正在观看的变量甚至发生变化之前崩溃。

然后，我想使用 Microsoft 的 Visual-C++，因为它也是免费的；但是，我问了我的老师并告诉我不要在课程中使用它，因为它不是标准的（其中编译的程序仅适用于 Windows）；我们需要编写可以在 Windows 和 Linux 环境中编译的代码，并且一旦在任何环境中编译，就能够在两种环境中使用该应用程序。

所以人们，我希望你给我建议：那里的 C++ 编译软件具有强大和/或稳定的调试模式，实现标准编译器（顺便说一下，它是否称为 g++？？），并且希望它是免费的？ ??

感谢您的关注。Gracias y hasta luego ^_^（顺便说一句，第一次发帖快乐！！！^o^）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-07T19:32:42.640

有一个用于 Windows 的 g++ 和 GDB（Gnu 调试器）实现，称为 Mingw，效果很好。虽然我猜您也在寻找图形 IDE/调试器，但我会向您指出 Eclipse。Eclipse 的 C 开发工具包括与 Mingw 构建工具和 GDB 的出色接口。此外，关于您对在 Windows 和 *nix 上使用的已编译程序的评论，据我所知，这是不可能的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-07T19:53:34.913

这取决于您所说的“标准”是什么意思。无论如何，您将不得不在 linux 和 windows 上编译您的代码。无法创建将在两者上运行的可执行文件。只需在 windows 上使用 VS 编译和调试，然后确保它也在 linux 上的 GCC 下编译和运行。

我认为他只是希望您在两者上使用相同的编译器，因此您不必处理*编译器*之间的差异。我认为这对你有好处。编写可以在多个编译器上编译的代码很重要，因为它向您展示了标准的哪些部分真正*是*标准的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-07T19:32:01.410

[Code::Blocks](http://www.codeblocks.org/) - 它是免费的，它是跨平台的，非常好。您可以下载由 CB IDE、MinGW C++ 编译器和 gdb 调试器组成的包。安装非常简单。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-07T19:33:12.997

听起来您要的是 IDE（集成开发环境）。

Eclipse 可能对你有好处。它在 Windows 和 Linux 上均受支持。

[http://www.eclipse.org/cdt/](http://www.eclipse.org/cdt/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-07T19:35:44.583

就编译器本身而言，GCC 是您最好的选择。它是最纯粹意义上的编译器，尽管它没有本地接口。

我会寻找一个可以附加的良好发展环境。

偏离这一点，我现在对 IDE 的个人偏好是 eclipse，但这确实是个人的事情。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-08T04:18:56.463

如果仅使用 C++ 的标准功能，则可以使用 Visual Studio Express C++。您没有义务使用编译器的仅 Windows 扩展：MFC、ATL、Wizards 等。

但是，如果您想使某些东西具有可移植性，那么尝试同时针对两种编译器（GCC 和 VS）确实是一个更好的练习。

最近诺基亚还发布了一个新的多平台 ide QtCreator，它是第一个版本，但至少值得考虑。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-07T19:34:59.577

MinGW 与@Colfax 状态一样好。考虑`ddd`与 Cygwin 一起使用，这使得使用`gdb`更容易。看到这个[问题](https://stackoverflow.com/questions/198248/whats-the-bare-minimum-cygwin-install-to-have-ddd-running-properly-on-xp)

但是等等……Qt 4.5 不是作为 LGPL 发布的，现在不是一个很棒的免费工具吗？看[这里](http://www.qtsoftware.com/downloads)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-07T22:32:00.230

作为一个 linux 人，我认为最好的体验来自[GVIM](http://www.vim.org/download.php#pc)作为编辑器和 Mingw 作为编程环境。GCC 是标准，但[LLVM-GCC](http://www.llvm.org)非常有前途，并带有一个可以在 Windows 中使用的 Mingw 构建。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-12-05T19:24:01.970

我从开始学习编程时就开始使用 DevC++。我喜欢它。只是不能更改为另一个编译器，所以我使用 wxDevC++ 仍然维护的 DevC++ 版本。

# linux - Linux 中的调度：在计算机空闲时运行任务（= 没有用户输入）

> ID：622367
> 
> 赞同：8
> 
> 时间：2009-03-07T19:51:45.700
> 
> 标签：linux, scheduling

我只想在我的 Ubuntu 8.10机器上运行[Folding@home客户端，因为该程序的 RAM 消耗量很大。](http://folding.stanford.edu/ "折叠@home")

“空闲”是指没有用户活动（键盘、鼠标等）时的状态。由于 F@H 具有最低的 CPU 优先级，因此此时运行其他（可能很重的）进程是可以的。重点是改善用户体验，在无人使用机器的情况下做繁重的工作。

如何做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-07T20:19:37.457

当有问题的机器是桌面时，您可以将启动/停止脚本挂接到屏幕保护程序中，以便在屏幕保护程序处于非活动状态时停止进程，反之亦然。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-07T20:06:36.957

安排进程仅在系统空闲时才*出现是很繁琐的。*

实际上在这些条件下启动程序并不难。您必须安排程序彻底关闭，并弄清楚如何以及何时执行此操作。

您必须能够区分该进程自己的 CPU 使用率和可能正在运行的其他程序的 CPU 使用率，以便您可以判断系统是否正确“空闲”。

仅在系统空闲时才*安排进程**要*容易得多。只需使用“nice”命令启动 Folding@Home 客户端。

 *但是，这并不能解决内存不足的问题。如果您启用了交换空间，系统应该能够交换任何低优先级的进程，这样它们就不会消耗实际资源，但要注意每次 Folding@Home 客户端都会对磁盘 I/O 造成重大影响换入和换出 RAM。

ps RAM现在很便宜...

pp看这篇[文章](http://forums.opensuse.org/install-boot-login/407358-looking-linux-process-list.html#post1941735)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-12T09:11:09.830

可能是您需要通过 nice 设置空闲任务的最低优先级。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-07T20:20:21.277

您将需要查看一些确定“空闲”的内容并探索[sysinfo()](http://sources.redhat.com/ml/glibc-linux/2000-q1/msg00102.html)调用（链接指出了它在不同内核版本之间填充的结构的差异）。

Linux 不以典型的方式管理内存。不要只看负载，还要看内存。特别是 /proc/meminfo 有一个以 Committed_AS 开头的精彩行，它向您显示内核实际承诺给其他进程的内存量。将其与您从 sysinfo 中了解到的内容进行比较，您可能会意识到一分钟的平均负载为 0.00 并不意味着该运行某个想要分配 256MB 内存的程序的时间，因为内核可能真的超卖了。注意，由 sysinfo() 填充的所有值都可以通过 /proc 获得，sysinfo() 只是获取它们的一种更简单的方法。

您还想查看自启动以来每个内核在 IOWAIT 中花费了多少时间，这是一个更强有力的指标，表明您是否应该运行 I/O 资源消耗。在 /proc/stat 中获取该信息，第一行包含所有 CPU 的总计数。IOWAIT 在第 6 场。当然，如果您打算为单个 CPU 设置亲和力，那么只有那个 CPU 会感兴趣（它仍然是第六个字段，以 USER_HZ 为单位或通常以 100 秒为单位）。对 btime 进行平均，也可以在 /proc/stat 中找到。

简而言之，不要只看负载平均值。

**编辑**

您不应该假设缺少用户输入意味着空闲.. cron 作业往往会运行.. 公共服务不时被征税等等。空闲仍然是您根据阅读我上面列出的值（或更多）的最佳猜测.

**编辑 2**

查看 /proc/sys/vm 中的旋钮值还可以很好地指示*用户*认为什么是空闲的，特别是交换性。我意识到你只在你自己的盒子上这样做，但这是一个权威的维基，问题标题是通用的:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-07T19:54:57.750

文件[/proc/loadavg](/proc/loadavg)具有系统当前负载。您可以编写一个 bash 脚本来检查它，如果它很低，则运行该命令。然后您可以将其添加到 /etc/cron.d 以定期运行它。

> 此文件包含有关系统负载的信息。前三个数字代表系统上活动任务的数量——实际运行的进程——在过去 1、5 和 15 分钟内的平均值。下一个条目显示当前可运行任务的瞬时数量 - 当前计划运行而不是在系统调用中被阻止的进程 - 以及系统上的进程总数。最后一项是最近运行的进程的进程 ID。

**示例输出：**

```
0.55 0.47 0.43 1/210 12437 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-05T15:59:46.123

如果您使用的是 GNOME，请查看以下内容：

[https://wiki.gnome.org/Attic/GnomeScreensaver/FrequentlyAskedQuestions](https://wiki.gnome.org/Attic/GnomeScreensaver/FrequentlyAskedQuestions)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-08T07:18:00.550

有关检查系统何时空闲（通过 gnome 屏幕保护程序）的 perl 脚本，请参阅此线程。
您可以在怠速开始和停止时运行命令。
我将它与一些脚本一起使用，以在空闲时更改 BOINC 首选项
（为 BOINC 提供更多内存和 cpu 使用率）。

[ubuntu 论坛上的 perl 脚本](http://ubuntuforums.org/showthread.php?t=1029704 "ubuntu 论坛上的 perl 脚本")

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-08-24T15:44:21.737

您可以使用**xprintidle**命令来查看用户是否空闲。该命令将从与 X 服务器的最后一次交互开始以毫秒为单位打印值。

这是用户离开时可以启动/停止任务的示例脚本：

```
#!/bin/bash

# Wait until user will be idle for provided number of milliseconds
# If user wasn't idle for that amount of time, exit with error
WAIT_FOR_USER_IDLE=60000

# Minimal number of milliseconds after which user will be considered as "idle"
USER_MIN_IDLE_TIME=3000

END=$(($(date +%s%N)/1000000+WAIT_FOR_USER_IDLE))

while [  $(($(date +%s%N)/1000000)) -lt $END ]
do
    if [ $(xprintidle) -gt $USER_MIN_IDLE_TIME ]; then
        eval "$* &"
        PID=$!
        #echo "background process started with pid = $PID"
        while kill -0 $PID >/dev/null 2>&1
        do
            if [ $(xprintidle) -lt $USER_MIN_IDLE_TIME ]; then
                kill $PID
                echo "interrupt"
                exit 1
            fi
            sleep 1
        done
        echo "success"
        exit 0
    fi
    sleep 1
done 
```

当用户空闲时，它将接受所有参数并将它们作为另一个命令执行。如果用户将与 X 服务器交互，那么正在运行的任务将被**kill**命令杀死。

一个限制 - 您将运行的任务**不应**与 X 服务器交互，否则它将在启动后立即被终止。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2022-02-13T18:25:34.350

我想要类似的东西，`xprintidle`但在我的情况下不起作用（Ubuntu 21.10，Wayland）

我使用以下解决方案来获取空闲电流值（没有鼠标/键盘输入的时间）：

```
dbus-send --print-reply --dest=org.gnome.Mutter.IdleMonitor /org/gnome/Mutter/IdleMonitor/Core org.gnome.Mutter.IdleMonitor.GetIdletime 
```

它应该以毫秒为单位返回 uint64 时间。例子：

```
$ sleep 3; dbus-send --print-reply --dest=org.gnome.Mutter.IdleMonitor /org/gnome/Mutter/IdleMonitor/Core org.gnome.Mutter.IdleMonitor.GetIdletime
method return time=1644776247.028363 sender=:1.34 -> destination=:1.890 serial=9792 reply_serial=2
uint64 2942 # i.e. 2.942 seconds without input 
```

# java - 如何使用 Java 对显示的 HTML 进行“截图”？

> ID：622369
> 
> 赞同：2
> 
> 时间：2009-03-07T19:52:48.130
> 
> 标签：java, html, screenshot

您知道如何将 HTML 转换（保存）为图像吗？任何格式都是可以接受的：jpg、png、...我试过这段[代码](http://forums.sun.com/thread.jspa?threadID=5345288)，但它不能正确地从 HTML（`<img>`标签）转换图像。

最好使用 Java 解决方案；但是，我会赞赏任何方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T22:37:38.407

好吧，至少这是一个解决方案的概要：
您需要一个 HTML 渲染器（Gecko、Webkit 等）。然后你需要捕获它的“输出”。

首先想到的方法是

*   使用开源渲染引擎自己创建一个批处理工具 - 然后将其渲染为图像。这可以使用 Qt 和 QWebKit 来完成，甚至可以使用 Qt Jambi（用于 java）。[在](http://labs.trolltech.com/blogs/2009/01/15/capturing-web-pages/)Qt 开发者博客中，有一个 c++ 示例。
*   自动化 X11 浏览器并`capture`用于捕获窗口的内容。可能是滚动的问题，IDK。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T22:29:01.577

一种解决方案是使用[WebDriver](http://code.google.com/p/webdriver/)

本文可以提供另一种解决方案：[Capture screenshots with Selenium](http://binil.wordpress.com/2006/12/22/taking-screenshots-with-selenium/)

它们都是 Java 解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T22:27:14.203

您的描述对您尝试做的事情有点害羞。你能提供更多细节吗？

如果您只是想获取 html 并为其制作图像，您可能想要尝试的是创建一个新图像并将 html 作为文本插入图像中。完成后，您可以将图像保存为您选择的类型。我不知道这是否是你正在寻找的。

# javascript - 在 javascript 和 Math 对象中扩展 Number.prototype？

> ID：622374
> 
> 赞同：31
> 
> 时间：2009-03-07T19:53:40.763
> 
> 标签：javascript, oop, prototype, methods

我一直想知道为什么 Javascript 有全局 Math 对象而不是给数字自己的方法。有充分的理由吗？

做这样的事情还有什么缺点（除了效率）吗？：

```
Number.prototype.round = function(){
    return Math.round(this);
}; 
```

为了清楚起见，我知道像 π 这样的常数需要在某个地方以及应用于多个数字（如 min/max）的函数。问题主要是关于仅影响单个数字的方法，例如 round、abs、sin、pow 等。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-07T22:52:28.167

`Number.prototype`除了混淆其他人之外，扩展没有任何缺点。重点是什么？什么是更好的使用`value.round()`而不是`Math.round(value)`？

这个对象有几个很好的理由`Math`：

1.  `Math.round("5")`它也适用于非数字：`value.round()`当 value 是字符串时有效（例如，文本框的值）
2.  Math 对象的某些成员不属于“主要”数值，例如`Math.min()`or `Math.max()`。还是您想像这样使用它`a.max(b)`？
3.  其他成员是全球性的，不属于专门的编号。示例是常量，如`Math.PI`或 函数`Math.random()`。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-09T10:58:08.600

对象的原因`Math`很简单：“因为 Java 做到了”。不是最好的理由，但我们在这里。我想当时的事情更有意义，在道格拉斯·克罗克福德开始他的运动以压制一半的语言*之前。最初你被“允许”或意味着做这样的事情：

```
with (Math) {
  var n = min( round(a) * round(b), sqrt(c) );
  var result = exp( n + d );
} 
```

扩展的缺点`Number.prototype`是其他人可能会做同样的事情。或者更糟糕的是，例如，定义`Number.prototype.round`为*对称*舍入函数。

如果您正在寻找让生活更轻松的方法，为什么要停在那里？为什么不简单地将`Math`函数包含为全局函数？

```
var m = 'abs acos asin atan atan2 ceil cos exp floor log max min ' +
        'pow random round sin sqrt tan PI').split(' ');
for (var i=0,l=m.length; i<l; i++) {
  window[ m[i] ] = Math[ m[i] ];
} 
```

这会将所有数学函数放到全局范围内，从而有效地让您停止键入“数学”。问问自己：使用这些功能进行扩展`Number`和扩展之间有什么真正的区别吗？`window`

* 在你激怒我之前：Crockford 的评论并不意味着太认真。我同意他`with`在隐含的全球环境中非常危险的观点。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2010-10-26T09:51:00.107

尝试做`123.round();`

您的 javascript 控制台将向您抛出数百个错误：P，不...

你可以做：

`Number.prototype.x`然后：`(123).x();`但从来没有`123.x();`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T20:33:02.730

我认为 Math 不仅仅是一组 Number 方法。它的使用范围更广。比如说，使用 NumberVariable.PI 可能会令人困惑。与随机数生成相同。

我也认为扩展数字是可以的，因为它是 JS 自然的一部分。如果我在这里错了，也许有人会纠正我。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-01-24T07:52:44.603

我相信以这种方式调用它也很有效，因为 Number 的原型函数就像所有其他 Object 的原型函数一样工作：

```
5.5["round"]();
//should return 6 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-10-25T09:09:53.020

所以，关于它是否是一个好主意的对话，你可以做到这一点。

您可以执行 123.x() 但 js 的解释器已损坏（因为它不会将点解释为消息调度）

奇怪的是，您可以改用 123 .x() （数字和点之间有一个空格），它会起作用。

123..也可以，但那是因为你已经有效地做了一个小数，然后发送给它

> (typeof 123.) === 'number') // true

尝试：

> Number.prototype.times = function(other) { return this * other }; 3.次（5）；

在控制台中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-03-13T18:51:12.360

我对此的看法是，如果您进行适当的检查以不覆盖本机功能，在了解本机命名标准的情况下命名，并使您的代码更具可读性和可管理性，然后使您的代码舒适和方便。

```
if (Number.prototype.round == null)
    Number.prototype.round = function() { return Math.round(this); } 
```

至于使用它，由于 javascript 的性质，我相信最好的方法是：

*   将数字包装在变量中，而不是简单的静态值（大多数情况下）

    *   nNum.round();
*   将简单的静态值包装在括号中：
    *   (123).round();
*   使用方括号表示法调用
    *   123[“圆形”].call();

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-08-21T12:43:29.403

你可以这样做

```
Number.prototype.round = function() {
    return Math.round(this.valueOf());
}; 
```

[https://www.w3schools.com/jsref/jsref_prototype_num.asp](https://www.w3schools.com/jsref/jsref_prototype_num.asp)

# java - 如何使用双缓冲在 Java 中显示 Pacman 的嘴巴打开/关闭动画？

> ID：622375
> 
> 赞同：0
> 
> 时间：2009-03-07T19:54:35.817
> 
> 标签：java, 2d, sprite, pacman

我正在尝试在我正在制作的一次性 pacman 游戏中展示 pacman 角色著名的张嘴/闭合动画，以自学游戏编程。

我正在做的是绘制张开的嘴巴图像，然后在完全相同的（x/y）位置重新绘制闭合的嘴巴图像。但这不起作用，我只是一直看到闭口动画。

如果我把它放在一个循环中，系统就会冻结，你会看到张开嘴的图像在闪烁，但你看不到被替换的图像。

我已经测试并确保两个图像都按预期正确加载。

这是我的`startAnim()`函数，当您双击小程序时调用它：

```
public void beginGame() //Called from engine.java
{
    isRunning=true;
    repaint();
    pacman.startAnim();
}

public void startAnim() //In different class, pacman.java
{
    Image orig;
    while (engine.isRunning)
    {
        orig=this.getCurrentImg();
        draw(engine.getGraphics());
        this.setCurrImg(currImg2);
        this.draw(engine.getGraphics());
        this.setCurrImg(orig);
        this.draw(engine.getGraphics());
        try
        {
            Thread.sleep(100);
        }
        catch (InterruptedException e) {}
    }
}

public void draw(Graphics g) //Called from engine.paint()
{
    g.drawImage(getCurrentImg(), getX(), 
            getY(), engine);
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T20:02:57.357

你必须在两张图片之间睡觉。否则你只会看到最后绘制的图像。

例如。

```
while( running )
{
    image 1
    draw
    sleep
    image 2
    draw
    sleep
} 
```

像这样的东西：

```
public void startAnim() //In different class, pacman.java
{
                            final int  cnt  = 2;
    Image[] imgs = new Image[ cnt  ];
    int         step = 0;

    imgs[ 0 ] = closedMouthImage;
    imgs[ 1 ] = openMouthImage;

            while ( engine.isRunning )
            {
                this.setCurrImg( imgs[ step ] );
                    draw(engine.getGraphics());
                step = ( step + 1 ) % cnt;
                    try
                    {
                                Thread.sleep(100);
                    }
                    catch (InterruptedException e) {}
            }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T20:15:25.720

正如 sfossen 所说，您需要在绘制图像之间进行延迟。

还有一些其他的事情要考虑。

*   对于流畅的动画，您可能需要的不仅仅是“张嘴”和“嘴巴闭合”的图像。您需要两个或三个中间图像。
*   为了使资源管理更容易，您可能希望将所有动画帧放在一个单一的宽幅图像中，看起来像“幻灯片”。然后，要绘制一个框架，您可以使用您感兴趣的框架的 (x, y) 偏移量。
*   最后，如果您每次通过程序的主循环时都绘制所有帧，那么每次移动吃豆人时，吃豆人都会完全咬住他。您应该考虑每次通过主循环仅绘制一帧并使用变量来跟踪您所在的帧。

示例（伪代码）

```
frameWidth = 32
frameIndex = 0
while(running) {
  // Draw just the frame of your animation that you want
  drawImage(pacmanX, pacmanY, filmStrip, frameIndex * frameWidth, 0, frameWidth, frameHeight)
  frameIndex = (frameIndex + 1) % frameCount

  // Update position of pacman & ghosts
  // Update sound effects, score indicators, etc.
} 
```

# mobile - 为 SAE J1939 标准编程

> ID：622387
> 
> 赞同：2
> 
> 时间：2009-03-07T20:03:34.953
> 
> 标签：mobile, embedded, can-bus, canopen, iec61131-3

我正在尝试查找有关如何对[ifm R 360](http://www.can-cia.org/pg/canopen/profiles/405/ifm/ifm2/index.html "易福门 R 360")等嵌入式移动控制器进行编程的信息。我在哪里可以找到有关所用编程语言、所需开发环境和任何其他有用信息的具体信息？

据我了解，编程语言基于 IEC 61131-3。我应该看哪些书籍或教程才能更好地理解这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-04-02T00:12:39.873

这是一个[J1939 软件协议栈](http://www.simmasoftware.com/j1939.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T20:26:52.697

显然您需要适用于控制器的[CoDeSys](http://en.wikipedia.org/wiki/CoDeSys)版本，请参阅[产品页面](http://www.ifm-electronic.com/ifmus/web/padv1!US_4_10_10_10_60_10_30.html)。

# parsing - 在嵌入式系统中使用 Lex 分词器

> ID：622389
> 
> 赞同：1
> 
> 时间：2009-03-07T20:05:33.433
> 
> 标签：parsing, embedded, flex-lexer

我正在尝试编写一个用于非标准 C 环境的配置文件解析器。具体来说，我不能依赖`<stdio.h>`.

我正在寻找使用 Flex，但我需要使用自己的输入结构而不是`<stdio.h>`FILE 指针。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T22:43:43.010

您可以通过定义 YY_INPUT 方法来定义自己的输入法：

```
 %{
     #define YY_INPUT(buf,result,max_size) \
         { \
         int c = getchar(); \
         result = (c == EOF) ? YY_NULL : (buf[0] = c, 1); \
         }
     %} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T22:14:28.413

[Ragel](http://www.complang.org/ragel/)是一个通用状态机编译器，您可以在 C 函数中使用生成的代码。它特别支持构建标记器。

# c# - Asp.Net c# -> Javascript Ajax

> ID：622391
> 
> 赞同：0
> 
> 时间：2009-03-07T20:05:49.033
> 
> 标签：c#, asp.net, javascript, ajax, asp.net-ajax

首先，我是 Ajax 的新手，我不太了解它在 Asp.Net 中的工作原理。

我正在使用 Asp.Net 3.5，并且我有运行的 ac# 服务器代码，当它完成它的工作时，它会调用一个订阅事件，它将结果写入一个 txtbox 控件。

c#代码：

```
public partial class TestDBLoader : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        dbManager1.LoadDBCompleted += new DBManager.AsyncLoadDBDelegate(dbManager1_LoadDBCompleted);
        dbManager1.LoadDBAsync(sender, e, null);
    }

    public void dbManager1_LoadDBCompleted(object sender, EventArgs e)
    {
        txtResult.Text = "Finish!";
        updatePanel.Update();
    }
}

public partial class DBManager : System.Web.UI.UserControl
{
    public AsyncLoadDBDelegate asyncLoadDB;
    public delegate void AsyncLoadDBDelegate(object sender, EventArgs e);
    public event AsyncLoadDBDelegate LoadDBCompleted;

    private void StartLoad(object sender, EventArgs e)
    {
        // Not the true code, only an example ...
        for (int i = 0; i <= 10; i++)
        {
            Thread.Sleep(1000);
        }

        LoadDBCompleted(sender, e);
    }

    public IAsyncResult LoadDBAsync(object sender, EventArgs e, AsyncCallback callback)
    {
        IAsyncResult asyncResult;

        asyncLoadDB = new AsyncLoadDBDelegate(StartLoad);

        asyncResult = asyncLoadDB.BeginInvoke(sender, e, callback, null);

        return asyncResult;
    }
} 
```

ASP代码：

```
<asp:ScriptManager ID="ScriptManager" runat="server" />   
<asp:UpdatePanel ID="updatePanel" runat="server" UpdateMode="Conditional">
    <Triggers>
        <asp:AsyncPostBackTrigger ControlID="dbManager1" EventName="LoadDBCompleted" />
    </Triggers>
    <ContentTemplate>
        <uc:DBManager ID="dbManager1" runat="server" />
        <asp:TextBox ID="txtResult" runat="server" />
    </ContentTemplate>
</asp:UpdatePanel> 
```

我究竟做错了什么 ？如果我进行调试，我注意到我的方法 dbManager1_LoadDBCompleted 被调用，但它没有更新文本框......

编辑：我将代码更新为更加现实和易于理解。

EDIT2：如果有办法在不使用 UpdatePanel 的情况下做到这一点，请告诉我如何。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T20:32:13.823

您的文本框的 id 是 txtbox1 但您正在设置 txtbox.text ...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T07:18:42.710

请记住，这在技术上不是“AJAX”。更新面板基本上只是在说“在回发后向我发送该位置的 HTML”，这可能非常健谈。

此外，您可能需要共享更多代码来帮助诊断。什么是解雇 WorkFinished？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T10:51:58.530

很可能 UpdatePanel 的 Update 方法没有被触发，这就是它的内容没有变化的原因。

您需要确保导致 WorkFinished 执行的控件位于 UpdatePanel 的 ContentTemplate 中，将调用 WorkFinished 的控件的 ID 作为 AsynchronousPostbackTrigger 添加到 Triggers 集合中，或者添加`UpdatePanel.Update();`到 WorkFinished 主体的末尾，强制 UpdatePanel 重新加载自身。

不过要小心 UpdatePanels，由于它们的性质，它们可能会非常消耗性能，我在这里介绍了一些东西 - [http://www.aaron-powell.com/blog/august-2008/optimising-updatepanels.aspx](http://www.aaron-powell.com/blog/august-2008/optimising-updatepanels.aspx)

# batch-processing - 如何可靠地处理外部代理定期上传的文件？

> ID：622392
> 
> 赞同：1
> 
> 时间：2009-03-07T20:06:29.750
> 
> 标签：batch-processing, file-manipulation

这是一个非常常见的场景：某个进程希望每 30 分钟左右在服务器上删除一个文件。很简单，对吧？好吧，我可以想到很多可能出错的方法。

例如，处理一个文件可能需要多于或少于 30 分钟，因此一个新文件可能会在我完成前一个文件之前到达。我不希望源系统覆盖我仍在处理的文件。

另一方面，文件很大，因此需要几分钟才能完成上传。我不想开始处理部分文件。这些文件只是通过 FTP 或 sftp（我的偏好）传输的，因此操作系统级别的锁定不是一种选择。

最后，我确实需要将文件保留一段时间，以防我需要手动检查其中一个（用于调试）或重新处理一个。

我见过很多临时的方法来改组上传文件、交换文件名、使用日期戳、触摸“指示符”文件以帮助同步等等。我还没有看到一个全面的“算法”，用于处理处理并发性、一致性和完整性的文件。

所以，我想在这里利用群众的智慧。有没有人见过一种真正防弹的方法来处理批处理数据文件，这样它们就不会过早处理，不会在完成之前被覆盖，并在处理后安全保存？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T20:15:50.790

关键是在*发送*端进行初始杂耍。发件人需要做的就是：

1.  使用唯一的文件名存储文件。
2.  文件发送后，立即将其移至名为 eg 的子目录`completed`。

假设只有一个接收者进程，所有接收者需要做的是：

1.  定期扫描`completed`目录中的任何文件。
2.  只要文件出现在 中`completed`，就将其移动到名为 eg 的子目录`processed`中，然后从那里开始处理它。
3.  完成后可选择删除它。

在任何健全的文件系统上，文件移动是原子的，只要它们发生在同一个文件系统/卷中。所以没有竞争条件。

## 多个接收器

如果处理可能需要比交付文件之间的时间更长的时间，您将建立一个积压，除非您有多个接收器进程。那么，如何处理多接收者的情况呢？

简单：每个接收器进程都像以前一样操作。关键是我们在处理文件`processed` *之前*尝试将文件移动到该文件：而且相同文件系统文件移动的事实是原子的，这意味着即使多个接收者看到相同的文件`completed`并尝试移动它，也只有一个会成功。您需要做的就是确保检查 的返回值`rename()`或用于执行移动的任何操作系统调用，并且只有在成功时才继续处理。如果移动失败，其他接收者首先到达那里，所以只需返回并`completed`再次扫描目录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T09:02:58.533

如果操作系统支持，请使用文件系统挂钩来拦截打开和关闭文件操作。像[大津子这样的东西](http://dazuko.dnsalias.org/wiki/index.php/Main_Page)。其他操作系统可能会以另一种方式让您了解文件操作，例如 Novell Open Enterprise Server 允许您定义 epoch，并[读取](http://www.novell.com/coolsolutions/tools/18992.html)在一个 epoch 期间修改的文件列表。

刚刚意识到在 Linux 中，您可以使用 inotify 子系统，或 inotify-tools 包中的实用程序

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T22:06:37.293

文件传输是系统集成的经典之一。我建议您获取[Enterprise Integration Patterns](http://www.eaipatterns.com/)这本书来构建您自己对这些问题的答案——在某种程度上，答案取决于您用于端点实现和文件传输的技术和平台。这是一个相当全面的可行模式集合，并且写得相当好。

# jquery - 使用 jquery-ui

> ID：622398
> 
> 赞同：0
> 
> 时间：2009-03-07T20:09:27.590
> 
> 标签：jquery, html, jquery-ui

我正在尝试弹出一个简单的日期选择器，但不能或者我不知道是什么原因。这是我的代码：

```
<!DOCTYPE html>
<html>
<script type="text/javascript" src="jquery/jquery.js"> </script>
<link type="text/css" href="css/smoothness/jquery.css" rel="Stylesheet" />
<script type="text/javascript" src="jquery/jquery-ui.js"> </script>   

<script type="text/javascript">
$('#date').datepicker();
 </script>
<body>
<input type="text" name="date" id="date" />
</body>
</html> 
```

我正在运行具有所有正确路径的 apache 服务器。任何人都可能知道为什么这不起作用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T20:13:29.640

尝试：

```
$(function() {
  $("#date").datepicker();
}); 
```

关键是您的检查可能会失败，因为日期元素尚不存在，特别是因为它直到在查找它的脚本之后才被声明。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T20:13:31.043

您应该将与日期选择器相关的代码放在 INPUT 标记之后。但是，据我所知，datepicker 组件要求您在页面加载后调用它，因此您的代码应该变成这样：

```
<script language=javascript>
    $(function () {
        $('#date').datepicker();
    });
</script> 
```

现在它应该可以工作了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T20:12:15.290

我不是专家，但您缺少 <head> 标签。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T20:39:26.893

看来问题已经解决了。您必须将其放入 $(document).ready() 函数中。

我只想添加关于 JQuery-UI 的另一件事。如果您只需要日期选择器，则不应包含整个 UI 包。转到 JQuery-UI 站点，您可以自定义下载。标记你需要的东西，它会给你一个只有最低限度的文件。这将使您的页面加载速度更快。

# c++ - 使用 GCC 提升线程编译器错误

> ID：622402
> 
> 赞同：1
> 
> 时间：2009-03-07T20:12:22.840
> 
> 标签：c++, linux, gcc, boost, conditional-statements

在 linux，gcc 4.3 上，使用 boost::thread 实现和互斥体/条件变量编译一个类我得到以下奇怪的错误，显然是由于与 posix 线程库的类型冲突：

```
*Compiling: filter.cpp
/usr/include/boost/thread/condition.hpp: In member function »void boost::condition::wait(L&) [with L = boost::mutex]«:
/host/.../filter.cpp:68:   instantiated from here
/usr/include/boost/thread/condition.hpp:90: Error: no match für »operator!« in »!lock«*
*/usr/include/boost/thread/condition.hpp:90: Notice: candidates are: operator!(bool) <built in>*
*/usr/include/boost/thread/mutex.hpp:66: Error: »pthread_mutex_t boost::mutex::m_mutex« is private
/usr/include/boost/thread/condition.hpp:93: Error: in this context* 
```

代码是：

```
void CFilter::process( CData **s )
{
    boost::mutex::scoped_lock bufferLock(m_mutex);
    while (!m_bStop)
        m_change.wait(bufferLock);                      //<- line 68

    // ... further processing
} 
```

与类声明

```
#include <boost/shared_ptr.hpp>
#include <boost/bind.hpp>
#include <boost/thread/condition.hpp>
#include <boost/thread/thread.hpp>
#include <boost/thread/mutex.hpp>

class CFilter
{
    // ...
    boost::shared_ptr<boost::thread> m_thread;
    boost::mutex m_mutex;
    boost::condition m_change;
    // ...

    process( CData **s );
} 
```

运算符错误发生在 boost 的 condition.hpp 中，在

```
if (!lock)
    throw lock_error(); 
```

我正在使用 Boost 1.38.0，在 Windows 上我没有发现任何问题。任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T20:39:32.917

您必须等待`bufferLock`, 而不是`m_mutex`:

```
while (!m_bStop)
    m_change.wait(bufferLock); 
```

[Condition<>::wait()](http://www.boost.org/doc/libs/1_34_0/doc/html/boost/condition.html)将 a[`ScopedLock`](http://www.boost.org/doc/libs/1_34_0/doc/html/thread/concepts.html#thread.concepts.ScopedLock)作为参数，而不是 a [`Mutex`](http://www.boost.org/doc/libs/1_34_0/doc/html/thread/concepts.html#thread.concepts.Mutex)。

# javascript - 对简单 AJAX 的建议？

> ID：622403
> 
> 赞同：1
> 
> 时间：2009-03-07T20:12:25.073
> 
> 标签：javascript, jquery, ajax, dhtml

我想在 AJAX 中变得更聪明，但不知道该走哪条路。我曾经做过一些 DHTML 编程——就像 8 年前一样！在它被称为 AJAX 之前。我使用 emacs 并对所有的 javascript 进行了手工编码，并通过“Alert”进行了调试。

在这一点上，我认为有一些框架可以让事情变得更好、更容易，但哪些框架呢？从哪儿开始？建议？

1.  jQuery是必不可少的吗？很高兴拥有？
2.  SACK 项目呢？
3.  萤火虫？
4.  您推荐的任何其他免费库或框架？还是不推荐？
5.  对于一个非常简单的项目，我发现 FF 与 IE 兼容存在大量陷阱。在没有进入关于谁是对谁错的宗教辩论的情况下，有什么技巧可以帮助您在雷区中导航以生成在任何浏览器上都可以工作且看起来几乎相似的应用程序。一个人有一个提示：insert * {padding:0; margin:0;} 在他的 .css 堆栈顶部，因为 FF 和 IE 对于 UL OL 等元素都有不同的默认填充和边距。有这样的提示列表吗？指导？
6.  我没有 Mac，真的不想承担 IE、FF、Opera、Safari、Chrome 的测试成本，跨越所有无数的版本和平台。提示？这里有 80% 的解决方案吗？就像我在 FF 和 IE 上测试一样，我能猜到它会在其他人身上工作吗？
7.  教程网站上的提示，开始？那里有大量的信息，这是去的好地方。特别是，因为 DHTML 大约是 10 年前，所以我的谷歌搜索出现了一些非常陈旧的信息。
8.  调试和开发工具？我在网上的 zvon.org 上找到了一个 xpath 即时评估器。这很好，但没有我想要的那么灵活。这是我认为非常宝贵的东西。xsl 和 xpath 必须是我用过的最不透明的语言。当我开始使用正则表达式时，有可用的即时正则表达式工具，如 Expresso 等。这些对于早期开发和学习正则表达式非常宝贵。昨晚我花了很长时间摆弄 xpath 表达式，我想知道是否有类似的用于 xpath 的 JIT 工具。那么调试和开发 Javascript 本身呢？

我主要对客户端方面感兴趣。目前，我对像 ASP.NET AJAX 这样的集成客户端+服务器方法不太感兴趣。如果您告诉我有关仅适用于 Ruby 的客户端 AJAX 框架或开发工具，我不会感兴趣。

谢谢！

编辑：为什么我被否决了？这是一个不好的问题吗？这对我来说似乎完全合理？不礼貌吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T20:52:45.147

它通常比上面的 ajax() 函数更容易。大多数时候我只是做....

```
$('#mydiv').load('http://getsomehtml.php?op=loadmeup'); 
```

偶尔添加一个回调

```
document.body.style.cursor = "wait";
$('#mydiv').load('http://getsomehtml.php?op=loadmeup', function() {
    document.body.style.cursor = "default";
}); 
```

我同意[jQuery](http://jquery.com/)是不可或缺的。或类似的东西.. 使用原始 javascript 是当今所有浏览器问题的雷区。我喜欢[visualjquery.com](http://visualjquery.com/)作为方便的参考（但我希望 Remy 将其更新到 1.3.2）

而且我无法在没有[Firebug](http://getfirebug.com/)的情况下完成我的工作，所以这是完全需要的。

我在 PC 上运行[xampplite](http://www.apachefriends.org/en/xampp-windows.html#646)进行测试。我使用[NotePad++](http://notepad-plus.sourceforge.net/uk/site.htm)或[Eclipse PDT 2.0](http://www.eclipse.org/pdt/downloads/)进行编辑（尤其是服务器端 PHP）和 CVS，我很高兴...

我进行多浏览器测试的方式是通过虚拟机。我使用 Sun 的[VirtualBox](http://www.virtualbox.org/wiki/Downloads)和一个加载了所有浏览器的 XP 虚拟机。我经常使用 FF3 和 IE7，所以我的 VM 中有 IE6、FF2、Chrome、Opera 和 Safari。我有时会使用 Ubuntu 8.10 映像，但并不经常使用。

对于 Regex，获得[RegexBuddy](http://www.regexbuddy.com/)的副本- 轻松值 40 美元

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T20:16:07.670

个人认为jQuery是不可或缺的。与 XMLHttpRequest 有很多浏览器差异。jQuery 简化了这一切。这是一个[例子](http://www.ibm.com/developerworks/library/x-ajaxjquery.html)：

```
$.ajax({
    url: 'document.xml',
    type: 'GET',
    dataType: 'xml',
    timeout: 1000,
    error: function(){
        alert('Error loading XML document');
    },
    success: function(xml){
        // do something with xml
    }
}); 
```

您可以轻松地将其更改为返回 JSON、HTML 等。

还有一些包装方法可以大大减少参数的数量，比如`$.load()`,`$.post()`等等。

关于浏览器的差异，我强烈建议你从一个 CSS 重置开始，比如[Yahoo 的 reset CSS](http://developer.yahoo.com/yui/reset/)（还有其他的）。

在开发方面，Firefox 是标准，结合了 Firebug（通常是 YSlow）。HttpFox 和 Web Developer 也是流行的插件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T20:29:16.030

1.  jQuery 不是必不可少的，但它非常有用。
2.  没听说过
3.  我认为一个js框架就足够了。所以我推荐jQuery。
4.  CSS 重置不会解决所有兼容性问题，但它可以提供很大帮助。有关终极 CSS 重置，请参阅[Eric Meyer 的 CSS 重置](http://meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/)。
5.  试试[http://browsershots.org/](http://browsershots.org/)
6.  我在这里没有任何建议。
7.  用于调试 javascript - firebug（firefox 扩展）。您还可以尝试使用 fiddler 检查服务器和客户端之间传递的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T20:36:53.453

对于发出 Ajax 请求，我使用[http://www.prototypejs.org/](http://www.prototypejs.org/)
对于其他一切，我编写自己的 JavaScript。即使淡化 div 很重要，我仍然更喜欢以我的方式来作为一种学习方式。

至于入门，这是我的快速教程：

```
new Ajax.Updater(domId, urlToAPage); 
```

其中： domId = html 页面上具有 id 的任何内容，只要它不是输入对象。urlToAPage = 可能是要联系并从中获取数据的页面。

您可以使请求更复杂：

```
new Ajax.Updater(domId, urlToAPage, {method: 'post', parameters: pars} ); 
```

您可以将方法从“发布”更改为“获取”。Pars 可以是任何东西。此外，发布请求看起来相同。因此，如果您想向名为 hello.php 的文件发出请求并发送带有两个参数的 post 参数，则将响应放入名为 'hello' 的 div 中：

```
var domId = 'hello';  
var urltoPage = 'hello.php';  
var pars = 'hello=1&name=hsbsitez'; 
```

阅读更多： http: [//www.prototypejs.org/learn/introduction-to-ajax](http://www.prototypejs.org/learn/introduction-to-ajax)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T20:35:52.427

我也强烈推荐使用 JQuery。它使生活变得如此轻松。

我学到的关于 JS 的一件事是永远不要相信它是有效的。仅仅因为您使用 JQuery 并且它可以在一些浏览器中运行并不意味着它可以在其他浏览器中运行。

您必须在尽可能多的系统上尽可能多地尝试它。

# html - HTML中的分页符

> ID：622404
> 
> 赞同：0
> 
> 时间：2009-03-07T20:12:28.457
> 
> 标签：html, page-break

我想在 html 中使用分页符，这意味着读者在选择链接之前无法进一步向下滚动。

```
<SPAN id=title><A name=BdToc_1 external=yes><h1 id="BookTitle" align="center"><font color="#B90000"><b>Choose Subject</b></font></h1>
</A>
</SPAN>
<p>
Contents....
</p> 
```

我想要在此之前和之后分页符。请帮我

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-07T20:21:01.883

请原谅我指出了明显的问题，但分页符用于分隔不同的页面。每个 HTML 文档都是一个不同的“页面”。 *“选择[ing]链接”*通常会加载一个新页面。所以....当他们单击此链接时，您为什么不直接加载下一页？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-07T20:21:56.080

[您可以使用 CSS 属性page-break-after](http://www.w3.org/TR/CSS21/page.html#propdef-page-break-after)、[page-break-before](http://www.w3.org/TR/CSS21/page.html#propdef-page-break-before)指定分页符发生的位置。当然，这**仅在打印**网页时有效。据我所知，这些属性在包括 IE6+ 在内的所有主要浏览器中都正确实现。[此外，您还可以使用page-break-inside](http://www.w3.org/TR/CSS21/page.html#propdef-page-break-inside)声明不应在元素内部发生分页符。

如果您想要分页本身，则需要为每个页面设置 HTML 并链接这些页面。或者您可以使用 AJAX 动态获取每个页面的内容，这当然涉及脚本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-07T20:17:09.490

在 HTML 中不太可能。你可以尝试用 Javascript 做一些东西，但任何人都可以禁用 javascript。

你为什么想要这样的东西？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-11T17:59:58.913

您可以**在 javascript 中使用 onscroll**来控制滚动。onscroll 事件可以确定当前位置，如果用户向下太远，还有向上滚动的功能。

然后，当用户单击链接时，您**设置一个标志**(scrollok=1)。onscroll 检查标志，现在允许滚动。

如果您想击败已停用 javascript 的人，只需使用样式表**使内容不可见**，直到他们单击：visibility=none。

然后，当他们单击链接时，您可以通过标志启用滚动，并使内容可见。

如果您不知道如何做这些事情，请发表评论，我可以更准确。

# svn - 有没有办法使用 svn:mergeinfo 关闭 TortoiseSVN？

> ID：622409
> 
> 赞同：70
> 
> 时间：2009-03-07T20:13:57.703
> 
> 标签：svn, tortoisesvn

当我进行 TortoiseSVN 合并时，它包括一堆目录，以及一些文件到修改后的文件中，即使没有实际更改。

它改变了属性`svn:mergeinfo`。

为什么需要在目录/文件上设置这些属性？有什么办法可以绕过不做这些改变`svn:mergeinfo`？

我通常只是还原项目然后提交，但这会浪费额外的时间。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-03-07T20:34:25.580

这很可能会发生，因为这些文件和目录具有先前合并的 svn:mergeinfo 属性集。我认为合并单个文件或目录以导致将 mergeinfo 写入单个文件的方式通常不是一个好主意。您应该养成在工作流可能的最高级别进行合并的习惯，以便仅在结构目录（例如 /trunk 或 /branches/1.0）上设置 mergeinfo 属性。

但是，如果您发现自己在单个文件和文件夹上使用了 mergeinfo 属性，您可以做两件事：第一件事就是从相关文件和目录中删除 svn:mergeinfo 属性。除非您真的知道自己在做什么以及可能产生的影响，否则我不确定是否建议这样做。在执行此操作之前请阅读文档！

您可以做的第二件事是按照 SVN 的要求提交属性更改，如果您信任该软件，这可能是正确的做法。

话虽如此，我一直在和我的队友一起努力养成正确的习惯，这样我们就不会再有这种烦恼了。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-03-08T13:30:55.917

### SVN 1.7 及更高版本

这应该在 SVN 1.7 中修复。从[发行说明](http://subversion.apache.org/docs/release-notes/1.7.html#subtree-mergeinfo-recording)：

> 如果子树不受合并影响，则合并不再在子树（具有自己的显式合并信息）上记录合并信息（描述合并）。`svn:mergeinfo`对于拥有大量具有显式合并信息的子树的用户，这应该会大大减少虚假属性更改的数量。

### 1.7 之前的 SVN

发生的情况是，一旦文件/文件夹具有明确的合并信息，即使文件/文件夹不相关，每个后续合并到分支都会更新该合并信息。这很烦人，因为它在每次合并的更改列表中引入了越来越多的混乱。

为避免这种情况，仅合并到分支的“根”文件夹，例如“/branches/maintenance2.x”。“/branches/maintenance2.x”下的所有文件或文件夹都不应获得mergeinfo。遵循[SVN book 中的合并建议](http://svnbook.red-bean.com/en/1.5/svn.branchmerge.advanced.html#svn.branchmerge.advanced.finalword)。

不幸的是，即使您仅在分支的“根”文件夹中合并，在`svn:mergeinfo`复制单个文件和文件夹时，它们仍会出现空属性，这表明它们没有收到与其兄弟姐妹相同的合并。

删除多余的子树合并信息可能是安全的。一种方法是递归删除`svn:mergeinfo`项目根目录中每个文件和文件夹的属性。（但将合并信息保留在根文件夹本身！）

或者，您可以升级到[Subversion 1.6](http://www.open.collab.net/downloads/subversion/)。我已经验证它可以解决这个问题。它甚至似乎删除了早期版本为您添加的多余合并信息。

从评论来看，SVN 1.6 中仍然存在出现多余子树合并信息的情况。但我无法重现这一点。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-08-14T23:58:22.477

如果您使用 --ignore-ancestry 选项进行合并，则不会首先创建 mergeinfo 属性。

```
svn merge --ignore-ancestry -c 1234 svn://sourcecontrol . 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-03-04T09:37:51.237

如果您勾选*忽略祖先*，它将不会在文件夹中创建 svn mergeinfo。如果您已经获得了 svn 合并信息，只需将其还原并通过检查忽略祖先再次进行合并。

![在此处输入图像描述](https://i.stack.imgur.com/zwjze.jpg)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-07T20:34:21.867

svn:mergeinfo 是 Subversion 用来[跟踪合并历史](http://subversion.tigris.org/merge-tracking/func-spec.html)的属性。我只是让它做它必须做的事情......稍后您可能需要合并历史跟踪并发现它不起作用，因为您没有提交这些属性。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-01-18T21:32:23.427

堆栈溢出问题中给出的命令[*删除不必要的 svn:mergeinfo 属性*](https://stackoverflow.com/questions/767418/remove-unnecessary-svnmergeinfo-properties/2648969#2648969)将删除任何额外的合并信息。

```
From the root of the project do:

svn propdel svn:mergeinfo -R
svn revert .
svn ci -m "Removed mergeinfo" 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-08T16:55:08.083

我要补充的是，这个错误的至少一部分在 Subversion 1.5.5 中得到了修复。从[1.5.5 更改文件](https://svn.collab.net/repos/svn/tags/1.5.5/CHANGES)：

```
do not create mergeinfo for wc-wc moves or copies (r34184, -585) 
```

也就是说，在 1.5 之前的 SVN 中有一个错误，它会创建它不使用的合并信息条目，并且是多余的，如果他们有很多`svn:mergeinfo`属性，这可能是原始提问者遇到的问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-28T09:44:42.000

我们在我们的项目中递归地删除了它，因为几乎所有文件都有这个信息，这使得合并非常烦人（如果只有一个文件被改变，所有文件都必须被合并）。从现在开始，我们将只在根上合并，这应该避免将来出现这种情况。

到目前为止，它还没有给我们带来任何问题。日志记录仍然可以在文件上使用，并且似乎是相同的（但无论如何都要自担风险！）。

哦，我们是在我们的树干上做的，就在做一个新的分支之前。这样，我们就可以从头开始。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-05-05T14:24:41.330

很好的问答！我们最近遇到了这个问题，因为我们正在尝试解决我们自动构建系统的限制。我们的构建系统会自动增加 .bdsproj 和一些 .dpr/.dpk 文件的版本和路径信息。

我想改变它......但是现在，如果你想将一个分支与另一个合并，你会得到少数你改变的文件，然后是构建机器改变的 1000 个文件。所以我们一直在做“有针对性的”合并，有时一次一个文件。特别是对于具有合法更改（例如包含额外单元）的 .dpr 或 .bdsproj 文件。现在我知道发生了什么，所以我希望能制止这种疯狂。

感谢堆栈溢出！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-08-15T09:19:34.337

我们的团队也遇到了这个问题，这让整个合并过程有点混乱。阅读完这篇文章后，我尝试从多个文件中删除 svn:mergeinfo 属性，经过进一步测试，它看起来解决了问题。

# python - 如何在事件处理程序中更改 wxRichTextCtrl 的光标位置？

> ID：622417
> 
> 赞同：1
> 
> 时间：2009-03-07T20:18:27.413
> 
> 标签：python, events, wxpython, wxwidgets

我的应用程序中有一个 RichTextCtrl，它有一个`EVT_KEY_DOWN`. 执行的代码如下：

```
 def move_caret(self):
    pdb.set_trace()
    self.rich.GetCaret().Move((0,0))
    self.Refresh()

def onClick(self,event):
    self.move_caret()
    event.Skip() 
```

**丰富**的是我的 RichTextCtrl。

这是我想做的事情：

*   在每次按键时，将键添加到控件（这是默认行为）

*   将光标移动到控件的开头，第一个位置

这是它的实际作用：

*   它将键添加到控件

*   我检查了插入符号的位置，调试器报告它位于 0,0 但在控件上，它在当前位置闪烁（这是我按下键 + 1 之前的位置）

你看这里有什么不对吗？一定有什么我做错了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T09:00:18.190

显然，您的代码存在两个问题：

1.  你听`EVT_KEY_DOWN`，这可能是之前处理过`EVT_TEXT`的，其默认处理程序设置光标位置。

2.  您修改`Caret`对象而不是使用`SetInsertionPoint`方法，该方法既移动插入符号又使下一个字符出现在给定位置。

因此，工作示例（我对其进行了测试，它可以按照您的意愿工作）将是：

```
# Somewhere in __init__:
    self.rich.Bind(wx.EVT_TEXT, self.onClick)

def onClick(self, event):
    self.rich.SetInsertionPoint(0) # No refresh necessary.
    event.Skip() 
```

* * *

**编辑**：如果您希望将文本添加到末尾，但光标保留在开头（请参阅注释），您可以利用`EVT_KEY_DOWN`之前处理的事实`EVT_TEXT`（这又在添加字符之后处理）。所以事件的顺序是：

1.  处理`EVT_KEY_DOWN`
2.  在当前插入点添加字符
3.  处理`EVT_TEXT`

在实际添加字符之前添加一个处理程序`EVT_KEY_DOWN`将插入点移动到末尾可以很好地完成这项工作。所以，除了前面提到的代码，还要写：

```
# Somewhere in __init__:
    self.rich.Bind(wx.EVT_KEY_DOWN, self.onKeyDown)

def onKeyDown(self, event):
    self.rich.SetInsertionPointEnd()
    event.Skip() 
```

顺便说一句，`event.Skip()`不会立即调用下一个事件处理程序，它只是在`event`对象中设置一个标志，以便事件处理程序知道在此处理程序之后是否停止传播事件。

# c++ - 如何在 Windows 上部署 Qt 应用程序？

> ID：622418
> 
> 赞同：15
> 
> 时间：2009-03-07T20:18:39.910
> 
> 标签：c++, windows, qt, deployment

所以现在我可以为我的应用程序制作一个 .exe。现在如何让我的应用程序为 Windows 部署做好准备？

这是关于 Windows 上 Qt 应用程序部署问题的规范问题。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-07T20:21:57.547

Qt 文档有相应的页面：

*   [Qt 5](http://doc.qt.io/qt-5/windows-deployment.html) ,
*   [Qt 4](http://doc.qt.io/qt-4.8/deployment-windows.html)。

# vb6 - 如何修复从 Web 应用程序到 DB2 的断开连接？

> ID：622421
> 
> 赞同：0
> 
> 时间：2009-03-07T20:19:44.570
> 
> 标签：vb6, asp-classic, db2

我支持一些*旧的*Web 应用程序，用于 UI 的基于 VBScript 的 ASP 和用于业务和数据访问层的 VB6 COM 模块。上周末，我在几台 Windows 2000 服务器上安装了 DB2 Connect Enterprise Edition v8 fixpack 14，其中一个 Web 应用程序在调用内置 VBScript 函数**FormatNumber**时出现空数据错误。此数字数据由 SQL Server 查询检索，但填充 SQL Server 列的唯一方法是使用从前面的 DB2 查询返回的计算结果，在几个页面中进行。

当我安装 DB2 Connect EE 时，加载的组件之一是 MDAC 2.7。我按照公司的说明进行了安装，并保存了一个 ODBC 系统数据源，当我在安装后测试它时报告连接良好。

值得一提的是，生产 VB6 模块中的项目引用指向 MDAC 2.5。我已经尝试在我的测试服务器上重新编译并部署到 COM 引用 MDAC 2.7 的 VB6 模块的新版本。我的开发环境是 Windows XP Pro，安装了 MDAC 2.8 和 DB2 Connect EE v9.5。当我部署更新的 VB6 dll 时，**CreateObject**无法实例化类，并显示错误消息“该类不支持自动化或请求的接口”。

我已经回滚了 DB2 Connect 安装并重新安装了 DB2 运行时客户端的 v8，这是以前的环境。然而，问题仍然存在。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-07T20:24:33.700

我并没有真正了解事物是如何连接在一起的——SQL Server 在哪里，DB2 在哪里。
IBM 站点上有专门帮助 DB2 Connect EE 的论坛，我认为这是一个非常昂贵的产品（不确定）。

我见过人们这样做的一种方法是将 SQL 服务器配置为数据网关。您可以将 DB2 定义为链接服务器，然后通过 SQL 服务器执行 SQL 查询以访问 DB2。应用程序只需要能够连接到 SQL Server，而不需要直接连接到 DB2。他们间接接触到 DB2。根据系统上的负载，这对您可能可行，也可能不可行。您甚至可以使用这种方法对单独存储在 DB2 和 SQL 中的数据进行连接。

它是工具箱中的另一种选择，以及复制、数据联合等。我发现它减少了连接的可变性。

# sql - 使用 GUID 作为主键时的“无”或“未使用”外键

> ID：622437
> 
> 赞同：1
> 
> 时间：2009-03-07T20:28:04.253
> 
> 标签：sql, sql-server, primary-key, guid

我们正在构建一个可能需要复制到许多服务器的应用程序（我希望不会，但是在我们发布在线产品之前，无法知道客户端是否需要他们自己的客户端/服务器副本）。

由于服务器的数量未知，我决定对任何事务表 ID 使用 GUID。由于每个客户端都有自己的数据库，我打算使用 NEWSEQUENTIALID() 默认值，并且最大的表每年将添加不超过 150 万行（但平均为 15K 行），我预计不会有太大的性能问题.

但是，我不确定如何处理我们希望外键指示“未选择”的情况。例如，一个客户端有一个管理员用户。这被设置为 login.id（GUID）的外键（login_id）。但是，如果客户端还没有管理员用户，我们如何轻松设置“None Selected”键？

在以前的应用程序中，我们使用 IDENTITY 列，并在大多数 ID 为 0 的表中插入了一个虚拟条目。是否有一种可接受的方法来提供具有 GUID 的类似功能？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T23:17:58.887

唯一安全的方法是将 FK 值设置为 NULL。如果您需要在多个服务器之间复制数据，请确保您复制的每个表都有 GUID 作为它们的主键，这样外键关系就不会出现问题。

复制可以通过这种方式非常简单地工作：首先按照父表到子表的顺序复制插入和更新，然后将删除的记录从子表复制到父表。（相反的顺序。）

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T20:40:14.083

您有 3 个选项：

1）在您引用的表中，添加带有全零 guid 的空白值行，然后链接到此记录

2）只为空白引用存储一个空值

3）参考表中没有空白记录，但存储一个全零的guid。如果在数据库或报表中进行连接，这可能会导致问题。您必须为这种特殊情况编写代码。

我会说 1 和 2 是唯一不错的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T20:33:13.447

我可能在这里遗漏了一些非常明显的东西，但是您不能将其设置为 NULL 吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T20:33:33.023

将子表中的外键字段设为 NULLable，并在没有管理员用户时保持该字段为 NULL。像“0”标识列这样的神奇值是等待发生的灾难。

# emacs - Emacs 命令在光标上方插入和缩进行

> ID：622440
> 
> 赞同：12
> 
> 时间：2009-03-07T20:29:56.217
> 
> 标签：emacs, elisp

当我意识到我需要（ed）在上面的行上定义变量（或类似的东西）时，我经常发现自己在一行上打字。我想要的是

1.  从一行的任意位置按 C-return 并让光标移动到上面新插入的空白行，缩进正确（或至少与原始行相同）。
2.  可以拉出任何文本...
3.  和 Cu C 空间回到原来的位置

我已经做到了#1，但是我的 emacs-fu 不够强大，无法完成其余的工作。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-09T09:20:44.933

这是我谦虚的解决方案：

```
(defun my-insert-before-line ()
  (interactive)
  (save-excursion
    (beginning-of-line)
    ; I've changed the order of (yank) and (indent-according-to-mode)
    ; in order to handle the case when yanked line comes with its own indent
    (yank)(indent-according-to-mode)
    ; could be as well changed to simple (newline) it's metter of taste
    ; and of usage
    (newline-and-indent))) 
```

希望能帮助到你。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T20:41:57.777

如果您不是禅宗大师 emacs 兄弟，您可以执行以下操作。

Emacs 有一个记录宏的东西，kmacro-start-macro 和 kmacro-end-macro。

录制宏后，执行 name-last-kbd-macro。然后访问 .emacs，然后执行 insert-kbd-macro。

然后你有一个定义你的宏的 fset 语句。它可能看起来很有趣，而且它不像 elisp 那样可维护，但是如果你将它塞进你的 .emacs 中，那个宏（以那个名字命名）将可用于你的任何编辑会话。您也可以将其绑定到键序列。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-07T23:03:52.990

回答我自己的问题可能是不好的形式，但 Cheeso 的回答激励我十年来第二次做一些 lisp 编程（我的原始版本是一个命名的键盘宏，但它跨越了整个杀戮/标记环）。这是我想出的

```
(defun insert-and-indent-line-above ()
  (interactive)
  (push-mark)
  (let* 
    ((ipt (progn (back-to-indentation) (point)))
     (bol (progn (move-beginning-of-line 1) (point)))
     (indent (buffer-substring bol ipt)))
    (newline)
    (previous-line)
    (insert indent)))

(global-set-key [ (control return) ] 'insert-and-indent-line-above) 
```

可能有很多更好的方法可以做到这一点，但是两个小时的 lisp-hacking 很难被称为浪费时间 :-)

# silverlight - Silverlight 相关或过滤组合框

> ID：622456
> 
> 赞同：0
> 
> 时间：2009-03-07T20:37:03.577
> 
> 标签：silverlight, combobox

提前感谢您的帮助。我有两个组合框，我希望它们依赖于彼此的输入。例如，当我更新一个时，它会过滤下一个的可用值。以为我一切正常，直到我在两者之间切换了几次，都只是因为空白。

我有两个国家组合框，FromCountry 和 ToCountry。这些都绑定到一个名为 Country 的 ObservableCollection。我认为使用 DroDownOpened 事件来限制下拉组合框中的可用值可能是有意义的。

任何建议或帮助将不胜感激。

单击 To Country 上的下拉菜单时调用的方法

```
private void ToCountry_DropDownOpened(object sender, EventArgs e)
{
            int FromId = (Countries.Country)FromCountry.selectedItem).ID;
            int ToId = (Countries.Country)ToCountry.selectedItem).ID;

  this.ToCountry.ItemsSource = AppInfo.CountryList.Where(p=>p.ID!=FromId).OrderBy(c => c.Name);
} 
```

单击 From Country 上的下拉菜单时调用的方法

```
private void FromCountry_DropDownOpened(object sender, EventArgs e)
{
            int FromId = (Countries.Country)FromCountry.selectedItem).ID;
            int ToId = (Countries.Country)ToCountry.selectedItem).ID;

  this.FromCountry.ItemsSource = AppInfo.CountryList.Where(p=>p.ID!=ToId).OrderBy(c => c.Name);
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-10T11:24:04.753

您是否尝试过拥有两个 ObservableCollections ToCountries 和 FromCountries，然后对要填充的选择更改事件做出反应？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-31T13:30:48.677

经过一些实验，我设法找到了一个可行的解决方案。下面允许我有两个组合框依赖于相同的数据源，以及彼此。我敢肯定，这是一种优雅的方法，但这似乎可行。

1) 在我的 ObservableCollection 上，我添加了两个附加属性，ToSelected 和 FromSelected。

2）然后我没有绑定到组合框，而是通过循环填充它们的目录。这不是最好的方法，但它似乎是最直接的。

```
 foreach (Countries.Country currentCnty in CountryList)
                {
                    ComboBoxItem toItem = new ComboBoxItem();
                    toItem.Content = currentCnty;
                    CmboToCountry.Items.Add(toItem);
                    ComboBoxItem fromItem = new ComboBoxItem();
                    fromItem.Content = currentCnty;
                    CmbFromCountry.Items.Add(fromItem);
                } 
```

3) 然后我创建了名为 UpdateLogic 的方法。这只是循环通过 ObservableCollection 设置 From 和 To 组合框的选定记录。

4）然后在每个组合框的选择更改上，我添加了以下内容以设置其他组合框项目的可见性。例如，To Country 组合框将设置 From Country 项目的可见性，反之亦然。

```
 //Update the underlying collection with selected items
            UpdateLogic((Countries.Country)CmboToCountry.Content, (Countries.Country)CmboFromCountry.Content);

            for (int iLoop = 0; iLoop < CmboToLocation.Items.Count; iLoop++)
            {
                ComboBoxItem currentItem = CmboToCountry.Items[iLoop] as ComboBoxItem;
                Countries.Country currentCountry = (Countries.Country)currentItem.Content;
                currentItem.Visibility = ((currentCountry.IsFrom) && (currentCountry.ID > 0))
                                            ? Visibility.Collapsed : Visibility.Visible;
            } 
```

拥有两个相互依赖的组合框的业务需求一直是一个有趣的挑战。希望这对将来的某人有所帮助。虽然我确信有一个更优雅的解决方案来执行这项任务。

# asp.net - 阻止对 asp.net .asmx Web 服务的跨域调用

> ID：622459
> 
> 赞同：6
> 
> 时间：2009-03-07T20:38:30.500
> 
> 标签：asp.net, jquery, security, json, asmx

我已经构建了一个应用程序，它使用 jQuery 和 JSON 来使用 ASP.NET .asmx Web 服务来执行 crud 操作。应用程序和 .asmx 在同一个域中。我不介意人们远程使用 .asmx 的读取操作，但不希望人们随意删除东西！！！

我可以将我希望公开访问的方法和“隐藏”的方法拆分为 2 个 Web 服务。如何将“hidden”.asmx Web 服务的调用锁定到其托管的同一个域？

提前致谢。

**编辑：** 有人可以对此发表评论，似乎是合理的（来源：[http](http://www.slideshare.net/simon/web-security-horror-stories-presentation) ://www.slideshare.net/simon/web-security-horror-stories-presentation）：Ajax 可以设置 Http 标头，普通形式不能。Ajax 请求必须来自同一个域。

所以“x-requested-with”“XMLHttpRequest”请求必须来自同一个域。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-08T06:57:25.817

有两种情况需要使用 Web 服务来保护：

1.  用户是否经过身份验证？
2.  操作是否来自我的页面？

如果您使用的是表单身份验证，则已经处理了身份验证部分。如果您的 Web 服务位于站点的受表单身份验证保护的区域，则除非登录，否则任何人都无法访问您的 Web 服务。

第二种情况是一个稍微棘手的故事。该攻击被称为 CSRF 或 XSRF（跨站点请求伪造）。这意味着恶意网站会在您的用户仍登录到您的网站时代表他们执行操作。 [这是一篇关于 XSRF 的精彩文章](http://www.codinghorror.com/blog/archives/001171.html)。

Jeff Atwood 在上面的链接中总结了这一切，但这里是 XSRF 保护分四个步骤：

1.  将 GUID 写入用户的 cookie。
2.  在调用 AJAX 之前，从 cookie 中读取此值并将其添加到 Web 服务 POST。
3.  在服务器端，将 FORM 值与 cookie 值进行比较。
4.  因为网站无法从其他域读取 cookie，所以您是安全的。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-07T20:58:40.467

在 AJAX 中，浏览器进行调用，因此即使您要检查域是否相同，它也不够安全，因为它很容易被伪造。

您需要使用某种身份验证/授权令牌（最好有超时）来保证事情的安全。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-07T21:00:33.380

快速而肮脏的解决方案是使用 IP 地址限制，只允许您的域的 IP 地址通过 IIS 访问。

使用 HTTP 身份验证可能会更好。有很多方法可以做到这一点，我发现[ASP.NET Web 服务中的身份验证是](http://progtutorials.tripod.com/Authen.htm)一个很有帮助的概述。

# javascript - 我的用户报告的意外 JavaScript 操作

> ID：622463
> 
> 赞同：0
> 
> 时间：2009-03-07T20:39:54.303
> 
> 标签：javascript, browser

我的用户一直抱怨没有为他们显示链接。对我来说，我已经在几个浏览器上对此进行了测试，它对我有用。

应该发生的是使用 JQuery 通过 AJAX 启动一个进程**，**一旦完成，我会通过 AJAX 继续检查服务器已经完成了多少进程，一旦进程完成，我会向他们显示一个链接。但是很多用户告诉我它向他们显示了链接，然后它**很快就消失了，显示为 100.0%**！

我不知道如何解决这个问题，我希望你们能帮助我写一些万无一失的东西，以便始终显示链接！

这是有关的代码（已缩短）。

```
var startTime;
var continueTime;
var done = false;
function convertNow(validURL){
       startTime = setTimeout('getStatus();', 6000); 
       $.ajax({
       type: "GET",
       url: "main.php",
       data: 'url=' + validURL + '&filename=' + fileNameTxt,
       success: function(msg){
      done = true;     
      $("#loading").hide("slow");
      $("#done").html("LINK SHOWN HERE");   
       }//function

     });//ajax

}//function convertNow
function getStatus()
{       
        if(done==false){            
        $.ajax({
        type: "POST",
        url: "fileReader.php",
        data: 'textFile=' + fileNameTxt,
        success: function(respomse){
        textFileResponse = respomse.split(" ");
        $("#done").html("PROGRESS SHOWN HERE IN PERCENTAGES");
        }
        });//ajax
        continueTime = setTimeout('getStatus();', 3000); 
        }
} 
```

谢谢大家

PS我之前有这个问题，并且被告知在函数中使用条件，但是当它应该有的时候它不起作用！

## 更新

我有一些用户正在使用什么操作系统和浏览器，他们通常会说 Mac Os 和 firefox 或 safari。不确定这是否有助于解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T20:56:24.047

用户描述的行为表明`success`您的函数的回调`getStatus`是在`convertNow`. 您应该在此回调中测试`done`变量

```
function getStatus(){
    if(done==false){
        $.ajax({
            type: "POST",
            url: "fileReader.php",
            data: 'textFile=' + fileNameTxt,
            success: function(respomse){
                // FIX : Already done, just ignore this callback
                if (done) return;

                textFileResponse = respomse.split(" ");
                $("#done").html("PROGRESS SHOWN HERE IN PERCENTAGES");

                // BONUS : call getStatus only when previous ajax call is finished
                continueTime = setTimeout('getStatus();', 3000);
            }
        });//ajax
    }
} 
```

编辑：这个解决方案应该可以防止大多数时间出现错误，但仍有机会。唯一可以确定的方法是在处理完成时删除回调`convertNow`并让其中的一个`getStatus`设置链接（不要忘记一次只允许一个调用`getStatus`，请参阅上面的“BONUS”修改）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T20:57:20.347

如果`done`从不设置回，`false`则在第二次调用 时将预期报告的行为`convertNow`。

由于 ajax 调用`convertNow`使用 GET 而不是 POST，因此只要参数与之前的调用相同，浏览器就有可能返回缓存的结果。

# apache - 如何将 Apache 网站设置为 503 “临时停机”？

> ID：622466
> 
> 赞同：43
> 
> 时间：2009-03-07T20:41:17.437
> 
> 标签：apache, http, configuration

RFC2616, 503 服务不可用

> 由于服务器临时过载或**维护，服务器当前无法处理请求**

如何配置 Apache 2.2 以使用自定义 HTML 页面提供基于特定名称的虚拟主机 503 代码？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2011-03-27T05:59:15.280

## 503 暂时不可用，有触发器

```
RewriteEngine On
RewriteCond %{ENV:REDIRECT_STATUS} !=503
RewriteCond "/srv/www/example.com/maintenance.trigger" -f
RewriteRule ^(.*)$ /$1 [R=503,L] 
```

如果`maintenance.trigger`文件存在，Apache 将提供`503 Service Unavailable`响应。要提供自定义“停机维护”页面，请使用`ErrorDocument`指定文件，如下所示：

```
ErrorDocument 503 /503_with_cats.html 
```

享受！

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-03-07T20:45:00.017

你可以使用[mod_rewrite](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html)：

```
RewriteEngine on
RewriteCond %{ENV:REDIRECT_STATUS} !=503
RewriteRule !^/down/for/maintenance$ %{DOCUMENT_ROOT}down/for/maintenance [L,R=503] 
```

该`RewriteCond`指令确保重定向到自定义错误文档时不会发生其他内部错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-21T19:31:39.687

@temoto

要为机器人指定 503 并为人类指定维护页面，请尝试以下操作

```
RewriteEngine on
RewriteBase /
#for bots such as google
RewriteCond %{HTTP_USER_AGENT} ^.*(Googlebot|Googlebot|Mediapartners|Adsbot|Feedfetcher|bingbot)-?(Google|Image)? [NC]
RewriteCond %{ENV:REDIRECT_STATUS} !=503
RewriteRule !^/down/for/maintenance$ %{DOCUMENT_ROOT}down/for/maintenance [L,R=503]

#for humans
RewriteCond %{REMOTE_HOST} !^1\.1\.1\.1
RewriteCond %{REQUEST_URI} !^/maint.html [NC]
RewriteRule .* /maint.html [R=302,L] 
```

# java - Java中的吃豆人迷宫

> ID：622471
> 
> 赞同：8
> 
> 时间：2009-03-07T20:45:08.987
> 
> 标签：java, algorithm, 2d, maze

所以我正在用 Java 构建 pacman 游戏来自学游戏编程。

我有基本的游戏窗口，里面有 pacman sprite 和 ghost sprites，pacman 用箭头键移动，不会超出窗口的墙壁等。现在我正在尝试构建迷宫，就像在这个图片：

![吃豆人迷宫](https://upload.wikimedia.org/wikipedia/en/5/59/Pac-man.png)

如果没有给我直接/完整的解决方案，有人可以指导我如何构建它吗？我在这里只谈论边界和管道（'T' 标记），你不能通过它们，你必须四处走动。不是吃豆人吃的那些点。

以下是我的问题：

1）创建这个迷宫最有效的算法/方法是什么？每次调用paint()方法时都必须绘制它，还是有办法只在游戏开始时绘制它而不再绘制？

2）这将如何实际绘制到屏幕上？我假设`fillRect()`将被使用？

3) 任何有关碰撞检测的提示（因此 pacman/ghosts 无法穿过墙壁）都会有所帮助。

4）关于如何计算管道之间的空白空间以便在它们之间填充点的任何提示也将非常有帮助。

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-07T21:02:23.360

我不会那样做的。

我会绘制图形地图，然后创建一个代表地图的 2D 数据数组。数据地图将负责确定碰撞、吃点、糖果在哪里以及鬼魂在哪里。处理完所有内容的所有逻辑后，只需使用 2D 数组在图形地图上以正确的像素坐标显示所有内容。

例如，用户正在按下左键。首先，您确定 pacman 位于元素 3、3。元素 3、2 包含表示墙壁的信息，因此您可以执行代码以使他忽略该命令。

编辑：

每个元素将代表一个点可能在哪里。例如：

不，看着板我会说阵列看起来像这样。

```
d,d,d,d,d,d,d,d,d,d,d,d,w,w,d,d,d,d,d,d,d,d,d,d,d,d
d,w,w,w,w,d,w,w,w,w,w,d,w,w,d,w,w,w,w,w,d,w,w,w,w,d
p,w,w,w,w,d,w,w,w,w,w,d,w,w,d,w,w,w,w,w,d,w,w,w,w,p    
d,w,w,w,w,d,w,w,w,w,w,d,w,w,d,w,w,w,w,w,d,w,w,w,w,d    
d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d 
```

等等。但是，您可能希望选择一个比字符更灵活的数据结构，因为某些区域需要包含一堆不同的信息。IE 即使幽灵生成区域是空白的，pacman 也不允许在那里。侧逃生的鬼魂和吃豆人的移动是不同的，糖果重生点是一个空白点，但如果你想保持灵活，你需要在每张地图的基础上指出它的位置。

您需要记住的另一件事是 pacman 和幽灵通常位于点之间，因此包含代表它们在 1,2 和 1,3 之间占用的空间百分比的信息对于碰撞检测和确定很重要当您想从板上移除点、通电和糖果时。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T21:02:39.413

1.  您可以将地图绘制成 BufferedImage，然后在每个paint() 上绘制它。通过这种方式，您将获得相当合理的性能。

2.  如果您对实心墙感到满意，您可以使用 fillRect 绘制每个方形墙块。如果您希望获得与图片相同的外观，您需要弄清楚如何以正确的方式绘制线条并使用弧线作为角落。

3.  Pacman 游戏地图由方格组成，Pacman 和幽灵总是以动画的方式从一个方格移动到相邻的方格（即你按右，吃豆人向右移动一个方格）。这意味着碰撞检测很容易：只是不允许移动到非空方格。

4.  我不明白你想在这里问什么。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-07T21:18:24.617

1）只是为了给我关于重绘的建议。如果您发现重绘整个图像很慢，您可以做的事情是仅确定屏幕上已更改的元素并重绘这些元素。一种方法如下： 确定已移动的精灵。确定（近似）围绕这些精灵的矩形。仅重绘这些矩形。这样你只刷新屏幕的一部分而不是整个屏幕。与重绘整个屏幕相比，这应该会提高性能。

对于您提出的其他问题，其他答案是合理的。

# c# - 在调用 Shutdown 然后在 Socket 上关闭时获取 ObjectDisposed 异常

> ID：622472
> 
> 赞同：3
> 
> 时间：2009-03-07T20:45:12.387
> 
> 标签：c#, networking, sockets

我有一个 SocketState 对象，用于将缓冲区和套接字包装在一起并将其传递给 Begin/End 异步套接字方法。在析构函数中，我有这个：

```
~SocketState()
{
    if (!_socket.Connected) return;

    _socket.Shutdown(SocketShutdown.Both);
    _socket.Close();
} 
```

当它到达 Close() 时，我得到一个 ObjectDisposed 异常。如果我注释掉调用 Shutdown()，当它到达 Close() 方法时，我不会收到错误消息。我究竟做错了什么？

## 编辑：

我知道 IDisposable 解决方案似乎是我的代码应该如何*布局*，但这实际上并不能解决我的问题。它不像析构函数被调用两次，那么为什么调用 dispose() 而不是使用析构函数对我有帮助呢？连续调用这两个函数时，我仍然遇到同样的异常。

我查看了类似服务器的源代码，他们所做的只是将这两个语句包装在一个 try 块中并吞下异常。如果必须这样做，我会这样做，因为它看起来无害（无论如何我们都会关闭它），但如果可能的话，我想避免它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T21:16:34.590

使用反射器；看来`Close()`基本上只是调用`Dispose()`Socket （它会记录任何一方）。看着`Shutdown()`它调用`ws2_32.dll!shutdown()`套接字句柄，它*也*被`Dispose()`. 可能发生的是它试图`ws2_32.dll!shutdown()`在同一个套接字句柄上调用两次。

简而言之，就是打电话`Close()`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T21:15:38.603

_socket 实现 IDisposable，当你的终结器运行时，套接字已经被释放（或就此而终结）。

你应该在你的类上实现 IDisposable 并遵循 dispose 模式。

例子：

```
public class SocketState : IDisposable
{
  Socket _socket;

  public SocketState()
  {
    _socket = new Socket();
  }

  public bool IsDisposed { get; private set; }

  public void SomeMethod()
  {
    if (IsDisposed)
      throw new ObjectDisposedException("SocketState");

    // Some other code
  }

  #region IDisposable Members

  public void Dispose()
  {
    Dispose(true);
    GC.SuppressFinalize(this);
  }

  protected virtual void Dispose(bool disposing)
  {
    if (!IsDisposed)
    {
      if (disposing)
      {
        if (_socket != null)
        {
          _socket.Close();
        }
      }

      // disposed unmanaged resources

      IsDisposed = true;
    }
  }

  ~SocketState()
  {
    Dispose(false);
  }

  #endregion
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-10-03T17:03:26.590

你的问题有点不清楚。你说，当

> 它得到了`Close()`，你得到一个`ObjectDisposedException`

但是看，[`Close`](http://msdn.microsoft.com/en-us/library/wahsac9k(v=vs.100).aspx)不扔任何东西。它是[`Shutdown`](http://msdn.microsoft.com/en-us/library/system.net.sockets.socket.shutdown(v=vs.100).aspx)那个 throw `ObjectDisposedException`。这可能就是注释掉有用的原因`Shutdown`——这正是你得到例外的地方。

我的解释是，在您的主要对象被*finalized*`.Dispose()`之前，您的套接字会自动（通过它自己的终结器）。

 *[正如这里](https://stackoverflow.com/a/1708552/579817)所说：

> 终结器的执行顺序是不确定的——换句话说，您不能依赖在终结器中仍然可用的另一个对象。

# asp.net - 没有更新面板的 ASP.NET AJAX

> ID：622474
> 
> 赞同：3
> 
> 时间：2009-03-07T20:45:50.920
> 
> 标签：asp.net, ajax

为 asp.net 2.0-3.5 ajax Web 应用程序支持数据的最佳实践是什么？我不想使用更新面板，只是纯文本数据 (JSON)。我应该使用网络服务吗？或者有没有别的办法。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-07T21:29:56.150

Errrr... 使用 .aspx 页面？处理程序有什么用？

您只需要创建一个通用的基本处理程序来处理 json（反）序列化（例如使用[Json.net](http://www.codeplex.com/Json)），然后为您的 ajax 调用实现处理程序。

```
public abstract class JsonHandlerBase<TInput, TOutput> : IHttpHandler
{
    public void ProcessRequest(HttpContext context)
    {
        context.Response.ContentType = "application/json";
        TInput input = (TInput)context.Request; // Desesialize input
        TOutput output = ProcessRequest(context, parameter);

        string json = (string)output; // Serialize output
        context.Response.Write(json);
    }

    public abstract TOutput ProcessRequest(HttpContext context, TInput input);

    public bool IsReusable { get { return false; } }
} 
```

这只是一个示例，由您决定是否需要在基本处理程序中使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T20:51:43.293

您可以使用纯 aspx 页面或处理程序，只输出 JSON。为此，您可以擦除 aspx 中的所有 Html，然后在代码中使用 Response.Write()。

然后对于前端 JS，您可以使用 JQuery 或任何其他 Ajax 框架。

您可能还想查看 Asp.Net MVC。MVC 有一个 JsonResult 响应类型，并且很容易与 JQuery 一起使用以获得非常好的 Ajax 功能。

# c# - 泛型语法

> ID：622478
> 
> 赞同：2
> 
> 时间：2009-03-07T20:49:41.597
> 
> 标签：c#, generics

这是一些我似乎无法理解它是如何工作的代码。我知道它使用的是泛型，但 where 子句中的“新”是什么意思？

```
public class MediaPresenter<T>
    where T : Media, new()
{
    public MediaPresenter(string mediaPath, params string[] extensions)
    {
        _mediaPath = mediaPath;
        _fileExtensions = extensions;
    }

    private void LoadMedia()
    {
        if(string.IsNullOrEmpty(_mediaPath)) return;

        _media = new ObservableCollection<Media>();
        DirectoryInfo directoryInfo = new DirectoryInfo(_mediaPath);

        foreach(string extension in _fileExtensions)
        {
            FileInfo[] pictureFiles = directoryInfo.GetFiles(
                extension,
                SearchOption.AllDirectories
                );

            foreach(FileInfo fileInfo in pictureFiles)
            {
                if(_media.Count == 50) break;

                T media = new T();
                media.SetFile(fileInfo);
                _media.Add(media);
            }
        }
    }
} 
```

我也不明白 LoadMedia 方法中的 T 是如何使用的？T 可以在课堂上的任何地方引用吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-07T20:53:22.913

> 这是一些我似乎无法理解它是如何工作的代码。我知道它使用的是泛型，但 where 子句中的“新”是什么意思？

where 子句中的 new() 意味着 T 必须是可以实例化的类型。如果 T 没有无参数构造函数，则 T 不是作为类型参数传递给此类的有效类型。

请参阅[http://msdn.microsoft.com/en-us/library/sd2w2ew5.aspx](http://msdn.microsoft.com/en-us/library/sd2w2ew5.aspx)。

> 我也不明白 LoadMedia 方法中的 T 是如何使用的？T 可以在课堂上的任何地方引用吗？

是的。T 是类的类型参数，所以整个类都知道。例如，在类中具有 T 类型的字段或返回 T 的方法也是有效的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T20:51:35.790

new() 意味着 T 需要有一个无参数的构造函数。（这种情况下还需要继承Media类）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T20:56:38.367

T 是实例化此类时使用的特定类型。例如，如果您要声明

```
MediaPresenter<Media> myMediaPresenter = new MediaPresenter<Media>(); 
```

然后 T 将成为 Media 并且您查询的行将在运行时被翻译成类似

```
Media media = new Media(); 
```

因为当我们声明上面的类时，我们使泛型类型参数等于 Media。

希望有帮助

# jquery - Django + 阿贾克斯

> ID：622481
> 
> 赞同：21
> 
> 时间：2009-03-07T20:50:59.783
> 
> 标签：jquery, django

所以，我刚开始在我的一个 Django 项目中使用 jQuery，但我有一个非常菜鸟的问题。

在 django 视图中，您必须从视图返回一个 HttpResponse 对象，但有时我不需要返回任何东西。例如，我可能只是通过 ajax 更新数据库，不需要发回任何东西。所以我的问题是，在这种情况下你会怎么做？

谢谢

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-07T21:16:09.507

HTTP 响应不仅仅是向浏览器发送内容。响应与状态代码和多个 HTTP 标头相关联。此外，响应可能包含正文（实际内容）。

我认为发送一个没有正文的 HttpResponse 对象是可以的。那是：

```
return HttpResponse() 
```

这将发送一个状态码为 200 OK 的 HTTP 响应，这正是服务器端发生的情况，即操作成功，一切正常。虽然有更好的方法，见下文。

[平心而论](http://en.wikipedia.org/wiki/Representational_State_Transfer)，当操作遇到问题时，您应该返回一个带有适当[状态码](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)的 HTTP 响应。就像指定服务器端错误的 5XX 状态代码之一一样。

现在，查看所有这些 HTTP 状态代码，我们看到 201 Created 状态代码，当您将 POST 数据存储在某个地方（如数据库）时，它比 200 OK 更合适。在这种情况下，您应该在您的视图中执行以下操作：

```
return HttpResponse(status=201) 
```

而且，正如有人已经提到的那样，您可以在 JavaScript 中利用这些状态代码，以便您可以向用户提供更多信息的消息，或者为您的请求选择其他策略。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-07T21:09:02.800

您仍然希望返回一个 HttpResponse 以让 jQuery 知道响应是成功还是失败。大多数包含 jQuery 的 javascript 库都在寻找 200 ok 响应。更不用说返回一个包含受影响的行数或投票计数的 JSON 对象可能很有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T21:08:34.610

我会返回一个空字符串：

```
return HttpResponse("") 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T21:33:50.337

感谢您的回答。我目前正在处理的示例是待办事项列表，用户可以在其中将项目拖动到新位置。我正在使用 jQuery 将发布数据发送到视图，该视图将新订单保存在数据库中。对于此示例，我不想在用户使用列表后向用户显示响应，因为它会变得烦人并且不是真正必要的。如果发生任何错误，我将捕获它们，并在发生时向用户显示适当的响应。

那么`return HttpResponse(status=201)`在这种情况下使用是一个好主意吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-25T10:56:34.090

抱歉，还不能评论。

HTTP 状态代码是添加附加信息的好方法（如 REST 所示）。请参阅此处了解不是 200、404 或 500 的那些：

[RFC2616](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)

干杯，

# apache - htaccess 重定向问题

> ID：622487
> 
> 赞同：1
> 
> 时间：2009-03-07T20:55:48.633
> 
> 标签：apache, .htaccess, redirect

我试图让我的 .htaccess 将所有请求重定向到 /blogs 目录，但以 /staff 开头的请求除外。这是我到目前为止所拥有的：

```
RewriteEngine On
RewriteRule ^staff(.*)$ staff/$1 [L]
RewriteRule ^(.*)$ blogs/$1 [L] 
```

它适用于每种情况，除非我执行[http://mydomain.com/staff](http://mydomain.com/staff)或[http://mydomain.com/staff/alice](http://mydomain.com/staff/alice)在这种情况下我会收到 500 内部错误。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T21:06:55.643

试试这个：

```
RewriteRule ^staff/  - [L]
RewriteRule !^blogs/ blogs%{REQUEST_URI} [L] 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T21:01:32.317

记录到`error.log`什么？错误可能来自您的应用程序本身，也可能`mod_rewrite`来自您的应用程序本身。

# oop - 您认为函数式语言是否适合具有大量业务规则但计算量很少的应用程序？

> ID：622497
> 
> 赞同：5
> 
> 时间：2009-03-07T21:01:29.417
> 
> 标签：oop, programming-languages, functional-programming

我坚信，对于需要大量计算的应用程序（数据挖掘、人工智能、nlp 等），函数式编程是一个很好的选择。

函数式编程是否正在任何知名的企业应用程序或开源项目中使用？他们是如何将业务逻辑整合到功能设计中的？

请忽略这样一个事实，即很少有人使用函数式编程，而且它有点难。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T22:22:44.883

Clojure 和 Scala 等函数式编程语言几乎适用于任何事情。至于 Haskell，一个有经验的 Haskell 编程可能能够用任何语言代替 Haskell 来解决任何问题 - 是否有效。我不知道是否有一种函数式编程语言可以被认为是解决这个特定问题的所有语言中的 /best/ ，但请放心，它**会**工作并且非常好。

此外，Clojure 和 Scala 是在 JVM 上实现的。所以从技术上讲，他们/是/在企业平台上。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T21:22:46.993

如果不是功能，什么是业务规则？规则的应用可以表示为对一组数据应用一个函数。它也可以与多态性结合。例如，通过通用函数（多重分派也很方便）和继承。

代码就是数据，数据就是代码，两者都应该像水一样。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-07T22:40:23.343

一年多前，我深入研究了 Haskell，还尝试了一些我认为是典型业务问题的事情（说白了，给定多个值，正确的响应是什么？）。因此，我会说，是的，您应该能够使用函数式编程对许多业务问题进行建模。

就我个人而言，我在 Haskell 中找不到相同的显而易见性，我可以将 OO + 函数式方法推向 C# ，但这很可能是因为我对 Haskell 做的不多，而对 C# 做的更多。

然后是如何与客户沟通的问题。我的经验是，他们中的许多人都严格按照时间顺序来思考，这有利于命令式编程。即使进入状态变化模型等，您也可能会失去奇怪的客户。考虑可能代表业务按时间顺序排列的功能组合和单子可能超出许多客户的范围。

[无论哪种方式，您都可以在此处](https://realfiction.net/2007/05/30/haskell-decision-making)找到我的业务示例。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-08T04:40:31.700

从我所见，Scala 看起来可以很好地处理普通的 Java。因此，Java 可以处理任何业务，Scala 也可以。

在 .NET 方面，F# 是另一个很好的函数式语言示例，可以很好地用于“业务”应用程序。简而言之，F# 可以做 C# 可以做的所有事情，而且更简单。

但是对于这两种语言，“大型编程”方面倾向于借鉴 OOP。并不是说混合有什么问题，但也许这不是你问的。如果您想坚持更实用的方法，并且说不使用对象，您可能会遇到更多麻烦，因为工具支持不会处于同一水平。对于易于与 .NET/Java 集成的语言，这不是什么大问题。

至于“是否明智？”：这取决于项目、公司和其他环境因素。似乎一种常见的“企业模式”是代码必须极其简化，以便任何人都可以使用它。在这种情况下，您可能会让那些认为使用 lambda 让其他人难以理解的人参与其中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-05-12T04:54:21.143

> 但是，将函数式编程用于具有大量业务规则但计算量不多的典型企业应用程序是否明智？

业务规则只是计算，您通常可以使用函数式编程更简洁明了地表达它们。

越来越多的企业应用程序是用函数式语言编写的。Citrix XenDesktop 和 XenServer 建立在主要用 OCaml 编写的工具堆栈之上。MyLife 人物搜索引擎是用 OCaml 编写的。我们是一家小公司，但我们所有的 LOB 软件（例如信用卡交易、账户、网络分析）都是用 F# 编写的。微软在 Bing 上的广告使用 F# 代码。也许最明显的例子是任何使用最新版本的 C# 和 .NET 的人，因为他们几乎肯定会使用函数式概念（例如委托）。

如果您指的是更奇特的函数式语言，例如 Clojure、Scala 和 Haskell，那么我相信有些人正在使用它们，但我自己没有任何细节。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-07T22:39:03.613

我假设当您谈论很多业务规则时，您正在考虑应用程序开发。应用程序开发，您想要对真实世界的工作流程进行建模。与普通编程不同，应用程序开发涉及更高级别的责任（特别是对于需求捕获和测试）。如果是这样，我强烈建议您看看是否可以应用领域驱动开发。领域驱动开发的一个自然选择是面向对象的方法。这一点以及许多程序员在面向对象编程方面表现不错的事实是其在应用程序开发中受欢迎的原因之一。然而，这并不意味着现实世界的大型项目总是以这种方式编写（阅读[http://www.paulgraham.com/avg.html](http://www.paulgraham.com/avg.html)）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T02:49:36.113

您可能想查看[iTasks 系统](http://www.cs.ru.nl/~rinus/iTaskIntro.html)，它是一个功能语言 Clean 的库，专门用于表达工作流和业务流程。

# c# - 为什么我在尝试打印到 PDF 时收到错误：“访问被拒绝”？

> ID：622499
> 
> 赞同：1
> 
> 时间：2009-03-07T21:02:19.400
> 
> 标签：c#

我使用 iTextSharp 开发了一个 Web 应用程序。当我使用 iTextSharp 运行代码时，用户会收到以下错误消息：

> 访问被拒绝：“C:\inetpub\vhosts\bookmygroups.com\httpdocs”

这是我的代码：

```
PdfWriter pdfw = PdfWriter.GetInstance(myDocument, 
    new FileStream(strPath, FileMode.Create)); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T21:12:59.933

这可能是因为 Asp.Net Hosting 进程无权写入该特定目录。您需要授予托管进程对该目录的访问权限，以便您的 Web 应用程序能够写入该目录。

这篇 CodeProject 文章详细介绍了如何完成这个： http: [//www.codeproject.com/KB/aspnet/Ahmed_Kader.aspx](http://www.codeproject.com/KB/aspnet/Ahmed_Kader.aspx)

# latex - 在 LaTeX 中指定图形宽度的数学运算符

> ID：622502
> 
> 赞同：16
> 
> 时间：2009-03-07T21:04:02.717
> 
> 标签：latex

在 LaTeX 图形中，可以使用`\textwidth`和`\columnwidth`指定相对于周围文本大小的图形大小，例如 `\includegraphics[width=.5\textwidth]{myimage}`.

我想轻松地从 onecolumn 切换到 twocolumn 模板（然后返回），而不会使图形对于 onecolumn 模板变得太大。对于双列模板（`\columnwidth`大约是 的一半`\textwidth`），我想要类似的东西： `\includegraphics[width=.9\columnwidth]{myimage}`. 并且对于一个列模板（其中`\columnwidth`和`\textwidth`相等）
`\includegraphics[width=.5\textwidth]{myimage}`：。

现在，我想我可以使用某种 min 运算符来限制它： `\includegraphics[width=min(.5\textwidth,.9\columnwidth)]{myimage}`但这是无效的语法。有没有这样的东西可以解决这个问题，可能是通过使用 LaTeX 宏系统？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-07T22:44:57.123

尽管可以编写这种宏，但我不想将它硬编码到每个图形中；像这样的东西怎么样

```
\makeatletter
\newlength \figwidth
\if@twocolumn
  \setlength \figwidth {0.9\columnwidth}
\else
  \setlength \figwidth {0.5\textwidth}
\fi
\makeatother 
```

然后使用

```
\includegraphics[width=\figwidth]{myimage} 
```

插入图形。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-09T17:32:50.213

`\textwidth`是页面正文的水平宽度，并不真正适合您的目的。

`\linewidth`是当前行的宽度；它将根据列、缩进等进行更新。

以下段落生成的图片应该精确适合整个线宽（即没有过度警告）：

```
\noindent\includegraphics[width=\linewidth]{myimage} 
```

如果您喜欢左右两边的小边距，您可以使用：

```
\begin{center}
\includegraphics[width=.9\linewidth]{myimage}
\end{center} 
```

或者，如果您想以绝对大小指定边距：

```
\usepackage{calc}
...
\begin{center}
\includegraphics[width=\linewidth-20pt]{myimage}
\end{center} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-21T04:42:29.640

嗯...上面的代码（\if@twocolumn 等）根本不适合我。不知道为什么不。:( 使用 fink 在 osX 上使用 tetex。尝试使用 revtex4，所以也许这就是问题所在。我真的很喜欢这种改变的想法，因为我将在我的论文和各种期刊文章中使用宽度等，并且使用宏指定这些距离可能有助于这些类型的转换。

任何意见都非常感谢！-艾伦

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T21:06:19.623

对此更熟悉的其他人可能会回答，但请注意，如果您要使用两列，您还需要将您的图形类型更改为 figure*。

# java - 反射和远程如何在内部工作？

> ID：622505
> 
> 赞同：3
> 
> 时间：2009-03-07T21:05:20.203
> 
> 标签：java, .net, reflection, remoting

我很想知道.net 中的反射和远程处理如何在内部工作。我还听说 .net 可以使用远程处理与用其他语言（如 Java）编写的应用程序进行通信。这是如何运作的？

这可能是一个很大的问题，因此简要涉及每个问题的答案是合理的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T21:37:07.177

远程处理通过拦截对某些对象的调用 ( `MarshalByRefObject`) 来工作，并改为执行 RPC 调用；本质上，调用者处的对象只是原始 AppDomain/machine/etc 处*真实对象的轻量级代理。*参数和结果被传输（再次考虑`MarshalByRefObject`到 - 否则通过使用`BinaryFormatter`来序列化值）。

反射深入核心运行时，并提供对底层类型定义的访问。这可能部分是因为 .NET 语言下的 IL 在原始代码方面非常具有表现力。

但是，我个人并不知道通过远程处理到 java 的任何方式。这可能是可能的，但使用的格式是（AFAIK）专有的。通常，此类调用更可能采用 SOA 调用的形式，例如 Web 服务（在 SOAP 或 POX 上），或其他开放标准，例如使用 JSON 或“协议缓冲区”（一种开源有线格式）序列化的消息带有 C# 和 java 的变体）。

# .net - 我不了解应用程序域

> ID：622516
> 
> 赞同：81
> 
> 时间：2009-03-07T21:11:36.973
> 
> 标签：.net, appdomain

.NET 具有应用程序域的概念，据我了解，它可用于将程序集加载到内存中。我已经对应用程序域进行了一些研究，并去我当地的书店了解了关于这个主题的一些额外知识，但它似乎非常稀缺。

我所知道的我可以对应用程序域做的就是在内存中加载程序集，我可以在需要时卸载它们。

**我提到的应用程序域的其他功能是什么？线程是否尊重应用程序域边界？除了通信性能之外，在主要应用程序域之外的不同应用程序域中加载程序集是否有任何缺点？**

链接到讨论应用程序域的资源也很好。我已经查看了 MSDN，它没有太多关于它们的信息。

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-03-07T21:18:44.430

AppDomains 最好被可视化为一个非常轻量级的过程。

每个 .Net 进程可以有 N 个 AppDomain，但一般来说只有一个。AppDomains 的真正优势在于它们在您的流程中提供了隔离边界。对象只能通过远程处理或序列化跨 AppDomain 边界相互通信。

也可以在一个进程中以完全不同的安全级别运行 2 个 AppDomain。这可以让您以完全信任运行您的主应用程序，同时以低得多的信任级别运行不受信任的插件。

很难对线程是否尊重 AppDomain 说“是”或“否”。单个线程可能位于 N 个不同的 AppDomain 中。如果一个 AppDomain 中的对象对另一个 AppDomain 中的对象进行远程调用，则可能会出现这种情况。线程必须在 AppDomain 之间转换才能完成。

AppDomains 的缺点主要是复杂。远程处理可能需要一点时间来了解并正确设置 AppDomain 可能是一个不平凡的过程。

您可能想浏览一下 AppDomains 上的 MSDN 文档。很难找到描述它们的简洁教程，因为它们具有各种复杂的功能。这提供了一个很好的概述，如果它不直接回答您的问题，至少会为您指出正确的位置。

[http://msdn.microsoft.com/en-us/library/cxk374d9.aspx](http://msdn.microsoft.com/en-us/library/cxk374d9.aspx)

此文档不再维护，请参阅此更新版本： [https ://msdn.microsoft.com/en-us/library/2bh4z9hs(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/2bh4z9hs(v=vs.110).aspx)

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2009-03-07T23:03:22.743

JaredPar 的回答很好，只是他没有指出 AppDomain 存在的[理由](http://en.wikipedia.org/wiki/Raison_d'%C3%AAtre)——即您只能通过卸载 AppDomain 来卸载程序集。如果您是一个长期运行的操作系统进程，并且您希望出于任何原因必须加载*然后卸载程序集，那么您需要一个 AppDomain。*这里的典型示例是 ASP.NET，它按需加载应用程序代码程序集，然后可以在以后不再使用应用程序时卸载它们。

你为卸载能力付出的代价就是独立性——你需要跨 AppDomain 边界进行通信，不能进行简单的方法调用。您需要管理 AppDomain 生命周期。等等。

*如果您只需要动态加载程序集并且认为在单个进程的生命周期内*不需要卸载它们，那么您可能*不需要*运行多个 AppDomain。一个很好的例子可能是一个支持插件模型的富应用程序，它在“etc”目录中嗅出插件程序集并加载它们。但是，如果插件模型要求卸载插件......好吧。

有一些异常情况。就像，假设您想同时加载 2 个不同版本的程序集。如果您不使用 AppDomain 将它们隔离，您可能会遇到陷阱。但这将是相当罕见的。

证明 AppDomains 存在的核心场景是必须能够卸载程序集的长时间运行的进程。

当然，当您要卸载程序集时，应用程序可以依赖操作系统进程。换句话说，您可以运行 3 或 4 个协作进程，每个进程都有自己的程序集集，当您想要卸载程序集时，只需关闭承载该程序集的进程即可。但是 AppDomain 提供了更高性能的机制来做到这一点，不需要进程停止/启动或跨进程通信，这仍然比前面描述的跨 AppDomain 通信更重。我的意思是它仍在远程处理，但速度较慢且上下文切换更多。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-03-07T21:46:21.697

您可以使用 AppDomain 执行以下操作：

*   您可以在不危及程序稳定性的情况下将其关闭。
*   您可以加载代码并给予比您自己的进程更少的权限（例如，您的进程运行完全受信任，但您将代码加载到单独的 AppDomain 中，甚至无法在磁盘上创建文件。）
*   您可以处理 AppDomain 的未处理异常，而不必使您的进程崩溃。
*   等等。

简单地说，它是一个安全边界，而且几乎是一个进程边界。就性能而言，一个进程中的多个 AppDomain 并不代表显着的开销。启动单独的进程而不是 AppDomain 的成本要高得多。

# java - 如何在 Java 游戏中将 400x400 的窗口表示为地图？

> ID：622517
> 
> 赞同：1
> 
> 时间：2009-03-07T21:11:52.700
> 
> 标签：java, 2d, maps

我正在构建一个吃豆人游戏。基本上，我想要一个由块/图块组成的窗口的地图表示。然后随着 pacman 角色/幽灵的移动，我会改变它们在地图上的位置以表示屏幕上的内容，并将其用于碰撞检测等。

我该如何构建这张地图，特别是因为屏幕是由 x,y 坐标组成的，所以我怎样才能在地图上正确地表示它们？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T21:42:21.860

我知道开始考虑对象和接口是很有诱惑力的，但是您是否考虑过一个每个元素代表 40 个像素或其他东西的二维数组？我不记得 pacman 在碰撞时是像素精确的，更多的是每个部分移动的方向的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T21:42:46.837

通常你有一个不引用像素的抽象表示（例如，吃豆人迷宫可能只是 w 单位宽），然后你有一个线性变换（你知道，y = mx + b）来携带实际像素的抽象表示。

具体来说，假设您希望抽象表示为 100 单位宽，并且您希望将其渲染为 400 像素。那么变换就是scrn_x = 4 * x。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T21:32:38.763

如果不自己写，很难想出这个但是。

首先，您需要创建实现 ICollidable 的实体定义。实体将包括幽灵、吃豆人、圆点和通电。地图中的每个元素都将包含与其他信息一起的所有当前实体的列表，并带有一种“位置”值以增加精度。ICollidable 接口不仅包括用于确定哪些实体相互碰撞的逻辑（例如，幽灵不与点碰撞），而且还包括确定它们是否处于相互碰撞的位置。IE 如果 pacman 从右侧进入一个空间，而一个幽灵从左侧离开该空间，则不会发生碰撞。它还将帮助确定 pacman 何时准确地吃掉了一个点，以便从图形上看它是正确的。IE 如果你在 pacman 进入空格时破坏了一个点，它'

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T21:52:40.137

您的精灵（如 pacman 和 ghost）由位置 (x,y) 表示。要确定它们是否相互碰撞，请使用以下伪代码：

```
sprites = [ ... list of sprites ... ]
for i1=0 to len(sprites):
    sprite1 = sprites[i1]
    for i2 = i1+1 to len(sprites):
        sprite2 = sprites[i2]
        if (sprite1.x-sprite2.x)^2+(sprite1.y-sprite2.y)^2 < radius_of_sprites^2:
            collide(sprite1, sprite2) 
```

请注意，这根本不涉及地图。我们可以分别检查 pacman 和地图之间的碰撞。这里的关键技巧是你划分 pacman 的每个边（上、下、左、右）的像素坐标并检查碰撞。例如，如果 pacman 向右移动，我们需要检查右边缘是否有碰撞：

```
pacman_tile_x = (pacman.x+tilesize/2)/tilesize    # added tilesize/2 to check the middle of pacman
pacman_tile_y = pacman.y/tilesize + 1   # +1 because right edge is 1 tile to the right of the sprite's coordinate
if tile[pacman_tile_x][pacman_tile_y].is_a_wall:
    ... wall collide code ... 
```

现在，如果屏幕上有大量精灵，您可以通过存储地图中任何特定图块上存在的精灵来优化精灵到精灵的碰撞检测，因此您只需检查相邻图块中的精灵. 但是对于第一次通过和这个吃豆人游戏，它可能不是必要的优化。

# asp.net-mvc - ASP.NET MVC 模板

> ID：622521
> 
> 赞同：1
> 
> 时间：2009-03-07T21:14:18.200
> 
> 标签：asp.net-mvc

我对元素有重复标记，例如：

```
<div class="box">
    <div class="top"></div>
    <div class="content">
      content goes here
    </div>
    <div class="bottom"></div>
</div> 
```

顶部和底部使用 css 设置样式以包含边框图像。

我可以使用 JQuery 来注入标签，但是在 asp.net mvc 中模板控件是否有更好的方法？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T23:21:15.943

可能有很多方法可以解决这个问题，这里有一个：

创建一个 ViewUserControl（我们称之为“box.ascx”）：

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<Action>" %>
<div class="box">
    <div class="top"></div>
    <div class="content">
        <% Model(); %>
    </div>
    <div class="bottom"></div>
</div> 
```

在你的 aspx 中，只要你需要这个块，就这样称呼它：

```
<% Html.RenderPartial("box", Lambda.Action(() => { %>
here comes my content! <a href="http://www.google.com">Google!</a>
<% })); %> 
```

这是 Lambda 助手类：

```
public static class Lambda {
    public static Action Action(Action a) {
        return a;
    }
} 
```

如果你不使用这个小助手，它会崩溃，因为它会尝试施放动作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T22:08:41.453

我刚刚定义了两个扩展方法来写标签

```
 public static void BeginBox(this HtmlHelper htmlHelper)
  {
      StringBuilder box = new StringBuilder();

      box.AppendLine("<div class=\"box\">");
      box.AppendLine("    <div class=\"top\"></div>");
      box.AppendLine("        <div class=\"content\">");

      htmlHelper.ViewContext.HttpContext.Response.Write(box.ToString());
  }

  public static void EndBox(this HtmlHelper htmlHelper)
  {
      StringBuilder box = new StringBuilder();

      box.AppendLine("        </div>");
      box.AppendLine("    <div class=\"bottom\"></div>");
      box.AppendLine("</div>");

      htmlHelper.ViewContext.HttpContext.Response.Write(box.ToString());
  } 
```

我想这会做现在。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T23:37:25.517

您肯定想对 HtmlHelper 使用扩展方法，以便您可以使用以下符号：

```
<%=Html.Box("content string") %> 
```

* * *

```
public static stringBox(
       this HtmlHelper html, 
       string Content)
  {
      var sb = new StringBuilder();

      sb.AppendLine("<div class=\"box\">");
      sb.AppendLine("    <div class=\"top\"></div>");
      sb.AppendLine("        <div class=\"content\">");
      sb.AppendLine(Content);
      sb.AppendLine("        </div>");
      sb.AppendLine("    <div class=\"bottom\"></div>");
      sb.AppendLine("</div>");

      return sb.ToString();
  } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T21:24:18.177

据我所知，asp.net mvc 中没有内置模板解决方案。但是因为输出是纯 html，所以很容易只用 css 和一些 JS 来做你自己的模板。

当然，由于 asp.net mvc 中的所有内容都是可交换的，因此您可以将默认视图引擎替换为支持模板的视图引擎。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T21:36:49.970

为什么不使用母版页？您可以像在 ASP.Net 中一样在 MVC 中使用母版页

# javascript - HideShowPanel 方法中的错误：TypeError：document.all 不是函数，c#

> ID：622528
> 
> 赞同：0
> 
> 时间：2009-03-07T21:17:51.857
> 
> 标签：javascript

HideShowPanel 方法中的错误：TypeError：document.all 不是函数

SetExpandedDIVInfo 方法中的错误：TypeError：document.all 不是函数

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T21:45:54.067

document.all 在非 IE 浏览器中不是有效的 javascript 函数。您应该使用标准兼容的 document.getElementById

# javascript - 如何从 click() 函数内的动画队列返回真/假？

> ID：622533
> 
> 赞同：0
> 
> 时间：2009-03-07T21:19:31.900
> 
> 标签：javascript, jquery

这对我来说似乎很棘手，我认为我在这里忽略了一些简单的东西。你能帮我找到吗？

基本上，情况是这样的（名称不重要的变量用大写字母命名）：

```
$('a').filter('somecriteria').each(function() {
    var self = $(this);
    self.click(function() {
        B.animate({ something: somevalue }, { duration: "fast", complete: function(){
                return true; // <--- see notes below 
            }  
        });
        return false;
    });
}); 
```

注意：我怎样才能让它`return`成为`return`发送的那个，`click()`以便只有在 animate() 完全完成后用户才会被带到新页面（注意：在我的真实代码中，我有三个 animate() 链接在一起）。我需要这样做，因为动画被切断并且新页面过早加载。只有当 click() 发送 return false 直到动画真正结束时，动画才会完全生效。

我尝试捕获`href`链接的属性并执行 a`window.location = capturedlink`而不是`return true`. 这可行，但如果可能的话，我想避免这种情况，因为出于安全考虑，有些人已禁用更改位置。

或者是否有另一种方法可以让 jQuery 在动画中间更改为新的 URL？

非常感谢您查看这个问题。

安德烈

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-07T21:25:16.410

恐怕捕捉`href`方式将是做你想做的最明显的方式。我不确定执行以下操作是否会规避在其安全设置中禁用更改位置的人，但您可以尝试一下：

```
$('a').filter('somecriteria').each(function() {
    var self = $(this);
    self.click(function() {
        if(self.hasClass('animated')) return true; // return true if already animated
        B.animate({ something: somevalue }, { duration: "fast", complete: function(){
                self.addClass('animated').click(); // fire the click event
            }  
        });
        return false;
    });
}); 
```

# asp.net - 使用 ASP.net 下载和上传图片

> ID：622537
> 
> 赞同：2
> 
> 时间：2009-03-07T21:22:58.380
> 
> 标签：asp.net, image

在我的 Web 应用程序中，我需要能够允许用户上传和下载他们的图像。在 ASP.net 中如何做到这一点？

我希望用户能够登录（我已经完成了）并能够将图像上传到他们的帐户。稍后，我希望他们能够下载它们。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T21:33:12.630

如果图像大小合适（例如小于几 MB），您可以使用 <input type=file> 标记来执行此操作。将表单标签的编码设置为 multipart/form-data 并实现一些代码隐藏以获取文件。

有关详细示例，请参阅 ASP.Net 视频（[第 1 部分](http://www.asp.net/learn/videos/video-255.aspx)）和（[第 2 部分](http://www.asp.net/learn/videos/video-252.aspx)）。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T23:01:47.380

你也可以使用

```
<asp:FileUpload runat="server" id="upImage" Width="575px" CssClass="txt-Normal"></asp:FileUpload> 
```

这是我将它们保存到站点上某个位置的方法。

```
string completeFilePath = this.Request.PhysicalApplicationPath + System.Configuration.ConfigurationManager.AppSettings["ImageUploadPath"];

if (System.IO.Directory.Exists(completeFilePath))
{
    System.IO.Directory.CreateDirectory(completeFilePath);
}

if (!System.IO.File.Exists(completeFilePath + this.upImage.FileName))
{
    this.upImage.SaveAs(completeFilePath + this.upImage.FileName);
}

imageUrl = string.Format("~{0}{1}", System.Configuration.ConfigurationManager.AppSettings["ImageUploadPath"], this.upImage.FileName); 
```

# xml - 将命名空间添加到嵌套元素

> ID：622543
> 
> 赞同：0
> 
> 时间：2009-03-07T21:29:36.150
> 
> 标签：xml, xslt, namespaces

我有一些类似于此的 XML：

```
<envelope xmlns="http://test">
  <header>
    <msgId />
  </header>
  <body>
    <element1 />
  </body>
</envelope> 
```

我想为`<element1>`节点添加一个命名空间。谁能帮助我如何使用 XSLT 做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T22:09:03.247

```
<xsl:template match="element1">
    <xsl:element name="element1" namespace="http:..."/>
</xsl:template> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T06:52:12.503

Use Attribute Value Templates with `name()`

```
<xsl:template match="element1">
  <xsl:element name="{name()}" namespace="http://other-namespace">
  … 
```

with identity transformation will give you

```
<envelope xmlns="http:\\test">
  <header>
    <msgId/>
  </header>
  <body>
    <element1 xmlns="http://other-namespace"/>
    … 
```

# joomla - 将网站移植到 Joomla：如何处理 Javascript 菜单？

> ID：622552
> 
> 赞同：1
> 
> 时间：2009-03-07T21:38:54.880
> 
> 标签：joomla, joomla1.5

我正在将现有网站移植到 Joomla 1.5。现有网站上的菜单使用翻转图像和内联 Javascript。如何在不重写菜单代码的情况下使 Joomla 中的菜单看起来相同并使用 Joomla 菜单？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T17:41:31.883

实际上，它最终变得相当简单。Joomla 将菜单呈现为`<UL><LI><A>`标签。我所要做的就是从其中一个菜单图像中提取背景（处于选中和未选中状态），在 Joomla CSS 中的每个样式中设置一个图像作为背景，瞧，它看起来几乎和旧的一模一样网站（减去稍微不同的字体，因为文本不再是图像的一部分）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T14:15:41.870

要将菜单项显示为图像，请编辑菜单项并在“参数（系统）”标题下选择图像（此列表会自动填充图像/故事文件夹中的图像）。

您还需要为菜单设置模块以显示您设置的图像。转到扩展 > 模块，然后为您的菜单选择模块（例如，主菜单）。从那里，选择其他参数，然后将显示菜单图像和菜单图像链接设置为是。

翻转会有点棘手。您将无法添加内联 JavaScript，但您可能能够使用 JavaScript 来查找您的菜单并将翻转分配给每个项目。Joomla 附带 MooTools，或者如果您更喜欢使用 jQuery，您可以使用 jQuery。使用 Advanced Parameters 下的 Menu Tag ID 字段为您的菜单`ul`元素提供一个 HTML id。

# asp.net - 未调用 Javascript 函数 - ASP.NET 和 UpdatePanel

> ID：622554
> 
> 赞同：0
> 
> 时间：2009-03-07T21:41:43.827
> 
> 标签：asp.net, javascript, ajax

我在由页面（父 UC）加载的用户控件上具有以下结构：

```
<UpdatePanel>
  <UpdatePanel>
     .. In the codebehind, it loads a Child user control at runtime
  </UpdatePanel>
</UpdatePanel> 
```

UC 有 OnPageLoad 注册一个脚本。

```
ScriptManager.RegisterStartupScript(this, typeof(Page), "Load_" + this.ClientID, base.GetRegisterScript(this.ClientID), true); 
```

JS 函数永远不会在异步回发上执行。如果我删除 UpdatePanel，它会按预期工作

**编辑：使用 this.GetType() 而不是 typeof(Page) 但没有运气**

**再次编辑：**

Matt - 我试图用 UC 名称替换 typeof(Page)。这是更新的行：

```
ScriptManager.RegisterStartupScript(this, typeof(TemplateAreaTypeOne), "Load_" + this.ClientID, "...JS function here,,", true); 
```

为了澄清，页面加载了具有这些更新面板的父 UC。ParentUC 然后加载 ChildUC 并且 ScriptManager.RegisterStartuScript 用于 ChildUC

编辑

标记具有：

```
<script type="text/javascript">
//<![CDATA[
; findControl('PageLoadedHiddenTxtBox').value ='Set';OnLoadBegin('ctl00_WorkSpaceContent_ctlUnion1_ctlUnion1Child','Edit');OnLoadEnd('ctl00_WorkSpaceContent_ctlUnion1_ctlUnion1Child','Edit');
document.getElementById('ctl00_WorkSpaceContent_informationSummary').dispose = function() {
    Array.remove(Page_ValidationSummaries, document.getElementById('ctl00_WorkSpaceContent_informationSummary'));
}
//]]>
</script> 
```

请注意，调用的函数是已添加到 HTML 中的 OnLoadBegin 和 OnLoadEnd

再次编辑

让它工作使用：

```
ScriptManager.RegisterStartupScript(this.Page, typeof(Page),....) 
```

不知道为什么当我使用对页面的引用时它会起作用。

1.  如果我在页面上有多个控件，这会起作用吗？
2.  为什么当我使用对页面的引用时它会起作用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T21:48:40.037

您的 registerstartupscript 需要针对控件而不是页面不使用 typeof(Page)

# asp.net - GridView ASP.NET 排序

> ID：622561
> 
> 赞同：2
> 
> 时间：2009-03-07T21:45:43.100
> 
> 标签：asp.net, visual-studio, c#-4.0, gridview, gridview-sorting

我有一个不会排序的 ASP.NET GridView！我确定我遗漏了一些非常明显的东西。

**页面.aspx**

```
<asp:GridView ID="TimeAwayGridView" runat="server" AutoGenerateSelectButton="False"
    AutoGenerateEditButton="False" AutoGenerateDeleteButton="False" AllowPaging="False"
    AllowSorting="True" CssClass="gridview" OnSorting="TimeAwayGridView_Sorting">
    <Columns>
        <asp:BoundField DataField="Description" HeaderText="Description" SortExpression="Description" />
        <asp:BoundField DataField="Hours" HeaderText="Hours" SortExpression="Hours" />
    </Columns>
    <EmptyDataTemplate>
        There are currently no items in this table.
    </EmptyDataTemplate>
</asp:GridView> 
```

**页面.aspx.cs**

```
protected void TimeAwayGridView_Sorting(object sender, GridViewSortEventArgs e)
{

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T21:51:46.660

Asp.Net Datagrip 为您提供排序事件，以及在 GridViewSortEventArgs 中单击的列的名称，但您必须在 TimeAwayGridView_Sorting 函数中提供自己的排序实现。这意味着您应该对数据源进行排序并重新绑定数据网格。

# objective-c - Cocoa QTKit 和录制电影

> ID：622567
> 
> 赞同：0
> 
> 时间：2009-03-07T21:49:37.413
> 
> 标签：objective-c, cocoa, xcode, macos, qtkit

我是整个 QTKit 的新手，我正在寻找对以下代码的一些反馈，我试图用这些代码来显示相机的图像和录制电影。

```
- (void)initializeMovie {

NSLog(@"Hi!");

QTCaptureSession* mainSession = [[QTCaptureSession alloc] init];

QTCaptureDevice* deviceVideo = [QTCaptureDevice defaultInputDeviceWithMediaType:@"QTMediaTypeVideo"];

QTCaptureDevice* deviceAudio = [QTCaptureDevice defaultInputDeviceWithMediaType:@"QTMediaTypeSound"];

NSError* error;

[deviceVideo open:&error];
[deviceAudio open:&error];

QTCaptureDeviceInput* video = [QTCaptureDeviceInput deviceInputWithDevice:deviceVideo];

QTCaptureDeviceInput* audio = [QTCaptureDeviceInput deviceInputWithDevice:deviceAudio];

[mainSession addInput:video error:&error];
[mainSession addInput:audio error:&error];

QTCaptureMovieFileOutput* output = [[QTCaptureMovieFileOutput alloc] init];
[output recordToOutputFileURL:[NSURL URLWithString:@"Users/chasemeadors/Desktop/capture1.mov"]];

[mainSession addOutput:output error:&error];

[movieView setCaptureSession:mainSession];

[mainSession startRunning];

} 
```

另外，我不确定方法不断调用的整个错误参数，我在示例中看到了“&error”符号，但我不知道它是什么意思。

当我明确打开设备时，我也收到错误“无法初始化未打开的设备”。

如果有人能帮我解决这个问题，那将是一个很大的帮助，谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T22:40:48.070

> QTCaptureDevice* deviceVideo = [QTCaptureDevice defaultInputDeviceWithMediaType:@"QTMediaTypeVideo"];
> 
> QTCaptureDevice* deviceAudio = [QTCaptureDevice defaultInputDeviceWithMediaType:@"QTMediaTypeSound"];

在此处传递实际常量，而不是包含其名称的字符串文字。不能保证`QTMediaTypeVideo`定义为`@"QTMediaTypeVideo"`; 它可能是`@"Ollie ollie oxen free"`，即使它是你*现在*所期望的，它也可能随时改变。

> ```
> [output recordToOutputFileURL:[NSURL URLWithString:@"Users/chasemeadors/Desktop/capture1.mov"]]; 
> ```

不要假设当前工作目录是 /。始终使用绝对路径。（我知道这是测试代码；当然，在实际代码中，您会运行 NSSavePanel 并从那里获取路径。）

> 另外，我不确定方法不断调用的整个错误参数，我`&error`在示例中看到了“”符号，但我不知道它是什么意思。

& 表示您正在获取变量的地址，在本例中为`error`. 您正在将此地址（也称为指针）传递给`error:`QTKit 方法之一的参数。如果遇到错误，该方法将创建一个 NSError 对象并将其存储在该地址 - 即，在您的变量中。这称为“按引用返回”（“引用”是您提供的指针）。

> 当我明确打开设备时，我也收到错误“无法初始化未打开的设备”。

哪个方法返回错误？您是在谈论 NSError 还是只是控制台消息？如果是后者，请检查您的 NSError 变量并查看问题方法留下了什么。

顺便说一句，这就是为什么如果任何 QTKit 方法返回错误时您应该退出的原因：如果您不这样做，后续消息之一可能会用新的错误来破坏它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T14:18:55.397

此外，您可能想查看[MyRecorder 示例代码](http://developer.apple.com/samplecode/MYRecorder/index.html#//apple_ref/doc/uid/DTS10004263)。它是一个基于 QTKit Capture API 的全功能录像机。代码相当简单，应该很容易理解。

# image-processing - 如何将位图减少为一组已知的 RGB 颜色

> ID：622573
> 
> 赞同：8
> 
> 时间：2009-03-07T21:51:12.777
> 
> 标签：image-processing, bitmap, rgb

对于一个爱好项目，我将构建一个程序，当给定图像位图时，它将创建一个十字绣图案作为 PDF。我将在 Mac 上使用 Cocoa/Objective C。

源位图通常是 24bpp 图像，但在数百万种可用颜色中，只有少数以十字绣线的形式存在。线程有多种类型。DMC 是最广泛可用的，几乎它们的整个范围都可以从各种网站以 RGB 值的形式获得。[例如，这是一个](http://www.rachaelmcgill.com/Hobbies_and_Interests/Floss/DMC_to_RGB/)。

```
DMC#  Name               R   G   B
----- ------------------ --- --- ---
blanc White              255 255 255
208   Lavender - vy dk   148  91 128
209   Lavender - dk      206 148 186
210   Lavender - md      236 207 225
211   Lavender - lt      243 218 228
      ...etc... 
```

正如我所看到的，我的第一个问题是从图像中像素的 RGB 起点选择 DMC 集中可用的最接近的颜色。在数学上找到最接近的 DMC 颜色并确保它也适合作为颜色的最佳方法是什么？

尽管我将使用 Cocoa，但请随意在您发布的任何代码中使用伪代码（甚至是 Java！）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-07T22:07:28.167

使用[LAB](http://en.wikipedia.org/wiki/Lab_color_space#Advantages_of_Lab)颜色空间，找到[距离](http://en.wikipedia.org/wiki/Euclidean_distance)最近的颜色。在 RGB 颜色空间中执行此操作会产生违反直觉的结果。（或使用[HSL](http://130.113.54.154/~monger/hsl-rgb.html)颜色空间。）

因此，只需遍历每个像素并在您选择的颜色空间内找到距离最近的颜色。请注意，对于某些颜色空间（例如使用*色相*的那些） ，必须**循环**计算距离。

 *（大多数颜色量化都围绕着实际选择调色板展开，但在您的情况下已经考虑到这一点，因此您不能使用更流行的量化技术。）

另外，看看[这个问题](https://stackoverflow.com/questions/492211/is-there-an-easy-way-to-compare-how-close-two-colors-are-to-each-other)。

要在 Cocoa 中查找 HSB 色调，您可以使用[NSColor.h 中声明的 getHue 方法](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/ApplicationKit/Classes/NSColor_Class/Reference/Reference.html#//apple_ref/occ/instm/NSColor/getHue:saturation:brightness:alpha:)。

**但是，如果您只是使用此技术将图像转换为十字绣设计，则实际缝合将非常困难。**它将充满单像素色域，这有点违背了十字绣的目的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T22:03:06.147

这称为[颜色量化](http://en.wikipedia.org/wiki/Color_quantization)，并且有许多可用的算法。

一个非常基本的方法是将 RGB 颜色视为空间中的点，并使用颜色之间的普通旧欧几里得距离来确定它们有多“接近”。这是有缺点的，因为人眼在这个空间的不同地方有不同的敏感度，所以这样的距离不能很好地对应人类对颜色的感知。您可以使用各种加权方案来改善这种情况。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T02:23:20.813

有趣... :)

您不仅要识别最接近的颜色，还希望减少使用的颜色数量。你不想最终得到一个使用数百种不同颜色的拼接图案......

我整理了一些在基本层面上执行此操作的代码。（对不起，它是在 C# 中的，我希望它无论如何都能有点用处。）

当然，在该方法运行良好之前，还需要进行一些进一步的调整。GetDistance 方法权衡色调、饱和度和亮度的重要性，找到它们之间的最佳平衡对于找到看起来最接近的颜色当然很重要。

减少调色板的方法也可以做很多事情。在示例中，我只选择了最常用的颜色，但您可能想要衡量调色板中颜色的相似程度。这可以通过选择最常用的颜色来完成，根据与所选择颜色的距离减少列表中剩余颜色的计数，然后重新选择列表。

持有 DMC 颜色的 Hsl 类，可以计算到另一种颜色的距离，并在颜色列表中找到最近的颜色：

```
public class Hsl {

    public string DmcNumber { get; private set; }
    public Color Color { get; private set; }
    public float Hue { get; private set; }
    public float Saturation { get; private set; }
    public float Brightness { get; private set; }
    public int Count { get; set; }

    public Hsl(Color c) {
        DmcNumber = "unknown";
        Color = c;
        Hue = c.GetHue();
        Saturation = c.GetSaturation();
        Brightness = c.GetBrightness();
        Count = 0;
    }

    public Hsl(string dmc, int r, int g, int b)
        : this(Color.FromArgb(r, g, b))
    {
        DmcNumber = dmc;
    }

    private static float AngleDifference(float a1, float a2) {
        float a = Math.Abs(a1 - a2);
        if (a > 180f) {
            a = 360f - a;
        }
        return a / 180f;
    }

    public float GetDistance(Hsl other) {
        return
            AngleDifference(Hue, other.Hue) * 3.0f +
            Math.Abs(Saturation - other.Saturation) +
            Math.Abs(Brightness - other.Brightness) * 4.0f;
    }

    public Hsl GetNearest(IEnumerable<Hsl> dmcColors) {
        Hsl nearest = null;
        float nearestDistance = float.MaxValue;
        foreach (Hsl dmc in dmcColors) {
            float distance = GetDistance(dmc);
            if (distance < nearestDistance) {
                nearestDistance = distance;
                nearest = dmc;
            }
        }
        return nearest;
    }

} 
```

此代码设置 DMC 颜色（大大减少）列表，加载图像，计算颜色，减少调色板并转换图像。您当然还希望将缩减调色板中的信息保存在某处。

```
Hsl[] dmcColors = {
    new Hsl("blanc", 255, 255, 255),
    new Hsl("310", 0, 0, 0),
    new Hsl("317", 167, 139, 136),
    new Hsl("318", 197, 198, 190),
    new Hsl("322", 81, 109, 135),
    new Hsl("336", 36, 73, 103),
    new Hsl("413", 109, 95, 95),
    new Hsl("414", 167, 139, 136),
    new Hsl("415", 221, 221, 218),
    new Hsl("451", 179, 151, 143),
    new Hsl("452", 210, 185, 175),
    new Hsl("453", 235, 207, 185),
    new Hsl("503", 195, 206, 183),
    new Hsl("504", 206, 221, 193),
    new Hsl("535", 85, 85, 89)
};

Bitmap image = (Bitmap)Image.FromFile(@"d:\temp\pattern.jpg");

// count colors used
List<Hsl> usage = new List<Hsl>();
for (int y = 0; y < image.Height; y++) {
    for (int x = 0; x < image.Width; x++) {
        Hsl color = new Hsl(image.GetPixel(x, y));
        Hsl nearest = color.GetNearest(dmcColors);
        int index = usage.FindIndex(h => h.Color.Equals(nearest.Color));
        if (index != -1) {
            usage[index].Count++;
        } else {
            nearest.Count = 1;
            usage.Add(nearest);
        }
    }
}

// reduce number of colors by picking the most used
Hsl[] reduced = usage.OrderBy(c => -c.Count).Take(5).ToArray();

// convert image
for (int y = 0; y < image.Height; y++) {
    for (int x = 0; x < image.Width; x++) {
        Hsl color = new Hsl(image.GetPixel(x, y));
        Hsl nearest = color.GetNearest(reduced);
        image.SetPixel(x, y, nearest.Color);
    }
}

image.Save(@"d:\temp\pattern.png", System.Drawing.Imaging.ImageFormat.Png); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T22:17:22.057

从实用程序集中获取`ppmquant`应用程序的源代码[`netpbm`](http://netpbm.sourceforge.net/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-07T22:37:16.067

其他人指出了颜色量化的各种技术。可以使用诸如马尔可夫随机场之类的技术来尝试惩罚系统在相邻像素位置切换线色。有一些通用的多标签 MRF 库，包括[Boykov 的](http://vision.csd.uwo.ca/code/).

要使用其中之一，数据元素将是输入颜色，标签将是一组线色，数据项可能类似于 bzlm 建议的 LAB 空间中的欧几里德距离，并且邻域项会因切换而受到惩罚线颜色。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-07T22:36:32.590

根据您的颜色操作正确性的相关性，请记住将[颜色空间](http://en.wikipedia.org/wiki/Color_space)s 考虑在内。虽然我对此有所研究，但由于我的摄影爱好，我仍然对一切感到有些困惑。

但是，如前所述，尽可能使用 LAB，因为（afaik）它与色彩空间无关，而所有其他方法（RGB/HSL/CMYK）在没有定义色彩空间的情况下（理论上）毫无意义。

例如，RGB 只是三个百分比值（0-255 => 0-100%，具有 8 位色深）。因此，如果您有一个 (0,255,0) 的 RGB 三元组，则它转换为“只有绿色，并且尽可能多”。所以，问题是“红色有多红？”。这是色彩空间回答的问题 - [sRGB](http://en.wikipedia.org/wiki/SRGB) 100%-green 不如 Adob​​eRGB [100](http://en.wikipedia.org/wiki/Adobe_RGB_color_space) %-green 绿。它甚至不是相同的[色调](http://en.wikipedia.org/wiki/Hue)！

*对不起，如果这事离题了*

# mysql - MySQL创建表中的CHARSET问题

> ID：622586
> 
> 赞同：1
> 
> 时间：2009-03-07T22:06:23.457
> 
> 标签：mysql, character-encoding

嗨，这是我的代码，它返回“您的 SQL 语法有错误；请查看与您的 MySQL 服务器版本相对应的手册，以获取正确的语法，以便在 'VALUE, chapter VARCHAR(100) CHARACTER SET utf8 COLLA' 行附近使用2"

> 如果不存在文本则创建表（
> id SERIAL DEFAULT VALUE，
> 章节 VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci，
> 文本 LONGTEXT CHARACTER SET utf8 COLLATE utf8_general_ci，
> uid INT NOT NULL AUTO_INCREMENT UNIQUE KEY，
> time TIMESTAMP，
> FULLTEXT（章节）
> ）Engine = InnoDB ;

我不知道出了什么问题，我是根据 MySQL 文档编写的。

我也尝试将此列更改为

> 章节 VARCHAR(100) 字符集 utf8, ...

但它返回了同样的错误。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T22:16:44.213

该行：

```
id SERIAL DEFAULT VALUE, 
```

是无效的。您需要为 DEFAULT VALUE 指定一个值或将其取出。

```
id SERIAL, 
```

但是，您的表中有 2 个 auto_increment 字段也是无效的。串行只是一个别名

```
BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT . 
```

# c++ - Win32编程隐藏控制台窗口

> ID：622592
> 
> 赞同：22
> 
> 时间：2009-03-07T22:10:14.150
> 
> 标签：c++, c, windows, winapi, console

我正在学习 C++，并制作了一个新程序。我删除了一些代码，现在我的控制台窗口没有隐藏。有没有办法让它在启动时隐藏起来而不让他们看到？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-07T22:51:30.150

如果您正在编写一个控制台程序，并且您想断开您的程序与它开始时使用的控制台的连接，请调用[`FreeConsole`](http://msdn.microsoft.com/en-us/library/ms683150.aspx). 最终，您可能不会对该功能的真正作用感到满意，但这就是您所问问题的字面答案。

如果您正在编写一个您一开始就不想拥有控制台的程序，那么请配置您的项目，使其不是控制台程序。“Consoleness”是 EXE 文件的一个属性。*操作系统读取该设置并决定是否在您的任何代码运行之前*为您的程序分配控制台，因此您无法在程序中控制它。有时非控制台程序称为“GUI 程序”，因此您可能会在开发环境的配置选项中寻找“控制台”和“GUI”之间的选择。不过，将其设置为 GUI 根本*不需要*您有任何用户界面。该设置仅控制您的程序是否从控制台开始。

如果您正在尝试编写一个有时有控制台有时没有控制台的程序，那么请参阅前面的问题，[一个可执行文件可以同时是控制台和 GUI 应用程序吗？](https://stackoverflow.com/questions/493536/can-one-executable-be-both-a-console-and-gui-app)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-07T22:17:39.623

假设您在 Windows 上，请将链接器配置为制作 gui 程序，而不是控制台程序。

*   VS：查看项目属性的链接器选项
*   链接：添加 /SUBSYSTEM:WINDOWS
*   MinGW：-mwindows

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2015-02-16T16:34:58.060

```
#include <windows.h>
#include <iostream>
using namespace std;
void Stealth()
{
 HWND Stealth;
 AllocConsole();
 Stealth = FindWindowA("ConsoleWindowClass", NULL);
 ShowWindow(Stealth,0);
}

int main()
{
  cout<<"this sentence is visible\n";
  Stealth(); //to hide console window
  cout<<"this sentence is not visible\n";
  system("PAUSE");
  return EXIT_SUCCESS;
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-09-07T20:16:52.273

我曾经`ShowWindow (GetConsoleWindow(), SW_HIDE);`在这种情况下使用，但是如果你不需要控制台，所以不要创建控制台应用程序项目。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-12-28T13:40:03.693

如前所述，是否使用控制台启动应用程序是在 exe 中设置的。例如，使用 gnu 编译器的选项是 -mwindows 表示没有控制台

```
g++ -mwindows winapp.c 
```

看来方法

```
#define _WIN32_WINNT 0x0500
#include <wincon.h> 
....
   case WM_CREATE : 
      ShowWindow (GetConsoleWindow(), SW_HIDE); 
```

关闭所有父控制台，所以如果你从命令行控制台启动 winapp.exe，它也会被关闭！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-11-04T20:03:22.987

要根据需要隐藏/显示控制台窗口，您可以使用以下功能： 可以使用[ShowWindow](https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms633548(v=vs.85).aspx)隐藏/显示控制台。[GetConsoleWindow](https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms683175(v=vs.85).aspx)检索控制台使用的窗口句柄。 [IsWindowVisible](https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms633530(v=vs.85).aspx)可用于检查窗口（在这种情况下为控制台）是否可见。

```
#include <Windows.h>

void HideConsole()
{
    ::ShowWindow(::GetConsoleWindow(), SW_HIDE);
}

void ShowConsole()
{
    ::ShowWindow(::GetConsoleWindow(), SW_SHOW);
}

bool IsConsoleVisible()
{
    return (::IsWindowVisible(::GetConsoleWindow()) != FALSE);
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-07T22:12:15.067

您可以创建最小化的窗口。或将其绘制在可见屏幕之外。

但是您也可能弄乱了窗口创建标志。如果你真的把事情搞砸了。启动一个新窗口通常会更好。（或从以前的版本或备份恢复）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-08-01T04:52:00.543

你可以试试这个

```
#include <windows.h>

int main() {
::ShowWindow(::GetConsoleWindow(), SW_HIDE);
MessageBox(NULL,"The console Window has been hidden.","Console Hidden",MB_ICONINFORMATION);
return 0;

} 
```

它是 win32 API 的一部分，您可以使用“#include”将其包含在内

[https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-showwindow](https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-showwindow)

第一个参数告诉程序获取当前正在运行程序的控制台窗口。第二个参数传递您想要对窗口执行的操作的指令。“SW_HIDE”隐藏窗口，而“SW_SHOW”显示窗口。

# graphics - 游戏动画的最佳方法？

> ID：622604
> 
> 赞同：9
> 
> 时间：2009-03-07T22:17:43.163
> 
> 标签：graphics, animation, 3d

我在 OpenGL 中有一个课程练习，用几个对象的简单动画编写游戏

在与我的合作伙伴讨论我们的设计选项时，我们意识到对于动画的工作方式，我们有两个主要选择，要么

*   设置一个恒定间隔的计时器，比如 30 毫秒，当计时器到达时，计算对象应该在哪里并绘制框架。或者 -
*   不要使用计时器，只是一个一直运行的正常循环，并且在每次迭代中检查经过了多少时间，根据间隔计算对象应该在哪里并绘制框架。

通常应该首选的方法是什么？有没有人对这两种方法有具体的经验？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-07T22:30:34.040

尽可能快地渲染和计算以获得最大帧速率（由垂直同步限制）

不要使用计时器，它们在 Windows 上不可靠 < 50-100 毫秒。检查已经过去了多少时间。（通常，您需要 delta t 和绝对值，具体取决于您的动画是基于物理还是基于关键帧。）

此外，如果您想保持稳定，请在时间步长上使用上限/下限，如果一帧需要几秒钟来渲染（另一个进程访问磁盘？）则进入慢动作，或者如果您跳过更新在 10 毫秒内获得其中两个。

**更新** *（因为这是一个相当流行的答案）*

我通常更喜欢有一个固定的时间步长，因为它使一切都更加稳定。大多数物理引擎对变化的时间都非常健壮，但其他事物，如粒子系统或各种更简单的动画甚至游戏逻辑，在让一切都以固定时间步长运行时更容易调整。

**Update2** *（因为我得到了 10 票；）*

为了在长时间运行（> 4 小时）内进一步保持稳定性，您可能需要确保不使用浮点数/双精度数来计算较大的时间差，因为这样做会失去精度，并且游戏的动画/物理效果会受到影响。请改用定点（或基于 64 位微秒）整数。

对于毛茸茸的细节，我建议阅读Tom Forsyth[的精确问题。](https://home.comcast.net/~tom_forsyth/blog.wiki.html#%5B%5BA%20matter%20of%20precision%5D%5D)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-09T10:27:44.197

阅读有关游戏循环的[页面。](http://dewitters.koonsolo.com/gameloop.html)

简而言之，设置一个计时器：

*   以**固定**频率更新游戏状态（例如每 25 ms = 1s/40fps）。这包括游戏对象的属性、输入、物理、人工智能等。我称之为**模型**和**控制器**。对固定更新率的需求来自可能出现在太慢或太快的硬件上的问题（阅读文章）。一些物理引擎也喜欢以固定频率更新。

*   **尽快**更新游戏的框架（图形）。那将是**View**。这样，您将提供流畅的游戏。您还可以启用垂直同步，以便显示器等待显卡（通常为 60 fps）。

因此，循环的每次迭代，您都会检查是否应该更新模型/控制器。如果晚了，请更新，直到它们是最新的。然后，更新一次框架并继续循环。

棘手的部分是，由于更新速率不同，在快速硬件中，视图会在模型和控制器之前更新几次。因此，您应该根据“如果游戏状态已更新，它们将在哪里”插入游戏对象的位置。这真的没那么难。

您可能需要维护 2 种不同的数据结构：一种用于模型，一种用于视图。例如，您可以为模型创建一个场景图，为您的视图创建一个 BSP 树。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T22:27:34.950

第二种方法是我的首选方法，因为计时器通常不像您想象的那么准确，并且具有事件处理系统的所有延迟和开销。考虑时间间隔将使您的动画具有更加一致的外观，并且在帧速率下降时保持稳健。

话虽如此，如果您的动画基于物理模拟（例如刚体或布娃娃动画），那么为您的物理设置一个固定的更新间隔可以大大简化实现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T22:32:33.283

选项 2 是首选。它将在不同性能的硬件上很好地扩展。

“Game Programming Gems 1”一书有一章准确地涵盖了您所需要的内容：

[与帧速率无关的线性插值](http://books.google.com/books?id=hiBFUv_FT0wC&pg=PA144&lpg=PA144&dq=game+programming+gems+ease+in+interpolation&source=bl&ots=OBeIKxA4Yk&sig=vHfaM7zWgtyRYoEBDp7t6ZfYc2k&hl=en&ei=jvWySafgLZK2sAOas8Ry&sa=X&oi=book_result&resnum=5&ct=result)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T22:31:12.273

使用第二种方法。为我的高级项目做了一个游戏，根据经验，不能保证当计时器要触发时你的逻辑会被处理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-07T22:36:06.647

我很想使用循环，因为它会尽可能快地渲染（即在你的物理计算完成后立即渲染）。如果您在计算中遇到任何减速，这可能会更加健壮，这将导致计时器触发开始排队。但是，在出现这种减速的情况下，您可能必须限制更新之间计算的时间步长，因为您的物理引擎可能会因时间跳跃过大而变得不稳定。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-07T22:37:28.343

我建议将系统设置为在从外部传入的“delta”上工作。

当我这样做时，在动画格式中，我将所有内容都基于实时值。我传入的增量是 1 / 30 秒，但它可以是任何东西。使用此系统，您可以获得第一个或第二个选项，具体取决于您是否传入固定增量，或者是否传入自上一帧以来经过的时间量。

至于哪个更好，这取决于你的游戏和你的要求。理想情况下，您的所有系统都将基于相同的增量，以便您的物理与动画相匹配。如果您的游戏完全丢帧并且您的所有系统都使用可变 delta，我建议可变 delta 是两种最终用户体验解决方案中更好的一种。

# ruby - 退出 Ruby Ri

> ID：622608
> 
> 赞同：1
> 
> 时间：2009-03-07T22:21:49.723
> 
> 标签：ruby

当您从 OS X 术语窗口运行 Ruby ri 命令以查看特定命令的文档时，您如何“退出”文档？在文档的末尾，会显示一个 (END)，但我不知道如何退出。我试过 CTRL-C、CTRL-D、Esc 等，但找不到正确的组合键。我在网上搜索过，显然这很明显，没有人会费心去记录。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-07T22:24:32.260

这是[less](http://www.gnu.org/software/less/)，除非您更改了环境变量 PAGER 的值。键入“q”或“ZZ”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T22:24:43.227

你试过'q'吗？

# java - 如何检查数组中的元素是否存在于Java中

> ID：622628
> 
> 赞同：5
> 
> 时间：2009-03-07T22:31:16.797
> 
> 标签：java, arrays, initialization

如果我有一个`int`结构如下的数组：

```
private int[][] map = new int[400][400]; 
```

我试着找回

```
map[100][200] 
```

并且该元素未初始化，我会收到编译器/运行时错误还是会返回 null？是否有任何功能可以检查给定元素/索引是否存在/已设置？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-07T22:37:15.957

由于您的数组声明是原始类型，您不会收到任何编译器或运行时错误 - 将返回默认值 0。

如果您的数组是一个对象数组，那么该数组将适用`null`于未专门分配的任何元素。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T22:36:01.827

我不会返回`null`，因为`int`是原始类型。它将返回默认`int`值，即`0`.

没有办法知道是否设置了任何元素，除非保留一个单独的布尔数组。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-07T22:37:33.337

在 Java 中，只有引用变量被初始化为 null。保证原语返回[适当的默认值](http://java.sun.com/docs/books/jls/second_edition/html/typesValues.doc.html#96595)。对于整数，此值为 0。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-07T22:35:37.723

不。

在这种情况下，您的数组元素仅足以容纳`int`s。没有地方可以存储有关元素是否“存在”的信息。它已被分配，因此它存在。在 Java 中，新分配`int`的数组将被初始化为所有元素为零。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-07T22:43:52.027

你可以在你的源代码上使用[checkstyle](http://checkstyle.sourceforge.net/)、[pmd](http://pmd.sourceforge.net/)和[findbugs](http://findbugs.sourceforge.net/)（二进制文件上的 findbugs ），它们会告诉你这样的事情。

不幸的是，他们似乎没有发现这个特殊问题（这很有意义，保证数组的每个成员都设置为 0、null 或 false）。

使用这些工具可以捕获在被赋予值之前正在使用的实例和类成员（不是数组）（类似的问题）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-22T15:00:54.673

有点死气沉沉的话题，但我偶然发现了它，所以我要把我的智慧（或其他任何东西：P）。您可以使用 Arrays.Fill 在使用无效值（如 -1）创建数组时填充数组。然后您可以轻松地执行 if x<0 来检查您是否已初始化该特定数组位置。只是一个想法...

# mysql - 为什么 MySQL 复制使用五个证书？

> ID：622646
> 
> 赞同：2
> 
> 时间：2009-03-07T22:37:48.687
> 
> 标签：mysql, security, ssl

我正在尝试使用 SSL 加密设置 MySQL 复制，当我开始接近解决方案时，我无法围绕 MySQL 使用 SSL 的方式来思考这个过程的一个方面。

根据 MySQL 5.0 上的文档（[为客户端/服务器](http://dev.mysql.com/doc/refman/5.0/en/secure-create-certs.html)[设置 SSL](http://dev.mysql.com/doc/refman/5.0/en/replication-solutions-ssl.html)和为复制设置 SSL ），SSL 连接最多可以涉及五条信息：CA 证书、主节点的签名公钥和私钥以及从节点的签名的公钥和私钥。我不明白的是需要这五个组件。我对 SSL 的理解（从[Wikipedia 条目](http://en.wikipedia.org/wiki/Transport_Layer_Security#How_it_works)中收集）是 SSL 通常只需要三部分：CA 证书（由服务器和客户端共享）、服务器的公钥（发送到客户端、针对 CA 证书进行验证，并用于加密/解密与服务器的通信）和服务器的私钥（由服务器保存并用于加密/解密与客户端的通信）。

那么为什么在 MySQL 复制 SSL 解决方案中，slave 也有一个公钥/私钥对，该密钥对与 master 的公钥/私钥对相同的 CA 证书签名？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-07T22:45:37.230

实际上，这只是*三个*证书。但是，每个 SSL 证书都包含*两个*密钥——公钥和私钥。

服务器和客户端都可以使用对方的公钥已经由 CA 的私钥签名的事实来向对方证明他们就是他们所说的那个人。

CA 本身也有一个公钥和一个私钥，但如果您从第三方获得 SSL 证书，您将永远无法看到他们的私钥。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T22:47:22.390

这是为了相互认证。slave需要向master证明自己的身份，master需要向slave证明自己的身份。

编辑：证书仅包含公钥。（私钥存储在机器的加密服务提供程序 (CSP) 中。）因此它有 5 个密钥和 3 个证书。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-07T22:40:55.793

复制链路的两端都必须认为另一端是可信的。

# python - 在 Django 中增加页面点击计数

> ID：622652
> 
> 赞同：16
> 
> 时间：2009-03-07T22:42:05.337
> 
> 标签：python, django, django-models

我有一个带有`IntegerField`( `hit_count`) 的表，当访问一个页面时（例如`http://site/page/3`），我希望`hit_count`数据库中记录 ID 3 的列增加 1。

查询应该是这样的：

```
update table set hit_count = hit_count + 1 where id = 3 
```

我可以使用标准的 Django 模型约定来做到这一点吗？还是我应该手动编写查询？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-03-08T16:46:13.920

如果您使用 Django 1.1+，只需使用[F 表达式](http://docs.djangoproject.com/en/dev/topics/db/queries/#filters-can-reference-fields-on-the-model)：

```
from django.db.models import F
...
MyModel.objects.filter(id=...).update(hit_count=F('hit_count')+1) 
```

这将执行单个原子数据库查询。

正如 gerdemb 所说，您应该考虑将其放在中间件中，以使其易于重用，以免混淆您的所有视图。

* * *

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-08T01:24:07.007

正如 gerdemb 所说，您应该将其写入中间件以使其真正可重用。或者（更简单）编写一个函数装饰器。事实上，有一些适配器可以将中间件用作装饰器，反之亦然。

但是，如果您担心性能并希望保持每页的 DB 查询数较低，则可以使用 memcached 的原子增量操作。当然，在这种情况下，您必须自己照顾持久性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T22:59:17.340

模型约定不是原子的；手写：

```
BEGIN
SELECT * FROM table WHERE id=3 FOR UPDATE
UPDATE table SET hit_count=hit_count+1 WHERE id=3
COMMIT 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T00:04:07.247

我将首先查看[middleware](http://docs.djangoproject.com/en/dev/topics/http/middleware/#topics-http-middleware)的文档。Ignacio 关于缺乏原子事务的评论是真实的，但这是整个 Django 框架的问题。除非您担心拥有 100% 准确的计数器，否则我不会担心。

# c++ - C++ 模板的优缺点是什么？

> ID：622659
> 
> 赞同：32
> 
> 时间：2009-03-07T22:46:33.797
> 
> 标签：c++, templates

我一直在与朋友交谈，有些人完全同意应该使用 C++ 中的模板，而另一些人则完全不同意。

一些好处是：

*   它们使用起来更安全（类型安全）。
*   它们是对 API 进行泛化的好方法。

你能告诉我关于 C++ 模板的其他什么好处吗？

你能告诉我关于 C++ 模板的哪些坏事？

编辑：我问这个的原因之一是我正在准备考试，目前我正在讨论 C++ 模板的主题。所以我试图更多地了解它们。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-03-07T23:27:39.097

模板是一种非常强大的机制，可以简化许多事情。然而，正确使用它们需要大量的时间和经验——以便决定何时使用它们是合适的。

对我来说最重要的优点是：

*   减少代码的重复（通用容器、算法）
*   减少高级代码的重复（MPL 和 Fusion）
*   静态多态性（=性能）和其他编译时间计算
*   基于策略的设计（灵活性、可重用性、更容易的更改等）
*   免费提高安全性（即通过 Boost 单元进行尺寸分析、静态断言、概念检查）
*   函数式编程（Phoenix）、惰性求值、表达式模板（我们可以在 C++ 中创建特定领域的嵌入式语言，我们有很棒的 Proto 库，我们有 Blitz++）
*   日常生活中使用的其他不太引人注目的工具和技巧：
    *   `for`STL 和算法（和之间有什么区别`for_each`）
    *   bind，lambda（或 Phoenix）（编写更清晰的代码，简化事情）
    *   Boost Function（使编写回调更容易）
    *   元组（如何一般地散列一个元组？例如使用 Fusion ......）
    *   TBB（`parallel_for`以及其他 STL，如算法和容器）
*   你能想象没有模板的 C++ 吗？是的，我可以，在早期，由于编译器的限制，您无法使用它们。
*   你会在没有模板的情况下用 C++ 编写吗？不，因为我会失去上面提到的许多优势。

缺点：

*   编译时间（例如加入 Sprit、Phoenix、MPL 和一些 Fusion，你可以去喝杯咖啡）
*   **会**使用和理解模板的人并不常见（而且这些人很有用）
*   **认为他们可以**使用和理解模板的人很常见（这些人很危险，因为他们可以把你的代码搞得一团糟。然而，他们中的大多数人经过一些教育/指导后会加入上一点提到的小组）
*   模板`export`支持（缺乏）
*   错误消息可能不那么神秘（经过一些学习，你可以找到你需要的东西，但仍然......）

我强烈推荐以下书籍：

*   [C++ 模板：David Vandevoorde 和 Nicolai Josuttis 的完整指南](https://rads.stackoverflow.com/amzn/click/com/0201734842)（对模板主题的全面介绍）
*   [现代 C++ 设计。Andrei Alexandrescu 应用的通用编程和设计模式](https://rads.stackoverflow.com/amzn/click/com/0201704315)（什么是鲜为人知的使用模板来简化代码、使开发更容易并导致代码对更改具有鲁棒性的方法）
*   [David Abrahms 和 Aleksey Gutov 的 C++ 模板元编程](https://rads.stackoverflow.com/amzn/click/com/0321227255)（再次 - 使用模板的不同方式）
*   来自 Wikibooks 的[更多 C++ Idioms提供了一些不错的想法。](http://en.wikibooks.org/wiki/More_C%2B%2B_Idioms)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-07T23:31:35.407

从积极的方面来说，C++ 模板：

*   允许泛化类型

*   减少您需要输入的冗余代码量

*   帮助构建类型安全的代码

*   在编译时评估

*   可以提高性能（作为多态性的替代品）

*   帮助构建非常强大的库

不利的一面：

*   如果一个人不小心，会很快变得复杂

*   大多数编译器都会给出神秘的错误信息

*   使用/调试高度模板化的代码可能很困难

*   至少有一个语法怪癖（>> 运算符可能会干扰模板）

*   帮助使 C++ 非常难以解析

总而言之，应该仔细考虑何时使用模板。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-09-13T11:23:23.540

[我的2c](http://thetweaker.wordpress.com/2012/09/01/meta-programming-is-still-evil/)相当消极。

> C++ 类型从未设计用于执行编译时计算。使用类型来实现计算目标的概念显然是一种 hack——而且，它从未被寻求而是偶然发现的

..

> 在你的代码中使用 MP 的奖励是解决一个难题的满足感。您在 100 行中完成了原本需要 200 行的工作。您通过难以理解的错误消息进行了研究，以达到一个点，即如果*您*需要将代码扩展到新案例，您将知道确切的 3 行模板函数超载。当然，您的维护者必须无限地投资才能实现同样的目标。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-08T08:09:52.960

优点：强大；允许您：

*   规定编译时属性和计算
*   描述通用算法和数据结构
*   做许多其他重复、无聊和容易出错的事情
*   用语言做它们，没有宏（这可能更加危险和晦涩！）

坏点：强大；允许您：

*   引发冗长、误导和模糊的编译时错误（尽管不像宏那样模糊和误导......）
*   创建晦涩和危险的错误设计（尽管不像宏那样容易......）
*   如果你不小心会导致代码膨胀（就像宏一样！）

模板极大地增加了可行的设计空间，这不一定是坏事，但它确实使它们更难使用。模板代码需要的维护者不仅要理解语言特性，还要理解语言特性的设计结果；实际上，这意味着许多开发人员团体避免使用 C++ 模板的最简单和最制度化的应用程序。

一般来说，模板使语言更加复杂（并且难以正确实现！）。模板并不是故意设计成图灵完备的，但无论如何它们都是——因此，即使它们几乎可以做任何事情，使用它们可能会带来更多的麻烦而不是它的价值。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-07T22:56:10.640

应谨慎使用模板。

“糟糕的调试”和“难以阅读”并不是反对具有良好抽象的良好模板使用的重要论据。

更好的否定论点将指向这样一个事实，即 STL 有很多“陷阱”，并且将模板用于 STL 已经涵盖的目的是在重新发明轮子。模板还会增加链接时间，这可能是某些项目所关心的问题，并且在其语法中有很多对人们来说可能是奥秘的特质。

但是通用代码重用、类型特征、反射、智能指针甚至元程序的积极作用往往超过消极作用。您必须确定的是，模板总是被*谨慎*而*谨慎地使用*。在每种情况下，它们都不是最好的解决方案，通常甚至不是第二或第三的最佳解决方案。

你需要有足够经验的人来编写它们，这样他们就可以避免所有的陷阱，并且对模板何时会使事情变得复杂而不是帮助有一个很好的雷达。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-08T07:32:45.937

我还没有提到的缺点之一是常规类和类模板实例之间的细微语义差异。我能想到：

1.  `typedef`祖先类型中的 ed 类型名不被模板类继承。
2.  需要在适当的地方撒上`typename`关键词`template`。
3.  成员函数模板不能是`virtual`.

这些事情通常可以克服，但它们很痛苦。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-02-04T17:26:27.210

有些人讨厌模板（我喜欢），因为：

*   在可维护性方面，错误使用模板所产生的负面影响可能比它们原本应该带来的时间优势强十倍。
*   在优化 pov 上，它们允许的编译器优化与最佳算法和多线程的使用相比微不足道。
*   在编译时 pov，模板的错误使用会对解析、编译和链接阶段产生非常负面的影响，因为编写不佳的模板声明会在每个编译单元中带来大量无用的寄生虫声明（这是 200 行代码如何生成 .obj 1Mb）。

对我来说，模板就像一个带有集成火焰喷射器的电锯，它也可以发射手榴弹。在我的一生中，有一次我可能对此有特殊需要。但大多数时候，我用普通的锤子和简单的锯子来建造东西，这样我就做得很好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-07T22:51:18.310

我不明白它们有多难阅读。什么是不可读的

```
vector <string> names; 
```

例如？你会用什么来代替它？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-08T01:25:03.963

优点：可以创建通用数据类型。

缺点：代码膨胀

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-03-16T20:30:54.513

可重用代码是用模板制作的。它的应用程序是按照每个配置文件。

# delphi - 线程没有收到消息

> ID：622660
> 
> 赞同：1
> 
> 时间：2009-03-07T22:46:49.430
> 
> 标签：delphi, getmessage

我的 Delphi 应用程序中有一个线程，它有一个消息等待循环。每次收到消息时，它都会开始做一些工作。这是该线程的执行过程：

```
procedure TMyThread.Execute;
begin
  while GetMessage(Msg, 0, 0, 0) and not Terminated do
  begin
    {thread message}
    if Msg.hwnd = 0 then
    begin
      ...
    end
    else
      DispatchMessage(Msg);
  end;
end; 
```

使用我的应用程序进行一些测试时，我发现 GetMessage 函数依赖于主线程。我的意思是，当主线程正在做一些工作时，我线程中的 GetMessage 函数不会返回，即使一条消息正在等待它接收（消息是由另一个线程使用 PostThreadMessage 函数发送的： PostMessage( MyThreadId, WM_MyMessage, 0, 0))。

只有当主线程完成其工作或调用 Application.ProcessMessages 方法时，GetMessage 才会返回并且我的线程开始工作。实现这种线程间通信我确信我的线程会独立工作，而且我永远不会期望直接发送到线程的消息的接收将依赖于主线程。

在进行测试时，我在主线程中使用了 WaitForSingleObject 函数，等待事件几秒钟。这是当我注意到我的线程没有做任何工作时，即使消息是由另一个线程发送给它的。当 WaitForSingleObject 函数终于完成等待并且主线程变得空闲时，我线程中的 GetMessage 函数返回了。

有人可以解释一下为什么它会这样工作吗？有解决方法吗？我想让我的线程独立接收消息。我所有的线程都是由主线程创建的。这可能是原因吗？

提前感谢您的帮助。

马吕斯。

* * *

Mghie，你又完全正确（你最近帮我处理了消息传递的问题，你可能还记得）。正如您所建议的， GetMessage 立即返回，但实际上，线程在调用主窗口方法时挂起：

```
procedure TMyThread.Execute;
begin
  while GetMessage(Msg, 0, 0, 0) and not Terminated do
  begin
    {thread message}
    if Msg.hwnd = 0 then
    begin
      ...
      if Assigned(FOnCommEventMethod) then
        FOnCommEventMethod(FCommEventsQueueItem);
      ...
    end
    else
      DispatchMessage(Msg);
  end;
end; 
```

FOnCommEventMethod 是一个对象的方法，声明为'procedure (EventMask: Cardinal) of object;' （此线程处理串行端口事件）。在这种情况下，FOnCommEventMethod 被分配了一个属于主窗体类的过程。当我的线程调用该方法时，线程挂起等待主线程完成其工作。

怎么会？如您所见，我不使用 Synchronize() 方法来调用此过程。因此，我不希望我的线程与主线程同步。它是否隐含地发生？顺便说一句，我知道除主线程之外的任何其他线程都不应访问任何 GUI 组件，因此应使用 Synchronize 方法，但我现在只做一些快速测试。

回到 WaitForSingleObject 主题，我知道我不应该使用它，但这只是一个测试（巧合地）我注意到了这个问题。

谢谢你的帮助。如果您不帮助我，我可能会摆脱消息传递并改用事件，最后我会注意到这不是原因:-)。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T10:33:09.323

> 只有当主线程完成其工作或调用 Application.ProcessMessages 方法时，GetMessage 才会返回并且我的线程开始工作。

我怀疑这是否真的发生了。AFAIK 这两个消息循环应该彼此独立，只要您不使用其他同步线程的方法，例如*SendMessage()*。您确定线程确实阻塞在*GetMessage()*内部而不是*Synchronize(* ) 内部（在内部使用*SendMessage()*）？

> 在进行测试时，我在主线程中使用了 WaitForSingleObject 函数，等待事件几秒钟。

你永远不应该在主线程中使用*WaitForSingleObject()*超时时间超过 100 毫秒，因为这会使你的 GUI 显得迟缓。事实上，我建议你不要在主线程中使用它，因为这只是轮询。而是从您的工作线程发布消息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T01:31:14.540

您可以为您的线程创建一个消息队列。只需在您的线程中执行以下代码：

```
MSG msg;
PeekMessage(&msg, NULL, WM_USER, WM_USER, PM_NOREMOVE);
SetEvent(messageQueueReady);
while (GetMessage(&msg, NULL, 0, 0)) 
{
    ...// do message processing here
} 
```

对 PeekMessage 的调用会强制操作系统为您的线程创建一个新的消息队列。您必须确保同步这一点，即您必须等待（例如通过WaitForSingleObject）调用成功，然后才能将消息发布到该线程（例如通过PostThreadMessage）。这就是上面示例中调用 SetEvent API 的原因。

**编辑：**对不起，示例在 C 中，希望这对你没问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T23:07:56.210

请参阅[http://groups.google.com/group/borland.public.delphi.language.delphi.win32/browse_thread/thread/cf368834a606321b](http://groups.google.com/group/borland.public.delphi.language.delphi.win32/browse_thread/thread/cf368834a606321b)

要求蒸馏，留下许多魔鬼隐藏的粗糙细节：主（或 VCL）线程在 Delphi 中是特殊的，因为引擎盖下的许多东西不是线程安全的，它拥有它们全部。消息循环之类的事情最终会因为与引擎盖下的 VCL 线程同步的事情而等待。很多人对此都有理论。似乎效果最好的事情是让您的 VCL 线程尽可能轻/响应，以尽量减少等待。每个人都非常同意这一点。有些人对其他可能有用的事情有想法，但其他人认为他们只是在自找麻烦。

# oop - 什么是不变性，我为什么要担心它？

> ID：622664
> 
> 赞同：59
> 
> 时间：2009-03-07T22:50:05.503
> 
> 标签：oop, immutability

我已经阅读了几篇关于不变性的文章，但仍然没有很好地遵循这个概念。

我最近在这里发了一个帖子，其中提到了不变性，但是由于这本身就是一个主题，所以我现在正在制作一个专门的帖子。

我在过去的帖子中提到，我认为不变性是使对象只读并赋予其低可见性的过程。另一位成员说这与那件事没有任何关系。[此页面](http://blogs.msdn.com/lucabol/archive/2007/12/03/creating-an-immutable-value-object-in-c-part-i-using-a-class.aspx)（[系列](http://blogs.msdn.com/lucabol/archive/2007/12/03/creating-an-immutable-value-object-in-c-part-i-using-a-class.aspx)的一部分）使用不可变类/结构的示例，并使用只读和其他概念将其锁定。

在这个例子中，状态的定义到底是什么？状态是一个我还没有真正掌握的概念。

从设计指南的角度来看，不可变类必须是不接受用户输入并且真的只返回值的类？

我的理解是，任何只返回信息的对象都应该是不可变的并且“锁定”，对吗？因此，如果我想使用该方法在专用类中返回当前时间，我应该使用引用类型，因为它可以作为类型的引用，因此我可以从不变性中受益。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-03-08T00:00:35.990

## 什么是不变性？

*   不变性主要应用于对象（字符串、数组、自定义 Animal 类）
*   通常，如果有一个类的不可变版本，那么一个可变版本也是可用的。例如，Objective-C 和 Cocoa 定义了一个 NSString 类（不可变）和一个 NSMutableString 类。
*   如果一个对象是不可变的，那么它在创建后就无法更改（基本上是只读的）。您可以将其视为“只有构造函数才能更改对象”。

这与用户输入没有直接关系；甚至您的代码也无法更改不可变对象的值。但是，您始终可以创建一个新的不可变对象来替换它。这是一个伪代码示例；请注意，在许多语言中，您可以简单地做`myString = "hello";`而不是像下面那样使用构造函数，但为了清楚起见，我将其包括在内：

```
String myString = new ImmutableString("hello");
myString.appendString(" world"); // Can't do this
myString.setValue("hello world"); // Can't do this
myString = new ImmutableString("hello world"); // OK 
```

您提到“仅返回信息的对象”；这不会自动使其成为不变性的良好候选者。不可变对象往往返回与构造它们的值相同的值，所以我倾向于说当前时间并不理想，因为它经常变化。但是，您可以拥有一个使用特定时间戳创建的 MomentOfTime 类，并在未来始终返回该时间戳。

## 不变性的好处

*   如果将对象传递给另一个函数/方法，则不必担心该对象在函数返回后是否具有相同的值。例如：

    ```
    String myString = "HeLLo WoRLd";
    String lowercasedString = lowercase(myString);
    print myString + " was converted to " + lowercasedString; 
    ```

    如果在`lowercase()`创建小写版本时更改了 myString 的实现怎么办？第三行不会给你想要的结果。当然，一个好的`lowercase()`函数不会这样做，但是如果 myString 是不可变的，你就可以保证这个事实。因此，不可变对象可以帮助实施良好的面向对象编程实践。

*   使不可变对象成为线程安全的更容易

*   它可能会简化类的实现（如果您是编写类的人，那就太好了）

## 状态

如果您要获取一个对象的所有实例变量并在纸上写下它们的值，那将是该对象在给定时刻的状态。程序的状态是它所有对象在给定时刻的状态。状态随时间迅速变化；程序需要更改状态才能继续运行。

然而，不可变对象随着时间的推移具有固定的状态。一旦创建，不可变对象的状态就不会改变，尽管整个程序的状态可能会改变。这样可以更轻松地跟踪正在发生的事情（并查看上面的其他好处）。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-08T00:11:49.490

# 不变性

简而言之，内存在初始化后不被修改时是不可变的。

用 C、Java 和 C# 等命令式语言编写的程序可以随意操作内存中的数据。物理内存区域一旦被留出，就可以在程序执行期间的任何时间由执行线程全部或部分修改。事实上，命令式语言鼓励这种编程方式。

以这种方式编写程序对于单线程应用程序来说非常成功。然而，随着现代应用程序开发向单个进程内的多个并发操作线程发展，引入了一个潜在问题和复杂性的世界。

当只有一个执行线程时，您可以想象这个单个线程“拥有”内存中的所有数据，因此可以随意操作它。但是，当涉及多个执行线程时，没有隐含的所有权概念。

相反，这个负担落在了程序员身上，他们必须竭尽全力确保内存中的结构对于所有读者来说都处于一致的状态。必须谨慎使用锁定结构，以防止一个线程在另一个线程更新数据时查看数据。如果没有这种协调，线程将不可避免地消耗刚刚更新到一半的数据。这种情况的结果是不可预测的，而且往往是灾难性的。此外，在代码中使锁定正确工作是出了名的困难，如果做得不好会削弱性能，或者在最坏的情况下，会出现死锁，无法恢复地停止执行。

使用不可变数据结构减轻了在代码中引入复杂锁定的需要。如果保证一段内存在程序的生命周期内不会发生变化，那么多个读取器可以同时访问该内存。他们不可能观察到处于不一致状态的特定数据。

许多函数式编程语言，例如 Lisp、Haskell、Erlang、F# 和 Clojure，就其本质而言鼓励不可变数据结构。正是由于这个原因，当我们转向日益复杂的多线程应用程序开发和多计算机计算机体系结构时，他们重新获得了兴趣。

# 状态

应用程序的状态可以简单地认为是给定时间点所有内存和 CPU 寄存器的内容。

从逻辑上讲，程序的状态可以分为两种：

1.  堆的状态
2.  每个执行线程的栈状态

在 C# 和 Java 等托管环境中，一个线程无法访问另一个线程的内存。因此，每个线程都“拥有”其堆栈的状态。堆栈可以被认为是保存局部变量和值类型（`struct`）的参数，以及对对象的引用。这些值与外部线程隔离。

但是，堆上的数据可以在所有线程之间共享，因此必须注意控制并发访问。所有引用类型 ( `class`) 对象实例都存储在堆上。

在 OOP 中，类实例的状态由其字段决定。这些字段存储在堆上，因此可以从所有线程访问。如果一个类定义了允许在构造函数完成后修改字段的方法，则该类是可变的（不是不可变的）。如果字段不能以任何方式更改，则类型是不可变的。需要注意的是，具有所有 C# `readonly`/Java`final`字段的类不一定是不可变的。这些构造确保*引用*不能更改，但引用的对象不能更改。例如，一个字段可能对对象列表具有不可更改的引用，但列表的实际内容可能随时修改。

通过将类型定义为真正不可变的，它的状态可以被认为是冻结的，因此该类型对于多个线程的访问是安全的。

在实践中，将所有类型定义为不可变可能很不方便。修改不可变类型的值可能涉及相当多的内存复制。某些语言比其他语言使这个过程更容易，但无论哪种方式，CPU 最终都会做一些额外的工作。许多因素有助于确定复制内存所花费的时间是否超过锁定争用的影响。

很多研究都涉及到不可变数据结构的开发，例如列表和树。当使用这样的结构时，比如说一个列表，“添加”操作将返回一个对添加了新项目的新列表的引用。对上一个列表的引用没有看到任何变化，并且仍然具有一致的数据视图。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-07T23:02:56.737

简单来说：一旦创建了不可变对象，就无法更改该对象的内容。.Net 不可变对象的示例是 String 和 Uri。

当你修改一个字符串时，你只是得到一个新的字符串。原始字符串不会改变。Uri 只有只读属性，没有可用于更改 Uri 内容的方法。

不可变对象很重要的情况多种多样，并且在大多数情况下都与安全性有关。Uri 就是一个很好的例子。（例如，您不希望 Uri 被一些不受信任的代码更改。）这意味着您可以传递对不可变对象的引用，而不必担心内容会改变。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-07T23:11:28.557

不变的东西永远不会改变。可变的东西可以改变。可变的东西会发生变异。不可变的事物看似改变，但实际上创造了一个新的可变事物。

例如，这是 Clojure 中的地图

```
(def imap {1 "1" 2 "2"})
(conj imap [3 "3"])
(println imap) 
```

第一行创建了一个新的不可变 Clojure 映射。第二行将 3 和“3”连接到地图。这看起来好像是在修改旧地图，但实际上它返回的是添加了 3 个“3”的*新地图。*这是不变性的一个典型例子。如果这是一个可变映射，它会简单地将 3“3”直接添加**到**同一个旧映射。第三行打印地图

```
{3 "3", 1 "1", 2 "2"} 
```

不变性有助于保持代码的清洁和安全。这个和其他原因是函数式编程语言倾向于不可变性和较少状态的原因。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-07T23:22:59.717

好问题。

多线程。如果所有类型都是不可变的，则不存在竞争条件，并且您可以安全地在代码中抛出任意数量的线程。

显然，如果没有可变性保存复杂的计算，您将无法完成那么多，因此您通常需要一些可变性来创建功能性业务软件。然而，值得认识到不变性应该存在于何处，例如任何事务性。

查找函数式编程和纯度概念以获取有关该哲学的更多信息。您在调用堆栈（传递给方法的参数）上存储的越多，而不是通过引用（如集合或静态可用对象）使它们可用，您的程序就越纯净，您就越不容易出现竞争条件。如今，随着多核的增多，这个话题变得更加重要。

不变性还减少了程序中的可能性，从而降低了潜在的复杂性和潜在的错误。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-07T23:03:32.850

不可变对象是您可以放心假设不会改变的东西。它具有重要的属性，每个使用它的人都可以假设他们看到的是相同的值。

不变性通常还意味着您可以将对象视为“值”，并且对象的相同副本与对象本身之间没有有效的区别。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-07T23:49:19.200

让我再补充一件事。除了上面提到的所有内容之外，您还希望以下内容具有不变性：

*   值对象（有时也称为数据对象或 pojo）
*   结构（在 C#/.NET 中） - 请参阅[有关装箱的 stackoverflow 问题](https://stackoverflow.com/questions/620692/620725#620725)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-07T23:12:55.123

使事物不可变可以防止大量常见错误。

例如，学生永远不应该让他们的学生#改变他们。如果您不提供设置变量的方法（并将其设为 const 或 final 或您的语言支持的任何内容），那么您可以在编译时强制执行。

如果事情是可变的并且您不希望它们在您传递它们时改变，您需要制作一个您传递的防御性副本。然后，如果您调用的方法/功能更改了项目的副本，则原始项目不会受到影响。

使事物不可变意味着您不必记住（或花时间/记忆）来制作防御性副本。

如果你真的努力工作，并考虑你所做的每个变量，你会发现绝大多数变量（我通常有 90-95%）一旦被赋予一个值就永远不会改变。这样做可以使程序更易于遵循并减少错误的数量。

要回答关于状态的问题，状态是“对象”（是类或结构）的变量所具有的值。如果您将一个人的“对象”状态设为眼睛颜色，头发颜色，头发长度等……其中一些（例如眼睛颜色）不会改变，而其他一些（例如头发长度）会改变。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-08T03:19:40.817

“……我何必担心呢？”

一个实际的例子是字符串的重复连接。例如在 .NET 中：

```
string SlowStringAppend(string [] files)
{
    // Declare an string
    string result="";

    for (int i=0;i<files.length;i++)
    {
        // result is a completely new string equal to itself plus the content of the new
        // file
        result = result + File.ReadAllText(files[i]);
    }

    return result;
}    

string EfficientStringAppend(string [] files)
{
    // Stringbuilder manages a internal data buffer that will only be expanded when absolutely necessary
    StringBuilder result=new SringBuilder();

    for (int i=0;i<files.length;i++)
    {
        // The pre-allocated buffer (result) is appended to with the new string 
        // and only expands when necessary.  It doubles in size each expansion
        // so need for allocations become less common as it grows in size. 
        result.Append(File.ReadAllText(files[i]));
    }

    return result.ToString();
} 
```

不幸的是，仍然普遍使用第一个（慢）函数方法。对不变性的理解可以非常清楚地说明为什么使用 StringBuilder 如此重要。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-08T04:48:34.987

你不能改变一个不可变的对象，因此你必须替换它......“改变它”。即更换然后丢弃。从这个意义上说，“替换”意味着将指针从一个内存位置（旧值）更改为另一个（新值）。

请注意，这样做我们现在使用额外的内存。一些用于旧值，一些用于新值。另请注意，有些人会因为看代码而感到困惑，例如：

```
string mystring = "inital value";
mystring = "new value";
System.Console.WriteLine(mystring); // Outputs "new value"; 
```

然后自己想，“但我正在改变它，看看那里，黑白的！mystring输出'新值'......我以为你说我不能改变它？！！”

但实际上在幕后，发生的是这种新内存的分配，即 mystring 现在指向不同的内存地址和空间。从这个意义上说，“不可变”不是指 mystring 的值，而是指变量 mystring 用来存储其值的内存。

在某些语言中，存储旧值的内存必须手动清理，即程序员必须明确释放它......并记住这样做。在其他语言中，这是该语言的自动功能，即 .Net 中的垃圾收集。

真正让 re:memory 使用量大增的地方之一是在高度迭代的循环中，特别是在 Ashs 的帖子中使用字符串。假设您在一个迭代循环中构建一个 HTML 页面，您不断地将下一个 HTML 块附加到最后一个块，并且只是为了好玩，您是在大容量服务器上执行此操作的。如果“旧值内存”没有正确清理，这种不断分配的“新值内存”很快就会变得昂贵，最终是致命的。

另一个问题是，有些人认为垃圾收集 (GC) 之类的事情会立即发生。但事实并非如此。发生了各种优化，以便将垃圾收集设置为在更多空闲期间发生。因此，在内存被标记为已丢弃和垃圾收集器实际释放内存之间可能会有很大的延迟......因此，如果您只是将问题推迟到 GC，您可能会遭受较大的内存使用高峰。

如果 GC 在内存不足之前没有机会运行，那么事情不一定会像其他没有自动垃圾收集的语言那样崩溃。相反，GC 将作为最高优先级的进程启动以释放丢弃的内存，无论时机多么糟糕，并在清理时成为阻塞进程。显然，这并不酷。

因此，基本上，您需要在编写代码时牢记这些事情，并查看您使用的语言的文档，以获得可以避免/减轻这种风险的最佳实践/模式。

正如在 Ashs 的帖子中，在 .Net 和字符串中，在需要不断更改字符串值时，推荐的做法是使用可变 StringBuilder 类，而不是不可变字符串类。

其他语言/类型也会有自己的解决方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-12-24T04:04:25.333

为什么是不变性？

1.  它们更不容易出错并且更安全。

2.  不可变类比可变类更容易设计、实现和使用。

3.  不可变对象是线程安全的，因此不存在同步问题。

4.  不可变对象是很好的 Map 键和 Set 元素，因为它们通常在创建后不会更改。

5.  不变性使编写、使用和推理代码变得更容易（类不变式建立一次，然后不变）。

6.  不变性使程序更容易并行化，因为对象之间没有冲突。

7.  即使您有异常，程序的内部状态也会保持一致。

8.  对不可变对象的引用可以被缓存，因为它们不会改变。（即在散列中它提供快速操作）。

有关更详细的答案，请参阅我的博客：http:
[//javaexplorer03.blogspot.in/2015/07/minimize-mutability.html](http://javaexplorer03.blogspot.in/2015/07/minimize-mutability.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-07T23:06:34.607

看，我还没有阅读您发布的链接。

但是，这是我的理解。
每个程序都拥有一些关于它的数据（状态）的知识，这些知识可以通过用户输入/外部更改等进行更改。

变量（变化的值）被保留以保持状态。不可变意味着一些不会改变的数据。你可以说，它在某种程度上与 readonly 或 constant 相同（可以这样看）。

AFAIK，函数式编程具有不可变的东西（即，您不能对保存该值的变量使用赋值。您可以做的是创建另一个可以保存原始值+更改的变量）。

.net 有字符串类，这是一个例子。
即你不能在它的位置修改字符串

字符串 s = "你好"; 我可以写 s.Replace("el", "a"); 但这不会修改变量 s 的内容。

我能做的是 s = s.Replace("el","a");
这将创建一个新变量并将其值分配给 s（覆盖 s 的内容）。

在我的理解中，如果我有错误，专家可以纠正错误。

编辑：不可变 = 不可分配，一旦它持有一些价值并且不能被替换（也许？）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-08T14:06:06.363

WPF API 中提供了不可变对象提供的潜在性能优势的示例。许多 WPF 类型的通用基类是`Freezable`.

几个 WPF 示例表明冻结对象（使它们在运行时不可变）可以显着提高应用程序性能，因为不需要锁定和复制。

就我个人而言，我希望不变性的概念更容易用我最常用的语言 C# 来表达。有一个`readonly`可用于字段的修饰符。我还希望看到`readonly`类型上的修饰符，该修饰符仅允许用于仅具有只读字段的只读类型的类型。本质上，这意味着所有状态都需要在构建时注入，并且整个对象图都将被冻结。我想这是 CLR 固有的元数据，那么它可以很容易地用于优化 GC 的垃圾分析。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-09T08:33:25.563

对不起，为什么不变性会阻止竞争条件（在这个例子中，读后写危险）？

```
shared v = Integer(3)
v = Integer(v.value() + 1) # in parallel 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-01-01T21:38:57.193

不变性与价值观有关，而价值观与事实有关。如果某物是不可改变的，那么它就有价值，因为如果某物是可以改变的，那么就意味着没有特定的价值可以与它联系起来。对象以状态 A 初始化，并在程序执行期间突变为状态 B 和状态 C。这意味着对象不代表单个特定值，而只是一个容器，对内存中某个位置的抽象，仅此而已。你不能信任这样的容器，你不能相信这个容器有你认为应该有的价值。

让我们举个例子 - 让我们想象在代码中创建了 Book 类的实例。

```
Book bookPotter =  new Book();
bookPotter.setAuthor('J.K Rowling');
bookPotter.setTitle('Harry Potter'); 
```

这个实例有一些字段设置，如作者和标题。一切正常，但在代码的某些部分再次使用了设置器。

```
Book bookLor =  bookPotter; // only reference pass
bookLor.setAuthor('J.R.R Tolkien');
bookLor.setTitle('Lords of The Rings'); 
```

不要被不同的变量名所欺骗，真的是同一个实例。该代码再次在同一实例上使用设置器。这意味着 bookPotter 从来都不是真正的哈利波特书，bookPotter 只是指向未知书所在位置的指针。也就是说，它看起来更像是一个书架而不是书。你对这样的对象有什么信任？它是哈利波特的书还是 LoR 的书，或者两者都不是？

**类的可变实例只是一个指向具有类特征的未知状态的指针。**

那么如何避免突变呢？规则很简单：

*   通过构造函数或生成器构造具有所需状态的对象
*   不要为对象的封装状态创建设置器
*   不要在其任何方法中更改对象的任何封装状态

这几个规则将允许拥有更可预测和更可靠的对象。回到我们的示例并遵循上述规则：

```
Book bookPotter =  new Book('J.K Rowling', 'Harry Potter');
Book bookLor = new Book('J.R.R Tolkien', 'Lord of The Rings'); 
```

一切都是在构造阶段设置的，在这种情况下是构造函数，但对于更大的结构，它可以是构造函数。对象中不存在 setter，book 不能变异为不同的 setter。在这种情况下 bookPotter 代表了哈利波特书的价值，您可以确定这是不可改变的事实。

如果您对更广泛的不变性感兴趣，在这篇中等文章中更多的是关于与 JavaScript 相关的主题 - [https://medium.com/@macsikora/the-state-of-immutability-169d2cd11310](https://medium.com/@macsikora/the-state-of-immutability-169d2cd11310)。

# c++ - 如何将窗口默认滚动条移到状态栏上方？

> ID：622672
> 
> 赞同：1
> 
> 时间：2009-03-07T22:54:55.197
> 
> 标签：c++, c, windows, winapi

每个程序的状态栏上方都有滚动条。正确的？好吧，不是我的。

当我试图在我的程序中设置我自己的滚动条时，我惊讶地让它们工作了！我也设法让状态栏工作了！欢呼！:-) ...但是状态栏在滚动条上方，而它应该在滚动条下方。如何移动滚动条？我找不到有关移动滚动条的任何功能。除非我自己创建了一个滚动条窗口，但这并没有很好地工作（*它有一些奇怪的错误：当我使用默认高度时，它变成完全不可见的滚动条，当我使用我定义的高度时，滚动条有 Windows98 主题或其他东西 o_O*！）

这是我的状态栏创建代码：

```
// Create status bar
hStatus = CreateWindowEx(
    0, 
    STATUSCLASSNAME, 
    NULL, 
    WS_CHILD | WS_VISIBLE | SBARS_SIZEGRIP, 
    0, 0, 0, 0, 
    hWnd, 
    (HMENU)IDC_MAIN_STATUS, 
    GetModuleHandle(NULL), 
    NULL
); 
```

和窗口创建：

```
if (!(hWnd=CreateWindowEx(dwExStyle,            // Extended Style For The Window
    "OpenGL",                   // Class Name
    title,                      // Window Title
    dwStyle |                   // Defined Window Style
    WS_OVERLAPPEDWINDOW | WS_CLIPSIBLINGS | 
    WS_CLIPCHILDREN | WM_HSCROLL | WM_VSCROLL,  // Required Window Style
    0, 0,                       // Window Position
    WindowRect.right-WindowRect.left,       // Calculate Window Width
    WindowRect.bottom-WindowRect.top,       // Calculate Window Height
    NULL,                       // No Parent Window
    NULL,                       // No Menu
    hInstance,                  // Instance
    NULL)))                     // Dont Pass Anything To WM_CREATE 
```

一定有一些我还没有意识到的巧妙技巧，有人告诉我如何正确地做到这一点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T23:04:07.360

运行记事本并使用 spy++ 检查它，您将看到带有滚动条的区域和状态栏是两个具有共同父级的对等窗口。您也需要这样做，然后每当您的父窗口改变大小或位置时，使用 SetWindowPos() 将您的两个窗口相对于彼此定位。

# performance - 高性能网站的开源解决方案堆栈？

> ID：622678
> 
> 赞同：3
> 
> 时间：2009-03-07T23:02:06.130
> 
> 标签：performance

如果您的任务是为网站推荐**一个开源解决方案堆栈**，其中**可扩展的高性能优先**于其他一切，您会推荐什么？

一些定义尝试：

*   可扩展性：部署后，解决方案堆栈应该能够通过简单地添加更多硬件从少数用户扩展到数百万用户。解决方案堆栈永远不应该成为瓶颈。

*   性能：想象一个可以处理数百万用户、数百 TB 数据（HTML、图像、视频等）、每天大量流量、每年至少 99.99% 的正常运行时间的网站。

解决方案堆栈应至少指定：

*   操作系统
*   网络服务器
*   数据库或等价物
*   编程语言

如果需要，您还可以建议其他程序、库、工具等（例如，特定于语言的库、负载平衡器、缓存）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T23:33:53.870

设计高性能和可扩展站点时有许多关键领域：

1.  缓存
2.  磁盘 IO 和位置
3.  数据库锁定
4.  我提到缓存了吗？

任何人都不可能在 Stackoverflow 上为您提供完整的解决方案。您需要坐下来确定要向用户提供的内容类型、内容更改的频率以及存储位置。

对于内容缓存，您应该查看：Squid、Apache 的 mod_cache 和 memcached

应考虑物理磁盘。如果您通过拥有多个 Web 服务器来扩展您的解决方案，那么您将共享您的内容（视频、图像等）的一个副本，还是每个服务器都有一个副本？如果您共享一个副本，请注意该单个磁盘上的 IO。如果每个服务器都有一份内容副本，那么您需要保持副本同步。

数据库使用量应保持在最低限度。永远不要将图形或其他可以保存在磁盘上的平面文件中的内容存储在数据库中 - Web 服务器在从磁盘提供文件方面做得很好，但数据库在这方面并不是那么好。想想你*需要*在数据库中放入什么，以及这些数据多久会更改和被读取一次。什么时候需要锁定该数据库？十分之九的数据库是系统的瓶颈。

缓存。缓存。缓存。考虑提供尽可能多的静态内容。构建您的网页 HTML 一次，然后将其存储为缓存文件 - 在磁盘或 memcached 或类似文件中。

直接回答您的一些技术问题：

Web 服务器是一个给定的：Apache Httpd。不是最快的，但防弹和高度可配置。

操作系统：您的操作系统永远不会成为您的瓶颈，因此请选择稳定且支持良好的操作系统 - CentOS 运行良好。

DB：您的明显选择是 mySQL 和 Postgres。Postgres 在两者中具有更好的性能，但正如我之前所说，您必须将数据库活动保持在最低限度。

语言：没关系。严重地。您可以使用任何 Python、Ruby、PHP、Java、.NET 等创建可扩展、性能良好的站点。您的语言不会成为您的瓶颈。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T23:14:16.057

我可能不会尝试重新发明轮子并制作自己的解决方案，我会看看其他成功的网站是如何做到的。一个很好的起点是[高可扩展性。](http://highscalability.com/links/weblink/24)他们记录了一些最成功的网站是如何形成的，以及它们如何管理其庞大的基础设施。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T23:23:51.570

我为您推荐一个**网络服务器**：

nginx [引擎 x]

在其[网站](http://nginx.net/)以及网络的[其他角落](http://www.linuxjournal.com/article/10108)，您可以收集有关它的更多信息，包括使用它的热门网站。Hulu.com 就是一个很好的例子，它处理大量的视频流。据说在原始性能方面它比 Apache 的典型竞争对手 lighttp 工作得更好。

它的另一个有趣的方面是它已经包括负载平衡。

# database - BI 与 Django？

> ID：622680
> 
> 赞同：3
> 
> 时间：2009-03-07T23:03:21.307
> 
> 标签：database, django, django-models, datasource, business-intelligence

有没有办法用 Django 开发 Bi（商业智能）解决方案？因此，应该可以定义具有多个数据源的模型。有人用 Django 体验过 BI 吗？它怎么可能起作用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-08T00:03:06.967

我不确定您对 BI 的定义是什么，或者您为什么认为 BI 解决方案需要多个数据源。

以我的经验，BI 意味着数据的统计分析。使用维度技术的报告模式可以作为它的基础。数据通常从各种事务源进行 ETL 处理到单个维度模式中，然后成为所有分析的源。

如果我说的是正确的，那么您不需要多个数据源。

也许另一种思考这个问题的方式是：Django 中内置的 ORM 技术是否适合使用对象对维度星型模式进行建模？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-03T05:08:52.600

这是可行的，我已经为我的工作做到了。还不能开源，目前已经可以发布异构复制应用了，但我还没有放弃。

我对项目数据使用 Django ORM，复制并粘贴了 Django 的“load_backend() 函数”，以便能够连接到多个数据库。在原始 SQL 中查询用作图形和表的源（ORACLE 中的公司数据库）的数据库（无论如何，Django ORM 都会妨碍，许多复杂的连接和聚合）。

图表使用“jqPlot”完成，表格使用“jqGrid”完成。用户帐户和身份验证使用带有简单补丁的“ldap-groups”完成并绑定到 Active Directory 树。

复制应用程序在这里是[Django-Replication](http://code.google.com/p/django-replication/)，它可以为您提供一个示例，如何从 Django 连接到多个数据库。它还具有时间限制（通过超时过期）查询和通过 python 的多处理和线程库的并发查询。

--尝试发布应用程序的图片，但不允许新用户--

# algorithm - 分离轴测试，检测一个旋转的矩形是否与另一个平面矩形重叠

> ID：622687
> 
> 赞同：2
> 
> 时间：2009-03-07T23:04:56.093
> 
> 标签：algorithm, math, graphics, geometry

我在以下位置阅读了有关相交矩形的信息：

[检测两个矩形相交的算法？](https://stackoverflow.com/questions/115426/algorithm-to-detect-intersection-of-two-rectangles)

但我很难实现它。

如果 R1 (A,B,C,D) 是我的旋转矩形，而 R2(A',B',C',D') 是另一个没有旋转的矩形。

从上面的链接中提取的公式是：

```
 edge = v(n) - v(n-1) 
```

您可以通过将其旋转 90° 来获得垂直。在 2D 中，这很简单：

```
 rotated.x = -unrotated.y
  rotated.y =  unrotated.x

  // rotated: your rotated edge
  // v(n-1) any point from the edge.
  // testpoint: the point you want to find out which side it's on.

  side = sign (rotated.x * (testpoint.x - v(n-1).x) + 
               rotated.y * (testpoint.y - v(n-1).y); 
```

我的旋转边缘将来自 R1

AB (xB-xA, yB-yA) 如此旋转的 x 是 xB-xA 吗？BC (xC-xB, yC-y1) CD ... AD ...

测试点将是来自 R2 的 A'、B'、C'、D' 所以我必须检查 R2 的所有点与来自 R1 的 4 个边的结果的符号。如果相交，那就是 16 个比较。我怎么知道我是否找到了一个分离边缘？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-11T08:00:42.490

如果对于任何给定的边缘，针对该边缘测试的任何点积的符号都不匹配，那么您就有一个交集。点积的符号对于直线一侧的所有点都是相同的。

# c# - 我应该使用什么方法或事件来预填充扩展的 ListView？

> ID：622694
> 
> 赞同：0
> 
> 时间：2009-03-07T23:09:32.917
> 
> 标签：c#, .net, winforms, listview

我在 C# WinForms 中编写了一个扩展的 ListView。它的目的是显示当前使用 WinAPI 运行的应用程序的列表。但是，如果我尝试在构造函数中填充 ListView，它会在我运行应用程序时工作，但如果您尝试将控件放在任何表单上，它将导致 VS 2008 崩溃。

崩溃的原因我相信是由使用 ThreadPool 或使用 P/Invoke 调用引起的。我试图将它包装在一个条件中以检查 DesignMode 属性，但我发现它总是在构造函数中返回 false。为了解决我的问题，我覆盖了 ListView 基类的 InitLayout 方法并将我的填充代码放在那里，但我认为这不是放置它的最佳位置。

有谁知道将我的预填充代码放在扩展 ListView 中的最佳位置？

谢谢！

这是修复的样子：

```
protected override void InitLayout()
{
    if (DesignMode)
        return;

    RefreshApplications();

    base.InitLayout();
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-07T23:19:22.173

使用它来区分设计模式和应用程序运行：

```
if (LicenseManager.UsageMode != LicenseUsageMode.Designtime)
{
} 
```

# upload - 通过 HTTPS 上传文件 - 桌面到 WebServer

> ID：622695
> 
> 赞同：1
> 
> 时间：2009-03-07T23:10:51.493
> 
> 标签：upload, https, desktop

我有一个桌面应用程序需要将文件上传到网络服务器。

协议是 HTTPS。

我在想我应该写一个 ashx 来处理上传；一次发送 4k 块。每次都回复ok。这是一个好的算法吗？

通过 HTTPS 从桌面应用程序上传到网络服务器的最佳算法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-07T23:22:40.153

您要上传多大的文件？只要它们不是很大（> 100 MB），您就可以从您的应用程序生成多部分 MIME 编码上传 ( [RFC 1867 )。](http://www.faqs.org/rfcs/rfc1867.html)这与浏览器用于上传的格式相同，因此您的处理程序只需从 Request.Files 集合中提取文件。除非您在慢速连接上上传或上传大文件，否则分块不会给您带来太多好处。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T01:32:18.377

如果您采用仅在收到前一个数据包的确认后才发送下一个数据包的简单方法，则分块可能会减慢您的速度。这种方法已被证明是缓慢的（在具有非平凡延迟的网络上）。尝试由网络服务器直接支持的东西，而不是自己滚动（例如 Chris Hynes 提出的建议：多部分 MIME 编码上传）。

# sql-server - SQL Express Reporting Services 能否从 RDL 生成 Word 文档

> ID：622698
> 
> 赞同：1
> 
> 时间：2009-03-07T23:11:42.957
> 
> 标签：sql-server, reporting-services, ms-word, sql-server-express, docx

我知道我可以使用 SQL Reporting Service 生成 PDF 报告（甚至 SQL Express 也可以这样做），并且我可以使用 SQL Developer 版本生成 Word 文档。由于我的开发工具箱是 SQL Developer，而我的网站使用 SQL Express（我知道，这远非理想），我想知道 SQL Express 中包含的报告服务是否可以生成 Word 文档作为输出。

有这方面经验的人吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T02:34:36.213

除非您有需要以 Word 格式呈现的现有报告，否则[Open XML 格式 SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=c6e744e5-36e9-45f5-8d8c-331df206e0d0&DisplayLang=en)可能是比 Reporting Services 更好的选择（我认为无论如何都不能这样做，至少在 SQL 2005 中不能）。

优点：无需安装 Office，无需安装 SDK，无需 Reporting Services。

编辑：

2008 确实渲染了 Word，[我没有读到](http://msdn.microsoft.com/en-us/library/ms365166.aspx)关于 Express 版中不支持所有格式的任何信息。另一个轻量级选项可能是 2008 Report Viewer Control，它显然也可以呈现 Word 文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-12-07T15:32:13.177

我正在运行安装了[2007 Office System 驱动](http://www.microsoft.com/downloads/en/details.aspx?FamilyID=7554F536-8C28-4598-9B72-EF94E038C891&displaylang=en "2007办公系统驱动")程序的 SQL Server 2008R2 。我能够从 xls 导入并创建输出到 word 的报告，而无需安装办公室或支付 Aspose。如果您想从 word 文档创建 rdl 报告，那是 Aspose 赚钱的地方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T23:43:59.870

我怀疑 SQL Server Express 本身可以做到这一点，但您绝对可以购买商业工具来做到这一点。举个例子，看看[Aspose Words.NET](http://www.componentsource.com/publishersite.asp?p=aspose-words-net)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-31T16:59:32.883

我们在要求最终文档以韩文格式化的生产系统中使用了[Aspose 。](http://www.aspose.com)它就像一个魅力。

# android - Android：有 PC 端口吗？

> ID：622710
> 
> 赞同：4
> 
> 时间：2009-03-07T23:20:33.810
> 
> 标签：android, operating-system, x86

安卓可以在`x86`电脑上运行吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-07T23:25:58.507

看起来有人正在研究它... [http://www.androidx86.org/](http://www.androidx86.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-07T23:33:13.747

是的，已经有一个[可以安装在 Eee 上的图像](http://virtuallyshocking.com/2008/12/20/building-android-for-the-asus-eeepc-701/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-17T20:51:40.180

当然，另一种方法是运行 Android 模拟器。Android SDK 附带一个模拟器，可以运行所有不同版本的操作系统。它使用 qemu 来模拟 ARM 处理器架构。

# opengl - OpenGL、GTK 和 QT 库之间有什么区别？

> ID：622726
> 
> 赞同：28
> 
> 时间：2009-03-07T23:29:44.113
> 
> 标签：opengl, graphics

我了解 GTK、QT 或其他图形工具包的用途。但是我不明白OpenGL的作用。它只是另一个 GUI 库还是引用了更基本的东西？如果是这样，它是什么，我应该什么时候在日常黑客攻击中使用它？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-07T23:33:17.383

OpenGL 是一个用于在底层绘制图形的库。它主要擅长 3D 图形。OpenGL 最重要的竞争对手是 Direct3D（*不是*整个 DirectX）。

GL 只有在硬件加速的情况下才真正强大。今天，几乎每个台式机或笔记本电脑的解决方案都有 GL 加速，但在某些将显卡集成到芯片组中的系统上，它仍然相当慢。

对于日常黑客攻击，GL 可以用于许多不同寻常的目的。原因是您可以利用 GPU 的处理能力来处理与图形相关的任务。对于任何非图形语言，也存在像 CUDA 这样的更新语言来访问 GPU。

虽然 GL 的真正优势在于 3D 场景渲染，但它通常也用于 2D 操作或合成。原因是显卡的 2D 加速架构往往达不到 GL 的功率（自由度）或性能。这就是为什么有时 GL 用于视频输出（主要是缩放）或混合任务，即使这些任务的特定 2D 加速可用。Mac OS X 是通过 GL 渲染整个桌面（可选）的一个突出示例，以允许在没有高 CPU 负载的情况下获得吸引人的效果。但它也可以用于例如将抗锯齿文本字形混合到带纹理的背景上。

一旦您执行图形、性能关键任务，您可能希望 GPU 提供帮助（即使您不在屏幕上绘图也可能），然后 OpenGL 是满足您需求的干净、标准化、跨平台的答案。今天的 GUI 工具包大多不提供 GPU 加速绘图，而是将 GL 渲染包含到它们的小部件中。因此，您可以将它们用于 UI 绘图，并在适合的地方包含对性能至关重要的实时图形。在 GL 中构建整个 UI 很痛苦，但也有可用的解决方案（典型的用例是具有游戏内 UI 的游戏）。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-07T23:34:10.687

这是更根本的东西。OpenGL 允许您执行低级绘图（想想“从这里到这里画一条线”而不是“画一个按钮”）。OpenGL 操作通常也是硬件加速的，因此非常高效，而且 OpenGL API 允许您轻松使用 3D。

在 OpenGL 和 QT 或 GTK 之类的 GUI 工具包之间进行选择实际上取决于您是尝试为应用程序绘制 UI 元素，还是想要非常精细地控制图形的绘制方式。

有时，GUI 工具包在后台使用 OpenGL 来绘制它们的屏幕元素。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-08T00:03:51.897

OpenGL 是图形 API，在其上构建了更复杂的面向用户的图形库。如果您对图形开发，尤其是 3D 图形感兴趣，那么结识它是非常值得的。它是一个非常强大的系统，可以做任何事情，从绘制一条线到渲染 Quake 到处理照片般逼真的大气渲染。

与 OpenGL 相关的所有内容的起点是[OpenGL.org](http://www.opengl.org/)，其中包含指向您需要的所有内容的链接。

如果您更喜欢教科书，并且这对 OpenGL 来说不是一个坏主意，那么最终的文本是“The OpenGL 编程指南”，由于它的封面，通俗地称为“红皮书”。您可能希望使用'OpenGL Shading Language'（或橙皮书）来补充它，它会按照它所说的那样做。

OpenGL 的优点之一是有一个简单的测试工具包 - GLUT - 它已经在大多数语言中实现了绑定，并且非常容易启动和运行以进行实验，并且通常可以随意使用。

所以去渲染你的茶壶吧！

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-08T00:39:02.030

GTK、Qt、MFC、wxWidgets 等是窗口化工具包——它们提供对话框、小部件、按钮等控件来创建 GUI 应用程序。

他们通常提供的控件之一是您可以使用图形命令（画线、画圆等）在其上绘制的画布。他们可能还提供了一个 OpenGL 画布，您可以使用 OpenGL 命令在该画布上进行绘制。

OpenGL（简单来说）是一种用于显示 3D 对象的语言，它非常强大，跨平台，而且有些复杂（尤其是如果你的数学很弱！）但它比尝试自己做任何这些 3D 东西要好得多！有时可能会令人沮丧，特别是如果您做错了什么并且它只是绘制一个空白屏幕。

只是为了让事情更复杂一点，还有用 OpenGL 编写的窗口工具包，其中 OpenGL 在场景中提供了一组按钮、对话框等，并且有时（在幕后）Qt 之类的东西使用的所有 GUI 元素都是实际上是由OpenGL绘制的！

# java - 密码散列使用什么？有什么理由不使用 jBCrypt？

> ID：622732
> 
> 赞同：17
> 
> 时间：2009-03-07T23:34:14.010
> 
> 标签：java, hash, crypt, bcrypt, jbcrypt

我计划在一个新的 Web 应用程序中使用[jBCrypt](http://www.mindrot.org/projects/jBCrypt/)进行密码散列，因为它应该是我读过的最好的。因为在我调查是否有任何理由不使用它之前我没有使用它。

我有这个：

*   我没有在 Maven 存储库中找到它（在 mvnrepository.org 搜索 jbcrypt 和 bcrypt），这是一个令人沮丧的问题，因为我希望尽可能使用 Maven 存储库管理我的依赖项。如果 jBCrypt 是密码散列的最佳解决方案，我必须设置自己的本地存储库并以这种方式使用它。还是我只是错过了它？也许它在某个地方？
*   它只是在 0.2 版本，但它可能还是稳定的，版本号低的原因还有其他原因？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-08T00:56:12.910

jBcrypt 作为密码的加密算法可能很好；河豚比较强。尽管在 Blowfish 本身中报告了一些实现缺陷，但我没有发现任何关于 jBcrypt 的报道。另一方面，Blowfish 并没有像其他算法那样经过大量测试，而且[破解](http://www.crypticide.com/alecm/security/c50-faq.html)式的 known-plaintxt 攻击通常比预期的效果更好，这让加密爱好者感到惊讶。

所以这就是我的建议：

*   继续使用 jBcrypt，但在合理的范围内保护您的加密密码文件——就像在 UNIX 系统上使用 /etc/shadow 一样。
*   与 Nikhil 的建议相反，我*会将*源代码拉入您的版本控制，原因有两个：（1）您会将它们保留在哪里，因为您在构建时需要它们，以及（2）因为做 jBcrypt 的人总是有*机会*将继续做其他事情，并且您不希望在交付之前发现自己悬而未决（当您发现时不可避免地会这样做。）在这种情况下，我会将源代码放入您的版本控制中就好像它们是您的代码一样，然后可以插入任何更改，就好像您自己构建了一个新版本一样。无需比通常情况下更复杂。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T06:48:45.463

至于您担心它不成熟，我建议您设置自己的 JUnit 测试，比较 jBcrypt 和更成熟的 Bcrypt 的结果，看看您是否得到相同的结果，然后将这些结果贡献给 jBcrypt项目。

但这已经完成了：

> ...附带一组 JUnit 单元测试，以验证库的正确操作以及与 bcrypt 算法的规范 C 实现的兼容性。

仔细阅读 JUnit 测试以查看它们是否满足您的满意度是我开始的地方......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T00:17:50.037

我怀疑稳定性是否会成为一个问题，因为 bcrypt 本身已经成熟，而且它的小型标准化包装器并没有做任何特别的事情。我对 Damien Miller 的另一个 bcrypt 包装器[python-bcrypt](http://www.mindrot.org/projects/py-bcrypt/)感到满意，它仅在 0.1 版上。

我不熟悉 Maven，但是（异端警告！）我怀疑您需要对像 bcrypt 这样简单的组件进行版本控制。引用该网站的话，从 v0.1 到 v0.2 的更改是“正确性、错字和 API 调整（完全向后兼容）”，TODO 列表是空的。

# algorithm - 包含点的区域？

> ID：622733
> 
> 赞同：3
> 
> 时间：2009-03-07T23:35:31.683
> 
> 标签：algorithm

有谁知道这是否有算法？我有几个二维点。我需要找到一个点列表，当你从点 n 到点 n+1 画一条线时，你最终会得到一个包含所有点的区域。如果我能附上一张图片，我可以更好地解释自己。提前致谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-07T23:39:42.907

您正在寻找的可能是*凸包*。维基百科有一张[图片](http://en.wikipedia.org/wiki/Convex_hull)。有几种[算法](http://en.wikipedia.org/wiki/Convex_hull)可以计算凸包。[Graham 扫描](http://en.wikipedia.org/wiki/Convex_hull)可能在性能和易于实施之间提供了最佳平衡。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-07T23:40:48.893

你所要求的听起来像所谓的凸包。谷歌搜索很多信息。

如果这些点不必是集合的成员，只需找到边界框。

如果集合不必是凸的，只需找到云的质心，围绕它排列点（比如顺时针），你就会得到一颗不规则的恒星。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T01:12:23.167

如果您使用 C/C++ 进行编码（或理解它们），这是[几何算法](http://local.wasp.uwa.edu.au/~pbourke/geometry/)的极好来源- 来源和解释。

# c# - 您是如何构建面向网络的应用程序的？

> ID：622735
> 
> 赞同：0
> 
> 时间：2009-03-07T23:36:12.477
> 
> 标签：c#, architecture, oop

我正在开始设计一个主要面向网络的新应用程序，并且我正在寻找提出良好架构设计或 OOP 类模型的人的一些建议。

请描述基本架构和/或类结构。你抽象出通信位了吗？你想出了什么类实体？

该应用程序将同时具有侦听器和客户端类。它类似于提要聚合器，但使用持久连接而不是 HTTP。换句话说，我连接到一个套接字并具有数据双向流动的持久连接。然后我也有客户端持续连接到我，我将部分（或全部）数据发送给他们。

此外，我不能使用 WCF 或 .NET 3.0 或 3.5 中的任何东西（尽管我可以使用 C# 3，因为我正在 VS2008 上开发）。我必须与 Windows 2000 兼容。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-08T03:19:04.063

我正处于几周前开始编写的客户端服务器应用程序的尾端。我将 WCF 用于 .Net cient & 服务器。

但是服务器还必须连接到网络上仅能理解 TCP/IP 上的 ASCII 的设备。

*你抽象出通信位了吗？*

是的。我猜。我的意思是，我不确定我是否 100% 理解您的问题。对于我与第 3 方设备的 TCP 连接，我将 TCP 连接和通信的详细信息隐藏在我编写的类后面。有问题的设备将 ASCII 命令转换为 IR 信号，以控制卫星天线和 DVD 播放器等设备。我将 TCP 通信抽象为一个类，所以我的服务器所要做的就是进行如下调用：

```
_irService.SendCommand(someAsciiCommand); 
```

*你想出了什么类实体？*

它们基于我的域。您的域名应该基于您的域名。我不确定我是否理解这个问题。您的域将决定您的对象。

在我的域中，我正在处理一个服务器应用程序，该应用程序负责使用 VLC 通过 UDP 调度和播放多播广播。这些多播广播必须在各个方面都可配置。

当我分析域时，我想出了一个由广播、频道、设备和广播进程（负责启动 vlc.exe 进程并维护其生命周期的类）组成的模型。

该域对网络技术几乎没有影响。我最终在 WCF 中获得了一些双工“服务”，允许我操纵域。但是网络选择不是由域决定的。我想要一个对我的对象进行二进制序列化的 TCP 连接，我想要一个与服务器的双向通信，以便我的客户端可以通过回调获得实时更新。无论我的域是什么样的，我都可以使用这些选项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-10T09:56:11.347

“网络应用”是一个不明确的类别，涵盖了相当广泛的可能要求和设计。根据定义，您将不得不处理并发和延迟。稳健性始终是一个挑战：设计一个可用性是其所有硬件和软件组件的最低公分母的系统太容易了。您将不得不升级应用程序的 O/S 和组件：您能否忍受关闭所有解决方案，或者您是否需要一些热/冷备用甚至故障转移功能？网络以奇异的方式失败（至少对我们这些可怜的纯软件人来说）：你依赖于许多你从未考虑过的东西（路由器、交换机、DNS 服务器、走廊里那个留着胡子的网络工程师的脾气！），并且应该设计与悲观的心态相互作用。

一个警告：在设计分布式应用程序时不要太面向对象。对象在管理软件复杂性方面占有一席之地，但是当您开始将它们推送到网络上时，大量的性能和版本依赖性问题就会引起它们的丑陋。面向服务的架构是一个流行词，但在某种程度上作为设计原则很有用。大型机家伙已经知道这一点很长时间了......

两本通用书籍推荐：

*   [使用 UML 设计并发、分布式和实时应用程序](https://rads.stackoverflow.com/amzn/click/com/0201657937)已经有几年的历史了，但它把您可能面临的挑战带回家了（尤其是如果您在某个地方确实有硬或软实时依赖项）。有点理论，但有助于灌输对复杂性的一定程度的尊重！
*   [企业集成模式](https://rads.stackoverflow.com/amzn/click/com/0321200683)是对可用于集成新组件和旧组件的不同设计选项的系统性研究。

# c# - Debug.Assert/Debug.Fail 是否自动条件编译 #if "DEBUG"

> ID：622743
> 
> 赞同：6
> 
> 时间：2009-03-07T23:40:50.623
> 
> 标签：c#, .net, debugging

Debug.Assert/Debug.Fail 是否自动有条件地编译#if "DEBUG"？或者它更像是如果没有附加调试器（即使在发布中）它只是没有做很多事情？如果是这样，将它们留在代码中是否会对性能产生影响？或者他们真的不打算在生产代码中，只是测试或条件代码？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-07T23:45:20.427

不，如果未定义符号，则整个调用（包括任何表达式评估）都将从编译中删除。这非常重要——如果表达式中有任何副作用，如果没有定义 DEBUG，它们*就不会*发生。这是一个简短但完整的程序来演示：

```
using System;
using System.Diagnostics;

class Test
{
    static void Main()
    {
        int i = 0;
        Debug.Assert(i++ < 10);
        Console.WriteLine(i);
    }
} 
```

如果`DEBUG`已定义，则打印 1，否则打印 0。

由于这种行为，您不能`out`在条件编译方法上使用参数：

```
using System;
using System.Diagnostics;

class Test
{
    static void Main()
    {
        int i ;
        MethodWithOut(out x);
    }

    [Conditional("FOO")]
    static void MethodWithOut(out int x)
    {
        x = 10;
    }
} 
```

这给出了错误：

> Test.cs(13,6): error CS0685: Conditional member 'Test.MethodWithOut(out int)' 不能有 out 参数

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-07T23:46:15.790

Debug.Assert/Fail API 包含一个 ConditionalAttribute 属性，其值为“DEBUG”，如下所示

```
[Conditional("DEBUG")]
public void Assert(bool condition) 
```

如果在代码中编译方法调用时定义了常量 DEBUG，则 C# 和 VB 编译器实际上只会包含对 is 方法的调用。如果不存在，则方法调用将从 IL 中省略

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-07T23:50:06.453

是的，差不多。Debug 方法用 [Conditional("DEBUG")] 属性修饰，因此如果定义了 DEBUG 符号，则对 Debug 方法的调用不会编译到 IL 中。

MSDN上有关[ConditionalAttribute](http://msdn.microsoft.com/en-us/library/system.diagnostics.conditionalattribute.aspx)的更多信息。

# python - 无法在没有 sudo 访问权限的情况下安装 Python

> ID：622744
> 
> 赞同：44
> 
> 时间：2009-03-07T23:42:54.410
> 
> 标签：python, installation, sudo

我为服务器中的安装包提取、配置和使用了 make。

但是，我无法使用*make install*。我得到错误

```
[~/wepapps/python/Python-2.6.1]# make install
/usr/bin/install -c python /usr/local/bin/python2.6
/usr/bin/install: cannot create regular file `/usr/local/bin/python2.6': Permission denied
make: *** [altbininstall] Error 1 
```

我运行文件夹

```
chmod +x Python-2.6.1 
```

我仍然得到同样的错误。

如何在没有 sudo 访问权限的情况下运行*make install ？*

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-03-08T00:33:25.210

> 如何安装到我的主目录下的路径？

```
mkdir /home/masi/.local

cd Python-2.6.1
make clean
./configure --prefix=/home/masi/.local
make
make install 
```

然后使用：

```
/home/masi/.local/bin/python 
```

同样，如果您有需要您自己的 Python 用户版本的脚本（例如 CGI），您必须明确告诉他们：

```
#!/home/masi/.local/bin/python 
```

而不是使用“#!/usr/bin/env python”将选择的默认系统 Python。

您可以更改您的 PATH 设置以使从控制台中键入“python”运行该版本，但这对于在不同用户下运行的 Web 应用程序没有帮助。

如果您编译一些链接到 Python 的东西（例如 mod_wsgi），您必须告诉它在哪里可以找到您的 Python，否则它将使用系统版本。这通常是这样的：

```
./configure --prefix=/home/masi/.local --with-python=/home/masi/.local 
```

对于其他基于 setup.py 的扩展，如 MySQLdb，您只需使用正确版本的 Python 运行 setup.py 脚本：

```
/home/masi/.local/bin/python setup.py install 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2020-05-19T11:45:13.800

截至 2020 年，[`pyenv`](https://github.com/pyenv/pyenv)在没有 sudo 权限的情况下安装 Python 是最佳选择，假设系统具有必要的构建依赖项。

```
# Install pyenv
$ curl https://pyenv.run | bash

# Follow the instruction to modify ~/.bashrc

# Install the latest Python from source code
$ pyenv install 3.8.3

# Check installed Python versions
$ pyenv versions

# Switch Python version
$ pyenv global 3.8.3

# Check where Python is actually installed
$ pyenv prefix
/home/admin/.pyenv/versions/3.8.3

# Check the current Python version
$ python -V
Python 3.8.3 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-05-24T17:13:04.920

扩展 bobince 答案，如果您的系统中没有安装 readline 开发包，并且您没有 root 访问权限，则会出现问题。

当 Python 在没有 readline 的情况下编译时，您的箭头键将无法在解释器中使用。但是，您可以按如下方式安装 readline 独立包：[在不重新编译 Python 的情况下添加 Readline 功能](https://stackoverflow.com/questions/3764730/adding-readline-functionality-without-recompiling-python)

另一方面，如果您更喜欢使用本地安装的 readline 编译 python，这里是如何。

在按照 bobince 所说的做之前，编译并安装 readline。这些是这样做的步骤：

*   wget [ftp://ftp.cwru.edu/pub/bash/readline-6.2.tar.gz](ftp://ftp.cwru.edu/pub/bash/readline-6.2.tar.gz)
*   tar -zxvf readline-6.2.tar.gz
*   cd readline-6.2
*   ./configure --with-prefix=$HOME/.local
*   制作
*   进行安装

然后，将此行添加到您的 .bash_profile 脚本中：

```
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/.local/lib 
```

最后但并非最不重要的一点是，执行以下命令

```
export LDFLAGS="-L$HOME/.local" 
```

我希望这可以帮助别人！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-07T23:46:53.403

你不能；`/usr`无论如何，不​​要。只有超级用户可以写入这些目录。尝试将 Python 安装到主目录下的路径。

# php - 如何确定数据库查询或自动电子邮件等失败的系统进程是否值得向用户发送错误消息？

> ID：622756
> 
> 赞同：0
> 
> 时间：2009-03-07T23:48:33.977
> 
> 标签：php, unit-testing

我正在考虑我的 PHP 应用程序中执行某种系统过程（如数据库查询或发送电子邮件）的所有点，我想知道在所有这些点上我是否应该在出现问题时通知用户. 应用程序可能会崩溃的地方太多了，以至于我无法确定是否值得通知用户。设置某种日志记录会更好吗，每隔几天我就监控一下日志？是否有大规模应用的标准方法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-07T23:55:18.687

您可能会使用类似[log4php](http://logging.apache.org/log4php/)的东西，它是著名的[log4j](http://logging.apache.org/log4j/)库的基于 php 的实现。然后，您将使用“严重性”记录任何适用的消息。由于灵活的附加系统，您可以基于两个因素 - 严重性和类别配置“在哪里”和“如何”记录/处理/显示消息。

虽然我不确定是否已经有完整的 php 解决方案，但您可能会将非严重错误记录到数据库并由应用程序中的管理组件显示，而严重错误会通过电子邮件发送给您和我是。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-07T23:57:00.663

从用户的角度来看，所有意想不到的事情（包括“你确定”或类似的错误消息提示）都会触发尽快摆脱它的冲动。用户不阅读消息并且可能不会通知您问题，因此在几乎所有情况下，用技术细节压倒用户是错误的方式，您通常最好登录或发送电子邮件给您当出现问题时。

对于用户，尝试将您的失败案例划分为可以通过重试和自动重试来缓解的失败，然后再告诉用户（但不是无休止地）和需要管理操作或只是时间来解决的失败，在这种情况下会出现通用错误消息最好为开发人员提供更详细的日志消息。

也就是说，如果您不假设所有用户都是开发人员。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-07T23:59:45.587

理想情况下，作为需求流程的一部分，您的用户会告诉您他们希望收到什么通知。

如果做不到这一点，您可以采用一个指导方针，比如只通知需要用户采取一些行动的情况。

# variables - 动态类型语言中地图/列表的变量命名约定

> ID：622759
> 
> 赞同：10
> 
> 时间：2009-03-07T23:51:22.690
> 
> 标签：variables, groovy, language-agnostic, naming-conventions, dynamic-typing

我正在学习 Groovy 语言，它具有动态类型（以及可选的静态类型）。它还原生支持列表、地图和范围，所以我发现自己经常使用列表和地图，尤其是列表列表、地图列表、列表地图等。

在静态语言中（尤其是泛型语言），你总是知道你的类型是什么。我对动态语言相当陌生，要跟踪我的变量应该是什么变得有点困难，所以我想知道其他人是否使用某种变量命名约定来保持这些正确。

例如，假设我有一个日期映射作为键和整数作为值。或整数列表，或包含字符串作为键和帐户对象作为值的映射列表。

似乎在变量名后面创建一个清晰的约定将帮助我跟踪我正在处理的数据类型结构，而无需查找它。

有小费吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-08T00:37:35.513

这是一个常见的初学者的感叹。您可以使用命名约定，但很可能您很快就会放弃它并专注于变量表示的*内容*（它相对于其余代码的含义）而不是担心它是*如何*表示的（它是“类型”） .

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-08T01:16:03.843

变量的名称应该向阅读代码的人解释它应该是什么，它代表什么。如果您有日期到整数的映射，它是否表示，例如（建议的变量名称在括号中）：

1.  在该日期到期的付款次数 ( `paymentsDue`)
2.  映射日期与其他时间点之间的天数 ( `daysPassed`)
3.  当天在 Stack Overflow ( `numberOfPostedMessages`)上发布的一些消息

在变量类型不容易获得的语言中，您可能需要附加后缀的前缀，例如`paymentsDueMap`. 但是，我建议不要在变量名中编码任何额外的类型信息，例如`datesToInts`- 这通常弊大于利。

最后，如果您有一个复杂的数据结构，例如字符串和帐户之间的映射列表，最好将其封装到一个单独的类中，并根据其意图命名。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-08T01:27:45.143

> 在静态语言中（尤其是泛型语言），你总是知道你的类型是什么。

在使用动态语言编程一段时间后，您会了解到以这种方式使用类型是一种拐杖。两条忠告：

1.  使用良好的变量命名。例如，如果您有一个日期到整数的映射，您可以将其命名为 BirthdateToTotalLookup。
2.  了解要寻找的视觉线索。这似乎很明显，但我花了一段时间才养成寻找这样的线索的习惯：

    ```
    sum += x['10-16-92'] 
    ```

从上面的代码中，我可以看出 x 是一个以日期为键并返回某种数字的映射。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-08T00:59:56.457

如果名称可以保持简短，那么我倾向于将地图命名为“nounToNoun”之类的名称。因此，使用您将日期映射到整数的示例，我将其命名为“dateToCount”（如果整数是某些东西的计数器）。这样就很明显它是一张地图，并且很明显什么被映射到什么。问题是有时很难使这些名称保持简短易读。例如，“userToLoginHistory”开始变得有点笨拙。

对于列表，我通常使用复数作为变量名。所以“用户”将是单个用户，“用户”将是用户列表。

老实说，我不确定地图列表的好名字是什么。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-08T16:51:55.310

这是你会随着时间的推移而超越的东西。并不是说我不认识一个 20 年仍在使用匈牙利语的程序员，但他正在使用静态类型语言进行编码，因此几乎可以理解。

考虑一下。您命名的那个变量可能是一个 HashMap，那么您在名称中添加什么类型？地图？这是一个中间的答案。为什么不收藏？由于这种方式，如果您决定更改数据存储方式，则不必更改变量名称。如果您真的想让读者知道发生了什么，为什么不使用 HashMap。

您可能会怀疑，这些都不是必需的。动态语言（甚至多态性）的要点是您不需要知道所呈现变量的确切类型，只有数据本身很重要。虽然您可能需要有关如何与该数据交互的提示，但您很快就会发现在大多数情况下您已经知道，或者可以轻松地将这些信息放入变量中而无需指定类型：addressesByZipCode、totalByBirthdate 等。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-08T04:55:30.353

动态语言的好处之一是，即使您将对象用作地图 - 它也不必是地图。它所要做的就是支持发送给它的任何消息。在 Groovy 中，如果我知道给定方法需要一个映射，以便它可以通过字符串键查找事物 - 我可以给它完整映射、精简映射、具有与键命名相同的属性的 Expando ，或任何其他具有与键名称相同的属性的对象。这是因为 someObject["keyname"] 和 someObject.keyname 是同一个东西。（当然，如果代码调用 someObject.get("keyname") 我必须以某种方式连接该方法。）

关键是，在像 Groovy 这样的动态语言中，您较少考虑 TYPES，而更多地考虑 SUPPORTED MESSAGES。如果它在概念上是一张地图，很好 - 将其命名为birthdateToTotal 是有道理的（虽然我更喜欢称它为'totals'，因为totals[birthdate] 看起来比birthdateToTotal[birthdate] 更好） - 但如果它不需要指定，不要指定它。你以后给自己留灵活性。

# delphi - 在 Delphi 2009 下将字符串保存到磁盘

> ID：622761
> 
> 赞同：1
> 
> 时间：2009-03-07T23:53:09.970
> 
> 标签：delphi, delphi-2009, save

我有一个像下面这样的结构，需要从磁盘保存和加载。

```
 RSecStructure= packed record
   Name               : string[255];       {NEED UNICODE SUPPORT HERE}
   ScreenName         : string[255];
   OrigFileName       : string[255];                    
   Prim               : string[255];                                           
   ParentVersion      : integer;
   sTag1              : string[255];      
   sTag2              : string[255];
   sTag3              : string[255];
   sTag4              : string[255];
   DateAdd            : TDateTime;
   DateModify         : TDateTime;
  end; 
```

到目前为止，我已经使用这样的东西来保存结构：

```
function
var F: FILE;
    Hdr: RSecStructure;
begin
...
 BlockWrite (F, Hdr, SizeOf(Hdr));   
...
end 
```

上面的代码在 Delphi 7 下工作。在 D2009 下，当我在短字符串和 Unicode 字符串之间进行分配时，我收到了很多警告消息。到目前为止，我设法在没有任何编译器警告或提示的情况下编写 Delphi 代码，我希望保持这种状态。所以我需要一个优雅的方法是将字符串（Unicode 很好但不是关键）保存到磁盘而不收到警告。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-08T00:13:48.033

Delphi 2009 中的这些字符串字段与所有先前版本中的相同。`ShortString`不是 Unicode 类型。

因此，您应该能够按原样继续使用该记录。

你说它在 Delphi 7 中有效。它在 Delphi 2009 中*无效吗？*描述你遇到的问题。

你的意思是说你想要一个等价于的固定长度的Unicode `ShortString`？没有，所以你不能有这样的记录，让它保存类似字符串的 Unicode 值，然后将它直接保存到磁盘。

不过，我认为这不是一个大问题，因为您的磁盘格式无论如何都不会与您当前的格式兼容：您的字符太大了。

您可以使用字符数组：

```
type
  TSecStructure = packed record
    Name               : array[0..255] of UnicodeChar;
    ScreenName         : array[0..255] of UnicodeChar;
    OrigFileName       : array[0..255] of UnicodeChar;
    Prim               : array[0..255] of UnicodeChar;
    ParentVersion      : integer;
    sTag1              : array[0..255] of UnicodeChar;
    sTag2              : array[0..255] of UnicodeChar;
    sTag3              : array[0..255] of UnicodeChar;
    sTag4              : array[0..255] of UnicodeChar;
    DateAdd            : TDateTime;
    DateModify         : TDateTime;
  end; 
```

这不会像真正的字符串类型那样方便，但它适用于大多数用途。

您还可以使用普通`UnicodeString`类型：

```
type
  TSecStructure = record
    Name               : UnicodeString;
    ScreenName         : UnicodeString;
    OrigFileName       : UnicodeString;
    Prim               : UnicodeString;
    ParentVersion      : integer;
    sTag1              : UnicodeString;
    sTag2              : UnicodeString;
    sTag3              : UnicodeString;
    sTag4              : UnicodeString;
    DateAdd            : TDateTime;
    DateModify         : TDateTime;
  end; 
```

您不能再将其直接保存到磁盘，但您也不再限于 255 个字符。您必须分别存储每个字符串字段。确保也存储字符串的长度，否则在稍后加载文件时，您将不知道一个字符串在哪里结束，而下一个字符串从哪里开始。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-08T08:49:46.140

或者，您可以声明可存储的短 unicode 字符串记录并实现隐式“到字符串”和“从字符串”转换。

```
program TestShortUnicodeString;

{$APPTYPE CONSOLE}

uses
  SysUtils;

type
  TShortUnicodeString = record
  private
    Data: array [0..255] of char; //WARNING - NOT initialized to an empty string
  public
    class operator Implicit(const sus: TShortUnicodeString): string; inline;
    class operator Implicit(const ws: string): TShortUnicodeString; inline;
  end;

class operator TShortUnicodeString.Implicit(const sus: TShortUnicodeString): string;
begin
  Result := StrPas(sus.Data);
end;

class operator TShortUnicodeString.Implicit(const ws: string): TShortUnicodeString;
begin
  // too long strings are silently truncated
  StrPLCopy(Result.Data, ws, Length(Result.Data)-1);
end;

type
  TTestRec = record
    ws1: TShortUnicodeString;
    ws2: TShortUnicodeString;
  end;

var
  f    : file;
  test1: TTestRec;
  test2: TTestRec;

begin
  test1.ws1 := '6*9 =';
  test1.ws2 := ' 42';
  AssignFile(f, 'test.dat');
  Rewrite(f, 1);
  BlockWrite(f, test1, SizeOf(test1));
  CloseFile(f);
  AssignFile(f, 'test.dat');
  Reset(f, 1);
  Assert(FileSize(f) = SizeOf(test2));
  BlockRead(f, test2, SizeOf(test2));
  CloseFile(f);
  Writeln(string(test2.ws1), string(test2.ws2));
  Readln;
end. 
```

[以上代码发布到公共领域，不承担任何许可义务。]

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-27T06:56:29.470

您可以保留现有结构（字符串 [255]）、现有文件格式，甚至可以正确读取以前保存的非 unicode 数据，方法是使用以下命令：

在写入数据之前：

```
...
record.Name:= UTF8EncodeToShortString(Name); 
```

读取数据后：

```
...
Name:= UTF8ToString(record.Name); 
```

# c++ - 将音乐作为 SDL_Mixer 块运行

> ID：622762
> 
> 赞同：4
> 
> 时间：2009-03-07T23:53:46.757
> 
> 标签：c++, audio, sdl, sdl-mixer

目前，SDL_Mixer 有两种声音资源：块和音乐。

除了 API 和支持的格式限制之外，**还有什么理由不将音乐作为 SDL_Chunk 和频道加载和播放**？（内存、速度等）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T18:09:42.230

API 是真正的问题。“音乐” API 旨在处理流式压缩音乐，而“声音” API 则不是。再说一次，如果你设法让它在你的应用程序中工作，那么它就可以工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T05:12:12.583

我还没有查看 SDL 代码，但我的猜测是“块”用于较小的声音样本，并且在“音乐”被流式传输时被缓存在内存中，被解码（不缓存在内存中）它的全部，但根据需要进行解码和缓冲，假设它在大多数情况下会从头开始播放，并从那一点连续播放，有时可能会重置回开始）

所以原因是记忆。您不想将 4 分钟的 16 位立体声歌曲解码到内存中，因为如果您尝试它，它将吃掉 44100Hz * 2bytes * 2channels *4minutes *60sec/min == 42336000 字节，当您可以解码和缓冲较小的部分。

OTOH，如果您每分钟有大约 10Mb 的 RAM 要浪费，并且您需要动态解码所消耗的 CPU……您可能会使用块。

# java - 我可以模拟超类方法调用吗？

> ID：622763
> 
> 赞同：17
> 
> 时间：2009-03-07T23:54:38.783
> 
> 标签：java, tdd, mocking, easymock, jmock

有时，你想测试一个类方法，并且你想对超类方法的调用做一个期望。我没有找到使用easymock或jmock在java中实现这种期望的方法（我认为这是不可能的）。

有一个（相对）干净的解决方案，使用超类方法逻辑创建一个委托，然后对其设置期望，但我不知道为什么以及何时使用该解决方案¿任何想法/示例？

谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-08T04:49:50.663

好吧，如果你愿意，你可以。不知道你是否熟悉[JMockit](http://code.google.com/p/jmockit/)，去看看吧。当前版本是 0.999.17 同时，让我们来看看它......

假设以下类层次结构：

```
public class Bar {
    public void bar() {
        System.out.println("Bar#bar()");
    }
}

public class Foo extends Bar {
    public void bar() {
        super.bar();
        System.out.println("Foo#bar()");
    }
} 
```

然后，在你的 JMockit 中使用`FooTest.java`你可以验证你实际上是在调用`Bar`from `Foo`。

```
@MockClass(realClass = Bar.class)
public static class MockBar {
    private boolean barCalled = false;

    @Mock
    public void bar() {
        this.barCalled = true;
        System.out.println("mocked bar");
    }
}

@Test
public void barShouldCallSuperBar() {
    MockBar mockBar = new MockBar();
    Mockit.setUpMock(Bar.class, mockBar);

    Foo foo = new Foo();
    foo.bar();

    Assert.assertTrue(mockBar.barCalled);

    Mockit.tearDownMocks();
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2016-03-28T15:57:30.753

使用 JMockit 1.22 扩展@Cem Catikkas 的答案：

```
@Test
public void barShouldCallSuperBar() {
    new MockUp<Bar>() {
        @Mock
        public void bar() {
            barCalled = true;
            System.out.println("mocked bar");
        }
    };

    Foo foo = new Foo();
    foo.bar();

    Assert.assertTrue(mockBar.barCalled);
} 
```

不需要@MockClass注解的静态类，由MockUp类代替。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-08T00:23:31.800

我不认为我会模拟一个超级调用 - 我觉得这种行为是类本身行为的一部分，而不是依赖项的行为。模拟总是感觉它应该与依赖关系比其他任何事情都更重要。

你有一个很好的例子来说明你想模拟的那种电话吗？如果您想模拟这样的调用，是否值得考虑组合而不是继承？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-21T22:39:30.787

在 Animated Transitions 示例测试套件中，有几个使用 JMockit 期望 API 的测试可以做到这一点（即指定超类方法的预期调用）。例如，[FadeInTest](https://jmockit.dev.java.net/source/browse/jmockit/samples/AnimatedTransitions/test/org/jdesktop/animation/transitions/effects/FadeInTest.java?rev=1.3&view=markup)测试用例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-05T16:39:25.400

不，没有办法用[jMock 模拟](http://jmock.org/)超类方法。

但是，有一个快速而肮脏的解决方案可以解决您的问题。假设您有 A 类和 B 类扩展 A。您想在 B 上模拟方法 Aa()。您可以在测试代码中引入 C 类扩展 B 并覆盖方法 Ca()（只需调用 super，或返回 null、id不要紧）。在那个模拟 C 之后，在任何地方使用模拟，在那里你会使用 B。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-21T12:24:44.177

拦截一个超级调用太细粒度了。不要过度隔离。

# deployment - 通过单击一次部署在更新中保留 app.config 变量

> ID：622764
> 
> 赞同：11
> 
> 时间：2009-03-07T23:54:43.150
> 
> 标签：deployment, visual-studio-2005, clickonce

每次单击一次为应用程序发布新更新时，app.config 文件中的变量都会被销毁

```
<userSettings>
    <app.My.MySettings>
      <setting name="Email" serializeAs="String">
        <value />
      </setting>
      <setting name="UserName" serializeAs="String">
        <value />
      </setting>
    </app.My.MySettings>
  </userSettings> 
```

我怎样才能防止这种情况？

有没有办法从以前的应用程序版本中获取变量？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-08T00:35:30.667

您是否选中了“应用程序应检查更新”选项？

查看[Exploring Secrets of Persistent Application Settings](http://www.devx.com/dotnet/Article/33944/1954)（标题为“维护程序版本之间的设置”的部分）：

> 对于当前版本中与之前版本中的设置相匹配的任何设置，此例程会将它们导入当前版本的 user.config 文件中：

在程序的入口点，放置以下代码。

```
if (Properties.Settings.Default.UpgradeSettings) 
{
   Properties.Settings.Default.Upgrade();
   Properties.Settings.Default.UpgradeSettings = false;
} 
```

请注意，UpgradeSettings 是您需要自己添加的布尔**用户**设置（不是应用程序），并且您希望默认值为`True`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-01T08:35:51.530

如果您使用用户级设置而不是应用程序级设置，它会在检索到新版本时将它们向前复制。不过，最安全的做法是将这些数据从 ClickOnce 更新中分离出来，呃，“经验”。看看这是否有帮助：

[http://robindotnet.wordpress.com/2009/08/19/where-do-i-put-my-data-to-keep-it-safe-from-clickonce-updates/](http://robindotnet.wordpress.com/2009/08/19/where-do-i-put-my-data-to-keep-it-safe-from-clickonce-updates/)

# ruby-on-rails - Ruby on Rails 数组访问

> ID：622779
> 
> 赞同：0
> 
> 时间：2009-03-08T00:03:59.213
> 
> 标签：ruby-on-rails, arrays

我的问题涉及一个显然不是 nil 的数组，但是当我尝试访问它时，它是。

该数组是从对活动记录的查找中返回的。我已经确认它实际上是一个带有 .class 方法的数组

```
@show_times = Showing.find_showtimes(params[:id])
@show_times.inspect =>shows that the array is not empty and is a multidimensional array.
@show_times[0] =>is nil
@show_times[1] =>is nil
@show_times.first.inspect => NoMethodError (undefined method `first') 
```

我很困惑为什么会这样。。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T00:34:03.353

它不是一个数组，它是一个活跃的记录魔术结构，大部分看起来像一个数组。我认为您可以对其执行 to_a 以获得真正的数组，但随后很多魔法就消失了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T00:32:25.447

`find_showtimes`不是内置查找器 - 如果是，它将返回单个 ActiveRecord 对象或 ActiveRecord 对象数组 - 绝不是多维数组。所以我要做的第一件事就是看看那个方法的来源。

**编辑：**给定您的源代码（在评论中）-您实际上是从您的查找器返回一个哈希，而不是一个数组。请参阅[Enumerable 的 group_by 的文档](http://api.rubyonrails.org/classes/Enumerable.html#M002506)。哈希将您的剧院对象映射到一组放映对象。这就是你想要做的：

```
Showing.find_showtimes(params[:id]).each do |theater, showtimes|
  puts "Theater #{theater} is showing the movie at #{showtimes.join(', ')}"
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T21:30:32.067

如果您在控制台中并且想要探索 @show_times 对象，您可以使用 keys 方法查看所有哈希键，然后获取单个哈希项（例如所有显示时间），如下所示：

```
@show_times[:theater_one] 
```

同样的事情将在您的模型/视图中工作，但使用 each/map/collect 会更干净，因为漂亮的代码。

# c# - Visual Studio 是否有设置或良好的加载项来在编辑器中对线条（如 Throw）进行着色？

> ID：622781
> 
> 赞同：1
> 
> 时间：2009-03-08T00:04:45.933
> 
> 标签：c#, .net, visual-studio, visual-studio-2008, visual-studio-2005

Visual Studio 是否有设置（没有找到一只手）或好的插件（SO 比 Google 更适合推荐）根据它包含的关键字或语句在编辑器中专门为线条着色？

例如，如果一行包含“Throw”，最好看到那个词或红色的行，类似“Debug.Assert”（黄色看起来不错），然后返回......好吧，也许我的如果我走那么远，屏幕会看起来像彩虹......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T00:23:04.237

我不知道任何特定的插件，但这可以通过一个简单的[DXCore](http://devexpress.com/Products/Visual_Studio_Add-in/DXCore/)插件来实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T00:17:47.260

在 VS2005 中，单击工具、选项、环境、字体和颜色。有许多不同类型的文本元素的设置，允许对代码进行着色以帮助指示语法。

默认设置很微妙，但提示的有用信息比您乍一看要多得多。很容易过火...

似乎不可能为单个关键字提供不同的属性，恕我直言，无论如何这都是一个坏主意。

其他程序员的编辑器提供类似的功能。

# visual-studio - app.config 中的用户范围与应用范围

> ID：622782
> 
> 赞同：10
> 
> 时间：2009-03-08T00:04:48.553
> 
> 标签：visual-studio, visual-studio-2008, visual-studio-2005

app.config 中的用户范围和应用范围有什么区别？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-08T00:20:54.383

用户范围设置用于存储特定于每个用户的值，而应用程序范围设置用于所有用户。

看看这篇[文章](http://www.devx.com/dotnet/Article/34273/1954)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-08T00:25:13.793

User Scoped Settings 只会影响当前用户，设置起来相对安全。它们存储在用户特定的位置，因此写入它们没有真正的问题。

另一方面，应用程序范围设置是只读的，无法更改

# python - Python，PIL，作物问题

> ID：622783
> 
> 赞同：0
> 
> 时间：2009-03-08T00:07:03.603
> 
> 标签：python, python-imaging-library, crop

似乎无法让裁剪正常工作，问题是，它裁剪了一个尺寸正确的区域，但总是从左上角 (0, 0)，而不是从我传递的坐标。

```
image = Image.open(input)
region = image.crop((1000,400,2000,600)
region.save(output) 
```

在 PIL 的 image.py 中，我打印了方法 _ImageCrop ..：

```
print x0, y0, x1, y1
self.__crop = x0, y0, x1, y1 
```

价值观似乎是正确的。

输入是大小为 1600x2390 的 JPEG 图像。

Python 版本：2.5，PIL 版本：1.1.6

有什么建议么？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T00:42:38.153

适合我：Python 2.6.1、PIL 1.1.6、JPEG 大小为 2020x1338 像素。

您确定您的意思是 1600x2390 而不是 2390x1600 的 JPEG 吗？(1000,400,2000,600) 框尺寸超出了 1600 宽图像的尺寸；如果我尝试这个，我会在相交区域之外得到垃圾数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-20T10:15:13.123

我下一步要做：

```
cover=Image.open(path_to_cover+"/shablon1.jpg") 
```

……

```
def generit_nomer_proekt(self,nomer):
    size_box=(160,40)
    font=ImageFont.truetype('/home/vintello/workspace/mpg_to_dvd/src/cover/ttf/aricyr.ttf',int(30))
    im = Image.new ( "RGB", size_box , "white" )
    draw = ImageDraw.Draw ( im )
    draw.text ( (20,0), unicode(nomer,"utf-8"), fill="#74716f", font=font )
    return im 
```

......

```
nazv_vert=self.generit_nomer_proekt(nomer)
coo=nazv_vert.size
left_x=1575
left_y=383
box_vert_nazv=(left_x,left_y,left_x+coo[0],left_y+coo[1])
cover.paste(nazv_vert,box_vert_nazv) 
```

或者，如果您过去不使用 PNG：

```
cover.paste(nazv_vert,box_vert_nazv,nazv_vert) 
```

# lisp - 在clojure中让vs def

> ID：622785
> 
> 赞同：39
> 
> 时间：2009-03-08T00:10:13.660
> 
> 标签：lisp, clojure, let, function

我想`Scanner`在 clojure 程序中创建 Java 类的本地实例。为什么这不起作用：

```
; gives me:  count not supported on this type: Symbol 
(let s (new Scanner "a b c")) 
```

但它会让我创建一个像这样的全局实例：

```
(def s (new Scanner "a b c")) 
```

我的印象是唯一的区别是范围，但显然不是。`let`和 和有什么不一样`def`？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2009-03-08T00:29:50.117

问题是你的使用`let`是错误的。

`let`像这样工作：

```
(let [identifier (expr)]) 
```

所以你的例子应该是这样的：

```
(let [s (Scanner. "a b c")]
  (exprs)) 
```

您只能在 let 的范围内使用由 let 进行的词法绑定（左括号和右括号）。让我们创建一组词法绑定。我使用 def 来进行全局绑定，而让让我只在 let 的范围内绑定我想要的东西，因为它可以保持干净。他们都有自己的用途。

注意： (Class.) 与 (new Class) 相同，只是语法糖。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-03-09T15:58:27.147

LET 不是“在当前范围内进行词法绑定”，而是“使用以下绑定创建新的词法范围”。

```
(让 [s (foo 随便)]
  ;; s 绑定在这里
  )
;; 但不是在这里

```

```
(def s (foo 随便))
;; s 绑定在这里

```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-11T17:33:57.853

简化：**def**用于全局常量，**let**用于局部变量。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-03-08T00:29:06.080

正确的语法：

```
(let [s (Scanner. "a b c")] ...) 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-08T00:30:26.637

它们的语法是不同的，即使含义是相关的。

let 接受一个*绑定列表*（名称值对），后跟表达式以在这些绑定的上下文中求值。

def 只接受一个绑定，而不是一个列表，并将其添加到全局上下文中。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-12-08T07:56:47.450

您可以将其`let`视为创建新词法范围的语法糖，`fn`然后立即应用它：

```
(let [a 3 b 7] (* a b))  ; 21
; vs.
((fn [a b] (* a b)) 3 7) ; 21 
```

所以你可以`let`用一个简单的宏来实现`fn`：

```
(defmacro fnlet [bindings & body]
  ((fn [pairs]
    `((fn [~@(map first pairs)] ~@body) ~@(map last pairs)))
   (partition 2 bindings)))

(fnlet [a 3 b 7] (* a b)) ; 21 
```

# java - 包中带有init（）的Java小程序？

> ID：622806
> 
> 赞同：5
> 
> 时间：2009-03-08T00:31:48.693
> 
> 标签：java, applet

我想知道您是否可以将主类（或具有 init 方法的类，无论如何）放在一个包中，并且仍然让它在浏览器中运行？大多数时候我把我的小程序放在（默认包）中，但我这里的小程序是在一个包中，所以我仍然可以将它嵌入到网页中吗？

我用谷歌搜索了它，结果很少。假设我有`MyApplet.class`一个名为`app`.jar 文件的目录`MyApp.jar`。

我试过这些没有成功：

```
<applet archive="MyApp.jar" code="MyApplet.class">
<applet archive="MyApp.jar" code="app/MyApplet.class">
<applet archive="MyApp.jar" code="/app/MyApplet.class">
<applet archive="MyApp.jar/app/" code="MyApplet.class">
<applet archive="MyApp.jar" codebase="app/" code="MyApplet.class"> 
```

这些中的每一个都给了我一个 ClassNotFoundException。

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T00:49:56.683

archive 属性应该包含 jar 的文件名，并且应该与网页放在同一目录中。

代码属性中的类文件应包含由正斜杠分隔的完全限定类名，以指示目录结构。

因此，在您尝试的试验列表中，试验 2 应该成功，前提是 MyApp.jar 实际上与 html 页面一起存在。此外，MyApp.jar 应包含根中的“app”目录，该目录应包含 MyApplet 类文件。不要忘记在应用程序包中有 MyApplet 类本身。

您可以查看[此页面](http://www.math.gatech.edu/~carlen/applets/archived/ClassFiles/Basins.html)以供参考。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T01:26:45.300

好吧，您以虚线的形式列出了包，并且没有将“.class”放在最后。

```
<applet code="packagefolder1.packagefolder2.MyApplet" archive="folder1/folder2/MyApp.jar">

</applet> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T00:47:09.950

我不确定，但你试过这样吗？：

```
<applet archive="MyApp.jar" code="MyApplet"> 
```

# java - 通过 setVisible 隐藏/显示的 JFrame 的窗口事件？

> ID：622814
> 
> 赞同：17
> 
> 时间：2009-03-08T00:35:31.820
> 
> 标签：java, swing, events

我必须添加哪种类型的侦听器`JFrame`来检测它何时被隐藏或显示`setVisible`？

我尝试使用 a`WindowListener`和[`windowOpened`](http://java.sun.com/javase/6/docs/api/java/awt/event/WindowListener.html#windowOpened(java.awt.event.WindowEvent))and[`windowClosed`](http://java.sun.com/javase/6/docs/api/java/awt/event/WindowListener.html#windowClosed(java.awt.event.WindowEvent))方法，但它们仅在*第一次*打开窗口时起作用（`windowOpened`），或者分别在使用 dispose 方法（`windowClosed`）关闭窗口时起作用。这对我来说还不够。我希望每次使用`setVisible`.

是否有标准的 Swing 方法来实现这一点，还是我需要自己制作（例如，重写该`setVisible`方法）？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-08T01:04:30.750

尝试一个`java.awt.event.ComponentListener`. 您可以使用以下代码添加一个（其中 window 是 的名称`JFrame`）：

```
window.addComponentListener(new ComponentAdapter() {
   public void componentHidden(ComponentEvent e) {
      /* code run when component hidden*/
   }
   public void componentShown(ComponentEvent e) {
      /* code run when component shown */
   }
}); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-08-05T04:50:54.053

1- 创建一个实现 ComponentListener 接口的类，如以下示例：

```
 //---------------------
    import java.awt.event.ComponentEvent;
    import java.awt.event.ComponentListener;

    public class winlistenner implements ComponentListener {

        public void componentHidden(ComponentEvent arg0) {
            // TODO Auto-generated method stub
            System.out.print("Hided\r\n");

        }

        public void componentMoved(ComponentEvent arg0) {
            // TODO Auto-generated method stub
            System.out.print("Moved\r\n");

        }

        public void componentResized(ComponentEvent arg0) {
            // TODO Auto-generated method stub
            System.out.print("Resized\r\n");

        }

        public void componentShown(ComponentEvent arg0) {
            // TODO Auto-generated method stub

            System.out.print("Shown\r\n");

        }

}
//------------------------------------------------------------------------ 
```

2- 现在为您的 JFrame 创建一个 getter，如下所示：

```
public class JMain {

    private JFrame frmNetworkshareMoon;
    private JTextField textField;
    private JTextField textField_1;
    private JTextField textField_2;

    public JFrame getFrmNetworkshareMoon() {
        return frmNetworkshareMoon;
    }

    /**
     * Launch the application.
     */
    public static void main(String[] args) {
        EventQueue.invokeLater(new Runnable() {
            public void run() {
                try {
                    JMain window = new JMain();
                    winlistenner listenner= new winlistenner();
                    window.getFrmNetworkshareMoon().addComponentListener(listenner);
                    window.frmNetworkshareMoon.setVisible(true);
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        });
    }
//......
// the rest of your class code:
//...
} 
```

3-像上面的例子一样作为你的主，你将 JFrame 监听器设置为你创建的监听器，然后运行程序，你会看到来自监听器的消息：

```
Moved
Resized
Resized
Moved
Shown
Moved
Moved 
```

# c# - 使用 Virtual Earth 和 SQL 进行数据可视化

> ID：622816
> 
> 赞同：1
> 
> 时间：2009-03-08T00:36:39.883
> 
> 标签：c#, sql-server-2008, virtual-earth

场景：我有一个地址列表（它们已经转换为纬度/经度）和该人参加的会议。

我想要什么：我想在虚拟地球地图上添加一个圆形，例如，覆盖 90% 的会议与会者。我将在每次会议上重复这一点。这将向我展示不同的会议“出席区域”有多少相互重叠。90& 的原因是排除“异常值”，即那些不在主要“出勤区域”中的值。

那么问题来了：什么算法或者SQL空间查询做得到上述数据集（90%）？我想我可以从那里拿走它（即圈子有多大，放在哪里等）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T02:50:48.220

对于每个人，将与所有其他人的距离相加。按这些总数排序，并删除最高的 10%。

然后把剩下的两个相距最远的人带到那里，把你的中心放在那里。最远的人之间的距离就是你的直径。

# asp.net - 从基于表单的身份验证中删除安全问题

> ID：622822
> 
> 赞同：2
> 
> 时间：2009-03-08T00:43:50.147
> 
> 标签：asp.net, forms-authentication

我正在构建一个启用 FBA 的小型网站（SqlMembershipProvider），我希望注册尽可能简单，只需提示输入用户名（电子邮件地址）和密码。

如何从创建用户控件中删除安全问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T01:33:42.850

我的错，我对那个开枪了。

看起来控件会感知底层提供者是否需要问题和答案。那么，您是否尝试过在 web.config 中禁用它？

> ```
> <add
>   name="AspNetSqlMembershipProvider"
>   type="System.Web.Security.SqlMembershipProvider, ..."
>   connectionStringName="LocalSqlServer"
>   enablePasswordRetrieval="false"
>   enablePasswordReset="true"
>   **requiresQuestionAndAnswer="false"**
>   applicationName="/"
>   requiresUniqueEmail="false"
>   passwordFormat="Hashed"
>   maxInvalidPasswordAttempts="5"
>   minRequiredPasswordLength="7"
>   minRequiredNonalphanumericCharacters="1"
>   passwordAttemptWindow="10"
>   passwordStrengthRegularExpression=""
> /> 
> ```

下面的错误答案：

* * *

将[QuestionAndAnswerRequired](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.questionandanswerrequired.aspx)属性设置为 false。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-15T00:23:08.547

在 web.config 中设置 requiresQuestionAndAnswer="false"

IE：

```
<membership defaultProvider="MySqlMembershipProvider">
    <providers>
        <clear/>
        <add name="MySqlMembershipProvider" 
            type="System.Web.Security.SqlMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" 
            connectionStringName="LocalSQL" 
            enablePasswordRetrieval="false" 
            enablePasswordReset="true" 
            requiresQuestionAndAnswer="false" 
            requiresUniqueEmail="false" 
            passwordFormat="Hashed" 
            maxInvalidPasswordAttempts="15" 
            minRequiredPasswordLength="5" 
            minRequiredNonalphanumericCharacters="0" 
            passwordAttemptWindow="10" 
            passwordStrengthRegularExpression="" 
            applicationName="/"/>
    </providers>
</membership> 
```

# c# - Java / C# 消息传递的 REST 架构的性能

> ID：622823
> 
> 赞同：0
> 
> 时间：2009-03-08T00:45:40.063
> 
> 标签：c#, java, rest

我目前有一个应用程序通过 TCP 套接字将 XML 从 Windows 客户端发送到 Windows 服务器。

我们正在重写架构，我们的服务器将使用 Java。我们正在研究的一种架构是基于 http 的 REST 架构。因此 C# WinForm 客户端将使用它发送信息。我们正在寻找高吞吐量和低延迟。

与其他一些 C# 客户端到 Java 服务器通信选项相比，是否有人对这种方法有任何性能指标。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-08T01:03:19.960

这还不足以定义任何度量标准；消息有多大，您访问 REST 服务的频率是多少，是直接 HTTP 还是您需要使用 SSL 保护它？换句话说，您能告诉我们有关*工作负载参数*的哪些信息？

（我在性能问题上一遍又一遍地说：除非你能告诉我一些关于工作负载的事情，否则我不能 - 没有人真的能 - 告诉你什么会带来更好的性能。这就是为什么他们过去常说你不能'在实现之前不要考虑性能：并不是你不能考虑性能，而是人们通常不能或至少不会考虑工作量。）

尽管如此，您可以通过查看要交换的消息数量来做出一些很好的估计，因为 TCP/IP 的设置时间通常支配 REST。REST 在这里提供了两个优点：首先，TCP/IP 时间通常*确实*主导消息传输，并且在 Apache 或 lighttpd 等生产 Web 服务器中得到了很好的优化；其次，RESTful 架构通过消除会话状态来增强可扩展性。这意味着您只需使用一个简单的 TCP/IP 负载平衡器即可自由扩展。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T01:30:02.920

我会设置一个测试来试试看。我了解您要更改的应用程序的唯一部分是客户端/服务器通信。因此，请分析您现在发送的内容，并将发送消息的测试客户端/服务器设置放在一起，这些消息代表您认为最终解决方案将要执行的操作（可能仅在大小/吞吐量方面具有代表性）。

如上一篇文章所述，没有足够的细节来真正判断性能会是什么样子。例如

1.  您的消息结构/格式是否相同，但仅通过 HTTP 而不是原始套接字？
2.  您要发送 XML 数据的子集吗？处理大量 XML 可能会占用大量内存（例如，如果您使用基于 DOM 的方法）。
3.  您选择的 REST 框架将引入多少开销（希望很少，但目前我们不知道）。

最好的解决方案是使用（比如）[Jersey](http://jersey.java.net/)进行设置，并花一些时间测试各种场景。如果您正在重新构建解决方案，那么值得花几天时间研究性能（更不用说功能、易于开发等）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T03:10:00.683

它将非常快，除非您有非常非常多的并发客户端访问这些服务器。在 Java 和 .NET 中，XML 粉碎变得越来越快。如果你在 CLR2 和 Java 5 或更高版本上，你会没事的。但是当然你仍然需要做测试来验证。

我们已经在我们的实验室中测试了 REST 和 SOAP 事务，它们比您想象的要快。每秒数万条消息。生成 XML 消息的少量现代 CPU 很容易使千兆网络饱和。换句话说，网络是瓶颈（数据传输），而不是 CPU（序列化和反序列化 XML）。

并且，如果您正确地进行软件设计，那么在 REST 不足的极不可能的情况下，换掉消息格式层（REST => protobufs）将使您获得更好的传输性能，同时将中断降至最低。

但是在你需要去那里之前，你将能够向思科汇款并获得更多的空间。

# java - 如何在 Java 中为 2D 游戏构建平铺地图？

> ID：622832
> 
> 赞同：3
> 
> 时间：2009-03-08T00:57:56.337
> 
> 标签：java, algorithm, 2d, tiles

不知道如何解决这个问题。

基本上，我想要一个 Pixel -> Tile 表示 400x400 窗口。屏幕上的每个坐标，例如`120x300`应该是图块的一部分。我最小的精灵是 4 个像素，所以我们可以说 1 个图块 = 4 个像素。玩家和敌人的精灵都是 20 x 20，因此每个玩家/坏人将占据 5 个格子。

然后我想用这个 Map 类来：

*   通过提供图块的索引/id 来检索玩家/怪物精灵的 x/y 坐标。

*   知道边界在哪里，所以它不会将精灵移动到 之外`400x400`，从而隐藏它。

*   碰撞检测，知道瓷砖是否空置。

如何才能做到这一点？在这里专门讨论 x,y->tile 或 tile index->​​x,y 转换（用于适当地绘制精灵）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T01:14:36.517

首先，将仅与表示有关的像素概念拆分为图块，图块是实际的游戏对象，并在游戏中设置了约束。

我找到了一个解决此类问题的好方法，那就是开始勾勒出你想要的粗略 API。就像是：

```
public class Board {
  public Board (int width, int height){.. }
  public boolean isOccupied(int x, int y){.. }
  public void moveTo(Point from, Point to) { .. 
    (maybe throws an exception for outofbounds ) 
```

板的所有内部单元都在瓷砖中，而不是像素中。然后像素信息可以从棋盘中独立地从图块表示中导出，并带有一些内部乘法-

```
 public Point getPixelPosition(int xTilePos, int yTilePos, int pixelsPerTile).. 
```

瓷砖可以在内部表示为二维数组或单个数组，在这种情况下，您将使用某种内部表示方案将您的数组映射到棋盘方格，从而使用 mod 算法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T01:00:46.720

简短回答：乘法和模运算。

但是，如果这让您感到难过，我建议您在尝试编写游戏之前进行认真的数学复习。

还有你的说法

> 我最小的精灵是 4 个像素，所以我们可以说 1 个图块 = 4 个像素。玩家和敌人的精灵都是 20 x 20，因此每个玩家/坏人将占据 5 个格子。

不适用于任何合理的几何形状。如果“1 块 = 4 像素”的意思是块是 2x2，那么玩家需要 100，而不是 5。如果您的意思是他们是 4x4，那么玩家需要 25，但仍然不是 5。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T05:17:10.177

```
/** size of a tile in pixel (for one dimension)*/
int TILE_SIZE_IN_PIXEL = 4;
/** size of a piece in tiles (for one dimension)*/
int PIECE_SIZE_IN_TILE = 5;

public int tileToPixel(int positionInTiles){
    return TILE_SIZE_IN_PIXEL * positionInTiles;
}

/** returns the tile coordinate to which the given tile coordinate belongs 

Note: tileToPixel(pixelToTile(x)) only returns x if x is the upper or left edge of a tile
*/
public int pixelToTile(int positionInPixel){
    return positionInPixel / TILE_SIZE_IN_PIXEL;
} 
```

您可能还需要对两个参数（x 和 y at）进行操作的方法。

对于 ID->piece 转换，反之亦然，您可以使用多种方法。选择哪一个取决于确切的要求（速度、游戏大小......）。因此，请确保您隐藏了实现细节，以便以后可以更改它们。

我将从一个真正简单的解决方案开始：

```
public class Piece{
    /** x position measured in tiles */
    private int x;
    /** y position measured in tiles */
    private int y;

    /** I don't think you need this, but you asked for it. I'd pass around Piece instances instead */
    private final  Long id;

    public void getX(){
        return x;
    }
    public void getY(){
        return y;
    }

    public void getID(){
        return id;
    }

}

public class Board(){
    private Set<Long,Piece> pieces = new HashMap<Piece>(pieces);

    public Piece getPieceOnTile(int tileX, int tileY){ 
        for(Piece piece:pieces){
             if (isPieceOnTile(piece, tileX, tileY)) return piece;
        }
    }

    private boolean isPieceOnTile(piece, tileX, tileY){
        if (piece.getX() < tileX) return false;
        if (piece.getX() > tileX + PIECE_SIZE_IN_TILE) return false;

        if (piece.getY() < tileY) return false;
        if (piece.getY() > tileY + PIECE_SIZE_IN_TILE) return false;

        return true;
    }
} 
```

希望这能让你开始。所有代码都是在附近没有编译器的情况下编写的，因此它会包含拼写错误，当然还有错误，这些错误可能会在知识共享许可下分发。

如果没有太多棋子，将棋子保持在一组中的方法应该很有效。只要大多数电路板区域不包含一块，它就应该比 2D 阵列更好。整个事情目前假设没有重叠的部分。如果你需要那些 getPieceOnTile 必须返回一个 Collection of pieces。如果顺序无关紧要，则为 set，如果重要，则为 List。

# class - 如何在 OCAML 类中声明记录

> ID：622838
> 
> 赞同：4
> 
> 时间：2009-03-08T01:03:23.063
> 
> 标签：class, object, class-design, ocaml

我想在一个类中声明一条记录，如下所示：

```
class player (x, y)=
     object(self)
     type gun = {x:int; y:int; active:bool}
     val guns = Array.create 5 {x=0; y=0; active=false}
.... 
```

但编译器声称这一行是语法错误：type gun = {x:in ....

当像这样在类外声明时

```
type :  gun = {x:int; y:int; active:bool}
class player (x, y)=
     object(self)
     val guns = Array.create 5 {x=0; y=0; active=false}
.... 
```

错误是：unbound value gun。

所以有人知道如何用另一种方式达到相同的功能吗？谢谢你！

********* 解决了***

奇怪的是，当类型在外部声明时它正在工作，谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T06:33:25.377

为什么不在类定义之外定义类型 gun ？

# vb.net - .Net 无响应、Application.DoEvents 和线程

> ID：622857
> 
> 赞同：2
> 
> 时间：2009-03-08T01:22:26.527
> 
> 标签：vb.net, multithreading

我的 mdi VB.Net 应用程序对某些数据执行长时间操作。理想情况下，我应该使用单独的线程来防止可怕的“未响应”消息。

我的问题是，如果我使用单独的线程，用户就可以点击应用程序中的其他控件，这会直接影响我的后台线程正在处理的操作，从而产生错误。

有什么方法可以防止所有 mdi 窗口、工具栏和其他控件在我的后台线程操作期间接收鼠标点击和键盘输入？

或者有没有办法在执行 Application.DoEvents 之前清除消息队列？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T01:23:47.680

我想说，当您不希望用户单击控件时，最好的选择是将该控件的 Enabled 设置为 False。

澄清：将父控件的 Enabled 设置为 False 也会禁用任何子控件。因此，在主窗口和 MDI 窗口上将 Enabled 设置为 False 就可以解决问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T01:32:46.503

有几种方法可以禁用控件，但我不确定这是您想要的。

如果您有一个在后台线程处理时完全禁用的主窗口，那么为什么要通过后台处理的开销呢？在后台处理的优点是允许用户在处理数据时仍然使用应用程序。

我认为更好的方法是采用 Dustin 的路线并选择性地禁用某些可能影响后台操作的控件。或者在处理时让您的后台操作独立于 UI。

如果您告诉我们更多有关主窗口和后台线程如何交互的信息，我们可能会为您提供更好的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T01:34:20.260

隐藏所有表格，只显示一个主要表格。然后禁用工具栏/菜单（如果有）。然后有一个带有进度条的状态栏，完成后，取消隐藏用户正在处理的表单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T02:38:36.547

当您在后台线程正在处理一些长时间的任务时使用状态栏或进度条时，禁用您的表单也将禁用您的进度/状态栏更新。因此，在这种情况下您应该做的是禁用除需要保持活动状态的所有其他控件（例如进度条）。

```
List<Control> lstControls = GetAllControls(this.Controls);

                foreach (Control ctrl in lstControls)
                {
                if (ctrl.GetType().Name.ToLower().Contains("progressbar")                     {
                        ctrl.Enabled = true;
                    }
                    else
                    {
                        ctrl.Enabled = false;
                    }
                } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T02:47:33.063

使用线程并显示一个模式对话框，向用户显示任务的进度并为用户提供取消它的选项。

模态对话框将自动阻止输入（父级可能必须是 mdi 窗口本身。）

（请不要使用隐藏或禁用控件或窗口之类的技巧。请，请，请！不要使用 DoEvents。）

# .net - 发布问题

> ID：622862
> 
> 赞同：0
> 
> 时间：2009-03-08T01:25:18.643
> 
> 标签：.net, web-config, publishing, remote-debugging

我有一个 ASP.NET Web 项目，可以在我的计算机上完美运行。但是，当我发布到远程服务器时，它会崩溃。我看到的唯一页面是主启动页面。如果我点击任何链接，我会得到一个错误页面。错误页面告诉我它无法告诉我错误是什么（出于安全原因），并且我应该在我的 web.config 文件中设置 customError mode="off"，我这样做了。但是，它仍然不会向我显示任何错误详细信息。有人可以向我解释如何找出错误是什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T01:36:38.990

XML 区分大小写，因此首先确保 CustomError Mode="Off" 不是 "off"。

接下来，您是否在另一个 asp.net 站点的子目录中运行该应用程序？如果是这样，请检查以确保该站点已关闭自定义错误。

还是没有运气？您使用的是什么网络服务器，IIS6 还是 7？您是否在进行配置更改后重新启动了应用程序或应用程序池（通常应该自动发生）？其他 .net 应用程序是否在同一台服务器上运行？

# iphone - 如何调试“发送到实例的无法识别的选择器”问题？

> ID：622865
> 
> 赞同：6
> 
> 时间：2009-03-08T01:29:35.560
> 
> 标签：iphone

我在视图控制器中有以下代码（在所有其他方面）似乎工作正常：

```
- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    ProblemViewController *problemViewController = [[ProblemViewController alloc] initWithNibName:@"ProblemViewController" bundle:nil];
    problemViewController.problem = (Problem*)[self.problems objectAtIndex:indexPath.row];
    [self.navigationController pushViewController:problemViewController];
    [problemViewController release];
} 
```

但是，当我运行此函数时，出现以下错误：

```
*** Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '*** -[ProblemViewController initWithNibName:bundle:]: unrecognized selector sent to instance 0x57ca80' 
```

我不知道是什么原因造成的，所以我的问题是：我应该如何最好地调试这个问题？有什么明显的我应该检查的吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-08T03:40:44.120

检查 ProblemViewController 的基类。我打赌你不是从 UIViewController 继承的，它包括该`initWithNibName:bundle:`方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-11-07T20:05:42.193

这个问题有很多答案，基本上都是一样的，正确的，事情：不知何故，你试图调用的方法实际上并不存在。

但是，如果你正在用头撞墙（就像我今天打了一个小时一样），请确保先尝试在 xcode 中清理你的项目。有时，我不知道为什么，xcode 可能会进入不良状态，无法将您的项目正确编译到模拟器中。它会告诉您构建成功，但是当部署到模拟器时，您开始看到运行时错误，好像只有一半的更改被拾取。所以，是的，这发生了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T02:01:46.543

您可能没有在 ProblemViewController 中实现该方法。据我所知，无法识别的选择器只是在此类的接口中没有定义具有该签名的方法。

尝试在您的界面中声明它，如下所示：

```
- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-06T19:34:41.537

我想我最好在这个问题上发布一些东西。我打了几天。有很多关于此的博客，但没有一个能解决问题。有人建议它与需要指定动画的 pushViewController 相关：YES。它对某些人有用，但这对我遇到的问题不起作用。我使用按钮来访问另一个视图，而不是从表视图中选择一行，但遇到了相同的无法识别的选择器错误。我也在使用导航控制器，所以我认为它与此有关，但事实并非如此。最后，我决定注释掉代码行，直到消息消失。注释掉导致问题的方法后，错误消息仍然出现在控制台中。那时我意识到问题不在于我的源代码。一个站点建议执行清理和重建。我尝试了所有这些，但问题仍然存在。然后，我使用 Interface Builder 查看了我的 XIB 文件，以查看文件所有者上显示的方法（接收到的操作）。有问题。有问题的方法不仅在文件所有者上出现了一次，而且还出现了两次。不知道如何在此处显示此图像。无论如何，我删除了文件所有者上出现的同名方法（收到的操作）。我执行了清理和重建以查看错误是否消失并且确实消失了。然后我取消了我认为不好的源代码的注释并再次构建了项目，并且对新视图的调用成功。然后，我使用 Interface Builder 查看了我的 XIB 文件，以查看文件所有者上显示的方法（接收到的操作）。有问题。有问题的方法不仅在文件所有者上出现了一次，而且还出现了两次。不知道如何在此处显示此图像。无论如何，我删除了文件所有者上出现的同名方法（收到的操作）。我执行了清理和重建以查看错误是否消失并且确实消失了。然后我取消了我认为不好的源代码的注释并再次构建了项目，并且对新视图的调用成功。然后，我使用 Interface Builder 查看了我的 XIB 文件，以查看文件所有者上显示的方法（接收到的操作）。有问题。有问题的方法不仅在文件所有者上出现了一次，而且还出现了两次。不知道如何在此处显示此图像。无论如何，我删除了文件所有者上出现的同名方法（收到的操作）。我执行了清理和重建以查看错误是否消失并且确实消失了。然后我取消了我认为不好的源代码的注释并再次构建了项目，并且对新视图的调用成功。我删除了出现在文件所有者上的同名方法（收到的操作）。我执行了清理和重建以查看错误是否消失并且确实消失了。然后我取消了我认为不好的源代码的注释并再次构建了项目，并且对新视图的调用成功。我删除了出现在文件所有者上的同名方法（收到的操作）。我执行了清理和重建以查看错误是否消失并且确实消失了。然后我取消了我认为不好的源代码的注释并再次构建了项目，并且对新视图的调用成功。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-13T12:39:08.533

我将用相同的错误代码分享我的经验。将对象分配给错误的目标可能会出错。例如，如果您有一些 UILabel 属性并且您不小心将字符串常量直接分配给了 self.myUILabelProperty = @"ups" 那么您的属性将成为 NSString 类型的对象，而不是 UILabel，因此您失去了所有 UILabel 方法。在该错误之后，如果您尝试在代码中对属性使用 UIlabel 方法，您将收到此错误消息。

# objective-c - 如何在 Objective-C 中创建实例变量

> ID：622874
> 
> 赞同：4
> 
> 时间：2009-03-08T01:33:50.510
> 
> 标签：objective-c

我有这个例子，我想让 my_Picture 成为一个实例变量，以便使用 removeFromView。有任何想法吗？尝试不同的方法时，我收到了各种警告和错误。先感谢您

```
- (void) viewDidLoad
{
   UIImageView *my_Picture = [[UIImageView alloc] initWithImage: myImageRef];
   [self.view addSubview:my_Picture];
   [my_Picture release];

   [super viewDidLoad];
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-08T01:46:58.030

要使其成为实例变量，您可以将值存储在您的类中，而不是作为临时变量。当您的类被销毁而不是在将其添加为子视图之后，您还将释放它。

例如

```
// header file (.h)
@interface MyController : UIViewController
{
  UIImageView* myPicture;
}
@end

// source file (.m)
- (void) viewDidLoad
{
   myPicture = [[UIImageView alloc] initWithImage: myImageRef];
   [self.view addSubview:myPicture];

   [super viewDidLoad];
}

- (void) dealloc
{
   [myPicture release];
   [super dealloc];
} 
```

# ruby-on-rails - Ruby on Rails：如何存储表单数据

> ID：622879
> 
> 赞同：1
> 
> 时间：2009-03-08T01:36:40.783
> 
> 标签：ruby-on-rails, ruby, forms

我有一个将值存储为 2 个字符的状态字段。例如，阿拉巴马州保存为 AL，阿拉斯加州保存为 AK，亚利桑那州保存为 AZ 等。在 show.html.erb 中，如何显示阿拉巴马州等州的长名称，而不是只显示 AL？这可能吗，还是我应该将长名称存储在数据库中，例如阿拉巴马州、阿拉斯加州、亚利桑那州等？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-08T01:42:12.627

编写一个方法，输出一个状态的长名称并调用它`show.html.erb`

`some_model.rb`：

```
SomeModel < ActiveRecord::Base
  STATE_CODES = {
    "AL": "Alabama", "AK": "Alaska",
    # add remaining 50
  }
  def state_human_name
    STATE_CODES[self.state]
  end 
```

`show.html.erb`：

```
<%= record.state_human_name %> 
```

**编辑：**在数据库中存储状态的全名没有帮助——至少在某个地方需要短格式，因此无论如何都需要在短格式和长格式之间添加映射。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T09:54:56.280

是否有理由使用 2 个字母代码（例如旧数据库）？如果不是，我会坚持通常的 ActiveRecord 习语，并有一个由 id 链接的单独“状态”表。如果您需要 2 个字母代码用于显示、打印地址标签或其他任何内容，则将“state_code”属性添加到 states 表，但不要将其用作主键。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T17:36:41.030

我把它放在评论中，但我认为它足够不同，值得回答。

当您决定将州地图保存在哪里时，请考虑您是否需要将物品运送到加拿大或更远的地方。如果是这样，那么值得努力建立一个与国家表相关联的州表。

无论如何，如果您的数据很少更改，那么将其放入数据库中就不太容易出现问题，因为代码更改的频率要高得多。更频繁的更改 = 更多搞砸的机会。此外，按照您的喜好进行排序也很简单。

```
class State < ActiveRecord::Base
  def self.get_states
    @@states || State.find(:all, 
                           :include => :country, 
                           :order => 'countries.name, long_name')
  end
end 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T02:30:02.287

Tilendor，我注意到如果我使用 STATE_CODES.invert，下拉菜单选择会乱序。例如，我的选项列表的前五行如下所示：

新罕布什尔州俄亥俄州科罗拉多州明尼苏达州阿拉巴马州...

在我的 STATES_CODES 哈希中，我按以下顺序列出了以下内容：

"AL" => "阿拉巴马", "AK" => "阿拉斯加", "AZ" => "亚利桑那", "AR" => "阿肯色", "CA" => "加利福尼亚", ...

有没有办法让表单中列出的选项与 STATES_CODES 的顺序相同？也许按字母顺序排序？

# c# - C# 3.0 中的命名/可选参数？

> ID：622880
> 
> 赞同：2
> 
> 时间：2009-03-08T01:42:01.550
> 
> 标签：c#, c#-3.0, c#-4.0

有没有办法像在 C# 4.0 中那样向 C# 3.0 添加可选参数？我必须有这个功能，我等不及了！

**编辑：**

如果您知道实现此目的的解决方法/技巧，请将其发布。谢谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-08T02:12:42.570

您可以使用匿名类型和反射作为命名参数的解决方法：

```
public void Foo<T>(T parameters)
{
    var dict = typeof(T).GetProperties()
        .ToDictionary(p => p.Name, 
            p => p.GetValue(parameters, null));

    if (dict.ContainsKey("Message"))
    {
        Console.WriteLine(dict["Message"]);
    }
} 
```

所以现在我可以这样调用 Foo ：

```
Foo(new { Message = "Hello World" }); 
```

...它会写下我的信息。

基本上，我从传递的匿名类型中提取所有属性，并将它们转换为字符串和对象的字典（属性的名称及其值）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-08T01:45:00.747

总是有方法重载。:)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-08T01:44:01.733

很不幸的是，不行。您将需要 C# 4.0 编译器来支持这一点。如果您今天想要.NET 平台上的可选参数，您可以尝试VB .NET 或F#。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-08T01:52:45.050

正如 Dustin 所说，可选参数将出现在 C# 4.0 中。一种模拟可选参数的糟糕方法是将 object[] （或更强类型的数组）作为最后一个参数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-08T01:57:48.300

也可以使用可变参数作为选项参数。其工作方式的一个示例是 string.Format()。

看这里：

[http://blogs.msdn.com/csharpfaq/archive/2004/05/13/131493.aspx](http://blogs.msdn.com/csharpfaq/archive/2004/05/13/131493.aspx)

# c - 为什么只有 2 个线程处于活动状态时 pthread_create() 会失败？

> ID：622890
> 
> 赞同：7
> 
> 时间：2009-03-08T02:09:30.080
> 
> 标签：c, multithreading, pthreads

我在第一次尝试 C 中的线程时遇到了一些麻烦。我正在尝试（现在）编写一个非常简单的服务器程序，该程序接受套接字连接并启动一个新线程来处理它。它似乎工作正常，只是它只会在 pthread_create() 使用 EAGAIN 代码失败之前创建大约 300 个线程（303，有时是 304），这意味着：

“系统缺乏创建另一个线程所需的资源，否则将超过系统对进程 {PTHREAD_THREADS_MAX} 中的线程总数施加的限制。”

这*不是同时*303 个线程 - 每个线程都退出，这是由 gdb 确认的。每次调用进程请求函数时，都会有两个线程在运行。

所以这意味着“系统缺乏必要的资源”。我的问题是（可能有点愚蠢）——这些资源是什么？大概这是我的程序中的内存泄漏（当然可能，甚至可能），但我认为即便如此，考虑到程序的其余部分几乎没有什么，它也可以管理超过 300 个。

如何找出我的程序有多少内存可用以确认它已用完？有足够的内存和免费交换，所以大概是操作系统（Linux）施加的人为限制。

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-08T02:16:04.793

如果您没有使用该属性创建线程[`PTHREAD_CREATE_DETACHED`](http://www.opengroup.org/onlinepubs/000095399/functions/pthread_attr_setdetachstate.html)（或使用 分离它们[`pthread_detach()`](http://www.opengroup.org/onlinepubs/000095399/functions/pthread_detach.html)，您可能需要[`pthread_join()`](http://www.opengroup.org/onlinepubs/000095399/functions/pthread_join.html)在每个创建的线程退出后调用它以释放与其关联的资源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T02:14:11.693

可能有点矫枉过正（？），但[Valgrind](http://valgrind.org/)可以帮助您在 Linux 中定位 memleaks。

您能否发布一些代码片段？最好是分配/释放内存/套接字以及创建线程的部分。

# css - 如何停止 Richfaces 向面板和日历添加边框？

> ID：622891
> 
> 赞同：9
> 
> 时间：2009-03-08T02:09:33.200
> 
> 标签：css, jsf, richfaces, border, skins

我希望使用自定义的 Richfaces 皮肤来处理我的大部分演示工作。不幸的是，richfaces 会在日历组件中的每个单元格和每个面板周围呈现边框。我想将它们关闭，以便当天数字站点在一个没有边界的开放网格中。没有明显的方法可以使用日历控件的外观或属性来做到这一点。

我可以使用自定义 CSS，但**我更喜欢使用框架从 Richfaces 创建的样式表中完全删除与边框相关的属性，**而不是针对框架工作并使用丑陋的 CSS 覆盖所有内容。

那么如何阻止richfaces 向面板和日历添加边框呢？

* * *

这个人也有[类似的问题](http://www-02.imixs.com:8081/roller/ralphsjavablog/entry/richfaces_background_for_input_fields)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-09T22:25:37.403

从 3.3.0.GA 版本开始，无法要求 Richfaces 停止为边框和背景渲染 CSS。有必要覆盖内置样式表中的每个属性（包含在 org.richfaces.renderkit.html.css 中的那些，它是richfaces-ui-3.3.0.GA.jar 的一部分）。

[Plug and skin](http://www.jboss.org/file-access/default/members/jbossrichfaces/freezone/docs/devguide/en/html/ArchitectureOverview.html#PlugnSkin)为您提供了执行此操作的必要功能，就像使用常用技术添加的自定义 CSS 一样，尽管 plug and skin 可以说更好，因为您可以参考抽象颜色定义来弥补缺失的背景，如下所示：

```
<u:style name="color" skin="abstractColorName" /> 
```

以下 CSS 属性可用于快速中和边框和背景相关属性。

```
border: none;
background: transparent; 
```

要开始使用插件和皮肤，您可以使用以下 Maven2 命令序列：

```
mvn archetype:generate -DarchetypeGroupId=org.richfaces.cdk -DarchetypeArtifactId=maven-archetype-plug-n-skin -DarchetypeVersion=3.3.0.GA -DartifactId=fil-skins -Dpackage=com.feelitlive.richfaces -DgroupId=com.feelitlive.server -Dversion=0.0.1-SNAPSHOT -DarchetypeRepository=http://repository.jboss.com/maven2/
cd fil-skins
mvn cdk:add-skin -Dname=fil -Dpackage=com.feelitlive.richfaces.skins 
```

这最好从命令行完成，因为不幸的是 Eclipse 插件无法在 jboss 存储库中找到原型（其他 IDE 可能会更好地处理它）。您需要更改 artifactId、groupId、包、版本和名称属性以适合您的项目。选择反映工件范围的工件和包名称以保存多个皮肤定义。

* * *

有可能 - 尽管需要做很多工作 - 以通用格式 xxxBackgroundEnabled 和 xxxBorderEnabled 添加对皮肤属性的支持，以逐个关闭这些边框和背景 CSS 的呈现。

您需要与richfaces 团队合作修补org.richfaces.renderkit.html.css 中的xcss 文件。您还需要某个 XCSS JSF 标记库中的某种条件输出功能（在 XCSS 文件中由 http:/jsf.exadel.com/template/util 或 http:/jsf.exadel.com/template 标识）我预计用它来包装 XCSS 文件中的 CSS 属性组。

如果您对 Richfaces 进行了这样的修改，那么您将能够从任何皮肤的属性文件中禁用有争议的 CSS 的呈现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-11-24T09:59:05.893

有一种皮肤叫它`plain`几乎没有任何样式。

这是[文档的摘录](http://docs.jboss.org/richfaces/latest_3_3_X/en/devguide/html/ArchitectureOverview.html#SkinParametersTablesInRichFaces)：

> 皮肤“普通”是从 3.0.2 版本添加的。它没有任何参数。有必要将 RichFaces 组件嵌入到具有自己样式的现有项目中。

您可以通过添加来激活它

```
<context-param>
    <param-name>org.richfaces.SKIN</param-name>
    <param-value>plain</param-value>
</context-param> 
```

到`web.xml`.

* * *

您还可以阻止 RichFaces 加载任何样式

```
<context-param>
     <param-name>org.richfaces.LoadStyleStrategy</param-name>
     <param-value>None</param-value>
</context-param> 
```

设置在`web.xml`.

但要小心，因为它[在 JBoss Portlet Bridge 1.0.0 中不起作用](https://issues.jboss.org/browse/PBR-63)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T13:52:34.873

RichFaces 有一个内置的皮肤系统，称为 Skinnablity。Skinnability 是标准 CSS 的高级扩展。您可以创建自己的皮肤文件以在您的应用程序中使用（[jboss 文档](http://www.jboss.org/file-access/default/members/jbossrichfaces/freezone/docs/devguide/en/html/ArchitectureOverview.html#CreatingAndUsingYourOwnSkinFile)）。

在richfaces-impl jar 中，文件夹/META-INF/skins 包含所有皮肤文件（.skin.properties）。复制一个并重命名它，修改你想要的。您将不得不重建 jar。

或者

您可以使用richfaces 的[plug-n-skin](http://www.jboss.org/file-access/default/members/jbossrichfaces/freezone/docs/devguide/en/html/ArchitectureOverview.html#PlugnSkin)功能，这是我以前从未尝试过的，但看起来它也适用于您正在尝试做的事情。

# php - 放弃 PHP 中的长进程（但让它们完成）

> ID：622892
> 
> 赞同：4
> 
> 时间：2009-03-08T02:10:25.493
> 
> 标签：php, scripting

我有一个 HTML 表单，它提交到启动脚本的 PHP 页面。该脚本可能需要 3 秒到 30 秒的时间来运行 - 用户无需在附近即可完成此脚本。

是否可以启动一个 PHP 脚本，立即向用户（或其他）打印“谢谢”，并让他们在您的脚本继续工作时继续他们的快乐方式？

在我的特殊情况下，我将表单数据发送到一个 php 脚本，然后将数据发布到许多其他位置。目前，等待所有帖子都成功并不符合我的兴趣。我只想让脚本运行，允许用户去做他们喜欢做的任何事情，就是这样。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T02:32:16.720

例如，将您的长期工作放在另一个 php 脚本中

背景.php：

```
sleep(10);
file_put_contents('foo.txt',mktime()); 
```

前台.php

```
$unused_but_required = array();
proc_close(proc_open ("php background.php &", array(), $unused_but_required));
echo("Done); 
```

您会立即看到“完成”，并且文件将在 10 秒后写入。

我认为 proc_close 有效，因为我们没有给 proc_open 提供管道，也没有文件描述符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-08T09:28:01.087

在脚本中，您可以设置：

```
<?php
 ignore_user_abort(true); 
```

这样，当用户离开页面时，脚本不会终止。但是在结合这个时要非常小心

```
 set_time_limit(0); 
```

从那时起，脚本可以永远执行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T13:48:46.750

您可以使用`set_time_limit`and `ignore_user_abort`，但一般来说，我建议您将作业放入队列并使用异步脚本来处理它。这是一个更简单耐用的设计。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T03:01:31.297

您可以尝试[`flush`](http://us3.php.net/manual/en/function.flush.php)和相关的输出缓冲区功能立即将缓冲区中的任何内容发送到浏览器：

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-08T13:50:44.450

pcntl_fork() 周围有一个名为[php_fork](http://www.phpclasses.org/browse/package/1136.html)的 API 包装器。

而且，这个问题出现在[Daily WTF](http://thedailywtf.com/Articles/Multithreaded-PHP-.aspx)上……不要用玻璃瓶敲钉子。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T02:25:11.213

我结束了以下。

```
<?php

  // Ignore User-Requests to Abort
  ignore_user_abort(true);
  // Maximum Execution Time In Seconds
  set_time_limit(30);

  header("Content-Length: 0");
  flush();

  /*

    Loooooooong process

  */

?> 
```

# silverlight - 如何确定 SelectionChangedEvent 的来源

> ID：622893
> 
> 赞同：0
> 
> 时间：2009-03-08T02:12:02.883
> 
> 标签：silverlight

我有一个关于 silverlight 中的 ComboBox 的问题，它是选定的项目。

我想确定是什么触发了 SelectionChangedEvent，是用户在列表中选择新项目还是以编程方式设置？

虽然理想情况下我想使用 CommandPattern 来解决这个问题（我基本上使用的是修改后的 RelayCommand（[http://joshsmithonwpf.wordpress.com/2008/11/17/emulating-icommandsource-in-silverlight-2/](http://joshsmithonwpf.wordpress.com/2008/11/17/emulating-icommandsource-in-silverlight-2/)）。我是接受其他建议。

我也玩过 SelectionChangedEventArgs，它有一个 OriginalSource 属性，在第一次检查时它可能看起来有帮助，但是它是空的（不管选择项目的方式如何。）

除了设置内部标志之外，还有什么想法吗？:)

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-06T17:26:06.640

不幸的是，这是一件很难确定的事情，因为框架很难在这种情况下简单地冒泡任何更改或用户事件，因为选择更改事件。

如果你真的需要，你可以编写一个简单的 ComboBoxWrapper，它实际上就是你正在谈论的标志 - 所以你可以从 ComboBox 派生，尝试覆盖或隐藏 SelectedItem 的 CLR 设置器，然后以这种方式保持状态。

这里使用的任何特定场景？可能有另一种方法来解决问题。

# c# - 如何使用 Silverlight GET HttpWebRequest 设置标头？

> ID：622897
> 
> 赞同：3
> 
> 时间：2009-03-08T02:14:34.420
> 
> 标签：c#, .net, silverlight, httpwebrequest

只要我不向请求中添加任何标头，使用 HttpWebRequest 向 Silverlight 中的 RESTful 服务发出请求就可以正常工作。

一旦我使用这样的代码添加标题

```
var webReq = (HttpWebRequest)WebRequest.Create(new Uri(_RemoteAddress, "GetProviderMetadata"));
webReq.Method = HttpMethodType.Get;
webReq.Headers["SomeToken"] = "someTokenValue"; 
```

一旦`EndGetResponse()`被调用，我就会将异常粘贴在这个问题的底部。有谁知道这是为什么？添加标头以获取请求似乎在正常的.NET 中工作正常，所以我猜这是某种 Silverlight 限制，但我找不到任何澄清的文档。

```
 {System.NotSupportedException ---> System.NotSupportedException: Specified method is not supported.
  at System.Net.BrowserHttpWebRequest.InternalEndGetResponse(IAsyncResult asyncResult)
  at System.Net.BrowserHttpWebRequest.<>c__DisplayClass5.<EndGetResponse>b__4(Object sendState)
  at System.Net.AsyncHelper.<>c__DisplayClass2.<BeginOnUI>b__0(Object sendState)
  --- End of inner exception stack trace ---
  at System.Net.AsyncHelper.BeginOnUI(SendOrPostCallback beginMethod, Object state)
  at System.Net.BrowserHttpWebRequest.EndGetResponse(IAsyncResult asyncResult)
  at System.Net.BrowserHttpWebRequest.<>c__DisplayClassd.<InvokeGetResponseCallback>b__b(Object state2)
  at System.Threading._ThreadPoolWaitCallback.WaitCallback_Context(Object state)
  at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
  at System.Threading._ThreadPoolWaitCallback.PerformWaitCallbackInternal(_ThreadPoolWaitCallback tpWaitCallBack)
  at System.Threading._ThreadPoolWaitCallback.PerformWaitCallback(Object state)}
   [System.NotSupportedException]: {System.NotSupportedException ---> System.NotSupportedException: Specified method is not supported.
  at System.Net.BrowserHttpWebRequest.InternalEndGetResponse(IAsyncResult asyncResult)
  at System.Net.BrowserHttpWebRequest.<>c__DisplayClass5.<EndGetResponse>b__4(Object sendState)
  at System.Net.AsyncHelper.<>c__DisplayClass2.<BeginOnUI>b__0(Object sendState)
  --- End of inner exception stack trace ---
  at System.Net.AsyncHelper.BeginOnUI(SendOrPostCallback beginMethod, Object state)
  at System.Net.BrowserHttpWebRequest.EndGetResponse(IAsyncResult asyncResult)
  at System.Net.BrowserHttpWebRequest.<>c__DisplayClassd.<InvokeGetResponseCallback>b__b(Object state2)
  at System.Threading._ThreadPoolWaitCallback.WaitCallback_Context(Object state)
  at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
  at System.Threading._ThreadPoolWaitCallback.PerformWaitCallbackInternal(_ThreadPoolWaitCallback tpWaitCallBack)
  at System.Threading._ThreadPoolWaitCallback.PerformWaitCallback(Object state)}
   _className: "System.NotSupportedException"
   _data: {System.Collections.ListDictionaryInternal}
   _dynamicMethods: null
   _exceptionMethod: null
   _exceptionMethodString: null
   _helpURL: null
   _HResult: -2146233067
   _innerException: {System.NotSupportedException: Specified method is not supported.
  at System.Net.BrowserHttpWebRequest.InternalEndGetResponse(IAsyncResult asyncResult)
  at System.Net.BrowserHttpWebRequest.<>c__DisplayClass5.<EndGetResponse>b__4(Object sendState)
  at System.Net.AsyncHelper.<>c__DisplayClass2.<BeginOnUI>b__0(Object sendState)}
   _message: ""
   _remoteStackIndex: 0
   _remoteStackTraceString: null
   _source: "System.Windows"
   _stackTrace: {sbyte[192]}
   _stackTraceString: null
   _xcode: -532462766
   _xptrs: 0
   Data: {System.Collections.ListDictionaryInternal}
   HelpLink: null
   HResult: -2146233067
   InnerException: {System.NotSupportedException: Specified method is not supported.
  at System.Net.BrowserHttpWebRequest.InternalEndGetResponse(IAsyncResult asyncResult)
  at System.Net.BrowserHttpWebRequest.<>c__DisplayClass5.<EndGetResponse>b__4(Object sendState)
  at System.Net.AsyncHelper.<>c__DisplayClass2.<BeginOnUI>b__0(Object sendState)}
   Message: ""
   Source: "System.Windows"
   StackTrace: "   at System.Net.AsyncHelper.BeginOnUI(SendOrPostCallback beginMethod, Object state)\r\n   at System.Net.BrowserHttpWebRequest.EndGetResponse(IAsyncResult asyncResult)\r\n   at Intellidimension.RdfEntity.Service.RemoteEntityServiceProviderClient.getProviderMetadataResponse(IAsyncResult result)\r\n   at System.Net.BrowserHttpWebRequest.<>c__DisplayClassd.<InvokeGetResponseCallback>b__b(Object state2)\r\n   at System.Threading._ThreadPoolWaitCallback.WaitCallback_Context(Object state)\r\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading._ThreadPoolWaitCallback.PerformWaitCallbackInternal(_ThreadPoolWaitCallback tpWaitCallBack)\r\n   at System.Threading._ThreadPoolWaitCallback.PerformWaitCallback(Object state)"
   System.Runtime.InteropServices._Exception.HelpLink: null
   System.Runtime.InteropServices._Exception.Source: "System.Windows" 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-01-27T04:05:31.213

在调用您发起 WebRequest 之前指定[“客户端 HTTP”处理。](http://msdn.microsoft.com/en-us/library/dd920295%28v=vs.95%29.aspx)

像这样：

```
bool httpResult = WebRequest.RegisterPrefix("http://", WebRequestCreator.ClientHttp);
bool httpsResult = WebRequest.RegisterPrefix("https://", WebRequestCreator.ClientHttp); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T07:42:39.327

Silverlight 仅支持使用 POST 方法而不是 GET 方法设置标头。这是由于在 Silverlight 中实现 TCP/IP 堆栈的方式存在限制。它使用浏览器扩展 API，而不是直接针对主机操作系统的 API。

# c# - C# 哈希

> ID：622900
> 
> 赞同：7
> 
> 时间：2009-03-08T02:17:15.787
> 
> 标签：c#, hash

我是 C# 新手

> 1.  我如何使用 C# 对文件进行哈希处理
> 2.  有什么可用的？（md5、crc、sha1 等）
> 3.  是否有我应该继承的接口？

基本上我想校验多个文件并将其存储在一个数据库中，同时使用我自己的两个校验和/哈希。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-08T02:28:29.753

> 1.) 我如何用 C# 散列文件？

您可以利用*[System.Security.Cryptography下的 .NET 类](http://msdn.microsoft.com/en-us/library/system.security.cryptography.aspx)*

> 2.) 有什么可用的？

*   [KeyedHash算法](http://msdn.microsoft.com/en-us/library/system.security.cryptography.keyedhashalgorithm.aspx)
*   [MD5](http://msdn.microsoft.com/en-us/library/system.security.cryptography.md5.aspx)
*   [RIPEMD160](http://msdn.microsoft.com/en-us/library/system.security.cryptography.ripemd160.aspx)
*   [SHA1](http://msdn.microsoft.com/en-us/library/system.security.cryptography.sha1.aspx)
*   [SHA256](http://msdn.microsoft.com/en-us/library/system.security.cryptography.sha256.aspx)
*   [SHA3​​84](http://msdn.microsoft.com/en-us/library/system.security.cryptography.sha384.aspx)
*   [SHA512](http://msdn.microsoft.com/en-us/library/system.security.cryptography.sha512.aspx)

> 3.) 我应该继承一个接口吗？

不，你不必。看看[HashAlgorithm.Create(...)](http://msdn.microsoft.com/en-us/library/wet69s13.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-08T02:30:22.527

片段

```
byte[] result; 
SHA1 sha = new SHA1CryptoServiceProvider(); 
using(FileStream fs = File.OpenRead(@"file.txt"))
{
   result = sha.ComputeHash(fs);
} 
```

另请参阅[SHA1CryptoServiceProvider](http://msdn.microsoft.com/en-us/library/system.security.cryptography.sha1cryptoserviceprovider.aspx)或[MD5CryptoServiceProvider](http://msdn.microsoft.com/en-us/library/system.security.cryptography.md5cryptoserviceprovider.aspx)。

CRC 不可用 - 创建自己的更有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-08T02:30:50.683

你想用哈希实现什么？如果您试图真正保证没有人恶意更改文件，*请*不要实现自己的校验和或哈希。您可能会犯一些错误，有人将能够篡改文件并且校验和仍然匹配。使用良好的散列函数，如 SHA-256。

# linux - 限制 OpenSSH 只允许上传到某些目录

> ID：622903
> 
> 赞同：0
> 
> 时间：2009-03-08T02:19:04.130
> 
> 标签：linux, ssh, backup, sysadmin, openssh

我需要从多台服务器运行备份到另一台服务器上的单个帐户。如果其中一台公共服务器受到威胁，我不希望备份帐户上的另一台服务器的文件受到损害。

我需要做的只是根据传入连接的 ssh 密钥允许 SCP 进入特定目录。

我知道我可以在authorized_keys 文件中设置shell 和每个密钥的几个选项。[http://www.manpagez.com/man/8/sshd/](http://www.manpagez.com/man/8/sshd/)（向下滚动到“AuthorizedKeysFile”）

我不知道如何将 internal-sftp 命令设置为仅使用某个目录。我的机器上没有root，所以我不能做正常的internal-sftp + chroot。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T02:42:52.497

它不是那样工作的。

您需要做的是为每个备份主机设置一个迷你 chroot 监狱。它只需要能够运行 sh 和 scp（/dev 只需要 /dev/null 条目）。

使用 jailsh 作为每个帐户的登录 shell。

Jailsh 是一个 suid-root 登录 shell，它将 chroot jail 设置为由两个连续斜杠标记的目录，删除 root privs，并执行 /bin/sh。

# javascript - 如何使用 JavaScript 在 Web 服务器上获取文件？

> ID：622904
> 
> 赞同：0
> 
> 时间：2009-03-08T02:21:03.423
> 
> 标签：javascript

我正在尝试编写一个可以从浏览器中使用的小型文档工具。它需要从 Web 服务器获取源代码文件。从 JavaScript 本身获取文件然后读取它们以便解析它们的适当方法是什么？要获取的文件位于不同的 Web 服务器上。

在此先感谢，维维基安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T02:30:46.380

1.  使用某种 ajax 框架（或 XmlHttpRequest）来读取文件、解析并显示它。
2.  您必须为该其他服务器创建代理。否则你会遇到安全异常。

给定您的主要网址[http://www.x.com/help.html](http://www.x.com/help.html)和位于[http://www.x321.com/src/](http://www.x321.com/src/)的源文件，您将在[http 上创建一个代理： //www.x.com/proxy/](http://www.x.com/proxy/)到[http://www.x321.com/src/](http://www.x321.com/src/)

# javascript - 是否可以使用闭包模拟 Javascript 中的常量？

> ID：622906
> 
> 赞同：0
> 
> 时间：2009-03-08T02:23:45.430
> 
> 标签：javascript, closures, constants

是否可以使用闭包模拟 Javascript 中的常量？如果是这样，你能给我举个例子吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-08T02:46:06.733

Firefox 和 Chrome 都支持[`const`](https://developer.mozilla.org/en/Core%5FJavaScript%5F1.5%5FGuide/Constants)关键字。IE 没有。所以如果你需要常量而不需要支持 IE，`const`这不是一个糟糕的选择。但请记住，当将值分配给`const`;时，两种浏览器都不会产生运行时错误。值只是保持不变。

否则，您必须使用函数来定义无法修改的常量：

```
function PI() { return 3.14159; }

var area = radius*radius * PI(); 
```

当然，您可以只编写从不修改某些变量的代码，并可能为这些变量建立一个命名方案，以便您认识到它们永远不需要修改......

```
// note to self: never assign values to variables utilizing all-uppercase name
var PI = 3.14159; 
```

“模拟”常量的另一个选择是使用某些浏览器中可用的[属性定义功能](http://ejohn.org/blog/javascript-getters-and-setters/)来定义对象的只读属性。当然，由于支持属性定义的浏览器不包括 IE，这并没有真正的帮助……（请注意，IE **8**确实支持属性定义[……](http://msdn.microsoft.com/en-us/library/dd229916.aspx)但不支持 JavaScript 对象）

最后，在*非常*人为的场景中，您可能会使用函数参数作为常量（也许这就是您在建议闭包时所考虑的？）。虽然它们表现为变量，但它们的作用域仍然限于定义它们的函数，因此不能影响在它们被修改的函数之外具有相同名称的变量所持有的值：

```
var blah = 3;
var naw = "nope";
(function(blah, naw)
{
  blah = 2;
  naw = "yeah";
  alert(naw + blah); // "yeah2"
})(blah, naw);

alert(naw + blah); // "nope3" 
```

请注意，[jQuery 插件通常使用](http://docs.jquery.com/Plugins/Authoring#Custom_Alias)与此类似的东西，但出于相反的原因：jQuery 代码通常使用`$`简写来引用 jQuery 对象，但该库旨在继续工作，即使其他一些代码重新定义了该符号; 通过将库和插件代码包装在带有`$`参数的匿名函数中，然后作为参数传入，代码与其他库可能对稍后`jQuery`的值所做的更改隔离开来。`$`

* * *

### 另请参阅：[Javascript 中有常量吗？](https://stackoverflow.com/questions/130396/are-there-constants-in-javascript)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T02:39:26.000

[您可以使用const 关键字](https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Constants)（[在 JavaScript 1.5 中实现](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Statements/const)）创建只读的命名常量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-09T01:41:58.673

这是据我所知：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <script type="text/javascript">
            function Scope()
            {
                return function()
                {
                    return {Constant: 1}; //Object literal
                };
            }
            var Scope = Scope();
        </script>
    </head>
    <body>
        <script type="text/javascript">
            document.write(Scope().Constant + "<br />");

            //The following line of code has no effect and fails silently.
            Scope().Constant = 6;

            document.write(Scope().Constant + "<br />");
        </script>
    </body>
</html> 
```

这种方法允许我通过扩展对象字面量来扩展范围以拥有多个常量成员变量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-10-29T11:37:54.827

**声明 ：**

```
function globals(){
    const x1="something";
    const x2="otherthing";

    return{
      getX1=function(){
        return x1;
      },
      getX2=function(){
        return x2;
      }
    }
 }

var globalConstants=globals(); 
```

**访问：**

```
globalConstants.getX1(); 
```

# html - 使用 CSS 根据标题设置 HTML 元素样式

> ID：622915
> 
> 赞同：16
> 
> 时间：2009-03-08T02:34:23.517
> 
> 标签：html, css

是否可以仅使用其标题作为唯一标识符将样式应用于 HTML 元素？例如：

```
<div class="my_class">
    <a href="some site" title="MyTitle">My Link</a>
</div> 
```

我想编写一个规则，该规则仅适用于 my_class 类的 div 和链接标题 MyTitle 中的链接元素。

我无法更改页面布局，但是，我可以使用自动包含的自定义 CSS 文件。

谢谢

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-08T02:39:05.143

可以肯定的是，使用所谓的*属性选择器*；这些是 CSS2 的一部分。在您的特定情况下，您将使用：

```
div.my_class a[title="MyTitle"] { color: red; } 
```

您可以在此处阅读有关属性选择器的更多信息：http: [//www.w3.org/TR/CSS2/selector.html#attribute-selectors](http://www.w3.org/TR/CSS2/selector.html#attribute-selectors)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T02:39:37.450

是的你可以：

[http://www.w3.org/TR/CSS2/selector.html#attribute-selectors](http://www.w3.org/TR/CSS2/selector.html#attribute-selectors)

你会说 A[title="MyTitle] 我相信。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-08T02:40:19.617

您正在寻找的是 css 属性选择器：

[http://www.w3.org/TR/CSS2/selector.html#attribute-selectors](http://www.w3.org/TR/CSS2/selector.html#attribute-selectors)

一个标题] { ... }

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-08T02:42:01.687

CSS 规范确定了许多“选择器”，可以在这里为您提供帮助。例如，您可以应用如下规则：

```
.my_class a[title="MyTitle"]
{
   ...
} 
```

您可以在此处查看 CSS“选择器”的详细规范：

[http://www.w3.org/TR/2001/CR-css3-selectors-20011113/](http://www.w3.org/TR/2001/CR-css3-selectors-20011113/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-09T09:38:51.117

尽管有可能，但使用属性选择器（参见[http://www.w3.org/TR/CSS2/selector.html#attribute-selectors](http://www.w3.org/TR/CSS2/selector.html#attribute-selectors)） Internet Explorer 6 不支持它（参见[http://kimblim.dk/css -测试/选择器/](http://kimblim.dk/css-tests/selectors/)）

来自 W3C 站点的示例：H1[title] { color: blue; }

# php - 学习网络语言

> ID：622917
> 
> 赞同：2
> 
> 时间：2009-03-08T02:38:15.380
> 
> 标签：php, ruby-on-rails, django, choice

我想知道其他人在创建 Web 服务应用程序方面有什么经验，什么语言/框架最适合初学者？所选择的语言是否具有使其更适合具有某种思维方式的程序员的特性，从而使语言 XYZ 更能吸引特定的程序员？

我正在考虑学习 php、Ruby（可能是 RoR）或 Python（使用 Django）。我所做的每一次搜索都会有一个人说一个人有多棒，然后另一个人会抨击它，我不明白为什么一种特定的语言会吸引特定的用户并且更适合使用的选择，或者其中一个特定的选择会吸引给定的任务，例如与 MySQL 数据库通信或易于长期维护应用程序。

有没有人对此提出意见而没有将其变成辩论？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-08T02:42:21.390

我不得不说PHP。到处都支持它，有太多难以计数的框架，并且有太多的文档供初学者和专家使用，您可能会沉迷其中！除了一些错误之外，所有这些 PHP 是一个非常好的语言，拥有一个庞大的库。我肯定会尝试所有这些，但你最终可能最终还是会使用 PHP。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-08T02:55:25.150

对于自主学习，PHP 实际上是很难被击败的。从某种意义上说，这种语言是灵活而严谨的，这是宽容的。该库易于学习，甚至更易于搜索。能够混合代码和标记也可以加速学习。

但从长远来看，PHP 并没有太多其他的东西可以提供。Java、Python、C# 都提供了更好的设计语言和更一致的库，但代价是抽象层数稍多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T03:02:35.960

[PHP](http://php.net)非常简单，您可以使用[WAMP](http://www.wampserver.com)包或构建自己的[LAMP](http://lamphowto.com/)工具包来开始学习。

我也会试一试[Python](http://wiki.python.org/moin/WebProgramming)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-08T03:00:33.763

很难提出建议，因为每种选择都有利弊。我个人会选择 PHP 或 Perl，原因如下：

*   易于安装：让这些语言与 Apache 一起工作比大多数其他选项要容易得多。

*   支持的广度：几乎每个 unix 网络托管服务都提供 php 和 perl（通过 mod-perl 或 cgi）。

*   文档：这两种语言都有完整的文档记录，并有很好的支持。

*   库：例如，MySql 集成非常简单且非常成熟。Perl 尤其具有 CPAN，它是适用于任何语言的最广泛的库之一。

*   社区：找到愿意帮助解决特定问题的人并不难。

*   尤其是 Perl，对于系统管理也非常有用。因此，如果您学习它是为了 Web 开发，那么其中一些知识应该会延续到其他领域。Ruby 也是如此，但在 Web 开发之外很少有 PHP 应用程序。

不过也有批评者：

*   凌乱的语法：是的，它们的语法很丑陋，有时甚至不一致。

*   对面向对象编程的支持不佳：如果您正在寻找这样的东西，那么 Ruby 可能是一个更好的选择。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-08T09:10:29.977

For starting out, PHP. The documentation for PHP is, honestly, top notch- and you learn the language and the fundamentals of web development side-by-side (Whereas, with, say, Ruby, or Python, you have to learn the framework *and* the language.)

[php.net](http://php.net) is a learning resource par excellence, with a complete library, manuals, and tutorials- all of which are commented on by a peanut gallery of developers who provide sample code and important gotchas. Find PHP's manual here: [http://www.php.net/manual/en/](http://www.php.net/manual/en/)

Once you've nailed the basics of PHP development, though, you have to *move on*. Step up to Django, or Ruby on Rails. These frameworks are jam-packed with nigh-mandatory features that seem frustrating to learn at first, but eventually make your life as a developer much easier. Templates, the MVC pattern, database migrations, ORMs, the works. The best part is that, when you return to the wild and wooly world of PHP, all of the concepts you've learned from your framework of choice can be replicated in PHP.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-08T02:54:31.253

我不得不说 Perl 是一个很好的起点。它拥有与 PHP 一样多的框架、同样多的支持，并且拥有同样多甚至更多的库可供使用。诸如 Catalyst 或 CGI::Application 之类的 MVC 框架或诸如 Mason 或 Template Toolkit 之类的模板系统使构建高度可扩展的 Web 应用程序成为可能。PHP 可能会更好，因为它的加载和运行特性。但我喜欢 Perl 的性能和广泛的可用性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-08T03:16:52.947

我会选择 Perl 作为第一步，更准确地说是 CGI.pm。它的最大优点是它不会掩盖您的网页和代码之间的通信。这意味着您将真正了解正在发生的事情。CGI.pm 文档很棒，对于简单的项目，您可能不想做任何没有涵盖的事情。

一旦您了解了您实际在做什么，您就可以（并且应该，由于其他答案中指出的原因）转向其他语言。一旦你取得了足够的进步，肯定会选择 Rails 或 Django 之类的框架。

# hash - 故意创建两个文件以具有相同的哈希值？

> ID：622930
> 
> 赞同：7
> 
> 时间：2009-03-08T02:44:14.287
> 
> 标签：hash, cryptography, hash-collision

如果有人故意尝试修改两个文件以具有相同的哈希值，有什么方法可以阻止它们？md5 和 sha1 可以防止大多数情况吗？

我正在考虑自己写，我想即使我做得不好，如果用户不知道我的哈希值，他也可能无法欺骗我的哈希值。

防止这种情况的最佳方法是什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-08T03:02:12.090

如果哈希冲突是一个主要问题，MD5 通常被认为是不安全的。SHA1 同样不再被美国政府认为是可接受的。~~正在进行~~一场寻找替代哈希算法的[竞赛](http://en.wikipedia.org/wiki/SHA-3)，但目前建议使用 SHA2 系列 - SHA-256、SHA-384 或 SHA-512。[*更新：2012-10-02 [NIST](http://www.nist.gov/itl/csd/sha-100212.cfm)选择[SHA-3](http://en.wikipedia.org/wiki/Keccak)作为算法[Keccak](http://keccak.noekeon.org/)。*]

您可以尝试创建自己的散列 - 它可能不如 MD5 好，并且“通过默默无闻的安全性”同样不可取。

如果您想要安全性，请使用多种散列算法进行散列。能够使用多种算法同时创建具有哈希冲突的文件是非常不可能的。[并且，根据评论，让我澄清一下：我的意思是同时发布文件的 SHA-256 和 Whirlpool 值——不是结合散列算法来创建单个值，而是使用单独的算法来创建单独的值。通常，损坏的文件将无法匹配任何算法；如果有人设法使用一种算法创建了碰撞值，那么在其他算法之一中也产生第二次碰撞的可能性可以忽略不计。]

[公共时间戳](http://publictimestamp.org/)使用一组算法。例如，请参阅[sqlcmd-86.00.tgz](http://www.publictimestamp.org/index.pl?pass=search&pass2=ptiddetails&pt=search_ptid&ptid=877143)以获取说明。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-08T03:04:35.317

如果用户不知道您的哈希算法，他也无法在您实际签署的文档上验证您的签名。

最好的选择是使用生成最长散列的公钥单向散列算法。SHA-256 创建一个 256 位哈希，因此伪造者必须尝试 2255^个不同的文档（平均而言），然后才能创建与给定文档匹配的文档，这是非常安全的。如果这对您来说仍然不够安全，那么可以使用 SHA-512。

另外，我认为值得一提的是，保护自己免受伪造的数字签名文档的一种低技术含量的好方法是简单地保留您签名的任何内容的副本。这样，如果发生争议，您可以证明您签署的原始文件已被更改。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-08T03:05:31.693

这里有一个难度等级（对于攻击者）。找到两个具有相同散列的文件比生成一个匹配给定散列的文件更容易，如果您不必遵守形式/内容/长度限制，则以后更容易做到。

因此，如果可以使用定义良好的文档结构和长度，那么无论您使用什么底层哈希，都可以让攻击者的生活更加艰难。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-08T03:02:46.787

您为什么要尝试创建自己的哈希算法？SHA1HMAC 有什么问题？

是的，哈希有重复。
任何比明文短的散列必然是更少的信息。这意味着会有一些重复。哈希的关键是重复很难逆向工程。

考虑 CRC32 - 通常用作散列。这是一个 32 位的数量。因为宇宙中有超过 2^32 条消息，那么就会有 CRC32 的重复。同样的想法也适用于其他哈希。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-08T03:03:10.687

这称为“哈希冲突”，避免它的最佳方法是使用强哈希函数。MD5 相对容易人为地构建冲突文件，如此[处所示](http://www.mathstat.dal.ca/~selinger/md5collision/)。同样，已知有一种[相对有效的方法](http://www.schneier.com/blog/archives/2005/02/sha1_broken.html)来计算碰撞 SH1 文件，尽管在这种情况下“相对有效”仍需要数百小时的计算时间。

一般来说，MD5 和 SHA1 的破解成本仍然很高，但并非不可能。如果您真的担心它，请使用更强的哈希函数，例如[SHA256](http://en.wikipedia.org/wiki/SHA_hash_functions)。

除非您是一位非常专业的密码学家，否则编写自己的代码实际上并不是一个好主意。大多数简单的想法都已经尝试过了，并且有针对它们的众所周知的攻击。

如果您真的想了解更多信息，请查看 Schneier 的*Applied Cryptography*。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-08T03:03:30.700

我不认为提出自己的哈希算法是一个好的选择。

另一个不错的选择是使用**Salted MD5**。例如，在传递给 MD5 函数之前，您的 MD5 哈希函数的输入会附加字符串“acidzom!@#”。

[在Slashdot](http://it.slashdot.org/article.pl?sid=05/11/15/2037232)也有很好的阅读。

# ruby-on-rails - Rails 'params' 变量

> ID：622932
> 
> 赞同：1
> 
> 时间：2009-03-08T02:44:37.593
> 
> 标签：ruby-on-rails, webforms, parameters, loops

参考[这个](https://stackoverflow.com/questions/621340/checkboxes-on-rails/621429#621429)

我在这样的网络表单中创建了一个问题：

```
<div class="form_row">
        <label for="features[]">Features:</label>
        <% [ 'scenarios', 'role_profiles', 'private_messages', 'polls' ].each do |feature| %>
          <br><%= check_box_tag 'features[]', feature,
                  (params[:features] || {}).include?(feature) %>
        <% end %>
</div> 
```

因此，如果场景和 private_messages 被检查并且我打印出来，`params[:features]`我将得到：scenariosprivate_messages

我想知道如何才能从参数中单独获取场景和 private_messages。是映射`params[:features] = "scenariosprivate_messages"`还是真的`params[features] = ["scenarios", "private_messages"]`？如果是后者，我该如何循环它们？

我在我的观点中写道：

```
<%= params[:features].each {|param|
    param.capitalize
} %> 
```

我仍然只是被`scenariosprivate_messages`打印出来。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-08T04:06:36.663

试试这个：

```
<% params[:features].each do |param| %>
  <%= param.capitalize %>
<% end %> 
```

原始解决方案的问题在于您打印出块的结果，即数组本身，而不是打印出数组的每个元素。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-08T03:41:36.910

你不应该`params`在你的观点中使用。你最好`params[:features]`在你的控制器中分配一个实例变量，然后在你的视图中迭代它。

但是要回答您的问题，您将输出的等号放在错误的位置。您希望单独输出数组的每个元素，而不是输出循环的结果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-08T04:12:06.480

您必须使用[`humanize`](http://api.rubyonrails.org/classes/ActiveSupport/CoreExtensions/String/Inflections.html#M001339)：

```
<% params[:features].each do |param| %>
  <%= param.humanize %>
<% end %> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-08T03:02:17.130

根据[this blog post](http://www.misuse.org/science/2006/12/28/rails-params-and-arrays/)，您应该能够单独访问它们，`params[:features]['scenarios']`等等。循环应该像所有其他数组一样工作——例如

`params[:features].each { |param|
# do something with param
}`

# spring.net - 如何在外部 Spring.NET 配置文件中指定 typeAliases 和对象

> ID：622938
> 
> 赞同：2
> 
> 时间：2009-03-08T02:50:50.527
> 
> 标签：spring.net

解决了！！！！谢谢你的帮助

我有点迷路了，我想删除 Web.Config 之外的所有 Spring.NET 配置，但我不知道如何放置我的 typeAliases。

我会很感激你能给我的所有帮助。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-08T08:55:54.673

您可以在 app.config/web.config 中注册类型别名：

```
 <configSections>
    <sectionGroup name="spring">
      <section name="context" type="Spring.Context.Support.ContextHandler, Spring.Core"/>
      <section name="typeAliases" type="Spring.Context.Support.TypeAliasesSectionHandler, Spring.Core"/>
    </sectionGroup>
  </configSections>

  <spring>
    <typeAliases>
      <alias name="Prog" type="MyNs.Program, MyLibrary" />
    </typeAliases>

    <context>
      <resource uri="context.xml"/>
    </context>
  </spring> 
```

或者在 spring 配置文件中添加`Spring.Objects.Factory.Config.TypeAliasConfigurer`对象的定义：

```
<?xml version="1.0" encoding="utf-8" ?>
<objects xmlns="http://www.springframework.net">

  <object id="program" type="Prog" />

  <object id="myTypeAlias" type="Spring.Objects.Factory.Config.TypeAliasConfigurer, Spring.Core">
    <property name="TypeAliases">
      <dictionary>
        <entry key="Prog" value="MyNs.Program, MyLibrary"/>
      </dictionary>
    </property>
  </object>

</objects> 
```

您可以在[文档](http://www.springframework.net/doc-latest/reference/html/objects.html#context-type-alias)中找到它。

# xml - 将 XML 自动反序列化为 Silverlight 中的类集合？

> ID：622941
> 
> 赞同：0
> 
> 时间：2009-03-08T02:53:28.087
> 
> 标签：xml, silverlight, serialization, linq-to-xml, silverlight-2.0

抱歉，如果这本质上是通用的，但我有一个问题可能与我对 .NET 和 Silverlight 的一些核心底层规则缺乏了解有关。

我目前有一个基本项目：

1.  ASP.NET 通用处理程序写出 XML

2.  在 Silverlight 中，我使用 WebClient 对象来获取 XML 输出，实际上我一直在运行 Scott Gu 的教程： [Scott Gu 的优秀教程](http://weblogs.asp.net/scottgu/pages/silverlight-tutorial-part-3-using-networking-to-retrieve-data-and-populate-a-datagrid.aspx)

我已经使用 LINQ TO XML 的示例将 XML 加载到类集合中。例如：

```
XDocument saleslogdata = XDocument.Parse(e.Result);

var logrecords = from data in saleslogdata.Descendants("data")
                 where data.Element("logID") != null
                 select new SalesLog
                 {
                     logID = (int)data.Element("logID"),
                     name = (string)data.Element("name"),
                 };

grdSalesLog.ItemsSource = logrecords; 
```

该类如下（只是一个基本示例）：

```
public class SalesLog
{
    public int logID { get; set; }
    public string name { get; set; }
} 
```

***所以我的主要问题是......***

有没有办法可以“自动生成”上述示例的类构建部分。换句话说，如果我需要向源 XML 添加另外 10 列，我显然需要进入我的 silverlight 应用程序，更改上面的代码以扩展类以合并新字段，当然还有 LINQ to XML 查询映射类的新 XML 字段。

同样，我确定我在这里遗漏了一些基本的东西！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-08T06:56:31.327

查看文章[http://mironabramson.com/blog/post/2008/06/Create-you-own-new-Type-and-use-it-on-run-time-(C).aspx](http://mironabramson.com/blog/post/2008/06/Create-you-own-new-Type-and-use-it-on-run-time-%28C%29.aspx)。

它解释了如何在运行时创建类型和实例。

而且我猜动态类型会在 C# 4.0 中让它变得更容易。

# java - Java 对象引用/范围问题

> ID：622944
> 
> 赞同：8
> 
> 时间：2009-03-08T02:59:08.027
> 
> 标签：java, oop, scope

如果我有这样的成员变量（在类的主体中声明）

```
private Dot[] dots=new Dot[numDots]; 
```

我遍历这个数组的所有成员，并且：

1) 将每个 Dot 对象传递给另一个类的函数，该函数：

2) 如果满足某些条件，则将其传递给第三类的另一个函数

3) 第三类改变了 Dot 对象的一些属性

那么当这个对象返回到原始/父类时，对其属性的这些更改是否会保留？或者它会被第二个/第三个函数视为局部变量吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-08T03:01:42.390

是的，对属性的更改将被保留。Java 是 100% 按值传递的，但是，当您传递一个对象时，传递的“值”实际上是一个指向该对象的指针。因此，当您更改方法中的对象时，您正在更改传入的实际对象。

也就是说，如果您有以下方法，那么调用方法将看到更改：

```
private void updateMyDot(final Dot aDot) {
  aDot.dotColor = new Color(255,255,255);
} 
```

但是如果您执行以下操作，则调用方法将**看**不到更改。

```
private void updateMyDot(/* not final */ Dot aDot) {
  aDot = new Dot();
  aDot.dotColor = new Color(255,255,255);
} 
```

在第二个示例中，调用者**不会**看到任何更改，也不会看到新创建的`Dot`对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-08T03:35:39.500

对象通过 [~~参考~~ *value 其中 value 是引用*]（从 Object 继承的东西），原始值（int、long、double 等）按值传递。

这意味着当原语从调用者传递到方法时，它会被复制，而对于对象，则传递 [ ] 引用的*值。*

这反过来意味着当一个对象被一个方法改变时，调用者会看到这些变化，因为它引用了同一个对象。

相反，当一个方法改变一个原语时，调用者看不到变化，因为该方法正在处理一个副本。

【修改原因】

如果 Java 通过引用传递，那么你可以这样做：

```
Object x;

x = new Integer(42);
foo(x);
System.out.println(x.getClass()); // pass by reference would have it print out java.lang.Float 
```

其中 foo 定义为：

```
void foo(Object o)
{
   o = new Float(43);
} 
```

由于 Java 允许按值传递引用`o = new Float(43);`- 但调用者中的值将保持为`new Integer(42);`

# mysql - 在 MySQL 数据库中搜索和替换术语

> ID：622961
> 
> 赞同：0
> 
> 时间：2009-03-08T03:05:38.777
> 
> 标签：mysql, redmine

我最近在我们的问题跟踪器中添加了一个新项目，即[Redmine](http://www.redmine.org)。当创建一个项目时，你给它一个名字和一个标识符（通常是相同的）。创建项目时有一条说明，一旦设置了标识符，您将无法更改它。出于这个原因，我非常小心地选择了一个通用标识符。不幸的是，我不够小心，我拼错了！拼写错误的标识符出现在问题跟踪器 URL 中。这些将被其他开发人员和我们正在合作的另一家公司看到，所以这是一个非常尴尬的错误。

因此，我正在寻找有关如何解决此问题的建议。要么是 Redmine 特定的，要么是我可以在数据库级别（即 MySQL）做的事情。

我已经找到了一个我可能会采用的解决方案，但我认为无论如何都值得在这里提问。我希望有人可以提供一个更简单的解决方案——也许是一个神奇的 SQL 单线。

我找到的解决方案是[这样](http://forums.devshed.com/mysql-help-4/search-and-replace-on-entire-database-373735.html)的：

*   将数据库转储到 SQL（使用 mysqldump）
*   使用 sed 或文本编辑器搜索和替换
*   从此 SQL 重新创建数据库。

感谢您的任何建议。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-11T01:12:06.853

原来它很简单：

```
update `projects` set `identifier` = '[NEWNAME]' where `indentifer` = '[OLDNAME]'; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T03:16:14.710

如果标识符仅限于某些列或一组列，则可以使用：

```
update [table] set [field] = replace([field],'[find]','[replace]'); 
```

根据您的情况，将括号内的文本替换为您的标识符。

# java - 异常帮助

> ID：622967
> 
> 赞同：0
> 
> 时间：2009-03-08T03:15:30.610
> 
> 标签：java

遇到以下异常。任何人都知道如何解决这个问题？或者到底是什么问题。

```
[#|2009-03-03T10:41:18.079+0800|SEVERE|sun-appserver-pe8.2|ilog.rules.teamserver.model.IlrGlobalCache|_ThreadID=12;|java.rmi.ServerException: RemoteException 在服务器中发生线; 嵌套异常是：
        java.rmi.RemoteException：嵌套异常是：java.sql.SQLException：分配连接时出错。原因：java.lang.RuntimeException：XAResource.start 期间出现异常：；嵌套异常是：
        java.sql.SQLException：分配连接时出错。原因：java.lang.RuntimeException：XAResource.start 期间出现异常：
java.rmi.ServerException：服务器线程发生RemoteException；嵌套异常是：
        java.rmi.RemoteException：嵌套异常是：java.sql.SQLException：分配连接时出错。原因：java.lang.RuntimeException：XAResource.start 期间出现异常：；嵌套异常是：
        java.sql.SQLException：分配连接时出错。原因：java.lang.RuntimeException：XAResource.start 期间出现异常：
        在 com.sun.corba.ee.impl.javax.rmi.CORBA.Util.wrapException（未知来源）
        在 javax.rmi.CORBA.Util.wrapException(Util.java:279)
        在 com.sun.corba.ee.impl.presentation.rmi.StubInvocationHandlerImpl.invoke（未知来源）
        在 com.sun.corba.ee.impl.presentation.rmi.bcel.BCELStubBase.invoke（未知来源）
        在 ilog.rules.teamserver.ejb.service._IlrSessionFacadeEJB_DynamicStub.getElementsFromAssociation(_IlrSessionFacadeEJB_DynamicStub.java)
        在 ilog.rules.teamserver.model.impl.IlrAbstractEJBSession.getElementsFromReference（未知来源）
        在 ilog.rules.teamserver.model.impl.IlrAbstractEJBSession.getElementsFromReference（未知来源）
        在 sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        在 sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        在 sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        在 java.lang.reflect.Method.invoke(Method.java:585)
        在 ilog.rules.teamserver.model.impl.IlrAbstractEJBSession.invoke（未知来源）
        在 ilog.rules.teamserver.client.platform.IlrCommonAppServerSettings.invokeWithGivenPrivileges（未知来源）
        在 ilog.rules.teamserver.client.IlrSessionProxy.invoke（未知来源）
        在 $Proxy35.getElementsFromReference（未知来源）
        在 ilog.rules.teamserver.brm.impl.IlrProjectInfoImpl.getMessageMap（未知来源）
        在 ilog.rules.teamserver.model.IlrGlobalCache.getBundle（未知来源）
        在 ilog.rules.teamserver.model.IlrMessages.getString（未知来源）
        在 ilog.rules.teamserver.model.IlrMessages.getMessage（未知来源）
        在 ilog.rules.teamserver.model.IlrMessageHelper.getDisplayNameForType（未知来源）
        在 ilog.rules.teamserver.model.IlrMessageHelper.getLCDisplayNameForType（未知来源）
        在 ilog.rules.teamserver.externalejb.IlrExternalInterfaceFacadeLocalSessionBean.commitRuleDataSeparately（未知来源）
        在 ilog.rules.teamserver.externalejb.IlrExternalInterfaceFacadeLocalSessionBean.commitRuleData（未知来源）
        在 sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        在 sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        在 sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        在 java.lang.reflect.Method.invoke(Method.java:585)
        在 com.sun.enterprise.security.application.EJBSecurityManager.runMethod(EJBSecurityManager.java:983)
        在 com.sun.enterprise.security.SecurityUtil.invoke(SecurityUtil.java:147)
        在 com.sun.ejb.containers.EJBLocalObjectInvocationHandler.invoke(EJBLocalObjectInvocationHandler.java:128)
        在 $Proxy18.commitRuleData（未知来源）
        在 ilog.rules.teamserver.web.servlets.IlrSynchronizationEntryPointServlet.handlecommitRuleData（未知来源）
        在 sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        在 sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        在 sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        在 java.lang.reflect.Method.invoke(Method.java:585)
        在 ilog.rules.teamserver.web.servlets.IlrSynchronizationEntryPointServlet.handleMethod（未知来源）
        在 ilog.rules.teamserver.web.servlets.IlrSynchronizationEntryPointServlet.doPost（未知来源）
        在 javax.servlet.http.HttpServlet.service(HttpServlet.java:767)
        在 javax.servlet.http.HttpServlet.service(HttpServlet.java:860)
        在 sun.reflect.GeneratedMethodAccessor113.invoke（未知来源）
        在 sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        在 java.lang.reflect.Method.invoke(Method.java:585)
        在 org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:249)
        在 java.security.AccessController.doPrivileged（本机方法）
        在 javax.security.auth.Subject.doAsPrivileged(Subject.java:517)
        在 org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:282)
        在 org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:165)
        在 org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:257)
        在 org.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:55)
        在 org.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:161)
        在 java.security.AccessController.doPrivileged（本机方法）
        在 org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:157)
        在 org.apache.catalina.core.StandardWrapperValve.invoke（StandardWrapperValve.java:263）
        在 org.apache.catalina.core.StandardPipeline.invoke（StandardPipeline.java:551）
        在 org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:225)
        在 org.apache.catalina.core.StandardContextValve.invoke（StandardContextValve.java:173）
        在 org.apache.catalina.core.StandardPipeline.invoke（StandardPipeline.java:551）
        在 org.apache.catalina.core.StandardHostValve.invoke（StandardHostValve.java:170）
        在 org.apache.catalina.core.StandardPipeline.invoke（StandardPipeline.java:551）
        在 org.apache.catalina.core.StandardEngineValve.invoke（StandardEngineValve.java:132）
        在 org.apache.catalina.core.StandardPipeline.invoke（StandardPipeline.java:551）
        在 org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:933)
        在 org.apache.coyote.tomcat5.CoyoteAdapter.service（CoyoteAdapter.java:189）
        在 com.sun.enterprise.web.connector.grizzly.ProcessorTask.doProcess(ProcessorTask.java:604)
        在 com.sun.enterprise.web.connector.grizzly.ProcessorTask.process(ProcessorTask.java:475)
        在 com.sun.enterprise.web.connector.grizzly.ReadTask.executeProcessorTask(ReadTask.java:371)
        在 com.sun.enterprise.web.connector.grizzly.ReadTask.doTask(ReadTask.java:264)
        在 com.sun.enterprise.web.connector.grizzly.TaskBase.run(TaskBase.java:281)
        在 com.sun.enterprise.web.connector.grizzly.WorkerThread.run(WorkerThread.java:83)
引起：java.rmi.RemoteException：嵌套异常是：java.sql.SQLException：分配连接时出错。原因：java.lang.RuntimeException：XAResource.start 期间出现异常：；嵌套异常是：
        java.sql.SQLException：分配连接时出错。原因：java.lang.RuntimeException：XAResource.start 期间出现异常：
        在 com.sun.enterprise.iiop.POAProtocolMgr.mapException（POAProtocolMgr.java:199）
        在 com.sun.ejb.containers.BaseContainer.postInvoke(BaseContainer.java:853)
        在 com.sun.ejb.containers.EJBObjectInvocationHandler.invoke(EJBObjectInvocationHandler.java:160)
        在 $Proxy22.getElementsFromAssociation（未知来源）
        在 sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        在 sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        在 sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        在 java.lang.reflect.Method.invoke(Method.java:585)
        ... 68 更多
原因：java.sql.SQLException：分配连接时出错。原因：java.lang.RuntimeException：XAResource.start 期间出现异常：
        在 com.sun.gjc.spi.DataSource.getConnection(DataSource.java:74)
        在 ilog.rules.teamserver.ejb.service.dao.IlrElementDAOJDBC.getConnection（未知来源）
        在 ilog.rules.teamserver.ejb.service.IlrTransactionContext.getConnectionFromAppServer（未知来源）
        在 ilog.rules.teamserver.ejb.service.IlrTransactionContext.（未知来源）
        在 ilog.rules.teamserver.ejb.service.IlrTransactionContext.（未知来源）
        在 ilog.rules.teamserver.ejb.service.IlrSessionFacadeImpl.getElementsFromAssociation（未知来源）
        在 ilog.rules.teamserver.ejb.service.IlrSessionFacadeBean.getElementsFromAssociation（未知来源）
        在 sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        在 sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        在 sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        在 java.lang.reflect.Method.invoke(Method.java:585)
        在 com.sun.enterprise.security.SecurityUtil$2.run(SecurityUtil.java:153)
        在 java.security.AccessController.doPrivileged（本机方法）
        在 com.sun.enterprise.security.application.EJBSecurityManager.doAsPrivileged(EJBSecurityManager.java:957)
        在 com.sun.enterprise.security.SecurityUtil.invoke(SecurityUtil.java:158)
        在 com.sun.ejb.containers.EJBObjectInvocationHandler.invoke(EJBObjectInvocationHandler.java:151)
        ... 73 更多
|#]

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T04:10:13.863

为了能够解决这个问题，我们需要更多地了解您的环境。例如，什么 JVM 版本和供应商？

根本原因埋在某处

```
java.sql.SQLException: Error in allocating a connection.
Cause: java.lang.RuntimeException: Got exception during XAResource.start:
    at com.sun.gjc.spi.DataSource.getConnection(DataSource.java:74) 
```

你得到一个`RuntimeException`. 这似乎是导致所有麻烦的异常。如果你能找出这个异常是什么，你可能会看到如何修复它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T02:48:21.163

> 分配连接时出错。

无法从连接池中获取连接。

原因可能是：

*   池达到其最大容量 = 您的应用程序泄漏连接
*   数据库端已达到此用户的最大容量 => 更改数据库设置
*   数据库已关闭（暂时？）
*   其他任何事情（不太可能）

所有其他异常（XA、SQLException、...）只是后果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T11:18:16.877

正如 Eddie 所说，没有足够的信息来完全诊断您的问题，尽管它似乎与数据库相关。

需要检查的一些事项：

*   您的数据库连接设置正确吗？
*   您的数据库服务器是否正在运行？
*   你的数据库连接用完了吗？

祝你好运 ：-）

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-08T16:04:42.927

“XAResource”让我觉得某种程度上涉及到两阶段提交。如果这是真的，您是否使用 XA 驱动程序来访问数据库？你必须。

# c++ - 输出到我找不到的 C++ 文件时出错

> ID：622978
> 
> 赞同：1
> 
> 时间：2009-03-08T03:29:44.303
> 
> 标签：c++, encryption, fstream

不像“在stackoverflow上找不到答案”，而是“看不到我做错了什么”，差别很大！

Anywho，代码附在下面。它所做的是相当基本的，它接收一个用户创建的文本文件，并吐出一个已加密的文件。在这种情况下，用户告诉它在每个真实字符之间放置多少垃圾字符。（IE：如果我想用 1 个垃圾字符加密单词“Hello”，它看起来像“9H（eal~lo”）

我的问题是由于某种原因，它没有正确读取输入文件。我使用与之前解密时相同的设置来读取文件，但这次它正在读取垃圾字符，当我告诉它输出到文件时，它会在屏幕上打印出来，看起来像输出文件中没有任何内容（尽管它正在创建中，所以这意味着我已经正确地做了一些事情，请指点我！

代码：

```
string start;
char choice;
char letter;
int x;
int y;
int z;
char c;
string filename;

while(start == "enc")
{
    x = 1;
    y = 1;
    cout << "How many garbage characters would you like between each correct character?: " ;
    cin >> z;
    cout << endl << "Please insert the name of the document you wish to encrypt, make sure you enter the name, and the file type (ie: filename.txt): " ;
    cin >> filename;
    ifstream infile(filename.c_str());
    ofstream outfile("encrypted.txt", ios::out);

    while(!infile.eof())
    {
        infile.get(letter); 
        while ((x - y) != z)         
        {
            outfile << putchar(33 + rand() % 94);
            x++;    
        }
        while((x - y) == z)
        {
            outfile << letter;
            y = 1;
            x = 1;
        }
    }
    outfile.close();
    cout << endl << "Encryption complete...please return to directory of program, a new file named encrypted.txt will be there." << endl;
    infile.close();
    cout << "Do you wish to try again? Please press y then enter if yes (case sensitive).";
    cin >> choice; 
```

我在 while 循环的开头粘贴的是声明变量，这是一个更大的代码的一部分，它不仅会加密，还会解密，我把解密部分去掉了，因为它工作得很好，这就是我的部分我有一个问题。

提前感谢您的协助！

编辑:: 我正在使用visual C++ express 2008，它回击说根本没有错误，也没有任何警告。

**重要编辑** 原来它正在输出到文件！但是，它输出的是数字而不是 ascii 字符，并且它也输出了应该是的字母的垃圾字符。当它回到“infile.get(letter)”时，它没有得到一个新字符。所以现在看来​​问题有两个：1）打印数字而不是ascii字符。2）使用垃圾而不是它应该得到的实际字符。

**已回答的问题** 在“重要编辑”中找到了第二部分...如果您将某些东西命名为 test.txt...这意味着当您将其键入 C++ 程序时它实际上称为 test.txt.txt。只是表明是微小的、微小的、简单的细节会导致任何程序出错。感谢乔治·肖尔。您对输入文件位于错误位置的评论使我产生了尝试实际项目名称的想法。

感谢所有帮助解答的人！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-08T04:26:56.990

除了先前的答案，我相信这是因为原始代码找不到您要加密的文件。假设您正在从 IDE 运行代码是否安全？如果是这样，则要加密的文件必须与源文件位于同一目录中。

还：

```
outfile << putchar(33 + rand() % 94); 
```

似乎是你的屏幕垃圾的来源；'putchar' 函数在返回该字符的整数值时回显到屏幕。然后会发生的是数字将输出到文件，而不是字符。

将该块更改为：

```
while ((x - y) != z)         
{
    c = (33 + rand() % 94);
    outfile << c;
    x++;
} 
```

应该使代码能够按照您的意愿运行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-08T04:08:58.030

而不是这样做：

```
while (!infile.eof())
{
    infile.get(letter);
    if (infile.good())
    { 
```

做这个：

```
while (infile.get(letter))
{ 
```

这是读取文件的标准模式。
它获取一个字符，然后通过将其转换为 bool 来检查生成的 infile（由 get 返回）以查看它是否仍然有效。

该行：

```
outfile << putchar(33 + rand() % 94); 
```

应该是：

```
outfile << static_cast<char>(33 + rant() % 94); 
```

putchar() 打印到标准输出。但是返回值（与输入相同）进入输出文件。要停止这种情况，只需将值转换为 char 并发送到 outfile。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-08T03:44:19.680

`y`有必要使用' '吗？这对我来说似乎令人困惑和不必要。如果我正在实现这个，那么我希望只使用' `x`'和' `z`'。

我也不确定' `while (!infile.eof())`'条件；Pascal 会提前确定 EOF，但 C++ 只能在尝试[读取字符后告诉您有关 EOF 的](http://www.cplusplus.com/reference/iostream/istream/get.html)信息。但是，这只会影响文件的结尾，而不是循环的主体。

```
 while (!infile.eof())
    {
        infile.get(letter);
        if (infile.good())
        {
            for (int i = 0; i < z; i++)        
                outfile << putchar(33 + rand() % 94);
            outfile << letter;
        }
    } 
```

（未编译的代码！）。

此外，不要将其用于安全性 - 它可能会有所帮助，但它肯定不会向确定的人隐瞒信息。

# python - Django 将自定义表单参数传递给 Formset

> ID：622982
> 
> 赞同：157
> 
> 时间：2009-03-08T03:36:08.377
> 
> 标签：python, django, forms, django-forms

> 这已在 Django 1.9 中使用[form_kwargs 修复](https://docs.djangoproject.com/en/1.9/topics/forms/formsets/#passing-custom-parameters-to-formset-forms)。

我有一个看起来像这样的 Django 表单：

```
class ServiceForm(forms.Form):
    option = forms.ModelChoiceField(queryset=ServiceOption.objects.none())
    rate = forms.DecimalField(widget=custom_widgets.SmallField())
    units = forms.IntegerField(min_value=1, widget=custom_widgets.SmallField())

    def __init__(self, *args, **kwargs):
        affiliate = kwargs.pop('affiliate')
        super(ServiceForm, self).__init__(*args, **kwargs)
        self.fields["option"].queryset = ServiceOption.objects.filter(affiliate=affiliate) 
```

我用这样的方式调用这个表单：

```
form = ServiceForm(affiliate=request.affiliate) 
```

`request.affiliate`登录用户在哪里。这按预期工作。

我的问题是我现在想把这个单一的表单变成一个表单集。我想不通的是如何在创建表单集时将附属信息传递给各个表单。根据文档来制作一个表单集，我需要做这样的事情：

```
ServiceFormSet = forms.formsets.formset_factory(ServiceForm, extra=3) 
```

然后我需要像这样创建它：

```
formset = ServiceFormSet() 
```

现在我怎样才能以这种方式将affiliate=request.affiliate 传递给个人表单？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2009-03-08T18:00:26.520

我会使用[functools.partial](http://docs.python.org/2/library/functools.html#functools.partial)和[functools.wraps](http://docs.python.org/2/library/functools.html#functools.wraps)：

```
from functools import partial, wraps
from django.forms.formsets import formset_factory

ServiceFormSet = formset_factory(wraps(ServiceForm)(partial(ServiceForm, affiliate=request.affiliate)), extra=3) 
```

我认为这是最干净的方法，并且不会以任何方式影响 ServiceForm（即通过使其难以子类化）。

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2016-03-05T06:41:12.803

# 公文方式

Django 2.0：

```
ArticleFormSet = formset_factory(MyArticleForm)
formset = ArticleFormSet(form_kwargs={'user': request.user}) 
```

[https://docs.djangoproject.com/en/2.0/topics/forms/formsets/#passing-custom-parameters-to-formset-forms](https://docs.djangoproject.com/en/2.0/topics/forms/formsets/#passing-custom-parameters-to-formset-forms)

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2009-03-08T04:24:10.023

我将在函数中动态构建表单类，以便它可以通过闭包访问附属机构：

```
def make_service_form(affiliate):
    class ServiceForm(forms.Form):
        option = forms.ModelChoiceField(
                queryset=ServiceOption.objects.filter(affiliate=affiliate))
        rate = forms.DecimalField(widget=custom_widgets.SmallField())
        units = forms.IntegerField(min_value=1, 
                widget=custom_widgets.SmallField())
    return ServiceForm 
```

作为奖励，您不必在选项字段中重写查询集。缺点是子类化有点时髦。（任何子类都必须以类似的方式制作。）

**编辑：**

作为对评论的回应，您可以在任何使用类名的地方调用此函数：

```
def view(request):
    affiliate = get_object_or_404(id=request.GET.get('id'))
    formset_cls = formset_factory(make_service_form(affiliate))
    formset = formset_cls(request.POST)
    ... 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2014-09-18T14:29:59.323

这对我有用，Django 1.7：

```
from django.utils.functional import curry    

lols = {'lols':'lols'}
formset = modelformset_factory(MyModel, form=myForm, extra=0)
formset.form = staticmethod(curry(MyForm, lols=lols))
return formset

#form.py
class MyForm(forms.ModelForm):

    def __init__(self, lols, *args, **kwargs): 
```

希望它对某人有所帮助，我花了足够长的时间才弄清楚；）

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-03-08T07:08:41.720

我喜欢闭包解决方案，因为它“更干净”并且更 Pythonic（所以 +1 到 mmarshall 答案），但 Django 表单也有一个回调机制，您可以使用它来过滤表单集中的查询集。

它也没有记录在案，我认为这表明 Django 开发人员可能不太喜欢它。

因此，您基本上创建了相同的表单集，但添加了回调：

```
ServiceFormSet = forms.formsets.formset_factory(
    ServiceForm, extra=3, formfield_callback=Callback('option', affiliate).cb) 
```

这是创建一个类的实例，如下所示：

```
class Callback(object):
    def __init__(self, field_name, aff):
        self._field_name = field_name
        self._aff = aff
    def cb(self, field, **kwargs):
        nf = field.formfield(**kwargs)
        if field.name == self._field_name:  # this is 'options' field
            nf.queryset = ServiceOption.objects.filter(affiliate=self._aff)
        return nf 
```

这应该给你一个大致的想法。使回调成为像这样的对象方法会稍微复杂一些，但与执行简单的函数回调相比，它为您提供了更多的灵活性。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-05-01T23:00:06.300

我想将此作为对 Carl Meyers 回答的评论，但由于这需要积分，所以我将其放在这里。这花了我 2 个小时才弄清楚，所以我希望它会对某人有所帮助。

关于使用 inlineformset_factory 的说明。

我自己使用了该解决方案，并且效果很好，直到我使用 inlineformset_factory 进行了尝试。我正在运行 Django 1.0.2 并遇到了一些奇怪的 KeyError 异常。我升级到最新的主干，它直接工作。

我现在可以像这样使用它：

```
BookFormSet = inlineformset_factory(Author, Book, form=BookForm)
BookFormSet.form = staticmethod(curry(BookForm, user=request.user)) 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2014-09-10T13:09:20.300

截至 2012 年 8 月 14 日星期二 23:44:46 +0200 提交 e091c18f50266097f648efc7cac2503968e9d217 +0200 时，已接受的解决方案不再起作用。

当前版本的 django.forms.models.modelform_factory() 函数使用“类型构造技术”，在传递的表单上调用 type() 函数来获取元类类型，然后使用结果构造它的类对象即时输入::

```
# Instatiate type(form) in order to use the same metaclass as form.
return type(form)(class_name, (form,), form_class_attrs) 
```

这意味着即使传递了一个`curry`ed 或`partial`对象而不是一个表单“导致鸭子咬你”，可以这么说：它会使用对象的构造参数调用一个函数`ModelFormClass`，返回错误消息：：

```
function() argument 1 must be code, not str 
```

为了解决这个问题，我编写了一个生成器函数，它使用闭包返回指定为第一个参数的任何类的子类，然后在使用生成器函数调用中提供的 kwargs`super.__init__`之后调用：`update`

```
def class_gen_with_kwarg(cls, **additionalkwargs):
  """class generator for subclasses with additional 'stored' parameters (in a closure)
     This is required to use a formset_factory with a form that need additional 
     initialization parameters (see http://stackoverflow.com/questions/622982/django-passing-custom-form-parameters-to-formset)
  """
  class ClassWithKwargs(cls):
      def __init__(self, *args, **kwargs):
          kwargs.update(additionalkwargs)
          super(ClassWithKwargs, self).__init__(*args, **kwargs)
  return ClassWithKwargs 
```

然后在您的代码中，您将表单工厂称为：

```
MyFormSet = inlineformset_factory(ParentModel, Model,form = class_gen_with_kwarg(MyForm, user=self.request.user)) 
```

警告：

*   这几乎没有得到任何测试，至少目前是这样
*   提供的参数可能会发生冲突并覆盖那些将使用构造函数返回的对象的任何代码所使用的参数

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-02-09T07:16:01.840

Carl Meyer 的解决方案看起来非常优雅。我尝试为模型集实现它。我的印象是我不能在一个类中调用 staticmethods，但是以下莫名其妙的工作：

```
class MyModel(models.Model):
  myField = models.CharField(max_length=10)

class MyForm(ModelForm):
  _request = None
  class Meta:
    model = MyModel

    def __init__(self,*args,**kwargs):      
      self._request = kwargs.pop('request', None)
      super(MyForm,self).__init__(*args,**kwargs)

class MyFormsetBase(BaseModelFormSet):
  _request = None

def __init__(self,*args,**kwargs):
  self._request = kwargs.pop('request', None)
  subFormClass = self.form
  self.form = curry(subFormClass,request=self._request)
  super(MyFormsetBase,self).__init__(*args,**kwargs)

MyFormset =  modelformset_factory(MyModel,formset=MyFormsetBase,extra=1,max_num=10,can_delete=True)
MyFormset.form = staticmethod(curry(MyForm,request=MyFormsetBase._request)) 
```

在我看来，如果我这样做：

```
formset = MyFormset(request.POST,queryset=MyModel.objects.all(),request=request) 
```

然后“请求”关键字被传播到我的表单集的所有成员表单。我很高兴，但我不知道为什么会这样——这似乎是错误的。有什么建议么？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-08-27T14:38:38.377

在看到这个帖子之前，我花了一些时间试图找出这个问题。

我想出的解决方案是闭包解决方案（这是我以前使用过的 Django 模型表单的解决方案）。

我尝试了上面描述的 curry() 方法，但我无法让它与 Django 1.0 一起工作，所以最后我恢复到了闭包方法。

闭包方法非常简洁，唯一有点奇怪的是类定义嵌套在视图或其他函数中。我认为这对我来说看起来很奇怪的事实是我以前的编程经验的一个挂断，我认为具有更动态语言背景的人不会眨眼！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-10-27T12:12:55.947

我不得不做类似的事情。这类似于`curry`解决方案：

```
def form_with_my_variable(myvar):
   class MyForm(ServiceForm):
     def __init__(self, myvar=myvar, *args, **kwargs):
       super(SeriveForm, self).__init__(myvar=myvar, *args, **kwargs)
   return MyForm

factory = inlineformset_factory(..., form=form_with_my_variable(myvar), ... ) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-08-21T04:36:35.120

我是这里的新手，所以我无法添加评论。我希望这段代码也能工作：

```
ServiceFormSet = formset_factory(ServiceForm, extra=3)

ServiceFormSet.formset = staticmethod(curry(ServiceForm, affiliate=request.affiliate)) 
```

至于向`BaseFormSet`表单集而不是表单添加其他参数。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-08-30T13:59:30.253

基于[这个答案](https://stackoverflow.com/questions/622982/django-passing-custom-form-parameters-to-formset/#answer-623198)，我找到了更清晰的解决方案：

```
class ServiceForm(forms.Form):
    option = forms.ModelChoiceField(
            queryset=ServiceOption.objects.filter(affiliate=self.affiliate))
    rate = forms.DecimalField(widget=custom_widgets.SmallField())
    units = forms.IntegerField(min_value=1, 
            widget=custom_widgets.SmallField())

    @staticmethod
    def make_service_form(affiliate):
        self.affiliate = affiliate
        return ServiceForm 
```

并在视图中运行它

```
formset_factory(form=ServiceForm.make_service_form(affiliate)) 
```

# perl - 删除被 SpamAssassin 标记为垃圾邮件的最直接的方法是什么？

> ID：622983
> 
> 赞同：3
> 
> 时间：2009-03-08T03:37:28.980
> 
> 标签：perl, email-spam, spam-prevention, spamassassin

我在 Ubuntu Intrepid 上，使用 Postfix 和 SpamAssassin。我见过使用 procmail 的方法（如[建议的 @ Apache](http://wiki.apache.org/spamassassin/DeletingAllMailsMarkedSpam)），但我正在寻找一种不使用 procmail 的解决方案。

这是一个编程问题，因为正确的答案将是完成手头任务的某种形式的代码（我对否定投票的回应）。

更新情况：我使用了本教程，效果非常好：[https ://help.ubuntu.com/community/PostfixAmavisNew](https://help.ubuntu.com/community/PostfixAmavisNew)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T04:22:26.237

这实际上取决于您要删除垃圾邮件的级别：

*   在邮件客户端级别，使用电子邮件客户端规则（如 Thunderbird 中可用的规则）很容易：只需设置一个规则，删除主题中标记为垃圾邮件的任何电子邮件。

*   在用户级别，如果机器自动接收邮件，您可以设置一些 cron 作业，定期检查本地邮箱并再次删除标记为垃圾邮件的邮件。
    如果您的本地商店使用它很容易，[`maildir`](http://en.wikipedia.org/wiki/Maildir)因为每封电子邮件只是一个文件，而不是`mbox`因为它是单个文件而需要更多工作的格式。为后缀
    设置是[微不足道](http://etc.nkadesign.com/EmailServer/Postfix)的。`maildir`

*   在服务器级别，使用[`Amavisd`](http://www.ijs.si/software/amavisd/)将允许您更好地控制邮件的处理方式。
    `Amavisd`具有阈值设置，您可以在其中根据 spamassassin 给出的垃圾邮件分数定义规避操作。
    例如，任何超过 15 分的东西都会被隔离，任何超过 30 分的东西都会被删除。
    有一些[关于在 Ubuntu 上安装 Amavisd 的](https://help.ubuntu.com/community/PostfixAmavisNew)说明。

关键是，据我所知，`spamassassin`他的工作是识别并为电子邮件提供垃圾邮件积分。您希望如何处理这些不取决于`spamassassin`链中的其他模块。

# java - 使用自定义字段处理程序的 Java castor

> ID：622997
> 
> 赞同：3
> 
> 时间：2009-03-08T03:48:02.387
> 
> 标签：java, xml, field, castor

我一直在尝试编写一个自定义字段处理程序，它在写入 XML 时返回 java.awt.Image 对象的哈希码，并在将 XML 绑定到对象时根据此哈希码检索图像。出于某种原因，我无法让它工作；据我所知，castor 只是实例化了字段处理程序，然后不调用它的任何方法。

你能给我一个快速的例子来说明如何做到这一点，因为我一定错过了一些简单的东西！

干杯，

皮特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-10-17T14:27:33.743

粘贴代码可能是个好主意。无论如何，以下对我来说很好

```
<m:class name="someClass">
        <m:map-to xml="class"/>
        <m:field name="lineColor" type="java.awt.Color"  handler="ColorFieldHandler">
            <m:bind-xml name="lineColor" node="attribute"/>
        </m:field>
    </m:class> 
```

和处理程序本身

```
public class ColorFieldHandler extends GeneralizedFieldHandler {
    public Object convertUponGet(Object value) {
        if (value == null) {
            return null;
        }
        Integer colorHash = (Integer) value;
    ... 
```

希望有帮助

# objective-c - 没有Interface Builder的Cocoa，初始化应用控制器的实例？

> ID：622998
> 
> 赞同：4
> 
> 时间：2009-03-08T03:48:54.193
> 
> 标签：objective-c, cocoa, xcode, interface-builder

我**不**打算在没有 IB 的情况下编写应用程序，我只是在尝试更多地了解编程。

如何在启动时获取 AppController 类的单个实例？（它通常是从笔尖加载的。）你能弄清楚`+initialize`and的使用`-init`吗？如果我理解，`+initialize`在启动时会调用所有类。如何使用它来创建我的 AppController 的实例，其中包含构成我的界面的实例变量？

希望这是有道理的，并感谢您的帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-08T05:27:55.487

`+initalize`当一个类或它的一个子类第一次接收到消息时，它被发送到一个类。所以，当你这样做时：

```
instance = [[[YourClass alloc] init] autorelease]; 
```

该`alloc`消息触发`initialize`。

如果你对子类做同样的事情：

```
instance = [[[SubclassOfYourClass alloc] init] autorelease]; 
```

该`alloc`消息将以`+[YourClass initialize]`与另一个相同的方式触发（在触发之前）`+[SubclassOfYourClass initialize]`。但只有其中一个会这样做 - 每个类都`initialize`不会被多次调用。（除非你自己调用它`[super initialize]`或`[SomeClass initialize]`- 所以不要那样做，因为该方法不会期待它。）

`-init`，另一方面，初始化一个新实例。在表达式`[[YourClass alloc] init]`中，您亲自将消息直接发送到实例。您也可以通过另一个初始化程序 ( `[[YourClass alloc] initWithSomethingElse:bar]`) 或便利工厂 ( `[YourClass instance]`) 间接调用它。

与 不同`initialize`的是，您应该始终向`init`您的超类发送（或另一个初始化程序，如果合适）。大多数 init 方法大致如下所示：

```
- (id) init {
    if ((self = [super init])) {
        framistan = [[Framistan alloc] init];
    }
    return self;
} 
```

细节不同（此方法或超类或两者都可能带参数，有些人更喜欢单独使用`self = [super init]`， Wil Shipley[根本](http://wilshipley.com/blog/2005/07/self-stupid-init.html)[不指定`self`](http://wilshipley.com/blog/2005/07/self-stupid-init.html)），但基本思想是相同的：调用`[super init[WithSomething:…]]`，确保它没有t return `nil`，如果没有设置实例，则返回超类返回的任何内容。

这意味着*您*`nil`可以从回来`init`，而且确实可以。如果你这样做，你应该`[self release]`这样做，这样你就不会泄漏失败的对象。（为了检测无效的参数值，另一种方法是`NSParameterAssert`，如果断言失败，它会抛出异常。每个的相对优点超出了这个问题的范围。）

> 如何使用它来创建我的 AppController 的实例，其中包含构成我的界面的实例变量？

最好的方法是做这一切`main`：

```
int main(int argc, char **argv) {
    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];

    AppController *controller = [[[AppController alloc] init] autorelease];
    [[NSApplication sharedApplication] setDelegate:controller]; //Assuming you want it as your app delegate, which is likely
    int status = NSApplicationMain(argc, argv);

    [pool drain];
    return status;
} 
```

您将在您的应用程序委托方法中进行任何其他设置`AppController`。

您已经知道这一点，但对于其他阅读此内容的人来说：**笔尖是您的朋友。界面生成器是您的朋友。不要与框架抗争——使用它，并以图形方式构建你的界面，你的应用程序会更适合它。**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-12-09T23:45:38.047

另一个解决在没有 nib 的情况下启动应用程序的问题。

无需分配您自己的控制器，只需在`NSApplicationMain()`方法中使用额外的参数：

```
int retVal = NSApplicationMain(argc, argv, @"UIApplication", @"MyAppDelegate"); 
```

这会处理所有需要的正确链接。

然后，您需要记住的唯一另一件事是制作自己的窗口并将其设置为可见。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-30T23:26:57.470

一组 NIB 似乎不是一个令人满意的答案，即使以 XML（作为 XIB）表示也是如此，因为没有简单的方法可以将它们与任何标准的颠覆或 SCM 风格的工具进行比较或合并。编码信息很脆弱，不打算仅由人类编辑。GUI 如何表示更改？我会逐步检查每个控件的每个属性并目视检查它们吗？

但是，如果应用程序的行为是用代码编写的，那么即使我必须同时掌握大量细节，我也有可能弄清楚其中发生了什么。

**建议**的解决方案：使用主要架构师编写的顶级 NIB，然后显式编写应用程序的其余部分。

有人有更好的主意吗？**********