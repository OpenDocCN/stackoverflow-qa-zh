# StackOverflow 问答 000505000-000505999

# sql - SQL Server：如何选择安装路径？

> ID：505007
> 
> 赞同：8
> 
> 时间：2009-02-02T21:25:18.427
> 
> 标签：sql, sql-server

我知道有一个变量、函数或存储过程可用于查找 SQL Server 的安装路径：

例如：

```
c:\Program Files\Microsoft SQL Server\MSSQL.7\MSSQL 
```

或者

```
m:\CustomInstance\MSSQL 
```

* * *

实际上，我希望选择默认备份路径。但由于我怀疑它的存在，我将把 \BACKUP 附加到安装路径上并称它足够接近。

* * *

## 更新一

```
select filename from sysaltfiles
where name = db_name()

Server: Msg 208, Level 16, State 1, Line 1
Invalid object name 'sysaltfiles'. 
```

* * *

```
select filename from master.dbo.sysaltfiles
where name = db_name()

filename
---------------- 

(0 row(s) affected) 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-10T18:40:54.420

## 如何选择安装路径

**注意**：***xp_instance_regread****不会读取您指定的注册表项，而是将该键路径转换为您正在运行的特定 SQL Server 实例的适当路径。换句话说：**xp_regread**在**xp_instance_regread**成功的地方失败。*

## SQL Server 安装目录

```
declare @rc int, @dir nvarchar(4000) 

exec @rc = master.dbo.xp_instance_regread
      N'HKEY_LOCAL_MACHINE',
      N'Software\Microsoft\MSSQLServer\Setup',
      N'SQLPath', 
      @dir output, 'no_output'
select @dir AS InstallationDirectory 
```

## SQL Server 备份目录

```
declare @rc int, @dir nvarchar(4000) 

exec @rc = master.dbo.xp_instance_regread
      N'HKEY_LOCAL_MACHINE',
      N'Software\Microsoft\MSSQLServer\MSSQLServer',
      N'BackupDirectory', 
      @dir output, 'no_output'
select @dir AS BackupDirectory 
```

[SQL Server 2000 定位函数](http://www.sqldev.net/misc/SQLLocationFunctions.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T22:04:04.090

执行以下操作以检查注册表以找到适当的键。

```
Declare @Path as varchar(100);
Set @Path = NULL

Exec master..xp_regread 'HKEY_LOCAL_MACHINE', 'SOFTWARE\Microsoft\Microsoft SQL Server\70\Tools\ClientSetup', 'SQLPath', @Path OUTPUT
Select @Path as [Sql Server 7.0 path] 

Set @Path = NULL
Exec master..xp_regread 'HKEY_LOCAL_MACHINE', 'SOFTWARE\Microsoft\Microsoft SQL Server\80\Tools\ClientSetup', 'SQLPath', @Path OUTPUT
Select @Path as [Sql Server 2000 path] 

Set @Path = NULL
Exec master..xp_regread 'HKEY_LOCAL_MACHINE', 'SOFTWARE\Microsoft\Microsoft SQL Server\90\Tools\ClientSetup', 'SQLPath', @Path OUTPUT
Select @Path as [Sql Server 2005 path]

Set @Path = NULL
Exec master..xp_regread 'HKEY_LOCAL_MACHINE', 'SOFTWARE\Microsoft\Microsoft SQL Server\100\Tools\ClientSetup', 'SQLPath', @Path OUTPUT
Select @Path as [Sql Server KATMAI path] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T21:30:14.063

当你运行它时会发生什么

```
select filename from sysaltfiles
where name = db_name() 
```

如果您想查看 master 数据库所在的位置，请将 db_name() 更改为 'master'

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-03T10:34:52.257

```
CREATE FUNCTION Fn_sqlservertoolsdir()
returns NVARCHAR(4000)
AS
  BEGIN
      DECLARE @rc  INT,
              @dir NVARCHAR(4000),
              @key NVARCHAR(4000)

      SET @key = N'Software\Microsoft\Microsoft SQL Server\' + Replace(Cast(Serverproperty('ProductVersion') AS CHAR(2)), '.', '') + '0' + '\Tools\ClientSetup'

      EXEC @rc = master.dbo.Xp_regread
        N'HKEY_LOCAL_MACHINE',
        @key,
        N'Path',
        @dir output,
        'no_output'

      RETURN @dir
  END 
```

# c++ - 从 C++ 中的 std::string 获取字节

> ID：505021
> 
> 赞同：32
> 
> 时间：2009-02-02T21:28:58.480
> 
> 标签：c++, string

我在一个 C++ 非托管项目中工作。

我需要知道如何获取像“一些要加密的数据”这样的字符串并获得一个字节 [] 数组，我将使用它作为 Encrypt 的源。

在 C# 我做

```
 for (int i = 0; i < text.Length; i++)
    buffer[i] = (byte)text[i]; 
```

我需要知道的是如何做同样的事情，但使用非托管 C++。

谢谢！

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-02T21:34:41.073

如果您只需要只读访问权限，那么[`c_str()`](http://en.cppreference.com/w/cpp/string/basic_string/c_str)将这样做：

```
char const *c = myString.c_str(); 
```

如果您需要读/写访问权限，则可以将字符串复制到向量中。向量为您管理动态内存。然后，您不必弄乱分配/解除分配：

```
std::vector<char> bytes(myString.begin(), myString.end());
bytes.push_back('\0');
char *c = &bytes[0]; 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-02-02T21:59:49.510

[`std::string::data`](http://en.cppreference.com/w/cpp/string/basic_string/data)似乎是足够和最有效的。如果您想使用非常量内存来操作（加密很奇怪），您可以使用[memcpy](http://opengroup.org/onlinepubs/007908799/xsh/memcpy.html)将数据复制到缓冲区：

```
unsigned char buffer[mystring.length()];
memcpy(buffer, mystring.data(), mystring.length()); 
```

STL 粉丝会鼓励你改用[std::copy](http://www.sgi.com/tech/stl/copy.html)：

```
std::copy(mystring.begin(), mystring.end(), buffer); 
```

但这确实没有太大的好处。如果您需要空终止使用`std::string::c_str()`和其他人提供的各种字符串复制技术，但我通常会避免这种情况，只需查询`length`. 特别是对于密码学，您只知道有人会尝试通过将空值推入其中来尝试破解它，并且使用`std::string::data()`会阻止您懒惰地对字符串中的底层位进行假设。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T21:42:45.957

通常，加密函数采用

```
encrypt(const void *ptr, size_t bufferSize); 
```

作为论据。您可以直接传递 c_str 和 length ：

```
encrypt(strng.c_str(), strng.length()); 
```

这样，分配或浪费了额外的空间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T21:37:39.400

如果您想获取 char_t 缓冲区指针，则可以从 std::string 使用 c_ptr() 方法。

看起来您只想将字符串的字符复制到新缓冲区中。我会简单地使用[std::string::copy](http://www.cplusplus.com/reference/string/string/copy.html)函数：

```
length = str.copy( buffer, str.size() ); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T22:42:37.023

如果您只需要读取数据。

```
encrypt(str.data(),str.size()); 
```

如果您需要数据的读/写副本，请将其放入向量中。（不要动态分配空间，这是向量的工作）。

```
std::vector<byte>  source(str.begin(),str.end());
encrypt(&source[0],source.size()); 
```

当然我们都假设字节是一个字符！！！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-05-19T13:29:00.973

在`C++17`及以后您可以使用`std::byte`来表示实际的字节数据。我会推荐这样的东西：

```
std::vector<std::byte> to_bytes(std::string const& s)
{
    std::vector<std::byte> bytes;
    bytes.reserve(std::size(s));

    std::transform(std::begin(s), std::end(s), std::back_inserter(bytes), [](char c){
        return std::byte(c);
    });

    return bytes;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T21:38:58.163

如果这只是普通的香草 C，那么：

```
strcpy(buffer, text.c_str()); 
```

假设缓冲区已分配并且足够大以容纳“文本”的内容，这是原始代码中的假设。

如果 encrypt() 采用 'const char *' 那么你可以使用

```
encrypt(text.c_str()) 
```

而且您不需要复制字符串。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-10-31T10:49:25.263

您可能会使用[基于范围的](https://en.cppreference.com/w/cpp/language/range-for)for 循环，如下所示：

```
std::vector<std::byte> getByteArray(const string& str)
{
    std::vector<std::byte> buffer;
    for (char str_char : str)
        buffer.push_back(std::byte(str_char));

    return buffer;
} 
```

* * *

## 回答 #9

> 赞同：-7
> 
> 时间：2009-02-03T18:42:59.017

我认为您不想使用那里的 c# 代码。他们提供 System.Text.Encoding.ASCII（也是 UTF-*）

```
string str = "some text;
byte[] bytes = System.Text.Encoding.ASCII.GetBytes(str); 
```

您的问题源于忽略 c# 中的编码而不是您的 c++ 代码

# c - 在 Linux 上使用 I2C 进行读/写

> ID：505023
> 
> 赞同：14
> 
> 时间：2009-02-02T21:29:30.197
> 
> 标签：c, linux, ioctl, i2c

我正在尝试读取/写入`FM24CL64-GTR FRAM`通过地址上的 I2C 总线连接的芯片`0b 1010 011`。

当我尝试写入 3 个字节（数据地址 2 个字节，+ 数据 1 个字节）时，我收到一条内核消息 ( `[12406.360000] i2c-adapter i2c-0: sendbytes: NAK bailout.`)，并且写入返回 != 3。请参见下面的代码：

```
#include <linux/i2c-dev.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdint.h>

int file;
char filename[20];
int addr = 0x53; // 0b1010011; /* The I2C address */
uint16_t dataAddr = 0x1234;
uint8_t val = 0x5c;
uint8_t buf[3];

sprintf(filename,"/dev/i2c-%d",0);
if ((file = open(filename,O_RDWR)) < 0)
    exit(1);

if (ioctl(file,I2C_SLAVE,addr) < 0)
    exit(2);

buf[0] = dataAddr >> 8;
buf[1] = dataAddr & 0xff;
buf[2] = val;

if (write(file, buf, 3) != 3)
    exit(3);

... 
```

但是，当我写入 2 个字节，然后再写入另一个字节时，我没有收到内核错误，但是当尝试从 FRAM 读取时，我总是返回 0。这是从 FRAM 读取的代码：

```
uint8_t val;

if ((file = open(filename,O_RDWR)) < 0)
    exit(1);

if (ioctl(file,I2C_SLAVE,addr) < 0)
    exit(2);

if (write(file, &dataAddr, 2) != 2) {
    exit(3);

if (read(file, &val, 1) != 1) {
    exit(3); 
```

这些函数都没有返回错误值，我也尝试过：

```
#include <linux/i2c.h>

struct i2c_rdwr_ioctl_data work_queue;
struct i2c_msg msg[2];
uint8_t ret;

work_queue.nmsgs = 2;
work_queue.msgs = msg;

work_queue.msgs[0].addr = addr;
work_queue.msgs[0].len = 2;
work_queue.msgs[0].flags = 0;
work_queue.msgs[0].buf = &dataAddr;

work_queue.msgs[1].addr = addr;
work_queue.msgs[1].len = 1;
work_queue.msgs[1].flags = I2C_M_RD;
work_queue.msgs[1].buf = &ret;

if (ioctl(file,I2C_RDWR,&work_queue) < 0)
    exit(3); 
```

这也成功了，但总是返回 0。这是否表明硬件问题，或者我做错了什么？

在 Linux 上是否有任何用于 FM24CL64-GTR over I2C 的 FRAM 驱动程序，API 是什么？任何链接都会有所帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-02T21:56:53.200

我没有使用该特定设备的经验，但根据我们的经验，许多 I2C 设备都有需要解决的“怪癖”，通常高于驱动程序级别。

我们也在 Linux 中使用 linux (CELinux) 和 I2C 设备驱动程序。但我们的应用程序代码也有一个重要的 I2C 模块，其中包含所有变通智能，用于处理我们使用过的所有各种设备。

此外，在处理 I2C 问题时，我经常发现我需要重新熟悉源规范：

[http://www.nxp.com/acrobat_download/literature/9398/39340011.pdf](http://www.nxp.com/acrobat_download/literature/9398/39340011.pdf)

以及像样的示波器的使用。

祝你好运，

上面的链接已经失效，这里有一些其他的链接：

[http://www.nxp.com/documents/user_manual/UM10204.pdf](http://www.nxp.com/documents/user_manual/UM10204.pdf) 当然还有维基百科： [http ://en.wikipedia.org/wiki/I%C2%B2C](http://en.wikipedia.org/wiki/I%C2%B2C)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-04T22:35:01.607

NAK 是一个很大的提示：WriteProtect 引脚被外部拉高，并且必须被驱动到地，之后地址和数据字节的单次写入成功（第一个代码段）。

对于读取，可以先写出地址（使用 write()），然后可以从该地址开始读取顺序数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-12-30T18:53:00.207

请注意，使用 the`struct i2c_rdwr_ioctl_data`和 the的方法`struct i2c_msg`（即您给出的最后一个代码部分）比其他方法更有效，因为使用该方法您可以执行 I2c 的重复启动功能。

这意味着您避免了`STA-WRITE-STO -> STA-READ-<data>...-STO`过渡，因为您的沟通将变成`STA-WRITE-RS-READ-<data>...STO`（`RS`=重复开始）。因此，为您节省了多余的`STO-STA`瞬态。

并不是说它在时间上有很大的不同，但是如果不需要它，为什么会失去它……

只是我的 2 克拉。

最好的rgds，

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-01-17T10:32:56.377

你犯了一些错误！

的地址`ic`是`Ax`十六进制的，`x`可以是除了高 4 位之外的任何东西`A=1010` ！！！

# c++ - 在 C++ 中将字符串 (REG_SZ) 值写入注册表

> ID：505024
> 
> 赞同：24
> 
> 时间：2009-02-02T21:29:36.483
> 
> 标签：c++, registry

我有大部分用于向 Windows 注册表写入值的代码，但是当我将路径更改为我为测试而设置的虚拟键和值时，它会失败。我的代码如下：

```
 HKEY hKey;
    LPCTSTR sk = TEXT("SOFTWARE\TestSoftware");

    LONG openRes = RegOpenKeyEx(HKEY_LOCAL_MACHINE, sk, 0, KEY_ALL_ACCESS , &hKey);

    if (openRes==ERROR_SUCCESS) {
        printf("Success opening key.");
    } else {
        printf("Error opening key.");
    }

    LPCTSTR value = TEXT("TestSoftwareKey");
    LPCTSTR data = "TestData\0";

    LONG setRes = RegSetValueEx (hKey, value, 0, REG_SZ, (LPBYTE)data, strlen(data)+1);

    if (setRes == ERROR_SUCCESS) {
        printf("Success writing to Registry.");
    } else {
        printf("Error writing to Registry.");
    }

    LONG closeOut = RegCloseKey(hKey);

    if (closeOut == ERROR_SUCCESS) {
        printf("Success closing key.");
    } else {
        printf("Error closing key.");
    } 
```

所有三个测试都会产生错误状态。

让我感到困惑的是，当我将它指向注册表的其他部分时，我能够运行它。有任何想法吗？

谢谢，布赖恩

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-02-02T21:39:43.250

我觉得很傻。解决方案是需要正确转义字符串中的斜线，如下所示：

```
LPCTSTR sk = TEXT("SOFTWARE\\TestSoftware"); 
```

希望有人发现这很有用...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2015-11-07T20:20:49.233

```
HKEY OpenKey(HKEY hRootKey, char* strKey)
{
  HKEY hKey;
  LONG nError = RegOpenKeyEx(hRootKey, strKey, NULL, KEY_ALL_ACCESS, &hKey);

  if (nError==ERROR_FILE_NOT_FOUND)
  {
    cout << "Creating registry key: " << strKey << endl;
    nError = RegCreateKeyEx(hRootKey, strKey, NULL, NULL,     REG_OPTION_NON_VOLATILE,KEY_ALL_ACCESS,NULL, &hKey, NULL);
  }

  if (nError)
    cout << "Error: " << nError << " Could not find or create " <<      strKey << endl;

  return hKey;
}

void SetintVal(HKEY hKey, LPCTSTR lpValue, DWORD data)
{
  LONG nError = RegSetValueEx(hKey, lpValue, NULL, REG_DWORD,   (LPBYTE)&data, sizeof(DWORD));

  if (nError)
      cout << "Error: " << nError << " Could not set registry value: " << (char*)lpValue << endl;
}

DWORD GetintVal(HKEY hKey, LPCTSTR lpValue)
{
  DWORD data;
  DWORD size = sizeof(data);
  DWORD type = REG_DWORD;
  LONG nError = RegQueryValueEx(hKey, lpValue, NULL, &type, (LPBYTE)&data, &size);

  if (nError==ERROR_FILE_NOT_FOUND)
     data = 0; 
  SetVal() is called.
  else if (nError)
    cout << "Error: " << nError << " Could not get registry value " << (char*)lpValue << endl;

  return data;
}

BOOL SetcharVal(HKEY Key,char* subkey,char* StringName,char* Stringdata)
{
  HKEY hKey = OpenKey(Key,subkey);

  LONG openRes = RegOpenKeyEx(Key, subkey, 0, KEY_ALL_ACCESS , &hKey);

  if (openRes==ERROR_SUCCESS) {

  } else {
    printf("Error opening key.");
  }

  LONG setRes = RegSetValueEx (hKey, StringName, 0, REG_SZ, (LPBYTE)Stringdata, strlen(Stringdata)+1);

  if (setRes == ERROR_SUCCESS) {

  } else {
    printf("Error writing to Registry.");
  }

  LONG closeOut = RegCloseKey(hKey);

  if (closeOut == ERROR_SUCCESS) {

  } else {
    printf("Error closing key.");
  }

}

char* GetCharVal(HKEY Key,char* subkey,char* StringName)
{
  DWORD dwType = REG_SZ;
  HKEY hKey = 0;
  char value[1024];
  DWORD value_length = 1024;
  RegOpenKey(HKEY_LOCAL_MACHINE,subkey,&hKey);
  RegQueryValueEx(hKey, StringName, NULL, &dwType, (LPBYTE)&value,     &value_length);
  RegCloseKey(hKey);
  return value;
} 
```

我正在使用此代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-11-13T09:20:48.133

对于`UNICODE`环境：

```
//Writing to registry
HKEY hKey;
LPCTSTR sk = TEXT("SOFTWARE\\Microsoft\\Windows");

LONG openRes = RegOpenKeyEx(HKEY_LOCAL_MACHINE, sk, 0, KEY_ALL_ACCESS, &hKey);

if (openRes == ERROR_SUCCESS) {
    printf("Success opening key.");
}
else {
    printf("Error opening key.");
}

LPCTSTR value = TEXT("Sample");
WCHAR path[80] = TEXT("C:\\samples\\app.exe");

LONG setRes = RegSetValueEx(hKey, value, 0, REG_SZ, (LPBYTE)path, sizeof(path));

if (setRes == ERROR_SUCCESS) {
    printf("Success writing to Registry.");
}
else {
    printf("Error writing to Registry.");
}

LONG closeOut = RegCloseKey(hKey);

if (closeOut == ERROR_SUCCESS) {
    printf("Success closing key.");
}
else {
    printf("Error closing key.");
} 
```

# perl - 如何使用 Perl 将冒号放入从末尾两个字符的字符串中？

> ID：505028
> 
> 赞同：5
> 
> 时间：2009-02-02T21:30:22.113
> 
> 标签：perl, string

我正在尝试找到一种方法将冒号（ : ）放入字符串中，从字符串末尾开始两个字符。

$meetdays 示例：
1200 => 12:00
900 => 9:00
1340 =>13:40

不确定这应该是正则表达式还是我不知道的另一个函数。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-02T22:42:42.980

也可以使用[substr()](http://perldoc.perl.org/functions/substr.html)以及.....

```
my $string = "1200";
substr $string, -2, 0, ':';

# $string => '12:00'; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-02T21:43:07.470

```
s/(?=..$)/:/ 
```

不要使用 roe 的建议`$&`。perldoc perlvar：

> 在程序中的任何地方使用此变量都会对所有正则表达式匹配造成相当大的性能损失。请参阅“错误”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T21:33:03.607

你可以试试这个：

```
s/..$/:$&/ 
```

它匹配字符串末尾的两个字符，并用冒号和匹配的字符串（即两个字符）替换它。

**编辑**
将 sed-backref 修复为 perl 等效项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T21:46:50.770

roe 的答案“有效”，但它的正则表达式相当不明显。

我会更多

```
s/(^.*)(..$)/$1:$2/ 
```

因为我只是*喜欢*反向引用。

它对你正在做的事情来说太过分了，但对我来说它更具语义表现力。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-02-02T21:45:21.757

sed 的 & 的 Perl 等价物是 $&，所以它应该是：

```
 $s = s /..$/:$&/s; 
```

# .net - 使用 .Net 开发 Robocode 类型的游戏，用于学校作业

> ID：505040
> 
> 赞同：12
> 
> 时间：2009-02-02T21:33:35.867
> 
> 标签：.net, projects-and-solutions, project-planning, robocode

我现在在学校的最后一年，正在攻读计算机研究国家高级文凭，基本上在这最后一个学期，我们需要开发一个软件项目，它基本上包含一个*完整*的系统。

现在，我想做的是类似于[Robocode](http://robocode.sourceforge.net/)的事情，但我将使用 .Net 框架而不是 Java。

* * *

## 什么是机器人代码？

对于那些不知道 Robocode 是什么的人，它基本上是一种编程游戏，人们在其中使用类接口和现有可下载类中的方法开发自己的机器人，然后他们在一场自主战斗中相互战斗*。*竞技场......像这样：

[替代文字 http://articles.techrepublic.com.com/i/tr/cms/contentPics/robocode.gif](http://articles.techrepublic.com.com/i/tr/cms/contentPics/robocode.gif)

* * *

所以基本上，正如我所说，我想使用 .Net 框架重新创建这种场景。我在 StackOverflow 上发布了这个问题，希望更有经验的开发人员能够指导我为这个项目找到正确的方向.

到目前为止，我的想法基本上是创建：

*   一个离线应用程序，将用作战场和用户界面，以与现有机器人等创建新的战斗。
*   一个在线界面，玩家可以使用它来注册新机器人、查看过去的锦标赛分数等......
*   显然，玩家将需要使用类接口来创建他们的机器人。

* * *

## 动画和图形（用于实战）

现在，当战斗发生时，当然会有某种动画和运动，我还没有决定用什么作为媒介。

我目前想到的选项是：

*   正如我在上面第一个要点中所说的那样，开发一个将作为战场的离线应用程序，所有动画将主要使用 C# 代码完成
*   或者开发一个将处理动画的 Silverlight 应用程序（因此，将场景从离线应用程序更改为现在的在线应用程序
*   或者，也许是其中最不可行的一种，使用 JavaScript 创建战斗动画，比如[Canvas](http://https://developer.mozilla.org/en/Canvas_tutorial)

**您认为什么更适合这种特殊情况？**

* * *

## 开发类和接口

对于开发机器人的玩家，我将提供某些类接口，他们将能够像在 Robocode 中一样使用它们。

此类事件和方法的示例可能包括：

```
public void run () {}
public void onScannedRobot(ScannedRobotEvent e) {}

walk(/* ammount in pixels or w/e to walk to */);
turnRight(/* value in degrees for an angular turn */);
//etc... 
```

这是 Robocode (Java) 中的代码片段：

```
public class MyFirstRobot extends Robot {
    public void run() {
        while (true) {
             ahead(100);
             turnGunRight(360);
             back(100);
             turnGunRight(360);
         }
    }
} 
```

然后为了真正让战斗发生，我正在考虑使用反射来实际读取用户实际使用的方法并实现它们以在战斗的特定时刻运行和调用等等。

* * *

现在，我恳请各位经验丰富的开发人员，指导我完成我的这个项目，并建议我需要做什么......对于初学者来说，***这个项目是否可行？*** 如果确实如此，***我需要从哪里开始我的项目？***

* * *

至于我打算使用的技术和软件是：

*   .NET Framework 3.5，带有 C# 3.0
*   LINQ（语言集成查询）
*   SQL Server 2008
*   微软视觉工作室 2008
*   jQuery 框架
*   可能是银光

* * *

我感谢大家，即使在我的问题中设法阅读到这一点，我将需要并非常感谢我能获得的所有帮助来完成这个项目。

感谢您的时间和精力。

* * *

顺便说一句，到目前为止，除了[Robocode](http://robocode.sourceforge.net/)之外，我发现这些游戏与我正在尝试创建的游戏相似：

*   [机器人](http://home.gna.org/nrobot/)
*   [Virii](http://vrs-net.sourceforge.net/)（感谢[马克](https://stackoverflow.com/questions/505040/developing-a-robocode-type-game-with-net-for-a-school-assignment#505076)）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-02T21:49:00.517

> 这个项目可行吗？

听起来很大。我不知道你有多少时间。这是一个经验法则：

*   当截止日期发生时，如果交付 90% 功能的系统的 90% 是 100% 完成的，那么您可能会说该项目至少 90% 成功。

*   OTOH，如果交付 100% 功能的 100% 软件只完成了 90%（即未完成），那么什么都没有完成，项目就失败了。

因此，成功的关键是“增量开发”和“持续交付”。您的项目规范说：

> 我们需要开发一个软件项目，它基本上包含一个*完整*的系统。

为此，我建议：

1.  创建（即设计、开发和测试）一个**小的整体**系统
2.  重复{备份或版本控制您所拥有的；向系统添加一个新的、完整的一点点，并对其进行测试，直到它令人满意为止 } 直到（你的时间用完了）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-02T23:01:27.843

当我开始使用 WPF（与 Silverlight 非常相似）时，我最终花了很多时间来弄清楚如何做事。与我尝试过的其他方法相比，这是一种非常不同的 GUI 制作方式，而且似乎有十亿种不同的方式来做事。我的观点是，如果您没有使用 WPF/Silverlight 的经验，我怀疑您将花费大量时间来思考问题。我想这取决于你已经知道什么。

除此之外，我全心全意地支持 ChrisW 关于增量开发的建议。我会告诉你如何处理游戏的设计。从一个非常简单的机器人 API 开始，比如两个没有事件、输入或世界知识的函数。刚开始让机器人移动。关键是要获得一个功能齐全且功能简单的程序，包括从加载客户端代码到显示结果“战斗”的所有部分。

每个机器人都应该使用一个方法 run() 实现一个接口，并在它们自己的 dll 文件中。当战斗开始时，每个实现了接口的 dll 从某个位置加载（使用反射）并实例化。然后用循环开始战斗，直到 1 分钟过去（或其他什么，只是为了看看发生了什么）：

```
while (time is not up)
   generate random sequence for bots
   call run() on each bot
   draw(world) 
```

时间一到，战斗就结束了。现在您有了一个可以开始充实的骨架应用程序，它可以让您拥有一个工作程序，即使您没有时间制作您想要的所有功能。在 run 方法中，机器人可以调用您在 API 中定义的几个移动操作。调用这些将改变世界的状态——可能只是一个瓷砖网格，以及每个机器人的位置。

下一步可能是将世界视图添加到机器人的 run 方法中，将循环更改为：

```
while (time is not up)
   generate random sequence for bots
   call run(WorldView) on each bot
   draw(world) 
```

假设机器人仍然只能在其运行方法中执行几个移动操作。现在他们可以选择了解世界（或他们的一部分），这使他们能够接近或远离敌人并避开墙壁。

在下一次迭代中，您可以创建一个 API 函数来射击您的大炮（或任何适合您游戏的东西）。实现它如何改变世界状态，如何跟踪子弹以及如何表示动画等。循环可能看起来像这样：

```
while (time is not up and there are more than 1 bot alive)
   advance projectiles
   calculate projectile-bot collisions and damage
   generate random sequence for bots
   call run(WorldView) on each bot
   draw(world) 
```

我希望这能让您了解如何迭代地充实程序，同时拥有一个反映游戏所有领域的工作程序。我在实施游戏方面没有太多经验，因此您应该以批判的眼光看待我的建议，但这就是我要解决的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T21:40:42.700

这是非常可行的。

我建议从响应“已编译”机器人代码的后端系统和对象开始。“编译”的代码采用什么形式是你的全部。

然后，为机器人代码创建解释器。或者，听起来您可能只能制作 .NET 类。这是最难的部分的免费赠品。

最后，创建您可能需要的任何用户界面……一切就绪。

您可能希望将机器人编译为 .dlls ...尽管如此，您只需要为它们创建通用接口和功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T23:16:39.030

可行性完全取决于您的团队的能力，对框架的熟悉程度等。我见过有人可以在一周内完成类似的事情，而其他人却无法做到以挽救生命。

您提到的反思方法听起来像是错误的轨道，除非我误解了您。您的“Robot”基类应该允许开发人员覆盖一个或多个方法，他们可以从中调用“Shoot”、“Move”等函数。

另一个与此类似的应用程序是 Terrarium。开发人员可以对动物进行编码，并在分布式环境中将它们与其他动物进行比较。这是一个 .NET 1.1 演示应用程序，有点过时了，但其中一些原则可能对您仍然有帮助。这家伙已经开始重写它： [http ://weblogs.asp.net/bsimser/archive/2008/07/16/reintroducing-terrarium-now-with-2-0-goodness.aspx](http://weblogs.asp.net/bsimser/archive/2008/07/16/reintroducing-terrarium-now-with-2-0-goodness.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T21:42:10.233

那么，有点像[virii](http://vrs-net.sourceforge.net/)呢？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-15T00:12:49.810

Real Robocode 将很快获得运行 .NET 机器人的插件。我花了 2 年的时间来实现这一目标。第一年重构原始 Robocode。第二个关于[Java 到 .NET 的桥](http://jni4net.sf.net/)。还有[alpha 位](http://zamboch.blogspot.com/2010/01/robocode-net-alpha-bits.html)。这种方法的好处是您可以使用最好的 Java 机器人。机器人里其实藏着大宝。

# linq - 将数据集转换为 IQueryable 或 IEnumerable

> ID：505054
> 
> 赞同：12
> 
> 时间：2009-02-02T21:36:01.883
> 
> 标签：linq, datatable, ienumerable, iqueryable

由于还没有 Linq to DB2（来吧 IBM！），并且我想在我的代码中处理 IQueryables 或 IEnumerables，我将如何将 DataTable 转换为 IQueryable？还是一个 IEnumerable？

我有一个接口和一个与数据表中的列匹配的类...

```
IQueryable<IMyData> GetAS400Data(..parameters..)
{
    DataSet d = GetData();
    ...
    //Some code to convert d to IQueryable<IMyData>
} 
```

DataTable.Rows 不支持 .AsQueryable，因为 MSFT 取消了它，所以我不知道该怎么做。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-02T22:01:54.577

```
table.AsEnumerable()...

table.AsEnumerable().AsQueryable()... 
```

但是，您需要为`Select`您的类型编写自己的翻译 ( )；并且`IQueryable<T>`仍将使用 LINQ-to-Objects；`IQueryable<T>`使用over的唯一目的（在这种情况下）是`IEnumerable<T>`出于其他原因使用表达式 - 可能是用于[动态 LINQ 库](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T21:57:10.827

[看看这里](http://blogs.msdn.com/adonet/archive/2009/01/26/entity-framework-enabled-providers-lists.aspx)，似乎存在具有 DB2 实体框架的提供程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-30T11:20:16.750

你可以使用这样的东西。

```
DataSet ds = GetData();
DataTable dt= ds.Tables[0];
var query =
    from row in dt.AsEnumerable() 
    select new IMyData()
    {
        property1= row[0],
        property2= row[1]
    }; 
```

# sql - PSEXEC...DTEXEC 错误 128

> ID：505057
> 
> 赞同：0
> 
> 时间：2009-02-02T21:37:03.800
> 
> 标签：sql, sql-server, ssis, psexec

我在批处理文件中使用 PSEXEC 来执行 DTEXEC（SQL SSIS 作业）作为调度系统的一部分。我发现当一堆作业一起触发（甚至彼此接近）时，我收到多条 ERROR 128 消息，并且 DTEXEC 作业立即中止。我猜在运行多个 DTEXEC 实例（或至少允许的最大数量）时存在某种问题。

除了错开作业之外，还有其他设置或方法可以避免错误吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-01T13:26:42.510

听起来与此处解决的此错误类似：

[使用 dtexec 实用程序执行 SSIS 包](https://stackoverflow.com/questions/805424/ssis-package-execution-using-dtexec-utility)

# geolocation - 下载准确的纬度/经度/纬度数据的最佳位置在哪里？

> ID：505059
> 
> 赞同：3
> 
> 时间：2009-02-02T21:37:14.550
> 
> 标签：geolocation, gps

我确定这是在某处公开可用的，但我的 google-fu 让我失望了。我想做的是下载世界上可用的最准确的纬度/经度/纬度数据。这可以排除海洋区域。另外，我不需要地址。大多数情况下，我需要的是：给定纬度/经度，alt是什么？谷歌地图目前没有可用的高度数据，我不想使用公共网络服务，因为没有 SLA。

我能找到的最好的是：[http](http://www.geonames.org/export/) ://www.geonames.org/export/ ...事实上，它们也是为什么我不能使用公共网络服务进行这些查找的一个很好的例子：[http://geonames.wordpress.com/2009/01/25/what-to-do-against-ddos-effects/](http://geonames.wordpress.com/2009/01/25/what-to-do-against-ddos-effects/)

提前致谢！！！！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T21:53:40.617

[您可以在http://seamless.usgs.gov/](http://seamless.usgs.gov/)下载美国的数字高程模型

我相信它也有国际数据，但这不太准确。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T21:40:59.503

我目前不知道在哪里可以找到它，但是您应该在谷歌上搜索的术语是“数字高程模型”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T21:45:55.500

你可以得到维基百科的地理定位文章：

*   使用维基百科 API：[http ://en.wikipedia.org/w/api.php](http://en.wikipedia.org/w/api.php)
*   通过 DBpedia [http://wiki.dbpedia.org/Downloads32#geographiccoordinates](http://wiki.dbpedia.org/Downloads32#geographiccoordinates)
*   通过 freebase [http://www.freebase.com/view/location/location](http://www.freebase.com/view/location/location) + freebase API

# cocoa - 处理多个 NSTableView(s) 的最佳方法

> ID：505062
> 
> 赞同：6
> 
> 时间：2009-02-02T21:37:42.113
> 
> 标签：cocoa

在不使用 Cocoa 绑定的情况下处理多个 NSTableView 的最佳方式是什么？

在我的应用程序中，我有两个非常密切相关的 NSTableView，我使用相同的对象作为委托和数据源。问题是两个 tableView 调用相同的方法。我目前根据 NSControl -tag 区分两个 tableView。

我越深入了解这段代码，使用 -tag 看起来就越难看。我最终创建了大量重复的代码来区分每个委托/数据源方法中的 tableViews。代码最终明显是非面向对象的。

我可以创建一个单独的对象来处理一个或另一个 tableView，但是创建所述对象将是一个很大程度上人为的构造，只是为了提供一个不同的委托/数据源。

现在每个人都在使用 Cocoa Bindings 吗？我避免使用绑定，因为我想在 Mac OS 和 iPhone 之间可转移的技术上磨练我的 Cocoa 技能。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-02T22:22:45.267

NSTableView 的每个委托/数据源方法都传递调用它的 NSTableView 实例作为第一个参数（除了传递 NSNotification 对象的那些，在这种情况下，NSNotification`object`是表视图实例）。一些例子包括：

`- (int)numberOfRowsForTableView:(NSTableView*)aTableView;`

`- (id)tableView:(NSTableView *)aTableView objectValueForTableColumn:(NSTableColumn*)aTableColumn row:(NSInteger)rowIndex`

`- (void)tableViewSelectionDidChange:(NSNotification *)aNotification`

如果您使用一个控制器对象作为多个表的委托/数据源，您可以使用该参数来区分它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-05-22T12:45:20.553

对于方法：

```
- (void)tableViewSelectionDidChange:(NSNotification *)aNotification 
```

您可以使用 ：

```
NSTableView *theTable = (NSTableView *)[aNotification object];
if(theTable==listeDesMots)
 ... 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T22:08:44.983

听起来您应该为每个视图使用不同的委托对象，但使用相同的数据源。换句话说，用于不同视图和控制器对象的单个模型。

我不认为这是人为的区别，因为对象有足够不同的目的，但你想使用相同的数据。你现在违反的更大的规则是每个对象都应该有一个单一的目的。每个对象的目的可能是以特定方式检索和显示数据。

祝你好运！

# sql-server - 通过应用程序访问“进程信息”

> ID：505063
> 
> 赞同：0
> 
> 时间：2009-02-02T21:38:00.880
> 
> 标签：sql-server, process

我正在使用 sql 2000

我正在尝试从 microsoft access 访问所有“当前活动 > 进程信息”。我想，下面链接中的 sproc 代码会给我它，但它没有。我在 sp_lock2 上建立数据集并读取信息没有问题，但它不会在企业管理器下的进程信息视图中提取所有数据。

[http://support.microsoft.com/kb/255596](http://support.microsoft.com/kb/255596)

我是 sql server 的新手，但是作为 access/excel 开发人员有几年的经验。

任何帮助深表感谢..

我已经在 sqlteam 上发布了这个。请回复sqlteam线程： [http ://www.sqlteam.com/forums/topic.asp?TOPIC_ID=119037](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=119037)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T21:51:18.483

你试过这个吗？

```
exec sp_who2 
```

# macos - Mac OS X 上功能最全的协作编辑器？

> ID：505066
> 
> 赞同：2
> 
> 时间：2009-02-02T21:39:06.463
> 
> 标签：macos, editor, text-editor, collaboration

我正在寻找一个不烂的协作编辑器:) 并且至少支持 Ruby 语法突出显示。另外，我和一个开发人员将使用它来编程，因此 Google Docs 将无法工作。

实际上，我只需要一个具有项目概念的协作编辑器。两个用户都可以看到项目的文件夹结构，从而可以看到其他用户已经打开和正在编辑的内容。

此外，理想情况下，两个用户都拥有数据的本地副本（没有“你远程进入我，当我们完成后不要保留数据”的东西），这样一个人就可以积极地相互发展代码。

说实话，我找到了这样一个编辑器：[http ://www.n-brain.net/una_ide.html#features](http://www.n-brain.net/una_ide.html#features)

但我真的很想看看是否还有其他东西可以杀死。

我已经尝试过 ECF 和 Eclipse，看起来很有希望，但是没有一个 Ruby IDE 实现了将 ECF 文档共享功能整合到其中的非常简单的方法。

那么，是否有人积极使用协作编辑器？如果是这样，你的设置是什么样的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T21:41:18.050

[SubEthaEdit](http://www.codingmonkeys.de/subethaedit/)是一个优秀的协作编辑器。它允许多个用户同时编辑文件，并讨论它。到目前为止，这是我为这类事情找到的最好的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T21:51:48.060

[Coda](http://www.panic.com/coda/)许可 SubEthaEdit 并包含相同的协作功能。Coda 还有一个项目的概念，包括目录结构。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T19:38:05.497

SubEthaEdit 是相当不错的工具。我喜欢它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-13T18:56:44.120

你似乎有两个不同的问题。

对于 Ruby on Rails，您可能想要这个：[Aptna RadRails](http://www.radrails.org/)。

对于协作编辑器，我自己没有尝试过任何协作编辑器（除了 SubEtha，不是为了实际协作）。但是，如果您还没有看过，这里有一些您可能希望尝试的选项：

*   [Zoho Writer](http://writer.zoho.com/)，这是一个更好的 Google Docs

*   来自 Mozilla 的[Bespin](http://labs.mozilla.com/projects/bespin/)

*   [beWeeVee 记事本](http://www.beweevee.com/)，离线在线替代品

我都是从[AlternativeTo.net得到的](http://alternativeto.net/desktop/subethaedit/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-26T13:49:51.440

[Aquamacs](http://aquamacs.org/)（他们称之为 Emacs for Mac）功能非常丰富，并且还支持协作编辑。在功能列表中很难击败它。请参阅[wiki 上的此列表以自己进行比较](http://en.wikipedia.org/wiki/Comparison_of_text_editors)。最重要的是，它是开源的！然后还有[BBEdit](http://www.barebones.com/products/bbedit/)，但没有协作编辑。

[另请参阅此原始问题以获取完整列表。](https://stackoverflow.com/questions/20533/mac-text-code-editor)

# c# - 如何定义默认浏览器是否打开所需的页面？

> ID：505069
> 
> 赞同：0
> 
> 时间：2009-02-02T21:40:13.280
> 
> 标签：c#, browser

我的程序是用 C# 编写的。它有标签链接。我需要以编程方式定义，当我单击此链接（也以编程方式）时，如果默认浏览器打开所需的页面。C＃

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T21:41:51.013

```
Process.Start("http://example.com"); // <-- put your url there. 
```

另请参阅这篇关于如何发挥最大作用的简短文章：http:
[//code.logos.com/blog/2008/01/using_processstart_to_link_to.html](http://code.logos.com/blog/2008/01/using_processstart_to_link_to.html)

总之：

```
void OpenBrowser(string url)
{
    try
    {
        Mouse.OverrideCursor = Cursors.AppStarting;
        Process.Start(url);
    }
    catch (Exception)
    { //swallow: exception is sometimes thrown even though
    } // the call completed without error
    finally
    {
        Mouse.OverrideCursor = null;
    }
} 
```

# php - 如何比较两个二维数组中的行？

> ID：505074
> 
> 赞同：3
> 
> 时间：2009-02-02T21:41:36.397
> 
> 标签：php, arrays, comparison, filtering, array-difference

似乎我读到的每个用于比较数组（ , 等）的 PHP 函数都会比较`array_diff()`数组`array_intersect()`元素的**存在**。

给定两个具有相同结构的多维数组，您将如何列出**值**的差异？

## 例子

### 阵列 1

```
[用户 1] => 数组（[公共] => 1
                [私人] => 1
                [秘密] => 1
               )
[用户2] => 数组（[公共] => 1
                [私人] => 0
                [秘密] => 0
               )

```

### 阵列 2

```
[用户 1] => 数组（[公共] => 1
                [私人] => 0
                [秘密] => 1
               )
[用户2] => 数组（[公共] => 1
                [私人] => 0
                [秘密] => 0
               )

```

### 区别

```
[用户 1] => 数组（[公共] => 1
                [private] => 0 //这个值不同
                [秘密] => 1
               )

```

所以我的结果是——“在所有用户中，User1 发生了变化，不同之处在于 private 是 0 而不是 1。”

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T21:46:31.613

一种方法是编写一个函数来做类似的事情..

```
function compareArray ($array1, $array2)
{
  foreach ($array1 as $key => $value)
  {
    if ($array2[$key] != $value)
    {
      return false;
    }
  }

  return true;
} 
```

您可以轻松地扩充该函数以返回两者之间的差异数组。

编辑 - 这是一个更类似于您正在寻找的精炼版本：

```
function compareArray ($array1, $array2)
{
  var $differences;

  foreach ($array1 as $key => $value)
  {
    if ($array2[$key] != $value)
    {
      $differences[$key][1] = $value;
      $differences[$key][2] = $array2[$key];
    }
  }

  if (sizeof($differences) > 0)
  {
    return $differences;
  }
  else
  { 
    return true;
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T17:55:51.530

我认为这可以满足您的需求。

使用您的示例数据，对外部数组进行循环，然后`array_diff_assoc`每次都在用户上使用。（注意，这假设当存在差异时，`array_diff_assoc`从传入的第二个数组返回值，这似乎是这样做的）。

```
<?php
$user1 = array("public" => 1, "private" => 1, "secret" => 1);
$user2 = array("public" => 1, "private" =>1, "secret" => 1);
$array1 = array ("user 1"=>$user1, "user 2"=>$user2);

$user1 = array("public" => 1, "private" => 0, "secret" => 1);
$user2 = array("public" => 1, "private" => 1, "secret" => 1);
$array2 = array("user 1"=>$user1, "user 2"=>$user2);

$results = array();  
foreach ( $array1 as $user => $value )
{
    $diff = array_diff_assoc( $array1[$user], $array2[$user] );
    if ($diff) {
        array_push($results,array($user=>$diff));   
        }
}

print_r($results);

?> 
```

它返回：

```
Array
(
    [0] => Array
        (
            [user 1] => Array
                (
                    [private] => 1
                )
        )    
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T02:52:15.600

如果您正在寻找值的差异，那么`array_diff_assoc`. http://us2.php.net/manual/en/function.array-diff-assoc.php"> [php 手册](http://us2.php.net/manual/en/function.array-diff-assoc.php)说它“返回一个数组，其中包含array1 中不存在于任何其他数组中的所有**值**" 并给出以下示例：

> 在此示例中，您会看到两个数组中都存在“a”=>“green”对，因此它不在函数的输出中。与此不同，对 0 => "red" 在输出中，因为在第二个参数中，"red" 的键为 1

```
<?php
$array1 = array("a" => "green", "b" => "brown", "c" => "blue", "red");
$array2 = array("a" => "green", "yellow", "red");
$result = array_diff_assoc($array1, $array2);
print_r($result);
?> 
```

> 上面的示例将输出：
> 
> ```
> Array
> (
>     [b] => brown
>     [c] => blue
>     [0] => red
> ) 
> ```

这是你要找的吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T23:18:22.473

试试这个功能：

```
function arrayDiff($array1, $array2)
{
    if (!is_array($array1) || !is_array($array2)) {
        return false;
    }
    foreach ($array1 as $key => $val) {
        if (array_key_exists($key, $array2) && gettype($val) != "array" && $val === $array2[$key]) {
            unset($array1[$key]);
            continue;
        }
        if (is_array($val)) {
            $val = diff($val, $array2[$key]);
            if ($val !== false) {
                $array1[$key] = $val;
            }
        }
    }
    return $array1;
}

$array1 = array(
    array(
        array('foo', 'bar', 'baz'),
        0
    )
);
$array2 = array(
    array(
        array('foo', 'bar')
    )
);
var_dump(diff($array1, $array2)); 
```

# visual-studio-2008 - 如何在 Visual Studio 2008 中的整个解决方案上运行 FxCop

> ID：505084
> 
> 赞同：4
> 
> 时间：2009-02-02T21:43:14.177
> 
> 标签：visual-studio-2008, code-analysis, fxcop

必须有简单的方法，我不想在每个项目上单独运行代码分析。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T23:27:40.927

抱歉之前的愚蠢回应......这就是你真正要做的:)

将每个项目设置为在构建时运行代码分析：

*   右键单击该项目，
*   转到代码分析选项卡
*   单击“在构建时启用代码分析”

构建解决方案时，它将在每个项目上运行 CA

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T15:08:32.543

我编写了一个自定义的 MsBuild 任务来执行此操作。

[http://ripper234.com/p/msbuild-fxcopsolution-task/](http://ripper234.com/p/msbuild-fxcopsolution-task/)

# iphone - iPhone 开发的最低规格笔记本电脑？

> ID：505087
> 
> 赞同：4
> 
> 时间：2009-02-02T21:44:08.123
> 
> 标签：iphone, opengl

我正在研究 iPhone 的开发。很可能我会在移动中工作，所以需要一台笔记本电脑来开发。我可以用来为 iPhone 开发的最低规格笔记本电脑是什么？开发很可能包括 OpenGL 工作。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-02T22:05:13.383

您需要 Intel 处理器和 OS X Leopard (10.5)。对于一台新机器，一台[入门级的白色 MacBook](http://apple.com/macbook)就可以了。如果你的预算太高，我会关注 Apple 的[翻新页面](http://store.apple.com/us/browse/home/specialdeals/mac?mco=MTE3NjY)，甚至求助于 eBay 或 Craigslist（你可能会遇到柠檬，但 Mac 的使用寿命往往很长，而且我已经购买了几台二手机器没有问题；当然是 YMMV。）

性能要求（相对）微薄。只要它有英特尔芯片（Core Duo 或 Core Duo 2），你就可以了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T21:47:59.910

iPhone 本身并不是一个特别强大的设备，因此您使用的笔记本电脑也不需要超级强大。我有一台基本的 MacBook，它适用于 iPhone 开发。但请记住，您确实需要一个英特尔处理器。因此，G4 Powerbook 或类似设备不会削减它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T21:48:57.490

您可以使用任何基于 Intel 的标准白色[Macbook](http://store.apple.com/us/browse/home/shop_mac/family/macbook)进行此操作。你能找到的最便宜的英特尔 MacBook 真的可以解决问题。如果您在 ebay 上搜索，即使是[较旧的 Intel Core Duo 基础 MacBook](http://shop.ebay.com/?_from=R40&_trksid=m38.l1313&_nkw=MacBook+Intel+Core+Duo&_sacat=See-All-Categories)也可以。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T21:50:15.177

找一个有延长保修期的二手的，它会很好用。如果你有一个成功的应用程序，你无论如何都会有钱购买你想要的任何东西。不要让它成为现在开始创造价值的阻碍。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-02T21:46:27.650

我正在开发一台 2Gb MacBook - 最后一批型号之一，而不是 Pro - 与系留 iPod touch。工作正常。

在许多方面，您不想要太强大的东西，因为您的目标系统本身并没有太多的处理能力。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-02T21:48:41.077

您获得的任何（新）Mac 笔记本电脑都应该能够很好地处理 iPhone 应用程序的开发。iPhone 的功能远不及当前最弱的 Mac 笔记本电脑系列，因此它们中的任何一款都应该可以正常工作。

如果您真的想保存，您甚至可以购买旧的使用过的 Mac 笔记本电脑。我个人会说你应该只考虑基于英特尔的，但我不知道这是否是实际要求。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-02T22:09:45.903

像其他人一样，我建议使用任何 Macbook。如果你想要比最便宜的更便宜的，你可以看看[Apple Special Deals](http://store.apple.com/us/browse/home/specialdeals)商店，在那里你会找到经过 Apple 认证的翻新 Mac。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-02T23:10:35.610

我的建议是：选择屏幕尺寸适合您生活方式的。（我使用 13 英寸，因为我经常把笔记本电脑拖在自行车上，尽管 15 或 17 英寸会让我更有效率。）一旦你选择了屏幕尺寸，就找一个预算允许的最快的（我很好一个cheepskate - 所以我有入门级。）一旦你买了一个 - 从第三方供应商那里升级你的内存（他们比苹果便宜得多。）

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2015-07-31T10:37:19.057

您可以根据预算选择 13 英寸或 15 英寸的 MacBook Pro。[您可以在 Apple 网站http://www.apple.com/macbook-pro/](http://www.apple.com/macbook-pro/)上找到有关 MacBook Pro 的所有信息，或者如果您有预算限制，请访问 Mac Mini [http://www.apple.com/mac-小型的/](http://www.apple.com/mac-mini/)

# build-process - 如何配置 Hudson 为每个构建发送电子邮件，而不仅仅是那些改变项目状态的？

> ID：505101
> 
> 赞同：41
> 
> 时间：2009-02-02T21:47:29.520
> 
> 标签：build-process, continuous-integration, build-automation, hudson

我最近将我的 CI 服务器从旧版本的 CruiseControl 迁移到了 Hudson。我错过 CruiseControl 的唯一功能是能够接收每个构建的电子邮件构建通知，而不仅仅是那些导致项目状态发生变化的通知。

我对所有成功构建的构建通知特别感兴趣。

有人在做这个吗？还是我该学习 Hudson 插件开发了？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-02-02T21:57:29.623

您想安装[Email-ext](http://wiki.hudson-ci.org/display/HUDSON/Email-ext+plugin)插件。它将允许您为每个构建配置电子邮件通知。

我用它来发送成功构建的电子邮件。您可以将其配置为将电子邮件发送给提交者或固定的收件人列表。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-04-05T14:35:06.093

配置项目时，在“可编辑电子邮件通知”下，有一个“高级...”按钮，单击该按钮会显示许多项目，包括标有“添加触发器：”的下拉菜单。选项之一是“成功”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-11-22T20:53:25.763

单击 后，您不应看到此错误消息`Hudson->ManageHudson->configure System`。然后配置电子邮件。

# image-processing - 如何设置背景然后使用 GD 或 ImageMagick 创建圆角？

> ID：505111
> 
> 赞同：0
> 
> 时间：2009-02-02T21:50:10.967
> 
> 标签：image-processing, imagemagick

我遇到的问题很简单，希望有 GD 或 ImageMagick 经验的人能解答。

我有一个来源`.gif`（可能有也可能没有透明度）。我想设置一个背景（渐变，虽然细节不重要），把它`.gif`放在上面，然后圆角。圆角区域应该是透明的。请注意，如果*不透明*`.gif`，则背景将不起作用，因为会在其之上。这是可以接受的。*`.gif`*

 ** * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T22:23:37.140

您可能需要使用面罩，请查看[此处](http://www.imagemagick.org/Usage/channels/#masks)的示例。

# .net - 显示/隐藏详细信息 WinForm

> ID：505117
> 
> 赞同：3
> 
> 时间：2009-02-02T21:50:56.113
> 
> 标签：.net, winforms, layout

我正在创建一个 WinForm App(.net3.5)，在其中显示一些客户端详细信息。我的问题是我们有一个与地址相关的方向字段。为了节省空间，我希望隐藏方向，直到用户“希望”看到它们。我的预期方法是对方向进行类似“手风琴”的演示。
我想我也可以使用隐藏字段和*BringToFront()*来做到这一点（这样会更好）。

有人可以就手风琴风格提供一些指导吗？
有什么东西已经存在了吗？
我需要考虑什么特别的事情吗？
在编码我自己的行为时；我会把所有东西都移下来然后备份等吗？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T22:08:03.487

您正在谈论的概念称为[渐进式披露](http://msdn.microsoft.com/en-us/library/aa511487.aspx)。Microsoft 在 UX 指南中提供了一些关于这些类型控件的优秀提示。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-02T22:59:54.710

当我需要这种类型的行为时，我发现它`TableLayoutPanel`很有用。如果包含可扩展内容，您可以将行和列设置为自动调整大小 - 这样，当您隐藏内容时，行会折叠。

如果您有另一个控件（例如按钮），您可以使用它来控制可展开内容的隐藏状态。

例如，创建一个 3 行 1 列的表。在顶部添加一个固定大小的按钮，在中间添加一个自动调整大小的元素。将最后一行设置为百分比大小（您需要这样做，以便在中间行大小为零时占用剩余空间）。然后使用您的按钮更改中间行中任何内容的可见属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T21:56:08.740

我认为您希望将关联的控件组合在面板中，将它们与表单的顶部/底部对齐，然后在用户单击“更多详细信息 >>”/“<< 较少详细信息时以编程方式显示/隐藏适当的面板”。

编辑：我不知道这个特定功能的辅助控件，除了用于分组控件和一次显示/隐藏它们的面板。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T21:57:01.590

如果控件是自由放置的，那么是的 - 你必须向上或向下移动东西。您可以通过将相关控件组封装到面板中来减少工作量：然后您只需移动面板。如果面板是*停靠*的（例如，“顶部”）——那么只需隐藏/显示面板，一切都会自动到位。

# sql-server-2008 - 来自 aspnet_regsql 的意外错误消息

> ID：505119
> 
> 赞同：5
> 
> 时间：2009-02-02T21:51:25.270
> 
> 标签：sql-server-2008, sql-server-express

我正在尝试使用 aspnet___regsql 实用程序在我的本地 SQL Express 2008 实例上的数据库中安装所有成员资格表。我可以在 Management Studio 中毫无问题地连接，但是当我尝试在 aspnet_regsql 界面中列出数据库时，我收到一条错误消息：

```
从 SQL Server 查询数据库名称列表失败。
无效的对象名称“sysdatabases”
```

我究竟做错了什么？我该如何解决？

（请告诉我有比重新安装更顺畅的方法......：P）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-02T22:55:48.557

我已经通过绕过图形界面并直接在命令提示符中执行相同的操作来解决问题，并使用标志指定所有选项。它们应该如下所示：

**使用 SQL 身份验证连接**

```
C:\>Windows\Microsoft.NET\Framework\v2.0.50727\aspnet_regsql.exe -S myHostingServer -A all -d myDatabase -U myUserID -P myPassword
```

**使用 Windows 身份验证连接**

```
C:\>Windows\Microsoft.NET\Framework\v2.0.50727\aspnet_regsql.exe -S myHostingServer -A all -d myDatabase -E
```

不同之处在于行末，SQL Auth. 有`-U myUsername -P myPassword`同时 Windows Auth。有`-E`（为受信任的连接标记）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-19T03:17:25.053

If you want to use the graphical interface, you need to make sure the user you are logged in as has the default db in SQL set to '**master**' so it can connect directly to the sysdatabases table.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-05-21T11:27:34.723

Ensure that in **SQL Server Configuration Manager -> SQL Server Network Configuration -> Protocols for YOUR_SQL_SERVER_INSTANCE_NAME** is enabled `TCP/IP`. NB. for applying this change need to restart YOUR_SQL_SERVER_INSTANCE_NAME

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-06T16:23:22.477

默认情况下，在 Vista 上，计算机上的当前用户不是 SQL Server 2005/2008 上 SysAdmin 的成员。

所以这里是诀窍。

1-从 C:\Program Files\Microsoft SQL Server 2005/2008 打开 Sql Server 外围应用配置工具。

2-当屏幕弹出时，单击添加新管理员。

```
 -on top right make sure that User to provision=Username of the pc
    -on your left (Available Privileges) select Member of SQL Server SysAdmin and click on the right arrow (>)
    -click ok and you should be ready to go. 
```

My name is Talley Ouro,Developer in Raleigh,NC Blog: [http://talleyblogs.blogspot.com/](http://talleyblogs.blogspot.com/) Email:johnstalley@live.com

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-14T16:01:39.810

This issue is generally caused by leaving "Server" to be your machine name instead of the name of your SQL server instance. It's tricky to figure out because they autofill the text box to your machine name, which is needed but incomplete. This may lead you to think "Server" refers to the computer itself when they really mean SQL server instance. If you are connecting to your local machine you can generally append to their entry with the name of your SQL instance and everything will work as intended

IE LOCALHOST must become LOCALHOST\SQLEXPRESS or whatever you name your box\sqlserver

# javascript - 使用 Selenium 访问窗口的属性

> ID：505124
> 
> 赞同：0
> 
> 时间：2009-02-02T21:53:01.333
> 
> 标签：javascript, firefox, selenium

我要测试的页面设置了“全局变量”的值。在 Firebug 中，我可以将它们作为窗口对象的属性来访问（例如 window.foo）。

然而，从 Selenium 中，typeof selenium.browserbot.getCurrentWindow().foo 总是返回“未定义”，例如在 waitForCondition 条件下使用时。知道我可能做错了什么吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T22:25:33.780

我认为它不能完成，它可以使用 unsafeWindow 在greasemonkey 中完成，但是这在 selenium 中不起作用。我试着用

```
添加位置策略
zzz
返回提示（inWindow.a）；

```

然后

```
点击
zzz=xxx

```

但我无法访问它。如果您有任何想法，请告诉我。

如果它是您的页面，也许您可​​以将该变量保存在某个 html 控件中。它是一个黑客，但是......

# asp.net - 刷新图像源

> ID：505140
> 
> 赞同：3
> 
> 时间：2009-02-02T21:59:00.463
> 
> 标签：asp.net, javascript, jquery, asp.net-mvc

k... Strager 能够帮助我一点。但是，它仍然不能正常工作。需要知道 MVC 和 jQuery 的人...

我有一个页面，其中包含一个图像，单击该图像将启动一个对话框，该对话框可以上传文件。对话框关闭后，图像应该使用数据库中上传/存储的内容刷新...

第一次一切都很好。但是，如果我尝试上传第二张图片；第一张图像仍然显示。我的控制器方法似乎也没有被第二次调用......下面是我的代码......

我还消除了页面正在被缓存。同样，控制器方法没有被第二次调用......

**控制器**

```
[AcceptVerbs(HttpVerbs.Get)]
public ActionResult GetImage(Guid parentId)
{
    var la = Helper.Service.GetAttachmentByEntity(parentId, MembershipProvider.SecurityTicket).ToList();
    la.OrderByDescending(x => x.CreatedDate);

    return File(la[0].Data, la[0].ContentType);
} 
```

**看法**

```
<script type="text/javascript">
    $(function() {
        var iphcObject = $('#<%=imagePlaceHolderControl.ClientID %>');

        iphcObject.children().find('#imageUploadDialog').bind('onClose', function() {
            iphcObject.children().find('#image').attr('src', '<%=Url.Action("GetImage", "Image", new { parentId = Model.ParentId }) %>');
        });
    });
</script>

<asp:Panel ID="imagePlaceHolderControl" runat="server">
    <div style="border: solid 1px; width: <%=Model.Width%>; height: <%=Model.Height%>; text-align: center; vertical-align: middle;">
        <a href="#" onclick="$('#imageUploadDialog').dialog('open');" title="Add a picture...">
        <img id="image" src="<%=Url.Content("~/content/images/icon_individual_blank.gif") %>" /></a>
        <%Html.RenderDialog("imageUploadDialog", "Upload image...", "ImagePlaceHolder_Upload", "Image", Model, 235, 335); %>        
    </div>
</asp:Panel> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T22:25:31.783

我不知道 ASP，但是这一行：

```
iphcObject.find('#image').attr('src', '<%=Url.Action("GetNewImage", "Image", new { parentId = Model.ParentId }) %>'); 
```

似乎在最初查看页面时解析，而不是在上传新图像时解析。

要获取新图像的 URL，请在对 POST 请求的响应中发送该数据。这应该很容易，特别是如果您使用 JSON 或原始文本进行传输。

对于 jQuery 方面：

```
$.post('<%=Url.Action("GetImage", "Image", new { parentId = Model.ParentId }) %>', {}, function(data) 
{
    iphcObject.find('#image').attr('src', data.newImageUrl);
}, 'json'); 
```

*如果有人知道如何在 ASP 方面做到这一点，请编辑这篇文章或制作另一个！*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-13T11:23:38.100

您可以添加任意数字以在客户端强制刷新：

```
 <img id="img" src="@Url.Action("GetImage")" alt="random" />
  <script type="text/javascript">

     var src = $("#img").attr("src");
     var count = 0;

     setInterval(function () {
        $("#img").attr("src", src + "?" + count);
        count++;
     }, 3000);

  </script> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T22:06:05.677

#image 不应该是 find('img') 是什么？或者给 IMG 一个“图像”的 ID。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T03:01:08.280

我不知道 ASP，但是……您检查过 HTTP 标头吗？可能是浏览器正在缓存图像 URL。试试 LiveHTTPHeaders for Firefox，看看是什么调用实际发送到服务器。Firebug 在这里也可以提供一些帮助（它跟踪浏览器中的缓存命中与网络调用）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T22:07:54.783

你`<img>`没有 id`image`所以`.find('#image')`没有返回任何元素。

# c++ - 从shared_ptr 得到一个正常的ptr？

> ID：505143
> 
> 赞同：60
> 
> 时间：2009-02-02T22:01:46.903
> 
> 标签：c++, boost, smart-pointers, shared-ptr

我有类似`shared_ptr<Type> t(makeSomething(), mem_fun(&Type::deleteMe))` 现在需要调用需要指向`Type`. 我如何从中得到它`shared_ptr`？

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-02-02T22:04:50.530

使用[`get()`](http://www.boost.org/doc/libs/1_37_0/libs/smart_ptr/shared_ptr.htm#get)方法：

```
boost::shared_ptr<foo> foo_ptr(new foo());
foo *raw_foo = foo_ptr.get();
c_library_function(raw_foo); 
```

确保您`shared_ptr`在库函数完成之前不会超出范围 - 否则可能会导致错误，因为库可能会在指针被删除后尝试对指针执行某些操作。如果库函数在返回后保留原始指针的副本，请特别小心。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-02-02T22:41:11.563

另一种方法是使用`&`和`*`运算符的组合：

```
boost::shared_ptr<foo> foo_ptr(new foo());
c_library_function( &*foo_ptr); 
```

虽然我个人更喜欢使用该`get()`方法（这确实是正确的答案），但它的一个优点是它可以与其他重载的类一起使用`operator*`（指针取消引用），但不提供`get()`方法。例如，在通用类模板中可能很有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-05-05T04:05:32.943

对于 std::shared_ptr （C++11 及更高版本），还有一个获取原始指针的 get 方法。[关联](https://www.cplusplus.com/reference/memory/shared_ptr/get)

# asp.net - 在 SqlDataSource 中注入记录

> ID：505145
> 
> 赞同：0
> 
> 时间：2009-02-02T22:01:56.277
> 
> 标签：asp.net, sqldatasource

我想就如何将记录注入我的 DropdownList 以提供“全部”选项的建议。这是我的代码，数据来自 Northwind 数据库。

```
<asp:DropDownList ID="ddlRegion" runat="server" DataSourceID="SqlDataSource1" 
    DataTextField="RegionDescription" DataValueField="RegionID" 
        AutoPostBack="True" onselectedindexchanged="ddlRegion_SelectedIndexChanged" />
<asp:SqlDataSource ID="SqlDataSource1" runat="server" 
    ConnectionString="<%$ ConnectionStrings:NorthwindConnectionString %>" 
    SelectCommand="SELECT [RegionID], [RegionDescription] FROM [Region]" 
        ondatabinding="SqlDataSource1_Databinding">
</asp:SqlDataSource> 
```

我尝试了以下方法，但它没有添加该项目；

```
if(!Page.IsPostBack())
ddlRegion.Items.Insert(0, new ListItem("All", "-1")); 
```

我在想也许使用 ondatabinding 可能是正确的方法，但我不确定如何去做。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T22:03:52.950

只需在 ASPX 中添加 All 项，然后设置 AppendDataBoundItems=true，它将保留静态定义的项和数据绑定项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T22:12:47.893

Timbagas 提出了一个很好的建议，另一个是使用存储过程并在那里进行追加，以便返回的记录集包括“全部”选项以及您想要的行。

# c++ - CUDA + Visual Studio = 抑制输出窗口

> ID：505151
> 
> 赞同：3
> 
> 时间：2009-02-02T22:04:47.957
> 
> 标签：c++, visual-studio, cuda

通常，当我使用 Visual Studio 进行构建时，我会在输出窗格中看到警告和错误，例如

```
1>------ Build started: Project: pdcuda, Configuration: Release x64 ------
Compiling...
foo.cpp
Linking...
foo.obj : error LNK2001: unresolved external symbol "foo"
========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ========== 
```

我正在使用[CUDA](http://www.nvidia.com/object/cuda_home.html)进行一些 GPU 编程。升级到 2.1 后，我不再在 Visual Studio 中获得任何有用的输出。例如，我现在看到的是：

```
1>------ Build started: Project: pdcuda, Configuration: Release x64 ------
========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ========== 
```

其他详细信息可以在 BuildLog.htm 中找到，但是一直查找该文件很不方便。

有谁知道如何强制 Visual Studio 在其输出窗格中显示输出？

没有帮助的事情：

*   *卸载 CUDA：*问题在所有项目中仍然存在
*   *工具 > 选项 > 项目和解决方案 > 构建和运行 > MSBuild 项目构建输出详细程度：*更改此下拉菜单，即使更改为“诊断”也没有明显的效果。

**编辑：**没有帮助的其他事情：

*   devenv.exe /resetsettings
*   devenv.exe /resetuserdata

**更新** *（响应 Die in Sente）*：它现在正在两台机器中的一台上工作（虽然我不确定我做了什么来修复它）。仍然有问题的机器安装了一个[CUDA Visual Studio 向导](http://sourceforge.net/projects/cudavswizard)，该向导以前曾引起过类似的问题。仍然损坏的机器的编译器版本为 15.00.21022.8。工作机有15.00.30729.1。进行备份后，我将“C:\Program Files (x86)\Microsoft Visual Studio 9.0\VC\BIN\amd64”从工作机器转移到损坏的机器上。我观察到损坏机器的行为没有变化。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-27T05:44:12.260

我有完全相同的问题，但没有 CUDA。今天 Visual Studio 刚刚决定不再显示任何构建消息。它工作正常，然后我的一个构建它刚刚停止工作。这个问题现在在我所有的项目中都存在，并且在重新启动后仍然存在。我还在 buildlog.htm 中看到了正确的消息。这太荒谬了！

编辑：哦，我使用添加/删除程序进行修复，现在它又可以工作了！是的！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T23:00:07.080

您是否尝试过重置 IDE devenv.exe /resetsettings 或 devenv.exe /resetuserdata

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T05:03:25.787

我最近还安装了 CUDA 2.1（我相信是在 2.0 之上）。CUDA 2.1 的默认安装将 SDK 从

C:\Program Files\NVIDIA Corporation\NVIDIA CUDA SDK\

到

C:\Documents and Settings\所有用户\应用程序数据\NVIDIA 公司\NVIDIA CUDA SDK\

这最初给我带来了一些问题。您的所有路径都正确解析吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T10:27:48.287

这听起来像是一个遥远的建议。获取 CUDA SDK 并使用其中的示例 CUDA-C++ 项目尝试您的代码。也许 CUDA v2.1 的构建规则发生了一些变化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-04T07:11:07.813

如果你去工具->选项->项目和解决方案->构建和运行。最后一个属性是“MSBuild Project build output verbosity”。它默认为最小，将其更改为正常，构建消息将显示在输出窗口中。

这也使任何`<Message Text="test message"></Message>`输出都可以显示在 Visual Studio 生成输出窗口中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-06T23:38:05.927

最终解决方案：重新安装操作系统。

# unit-testing - 使用单元测试作为“功能契约”

> ID：505156
> 
> 赞同：4
> 
> 时间：2009-02-02T22:05:34.740
> 
> 标签：unit-testing, deployment

单元测试通常与软件版本一起部署以验证安装 - 即进行安装，运行测试，如果它们通过则安装良好。

我即将开始一个项目，该项目将涉及向客户提供原型软件库版本。单元测试将作为每个版本的一部分交付，除了使用测试来验证安装之外，我还计划使用测试 API 的单元测试作为如何使用该版本的“合同”。如果用户以与单元测试使用它的方式相似的方式使用该版本，那就太好了。如果他们以其他方式使用它，那么所有的赌注都会被取消。

以前有人试过吗？关于这是否是一个好/坏主意的任何想法？

编辑：为了突出 ChrisA 和 Dan 在下面的回复中提出的一个好点，“测试 API 的单元测试”更好地称为集成测试，它们的目的是练习 API 和软件以演示软件的功能客户视角。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-02T22:11:25.650

对我来说听起来是个好主意。我（我们都？）经常在内部使用单元测试来做到这一点。在使用我的单元测试来验证我没有破坏任何东西时，我也在隐含地验证我的 API 合同没有改变。以您正在谈论的方式部署它们似乎是单元测试的自然用法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-02T22:13:13.430

敏捷方法论说：*测试是规范*，所以这是一个非常好的主意。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T22:39:32.380

我完全希望为此而大发雷霆，但我不明白一组单元测试如何证明客户关心的事情，即应用程序是否满足他的业务需求。

这是一个例子：我刚刚完成了一段代码的转换，以修复我们犯的一个大错误。这是一个典型的过度工程案例，这些变化涉及了大约十几个窗口窗体和大约同样多的类。

我花了几天时间，现在它变得简单多了，我们免费获得了一些功能，而且我们丢失了大量的代码，这些代码完成了我们现在知道我们从未真正需要的东西。

这些形式中的每一种以前都可以完美运行。公共方法确实做了他们需要做的事情，并且底层数据访问也很好。

所以任何单元测试都会通过。

除了，可悲的是，他们做错了事——我们没有意识到，除非回想起来。就好像我们已经建立了一个原型，只是在尝试使用它之后才意识到它是不对的。

所以现在我们有了一个更精简、更简洁、更合适的应用程序。

但是错误的事情，在单元测试永远无法揭示它们的级别上是错误的，所以我只是不明白如何通过安装发送一组单元测试除了给人一种错误的安全感之外。

也许我不理解某些东西，但在我看来，除非交付的东西与提供的测试具有相同的*功能，否则它们什么也证明不了。*

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-02T22:26:30.580

这实际上是一个非常好的主意，并且作为 API 用户非常愉快。

这种技术实际上也可以反过来使用：当您使用“旧版”API 时，您可以使用单元测试来记录您认为 API 的行为方式并验证它是否确实按计划运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T01:31:13.187

如果您有兴趣为您的代码提供一组规范，也许您应该研究一些行为驱动的开发工具（nbehave、jbehave、rspec 等）。这些框架支持以 given/when/then 语法描述您的测试，并以自然语言输出格式化结果。有关.NET 的 BDD 工具的示例，请参阅[nbehave 。](http://www.codeplex.com/NBehave)[您可以在此处](http://dannorth.net/whats-in-a-story)找到对 BDD 的出色描述

另一种选择可能是让您使用诸如[fit](http://fit.c2.com)或[Fitnesse](http://www.fitnesse.info)（或仅 java 的[concordion](http://www.concordion.org/)）之类的验收测试框架编写测试，并将这些验收测试与代码一起交付。fit/fitnesse 和 concordion 都允许在纯 HTML 甚至 Word 文档中指定测试。

两种方法（BDD 或验收测试框架）的好处是用户看到的结果更易于阅读和理解。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T08:12:23.097

如果您要发布**代码库**，这听起来很棒。

如果您正在发布一个普通的软件产品，而您的用户只能通过**GUI**与之交互，那么您的单元测试可能无法在相同的抽象级别上工作，或者可能不是评估产品行为的最有用的工具。一本非常好的用户手册（是的，这是可能的）可能会更好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T09:15:57.853

测试将检查要求。

需求定义功能

=> 测试将检查功能。

问题是，只能检查单元测试可以覆盖的功能。集成或整个系统测试将不起作用。

否则，通过单元测试检查功能是 TDD 的主要方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T11:59:31.033

[Meszaros](https://rads.stackoverflow.com/amzn/click/com/0131495054)将此称为“测试作为文档”

# c# - 如何让 WinForms 应用程序全屏显示

> ID：505167
> 
> 赞同：114
> 
> 时间：2009-02-02T22:10:57.693
> 
> 标签：c#, .net, winforms

我有一个 WinForms 应用程序，我正在尝试全屏显示（有点像 VS 在全屏模式下所做的）。

目前，我正在设置`FormBorderStyle`to`None`和`WindowState`to `Maximized`which 给了我更多的空间，但如果它是可见的，它不会覆盖任务栏。

我还需要做什么才能使用该空间？

对于奖励积分，我可以做些什么来让我的`MenuStrip`自动隐藏也放弃那个空间？

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2009-02-03T15:30:55.583

对于基本问题，以下将解决问题（隐藏任务栏）

```
private void Form1_Load(object sender, EventArgs e)
{
    this.TopMost = true;
    this.FormBorderStyle = FormBorderStyle.None;
    this.WindowState = FormWindowState.Maximized;
} 
```

但是，有趣的是，如果您交换最后两行，任务栏仍然可见。我认为这些动作的顺序很难用属性窗口控制。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2013-05-26T22:59:39.967

# 经过测试的简单解决方案

我一直在 SO 和其他一些网站上寻找这个问题的答案，但是一个给出的答案对我来说非常复杂，而其他一些答案根本无法正常工作，所以经过大量代码测试后，我解决了这个难题。

注意：我使用的是**Windows 8**，并且我的任务栏未处于自动隐藏模式。

我发现在执行任何修改之前将 WindowState 设置为 Normal 将停止未覆盖任务栏的错误。

### 编码

我创建了这个有两个方法的类，第一个进入“全屏模式”，第二个离开“全屏模式”。所以你只需要创建这个类的一个对象，并将你想要设置全屏的表单作为参数传递给 EnterFullScreenMode 方法或 LeaveFullScreenMode 方法：

```
class FullScreen
{
    public void EnterFullScreenMode(Form targetForm)
    {
        targetForm.WindowState = FormWindowState.Normal;
        targetForm.FormBorderStyle = FormBorderStyle.None;
        targetForm.WindowState = FormWindowState.Maximized;
    }

    public void LeaveFullScreenMode(Form targetForm)
    {
        targetForm.FormBorderStyle = System.Windows.Forms.FormBorderStyle.Sizable;
        targetForm.WindowState = FormWindowState.Normal;
    }
} 
```

### 使用示例

```
 private void fullScreenToolStripMenuItem_Click(object sender, EventArgs e)
    {
        FullScreen fullScreen = new FullScreen();

        if (fullScreenMode == FullScreenMode.No)  // FullScreenMode is an enum
        {
            fullScreen.EnterFullScreenMode(this);
            fullScreenMode = FullScreenMode.Yes;
        }
        else
        {
            fullScreen.LeaveFullScreenMode(this);
            fullScreenMode = FullScreenMode.No;
        }
    } 
```

我已经在另一个问题上放置了相同的答案，我不确定它是否与这个问题重复。（链接到另一个问题：[如何在任务栏顶部全屏显示 Windows 窗体？](https://stackoverflow.com/questions/2272019/how-to-display-a-windows-form-in-full-screen-on-top-of-the-taskbar)）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-02T23:28:28.023

对于 menustrip 问题，请尝试设置

```
MenuStrip1.Parent = Nothing 
```

在全屏模式下，它应该会消失。

退出全屏模式时，`menustrip1.parent`再次将 重置为表单，菜单栏将再次正常。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-02-12T12:43:35.713

您可以使用以下代码来适应您的系统屏幕并且任务栏可见。

```
 private void Form1_Load(object sender, EventArgs e)
    {   
        // hide max,min and close button at top right of Window
        this.FormBorderStyle = FormBorderStyle.None;
        // fill the screen
        this.Bounds = Screen.PrimaryScreen.Bounds;
    } 
```

无需使用：

```
 this.TopMost = true; 
```

该行干扰`alt+tab`切换到其他应用程序。（“TopMost”表示该窗口位于其他窗口的顶部，除非它们也被标记为“TopMost”。）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-02T23:19:56.587

我最近制作了一个 Mediaplayer 应用程序，我使用 API 调用确保在程序全屏运行时隐藏任务栏，然后在程序未全屏或没有焦点或退出时恢复任务栏。

```
Private Declare Function FindWindow Lib "user32" Alias "FindWindowA" (ByVal lpClassName As String, ByVal lpWindowName As String) As Integer
Private Declare Function FindWindowEx Lib "user32" Alias "FindWindowExA" (ByVal hWnd1 As Integer, ByVal hWnd2 As Integer, ByVal lpsz1 As String, ByVal lpsz2 As String) As Integer
Private Declare Function ShowWindow Lib "user32" (ByVal hwnd As Integer, ByVal nCmdShow As Integer) As Integer

Sub HideTrayBar()
    Try

        Dim tWnd As Integer = 0
        Dim bWnd As Integer = 0
        tWnd = FindWindow("Shell_TrayWnd", vbNullString)
        bWnd = FindWindowEx(tWnd, bWnd, "BUTTON", vbNullString)
        ShowWindow(tWnd, 0)
        ShowWindow(bWnd, 0)
    Catch ex As Exception
        'Error hiding the taskbar, do what you want here..'
    End Try
End Sub
Sub ShowTraybar()
    Try
        Dim tWnd As Integer = 0
        Dim bWnd As Integer = 0
        tWnd = FindWindow("Shell_TrayWnd", vbNullString)
        bWnd = FindWindowEx(tWnd, bWnd, "BUTTON", vbNullString)
        ShowWindow(bWnd, 1)
        ShowWindow(tWnd, 1)
    Catch ex As Exception
        'Error showing the taskbar, do what you want here..'
    End Try

End Sub 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2020-06-24T09:12:29.937

我研究了 Zingd 的想法，使它**更易于**使用。

我还添加了标准**F11 键**来切换全屏模式。

## 设置

现在一切都在 FullScreen 类中，因此您不必在表单中声明一堆变量。您只需在表单的构造函数中实例化一个 FullScreen 对象：

```
FullScreen fullScreen;

public Form1()
{
    InitializeComponent();
    fullScreen = new FullScreen(this);
} 
```

请注意，这假设在您创建 FullScreen 对象时表单未最大化。

## 用法

您只需使用类的功能之一来切换全屏模式：

```
fullScreen.Toggle(); 
```

或者如果您需要明确处理它：

```
fullScreen.Enter();
fullScreen.Leave(); 
```

## 代码

```
using System.Windows.Forms;

class FullScreen
{ 
    Form TargetForm;

    FormWindowState PreviousWindowState;

    public FullScreen(Form targetForm)
    {
        TargetForm = targetForm;
        TargetForm.KeyPreview = true;
        TargetForm.KeyDown += TargetForm_KeyDown;
    }

    private void TargetForm_KeyDown(object sender, KeyEventArgs e)
    {
        if (e.KeyData == Keys.F11)
        {
            Toggle();
        }
    }

    public void Toggle()
    {
        if (TargetForm.WindowState == FormWindowState.Maximized)
        {
            Leave();
        }
        else
        {
            Enter();
        }
    }

    public void Enter()
    {
        if (TargetForm.WindowState != FormWindowState.Maximized)
        {
            PreviousWindowState = TargetForm.WindowState;
            TargetForm.WindowState = FormWindowState.Normal;
            TargetForm.FormBorderStyle = FormBorderStyle.None;
            TargetForm.WindowState = FormWindowState.Maximized;
        }
    }

    public void Leave()
    {
        TargetForm.FormBorderStyle = FormBorderStyle.Sizable;
        TargetForm.WindowState = PreviousWindowState;
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-02T22:12:25.883

您需要将窗口设置为最顶层。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-10-28T14:12:51.407

我不知道它是否适用于 .NET 2.0，但它适用于 .NET 4.5.2。这是代码：

```
using System;
using System.Drawing;
using System.Windows.Forms;

public partial class Your_Form_Name : Form
{
    public Your_Form_Name()
    {
        InitializeComponent();
    }

    // CODE STARTS HERE

    private System.Drawing.Size oldsize = new System.Drawing.Size(300, 300);
    private System.Drawing.Point oldlocation = new System.Drawing.Point(0, 0);
    private System.Windows.Forms.FormWindowState oldstate = System.Windows.Forms.FormWindowState.Normal;
    private System.Windows.Forms.FormBorderStyle oldstyle = System.Windows.Forms.FormBorderStyle.Sizable;
    private bool fullscreen = false;
    /// <summary>
    /// Goes to fullscreen or the old state.
    /// </summary>
    private void UpgradeFullscreen()
    {
        if (!fullscreen)
        {
            oldsize = this.Size;
            oldstate = this.WindowState;
            oldstyle = this.FormBorderStyle;
            oldlocation = this.Location;
            this.WindowState = System.Windows.Forms.FormWindowState.Normal;
            this.FormBorderStyle = System.Windows.Forms.FormBorderStyle.None;
            this.Bounds = System.Windows.Forms.Screen.PrimaryScreen.Bounds;
            fullscreen = true;
        }
        else
        {
            this.Location = oldlocation;
            this.WindowState = oldstate;
            this.FormBorderStyle = oldstyle;
            this.Size = oldsize;
            fullscreen = false;
        }
    }

    // CODE ENDS HERE
} 
```

用法：

```
UpgradeFullscreen(); // Goes to fullscreen
UpgradeFullscreen(); // Goes back to normal state
// You don't need arguments. 
```

> 注意：您必须将它放在 Form 的类中（示例：）`partial class Form1 : Form { /* Code goes here */ }`，否则它将不起作用，因为如果您不将它放在任何表单上，代码`this`将创建异常。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-05-16T19:28:04.583

在表单移动事件上添加：

```
private void Frm_Move (object sender, EventArgs e)
{
    Top = 0; Left = 0;
    Size = new System.Drawing.Size(Screen.PrimaryScreen.Bounds.Width, Screen.PrimaryScreen.Bounds.Height);
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-06-09T13:48:09.687

如果要保留表单的边框*并*使其覆盖任务栏，请使用以下命令：

设置`FormBoarderStyle`为`FixedSingle`或`Fixed3D`

设置`MaximizeBox`为`False`

设置`WindowState`为`Maximized`

# java - 向 WebService 添加字段

> ID：505172
> 
> 赞同：3
> 
> 时间：2009-02-02T22:12:41.997
> 
> 标签：java, web-services, soap

我有一个公开方法的 SOAP 服务

```
TradeDetail getTradeDetail() 
```

TradeDetail 存储 5 个字段、交易编号、日期等

我需要向 TradeDetail 添加几个字段。我想保持向后兼容性（一段时间），看起来我的选择仅限于创建一个带有额外字段的新类

```
TradeDetail2 getTradeDetail2() 
```

现在这将起作用 - 我以前做过。但是人们使用过其他解决方案吗？

例如

*   从根本上更改 TradeDetail2 以添加名称值对。
*   从 TradeDetail 继承 TradeDetail2，这样会减少代码但增加耦合
*   改为返回 XML 或 JSON

我将能够很快淘汰原始界面，以便清理代码并且额外的 TradeDetail2 不会永远存在！

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T00:03:43.240

我很同情——我的一些网络服务充满了`myMethod()`,等`myMethod2()`，`myMethod3()`只是因为我需要添加一些新字段。

保留方法名称并为 API 的每个版本创建一个新端点是否有意义？例如：

*   [http://my.domain.com/servicename/v1](http://my.domain.com/servicename/v1)
*   [http://my.domain.com/servicename/v1.1](http://my.domain.com/servicename/v1.1)
*   [http://my.domain.com/servicename/v1.5](http://my.domain.com/servicename/v1.5)
*   [http://my.domain.com/servicename/v2](http://my.domain.com/servicename/v2)

然后，无论您需要进行多少次更改，您的方法名称都会保持合理。

无论如何，使用您的 Web 服务的任何应用程序都可能需要针对新的 WSDL 重写和/或重新构建，以便利用新字段，所以为什么不针对新的 v1.1 API 重写/重新构建它们。

我发现这在与使用您的服务的应用程序的所有者/开发者进行通信时也有帮助 - 例如，“ *[日期] 之后将不再支持我们的 Web 服务 API 的 [旧] 版本，请确保您使用的至少版本[新]。* ”

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T00:48:37.220

这就是为什么我更喜欢完全控制 XML 到对象的映射，这样我就可以将模型与 XML 接口分离。在您的情况下，我会简单地向 TradeDetail 添加新字段，并将它们视为“可选”以实现向后兼容性。这将是我的团队使用的框架中 TradeDetail 的 XML-> 对象映射示例，为您的界面编写：

```
// this would go into my client endpoint class
public TradeDetail getTradeDetail() {
  Element requestRoot = new Element("GetTradeDetail");
  Element responseRoot = invokeWebServiceAndReturnJdomElement(requestRoot);
  return mapTradeDetail(responseRoot);
}

// this would go into my client XO mapping class
public TradeDetail mapTradeDetail(Element root) {
  TradeDetail tradeDetail = new TradeDetail();
  tradeDetail.setField1 = fetchString(root, "/GetTradeDetail/Field1");
  tradeDetail.setField2 = fetchInteger(root, "/GetTradeDetail/Field2");
  tradeDetail.setField3 = mapField3(root, "/GetTradeDetail/Field3");
  tradeDetail.setField4 = fetchString(root, "/GetTradeDetail/Field4");
} 
```

这种客户端会忽略新字段，因此与新版本的协议兼容，直到我在版本 2 的相同方法的末尾添加类似这样的内容：

```
if (fetchXPath(root, "/GetTradeDetail/Field5") != null) {
  // so we're talking with server which speaks new version of protocol
  tradeDetail.setField5 = fetchString(root, "/GetTradeDetail/Field5");
} 
```

服务器将使用类似的代码，可能会检查客户端版本，并且仅当客户端支持新版本的协议时才映射额外的字段。

在我看来，应该编写客户端，以便添加到协议中的一些额外字段不会破坏客户端 - 我没有因为上游提供者添加了新功能而没有通知我而被关闭的奢侈。如果提供者更改现有的必填字段，当然，客户需要修改。这就是为什么上游提供商应该版本协议并支持旧版本至少几个月。

# c# - C# - 给定起始工作日，获取一个月中周列表的最佳方法是什么？

> ID：505175
> 
> 赞同：18
> 
> 时间：2009-02-02T22:13:47.330
> 
> 标签：c#, datetime

我需要获取给定月份的周列表，以星期一为开始日。

例如，对于 2009 年 2 月，此方法将返回：

```
2/2/2009
2/9/2009
2/16/2009
2/23/2009 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2010-05-05T13:37:33.957

```
 // Get the weeks in a month

 DateTime date = DateTime.Today;
 // first generate all dates in the month of 'date'
 var dates = Enumerable.Range(1, DateTime.DaysInMonth(date.Year, date.Month)).Select(n => new DateTime(date.Year, date.Month, n));
 // then filter the only the start of weeks
 var weekends = from d in dates
                where d.DayOfWeek == DayOfWeek.Monday
                select d; 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-02T22:21:55.113

```
public static List<DateTime> GetWeeks(
    this DateTime month, DayOfWeek startOfWeek)
{
    var firstOfMonth = new DateTime(month.Year, month.Month, 1);
    var daysToAdd = ((Int32)startOfWeek - (Int32)month.DayOfWeek) % 7;
    var firstStartOfWeek = firstOfMonth.AddDays(daysToAdd);

    var current = firstStartOfWeek;
    var weeks = new List<DateTime>();
    while (current.Month == month.Month)
    {
        weeks.Add(current);
        current = current.AddDays(7);
    }

    return weeks;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T23:05:59.127

如果您有兴趣，这是使用 C# 3.0/LINQ 的解决方案（实际上是一行）：

```
var month = new DateTime(2009, 2, 1);
var weeks = Enumerable.Range(0, 4).Select(n => month.AddDays(n * 7 - (int)month.DayOfWeek + 1)).TakeWhile(monday => monday.Month == month.Month); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T22:33:12.080

```
int year = 2009;
int month = 2;
DateTime startDate = new DateTime(year, month, 1);
DateTime endDate = startDate.AddMonths(1);
while (startDate.DayOfWeek != DayOfWeek.Monday)
    startDate = startDate.AddDays(1);
for (DateTime result = startDate; result < endDate; result = result.AddDays(7))
    DoWhatYouWant(result); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T22:56:04.123

这个怎么样？

```
 public IEnumerable<DateTime> GetWeeks(DateTime date, DayOfWeek startDay)
  {
     var list = new List<DateTime>();
     DateTime first = new DateTime(date.Year, date.Month, 1);

     for (var i = first; i < first.AddMonths(1); i = i.AddDays(1))
     {
        if (i.DayOfWeek == startDay)
           list.Add(i);
     }

     return list;
  } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T22:19:29.783

只需将响应行更改为您需要对其进行的操作

```
protected void PrintDay(int year, int month, DayOfWeek dayName)
{
  CultureInfo ci = new CultureInfo("en-US");
  for (int i = 1 ; i <= ci.Calendar.GetDaysInMonth (year, month); i++)
  {
    if (new DateTime (year, month, i).DayOfWeek == dayName)
      Response.Write (i.ToString() + "<br/>");
  }
} 
```

快速解决方案：我认为它没有内置功能....

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T22:24:17.543

类似以下伪代码的东西应该可以工作：

*   确定月份的开始日期（使用日期的月份和年份并将日期设置为 1
*   确定当月的结束日期（开始日期 + 1 个月）
*   确定第一个日期是星期一（这是列表中的第一项）
*   添加 7 天以找到下一个日期并重复，直到您阅读或通过月末

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-19T11:32:48.940

我看到你得到了答案，但我想与你分享我为我的一个项目创建的帮助类。这是一个综合类，但可能会有所帮助......

```
public static class WeekHelper {

#region Public Methods
public static DateTime GetWeekStart(DateTime date) {
    DateTime weekStart;
    int monday = 1;
    int crtDay = (int)date.DayOfWeek;
    if (date.DayOfWeek == DayOfWeek.Sunday)
        crtDay = 7;
    int difference = crtDay - monday;
    weekStart = date.AddDays(-difference);
    return weekStart;
}
public static DateTime GetWeekStop(DateTime date) {
    DateTime weekStart;
    int sunday = 7;
    int crtDay = (int)date.DayOfWeek;
    if (date.DayOfWeek == DayOfWeek.Sunday)
        crtDay = 7;
    int difference = sunday - crtDay;
    weekStart = date.AddDays(difference);
    return weekStart;
}
public static void GetWeekInterval(int year, int weekNo,
    out DateTime weekStart, out DateTime weekStop) {
    GetFirstWeekOfYear(year, out weekStart, out weekStop);
    if (weekNo == 1)
        return;
    weekNo--;
    int daysToAdd = weekNo * 7;
    DateTime dt = weekStart.AddDays(daysToAdd);
    GetWeekInterval(dt, out weekStart, out weekStop);
}
public static List<KeyValuePair<DateTime, DateTime>> GetWeekSeries(DateTime toDate) {
    //gets week series from beginning of the year
    DateTime dtStartYear = new DateTime(toDate.Year, 1, 1);
    List<KeyValuePair<DateTime, DateTime>> list = GetWeekSeries(dtStartYear, toDate);
    if (list.Count > 0) {
        KeyValuePair<DateTime, DateTime> week = list[0];
        list[0] = new KeyValuePair<DateTime, DateTime>(dtStartYear, week.Value);
    }
    return list;
}
public static List<KeyValuePair<DateTime, DateTime>> GetWeekSeries(DateTime fromDate, DateTime toDate) {
    if (fromDate > toDate)
        return null;
    List<KeyValuePair<DateTime, DateTime>> list = new List<KeyValuePair<DateTime, DateTime>>(100);
    DateTime weekStart, weekStop;
    toDate = GetWeekStop(toDate);
    while (fromDate <= toDate) {
        GetWeekInterval(fromDate, out weekStart, out weekStop);
        list.Add(new KeyValuePair<DateTime, DateTime>(weekStart, weekStop));
        fromDate = fromDate.AddDays(7);
    }
    return list;
}
public static void GetFirstWeekOfYear(int year, out DateTime weekStart, out DateTime weekStop) {
    DateTime date = new DateTime(year, 1, 1);
    GetWeekInterval(date, out weekStart, out weekStop);
}
public static void GetWeekInterval(DateTime date,
    out DateTime dtWeekStart, out DateTime dtWeekStop) {
    dtWeekStart = GetWeekStart(date);
    dtWeekStop = GetWeekStop(date);
}
#endregion Public Methods 
```

}

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-17T15:47:17.460

这很好用！您所要做的就是获得您想要获得几周的月份的第一天，然后这将为您提供每周的第一天。您需要获得 5 周（而不是 4 周），因此 Enumerable.Range 计算出 5 而不是 4。

```
var date = new DateTime(DateTime.Today.Year, DateTime.Today.Month, 1);
var weeks = from n in Enumerable.Range(0, 5)
   select date.AddDays(7 * n + (-1 * (int)date.DayOfWeek)); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-11-05T14:44:34.253

这就是我所做的，使用 Chaowlert 的代码作为起始基础。基本上我修改了你需要检查是否将 for 中的天数添加到下个月，所以我不添加 4 天（星期一到星期五），但实际上是 4 和该月剩余天数之间的最小值. 另外，我检查当天是否是周末，否则添加天数直到它是工作日。我的目的是打印一个月中的周数，从周一到周五

```
DateTime fechaInicio = new DateTime(año, mes, 1);
DateTime fechaFin = fechaInicio.AddMonths(1);
int diasHastaFinMes = 0;
while (esFinDeSemana(fechaInicio))
    fechaInicio = fechaInicio.AddDays(1);
for (DateTime fecha = fechaInicio; fecha < fechaFin; fecha = fecha.AddDays(7))
{
    diasHastaFinMes = DateTime.DaysInMonth(fecha.Year, fecha.Month) - fecha.Day;
    printWeeks(fecha, fecha.AddDays(Math.Min(4, diasHastaFinMes)));
} 
```

# iphone - 如何更改 UINavigationBar 按钮项上的文本颜色

> ID：505180
> 
> 赞同：19
> 
> 时间：2009-02-02T22:15:36.810
> 
> 标签：iphone, cocoa-touch

我有一个 UINavigationController，我使用 Interface Builder 中导航栏的 Tint 属性将其更改为白色。但是按钮和标题中的文本仍然是默认颜色，白色，因此在白色背景下会丢失。有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2012-04-12T16:33:34.963

从 iOS 5 开始，使用 UIBarButtonItem 外观代理更容易：

```
 NSDictionary *attributes = [NSDictionary dictionaryWithObjectsAndKeys: 
                        [UIColor blackColor], 
                        UITextAttributeTextColor, 
                        [UIColor clearColor], 
                        UITextAttributeTextShadowColor, nil];

[[UIBarButtonItem appearance] setTitleTextAttributes: attributes
                                            forState: UIControlStateNormal]; 
```

在应用程序中设置它：didFinishLaunchingWithOptions：

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-03-31T12:31:46.950

```
for (id subView in theNavigationBar.subviews) {
    if ([subView isKindOfClass:[UIButton class]]) {
        [(UIButton *)subView setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
        [(UIButton *)subView setTitleShadowColor:[UIColor clearColor] forState:UIControlStateNormal];
    }

} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-26T02:45:04.647

这是一种方法：

```
[[theNavigationBar.subviews objectAtIndex:1] setTitleColor:[UIColor redColor] forState:UIControlStateNormal];
[[theNavigationBar.subviews objectAtIndex:2] setTitleColor:[UIColor redColor] forState:UIControlStateNormal]; 
```

然而，巨大的，警告。这很可能会在未来的操作系统版本中中断，因此不建议这样做。

至少您应该进行大量测试并确保您对导航栏子视图布局的假设是正确的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T02:51:34.180

或者您使用您自己的按钮栏项目子类和您指定的设置器，lus 不是 iPhone os 3 假设为每个按钮公开文本颜色

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T02:53:50.883

我按照醉鬼的建议做了。我为一些状态的后退按钮和一些状态的常规按钮制作了一系列图像，并将它们放在自定义 UIButton 子类中，设置适当的样式。

作为一种解决方案，它的扩展性不是特别好，但我的需求很简单。如果内置控件中的子视图顺序发生变化，它的优点是不会中断，这是该方法的明显缺点。需要多张图片的缺点。另一个棘手的事情是处理方向变化，因为按钮应该改变大小。

在相关的说明中，如果您确实更改了导航栏的色调，则它与用于自定义标签栏顺序的特殊“更多”视图控制器不能很好地配合。似乎没有任何“可接受的”方式来更改该视图中工具栏的颜色。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T02:36:16.293

你不能迭代 UINavigationBar 视图的内容来找到 awakeFromNib 中的按钮吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-15T13:04:55.910

恕我直言，这是一种干净的方式（依靠公共 API）：您应该使用 的`titleView`属性`navigationItem`来应用您自己的属性，`UILabel`您将在该属性上自定义`textColor`

```
 UILabel* lbl = [[UILabel alloc] initWithFrame:CGRectMake(0, 0, 320, 20)];
lbl.textAlignment=UITextAlignmentCenter;
lbl.backgroundColor=[UIColor clearColor];
lbl.textColor=[UIColor colorWithRed:0.18 green:0.2 blue:0.56 alpha:1];
theControllerOnWhichYouWantToHaveATitleWithYourOwnColor.navigationItem.titleView=lbl;
[lbl release]; 

```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-04-30T13:33:34.137

您可以通过在导航栏中添加标签来更改标题外观，如下所示。

```
UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(0, 0, 100, 35)];
label.backgroundColor = [UIColor clearColor];
label.textAlignment = UITextAlignmentCenter;
label.textColor =[UIColor whiteColor];
label.text=self.title;
self.navigationItem.titleView = viewLabel;
[label release]; 
```

# c# - XmlSerializer 和装饰类 (C#)

> ID：505184
> 
> 赞同：0
> 
> 时间：2009-02-02T22:17:26.323
> 
> 标签：c#, .net, serialization, xml-serialization

我利用 XmlSerializer 与 XML 进行转换。这是一个示例类：

```
[XmlRootAttribute("myClass")]
public class MyClass {
    private string someField;

    [XmlElement("someField")]
    public string SomeField {
        get {
            return someField;
        }

        set {
            someField = value;
        }
    }
} 
```

XML 如下所示：

```
<myClass>
    <someField>Some Value</someField>
</myClass> 
```

我希望能够为这个类添加一个属性。例如，有时我需要向元素添加更改跟踪。一个属性，比如“IdRef”，将被添加到 myClass 元素中。

```
<myClass t:IdRef="someGuid" xmlns:t="uri:some:uri">
    <someField>SomeValue</someField>
</myClass> 
```

我希望将 IdRef 属性保留在 POCO 主类之外。另外，由于有很多像上面这样的类，所以我希望不必为每个类创建一个子类，添加扩展属性。也许使用 IXmlSerializer 接口创建自定义实现？

**更新** 我将使用下面描述的简单解决方案。我想我试图“过度思考”这个实现并在不需要的地方增加复杂性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T22:21:44.943

我怎么看？我认为您必须将它们粘贴在您的“POCO”类中，但您可以将它们隐藏在标有“额外序列化标记属性”之类的区域中，并使用其他属性使它们对您的类的消费者几乎不可见。

# .net - 矢量化图像

> ID：505186
> 
> 赞同：3
> 
> 时间：2009-02-02T22:17:50.940
> 
> 标签：.net, image-processing

我正在尝试从位图图像中的区域生成矢量图形，虽然我当前的算法适用于大多数情况，但它存在一些问题并且速度很慢。

所以我想知道你们是否知道任何简单的算法或代码示例可以有效地做到这一点。

我的情况很简单。我有一个位图图像，有几个平坦的统一区域。我希望将这些区域转换为点集，以便以后将它们重新创建为矢量图形。我永远不会有重叠的形状，形状总是封闭的，而且它们总是一种颜色（所有像素的 RGB 值相同），所以很容易确定轮廓，但有效地做起来更难。

编辑：我按下提交按钮太快了......

理想情况下，我想要一个在 .NET 中工作的解决方案，但伪代码也应该能很好地工作。也许你们知道一些关于图像处理的好资源？

再次编辑：所以我所追求的是一个算法或一个库，它将给我一个描述图像中每个区域的点或矢量列表，而不是矢量化图像本身。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T22:29:21.590

由于您的对象是不同的，您可以运行用于连接组件标签的算法。维基[百科的文章](http://en.wikipedia.org/wiki/Connected_Component_Labeling)刚开始还不错，虽然我不知道他们为什么专注于多通道算法，但一次通道很容易工作。当您发现连接的组件时，您必须维护一些数据结构来表示轮廓。如果已知您的对象很简单（例如与轴成法线角度的矩形或圆形），则表示可能非常简单。如果它们是一般形状，那么您将需要一些更复杂的曲线表示。（请记住棘手的对象，例如“U”或“O”形状。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T22:37:01.450

我在这方面没有经验，所以我可能会描述一个可以使用的最糟糕的算法，希望其他可能会通过这个问题的人会被我的回答激怒，他们会给你一些更好的可用算法今天的算法。

我会做一个洪水填充算法来找到每个斑点的边缘，并为每个斑点的每个边缘点制作一个带有向量的多边形。这将为您提供具有与 blob 周围的像素一样多的角的多边形。

然后我会查找多边形简化例程，例如，这些例程将采用一组位于同一条线上的向量并删除所有中间点。

洪水填充也不是完全必要的 - 只需从当前像素搜索相邻像素（有 8 个相邻像素）并使用右手边跟随来填充多边形点。

它应该相对较快，尽管多边形会非常复杂，除非你得到一个非常好的简化例程。

-亚当

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T23:07:29.983

只是为了取笑并跳出框框思考，我尝试使用运动检测非常成功。我有一张白色的图片，里面有 3 个圆圈。

使用来自这个网络摄像头运动检测程序（[http://www.codeproject.com/KB/audio-video/Motion_Detection.aspx](http://www.codeproject.com/KB/audio-video/Motion_Detection.aspx)）的源代码，我得到了所有 3 个圆圈的区域，并且可以轻松地映射它们。我只是将图片两次输入到运动检测例程中，其中一张图片向右推了一点。根据您使用的检测算法，您可以有不同的细节级别（如下面的示例图片所示）：

所有的信任都归运动检测程序的作者：安德鲁基里洛夫。

![替代文字](https://www.codeproject.com/KB/audio-video/Motion_Detection/2.jpg)

![替代文字](https://www.codeproject.com/KB/audio-video/Motion_Detection/3.jpg)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-04T00:47:32.120

您可能也对[这种](https://stackoverflow.com/questions/509173/genetic-algorithm-resource)遗传算法感兴趣。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-07T06:38:08.250

[本文](http://research.microsoft.com/en-us/um/people/kopf/pixelart/index.html)比较了几种流行的技术。我不会称算法简单，但处理是彻底的。

# c# - .NET 中的 DeflateStream 4GB 限制

> ID：505190
> 
> 赞同：6
> 
> 时间：2009-02-02T22:19:47.567
> 
> 标签：c#, .net, compression, gzip

来自 MSDN：*[DeflateStream 类](http://msdn.microsoft.com/en-us/library/system.io.compression.deflatestream.aspx)*

DeflateStream 不能用于压缩大于 4 GB 的文件。

.NET 还有其他没有 4 GB 限制的实现吗？

注意：我确实需要解压缩内容大于 4 GB 的 GZ 格式的文件。任何代码都可以做到这一点吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T03:02:30.697

仅供参考，我们已经从 .NET 4 中的 DeflateStream 中删除了 4 GB 限制。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-02T22:38:39.353

[CodeProject](http://www.codeproject.com/KB/DLL/cs_interface_7zip.aspx)中有使用 7-Zip 库的示例代码。

许可证是开放的，所以你应该可以在你的项目中使用它。

7-Zip 也支持 GZ 文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T22:53:09.590

看看[SharpZipLib](http://www.icsharpcode.net/OpenSource/SharpZipLib/Download.aspx)。不确定它是否受到相同的限制，但值得一看。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T22:32:46.527

环顾四周，似乎很多人都遇到过这个问题。 *[请 System.IO.Compressio.DeflateStream 澄清](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/93b3631f-4cb6-4b24-aaa3-542e00c0b068/)*似乎是最全面的。

我能够找到的唯一实现似乎通过使用 Zip64 克服了这个问题是 *[Xceed Zip for .NET](http://xceed.com/Zip_Net_Features.html)*。

但是，它非常昂贵，我不确定它是否适合您的需求。

编辑：

似乎确实有相当多的 Zip64 用于 .NET 的实现，但我找不到任何免费的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T02:51:23.650

寻找支持**DEFLATE64**（不是 Zip64，它是 ZIP 文件格式的扩展）的库。[Xceed Zip for .NET](http://xceed.com/Zip_Net_Features.html)确实支持 Deflate64，我相信其他人也支持。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T09:29:32.403

[DotNetZip](http://dotnetzip.codeplex.com)为 .NET 提供 ZIP64，而且它是免费的。但 Zip64 与 Deflate64 不同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-02T12:36:12.137

尽管该文档说 DeflateStream 和 GZipStream 都有 4GB 的限制，但由于 CRC32 校验和，只有 GZipStream 受到限制。如果您不需要 CRC32，请使用 DeflateStream。

# visual-c++ - 您可以从非托管 C++ 类派生托管 C++ 类吗？

> ID：505192
> 
> 赞同：1
> 
> 时间：2009-02-02T22:20:47.597
> 
> 标签：visual-c++, c++-cli, unmanaged, managed-c++

我有一个未管理的 C++ 类，我用未管理的 dll 编写。我有一个引用非托管 dll 的托管 dll。托管 dll 中的类可以派生自非托管类吗？

使用 Visual Studio 2008

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T22:23:23.503

你不能。托管类的实例在 CLR 堆上进行垃圾收集和创建。非托管类的实例分配在非托管堆上。您如何能够创建一个对象，其数据部分位于托管堆上，其基础数据位于非托管堆上？

您应该尝试其他技术，例如将托管容器包装在非托管事物上，反之亦然，并可能从中派生。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T05:30:24.653

*你还*不能。Herb Sutter 写了一篇详尽的[C++/CLI Design Rationale](http://www.gotw.ca/publications/C++CLIRationale.pdf)，他暗示有一天这样的事情确实可能实现。但是，微软似乎停止了 C++/CLI 的进一步开发？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T10:41:30.033

您能做的最好的事情是将您的非托管类包装在管理器包装器中，然后从中派生。

# c# - Binding Textboxes

> ID：505215
> 
> 赞同：4
> 
> 时间：2009-02-02T22:25:48.680
> 
> 标签：c#, winforms, data-binding, .net-3.5

I have been binding textboxes in a winform with C# to a dataset. Whenever the data doesn't validate with what the database except it silently forces the focus to remain on the textbox. How can I catch the validation error and tell the user about it (and free the focus)? The BindingSource event OnDataError isn't fired.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T22:40:36.840

I had a similar problem once. The focus remained in the textbox which was binded to some numeric database field when the user modified text in a textbox and then deleted it so the text property was an empty string. I solved it with something like:

```
textbox.DataBindings["Text"].NullValue = ""; 
```

It solved the problem for empty inputs. I don't know if it would be of any use in your case, but I'd be also interested in more general solution.

Here's also some related question on SO:

[Data-bound TextBox: can't exit](https://stackoverflow.com/questions/217912/data-bound-textbox-cant-exit)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T22:39:57.497

Never rely on just what "Visual studio has done for me" if you don't fully understand what it's doing. I would strongly urge you to take the time and figure out how to do what it is you want to do all by yourself (meaning without designer generated code). To get you started, there are some events on the TextBox that can help you out. Start here:

[http://msdn.microsoft.com/en-us/library/system.windows.forms.control.validated.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.validated.aspx)

Specifically the validating and validated events should be what you're looking for.

# sqlite - 对 Sqlite DB 管理器应用程序的推荐？

> ID：505220
> 
> 赞同：42
> 
> 时间：2009-02-02T22:26:42.797
> 
> 标签：sqlite

这里列出了很多 Sqlite GUI 应用程序：

[http://www.sqlite.org/cvstrac/wiki?p=ManagementTools](http://www.sqlite.org/cvstrac/wiki?p=ManagementTools)

有些似乎不完整、有缺陷、未维护等。您有什么建议吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-02T22:28:33.633

我使用[Firefox 的 SQLite 管理器插件](https://addons.mozilla.org/en-US/firefox/addon/5817)。

对我来说似乎很稳定。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-04T00:54:43.697

这是另一个免费选项。对我来说已经很稳定了。 [SQLiteStudio](http://sqlitestudio.one.pl/index.rvt)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-02T22:56:48.833

对于 Windows：我一直在寻找功能和舒适的 GUI - 满足后一个要求特别困难，但是这两个选择都很好：

a)**足够好：** [SQLite 专家](http://www.sqliteexpert.com/features.html)

更便宜，功能齐全的经理。作者对评论和错误报告非常敏感，并且经常发布更新。另一方面，如果您查看版本历史，新版本似乎会引入新错误，然后在后续版本中修复。图形界面很好，非常适合快速设计新数据库；对于设计查询和处理大量数据来说，情况要少一些。主要抱怨：您在编辑查询时看不到架构（无需在程序中翻转选项卡）。

b)**近乎完美：** [SQLite Maestro](http://www.sqlmaestro.com/products/sqlite/)

更贵。丰富的用户界面，轻松访问所有功能，漂亮的可视化查询构建器和自动 SQL 格式化程序以提高可读性，大量吸引眼球。有一个单独的、更专业的查询构建器（SQLite Code Factory），但您可以只使用主 Maestro 应用程序。主要抱怨：似乎无法更改表格显示的字体大小，默认值有点太小；一开始很容易迷失在选项卡的丛林中，尽管总的来说我发现 GUI 非常高效。

根据我的经验，这两种解决方案都非常稳定，而且如果你能等得起的话，它们似乎都会提供偶尔的折扣。

如果只是浏览数据，请尝试免费的[SQLite Spy](http://www.yunqa.de/delphi/doku.php/products/sqlitespy/)，它可以让您执行查询，但没有或很少支持 GUI 进行编辑。虽然非常方便快速查找。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-11-23T17:23:46.440

花了一上午寻找一个好的 Sqlite 数据库管理器/浏览器，并选择了[SqliteStudio](http://sqlitestudio.one.pl/)，目前是 v2.20.28，我在 Ubuntu Linux 10.04 上运行。

*   下载的是一个 4.3MB 的未压缩可执行文件。时期！
*   它速度快，表现良好，并且使用适度的资源。
*   界面干净且有吸引力，具有逻辑功能。
*   我不经常这么说，但这只是“使用的乐趣”。
*   它由 Pawel Salawa 开发并积极维护，他因制作了一个非常好的程序而受到赞扬。

我只是用它来合并两个 Firefox FloatNotes 数据库（Sqlite v3），它们只使用一个表......

*   目标数据库在运行 SqliteStudio 的本地主机上（即 /0/LX02）
*   源数据库文件位于通过 SSHFS 挂载到 /0/LX04 的远程主机上
*   使用添加数据库打开两个数据库文件。
*   使用 SQL 编辑器从 LX04 上的 SELECT 执行插入到 LX02 数据库。
*   一切顺利时单击“提交”图标，如果有错误需要修复，请单击“回滚”。
*   刷新表数据以查看插入的行。

没有导入 GUI 功能，但如果您了解 SQL，则合并非常简单。我为作为唯一 ID 主键的第一列提供了 NULL，以便 Sqlite 自动递增，从而重新编号被合并的行...

```
INSERT INTO [floatnotes.sqlite].floatnotes
SELECT NULL,
       url,
       protocol,
       content,
       x,
       y,
       w,
       h,
       color,
       status,
       guid,
       creation_date,
       modification_date
  FROM [floatnotes-LX04.sqlite].floatnotes; 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-02T23:05:07.943

[我喜欢 SQLite 管理员](http://sqliteadmin.orbmu2k.de/)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-05-29T22:14:44.297

我一直在使用[SQLite Professional](http://www.sqlitepro.com)，它很可靠。唯一的缺点是我通过 iOS 模拟器对数据库所做的更改没有在应用程序中解决（我必须关闭它并重新打开才能显示更改），但该功能是在最近的版本中添加的。所以现在它做了我需要的一切。我很高兴得到支持。这对测试很有用，我用它来构建数据库结构。从来没有过马车。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-02T23:00:12.027

我过去使用过[Sqliteman](http://www.sqliteman.com)。相当不错。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-01-31T16:07:42.237

[SQLiteSpy](http://www.yunqa.de/delphi/doku.php/products/sqlitespy/index)是一个不错的选择

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-10-05T06:29:12.433

Sqlite.org 有一个可用的管理工具列表：

[http://www.sqlite.org/cvstrac/wiki?p=ManagementTools](http://www.sqlite.org/cvstrac/wiki?p=ManagementTools)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-02-18T14:41:29.460

如果您使用 OSX，您可能会喜欢[SQLPro for SQLite](https://sqlitepro.com) ( [App Store](https://itunes.apple.com/us/app/sqlite-professional/id586001240?ls=1&mt=12) )。

该应用程序具有一些简洁的功能，例如：

*   版本集成（回滚到以前的版本）。
*   内联数据过滤。
*   导出选项为 CSV、JSON、XML 和 MySQL。
*   列重新排序。
*   全屏支持。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-12-03T22:47:49.363

我一直在使用[SQL Explorer](http://www.sqlexplorer.org/ "SQL 资源管理器")。firefox 插件很棒，但它无法正确处理 BIGINT（它截断了它们）。我注意到 .jar 驱动程序似乎不支持 FTS4（但它确实支持 FTS3）并且不显示数据结构中的索引。

我喜欢 SQL 资源管理器，因为您也可以将 mySQL 等其他提供程序与一个客户端一起使用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-02T23:34:20.880

你没有提到平台，所以这里有一个[很好](http://www.tandb.com.au/sqlite/compare/?mlp)的 Mac OS X SQLite 工具比较。我个人发现[MesaSQLite](http://www.mesamysql.com/?realmesa_home)最喜欢我对数据库工具的偏好，顺便说一下 CocoaMySQL。（对于 Windows，我只是使用了上面提到的 Firefox 插件。）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-10-25T22:55:07.810

如果您大部分时间都在 Visual Studio 中，那么[System.Data.SQLite](http://sqlite.phxsoftware.com/)很好，并且可以处理加密数据库。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-05-28T14:29:26.503

[Navicat SQLite](http://www.navicat.com/en/products/navicat_sqlite/sqlite_overview.html)非常好，它们也支持 Windows、OS X 和 Linux。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-04-18T16:04:57.203

您可能想在[此处](https://github.com/meizy/MYZSQLExplorer)查看 MYZSQLExplorer 。

与其他工具不同，它在 iOS 设备（或模拟器）上运行。它是一个查看器，而不是一个管理工具，并且不像其他一些工具那样功能完整，但是很方便，因为您可以从代码中启动它并从应用程序中浏览数据库。

或者您可以通过将它们作为电子邮件附件发送来“打开...”它的 sqlite 商店。

我开发它是为了在开发和测试阶段帮助自己，它确实有帮助。

如果您对此有任何反馈，我很乐意听到。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-06-10T04:45:40.830

如果您只想对 sqlite 数据库文件进行 CRUD 操作，那么[SQuirreL](http://squirrel-sql.sourceforge.net/)是一个非常好的选择，因为它具有自动完成功能，可以大大提高输入 sql 查询的速度和效率。

要在 SQuirreL 中使用 SQLite 数据库，首先从[这里](http://repo1.maven.org/maven2/org/xerial/sqlite-jdbc/3.7.2/sqlite-jdbc-3.7.2.jar)下载 SQLite 的 JDBC 驱动程序，然后将 jar 放到 SQuirreL 文件夹的 lib 文件夹中。现在打开 SQuirreL 并选择 Create a New Driver。在示例 URL 字段中放置

> jdbc:sqlite:$file_url

并在类名中

> org.sqlite.JDBC

之后选择 Create a New Alias 并选择您刚刚添加的驱动程序并将 $file_url 替换为 sqlite 文件的实际位置，然后单击 ok 就完成了。

# visual-studio-2008 - VS 2008 的自定义语法高亮显示

> ID：505226
> 
> 赞同：20
> 
> 时间：2009-02-02T22:28:19.033
> 
> 标签：visual-studio-2008, plugins, syntax-highlighting

我最近一直在使用[John Lam 的 Vibrant Ink](http://www.iunknown.com/2007/06/vibrant_ink_vis.html) VS 配色方案，并想对其进行调整，以便它突出显示具有不同颜色的类的方法名称。事实证明，VS 中没有选择。

Resharper 具有提供自定义语法突出显示[的功能。](http://www.jetbrains.com/resharper/features/coding_assistance.html#Syntax_Highlighting)我想知道编写一个可以为您提供精细自定义语法突出显示的小插件有多难？有没有像这样的开源插件？

**编辑**

谢谢大家，我设法使用 DXCore 破解了一些东西，我的 VS 看起来与 textmate 非常相似。

[VS 看起来很棒 http://img14.imageshack.us/img14/637/awesomevsgq1.png](http://img14.imageshack.us/img14/637/awesomevsgq1.png)

** 笔记 **

我不得不对 Rory 的代码片段稍作修改，使其与 C# 中的点方法名称和相等运算符一起使用。

我现在正在使用：

```
 string name = ea.LanguageElement.Name.Split('.').Last();

            if (name == ("op_Equality")) {
                name = "==";
            } else if (name == "op_Inequality") {
                name = "!=";
            }

            ea.PaintArgs.OverlayText(name, 
                ea.LanguageElement.NameRange.Start, 
                Color.FromArgb(255,204,0)); 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-11T15:31:35.523

正如布赖恩已经说过的那样……[我的 PaintIt 插件会让您对](http://www.rorybecker.co.uk/PaintIt.html)[DXCore](http://devexpress.com/Products/Visual_Studio_Add-in/DXCore/)可以做什么有所了解。

[在我们的“社区插件网站](http://code.google.com/p/dxcorecommunityplugins/)”上还有一些其他的“装饰插件”，我们在

如果您有任何具体问题，请[访问 DevExpress IDE 工具论坛。](http://community.devexpress.com/forums/default.aspx?GroupID=18)

[DXCore是构建](http://devexpress.com/Products/Visual_Studio_Add-in/DXCore/)[RefactorPro](http://devexpress.com/refactor)和[CodeRush](http://devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/)的框架，它应该让您了解哪种类型

他们有能力的图形功能。

也就是说，您不需要这些工具中的任何一个来使用[DXCore](http://devexpress.com/Products/Visual_Studio_Add-in/DXCore/)。

**社区网站上的所有[内容都是“开源”](http://code.google.com/p/dxcorecommunityplugins/)的（[PaintIt](http://www.rorybecker.co.uk/PaintIt.html)也是如此）**

为了让您了解事情是多么简单...以下代码是您需要添加到基本插件模板的所有代码 使用[DXCore](http://devexpress.com/Products/Visual_Studio_Add-in/DXCore/)启动和运行基础知识...

```
Private Sub PlugIn_EditorPaintLanguageElement(ByVal ea As DevExpress.CodeRush.Core.EditorPaintLanguageElementEventArgs) Handles Me.EditorPaintLanguageElement
    If ea.LanguageElement.ElementType = LanguageElementType.Method Then
        ea.PaintArgs.OverlayText(ea.LanguageElement.Name, _
                                 ea.LanguageElement.NameRange.Start, _
                                 Color.HotPink)
    End If
End Sub 
```

我基于此代码创建了一个插件（称为 CR_ColorizeMemberNames）并将其添加到[Community Plugin Site](http://code.google.com/p/dxcorecommunityplugins/)。

二进制文件可从我的网站[获得](http://www.rorybecker.me.uk/DevExpress/Plugins/Community/CR_ColorizeMemberNames)。

您只需下载并安装[DXCore](http://devexpress.com/Products/Visual_Studio_Add-in/DXCore/)并将插件的[二进制](http://www.rorybecker.me.uk/DevExpress/Plugins/Community/CR_ColorizeMemberNames)文件放在插件文件夹中（默认为 C:\Program Files\Developer Express Inc\DXCore for Visual Studio .NET\2.0\Bin\Plugins）.. 然后启动 VS 并您的方法名称都应该在 HotPink 中（可爱）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-10T14:29:37.270

为了超越简单的关键字着色，[此处定义](http://msdn.microsoft.com/en-us/library/bb166778.aspx)了 Visual Studio 语法着色的详细信息；和细节在[这里实现](http://msdn.microsoft.com/en-us/library/bb166173.aspx)。

这些文件概述了底层管道是如何铺设的 - 更重要的是，详细介绍了如何自行接线 -

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-11T10:42:56.213

如果您想自己动手，我建议您[从 DevExpress 获取 DXCore](http://devexpress.com/Products/Visual_Studio_Add-in/DXCore/)。我知道你可以使用这个插件将你自己的视觉元素添加到 VS2008 中，而且我相信它也是免费的。有一个规模很大的社区可以帮助您编写自己的插件，甚至可能已经为您制作了一个。

我是 DevExpress 的忠实粉丝，我运行 Refactor！和 CodeRush。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-11T15:05:29.780

获取 DXCore，然后从这个插件开始：[http](http://www.rorybecker.me.uk/PaintIt.html) ://www.rorybecker.me.uk/PaintIt.html应该让你开始使用一些代码来为方法名称着色。Rory 提供了他的代码，我认为他是 SO 的成员......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T15:05:35.257

我无法真正回答它有多难或是否有任何开源，但要完成它，你想看看自定义文本标记。有关详细信息，请参阅这两篇文章：

*   [http://blogs.msdn.com/dr._ex/archive/2004/06/09/152220.aspx](http://blogs.msdn.com/dr._ex/archive/2004/06/09/152220.aspx)
*   [http://msdn.microsoft.com/en-us/library/bb165758.aspx](http://msdn.microsoft.com/en-us/library/bb165758.aspx)

# python - 用于 Python 3.0 的 Py2exe

> ID：505230
> 
> 赞同：31
> 
> 时间：2009-02-02T22:28:40.810
> 
> 标签：python, python-3.x, py2exe

我正在寻找 Python3.0 版本的“py2exe”。我尝试在 py2exe 的源代码上运行 2to3，但代码仍然损坏。

有任何想法吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-11T07:33:42.553

### 2014-05-15 更新

Python 3.x 的 py2exe 现已发布！[在 PyPI 上获取它](https://pypi.python.org/pypi/py2exe)。

### 旧资料

查看 py2exe SourceForge 项目 SVN 存储库：

[http://py2exe.svn.sourceforge.net/](http://py2exe.svn.sourceforge.net/)

我最后一次查看它，它说最后一次更新是 2009 年 8 月。但请密切注意，看看是否有任何 Python 3 工作正在进行中。

我还在 py2exe 跟踪器上提交了两个功能请求。到目前为止，没有关于他们的反馈：

*   [支持 Python 3.x](http://sourceforge.net/tracker/?func=detail&aid=3011276&group_id=15583&atid=365583)
*   [项目路线图](http://sourceforge.net/tracker/?func=detail&aid=3031912&group_id=15583&atid=365583)

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-08-11T22:00:16.273

你检查[过 cx_Freeze](http://cx-freeze.sourceforge.net/)吗？它似乎可以从您的 Python 脚本创建独立的可执行文件，包括对 Python 3.0 和 3.1 的支持

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-05-13T18:15:48.290

# Python3 的 py2exe 出来了！

这是原始错误报告：http:
[//sourceforge.net/projects/py2exe/](http://sourceforge.net/projects/py2exe/)

这是提到该版本的评论：http:
[//sourceforge.net/projects/py2exe/](http://sourceforge.net/projects/py2exe/)

这是pypi上的包：
[https ://pypi.python.org/pypi/py2exe/0.9.2.0](https://pypi.python.org/pypi/py2exe/0.9.2.0)

**请注意，Python 3 的 py2exe 仅支持 Python 3.3 及更高版本！**

**非常感谢 py2exe 开发团队！**

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-03T04:24:49.670

`py2exe`和程序服务于完全不同的`2to3`目的，所以我不确定你的最终目标是什么。

如果你想从一个正在运行的 Python 程序构建一个可执行文件，请使用`py2exe`适合你正在使用的任何 Python 的版本（版本 2 或版本 3）。

如果要将现有的 Python 2 程序转换为 Python 3，请`2to3`根据需要使用 plus 任何其他编辑。Python 3 文档[更详细地描述了转换过程](http://docs.python.org/3.0/whatsnew/3.0.html#porting-to-python-3-0)。

**更新**：我现在了解到您可能一直在尝试与自己`2to3`对抗`py2exe`以尝试制作 Python 3 兼容版本。不幸的是，这绝对超出了`2to3`. 您可能必须等待[py2exe 项目](http://www.py2exe.org/)发布 Python 3 兼容版本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-22T14:44:21.320

如果您安装了简单的设置，请输入`pip install py2exe`要安装的 shell。

# .net - 我是否应该在 HttpWebResponse 上调用 Close，即使它在 using 语句中？

> ID：505231
> 
> 赞同：18
> 
> 时间：2009-02-02T22:28:49.610
> 
> 标签：.net, garbage-collection, idisposable

我有一些类似的代码，这段代码被**大量**使用：

```
using (HttpWebResponse r = _GetHttpWebResponse(uri, body, method, contentType, headers)) {
    /* do something with the response */

    /* call r.Close() explicitly? */
} 
```

该代码今天运行良好，但与服务器的连接保持打开了相当长的一段时间。（使用 TCPView 检查）

显式调用该`Close()`方法有好处吗？是推荐还是不推荐，为什么？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-02T22:32:20.787

在(的基类)`Dispose()`上调用时，它会为您调用它的方法。使用 Reflector 快速浏览一下就证实了这一点。`WebResponse``HttpWebReponse``Close()`

编辑（回应评论）：如果已经为您调用它，为什么要明确调用它？为清楚起见？我认为如果人们理解了这个`using (X x = ...)`声明，他们就会明白它正在关闭底层连接。在这种情况下，通过显式调用它你什么也得不到。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-02T22:33:31.377

`using`关键字是块的语法糖，`try/finally`它包裹在你的周围`HttpWebResponse`，因为它实现了`IDisposable`. 在`finally`子句中时，它将调用`Dispose()`方法，该方法将调用`Close()`. 这意味着您不必显式调用该`Close()`方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T22:33:05.450

我相信 Close 是实现 IDisposable.Dispose 的方法，因此绝对不需要事先调用 Close 方法。它是完全多余的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T22:33:48.490

如果您在使用完响应后在 using 中有重要代码，那么请确保调用 close 是可以的。但是，您可能需要考虑重构代码，以便不需要响应的代码不在 using 块内。

也就是说，关闭响应并不一定会关闭连接。HTTP/1.1 协议规定连接保持打开状态，以使后续请求更快。

# javascript - 验证特定输入，Javascript

> ID：505235
> 
> 赞同：0
> 
> 时间：2009-02-02T22:29:41.480
> 
> 标签：javascript, validation, forms

```
<form action="/cgi-bin/Lib.exe" method=POST name="checks">  

     <input type=checkbox name="user1" value="'$NAME'">      
     <input type=checkbox name="user2" value="'$NAME'">     
     <input type=checkbox name="user3" value="'$NAME'">     

<input type="button" value="User 1" onclick="somefunction()"> 
```

例如，如果我选择`user2`了复选框，我希望 javascript 函数弹出“你不是用户 1...”（所有输入复选框都在相同的表单名称下）。

验证特定复选框名称后，我会做`document.checks.submit();`

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T22:49:46.710

我建议对 sktrdie 的回复进行一些改进。这将避免提交错误的表单。

```
<form action="".... onsubmit="return somefunction(this);">

function somefunction(f) {
    var user1 = f.user1;
    var user2 = f.user2;
    // etc..
    if(user2.checked) {
        alert("you are not user1");
        return false;
    } 
    return true;
} 
```

注意#1：这个例子非常简单而且不太灵活，所以额外阅读表单验证是个好主意。说，在[w3schools](http://www.w3schools.com/jS/js_form_validation.asp)

注意#2：不要忘记同时实现服务器端验证。JS 检查很容易避免。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T22:35:24.557

```
<form onsubmit="somefunction(this);" ...

function somefunction(f) {
    var user1 = f.user1;
    var user2 = f.user2;
    // etc..
    if(user2.checked) alert("you are not user1");
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T23:07:03.027

您可能希望使用复选框的`onclick`事件来进行验证...因此，当他们单击它以打开它`on`/`off`您可以在提交表单之前立即捕获它们。

```
<input type=checkbox name="user1" value="'$NAME'" onclick="javascript:validatecheckbox(document.checks.user1);"> 
```

然后无论您想在 JS 函数中验证什么：（抱歉，由于某种原因，此代码的编码无法正常工作……但希望您能明白）

```
<script language="javascript">
    function validatecheckbox(inputbox) {
        if (inputbox.checked)
            alert ('Are you ' + inputbox.name + '?');
    }
</script> 
```

# .net - .Net：加载程序集时运行代码

> ID：505237
> 
> 赞同：42
> 
> 时间：2009-02-02T22:30:10.090
> 
> 标签：.net, wcf, assemblies

是否可以在加载程序集时运行一些代码，而无需在加载代码中执行任何特定操作？我正在寻找的就像一个类型的静态构造函数。

例如：

程序集 A 不知道程序集 B，但 B 确实知道 A。如果加载了 B，程序集 A 需要知道有关 B 的某些事情。当运行时（引用或显式）加载程序集 B 时，我希望执行一段代码（静态方法或属性）来调用程序集 A 中的方法。

此问题的根本原因是在序列化 A 中的类型时遇到未知类型，该类型包含来自 B 的类型，在编译时使用接口时未知。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-02-02T22:56:16.747

CLR 支持[模块初始化程序](http://blogs.msdn.com/junfeng/archive/2005/11/19/494914.aspx)。您必须破解 C++/CLI 代码或 ilasm.exe 才能使用它们。

更新：自 .NET 5 起，C# 也直接支持[[ModuleInitializer] 属性](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.moduleinitializerattribute?view=net-5.0)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-02T23:05:35.573

您可以在 .Net 中使用静态构造函数，但不幸的是，它们并不能满足您的要求。静态构造函数仅在使用类型之前执行。有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/k9x6w0hc(VS.80).aspx](http://msdn.microsoft.com/en-us/library/k9x6w0hc(VS.80).aspx)。

您可能会从订阅 AppDomain 的 AssemblyLoad 事件中获得一些好处。请参阅[http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyload.aspx](http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyload.aspx)。

在您的事件处理程序中，您可以反映新加载的程序集，并让它执行您喜欢的任何代码。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-02-11T21:57:51.003

初始化 .NET 程序集有 3 个选项：

1.  您在程序集中编写一个静态函数 Init() 或 Main() 进行初始化，并通过加载此程序集的 C# 代码的反射调用此函数。
2.  编写一个托管 C++ 程序集，将代码放在 DllMain() 中。请小心，因为您的代码将在禁止执行某些操作的加载程序锁中执行（例如加载其他 DLL，...）。但是您可以启动一个新线程来执行任何初始化工作。（关于 LoaderLock： [https](https://msdn.microsoft.com/en-us/library/ms173266.aspx) ://msdn.microsoft.com/en-us/library/ms173266.aspx ）（关于 DllMain： [C# 到 C++/CLI 到 C DLL System.IO.FileNotFoundException](https://stackoverflow.com/questions/647310/c-sharp-to-c-cli-to-c-dll-system-io-filenotfoundexception/881110#881110)）
3.  您编译一个纯 C# 程序集并修改编译后的 DLL 以添加模块初始化代码，如下所述：http: [//einaregilsson.com/module-initializers-in-csharp/](http://einaregilsson.com/module-initializers-in-csharp/) 这种方法的缺点是不调用初始化函数当程序集加载到进程中时立即。但在首次访问程序集中的任何其他内容之前调用它。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-02T22:34:47.117

（编辑 - 适用于 C#；对于 C++ 方法，请参阅[此答案](https://stackoverflow.com/questions/505237/-net-running-code-when-assembly-is-loaded/505333#505333)）

基本上，不：你不能。这将是一个巨大的攻击面，并且是不允许的。您可能希望在某些 B 类型上放置一个静态 ctor，以确保执行 init 代码，但仅此而已......

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-02T22:55:58.867

您可能应该重新审视您的序列化方法以缓解此问题。如果您使用`ISerializable`和`SerializableAttribute`属性进行序列化，则可以使序列化图在必要时加载程序集 B，而无需程序集 A 显式了解程序集 B。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-04T04:42:56.853

使用混合程序集，您可以让 DllMain 在程序集负载上运行。

# asp.net - asp.net gridview 获取数据的时间过长

> ID：505238
> 
> 赞同：0
> 
> 时间：2009-02-02T22:30:15.707
> 
> 标签：asp.net, vb.net, gridview, paging

这似乎很常见，所以我很惊讶我还没有找到解决方案，也许有人可以帮助我。我有一个显示应用程序用户列表的网格视图，这个列表非常大，并且需要永远加载数据。否则，数据会被分页，一旦加载，一切都会好起来的。为了帮助管理员，我制作了搜索框，效果很好。唯一的问题是数据的初始加载，似乎 asp.net 最初正在检索所有记录。

有没有办法只获取当前页面的记录。也许我缺少 gridview 的设置，或者我做错了其他事情。

提前感谢您的建议。

泽利科

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T22:34:36.353

您将不得不进行自己的自定义分页。根据您的数据源，您必须传递 PageIndex 和大小，才能仅获取要返回的页面结果。

我以前用过这个：http: [//aspnet.4guysfromrolla.com/articles/031506-1.aspx](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T22:34:16.900

听起来，当您真正需要 Datareader 时，您可能正在使用 Datatable/Dataset。或者，也许我不理解您所说的“初始”是什么意思，而您遇到的是每次进行新部署时都会点击 jit 编译器。

# javascript - 如果 jQuery 验证失败，JSLint 有什么用

> ID：505251
> 
> 赞同：39
> 
> 时间：2009-02-02T22:33:54.217
> 
> 标签：javascript, jquery

所以我一直在探索不同的方法来清理和测试我的 JavaScript。我认为就像任何其他语言一样，要变得更好的一种方法是阅读好的代码。jQuery非常流行，因此它必须具有一定程度的良好编码。

那么为什么当我通过 JSLint 的验证运行 jQuery 时，它会给我这样的消息：

> 错误：
> 
> 第 18 行字符 5 处的问题：需要一个标识符，但看到的是“未定义”（保留字）。
> 
> 不明确的，
> 
> 第 24 行字符 27 处的问题：缺少分号。
> 
> jQuery = window.jQuery = window.$ = 函数（选择器，上下文）{
> 
> 第 24 行字符 28 处的问题：需要一个标识符，而是看到 '='。
> 
> jQuery = window.jQuery = window.$ = 函数（选择器，上下文）{
> 
> 第 24 行字符 28 处的问题： ***停止，无法继续。（0% 扫描）***。

这是使用[JSLint](http://jslint.com/)和[jquery-1.3.1.js 完成的](http://jqueryjs.googlecode.com/files/jquery-1.3.1.js)

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-02-02T22:55:27.917

JSLint 测试一个特定的人（Douglas Crockford）关于什么是好的 JavaScript 代码的意见。Crockford 非常好，但他的一些观点充其量只是保留性，比如下划线规则，或者使用递增/递减运算符。

JSLint 在上述输出中标记的许多问题是 Crockford 认为导致难以维护代码的问题，或者是他认为过去导致他做出难以维护的“聪明”事情的事情。

不过，Crockford 认为有些事情是我同意的错误，比如缺少分号的事情。删除分号会迫使浏览器猜测在哪里插入语句结束标记，这有时会很危险（它总是很慢）。其中一些错误与 JSLint 不期望或不支持多个赋值有关，如 jQuery 在第 24 行所做的那样。

如果您有关于 JSLint 错误的问题，请发送电子邮件至 Crockford，他非常擅长回复，通过他的回复，您至少会知道为什么 JSLint 会以这种方式实现。

哦，仅仅因为一个库很受欢迎并不意味着它的代码是好的。JQuery 很受欢迎，因为它是一个相对快速、易于使用的库。它的良好实施与它在许多人中的受欢迎程度无关紧要。但是，您当然应该阅读更多代码，我们都应该。

JSLint 在识别代码问题方面非常有帮助，即使 JQuery 没有通过它想要的标准。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-02T22:56:38.507

JSLint 帮助您发现问题，它不是有效性测试或替代思维。随着 js 的发展，jQuery 相当先进，这使得这样的结果可以理解。我的意思是前几行是速度技巧，难怪最严格的 js 解析器会出现几个错误。

无论如何，流行代码是完全正确的代码甚至是“好”的假设是有缺陷的。jQuery 代码很好，你可以从阅读中学到很多东西。你仍然应该通过 JSLint 运行你的东西，如果只是因为很高兴听到对你所写内容的另一个意见。

从 JSLint 的描述中：

> JSLint 获取一个 JavaScript 源并对其进行扫描。如果它发现问题，它会返回一条描述问题的消息以及源中的大致位置。问题不一定是语法错误，尽管它经常是。JSLint 着眼于一些样式约定以及结构问题。它并不能证明你的程序是正确的。它只是提供了另一组眼睛来帮助发现问题。
> 
> JSLint 定义了 JavaScript 的专业子集，这是一种比 ECMAScript 语言规范第 3 版定义的语言更严格的语言。该子集与 JavaScript 编程语言的代码约定中的建议相关。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-02T04:39:37.867

“jQuery 非常流行，所以它必须具有一定程度的良好编码。”

人们希望 jQuery 也是如此，但不幸的是，事实并非如此。jQuery 有用且流行，但它不是一个编写良好的 JavaScript 库。David Mark 最近在 comp.lang.javascript 中发布了对 jQuery 的严厉批评，其中检查了 jQuery 中发现的大量不良代码示例：

[http://groups.google.com/group/comp.lang.javascript/msg/37cb11852d7ca75c?hl=en&](http://groups.google.com/group/comp.lang.javascript/msg/37cb11852d7ca75c?hl=en&)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-02T22:57:38.943

如果您没有积极开发 jQuery 本身，为什么还要在它上面运行 JSLint？如果它有效，它就有效，您不必担心它。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-03T15:55:26.673

jQuery 开发人员的目标与您的目标不同。jQuery 是为速度和紧凑性而构建的，实现这些目标胜过可读性和可维护性。

Crockford 在 JSLint 中的测试更多地是为了实现一些让他感到很舒服的事情，让他可以放心地带回家见他的母亲，如果您将与您的代码结婚一段时间，这是一个有效的担忧。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-13T10:54:25.137

JsLint 的用途在 FAQ [1] 中有明确说明：

“JSLint 定义了 JavaScript 的专业子集，这是一种比 ECMAScript 语言规范第 3 版定义的语言更严格的语言。该子集与 JavaScript 编程语言的代码约定中的建议有关。”

现在，如果您感到困惑：ECMA3 已经是当今任何 JS 解释器提供的 JS 功能的一个子集（有关 JavaScript 和 ECMAScript 版本之间关系的概述，请参阅 [2]）

要回答“JSlint 有什么好处”的问题： * 使用 JsLint 来验证您使用的是 Javascript 的“安全”子集，它不太可能破坏 JS 实现。* 使用 Jslint 验证您是否遵循了 crockford 代码约定 [4]

*   [1] [http://www.jslint.com/lint.html](http://www.jslint.com/lint.html)
*   [2] [https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/JavaScript_Overview#Relationship_between_JavaScript_Versions_and_ECMAScript_Editions](https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/JavaScript_Overview#Relationship_between_JavaScript_Versions_and_ECMAScript_Editions)
*   [3] [https://developer.mozilla.org/en/New_in_JavaScript_1.7#Avoiding_temporary_variables](https://developer.mozilla.org/en/New_in_JavaScript_1.7#Avoiding_temporary_variables)
*   [4] [http://javascript.crockford.com/code.html](http://javascript.crockford.com/code.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-11-13T09:08:26.593

我发现 JSLint 非常非常有用的一个案例：当你抓住一个漂浮在网络上的大型库时，然后是另一个，然后又是另一个，你很快就会发现自己在每个新的页面加载（缓存可能会有所帮助，但它不是万能的解决方案）。

那你会怎么做？压缩这些库。但是您的主机不会对非 html 文件进行压缩！所以呢？您使用 Javascript 压缩器。

我找到的最好的是 Dean Edward 的；我用它来压缩 John Fraser 的 Showdown（JavaScript 库的 Markdown），但不幸的是，压缩破坏了代码。由于不再支持摊牌，我不得不自己更正它——而 JSlint 对此非常宝贵。

简而言之，JSlint 有助于准备 JS 代码以进行重型压缩。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-12-06T15:04:53.950

如果您喜欢 jQuery 允许的菊花链方法，您可能会喜欢 YUI3。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2010-08-24T13:41:22.790

JQuery 当然不是世界上最好的东西。当您查看符号时，这已经很清楚了。美元括号组合对您的眼睛非常不利。编程应该清晰简单。JQuery 远非如此。这个理由足以让我不使用它。它没有正确编写并不让我感到惊讶，只是强调了我对这个 JavaScript 库的看法。

# .net - 是否存在每用户全局程序集缓存之类的东西？

> ID：505257
> 
> 赞同：0
> 
> 时间：2009-02-02T22:36:00.217
> 
> 标签：.net, caching, gac

问题说明了一切

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T22:41:25.013

否。全局程序集缓存是安装在给定机器上的程序集的存储库，即基于其机器，而不是基于用户。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T23:02:29.370

不，顾名思义，GAC 对机器来说是全局的。但是，您可以模拟一个。只需将程序集放在类似于 GAC 的文件夹结构中，然后编写您自己的程序集解析代码（请参阅 参考资料`AppDomain.AssemblyResolve`）。它与真正的 GAC 不太一样（特别是围绕安全性），但它可能适合您的目的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T22:46:37.530

您始终可以将程序集复制到程序运行所在的本地目录中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T22:47:35.797

不完全相同，但请注意，ClickOnce 安装通常是按用户进行的 - 不过与`Program Files`GAC 相比更具可比性。

# c++ - 如何在 VC++ 中创建线程

> ID：505261
> 
> 赞同：8
> 
> 时间：2009-02-02T22:37:44.223
> 
> 标签：c++, windows, visual-studio-2008

*   **在Linux**下用 C 编程时，我倾向于使用[**POSIX 线程**](http://en.wikipedia.org/wiki/POSIX_Threads)。

***   没有**MFC**** 

 ****问题：**

那么我将如何在 VC++ 中创建线程？

查找更多关于win32下线程的信息？

### 编辑：

*   简要插图

**我喜欢 stackoverflow - 学生的最佳资源！**

问候

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-02T22:47:46.810

如果您正在寻找独立于平台的方法，请使用[boost](http://www.boost.org/)

还有 beginthread() 和 beginthreadex() 函数。两者似乎都是对 Win32 API 的补充，从某种意义上说，在许多用例中，您仍然需要调用一些 Win32 函数（例如用于 beginthreadex 的 CloseHandle）。所以，如果你不太在意平台兼容性，不妨剪掉前戏，使用 CreateThread()。

Win32 线程处理记录在这里：http: [//msdn.microsoft.com/en-us/library/ms684852 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms684852(VS.85).aspx)

[编辑1] 示例：

```
DWORD WINAPI MyThreadProc( void* pContext )
{
    return 0;
}

HANDLE h = CreateThread( NULL, 0, MyThreadProc, this, 0L, NULL );
WaitForSingleObject(h, TIME); // wait for thread to exit, TIME is a DWORD in milliseconds 
```

[edit2] CRT & CreateThread():

根据 MSDN：

调用 C 运行时库 (CRT) 的可执行文件中的线程应使用 _beginthreadex 和 _endthreadex 函数进行线程管理，而不是 CreateThread 和 ExitThread；这需要使用 CRT 的多线程版本。如果使用 CreateThread 创建的线程调用 CRT，CRT 可能会在内存不足的情况下终止进程。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T22:49:39.613

您不应使用原始 Win32 `CreateThread()`API。

使用 C 运行时[`_beginthreadex()`](http://msdn.microsoft.com/en-us/library/kdzttdcb.aspx)，这样运行时就有机会设置自己的线程支持。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-02T22:50:40.500

您可以使用 CRT 函数 _beginthreadex() 或 Windows API 函数 CreateThread()。_beginthreadex() 对于具有没有延迟初始化线程本地存储的 CRT 的早期版本的 VC++ 是必需的。CreateThread() 至少在 VS2005 及更高版本中都很好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-02T22:45:50.760

您可能想看看[CreateThread()](http://msdn.microsoft.com/en-us/library/ms682453(VS.85).aspx)函数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T22:44:35.193

关于这个主题的一些好书是 Petzold 的[Programming Windows](https://rads.stackoverflow.com/amzn/click/com/157231995X)和 Richter 的[Programming Applications for Windows。](https://rads.stackoverflow.com/amzn/click/com/1572319968) 特别是，后者深入研究了服务器端编程，例如线程和同步 API。

**编辑：**对于代码片段，谷歌是你的朋友。例如[这篇文章](http://www.codeproject.com/KB/threads/crtmultithreading.aspx)有一些最小的线程示例。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-02T22:48:36.900

使用`_beginthread()`或`_beginthreadex()`创建一个新线程。不要使用 Win32 函数`CreateThread()`——它没有正确初始化 C 运行时的多线程方面。另请参阅[此问题](https://stackoverflow.com/questions/331536/windows-threading-beginthread-vs-beginthreadex-vs-createthread-c)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T22:49:25.340

您还可以查找[_beginthread()函数。](http://msdn.microsoft.com/en-us/library/kdzttdcb(VS.80).aspx)它与 CreateThread() 有点不同，您应该在选择之前了解这些差异。

# c# - C# 命名空间别名 - 有什么意义？

> ID：505262
> 
> 赞同：104
> 
> 时间：2009-02-02T22:38:21.947
> 
> 标签：c#, namespaces

何时何地会使用命名空间别名，例如

```
 using someOtherName =  System.Timers.Timer; 
```

在我看来，这只会增加理解语言的混乱。

* * *

## 回答 #1

> 赞同：169
> 
> 时间：2009-02-02T22:40:15.577

那是类型别名，而不是命名空间别名；消除歧义很有用 - 例如，反对：

```
using WinformTimer = System.Windows.Forms.Timer;
using ThreadingTimer = System.Threading.Timer; 
```

（ps：感谢您的选择`Timer`；-p）

否则，如果您在同一个文件中同时使用两者`System.Windows.Forms.Timer`，`System.Timers.Timer`则必须继续提供全名（因为`Timer`可能会造成混淆）。

它还与`extern`别名一起发挥作用，以使用来自不同程序集的具有相同完全限定类型名称的类型 - 很少见，但受支持很有用。

* * *

实际上，我可以看到另一种用途：当您想要快速访问一个类型，但又不想使用常规`using`因为您无法导入一些冲突的扩展方法时......有点令人费解，但是......这里有一个例子...

```
namespace RealCode {
    //using Foo; // can't use this - it breaks DoSomething
    using Handy = Foo.Handy;
    using Bar;
    static class Program {
        static void Main() {
            Handy h = new Handy(); // prove available
            string test = "abc";            
            test.DoSomething(); // prove available
        }
    }
}
namespace Foo {
    static class TypeOne {
        public static void DoSomething(this string value) { }
    }
    class Handy {}
}
namespace Bar {
    static class TypeTwo {
        public static void DoSomething(this string value) { }
    }
} 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-02-02T22:46:50.117

I use it when I've got multiple namespaces with conflicting sub namespaces and/or object names you could just do something like [as an example]:

```
using src = Namespace1.Subspace.DataAccessObjects;
using dst = Namespace2.Subspace.DataAccessObjects;

...

src.DataObject source = new src.DataObject();
dst.DataObject destination = new dst.DataObject(); 
```

Which would otherwise have to be written:

```
Namespace1.Subspace.DataAccessObjects.DataObject source = 
  new Namespace1.Subspace.DataAccessObjects.DataObject();

Namespace2.Subspace.DataAccessObjects.DataObject dstination = 
  new Namespace2.Subspace.DataAccessObjects.DataObject(); 
```

It saves a ton of typing and can be used to make code a lot easier to read.

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-02-03T21:59:48.760

In addition to the examples mentioned, type aliases (rather than namespace aliases) can be handy when repeatedly referring to generic types:

```
Dictionary<string, SomeClassWithALongName> foo = new Dictionary<string, SomeClassWithALongName>();

private void DoStuff(Dictionary<string, SomeClassWithALongName> dict) {} 
```

Versus:

```
using FooDict = Dictionary<string, SomeClassWithALongName>;

FooDict foo = new FooDict();

private void DoStuff(FooDict dict) {} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-02T22:43:58.580

简洁。

在共享类型名称的命名空间之间提供清晰性有额外的好处，但本质上它只是糖。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-02T22:42:26.290

我总是在这种情况下使用它

```
using Utility = MyBaseNamespace.MySubNamsepace.Utility; 
```

否则`Utility`会有不同的上下文（如`MyBaseNamespace.MySubNamespace.MySubSubNamespace.Utility`），但我希望/更喜欢`Utility`总是指向那个特定的类。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-02T22:42:24.153

当您在多个包含的命名空间中有多个具有相同名称的类时，它非常有用。例如...

```
namespace Something.From.SomeCompanyA {
    public class Foo {
        /* ... */
    }
}

namespace CompanyB.Makes.ThisOne {
    public class Foo {
        /* ... */
    }
} 
```

您可以使用别名让编译器满意，并使您和团队中的其他人更清楚：

```
using CompanyA = Something.From.CompanyA;
using CompanyB = CompanyB.Makes.ThisOne;

/* ... */

CompanyA.Foo f = new CompanyA.Foo();
CompanyB.Foo x = new CompanyB.Foo(); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-02T22:54:57.013

We have defined namespace aliases for all of our namespaces. This makes it very easy to see where a class comes from, e.g:

```
using System.Web.WebControls;
// lots of other using statements

// contains the domain model for project X
using dom = Company.ProjectX.DomainModel; 
// contains common web functionality
using web = Company.Web;
// etc. 
```

and

```
// User from the domain model
dom.User user = new dom.User(); 
// Data transfer object
dto.User user = new dto.User(); 
// a global helper class
utl.SomeHelper.StaticMethod(); 
// a hyperlink with custom functionality
// (as opposed to System.Web.Controls.HyperLink)
web.HyperLink link = new web.HyperLink(); 
```

We have defined some guidelines how the aliases must be named and everyone is using them.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-11-10T16:22:09.583

I find the aliases very useful in unit testing. When you are writing unit tests, it is a common practice to declare the subject to test as

```
MyClass myClassUT; 
```

being `myClassUT` the subject **U**nder **T**est. But what if you want to write unit tests for a static class with static methods? Then you can create an alias like this:

```
using MyStaticClassUT = Namespace.MyStaticClass; 
```

Then you can write your unit tests like this:

```
public void Test()
{
    var actual = MyStaticClassUT.Method();
    var expected = ...
} 
```

and you never loose sight of what the subject under test is.

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-01-18T01:59:23.090

In one way it is really handy while coding in Visual Studio.

**Use-case**: Let's say I've to use only few classes e.g. `SqlConnection` from a namespace `System.Data`. In normal course I'll import the `System.Data.SqlClient` namespace at the top of the *.cs file as shown below:

```
using System.Data; 
```

Now look at my intellisense. It is heavily proliferated with whole lot of classes to choose from while typing in code editor. I'm not going to use whole bunch of classes at all:

[![enter image description here](https://i.stack.imgur.com/fqPTG.png)](https://i.stack.imgur.com/fqPTG.png)

So I would rather use an alias at the top of my *.cs file and get a clear intellisense view:

```
using SqlDataCon = System.Data.SqlClient.SqlConnection 
```

Now look at my intellisense view. It is super-clear and super-clean.

[![enter image description here](https://i.stack.imgur.com/jiE5S.png)](https://i.stack.imgur.com/jiE5S.png)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-10-17T16:36:26.300

One reason I know; It lets you use shorter names when you have name collisions from imported namespaces. Example:

If you declared `using System.Windows.Forms;` and `using System.Windows.Input;` in the same file when you go to access `ModifierKeys` you might find that the name `ModifierKeys` is in both the `System.Windows.Forms.Control` and `System.Windows.Input` namespaces. So by declaring `using Input = System.Windows.Input;` you can then get `System.Windows.Input.ModifierKeys` via `Input.ModifierKeys`.

I'm not a C# buff but aliasing namespace seems like "best practise" to me. That way you know what you're getting and still don't have to type too much more.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-12-01T20:21:25.163

You can use them to modify a code very easily.

For example:

```
#if USE_DOUBLES
using BNumber = System.Double;
#else
using BNumber = System.Single;
#endif

public void BNumber DoStuff(BNumber n) {
    // ...
}
public void BNumber DoStuff2(BNumber n) {
    // ...
}
public void BNumber DoStuff3(BNumber n) {
    // ...
} 
```

By the simple change in of the directive you can decide if your whole code works in `float` or `double`.

# java - 大型机上的 Java

> ID：505284
> 
> 赞同：3
> 
> 时间：2009-02-02T22:44:58.360
> 
> 标签：java, scalability, mainframe

我为一家大型公司工作，该公司运行**大量**基于 x86 的服务器，我们在这些服务器上运行 JVM。

我们已经成功地对 VMWare ESX 进行了试验，以更好地利用我们的数据中心。但是这些仍然消耗每个处理单元的大量功率。

我有一个疯狂的想法，我们应该复活大型机，我们可以托管大量的 JVM 或虚拟机。

有没有人试过这个？有什么好的成本效益吗？

你会失去灵活性吗？例如，我们在公司的其他部分有大型机，但它们似乎对机器的使用更加严格。大量的变更控制，长的交货时间等

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-04T13:46:51.953

IBM 制造了一个特殊的 Java 协处理器，您应该认真考虑。我不会在通用引擎上运行 Java，因为这可能会增加许可软件的 MPU 费用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T01:49:16.427

我们拥有在 Windows、Linux 和 IBM SystemI（或 iSeries，或 AS/400，取决于 IBM 当年的心情）小型计算机上运行 Java 的丰富经验。在我看来，与现代多核 x86 CPU 相比，微型计算机平台的性价比似乎要低得多。

请注意，与当今的典型软件相比，Java 更容易从可用的多个内核中受益，因为它本质上是多线程的——当您运行多个 JVM 时，这将更加真实。

也就是说，您通常能够获得更多可用的 CPU 内核，并具有更好的带宽来访问小型机或大型机上的内存，以及磁盘子系统（整体）的更好吞吐量，因此这些系统可以很好地扩展，因为您折腾更多的 JVM在他们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T02:18:32.220

所有这一切都假设您谈论的是 Z/OS 上的 Java，而不是在大型机上运行 Linux VM，以利用更少机器带来的成本节约。

我对虚拟化的想法在此结束，这可能是您想要查看的路线，但我将从 Z/OS 开始，因为它是大型机传统上与我相关的东西，也是我熟悉的东西。我对大型机 Java 有一些经验。

简短的回答是，这取决于，但可能不是。你的应用究竟是什么？与 x86 服务器相比，大型机是一个困难的环境。如果您在 Websphere 之类的环境下运行 I/O 密集型工作负载，假设您的大型机未得到充分利用，这可能是值得的。

根据我的经验，Java 在大型机上运行速度非常慢，但那是因为我使用的系统是为开发人员的灵活性而非性能而设置的。这只是证明大型机的性能调整通常比普通服务器复杂得多，因为大型机将运行比通用 x86 服务器更多的工作负载。

请记住，大型机主要是为 I/O 吞吐量而设计的，并且在这方面可以胜过任何普通的 x86 服务器。它不是为进行大量计算密集型计算而设计的，因此如果您进行大量数学运算，它的性能不会胜过小型 x86 服务器集群。

大型机上的更改控制是有充分理由的——如果一台 x86 服务器出现问题，则重新启动它。如果大型机出现问题，它每停机一秒都会给公司造成损失。您还必须考虑您的应用程序依赖的任何本机代码或可能使用本机代码的第三方库。所有这些代码都必须移植。

与 x86 服务器相比，大型机的配置平均需要更长的时间。我建议，如果您想认真研究这一点，您可以制定比节能更好的业务案例，例如与当前业务应用程序紧密集成，并从概念验证或新应用程序的小规模开始。一种不是业务关键的，可以实施以利用大型机的优势。

IBM 大型机还可以在本机模式或类似于 VMWare 的虚拟化环境中运行 Linux。除非您的公司是该规则的例外，否则您的 Linux 实例将作为虚拟机运行。我对此没有太多经验，但是，如果您的应用程序不依赖本机代码并在 Linux 下运行，它可能会在运行 Linux 的大型机上运行。有关大型机上 Linux 的更多信息，请参阅[此链接](http://en.wikipedia.org/wiki/Linux_on_zSeries)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T22:48:34.793

IBM 允许这样做。他们的一些大型机可以容纳 Java 加速器处理器，这些处理器在本地运行字节码以获得更高的性能。它们也有 DB2 加速器，可能还有一些用于 XML 操作。

我从来没有和他们中的任何一个一起玩，但我肯定很喜欢。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-04T13:52:34.823

尽管我从 1975 年就开始从事这个行业，但我不再确定什么是“大型机”。我目前的开发机器有四个 3GHZ 处理器、8GB 内存和 750GB 磁盘空间（RAID 1，所以它真的是它的两倍）和两个 19 英寸纯平显示器。

那是因为我是有合同的。员工们都有比我强大得多的盒子。

我知道服务器机器，尤其是数据库服务器，速度要快得多。

大型机？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-25T04:50:05.310

根据您的工作量，这值得一看！

仅使用 IBM 硬件，就有许多令人眼花缭乱的选项可供您使用：

1.  它绝对值得考虑添加 java 处理器。（这些实际上与标准 cpu 并没有什么不同，只是它们仅限于 java jvm 工作负载——而且——最重要的是，它们不包括在基于 cpu 的软件许可定价中）。

2.  您可以运行多个 Linux VM，每个都运行自己的 Java 应用程序。

3.  您可以运行多个本机 VM，运行他们曾经称为 DOS 的极简操作系统，但它们每隔几年就会更改名称。软件许可证比主操作系统便宜，但它的功能非常有限，如果您运行的是自包含应用程序，这将是一个优势。

4.  您可以在 Monster z/OS 环境中运行：-

一种。在 USS（Unix 系统服务）中，它几乎是在父 z/OS 中运行的完整 UNIX 操作系统。

湾。在自己的启动任务（== unix 守护进程）中运行您的 java 应用程序。

C。在 CICS 中运行您的应用程序。（可能不需要在通常使用 Servlet/J2EE API 的地方使用 CICS/Java API，因此您的应用程序需要重写。）

# rsync - 使用 rsync 删除单个文件

> ID：505289
> 
> 赞同：18
> 
> 时间：2009-02-02T22:45:58.933
> 
> 标签：rsync

文件 foo.txt 存在于远程机器上：/home/user/foo.txt

它在本地计算机上不存在。

我想使用 rsync 删除 foo.txt。

我不知道（并假设我无法找出这个问题的目的）本地或远程机器上的 /home/user 中有哪些其他文件，所以我不能只同步整个目录。

我可以使用什么**rsync**命令删除远程机器上的 foo.txt？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-02T22:52:57.407

试试这个：

```
rsync -rv --delete --include=foo.txt '--exclude=*' /home/user/ user@remote:/home/user/ 
```

（强烈建议`--dry-run`先运行来测试它）虽然看起来使用 ssh 会更容易......

```
ssh user@remote "rm /home/user/foo.txt" 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-10-17T12:05:24.360

这有点微不足道，但如果你像我一样来到这个页面，寻找一种使用 rsync 从远程服务器删除目录内容的方法，我就是这样做的：

1.  创建一个空的模拟文件夹：

    `mkdir mock`

2.  与之同步：

    `rsync -arv --delete --dry-run ~/mock/ remote_server:~/dir_to_clean/`

3.  从上面的行中删除`--dry-run`以实际执行此操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-07-22T14:34:12.150

如上所述，用于`--dry-run`预先测试。`--delete`根据 rsync 手册页删除远程位置上的文件。

```
rsync -rv --delete user@hostname.local:full/path/to/foo.txt 
```

下面的评论指出这将仅列出是不正确的。仅列出使用`--list-only`和删除`--delete`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-05-31T07:49:38.570

刚刚遇到同样的问题，需要用于`rsync`删除远程文件，因为**只** `rsync`允许使用其他 SSH 命令，并且不允许使用其他 SSH 命令。[--remove-source-files](https://download.samba.org/pub/rsync/rsync.html)选项（以前称为[--remove-sender-files](https://git.samba.org/?p=rsync.git;a=commit;h=47c1197534c3247a2669df86fbc36d4094d6ba93 "决定我比 remove-sender-files 更喜欢 remove-source-files。") ）正是这样做的：

```
rsync -avPn --remove-source-files remote:/home/user/foo.txt .
rm foo.txt 
```

与往常一样，删除`-n`选项以真正执行此操作。

# vb.net - 如何使用图形对象上的颜色将区域填充到其边界？

> ID：505291
> 
> 赞同：2
> 
> 时间：2009-02-02T22:46:22.333
> 
> 标签：vb.net, graphics

我正在四处玩耍，并尝试为我的孩子们制作一本涂色书，我有很多黑白线条画用作背景，这样他们就可以在上面画画。

现在，我想添加一个 FILL 函数，以便他们可以指向并单击绘图中白色的某个位置，然后让该函数用颜色填充其边界内的整个区域。

最好有一个函数，通过发送 X、Y 和为边界定义的颜色并从中获取一个区域。然后它即将执行 e.Graphics.FillRegion (brush,region) 来填充颜色。

但是我找不到任何允许我这样做的功能，而且我认为自己追踪边界的工作太多了。

我是否错过了 system.drawing 类中执行此操作的某些功能，或者您还有其他想法吗？

着色书程序的任何其他想法也很有趣。（我正在使程序安全，因此您可以将孩子留在电脑前，而不必担心孩子访问计算机上的任何其他东西，并且在选择颜色等时会发出不同的有趣声音等）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T22:57:03.187

研究洪水填充方法。[维基百科在这里](http://en.wikipedia.org/wiki/Flood_fill)有大量关于这个主题的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T23:10:37.793

如果“边界”是由不同颜色的像素定义的，而不是数学公式或路径数据结构，您将必须测试和填充单个像素。[Code Project](http://www.codeproject.com/KB/GDI-plus/floodfillincsharp.aspx)上有一篇关于如何在 .Net 中泛滥的文章。

# language-agnostic - 类设计：实体 ID 与实体引用

> ID：505305
> 
> 赞同：1
> 
> 时间：2009-02-02T22:48:37.557
> 
> 标签：language-agnostic, class-design

如果我的 Foo 具有 Bar 类型的属性。两者都保存在可以通过 ID 检索的数据库中。（ID 实际上是由客户服务声明在业务线中使用的。所以它们不仅仅是索引占位符。）我可以采用 b1 或 b2 所示的方法。

将实体链接在一起让我感到害怕，因为如果你把它推得太远，很容易让 Null 弹出。另一方面，让 ID 随处可见似乎增加了不必要的冗长。

```
int fooKey = 123;
Foo f = new Foo(fooKey);
Bar b1 = new Bar(Foo.BarID);  //This?
Bar b2 = Foo.Bar;  // Or This? 
```

注意：这与 .NET 实体框架无关。这里使用的词实体是一般意义上的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T23:09:16.297

作为一般规则，我尽量避免链接，因为它通常会引入不必要的紧耦合。一切都取决于上下文，但就业务对象而言，保持实体松散耦合以便它们可以独立增长可能是一个好主意。

在您提供的示例中，我认为没有必要进行紧密耦合。如果交叉点更大，这可能是有道理的，但我发现这不是业务实体的一般情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T22:51:12.170

看看 MSFT 实现 LINQ to SQL 的方式。他们让你设置非此即彼。他们的映射器足够聪明，可以根据需要公开属性和延迟加载。IMO 你应该采用最简单的方式（使用 ID）或使用 O/R 映射器，如 Hibernate/NHibernate、Linq to SQL 或 Linq to Entities，如果你想要花哨的话。

# jquery - 使用 jquery 自动刷新 div

> ID：505314
> 
> 赞同：2
> 
> 时间：2009-02-02T22:51:24.993
> 
> 标签：jquery, xmlhttprequest, refresh

当尝试使用此处提供的代码[链接文本](https://stackoverflow.com/questions/220767/auto-refreshing-div-with-jquery/500871)时，我遇到了一些问题，建议为此问题打开一个新问题。我在这里使用该代码[链接文本](http://togethr.org/test/test.php)尝试为会议创建反向通道（它使用 twitter 搜索 api 来显示数据，所以请尝试使用一些哈希键来获取数据）。问题是，当内容得到它时，它会立即再次消失，就好像 div 被隐藏了一样。查看源代码时，我可以看到 div 的内容，但没有显示。除非发生超时并且正在显示超时的错误消息，否则下面 div 的内容将保留。为了完整起见，我将把正在使用的代码放在这里：

```
 <script type="text/javascript">
    function update() {

    $("#notice_div").html('<img src="img/ajax-loading.gif" border="0"/>');
    $.ajax({
        type: 'GET',
    url: 'inc/backchannel.php',
        timeout: 2000,
    success: function(data) {
        $("#backchannelContent").html(data);
        $("#notice_div").html(''); 
        window.setTimeout(update, 2000);
    }, 
    error: function (XMLHttpRequest, textStatus, errorThrown) {
        $("#notice_div").html('Timeout contacting server..');
        window.setTimeout(update, 60000);
    }
    })}$(document).ready(update);
    </script> 
```

提前感谢您的帮助，我不是一个 javascript 编码器，所以感觉就像在这里走在砖墙上:-(

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T14:05:49.063

您遇到了问题，因为在隐藏动画完成之前加载了 div 的内容。您可以使用另一个回调来解决它，如下所示：（
这与 Mark 写的非常相似，但使用匿名函数）

```
$(document).ready(function(){
  setInterval(function(){
    $("#random:not(:animated)").hide("slow", function(){
        $("#random").load("inc/backchannel.php").show("slow");
    });//show callback
  } ,10000);//set interval
});//doc.ready 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T22:56:15.387

尝试这样的事情

```
function getRandom() {
    $("#random").hide("slow");
    $("#random").load("http://www.google.co.uk", '', callback);
}

function callback() {
    $("#random").show("slow");
    setTimeout("getRandom();", 10000);
}

$(document).ready(getRandom); 
```

# asp.net - 哈希表插入失败。负载系数太高。- ASP.NET 2.0

> ID：505322
> 
> 赞同：6
> 
> 时间：2009-02-02T22:54:15.937
> 
> 标签：asp.net, exception, .net-2.0

我在尝试登录到安全目录时收到以下错误。据我所知，没有使用大型哈希表。用户登录信息位于 web.config 文件中。请注意，这发生在 .NET 2.0 中。我已经搜索并找到了在 .net 1.0 或 1.1 环境中发生的引用，但我还没有找到在 2.0+ 中发生的解决方案。

我需要弄清楚为什么会发生这种情况，以便将来避免它。我可以重置服务器，也许它会消失，但我更愿意了解它为什么会发生。

这是整个错误页面，如图所示：

> “/”应用程序中的服务器错误。
> 
> 哈希表插入失败。负载系数太高。
> 
> 说明：执行当前 Web 请求期间发生未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。
> 
> 异常详细信息：System.InvalidOperationException：哈希表插入失败。负载系数太高。
> 
> 源错误：
> 
> 在执行当前 Web 请求期间生成了未处理的异常。可以使用下面的异常堆栈跟踪来识别有关异常起源和位置的信息。
> 
> 堆栈跟踪：
> 
> [InvalidOperationException：哈希表插入失败。负载因子太高。] System.Collections.Hashtable.Insert(Object key, Object nvalue, Boolean add) +2903977 System.Collections.Hashtable.set_Item(Object key, Object value) +11
> System.ComponentModel.ReflectTypeDescriptionProvider.ReflectGetAttributes(Type type) +323
> System.ComponentModel.ReflectedTypeData.GetAttributes() +36 System.ComponentModel.DefaultTypeDescriptor.System.ComponentModel.ICustomTypeDescriptor.GetAttributes() +50 System.ComponentModel.TypeDescriptor.GetAttributes(Type componentType) +26
> System.Web.UI .ThemeableAttribute.IsTypeThemeable(Type type) +98
> System.Web.UI.Control.ApplySkin(Page page) +49
> System.Web.UI.Control.InitRecursive（控件命名容器）+2120286
> System.Web.UI.Control.InitRecursive（控件命名容器）+198
> System.Web.UI.Control.InitRecursive（控件命名容器）+198
> System.Web.UI .Control.InitRecursive（控件命名容器）+198
> System.Web.UI.Page.ProcessRequestMain（布尔includeStagesBeforeAsyncPoint，布尔includeStagesAfterAsyncPoint）+834
> 
> 版本信息：Microsoft .NET Framework 版本：2.0.50727.1433；ASP.NET 版本：2.0.50727.1433

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T23:02:23.520

以下修补程序解决了此（和其他）问题。

[http://support.microsoft.com/?id=927579](http://support.microsoft.com/?id=927579)

（信息来源于[这里](http://blogs.msdn.com/toddca/archive/2007/01/26/hashtable-insert-failed-load-factor-too-high.aspx)）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-03-15T13:19:15.197

在 .NET 4.0 中，同样的错误再次出现；它已在[KB:2576011](http://support.microsoft.com/kb/2576011)的修补程序中修复。它现在可能被汇总到标准更新中（尚未检查），但是：如果需要，可以从 MS 获得 4.0 的修补程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-01T12:45:07.190

我有一个类似的问题，在这里概述： [HashTable Insert Failed。负载系数太高。.NET 2.0 SP2](https://stackoverflow.com/questions/1888072/hashtable-insert-failed-load-factor-too-high-net-2-0-sp2)

但是，927579 修补程序包含在 .NET 2.0 SP1 ( [http://support.microsoft.com/kb/945757](http://support.microsoft.com/kb/945757) ) 中，我们仍然遇到与上面列出的相同的问题。希望较新的修补程序 ( [http://code.msdn.microsoft.com/KB968432](http://code.msdn.microsoft.com/KB968432) ) 将一劳永逸地解决它。

我不能保证它，因为我还没有机会在我们的服务器上安装它，并且考虑到我们在上次之后没有再次出现问题，那么即使它已经安装我也不会能不能说好不好用！

# c# - 序列化自定义对象中的位图

> ID：505325
> 
> 赞同：1
> 
> 时间：2009-02-02T22:55:20.537
> 
> 标签：c#, serialization, bitmap

我有一个值类型对象，我正在尝试序列化（通过 BinaryFormatter），但在这个对象中有 3 个位图，当序列化对象时会抛出“一般 gdi+ 异常”（不认真，这是异常）。

必须将这些位图序列化到文件中（而不是仅仅存储它们的相对位置并将图像与序列化对象的其余部分一起传输）。

该对象看起来很像：

```
[Serializable]
public struct MyObject
{
  public String whatever;
  // ...
  public Bitmap img1;
  public Bitmap img2;
} 
```

我像这样序列化它：

```
BinaryFormatter bFormatter = new BinaryFormatter();
fs = new FileStream(m_ContractFolder + filename + ".xtn", FileMode.OpenOrCreate);

bFormatter.Serialize(fs, contract); 
```

我搜索了一下，发现的大部分内容都是 xmlserialization（在这种情况下并不理想）。我不确定还能做什么。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T02:49:18.257

我过去在克隆和缩略图图像时遇到过类似的情况。不幸的是，已经有几年了，我不记得细节了，但它与文件句柄和 GDI 持有它们作为该 Image 对象的源有关。

我通过从 MemoryStream 加载图像而不是从实际源流加载图像解决了这个问题。如果您的图像在文件中，请先将文件内容加载到 MemoryStream 中。然后从 MemoryStream 加载图像。

# labview - 轻松创建 LabVIEW 应用程序使用的 VI 列表

> ID：505337
> 
> 赞同：7
> 
> 时间：2009-02-02T22:57:12.343
> 
> 标签：labview

我有一个我继承的 LabVIEW 应用程序，它有一堆子 VI。在清理它的过程中，我发现一些包含的 VI 没有使用。我知道我可以使用 VI Hierarchy 将包含的每个 VI 作为图标查看，但这对于与目录列表进行比较并没有多大用处。是否有一种（简单的）方法来创建 LabVIEW 应用程序使用的 VI 列表？我只想要一个清单。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T14:03:34.853

[在 National Instruments 网站上的此下载](http://zone.ni.com/devzone/cda/epd/p/id/2094)会将所选 VI 的所有子 VI 的列表保存到文本文件中。

如果您只想查看列表（并拥有应用程序构建器或专业开发系统），请选择工具>构建应用程序并单击 VI 设置选项卡。

这些方法都不会告诉您动态加载的 VI，但您可以检查其中是否有任何用于编辑>查找>对象并搜索引用节点调用和/或调用节点。

LabVIEW 8 及更高版本的项目资源管理器中也可能有执行此操作的方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T15:03:09.087

有几种选择：

1.  [LabVIEW链接器](http://wiki.lavag.org/Linker.Read_info_from_file)
2.  开源[OpenG 工具包](http://www.openg.org)有一个[List VI Hierarchy](http://wiki.openg.org/List_VI_Hierarchy) vi：

[![ListVI 层次结构](https://i.stack.imgur.com/ZdEii.png)](https://i.stack.imgur.com/ZdEii.png)
[（来源：[openg.org](http://wiki.openg.org/images/4/4e/List_VI_Hierarchy.png)）]

3、搭建递归工具获取VI.SubVIs方法

清理程序的一个好方法是执行“另存为”并选择将源构建到新位置。

吨

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T14:36:15.507

使用 LV8 下的项目资源管理器，您可以保存当前项目的所有 VI 的文件信息（“项目”菜单，选择“文件信息”，然后单击“导出文件信息”按钮），但这只会列出所有 VI项目。

要获取应用程序的顶层 VI 使用的所有 VI 的列表，您可以使用 VI 服务器递归地获取所有被调用者的列表并构建该列表。基本上打开对顶层 vi 的引用并使用属性节点，获取 Callees 的字符串数组并重复直到没有更多。您还可以获取 VI 的路径，这样您就可以屏蔽掉 vi.lib 文件夹中的所有标准 VI。

我整理了一个简单的 VI，可以在半小时内完成这项工作，如果需要，我可以提供。

刚刚看到 National Instruments 网站上有一个可用的版本，但我当然更喜欢我的版本，因为它会过滤掉库 VI。

# php - PHP 的 $_GET 和 URL 重写

> ID：505338
> 
> 赞同：11
> 
> 时间：2009-02-02T22:57:33.187
> 
> 标签：php, url-rewriting, url-routing, friendly-url

URL 重写如何影响`$_GET`PHP 的参数？

假设我有一个类似的 URL `http://example.com/index.php?p=contact`，我用它`$_GET['p']`来告诉`index.php`提供联系页面。如果我使用将 URL 转换为 的重写规则`http://example.com/contact`，是否`$_GET['p']`仍能按预期工作？

如果是这样，你能详细说明它为什么有效吗？如果不是，可以使用什么策略来解决问题，以便页面在重写和不重写的情况下都可以工作？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-02T23:39:43.943

我会将格兰特的回答修改为“是的，这将*大部分*按预期工作”。

具体来说，`mod_rewrite`关于现有查询字符串的行为可能令人惊讶。例如，让我们采用以下规则，它会转换您提供的 URL：

```
RewriteRule /contact /index.php?p=contact 
```

这将正确地重写`/contact`，`/index.php?p=contact`并且页面名称将可以通过`$_GET['p']`. 但是，如果您将此技术与使用页面名称以外的参数的脚本一起使用，它会变得有点棘手。这条规则也转化`/contact?person=Joe`为`/index.php?p=contact`. 参数`person=Joe`完全消失！有两种方法可以解决这个问题。

最简单的方法是在规则中使用`[QSA]`("query string append") 标志，它将原始查询字符串放在规则中提供的参数*之后*，转换`/contact?person=Joe`为`/index.php?p=contact&person=Joe`：

```
RewriteRule /contact /index.php?p=contact [QSA] 
```

但是，这使得您的`p=`参数有可能被覆盖。访问`/contact?p=about`将被重写为`/index.php?p=contact&p=about`，因此`$_GET['p']`将在您的脚本中返回“about”，而不是“contact”。要解决此问题，请改用该`QUERY_STRING`变量：

```
RewriteRule /contact /index.php?%{QUERY_STRING}&p=contact 
```

这保证了在使用此规则时`$_GET['p']`将**始终**返回“联系人”，无论您的访问者是否在弄乱您的 URL。:-)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-02T23:00:13.150

是的，这将按预期工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T23:08:24.583

当重写 URL 时，这由 mod_rewrite 完成——最终检索到的页面仍然是“旧”页面，即 index.php?p=contact。换句话说，浏览器检索 /contact。mod_rewrite 然后将其重写为 index.php?p=contact。由于这个原因，脚本不知道发生了任何重写——它仍然被称为“通常”的方式。因此，这样的重写将起作用。您可能希望将其视为一种重写代理，它请求的页面与原始浏览器请求的页面不同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T23:08:54.677

当客户端请求[http://example.com/contact](http://example.com/contact)时，服务器使用重写规则为它们提供[http://example.com/index.php?p=contact](http://example.com/index.php?p=contact)。客户端将无法看到重写后的 URL，甚至可能无法判断它已被重写。以客户端的身份请求任一 URL 都会为您提供完全相同的页面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T23:02:02.333

您将 URL 重写为`/contact`to `/index.php?p=contact`，所以是的，它会按预期工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T23:04:14.093

不是在渲染页面的一部分后修改标题会导致php页面搞砸吗？你是如何重写 URL 的？可能我理解错了...

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-02-02T23:22:21.730

在你的情况下，它不会工作。mod_rewrite 在找到匹配项并将 http://example.com/index.php?p=contact 重写[为](http://example.com/index.php?p=contact)http://example.com/contact [后](http://example.com/contact)，会进行内部重定向。即使在重定向之后，新的重定向 URI 仍然可以与条件匹配并进一步重定向。

在任何情况下，传入的 URI 都不会保存在内存中，因此即使是 Apache 也无法重建原始 URI。PHP 在执行时也不知道原始 URI。因此，您丢失了 $_GET 变量，因为通过*GET*发送的变量包含在 URL 中，现在已经转换，并且 PHP 通过解析传入的请求来填充关联的 $_GET 数组。

为两者提供支持将是艰苦的。如果您有[http://domain.com/segment1/segment2/segment3](http://domain.com/segment1/segment2/segment3)，则必须将这些细分与有意义的东西相关联。您将剥离您的域并在“/”上爆炸，在您的情况下，您可以说第一段请求该页面，并且从[http://example.com/contact/](http://example.com/contact/)您可以提取 page = 'contact'

# c# - 如何禁用 ASP.NET 页面中的所有控件？

> ID：505353
> 
> 赞同：21
> 
> 时间：2009-02-02T23:01:12.867
> 
> 标签：c#, webforms, asp.net-controls

我在一个页面中有多个下拉列表，如果用户选择一个显示全部禁用的复选框，我想禁用所有。到目前为止，我有这段代码，但它不起作用。有什么建议么？

```
foreach (Control c in this.Page.Controls)
{
    if (c is DropDownList)
        ((DropDownList)(c)).Enabled = false;
} 
```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-02-02T23:10:44.063

每个控件都有子控件，因此您需要使用递归来访问它们：

```
protected void DisableControls(Control parent, bool State) {
    foreach(Control c in parent.Controls) {
        if (c is DropDownList) {
            ((DropDownList)(c)).Enabled = State;
        }

        DisableControls(c, State);
    }
} 
```

然后像这样调用它：

```
protected void Event_Name(...) {
    DisableControls(Page,false); // use whatever top-most control has all the dropdowns or just the page control
} // divs, tables etc. can be called through adding runat="server" property 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2013-04-09T15:15:49.127

我知道这是一个旧帖子，但这就是我刚刚解决这个问题的方法。根据标题“如何禁用 ASP.NET 页面中的所有控件？” 我使用反射来实现这一点；它适用于所有具有 Enabled 属性的控件类型。只需调用传入父控件（即窗体）的 DisableControls。

C＃：

```
private void DisableControls(System.Web.UI.Control control)
{
    foreach (System.Web.UI.Control c in control.Controls) 
    {
        // Get the Enabled property by reflection.
        Type type = c.GetType();
        PropertyInfo prop = type.GetProperty("Enabled");

        // Set it to False to disable the control.
        if (prop != null) 
        {
            prop.SetValue(c, false, null);
        }

        // Recurse into child controls.
        if (c.Controls.Count > 0) 
        {
            this.DisableControls(c);
        }
    }
} 
```

VB：

```
 Private Sub DisableControls(control As System.Web.UI.Control)

        For Each c As System.Web.UI.Control In control.Controls

            ' Get the Enabled property by reflection.
            Dim type As Type = c.GetType
            Dim prop As PropertyInfo = type.GetProperty("Enabled")

            ' Set it to False to disable the control.
            If Not prop Is Nothing Then
                prop.SetValue(c, False, Nothing)
            End If

            ' Recurse into child controls.
            If c.Controls.Count > 0 Then
                Me.DisableControls(c)
            End If

        Next

    End Sub 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-02-02T23:04:22.237

如果您将所有要禁用的控件放在一个面板中，然后启用/禁用该面板，那将是最简单的。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-10-30T17:40:23.563

在要禁用的页面部分周围放置一个面板：

```
 < asp:Panel ID="pnlPage" runat="server" >
      ...
   < /asp:Panel > 
```

Page_Load 内部：

```
 If Not Me.Page.IsPostBack Then
      Me.pnlPage.Enabled = False
   End If 
```

... 或 C# 等价物。:o)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-02T23:15:25.817

你必须这样做递归，我的意思是你必须禁用控件的子控件：

```
protected void Page_Load(object sender, EventArgs e)
{
  DisableChilds(this.Page);
}

private void DisableChilds(Control ctrl)
{
   foreach (Control c in ctrl.Controls)
   {
      DisableChilds(c);
      if (c is DropDownList)
      {
           ((DropDownList)(c)).Enabled = false;
      }
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-08-29T16:55:15.800

我正在使用 ASP.Net 和 HTML 控件，我确实喜欢这样

```
public void DisableForm(ControlCollection ctrls)
    {
        foreach (Control ctrl in ctrls)
        {
            if (ctrl is TextBox)
                ((TextBox)ctrl).Enabled = false;
            if (ctrl is Button)
                ((Button)ctrl).Enabled = false;
            else if (ctrl is DropDownList)
                ((DropDownList)ctrl).Enabled = false;
            else if (ctrl is CheckBox)
                ((CheckBox)ctrl).Enabled = false;
            else if (ctrl is RadioButton)
                ((RadioButton)ctrl).Enabled = false;
            else if (ctrl is HtmlInputButton)
                ((HtmlInputButton)ctrl).Disabled = true;
            else if (ctrl is HtmlInputText)
                ((HtmlInputText)ctrl).Disabled = true;
            else if (ctrl is HtmlSelect)
                ((HtmlSelect)ctrl).Disabled = true;
            else if (ctrl is HtmlInputCheckBox)
                ((HtmlInputCheckBox)ctrl).Disabled = true;
            else if (ctrl is HtmlInputRadioButton)
                ((HtmlInputRadioButton)ctrl).Disabled = true;

            DisableForm(ctrl.Controls);
        }
    } 
```

像这样称呼

```
DisableForm(Page.Controls); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-10T20:15:49.417

这是一个 VB.NET 版本，它还带有一个可选参数，因此它也可以用于启用控件。

Private Sub SetControls(ByVal parentControl As Control, Optional ByVal enable As Boolean = False)

```
 For Each c As Control In parentControl.Controls
        If TypeOf (c) Is CheckBox Then
            CType(c, CheckBox).Enabled = enable
        ElseIf TypeOf (c) Is RadioButtonList Then
            CType(c, RadioButtonList).Enabled = enable
        End If
        SetControls(c)
    Next

End Sub 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-12-04T11:19:29.053

```
 private void ControlStateSwitch(bool state)
{
    foreach (var x in from Control c in Page.Controls from Control x in c.Controls select x)
        if (ctrl is ASPxTextBox)

            ((ASPxTextBox)x).Enabled = status;

        else if (x is ASPxDateEdit)

            ((ASPxDateEdit)x).Enabled = status;
} 
```

我使用 linq 方法。使用 devExpress 时，您必须包含 DevExpress.Web.ASPxEditors 库。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-10T20:22:17.123

如果您真的想禁用页面上的***所有***控件，那么最简单的方法是将表单的 Disabled 属性设置为 true。

ASPX：

```
<body>
    <form id="form1" runat="server">
      ...
    </form>
</body> 
```

代码隐藏：

```
protected void Page_Load(object sender, EventArgs e)
{
    form1.Disabled = true;
} 
```

但当然，这也会禁用您的复选框，因此您将无法单击复选框以重新启用控件。

# c# - 为什么在 Vista 上 Linq to Xml 这么慢？

> ID：505357
> 
> 赞同：0
> 
> 时间：2009-02-02T23:02:11.507
> 
> 标签：c#, xml, linq, windows-vista, performance

我有一个应用程序将一些 XML 文档加载到内存中，然后使用 Linq 对其运行各种查询。

该应用程序在实时服务器 (Windows Server 2003) 和 XP 上的 Visual Studio 2008 下运行良好。但是在我的 Vista 笔记本电脑（4gb RAM，2GHz CPU）上，所有的 Linq 查询都运行*得非常*慢。应该花费几毫秒而不是几秒钟。有趣的是，代码的所有其他部分都可以正常快速地运行。

有没有其他人遇到过这种事情？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T23:09:49.400

不，我绝对没有。查看您的系统事件日志。里面有什么奇怪的事情吗？看看你的 CPU。有什么东西在吃你的 CPU 吗？是你认为的那样吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T13:59:00.153

我没有看到您报告的那种性能问题。有关查询莎士比亚全集的示例，请参阅[http://thinqlinq.com/Default/Querying-the-complete-plays-of-Shakespeare-using-LINQ-to-XML.aspx](http://thinqlinq.com/Default/Querying-the-complete-plays-of-Shakespeare-using-LINQ-to-XML.aspx)线。当跨越 40 个 XML 文件，每个文件大小为 100 K 生成一个 5 meg XML 文档时，我仍然看到亚秒级的查询时间。

您可能会遇到导致性能下降的复杂连接或递归 where 子句的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T23:13:13.870

我的台式机和笔记本电脑上的 VS 2008 和 SQL DEV 没有任何此类问题。我的机器规格与您的相似。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T15:34:44.687

笔记本电脑的硬盘驱动器有多快。您可能只是看到从磁盘加载大型 xml 文件的成本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T05:26:00.810

我在 Vista 下看到了在 XP 下不会出现的巨大的疯狂性能问题——但只有当我在 IDE 下运行调试版本时才会出现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T01:29:01.477

Get a profiler like the one built into VS, or the profiler from Red Gate ([http://www.red-gate.com/](http://www.red-gate.com/)) and find out what's actually happening!

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T23:23:11.793

这里没有问题，我的开发代码库中有很多 linq。在我的笔记本电脑上运行 Vista Ultimate (32) 进行开发。在我的测试服务器上运行 windows 2003。

没有我注意到的问题。

# sharepoint - 我如何以编程方式知道给定的 SPWeb 是否是 SearchCenter 站点

> ID：505370
> 
> 赞同：1
> 
> 时间：2009-02-02T23:06:26.787
> 
> 标签：sharepoint, spweb

我有一个 SPWeb 对象，我想知道这是否是 SearchCenter 站点。我怎么能以编程方式知道它。是否有一些设置要检查或匹配的指南等？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T07:01:03.663

SearchCenter 是从一个特殊的站点模板创建的，您可以从SPWeb 对象的[WebTemplate属性中识别该模板。](http://www.codeplex.com/sharepointinstaller/Thread/View.aspx?ThreadId=34752)它将带有值“SRCHCEN”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T23:27:13.780

我不确定，但[此处](http://stsadm.blogspot.com/2007/08/enumerate-features.html)显示的功能 ID GUID可能是全局的。

# asp.net - 将记录注入 DataList

> ID：505374
> 
> 赞同：0
> 
> 时间：2009-02-02T23:08:06.627
> 
> 标签：asp.net, datalist

我想要关于如何将记录注入我的 DataList 以提供“全部”选项的建议。这是我的代码，数据来自 Northwind 数据库。

```
<asp:DataList ID="DataList1" runat="server" DataSourceID="SqlDataSource1" 
        RepeatLayout="Flow" ShowFooter="False" ShowHeader="False" 
        RepeatDirection="Horizontal" 
        onitemcommand="DataList1_ItemCommand">
        <ItemStyle CssClass="datalist" />
    <ItemTemplate>
        <%#(((DataListItem)Container).ItemIndex+1).ToString() %>
        <asp:LinkButton ID="lbtnRegion" runat="server" 
          Text='<%# Eval("RegionDescription").ToString().Trim() %>'
        CommandName='<%# DataBinder.Eval(Container.DataItem,"RegionID")%>' />                    
    </ItemTemplate>       
    </asp:DataList>
    <asp:SqlDataSource ID="SqlDataSource1" runat="server" 
    ConnectionString="<%$ ConnectionStrings:NorthwindConnectionString %>" 
    SelectCommand="SELECT [RegionID], [RegionDescription] FROM [Region]" 
        ondatabinding="SqlDataSource1_Databinding" 
    onselected="SqlDataSource1_Selected">
</asp:SqlDataSource> 
```

我正在使用 Datalist 中的链接按钮来过滤区域并将它们显示在 GridView 中。 **我想做的是在数据绑定过程中的某些地方，在 DataList 中添加一个将充当 ALL 选项的项目**，任何建议都将不胜感激。

```
protected void DataList1_ItemCommand(object source, DataListCommandEventArgs e)
{
    LinkButton lbtn;

    foreach (DataListItem dli in DataList1.Items)
    {
        lbtn = (LinkButton)dli.FindControl("lbtnRegion");
        if (lbtn != null)
            lbtn.ForeColor = System.Drawing.Color.White;
    }
    string command = e.CommandName;
    lbtn = (LinkButton)e.Item.FindControl("lbtnRegion");
    if (lbtn != null)
        lbtn.ForeColor = System.Drawing.Color.YellowGreen;

    DataView dv = GetData(ref command); // Pass the RegionId
    gvTerritory.DataSource = dv;
    gvTerritory.DataBind();
} 
```

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T00:07:24.450

一种方法是将“全部”值 UNION ALL 到获取下拉项目列表的查询中。

```
SELECT 'All', 'All Regions' 
UNION ALL 
SELECT [RegionID], [RegionDescription] FROM [Region] 
```

但是，如果您有很多这样的列表（或下拉列表），最好创建一个自定义控件来为您注入“全部”记录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T00:16:29.657

它使用以下 SQL：

```
SELECT '-1' AS 'RegionID', 'All Regions' AS 'RegionDescription' 
UNION ALL SELECT [RegionID], [RegionDescription] FROM [Region] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-25T15:20:36.150

在下拉列表中使用它，可能在数据列表上工作相同

```
 Protected Sub ddlDataSources_DataBound(ByVal sender As Object, ByVal e As System.EventArgs) Handles ddlDataSources.DataBound
    ddlDataSources.Items.Insert(0, New ListItem("All Data Sources", 0))
  End Sub 
```

# .net - ASP.NET 3.5 中的处理程序 (ASHX) 发生了什么

> ID：505381
> 
> 赞同：2
> 
> 时间：2009-02-02T23:10:12.333
> 
> 标签：.net, asp.net, handler, ashx

为什么 ASP.NET 3.5 Web 应用程序中的默认“通用处理程序”代码会向类添加属性，而不是正确的命名空间引用。这是他们为您提供的开箱即用模板：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace Handler1
{
    /// <summary>
    /// Summary description for $codebehindclassname$
    /// </summary>
    [WebService(Namespace = "http://tempuri.org/")]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    public class People : IHttpHandler
    {

        public void ProcessRequest(HttpContext context)
        {
            context.Response.ContentType = "text/plain";
            context.Response.Write("Hello World");
        }

        public bool IsReusable
        {
            get
            {
                return false;
            }
        }
    }
} 
```

为什么他们在顶部没有一行：

```
using System.Web.Services; 
```

这是微软默认模板中的错误吗？我错过了什么吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T23:25:11.977

**编辑：我现在看到了，当您将通用处理程序添加到 Web*应用程序*时（抱歉，我第一次在您的问题中错过了）我得到了新的无效模板。我同意其他用户的观点，即您应该只编辑默认模板。但是，如果您使用的是 MVC，则不再需要处理程序。**

看起来这是一个已知的错误，[这是它的 MS Connect 问题](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=363096)。

如果你想编辑模板，它位于：C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\ItemTemplates\CSharp\Web\1033\Handler.zip

# hibernate - 使用 Hibernate 映射双向列表

> ID：505387
> 
> 赞同：7
> 
> 时间：2009-02-02T23:13:40.890
> 
> 标签：hibernate, list, jpa, mapping, bidirectional

映射双向列表时，我不了解 Hibernate 的行为。Hibernate 生成的 SQL 语句对我来说似乎不是最优的。有人可以启发我吗？

场景如下：我有一个一对多的父子关系。我将这种关系映射到一个双向列表。

根据[Hibernate Annotation Reference Guide](http://docs.jboss.org/hibernate/annotations/3.5/reference/en/html_single/)（章节：与索引集合的双向关联），映射应如下所示：

```
@Entity
public class Parent {

    @Id  @GeneratedValue private long id;
    @Version  private int version;
    private String name;

    @OneToMany(cascade = CascadeType.ALL)
    @JoinColumn(name = "parent_id", nullable=false)
    @org.hibernate.annotations.IndexColumn(name = "parent_index")
    List<Child> children = new ArrayList<Child>();

...

@Entity
public class Child {

    @Id @GeneratedValue private Long id;
    @Version private int version;
    private String name;

    @ManyToOne
    @JoinColumn(name = "parent_id", updatable = false, insertable = false, nullable=false)
    private Parent parent;

... 
```

但是在这种情况下，Hibernate 在持久化一个父级和一个子级时会产生三个 SQL 语句：

```
Hibernate: insert into Parent (name, version, id) values (?, ?, ?)
Hibernate: insert into Child (name, price, version, parent_id, parent_index, id) values (?, ?, ?, ?, ?, ?)
Hibernate: update Child set parent_id=?, parent_index=? where id=? 
```

第三个语句似乎是多余的，因为`parent_id`and`parent_index`似乎已经在第二个语句中设置。

当我更改映射并将属性“*可更新=假，可插入=假”重复到父级中**@JoinColumn*的声明时，如下所示：

```
@Entity
public class Parent {

    @Id  @GeneratedValue private long id;
    @Version  private int version;
    private String name;

    @OneToMany(cascade = CascadeType.ALL)
    @JoinColumn(name = "parent_id", updatable = false, insertable = false, nullable=false)
    @org.hibernate.annotations.IndexColumn(name = "parent_index")
    List<Child> children = new ArrayList<Child>();

...

@Entity
public class Child {

    @Id @GeneratedValue private Long id;
    @Version private int version;
    private String name;

    @ManyToOne
    @JoinColumn(name = "parent_id", updatable = false, insertable = false, nullable=false)
    private Parent parent;

... 
```

...然后 Hibernate 似乎产生了更优化的 SQL：

```
Hibernate: insert into Parent (name, version, id) values (?, ?, ?)
Hibernate: insert into Child (name, price, version, parent_id, parent_index, id) values (?, ?, ?, ?, ?, ?) 
```

客户端代码如下所示：

```
 EntityManagerFactory emf = Persistence.createEntityManagerFactory("test");
    EntityManager em = emf.createEntityManager();
    EntityTransaction tx = em.getTransaction();
    tx.begin();

    Parent newParent = new Parent();
    newParent.setName("Parent1");

    Child newChild = new Child();
    newChild.setName("Child1");

    newParent.getChildren().add(newChild);
    newChild.setParent(newParent);

    em.persist(newParent);

    em.flush();
    tx.commit(); 
```

我正在使用休眠实体管理器 3.4.0.GA。

我错过了什么？Hibernate Reference Guide 不正确，还是我忽略了什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-07T11:42:06.057

好的，我没有足够彻底地阅读注释参考指南。

在第[2.2.5.3.1.1 章中。双向](http://docs.jboss.org/hibernate/annotations/3.5/reference/en/html_single/#entity-mapping-association)明确说明：

要将双向一对多映射，将一对多作为拥有方，您必须删除 mappedBy 元素并将多对一 @JoinColumn 设置为可插入且可更新为 false。**这个解决方案显然没有优化，并且会产生一些额外的 UPDATE 语句**。

[在第 2.4.6.2.1 章](http://docs.jboss.org/hibernate/annotations/3.5/reference/en/html_single/#entity-hibspec-collection)中重复这些信息可能不会有什么坏处。[与索引集合的双向关联](http://docs.jboss.org/hibernate/annotations/3.5/reference/en/html_single/#entity-hibspec-collection)。

现在问题仍然存在：如果我在父级上重复@JoinColumn 属性“updatable = false”和“insertable = false”（请参阅​​第一篇文章中的代码），似乎不会产生额外的更新语句......这是一个合法的解决方法? 或者这会导致另一个问题吗？

# eclipse - 如何即时更新 Eclipse 模板变量？

> ID：505389
> 
> 赞同：2
> 
> 时间：2009-02-02T23:13:49.127
> 
> 标签：eclipse, templates, plugins, eclipse-plugin, eclipse-pde

我通过扩展点添加了以下新的 Eclipse 模板。*它只是为示例testTag*标记添加了一个模板。

```
<!-- Add code template -->
<extension point="org.eclipse.ui.editors.templates">
   <template autoinsert="true"
             contextTypeId="html_tag"
             description="[Description] Template populated by Snippet values ***"
             id="org.eclipse.jst.jsf.ui.newHtmltag"
             name="testTag">
       <pattern>
            <![CDATA[
                <testTag style="background: ${color}"></testTag> 
            ]]>
       </pattern>
   </template>
  <resolver
     contextTypeId="html_tag"
     type="src" 
     class="TestTagTemplateVariableResolver">
  </resolver>
</extension> 
```

我想不通的是如何在运行时更改 $(color) 变量的值。更具体地说，当用户按下`Ctrl`+ `Space`（或内容辅助的等效项）并输入“testTag”并按下 Enter 时——而不是“颜色”占位符文本，我希望它被我拥有的其他文本值替换在另一个班级。我该怎么做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T23:56:48.637

[这个 2004 年的电子邮件链](http://dev.eclipse.org/newslists/news.eclipse.tools.jdt/msg10617.html)说这可能是不可能的：

> Java 编辑器选择不尊重为其两种上下文类型（“java”和“javadoc”）贡献的解析器，而只识别内置解析器。

您正在使用的 html 编辑器可能有类似的限制。

# c - 编写一个程序，对整数序列以及序列中的最小值求和

> ID：505391
> 
> 赞同：7
> 
> 时间：2009-02-02T23:14:21.933
> 
> 标签：c

> 编写一个程序，将整数序列和序列中的最小数相加。假设用 scanf 读取的第一个整数指定了要输入的剩余值的数量。例如输入的序列：
> 
> 输入：5 100 350 400 550 678
> 
> 输出：整数序列之和为：2078
> 
> 输入：5 40 67 9 13 98
> 
> 输出：输入的最小整数是：9

这是我正在处理的日常问题，但通过查看这个，5 不是最小的整数吗？我不知道如何编写这个程序。感谢任何帮助

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-03T00:24:19.517

首先，5 不被视为列表的一部分，它是列表的计数。因此，它不应包含在计算中。

由于这是作业，这里是伪代码。你的工作是首先理解伪代码（使用示例输入通过你的头脑运行它）然后将其转换为 C 代码并尝试使其编译和运行成功（使用相同的示例输入）。

我建议输入“2 7 3”（两个项目，分别是 7 和 3）作为一个很好的起点，因为它很小，总和为 10，最小的 3。

如果您尝试这样做超过一天，请将您的代码作为编辑发布到此问题中，我们会看看我们能做些什么来帮助您。

```
get a number into quantity
set sum to zero
loop varying index from 1 to quantity
    get a number into value
    add value to sum
    if index is 1
        set smallest to value
    else
        if value is less than smallest
            set smallest to value
        endif
    endif
endloop
output "The sum of the sequence of integers is: ", sum
output "The smallest of the integers entered is: ", smallest 
```

Stack Overflow 似乎分为三个阵营，那些只会给你代码的阵营，那些会告诉你推迟并完成自己的作业的阵营，以及像我一样希望看到你受过教育的那些阵营 - 到你成功的时候劳动力，我希望退休，这样你就不会和*我*竞争了:-)。

在任何人在我的算法中挑选漏洞之前，这是为了*教育*。我至少在其中留下了一个陷阱来帮助训练这个人——可能还有其他人，我*会*声称我故意把它们放在那里是为了测试他:-)。

* * *

*更新：*

罗伯特，在我已经评论过你的（非常好的）尝试之后，这就是我修改你的代码来完成任务的方式（当然是你的，而不是我的）。您可以希望看到我的评论如何修改代码以达到此解决方案：

```
#include <stdio.h>
int main (int argCount, char *argVal[]) {
    int i;              // General purpose counter.
    int smallNum;       // Holds the smallest number.
    int numSum;         // Holds the sum of all numbers.
    int currentNum;     // Holds the current number.
    int numCount;       // Holds the count of numbers.

    // Get count of numbers and make sure it's in range 1 through 50.

    printf ("How many numbers will be entered (max 50)? ");
    scanf ("%d", &numCount);
    if ((numCount < 1) || (numCount > 50)) {
        printf ("Invalid count of %d.\n", numCount);
        return 1;
    }
    printf("\nEnter %d numbers then press enter after each entry:\n",
        numCount);

    // Set initial sum to zero, numbers will be added to this.

    numSum = 0;

    // Loop, getting and processing all numbers.

    for (i = 0; i < numCount; i++) {

        // Get the number.

        printf("%2d> ", i+1);
        scanf("%d", &currentNum);

        // Add the number to sum.

        numSum += currentNum;

        // First number entered is always lowest.

        if (i == 0) {
            smallNum = currentNum;
        } else {
            // Replace if current is smaller.

            if (currentNum < smallNum) {
                smallNum = currentNum;
            }
        }
    }

    // Output results.

    printf ("The sum of the numbers is: %d\n", numSum);
    printf ("The smallest number is:    %d\n", smallNum);

    return 0;
} 
```

这是您的示例数据的输出：

```
pax> ./qq
How many numbers will be entered (max 50)? 5

Enter 5 numbers then press enter after each entry:
 1> 100
 2> 350
 3> 400
 4> 550
 5> 678
The sum of the numbers is: 2078
The smallest number is:    100

pax> ./qq
How many numbers will be entered (max 50)? 5

Enter 5 numbers then press enter after each entry:
 1> 40
 2> 67
 3> 9
 4> 13
 5> 98
The sum of the numbers is: 227
The smallest number is:    9

pax> ./qq
How many numbers will be entered (max 50)? 0
Invalid count of 0.

[fury]$ ./qq
How many numbers will be entered (max 50)? 51
Invalid count of 51. 
```

顺便说一句，请确保您始终在代码中添加注释。教育工作者喜欢这种东西。必须在 10 年后尝试理解您的代码的开发人员也是如此。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-02T23:18:30.740

读：

> 假设用 scanf 读取的第一个整数指定了要输入的剩余值的数量

所以它不是序列的一部分......

其余的，这是你的功课（和 C ......）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T23:16:12.900

第 5 位是您必须读入列表的整数个数。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-02T23:18:06.233

Jeebus，我不是为你做作业，但是...

你有没有停下来在纸上划掉它并弄清楚它应该如何工作？编写一些伪代码，然后转录为真实代码。我本来想：

*   读取整数
*   循环多次**阅读更多整数**添加**查找最小的

如果您在 C 中，请查看 INT_MAX - 这将有助于找到最小的整数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T23:19:16.700

由于整数列表是可变的，我很想使用 strtok 将字符串拆分为单独的字符串（用空格分隔），然后 atoi 转换每个数字并即时求和或找到最小值。

-亚当

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-02T23:49:11.273

首先读取值的数量（即 5），然后创建一个由 5 个元素组成的 int 数组，读取其余的输入，拆分它们并将它们放入数组中（在将它们转换为整数之后）。

然后在数组上做一个循环，得到的总和找到最小值。

希望有帮助

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T00:09:43.447

> 不是[']找你们做这项工作

凉爽的。当您向他们倾倒问题文本并且问题文本以命令式形式表达时，人们往往会生气（“做这个！写那个！等等”）。

您可能想说“我遇到了一个家庭作业问题。问题是：写一个 [...]。我不明白为什么 [...]”。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-03T03:42:08.353

```
#include <stdio.h>

main ()
{
    int num1, num2, num3, num4, num5, num6, i;
    int smallestnumber=0;
    int sum=0;
    int numbers[50];
    int count;
    num1 = 0;
    num2 = 0;
    num3 = 0;
    num4 = 0;
    num5 = 0;
    num6 = 0;

    printf("How many numbers will be entered (max 50)? ");
    scanf("%d", &count);

    printf("\nEnter %d numbers then press enter after each entry:  \n", count);

    for (i=0; i < count; i++) {
        printf("%2d> ", i+1);
        scanf("%d", &numbers[i]);
        sum +=  numbers[i];
    }

    smallestnumber = numbers[0];
    for (i=0; i < count; i++) {
        if ( numbers[i] < smallestnumber)
        {
            smallestnumber = numbers[i];
        }
    }

    printf("the sum of the numbers is: %d\n", sum);
    printf("The smallest number is: %d", smallestnumber);
} 
```

# wpf - 内置 WPF IValueConverters

> ID：505397
> 
> 赞同：91
> 
> 时间：2009-02-02T23:17:28.607
> 
> 标签：wpf, converters

*好的，发现System.Windows.Controls*命名空间中已经有一个**BooleanToVisibilityConverter**真是一个惊喜（在多次编写之后）。

 *可能还有更多这样隐藏的节省时间的方法。

有人有吗？

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2009-02-03T02:09:47.853

I did a quick trawl using the Object Browser and this is what I have.

Derived from `IValueConverter`:

> [`System.Windows.Controls.AlternationConverter`](https://msdn.microsoft.com/en-us/library/system.windows.controls.alternationconverter.aspx)
> [`System.Windows.Controls.BooleanToVisibilityConverter`](https://msdn.microsoft.com/en-us/library/system.windows.controls.booleantovisibilityconverter.aspx)
> [`System.Windows.Documents.ZoomPercentageConverter`](https://msdn.microsoft.com/en-us/library/system.windows.documents.zoompercentageconverter.aspx)
> [`System.Windows.Navigation.JournalEntryListConverter`](https://msdn.microsoft.com/en-us/library/system.windows.navigation.journalentrylistconverter.aspx)
> 
> `Xceed.Wpf.DataGrid.Converters.CurrencyConverter`
> `Xceed.Wpf.DataGrid.Converters.DateTimeToStringConverter`
> `Xceed.Wpf.DataGrid.Converters.GreaterThanZeroConverter`
> `Xceed.Wpf.DataGrid.Converters.IndexToOddConverter`
> `Xceed.Wpf.DataGrid.Converters.IntAdditionConverter`
> `Xceed.Wpf.DataGrid.Converters.InverseBooleanConverter`
> `Xceed.Wpf.DataGrid.Converters.LevelToOpacityConverter`
> `Xceed.Wpf.DataGrid.Converters.MultimodalResultConverter`
> `Xceed.Wpf.DataGrid.Converters.NegativeDoubleConverter`
> `Xceed.Wpf.DataGrid.Converters.NullToBooleanConverter`
> `Xceed.Wpf.DataGrid.Converters.SourceDataConverter`
> `Xceed.Wpf.DataGrid.Converters.StringFormatConverter`
> `Xceed.Wpf.DataGrid.Converters.ThicknessConverter`
> `Xceed.Wpf.DataGrid.Converters.TypeToBooleanConverter`
> `Xceed.Wpf.DataGrid.Converters.TypeToVisibilityConverter`
> `Xceed.Wpf.DataGrid.Converters.ValueToMaskedTextConverter`

Derived from `IMultiValueConverter`:

> [`System.Windows.Controls.BorderGapMaskConverter`](https://msdn.microsoft.com/en-us/library/system.windows.controls.bordergapmaskconverter.aspx)
> [`System.Windows.Navigation.JournalEntryUnifiedViewConverter`](https://msdn.microsoft.com/en-us/library/system.windows.navigation.journalentryunifiedviewconverter.aspx)
> [`System.Windows.Controls.MenuScrollingVisibilityConverter`](https://msdn.microsoft.com/en-us/library/system.windows.controls.menuscrollingvisibilityconverter.aspx)
> 
> [`Microsoft.Windows.Themes.ProgressBarBrushConverter`](https://msdn.microsoft.com/en-us/library/microsoft.windows.themes.progressbarbrushconverter.aspx)
> [`Microsoft.Windows.Themes.ProgressBarHighlightConverter`](https://msdn.microsoft.com/en-us/library/microsoft.windows.themes.progressbarhighlightconverter.aspx)

Note the Xceed ones (no connection) are available free with their DataGrid. As well as those there's some clever stuff around like the [debugging converter](http://marlongrech.wordpress.com/2007/12/18/debugging-wpf-databinding/). I've also used [the last IValueConverter](http://www.codeproject.com/KB/WPF/ScriptValueConverter.aspx) and I'm sure there's some further lambda function goodness to be found, too.

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-02-02T23:42:34.187

在 3.5 SP1 之前，字符串格式化需要 IValueConverter。现在，您可以使用 Binding 上的[StringFormat](https://docs.microsoft.com/en-us/dotnet/api/system.windows.data.bindingbase.stringformat#System_Windows_Data_BindingBase_StringFormat)属性来执行此操作。

从 MSDN 页面：

```
<DataTemplate>
  <TextBlock>
    <TextBlock.Text>
      <MultiBinding  StringFormat="{}{0} -- Now only {1:C}!">
        <Binding Path="Description"/>
        <Binding Path="Price"/>
      </MultiBinding>
    </TextBlock.Text>
  </TextBlock>
</DataTemplate> 
```

# mysql - 什么时候在 mysql 中使用 OPTIMIZE

> ID：505406
> 
> 赞同：7
> 
> 时间：2009-02-02T23:21:53.730
> 
> 标签：mysql, optimization

我有一个充满时间敏感数据的数据库，所以我每天都会截断表，然后将新数据（来自其他数据库的合并）导入到截断的表中。

目前，在导入每日刷新数据后，我正在表上运行 OPTIMIZE。但是，查看 mysql OPTIMIZE 语法页面 [http://dev.mysql.com/doc/refman/5.1/en/optimize-table.html](http://dev.mysql.com/doc/refman/5.1/en/optimize-table.html)

它说我可以优化以回收未使用的空间并对数据进行碎片整理。

那么我应该运行两次 OPTIMIZE 吗？删除数据时一次，重新插入后又一次？还是只有一次？如果只有一次，应该是在加载新数据之后吗？还是在清除旧的之后？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T23:38:04.523

这可能取决于您使用的是 MyISAM 还是 InnoDB 表，但我会在截断表后运行 OPTIMIZE。这应该确保空间被回收并且运行速度非常快。

当您插入一批数据时，它应该全部按顺序插入，并且无论如何都不会碎片化，并且由于它是新插入的，因此没有空间可以回收。如果它是一个小数据集，它可能没有太大关系，但是在一个大数据集上，在插入之后执行 OPTIMIZE 也可能很慢。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T23:23:59.107

导入新数据后，只需一次即可。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-08-05T09:02:03.100

在将一组数据删除或更新到数据库后，您可以使用优化表命令来删除碎片空间。

不需要两次使用优化命令。在所有 DML 过程之后，您可以使用优化命令。

# asp.net - 如何组合 WebResource.axd 和 ScriptResource.axd 文件以减少对 ASP.NET 服务器的请求？

> ID：505416
> 
> 赞同：11
> 
> 时间：2009-02-02T23:24:43.740
> 
> 标签：asp.net, javascript, ajaxcontroltoolkit

在我正在处理的网站上，页面生成 45 个外部 WebResource.axd 和 ScriptResource.axd 文件，因此浏览器必须请求所有 45 个引用。这是很多参考资料，所以我想知道是否有一种方法可以将所有这些请求合并为一个请求？我已经看到脚本管理器应该能够对此做一些事情，但我没有看到 WebResource.axd 和 ScriptResource.axd 文件的任何结果。

我将如何将这些全部结合起来？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-11T08:44:45.550

正如其他人所说，使用 ASP.NET AJAX 工具包的 ToolkitScriptManager 而不是默认的 ASP.NET ScriptManager 将允许您进行一些脚本组合，包括作为资源嵌入的您自己的脚本 - 在[Script combination made easy](http://blogs.msdn.com/delay/archive/2007/06/11/script-combining-made-easy-overview-of-the-ajax-control-toolkit-s-toolkitscriptmanager.aspx)上有一篇很好的帖子.

如果您有幸使用 ASP.NET 3.5 SP1，那么 ASP.NET ScriptManager 还提供了一些进一步的附加功能，允许您将更多脚本（包括解决方案中的通用 .js 文件）合并到一个脚本调用中。

看看这个视频：

> [使用脚本组合来提高性能](http://www.asp.net/learn/3.5-SP1/video-296.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-08T23:56:37.383

尝试使用 ajax - ToolkitScriptManager 而不是 asp - ScriptManager - 它倾向于尽可能多地组合资源请求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-30T19:32:36.790

这是框架 2.0 和 3.5 两个版本的[CodeProject 文章](http://www.codeproject.com/KB/aspnet/AspNetOptimizer.aspx)

# macos - mac中eclipse的java编辑器中“内容辅助”的热键是什么？

> ID：505418
> 
> 赞同：7
> 
> 时间：2009-02-02T23:25:42.567
> 
> 标签：macos

mac中eclipse的java编辑器中“内容辅助”的热键是什么？

它说'^'

但是你能告诉我什么是'^'吗？

谢谢你。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-02T23:28:25.837

对我来说，它经常在预定义的设置中被破坏，我通常在 Preferences -> Keys 中将其更改为 Command-Space（并在 Mac OS 首选项中将 Spotlight 更改为 Alt-Space）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-02T23:30:03.807

`^`是控制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-27T23:08:03.343

默认情况下，它是 control-spacebar，在 Key Assist 面板上有点难以阅读。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-07-15T08:44:41.313

`^`是`Shift`。按`Shift+Space`以获得内容帮助。请注意，如果内容辅助菜单中只有一个选项可供选择，则您必须按`Enter\Return`，就像`^Space`一样`Space`。

# asp.net-mvc - ASP.net MVC - 基于 byte[] 显示系列图像

> ID：505427
> 
> 赞同：3
> 
> 时间：2009-02-02T23:29:13.183
> 
> 标签：asp.net-mvc

我想使用 ASP.net MVC 在网页上显示图像列表和描述。图像存储在 SQL Server 数据库中，我将它们作为字节 [] 取回。

但是，我不明白如何在页面上显示一系列图像。我想做这样的事情：

```
<% foreach(Product p in Model.Products)
      Response.Write(p.Description)
      Response.Write(html.Image(p.ImageArray)
%> 
```

但我看到的唯一代码是显示一个图像......

谢谢

本

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T23:34:04.673

您将需要创建一个自定义 IHttpHandler 来为图像提供如下服务：

```
 public class AlbumArt : IHttpHandler
        {
            public void ProcessRequest(HttpContext Context)
            {
byte [] b = your image...;
    Context.Response.ContentType = "image/jpeg";
                        Context.Response.BinaryWrite(b);
    }
    } 
```

然后您需要使用 html 中的图像标签从那里检索每个图像，例如

```
<img src="AlbumArt.ashx?imageId=1" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T23:40:58.683

HTML 中的图像是外部链接，而不是嵌入在 HTML 本身中。所以你确实需要两个请求。但是，您可以对此进行一些优化。在第一个请求中，不要检索图像数据本身，只检索元数据。然后在您的 HttpHandler 中，实际检索二进制图像数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T05:33:11.607

您可以编写一个返回图像文件内容的控制器操作，而不是创建一个新的 HttpHandler。然后将图像添加到页面，并将其 src 属性设置为您创建的操作。

编辑：请注意，与提供静态文件相比，来自数据库的流式图像作为 byte[] 效率低下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T23:31:31.057

每个图像都必须单独发送（这意味着从浏览器为每个图像创建一个 IMG 请求），或者您必须在发送回之前将它们加入单个图像。如果您运行上面的代码，您可能只会看到第一张图片。

# jquery - 跨多个元素的 jQuery 动画队列

> ID：505434
> 
> 赞同：5
> 
> 时间：2009-02-02T23:34:00.787
> 
> 标签：jquery, animation, queue

这个问题类似于[关于动画队列](https://stackoverflow.com/questions/461912/jquery-finish-one-animation-then-start-the-other-one)的问题，但该线程中的答案非常具体，不容易概括。

在我的 Web 应用程序中，通过输出 a 向用户报告消息（信息框、错误和警告等）`div`，`class="alert"`例如：

```
<div class="alert">Login successful</div>
<div class="alert">You have new messages waiting</div> 
```

页面上可能有任意数量的警报，具体取决于用户的操作。

我想要的是使用 jQuery 动画顺序显示每个警报框：一旦一个动画结束，下一个动画就会开始。

另一个问题的答案说使用回调，例如：

```
$('#Div1').slideDown('fast', function(){
    $('#Div2').slideDown('fast');
}); 
```

除非要制作动画的 div 数量未知，否则这将不起作用。任何人都知道实现这一目标的方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T00:38:10.080

我想出了一个解决方案，尽管我偷偷地怀疑，对 JS 闭包有更多了解的人可能会给我一些建议。

```
nextAnim($('.alert'));

function nextAnim($alerts) {
    $alerts
        .eq(0)    // get the first element
        .show("slow",
            function() {
                nextAnim($alerts.slice(1));  // slice off the first element
            }
        )
    ;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T00:38:46.273

设置起来很容易：

```
// Hide all alert DIVs, then show them one at a time
$(function()
{
   var alerts = $(".alert").hide();
   var currentAlert = 0;
   function nextAlert()
   {
      alerts.eq(currentAlert).slideDown('fast', nextAlert);
      ++currentAlert;
   }
   nextAlert();
}); 
```

如果你会经常使用它，你可能会用它制作一个简单的插件方法。

# javascript - JSON 是否仅用于 JavaScript？

> ID：505439
> 
> 赞同：6
> 
> 时间：2009-02-02T23:35:12.453
> 
> 标签：javascript, asp.net, database, json

我在代表一组属性的数据库中存储了一个 JSON 字符串。在后面的代码中，我将其导出并用于一些自定义逻辑。本质上，我只是将它用作存储机制。我了解 XML 更适合于此，但我读到 JSON 更快且更受欢迎。

如果不打算在客户端使用字符串，那么使用 JSON 是一种好习惯吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-02T23:39:11.743

JSON 是存储结构化数据的一种完全有效的方式，并且比 XML 更简单、更简洁。我不认为使用它是一种“不好的做法”，因为只要您理解并且可以接受它的局限性，就有人会使用 XML。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-02T23:40:49.510

我不能说这是否是一种好的做法，但它让我觉得很奇怪。在 SQL 数据库中包含 XML 字段至少是可查询的（SQL Server 2000 或更高版本、MySQL 等），但通常是元数据的最后手段。

JSON 通常是 JavaScript 和后端之间的载体，而不是存储本身，除非你有一个面向 JSON 后端[文档的数据库](http://en.wikipedia.org/wiki/Document-oriented_database)，例如[CouchDB](http://couchdb.apache.org/)或[SOLR](http://lucene.apache.org/solr/)，因为 JSON 非常适合存储文档。

并不是说我不同意将 JSON 用作基于 XML 的简单（即不序列化引用）数据序列化器，但我不会仅仅为了它而进行 JSON 与 XML 的争论:)。

如果您没有使用 JSON 在 2 种语言之间的可移植性，并且您肯定永远不会从 SQL 查询数据，那么使用 .NET 的默认序列化会更好。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T23:42:37.947

您不是唯一一个使用 JSON 进行数据存储的人。[**CouchDB**](http://couchdb.apache.org/)是一个面向文档的数据库，它使用 JSON 来存储信息。他们最初将该信息存储为 XML，然后切换到 JSON。查询是通过良好的旧 HTTP 完成的。

顺便说一句，CouchDB 最近受到了一些关注，并得到了**IBM**和**Apache Software Foundation**的支持。它是用 Erlang 编写的，并且承诺很多（恕我直言）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-02T23:40:09.323

是的，我认为 JSON 很棒。它是一个开放标准，可以被任何编程语言使用。大多数编程语言也有解析和编码 JSON 的库。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-02T23:42:20.333

JSON 只是一种类似于 XML 的标记语言，由于其规范更严格，因此体积更小，生成和解析速度更快。因此，从这方面来看，如果您需要临时结构化标记（并且您绝对确定使用表是不可能的和/或最佳解决方案），那么在数据库中使用它是完全可以接受的。

但是，您没有说您使用的是什么数据库。如果是 SQL Server 2005 或更高版本，那么数据库本身在处理 XML 时具有广泛的功能，包括 XML 数据类型、XQuery 支持以及将 XQuery 表达式作为执行计划的一部分进行优化的能力。因此，如果是这种情况，我会更倾向于使用 XML 并利用数据库的功能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-02T23:43:41.253

请记住，JSON 具有与 XML 作为后端数据存储相同的所有问题；也就是说，它绝不会取代关系数据库甚至是固定大小的二进制格式。如果您有数百万行并且需要随机访问，那么使用 JSON 会遇到与使用 XML 相同的基本性能问题。我怀疑你是否打算将它用于这种数据存储场景，但你永远不知道......已经尝试过奇怪的事情:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T23:41:21.973

JSON 更短，因此它将在您的数据库中使用更少的空间。我可能会使用它而不是 XML 或编写我自己的格式。

另一方面，搜索匹配会很糟糕——你将不得不使用“where json like '% somevalue %'”，这将非常缓慢。这与任何其他文本存储策略（包括 xml）的限制相同。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-03T18:39:33.317

您不应该使用 JSON 或 XML 在关系数据库中存储数据。JSON 和 XML 是序列化格式，可用于将数据存储在文件中或通过网络发送。

如果要存储一组属性，只需为其创建一个表，每一行都对应一个属性。这样您就可以使用普通 SQL 查询数据。

# c# - Visual Studio 调试器不会在文件名中包含 `（反引号）的文件中加载符号。谁能解释一下？

> ID：505447
> 
> 赞同：4
> 
> 时间：2009-02-02T23:37:59.000
> 
> 标签：c#, visual-studio, debugging

我在 Visual Studio 2005 中调试一些代码时，我注意到 IDE 没有在特定的泛型类中遇到断点。我可以手动进入课堂，但是当悬停在引用上时显示的工具提示只包含内存地址，而不是正常的友好工具提示。

事实证明，问题是由文件名（！）引起的。具体来说，当文件名包含 `（反引号，反引号）时，调试器将不会加载该文件的符号。解决方法是重命名文件。

我首先使用反引号来表示泛型类型的基数：

*   Foo.cs 包含一个非泛型类型（例如 Foo）
*   Foo`1.cs 包含具有单个类型参数的泛型类型（例如 Foo<T>）
*   Foo`2.cs 包含一个具有两个类型参数的泛型（例如 Foo<T,U>）

这个错误（是吗？）也出现在 Visual Studio 2008 中。

谁能解释这种行为？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T00:29:39.070

我的印象是，在幕后泛型类型被编译成名称中有反引号的类型。假设您有`List<int>`and `List<string>`，在幕后您将有两个课程。一个是`System.Collections.Generic.List'1`，另一个是`System.Collections.Generic.List'2`。这些类可以生成并存储在同名文件中（扩展名为 .cs）。

我猜如果你在文件名中加上反引号，你就会弄乱这个机制。

我在这里推测了一下，因为我还没有研究过，但它可能是你研究的东西？:)

祝你好运

**编辑**- 必须使用撇号而不是反引号，因为它们是此编辑器中的保留符号:)

# c# - 大型 Switch 语句：糟糕的 OOP？

> ID：505454
> 
> 赞同：80
> 
> 时间：2009-02-02T23:39:41.290
> 
> 标签：c#, oop, design-patterns

我一直认为大型 switch 语句是糟糕的 OOP 设计的症状。过去，我读过讨论这个主题的文章，他们提供了基于 OOP 的替代方法，通常基于多态性来实例化正确的对象来处理这种情况。

我现在处于一种基于来自 TCP 套接字的数据流的怪物 switch 语句的情况，其中协议基本上由换行符终止的命令组成，然后是数据行，然后是结束标记。该命令可以是 100 个不同的命令之一，所以我想找到一种方法来减少这个怪物 switch 语句到更易于管理的东西。

我做了一些谷歌搜索以找到我记得的解决方案，但遗憾的是，谷歌如今已成为许多类型查询的不相关结果的荒地。

这类问题有什么模式吗？关于可能的实现有什么建议吗？

我的一个想法是使用字典查找，将命令文本与要实例化的对象类型匹配。这具有仅创建一个新对象并在表中为任何新命令插入一个新命令/类型的好处。

但是，这也存在类型爆炸的问题。我现在需要 100 个新类，而且我必须找到一种方法将它们干净地连接到数据模型。“一个真正的 switch 语句”真的是要走的路吗？

我会很感激你的想法、意见或评论。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-02T23:59:14.513

[您可能会从命令模式](http://c2.com/cgi/wiki?CommandPattern)中获得一些好处。

对于 OOP，如果行为变化足够小，您可以将几个类似的命令分别合并到一个类中，以避免完整的类爆炸（是的，我已经听到 OOP 专家为此尖叫）。但是，如果系统已经是面向对象的，并且 100 多个命令中的每一个都是真正唯一的，那么只需将它们设为唯一的类并利用继承来整合共同的东西。

如果系统不是 OOP，那么我不会为此添加 OOP……您可以轻松地使用命令模式与简单的字典查找和函数指针，甚至根据命令名称动态生成函数调用，具体取决于语言。然后，您可以将逻辑关联的函数分组到表示类似命令集合的库中，以实现可管理的分离。我不知道这种实现是否有一个好的术语......我一直认为它是一种“调度程序”风格，基于处理 URL 的 MVC 方法。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-02-03T00:10:53.617

我认为有**两个**switch 语句是非 OO 设计的症状，其中 switch-on-enum-type 可能被多种类型替换，这些类型提供抽象接口的不同实现；例如，以下...

```
switch (eFoo)
{
case Foo.This:
  eatThis();
  break;
case Foo.That:
  eatThat();
  break;
}

switch (eFoo)
{
case Foo.This:
  drinkThis();
  break;
case Foo.That:
  drinkThat();
  break;
} 
```

... 或许应该改写为 ...

```
IAbstract
{
  void eat();
  void drink();
}

class This : IAbstract
{
  void eat() { ... }
  void drink() { ... }
}

class That : IAbstract
{
  void eat() { ... }
  void drink() { ... }
} 
```

然而，**一个**switch 语句**并不是**一个强有力的指标，以至于 switch 语句应该被其他东西替换。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-02-03T00:32:55.240

> 该命令可以是 100 个不同的命令之一

如果你需要做 100 件不同的事情中的一件，你就无法避免拥有一个 100 路分支。您可以在控制流（开关、if-elseif^100）或数据（从字符串到命令/工厂/策略的 100 元素映射）中对其进行编码。但它会在那里。

您可以尝试将 100 路分支的结果与不需要知道该结果的事物隔离开来。也许只有 100 种不同的方法就可以了；如果这会使代码变得笨拙，则无需发明不需要的对象。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-03T00:07:34.450

我认为这是少数情况下大型交换机是最佳答案的情况之一，除非出现其他解决方案。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-02T23:44:36.103

我看到了策略模式。如果我有 100 种不同的策略……就这样吧。巨大的 switch 语句很难看。所有命令都是有效的类名吗？如果是这样，只需使用命令名称作为类名并使用 Activator.CreateInstance 创建策略对象。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-06T21:29:16.463

在谈论大型 switch 语句时，会想到两件事：

1.  它违反了 OCP——你可能会不断地维护一个大功能。
2.  你的表现可能很差：O(n)。

另一方面，地图实现可以符合 OCP，并且可以执行潜在的 O(1)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T08:19:38.073

我想说问题不在于大的 switch 语句，而在于其中包含的代码的扩散，以及错误范围变量的滥用。

我自己在一个项目中经历过这种情况，当越来越多的代码进入交换机时，直到它变得无法维护。我的解决方案是定义包含命令上下文的参数类（名称、参数等，在切换之前收集），为每个案例语句创建一个方法，并使用案例中的参数对象调用该方法。

当然，一个完全 OOP 的命令调度程序（基于诸如反射之类的魔法或 Java 激活之类的机制）更漂亮，但有时您只是想修复问题并完成工作；）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T16:06:16.393

您可以使用字典（如果您使用 Java 编码，则可以使用哈希映射）（Steve McConnell 将其称为表驱动开发）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-02T23:43:19.927

我看到你可以改进的一种方法是让你的代码由数据驱动，例如，对于每个代码，你匹配处理它的东西（函数、对象）。您还可以使用反射来映射表示对象/函数的字符串并在运行时解析它们，但您可能需要进行一些实验来评估性能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-03T00:11:30.790

处理这个特定问题的最佳方法：干净的序列化和协议是使用 IDL 并使用 switch 语句生成编组代码。因为无论您尝试使用什么模式（原型工厂、命令模式等），您都需要初始化命令 id/string 和类/函数指针之间的映射，不知何故，它的运行速度比 switch 语句慢，因为编译器可以对 switch 语句使用完美的哈希查找。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-03T02:42:52.543

是的，我认为大型案例陈述是可以改进代码的征兆……通常是通过实现更面向对象的方法。例如，如果我发现自己在 switch 语句中评估类的类型，那几乎总是意味着我可以使用泛型来消除 switch 语句。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-03T08:05:52.377

您还可以在此处采用语言方法，并在语法中定义具有关联数据的命令。然后，您可以使用生成器工具来解析语言。为此，我使用了[Irony 。](http://www.codeplex.com/irony)或者，您可以使用解释器模式。

在我看来，目标不是构建最纯粹的 OO 模型，而是创建一个灵活、可扩展、可维护和强大的系统。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-09-17T19:51:04.440

**我最近有一个巨大的 switch 语句的类似问题，我通过最简单**的解决方案摆脱了丑陋的 switch**查找表**和返回您期望的值的函数或方法。命令模式是很好的解决方案，但我认为拥有 100 个类并不好。所以我有类似的东西：

```
switch(id)
    case 1: DoSomething(url_1) break;
    case 2: DoSomething(url_2) break;
    ..
    ..
    case 100 DoSomething(url_100) break; 
```

我已经改变了：

```
string url =  GetUrl(id);  
DoSomthing(url); 
```

GetUrl 可以转到 DB 并返回您正在寻找的 url，或者可以是内存中保存 100 个 url 的字典。我希望这可以在替换巨大的巨大 switch 语句时帮助任何人。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-07-03T13:55:43.867

想想 Windows 最初是如何在应用程序消息泵中编写的。它糟透了。添加的菜单选项越多，应用程序的运行速度就越慢。随着搜索的命令越来越接近 switch 语句的底部，等待响应的时间越来越长。有长的 switch 语句是不可接受的。我制作了一个 AIX 守护程序作为 POS 命令处理程序，它可以处理 256 个唯一命令，甚至不知道通过 TCP/IP 接收的请求流中的内容。流的第一个字符是函数数组的索引。任何未使用的索引都设置为默认消息处理程序；登录并说再见。

# debugging - 分段错误的行数

> ID：505465
> 
> 赞同：54
> 
> 时间：2009-02-02T23:41:34.937
> 
> 标签：debugging, gcc, gdb, segmentation-fault

我可以设置任何 gcc 选项来提供分段错误的行号吗？

我知道我可以：

1.  逐行调试
2.  将 printfs 放入代码中以缩小范围。

编辑：

1.  `bt`/ `where`on gdb give No stack。
2.  [有用的建议](https://stackoverflow.com/a/77336/24874)

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-02-02T23:46:35.007

我不知道 gcc 选项，但是您应该能够使用 gdb 运行应用程序，然后当它崩溃时，键入`where`以查看退出时的堆栈，这应该可以让您关闭。

```
$ gdb blah
(gdb) run
(gdb) where 
```

编辑完整性：

您还应该确保使用`-g`gcc 选项在可执行文件中包含行号时使用调试标志构建应用程序。

另一种选择是使用`bt`(backtrace) 命令。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-02-03T00:06:15.340

这是一个完整的 shell/gdb 会话

```
$ gcc -ggdb myproj.c
$ gdb a.out
gdb> 运行 --some-option=foo --other-option=bar
（gdb 会说你的程序遇到了段错误）
gdb>bt
（gdb 打印堆栈跟踪）
gdb>q
[您确定，您的程序仍在运行]？是的
$ emacs myproj.c # 呵呵，我现在知道错误是什么了...

```

快乐的黑客:-)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-02-03T00:21:55.980

当您的程序收到 SEGV 信号时，您可以让 gcc 为您打印堆栈跟踪，类似于 Java 和其他更友好的语言处理空指针异常的方式。有关更多详细信息，请参见我的答案：

*   [当我的 C++ 应用程序崩溃时如何生成堆栈信息（使用 gcc 编译器）](https://stackoverflow.com/a/77336/24874)

这样做的好处是你可以把它留在你的代码中；您无需通过 gdb 运行即可获得良好的调试输出。

如果您使用 -g 编译并按照那里的说明进行操作，则可以使用[addr2line 之](http://www.linuxcommand.org/man_pages/addr2line1.html)类的命令行工具从输出中获取文件/行信息。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-10-04T17:37:03.717

在 valgrind 下运行它。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-02T23:49:14.797

您还需要在 -g 上使用调试标志进行构建

您也可以使用 gdb 打开核心转储（但您需要 -g）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-03T01:55:43.280

如果前面所有使用调试 (-g) 编译并在调试器 (gdb, run, bt) 下运行的建议都不适合您，那么：

*   初级：也许你没有在调试器下运行，你只是想分析事后的核心转储。（如果您启动调试会话，但不运行程序，或者如果程序退出，那么当您要求回溯时，gdb 会说“No stack”——因为根本没有正在运行的程序。不要忘记键入“run”。）如果出现段错误，请不要忘记在`core`运行 gdb 时添加第三个参数 ( )，否则会以相同的状态启动，不附加到任何特定进程或内存映像。
*   困难：如果你的程序正在运行，但你的 gdb 说“没有堆栈”，那么你的堆栈指针可能被严重破坏了。在这种情况下，您可能会在某个地方出现缓冲区溢出问题，严重到足以完全混合您的运行时状态。GCC 4.1 支持使用`-fstack-protector-all`. 它可以通过补丁添加到 GCC 3.x。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-02T23:50:33.640

GCC 无法提供此信息，您必须依赖外部程序，例如 GDB。

GDB 可以在程序出现段错误后使用“bt”（“backtrace”的缩写）命令为您提供发生崩溃的行。这不仅会为您提供崩溃的行，还会为您提供程序的整个堆栈（因此您可以看到发生崩溃的函数调用了什么）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-09-18T11:34:43.300

当`No stack`程序成功退出时，问题似乎发生了。

作为记录，我遇到了这个问题，因为我忘记了代码中的返回，这使我的程序退出并显示失败代码。

# git - 我可以将 .git 文件夹存储在我想要跟踪的文件之外吗？

> ID：505467
> 
> 赞同：158
> 
> 时间：2009-02-02T23:41:54.187
> 
> 标签：git

我有一个不寻常的想法，即使用 git 作为备份系统。所以假设我有一个目录 ./backup/myfiles 并且我想使用 git 备份它。为了保持干净，我不想在 myfiles 文件夹中有 .git 目录，所以我想我可以创建 ./backup/git_repos/myfiles。通过查看 git 文档，我尝试过这样做：

```
$ cd backup/myfiles
$ mkdir ../git_repos/myfiles
$ git --git-dir=../git_repos/myfiles init
Initialized empty Git repository in backup/git_repos/myfiles/
$ git --git-dir="../git_repos/myfiles/" add foo
fatal: pathspec 'foo' did not match any files 
```

您可以看到我收到的错误消息。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：183
> 
> 时间：2011-12-22T11:22:32.820

您只需要确保存储库知道工作树的位置，反之亦然。

要让存储库知道工作树的位置，请设置配置值`core.worktree`。要让工作树知道它的 git 目录在哪里，请添加一个名为 .git 的文件（不是文件夹！）并添加一行

```
gitdir: /path/to/repo.git 
```

**从 git 1.7.5 开始，init 命令为此学习了一个额外的选项。**

您可以使用初始化一个新的单独存储库

```
git init --separate-git-dir /path/to/repo.git 
```

这将在单独的目录中初始化 git 存储库，并在当前目录中添加 .git 文件，该目录是新存储库的工作目录。

**在 1.7.5 之前，**您必须使用稍微不同的参数并自己添加 .git 文件。

要初始化单独的存储库，以下命令将工作树与存储库链接：

```
git --git-dir=/path/to/repo.git --work-tree=. init && echo "gitdir: /path/to/repo.git" > .git 
```

您的当前目录将是工作树，git 将使用位于`/path/to/repo.git`. init 命令将自动设置参数`core.worktree`指定的值`--git-dir`。

您甚至可以为此添加别名：

```
[alias]
    initexternal = !"f() { git --work-tree=. --git-dir=\"$1\" init && echo \"gitdir: $1\" >> .git; }; f" 
```

**在只读工作目录上使用 git 版本控制**

有了上面的知识，你甚至可以在没有写权限的情况下为工作目录设置 git 版本控制。如果您`--git-dir`在每个 git 命令上使用或从存储库（而不是工作目录）中执行每个命令，则可以省略 .git 文件，因此不需要在工作目录中创建任何文件。另请参阅[Leos 的回答](https://stackoverflow.com/a/26746068/472110)

* * *

## 回答 #2

> 赞同：108
> 
> 时间：2009-02-02T23:58:03.143

```
git --git-dir=../repo --work-tree=. add foo 
```

这会做你想做的事，但当你必须用你曾经使用的每个 git 命令指定它时，显然会很糟糕。

你可以导出`GIT_WORK_TREE=.`，`GIT_DIR=../backup`Git 会在每个命令中提取它们。不过，这只会让您轻松地在每个 shell 中使用一个存储库。

我宁愿建议将 .git 目录符号链接到其他地方，或者从主备份目录创建到 .git 目录的符号链接。

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2013-10-23T17:40:36.313

(and )的`--separate-git-dir`选项可用于在我的 git ( ) 版本上完成此操作。该选项将 git 存储库与工作树分开，并在工作树的根目录中创建一个与文件系统无关的 git 符号链接（以名为 的文件的形式）。我认为结果与[niks 的回答](https://stackoverflow.com/a/8603156/600840)相同。`git init``git clone``1.7.11.3``.git`

```
git init --separate-git-dir path/to/repo.git path/to/worktree 
```

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2014-11-04T22:13:49.713

我发现反转[niks 回答](https://stackoverflow.com/a/8603156/414125)`--work-tree`中使用的and`--git-dir`目录更简单：

```
$ cd read_only_repos
$ git --work-tree=/some/readonly/location/foo/ --git-dir=foo init
$ cd foo
$ git status
On branch master

Initial commit

Untracked files:
  (use "git add <file>..." to include in what will be committed)

        .file_foo
        bar
        ... 
```

这种方法有两个优点：

*   它消除了对任何命令行选项或`.git`文件的需要。您只需在存储库的根目录中正常操作即可。
*   即使您不拥有它，它也允许您对文件系统进行版本控制。Git 只会写入存储库位置。

我遇到的唯一警告是`.gitignore`，您编辑`info/exclude`.

`read_only_repos/foo`然后，即使原始文件不受版本控制，您也可以将存储库用作您自己的存储库中的远程。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2009-02-03T07:44:42.107

通常将目录命名为 git 存储库，它的工作树位于一个不寻常的位置，扩展名为“.git”，很像一个裸存储库。

```
mkdir ../git_repos/myfiles.git 
```

如果您`--work-tree`在初始化时提供了该选项，那么这将自动设置`core.worktree`配置变量，这意味着一旦您指定了 git 目录，git 就会知道在哪里找到工作树。

```
git --git-dir=../git_repos/myfiles.git --work-tree=. init 
```

但是您也可以在事后设置此变量。

```
git --git-dir=../git_repos/myfiles.git config core.worktree "$(pwd)" 
```

完成此操作后，添加命令应按预期工作。

```
git --git-dir=../git_repos/myfiles.git add foo 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-08-23T12:23:30.177

`git`在 repo 中使用：

```
cd ./backup/git_repos/myfiles
git init --bare
git config core.worktree ../myfiles
git config core.bare false 
```

从现在开始，您可以`git`在`./backup/git_repos/myfiles`目录内使用，无需设置任何环境变量或附加参数。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-23T14:41:41.767

您可以使用类似的东西创建一个“nodgit”脚本（No Dot GIT）

```
#!/bin/sh
gits=/usr/local/gits
    x=`pwd`
    testdir() {( cd $1; pwd; )}
    while [ "$x" != "/" ]; do
      y=`echo $x|sed -e "s/\//__/g"`
      if ([ -d "$gits/$y" ]); then
        export GIT_DIR="$gits/$y"
        export GIT_WORK_TREE="$x"
        if ([ "$1" = "nodinit" ]); then
          mkdir -p "$GIT_DIR"
          git init --bare; exit $?
        elif ([ "$1" = "shell" ]); then
          bash; exit $?
        else
          exec git "$@"
        fi
      fi
      x=`testdir "$x/.."`
    done 
```

您可以调用 nodgit 代替 git，它会通过查找 git repo 来根据需要设置变量。例如，假设您在 /usr/local/gits/__home__foo_wibbles 中有一个（裸）repo，并且您在 /home/foo/wibbles/one 中，那么它将找到正确的工作目录（/home/foo/wibbles）和 repo .

哦，你也可以使用“nodgit shell”来获得一个设置了正确变量的 shell，这样你就可以使用普通的旧 git 命令。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-02T23:50:41.673

假设你的`myfiles`目录已经存在并且有一些内容，你能忍受这个吗：

```
cd ~/backup
git init
git add myfiles 
```

该`.git`目录将在 中`backup`，而不是在`myfiles`.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-04-06T21:50:35.147

我创建的脚本看起来像

~/bin/git 斜杠：

```
#!/usr/bin/sh

export GIT_DIR=/home/Version-Control/cygwin-root.git/
export GIT_WORK_TREE=/

git --git-dir=$GIT_DIR --work-tree=$GIT_WORK_TREE "$@"

exit $? 
```

使用 --git_dir=$GIT_DIR 是多余的，但提醒我，我也可以在脚本之外设置环境变量。

上面的示例用于跟踪对 cygwin 系统文件的本地更改。

可以为任何需要这个的主要项目制作一个这样的脚本 - 但是/没有/.git是我的主要用途。

如果消除冗余，上述内容足够小，可以制作 shell 别名或函数。

如果我经常这样做，我会恢复工作区到存储库的映射

```
"Boxes, Links, and Parallel Trees: Elements of a Configuration Management System", 
in Workshop Proceedings of the Software Management Conference. 1989. 
```

其最接近的现代对应物是[Perforce 映射或视图](https://www.perforce.com/perforce/doc.091/manuals/cmdref/o.views.html%20%22Perforce%20workspace/branch%20mappings%20or%20views)，支持部分结帐以及非托管工作区和存储库。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-05-12T08:07:33.133

## 选项 1：core.worktree

在您要跟踪的路径之外初始化一个非裸存储库并设置`core.worktree`为您要跟踪的路径。您可以使用终端命令设置此值或直接编辑存储库配置文件以添加：

`worktree = <path to files to backup>`

不要使存储库文件夹成为此路径的子文件夹，这将是递归的。您可以尝试这个并简单地忽略存储库文件夹，但我认为 git 不会允许这种情况。

在您的情况下，您将转到`backup/git_repos/ to run the` init `command and could use the`--git-dir=./myfiles` 选项来覆盖默认存储库文件夹名称。命令如下所示：

```
cd backup/git_repos 
git init --git-dir=./myfiles
git config core.worktree backup/myfiles 
```

注意：我最近测试了很多 Windows 的 git GUI，只有 Git 扩展支持使用 core.worktree 来移动主工作树。

不支持 core.worktree 的 GUI

SourceTree、Fork、Tower、GitKraken、GitHub Desktop、GitAhead、SmartGit* 和 Git-Cola。使用 core.worktree 时，您需要坚持使用终端。

* SmartGit 将此功能与选项 2 混淆，并要求提供`.git`文件。这对于 core.worktree 不是必需的。

## 选项 2：--separate-git-dir

使用初始化位置中的 .git` 文件在要备份的路径处初始化存储库，该`--separate-git-dir=<path to hold repository data>. This will use the specified path to hold the repository data and create a` 文件包含如下行：

`gitdir: <path to hold repository data>`

对你来说，命令看起来像这样：

```
cd backup/myfiles
git init --separate-git-dir=backup/git_repos/myfiles/ 
```

你的`.git`文件`backup/myfiles/`将包含`gitdir: backup/git_repos/myfiles/`

您现在操作 git 将`.git`文件的位置视为存储库位置。

# c# - 我应该多久在 C# 中使用 try 和 catch？

> ID：505471
> 
> 赞同：34
> 
> 时间：2009-02-02T23:43:15.277
> 
> 标签：c#

**在编写 #1 优先级永远不会崩溃**的 C# 应用程序时，我应该多久使用一次 try-catch 块？

我可以将所有语句封装在 try-catch 块中的方法中吗？

```
public void SomeMethod()
{
    try
    {
        // entire contents of the function
        // library calls
        // function calls
        // variable initialization .. etc
    }
    catch (Exception e)
    {
        // recover
    }
} 
```

将所有内容包装在 try-catch 块中的缺点是什么？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-02T23:49:03.083

唯一的缺点是实际抛出异常时。包装代码没有开销，除非发生异常。

此外，您不想使用 try/catch 进行控制流。考虑一下（错误代码）：

```
try {

    FileStream fs = File.Open("somefile.txt", FileMode.Open);

} catch (Exception ex) {
    MessageBox.Show("The file does not exist. Please select another file");
} 
```

您将从 File.Exists 之类的东西中获得更多性能。如：

```
if(!File.Exists("somefile.txt"))
  MessageBox.Show("The file does not exist.") 
```

编辑：找到[MSDN 直接报价](http://msdn.microsoft.com/en-us/library/ms973839.aspx)：

> 查找和设计掉异常密集的代码可以带来不错的性能胜利。请记住，这与 try/catch 块无关：只有在引发实际异常时才会产生成本。您可以根据需要使用尽可能多的 try/catch 块。无缘无故地使用异常是你失去性能的地方。例如，您应该远离使用异常进行控制流之类的事情。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-02-03T00:02:34.787

这是一个很大的话题。[从这里](http://blogs.msdn.com/fxcop/archive/2006/06/14/631923.aspx)开始一些关于异常处理最佳实践的精彩讨论，并为一场宗教战争做好准备......

[代码分析团队博客](http://blogs.msdn.com/fxcop/archive/2006/06/14/631923.aspx)

[Martin Fowler - 快速失败](http://www.martinfowler.com/ieeeSoftware/failFast.pdf)

[MSDN 关于异常处理](http://msdn.microsoft.com/en-us/library/ms229005.aspx)

[已检查与未检查的异常](http://www.javapractices.com/topic/TopicAction.do?Id=129)

我自己的观点是，在大多数情况下，您经常使用“try/finally”，但“catch”很少。问题是，如果您试图在错误的实例中捕获和处理异常，您可能会无意中将应用程序置于错误状态。通常，使用 dev 和 test 来了解您实际需要在哪里处理异常。这些将是您无法检查的地方。即你不应该真的需要处理 nullreference 或 filenotfound 因为你可以主动检查这些。只有您知道的例外情况可能会发生，但您无能为力。除此之外，为了您的数据状态，让它崩溃。

如果你正在吞下异常，这通常意味着你不了解你的程序或为什么你会得到一个异常。捕捉 System.Exception 是代码异味的典型代表......

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-02T23:49:04.033

实际上，除了记录目的之外，我很少使用 catch 块。`finally`对我来说更常见。大多数时候，`lock`或者`using`做我能做的所有有用的事情（事实上，这`finally`也是）。

Eric Lippert 有[一篇关于异常的博客文章](http://blogs.msdn.com/ericlippert/archive/2008/09/10/vexing-exceptions.aspx)可能有用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-02T23:49:53.347

通常，IMO 最好将无法控制的较小块放在 try catch 中。如果你说：

```
try
{
   //anything that could possibly go wrong
   //This kind of thing is only good for Logging IMO and could be done in
   //Global.asax
} 
```

你怎么可能知道在你的 catch 方法中做什么，因为它可能是任何东西......

它要好得多：

```
try
{
   //divide user imputs
}
catch(DivideByZeroException)
{
  // tell user bad inputs ect....
}
catch (Exception e)
{
    //If you choose to throw the exception you should
    //***********************
    throw; 
    //VS
    throw ex; //Throw ex will restart the stack trace  
    // recover
}
finally
{
    //Clean up resources and continue
} 
```

finally 总是在其中运行

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-02T23:52:50.110

这个问题的关键是以下行：

```
// recover 
```

为了能够恢复，您必须知道恢复什么以及如何恢复。这是假设有可能恢复，但通常情况并非如此。

仅当您知道如何处理异常、知道如何从异常中恢复以及确定可以这样做而不会使应用程序处于不一致或无效状态时，才应该使用 吞下异常的`catch`部分。`try/catch/finally`

如果您可以对应用程序中所有方法调用中的所有可能异常执行此操作，那么请继续，否则您可能需要重新考虑您的#1 优先级（有时快速失败是比尝试在某些情况下保持应用程序存活更好的选择）出错了，以后更难调试崩溃）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-02T23:49:06.187

您可以这样做，尽管几乎在您运行的任何给定环境中，都有一个全局异常处理程序，您可以在其中捕获和处理甚至未知的错误。

对于 Web 应用程序，有 Global.asax，对于控制台程序，只需将 Main() 包装在 try/catch 中，对于服务，有 AppDomain.CurrentDomain.UnhandledException 等。

您应该包装部分，您可以在更具体的块中预测异常可能是什么，但全局异常处理程序应该大大简化您的代码并帮助您。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-02T23:56:41.163

如果您可以有意义地处理它，您应该只捕获并停止异常而不重新抛出它。否则它是一个错误，它应该向上传播。

我假设当他们说“这个应用程序永远不应该崩溃”时，有一个隐含的要求，即它的行为正确。只有经过有意义处理的停止异常才能满足行为正确的要求。

通常，应用程序将有一个顶级 catch 块来捕获和记录未处理的异常。这些应该很少发生（也许您的要求可以解释为根本不应该发生）。如果您在代码中的其他任何地方捕获并停止异常，您就有可能不会发现这些问题。如果您在代码的许多其他部分捕获日志并停止，从关注点分离的角度来看，您的应用程序构建得很差。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-02T23:48:30.087

try 块有性能开销，如果你这样做，你的整个函数会运行得更慢，否则会。 `catch (Exception e)`也是一个坏主意，如果你捕捉到你想对你捕捉到的东西做一些有用的事情，如果你捕捉到所有异常，就不可能知道你应该做什么。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-02-01T15:42:35.813

我一般尽量避免`try catch`阻塞。我更喜欢使用块来强制用户遵守应用程序的规则。例如，如果用户应该只输入一个等于或小于 int x 我会使用的 int：

```
if (input > x)
{
     Console.WriteLine("Invalid input. Please enter a number that is equal to or less than x.");
{...}
} 
```

而不是使用：

```
catch (IndexOutOfRangeException)
{
      //error message here
} 
```

根据我自己的个人经验，我发现编写起来更容易，因为您可以避免将代码封装在 try 块中（保护代码）。

当然，总会有一些时候使用 try catch 是不可避免的——我只是想尽可能地解决它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-02T23:54:16.660

我们当前的应用程序有一个类似的要求：永不崩溃。总是优雅地退出。为此，您必须确保每一行代码都包含在 try-catch 块中，或者仅由其异常可能冒泡的代码调用。

此外，为了防止未捕获的异常，我们将 UnhandledExceptionEventHandler 附加到 AppDomain.CurrentDomain。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-02-02T23:49:37.543

您应该在一段代码可能引发异常的任何时候使用它们。

您必须小心，捕获一般异常绝不是一个好主意。您必须决定要处理它们的层。

这意味着您越深入，您就越想捕捉非常具体的异常并变得更笼统。在数据库中捕获 SqlException。当您在堆栈中走得更高时，您会捕获更多异常，最终在最顶部捕获一般异常。

这样您就可以根据具体情况处理每个异常。一个一般的例外，你不知道该怎么做。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2014-02-10T10:30:04.567

```
public void functionName  
{
  try
  {
     //your codes
     //sometimes 'return' shows exceptions
  }
  catch(Exception e)
  {
    messagebox.show(e.Tostring());   //to know what is the exception
  }
  finally
  {
  }
} 
```

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2012-09-07T18:56:13.720

尝试在 C# 中捕获：

```
try{

}
catch (NullReferenceException en)
{

} 
```

# c++ - 为什么 c_str() 打印字符串两次？

> ID：505476
> 
> 赞同：-1
> 
> 时间：2009-02-02T23:43:46.773
> 
> 标签：c++, c-strings

所以......当我去的时候：

```
cout<<stringName<<endl; 
```

我得到：

```
NT 
```

但是当我去的时候：

```
cout<<stringName.c_str()<<endl; 
```

我得到：

```
NTNT 
```

为什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-02T23:59:21.890

使用以下代码进行快速测试：

```
#include <string>
#include <iostream>

using namespace std;

int main(void) {
    string str = "NT";
    cout << str.c_str() << endl;
    return 0;
} 
```

产生一个 NT 实例，所以看起来你可能在某处有另一个输出调用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T18:46:36.750

一个传统的 C 字符串（通过 a 访问`char const*`）有一个以字符 0 结尾的字符序列。（不是数字`0`，而是一个实际的零值，我们写为`'\0'`。）没有明确的长度——所以各种字符串操作只读取一个字符一次，直到它击中`'\0'`.

C++`std::string`在其结构中具有明确的长度。

您的字符串字符的内存布局是否可能如下所示：

```
'NTNT\0' 
```

但是字符串的长度设置为2？

这将导致这种行为——`std::string`直接操作 将表现为它只有两个字符长，但如果你使用 进行传统的 C 操作`s.c_str()`，它看起来像`"NTNT"`.

我不确定什么恶作剧会让你进入这种状态，但它肯定会符合症状。

进入这种状态的一种方法是实际*写入*字符串的字符，例如：`strcat((char *)s.c_str(), "NT")`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T23:46:59.077

显示更多代码。好像你做到`cout << ealier`了，却忘记了你做到了。如果你这样做它会打印什么 `cout<< "mofo" << stringName.c_str()<< "|||" << endl;`它说`NTmofoNT|||`吗？如果是这样，那很可能就是发生了什么；）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T23:46:51.620

这不是问题`c_str()`，但可能与程序其余部分中的一些其他异常有关。

制作一个执行这些相同操作的“hello world”应用程序，您会发现它在那里运行良好。

# c# - 使用 get/set 实现 C# 线程安全

> ID：505515
> 
> 赞同：59
> 
> 时间：2009-02-02T23:58:01.020
> 
> 标签：c#, locking, properties, thread-safety

这是 C# 的详细问题。

假设我有一个带有对象的类，并且该对象受锁保护：

```
Object mLock = new Object();
MyObject property;
public MyObject MyProperty {
    get {
         return property;
    }
    set { 
         property = value; 
    }
} 
```

我希望轮询线程能够查询该属性。我还希望线程偶尔更新该对象的属性，有时用户可以更新该属性，并且用户希望能够看到该属性。

以下代码会正确锁定数据吗？

```
Object mLock = new Object();
MyObject property;
public MyObject MyProperty {
    get {
         lock (mLock){
             return property;
         }
    }
    set { 
         lock (mLock){
              property = value; 
         }
    }
} 
```

'适当地'，我的意思是，如果我想打电话

```
MyProperty.Field1 = 2; 
```

或者其他什么，在我进行更新时该字段会被锁定吗？是在“get”函数范围内由等于运算符完成的设置，还是“get”函数（以及锁定）首先完成，然后调用设置，然后调用“set”，从而绕过锁？

编辑：既然这显然不会奏效，那会怎样？我是否需要做类似的事情：

```
Object mLock = new Object();
MyObject property;
public MyObject MyProperty {
    get {
         MyObject tmp = null;
         lock (mLock){
             tmp = property.Clone();
         }
         return tmp;
    }
    set { 
         lock (mLock){
              property = value; 
         }
    }
} 
```

这或多或少只是确保我只能访问副本，这意味着如果我让两个线程同时调用“get”，它们每个都将以相同的 Field1 值开始（对吗？）。有没有办法对有意义的属性进行读写锁定？或者我应该限制自己锁定功能部分而不是数据本身？

只是为了让这个例子有意义：MyObject 是一个异步返回状态的设备驱动程序。我通过串行端口向它发送命令，然后设备在自己的甜蜜时间响应这些命令。现在，我有一个线程来轮询它的状态（“你还在那里吗？你能接受命令吗？”），一个等待串行端口响应的线程（“刚得到状态字符串 2，一切都很好” )，然后是接受其他命令的 UI 线程（“用户希望你做这件事。”）并发布来自驱动程序的响应（“我刚刚完成了这件事，现在用它更新 UI”）。这就是为什么我想锁定对象本身，而不是对象的字段；那将是大量的锁，a 和 b，并非此类的每个设备都具有相同的行为，

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-03T00:30:21.283

不，您的代码不会锁定对从`MyProperty`. 它只会锁定`MyProperty`自己。

您的示例用法实际上是将两个操作合二为一，大致相当于：

```
// object is locked and then immediately released in the MyProperty getter
MyObject o = MyProperty;

// this assignment isn't covered by a lock
o.Field1 = 2;

// the MyProperty setter is never even called in this example 
```

简而言之 - 如果两个线程`MyProperty`同时访问，getter 将短暂阻塞第二个线程，直到它将对象返回给第一个线程，*但*它也会将对象返回给第二个线程。然后，两个线程都将拥有对该对象的完全、未锁定的访问权限。

**编辑以回应问题中的更多细节**

我仍然不能 100% 确定您要实现的目标，但是如果您只想对对象进行原子访问，那么您不能对对象本身进行调用代码锁定吗？

```
// quick and dirty example
// there's almost certainly a better/cleaner way to do this
lock (MyProperty)
{
    // other threads can't lock the object while you're in here
    MyProperty.Field1 = 2;
    // do more stuff if you like, the object is all yours
}
// now the object is up-for-grabs again 
```

不理想，但只要对对象的所有访问都包含在`lock (MyProperty)`部分中，那么这种方法将是线程安全的。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-03T01:36:29.713

如果您的方法可行，并发编程将非常容易。但事实并非如此，泰坦尼克号沉没的冰山是，例如，你班级的客户这样做：

```
objectRef.MyProperty += 1; 
```

读取-修改-写入竞赛非常明显，还有更糟糕的竞赛。除了使其不可变之外，您绝对无法做任何事情来使您的属性成为线程安全的。需要解决头痛问题的是您的客户。被迫将这种责任委派给最不可能做对的程序员是并发编程的致命弱点。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-03T02:05:53.697

正如其他人指出的那样，一旦您从 getter 返回对象，您就无法控制谁访问该对象以及何时访问该对象。要执行您想要执行的操作，您需要在对象本身内放置一个锁。

也许我不了解全貌，但根据您的描述，听起来您不一定需要为每个单独的字段设置锁。如果您有一组字段是通过 getter 和 setter 简单地读取和写入的，那么您可能会为这些字段使用一个锁。显然，您可能会以这种方式不必要地序列化线程的操作。但同样，根据您的描述，听起来您也没有积极地访问该对象。

我还建议使用事件而不是使用线程来轮询设备状态。使用轮询机制，您将在每次线程查询设备时锁定。使用事件机制，一旦状态发生变化，对象会通知任何监听者。此时，您的“轮询”线程（将不再轮询）将唤醒并获得新状态。这将更有效率。

举个例子...

```
public class Status
{
    private int _code;
    private DateTime _lastUpdate;
    private object _sync = new object(); // single lock for both fields

    public int Code
    {
        get { lock (_sync) { return _code; } }
        set
        {
            lock (_sync) {
                _code = value;
            }

            // Notify listeners
            EventHandler handler = Changed;
            if (handler != null) {
                handler(this, null);
            }
        }
    }

    public DateTime LastUpdate
    {
        get { lock (_sync) { return _lastUpdate; } }
        set { lock (_sync) { _lastUpdate = value; } }
    }

    public event EventHandler Changed;
} 
```

您的“投票”线程看起来像这样。

```
Status status = new Status();
ManualResetEvent changedEvent = new ManualResetEvent(false);
Thread thread = new Thread(
    delegate() {
        status.Changed += delegate { changedEvent.Set(); };
        while (true) {
            changedEvent.WaitOne(Timeout.Infinite);
            int code = status.Code;
            DateTime lastUpdate = status.LastUpdate;
            changedEvent.Reset();
        }
    }
);
thread.Start(); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T00:46:45.460

您示例中的锁定范围位于不正确的位置 - 它需要位于“MyObject”类属性的范围内，而不是容器的范围内。

如果 MyObject 我的对象类仅用于包含一个线程想要写入的数据，以及另一个（UI 线程）要从中读取的数据，那么您可能根本不需要 setter 并构造一次。

还要考虑在属性级别加锁是否是锁粒度的写级别；如果可能会写入多个属性以表示事务的状态（例如：总订单和总重量），那么最好在 MyObject 级别使用锁（即 lock( myObject.SyncRoot ) .. . )

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T00:07:30.940

在您发布的代码示例中，永远不会执行 get 。

在一个更复杂的例子中：

```
MyProperty.Field1 = MyProperty.doSomething() + 2; 
```

当然，假设你做了一个：

```
lock (mLock) 
{
    // stuff...
} 
```

那时`doSomething()`所有的锁调用都*不足以*保证整个对象的同步。一旦`doSomething()`函数返回，锁就丢失了，然后加法完成，然后分配发生，再次锁定。

或者，以另一种方式编写它，您可以假装锁不是自动完成的，并将其重写为更像“机器代码”，每行一个操作，这变得很明显：

```
lock (mLock) 
{
    val = doSomething()
}
val = val + 2
lock (mLock)
{
    MyProperty.Field1 = val
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T00:24:04.383

多线程的美妙之处在于你不知道事情会以什么顺序发生。如果你在一个线程上设置了一些东西，它可能会先发生，也可能在 get 之后发生。

您发布的代码会在成员被读取和写入时锁定该成员。如果您想处理值更新的情况，也许您应该研究其他形式的同步，例如[events](http://msdn.microsoft.com/en-us/library/system.threading.eventwaithandle.aspx)。（查看自动/手动版本）。然后您可以告诉您的“轮询”线程该值已更改并且可以重新读取。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T01:23:52.533

在您编辑的版本中，您仍然没有提供一种线程安全的方式来更新 MyObject。对对象属性的任何更改都需要在同步/锁定块内完成。

您可以编写单独的 setter 来处理此问题，但您已表示这将是困难的，因为大量字段。如果确实如此（而且您还没有提供足够的信息来评估这一点），另一种选择是编写一个使用反射的设置器；这将允许您传入一个表示字段名称的字符串，并且您可以动态查找字段名称并更新值。这将允许您拥有一个可以在任意数量的字段上工作的设置器。这并不容易或高效，但它可以让您处理大量的类和字段。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-10-15T08:51:19.003

您已经实现了一个用于获取/设置对象的锁，但您没有使对象线程安全，这是另一回事。

我写了一篇关于 C# 中不可变模型类的文章，在这种情况下可能很有趣：[http ://rickyhelgesson.wordpress.com/2012/07/17/mutable-or-immutable-in-a-parallel-world/](http://rickyhelgesson.wordpress.com/2012/07/17/mutable-or-immutable-in-a-parallel-world/)

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2016-02-19T18:59:15.520

C# 锁是否不会遇到与其他语言相同的锁定问题？

例如

```
var someObj = -1;

// Thread 1

if (someObj = -1)
    lock(someObj)
        someObj = 42;

// Thread 2

if (someObj = -1)
    lock(someObj)
        someObj = 24; 
```

这可能会导致两个线程最终都获得锁定并更改值的问题。这可能会导致一些奇怪的错误。但是，除非需要，否则您不希望不必要地锁定对象。在这种情况下，您应该考虑双重检查锁定。

```
// Threads 1 & 2

if (someObj = -1)
    lock(someObj)
        if(someObj = -1)
            someObj = {newValue}; 
```

只是要记住的事情。

# c - 具有声音支持的良好便携式 wiimote 库？

> ID：505521
> 
> 赞同：3
> 
> 时间：2009-02-02T23:59:44.947
> 
> 标签：c, portability, wiimote

我正在寻找一个便携式 wiimote 库。我想将 wiimote 用于它拥有的硬件（但我不需要访问存储在其上的任何数据）。

所需功能：

*   访问所有按钮（作为例外，不使用电源按钮是可以的）
*   让wiimote播放声音
*   与双节棍和经典控制器交谈
*   最好：让wiimote隆隆声。
*   与 C 接口。最好是原生 C。与 Haskell 或 python 绑定的奖励积分。

该库应该移植到 Linux、Windows 和 OS X（按重要性排序），并且应该与 CPU 架构无关。

有人有好的建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T00:06:04.357

没用过（我只读过托管的 Wiimote 库），但您可能想查看[wiiuse](http://www.wiiuse.net/)。它似乎是最完整的原生库。

其他包括：

*   [手套派](http://carl.kenner.googlepages.com/glovepie_download)
*   [Wii你自己](http://wiiyourself.gl.tter.org/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-28T14:37:14.443

您可以使用我的 WiiMouse 程序来执行此操作（基于 wiimotelib 开源项目），它允许您通过命名管道连接并播放 PCM 声音并使用包括 MotionPlus 在内的所有附件，它甚至可以为您计算 MotionPLus 向量， 你可以在这里得到它：

[http://home.exetel.com.au/amurgshere/wiimouse.phtml](http://home.exetel.com.au/amurgshere/wiimouse.phtml)

有关如何通过命名管道连接到 wiimote 并播放声音和内容的示例，请参阅下载。

# c# - C#：在单独的线程中使用 [Type].InvokeMember() 调用方法

> ID：505523
> 
> 赞同：7
> 
> 时间：2009-02-03T00:00:18.253
> 
> 标签：c#, .net, multithreading, reflection

我正在使用此代码调用`run`从 dll 动态加载的类列表的方法：

```
for (int i = 0; i < robotList.Count; i++)
{
    Type t = robotList[i]; //robotList is a List<Type>
    object o = Activator.CreateInstance(t);
    t.InvokeMember("run", BindingFlags.Default | BindingFlags.InvokeMethod, null, o, null);
} 
```

`invokeMember`正在调用`run`列表中每个类的方法。

现在**我怎样才能从一个单独的线程中调用这个`run`方法`invokeMember`**？这样我将为每个调用的方法运行单独的线程。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-03T00:10:51.853

如果您知道所有动态加载的类型都实现了 Run，您是否可以只要求它们都实现 IRunable 并摆脱反射部分？

```
Type t = robotList[i];
IRunable o = Activator.CreateInstance(t) as IRunable;
if (o != null)
{
    o.Run(); //do this in another thread of course, see below
} 
```

如果没有，这将起作用：

```
for (int i = 0; i < robotList.Count; i++)
{
    Type t = robotList[i];
    object o = Activator.CreateInstance(t);
    Thread thread = new Thread(delegate()
    {
        t.InvokeMember("Run", BindingFlags.Default | BindingFlags.InvokeMethod, null, o, null);
    });
    thread.Start();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T00:18:32.600

查看此示例以了解一种方法：

```
using System;
using System.Threading;
using System.Reflection;
using System.Collections.Generic;

namespace Obfuscation
{
    public class Program
    {
        static Type[] robotArray = new Type[] { typeof(Program) };
        static List<Type> robotList = new List<Type>(robotArray);

        internal void Run()
        {
            Console.WriteLine("Do stuff here");
        }

        internal static void RunInstance(object threadParam)
        {
            Type t = (Type)threadParam;
            object o = Activator.CreateInstance((Type)t);
            t.InvokeMember("Run", BindingFlags.InvokeMethod | BindingFlags.Instance | BindingFlags.NonPublic, null, o, null);
        }

        public static void Main(string[] args)
        {
            for (int i = 0; i < robotList.Count; i++)
            {
                ThreadPool.QueueUserWorkItem(new WaitCallback(RunInstance), robotList[i]);
            }
        }
    }
} 
```

# jquery - jQuery UI 对话框中损坏的 closeOnEscape 是否有解决方法

> ID：505531
> 
> 赞同：2
> 
> 时间：2009-02-03T00:03:10.557
> 
> 标签：jquery, jquery-ui

看起来 jQuery UI 对话框中存在一个错误，其中 closeOnEscape 无法正常工作，因此转义仍会关闭对话框。一种可能的解决方案是取消绑定覆盖上的 keydown，但这似乎不起作用。

还有另一种可行的解决方案吗？

这是 1.6 的错误和修复的链接，但 1.5.3 仍然损坏：[http ://dev.jqueryui.com/ticket/3253](http://dev.jqueryui.com/ticket/3253)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-06-14T01:01:40.177

[此错误](http://dev.jqueryui.com/ticket/3253)已被修复（在 1.6b 中）：http: [//jqueryui.com/docs/Changelog/1.6](http://jqueryui.com/docs/Changelog/1.6)

更新到[最新的 jQuery UI 版本](http://jqueryui.com/)应该可以解决这个问题。在最新版本（截至本答案时为 1.8.2）中，它适用于所有浏览器，没有任何问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T08:19:46.000

似乎是一个非常简单的反向移植补丁 - 它只是包装

```
if (options.closeOnEscape) { } 
```

大约

```
(e.keyCode && e.keyCode == $.keyCode.ESCAPE && dialog.close()); 
```

# crystal-reports - 在 Crystal Reports 中添加新组会导致我现有的所有组消失

> ID：505539
> 
> 赞同：1
> 
> 时间：2009-02-03T00:06:35.823
> 
> 标签：crystal-reports

简而言之，我的问题：我创建了一个新报告，一次插入多个组，一切都很好，直到我添加最后一个组，突然我得到整个报告的零结果。

我是 Crystal Reports 的新手，所以我什至不确定我是否使用了正确的词汇，我相信这是我很难在谷歌上搜索的原因之一。我有一本书正在阅读（Pro VS 2005 Reporting Using SQL Server and Crystal Reports），但它非常具体地提出了一系列要遵循的步骤，并没有真正解释事情的原因。

我正在使用带有内置 Crystal Reports 的 VS 2005、C#；我没有花哨的独立版本。

我正在创建一个数据集并将其作为报表数据库传递到报表中。DataSet 有四个表：一个用户表（其中包括一个用户组 ID）、一个包含用户所学课程列表的课程表、一个包含课程中每个考试详细信息的考试详细信息表（包括考试分数）和一个主题详细信息表，其中包含有关考试主题的信息（包括考试中每个主题的分数）。

我可以添加用户组组、用户组、课程组和考试组，并返回每个考试的详细信息。但是当我添加一个主题组时，一切都消失了。如果我自己添加一个主题组，我会看到一个主题列表，但是使主题组成为任何其他组的内部组只会给我一个空白报告。

我检查并在所有表格之间定义了关系，这些关系应该指示哪个主题与哪个考试等相关。

如果您需要任何其他信息，请告诉我。我确信这是我忽略的一些简单的事情，因为我没有专门的 Crystal Reports 书。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T01:03:24.617

您可以尝试直接在数据库中重新创建正在使用的基本 SQL 吗？听起来您要取回数据，直到添加最后一个组，这使得查询现在返回一个空集。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-09T23:45:14.597

我发现的补救措施之一是从 sql 字段中删除下划线，以防止其他标签消失。我最初在 sql 中有字段“abc_xyz”，必须将其更改为“abcxyz”才能使其在水晶中工作。

# asp.net-mvc - 如何为登录表单的链接指定返回 url？

> ID：505540
> 
> 赞同：8
> 
> 时间：2009-02-03T00:07:19.097
> 
> 标签：asp.net-mvc, url-routing

看起来很简单，但事实证明并非如此 - 主要是因为 View 不可能知道你通过 Model 和 Controller 的哪个方式到达那里。无论如何，这是一个需要解决的问题：

我有一个登录链接，它将用户带到一个表单以输入用户名和密码。当用户点击“提交”时，我想重定向到他正在查看的页面。最简单的方法似乎是将当前页面的 url 指定为查询字符串 ( `...?returnUrl=...`)，并且其他所有内容都已构建。

但是，在呈现链接时，我在哪里可以从我的视图中找到这个 url？我自然不能使用 RedirectToActionResult，因为我不想实际转移用户 - 只在链接中呈现 url。如何？

* * *

编辑：

我现在已经开始对这个问题进行赏金，因此我认为也可以澄清我的需求。

我的共享文件夹中有一个名为 Login.ascx 的用户控件。在其中，我向登录表单呈现了一个 ActionLink，它包含在我的 Masterpage 的页脚中。我想要完成的是以下内容：

渲染 ActionLink 时，查询字符串`returnUrl`会附加**到当前正在渲染的视图的路由**。如果完成此操作，用户将在成功登录后返回到他/她正在查看的页面，该页面已内置在 ASP.NET MVC 框架中。

之前的答案还不够充分的原因主要是他们没有提供一种方法来**构建到当前视图的路由 url**。我确实知道如何附加查询字符串，但我不知道如何找出在该字符串中放入的内容。

为了将答案标记为*答案*，我想要一种方法来从母版页中的用户控件重新构建到当前显示视图的路由。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-10T20:41:29.823

解决方案是像这样使用 HttpContext.Current.Request.RawUrl：

```
<%= Html.ActionLink("log on", "LogIn", new { controller = "User", returnUrl = HttpContext.Current.Request.RawUrl }) %> 
```

或者使用[MVC 期货](http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=22359)(Microsoft.Web.Mvc.dll) 的扩展方法：

```
<%= Html.ActionLink<AccountController>(c => c.LogOn("name", "password", false, HttpContext.Current.Request.RawUrl), "login here")%> 
```

ActionController 是 mvc 中的默认控制器，但只需将 returnUrl 添加到您自己的即可。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T01:06:16.110

`<a href="/Account/Login/?returnUrl=/Product/10">Login</a>`一种方法是使用 returnUrl=/PageToReturnTo （例如）构建将用户发送到登录表单的链接。您想编写它，以便返回 url 是从您的路由构造的，但是在每个页面上手动编写这些链接可能很麻烦。

MVC 中的默认登录操作已经构建了 returnUrl 功能。只需要传递一个值，剩下的就交给它了。这是来自新项目的方法签名的复制粘贴。

```
public ActionResult Login(string username, string password, bool rememberMe, string returnUrl) 
```

希望对你有帮助！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-14T10:22:07.593

您可以使用**`Page.Request.Url`**来获取导致当前呈现视图的路线。

尽管这更像是一个装饰细节，但您可能希望统一通过 '/' 和 '/default.aspx' 路由发出的请求并始终返回到 '/' 路由。我的母版页中有一个辅助属性，可以做到这一点。

```
 protected Uri RouteUrl
    {
        get
        {
            if (Page.Request.Url.AbsolutePath.StartsWith("/default.aspx", StringComparison.OrdinalIgnoreCase))
            {
                return new Uri(Request.Url, new Uri(Response.ApplyAppPathModifier("~/")));
            }

            return Page.Request.Url;
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T20:21:53.777

我不了解 ASPX，但我们在构建它时遇到了几个问题：

当用户输入错误密码并循环登录页面以进行另一次访问时，仍必须保留目标。

我们还决定将 POST 变量保留到需要即时登录的页面

# c# - 删除大文本文件中的重复项

> ID：505545
> 
> 赞同：1
> 
> 时间：2009-02-03T00:08:16.460
> 
> 标签：c#, permutation

我一直在尝试计算一个 *很*长的词（反反建制主义）的所有独特排列，虽然我可以计算这些词的排列，但我在停止产生重复时遇到了问题。

通常我只会`List<T>.Contains()`在我的字符串上运行该方法，但是排列列表变得如此之大，我无法将其保存在内存中。我早些时候犯了这个错误，并设法用尽了我电脑中的所有 8GB 内存。为了防止这种情况再次发生，我更改了代码以将计算出的排列附加到文件中并从内存中释放它。

我的主要问题是：**如何防止重复排列被添加到我的文件中而不将整个内容加载到内存中？**是否可以选择性地加载，例如，前几兆字节，扫描，然后继续直到文件完成，或者我应该寻找不同的方向？

这不是作业，我的数学作业给出了一个假设情况，计算机每秒可以计算 30 个排列，并让我弄清楚计算所有排列需要多长时间。这不是问题，我也不需要帮助，我只是想知道现代计算机执行相同任务需要多长时间。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T00:18:18.607

使用一种生成所有排列**而不**重复的算法怎么样？这样一来，您就不必首先检查它们。

谷歌搜索“算法生成排列”会出现几十个参考资料，让你开始。例如[排列生成方法](http://www.cs.princeton.edu/~rs/talks/perms.pdf "置换生成方法")

# .net - 你是如何让 ASP.NET 输出 UTF-16 编码的文本的？

> ID：505549
> 
> 赞同：2
> 
> 时间：2009-02-03T00:09:12.137
> 
> 标签：.net, asp.net, xml, utf-16, ashx

你是如何让 ASP.NET 输出 UTF-16 编码的文本的？

我在 .NET 中序列化一个默认为 UTF-16 格式的对象。现在我想将字符串作为输出响应发送给 .ashx 请求。

我收到错误：不支持从当前编码切换到指定编码。错误处理资源

如何告诉我的网站或页面使用 UTF-16 格式。

谢谢。

**更新：**阅读两个答案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T02:27:00.643

一般来说：不要。

作为 UTF-16 的网页混淆了许多工具，并使浏览器以奇怪的、意想不到的方式运行。（特别是：链接脚本、表单提交、代理）。UTF-16 只能作为二进制对象安全地提供，因此对于 Web 内容，坚持使用作为 ASCII 超集的编码 - 显而易见的选择是 UTF-8。

您引用的错误通常是您尝试读取其 <?xml encoding="..."?> prolog 与文件的实际编码冲突的 XML 文件时得到的错误。ASCII 编码的超集都不会发生冲突，因为“xml 编码”是 ASCII 并且在所有编码中都表示相同，但​​是如果您将 encoding="utf-16" 放在未保存为 UTF- 的 XML 文件中16，或者你*没有*把它放进去，那么解析器*就*无法处理逻辑上的不可能性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T00:35:15.437

[`Response.ContentEncoding`](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.contentencoding.aspx)将属性更改为[`System.Text.Encoding.Unicode`](http://msdn.microsoft.com/en-us/library/system.text.encoding.unicode.aspx)?

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-08T19:24:38.800

以下对我有用：

```
Dim utf16 = New UnicodeEncoding(False, True)
Response.BinaryWrite(utf16.GetPreamble)
Response.ContentEncoding = utf16 
```

顺便说一句，我需要这样做，因为我正在向 Excel 发送一个包含 unicode 字符的 html 表。（我知道，这不是创建 Excel 文件的最佳方式！）

Excel（和 LibreOffice Calc）需要 utf-16 并且不适用于 utf-8。Excel 在开头也需要 UTF16 BOM，因此调用 GetPreamble。

# oop - 静态成员不使类本身成为（全局）对象吗？

> ID：505550
> 
> 赞同：4
> 
> 时间：2009-02-03T00:09:29.483
> 
> 标签：oop, class, design-patterns, singleton, static-members

每次我遇到单例模式或任何静态类（即具有（几乎）只有静态成员的类）的实现时，我想知道这是否实际上不是一个 hack，因此严重滥用类和实例的原则只是为了设计单个对象，而不是设计类和创建单个实例。对我来说，看起来类的静态成员通常会尝试向类添加一些他们实际上不应该拥有的特性，而是让它们自己反对。

但是这样实现单个对象真的很可取吗？还是您对事物的看法完全不同，并且认为此类静态类或单例与实际对象没有任何共同之处？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T00:15:15.837

静态成员实际上只是全局变量的命名空间，是的。没有错; 命名空间很好，全局变量是完成某些任务的最干净的方式。

单例可能更有趣（按需加载...），但它们是类似的构造（是的，您可以将静态成员视为由编译器管理的匿名单例）。

像大多数事情一样，这些工具也有自己的位置，只有理论家担心它们是否“适合”特定的意识形态。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T00:15:17.960

根据您的语言，类*是*对象。在 ruby​​ 和 java 中，它们属于 Class；在python中，我不记得（类型的子类？）。

在java中，你不能避免把东西放在类上。这意味着您有时必须像使用命名空间和模块一样使用类。Math 上的许多静态方法就是一个很好的例子。我会说让这些方法是静态的可以充分利用糟糕的情况。

我认为拥有静态属性是否“肮脏”在很大程度上取决于上下文。您真正应该寻找的是适当的封装：如果您可以在代码的概念空间中绘制一条曲线并说“这一侧的一切都不需要知道关于那一侧的任何事情，除了跨越的接口曲线。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T01:01:12.093

您可以从性能和内存的角度来查看它。例如，在以下代码中：

```
public class StringUtils
{
    public static boolean isEmpty(String value)
    {
        // some code
    }

    public static String reverseString(String value)
    {
        // some code
    }
} 
```

你真的想在所有地方实例化 StringUtils 对象只是为了调用一个不存储任何成员变量的方法吗？在一个简单的程序中，这并不重要。但是一旦你的程序开始达到一定的大小并且你调用这些方法数千次，那么让我们只是实例化可以加起来。为什么？做一个纯粹主义者？这不值得。只需使用相同的实例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T00:14:42.860

假设我有一个具有单个配置文件的应用程序。如果我的语言不支持类之外的全局函数（如 Java 或 C#），我将如何创建函数以在不使用“单例”的情况下对该文件进行操作？

在我看来，实现这一目标的唯一真正方法是开设一个单例课程。使用单例模式，您也不需要传递指向对象的指针，因为您可以使用静态方法再次获取它。

我看不出这违反了任何面向对象的原则。以不同的方式来做，比如将配置函数放在另一个不处理配置的类（如“实用程序”类）中，这*更像*是违反 OO 原则。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-14T06:21:28.103

假设您有一个需要中央数据存储库的多线程应用程序。消费者和生产者使用或放入存储库中的数据，包括通过接口访问存储库的外部应用程序对象。

如果您将此存储库设为普通类对象，您将遇到初始化它并获取指向每个需要它的对象的指针的问题。不是最棘手的问题，但它可能会与许多线程和对象混淆。

另一方面，如果你这样做：

```
public enum Data implements MyInterface{
   INSTANCE;
       private final Whatevertype secretstuff = new Whatevertype();
       ...etc...
       public void PutThing( Sometype indata){ ... };
       public Sometype GetThing( int somecode ){ ...};
       ...etc...
 } 
```

您（a）不必实例化任何东西，并且（b）可以从任何地方访问

```
Data.INSTANCE.GetThing(42); 
```

等等，就像汉兰达一样......只能有一个

# php - 如何在 Zend 框架中存储 cron 作业的脚本？

> ID：505552
> 
> 赞同：2
> 
> 时间：2009-02-03T00:09:57.860
> 
> 标签：php, zend-framework, cron

因为 ZF 依赖于它的所有 URL 的 mod rewrite，所以对我来说，我应该在哪里存储本地脚本以用于 cron 作业并不是很明显。

有没有人有任何建议，或者是否有“官方接受”的方式？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T02:34:05.137

我在网站设计中使用[模块化目录结构](http://framework.zend.com/manual/en/zend.controller.modular.html)，以便为网站的每个单独模块创建控制器、视图等。每个模块中都包含一个脚本（或 cron）目录，用于存储该特定模块的所有 cron 脚本。

就我个人而言，我发现从 Zend Framework 以及从实际 Web 应用程序访问资源时，这让事情变得简单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T07:31:46.597

我必须创建一个可以通过 cron 运行的脚本（而且我没有使用模块），所以我把我的脚本卡在了 library/Myproject/cronscripts 之类的东西中

这是一篇[相关的文章。](http://www.ibm.com/developerworks/opensource/library/os-php-fwk5/?ca=dgr-btw01PHP-CRON-Tasks)

# c# - 查找当前的 Windows 应用程序

> ID：505553
> 
> 赞同：4
> 
> 时间：2009-02-03T00:10:11.277
> 
> 标签：c#, windows

我正在尝试编写我希望是一个简单的应用程序跟踪器。也就是说，每当新应用程序启动或正在运行的应用程序成为当前应用程序时，我想记下该事件并开始计时它的时间“在顶部”。

我有列出所有当前正在运行的应用程序的代码，以及一些告诉我顶部窗口的代码（自然是我的测试控制台应用程序）。

我认为我缺少的是要监视的 Windows 事件流或其他东西。

我正在使用 .NET（首选 C#）。

有任何提示、提示或作弊吗？

谢谢 - 乔纳森

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T00:16:31.683

我不确定是否有办法挂钩 Windows 事件，但只需定期轮询 System.Diagnostics.Process.GetProcesses() （比如 100 毫秒）并查找新/删除的进程（按进程 ID 比较）就可以了工作。此外， Process.StartTime 将为您提供流程开始的时间。

警告：与基于事件的方法（我都不知道）相比，此方法可能需要更多的处理量。不会观察到在每次轮询之间开始和结束的进程，但是对于相当高的轮询频率来说，这种情况确实应该很少见（也许你甚至都不关心这些进程）。这么说，这些都是小问题，我建议你至少测试一下这个解决方案，因为它相当简单。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T00:18:56.890

我认为最好的方法是使用 Windows“钩子”（即[SetWindowsHookEx](http://msdn.microsoft.com/en-us/library/ms644990.aspx)）。这些允许您连接到 Windows 核心功能，特别是`WH_CALLWNDPROC`当系统中的任何窗口接收到消息时，它会调用用户函数。

您可以使用它来全局侦听将窗口带到前台的消息和/或用于用户交互（鼠标、键盘）的消息。

然而，这是一个原始的 Windows API 函数，主要用于 C/C++ Windows DLL。您可以在 C# 中实现它，但这是您可能不想打开的一大堆蠕虫。但是打开它可能是做你所要求的最好的方式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T00:49:45.470

这越来越成为一个 SO 问题，被否决的答案是正确的答案。SetWindowsHookEx() 确实需要能够捕获激活的窗口获得的 WM_ACTIVATE 消息。但这需要一个 WH_CALLWNDPROC 或 WH_SHELL 钩子，这些钩子无法在 C# 中实现。捕捉这些需要在每个进程中注入一个 DLL，托管程序集不能注入另一个进程。无法初始化 CLR。

为诺多林+1 让他回到0，这就是我能做的。OP 需要用非托管 C/C++ 编写代码，创建 DLL 并使用标准 IPC 机制（如管道或套接字）来通知主机应用程序。或投票，更容易。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T02:08:43.643

我曾经写了一个小应用程序来记录我自己的工作习惯。我所做的是[`GetForegroundWindow()`](http://msdn.microsoft.com/en-us/library/ms633505(VS.85).aspx)定期调用（每 5 秒左右）并记录正在运行的应用程序。您可以从窗口句柄中获取大量信息，不仅是标题，还包括创建它的实际进程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T02:22:39.997

这就是我使用 Java 的 JNA 所做的：

```
final HWND child = User32Ext.INSTANCE.GetForegroundWindow();
final int length = User32.INSTANCE.GetWindowTextLength(child) * 2;
final byte[] buffer = new byte[length];
User32.INSTANCE.GetWindowText(child, buffer, length);
title = new String(buffer, Charset.forName("UTF-16LE")); 
```

其中 User32Ext 是我所做的扩展，因为 User32（在 JNA 的发行版中）没有以下接口：

```
LRESULT callback(int nCode, WPARAM wParam, LPARAM lParam); 
```

我定期轮询活动窗口，因为我无法使用[http://msdn.microsoft.com/en-us/library/ms997537.aspx](http://msdn.microsoft.com/en-us/library/ms997537.aspx)中提到的 HCBT_SETFOCUS 挂钩，如果有人我会很感兴趣提出解决方案。

# python - Python 中的闭包

> ID：505559
> 
> 赞同：8
> 
> 时间：2009-02-03T00:13:06.730
> 
> 标签：python, closures, lexical-scope

我一直在尝试学习 Python，虽然我热衷于在 Python 中使用闭包，但我一直无法让一些代码正常工作：

```
def memoize(fn):
    def get(key):
        return (False,)

    def vset(key, value):
        global get
        oldget = get
        def newget(ky):
            if key==ky: return (True, value)
            return oldget(ky)
        get = newget

    def mfun(*args):
        cache = get(args)
        if (cache[0]): return cache[1]

        val = apply(fn, args)
        vset(args, val)
        return val

    return mfun

def fib(x):
    if x<2: return x
    return fib(x-1)+fib(x-2)

def fibm(x):
    if x<2: return x
    return fibm(x-1)+fibm(x-2)

fibm = memoize(fibm) 
```

基本上，这应该做的是使用闭包来维护函数的记忆状态。我意识到可能有很多更快、更容易阅读并且通常更“Pythonic”的方法来实现它；但是，我的目标是准确了解闭包在 Python 中的工作原理，以及它们与 Lisp 的不同之处，因此我对替代解决方案不感兴趣，只是为什么我的代码不起作用以及我能做些什么（如果有的话）来修复它。

我遇到的问题是当我尝试使用`fibm`- Python 坚持`get`没有定义：

```
Python 2.6.1 (r261:67515, Feb  1 2009, 11:39:55) 
[GCC 4.0.1 (Apple Inc. build 5488)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import memoize
>>> memoize.fibm(35)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "memoize.py", line 14, in mfun
    cache = get(args)
NameError: global name 'get' is not defined
>>> 
```

鉴于我是 Python 新手，我不知道我是否做错了什么，或者这只是语言的限制。我希望是前者。:-)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T00:26:25.580

问题在于你的范围，而不是你的闭包。如果您准备阅读大量内容，那么您可以尝试[http://www.python.org/dev/peps/pep-3104/](http://www.python.org/dev/peps/pep-3104/)。

如果不是这种情况，这是简单的解释：

问题出在声明中`global get`。`global`指的是最外层的作用域，并且由于没有任何全局函数`get`，所以它会抛出。

您需要的是封闭范围内变量的访问说明符，而不是全局范围。

在 python 3.0 中，正如我测试过的，`nonlocal`关键字正是你需要的，代替`global`.

```
nonlocal get
... 
```

在 python 2.x 中，我刚刚删除了`global get`和`oldget`引用，它可以正常工作。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-03T00:57:24.253

```
def memoize(fn):
  get = [lambda key: (False, None)]

  def vset(args):
    value = fn(*args)
    oldget = get[0]
    def newget(key):
      if args == key:
        return (True, value)
      return oldget(key)
    get[0] = newget
    return value

  def mfun(*args):
    found, value = get[0](args)
    if found:
      return value
    return vset(args)

  return mfun

CALLS = 0

def fib(x):
  global CALLS
  CALLS += 1
  if x<2: return x
  return fib(x-1)+fib(x-2)

@memoize
def fibm(x):
  global CALLS
  CALLS += 1
  if x<2: return x
  return fibm(x-1)+fibm(x-2)

CALLS = 0
print "fib(35) is", fib(35), "and took", CALLS, "calls"
CALLS = 0
print "fibm(35) is", fibm(35), "and took", CALLS, "calls" 
```

输出是：

```
fib(35) is 9227465 and took 29860703 calls
fibm(35) is 9227465 and took 36 calls 
```

与其他答案类似，但是这个有效。:)

问题中代码的重要变化是分配给非全局非本地（get）；不过，我也做了一些改进，同时尽量保持你`*`咳`*`*破*`*`咳`*`闭的使用。通常缓存是一个字典而不是闭包的链表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T00:24:59.750

您想放在*每个*`global get`函数的开头（除了它本身）。*`get`*

 *the`def get`是对 name 的赋值`get`，因此您希望在此之前被声明为全局。

放入mfun`global get`和 vset 使它们工作。我无法指出使这成为必要的范围规则，但它有效;-)

你的缺点也很狡猾...... :)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T00:58:45.860

`Get`不是全局的，而是周围函数的局部，这就是`global`声明失败的原因。

如果您删除`global`，它仍然会失败，因为您无法分配给捕获的变量名称。为了解决这个问题，您可以使用一个对象作为闭包捕获的变量，而不仅仅是更改该对象的属性：

```
class Memo(object):
    pass

def memoize(fn):
    def defaultget(key):
        return (False,)

    memo = Memo()
    memo.get = defaultget

    def vset(key, value):
        oldget = memo.get
        def newget(ky):
            if key==ky: return (True, value)
            return oldget(ky)
        memo.get = newget

    def mfun(*args):
        cache = memo.get(args)
        if cache[0]: return cache[1]

        val = apply(fn, args)
        vset(args, val)
        return val

    return mfun 
```

这样您就不需要分配给捕获的变量名称，但仍然可以获得您想要的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T00:27:20.803

可能是因为您想要*全局*获取而不是全局获取？顺便说一句， apply 已弃用，请改用 fn(*args) 。

```
def memoize(fn):
    def get(key):
        return (False,)

    def vset(key, value):
        def newget(ky):
            if key==ky: return (True, value)
            return get(ky)
        get = newget

    def mfun(*args):
        cache = get(args)
        if (cache[0]): return cache[1]

        val = fn(*args)
        vset(args, val)
        return val

    return mfun

def fib(x):
    if x<2: return x
    return fib(x-1)+fib(x-2)

def fibm(x):
    if x<2: return x
    return fibm(x-1)+fibm(x-2)

fibm = memoize(fibm) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-04T15:39:47.203

我认为最好的方法是：

```
class Memoized(object):
    def __init__(self,func):
        self.cache = {}
        self.func = func
    def __call__(self,*args):
        if args in self.cache: return cache[args]
        else:
            self.cache[args] = self.func(*args)
            return self.cache[args] 
```

# web-applications - 带有子域的 Google Analytics（分析）目标

> ID：505561
> 
> 赞同：3
> 
> 时间：2009-02-03T00:13:55.573
> 
> 标签：web-applications, reporting, google-analytics

我们正在发布一个付费网络应用程序。我们有 Google Analytics（分析），并希望设置转化目标以查看谁注册了各个帐户。即什么人口购买最高计划等。问题是谷歌分析假设它正在跟踪一个域，并且我们的应用程序在几个子域上运行（signup.ourapp.com、accounts.ourapp.com、user-子域.ourapp.com）。

所以我的问题是：有没有办法在谷歌分析中使用通配符域，特别是在创建转换目标时？我们的目标看起来像这样：

1.  [http://www.ourapp.com/signup](http://www.ourapp.com/signup)
2.  [http://accounts.ourapp.com/signup/[plan-name]](http://accounts.ourapp.com/signup/[plan-name])（每个目标都会有所不同）
3.  [http://[user-account].ourapp.com/dashboard](http://[user-account].ourapp.com/dashboard)（目标）

Google Analytics 目标设置页面要求您输入目标的路径，而不是完整的 URL（即 /signup 而不是 www.ourapp.com/signup）。此外，我不确定您是否可以将 Google Analytics JavaScript 代码放在多个域上并让它正确跟踪。

有人对此有任何意见吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T00:25:14.397

以下是 Google 关于多个子域的常见问题解答的链接：

~~[http://www.google.com/support/analytics/bin/answer.py?answer=55524](http://www.google.com/support/analytics/bin/answer.py?answer=55524)~~

这是有关多个域的信息：

~~[http://www.google.com/support/analytics/bin/answer.py?hl=en&answer=55503](http://www.google.com/support/analytics/bin/answer.py?hl=en&answer=55503)~~

更新：看起来一切都在这里： [https ://developers.google.com/analytics/devguides/collection/gajs/gaTrackingSite](https://developers.google.com/analytics/devguides/collection/gajs/gaTrackingSite)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-02-06T05:10:53.173

对于其他找到此线程的人，最终的解决方案是使用“等于”，然后在没有 http:// 的情况下完整输入域

所以，www.domainname.com/xxx/ 或 domainname.com/xxx/

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-11T21:30:33.427

这是设置多个子域的绝佳[指南：](http://www.ericmobley.net/guide-to-tracking-multiple-subdomains-in-google-analytics/)

但是，我仍然在为您的原始问题而苦恼，如何在添加目标时输入 URI ...

# php - 在 PHP 中检测文件编码

> ID：505562
> 
> 赞同：28
> 
> 时间：2009-02-03T00:14:19.863
> 
> 标签：php, utf-8, character-encoding

我有一个脚本，它将多个文件合并为一个，当其中一个文件具有 UTF8 编码时它会中断。我认为我应该`utf8_decode()`在读取文件时使用该功能，但我不知道如何判断哪些需要解码。

我的代码基本上是：

```
$output = '';
foreach ($files as $filename) {
    $output .= file_get_contents($filename) . "\n";
}
file_put_contents('combined.txt', $output); 
```

目前，在 UTF8 文件的开头，它会在输出中添加这些字符：`ï»¿`

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-03T00:39:26.770

尝试使用该[`mb_detect_encoding`功能](http://www.php.net/manual/en/function.mb-detect-encoding.php)。此函数将检查您的字符串并尝试“猜测”它的编码是什么。然后，您可以根据需要对其进行转换。但是，正如[brulak 所建议](https://stackoverflow.com/questions/505562/detect-file-encoding-in-php#answer-505582)的那样，您最好转换*为*UTF-8 而不是*from*，以保留您正在传输的数据。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2013-02-26T22:24:54.810

为了确保输出是 UTF-8，无论它是什么类型的输入，我都使用这个[检查](http://www.php.net/manual/function.utf8-encode.php#102382)：

```
if(!mb_check_encoding($output, 'UTF-8')
    OR !($output === mb_convert_encoding(mb_convert_encoding($output, 'UTF-32', 'UTF-8' ), 'UTF-8', 'UTF-32'))) {

    $output = mb_convert_encoding($content, 'UTF-8', 'pass'); 
}

// $output is now safely converted to UTF-8! 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2015-03-10T18:58:19.723

`mb_detect_encoding`函数应该是你最后的选择。这可能会返回*错误*的编码。Linux 命令`file -i /path/myfile.txt`运行良好。在 PHP 中，您可以使用：

```
function _detectFileEncoding($filepath) {
    // VALIDATE $filepath !!!
    $output = array();
    exec('file -i ' . $filepath, $output);
    if (isset($output[0])){
        $ex = explode('charset=', $output[0]);
        return isset($ex[1]) ? $ex[1] : null;
    }
    return null;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-04-22T15:34:50.143

这是我的解决方案，它就像一个魅力：

```
//check string strict for encoding out of list of supported encodings
$enc = mb_detect_encoding($str, mb_list_encodings(), true);

if ($enc===false){
    //could not detect encoding
}
else if ($enc!=="UTF-8"){
    $str = mb_convert_encoding($str, "UTF-8", $enc);
}
else {
    //UTF-8 detected
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-09-17T09:53:00.773

对于 Linux 服务器，我使用以下命令：

```
$file = 'your/file.ext'
exec( "from=`file -bi $file | awk -F'=' '{print $2 }'` && iconv -f \$from -t utf-8 $file -o $file" ); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T00:20:39.117

您将如何处理 UTF-8 或 16 或 32 文件中的非 ASCII 字符？

我问是因为我认为您可能在这里遇到了设计问题。

我会将您的输出文件转换为 UTF-8（或 16 或 32），而不是相反。

那你就不会有这个问题了。

您是否还考虑过转换转义的 UTF-8 代码可能引起的安全问题？[看到这个评论](http://ca.php.net/manual/en/function.utf8-decode.php#83935)：

[检测多字节编码](http://ca.php.net/manual/en/function.utf8-decode.php#83935)

找出源文件的编码方式，然后将其转换为 UTF-8，然后就可以开始使用了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-06-25T21:30:40.200

我最近遇到了这个问题，`mb_convert_encoding()`函数输出是**UTF-8**。

在查看响应头后，没有任何提及编码类型，所以我发现*[Set HTTP header to UTF-8 using PHP](https://stackoverflow.com/a/4279294)*，它提出以下建议：

```
<?php
header('Content-Type: text/html; charset=utf-8'); 
```

将其添加到 PHP 文件的顶部后，所有时髦的字符都消失了，它呈现出应有的状态。我不确定这是否是原始发帖人正在寻找的问题，但我在尝试自己解决问题时发现了这一点，并认为我会分享。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-02-16T15:08:44.053

扫描所有文件，从 mb_list_encodings 中找到任何类型的编码，性能良好..

```
 function detectFileEncoding($filePath){

    $fopen=fopen($filePath,'r');

    $row = fgets($fopen);
    $encodings = mb_list_encodings();
    $encoding = mb_detect_encoding( $row, "UTF-8, ASCII, Windows-1252, Windows-1254" );//these are my favorite encodings

    if($encoding !== false) {
        $key = array_search($encoding, $encodings) !== false;
        if ($key !== false)
            unset($encodings[$key]);
        $encodings = array_values($encodings);
    }

    $encKey = 0;
    while ($row = fgets($fopen)) {
        if($encoding == false){
            $encoding = $encodings[$encKey++];
        }

        if(!mb_check_encoding($row, $encoding)){
            $encoding =false;
            rewind($fopen);
        }

    }

    return $encoding;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-12-23T12:48:05.377

```
<?php

$file = 'myfile.csv';

function detect_encoding($file){
    return mb_detect_encoding(file_get_contents($file), mb_list_encodings());
}

if ( detect_encoding($file) == 'ISO-8859-1' ) {
    echo "ISO-8859-1 detected";
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-03-18T11:36:21.753

你可以试试这个，我用下面的方法检查它是 ISO-8859-2 。我正在寻找波兰字符

```
public static function findEncoding($text)
 {
               $plUTF8 = array("ą","ę","ć","ż","ź","ł","ó","ń");                   

               //$lista = '437, 500, 500V1, 850, 851, 852, 855, 856, 857, 860, 861, 862, 863, 864, 865, 866, 866NAV, 869, 874, 904, 1026, 1046, 1047, 8859_1, 8859_2, 8859_3, 8859_4, 8859_5, 8859_6, 8859_7, 8859_8, 8859_9, 10646-1:1993, 10646-1:1993/UCS4, ANSI_X3.4-1968, ANSI_X3.4-1986, ANSI_X3.4, ANSI_X3.110-1983, ANSI_X3.110, ARABIC, ARABIC7, ARMSCII-8, ASCII, ASMO-708, ASMO_449, BALTIC, BIG-5, BIG-FIVE, BIG5-HKSCS, BIG5, BIG5HKSCS, BIGFIVE, BRF, BS_4730, CA, CN-BIG5, CN-GB, CN, CP-AR, CP-GR, CP-HU, CP037, CP038, CP273, CP274, CP275, CP278, CP280, CP281, CP282, CP284, CP285, CP290, CP297, CP367, CP420, CP423, CP424, CP437, CP500, CP737, CP770, CP771, CP772, CP773, CP774, CP775, CP803, CP813, CP819, CP850, CP851, CP852, CP855, CP856, CP857, CP860, CP861, CP862, CP863, CP864, CP865, CP866, CP866NAV, CP868, CP869, CP870, CP871, CP874, CP875, CP880, CP891, CP901, CP902, CP903, CP904, CP905, CP912, CP915, CP916, CP918, CP920, CP921, CP922, CP930, CP932, CP933, CP935, CP936, CP937, CP939, CP949, CP950, CP1004, CP1008, CP1025, CP1026, CP1046, CP1047, CP1070, CP1079, CP1081, CP1084, CP1089, CP1097, CP1112, CP1122, CP1123, CP1124, CP1125, CP1129, CP1130, CP1132, CP1133, CP1137, CP1140, CP1141, CP1142, CP1143, CP1144, CP1145, CP1146, CP1147, CP1148, CP1149, CP1153, CP1154, CP1155, CP1156, CP1157, CP1158, CP1160, CP1161, CP1162, CP1163, CP1164, CP1166, CP1167, CP1250, CP1251, CP1252, CP1253, CP1254, CP1255, CP1256, CP1257, CP1258, CP1282, CP1361, CP1364, CP1371, CP1388, CP1390, CP1399, CP4517, CP4899, CP4909, CP4971, CP5347, CP9030, CP9066, CP9448, CP10007, CP12712, CP16804, CPIBM861, CSA7-1, CSA7-2, CSASCII, CSA_T500-1983, CSA_T500, CSA_Z243.4-1985-1, CSA_Z243.4-1985-2, CSA_Z243.419851, CSA_Z243.419852, CSDECMCS, CSEBCDICATDE, CSEBCDICATDEA, CSEBCDICCAFR, CSEBCDICDKNO, CSEBCDICDKNOA, CSEBCDICES, CSEBCDICESA, CSEBCDICESS, CSEBCDICFISE, CSEBCDICFISEA, CSEBCDICFR, CSEBCDICIT, CSEBCDICPT, CSEBCDICUK, CSEBCDICUS, CSEUCKR, CSEUCPKDFMTJAPANESE, CSGB2312, CSHPROMAN8, CSIBM037, CSIBM038, CSIBM273, CSIBM274, CSIBM275, CSIBM277, CSIBM278, CSIBM280, CSIBM281, CSIBM284, CSIBM285, CSIBM290, CSIBM297, CSIBM420, CSIBM423, CSIBM424, CSIBM500, CSIBM803, CSIBM851, CSIBM855, CSIBM856, CSIBM857, CSIBM860, CSIBM863, CSIBM864, CSIBM865, CSIBM866, CSIBM868, CSIBM869, CSIBM870, CSIBM871, CSIBM880, CSIBM891, CSIBM901, CSIBM902, CSIBM903, CSIBM904, CSIBM905, CSIBM918, CSIBM921, CSIBM922, CSIBM930, CSIBM932, CSIBM933, CSIBM935, CSIBM937, CSIBM939, CSIBM943, CSIBM1008, CSIBM1025, CSIBM1026, CSIBM1097, CSIBM1112, CSIBM1122, CSIBM1123, CSIBM1124, CSIBM1129, CSIBM1130, CSIBM1132, CSIBM1133, CSIBM1137, CSIBM1140, CSIBM1141, CSIBM1142, CSIBM1143, CSIBM1144, CSIBM1145, CSIBM1146, CSIBM1147, CSIBM1148, CSIBM1149, CSIBM1153, CSIBM1154, CSIBM1155, CSIBM1156, CSIBM1157, CSIBM1158, CSIBM1160, CSIBM1161, CSIBM1163, CSIBM1164, CSIBM1166, CSIBM1167, CSIBM1364, CSIBM1371, CSIBM1388, CSIBM1390, CSIBM1399, CSIBM4517, CSIBM4899, CSIBM4909, CSIBM4971, CSIBM5347, CSIBM9030, CSIBM9066, CSIBM9448, CSIBM12712, CSIBM16804, CSIBM11621162, CSISO4UNITEDKINGDOM, CSISO10SWEDISH, CSISO11SWEDISHFORNAMES, CSISO14JISC6220RO, CSISO15ITALIAN, CSISO16PORTUGESE, CSISO17SPANISH, CSISO18GREEK7OLD, CSISO19LATINGREEK, CSISO21GERMAN, CSISO25FRENCH, CSISO27LATINGREEK1, CSISO49INIS, CSISO50INIS8, CSISO51INISCYRILLIC, CSISO58GB1988, CSISO60DANISHNORWEGIAN, CSISO60NORWEGIAN1, CSISO61NORWEGIAN2, CSISO69FRENCH, CSISO84PORTUGUESE2, CSISO85SPANISH2, CSISO86HUNGARIAN, CSISO88GREEK7, CSISO89ASMO449, CSISO90, CSISO92JISC62991984B, CSISO99NAPLPS, CSISO103T618BIT, CSISO111ECMACYRILLIC, CSISO121CANADIAN1, CSISO122CANADIAN2, CSISO139CSN369103, CSISO141JUSIB1002, CSISO143IECP271, CSISO150, CSISO150GREEKCCITT, CSISO151CUBA, CSISO153GOST1976874, CSISO646DANISH, CSISO2022CN, CSISO2022JP, CSISO2022JP2, CSISO2022KR, CSISO2033, CSISO5427CYRILLIC, CSISO5427CYRILLIC1981, CSISO5428GREEK, CSISO10367BOX, CSISOLATIN1, CSISOLATIN2, CSISOLATIN3, CSISOLATIN4, CSISOLATIN5, CSISOLATIN6, CSISOLATINARABIC, CSISOLATINCYRILLIC, CSISOLATINGREEK, CSISOLATINHEBREW, CSKOI8R, CSKSC5636, CSMACINTOSH, CSNATSDANO, CSNATSSEFI, CSN_369103, CSPC8CODEPAGE437, CSPC775BALTIC, CSPC850MULTILINGUAL, CSPC862LATINHEBREW, CSPCP852, CSSHIFTJIS, CSUCS4, CSUNICODE, CSWINDOWS31J, CUBA, CWI-2, CWI, CYRILLIC, DE, DEC-MCS, DEC, DECMCS, DIN_66003, DK, DS2089, DS_2089, E13B, EBCDIC-AT-DE-A, EBCDIC-AT-DE, EBCDIC-BE, EBCDIC-BR, EBCDIC-CA-FR, EBCDIC-CP-AR1, EBCDIC-CP-AR2, EBCDIC-CP-BE, EBCDIC-CP-CA, EBCDIC-CP-CH, EBCDIC-CP-DK, EBCDIC-CP-ES, EBCDIC-CP-FI, EBCDIC-CP-FR, EBCDIC-CP-GB, EBCDIC-CP-GR, EBCDIC-CP-HE, EBCDIC-CP-IS, EBCDIC-CP-IT, EBCDIC-CP-NL, EBCDIC-CP-NO, EBCDIC-CP-ROECE, EBCDIC-CP-SE, EBCDIC-CP-TR, EBCDIC-CP-US, EBCDIC-CP-WT, EBCDIC-CP-YU, EBCDIC-CYRILLIC, EBCDIC-DK-NO-A, EBCDIC-DK-NO, EBCDIC-ES-A, EBCDIC-ES-S, EBCDIC-ES, EBCDIC-FI-SE-A, EBCDIC-FI-SE, EBCDIC-FR, EBCDIC-GREEK, EBCDIC-INT, EBCDIC-INT1, EBCDIC-IS-FRISS, EBCDIC-IT, EBCDIC-JP-E, EBCDIC-JP-KANA, EBCDIC-PT, EBCDIC-UK, EBCDIC-US, EBCDICATDE, EBCDICATDEA, EBCDICCAFR, EBCDICDKNO, EBCDICDKNOA, EBCDICES, EBCDICESA, EBCDICESS, EBCDICFISE, EBCDICFISEA, EBCDICFR, EBCDICISFRISS, EBCDICIT, EBCDICPT, EBCDICUK, EBCDICUS, ECMA-114, ECMA-118, ECMA-128, ECMA-CYRILLIC, ECMACYRILLIC, ELOT_928, ES, ES2, EUC-CN, EUC-JISX0213, EUC-JP-MS, EUC-JP, EUC-KR, EUC-TW, EUCCN, EUCJP-MS, EUCJP-OPEN, EUCJP-WIN, EUCJP, EUCKR, EUCTW, FI, FR, GB, GB2312, GB13000, GB18030, GBK, GB_1988-80, GB_198880, GEORGIAN-ACADEMY, GEORGIAN-PS, GOST_19768-74, GOST_19768, GOST_1976874, GREEK-CCITT, GREEK, GREEK7-OLD, GREEK7, GREEK7OLD, GREEK8, GREEKCCITT, HEBREW, HP-GREEK8, HP-ROMAN8, HP-ROMAN9, HP-THAI8, HP-TURKISH8, HPGREEK8, HPROMAN8, HPROMAN9, HPTHAI8, HPTURKISH8, HU, IBM-803, IBM-856, IBM-901, IBM-902, IBM-921, IBM-922, IBM-930, IBM-932, IBM-933, IBM-935, IBM-937, IBM-939, IBM-943, IBM-1008, IBM-1025, IBM-1046, IBM-1047, IBM-1097, IBM-1112, IBM-1122, IBM-1123, IBM-1124, IBM-1129, IBM-1130, IBM-1132, IBM-1133, IBM-1137, IBM-1140, IBM-1141, IBM-1142, IBM-1143, IBM-1144, IBM-1145, IBM-1146, IBM-1147, IBM-1148, IBM-1149, IBM-1153, IBM-1154, IBM-1155, IBM-1156, IBM-1157, IBM-1158, IBM-1160, IBM-1161, IBM-1162, IBM-1163, IBM-1164, IBM-1166, IBM-1167, IBM-1364, IBM-1371, IBM-1388, IBM-1390, IBM-1399, IBM-4517, IBM-4899, IBM-4909, IBM-4971, IBM-5347, IBM-9030, IBM-9066, IBM-9448, IBM-12712, IBM-16804, IBM037, IBM038, IBM256, IBM273, IBM274, IBM275, IBM277, IBM278, IBM280, IBM281, IBM284, IBM285, IBM290, IBM297, IBM367, IBM420, IBM423, IBM424, IBM437, IBM500, IBM775, IBM803, IBM813, IBM819, IBM848, IBM850, IBM851, IBM852, IBM855, IBM856, IBM857, IBM860, IBM861, IBM862, IBM863, IBM864, IBM865, IBM866, IBM866NAV, IBM868, IBM869, IBM870, IBM871, IBM874, IBM875, IBM880, IBM891, IBM901, IBM902, IBM903, IBM904, IBM905, IBM912, IBM915, IBM916, IBM918, IBM920, IBM921, IBM922, IBM930, IBM932, IBM933, IBM935, IBM937, IBM939, IBM943, IBM1004, IBM1008, IBM1025, IBM1026, IBM1046, IBM1047, IBM1089, IBM1097, IBM1112, IBM1122, IBM1123, IBM1124, IBM1129, IBM1130, IBM1132, IBM1133, IBM1137, IBM1140, IBM1141, IBM1142, IBM1143, IBM1144, IBM1145, IBM1146, IBM1147, IBM1148, IBM1149, IBM1153, IBM1154, IBM1155, IBM1156, IBM1157, IBM1158, IBM1160, IBM1161, IBM1162, IBM1163, IBM1164, IBM1166, IBM1167, IBM1364, IBM1371, IBM1388, IBM1390, IBM1399, IBM4517, IBM4899, IBM4909, IBM4971, IBM5347, IBM9030, IBM9066, IBM9448, IBM12712, IBM16804, IEC_P27-1, IEC_P271, INIS-8, INIS-CYRILLIC, INIS, INIS8, INISCYRILLIC, ISIRI-3342, ISIRI3342, ISO-2022-CN-EXT, ISO-2022-CN, ISO-2022-JP-2, ISO-2022-JP-3, ISO-2022-JP, ISO-2022-KR, ISO-8859-1, ISO-8859-2, ISO-8859-3, ISO-8859-4, ISO-8859-5, ISO-8859-6, ISO-8859-7, ISO-8859-8, ISO-8859-9, ISO-8859-9E, ISO-8859-10, ISO-8859-11, ISO-8859-13, ISO-8859-14, ISO-8859-15, ISO-8859-16, ISO-10646, ISO-10646/UCS2, ISO-10646/UCS4, ISO-10646/UTF-8, ISO-10646/UTF8, ISO-CELTIC, ISO-IR-4, ISO-IR-6, ISO-IR-8-1, ISO-IR-9-1, ISO-IR-10, ISO-IR-11, ISO-IR-14, ISO-IR-15, ISO-IR-16, ISO-IR-17, ISO-IR-18, ISO-IR-19, ISO-IR-21, ISO-IR-25, ISO-IR-27, ISO-IR-37, ISO-IR-49, ISO-IR-50, ISO-IR-51, ISO-IR-54, ISO-IR-55, ISO-IR-57, ISO-IR-60, ISO-IR-61, ISO-IR-69, ISO-IR-84, ISO-IR-85, ISO-IR-86, ISO-IR-88, ISO-IR-89, ISO-IR-90, ISO-IR-92, ISO-IR-98, ISO-IR-99, ISO-IR-100, ISO-IR-101, ISO-IR-103, ISO-IR-109, ISO-IR-110, ISO-IR-111, ISO-IR-121, ISO-IR-122, ISO-IR-126, ISO-IR-127, ISO-IR-138, ISO-IR-139, ISO-IR-141, ISO-IR-143, ISO-IR-144, ISO-IR-148, ISO-IR-150, ISO-IR-151, ISO-IR-153, ISO-IR-155, ISO-IR-156, ISO-IR-157, ISO-IR-166, ISO-IR-179, ISO-IR-193, ISO-IR-197, ISO-IR-199, ISO-IR-203, ISO-IR-209, ISO-IR-226, ISO/TR_11548-1, ISO646-CA, ISO646-CA2, ISO646-CN, ISO646-CU, ISO646-DE, ISO646-DK, ISO646-ES, ISO646-ES2, ISO646-FI, ISO646-FR, ISO646-FR1, ISO646-GB, ISO646-HU, ISO646-IT, ISO646-JP-OCR-B, ISO646-JP, ISO646-KR, ISO646-NO, ISO646-NO2, ISO646-PT, ISO646-PT2, ISO646-SE, ISO646-SE2, ISO646-US, ISO646-YU, ISO2022CN, ISO2022CNEXT, ISO2022JP, ISO2022JP2, ISO2022KR, ISO6937, ISO8859-1, ISO8859-2, ISO8859-3, ISO8859-4, ISO8859-5, ISO8859-6, ISO8859-7, ISO8859-8, ISO8859-9, ISO8859-9E, ISO8859-10, ISO8859-11, ISO8859-13, ISO8859-14, ISO8859-15, ISO8859-16, ISO11548-1, ISO88591, ISO88592, ISO88593, ISO88594, ISO88595, ISO88596, ISO88597, ISO88598, ISO88599, ISO88599E, ISO885910, ISO885911, ISO885913, ISO885914, ISO885915, ISO885916, ISO_646.IRV:1991, ISO_2033-1983, ISO_2033, ISO_5427-EXT, ISO_5427, ISO_5427:1981, ISO_5427EXT, ISO_5428, ISO_5428:1980, ISO_6937-2, ISO_6937-2:1983, ISO_6937, ISO_6937:1992, ISO_8859-1, ISO_8859-1:1987, ISO_8859-2, ISO_8859-2:1987, ISO_8859-3, ISO_8859-3:1988, ISO_8859-4, ISO_8859-4:1988, ISO_8859-5, ISO_8859-5:1988, ISO_8859-6, ISO_8859-6:1987, ISO_8859-7, ISO_8859-7:1987, ISO_8859-7:2003, ISO_8859-8, ISO_8859-8:1988, ISO_8859-9, ISO_8859-9:1989, ISO_8859-9E, ISO_8859-10, ISO_8859-10:1992, ISO_8859-14, ISO_8859-14:1998, ISO_8859-15, ISO_8859-15:1998, ISO_8859-16, ISO_8859-16:2001, ISO_9036, ISO_10367-BOX, ISO_10367BOX, ISO_11548-1, ISO_69372, IT, JIS_C6220-1969-RO, JIS_C6229-1984-B, JIS_C62201969RO, JIS_C62291984B, JOHAB, JP-OCR-B, JP, JS, JUS_I.B1.002, KOI-7, KOI-8, KOI8-R, KOI8-RU, KOI8-T, KOI8-U, KOI8, KOI8R, KOI8U, KSC5636, L1, L2, L3, L4, L5, L6, L7, L8, L10, LATIN-9, LATIN-GREEK-1, LATIN-GREEK, LATIN1, LATIN2, LATIN3, LATIN4, LATIN5, LATIN6, LATIN7, LATIN8, LATIN9, LATIN10, LATINGREEK, LATINGREEK1, MAC-CENTRALEUROPE, MAC-CYRILLIC, MAC-IS, MAC-SAMI, MAC-UK, MAC, MACCYRILLIC, MACINTOSH, MACIS, MACUK, MACUKRAINIAN, MIK, MS-ANSI, MS-ARAB, MS-CYRL, MS-EE, MS-GREEK, MS-HEBR, MS-MAC-CYRILLIC, MS-TURK, MS932, MS936, MSCP949, MSCP1361, MSMACCYRILLIC, MSZ_7795.3, MS_KANJI, NAPLPS, NATS-DANO, NATS-SEFI, NATSDANO, NATSSEFI, NC_NC0010, NC_NC00-10, NC_NC00-10:81, NF_Z_62-010, NF_Z_62-010_(1973), NF_Z_62-010_1973, NF_Z_62010, NF_Z_62010_1973, NO, NO2, NS_4551-1, NS_4551-2, NS_45511, NS_45512, OS2LATIN1, OSF00010001, OSF00010002, OSF00010003, OSF00010004, OSF00010005, OSF00010006, OSF00010007, OSF00010008, OSF00010009, OSF0001000A, OSF00010020, OSF00010100, OSF00010101, OSF00010102, OSF00010104, OSF00010105, OSF00010106, OSF00030010, OSF0004000A, OSF0005000A, OSF05010001, OSF100201A4, OSF100201A8, OSF100201B5, OSF100201F4, OSF100203B5, OSF1002011C, OSF1002011D, OSF1002035D, OSF1002035E, OSF1002035F, OSF1002036B, OSF1002037B, OSF10010001, OSF10010004, OSF10010006, OSF10020025, OSF10020111, OSF10020115, OSF10020116, OSF10020118, OSF10020122, OSF10020129, OSF10020352, OSF10020354, OSF10020357, OSF10020359, OSF10020360, OSF10020364, OSF10020365, OSF10020366, OSF10020367, OSF10020370, OSF10020387, OSF10020388, OSF10020396, OSF10020402, OSF10020417, PT, PT2, PT154, R8, R9, RK1048, ROMAN8, ROMAN9, RUSCII, SE, SE2, SEN_850200_B, SEN_850200_C, SHIFT-JIS, SHIFT_JIS, SHIFT_JISX0213, SJIS-OPEN, SJIS-WIN, SJIS, SS636127, STRK1048-2002, ST_SEV_358-88, T.61-8BIT, T.61, T.618BIT, TCVN-5712, TCVN, TCVN5712-1, TCVN5712-1:1993, THAI8, TIS-620, TIS620-0, TIS620.2529-1, TIS620.2533-0, TIS620, TS-5881, TSCII, TURKISH8, UCS-2, UCS-2BE, UCS-2LE, UCS-4, UCS-4BE, UCS-4LE, UCS2, UCS4, UHC, UJIS, UK, UNICODE, UNICODEBIG, UNICODELITTLE, US-ASCII, US, UTF-7, UTF-8, UTF-16, UTF-16BE, UTF-16LE, UTF-32, UTF-32BE, UTF-32LE, UTF7, UTF8, UTF16, UTF16BE, UTF16LE, UTF32, UTF32BE, UTF32LE, VISCII, WCHAR_T, WIN-SAMI-2, WINBALTRIM, WINDOWS-31J, WINDOWS-874, WINDOWS-936, WINDOWS-1250, WINDOWS-1251, WINDOWS-1252, WINDOWS-1253, WINDOWS-1254, WINDOWS-1255, WINDOWS-1256, WINDOWS-1257, WINDOWS-1258, WINSAMI2, WS2, YU';                    
               $lista = array('WINDOWS-1250',"CP852","CP850","ISO-8859-2","ISO-8859-1","UTF-8");

               $wyniki = array();
               foreach($lista as $ixL => $code)
               {
                   $wyniki[] = array('code'=>$code, 'result'=>0, 'text' => iconv(  $code, 'UTF-8//IGNORE', $text) );
               }

               foreach($plUTF8 as $ixxx => $char)
               {
                 foreach ($wyniki as $wX => $wRes)  
                 {
                       if(is_numeric(strpos($wRes['text'], $char) ))
                       {
                          $wyniki[$wX]['result']++;
                       }
                 }                                          
               }

               $findInx = 0;
               $max     = 0;

                foreach ($wyniki as $wX => $wRes)  
                 {
                      if($wyniki[$wX]['result'] > $max)
                      {
                          $max = $wyniki[$wX]['result'];
                          $findInx = $wX;
                      }
                 } 

               $encodingIn =$wyniki[$findInx]['code'];
               $encodingOut ='UTF-8';

              // $ret = iconv(  $encodingIn, $encodingOut, $text);
              // return $ret;
               return $encodingIn;

 } 
```

# c# - 加载自定义配置文件

> ID：505566
> 
> 赞同：127
> 
> 时间：2009-02-03T00:15:40.687
> 
> 标签：c#, configuration

我知道我可以使用静态方法打开与程序集相关的配置文件，`ConfigurationManager.OpenExe(exePath)`但我只想打开与程序集无关的配置。只是一个标准的 .NET 配置文件。

* * *

## 回答 #1

> 赞同：259
> 
> 时间：2009-02-03T10:27:31.670

Ricky 发表的文章非常好，但遗憾的是它们没有回答您的问题。

要解决您的问题，您应该尝试以下代码：

```
ExeConfigurationFileMap configMap = new ExeConfigurationFileMap();
configMap.ExeConfigFilename = @"d:\test\justAConfigFile.config.whateverYouLikeExtension";
Configuration config = ConfigurationManager.OpenMappedExeConfiguration(configMap, ConfigurationUserLevel.None); 
```

如果需要访问配置中的值，您可以使用索引运算符：

```
config.AppSettings.Settings["test"].Value; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-03T00:21:09.430

配置文件只是一个 XML 文件，您可以通过以下方式打开它：

```
private static XmlDocument loadConfigDocument()
{
    XmlDocument doc = null;
    try
    {
        doc = new XmlDocument();
        doc.Load(getConfigFilePath());
        return doc;
    }
    catch (System.IO.FileNotFoundException e)
    {
        throw new Exception("No configuration file found.", e);
    }
    catch (Exception ex)
    {
        return null;
    }
} 
```

然后通过以下方式检索值：

```
 // retrieve appSettings node

    XmlNode node =  doc.SelectSingleNode("//appSettings"); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-04-08T15:44:01.680

我会用[`ConfigurationManager.OpenMappedExeConfiguration`](https://docs.microsoft.com/en-us/dotnet/api/system.configuration.configurationmanager.openmappedexeconfiguration?view=netframework-4.8#overloads).

# c++ - 使用 gcc 编译 DLL

> ID：505567
> 
> 赞同：13
> 
> 时间：2009-02-03T00:16:15.943
> 
> 标签：c++, dll, gcc

Sooooo 我正在写一个脚本解释器。基本上，我希望将一些类和函数存储在 DLL 中，但我希望 DLL 在链接到它的程序中查找函数，例如，

```
 program                dll
----------------------------------------------------
send code to dll----->    parse code
                              |
                              v
                          code contains a function,
                          that isn't contained in the DLL
                              |
list of functions in   <------/
program
      |
      v
corresponding function,
user-defined in the
program--process the
passed argument here
      |
      \-------------->    return value sent back
                          to the parsing function 
```

我基本上想知道，如何用 gcc 编译 DLL？好吧，我正在使用 gcc 的 windows 端口。一旦我编译了一个包含我的类和函数的 .dll，我如何用我的程序链接到它？如何使用 DLL 中的类和函数？DLL 可以从链接到它的程序中调用函数吗？如果我创建一个类 { ... } 对象；在DLL中，那么当程序加载DLL时，程序是否可以使用对象？在此先感谢，在继续这个项目之前，我真的需要知道如何在 C++ 中使用 DLL。

“您能否详细说明为什么您希望 DLL 调用主程序中的函数？”

我认为图表有点解释它......使用DLL的程序将一段代码传递给DLL，DLL解析代码，如果在所述代码中找到函数调用，则调用DLL中的相应函数......例如，如果我传递了“a = sqrt(100)”，那么 DLL 解析器函数将找到对 sqrt() 的函数调用，并且在 DLL 中将有一个相应的 sqrt() 函数，该函数将计算参数的平方根传递给它，然后它将从该函数获取返回值并将其放入变量 a... 就像任何其他程序一样，但是如果 sqrt() 函数的相应处理程序不是如果在 DLL 中找到 t（将有一个本地支持的函数列表），那么它将调用一个类似的函数，该函数将驻留在使用 DLL 的程序中，以查看是否有任何使用该名称的用户定义函数。

它会返回错误代码或NULL或其他东西）。我开始看到我必须找到另一种方法来解决这个问题，以使函数调用仅以一种方式进行

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T00:39:45.680

[此链接](http://www.cygwin.com/cygwin-ug-net/dll.html)解释了如何以基本方式进行操作。

在大图视图中，当你制作一个 dll 时，你正在制作一个在运行时加载的库。它包含许多导出的符号。这些符号通常是对方法或函数的引用，以及编译器/链接器 goo。

当您通常构建静态库时，goo 最少，链接器会提取它需要的代码并在可执行文件中为您重新打包它。

在一个 dll 中，你实际上得到了两个最终产品（三个真的——等等）：一个 dll 和一个存根库。存根是一个静态库，看起来与您的常规静态库完全一样，除了不是执行您的代码，每个存根通常是一个通用例程的跳转指令。通用例程加载您的 dll，获取您要调用的例程的地址，然后修补原始跳转指令以到达那里，因此当您再次调用它时，您最终会进入您的 dll。

第三个最终产品通常是一个头文件，它告诉您有关库中数据类型的所有信息。

所以你的步骤是：创建你的头文件和代码，构建一个dll，从头文件/代码/导出函数的一些列表中构建一个存根库。结束代码将链接到将加载 dll 并修复跳转表的存根库。

编译器/链接器 goo 包括确保运行时库位于需要它们的位置、确保执行静态构造函数、确保注册静态析构函数以供以后执行等内容。

现在至于您的主要问题：如何在 dll 中编写可扩展代码？有许多可能的方法——一种典型的方法是定义一个定义行为的纯抽象类（又名接口），然后将其传递给处理例程，或者创建一个例程来注册接口以完成工作，然后处理例程要求注册商提供一个对象来为其处理一项工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T06:01:17.167

关于您计划解决的细节，也许您应该查看像 lua 这样的可扩展解析器，而不是构建自己的解析器。

到你更具体的焦点。
DLL（通常？）意味着它本身是完整的，或者明确知道要使用哪些其他库来完成自身。

我的意思是，您不能让调用应用程序隐式提供方法来完成 DLL 功能。

但是，您可以在 API 的一部分中提供来自调用应用程序的方法，从而使 DLL 完全包含并明确传递知识。

**如何使用 DLL 中的类和函数？**
在代码中包含标头，当模块（exe 或其他 dll）被链接时，会检查 dll 的完整性。

**DLL 可以从链接到它的程序中调用函数吗？**
是的，但必须在运行时告知它们。

**如果我创建一个类 { ... } 对象；在DLL中，那么当程序加载DLL时，程序是否可以使用对象？**
是的，它将可用，但是您需要注意一些限制。例如在内存管理领域，重要的是：

*   使用相同的内存管理 dll（通常是 c 运行时）链接所有共享内存的模块
*   确保仅在同一模块中分配和释放内存。
*   在栈上分配

例子！
这是将函数传递给 dll 的基本思想，但是在您的情况下可能不是最有帮助的，因为您需要预先知道要提供哪些其他函数。

```
// parser.h
struct functions {
  void *fred (int );
};

parse( string, functions );

// program.cpp
parse( "a = sqrt(); fred(a);", functions ); 
```

您需要的是一种注册函数（及其在 dll 中的详细信息）的方法。这里更大的问题是细节位。但是跳过这一点，您可能会像 wxWidgets 那样对类注册做一些事情。当您的应用程序构建 method_fred 时，它将调用构造函数并通过使用关闭 methodInfo 向 dll 注册。解析器可以查找 methodInfo 以获得可用的方法。

```
// parser.h
class method_base { };
class methodInfo {
   static void register(factory);
   static map<string,factory> m_methods;
}

// program.cpp
class method_fred : public method_base {
   static method* factory(string args);
   static methodInfo _methoinfo;
}
methodInfo method_fred::_methoinfo("fred",method_fred::factory); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T20:50:55.560

Winrawr，在您继续之前，**请先阅读以下内容**：

[GCC/Windows DLLs/C++ STL 前端有什么改进吗？](https://stackoverflow.com/questions/512841/any-improvements-on-the-gcc-windows-dlls-c-stl-front)

基本上，**在围绕 DLL 传递 STL 字符串时，您可能会遇到问题**，并且您也可能会遇到跨越 DLL 边界的异常问题，尽管这不是我（还）经历过的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T20:43:22.253

这听起来像是数据结构的工作。

创建一个包含关键字和与每个关键字关联的函数的结构。

```
struct keyword {
    const char *keyword;
    int (*f)(int arg);
};

struct keyword keywords[max_keywords] = {
    "db_connect", &db_connect,
} 
```

然后在您的 DLL 中编写一个函数，将该数组的地址传递给：

```
plugin_register(keywords); 
```

然后在 DLL 中它可以执行以下操作：

```
keywords[0].f = &plugin_db_connect; 
```

使用这种方法，处理脚本关键字的代码保留在主程序中，而 DLL 操作数据结构以调用自己的函数。

将它带到 C++ 中，使结构成为一个类，而不是包含 std::vector 或 std::map 或任何关键字和一些操作它们的函数。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-02-03T00:22:50.237

[您总是可以在运行时使用加载库](http://msdn.microsoft.com/en-us/library/ms684175.aspx)加载 dll

# .net - 如何让 System.Windows.ShowDialog() 返回“true”？

> ID：505572
> 
> 赞同：46
> 
> 时间：2009-02-03T00:17:39.450
> 
> 标签：.net, wpf, dialog

我如何才能`System.Windows.ShowDialog()`返回“真”？

我对此有点陌生。 `System.Windows.ShowDialog`的返回类型是`bool`? 它应该`true`在您击中时返回`Submit`，并且`false`在您击中时返回`Cancel`。但我不确定如何指定哪个`Button`是官方提交按钮。

编辑：在相关说明中，我很好奇它如何返回 null。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-02-03T00:21:37.260

[http://msdn.microsoft.com/en-us/library/system.windows.window.showdialog.aspx](http://msdn.microsoft.com/en-us/library/system.windows.window.showdialog.aspx)

> ShowDialog 返回一个`Nullable<Boolean>`值，该值指定活动是被接受还是被取消。返回值是窗口关闭之前 DialogResult 属性的值（请参阅 DialogResult）。

基本上，您通过设置 DialogResult 的值来决定，而不是通过点击特定按钮来决定 - 您决定按钮的作用。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-03T00:23:01.953

在 WPF 中，将[Button.IsDefault](http://msdn.microsoft.com/en-us/library/system.windows.controls.button.isdefault.aspx)属性设置为 true 以指定按钮是窗口的“提交”按钮。我不是 100% 确定这会使窗口关闭，DialogResult 为 true。如果没有，您只需要这样处理它的 Click 事件：

```
this.DialogResult = true; 
```

**编辑**

同样，您可以使用[Button.IsCancel](http://msdn.microsoft.com/en-us/library/system.windows.controls.button.iscancel.aspx)属性使按钮成为表单的“取消”按钮。

**编辑 2**

我相信 ShowDialog 可以为空的原因是因为在提交或取消表单之前它是空的，如果你在后台线程中观看对话框，你可以测试它。我没有尝试过，但这似乎是他们将第三个“未知”（null）状态引入该属性的合乎逻辑的原因。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-03T13:12:07.517

如果将 DialogResult 设置为 true ShowDialog 返回 true，如果将 DialogResult 设置为 false ShowDialog 返回 false 如果在未设置 DialogResult 的情况下关闭对话框（用户单击右上角的红色 X） ShowDialog 将返回 null。

将 IsDefault 设置为 true 将导致按钮看起来有点不同，按 enter 将“单击”此按钮。

如果将 IsCancel 设置为 true，则按下 esc 将“单击”此按钮。

# asp.net-mvc - 分组控制器

> ID：505589
> 
> 赞同：0
> 
> 时间：2009-02-03T00:23:39.283
> 
> 标签：asp.net-mvc, controllers

在 Visual Studio 2008 项目中，如何构造他的控制器以在以下指令中访问？

[http://localhost/MyWebsite/api/users/get/1](http://localhost/MyWebsite/api/users/get/1)

/api/ 和 /users/ 都是控制器“get”，是“users”的方法，参数为 1

本质上，我说的是实现 REST 我会假设。

有任何想法吗？

谢谢，尼克

## 固定的

Phil Haack 开发了一个名为 Areas 的扩展，它允许将他的控制器分组到一个 ASP.Net MVC 项目中。 [分组控制器](http://haacked.com/archive/2008/11/04/areas-in-aspnetmvc.aspx)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T00:51:54.733

您将需要设置自己的自定义路线。有关更多详细信息，请参阅[本教程](http://www.asp.net/learn/mvc/tutorial-05-cs.aspx)。将此与 AcceptVerbs 属性结合起来以实现 REST 功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T00:56:03.850

如果您要使用 REST api 不应该是控制器，api 是一种访问您的用户的方法。另一个是html。

您的路线应该是 localhost/user/1 - 我个人会离开。它不是描述性的，您可以获取用户列表或单个用户。如果您想要一些东西，请使用详细信息。然后在您的控制器中，您根据调用者是谁（api vs html）适当地响应请求。

ktrauberman 是对的，当开始嵌套路由时，您必须在 global.asax 中使用自定义路由。这方面的一个例子是：

本地主机/用户/{userId}/地址/{addressId}

凯尔

# c++ - 在不阻塞资源的情况下高效地等待标志状态更改？

> ID：505593
> 
> 赞同：1
> 
> 时间：2009-02-03T00:24:58.267
> 
> 标签：c++, windows, visual-studio-2008, performance

线程在循环中**无限**等待，直到**标志状态**改变，然后调用函数。

**伪代码说明：**

```
while (true)
{
    while (!flag)
    {
            sleep(1);
    }
    clean_upfunction();
} 
```

**目前**：

*   [**仅使用 C 运行时库**](http://msdn.microsoft.com/en-us/library/abx4dbyh(VS.80).aspx)的多线程版本[](http://msdn.microsoft.com/en-us/library/abx4dbyh(VS.80).aspx)

 ****不：**

*   MFC

**问题：**

*   有没有更有效的方法来实现上述
*   线程库中的 waitForStateChange() - 类似于上面

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-03T00:30:18.537

对于 Windows（您已为此标记），您需要查看[WaitForSingleObject](http://msdn.microsoft.com/en-us/library/ms687032.aspx)。使用 Windows 事件（使用 CreateEvent），然后等待它；另一个线程应该调用 SetEvent。所有原生 Windows，无需 MFC 或其他任何东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T01:59:08.780

如果您不在 Windows 上，而是在 POSIXish 盒子上，`pthread_cond_wait`那么是最好的匹配：

```
/* signaler */
    pthread_mutex_lock(mutex);
    flag = true;
    pthread_cond_signal(cond);
    pthread_mutex_unlock(mutex);

/* waiter */
    pthread_mutex_lock(mutex);
    do {
        pthread_cond_wait(cond, mutex);
    } while (!flag);
    pthread_mutex_unlock(mutex); 
```

不过，经典的 self-pipe 技巧更简单、更酷 :)`pthreads`也适用于没有的系统。

```
/* setup */
    int pipefd[2];
    if (pipe(pipefd) < 0) {
        perror("pipe failed");
        exit(-1);
    }

/* signaler */
    char byte = 0;
    write(pipefd[0], &byte, 1);  // omitting error handling for brevity

/* waiter */
    char byte;
    read(pipefd[1], &byte, 1);  // omitting error handling for brevity 
```

服务员将阻塞`read`（您没有设置`O_NONBLOCK`）直到被中断（这就是您应该进行错误处理的原因）或信号员写入一个字节。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T14:13:20.153

看看 Boost.Thread 中的 condition_variable。

[http://www.boost.org/doc/libs/1_37_0/doc/html/thread/synchronization.html#thread.synchronization.condvar_ref](http://www.boost.org/doc/libs/1_37_0/doc/html/thread/synchronization.html#thread.synchronization.condvar_ref)

它是可移植的，比特定于平台的选项更易于使用。此外，IIUC，即将推出的 C++0x std::condition_variable 也是以它为蓝本的。

# java - SWT 中的自定义小部件形状

> ID：505599
> 
> 赞同：2
> 
> 时间：2009-02-03T00:27:28.777
> 
> 标签：java, user-interface, swt

我正在尝试研究如何使 SWT 小部件（例如标签、框架）成为矩形以外的其他形状。

我使用 setRegion() 方法制作了一个自定义形状的主窗口。现在我希望窗口中的小部件遵循相同的形状。我尝试在小部件本身上使用 setRegion() 方法（它们继承它）但没有任何反应。

如何使 SWT 小部件具有自定义形状？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T02:30:47.293

我已经设法解决了。我的困难似乎源于对如何定义自定义区域的误解。setBounds() 方法定义了自定义区域的坐标系。我假设 region 和 setBounds 使用相同的坐标系，结果根本没有显示小部件。

图片显示效果。左边的绿色标签像主窗口一样弯曲，而右下角的灰色框则没有。

图片出现在预览中，但不是发布的答案，请尝试： http://img87.imageshack.us/my.php?image= [curvecroppedwf8.png](http://img87.imageshack.us/my.php?image=curvecroppedwf8.png)

执行此操作的代码片段：

```
Display display = Display.getDefault();
Shell shell new Shell(display, SWT.NO_TRIM | SWT.ON_TOP);

// make the region for the main window
// circle is a method that returns a list of points defining a circle
Region region = new Region();
region.add(350, 0, 981, 51);
region.add(circle(380,51,30));
region.add(circle(951,51,30));
region.add(380, 51, 571, 30);
shell.setRegion(region);
Rectangle rsize = region.getBounds();
shell.setSize(rsize.width, rsize.height);

Composite main = new Composite(shell, SWT.NULL);

// make the label
cpyLbl = new Label(main, SWT.NONE);
cpyLbl.setText("Copy");

cpyLbl.setBackground(SWTResourceManager.getColor(38,255,23));

Region cpyRegion = new Region();
cpyRegion.add(0, 0, 161, 51);
cpyRegion.add(circle(28,51,28));
cpyRegion.add(28, 51, 133, 28);
cpyLbl.setRegion(cpyRegion);

// the top left of the bounds is the 0,0 of the region coordinates
// bounds are in screen coordinates (maybe shell coordinates?)
cpyLbl.setBounds(352, 0, 161, 79);
cpyLbl.setVisible(true); 
```

# security - SSAS 2008 帐户规定

> ID：505606
> 
> 赞同：0
> 
> 时间：2009-02-03T00:31:28.847
> 
> 标签：security, sql-server-2008, ssas

在 SSAS 2008 安装期间，帐户设置工具出现，您可以选择当前的 Windows 用户（或其他 Windows 用户）。但是，在将另一个用户添加为管理员之前，该帐户已被删除。2005 年，该工具存在于服务器上，可以手动运行，但我在 2008 年没有看到它。

我假设我可以卸载并重新安装来执行此操作，但是还有其他方法可以添加管理员帐户吗？

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-04T03:49:01.287

默认情况下，在服务器上具有本地管理员权限的帐户也将是 SSAS 管理员，因此此类帐户应该能够在 Management Studio 中访问服务器并将其他用户添加为 SSAS 管理员。

如果关闭此选项，服务器管理员始终可以导航到 ..\Program Files\Microsoft SQL Server\MSSQL.X\OLAP\Config\ 并将 msmdsrv.ini 文件中的 BuiltinAdminsAreServerAdmins 设置从 0 更改为 1，然后重新启动 SSAS服务，然后在 Management Studio 中添加其他管理员。

# .net - Binary Deserialization with different assembly version

> ID：505611
> 
> 赞同：27
> 
> 时间：2009-02-03T00:33:57.593
> 
> 标签：.net, serialization, binaryformatter, assemblyversions

I have a project which uses BinaryFormatter to serialize a collection of structs with string and bool? datatypes.

The serialization/deserialization works fine, however if I were to change the assembly which does the work it fails to deserialize because of the header in the binary file indicating that it requires `Assembly x` instead of `Assembly y` to handle the data.

Is it possible to setup the serialization/deserialization to be assembly agnostic?

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-03T20:38:48.737

You can control how the binary formatter resolves its types by assigning a custom SerializationBinder to the formatter. In this way, you won't need to mess with the AppDomain's resolve events and you eliminate the risk of unexpected side effects from that.

There is a detailed example at [MSDN](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.formatters.binary.binaryformatter.binder.aspx).

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-10-12T05:48:13.850

You can change your BinaryFormatter property AssemblyFormat to make serialization independent of assembly version.

```
// Example
var binFormat = new BinaryFormatter();
binFormat.AssemblyFormat = System.Runtime.Serialization.Formatters.FormatterAssemblyStyle.Simple; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-03T00:38:20.643

Hook into the AppDomain.OnAssemblyResolve event and fix-up the assembly names

```
private System.Reflection.Assembly OnAssemblyResolve( System.Object sender, System.ResolveEventArgs reArgs )
{
     foreach( System.Reflection.Assembly assembly in System.AppDomain.CurrentDomain.GetAssemblies() ) 
     {
         System.Reflection.AssemblyName assemblyName = assembly.GetName();
         if( assemblyName.FullName == reArgs.Name ) 
         {
              return( assembly );
         }
     }
} 
```

source: [http://osdir.com/ml/windows.devel.dotnet.clr/2003-12/msg00441.html](http://osdir.com/ml/windows.devel.dotnet.clr/2003-12/msg00441.html)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-03T01:40:44.260

There are altenative (binary) serialization engines ([like this](http://code.google.com/p/protobuf-net/)) that aren't assembly dependent.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T01:06:08.747

The GAC is your first resource, allowing different versions of the assembly to co-exist side-by-side. But that doesn't really solve anything unless your app is version tolerant too. Binary serialization has several features to handle version tolerant serialization. Read about it in this MSDN [library article](http://msdn.microsoft.com/en-us/library/ms229752(VS.80).aspx).

# c# - 带有 Web 服务的标志

> ID：505617
> 
> 赞同：6
> 
> 时间：2009-02-03T00:36:12.083
> 
> 标签：c#, .net, web-services, flags

我有一个位于 Web 服务后面的标志属性枚举，如下所示：

```
[Serializable,Flags]
public enum AccessLevels
{
    None = 0,
    Read = 1,
    Write = 2,
    Full = Read | Write
} 
```

我的问题是我的 Web 服务的使用者没有枚举的原始常量值。生成的代理类客户端具有相当于此的内容：

```
{
   None = 1,
   Read = 2,
   Write = 4,
   Full = 8
} 
```

因此，当消费者检查“读取”访问权限时，即使“testItem”为“完整”，这也是错误的

```
((testItem & Svc.Read) == Svc.Read) 
```

如何通过 Web 服务正确提供标志？

编辑：

根据[这篇](http://ikriv.com:8765/en/prog/info/dotnet/WebServices_and_Enums.html)文章，可能无法做我想做的事情。伊万·克里维亚科夫说

> 枚举的不完全透明度
> 
> 事实证明，枚举并不像我们希望的那样透明。存在三个棘手的问题：
> 
> 1.  如果服务器端代码声明一个枚举并为其成员分配特定的数值，则这些值对客户端将不可见。
> 2.  如果服务器端代码声明了一个带有“复合”掩码值的 [Flags] 枚举（如 White = Red|Green|Blue），则它不会正确反映在客户端。
> 3.  如果服务器或客户端传输超出枚举范围的“非法”值，则会在另一端的 XML 反序列化器中引发异常。

所以我想知道这是否只是一个限制，是不可能的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-04T01:01:24.387

我对此进行了广泛的研究，发现不可能通过 Web 服务序列化枚举常量。请注意，要实现您的目标，您不需要枚举 None 或 Full。这两个枚举可以用读/写组合来暗示：

如果你的 AccessLevels = Read | 你可以假设完全访问。如果您的 AccessLevels = 0 [无]，则写入且无

您的枚举将如下所示：

```
[Serializable,Flags]
public enum AccessLevels
{
    Read = 1,
    Write = 2
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T00:41:29.967

我遇到了类似的问题，并通过添加另一个 Web 服务首先返回正确的标志值来解决它。

然后这些成为我在比较中使用的值。

可能不是最干净的解决方案，但它有效。

编辑：

我最初的回答建议将值作为单独的 Web 服务而不是在枚举中传递。

但是，四处寻找，似乎 0,1,2 的枚举在 Web 服务中被映射到 1,2,4（即使设置了 [Flags] 属性）是一个常见问题。

很多人建议的解决方案是修改原来的枚举定义，从1开始，而不是从0开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T00:42:15.300

标志应该是 2 的倍数，在您的情况下，您的标志是 (0,1,2,3)。尝试将结构的定义更改为：

```
[Serializable,Flags]
public enum AccessLevels{    
None = 1,    
Read = 2,    
Write = 4,    
Full = Read | Write} 
```

看看它是否效果更好。

（我希望我不要自欺欺人，已经很晚了，我正在去睡觉的路上..）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T15:00:19.013

一种选择是提供更详细的类而不是枚举，例如

```
[Serializable]
public class AccessPermission{
 public boolean None{get;set;}
 public boolean Read{get;set;}
 public boolean Write{get;set;}
 public boolean Full{get;set;}

 public AccessPermission(AccessLevels level){
  None = false;
  Read = false;
  Write = false;
  Full = false;

  switch(level){
  case AccessLevels.None:
   break;
  case AccessLevels.Read:
   Read = true;
   break;
  case AccessLevels.Write:
   Write = true;
   break;
  case AccessLevels.Full:
   Read = true;
   Write = true;
   Full = true;
   break;
  }
 }
} 
```

我可以看到的另一个选项是提供一种方法，使用他们使用的任何语言来成功地互操作您发送的整数。flag 运算符意味着 c# 进行位掩码以查找是否标记了单个标志

```
0001 -> 无
0010 -> 读取
0100 -> 写
0110 -> 满

```

因此要检查任何权限，您应该查看该位是否已设置

```
 public static boolean CanRead(int accessLevel){
 return (accessLevel | 2) > 0 // return true if read bit set, using bitwise or
}

public static boolean CanWrite(int accessLevel){
 return (accessLevel | 4) > 0 // return true of write bit set.
} 
```

请注意，第二种解决方案更加脆弱，如果您更改 accessLevels 的定义，您的客户端将默默地错过行为。

# javascript - 如何使用 JavaScript 将标记的 onclick 事件处理程序更改为带参数的函数？

> ID：505626
> 
> 赞同：1
> 
> 时间：2009-02-03T00:39:55.007
> 
> 标签：javascript, html

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T00:43:28.620

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T00:44:06.637

然后你会创建一个匿名函数：

```
my_a = document.createElement('a');
my_a.onclick = function() { somefunction(x); }; 
```

如果您还想引用`this`in `somefunction`，可以使用 [Prototype][1] 之类的库，然后您可以执行以下操作：

```
my_a = document.createElement('a');
my_a.onclick = somefunction.bind(this, x); 
```

[1]：[http](http://alternateidea.com/blog/articles/2007/7/18/javascript-scope-and-binding) ://alternateidea.com/blog/articles/2007/7/18/javascript-scope-and-binding博客文章

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T00:43:45.903

你想要的是一个*部分功能应用程序*：

```
function partial(func /*, 0..n args */) {
  var args = Array.prototype.slice.call(arguments).splice(1);
  return function() {
    var allArguments = args.concat(Array.prototype.slice.call(arguments));
    return func.apply(this, allArguments);
  };
} 
```

现在，您将能够执行此操作：

```
my_a.onclick = partial(somefunction,1,2,3); //1,2,3 being some parameters 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T00:44:44.403

最简单的方法是将其包装在匿名函数中。像这样：

```
my_a.onclick = function() { somefunction('x'); }; 
```

缺点是`this`不再引用函数`my_a`内部`someFunction`，但如果你不需要它，那么匿名函数应该可以工作。

# c++ - 跟踪集群组状态 C++

> ID：505627
> 
> 赞同：0
> 
> 时间：2009-02-03T00:40:19.233
> 
> 标签：c++, cluster-computing

我想编写一个集群感知应用程序，它将跟踪集群组的状态。

更具体的，我想追问一下群主。应用程序应该知道本地机器是否是组的所有者，并据此行事。

我可以为此调查注册表吗？如果是，在哪里？如果没有，有人知道将提供此信息的任何 win32 api 调用吗？

非常感谢，

提供

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T00:42:29.573

阅读[集群 API](http://msdn.microsoft.com/en-us/library/aa369075.aspx)。我不打算写一个完整的演练，但是使用 API，您可以获得操作系统工具公开的所有（或几乎所有）信息，然后是一些信息。

# dependency-injection - 为什么依赖注入框架支持容器层次结构？

> ID：505637
> 
> 赞同：6
> 
> 时间：2009-02-03T00:44:08.713
> 
> 标签：dependency-injection

我一直在关注[Daniel Cazzulino关于](http://www.clariusconsulting.net/blogs/kzu/)[使用 TDD 构建 DI 容器](http://www.clariusconsulting.net/blogs/kzu/archive/2009/02/02/116399.aspx)的系列。在[本系列的第 5 部分中](http://www.viddler.com/explore/dcazzulino/videos/6/)，他添加了对容器层次结构的支持，但没有评论使此功能有用的原因。我已经看到在许多 DI 框架中提到了对层次结构的支持，但我无法理解它们何时会被使用，以及为什么会被使用。有人可以提供一些见解吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T01:45:58.353

我在 kzu 的博客上发表了评论，问了同样的问题。遗憾的是，他在编码之前没有阐明此类功能的用例。

我唯一能想到的是，如果您想在应用程序的不同部分从容器中解析不同的类型。例如，如果您有一个包含两个单独部分的订单输入系统，并且每个部分都是相同的，只是它们需要呈现不同的产品列表，您可以为每个部分创建一个子容器，并“覆盖”您的注册每个产品存储库。每当一个部分试图解析一个产品存储库（或任何依赖于一个产品存储库）时，它都会获得您在子容器而不是父容器中设置的实例。有点像覆盖虚拟方法。

这可能有点离谱，但这是我能想到的最好的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T02:03:37.367

这是一个在类似于 Matt 描述的场景中使用子容器[的示例。](http://ayende.com/Blog/archive/2007/06/21/Hierarchical-Containers.aspx)它使用子容器在不同的数据库配置之间进行选择。

这里的关键是大部分配置在子容器之间共享（共享部分属于父容器）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-25T09:19:29.430

如果项目完全接受依赖注入，则有充分的理由拥有子容器。让我们想象一个应用程序处理来自两个不同但相似的系统的消息。大多数处理是相似的，但有一些变化来支持这些系统的兼容性。我们的目标是尽可能重用代码，同时根据需求不同编写不同的代码。

在 OO 编程中，我们将一系列将协作以满足系统要求的类连接在一起。DI 容器承担这个责任。当消息从系统到达时，我们希望构建一组适合处理来自该特定系统的消息的协作类。

我们有一个顶级容器，其中包含在两个系统之间没有变化的项目。然后，我们有子容器，它们在系统之间*确实*有所不同。当消息到达时，我们向适当的子 DI 容器请求一个`messageProcessor`. 基于该容器的配置（必要时回退到父容器），DI 框架可以为相关系统返回一个 messageProcessor（由适当的协作者支持的对象）。

如果这不是一个明确的答案，请发表评论。此外，您可以搜索“机器人腿问题”。每条腿都是一样的，但一条需要左脚，另一条需要右脚。我们可以为每条腿创建一个子 DI 容器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-12T16:24:14.550

我所知道的嵌套容器的最佳示例是窗口系统。让每个选项卡/窗口拥有独立于其他选项卡/窗口的自己的容器，所有窗口容器都从父容器继承全局依赖项，这对于分离关注点非常好。

如果您可以有重复的选项卡/窗口，则尤其需要这样做，因为在许多情况下，您希望为每个重复的选项卡/窗口区分各种类的实例

# design-patterns - 装饰器设计模式

> ID：505641
> 
> 赞同：6
> 
> 时间：2009-02-03T00:46:00.503
> 
> 标签：design-patterns, oop, decorator

我刚开始学习设计模式，我有两个与装饰器相关的问题......

我想知道为什么装饰器模式建议装饰器实现它装饰的组件的所有公共方法？

装饰器类不能仅用于提供附加行为，然后具体组件（传递给它）仅用于调用其他所有内容吗？

其次，如果您要装饰的具体组件没有抽象装饰器也可以派生的基类怎么办？

提前致谢！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-03T00:55:44.587

我想你误解了装饰器。您正在考虑扩展具有附加功能的具体类的简单案例。在这种情况下，是的，在大多数 OO 语言中，派生类可以简单地允许其超类处理任何未实现的方法。

```
class Base {

  function foo() {
    return "foo";
  }

  function bar() {
    return "bar";
  }

}

// Not what we think of as a Decorator,
// really just a subclass.
class Decorator extends Base {

  // foo() inherits behavior from parent Base class 

  function bar() {
    return parent::bar() . "!"; // add something
  }

} 
```

Decorator 类不*扩展*其“装饰”类的基类。它是一个不同的类型，它有一个被装饰类的成员对象。因此它必须实现相同的接口，即使只是调用被装饰对象的相应方法。

```
class Decorator { // extends nothing
  protected $base;

  function __construct(Base $base) {
    $this->base = $base;
  }

  function foo() {
    return $base->foo();
  }

  function bar() {
    return $base->foo() . "!"; // add something
  }

} 
```

*为装饰类和装饰类定义一个接口*（如果你的语言支持这样的东西）可能是值得的。这样，您可以在编译时检查装饰器是否实现了相同的接口。

```
interface IBase {
  function foo();
  function bar();
}

class Base implements IBase {
  . . .
}

class Decorator implements IBase {
  . . .
} 
```

* * *

回复：@Yossi Dahan 的评论：我在维基百科文章中看到了歧义，但如果你仔细阅读，它确实说被装饰的组件是装饰器对象中的一个*字段*，并且该组件作为参数传递给装饰器构造函数. 这与继承不同。

尽管维基百科文章确实说装饰器继承自组件，但您应该将其视为实现接口，正如我在上面的 PHP 示例中所示。装饰器仍然必须代理组件对象，如果它继承了它就不会。这允许装饰器装饰*任何*实现该接口的类的对象。

以下是 Gamma、Helm、Johnson 和 Vlissides 的“设计模式：可重用的面向对象软件的元素”的一些节选：

> # 装饰器
> 
> ## 意图
> 
> 动态地将附加职责附加到对象。装饰器为扩展功能提供了一种灵活的替代子类的方法。
> 
> ## 动机
> 
> ...装饰器符合它所装饰的组件的接口，以便它的存在对组件的客户端是透明的。
> 
> ## 参与者
> 
> *   Decorator 维护一个对 Component 对象的引用，并定义一个符合 Component 接口的接口。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T01:04:51.667

> 我想知道为什么装饰器模式建议装饰器实现它装饰的组件的所有公共方法？

装饰器应该是它装饰的组件的替代品，具有额外的功能（“装饰”）。这只有在它完全实现了组件的接口时才会发生。

> 装饰器类不能仅用于提供附加行为，然后具体组件（传递给它）仅用于调用其他所有内容吗？

这对装饰器的实现方式做出了假设。您不能确定它所装饰的组件的整个公共接口是否被直接传递。装饰器可能会在其实现中覆盖某些方法。

> 其次，如果您要装饰的具体组件没有抽象装饰器也可以派生的基类怎么办？

Decorators generally inherit the component's class they are decorating, not the component's base.

# php - 将 HTML 转义为 PHP 还是使用 Echo？哪个更好？

> ID：505642
> 
> 赞同：43
> 
> 时间：2009-02-03T00:46:30.313
> 
> 标签：php, html, performance

在性能方面，什么会更好。使用 PHP 来回显所有 HTML 输出，这样我就可以在整个文档中定期使用各种工作代码和变量将 HTML 转义到 php。

我知道可能存在一些可读性问题，但我并不担心。

谢谢大家！

示例 1

```
echo '<html>',
     '<body>',
     'The content of the ',$container,' element is displayed in your ', $other_container,
     '</body>',
     '</html>'; 
```

或者

```
<html>
<body>
The content of the <?php echo $container; ?> element is displayed in your <?php echo $other_container; ?>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-03T00:58:27.887

这就是您认为最易读的所有内容。当然，这会因每种情况而异。如果你正在做一个完整的页面，并且其中有很大的部分没有任何 PHP，那么我会跳出 PHP 并只编写纯 HTML，而如果有一个部分有很多 PHP 变量，我会在 PHP 中完成这一切。

例如：

```
<table>
    <tr>
        <td colspan="<?php echo $numCols; ?>">
            <?php echo $a; ?>, <?php echo $b; ?>, and <?php echo $c?>
        </td>
    </tr>
</table> 
```

相对：

```
<?php
echo "<table>"
    . "<tr>"
    .    "<td colspan=\"" . $numCols . "\">"
    .        $a . ", " . $b . " and " . $c
    .    "</td>"
    . "</tr>"
    . "</table>"
; ?> 
```

或者

```
<?php
echo "<table>
         <tr>
            <td colspan='{$numCols}'>
               {$a}, {$b}, and {$c}
            </td>
         </tr>
      </table>";
?> 
```

也不要忘记`printf`

```
<?php
printf("<table>"
    . "<tr>"
    .    "<td colspan=\"%d\">%s, %s and %s</td>"
    . "</tr>"
    . "</table>"
    , $numCols
    , $a
    , $b
    , $c
);
?> 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-02-03T00:54:05.277

**哪个最容易阅读。**

与您将遇到的几乎任何其他问题相比，性能差异几乎可以忽略不计。绝对可读性是这里的第一个问题。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-02-03T00:59:41.583

让我们引用[手册](http://www.php.net/manual/en/language.basic-syntax.phpmode.php)：

> 当然，这里给出的示例是人为的，但是对于输出**大块**文本，退出 PHP 解析模式通常比通过 echo() 或 print() 发送所有文本更有效。

* * *

但是请听别人的，避免这种微优化，选择更清晰的。

我可以提出第三种解决方案吗？你听说过模板引擎吗？它们可以帮助您在代码和表示之间建立清晰的分离，这通常会导致代码更清晰，更易于维护。一个流行的这样的模板引擎是[smarty](http://smarty.net)，但有数百个具有不同的优势。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-03T00:50:54.923

这与您使用哪个应用程序的整体速度无关。

话虽如此，我知道你说你不在乎，但请使用第二个，因为它更容易阅读一百万倍。并且可读性是*巨大的*。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-03T02:12:03.637

我不知道它的性能，但在 PHP 中，您也可以使用我认为称为“Heredoc”的东西，我认为这有助于提高这种输出的可读性。

尼克夫的例子：

```
<table>
    <tr>
        <td colspan="<?php echo $numCols; ?>">
            <?php echo $a; ?>, <?php echo $b; ?>, and <?php echo $c?>
        </td>
    </tr>
</table> 
```

变成：

```
<?php
echo <<<EOT
<table>
    <tr>
        <td colspan="$numCols">
            $a , $b, and  $c
        </td>
    </tr>
</table>

EOT;

?> 
```

我相信最终的可读性是一个主观的东西，所以你的里程可能会有所不同！

露丝

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-03T00:49:06.253

它属于微优化领域。您的大部分时间用于初始化 PHP 引擎以开始工作。

因此，除非您有数万行（甚至更多）的订单，否则您不应该关心它。

补充一下，我对一百万行做了一个小测试，我使用 php 打印它们，我使用 php 调用 ac 程序做同样的事情，差异很小。

多一点信息。

第二个示例中发生的是您正在“打开/关闭”PHP，它不完全是正在发生的事情，但对于这个示例来说它很合适。

您应该更担心的是，该代码是否会有很多逻辑？我要把那个字符串分成更多的字符串，甚至把它放在不同的地方吗？这是 MVC 应用程序的视图吗？

对于 1 和 2，这可能是两种方法之间的折腾。但是对于 3，出于这些原因，我会使用方法 2。

MVC Web 应用程序中的视图主要是 html/css。所以我想看到它的格式正确，我想在我的编辑器中看到 html 着色。所以这是一个优点。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-03T02:02:21.533

就性能而言……这并不重要。代码的可读性是王道，性能差异的一小部分不会改变任何事情。

原始 HTML 版本通常是最容易阅读的（并且可能具有最好的性能，因为它的价值——但它的价值是：什么都没有）。这并不奇怪：PHP 是一种 HTML 模板语言，*重点*在于在语言语法级别上交错 HTML。

查看 nickf 的代码以了解如何保持其可读性。缩进很重要！在每个 PHP 控制结构中也放置一个缩进级别，以便您可以跟踪它们。例如。：

```
<?php if ($error) { ?>
    <p> Oh no, error! </p>
<?php } ?> 
```

最后，当输出内容时，例如示例中的 $container，您必须始终使用 htmlspecialchars() 它，否则您将拥有一个充满 HTML 注入安全漏洞的应用程序，就像所有其他 PHP 新手（甚至许多专业开发人员，可悲的是）。无论您使用哪种方法输出内容，这都很重要。

因为 htmlspecialchars 是一个相当长的函数名，你可以尝试定义你自己的快捷函数：

```
<?php
    function h($s) {
        echo(htmlspecialchars($s, ENT_QUOTES));
    }
?>

<ul>
    <?php foreach ($things as $thing) { ?>
        <li> <?php h($thing['name']) ?> </li>
    <?php } ?>
</ul> 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-06T18:26:01.153

就像下一个接管项目的程序员是连环杀手一样编写代码。换句话说，使用您提到的第二个选项。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-06T18:29:35.517

这应该更多地被视为可读性和维护问题，而不是性能问题。

因此，选项 2 有几个具体的优点：

1.  代码着色。使用选项 1，所有内容都被着色为 echo 语句，这使得阅读 HTML 更加困难。
2.  Intellisense - 对于许多 IDE，PHP 回显语句中的 HTML 不会参与 Intellisense，因此您将手动输入所有 HTML。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-03T00:55:53.697

对于小的部分，我只是将其全部保存在 PHP 字符串中，例如循环遍历数组以生成列表时。但是对于更大的标记堆，我将其排除在 PHP 之外，并在必要时将其放入 PHP 中。

这主要是因为我更喜欢优化可维护性。不仅因为当 html 应用了适当的语法高亮显示时可以更快地查看正在发生的事情，而且因为它还因为它还使得由于错误读取代码而导致的错误不太可能发生。

真的没有最好的办法。我只是尝试与上述内容保持一致，并睁大眼睛寻找其他方式可能是更好的处理方式的情况。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-04-14T05:48:20.347

我更喜欢使用 php [heredoc](http://www.php.net/manual/en/language.types.string.php#language.types.string.syntax.heredoc)函数，这样我就不需要转义任何字符，例如：

```
<?php

$title = "heredoc is cool!!!";
$mySite = "http://www.php.net";

echo <<<LOL
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 

  <title> $title </title>

 <link rel="shortcut icon" href="$mySite/favicon.ico">
 <link rel="search" type="application/opensearchdescription+xml" href="$mySite/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="$mySite/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="$mySite/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="$mySite/manual/en/language.types.string.php">
 <link rel="shorturl" href="$mySite/types.string">

 <link rel="contents" href="$mySite/manual/en/index.php">
 <link rel="index" href="$mySite/manual/en/language.types.php">
 <link rel="prev" href="$mySite/manual/en/language.types.float.php">
 <link rel="next" href="$mySite/manual/en/language.types.array.php">
LOL;
?> 
```

笔记：

> Heredoc 文本的行为就像一个双引号字符串，没有双引号。这意味着不需要对heredoc 中的引号进行转义，但仍然可以使用上面列出的转义码。变量是扩展的，但是在 heredoc 中表达复杂变量时必须像使用字符串一样小心。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-03T01:27:56.893

后者更具可读性。它也更容易编辑（例如，您不必在 HTML 中转义引号）。并且它可以毫不费力地保留空白，这可能是首选，特别是出于调试目的。

我几乎希望 PHP 能够启用`print()`并`echo()`自动转换 HTML 字符，以便人们停止使用它们来生成 HTML。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-05T14:30:50.117

您应该认真考虑永远不要将 PHP 放在 HTML 中。您将逻辑与视图混合在一起，这使项目变得混乱。

正如其他人所说，如果您输出为 html，请使用`<?php echo $whatever; ?>`

如果您必须输出大量信息，请查看输出缓冲。

# c++ - Windows x64 上 32 位和 64 位应用程序之间的进程间通信

> ID：505647
> 
> 赞同：3
> 
> 时间：2009-02-03T00:48:01.387
> 
> 标签：c++, winapi, interprocess

我们希望支持一些最近停产的硬件。硬件驱动程序是一个普通的 32 位 C DLL。我们没有源代码，并且（出于法律原因）对驱动程序的反编译或逆向工程不感兴趣。

硬件快速发送大量数据，因此通信协议需要非常高效。

我们的软件是本机 64 位 C++ 应用程序，但我们希望通过 32 位进程访问硬件。什么是 32 位和 64 位应用程序相互通信的高效、优雅的方式（理想情况下，不涉及发明新协议）？

解决方案应该在 C/C++ 中。

更新：一些受访者要求澄清这是用户模式还是内核模式驱动程序。幸运的是，它是一个用户模式驱动程序。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T00:59:22.283

如果这是一个真正的驱动程序（内核模式），那么你就是 SOL。Vista x64 不允许安装未签名的驱动程序。这只是一个用户模式 ​​DLL，您可以通过使用任何标准 IPC 机制来获得修复。管道、套接字、进程外 COM，大致按此顺序。这一切都以总线速度运行，因此只要您可以缓冲足够的数据，上下文切换开销就不会受到太大影响。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T01:49:33.290

我只会使用套接字。如果您将来需要它，它将允许您通过 IP 使用它，并且您不会被束缚在一个消息传递 API 上。如果将来您希望在其他操作系统或语言上实现此功能，您可以。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T00:59:02.613

[这篇文章](http://dnjonline.com/article.aspx?ID=jun07_access3264)可能很有趣。它讨论了这个问题，然后建议使用 COM 作为解决方案。我不是 COM 的忠实拥护者，但鉴于它在 Windows 世界中无处不在，它可能足够高效。您可能希望构建您的解决方案，以便您可以批处理数据（您不想为每个数据项执行一次 COM 调用）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T01:19:02.057

优雅的？C++？对自己的 DCOM/RPC 调用可能会起作用，或者您可以创建一个命名管道并使用它在两个进程之间进行通信（可能创建一个“CMessage 类”或其他东西），但要注意 x86 和 x64 之间的不同结构对齐方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T01:56:21.843

如果驱动程序确实是一个真正的驱动程序，那么 nobugz 几乎是正确的——你将不得不更加努力地工作，你还不是完全的 SOL。一种解决方案是在其他机器（或虚拟机）上安装 Win32，然后使用某种形式的 RPC，例如套接字（如 Pyrolistical 所建议的）或 UDP 或 MQ 甚至是 Tibco Rendezvous（它声称支持非常高的吞吐量以便按顺序处理金融市场产生的海量数据——至少这是我在过去记得的）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-10T14:45:52.923

双方共享的内存映射文件将具有相同的内容。操作系统将不得不做一些有趣的指针事情来实现它，但很可能能够以这样一种方式设置 2 个视图，即您不会在物理上复制内存。零拷贝几乎和它一样好

# asp.net - Windows Sharepoint 服务 (WSS) 和表单身份验证 - 将这些凭据传递给其他 ASP.NET 表单身份验证应用程序

> ID：505651
> 
> 赞同：1
> 
> 时间：2009-02-03T00:49:45.283
> 
> 标签：asp.net, sharepoint, forms-authentication, wss

对不起，这里的标题很差:)

我为表单身份验证配置了 WSS。我希望我的用户登陆 WSS 登录页面，登录，然后为他们提供指向其他 ASP.NET 应用程序的链接，这些应用程序也配置为表单身份验证。我想实现一个单点登录的解决方案（我说“ish”的原因是我不希望像在 SAML 中那样实现 SSO 本身，而是实现不强迫用户的类似效果重新输入他们的凭据）。您可以假设 WSS 使用的表单身份验证凭据与我想要提供链接的后续表单身份验证应用程序中的凭据相同。

这是否需要 WSS 端的代码，或者我可以在 ASP.NET/IIS 配置端以非编程方式实现这一点？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T01:09:17.820

您的[表单身份验证提供程序是什么？](http://msdn.microsoft.com/en-us/library/9wff0kyh.aspx)

在 Active Directory（例如）上，您的浏览器会*记住*您在第一个入口站点上的身份验证是什么，并为您携带它。

在 ASP.NET 和 SharePoint 网站的 web.config 文件中都有这个：

```
 <connectionStrings>
      <add name="ADConnectionString" 
       connectionString=
       "LDAP://testdomain.test.com/CN=Users,DC=testdomain,DC=test,DC=com" />
     </connectionStrings>

<membership defaultProvider="MyADMembershipProvider">
  <providers>
    <add
       name="MyADMembershipProvider"
       type="System.Web.Security.ActiveDirectoryMembershipProvider, 
             System.Web, Version=2.0.0.0, 
             Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
       connectionStringName="ADConnectionString"
       connectionUsername="testdomain\administrator" 
       connectionPassword="password"/>
  </providers>
 </membership> 
```

将确保他们都将使用相同的身份验证提供程序，因此一旦浏览器获得有关其身份的信息，它将在整个过程中相应地回收它。

否则，请尝试联合服务。

[这是一个关于如何使用 ADFS 的教程](http://msdn.microsoft.com/en-us/magazine/cc163295.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-04T02:54:24.533

嗨 Ric 感谢您的回复。我想我找到了答案。表单身份验证完全与 cookie 有关，因此如果我将 ASP.NET Web 应用程序和 Sharepoint 虚拟目录都配置为使用相同的身份验证 cookie，我应该在它们之间进行单点登录。我要试试。

更新：这很好用。

# c# - filterContext.Cancel 发生了什么（ASP.NET MVC）

> ID：505653
> 
> 赞同：10
> 
> 时间：2009-02-03T00:50:22.770
> 
> 标签：c#, asp.net-mvc, authorization

在 RC1 之前，我们做了这样的事情：

```
public void OnAuthorization(AuthorizationContext filterContext)
    {
        if (whatever)
        {
            filterContext.Cancel();
        }
    } 
```

现在已经没有了，我们如何使用 RC1 实现相同的结果？

谢谢，

凯尔

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-03T01:01:06.807

`Cancel`您只需将 设置`ActionResult`为不同的结果，而不是属性。因此，对于该`Cancel`属性，您只需将您的替换`Cancel=true`为

```
filterContext.Result = new HttpUnauthorizedResult(); 
```

[参考](http://forums.asp.net/p/1376982/2898597.aspx#2898597)

RC1 的重大更改：

`AuthorizationContext`- 不再拥有`Cancel`财产

`UpdateModel`- 不再接受`FormCollection`

`UrlHelper`- 不再接受`ViewContext`

[Scotts 博客](http://weblogs.asp.net/scottgu/archive/2009/01/27/asp-net-mvc-1-0-release-candidate-now-available.aspx)，其中包含 RC1 更改的[白皮书](http://go.microsoft.com/fwlink/?LinkID=137661&clcid=0x409)。

# perl - mod_perl 2 变量和进程损坏

> ID：505662
> 
> 赞同：2
> 
> 时间：2009-02-03T00:56:55.893
> 
> 标签：perl, mod-perl2

我们刚刚将一个相当大的代码库从古老的 Perl 5.005.03 CGI 环境移植到 mod_perl 2，现在它正在进行公开测试，我们不时遇到一些可能相关的问题。这些会累积起来，直到我们必须重新启动服务器。

我们所有的代码都在 use strict 下编译，但之前被称为编译、运行和丢弃的 CGI 脚本。到目前为止我们遇到的问题：使用旧式全局文件句柄（而不是）设置`$|`或调用。还调用- 在我们开始公测后不久，我们发现例如 /bin/tail 或 /usr/sbin/sendmail 在端口 80 和 443 上监听，这阻止了服务器重新启动。从那以后，我重写了该代码以使用纯 Perl 方法，我们不再有这个问题。`STDOUT->autoflush(1);``open(ERRORFILE, $errorfile)``open(my $fh_error, $errorfile)``system()`

仍然存在两个问题。第一个是日志充满了 mod_perl 抱怨常量已被重新定义，例如

```
Constant subroutine ModPerl::ROOT::ModPerl::PerlRun::usr_local_..._cgi_forgotpassword::O_CREAT redefined at /usr/lib/perl5/ModPerl/Util.pm line 69. 
```

此外，有时看似核心的变量会被丢弃。我们的核心内部模块之一记录有关 PID 和脚本名称的信息，并生成如下信息：

```
20090202-233948-32154:Started script /usr/local/.../cgi/account/renewalcalendar
20090202-233948-32154:Ended script /usr/sbin/apache2 
```

在其他时候，进程 ID 将以`undef`. 这是罕见且间歇性的。

其次，也是间歇性的，我们偶尔会看到垃圾收集没有启动。（可能是弱引用的问题？但几乎所有时间一切正常。）最直接的症状是打开的数据库句柄从不关闭，但是当我深入研究这个问题时，很明显在标准 Perl 哈希对象中存储了一个 DBI 对象，并且该对象的`DESTROY`方法（很少和间歇性地）没有被调用。

我们正在运行 Debian 5.0 (Lenny)、Perl 5.10.0、Apache 2.29、mod_perl 2.0.4、openSSL 0.9.8g。如有必要，我可以提供更多信息，但我认为这是基础。

apache 配置的显着部分，即*/etc/apache2/sites-enabled/*sitename**，是（出于保密原因编辑了一些位）：

```
<VirtualHost ...:443>
<Directory />
    Options SymLinksIfOwnerMatch
    AllowOverride None
</Directory>
<Directory /usr/local/.../cgi>
    SetHandler perl-script
    PerlResponseHandler ModPerl::PerlRun
    PerlOptions +ParseHeaders
    Options +ExecCGI
</Directory>
</VirtualHost> 
```

那里有一些 SSL、重写和重定向的东西，但这是重要的东西。

这听起来很熟悉吗？或者，任何人都可以推荐任何进一步调试问题的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T01:14:22.940

For your memory problem: you need to call weaken (from standard module [Scalar::Util](http://search.cpan.org/perldoc?Scalar::Util))

# performance - 在 Linux 下可以使用哪些免费的、低开销（统计）分析器？

> ID：505665
> 
> 赞同：3
> 
> 时间：2009-02-03T00:57:31.900
> 
> 标签：performance, profiler, code-statistics

最好来自 Ubuntu 存储库。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T01:57:53.150

其他人提到了[OProfile](http://oprofile.sourceforge.net/)；对于现代 Linux 安装的全系统统计分析，它确实很摇滚。

更古老的工具（不需要内核支持，因此可以在旧版本的 Linux 甚至非 Linux 操作系统下工作）是[GNU gprof](http://sourceware.org/binutils/docs/gprof/index.html)，包含在[binutils](http://www.gnu.org/software/binutils/)中（因此毫无疑问已经安装在您的开发环境中）。

要使用`gprof`，只需使用`-pg`参数编译您的应用程序`gcc`；`gmon.out`程序退出后将创建一个名为的文件，`gprof`然后可用于分析该文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T20:02:04.770

一个简单但有效的技术是在 GDB 下运行程序并处理 SIGINT 信号。在程序运行时，通过键入 control-c 或其他方式手动生成 SIGINT，并在程序停止时记录调用堆栈。多次执行此操作，例如 10 或 20 次，同时程序主观上很慢。这将使您很好地了解时间的去向。

这种方法不会给你精确的计时，但它确实可以精确地定位到花费最多时间的指令，包括调用指令。

[如何分析在 Linux 中运行的 C++ 代码？](https://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T06:11:51.983

[Sysprof](http://www.daimi.au.dk/~sandmann/sysprof/)是一个很好的分析器，类似于 OProfile（也有一个 gtk GUI）。它在 Ubuntu 存储库中可用。它是一个内核级别的分析器，需要一个与 gprof 不同的内核模块，但也与 gprof 不同，它可以分析多线程应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T00:59:52.597

有[OProfile](http://oprofile.sourceforge.net/)。使用起来并不难，但有点麻烦。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T01:00:06.370

我在 Ubuntu 存储库中也可以使用 oprofile ( [http://oprofile.sourceforge.net/news/ ) 取得了很好的成功。](http://oprofile.sourceforge.net/news/)它不需要重新编译，并且对共享对象等没有任何限制。

# jquery - 如何更改 html 元素 通过 jQuery 点击的颜色？

> ID：505677
> 
> 赞同：1
> 
> 时间：2009-02-03T01:00:21.830
> 
> 标签：jquery

如何在点击时更改 UL 'li' 的背景颜色？

编辑我可以改变 li "a" 但是整个**li**

这有效：

```
 $(".clickableUL").click(function() {
           $(this).find("li a").addClass("active");

       }); 
```

但是 find("li") 什么都不做。我希望 LI 不仅突出显示链接的文本。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T01:08:58.177

```
// javascript
$("li>a").click(function(){
   $(this).parent().toggleClass("clicked");
});

/* CSS */
li { background: blue; }
li.clicked { background: red; } 
```

除非您希望它保持更改，否则您也可以使用`display: block;`on`<a>`使其填充。`<li>`

编辑：哦！刚刚意识到您也可以将点击事件直接应用于`<li>`自身，例如。

```
$("li").click(function(){
   $(this).toggleClass("clicked");
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T01:12:17.890

您可以修改锚的父级（假设父级是 <li> 元素。

```
$('a').click(function(evt) { 
   $(evt.target).parent().css('background-color', '#fff'); 
}); 
```

# c++ - C++ 是否有类似 scala 的 mixin？

> ID：505686
> 
> 赞同：21
> 
> 时间：2009-02-03T01:05:06.830
> 
> 标签：c++, scala, traits, mixins, template-mixins

[Scala 混合](http://www.scala-lang.org/node/117)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-03T01:43:04.380

不，但它可以用模板在不同程度上伪造：

```
template<typename AbsIterator> 
class RichIterator : public AbsIterator {
public:
   template<typename FuncType>
   void foreach(FuncType f) { while( hasNext() ) f( next() ); }
};

class StringIterator {
  std::string m_s;
  int i;
public:
  typedef char T;
  StringIterator() : m_s(), i(0) {} // Unfortunately need this, or 
                                    // else RichIterator
                                    // gets way more complicated
  StringIterator(const std::string &s) : m_s(s), i(0) {}
  void swap(StringIterator& other) {
     m_s.swap(other.m_s);
     std::swap(i, other.i);
  }
  void reset_str(const std::string& s) {
     StringIterator(s).swap(*this);
  }
  bool hasNext() { return i < m_s.length(); }
  char next() { return m_s[i++]; }
};

template<typename Outputable>
void println(const Outputable& o) {
   std::cout << o << std::endl;
}

int main(int argc, char **argv) {
  typedef RichIterator<StringIterator> Iter;
  Iter iter;
  iter.reset_str(argv[1]);
  iter.foreach(&println<Iter::T>);
} 
```

老实说，我还没有通过编译来测试它，但你应该明白了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T05:06:03.723

Scala mixin 的某些方面可以使用多重（虚拟）继承来满足。不幸的是，这通常会带来比它解决的问题更多的问题。此外，您不能即时混合和匹配超*类*：

```
val me = new Human with Coder with Musician 
```

如果您真的*非常*想要真正的 mixins，您几乎必须使用类似[@Logan Capaldo](https://stackoverflow.com/questions/505686/are-there-scala-like-mixins-for-c/505757#505757)的答案中提出的模板解决方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-08-20T23:19:48.290

只是为了重申和扩展之前电子邮件中提到的内容，让我首先给您一个示例，说明如何在 C++ 中实现 Scala Ordered 特征，然后让我展示如何在实例化时混合任意数量的“特征”。

让我们首先从 Ordered 特征开始。如果您熟悉 Scala SDK，您会注意到有一个 Ordered 特征。这用于通过实现简单的“比较”方法来提供总排序。在 C++ 中，您可以执行以下相同操作：

```
template <typename T>
class Ordered {
public:
    virtual int32_t compare(const T& that) = 0;
    bool operator >(const T& that) {return this->compare(that) == 1; }
    bool operator >=(const T& that) {return this->compare(that) >= 0; }

    bool operator ==(const T& that) { return this->compare(that) == 0; }

    bool operator <=(const T& that) {return this->compare(that) <= 0; }
    bool operator <(const T& that) {return this->compare(that) == -1; }
}; 
```

然后，要将排序属性赋予 C++ 类，您可以执行以下操作：

```
class MyOrderedType : public Ordered<MyOrderedType> {
public:
  // Your ctor/dtors, methods
public:
  int compare(const MyOrderedType& that);
}; 
```

显然，您可以根据需要混合任意数量的“特征”，但如果这样做，您将无法在实例化时添加或删除特征。有一个简单的解决方案吗？有点儿。

听说过 C++0x 可变参数模板吗？这提供了一种在模板实例化时混合尽可能多的特征的方法。

诀窍很简单，只需按如下方式声明您的主机类：

```
template <typename... MIXINS>
class Host : public MIXINS... {
 // Your implementation
}; 
```

这里有什么问题？好吧，问题是不可能做这样的事情：

```
template <typename... MIXINS>
class Host : public MIXINS<HOST>... {
    // Your implementation
}; 
```

在某些情况下会很方便。

在任何情况下，C++ 都有一些基本机制允许您模拟 Scala 的 Mix-ins 的某些方面。然而，它不能做的是堆叠行为。

HTH。

# python - 如何在 Django 中链接视图？

> ID：505703
> 
> 赞同：5
> 
> 时间：2009-02-03T01:13:26.657
> 
> 标签：python, django, extension-methods, django-views, word-wrap

我正在实施[James Bennett](http://www.b-list.org/about/)的优秀[django-contact-form](http://code.google.com/p/django-contact-form/)但遇到了障碍。我的联系页面不仅包含表单，还包含附加的平面页面信息。

在不重写联系表单使用的现有视图的情况下，我希望能够包装或链接视图。这样，我可以通过上下文注入一些额外的信息，以便表单和平面页面数据都可以在同一个模板中呈现。

我听说它提到这是可能的，但我似乎无法弄清楚如何使它工作。我创建了自己的包装视图，称为联系表单视图，并尝试检查 HttpResponse 对象以查找我可以附加到的属性，但我似乎无法弄清楚它是哪个（如果有的话）。

**编辑：** James 评论说最新的代码可以[在](http://bitbucket.org/ubernostrum/django-contact-form/overview/)BitBucket 上找到。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T01:18:19.487

有一个上下文处理器可以做你想做的事。

[http://docs.djangoproject.com/en/dev/ref/templates/api/](http://docs.djangoproject.com/en/dev/ref/templates/api/)

您可能可以将各种“平面页面信息”添加到上下文中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-04T07:14:23.573

1.  编写一个包装器，它使用 URL 来查找适当的平面页面对象。
2.  从您的包装器中，调用联系表单视图（并从中返回响应），在`extra_context`参数中传递平面页面（除其他外，正是这种用例）。
3.  没有第三步。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T03:30:11.560

上下文处理器就是您所想的。而 render_to_response 是无关紧要的。所需的信息是视图是否使用 RequestContext，因为这是激活上下文处理器的原因。

除此之外，没有办法“链接”视图以添加到上下文中 - 您可以将一个视图包装在另一个视图中并更改进入其中的数据，但您*不能*以这种方式添加到上下文中。

# ruby - What sort of things do you code in Ruby? What sort of things does Ruby excel at, over other languages?

> ID：505714
> 
> 赞同：7
> 
> 时间：2009-02-03T01:19:04.227
> 
> 标签：ruby

I decided to learn Ruby, and I wanted to ask what sort of things you felt Ruby did better than other languages, facilities it has, and the position of the language in the industry today, amongst other languages, is it a strong competitor? What target audience is it aimed at, web-developers/GUI-programmers/10 line scripters? Kindly give me your opinion :)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T01:45:51.020

Personally, I have 2 use cases for Ruby:

**Maintenance scripts**. I have a lot of tasks at work that I'd classify as "maintenance". These tasks range from manipulating data from an excel spreadsheet and importing into a SQL Server Database to cleaning up a directory full of files to generating test data that I don't want to manually create. Some of these scripts are quick 10 line scripts and some of them expand out into small applications that I use quite frequently.

There are a few things that make Ruby really nice for this:

1.  It's really easy to get started with a script. Tools like [Rake](http://rake.rubyforge.org/) are designed for organizing tasks, and I don't need to create a bunch of extra framework junk just to get started.

2.  Libraries. I know that other languages supposedly have superior libraries, but so far Ruby's libraries have suited my needs. And RubyGems makes it really easy to install a library without having to manually download and install it.

3.  Ruby has a lot of built features that make reading and processing files really simple.

4.  [DSLs](http://en.wikipedia.org/wiki/Domain-specific_programming_language). There are a lot of tasks that are repetitive and lend themselves to creating domain specific languages. Ruby has a very flexible syntax and it has some functional aspects that give you a lot of flexibility in the way that you write your programs. Often, you can wrap up common functionality into a DSL that's suited for your task.

The other thing I use Ruby for (to a lesser extent) is **web development**. The [Ruby on Rails](http://rubyonrails.org/) framework is what I've used mostly, but I played around with Merb a little bit before the announcement that it was merging with Ruby on Rails.

I like Ruby on Rails for all of the reasons that I like Ruby. In fact, it's mostly the features of Ruby that make Ruby on Rails great. Rails itself is a domain specific language written in Ruby that make web development a lot more fun (in my opinion) and speed things up quite a bit.

I think a lot of people feel the same way I do about Ruby, and the community still seems very active and vibrant. I think it's a great language to learn that's going to be used for quite some time.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T10:18:52.593

除了 Excel 宏和使用 Ruby 的重型/长时间运行的数学函数之外，我几乎编写了所有代码。我通常首先在 Ruby 中对后者进行原型设计。我已经有一段时间没有编写任何非 Web UI 的东西了，并且会三思而后行地使用 Ruby，尽管老实说我会三思而后行。[鞋子](http://shoooes.net/)和[wxRuby](http://wxruby.rubyforge.org/wiki/wiki.pl)很有趣。如果我要写游戏，我想我有限的野心会被[gosu满足](http://code.google.com/p/gosu/)

现在，“一切”主要包括：

*   Rails 和相关的东西
*   任务自动化和脚本
*   [欧拉计划](http://projecteuler.net)拼图编码

“它有什么更好的地方？” 有点主观。与 Python 和 Perl 相比，我更喜欢它，至少部分是因为它从根本上面向对象的设计。我喜欢它的简洁，接近 Perl 但更具可读性。我喜欢内置类的开放性，让我可以添加方法而不必创建新类。我对出现的各种替代实现以及将舒适的语法应用于新问题域的潜力着迷。

它不是闪电般的速度（尽管它越来越快），但老实说，大多数情况下它已经足够快了：我在需要 10 毫秒和 10 微秒的程序之间没有明显不同的体验。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T01:34:13.977

Ruby is a good language in which to design and use "internal Domain-Specific Languages", DSLs for short. A DSL is a notation specifically designed to represent some particular business domain; "internal" to distinguish between notations which are incompatible with the host programming language (an example would be XML notations for project build files) and notations which are a variant of the host language (for instance, the Ruby equivalent of Make, called Rake). See e.g. [Martin Fowler's article](http://www.martinfowler.com/articles/rake.html).

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T01:25:29.597

Ruby is way better at anything related to text processing, and is very good at being *flexible*, that is, to give developers the power to write very elegant, readable code. If you want speed, this isn't the place, but for a lot of things it doesn't matter.

If I had to give one thing Ruby excels at, it is that it is fundamentally designed to be very readable - Matz writes about this in Beautiful Code, that well-written code is an essay to communicate ideas to other *people*, not to computers.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T01:27:41.883

The things I love most in ruby, in contrast to python, are blocks and the `retry` command. It is really useful and can lead to incredibly more legible code.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T10:25:33.657

在我之前使用 Perl 脚本的所有情况下：系统管理脚本、文本处理、访问数据库（如 Oracle、LDAP）。我目前的编程可能有 95% 是用 Ruby 完成的。具有 Ruby on Rails 和 Merb 等框架的 Web 应用程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T01:29:37.573

One biggest reason to learn Ruby is to make full use of its fantastic RoR framework for building web apps. Besides this Ruby can do almost everything other popular languages can do. Ruby is better documented, has large community and in case of RoR in particular uses best practices. Ruby has awesome readability. It has some nice concepts like mixins, blocks etc that makes it an excellent OO language.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T02:08:47.293

ruby is great for prototypes. its amazing how fast you can write a profe of concept in ruby. the language gives you anything you need and stays out of your way

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-03T02:45:45.270

@gs: Ruby has recently debunked the **retry** facility.

* * *

Lambda expressions in Ruby utilize very lightweight syntax, making them pseudo-invisible.

Obscure things like anonymous blocks are provided, (I'm currently unaware of many other languages that have this provision).

Syntax consistency exists, even with mannerisms that can be used in place of others, it has a near English sentiment, creating an environment where even the most ignorant of novices would feel comfortable in. Code is much shorter, and compact than the conventional C/Java and Python mantras.

**Everything** is an object.

It allows for internal Domain-Specific Language manipulation and control.

There are probably dozens more I could list, and possible even more cons; I tend to write small quick and dirty programs I need on a daily basis; I haven't been coding in it very long, but its definitely something a beginner should look into. I know I enjoy working with it :)

You should probably look into [this](http://www.poignantguide.net) if you want to learn Ruby. You should also read [this](https://rads.stackoverflow.com/amzn/click/com/0596516177) too

[![The Ruby Programming Language](https://i.stack.imgur.com/K9CBC.jpg)](https://i.stack.imgur.com/K9CBC.jpg)
[(source: [rubyinside.com](http://www.rubyinside.com/wp-content/uploads/2008/02/hummingbird-book-the-ruby-programming-language.jpg))]

# url - “+”或“-”作为 URL 中的分隔符？

> ID：505726
> 
> 赞同：3
> 
> 时间：2009-02-03T01:27:20.123
> 
> 标签：url, seo, friendly-url, separator, url-design

大多数网站都使用`-`（如 Stack Overflow），但大多数 PHP 框架会生成`+`编码的 URL。

那么，什么是最适合 SEO 的呢？使用`+`还是`-`作为分隔符？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T01:30:28.667

加号是空格的简化编码（如果不使用 %20 则使用，尽管两者同样有效）。'-' 在 URL 编码中没有特殊含义，将被解码为 '-'，其中 '+' 将被解码为空格。

诸如堆栈溢出之类的站点必须将空格转换为“-”以*生成*URL（而不是对 URL 进行编码）。

有关更多详细信息，请参阅有关[URL 编码的维基百科文章。](http://en.wikipedia.org/wiki/Percent-encoding)

哦，直接回答这个问题，对于 SEO 来说既不是更好也不是更糟。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-03T02:15:19.200

`+`并且`-`不相等。

加号是[URI 编码](http://en.wikipedia.org/wiki/Percent-encoding)规范的一部分。作为保留字符。特别是加号用作查询字符串中[空格的简写符号](http://www.w3.org/Addressing/URL/uri-spec.html)（搜索“查询字符串”并阅读该标题下方的信息）。

这可能会导致编码问题，其中一个 urlencoding 系统可能使用[标准百分比编码](http://en.wikipedia.org/wiki/Percent-encoding)，而另一个将使用[RFC 1738](http://www.faqs.org/rfcs/rfc1738) URL 编码。因此，返回的 URL 字符串类型之间可能存在不匹配。因此，您将对任何具有“+”作为重要字符的 URL 进行编码，并对随后的 URL 进行解码。

我建议最好不要使用任何保留字符作为 URL 的关键部分（不是查询字符串），并将空格转换为“-”（破折号）。因为它可能导致未来不可预测的结果。

我同意它可能不会对 SEO 产生影响……只要页面可以浏览并且内容（这很重要）可以被 SE 索引。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T06:02:29.270

根据 SEOmoz 在他们的一篇关于 URL 最佳实践的博客[文章](http://www.seomoz.org/blog/11-best-practices-for-urls)中，连字符最好分开，然后是下划线，然后是加号 (+)。

> 在以短语格式创建包含多个单词的 URL 时，最好使用连字符来分隔这些术语（例如 /brands/dolce-and-gabbana/），然后（按顺序）下划线 (_)、加号 (+) 和没有。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T01:38:20.273

- 字符用作[永久链接](http://en.wikipedia.org/wiki/Permalink)格式的一部分。通常，永久链接使用它们代替空格，但仅作为论坛帖子或博客文章标题的一部分。

# performance - 如何准确测量 c++ 函数使用的时钟周期？

> ID：505738
> 
> 赞同：3
> 
> 时间：2009-02-03T01:33:03.777
> 
> 标签：performance, benchmarking

我知道我必须使用：rdtsc。测量的函数是确定性的，但结果远非可重复（从运行到运行我得到 5% 的振荡）。可能的原因有：

*   上下文切换
*   缓存未命中

你知道其他原因吗？如何消除它们？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T02:05:25.757

TSC（*rdtsc*使用的）通常在多处理器系统上不同步。设置 CPU 亲和性以将进程绑定到单个 CPU 可能会有所帮助。

[如果可用，您还可以从HPET 计时器](http://en.wikipedia.org/wiki/HPET)获取时间戳，这不容易出现同样的问题。

至于可重复性，这些差异是真实的。您可以禁用缓存，为进程提供实时优先级和/或（如果在 Linux 或类似的东西上）使用较低的固定定时器中断频率（执行时间片的中断频率）重新编译内核。您不能完全消除差异，至少不容易，也不能在常规 CPU + OS 组合上。

一般来说，出于易于编码、可靠性和可移植性的原因，我建议您使用操作系统提供的功能。如果它提供高精度计时器，请使用适当的操作系统助手。

（以防万一您尝试对加密系统进行时间攻击，那么您将不得不忍受 1\. 这种随机性和 2\. 出于充分理由使系统不可预测的一般防御措施，因此该功能可能不会对于时间是确定性的。）

编辑：添加了有关操作系统可以提供的计时器的段落。

编辑：这是指 Linux。要将进程绑定到单个 CPU（从 RDTSC 中准确读取），您可以使用[sched_setaffinity(2)](http://linux.die.net/man/2/sched_setaffinity)。这是我[的](http://repo.or.cz/w/kmemtrace-user.git?a=blob;f=kmemtraced.c;h=217478ddca954a9d3fc4c4c99bd9f3c93e498bb1;hb=0d00b11cc4badc1da3313fd84335efedde27ad83#l73)一个项目中的一些代码，将其用于其他目的（将线程映射到 CPU）。这应该是你的第一次尝试。至于 HPET，只要内核和机器支持这些计时器，您就可以使用像[这样的常规 POSIX 调用。](http://www.tin.org/bin/man.cgi?section=3&topic=clock_gettime)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T02:06:19.200

为什么要消灭它们？听起来您已经创建了一个现实的基准。该代码在野外使用时也会具有相同的可变性。可能更糟，因为您可能已经消除了磁盘和 CPU 缓存延迟。使用 Jon Skeet 的方法，创造条件给你最好的结果，只会给你留下一个让你感觉良好但永远无法实现的结果。

如果绝对数字很重要，请计算中位数，而不是平均值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T01:39:42.470

请参阅问题[秒表基准测试是否可以接受？](https://stackoverflow.com/questions/410437/is-stopwatch-benchmarking-acceptable)关于现代多核多线程多进程机器上的微基准测试差异的论述。

尽管问题是关于 Java 的，但考虑因素适用于任何语言的基准测试。

另请参阅：[如何在 Java 中编写正确的微基准测试？](https://stackoverflow.com/questions/504103/how-do-i-write-a-correct-micro-benchmark-in-java)

另请参阅：[对于编写有意义的基准，您能给我什么建议？](https://stackoverflow.com/questions/324200/what-advice-can-you-give-me-for-writing-a-meaningful-benchmark)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-01T22:15:43.787

实际上，较新的 Linux 内核中有新的 perf 子系统。例子：

```
$ ./perf stat du -s /tmp
94796 /tmp

 'du -s /tmp' 的性能计数器统计信息：

          2.546403 任务时钟毫秒 #0.060 CPU
                 3 个上下文切换 # 0.001 M/sec
                 0 CPU 迁移 # 0.000 M/sec
               166 个页面错误 # 0.065 M/sec
           2434963 次循环 #956.236 M/秒
           1798092 指令#0.738 IPC  
            302969 个分支 # 118.979 M/sec
             26197 分支未命中 # 8.647 %    
             23217 缓存引用 # 9.118 M/秒
              4621 缓存未命中 # 1.815 M/秒

        0.042406580 秒经过的时间
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T02:01:05.750

添加到原因列表：分支预测/错误预测（这可能会受到某些芯片上具有复杂预测缓存的上下文切换的影响。预测也会受到程序的不同输入的影响，因此直接比较两个不同数据的时间集合可能会稍微倾斜。

一般来说，要减轻所有这些几乎是不可能的，但是您可以做一些事情来*帮助*每个人：

*   缓存未命中：开始计时之前“Prime”缓存。不要忘记还有一个指令缓存也需要准备好。对于小型数据集，只需在不计时的情况下运行整个测试一次，然后在计时的情况下再次运行。对于大型数据集执行此操作，但随后使用处理器的预缓存指令将第一个数据块加载回缓存。
*   上下文切换：在轻负载系统上使用多处理器/核心芯片，并将进程的亲和性设置为特定的 CPU（最好不是 CPU 0）。这也将有助于缓存未命中（因为移动 CPU 意味着缓存完全丢失）和分支预测（因为它实际上是一种缓存形式）。

但是，当然，到目前为止，进行此类计时的最佳方法是对非常大的数据进行多次计时，以便将您无法控制的事物引入的可变性降至最低。（它永远无法真正被抹去。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T02:13:06.660

大多数现代处理器都支持一组非凡的低级硬件性能计数器。如果您真的想知道答案，包括对缓存未命中和上下文切换开销的实际测量，请获取[PAPI（性能 API）工具包](http://icl.cs.utk.edu/papi/)，然后，在某些（尽管不是全部）操作系统上安装一个内核补丁，并付出一些额外的努力，你已经开始跑步了。

# c# - WPF 绑定与事件处理

> ID：505744
> 
> 赞同：2
> 
> 时间：2009-02-03T01:38:03.860
> 
> 标签：c#, wpf, binding, event-handling

我是 WPF 的新手，来自 WinForms 背景，并且有一个关于绑定与事件处理的相当基本的问题。

为了尝试保持某种责任分离，我有一堆`Presentation`对象，它们只需要`Dependency Properties`保存业务对象的 UI 数据部分，业务对象包含相似的数据，但数据类型有时不同，因此`Presentation`对象是正确的显示目的。所以像

```
public class MyPresentation
{
   // bunch of dependency properties
   public bool MyProperty
   {
      get { return (bool)GetValue(MyPropertyProperty); }
      set { SetValue(MyPropertyProperty, value); }
   }

   // Using a DependencyProperty as the backing store for MyProperty.  This enables animation, styling, binding, etc...
   public static readonly DependencyProperty MyPropertyProperty =
   DependencyProperty.Register("MyProperty", typeof(bool), typeof(MyPresentationObject), new UIPropertyMetadata(false, MyPresentationObject.MyPropertyPropertyChanged));

   MyBusinessObject RelatedBusinessObject { get; set;}

   public MyPresentation(MyBusinessObject businessObejct)
   {
      this.RelatedBusinessObject = businessObject;
   }

   public static void MyPropertyPropertyChanged()
   {
      // Do some stuff to related business objects
   }
} 
```

的属性`MyPresentation`然后是数据绑定到各种控件，我使用`Trigger`s 等来更改表示依赖属性，这会导致`OnPropertyChanged`事件中的业务对象更改

我的问题是我是否以正确的方式使用绑定？`Binding`通常（在 Winforms 中）我会使用点击事件等来更改我的业务对象（或它们的演示版本）的值，但是现在您可以使用、`Trigger`s 和事件，这些事件和那种事件处理似乎是多余的`OnPropertyChanged`。

我错过了什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T02:15:19.433

您以这种方式使用绑定是正确的。还可以查看 Model View View-Model 模式，因为它与您正在做的类似，但更可定义的模板。另请查看接口 INotifyPropertyChanged - 这是一种更可接受的方法，用于捕获属性已在本地更改并通知视图（您的表单）对象已更改。这样您就可以两全其美：对象的更改可能由于单击按钮或绑定而发生。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T08:42:17.733

[看这里，](http://msdn.microsoft.com/en-us/magazine/dd419663.aspx)这呈现模式模型视图视图模型，这允许您充分利用 WPF 的绑定和命令，而不会干扰您的业务对象（例如在您的业务对象上实现 INotifyPropertyChanged 之类的 WPF 东西）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T10:40:59.147

您正在编写不需要编写的额外代码。

首先，如果表示对象只是传递值，您可以直接绑定到业务对象并去掉中间人。

其次，您不需要对表示对象的依赖属性，业务对象的样式和动画只是没有意义，您可以通过为您的属性编写普通的日常设置器来“插入” UI -> 表示对象。

In your example the use of dependency properties only gets you automatic presentation object -> UI updates, as everyone here wrote you can get this with simpler code by using INotifyPropertyChanged.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T01:53:17.013

我认为您走在正确的轨道上，因为 DependencyProperties 内置了用于处理更改的机制，它们摆脱了额外的事件处理层——它仍然存在，但它内置于 WPF 中。

顺便说一句 - 我相信有人会有一些 MVC 智慧来让一切变得更简单。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T05:07:04.233

**以我的经验，正常模式是简单地使用实现INotifyPropertyChanged**的​​表示/业务对象。

很少需要将您的业务/表示对象实现为**DependencyObject**或附加的**DependencyProperties**，因为 WPF 中的数据绑定只需要绑定的一侧是**DependancyObject**（在这种情况下是您的控件） - 另一侧可以，并且在业务对象的情况，通常应该是一个POCO。否则，您最终不得不用 WPF 类不必要地污染您的业务对象。

同样使您的对象**DependencyObjects**可能是矫枉过正，因为您不会为它们的值设置动画、样式、模板等。

干杯，杰克

# sql - 在 SQL Server 中执行嵌套 case 语句逻辑的最佳方法

> ID：505747
> 
> 赞同：212
> 
> 时间：2009-02-03T01:39:04.123
> 
> 标签：sql, sql-server, sql-server-2005, select, nested

我正在编写一个 SQL 查询，其中返回的一些列需要根据很多条件进行计算。

我目前正在使用嵌套的 case 语句，但它变得混乱。有没有更好（更有条理和/或可读性）的方式？

（我正在使用 Microsoft SQL Server，2005）

* * *

一个简化的例子：

```
SELECT
    col1,
    col2,
    col3,
    CASE
        WHEN condition 
        THEN
            CASE
                WHEN condition1 
                THEN
                    CASE 
                        WHEN condition2
                        THEN calculation1
                        ELSE calculation2
                    END
                ELSE
                    CASE 
                        WHEN condition2
                        THEN calculation3
                        ELSE calculation4
                    END
            END
        ELSE 
            CASE 
                WHEN condition1 
                THEN 
                    CASE
                        WHEN condition2 
                        THEN calculation5
                        ELSE calculation6
                    END
                ELSE
                    CASE
                        WHEN condition2 
                        THEN calculation7
                        ELSE calculation8
                    END
            END            
    END AS 'calculatedcol1',
    col4,
    col5 -- etc
FROM table 
```

* * *

## 回答 #1

> 赞同：211
> 
> 时间：2009-02-03T01:44:10.183

您可以尝试某种 COALESCE 技巧，例如：

```
选择合并（
  CASE WHEN 条件 1 THEN 计算 1 ELSE NULL END,
  CASE WHEN 条件 2 THEN 计算 2 ELSE NULL END,
  ETC...
)

```

* * *

## 回答 #2

> 赞同：106
> 
> 时间：2012-07-12T17:17:23.203

将所有这些案例合二为一。

* * *

```
SELECT
    col1,
    col2,
    col3,
    CASE
        WHEN condition1 THEN calculation1 
        WHEN condition2 THEN calculation2
        WHEN condition3 THEN calculation3
        WHEN condition4 THEN calculation4
        WHEN condition5 THEN calculation5
        ELSE NULL         
    END AS 'calculatedcol1',
    col4,
    col5 -- etc
FROM table 
```

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2013-05-31T11:45:43.983

您可以结合多个条件来避免这种情况：

```
CASE WHEN condition1 = true AND condition2 = true THEN calculation1 
     WHEN condition1 = true AND condition2 = false 
     ELSE 'what so ever' END, 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2009-02-03T01:58:00.467

我个人就是这样做的，保持嵌入的 CASE 表达式受到限制。我还会发表评论以解释发生了什么。如果它太复杂，请将其分解为函数。

```
SELECT
    col1,
    col2,
    col3,
    CASE WHEN condition THEN
      CASE WHEN condition1 THEN
        CASE WHEN condition2 THEN calculation1
        ELSE calculation2 END
      ELSE
        CASE WHEN condition2 THEN calculation3
        ELSE calculation4 END
      END
    ELSE CASE WHEN condition1 THEN 
      CASE WHEN condition2 THEN calculation5
      ELSE calculation6 END
    ELSE CASE WHEN condition2 THEN calculation7
         ELSE calculation8 END
    END AS 'calculatedcol1',
    col4,
    col5 -- etc
FROM table 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-07-17T14:13:01.843

这是嵌套“复杂”案例语句的简单解决方案：--Nested Case Complex Expression

```
select  datediff(dd,Invdate,'2009/01/31')+1 as DaysOld, 
    case when datediff(dd,Invdate,'2009/01/31')+1 >150 then 6 else
        case when datediff(dd,Invdate,'2009/01/31')+1 >120 then 5 else 
            case when datediff(dd,Invdate,'2009/01/31')+1 >90 then 4 else 
                case when datediff(dd,Invdate,'2009/01/31')+1 >60 then 3 else 
                    case when datediff(dd,Invdate,'2009/01/31')+1 >30 then 2 else 
                        case when datediff(dd,Invdate,'2009/01/31')+1 >30 then 1 end 
                    end
                end
            end
        end
    end as Bucket
from rm20090131atb 
```

只需确保每个案例语句都有一个结束语句

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2015-03-09T08:07:38.527

我们可以将多个条件组合在一起以减少性能开销。

让我们想要执行案例的三个变量 abc 。我们可以这样做：

```
CASE WHEN a = 1 AND b = 1 AND c = 1 THEN '1'
     WHEN a = 0 AND b = 0 AND c = 1 THEN '0'
ELSE '0' END, 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-03T01:42:15.490

用户定义的函数可能会更好地服务，至少隐藏逻辑 - 尤其是。如果您需要在多个查询中执行此操作

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2017-10-16T10:50:06.273

我经历了这个，发现所有答案都超级酷，但是想添加到@deejers 给出的答案

```
 SELECT
    col1,
    col2,
    col3,
    CASE
        WHEN condition1 THEN calculation1 
        WHEN condition2 THEN calculation2
        WHEN condition3 THEN calculation3
        WHEN condition4 THEN calculation4
        WHEN condition5 THEN calculation5         
    END AS 'calculatedcol1',
    col4,
    col5 -- etc
FROM table 
```

您可以将 ELSE 设为可选，因为它不是强制性的，它在许多情况下都非常有用。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-06-24T10:14:52.070

这个例子可能对你有所帮助，图片展示了当有 if 和多个内部 if 循环时 SQL case 语句的样子

[![在此处输入图像描述](https://i.stack.imgur.com/JnVfe.png)](https://i.stack.imgur.com/JnVfe.png)

# visual-studio-2008 - 视觉工作室在构建时没有响应

> ID：505748
> 
> 赞同：3
> 
> 时间：2009-02-03T01:39:13.140
> 
> 标签：visual-studio-2008, build

我对 VS2008 有一个奇怪的问题。我的解决方案有 8 个项目（全部为 c#），并在构建时挂起 VS。任务管理器说“没有响应”，进程占用了我一个核心的 100%，内存使用量逐渐攀升。最终，IDE 再次响应、构建和部署。每次构建时，挂起时间似乎越来越长，但是当我重新启动时，没有挂起，它直接进入构建。有谁知道为什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T02:26:21.657

您可以以记录正在发生的事情的方式运行 Visual Studio。打开您的 IDE 目录，找到 devenv.exe.config，然后添加以下行：

```
 <system.diagnostics>
        <trace autoflush="true" indentsize="4">
            <listeners>
               <add name="myListener" 
type="System.Diagnostics.TextWriterTraceListener, System version=1.0.3300.0, 
Culture=neutral, PublicKeyToken=b77a5c561934e089" 
initializeData="c:\myListener.log" />
               <remove name="Default" />
            </listeners>
        </trace>
    </system.diagnostics> 
```

这应该在您的 c 驱动器上创建一个日志文件（一旦您重新启动 Visual Studio）。请务必先备份现有的 devenv.exe.config。

查看日志，希望您会看到哪些操作导致它需要这么长时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T01:45:51.990

不知道，但是当您使用解决方案在命令行上运行 MSBuild 时会发生什么？会挂吗？如果是这样，请以完整的详细信息再次运行它并查看它挂起的位置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-01-04T13:12:12.883

我有同样的问题。似乎我的防病毒软件 (avast) 将编译的程序检测为恶意软件并阻止它。当我尝试在关闭 avast 的“文件系统屏蔽”的情况下进行构建时，我没有问题。

尝试关闭“文件系统屏蔽”，或者通过“文件系统屏蔽”选项更好地禁用特定文件夹。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-04-30T12:26:37.880

默认情况下，Visual Studio 构建仅使用 1 个核心！

要让构建过程使用所有内核，请使用 MSBuild！

阅读这篇关于[加速 Visual Studio 构建的优秀博客文章](http://www.codeproject.com/Articles/197663/Speed-up-Visual-Studio-Builds)

# crystal-reports - Crystal Reports 2008 connection issue

> ID：505752
> 
> 赞同：0
> 
> 时间：2009-02-03T01:40:05.837
> 
> 标签：crystal-reports

I have migrated Seagate CrystalReports 8 to Visual Studio CrystalReports 2008\. We have used Oracle drivers for CrystalReports 8 provided by the 3rd party vendor. Now we have to use OLEDB for CrystalReports 2008, its throwing errors. Can anyone suggest in this regard?

1.  Can any one suggest step by step process for using stored procedures in Crystal reports with OLEDB.

2.  Migration from CR 8 to CR2008 (use of OLEDB here)

3.  Creating an stored procedure in Crystal Reports 2008 using OLE DB.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T20:45:41.470

我相信 SAP 的官方路线是测试、测试、测试。您已经错过了 CR 的多次迭代（8.5、9、10、XI、2008），并且每一次迭代都有实质性的变化。

你并没有真正使用 CR 来创建存储过程，所以我不确定你在问什么。

# c# - 跨平台线程和 GTK#，不能正常工作？

> ID：505759
> 
> 赞同：5
> 
> 时间：2009-02-03T01:43:29.280
> 
> 标签：c#, cross-platform, gtk#

我正在尝试使用 C#、Linux 上的 mono/GTK# 和 Windows 上的 .NET/GTK# 制作跨平台 C# 应用程序，但是在两个平台下启动顺序似乎需要略有不同：

在 Linux 下：

```
public static void Main (string[] args)
{
    Gdk.Threads.Init ();
    // etc... 
```

在 Windows 下：

```
public static void Main (string[] args)
{
    Glib.Thread.Init ();
    Gdk.Threads.Init ();
    // etc... 
```

两者都要求这样做：Windows 抱怨 g_thread_init() 没有被 linux 代码调用，而 linux 抱怨它已经被 Windows 代码调用。除此之外，这一切都非常好。

我第一次尝试“解决方案”看起来像：

```
public static void Main (string[] args)
{
    try {
        Gdk.Threads.Init ();
    } catch (Exception) {
        GLib.Thread.Init ();
        Gdk.Threads.Init ();
    }
    // etc... 
```

但即使是这种混乱的解决方案也行不通；该错误来自 GTK+，非托管代码，因此无法捕获。有没有人对问题的原因有任何好的想法，以及如何解决它？或者，如果做不到这一点，对如何检测应该在运行时调用哪一个有很好的想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-11T14:38:39.220

Win32 上的 Gtk+ 不能正确支持线程。您需要从调用 Gtk.Main() 的同一线程中执行所有 GUI 调用。

它实际上并不像听起来那么糟糕。您可以使用一个技巧将函数分派到主线程。只需从任何线程使用 GLib.Idle.Add() ，该函数将在主循环运行的同一线程中被调用。只要记住在空闲处理函数中返回 false ，否则它将永远运行。

如果您遵循并使用上述技术，您甚至根本不需要调用 Gdk.Threads.Init()。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-08T22:41:38.920

我不确定这是否适用于 Mono，但您可以使用 Environment 类来确定程序在哪个操作系统上运行。

```
public static void Main (string[] args)
{
    PlatformID platform = Environment.OSVersion.Platform;
    if (platform == PlatformID.Win32NT ||
        platform == PlatformID.Win32S ||
        platform == PlatformID.Win32Windows)
        Glib.Thread.Init();
    else if (platform != PlatformID.Unix)
        throw new NotSupportedException("The program is not supported on this platform");

    Gdk.Threads.Init();
    // etc... 
```

[PlatformID](http://msdn.microsoft.com/en-us/library/3a8hyw88.aspx)枚举不仅包含 Windows 和 Unix，因此您应该检查其他值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-08T22:58:04.013

实际上，这可能是 GDK 的 C# 绑定或您的 GDK 版本中的错误。根据必须`gdk\_threads\_init(), g\_thread\_init()`首先调用的文档，GTK# 文档也是这样说的：

> `GLib.Thread.Init()`必须在之前调用`Gdk.Threads.Init()`。

`gdk\_threads\_init()`在我的 Linux 机器上（使用 GDK 2.14.4），一个调用但没有调用的 C 程序会`g\_thread\_init()`打印一条错误消息并以错误终止。您是否确保在 Linux 和 Windows 上具有相同的 GDK 版本，并且 Linux 上的版本（如果它与 Windows 版本不同）也需要调用`g\_thread\_init()`，或者如果它在两个版本之间发生了更改. 最后，检查该程序是否因错误而终止：

```
#include <gdk/gdk.h>

int main(int argc, char **argv) {
    gdk_threads_init();

    return 0;
}
```

编译它`gcc -o test `pkg-config --cflags --libs gdk-2.0` test.c`
（假设您已将其保存为 test.c。）

如果该程序因错误而终止，则说明您的 GDK# 库中存在错误。
如果没有，那是您的 GDK 版本中的错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-08T22:40:53.727

嗯，你试过用 [STAThread] 属性装饰你的 Main 方法吗？

例如

```
#if !Mono //or whatever  
[STAThread]  
#endif  
public static void Main (string[] args)  
{  
    Gdk.Threads.Init ();  
    ...  
} 
```

如果你不能像这样使用条件编译......

```
public static void Main (string[] args)  
{  
    Gdk.Threads.Init ();  
#if !Mono //or whatever  
    Gdk.Threads.Init ();  
#endif
    ...  
} 
```

# c# - 未找到段“属性”的资源

> ID：505761
> 
> 赞同：15
> 
> 时间：2009-02-03T01:45:25.937
> 
> 标签：c#, wcf-data-services

当使用 ADO.Net 数据服务客户端通过调用刷新实体时`LoadProperty`：

```
ctx.BeginLoadProperty(this, "Owner", (IAsyncResult ar) => ... 
```

如果属性是，它会在服务器上引发错误`null`

> 错误：抛出异常：System.Data.Services.DataServiceException：找不到段“所有者”的资源。在 System.Data.Services.RequestDescription.GetSingleResultFromEnumerable(SegmentInfo segmentInfo) 在 System.Data.Services.DataService1.CompareETagAndWriteResponse(RequestDescription description, ContentFormat responseFormat, IDataService dataService)
> 在 System.Data.Services.DataService1.SerializeResponseBody(RequestDescription description, IDataService dataService ) 在 System.Data.Services.DataService1.HandleNonBatchRequest(RequestDescription description) 在 System.Data.Services.DataService`1.HandleRequest()

问题是客户不知道该属性是否`null`已填充或尚未填充。属性 Owner 是从 a`Vehicle`到 a的链接`Customer`。

有什么想法有什么问题吗？

谢谢

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2011-05-13T05:50:18.040

将服务上下文的[IgnoreResourceNotFoundException](http://msdn.microsoft.com/en-us/library/system.data.services.client.dataservicecontext.ignoreresourcenotfoundexception.aspx)属性设置为 true：

```
svc.IgnoreResourceNotFoundException = true; 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-12-06T15:24:43.170

当主键不存在时，查询主键会产生异常。解决方法是在条件中添加一个虚拟真表达式（例如：1==1 && item.Id == XXX）。

如果没有虚拟表达式，ADO.NET 请求是：

> http://localhost//test.svc/Role(XXX)

在虚拟条件下，请求是：

> http://localhost//test.svc/Role()?$filter=true and (Id eq 1)

在第二种情况下，预期的行为（返回 null）是正确的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-10T04:36:43.847

我也收到了“未找到段'属性'的资源”错误。我的似乎是在我按主键查找的 where 子句中。我发现一些资源说它会在使用不存在的主键时抛出错误（即使使用 FirstOrDefault()）（与其他不提供结果的 where 子句相反）。我猜类似的事情正在发生在你自己身上。

# php - PHP/Web 开发人员不应该没有哪些工具？

> ID：505772
> 
> 赞同：6
> 
> 时间：2009-02-03T01:50:26.020
> 
> 标签：php, development-environment

有很多用于 PHP 开发的 IDE，但我很好奇人们每天使用的所有其他出色的小工具、应用程序和网站，以使 PHP 开发更容易一些。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-03T18:30:04.753

我有一整套工具，我离不开：

*   **带有 PHP 开发工具的 Eclipse（或用于 Eclipse 的 Zend Studio）** ——这两个都是很棒的 IDE，具有很棒的 PHP 编辑功能。它们现在还提供 CSS 和 JavaScript (JS) 编辑功能。使用现有的 Eclipse 扩展，您可以获得大量开箱即用的功能
*   **Notepad++** - 很棒的小文本编辑器，带有语法高亮和标签。我用它来快速编辑和编辑会减慢 eclipse 的巨大文本文件。
*   **Filezilla** - 如果您在 Windows 上，那么我建议 Filezilla 作为首选的 FTP 应用程序。它工作得很好，速度相对较快，而且是免费的。
*   **PuTTY** - 有时您需要通过 SSH 连接到远程服务器。将此用于您的终端命令。我每天都用它。
*   **浏览器**- 您需要进行测试，因此您应该在系统上合理安装所有浏览器。Firefox、Opera、Internet Explorer、Safari、Chrome 等
*   **Firebug** - 终极前端调试工具。我数不清有多少次 Firebug 帮助我破译我的代码或我正在处理的遗留系统的问题。
*   **FirePHP** - 另一个很棒的工具。这个挂钩到 Firebug 并允许您利用服务器端 PHP 库来生成将作为日志消息输出的自定义标头。您可以记录数组、字符串、整数、双精度数等。
*   **SVN** - 这是一个显而易见的。如果您没有以某种方式使用源代码管理，那么您只是没有安全地进行开发。在 Windows 上，我使用 TortoiseSVN，除非我在我的 IDE 中，然后我使用内置的 SVN 支持。
*   **Redmine** - 很棒的项目管理工具（在 RoR 中），让我的生活变得无比轻松。它是非常可定制的，将帮助您在整个项目中拥有良好的工作流程。
*   **Harvest** - 使用大多数主要操作系统的小部件托管时间跟踪。如果你正在开发，你最好跟踪你的时间，这样你就知道它的去向。
*   **Adobe CS** - 如果您与设计师一起工作，那么他们将向您发送您需要编码的 PSD 文件。如果您没有 Adob​​e Create Suite（某些版本），那么您将处于严重劣势。
*   **jQuery** - 我讨厌在没有库的情况下编写 JavaScript。jQuery 很棒，它让你觉得你可以随时做任何事情。它的插件集合同样令人惊叹，我推荐这个 JS 框架胜过其他任何框架。

这几乎是我能想到的所有东西，但它几乎是我每天使用的所有东西。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-03T22:07:16.733

我很惊讶到目前为止还没有人提到 XDebug。在您的开发中打开 XDebug 并享受分析、堆栈跟踪以及如果您的 IDE 支持它，还有断点。最有价值的工具。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-03T02:07:57.933

我不能没有：

*   带有 Aptana 插件的 Eclipse（允许我在几乎无缝的环境中开发 html、javascript、php 和 css）和 Subclipse 插件（用于与 subversion 集成）
*   Firebug, Web Developer Toolbar, YSlow, Firefox Throttle
*   本地 XAMPP 安装
*   用于 MySQL 开发的 SQLYog

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-03T02:09:46.090

我使用 Aptana 作为 IDE。

它集成了 FTP 和出色的 HTML、JavaScript 和 PHP 代码提示和完成（使用插件）。

[http://aptana.com/studio/download](http://aptana.com/studio/download) <- 免费社区版（我用的）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-03T17:53:23.237

1) 编辑器：TextMate，我真的很喜欢这个编辑器。

2) 调试：在软件中编写健壮的错误报告、Firebug & Web Developer（firefox 插件）和 apache weblog 解析的组合

3) 工具：jQuery 是我现在最喜欢的玩具，我用它做了很多巧妙的事情，并真正将一些数据库驱动的管理应用程序“带入生活”。

4) 框架：我还没有为 PHP 开发实现一个框架。除了我整理的一些片段和东西之外，我几乎所有的东西都是手写的。我*真的*很想采用一个框架，但只是没有时间坐下来学习一个.. 我已经准备好使用 Cake 或 CI 了——你们怎么看？

5) 跨浏览器测试：老实说，我只是使用现场机器。我听说过有关 browsershots.org 的事情很复杂，还没有研究过其他选项。我们只是在多个平台/浏览器上测试我们所有的东西，以确保全面兼容。

*   尼古拉斯

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-03T02:05:44.943

在我的脑海中 - 我不能没有的东西：

1.  一个很好的轻量级 MVC 框架（对我来说特别是 CodeIgniter）
2.  我自己的单元测试框架，Toast
3.  一个类似于本地“LAMP”的环境（对我来说是 MAMP，因为我在 Mac 上 - 它实际上是一键安装，一切正常）
4.  jQuery
5.  用于基准测试的 ApacheBench (ab)
6.  我的 Macbook（为了稳定性和防间谍软件 - 我现在确实完成了比使用 Windows 时更少的挫败感更多的工作）
7.  browsershots.org
8.  Firefox 插件：Web Developer 和/或 Firebug（使用 YSlow 和 FirePHP）

其他应该在这个列表中，但不是，因为我个人还没有找到合适的工具：

*   SVN
*   一个非常好的 FTP (?) 客户端，可以让我的 IDE、本地和远程环境完全同步
*   一个好的、用户友好的项目管理和错误跟踪系统
*   一个好的 CSS 框架

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T02:09:42.517

PHP 项目可以存储在 Team Foundation Server 中。这提供了端到端的项目管理、流程管理、应用程序生命周期、源代码控制、构建自动化和报告。

我知道这个答案不太可能得到很多“提升”，但如果你知道自己在做什么，TFS 可以对任何语言的项目产生惊人的影响。就在最近，我将大型机 Cobol 迁移到 TFS 中，效果很好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-03T02:12:28.080

没有我就活不下去；1.codeigniter框架。2.Filezilla ftp。3.和好的IDE，

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-04T15:51:21.580

**phpMyAdmin**（当然，假设您使用的是 MySQL）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-03-23T15:31:33.763

您还没有提到您正在使用什么操作系统，所以我无法将我的列表用于可能对您有用的内容：

*   vim
*   电子标签
*   php_codesniffer
*   php_unit
*   硒
*   php_uml
*   网豆
*   pman（命令行上的php手册）
*   用于错误跟踪的螳螂
*   颠覆/git
*   PEAR（同时使用 pear 组件和部署项目）
*   带有这些扩展的火狐：
    *   萤火虫
    *   抓屏
    *   Web开发人员
    *   假口红
    *   慢
*   solyp 的 SQL Developer 也派上用场了

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-04T15:41:01.193

PhpEd 用于 PHP 调试、单步调试代码、运行临时命令等。非常好用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-04T19:57:15.607

Zend Step 调试器 / Zend Studio

php.net 的文档

任何带有语法高亮的 IDE。

我想您现在可以将 stackoverflow 添加到该列表中:)

# sql - 如何获取SQL表中的下一条记录

> ID：505780
> 
> 赞同：2
> 
> 时间：2009-02-03T01:57:26.113
> 
> 标签：sql, sql-server, sql-server-2005

我的 MS SQL 表中有一组记录。以日期为主键。但日期仅适用于工作日，而不适用于连续日。例如：

2000年1月3日12:00:00 AM 5209.540000000 5384.660000000 5209.540000000 5375.110000000 2000年1月4日12:00:00 AM 5533.980000000 5533.980000000 5376.430000000 5491.010000000 2000年1月5日12:00:00 AM 5265.090000000 5464.350000000 5184.480000000 5357.000000000 2000年1月6日12:00:00 AM 5424.210000000 5489.860000000 5391.330000000 5421.530000000 2000年1月7日12:00:00 AM 5358.280000000 5463.250000000 5330.580000000 5414.480000000 2000年1月10日12:00:00 AM 5617.590000000 5668.280000000 5459.970000000 5518.390000000 2000年1月11日12:00:00上午 5513.040000000 5537.690000000 5221.280000000 5296.300000000 2000 年 1 月 12 日 12:00:00 上午 5267.850000000 5494.300000000 5267491000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

在这个我试图在表中引入一个新列，它的值应该是第 3 列的值减去前一个工作日的第 3 列的值。请帮我写这样的查询。我发现这很困难，因为周末没有日期。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T02:13:40.153

有几种方法可以做到这一点。这是一个。

```
CREATE TABLE MyTable
(
    MyDate datetime NOT NULL PRIMARY KEY,
    Col2 decimal(14,4) NOT NULL,
    Col3 decimal(14,4) NOT NULL,
    Col4 decimal(14,4) NOT NULL,
    Col5 decimal(14,4) NOT NULL
)
GO

INSERT INTO MyTable
SELECT '1/3/2000 12:00:00 AM', 5209.540000000, 5384.660000000, 5209.540000000, 5375.110000000 
 UNION ALL 
SELECT '1/4/2000 12:00:00 AM', 5533.980000000, 5533.980000000, 5376.430000000, 5491.010000000
 UNION ALL 
SELECT '1/5/2000 12:00:00 AM', 5265.090000000, 5464.350000000, 5184.480000000, 5357.000000000
 UNION ALL 
SELECT '1/6/2000 12:00:00 AM', 5424.210000000, 5489.860000000, 5391.330000000, 5421.530000000 
 UNION ALL 
SELECT '1/7/2000 12:00:00 AM', 5358.280000000, 5463.250000000, 5330.580000000, 5414.480000000 
 UNION ALL 
SELECT '1/10/2000 12:00:00 AM', 5617.590000000, 5668.280000000, 5459.970000000, 5518.390000000 
 UNION ALL 
SELECT '1/11/2000 12:00:00 AM', 5513.040000000, 5537.690000000, 5221.280000000, 5296.300000000 
 UNION ALL 
SELECT '1/12/2000 12:00:00 AM', 5267.850000000, 5494.300000000, 5267.850000000, 5491.200000000
GO

CREATE VIEW MyView 
AS
SELECT T1.*,
    CalculatedColumn = Col3 - 
      (SELECT Col3 FROM MyTable Q2
       WHERE Q2.MyDate = (SELECT MAX(Q1.MyDate) 
                          FROM MyTable Q1 
                          WHERE Q1.MyDate < T1.MyDate)
    )
FROM MyTable T1
GO

SELECT * FROM MyView
GO 
```

**结果**

```
MyDate                  Col2      Col3      Col4      Col5      CalculatedColumn
----------------------- --------- --------- --------- --------- ----------------
2000-01-03 00:00:00.000 5209.5400 5384.6600 5209.5400 5375.1100 NULL
2000-01-04 00:00:00.000 5533.9800 5533.9800 5376.4300 5491.0100 149.3200
2000-01-05 00:00:00.000 5265.0900 5464.3500 5184.4800 5357.0000 -69.6300
2000-01-06 00:00:00.000 5424.2100 5489.8600 5391.3300 5421.5300 25.5100
2000-01-07 00:00:00.000 5358.2800 5463.2500 5330.5800 5414.4800 -26.6100
2000-01-10 00:00:00.000 5617.5900 5668.2800 5459.9700 5518.3900 205.0300
2000-01-11 00:00:00.000 5513.0400 5537.6900 5221.2800 5296.3000 -130.5900
2000-01-12 00:00:00.000 5267.8500 5494.3000 5267.8500 5491.2000 -43.3900 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T02:07:04.443

你需要把它分成两部分。首先是更新现有数据，其次是确保所有新数据都具有正确的附加值。

对于第一部分，考虑使用 CURSOR。运行可能需要一段时间，但至少你只运行一次。像 FOR 循环一样使用 CURSOR；遍历数据中的每一行，忽略第一行（因为您没有指定在没有上一个日期时如何计算新列的值）。以防万一，您很可能应该按日期升序排序。

在您迭代时，使用变量来存储该行中的值。循环时，将这些变量复制到以前的行版本中，然后再获取新行。例如，您有一个名为“Col3”的变量和另一个名为“lastCol3”的变量。在循环到下一行（即光标移动到下一行）之前，将 col3 的值复制到 lastCol3 中，然后获得 col3 的新值。现在您拥有每行的当前值和以前的值，并且可以调用“更新”来更新新列。

对于未来的新数据，您需要确保提供新值，或者如果您希望 SQL Server 执行此操作，请使用存储过程选择最近的行 col3，并在插入之前使用该值计算新值到表中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T02:15:13.490

使用自联接和利用 SQLServers 内置日期函数的 case 语句`datepart(dw,@Date)`。

我确实有责任注意到，首先进行这样的转变可能是一个坏主意。

# orm - Telerik OpenAccess

> ID：505789
> 
> 赞同：3
> 
> 时间：2009-02-03T02:02:48.570
> 
> 标签：orm, telerik

有人用过这个ORM吗？

[Telerik OpenAccess](http://www.telerik.com/products/orm.aspx)

批评/赞美？我在一个在其他 Telerik 场所投入巨资的办公室工作，我想更多地了解他们的最新产品以及是否应该避免使用它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T17:00:53.147

我正在测试它，免费的 Express 版本。

**优点**

*   性能（开箱即用的缓存、延迟加载等）
*   易于集成
*   出色的 VS.NET 集成，向导
*   酷社区

**缺点**

*   缺少真正的分布式架构支持和模式
*   向导隐藏配置文件，有时您必须手动修复
*   SQL CE 支持仍然缺失

Chris 是对的，但是 Entity Framework 像 beta 一样工作，并且 OA 也支持 LINQ。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T20:28:35.950

就个人而言，我认为.net 的 Linq 及其实体框架是自切片面包以来最好的。我也经常使用 Telerik，并研究了他们所做的一切，但 ORM 无法与 M$ .NET Linq 相提并论。

克里斯

# seo - Do SEO-friendly URLs really affect a page's ranking?

> ID：505793
> 
> 赞同：34
> 
> 时间：2009-02-03T02:03:49.923
> 
> 标签：seo, friendly-url

SEO-friendly URLs are all the rage these days. But do they actually have a meaningful impact on a page's ranking in Google and other search engines? If so, why? If not, why not?

(Note that I would absolutely agree that SEO-friendly URLs are nicer to use for human beings. My question is whether they actually make a difference to the ranking algorithms.)

**Update:** As it turns out, the Google post that endorphine points to [here](http://googlewebmastercentral.blogspot.com/2008/09/dynamic-urls-vs-static-urls.html) has caused tremendous confusion in the SEO community. For a sampling of the discussion, see [here](http://www.seomoz.org/blog/dynamic-urls-vs-static-urls-the-best-practice-for-seo-is-still-clear), [here](http://sphinn.com/story/74404), and [here](http://searchengineland.com/google-says-dont-rewrite-dynamic-urls-to-static-urls-14795). Part of the problem is that the Google post is addressing the worst case where URL rewriting is done poorly and so you'd be better off sticking with a dynamic URL rather than a mangled static "SEO-friendly" URL.

There's no question dynamic URLs can be crawled by Google and can achieve high rankings. Maybe it would be easier to reframe the question more concretely: given 2 otherwise equivalent pages, which will rank higher for the search "do seo friendly urls really affect page ranking"?

A) [Do SEO-friendly URLs really affect a page's ranking?](https://stackoverflow.com/questions/505793/do-seo-friendly-urls-really-affect-a-pages-ranking)

or

B) [http://stackoverflow.com?question=505793](http://stackoverflow.com?question=505793) (a fake URL for comparison only)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-03T02:09:43.033

I will let google answer to your question:

[http://googlewebmastercentral.blogspot.com/2008/09/dynamic-urls-vs-static-urls.html](http://googlewebmastercentral.blogspot.com/2008/09/dynamic-urls-vs-static-urls.html)

In the article:

> Which can Googlebot read better, static or dynamic URLs? [...]While static URLs might have a slight advantage in terms of clickthrough rates because users can easily read the urls, the decision to use database-driven websites does not imply a significant disadvantage in terms of indexing and ranking. Providing search engines with dynamic URLs should be favored over hiding parameters to make them look static

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-03T04:18:24.380

即使搜索引擎没有给你的页面一个更好的排名，你仍然应该为用户这样做。搜索引擎优化的任何好处都只是在您的网站上锦上添花。

SEOmoz 有一篇文章，其中包含有关[URL 最佳实践](http://www.seomoz.org/blog/11-best-practices-for-urls)的建议以及每个对可用性或搜索引擎有帮助的原因。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-03T15:41:41.287

除了轶事证据外，我认为这个问题不容易回答，因为没有两页“在其他方面是等效的”足以衡量您所要求的意义。除了出现并泄露答案的谷歌搜索工程师之外，如果存在仅限于此属性的人，您不太可能得到明确的答案；更有可能的是，你会得到一长串最有可能的结果。

但我确实喜欢描述性 URL 改善用户体验的建议。我认为对于短 URL 来说确实如此（例如，“/help”或“/ask”等）。当与创建此类 URL 方案的成本（有时可能很昂贵）进行权衡时，人们只需要确定这种好处对项目的价值有多大；我有几个客户在这项工作上花费了数千美元，但对搜索排名没有任何可衡量的影响。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-29T18:52:22.310

关键字频率和页面排名确实是 SEO 中的两个主要因素。

因此，在您的 URL 中包含关键字是可取的。

例如[http://my_site.com/article/keyword](http://my_site.com/article/keyword)比[http://mysite.com/article/42好](http://mysite.com/article/42)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-29T19:23:03.230

在其他条件相同的情况下，两个页面都将达到相同的 pagerank。Pagerank 取决于有多少人链接到您以及他们的页面排名是多少。因此，它不会影响您的 pagerank。

但这确实会影响您最终在搜索结果中的排名。在搜索索引中，不仅页面排名很重要，关键字相关性也很重要。如果您的网址中有关键字并且有人搜索它们，那么您的页面将更相关并且在搜索结果中更高。此外，当人们链接到您时，他们用来链接到您的关键字丰富的 URL 也将提高您的相关性。

不要盯着pagerank看自己。没关系。重要的是你被人们发现了。Pagerank 只是其中的一小部分（并且一直在减少）。

# wpf - 隐藏 wpf 中的默认调整大小夹点

> ID：505811
> 
> 赞同：11
> 
> 时间：2009-02-03T02:11:26.693
> 
> 标签：wpf, resizegrip

我在 WPF 中有一个无边框透明窗口，底部有一些花哨的装饰。有一个带有一些非常规曲线的自定义页脚，并且没有显示公司徽标。这个窗口需要像传统窗口一样通过右下角的手柄来调整大小。

无论如何，我已经将我自己的 ResizeGrip 放在了实际上在页脚上的地方，但是默认的抓地力仍然显示出来，并且由于不可见的窗口它在空间中浮动。

如何隐藏默认的 ResizeGrip？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-03T02:32:45.483

调整大小夹点的外观是通过 Window 上的[ResizeMode](http://msdn.microsoft.com/en-us/library/system.windows.window.resizemode.aspx)依赖属性控制的。

如果设置为 CanResizeWithGrip：

```
<Window x:Class="WpfApplication1.Window1"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Window1" Height="50" Width="150" 
        WindowStyle="None" AllowsTransparency="True" Background="#19FFFFFF"
        ResizeMode="CanResizeWithGrip">
    <Grid></Grid>
</Window> 
```

窗口将如下所示：

[![带握把](https://i.stack.imgur.com/KTAtJ.png)](https://i.stack.imgur.com/KTAtJ.png)

如果设置为 CanResize（默认）：

```
<Window x:Class="WpfApplication1.Window1"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Window1" Height="50" Width="150" 
        WindowStyle="None" AllowsTransparency="True" Background="#19FFFFFF"
        ResizeMode="CanResize">
    <Grid></Grid>
</Window> 
```

窗口将如下所示：

[![可以调整大小](https://i.stack.imgur.com/FMgAY.png)](https://i.stack.imgur.com/FMgAY.png)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-03T19:38:13.663

因此，为了隐藏默认夹点，我覆盖了默认的 ResizeGrip 样式，使其可见性被隐藏。借助 Expression Blend 2 轻松实现。

```
<Style TargetType="{x:Type ResizeGrip}">
    <Setter Property="MinWidth" Value="{DynamicResource {x:Static SystemParameters.VerticalScrollBarWidthKey}}"/>
    <Setter Property="MinHeight" Value="{DynamicResource {x:Static SystemParameters.HorizontalScrollBarHeightKey}}"/>
    <Setter Property="Background" Value="Transparent"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type ResizeGrip}">
                <Grid SnapsToDevicePixels="True" Background="{TemplateBinding Background}">
                </Grid>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
    <Setter Property="Visibility" Value="Hidden"/>
</Style> 
```

然后，我在自定义窗口装饰上设置了自己的 ResizeGrip，其样式与默认夹点样式相同。

```
<SolidColorBrush x:Key="ResizeGripperForeground" Color="#B8B4A2"/>
<Style x:Key="VisibleResizeGrip" TargetType="{x:Type ResizeGrip}">
    <Setter Property="MinWidth" Value="{DynamicResource {x:Static SystemParameters.VerticalScrollBarWidthKey}}"/>
    <Setter Property="MinHeight" Value="{DynamicResource {x:Static SystemParameters.HorizontalScrollBarHeightKey}}"/>
    <Setter Property="Background" Value="Transparent"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type ResizeGrip}">
                <Grid SnapsToDevicePixels="True" Background="{TemplateBinding Background}">
                    <Path Fill="White" HorizontalAlignment="Right" Margin="0,0,2,2" VerticalAlignment="Bottom" Data="M 8,0 L 10,0 L 10,2 L 8,2 Z M 4,4 L 6,4 L 6,6 L 4,6 Z M 8,4 L 10,4 L 10,6 L 8,6 Z M 0,8 L 2,8 L 2,10 L 0,10 Z M 4,8 L 6,8 L 6,10 L 4,10 Z M 8,8 L 10,8 L 10,10 L 8,10 Z"/>
                    <Path Fill="{StaticResource ResizeGripperForeground}" HorizontalAlignment="Right" Margin="0,0,3,3" VerticalAlignment="Bottom" Data="M 8,0 L 10,0 L 10,2 L 8,2 Z M 4,4 L 6,4 L 6,6 L 4,6 Z M 8,4 L 10,4 L 10,6 L 8,6 Z M 0,8 L 2,8 L 2,10 L 0,10 Z M 4,8 L 6,8 L 6,10 L 4,10 Z M 8,8 L 10,8 L 10,10 L 8,10 Z"/>
        <Path Data="M8,0L10,0 10,2 8,2z M4,4L6,4 6,6 4,6z M8,4L10,4 10,6 8,6z M0,8L2,8 2,10 0,10z M4,8L6,8 6,10 4,10z M8,8L10,8 10,10 8,10z" Fill="White" HorizontalAlignment="Right" Margin="0,0,2,2" VerticalAlignment="Bottom" />
        <Path Data="M8,0L10,0 10,2 8,2z M4,4L6,4 6,6 4,6z M8,4L10,4 10,6 8,6z M0,8L2,8 2,10 0,10z M4,8L6,8 6,10 4,10z M8,8L10,8 10,10 8,10z" Fill="{StaticResource ResizeGripperForeground}" HorizontalAlignment="Right" Margin="0,0,3,3" VerticalAlignment="Bottom" />
      </Grid>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

# sql - 如何根据另一字段中的查找值返回一个字段中的值

> ID：505838
> 
> 赞同：5
> 
> 时间：2009-02-03T02:29:26.317
> 
> 标签：sql, database, vba, ms-word, ms-office

这是基本的东西，但我对 VBA 和 Word/Access 对象模型有些陌生。

我有一个包含大约 117000 条记录的两列数据库。列是“姓”和“计数”。我希望用户能够在文本框中输入 SMITH 并点击提交。然后我想运行类似的东西

`SELECT table.count FROM table WHERE surname = string`

并以字符串形式返回 table.count 的值。

感觉这应该是五六行代码（我有但不会发布）但我显然错过了一些东西！

干杯

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T03:32:59.637

首先，小心命名列“count”——这是 SQL 中的关键字，可能会导致问题。同样，不要称表为“表”。

这是一些示例代码，它显示了一种方法：

```
' This example uses Microsoft ActiveX Data Objects 2.8,
' which you have to check in Tools | References

' Create the connection. This connection may be reused for other queries.
' Use connectionstrings.com to get the syntax to connect to your database:
Dim conn As New ADODB.Connection
conn.Open "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=c:\tmp\Database1.accdb"

Dim cmd As New ADODB.Command
Set cmd.ActiveConnection = conn

' Replace anything which might change in the following SQL string with ?

cmd.CommandText = "select ct from tbl where surname = ?"

' Create one parameter for every ?

Dim param As ADODB.Parameter
Set param = cmd.CreateParameter("surname", adBSTR, adParamInput, , TextBox1.Text)
cmd.Parameters.Append param

Dim rs As ADODB.Recordset
Set rs = cmd.Execute

MsgBox rs("ct")

rs.Close
conn.Close 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T13:12:25.783

可以使用 InsertDatabase：

```
Sub GetData()
    ActiveDocument.Bookmarks("InsertHere").Select

    Selection.Range.InsertDatabase Format:=0, Style:=0, LinkToSource:=False, _
        Connection:="TABLE Members", SQLStatement:= _
        "SELECT [Count] FROM [Members]" _
        & " WHERE Surname='" _
        & ActiveDocument.FormFields("Text1").Result & "'", _
        DataSource:="C:\docs\ltd.mdb", From:=-1, To:= _
        -1, IncludeFields:=True
End Sub 
```

这是使用数据库工具栏记录的已编辑宏。

**已编辑**警告：如图所示，此代码受到 SQL 注入攻击。

# printing - 使用 WPF XPS 查看器打印 XPS 时的默认布局方向

> ID：505839
> 
> 赞同：2
> 
> 时间：2009-02-03T02:30:24.863
> 
> 标签：printing, xps, xpsdocument, xpsviewer

使用 WPF XPS 查看器打印 XPS 时，是否可以设置默认布局方向？

我的固定文档 XPS 将其页面方向设置为横向，页面媒体大小的宽度大于其高度，并且它在查看器中正确显示为横向。只是当您点击打印按钮时，“打印对话框”首选项默认为“纵向”并且它会这样打印。

我宁愿不必更改用户的默认打印设置，如果 XPS Viewer 能够按照设计打印的方式打印 XPS，我会更喜欢它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2015-11-24T13:46:54.507

填写 PrintTicket 的字段：

```
 PrintDialog pd = new PrintDialog();
  PrintTicket pt = new PrintTicket();
  pt.PageOrientation = PageOrientation.Landscape;
  pd.PrintTicket = pd.PrintQueue.MergeAndValidatePrintTicket(pd.PrintQueue.DefaultPrintTicket, pt).ValidatedPrintTicket;
  if (pd.ShowDialog() == true)
  {
    ...
  } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-15T20:10:50.920

这实际上不是 MXDW 的问题，而是驱动程序在 Windows 上的工作方式的问题。为特定会话保存用户选择。这意味着您可以在第一次打印和退出应用程序之间打印时重复使用首次打印设置。大多数打印机都以这种方式运行，除非有人想出一种方法将这些信息保存在某个地方并让用户在会话中重复使用它。

因此，我尝试破解 GPD 文件（通常存储打印机的打印信息）。方向有两个可能的值：PORTRAIT 和 LANDSCAPE_CC270，默认设置为 PORTRAIT。见下文：

*%************************************************ ****************************** *％ 方向 *％*************** ****************************************************** ************* *特征：方向{ *rcNameID：=ORIENTATION_DISPLAY *默认选项：肖像

```
*Option: PORTRAIT
{
    *rcNameID: =PORTRAIT_DISPLAY
}

*Option: LANDSCAPE_CC270
{
    *rcNameID: =LANDSCAPE_DISPLAY
} 
```

}

现在，如果我将交换默认值更改为 LANDSCAPE_CC270，打印首选项将停止出现（并且任何打印都会失败）。事实上，似乎指定任何其他值都会将默认值保留为 PORTRAIT。当然，MS 正在做某种检查以防止我们破解这个驱动程序。看起来微软不想让任何人篡改它的设置:(

但是你可以尝试更多地调整 GPD 值，看看是否有你喜欢的东西出现。将继续黑客攻击多一点。

警告：如果您不知道自己在做什么，则不应篡改 GPD 文件。如果你还想继续做备份！

提示：它们存储在`%WINDOWS%system32\spool\drivers\w32x86\3`文件夹中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-10T04:44:29.397

我相信在创建 FixedDocument 时执行此操作的正确方法是在尺寸高于宽度时在页面内容上设置 RenderTransform = RotateTransform(90)。例子：

```
var visualContent = new Image
            {
                Source = image,
                Stretch = Stretch.Uniform
            };
visualContent.RenderTransformOrigin = new Point(0.5, 0.5);    
visualContent.RenderTransform = new RotateTransform(90);
FixedPage fixedPage = new FixedPage();
fixedPage.Children.Add(visualContent);
var pageContent = new PageContent
{
    Child = fixedPage
}; 
```

但是，不确定这是否有助于预先存在的 XPS 文档。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-10-09T16:34:54.707

```
<Grid Margin="0,0,-8,-8">
    <Grid.RowDefinitions>
        <RowDefinition Height="*"/>
        <RowDefinition Height="50"/>
    </Grid.RowDefinitions>

    <FlowDocumentScrollViewer Name="printpanel" HorizontalAlignment="Left" Width="959" FontFamily="Arial" Margin="0,-10,0,10">
        <FlowDocument x:Name="FD">

            <BlockUIContainer>

                <Canvas>
                    <Label x:Name="lblReceipt" Visibility="Visible" Content="Receipt No." HorizontalAlignment="Left" VerticalAlignment="Top" Canvas.Top="178" FontSize="12" Canvas.Left="60"/>
                    <Label x:Name="txtReceiptNo" BorderThickness="2" BorderBrush="Black" HorizontalAlignment="Left"  Padding="10,3,3,0" Height="23"   VerticalAlignment="Top" Width="200" FontSize="12" Canvas.Left="187" Canvas.Top="177" FontFamily="Arial"/>
                    <Label x:Name="lblmemNo" Visibility="Visible" Content="Membership No." HorizontalAlignment="Left" VerticalAlignment="Top" FontSize="12" Canvas.Left="462" Canvas.Top="177"/>
                    <Label x:Name="txtMembershipNo"  BorderThickness="2" BorderBrush="Black" HorizontalAlignment="Left" Padding="10,3,3,0" Height="23"  VerticalAlignment="Top" Width="177" FontSize="12" Canvas.Left="604" Canvas.Top="177" FontFamily="Arial">

                    </Label>
                    <Label x:Name="lblAuthCentr" Visibility="Visible" Content="Authorised Center." HorizontalAlignment="Left" VerticalAlignment="Top" Canvas.Left="60" Canvas.Top="221" FontSize="12"/>
                    <TextBox x:Name="txtAuthCentr"   HorizontalAlignment="Left" TextWrapping="WrapWithOverflow" Padding="10,3,3,0" Height="38"  VerticalAlignment="Top" Width="219" FontSize="12" Canvas.Left="238" Canvas.Top="219" FontFamily="Arial"/>
                    <Label x:Name="lblSector" Visibility="Visible" Content="Sector." HorizontalAlignment="Left" VerticalAlignment="Top" FontSize="12" Canvas.Left="492" Canvas.Top="220"/>
                    <Label x:Name="txtSector" BorderThickness="2" BorderBrush="Black"  HorizontalAlignment="Left" Padding="10,3,3,0" Height="23"  VerticalAlignment="Top" Width="115" FontSize="12" Canvas.Left="567" Canvas.Top="220" FontFamily="Arial"/>

                </Canvas>
            </BlockUIContainer>

        </FlowDocument>
    </FlowDocumentScrollViewer>

    <Button Name="btnOk" Content="Print" Height="30" Grid.Row="1" Click="btnOk_Click" Margin="355,0,404,0"></Button>
</Grid> 
```

只需设置 FlowDocument 的高度和宽度

设置 FD.PageWidth = 1100; FD.PageHeight = 600;

```
 private void btnOk_Click(object sender, RoutedEventArgs e)
        {

            if (File.Exists("printPreview.xps"))
            {
                File.Delete("printPreview.xps");
            }
            var xpsDocument = new XpsDocument("printPreview.xps", FileAccess.ReadWrite);
            XpsDocumentWriter writer = XpsDocument.CreateXpsDocumentWriter(xpsDocument);
            DocumentPaginator docPage;
            FD.PageWidth = 1100; // set FlowDocument Width
            FD.PageHeight = 600; // set FlowDocument Height
            docPage = ((IDocumentPaginatorSource)FD).DocumentPaginator;
            writer.Write(docPage);
            Document = xpsDocument.GetFixedDocumentSequence();
            this.Close();
            xpsDocument.Close();
            var windows = new PrintWindow(Document);
            windows.ShowDialog();

        } 
```

# javascript - 在 JavaScript 中设置默认值的惯用方法

> ID：505840
> 
> 赞同：15
> 
> 时间：2009-02-03T02:30:48.217
> 
> 标签：javascript

在 JavaScript 中执行以下操作的最惯用的方法是什么：

如果调用者`myParam`没有传入`MyFunc`，那么我想将其设置为默认值。但首先我想尝试从另一个可能尚不存在的对象中获取它：

```
function MyFunc(myParam) {

    if (!myParam) {
        if (!myObj) {
            myParam = 10;
        }
        else {
            myParam = myObj.myParam;
        }
    }

    alert(myParam);
} 
```

我开始写：

```
myParam = myParam || myObj.mParam || 10 
```

但意识到如果`myObj`不存在，那么这将失败。我可能会猜到以下几点：

```
myParam = myParam || (myObj && myObj.mParam) || 10 
```

它甚至可能会起作用。但这是最好的方法吗？

例如，John Resig 将如何做到这一点？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-03T02:34:42.217

`myObj`如果 myObj 是全局对象，则需要引用 window 对象，否则如果未定义则会抛出错误。

```
myParam = myParam || (window.myObj ? window.myObj.mParam : 10); 
```

或者

```
myParam = myParam || (window.myObj && window.myObj.mParam) || 10; 
```

这也有效：

```
myParam = myParam || ((typeof myObj !== "undefined") ? myObj.mParam : 10); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T03:09:18.903

我认为其他答案已经证明，单线可能会以多种方式失败。我下面的版本可能更具可读性，并且没有明确测试对象/属性的存在，但也不会更短：

```
function MyFunc(myParam){
    if (!myParam){
        try{
            myParam = myObj.myParam;
        }
        catch(e){
            myParam = 10;
        }
    }
} 
```

# css - IE6 中带填充的破盒模型的最佳解决方法？

> ID：505841
> 
> 赞同：2
> 
> 时间：2009-02-03T02:31:08.653
> 
> 标签：css, internet-explorer

我注意到，当内部元素具有 padding-bottom 时，IE6 和 IE7 都会将父 div 向下推……最好的解决方法是什么？是否可以使用有效的 css 解决此问题？

**编辑**

我使用的解决方案是在子元素中设置**溢出：自动**（如下面接受的答案中所述）。我采用这种方法是因为我的子元素高度是动态的，因此我无法设置它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T05:29:13.677

padding-bottom 添加到子元素总高度，所以即使子元素为空，padding-bottom:10px; 将给它10px的总高度。在所有现代浏览器中，父元素将扩展以为其子元素提供空间。

但是，如果您希望在父级上设置高度，您可以在父级上设置一个高度并通过溢出来控制子级的内容：自动/隐藏/滚动..

或者您可以将 parent 设置为 position:relative; 并设置位置：绝对；到子元素。

有点取决于你想要什么..

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T13:32:33.060

检查您设置的 doctype 并且没有遇到[quirksmode](http://www.quirksmode.org/css/quirksmode.html)，接下来使用[重置样式表](http://meyerweb.com/eric/tools/css/reset/)以确保您的所有元素都从同一只脚开始。

如果您仍然在某个版本的 IE 中获得额外的填充，请使用[条件注释](http://www.quirksmode.org/css/condcom.html)为该浏览器添加额外的样式表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T14:55:36.030

将填充应用于子元素时，我没有看到 IE8 或 Firefox“将父级向下推”；只是父元素的高度扩展以容纳子元素。这是 CSS 中正确的自动行为。我做了一个简短的演示：

[http://robertgrant.org/testbed/paddingbottom.xhtml](http://robertgrant.org/testbed/paddingbottom.xhtml)

随意在 IE6/IE7 中尝试，看看会发生什么（需要启用 Javascript 才能使链接工作，但即使没有它，您也可以看到发生了什么）。

如果要限制父级的高度，则设置它（例如高度：100px）并将其溢出属性设置为隐藏。

# regex - Vim中的交互式搜索/替换正则表达式？

> ID：505848
> 
> 赞同：283
> 
> 时间：2009-02-03T02:34:25.853
> 
> 标签：regex, vim

我知道进行全局替换的正则表达式，

```
 %s/old/new/g 
```

您如何在[Vim](http://en.wikipedia.org/wiki/Vim_%28text_editor%29)中进行交互式搜索替换？

* * *

## 回答 #1

> 赞同：503
> 
> 时间：2009-02-03T02:40:55.810

添加标志**c**（在 vim 命令提示符中）：

```
:%s/old/new/gc 
```

每次出现“旧”时都会给您一个是/否提示。

![](https://i.stack.imgur.com/LwYPG.jpg)

一旦选择了确认替换，Vim 的内置帮助会提供有关可用选项的有用信息。采用：

```
:h :s 
```

然后滚动到确认选项部分。截图如下：

![说的文字](https://i.stack.imgur.com/hQBJ4.gif)

例如，要替换此匹配项和所有剩余匹配项，请使用`a`.

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2012-01-26T06:00:36.010

Mark Biek 指出使用：

```
%s/old/new/gc 
```

全局搜索替换为每次替换的确认。但是，我也喜欢以交互方式验证旧文本是否正确匹配。我首先使用正则表达式进行搜索，然后重用该模式：

```
/old.pattern.to.match
%s//replacement/gc 
```

将`s//`使用最后一个搜索模式。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-02-03T02:46:42.350

我认为您正在寻找`c`，例如`s/abc/123/gc`，这将导致 VIM 确认替换。请参阅 :help :substitute 了解更多信息。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-03T02:38:33.147

我通常使用 find/substitute/next/repeat 命令:-)

```
/old<CR>3snew<ESC>n.n.n.n.n.n.n. 
```

即`find "old"`, `substitute 3 characters for "new"`, `find next`, `repeat substitute`, 等等。

大量替换很痛苦，但它可以让您有选择地忽略一些旧的出现（只需`n`再次按下以查找下一个而不是`.`重复替换）。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-02-03T21:18:43.913

如果您只想计算 'abc' 的出现次数，那么您可以执行`%s/abc//gn`. 这不会取代任何东西，而只是报告“abc”的出现次数。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-09-17T15:11:30.527

如果您的替换文本需要针对每个匹配的事件进行*更改（即不是简单地选择 Yes/No 来应用单数替换），您可以使用我制作的 Vim 插件，称为*[interactive-replace](https://github.com/hwrod/interactive-replace)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-03-14T16:07:54.743

[Neovim](https://neovim.io)现在有一个功能`inccommand`可以让你预览替换：

`inccommand`有两个选择：

*   `set inccommand=split`在拆分窗格中预览替换
*   `set inccommand=nosplit`预览活动缓冲区中的替换

[![在此处输入图像描述](https://i.stack.imgur.com/D3HOJ.gif)](https://i.stack.imgur.com/D3HOJ.gif)

图片取自：[https](https://medium.com/@eric.burel/stop-using-open-source-5cb19baca44d) ://medium.com/@eric.burel/stop-using-open-source-5cb19baca44d 功能文档：[https://neovim.io/doc/user/options.html#'inccommand'](https://neovim.io/doc/user/options.html#%27inccommand%27)

# c# - 我可以使用 lambda 语法忽略委托参数吗？

> ID：505850
> 
> 赞同：29
> 
> 时间：2009-02-03T02:34:59.317
> 
> 标签：c#, delegates, lambda

我很好奇为什么 C# 允许我在某些情况下忽略委托参数，而不是其他情况。

例如，这是允许的：

```
Action<int> action = delegate { Console.WriteLine("delegate"); }; 
```

但这不是：

```
Action<int> action = () => Console.WriteLine("lambda"); 
```

有没有办法使用 lambda 初始化委托并忽略参数？我知道我可以向 lambda 添加一个参数并修复前一行，但这更多是与编译器有关的学术问题，以及它为什么或如何工作。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-03T03:05:14.853

我相信您的第一个示例实际上创建了一个匿名函数，该函数能够接受许多不同的签名，其主体是单个语句`Console.WriteLine...`。因为它可以匹配不同的签名，所以不会造成问题。在第二个示例中，lambda 语法本身定义了一个不接受具有相同主体的参数的函数。显然后者与定义的 Action 不一致，因此您会收到错误消息。

[C# 匿名方法参考](http://msdn.microsoft.com/en-us/library/0yw3tz5k.aspx)

> 在一种情况下，匿名方法提供了 lambda 表达式中没有的功能。匿名方法使您可以省略参数列表，这意味着可以将匿名方法转换为具有各种签名的委托。这对于 lambda 表达式是不可能的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-03T04:44:55.230

详细说明 tvanfosson 的回答；C# 3.0 语言规范（第 7.14 节）中描述了此行为：

> lambda 表达式和匿名方法表达式的行为是相同的，除了以下几点：
> 
> • 匿名方法表达式允许完全省略参数列表，从而产生对任何值参数列表的委托类型的可转换性。
> 
> • lambda 表达式允许省略和推断参数类型，而匿名方法表达式要求显式声明参数类型。
> 
> • lambda 表达式的主体可以是表达式或语句块，而匿名方法表达式的主体必须是语句块。
> 
> • 由于只有 lambda 表达式可以有表达式主体，所以没有匿名方法表达式可以成功地转换为表达式树类型（第 4.6 节）。

我认为：

```
Action<int> action = () => Console.WriteLine("lambda"); 
```

相当于：

```
Action<int> action = delegate() { Console.WriteLine("delegate"); }; 
```

这也不会编译。正如 Daniel Plaisted 所说， () 明确表示没有任何参数。

如果有委托{}的等价物，它可能是：

```
Action<int> action = => Console.WriteLine("lambda") 
```

这不是很漂亮，我怀疑它不符合 lambda 表达式的精神。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-03T23:13:01.470

正如其他人所说，不，您不能跳过将参数声明为 lambda。但是，为了清洁，我建议给他们一个名字，比如_。例如

```
foo.Click += (_,__) => { ... } 
```

您本身并没有忽略它们，而是表明您不在乎它们是什么并且不会使用它们。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T02:56:10.303

() => ... 语法明确指定 lambda 不带参数。也许可以修改语言，以便 () => 真正意味着“为我推断这个 lambda 的参数”，就像委托语法一样，但这会使语言更加复杂。在设计新的语言特性时，[你从负 100 开始](http://blogs.msdn.com/ericgu/archive/2004/01/12/57985.aspx)，我认为这个没有通过测试。

可能还有更多技术原因导致难以实施（这可能更符合您的要求，但我怀疑技术原因是否会推动这个决定）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T03:01:21.820

我会说这是强制使用 lambda 表达式的参数。

以您的第一个示例为例，您将如何与传入的值进行交互，它没有本地表示。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-04-03T06:26:16.493

那这个呢？

```
Func<int> lamdapointer = () => TwoArgMethodThatReturnsInt(10,20); // the same method cannot be called with the delegate "NoArgmethodThatReturnsInt"

lamdapointer();

Delegate int NoArgmethodThatReturnsInt();
NoArgmethodThatReturnsInt del = NoArgmethodThatReturnsInt; // only this is possible with delegates

public int TwoArgMethodThatReturnsInt(int x,int y)
{
return x + y;
}

public int NoArgmethodThatReturnsInt()
{
return 20;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-12T18:23:20.747

实际上，委托 {} 没有指定任何参数并且适合任何委托方法签名 - 因此它在您的第一个构造中是允许的。

Lambda 表达式 () => ...; 特别声明无参数委托，这与 Action 所需的签名相矛盾 - 具有单个参数的委托。

您可能想要使用以下选项之一。

如果您需要该操作具有参数，则可以按以下方式进行（“_”是标识符名称的合法字符）。

> `Action<int> action = _ => Console.WriteLine("lambda");`

或者您可能希望使用无参数操作，如下所示：

> `Action action = () => Console.WriteLine("lambda");`

# c++ - 如何使用 C++ 压缩文件目录？

> ID：505863
> 
> 赞同：9
> 
> 时间：2009-02-03T02:43:28.580
> 
> 标签：c++, qt, boost, compression, zlib

我正在开发一个使用 C++、Boost 和 Qt 的项目。我了解如何使用 Qt 中的 qCompress() 函数来压缩单个文件和字节流。

如何压缩包含多个文件的目录，包括子目录？我正在寻找一个跨平台（Mac、Win、Linux）的解决方案；我不想启动一堆新流程。

是否有一种标准方法可以将来自多个文件的字节流组合成一个压缩存档，或者 Boost iostream 库中是否有一个方便的函数或方法？

非常感谢您的帮助。

**更新**：QuaZip 库看起来非常棒。下载包中有一个示例（在“测试”目录中），它非常清楚地显示了如何压缩文件目录。

**更新 2**：在我的 Linux 构建环境上完成此任务后，我发现 QuaZip 根本无法与 Visual Studio 编译器一起使用。有可能解决所有这些编译器错误，但请注意这条路径的任何人。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T04:10:10.560

我找到了以下两个库：

*   [ZipIOS++](http://zipios.sf.net)。似乎是“纯”C++。他们没有将 Windows 明确列为受支持的平台。所以我认为你应该自己试试运气。
*   [压缩包](http://quazip.sourceforge.net/index.html)。基于 Qt4。其实很好看。他们明确列出了 Windows（使用 mingw）。显然，它是 [this] 库的 C++ 包装器。

啊，当然，我已经从[这个](http://lists.trolltech.com/qt-interest/2006-07/thread00070-0.html)关于压缩/解压缩目录的 Qt Mailinglist 问题中删除了这些网站:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T03:53:05.243

[http://www.zlib.net/](http://www.zlib.net/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-08T15:30:16.897

只是为了记录...

今天，我需要在 Visual C++ 中做一些非常相似的事情。（虽然希望保持在其他平台上编译项目的可能性；但是不希望仅仅为了这个目的而采用 Qt。）

最终使用了[Minizip](http://www.winimage.com/zLibDll/minizip.html)库。它是用纯 C 编写的，但是围绕它设计一个简单的 C++ 包装器是轻而易举的事，最终结果效果很好，至少对我来说是这样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-07-26T14:32:01.467

我已经围绕 minizip 构建了一个包装器，添加了一些我需要的功能并使它更好地使用它。Is 确实使用最新的 c++11 并使用 Visual Studio 2013 开发，因此它应该为您开箱即用。

这里有完整的描述：[https ://github.com/sebastiandev/zipper](https://github.com/sebastiandev/zipper)

您可以压缩整个文件夹、流、向量等。还有一个不错的功能是完全在内存中完成所有操作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-12-30T07:33:22.143

`Poco::Zip`也是一种选择，它有明确的文档和一些演示代码。

[Poco::Zip 文件](https://pocoproject.org/docs/Poco.Zip.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T03:46:42.820

```
system("zip myarchive.zip *"); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-09-29T22:22:36.673

我在 Windows 上使用 VisualStudio 2010 尝试了 QuaZIP 0.4.3——仍然存在问题，但可以轻松解决。

# 使用 VS 构建：

1.  使用 CMake 为 QuaZIP 配置和生成 VS 解决方案。
2.  用 VS 打开解决方案并构建——你首先会注意到它找不到“zlib.h”。
3.  打开 quazip 项目的首选项并将 Qt 的 Zlib 副本的路径添加到 C/C++->General->Additional Include Directories: $(QTDIR)/src/3rdparty/zlib。
4.  再次重建，您将收到大量警告和一个错误 C2491：QuaZipFile::staticMetaObject 上的 dllimport 静态问题。
5.  这是因为 QuaZipFile 被声明为“类 QUAZIP_EXPORT QuaZipFile”，并且 QUAZIP_EXPORT 需要根据是否定义 QUAZIP_BUILD 解析为 dll 的 Q_DECL_EXPORT 和应用程序的 Q_DECL_IMPORT。在构建 QuaZIP 时，应该定义 QUAZIP_BUILD，但不是——配置过程错误地定义了完全无用的“quazip_EXPORTS”。
6.  要修复，只需从所有构建配置中删除“quazip_EXPORTS”并添加 QUAZIP_BUILD - QuaZIP 现在可以正常构建。

# php - 从 PHP 脚本发送邮件会导致错误

> ID：505864
> 
> 赞同：0
> 
> 时间：2009-02-03T02:44:20.780
> 
> 标签：php, email

我有一个以前似乎可以工作但不再有效的脚本。

脚本运行后显示此消息：

```
Array (
    [0] => Unrouteable address [1] => -All RCPT commands were rejected with this error:\\
    503-Unrouteable address 503 valid RCPT command must precede DATA
)
Array (
    [0] => Unrouteable address [1] => -All RCPT commands were rejected with this error:\\
    503-Unrouteable address 503 valid RCPT command must precede DATA
)
Array (
    [0] => Unrouteable address [1] => -All RCPT commands were rejected with this error:\\
    503-Unrouteable address 503 valid RCPT command must precede DATA
) 
```

实际功能：

```
function emailUser($table, $subject, $message) {
    $query = "SELECT * FROM $table";
    $result=mysql_query($query);

    while($row = mysql_fetch_array($result)) {
        $i = 0;

        while($i <= 0) {
            $to = $row['email'];
            $to_all .= '<li>'.$row['email'].'</li>';
            $mail = new htmlMimeMail();
            $mail->setHTML($message);
            $mail->setSubject($subject);
            $mail->setSMTPParams('mail.site.net', 25, 'site.net');
            $mail->setReturnPath("email@site.net");
            $mail->setFrom("email@site.net");

            $mail_result = $mail->send(array($to), 'smtp');

            if (!$mail_result) {
                    print_r($mail->errors);
                    //failure
                } else {
                    //success
                }
            $i++;
        }
    }
    print '<h3>Mail successuly sent to:</h3>';
    print '<ul>'.$to_all.'</ul>';
} 
```

有没有更好的脚本可以使用？也许电子邮件服务器已更改？

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T03:21:29.753

尝试重新排序到以下内容（setHTML 在末尾）：

```
$mail->setSubject($subject);
$mail->setSMTPParams('mail.site.net', 25, 'site.net');
$mail->setReturnPath("email@site.net");
$mail->setFrom("email@site.net");
$mail->setHTML($message); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T03:28:09.240

您确定 $row['email'] 是正确的列吗？

该错误似乎向我表明该函数正在接收的收件人列表是可疑的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T07:09:27.297

您正在使用的这个 htmlMimeMail 类是什么？你自己写的吗？

这是一个很好的 PHP 邮件发件人库：[SwiftMailer](http://www.swiftmailer.org/)

至于以前能用现在不能用的原因，很可能是邮件服务器配置发生了变化。是你的邮件服务器吗？还是您的 ISP 的？我怀疑它由于某些垃圾邮件预防机制而改变了其行为。它可能会拒绝 SMTP RCPT 收件人，因为，比如说，您没有使用某些方式（如 SMTP 之前的 POP，或经过身份验证的 SMTP）首先登录。

# django - Django - 如何将 InMemoryUploadedFile 转换为 ImageField 的 FieldFile？

> ID：505868
> 
> 赞同：12
> 
> 时间：2009-02-03T02:46:36.047
> 
> 标签：django, image, django-models, upload

我一直在尝试`help(django.db.models.ImageField)`，`dir(django.db.models.ImageField)`寻找如何`ImageField`从上传的图像创建对象。

`request.FILES`有图像`InMemoryUploadedFile`，但我正在尝试保存一个包含 的模型`ImageField`，那么如何将`InMemoryUploadedFile`变成`ImageField`？

你如何去寻找这种类型的东西？我怀疑这两个类具有继承关系，但是我必须做很多事情`dir()`才能确定是否要查看。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2010-02-23T10:44:15.863

您需要将其保存`InMemoryUploadedFile`到`ImageField`而不是将其“转换”为`ImageField`：

```
image = request.FILES['img']
foo.imagefield.save(image.name, image) 
```

其中*foo*是模型实例，而*imagefield*是`ImageField`.

或者，如果您要从表单中提取图像：

```
image = form.cleaned_data.get('img')
foo.imagefield.save(image.name, image) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T04:40:04.553

你想在 ModelForm 中做到这一点？

这就是我对文件字段所做的

```
class UploadSongForm(forms.ModelForm):
    class Meta:
        model = Mp3File

    def save(self):
        content_type = self.cleaned_data['file'].content_type
        filename = gen_md5() + ".mp3"
        self.cleaned_data['file'] = SimpleUploadedFile(filename, self.cleaned_data['file'].read(), content_type)
        return super(UploadSongForm, self).save() 
```

您可以以它为例，在源代码中查看 InMemoryUploadedFile 类在初始化参数中需要什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T20:23:38.443

您可以使用表单实例实现带有文件上传字段的表单，这是视图：

```
def form_view(request):
    if request.method == 'POST':
        form = FooForm(request.POST, request.FILES)
        if form.is_valid():
            form.save()
            return render_to_response('result.html')
        return render_to_response('form.html', {
            'form': form;
            'error_messages': form.errors;
        }
    form = FooForm()
    return render_to_response('form.html', {
        'form': form;
    } 
```

*form.save()*将上传的文件与所有其他字段一起保存，因为您在其构造函数中包含*request.FILES参数。*在您的模型中，您必须像这样定义ModelForm类的*FooForm**子*类：

```
class FooForm(ModleForm):
    Meta:
        model = Foo 
```

...其中 Foo 是*Model*的子类，它描述了您要永久存储的数据。

# estimation - 构建与购买和集成 - 您如何做出决定？

> ID：505879
> 
> 赞同：2
> 
> 时间：2009-02-03T02:54:05.690
> 
> 标签：estimation

我已经看到很多关于构建与购买的问题和讨论，但大多数人都坚持简单的方法，你可以简单地做一个或另一个。大多数时候，您必须购买和集成或自行构建。无论哪种方式，你都在做一些工作。

在接下来的 30-60 天里，我需要实施几个管理项目，以防止每个人都扯掉头发并互相残杀。其中最大的是票务系统（电子邮件、支持请求、自助服务等）。

不乏选择，但最终我们将不得不购买我们决定使用的任何东西，添加我们所有的客户及其用户，并确保我们随着时间的推移保持同步。我们还必须提供单点登录并进行一些设计工作，以使其看起来像是我们从头开始构建的。

如果我们构建我们可以跳过集成痛点，尽管具有有限（但集中）的功能集。

在做出这样的决定时，您通常会分析什么？如果有 4 到 5 个系统能够很好地完成一项非常具体的工作，还是有一个可以完成所有工作的单一系统更好？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T03:02:45.127

一个系统更适合以下情况：

*   一个数据存储库（即数据库）
    将每个系统链接在一起的简单方法，进行交叉引用。无需构建中间导入器/导出器/同步器

*   允许单次登录。这在企业中非常有用，可以确保每个人都知道在哪里可以找到正确的信息。所以更多“什么是错误跟踪的站点......”并不是每个人都会在大部分时间使用所有工具，他们*会*忘记如何访问甚至使用。

*   一切都具有相同的外观和感觉
    节省培训费用

*   维护更便宜。一切都是一样的更新。管理员不必专门研究单独的系统。

但是……显然你被你买的东西困住了。如果可以的话，请确保获得一个可以构建自己的插件的系统，以使其与您的业务模型相匹配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T03:15:50.840

显然“这取决于”。我的一般规则是，如果它是内部的，我们会购买它并在需要时进行集成。如果她有问题，我们的公司系统管理员有一个支持热线给我们组织外部的人，而且这不是一个给我们的开发人员带来负担的巨大项目。

如果它是我要交付的产品的一部分，我会根据需要构建它或从开源库中获取一些源代码。没有什么比别人的黑盒代码破坏你的产品更糟糕的了。恕我直言，运输产品中的依赖项越少越好。

我倾向于购买您提到的支持产品。好的那些为共享身份验证系统、面向用户的主题以及可能您的客户服务团队尚未意识到他们想要/需要的大量功能提供了很好的集成点。

但是，要分析什么。对于像这样的“管理”项目，对我来说最重要的是机会成本。我的团队还能做些什么来让我们的公司赚更多的钱，让我们获得更多的客户，等等？当然，这些项目对底线有一些积极的影响，但与新产品、改进产品等相比没有什么。随着时间的推移，包括维护在内，开发人员/产品经理/测试人员会在这个管理项目上花费多长时间？如果您购买，集成点不会经常更改，但如果您构建，您的客户（内部人员）将不断要求新功能，您将能够在您的剩余任期内维护该项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T03:15:58.373

您已经确定了一个关键问题——当您购买时，您仍有工作要做，而且可能还有很多工作要做。话虽如此，我每次的总体倾向都是购买。编写代码很难，调试代码更难——当你购买时，你购买的不仅仅是代码/应用程序，你购买的是它可以工作的事实——后者是 90% 的收益。

但是，由于您的需求非常普遍，为什么不使用开源。这有两个突出的好处。

1）由于您可以访问源代码，因此您可以根据自己的意愿对其进行修改——即无需在现有系统的顶部进行单点登录。定制登录模块以使用您现有的基础设施，因此无需保持同步、节省时间、干净的方法等。许多开源通过组件化（？）那些无论如何都是特定于环境的方面来承认现实世界。它们通常与 DB/身份无关。

2）如果您明智地选择，您将拥有一支已经了解系统的顶尖技术人员随时准备提供帮助 - 唯一的问题是他们不为您工作（还没有！）。

我的建议是选择一个您的简单目标 - 票务系统似乎是一个，分析在开源世界中满足您大部分/所有需求的内容。评估并在[Rent A Coder](http://www.rentacoder.com/RentACoder/DotNet/default.aspx)上提出任何所需更改的请求。坐下来等待结果，希望结果很好。你失去了一点时间，并获得了很多经验。

开源不等于 Linux/Unix——.Net 也有很多好东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T03:18:58.273

买？你说的这个买的是什么，陌生人？

说真的，很长一段时间以来，我都不必为自己的项目购买软件。我所有的开发工具都是免费的，我所有的第三方库都是免费的（不是 GPL）。甚至我的操作系统也是免费的。出于测试目的，我必须为 Windows 付费，但大多数工作都使用跨平台的工具。

任何需要从免费工具或库中无法立即获得的代码的东西，我要么从头开始编写（所有算法都可以在网络上免费获得），要么使用我一直在添加的（因为我太老了所以很大）片段库源代码多年。

购买（“获得”）几乎总是比构建更快，除非购买的东西是如此糟糕以至于集成是一场噩梦。这可以通过避免来自几乎没有记录的供应商的最新奇闻异事来缓解。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T03:24:59.120

您的要求越“标准”，购买就越合适（或者换句话说，不要重新发明轮子）。相反，您的要求越独特，您可能考虑构建的越多。

您非常正确地指出，即使在购买时也往往会有一些定制。请记住，任何自定义都会在每次升级/修补时花费您。我建议，如果您的需求接近您可能购买的工具之一所支持的业务模型，那么您认真考虑将业务流程重新调整到供应商标准。如果这不可能，请询问您是否购买了正确的工具。

我建议，如果有人出于成本原因建议建造它，那就尖叫吧。以我的经验，购买成本是众所周知的，而建造成本却很隐蔽。请记住，您将决定在应用程序的整个生命周期内（商业应用程序平均为 7 年）继续编码，但在决定购买和构建时可能只考虑初始开发成本。

我非常喜欢单一的单体数据库，但有时这是行不通的。更重要的是拥有“单一的真相来源”；如果您有多个数据库保存类似的数据，请选择一个作为给定数据的权威来源，并有一个流程来维护与该来源一致的所有其他数据库。最好这将是自动的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T03:41:56.590

包罗万象的单一系统是众多企业应用程序存在的[理由。](http://en.wikipedia.org/wiki/Raison_d%27%C3%AAtre)然而，我发现，如果你不愿意花一大笔钱，你就会遇到集成问题。

“最佳”解决方案是相当主观的，任何答案都是正确的，也可能是错误的，但如果我是国王，我可能会选择适合的根深蒂固的开源解决方案，并将 Web 服务包装在需要的项目周围互相交谈。如果我是国王。

作为切线点，有免费的票务系统，如[RT](http://bestpractical.com/rt/) (et. al.)，您无需担心购买。

# prototypejs - 如何让 Struts 和 Prototype 更好地协同工作？

> ID：505881
> 
> 赞同：0
> 
> 时间：2009-02-03T02:56:19.007
> 
> 标签：prototypejs, struts

原型库使用`$('element-id')`或`$F('element-id')`获取表单元素的元素或值。这在javascript中编码非常方便。但是在 Struts 中，我发现没有办法为表单元素定义 id 属性。

虽然我可以使用

```
<html:xhtml/> 
```

定义一个带有 id 属性的表单标签，如下所示：

```
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib uri="http://struts.apache.org/tags-bean" prefix="bean" %>
<%@ taglib uri="http://struts.apache.org/tags-html" prefix="html" %>

<html:xhtml/> 

<html:form action="/Welcome">
...
<html:text property="username" size="16" maxlength="18"/>
...
</html:form> 
```

上面渲染的html是这样的：

```
<form id="TestForm" method="post" action="/myapp/Welcome.do">
...
<input type="text" name="username" size="16" maxlength="18"/>
...
</form> 
```

但我需要的是让struts渲染

```
<html:text> 
```

像这样的标签：

```
<input type="text" id="username" name="username" size="16" maxlength="18"/> 
```

那么在 Struts 中是否有可能实现这一点？或者如果没有，我怎样才能更好地在 Struts 应用程序的 Prototype 库中编码？

我正在使用 Struts 1.3.8；原型 1.5.1。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T03:06:43.400

您可以在大多数 Struts 小部件上使用*styleId*属性来设置 HTML 元素 id：

```
<html:text styleId="myId" .../> 
```

呈现为

```
<input type="text" id="myId" .../> 
```

# c# - 内存不足异常

> ID：505882
> 
> 赞同：3
> 
> 时间：2009-02-03T02:58:50.360
> 
> 标签：c#, asp.net, memory-management

我正在使用 C# 和 asp.net 开发一个 Web 应用程序，我收到了内存不足的异常。该应用程序所做的是从数据源读取一堆记录（产品），可能是数百/数千，通过向导中的设置处理这些记录，然后使用处理产品信息更新不同的数据源。虽然有多个 DB 类，但现在所有的逻辑都在一个大类中。唯一的原因是所有信息都与一件事有关，即产品。如果我将我的应用程序分成不同的类，它会帮助记忆吗？我不认为会这样，因为如果我将业务逻辑分成两个类，这两个类在互相发送消息的整个过程中都会保持活动状态，所以我不知道这会有什么帮助。我想我的另一个解决方案是找出什么 s 吸干了所有的记忆。有什么好工具可以推荐吗？？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-03T03:07:56.050

您是否使用数据读取器来流式传输您的数据？（避免加载太多到内存中）

我的直觉告诉我这是一个需要解决的微不足道的问题，不要抽取包含 100 万条记录的数据表，一次处理一行或小批量处理表……当你完成对象时释放和处置它们。（例如：没有`static List<Customer> allCustomers = AllCustomers()`）
有一个开发规则，确保如果涉及的行数超过 X，则没有人将表读入内存。

如果您需要一个工具来调试这个，请查看[.net 内存分析器](http://memprofiler.com/)或[带有 sos 扩展名的 windbg，](http://msdn.microsoft.com/en-us/library/bb190764.aspx)两者都可以让您嗅探您的托管堆。

另一个注意事项是，如果您关心可维护性并希望减少缺陷数量，请以更好地与您的领域保持一致的方式正确删除 SuperDuperDoEverything 类和模型信息。SuperDuperDoEverything 类是等待爆炸的炸弹。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-03T03:15:56.673

另请注意，您可能实际上并没有耗尽内存。发生的情况是 .NET 去寻找连续的内存块，如果找不到，它会抛出 OOM——即使你有足够的总内存来满足请求。

有人同时引用了 Perfmon 和 WinDBG。您还可以设置 adplus 以在崩溃时捕获内存转储 - 我相信语法是`adplus -crash -iis`. 有了内存转储后，您可以执行以下操作：

```
.symfix C:\symbols
.reload
.loadby sos mscorwks
!dumpheap -stat 
```

这将使您了解您的高内存对象是什么。

当然，请查看[Tess Fernandez 的](http://blogs.msdn.com/tess)优秀博客，例如这篇关于[XML 序列化程序的内存泄漏](http://blogs.msdn.com/tess/archive/2006/02/15/net-memory-leak-xmlserializing-your-way-to-a-memory-leak.aspx)以及如何解决它们的文章。

如果你能够在你的开发环境中重现这一点，并且你有 VS Team Edition for Developers，那么就会有内置的内存分析器。只需启动一个新的性能会话，然后运行你的应用程序。它会吐出一个很好的报告，说明周围有什么。

最后，确保你的对象没有定义析构函数。这不是 C++，它没有任何确定性，除了它保证你的对象将在一轮垃圾收集中存活下来，因为它必须放在终结器队列中，然后在下一轮清理。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T03:11:33.390

您可能想尝试的一个非常基本的事情是，重新启动 Visual Studio（假设您正在使用它）并查看是否发生同样的事情，是的，在不等待垃圾收集器的情况下释放对象始终是一个好习惯。

把它们加起来，

*   释放对象
*   紧密联系

你总是可以试试这个， http: [//msdn.microsoft.com/en-us/magazine/cc337887.aspx](http://msdn.microsoft.com/en-us/magazine/cc337887.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-04T04:57:39.010

我发现了问题。在执行我的循环时，我有一个没有被清除的集合，因此数据只是不断被添加到其中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T03:02:45.187

从 Perfmon 开始；有许多计数器用于 GC 相关信息。您很可能正在泄漏内存（否则 GC 将删除对象），这意味着您仍在引用不再需要的数据结构。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T03:03:43.297

无论如何，你应该分成多个类，只是为了一个理智的设计。

你要关闭你的数据库连接吗？如果您正在读取文件，是否在完成读取/写入后关闭/释放它们？其他对象也是如此。

您可以定期循环您的类对象以释放内存。

# unit-testing - 您如何使用第 3 方 dll 对 .EXE 进行单元测试？

> ID：505883
> 
> 赞同：6
> 
> 时间：2009-02-03T03:00:33.587
> 
> 标签：unit-testing, vb6, tdd, simplyvbunit

我仍在学习 TDD 的黑暗艺术，最近[我一直在尝试学习如何在 VB6 中进行 TDD，](https://stackoverflow.com/questions/467789/are-there-any-good-tdd-tools-or-resources-for-vb6)我基本上将列表缩小到免费的 simplevbunit 和最昂贵的 vbunit3。

我的应用程序是一个带有大量 3rd 方 dll 的富文本编辑器，我在 Google 中四处寻找如何对这个 exe 文件进行单元测试。

所以我的问题是如何对 exe 文件进行单元测试？特别是在 VB6 的上下文中，如果你有任何关于 vbunit3 或 simplevbunit 的好例子，你只是一个救生员，因为我现在正沉浸在材料中，我仍然无法编写一个单元测试:(

## 编辑

实际上，该应用程序由许多表单、模块和类模块组成，当我编译它时，它当然会变成很好的打包好的 .EXE 文件。为了使事情变得更复杂，有相当多的全局变量飞来飞去。

但我的主要目的是对代码的所有或最易损坏的部分进行单元测试。而且我想确保我可以将测试和代码分开。所以我认为最好的方法是通过添加引用等以某种方式直接测试 exe。

有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T03:15:02.543

单元测试和集成测试是有区别的。您不对可执行文件进行单元测试。您可以对小型、独立的计算单元进行单元测试，例如方法或过程，具体取决于您使用的语言。集成测试将测试更大的组件，如 API、第三方组件，甚至可执行文件，以确保它们对于给定的一组输入（好或坏）按预期工作。虽然您可以使用单元测试工具对 API 或插件组件进行一些集成测试，但我认为您不会找到很多用于测试可执行文件的单元测试工具。还有其他类型的测试工具会在这方面做得更好。简单地编写提供不同类型输入并检查其输出的脚本对于许多场景可能就足够了。

如果您想了解有关 TDD 和单元测试的更多信息，您应该将其应用于 VB6 中的函数或过程——尽管，我推荐使用 VB.NET（或 C#）并进行面向对象的开发。通常，这些工具面向 OO 风格的编程。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T13:25:54.243

VB 中的 ActiveX 控件非常节省时间，但它们是有效的测试驱动开发的祸根。

为了在理想情况下有效地测试整个 VB6 应用程序，您需要设计一个 EXE 是 ActiveX DLL 之上的薄壳，可以完成所有工作。表单实现了一个接口并在 DLL 中注册了它们自己。因此，如果您有订单输入表单，它将实现 IOrderEntryForm 接口，并且它的事件将调用位于 MyAppUI 对话框中的 OrderEntry 类上的方法。

为了强调在 Visual Basic 6 中，FORMS 可以实现一个接口。然后表单在其 LOAD 事件中向 UI 类注册自身。表单的事件（如 MyButton_Click）调用 UI 类上的方法。UI 类使用表单接口的方法来更改显示的内容。这是额外的工作，但它节省了大量的测试时间。还可以进行维护，因为只要实现的界面保持不变，您就可以更改表单的外观。

这也意味着在您拥有类似 MYEXE->MyActiveXDLL 之前会变成 M​​YEXE->MyUIDLL->MyActiveXDLL。

对于您的测试环境，您创建一个 ActiveX DLL，它通过创建实现各种表单界面的类来模拟 UI。UI DLL 不知道区别，您可以完全控制发送的输入和读取的内容。

请注意，[这里](http://www.martinfowler.com/eaaDev/PassiveScreen.html)讨论了这种类型的设计模式。我用它作为开发和维护我公司金属切削机床 CAD/CAM 应用程序的基础。

第三方 ActiveX 控件是该方案的祸根。这是因为执行繁重工作的代码在控件本身内部。ActiveX 控件越复杂，问题就越严重。我公司的趋势是减少对第三方控制的依赖，转而支持内部应用程序。

然而，就像任何算法和设计模式一样，这涉及到一个判断调用。在涉及富文本控件的软件领域中，您遇到了多少问题。如果不是很多，那么您可能可以使用手动或自动的测试脚本（即向应用程序发送击键）并使用单元测试框架来完成其余的工作。

使用单元测试你的整个应用程序的关键元素是尽可能多地在接口后面填充它。只需做你现在能做的，并记下你在未来开发时想要改变的领域。如果您没有立即获得 100% 的覆盖率，甚至没有为明年提供保障，请不要绝望。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T21:58:46.563

另一种使用的技术是让您的应用程序成为一个 ActiveX EXE。然后，您的单元测试应用程序可以引用您的应用程序，就好像它是一个 ActiveX DLL。自从我上次使用 VB6 以来，你需要做大量的研究才能让它正常工作，我相信有一些技巧可以让它工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T03:19:55.123

关于我可能能够提供的唯一有用的建议是拿起 Michael Feathers [*Working Effectively with Legacy Code*](https://rads.stackoverflow.com/amzn/click/com/0131177052)。我认为您最大的挑战将是您的工具集，因为我知道用于 VB6 单元测试的工具并没有那么强大。

您也可以尝试在[TDD Yahoo!上询问。](http://groups.yahoo.com/group/testdrivendevelopment)据我所知，至少有几个人在那里使用 vbunit3 [。](http://groups.yahoo.com/group/testdrivendevelopment)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-04T11:22:23.587

当然，您可以对单个 EXE 进行单元测试。看看有多少应用程序由多个 EXE 组成。

至于第 3 方组件，您如何使用标准 VB6 组件进行测试？其他 MS 组件？与第 3 方组件相同。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T13:17:28.920

> 为了使事情变得更复杂，有相当多的全局变量飞来飞去。

第一个重构是将全局变量转移到 ActiveX DLL 中的类。该类的实例化属性需要设置为 GLOBAL MULTIUSE。当将 EXE 设置为引用 ActiveX 时，变量仍然是全局的，但是当您撕掉 EXE 以用测试工具替换它时，工具可以访问全局变量。

一旦进行测试，您就可以进行进一步的重构以减少全局变量的数量。

# f# - F# 如何将 Console.ReadLine() 抽象为字符串序列

> ID：505891
> 
> 赞同：4
> 
> 时间：2009-02-03T03:04:28.850
> 
> 标签：f#, console, stream, sequences

我想编写一个函数来将 Console.ReadLine() 抽象为字符串 seq

当 line = null 时，seq 应该中断

```
ConsoleLines(): unit -> string seq 
```

像这样使用：

```
for line in ConsoleLines() do
    DoSomething line 
```

这个函数怎么写？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-10-09T16:13:13.530

```
Seq.initInfinite (fun _ -> Console.ReadLine()) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T03:53:45.053

它不是很漂亮，但它按预期工作：

```
let rec ConsoleLines() =
    seq {
        match Console.ReadLine() with
        | "" -> yield! Seq.empty
        | x -> yield x; yield! ConsoleLines()
    } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-03T05:54:14.453

```
let ConsoleLines =
    seq {
        let finished = ref false
        while not !finished do
            let s = System.Console.ReadLine()
            if s <> null then
                yield s
            else
                finished := true
    } 
```

（请注意，您必须使用 ref/!/:= 在序列表达式中执行可变状态。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-11T00:26:27.503

```
let consoleLines = Seq.takeWhile ((<>) "") (seq { while (true) do yield System.Console.ReadLine() }) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-24T01:59:38.310

稍微不一样：

```
let readLines (sr:TextReader) =
    Seq.initInfinite (fun _ -> sr.ReadLine())
    |> Seq.takeWhile (fun x -> x <> null)

let consoleLines() =
    readLines Console.In 
```

# ruby-on-rails - 你是什 么意思Ruby on Rails不是线程安全的？

> ID：505900
> 
> 赞同：6
> 
> 时间：2009-02-03T03:12:31.453
> 
> 标签：ruby-on-rails, ruby, multithreading

我只是在阅读 ROR（还没有深入研究它），我听说它不是线程安全的。显然，这并不意味着不止一个人不能同时访问您的网站，那么这到底是什么意思呢？线程在 ROR 中在哪里发挥作用？他们只是指请求处理吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-03T03:21:35.120

您的信息已过时。[从2.2.2](http://guides.rubyonrails.org/2_2_release_notes.html)开始它是线程安全的

请记住[Ruby MRI 1.8.x](http://en.wikipedia.org/wiki/Ruby_MRI)，最广泛使用的 Ruby 实现使用[Green Threads](http://en.wikipedia.org/wiki/Green_threads)，因此使用 1.8.x 如果您创建 100 个线程，它们都在同一个 CPU 上运行。因此，当使用 MRI 托管 Rails 网站时，您可能希望运行与 CPUS 一样多的 Ruby 实例。像[乘客](http://www.modrails.com/)这样的东西会为你处理这个问题。

[这对于JRuby](http://jruby.codehaus.org/)来说曾经是一个大问题，因为 JRuby 有 Native 线程，而杂耍进程似乎是多余的。不管怎样，现在已经解决了。

另一方面，Iron Ruby，.Net Ruby 解释器运行本地线程。

注意：Ruby 1.9.1 使用本地线程，但仍然有一个全局解释器锁。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T03:19:04.623

基本上它的意思是，您不能在不同线程下的同一进程中运行多个 rails 副本，因为某些资源可能会在线程之间泄漏，无意中导致奇怪的行为，例如对象看似随机更改/消失次。

此外，也可能是类的设计中没有内置任何同步，这使得很难将部分 rails 放入线程并在线程之间共享其他部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-29T13:10:43.823

值得一提的是，Ruby MRI 1.8.x 使用 Green Threads，但 Ruby MRI 2 将有原生线程。

# project-management - 在 IT 公司选择项目时如何做出决策？

> ID：505906
> 
> 赞同：3
> 
> 时间：2009-02-03T03:16:48.637
> 
> 标签：project-management

他们选择项目的标准是什么，他们选择项目的依据是什么……？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T03:30:28.593

投资回报，如果他们想继续经营下去。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T03:41:33.377

投资回报当然是最终产品。但要实现这一目标需要许多因素：

*   他们自己的专长：我们是否有具备执行此操作所需技能的人员？我们可以雇一些人吗？

*   可用资源：程序员、经理、硬件、时间、财务资源。

*   PR：即使我们没有得到那么多的报酬，这个项目会给我们带来更多的生意吗？

*   PR：薪酬很好，但我们真的想与这个客户建立联系吗？

*   他们的使命/目标：他们想在哪些领域/利基市场竞争。他们想扩展吗？

*   过去的经历：我们做了一个这样的项目，太可怕了。让我们不要再这样做了。

*   过往经验：上次很有趣，而且我们可以重用一半的代码！我们开始做吧！

通常管理层使用更复杂的矩阵来做出决定，但或多或​​少，这些都是他们通常投入的因素。

我相信有人可以提供更具体/科学的答案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-23T11:26:02.027

好问题。直截了当的答案似乎是投资回报率 (ROI)。但是，ROI 受到批评的原因有以下三个：

1.  短期主义：投资回报率的计算很少超过 5-7 年（由于未来产生的任何现金流的[贴现率](http://en.wikipedia.org/wiki/Net_present_value)增加），一些真正值得做的项目在未来更远地实现全部收益。

2.  很难或不可能为某些事物赋予货币价值。经常被引用的例子是人的生命。另一个是道德原则。然而，在软件世界中最常遇到的事情是很难定价的是除非该项目上线，否则永远不会出现机会。很难对新兴机会进行评估，因为在它们真正出现之前我们不知道它们是什么。我并不是指那些根本不会“开放”的机会，而是特别会[出现](http://en.wikipedia.org/wiki/Emergence)的机会。

3.  投资回报率没有考虑更广泛的战略。不应低估战略在软件世界中的重要性，该战略应考虑到提供软件产品或服务的具体细节。Geoffrey Moore 的“<a href="http://en.wikipedia.org/wiki/Crossing_the_Chasm" rel="nofollow noreferrer">Crossing the Chasm”是我推荐的一本很棒的书，并且与软件世界非常相关。

Joel 最近的一期“<a href="http://www.joelonsoftware.com/items/2009/07/20.html" rel="nofollow noreferrer">果味零食、定制和超音速：FogBugz 7 来了”有一个很好的战略文件样本及其背后的推理。FogCreek 似乎计划带着他们的 FogBugz 7.0 离开咆哮的山谷并进入龙卷风（根据 Geoffrey Moore 的分类），因此采取了消除阻止人们转向 FogBugz 的障碍的策略，而不是花时间引入一些更垂直的功能.

其他可用于选择项目的工具是[SWOT 分析](http://en.wikipedia.org/wiki/SWOT_analysis)、[帕累托分析](http://en.wikipedia.org/wiki/Pareto_principle)（即选择一个项目来解决导致 80% 问题的 20% 的原因）、[PESTLE](http://en.wikipedia.org/wiki/PEST_analysis)、[成本效益分析](http://en.wikipedia.org/wiki/Cost_benefit)（类似于[ROI](http://en.wikipedia.org/wiki/Rate_of_return)，包括批评）。

然而，似乎一个理智的策略表明公司计划在有限的时间内做和不做（通常下一两年，在高科技市场条件下很难预测超出这个范围），给出了一个选择优先事项的简单准则和明确的共同努力方向是最好的起点。

我还推荐阅读 Pete Peterson（WordPerfect 制造商的前 CEO ) 可在线获取。这本书讲述了 SSI Inc 所遵循的不同策略的真实故事，有些是计划和陈述的，有些是临时的，以及它们用于选择工作内容的方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-23T13:00:16.830

投资回报率只是一种衡量标准。还有很多其他因素：

1.  风险管理——例如，改进流程可能不会显示任何直接的投资回报，但是通过添加例如单元测试可以提高软件的质量并降低生产错误的风险。

2.  合规性——行业或政府可能有需要遵守的要求。直接而言，这可能不会显示投资回报，因为它们可能永远不会被审计，但不合规的不利因素是巨大的（被关闭）。

3.  可管理性——提供关于错误、项目进度等的指标可能不会显示直接的投资回报，但它可以让他们更好地预测和管理他们的项目。

4.  安全性——这可能被视为风险管理的一部分，但它是一个足够广泛的领域，值得拥有自己的类别。使遗留代码安全可能会花费大量资金并且不会立即显示任何回报，但有明显的理由证明这是值得的。

# debugging - 什么是统计调试？

> ID：505907
> 
> 赞同：4
> 
> 时间：2009-02-03T03:17:01.757
> 
> 标签：debugging, statistics, code-analysis

什么是统计调试？我还没有找到一个清晰、简洁的解释，但这个词听起来确实令人印象深刻。

它只是一个研究课题，还是在某个地方用于实际开发？换句话说：它会帮助我找到程序中的错误吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-12-09T18:57:19.150

多年来，我与各种出色的合作者一起创建了统计调试。我希望我几个月前就注意到了你的问题！但如果你还是好奇的话，或许这个迟来的答案总比没有好。

在非常高的层次上，统计调试是使用程序成功/失败的统计模型来跟踪错误的想法。这些统计模型揭示了特定程序行为与运行的最终成功或失败之间的关系。例如，假设您注意到程序中有一个特定的分支有时向左，有时向右。而且您还注意到分支向左的运行很好，但分支向右的运行崩溃的可能性要高出 75%。所以这里有一个统计相关性，可能值得更仔细地研究。统计调试使查找与故障相关的程序（错误）行为的过程形式化和自动化，从而引导开发人员找到错误的根本原因。

回到你原来的问题：

> 它只是一个研究课题，还是在某个地方用于实际开发？

它主要是一个研究课题，但它以两种方式存在于“真实”世界中：

1.  Cooperative Bug Isolation Project的[公开部署](http://www.cs.wisc.edu/cbi/)旨在寻找在 Fedora Linux 下运行的各种开源程序中的错误。您可以[下载预先安装的软件包](http://www.cs.wisc.edu/cbi/downloads/)，每次使用它们时，您都会向我们提供数据以帮助我们查找错误。

2.  Microsoft 发布了[Holmes，这是一种针对 .NET 的统计调试实现](http://research.microsoft.com/en-us/projects/holmes/)。它很好地集成到了 Visual Studio 中，并且应该是您使用统计调试来帮助您在自己的代码中找到自己的错误的一种非常简单的方法。我曾与 Microsoft Research on Holmes 密切合作，他们都是非常聪明的人，他们知道如何推出高质量的工具。

要记住的一个警告：统计调试需要充足的原始数据来构建良好的统计模型。在 CBI 的公共部署中，原始数据来自真实的最终用户。对于 Holmes，我认为微软假设原始数据将来自内部自动化单元测试和手动测试。*根本*没有运行的代码，或者只有失败的运行但没有成功的反例的代码是行不通的。统计调试根据好运行和坏运行之间的*对比*来工作，因此您需要同时提供它。如果您想要没有运行的错误搜索工具，那么您将需要某种静态分析。我也对此进行研究，但这不是统计调试。:-)

我希望这会有所帮助，而且不会太久。我很乐意回答任何后续问题。快乐的寻虫！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T03:21:37.943

这*听起来*像统计抽样。当您购买产品时，很有可能并非每件从“装配线”下来的产品都经过质量检查。

统计抽样要求检查一定比例的产品，以几乎确保它们都没有问题。它最大限度地减少了一些问题潜入的风险，并且在测试过程具有破坏性的情况下是绝对必要的 - 如果您对生产线的 100% 进行破坏性测试，那将不会为分销留下太多 :-)

老实说，除非您检查每一个执行路径和每一个可能的输入值，否则您已经在测试中这样做了。*为除了最简单的系统之外的任何系统进行测试所需*的工作量是不值得的。额外的成本将使您的产品成为非竞争项目。

请注意，统计抽样*不仅仅*涉及每 100 个单元进行测试。有一些方法可以针对抽样来提高发现问题的机会。例如，如果历史数据表明大多数错误是在特定阶段引入的，则以该阶段为目标。如果您的一位开发人员比其他开发人员更有问题，请更仔细地检查他的东西。

从我粗略浏览一些研究论文中可以看出，统计调试就是这样 - 根据过去的问题历史定位区域。

我知道我们已经为我们的软件这样做了。由于任何得到修复的错误都必须通过单元和系统测试来复制问题（我们的 TDD 表示这些测试应该在尝试修复错误之前编写），这些测试会自动添加到回归测试套件中，以便那些区域导致更多问题自然会在未来更频繁地测试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T03:36:57.490

那是你发布软件时说“好吧，它*可能*工作......”;-)

编辑：这是一个[研究课题](http://www.google.com/search?hl=en&q=%22statistical+debugging%22&aq=f&oq=)，使用机器学习和统计聚类来尝试在程序中找到可以很好地预测错误的模式，以确定更多错误可能隐藏的位置。

# vb.net - VB .NET 无表单保存面板

> ID：505909
> 
> 赞同：0
> 
> 时间：2009-02-03T03:18:40.117
> 
> 标签：vb.net, winforms, panel

在 Visual Studio 2008 中，使用 VB .NET，我有一个拆分容器，我想根据 Panel1 控件中的用户输入，将面板从其他团队成员的工作动态加载到 Panel2 插槽中。

我的团队成员是否可以在表单之外的面板上工作、保存它，然后让主表单在需要时加载这些面板，而无需将每个面板复制并粘贴到表单中并使它们可见和不可见？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T03:26:55.247

当然，让团队构建用户控件，然后将其添加到面板的控件集合中。

# c++ - gcc 和 g++ -Wconversion 的区别

> ID：505920
> 
> 赞同：6
> 
> 时间：2009-02-03T03:26:18.900
> 
> 标签：c++, c, gcc, g++

> **可能重复：**
> [我可以让 GCC 在将过宽的类型传递给函数时发出警告吗？](https://stackoverflow.com/questions/310108/can-i-make-gcc-warn-on-passing-too-wide-types-to-functions)

考虑以下测试程序：

```
static void func(int a)
{
}

int main()
{
    unsigned int b = 42;

    func(b);

    return 0;
} 
```

用 gcc 编译它：

```
lol@mac:~/projects$ gcc -Wconversion testit.c
testit.c：在函数âmainâ中：
testit.c:11：警告：由于原型而将 âfuncâ 的参数 1 传递为已签名
大声笑@mac:~/projects$

```

但是，在 g++ 中没有警告！：

```
lol@mac:~/projects$ g++ -Wconversion testit.c
大声笑@mac:~/projects$

```

这是什么原因，在编译 C++ 代码时有没有办法得到同样的警告？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T03:33:36.763

从[文档](http://gcc.gnu.org/onlinedocs/gcc-4.3.3/gcc/Warning-Options.html)中`-Wconversion`：

> 在 C++ 中默认禁用有关有符号和无符号整数之间转换的警告，除非显式启用 -Wsign-conversion。

似乎您也需要一个足够新的 GCC 版本。我有 4.0.1 版，但它无法识别`-Wsign-conversion`.

# javascript - 延迟文本以背景色显示和淡出

> ID：505921
> 
> 赞同：1
> 
> 时间：2009-02-03T03:26:22.393
> 
> 标签：javascript, jquery, html, css

我想在加载页面时淡入文本，背景颜色也会慢慢淡入。

```
<div id="alert-box">
 <p>This is the alert box, this message will display 5 seconds after page is loaded, with   the background-color fading in.</p>
</div> 
```

这是我现在为 jQuery 准备的内容：

```
$(document.body).click(function () {
   $("div:hidden:first").fadeIn("slow");
}); 
```

它具有点击功能。

我将如何设置延迟以及淡入的背景颜色？

编辑：我希望它淡入，然后缓慢（“不烦人”）闪烁 div 块 2 或 3 次，然后保持静止。用户不会错过警报。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T03:37:52.417

您可以使用 setTimeout 在文档加载后的指定时间后调用fadeIn 函数，fadeIn 接受一个回调参数，因此您可以设置另一个函数来设置背景颜色的动画。

```
$(document).ready(function() { 
    setTimeout(function() { $('#alert-box').fadeIn('slow', 
                 function() { $('#alert-box').animate(
                                 {backgroundColor: "rgb(255,00,00)"},1500); 
                 })}, 
     5000)}); 
```

那应该做你想要的。虽然我还没有验证它。

您还需要 jQuery Color 插件。

[http://plugins.jquery.com/project/color](http://plugins.jquery.com/project/color)

编辑：这是相同的东西，但添加了脉冲动画。

```
$(document).ready(function() { 
    setTimeout(function() { $('#alert-box').fadeIn('slow', 
                 function() { $('#alert-box').animate({backgroundColor: "rgb(255,0,0)"}, {duration: "slow"})
                        .animate({backgroundColor: "rgb(255,255,255)"}, {duration: "slow"})
                        .animate({backgroundColor: "rgb(255,0,0)"}, {duration: "slow"})
                        .animate({backgroundColor: "rgb(255,255,255)"}, {duration: "slow"})
                        .animate({backgroundColor: "rgb(255,0,0)"}, {duration: "slow"});; 
                 })}, 5000)}); 
```

# java - 在正则表达式中使用条件

> ID：505922
> 
> 赞同：0
> 
> 时间：2009-02-03T03:26:24.907
> 
> 标签：java, regex, exception

来源：

```
<TD>
    <A HREF="/home"><IMG SRC="/images/home.gif"></A>
    <IMG SRC="/images/spacer.gif">
    <A HREF="/search"><IMG SRC="/images/search.gif"></A>
    <IMG SRC="/images/spacer.gif">
    <A HREF="/help"><IMG SRC="/images/help.gif"></A>
</TD> 
```

正则表达式：

```
 (<[Aa]\s+[^>]+>\s*)?<[Ii][Mm][Gg]\s+[^>]+>(?(1)\s*</[Aa]>) 
```

结果：

```
<A HREF="/home"><IMG SRC="/images/home.gif"></A>
<IMG SRC="/images/spacer.gif">
<A HREF="/search"><IMG SRC="/images/search.gif"></A>
<IMG SRC="/images/spacer.gif">
<A HREF="/help"><IMG SRC="/images/help.gif"></A> 
```

“？（1）”是什么意思？

当我在 Java 中运行它时，它会导致异常：java.util.regex.PatternSyntaxException，无法识别“？（1）”。

书中的解释是：

`This pattern requires explanation. (<[Aa]\s+[^>]+>\s*)? matches an opening <A> or <a> tag (with any attributes that may be present), if present (the closing ? makes the expression optional). <[Ii][Mm][Gg]\s+[^>]+> then matches the <IMG> tag (regardless of case) with any of its attributes. (?(1)\s*</[Aa]>) starts off with a condition: ?(1) means execute only what comes next if backreference 1 (the opening <A> tag) exists (or in other words, execute only what comes next if the first <A> match was successful). If (1) exists, then \s*</[Aa]> matches any trailing whitespace followed by the closing </A> tag.`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T05:52:43.580

语法是正确的。奇怪的 (?....) 设置了一个条件。这是 if...then 语句的正则表达式语法。(1) 是对正则表达式开头的捕获组的反向引用，它匹配 html <a> 标记，如果有一个，因为该捕获组是可选的。由于对捕获标记的反向引用遵循正则表达式的“if”部分，因此它所做的是确保在尝试匹配结束标记之前捕获了一个开始 <a> 标记。一种非常聪明的方法，可以让两个标签都成为可选标签，但在第一个标签存在时强制两者兼而有之。这就是它能够匹配示例文本中的所有行的方式，即使其中一些只有 <img> 标签。

至于为什么它会在您的情况下引发异常，很可能您使用的正则表达式的风格不支持条件。并非所有人都这样做。

编辑：这是关于正则表达式中条件的一个很好的参考：[http ://www.regular-expressions.info/conditional.html](http://www.regular-expressions.info/conditional.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T11:51:15.980

正如 Bryan 所说，您正在查看的是一个条件构造，而 Java 不支持它们。问号后面的括号表达式实际上可以是任何零宽度断言，例如前瞻或后瞻，而不仅仅是对捕获组的引用。（我更喜欢调用这些*反向断言*，以避免混淆。*反向引用*与捕获组所做的相同，但反向断言只是断言捕获组匹配*某些东西*。）

几年前我在 Perl 工作时了解了条件语句，但在 Java 中我从未错过它们。例如，在这种情况下，一个简单的交替就可以解决问题：

```
(?i)<a\s+[^>]+>\s*<img\s+[^>]+>\s*</a]>|<img\s+[^>]+> 
```

条件版本的一个优点是您可以使用单个捕获组捕获 IMG 标记：

```
(?i)(<a\s+[^>]+>\s*)?(<img\s+[^>]+>)(?(1)\s*</a>) 
```

在替代版本中，您必须为每个替代方案都有一个捕获组，但这在 Java 中不如在 Perl 中重要，因为它具有所有内置的正则表达式魔法。以下是我在 Java 中提取 IMG 标记的方法：

```
Pattern p = Pattern.compile(
  "<a\\s+[^>]+>\\s*(<img\\s+[^>]+>)\\s*</a>|(<img\\s+[^>]+>)"
  Pattern.CASE_INSENSITIVE);
Matcher m = p.matcher(s);
while (m.find())
{
  System.out.println(m.start(1) != -1 ? m.group(1) : m.group(2));
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T03:33:17.030

它可以是此处描述的非捕获组：

> 还有一个特殊的组，组 0，它始终代表整个表达式。该组不包括在 groupCount 报告的总数中。以 (? 开头的组是纯的、非捕获组，它们不捕获文本并且不计入组总数。（您将在后面的模式类的方法部分中看到非捕获组的示例。）

[Java 正则表达式教程](http://java.sun.com/docs/books/tutorial/essential/regex/groups.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T04:05:45.217

简短的回答：这并不意味着什么。问题在于整个片段：

```
(?(1)\s*) 
```

**()**创建一个反向引用，因此您可以重用内部匹配的任何文本。它们还允许您将运算符应用于其中的所有内容（但在您的示例中没有这样做）。

**?** 表示如果它之前的项目应该匹配，但如果它不存在也可以。当它出现在**(**

(?: *MoreTextHere* ) 当您不需要重用匹配的文本时，可用于加速 RegEx。但这仍然没有任何意义，当您的输入是 HTML 时，为什么要匹配 1 呢？

尝试：

```
(?:<[Aa]\s+[^>]+>\s*)?<[Ii][Mm][Gg]\s+[^>]+> 
```

您从未准确说出您要匹配的内容，因此如果此答案不满足您的要求，请解释您要使用 RegEx 做什么。

# python - 从 MS Word 中提取数据

> ID：505925
> 
> 赞同：6
> 
> 时间：2009-02-03T03:27:53.547
> 
> 标签：python, vba, ms-word, pywin32

我正在寻找一种将 Word 文件中的数据提取/抓取到数据库中的方法。我们的公司程序在 MS Word 文件中记录了与客户的会议纪要，主要是由于历史和惯性。

我希望能够将这些会议纪要中的操作项提取到数据库中，以便我们可以从 Web 界面访问它们，将它们转换为任务并在它们完成时更新它们。

这是最好的方法：

1.  从 Word 内部创建 CSV 然后上传到数据库的 VBA 宏？
2.  Word 中的 VBA 宏与 DB 的连接（如何从 VBA 连接到 MySQL？）
3.  Python脚本通过win32com然后上传到数据库？

最后一个对我很有吸引力，因为 Web 界面是用 Django 构建的，但我从未使用过 win32com 或尝试从 python 编写 Word 脚本。

**编辑：**我已经开始使用 VBA 提取文本，因为它使处理 Word 对象模型更容易一些。我遇到了一个问题 - 所有文本都在表格中，当我从我想要的 CELLS 中拉出字符串时，我在每个字符串的末尾得到一个奇怪的小方框字符。我的代码如下所示：

```
sFile = "D:\temp\output.txt"
fnum = FreeFile
Open sFile For Output As #fnum

num_rows = Application.ActiveDocument.Tables(2).Rows.Count

For n = 1 To num_rows
    Descr = Application.ActiveDocument.Tables(2).Cell(n, 2).Range.Text
    Assign = Application.ActiveDocument.Tables(2).Cell(n, 3).Range.Text
    Target = Application.ActiveDocument.Tables(2).Cell(n, 4).Range.Text
    If Target = "" Then
        ExportText = ""
    Else
        ExportText = Descr & Chr(44) & Assign & Chr(44) & _
            Target & Chr(13) & Chr(10)
        Print #fnum, ExportText
    End If
Next n

Close #fnum 
```

小控制字符框是怎么回事？Word 是否有某种字符代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T05:52:44.860

Word 有一个小标记，它放在表格中每个文本单元格的末尾。

它就像段落中的段落结束标记一样使用：存储整个段落的格式。

只需使用 Left() 函数将其剥离，即

```
 Left(Target, Len(Target)-1)) 
```

顺便说一句，而不是

```
 num_rows = Application.ActiveDocument.Tables(2).Rows.Count
 For n = 1 To num_rows
      Descr = Application.ActiveDocument.Tables(2).Cell(n, 2).Range.Text 
```

试试这个：

```
 For Each row in Application.ActiveDocument.Tables(2).Rows
      Descr = row.Cells(2).Range.Text 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T03:58:49.707

好吧，我从来没有编写过 Word 脚本，但是用 win32com 做简单的事情很容易。就像是：

```
from win32com.client import Dispatch
word = Dispatch('Word.Application')
doc = word.Open('d:\\stuff\\myfile.doc')
doc.SaveAs(FileName='d:\\stuff\\text\\myfile.txt', FileFormat=?)  # not sure what to use for ? 
```

这是未经测试的，但我认为类似的东西只会打开文件并将其保存为纯文本（前提是您可以找到正确的文件格式）——然后您可以将文本读入 python 并从那里进行操作。也可能有一种方法可以直接获取文件的内容，但我不知道它是直接的；文档可能很难找到，但如果您有 VBA 文档或经验，您应该能够携带它们。

看看不久前的这篇文章：http: [//mail.python.org/pipermail/python-list/2002-October/168785.html](http://mail.python.org/pipermail/python-list/2002-October/168785.html)向下滚动到 COMTools.py；那里有一些很好的例子。

您还可以运行 makepy.py（pythonwin 发行版的一部分）为可用的 COM 函数生成 python“签名”，然后将其作为一种文档进行查看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T11:52:04.200

您可以使用 OpenOffice。它可以打开word文件，也可以运行python宏。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T03:36:56.100

我想说看看右边的相关问题 -->[上面](https://stackoverflow.com/questions/125222/extracting-text-from-ms-word-files-in-python)的问题似乎有一些关于走 python 路线的好主意。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T04:23:52.480

如何将文件保存为 xml。然后使用 python 或其他东西将数据从单词中提取出来并放入数据库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T12:46:49.440

可以以编程方式将 Word 文档另存为 HTML，并将包含的表导入 Access。这需要很少的努力。

# java - 如何计算List中某个元素出现的次数

> ID：505928
> 
> 赞同：216
> 
> 时间：2009-02-03T03:29:13.620
> 
> 标签：java, arraylist, collections

我有一个`ArrayList`Java 的 Collection 类，如下所示：

```
ArrayList<String> animals = new ArrayList<String>();
animals.add("bat");
animals.add("owl");
animals.add("bat");
animals.add("bat"); 
```

如您所见，`animals` `ArrayList`由 3 个`bat`元素和 1 个`owl`元素组成。我想知道 Collection 框架中是否有返回出现次数的 API，`bat`或者是否有另一种方法来确定出现次数。

我发现 Google 的 Collection`Multiset`确实有一个 API 可以返回元素出现的总数。但这仅与 JDK 1.5 兼容。我们的产品目前在 JDK 1.6 中，所以我不能使用它。

* * *

## 回答 #1

> 赞同：398
> 
> 时间：2010-03-17T03:35:24.680

我很确定 Collections 中的静态频率方法在这里会派上用场：

```
int occurrences = Collections.frequency(animals, "bat"); 
```

反正我就是这样做的。我很确定这是jdk 1.6。

* * *

## 回答 #2

> 赞同：138
> 
> 时间：2014-11-29T19:18:39.743

在 Java 8 中：

```
Map<String, Long> counts =
    list.stream().collect(Collectors.groupingBy(e -> e, Collectors.counting())); 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2016-02-04T18:22:56.073

使用**Streams**的替代**Java 8**解决方案：

 **```
long count = animals.stream().filter(animal -> "bat".equals(animal)).count(); 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2009-02-03T22:50:28.020

[这说明了为什么“通过接口引用对象](http://www.google.com/search?&q=Item+Refer+to+objects+by+their+interfaces)”很重要，如[Effective Java](http://www.google.com/search?&q=Effective+Java)书中所述。

如果您对实现进行编码并在代码中的 50 个位置使用 ArrayList，那么当您找到一个好的“列表”实现来计算项目时，您将不得不更改所有这 50 个位置，并且可能您必须破坏你的代码（如果它只被你使用，没什么大不了的，但如果它被别人使用，你也会破坏他们的代码）

通过对接口进行编程，您可以让这 50 个位置保持不变，并将实现从 ArrayList 替换为“CountItemsList”（例如）或其他一些类。

下面是一个关于如何编写的非常基本的示例。这只是一个示例，生产就绪列表会复杂得多**。**

```
import java.util.*;

public class CountItemsList<E> extends ArrayList<E> { 

    // This is private. It is not visible from outside.
    private Map<E,Integer> count = new HashMap<E,Integer>();

    // There are several entry points to this class
    // this is just to show one of them.
    public boolean add( E element  ) { 
        if( !count.containsKey( element ) ){
            count.put( element, 1 );
        } else { 
            count.put( element, count.get( element ) + 1 );
        }
        return super.add( element );
    }

    // This method belongs to CountItemList interface ( or class ) 
    // to used you have to cast.
    public int getCount( E element ) { 
        if( ! count.containsKey( element ) ) {
            return 0;
        }
        return count.get( element );
    }

    public static void main( String [] args ) { 
        List<String> animals = new CountItemsList<String>();
        animals.add("bat");
        animals.add("owl");
        animals.add("bat");
        animals.add("bat");

        System.out.println( (( CountItemsList<String> )animals).getCount( "bat" ));
    }
} 
```

这里应用的面向对象原则：继承、多态、抽象、封装。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-02-03T03:35:29.363

抱歉，没有简单的方法调用可以做到这一点。不过，您需要做的就是创建一个地图并用它计算频率。

```
HashMap<String,int> frequencymap = new HashMap<String,int>();
foreach(String a in animals) {
  if(frequencymap.containsKey(a)) {
    frequencymap.put(a, frequencymap.get(a)+1);
  }
  else{ frequencymap.put(a, 1); }
} 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-02-03T03:33:26.140

Java 中没有本地方法可以为您做到这一点。但是，您可以使用Apache Commons-Collections 中的[IterableUtils#countMatches()](https://commons.apache.org/proper/commons-collections/apidocs/org/apache/commons/collections4/IterableUtils.html#countMatches(java.lang.Iterable,%20org.apache.commons.collections4.Predicate))为您完成此操作。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2017-11-14T10:20:32.357

*使用 Java 8 功能在数组中查找字符串值出现的简单方法。*

```
public void checkDuplicateOccurance() {
        List<String> duplicateList = new ArrayList<String>();
        duplicateList.add("Cat");
        duplicateList.add("Dog");
        duplicateList.add("Cat");
        duplicateList.add("cow");
        duplicateList.add("Cow");
        duplicateList.add("Goat");          
        Map<String, Long> couterMap = duplicateList.stream().collect(Collectors.groupingBy(e -> e.toString(),Collectors.counting()));
        System.out.println(couterMap);
    } 
```

***输出：{Cat=2, Goat=1, Cow=1, cow=1, Dog=1}***

您会注意到“Cow”和cow 不被视为相同的字符串，如果您在相同的计数下需要它，请使用.toLowerCase()。请在下面找到相同的代码段。

```
Map<String, Long> couterMap = duplicateList.stream().collect(Collectors.groupingBy(e -> e.toString().toLowerCase(),Collectors.counting())); 
```

***输出：{cat=2，cow=2，goat=1，dog=1}***

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-02-03T03:42:23.110

我想知道，为什么不能在 JDK 1.6 中使用 Google 的 Collection API。是这样说的吗？我想你可以，不应该有任何兼容性问题，因为它是为较低版本构建的。如果它是为 1.6 构建的并且您正在运行 1.5，则情况会有所不同。

我在某个地方错了吗？

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2015-02-14T14:41:35.767

实际上，Collections 类有一个名为：**frequency** (Collection c, Object o) 的静态方法，它返回您正在搜索的元素的出现次数，顺便说一下，这对您来说非常有用：

```
ArrayList<String> animals = new ArrayList<String>();
animals.add("bat");
animals.add("owl");
animals.add("bat");
animals.add("bat");
System.out.println("Freq of bat: "+Collections.frequency(animals, "bat")); 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-02-03T22:07:52.693

一种更有效的方法可能是

```
Map<String, AtomicInteger> instances = new HashMap<String, AtomicInteger>();

void add(String name) {
     AtomicInteger value = instances.get(name);
     if (value == null) 
        instances.put(name, new AtomicInteger(1));
     else
        value.incrementAndGet();
} 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2016-03-17T23:22:24.797

直接从列表中获取对象的出现：

```
int noOfOccurs = Collections.frequency(animals, "bat"); 
```

要在列表中获取 Object 集合的出现，请将 Object 类中的 equals 方法重写为：

```
@Override
public boolean equals(Object o){
    Animals e;
    if(!(o instanceof Animals)){
        return false;
    }else{
        e=(Animals)o;
        if(this.type==e.type()){
            return true;
        }
    }
    return false;
}

Animals(int type){
    this.type = type;
} 
```

将 Collections.frequency 称为：

```
int noOfOccurs = Collections.frequency(animals, new Animals(1)); 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-02-03T03:35:30.893

你想要的是一个包——它就像一个集合，但也计算出现的次数。不幸的是，java Collections 框架 - 很棒，因为它们没有 Bag impl。为此，必须使用 Apache Common Collection[链接文本](http://commons.apache.org/collections/userguide.html#Bags)

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2021-02-22T18:40:45.430

为了实现这一目标，可以通过多种方式做到这一点，即：

返回单个元素出现次数的方法：

**[收集频率](https://docs.oracle.com/javase/7/docs/api/java/util/Collections.html)**

```
Collections.frequency(animals, "bat"); 
```

Java 流：

**筛选**

```
animals.stream().filter("bat"::equals).count(); 
```

**只是迭代认为列表**

```
public static long manually(Collection<?> c, Object o){
    int count = 0;
    for(Object e : c)
        if(e.equals(o))
            count++;
    return count;
} 
```

创建频率图的方法：

**[Collectors.groupingBy](https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collectors.html#groupingBy-java.util.function.Function-)**

```
Map<String, Long> counts = 
       animals.stream()
              .collect(Collectors.groupingBy(Function.identity(), Collectors.counting())); 
```

[合并](https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#merge-K-V-java.util.function.BiFunction-)

```
Map<String, Long> map = new HashMap<>();
c.forEach(e -> map.merge(e, 1L, Long::sum)); 
```

**手动**

```
Map<String, Integer> mp = new HashMap<>();
        animals.forEach(animal -> mp.compute(animal, (k, v) -> (v == null) ? 1 : v + 1)); 
```

包含所有方法的运行示例：

```
import java.util.*;
import java.util.function.Function;
import java.util.stream.Collectors;

public class Frequency {

    public static int frequency(Collection<?> c, Object o){
        return Collections.frequency(c, o);
    }

    public static long filter(Collection<?> c, Object o){
        return c.stream().filter(o::equals).count();
    }

    public static long manually(Collection<?> c, Object o){
        int count = 0;
        for(Object e : c)
            if(e.equals(o))
                count++;
        return count;
    }

    public static Map<?, Long> mapGroupBy(Collection<?> c){
        return c.stream()
                .collect(Collectors.groupingBy(Function.identity() , Collectors.counting()));
    }

    public static Map<Object, Long> mapMerge(Collection<?> c){
        Map<Object, Long> map = new HashMap<>();
        c.forEach(e -> map.merge(e, 1L, Long::sum));
        return map;
    }

    public static Map<Object, Long> manualMap(Collection<?> c){
        Map<Object, Long> map = new HashMap<>();
        c.forEach(e -> map.compute(e, (k, v) -> (v == null) ? 1 : v + 1));
        return map;
    }

    public static void main(String[] args){
        List<String> animals = new ArrayList<>();
        animals.add("bat");
        animals.add("owl");
        animals.add("bat");
        animals.add("bat");

        System.out.println(frequency(animals, "bat"));
        System.out.println(filter(animals,"bat"));
        System.out.println(manually(animals,"bat"));
        mapGroupBy(animals).forEach((k, v) -> System.out.println(k + " -> "+v));
        mapMerge(animals).forEach((k, v) -> System.out.println(k + " -> "+v));
        manualMap(animals).forEach((k, v) -> System.out.println(k + " -> "+v));
    }
} 
```

方法名称应该反映了这些方法正在做什么，但是，我使用该名称来反映正在使用的方法（假设在当前上下文中它是好的）。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2017-08-23T17:00:58.177

```
List<String> list = Arrays.asList("as", "asda", "asd", "urff", "dfkjds", "hfad", "asd", "qadasd", "as", "asda",
        "asd", "urff", "dfkjds", "hfad", "asd", "qadasd" + "as", "asda", "asd", "urff", "dfkjds", "hfad", "asd",
        "qadasd", "as", "asda", "asd", "urff", "dfkjds", "hfad", "asd", "qadasd"); 
```

方法一：

```
Set<String> set = new LinkedHashSet<>();
set.addAll(list);

for (String s : set) {

    System.out.println(s + " : " + Collections.frequency(list, s));
} 
```

方法二：

```
int count = 1;
Map<String, Integer> map = new HashMap<>();
Set<String> set1 = new LinkedHashSet<>();
for (String s : list) {
    if (!set1.add(s)) {
        count = map.get(s) + 1;
    }
    map.put(s, count);
    count = 1;

}
System.out.println(map); 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2015-01-28T22:52:44.263

如果你使用[Eclipse Collections](http://www.eclipse.org/collections/)，你可以使用`Bag`. A`MutableBag`可以[`RichIterable`](http://www.eclipse.org/collections/javadoc/10.0.0/org/eclipse/collections/api/RichIterable.html)通过调用从 的任何实现中返回`toBag()`。

```
MutableList<String> animals = Lists.mutable.with("bat", "owl", "bat", "bat");
MutableBag<String> bag = animals.toBag();
Assert.assertEquals(3, bag.occurrencesOf("bat"));
Assert.assertEquals(1, bag.occurrencesOf("owl")); 
```

`HashBag`Eclipse Collections 中的实现由`MutableObjectIntMap`.

**注意：**我是 Eclipse Collections 的提交者。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-02-03T03:36:25.010

所以用老式的方式来做你自己的：

```
Map<String, Integer> instances = new HashMap<String, Integer>();

void add(String name) {
     Integer value = instances.get(name);
     if (value == null) {
        value = new Integer(0);
        instances.put(name, value);
     }
     instances.put(name, value++);
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-02-03T04:06:23.593

将arraylist的元素放入hashMap中统计频率。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2016-02-04T10:58:17.093

**Java 8** - 另一种方法

```
String searched = "bat";
long n = IntStream.range(0, animals.size())
            .filter(i -> searched.equals(animals.get(i)))
            .count(); 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2019-06-20T03:45:03.487

```
package traversal;

import java.util.ArrayList;
import java.util.List;

public class Occurrance {
    static int count;

    public static void main(String[] args) {
        List<String> ls = new ArrayList<String>();
        ls.add("aa");
        ls.add("aa");
        ls.add("bb");
        ls.add("cc");
        ls.add("dd");
        ls.add("ee");
        ls.add("ee");
        ls.add("aa");
        ls.add("aa");

        for (int i = 0; i < ls.size(); i++) {
            if (ls.get(i) == "aa") {
                count = count + 1;
            }
        }
        System.out.println(count);
    }
} 
```

> 输出：4

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-03-01T19:22:06.287

如果您是我的[ForEach DSL](http://www.iam.unibe.ch/~akuhn/blog/2008/pimp-my-foreach-loop)的用户，可以通过`Count`查询来完成。

```
Count<String> query = Count.from(list);
for (Count<Foo> each: query) each.yield = "bat".equals(each.element);
int number = query.result(); 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-10-08T09:49:25.260

```
List<String> lst = new ArrayList<String>();

lst.add("Ram");
lst.add("Ram");
lst.add("Shiv");
lst.add("Boss");

Map<String, Integer> mp = new HashMap<String, Integer>();

for (String string : lst) {

    if(mp.keySet().contains(string))
    {
        mp.put(string, mp.get(string)+1);

    }else
    {
        mp.put(string, 1);
    }
}

System.out.println("=mp="+mp); 
```

输出：

```
=mp= {Ram=2, Boss=1, Shiv=1} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-02-28T03:47:06.007

**您可以将 Java 8 的 groupingBy 功能用于您的用例。**

```
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.function.Function;
import java.util.stream.Collectors;

public class Test {
    public static void main(String[] args) {
        List<String> animals = new ArrayList<>();

        animals.add("bat");
        animals.add("owl");
        animals.add("bat");
        animals.add("bat");

        Map<String,Long> occurrenceMap =
                animals.stream().collect(Collectors.groupingBy(Function.identity(),Collectors.counting()));
        System.out.println("occurrenceMap:: " + occurrenceMap);
    }
} 
```

**输出**

```
occurrenceMap:: {bat=3, owl=1} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-08-31T16:11:10.257

我不想让这种情况变得更加困难，并使用两个迭代器来实现我有一个带有 LastName -> FirstName 的 HashMap。我的方法应该删除具有重复名字的项目。

```
public static void removeTheFirstNameDuplicates(HashMap<String, String> map)
{

    Iterator<Map.Entry<String, String>> iter = map.entrySet().iterator();
    Iterator<Map.Entry<String, String>> iter2 = map.entrySet().iterator();
    while(iter.hasNext())
    {
        Map.Entry<String, String> pair = iter.next();
        String name = pair.getValue();
        int i = 0;

        while(iter2.hasNext())
        {

            Map.Entry<String, String> nextPair = iter2.next();
            if (nextPair.getValue().equals(name))
                i++;
        }

        if (i > 1)
            iter.remove();

    }

} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-03-13T04:33:01.120

```
 Integer[] spam = new Integer[]  {1,2,2,3,4};
 List<Integer>   list=Arrays.asList(spam);

System.out.println(list.stream().collect(Collectors.groupingBy(Function.identity(),Collectors.counting())));
System.out.println(list.stream().collect(Collectors.groupingBy(Function.identity(),HashMap::new,Collectors.counting()))); 
```

输出

{1=1, 2=2, 3=1, 4=1}

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2019-02-07T14:28:50.813

```
Map<String,Integer> hm = new HashMap<String, Integer>();
for(String i : animals) {
    Integer j = hm.get(i);
    hm.put(i,(j==null ? 1 : j+1));
}
for(Map.Entry<String, Integer> val : hm.entrySet()) {
    System.out.println(val.getKey()+" occurs : "+val.getValue()+" times");
} 
```

# asp.net - 访问 CRM / Sharepoint Web 服务中的 DefaultCredentials

> ID：505938
> 
> 赞同：7
> 
> 时间：2009-02-03T03:34:48.430
> 
> 标签：asp.net, web-services, sharepoint, crm

我制作了一个访问 CRM 网络服务的应用程序。问题是，当我将 dll 部署到 Sharepoint 服务器时，它返回错误 401 未经授权。显然 System.Net.CredentialCache.DefaultCredentials 不起作用（我的怀疑）。这是代码。

```
CrmSdk.CrmAuthenticationToken token = new CrmSdk.CrmAuthenticationToken();
token.AuthenticationType = AuthenticationType.AD;
token.OrganizationName = ORGANIZATION_NAME;

CrmService service = new CrmService();
service.Url = "http://crmserver:5555/mscrmservices/2007/crmservice.asmx";
service.CrmAuthenticationTokenValue = token;
service.PreAuthenticate = true;
service.Credentials = System.Net.CredentialCache.DefaultCredentials; 
```

反之亦然。

当我制作访问 Sharepoint 的 web 服务（对插件进行编码）并将其部署到 CRM 服务器的应用程序时。它无法访问 Sharepoint 的网络服务。未经授权的错误。这是代码：

```
Lists listService = new Lists();
listService.PreAuthenticate = true;
listService.Credentials = System.Net.CredentialCache.DefaultCredentials;
listService.Url = "http://sharepointserver/webname/_vti_bin/Lists.asmx"; 
```

我的 CRM 服务器和 Sharepoint 服务器在同一个域中。

对于这两个代码，如果我将凭据部分更改为类似的内容，然后将其部署到服务器上，它就可以运行。

```
service.Credentials = new NetworkCredential("username", "password", "domain"); 
```

不过，我不想这样做，因为它会在代码中显示用户的密码。有人可以帮助我吗？

两台服务器中的 IIS 都不允许匿名访问，它使用集成 Windows 身份验证。

谢谢

* * *

从我的本地计算机上，我可以访问 CRM Web 服务或 Sharepoint Web 服务。我想我已获得授权，因为 DefaultCredentials 发送了我的凭据，其密码保存在“**存储的用户名和密码**”（*控制面板>用户帐户>选项卡高级>管理密码*）这样，我不必输入：

```
service.Credentials = new NetworkCredential("username", "password", "domain"); 
```

并且我本地 comp 中的 DefaultCredentials 被授权访问 Web 服务。

我试图在访问 CRM Web 服务的 Sharepoint 服务器上实现这一点。和..tadaa..它不会工作。哈哈哈。。

我们可以将凭据注入服务器中的 DefaultCredentials 吗？

我想做的最后一件事是硬编码用户帐户（如上面的代码）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T03:53:01.997

可能是您需要运行 Kerberos 进行身份验证，但不能确定，而且设置只是为了检查很痛苦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T21:16:14.997

您是否确认默认凭据与您明确声明时的凭据相同？可能默认凭据是您不期望的另一个帐户的凭据。

**编辑#1 ：根据**[MSDN 上 DefaultCredentials 属性](http://msdn.microsoft.com/en-us/library/system.net.credentialcache.defaultcredentials.aspx)的注释：

> DefaultCredentials 表示当前运行应用程序的安全上下文的系统凭据。对于客户端应用程序，这些通常是运行应用程序的用户的 Windows 凭据（用户名、密码和域）。对于 ASP.NET 应用程序，默认凭据是登录用户或被模拟用户的用户凭据。

您还需要确保访问 CRM 页面（调用 SharePoint Web 服务）的用户可以使用他们的凭据访问 Web 服务，反之亦然。如果他们可以，那么似乎更有可能发生某种模仿。

**编辑#2**：假设您可以访问 CRM 和 SharePoint 服务器，您可能会同时访问应用程序和系统日志。一个或两个应该可能指示登录失败并指示哪个帐户尝试访问资源（在本例中为 Web 服务）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-13T02:39:11.997

通过使用 DefaultCredentials 意味着 ASP.NET 工作进程或 IIS 工作进程将获取运行 IIS 应用程序池的用户的凭据。

因此，如果您的 Dynamics CRM 应用程序池在用户帐户 Custom-CRM-Domain\JohnDoe 下运行，这意味着它将获得用户帐户 Custom-CRM-Domain\JohnDoe 下的权限。

请检查运行 CRM\Sharepoint Application IIS Web 应用程序的应用程序池的用户帐户。

这些是检查应用程序池的步骤：

1.  打开网站->右键单击->选择属性
2.  选择主目录选项卡
3.  请注意下面下拉列表中的应用程序池名称
4.  现在，转到应用程序池文件夹
5.  尝试找到已在步骤 3 中列出的应用程序池名称 -> 右键单击​​并选择属性
6.  选择“身份”选项卡，您将找到运行应用程序池的用户帐户

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-11T19:31:49.533

Not familiar with Sharepoint, but can't you just store the connection information in a configuration and use built in tools for securing your web.config? Thats what I do.

[http://aspnet.4guysfromrolla.com/articles/021506-1.aspx](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-06T02:43:13.570

service.Credentials = System.Net.CredentialsCache.DefaultNetworkCredentials；

试试看。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-02T11:48:35.770

为了能够使用默认凭据，必须在 SharePoint 和 CRM 中定义 Active Directory 中的用户，并具有足够的权限来执行您正在使用代码执行的操作。

并尝试使用 sdk（crm 有帮助程序类）而不是服务定义。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-02-26T15:26:03.870

要解决此问题，您需要首先知道哪个用户正在运行应用程序池，如果您需要使用 CredentialCache.DefaultCredentials 那么您必须将用户添加到“辅助站点集管理员”中，例如 svcadmin 等运行 SharePoint 中央管理应用程序。通过该 SP 允许已通过凭证的用户访问它需要的东西。![在此处输入图像描述](https://i.stack.imgur.com/XiK50.jpg)

# c++ - VS2005 C++编译问题包括 在 MFC 应用程序中

> ID：505939
> 
> 赞同：0
> 
> 时间：2009-02-03T03:35:20.050
> 
> 标签：c++, visual-studio-2005, compiler-construction, mfc

我在将旧项目从 VS6 转换为 VS2005 时遇到了一些麻烦。在代码中的一个地方，它使用了 variant_t 类型，因此它为此目的包含了 comdef.h。comdef.h 然后包含 comutil.h ，它会为我生成这些错误：

```
c:\program files\microsoft visual studio 8\vc\include\comutil.h(978) : error C2535: '_variant_t::_variant_t(int) throw()' : member function already defined or declared
    c:\program files\microsoft visual studio 8\vc\include\comutil.h(970) : see declaration of '_variant_t::_variant_t'
c:\program files\microsoft visual studio 8\vc\include\comutil.h(1007) : error C2535: '_variant_t::operator int(void) const' : member function already defined or declared
    c:\program files\microsoft visual studio 8\vc\include\comutil.h(998) : see declaration of '_variant_t::operator int'
c:\program files\microsoft visual studio 8\vc\include\comutil.h(1037) : error C2535: '_variant_t &_variant_t::operator =(int)' : member function already defined or declared
    c:\program files\microsoft visual studio 8\vc\include\comutil.h(1029) : see declaration of '_variant_t::operator ='
c:\program files\microsoft visual studio 8\vc\include\comutil.h(1331) : error C2084: function '_variant_t::_variant_t(int) throw()' already has a body
    c:\program files\microsoft visual studio 8\vc\include\comutil.h(970) : see previous definition of '{ctor}'
c:\program files\microsoft visual studio 8\vc\include\comutil.h(1588) : error C2084: function '_variant_t::operator int(void) const' already has a body
    c:\program files\microsoft visual studio 8\vc\include\comutil.h(998) : see previous definition of '.H'
c:\program files\microsoft visual studio 8\vc\include\comutil.h(2006) : error C2084: function '_variant_t &_variant_t::operator =(int)' already has a body
    c:\program files\microsoft visual studio 8\vc\include\comutil.h(1029) : see previous definition of '=' 
```

可能有一些配置不正确，一些定义丢失或一些我应该包含的包含文件，但我似乎找不到问题。任何指向正确方向的指针都非常感谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T04:06:02.627

这看起来像是两件事之一，一个包含订单问题，或者正如你所说的一些没有被定义的东西，但我倾向于第一个。您可能需要检查 msdn 并确保对何时可以包含 comutil.h 没有限制（我知道如果您在 windows.h 之前包含 winsock2.h，这是一个问题）。在 C/C++ > Advanced to Show Includes 下还有一个选项（命令行中的 /showIncludes 选项），这在尝试跟踪此类问题时通常很有帮助。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-03T03:55:11.913

您自己的代码是否执行以下操作：

```
#define long int 
```

# wcf - 我可以停止我的 WCF 生成 ArrayOfString 而不是 string[] 或 List

> ID：505943
> 
> 赞同：12
> 
> 时间：2009-02-03T03:35:37.493
> 
> 标签：wcf

我在消息包含`List<string>`作为参数的 WCF 服务代理方面遇到了一个小问题。

我在 Visual Studio 中使用“添加服务引用”来生成对我的服务的引用。

```
 // portion of my web service message
   public List<SubscribeInfo> Subscribe { get; set; }
   public List<string> Unsubscribe { get; set; } 
```

这些是我`MsgIn`为我的一种网络方法生成的属性。你可以看到它`ArrayOfString`在我使用时使用`List<string>`，而其他需要`List<SubscribeInfo>`- 与我上面的原始 C# 对象相匹配。

```
[System.Runtime.Serialization.DataMemberAttribute(EmitDefaultValue=false)]
public System.Collections.Generic.List<DataAccess.MailingListWSReference.SubscribeInfo> Subscribe {
    get {
        return this.SubscribeField;
    }
    set {
        if ((object.ReferenceEquals(this.SubscribeField, value) != true)) {
            this.SubscribeField = value;
            this.RaisePropertyChanged("Subscribe");
        }
    }
}

[System.Runtime.Serialization.DataMemberAttribute(EmitDefaultValue=false)]
publicDataAccess.MailingListWSReference.ArrayOfString Unsubscribe {
    get {
        return this.UnsubscribeField;
    }
    set {
        if ((object.ReferenceEquals(this.UnsubscribeField, value) != true)) {
            this.UnsubscribeField = value;
            this.RaisePropertyChanged("Unsubscribe");
        }
    }
} 
```

生成的 ArrayOfString 类如下所示。这是在我的代码中生成的类 - 它不是 .NET 类。它实际上为我生成了一个继承自 List 的类，但没有“体面”来为我创建任何构造函数。

```
 [System.Diagnostics.DebuggerStepThroughAttribute()]
    [System.CodeDom.Compiler.GeneratedCodeAttribute("System.Runtime.Serialization", "3.0.0.0")]
    [System.Runtime.Serialization.CollectionDataContractAttribute(Name="ArrayOfString", Namespace="http://www.example.com/", ItemName="string")]
    [System.SerializableAttribute()]
    public class ArrayOfString : System.Collections.Generic.List<string> {
    } 
```

问题是我经常这样创建我的消息：

```
client.UpdateMailingList(new UpdateMailingListMsgIn()
{
    Email = model.Email,
    Name = model.Name,
    Source = Request.Url.ToString(),
    Subscribe = subscribeTo.ToList(),
    Unsubscribe = unsubscribeFrom.ToList()
}); 
```

我真的很喜欢这给我的干净外观。

现在针对实际问题：

我不能将 a 分配`List<string>`给`Unsubscribe`属性`ArrayOfString` - 即使它是从 List 继承的。事实上，如果没有额外的陈述，我似乎找不到任何方法来分配它。

我尝试了以下方法：

*   `new ArrayOfString(unsubscribeFrom.ToList())` - 这个构造函数不存在:-(
*   更改代码生成器使用的数组的类型 - 不起作用 - 它总是给我 ArrayOfString (!?)
*   尝试投射`List<string>`到`ArrayOfString` - 失败并出现“无法投射”，即使它编译得很好
*   创建`new ArrayOfString()`然后`AddRange(unsubscribeFrom.ToList())` - 工作，但我不能在一个声明中做到这一切
*   创建一个转换函数`ToArrayOfString(List<string>)`，它可以工作，但不像我想要的那样干净。

它只对字符串这样做，这很烦人。

我错过了什么吗？有没有办法告诉它不要生成`ArrayOfString`- 或其他一些技巧来分配它？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-03-12T19:08:47.340

任何实现名为“Add”的方法的 .NET 对象都可以像数组或字典一样进行初始化。

由于 ArrayOfString 确实实现了“添加”方法，您可以像这样初始化它：

```
var a = new ArrayOfString { "string one", "string two" }; 
```

但是，如果你真的想基于另一个集合来初始化它，你可以为此编写一个扩展方法：

```
public static class U
{
    public static T To<T>(this IEnumerable<string> strings)
        where T : IList<string>, new()
    {
        var newList = new T();
        foreach (var s in strings)
            newList.Add(s);
        return newList;
    }
} 
```

用法：

```
client.UpdateMailingList(new UpdateMailingListMsgIn()
{
    Email = model.Email,
    Name = model.Name,
    Source = Request.Url.ToString(),
    Subscribe = subscribeTo.ToList(),
    Unsubscribe = unsubscribeFrom.To<ArrayOfString>()
}); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-06T07:54:27.540

首先，我不希望跨服务边界返回泛型类型。而是将*Unsubscribe*返回为 a `string[]`，并将*SubscriptionInfo*作为`SubscriptionInfo[]`. 如有必要，可以在客户端轻松将数组转换为通用列表，如下所示：

```
Unsubscribe = new List<string>(unsubscribeFrom);
Subscribe = new List<SubscriptionInfo>(subscribeTo); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-19T22:07:01.260

为时已晚，但可以帮助未来的人......

使用 svcutil 并明确通知命令行实用程序您希望代理类由**XmlSerializer**而不是 DataContractSerializer（默认）序列化。这是示例：

**svcutil /out:c:\Path\Proxy.cs /config:c:\Path\Proxy.config /async /serializer:XmlSerializer /namespace:*,YourNamespace [http://www.domain.com/service/serviceURL.asmx](http://www.domain.com/service/serviceURL.asmx)**

请注意，该 Web 服务是一个**ASP.NET Web 服务**，好吗？！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T03:50:44.793

如果您使用 VS 2008 来使用服务，那么有一个简单的解决方案。

单击添加服务引用时显示的代理对话框上的“高级...”按钮。在 Collection Type 下拉列表中，您可以选择 System.Generic.List。返回 List 的方法现在应该可以正常工作了。

（希望这是您所要求的，我有点累了，这个问题对我来说有点难以阅读。）

# asynchronous - 异步 SQLCommand 和 CCR

> ID：505970
> 
> 赞同：0
> 
> 时间：2009-02-03T03:59:52.950
> 
> 标签：asynchronous, sqlcommand, ccr

我一直在使用[Jeffrey Richter](http://msdn.microsoft.com/en-au/magazine/cc163556.aspx)的这篇 msdn 文章中的演示代码。

我在他的 ApmToCcrAdapters 中添加了一个新函数来处理 SqlCommand.BeginExecuteReader。只有在我阅读它之前它正在关闭阅读器。

以下代码用于提供 FromIteratorHandler：

```
 private static IEnumerator<ITask> AsyncReaderDemoHandler()
    {
       SqlDataReader reader = null;
       SqlConnection connection = new SqlConnection(@"Data Source=.\SQLEXPRESS;Initial Catalog=BizData;Integrated Security=True;Async=True;");
       string query = "SELECT * FROM Account;";
       SqlCommand command = new SqlCommand(query,connection);

       connection.Open();
       yield return Arbiter.Choice(ApmToCcrAdapters.GetReader(command),
          delegate(SqlDataReader r) { Msg("Got SQL data"); reader = r; },
          delegate(Exception e) { Msg("Failed to get SQL data"); });

       connection.Close();

       if (reader == null) yield break;

       //This is where the code fails: Reader is Closed!
       while (reader.Read())
       {
           Console.WriteLine(reader["Account"]);
       }
   } 
```

依次调用以下代码：

```
 /// <summary>
   /// Gets the Reader, requires connection to be managed
   /// </summary>
   public static PortSet<SqlDataReader, Exception> GetReader(SqlCommand sqlCommand)
   {
       Port<SqlDataReader> portResponse = null;
       Port<Exception> portException = null;
       GetReaderResponse(sqlCommand, ref portResponse, ref portException);
       return new PortSet<SqlDataReader, Exception>(portResponse, portException);
   }

   // Wrapper for SqlCommand's GetResponse
   public static void GetReaderResponse(SqlCommand sqlCom,
      ref Port<SqlDataReader> portResponse, ref Port<Exception> portException)
   {
       EnsurePortsExist(ref portResponse, ref portException);
       sqlCom.BeginExecuteReader(ApmResultToCcrResultFactory.Create(
          portResponse, portException,
          delegate(IAsyncResult ar) { return sqlCom.EndExecuteReader(ar); }), null);
   } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T04:22:21.470

连接必须保持打开，Reader 才能工作。我相信关闭连接是你的问题。保持连接打开并在完成后调用阅读器上的 dispose ，我认为这应该清理连接。

# sql - COALESCE - 保证短路？

> ID：505971
> 
> 赞同：11
> 
> 时间：2009-02-03T04:00:00.407
> 
> 标签：sql, sql-server, tsql, coalesce, short-circuiting

从[这个问题](https://stackoverflow.com/questions/505747/best-way-to-do-nested-case-statement-logic-in-sql-server)，[一个关于使用 COALESCE](https://stackoverflow.com/questions/505747/best-way-to-do-nested-case-statement-logic-in-sql-server/505760#505760)简化复杂逻辑树的简洁答案。我考虑了短路的问题。

例如，在大多数语言的函数中，参数都经过完全评估，然后传递给函数。在 C 中：

```
int f(float x, float y) {
    return x;
}

f(a, a / b) ; // This will result in an error if b == 0 
```

这似乎不是`COALESCE`SQL Server 中“函数”的限制：

```
CREATE TABLE Fractions (
    Numerator float
    ,Denominator float
)

INSERT INTO Fractions VALUES (1, 1)
INSERT INTO Fractions VALUES (1, 2)
INSERT INTO Fractions VALUES (1, 3)
INSERT INTO Fractions VALUES (1, 0)
INSERT INTO Fractions VALUES (2, 0)
INSERT INTO Fractions VALUES (3, 0)

SELECT Numerator
    ,Denominator
    ,COALESCE(
        CASE WHEN Denominator = 0 THEN 0 ELSE NULL END,
        CASE WHEN Numerator <> 0 THEN Numerator / Denominator ELSE NULL END,
        0
    ) AS TestCalc
FROM Fractions

DROP TABLE Fractions 
```

如果它在分母 = 0 时评估第二种情况，我预计会看到如下错误：

```
Msg 8134, Level 16, State 1, Line 1
Divide by zero error encountered. 
```

我发现了一些与[Oracle](http://it.toolbox.com/blogs/oracle-guide/minitip-5-coalesce-11378) [相关](http://forums.oracle.com/forums/thread.jspa?threadID=685976)的内容。以及一些使用[SQL Server](http://www.emoreau.com/Entries/Articles/2008/04/Short-circuiting-mainly-in-VBNet-and-SQL-Server.aspx)的测试。当您包含用户定义的函数时，看起来短路可能会发生故障。

那么，这种行为是否应该由 ANSI 标准来保证？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T04:40:22.433

我刚刚查看了链接的文章，可以确认 COALESCE 和 ISNULL 的短路都可能失败。

如果您涉及任何子查询，它似乎会失败，但它适用于标量函数和硬编码值。

例如，

```
DECLARE @test INT
SET @test = 1
PRINT 'test2'
SET @test = COALESCE(@test, (SELECT COUNT(*) FROM sysobjects))
SELECT 'test2', @test
-- OUCH, a scan through sysobjects 
```

COALESCE 是根据[ANSI 标准](http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt)实施的。它只是 CASE 语句的简写。ISNULL 不是 ANSI 标准的一部分。6.9 节似乎没有明确要求短路，但它确实暗示`when`应该返回语句中的第一个 true 子句。

这是一些适用于基于标量的函数的证明（我在[SQL Server 2005](http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005)上运行它）：

```
CREATE FUNCTION dbo.evil
(
)
RETURNS int
AS
BEGIN
    -- Create an huge delay
    declare @c int
    select @c = count(*) from sysobjects a
    join sysobjects b on 1=1
    join sysobjects c on 1=1
    join sysobjects d on 1=1
    join sysobjects e on 1=1
    join sysobjects f on 1=1
    return @c / 0
END
go

select dbo.evil()
-- takes forever

select ISNULL(1,  dbo.evil())
-- very fast

select COALESCE(1,  dbo.evil())
-- very fast 
```

这里有一些证明 CASE 的底层实现将执行子查询。

```
DECLARE @test INT
SET @test = 1
select
    case
        when @test is not null then @test
        when @test = 2 then (SELECT COUNT(*) FROM sysobjects)
        when 1=0 then (SELECT COUNT(*) FROM sysobjects)
        else (SELECT COUNT(*) FROM sysobjects)
    end
-- OUCH, two table scans. If 1=0, it does not result in a table scan. 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T05:08:23.967

在 MS SQL Server 中保证短路的*有效方法是使用 CASE。*对于成功的 WHEN 子句，不评估其他子句。

[COALESCE 可能有问题](http://sqlblogcasts.com/blogs/tonyrogerson/archive/2006/05/17/444.aspx)

在这种情况下，为什么 COALESCE/CASE 结构中有这么多分支？

```
SELECT Numerator
    ,Denominator
    ,CASE
        WHEN Denominator = 0 THEN 0 END,
        ELSE Numerator / Denominator
     END AS TestCalc
FROM Fractions 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T04:21:26.573

我也很惊讶地看到这个答案有效！我不确定这种行为是否得到保证。（但我一直找不到一个不起作用的例子！）

五年的[SQL](http://en.wikipedia.org/wiki/SQL)，我仍然感到惊讶。

我还继续进行了另一项更改：

```
INSERT INTO #Fractions VALUES (0, 0)

SELECT Numerator
    ,Denominator
    ,coalesce (
        CASE WHEN Denominator = 0 THEN 0 ELSE NULL END,
        CASE WHEN Numerator <> 0 THEN Numerator / Denominator ELSE NULL END)
     AS TestCalc
FROM #Fractions 
```

我得到的结果是：

```
Numerator   Denominator TestCalc
1             1           1
1             2           0.5
1             3           0.3333333333333335
1             0           0
2             0           0
3             0           0
0             0           0 
```

现在我更加困惑了！对于 num=0 和 den=0 的情况，我是如何将 testcalc 设为 0 的（特别是因为我在最后一个情况之后删除了 0！）？

# forms-authentication - Portlet 的自定义 .NET 身份验证、成员资格、配置文件提供程序？

> ID：505973
> 
> 赞同：3
> 
> 时间：2009-02-03T04:02:32.367
> 
> 标签：forms-authentication, membership-provider, portal

我想知道是否可以利用 .NET 中的身份验证、成员资格和/或配置文件提供程序功能来帮助将 .NET Web 应用程序集成到我公司的企业门户中。简而言之，门户将自定义标头值发送到门户“后面”的任何应用程序，以获取用户名、用户配置文件数据和一些访问权限等字段。我们在门户中遇到的一个问题是，我们无法利用 Web 上可用的许多 .NET 应用程序，因为它们的设计初衷不是“门户感知”，主要是为了相信用户已经过身份验证。

是否有可能以某种方式编写自定义身份验证提供程序（或者可能以某种方式利用表单身份验证）来查看标头（加上 IP）并自动“身份验证”为该用户？我的想法是，通过编写一个配置文件提供程序，可能是一个会员提供程序，并以某种方式添加身份验证，我将能够下载像 Oxite 博客（我找到的 .net mvc 演示）这样很酷的组件，将提供程序切换到我的自定义提供程序，并利用它在我公司的门户后面，代码更改最少。

这有道理吗？我觉得我可能不理解这些组件是如何融入这个谜题的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-06T19:20:46.403

我不认为你可以通过对 .Net 应用程序进行零更改来做到这一点，但我认为你可以通过最小的更改来做到这一点。请注意，我假设门户网关将所有内容都发送到 .Net Web 应用程序。也就是说，门户从浏览器获取每个 HTTP 请求，向其中添加自己的标头，将请求提交给 .Net 应用程序，从 .Net 应用程序获取回复，重新编写一些内容，然后将信息返回给浏览器.

我猜现在发生的事情（你写这个问题的原因）是你将这个 .Net 应用程序嵌入到你的门户网站上的一个 portlet 中，但是当有人试图浏览它时，即使他们已经登录到你的门户网站，他们也会看到Portlet 框内的外部 .Net 登录屏幕。不大好。

这里需要采取两个步骤：

1.  重做 .Net 应用程序的登录页面以自动登录 portlet 用户
2.  创建与 #1 一起使用的自定义成员资格提供程序

**1.重新做.Net应用程序的登录页面以自动登录portlet用户**

找到 .Net 应用程序的登录页面。它可能类似于 login.aspx。将其（以及任何关联的代码隐藏文件）复制到 portallogin.aspx 和 portallogin.cs。打开portallogin.aspx 和portallogin.cs 文件。摆脱那里的所有控件和代码。将其替换为您在下面看到的内容。请注意，在您看到 PORTAL_SomeFunctionName 的任何地方，您都需要将其替换为来自您的 Portal 的 SDK 的代码，该代码会进行适当的函数调用。

```
const string specialpassword = "ThisPasswordTellsTheBackendSystemThisUserIsOK";

Page_Load()
{
  if (PORTAL_IsLoggedInToPortal())
  {
    string username = PORTAL_GetCurrentUserName();
    // Authenticate the user behind the scenes
    System.Web.Security.FormsAuthentication.SetAuthCookie(username, false);
    System.Web.Security.FormsAuthentication.Authenticate(username, specialpassword);
  }
  else
  {
    throw new Exception ("User isn't coming from the Portal");
  }
} 
```

接下来，编辑 .Net 应用程序的 web.config 并告诉它登录页面是 portallogin.aspx 而不是 login.aspx。

这应该注意自动尝试登录用户。

**2\. 创建一个与#1 一起使用的自定义会员提供程序**

这是您需要创建自定义成员资格提供程序的地方。为了使其工作，您正在使用的 .Net 应用程序必须使用成员资格提供程序并允许使用自定义成员资格提供程序。

创建一个新的成员资格提供者。您需要创建一个类并从 System.Web.Security.MembershipProvider 继承。至少，我认为您需要实现 GetUser 和 ValidateUser 函数以及 ApplicationName 属性。下面是一些关于它们外观的想法。还有更多需要重写的函数，但存根（带有随附的 NotImplementedException(s)）可能会被单独保留。

```
 public override string ApplicationName
    {
        get
        {
            return "Portal";
        }
        set
        {
            ;
        }
    }

    private const string specialpassword = 
       "ThisPasswordTellsTheBackendSystemThisUserIsOK";

    public override bool ValidateUser(string username, string password)
    {
        // If the password being passed in is the right secret key (same  
        // for all users), then we will say that the password matches the
        // username, thus allowing the user to login 
        return (password == specialpassword);
    }

    public override MembershipUser GetUser(string username, bool userIsOnline)
    {
       string email = PORTAL_getemailfromusername(username);

       System.Web.Security.MembershipUser u = new MembershipUser(
         this.name, username, username, email, "", "", true, false, 
         DateTime.Now(), DateTime.Now(), DateTime.Now(), 
         DateTime.Now(), DateTime.Now(), DateTime.Now()
       );
       return u;
    } 
```

如果该功能有助于与此 .Net 应用程序集成，您还可以为 .Net RoleProvider 和 ProfileProvider 执行类似的实现。（角色提供者将提供组成员信息，而 ProfileProvider 将提供额外的个人资料信息，例如电子邮件地址、邮政编码或您希望它为每个用户提供的任何其他属性。必须从数据库或来自门户网站的 HTTP 标头信息。

**其他注意事项**

由于您为此外部 .Net 应用程序使用第三方身份验证提供程序，因此您需要弄清楚如何告诉此 .Net 应用程序哪些用户/组是管理员。我不能告诉你——你必须从第三方 .Net 应用程序中找出来。如果除了拥有帐户之外，在此 .Net 应用程序中执行任何操作需要任何权限，则需要这样做。

由于您在门户中使用它，因此可以通过多种方式使用它。您可以只拥有一个显示整个 .Net Web 应用程序的大 portlet。您还可以拥有许多显示 .Net Web 应用程序的点点滴滴的小 portlet。无论哪种方式，您都必须考虑，当门户网站将完整的 .Net 应用程序放在门户网站页面上的一个小 portlet 框内时，门户网站可能会或可能不会正确呈现事物。如果你得到的 HTML 看起来或工作起来很奇怪，修复它会很烦人。您可以尝试修复原始的 .Net Web 应用程序以吐出不同的 HTML，或者您可以向 IIS 添加一个模块以动态重写 HTML（我不完全确定它是一个模块......你会有在 IIS 上挖掘一些内容以了解您如何执行此操作）。

**哇！**

我知道这并不能涵盖所有内容，但我已经将 Plumtree 门户（现在是 BEA 的 Aqualogic 用户交互）设置为 Microsoft 的 SQL Server Reporting Services 的身份验证源，并且我已经为基于 IIS 的自定义身份验证提供程序实现了存储在 Dynamics NAV 表中的用户成员资格。希望我在这些项目方面的经验能够帮助您将此外部 .Net 应用程序与您的门户网站集成。

```
Tim 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T05:07:06.607

我认为这是个好主意。您肯定需要 Membership 提供程序，并确保您下载的所有 .Net Web 应用程序的身份验证设置为“表单”。

还可以查看 IIS7，因为它新构建的管道意味着您可以在任何处理程序（CGI 等）中利用基于 .Net 的身份验证类型。例如，您可以对 PHP 应用程序使用 Windows 身份验证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-30T06:47:29.330

缺少其他答案的一个小问题是asp.net中的表单身份验证支持交叉身份验证。

表单身份验证标记具有域和 cookie 名称属性。

匹配这些并使用相同的机器密钥，将允许应用程序之间的交叉身份验证。

但是，每个站点的成员资格提供程序都需要指向同一个数据存储。

# iphone - 如何将第三方框架添加到 iPhone 项目？

> ID：505974
> 
> 赞同：6
> 
> 时间：2009-02-03T04:05:09.617
> 
> 标签：iphone, cocoa, xcode, dyld

我正在尝试在我的 iPhone 应用程序中使用 PLDatabase 框架。我已将框架添加到我的 Xcode 项目中。但是，当我运行我的应用程序时，它会崩溃并出现以下错误：

```
dyld: Library not loaded: @loader_path/../Frameworks/PlausibleDatabase.framework/Versions/A/PlausibleDatabase
  Referenced from: /Users/todd/Library/Application Support/iPhone Simulator/User/Applications/BB3C66B2-A5BB-4329-B163-AB0072411AF1/Congress.app/Congress
  Reason: image not found 
```

我不确定框架需要在磁盘上的确切位置才能找到。

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-03T05:20:52.647

iPhone 不支持嵌入式框架的动态链接。虽然您可能能够使模拟器正常工作，但它无法在设备上工作。如果要使用代码，则必须为框架构建静态库 (libpldatabase.a)，然后将它们链接到应用程序。

Xcode GUI 没有为静态链接提供良好的界面，您需要在构建首选项中添加适当的标志（-lpldatabase -L/whatever/dir/it/is/in）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-21T09:45:20.670

iPhone 不支持动态链接实际上并不完全正确。真实情况是 App Store 安装的应用程序无法动态链接。

应用商店 / iTunes 将程序安装到 /private/var/mobile/... 目录中。任何打开的位于该子目录中的程序都会被 chroot，并且在打开时会剥夺某些权利。chroot 进程不能分叉，不能在后台运行，不能加载动态库，不能将文件保存到磁盘的小受保护区域之外（除了照片到照片目录）。

也就是说，iPhone 运行的是现代操作系统，它支持动态链接就好了。“越狱”的行为实际上是在 chroot 监狱之外安装一个程序，然后该程序可以执行诸如 fork 之类的操作，并将文件保存到磁盘上的其他位置并加载动态代码。

Apple（以及开放的 iPhone 社区）在手机上运行了大量程序（例如 MobilePhone、Mobile Safari 和 SpringBoard 应用程序），它们可以在后台运行并加载库。它们被放置在磁盘上的不同位置（通常是 /private/var/stash/Applications）。

所以...如果你想在应用商店中销售你的应用，你不能加载动态库。对于大多数人来说，这意味着您根本无法加载它。但是，如果您想通过 cydia（一种常见的越狱手机应用程序安装程序）分发您的应用程序，那么您可以越狱手机并加载您的动态库。事实上，由于 iTunes 安装过程是罪魁祸首，正如您所了解的，您甚至无法从您自己的应用程序中加载一个 dylib，然后将其写入您自己的手机……除非您越狱。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-04T00:31:48.127

RE @mipadi：ZeroLink 在 Xcode 3.1 中被删除，iPhone SDK 不存在。正确答案是路易斯的；iPhone 不支持开发人员创建的应用程序中的动态加载框架。

Xcode 确实为静态库提供了良好的用户界面；只需将它们拖到项目中，它们就会被添加到链接阶段。无需对链接器标志大惊小怪。当您需要使用与这些静态库一起提供的标头时（然后您需要手动添加标头搜索路径）或当静态库与可用的 dylib 冲突时（此时您必须手动添加 -l 标志），问题就出现了.

# asp.net - 邀请与会者参加公共日历活动以交换 Web 服务

> ID：505978
> 
> 赞同：1
> 
> 时间：2009-02-03T04:06:16.057
> 
> 标签：asp.net, exchangewebservices

显然，在 Outlook 中，可以在公共文件夹中创建约会并邀请其他人（包括您自己）——我想通过 Exchange Web 服务复制它。

我可以在自己的日历中创建一个活动并邀请其他人，效果很好。如果我在公共文件夹中创建一个事件并邀请人们，则在 createitem 对象中**SendMeetingInvitationsOrCancellations**必须设置为**SendToNone**，否则会引发此错误：

> 无法为位于公用文件夹中的日历项目发送会议邀请或取消。

这当然意味着不会发送任何邀请。在 Outlook 中的此日历项目上，如果我单击**邀请与会者**，则我通过 web 服务调用输入的名称。例如，我可以从 Outlook 手动发送邀请，但我当然希望这一切都是自动化的。

我应该这样做吗？出于某种原因，ews 不允许你做一些你可以在 Outlook 中做的事情，这似乎很疯狂......？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-17T11:07:40.320

我在应用程序中执行类似的任务以向用户日历添加假期，但我使用约会而不是日历，它是为当前经过身份验证的用户创建的，然后发送给一组特定的用户。

该应用程序是用 C# 编写的，但您应该能够翻译这个想法。

```
Appointment appointment = new Appointment(getExchangeService());
appointment.Subject = "Test meeting";
appointment.Start = DateTime.Now;
appointment.End = DateTime.Now.AddHours(2);

foreach (String emailAddress in attendees)
{
    appointment.RequiredAttendees.Add(emailAddress);
}
appointment.Save(SendInvitationsMode.SendToAllAndSaveCopy); 
```

# .net - ADO.NET 数据服务 - 格式参数 - xml/json

> ID：505981
> 
> 赞同：8
> 
> 时间：2009-02-03T04:07:00.363
> 
> 标签：.net, json, wcf-data-services

是否已在 ADO.NET 数据服务的 VS2008 SP1 版本中删除了 $format 参数。我尝试使用它并收到错误消息：

> 查询参数“$format”以系统保留的“$”字符开头，但无法识别。

我认为对 Atom 的支持非常酷，但是你也能得到“plain old xml”吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T08:48:26.363

这现在是通过 http “Accept” 标头完成的；对 json 使用“应用程序/json”。您可以为 POX 尝试“text/xml”，但[这里](http://msdn.microsoft.com/en-us/library/cc956153.aspx)的文章中没有提到它。

（更新：text/xml 将返回 atom，基于[此处](http://msdn.microsoft.com/en-us/library/cc907912.aspx)的表）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-15T02:22:15.210

Pablo Castro 有一个干净的解决方案：[http ://code.msdn.microsoft.com/DataServicesJSONP](http://code.msdn.microsoft.com/DataServicesJSONP)

它使用 WCF 行为来获取 $format=json

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-30T02:42:19.283

这篇博文展示了如何使用 ASP.NET 堆栈使 $format=json 工作：http: [//josheinstein.com/blog/index.php/2010/05/wcf-data-services-format-json/](http://josheinstein.com/blog/index.php/2010/05/wcf-data-services-format-json/)

# php - 谷歌风格正则表达式搜索

> ID：505982
> 
> 赞同：1
> 
> 时间：2009-02-03T04:07:35.713
> 
> 标签：php

自从我使用正则表达式已经有好几年了，我希望能在我正在做的事情上得到一些帮助。您知道 google 的搜索功能非常强大，并且会将引号内的内容作为文字短语，而前面带有减号的内容则不包括在内。

示例：“this is literal” -donotfindme site:examplesite.com 此示例将在 webiste examplesite.com 上不包含单词 donotfindme 的站点中搜索短语“this is literal”。

显然，我不是在寻找像谷歌那样复杂的东西，我只是想参考我的项目前进的方向。

无论如何，我首先想从基础知识开始，即引号内的文字短语。在这个网站上另一个问题的帮助下，我能够做到以下几点：

（这是php）

```
$search = 'hello "this" is regular expressions';
$pattern = '/".*"/';

$regex = preg_match($pattern, $search, $matches);

print_r($matches); 
```

但这会输出 "this" 而不是所需的`this`，并且对于引号中的多个短语根本不起作用。有人能引导我走向正确的方向吗？

我不一定需要代码，即使是一个真正有教程的好地方也可能会完成这项工作。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T04:31:20.110

好吧，至少对于这个例子，如果你只想匹配引号内的文本，你需要使用捕获组。像这样写：

```
$pattern = '/"(.*)"/'; 
```

然后`$matches`将是一个长度为 2 的数组，其中包含元素 1 中引号之间的文本。（它仍将包含元素 0 中匹配的全文） 通常，您可以拥有多个这些括号；它们从 1 开始从左开始编号，并且`$matches`每个组匹配的文本都会有一个对应的元素。例子：

```
$pattern = '/"([a-z]+) ([a-z]+) (.*)"/'; 
```

将选择所有带引号的字符串，其中两个小写单词由一个空格分隔，后跟任何内容。然后`$matches[1]`是第一个词，`$matches[2]`第二个词和`$matches[3]`“任何东西”。

要查找多个短语，您需要使用 一次选择一个`preg_match()`。您可以传递一个可选的“偏移量”参数，它指示它应该在字符串中的哪个位置开始搜索，并且要找到多个匹配项，您应该在前一个匹配项之后给出位置作为偏移量。有关详细信息，请参阅[文档](http://us3.php.net/manual/en/function.preg-match.php)。

你也可以尝试在谷歌搜索“正则表达式教程”或类似的东西，那里有很多好的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T04:31:22.670

抱歉，但我的 php 有点生疏，但这段代码可能会满足您的要求：

```
$search = 'hello "this" is regular expressions';
$pattern = '/"(.*)"/';

$regex = preg_match($pattern, $search, $matches);

print_r($matches[1]); 
```

$matches [1](http://oreilly.com/catalog/9780596528126/index.html)将包含第一个捕获的子表达式；$matches 或 $matches[0] 包含完全匹配的模式。

有关子表达式的详细信息，请参阅PHP 文档中的[preg_match](http://us2.php.net/preg_match)。

我不太确定“引号中的多个短语”是什么意思，但是如果您要尝试匹配平衡的引号，则涉及更多且难以理解。我会拿起一本参考手册。我强烈推荐[Jeffrey EF Friedl 的 Mastering Regular Expressions](http://oreilly.com/catalog/9780596528126/index.html)。到目前为止，它是理解和使用正则表达式的最佳帮助。这也是一个很好的参考。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-11-02T15:32:51.180

这是**所有类型的搜索词**（文字，减号，引号，..）的完整答案**WITH 替换**。（至少对于谷歌访问者）。

但也许它不应该只用正则表达式来完成。

1.  不仅您自己或其他开发人员很难在一个巨大且超级复杂的正则表达式上工作和添加功能，否则
2.  甚至可能使用这种方法更快。

它可能仍需要大量改进，但至少这是一个类中的完整解决方案。这里的内容比问题中所问的要多，但它说明了一些选择背后的一些原因。

```
class mySearchToSql extends mysqli {

    protected function filter($what) {
        if (isset(what) {
                    //echo '<pre>Search string: '.var_export($what,1).'</pre>';//debug

            //Split into different desires
            preg_match_all('/([^"\-\s]+)|(?:"([^"]+)")|-(\S+)/i',$what,$split);
                    //echo '<pre>'.var_export($split,1).'</pre>';//debug                

            //Surround with SQL
            array_walk($split[1],'self::sur',array('`Field` LIKE "%','%"'));
            array_walk($split[2],'self::sur',array('`Desc` REGEXP "[[:<:]]','[[:>:]]"'));
            array_walk($split[3],'self::sur',array('`Desc` NOT LIKE "%','%"'));
                    //echo '<pre>'.var_export($split,1).'</pre>';//debug

            //Add AND or OR
            $this   ->where($split[3])                      
                    ->where(array_merge($split[1],$split[2]), true);
        }
    }

    protected function sur(&$v,$k,$sur) {
        if (!empty($v))
            $v=$sur[0].$this->real_escape_string($v).$sur[1];
    }

    function where($s,$OR=false) {
        if (empty($s)) return $this;
        if (is_array($s)) {
            $s=(array_filter($s));
            if (empty($s)) return $this;
            if($OR==true)  
                $this->W[]='('.implode(' OR ',$s).')';
            else 
                $this->W[]='('.implode(' AND ',$s).')';
        } else 
            $this->W[]=$s;
        return $this;
    }

    function showSQL() {
        echo $this->W?  'WHERE '.       implode(L.' AND ',$this->W).L:'';
} 
```

感谢所有 stackoverflow 的答案来到这里！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T04:32:51.497

你很幸运，因为我最近问了一个关于字符串文字的类似问题。你可以在这里找到它：[Regex for manages escaped characters for items like string literals](https://stackoverflow.com/questions/430759/regex-for-managing-escaped-characters-for-items-like-string-literals)

我最终使用以下内容来搜索它们，并且效果很好：

```
(?<!\\)(?:\\\\)*(\"|')((?:\\.|(?!\1)[^\\])*)\1 
```

此正则表达式与其他正则表达式不同，因为它正确处理字符串中的转义引号。

# ruby-on-rails - Ruby 1.9 的主要语法变化是什么？

> ID：505983
> 
> 赞同：7
> 
> 时间：2009-02-03T04:07:55.337
> 
> 标签：ruby-on-rails, ruby, syntax, legacy-code, backwards-compatibility

另外，我想知道升级到 Ruby 1.9 会对 1.86 版的遗留代码产生什么影响。新版本是否向后兼容？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T04:11:56.467

我想这取决于您要保持兼容性的版本。CHANGELOG描述了自上次更新[以来](http://svn.ruby-lang.org/repos/ruby/tags/v1_9_1_0/NEWS)的主要修订，包括语法更改、增强和错误修复

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T04:16:43.947

有些东西是向后兼容的，但很多不是。

有关 1.9.x 中所有更改（包括示例）的近乎完整的概述，请查看~~[特征类的博客](http://eigenclass.org/hiki.rb?Changes+in+Ruby+1.9 "特征类的博客")~~ [Eigenclass 博客的最后一个 archive.org 快照](https://web.archive.org/web/20090423003136/http://eigenclass.org/hiki.rb?Changes+in+Ruby+1.9)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-03T17:11:21.963

Sam Ruby 有一个很好的幻灯片展示了主要的变化：[Ruby 1.9: What to Expect](http://slideshow.rubyforge.org/ruby19.html)

只是为了强调一些可能会破坏您的代码的事情：

*   单个字符串
*   {"a", "b"} 不再产生哈希
*   块变量现在隐藏局部变量

# windows - 各种本地化版本的 DIR 命令输出

> ID：505985
> 
> 赞同：0
> 
> 时间：2009-02-03T04:11:34.423
> 
> 标签：windows, cmd, internationalization

我有一个奇怪的（不要问）需要查看`DIR`许多（一些）不同本地化版本的 Windows（例如法语、西班牙语等）的 Win XP cmd shell 命令的一些示例。

我需要的具体命令是（注意这个命令很重要......如果你不费心使用这个命令，那就不用费心响应）：

```
dir /4 /-c /t:a /n /a:-d-h-s 
```

我知道这是一个疯狂的希望，但我希望能够在不考虑本地化的情况下截断/解析输出。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T04:53:11.737

可能不是您想听到的，但我们在依赖不同 Windows 本地化的行为时发现了各种问题。

我们有一个在美国英语中运行良好的 cmd 文件，但是当我们发送它进行本地化时，他们发现了各种各样的问题，我们必须支持大约 23 个不同的版本。

最后，编写（实际的 C）代码以通过 Win32 获取信息并以我们想要的格式输出它更容易。这消除了对特定本地化格式**和**配置问题的依赖（一些命令的输出不同，不仅基于语言环境，还基于用户配置）。

我的建议：找到一种不同的方式来做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-19T18:34:07.397

波兰 windows Vista 输出：

```
C:\Users\Karol>dir /4 /-c /t:a /n /a:-d-h-s
 Wolumin w stacji C to OS
 Numer seryjny woluminu: 3EC1-6B83

 Katalog: C:\Users\Karol

2009-12-10  21:19              2263 intlname.ols
2009-07-23  21:17              1480 laptop_to_epia.ppk
2009-07-23  21:17               466 laptop_to_epia.pub
2010-01-31  09:49             10392 _viminfo
               4 plik(ów)              14601 bajtów
               0 katalog(ów)     10880864256 bajtów wolnych 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T04:47:54.913

这是韩语 XP 的输出：

```
 C µå¶óÀÌºêÀÇ º¼·ý¿¡´Â ÀÌ¸§ÀÌ ¾ø½À´Ï´Ù.
 º¼·ý ÀÏ·Ã ¹øÈ£: 7C33-7DCE

 C:\WINDOWS\system32 µð·ºÅÍ¸®

2009-02-02  ¿ÀÈÄ 11:39              1697 $winnt$.inf
2008-02-19  ¿ÀÈÄ 09:07              2151 12520437.cpx
2008-02-19  ¿ÀÈÄ 09:07              2233 12520850.cpx
2008-02-19  ¿ÀÈÄ 09:06            100352 6to4svc.dll
2008-02-19  ¿ÀÈÄ 08:47              1460 a15.tbl 
```

（似乎在传输过程中丢失了 unicode……但出于我的目的，这没关系）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T05:04:27.017

当然......这是错误的方式......但需要必须/恶魔驱动。根本问题是无法修改/依赖运行命令的机器。解析/截断非常小（提取文件名、文件大小和创建日期）。好消息是文件名保证不包含任何空格。这意味着 split() 的最后两个字段是文件名和大小，前 N 个字段是日期（注意我不需要日期作为日期，只需一个字符串即可）。技巧可能涉及确保 unicode 正确移动（与韩国示例不同）。

# sql - 如何在 SQL 中使用一系列字符串进行选择？

> ID：505989
> 
> 赞同：2
> 
> 时间：2009-02-03T04:15:39.753
> 
> 标签：sql, sql-server, sql-server-2005

我有一个带有注册号的车辆表，并且想要选择其中一些用户提供的“从”和“到”值之间的子集。

因此，假设表格如下所示：

```
id       reg_num
1        DD1111
2        DD1112
3        DE2245
4        EE5678
5        EF6547 
```

到目前为止，我的 SQL 如下所示：

```
select *
from vehicles
where reg_num >= 'DD'   -- this value is user supplied
and reg_num <= 'DE'     -- and so is this one 
```

应该（根据我的想法）返回：

```
1        DD1111
2        DD1112
3        DE2245 
```

但相反，只返回：

```
1        DD1111
2        DD1112 
```

我想 SQL 服务器将“DE2245”视为大于“DE”，因此排除了该行。

我的问题：如何让 SQL Server 包含以“DE”开头的所有行？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T04:18:07.143

您必须在末尾添加尽可能多的 'zzzz' 以匹配您的列宽定义。

```
 select * from vehicles 
 where reg_num  >= 'DD' and reg_num <= 'DE' + 'ZZZZZZZZZZZZ' 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T04:26:53.503

```
where reg_num >= @userValueFrom 
and left(reg_num,char_length(@userValueTo) <= @userValueTo 
```

但请注意，由于 SARG 中的列上有一个函数，因此这里没有使用任何索引。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T04:40:15.880

如果格式得到保证，您可以简单地执行以下操作：

```
SELECT *
FROM vehicles 
WHERE LEFT(reg_num, 2) BETWEEN 'DD' AND 'DE' 
```

但同样，这应该不是 SARGable - 这总是让我感到困惑，因为肯定可以使用 reg_num 上的索引......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-03-24T11:32:07.160

DE2245不低于DE。为了更清楚，DE2245小于DE **3**

# sql - 同一个存储过程的不同执行计划

> ID：505995
> 
> 赞同：4
> 
> 时间：2009-02-03T04:18:35.377
> 
> 标签：sql, sql-server, sql-server-2005, stored-procedures, sql-execution-plan

我们有一个查询在我们的生产系统上大约需要 5 秒，但在我们的镜像系统（尽可能与生产系统相同）和开发系统上需要不到 1 秒。

我们检查了查询计划，我们可以看到它们不同。同样从这些计划中，我们可以看到为什么一个比另一个花费更长的时间。数据、架构和服务器相似，存储过程相同。

我们知道如何通过重新安排连接和添加提示来修复它，但是目前如果我们不必对 SProc（文书工作）进行任何更改，这会更容易。我们也尝试过 sp_recompile。

什么可能导致两个查询计划之间的差异？

系统：Win2k3 Enterprise 上的 SQL 2005 SP2 Enterprise

更新：感谢您的回复，原来是统计数据。请参阅下面的摘要。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-03T04:32:31.637

您的统计数据很可能已过时。如果您的数据相同，请重新计算两台服务器上的统计信息并重新编译。然后，您应该会看到相同的查询计划。

此外，请仔细检查您的索引是否相同。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T04:36:37.290

您的镜像和生产之间的数据和数据大小是否尽可能接近相同？如果您知道为什么一个查询比另一个查询花费更长的时间？你能发布更多细节吗？

由于表中的数据和/或统计信息，在这种情况下执行计划可能会有所不同。即使在启用自动更新统计信息的情况下，统计信息也可能会过时（尤其是在非常大的表中）。您可能会发现优化器估计表不是那么大，并选择了表扫描或类似的方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T04:48:51.760

最有可能的统计数据。

一些想法：您是否对非产品系统进行维护？（例如 rebuidl 索引，它将重建统计信息）

如果是这样，您是否使用相同的填充因子和统计采样率？

您是否定期将数据库恢复到测试中，使其 100% 像生产环境一样？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T04:49:07.140

如果您的 proc 上没有 WITH RECOMPILE 选项，则执行计划将在第一次执行后被缓存。

这是一个关于如何缓存错误查询计划的简单示例：

```
create proc spTest
    @id int 
as 
select * from sysobjects where @id is null or id = id 

go 

exec spTest null
-- As expected its a clustered index scan

go

exec spTest 1
-- OH no its a clustered index scan 
```

尝试在存储过程之外的生产服务器上的 QA 中运行 Sql，以确定您的统计信息是否过时或生产中缺少神秘索引。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T04:49:29.357

与第一个答案有关，问题可能出在 SQL Server 的参数嗅探功能上。它使用导致编译的第一个值来帮助创建执行计划。通常这是好的，但如果值不正常（或奇怪），它可能会导致一个糟糕的计划。这也可以解释生产和测试之间的区别。

关闭参数嗅探需要修改我理解的 SProc 是不可取的。但是，在使用 sp_recompile 之后，传入您认为“正常”的参数，它应该根据这些新参数重新编译。

我认为参数嗅探行为在 2005 年和 2008 年之间是不同的，所以这可能行不通。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T05:25:58.033

解决方案是重新计算统计数据。我忽略了我们通常安排的任务来完成所有这些，但由于某种原因，管理员没有在这个服务器上放置一个，Doh。

总结所有帖子：

*   检查设置是否相同
    *   索引
    *   桌子尺寸
    *   恢复数据库
*   执行计划缓存
    *   如果查询在 SProc 之外运行相同，则不是执行计划
    *   sp_recompile 如果不同
    *   参数嗅探
*   重新计算统计

# sql - 解决 UDF 性能问题 - 手动缓存

> ID：505996
> 
> 赞同：1
> 
> 时间：2009-02-03T04:21:12.860
> 
> 标签：sql, sql-server, performance, user-defined-functions

我的系统做了一些相当繁重的处理，我一直在攻击性能，以便让我能够在更短的时间内运行更多的测试运行。

我有很多情况下，UDF 必须被调用，比如说 500 万行（我几乎认为没有办法绕过它）。

好吧，事实证明，有一种方法可以解决这个问题，并且当通过一组比总行集小一些的不同参数调用 UDF 时，它可以显着提高性能。

考虑一个 UDF，它接受一组输入并返回基于复杂逻辑的结果，但是对于超过 5m 行的输入集，只有 100,000 个不同的输入，所以它只会产生 100,000 个不同的结果元组（我的特别从利率到复杂的代码分配，情况各不相同，但它们都是离散的——这种技术的基本点是，您可以通过运行`SELECT DISTINCT`) 来简单地确定该技巧是否有效。

我发现通过这样做：

```
INSERT INTO PreCalcs
SELECT param1
       ,param2
       ,dbo.udf_result(param1, param2) AS result
FROM (
    SELECT DISTINCT param1, param2 FROM big_table
) 
```

当 PreCalcs 被适当索引时，将其与：

```
SELECT big_table.param1
    ,big_table.param2
    ,PreCalcs.result
FROM big_table
INNER JOIN PreCalcs
    ON PreCalcs.param1 = big_table.param1
    AND PreCalcs.param2 = big_table.param2 
```

你会在性能上获得巨大的提升。显然，仅仅因为某些东西是确定性的，并不意味着 SQL Server 正在缓存过去的调用并重新使用它们，正如人们可能认为的那样。

您唯一需要注意的是允许 NULL 的位置，然后您需要仔细修复连接：

```
SELECT big_table.param1
    ,big_table.param2
    ,PreCalcs.result
FROM big_table
INNER JOIN PreCalcs
    ON (
        PreCalcs.param1 = big_table.param1
        OR COALESCE(PreCalcs.param1, big_table.param1) IS NULL
    )
    AND (
        PreCalcs.param2 = big_table.param2
        OR COALESCE(PreCalcs.param2, big_table.param2) IS NULL
    ) 
```

希望这会有所帮助，并且欢迎使用 UDF 或重构查询以提高性能的任何类似技巧。

我想问题是，为什么这样的手动缓存是必要的——服务器不知道函数是确定性的吗？如果它产生了如此大的差异，并且如果 UDF 如此昂贵，那么优化器为什么不直接在执行计划中进行呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T15:44:08.177

是的，优化器不会为您手动记忆 UDF。在您可以以这种方式折叠输出集的情况下，您的技巧非常好。

如果您的 UDF 的参数是其他表的索引，并且 UDF 从这些表中选择值来计算标量结果，则另一种可以提高性能的技术是将标量 UDF 重写为表值 UDF，该 UDF 在您的所有表中选择结果值潜在参数。

当我们基于 UDF 查询的表进行大量插入和更新时，我使用了这种方法，所涉及的查询相对复杂，并且必须应用原始 UDF 的行数很大。在这种情况下，您可以在性能上取得一些很大的改进，因为表值 UDF 只需要运行一次，并且可以作为优化的面向集合的查询运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T14:40:43.873

SQL Server 如何知道您在 500 万行中有 100,000 个离散组合？

通过使用 PreCalcs 表，您只需运行 udf 超过 100k 行而不是 500 万行，然后再次展开。

现有的优化器无法预测这些有用的信息。标量 udf 是一个黑盒子。

对于更实用的解决方案，我将使用一个计算的、持久的列来执行 udf 调用。所以它在所有查询中都可用，可以被索引/包含。

这可能更适合 OLTP... 我查询一个表以通过多种不同方式实时获取交易现金和头寸，因此这种方法适合我避免每次都产生 udf 数学开销。*********