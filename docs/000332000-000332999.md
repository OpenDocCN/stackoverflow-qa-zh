# StackOverflow 问答 000332000-000332999

# dos - 如何获取具有 ProductName 和 ProductVersion 的 DLL 目录列表？

> ID：332005
> 
> 赞同：3
> 
> 时间：2008-12-01T19:58:16.140
> 
> 标签：dos

当我在 Windows 资源管理器中查看目录时，我可以看到该目录中 DLL 的 ProductName 和 ProductVersion 属性。

我需要将这个带有 ProductName 和 ProductVersion 的 DLL 列表导出到一个文本文件中。

如果我这样做`c:\>dir *.dll > test.log`，则 test.log 没有 ProductName 和 ProductVersion。

有人可以帮我将这些属性与文件名一起导出到文件中吗？

即使它是免费软件工具或其他一些`dir`开关，也会很有用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T20:57:44.523

[PowerShell](http://www.microsoft.com/technet/scriptcenter/hubs/msh.mspx)是你的朋友——它可以从微软免费获得（就像在啤酒中一样）。

下面是一条将windows目录下所有dll的产品名称、产品版本和文件名吐到test.log中的一行代码：

`dir c:\windows\*.dll | % {[System.Diagnostics.FileVersionInfo]::GetVersionInfo($_)} | % { $_.ProductName + ", " + $_.ProductVersion + ", " + $_.FileName} > test.log`

好的，所以这是一条**很长**的行 - 但它仍然**只是命令提示符下的一行**。

PowerShell 爱好者可能会进一步浓缩上述内容。请注意，PowerShell 允许我们从命令行 使用 .Net 基类库（甚至您自己的程序集），例如**System.Diagnostics.FileVersionInfo ！**

如果您还没有玩过 PowerShell，那么您可以在商店中获得一种享受 - 特别是如果您是 .Net 开发人员 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T20:02:15.010

使用 VBScript，您可以执行以下操作：

```
Set objShell = CreateObject ("Shell.Application")
Set objFolder = objShell.Namespace ("C:\Scripts")
Set objFSO = CreateObject("Scripting.FileSystemObject")
Dim arrHeaders(40)

For i = 0 to 40
    arrHeaders(i) = objFolder.GetDetailsOf (objFolder.Items, i)
Next

For Each strFileName in objFolder.Items
    For i = 0 to 40
        Wscript.echo arrHeaders(i) & ": " & objFolder.GetDetailsOf (strFileName, i) 
    Next
    Wscript.Echo
Next 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T20:10:22.810

使用 .NET 应用程序可以很容易地做到这一点。

```
using System;
using System.Diagnostics;

static class MainClass
{
    static void Main(string[] args)
    {

        FileVersionInfo info = FileVersionInfo.GetVersionInfo("c:\\test.txt");

        // Display version information.
        Console.WriteLine("Checking File: " + info.FileName);
        Console.WriteLine("Product Name: " + info.ProductName);
        Console.WriteLine("Product Version: " + info.ProductVersion);
        Console.WriteLine("Company Name: " + info.CompanyName);

    }
} 
```

显然，您必须添加一个函数来检索指定目录中的所有文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T20:24:52.873

将 VB.Net 版本添加到列表中：

```
Sub CreateLog(ByVal Logfile As String, ByVal PathToLog As String, Optional ByVal SearchPattern As String = "*.*")

    Dim FileInfo As FileVersionInfo
    Dim ret As String = ""
    For Each File As String In IO.Directory.GetFiles(PathToLog, SearchPattern)
        FileInfo = FileVersionInfo.GetVersionInfo(File)
        If FileInfo.ProductName & FileInfo.ProductVersion <> "" Then
            ret &= FileInfo.ProductName & ", " & FileInfo.ProductVersion & vbCrLf
        End If
    Next

    IO.File.WriteAllText(Logfile, ret)

End Sub 
```

调用它： CreateLog("c:\log.txt", "c:\windows", "*.dll")

编辑：添加了搜索模式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-01T20:06:59.010

我根本无法与该软件交谈，但这似乎可以满足您的需求：

[http://www.softpedia.com/get/Programming/Other-Programming-Files/STRFINFO.shtml](http://www.softpedia.com/get/Programming/Other-Programming-Files/STRFINFO.shtml)

```
SYNTAX
~~~~~~
StrFInfo[.EXE] ExeDllOcxFileName  [Property1  [Property2 ...]]

COMMON PROPERTIES
~~~~~~~~~~~~~~~~~
FileDescription  FileVersion InternalName
OriginalFileName ProductName ProductVersion
CompanyName LegalCopyRight $Translation 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-01T21:43:59.140

有趣的是，我不知道这个 GetDetailsOf 函数。
我想知道任意大小......
我不确定限制是什么，这似乎在文件夹之间或至少在用户设置或其他东西之间有所不同，所以我做了一些更灵活的事情：

```
Set shell = CreateObject("Shell.Application")
Set folder = shell.Namespace("D:\Documents")

Set fso = CreateObject("Scripting.FileSystemObject")
For Each fileName in folder.Items
  i = 0
  emptyNb = 0
  Do
    detail = folder.GetDetailsOf(folder.Items, i)
    If detail = "" Then
      emptyNb = emptyNb + 1
    Else
      detailValue = folder.GetDetailsOf(fileName, i)
      If detailValue <> "" Then
        Wscript.Echo i & " " & detail & ": " & detailValue
      End If
      emptyNb = 0
    End If
    i = i + 1
  Loop While emptyNb < 3 ' Arbirary, adjust as you see fit
  detailValue = folder.GetDetailsOf(fileName, -1)
  If detailValue <> "" Then
    Wscript.Echo "Tooltip:" & vbCrLf & detailValue
  End If
  Wscript.Echo
Next 
```

要回答这个问题，您可以检查何时`detail`等于您要查找的信息并仅显示这些值。

# c++ - 什么时候应该使用 static_cast、dynamic_cast、const_cast 和 reinterpret_cast？

> ID：332030
> 
> 赞同：2846
> 
> 时间：2008-12-01T20:11:07.237
> 
> 标签：c++, pointers, casting, c++-faq

什么是正确的用途：

*   `static_cast`
*   `dynamic_cast`
*   `const_cast`
*   `reinterpret_cast`
*   C型演员表`(type)value`
*   函数式强制转换`type(value)`

如何决定在哪些特定情况下使用哪个？

* * *

## 回答 #1

> 赞同：2845
> 
> 时间：2008-12-01T20:26:41.810

**`static_cast`**是您应该尝试使用的第一个演员表。它执行诸如类型之间的隐式转换（例如`int`to`float`或指向 的指针`void*`）之类的事情，它还可以调用显式转换函数（或隐式转换函数）。在许多情况下，`static_cast`不需要显式声明，但重要的是要注意`T(something)`语法等效于`(T)something`并且应该避免（稍后会详细介绍）。然而， A`T(something, something_else)`是安全的，并保证调用构造函数。

`static_cast`也可以通过继承层次结构进行转换。向上转换（朝向基类）时没有必要，但向下转换时，只要不通过`virtual`继承进行转换，就可以使用它。但是，它不进行检查，并且将`static_cast`层次结构向下到实际上不是对象类型的类型是未定义的行为。

* * *

**`const_cast`**可用于删除或添加`const`到变量；没有其他 C++ 演员能够删除它（甚至没有`reinterpret_cast`）。需要注意的是，只有当原始变量是;时，修改以前的`const`值才是未定义的。`const`如果您使用它来取消对`const`未声明的内容的引用`const`，则它是安全的。例如，这在基于 重载成员函数时很有用`const`。它也可以用来添加`const`到一个对象中，比如调用一个成员函数的重载。

`const_cast`也同样适用于`volatile`，尽管这种情况不太常见。

* * *

**`dynamic_cast`**专门用于处理多态性。您可以将指向任何多态类型的指针或引用转换为任何其他类类型（多态类型至少有一个声明或继承的虚函数）。您不仅可以将其用于向下投射 - 您还可以向侧面投射，甚至可以向上投射另一条链。将`dynamic_cast`寻找所需的对象并在可能的情况下返回它。如果不能，它会`nullptr`在指针的情况下返回，或者在引用的情况下抛出`std::bad_cast`。

`dynamic_cast`但是有一些限制。`virtual`如果继承层次结构中有多个相同类型的对象（所谓的“可怕的菱形”）并且您没有使用继承，则它不起作用。它也只能通过公共继承——它总是无法通过`protected`或`private`继承。然而，这很少成为问题，因为这种继承形式很少见。

* * *

**`reinterpret_cast`**是最危险的演员表，应该非常谨慎地使用。它将一种类型直接转换为另一种类型——例如将值从一个指针转换为另一种，或将指针存储在 中`int`，或各种其他令人讨厌的事情。很大程度上，您获得的唯一保证`reinterpret_cast`是，通常如果您将结果转换回原始类型，您将获得完全相同的值（但如果中间类型小于原始类型，则不会）***。***也有许多**`reinterpret_cast`**不能做的转换。它主要用于特别奇怪的转换和位操作，例如将原始数据流转换为实际数据，或将数据存储在指向对齐数据的指针的低位中。

* * *

**C 风格**转换和**函数风格**转换分别使用`(type)object`or进行转换`type(object)`，并且在功能上是等价的。它们被定义为以下成功的第一个：

*   `const_cast`
*   `static_cast`（虽然忽略了访问限制）
*   `static_cast`（见上文），然后`const_cast`
*   `reinterpret_cast`
*   `reinterpret_cast`， 然后`const_cast`

因此，在某些情况下，它可以用作其他类型转换的替代品，但由于能够转化为 a `reinterpret_cast`，因此可能非常危险，并且在需要显式转换时应该首选后者，除非您确定`static_cast`会成功或`reinterpret_cast`会失败. 即便如此，考虑更长、更明确的选项。

C 风格的强制转换在执行 a 时也会忽略访问控制`static_cast`，这意味着它们能够执行其他强制转换无法执行的操作。不过，这主要是一个杂物，在我看来，这只是避免 C 风格转换的另一个原因。

* * *

## 回答 #2

> 赞同：387
> 
> 时间：2008-12-01T20:22:27.887

*   用于`dynamic_cast`在继承层次结构中转换指针/引用。

*   用于`static_cast`普通类型转换。

*   用于`reinterpret_cast`位模式的低级重新解释。使用时要格外小心。

*   用于`const_cast`抛掷`const/volatile`。避免这种情况，除非您使用 const 不正确的 API 被卡住。

* * *

## 回答 #3

> 赞同：226
> 
> 时间：2014-01-21T04:53:43.693

*（上面已经给出了很多理论和概念上的解释）*

以下是我使用**static_cast**、**dynamic_cast**、**const_cast**、**reinterpret_cast时的一些****实际示例**。

 ******（也参考这个来理解解释：[http](http://www.cplusplus.com/doc/tutorial/typecasting/) ://www.cplusplus.com/doc/tutorial/typecasting/ ）

**静态转换：**

```
OnEventData(void* pData)

{
  ......

  //  pData is a void* pData, 

  //  EventData is a structure e.g. 
  //  typedef struct _EventData {
  //  std::string id;
  //  std:: string remote_id;
  //  } EventData;

  // On Some Situation a void pointer *pData
  // has been static_casted as 
  // EventData* pointer 

  EventData *evtdata = static_cast<EventData*>(pData);
  .....
} 
```

**动态转换：**

```
void DebugLog::OnMessage(Message *msg)
{
    static DebugMsgData *debug;
    static XYZMsgData *xyz;

    if(debug = dynamic_cast<DebugMsgData*>(msg->pdata)){
        // debug message
    }
    else if(xyz = dynamic_cast<XYZMsgData*>(msg->pdata)){
        // xyz message
    }
    else/* if( ... )*/{
        // ...
    }
} 
```

**const_cast ：**

```
// *Passwd declared as a const

const unsigned char *Passwd

// on some situation it require to remove its constness

const_cast<unsigned char*>(Passwd) 
```

**reinterpret_cast ：**

```
typedef unsigned short uint16;

// Read Bytes returns that 2 bytes got read. 

bool ByteBuffer::ReadUInt16(uint16& val) {
  return ReadBytes(reinterpret_cast<char*>(&val), 2);
} 
```

* * *

## 回答 #4

> 赞同：126
> 
> 时间：2016-12-11T02:05:00.023

如果您了解一点内部知识可能会有所帮助...

**static_cast**

*   `float`C++ 编译器已经知道如何在缩放器类型之间进行转换，例如`int`. 为他们使用`static_cast`。
*   当您要求编译器从 type 转换`A`为 时`B`，`static_cast`调用作为参数`B`传递的构造函数。`A`或者，`A`可以有一个转换运算符（即`A::operator B()`）。如果`B`没有这样的构造函数，或者`A`没有转换运算符，则会出现编译时错误。
*   如果 A 和 B 在继承层次结构（或 void）中，从`A*`转换到总是成功，否则会出现编译错误。`B*`
*   **问题**：如果将基指针转换为派生指针，但如果实际对象不是真正的派生类型，则*不会*出现错误。您会得到错误的指针，并且很可能在运行时出现段错误。同样适用于`A&`to `B&`。
*   **问题：从Derived**转换为 Base 或反之亦然创建*新*副本！对于来自 C#/Java 的人来说，这可能是一个巨大的惊喜，因为结果基本上是从 Derived 创建的一个切掉的对象。

**dynamic_cast**

*   dynamic_cast 使用运行时类型信息来确定强制转换是否有效。例如，如果指针实际上不是派生类型，则`(Base*)`to可能会失败。`(Derived*)`
*   这意味着，与 static_cast 相比，dynamic_cast 非常昂贵！
*   对于`A*`to `B*`，如果 cast 无效，则 dynamic_cast 将返回 nullptr。
*   如果强制`A&`转换`B&`无效，则 dynamic_cast 将抛出 bad_cast 异常。
*   与其他强制转换不同，存在运行时开销。

**const_cast**

*   虽然 static_cast 可以对 const 做非常量，但它不能反过来。const_cast 可以做这两种方式。
*   这很方便的一个例子是迭代一些容器，比如`set<T>`它只返回它的元素作为 const 以确保你不改变它的键。但是，如果您的意图是修改对象的非关键成员，那么应该没问题。您可以使用 const_cast 删除 constness。
*   另一个例子是当你想实现`T& SomeClass::foo()`以及`const T& SomeClass::foo() const`. 为避免代码重复，您可以应用 const_cast 从另一个函数返回一个函数的值。

**reinterpret_cast**

*   这基本上说在这个内存位置获取这些字节并将其视为给定对象。
*   例如，您可以加载 4 字节`float`到 4 字节`int`来查看位的`float`样子。
*   显然，如果数据类型不正确，您可能会遇到段错误。
*   此演员表没有运行时开销。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-12-01T20:20:01.243

[这](http://www.cppreference.com/wiki/keywords/casting_comparison)能回答你的问题吗？

我从来没有使用过`reinterpret_cast`，并且想知道遇到需要它的情况是否不是糟糕设计的味道。在我工作的代码库`dynamic_cast`中使用了很多。不同之 `static_cast`处在于`dynamic_cast`运行时检查可能（更安全）或可能不是（更多开销）是您想要的（参见[msdn](http://msdn.microsoft.com/en-us/library/c36yw7x9(VS.80).aspx)）。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2015-05-31T14:16:11.150

除了到目前为止的其他答案之外，这里还有一个不明显的例子，其中`static_cast`还不够，所以`reinterpret_cast`需要这样做。假设有一个函数在输出参数中返回指向不同类（不共享公共基类）对象的指针。这种函数的一个真实例子是[`CoCreateInstance()`](https://msdn.microsoft.com/en-us/library/windows/desktop/ms686615%28v=vs.85%29.aspx)（参见最后一个参数，实际上是`void**`）。假设您从该函数请求特定类的对象，因此您事先知道指针的类型（您经常为 COM 对象执行此操作）。在这种情况下，您不能将指向您的指针的指针转换为`void**`with `static_cast`：您需要`reinterpret_cast<void**>(&yourPointer)`.

在代码中：

```
#include <windows.h>
#include <netfw.h>
.....
INetFwPolicy2* pNetFwPolicy2 = nullptr;
HRESULT hr = CoCreateInstance(__uuidof(NetFwPolicy2), nullptr,
    CLSCTX_INPROC_SERVER, __uuidof(INetFwPolicy2),
    //static_cast<void**>(&pNetFwPolicy2) would give a compile error
    reinterpret_cast<void**>(&pNetFwPolicy2) ); 
```

但是，`static_cast`适用于简单指针（不是指向指针的指针），因此可以重写上述代码以避免`reinterpret_cast`（以额外变量为代价）以下列方式：

```
#include <windows.h>
#include <netfw.h>
.....
INetFwPolicy2* pNetFwPolicy2 = nullptr;
void* tmp = nullptr;
HRESULT hr = CoCreateInstance(__uuidof(NetFwPolicy2), nullptr,
    CLSCTX_INPROC_SERVER, __uuidof(INetFwPolicy2),
    &tmp );
pNetFwPolicy2 = static_cast<INetFwPolicy2*>(tmp); 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2020-02-26T12:44:01.870

**`static_cast`vs `dynamic_cast`vs`reinterpret_cast`内部视图上的向下/向上**

在这个答案中，我想在一个具体的向上/向下转换示例中比较这三种机制，并分析底层指针/内存/程序集发生了什么，以具体了解它们的比较方式。

我相信这将对这些演员的不同之处提供一个很好的直觉：

*   `static_cast`：在运行时进行一个地址偏移（运行时影响低）并且没有安全检查向下转换是否正确。

*   `dyanamic_cast`: 在运行时执行相同的地址偏移`static_cast`，但也会使用 RTTI 进行昂贵的安全检查，以确保向下转换是正确的。

    `nullptr`此安全检查允许您通过检查指示无效向下转换的返回来查询基类指针是否在运行时属于给定类型。

    因此，如果您的代码无法检查`nullptr`并采取有效的非中止操作，您应该只使用`static_cast`而不是动态转换。

    如果中止是您的代码可以执行的唯一操作，也许您只想启用`dynamic_cast`调试构建 ( `-NDEBUG`)，并使用`static_cast`其他方式，例如[，如此处所做的](https://github.com/gem5/gem5/blob/9fc9c67b4242c03f165951775be5cd0812f2a705/src/base/cast.hh#L40)，以不减慢您的快速运行。

*   `reinterpret_cast`: 在运行时什么都不做，甚至地址偏移也不做。指针必须准确地指向正确的类型，甚至基类都不起作用。除非涉及原始字节流，否则您通常不希望这样做。

考虑以下代码示例：

主文件

```
#include <iostream>

struct B1 {
    B1(int int_in_b1) : int_in_b1(int_in_b1) {}
    virtual ~B1() {}
    void f0() {}
    virtual int f1() { return 1; }
    int int_in_b1;
};

struct B2 {
    B2(int int_in_b2) : int_in_b2(int_in_b2) {}
    virtual ~B2() {}
    virtual int f2() { return 2; }
    int int_in_b2;
};

struct D : public B1, public B2 {
    D(int int_in_b1, int int_in_b2, int int_in_d)
        : B1(int_in_b1), B2(int_in_b2), int_in_d(int_in_d) {}
    void d() {}
    int f2() { return 3; }
    int int_in_d;
};

int main() {
    B2 *b2s[2];
    B2 b2{11};
    D *dp;
    D d{1, 2, 3};

    // The memory layout must support the virtual method call use case.
    b2s[0] = &b2;
    // An upcast is an implicit static_cast<>().
    b2s[1] = &d;
    std::cout << "&d           " << &d           << std::endl;
    std::cout << "b2s[0]       " << b2s[0]       << std::endl;
    std::cout << "b2s[1]       " << b2s[1]       << std::endl;
    std::cout << "b2s[0]->f2() " << b2s[0]->f2() << std::endl;
    std::cout << "b2s[1]->f2() " << b2s[1]->f2() << std::endl;

    // Now for some downcasts.

    // Cannot be done implicitly
    // error: invalid conversion from ‘B2*’ to ‘D*’ [-fpermissive]
    // dp = (b2s[0]);

    // Undefined behaviour to an unrelated memory address because this is a B2, not D.
    dp = static_cast<D*>(b2s[0]);
    std::cout << "static_cast<D*>(b2s[0])            " << dp           << std::endl;
    std::cout << "static_cast<D*>(b2s[0])->int_in_d  " << dp->int_in_d << std::endl;

    // OK
    dp = static_cast<D*>(b2s[1]);
    std::cout << "static_cast<D*>(b2s[1])            " << dp           << std::endl;
    std::cout << "static_cast<D*>(b2s[1])->int_in_d  " << dp->int_in_d << std::endl;

    // Segfault because dp is nullptr.
    dp = dynamic_cast<D*>(b2s[0]);
    std::cout << "dynamic_cast<D*>(b2s[0])           " << dp           << std::endl;
    //std::cout << "dynamic_cast<D*>(b2s[0])->int_in_d " << dp->int_in_d << std::endl;

    // OK
    dp = dynamic_cast<D*>(b2s[1]);
    std::cout << "dynamic_cast<D*>(b2s[1])           " << dp           << std::endl;
    std::cout << "dynamic_cast<D*>(b2s[1])->int_in_d " << dp->int_in_d << std::endl;

    // Undefined behaviour to an unrelated memory address because this
    // did not calculate the offset to get from B2* to D*.
    dp = reinterpret_cast<D*>(b2s[1]);
    std::cout << "reinterpret_cast<D*>(b2s[1])           " << dp           << std::endl;
    std::cout << "reinterpret_cast<D*>(b2s[1])->int_in_d " << dp->int_in_d << std::endl;
} 
```

编译、运行和反汇编：

```
g++ -ggdb3 -O0 -std=c++11 -Wall -Wextra -pedantic -o main.out main.cpp
setarch `uname -m` -R ./main.out
gdb -batch -ex "disassemble/rs main" main.out 
```

where`setarch`用于[禁用 ASLR](https://stackoverflow.com/questions/11238457/disable-and-re-enable-address-space-layout-randomization-only-for-myself)，以便更轻松地比较运行。

可能的输出：

```
&d           0x7fffffffc930
b2s[0]       0x7fffffffc920
b2s[1]       0x7fffffffc940
b2s[0]->f2() 2
b2s[1]->f2() 3
static_cast<D*>(b2s[0])            0x7fffffffc910
static_cast<D*>(b2s[0])->int_in_d  1
static_cast<D*>(b2s[1])            0x7fffffffc930
static_cast<D*>(b2s[1])->int_in_d  3
dynamic_cast<D*>(b2s[0])           0
dynamic_cast<D*>(b2s[1])           0x7fffffffc930
dynamic_cast<D*>(b2s[1])->int_in_d 3
reinterpret_cast<D*>(b2s[1])           0x7fffffffc940
reinterpret_cast<D*>(b2s[1])->int_in_d 32767 
```

现在，正如在：[https](https://en.wikipedia.org/wiki/Virtual_method_table) ://en.wikipedia.org/wiki/Virtual_method_table中提到的，为了有效地支持虚方法调用，假设 B1 的内存数据结构的形式为：

```
B1:
  +0: pointer to virtual method table of B1
  +4: value of int_in_b1 
```

并`B2`具有以下形式：

```
B2:
  +0: pointer to virtual method table of B2
  +4: value of int_in_b2 
```

那么内存数据结构`D`必须看起来像：

```
D:
  +0: pointer to virtual method table of D (for B1)
  +4: value of int_in_b1
  +8: pointer to virtual method table of D (for B2)
 +12: value of int_in_b2
 +16: value of int_in_d 
```

关键事实是 的内存数据结构`D`在其内部包含与`B1`and相同的内存结构`B2`，即：

*   +0 看起来与 B1 完全一样，后面是 D 的 B1 vtable`int_in_b1`
*   +8 看起来与 B2 完全一样，后面是 D 的 B2 vtable`int_in_b2`

因此，我们得出关键结论：

> 向上转换或向下转换只需将指针值移动编译时已知的值

这样，当`D`被传递给基本类型数组时，类型转换实际上会计算偏移量并指向看起来与`B2`内存中的有效值完全一样的东西，除了这个有 vtable`D`而不是`B2`，因此所有虚拟调用都透明地工作。

例如：

```
b2s[1] = &d; 
```

只需要获取`d`+8的地址就可以到达对应的类B2数据结构。

现在，我们终于可以回到类型转换和具体示例的分析上了。

从标准输出输出我们看到：

```
&d           0x7fffffffc930
b2s[1]       0x7fffffffc940 
```

因此，在那里进行的隐式`static_cast`计算确实正确计算了从 0x7fffffffc930 处的完整`D`数据结构到 0x7fffffffc940 处的`B2`类似结构的偏移量。我们还推断，介于 0x7fffffffc930 和 0x7fffffffc940 之间的可能是`B1`数据和 vtable。

然后，在 downcast 部分，现在很容易理解无效部分如何失败以及为什么：

*   `static_cast<D*>(b2s[0]) 0x7fffffffc910`：编译器刚刚在编译时上升 0x10 字节以尝试从 a`B2`转到包含`D`

    但是因为`b2s[0]`不是 a `D`，所以它现在指向一个未定义的内存区域。

    拆解是：

    ```
    49          dp = static_cast<D*>(b2s[0]);
       0x0000000000000fc8 <+414>:   48 8b 45 d0     mov    -0x30(%rbp),%rax
       0x0000000000000fcc <+418>:   48 85 c0        test   %rax,%rax
       0x0000000000000fcf <+421>:   74 0a   je     0xfdb <main()+433>
       0x0000000000000fd1 <+423>:   48 8b 45 d0     mov    -0x30(%rbp),%rax
       0x0000000000000fd5 <+427>:   48 83 e8 10     sub    $0x10,%rax
       0x0000000000000fd9 <+431>:   eb 05   jmp    0xfe0 <main()+438>
       0x0000000000000fdb <+433>:   b8 00 00 00 00  mov    $0x0,%eax
       0x0000000000000fe0 <+438>:   48 89 45 98     mov    %rax,-0x68(%rbp) 
    ```

    所以我们看到 GCC 确实：

    *   检查指针是否为NULL，如果是则返回NULL
    *   否则，从中减去 0x10 以达到`D`不存在的
*   `dynamic_cast<D*>(b2s[0]) 0`: C++居然发现强制转换无效并返回`nullptr`！

    这不可能在编译时完成，我们将从反汇编中确认：

    ```
    59          dp = dynamic_cast<D*>(b2s[0]);
       0x00000000000010ec <+706>:   48 8b 45 d0     mov    -0x30(%rbp),%rax
       0x00000000000010f0 <+710>:   48 85 c0        test   %rax,%rax
       0x00000000000010f3 <+713>:   74 1d   je     0x1112 <main()+744>
       0x00000000000010f5 <+715>:   b9 10 00 00 00  mov    $0x10,%ecx
       0x00000000000010fa <+720>:   48 8d 15 f7 0b 20 00    lea    0x200bf7(%rip),%rdx        # 0x201cf8 <_ZTI1D>
       0x0000000000001101 <+727>:   48 8d 35 28 0c 20 00    lea    0x200c28(%rip),%rsi        # 0x201d30 <_ZTI2B2>
       0x0000000000001108 <+734>:   48 89 c7        mov    %rax,%rdi
       0x000000000000110b <+737>:   e8 c0 fb ff ff  callq  0xcd0 <__dynamic_cast@plt>
       0x0000000000001110 <+742>:   eb 05   jmp    0x1117 <main()+749>
       0x0000000000001112 <+744>:   b8 00 00 00 00  mov    $0x0,%eax
       0x0000000000001117 <+749>:   48 89 45 98     mov    %rax,-0x68(%rbp) 
    ```

    首先进行 NULL 检查，如果输入为 NULL，则返回 NULL。

    否则，它会在 RDX、RSI 和 RDI 中设置一些参数并调用`__dynamic_cast`.

    我现在没有耐心进一步分析这一点，但正如其他人所说，唯一可行的方法是`__dynamic_cast`访问一些表示类层次结构的额外 RTTI 内存数据结构。

    因此，它必须从该`B2`表的条目开始，然后遍历该类层次结构，直到找到用于`D`类型转换的 vtable 来自`b2s[0]`.

    这就是为什么动态转换可能很昂贵的原因！这是一个示例，其中[在复杂项目中将 a转换](https://gem5-review.googlesource.com/c/public/gem5/+/25964)[为 a](https://gem5-review.googlesource.com/c/public/gem5/+/25964)[的单行补丁将运行时间减少了 33%！`dynamic_cast``static_cast`](https://gem5-review.googlesource.com/c/public/gem5/+/25964).

*   `reinterpret_cast<D*>(b2s[1]) 0x7fffffffc940`这个只是盲目相信我们：我们说有一个`D`at address `b2s[1]`，编译器不做偏移计算。

    但这是错误的，因为D实际上在0x7fffffffc930，0x7fffffffc940是D内部的类似B2的结构！所以垃圾被访问了。

    我们可以从`-O0`只是移动值的可怕程序集来确认这一点：

    ```
    70          dp = reinterpret_cast<D*>(b2s[1]);
       0x00000000000011fa <+976>:   48 8b 45 d8     mov    -0x28(%rbp),%rax
       0x00000000000011fe <+980>:   48 89 45 98     mov    %rax,-0x68(%rbp) 
    ```

相关问题：

*   [什么时候应该使用 static_cast、dynamic_cast、const_cast 和 reinterpret_cast？](https://stackoverflow.com/questions/332030/when-should-static-cast-dynamic-cast-const-cast-and-reinterpret-cast-be-used)
*   [dynamic_cast 是如何实现的](https://stackoverflow.com/questions/18359780/how-is-dynamic-cast-implemented)
*   [在 C++ 中使用“static_cast”进行向下转换](https://stackoverflow.com/questions/6322949/downcasting-using-the-static-cast-in-c)

在 Ubuntu 18.04 amd64、GCC 7.4.0 上测试。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2018-08-22T11:18:21.983

虽然其他答案很好地描述了 C++ 强制转换之间的所有差异，但我想添加一个简短说明，为什么您不应该使用 C 样式强制转换`(Type) var`和`Type(var)`.

对于 C++ 初学者来说，C 样式转换看起来像是 C++ 转换（static_cast<>()、dynamic_cast<>()、const_cast<>()、reinterpret_cast<>()）的超集操作，有人可能更喜欢它们而不是 C++ 转换. 事实上，C 风格的演员表是超集并且写起来更短。

C 风格转换的主要问题是它们隐藏了开发人员转换的真实意图。C 风格的转换几乎可以执行所有类型的转换，从由 static_cast<>() 和 dynamic_cast<>() 完成的正常安全转换到像 const_cast<>() 这样的潜在危险转换，其中 const 修饰符可以被删除，因此 const 变量可以修改和 reinterpret_cast<>() 甚至可以将整数值重新解释为指针。

这是示例。

```
int a=rand(); // Random number.

int* pa1=reinterpret_cast<int*>(a); // OK. Here developer clearly expressed he wanted to do this potentially dangerous operation.

int* pa2=static_cast<int*>(a); // Compiler error.
int* pa3=dynamic_cast<int*>(a); // Compiler error.

int* pa4=(int*) a; // OK. C-style cast can do such cast. The question is if it was intentional or developer just did some typo.

*pa4=5; // Program crashes. 
```

将 C++ 强制转换添加到语言中的主要原因是允许开发人员阐明他的意图——他为什么要进行这种强制转换。通过使用在 C++ 中完全有效的 C 样式转换，您的代码可读性降低并且更容易出错，特别是对于没有创建您的代码的其他开发人员而言。因此，为了使您的代码更具可读性和明确性，您应该始终更喜欢 C++ 强制转换而不是 C 样式强制转换。

这是 Bjarne Stroustrup（C++ 的作者）的书 The C++ Programming Language 4th edition - page 302 的简短引述。

> 这种 C 风格的转换比命名转换运算符危险得多，因为这种符号在大型程序中更难发现，而且程序员想要的转换类型并不明确。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2018-12-21T02:53:59.623

为了理解，让我们考虑下面的代码片段：

```
struct Foo{};
struct Bar{};

int main(int argc, char** argv)
{
    Foo* f = new Foo;

    Bar* b1 = f;                              // (1)
    Bar* b2 = static_cast<Bar*>(f);           // (2)
    Bar* b3 = dynamic_cast<Bar*>(f);          // (3)
    Bar* b4 = reinterpret_cast<Bar*>(f);      // (4)
    Bar* b5 = const_cast<Bar*>(f);            // (5)

    return 0;
} 
```

只有第 (4) 行编译没有错误。只有**reinterpret_cast**可用于将指向对象的指针转换为指向任何不相关对象类型的指针。

需要注意的一点是：**dynamic_cast**会在运行时失败，但是在大多数编译器上它也将无法编译，因为被强制转换的指针的结构中没有虚函数，这意味着**dynamic_cast**仅适用于多态类指针.

**何时使用 C++ cast**：

*   使用**static_cast**作为进行值转换的 C 风格强制转换的等价物，或者当我们需要将指针从类显式向上转换到其超类时。
*   使用**const_cast**删除 const 限定符。
*   使用**reinterpret_cast**将指针类型与整数和其他指针类型进行不安全的转换。仅当我们知道我们在做什么并且我们了解混叠问题时才使用它。

# html - 如何在 html 页面上的 swf 上添加 swf

> ID：332048
> 
> 赞同：0
> 
> 时间：2008-12-01T20:18:41.433
> 
> 标签：html, flash

我一直在尝试在 html 页面上在 swf 上添加 swf，它在 Firefox 中运行良好，但在 IE 中，首先添加的总是在另一个之上。我使用了z-index，但它不起作用，有人知道如何解决这个问题吗？谢谢。

我已经添加了 wmode:transparent，它在 Firefox 中工作，但在 IE 6 中没有。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-01T20:25:20.813

添加`wmode=transparent`到您的电影参数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T05:16:52.487

使用背景 iframe...这是一个很好的[jquery 插件](http://plugins.jquery.com/project/bgiframe)来为您处理它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T13:40:46.677

为了使 z-index 作用于页面中的给定元素，该元素必须使用`position: absolute`or定位`position: relative`。您还需要将`wmode`参数设置`transparent`为允许浏览器将 Flash 内容定位在页面中其他元素的下方。

# http-headers - HTTP 标头“Via:1.1 nc1 (NetCache NetApp/6.0.5P1)”停止 IIS6 gzip 压缩

> ID：332049
> 
> 赞同：1
> 
> 时间：2008-12-01T20:18:47.410
> 
> 标签：http-headers

我发送的请求是接受 gzip 但响应没有压缩，相反，我收到了一些标头

```
Via:1.1 nc1 (NetCache NetApp/6.0.5P1) 
```

我想这与我的 ISP 有关，因为它可以在我的家用计算机上完美运行。

知道如何压缩响应吗？

请求头

```
GET /test.aspx HTTP/1.1
Host    this.is.example.com
User-Agent  Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.0.3) Gecko/2008092417 Firefox/3.0.3 (.NET CLR 3.5.30729)
Accept  text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language en-us,en;q=0.5
Accept-Encoding gzip,deflate
Accept-Charset  ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive  300
Pragma  no-cache
Cache-Control   no-cache 
```

响应头

```
HTTP/1.1 200 OK
Date    Mon, 01 Dec 2008 19:53:40 GMT
Content-Length  6099
Content-Type    text/html; charset=utf-8
Cache-Control   private
Server  Microsoft-IIS/6.0
X-Powered-By    ASP.NET
X-AspNet-Version    2.0.50727
Via 1.1 nc1 (NetCache NetApp/6.0.5P1)
Expires 0
Cache-Control   no-cache
// I expect content-encoding to be gzip here 
```

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-25T14:24:10.897

没有强制响应压缩的机制。接受编码：gzip 只告诉网络服务器/代理它可以压缩响应，而不是它必须对响应进行编码。有许多网络服务器和代理不支持开箱即用的 gzip，或者默认情况下将其配置为关闭。

您找到的 Via 标头经常由代表您连接到预期 Web 服务器的代理插入，并且是信息性的。这与您的压缩问题无关。

# winforms - 使用工具栏进行快速导航有意义吗？

> ID：332051
> 
> 赞同：1
> 
> 时间：2008-12-01T20:19:38.017
> 
> 标签：winforms, user-interface, toolbar

我有一个 winforms 应用程序，它没有我可以在工具栏上提供的共享工具集。但是我想要一个工具栏，所以我打算利用这个空间来提供产品最流行部分的快速链接。我最终将向产品添加知识，以了解当前用户喜欢哪些屏幕，并将这些作为工具栏上的快速链接提供。但是，从设计和可用性的角度来看，这是对桌面产品工具栏的合理使用吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T20:29:11.757

不要自动添加有关用户更喜欢生成工具栏的知识。拥有动态生成的工具栏会让用户感到困惑。如果您的配置栏动态地提出建议（即建议按钮），那很好，但改变布局本身是邪恶的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T20:22:11.460

我认为工具栏具有良好的美感，但如果您只想分离应用程序的各个部分，那么 Tab 栏对可用性更有意义。

随着选项卡式浏览的出现，每个用户都了解选项卡的概念。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T20:26:27.440

当然。Firefox 在他们的“书签工具栏”中有类似的东西。

Peachtree Accounting 和其他许多工具栏一样，也有这样的工具栏。

只要没有太多标签就可以了。

如果用户可以自己个性化工具栏，那就太好了。有时我不仅想要我经常去的地方，还想要我偶尔使用的那些很难通过菜单或其他东西找到的屏幕。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-14T16:25:50.277

对我来说，这看起来像是带有 MRU 列表或支持“添加到收藏夹”的菜单的工作。

# java - java远程桌面

> ID：332055
> 
> 赞同：0
> 
> 时间：2008-12-01T20:20:02.773
> 
> 标签：java

我试图创建一个应用程序来使用java远程控制电脑，我想使用red5让管理员使用flash电影控制桌面，所以我需要找到java类来：

*   将桌面捕获为实时视频
*   -控制鼠标和键盘

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T20:25:17.583

[TightVNC](http://www.tightvnc.com/download.html)有一个 Java 查看器，因此您可以通过 VNC 协议轻松管理您的服务器并使用 Java 客户端（也可用作小程序）。

有一些工具，虽然不是在 Java 中，例如[vncrec](http://www.sodan.org/~penny/vncrec/)来记录 VNC 会话。我不知道这是否正是您正在寻找的，因为要分发视频，更好的选择是设置流媒体服务器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T20:32:59.800

我不相信存在可以为您提供所需内容的 Java 库。捕获屏幕和控制鼠标/键盘需要以 Java 不具备的方式连接到操作系统。您需要编写一个使用 JNI 并公开您需要的功能的本机 DLL，然后在 java 中加载它。然后，您必须将获得的图像数据转换为 Flash 可以理解的格式。

创建实时视频流可能不是最有效的。通常流式视频是相当有损的（在屏幕共享时通常不是那么好），并且分辨率比您可能处理的要小。我不确定您是否可以创建一个既能快速流式传输又具有足够高的图像质量以供使用的视频。

您最好为此使用预先存在的产品（如费尔南多建议的 TightVNC）。不幸的是，这需要一个 Java 小程序（或本机应用程序）才能查看，而不是 Flash。

（完全披露：我已经编写了在服务器和查看器两端都使用 Java 的屏幕共享应用程序，并且我们已经多次尝试制作 Flash 查看器。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T05:47:24.937

只需使用 VNC。您可以从 Java 调用 VNC 服务器可执行文件。在客户端上，您可以使用 Java VNC 查看器。如果您确实需要对其进行更改，我确信某处有源代码。您可以使用 BlueJ 的 AppletWindow[在](http://www.bluej.org/resources/classes.html)任何 Java 应用程序的 JFrame 内启动 VNC 查看器小程序。

# asp.net-mvc - 如何在不模拟的情况下对使用 UpdateModel 的操作进行单元测试？

> ID：332060
> 
> 赞同：8
> 
> 时间：2008-12-01T20:20:42.443
> 
> 标签：asp.net-mvc, updatemodel, argumentnullexception, controllercontext

我一直在阅读 Scott Guthrie 在[ASP.NET MVC Beta 1](http://weblogs.asp.net/scottgu/archive/2008/10/16/asp-net-mvc-beta-released.aspx)上的出色文章。在其中，他展示了对 UpdateModel 方法的改进以及它们如何改进单元测试。我重新创建了一个类似的项目，但是每当我运行包含对 UpdateModel 的调用的 UnitTest 时，我都会收到一个 ArgumentNullException 命名 controllerContext 参数。

以下是相关位，从我的模型开始：

```
public class Country {
  public Int32 ID { get; set; }
  public String Name { get; set; }
  public String Iso3166 { get; set; }
} 
```

控制器动作：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Edit(Int32 id, FormCollection form)
{
  using ( ModelBindingDataContext db = new ModelBindingDataContext() ) {
    Country country = db.Countries.Where(c => c.CountryID == id).SingleOrDefault();

    try {
      UpdateModel(country, form);

      db.SubmitChanges();

      return RedirectToAction("Index");
    }
    catch {
      return View(country);
    }
  }
} 
```

最后我的单元测试失败了：

```
[TestMethod]
public void Edit()
{
  CountryController controller = new CountryController();
  FormCollection form = new FormCollection();
  form.Add("Name", "Canada");
  form.Add("Iso3166", "CA");

  var result = controller.Edit(2 /*Canada*/, form) as RedirectToRouteResult;

  Assert.IsNotNull(result, "Expected to be redirected on successful POST.");
  Assert.AreEqual("Show", result.RouteName, "Expected to redirect to the View action.");
} 
```

`ArgumentNullException`调用时抛出`UpdateModel`消息“值不能为空。参数名称：controllerContext”。我假设某处`UpdateModel`需要`System.Web.Mvc.ControllerContext`在测试执行期间不存在的地方。

我还假设我在某处做错了什么，只需要指出正确的方向。

请帮忙！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-01T20:27:52.837

我不认为它可以完成，因为 UpdateModel 使用的 TryUpdateModel 引用了从单元测试调用时为空的 ControllerContext。我使用 RhinoMocks 模拟或存根控制器所需的各种组件。

```
var routeData = new RouteData();
var httpContext = MockRepository.GenerateStub<HttpContextBase>();
FormCollection formParameters = new FormCollection();

EventController controller = new EventController();
ControllerContext controllerContext = 
    MockRepository.GenerateStub<ControllerContext>( httpContext,
                                                    routeData,
                                                    controller );
controller.ControllerContext = controllerContext;

ViewResult result = controller.Create( formParameters ) as ViewResult;

Assert.AreEqual( "Event", result.Values["controller"] );
Assert.AreEqual( "Show", result.Values["action"] );
Assert.AreEqual( 0, result.Values["id"] ); 
```

以下是 www.codeplex.com/aspnet 上 Controller.cs 源代码中的相关信息：

```
protected internal bool TryUpdateModel<TModel>( ... ) where TModel : class
{

     ....

    ModelBindingContext bindingContext =
           new ModelBindingContext( ControllerContext,
                                    valueProvider,
                                    typeof(TModel),
                                    prefix,
                                    () => model,
                                    ModelState,
                                    propertyFilter );

     ...
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-12-03T20:47:54.900

我遇到了同样的问题。在阅读了 tvanfosson 的解决方案后，我尝试了一个不涉及模拟框架的简单解决方案。

将默认 ControllerContext 添加到控制器，如下所示：

```
CountryController controller = new CountryController();
controller.ControllerContext = new ControllerContext(); 
```

这消除了单元测试时对我来说很好的错误。我希望这可以帮助其他人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-31T10:28:59.393

或者您可以创建表单数据代理，例如

```
public class CountryEdit {
  public String Name { get; set; }
  public String Iso3166 { get; set; }
} 
```

*   加。轻松创建单元测试
*   加。定义从帖子更新的字段白名单
*   加。轻松设置验证规则，轻松测试。
*   减。您应该将日期从代理移动到您的模型

所以 Controller.Action 应该看起来像

```
public ActionResult Edit(Int32 id, CountryEdit input)
{
  var Country = input.ToDb();
  // Continue your code
} 
```

# java - 使用码头重新映射网址

> ID：332067
> 
> 赞同：0
> 
> 时间：2008-12-01T20:22:10.507
> 
> 标签：java, jetty

我的应用程序的上下文根是 /foobar，我正在使用 maven-jetty-plugin 运行爆炸部署。

我需要动态地将 /images/* 的请求重新映射到 /foobar/images/*，并且我无法将应用程序的上下文根重新映射到 /。

对于 weblogic，我有一个半机智的解决方案，我在其中部署了一个额外的战争，其中包含一个到上下文根 /images 的代理。

问题是我不能让它与 maven-jetty-plugin 一起工作，因为我看不到它如何部署两个应用程序。

有人知道怎么做吗 ？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-01T20:27:12.417

您指的是 <img> 链接吗？如果是这样，这是 Apache 的 MOD_REWRITE 的工作

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T20:58:20.373

[http://jiajia.eu/category/Maven.aspx](http://jiajia.eu/category/Maven.aspx)

# ruby - Merb 的文档是否像看起来那样糟糕？

> ID：332073
> 
> 赞同：3
> 
> 时间：2008-12-01T20:23:02.970
> 
> 标签：ruby, documentation, merb

我只读过关于 Merb 的好东西，但[网站](http://merbivore.com/)上的文档基本上是 api 参考，目前还没有出版书籍。

有关于 Merb 的资源吗？

我想我会开始阅读代码，但如果有其他信息来源会很好

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T20:32:03.327

精彩的[PeepCode](http://peepcode.com/)有一个[Merb PDF 和截屏视频](http://peepcode.com/products/meet-merb-pdf-draft)，售价 9 美元。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T21:07:16.407

源代码非常可读，非常紧凑且充满注释。

然后，每个 merb 部分也有一个完整的 README 信息。

您可以在 github 上阅读所有这些内容：http: [//github.com/wycats/merb/](http://github.com/wycats/merb/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-09T17:21:00.447

你是对的。正如网站会告诉你的，Merb 是一个黑客的框架。Yehuda 在最近一次 infoq 采访中称其为试验场。缺乏好的例子是因为该系统自成立以来发生了很大变化。Dec 指出了 github 页面。它们是我所知道的当前文档的最佳来源。随着 1.0 的发布，API 变得稳定，这有望减少代码示例的损坏。我还强烈推荐 FreeNode 上的#merb IRC 频道。友善、聪明的人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-04T20:52:51.630

我认为 merb 在好的示例代码、教程和更新过时信息方面做得很差。我真的很喜欢这个项目，但已经被这个刺痛了好几次。现在它已经达到了一个半稳定的 1.0，我真的希望有些人站出来更新一堆文档，向旧文档添加警告并将其指向更新的信息。现在是 1.0，很高兴看到他们如何处理支持该项目

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-18T20:31:11.963

有[Merb Wiki](http://wiki.merbivore.com/)和社区图书项目，您可以在[http://book.merbist.com/](http://book.merbist.com/)上看到它，源代码在 github：http: [//github.com/mattetti/merb-book/tree/master](http://github.com/mattetti/merb-book/tree/master) .

# java - 在 Java 中，如何将字节数组转换为十六进制数字字符串，同时保持前导零？

> ID：332079
> 
> 赞同：169
> 
> 时间：2008-12-01T20:24:43.187
> 
> 标签：java, md5, hex

我正在使用一些示例 java 代码来制作 md5 哈希。一部分将结果从字节转换为一串十六进制数字：

```
byte messageDigest[] = algorithm.digest();     
StringBuffer hexString = new StringBuffer();
for (int i=0;i<messageDigest.length;i++) {
    hexString.append(Integer.toHexString(0xFF & messageDigest[i]));
    } 
```

然而，由于 toHexString 显然去掉了前导零，所以它并不完全有效。那么，从字节数组到保持前导零的十六进制字符串的最简单方法是什么？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2008-12-01T22:12:58.117

从[Apache Commons Codec](https://commons.apache.org/proper/commons-codec/)查看[Hex.encodeHexString](https://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/binary/Hex.html#encodeHexString-byte:A-)。

```
import org.apache.commons.codec.binary.Hex;

String hex = Hex.encodeHexString(bytes); 
```

* * *

## 回答 #2

> 赞同：116
> 
> 时间：2009-06-03T10:09:07.433

你可以使用下面的那个。我用前导零字节和初始负字节测试了这个

```
public static String toHex(byte[] bytes) {
    BigInteger bi = new BigInteger(1, bytes);
    return String.format("%0" + (bytes.length << 1) + "X", bi);
} 
```

如果您想要小写十六进制数字，请使用`"x"`字符串格式。

* * *

## 回答 #3

> 赞同：112
> 
> 时间：2008-12-01T20:32:19.893

一种简单的方法是检查输出了多少位，`Integer.toHexString()`并在需要时为每个字节添加前导零。像这样的东西：

```
public static String toHexString(byte[] bytes) {
    StringBuilder hexString = new StringBuilder();

    for (int i = 0; i < bytes.length; i++) {
        String hex = Integer.toHexString(0xFF & bytes[i]);
        if (hex.length() == 1) {
            hexString.append('0');
        }
        hexString.append(hex);
    }

    return hexString.toString();
} 
```

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2013-01-27T21:50:58.610

该方法[**`javax.xml.bind.DatatypeConverter.printHexBinary()`**](https://docs.oracle.com/javase/9/docs/api/javax/xml/bind/DatatypeConverter.html#printHexBinary-byte:A-)是[Java 架构 XML 绑定 (JAXB)](https://en.wikipedia.org/wiki/Java_Architecture_for_XML_Binding)`byte[]`的一部分，是一种将 a 转换为十六进制字符串的便捷方法。该类[`DatatypeConverter`](https://docs.oracle.com/javase/9/docs/api/javax/xml/bind/DatatypeConverter.html)还包括许多其他有用的数据操作方法。

在 Java 8 及更早版本中，JAXB 是 Java 标准库的一部分。它在**Java 9中被****[弃用](https://cr.openjdk.java.net/~iris/se/9/java-se-9-fr-spec/#APIs-proposed-for-removal)，并在 Java 11中[被删除](https://openjdk.java.net/jeps/320)**，作为将所有 Java EE 包移动到它们自己的库中的努力的一部分。[说来话长](https://www.jesperdj.com/2018/09/30/jaxb-on-java-9-10-11-and-beyond/)。现在，`javax.xml.bind`不存在，如果您想使用包含`DatatypeConverter`的 JAXB，您需要从 Maven安装[JAXB API](https://mvnrepository.com/artifact/javax.xml.bind/jaxb-api/2.4.0-b180830.0359)和[JAXB Runtime 。](https://mvnrepository.com/artifact/org.glassfish.jaxb/jaxb-runtime/2.4.0-b180830.0438)

示例用法：

```
byte bytes[] = {(byte)0, (byte)0, (byte)134, (byte)0, (byte)61};
String hex = javax.xml.bind.DatatypeConverter.printHexBinary(bytes); 
```

将导致：

```
000086003D 
```

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2010-02-04T06:03:37.043

我喜欢史蒂夫的提交，但他可以在没有几个变量的情况下完成，并在此过程中节省了几行。

```
public static String toHexString(byte[] bytes) {
    char[] hexArray = {'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'};
    char[] hexChars = new char[bytes.length * 2];
    int v;
    for ( int j = 0; j < bytes.length; j++ ) {
        v = bytes[j] & 0xFF;
        hexChars[j*2] = hexArray[v/16];
        hexChars[j*2 + 1] = hexArray[v%16];
    }
    return new String(hexChars);
} 
```

我喜欢的是它很容易准确地看到它在做什么（而不是依赖于一些神奇的 BigInteger 黑盒转换），而且你也不必担心诸如前导零之类的极端情况。该例程采用每个 4 位半字节并将其转换为十六进制字符。它使用表格查找，所以它可能很快。如果您将 v/16 和 v%16 替换为按位移位和 AND，它可能会更快，但我现在懒得测试它。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2009-06-15T17:15:58.290

我发现 Integer.toHexString 有点慢。如果要转换许多字节，您可能需要考虑构建一个包含“00”..“FF”的字符串数组，并使用整数作为索引。IE

```
hexString.append(hexArray[0xFF & messageDigest[i]]); 
```

这更快并确保正确的长度。只需要字符串数组：

```
String[] hexArray = {
"00","01","02","03","04","05","06","07","08","09","0A","0B","0C","0D","0E","0F",
"10","11","12","13","14","15","16","17","18","19","1A","1B","1C","1D","1E","1F",
"20","21","22","23","24","25","26","27","28","29","2A","2B","2C","2D","2E","2F",
"30","31","32","33","34","35","36","37","38","39","3A","3B","3C","3D","3E","3F",
"40","41","42","43","44","45","46","47","48","49","4A","4B","4C","4D","4E","4F",
"50","51","52","53","54","55","56","57","58","59","5A","5B","5C","5D","5E","5F",
"60","61","62","63","64","65","66","67","68","69","6A","6B","6C","6D","6E","6F",
"70","71","72","73","74","75","76","77","78","79","7A","7B","7C","7D","7E","7F",
"80","81","82","83","84","85","86","87","88","89","8A","8B","8C","8D","8E","8F",
"90","91","92","93","94","95","96","97","98","99","9A","9B","9C","9D","9E","9F",
"A0","A1","A2","A3","A4","A5","A6","A7","A8","A9","AA","AB","AC","AD","AE","AF",
"B0","B1","B2","B3","B4","B5","B6","B7","B8","B9","BA","BB","BC","BD","BE","BF",
"C0","C1","C2","C3","C4","C5","C6","C7","C8","C9","CA","CB","CC","CD","CE","CF",
"D0","D1","D2","D3","D4","D5","D6","D7","D8","D9","DA","DB","DC","DD","DE","DF",
"E0","E1","E2","E3","E4","E5","E6","E7","E8","E9","EA","EB","EC","ED","EE","EF",
"F0","F1","F2","F3","F4","F5","F6","F7","F8","F9","FA","FB","FC","FD","FE","FF"}; 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2009-06-26T03:56:03.730

我一直在寻找同样的东西......这里有一些好主意，但我运行了一些微基准测试。我发现以下是最快的（从上面的 Ayman 修改，大约是 2 倍，比 Steve 的快大约 50%）：

```
public static String hash(String text, String algorithm)
        throws NoSuchAlgorithmException {
    byte[] hash = MessageDigest.getInstance(algorithm).digest(text.getBytes());
    return new BigInteger(1, hash).toString(16);
} 
```

编辑：哎呀-错过了这与kgiannakakis的基本相同，因此可能会去掉前导0。不过，将其修改为以下内容，它仍然是最快的：

```
public static String hash(String text, String algorithm)
        throws NoSuchAlgorithmException {
    byte[] hash = MessageDigest.getInstance(algorithm).digest(text.getBytes());
    BigInteger bi = new BigInteger(1, hash);
    String result = bi.toString(16);
    if (result.length() % 2 != 0) {
        return "0" + result;
    }
    return result;
} 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2010-04-14T14:55:04.773

```
static String toHex(byte[] digest) {
    StringBuilder sb = new StringBuilder();
    for (byte b : digest) {
        sb.append(String.format("%1$02X", b));
    }

    return sb.toString();
} 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2017-04-07T11:28:28.187

我会使用这样的东西来固定长度，比如哈希：

```
md5sum = String.format("%032x", new BigInteger(1, md.digest())); 
```

`0`面具中的填充物......

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-12-01T20:33:15.930

```
String result = String.format("%0" + messageDigest.length + "s", hexString.toString()) 
```

鉴于您已经拥有的，这是最短的解决方案。如果您可以将字节数组转换为数值，`String.format`则可以同时将其转换为十六进制字符串。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2015-01-22T20:17:14.710

[Guava](https://code.google.com/p/guava-libraries/wiki/GuavaExplained)也让它变得非常简单：

```
BaseEncoding.base16().encode( bytes ); 
```

当 Apache Commons 不可用时，这是一个不错的选择。它还具有一些不错的输出控制，例如：

```
byte[] bytes = new byte[] { 0xa, 0xb, 0xc, 0xd, 0xe, 0xf };
BaseEncoding.base16().lowerCase().withSeparator( ":", 2 ).encode( bytes );
// "0a:0b:0c:0d:0e:0f" 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-12-02T15:21:12.580

这个解决方案有点老了，应该是内存效率高的。

```
public static String toHexString(byte bytes[]) {
    if (bytes == null) {
        return null;
    }

    StringBuffer sb = new StringBuffer();
    for (int iter = 0; iter < bytes.length; iter++) {
        byte high = (byte) ( (bytes[iter] & 0xf0) >> 4);
        byte low =  (byte)   (bytes[iter] & 0x0f);
        sb.append(nibble2char(high));
        sb.append(nibble2char(low));
    }

    return sb.toString();
}

private static char nibble2char(byte b) {
    byte nibble = (byte) (b & 0x0f);
    if (nibble < 10) {
        return (char) ('0' + nibble);
    }
    return (char) ('a' + nibble - 10);
} 
```

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-06-03T21:04:01.900

另外一个选项

```
public static String toHexString(byte[]bytes) {
    StringBuilder sb = new StringBuilder(bytes.length*2);
    for(byte b: bytes)
      sb.append(Integer.toHexString(b+0x800).substring(1));
    return sb.toString();
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2010-07-13T10:02:03.340

为了保持前导零，以下是 Paul 建议的一个小变化（例如 md5 哈希）：

```
public static String MD5hash(String text) throws NoSuchAlgorithmException {
    byte[] hash = MessageDigest.getInstance("MD5").digest(text.getBytes());
    return String.format("%032x",new BigInteger(1, hash));
} 
```

糟糕，这看起来比 Ayman 提议的要差，对此感到抱歉

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2010-10-08T08:57:37.570

```
static String toHex(byte[] digest) {
    String digits = "0123456789abcdef";
    StringBuilder sb = new StringBuilder(digest.length * 2);
    for (byte b : digest) {
        int bi = b & 0xff;
        sb.append(digits.charAt(bi >> 4));
        sb.append(digits.charAt(bi & 0xf));
    }
    return sb.toString();
} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-06-29T18:26:13.513

看来 concat 和 append 函数可能真的很慢。以下对我来说要快得多（比我以前的帖子）。在构建输出时更改为 char 数组是加快输出速度的关键因素。我没有与 Brandon DuRette 建议的 Hex.encodeHex 进行比较。

```
public static String toHexString(byte[] bytes) {
    char[] hexArray = {'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'};
    char[] hexChars = new char[10000000];
    int c = 0;
    int v;
    for ( j = 0; j < bytes.length; j++ ) {
        v = bytes[j] & 0xFF;
        hexChars[c] = hexArray[v/16];
        c++;
        hexChars[c] = hexArray[v%16];
        c++;
    }
    return new String(hexChars, 0, c); } 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-12-01T20:30:05.547

这是我用于 MD5 哈希的内容：

```
public static String getMD5(String filename)
        throws NoSuchAlgorithmException, IOException {
    MessageDigest messageDigest = 
        java.security.MessageDigest.getInstance("MD5");

    InputStream in = new FileInputStream(filename);

    byte [] buffer = new byte[8192];
    int len = in.read(buffer, 0, buffer.length);

    while (len > 0) {
        messageDigest.update(buffer, 0, len);
        len = in.read(buffer, 0, buffer.length);
    }
    in.close();

    return new BigInteger(1, messageDigest.digest()).toString(16);
} 
```

编辑：我已经测试过，我注意到这也减少了尾随零。但这只能在开始时发生，因此您可以与预期的长度进行比较并相应地填充。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2012-09-20T14:07:33.367

如果没有外部库，你可以减少它的编写：

```
String hex = (new HexBinaryAdapter()).marshal(md5.digest(YOUR_STRING.getBytes())) 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2012-09-21T00:16:59.877

这个解决方案不需要位移或掩码、查找表或外部库，并且尽可能短：

```
byte[] digest = new byte[16];       

Formatter fmt = new Formatter();    
for (byte b : digest) { 
  fmt.format("%02X", b);    
}

fmt.toString() 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-12-01T20:41:14.773

```
byte messageDigest[] = algorithm.digest();
StringBuffer hexString = new StringBuffer();
for (int i = 0; i < messageDigest.length; i++) {
    String hexByte = Integer.toHexString(0xFF & messageDigest[i]);
    int numDigits = 2 - hexByte.length();
    while (numDigits-- > 0) {
        hexString.append('0');
    }
    hexString.append(hexByte);
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2012-01-27T10:42:10.467

恕我直言，上述提供片段以删除前导零的所有解决方案都是错误的。

```
byte messageDigest[] = algorithm.digest();
for (int i = 0; i < messageDigest.length; i++) {
    hexString.append(Integer.toHexString(0xFF & messageDigest[i]));
} 
```

根据这个片段，在迭代中从字节数组中取出 8 位，转换为整数（因为 Integer.toHexString 函数将 int 作为参数），然后将该整数转换为相应的哈希值。因此，例如，如果您有二进制的 00000001 00000001，根据代码，hexString 变量的十六进制值将是 0x11，而正确的值应该是 0x0101。因此，在计算 MD5 时，我们可能会得到长度小于 32 字节的散列（因为缺少零），这可能不满足 MD5 散列所做的加密唯一属性。

该问题的解决方案是将上面的代码段替换为以下代码段：

```
byte messageDigest[] = algorithm.digest();
for (int i = 0; i < messageDigest.length; i++) {
    int temp=0xFF & messageDigest[i];
    String s=Integer.toHexString(temp);
    if(temp<=0x0F){
        s="0"+s;
    }
    hexString.append(s);
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2013-01-30T22:24:33.897

这将为一个字节提供两个字符的长字符串。

```
public String toString(byte b){
    final char[] Hex = new String("0123456789ABCDEF").toCharArray();
    return  "0x"+ Hex[(b & 0xF0) >> 4]+ Hex[(b & 0x0F)];
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-06-12T10:53:12.007

你怎么能再次从 ascii 转换回字节数组？

我按照以下代码转换为 Jemenake 给出的 ascii。

```
public static String toHexString(byte[] bytes) {
    char[] hexArray = {'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'};
    char[] hexChars = new char[bytes.length * 2];
    int v;
    for ( int j = 0; j < bytes.length; j++ ) {
        v = bytes[j] & 0xFF;
        hexChars[j*2] = hexArray[v/16];
        hexChars[j*2 + 1] = hexArray[v%16];
    }
    return new String(hexChars);
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-08-29T19:58:20.430

我的变种

```
 StringBuilder builder = new StringBuilder();
    for (byte b : bytes)
    {
        builder.append(Character.forDigit(b/16, 16));
        builder.append(Character.forDigit(b % 16, 16));
    }
    System.out.println(builder.toString()); 
```

这个对我有用。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2014-04-24T08:07:50.387

这是一个错误的解决方案吗？（安卓Java）

```
 // Create MD5 Hash
    MessageDigest digest = java.security.MessageDigest.getInstance("MD5");
    digest.update(s.getBytes());
    byte[] md5sum = digest.digest();
    BigInteger bigInt = new BigInteger(1, md5sum);
    String stringMD5 = bigInt.toString(16);
    // Fill to 32 chars
    stringMD5 = String.format("%32s", stringMD5).replace(' ', '0');
    return stringMD5; 
```

所以基本上它用0替换空格。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-02-17T20:34:31.767

我很惊讶没有人提出以下解决方案：

```
StringWriter sw = new StringWriter();
com.sun.corba.se.impl.orbutil.HexOutputStream hex = new com.sun.corba.se.impl.orbutil.HexOutputStream(sw);
hex.write(byteArray);
System.out.println(sw.toString()); 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2018-12-23T10:29:33.640

或者你可以这样做：

```
byte[] digest = algorithm.digest();
StringBuilder byteContet = new StringBuilder();
for(byte b: digest){
 byteContent = String.format("%02x",b);
 byteContent.append(byteContent);
} 
```

它简短，简单，基本上只是格式更改。

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2012-08-27T14:20:36.257

这也是等效的，但使用 Apache util [HexBin](http://xerces.apache.org/xerces2-j/javadocs/xerces2/org/apache/xerces/impl/dv/util/HexBin.html#encode%28byte%5b%5d%29)更简洁，其中代码简化为

```
HexBin.encode(messageDigest).toLowerCase(); 
```

# regex - 如果用户在 Django 的表单字段中仅输入空格，那么捕获并显示错误的最佳方法是什么？

> ID：332102
> 
> 赞同：2
> 
> 时间：2008-12-01T20:32:55.103
> 
> 标签：regex, django, validation, forms, field

在 Django 1.0 中，如果用户在表单字段中仅输入空格（“”），捕获并显示错误的最佳方法是什么？

```
class Item(models.Model):
    description = models.CharField(max_length=100)

class ItemForm(ModelForm):
    class Meta:
        model = Item 
```

如果用户在描述 CharField 中仅输入空格（“”），则需要对 Item 类或 ItemForm 类进行哪些更改，以便 form.is_valid() 失败并显示错误？

在 form.is_valid() 之后，我可以编写代码来仅检查描述字段中的空格并引发验证错误，但必须有更好的方法。可以使用 RegexField 指定输入的描述不应该只是空格。有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-02T03:26:13.787

```
class ItemForm(forms.ModelForm):
    class Meta:
        model = Item

    def clean_description(self):
        if not self.cleaned_data['description'].strip():
            raise forms.ValidationError('Your error message here') 
```

[表单验证文档](http://docs.djangoproject.com/en/dev/ref/forms/validation/#ref-forms-validation)可能会提供很好的阅读。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-02T14:13:15.337

弄清楚了。只需将**description = forms.RegexField(regex=r'[^(\s+)]')**添加到类 ItemForm 将导致 form.is_valid() 失败并显示错误

```
class ItemForm(ModelForm):
    description = forms.RegexField(regex=r'[^(\s+)]')
    class Meta:
        model = Item 
```

要包含您自己的消息，请将 error_message=... 添加到 forms.RegexField

```
description = forms.RegexField(regex=r'[^(\s+)]', error_message=_("Your error message here.")) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-02T14:15:25.863

为什么是正则表达式？仅用于`str.strip()`检查字符串是否仅包含空格

# css - Div 背景不与 Div 定位

> ID：332104
> 
> 赞同：1
> 
> 时间：2008-12-01T20:33:06.087
> 
> 标签：css, positioning, background-image

我有几个我使用类和 ID 设置样式的 Div，他 div 本身是空的，因为它们只是其背景的占位符。示例分区：

```
<div id='ranImg1' class='ranImg'></div> 
```

然后我使用这个 css 为它们设置样式：

```
.ranImg {
  position:fixed;
  z-index:0;
  width:250px;
  height:250px;
  display:block;
}
#ranImg1 {
  left:10px;
  top:200px;
  background-attachment:fixed;
  background-image:url(http://localhost/MyAlbum//images/background/ranPaperclips.png);
  background-repeat:no-repeat;
} 
```

只要 Div 位于文档的左上角，图像就会正确显示，但是当 Div 放置在页面上的其他位置时，图像会保持（不可见）在页面的左上角，仅显示与div（在示例中，这将是图像的底部）。

**编辑** 我试图在不影响我的其他布局的情况下定位这些 Div，它们位于其他布局的后面。除了背景图像不跟随 divs 位置这一事实之外，这有效。
所以基本上我的问题是，为什么 ranImg1 div 定位的背景不是 div 而是留在左上角，以及如何解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T20:59:49.573

您`background-attachment:fixed`将附加相对于浏览器窗口的背景图像。如果您希望它“跟随”该`div`位置，只需删除该行：

```
#ranImg1{
  left:10px;
  top:200px;
  background-image:url(http://localhost/MyAlbum//images/background/ranPaperclips.png);
  background-repeat:no-repeat;
} 
```

您还可以设置`background-position`属性以设置相对于包含 div 的背景：

```
background-position: 0px 0px; 
```

我不确定这是否有助于除了去除之外`background-attachment`（还没有足够的咖啡！）

# dotnetnuke - 算术运算导致溢出。DotNetNuke 4.5.1 存储库

> ID：332108
> 
> 赞同：1
> 
> 时间：2008-12-01T20:34:46.113
> 
> 标签：dotnetnuke

我收到此错误“算术运算导致溢出”。尝试在 DotNetNuke 的存储库模块中上传任何文件时。我正在使用 dotnetnuke 4.5.1 版。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-01T20:46:52.283

文件的大小是多少？您使用的是什么版本的存储库模块？

否则，一些一般性建议....

1.  尝试升级到最新支持的 Repository 和/或 DotNetNuke 版本。在 4.5.1 和 4.9.0（最新）之间的版本中有许多与安全和性能相关的修复。

2.  你也可以在 DotNetNuke.com 上发帖，因为我不确定有多少 DotNetNuke 人真的经常光顾这个网站，我在尝试让 DNN 讨论到这里时没有得到太多回应。

# apache - 带有目录异常的 URL 重写总括重定向

> ID：332109
> 
> 赞同：4
> 
> 时间：2008-12-01T20:35:04.523
> 
> 标签：apache, mod-rewrite

我有一个网站使用通用 mod_rewrite 规则将所有请求推送到 index.php 页面，但某些文件扩展名除外：

```
RewriteRule !\.(js|ico|gif|jpg|JPG|png|css|php|phtml|pdf|txt|xml)$ index.php 
```

我需要做的也是从该规则中排除某个目录（包括其中包含的任何文件或子目录）——最好的解决方案是什么？

这是我的完整 .htaccess 文件，以防其中的其他内容受到干扰：

```
RewriteEngine ON
RewriteCond %{HTTP_HOST} !^www\..*
RewriteCond %{HTTP_HOST}   !^$
RewriteCond %{HTTP_HOST} ^([^.]*)\.(co\.uk)
RewriteRule ^.*$     http://www.%1.%2%{REQUEST_URI} [R=permanent,L]

AddHandler application/x-httpd-php .phtml

RewriteRule !\.(js|ico|gif|jpg|JPG|png|css|php|phtml|pdf|txt|xml)$ index.phtml

php_value display_errors "On" 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-01T23:23:01.267

在您引用的行之前，例如，对于名为“样式”的目录，您需要：

```
RewriteRule  ^style/  -  [L] 
```

连字符表示“无重定向”，“[L]”表示“最后一条规则”，因为不要继续尝试将 URL 与以下规则匹配。您可以根据需要添加任意数量的这些行，但它们必须在您在问题中给出的行之前。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T20:57:37.177

您可以检查与`RewriteCond %{REQUEST_FILENAME} !-f`现有文件名不匹配的任何请求。

# c++ - 如何在 C++ 中将双精度数转换为字符串？

> ID：332111
> 
> 赞同：190
> 
> 时间：2008-12-01T20:35:29.247
> 
> 标签：c++, string, double

我需要将双精度存储为字符串。我知道`printf`如果我想显示它可以使用，但我只想将它存储在一个字符串变量中，以便以后可以将它存储在地图中（作为*value*，而不是*key*）。

* * *

## 回答 #1

> 赞同：213
> 
> 时间：2008-12-01T20:39:48.850

```
// The C way:
char buffer[32];
snprintf(buffer, sizeof(buffer), "%g", myDoubleVar);

// The C++03 way:
std::ostringstream sstream;
sstream << myDoubleVar;
std::string varAsString = sstream.str();

// The C++11 way:
std::string varAsString = std::to_string(myDoubleVar);

// The boost way:
std::string varAsString = boost::lexical_cast<std::string>(myDoubleVar); 
```

* * *

## 回答 #2

> 赞同：193
> 
> 时间：2008-12-01T20:42:11.263

*升压（tm）*方式：

```
std::string str = boost::lexical_cast<std::string>(dbl); 
```

*标准 C++*方式：

```
std::ostringstream strs;
strs << dbl;
std::string str = strs.str(); 
```

**注意**：不要忘记`#include <sstream>`

* * *

## 回答 #3

> 赞同：137
> 
> 时间：2011-11-04T19:09:27.623

*标准 C++11*方式（如果您不关心输出格式）：

```
#include <string>

auto str = std::to_string(42.5); 
```

[`to_string`](http://en.cppreference.com/w/cpp/string/basic_string/to_string)是[N1803](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1803.html) (r0)、[N1982](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2006/n1982.html) (r1) 和[N2408](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2408.html) (r2)“*简单数值存取*”中引入的新库函数。还有`stod`执行反向操作的功能。

如果您确实希望具有与 不同的输出格式`"%f"`，请使用`snprintf`or`ostringstream`其他答案中说明的方法。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2017-03-27T12:35:09.267

您可以在 C++11中使用[**std::to_string**](http://en.cppreference.com/w/cpp/string/basic_string/to_string)

```
double d = 3.0;
std::string str = std::to_string(d); 
```

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2008-12-01T20:41:01.703

如果您使用 C++，请避免使用`sprintf`. 它不是 C++y 并且有几个问题。Stringstreams 是选择的方法，最好像[Boost.LexicalCast](http://www.boost.org/doc/libs/1_37_0/libs/conversion/lexical_cast.htm)一样封装，这可以很容易地完成：

```
template <typename T>
std::string to_string(T const& value) {
    stringstream sstr;
    sstr << value;
    return sstr.str();
} 
```

用法：

```
string s = to_string(42.5); 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-12-01T20:41:52.993

`sprintf`没关系，但在 C++ 中，更好、更安全且速度稍慢的转换方法是`stringstream`：

```
#include <sstream>
#include <string>

// In some function:
double d = 453.23;
std::ostringstream os;
os << d;
std::string str = os.str(); 
```

您还可以使用[Boost.LexicalCast](http://www.boost.org/doc/libs/1_37_0/libs/conversion/lexical_cast.htm)：

```
#include <boost/lexical_cast.hpp>
#include <string>

// In some function:
double d = 453.23;
std::string str = boost::lexical_cast<string>(d); 
```

在这两种情况下，`str`都应该在`"453.23"`之后。LexicalCast 有一些优点，它可以确保转换是完整的。它在内部使用`stringstream`s。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2015-06-08T15:48:50.393

我会看看[C++ String Toolkit Libary](http://www.partow.net/programming/strtk/index.html)。刚刚在其他地方发布了类似的答案。我发现它非常快速和可靠。

```
#include <strtk.hpp>

double pi = M_PI;
std::string pi_as_string  = strtk::type_to_string<double>( pi ); 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-09-22T15:29:59.147

lexical_cast 的问题是无法定义精度。通常，如果您要将双精度数转换为字符串，那是因为您想将其打印出来。如果精度太大或太小，都会影响您的输出。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-12-01T20:37:46.280

您也可以使用[stringstream](http://www.cplusplus.com/reference/iostream/stringstream/)。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-01T20:41:21.170

嘿，我刚刚写了这个（与这个问题无关）：

```
string temp = "";
stringstream outStream;
double ratio = (currentImage->width*1.0f)/currentImage->height;
outStream << " R: " << ratio;
temp = outStream.str();

/* rest of the code */ 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-01T20:37:06.343

看看`sprintf()`和家人。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-02T06:48:50.883

[您可能想阅读我之前在 SO 上的帖子。（带有临时 ostringstream 对象的宏版本。）](https://stackoverflow.com/questions/303562/c-format-macro-inline-ostringstream#306053)

作为记录：在我自己的代码中，我喜欢 snprintf()。使用本地堆栈上的 char 数组，它并不是那么低效。（好吧，也许如果您超出了数组大小并循环执行两次...）

（我还通过 vsnprintf() 包装了它。但这需要我进行一些类型检查。如果你想要代码，请叫喊......）

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-11-21T14:42:15.867

Normaly 对于此操作，您必须使用 ecvt、fcvt 或 gcvt 函数：

```
/* gcvt example */
#include <stdio.h>
#include <stdlib.h>

main ()
{
  char buffer [20];
  gcvt (1365.249,6,buffer);
  puts (buffer);
  gcvt (1365.249,3,buffer);
  puts (buffer);
  return 0;
}

Output:
1365.25
1.37e+003 
```

作为一个函数：

```
void double_to_char(double f,char * buffer){
  gcvt(f,10,buffer);
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-05-08T15:02:47.563

请注意，字符串只是双精度的表示，将其转换回双精度可能不会产生相同的值。另请注意，默认字符串转换可能会将转换修剪到一定的精度。在标准 C++ 方式中，您可以按如下方式控制精度：

```
#include <sstream>
#include <math.h>
#include <iostream>
#include <iomanip>

int main()
{
    std::ostringstream sout;
    sout << M_PI << '\n';
    sout << std::setprecision(99) << M_PI << '\n';
    sout << std::setprecision(3) << M_PI << '\n';
    sout << std::fixed; //now the setprecision() value will look at the decimal part only.
    sout << std::setprecision(3) << M_PI << '\n';
    std::cout << sout.str();
} 
```

这会给你输出

```
3.14159                                                                                                                                                                            
3.141592653589793115997963468544185161590576171875                                                                                                                                 
3.14                                                                                                                                                                               
3.142 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-02-11T16:55:15.217

使用`to_string()`.
例子 ：

```
#include <iostream>   
#include <string>  

using namespace std;
int main ()
{
    string pi = "pi is " + to_string(3.1415926);
    cout<< "pi = "<< pi << endl;

  return 0;
} 
```

自己运行：http: [//ideone.com/7ejfaU](http://ideone.com/7ejfaU)
这些也可用：

```
string to_string (int val);
string to_string (long val);
string to_string (long long val);
string to_string (unsigned val);
string to_string (unsigned long val);
string to_string (unsigned long long val);
string to_string (float val);
string to_string (double val);
string to_string (long double val); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-04-10T23:36:13.863

您可以尝试更紧凑的样式：

```
std::string number_in_string;

double number_in_double;

std::ostringstream output;

number_in_string = (dynamic_cast< std::ostringstream*>(&(output << number_in_double <<

std::endl)))->str(); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-12-05T06:11:29.623

您可以使用此功能将任何事物转换为任何事物：

```
template<class T = std::string, class U>
T to(U a) {
    std::stringstream ss;
    T ret;
    ss << a;
    ss >> ret;
    return ret;
}; 
```

用法 ：

```
std::string str = to(2.5);
double d = to<double>("2.5"); 
```

# c# - 在 WinForms 应用程序中嵌入视频

> ID：332117
> 
> 赞同：12
> 
> 时间：2008-12-01T20:38:34.983
> 
> 标签：c#, winforms, video

我需要能够使用 C# 在 WinForms 应用程序中嵌入和控制 AVI 文件的播放。视频需要嵌入到表单中，而不是在单独的媒体播放器窗口中启动。

这样做的最佳方法是什么？我找到了 System.Media 命名空间，这听起来很有希望，但似乎只对声音有用。

我是否使用 DirectX 来执行此操作？微信？还是其他方法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-01T20:41:55.210

您可以在 Winform中使用[媒体播放器。](http://msdn.microsoft.com/en-us/library/bb249260(VS.85).aspx)这将是一个简单的方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-05-23T22:15:37.123

我这样做的方式是，我引用：

> 右键单击工具箱，然后单击选择项目。
> 
> 注意：如果您没有看到工具箱，请单击视图菜单上的工具箱将其打开。“自定义工具箱项目”对话框打开。
> 
> 在 COM 组件选项卡上，选中 Windows Media Player 复选框，然后单击确定。
> 
> Windows Media Player 控件出现在当前的工具箱选项卡上。
> 
> 当您将 Windows Media Player 控件添加到工具箱时，Visual Studio 会自动添加对两个库的引用：AxWMPLib 和 WMPLib。下一步是将控件添加到 Windows 窗体。
> 
> 将 Windows Media Player 控件添加到 Windows 窗体
> 
> 将 Windows Media Player 控件从工具箱拖到 Windows 窗体。
> 
> 在“属性”窗口中，将 Dock 属性设置为 Fill。您可以通过单击中心方块来执行此操作。
> 
> 双击窗体的标题栏，在代码编辑器中添加默认的 Load 事件。
> 
> 将以下代码添加到 Form_Load 事件处理程序以在应用程序打开时加载视频。

```
axWindowsMediaPlayer1.URL = 
    @"http://go.microsoft.com/fwlink/?LinkId=95772"; 
```

[http://msdn.microsoft.com/en-us/library/bb383953(v=vs.90).aspx](http://msdn.microsoft.com/en-us/library/bb383953(v=vs.90).aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-01T21:00:09.230

我强烈推荐这个库：

[http://directshownet.sourceforge.net/](http://directshownet.sourceforge.net/)

它是 DirectShow API 的 .NET 包装器。

（示例应用程序应该让您快速上手。）

——布鲁斯

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T20:55:38.537

[Daok](https://stackoverflow.com/questions/332117/embedding-video-in-a-winforms-app#332131)和[Brian Genisio](https://stackoverflow.com/questions/332117/embedding-video-in-a-winforms-app#332141)的建议都是不错的选择。让我添加第三个：DirectShow。曾经是 DirectX 的一部分，但现在已升级为 Windows SDK。有许多不错的 C# 示例应用程序可供查看，并且可以完全控制播放。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-01T20:45:41.240

我会**考虑**使用 WPF 媒体控件，只需使用 ElementHost 将您的 WPF 控件放入您的 WinForms 应用程序中。我想你会得到更丰富的体验。

有关详细信息，请参阅[System.Windows.Forms.Integration](http://msdn.microsoft.com/en-us/library/system.windows.forms.integration.aspx)

# iphone - iPhone 视频缓冲区

> ID：332120
> 
> 赞同：3
> 
> 时间：2008-12-01T20:39:28.990
> 
> 标签：iphone

我正在尝试在不越狱 iPhone 的情况下构建录像机（我有开发人员许可证）。我开始使用 PhotoLibrary 私有框架，但我只能达到 2ftp（太慢）。Cycoder 应用程序的 fps 为 15，我认为它使用了不同的方法。我试图从 CameraController 的 previewView 创建一个位图，但它总是返回 e 黑色位图。

我想知道是否有办法直接访问视频缓冲区，也许是 IOKit 框架。

谢谢马可

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T14:55:17.590

这是代码：

```
image = [window _createCGImageRefRepresentationInFrame:rectToCapture]; 
```

马可

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-02T12:10:18.097

那是个大问题。到目前为止，我已经解决了使用一些临时固定大小的缓冲区，并在每个缓冲区已满时为每个缓冲区分离一个线程。线程将缓冲区内容保存在闪存中。启动一些繁重的线程，很重，因为每个线程都访问闪存，会减慢设备速度和相机视图的刷新。缓冲区不能大，因为你会收到内存警告，不能小，因为你会冻结设备，因为太多的线程和一次对闪存的访问。解决方案在于平衡缓冲区大小和线程数。

我还没有尝试使用 sqlite3 db 来存储图像二进制数据，但我不认为这会是一个更好的解决方案。

PS：为了加快类方法调用，避免因为方法调用的工作原理而使用常见的解决方案【对象方法】，而是尝试获取并保存方法地址如下。

来自 Apple ObjC 文档：

“下面的示例显示了如何调用实现 setFilled: 方法的过程：

```
void (*setter)(id, SEL, BOOL); 
int i; 
setter = (void (*)(id, SEL, BOOL))[target methodForSelector:@selector(setFilled:)]; 
for ( i = 0; i < 1000, i++ ) 
setter(targetList[i], @selector(setFilled:), YES); " 
```

马可

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T21:17:30.957

如果您打算在 App Store 上发布您的应用程序，使用私有框架将确保它会被拒绝。根本不支持使用 SDK 的视频。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-02T21:02:58.910

要捕获在相机处于活动状态时可以看到的视频，需要相当复杂的技术，而不是由任何开箱即用的框架/lib 暴露。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-02T22:23:54.740

我使用了一个未记录的 UIWindow 方法来获取当前显示的帧作为 CGImageRef。现在它成功运行了！！

如果您愿意，并且如果我被允许，我可以发布可以解决问题的代码。

马可

# svn - 延迟或重复 GNU make 中的先决条件

> ID：332122
> 
> 赞同：2
> 
> 时间：2008-12-01T20:39:39.847
> 
> 标签：svn, makefile

我正在尝试将我的 Subversion 修订号嵌入到 C++ 项目中，并且在设置 GNU make 时遇到问题。我的 makefile 目前看起来像这样：

```
check-svnversion:
  ../shared/update-svnversion-h.pl

../shared/svnversion.h: check-svnversion

shared/svnversion.o: ../shared/svnversion.h

.PHONY: check-svnversion 
```

`svnversion.o`取决于`svnversion.cpp`（通过模式规则）和`svnversion.h`（明确列出，因为依赖检查由于某种原因没有捡起它）。 `svnversion.h`由`update-svnversion-h.pl`脚本创建和维护（基本上只是运行`svnversion`并将输出转换为 C++ 文件）。

目前，我必须运行`make`两次才能使文件保持最新。第一次，`make`运行`update-svnversion-h.pl`（因为它被列为先决条件）但不检查`svnversion.h`之后的时间戳以查看它是否被 更改`update-svnversion-h.pl`，因此它不会重新制作`svnversion.o`。第二次，它确实检查了时间戳，`update-svnversion-h.pl`无论如何都会运行（这次它什么都不做，因为`svnversion.h`它是最新的），然后重新编译`svnversion.cpp`为 make `svnversion.o`。

有没有办法告诉 GNU make 两次评估单个先决条件或延迟检查先决条件的时间戳，直到该先决条件的命令完成后？

或者，有没有更好的方法在我的源代码中嵌入修订号？（为了速度，我试图避免在每次构建时都需要重新编译的解决方案。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-02T01:20:24.273

这似乎类似于[autotools](http://en.wikipedia.org/wiki/autotools)对其 config.h 头文件所做的事情。

快速浏览一下 automake`remake-hdr.am`就可以看出它是如何做到的：

```
%CONFIG_H%: %STAMP%
## Recover from removal of CONFIG_HEADER
    @if test ! -f $@; then \
      rm -f %STAMP%; \
      $(MAKE) $(AM_MAKEFLAGS) %STAMP%; \
    else :; fi

%STAMP%: %CONFIG_H_DEPS% $(top_builddir)/config.status
    @rm -f %STAMP%
    cd $(top_builddir) && $(SHELL) ./config.status %CONFIG_H_PATH% 
```

并`config.status`创建印章文件。

这个 automake 示例和您的示例之间的主要区别似乎是 automake 涉及戳文件，而在您的示例中它甚至不是真实文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-28T14:47:07.640

这是我放入 make 文件中的目标。它创建了几个函数，这些函数将各种构建遥测作为字符串返回。好消息是遥测代表上次链接的时​​间，而不是构建对象的时间。

```
##
## on every build, record the working copy revision string
##
svn_version.c: $(C_SRC:.c=.o) Makefile
    @echo -n 'const char* build_date(void);\n'  > $@
    @echo -n 'const char* build_date(void)\n{ static const char* build_date = __DATE__ ; '  >> $@
    @echo 'return build_date; }\n'                                                          >> $@
    @echo -n 'const char* build_time(void);\n'                                              >> $@
    @echo -n 'const char* build_time(void)\n{ static const char* build_time = __TIME__ ; '  >> $@
    @echo 'return build_time; }\n'                                                          >> $@
    @echo -n 'const char* svnid_build(void);\n'                                             >> $@
    @echo -n 'const char* svnid_build(void)\n{ static const char* SVN_Version = "\\n<SVN_PID>'    >> $@
    @svnversion -cn .                                                                       >> $@
    @echo '</svn_pid>\\n"; return SVN_Version; }\n'                                         >> $@
    @echo -n 'const char* svnid_build_str_only(void);\n'                                    >> $@
    @echo -n 'const char* svnid_build_str_only(void)\n{ static const char* SVN_Version = "' >> $@
    @svnversion -cn .                                                                       >> $@
    @echo '"; return SVN_Version; }\n'                                                      >> $@
    @$(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c -o $(@:.c=.o) $@ 
```

确保用简单的“svn_version.c”替换对最终目标中目标文件的依赖。前任。

```
final-target: svn_version.c
    $(CC) $(C_SRC:.c=.o) $(<:.c=.o) -o $@ 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T20:58:37.033

您可以使用 Subversion 的关键字替换将版本号放入您的代码中。

[在书中] 很详细，但简而言之，您必须设置`svn:keywords`要包含的文件的属性，`Rev`然后将其`$Rev$`放在代码中的某个位置。SVN 会自动将其替换为`$Rev: #$`，其中`#`是修订号。您必须解析结果字符串以获取您的实际数字，但它应该很容易解析（只需删除前六个字符和最后一个字符）。

请注意，这是该文件的最后更改版本，而不是 repo 的最后更改版本。这在书页上稍微复杂和详细。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-02T20:03:52.947

我通过让我的 check-svnversion 规则删除 svnversion.o 来解决这个问题，以便在需要时强制重新编译它。这并不完全优雅，但它有效；它看起来类似于[CesarB 的回答](https://stackoverflow.com/questions/332122/delaying-or-repeating-a-prerequisite-in-gnu-make#332756)中描述的 autotools 解决方案。

```
../shared/svnversion.h: check-svnversion

check-svnversion:
    ../shared/update-svnversion-h.pl
    @#Force recreation of svnversion.o.  Otherwise, make won't notice that
    @#svnversion.h has changed until the next time it's invoked.
    @if [ ../shared/svnversion.h -nt shared/svnversion.o ] ; then rm shared/svnversion.o ; fi

shared/svnversion.o: ../shared/svnversion.h

.PHONY: check-svnversion 
```

# .net - 如何在没有 .NET SDK 或 Visual Studio 的情况下安装 .net dll？

> ID：332125
> 
> 赞同：2
> 
> 时间：2008-12-01T20:40:49.707
> 
> 标签：.net, dll, deploying

我需要部署一些 .net dll。它们需要放在 GAC 中，并且所需的条目需要在注册表中。在我的机器上，我同时运行了 SDK 和 Visual Studio，所以目前我正在使用 gacutil 和 regasm 等 .net sdk 工具。但是，当我需要在客户机器上安装这些 dll 时，我应该怎么做。我可以通过拥有 .net 运行时来实现这一点吗？我目前正在使用.net 2.0。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-01T20:47:02.237

执行此操作的“正确”方法是使用 MSI（通过制作 MSI 文件的各种方法之一 - 如 WiX）

这可能对您有用：

[http://blogs.msdn.com/astebner/archive/2006/11/04/why-to-not-use-gacutil-exe-in-an-application-setup.aspx](http://blogs.msdn.com/astebner/archive/2006/11/04/why-to-not-use-gacutil-exe-in-an-application-setup.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T20:46:16.963

好吧，对于将要坐在另一台机器前面的人来说，最简单的方法当然是安装程序。

我相信大多数 VS 版本都有某种安装程序支持，您可以在其中创建一个安装项目，该项目最终以 .exe 和 .msi 文件的形式出现，您可以使用它们来安装您的软件，然后您将基本上得到您需要的一切，诸如桌面/开始菜单快捷方式、GAC 支持、卸载、下载 .NET 运行时（如果需要）等。

检查 Visual Studio 中的新项目对话框，我相信你会在那里找到有用的东西，如果没有，那么我很确定这里有人可以为你指明正确的方向。

另一方面，如果你想走手动路线，那么一些 .NET 工具安装在 C:\Windows\Microsoft.NET\Framework\version 下的 .NET 目录中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T20:48:45.540

最可靠的方法是使用您的设置项目。打开项目的文件系统视图，添加特殊文件夹“全局程序集缓存”，并将程序集添加到其中，然后构建安装项目，一切顺利。

如果您不使用设置项目，我真的不知道...

# http - YAML 媒体类型？

> ID：332129
> 
> 赞同：140
> 
> 时间：2008-12-01T20:41:51.543
> 
> 标签：http, mime, mime-types, yaml

当通过 HTTP 发送使用 YAML 结构化的数据时，最合适的媒体类型（正式 MIME 类型）是什么？为什么？

我看不到已注册的[应用程序类型](http://www.iana.org/assignments/media-types/application/)或[文本类型](http://www.iana.org/assignments/media-types/text/)。

例子：

```
> GET /example.yaml

< Content-Type: ????
<
< --- # Favorite movies
< - Casablanca
< - North by Northwest
< - Notorious 
```

可能的选项：

*   文本/x-yaml
*   文本/yaml
*   文本/yml
*   应用程序/x-yaml
*   应用程序/x-yml
*   应用程序/yaml
*   应用程序/yml

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2008-12-01T20:50:18.343

Ruby on Rails`application/x-yaml`与`text/yaml`( [source](https://github.com/rails/rails/blob/d41d586/actionpack/lib/action_dispatch/http/mime_types.rb#L39) ) 一起使用。

我认为这只是惯例问题，据我所知，没有*技术原因。*

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2016-06-23T20:13:06.637

尽管接受了另一个答案，但请参阅IANA 邮件列表上的[YAML 线程提议的媒体类型注册，](https://www.ietf.org/mail-archive/web/media-types/current/msg00688.html)以审查媒体类型，其中剑桥大学信息服务部的 Ben Harris于 2015 年 7 月代表 YAML 团队**提议**媒体类型：

```
text/vnd.yaml 
```

带有（建议的）不推荐使用的别名：

```
text/yaml
text/x-yaml
application/x-yaml 
```

那仍然是提议/待定的（线程不指示提议的状态）所以这个答案并不比其他答案更确定:-)

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-12-01T20:50:50.030

我会说`text/x-yaml`：

`text`结束，`application`因为它是人类可读的

`x-yaml`结束，`yaml`因为它尚未被接受到已注册的 mime 类型列表中。

编辑：来自 RFC 3023（XML 媒体类型）：

> 顶级媒体类型“文本”对 MIME 实体有一些限制，它们在 [RFC2045] 和 [RFC2046] 中有描述。特别是，不允许使用 UTF-16 系列、UCS-4 和 UTF-32（HTTP[RFC2616] 除外，它使用类似 MIME 的机制）。

有趣...不完全确定这意味着什么，但值得深思。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2020-06-17T12:33:32.913

在 Chrome`application/yaml`上将下载，同时`text/yaml`将显示。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-06-24T15:04:12.250

不鼓励使用“x-”媒体类型，请参阅[RFC 4288，第 3.4 节](https://www.rfc-editor.org/rfc/rfc4288#section-3.4)。正确的做法是使用个人树、供应商树或实际尝试正确的媒体类型注册。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-11-08T11:51:27.460

根据[MIME 类型列表](https://www.freeformatter.com/mime-types-list.html)，它是`text/yaml`，即使它不在官方[IANA MIME 列表中](https://www.iana.org/assignments/media-types/media-types.xhtml#text)

# mysql - 远程存储文本文件的最佳方式是什么？

> ID：332134
> 
> 赞同：1
> 
> 时间：2008-12-01T20:43:48.857
> 
> 标签：mysql, database, text

我正在构建一个“文档存储”系统，用于在我的服务器上存储文本文件。我想知道是否有人对远程存储文本文件的最佳方式有任何建议或最佳实践。

该系统将以用户为基础，每个用户可以上传多个文本文件。我希望以某种易于执行全文搜索的方式存储文本文件。

我使用的服务器是标准的 Web 服务器，具有多种脚本语言和 MySQL 数据库支持。

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T20:47:47.320

我会将它们存储在数据库中并使用 MySQL 中的全文搜索。当然，您必须至少安装 MySQL 3.23.23（此时添加了对全文搜索的支持。）。

# .net - Datagridview - 检查最后一列是否完全显示

> ID：332138
> 
> 赞同：1
> 
> 时间：2008-12-01T20:44:44.363
> 
> 标签：.net, datagridview

我想知道是否有办法确定最后一列是否完全显示。

我知道列上有一个 Displayed 属性，但如果该列部分或全部显示，则该属性为真。如果该列完全显示，我只想要它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T21:27:57.957

这将做到：

```
Function IsFullyVisible(ByVal dg As DataGridView, ByVal columnindex As Integer) As Boolean  

    Return dg.GetColumnDisplayRectangle(columnindex, False).Width = dg.GetColumnDisplayRectangle(columnindex, True).Width

End Function 
```

通过 IsFullyVisible(DataGridView1, DataGridView1.ColumnCount - 1) 调用它以获取最后一列是否完全可见。

# servlets - Apache Commons HTTPClient 3.x 保持连接打开

> ID：332143
> 
> 赞同：1
> 
> 时间：2008-12-01T20:46:16.013
> 
> 标签：servlets, gwt-rpc, apache-commons-httpclient

我正在使用 HttpClient 对远程 servlet 执行 PostMethod，由于某种原因，我的许多连接都处于打开状态并占用了我所有服务器的连接。
这是有关架构的更多信息
GWT 客户端调用 GWT 服务
GWT 服务实例化一个 HttpClient，创建一个 PostMethod 并让客户端执行该方法
，然后通过调用 method.getResponseBodyAsStream() 获取输入流并将其写入字节数组
然后它关闭输入流并刷新字节数组输出流，再执行几行代码，然后调用 method.releaseConnection()

必须有一些明显的我忽略的东西导致了这种情况。如果我在浏览器中对同一服务执行 GET，则连接会立即关闭，但有关 HTTPClient 的某些内容会导致它们挂起。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-02T08:17:26.383

您需要调用 HttpMethodBase#releaseConnection()。如果你返回一个 InputStream 供以后使用，一个简单的方法是通过一个匿名的 FilterInputStream 覆盖 close() 来包装它：

```
final HttpMethodBase method = ...;
return new FilterInputStream(method.getResponseBodyAsStream())
{
  public void close() throws IOException
  {
    try {
      super.close();
    } finally {
      method.releaseConnection();
    }
  }
}; 
```

# iis - IIS、XP、SSL 与 KeepAlives

> ID：332145
> 
> 赞同：0
> 
> 时间：2008-12-01T20:46:43.047
> 
> 标签：iis, ssl, windows-xp, keep-alive

我被困在岩石和坚硬的地方之间。我正在使用 Studio 2005/IIS 在 XP 上进行开发。到目前为止，这对我来说一直没有问题，直到今天。

我需要添加一个 SSL 证书，以便我可以使用仅在安全模式下允许的会话来完成在 SSL 中运行的部分站点的开发。

因此，我安装了证书并在调试模式/F5 下启动了工作室，并使用浏览器访问了一个安全页面。页面在使用 https 时加载一些图像，而不是其他图像，并且启用了保持活动。关闭保持活动，并且所有页面图像都会在每个请求上加载，但工作室不会附加调试器以抱怨身份验证失败。重新打开keep alives，工作室会调试得很好，但图像会很糟糕。

我确定这是在 XP 中对 IIS 施加的连接限制。这种疯狂有办法解决吗？翻转复选框以完成工作正在扼杀我的理智。Vista 和/或服务器操作系统是不可能的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-02T04:23:41.707

您可以将 MaxConnections 值更改为更高的值：

```
C:\Inetpub\scripts>adsutil.vbs get W3SVC/MaxConnections
MaxConnections                  : (INTEGER) 10
C:\Inetpub\scripts>adsutil.vbs set W3SVC/MaxConnections 100
MaxConnections                  : (INTEGER) 100 
```

# project-management - 您对 SEI 的团队软件流程有什么看法吗？

> ID：332161
> 
> 赞同：2
> 
> 时间：2008-12-01T20:50:42.913
> 
> 标签：project-management, process, lifecycle

我组织内的某个人已经开始推动我们试行 CMU SEI 的 TSP 流程（请参阅[此处](http://www.sei.cmu.edu/tsp/)的网站）。我本能地厌恶任何用字母汤来治愈软件开发疾病的尝试，但我想知道是否有人对此过程有经验并且可以提供切实的事实。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T22:13:53.637

我曾经是 SEI 的 CMM 的粉丝。我什至阅读了 Watts Humphrey 的“管理软件过程”一书的封面。我没有使用过 TSP，但我怀疑它与其他软件进程有相似的优势和劣势。

一定要阅读它以及他们声称它可以做什么以及如何实现它，但要保持警惕，保持你的软件过程小而灵活。您需要一个，但要小心从其他人那里获取流程。

祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-25T21:25:28.667

我们已经使用这个过程几个月了，我并没有特别印象深刻。此过程仅适用于程序员本质上是 bean 计数器的严格命令和控制风格的管理。这个过程的大部分好的部分（大小估计而不是时间估计、自我审查、详细计划、根据计划记录时间以及记录缺陷和错误以供以后审查）都可以在不向 SEI 投入大量资金的情况下实施.

# java - Java 最好的漂亮打印库？

> ID：332166
> 
> 赞同：8
> 
> 时间：2008-12-01T20:52:23.223
> 
> 标签：java, io, pretty-print

最好的 Java 打印库是什么？我的意思是一个用于打印带有缩进、中断提示等的格式化输出的库，*而不是*一个用于美化/重新格式化 Java 代码本身的库。理想情况下，图书馆会`System.out.println`与朋友“玩得开心”。

有关我在寻找什么的想法，请参阅 OCaml 的[Format 模块](http://batteries.forge.ocamlcore.org/doc.preview/batteries-alpha2/doc/batteries/html/api/Languages.Format.html)，特别是[Format.fprintf](http://batteries.forge.ocamlcore.org/doc.preview/batteries-alpha2/doc/batteries/html/api/Languages.Format.html#VALfprintf)。

[更新] 我不是在寻找控制台窗口库。漂亮的打印库允许您定义格式化任意值的方法，以便保留缩进并在合理的位置选择换行符。[Haskell](http://www.haskell.org/ghc/docs/latest/html/libraries/haskell-src/Language-Haskell-Pretty.html)、[Standard ML](http://smlnj.org/doc/Compiler/pages/prettyprint.html)、[OCaml](http://batteries.forge.ocamlcore.org/doc.preview/batteries-alpha2/doc/batteries/html/api/Languages.Format.html)、[F#](http://www.intellifactory.com/articles/PrettyPrinter.aspx)和[Scheme](http://www.cs.aau.dk/~normark/scheme/lib/man/scheme-pretty-printing.html)存在此类库。[XTC](http://cs.nyu.edu/rgrimm/xtc/)`xtc.tree.Printer`库以.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T20:53:28.650

是[jpplib](http://jpplib.sourceforge.net/)吗？

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-02T14:04:57.803

你也可以试试[javacurses](http://sourceforge.net/projects/javacurses/)。

根据[Dobb 博士的 Code Talk](http://dobbscodetalk.com/index.php?option=com_myblog&show=Curses-in-Java.html&Itemid=29)，它很可爱。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-01T21:45:09.187

由于您谈论框、中断提示等，我假设您的意思是构建一个基于文本的窗口应用程序。所以我猜你正在寻找类似于[Ncurses](http://en.wikipedia.org/wiki/Ncurses)但在 Java 中的东西。也许[charva](http://www.pitman.co.za/projects/charva/Screenshots.html)可以帮助你。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2011-06-15T22:31:47.033

我想说使用 Xalan + Sax 更容易，就像在[这个例子](https://stackoverflow.com/questions/139076/how-to-pretty-print-xml-from-java)中一样。

# sql-server - 重命名 sql server 实例

> ID：332167
> 
> 赞同：5
> 
> 时间：2008-12-01T20:52:36.360
> 
> 标签：sql-server

是否可以更改 sql server 实例名称？还是只能在安装过​​程中设置？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-01T20:57:28.143

据我所知，它们只能在安装时更改。您可以在保留当前信息的同时使用安装程序包更改名称。我会备份你所有的数据库，然后试试这个。

另一方面，更改实例名称只会让您非常头疼。即使你能做到，我强烈建议你一个人呆着。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T22:53:27.303

您不能重命名**实例**，但可以重命名服务器（仅限 sql2000）——这有帮助吗？

看一下：

```
sp_dropserver 'oldname', 'droplogins' 
```

接着;

```
sp_addserver 'newname', local 
```

请注意，如果该服务器上正在运行任何作业，它们也需要重命名；

```
use msdb
go

update sysjobs set originating_server = 'newname' 
```

您需要重新启动 SQL Server

# c# - 有谁知道 System.Windows.Forms.Timer 通常如何影响主机应用程序和系统？

> ID：332168
> 
> 赞同：1
> 
> 时间：2008-12-01T20:52:38.417
> 
> 标签：c#, timer, cpu-usage

有谁知道 a`System.Windows.Forms.Timer`一般如何影响主机应用程序和系统？

一方面，线程化的后台循环具有非常高的 CPU 使用率，而`Timer`具有非常高的滴答率的循环在 Windows 任务管理器中没有任何效果。

高滴答率计时器是否会使 Windows 消息循环混乱，或者？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T21:08:10.320

定义“高滴答率计时器”:)。

依赖于 WM_TIMER 的计时器组件（例如 Windows.Forms 之一）的问题是多方面的：

*   您永远*无法*获得超过 50 毫秒的分辨率。
*   如果您的系统处于负载状态（例如重绘、在 RDP 链接上运行等），您可能每 500 毫秒或更长时间收到一次 WM_TIMER 消息，无论您设置的间隔有多低。
*   WM_TIMER 消息是合成消息，如果您的消息队列被其他消息淹没，则可能在很长一段时间内根本无法传递到您的应用程序。
*   如果您的计时器方法执行时间超过一个计时器间隔，计时器将“跳过”该消息，即在您从第一个返回之前您不会收到另一个 WM_TIMER 消息。换句话说，您永远不会依次收到两个 WM_TIMER 消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T20:58:10.810

总的来说，我没有注意到在我的应用程序中使用计时器组件有很多负面影响，它们比其他一些方法更有效，并且在资源上更好。

我发现微软的这篇[定时器比较](http://msdn.microsoft.com/en-us/magazine/cc164015.aspx)文章在比较这些类型的东西时也很有帮助。

但总而言之，它们似乎并没有乱七八糟。

# seo - “站点停机维护”页面会破坏 SEO 吗？

> ID：332174
> 
> 赞同：14
> 
> 时间：2008-12-01T20:55:24.310
> 
> 标签：seo, upgrade, maintenance

在您对生产环境进行主要代码发布和/或数据库架构更改的情况下，在升级发生时放置“Gone Fishin”页面是否对 SEO 有害？

假设在升级过程中使用旧的代码/数据库模式可能会使升级后的数据库进入不良/未知状态。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-01T20:58:54.600

不，如果您确保发送正确的 HTTP 标头，则不会。不要发送 200 OK，因为这会使搜索引擎索引您的错误消息。

我建议发送“503 服务不可用”以及解释您为什么会停机以及停机多长时间的文本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T21:03:41.297

有关 HTTP 状态代码的列表，请参阅：

[http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)

维修专用：

**10.5.4 503 服务不可用**

由于服务器临时过载或维护，服务器当前无法处理请求。这意味着这是一种暂时的情况，经过一段时间的延迟会得到缓解。如果已知，延迟的长度可以在 Retry-After 标头中指示。如果没有给出 Retry-After，客户端应该像处理 500 响应一样处理响应。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T20:58:36.940

“站点停机维护”页面将存在多长时间？如果只有一天就好了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T20:59:45.767

通常这是在短时间内（6-12 小时以下）完成的。我从来没有注意到这是一个问题的情况，因为 google bot 看到了内容的巨大变化，并且它似乎基本上像访问者一样稍后回来。现在这不是官方评论，只是我在我的网站上注意到的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-01T21:01:21.443

它要么必须：

*   是一个很长的升级，或者
*   升级时让蜘蛛尝试您的网站会很不幸

但是，如果您要超过半天到一天，请考虑以下事项：

我会认真建议扔掉除 200 响应代码之外的其他内容。如果蜘蛛命中并且您的服务器发出 503（服务不可用）代码，它很可能会在稍后或另一天再次出现。

如果它得到 200，它可能会假设您的网站已更改并更改其索引。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-01T21:14:58.187

就像其他人所说，返回适当的错误代码。返回 40x（不是 404）或 50x 代码。不要重定向到“维护”页面，或返回带有静态维护页面的 200。

我不时在 Google 上看到一些页面被缓存为“停机维护”或其他内容。

# php - 在生产服务器上抑制 php 错误的最佳方法

> ID：332178
> 
> 赞同：25
> 
> 时间：2008-12-01T20:56:15.977
> 
> 标签：php, error-handling

隐藏 php 错误以免在浏览器上显示的最佳方法是什么？

是否会使用以下内容：

```
ini_set("display_errors", 1); 
```

任何最佳实践技巧也将不胜感激！

我正在记录错误，我只是想确保将 display_errors 值设置为 off（或 0）不会阻止记录错误。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-12-01T21:02:21.457

最好的方法是记录您的错误，而不是显示或忽略它们。

此示例将错误记录到 syslog，而不是在浏览器中显示它们。

```
ini_set("display_errors", 0);
ini_set("log_errors", 1);

//Define where do you want the log to go, syslog or a file of your liking with
ini_set("error_log", "syslog"); // or ini_set("error_log", "/path/to/syslog/file"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T22:32:23.880

假设您可以控制 php.ini 文件，您可以在该文件中全局进行这些更改，而不是将 ini_set 代码放在所有 php 文件中（有一天您可能会忘记放入其中一个文件，这可能在生产中不好）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-01T22:36:28.957

您还可以使用 apache .htaccess 来记录错误，而无需接触您的代码：

```
<IfModule mod_php5.c>
  php_flag      display_errors  Off
  php_flag      log_errors      On
  php_value     error_log       logs/errors
</IfModule> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-02T19:02:30.403

在您的开发机器上设置环境变量。然后您可以在代码开头检查您的环境，以确保您在开发环境中。然后您可以使用 error_reporting() 函数设置 PHP 的错误报告级别。

```
if ( isset($_ENV['MY_APP_MODE']) && ($_ENV['MY_APP_MODE'] == 'devel') ) {
    error_reporting(E_ALL);
} else {
    error_reporting(0);
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-02-10T16:25:00.800

在 PHP 7.1 上，接受的答案对我来说根本不起作用。

这在生产中按预期工作，将错误记录到提供的文件中并且不向用户显示它们：

```
 ini_set('display_errors', 'Off');
    ini_set('log_errors', 'On');
    ini_set("error_log", "/absolute/path/to/my/error_log"); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-02T05:36:39.560

不幸的是，PHP 分发文件发送了一条关于处理错误消息的混合消息。默认的 php.ini 文件有一些适合生产服务器的设置，还有一些更适合开发服务器的设置。您应该在 dev （`error_reporting = E_ALL`和`display_errors = On`）中打开所有错误，并在 prod 中关闭（`display_errors = off`但指向`log_errors`某个地方）。但是，请尽力确保没有错误（或已处理）。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-01T22:42:15.827

最好的办法？修正错误！

如果您需要一个快速的临时解决方案，则可以关闭 display_errors，但请确保您将它们记录在某个地方，因为该设置将使严重/解析错误保持沉默。

# version-control - 如何在 CVS 存储库中搜索特定文件？

> ID：332193
> 
> 赞同：3
> 
> 时间：2008-12-01T20:59:10.853
> 
> 标签：version-control, cvs

有什么办法吗？我只有客户端访问权限，无法访问服务器。是否有我遗漏的命令或可以在本地安装的某些软件可以连接并按文件名查找文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-02T11:25:01.450

你可以 grep 的输出

```
cvs rlog -Nh . 
```

（注意末尾的句点字符 - 这实际上意味着：整个存储库）。

这应该为您提供有关整个 shebang 的信息，包括已删除的文件和添加到分支的文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T23:41:48.030

您可以使用

```
 cvs rls -Rde <modulename> 
```

这将以递归方式为您提供所有文件，例如

```
foo:
/x.py/1.2/Mon Dec  1 23:33:51 2008//
/y.py/1.1/Mon Dec  1 23:33:31 2008//
D/bar////

foo/bar:
/xxx/1.1/Mon Dec  1 23:36:38 2008// 
```

请注意， -d 选项也会让您删除文件；不知道你是否想要那个。如果没有 -e，它只会给你文件名。

# opengl - 将新纹理加载到已定义的纹理名称中

> ID：332207
> 
> 赞同：0
> 
> 时间：2008-12-01T21:02:23.670
> 
> 标签：opengl, textures

我有一个 OpenGL 程序，我在其中使用纹理显示图像。我希望能够加载要显示的新图像。

在我的初始化函数中，我调用：

```
Gl.glGenTextures(1, mTextures); 
```

由于一次只会显示一张图像，因此我为每张图像使用相同的纹理名称。

每次加载新图像时，我都会调用以下命令：

```
Gl.glBindTexture(Gl.GL_TEXTURE_2D, mTexture[0]);

Gl.glTexImage2D(Gl.GL_TEXTURE_2D, 0, Gl.GL_LUMINANCE, mTexSizeX, mTexSizeY, 0, Gl.GL_LUMINANCE, Gl.GL_UNSIGNED_SHORT, mTexBuffer);
Gl.glTexParameteri(Gl.GL_TEXTURE_2D, Gl.GL_TEXTURE_MIN_FILTER, Gl.GL_LINEAR);   
Gl.glTexParameteri(Gl.GL_TEXTURE_2D, Gl.GL_TEXTURE_MAG_FILTER, Gl.GL_LINEAR); 
```

第一个图像将按预期显示。但是，所有图像都在第一个之后加载，显示为全黑。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-11-05T12:00:52.557

`glDisable GL_TEXTURE_2D`画完之后？如果禁用 2d 纹理，则放置一个`glColor4f(1,1,1,1);`至少应该看到白色矩形。它将帮助您在这里找到问题所在。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-18T09:06:53.747

我认为问题不在于您显示的代码。您需要提供有关如何使用纹理进行绘制的更多信息，以及传递给的纹理数据的`glTexImage2D`外观。你确定它在你打电话时仍然有效`glTexImage2D`吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-02T07:02:25.550

您何时使用这些纹理提交几何图形？我认为这是与纹理加载交错的，尽管您没有显示。当然，如果你打算用不同的图像替换纹理名称，你根本不需要使用纹理名称，是吗？您可以`glTextImage2D`在需要设置新纹理时进行调用，然后在必要时使用它，从不参与`glBindTexture()`。

一个显而易见的事情当然是插入错误检查代码，当操作失败时，OpenGL 会存储一个错误代码，并且该代码在被应用程序读取之前不会被覆盖。有关更多信息，请参见[glGetError()](http://www.opengl.org/sdk/docs/man/xhtml/glGetError.xml)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T01:09:20.630

您正在寻找的功能是“glCopyTexImage2D”或“glCopyTexSubImage2D”。

# c# - .NET C# - 用于事件连接的表单与设计器代码文件

> ID：332224
> 
> 赞同：0
> 
> 时间：2008-12-01T21:09:08.900
> 
> 标签：c#, winforms, gui-designer

我只是好奇其他人如何在 C# 中使用这种 WinForm 代码。假设我有一个表格，我们称之为 Form1。我有一个名为 dgvMain 的 DataGridView。

你把代码放在哪里：

```
this.dgvMain.CellEndEdit += new DataGridViewCellEventHandler(dgvMain_CellEndEdit); 
```

你把它放在Form1代码还是Form1设计器代码中？这个“事件连接”代码应该放在 Form1_Load 方法中吗？

我问的原因是......如果你双击 DataGridView IDE 插入代码：

```
 this.dgvMain.CellContentClick += new System.Windows.Forms.DataGridViewCellEventHandler(this.dgvMain_CellContentClick); 
```

进入设计器代码。您的“事件接线”代码应该在两个地方吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T21:13:21.637

简短的回答是肯定的。

更长的答案是 .designer.cs 用于设计器生成的代码。如果你把自己的代码放在那里，它有可能被覆盖，搞砸 Visual Studio 中的设计时间，并降低可维护性，因为没有人期望自定义代码在那里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T21:13:21.637

这是一个敏感的话题。在 1.1 中，您的表单文件中有此区域，但很多时候，代码会被设计者覆盖。我是从网络表单的经验中说的，但我只会认为它在其他地方是一样的。

现在，您实际上将事件名称放入表单本身（它是表单设计器的属性之一），代码生成器将在部分类中推出 += 事件处理程序。我讨厌这种方式，但它就是这样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T21:11:51.843

我将**设计器**用于与组件相关的所有事件。

我将**代码**用于所有对象事件。

# .net - 我应该返回“null”还是空数组？

> ID：332229
> 
> 赞同：17
> 
> 时间：2008-12-01T21:10:32.563
> 
> 标签：.net, coding-style

假设您有一个方法应该创建并返回某种数组。如果数组没有被填充怎么办。你返回一个空数组还是空/无？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-01T21:15:57.170

在 .NET 中，返回一个空数组比返回 null 更好，因为它使调用者不必编写 null 检查和/或冒`NullReferenceException`; 您会看到这是基类库中的常见模式。您不会这样做的唯一情况是在不太可能的情况下，空数组和 null 具有不同的语义含义。

[官方数组使用指南](http://msdn.microsoft.com/en-us/library/k2604h5s.aspx)指出：

> 一般规则是 null、空字符串 ("") 和空 (0 项) 数组应以相同方式处理。返回一个空数组而不是空引用。

也就是说，如果您使用的是 .NET 2.0 或更高版本，最好返回一个`IEnumerable<T>`或一个它的可扩展派生类，例如`Collection<T>`, `ReadOnlyCollection<T>`, `ICollection<T>`or `IList<T>`（在这种情况下，我仍然倾向于返回一个空而不是 null）。[更多关于为什么应该首选这些的信息可以在 Eric Lippert 的博客中找到](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T21:14:57.717

我返回一个空数组 - 似乎是正确的做法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T21:19:22.203

您对这个问题的回答可能很大程度上取决于您使用的语言。在像 C 这样的语言中，不可能返回空数组，因为数组只是指向数组开始的某个内存地址的指针。在这种情况下，唯一的选择是返回一个空指针。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-01T21:58:40.250

如果您仔细阅读您的问题，您会意识到您实际上已经自己回答了：您编写了“应该创建并返回某种数组的方法”而不是“应该创建并*可能*返回某种数组的方法”排序*与否*”。

真的，这取决于规格。但是按照您的表述方式，该方法无法返回null。无论如何，这是我更喜欢的风格，它只是让边缘情况处理变得更加容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-01T21:15:37.827

这实际上取决于调用者想要对结果做什么。

通常我会返回空数组（或 Java 中的 Collection）。那是因为我通常会经历一个循环，并有选择地将它们添加到集合中，然后返回它。最后检查是否`Collection.size() == 0`是一个额外的步骤。然后调用者需要添加额外的检查以查看结果是否为 0，如果是，请避免迭代 Collection。

我很欣赏返回 null 可能更干净，但除非我有理由，否则不这样做更容易。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-01T21:17:19.523

如果这真的与语言无关，我将返回一个空数组对象，大多数容器应该具有诸如 IsEmpty() 之类的函数，因此该函数的调用者会在对其进行任何操作之前检查 Array IsEmpty 是否。

如果这是在 C++ 中，我可以看到它要么为空，要么如果你传入了对数组的引用，那么你返回数组大小......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-01T21:23:16.017

我返回调用者期望的任何内容。如果该函数应该返回“所有 X 为真的对象”，并且 X 对任何对象都不为真，我返回一个空数组。

如果该函数甚至无法对“X 为真的对象”执行此搜索，那么它就会失败，并且必须以某种方式将其发回给调用者。这可以通过返回 null 来完成。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-01T21:18:36.353

除非由于某种原因，您的代码中的结果是一个空数组与一个普通的旧空白数组的含义有所不同，否则我会返回一个空白数组。这也可能是特定于语言的事情。在某些语言中，您可能只有一种选择。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-01T21:21:27.923

我想这取决于语言处理它的方式。

在 C 中，我传递指针并始终包含一个指针，该指针是数组的大小。然后调用函数必须提供两件事：数组和数组的大小。如果函数不填充数组，它只会返回相同的指针，并且不对数组大小做任何事情。通常我只是重新实现一个向量类型的结构并使用它。

在 perl 中，数组大小是隐式处理的，所以我只返回一个空数组，或者如果出现错误，我修改错误代码变量并返回一个 undef。

在 java 中，我使用 ArrayLists，并使用 size 属性。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-01T21:32:15.733

如果您有幸使用 C#，请声明一个静态只读属性，如下所示：

```
public static class ArrayUtil<TElement> 
{
    public static readonly Empty = new TElement[0];
} 
```

（这是在 BCL 中吗？为什么不呢？）

您现在可以返回`ArrayUtil<int>.Empty`或其他任何方式。这几乎消除了使用空数组而不是 null 的运行时成本，并为调用者提供了比处理 null 更简单的时间。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-01T21:55:03.877

答案取决于调用者和函数之间的合约。如果您打算将数组标记为无效，那么 null 是比返回零大小数组更好的方法，因为在某些情况下，零大小数组可能是有效结果。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-01T21:57:02.110

嗯，这真的取决于你想要给你的回报的语义。

通常，我对几乎所有的函数/方法都使用前置条件和后置条件。这意味着如果我的方法应该返回一个包含来自特定处理的数据的数组，如果这种处理失败，则该对象应该为空，并且后置条件将失败。

但在你的情况下，我假设你不使用 DbC，所以，如果我只提到你的问题：

> 如果数组没有被填充怎么办。

然后我会返回 null，因为我认为你的措辞有问题。

# code-snippets - 是否有一项服务可以让我创建网页片段

> ID：332230
> 
> 赞同：0
> 
> 时间：2008-12-01T21:10:34.433
> 
> 标签：code-snippets

我正在寻找一种方法来获取网页的本质或最重要的方面？如果我提供 URL，是否有任何外部服务可以做到这一点？我不是在寻找 snap.com 之类的服务，因为它提供了快照。

我什至愿意自己实现这样的系统。一开始我不想付出过多的努力，而是希望能够得到一些基本的结果。关于如何解决这个问题有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-01T08:39:23.570

You can try [Yahoo's Term extraction service](http://developer.yahoo.com/search/content/V2/termExtraction.html)

**Update 02-May-2012**

Yahoo has release a new [Content Analysis Web service](http://developer.yahoo.com/contentanalysis/) which will be replacing the Term extraction service. It can be invoked by syntactically sweet YQL as shown below

```
select * from contentanalysis.analyze where url='http://www.cnn.com/2011/11/11/world/europe/greece-main/index.html'; 
```

There is also [AlchemyAPI](http://www.alchemyapi.com/api/demo.html) which offers a weservice which may serve your purpose.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-01T08:29:11.833

By snippet, do you mean like a quote that sums up the entire page you want to link to?

So if snap.com isn't a fancy, what about the entire page? For verbosity's sake? You could try out [BackupURL](http://www.backupurl.com/) if you want like a cache of the entire page of the site instead just a snapshot of a portion of it.

# excel - Excel - 计算跨多行的时间数据的持续时间

> ID：332254
> 
> 赞同：2
> 
> 时间：2008-12-01T21:17:32.300
> 
> 标签：excel, pivot-table

我有一个电子表格，其中包含许多事务的数据集，每个事务都由子步骤组成，每个子步骤都有它发生的时间。步骤的数量和顺序可以是可变的。

我想找到每笔交易的持续时间。如果我可以在 Excel 中做到这一点，那就太好了，因为它已经是那种格式了。如果在 Excel 中没有直接的方法来执行此操作，我会将其加载到数据库中并使用 SQL 进行分析。如果有一个 Excel 方法，它会节省几个小时的设置虽然:)

我的数据的简化示例如下：

TransID, Substep, Time
1, step A, 15:00:00
1, step B, 15:01:00
1, step C, 15:02:00
2, step B, 15:03:00
2, step C, 15:04:00
2，步骤 E，15:05:00
2，步骤 F， 15:06:00 3，步骤 C，15:07
:00
3，步骤 D， 15:08:00
等。

我想生成一个结果集，如下所示：

TransID、持续时间
1、00 :02:00 2、00:03:00 3、00
:01:00 等。

我最初的尝试是使用一个额外的列，其中包含一个从开始时间减去结束时间的公式，但没有重复的步骤数，或者相同的开始和结束步骤我很难看到这个公式是如何工作的。

我还尝试基于此数据创建一个数据透视表，其中 ID 作为行，时间作为数据。我可以更改时间数据的字段设置以返回分组值，例如计数或最大值，但我很难看到如何设置它以显示每个 ID 的 max(time) - min(time)，因此我为什么正在考虑使用 SQL。如果有人能指出我遗漏的任何明显内容，我将不胜感激。

正如 Hobbo 所建议的，我现在使用了一个以 TransID 作为行的数据透视表，并两次添加了 Time 作为数据。在第一个的 Time to Max 和第二个的 Min 设置字段设置后，可以在数据透视表之外添加一个公式来计算差异。我在这里忽略的一件事是，可以多次将相同的值添加到数据部分！

一个后续问题是我添加的公式是 =GETPIVOTDATA("Max of Time",$A$4,"ID",1)-GETPIVOTDATA("Min of Time",$A$4,"ID" ,1)，复制和粘贴时不会增加。解决方案是使用数据透视表工具栏来关闭 GETPIVOTDATA 公式，或者在选择公式中的单元格时不要单击数据透视表，而是键入单元格引用（例如 =H4-G4）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-11-23T16:42:07.997

在您的公式 "GETPIVOTDATA("Max of Time, $A$4, "ID", 1) - GETPIVOTDATA("Max of Time, $A$4, "ID", 1)' 中，单元格引用在符号 "$ '。例如 4 澳元。当单元格引用具有 $ 符号并且您将公式复制到其他单元格时，引用单元格不会自动更新。因此你得到相同的类型。

也许您将公式修改如下，然后将公式复制到其他单元格。公式应该是这样的：

"GETPIVOTDATA("最大时间，A4，"ID"，1) - GETPIVOTDATA("最大时间，A4，"ID"，1)"。

谢谢。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T21:26:08.303

也许像这样的查询一样简单。

```
SELECT TransID, DateDiff(mi, Min(Time),Max(Time)) AS Duration
FROM MyTable
GROUP BY TrandID 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T21:55:12.690

要添加到 Kibbee 的帖子，参考评论，您可以将 ADO 与 Excel 一起使用：

```
'From: http://support.microsoft.com/kb/246335 '

strFile = Workbooks(1).FullName
strCon = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & strFile _
    & ";Extended Properties=""Excel 8.0;HDR=Yes;IMEX=1"";"

Set cn = CreateObject("ADODB.Connection")
Set rs = CreateObject("ADODB.Recordset")

cn.Open strCon

strSQL = "SELECT TransID, DateDiff('n', Min([MyTime]),Max([MyTime])) AS Duration " _
         & "FROM [Sheet1$] GROUP BY TransID"

rs.Open strSQL, cn

'Write out to another sheet '
Worksheets(2).Cells(2, 1).CopyFromRecordset rs 
```

编辑：我已经更正了原始帖子中的一些错误，并将时间列的名称更改为 MyTime。时间是 SQL 中的保留字，会导致查询困难。这现在适用于一个非常简单的测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-02T08:15:27.447

您在数据透视表的正确路线上。拖入 TransID 作为行字段，然后拖入两个 Time 副本作为数据透视表中的数据字段；右键单击每个并将 Min 指定为一个的汇总函数，将 Max 指定为另一个。在数据透视表的右侧添加一个公式来计算差异。

[替代文字 http://img296.imageshack.us/img296/5866/pivottableey5.jpg](http://img296.imageshack.us/img296/5866/pivottableey5.jpg)

“看起来不错，我唯一的问题是我添加的公式是 =GETPIVOTDATA("Max of Time, $A$4, "ID", 1) - GETPIVOTDATA("Max of Time, $A$4, “ID”，1）。当我将其复制到下面的单元格时，1 不会更新为 2、3 等，因此它们都显示相同的时间。- Kris Coverdale “

使用数据透视表工具栏上的此按钮可关闭 GETPIVOTDATA 公式。

[替代文字 http://img117.imageshack.us/img117/9937/pivottabletoolbarjn3.jpg](http://img117.imageshack.us/img117/9937/pivottabletoolbarjn3.jpg)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-02T10:08:12.993

在excel中：

```
 A     B        C
1 1, step A, 15:00:00
2 1, step B, 15:01:00
3 1, step C, 15:02:00
4 2, step B, 15:03:00
5 2, step C, 15:04:00
6 2, step E, 15:05:00
7 2, step F, 15:06:00
8 3, step C, 15:07:00
9 3, step D, 15:08:00

11 1, =max(if($A$1:$A$9=$A11,$C$1:$C$9,"")-min(if($A$1:$A$9=$A11,$C$1:$C$9,"")
12 2, =max(if($A$1:$A$9=$A12,$C$1:$C$9,"")-min(if($A$1:$A$9=$A12,$C$1:$C$9,"") 
```

注意：公式是数组函数，所以在编辑它们后按 ctrl-shift-enter。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-01T21:55:58.993

有时，在 Excel 中做某事比重复做某事要容易得多。

假设您只是想得到一两次答案，然后扔掉电子表格（而不是每晚运行它，或者把它交给其他人运行），我会这样做。

我假设您的原始数据在 A、B 和 C 列中，标题在第 1 行，数据从第 2 行开始。

按 T​​ransId 作为主键和 Time 作为辅助键对表进行排序，均按升序排列。（如果不这样做，以下将不起作用。）

添加一个新列 D，标题为 Duration ，其中包含这样的公式（Excel 公式没有格式化或注释；我添加了这些以帮助解释，但需要删除它们）：

```
=IF(B2=B3,           // if this row's TransId is the same as the next one
    "",              // leave this field blank
    C3-              // else find the difference between the last timestamp and...
     VLOOKUP(        // look for the first value
        A2,          // matching this TransId
        A:C,         // within the entire table,
        3)           // Return the value in the third column - i.e. timestamp
    ) 
```

现在您想要的数据在 D 列中，但不是您想要的格式。

选择 Columns AD 并复制它们。使用选择性粘贴将*值*仅复制到新工作表中。

删除新工作表中的 B 列和 C 列，剩下的就是 TransID 和 Duration。

按持续时间排序，以使所有具有值的行彼此相邻。

仅对具有 TransId 值的行进行排序。

瞧，这就是您的解决方案！希望你不需要重复这个！

ps 这是未经测试的

# python - Python 中类 foo 和类 foo(object) 的区别

> ID：332255
> 
> 赞同：67
> 
> 时间：2008-12-01T21:17:40.787
> 
> 标签：python

我知道`class foo(object)`这是定义班级的老派方式。但我想更详细地了解这两者之间的区别。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-12-02T01:59:21.997

在 python 2.2 之前，基本上有两种不同类型的类：由 C 扩展和 C 编码的内置函数（类型）定义的类和由 python 类语句定义的类（类）。当您想要混合 python 类型和内置类型时，这会导致问题。最常见的原因是子类化。如果您想在 python 代码中对列表类型进行子类化，那么您很不走运，因此使用了各种解决方法，例如将列表的纯 python 实现子类化（在 UserList 模块中）。

这是相当丑陋的，所以在 2.2 中统一了python 和内置类型，包括[从](http://www.python.org/dev/peps/pep-0252/)它们[继承](http://www.python.org/dev/peps/pep-0253/)的能力。结果是“新样式类”。然而，这些确实与旧式类有一些不兼容的差异，因此为了向后兼容，裸类语法创建一个旧式类，而新行为是通过从 object 继承获得的。最明显的行为差异是：

*   方法解析顺序 (MRO)。菱形继承层次结构中的行为有所不同（其中 A 继承自 B 和 C，它们都继承自公共基类 D。以前，方法是从左到右查找，深度优先（即 ABDCD）如果 C 重载 D 的成员，A 将不会使用它（因为它首先找到 D 的实现）这对各种风格的编程都是不利的（例如使用 mixin 类）。新风格的类将这种情况视为 ABCD， （查看`__mro__`类的属性以查看它将搜索的顺序）

*   添加了`__new__`构造函数，它允许类充当工厂方法，而不是返回类的新实例。对于返回特定子类或重用不可变对象而不是创建新对象而无需更改创建接口很有用。

*   [描述符](https://docs.python.org/2/reference/datamodel.html#implementing-descriptors)。这些是属性、类方法、静态方法等背后的特性。本质上，它们提供了一种方法来控制当您访问或设置（新样式）类的特定属性时会发生什么。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-01T21:24:44.967

`class foo(object):`是声明类的“新”方式。

此更改是在 python 2.2 中进行的，有关差异[的解释，请参阅此 PEP 。](https://docs.python.org/whatsnew/2.2.html)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-01T23:17:35.287

子类`object`化产生一个新型类。新型类的两个众所周知的优点是：

*   元类（类似于类工厂，但工作透明）
*   属性（getter 和 setter...）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2019-04-27T11:34:50.920

Referring to [this](https://mail.python.org/pipermail/python-dev/2014-August/135701.html) The object in class Foo(object) is meant to make your python 3 code compatible with python 2 and 3.

# path - 没有这样的文件或目录，但目录在路径中

> ID：332269
> 
> 赞同：0
> 
> 时间：2008-12-01T21:20:06.273
> 
> 标签：path, file-not-found

您好，我正在使用 make 编译程序，但出现 No such file or directory 但文件位于路径的目录中的错误。

我有这个#include“genetic.h”，该文件位于一个名为/home/myuser/toolbox/lib/genalg的目录中，并且在PATH中我有...：/home/myuser/toolbox/lib/genalg，所以我不知道为什么 make 找不到库。有任何想法吗？。谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T21:21:58.530

您的 shell 路径与编译的工作方式无关，相关路径是库路径（gcc 上的 -L 选项），这是编译器查找库的位置和包含路径（gcc 上的 -I 选项），这是编译器的位置寻找头文件。如果您使用 gcc，请查看[此链接。](http://www.network-theory.co.uk/docs/gccintro/gccintro_22.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T21:22:43.117

包含不使用用于查找可执行文件的相同路径。检查编译器上的文档以了解它搜索包含的位置。

# c# - 实体框架指南

> ID：332273
> 
> 赞同：10
> 
> 时间：2008-12-01T21:20:49.953
> 
> 标签：c#, asp.net, entity-framework

我正在尝试使用 SQL Server 2008 设置实体框架。我正在使用 Guids 作为我表上的键。有没有办法设置它，以便数据库自动生成密钥？我尝试将“RowGuid”设置为 true，并将列的默认值设置为“（newid（））”。无论哪种方式，映射类仍然需要我在 C# 端给它一个 Guid。有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-01T21:54:49.417

[还没有](http://blogs.msdn.com/dsimmons/pages/ef-faq-entity-services.aspx#Section_17)：

> **17.4\. 我可以使用服务器生成的 guid 作为我的实体密钥吗？**
> 
> 不幸的是，在 EF 的 v1 中，这不受支持。虽然 SQL Server 可以有一个类型为“uniqueidentifier”的列并将其默认值设置为“newid()”，但对于 SQL Server 2000，没有很好的方法来提取服务器在您生成时生成的值做插入。不过，这可以在更新版本的 SQL Server 上完成，因此目的是我们应该找到一种干净的方法来特殊情况下在未来版本的 EF 中支持这种支持，这样它就可以在那些允许它的数据库上得到支持，而不是在其他。目前，解决方法是在客户端（理想情况下在对象的构造函数中）而不是在服务器上生成 guid。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-07T21:31:31.597

就个人而言，我认为任何使用 EF 的人都愿意放弃与 SQL Server 2000 的兼容性来获得他们需要的功能。由于必须保持与 SQL Server 2000 的兼容性，我在 EF 中需要做的每一件中途重要的事情似乎都不受支持。

什么时候才能结束！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T21:42:10.313

由于 Guid 是一个结构，因此永远不会传递 null 值，因此不会启动默认值。您可以考虑可以为[null 的 Guid](http://msdn.microsoft.com/en-us/library/1t3y8s4s.aspx) : Guid?，尽管这可能会引起本文中提到的头痛：

[可为空的 GUID](https://stackoverflow.com/questions/211436/nullable-guid)

我发现使用新值初始化 Guid 更容易：

```
private Guid _identifier = Guid.NewGuid(); 
```

如果它是现有记录，则在填充对象时将被替换。如果没有，将插入初始化值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-07-29T02:00:09.137

使用 v4 更容易。

比必须更改 edmx 更好的方法是我在下面为您生成 Guid 的位。它检查主键并反映设置它。

警告 - 假设一个 Guid 主键并且您没有出于自己的原因设置它。

```
void OgaraEntities_SavingChanges(object sender, EventArgs e)
{
  foreach (ObjectStateEntry entry in
      ((ObjectContext)sender).ObjectStateManager.GetObjectStateEntries(
      EntityState.Added ))
  {
    if (!entry.IsRelationship){
      string keyFieldName = entry.EntitySet.ElementType.KeyMembers[0].Name;
      object entity = entry.Entity;
      PropertyInfo pi = entity.GetType().GetProperty(keyFieldName);
      pi.SetValue(entity, Guid.NewGuid(), null);
    }
  }      
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-31T17:44:57.200

更新：Microsoft 已使用[修补程序 KB2561001 修复](http://connect.microsoft.com/VisualStudio/Downloads/DownloadDetails.aspx?DownloadID=37957)了 VS2010 SP1 的此错误。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-25T18:59:37.180

部分类中的静态方法怎么样？

```
public partial class SomeEntity
{
     public static SomeEntity Create()
     {
         return new SomeEntity() { Id = Guid.NewGuid(); }
     }
} 
```

# objective-c - 管理多个异步 NSURLConnection 连接

> ID：332276
> 
> 赞同：88
> 
> 时间：2008-12-01T21:21:32.540
> 
> 标签：objective-c, iphone, cocoa, cocoa-touch, nsurlconnection

我的课堂上有大量重复代码，如下所示：

```
NSURLConnection *connection = [[NSURLConnection alloc] initWithRequest:request
                                                              delegate:self]; 
```

异步请求的问题是，当您有各种请求发出时，并且您分配了一个委托将它们全部视为一个实体，许多分支和丑陋的代码开始制定：

我们要返回什么样的数据？如果它包含这个，那就做那个，否则做其他。我认为能够标记这些异步请求会很有用，就像您能够使用 ID 标记视图一样。

我很好奇什么策略对于管理一个处理多个异步请求的类最有效。

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2008-12-01T22:37:37.457

我跟踪由与其关联的 NSURLConnection 键入的 CFMutableDictionaryRef 中的响应。IE：

```
connectionToInfoMapping =
    CFDictionaryCreateMutable(
        kCFAllocatorDefault,
        0,
        &kCFTypeDictionaryKeyCallBacks,
        &kCFTypeDictionaryValueCallBacks); 
```

使用它而不是 NSMutableDictionary 可能看起来很奇怪，但我这样做是因为这个 CFDictionary 只保留它的键（NSURLConnection），而 NSDictionary 复制它的键（并且 NSURLConnection 不支持复制）。

完成后：

```
CFDictionaryAddValue(
    connectionToInfoMapping,
    connection,
    [NSMutableDictionary
        dictionaryWithObject:[NSMutableData data]
        forKey:@"receivedData"]); 
```

现在我为每个连接都有一个“信息”数据字典，我可以使用它来跟踪有关连接的信息，并且“信息”字典已经包含一个可变数据对象，我可以使用它来存储回复数据。

```
- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data
{
    NSMutableDictionary *connectionInfo =
        CFDictionaryGetValue(connectionToInfoMapping, connection);
    [[connectionInfo objectForKey:@"receivedData"] appendData:data];
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-01-24T20:18:22.950

我有一个项目，我有两个不同的 NSURLConnections，并且想使用相同的委托。我所做的是在我的类中创建两个属性，每个连接一个。然后在委托方法中，我检查它是否是哪个连接

```
 - (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data {
    if (connection == self.savingConnection) {
        [self.savingReturnedData appendData:data];
    }
    else {
        [self.sharingReturnedData appendData:data];
    }
} 
```

这也允许我在需要时按名称取消特定连接。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-12-17T19:25:07.627

子类化 NSURLConnection 来保存数据是干净的，比其他一些答案更少的代码，更灵活，并且需要更少的参考管理。

```
// DataURLConnection.h
#import <Foundation/Foundation.h>
@interface DataURLConnection : NSURLConnection
@property(nonatomic, strong) NSMutableData *data;
@end

// DataURLConnection.m
#import "DataURLConnection.h"
@implementation DataURLConnection
@synthesize data;
@end 
```

像使用 NSURLConnection 一样使用它，并在其 data 属性中累积数据：

```
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response {
    ((DataURLConnection *)connection).data = [[NSMutableData alloc] init];
}

- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data {
    [((DataURLConnection *)connection).data appendData:data];
} 
```

就是这样。

如果你想更进一步，你可以添加一个块作为回调，只需几行代码：

```
// Add to DataURLConnection.h/.m
@property(nonatomic, copy) void (^onComplete)(); 
```

像这样设置它：

```
DataURLConnection *con = [[DataURLConnection alloc] initWithRequest:request delegate:self startImmediately:NO];
con.onComplete = ^{
    [self myMethod:con];
};
[con start]; 
```

并在加载完成时调用它，如下所示：

```
- (void)connectionDidFinishLoading:(NSURLConnection *)connection {
    ((DataURLConnection *)connection).onComplete();
} 
```

您可以扩展块以接受参数，或者只是将 DataURLConnection 作为参数传递给在无参数块中需要它的方法，如图所示

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-07-06T22:44:52.693

这不是一个新的答案。请让我告诉你我是怎么做的

为了在同一个类的委托方法中区分不同的 NSURLConnection，我使用 NSMutableDictionary 来设置和删除 NSURLConnection，使用它`(NSString *)description`作为键。

我选择的对象`setObject:forKey`是用于启动`NSURLRequest`、`NSURLConnection`用途的唯一 URL。

一旦设置 NSURLConnection 被评估为

```
-(void)connectionDidFinishLoading:(NSURLConnection *)connection, it can be removed from the dictionary.

// This variable must be able to be referenced from - (void)connectionDidFinishLoading:(NSURLConnection *)connection
NSMutableDictionary *connDictGET = [[NSMutableDictionary alloc] init];
//...//

// You can use any object that can be referenced from - (void)connectionDidFinishLoading:(NSURLConnection *)connection
[connDictGET setObject:anyObjectThatCanBeReferencedFrom forKey:[aConnectionInstanceJustInitiated description]];
//...//

// At the delegate method, evaluate if the passed connection is the specific one which needs to be handled differently
if ([[connDictGET objectForKey:[connection description]] isEqual:anyObjectThatCanBeReferencedFrom]) {
// Do specific work for connection //

}
//...//

// When the connection is no longer needed, use (NSString *)description as key to remove object
[connDictGET removeObjectForKey:[connection description]]; 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-02T05:35:18.567

我采取的一种方法是不为每个连接使用与委托相同的对象。相反，我为每个触发的连接创建解析类的新实例，并将委托设置为该实例。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-02T08:51:47.467

试试我的自定义类[MultipleDownload](http://github.com/leonho/iphone-libs/tree/master)，它会为您处理所有这些。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-01T21:38:23.847

我通常创建一个字典数组。每个字典都有一些标识信息、一个用于存储响应的 NSMutableData 对象以及连接本身。当连接委托方法触发时，我会查找连接的字典并相应地处理它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-02T00:20:52.850

一种选择是自己继承 NSURLConnection 并添加 -tag 或类似方法。NSURLConnection 的设计是故意非常简单的，所以这是完全可以接受的。

或者，也许您可​​以创建一个 MyURLConnectionController 类，该类负责创建和收集连接数据。然后它只需要在加载完成后通知您的主控制器对象。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-12-13T00:06:56.783

在iOS5及以上你可以只使用类方法 `sendAsynchronousRequest:queue:completionHandler:`

由于响应在完成处理程序中返回，因此无需跟踪连接。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-07T15:15:13.300

正如其他答案所指出的，您应该将 connectionInfo 存储在某处并通过连接查找它们。

最自然的数据类型是`NSMutableDictionary`，但它不能接受`NSURLConnection`作为键，因为连接是不可复制的。

`NSURLConnections`用作键的另一种选择`NSMutableDictionary`是使用`NSValue valueWithNonretainedObject]`：

```
NSMutableDictionary* dict = [NSMutableDictionary dictionary];
NSValue *key = [NSValue valueWithNonretainedObject:aConnection]
/* store: */
[dict setObject:connInfo forKey:key];
/* lookup: */
[dict objectForKey:key]; 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-05-26T11:24:46.930

我喜欢[ASIHTTPRequest](http://allseeing-i.com/ASIHTTPRequest/)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-11-14T00:44:54.880

我决定继承 NSURLConnection 并添加标签、委托和 NSMutabaleData。我有一个处理所有数据管理的 DataController 类，包括请求。我创建了一个 DataControllerDelegate 协议，以便各个视图/对象可以监听 DataController 以了解他们的请求何时完成，以及如果需要已经下载了多少或错误。DataController 类可以使用 NSURLConnection 子类开始一个新的请求，并保存想要监听 DataController 以了解请求何时完成的委托。这是我在 XCode 4.5.2 和 ios 6 中的工作解决方案。

声明 DataControllerDelegate 协议的 DataController.h 文件）。DataController 也是一个单例：

```
@interface DataController : NSObject

@property (strong, nonatomic)NSManagedObjectContext *context;
@property (strong, nonatomic)NSString *accessToken;

+(DataController *)sharedDataController;

-(void)generateAccessTokenWith:(NSString *)email password:(NSString *)password delegate:(id)delegate;

@end

@protocol DataControllerDelegate <NSObject>

-(void)dataFailedtoLoadWithMessage:(NSString *)message;
-(void)dataFinishedLoading;

@end 
```

DataController.m 文件中的关键方法：

```
-(void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response {
    NSURLConnectionWithDelegate *customConnection = (NSURLConnectionWithDelegate *)connection;
    NSLog(@"DidReceiveResponse from %@", customConnection.tag);
    [[customConnection receivedData] setLength:0];
}

-(void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data {
    NSURLConnectionWithDelegate *customConnection = (NSURLConnectionWithDelegate *)connection;
    NSLog(@"DidReceiveData from %@", customConnection.tag);
    [customConnection.receivedData appendData:data];

}

-(void)connectionDidFinishLoading:(NSURLConnection *)connection {
    NSURLConnectionWithDelegate *customConnection = (NSURLConnectionWithDelegate *)connection;
    NSLog(@"connectionDidFinishLoading from %@", customConnection.tag);
    NSLog(@"Data: %@", customConnection.receivedData);
    [customConnection.dataDelegate dataFinishedLoading];
}

-(void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error {
    NSURLConnectionWithDelegate *customConnection = (NSURLConnectionWithDelegate *)connection;
    NSLog(@"DidFailWithError with %@", customConnection.tag);
    NSLog(@"Error: %@", [error localizedDescription]);
    [customConnection.dataDelegate dataFailedtoLoadWithMessage:[error localizedDescription]];
} 
```

并开始一个请求：`[[NSURLConnectionWithDelegate alloc] initWithRequest:request delegate:self startImmediately:YES tag:@"Login" dataDelegate:delegate];`

NSURLConnectionWithDelegate.h: @protocol DataControllerDelegate;

```
@interface NSURLConnectionWithDelegate : NSURLConnection

@property (strong, nonatomic) NSString *tag;
@property id <DataControllerDelegate> dataDelegate;
@property (strong, nonatomic) NSMutableData *receivedData;

-(id)initWithRequest:(NSURLRequest *)request delegate:(id)delegate startImmediately:(BOOL)startImmediately tag:(NSString *)tag dataDelegate:(id)dataDelegate;

@end 
```

和 NSURLConnectionWithDelegate.m：

```
#import "NSURLConnectionWithDelegate.h"

@implementation NSURLConnectionWithDelegate

-(id)initWithRequest:(NSURLRequest *)request delegate:(id)delegate startImmediately:(BOOL)startImmediately tag:(NSString *)tag dataDelegate:(id)dataDelegate {
    self = [super initWithRequest:request delegate:delegate startImmediately:startImmediately];
    if (self) {
        self.tag = tag;
        self.dataDelegate = dataDelegate;
        self.receivedData = [[NSMutableData alloc] init];
    }
    return self;
}

@end 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-12-23T10:27:47.487

每个 NSURLConnection 都有一个 hash 属性，你可以通过这个属性来区分。

例如，我需要在连接之前和之后维护某些信息，所以我的 RequestManager 有一个 NSMutableDictionary 来执行此操作。

一个例子：

```
// Make Request
NSURLRequest *request = [NSURLRequest requestWithURL:url];
NSURLConnection *c = [[NSURLConnection alloc] initWithRequest:request delegate:self];

// Append Stuffs 
NSMutableDictionary *myStuff = [[NSMutableDictionary alloc] init];
[myStuff setObject:@"obj" forKey:@"key"];
NSNumber *connectionKey = [NSNumber numberWithInt:c.hash];

[connectionDatas setObject:myStuff forKey:connectionKey];

[c start]; 
```

请求后：

```
- (void)connectionDidFinishLoading:(NSURLConnection *)connection
{
    NSLog(@"Received %d bytes of data",[responseData length]);

    NSNumber *connectionKey = [NSNumber numberWithInt:connection.hash];

    NSMutableDictionary *myStuff = [[connectionDatas objectForKey:connectionKey]mutableCopy];
    [connectionDatas removeObjectForKey:connectionKey];
} 
```

# html - 从 HREF 中删除 Javascript

> ID：332284
> 
> 赞同：3
> 
> 时间：2008-12-01T21:23:17.187
> 
> 标签：html, security, validation, xss, sanitization

我们希望允许“正常”href 链接到其他网页，但我们不想让任何人潜入客户端脚本。

在 HREF 和 onclick/onmouseover/etc 中搜索“javascript:”。活动够好吗？或者还有其他需要检查的东西吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-01T21:30:52.600

听起来您允许用户提交带有标记的内容。因此，我建议看一些关于防止跨站点脚本的文章，这些文章所涵盖的内容不仅仅是防止 javascript 被插入到 HREF 标记中。以下是我发现可能有用的一个：

[http://weblogs.java.net/blog/gmurray71/archive/2006/09/preventing_cros.html](http://weblogs.java.net/blog/gmurray71/archive/2006/09/preventing_cros.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T21:26:55.727

您必须使用允许协议的白名单才能完全安全。如果你使用黑名单，迟早你会错过诸如“telnet://”或“shell:”之类的东西，或者一些你从未听说过的可利用的特定于浏览器的东西......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T21:27:33.887

不，您需要检查的还有很多。

首先可以对 URL 进行编码（使用 HTML 实体或 URL 编码或两者的混合）。

其次，您需要检查格式错误的 HTML，浏览器可能会猜测并最终允许某些脚本进入。

第三，您需要检查基于 CSS 的脚本，例如 background: url(javascript:...) 或 width:expression(...)

我可能错过了更多 - 你需要小心！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T21:40:54.967

接受用户输入时必须非常小心。如前所述，您需要创建一个白名单，但不仅仅是使用 href。例子：

```
<img src="nosuchimage.blahblah" onerror="alert('Haxored!!!');" /> 
```

或者

```
<a href="about:blank;" onclick="alert('Haxored again!!!');">click meh</a> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-01T22:03:56.510

一种选择是完全禁止 html 并使用某些论坛使用的相同格式。只需更换

`[url="xxx"]yyy[/url]`

和

`<a href="xxx">yyy</a>`

这将使您解决鼠标悬停等问题。然后只需确保链接以白名单协议开始，并且其中没有引号（`&quot;`或某些可能被 php 或浏览器解密的内容） ）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-02T00:21:23.240

听起来您正在寻找 PHP 的伴随函数`strip_tags`，即`strip_attributes`. 不幸的是，它还没有写出来。（提示提示。）

但是，`strip_tags`文档中有一个看起来很有趣的建议，在这里：

[http://www.php.net/manual/en/function.strip-tags.php#85718](http://www.php.net/manual/en/function.strip-tags.php#85718)

从理论上讲，这将从提交的链接中删除任何不是 href、class 或 ID 的内容；似乎您可能想进一步锁定它并只使用href。

# gwt - GWT 中的大型应用程序：一个模块，还是多个？

> ID：332285
> 
> 赞同：12
> 
> 时间：2008-12-01T21:23:43.660
> 
> 标签：gwt

为了在我们的应用程序的各个部分之间提供漂亮的 URL，我们将所有内容分成几个独立编译的模块。例如，有“经理”部分和“编辑”部分。编辑器在新窗口中启动。通过这样做，我们可以直接链接到编辑器：

```
/com.example.EditorApp?id=1 
```

EditorApp 模块只是获取 id 的值并加载文档。

这样做的问题是两个模块之间通用的所有代码都在输出中重复。这包括任何静态内容（图形）、样式表等。

另一个问题是生成 JavaScript 的编译时间几乎翻了一番，因为我们在两个模块之间共享了一些复杂的代码，必须处理两次。

有没有人处理过这个？我正在考虑废弃单独的模块并将其全部合并回一个编译目标。唯一的缺点是我们的“应用程序”之间的 URL 变成了这样：

```
/com.example.MainApp?mode=editor&id=1 
```

每个窗口都加载主模块，检查模式参数的值，并调用适当的模块初始化代码。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-01T23:51:19.663

我在 GWT 中构建了一些非常大的应用程序，我发现最好将它们拆分为模块，并将通用代码移动到它自己的区域中，就像你所做的那样。在我们的案例中，原因很简单，我们的应用程序的某些部分与其他部分非常不同，因此从编译大小的角度来看这是有意义的。我们的应用程序主要部分编译到 300kb，其他部分大约 25-40kb。如果我们只是将它们全部放在一个中，那么用户将获得 600kb 的下载量，这对我们来说是不可接受的。

从设计和可重用性的角度来看，尽可能地将事物分开也更有意义，因为我们已经重用了我们在这个项目上构建的许多模块。

编译时间通常不是您应该担心的，因为如果您有单独的模块，您实际上可以使其更快。我们使用ant来构建我们的项目，我们将它设置为只编译已经改变的GWT，并且在开发过程中只为一个浏览器构建，我们项目的典型编译时间是20秒，而且我们有很多代码。[你可以在这里](http://wiki.shiftyjelly.com/index.php/GWT#Speed_up_Compile_Time)看到这个例子。

另一件小事：我假设您知道您不必使用它生成的默认 GWT 路径？因此，您可以将 com.MyPackage.Package 替换为一个具有好听名称的文件夹，例如 'ui' 或其他名称。编译后的 GWT 不关心你把它放在哪里，并且对路径更改不敏感，因为它都从同一个目录运行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-02-22T19:23:54.677

根据我构建 GWT 应用程序的经验，在决定是否需要多个模块（带或不带入口点）或多合一模块时需要考虑一些事项：下载时间（Javascript 包大小）、编译时间、导航/url 和可维护性/可重用性。

...每次下载时，代码拆分几乎可以避免出于性能原因分解成不同模块的需要。

...每次编译时，即使是大型应用程序也可以很快编译，但它可能有助于分解大型应用程序。

...每个导航/url，从一个模块导航到另一个模块（假设不同的入口点）可能会很痛苦，因为每个模块都有自己的客户端状态......并且跨模块导航不是无缝的。

...根据可维护性/可重用性，从组织/结构的角度来看，将其拆分为单独的模块（即使只有一个入口点）会很有帮助。

我写了一篇关于[使用 GWT Modules](http://www.bennorthrop.com/Essays/2011/structuring-gwt-modules-for-large-applications.php)的博客文章，以防万一。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T20:40:55.897

行。我真的感觉到确实没有“正确”的答案，因为项目差异很大。这在很大程度上取决于应用程序的性质。

我们的主要构建由许多内部模块和第 3 方模块组成。它们都在单独的项目中进行管理。这是有道理的，因为它们在不同的地方使用。

但是，在一个项目中拥有多个模块，旨在作为一个完整的应用程序运行，这似乎使事情变得过于复杂。这两个模块的最初原因是在新窗口中打开不同屏幕时保持 URL 简单。即使有多个构建目标，它们都使用非常大的通用代码子集（包括自定义 XML/POJO 编组库）。

关于大小……对我们来说，一个模块是 280KB，另一个是 300KB 多一点。

我刚刚完成将所有内容合并回一个模块。新的组合模块大约为 380KB。所以实际上下载量要少一些，因为大多数人都会同时使用这两个屏幕。

还要记住有完美的缓存，所以 380KB 应该只下载一次，除非应用程序被更改。

# python - 如何更改使用 Matplotlib 绘制的图形的大小？

> ID：332289
> 
> 赞同：2796
> 
> 时间：2008-12-01T21:24:44.280
> 
> 标签：python, graph, matplotlib, plot, visualization

你如何改变用 Matplotlib 绘制的图形的大小？

* * *

## 回答 #1

> 赞同：1553
> 
> 时间：2009-03-12T12:41:35.223

[`figure`](https://matplotlib.org/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure)告诉你呼叫签名：

```
from matplotlib.pyplot import figure

figure(figsize=(8, 6), dpi=80) 
```

`figure(figsize=(1,1))`将创建一个一英寸一英寸的图像，除非您还提供不同的 dpi 参数，否则它将是 80 x 80 像素。

* * *

## 回答 #2

> 赞同：986
> 
> 时间：2010-11-29T17:30:40.897

如果您已经创建了图形，您可以使用它[`figure.set_size_inches`](https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.set_size_inches)来调整图形大小：

```
fig = matplotlib.pyplot.gcf()
fig.set_size_inches(18.5, 10.5)
fig.savefig('test2png.png', dpi=100) 
```

要将大小更改传播到现有 GUI 窗口，请添加`forward=True`：

```
fig.set_size_inches(18.5, 10.5, forward=True) 
```

此外，正如[Erik Shilts 在评论中提到的，](https://stackoverflow.com/questions/332289/how-do-you-change-the-size-of-figures-drawn-with-matplotlib#comment46810702_4306340)您还可以使用[`figure.set_dpi`](https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.set_dpi)“[s] 设置图形的分辨率（以每英寸点数为单位）”

```
fig.set_dpi(100) 
```

* * *

## 回答 #3

> 赞同：580
> 
> 时间：2017-01-18T10:55:51.607

### 使用 plt.rcParams

如果您想在不使用图形环境的情况下更改大小，也可以使用此解决方法。因此，如果您正在使用[`plt.plot()`](https://matplotlib.org/api/_as_gen/matplotlib.pyplot.figure.html)例如，您可以设置一个具有宽度和高度的元组。

```
import matplotlib.pyplot as plt
plt.rcParams["figure.figsize"] = (20,3) 
```

这在您内联绘图时非常有用（例如，使用[IPython Notebook](https://en.wikipedia.org/wiki/IPython#Notebook)）。正如[asmaier 所注意到](https://stackoverflow.com/questions/332289/how-do-you-change-the-size-of-figures-drawn-with-matplotlib#comment87590438_41717533)的，最好不要将此语句放在导入语句的同一单元格中。

要将全局图形大小重置为后续绘图的默认值：

```
plt.rcParams["figure.figsize"] = plt.rcParamsDefault["figure.figsize"] 
```

### 转换为厘米

元`figsize`组接受英寸，所以如果你想以厘米为单位，你必须将它们除以 2.54。看看[这个问题](https://stackoverflow.com/questions/14708695/specify-figure-size-in-centimeter-in-matplotlib)。

* * *

## 回答 #4

> 赞同：421
> 
> 时间：2008-12-01T21:28:56.927

> **弃用说明：**
> 根据[官方 Matplotlib 指南](https://matplotlib.org/faq/usage_faq.html#matplotlib-pyplot-and-pylab-how-are-they-related)`pylab`，不再推荐使用该模块。请考虑改用该`matplotlib.pyplot`模块，如[this other answer](https://stackoverflow.com/a/41717533)所述。

以下似乎有效：

```
from pylab import rcParams
rcParams['figure.figsize'] = 5, 10 
```

这使得图形的宽度为 5 英寸，高度为 10**英寸**。

然后 Figure 类将其用作其参数之一的默认值。

* * *

## 回答 #5

> 赞同：392
> 
> 时间：2014-06-06T03:24:00.230

请尝试以下简单代码：

```
from matplotlib import pyplot as plt
plt.figure(figsize=(1,1))
x = [1,2,3]
plt.plot(x, x)
plt.show() 
```

您需要在绘图之前设置图形大小。

* * *

## 回答 #6

> 赞同：170
> 
> 时间：2016-09-29T12:54:32.643

如果您正在寻找一种方法来更改**Pandas**中的图形大小，您可以这样做：

```
df['some_column'].plot(figsize=(10, 5)) 
```

`df`Pandas 数据框在哪里。或者，要使用现有图形或轴：

```
fig, ax = plt.subplots(figsize=(10, 5))
df['some_column'].plot(ax=ax) 
```

如果要更改默认设置，可以执行以下操作：

```
import matplotlib

matplotlib.rc('figure', figsize=(10, 5)) 
```

有关更多详细信息，请查看文档：[`pd.DataFrame.plot`](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.plot.html).

* * *

## 回答 #7

> 赞同：85
> 
> 时间：2008-12-02T16:01:32.843

Google 中的第一个链接`'matplotlib figure size'`是[AdjustingImageSize](http://www.scipy.org/Cookbook/Matplotlib/AdjustingImageSize)（[页面的 Google 缓存](https://webcache.googleusercontent.com/search?q=cache:5oqjjm8c8UMJ:https://scipy.github.io/old-wiki/pages/Cookbook/Matplotlib/AdjustingImageSize.html+&cd=2&hl=en&ct=clnk&gl=fr)）。

这是来自上述页面的测试脚本。它创建`test[1-3].png`相同图像的不同大小的文件：

```
#!/usr/bin/env python
"""
This is a small demo file that helps teach how to adjust figure sizes
for matplotlib

"""

import matplotlib
print "using MPL version:", matplotlib.__version__
matplotlib.use("WXAgg") # do this before pylab so you don'tget the default back end.

import pylab
import numpy as np

# Generate and plot some simple data:
x = np.arange(0, 2*np.pi, 0.1)
y = np.sin(x)

pylab.plot(x,y)
F = pylab.gcf()

# Now check everything with the defaults:
DPI = F.get_dpi()
print "DPI:", DPI
DefaultSize = F.get_size_inches()
print "Default size in Inches", DefaultSize
print "Which should result in a %i x %i Image"%(DPI*DefaultSize[0], DPI*DefaultSize[1])
# the default is 100dpi for savefig:
F.savefig("test1.png")
# this gives me a 797 x 566 pixel image, which is about 100 DPI

# Now make the image twice as big, while keeping the fonts and all the
# same size
F.set_size_inches( (DefaultSize[0]*2, DefaultSize[1]*2) )
Size = F.get_size_inches()
print "Size in Inches", Size
F.savefig("test2.png")
# this results in a 1595x1132 image

# Now make the image twice as big, making all the fonts and lines
# bigger too.

F.set_size_inches( DefaultSize )# resetthe size
Size = F.get_size_inches()
print "Size in Inches", Size
F.savefig("test3.png", dpi = (200)) # change the dpi
# this also results in a 1595x1132 image, but the fonts are larger. 
```

输出：

```
using MPL version: 0.98.1
DPI: 80
Default size in Inches [ 8\.  6.]
Which should result in a 640 x 480 Image
Size in Inches [ 16\.  12.]
Size in Inches [ 16\.  12.] 
```

两个注意事项：

1.  模块注释和实际输出不同。

2.  [这个答案](https://stackoverflow.com/questions/335896/how-to-complete-this-python-function-to-save-in-the-same-folder#336001)可以轻松地将所有三个图像组合在一个图像文件中，以查看大小的差异。

* * *

## 回答 #8

> 赞同：84
> 
> 时间：2019-07-08T19:13:12.670

```
import matplotlib.pyplot as plt
plt.figure(figsize=(20,10))
plt.plot(x,y) ## This is your plot
plt.show() 
```

您还可以使用：

```
fig, ax = plt.subplots(figsize=(20, 10)) 
```

* * *

## 回答 #9

> 赞同：59
> 
> 时间：2017-10-30T15:23:07.257

您可以简单地使用（来自[matplotlib.figure.Figure](https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html)）：

```
fig.set_size_inches(width,height) 
```

从 Matplotlib 2.0.0 开始，对画布的更改将立即可见，因为`forward`关键字[默认为`True`](https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html?highlight=set%20size%20inches#matplotlib.figure.Figure.set_size_inches).

如果您只想[更改宽度**或**高度](https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html?highlight=set%20size%20inches#matplotlib.figure.Figure.set_figheight)而不是两者，您可以使用

`fig.set_figwidth(val)`或者`fig.set_figheight(val)`

这些也会立即更新您的画布，但仅限于 Matplotlib 2.2.0 及更高版本。

### 对于旧版本

您需要`forward=True`明确指定以便在比上面指定的版本更旧的版本中实时更新您的画布。请注意，`set_figwidth`and函数在 Matplotlib 1.5.0 之前的版本中`set_figheight`不支持该参数。`forward`

* * *

## 回答 #10

> 赞同：48
> 
> 时间：2014-03-14T08:22:25.283

尝试注释掉该`fig = ...`行

```
%matplotlib inline
import numpy as np
import matplotlib.pyplot as plt

N = 50
x = np.random.rand(N)
y = np.random.rand(N)
area = np.pi * (15 * np.random.rand(N))**2

fig = plt.figure(figsize=(18, 18))
plt.scatter(x, y, s=area, alpha=0.5)
plt.show() 
```

* * *

## 回答 #11

> 赞同：44
> 
> 时间：2014-05-28T05:47:34.493

这对我很有效：

```
from matplotlib import pyplot as plt

F = plt.gcf()
Size = F.get_size_inches()
F.set_size_inches(Size[0]*2, Size[1]*2, forward=True) # Set forward to True to resize window along with plot in figure.
plt.show() # Or plt.imshow(z_array) if using an animation, where z_array is a matrix or NumPy array 
```

此论坛帖子也可能有所帮助：*[调整图形窗口大小](http://matplotlib.1069221.n5.nabble.com/Resizing-figure-windows-td11424.html)*

* * *

## 回答 #12

> 赞同：22
> 
> 时间：2014-10-30T10:38:37.830

要将图形的大小增加 N 倍，您需要在*pl.show()*之前插入它：

```
N = 2
params = pl.gcf()
plSize = params.get_size_inches()
params.set_size_inches((plSize[0]*N, plSize[1]*N)) 
```

它也适用于[IPython](https://en.wikipedia.org/wiki/IPython)笔记本。

* * *

## 回答 #13

> 赞同：21
> 
> 时间：2020-11-10T10:31:41.283

**以像素为单位设置精确图像大小的不同方法的比较**

这个答案将集中在：

*   `savefig`：如何保存到文件，而不仅仅是在屏幕上显示
*   以像素为单位设置大小

这是我尝试过的一些方法的快速比较，图片显示了所提供的内容。

当前状态总结：事情一团糟，不确定是否是基本限制，或者如果用例没有得到开发人员的足够关注，我无法轻易找到有关此的上游讨论。

**未尝试设置图像尺寸的基线示例**

只是有一个比较点：

基础.py

```
#!/usr/bin/env python3

import sys

import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mpl

fig, ax = plt.subplots()
print('fig.dpi = {}'.format(fig.dpi))
print('fig.get_size_inches() = ' + str(fig.get_size_inches())
t = np.arange(-10., 10., 1.)
plt.plot(t, t, '.')
plt.plot(t, t**2, '.')
ax.text(0., 60., 'Hello', fontdict=dict(size=25))
plt.savefig('base.png', format='png') 
```

跑：

```
./base.py
identify base.png 
```

输出：

```
fig.dpi = 100.0
fig.get_size_inches() = [6.4 4.8]
base.png PNG 640x480 640x480+0+0 8-bit sRGB 13064B 0.000u 0:00.000 
```

[![在此处输入图像描述](https://i.stack.imgur.com/jtD8D.png)](https://i.stack.imgur.com/jtD8D.png)

**到目前为止我最好的方法：`plt.savefig(dpi=h/fig.get_size_inches()[1]`仅高度控制**

我认为这是我大部分时间都会采用的方法，因为它简单且可扩展：

get_size.py

```
#!/usr/bin/env python3

import sys

import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mpl

height = int(sys.argv[1])
fig, ax = plt.subplots()
t = np.arange(-10., 10., 1.)
plt.plot(t, t, '.')
plt.plot(t, t**2, '.')
ax.text(0., 60., 'Hello', fontdict=dict(size=25))
plt.savefig(
    'get_size.png',
    format='png',
    dpi=height/fig.get_size_inches()[1]
) 
```

跑：

```
./get_size.py 431 
```

输出：

```
get_size.png PNG 574x431 574x431+0+0 8-bit sRGB 10058B 0.000u 0:00.000 
```

[![在此处输入图像描述](https://i.stack.imgur.com/KdCdo.png)](https://i.stack.imgur.com/KdCdo.png)

和

```
./get_size.py 1293 
```

输出：

```
main.png PNG 1724x1293 1724x1293+0+0 8-bit sRGB 46709B 0.000u 0:00.000 
```

[![在此处输入图像描述](https://i.stack.imgur.com/sitTs.png)](https://i.stack.imgur.com/sitTs.png)

我倾向于只设置高度，因为我通常最关心图像将在我的文本中间占据多少垂直空间。

**`plt.savefig(bbox_inches='tight'`更改图像大小**

总觉得图片周围留白太多，倾向于补充`bbox_inches='tight'`： [Removing white space around a saved image](https://stackoverflow.com/questions/11837979/removing-white-space-around-a-saved-image-in-matplotlib)

但是，这可以通过裁剪图像来实现，并且您不会获得所需的尺寸。

相反，在同一个问题中提出的另一种方法似乎效果很好：

```
plt.tight_layout(pad=1)
plt.savefig(... 
```

这给出了高度等于 431 的确切期望高度：

[![在此处输入图像描述](https://i.stack.imgur.com/tX75f.png)](https://i.stack.imgur.com/tX75f.png)

**固定高度、`set_aspect`自动调整宽度和小边距**

Ermmm，`set_aspect`又把事情搞砸了，并阻止`plt.tight_layout`了实际删除边距......这是一个重要的用例，我还没有一个很好的解决方案。

提问：[如何在 Matplotlib 中获得固定的像素高度、固定的数据 x/y 纵横比并自动移除移除水平空白边距？](https://stackoverflow.com/questions/64642855/how-to-obtain-a-fixed-height-in-pixels-fixed-data-x-y-aspect-ratio-and-automati)

**`plt.savefig(dpi=h/fig.get_size_inches()[1]`+ 宽度控制**

如果您真的需要除高度之外的特定宽度，这似乎可以正常工作：

宽度.py

```
#!/usr/bin/env python3

import sys

import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mpl

h = int(sys.argv[1])
w = int(sys.argv[2])
fig, ax = plt.subplots()
wi, hi = fig.get_size_inches()
fig.set_size_inches(hi*(w/h), hi)
t = np.arange(-10., 10., 1.)
plt.plot(t, t, '.')
plt.plot(t, t**2, '.')
ax.text(0., 60., 'Hello', fontdict=dict(size=25))
plt.savefig(
    'width.png',
    format='png',
    dpi=h/hi
) 
```

跑：

```
./width.py 431 869 
```

输出：

```
width.png PNG 869x431 869x431+0+0 8-bit sRGB 10965B 0.000u 0:00.000 
```

[![在此处输入图像描述](https://i.stack.imgur.com/udybG.png)](https://i.stack.imgur.com/udybG.png)

对于小宽度：

```
./width.py 431 869 
```

输出：

```
width.png PNG 211x431 211x431+0+0 8-bit sRGB 6949B 0.000u 0:00.000 
```

[![在此处输入图像描述](https://i.stack.imgur.com/Xbq1g.png)](https://i.stack.imgur.com/Xbq1g.png)

所以看起来字体的缩放是正确的，我们只是在非常小的宽度上遇到了一些麻烦，标签被切断了，例如`100`左上角的。

我设法解决了那些[删除已保存图像周围的空白](https://stackoverflow.com/questions/11837979/removing-white-space-around-a-saved-image-in-matplotlib/57498238#57498238)

```
plt.tight_layout(pad=1) 
```

这使：

```
width.png PNG 211x431 211x431+0+0 8-bit sRGB 7134B 0.000u 0:00.000 
```

[![在此处输入图像描述](https://i.stack.imgur.com/D3Adb.png)](https://i.stack.imgur.com/D3Adb.png)

从这里，我们也看到它`tight_layout`去除了图像顶部的很多空白空间，所以我通常总是使用它。

**固定魔法基础高度、`dpi`开启`fig.set_size_inches`和`plt.savefig(dpi=`缩放**

我相信这相当于提到的方法：[https ://stackoverflow.com/a/13714720/895245](https://stackoverflow.com/a/13714720/895245)

魔法.py

```
#!/usr/bin/env python3

import sys

import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mpl

magic_height = 300
w = int(sys.argv[1])
h = int(sys.argv[2])
dpi = 80
fig, ax = plt.subplots(dpi=dpi)
fig.set_size_inches(magic_height*w/(h*dpi), magic_height/dpi)
t = np.arange(-10., 10., 1.)
plt.plot(t, t, '.')
plt.plot(t, t**2, '.')
ax.text(0., 60., 'Hello', fontdict=dict(size=25))
plt.savefig(
    'magic.png',
    format='png',
    dpi=h/magic_height*dpi,
) 
```

跑：

```
./magic.py 431 231 
```

输出：

```
magic.png PNG 431x231 431x231+0+0 8-bit sRGB 7923B 0.000u 0:00.000 
```

[![在此处输入图像描述](https://i.stack.imgur.com/cnTUV.png)](https://i.stack.imgur.com/cnTUV.png)

并查看它是否可以很好地扩展：

```
./magic.py 1291 693 
```

输出：

```
magic.png PNG 1291x693 1291x693+0+0 8-bit sRGB 25013B 0.000u 0:00.000 
```

[![在此处输入图像描述](https://i.stack.imgur.com/I5xN6.png)](https://i.stack.imgur.com/I5xN6.png)

所以我们看到这种方法也很有效。我遇到的唯一问题是您必须设置该`magic_height`参数或等效参数。

**固定 DPI +`set_size_inches`**

这种方法给出了一个稍微错误的像素大小，并且很难无缝地缩放所有内容。

set_size_inches.py

```
#!/usr/bin/env python3

import sys

import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mpl

w = int(sys.argv[1])
h = int(sys.argv[2])
fig, ax = plt.subplots()
fig.set_size_inches(w/fig.dpi, h/fig.dpi)
t = np.arange(-10., 10., 1.)
plt.plot(t, t, '.')
plt.plot(t, t**2, '.')
ax.text(
    0,
    60.,
    'Hello',
    # Keep font size fixed independently of DPI.
    # https://stackoverflow.com/questions/39395616/matplotlib-change-figsize-but-keep-fontsize-constant
    fontdict=dict(size=10*h/fig.dpi),
)
plt.savefig(
    'set_size_inches.png',
    format='png',
) 
```

跑：

```
./set_size_inches.py 431 231 
```

输出：

```
set_size_inches.png PNG 430x231 430x231+0+0 8-bit sRGB 8078B 0.000u 0:00.000 
```

所以高度略微偏离，图像：

[![在此处输入图像描述](https://i.stack.imgur.com/2rC6e.png)](https://i.stack.imgur.com/2rC6e.png)

如果我把它放大 3 倍，像素大小也是正确的：

```
./set_size_inches.py 1291 693 
```

输出：

```
set_size_inches.png PNG 1291x693 1291x693+0+0 8-bit sRGB 19798B 0.000u 0:00.000 
```

[![在此处输入图像描述](https://i.stack.imgur.com/dWsRG.png)](https://i.stack.imgur.com/dWsRG.png)

然而，我们从中了解到，要使这种方法很好地扩展，您需要使每个 DPI 相关设置与以英寸为单位的大小成比例。

在前面的示例中，我们只使“Hello”文本成比例，它的高度确实保持在我们预期的 60 到 80 之间。但是我们没有这样做的所有东西看起来都很小，包括：

*   轴的线宽
*   刻度标签
*   点标记

**SVG**

我找不到如何为 SVG 图像设置它，我的方法只适用于 PNG，例如：

get_size_svg.py

```
#!/usr/bin/env python3

import sys

import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mpl

height = int(sys.argv[1])
fig, ax = plt.subplots()
t = np.arange(-10., 10., 1.)
plt.plot(t, t, '.')
plt.plot(t, t**2, '.')
ax.text(0., 60., 'Hello', fontdict=dict(size=25))
plt.savefig(
    'get_size_svg.svg',
    format='svg',
    dpi=height/fig.get_size_inches()[1]
) 
```

跑：

```
./get_size_svg.py 431 
```

生成的输出包含：

```
<svg height="345.6pt" version="1.1" viewBox="0 0 460.8 345.6" width="460.8pt" 
```

并识别 说：

```
get_size_svg.svg SVG 614x461 614x461+0+0 8-bit sRGB 17094B 0.000u 0:00.000 
```

如果我在 Chromium 86 中打开它，浏览器调试工具鼠标图像悬停确认高度为 460.79。

但当然，由于 SVG 是一种矢量格式，理论上一切都应该按比例缩放，因此您可以转换为任何固定大小的格式而不会损失分辨率，例如：

```
inkscape -h 431 get_size_svg.svg -b FFF -e get_size_svg.png 
```

给出准确的高度：

[![在此处输入图像描述](https://i.stack.imgur.com/i4kHL.png)](https://i.stack.imgur.com/i4kHL.png)

我在这里使用 Inkscape 而不是 Imagemagick `convert`，因为您还需要`-density`使用 ImageMagick 来获得清晰的 SVG 大小调整：

*   [https://superuser.com/questions/598849/imagemagick-convert-how-to-produce-sharp-resized-png-files-from-svg-files/1602059#1602059](https://superuser.com/questions/598849/imagemagick-convert-how-to-produce-sharp-resized-png-files-from-svg-files/1602059#1602059)
*   [如何使用 ImageMagick 将 SVG 转换为 PNG？](https://stackoverflow.com/questions/9853325/how-to-convert-a-svg-to-a-png-with-imagemagick)

`<img height=""`HTML 上的设置也应该适用于浏览器。

在 matplotlib==3.2.2 上测试。

* * *

## 回答 #14

> 赞同：17
> 
> 时间：2019-11-29T16:18:01.950

概括和简化[psihodelia 的答案](https://stackoverflow.com/questions/332289/how-do-you-change-the-size-of-figures-drawn-with-matplotlib/26650785#26650785)：

如果您想将图形的当前大小更改一个因子`sizefactor`：

```
import matplotlib.pyplot as plt

# Here goes your code

fig_size = plt.gcf().get_size_inches() # Get current size
sizefactor = 0.8 # Set a zoom factor
# Modify the current size by the factor
plt.gcf().set_size_inches(sizefactor * fig_size) 
```

更改当前大小后，您可能需要微调*子图布局*。您可以在图形窗口 GUI 中执行此操作，或通过命令[subplots_adjust](https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.subplots_adjust.html)

例如，

```
plt.subplots_adjust(left=0.16, bottom=0.19, top=0.82) 
```

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2016-08-03T18:04:36.290

由于 Matplotlib[本身无法](https://github.com/matplotlib/matplotlib/issues/1369)使用公制，如果您想以合理的长度单位（例如厘米）指定图形的大小，您可以执行以下操作（来自[gns-ank](https://stackoverflow.com/a/22787457/395857)的代码）：

```
def cm2inch(*tupl):
    inch = 2.54
    if isinstance(tupl[0], tuple):
        return tuple(i/inch for i in tupl[0])
    else:
        return tuple(i/inch for i in tupl) 
```

然后你可以使用：

```
plt.figure(figsize=cm2inch(21, 29.7)) 
```

* * *

## 回答 #16

> 赞同：15
> 
> 时间：2021-02-22T12:17:35.280

用这个：

```
plt.figure(figsize=(width,height)) 
```

和`width`以`height`英寸为单位。如果未提供，则默认为`rcParams["figure.figsize"] = [6.4, 4.8]`. [在这里](https://matplotlib.org/3.1.0/api/_as_gen/matplotlib.pyplot.figure.html)查看更多。

* * *

## 回答 #17

> 赞同：14
> 
> 时间：2021-03-15T13:25:44.903

以下肯定会起作用，但**请确保添加`plt.figure(figsize=(20,10))`上面的行`plt.plot(x,y)`,`plt.pie()`**等。

```
import matplotlib.pyplot as plt
plt.figure(figsize=(20,10))
plt.plot(x,y) ## This is your plot
plt.show() 
```

代码是[从 amalik2205](https://stackoverflow.com/questions/332289/how-do-you-change-the-size-of-figures-drawn-with-matplotlib/56941236#56941236)复制的。

* * *

## 回答 #18

> 赞同：13
> 
> 时间：2014-10-28T05:08:13.527

即使在绘制图形之后也会立即调整图形大小（至少使用 Qt4Agg/TkAgg - 但不是 Mac OS X - 使用 Matplotlib 1.4.0）：

```
matplotlib.pyplot.get_current_fig_manager().resize(width_px, height_px) 
```

* * *

## 回答 #19

> 赞同：9
> 
> 时间：2019-05-27T22:56:40.030

另一种选择是使用 Matplotlib 中的 rc() 函数（单位为英寸）：

```
import matplotlib
matplotlib.rc('figure', figsize=[10,5]) 
```

* * *

## 回答 #20

> 赞同：9
> 
> 时间：2021-06-16T12:27:16.500

这就是我使用自定义大小打印自定义图表的方式

```
import matplotlib.pyplot as plt
from matplotlib.pyplot import figure

figure(figsize=(16, 8), dpi=80)
plt.plot(x_test, color = 'red', label = 'Predicted Price')
plt.plot(y_test, color = 'blue', label = 'Actual Price')
plt.title('Dollar to PKR Prediction')
plt.xlabel('Predicted Price')
plt.ylabel('Actual Dollar Price')
plt.legend()
plt.show() 
```

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2021-04-20T13:48:06.883

创建**新图形**时，您可以使用参数指定大小（以英寸为单位）[`figsize`](https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.figure.html)：

> ```
> import matplotlib.pyplot as plt
> fig = plt.figure(figsize=(w,h)) 
> ```

如果要**修改现有图形**，请使用以下[`set_size_inches()`](https://matplotlib.org/stable/api/figure_api.html#matplotlib.figure.Figure.set_size_inches)方法：

> ```
> fig.set_size_inches(w,h) 
> ```

如果要**更改默认**图形大小（6.4" x 4.8"），请使用[“运行命令”](https://stackoverflow.com/questions/37728087/what-does-rc-in-matplotlibs-rcparams-stand-for#comment93050965_37728087) [`rc`](https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.rc.html)：

> ```
> plt.rc('figure', figsize=(w,h)) 
> ```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2021-10-29T11:58:29.583

这是我自己的一个例子。

下面我给了你答案，我已经扩展给你试验。

另请注意，无花果尺寸值以***英寸为单位***

```
import matplotlib.pyplot as plt

data = [2,5,8,10,15] # Random data, can use existing data frame column

fig, axs = plt.subplots(figsize = (20,6)) # This is your answer to resize the figure

# The below will help you expand on your question and resize individual elements within your figure. Experiement with the below parameters.
axs.set_title("Data", fontsize = 17.5)
axs.tick_params(axis = 'x', labelsize = 14)
axs.set_xlabel('X Label Here', size = 15)
axs.tick_params(axis = 'y', labelsize =14)
axs.set_ylabel('Y Label Here', size = 15)

plt.plot(data) 
```

输出： [![在此处输入图像描述](https://i.stack.imgur.com/1qXSP.png)](https://i.stack.imgur.com/1qXSP.png)

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2020-10-22T20:42:12.793

我总是使用以下模式：

```
x_inches = 150*(1/25.4)     # [mm]*constant
y_inches = x_inches*(0.8)
dpi = 96

fig = plt.figure(1, figsize = (x_inches,y_inches), dpi = dpi, constrained_layout = True) 
```

通过此示例，您可以以英寸或毫米为单位设置图形尺寸。设置`constrained_layout`为 时`True`，绘图将填充您的图形而没有边框。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2021-12-31T05:04:54.373

```
import random
import math
import matplotlib.pyplot as plt
start=-20
end=20
x=[v for v in range(start,end)]
#sigmoid function
def sigmoid(x):
    return 1/(1+math.exp(x))
plt.figure(figsize=(8,5))#setting the figure size
plt.scatter([abs(v) for v in x],[sigmoid(v) for v in x])
plt.scatter(x,[sigmoid(sigmoid(v)) for v in x]) 
```

[![sigmoid 图像](https://i.stack.imgur.com/3ONu6.png)](https://i.stack.imgur.com/3ONu6.png)

# javascript - 环回 jQuery AJAX 请求

> ID：332291
> 
> 赞同：2
> 
> 时间：2008-12-01T21:24:47.433
> 
> 标签：javascript, jquery, ajax

为 AJAX 调用构建环回 URL 的最佳方法是什么？假设我有一个页面

```
http://www.mydomain.com/some/subdir/file.php 
```

我想用 AJAX 调用加载。在 Firefox 中，使用 jQuery 可以正常工作：

```
$.post('/some/subdir/file.php', ...); 
```

Safari/WebKit 尝试将此解释为本地文件系统上的一个位置（因此它最终会转换为 'file://some/subdir/file.php'）。这不仅没有指向任何有用的东西，而且还会导致安全错误。

有没有办法在不将域硬编码到 URL 中的情况下完成此操作？我想让它尽可能地独立于域。

**更新**

我最终从 location.href 中解析出基本 url 并将其放入可访问的 jQuery 函数中，如下所示：

```
/**
 * Retrieves the current root URL.
 *
 * @return string the root URL
 */
$.fn.rootUrl = function() {
    var url = location.href;
    return url.substring(0, url.indexOf('/', 7));
}; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T21:27:55.430

哇，IMO 的 Safari/WebKit 太差了。

您可以观察 document.href，计算斜杠，然后在 URL 的开头添加那么多“../”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T21:39:43.860

您可以让服务器在提供页面时将其自己的 URL 作为 javascript 变量插入，然后将该变量用作 Ajax 调用的一部分。这样它就既安全又自动。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-02T01:38:26.767

或者，您可以按如下方式组合您的 URL：

'http://'+document.domain

# opengl - 在 OpenGL 中管理大量线条的最有效方法是什么？

> ID：332295
> 
> 赞同：6
> 
> 时间：2008-12-01T21:25:48.210
> 
> 标签：opengl, performance, conceptual

我正在开发一个简单的 CAD 程序，它使用 OpenGL 来处理屏幕渲染。屏幕上绘制的每个形状都完全由简单的线段构成，因此即使是简单的绘图也最终会处理数千条单独的线。

在我的应用程序和 OpenGL 之间传达此行集合中的更改的最佳方式是什么？有没有办法只更新 OpenGL 缓冲区中行的某个子集？

我在这里寻找一个概念性的答案。无需深入实际的源代码，只需对数据结构和通信提出一些建议。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-01T22:09:43.567

您可以使用简单的方法，例如使用显示列表 (glNewList/glEndList)

另一个稍微复杂一点的选项是使用顶点缓冲区对象（VBO - GL_ARB_vertex_buffer_object）。它们的优点是可以动态更改，而显示列表则不能。

这些基本上是批量处理所有数据/转换，然后在 GPU 上执行（假设您使用的是硬件加速），从而提高性能。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-01T22:15:58.530

顶点缓冲区对象可能是您想要的。加载原始数据集后，您可以使用`glBufferSubData()`.

如果您添加额外的线段并溢出缓冲区的大小，您当然必须创建一个新的缓冲区，但这与在 C 中当某些东西增长时必须分配一个新的、更大的内存块没有什么不同。

编辑：显示列表上的一些注释，以及为什么不使用它们：

1.  在 OpenGL 3.0 中，显示列表已被弃用，因此使用它们在 3.0 之后不能向前兼容（当然，2.1 实现将存在一段时间，因此取决于您的目标受众，这可能不是问题）
2.  每当您更改任何内容时，都必须重建整个显示列表，如果经常更改，这将破坏显示列表的全部目的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T23:13:03.767

不确定您是否已经这样做了，但值得一提的是，如果可能的话，您应该尝试使用 GL_LINE_STRIP 而不是单独的 GL_LINES，以减少发送到卡的顶点数据量。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T18:08:50.303

我的建议是尝试使用场景图，一种用于线条/曲线的分层数据结构。如果你有巨大的模型，如果你有简单的行列表，性能会受到影响。使用图形/树结构，您可以使用包围体轻松检查哪些项目可见，哪些不可见。此外，使用场景图，您可以轻松应用转换并重用几何图形。

# .net - .NET Windows Forms 2.0：如何共享图像列表？

> ID：332297
> 
> 赞同：0
> 
> 时间：2008-12-01T21:26:14.230
> 
> 标签：.net, winforms, image

我希望项目中的多个表单必须使用一个 imageList。也就是说，多个控件使用同一个图像列表。

*注意：理想情况下，单个解决方案中的多个项目将使用相同的图像列表 - 但我不想一次对 Microsoft 提出太多要求。*

有些控件是列表视图，有些是树视图，有些是自定义控件，有些是执行自定义绘制周期的控件。

如何将多个 ListViews 和 TreeViews 指向同一个图像列表组件？

涉及的一些问题是：

*   我在哪里放置图像列表组件？它必须以某种形式存在
*   如何说服 IDE 在“SmallImageList”中显示与列表视图不同的表单中的图像列表控件？
*   如果我改为在运行时构建图像列表，如何设计出现在图像列表中的图像？

**注意：**这在 Delphi 中很容易。您可以像往常一样删除一个 ImageList 组件，它只是出现在“属性”窗口中“SmallImageList”属性下的可用图像列表列表中。

**注意：**可以说在 Visual Studio 中做不到。如果答案是无法完成，那么这将是公认的答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T21:30:56.127

至于主要问题：

> .NET Windows Forms 2.0：如何共享图像列表？

您可以与 UserControl 共享 ImageList。只需在所有表单中添加 UserControl，您就可以访问 ImageList。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T21:41:09.367

我们有一个基于 .NET 2.0 构建的多项目 WinForms 应用程序。

其中一个项目持有：

*   整个解决方案中使用的所有图像
*   一个 ImageManager 类，它有一个静态方法，包含一行代码：

返回 CType(My.Resources.ResourceManager.GetObject(name), Image)

然后我们只需按名称引用图像（主要是 .PNG）。

例如，

button.Image = ImageManager.GetImage("CancelIcon")

这一切都比 .NET 1.1 更容易管理。现在您所要做的就是将图像添加到项目中，将图像拖到图形资源显示（在项目|属性中），然后编译。

由于项目可以跨解决方案重用，我们可以在需要的任何地方使用相同的图像库。

不确定这是否真的回答了你的问题，但我希望它会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-02T00:29:15.267

我启动了 Visual Studio 并认为“让我们制作一个继承自 imagelist 的增强型 ImageList 控件并修复此问题并在 SO 上发布解决方案”，结果被砰的一声失望了，ImageList 控件是密封的（不可继承的）所以我之前被卡住了我什至开始了。

但我记得在某处有人已经这样做了，谷歌在对关键字进行了一些调整后就成功了。

我在 CodeProject 上找到了一个解决方案，**Neal Andrews**似乎完全按照您的要求制作了一个解决方案，使 ImageLists 可以在多个表单和控件之间被继承和共享，并具有完整的设计时支持。

[http://www.codeproject.com/KB/cpp/SharedImageListsComponent.aspx](http://www.codeproject.com/KB/cpp/SharedImageListsComponent.aspx)

谢谢尼尔！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-22T16:44:51.367

可能是在应用程序第一次运行时声明一个 Shared ImageList 变量并填充它。

```
 Shared shoImageList As New ImageList
    Public Sub New()
        If shoImageList.Images.Count = 0 Then
            shoImageList = ImageList1 
            'or may be a For Each loop here'
        End If
        myTreeView.ImageList = shoImageList
        ImageList1 = Nothing
    End Sub 
```

# visual-studio-2008 - 如何以编程方式更改 RDLC 报告中的页眉高度？

> ID：332299
> 
> 赞同：2
> 
> 时间：2008-12-01T21:26:36.367
> 
> 标签：visual-studio-2008, reporting, rdlc

有谁知道在 RDLC 报告中更改页眉高度的方法？我有一个带有换行符的文本框，如果有超过一行，我希望页眉的高度可以扩展。有谁知道如何做到这一点？如果您需要更多信息，请与我们联系。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-02T13:40:42.440

RDLC 文件基本上是一个 XML 文件。如果您首先更改 XML 节点的值：Report \ PageHeader \ Height 然后在 Report Viewer 控件中加载报告定义，您可以动态更改标题高度（以及几乎任何其他内容，只要您保留有效的 XML在后面）。您可以使用 XmlDocument 类来执行这些操作。

# mysql - INT 和 VARCHAR 主键之间是否存在真正的性能差异？

> ID：332300
> 
> 赞同：198
> 
> 时间：2008-12-01T21:26:49.067
> 
> 标签：mysql, performance, primary-key, innodb, myisam

在 MySQL 中使用 INT 与 VARCHAR 作为主键之间是否存在可测量的性能差异？我想使用 VARCHAR 作为参考列表的主键（想想美国各州、国家/地区代码），并且同事不会将 INT AUTO_INCREMENT 作为所有表的主键。

我的论点，正如[这里](http://database-programmer.blogspot.com/2008/01/database-skills-sane-approach-to.html#rule1)详述的那样，是 INT 和 VARCHAR 之间的性能差异可以忽略不计，因为每个 INT 外键引用都需要一个 JOIN 来理解引用，一个 VARCHAR 键将直接呈现信息。

那么，是否有人对这个特定的用例以及与之相关的性能问题有经验？

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2008-12-01T21:47:48.400

[*您提出了一个很好的观点，您可以通过使用所谓的自然键*](https://en.wikipedia.org/wiki/Natural_key)而不是[*代理键*](https://en.wikipedia.org/wiki/Surrogate_key)来避免一些连接查询。只有您可以评估这样做的好处在您的应用程序中是否显着。

也就是说，您可以衡量应用程序中对速度最重要的查询，因为它们处理大量数据或执行非常频繁。如果这些查询从消除连接中受益，并且不会因使用 varchar 主键而受到影响，那么就这样做。

不要对数据库中的所有表使用任何一种策略。在某些情况下，自然键可能更好，但在其他情况下，代理键更好。

其他人提出了一个很好的观点，即在实践中自然键很少发生变化或重复，因此代理键通常是值得的。

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2008-12-01T21:30:57.547

这与性能无关。这是关于什么是好的主键。随着时间的推移独特且不变。您可能认为像国家代码这样的实体永远不会随着时间而改变，并且会成为主键的良好候选者。但痛苦的经历是很少如此。

INT AUTO_INCREMENT 满足“随着时间的推移唯一且不变”的条件。因此偏好。

* * *

## 回答 #3

> 赞同：89
> 
> 时间：2018-02-02T12:58:39.663

我对缺乏在线基准感到有点恼火，所以我自己进行了测试。

**请注意，虽然我不会在常规基础上执行此操作，因此请检查我的设置和步骤以了解可能无意中影响结果的任何因素，并在评论中发表您的疑虑。**

设置如下：

*   Intel® Core™ i7-7500U CPU @ 2.70GHz × 4
*   15.6 GiB RAM，我确保在测试期间有大约 8 GB 可用。
*   148.6 GB SSD 驱动器，有足够的可用空间。
*   Ubuntu 16.04 64 位
*   MySQL Ver 14.14 Distrib 5.7.20，适用于 Linux (x86_64)

表格：

```
create table jan_int (data1 varchar(255), data2 int(10), myindex tinyint(4)) ENGINE=InnoDB;
create table jan_int_index (data1 varchar(255), data2 int(10), myindex tinyint(4), INDEX (myindex)) ENGINE=InnoDB;
create table jan_char (data1 varchar(255), data2 int(10), myindex char(6)) ENGINE=InnoDB;
create table jan_char_index (data1 varchar(255), data2 int(10), myindex char(6), INDEX (myindex)) ENGINE=InnoDB;
create table jan_varchar (data1 varchar(255), data2 int(10), myindex varchar(63)) ENGINE=InnoDB;
create table jan_varchar_index (data1 varchar(255), data2 int(10), myindex varchar(63), INDEX (myindex)) ENGINE=InnoDB; 
```

然后，我用一个 PHP 脚本在每个表中填充了 1000 万行，其本质是这样的：

```
$pdo = get_pdo();

$keys = [ 'alabam', 'massac', 'newyor', 'newham', 'delawa', 'califo', 'nevada', 'texas_', 'florid', 'ohio__' ];

for ($k = 0; $k < 10; $k++) {
    for ($j = 0; $j < 1000; $j++) {
        $val = '';
        for ($i = 0; $i < 1000; $i++) {
            $val .= '("' . generate_random_string() . '", ' . rand (0, 10000) . ', "' . ($keys[rand(0, 9)]) . '"),';
        }
        $val = rtrim($val, ',');
        $pdo->query('INSERT INTO jan_char VALUES ' . $val);
    }
    echo "\n" . ($k + 1) . ' millon(s) rows inserted.';
} 
```

对于`int`表格，该位`($keys[rand(0, 9)])`被替换为 just `rand(0, 9)`，对于`varchar`表格，我使用了完整的美国州名，没有将它们剪切或扩展为 6 个字符。`generate_random_string()`生成一个 10 个字符的随机字符串。

然后我在 MySQL 中运行：

*   `SET SESSION query_cache_type=0;`
*   对于`jan_int`表：
    *   `SELECT count(*) FROM jan_int WHERE myindex = 5;`
    *   **`SELECT BENCHMARK(1000000000, (SELECT count(*) FROM jan_int WHERE myindex = 5));`**
*   对于其他表，同上，用`myindex = 'califo'`for`char`表和`myindex = 'california'`for`varchar`表。

`BENCHMARK`每张表的查询次数：

*   jan_int：21.30 秒
*   jan_int_index：18.79 秒
*   jan_char：21.70 秒
*   jan_char_index：18.85 秒
*   jan_varchar：21.76 秒
*   jan_varchar_index：18.86 秒

关于表和索引大小，这是`show table status from janperformancetest;`（未显示几列）的输出：

```
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Name              | Engine | Version | Row_format | Rows    | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Collation              |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| jan_int           | InnoDB |      10 | Dynamic    | 9739094 |             43 |   422510592 |               0 |            0 |   4194304 |           NULL | utf8mb4_unicode_520_ci |  
| jan_int_index     | InnoDB |      10 | Dynamic    | 9740329 |             43 |   420413440 |               0 |    132857856 |   7340032 |           NULL | utf8mb4_unicode_520_ci |   
| jan_char          | InnoDB |      10 | Dynamic    | 9726613 |             51 |   500170752 |               0 |            0 |   5242880 |           NULL | utf8mb4_unicode_520_ci |  
| jan_char_index    | InnoDB |      10 | Dynamic    | 9719059 |             52 |   513802240 |               0 |    202342400 |   5242880 |           NULL | utf8mb4_unicode_520_ci |  
| jan_varchar       | InnoDB |      10 | Dynamic    | 9722049 |             53 |   521142272 |               0 |            0 |   7340032 |           NULL | utf8mb4_unicode_520_ci |   
| jan_varchar_index | InnoDB |      10 | Dynamic    | 9738381 |             49 |   486539264 |               0 |    202375168 |   7340032 |           NULL | utf8mb4_unicode_520_ci | 
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| 
```

**我的结论是这个特定用例没有性能差异。**

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2008-12-01T21:56:05.403

取决于长度.. 如果 varchar 将是 20 个字符，而 int 是 4，那么如果使用 int，则索引将在磁盘上每页索引空间的节点数的五倍......这意味着遍历该索引将需要五分之一的物理和/或逻辑读取。

因此，如果性能是一个问题，如果有机会，请始终为您的表和引用这些表中行的外键使用一个完整的无意义键（称为代理项）......

*同时*，为了保证数据的一致性，每个重要的表也应该***有***一个有意义的非数字备用键，（或唯一索引），以确保不能插入重复的行（根据有意义的表属性重复）。

对于您正在谈论的特定用途（例如状态查找），这并不重要，因为表的大小非常小。一般来说，少于几千行的表的索引对性能没有影响。 ..

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2008-12-01T21:33:57.010

绝对不。

我已经在 INT、VARCHAR 和 CHAR 之间进行了数次……数次……性能检查。

无论我使用三个中的哪一个，具有 PRIMARY KEY（唯一和集群）的 1000 万个记录表都具有完全相同的速度和性能（以及子树成本）。

话虽这么说...使用最适合您的应用程序的任何东西。不用担心性能。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-12-01T21:30:09.340

对于短代码，可能没有区别。尤其如此，因为包含这些代码的表可能非常小（最多几千行）并且不会经常更改（我们最后一次添加新的美国州是什么时候）。

对于键之间变化较大的较大表，这可能很危险。例如，考虑使用用户表中的电子邮件地址/用户名。当您有几百万用户并且其中一些用户的姓名或电子邮件地址很长时会发生什么情况。现在，任何时候您需要使用该键加入此表，它变得更加昂贵。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-01T21:42:58.580

至于主键，任何物理上使行唯一的东西都应该被确定为主键。

对于作为外键的引用，使用自动递增整数作为代理是一个好主意，主要有两个原因。
- 首先，通常在连接中产生的开销较少。
- 其次，如果您需要更新包含唯一 varchar 的表，则更新必须级联到所有子表并更新所有子表以及索引，而使用 int 代理，它只需要更新主表及其索引。

使用代理的缺点是您可能允许更改代理的含义：

```
ex.
id value
1 A
2 B
3 C

Update 3 to D
id value
1 A
2 B
3 D

Update 2 to C
id value
1 A
2 C
3 D

Update 3 to B
id value
1 A
2 C
3 B 
```

这一切都取决于您在结构中真正需要担心什么以及最重要的是什么。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-10-17T02:47:12.890

在 HauteLook，我们更改了许多表格以使用自然键。我们确实体验到了现实世界的性能提升。正如您所提到的，我们的许多查询现在使用更少的连接，这使得查询的性能更高。如果有意义的话，我们甚至会使用复合主键。话虽如此，如果某些表具有代理键，则它们更易于使用。

此外，如果您让人们为您的数据库编写接口，代理键可能会有所帮助。第 3 方可以依赖代理键仅在极少数情况下才会更改的事实。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-12-09T01:52:20.540

`AUTO_INCREMENT`代理人受伤的常见情况：

常见的模式模式是**多对多映射**：

```
CREATE TABLE map (
    id ... AUTO_INCREMENT,
    foo_id ...,
    bar_id ...,
    PRIMARY KEY(id),
    UNIQUE(foo_id, bar_id),
    INDEX(bar_id) ); 
```

这种模式的性能要好得多，尤其是在使用 InnoDB 时：

```
CREATE TABLE map (
    # No surrogate
    foo_id ...,
    bar_id ...,
    PRIMARY KEY(foo_id, bar_id),
    INDEX      (bar_id, foo_id) ); 
```

为什么？

*   InnoDB 二级键需要额外查找；通过将这对移动到 PK 中，可以避免一个方向。
*   二级索引是“覆盖”的，所以不需要额外的查找。
*   由于去掉了`id`一个索引，该表更小。

另一个案例（**国家**）：

```
country_id INT ...
-- versus
country_code CHAR(2) CHARACTER SET ascii 
```

新手经常将 country_code 规范化为 4 字节`INT`，而不是使用“自然”的 2 字节、几乎不变的 2 字节字符串。更快，更小，更少的 JOIN，更具可读性。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-05-28T14:42:36.253

我面临同样的困境。我用 3 个事实表制作了一个 DW（星座模式），道路事故、事故中的车辆和事故中的伤亡。数据包括 1979 年至 2012 年在英国记录的所有事故，以及 60 个维度表。总共有大约 2000 万条记录。

### 事实表关系：

```
+----------+          +---------+
| Accident |>--------<| Vehicle |
+-----v----+ 1      * +----v----+
     1|                    |1
      |    +----------+    |
      +---<| Casualty |>---+
         * +----------+ * 
```

RDMS：MySQL 5.6

事故索引本身是一个 varchar（数字和字母），有 15 位数字。我尽量不要有代理键，一旦事故索引永远不会改变。在 i7（8 核）计算机中，根据维度，在 1200 万条负载记录后，DW 变得太慢而无法查询。经过大量返工和添加 bigint 代理键后，我的速度性能平均提升了 20%。尚未获得低性能增益，但有效的尝试。我从事 MySQL 调优和集群工作。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-11-30T07:24:32.937

问题是关于 MySQL 的，所以我说有很大的不同。如果是关于 Oracle（将数字存储为字符串 - 是的，一开始我不敢相信），那么差别不大。

表中的存储不是问题，而是更新和引用索引。涉及基于其主键查找记录的查询很频繁 - 您希望它们尽可能快地发生，因为它们经常发生。

*问题是 CPU 在硅*中自然地处理 4 字节和 8 字节整数。比较两个整数真的很快 - 它发生在一两个时钟周期内。

现在看一个字符串——它由很多字符组成（现在每个字符超过一个字节）。比较两个字符串的优先级不能在一两个周期内完成。相反，必须迭代字符串的字符，直到找到差异。我确信在某些数据库中有一些技巧可以使其更快，但这在这里无关紧要，因为 int 比较是自然完成的，并且 CPU 在硅片中的速度快如闪电。

我的一般规则——每个主键都应该是一个自动递增的 INT，尤其是在使用 ORM（Hibernate、Datanucleus 等）的 OO 应用程序中，对象之间有很多关系——它们通常总是被实现为一个简单的 FK，并且能够快速解决这些问题的数据库对您的应用程序的响应能力很重要。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-03-23T07:24:20.137

请允许我说是的，考虑到性能范围（开箱即用的定义），肯定存在差异：

1- 在应用程序中使用代理 int 更快，因为您不需要在代码或查询中使用 ToUpper()、ToLower()、ToUpperInvarient() 或 ToLowerInvarient()，这 4 个函数具有不同的性能基准。请参阅 Microsoft 性能规则。（应用程序的性能）

2- 使用代理 int 保证不会随着时间的推移更改密钥。甚至国家代码也可能发生变化，请参阅 Wikipedia ISO 代码如何随时间变化。这将花费大量时间来更改子树的主键。（数据维护性能）

3- ORM 解决方案似乎存在问题，例如当 PK/FK 不是 int 时的 NHibernate。（开发者表现）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-01T21:43:26.553

不确定性能影响，但至少在开发过程中，这似乎是一种可能的折衷方案，即包括自动递增的整数“代理”键以及您预期的唯一“自然”键。这将使您有机会评估性能以及其他可能的问题，包括自然键的可变性。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-04-26T23:14:53.017

像往常一样，没有笼统的答案。'这取决于！' 我不是在开玩笑。我对原始问题的理解是针对小表上的键 - 例如 Country（整数 id 或 char/varchar 代码）是地址/联系表等潜在巨大表的外键。

当您想要从数据库中返回数据时，这里有两种情况。首先是一种列表/搜索类型的查询，您想在其中列出所有带有州和国家代码或姓名的联系人（id 无济于事，因此需要查找）。另一个是获取主键的场景，它显示了需要显示州名和国家/地区名称的单个联系人记录。

对于后者，FK 基于什么可能并不重要，因为我们将针对单个记录或几条记录以及关键读取的表组合在一起。前一种（搜索或列表）场景可能会受到我们选择的影响。由于需要显示国家/地区（至少是一个可识别的代码，甚至搜索本身可能包含一个国家/地区代码），因此不必通过代理键加入另一个表（我在这里只是谨慎，因为我没有实际测试过这，但似乎很有可能）提高性能；尽管它确实有助于搜索。

由于代码很小——国家和州通常不超过 3 个字符，在这种情况下使用自然键作为外键可能是可以的。

另一种情况是键依赖于更长的 varchar 值，并且可能依赖于更大的表；代理键可能具有优势。

# mysql - MySQL - 视图替代

> ID：332309
> 
> 赞同：2
> 
> 时间：2008-12-01T21:28:46.880
> 
> 标签：mysql

我开发了一个使用 MySQL 5 工作的应用程序，它使用视图来访问主要数据。事实证明，我们的生产服务器使用 MySQL 4，它没有包含视图。

有没有人有一种快速而肮脏的方法来处理这个不涉及重写我所有的代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T21:38:19.463

这无疑指出了在您的开发和生产环境中使用相同技术的重要性！

涉及触发器或存储过程的解决方法将不起作用，因为 MySQL 4.x 也不支持这些。

此时您的选择：

*   重写应用程序代码以复制非规范化表中的数据，以匹配您的视图。

*   将您的生产数据库升级到 MySQL 5.0。如果您在谈论托管服务提供商，请联系该提供商并询问他们是否有 MySQL 5.0 的选项，否则您需要重新定位到提供服务的提供商处。

我推荐后一种路径，它比编写代码来管理重复数据的工作要少得多。

请注意，MySQL 4.1 是四年前作为生产软件发布的。对该版本的积极支持于 2006 年结束。对 MySQL 4.1 的扩展支持于 2009 年 12 月 31 日结束。见[http://www.mysql.com/about/legal/lifecycle/](http://www.mysql.com/about/legal/lifecycle/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T21:50:10.220

想到的快速且非常肮脏的方法是继承 DBI 并在那里重新编写 SQL。当然，取决于您使用视图的目的，以及您的意思是 MySQL 4.0（没有子查询）还是 MySQL 4.1（有子查询）。

如果您使用的是 4.1，则可以转：

```
CREATE VIEW foo AS
  SELECT a, b, c FROM real_table WHERE fooable = 1;

SELECT * FROM foo; 
```

进入

```
SELECT v1.* FROM (
  SELECT a, b, c FROM real_table WHERE fooable = 1
) v1; 
```

至少，后一种语法适用于 5.0.x，我认为它也应该适用于 4.1.x。

如果您使用的是 4.0... 那么，这将不会那么容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T21:39:34.080

哎哟。除了 DeLorean 和磁通电容器或升级服务器之外，我不知道有什么简单的方法可以解决这个问题。很多改变似乎是必要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T21:38:02.867

不幸的是，如果不升级到 MySQL 5，可能不会。

# .net - IIS 中的单例类是线程安全的吗？

> ID：332318
> 
> 赞同：7
> 
> 时间：2008-12-01T21:30:52.600
> 
> 标签：.net, multithreading, iis

我有一个在 IIS 下运行的 ASP.NET 网页，它使用一个包含单例类的通用程序集。我应该在单例上实现锁定机制以使其成为线程安全的吗？或者，与网络服务器的任何连接都会使用相同的单例实例吗？

希望我能连贯地问这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T21:32:01.630

如果它是一个静态单例......不，它不是线程安全的。它在访问该应用程序实例的*所有*线程之间共享（因此多请求将共享它）。

但是，您使用它的目的可能不一定需要线程安全。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T21:40:56.060

.NET 单例的常用模式为每个应用程序域创建一个实例。asp.net 中的常见情况是您有多个线程在同一个应用程序域中运行。这意味着您很可能有多个线程同时在单例中运行代码。

您必须检查单例并确定（尽您的能力*koffreflectorkoff*）它是否是线程安全的。如果它保留和修改共享资源，或者如果它封装了存储在方法调用之间的某种状态，请小心。

您可能希望将单例封装在使用锁的第二个单例中，然后再将其调用委托给您无法控制的单例。这样，您可以更好地控制锁定，而不是使用单个锁阻止对单例的每次调用。它还将为您提供集中线程代码位置的好处......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T21:43:33.837

在 .NET 中，可以在不使用锁的情况下实现 [线程安全的单例。](http://en.csharp-online.net/Singleton_design_pattern:_Thread-safe_Singleton)

# java - GWT 中的会话管理，而不在服务器上使用 Java？

> ID：332337
> 
> 赞同：0
> 
> 时间：2008-12-01T21:40:12.317
> 
> 标签：java, javascript, gwt

我正在为我的客户端应用程序使用 GWT。我没有为服务器使用 GWT/Java。但是，我不确定如何处理会话管理。GWT 应用程序驻留在一个页面上，所有服务器调用都通过 AJAX 完成。如果服务器上的会话过期......让我们假设用户没有关闭浏览器，但让应用程序保持打开状态，我的服务器如何通知应用程序会话已过期并且客户端部分应显示登录屏幕再次？

客户端会话管理是什么意思？这似乎天生就不安全。

我不是在寻找代码。我正在寻找想法、技术、潜在的解决方案等。我考虑过 Comet [http://en.wikipedia.org/wiki/Comet_(programming)](http://en.wikipedia.org/wiki/Comet_(programming))，但如果不使用 Java，那似乎效果不佳在服务器端。也许我错了？我也不想轮询服务器。

有什么想法或见解吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T22:40:19.747

在不知道你的 RPC 是如何工作的情况下，很难给出好的建议。

如果您的 AJAX 服务需要对用户进行身份验证（IE 具有有效会话），则只需发送 401 错误说明用户无效即可。客户端可以将 401 错误解释为应设置用户进行重新身份验证的消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T23:59:12.660

我们在我们的应用程序中处理了这个问题，通过检测服务器何时将重定向发送回登录屏幕（它将来自对 Ajax 调用的响应），并弹出一个对话框再次询问用户他们的密码，但预先填写他们的用户名。然后我们将它发布到登录页面所在的位置，就好像它是登录页面一样，因此用户自动登录到这个新会话。最后，我们只是再次重新提交了 ajax 调用，因此对用户来说这是一个无缝的过程（例如：他们不必再次单击该操作）。

由于我们将所有状态存储在客户端上，而不是在会话变量中，我们在尝试跨会话持久化数据时没有任何问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T21:46:55.920

如果会话在服务器端过期会发生什么，那么下次客户端向服务器发送请求时，它将创建一个新会话，或者更有可能将一条消息发送回它正在尝试的客户端访问没有会话的页面，并将它们发送到登录屏幕。但是，您仍然需要等到客户端向服务器发送消息。

# nhibernate - 确定 NHibernate 瓶颈的最佳方法？

> ID：332344
> 
> 赞同：3
> 
> 时间：2008-12-01T21:42:29.550
> 
> 标签：nhibernate

这是参考我之前提出的一个[问题。](https://stackoverflow.com/questions/331073/speed-up-nhibernate-calls-to-oracle)除了查看 NHibernate 在调用数据库时生成的 SQL 之外，找到 NHibernate 和数据库之间的瓶颈的最佳方法是什么？特别是，我的查询在直接针对数据库运行时返回非常快，但在单元测试和网页上运行代码时返回时间非常慢（超过 3-4 倍）。我相对确定这与我映射表和主键的方式有关。我怎样才能进一步深入了解我的慢速区域发生在哪里？还有其他可用的工具吗？我知道这是一个非常广泛的问题，但我还没有必要探索这些问题。任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T21:57:58.787

AFAIK 目前还没有单一的工具来分析 NHibernate。这将随着[Ayende 的 NHIbernate Profiler](http://ayende.com/Blog/archive/2008/11/04/nh-prof-a-guided-tour.aspx)改变。同时，您可以结合使用代码分析器（例如[dotTrace](http://www.jetbrains.com/profiler/)）、SQL Server Profiler、NHibernate 记录器和静态分析，即如果您知道 SELECT N+1 问题，大多数时候您可以发现它只是通过查看代码。

**编辑**：[NHProf](http://www.nhprof.com/)现在可用！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T21:44:49.640

我使用 JProbe 来分析我的代码。它可以显示在我的代码中任何特定位置花费的时间，以及瓶颈在哪里。我敢肯定还有其他可用的工具，其中一些可能更便宜。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T22:10:31.100

现在使用 Sql 分析器。稍后您可以购买 Ayende 的 Nhibernate Profiler。您也可以记录sql并检查。

# iphone - NSURLConnection 和处理响应代码和响应数据

> ID：332351
> 
> 赞同：3
> 
> 时间：2008-12-01T21:44:38.140
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch

我现在有一个奇怪的边缘情况，来自 NSURLConnection 委托方法的响应代码：

```
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response; 
```

在后续委托方法之前触发：

```
- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data; 
```

我的代码当然可以使用改进，因为它现在检查上面的 HTTP 响应代码，然后调用一些方法来采取行动。不幸的是，当时还没有数据。

**有什么优雅的解决方案可以以我的类**方法在200 + not之前不会触发的方式来耦合`response`和。我需要将它们都设置为类实例变量吗？似乎是穷人的解决方案。`responseData``response` **`responseData``nil`**

 *** * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-01T22:23:31.433

数据之前的响应是正确的顺序。实际上，您应该清除此方法中的所有数据（以防您通过重定向收到多个响应并且任何中间数据都已过时）。

您会收到一条 connection:didReceiveResponse: 消息，告诉您已收到回复标头，但这发生*在*任何正文内容之前。

如果您需要访问回复的所有元素，您应该简单地存储响应和数据，并且只在 connectionDidFinishLoading: 中处理它们（或者如果您的数据很长，您可以在 connection:didReceiveData: 中增量处理）。

# unix - MySQL权限问题 - 应该是非问题

> ID：332353
> 
> 赞同：7
> 
> 时间：2008-12-01T21:44:54.600
> 
> 标签：unix, mysql, mysqldump, mysql-management

这让我有点抓狂：我在一台服务器上做了一个分区表的 mysqldump，将生成的 SQL 转储移动到另一台服务器，并尝试运行插入。它失败了，但我很难弄清楚为什么。谷歌和 MySQL 论坛和文档并没有太大帮助。

失败的查询看起来像这样（为了简洁和清晰而被截断，更改名称以保护无辜者）：

```
CREATE TABLE `my_precious_table` (
 `id` bigint(20) NOT NULL AUTO_INCREMENT,
 `somedata` varchar(20) NOT NULL,
 `aTimeStamp` datetime NOT NULL DEFAULT '0000-00-00 00:00:00',
 PRIMARY KEY (`id`,`aTimeStamp`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 DATA DIRECTORY='/opt/data/data2/data_foo/' INDEX DIRECTORY='/opt/data/data2/idx_foo/' 
/*!50100 PARTITION BY RANGE (year(aTimeStamp)) SUBPARTITION BY HASH ( TO_DAYS(aTimeStamp)) 
(PARTITION p0 VALUES LESS THAN (2007) (SUBPARTITION foo0 DATA DIRECTORY = '/opt/data/data2/data_foo' INDEX DIRECTORY = '/opt/data/data2/idx_foo' ENGINE = MyISAM), 
PARTITION p1 VALUES LESS THAN (2008) (SUBPARTITION foo1 DATA DIRECTORY = '/opt/data/data2/data_foo' INDEX DIRECTORY = '/opt/data/data2/idx_foo' ENGINE = MyISAM), 
PARTITION p2 VALUES LESS THAN (2009) (SUBPARTITION foo2 DATA DIRECTORY = '/opt/data/data2/data_foo' INDEX DIRECTORY = '/opt/data/data2/idx_foo' ENGINE = MyISAM), 
PARTITION p3 VALUES LESS THAN MAXVALUE (SUBPARTITION foo3 DATA DIRECTORY = '/opt/data/data2/data_foo' INDEX DIRECTORY = '/opt/data/data2/idx_foo' ENGINE = MyISAM)) */; 
```

错误是：

> 错误1（HY000）：无法创建/写入文件'/opt/data/data2/idx_foo/my_precious_table#P#p0#SP#foo0.MYI'（错误代码：13）

“无法创建/写入文件”对我来说似乎是一个权限问题，但目标文件夹的权限如下所示：

```
drwxrwxrwx 2 mysql mysql 4096 Dec  1 16:24 data_foo
drwxrwxrwx 2 mysql mysql 4096 Dec  1 16:25 idx_foo 
```

为了踢球，我尝试对 root:root 和我自己进行 chowning。这并没有解决问题。

源 MySQL 服务器是 5.1.22-rc-log 版本。目标服务器是 5.1.29-rc-community。两者都在最近的 CentOS 安装上运行。

**编辑：** 更多研究表明 Errcode 13 实际上是权限错误。但我怎样才能得到它`rwxrwxrwx`？

**编辑：** 比尔卡尔文的绝妙建议没有成功。我以 root 用户身份工作，并设置了所有权限标志。

**编辑：** 在不为各个分区指定数据目录的情况下创建表是可行的——但我需要将这些分区放在比这个 MySQL 实例默认放置表的磁盘更大的磁盘上。而且我不能只在表级别指定 DATA/INDEX DIRECTORY - 这在我使用的 MySQL 版本（5.1.29-rc-community）中是不合法的。

**编辑：**感谢 MySQL 邮件列表和内部 IT 人员，终于找到了答案。见下文。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-21T23:36:37.537

在**Ubuntu**上查看 mysql 的**apparmor**设置

```
vi /etc/apparmor.d/usr.sbin.mysql 
```

这应该可以解决权限问题。为了快速测试，您甚至可以尝试

```
/etc/init.d/apparmor stop 
```

但不要忘记重新启动服务。

这花了我一些时间来弄清楚。在阅读了“SELinux”之后，很明显我已经忘记了 Ubuntu 上的这种新保护。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T22:43:17.680

[http://bugs.mysql.com/bug.php?id=19557](http://bugs.mysql.com/bug.php?id=19557)

> 您还将收到一条错误消息，指出运行查询的 MySQL 用户 ID 没有允许用户 ID 写入文件系统的“数据文件”权限。

换句话说，它可能是关于 SQL 权限的权限问题，而不是操作系统文件权限的问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T19:43:02.763

原来是一个 SElinux 问题——我的所有文件系统权限都很好，但是针对 MySQL 访问该磁盘分区设置了更高级别的策略。

教训：当您遇到权限问题但所有权和文件系统权限显然正确时，请查看 SElinux。

# wpf - 在我的 WPF 应用程序中托管 Windows Shell Explorer

> ID：332364
> 
> 赞同：9
> 
> 时间：2008-12-01T21:49:51.610
> 
> 标签：wpf, winforms, controls

是否可以在 WPF 或 WinForms 窗口中嵌入 Windows Explorer 文件/文件夹浏览器视图？

我基本上想将文件/文件夹浏览器托管为我的应用程序窗口的一部分。我不想重新实现 shell 提供的功能，尤其是 TortoiseSVN 等 shell 扩展。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-02T21:19:09.143

As far as I know, there isn't any File/Folder browser control out of the box in Windows Forms nor WPF.
However there are commercial third-party controls that offer a Windows Explorer-like interface to browse files and folders on disk. Take a look at these products from LogicNP:

*   [FileView Control](http://www.ssware.com/fileview/fileview.htm)
*   [FolderView Control](http://www.ssware.com/fldrview.htm)

Alternatively, you could host the **Windows Forms WebBrowser control** in WPF and use it to browse the filesystem, since it is integrated with the Windows shell.
In XAML you could do something like this:

```
<Window x:Class="Samples.FilesystemBrowser"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:wf="clr-namespace:System.Windows.Forms;assembly=System.Windows.Forms"
    Title="Filesystem Browser">
    <StackPanel>
        <WindowsFormsHost>
            <wf:WebBrowser Url="C:\" />
        </WindowsFormsHost>
    </StackPanel>
</Window> 
```

Note, that with **.NET 3.5 SP1** Microsoft added a **native WPF WebBrowser control**, so you can optionally use that instead:

```
<Window x:Class="Samples.FilesystemBrowser"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Filesystem Browser">
    <StackPanel>
        <WebBrowser Source="C:\" />
    </StackPanel>
</Window> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-12-30T23:38:04.623

Windows Vista 的 Shell 引入了一个实现 IExplorerBrowser 接口的新控件；这是在应用程序中托管 Windows Shell 文件系统视图的推荐方法。使用 .NET 构建应用程序的开发人员可以使用适用于 .NET 的 Windows API CodePack 中提供的 ExplorerBrowser 控件的打包版本。

请注意，此界面仅适用于 Windows Vista 及更高版本。如果您的应用程序需要在较早的 Windows 版本上运行，您将需要回退到这些平台上的旧 WebOC 实现。

[http://msdn.microsoft.com/en-us/library/bb761909(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb761909(VS.85).aspx) [http://code.msdn.microsoft.com/WindowsAPICodePack](http://code.msdn.microsoft.com/WindowsAPICodePack)

由于此处描述的 Win7 问题，建议通过托管 Web 浏览器控件：http: [//blogs.msdn.com/ieinternals/archive/2009/12/30/Windows-7-Web-Browser-Control-will-not -浏览文件系统.aspx](http://blogs.msdn.com/ieinternals/archive/2009/12/30/Windows-7-Web-Browser-Control-will-not-browse-file-system.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-03T12:58:35.097

我编写了一个用于在 .NET 应用程序中嵌入 Windows 资源管理器的开源库。你可以看看[http://gong-shell.sourceforge.net/](http://gong-shell.sourceforge.net/)

它公开 WinForms 控件，并为 Windows Shell 提供 .NET 语言接口。它是在 GPL 下获得许可的，因此在类似许可的应用程序中使用它是免费的，但是如果您想在商业应用程序中使用它，请给我发电子邮件，我相信我们可以解决问题！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-02T22:41:32.567

我的答案中的方法不是我一定会推荐的，因为它基本上是一个巨大的黑客。但是，可以将几乎任何 Windows 应用程序“托管”在另一个应用程序中。注意事项：

*   这是一个大胖黑客
*   我完全不确定它与 Vista 中的各种安全功能的性能如何
*   您将一直使用低级且有时文档不足的 API，并且做的事情与原始设计者的预期不同。
*   我不太了解各种 API，无法准确告诉您该怎么做，所以这是一个非常粗略的草图......

基本方法是：

1.  启动一个新的 explorer.exe 进程
2.  获取它的 HWnd
3.  使用 p/invoke 调用各种 Windows API（主要是 shell32.dll），将其重新设置为您自己的 NativeWindow 或 UserControl。
4.  然后，您可以用自己的 WndProc 消息处理程序替换它，将其子类化以注入您自己的应用程序特定行为。（[C++ 示例](http://www.codeproject.com/KB/miscctrl/subclassdemo.aspx)；[stackoverflow 问题](https://stackoverflow.com/questions/200924/in-c-i-have-a-intptr-to-a-win32-wndproc-what-is-the-syntax-for-calling-it)WRT 调用旧的/默认的 WndProc；[谷歌搜索](http://letmegooglethatforyou.com/?q=c%23+wndproc+subclass)会产生很多答案。我之前在 C# 和（ick）VBA 中做过这个）这将让你用你自己的替换各种 UI 行为，虽然在一个非常低的水平。（这取决于资源管理器的具体实现方式：菜单点击等高级操作可以获取自己的消息，因此更容易处理；但资源管理器行为的其他方面可能只会得到原始鼠标消息。）

您需要[Spy++](http://msdn.microsoft.com/en-us/library/aa264396(VS.60).aspx)来确定什么时候发生的消息。

是的，这是构建许多非常丑陋和脆弱的代码的好方法，但它（a）有时是让事情正常工作的唯一方法；(b) 非常适合了解 Windows.Forms / MFC / 等的幕后情况。

# security - "Bobby Tables" XKCD 漫画中的 SQL 注入是如何工作的？

> ID：332365
> 
> 赞同：1166
> 
> 时间：2008-12-01T21:50:10.220
> 
> 标签：security, validation, sql-injection

只是看着：

![XKCD 条](https://i.stack.imgur.com/G0ifh.png "她的女儿叫Help，我被困在一家驾照工厂。") *（来源：[https](https://xkcd.com/327/) ://xkcd.com/327/ ）*

这个 SQL 做了什么：

```
Robert'); DROP TABLE STUDENTS; -- 
```

我都知道`'`并且是为了发表评论，但由于它是同一行的一部分，所以`--`这个词也没有得到评论吗？`DROP`

* * *

## 回答 #1

> 赞同：1175
> 
> 时间：2008-12-01T21:50:58.753

**它掉落了学生表。**

学校程序中的原始代码可能看起来像

```
q = "INSERT INTO Students VALUES ('" + FNMName.Text + "', '" + LName.Text + "')"; 
```

这是将文本输入添加到查询中的幼稚方法，并且*非常糟糕*，正如您将看到的那样。

在名字、中间名文本框*FNMName.Text*（即`Robert'); DROP TABLE STUDENTS; --`）和姓氏文本框*LName.Text*（我们称之为`Derper`）的值与查询的其余部分连接之后，结果现在实际上是*两个查询*，由[语句终止符](http://en.wikipedia.org/wiki/SQL#Language_elements)（分号）。第二个查询已**注入**第一个查询。当代码对数据库执行此查询时，它将如下所示

```
INSERT INTO Students VALUES ('Robert'); DROP TABLE Students; --', 'Derper') 
```

用简单的英语，大致翻译为两个查询：

> 将名称值为“罗伯特”的新记录添加到学生表

和

> 删除学生表

第二个查询之后的所有内容都[标记为注释](http://msdn.microsoft.com/en-us/library/ms181627.aspx)： `--', 'Derper')`

学生姓名中的`'`不是评论，它是结束[字符串 delimiter](http://msdn.microsoft.com/en-us/library/ms179899.aspx)。由于学生的姓名是一个字符串，因此在语法上需要它来完成假设查询。注入攻击仅*在它们注入的 SQL 查询产生有效的 SQL*时才起作用。

^(^(根据[dan04](https://stackoverflow.com/users/287586/dan04)的精明评论***再次***编辑))

* * *

## 回答 #2

> 赞同：644
> 
> 时间：2008-12-01T21:55:08.683

假设名称在变量中使用，`$Name`. 然后运行此查询：

```
INSERT INTO Students VALUES ( '$Name' ) 
```

该代码错误地将用户提供的任何内容作为变量放置。您希望 SQL 是：

> 插入学生价值观 (' `Robert Tables``)

但是聪明的用户可以提供他们想要的任何东西：

> 插入学生价值观（' `Robert'); DROP TABLE Students; --`'）

你得到的是：

```
INSERT INTO Students VALUES ( 'Robert' );  DROP TABLE STUDENTS; --' ) 
```

唯一注释该`--`行的其余部分。

* * *

## 回答 #3

> 赞同：171
> 
> 时间：2011-09-14T10:12:21.957

正如其他人已经指出的那样，`');`关闭原始语句，然后是第二条语句。大多数框架，包括像 PHP 这样的语言，现在都有默认的安全设置，不允许在一个 SQL 字符串中使用多个语句。`mysqli_multi_query`例如，在 PHP 中，使用该函数只能在一个 SQL 字符串中运行多条语句。

但是，您可以通过 SQL 注入操作现有的 SQL 语句，而无需添加第二条语句。假设您有一个登录系统，它通过这个简单的选择检查用户名和密码：

```
$query="SELECT * FROM users WHERE username='" . $_REQUEST['user'] . "' and (password='".$_REQUEST['pass']."')";
$result=mysql_query($query); 
```

如果您提供`peter`用户名和`secret`密码，则生成的 SQL 字符串将如下所示：

```
SELECT * FROM users WHERE username='peter' and (password='secret') 
```

一切安好。现在假设您提供此字符串作为密码：

```
' OR '1'='1 
```

那么生成的 SQL 字符串将是这样的：

```
SELECT * FROM users WHERE username='peter' and (password='' OR '1'='1') 
```

这将使您能够在不知道密码的情况下登录任何帐户。因此，您不需要能够使用两个语句来使用 SQL 注入，尽管如果您能够提供多个语句，您可以做更具破坏性的事情。

* * *

## 回答 #4

> 赞同：72
> 
> 时间：2008-12-01T22:01:41.367

不，`'`不是 SQL 中的注释，而是分隔符。

妈妈认为数据库程序员提出的请求如下所示：

```
INSERT INTO 'students' ('first_name', 'last_name') VALUES ('$firstName', '$lastName'); 
```

（例如）添加新学生，其中`$xxx`变量内容直接从 HTML 表单中取出，不检查格式也不转义特殊字符。

所以如果`$firstName`包含`Robert'); DROP TABLE students; --`数据库程序将直接在数据库上执行以下请求：

```
INSERT INTO 'students' ('first_name', 'last_name') VALUES ('Robert'); DROP TABLE students; --', 'XKCD'); 
```

IE。它会提前终止插入语句，执行破解者想要的任何恶意代码，然后注释掉可能存在的任何剩余代码。

嗯，我太慢了，我已经在橙色带中看到了 8 个答案...... :-) 似乎是一个热门话题。

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2011-09-26T20:20:57.627

## TL;博士

```
-- 应用程序接受输入，在本例中为“Nancy”，但不尝试
-- 清理输入，例如转义特殊字符
学校=> 插入学生价值观（“南希”）；
插入 0 1

-- SQL 注入发生在数据库命令的输入被操纵到
-- 使数据库服务器执行任意 SQL
学校=> 插入学生价值观（“罗伯特”）；DROP TABLE 学生；--');
插入 0 1
删除表

——学生记录现在不见了——情况可能更糟！
学校=> 从学生中选择 *；
错误：关系“学生”不存在
第 1 行：从学生中选择 *；
                      ^

```

* * *

### 这将删除（删除）学生表。

（*此答案中的所有代码示例均在 PostgreSQL 9.1.2 数据库服务器上运行。*）

为了弄清楚发生了什么，让我们用一个只包含名称字段的简单表来试试这个并添加一行：

```
school=> CREATE TABLE 学生（名称 TEXT PRIMARY KEY）；
注意：CREATE TABLE / PRIMARY KEY 将为表“students”创建隐式索引“students_pkey”
创建表
学校=> 插入学生价值观（“约翰”）；
插入 0 1

```

假设应用程序使用以下 SQL 向表中插入数据：

```
插入学生价值观（'foobar'）；

```

替换`foobar`为学生的实际姓名。正常的插入操作如下所示：

```
-- 输入：南希
学校=> 插入学生价值观（“南希”）；
插入 0 1

```

当我们查询表时，我们得到：

```
学校=> 从学生中选择 *；
 姓名
--------
 约翰
 南希
(2 行)

```

当我们将 Little Bobby Tables 的名字插入到表中时会发生什么？

```
-- 输入：罗伯特'); DROP TABLE 学生；--
学校=> 插入学生价值观（“罗伯特”）；DROP TABLE 学生；--');
插入 0 1
删除表

```

这里的 SQL 注入是学生的名字终止语句并包含一个单独的`DROP TABLE`命令的结果；输入末尾的两个破折号旨在注释掉任何可能导致错误的剩余代码。输出的最后一行确认数据库服务器已删除该表。

重要的是要注意，在`INSERT`操作过程中，应用程序不会检查输入是否有任何特殊字符，因此允许将任意输入输入到 SQL 命令中。这意味着恶意用户可以在通常用于用户输入的字段中插入特殊符号（例如引号）以及任意 SQL 代码，以使数据库系统执行它，从而导致[SQL *注入*](http://en.wikipedia.org/wiki/SQL_injection)。

结果？

```
学校=> 从学生中选择 *；
错误：关系“学生”不存在
第 1 行：从学生中选择 *；
                      ^

```

SQL 注入是数据库等价于操作系统或应用程序中的远程[任意代码执行漏洞。](http://en.wikipedia.org/wiki/Arbitrary_code_execution)成功的 SQL 注入攻击的潜在影响不可低估——取决于数据库系统和应用程序配置，攻击者可以利用它来导致数据丢失（如本例所示）、未经授权访问数据，甚至执行主机本身上的任意代码。

正如 XKCD 漫画所指出的，防止 SQL 注入攻击的一种方法是清理数据库输入，例如转义特殊字符，这样它们就无法修改底层 SQL 命令，因此不会导致执行任意 SQL 代码。这可以在应用程序级别完成，并且参数化查询的一些实现通过清理输入来操作。

但是，在应用程序级别清理输入可能不会阻止更高级的 SQL 注入技术。例如，[有一些方法可以绕过`mysql_real_escape_string`PHP 函数](https://stackoverflow.com/questions/5741187/sql-injection-that-gets-around-mysql-real-escape-string)。为了增加保护，许多数据库系统支持[*准备好的语句*](https://en.wikipedia.org/wiki/Prepared_statement)。如果在后端正确实施，准备好的语句可以通过将数据输入与命令的其余部分在语义上分开来使 SQL 注入成为不可能。

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2008-12-01T21:56:45.060

假设你天真地写了一个这样的学生创建方法：

```
void createStudent(String name) {
    database.execute("INSERT INTO students (name) VALUES ('" + name + "')");
} 
```

有人输入名字`Robert'); DROP TABLE STUDENTS; --`

在数据库上运行的是这个查询：

```
INSERT INTO students (name) VALUES ('Robert'); DROP TABLE STUDENTS --') 
```

分号结束插入命令并开始另一个；-- 注释掉该行的其余部分。执行 DROP TABLE 命令...

这就是为什么绑定参数是一件好事。

* * *

## 回答 #7

> 赞同：29
> 
> 时间：2008-12-01T22:03:23.440

单引号是字符串的开始和结束。分号是语句的结尾。因此，如果他们正在做这样的选择：

```
Select *
From Students
Where (Name = '<NameGetsInsertedHere>') 
```

SQL 将变为：

```
Select *
From Students
Where (Name = 'Robert'); DROP TABLE STUDENTS; --')
--             ^-------------------------------^ 
```

在某些系统上，`select`将首先运行，然后是`drop`语句！消息是：不要将值嵌入到您的 SQL 中。而是使用参数！

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2008-12-01T21:53:49.230

结束查询，`');`不开始评论。然后它删除学生表并注释应该执行的其余查询。

* * *

## 回答 #9

> 赞同：19
> 
> 时间：2008-12-01T21:56:30.100

在这种情况下，`'`不是注释字符。它用于分隔字符串文字。漫画家认为，有问题的学校在某处有动态 sql，看起来像这样：

```
$sql = "INSERT INTO `Students` (FirstName, LastName) VALUES ('" . $fname . "', '" . $lname . "')"; 
```

所以现在`'`字符在程序员期待它之前结束了字符串文字。结合`;`结束语句的字符，攻击者现在可以添加（注入）他们想要的任何 sql。最后的`--`注释是为了确保原始语句中的任何剩余 sql 都不会阻止查询在服务器上编译。

FWIW，我也认为有问题的漫画有一个重要的细节错误：如果你***清理***你的数据库输入，正如漫画所暗示的那样，你仍然做错了。相反，您应该考虑***隔离***数据库输入，正确的方法是通过参数化查询/准备好的语句。

* * *

## 回答 #10

> 赞同：18
> 
> 时间：2008-12-01T21:54:33.613

SQL 中的`'`字符用于字符串常量。在这种情况下，它用于结束字符串常量而不是用于注释。

* * *

## 回答 #11

> 赞同：18
> 
> 时间：2008-12-01T21:55:04.547

数据库的作者可能做了一个

```
sql = "SELECT * FROM STUDENTS WHERE (STUDENT_NAME = '" + student_name + "') AND other stuff";
execute(sql); 
```

如果 student_name 是给定的，则使用名称“Robert”进行选择，然后删除表。“--”部分将给定查询的其余部分更改为注释。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2013-12-02T10:17:02.697

它是这样工作的：假设管理员正在查找学生的记录

```
Robert'); DROP TABLE STUDENTS; -- 
```

由于管理员帐户具有高权限，因此可以从此帐户中删除表。

从请求中检索用户名的代码是

现在查询将是这样的（搜索学生表）

```
String query="Select * from student where username='"+student_name+"'";

statement.executeQuery(query); //Rest of the code follows 
```

结果查询变为

```
Select * from student where username='Robert'); DROP TABLE STUDENTS; -- 
```

由于未对用户输入进行清理，因此上述查询被分为两部分

```
Select * from student where username='Robert'); 

DROP TABLE STUDENTS; -- 
```

双破折号 (--) 只会注释掉查询的剩余部分。

这很危险，因为它可以使密码身份验证无效（如果存在）

第一个将进行正常搜索。

如果帐户具有足够的权限，则第二个将删除表学生（通常学校管理员帐户将运行此类查询并具有上述权限）。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2019-07-30T22:04:55.057

# 您不需要输入表单数据来进行 SQL 注入。

之前没有人指出这一点，所以我可能会提醒你们中的一些人。

大多数情况下，我们会尝试修补表单输入。但这并不是您可能受到 SQL 注入攻击的唯一地方。您可以使用通过 GET 请求发送数据的 URL 进行非常简单的攻击；考虑下面的例子：

```
<a href="/show?id=1">show something</a> 
```

您的网址看起来 [http://yoursite.com/show?id=1](http://yoursite.com/show?id=1)

现在有人可以尝试这样的事情

```
http://yoursite.com/show?id=1;TRUNCATE table_name 
```

尝试将 table_name 替换为真实的表名。如果他把你的桌子名字写对了，他们就会清空你的桌子！**（很容易用简单的脚本强行这个 URL）**

您的查询看起来像这样......

```
"SELECT * FROM page WHERE id = 4;TRUNCATE page" 
```

### 使用 PDO 的 PHP 易受攻击代码示例：

```
<?php
...
$id = $_GET['id'];

$pdo = new PDO($database_dsn, $database_user, $database_pass);
$query = "SELECT * FROM page WHERE id = {$id}";
$stmt = $pdo->query($query);
$data = $stmt->fetch(); 
/************* You have lost your data!!! :( *************/
... 
```

### 解决方案 - 使用 PDO prepare() & bindParam() 方法：

```
<?php
...
$id = $_GET['id'];

$query = 'SELECT * FROM page WHERE id = :idVal';
$stmt = $pdo->prepare($query);
$stmt->bindParam('idVal', $id, PDO::PARAM_INT);
$stmt->execute();
$data = $stmt->fetch();
/************* Your data is safe! :) *************/
... 
```

# c# - 如何将 C# 代码组织到文件中？

> ID：332370
> 
> 赞同：14
> 
> 时间：2008-12-01T21:52:11.760
> 
> 标签：c#, code-organization

在 C# 中，创建什么类型、应该拥有什么成员以及应该拥有什么名称空间等问题都是面向对象设计的问题。它们不是我在这里感兴趣的问题。

相反，我想问一下您如何将这些存储在磁盘工件中。以下是一些示例规则：

*   将程序集的所有类型放在一个源文件中。一位这样做的朋友说“文件是一种古老的代码组织工具；今天我使用 classview 和 Collapse to Definitions 来浏览我的代码”。

*   将所有代码放在一个程序集中。使部署和版本控制更简单。

*   目录结构反映命名空间结构。

*   每个命名空间都有自己的程序集。

*   每种类型都有自己的程序集。（作为一个极端的例子列出。）

*   每种类型都有自己的源文件。

*   每个成员都有自己的文件；每种类型都有自己的目录。（作为一个极端的例子列出。）

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-01T22:01:52.803

无论你做什么，请始终如一地去做。我不相信有任何一个单一的答案（尽管有一些错误的答案）。但请确保您忠实于您的表格，因为这将是您的继任者轻松找到事物的关键。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-01T21:52:42.383

目前我做：

*   用于生产代码 + 单元测试的一个程序集
*   目录结构模仿命名空间
*   每个文件一种类型
    *   嵌套类型使用类型获取自己的文件`partial`。那是：

```

```
// ------ C.cs

public partial class C : IFoo
{
    // ...
}

// ------ C.Nested.cs
partial class C
{
    public class Nested
    {
        // ...
    }
} 
```

            回答 #3

赞同：3

时间：2008-12-01T22:04:04.500

我做的很相似。我有一点不同：

*   每个文件一种类型

我在需要它们的地方声明委托类型，即不在它们自己的文件中，而是在使用它们的类中。

            回答 #4

赞同：3

时间：2008-12-01T22:33:16.313

我为每个架构层创建一个程序集。（WinUI.exe、BusinessWorkflow.dll、BusinessComponent.dll 等。

然后，每个班级一个物理文件。

这就是“垂直”。

从概念上讲，命名空间是水平的，将域级功能组合在一起。所有客户的东西都放在“客户”命名空间中，例如，订单放在“Accounting.AccountsPayable”中。

由于每个程序集仅引用其下方的程序集 - 在架构上，您的智能感知受到域模型中相关引用的良好约束。

（尽管必须同意上述观点 - 一致性至关重要。

            回答 #5

赞同：1

时间：2008-12-01T22:05:38.973

对于少于十二个类的小型项目，每个文件只有一个类。

对于企业项目，我在一个解决方案中有多个项目。它们按用途（业务类、接口、UI）分组。每个类都有自己的文件。

            回答 #6

赞同：1

时间：2008-12-02T03:50:16.500

无论类型有多小，都将每种类型放入单独的文件中 - 例外：嵌套类和委托

顺便说一句，仅出于将嵌套类型放置在自己的文件中的目的而​​使用分部类进行分离似乎有点矫枉过正。部分类应谨慎使用，通常用于文件生成工具 - 您必须考虑如何为嵌套类“命名”部分类。为物理嵌套文件取一个直观的名称可能很麻烦，而且这绝对不是一项简单的任务。

对于项目，命名您的项目以反映命名空间 - 例外：当嵌套命名空间变大时，我会将嵌套文件夹迁移到另一个项目中。

            回答 #7

赞同：0

时间：2008-12-01T22:09:07.873

我更喜欢传统的每个公共类一个文件，项目内的文件夹（映射到子目录）用于根据需要对概念上相关的类进行分组，以保持解决方案资源管理器视图的可管理性。如果您的类名选择得当，则文件夹不应该是绝对必要的，但如果项目有很多类，它们会很有帮助。

为嵌套类型使用单独的文件似乎有点过头了，至少如果嵌套类是相对简单的“帮助”类，尤其是如果它们是私有的。

对您朋友的“一个大文件中的所有内容”方案的主要实际反对意见是，Visual Studio 在尝试处理非常长的代码文件时往往会变得非常非常慢。

            回答 #8

赞同：0

时间：2008-12-01T22:15:49.513

无论哪种语言，我都喜欢这种组织。

相关的小类在他们自己的文件中。

大类在他们自己的文件中。

单独子项目的目录。

        jquery - jQuery Accordion：链接不起作用

ID：332384

赞同：4

时间：2008-12-01T21:56:06.450

标签：jquery, accordion

我正在使用 jQuery 的[手风琴 UI 元素](http://docs.jquery.com/UI/Accordion)处理页面。我在那个例子上建模了我的 HTML，除了在`<li>`元素内部，我有一些无序列表的链接。像这样：

```
 $(document).ready(function() {
     $(".ui-accordion-container").accordion(
        {active: "a.default", alwaysOpen: true, autoHeight: false}
     );
  });

  <ul class="ui-accordion-container">
  <li> <!-- Start accordion section -->
   <a href='#' class="accordion-label">A Group of Links</a>
   <ul class="linklist">
      <li><a href="http://example.com">Example Link</a></li>
      <li><a href="http://example.com">Example Link</a></li>
   </ul>

   <!--and of course there's another group --> 
```

问题：链接不起作用
在我测试过的所有浏览器中，这些手风琴菜单中的链接会导致**手风琴部分折叠**，而不是将您带到链接页面。（我仍然可以右键单击并转到链接的站点。）
这可能是某种点击绑定问题吗？

            回答 #1

赞同：10

时间：2008-12-01T22:57:22.690

默认情况下，accordian 小部件将所有链接设置为标题。要更改它，您需要指定带有`headers`选项的选择器。因此，您的代码将如下所示：

```
$(".ui-accordion-container").accordion(
   { active: "a.default", ...,  header: "a.accordion-label" }
); 
```

            回答 #2

赞同：8

时间：2013-07-16T16:34:18.133

尝试添加防止事件冒泡的内联 onlick：

```
...
<a href='#' onclick="event.stopPropagation()" class="accordion-label">A Group of Links</a>
... 
```

或者像这样的 domready 事件：

```
$(".toggle-title a").click(function(event){ event.stopPropagation()}) 
```

然而后者对我不起作用，即使代码明智它是有道理的，jQuery 执行点击！任何可以向我解释的人都可以放心，我来自 MooTools 和具有 addEvent 功能的 Google Closure 背景。

            回答 #3

赞同：4

时间：2009-07-28T17:23:50.227

我遇到了同样的问题，在任何地方都找不到答案。事实上，一些消息人士表示，这只是无法完成。

进一步玩后，我确实找到了一个可行的解决方案。可能不是很好，但它就像一个魅力。

首先，只需确保您希望可点击且不受手风琴控件影响的链接易于识别。我有我的课。

```
 $('.stats a').click(function(){
expander.accordion('disable');
window.open($(this).attr('href'));

setTimeout ( function() {
  expander.accordion('enable');
}, 250 ); 
```

});

本质上，这会监听手风琴标题内的链接何时被单击。如果是这样，手风琴会暂时禁用，使其无法正常发射。然后在新窗口中打开链接，但您也可以使用 document.location

如果我们立即重新启用手风琴，它仍然会触发并切换手风琴。我发现超短超时提供了足够的延迟。

希望这对某人有帮助！

            回答 #4

赞同：2

时间：2009-10-25T23:10:53.913

这是一个非常简单的解决方案

[http://www.designerstalk.com/forums/help-me/41297-jquery-accordion-embedding-links-help-needed.html](http://www.designerstalk.com/forums/help-me/41297-jquery-accordion-embedding-links-help-needed.html)

            回答 #5

赞同：0

时间：2009-05-19T11:34:57.863

AlwaysOpen 应该是真的。

            回答 #6

赞同：0

时间：2009-07-28T17:49:31.860

可能是我的建议是不使用手风琴（）函数，[我以前不知道，谢谢你提出来 :)] 但仍然展示了如何拥有手风琴 UI 元素。

**HTML**

```
<body id="body">
    <h2>Accordian</h2>
        <div id="accordion" class="">

                <div class="toggle_all">
                        <ul class="links">
                                <li><a class="openall" href="#"><span>Open All</span></a></li>
                                <li>|</li>
                                <li><a class="closeall" href="#"><span>Close All</span></a></li>
                        </ul>
                </div>

                <!-- toggleAll ends -->
                <div class="accordion">
                        <div class="section_title_accordion design-gray">
                                <h3><a href="#" class="open"><span>Lorem ipsum</span></a></h3>
                        </div>
                        <!-- section_title_accordion ends -->
                        <div class="accordion_content"> <span class="content">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</span> </div>

                        <!-- accordion_content ends -->
                </div>
                <!-- accordion ends -->
                <div class="accordion">
                        <div class="section_title_accordion design-gray">
                                <h3><a href="#" class="open"><span>Lorem ipsum</span></a></h3>
                        </div>
                        <!-- section_title_accordion ends -->

                        <div class="accordion_content"> <span class="content">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</span> </div>
                        <!-- accordion_content ends -->
                </div>
                <!-- accordion ends -->
                <div class="accordion">
                        <div class="section_title_accordion design-gray">
                                <h3><a href="#" class="open"><span>Lorem ipsum</span></a></h3>

                        </div>
                        <!-- section_title_accordion ends -->
                        <div class="accordion_content"> <span class="content">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</span> </div>
                        <!-- accordion_content ends -->
                </div>
                <!-- accordion ends -->
        </div>

        <!-- #accordion ends -->
</body> 
```

**CSS**

```
<style type="text/css" >
#body { margin-left:20%; font:12px verdana; }
.accordion { width:500px; }
h3 { margin:0; padding:0; }
.section_title_accordion { float:left; width:500px; margin:2px 0 0; }
.section_title_accordion h3 span { margin:0; float:left; color:#fff; padding:2px 0 3px 10px; }
.section_title_accordion a span { padding-left:20px; }
.accordion_content { border-bottom:1px solid #666666; border-left:1px solid #666666; border-right:1px solid #666666; float:left; padding:5px 3px; }
.accordion_content span.content { margin:5px 0 0; }
.design-gray { background:#003366; }
.design-gray a { color:#fff; float:left; width:100%; height:22px; background:#003366; text-decoration:none; }
.design-gray a:hover { text-decoration:underline;}
.on .design-gray a { color:#fff; float:left; width:100%; height:22px; background:#003366;}
.accordion_content_hover { background:#ffffcc; color:#000099; }
.toggle_all { padding:20px 0; width:500px; margin-bottom:5px; }
.toggle_all ul { padding:0; margin:0; }
.toggle_all ul li { list-style-type:none; }
.toggle_all .links li { float:left; padding-left:5px; }
.toggle_all .links li a, .toggleAll .links span { color:#666666; }
</style> 
```

**jQuery**

```
<script language="javascript" type="text/javascript">

$(document).ready(function() {
  $(".accordion_content").hide();
  $("a.open").click(function() {
    $(this).parents(".accordion").find(".accordion_content").toggle();
        $(this).parents(".accordion").toggleClass('on');    
        return false;
  });   

    $(".accordion_content").mouseover(function() {
            $(this).addClass('accordion_content_hover');
            return false;       
    });

    $(".accordion_content").mouseout(function() {
            $(this).removeClass('accordion_content_hover');
            return false;       
    });

    $("a.openall").click(function() {
        $(".accordion_content").show();
        $(this).parents("#accordion").find(".accordion").addClass('on');
        return false;
    });
    $("a.closeall").click(function() {
          $(".accordion_content").hide();
          $(this).parents("#accordion").find(".accordion").removeClass('on');
        return false;
    });
});
</script> 
```

希望这可以帮助。

            回答 #7

赞同：0

时间：2010-07-15T00:49:40.620

解决方案
[http://www.colorizate.com/jquery-acordion-hack-link-interno/](http://www.colorizate.com/jquery-acordion-hack-link-interno/)

            回答 #8

赞同：0

时间：2012-02-22T11:01:11.660

对于仍然遇到此问题的任何人，这是一个可能的替代脚本：http:
 [//twostepmedia.co.uk/notes/development/jquery-accordion/](http://twostepmedia.co.uk/notes/development/jquery-accordion/)

            回答 #9

赞同：-1

时间：2008-12-01T22:45:03.993

正如我对您的另一个问题的回答所说：

```
 navigation: true 
```

应该在您的选项列表中设置。

        c# - 是否可以序列化 LINQ 对象？

ID：332390

赞同：14

时间：2008-12-01T21:57:33.467

标签：c#, linq, linq-to-sql, serialization

我想序列化一些 LINQ 生成的对象并将它们作为二进制字段存储在表中（不管你为什么）。我希望能够编写一些看起来像这样的代码：

```
SerialTestDataContext db = new SerialTestDataContext();

relation_table row = db.relation_tables.First();

MemoryStream memStream = new MemoryStream();
BinaryFormatter bin = new BinaryFormatter();
bin.Serialize(memStream, row);
Console.WriteLine("Serilized successfully");

TestTable tt = new testTable();
tt.data = new System.Data.Linq.Binary(memStream.ToArray());
db.testTables.InsertOnSubmit(tt);
db.SubmitChanges();
Console.WriteLine("Inserted successfully"); 
```

目前即使我已将生成的类标记为 [Serializable] 也会失败，因为 LINQ 继承的类之一不是。甚至有可能做到这一点吗？

            回答 #1

赞同：18

时间：2008-12-01T22:32:20.307

使用 linq-to-sql（来自标签），然后是的：您可以将 dmbl 标记为可序列化，它使用 [DataContract]/[DataMember] 方法。您可以通过在设计器中将“序列化模式”设置为“单向”来执行此操作，或者您可以在 dbml 本身中执行此操作：

```
<Database ... Serialization="Unidirectional">... 
```

然后，您可以使用 DataContractSerializer 或 NetDataContractSerializer 来编写它（分别作为 xml 或二进制文件）。如果您需要一些可移植的东西（即不是 MS/.NET 特定的），那么[protobuf-net](http://code.google.com/p/protobuf-net/)将使用“协议缓冲区”规范序列化数据合同。

            回答 #2

赞同：6

时间：2008-12-02T15:32:05.477

按照 Marc Gravell 的建议，我编写了以下两个运行良好的代码块：

```
relation_table row = db.relation_tables.First();

MemoryStream memStream = new MemoryStream();
NetDataContractSerializer ndcs = new NetDataContractSerializer();
ndcs.Serialize(memStream, row);

byte[] stuff = memStream.toArray();

memStream = new MemoryStream(stuff);
row = ndcs.Deserialize(memStream);

db.relation_tables.Attach(row);
Console.WriteLine(row.data_table1.somedata + ": " + row.more_data); 
```

Attach() 调用为我填写外键依赖项并将项目与数据上下文相关联。

            回答 #3

赞同：5

时间：2008-12-01T22:12:31.580

MSDN：[序列化（LINQ to SQL）](http://msdn.microsoft.com/en-us/library/bb546184.aspx)

            回答 #4

赞同：3

时间：2008-12-01T22:06:01.953

Linq 类是部分类。您可以更改定义以将类标记为实现[ISerializable](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.iserializable.aspx)，然后提供代码...

```
public partial class User : ISerializable
{
  // implement GetObjectData here
} 
```

但是，反序列化可能仍然存在问题（我不是 100% 的）。另一种方法是使用 xml 序列化并实现[IXmlSerializable](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.aspx)，它具有序列化和反序列化的方法，允许您控制整个过程......

        c# - 在 .net (c#) 中检查重解析点的最佳方法是什么？

ID：332397

赞同：4

时间：2008-12-01T22:00:09.123

标签：c#, .net, ntfs, reparsepoint

我的功能几乎是一个标准的搜索功能......我已经将它包含在下面。

在函数中，我有 1 行代码负责清除 Repart NTFS 点。

```
if (attributes.ToString().IndexOf("ReparsePoint") == -1) 
```

问题是现在我收到一个错误 
`Access to the path 'c:\System Volume Information' is denied.`

我调试了代码，该目录在运行时的唯一属性是：

```
 System.IO.FileAttributes.Hidden 
| System.IO.FileAttributes.System 
| System.IO.FileAttributes.Directory 
```

我正在 Windows 2008 服务器机器上执行此代码，有什么想法可以解决此故障吗？

```
public void DirSearch(string sDir)
{
    foreach (string d in Directory.GetDirectories(sDir))
    {
        DirectoryInfo dInfo = new DirectoryInfo(d);
        FileAttributes  attributes = dInfo.Attributes;
        if (attributes.ToString().IndexOf("ReparsePoint") == -1)
        {
            foreach (string f in Directory.GetFiles(d, searchString))
            {
                //lstFilesFound.Items.Add(f);
                ListViewItem lvi;
                ListViewItem.ListViewSubItem lvsi;
                lvi = new ListViewItem();
                lvi.Text = f;
                lvi.ImageIndex = 1;
                lvi.Tag = "tag";
                lvsi = new ListViewItem.ListViewSubItem();
                lvsi.Text = "sub bugger";
                lvi.SubItems.Add(lvsi);

                lvsi = new ListViewItem.ListViewSubItem();
                lvsi.Text = d;//"C:\\Users\\Administrator\\Downloads\\MediaMonkey.GOLD.EDITION.v.3.0.2.1134.[Darkside].[Demonoid].[Grim.Reaper]";
                lvi.SubItems.Add(lvsi);

                listView1.Items.Add(lvi);
            }
            DirSearch(d);
        }
    }
} 
```

            回答 #1

赞同：18

时间：2008-12-01T22:04:24.140

我不确定问题的答案是什么，但*请*更改您的属性检查以使用正确的按位运算！

```
if (attributes.ToString().IndexOf("ReparsePoint") == -1) 
```

... 更正确地写为 ...

```
if ((attributes & FileAttributes.ReparsePoint) == 0) 
```

            回答 #2

赞同：3

时间：2008-12-01T22:04:59.363

除了 SYSTEM 帐户，没有人有权访问系统卷信息。所以要么更改目录的权限。或者更好地捕获异常并继续。

            回答 #3

赞同：1

时间：2008-12-01T22:08:38.640

也许这篇文章可以帮助你（他们解释了如何访问这个文件夹）：

[http://support.microsoft.com/kb/309531](http://support.microsoft.com/kb/309531)

绝望的解决方案是try-catch。

            回答 #4

赞同：0

时间：2018-06-27T23:06:15.037

一旦你获得了过去的权限，并且真的想测试连接点，[这个类](https://www.codeproject.com/script/articles/viewdownloads.aspx?aid=15633&zep=junctionpoint.cs&rzp=%2Fkb%2Ffiles%2Fjunctionpointsnet%2F%2Fjunctionpointsnet_src.zip)通过使用 DeviceIoControl kernel32 调用和分析重解析点来提供连接点的测试、创建和删除。

        perl - 为什么进行简单的编辑然后上传会使我的网站崩溃？

ID：332398

赞同：1

时间：2008-12-01T22:01:04.317

标签：perl

每当我更改（甚至只是重新保存而不更改）Perl 文件时，它都会完全关闭我们的后端。我不知道问题可能是什么。权限是正确的。编码正确。编码为 UTF-8。传输模式为 ASCII。

我可能不会过多地处理 Perl，但我不知道问题可能是什么。托管我们网站的网络管理员不知道问题可能是什么。

我尝试过的文本编辑器：Dreamweaver、TextMate、Vim 我尝试过的操作系统：Mac OS X、Linux (Ubuntu) 我尝试过的 FTP 客户端：Transmit (Mac)、Filezilla (Linux (Ubuntu))

并不是代码不好，我什至尝试打开并单独保存，但我的后端仍然出现故障。

网络管理员告诉我，他通过一个 dos2unix 转换器运行了这些文件，并且立即生效。我当然尝试过，但它没有，更多所以它没有任何意义，因为我在一些最受尊敬的编辑器中尝试过这个，我认为没有任何用户它不会对文件类型做出如此剧烈的改变输入。（当我说受人尊敬的编辑 Dreamweaver 不包括在这种情绪中）。

我个人认为这是某种服务器端问题，因为对于任何可能的客户端问题，我已经越过了我的 t 并点缀了我的 i，但我已经尝试了一切。关于这个问题的根源是什么以及任何可能的解决方案有什么意见吗？提前致谢。

            回答 #1

赞同：4

时间：2008-12-01T22:50:25.247

尝试在您的 FTP 客户端中设置二进制模式。这将允许您在客户端尝试不同的行尾（dos2unix），而不必担心它们在传输过程中被翻译。

            回答 #2

赞同：3

时间：2008-12-01T23:06:30.923

我过去遇到过这个问题，换行确实是罪魁祸首。您的编辑器和/或 FTP 程序可能会破坏换行符。在服务器上运行 dos2unix 是对问题的一个很好的测试，但不是原因。

在保存和传输的每个步骤之后生成文件的 MD5 散列，以查找更改的位置。

            回答 #3

赞同：1

时间：2008-12-01T22:46:51.980

听起来您在传输之前使用的是 dos2unix，但之后网络管理员正在使用它。在这种情况下，也许它正在做一些不同的事情。

文件中有多少行？保存之前和之后、传输之后以及传输并在其上运行 dos2unix 之后的文件大小是多少？

如果这只是一个行尾问题，您可以将您的网络管理员指向[http://www.perlmonks.org/?node_id=586942](http://www.perlmonks.org/?node_id=586942)。

            回答 #4

赞同：1

时间：2008-12-01T22:04:58.943

您没有说您使用的是哪种框架/服务器。

也许服务器在文件仍在由 FTP 或其他方式写入时重新加载文件？（即服务器读取时文件不完整？）

文件上传后服务器重启会解决问题吗？

            回答 #5

赞同：0

时间：2008-12-01T22:27:16.993

对rebra的回应：没有使用任何框架，也不知道这是在什么服务器上。这基本上是一个共享主机上的单人项目，维护得非常糟糕，我正在努力打扫房子。

是的，这确实有道理，我问过服务器人员，这实际上是我的第一个问题，但即使是这样，我也无法通过 Plesk（有点像 cPanel）重新启动。但是谢谢你，你用技术词汇/解释我一直在想什么。

        sharepoint - Sharepoint 自定义筛选器 Web 部件

ID：332405

赞同：3

时间：2008-12-01T22:02:58.260

标签：sharepoint, filter, web-parts

我想创建一个自定义 Web 部件，它具有超过 1 个筛选器 Web 部件，并且可以在运行时/设计时连接到报表查看器 Web 部件（集成模式）。

我为此进行了很多搜索，但找不到一种方法来让单个 Web 部件成为多个过滤器的提供者。

比如说——

1.  我`Report`接受 2 个参数`Department`和`Region`.  
2.  我想将这两个参数与具有两个下拉菜单的单个 Web 部件连接起来（一个用于`Department`，一个用于`Region`）
3.  下拉菜单中的值都应传递给`Department`and`Region`
4.  `Report`应在报表查看器 Web 部件中呈现

**到目前为止尝试过的解决方案**

1.  创建一个添加两个自定义下拉列表的 Web 部件
2.  实现的自定义下拉类`ITransformableFilterValues`
3.  在 web pat 上有 2 个方法，每个方法都有`ConnectionProvider`属性并返回下拉控件的实例

**问题：**

即使我的自定义筛选器 Web 部件上显示了 2 个连接选项，也只能添加一个。例如，如果我连接`Filter1`（自定义 Web 部件）`Department`然后我无法再次将它连接到`Report Viewer`Web 部件。

我的 Web 部件有这样的方法：

```
[ConnectionProvider("Departmet", "UniqueIDForDept", AllowsMultipleConnections = true)] 
public ITransformableFilterValues ReturnCity() 
{ 
    return dropDownDepartment; // It implemets ITransformableFilterValues 
} 

[ConnectionProvider("Region", "UniqueIDForRegion", AllowsMultipleConnections = true)] 
public ITransformableFilterValues ReturnMyRegionB() 
{ 
    return dropDownRegion; //It implemets ITransformableFilterValues 
} 
```

            回答 #1

赞同：0

时间：2009-08-06T21:17:56.853

不知道你是否能够解决你的问题..

实际上我尝试过`AllowsMultipleConnections = true`并且效果很好：

```
using System;
using System.Runtime.InteropServices;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Serialization;

using Microsoft.SharePoint;

using aspnetwebparts = System.Web.UI.WebControls.WebParts;
using Microsoft.Office.Server.Utilities;
using wsswebparts = Microsoft.SharePoint.WebPartPages;
using Microsoft.SharePoint.Portal.WebControls;
using System.Collections.ObjectModel;
using System.Collections.Generic;
using Microsoft.SharePoint.Utilities;

namespace FromMultiSource
{
    [Guid("a0d068dd-9475-4055-a219-88513e173502")]
    public class MultiSource : aspnetwebparts.WebPart
    {
        List<wsswebparts.IFilterValues> providers = new List<wsswebparts.IFilterValues>();
        public MultiSource()
        {
        }

        [aspnetwebparts.ConnectionConsumer("Multiple Source Consumer", "IFilterValues", AllowsMultipleConnections = true)]
        public void SetConnectionInterface(wsswebparts.IFilterValues provider)
        {
            this.providers.Add(provider);
            if (provider != null)
            {
                List<wsswebparts.ConsumerParameter> l = new List<wsswebparts.ConsumerParameter>();
                l.Add (new wsswebparts.ConsumerParameter ("Value", wsswebparts.ConsumerParameterCapabilities.SupportsMultipleValues | Microsoft.SharePoint.WebPartPages.ConsumerParameterCapabilities.SupportsAllValue));
                provider.SetConsumerParameters(new ReadOnlyCollection<wsswebparts.ConsumerParameter>(l));
            }
        }

        protected override void CreateChildControls()
        {
            base.CreateChildControls();

            // TODO: add custom rendering code here.
            // Label label = new Label();
            // label.Text = "Hello World";
            // this.Controls.Add(label);
        }

        protected override void RenderContents(HtmlTextWriter writer)
        {
            base.RenderContents(writer);
            this.EnsureChildControls();
            foreach (wsswebparts.IFilterValues provider in this.providers)
            {
                if (provider != null)
                {
                    string prop = provider.ParameterName;
                    ReadOnlyCollection<string> values = provider.ParameterValues;
                    if (prop != null && values != null)
                    {
                        writer.Write("<div>" + SPEncode.HtmlEncode(prop) + ":</div>");
                        foreach (string v in values)
                        {
                            if (v == null)
                            {
                                writer.Write("<div>&nbsp;&nbsp;<i>&quot;(empty)&quot;/null</i></div>");
                            }
                            else if (v.Length == 0)
                            {
                                writer.Write("<div>&nbsp;&nbsp;<i>empty string</i></div>");
                            }
                            else
                            {
                                writer.Write("<div>&nbsp;&nbsp;" + v + "</div>");
                            }
                        }
                    }
                    else
                    {
                        writer.Write("<div>No filter specified (all).</div>");
                    }

                }
                else
                {
                    writer.Write("<div>Not connected.</div>");
                }

                writer.Write("<hr>");
            }
        }
    }
} 
```

            回答 #2

赞同：0

时间：2008-12-04T19:09:50.807

我做了类似的事情。这可能有助于为您指明正确的方向。我使用表单库中的数据来创建详细报告。我使用报告服务并使用 Web 服务连接到共享点。[http://server/_vti_bin/Lists.asmx](http://server/_vti_bin/Lists.asmx)。我使用的报告参数是项目 ID 或 GUID。然后我配置了我的报告查看器。在表单库中，我使用 JavaScript 覆盖上下文菜单以添加“查看报告”。在报告页面上，我使用查询字符串过滤器从 url 中获取项目 ID。

        javascript - Get the name of an object's type

ID：332422

赞同：1277

时间：2008-12-01T22:06:15.680

标签：javascript

Is there a **JavaScript** equivalent of **Java**'s `class.getName()`?

            回答 #1

赞同：1632

时间：2008-12-01T22:09:09.807

Is there a JavaScript equivalent of Java's `class.getName()`?

***No***.
**ES2015 Update**: [the name of `class Foo {}` is `Foo.name`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name#Function_names_in_classes).  The name of `thing`'s class, regardless of `thing`'s type, is `thing.constructor.name`. Builtin constructors in an ES2015 environment have the correct `name` property; for instance `(2).constructor.name` is `"Number"`.

But here are various hacks that all fall down in one way or another:
Here is a hack that will do what you need - be aware that it modifies the Object's prototype, something people frown upon (usually for good reason)

```
Object.prototype.getName = function() { 
   var funcNameRegex = /function (.{1,})\(/;
   var results = (funcNameRegex).exec((this).constructor.toString());
   return (results && results.length > 1) ? results[1] : "";
}; 
```

Now, all of your objects will have the function, `getName()`, that will return the name of the constructor as a string. I have tested this in `FF3` and `IE7`, I can't speak for other implementations.
If you don't want to do that, here is a discussion on the various ways of determining types in JavaScript...

I recently updated this to be a bit more exhaustive, though it is hardly that. Corrections welcome...
Using the `constructor` property...
Every `object` has a value for its `constructor` property, but depending on how that `object` was constructed as well as what you want to do with that value, it may or may not be useful.
Generally speaking, you can use the `constructor` property to test the type of the object like so:

```
var myArray = [1,2,3];
(myArray.constructor == Array); // true 
```

So, that works well enough for most needs. That said...
Caveats
**Will not work *AT ALL* in many cases**
This pattern, though broken, is quite common:

```
function Thingy() {
}
Thingy.prototype = {
    method1: function() {
    },
    method2: function() {
    }
}; 
```

`Objects` constructed via `new Thingy` will have a `constructor` property that points to `Object`, not `Thingy`. So we fall right at the outset; you simply cannot trust `constructor` in a codebase that you don't control.
**Multiple Inheritance**
An example where it isn't as obvious is using multiple inheritance:

```
function a() { this.foo = 1;}
function b() { this.bar = 2; }
b.prototype = new a(); // b inherits from a 
```

Things now don't work as you might expect them to:

```
var f = new b(); // instantiate a new object with the b constructor
(f.constructor == b); // false
(f.constructor == a); // true 
```

So, you might get unexpected results if the `object` your testing has a different `object` set as its `prototype`. There are ways around this outside the scope of this discussion.
There are other uses for the `constructor` property, some of them interesting, others not so much; for now we will not delve into those uses since it isn't relevant to this discussion.
**Will not work cross-frame and cross-window**
Using `.constructor` for type checking will break when you want to check the type of objects coming from different `window` objects, say that of an iframe or a popup window. This is because there's a different version of each core type `constructor` in each `window', i.e.

```
iframe.contentWindow.Array === Array // false 
```

Using the `instanceof` operator...
The `instanceof` operator is a clean way of testing `object` type as well, but has its own potential issues, just like the `constructor` property.

```
var myArray = [1,2,3];
(myArray instanceof Array); // true
(myArray instanceof Object); // true 
```

But `instanceof` fails to work for literal values (because literals are not `Objects`)

```
3 instanceof Number // false
'abc' instanceof String // false
true instanceof Boolean // false 
```

The literals need to be wrapped in an `Object` in order for `instanceof` to work, for example

```
new Number(3) instanceof Number // true 
```

The `.constructor` check works fine for literals because the `.` method invocation implicitly wraps the literals in their respective object type

```
3..constructor === Number // true
'abc'.constructor === String // true
true.constructor === Boolean // true 
```

Why two dots for the 3? Because Javascript interprets the first dot as a decimal point ;)
Will not work cross-frame and cross-window
`instanceof` also will not work across different windows, for the same reason as the `constructor` property check.

Using the `name` property of the `constructor` property...
Does not work *AT ALL* in many cases
Again, see above; it's quite common for `constructor` to be utterly and completely wrong and useless.
Does NOT work in <IE9
Using `myObjectInstance.constructor.name` will give you a string containing the name of the `constructor` function used, but is subject to the caveats about the `constructor` property that were mentioned earlier.
For IE9 and above, you can [monkey-patch in support](http://matt.scharley.me/2012/03/monkey-patch-name-ie.html):

```
if (Function.prototype.name === undefined && Object.defineProperty !== undefined) {
    Object.defineProperty(Function.prototype, 'name', {
        get: function() {
            var funcNameRegex = /function\s+([^\s(]+)\s*\(/;
            var results = (funcNameRegex).exec((this).toString());
            return (results && results.length > 1) ? results[1] : "";
        },
        set: function(value) {}
    });
} 
```

**Updated version** from the article in question. This was added 3 months after the article was published, this is the recommended version to use by the article's author Matthew Scharley. This change was inspired by [comments pointing out potential pitfalls](http://matt.scharley.me/2012/03/monkey-patch-name-ie.html#comment-551654096) in the previous code.

```
if (Function.prototype.name === undefined && Object.defineProperty !== undefined) {
    Object.defineProperty(Function.prototype, 'name', {
        get: function() {
            var funcNameRegex = /function\s([^(]{1,})\(/;
            var results = (funcNameRegex).exec((this).toString());
            return (results && results.length > 1) ? results[1].trim() : "";
        },
        set: function(value) {}
    });
} 
```

Using Object.prototype.toString
It turns out, as [this post details](http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/), you can use `Object.prototype.toString` - the low level and generic implementation of `toString` - to get the type for all built-in types

```
Object.prototype.toString.call('abc') // [object String]
Object.prototype.toString.call(/abc/) // [object RegExp]
Object.prototype.toString.call([1,2,3]) // [object Array] 
```

One could write a short helper function such as

```
function type(obj){
    return Object.prototype.toString.call(obj).slice(8, -1);
} 
```

to remove the cruft and get at just the type name

```
type('abc') // String 
```

However, it will return `Object` for all user-defined types.

Caveats for all...
All of these are subject to one potential problem, and that is the question of how the object in question was constructed. Here are various ways of building objects and the values that the different methods of type checking will return:

```
// using a named function:
function Foo() { this.a = 1; }
var obj = new Foo();
(obj instanceof Object);          // true
(obj instanceof Foo);             // true
(obj.constructor == Foo);         // true
(obj.constructor.name == "Foo");  // true

// let's add some prototypical inheritance
function Bar() { this.b = 2; }
Foo.prototype = new Bar();
obj = new Foo();
(obj instanceof Object);          // true
(obj instanceof Foo);             // true
(obj.constructor == Foo);         // false
(obj.constructor.name == "Foo");  // false

// using an anonymous function:
obj = new (function() { this.a = 1; })();
(obj instanceof Object);              // true
(obj.constructor == obj.constructor); // true
(obj.constructor.name == "");         // true

// using an anonymous function assigned to a variable
var Foo = function() { this.a = 1; };
obj = new Foo();
(obj instanceof Object);      // true
(obj instanceof Foo);         // true
(obj.constructor == Foo);     // true
(obj.constructor.name == ""); // true

// using object literal syntax
obj = { foo : 1 };
(obj instanceof Object);            // true
(obj.constructor == Object);        // true
(obj.constructor.name == "Object"); // true 
```

While not all permutations are present in this set of examples, hopefully there are enough to provide you with an idea about how messy things might get depending on your needs. Don't assume anything, if you don't understand exactly what you are after, you may end up with code breaking where you don't expect it to because of a lack of grokking the subtleties.
NOTE:
Discussion of the `typeof` operator may appear to be a glaring omission, but it really isn't useful in helping to identify whether an `object` is a given type, since it is very simplistic. Understanding where `typeof` is useful is important, but I don't currently feel that it is terribly relevant to this discussion. My mind is open to change though. :)

            回答 #2

赞同：143

时间：2008-12-01T22:21:14.307

Jason Bunting's answer gave me enough of a clue to find what I needed:

```
<<Object instance>>.constructor.name 
```

So, for example, in the following piece of code:

```
function MyObject() {}
var myInstance = new MyObject(); 
```

`myInstance.constructor.name` would return `"MyObject"`.

            回答 #3

赞同：27

时间：2011-06-16T22:25:37.553

A little trick I use:

```
function Square(){
    this.className = "Square";
    this.corners = 4;
}

var MySquare = new Square();
console.log(MySquare.className); // "Square" 
```

            回答 #4

赞同：19

时间：2011-08-28T15:59:20.923

Update
To be precise, I think OP asked for a function that retrieves the constructor name for a particular object. In terms of Javascript, `object` does not have a type but is a type **of and in itself**. However, different objects can have different **constructors**.

```
Object.prototype.getConstructorName = function () {
   var str = (this.prototype ? this.prototype.constructor : this.constructor).toString();
   var cname = str.match(/function\s(\w*)/)[1];
   var aliases = ["", "anonymous", "Anonymous"];
   return aliases.indexOf(cname) > -1 ? "Function" : cname;
}

new Array().getConstructorName();  // returns "Array"
(function () {})().getConstructorName(); // returns "Function" 
```

**Note:** the below example is deprecated.
A [blog post](http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/) linked by [Christian Sciberras](https://stackoverflow.com/questions/332422/how-do-i-get-the-name-of-an-objects-type-in-javascript/3826081#3826081) contains a good example on how to do it. Namely, by extending the Object prototype:

```
if (!Object.prototype.getClassName) {
    Object.prototype.getClassName = function () {
        return Object.prototype.toString.call(this).match(/^\[object\s(.*)\]$/)[1];
    }
}

var test = [1,2,3,4,5];

alert(test.getClassName()); // returns Array 
```

            回答 #5

赞同：14

时间：2012-03-24T12:26:57.830

**Using Object.prototype.toString**

It turns out, as this post details, you can use Object.prototype.toString - the low level and generic implementation of toString - to get the type for all built-in types

```
Object.prototype.toString.call('abc') // [object String]
Object.prototype.toString.call(/abc/) // [object RegExp]
Object.prototype.toString.call([1,2,3]) // [object Array] 
```

One could write a short helper function such as

```
function type(obj){
    return Object.prototype.toString.call(obj]).match(/\s\w+/)[0].trim()
}

return [object String] as String
return [object Number] as Number
return [object Object] as Object
return [object Undefined] as Undefined
return [object Function] as Function 
```

            回答 #6

赞同：10

时间：2012-03-05T14:42:01.613

Here is a solution that I have come up with that solves the shortcomings of instanceof. It can check an object's types from cross-windows and cross-frames and doesn't have problems with primitive types.

```
function getType(o) {
    return Object.prototype.toString.call(o).match(/^\[object\s(.*)\]$/)[1];
}
function isInstance(obj, type) {
    var ret = false,
    isTypeAString = getType(type) == "String",
    functionConstructor, i, l, typeArray, context;
    if (!isTypeAString && getType(type) != "Function") {
        throw new TypeError("type argument must be a string or function");
    }
    if (obj !== undefined && obj !== null && obj.constructor) {
        //get the Function constructor
        functionConstructor = obj.constructor;
        while (functionConstructor != functionConstructor.constructor) {
            functionConstructor = functionConstructor.constructor;
        }
        //get the object's window
        context = functionConstructor == Function ? self : functionConstructor("return window")();
        //get the constructor for the type
        if (isTypeAString) {
            //type is a string so we'll build the context (window.Array or window.some.Type)
            for (typeArray = type.split("."), i = 0, l = typeArray.length; i < l && context; i++) {
                context = context[typeArray[i]];
            }
        } else {
            //type is a function so execute the function passing in the object's window
            //the return should be a constructor
            context = type(context);
        }
        //check if the object is an instance of the constructor
        if (context) {
            ret = obj instanceof context;
            if (!ret && (type == "Number" || type == "String" || type == "Boolean")) {
                ret = obj.constructor == context
            }
        }
    }
    return ret;
} 
```

isInstance requires two parameters: an object and a type. The real trick to how it works is that it checks if the object is from the same window and if not gets the object's window.

Examples:

```
isInstance([], "Array"); //true
isInstance("some string", "String"); //true
isInstance(new Object(), "Object"); //true

function Animal() {}
function Dog() {}
Dog.prototype = new Animal();

isInstance(new Dog(), "Dog"); //true
isInstance(new Dog(), "Animal"); //true
isInstance(new Dog(), "Object"); //true
isInstance(new Animal(), "Dog"); //false 
```

The type argument can also be a callback function which returns a constructor. The callback function will receive one parameter which is the window of the provided object.

Examples:

```
//"Arguments" type check
var args = (function() {
    return arguments;
}());

isInstance(args, function(w) {
    return w.Function("return arguments.constructor")();
}); //true

//"NodeList" type check
var nl = document.getElementsByTagName("*");

isInstance(nl, function(w) {
    return w.document.getElementsByTagName("bs").constructor;
}); //true 
```

One thing to keep in mind is that IE < 9 does not provide the constructor on all objects so the above test for NodeList would return false and also a isInstance(alert, "Function") would return false.

            回答 #7

赞同：10

时间：2013-12-07T13:00:29.370

I was actually looking for a similar thing and came across this question. Here is how I get types: [jsfiddle](http://jsfiddle.net/9fsqy/2/)

```
var TypeOf = function ( thing ) {

    var typeOfThing = typeof thing;

    if ( 'object' === typeOfThing ) {

        typeOfThing = Object.prototype.toString.call( thing );

        if ( '[object Object]' === typeOfThing ) {

            if ( thing.constructor.name ) {
                return thing.constructor.name;
            } 

            else if ( '[' === thing.constructor.toString().charAt(0) ) {
                typeOfThing = typeOfThing.substring( 8,typeOfThing.length - 1 );
            } 

            else {

                typeOfThing = thing.constructor.toString().match( /function\s*(\w+)/ );

                if ( typeOfThing ) { 
                    return typeOfThing[1];
                } 

                else {
                    return 'Function';
                }
            }
        } 

        else {
            typeOfThing = typeOfThing.substring( 8,typeOfThing.length - 1 );
        }
    }

    return typeOfThing.charAt(0).toUpperCase() + typeOfThing.slice(1);
} 
```

            回答 #8

赞同：8

时间：2018-08-28T21:34:02.690

You should use `somevar.constructor.name` like a:

```
 const getVariableType = a => a.constructor.name.toLowerCase();

    const d = new Date();
    const res1 = getVariableType(d); // 'date'
    const num = 5;
    const res2 = getVariableType(num); // 'number'
    const fn = () => {};
    const res3 = getVariableType(fn); // 'function'

    console.log(res1); // 'date'
    console.log(res2); // 'number'
    console.log(res3); // 'function'
```

            回答 #9

赞同：7

时间：2011-08-12T19:38:06.957

Use `constructor.name` when you can, and regex function when I can't.

```
Function.prototype.getName = function(){
  if (typeof this.name != 'undefined')
    return this.name;
  else
    return /function (.+)\(/.exec(this.toString())[1];
}; 
```

            回答 #10

赞同：7

时间：2013-10-23T15:04:46.000

The **kind()** function from [Agave.JS](https://www.npmjs.com/package/agave) will return:

*   the closest prototype in the inheritance tree
*   for always-primitive types like 'null' and 'undefined', the primitive name.

It works on all JS objects and primitives, **regardless of how they were created**, and doesn't have any surprises.

```
var kind = function(item) {
        var getPrototype = function(item) {
            return Object.prototype.toString.call(item).slice(8, -1);
        };
        var kind, Undefined;
        if (item === null ) {
            kind = 'null';
        } else {
            if ( item === Undefined ) {
                kind = 'undefined';
            } else {
                var prototype = getPrototype(item);
                if ( ( prototype === 'Number' ) && isNaN(item) ) {
                    kind = 'NaN';
                } else {
                    kind = prototype;
                }
            }
        }
        return kind;
    }; 
```

Examples:
Numbers

```
kind(37) === 'Number'
kind(3.14) === 'Number'
kind(Math.LN2) === 'Number'
kind(Infinity) === 'Number'
kind(Number(1)) === 'Number'
kind(new Number(1)) === 'Number' 
```

NaN

```
kind(NaN) === 'NaN' 
```

Strings

```
kind('') === 'String'
kind('bla') === 'String'
kind(String("abc")) === 'String'
kind(new String("abc")) === 'String' 
```

Booleans

```
kind(true) === 'Boolean'
kind(false) === 'Boolean'
kind(new Boolean(true)) === 'Boolean' 
```

Arrays

```
kind([1, 2, 4]) === 'Array'
kind(new Array(1, 2, 3)) === 'Array' 
```

Objects

```
kind({a:1}) === 'Object'
kind(new Object()) === 'Object' 
```

Dates

```
kind(new Date()) === 'Date' 
```

Functions

```
kind(function(){}) === 'Function'
kind(new Function("console.log(arguments)")) === 'Function'
kind(Math.sin) === 'Function' 
```

undefined

```
kind(undefined) === 'undefined' 
```

null

```
kind(null) === 'null' 
```

            回答 #11

赞同：7

时间：2017-01-04T05:55:05.483

Here is an implementation based on [the accepted answer](https://stackoverflow.com/a/332429/14731):

```
/**
 * Describes the type of a variable.
 */
class VariableType
{
    type;
    name;

    /**
     * Creates a new VariableType.
     *
     * @param {"undefined" | "null" | "boolean" | "number" | "bigint" | "array" | "string" | "symbol" |
     *  "function" | "class" | "object"} type the name of the type
     * @param {null | string} [name = null] the name of the type (the function or class name)
     * @throws {RangeError} if neither <code>type</code> or <code>name</code> are set. If <code>type</code>
     * does not have a name (e.g. "number" or "array") but <code>name</code> is set.
     */
    constructor(type, name = null)
    {
        switch (type)
        {
            case "undefined":
            case "null":
            case "boolean" :
            case "number" :
            case "bigint":
            case "array":
            case "string":
            case "symbol":
                if (name !== null)
                    throw new RangeError(type + " may not have a name");
        }
        this.type = type;
        this.name = name;
    }

    /**
     * @return {string} the string representation of this object
     */
    toString()
    {
        let result;
        switch (this.type)
        {
            case "function":
            case "class":
            {
                result = "a ";
                break;
            }
            case "object":
            {
                result = "an ";
                break;
            }
            default:
                return this.type;
        }
        result += this.type;
        if (this.name !== null)
            result += " named " + this.name;
        return result;
    }
}

const functionNamePattern = /^function\s+([^(]+)?\(/;
const classNamePattern = /^class(\s+[^{]+)?{/;

/**
 * Returns the type information of a value.
 *
 * <ul>
 *   <li>If the input is undefined, returns <code>(type="undefined", name=null)</code>.</li>
 *   <li>If the input is null, returns <code>(type="null", name=null)</code>.</li>
 *   <li>If the input is a primitive boolean, returns <code>(type="boolean", name=null)</code>.</li>
 *   <li>If the input is a primitive number, returns <code>(type="number", name=null)</code>.</li>
 *   <li>If the input is a primitive or wrapper bigint, returns
 *   <code>(type="bigint", name=null)</code>.</li>
 *   <li>If the input is an array, returns <code>(type="array", name=null)</code>.</li>
 *   <li>If the input is a primitive string, returns <code>(type="string", name=null)</code>.</li>
 *   <li>If the input is a primitive symbol, returns <code>(type="symbol", null)</code>.</li>
 *   <li>If the input is a function, returns <code>(type="function", name=the function name)</code>. If the
 *   input is an arrow or anonymous function, its name is <code>null</code>.</li>
 *   <li>If the input is a function, returns <code>(type="function", name=the function name)</code>.</li>
 *   <li>If the input is a class, returns <code>(type="class", name=the name of the class)</code>.
 *   <li>If the input is an object, returns
 *   <code>(type="object", name=the name of the object's class)</code>.
 *   </li>
 * </ul>
 *
 * Please note that built-in types (such as <code>Object</code>, <code>String</code> or <code>Number</code>)
 * may return type <code>function</code> instead of <code>class</code>.
 *
 * @param {object} value a value
 * @return {VariableType} <code>value</code>'s type
 * @see <a href="http://stackoverflow.com/a/332429/14731">http://stackoverflow.com/a/332429/14731</a>
 * @see isPrimitive
 */
function getTypeInfo(value)
{
    if (value === null)
        return new VariableType("null");
    const typeOfValue = typeof (value);
    const isPrimitive = typeOfValue !== "function" && typeOfValue !== "object";
    if (isPrimitive)
        return new VariableType(typeOfValue);
    const objectToString = Object.prototype.toString.call(value).slice(8, -1);
    // eslint-disable-next-line @typescript-eslint/ban-types
    const valueToString = value.toString();
    if (objectToString === "Function")
    {
        // A function or a constructor
        const indexOfArrow = valueToString.indexOf("=>");
        const indexOfBody = valueToString.indexOf("{");
        if (indexOfArrow !== -1 && (indexOfBody === -1 || indexOfArrow < indexOfBody))
        {
            // Arrow function
            return new VariableType("function");
        }
        // Anonymous and named functions
        const functionName = functionNamePattern.exec(valueToString);
        if (functionName !== null && typeof (functionName[1]) !== "undefined")
        {
            // Found a named function or class constructor
            return new VariableType("function", functionName[1].trim());
        }
        const className = classNamePattern.exec(valueToString);
        if (className !== null && typeof (className[1]) !== "undefined")
        {
            // When running under ES6+
            return new VariableType("class", className[1].trim());
        }
        // Anonymous function
        return new VariableType("function");
    }
    if (objectToString === "Array")
        return new VariableType("array");

    const classInfo = getTypeInfo(value.constructor);
    return new VariableType("object", classInfo.name);
}

function UserFunction()
{
}

function UserClass()
{
}

let anonymousFunction = function()
{
};

let arrowFunction = i => i + 1;

console.log("getTypeInfo(undefined): " + getTypeInfo(undefined));
console.log("getTypeInfo(null): " + getTypeInfo(null));
console.log("getTypeInfo(true): " + getTypeInfo(true));
console.log("getTypeInfo(5): " + getTypeInfo(5));
console.log("getTypeInfo(\"text\"): " + getTypeInfo("text"));
console.log("getTypeInfo(userFunction): " + getTypeInfo(UserFunction));
console.log("getTypeInfo(anonymousFunction): " + getTypeInfo(anonymousFunction));
console.log("getTypeInfo(arrowFunction): " + getTypeInfo(arrowFunction));
console.log("getTypeInfo(userObject): " + getTypeInfo(new UserClass()));
console.log("getTypeInfo(nativeObject): " + getTypeInfo(navigator.mediaDevices.getUserMedia));
```

We only use the constructor property when we have no other choice.

            回答 #12

赞同：6

时间：2008-12-01T22:13:00.753

You can use the [`instanceof`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Special_Operators/instanceof_Operator) operator to see if an object is an instance of another, but since there are no classes, you can't get a class name.

            回答 #13

赞同：3

时间：2008-12-02T18:52:15.680

You can use the "instanceof" operator to determine if an object is an instance of a certain class or not. If you do not know the name of an object's type, you can use its constructor property. The constructor property of objects, is a reference to the function that is used to initialize them. Example:

```
function Circle (x,y,radius) {
    this._x = x;
    this._y = y;
    this._radius = raduius;
}
var c1 = new Circle(10,20,5); 
```

Now c1.constructor is a reference to the `Circle()` function.
You can alsow use the `typeof` operator, but the `typeof` operator shows limited information. One solution is to use the `toString()` method of the Object global object. For example if you have an object, say myObject, you can use the `toString()` method of the global Object to determine the type of the class of myObject. Use this:

```
Object.prototype.toString.apply(myObject); 
```

            回答 #14

赞同：3

时间：2017-08-02T19:35:28.777

Say you have `var obj;`

If you just want the name of obj's type, like "Object", "Array", or "String",
you can use this:

```
Object.prototype.toString.call(obj).split(' ')[1].replace(']', ''); 
```

            回答 #15

赞同：2

时间：2008-12-01T22:22:04.243

The closest you can get is [`typeof`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Special_Operators/typeof_Operator), but it only returns "object" for any sort of custom type. For those, see [Jason Bunting](https://stackoverflow.com/questions/332422/how-do-i-get-the-name-of-an-object-in-javascript#332429).

Edit, Jason's deleted his post for some reason, so just use Object's `constructor` property.

            回答 #16

赞同：0

时间：2014-07-29T11:49:15.773

If anyone was looking for a solution which is working with jQuery, here is the adjusted wiki code (the original breaks jQuery).

```
Object.defineProperty(Object.prototype, "getClassName", {
    value: function() {
        var funcNameRegex = /function (.{1,})\(/;
        var results = (funcNameRegex).exec((this).constructor.toString());
        return (results && results.length > 1) ? results[1] : "";
    }
}); 
```

            回答 #17

赞同：0

时间：2015-09-24T17:00:42.710

Lodash has many isMethods so if you're using Lodash maybe a mixin like this can be useful:

```
 // Mixin for identifying a Javascript Object

  _.mixin({
      'identify' : function(object) {
        var output;
          var isMethods = ['isArguments', 'isArray', 'isArguments', 'isBoolean', 'isDate', 'isArguments', 
              'isElement', 'isError', 'isFunction', 'isNaN', 'isNull', 'isNumber', 
              'isPlainObject', 'isRegExp', 'isString', 'isTypedArray', 'isUndefined', 'isEmpty', 'isObject']

          this.each(isMethods, function (method) {
              if (this[method](object)) {
                output = method;
                return false;
              }
          }.bind(this));
      return output;
      }
  }); 
```

It adds a method to lodash called "identify" which works as follow:

```
console.log(_.identify('hello friend'));       // isString 
```

Plunker:
[http://plnkr.co/edit/Zdr0KDtQt76Ul3KTEDSN](http://plnkr.co/edit/Zdr0KDtQt76Ul3KTEDSN)

            回答 #18

赞同：0

时间：2015-12-19T07:27:17.207

Ok, folks I've been slowly building a catch all method for this over some years lol!  The trick is to:

  1.  Have a mechanism for creating classes.
  2.  Have a mechanism for checking all user created classes, primitives and values created/generated by native constructors.
  3.  Have a mechanism for extending user created classes into new ones so that the above functionality permeates through your code/application/library/etc..

For an example (or to see how I dealt with the problem) look at the following code on github: [https://github.com/elycruz/sjljs/blob/master/src/sjl/sjl.js](https://github.com/elycruz/sjljs/blob/master/src/sjl/sjl.js) and search for:

`classOf =`, 
`classOfIs =`, and or
`defineSubClass =` (without the backticks (`)).  

As you can see I have some mechanisms in place to force `classOf` to always give me the classes/constructors type name regardless of whether it is a primitive, a user defined class, a value created using a native constructor, Null, NaN, etc..  For every single javascript value I will get it's unique type name from the `classOf` function.  In addition I can pass in actual constructors into `sjl.classOfIs` to check a value's type in addition to being able to pass in it's type name as well!  So for example:

```
    // Please forgive long namespaces!  I had no idea on the impact until after using them for a while (they suck haha)

```
var SomeCustomClass = sjl.package.stdlib.Extendable.extend({
    constructor: function SomeCustomClass () {},
    // ...
}),

HelloIterator = sjl.ns.stdlib.Iterator.extend( 
    function HelloIterator () {}, 
    { /* ... methods here ... */ },
    { /* ... static props/methods here ... */ }
),

helloIt = new HelloIterator();

sjl.classOfIs(new SomeCustomClass(), SomeCustomClass) === true; // `true`
sjl.classOfIs(helloIt, HelloIterator) === true; // `true`

var someString = 'helloworld';

sjl.classOfIs(someString, String) === true; // `true`

sjl.classOfIs(99, Number) === true; // true

sjl.classOf(NaN) === 'NaN'; // true

sjl.classOf(new Map()) === 'Map';
sjl.classOf(new Set()) === 'Set';
sjl.classOfIs([1, 2, 4], Array) === true; // `true`

// etc..

// Also optionally the type you want to check against could be the type's name
sjl.classOfIs(['a', 'b', 'c'], 'Array') === true; // `true`!
sjl.classOfIs(helloIt, 'HelloIterator') === true; // `true`! 
```

```

If you are interested in reading more on how I use the setup mentioned above take a look at the repo: [https://github.com/elycruz/sjljs](https://github.com/elycruz/sjljs) 

Also books with content on the subject:
- "JavaScript Patterns" by Stoyan Stefanov.
- "Javascript - The Definitive Guide." by David Flanagan.
- and many others.. (search le` web).

Also you can quickly test the features I'm talking about here: 
- [http://sjljs.elycruz.com/0.5.18/tests/for-browser/](http://sjljs.elycruz.com/0.5.18/tests/for-browser/) (also the 0.5.18 path in the url has the sources from github on there minus the node_modules and such).

Happy Coding!

            回答 #19

赞同：0

时间：2020-05-06T12:10:51.607

Fairly Simple!

*   My favorite method to get type of anything in JS

```
function getType(entity){
    var x = Object.prototype.toString.call(entity)
    return x.split(" ")[1].split(']')[0].toLowerCase()
} 
```

*   my favorite method to check type of anything in JS

```
function checkType(entity, type){
    return getType(entity) === type
} 
```

            回答 #20

赞同：0

时间：2021-02-10T07:04:14.860

For of those of you reading this and want a simple solution that works fairly well and has been tested:

```
const getTypeName = (thing) => {
  const name = typeof thing
  if (name !== 'object') return name
  if (thing instanceof Error) return 'error'
  if (!thing) return 'null'
  return ({}).toString.call(thing).match(/\s([a-zA-Z]+)/)[1].toLowerCase()
} 
```

To get insight on why this works, checkout the polyfill documentation for Array.isArray(): [https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray#polyfill](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray#polyfill)

            回答 #21

赞同：-1

时间：2019-03-28T16:34:36.950

Use `class.name`. This also works with `function.name`.

```
class TestA {}
console.log(TestA.name); // "TestA"

function TestB() {}
console.log(TestB.name); // "TestB" 
```

        asp.net - 您如何处理在 ASP.NET 中将 JavaScript 附加到 UserControls 并保持多个实例隔离？

ID：332431

赞同：0

时间：2008-12-01T22:12:01.613

标签：asp.net, javascript

假设您需要将一些 JavaScript 功能附加到 ASP.NET 用户控件，在任何给定页面上都可能有多个实例。由于 JavaScript 具有共享全局状态，您可以使用哪些技术来保持每个控件实例的客户端状态和行为分开？

            回答 #1

赞同：2

时间：2008-12-01T22:43:12.640

嗯，你可以做的主要事情是确保你的 JavaScript 函数足够抽象，以至于它们不会耦合到 HTML 控件的特定实例——让它们接受允许你传递各种对象实例的参数。

无论您在给定页面上有多少用户控件实例，执行您需要完成的任何魔术的 JavaScript 都应该只在您的页面中存在一次，因此您的函数需要忽略这一事实。

如果没有更多关于你正在尝试做什么的信息，我可以提供的帮助就很少了；这将取决于你的情况。

编辑：我处理这个问题的特定方面的一种方法是在用户控件上创建一个静态属性（因此它是跨多个实例的相同变量）跟踪各种用户控件元素的客户端 ID（用户控件在***控件的***OnLoad 事件中将客户端 ID 添加到此列表中）；然后，在***页面的***OnPreRender 事件 (IIRC) 中，将它们呈现在我的代码知道在客户端上查找并操作的 JavaScript 变量中。我不知道这是否有意义，但它可能会帮助某人......

            回答 #2

赞同：0

时间：2008-12-01T22:51:55.103

```
function <%=this.ClientID %>_myButton_onclick()
{
    DoSomething();
} 
```

和

```
<button id="myButton" onclick="<%=this.ClientID %>_myButton_onclick()"> 
```

请注意，在这种情况下，控件是常规的 HTML 控件。

            回答 #3

赞同：0

时间：2012-03-23T13:28:45.820

如果你的控件有多个功能，你可以把它放在一个外部的js文件中，然后引用它。

```
 this.Page.ClientScript.RegisterClientScriptInclude("searchcontrol.js","includes/searchcontrol.js"); 
```

        c# - 来自 SQLiteConnection 对象的 SQLite .dump 命令

ID：332440

赞同：6

时间：2008-12-01T22:19:01.300

标签：c#, sqlite

使用 .net 中的 SQLite，有没有办法`.dump`从 SQLiteConnection 类访问命令或等效的东西？

            回答 #1

赞同：6

时间：2008-12-03T02:50:55.697

该`.dump`命令是 sqlite 命令行程序 ( `shell.c`) 的一部分，而不是 sqlite 库的一部分。因此，.net 连接类不太可能提供它。

但是，由于 sqlite 命令行程序的源代码在公共域中，并且使用与 .net 包装器相同的库，因此可以将`.dump`命令的 C 代码转换为 C#。[请参阅此文件](http://www.sqlite.org/cvstrac/rlog?f=sqlite/src/shell.c)`do_meta_command`中的函数。

        c - 一个有趣的 C 链表习语

ID：332441

赞同：11

时间：2008-12-01T22:19:43.733

标签：c, idioms

我在一个 C 职位的面试中，他们向我展示了一个我以前从未遇到过的成语。这是一个简化涉及链表的各种算法的实现的技巧，我想知道是否有其他人遇到过这个问题。

假设我们定义了一个链表记录：

```
typedef struct _record
{
    char* value;
    struct _record* next;
} record; 
```

我们需要一个插入新记录的函数，以便整个列表相对于记录中的值保持排序。下面的实现比我使用的任何东西都简单，尽管可读性较差。

```
void insert_sorted(record** r, const char* value)
{
    record* newrec = NULL;
    while(*r && strcmp(value, (*r)->value) > 0)
        r = &((*r)->next); /* move r to point to the next field of the record */
    newrec = malloc(sizeof(record));
    newrec->value = strdup(value);
    newrec->next = *r;
    *r = newrec;
} 
```

当函数被调用时，r 指向链表的头指针。在 while 循环期间，r 被更新为`next`指向在我们要放入新记录的点之前的记录字段。函数的最后一行要么更新列表的头指针（如果插入发生在开头）或`next`上一条记录的字段，这很酷。

几个问题：

*   这个成语有名字还是在任何文献中提到过？

*   C语言中还有其他类似的吗？

我以为我对 C 非常了解，并且很好地理解了指针和间接寻址，但是这个我花了一段时间才完全理解。

            回答 #1

赞同：8

时间：2008-12-01T22:38:43.070

我会说成语是“那种给'c'起坏名声的代码”

*   莫名其妙的聪明
*   毫无根据地紧凑
*   对来电者的惊人副作用
*   malloc 上没有错误处理
*   仅适用于美国英语字符串

            回答 #2

赞同：6

时间：2008-12-01T23:52:49.693

我已经使用与此类似的方法插入二叉树。因为在迭代树时，您通常会在指针变为`NULL`（您跑出树）时停止。

所以要插入，你有 3 个选项，

1：使用一个变量来跟踪迭代指针的先前值。

2：当你要遵循的指针在你遵循它之前为 NULL 时停止，在我看来，它可以工作但稍微不那么优雅。

3：或者更优雅的解决方案是简单地使用指向指针的指针，所以你可以这样做：`*it = new_node();`它会将它添加`NULL`到你树中曾经存在的位置。

对于链表，虽然这段代码工作得很好，但我通常只使用双向链表，这使得在任何位置插入都很容易。

            回答 #3

赞同：4

时间：2008-12-01T22:29:28.487

我没有看到任何我称之为成语的东西。当您在 C 中处理数据结构时，它看起来像是标准编码。

我唯一的抱怨是调用者指针 (*r) 被修改。根据功能的使用，我预计这是一个意想不到的副作用。除了消除意外的副作用外，使用局部变量来扮演 *r 的角色会使代码更具可读性。

            回答 #4

赞同：3

时间：2008-12-01T22:29:55.977

这里的成语是什么？肯定不会执行链表。指针结构的指针的用法？紧凑的循环？

就个人而言，我会使用指针返回值而不是对输入值进行操作。因为看到这种输入数据类型会敲响警钟，这让我在将其传递给您的函数之前复制我的值。

            回答 #5

赞同：3

时间：2008-12-01T23:07:52.950

这是众所周知的事情-双指针迭代（这是我的名字，我不知道正式名称）。目标是能够在单个链表中定位一个位置，然后在该位置*之前*插入（在它之后插入是微不足道的）。天真地实现，这需要两个指针（当前和上一个）和用于列表开头的特殊代码（当 prev == NULL 时）。

我通常编写的代码类似于

```
void insertIntoSorted(Element *&head, Element *newOne)
{
  Element **pp = &head;
  Element *curr;
  while ((curr = *pp) != NULL && less(curr, newOne)) {
    pp = &(pp->next);
  }
  newOne->next = *pp;
  *pp = newOne;
} 
```

更新：

我忘记了这个技巧的另一个目的——一个更重要的目的。它用于从单链表中删除元素：

```
// returns deleted element or NULL when key not found
Element *deleteFromList(Element *&head, const ElementKey &key)
{
  Element **pp = &head;
  Element *curr;
  while ((curr = *pp) != NULL && !keyMatches(curr, key)) {
    pp = &(pp->next);
  }
  if (curr == NULL) return NULL;
  *pp = (*pp)->next; // here is the actual delete
  return curr;
} 
```

            回答 #6

赞同：2

时间：2008-12-01T22:32:10.917

我不知道这是否有名字，或者即使它是一些特殊的习语，但由于现在内存相对丰富，我的链表（语言库不提供它们）是一个特殊的变体，它大大简化了代码.

首先，它们始终是双重链接的，因为这使得在两个方向上的遍历更容易，对于处理和插入/删除操作。

一个“空”列表实际上由两个节点组成，头部和尾部。通过这样做，插入和删除不需要担心他们正在删除的节点是头部还是尾部，他们可以假设它是一个中间节点。

在节点 x 之前插入一个新节点 y 就变得很简单：

```
x -> prev -> next = y
y -> next = x
y -> prev = x -> prev
x -> prev = y 
```

删除节点 x 很简单：

```
x -> prev -> next = x -> next
x -> next -> prev = x -> prev
free x 
```

调整遍历以忽略无关的头尾：

```
n = head -> next
while n != tail
    process n
    n = n -> next 
```

这一切都有助于使代码更容易理解，而无需对边缘情况进行所有特殊处理，代价是几个内存节点。

            回答 #7

赞同：1

时间：2008-12-01T22:52:22.687

与其将新节点的值作为输入/输出参数返回，不如将其作为函数的返回值。这简化了调用代码和函数内部的代码（您可以摆脱所有那些丑陋的双重间接）。

```
record* insert_sorted(const record* head, const char* value) 
```

顺便说一句，您缺少 malloc/strdup 失败案例的错误处理。

            回答 #8

赞同：1

时间：2008-12-10T02:29:21.913

为了回答最初的问题，这被称为以指针为中心的方法，而不是简单的以节点为中心的方法。[amazon.com](https://rads.stackoverflow.com/amzn/click/com/B006R2CSXM)上 Rex Barzee 的“高级编程技术”第 3 章包含一个更好的以指针为中心的方法的示例实现。

            回答 #9

赞同：1

时间：2013-09-01T14:22:46.413

这个习语在“C 上的指针”的第 12 章中给出。这用于将节点插入到没有链表头的链表中。

            回答 #10

赞同：0

时间：2013-09-01T15:03:29.490

我也想出了双指针的这种用法，我用过，但我不是很喜欢。我想出的代码有这个内核来搜索某些对象并将它们从列表中删除：

```
Element** previous = &firstElement, *current;
while((current = *previous)) {
    if(shouldRemove(current)) {
        *previous = current->next;  //delete
    } else {
        previous = &current->next;  //point to next
    }
} 
```

我不喜欢我的代码的原因是两个 if 子句之间的细微差别：语法几乎相同，但效果完全不同。我不认为，我们应该编写像这样微妙的代码，但是以不同的方式编写代码会使代码非常冗长。所以，无论哪种方式都是不好的——你可能会追求简洁或可读性，这是你的选择。

            回答 #11

赞同：0

时间：2014-02-02T17:20:00.487

尽管有这些技巧，变量“r”的作用没有改变吗？调用者如何在调用后告诉“*r”是什么？或执行后，列表的标题是什么？

我不敢相信这可以举例说明（即使在某些书中？！）。我错过了什么吗？

如果您不返回任何指针（如其他人建议的那样），那么我建议您进行以下更改以保留输入的角色。

```
void insert_sorted(record** head, const char* value)
{
    record** r = head;
    bool isSameHead = false;
    record* newrec = NULL;
    while(*r && strcmp(value, (*r)->value) > 0) {
        r = &((*r)->next); isSameHead = true; }
    newrec = malloc(sizeof(record));
    newrec->value = strdup(value);
    newrec->next = *r;
    *r = newrec;
    if (!isSameHead) *head = newrec;
} 
```

实际上，可能另一种更好的方法是使用“虚拟头节点”，它将它的下一个链接到列表的开头。

```
 void insert_sorted(record** head, const char* value)
    {
        record dummyHead;
        dummyHead.next = *head;
        record* r = &dummyHead;
        while(r->next) {
           if(strcmp(value, r->next->value) < 0) 
              break;
           r = r->next;}
        newrec = malloc(sizeof(record));
        newrec->value = strdup(value);
        newrec->next = r->next;
        r->next = newrec;
        *head = dummyHead.next;
    } 
```

        jquery - jQuery Accordion：IE 动画问题

ID：332448

赞同：17

时间：2008-12-01T22:22:14.807

标签：jquery, accordion

更新

我将其设为社区 wiki，原因有以下三个：

*   我不觉得我得到了肯定的答案，但是
*   我早就不再需要答案了，因为我推出了自己的手风琴功能
*   这个问题得到了大量的意见，所以显然很多人仍然感兴趣

因此，如果有人想更改/澄清这个问题并使其成为权威指南，请成为我的客人。

我正在使用 jQuery 的[手风琴 UI 元素](http://docs.jquery.com/UI/Accordion)处理页面。我在那个例子上建模了我的 HTML，除了在`<li>`元素内部，我有一些无序列表的链接。像这样：

```
 $(document).ready(function() {
     $(".ui-accordion-container").accordion(
        {active: "a.default", alwaysOpen: true, autoHeight: false}
     );
  });

  <ul class="ui-accordion-container">
  <li> <!-- Start accordion section -->
   <a href='#' class="accordion-label">A Group of Links</a>
   <ul class="linklist">
      <li><a href="http://example.com">Example Link</a></li>
      <li><a href="http://example.com">Example Link</a></li>
   </ul>

   <!--and of course there's another group --> 
```

问题：IE动画很臭

尽管 IE7 可以很好地为文档的示例手风琴菜单设置动画，但我的有问题。具体来说，页面上的一个手风琴式菜单会急速移动并且内容闪烁。  **我知道这不是 CSS 问题，因为如果我不包含我的 CSS 文件，也会发生同样的事情。**

页面上的另一个手风琴菜单会打开您单击的第一个部分，之后将不会打开任何一个。

这两个问题都是 IE 特有的，如果我使用选项`animated: false`. 但我想保留默认`slide`动画，因为它可以帮助用户了解菜单在做什么。

还有其他方法吗？

            回答 #1

赞同：21

时间：2009-01-28T03:01:44.527

我感受到了你的痛苦！我最近经历了一次荒谬的故障排除，我逐块从母版页和页面布局中撕下所有内容（这实际上是在 SharePoint 中），不断缩小页面。

最终结果是**没有**html 文档的 doc 类型（一些开发人员已将其删除）。缺少 doctype 意味着 IE 7 以 quirks 模式运行，而 JQuery Accordion 发出的内联 CSS 的行为很时髦。

考虑添加：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
```

在您的母版页或 html 文档的顶部（如果尚未定义 doctype）。

实际上有一个专门针对 Quirks Mode 行为的网站。您可以[在此处查看有关 Quirks Mode](http://www.quirksmode.org/css/quirksmode.html)的文章。我[写了一篇文章](http://blog.tylerholmes.com/2009/01/troubleshooting-jquery-accordion.html)，其中包含有关故障排除的更多信息。

            回答 #2

赞同：6

时间：2011-02-27T00:16:12.097

与格式良好的标准 HTML 标记的 IE7 中的所有问题相同。最终奏效的是删除`autoHeight: "false"`和使用`clearStyle: "true"`. 

我还创建了一个 IE < 8 版本的手风琴初始化：

```
if ( $.browser.msie && $.browser.version < 8 ) {
    //ie<8 version
}
else {
    //version for the good browsers
} 
```

            回答 #3

赞同：5

时间：2008-12-02T01:10:45.167

我实际上已经避免使用手风琴插件，因为我发现它对我的需要有点不灵活。我发现最简单和最灵活的手风琴很简单：

```
var accordion = function(toggleEl, accEl) {
    toggleEl.click(function() {
        accEl.slideToggle(function() { });
        return false;
    });
} 
```

对于您的示例，您将像这样使用它：

```
$(document).ready(function() {
    new accordion($("a.accordion-label"), $("ul. linklist"));        
}); 
```

您可以将其用作模板并构建 css 类添加、回调和其他有用的东西，但我发现最终这样做比使用手风琴插件要容易得多。

编辑：带有回调函数的示例代码

```
var accordion = function(toggleEl, accEl, callback) {
    toggleEl.click(function() {
        accEl.slideToggle(callback);
        return false;
    });
}

$(document).ready(function() {
    new accordion($("a.accordion-label"), $("ul. linklist"), function() { /* some callback */ });        
}); 
```

            回答 #4

赞同：2

时间：2009-02-02T17:18:02.043

Ran into the same issue, but this fixed it for IE 6 and 7:

```
$().ready(function(){
  $(".ui-accordion-header").click(function() {
    $(this).next().fadeIn();
  });
)}; 
```

I think it makes the sliding look nicer anyway...

            回答 #5

赞同：2

时间：2009-06-02T01:50:12.450

我有一个类似的问题，我通过添加这个文档类型来解决它。它适用于 IE 和 FF

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd" > 
```

            回答 #6

赞同：1

时间：2009-02-01T22:11:48.537

Change your anchor tags to SPAN tags. I was experiencing the same problem and that worked well. The same goes for DIV tags, IE trips out when those are in the accordion for some reason. Position:Absolute may also freak IE out, fyi

            回答 #7

赞同：1

时间：2010-04-03T07:33:01.110

I'm using JQuery 1.4 and found 

```
<!DOCTYPE html> 
```

is ok for IE6,Chrome too.

            回答 #8

赞同：1

时间：2011-02-14T18:21:36.930

我实际上发现了塞巴斯蒂安的对立面——我在内部内容 DIV 上有最小高度，这导致了生涩的动画。我把它们取下来，情况有所改善。但我不确定这如何与 autoheight 交互 - 根据语法，我的设置为“false”，但我的手风琴似乎肯定忽略了这一点......

            回答 #9

赞同：0

时间：2009-03-29T08:36:50.927

只需将“autoHeight：false”更改为“autoHeight：true”。

            回答 #10

赞同：0

时间：2008-12-01T22:38:43.213

在选项中你应该设置：

```
 navigation: true 
```

            回答 #11

赞同：0

时间：2009-10-29T00:07:29.130

我一直在尝试同样的问题，经过一段时间的折腾，我发现如果你的主 div 中包含一个具有相对定位的元素，它将导致 IE 打开手风琴“生涩”。这就是我正在做的...

```
<div id="accordion">

  <h3 class="oneLine">Asylum</h3>

  <div class="serviceBlockContent">
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque sed augue a enim convallis facilisis. Aenean eu ullamcorper nulla. Ut id urna quis augue bibendum commodo et a quam.</p>
  </div>

</div> 
```

我将 H3 元素位置设置为相对，这导致它在 IE 中中断。希望这会有所帮助。

            回答 #12

赞同：0

时间：2009-07-24T06:43:51.280

有类似的问题，我注意到一些人建议查看 doctypes。我刚刚尝试查看实际的 jQuery UI 站点，他们的演示手风琴在 ie6 中工作得很好，这表明我*的*代码有问题（对我来说更多的侦探工作）。但我也注意到 jquery.UI 站点文档类型很简单`<!DOCTYPE html>` 

            回答 #13

赞同：0

时间：2009-12-21T19:17:07.163

只需更改`autoHeight: false`为`autoHeight: true`--> 它对我有用，但不是我想要的......

发现放置`min-height`IE7 解决了这个问题。

            回答 #14

赞同：0

时间：2009-12-17T21:47:46.210

我遇到了一个问题，手风琴中我的标题下方的 div，在蓝色页面背景上具有白色背景，其背景颜色消失了。有时当悬停在另一个标题元素上时，它会出现；有时在突出显示文本时，它也会再次出现。这很奇怪，只发生在 IE7 中。

应用缩放：1；在 ui-content div 上仅针对 IE7 修复了此问题。

我希望这对某人有所帮助，因为我花了几个小时试图追查这一点。

            回答 #15

赞同：0

时间：2010-02-10T19:52:40.350

尝试使用这个：

```
{active: "a.default", alwaysOpen: "true", autoHeight: "false"} 
```

而不是这个：

```
{active: "a.default", alwaysOpen: true, autoHeight: false} 
```

Explorer 对这种语法有问题。

            回答 #16

赞同：0

时间：2010-06-28T19:35:01.497

我在 IE6 和 IE7 中使用手风琴时遇到了类似的问题，我没有使用手风琴的默认 HTML 结构。奇怪的是，将手风琴元素的水平尺寸固定为一定数量的像素可以解决手风琴动画的问题。为什么？我不知道。但我观察到问题是特定于使用 autoHeight: true 并且问题发生在动画结束时，我假设手风琴元素的高度被重置。我们都知道 IE 不能做数学。

        xml - xpath 中的节点集

ID：332449

赞同：7

时间：2008-12-01T22:22:20.937

标签：xml, xslt, xpath

我正在编写一个 xslt 样式表来将一个 xml 转换为另一个 xml。

这是原始xml的简化版本：

```
 <eml>
        <datatable>
                 <physical>
                     <distribution id="100"/>
                 </physical>
       </datatable>                 

       <software>
           <implementation>
              <distribution id="200"/>
            </implementation>
      </software>
     <additionalMetadata>
        <describes>100</describes>
        <describes>200</describes>
        <describes>300</describes>
        <describes>400</describes>
    </additionalMetadata>
   </eml> 
```

我尝试使用 Xpath 来选择“描述”的节点集，该节点集的值不等于`//physical/distribution`or的 id 值`software/implementation/distribution`。在上述情况下，我想获取节点集：

```
 <deseribes>300</describes>
   <deseribes>400</describes> 
```

（100 和 200 是`//physical/distribution`or  的属性 id 值`software/implementation/distribution`）。

我写了类似的东西：

```
<xsl:with-param name="describes-list" 
                select="./describes[//physical/distribution/@id !=. and
                             //software/implementation/distribution/@id != .] "/> 
```

它适用于上述示例。但是，数据表和软件的元素是可重复的。所以这个xml是有效的：

```
<eml>
    <datatable>
             <physical>
                 <distribution id="100"/>
             </physical>
   </datatable> 

  <datatable>
             <physical>
                 <distribution id="300"/>
             </physical>
   </datatable>                

   <software>
       <implementation>
          <distribution id="200"/>
       </implementation>
  </software>
 <additionalMetadata>
    <describes>100</describes>
    <describes>200</describes>
    <describes>300</describes>
    <describes>400</describes>
  </additionalMetadata>
</eml> 
```

但是我的 xslt 不适用于上面的例子:(

你介意对此有所了解吗？先感谢您！

静

            回答 #1

赞同：20

时间：2008-12-02T00:01:59.847

这是一个经常犯的错误。当一个或两个操作数是/是节点集时，切勿使用[**XPath 的“！=”运算符。**](http://www.w3.org/TR/xpath#booleans)

   `value != node-set`

如果在节点集中存在节点 n，则根据定义为真，这样

   `value`不等于`string(n)` 

你想要的是

   `value`不等于节点集中的*任何*节点。

这可以用以下方式表示：

   `value = node-set`

如果在节点集中至少存在一个节点 n，则为真，这样：

   `value = string(n)`

然后

   `not(value = node-set)`

如果节点集中不存在任何节点 n 则为真，这样

   `value = string(n)`

**因此，以下 XPath 表达式将选择所需的节点**：

```
/*/*/describes[not(. = ../../*/physical/distribution/@id)
              和
                不（。= ../../*/实施/分发/@id）]

```

我个人更愿意将上下文节点与两个节点集的并集进行一次比较：

```
/*/*/描述
            [not(. = (../../*/physical/distribution/@id
                    |
                      ../../*/实施/分发/@id
                     )
                 )
            ]

```

**请注意，我避免使用“//”缩写**。它通常非常昂贵（效率低​​下），只有在我们不知道 XML 文档的结构时才应该使用它。

当然，上面的 XPath 表达式必须针对以下 XML 文档（问题中提供的第二个文档）进行评估：

```
<emml>
    <数据表>
        <物理>
            <distribution id="100"/>
        </物理>
    </数据表>
    <数据表>
        <物理>
            <distribution id="300"/>
        </物理>
    </数据表>
    <软件>
        <实施>
            <distribution id="200"/>
        </实现>
    </软件>
    <附加元数据>
        <描述>100</描述>
        <描述>200</描述>
        <描述>300</描述>
        <描述>400</描述>
    </附加元数据>
</eml>

```

        html - 在 Flex 应用程序中显示简单的启用 javascript 的网页？

ID：332451

赞同：0

时间：2008-12-01T22:23:03.853

标签：html, apache-flex

我正在开发一个 Flex 应用程序，该应用程序需要显示来自第三方供应商的广告，这些广告以包含 javascript 的 HTML 文档的形式出现。有没有可用的组件可以显示这些东西？看起来我们需要一个在 Flex 内部运行的迷你浏览器。

非常感谢，亚历克斯

            回答 #1

赞同：1

时间：2008-12-01T22:43:04.840

简而言之，是的。不幸的是，Flex 本身并不能很好地呈现 HTML，但是有一些方法可以解决这个问题。Alex 的 Flex Closet 上的一篇文章很好地描述了一些选项：

[http://blogs.adobe.com/aharui/2008/01/html_and_flex_1.html](http://blogs.adobe.com/aharui/2008/01/html_and_flex_1.html)

一个名为 HTMLComponent 的组件可能特别有趣：

[http://drumbeatinsight.com/](http://drumbeatinsight.com/)

        string - F# 字符串构建

ID：332454

赞同：4

时间：2008-12-01T22:24:05.113

标签：string, f#

我想在 F# 中执行此 C# 代码

```
 string[] a = new string[5];
    string b = string.Empty;
    a[0] = "Line 1";
    a[2] = "Line 2";

    foreach (string c in a)
    {
        b = c + Environment.NewLine;
    } 
```

            回答 #1

赞同：14

时间：2008-12-01T22:54:38.687

使用内置的 String.Join 方法比基于重复的字符串连接滚动您自己的函数要好得多。这是 F# 中的代码：

```
open System
let a = [| "Line 1"; null; "Line 2"; null; null;|] 
let b = String.Join(Environment.NewLine, a) 
```

            回答 #2

赞同：2

时间：2008-12-01T23:13:13.673

'^' 运算符连接两个字符串。此外，'+' 被重载，因此它可以在字符串上工作。但是使用 StringBuilder 或 Join 是一个更好的策略。

            回答 #3

赞同：2

时间：2011-08-08T08:46:52.637

您可以从模块中使用 F# 的`concat`函数，如下所示：`System`

```
let a = [| "Line 1"; null; "Line 2"; null; null;|] 
let b = String.concat System.Environment.NewLine a 
```

（您不应导入命名空间以避免 F#和 .NET`System`之间的名称冲突）`String module``String class`

        c++ - 非成员非友元函数语法

ID：332460

赞同：5

时间：2008-12-01T22:26:55.793

标签：c++, class-design

他们是一种使用与成员函数相同的“点”表示法在对象上使用非成员非朋友函数的方法吗？

我可以将（任何）成员从课程中拉出来，并让用户以他们一贯的方式使用它吗？

更长的解释：

[Scott Meyers](http://www.ddj.com/cpp/184401197)、Herb Sutter 等人认为，非成员非友元函数是对象接口的一部分，并且可以改进封装。我同意他们的观点。

然而，在最近阅读了这篇文章之后：[http](http://www.gotw.ca/gotw/084.htm) ://www.gotw.ca/gotw/084.htm我发现自己质疑语法含义。

在那篇文章中，Herb 建议拥有一个`insert`、`erase`和`replace`成员，以及几个同名的非成员非朋友函数。

这是否意味着，正如我所认为的那样，Herb 认为某些函数应该与点符号一起使用，而其他函数应该作为全局函数使用？

```
std::string s("foobar");

s.insert( ... ); /* One like this */
insert( s , ...); /* Others like this */ 
```

编辑：

感谢大家提供非常有用的答案，但是，我认为我的问题的重点被忽略了。

我特别没有提到运算符的具体情况，以及它们如何保留“自然”符号。您也不应该将所有内容包装在名称空间中。这些东西写在我链接的文章中。

**问题本身是：**

在文章中，Herb 建议一个 insert() 方法是成员，而其余的是非成员非友元函数。

这意味着要使用一种形式的 insert()，您必须使用点符号，而对于其他形式，您不需要。

**只是我，还是听起来很疯狂？**

我有一种预感，也许您可​​以使用单一语法。（我在想 Boost::function 如何将 *this 参数用于 mem_fun）。

            回答 #1

赞同：4

时间：2008-12-01T22:53:56.207

是的，这意味着对象的部分接口由非成员函数组成。
对于 T 类的对象，它涉及使用以下表示法这一事实是正确的：

```
void T::doSomething(int value) ;     // method
void doSomething(T & t, int value) ; // non-member non-friend function 
```

如果你想要 doSomething 函数/方法返回 void，并有一个名为“value”的 int 参数。
但有两件事值得一提。
首先是一个类的接口的函数部分应该在同一个命名空间中。这是使用命名空间的另一个原因（如果需要另一个原因），如果只是为了“组合”一个对象和作为其接口一部分的函数。
好的部分是它促进了良好的封装。但不好的部分是它使用了类似函数的符号，我个人非常不喜欢。
二是运营商不受此限制。例如，类 T 的 += 运算符可以写成两种方式：

```
T & operator += (T & lhs, const T & rhs) ;
{
   // do something like lhs.value += rhs.value
   return lhs ;
}

T & T::operator += (const T & rhs) ;
{
   // do something like this->value += rhs.value
   return *this ;
} 
```

但是这两种符号都被用作：

```
void doSomething(T & a, T & b)
{
   a += b ;
} 
```

从美学的角度来看，这比类似函数的符号要好得多。
现在，能够从同一个接口编写一个函数，并且仍然能够通过“.”调用它，这将是一个非常酷的语法糖。表示法，就像在 C# 中一样，正如 michalmocny 所提到的。
编辑：一些例子
假设无论出于何种原因，我都想创建两个“类似整数”的类。第一个是 IntegerMethod：

```
class IntegerMethod
{
   public :
      IntegerMethod(const int p_iValue) : m_iValue(p_iValue) {}
      int getValue() const { return this->m_iValue ; }
      void setValue(const int p_iValue) { this->m_iValue = p_iValue ; }

      IntegerMethod & operator += (const IntegerMethod & rhs)
      {
         this->m_iValue += rhs.getValue() ;
         return *this ;
      }

      IntegerMethod operator + (const IntegerMethod & rhs) const
      {
         return IntegerMethod (this->m_iValue + rhs.getValue()) ;
      }

      std::string toString() const
      {
         std::stringstream oStr ;
         oStr << this->m_iValue ;
         return oStr.str() ;
      }

   private :
      int m_iValue ;
} ; 
```

这个类有 6 个方法可以访问它的内部。
第二个是 IntegerFunction：

```
class IntegerFunction
{
   public :
      IntegerFunction(const int p_iValue) : m_iValue(p_iValue) {}
      int getValue() const { return this->m_iValue ; }
      void setValue(const int p_iValue) { this->m_iValue = p_iValue ; }

   private :
      int m_iValue ;
} ;

IntegerFunction & operator += (IntegerFunction & lhs, const IntegerFunction & rhs)
{
   lhs.setValue(lhs.getValue() + rhs.getValue()) ;
   return lhs ;
}

IntegerFunction operator + (const IntegerFunction & lhs, const IntegerFunction & rhs)
{
   return IntegerFunction(lhs.getValue() + rhs.getValue()) ;
}

std::string toString(const IntegerFunction & p_oInteger)
{
   std::stringstream oStr ;
   oStr << p_oInteger.getValue() ;
   return oStr.str() ;
} 
```

它只有 3 种方法，因此减少了可以访问其内部的代码数量。它有3个非会员非好友功能。
这两个类可以用作：

```
void doSomething()
{
   {
      IntegerMethod iMethod(25) ;
      iMethod += 35 ;
      std::cout << "iMethod   : " << iMethod.toString() << std::endl ;

      IntegerMethod result(0), lhs(10), rhs(20) ;
      result = lhs + 20 ;
      // result = 10 + rhs ; // WON'T COMPILE
      result = 10 + 20 ;
      result = lhs + rhs ;
   }

   {
      IntegerFunction iFunction(125) ;
      iFunction += 135 ;
      std::cout << "iFunction : " << toString(iFunction) << std::endl ;

      IntegerFunction result(0), lhs(10), rhs(20) ;
      result = lhs + 20 ;
      result = 10 + rhs ;
      result = 10 + 20 ;
      result = lhs + rhs ;
   }
} 
```

当我们比较运算符的使用（“+”和“+=”）时，我们看到使运算符成为成员或非成员在其表面用途上没有区别。尽管如此，还是有两个区别：

1.  该成员可以访问其所有内部。非成员必须使用公共成员方法

2.  对于一些二元运算符，如 +、*，进行类型提升很有趣，因为在一种情况下（即，lhs 提升，如上所示），它不适用于成员方法。

现在，如果我们比较非运算符使用（“toString”），我们会发现对于类 Java 开发人员来说，成员非运算符使用比非成员函数更“自然”。尽管不熟悉，但对于 C++ 来说，重要的是要接受这一点，尽管它有语法，但从 OOP 的角度来看，非成员版本更好，因为它无法访问类内部。
作为奖励：如果您想将一个操作符（或非操作符函数）添加到一个没有操作符的对象（例如，<windows.h> 的 GUID 结构），那么您无需修改结构本身。对于运算符，语法将是自然的，对于非运算符，嗯......
*免责声明：这些类当然是愚蠢的：set/getValue 几乎可以直接访问其内部。[但是，正如 Herb Sutter 在Monoliths "Unstrung"](http://www.gotw.ca/gotw/084.htm)中提出的那样，将 Integer 替换为字符串，您将看到更真实的案例。*

            回答 #2

赞同：1

时间：2008-12-01T22:39:57.327

没有办法用点符号来写非会员非朋友，即因为“操作员”。不能超载。

您应该始终将非成员非友元类包装在匿名命名空间（如果只有当前翻译单元需要这些函数）或一些对用户有意义的命名空间中。

            回答 #3

赞同：1

时间：2008-12-01T23:08:26.350

然而，在最近阅读了这篇文章之后：[http](http://www.gotw.ca/gotw/084.htm) ://www.gotw.ca/gotw/084.htm我发现自己质疑语法含义。

语法含义在编写良好的 C++ 库中随处可见：C++ 到处使用自由函数。这对于具有 OOP 背景的人来说是不寻常的，但它是 C++ 中的最佳实践。例如，考虑 STL 标头`<algorithm>`。

因此，使用点符号成为规则的例外，而不是相反。

注意其他语言选择其他方法；这导致在 C# 和 VB 中引入“扩展方法”，允许模拟静态函数的方法调用语法（即完全符合您的想法）。再说一次，C# 和 VB 是严格的面向对象的语言，因此对方法调用使用单一符号可能更重要。

除此之外，函数*总是*属于一个命名空间——尽管我自己偶尔会违反这条规则（但只在一个编译单元中，即我的等价于`main.cpp`，这不起作用）。

            回答 #4

赞同：1

时间：2008-12-02T01:47:46.887

就个人而言，我喜欢自由功能的可扩展性。函数就是一个`size`很好的例子：

```
// joe writes this container class:
namespace mylib {
    class container { 
        // ... loads of stuff ...
    public:
        std::size_t size() const { 
            // do something and return
        }
    };

    std::size_t size(container const& c) {
        return c.size();
    } 
}

// another programmer decides to write another container...
namespace bar {
    class container {
        // again, lots of stuff...
    public:
        std::size_t size() const {
            // do something and return
        }
    };

    std::size_t size(container const& c) {
        return c.size();
    } 
}

// we want to get the size of arrays too
template<typename T, std::size_t n>
std::size_t size(T (&)[n]) {
    return n;
} 
```

现在考虑使用自由大小函数的代码：

```
int main() {
    mylib::container c;
    std::size_t c_size = size(c);

    char data[] = "some string";
    std::size_t data_size = size(data);
} 
```

如您所见，您可以直接使用`size(object)`而无需关心类型所在的命名空间（取决于参数类型，编译器会自行计算命名空间），也无需关心幕后发生的事情。考虑也使用 like`begin`和`end`as 自由函数。这也正是`boost::range` [如此](http://www.boost.org/doc/libs/1_37_0/libs/range/doc/boost_range.html#begin)。

            回答 #5

赞同：1

时间：2008-12-02T08:31:12.970

您*可以*使用一种语法，但可能不是您喜欢的那种。与其在你的类范围内放置一个 insert()，不如让它成为你的类的朋友。现在你可以写

```
mystring s;
insert(s, "hello");
insert(s, other_s.begin(), other_s.end());
insert(s, 10, '.'); 
```

对于任何非虚拟的、公共的方法，都等价于将其定义为非成员友元函数。如果混合点/无点语法困扰你，那么一定要让这些方法成为朋友函数。没有区别。

未来我们也可以写出这样的多态函数，所以也许这就是 C++ 的方式，而不是人为地试图将自由函数强制变成点语法[。](http://www.research.att.com/~bs/multimethods.pdf)

            回答 #6

赞同：1

时间：2008-12-02T14:50:57.353

如果您想保留点表示法，但也想保留不需要成为类之外的朋友的单独函数（因此它们无法访问私有成员从而破坏封装），您可能会编写一个 mixin 类。要么使“常规”在mixin中插入纯虚拟，要么保持非虚拟并使用CRTP：

```
template<typename DERIVED, typename T>
struct OtherInsertFunctions {
    void insertUpsideDown(T t) {
        DERIVED *self = static_cast<DERIVED*>(this);
        self->insert(t.turnUpsideDown());
    }
    void insertBackToFront(T t) // etc.
    void insert(T t, Orientation o) // this one is tricksy because it's an
                                    // overload, so requires the 'using' declaration
};

template<typename T>
class MyCollection : public OtherInsertFunctions<MyCollection,T> {
public:
    // using declaration, to prevent hiding of base class overloads
    using OtherInsertFunctions<MyCollection,T>::insert;
    void insert(T t);
    // and the rest of the class goes here
}; 
```

反正就是这样。但正如其他人所说，C++ 程序员并不“应该”反对自由函数，因为你“应该”一直在寻找编写通用算法（如 std::sort）的方法，而不是添加成员函数特定的类。让所有东西都成为一种方法更符合 Java 风格。

            回答 #7

赞同：0

时间：2008-12-01T22:34:04.517

是的，它们应该是全局或命名空间范围的。非成员非友元函数在 C# 中看起来更漂亮，它们确实使用点表示法（它们被称为[扩展方法](http://en.wikipedia.org/wiki/Extension_method)）。

        database - 将代码与用户创建的数据库条目映射的首选方式

ID：332466

赞同：2

时间：2008-12-01T22:30:00.610

标签：database, relationship

我正在尝试为当前设置制定最佳数据库模型：

管理员可以创建“客户产品”。这意味着客户可以附加/订阅的服务/产品。产品只需定价或产品订阅应发送电子邮件的简单情况很容易在数据库中建模。

但是客户产品的非常具体的后端代码呢？例如，一种产品可能具有非常特定的代码，用于检查不同数据库上的客户状态。如何在数据库中映射这种关系，以便我可以根据产品设置打开/关闭一些代码。

我处理它的直观方法是在 CustomerProducts 表上有一个字符串列，其中可以设置一组预定义的字符串，例如“MyCustomCodeHandler”，然后代码将检查该字符串是否存在以便执行它。但对我来说，这并不像是数据库和代码之间的真正关系。

            回答 #1

赞同：1

时间：2008-12-01T22:36:09.223

数据就是数据，而代码就是代码。我不建议将代码存储在数据库中。

如果您需要允许客户使用相关代码创建产品类型（在“类型”的面向对象意义上），我会选择以与部署其他代码相同的方式部署该代码。

自定义代码还可以引用存储在数据库中的自定义数据。我会选择为每个产品子类型创建一个依赖表，并将特定类型的列放在那里。此子类型表与通用产品表之间的关系是一对一的。也就是说，子类型表中的主键也是通用产品表的外键。

        unit-testing - 如何使用 NHibernate 有效地进行 TDD？

ID：332468

赞同：8

时间：2008-12-01T22:30:18.377

标签：unit-testing, nhibernate, fluent-nhibernate, tdd

在我看来，大多数人在使用 NHibernate 时针对内存中的进程内数据库（如 SQLite）编写测试。我已经启动并运行了它，但我的第一个测试（使用 NHibernate）总是需要 3-4 秒才能执行。下一个测试运行得更快。

我正在使用 FluentNhibernate 进行映射，但使用 XML 映射文件获得大致相同的时间。对我来说，3-4 秒的延迟严重扰乱了我的流程。

使用 TDD 和 NHibernate 的推荐方式是什么？

是否可以模拟 ISession 以对实际查询进行单元测试，或者只能在内存数据库中完成？

            回答 #1

赞同：14

时间：2008-12-02T08:52:35.873

我正在使用存储库模式来执行数据库操作，并且每当我运行我的测试时，我只运行简单地模拟存储库（使用 RhinoMocks）的更高级别的测试。

我有一套单独的测试，明确测试存储库层和 NHibernate 映射。而这些通常不会像它们上面的业务和 gui 逻辑那样改变。

这样我就得到了非常快的单元测试，它永远不会碰到数据库，而且仍然是一个经过良好测试的数据库层

            回答 #2

赞同：4

时间：2008-12-02T20:07:20.053

单元测试数据访问是不可能的，但您可以对其进行集成测试。我在与单元测试分开的项目中为我的数据访问创建集成测试。当我更改存储库、映射或数据库模式中的某些内容时，我只运行（慢）集成测试。因为集成测试没有与单元测试混在一起，所以我仍然可以每天运行大约 100 次单元测试而不会感到烦恼。

            回答 #3

赞同：1

时间：2008-12-01T22:34:50.583

见[http://www.autumnofagile.net](http://www.autumnofagile.net)和[http://www.summerofnhibernate.com](http://www.summerofnhibernate.com)

            回答 #4

赞同：0

时间：2008-12-01T23:07:20.860

您是否尝试过更改可选配置属性中的一些默认值？减速很可能与 nhibernate 对代码生成所做的某些优化有关。

[http://nhibernate.info/doc/nh/en/index.html#configuration-optional](http://nhibernate.info/doc/nh/en/index.html#configuration-optional)

似乎内存数据库将是测试数据层的最快方法。一旦你开始测试你的数据层，你似乎也有点超出了单元测试的范围。

        c++ - VS 2005 C++ 项目中的 msvcr90.dll 依赖项

ID：332473

赞同：7

时间：2008-12-01T22:33:06.547

标签：c++, dll, visual-studio-2005

我在 VS 2005 中为本机 Win32/非托管 C++ 创建了一个 DLL 项目，称之为 myProj.dll。它依赖于第 3 方商业 DLL，而后者又依赖于 msvcr90.dll（我假设它是从 VS 2008 项目构建的）。我将其命名为thirdParty.dll。

我的 DLL 项目在 VS2005 中构建得很好。我已经构建了一个链接到 myProj.lib 的测试应用程序（同样是 VS 2005 Win32 C++）。（顺便说一句，从 .lib 的小尺寸来看，以及在运行时，应用程序必须找到 myProj.dll 的事实，我猜 .lib 只是一个调用的包装器加载实际 DLL 的 loadLibrary()；那么接近吗？）

我的问题是，在运行时，测试应用程序无法找到 msvcr90.dll（也不是 msvcp90.dll），它的依赖来自thirdParty.dll。

我已经安装了 Microsoft 的 redist 包，所有 std (9.0) C++ 库都安装在 c:\WINDOWS\WinSxS\x86_Microsoft.VC90.CRT_... 中。更重要的是，如果我将依赖项walker 指向thirdParty.dll，它会愉快地解析对该位置的引用。

但是，如果我将depends.exe 指向我的测试应用程序(.exe) 或myProj.dll，则找不到msvcr90.dll 和msvcp90.dll。

我猜我需要在 VS2005 中配置一些东西，以便 .exe 或 myProj.dll 知道标准 C++ 库的 9.0 版本的位置（大概是 redist 包将它们安装在 C:\WINDOWS\WinSxS 的位置)，但我似乎无法弄清楚它是什么。我在正确的轨道上吗？

我注意到，如果我只是将 msvc*90.dll 文件复制到我的应用程序目录，那么依赖关系就解决了，但是我得到了关于不正确加载 std c++ DLL 等的运行时错误。

非常感谢提前。

            回答 #1

赞同：6

时间：2008-12-01T23:04:17.560

对我来说，这看起来像是一个*“并排组装”的*问题。

据我所知，微软为了阻止过去几年的*DLL Hell*问题，引入了*“Side-by-Side Assemblies”的概念。* 

简而言之，这意味着您的应用程序需要告诉**Windows**它设计用于哪个版本的**CRT**。安装应用程序后，Windows 将确保您的应用程序获得这些 DLL 文件的私有副本。

为了使这一切正常工作，您需要将应用程序的 DLL 依赖项嵌入到应用程序**清单**文件中，并使用应用程序项目设置的**清单工具**、**输入和输出**部分将其附加到项目中。

例如，这里是我用于[Zeus for Windows](http://www.zeusedit.com) IDE 的清单：

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
  <assemblyIdentity
      name="Xidicone.Windows.Zeus for Windows"
      version="3.9.6.69"
      processorArchitecture="X86"
      type="win32" />

  <description>Zeus for Windows</description>

  <dependency>
    <dependentAssembly>
      <assemblyIdentity
            type="win32"
            name="Microsoft.VC80.CRT"
            version="8.0.50608.0"
            processorArchitecture="x86"
            publicKeyToken="1fc8b3b9a1e18e3b" />
    </dependentAssembly>
  </dependency>

  <dependency>
    <dependentAssembly>
      <assemblyIdentity
          type="win32"
          name="Microsoft.Windows.Common-Controls"
          version="6.0.0.0"
          processorArchitecture="X86"
          publicKeyToken="6595b64144ccf1df"
          language="*" />
    </dependentAssembly>
  </dependency>
</assembly> 
```

最后，如果您计划制作安装程序，您需要将这些 DLL 文件的相同版本添加到应用程序安装程序，或者让您的安装程序运行 Microsoft CRT 可再发行安装程序。

[FWIW 当用户报告Zeus](http://www.zeusedit.com)由于缺少 MSVCRT 运行时 DLL 文件而不再在 Windows XP 上运行时，我才发现这一点，但[Zeus](http://www.zeusedit.com)已经运行良好 10 多年，而无需附带 MSVCRT 运行时 DLL 文件.

            回答 #2

赞同：2

时间：2008-12-01T22:43:24.857

您是否安装了msvc 2008 redist的[SP1 版本？](http://www.microsoft.com/downloads/details.aspx?FamilyID=a5c84275-3b97-4ab7-a40d-3802b2af5fc2&displaylang=en)

如果depends.exe 找不到msvcr90.dll 也没有问题，如果您使用microsoft 安装程序，它会自动安装在正确的位置，并且在您的应用程序运行时会找到。如果您不创建清单，则将 dll 复制到应用程序目录也无济于事。

但是你能说出你得到的确切错误信息吗？

您也可以在[这里](https://stackoverflow.com/questions/176992/visual-c-redistributables-without-using-vcredistx86exe)和[这里查看](https://stackoverflow.com/questions/110249/building-and-deploying-dll-on-windows-sxs-manifests-and-all-that-jazz)清单。

            回答 #3

赞同：1

时间：2008-12-01T22:41:12.317

我会问第三方 dll 的人。  

            回答 #4

赞同：1

时间：2011-11-25T17:14:28.657

几天前我有同样的问题。myProj.dll 依赖于使用 msvcr90 的thirdParty.dll。如果我直接使用 myProj.dll 构建一个 test.exe，就可以了。但是如果我在 test.exe 中使用 loadLibrary(myProj.dll)，调用就会失败。如果我在 Java 程序中尝试 loadLibrary(myProj.dll) 也会发生同样的情况。

在互联网上进行了一些调查和研究后，以下步骤解决了我的问题。

1.  确保没有 msvcr90 在 PATH 上。您可以使用进程资源管理器（SystemInternals 的 procexp.exe）来找出当前在您的环境中加载的所有 msvcr90。事实上，从 VC 2005 开始，C 运行时库只能安装在全局程序集缓存 (\winsxs....) 中，甚至不能安装在 windows 或 windows\system32 下。

2.  将 dll 清单嵌入到 myProj.dll 中。在 cl.exe 和 link.exe 生成 myProj.dll 之后，也会生成相应的清单。然后使用 mt.exe -inputresource myProj.dll.manifest -out myProj.dll;2

以上解决了我的问题，希望对你有帮助。顺便说一句，我在 Windows 2008 R 下使用 VC 2008

        c# - 在 FormsAuthentication 对用户进行身份验证后，撤销身份验证并重定向到登录页面

ID：332477

赞同：1

时间：2008-12-01T22:35:05.433

标签：c#, asp.net, forms-authentication

如果用户不再存在（或某些其他情况），我需要在表单身份验证机制已经从浏览器接收到身份验证 cookie 并对其进行验证之后撤销身份验证 cookie。即这里是使用场景：

1.  用户已通过身份验证，并被授予未过期的身份验证 cookie。
2.  几天后，用户再次尝试访问我的网络应用程序，并且由于 cookie 有效，表单身份验证机制将授予访问权限。

3.  现在我想执行第二次检查（无论我想要什么条件），并决定是让用户继续，还是撤销身份验证。

问题是 - 是否有官方的自动化方式？到目前为止，我提出了一些可能性，但我不知道哪个更好。我可以在 global.asax 中捕获 Authenticate 事件，检查我想要的任何内容，并撤销我清除 cookie，然后其中之一：

1.  再次重定向到相同的 url - 这应该可以工作，因为这次表单身份验证将失败，它将重定向到登录页面。

2.  抛出一些异常？？？在没有我指定任何内容的情况下，哪一个可以使重定向发生？

3.  以某种方式从配置文件中获取登录页面 url（任何想法如何/使用哪个配置处理程序）并直接重定向？

4.  我忽略了一些 FormsAuthentication 类/方法，它是为此设计的？

5.  还有什么想法吗？

            回答 #1

赞同：3

时间：2008-12-01T23:59:55.420

我认为没有一种自动化的方法可以实现这一目标。我认为最好的方法是向身份验证 cookie 添加一个日期，这将是您最后一次检查用户是否存在。因此，当用户登录时，您将：

```
FormsAuthenticationTicket ticket = new FormsAuthenticationTicket(
                1, // Ticket version
                name, // Username associated with ticket
                DateTime.Now, // Date/time issued
                DateTime.Now.AddMonths(1), // Date/time to expire
                true, // "true" for a persistent user cookie
                DateTime.Now.ToUniversalTime(), // last time the users was checked
                FormsAuthentication.FormsCookiePath);// Path cookie valid for

        // Encrypt the cookie using the machine key for secure transport
        string hash = FormsAuthentication.Encrypt(ticket);
        HttpCookie cookie = new HttpCookie(
            FormsAuthentication.FormsCookieName, // Name of auth cookie
            hash); // Hashed ticket

        cookie.HttpOnly = true;

        // Set the cookie's expiration time to the tickets expiration time
        if (ticket.IsPersistent) cookie.Expires = ticket.Expiration;
        //cookie.Secure = FormsAuthentication.RequireSSL;
        Response.Cookies.Add(cookie); 
```

然后，每次对用户进行身份验证时，您都可以检查传递给身份验证票证的附加日期，并以 10 分钟或更短的时间间隔再次检查数据库是否存在用户。代码可能如下所示：

```
public void FormsAuthentication_OnAuthenticate(object sender, 
                           FormsAuthenticationEventArgs args)
    {
        if (FormsAuthentication.CookiesSupported)
        {
            if (Request.Cookies[FormsAuthentication.FormsCookieName] != null)
            {
                try
                {
                    FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(
                      Request.Cookies[FormsAuthentication.FormsCookieName].Value);

                    DateTime lastCheckedTime = DateTime.TryParse(ticket.UserData);
                    TimeSpan elapsed = DateTime.Now - lastCheckedTime;
                    if (elapsed.TotalMinutes > 10)//Get 10 from the config
                    {
                        //Check if user exists in the database. 
                        if (CheckIfUserIsValid())
                        {
                            //Reset the last checked time
                            // and set the authentication cookie again
                        }
                        else
                        {
                            FormsAuthentication.SignOut();
                            FormsAuthentication.RedirectToLoginPage();
                            return;
                        }
                    }

                }
                catch (Exception e)
                {
                    // Decrypt method failed.
                }
            }
        }
    } 
```

您甚至可以缓存在过去 10 分钟内被删除的用户并检查该集合。

希望有帮助。

            回答 #2

赞同：0

时间：2008-12-02T02:33:51.460

如果您因为会话过期以外的其他原因拒绝 cookie，那么我认为您应该将用户重定向到一个页面，该页面描述了他们需要做什么才能获得访问权限。如果再次登录就足够了，那么登录页面就足够了。但是，这听起来像是在某些情况下无法简单地再次登录。在这些情况下，最好将用户重定向到一个合适的错误页面，该页面描述了他们无法访问该站点的原因并解释了如何再次获得访问权限（如果可能）。

        .net - 为什么我会收到“方法没有支持的 SQL 转换”错误？

ID：332479

赞同：2

时间：2008-12-01T22:35:34.683

标签：.net, asp.net-mvc, linq-to-sql, c#-3.0

我得到这个错误

```
{"Method 'System.DateTime ConvertTimeFromUtc(System.DateTime, System.TimeZoneInfo)' has no supported translation to SQL."} 
```

当我尝试执行这个 linq to sql

```
var query = from p in db.Posts
            let categories = GetCategoriesByPostId(p.PostId)
            let comments = GetCommentsByPostId(p.PostId)
            select new Subnus.MVC.Data.Model.Post
            {
                Categories = new LazyList<Category>(categories),
                Comments = new LazyList<Comment>(comments),
                PostId = p.PostId,
                Slug = p.Slug,
                Title = p.Title,
                CreatedBy = p.CreatedBy,
                CreatedOn = TimeZoneInfo.ConvertTimeFromUtc(p.CreatedOn, TimeZoneInfo.FindSystemTimeZoneById("Romance Standard Time")),
                Body = p.Body
            };
return query; 
```

还有其他地方我可以将日期转换为正确的格式吗？目前我的 _global.spark 文件中有一个宏，但这似乎是错误的

```
<macro name="DateAndTime" Date="DateTime">
# Date = TimeZoneInfo.ConvertTimeFromUtc(Date, TimeZoneInfo.FindSystemTimeZoneById("Romance Standard Time"));
${Date.ToString("MMMM d, yyyy")} at ${Date.ToString("hh:mm")}
</macro>
<macro name="Date" Date="DateTime">
# Date = TimeZoneInfo.ConvertTimeFromUtc(Date, TimeZoneInfo.FindSystemTimeZoneById("Romance Standard Time"));
${Date.ToString("MMMM d, yyyy")}
</macro> 
```

**更新：**我现在明白代码在哪里不起作用但是当我删除它时，我得到同样的代码错误

```
 public IQueryable<Subnus.MVC.Data.Model.Comment> GetCommentsByPostId(int postId)
    {
        var query = from c in db.Comments
                    where c.PostId == postId
                    select new Subnus.MVC.Data.Model.Comment
                    {
                        Body = c.Body,
                        EMail = c.EMail,
                        Date = c.CreatedOn,
                        WebSite = c.Website,
                        Name = c.Name
                    };

        return query;
    } 
```

            回答 #1

赞同：3

时间：2008-12-01T22:49:40.570

Linq-to-Sql 无法将任意 .net 函数转换为 SQL。但是，可以翻译一些 DateTime 函数，此处提供了完整列表：-

[http://msdn.microsoft.com/en-us/library/bb882657.aspx](http://msdn.microsoft.com/en-us/library/bb882657.aspx)

在您的示例中，如果您计算投影之外的时间偏移量，则可以使用支持转换为 SQL 的 AddMinutes 方法将偏移量添加到检索到的“CreatedOn”DateTime。

            回答 #2

赞同：1

时间：2008-12-01T22:40:41.553

LINQ-to-SQL 仅转换操作的子集 - 它尝试（并且失败）将 ConvertTimeFromUtc 编写为 TSQL。有些操作有 TSQL 对应物（dateadd/datediff/etc）——但不是全部。您可以选择使用原始值进行投影（选择），并且只有在内存中有对象（通过 LINQ-to-Objects）后才执行 ConvertTimeFromUtc。

例如 - 您可以只使用 p.CreatedOn 创建对象，然后再完成其余的工作。不是理想，而是生活。LINQ-to-Entities 声称有更好的翻译选项，但要复杂得多。根据您的情况，LINQ-to-SQL 还提供 udf 支持，*有时*可以让您将这些东西卸载到 db -*如果*有一种将其编写为 udf 的方法 - 例如，您可以在数据上编写一个方法 - context 和 mark 是一个可组合的函数 ( [`[Function]`](http://msdn.microsoft.com/en-us/library/system.data.linq.mapping.functionattribute.aspx))，然后是：

```
 ...
    CreatedOn = ctx.MapDate(p.CreatedOn)
 .... 
```

然后它将使用来自的 TSQL `[Function]`- 即类似的东西：

```
....
    dbo.MapDate(t2.CreatedOn)
.... 
```

        c# - 如何使用 C# 设置默认浏览器主页 (IE)？

ID：332486

赞同：2

时间：2008-12-01T22:39:30.090

标签：c#, browser

如何使用 C# 以编程方式更改浏览器的默认主页？

            回答 #1

赞同：5

时间：2008-12-01T22:42:54.203

在此注册表设置中设置它：

```
HKCU\Software\Microsoft\Internet Explorer\Main\Start Page 
```

            回答 #2

赞同：1

时间：2008-12-01T22:42:08.073

看到这个，它不在 C# 中，但你应该能够很容易地在 C# 中计算出注册表的内容。

[http://www.microsoft.com/technet/scriptcenter/resources/qanda/nov04/hey1108.mspx](http://www.microsoft.com/technet/scriptcenter/resources/qanda/nov04/hey1108.mspx)

请不要安排此代码在我的机器上运行！

            回答 #3

赞同：0

时间：2008-12-01T22:47:12.913

我会点击注册表：

**对于基于用户的更改**

HKCU\Software\Clients\StartMenuInternet

检查此键下方的键以获取系统上的浏览器列表。将 reg_sz 值设置为要设置为默认值的浏览器键的名称。

**对于机器范围的更改**

检查系统的 HKLM\Software\Clients\StartMenuInternet

**帮助 C# 注册表修改**

见这里：
 [http ://www.csharphelp.com/archives2/archive392.html](http://www.csharphelp.com/archives2/archive392.html)

        oracle - Oracle 浮点数与数字

ID：332492

赞同：18

时间：2008-12-01T22:41:38.480

标签：oracle, types, numbers, floating-point, fixed-point

我在[Oracles 文档](http://download.oracle.com/docs/cd/B19306_01/server.102/b14220/datatype.htm#i16209)中看到相互冲突的引用。小数如何存储在 FLOAT 和数据库中的 NUMBER 类型之间有什么区别吗？

正如我从 C 等人中回忆的那样，浮点数具有 int 没有的精度限制。Rg，对于“浮点数”，0.1（以 10 为底）近似为 0.110011001100110011001101（以 2 为底），大致等于 0.100000001490116119384765625（以 10 为底）。然而，对于 'int's，5(Base 10) 正好是 101(Base 2)。

这就是为什么以下内容不会在 C 中按预期终止的原因：

```
float i;
i = 0;
for (i=0; i != 10; )
{
    i += 0.1
} 
```

但是，我[在 Oracle 文档的其他地方](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements001.htm#i45441)看到FLOAT 已被定义为 NUMBER。据我了解，Oracle 对 NUMBER 类型的实现并没有遇到与 C 的浮点数相同的问题。

那么，这里的真实故事是什么？Oracle 是否偏离了我对浮点数/浮点数的预期？

（我敢肯定，对于我将使用它们的用途而言，这是一场巨大的飓风，但我知道如果 0.1*10 等于 1.00000000000000001，我会有疑问）

            回答 #1

赞同：29

时间：2008-12-01T22:53:23.167

Oracle`BINARY_FLOAT`使用 IEEE 754 浮点表示在内部存储数据，就像 C 和许多其他语言一样。当您从数据库中获取它们，并且通常将它们存储在宿主语言中的 IEEE 754 数据类型中时，它能够在不转换值的情况下复制值。

而 Oracle 的`FLOAT`数据类型是 ANSI SQL NUMERIC 数据类型的同义词，在 Oracle 中称为 NUMBER。这是一个精确的数字，一种不具有 IEEE 754 舍入行为的缩放十进制数据类型。但是如果您从数据库中获取这些值并将它们放入 C 或 Java 浮点数中，则在此步骤中您可能会丢失精度。

            回答 #2

赞同：10

时间：2009-04-30T16:14:29.217

Oracle BINARY_FLOAT 和 BINARY_DOUBLE 大部分等同于 IEEE 754 标准，但它们绝对不会在内部存储在标准 IEEE 754 表示中。

例如，BINARY_DOUBLE 占用 9 个字节的存储空间，而 IEEE 占用 8 个字节。双浮点数 -3.0 也表示为 3F-F7-FF-FF-FF-FF-FF-FF，如果您使用真正的 IEEE 将是 C0- 08-00-00-00-00-00-00。请注意，位 63 在 Oracle 表示中为 0，而在 IEEE 表示中为 1（如果 's' 是符号位，根据 IEEE，数字的符号为 (-1)^s）。[在http://babbage.cs.qc.cuny.edu/IEEE-754/](http://babbage.cs.qc.cuny.edu/IEEE-754/)上查看非常好的 IEEE 754 计算器

如果您在表 T 中有一个 BINARY__DOUBLE 列 BD 并使用以下查询，您可以轻松找到：

从 T 中选择 BD,DUMP(BD)

现在所有这一切都很好而且很有趣（也许），但是当一个人在 C 中工作并从 Oracle 获取一个数值（通过将一个变量绑定到任何类型的数字列）时，通常会得到一个真正的 IEEE double 的结果。由 C 支持。现在这个值受制于所有常见的 IEEE 不准确之处。

如果想进行精确算术运算，可以在 PL/SQL 中完成，也可以使用特殊的精确算术 C 库。

有关 Oracle 自己对其数字数据类型的解释，请参见：http: [//download.oracle.com/docs/cd/B19306_01/server.102/b14220/datatype.htm#i16209](http://download.oracle.com/docs/cd/B19306_01/server.102/b14220/datatype.htm#i16209)

            回答 #3

赞同：3

时间：2008-12-01T22:46:00.233

Oracle 的 Number 实际上是 Decimal（以 10 为底）浮点表示... Float 只是 Number 的别名，做的事情完全相同。

如果你想要二进制（base-2）浮点数，你需要使用 Oracle 的 BINARY_FLOAT 或 BINARY_DOUBLE 数据类型。

[链接文本](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-5224536.html)

            回答 #4

赞同：2

时间：2012-05-11T14:25:32.777

比尔关于 Oracle 的 FLOAT 的回答只对 Oracle 8i 中的最新版本（比如 11i）是正确的，该文件说：

您可以使用“NUMBER 数据类型”中讨论的形式指定浮点数。Oracle 还支持 ANSI 数据类型 FLOAT。您可以使用以下语法形式之一指定此数据类型：

FLOAT 指定十进制精度为 38 或二进制精度为 126 的浮点数。 FLOAT(b) 指定二进制精度为 b 的浮点数。精度 b 的范围可以从 1 到 126。要将二进制精度转换为十进制精度，请将 b 乘以 0.30103。要将十进制精度转换为二进制精度，请将十进制精度乘以 3.32193。最大 126 位二进制精度大致相当于 38 位十进制精度。

听起来像是四倍精度（126 二进制精度）。如果我没记错的话，IEEE754 只要求 b = 2，单精度 p = 24，双精度 p = 53。当我研究 Oracle 和 PostgreSQL 之间的转换计划时，8i 和 11i 之间的差异引起了很多混乱。

            回答 #5

赞同：2

时间：2015-08-07T06:01:51.463

和前面提到的 PLS_INTEGER 一样，Oracle 10g 中的 BINARY_FLOAT 和 BINARY_DOUBLE 类型使用机器算术并且需要更少的存储空间，这两者都使得它们比 NUMBER 类型更高效

*   只有 BINARY_FLOAT 和 BINARY_DOUBLE 支持 NAN 值

-**不精确的计算**

        eclipse-plugin - 在 Eclipse 中，如何在加载另一个插件时加载我的插件？

ID：332504

赞同：2

时间：2008-12-01T22:46:17.423

标签：eclipse-plugin, loading

我想注册以获取有关 Eclipse 中所有 Java 更改的通知。我可以通过调用 JavaCore.addElementChangedListener() 来做到这一点。但是，我不希望在加载 org.eclipse.jdt.core 之前加载我的插件。我的 hack 尝试是声明一个对 org.eclipse.jdt.core 扩展点的虚拟扩展，但它不适用于所有版本的 Eclipse。再加上它很丑。当加载另一个插件时，如何干净地确保加载我的插件？

            回答 #1

赞同：2

时间：2008-12-03T14:27:06.073

事实证明，当加载另一个插件时，没有内置的方法来加载我的插件。解决问题的最通用方法是强制我的插件在启动时加载并设置一个侦听器以供其他插件加载。然后，当 jdt.core 加载时，我可以添加我的元素更改侦听器。但是，即使理论上似乎可行，我也无法弄清楚如何强制我的插件在启动时加载。我和丑陋的黑客一起去了。

        .net - 您的代码需要哪些更高级的规则才能成为 CLS 投诉？

ID：332515

赞同：3

时间：2008-12-01T22:51:01.423

标签：.net, vb.net, visual-studio, cls-compliant

这是根据 VS.NET 2005 不符合 CLS 投诉的具体示例。

```
Public Interface IDbId

    Function GetNativeObject() As Object
    Function Equals(ByVal compObj As IDbId) As Boolean
    Function CompareTo(ByVal compObj As IDbId) As Integer
    Function ToString() As String

End Interface 
```

这是我用 DbId32、DbId64、DbIdString 等类实现的接口。它是一种将本机数据库主键类型抽象为一个常见的 .Net 类型的方法。

我没有显示的是工厂方法，它实例化正确的具体类型（例如，SQL Server 类型“int”的新 DbId32）给定本机数据库类型。

现在假设我像这样使用这个界面：

```
Public MustOverride ReadOnly Property ID() As IDbId 
```

VS 现在输出此警告消息：

函数“ID”的返回类型不是 CLS 投诉的。

我可以通过将此属性添加到我的界面来停止这些警告，如下所示：

```
<CLSCompliant(True)> _
  Public Interface IDbId
  ... 
```

此接口定义的所有功能似乎都没有违反[此处](http://www.devarticles.com/c/a/C-Sharp/Making-Your-Code-CLS-Compliant/)记录的规则。那么为什么 VS 会显示这些警告呢？

            回答 #1

赞同：3

时间：2008-12-01T22:58:03.547

我认为这是由于您的示例中的 MustOverride 关键字修饰符。检查一下：
[在符合 CLS 的类中不允许不符合 CLS 的“MustOverride”成员](http://msdn.microsoft.com/en-us/library/0haa76bc.aspx)

            回答 #2

赞同：2

时间：2008-12-02T00:02:28.910

我运行[FXCop](http://msdn.microsoft.com/en-us/library/bb429476.aspx)，这似乎总是指出使 dll CLS-Compliant 需要什么

            回答 #3

赞同：1

时间：2008-12-01T22:56:32.333

使用 .net reflector 看看生成的有无属性的代码，看看有没有区别。

如果有，并且它没有明显解释差异（即，如果唯一的区别是 CLICompliant 属性），那么用调查结果修改你的问题，我会再试一次...... :)

        postgresql - PostgreSQL 的优秀 OleDB/ODBC 提供程序

ID：332518

赞同：6

时间：2008-12-01T22:52:03.623

标签：postgresql, oledb

我需要一个适用于 PostgreSQL 的功能性 OleDB 数据提供程序。它应该类似于 MySQL 的 ODBC 提供程序。见[http://dev.mysql.com/downloads/connector/odbc/5.1.html](http://dev.mysql.com/downloads/connector/odbc/5.1.html)

            回答 #1

赞同：4

时间：2008-12-01T23:25:02.213

postgres[软件目录](http://www.postgresql.org/download/products/2)上有一些提供程序。

            回答 #2

赞同：1

时间：2012-04-05T19:06:31.353

dotConnect for PostgreSQL（来自 Devart）提供了一个非常好的。它快速且有效。免费版将为您提供基本的 ADO.net 支持，付费版提供其他一切。ODBC 没有免费版本。

[http://www.devart.com/dotconnect/postgresql/](http://www.devart.com/dotconnect/postgresql/)   

**编辑** 

将直接链接添加到 ODBC 连接器，因为它位于单独的页面上。

[https://www.devart.com/odbc/postgresql/](https://www.devart.com/odbc/postgresql/)

            回答 #3

赞同：0

时间：2013-05-30T10:35:33.407

如果您想检查 ODBC for PosgreSQL 的最新版本：
 [http ://www.postgresql.org/ftp/odbc/versions/](http://www.postgresql.org/ftp/odbc/versions/)

进入安装程序的“msi”文件夹。但请注意，当您使用 ODBC 时，有 32 位和 64 位版本。所以选择合适的。

        java - Java Manifest.mf 类路径问题

ID：332522

赞同：3

时间：2008-12-01T22:53:47.033

标签：java, variables, system, classpath, manifest.mf

我一直在尝试运行一个 jar 文件——我们称之为 test.jar——它在 Unix 系统上使用 Sybase jconn3.jar。

我创建了一个包含以下内容的 MANIFEST.MF 文件：

```
Class-Path: $SYBASE/jConnect-6_0/classes/jconn3.jar commons-net-1.3.0.jar 
```

这给出了 ClassNotFoundError。$SYBASE 是指向 /opt/sybase13 的系统变量；我还尝试了以下方法：

```
Class-Path: /opt/sybase13/jConnect-6_0/classes/jconn3.jar commons-net-1.3.0.jar 
```

和

```
Class-Path: opt/sybase13/jConnect-6_0/classes/jconn3.jar commons-net-1.3.0.jar 
```

但是，如果我将 jconn3.jar 文件从 $SYBASE/jConnect-6_0/classes 复制到与 test.jar 相同的目录，并将我的 MANIFEST.MF 更新为如下所示：

```
Class-Path: jconn3.jar commons-net-1.3.0.jar 
```

应用程序按预期运行。

现在，我已经能够通过在本地复制 jconn3.jar 文件来验证它是否有效；我的 MANIFEST.MF 文件包含我的主类的路径，所以这里没有问题。

你认为可能是什么问题？我已经看这个东西太久了。谢谢！

            回答 #1

赞同：12

时间：2008-12-01T23:03:10.870

类路径中的条目要么是相对于嵌入它们的 JAR（你有工作）要么是 URL。为了使您的绝对路径起作用，您需要将它们转换为 URL，例如，

`file:/opt/sybase13/...`

没有使用变量的机制。

尽管 JAR 规范没有明确说明，但绝对`file:`方案 URL 确实在 class-path 属性中起作用。

            回答 #2

赞同：0

时间：2008-12-01T23:06:39.257

类加载器 AFAIK 不读取环境变量。但是，您可以在配置脚本中添加 jar
根据规范，条目是相对于 jar 不是绝对的：

类路径：

此属性的值指定此应用程序或扩展所需的扩展或库的相对 URL。URL 由一个或多个空格分隔。应用程序或扩展类加载器使用此属性的值来构造其内部搜索路径。

[http://java.sun.com/j2se/1.5.0/docs/guide/jar/jar.html](http://java.sun.com/j2se/1.5.0/docs/guide/jar/jar.html) #Manifest 规范

        git - 进行 git 合并时是否可以排除特定的提交？

ID：332528

赞同：79

时间：2008-12-01T22:55:21.057

标签：git

假设我想从发布分支合并到主分支，并且发布分支中有一些我不想包含在主分支中的提交。有没有办法进行合并，这样一个或多个提交就不会被合并？

到目前为止，我的策略是执行以下操作（在 master 中）：

```
git merge --no-commit release-branch
# Resolve conflicts and apply reverse patch of the commits that I don't want included
git commit # Edit commit message so that it lists the commits that have been reverse-patched 
```

有一个更好的方法吗？

            回答 #1

赞同：114

时间：2010-10-19T16:21:41.717

我[在*Pro Git* book](http://git-scm.com/book/en/Customizing-Git-Git-Attributes#Merge-Strategies)中找到了适合我的解决方案。

假设您要排除文件`config.php`。

在分支 A 上：

1.  `.gitattributes`在同一目录中创建一个名为的文件，使用以下行： `config.php merge=ours`. 这告诉 git 在合并文件时使用什么策略。在这种情况下，它始终保留您的版本，即。您要合并到的分支上的版本。

2.  添加`.gitattributes`文件并提交

在分支 B：重复步骤 1-2

现在尝试合并。您的文件应该保持不变。

            回答 #2

赞同：50

时间：2008-12-01T23:06:44.560

创建一个新分支，以交互方式重新设置分支并删除您不想要的提交，然后将其合并。

您不能在不重新散列的情况下将更改从分支中间取出，但是当它在以后的合并中看到相同的更改（例如，从樱桃采摘和其他情况下）时，就会发生正确的事情。

            回答 #3

赞同：22

时间：2014-04-30T15:22:49.363

如果您有一个支持分支，您可以在其中修复错误并构建新版本。在 master 上，您有下一个版本，您还经常在其中构建新版本。

每次构建新版本时，您都会更改某个文件中的版本，提交该新文件，创建标签并推送。*现在从支持*到*主*的合并总是会在包含版本信息的文件中产生冲突。

如果包含版本信息的文件**只**包含版本信息，则可以使用 fcurella 的答案。但如果它确实也可能包含可合并信息（pom.xml、gradle.properties、MANIFEST.MF、...），您必须执行一些额外的操作。

让我们使用以下示例

```
 C---D*---E---F* support
     /
A---B---G---H*---I master 
```

其中带有星号的提交仅包含由于版本更改而导致的更改，这些更改在合并期间应被忽略。

要将*支持*合并到*master*而不会由于版本构建而产生合并冲突，您可以执行以下任一操作：

多次合并提交

```
git checkout master
git merge C
git merge D -s ours
git merge E
git merge F -s ours 
```

通过`-s ours`参数，我们告诉 git 只记录合并而不改变工作空间。这与[svn](http://svnbook.red-bean.com/en/1.7/svn.branchmerge.advanced.html#svn.branchmerge.advanced.blockchanges)[的`--record-only`](http://svnbook.red-bean.com/en/1.7/svn.branchmerge.advanced.html#svn.branchmerge.advanced.blockchanges)选项相当。

以上将导致以下布局

```
 -------------C---D*---E---F* support
     /              \   \    \   \
A---B---G---H*---I---J---K----L---M master 
```

使用cherry-pick 的一次合并提交

```
git checkout master
git merge support -s ours --no-commit
git cherry-pick C E --no-commit
git commit -m 'merged support into master' 
```

首先，我们开始合并，但只记录我们正在合并的内容，而不改变工作空间，也没有进行合并提交。然后我们挑选要合并的提交，再次没有提交。最后，我们正在提交合并。

以上将导致以下布局

```
 C---D*---E---F* support
     /              \
A---B---G---H*---I---J master 
```

甚至可以自动化采摘樱桃。

```
git checkout master
git merge support -s ours --no-commit
for id in `git log support --reverse --not HEAD --format="%H [%an] %s" |
  grep -v "bump version" |
  sed "s/\(\w*\)\s.*/\1/g"`
do
  git cherry-pick --no-commit $id
done
git commit -m 'merged support into master' 
```

            回答 #4

赞同：4

时间：2008-12-09T13:37:52.720

不能直接这样做的原因是每个提交都包含指向父提交的链接（通常只有一个，但有几个用于合并）。这样，如果你有一个提交（通过它的 SHA1 总和），整个历史也被固定，因为父母也包含到他们父母的链接等等。因此，在历史中遗漏补丁的唯一方法是编写一个新补丁。git rebase -i 在新创建的分支上可能是实现这一目标的最简单方法。

            回答 #5

赞同：3

时间：2015-06-26T14:20:39.103

**主要问题是：你想如何表示你想跳过的提交？**

1.  偷偷地把它们藏起来（不是我最喜欢的）
2.  明确跳过它们
3.  明确撤消它们

很不幸的是，不行。2 在历史图表中是不可能表达的。

第一是可能的，但我*永远*不会这样做：合并提交可以包含更改。– 通常，合并提交指向另外两个分支合并的结果：在这些分支中开发的所有内容都应该在合并后的代码中（即在合并提交指向的代码中）。此提交中不应包含其他任何内容。

但是令人惊讶的是，您可以更改整个代码库并将其表示为合并。合并的效果是双重的：它合并了历史树*，*它应该合并两个代码库。前者肯定会（否则没有人称其为合并），后者可能会失败，例如，当出现合并冲突并且错误解决时（然后代码库未正确合并）。

其他一些答案暗示了这种隐藏。我推荐明确的方式：合并加还原提交。

            回答 #6

赞同：2

时间：2012-01-18T07:24:54.067

也可以修改 .git/info/attributes 文件并将其保存在 .git 文件夹中，而不是到处添加 .gitattribute 文件，这最终需要将它们添加到源代码控制中。

            回答 #7

赞同：1

时间：2011-08-26T10:09:44.837

如果你只想排除一些最后的提交，你可以只提交一个特定的提交号：

```
git checkout partlyMergedFrom
git whatchanged
--> find the commit hash up to where you want to merge
git checkout partlyMergedInto
git merge e40a0e384f58409fe3c864c655a8d252b6422bfc
git whatchanged
--> check that you really got all the changes you want to have 
```

        xml - 哪种 XML 结构最适合全面的 API？

ID：332534

赞同：3

时间：2008-12-01T22:57:31.490

标签：xml, api, sms

可以的话请指教。

我正在构建一个 SMS Web 服务 API，它允许人们将 SMS 发送到他们想要的手机号码。一个请求将被发送到接口，然后我们根据提供的帐户详细信息和他们帐户上可用的信用来处理该请求。

对于接口请求，我们提出了两种 XML 结构，我希望您能建议哪一种更好，因为我们正为此争论不休。

接口A

```
print("<?xml version = "1.0" encoding="UTF-8" standalone="yes"?>
        <Message version="1.0">
            <ClientID>11111</ClientID>
            <PassPhrase>shjfkh</PassPhrase>
            <Request Type="sms" Refno="10" ToAddress="27732687745332">
                <Content>
                      hello world
                </Content>
            </Request>
        </Message> "); 
```

接口 B

```
 print("<?xml version = "1.0" encoding="UTF-8" standalone="yes"?>
    <Message>
        <mmtag name="Version">1.0</mmtag>
        <mmtag name="ClientID">1001</mmtag>
        <mmtag name="RefNO">120</mmtag>
        <mmtag name="Encoding">base64</mmtag>
        <mmtag name="Type">SMS</mmtag>
        <mmtag name="Content">hello world</mmtag>
        <mmtag name="MSISDN">27781010102</mmtag>        
    </Message>"); 
```

现在，看看这两个例子，你认为哪个最适合我们的 API 接口，不管后端的技术如何。如果您选择一个，请支持您的答案。

            回答 #1

赞同：4

时间：2008-12-01T23:18:17.080

接口 A。

接口 B 本质上只是一个键/值列表，其中接口 A 利用 XML 的结构化特性并通过结构提供意义。

例如：ClientId 是 Message 的属性，而不是 Request 本身。从 A 可以清楚地看到这一点，但从 B 看却不是。

            回答 #2

赞同：2

时间：2008-12-01T23:06:37.943

我会进一步修改A...

```
<Message version="1.0" clientID="11111" passPhrase="shjfkh">
    <Request Type="sms" Refno="10" ToAddress="27732687745332">hello world</Request>
</Message> 
```

这允许该结构暗示每个消息块有多个消息的可能性。

```
<Message version="1.0" clientID="11111" passPhrase="shjfkh">
    <Request Type="sms" Refno="10" ToAddress="27732687745332">hello john</Request>
    <Request Type="sms" Refno="11" ToAddress="12345678901234">hello jane</Request>
</Message> 
```

            回答 #3

赞同：2

时间：2008-12-01T23:12:49.663

还有一点，您可能应该将实际消息包含在 CDATA 中，以便将其与您的 XML 分开。像这样...

```
<Message version="1.0" clientID="11111" passPhrase="shjfkh">
    <Request Type="sms" Refno="10" ToAddress="27732687745332"><![CDATA[hello john]]></Request>
    <Request Type="sms" Refno="11" ToAddress="12345678901234"><![CDATA[hello jane]]></Request>
</Message> 
```

这样，如果用户从 XML 角度嵌入非法字符，您将受到保护。

            回答 #4

赞同：2

时间：2008-12-01T23:56:34.100

接口 A 优于接口 B 有几件事：

*   使用模式/DTD 更容易检查（特别是如果文本内容的类型取决于元素）
*   结构更清晰
*   通过 XPath 搜索和通过 XSLT 转换更容易
*   更容易绑定到类，如果你喜欢这样的事情

当然，你可以通过接口 B 实现上面提到的所有事情，但它会更麻烦。

如果您需要客户端可以填充的任意元数据，您始终可以将具有键/值子元素的元素添加到接口 A。

抛开所有技术原因，我认为界面 A 的设计更美观。在界面B中，标签基本上是没用的，因为它们都是一样的。因此，所有的`mmtag`琴弦都是自重的。

            回答 #5

赞同：1

时间：2008-12-01T22:59:51.750

接口A。它更短。

            回答 #6

赞同：1

时间：2008-12-01T23:02:21.683

界面 A... 我喜欢标签内容的属性。

            回答 #7

赞同：1

时间：2008-12-01T23:03:10.387

我想说第二种情况更难阅读，因为它在属性中隐藏了实现细节。

            回答 #8

赞同：1

时间：2008-12-02T01:32:12.473

接口 A，出于其他人概述的所有原因。但我建议 ToAddress 是一个元素，允许将相同的消息发送到多个 ToAddress：

```
<Request Type="sms" Refno="10">
  <To>27732687745332</To>
  <To>1234567890</To>
  <Content>Hello world</Content>
  </Request> 
```

作为一个挑剔的人，我建议属性使用前导小写，元素使用前导大写......但这只是我。

        sql-server - 在业务线应用程序中使用 SQL Server Analysis Services 数据的最佳方式是什么？

ID：332535

赞同：2

时间：2008-12-01T22:57:57.510

标签：sql-server, sql-server-2005, ssas, olap, business-intelligence

我们想看看是否可以通过将一些关键数据移动到 Analysis Services 多维数据集中来提高分析和报告的性能。但是，我还没有找到很多好的客户端前端。

我们的用户拥有 Office 2003。迁移到 2007 可能至少需要一年时间，而且 Excel 2003 的 Analysis Services 加载项不是很好。我还考虑过只创建一个 winforms 应用程序，但我没有太多运气为 SSAS 数据找到强大的控件。同时，Reporting Services 似乎让您将多维数据强制转换为二维数据集，然后才能在报表中使用。

我希望我遗漏了一些明显的东西，并且有一些很棒的客户端工具可以让我们以有意义的方式将多维数据从 SSAS 带到客户端应用程序。性能点似乎有点矫枉过正，但也许它是最好的选择。

是否有人在业务线应用程序中使用 SSAS 数据，还是主要用于临时分析？如果您将 SSAS 数据用于业务线应用程序，您在客户端前端使用什么技术？

            回答 #1

赞同：4

时间：2008-12-14T22:16:43.530

我现在正在进行一个使用 SSAS 2008 的项目。我们能够让所有试点用户升级到 Office 2007，并且在该项目的试点期间，我们使用 Excel 2007 作为前端工具。结果证明这是一个伟大的举措（对我们来说..YMMV），我对 Excel 2007 的数据功能的工作效果印象深刻。话虽如此，它并不能满足我们所有的业务需求，我们仍将使用报告工具 (MicroStrategy) 作为该项目的客户端工具产品的一部分。这篇文章（[http://www.microsoft.com/downloads/details.aspx?FamilyId=2D779CD5-EEB2-43E9-BDFA-641ED89EDB6C&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=2D779CD5-EEB2-43E9-BDFA-641ED89EDB6C&displaylang=en)）也很有帮助。  

尽管您没有直接问，但我仍然会说，如果后端设计不正确，FE 工具将无济于事。我建议使用谷歌搜索 Ralph Kimball 并购买 The Data Warehouse Toolkit 这本书。甚至还有一个专为 SSAS 2005 量身定制的。另请搜索 Microsoft Project Real 白皮书。

            回答 #2

赞同：2

时间：2008-12-02T03:51:58.930

我听说过有关此控件的好消息。

[http://www.datadynamics.com/Products/DDA/Default.aspx](http://www.datadynamics.com/Products/DDA/Default.aspx)

            回答 #3

赞同：1

时间：2008-12-15T08:47:30.013

我使用[了 Dundas 的 OLAP 控件](http://www.dundas.com/Products/Chart/NET/OLAp/index.aspx)。非常好且易于使用。

            回答 #4

赞同：1

时间：2009-04-07T21:21:24.610

还推荐使用 DevExpress 工具包，ASPxPivotGrid 直接针对多维数据集工作，在通过属性显示组/维度/等的内容和方式方面具有一定的灵活性。好的价格和产品。我不在那里工作:)

看看一些演示：

[http://demos.devexpress.com/ASPXPIVOTGRIDDEMOS/OLAP/Browser.aspx](http://demos.devexpress.com/ASPXPIVOTGRIDDEMOS/OLAP/Browser.aspx)

也很好地与他们的图表整合。

        apache-flex - 未找到提供程序 com.bea.xml.stream.MXParserFactory

ID：332537

赞同：3

时间：2008-12-01T22:58:32.453

标签：apache-flex, flexbuilder

尝试在 Flex builder 3 中导入 WSDL 时有人遇到此错误吗？

似乎它只发生在尝试导入具有“虚拟”端点的基于 WCF 的服务时......

一些挖掘让我认为 Flex 在解析 wsdl 时遇到了麻烦（但是标准的 Web 服务可以正常工作）。

一个错误已经打开了几个月，仍然没有来自 Adob​​e 的回复：

[http://bugs.adobe.com/jira/browse/FB-13542](http://bugs.adobe.com/jira/browse/FB-13542)

            回答 #1

赞同：1

时间：2010-11-05T17:26:14.093

我正在使用 Flex Builder 3，  在 FB-13542 的 adobe bug 库中提到的[http://poradowski.com/fb/解决方案对我有用。](http://poradowski.com/fb/)我刚刚备份了 com.adobe.flexbuilder.axis2_3.0.214193.jar 文件并将更新的 jar 文件放在它的位置。重新启动 Flex Builder 并能够导入其中包含“策略”标签的 wsdl。

            回答 #2

赞同：0

时间：2009-01-29T15:56:30.637

这通常发生在您使用 StAX API 并且您的类路径中没有 StAX 实现时。见[http://forums.java.net/jive/thread.jspa?messageID=117971](http://forums.java.net/jive/thread.jspa?messageID=117971)

我对 Flex 不太熟悉 - 但即使您不直接使用 StAX，它也可能在幕后使用它。

        sql-server-2005 - 消息 64，级别 20，状态 0，行 0 SQL Server 错误

ID：332540

赞同：2

时间：2008-12-01T23:02:21.043

标签：sql-server-2005, stored-procedures

我在 SQL Server 2005 服务器上运行存储过程，导致以下错误：

Msg 64, Level 20, State 0, Line 0 从服务器接收结果时发生传输级错误。（提供者：TCP 提供者，错误：0 - 指定的网络名称不再可用。）

一旦发生错误，我就会失去与服务器的连接，但能够重新连接。

事件日志中没有任何内容。该数据库仍然可以正常运行，并且可以正常运行其网站。

编辑：每次我运行这个存储过程时都会发生这种情况，或者它被应用程序调用。

关于可能导致此错误的任何建议？

            回答 #1

赞同：1

时间：2008-12-02T05:11:05.090

当客户端连接打开时数据库服务器不可用时，就会发生这种情况。

重现：如果您在 SSMS 中打开了查询，请重新启动 SQL 实例，再次运行查询以获取此错误。

想法：

*   SQL 实例是否正在重新启动？
*   数据库是否[自动关闭](http://msdn.microsoft.com/en-us/library/ms190249(SQL.90).aspx)？（例如桌面版本，但不要自己使用它们）
*   防火墙问题？

            回答 #2

赞同：0

时间：2008-12-01T23:08:25.040

一些想法：

这可能是在您启用连接池时引起的，并且无论出于何种原因，池中的一个连接失去了与数据库的连接（由于网络中断或任何其他原因）。

每次调用此存储过程时都会发生这种情况吗？

该存储过程是否尝试访问链接服务器？

        vb.net - asmx wsdl 字符串长度

ID：332551

赞同：2

时间：2008-12-01T23:06:51.237

标签：vb.net, visual-studio-2008, wsdl, asmx

我在 Visual Studio 2008 的 .asmx 文件中有一个 VB 类：

```
public class foo
 public bla as String
end class 
```

它生成 wsdl 值：

```
<s:complexType name="foo">
  <s:sequence>
    <s:element minOccurs="0" maxOccurs="1" name="bla" type="s:string" /> 
  </s:sequence>
</s:complexType> 
```

但我希望 wsdl 生成的是：

```
<xs:element name="bla" type="xs:string" 
    sql:datatype="varchar(25)" minOccurs="1" maxOccurs="1">
</xs:element> 
```

有没有办法做到这一点？或者我可以编辑生成的 WSDL 吗？

            回答 #1

赞同：-2

时间：2009-08-24T04:53:06.120

您可以使用 System.Xml.Serialization.XmlElementAttribute 来标记属性 IE：

```
<XmlElement(DataType := "varchar(25)")> 
```

（如果这不是正确的语法，我的 vb 有点生疏）

您可以保存 WSDL 并对其进行编辑，但是，如果您更改 WSDL，从它生成的代理可能无法与您的服务通信。

编辑：如果您有目标架构，我建议您使用 xsd.exe 或 wsdl.exe 生成您需要根据该架构序列化为有效文档的类。

        c++ - 包含在 Linux GCC 链接器中

ID：332554

赞同：5

时间：2008-12-01T23:07:54.167

标签：c++, linux, unix, gcc

我不明白 GCC 在 Linux 下是如何工作的。在源文件中，当我执行以下操作时：

```
#include <math.h> 
```

编译器是否提取适当的二进制代码并将其插入到编译后的可执行文件中，或者编译器是否插入对外部二进制文件的引用（a-la Windows DLL？）

我想这个问题的通用版本是：*nix 下是否有与 Windows DLL 等效的概念？

            回答 #1

赞同：25

时间：2008-12-01T23:17:01.230

好。当您包含时`math.h`，编译器将读取包含可以使用的函数和宏的声明的文件。*如果您调用在该文件（标头*）中声明的函数，则编译器会在目标文件中的该位置插入一条调用指令，该指令将由您编译的文件生成（让我们调用它`test.c`并创建目标文件`test.o`）。它还在该对象文件的重定位表中添加了一个条目：

```
Relocation section '.rel.text' at offset 0x308 contains 1 entries:
 Offset     Info    Type            Sym.Value  Sym. Name
0000001c  00000902 R_386_PC32        00000000   bar 
```

这将是功能栏的重定位条目。将在符号表中创建一个条目，注意该函数尚未定义：

```
9: 00000000     0 NOTYPE  GLOBAL DEFAULT  UND bar 
```

当您将`test.o`目标文件链接到程序中时，您需要链接名为`libm.so`. 该`so`扩展类似于`.dll`windows 的扩展。这意味着它是一个**共享对象文件**。编译器在链接时将修复出现在 的重定位表中的所有位置`test.o`，将其条目替换为 bar 函数的正确地址。根据您是使用库的共享版本还是静态库（`libm.a`然后调用它），编译器将在编译后或稍后在您实际启动程序时在运行时进行修复。完成后，它将在该程序所需的共享库表中注入一个条目。（可以用 表示`readelf -d ./test`）：

```
Dynamic section at offset 0x498 contains 22 entries:
  Tag        Type                         Name/Value
 0x00000001 (NEEDED)                     Shared library: [libm.so.6]
 0x00000001 (NEEDED)                     Shared library: [libc.so.6]
 ... ... ... 
```

现在，如果您启动程序，动态链接器将查找该库，并将该库链接到您的可执行映像。在 Linux 中，执行此操作的程序称为`ld.so`. 静态库在动态部分没有位置，因为它们只是链接到其他目标文件然后被遗忘；从那时起，它们就是可执行文件的一部分。

实际上它实际上要复杂得多，我也没有详细了解这一点。不过，这是一个粗略的计划。

            回答 #2

赞同：8

时间：2008-12-01T23:17:19.327

这里涉及到几个方面。

首先，**头文件**。编译器只是在包含文件的位置包含文件的内容，仅此而已。据我所知，GCC 甚至没有区别对待标准头文件（但我可能错了）。

但是，头文件实际上可能不包含实现，仅包含其声明。如果实现位于其他地方，您必须告诉编译器/链接器。默认情况下，您只需将适当的**库文件**传递给编译器，或传递库名称即可。例如，以下两个是等效的（前提是`libcurl.a`位于链接器可以找到的目录中）：

```
gcc codefile.c -lcurl
gcc codefile.c /path/to/libcurl.a 
```

这告诉[链接编辑器](http://en.wikipedia.org/wiki/Linker)（“链接器”）将您的代码文件链接到静态库的实现`libcurl.a`（编译器`gcc`实际上忽略了这些参数，因为它不知道如何处理它们，只是将它们传递给链接器） . 但是，这称为**静态链接**。还有[**动态链接**](http://en.wikipedia.org/wiki/Dynamic_linker)，它发生在程序启动时，`.dll`在 Windows 下发生在 s 上（而静态库对应`.lib`于 Windows 上的文件）。Linux下的动态库文件通常具有文件扩展名`.so`。

The best way to learn more about these files is to familiarize yourself with the GCC linker, `ld`, as well as the excellent toolset [`binutils`](http://www.gnu.org/software/binutils/), with which you can edit/view library files effortlessly (any binary code files, really).

            回答 #3

赞同：2

时间：2008-12-01T23:16:45.257

*nix 下是否有与 Windows DLL 等效的概念？

是的，它们被称为“共享对象”或 .so 文件。它们在运行时动态链接到您的二进制文件中。在 linux 中，您可以在可执行文件上使用“ldd”命令来查看二进制文件链接到哪些共享对象。您可以使用来自 sysinternals 的 ListDLLs 在 Windows 中完成同样的事情。

            回答 #4

赞同：1

时间：2008-12-01T23:11:49.493

编译器可以做它想做的任何事情，只要它实际上就像你包含了文件一样。（我所知道的所有编译器，包括 GCC，都只包含一个名为 math.h 的文件。）

不，它通常不包含函数定义本身。那就是 libm.so，一个“共享对象”，类似于 windows .DLL。它应该在每个系统上，因为它是 C 运行时 libc.so 的伴侣。

编辑：这就是为什么如果你使用数学函数，你必须将 -lm 传递给链接器 - 它指示它链接到 libm.so。

            回答 #5

赞同：1

时间：2008-12-01T23:13:27.557

有。包含对头文件进行文本包含（这是标准的 C/C++ 行为）。您正在寻找的是**链接器**。gcc/g++ 的 -l 参数告诉链接器要添加哪些库。对于数学 (libm.so)，您将使用 -lm。常见的模式是：

*   源文件：#include <foo.h>
*   gcc/g++ 命令行：-lfoo
*   共享库：libfoo.so

math.h 是这个主题的轻微变化。

        c# - 版本控制算法

ID：332558

赞同：3

时间：2008-12-01T23:10:32.803

标签：c#, sql, algorithm

我有一个存储对象的数据库。我有以下（简化的）架构

```
CREATE TABLE MyObjects
(
  UniqueIdentifier Id;
  BigInt           GenerationId;
  BigInt           Value;
  Bit              DeleteAction;
) 
```

每个对象都有一个唯一标识符（“Id”）和一个（一组）属性（“Value”）。每次更改对象的属性值时，我都会在此表中输入一个新行，并使用新的世代 id（“GenerationId”，单调递增）。如果删除了一个对象，那么我通过将“DeleteAction”位设置为 true 来记录这一事实。

**在任何时间点（生成），我都想检索所有活动对象的状态！**

这是一个例子：

```
Id    GenerationId Value  DeleteAction
1        1          99       false
2        1          88       false
1        2          77       false
2        3          88       true 
```

世代中的对象是：

```
 1: 1 {99}, 2 {88}
  2: 1 {77}, 2 {88}
  3: 1 {77} 
```

关键是：如何找出每个唯一对象的行，其**世代 id 最接近（但不超过）给定世代 id**？然后，我可以执行一个过滤后步骤来删除 DeleteAction 字段为 true 的所有行。

            回答 #1

赞同：4

时间：2008-12-02T09:56:27.587

这适用于 MS SQL

```
SELECT id,value
FROM Myobjects
INNER JOIN ( 
     SELECT id, max(GenerationID) as LastGen 
     FROM MyObjects
     WHERE GenerationID <= @Wantedgeneration
     Group by ID)
    On GenerationID = LastGen
WHERE DelectedAction = false 
```

            回答 #2

赞同：2

时间：2008-12-02T15:12:43.143

我的版本使用表 MyObjects 的联合来对抗自身的子集，由子查询创建，并且只包含每个对象的最后一代：

```
SELECT O.id,generation,value FROM 
     MyObjects O, 
     (SELECT id,max(generation) AS max_generation FROM MyObjects 
     WHERE generation <= $GENERATION_ID GROUP BY id) AS TheMax WHERE 
            TheMax.max_generation = generation AND O.deleted is False
     ORDER BY generation DESC; 
```

在上面的查询中，GENERATION_ID 是硬连线的。对其进行参数化的一种方法是编写一个函数：

```
CREATE OR REPLACE FUNCTION generation_objects(INTEGER) RETURNS SETOF MyObjects AS
  'SELECT O.id,generation,value,deleted FROM 
       MyObjects O, 
       (SELECT id,max(generation) AS max_generation FROM MyObjects 
       WHERE generation <= $1 GROUP BY id) AS TheMax WHERE 
              TheMax.max_generation = generation AND O.deleted is False;'
  LANGUAGE SQL; 
```

现在，它起作用了。有了这张表：

```
> SELECT * FROM MyObjects;          
 id | generation | value | deleted 
----+------------+-------+---------
  1 |          1 |    99 | f
  2 |          2 |    88 | f
  1 |          3 |    77 | f
  2 |          4 |    88 | t
  3 |          5 |    33 | f
  4 |          6 |    22 | f
  3 |          7 |    11 | f
  2 |          8 |    11 | f 
```

我得到：

```
> SELECT * FROM generation_objects(1) ORDER by generation DESC;
 id | generation | value | deleted 
----+------------+-------+---------
  1 |          1 |    99 | f

> SELECT * FROM generation_objects(2) ORDER by generation DESC;
 id | generation | value | deleted 
----+------------+-------+---------
  2 |          2 |    88 | f
  1 |          1 |    99 | f

> SELECT * FROM generation_objects(3) ORDER by generation DESC;
 id | generation | value | deleted 
----+------------+-------+---------
  1 |          3 |    77 | f
  2 |          2 |    88 | f 
```

然后，在下一代，对象 2 被删除：

```
> SELECT * FROM generation_objects(4) ORDER by generation DESC;
 id | generation | value | deleted 
----+------------+-------+---------
  1 |          3 |    77 | f 
```

            回答 #3

赞同：1

时间：2008-12-06T00:30:04.513

这是工作版本：

```
SELECT MyObjects.Id,Value
FROM Myobjects
INNER JOIN 
(      
  SELECT Id, max(GenerationId) as LastGen
  FROM MyObjects
  WHERE GenerationId <= @TargetGeneration
  Group by Id
) T1
ON MyObjects.Id = T1.Id AND MyObjects.GenerationId = LastGen
WHERE DeleteAction = 'False' 
```

            回答 #4

赞同：0

时间：2008-12-01T23:22:33.840

不确定这是否是标准 SQL，但在 Postgres 中，您可以使用 LIMIT 标志：

```
 select GenerationId,Value,DeleteAction from MyObjects 
    where Id=1 and GenerationId < 3 
    order by GenerationId
    limit 1; 
```

        tfs - 是否有任何工具可以帮助将目录与 TFS 同步？

ID：332567

赞同：0

时间：2008-12-01T23:14:36.667

标签：tfs

将 TFS 与 Visual Studio 之外的工具（特别是 ORMS）一起使用时，对项目文件进行修改以包含新文件不会导致该文件被添加到源代码管理中。

是否存在任何可能会说“警告：您即将签入对项目文件的更改，其中包含未版本控制的文件”

            回答 #1

赞同：1

时间：2008-12-02T13:39:14.173

除了 Martin 的回答，最新发布的 TFS Power Toys 还包括：

" **Windows Shell 扩展（新！）**

允许在 Windows 资源管理器中进行核心版本控制操作，而无需使用团队资源管理器。”

因此，您可能只需提交这些新文件，而无需启动 Team Explorer 或使用符合 MSSCCI 的源代码控制客户端。

            回答 #2

赞同：0

时间：2008-12-02T13:17:42.330

不完全是，但是您可能想要下载[TFS Power Tools](http://msdn.microsoft.com/en-us/tfs2008/bb980963.aspx)并查看命令行实用程序 tfpt.exe。

在集成 TFS 客户端之外工作时，“tfpt online”和“tfpt treeclean”可能对您最有用。tfpt online 将在本地目录中查找不受版本控制的文件，treeclean 将向您显示本地目录中不受版本控制的文件，以便您可以在不需要时将其删除。

祝你好运，

马丁。

            回答 #3

赞同：0

时间：2009-11-26T12:01:48.710

我在网上使用 tfpt 时发现的一个问题是，除非您使用 /diff 开关，否则它并不总是能够接受更改。在我意识到发生了什么事之前，那个让我们对我们的自动构建感到头疼的问题！

        sql - 如何在 SQL Server Management Studio 编辑器中查看制表位的位置？

ID：332574

赞同：4

时间：2008-12-01T23:17:27.283

标签：sql, sql-server, ssms, code-by-voice

我使用语音识别来口述 SQL，而且排列起来很痛苦。如果我能看到制表位在哪里，那会节省很多时间。

            回答 #1

赞同：5

时间：2008-12-01T23:17:45.410

Management Studio 支持[Visual Studio 也具有](https://stackoverflow.com/questions/84209/vertical-line-after-a-certain-amount-of-characters-in-visual-studio)的未记录功能。它将垂直引导线添加到特定列位置的编辑器窗口。

使用下面的文本创建一个 .reg 文件并打开它以将其与您的注册表合并。这将在 SQL Server 2005 中每 8 个字符（最多 96 列）添加一行。根据需要进行修改以适合您的选项卡大小。它似乎不支持超过 12 行。字符串的 RGB 部分应该设置颜色，但对我来说它总是显示为黑色。您会很快注意到为什么这是一个未记录的功能 - 这些行出现在不需要的位置，例如消息输出窗口。

```
Windows Registry Editor Version 5.00

[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Microsoft SQL Server\90\Tools\Shell\Text Editor]
"Guides"="RGB(128,0,0) 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96" 
```

            回答 #2

赞同：1

时间：2008-12-02T10:53:27.427

也许是 Red Gate 的[SQL Refactor](http://www.red-gate.com/products/SQL_Refactor/index.htm)。您可以定义所需的代码布局，然后简单地使用命令“Lay Out SQL”。

当您安装 SQL Refactor 时，它会在 Management Studio 主菜单中添加额外的菜单项。每个命令都有其键盘快捷键（例如，对于 Lay Out SQL，它是 Ctrl+B Ctrl+L），所以我假设您应该能够将该命令分配给您的语音识别工具。

SQL Refactor 附带价格，但您可以下载 14 天完整工作试用版来试用它是否满足您的需求。

        vb.net - 生成大量随机数据 vb6/vb net

ID：332580

赞同：1

时间：2008-12-01T23:18:58.873

标签：vb.net, vb6

到目前为止，当我需要生成一组 500,000 个字符时，我尝试过的所有功能都没有很好地工作：（有什么想法吗？）

            回答 #1

赞同：3

时间：2008-12-01T23:29:35.310

使用 UUIDGen。

不。GUID 并不是真正随机的。`System.Random`实际上，您可以使用VB.NET中的类非常快速地生成大量数据。500,000 个字符/字节没问题：

```
Dim buffer As Byte() = Nothing
Array.Resize(buffer, 500000)
Call New Random().NextBytes(buffer)
My.Computer.FileSystem.WriteAllBytes("filename", buffer, False) 
```

这段代码需要不到一秒钟的*时间。*

            回答 #2

赞同：0

时间：2008-12-02T13:20:44.600

在 VB6 中，代码会像这样

```
Public Function FillRandomCol() as Collection
    Dim C As Collection
    Dim I As Long
    Set C = New Collection
    Randomize Timer
    For I = 1 To 500000
        C.Add RandomChar
    Next I
    Set FillRandomCol = C
End Sub

Public Function Random(ByVal Number As Integer) As Integer
    Random = CLng(Rnd * 1000000) Mod Number + 1
End Function

Public Function RandomChar() As String
    Const AlphaNum = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    RandomChar = Mid$(AlphaNum, Random(36), 1)
End Function 
```

在 2 核 Intel 2.40 GHz 计算机上需要 1/2 秒。

            回答 #3

赞同：-1

时间：2008-12-01T23:22:53.433

使用[UUIDGen](http://msdn.microsoft.com/en-us/library/ms526809(EXCHG.10).aspx)。至少块会更大。

        .net - 使用 .NET 3.5 创建新的 Soap Web 服务

ID：332581

赞同：2

时间：2008-12-01T23:19:30.837

标签：.net, web-services

自 2.0 以来，我还没有真正研究过新的 .NET 东西，但我想知道现在创建 Web 服务的首选方法是什么（SOAP，而不是 RESTful）。我记得在过去，您创建了一个 ASP.NET Web 服务。现在，我一直在研究 WCF，但似乎增加了一些复杂性。我已经在谷歌上搜索了一些示例代码，打开了 30 个选项卡，但是在做某事的最佳方式方面并没有一致性：一些示例适用于 .NET 2.0、.NET 1.1 等。任何人都知道哪里有一些好的简单 CRUD -基于的例子是？（我一直在扫描 MSFT 的网站，但还没有偶然发现——还没有——看到那篇黄金文章。）

谢谢

            回答 #1

赞同：2

时间：2008-12-02T00:27:36.300

有几件事。

1）添加->新建Web服务（asmx）仍然可以。

2) 使用 WCF 也同样容易做到这一点（而且它仍然只是 SOAP）。

使用 WCF 的好处是，如果您想更改某些功能（例如传输类型等），您可以“与未来兼容”。

            回答 #2

赞同：1

时间：2008-12-02T02:54:12.400

我真的觉得 MSDN 的[入门教程](http://msdn.microsoft.com/en-us/library/ms734712.aspx)很值得。它引导您定义合同、实施合同、托管服务，然后使用它。它从零开始，在没有向导的情况下引导您完成每一步，因此您可以了解自己在做什么以及为什么这样做。如果您想了解更多信息，请参阅每个主题的更深入处理的链接。

如果您要做的只是公开一个 SOAP Web 服务，那么 WCF 就不是必需的了。老式的 .asmx Web 服务在 3.5 中仍然可用。当您意识到可以使用从二进制协议到各种 Web 协议（托管在 IIS 内部或外部托管）的任何东西来公开相同的合同实现时，WCF 的真正优势就显示出来了。如果您已经对 SOAP 感到满意，那么这种灵活性甚至可能毫无价值。

        physics - 2d 平台物理

ID：332585

赞同：16

时间：2008-12-01T23:22:49.003

标签：physics, tile-engine

那是一个长长的假期周末，所以我又遇到了编码错误并开始玩弄：

[马里奥 http://gfilter.net/junk/tileengine.jpg](http://gfilter.net/junk/tileengine.jpg)

我写了一个基本的瓦片引擎，但以前从未尝试过，我真的很努力处理精灵碰撞检测和实现重力的真实物理。

对于任何其他游戏爱好作家，您能否指出一些关于解决此问题的最佳方法的演练？

**更新：**

我想我会分享一份进度报告：

[http://www.youtube.com/watch?v=-RKNQ2UiiLY](http://www.youtube.com/watch?v=-RKNQ2UiiLY) <-- 游戏实战

它仍然非常有问题，但碰撞检测大部分都在工作，我已经开始研究其他一些功能（例如碰撞块（注意错误）和与敌人互动）。

马里奥仍然像在月球上一样走路，我正在使用这些常数，有什么建议可以调整它们以获得更真实的感觉吗？

```
 const float AirDrag = 1.00f;
    const float GroundFriction = .97f;
    const float Gravity = 0.8f; 
```

            回答 #1

赞同：5

时间：2008-12-01T23:55:37.877

下载 FarseerPhysics 引擎，看看它是如何工作的[http://www.codeplex.com/FarseerPhysics](http://www.codeplex.com/FarseerPhysics)我认为这是 XNA/Silverlight 可用的最好的东西！

            回答 #2

赞同：3

时间：2008-12-02T01:40:35.513

重力很简单：

```
const gravity = ... ; // pixels per timestep (eg. video frame) squared
// while in freefall, each timestep:
y_velocity += gravity;
y_pos += y_velocity; 
```

请注意，我玩过的大多数 2D 平台游戏**都没有**真实的重力。做任何让游戏变得有趣的事情！

            回答 #3

赞同：2

时间：2008-12-02T02:30:47.207

[jnrdev](http://jnrdev.72dpiarmy.com/)可能会有所帮助。它涵盖了瓷砖碰撞/响应和斜坡。这不是我见过的最好的代码，但它完成了工作。

            回答 #4

赞同：2

时间：2009-05-09T21:26:31.300

[在http://www.metanetsoftware.com/technique/tutorialA.html](http://www.metanetsoftware.com/technique/tutorialA.html)和[http://www.metanetsoftware.com/technique/tutorialB.html](http://www.metanetsoftware.com/technique/tutorialB.html)上有几个非常有用的二维平台游戏教程。我认为他们已经被其他地方的其他人引用过。它们涵盖了碰撞检测和响应、光线投射、各种优化技术等，并且对于那些（像我一样）不太喜欢数学的人很好地解释了背后的理论。它并没有像刚体动力学这样的东西，但我认为对于你正在编写的游戏类型你不需要它（尽管如果你添加这种东西当然会很酷...... .)

            回答 #5

赞同：1

时间：2008-12-01T23:43:11.973

这可能是绕道而行，但请尝试使用 XNA 3.0 的 Platformer 入门套件，其中包含物理和基本碰撞检测等内容。你需要改变一些东西以使它在 XNA 之外工作，但这不是火箭科学。

[XNAGS 3.0 下载](http://www.microsoft.com/downloads/details.aspx?FamilyId=7D70D6ED-1EDD-4852-9883-9A33C0AD8FEE&displaylang=en)

            回答 #6

赞同：0

时间：2012-08-09T05:10:57.613

```
 UIGraphicsBeginImageContext(images.size);
    CGContextRef context = UIGraphicsGetCurrentContext();
    UIColor *color = [UIColor whiteColor];
    [color setFill];

    CGContextTranslateCTM(context, 1, images.size.height);
    CGContextScaleCTM(context, 1.0, -1.0);
    CGContextSetBlendMode(context, kCGBlendModeDestinationOver);
    CGRect rect = CGRectMake(0.0, 0.0, images.size.width, images.size.height);
    CGContextDrawImage(context, rect, images.CGImage);
    CGContextClipToMask(context, rect, images.CGImage);
    CGContextAddRect(context, rect);
    CGContextDrawPath(context, kCGPathFill);
    images = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext(); 
```

            回答 #7

赞同：0

时间：2009-03-25T17:24:57.303

我不知道您在使用什么物理模型，但是最近在[另一个 SO question中解决了使用](https://stackoverflow.com/questions/667034/simple-physics-based-movement)[流体阻力](http://en.wikipedia.org/wiki/Air_resistance)的物理模型。我不会重复我在答案中给出的所有内容，我只会[链接到它](https://stackoverflow.com/questions/667034/simple-physics-based-movement/667090#667090)。

总而言之，该问题的 OP 想要将物体从静止加速到最大速度。我经历了一些推导，将速度建模为两种不同类型阻力的时间函数。您的情况可能略有不同，因此使用的积分可能有不同的形式或需要用不同的初始条件求解，但希望我的回答能为您指明一些信息方向。

            回答 #8

赞同：0

时间：2009-07-26T14:39:09.153

您的多个块被碰撞的错误，您可以通过仅碰撞与播放器精灵最对齐或偏移量最小的块来解决该问题。确保不要将其限制在一个方向。在马里奥中，实际上可以从任何方向撞块。（以上通过在相同的游戏中进行地面磅，或钻旋转的东西）（使用外壳的侧面）

            回答 #9

赞同：-6

时间：2008-12-02T02:25:07.810

听说过[GameMaker](http://gamemaker.nl)吗？

        java - Hibernate / JPA中注释字段或getter方法之间的性能差异

ID：332591

赞同：8

时间：2008-12-01T23:25:12.463

标签：java, hibernate, jpa

我很好奇是否有人对使用私有字段而不是公共 getter 方法注释实体之间的性能差异有任何确切的数字。我听说人们说字段速度较慢，因为它们被称为“通过反射”，但是 getter 方法也是如此，不是吗？Hibernate 需要在尝试读取它之前将字段的可访问性设置为 true，我可以看到它有一些*轻微*的开销。但是，这不会在 Session 范围内的类级别上完成，或者可能只在读取 Configuration 并构建 SessionFactory 时完成一次？

只是好奇这是一个神话还是真的有真相；我个人发现注释字段更具可读性。

            回答 #1

赞同：9

时间：2008-12-02T01:38:40.603

将 5000 条记录加载到一个简单的 3 列表中。将两个类映射到该表，一个使用带注释的私有字段，另一个使用带注释的公共 getter。运行 Spring 的 HibernateTemplate.loadAll() 30 次，然后运行 ​​HibernateTemplate.clear() 以清除 Session 缓存。结果以毫秒为单位...

方法总数：6510，平均：217

字段总数：6586，平均：219

在为每个类添加更多属性之后，我可能应该再试一次，但现在差异似乎没有统计学意义。

            回答 #2

赞同：1

时间：2008-12-01T23:39:25.553

好的，我不能给出数字哈哈，但我猜想通过反射访问字段不会是“一次性”的事情。每个对象都有自己的私有成员。

老实说，我对反射知之甚少，但 getter/setter 应该是直截了当的。实际上，您可以尝试将其中一种方法设置为私有，但我认为它不会起作用，因为它找不到所需的方法。

还有其他问题，如代理会影响 getter 方法，但这取决于您加载实体的方式。  

这就是我在文档中看到的全部内容：

access 属性允许您控制 Hibernate 在运行时如何访问该属性。默认情况下，Hibernate 将调用属性 get/set 对。如果您指定 access="field"，Hibernate 将绕过 get/set 对并使用反射直接访问该字段。您可以通过命名实现接口 org.hibernate.property.PropertyAccessor 的类来指定您自己的属性访问策略。

我的猜测是，一般来说，反射的成本会更高，但抱歉.. 没有数字:(

            回答 #3

赞同：0

时间：2013-03-12T07:57:06.700

通常在 getter 方法的上面使用注释，因为当类在 JVM 中加载时，也会加载休眠模型或实体类，那么如果您在字段或属性上面使用注释，那么它将在每个请求时只执行一次。而如果你把它放在 getter 上面然后在 refaction 或任何其他层中，当它会调用这个类时，然后调用 getter 方法，那么这将变得非常有用

        jquery - 在 jQuery 中使 slideToggle() 元素默认折叠

ID：332592

赞同：39

时间：2008-12-01T23:25:56.563

标签：jquery

我有一组要`collapsible/expandable`使用 jQuery`slideToggle()`方法制作的 div。如何使所有这些 div 默认折叠？我想避免`slideToggle()`在页面渲染期间/之后显式调用每个元素。

            回答 #1

赞同：58

时间：2008-12-01T23:30:45.837

您必须为这些图层分配一个样式：display:none，以便它们在 javascript 渲染之前不显示。然后你可以毫无问题地调用 slideToggle() 。例子：

```
<style type="text/css">
    .text{display:none}
</style>

<script type="text/javascript">
    $(document).ready(function() {    
        $('span.more').click(function() {
            $('p:eq(0)').slideToggle();
            $(this).hide();
        });
    });
</script>

<body>              
      <p class="text">
          I am using jquery <br/>
          I am using jquery <br/>
          I am using jquery <br/>
          I am using jquery <br/>
          I am using jquery <br/>
          I am using jquery <br/>           
      </p>
      <span class="more">show</span> 
```

            回答 #2

赞同：13

时间：2008-12-03T02:27:38.990

您可以使用 style="display: none;" 开始您的元素 并且 slideToggle() 将从那里获取它。

            回答 #3

赞同：12

时间：2008-12-01T23:29:26.400

你可能可以做这样的事情：

```
$(document).ready(function(){
  $('div').hide();
}); 
```

            回答 #4

赞同：2

时间：2012-02-02T16:58:57.240

Applying a CSS style behind the scenes will, as stated before, cause complications for users with scripts disabled. A way around this is to declare your element hidden as Anne said, or by defining your CSS in your script as a function to be altered, not as styling for the page (to keep structure, style and function separate) and then using the toggleClass function of the script or the custom effect hide functions defined by jQuery. 

        c# - 在 C# 中关闭调用 tabPage_Enter 方法

ID：332601

赞同：1

时间：2008-12-01T23:31:50.857

标签：c#, winforms, tabcontrol

当我使用以下代码切换选项卡时

```
tabControl1.SelectTab("MyNextTab"); 
```

它为要切换的选项卡和要切换到的选项卡调用 tabPage_Enter。我希望它被调用它正在切换到的选项卡，而不是它正在切换的选项卡。我将如何关闭它。我确实知道它什么时候发生，所以如果有一个调用，我可以关闭调用该选项卡的 enter 方法，我可以实现它。

            回答 #1

赞同：2

时间：2008-12-02T04:06:05.313

是的，如果我使用按钮更改选定的选项卡，我会重现。TabControl 在更改 SelectedIndex 之前将焦点强制到自身上。这样做似乎是为了避免 Validating 事件出现问题。焦点更改产生第一个 Enter 事件，对于活动选项卡，选项卡更改然后产生第二个 Enter 事件。

知道这一点后，您可以设置一个辅助布尔成员，指示应忽略第一个 Enter 事件。小心检查当前选项卡是否已经不是您要选择的选项卡。在一个完美的世界中，这种行为应该无关紧要。焦点确实*首先*移到了活动选项卡。

            回答 #2

赞同：0

时间：2008-12-01T23:58:21.850

您可以使用它检查活动选项卡的索引和解决方法吗？

            回答 #3

赞同：0

时间：2008-12-02T01:24:25.653

将代码包装在检查中的事件中，以便它仅在您需要时处理。

如果您可以编写代码将其关闭，那么您可以编写代码来设置阻止事件中的代码运行的状态。

        sql - 在关系数据库中维护子类的完整性

ID：332602

赞同：10

时间：2008-12-01T23:32:49.420

标签：sql, sql-server, database-design, oop

假设我有一个代表超级班级的表格，**students**。然后我有 N 个表来表示该对象的子类（**运动员**、**音乐家**等）。我如何表达一个约束，使得学生必须在一个（不是更多，也不是更少）子类中建模？

关于评论的澄清：

*   这是手动维护的，而不是通过 ORM 包。
*   与此相关的项目位于 SQL Server 之上（但很高兴看到通用解决方案）
*   这可能不是最好的例子。关于子类化，我们可以考虑几个场景，我只是碰巧发明了这个学生/运动员的例子。

A）在真正的面向对象的方式中，超类可以单独存在并且不需要在任何子类中建模。

B) 在现实生活中，任何对象或学生都可以有多个角色。

C）我试图说明的特定场景是要求每个对象都在一个子类中实现。将超类视为抽象实现，或者只是从其他不同的对象类/实例中分解出来的共性。

感谢大家的意见，尤其是比尔。

            回答 #1

赞同：4

时间：2008-12-02T13:30:09.980

每个学生记录将有一个子类列（为了论证，假设它是一个 CHAR(1)）。{A = 运动员，M= 音乐家...}

现在创建您的运动员和音乐家表。它们还应该有一个 SubClass 列，但应该有一个检查约束硬编码它们所代表的表类型的值。例如，您应该为 Athlete 表的 SubClass 列设置默认值“A”和 CHECK 约束“A”。

使用 StudentID AND Subclass 的 COMPOSITE 外键将您的 Musician 和 Athlete 表链接到 Student 表。你完成了！去享受一杯好喝的咖啡。

```
CREATE TABLE Student (
    StudentID INT NOT NULL IDENTITY PRIMARY KEY,
    SubClass CHAR(1) NOT NULL,
    Name VARCHAR(200) NOT NULL,
    CONSTRAINT UQ_Student UNIQUE (StudentID, SubClass)
);

CREATE TABLE Athlete (
    StudentID INT NOT NULL PRIMARY KEY,
    SubClass CHAR(1) NOT NULL,
    Sport VARCHAR(200) NOT NULL,
    CONSTRAINT CHK_Jock CHECK (SubClass = 'A'),
    CONSTRAINT FK_Student_Athlete FOREIGN KEY (StudentID, Subclass) REFERENCES Student(StudentID, Subclass)
);

CREATE TABLE Musician (
    StudentID INT NOT NULL PRIMARY KEY,
    SubClass CHAR(1) NOT NULL,
    Instrument VARCHAR(200) NOT NULL,
    CONSTRAINT CHK_Band_Nerd CHECK (SubClass = 'M'),
    CONSTRAINT FK_Student_Musician FOREIGN KEY (StudentID, Subclass) REFERENCES Student(StudentID, Subclass)
); 
```

            回答 #2

赞同：2

时间：2008-12-01T23:45:15.480

这里有几种可能性。一个是`CHECK`在每个表`student_id`中没有出现在任何其他姐妹子类型表中的 a。这可能很昂贵，并且每次需要新的子类型时，都需要修改所有现有表中的约束。

```
CREATE TABLE athletes (
  student_id INT NOT NULL PRIMARY KEY,
  FOREIGN KEY (student_id) REFERENCES students(student_id),
  CHECK (student_id NOT IN (SELECT student_id FROM musicians 
                      UNION SELECT student_id FROM slackers 
                      UNION ...)) 
); 
```

**编辑：** @JackPDouglas 正确指出 Microsoft SQL Server 不支持上述形式的 CHECK 约束。事实上，根据 SQL-99 标准引用另一个表也不是有效的（参见[http://kb.askmonty.org/v/constraint_type-check-constraint](http://kb.askmonty.org/v/constraint_type-check-constraint)）。

SQL-99 为多表约束定义了一个元数据对象。这称为*ASSERTION*，但是我不知道任何实现断言的 RDBMS。

可能更好的方法是将`students`表中的主键设为复合主键，第二列表示子类型。然后将每个子表中的该列限制为与表所表示的子类型相对应的单个值。  **编辑：**无需使 PK 成为子表中的复合键。

```
CREATE TABLE athletes (
  student_id INT NOT NULL PRIMARY KEY,
  student_type CHAR(4) NOT NULL CHECK (student_type = 'ATHL'),
  FOREIGN KEY (student_id, student_type) REFERENCES students(student_id, student_type)
); 
```

当然`student_type`也可以很容易地成为一个整数，我只是将它显示为一个字符以用于说明目的。

如果您不支持`CHECK`约束（例如 MySQL），那么您可以在触发器中执行类似的操作。

我阅读了有关确保超类表中每一行的*某个*子类表中存在一行的后续内容。我认为没有一种实用的方法可以使用 SQL 元数据和约束来做到这一点。我可以建议满足此要求的唯一选择是使用[Single-Table Inheritance](http://martinfowler.com/eaaCatalog/singleTableInheritance.html)。否则，您需要依靠应用程序代码来执行它。

**编辑：** JackPDouglas 还建议使用基于[Class Table Inheritance](http://www.martinfowler.com/eaaCatalog/classTableInheritance.html)的设计。[在此处](https://stackoverflow.com/questions/987654/in-a-stackoverflow-clone-what-relationship-should-a-comments-table-have-to-quest/987709#987709)或[此处](https://stackoverflow.com/questions/1408556/is-it-possible-to-constrain-a-table-to-have-a-value-in-only-one-of-a-set-of-colum/1408592#1408592)或[此处](https://stackoverflow.com/questions/3349838/should-i-add-a-type-column-to-design-inheritance-in-postgresql/3349962#3349962)查看[他的示例](https://stackoverflow.com/questions/5522320/what-is-the-best-way-to-enforce-a-subset-relationship-with-integrity-constraint/5522344#5522344)或我的类似技术示例。

            回答 #3

赞同：1

时间：2008-12-04T14:44:48.410

如果您对数据建模感兴趣，除了对象建模，我建议您在网上查找“关系建模泛化专业化”。  

曾经有一些很好的资源可以很好地解释这种模式。

我希望这些资源仍然存在。

这是我希望你能找到的简化视图。  

在开始设计数据库之前，提出一个概念数据模型将数据库中存储的值与主题相关联是很有用的。制作概念数据模型实际上是数据分析，而不是数据库设计。有时很难将分析和设计分开。  

在概念级别对数据建模的一种方法是实体关系 (ER) 模型。有一些众所周知的模式可以对专业化-泛化情况进行建模。将这些 ER 模式转换为 SQL 表（称为逻辑设计）非常简单，尽管您必须做出一些设计选择。

如果我没看错的话，您给出的学生可能担任音乐家等多个角色的案例可能无法说明您感兴趣的案例。您似乎对子类互斥的情况感兴趣。也许车辆可能是汽车、卡车或摩托车的情况可能更容易讨论。

您可能会遇到的一个区别是超类的通用表实际上并不需要类型代码列。单个超类实例的类型可以通过各种子类表中是否存在外键来派生。包含或省略类型代码是否更明智取决于您打算如何使用数据。

            回答 #4

赞同：0

时间：2008-12-01T23:50:52.503

有趣的问题。当然，子表有 FK 约束，所以必须有一个学生来处理这些子表。  

主要问题是尝试在插入时进行检查。必须首先插入学生，这样您就不会违反子表中的 FK 约束，因此执行检查的触发器将不起作用。

如果您真的担心这一点，您可以编写一个不时检查的应用程序。我认为最大的恐惧是删除。有人可以删除子表条目，但不能删除学生。您可以使用触发器来检查何时从子表中删除项目，因为这可能是最大的问题。

我有一个数据库，每个子类层次结构都有一个表，就像这样。我使用 Hibernate 及其正确映射，因此它会自动删除所有内容。如果通过“手动”执行此操作，那么我将确保始终使用适当的级联删除父级，呵呵 :)

            回答 #5

赞同：0

时间：2008-12-02T02:17:08.717

谢谢，比尔。你让我想...

超类表有一个子类代码列。每个子类表都有一个外键约束，以及一个指示 id 与超类表的子集（其中代码 = 运动员）一起存在的约束。

这里唯一缺少的部分是可以在没有子类的情况下对超类进行建模。即使您将代码列设为强制性，它也可能只是一个空连接。这可以通过添加一个约束来解决，即超类的 id 存在于子类表中​​的 id 的联合中。如果在事务中间强制执行约束，则插入会因为这两个约束而变得有点麻烦。那或者只是不担心未分类的对象。

编辑：Bleh，听起来不错……但是由于不支持引用其他表的子查询这一事实而受到阻碍。至少在 SQL Server 中没有。

            回答 #6

赞同：0

时间：2008-12-02T03:52:03.440

这可以通过添加一个约束来解决，即超类的 id 存在于子类表中​​的 id 的联合中。

根据您想在架构中放入多少智能（以及 MS SQL Server 允许您放入多少），您实际上不需要对子类表进行联合，因为您知道，如果 id 存在于任何子类表，它必须与子类代码列标识的子类存在于同一子类中。

            回答 #7

赞同：0

时间：2015-03-12T22:49:10.527

我可能会添加一个检查约束。

将 ForeignKeys 创建为 Nullable。添加一个 Check 以确保它们不都为 null 并确保它们都未设置。约束 [CK_HasOneForiegnKey] 检查 ((FK_First!= NULL OR FK_Second != NULL) AND NOT (FK_First != NULL AND FK_Second != NULL))。

我不确定，但我相信这将允许您一次只设置一个键。

        asp.net-mvc - MVC 和 OpenID 重定向问题

ID：332603

赞同：2

时间：2008-12-01T23:32:59.857

标签：asp.net-mvc, redirect, openid

当我从 myopenid 提供程序获得 AuthenticationStatus.Authenticated (DotNetOpenId library) 响应时，我想使用 MVC Redirect(myurl) 将用户从登录页面重定向到另一个页面。但不幸的是，用户没有进入 myurl，而是被重定向到空页面：

myurl?token=AWSe9PSLwx0RnymcW0q....（+ 几千字节的 myopenid 特定查询字符串）

我也尝试了 FormsAuthentication.RedirectFromLoginPage()，但它再次重定向到原始登录页面而不是 myurl。

有人可以建议正确重定向到 myurl 吗？

谢谢

            回答 #1

赞同：1

时间：2009-02-15T10:59:05.443

首先你应该设置授权cookie：

```
FormsAuth.SetAuthCookie(UserName, RememberMe); 
```

在此之后，您应该返回 RedirectToAction 结果：

```
return RedirectToAction(actionName, controllerName); 
```

或重定向结果：

```
return Redirect(url); 
```

当你使用“return Redirect(url);” 它使用 Response.Redirect(url, false) 方法进行重定向，因此它必须工作。可能是您没有返回此操作结果，请检查此。“FormsAuthentication.RedirectFromLoginPage()”将在您未设置授权 cookie 或您的登录页面是应用程序的主页（默认）页面时重定向到登录页面 -

RedirectFromLoginPage 方法使用 ReturnURL 变量名称重定向到查询字符串中指定的 URL。例如，在 URL [http://www.contoso.com/login.aspx?ReturnUrl=caller.aspx](http://www.contoso.com/login.aspx?ReturnUrl=caller.aspx)中，RedirectFromLoginPage 方法重定向到返回 URL caller.aspx。如果 ReturnURL 变量不存在，RedirectFromLoginPage 方法将重定向到 DefaultUrl 属性中的 URL。

[通过 MSDN](http://msdn.microsoft.com/en-us/library/ka5ffkce.aspx "通过 MSDN")

            回答 #2

赞同：0

时间：2009-02-21T23:44:18.313

我使用经典的 ReturnUrl 查询字符串参数让用户回到正确的页面。不幸的是，RedirectFromLoginPage 在 OpenId 身份验证后无法正常工作，因此您必须手动进行。请注意，这是作为身份验证模块完成的，而不是在控制器上更深入。这样感觉更干净。

```
 FormsAuthentication.SetAuthCookie(openid.Response.ClaimedIdentifier, false);
      //FormsAuthentication.RedirectFromLoginPage(openid.Response.ClaimedIdentifier, false); <-- doesn't work
      //send back to the right page
      string returnUrl = ctx.Request.QueryString["ReturnUrl"];
      if (!string.IsNullOrEmpty(returnUrl))
      {
        returnUrl = HttpUtility.UrlDecode(returnUrl);
        ctx.Response.Redirect(returnUrl);
      } 
```

如果您想查看 OpenIdAuthenticationModule 的完整实现，请查看[codeplex 上的源代码](http://www.codeplex.com/blogsvc/SourceControl/changeset/view/31628#392049)。

        spring - 春天
标签

ID：332612

赞同：5

时间：2008-12-01T23:43:17.077

标签：spring

我有

```
 <bean id="dao" class="......"> 
      <property name="foo">
         <props>
           <prop key="me">Homer</prop>
         <props>
       <property>
   </bean> 
```

我想使用我当前的属性文件，名称-值对来更改“Homer”，我无法弄清楚......

            回答 #1

赞同：7

时间：2008-12-02T04:45:33.673

使用 PropertyPlaceholderConfigurer bean。这里的例子：

[http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-placeholderconfigurer](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-factory-placeholderconfigurer)

        language-agnostic - gartrip 校准文件格式/生成

ID：332614

赞同：0

时间：2008-12-01T23:44:43.907

标签：language-agnostic

我需要为[Gartrip](http://www.gartrip.com/)程序生成校准文件*。有谁知道我在哪里可以找到它使用的文件格式，或者更好的是，生成它们的代码？

我不会对语言挑剔。

如果没有人指出我更好的地方，我正在努力获取一些示例以进行逆向工程。应该不会太糟糕，因为我有理由期望它们是文本。

编辑：

我需要能够生成的是需要告诉 gartrip 的文件：“对于文件*xyz.jpg*，点*A*在位置*B*，点*C*在位置*D* ”

*校准文件告诉gartrip如何使用图像文件作为背景，以便可以在其上覆盖轨道和其他东西

            回答 #1

赞同：0

时间：2011-12-10T06:47:19.860

[我已经在您的博客](http://arrayboundserror.blogspot.com/search?q=gartrip)中搜索了与[Gartrip](http://www.gartrip.com/)相关的条目，但没有成功。

一种可能性是对校准文件的格式进行逆向工程，并根据提取的知识编写实用程序。

Gartrip 似乎是一个专有软件，所以作为注册用户，您有权这样做吗？

我唯一确定的是它的作者没有透露任何文件格式。

        solr - Xapian 的爬虫/解析器

ID：332623

赞同：2

时间：2008-12-01T23:52:05.357

标签：solr, web-crawler, xapian

我想实现一个搜索引擎，它应该抓取一组网站，从页面中提取特定信息并创建该特定信息的全文索引。

在我看来，Xapian 可能是搜索引擎库的不错选择。

爬虫/解析器与 Xapian 集成的选项有哪些？

在与开源爬虫/解析器集成时，Solr 会比 Xapian 更好吗？

            回答 #1

赞同：2

时间：2008-12-19T01:29:19.083

[这是](http://michaelkimsal.com/blog/solr-adoption-power-of-sane-defaults/#comment-32560)Xapian 和 Solr 之间的一个小比较。

但是如果你想构建一个爬虫，看看[Nutch](http://lucene.apache.org/nutch/)。它[可以通过 plugins 进行扩展](http://wiki.apache.org/nutch/PluginCentral)，因此您可以编写一个插件来分析您正在寻找的信息。

            回答 #2

赞同：2

时间：2009-04-20T21:33:02.403

[亚麻](http://www.flax.co.uk/)可能会提供您正在寻找的一些东西。

        linux - rm 没有释放磁盘空间

ID：332629

赞同：45

时间：2008-12-01T23:54:55.727

标签：linux, tomcat, logging

我已经`rm`编辑了一个 2.5gb 的日志文件——但它似乎没有释放任何空间。

我做了：

```
rm /opt/tomcat/logs/catalina.out 
```

那么这个：

```
df -hT 
```

并`df`报告我的`/opt`坐骑仍然 100% 使用。

有什么建议么？

            回答 #1

赞同：69

时间：2008-12-01T23:56:31.183

重新启动tomcat，如果文件正在使用并且您将其删除，则该过程完成后空间变为可用。

            回答 #2

赞同：23

时间：2008-12-02T00:23:00.787

正如其他人所建议的那样，该文件可能仍被其他进程打开。要找出哪些，你可以做

```
lsof /opt/tomcat/logs/catalina.out 
```

其中列出了您的流程。可能您会在该列表中找到 tomcat。

            回答 #3

赞同：10

时间：2008-12-02T00:05:20.387

你的问题：
可能正在运行的程序仍在保留该文件。
您的解决方案：
根据此处的其他答案，您可以简单地关闭 tomcat 以阻止它保留文件。
如果这不是一个选项，或者如果您只是想要更多详细信息，请查看以下问题：[查找并删除已打开但已删除的大文件](https://unix.stackexchange.com/questions/68523/find-and-remove-large-files-that-are-open-but-have-been-deleted)- 它建议了一些更严厉的处理方法，这些方法可能对您的情况更有用.

更多细节：
linux/unix 文件系统认为“打开的”文件是它们的另一个名称。rm 从目录树中看到的文件中删除“名称”。在句柄关闭之前，文件仍然有更多“名称”，因此文件仍然存在。在文件完全未命名之前，文件系统不会获取文件。
这可能看起来有点奇怪，但这样做可以实现一些有用的东西，比如启用符号链接。符号链接本质上可以被视为同一文件的备用名称。
**这就是为什么在完成后始终**在文件句柄上调用与 close() 等效的语言很重要的原因。这会通知操作系统该文件不再被使用。*尽管有时这无济于事——Tomcat*可能就是这种情况。请参阅[Bill Karwin 的回答](https://stackoverflow.com/a/332657/42082)以了解原因。
根据文件系统，这通常实现为一种引用计数，因此可能不涉及任何真实名称。如果像 stdin 和 stderr 这样的东西被重定向到一个文件或另一个字节流（最常见的是通过服务完成），它也会变得很奇怪。
[这整个想法与“ inode](http://en.wikipedia.org/wiki/Inode) ”的概念密切相关，所以如果你是好奇的类型，我建议你先检查一下。
讨论
它不再那么好用了，但是你曾经能够更新整个操作系统，使用新库启动一个新的 http-daemon，最后在没有更多客户端使用它时关闭旧的（释放旧手柄）。http 客户端甚至不会错过任何一个节拍。
基本上，您可以完全清除内核和所有“从底层”运行程序的库。但是由于旧副本的“名称”仍然存在，因此该文件仍然存在于该特定程序的内存/磁盘中。然后就是重新启动所有服务等问题。虽然这是一个高级使用场景，但它是某些 unix 系统有多年正常运行时间记录的原因。

            回答 #4

赞同：9

时间：2008-12-02T01:37:56.173

重新启动 Tomcat 将释放 Tomcat 对该文件的任何保留。但是，为了避免重新启动 Tomcat（例如，如果这是一个生产环境并且您不想不必要地关闭服务），您通常可以覆盖该文件：

```
cp /dev/null /opt/tomcat/logs/catalina.out 
```

甚至更短更直接：

```
> /opt/tomcat/logs/catalina.out 
```

在故障排除或磁盘清理过程中，我一直使用这些方法来清除当前正在运行的服务器进程的日志文件。这会单独留下 inode，但会清除实际的文件数据，而尝试删除文件通常要么不起作用，要么至少会混淆正在运行的进程的日志写入器。

            回答 #5

赞同：6

时间：2008-12-02T00:09:12.343

正如 FerranB 和 Paul Tomblin 在此线程中所指出的，该文件正在使用中，并且在文件关闭之前不会释放磁盘空间。

问题是您无法向 Catalina 进程发出关闭信号`catalina.out`，因为文件句柄不受 java 进程的控制。`catalina.sh`它是在您启动 Tomcat 时通过 shell I/O 重定向打开的。只有终止 Catalina 进程才能关闭该文件句柄。

将来有两种解决方案可以防止这种情况发生：

*   不允许 Tomcat 应用程序的输出进入`catalina.out`. 而是使用该`swallowOutput`属性，并为输出配置日志通道。由 log4j 管理的日志可以在不重新启动 Catalina 进程的情况下进行轮换。

*   修改 catalina.sh 以管道输出到[cronolog](http://www.cronolog.org)而不是简单地重定向到`catalina.out`. 这样 cronolog 将为您轮换日志。

            回答 #6

赞同：6

时间：2014-01-22T01:37:44.340

最好的解决方案是使用'echo'（作为@ejoncas'的建议）：

```
$ echo '' > huge_file.log 
```

此操作非常安全且快速（每秒删除约 1G 数据），尤其是在您的生产服务器上操作时。
不要简单地使用“rm”删除这个文件，因为首先你必须停止写入它的进程，否则磁盘将不会被释放。
参考：[http ://siwei.me/blog/posts/how-to-deal-with-huge-log-file-in-production](http://siwei.me/blog/posts/how-to-deal-with-huge-log-file-in-production)
更新：我的故事的由来
2013年在优酷工作的时候，周六发现一台核心服务器宕机，原因是：磁盘满（有日志文件）
所以我简单`rm log_file.log`地（没有停止网络应用程序进程）但发现：1.没有释放磁盘空间并且：2.我实际上没有看到日志文件。
所以我必须重新启动我的网络服务器（一个 Rails 应用程序），磁盘空间终于被释放了。
这对我来说是非常重要的一课。它告诉我，`echo '' > log_file.log`如果您不想停止正在将日志写入此文件的正在运行的进程，那么这是释放磁盘空间的正确方法。

            回答 #7

赞同：3

时间：2008-12-01T23:56:57.860

如果某些东西仍然打开，则该文件实际上不会消失。您可能需要以某种方式向 catalina 发出信号以关闭并重新打开其日志文件。

            回答 #8

赞同：3

时间：2008-12-02T00:02:44.180

如果该文件有第二个硬链接，则在将其删除之前不会将其删除。

            回答 #9

赞同：2

时间：2018-02-23T10:01:05.993

输入命令查看哪些已删除文件占用了内存

```
 $ sudo lsof | grep deleted 
```

它将显示仍保留内存的已删除文件。

然后用 pid 或 name 杀死进程

```
$ sudo kill <pid>
$ df -h 
```

现在检查你将有相同的记忆

**如果没有，请键入下面的命令查看哪个文件占用了内存**

```
# cd /
# du --threshold=(SIZE) 
```

提及任何大小，它将显示哪些文件占用超过阈值大小并删除文件  

            回答 #10

赞同：-2

时间：2008-12-01T23:56:32.790

rm 是否已记录/计划？尝试使用“同步”命令强制写入。

        c# - “原子地”更改 System.Threading.Timer

ID：332630

赞同：7

时间：2008-12-01T23:55:21.373

标签：c#, .net

假设我有一个现有的 System.Threading.Timer 实例，我想在它上面调用 Change 来推迟它的触发时间：

```
var timer = new Timer(DelayCallback, null, 10000, Timeout.Infinite);
// ... (sometime later but before DelayCallback has executed)
timer.Change(20000, Timeout.Infinite); 
```

我正在使用此计时器在一段时间没有活动后执行“空闲回调”。（在这种情况下，“空闲”和“无活动”是应用程序定义的条件......细节并不是非常重要。）每次我执行“动作”时，我都想重置计时器以使其始终设置10 秒后开火。

但是，存在固有的竞争条件，因为当我调用 Change 时，我无法判断 Timer 是否已经根据其旧设置触发。（当然，我可以判断我的回调是否发生，但我无法判断 CLR 的内部计时器线程是否已将我的回调排队到线程池并且它的执行即将执行。）

现在我知道我可以在计时器实例上调用 Dispose 并在每次需要“推回”时重新创建它。但这*似乎*不如仅更改现有计时器有效。当然*可能*不是……我稍后会运行一些微基准测试并让大家知道。

或者，我可以始终跟踪预期的触发时间（通过 DateTime.Now.AddSeconds(10)），如果原始 Timer 触发，则通过在回调中检查 DateTime.Now 来忽略它。（我担心这可能不是 100% 可靠，因为使用 TimeSpan 的计时器和使用 DateTime 的检查......这可能不是问题，但由于某种原因我并不完全满意...... )

我的问题是：

1.  有没有一种好方法可以让我调用 Timer.Change 并能够知道在回调排队到线程池之前我是否设法更改它？（我不这么认为，但问也无妨……）
2.  有没有其他人实施过（我称之为）这样的“推回计时器”？如果是这样，我很想听听你是如何解决这个问题的。

这个问题本质上是假设性的，因为我已经有几个可行的解决方案（基于 Dispose 和基于 DateTime.Now）......我主要对听到与性能相关的建议感兴趣（因为我将“推回“计时器非常频繁）。

谢谢！

            回答 #1

赞同：1

时间：2008-12-03T00:13:15.547

我将您的问题解释为对实现下面指定的 IdleNotifier 接口的请求。您还声明 ActionOccured() 需要快速。

```
public delegate void IdleCallback();
public interface IdleNotifier
{
    // Called by threadpool when more than IdleTimeSpanBeforeCallback 
    // has passed since last call on ActionOccured.
    IdleCallback Callback { set; }
    TimeSpan IdleTimeSpanBeforeCallback { set; }
    void ActionOccured();
} 
```

我在下面提供了一个带有 System.Threading.Timer 的实现。关于实施的要点：

*   我们接受计时器可以随时唤醒并确保这没问题。
*   由于我们假设计时器相对很少唤醒，因此我们可以在这些时间做昂贵的工作。
*   由于我们可以在计时器回调中执行所有逻辑，因此“推送计时器”所需要做的就是记住我们上次推送它的时间。

执行：

```
public class IdleNotifierTimerImplementation : IdleNotifier
{
    private readonly object SyncRoot = new object();
    private readonly Timer m_Timer;

    private IdleCallback m_IdleCallback = null;
    private TimeSpan m_IdleTimeSpanBeforeEvent = TimeSpan.Zero;

    // Null means there has been no action since last idle notification.
    private DateTime? m_LastActionTime = null;

    public IdleNotifierTimerImplementation()
    {
        m_Timer = new Timer(OnTimer);
    }

    private void OnTimer(object unusedState)
    {
        lock (SyncRoot)
        {
            if (m_LastActionTime == null)
            {
                m_Timer.Change(m_IdleTimeSpanBeforeEvent, TimeSpan.Zero);
                return;
            }
            TimeSpan timeSinceLastUpdate = DateTime.UtcNow - m_LastActionTime.Value;
            if (timeSinceLastUpdate > TimeSpan.Zero)
            {
                // We are no idle yet.
                m_Timer.Change(timeSinceLastUpdate, TimeSpan.Zero);
                return;
            }
            m_LastActionTime = null;
            m_Timer.Change(m_IdleTimeSpanBeforeEvent, TimeSpan.Zero);
        }
        if (m_IdleCallback != null)
        {
            m_IdleCallback();
        }
    }

    // IdleNotifier implementation below

    public void ActionOccured()
    {
        lock (SyncRoot)
        {
            m_LastActionTime = DateTime.UtcNow;
        }
    }

    public IdleCallback Callback
    {
        set
        {
            lock (SyncRoot)
            {
                m_IdleCallback = value;
            }
        }
    }

    public TimeSpan IdleTimeSpanBeforeCallback
    {
        set
        {
            lock (SyncRoot)
            {
                m_IdleTimeSpanBeforeEvent = value;
                // Run OnTimer immediately
                m_Timer.Change(TimeSpan.Zero, TimeSpan.Zero);
            }
        }
    }
} 
```

此代码有许多直接的性能改进。

如果有人对我对此的第一个想法感兴趣，请问我。

            回答 #2

赞同：1

时间：2008-12-02T01:37:13.960

听起来您真正想要的是应用程序空闲事件

```
System.Windows.Forms.Application.Idle 
```

            回答 #3

赞同：0

时间：2008-12-02T00:24:11.843

实际上，我必须为自己制作的 MMORPG 构建自己的“时间”类。它可以跟踪超过 100,000 个具有处理 AI 和其他任务的计时器的“实体”。根据可以采取的不同行动，我将不得不暂时延迟一个事件。

现在，我的计时课完全是手写的，所以它不会是你想要的。但是你可以做的事情类似于我想出的解决方案是做一种：

```
while (sleepyTime > 0)
{
    int temp = sleepyTime;
    sleepyTime = 0;
    Thread.Sleep(temp);
}

// here's where your actual code is. 
```

然后，您可以制作一个基本上只是向 sleepyTime 投放广告的“延迟”方法。

        c - 在哪里可以找到使用 zlib 的示例解压缩程序？

ID：332645

赞同：0

时间：2008-12-02T00:00:51.673

标签：c, zip, zlib

我正在寻找一个简单的示例 C 应用程序，用于使用 zlib 解压缩 zip 文件。它必须支持相当新版本的 .zip 并且必须有源代码到 zlib 调用。

            回答 #1

赞同：4

时间：2008-12-02T00:14:35.733

我的系统（linux）上的 zlib-bin 源代码包有一些名为“minizip”和“miniunzip”的示例程序，它们就说明了这一点。

            回答 #2

赞同：0

时间：2008-12-02T14:18:00.930

zlib.net 网站上的 zpipe.c 示例非常简单[。](http://www.zlib.net/zpipe.c "zpipe.c")它的作用也有一个很好的[描述](http://www.zlib.net/zlib_how.html "描述")。

        windows - 一旦通过电源设置关闭，如何唤醒我的 Windows 显示器？

ID：332649

赞同：3

时间：2008-12-02T00:03:05.087

标签：windows, monitor

所以我的 Vista 机器设置为在 10 分钟后关闭它的显示器。（注意：机器没有暂停，或休眠）

我有一个 .Net 应用程序正在运行，它需要在指定时间“唤醒”系统。作为人类，您只需移动鼠标或按一个键。我如何以编程方式执行此操作？

我试过：以编程方式设置光标；使用“发送密钥”；甚至调用 CreateWaitableTimer 来取消挂起（即使它没有挂起），希望这会触发一些事情。

理想情况下，c# 中的代码会很棒，但正确的 Win API 就足够了。

提前谢谢了。

            回答 #1

赞同：3

时间：2008-12-02T01:05:28.297

您应该能够通过发送系统命令消息来控制显示器电源，如下所示。请注意，这是在 XP 上测试的，Vista 可能会有所改变，因此您需要对其进行测试并告知我们。

此代码在 VB 中，但您可以看到它使用的 Win32 API 调用。您需要将窗口句柄传递给函数，因此您的代码将需要创建一个窗口来处理消息（只需将其传递给默认窗口处理函数）。

```
Const SC_MONITORPOWER As Integer = &HF170
Const WM_SYSCOMMAND As Short = &H112S
Private Function SendMessage(
    ByVal Handle As Int32,
    ByVal wMsg As Int32,
    ByVal wParam As Int32,
    ByVal lParam As Int32) As Int32
End Function
Sub MonStandBy(hWnd as Int32)
    SendMessage(hWnd, WM_SYSCOMMAND, SC_MONITORPOWER, 1)
End Sub
Sub MonOff(hWnd as Int32)
    SendMessage(hWnd, WM_SYSCOMMAND, SC_MONITORPOWER, 2)
End Sub
Sub MonOn(hWnd as Int32)
    SendMessage(hWnd, WM_SYSCOMMAND, SC_MONITORPOWER, -1)
End Sub 
```

        windows - 仅在单个端口 8080 上转发到本地主机（Windows）可能吗？

ID：332651

赞同：5

时间：2008-12-02T00:04:49.637

标签：windows, portforwarding, hosts

我知道如何在 windows 上使用 xampp 设置本地网络服务器...我在主机文件 (c:\windows\system32\drivers\etc\hosts) 上输入我的别名和目标，然后在我的 apache vhosts 上添加相应的条目配置文件。这样，假设我的网络服务器正在监听端口 80，我可以例如映射`example.com`到我的本地网络服务器。

我总是在我的主机文件中输入整个域名（例如 example.com），并且对该名称的任何请求都将被定向到 localhost。

现在我想知道是否有一种方法可以**仅将某个端口**（例如仅 example.com:8080）上的 example.com 转发到本地网络服务器，而将 example.com（默认端口 80）单独保留，以便它仍然会去我的现场制作网站。

据我了解，仅使用主机文件可能无法做到这一点（我尝试将端口 :8080 添加到我的域名中-似乎不起作用；-)）...

我对这个主题真的不太了解，所以欢迎任何想法、见解、链接、阅读材料、工具。

编辑：Arnout 的回复回答了我上面提出的问题，但没有解决我的实际问题。将 example.com:8080 重新路由到 localhost:80 确实有效，如果我访问 example.com，它会加载我本地版本的首页，但该页面上的所有链接当然不知道端口号，因此指向生产版本......我的问题的实际解决方案似乎是咬住酸苹果并*修复*我的应用程序（按照 Rob 的建议）并删除所有硬编码的 url，以便它适用于任何域......

            回答 #1

赞同：4

时间：2008-12-02T10:21:43.870

Internet Junkbuster（代理服务器）可以使用其[转发](http://www.junkbuster.com/ijbman.html#o_f)功能来做到这一点。

只需添加一行

```
example.com:8080   localhost:80   .   . 
```

到`sforward.ini`，并取消注释 中的`forwardfile`行`junkbstr.ini`。现在将您的浏览器配置为使用在 localhost 的 8000 端口上运行的代理服务器，然后您就设置好了。

我确信其他代理服务器也有类似的功能——我只是喜欢 Junkbuster，因为它是一个简单的独立可执行文件。

            回答 #2

赞同：2

时间：2008-12-02T00:42:21.277

您正在玩域名服务 (DNS) 领域。从技术上讲，使用高级 DNS 配置（可以包括重新映射端口），您的建议是可能的，并且在 Internet 上常规完成。但是，您不太可能想在当地花费那么多的麻烦和费用。

另一方面，我怀疑您的真正问题可以更容易地解决。为什么要将“example.com”解析到本地 Web 服务器？您已经可以将本地 Web 服务器引用为“localhost”、“127.0.0.1”，并通过其分配的机器名称“workstation-x”。

我能想到并且我已经看到，想要引用与生产 Web 服务器具有相同主机名的本地 Web 服务器的唯一原因是由于将服务器主机名硬编码到应用程序 Web 中的链接中页。如果是这种情况，答案很简单：不要！您应该始终实现您的 Web 应用程序，以便它们引用与已部署服务器相关的所有内容（其他页面、CSS、JS、图像等）。如果您跨多个服务器部署，那么您的引用必须是基于可配置服务器主机名的绝对引用。这很容易做到，没有理由不去做。

如果不是这种情况，那么请解释您想要实现的目标以及您尝试的动机。

编辑：既然您已经确认我的猜测是问题是网页中对生产主机名的硬编码引用，让我简单地补充一下，我总是无一例外地发现解决真正的问题比解决实际问题更便宜积累解决方法（例如您尝试重新映射端口）。我从未遇到过持相反观点的作者。

修复页面应该比全局搜索和替换更难，尤其是使用一个体面的文本编辑器。即使编写一个简单的脚本来更改源文件也比您尝试解决方法要便宜得多，也容易得多。

无论如何，向您致以最良好的祝愿，让我们知道结果如何。

            回答 #3

赞同：0

时间：2009-09-16T09:24:57.080

您能否确认 8080 端口是否正在侦听网络服务器？使用命令“netstat -na”查看8080端口是否在监听。

您是否在 apache 配置文件中添加了与默认 80 端口相同的 8080 端口？

一旦您在 apache 配置文件中添加端口 8080 以使其侦听并仔细检查 8080 端口是否正在侦听网络服务器，那么您将能够使用端口 8080 访问页面。例如[http://mytestwebserver:8080/index.html](http://mytestwebserver:8080/index.html)或像这样的东西......

        c# - 从 C# 连接到数字秤

ID：332653

赞同：4

时间：2008-12-02T00:05:49.057

标签：c#, usb

我试图找出一种从 C# 代码连接到数字刻度的方法。特殊的秤是带有 USB 连接的 Ohaus SP202 数字秤。我想以编程方式读取秤上测量的重量。我还没有规模，我只是在做手头的研究。

有没有人这样做过？我一直在互联网上进行研究，并没有发现任何值得一提的东西。

            回答 #1

赞同：6

时间：2008-12-02T01:40:29.803

USB 硬件通信通常采用以下三种方式之一。

1.  专有软件通过专有驱动程序与硬件对话。

2.  设备具有串行仿真芯片（例如[FTDI](http://www.ftdichip.com/FTProducts.htm#FT232R)） 当您插入电子秤时，您只需要安装虚拟通信端口驱动程序，设备就会在您的系统上显示为一个通信端口。然后就像使用 System.IO.Ports.SerialPort 与设备对话一样简单。

3.  该设备实施 HID 配置文件，可通过您操作系统的 HID 系统使用。我在 Windows 上使用[了这个 .NET HID](http://www.lvr.com/hidpage.htm)库来成功地与实现 HID 的条形码扫描仪进行对话。HID 库将根据您正在与之交谈的硬件以块的形式从硬件向您发送数据。

使用方法 2 和 3，您只需要找到您正在与之交谈的比例的数据格式。我使用的秤每秒左右发送一次更新，其中包含硬件 UI 上显示的重量和其他信息，例如负载是否稳定。

查看他们的讨论论坛，看起来他们的秤使用方法 2 ([http://ohaus.com/support/forum_messages.asp?topicid=584](http://ohaus.com/support/forum_messages.asp?topicid=584)）并且您需要通过发送“P\r\n”来轮询秤，然后它将以显示屏上显示的字符进行响应（[http://ohaus.com/support/forum_messages.asp?topicid=802](http://ohaus.com/support/forum_messages.asp?topicid=802)）。

            回答 #2

赞同：1

时间：2008-12-02T00:19:13.227

我没有使用过那个特定的秤，但我之前已经连接到其他数字秤。基本上它通常只是通过 USB 到 Com 转换器进行串行通信。

如果秤有一个 API 就更好了，但如果没有，那么您将只使用 System.IO.Ports.SerialPort 这是非常标准的串行编程。[这里有一篇入门文章](http://www.codeproject.com/KB/cs/serialcommunication.aspx?fid=119621&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=176&select=1065635)

            回答 #3

赞同：0

时间：2008-12-02T01:35:52.823

我不知道这个规模的任何细节，但我做过一些 USB 的东西。

它最有可能使用usb中断来传输数据。所有的usb鼠标也都使用中断，所以如果你能弄清楚如何读取鼠标信号（使用HID api），那么它应该与规模完全相同，只是返回的数据格式会完全不同。

在ftw上运行

            回答 #4

赞同：0

时间：2021-02-16T09:58:14.637

Scales 是我必须从中读取数据的第一批设备之一。那时，它只是一个串口，我猜你仍然可以使用[SerialPort.Net](https://github.com/MelbourneDeveloper/Device.Net)从串口读取。
这是 Windows 上的串行端口传输代码
[参考](https://github.com/MelbourneDeveloper/Device.Net/blob/90aa91e584ec2f7e25002c157ad6bd42e87aa618/src/SerialPort.Net/Windows/WindowsSerialPortDevice.cs#L1)

```
using Device.Net;
using Device.Net.Windows;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.Logging.Abstractions;
using Microsoft.Win32.SafeHandles;
using System;
using System.IO;
using System.Threading;
using System.Threading.Tasks;

namespace SerialPort.Net.Windows
{
    public class WindowsSerialPortDevice : DeviceBase, IDevice
    {
        #region Fields
        private readonly int _BaudRate;
        private readonly byte _ByteSize;
        private bool disposed;
        private readonly Parity _Parity;
        private SafeFileHandle _ReadSafeFileHandle;
        private readonly StopBits _StopBits;
        private ushort ReadBufferSize { get; }
        #endregion

        #region Public Properties
        public bool IsInitialized => _ReadSafeFileHandle != null && !_ReadSafeFileHandle.IsInvalid;
        /// <summary>
        /// TODO: No need to implement this. The property probably shouldn't exist at the base level
        /// </summary>
        public IApiService ApiService { get; }
        public ConnectedDeviceDefinition ConnectedDeviceDefinition { get; private set; }
        #endregion

        #region Constructor
        public WindowsSerialPortDevice(
            string deviceId,
            int baudRate = 9600,
            StopBits stopBits = StopBits.One,
            Parity parity = Parity.None,
            byte byteSize = 8,
            ushort readBufferSize = 1024,
            ILoggerFactory loggerFactory = null,
            IApiService apiService = null) : base(
                deviceId,
                loggerFactory,
                (loggerFactory ?? NullLoggerFactory.Instance).CreateLogger<WindowsSerialPortDevice>())
        {
            ApiService = apiService ?? new ApiService(null);

            ConnectedDeviceDefinition = new ConnectedDeviceDefinition(DeviceId, DeviceType.SerialPort);

            if ((byteSize == 5 && stopBits == StopBits.Two) || (stopBits == StopBits.OnePointFive && byteSize > 5))
                throw new ArgumentException(Messages.ErrorInvalidByteSizeAndStopBitsCombo);

            if (byteSize is < 5 or > 8)
                throw new ArgumentOutOfRangeException(nameof(byteSize), Messages.ErrorByteSizeMustBeFiveToEight);

            if (baudRate is < 110 or > 256000)
                throw new ArgumentOutOfRangeException(nameof(baudRate), Messages.ErrorBaudRateInvalid);

            if (stopBits == StopBits.None)
                throw new ArgumentException(Messages.ErrorMessageStopBitsMustBeSpecified, nameof(stopBits));

            ReadBufferSize = readBufferSize;
            _BaudRate = baudRate;
            _ByteSize = byteSize;
            _StopBits = stopBits;
            _Parity = parity;
        }
        #endregion

        #region Public Methods
        public Task InitializeAsync(CancellationToken cancellationToken = default) => Task.Run(Initialize, cancellationToken);

        private uint Write(byte[] data) => data == null ? 0 : ApiService.AWriteFile(_ReadSafeFileHandle, data, data.Length, out var bytesWritten, 0) ? (uint)bytesWritten : 0;

        public override Task<uint> WriteAsync(byte[] data, CancellationToken cancellationToken = default)
        {
            ValidateConnection();
            return Task.Run(() =>
            {
                var bytesWritten = Write(data);
                Logger.LogDataTransfer(new Trace(false, data));
                return bytesWritten;
            }, cancellationToken);
        }

        public override Task<TransferResult> ReadAsync(CancellationToken cancellationToken = default)
        {
            ValidateConnection();

            return Task.Run(() =>
            {
                var buffer = new byte[ReadBufferSize];
                var bytesRead = Read(buffer);
                var transferResult = new TransferResult(buffer, bytesRead);
                Logger.LogDataTransfer(new Trace(false, transferResult));
                return transferResult;
            }, cancellationToken);
        }

        public override Task Flush(CancellationToken cancellationToken = default)
        {
            ValidateConnection();

            return Task.Run(() => ApiService.APurgeComm(_ReadSafeFileHandle, APICalls.PURGE_RXCLEAR | APICalls.PURGE_TXCLEAR),
                cancellationToken);
        }

        public override void Dispose()
        {
            if (disposed)
            {
                Logger.LogWarning(Messages.WarningMessageAlreadyDisposed, DeviceId);
                return;
            }

            disposed = true;

            Logger.LogInformation(Messages.InformationMessageDisposingDevice, DeviceId);

            if (_ReadSafeFileHandle != null)
            {
                _ReadSafeFileHandle.Dispose();
                _ReadSafeFileHandle = new SafeFileHandle((IntPtr)0, true);
            }

            base.Dispose();
        }

        public void Close() => Dispose();
        #endregion

        #region Private Methods
        private void Initialize()
        {
            _ReadSafeFileHandle = ApiService.CreateReadConnection(DeviceId, FileAccessRights.GenericRead | FileAccessRights.GenericWrite);

            if (_ReadSafeFileHandle.IsInvalid) return;

            var dcb = new Dcb();

            var isSuccess = ApiService.AGetCommState(_ReadSafeFileHandle, ref dcb);

            _ = WindowsHelpers.HandleError(isSuccess, Messages.ErrorCouldNotGetCommState, Logger);

            dcb.ByteSize = _ByteSize;
            dcb.fDtrControl = 1;
            dcb.BaudRate = (uint)_BaudRate;
            dcb.fBinary = 1;
            dcb.fTXContinueOnXoff = 0;
            dcb.fAbortOnError = 0;

            dcb.fParity = 1;
#pragma warning disable IDE0010 // Add missing cases
            dcb.Parity = _Parity switch
            {
                Parity.Even => 2,
                Parity.Mark => 3,
                Parity.Odd => 1,
                Parity.Space => 4,
                Parity.None => 0,
                _ => 0
            };

            dcb.StopBits = _StopBits switch
            {
                StopBits.One => 0,
                StopBits.OnePointFive => 1,
                StopBits.Two => 2,
                StopBits.None => throw new ArgumentException(Messages.ErrorMessageStopBitsMustBeSpecified),
                _ => throw new ArgumentException(Messages.ErrorMessageStopBitsMustBeSpecified),
            };
#pragma warning restore IDE0010 // Add missing cases

            isSuccess = ApiService.ASetCommState(_ReadSafeFileHandle, ref dcb);
            _ = WindowsHelpers.HandleError(isSuccess, Messages.ErrorCouldNotSetCommState, Logger);

            var timeouts = new CommTimeouts
            {
                WriteTotalTimeoutConstant = 0,
                ReadIntervalTimeout = 1,
                WriteTotalTimeoutMultiplier = 0,
                ReadTotalTimeoutMultiplier = 0,
                ReadTotalTimeoutConstant = 0
            };

            isSuccess = ApiService.ASetCommTimeouts(_ReadSafeFileHandle, ref timeouts);
            _ = WindowsHelpers.HandleError(isSuccess, Messages.ErrorCouldNotSetCommTimeout, Logger);

            Logger.LogInformation("Serial Port device initialized successfully. Port: {port}", DeviceId);
        }

        private uint Read(byte[] data)
        =>
             ApiService.AReadFile(_ReadSafeFileHandle, data, data.Length, out var bytesRead, 0)
                ? bytesRead
                : throw new IOException(Messages.ErrorMessageRead);

        private void ValidateConnection()
        {
            if (!IsInitialized)
            {
                throw new InvalidOperationException(Messages.ErrorMessageNotInitialized);
            }
        }
        #endregion
    }
} 
```

        class-design - 代码中的“设计的理想特征”完成

ID：332664

赞同：3

时间：2008-12-02T00:15:19.243

标签：class-design

以下是对我来说似乎含糊不清的几点：

“High-Fan in”：有大量使用给定类的类；在较低级别很好地使用实用程序类。

“低扇出”：不要在给定类中使用太多其他类。

这是否意味着您甚至不能让一个给定的类使用几个小的实用程序类？

            回答 #1

赞同：3

时间：2008-12-02T00:25:55.740

首先，这不是能不能不能的问题——这是一个指导方针，而不是规则。这意味着如果你有一个类使用了很多其他类，这*可能*意味着它试图做太多事情，其中​​一些可以被提取到一个单独的类中。

最后，问题的领域将决定设计是否良好，并且在某些情况下可能需要中高扇出。

        sql - 桌子在使用吗？

ID：332668

赞同：1

时间：2008-12-02T00:18:58.860

标签：sql

如何确定表是否在 SQL 中使用（在任何类型的数据库上）？如果有人已经在使用它，或者让它“打开”，那么它就在使用中。

            回答 #1

赞同：4

时间：2008-12-02T01:39:17.263

一般来说，找出其他人是否正在使用该表并阻止您做任何您想做的事情的正确方法是尝试做您想做的事情并检查它是否失败。如果失败消息指示“非独占访问”或“正在使用的表”或等效项，那么您猜错了。

如果您的 DBMS 支持表锁定，您可以对表应用锁定，然后执行一系列操作 - 但您会妨碍其他可能尝试使用它的人。

请注意，检查锁定表（例如 syslockinfo）既是 DBMS 特定的，也是不可靠的——它会导致 TOCTOU（检查时间，使用时间）问题。

            回答 #2

赞同：2

时间：2008-12-02T00:20:41.493

检查桌子上的锁是否打开。

查看 syslockinfo 表。

            回答 #3

赞同：0

时间：2008-12-04T20:08:46.850

实际上这会给你一个更好的结果：

```
select spid
    from master..sysprocesses
    where dbid = db_id('Works') and spid <> @@spid 
```

        .net - simple linq to sql 不支持对 SQL 的转换

ID：332670

赞同：23

时间：2008-12-02T00:20:20.683

标签：.net, linq-to-sql, c#-3.0

我的 BlogRepository 中有这个

```
public IQueryable<Subnus.MVC.Data.Model.Post> GetPosts()
    {
        var query = from p in db.Posts
                    let categories = GetCategoriesByPostId(p.PostId)
                    let comments = GetCommentsByPostId(p.PostId)
                    select new Subnus.MVC.Data.Model.Post
                    {
                        Categories = new LazyList<Category>(categories),
                        Comments = new LazyList<Comment>(comments),
                        PostId = p.PostId,
                        Slug = p.Slug,
                        Title = p.Title,
                        CreatedBy = p.CreatedBy,
                        CreatedOn = p.CreatedOn,
                        Body = p.Body
                    };
        return query;
    } 
```

和

```
public IQueryable<Subnus.MVC.Data.Model.Comment> GetCommentsByPostId(int postId)
    {
        var query = from c in db.Comments
                    where c.PostId == postId
                    select new Subnus.MVC.Data.Model.Comment
                    {
                        Body = c.Body,
                        EMail = c.EMail,
                        Date = c.CreatedOn,
                        WebSite = c.Website,
                        Name = c.Name
                    };

        return query;
    }

private IQueryable<Subnus.MVC.Data.Model.Category> GetCategoriesByPostId(int postId)
    {
        var query = from c in db.Categories
                    join pcm in db.Post_Category_Maps on c.CategoryId equals pcm.CategoryId
                    where pcm.PostId == postId
                    select new Subnus.MVC.Data.Model.Category
                    {
                        CategoryId = c.CategoryId,
                        Name = c.Name
                    };
        return query;
    } 
```

当我应用这个过滤器时  

```
namespace Subnus.MVC.Data
{
 public static class BlogFilters
 {
    public static IQueryable<Post> WherePublicIs(this IQueryable<Post> qry,bool state)
    {

        return from p in qry
               where p.IsPublic == state
               select p;
    }
 } 
```

}

如果帮助命名空间 Subnus.MVC.Data，所有这些都在同一个命名空间中

当我尝试这样做时  

```
public class BlogService : IBlogService
{
...
    public IList<Post> GetPublicPosts()
    {
         return repository.GetPosts().WherePublicIs(true).ToList();
    }
 ...
 } 
```

即在命名空间 Subnus.MVC.Service 中它会引发错误  

```
Method 'System.Linq.IQueryable`1[Subnus.MVC.Data.Model.Comment] GetCommentsByPostId(Int32)' has no supported translation to SQL. 
```

            回答 #1

赞同：26

时间：2008-12-02T01:09:07.260

`GetCommentsByPostId`你在最终是一个表达式树中调用。该树在 中组成时`BlogService.GetPublicPosts`，将转换为 SQL。

在该转换期间，它只是一个方法调用，仅此而已。Linq to Sql 了解某些方法调用，而您的方法调用不是其中之一。因此错误。

从表面上看，这似乎应该奏效。您编写可重用的查询并从其他查询中组合它们。但是，您实际上是在说：“在数据库服务器上处理每一行的过程中，调用此方法”，这显然是做不到的。它接受一个`IQueryable<T>`并返回一个的事实`IQueryable<T>`并没有使它特别。

这样想：你正在传递`postId`给`GetCategoriesByPostId`. 在您拥有 之前，您无法调用该方法`postId`，并且在您位于查询中的服务器上之前，您没有其中之一。

您可能需要`Expression<>`为子查询定义公共实例并在组合中使用这些实例。我没有想过这会是什么样子，但它肯定是可行的。

**编辑：**

如果你更换

```
let categories = GetCategoriesByPostId(p.PostId)
let comments = GetCommentsByPostId(p.PostId)
...
Categories = new LazyList<Category>(categories),
Comments = new LazyList<Comment>(comments), 
```

和

```
Categories = new LazyList<Category>(GetCategoriesByPostId(p.PostId)),
Comments = new LazyList<Comment>(GetCommentsByPostId(p.PostId)), 
```

查询将不再抛出异常。

这是因为`let`声明了范围变量，它们在每一行的范围内。它们**必须**在服务器上计算。

然而，投影允许您将任意代码放入分配中，然后在客户端上构建结果时执行。这意味着将调用这两个方法，每个方法都会发出自己的查询。

        asp.net - 在 IE7 上的 ASP.AJAX 中覆盖的事件

ID：332681

赞同：0

时间：2008-12-02T00:26:01.107

标签：asp.net, javascript, internet-explorer, asp.net-ajax

问候！

当用户单击链接时，我正在从 Javascript 调用 Web 服务。我需要获取用户单击的坐标，以便可以在适当的位置显示 DIV。我的客户端脚本如下所示：

```
var g_event;

function DoWork(event, theId) 
{
    if (IsIE())
       g_event = window.event;
    else
        g_event = event;

    Acme.WebServices.Worker.GetInformation(theId, DoWorkSuccess);
}

function DoWorkSuccess(result) 
{
    var l_elemDiv = document.getElementById("content-area-div");
    DisplayAreaDiv(g_event, l_elemDiv, result);
} 
```

它是这样使用的：

```
<a href="" onclick="DoWork(event, "help");">Help</a> 
```

这在 Firefox、Safari 和 Opera 中效果很好。在 IE7 中，没有那么多。例如，如果我将以下代码放在 DoWork() 和 DoWorkSuccess() 函数的末尾：

```
alert(g_event.clientX + ", " + g_event.clientY); 
```

在 IE 中，我会收到两个警报；第一个具有正确的坐标，但第二个（显示在第一个之上）只是“[object]”。由于那个“[object]”是最后一个，所以我的 DIV 错误地显示在浏览器窗口的左上角。有没有办法阻止 IE 给我第二个“坏”事件？谢谢。

            回答 #1

赞同：1

时间：2008-12-02T02:40:29.730

为什么不提取并保存 DoWork 中的坐标并在 DoWorkSuccess 中简单地使用它们而不是保存事件。当然，如果您要从事件中提取更多数据，这将不起作用。

```
var client_x;
var client_y;

function DoWork(event, theId) 
{
    var g_event;
    if (IsIE())
       g_event = window.event;
    else
        g_event = event;

    client_x = g_event.clientX;
    client_y = g_event.clientY;

    Acme.WebServices.Worker.GetInformation(theId, DoWorkSuccess);
}

function DoWorkSuccess(result) 
{
    var l_elemDiv = document.getElementById("content-area-div");
    DisplayAreaDiv( { clientX : client_x, clientY : client_y }, l_elemDiv, result);
} 
```

            回答 #2

赞同：0

时间：2008-12-02T02:21:43.963

您是否尝试过`window.event.cancelBubble = true`在 DoWork 功能中进行设置？

如果没有，怪癖模式有关于事件和事件冒泡的好文章 - [http://www.quirksmode.org/js/events_order.html](http://www.quirksmode.org/js/events_order.html)对这些问题有很大帮助。

        html - 是否有可用于网络下拉框（和验证）的国家名称集中列表

ID：332685

赞同：28

时间：2008-12-02T00:28:26.780

标签：html, forms

网上有一些带有网络选择框的示例，其中包含大量国家/地区列表，可能足以让我使用。但是，根据墨菲定律，肯定会有某个随机国家有人来自并且不在我的列表中（并且可能其他人也遇到了这个并更新*了他们的*本地列表）。另外，当添加新国家时，我不会知道。

基本上，如果有一些我可以使用/信任的国家名称的集中列表，我觉得这是更好的做法和更好的气味。（它也可以设置/遵循确切命名“United St ...”与“USA”等的标准。）

如果可能的话，我更喜欢不是 IIS 特定的解决方案

            回答 #1

赞同：14

时间：2008-12-02T00:33:20.360

有很多国家列表，请查看此[维基百科文章](http://en.wikipedia.org/wiki/List_of_countries)；在那里您可以找到一些列表，例如：

*   [ISO 3166-1 国家代码](http://en.wikipedia.org/wiki/ISO_3166-1)
*   [国际奥委会国家代码](http://en.wikipedia.org/wiki/List_of_IOC_country_codes) 
*   [替代国家名称](http://en.wikipedia.org/wiki/List_of_alternative_country_names)

和更多...

            回答 #2

赞同：7

时间：2011-02-17T20:52:32.587

我们维护所有官方格式的“公共领域”全球国家名称列表。该信息来自 ISO 3166-1 官方英文和法文简称维护机构、美国地名委员会 (BGN)（英文简称、长名和本地简称、长名）以及联合国地名专家组 ( UNGEGN) 格式（长）英文、法文名称、短而正式的本地名称和西班牙名称。

将一些阿拉伯字符表示为罗马字符仍然存在问题（会看到？）。但这些仅限于少数阿拉伯国家的地方名称。

请注意，英语、西班牙语和法语涵盖了联合国官方 6 种语言中的 3 种西方语言。元数据、来源信息和下载可在以下位置找到：

[http://www.opengeocode.org/download.php#countrynames](http://www.opengeocode.org/download.php#countrynames)

开放地理编码团队 OpenGeoCode.org

2014 年 1 月 26 日。我们更新了列表以包含意大利语和德语的国家/地区名称。我们使用了联合国粮食和农业的意大利国家名单和德国政府联邦外交部的德国国家名单。

            回答 #3

赞同：3

时间：2009-02-17T23:44:02.480

我建议从[Unicode CLDR (Common Locale Data Repository)](http://unicode.org/cldr/)中提取数据，其中包括专业维护的国家列表和国家名称数据。

从那里抓取一次数据，并偶尔更新一次；CLDR 数据将采用一致的格式，因此一旦它成为工作流程的一部分，您就无需大惊小怪。

            回答 #4

赞同：3

时间：2014-05-03T14:25:51.447

[此](https://stackoverflow.com/questions/5395775/csv-list-of-country-codes-names)问题的答案包含一个指向[Github 项目](https://github.com/umpirsky/country-list)的有用链接，该项目具有各种格式的列表和生成它们的脚本，从而可以轻松获取更新版本。

            回答 #5

赞同：2

时间：2008-12-02T00:47:48.240

没有一个清单是全面的。  

“肯定会有某个随机国家有人来自并且不在我的名单上”

如果仅此而已，那就很简单了。

没有“世界法”或“世界宪法”，因此没有国家、共和国、领土、保护国、自治区、独立政府和争议领土的单一清单。

事实上，不可能就“国家”达成一致的定义，这将导致最终的国家代码列表。“国家”的定义带有政治色彩。例如，西藏是什么？中国的国家或地区？北爱尔兰？圣座？  

选择一个列表，并知道它会引起一些争议。

例如，您可以使用 IANA 国家代码数据库：[http ://www.iana.org/domains/root/db/](http://www.iana.org/domains/root/db/)

它和任何标准一样好，而且由于它是 IANA 的一部分，因此它具有一定的标准地位。此外，它作为易于解析的 Web 内容非常易于访问。

            回答 #6

赞同：2

时间：2009-01-30T12:28:16.343

[我在我的网站http://www.john.geek.nz/index.php/2009/01/sql-tips-list-of-countries/](http://www.john.geek.nz/index.php/2009/01/sql-tips-list-of-countries/)上准备了一份最近的清单

它以 sql 和制表符分隔 - 原始列表来自维基百科

            回答 #7

赞同：1

时间：2008-12-02T00:32:30.080

我不知道 IIS 是什么，但 ISO 3166 为每个国家/地区指定了 2 个字母的代码；AFAIK，他们的清单很全面。[ISO 3166 网站](http://www.iso.org/iso/country_codes)

            回答 #8

赞同：1

时间：2008-12-02T00:33:22.823

但是，正如您在问题中指出的那样，中央情报局[世界概况手册](https://www.cia.gov/library/publications/the-world-factbook/docs/flagsoftheworld.html)有此信息，有时有些有争议的国家不在他们的名单上，即。巴勒斯坦。

国家名称的另一个来源是[Natural Earth Data](http://www.naturalearthdata.com)及其文化地图下载链接，这些链接以形状文件的形式提供，可以绘制为地图。[这是指向中等质量地图数据下载页面的直接链接。](http://www.naturalearthdata.com/downloads/50m-cultural-vectors/)

            回答 #9

赞同：1

时间：2009-02-17T23:28:43.280

这可能为时已晚，但是您可以调用一个 Web 服务，理论上可以让您自动对控件进行数据绑定：
 [http ://www.webservicex.net/country.asmx](http://www.webservicex.net/country.asmx)

可能会为您提供另一种方法，并且比自己硬编码列表更好。

            回答 #10

赞同：1

时间：2012-12-12T04:10:19.823

我已经将一些文件发布到 github:gist

包含：

Alpha-2、Alpha-3 和 Numeric-3 值的 HTML Select 枚举，以及这些值的 XSD 片段作为简单类型限制的枚举。

[检查此链接](http://intltechventures.blogspot.com/2012/12/2012-12-08-saturday-iso-3166-country.html)

            回答 #11

赞同：1

时间：2018-04-03T11:01:59.050

查看[angerousmonkeycloud.com/geography](https://www.angrymonkeycloud.com/geography)以获取国家/地区的完整列表。

它是一个免费的 .Net 客户端，很容易上手，它使用 API 来检索值，因此您应该始终获得最新的更新。

            回答 #12

赞同：0

时间：2017-02-06T12:55:17.807

使用 Web 服务来完成这项任务要容易得多，而不是拥有自己的数据存储。这样它就更新了，你可以做一些事情，比如拥有国家/地区的 ajax 下拉集。[http://geodata.solutions](http://geodata.solutions)是最好用的，它有很多很酷的东西，比如能够根据 IP 预先选择用户的国家，以及按人口排序列表。

        asp.net - ASP.NET 应用程序通过防火墙表现出奇怪的行为

ID：332697

赞同：2

时间：2008-12-02T00:39:48.850

标签：asp.net, security, postback, firewall

**由于您的建议，此问题已得到解决。**详情见底部。非常感谢您的帮助！

我们的 ASP.NET 网站可从多个特定且高度安全的国际位置访问。它一直运行良好，但我们添加了另一个客户端位置，该位置表现出非常奇怪的行为。

特别是，当用户输入搜索条件并单击搜索按钮时，结果列表返回空。它甚至不显示“返回的 0 个结果”文本，因此就像 Repeater 控件根本没有绑定一样。类似的行为出现在网站的其他部分（但不是全部）中。用户可以正常登录网站并显示他们的个人资料信息。

我已经使用与他们完全相同的凭据在本地登录了该站点，并且该站点从这里运行良好。我们已经仔细完成了这些步骤，所以我相信这不是用户问题。

我在第一次加载时将搜索结果绑定在搜索结果页面的Page_Load中（条件在查询字符串中）。IE

```
if (!IsPostBack) {
  BindResults();
} 
```

通过注释掉 BindResults() 方法调用，我可以在本地复制完全相同的行为。

有人知道 IsPostBack 的值是如何计算的吗？他们高度安全的防火墙设置是否有可能导致 IsPostBack 始终返回 true，即使它是来自另一个页面的重定向？这可能是一个转移注意力的问题，因为问题可能出在其他地方。它确实复制了结​​果。

我无法访问该站点，因此故障排除仅限于向他们提供说明并要求他们告诉我结果。

谢谢你的时间！

附加信息：客户端位于运行默认规则的 Microsoft ISA 2006 防火墙后面。该站点已添加到 Internet Explorer 受信任站点列表中，并在 FireFox 和 Google Chrome 中进行了尝试，所有结果都相同。

**解决方案**：对我来说，获胜者是使用 Fiddler 的建议。多么出色的工具，任何 Web 开发人员都不应该没有。使用它，我能够从请求中删除各种标头，直到我重现问题为止。实际上有两个因素导致了这个错误，就像这种令人困惑的问题经常发生的情况一样。

因素一——Web 应用程序尽可能使用所有主流浏览器都支持的 GZIP 压缩。防火墙正在剥离指定 GZIP 解压缩支持的标头（Accept-Encoding: gzip, deflate）。

因素二——我的代码中的一个错误意味着在发送未压缩的内容时绕过了某些处理。这个问题之前没有注意到，因为该应用程序被有限的受众使用，所有这些应用程序都支持 GZIP 解压缩。

            回答 #1

赞同：3

时间：2008-12-02T04:36:00.713

如果他们精通技术，我会让他们下载 Fiddler 或类似的东西，捕获整个 HTTP 会话，然后将保存的会话发送给您。也许里面的东西会突出。

同时，看看您是否可以安装 ISA Server（如果必须的话，可以安装评估版，或者如果您有或认识任何有 sub 的人，请从 MSDN 安装），看看您是否可以在本地复制它。

            回答 #2

赞同：1

时间：2008-12-02T03:21:23.827

客户端是否有可能禁用了 Javascript 并且没有获取 _EVENTTARGET 表单值？

            回答 #3

赞同：1

时间：2008-12-02T03:57:26.500

它可能是某种代理，它根据给定的 POST 请求创建 GET 请求......

我不确定 IsPostBack 是如何计算的，但我的猜测是它会检查 HTTP 请求以查看它是 POST 还是 GET ......

            回答 #4

赞同：1

时间：2008-12-02T03:59:03.423

哦耶。这绝对不是“_EVENTTARGET”顺便说一句...

我知道这一点，因为[Ra-Ajax](http://ra-ajax.org)不会将任何这些参数传递给服务器，并且它们（Ra-ajax 请求）被作为 IsPostBack 请求处理......

            回答 #5

赞同：1

时间：2008-12-02T14:39:52.833

您能否创建一个测试帖子页面来传递与您的搜索页面相同的内容，并在 Page_Load 中写回所有帖子以确保它们通过，特别是 __VIEWSTATE。

```
foreach (string key in Request.Form)
{
    Response.Write("<br>" + key + "=" + Request.Form[key]);
} 
```

然后让其中一位用户转发他们在该测试页面上看到的内容。

编辑：有文档表明某些防火墙可能会破坏 VIEWSTATE 以及一些绕过它的方法：[查看状态概述](http://msdn.microsoft.com/en-us/library/ms178198.aspx)

            回答 #6

赞同：1

时间：2008-12-02T14:48:43.177

地点，地点，地点。检查用户的文化。通常这会导致问题。

            回答 #7

赞同：1

时间：2008-12-02T15:59:01.210

检查 IIS 日志以查看请求是否甚至发送到您的服务器。ISA 设置可能正在缓存初始请求并在后续请求中提供该请求。

        .net - 我正在寻找一种使用通配符搜索 .net 哈希表中的值的方法

ID：332700

赞同：1

时间：2008-12-02T00:42:45.817

标签：.net, hashtable

我有一大堆值存储在 .net 2.0 哈希表中。我真正想找到的是一种在表上执行 SQL 选择语句的方法。

意思是，我想获得一个键列表，其关联值与一个非常简单的文本模式匹配（沿着“以数字开头”的行。）

最终目标是从哈希表中删除这些记录以进行进一步处理。

一段时间以来，我一直在反对这个问题，但我似乎无法提出任何建议。

有任何想法吗？

（万一这很重要：由于该项目的实际情况，任何第 3 方小部件或升级到 .net 的更新版本都不可行。）

            回答 #1

赞同：3

时间：2008-12-02T01:37:11.463

如果您真的在寻找以数字开头的东西，那么您可以比使用 Regex 更快地完成它。只需查看每个键的第一个字符并确定它是否为数字。将要删除的密钥存储在列表中，因为您只需要保留密钥。

```
 List<string> keysToRemove = new List<string>( myhashtable.Count );
    foreach (string key in myhashtable.Keys)
    {
        if (char.IsDigit(key[0])
        {
            keysToRemove.Add(key);
        }
    }

    foreach (string key in keysToRemove)
    {
        myhashtable.Remove(key);
    } 
```

            回答 #2

赞同：2

时间：2008-12-02T00:47:40.470

您可以对哈希表中的每个键使用正则表达式。这很脏，但它有效：

```
 static void Main(string[] args)
    {
        Hashtable myhashtable = new Hashtable();
        myhashtable.Add("Teststring", "Hello");
        myhashtable.Add("1TestString1", "World");
        myhashtable.Add("2TestString2", "Test");

        List<String> newht = new List<String>;

        //match all strings with a number at the front
        Regex rx = new Regex("^[1-9]");
        foreach (string key in myhashtable.Keys)
        {
            if (rx.IsMatch(key) == true)
            {
                newht.Add(key);
            }
        }

        //Loop through all the keys in the new collection and remove them from
        //them from the main hashtable.
        foreach (string key in newht)
        {
            myhashtable.Remove(key);
        }
    } 
```

编辑：只是为了好玩，这里是 LINQ 版本（对不起，我也有过）。

```
 Hashtable myhashtable = new Hashtable();
            myhashtable.Add("Teststring", "Hello");
            myhashtable.Add("1TestString1", "World");
            myhashtable.Add("2TestString2", "Test");

            Regex rx = new Regex("^[1-9]");
            var k = (from string key in myhashtable.Keys
                     where rx.IsMatch(key)
                     select key).ToList();

            k.ForEach(s => myhashtable.Remove(s)); 
```

编辑：我刚刚添加了 sting 列表而不是哈希表，我不记得哪个 .net 版本中有通用列表 ***拍了额头

            回答 #3

赞同：1

时间：2008-12-02T01:55:46.777

使用 LINQ：

```
Dim myhashtable As New Hashtable
    myhashtable.Add("Teststring", "Hello")
    myhashtable.Add("1TestString1", "World")
    myhashtable.Add("2TestString2", "Test")

For Each i As String In From Element In myhashtable.Cast(Of DictionaryEntry)() Let k = DirectCast(Element.Value, String) Where k.StartsWith("W") Select DirectCast(Element.Key, String)
        MsgBox("This key has a matching value:" & i)
    Next 
```

但如果使用 LINQ，最好使用 Dictionary：

```
 Dim d = New Dictionary(Of String, String)()
    d.Add("Teststring", "Hello")
    d.Add("1TestString1", "World")
    d.Add("2TestString2", "Test")

    For Each i As String In From element In d Where element.Value.StartsWith("W") Select element.Key
        MsgBox("This key has a matching value:" & i)
    Next 
```

而不是 .StartsWith("W") 你当然可以做任何其他你想要的过滤。

        algorithm - 快速实体分组（按位置）算法

ID：332701

赞同：4

时间：2008-12-02T00:43:31.977

标签：algorithm, grouping

我正在处理一大群存储位置的实体。它们显示在地图上。当从更高的位置查看时，我试图想出一种有效的方法将附近的实体分组为一个实体。因此，例如，如果您非常高，向下看时，您会看到一个实体，它代表一个区域中一组位置很近的实体。放大到足够近会将该实体拆分为其包含的实体。

有没有一种有效的算法来做到这一点？我考虑过根据高度对视图进行网格化，然后根据位置将实体放入网格框中，然后渲染框点。我唯一担心的是，如果所有实体都位于该框的右上角，则呈现为代表它们的实体可能位于中间而不是实体组的位置。

有什么想法或想法吗？

            回答 #1

赞同：1

时间：2008-12-02T00:50:15.630

如果您将实体预先分配到实体组中，或者某个“视野”中的所有实体自动在“组”中，那么您可以使用“中心”为实体组分配“位置”质量”算法，实际上纬度只是所有包含纬度的平均值，经度也是如此......将它们相加并除以计数，对于两个维度......

如果您想要一种算法来“创建”分组，那么您需要指定一些业务规则，当“视图”中有两个候选组时，如何确定一个实体应该属于两个或多个潜在组中的哪一个您正在计算的高度。  

            回答 #2

赞同：1

时间：2008-12-02T01:13:24.430

我认为植绒可以帮助在这里创建这些群体。因为看起来想要彼此聚集的不同实体应该是一个群体的一部分。

[http://arxiv.org/abs/math?papernum=0502342](http://arxiv.org/abs/math?papernum=0502342)

[http://flashorbit.com/?page_id=40](http://flashorbit.com/?page_id=40)

在计算群体时，“Boids”似乎在同一个街区。
[http://www.red3d.com/cwr/boids/](http://www.red3d.com/cwr/boids/)

            回答 #3

赞同：1

时间：2008-12-02T03:34:24.830

我相信您正在寻找的是“聚类算法”。有很多可用的。一个好的开始可能是[K-means 算法](http://en.wikipedia.org/wiki/K-means_algorithm)。最终，尽管听起来您想要某种层次聚类算法。

        nhibernate - NHibernate Eager 在多个级别上获取

ID：332703

赞同：19

时间：2008-12-02T00:44:08.730

标签：nhibernate, fetching-strategy

我有一个 3 级实体层次结构：Customer-Order-Line，我想使用 ISession.Get(id) 为给定客户完整检索它。我有以下 XML 片段：

客户.hbm.xml：

```
<bag name="Orders" cascade="all-delete-orphan" inverse="false" fetch="join">
  <key column="CustomerID" />
  <one-to-many class="Order" />
</bag> 
```

order.hbm.xml：

```
<bag name="Lines" cascade="all-delete-orphan" inverse="false" fetch="join">
  <key column="OrderID" />
  <one-to-many class="Line" />
</bag> 
```

我使用了 fetch="join" 属性来表示我想为每个父级获取子实体，这已经构建了正确的 SQL：

```
SELECT 
    customer0_.ID AS ID8_2_, 
    customer0_.Name AS Name8_2_, 
    orders1_.CustomerID AS CustomerID__4_, 
    orders1_.ID AS ID4_, 
    orders1_.ID AS ID9_0_, 
    orders1_.PostalAddress AS PostalAd2_9_0_, 
    orders1_.OrderDate AS OrderDate9_0_, 
    lines2_.OrderID AS OrderID__5_, 
    lines2_.ID AS ID5_, 
    lines2_.ID AS ID10_1_, 
    lines2_.[LineNo] AS column2_10_1_, 
    lines2_.Quantity AS Quantity10_1_, 
    lines2_.ProductID AS ProductID10_1_ 

FROM Customer customer0_ 

LEFT JOIN [Order] orders1_ 
       ON customer0_.ID=orders1_.CustomerID 

LEFT JOIN Line lines2_ 
       ON orders1_.ID=lines2_.OrderID 

WHERE customer0_.ID=1 
```

到目前为止，这看起来不错 - SQL 返回了正确的记录集（只有一个不同的 orderid），但是当我运行测试以确认 Orders 和 Lines 的正确实体数量（来自 NH）时，我得到了错误的结果

我*应该*（从我的测试数据中）得到 1xOrder 和 4xLine，但是，我得到了 4xOrder 和 4xLine。NH 似乎没有识别结果集中的“重复”订单信息组，也没有正确“重用”订单实体。

我正在使用所有整数 ID (PK)，并且我尝试使用此 ID 实现 T 的 IComparable 和 T 的 IEquatable，希望 NH 会看到这些实体的相等性。我还尝试覆盖 Equals 和 GetHashCode 以使用 ID。这些“尝试”都没有成功。

NH 是否支持“多级提取”操作，如果支持，是否需要 XML 设置（或其他机制）来支持它？

注意：我使用了 Sirocco 的解决方案，对我自己的代码进行了一些更改，最终解决了这个问题。对于所有集合，xml 需要从包更改为集合，并且实体本身已更改为实现 IComparable<>，这是建立唯一性的集合的要求。

```
public class BaseEntity : IComparable<BaseEntity>
{
    ...

    private Guid _internalID { get; set; }
    public virtual Guid ID { get; set; }

    public BaseEntity()
    {
        _internalID = Guid.NewGuid();
    }

    #region IComparable<BaseEntity> Members

    public int CompareTo( BaseEntity other )
    {
        if ( ID == Guid.Empty || other.ID == Guid.Empty )
            return _internalID.CompareTo( other._internalID );

        return ID.CompareTo( other.ID );
    }

    #endregion

    ...

 } 
```

请注意 InternalID 字段的使用。这是新的（瞬态）实体所必需的，否则它们最初不会有 ID（我的模型在保存时提供了它们）。

            回答 #1

赞同：21

时间：2008-12-15T12:45:18.833

您将获得 4XOrder 和 4XLines ，因为使用线连接会使结果加倍。您可以在 ICriteria 上设置一个 Transformer，例如：

```
.SetResultTransformer(new DistinctRootEntityResultTransformer()) 
```

            回答 #2

赞同：5

时间：2008-12-02T08:48:35.120

我刚刚阅读了[Ayende 的博客文章](http://feeds.feedburner.com/~r/AyendeRahien/~3/470968251/solving-the-select-n1-problem.aspx)，他使用了以下示例：

```
session.CreateCriteria(typeof(Post))
    .SetFetchMode("Comments", FetchMode.Eager)
    .List(); 
```

在条件查询中避免对特定查询进行延迟加载

也许这可以帮助你。

            回答 #3

赞同：1

时间：2011-11-24T23:54:21.247

如果您需要将一对多保存为袋子，则可以发出 2 个查询，每个查询只有 1 级层次结构。例如这样的：

```
var temp = session.CreateCriteria( typeof( Order ) )
    .SetFetchMode( "Lines", NHibernate.FetchMode.Eager )
    .Add( Expression.Eq( "Customer.ID", id ) )
    .List();

var customer = session.CreateCriteria( typeof( Customer ) )
    .SetFetchMode( "Orders", NHibernate.FetchMode.Eager )
    .Add( Expression.Eq( "ID", id ) )
    .UniqueResult(); 
```

行在第一个查询中被加载到 NH 缓存中，因此在以后访问例如 customer.Orders[0].Lines[0] 时不需要延迟加载。

            回答 #4

赞同：0

时间：2008-12-02T21:23:47.060

@Tigraine：您的查询仅返回带有评论的帖子。这会带来带有所有评论的所有帖子（2 个级别）。Ben 要求的是 Customer to Order To LineItem（3 级）。@Ben：据我所知，nHibernate 还不支持预先加载到 3 级。Hibernate 确实支持它。  

            回答 #5

赞同：0

时间：2009-08-14T21:08:16.317

我遇到了同样的问题。看到这个[线程](http://groups.google.com/group/nhusers/browse_thread/thread/be7e0fb58e05c442/df12460afab58fea#df12460afab58fea "NH 用户组")。我没有得到解决方案，而是来自 Fabio 的提示。使用 Set 而不是 bag。它奏效了。

所以我的建议是尝试使用 set。您不必使用 Iesi 集合使用 IDictonary 并且 NH 很高兴

```
public override IEnumerable<Baseline> GetAll()
{
     var baselines = Session.CreateQuery(@" from Baseline b
                                            left join fetch b.BaselineMilestones bm
                                            left join fetch bm.BaselineMilestonePrevious ")
                                            .SetResultTransformer(Transformers.DistinctRootEntity)
                                            .List<Baseline>();
     return baselines;
} 
```

        c++ - 浮点数或双倍特殊值

ID：332705

赞同：5

时间：2008-12-02T00:47:23.013

标签：c++, floating-point, double

我有可能是“空”的双（或浮点）变量，因为没有有效值。如何使用内置类型 float 和 double 来表示这种情况？

一种选择是具有浮点数和布尔值的包装器，但这不起作用，因为我的库有存储双精度数的容器，而不是表现为双精度数的对象。另一个将使用 NaN (std::numeric_limits)。但我看不出有什么方法可以检查变量是否为 NaN。

如何解决需要“特殊”浮点值来表示数字以外的东西的问题？

            回答 #1

赞同：7

时间：2008-12-02T00:50:55.253

我们通过使用 NaN 做到了这一点：

```
double d = std::numeric_limits<double>::signaling_NaN();
bool isNaN = (d != d); 
```

NaN 值与自身的相等性比较将产生错误。这就是您测试 NaN 的方式，但这似乎只有在`std::numeric_limits<double>::is_iec559`为真时才有效（如果是，它也符合 ieee754）。

在 C99 中有一个`isnan`为此调用的宏 in `math.h`，它也检查浮点数是否为 NaN 值。

            回答 #2

赞同：6

时间：2008-12-02T00:59:11.697

在 Visual C++ 中，有一个非标准[`_isnan(double)`](http://msdn.microsoft.com/en-us/library/tzthab44.aspx)函数可以通过`float.h`.

在 C 中，有一个[`isnan(double)`](http://www.opengroup.org/onlinepubs/009695399/basedefs/math.h.html)函数可以通过`math.h`.

在 C++ 中，有一个 isnan(double) 函数可以通过`cmath`.

正如其他人指出的那样，使用 NaN 可能会很麻烦。它们是一种特殊情况，必须像 NULL 指针一样处理。不同之处在于 NaN 通常不会导致核心转储和应用程序故障，但它们极难追踪。如果您决定使用 NaN，请尽可能少地使用它们。过度使用 NaN 是一种冒犯性的编码做法。

            回答 #3

赞同：2

时间：2008-12-02T01:04:52.027

它不是内置类型，但我通常`boost::optional`用于这种事情。如果你绝对不能使用它，也许指针可以解决问题——如果指针为 NULL，那么你就知道结果不包含有效值。

            回答 #4

赞同：1

时间：2008-12-02T06:36:04.217

***一种选择是具有浮点数和布尔值的包装器，但这是行不通的，因为我的库有存储双精度数的容器，而不是表现为双精度数的对象。***

真可惜。在 C++ 中，创建一个自动转换为实际双（引用）属性的模板类是微不足道的。（或对任何其他类型的引用。）您只需在模板类中使用强制转换运算符。例如：operator TYPE & () { 返回值；然后，您可以在通常使用双精度的任何地方使用 HasValue<double>。

***另一个将使用 NaN (std::numeric_limits)。但我看不出有什么方法可以检查变量是否为 NaN。***

正如*litb*和*James Schek*所说，C99 为我们提供了 isnan()。

但要小心！Nan值使数学和逻辑变得真正有趣！你会认为一个数字不能同时是 NOT>=foo 和 NOT<=foo。但是对于 NaN，它可以。

我在工具箱中保留一个 WARN-IF-NAN(X) 宏是有原因的。过去我遇到过一些有趣的问题。

        php - 将配置变量放入 php 5 中的类的最佳方法是什么？

ID：332709

赞同：1

时间：2008-12-02T00:48:16.743

标签：php, oop

这是给我的数据库类的。我是 OO 的新手，当了一段时间的程序小伙子，所以我还是有点模糊。

我的第一个想法是使用一堆 setter 函数/方法。但是在写了一大堆之后，我想到了使用 PHP 的定义函数，就像这样。

```
define('MYSQL_USERNAME', 'jimbo'); 
```

这是公认的做法吗？最佳做法是什么？我真的应该用一堆 setter 函数弄乱我的类吗（我目前是唯一使用这些类的开发人员）。你的解决方案是什么？

谢谢！

            回答 #1

赞同：2

时间：2008-12-02T00:59:02.493

可能有几个选项可以解决这个问题：

1.  只需使用设置器，这是完全可以接受的，但是有很多配置选项可能会有点“罗嗦”。

2.  使用配置对象传入：

    ```
    $config = (object) array(
       'prop1' => 'somevalue',
       'prop2' => 'somevalue2',
       'prop3' => 'somevalue3',
    );

    $db = new DB($config); 
    ```

3.  如果要使用常量，可以将它们限制在类中以避免全局命名空间污染：

    ```
    class DB {
        const USER = 'mysqluser';
    }

    echo DB::USER; // for example 
    ```

            回答 #2

赞同：2

时间：2008-12-02T01:02:53.357

我`const`仅用于为类中的不可变常量创建助记符名称。该`define()`函数不会将常量创建为类的一部分，而是在全局空间中创建常量。

```
class MyClass
{
  const CONFIG_FILE = 'myapp.ini'; 
```

类配置数据我通常在类中声明为`protected`哈希数组。键对助记符很有用。值是默认值。

```
 protected $config = array(
    'logfile' => 'err.out',
    'debug' => false
  ); 
```

然后我加载一个“ini”格式文件`parse_ini_file()`并使用它`array_merge()`来将键映射到你的类配置数组中：

```
 public function __construct() {
    $ini_data = parse_ini_file(self::CONFIG_FILE, __CLASS__);
    $this->config = array_merge($this->config, $ini_data);
  }

} 
```

            回答 #3

赞同：0

时间：2015-02-18T21:21:17.603

我在这方面取得了很好的成功，有两种方式：

1.  正如@Owen 建议的那样，使用类常量

    ```
    class Config {
        const PASSWORD_LENGTH = 12;
        const SEND_PASSWORD_EMAILS = true;
        // ...
    } 
    ```

2.  对于简单的配置变量（即没有数组等），composer 上可用的包[vlucas/phpdotenv](https://github.com/vlucas/phpdotenv)做得很好。一个文件`.env`包含您的所有配置：

    ```
    PASSWORD_LENGTH=12
    SEND_PASSWORD_EMAILS=1 
    ```

然后通过超全局`getenv()`或`$_ENV`超全局提供。

```
 Dotenv::load(__DIR__);
    $passwordLength = $_ENV['PASSWORD_LENGTH'] 
```

        excel - 范围描述一组不相邻的单元格

ID：332717

赞同：1

时间：2008-12-02T00:53:42.143

标签：excel, automation, vba

我的应用程序需要从工作表上所有选定的单元格构建缓冲区。I have it working correctly when the selected cells are all one contiguous group, but if the user selects a group of cells, then holds down the control key and selects other cells that are not contiguous to the first set of cells, the Worksheet's Selected range只给我关于第一组细胞的信息。  

我尝试了 Range “Next” 属性，但似乎只返回包含第一个范围的逐个单元格遍历的范围。

            回答 #1

赞同：3

时间：2008-12-02T01:18:38.303

VBA 代码

 `for i = 1 to selection.Areas.Count : debug.Print selection.areas(i).Address : next` 

            回答 #2

赞同：1

时间：2008-12-02T01:13:30.030

Address 属性返回选定的范围（以逗号分隔）

当我选择 B4 到 D10，然后选择 H9 到 016（按住 ctrl）时，Selection.Address 返回 $B$4:$D$10,$H$9:$O$16。

        c# - 使用通用控件的 Visual Studio 常规帮助

ID：332719

赞同：1

时间：2008-12-02T00:54:44.607

标签：c#, visual-studio

我知道这听起来很基础，但我刚开始使用 Visual Studio，我正在寻找有关基本控制功能的说明。一般来说，不同选项的作用。我只是想熟悉一些功能，我并不完全了解如何操作数据。例如，如何在点击返回按钮而不是窗口中的任何输入更改后触发文本框中的信息。我知道这听起来很简单，但是从基础开始非常令人沮丧。我正在寻找一本可以帮助我克服一些简单障碍的好书或在线支持论坛。另外，是否有一个时钟功能可以在某人完成的程序中用作倒计时。

谢谢

自杀

            回答 #1

赞同：1

时间：2008-12-02T01:39:58.307

[http://www.learnvisualstudio.net/](http://www.learnvisualstudio.net/)

优秀的教程视频，一个很好的起点

            回答 #2

赞同：0

时间：2008-12-03T21:29:38.793

[DreamInCode.net](http://www.dreamincode.net/forums/showforum84.htm)上有很多很棒的开源（免费）资源和教程

我在那里解决了几个问题并学习了一些新技术。我喜欢它的地方在于教程会一步一步地引导你，你也可以获得源代码。

[DreamInCode 上的计时器帮助。](http://www.dreamincode.net/forums/index.php?showtopic=74593&hl=timer)

            回答 #3

赞同：0

时间：2008-12-03T17:20:46.533

如果您已经有一些类似编程的经验 - 您可以为您尝试学习的相应语言选择一本食谱。一本烹饪书必须有针对性的答案，这将使您立即启动并运行。

在之前完成了 VB 6 之后，当我想学习 C#.Net 时，我也做了同样的事情。

但是，如果您想花更多时间整理东西并了解所有问题的关键，我建议您阅读一本傻瓜书。

是的，有一个时钟控件，一旦你启用它并设置它的时间间隔，你就可以拖放它并为 _tick 事件编程。

            回答 #4

赞同：0

时间：2008-12-02T00:59:19.840

网上有一些关于 Visual Studio 编程的视频教程。如果您喜欢书籍 - 从 VS 中的课程开始。

要处理文本框中的返回按钮，只需处理 KeyPressed 事件，并且在参数 e 中，您拥有所有必要的信息。

要执行类似时钟的操作，您可以使用 Timer 组件。它根据计时器间隔时间触发一个事件。

        ruby - 用红宝石Ping一个网站？

ID：332720

赞同：5

时间：2008-12-02T00:55:13.233

标签：ruby, rubygems, ping

哪些替代品可用于在 Ruby 中 ping ip 地址？标准库“ping”库的功能似乎非常有限。我对在这里滚动我自己的代码不感兴趣。有没有好的宝石？我应该接受它并忍受它吗？

（我在 Linux 上使用 Ruby 1.8.6 进行编码）

            回答 #1

赞同：9

时间：2008-12-02T08:07:43.127

`[net-ping](https://rubygems.org/gems/net-ping)`值得一看。它允许 TCP ping（如标准 ruby `ping`​​），但也允许 UDP、HTTP 和 ICMP ping。ICMP ping 需要 root 权限，但其他不需要。

            回答 #2

赞同：0

时间：2008-12-02T05:47:21.990

要实现 ping，您需要创建一个原始套接字，该套接字仅限于 root。因此，实际上不可能将 ping 实现为库，除非您知道您将以 root 身份运行。如果后者可以接受，请查看[icmpping](http://raa.ruby-lang.org/project/icmpping/)库。

        algorithm - 人工神经网络问题

ID：332722

赞同：19

时间：2008-12-02T00:57:20.343

标签：algorithm, neural-network

一般来说，通过向隐藏层或更多隐藏层添加更多节点来扩展人工神经网络会得到什么？

它是否允许更精确的映射，或者它是否允许它可以识别的关系更微妙，或者其他什么？

            回答 #1

赞同：21

时间：2009-01-05T13:23:55.077

机器学习中有一个众所周知的结果，即单个隐藏层足以逼近任何平滑的有界函数（这篇论文被称为[“多层前馈网络是通用逼近器”](http://portal.acm.org/citation.cfm?id=70408)，现在已经有将近 20 年的历史了）。然而，有几件事需要注意。

*   单个隐藏层可能需要任意宽。
*   这并没有说明找到近似值的难易程度。一般来说，大型网络很难正确训练并且经常成为过度拟合的牺牲品（所谓的“卷积神经网络”例外，它实际上只用于解决视觉问题）。
*   这也没有说明表示的效率。如果使用一层完成，某些函数需要指数数量的隐藏单元，但使用更多层可以更好地扩展（有关更多讨论，请阅读[Scaling Learning Algorithms Towards AI](http://yann.lecun.com/exdb/publis/pdf/bengio-lecun-07.pdf)）

深度神经网络的问题在于它们更难训练。你最终会得到非常非常小的梯度被反向传播到更早的隐藏层并且学习不会真正去任何地方，特别是如果权重被初始化为很小（如果你将它们初始化为更大的数量，你经常会陷入糟糕的局部最小值） . 有一些“预训练”技术，例如 Geoff Hinton 在[Google 技术演讲](http://www.youtube.com/watch?v=AyzOUbkUf3M)中讨论的技术，它们试图解决这个问题。

            回答 #2

赞同：8

时间：2008-12-02T01:05:54.537

这是一个非常有趣的问题，但回答起来并不容易。这取决于您尝试解决的问题以及您尝试使用的神经网络。有几种神经网络类型。

我一般不清楚更多的节点是否等于更高的精度。研究表明，您通常只需要一个隐藏层。节点数应该是解决问题所需的最小节点数。如果你没有足够的它们 - 你将无法找到解决方案。

另一方面 - 如果您已经达到了可以解决解决方案的节点数量 - 您可以添加越来越多的节点，并且您将看不到结果估计的任何进一步进展。

这就是为什么有这么多类型的神经网络。他们试图解决不同类型的问题。所以你有神经网络来解决静态问题，解决时间相关问题等等。节点的数量不像它们的设计那么重要。

            回答 #3

赞同：5

时间：2008-12-02T01:25:45.700

当您拥有隐藏层时，您正在创建输入的组合特征。那么，是通过现有输入的更多特征，还是通过组合现有特征的高阶特征来更好地解决问题？这是标准前馈网络的权衡。

你有一个理论上的保证，任何函数都可以用一个具有两个隐藏层和非线性激活的神经网络来表示。  

此外，如果您不确定合适的拓扑结构，请考虑使用额外资源进行提升，而不是添加更多节点。

            回答 #4

赞同：3

时间：2008-12-02T01:43:29.360

非常粗略的经验法则

对于更大的输入向量，通常每层有更多的元素。

更多的层可以让您对更多的非线性系统进行建模。

如果您使用的网络类型有传播延迟，则更多层可能允许对时间序列进行建模。注意在延迟中有时间抖动，否则它不会很好地工作。如果这对您来说只是 gobbledegook，请忽略它。

更多层可让您插入重复特征。这对于辨别任务非常有用。你 ANN 执行我不允许这样做。

高温高压

            回答 #5

赞同：1

时间：2008-12-24T00:53:34.797

每个隐藏层的单元数说明了 ANN 描述任意复杂函数的潜力。一些（复杂的）函数可能需要许多隐藏节点，或者可能需要多个隐藏层。

当一个函数可以通过一定数量的隐藏单元粗略近似时，任何额外的节点都会提供更高的准确性……但这只有在使用的训练样本足以证明这种添加的合理性时才是正确的——否则会发生“过度收敛” . 过度收敛意味着你的 ANN 已经失去了泛化能力，因为它过分强调了特定的样本。

一般来说，如果得到的网络能给出好的结果，最好使用尽可能少的隐藏单元。在大多数情况下，很难找到证明更多隐藏节点合理所需的额外训练模式，并且准确性不是 NN 的强项。

        cocoa - 线程安全的 UITableView

ID：332727

赞同：4

时间：2008-12-02T00:59:50.087

标签：cocoa, cocoa-touch, multithreading

我正在使用 UITableView 来显示数组中的一些数据。其他线程可以随时更改此数组。（我相信数组是可变的，或者只是完全替换，没有区别。）对数组本身的访问是线程安全的。

确保 tableview 线程安全的正确方法是什么？例如，我担心我可能会在调用 cellForRowAtIndexPath 之前将数组更改为更短，从而导致 NSRangeException。

我是不是该...

1.  强制只在主线程上更改数组？（看起来很丑。）
2.  维护一个影子数组并通过 KVO 观察在主线程上更新它？
3.  ？？？应该有更好的解决方案...

            回答 #1

赞同：6

时间：2008-12-02T01:22:55.597

根据您的描述，您确实有两个不同的数据集：

*   实际数据，因为它存在于您的模型中
*   显示给用户的数据

因此，实际上，您已经拥有了一个“阴影”数组（虚拟阴影，这可能将比喻延伸得太远了）。我想说你最好的选择是形式化这种安排，并保留一个只在主线程中修改的“显示”数组。在其中，您可以拥有“真实”数组中的对象；由于它们只是指针，因此您不会放弃太多内存。

线程是邪恶的。

            回答 #2

赞同：3

时间：2011-04-16T01:54:07.767

在不了解您的应用程序的更多信息的情况下，我认为更好的解决方案之一是将数组保留在主线程上，并在另一个线程需要进行更改时将其分派回它。像这样：

```
dispatch_async(dispatch_get_main_queue(), ^{
                [array addObject:object];
                [tableView reloadData];
            }); 
```

当然，您可以使用调度 API 变得更复杂，但它确实为您处理锁定和一切。绝对比使用 NSLock 更优雅。它只适用于 iOS 4 或更高版本。

            回答 #3

赞同：1

时间：2011-04-15T23:39:04.873

我也有同样的情况。我有一组 C++ 对象，它们在 tableview 中提供信息。

正如 Ben 所提到的，我还有一个临时的“影子”数组，可以通过 Internet 将新信息下载到其中。查询完成后，我将该数组与支持 tableview 的数组进行协调，这非常快。问题是如何在协调过程中保护阵列。

我正在主线程上进行协调，但我不确定这是否足以防止冲突，特别是如果用户在查询未决时点击条目；他正在查看细节的底层对象可能会被吹走。

这里有一个与您（和我的）类似的问题：
 [Update UITableView using threads](https://stackoverflow.com/questions/3374979/update-uitableview-using-threads)

但这些答案指责发帖人在后台操作上花费了太长时间，而不是回答他的问题。

我将使用 NSLock，并在更改数组和所有 UITableView 委托方法之前获取它，除非有人有更好的主意。

        parsing - Yacc 还在行业中使用吗？

ID：332734

赞同：19

时间：2008-12-02T01:05:35.567

标签：parsing, yacc

我正在开发的软件库使用了大量我不需要处理的 yacc。有时我认为这有助于理解我发现的一些问题，但大多数时候我可以摆脱对 yacc 的完全无知。

我的问题是有足够的新项目仍然使用 yacc 来保证我需要学习它的时间吗？

编辑：鉴于响应主要是支持学习 Yacc，是否有类似的语言可以推荐给 yacc？

            回答 #1

赞同：32

时间：2008-12-02T01:13:13.227

是的，如果您需要创建或修改解析语法的代码，这些工具值得学习。  

多年来，用于生成代码以解析语法的事实上的工具是 yacc，或者它的 GNU 表亲，bison。

最近我听说这个街区有几个新孩子，但原则是一样的：你以或多或少的巴科斯-瑙尔格式 ( [BNF](http://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form) ) 和 yacc/bison/whatever格式编写声明性语法为您生成一些手工编写非常乏味的代码。

此外，即使您不需要直接处理此类代码，语法背后的原理也非常有用。自从在大学学习编译器设计课程以来，我并没有过多地使用解析器，但是了解运行时堆栈、前瞻解析器、表达式评估和许多其他相关的东西极大地帮助了我有效地编写和调试我的代码。

**编辑：**鉴于您对其他工具的后续问题，Yacc/Bison 当然最适合 C/C++ 项目，因为它们生成 C 代码。其他语言也有类似的工具。并不是所有的语法都是等价的，一些解析器生成器只能理解一定复杂度的语法。所以你可能需要找到一个可以解析你的语法的工具。见[http://en.wikipedia.org/wiki/Comparison_of_parser_generators](http://en.wikipedia.org/wiki/Comparison_of_parser_generators)

            回答 #2

赞同：6

时间：2008-12-02T01:13:47.907

我不知道使用它的新项目，但我参与了七个使用 lex 和 yacc 处理配置文件的不同维护工作。

对我来说没有 XML，没有先生 :-)。

使用 lex/yacc 的解决方案比旧的行配置文件更上一层楼，`key=val`因为它们允许更好的层次结构，例如：

```
server = "mercury" {
    ip = "172.3.5.13"
    gateway = "172.3.5.1"
}
server = "venus" {
    ip = "172.3.5.21"
    gateway = "172.3.5.1"
} 
```

而且，是的，我知道您可以使用 XML 做到这一点，但这些主要是用 C 编写的遗留应用程序，老实说，我可能也会将 lex/yacc 用于新的（非 Java）工作。

那是因为我更喜欢按时和按预算交付软件，而不是交付最棒的新奇技术——我的客户不会为我的教育付费，他们首先要的是结果，而我已经是 lex/yacc 方面的专家，并且拥有一切快速执行此操作的模板代码。

            回答 #3

赞同：3

时间：2008-12-02T01:38:57.637

一般的经验法则：代码会持续很长时间，因此代码中使用的技术也会持续很长时间。替换您提到的代码库需要大量时间（构建它需要 15 年......），这反过来意味着它仍将在 5、10 或更长时间后出现。（甚至有可能阅读此答案的人最终会继续努力！）

另一个经验法则：如果一种通用技术足够普遍以至于您已经遇到过它，那么它可能已经足够普遍以至于您应该熟悉它，因为有一天您会再次看到它。谁知道：通过熟悉它，也许你在你的工具箱中添加了一个有用的工具......

Yacc 是这些技术之一：您可能会再次遇到它，它并不难，而且您将学习的原理适用于整个解析器构造函数家族。

            回答 #4

赞同：3

时间：2008-12-02T10:32:31.430

[PEGs](http://en.wikipedia.org/wiki/Parsing_expression_grammar) are the new hotness, but there are still a ton of projects that use yacc or tools more modern than yacc. I would frown on a new project that chose to use yacc, but for existing projects porting to a more modern tool may not make sense. This makes having rough familiarity with yacc a useful skill.

如果您完全不熟悉解析器生成器的主题，我鼓励您学习任何一种。许多概念在它们之间是可移植的。此外，它是一个有用的工具：一旦你了解了一个工具，你就会明白与正则表达式繁重的手写解析器相比，它们通常是如何优越的。如果您已经对解析器的主题感到满意，那么我不会担心。您将在需要时学习 yacc 以完成某事。

            回答 #5

赞同：2

时间：2008-12-02T01:18:24.590

我从事使用 Yacc 的项目。不是新代码 - 但如果它们是新代码，它们仍然会使用 Yacc 或近亲（Bison、Byacc、...）。

是的，如果你在 C 中工作，我认为它值得学习。

还可以考虑学习 ANTLR 或其他更现代的解析器生成器。但是 Yacc 的知识对你很有帮助——它也会帮助你学习任何其他类似的工具，因为很多基本理论都是相似的。

            回答 #6

赞同：2

时间：2008-12-02T02:04:53.093

我不具体了解 yacc/bison，但我使用过 antlr、cup、jlex 和 javacc。我认为它们只会具有学术重要性，但事实证明我们需要一种特定于领域的语言，这为我们提供了比一些“更简单”（基于正则表达式）解析器更好的解决方案。但是，在许多环境中，维护可能是一个问题——因为现在大多数编码人员都没有任何解析工具的经验。

            回答 #7

赞同：2

时间：2008-12-02T02:21:47.880

我没有机会将它与其他解析系统进行比较，但我绝对可以根据我自己的经验以及它庞大而活跃的用户群推荐[ANTLR 。](http://www.antlr.org/)

Another plus point for ANTLR is [ANTLRWorks: The ANTLR GUI Development Environment](http://www.antlr.org/works) which is a great help while developing and debugging your grammars. I've yet to see another parsing system which is supported by such an IDE.

            回答 #8

赞同：1

时间：2010-02-09T04:04:16.903

我们正在我的公司编写新的 yacc 代码来运送产品。是的，这个东西还在用。

        ruby - Ruby 获取函数不会多次接受空行

ID：332738

赞同：2

时间：2008-12-02T01:10:42.547

标签：ruby, komodo

我正在尝试编写一个简单的 ruby​​ 函数，它可以提示用户输入一个值，如果用户自己按 ENTER，则使用默认值。在下面的示例中，可以通过单独按 ENTER 来处理对 Prompt 函数的第一次调用，并将使用默认值。但是，我第二次调用 Prompt 并按 ENTER 时，什么也没有发生，事实证明我必须在 ENTER 之前按其他字符才能从“获取”调用返回。

必须有某种方法来刷新输入缓冲区以避免这个问题。有谁知道该怎么做？

谢谢，

大卫

```
def BlankString(aString)
   return (aString == nil) ||
          (aString.strip.length == 0)
end

#Display a message and accept the input
def Prompt(aMessage, defaultReponse = "")
   found = false
   result = ""
   showDefault = BlankString(defaultReponse) ? "" : "(#{defaultReponse})"
   while not found
      puts "#{aMessage}#{showDefault}"
      result = gets.chomp
      result.strip!
      found = result.length > 0
      if !found
         then if !BlankString(showDefault)
                 then
                    result = defaultReponse
                    found = true
              end
      end
   end

   return result
end

foo = Prompt("Prompt>", "sdfsdf")
puts foo

foo = Prompt("Prompt>", "default")
puts foo 
```

            回答 #1

赞同：1

时间：2008-12-02T01:14:31.307

从技术上讲，这不是一个答案，但无论如何它都会对您有所帮助：使用 Highline ( [http://highline.rubyforge.org/](http://highline.rubyforge.org/) )，如果您要进行命令行交互，它将为您省去很多麻烦像这样的界面

            回答 #2

赞同：1

时间：2008-12-02T01:33:56.040

我试过你的代码（在 Windows 下），它似乎工作正常。您使用的是什么操作系统？

            回答 #3

赞同：0

时间：2008-12-02T14:10:25.390

我已经确认（通过在 Komodo 之外运行程序）该问题实际上仅发生在 Komodo 内部。我感谢大家的反馈并花时间进行独立测试（我没有想过）以帮助缩小问题范围。

            回答 #4

赞同：0

时间：2008-12-02T03:08:40.903

我还使用 ruby​​ 1.8.6 尝试了您的代码（在 OSX 下），它运行良好：

```
:! ruby prompt.rb
Prompt>(sdfsdf)

sdfsdf
Prompt>(default)

default 
```

运行以下命令会得到什么？

```
c = gets
b = gets
a = gets
p [ a, b, c ] 
```

我只是按 'Enter' 3x 并得到

```
["\n", "\n", "\n"] 
```

我猜有什么问题是你在你的while语句中进入了一个无限循环，而不是传递它a `defaultResponse`（在一些你实际上正在运行的代码中，这不在你的例子中）。

        javascript - MVC Javascript 错误

ID：332748

赞同：1

时间：2008-12-02T01:15:07.250

标签：javascript, asp.net-mvc, model-view-controller

我已将我的默认页面配置为“abcd.aspx”并且位于 ~/View//abcd.aspx 下，并且我的 javascripts 位于 ~/Contents/Scripts/.js 下

出于某种原因，只有“../Content/Scripts/.js”可用于在页面上包含 js 文件，而“~/Contents/Scripts/.js”则不能。这仅在我使用完整 url 访问页面时有效：http:////controller/action。而且由于这也是默认页面 - 通过默认页面访问此页面会尝试加载脚本，并且图像将被破坏为相对路径“../” - 意味着它将在[http://server/Contents/Scripts](http://server/Contents/Scripts)下查看...

我认为使用“~/”作为相对路径应该可以解决问题，但正如我所提到的，它不适用于完整的 url，也不适用于主默认页面。

请让我知道我应该如何指代这里的路径。

任何帮助将非常感激。

谢谢！

            回答 #1

赞同：3

时间：2008-12-02T01:19:59.033

最简单的方法是使用“/Content/Scripts”，“~/”快捷方式在标准脚本标签中不起作用，并且一旦感知路径随不同路线发生变化，使用相对路径就会中断。

            回答 #2

赞同：2

时间：2008-12-02T03:47:51.357

使用 /Content/Scripts 有效，但是当您将应用程序安装在虚拟目录/应用程序下时会出现问题。如果您正在寻找与 web 表单中相同类型的行为，请尝试使用 Url 帮助器：

<%=Url.Content("~/Content/Scripts/jquery-ui.js")%>"

        javascript - Ajax 网格视图

ID：332752

赞同：0

时间：2008-12-02T01:18:58.880

标签：javascript, gridview

我正在寻找一个 Ajax Grid 控件，它可以很容易地用于使用 js 方法绑定数据。我曾尝试在 AjaxDataControls 中使用 GridView，它还可以——但我也在寻找 gridView 中的多选支持。任何指针将不胜感激。

谢谢。

            回答 #1

赞同：2

时间：2008-12-02T01:46:36.360

看看[ExtJs](http://extjs.com/deploy/dev/examples/grid/binding-with-classes.html)。它有迄今为止我见过的最好的网格。它支持 XML 和 JSON 以及从基本 HTML 表的转换。

            回答 #2

赞同：0

时间：2008-12-02T02:10:26.700

看看 Dojo Grid：

*   [在Dojo 1.2 Grid](http://www.sitepen.com/blog/2008/07/14/dojo-12-grid/)和[Dojo Grid 1.2 的新功能中](http://www.sitepen.com/blog/2008/10/22/new-features-in-dojo-grid-12/)写得很好。
*   [dojox.grid.tests](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/grid/tests/)中有大量代码示例（警告：此链接直接指向 nightlies ⇒ Dojo 代码是为调试目的而打包的，而不是为了性能）。

        .net - ASP.NET MVC：如何使用 . （期间）结束

ID：332757

赞同：14

时间：2008-12-02T01:21:29.547

标签：.net, model-view-controller, routing, period, asp.net-mvc

当我尝试发出搜索词以`.`（句点）结尾的请求时，我收到了来自 .Net MVC 的 404 响应。这是我正在使用的路线：

```
routes.MapRoute(
                "Json",
                "Remote.mvc/{action}/{searchTerm}/{count}",
                new { controller="Remote", count=10}
            ); 
```

搜索`.`在搜索词内部可以正常工作，只是不能以它结束。关于如何路由此搜索请求的任何想法？

            回答 #1

赞同：24

时间：2011-09-29T14:22:40.230

我已经解决了一个类似的问题（我在 /music/REM 之类的路径上遇到了问题）我在 system.webServer/handlers 部分添加了以下行（根据您的情况进行了调整）：

```
 <add name="UrlRoutingHandler" type="System.Web.Routing.UrlRoutingHandler, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" path="Remote.mvc/*" verb="GET"/> 
```

我也注意到，

```
<httpRuntime relaxedUrlToFileSystemMapping="true" /> 
```

仅当句点 (.) 位于斜杠中间的某个位置时（例如 /abc/de/f）才有效，并且当句点看起来像文件类型分隔符时（例如 /abc/de/fg）不起作用。

            回答 #2

赞同：5

时间：2010-08-22T17:34:55.100

如果您使用的是 .NET 4.0，则可以在 web.config 的 system.web 部分设置此标志，并且允许：

```
<httpRuntime relaxedUrlToFileSystemMapping="true" /> 
```

我已经对其进行了测试，并且可以正常工作。[哈克](http://haacked.com/archive/2010/04/29/allowing-reserved-filenames-in-URLs.aspx)对此进行了解释。

        java - 捕获重量级 Java 组件？

ID：332758

赞同：2

时间：2008-12-02T01:21:33.257

标签：java, user-interface, screenshot, jxbrowser

我有一个在 JFrame 中有重量级组件（JxBrowser）的桌面应用程序。如何从 GUI 制作快照并将其保存为例如 png 文件？

注意：使用 Graphics2d 和 Component.paint()/paintAll()/print/printAll 的方法仅适用于轻量级组件。

任何答案表示赞赏！

**编辑**

我已经尝试过这个：

```
robot.createScreenCapture(new Rectangle(Toolkit.getDefaultToolkit().getScreenSize())); 
```

但我希望捕获内部组件......

**编辑**

情况似乎收敛到这个解决方案：如果我的 JFrame 中有一个更大的重量级组件，所以它在 J​​ScrollPane 上呈现，那么就没有其他方法可以通过编程方式获取它的快照，然后用屏幕捕获滚动它/截屏？

            回答 #1

赞同：2

时间：2009-05-18T11:17:30.190

我叫 Roman，是 TeamDev 的开发人员。

JxBrowser 组件它是一个重量级的组件，它嵌入了一个原生的 mozilla 窗口来显示网页。要从 JxBrowser 组件获取完整网页的屏幕截图，您可以真正使用带有网页滚动的 Java Robot 功能。对于小型网页，此解决方案是可以的。但是接收大型网页的屏幕截图会花费很多时间。另请注意，Java Robot 只允许捕获屏幕。因此，如果某个窗口会出现在 JxBroser 组件上，那么它也会被捕获。

我们已经开始在 JxBrowser 项目方面研究这个功能。允许捕获包括其不可见部分在内的完整网页的解决方案是基于 Mozilla 内部的东西。您将能够捕获完整的网页并将其保存为图像非常容易。

我们将在 JxBrowser 库的下一个版本中添加此功能，但尚未确定发布日期。如果您愿意，可以订阅 TeamDev 的 RSS 源：http: [//support.teamdev.com/blogs/feeds/tags/company_news](http://support.teamdev.com/blogs/feeds/tags/company_news)

或者只是让我知道，我会在此功能可用时通知您。如果您有任何其他问题，请告诉我。我很乐意提供帮助。

问候， 罗马

            回答 #2

赞同：1

时间：2008-12-02T01:30:10.417

你的意思是程序化？

关于什么

```
Point p = yourAwtComponent.getLocationOnScreen();
int w   = yourAwtComponent.getWidth();
int h   = yourAwtComponent.getHeight();

Rectangle rectangle = new Rectangle( p.x, p.y, w, h );

Image image = robot.createScreenCapture(rectangle); 
```

然后是这样的：

```
ImageIO.write( image, "png", file ); 
```

            回答 #3

赞同：1

时间：2009-08-13T10:27:43.667

JxBrowser API 提供了允许将整个网页保存为 PNG 图像的功能。请参阅[样本](http://links.teamdev.com/jxbrowser-page-screenshot-sample)。

            回答 #4

赞同：0

时间：2008-12-02T09:50:28.817

你也可以尝试通过实现这个来创建屏幕截图：

```
 int width = frameContainer.getWidth();
    int height = frameContainer.getHeight();

    BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
    Graphics2D g2 = image.createGraphics();

    frameContainer.paint(g2);

    return image; 
```

        html - 在 appengine 中使用带有单选按钮的“onclick”

ID：332766

赞同：13

时间：2008-12-02T01:31:03.147

标签：html, google-app-engine, radio-button, onclick

这是一个代码片段。. .

```
<form name="FinalAccept" method="get"><br>

<input type="radio" name="YesNo" value="Yes" onclick="/accept"> Yes<br>

<input type="radio" name="YesNo" value="No" onclick="/accept"> No<br> 
```

显然，我要做的是在用户单击单选按钮时调用链接到 /accept 的例程。

我知道该例程正在运行，因为我从程序的另一个位置调用了相同的例程。

我正在尝试使用 google appserver 在本地运行它。有什么我想念的吗？

谢谢

            回答 #1

赞同：15

时间：2008-12-02T08:07:25.123

如果您想在用户单击单选按钮时提交整个表单，请尝试以下操作：

```
<form name="FinalAccept" method="get" action="accept"><br>
<input type="radio" name="YesNo" value="Yes" onclick="this.form.submit();"> Yes<br>
<input type="radio" name="YesNo" value="No" onclick="this.form.submit();"> No<br>
</form> 
```

另外，如果你想让你的用户界面更友好一点，把它改成这样：

```
<form name="FinalAccept" method="get" action="accept"><br>
<input id="rYes" type="radio" name="YesNo" value="Yes" onclick="this.form.submit();">
<label for="rYes">Yes</label><br>
<input id="rNo" type="radio" name="YesNo" value="No" onclick="this.form.submit();">
<label for="rNo">No</label><br>
</form> 
```

这将使文本“是”和“否”成为其单选按钮的可点击标签。用户可以单击标签来选择单选按钮。

            回答 #2

赞同：2

时间：2008-12-02T03:39:54.553

您可能正在考虑 form 元素的 action=。onClick 只会触发一个javascript函数。

            回答 #3

赞同：2

时间：2008-12-02T01:35:26.740

您的 onClick 事件需要一些 javascript 代码：

```
onclick="SomeJavaScriptCode" 
```

更多信息：http: [//www.w3schools.com/jsref/jsref_onClick.asp](http://www.w3schools.com/jsref/jsref_onClick.asp)

所以，你应该做这样的事情：

```
onClick="myfunction('my value');" 
```

编辑：当用户单击“是”或“否”时，您似乎想转到一个 URL。为此，您可以尝试这段 javascript 代码：

```
onClick="location.href='http://www.example.com/accept';"
onClick="location.href='http://www.example.com/decline';" 
```

现在，如果您想在用户单击“是”或“否”时自动提交表单，请按照 Benry 的建议进行操作：

```
onClick="this.form.submit();" 
```

希望这可以帮助。

        makefile - 使用 -fPIC 选项重新编译，但该选项已在 makefile 中

ID：332767

赞同：22

时间：2008-12-02T01:31:39.197

标签：makefile, recompile, fpic

制作时出现此错误：

```
relocation R_X86_64_32 against `vtable for Torch::MemoryDataSet' can not be used 
when making a shared object; recompile with -fPIC 
```

它说我应该使用该`-fPIC`选项重新编译。我这样做了，将`-fPIC`选项添加到`CFLAGS`and `CXXFLAGS`，但我仍然得到同样的错误。有没有办法解决这个问题？我已经看到这个问题与使用64位机器有关，而且我使用的是一个。

            回答 #1

赞同：12

时间：2008-12-03T03:22:55.913

我很久以前就遇到过这个问题，如果我没记错的话，修复是在命令行中将 -fPIC 的位置移动到 gcc 之后。完全没有意义，现在更少了，但我记得，这解决了它。

            回答 #2

赞同：5

时间：2013-01-21T15:18:33.523

我遇到了同样的问题，但它有一个额外的转折。@clintm 的答案解决了它，但我想我会在这里描述我对问题的变化以供将来参考......

32 位机器上的 Makefile：

```
CXX=g++
CXXFLAGS= -O3 -Wall
...
...   
%.o:  %.c
    $(CXX)  $(CXXFLAGS)  -fpic  -c  $<      

libmylibrary.so: $(OBJECTS)
    $(CXX) -shared -Wl,-soname,$@ -o $@   $(OBJECTS) 
```

这编译正确。但是当我在 64 位机器上尝试时，相同的 Makefile 失败了。我将“-fpic”更改为“-fPIC”，但仍然失败。我将对象规则更改为：

```
%.o:  %.c
    $(CXX)  -fPIC  $(CXXFLAGS)  -c  $< 
```

它仍然失败。

最后，我在实际的编译器变量中放置了“-fPIC”（现在“-fPIC”出现在每个对象的规则**和**共享库的规则中）：

```
CXX=g++  -fPIC
CXXFLAGS= -g -O3 -Wall
...
%.o:  %.c
        $(CXX)    $(CXXFLAGS)   -c      -o $@    $<   

libalglib.so: $(OBJECTS)
        $(CXX) -shared -Wl,-soname,$@  -o $@      $(OBJECTS) 
```

它奏效了！

            回答 #3

赞同：0

时间：2014-10-03T01:30:52.880

假设您有一些makefile，例如：

```
CFLAGS = -g -Wall
SOURCES = $(wildcard *.c)
OBJECTS = ...

TARGET = libmyawesomelib.a

all: $(TARGET) main 
```

只需像这样添加 -fPIC 标志：

```
$(TARGET): CFLAGS += -fPIC
$(TARGET): $(OBJECTS)
        .
        .
        . 
```

以此类推，其余的makefile。

            回答 #4

赞同：0

时间：2017-02-17T08:39:35.153

我在 CentOS 7 机器上交叉编译 shadowsocks-libev，同样的问题发生在我身上，它在我的笔记本电脑上完美运行

```
CC=mipsel-unknown-linux-uclibc-gcc CXX=mipsel-unknown-linux-uclibc-g++ AR=mipsel-unknown-linux-uclibc-ar RANLIB=mipsel-unknown-linux-uclibc-ranlib make SHARED=1 CFLAGS=-fPIC 
```

但是在 travis ci 上，它不起作用，我必须将 -fPIC 添加到 CC 和 CXX 才能使其工作

```
CC="mipsel-unknown-linux-uclibc-gcc -fPIC" CXX="mipsel-unknown-linux-uclibc-g++ -fPIC" AR=mipsel-unknown-linux-uclibc-ar RANLIB=mipsel-unknown-linux-uclibc-ranlib make SHARED=1 
```

            回答 #5

赞同：0

时间：2015-10-12T01:53:48.153

我在使用 android-ndk 工具链进行交叉编译时遇到了这个问题。我最终不得不使用

```
CC="$CROSS/bin/arm-linux-androideabi-gcc -pie --sysroot=$SYSROOT" 
```

在这种情况下，既不适合我，`-fPIC`也不适合我。`-fPIE`

            回答 #6

赞同：0

时间：2018-06-21T18:44:34.527

我升级 gcc 后遇到了这个问题。我有一个 .o 文件（sqlite）没有被 Makefile 清理，因此我遇到了这个问题（假设因为它是用旧版本的 gcc 编译的）。删除该文件并重建后，此错误消失了。

            回答 #7

赞同：-1

时间：2013-04-18T12:31:22.123

如果您要编译的项目具有正确的配置脚本，请使用如下：

```
$ ./configure 'CFLAGS=-g -O2 -fPIC ....' --enable-some-thing 
```

所以标志将是Makefile的所有规则......

几天前我需要一个老版本。VLC 在 x64 机器上编译，它有一个很好的配置脚本；-)

        php - 即使我将字符集和排序规则设置为 utf8_unicode_ci，phpmyadmin 也会将日文字符显示为一堆问号

ID：332781

赞同：1

时间：2008-12-02T01:39:30.397

标签：php, mysql, phpmyadmin, character-encoding, collation

okee，我按照我可以在[这里](https://stackoverflow.com/questions/279170/utf-8-all-the-way-through)找到的所有说明进行操作
，我可以在我的页面上显示各种多语言字符...

问题是在 phpmyadmin 中，日文字符被问号替换，就像一堆`???? ???`拼凑在一起的那样。我认为我的数据库的排序规则有问题，但我只是想在这里验证一下。

我们之前已经在默认排序规则上设置了这个数据库，`latin_swedish_ci`
并且它已经有很多数据。现在我们必须添加一些需要支持特殊字符的表，所以我绝对不能将数据库的排序规则设置为`utf8`. 我的解决方案是`utf8`仅在需要此类支持的表和我们期望包含特殊字符的特定列上使用。

但 phpmyadmin 仍然将它们显示为`????`.

我的另一个问题是这些字段可以搜索吗？

我的意思是，如果该字段包含一些日文字符并且我输入`sayuri`了关键字，日文字符是否会等同于它们用英语发音的音节？

            回答 #1

赞同：1

时间：2008-12-02T02:03:06.357

嗯，关于你的第一个问题，你的系统上安装了日文字体吗？大多数操作系统默认情况下都没有安装它们，但我不知道你的操作系统是什么。下一个很傻，但是您的浏览器设置好吗？

下一个问题，答案是否定的，如果你搜索吉永小百合，它不会匹配到吉永小百合。

注意：你能看到我的日文字符吗？

            回答 #2

赞同：0

时间：2011-08-02T09:44:51.057

我有类似的问题，如果你的标题是正确的。建立数据库连接后，请使用：

```
mysqli_set_charset ( $mysqli,'utf8'); 
```

或者

```
$mysqli->set_charset("utf8"); 
```

            回答 #3

赞同：-1

时间：2008-12-02T01:47:35.360

问题是您的连接排序规则未设置为 utf-8（很可能是 latin1），您需要显示日文字符。您可以通过发出查询手动设置它：

```
SET CHARACTER SET utf8;
SET NAMES utf8; 
```

或者在你的 MySQL 配置文件中：

```
default-character-set=utf8
skip-character-set-client-handshake 
```

        crystal-reports - 逆向工程 Crystal Reports 定义文件

ID：332787

赞同：10

时间：2008-12-02T01:41:47.150

标签：crystal-reports

我们正在中央元数据存储库中创建报告定义的元模型。我们知道如何“收集”SSRS 报告，因为它们是 XML。是否有任何简单的方法可以为 Crystal Reports 做同样的事情。我们有兴趣了解 CR 对报告的理解（在概念上类似于 SSRS RDL 模型）

TIA，保罗

            回答 #1

赞同：4

时间：2010-02-26T20:49:48.940

使用 Crystal Reports SDK（Java 或 .Net 版本）将对象层次结构转换为 XML 表示。

样品：

*   Visual Basic .Net：   [RptToXml](http://code.google.com/p/rpttoxml/)
*   C# .Net：[RptToXml](https://github.com/ajryan/RptToXml)
*   PowerShell：[PsCrystal](https://github.com/craibuc/PsCrystal)

            回答 #2

赞同：4

时间：2008-12-10T21:59:24.207

如果您将水晶报告导出为...您猜对了“报告定义（TXT）”，您可以获得报告定义文本文件它具有水晶版本和每个部分的大量信息，例如数据字段，格式等...

            回答 #3

赞同：2

时间：2009-08-26T21:09:49.057

检查[http://www.reportminer.com/](http://www.reportminer.com/)，它包括一个 diff 工具（尽管在导出为文本后，您可以使用您选择的 diff'er）。

            回答 #4

赞同：0

时间：2008-12-04T16:15:50.033

我曾经使用过这样的东西来调试水晶问题，它可能会有所帮助：

[rpt检查员](http://crystal-enterprise-tool.qarchive.org/)

            回答 #5

赞同：0

时间：2008-12-02T04:36:36.610

AFAIK，没有办法做到这一点。CR 文件采用封闭的专有格式。:-(

            回答 #6

赞同：0

时间：2010-05-28T17:11:25.173

RptToRdl.Com [(http://www.RptToRdl.com)](http://www.rpttordl.com)将为您提供 25 美元的服务。查看他们的常见问题解答，您可以免费完成一个。

        .net - 保持树视图的滚动位置

ID：332788

赞同：21

时间：2008-12-02T01:42:43.403

标签：.net, winforms, treeview

如何在 .NET 应用程序中保持树视图控件的滚动位置？例如，我有一个树形视图控件，并经历了一个向其添加各种节点的过程，并将它们固定在底部。在此过程中，我可以滚动浏览树视图并查看不同的节点。问题是当过程完成时，树视图滚动到最底部。

看来调用 treenode.Expand() 是让我偏离轨道的原因。当父节点展开时，它会获得焦点。

有没有解决的办法？如果我在进程运行时查看特定节点，我不希望它在进程完成后跳到我身上。

            回答 #1

赞同：29

时间：2008-12-11T16:13:43.577

我不是 VB 人，但在 C# 中我是这样做的：
**一些 Win32 原生函数：**

```
[DllImport("user32.dll",  CharSet = CharSet.Unicode)]
public static extern int GetScrollPos(IntPtr hWnd, int nBar);

[DllImport("user32.dll",  CharSet = CharSet.Unicode)]
public static extern int SetScrollPos(IntPtr hWnd, int nBar, int nPos, bool bRedraw);

private const int SB_HORZ = 0x0;
private const int SB_VERT = 0x1; 
```

**返回当前滚动位置的点的方法：**

```
private Point GetTreeViewScrollPos(TreeView treeView)
{
    return new Point(
        GetScrollPos(treeView.Handle, SB_HORZ), 
        GetScrollPos(treeView.Handle, SB_VERT));
} 
```

**设置滚动位置的方法：**

```
private void SetTreeViewScrollPos(TreeView treeView, Point scrollPosition)
{
    SetScrollPos(treeView.Handle, SB_HORZ, scrollPosition.X, true);
    SetScrollPos(treeView.Handle, SB_VERT, scrollPosition.Y, true); 
} 
```

**然后，当您更新树时，请执行以下操作：**

```
BeginUpdate();
Point ScrollPos = GetTreeViewScrollPos(treeMain);
// write your update code here
SetTreeViewScrollPos(treeMain, ScrollPos);
EndUpdate(); 
```

            回答 #2

赞同：18

时间：2008-12-02T02:18:16.420

我想我想通了：

1.  获取树视图顶部的节点。
2.  展开父节点。
3.  使之前位于顶部的节点可见。

```
If treeNodeParent.IsExpanded = False Then
    Dim currentNode As TreeNode = TreeViewHosts.GetNodeAt(0, 0)
    treeNodeParent.Expand()
    currentNode.EnsureVisible()
End If 
```

这是更好的方法吗？

            回答 #3

赞同：7

时间：2012-05-22T02:41:42.907

无需外部函数即可保留滚动位置的另一种方法是使用树的 TopNode 属性...

TopNode 获取或设置树视图控件中的第一个完全可见的树节点。

如果您只想扩展一个节点并让它保留顶部节点：

```
TreeNode topNode = m_Tree.TopNode;
treenode.Expand();
m_Tree.TopNode = topNode; 
```

否则，如果您正在重建树（例如刷新文件结构），则可以使用以下方法...

在清除树之前，存储到顶部节点的完整路径：

```
string topNodePath = null;
TreeNode topNode = null;
if (m_Tree.TopNode != null)
{
    topNodePath = m_Tree.TopNode.FullPath;
}

m_Tree.Clear(); 
```

添加节点后，对照 topNodePath 检查其 FullPath：

```
nodes.Add(node)
if ((topNodePath != null) && (node.FullPath == topNodePath))
{
    topNode = node;
} 
```

添加所有节点后，更新树的 TopNode 属性：

```
if (topNode != null)
{
    m_Tree.TopNode = topNode;
} 
```

我对选定和扩展的节点使用了类似的技术。SelectedNode 的工作方式几乎与上面显示的 TopNode 完全相同。对于扩展节点，我使用递归函数循环遍历子节点并将扩展节点的路径添加到列表中。然后在添加子项后根据它们的路径扩展它们。

当然，如果你有很多同名的兄弟节点，这可能也不起作用:-)

            回答 #4

赞同：3

时间：2010-02-25T14:54:47.943

我发现最好`SetTreeViewScrollPosition(point)`用一个`BeginUpdate`和`EndUpdate`...

```
private void treeViewXml1_Scroll(object sender, ScrollEventArgs e)
{
    Point point = treeViewXml1.GetTreeViewScrollPosition();

    treeViewXml2.BeginUpdate();
    treeViewXml2.SetTreeViewScrollPosition(point);
    treeViewXml2.EndUpdate();
}

private void treeViewXml2_Scroll(object sender, ScrollEventArgs e)
{
    Point point = treeViewXml2.GetTreeViewScrollPosition();

    treeViewXml1.BeginUpdate();
    treeViewXml1.SetTreeViewScrollPosition(point);
    treeViewXml1.EndUpdate();
} 
```

            回答 #5

赞同：1

时间：2011-01-11T10:23:30.773

我也有同样的问题，滚动本身更新了，但是树视图的内容没有滚动。这很容易通过添加`BeginUpdate()`and `EndUpdate()`around 来解决`SetScrollPos()`。

```
this.hierarchyTreeView.BeginUpdate();
SetScrollPos(this.hierarchyTreeView.Handle, SB_VERT, 5, true);
this.hierarchyTreeView.EndUpdate(); 
```

            回答 #6

赞同：0

时间：2012-03-08T20:53:52.870

```
myTreeView.Nodes[0].EnsureVisible(); 
```

            回答 #7

赞同：0

时间：2014-08-22T13:06:22.997

它是对 Stefan Koell 的漂亮响应的修订，作为 TreeViewExtension：（完整解决方案）

```
using System;
using System.Runtime.InteropServices;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Interop;
using System.Windows.Media;

public static class TreeViewExtension
{
    #region Constants

    private const int ScrollBarHorizontal = 0x0;

    private const int ScrollBarVertical = 0x1;

    #endregion

    #region Public Methods and Operators

    [DllImport("user32.dll", CharSet = System.Runtime.InteropServices.CharSet.Auto)]
    public static extern int GetScrollPos(int hWnd, int nBar);

    public static Point ScrollPosition(this TreeView treeView)
    {
        return new Point(
            GetScrollPos((int)treeView.Handle(), ScrollBarHorizontal), 
            GetScrollPos((int)treeView.Handle(), ScrollBarVertical));
    }

    public static void ScrollTo(this TreeView treeView, Point scrollPosition)
    {
        SetScrollPos(treeView.Handle(), ScrollBarHorizontal, (int)scrollPosition.X, true);
        SetScrollPos(treeView.Handle(), ScrollBarVertical, (int)scrollPosition.Y, true);
    }

    [DllImport("user32.dll")]
    public static extern int SetScrollPos(IntPtr hWnd, int nBar, int nPos, bool bRedraw);

    #endregion

    #region Methods

    private static IntPtr Handle(this Visual treeView)
    {
        var handle = IntPtr.Zero;
        var hwndSource = PresentationSource.FromVisual(treeView) as HwndSource;
        if (hwndSource != null)
        {
            handle = hwndSource.Handle;
        }

        return handle;
    }

    #endregion
} 
```

也许它简化了你的工作;-)

            回答 #8

赞同：0

时间：2018-12-26T19:27:44.880

这工作正常。保存 TopNode 并在之后恢复：

```
this.treeView.BeginUpdate();
TreeNode topNode = this.treeView.TopNode;

// your code
this.treeView.Sort();
this.treeView.SelectedNode = auxNode;

this.treeView.TopNode = topNode;
this.treeView.EndUpdate(); 
```

            回答 #9

赞同：-3

时间：2013-05-06T05:54:57.377

最好的办法是使用 UpdatePanel 并将您的树视图标签嵌套在其中。例如，

```
<asp:UpdatePanel id="UpdatePanel">
     <ContentTemplate>
         <asp:TreeView id="TreeView">

         </asp:TreeView>
     </ContentTemplate>
</asp:UpdatePanel> 
```

它对我有用，我希望它能解决你的问题。

        user-interface - 输入时的通用过滤器（又名预输入、增量查找、自动完成）是否存在？

ID：332789

赞同：1

时间：2008-12-02T01:43:07.567

标签：user-interface, autocomplete, filtering

背景

最近我变得狂热，我在电脑上工作时输入的*所有内容都*应该与["DRY"](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself)兼容。如果在任何情况下我必须多次输入任何内容，我想要某种用户感知的自动完成选项来为我完成一些工作——总是——没有例外。

由于必须在 Windows 下工作，我研究了 GUI 解决方案以使这个疯狂的目标成为现实。

（几乎）最优解

如果您有时间，请打开 Firefox 3.0 并在地址栏中键入几个键。您会注意到它会根据您键入的任何空格分隔的子字符串执行一种[增量](http://en.wikipedia.org/wiki/Incremental_find) [自动完成。](http://en.wikipedia.org/wiki/Autocomplete)Firefox 中另一个类似的地方是`about:config`URL。

这是次优的，因为我不想只在 Firefox 中使用它。我想在任何地方都使用它。

问题

有没有人知道一个小部件或应用程序除了可以用作通用“到处运行”工具的非常好的增量自动完成*之外什么都不做？*允许用户： 1) 维护一个或多个“完成候选文件”；2) 选择其中一个文件作为 Firefox 3.0 样式完成的源；3）返回结果（如果用户取消，则返回空白），只做这三件事？

细节

这是它应该如何工作的：

*   第 1 步：用户在他的硬盘驱动器某处保存或更多 csv 文件（或其他易于编辑的格式）
*   STEP2：用户创建一个 Windows Script Host 脚本或一个批处理文件（或其他）实例化 FilterAsYouType GUI
*   STEP3：用户运行脚本文件，脚本文件实例化 GUI，告诉它使用哪个 CSV 文件作为所有潜在完成的来源
*   STEP4：用户要么选择一个完成，提供他自己不在列表中的文本，要么取消而不提供任何内容
*   STEP5：当用户完成后，脚本将结果保存到一个变量中并对其进行处理

这是脚本的一些伪代码：

```
include "GenericTypeaheadWidget";

var gengui = new GenericTypaheadWidget('c:\docs\favorite_foods.csv');
var fave_food = gengui.get_user_input();
if(fave_food != ''){
    alert('you chose '+fave_food+'!');
} 
```

基本原理

目标是有一种方法*总是*能够从任意项目列表中自动完成，即使列表是几千个项目，也不必依赖它被构建到某些 IDE 或独立应用程序中仅接受某些类型的输入或相对于此任务的简单性而言具有过于复杂的 API。

CSV（或文本或 sqlite 数据库）将为我提供一种自行生成“候选人列表”或“历史日志”的方法，然后将这些日志用作可能完成的来源。

免责声明

我已经尝试了几个 GUI“启动器”程序、命令行引擎（如 power-shell 和脚本 shell）、常规的普通旧命令行历史，并具有不同程度的满意度。这些的问题是它们都做了额外的多余的东西，比如搜索目录或内置命令。我只想要我碰巧指向的 CSV 文件中的任何内容。

我想知道是否有任何*简单的*工具除了我上面描述的内容之外什么都不做。

**更新：**看起来这个问题与[Graphical Command Shell](https://stackoverflow.com/questions/30318/where-can-i-find-a-graphical-command-shell)密切相关，它抓住了这里提出的基本思想。

            回答 #1

赞同：1

时间：2009-01-03T07:18:10.400

你真的应该试试[Launchy——](http://www.launchy.net/)它正是你想要的，一个具有智能自动完成功能的“运行任何东西”。它彻底改变了您与 Windows PC 交互的方式。

它有开源代码，所以如果你想滚动你自己的界面，你可以借用它的自动完成代码。

        xml - 我可以让一个 XML 架构 (XSD) 包含另一个 XML 架构吗？

ID：332792

赞同：40

时间：2008-12-02T01:45:54.300

标签：xml, xsd, include

我目前有两个 XSD 方案，一个是另一个的“轻量级”版本。现在我在“完整”模式中重复了“轻”版本中的所有内容，但是当我需要进行更改时这会变得很痛苦，并且无论如何它都违反了 DRY 原则，所以我想知道是否有一个元素这有助于将另一个模式包含到模式中，因此我可以让我的“完整”继承自“轻”模式以减少维护障碍。

            回答 #1

赞同：59

时间：2009-01-28T21:09:20.697

有两种方法。

`<xsd:include schemaLocation="pathToFile" />`应该用于包含相同命名空间的文件。

`<xsd:import namespace="namespace" schemaLocation="pathToFile" />`应该用于包含不同命名空间中的文件。通常，您会将给定的命名空间指定为导入模式的 targetNamespace。

            回答 #2

赞同：5

时间：2008-12-02T02:51:35.417

使用 <include> 元素，请参见[此处](https://www.w3schools.com/xml/el_include.asp)的示例。

        security - 从带有公共站点的 js 访问 127.0.0.1 上的网络服务器的陷阱

ID：332794

赞同：3

时间：2008-12-02T01:47:01.850

标签：security, web-applications, hardware

我正在考虑探索让我们的客户端软件作为服务在高端口上运行并侦听来自 127.0.0.1 的简​​单 http GET 请求的想法。理论上，我可以通过 js 从我的网站提供的网页访问此服务。

1) 用户安装客户端软件，将自身安装为服务并在 127.0.0.1:8080 上等待经过身份验证的请求

2）当用户点击我的主页时页面上的js向127.0.0.1:8080发出xhtml请求并询问状态

3) 然后主页向我的 Web 服务器发出另一个 js 请求，发送它收到的状态。

这将允许我的用户从浏览器实时上传/下载和编辑 USB 连接设备上的文件。轮询可能是类似于我们今天所做的后备方法。

有没有人这样做，有什么潜在的陷阱？这甚至会起作用吗？

            回答 #1

赞同：3

时间：2008-12-02T03:16:26.990

我看不到任何潜在的陷阱。不过，我确实有几点。

1/ 您可能希望确保您的服务仅接受来自本地计算机 (127.0.0.1) 的传入连接。否则，任何人都可以查看您的 JavaScript 并确定它正在与 [your-ip]:8080 通信。然后他们可以从远程站点（安全漏洞）自己尝试。

2/ 我不会使用端口 8080，因为它通常用于其他事情（备用 HTTP 服务器等）。使其可配置并选择一个不错的高随机类型值。

3/ 我不确定您要对第 3 点做什么，但我**认为**您正试图将状态发送回用户。在这种情况下，为什么您主页上的 JavaScript 不能在单个会话中获取状态并输出/更新要呈现给用户的 HTML？您的“另一个 js 请求返回到我的 Web 服务器”对我来说没有意义。

            回答 #2

赞同：1

时间：2008-12-02T03:24:30.593

您可能无法向 127.0.0.1 发出 xml http 请求，因为 XMLHTTPRequest 通常仅限于与提供主要内容的域相同的域。如果服务器位于客户端计算机上，我不确定此限制是否适用。话虽如此，您仍然可以创建一个`<script>`src 指向 127.0.0.1 的标签，并让 Web 服务器返回一些 Javascript 来运行。如果您只需要一个简单的响应，这可能会很好。

            回答 #3

赞同：0

时间：2008-12-02T03:29:00.257

我认为最好避免在 JavaScript 和 html 中实现应用程序逻辑。一旦用户单击网页上的按钮，JavaScript 应该向您的服务发送请求并允许它完成其余的工作。

            回答 #4

赞同：0

时间：2008-12-02T08:23:03.657

根据您的目标用户群，您可能会遇到第 1 步（客户端自行安装）的问题。

您需要为每个支持的环境（Win2K、Vista、Linux、MAC OS 9.0/10.0 等）进行自定义安装。
如果您的用户在工作 PC 上被锁定，则根本不允许这样做。
对于某些用户来说，这可能看起来与木马非常相似，除非您明确指出您将安装作为服务运行的软件。
您没有提到卸载程序。用户讨厌“Adobe”之类的软件，它可以自行安装并且不提供任何明智的卸载选项
否则，这种方法是合理的，并且有几个商业产品正是使用这种方法！

        mysql - 相当于 MySQL 中的 varchar(max)？

ID：332798

赞同：197

时间：2008-12-02T01:49:36.760

标签：mysql, varchar

MySQL 中 varchar(max) 的等价物是什么？

            回答 #1

赞同：219

时间：2008-12-02T01:55:28.930

varchar 的最大长度取决于 MySQL 中的最大行大小，即 64KB（不包括 BLOB）：

```
VARCHAR(65535) 
```

但是，请注意，如果您使用多字节字符集，则限制会更低：

```
VARCHAR(21844) CHARACTER SET utf8 
```

这里有些例子：

最大行大小为 65535，但 varchar 还包含一个或两个字节来编码给定字符串的长度。因此，您实际上不能声明最大行大小的 varchar，即使它是表中的唯一列。

```
mysql> CREATE TABLE foo ( v VARCHAR(65534) );
ERROR 1118 (42000): Row size too large. The maximum row size for the used table type, not counting BLOBs, is 65535\. This includes storage overhead, check the manual. You have to change some columns to TEXT or BLOBs 
```

但是如果我们尝试减小长度，我们会发现最大的长度：

```
mysql> CREATE TABLE foo ( v VARCHAR(65532) );
Query OK, 0 rows affected (0.01 sec) 
```

现在，如果我们尝试在表级别使用多字节字符集，我们会发现它会将每个字符计为多个字节。UTF8 字符串*不一定*每个字符串使用多个字节，但 MySQL 不能假设您将所有未来的插入限制为单字节字符。

```
mysql> CREATE TABLE foo ( v VARCHAR(65532) ) CHARSET=utf8;
ERROR 1074 (42000): Column length too big for column 'v' (max = 21845); use BLOB or TEXT instead 
```

尽管最后一个错误告诉我们，InnoDB 仍然不喜欢 21845 的长度。

```
mysql> CREATE TABLE foo ( v VARCHAR(21845) ) CHARSET=utf8;
ERROR 1118 (42000): Row size too large. The maximum row size for the used table type, not counting BLOBs, is 65535\. This includes storage overhead, check the manual. You have to change some columns to TEXT or BLOBs 
```

如果您计算出 21845*3 = 65535，那么这完全有道理，无论如何这都行不通。而 21844*3 = 65532，确实有效。

```
mysql> CREATE TABLE foo ( v VARCHAR(21844) ) CHARSET=utf8;
Query OK, 0 rows affected (0.32 sec) 
```

            回答 #2

赞同：81

时间：2008-12-02T02:49:34.780

**TLDR；**MySql 没有等效的概念`varchar(max)`，这是 MS SQL Server 的一个特性。
什么是 VARCHAR（最大值）？
`varchar(max)`是 Microsoft SQL Server 的一项功能。
在 2005 版之前的 Microsoft SQL Server 版本中，列可以存储的数据量限制为 8KB。为了存储超过 8KB 的数据，您必须使用`TEXT`、`NTEXT`或`BLOB`列类型，这些列类型将它们的数据存储为与表数据页分开的 8K 页的集合；他们支持每行最多存储 2GB。
对这些列类型的最大警告是，它们通常需要特殊的函数和语句来访问和修改数据（例如`READTEXT`、`WRITETEXT`和`UPDATETEXT`）
在 SQL Server 2005 中，`varchar(max)`引入了统一用于检索和修改大列中数据的数据和查询。列的数据`varchar(max)`与表数据页内联存储。
当 MAX 列中的数据填满 8KB 数据页时，会分配一个溢出页，前一页指向它，形成一个链表。与`TEXT`,`NTEXT`和不同`BLOB`，`varchar(max)`列类型支持所有与其他列类型相同的查询语义。
所以`varchar(MAX)`真的意味着`varchar(AS_MUCH_AS_I_WANT_TO_STUFF_IN_HERE_JUST_KEEP_GROWING)`而不是`varchar(MAX_SIZE_OF_A_COLUMN)`。
MySql 没有等效的成语。
为了获得与`varchar(max)`MySql 中相同的存储量，您仍然需要使用`BLOB`列类型。[本文](https://web.archive.org/web/20081224081815/http://www.dreamwerx.net/phpforum/?id=1)讨论了一种在MySql中高效存储大量数据的非常有效的方法。

            回答 #3

赞同：32

时间：2008-12-02T03:42:42.677

varchar 的最大长度是

65535

除以该列设置为的字符集中字符的最大字节长度（例如，utf8=3 字节，ucs2=2，latin1=1）。

减去 2 个字节来存储长度

减去所有其他列的长度

每 8 个可为空的列减去 1 个字节。如果您的列为空/非空，则将其存储为一个字节/字节中的一位，称为空掩码，每列一位可以为空。

            回答 #4

赞同：5

时间：2016-12-02T11:18:13.177

对于 Sql 服务器

更改表 prg_ar_report_colors 添加 Text_Color_Code VARCHAR(max);

对于 MySQL

更改表 prg_ar_report_colors 添加 Text_Color_Code 长文本；

对于甲骨文

更改表 prg_ar_report_colors 添加 Text_Color_Code CLOB；

            回答 #5

赞同：1

时间：2015-06-11T08:32:56.613

Mysql 在限制大小时将列从 VARCHAR 转换为 TEXT ！！！

```
mysql> CREATE TABLE varchars1(ch3 varchar(6),ch1 varchar(3),ch varchar(4000000))
;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> SHOW WARNINGS;
+-------+------+---------------------------------------------+
| Level | Code | Message                                     |
+-------+------+---------------------------------------------+
| Note  | 1246 | Converting column 'ch' from VARCHAR to TEXT |
+-------+------+---------------------------------------------+
1 row in set (0.00 sec)

mysql> 
```

            回答 #6

赞同：-14

时间：2014-06-18T15:23:21.827

MySQL 5.6.12 中 varchar 的最大长度为 4294967295。

        regex - 有用的正则表达式教程

ID：332800

赞同：8

时间：2008-12-02T01:50:54.837

标签：regex, grep

有没有关于使用正则表达式的好教程，尤其是[grep](http://en.wikipedia.org/wiki/Grep)？我试着用谷歌搜索了一些，但大多数教程都太基础了，涵盖了我已经知道的东西。

            回答 #1

赞同：6

时间：2008-12-02T01:58:01.267

[Regular-expressions.info 有一个教程部分](http://www.regular-expressions.info/tutorial.html)。尽管重点是对脚本和编程语言的支持，但该站点对于一般的正则表达式来说非常全面。

[J. Friedl 关于掌握正则表达式](https://rads.stackoverflow.com/amzn/click/com/0596528124)的书（在其他地方提到过）绝对是一本出色的资源，如果你认真地按照标题所说的去做，这是一本**必不可少的读物。**

任何经常使用正则表达式的人，或者作为他们工作的一部分，都会很好地拿起这本书。在 regex-land 中浏览教程并不能真正提高熟练度。

            回答 #2

赞同：1

时间：2008-12-02T01:54:12.490

[这](http://cs.senecac.on.ca/~ctyler/regexps/regexps1.pdf)是一篇介绍性文章。[这里](http://www.dmoz.org/Computers/Programming/Languages/Regular_Expressions/FAQs,_Help,_and_Tutorials/)有一些其他的教程。

权威的书是J. Friedl 的[Mastering Regular Expressions](https://rads.stackoverflow.com/amzn/click/com/0596528124)：

[替代文字 http://ecx.images-amazon.com/images/I/51fSgodb1uL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA240_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/51fSgodb1uL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA240_SH20_OU01_.jpg)

        .net - 显式实现接口时装箱的成本有多大

ID：332803

赞同：2

时间：2008-12-02T01:54:57.950

标签：.net, xml, explicit-interface

当前显式成员实现的指导方针建议：

*   使用显式成员来近似私有接口实现。*如果您仅出于基础设施的原因需要实现一个接口，并且您**从不**期望开发人员直接从该类型调用该接口上的方法，那么显式地实现成员以“隐藏”它们对公共视图*。
*   公开一种替代方法来访问允许子类覆盖的任何显式实现的成员。

一个很好的例子是当您想要实现[IXmlSerializable](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.aspx)接口时。**ReadXml**和**WriteXml**方法应由 XmlSerializer 调用，通常不由开发人员直接调用。

当提供另一种方法来访问您希望允许被覆盖的显式成员时，调用显式实现的成员以避免代码重复似乎是有意义的。考虑以下：

```
using System;
using System.Xml;
using System.Xml.Schema;
using System.Xml.Serialization;

namespace Demo
{
    /// <summary>
    /// Demonstrates explicit implementation of the IXmlSerializable interface.
    /// </summary>
    [Serializable(), XmlRoot(ElementName = "foo")]
    public class Foo : IXmlSerializable
    {
        //============================================================
        //  IXmlSerializable Implementation
        //============================================================
        #region GetSchema()
        /// <summary>
        /// Returns an <see cref="XmlSchema"/> that describes the XML representation of the object.
        /// </summary>
        /// <returns>
        /// An <see cref="XmlSchema"/> that describes the XML representation of the object that is 
        /// produced by the <see cref="IXmlSerializable.WriteXml(XmlWriter)"/> method and consumed by the <see cref="IXmlSerializable.ReadXml(XmlReader)"/> method.
        /// </returns>
        /// <remarks>This method is reserved and should not be used.</remarks>
        XmlSchema IXmlSerializable.GetSchema()
        {
            return null;
        }
        #endregion

        #region ReadXml(XmlReader reader)
        /// <summary>
        /// Generates an object from its XML representation.
        /// </summary>
        /// <param name="reader">The <see cref="XmlReader"/> stream from which the object is deserialized.</param>
        /// <exception cref="ArgumentNullException">The <paramref name="reader"/> is a <b>null</b> reference (Nothing in Visual Basic).</exception>
        void IXmlSerializable.ReadXml(XmlReader reader)
        {
            // Class state values read from supplied XmlReader
        }
        #endregion

        #region WriteXml(XmlWriter writer)
        /// <summary>
        /// Converts an object into its XML representation.
        /// </summary>
        /// <param name="writer">The <see cref="XmlWriter"/> stream to which the object is serialized.</param>
        /// <exception cref="ArgumentNullException">The <paramref name="writer"/> is a <b>null</b> reference (Nothing in Visual Basic).</exception>
        void IXmlSerializable.WriteXml(XmlWriter writer)
        {
            // Current class state values written using supplied XmlWriter
        }
        #endregion

        //============================================================
        //  Public Methods
        //============================================================
        #region WriteTo(XmlWriter writer)
        /// <summary>
        /// Saves the current <see cref="Foo"/> to the specified <see cref="XmlWriter"/>.
        /// </summary>
        /// <param name="writer">The <see cref="XmlWriter"/> stream to which the <see cref="Foo"/> is serialized.</param>
        /// <exception cref="ArgumentNullException">The <paramref name="writer"/> is a <b>null</b> reference (Nothing in Visual Basic).</exception>
        public void WriteTo(XmlWriter writer)
        {
            writer.WriteStartElement("foo");

            ((IXmlSerializable)this).WriteXml(writer);

            writer.WriteEndElement();
        }
        #endregion
    }
} 
```

我的问题是关于此实现中**WriteXml**方法的装箱有多昂贵。*((IXmlSerializable)this).WriteXml(writer)*会显着影响性能吗？

            回答 #1

赞同：5

时间：2008-12-02T02:03:22.567

在您的示例中没有发生装箱......它只是一个演员表，它在编译时是可解析的，所以它根本不应该对性能产生任何影响。

**编辑：**用 ILDASM 查看它，接口转换将为您提供虚拟方法调用而不是常规方法调用，但这可以忽略不计（仍然不涉及装箱）。

**编辑2：**如果您使用结构而不是类，那么您将获得一个通过界面的框，性能损失更大。

            回答 #2

赞同：3

时间：2008-12-02T02:02:26.560

不，将一堆数据写入 XmlWriter 的成本将使装箱成本相形见绌。

拳击包括：

1.  从 GC 分配一块内存
2.  使用正确的类型信息初始化其标头
3.  将值类型数据复制到堆内存中

因此，它与对象构造大致相同。如果您正在写入 XmlWriter 的单个数据还不是字符串，那么无论如何您都必须支付此成本来构造要写入的字符串。

            回答 #3

赞同：1

时间：2008-12-02T02:04:09.663

为什么不让它们都调用一个私有方法来执行显式实现的接口的功能呢？

```
public void IXmlSerializable.WriteXml( XmlWriter writer )
{
    InternalWriteXml( writer );
}

public void WriteTo(XmlWriter writer)
{
    writer.WriteStartElement("foo");

    InternalWriteXml(writer);

    writer.WriteEndElement();
}

private void InternalWriteXml( XmlWriter writer )
{
    ...
} 
```

        language-agnostic - 程序编程与 OOP 的开发成本？

ID：332808

赞同：10

时间：2008-12-02T01:56:08.603

标签：language-agnostic, oop, procedural-programming

我来自相当强大的 OO 背景，OOD 和 OOP 的好处是我的第二天性，但最近我发现自己在一家开发商店，与程序编程习惯有关。实现语言有一些 OOP 特性，它们没有以最佳方式使用。

更新：每个人似乎都对这个话题有意见，我也是，但问题是：

**有没有比较好的比较研究来对比使用过程编程语言和面向对象语言的软件开发成本？**

一些评论者指出了将苹果与橙子进行比较的可疑性质，我同意准确测量将非常困难，但也许并非完全不可能。

            回答 #1

赞同：12

时间：2008-12-08T01:57:12.323

大多数所有这些问题都被单个程序员的生产力变化一个数量级或更多的问题所混淆。如果您碰巧有一个 OO 程序员，他是生产力 x 的组之一，而“程序”程序员是 10 倍程序员，那么即使 OO 在某种意义上更快，程序程序员也有可能获胜。

还有一个问题是，编码生产力通常只占实际项目总工作量的 10-20%，因此更高的生产力并没有太大影响；即使是假设的 10 倍程序员或无限快的程序员，也无法将整体工作量减少 10-20% 以上。

你可以看看 Fred Brooks 的论文[“No Silver Bullet”](http://en.wikipedia.org/wiki/No_Silver_Bullet)。

            回答 #2

赞同：6

时间：2008-12-08T02:53:40.820

面向对象或程序提供不同的开发方式，如果管理不善，两者都可能代价高昂。

如果我们假设在这两种情况下工作都是由最好的人完成的，我认为结果可能在成本方面是相等的。

我相信成本差异将取决于您将如何进入需要添加功能和修改当前功能**的维护阶段。**程序化项目更难进行自动测试，在不影响其他部分的情况下更难以扩展，并且更难逐部分理解概念（因为没有必要将内聚部分组合在一起）。

所以，我认为，从长远来看，与程序相比，OO 成本会更低。

            回答 #3

赞同：6

时间：2009-02-12T16:50:16.477

在用谷歌搜索后，我在[这里](http://www.csm.ornl.gov/~v8q/Homepage/Projects/Papers/spetep04.doc)找到了这篇论文。我使用的搜索词是面向对象的生产力。

开头的段落继续说

面向对象技术的引入似乎不会阻碍新的大型商业项目的整体生产力，但在前两代产品中似乎也没有提高它。在实践中，主导影响可能是业务工作流程而不是方法论。

I think you will find that Object Oriented Programming is better in specific circumstances but neutral for everything else. What sold my bosses on converting my company's CAD/CAM application to a object oriented framework is that I precisely showed the exact areas in which it will help. The focus wasn't on the methodology as a whole but how it will help us sold some specific problem we had. For us was having a extensible framework for adding more shapes, reports, and machine controllers, and using collections to remove the memory limitation of the older design.

            回答 #4

赞同：5

时间：2008-12-02T02:33:56.497

我认为 S.Lott 指的是“不可重复的实验”现象，即你不能在程序上编写应用程序 X 然后*倒回时间*并编写它 OO 看看有什么区别。

你可以用两种不同的方式编写同一个应用程序两次，但是

*   你会学到一些关于应用程序的第一种方式，它会以第二种方式帮助你，并且
*   您可能在 OO 方面比在程序方面更好，反之亦然，这取决于您的经验以及应用程序的性质和所选择的工具

所以确实没有*直接*的比较依据

由于类似的原因——不同的应用程序、不同的团队等，实证研究同样无用。

范式转换很困难，一小部分程序员可能永远不会进行转换

如果您可以自由地开发*自己的方式*，那么解决方案很简单：以自己的方式开发事物，当您的同事注意到您正在围绕他们进行编码并且您的代码几乎没有经常中断时等等，他们会问您你是怎么做的，然后教他们 OOP（连同 TDD 和你可能使用的任何其他良好实践）

如果没有，那么，可能是时候润色简历了... ;-)

            回答 #5

赞同：3

时间：2008-12-02T02:03:59.397

好主意。正面对比。以程序风格和 OO 风格编写应用程序 X 并测量一些东西。开发成本。投资回报。

用两种风格编写同一个应用程序是什么意思？这将是一个不同的应用程序，不是吗？当他们使用继承、消息传递或封装时，程序人员会拒绝 OO 人在作弊。

不可能有这样的比较。比较应用程序的两个“版本”是没有依据的。这就像问苹果或橙子作为水果是否更具成本效益。

话虽如此，您必须专注于其他人实际上可以看到的东西。

1.  是时候建立一些有效的东西了。

2.  错误和问题的比率。

如果你的方法更好，你就会成功，人们会想知道为什么。

当您解释 OO 会导致您的成功时……嗯……您已经赢得了争论。

            回答 #6

赞同：2

时间：2008-12-02T13:36:01.077

关键是时间。公司需要多长时间才能更改设计以添加新功能或修复现有功能。你所做的任何研究都应该集中在那个领域。

我的公司在 90 年代中期为使​​用 VB3 创建的 CAM 软件进行了面向事件驱动的程序设计。使软件适应新机器需要很长时间。很长一段时间来测试错误修复和新功能的效果。

随着 VB6 的出现，我能够绘制出当前设计和解决测试和适配问题的新设计。非技术型的老板马上就明白了我在做什么。

关键是解释为什么 OOP 将使项目受益。使用 Fowler 的重构和设计模式之类的东西来展示新设计如何减少做事的时间。还包括您如何从 A 点到达 B 点。重构将有助于展示您如何拥有可以交付的工作中间阶段。

            回答 #7

赞同：2

时间：2009-02-11T14:33:00.687

我不认为你会找到这样的研究。至少您应该定义“成本”的含义。因为 OOP 设计有点慢，所以短期内使用过程编程可能会更快。在很短的时间内，意大利面条编码可能会更快。

但是当项目开始增长时，情况恰恰相反，因为 OOP 设计最适合管理代码复杂性。

所以在一个小项目中，程序设计可能更便宜，因为它更快而且你没有缺点。但是在一个大项目中，你会很快得到坚持，只使用像过程编程这样的简单范例

            回答 #8

赞同：1

时间：2009-02-11T14:12:45.103

我怀疑你会找到一个明确的研究。正如一些人所提到的，这不是一个可重复的实验。你会发现很多轶事证据。有些人可能会找到一些统计研究，但我会仔细检查它们。我不知道有什么非常好的。

我还要指出另一点，现实世界中不存在纯粹面向对象或纯粹过程的东西。许多（如果不是大多数）对象方法都是用过程代码编写的。同时，许多过程程序使用 OO 方法，例如封装（也有人称之为抽象）。  

不要误会我的意思，OO 和程序程序看起来和不同，但它是深灰色与浅灰色而不是黑白的问题。

            回答 #9

赞同：1

时间：2009-02-12T03:38:36.520

本文[只字未提](http://geekdoctor.blogspot.com/2008/01/measuring-programmer-productivity.html)OOP 与过程。但我认为您可以使用贵公司的类似指标进行讨论。

当我的公司开始探索[ROWE](http://www.culturerx.com)计划时，我觉得这很有趣。在我们的第一次会议中，很明显我们目前没有获得足够的成果指标。

所以你需要关注 1) 当前流程的维护是否阻碍了未来的发展？2) 不同的方法将如何影响#1？

        perl - 如何获得适用于 IIS 6、7 和 Apache 的标头？

ID：332809

赞同：1

时间：2008-12-02T01:56:10.117

标签：perl, apache, iis-7, iis-6, cgi

我正在尝试获得一个可以与 Apache、IIS 6 和 IIS 7 一起使用的标头。我不会在这里详细说明原因。让我们说这并不像我想象的那么容易:-)

无论如何，这个问题与NPH有关。在我们的代码（最初为 IIS 6 编写）中，我们有

```
use CGI qw(:standard);

print "HTTP/1.0 200 OK\n";

print header; 
```

在每个 cgi 脚本的顶部；我读到这就是你告诉 IIS 你想要 NPH 的方式。

Apache 使用文件名来查看输出是否为 nph（nph- 必须是文件名的开头）所以我所做的（在 IIS 6 和 Apache 中都适用）如下：

```
use CGI qw(:standard);
print header('text/html', '200 OK'); 
```

有趣的是，IIS 7 似乎*需要*NPH，所以如果我不这样做

```
use CGI qw(:standard -nph); 
```

或者

```
print "HTTP/1.0 200 OK\n";

print header('text/html', '200 OK'); #parameters are apparently optional 
```

浏览器试图对文件做一些奇怪的事情，因为它没有得到 mimetype。

另请注意：IIS 6 和 7 完全可以不打印任何标题，但 Apache 不喜欢这样。

无论如何，现在最好的事情就是做

```
use CGI qw(:standard);
print header('text/html', '200 OK'); 
```

以某种方式在 IIS 7 中工作。有谁知道我该怎么做？我不知道我们服务器配置的所有细节，但如果你告诉我如何获取你可能需要的任何细节，我可以做到。

无论哪种方式都感谢！

            回答 #1

赞同：1

时间：2008-12-02T02:31:21.603

我只是创建一个根据服务器做正确事情的子例程。你知道在每种情况下你必须做什么，所以在那种情况下就这样做。

另一个选项是修补 CGI.pm 以通过查看服务器类型正确设置其 $CGI::NPH 变量。CGI.pm 已经有了基础知识。一旦你解决了这个问题，提交一个补丁。

祝你好运 ：）

            回答 #2

赞同：0

时间：2008-12-02T03:11:35.783

Brian（和其他人）告诉我写一个子程序来做正确的事。希望这对其他人有帮助！

```
sub header {
    return (($ENV{PERLXS})?"HTTP/1.0 200 OK\r\n":"").CGI->header(@_);
} 
```

        .net - VB.NET 扩展方法

ID：332810

赞同：7

时间：2008-12-02T01:56:34.310

标签：.net, vb.net, extension-methods

当我在我的方法上方应用标签时，我得到了错误

类型 System.Runtime.CompilerServices.Extension 未定义。

这是我的样本

```
<System.Runtime.CompilerServices.Extension()> _
     Public Sub test()

End Sub 
```

我哪里错了？

[编辑~直接从这里](http://msdn.microsoft.com/en-us/library/bb384936.aspx)的 MSDN 文章，同样的错误

 ````
Imports System.Runtime.CompilerServices

Module StringExtensions
     _
  Public Sub Print(ByVal aString As String)
        Console.WriteLine(aString)
    End Sub

End Module

````  `我在我的项目中使用 Visual Studio 2008 和 3.5 框架。

> 解决方案〜该项目在2.0框架上。更改为 3.5 并且可以正常工作。

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2008-12-02T02:33:38.277

IDE 指向哪个版本的 .net 框架？

此外，乍一看扩展方法的语法看起来不正确。

代码不完整。请将 using 语句放在示例中，以便任何人使用代码并编译它 - 以重现错误。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2008-12-02T03:37:49.723

仅当以下情况之一为真时，您才会收到此错误

1.  您没有使用 VS 2008 - 在 VS2008 中添加了扩展方法支持

2.  您的代码没有对 System.Core.dll 的引用 - 也在 VS2008 中添加

你能检查这两个吗？我的怀疑是您正在尝试使用 VS2005 创建扩展方法。如果是这种情况，很遗憾不支持。  

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T03:39:25.540

我会将命名空间添加到导入中，这样您就不必每次都输入它：

```
Imports System.Runtime.CompilerServices

<Extension()> _
Public Sub Test(ByVal Value As String)

End Sub 
```

一旦在导入中拥有它，您就可以将 Extension 添加到每个方法的顶部，而不是整个方法。

正如 shahkalpesh 所说，您的扩展方法不完整，您需要添加要扩展的类型（请参阅代码第一个参数）。我刚玩了一下，发现如果你不提供一个类型来作为参数扩展，编译器会抛出一个错误。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T02:35:19.427

用这个...

System.Runtime.CompilerServices.ExtensionAttribute

在您提到的命名空间中找不到任何名为 Extension 的内容。

# sql-server - BizSpark 部署许可证托管

> ID：332814
> 
>         
> 
> 赞同：13
> 
>         
> 
> 时间：2008-12-02T01:59:03.137
> 
>         
> 
> 标签：sql-server, web-hosting, dedicated-hosting, bizspark

我已经与 BizSpark 签约，这很划算，尤其是对于像我这样处于常年创业模式的人。作为 BizSpark 的一部分，您可以获得 Windows Server 和 SQL Server 等软件的 3 年部署许可证。是否有任何专门的托管公司允许您使用这些许可证，而无需为通常托管帐户中内置的许可证付费？例如，通常将 SQL Server Standard 安装在主机上的专用服务器上可能会花费相当多的额外费用，但由于我已经拥有许可证，因此我不应该付费。

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2009-02-17T10:26:59.777

到目前为止，我已经找到了两个了解 BizSpark 的托管服务提供商：

*   [http://www.peer1.com/hosting/bizspark.php](http://www.peer1.com/hosting/bizspark.php)

*   [http://www.servepath.com/bizspark/](http://www.servepath.com/bizspark/)

虽然，害怕展示价格的托管服务提供商通常非常昂贵，这可能与寻求 BizSpark 的公司的预算紧张精神不符。

作为记录，

*   [http://www.crystaltech.com/](http://www.crystaltech.com/)不支持 BizSpark（2009-02-19 获得商业答案）。

如果您有链接，请随时编辑此帖子。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-02-17T13:18:36.743

Crystaltech 有 4 个不同的 Windows 服务器，可用于您的 BizSpark 应用程序。他们还进行自定义配置。他们已经经营了 11 年以上，并且是 Microsoft 认证合作伙伴。SQL 和其他许可证可以点菜添加，但您可以获得一个空框。他们可以通过 877.323.4578 选项 3 联系詹姆斯。

[http://crystaltech.com/dedicated-windows.aspx](http://crystaltech.com/dedicated-windows.aspx)

Crystal Tech 目前正在进行 3 项促销活动：

按月付费：服务器内存免费翻倍。按季度付费：免设置费（无免费 RAM） 预付费年：免费获得 3 个月服务，同时免设置费。（没有空闲内存）

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2012-01-06T20:06:49.393

您可以使用亚马逊云作为 Bizspark 合作伙伴并获得更便宜的托管服务：
 [http ://aws.typepad.com/aws/windows/](http://aws.typepad.com/aws/windows/)

[http://squarecows.com/2011/10/24/new-use-your-microsoft-bizspark-licenses-on-aws/](http://squarecows.com/2011/10/24/new-use-your-microsoft-bizspark-licenses-on-aws/)

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-16T15:15:51.417

据我所知，你有几个选择。

1.  BizSpark 有托管公司协议，你可以联系他们

2.  大多数拥有专用系统的托管公司会向您出售基本配置，并允许您安装自己的软件。（然而，windows 可能是唯一棘手的）。

我个人推荐[RackSpace](http://www.rackspace.com)和[HostMySite](http://www.hostmysite.com)来托管，如果你联系他们的销售人员，他们会告诉你什么是可能的。  

# database - 数据库为什么以及如何使用单个文件来存储所有数据？

> ID：332824
> 
>         
> 
> 赞同：16
> 
>         
> 
> 时间：2008-12-02T02:05:02.280
> 
>         
> 
> 标签：database

我遇到的许多数据库（如 SQL Server）使用单个文件来存储整个数据库。这似乎是一种很常见的方法。将整个数据库存储在单个文件中，而不是将数据分解为更多逻辑单元（例如每个文件一个表），有什么优势。  

此外，数据库如何在内部工作。它如何处理不同线程对同一文件的并发写入。在我见过的大多数应用程序中，您一次只能在文件上打开 1 个写句柄。各种数据库引擎如何处理并发写入。

* * *

## 回答 #1

> 赞同：23
> 
>             
> 
> 时间：2008-12-02T02:12:44.060

服务器应用程序可以处理单个非分段大文件，就像操作系统处理原始磁盘一样：可随机查找的字节块。如果数据库服务器可以选择在该字节块之上实现整个文件系统，如果将表实现为单独的文件有好处的话。

并发写入同一文件的不同部分不是问题。数据库使用锁定策略来确保多个线程不会尝试访问文件的同一部分，这是数据库事务存在的主要原因之一：将一个事务的可见效果与另一个事务隔离开来。

例如，数据库服务器可能会跟踪哪些正在进行的事务访问了哪些表中的哪些行；当一个事务退出时，它所触及的行被释放，以便其他事务可以自由访问它们。在这种情况下，当其他事务尝试访问当前属于另一个事务的行时，它们可能会简单地阻塞（即等待）。如果其他事务没有在合理（可配置的）时间内完成，那么等待的事务可能会被中止。造成这种情况的原因通常是死锁。然后，如果需要，使用数据库的应用程序可以选择重试事务。

这种锁定可以使用信号量或其他同步机制来实现，具体取决于性能权衡。

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2008-12-02T03:10:44.567

对，一个给定的文件可能只有一个带有打开文件描述符的进程，否则不同的进程可能会覆盖彼此的工作。通常，数据库上的所有 I/O 都必须由 RDBMS 进程完成。然后所有应用程序通过一些进程间通信（包括网络）提交它们的查询，并获得结果。因此，数据库文件的物理 I/O 是集中式的。

在实践中，RDBMS 实现也很常见，它有一个锁管理器线程来管理对文件的子部分（表、页或行）的访问，具体取决于 RDBMS 实现。这造成了一个“瓶颈”，因为虽然 RDBMS 可能有许多线程执行查询和进行网络通信，但是对数据库给定部分的并发访问仍然必须排队才能获取锁。使锁管理完全并行是非常棘手的。

至于单个文件与多个文件，优缺点也取决于 RDBMS 的实现。一个例子是 MySQL 的 InnoDB，它默认使用单文件方法。但是如果你删除一堆数据，它不知道如何缩小文件；它只是将文件中的一些空间标记为“空闲”，以供后续插入使用。即使您删除了整个表，文件也永远不会缩小。但是，如果您在设置 InnoDB 表空间时选择了 file-per-table 选项，然后删除了一个表，则 InnoDB 可以删除该表的文件，从而释放磁盘空间。

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2008-12-02T03:36:04.343

我认为巴里的回答非常出色。我只会标记更多的想法。请注意文件系统和原始设备之间的这种模糊，它们完全不同，但在概念上可以认为是同一件事。

**为什么 DBMS 供应商会推出自己的 I/O 管理等？**

**控制**

当大多数 DBMS 系统成长起来时（Oracle、DB2、Sybase ASE {SQL Server 是 Sybase ASE 的表亲}），操作系统的文件系统并不像今天那么先进，但进步很快（Oracle 写于 1979 年！！， Sybase 于 1987 年）。假设操作系统可以做各种既快速又安全的花哨的事情并不总是给定的。DBMS 供应商编写了自己的 I/O 库，以帮助降低它们不受操作系统怪癖影响或随着技术进步而过时的可能性。

现在这种情况要少得多（MySQL、PostgreSQL、SQLite 等不这样做）——甚至 SQL Server 也将很大一部分管理工作交给了 Windows，因为 Windows 团队与 SQL Server 团队密切合作以优化DBMS 工作负载。

**安全**

保持对整个数据文件的严格控制允许 DBMS 确保写入发生在它想要的时候，而不是在操作系统感觉的时候发生。保留自己的数据缓存可确保操作系统不会认为某些低级日志轮换作业将重要的数据库数据分页。

**一致性**

Oracle、Sybase ASE 等都是*非常*昂贵且非常复杂的系统。如果你在一个 DBMS 安装上花费了 1000 万美元，但由于你的操作系统内核的特定版本中存在一些疯狂的错误，它运行缓慢（或者更糟糕的是，数据损坏！）你会责怪谁？DBMS 供应商。滚动您自己的 I/O、锁管理、并发控制、线程等当然是很难做到的——但是当您绝对需要跨各种操作系统的 DBMS 的可重复、一致的行为时，您必须采取尽可能将操作系统排除在外。

同样，随着操作系统的成熟和发展，许多较新的系统都尝试尽可能多地使用操作系统级别的功能，但即使是 MySQL 也有一些可以在 my.cnf 中配置的缓冲池

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-12-04T18:55:32.117

相关说明。我相信 MSFT 建议您为系统表创建一个文件组并为其他对象创建一个文件组。也可以创建另一个来存储索引。我们不这样做，因为我们的应用程序都不需要如此高性能。它还会增加维护的复杂性。

# java - 平面文件数据库好用吗？

> ID：332825
> 
>         
> 
> 赞同：12
> 
>         
> 
> 时间：2008-12-02T02:05:22.263
> 
>         
> 
> 标签：java, database, linux, architecture

需要了解平面文件数据库优点的选项。我正在考虑使用平面文件数据库方案来管理自定义博客的数据。它将部署在 Linux OS 变体上并用 Java 编写。  

关于文章和评论的阅读和写作表现，可能有哪些负面或正面的影响？

文章检索是否会因为它是一个平面文件而不是一个 RDBMS 而失败，如果它被斜线点缀？（妄想）

我并不反对使用 RDBMS，只是询问社区他们对这种软件架构方案的可行性的看法。

**跟进：**
在这个问题的情况下，我会看到“平面文件 == 基于文件系统”例如，每个博客条目及其随附的元数据都在一个文件中。制作按文件夹的日期结构组织的许多文件 (blogs\testblog2\2008\12\01) == 12/01/2008

* * *

## 回答 #1

> 赞同：16
> 
>             
> 
> 时间：2008-12-02T04:53:31.847

平面文件数据库占有一席之地，并且对于正确的域非常有用。

过去的邮件服务器和 NNTP 服务器确实推动了您可以真正将这些东西带到多远的极限（实际上已经很远了——文件系统可以拥有数百万个文件和目录）。

平面文件数据库的两个最大弱点是索引和原子更新，但如果域合适，这些可能不是问题。

但是，例如，您可以通过适当的锁定，使用基本文件系统命令进行“原子”索引更新，至少在 Unix 上是这样。

一个简单的例子是让索引过程在数据中运行以在临时名称下创建新的索引文件。然后，完成后，您只需重命名（系统调用 rename(2) 或 shell mv 命令）旧文件覆盖新文件。Rename 和 mv 是 Unix 系统上的原子操作（即它要么工作要么不工作，并且永远不会缺少“中间状态”）。

与创建新条目相同。基本上将文件完全写入临时文件，然后将其重命名或 mv 到其最终位置。那么你在“数据库”中永远不会有一个“中间”文件。否则，您可能会遇到竞争条件（例如读取仍在写入的文件的进程，并且可能会在写入过程完成之前结束——丑陋的竞争条件）。

如果您的主索引与目录名称配合得很好，那么就可以了。例如，您可以使用散列方案创建目录和子目录来定位新文件。

使用文件名和目录结构查找文件非常快，因为当今大多数文件系统都对其目录进行索引。

如果您将一百万个文件放在一个目录中，那么您很可能需要查看一些调整问题，但是开箱即用，大多数文件都可以轻松处理数十万个文件。请记住，如果您需要扫描目录，将会有很多文件需要扫描。通过目录进行分区有助于防止这种情况。

但这一切都取决于您的索引和搜索技术。

实际上，提供静态内容的现成 Web 服务器是一个大型的平面文件数据库，并且该模型运行良好。

最后，当然，您可以使用大量免费的 Unix 文件系统级工具，但是所有这些工具都存在与无数文件有关的问题（将 grep 1000000 次分叉以在文件中查找某些内容会产生性能权衡——开销只会增加向上）。

如果您的所有文件都在同一个文件系统上，那么硬链接也为您提供了将同一个文件放在不同位置（基本上用于索引）的选项（因为它们也是原子的）。

例如，您可以有一个“today”目录、一个“yesterday”目录、一个“java”目录和实际的消息目录。

因此，可以将帖子链接到“today”目录、“java”目录（例如，因为帖子被标记为“java”）和最终位置（例如 /articles/2008/12/01/my_java_post 。文本文件）。然后，在午夜，您运行两个进程。第一个获取“今天”目录中的所有文件，检查它们的创建日期以确保它们不是“今天”（因为该过程可能需要几秒钟并且可能会潜入一个新文件），并将这些文件重命名为“昨天”。接下来，您对“昨天”目录执行相同的操作，只是在这里您只需在它们过期时将其删除。

同时，该文件仍在“java”和“.../12/01”目录中。由于您使用的是 Unix 文件系统和硬链接，因此“文件”只存在一次，这些都只是指向文件的指针。它们都不是“那个”文件，它们都是一样的。

您可以看到，虽然每个单独的文件移动都是原子的，但批量不是。例如，当“今天”脚本正在运行时，“昨天”目录可以很好地包含“昨天”和“前一天”的文件，因为“昨天”脚本还没有运行。

在事务性数据库中，您可以一次完成所有操作。

但是，简单地说，这是一种久经考验的真实方法。尤其是 Unix，可以很好地使用该习惯用法，并且现代文件系统也可以很好地支持它。

* * *

## 回答 #2

> 赞同：13
> 
>             
> 
> 时间：2008-12-02T02:10:55.733

*[（从这里](https://stackoverflow.com/questions/326203/alternatives-to-mysql#326210)复制和修改的答案）*

我建议不要将平面文件用于只读访问之外的任何内容，因为这样您就必须处理并发问题，例如确保一次只有一个进程正在写入文件。相反，我推荐[SQLite](http://www.sqlite.org/)，一个存储在文件中的功能齐全的 SQL 数据库。SQLite 已经内置了并发性，因此您不必担心文件锁定之类的事情，而且读取速度非常快。

但是，如果您要进行大量数据库更改，最好在一个[事务](http://www.sqlite.org/lang_transaction.html)中一次完成所有更改。这只会将更改写入文件一次，而不是每次发出更改查询。这极大地提高了进行多项更改的速度。

发出更改查询时，无论是否在事务中，整个数据库都会被锁定，直到该查询完成。这意味着非常大的事务可能会对其他进程的性能产生不利影响，因为它们必须等待事务完成才能访问数据库。在实践中，我还没有发现这很明显，但是尝试最小化您发出的数据库修改查询的数量始终是一个好习惯，而且它肯定比尝试使用平面文件更快。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2008-12-02T02:15:06.113

这是用 asp.net 和 Dasblog 完成的。它使用基于文件的存储。

此旧链接上列出了一些详细信息。
[http://www.hanselman.com/blog/UpcomingDasBlog19.aspx](http://www.hanselman.com/blog/UpcomingDasBlog19.aspx)

您还可以在[http://dasblog.info/Features.aspx上获得更多详细信息](http://dasblog.info/Features.aspx)

我听到了一些关于表演的不同意见。我建议你多研究一下，看看这种类型的系统是否适合你。这是我所听到的最接近的事情。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2008-12-02T02:17:05.907

用本机代码编写自己的引擎可以胜过通用数据库。

但是，引擎的质量和功能级别永远不会接近这一点。数据库为您提供的所有核心功能——索引、事务、参照完整性——您必须自己实现所有这些。

重新发明轮子没有什么错（毕竟，Linux 就是这样），但请记住您的期望和时间承诺。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2008-12-02T10:17:40.133

我回答这个问题并不是要回答为什么平面文件数据库是好是坏，其他人已经做了很多工作。

但是，有些人一直在指出 SQLite 做得很好。由于您使用的是 Java，因此最好的选择是使用[HSQLDB](http://hsqldb.org/)，它与 SQLite 完全相同，但使用 Java 实现并嵌入到您的应用程序中。

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2008-12-03T14:10:37.433

大多数时候现在一个平面文件数据库就足够**了**。但是，如果您从数据库开始您的项目，您会感谢年轻的自己。这可能是[SQLite](http://www.sqlite.org/)，如果您不想设置像[PostgreSQL](http://www.postgresql.org/)这样的整个数据库系统。

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2016-10-29T14:02:47.297

看看这个[http://jsondb.io](http://jsondb.io)一个开源的基于 Java 的数据库有你正在寻找的大部分内容。将数据保存为平面 .json 文件、多线程支持、加密支持、ORM 支持、原子性支持、基于 XPATH 的高级查询支持。

免责声明：我创建了这个数据库。

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T02:12:35.107

可怕的想法。每次您想添加某些内容时，追加都会涉及到文件末尾。每次更新都需要重写整个文件。读取涉及表扫描（或维护单独的索引，这与写入/更新有相同的问题）。只需使用数据库，当然，除非您重新实现 RDBMS 已经提供的所有东西，以使您的解决方案甚至具有适度的可扩展性。

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T02:36:03.687

它们似乎对于添加新数据的高写入、低读取、无更新数据库工作得很好。  

Web 服务器及其同类服务器严重依赖它们来存储日志文件。  

DBMS 软件也将它们用于日志。  

如果您的设计在这些限制范围内，那么您似乎是一个很好的伙伴。您可能希望将元数据和指针保存在数据库中，并设置某种快速异步队列编写器来缓冲评论，但文件系统在缓冲和写锁定方面已经相当出色。

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T03:54:52.543

平面文件数据库是可能的，但请考虑以下事项。

数据库需要获得所有的 ACID 元素（原子性、一致性、隔离性、持久性），如果您要确保所有这些都在一个平面文件中完成（尤其是并发访问），那么您基本上已经编写了一个成熟的 DBMS .

那么为什么不首先使用成熟的 DBMS 呢？

如果您只使用其中一种免费选项（SQLite、MySQL、PostgresSQL 等），您将节省与编写相关的时间和金钱（我保证会多次重写）。

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T04:02:55.163

如果它足够小并且不会丢失随机访问，您可以使用法定文件数据库。具有大量随机访问的大文件将非常慢。并且没有复杂的查询。没有连接，没有总和，分组等。您也不能期望从平面文件中获取分层数据。XML 格式对于复杂的结构要好得多。

# sql - ActiveRecord/nHibernate SQL 生成是否“安全”？

> ID：332833
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-12-02T02:14:12.450
> 
>         
> 
> 标签：sql, nhibernate, sql-injection, castle-activerecord

我正在做这个系统[堆叠](http://stacked.ra-ajax.org/)，我正在创建搜索功能。在那个过程中，我想到*也许*AR/nHibernate Expression.Like（和兄弟姐妹）可能不是 100%“安全”，因为你可以创建类似的东西；"\r\ndrop database xxx;---" 和类似的东西......？

我希望他们是安全的，但我不确定......

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2008-12-02T03:03:00.637

NHibernate（以及扩展的 ActiveRecord）生成`sp_executesql 'select blah from table where column = @p1', '@p1 varchar(10)', @p1 = 'drop database xxx;---'`查询形式的参数化 SQL 语句。这些类型的 SQL 语句不会受到 SQL 注入的影响，因为不会执行参数的内容（与使用简单连接时的情况不同）。  

所以是的，两者都是“安全的”。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T02:16:22.663

如果你发现了一个安全漏洞，你绝对应该提交它。许多人依赖这些东西。

# c++ - 在 unicode C++ 应用程序中解析命令行参数

> ID：332849
> 
>         
> 
> 赞同：12
> 
>         
> 
> 时间：2008-12-02T02:27:29.070
> 
>         
> 
> 标签：c++, command-line, unicode

如果应用程序是 unicode，我如何解析作为命令行参数传递给应用程序的整数？

Unicode 应用程序有这样的主要内容：

```
int _tmain(int argc, _TCHAR* argv[]) 
```

argv[?] 是一个 wchar_t*。这意味着我不能使用atoi。如何将其转换为整数？stringstream 是最好的选择吗？

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2008-12-02T02:52:51.390

如果你有一个 TCHAR 数组或指向它开头的指针，你可以使用`std::basic_istringstream`它：

```
std::basic_istringstream<_TCHAR> ss(argv[x]);
int number;
ss >> number; 
```

现在，`number`是转换后的数字。这将在 ANSI 模式（_TCHAR 是 typedef'ed to `char`）和 Unicode（_TCHAR is typedef`ed to wchar_t as you say）模式下工作。

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2008-12-02T02:55:24.503

TCHAR 是一种适用于 ANSI 和 Unicode 的字符类型。查看 MSDN 文档（我假设您在 Windows 上），有 atoi 和所有基本字符串函数（strcpy、strcmp 等）的 TCHAR 等效项

atoi() 的 TCHAR 等效项是 _ttoi()。所以你可以这样写：

```
int value = _ttoi(argv[1]); 
```

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-12-02T02:57:55.717

我个人会使用`stringstreams`，这里有一些代码可以帮助您入门：

```
#include <sstream>
#include <iostream>

using namespace std;

typedef basic_istringstream<_TCHAR> ITSS;

int _tmain(int argc, _TCHAR *argv[]) {

    ITSS s(argv[0]);
    int i = 0;
    s >> i;
    if (s) {
        cout << "i + 1 = " << i + 1 << endl;
    }
    else {
        cerr << "Bad argument - expected integer" << endl;
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2013-01-21T07:03:15.397

干编码，我不在 Windows 上开发，但使用[`TCLAP`](http://tclap.sf.net/)，这应该让你运行宽字符`argv`值：

```
#include <iostream>

#ifdef WINDOWS
# define TCLAP_NAMESTARTSTRING "~~"
# define TCLAP_FLAGSTARTSTRING "/"
#endif
#include "tclap/CmdLine.h"

int main(int argc, _TCHAR *argv[]) {
  int myInt = -1;
  try {
    TCLAP::ValueArg<int> intArg;
    TCLAP::CmdLine cmd("this is a message", ' ', "0.99" );
    cmd.add(intArg);
    cmd.parse(argc, argv);
    if (intArg.isSet())
      myInt = intArg.getValue();
  } catch (TCLAP::ArgException& e) {
    std::cout << "ERROR: " << e.error() << " " << e.argId() << endl;
  }
  std::cout << "My Int: " << myInt << std::endl;
  return 0;
} 
```

# c# - 如何在 C# 中控制 datagridview 光标移动

> ID：332851
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2008-12-02T02:28:09.550
> 
>         
> 
> 标签：c#, datagridview

我希望我的 datagridview 光标在向单元格输入数据后向右移动到下一列而不是移动到下一行。

我试图通过 dataGridView1_KeyDown 事件捕获键来控制光标，但这并不能阻止光标在将数据输入单元格后移动到下一行......

提前感谢你的帮助。

干杯，

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2008-12-02T03:16:36.130

这是 Mark Rideout（DatagridView 项目经理）的回答

[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=157055&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=157055&SiteID=1)

向下滚动 4 个帖子（然后更多，因为它们稍后会在线程中制作更好的版本）。

如果链接将过期，供将来参考（**Mark Rideout 的所有学分**）：

创建一个从 DataGridView 继承的名为 dvg 的新类。编译项目，然后使用这个扩展的 Datagridview-control 而不是正常的，你将有一个 datagridview 按下回车键时选择下一个单元格：

```
public class dgv : DataGridView
{
protected override bool ProcessDialogKey(Keys keyData)
{
    Keys key = (keyData & Keys.KeyCode);
    if (key == Keys.Enter)
    {
        return this.ProcessRightKey(keyData);
    }
    return base.ProcessDialogKey(keyData);
}
protected override bool ProcessDataGridViewKey(KeyEventArgs e)
{
    if (e.KeyCode == Keys.Enter)
    {
        return this.ProcessRightKey(e.KeyData);
    }
    return base.ProcessDataGridViewKey(e);
} 
```

}

# c++ - 在 C++ 中检查变量类型

> ID：332852
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2008-12-02T02:28:14.357
> 
>         
> 
> 标签：c++, variables, double

所以我目前正在学习 C++，并决定制作一个程序来测试我目前所学的技能。现在在我的代码中，我想检查用户输入的值是否为双精度，如果不是双精度，我将放置一个 if 循环并要求他们重新输入它。我遇到的问题是如何检查用户输入的变量类型，例如，如果用户输入字符或字符串，我可以输出错误消息。这是我的代码：

```
//cubes a user entered number
#include <iostream>
using namespace std;

double cube(double n); //function prototype

int main()
{
    cout << "Enter the number you want to cube: "; //ask user to input number
    double user;
    cin >> user;  //user entering the number

    cout << "The cube of " << user << " is " << cube(user) << "." << endl; //displaying the cubed number

    return 0;
}

double cube (double n) //function that cubes the number
{
    return n*n*n; // cubing the number and returning it
} 
```

编辑：我不得不说我刚刚开始并且对您的代码没有丝毫线索，但我会检查您的链接。顺便说一句，我还没有学会如何使用模板，我正在学习如何处理数据，只有我的 C++ Primer Plus 5th edition 的第 3 章。

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2008-12-02T02:43:44.170

## 安全的 C++ 方式

您可以使用以下方法为此定义一个函数`std::istringstream`：

```
#include <sstream>  

bool is_double(std::string const& str) {
    std::istringstream ss(str);

    // always keep the scope of variables as close as possible. we see
    // 'd' only within the following block.
    {
        double d;
        ss >> d;
    }

    /* eat up trailing whitespace if there was a double read, and ensure
     * there is no character left. the eof bit is set in the case that
     * `std::ws` tried to read beyond the stream. */
    return (ss && (ss >> std::ws).eof());
} 
```

为了帮助您弄清楚它的作用（简化了一些要点）：

*   创建使用给定字符串初始化的输入字符串流

*   使用`operator>>`. 这意味着跳过空格并尝试读取双精度。

*   如果无法读取双精度，则在`abc`流中设置*失败*位。请注意，类似的情况`3abc`会成功并且*不会*设置失败位。

*   如果设置了失败位，则`ss`计算为零值，这意味着*false*。

*   如果读取了双精度数，我们会跳过尾随空格。如果我们然后在流的末尾（请注意，如果我们尝试读取结束，将`eof()`返回*true*`std::ws` 。确实如此），`eof`将返回 true。请注意，此检查确保`3abc`不会通过我们的检查。

*   如果两种情况，左右两边的`&&`求值都为*true*，我们将 true 返回给调用者，表明给定的字符串是一个双精度字符串。

类似地，您检查`int`和其他类型。如果您知道如何使用模板，那么您也知道如何将其推广到其他类型。顺便说一句，这正是`boost::lexical_cast`为您提供的。看看： http: [//www.boost.org/doc/libs/1_37_0/libs/conversion/lexical_cast.htm](http://www.boost.org/doc/libs/1_37_0/libs/conversion/lexical_cast.htm)。

## C方式一

这种方式有优点（速度快）但也有主要缺点（不能使用模板概括，需要使用原始指针）：

```
#include <cstdlib>
#include <cctype>  

bool is_double(std::string const& s) {
    char * endptr;
    std::strtod(s.c_str(), &endptr);
    if(endptr != s.c_str()) // skip trailing whitespace
        while(std::isspace(*endptr)) endptr++;
    return (endptr != s.c_str() && *endptr == '\0');
} 
```

`strtod`将设置`endptr`为处理的最后一个字符。在我们的例子中是终止空字符。如果未执行转换，则 endptr 设置为给定的字符串的值`strtod`。

## C方式二

一件可能的事情可以`std::sscanf`解决问题。但是很容易监督一些事情。这是正确的方法：

```
#include <cstdio>

bool is_double(std::string const& s) {
    int n;
    double d;
    return (std::sscanf(s.c_str(), "%lf %n", &d, &n) >= 1 && 
            n == static_cast<int>(s.size()));
} 
```

`std::sscanf`将返回转换的项目。尽管标准规定`%n`不包括在该计数中，但几个来源相互矛盾。最好进行比较`>=`以使其正确（请参阅 的联机帮助页`sscanf`）。`n`将设置为已处理字符的数量。它与字符串的大小进行比较。两个格式说明符之间的空格是可选的尾随空格。

## 结论

如果您是初学者，请阅读`std::stringstream`并以 C++ 的方式进行操作。在您对 C++ 的一般概念感到满意之前，最好不要乱用指针。

* * *

## 回答 #2

> 赞同：7
> 
>             
> 
> 时间：2008-12-02T03:00:55.897

在标准库中没有合适的方法来检查字符串是否*真的*包含双精度。您可能想使用[Boost](http://www.boost.org/)。以下解决方案的灵感来自[C++ Cookbook](https://rads.stackoverflow.com/amzn/click/com/0596007612)中的配方 3.3 ：

```
#include <iostream>
#include <boost/lexical_cast.hpp>
using namespace std;
using namespace boost;

double cube(double n);

int main()
{
    while(true)
    {
        cout << "Enter the number you want to cube: ";
        string user;
        cin >> user;

        try
        {
            // The following instruction tries to parse a double from the 'user' string.
            // If the parsing fails, it raises an exception of type bad_lexical_cast.
            // If an exception is raised within a try{ } block, the execution proceeds
            // with one of the following catch() blocks
            double d = lexical_cast <double> (user);   

            cout << "The cube of " << d << " is " << cube(d) << "." << endl;
            break;
        }
        catch(bad_lexical_cast &e)
        {
            // This code is executed if the lexical_cast raised an exception; We
            // put an error message and continue with the loop
            cout << "The inserted string was not a valid double!" << endl;
        }
    }
    return 0;
}

double cube (double n)
{
    return n*n*n;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T03:09:26.253

[sscanf](http://linux.die.net/man/3/sscanf)可以做你想做的；它返回正确处理的参数数量。这应该让你开始：

```
//cubes a user entered number
#include <iostream>
#include <cstdio>
using namespace std;

double cube(double n); //function prototype

int main()
{
        cout << "Enter the number you want to cube: "; //ask user to input number
        string user;
        cin >> user;  //user entering the number

        // Convert the number to a double.
        double value;
        if(sscanf(user.c_str(), "%lf", &value) != 1)
        {
                cout << "Bad!  " << user << " isn't a number!" << endl;
                return 1;
        }

        cout << "The cube of " << user << " is " << cube(user) << "." << endl; //displaying the cubed number

        return 0;
}

double cube (double n) //function that cubes the number
{
        return n*n*n; // cubing the number and returning it
} 
```

其他答案中发布的其他方法各有优缺点。这个有尾随字符的问题，不是“C++”-y。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T02:49:41.770

我不得不说我刚刚开始并且对您的代码一无所知，但我会查看您的链接。顺便说一句，我还没有学会如何使用模板，我正在学习如何处理数据，只有我的 C++ Primer Plus 5th edition 的第 3 章。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T02:51:28.910

您可以退回到 C 并使用[strtod](http://www.opengroup.org/onlinepubs/000095399/functions/strtod.html)

您的程序读取一个字符串，然后将其传递给一个尝试将字符串转换为双精度的函数。

```
bool is_double(const char* strIn, double& dblOut) {
    char* lastConvert = NULL;
    double d = strtod(strIn, &lastConvert);
    if(lastConvert == strIn){
        return false;
    } else {
       dblOut = d;
       return true;
    }
} 
```

# c# - 在 WPF 中检测 Drag'n'Drop 文件？

> ID：332859
> 
>         
> 
> 赞同：15
> 
>         
> 
> 时间：2008-12-02T02:32:16.983
> 
>         
> 
> 标签：c#, wpf, .net-3.5, drag-and-drop

是否可以让 WPF 窗口/元素检测从 C# .Net 3.5 中的 Windows 资源管理器拖放文件？我找到了 WinForms 的解决方案，但没有找到 WPF 的解决方案。

* * *

## 回答 #1

> 赞同：9
> 
>             
> 
> 时间：2011-04-22T12:14:55.723

尝试以下操作：

```
 private void MessageTextBox_Drop(object sender, DragEventArgs e)
    {
        if (e.Data is DataObject && ((DataObject)e.Data).ContainsFileDropList())
        {
            foreach (string filePath in ((DataObject)e.Data).GetFileDropList())
            {
                // Processing here     
            }
        }
    }

    private void MessageTextBox_PreviewDragEnter(object sender, DragEventArgs e)
    {
        var dropPossible = e.Data != null && ((DataObject)e.Data).ContainsFileDropList();
        if (dropPossible)
        {
            e.Effects = DragDropEffects.Copy;
        }
    }

    private void MessageTextBox_PreviewDragOver(object sender, DragEventArgs e)
    {
        e.Handled = true;
    } 
```

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2008-12-03T05:14:57.063

不幸的是，TextBox、RichTextBox 和 FlowDocument 查看器总是将拖放事件标记为已处理，这会阻止它们冒泡到您的处理程序。您可以通过强制处理拖放事件（使用 UIElement.AddHandler 并将handledEventsToo 设置为true）并在处理程序中将e.Handled 设置为false 来恢复被这些控件拦截的拖放事件。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2008-12-02T03:02:18.297

事实证明，由于某种原因，我无法放到我的 TextBox 上，但放到按钮上效果很好。通过将'AllowDrop="True"'添加到我的窗口并将放置事件处理程序添加到按钮来使其工作，其中包括：

```
private void btnFindType_Drop(object sender, DragEventArgs e)
{
  if (e.Data is System.Windows.DataObject &&
    ((System.Windows.DataObject)e.Data).ContainsFileDropList())
  {
    foreach (string filePath in ((System.Windows.DataObject)e.Data).GetFileDropList())
    {
      // Processing here
    }
  }            
} 
```

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2012-03-22T08:34:45.293

我有类似的问题，放置事件和拖动输入事件没有被触发。问题出在 Windows 用户帐户设置上。将其设置为最不安全的设置并尝试使用相同的代码。

# visual-c++ - Visual C++ 应用程序在发布主程序之前崩溃，但在调试中运行良好

> ID：332862
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-12-02T02:33:52.550
> 
>         
> 
> 标签：visual-c++, cgal

在发布时，它会因未处理的异常而崩溃：std::length 错误。

调用堆栈如下所示：

```
msvcr90.dll!__set_flsgetvalue()  Line 256 + 0xc bytes   C
msvcr90.dll!__set_flsgetvalue()  Line 256 + 0xc bytes   C
msvcr90.dll!_getptd_noexit()  Line 616 + 0x7 bytes  C
msvcr90.dll!_getptd()  Line 641 + 0x5 bytes C
msvcr90.dll!rand()  Line 68 C
NEM.exe!CGAL::Random::Random()  + 0x34 bytes    C++
msvcr90.dll!_initterm(void (void)* * pfbegin=0x00000003, void (void)* * pfend=0x00345560)  Line 903 C
NEM.exe!__tmainCRTStartup()  Line 582 + 0x17 bytes  C
kernel32.dll!7c817067() 
```

有没有人有任何线索？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-12-02T05:53:02.930

检查堆栈转储：

InitTerm 只是一个遍历其他函数列表并逐步执行每个函数的函数——除其他外，它用于全局构造函数（在启动时）、全局析构函数（在关闭时）和 atexit 列表（也在关闭时）。

您正在与 CGAL 链接，因为`CGAL::Random::Random`在您的堆栈转储中是由于 CGAL 定义了一个名为`default_random`该`CGAL::Random::Random`类型的全局变量。这就是为什么你的错误发生在 main 之前，`default_random`正在构建。

从 CGAL 源，它所做的一切都是调用标准 C ，`srand(time(NULL))`然后调用本地`get_int`，而本地又调用标准 C`rand()`以获取随机数。

但是，由于您的堆栈转储仍在`srand()`.

**看起来**它正在将您的线程懒惰地转换为光纤，即，这是您第一次尝试在线程中执行某些操作，并且它必须在继续之前设置光纤本地存储。

所以，有几件事要尝试和调查。

1/ 您是否在 XP 之前运行此代码？我相信光纤本地存储（`__set_flsgetvalue`）是在 XP 中引入的。这是一个很长的镜头，但无论如何我们都需要清理它。

2/你需要链接CGAL吗？我假设您的应用程序需要 CGAL 库中的某些内容，否则不要与它链接。它可能是另一个项目文件的遗留问题。

3/ 如果您**使用**CGAL，请确保您使用的是最新版本。从 3.3 开始，它支持动态链接，可以防止混合不同库版本（静态/动态和调试/非调试）的可能性。

4/你能尝试用VC8编译吗？CGAL 支持的平台**还不**包括 VC9 (VS2008)。您可能需要与 CGAL 团队一起跟进，看看他们是否正在提供支持。

5/ 最后，你安装了 Boost 吗？这是另一个长镜头，但无论如何都值得一看。

如果这些建议都没有帮助，恐怕您将不得不等待比我更有知识的人出现。

祝你好运。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T02:36:40.237

main() 之前的崩溃通常是由全局或静态变量中的错误构造函数引起的。

看起来像**类 Random**的构造函数。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T04:05:45.783

你有随机类型的全局或静态变量吗？您是否有可能在正确初始化它所在的库之前尝试构建它？

请注意，全局和静态变量的构造顺序不是固定的，并且可能会从调试到发布发生变化。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-12-22T12:36:54.830

您能否更具体地说明您收到的错误？（未处理的异常 std::length 听起来很奇怪——我从没听说过）

据我所知，如果 FLS API 不可用，FlsGetValue 会自动回退到 TLS 对应项。

如果您仍然卡住，请在崩溃时获取您的进程的 .dmp 并将其发布（使用众多免费上传服务中的任何一种 - 并给我们一个链接）（听起来像 SO 中缺少的功能 - 源/数据文件交换？）

# linq - Does this linq query run on every iteration of the for-each loop?

> ID：332864
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2008-12-02T02:34:45.047
> 
>         
> 
> 标签：linq, enumeration

In another question on SO I answered with code like the one below and got a comment that the LINQ-query probably was evaluated in every iteration of the for/each. Is that true?

I know that LINQ-querys does not executes before its items is evaluated so it seems possible that this way to iterate the result can make it run on every iteration? 

```
Dim d = New Dictionary(Of String, String)()    
d.Add("Teststring", "Hello")    
d.Add("1TestString1", "World")    
d.Add("2TestString2", "Test")    

For Each i As String In From e In d Where e.Value.StartsWith("W") Select e.Key
    MsgBox("This key has a matching value:" & i)    
Next 
```

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2008-12-02T03:06:08.350

NO... in a foreach, the "GetEnumerator" is called only once (ever), and that is used going forward.

EDIT: I put a statement here about the result set being stored temporarily... that's only true for some cases... not this one, so I took it out.

EDIT: Please forgive this for being overly verbose... but I wanted to *show* you what is happening... so here's a Console app :)

```
using System;
using System.Collections.Generic;
using System.Linq;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            foreach (string item in MyCustomEnumerator()
                .Where(item => item.StartsWith("abc")))
            {
            Console.WriteLine(item);
            }
        }

        static IEnumerable<string> MyCustomEnumerator()
        {
            Console.WriteLine(DateTime.Now);

            yield return "abc1";

            Console.WriteLine(DateTime.Now);

            yield return "abc2";

            Console.WriteLine(DateTime.Now);

            yield return "abc3";

            Console.WriteLine(DateTime.Now);

            yield return "xxx";
        }
    }
} 
```

EDIT: This will result in a DateTime, then abc1, then a DateTime, then abc2, then a DateTime, then abc3, then a DateTime.

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T02:46:17.923

I believe that it will run the first time it is reached and produce an enumeration that has all the matching values.   What you will actually get back is an enumerator for that enumeration.

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T02:44:13.387

I looked up the FOR EACH...NEXT statement and it seems like Visual Basic evaluates the collection only once, before the loop begins, so it should not run the query on every iteration.

> Number of Iterations. Visual Basic
>   evaluates the collection only once,
>   before the loop begins. If your
>   statement block changes element or
>   group, these changes do not affect the
>   iteration of the loop.

# xml - F# XML 解析

> ID：332871
> 
>         
> 
> 赞同：25
> 
>         
> 
> 时间：2008-12-02T02:37:00.330
> 
>         
> 
> 标签：xml, f#, functional-programming

此 c# 代码可能不是最有效的，但可以完成我想要完成的工作。  

如何在 F# 代码中完成同样的事情？

```
 string xml = " <EmailList> " +
               "      <Email>test@email.com</Email> " +
               "      <Email>test2@email.com</Email> " +
               " </EmailList> ";

    XmlDocument xdoc = new XmlDocument();
    XmlNodeList nodeList;
    String emailList = string.Empty;
    xdoc.LoadXml(xml);
    nodeList = xdoc.SelectNodes("//EmailList");
    foreach (XmlNode item in nodeList)
    {
        foreach (XmlNode email in item)
        {
             emailList +=  email.InnerText.ToString() +  Environment.NewLine ;
        }               
    } 
```

* * *

## 回答 #1

> 赞同：50
> 
>             
> 
> 时间：2008-12-02T04:45:51.223

```
let doc = new XmlDocument() in
    doc.LoadXml xml;
    doc.SelectNodes "/EmailList/Email/text()"
        |> Seq.cast<XmlNode>
        |> Seq.map (fun node -> node.Value)
        |> String.concat Environment.NewLine 
```

如果您真的想要最后的尾随换行符，您可以将其添加到地图中，并使用空字符串将其添加到 String.concat 中。

* * *

## 回答 #2

> 赞同：9
> 
>             
> 
> 时间：2015-11-24T14:31:52.260

与[F# Data XML Type Provider](http://fsharp.github.io/FSharp.Data/library/XmlProvider.html)相同：

```
type EmailList = XmlProvider<"""<EmailList><Email>email</Email><Email>email</Email></EmailList>""">
let data = EmailList.Parse("""
    <EmailList>
        <Email>test@email.com</Email>
        <Email>test2@email.com</Email>
    </EmailList>
    """)

let emailList = data.Emails |> String.concat Environment.NewLine 
```

* * *

## 回答 #3

> 赞同：6
> 
>             
> 
> 时间：2008-12-02T03:23:01.873

这是在 F# 中执行此操作的类似代码。我敢肯定 F# ninja 会在一分钟内把更好的版本放在这里。  

```
open System.Xml

let getList x = 
    let getDoc =
        let doc = new XmlDocument()
        doc.LoadXml(x) |> ignore
        doc
    let getEmail (n:XmlNode) = n.InnerText.ToString() 
    let doc = getDoc
    let build = new System.Text.StringBuilder()
    doc.SelectNodes("//EmailList") 
        |> Seq.cast<XmlNode>
        |> Seq.map (fun n -> n.ChildNodes )
        |> Seq.map_concat (Seq.cast<XmlNode>)
        |> Seq.map(fun (n:XmlNode) -> getEmail n) 
        |> Seq.iter (fun e -> build.AppendLine(e) |> ignore )
    build.ToString() 
```

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T03:01:40.887

如果你查看你的代码，你会发现有几件事情正在发生。第一个是为电子邮件节点加载集合，第二个实际上是对它们做一些有意义的事情。

首先，你想让你的函数返回一个集合。类似的东西（我在我的 Mac 上，所以这可能不起作用）：

```
 List<string> EmailAddresses(string xml)
{
    XmlDocument xdoc = new XmlDocument();
    XmlNodeList nodeList;
    String emailList = string.Empty;
    xdoc.LoadXml(xml);
    nodeList = xdoc.SelectNodes("//EmailList");
    foreach (XmlNode item in nodeList)
    {
        foreach (XmlNode email in item)
        {
             yield email.InnerText.ToString();
        }               
    }
} 
```

现在问题来了，你想用那个集合做什么。在上面的示例中，您将其连接起来，或者基本上存储状态。

从 C# 的角度来看，您可以开始使用[这个问题](https://stackoverflow.com/questions/217805/using-linq-to-concatenate-strings)的答案（使用 LINQ）和[这个](https://stackoverflow.com/questions/145856/how-to-join-int-to-a-charcter-separated-string-in-c).

从 F# 的角度来看，您现在有了一个列表，并且可以简单地使用正常的过程来创建一个像[this](http://blogs.msdn.com/chrsmith/archive/2008/07/10/mastering-f-lists.aspx)或[here](http://www.fsharphelp.com/Lists.aspx)这样的列表。

您还可以查看[LINQ to XML](http://msdn.microsoft.com/en-us/library/bb387098.aspx)（或[5 分钟概述](http://www.hookedonlinq.com/LINQtoXML5MinuteOverview.ashx)）以获得更多想法。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T03:21:01.427

类似的东西怎么样：

```
#light
open System.Xml

let xml = "..."

let emailList = 
    let xdoc = new XmlDocument()
    xdoc.LoadXml(xml)

    let mutable list = []
    let addEmail e = list <- e :: emailList

    xdoc.SelectNodes("//EmailList")
    |> IEnumerable.iter(fun(item:XmlNode) ->
        item
        |> IEnumerable.iter(fun(e:XmlNode) ->
            addEmail e.InnerText; ()))

    list 
```

# javascript - 在 JavaScript 中编码 URL？

> ID：332872
> 
>         
> 
> 赞同：2692
> 
>         
> 
> 时间：2008-12-02T02:37:08.457
> 
>         
> 
> 标签：javascript, url, encode, urlencode

您如何使用 JavaScript 安全地对 URL 进行编码，以便可以将其放入 GET 字符串中？

```
var myUrl = "http://example.com/index.html?param=1&anotherParam=2";
var myOtherUrl = "http://example.com/index.html?url=" + myUrl; 
```

我假设您需要`myUrl`在第二行对变量进行编码？

* * *

## 回答 #1

> 赞同：3016
> 
>             
> 
> 时间：2008-12-02T02:43:57.100

查看内置函数[encodeURIComponent(str)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)和[encodeURI(str)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI)。

在您的情况下，这应该有效：

```
var myOtherUrl = 
       "http://example.com/index.html?url=" + encodeURIComponent(myUrl); 
```

* * *

## 回答 #2

> 赞同：1617
> 
>             
> 
> 时间：2008-12-02T02:49:54.610

你有三个选择：

*   `escape()`不会编码：`@*/+`

*   `encodeURI()`不会编码：`~!@#$&*()=:/,;?+'`

*   `encodeURIComponent()`不会编码：`~!*()'`

但在你的情况下，如果你想将一个[URL](http://en.wikipedia.org/wiki/Uniform_Resource_Locator)传递给其他页面的`GET`参数，你应该使用`escape`or `encodeURIComponent`，而不是`encodeURI`。

请参阅堆栈溢出问题*[最佳实践：转义或 encodeURI / encodeURIComponent](https://stackoverflow.com/questions/75980/best-practice-escape-or-encodeuri-encodeuricomponent)*以进行进一步讨论。

* * *

## 回答 #3

> 赞同：195
> 
>             
> 
> 时间：2011-05-29T23:54:43.973

坚持[`encodeURIComponent()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)。该函数[`encodeURI()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURI)不费心编码许多在 URL 中具有语义重要性的字符（例如“#”、“?”和“&”）。[`escape()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/escape)已弃用，并且不费心对“+”字符进行编码，这将被解释为服务器上的编码空格（并且，正如其他人在这里指出的那样，不会正确地对非 ASCII 字符进行 URL 编码）。

[对和其他地方](https://stackoverflow.com/questions/75980/best-practice-escape-or-encodeuri-encodeuricomponent)[的区别`encodeURI()``encodeURIComponent()`](https://stackoverflow.com/questions/75980/best-practice-escape-or-encodeuri-encodeuricomponent)有一个很好的解释。如果您想对某些内容进行编码，以便可以安全地将其包含为 URI 的一个组件（例如，作为查询字符串参数），您需要使用`encodeURIComponent()`.

* * *

## 回答 #4

> 赞同：88
> 
>             
> 
> 时间：2012-12-15T08:47:32.280

最好的答案是使用查询字符串中`encodeURIComponent`的*值*（别无他处）。

但是，我发现许多 API 想用“+”替换“”，所以我不得不使用以下内容：

```
const value = encodeURIComponent(value).replace('%20','+');
const url = 'http://example.com?lang=en&key=' + value 
```

`escape`在不同的浏览器中以不同的方式实现，并且`encodeURI`不编码许多字符（如 # 甚至 /）——它被用于完整的 URI/URL 而不会破坏它——这不是超级有用或安全的。

正如@Jochem 在下面指出的那样，您可能希望`encodeURIComponent()`在（每个）文件夹名称上使用，但无论出于何种原因，这些 API 似乎都不希望`+`在文件夹名称中使用，所以普通旧的`encodeURIComponent`效果很好。

例子：

```
const escapedValue = encodeURIComponent(value).replace('%20','+');
const escapedFolder = encodeURIComponent('My Folder'); // no replace
const url = `http://example.com/${escapedFolder}/?myKey=${escapedValue}`; 
```

* * *

## 回答 #5

> 赞同：43
> 
>             
> 
> 时间：2013-05-13T03:32:25.463

我建议使用[qs npm 包](https://www.npmjs.com/package/qs)

```
qs.stringify({a:"1=2", b:"Test 1"}); // gets a=1%3D2&b=Test+1 
```

它更容易与 JS 对象一起使用，它为所有参数提供了正确的 URL 编码

如果您使用的是 jQuery，我会选择[`$.param`](http://api.jquery.com/jquery.param/)方法。它的 URL 将对象映射字段编码为值，这比对每个值调用转义方法更容易阅读。

```
$.param({a:"1=2", b:"Test 1"}) // gets a=1%3D2&b=Test+1 
```

* * *

## 回答 #6

> 赞同：15
> 
>             
> 
> 时间：2019-11-15T14:30:50.973

# 现代解决方案 (2021)

由于编写了其他答案，因此引入了[URLSearchParams](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams/URLSearchParams) API。它可以这样使用：

```
const queryParams = { param1: 'value1', param2: 'value2' }
const queryString = new URLSearchParams(queryParams).toString()
// 'param1=value1&param2=value2' 
```

它还对非 URL 字符进行编码。

### 对于您的具体示例，您可以像这样使用它：

> ```
> const myUrl = "http://example.com/index.html?param=1&anotherParam=2";
> const myOtherUrl = new URL("http://example.com/index.html");
> myOtherUrl.search = new URLSearchParams({url: myUrl});
> console.log(myOtherUrl.toString()); 
> ```

[这里](https://stackoverflow.com/a/53171438/7284582)和[这里](https://stackoverflow.com/a/49701878)也提到了这个解决方案。

* * *

## 回答 #7

> 赞同：14
> 
>             
> 
> 时间：2015-10-01T08:03:26.453

encodeURIComponent() 是要走的路。

```
var myOtherUrl = "http://example.com/index.html?url=" + encodeURIComponent(myUrl); 
```

但是您应该记住，与 php 版本存在细微差别`urlencode()`，正如@CMS 所提到的，它不会对每个字符进行编码。http://phpjs.org/functions/urlencode/ 的人[使](http://phpjs.org/functions/urlencode/)js 等效于`phpencode()`：

```
function urlencode(str) {
  str = (str + '').toString();

  // Tilde should be allowed unescaped in future versions of PHP (as reflected below), but if you want to reflect current
  // PHP behavior, you would need to add ".replace(/~/g, '%7E');" to the following.
  return encodeURIComponent(str)
    .replace('!', '%21')
    .replace('\'', '%27')
    .replace('(', '%28')
    .replace(')', '%29')
    .replace('*', '%2A')
    .replace('%20', '+');
} 
```

* * *

## 回答 #8

> 赞同：12
> 
>             
> 
> 时间：2017-01-26T21:31:43.957

如前所述，要对 URL 进行编码，您有两个函数：

```
encodeURI() 
```

和

```
encodeURIComponent() 
```

两者都存在的原因是，第一个保留了 URL，可能会留下太多未转义的内容，而第二个则对所需的所有内容进行编码。

首先，您可以将新转义的 URL 复制到地址栏中（例如），它会起作用。但是，未转义的 '&' 会干扰字段分隔符，'=' 会干扰字段名称和值，并且 '+' 看起来像空格。但是对于简单的数据，当您想要保留您正在转义的 URL 特性时，这是可行的。

第二个是您需要做的一切，以确保字符串中的任何内容都不会干扰 URL。它使各种不重要的字符未转义，以便 URL 尽可能保持人类可读而不受干扰。以这种方式编码的 URL 将不再作为 URL 而不转义它。

因此，如果您可以花时间，您总是希望使用 encodeURIComponent() - 在添加名称/值对之前，使用此函数对名称和值进行编码，然后再将其添加到查询字符串中。

我很难找到使用 encodeURI() 的理由——我会把它留给更聪明的人。

* * *

## 回答 #9

> 赞同：6
> 
>             
> 
> 时间：2013-05-14T06:48:44.160

我用普通的javascript尝试过的类似的事情

```
function fixedEncodeURIComponent(str){
     return encodeURIComponent(str).replace(/[!'()]/g, escape).replace(/\*/g, "%2A");
} 
```

* * *

## 回答 #10

> 赞同：6
> 
>             
> 
> 时间：2017-01-05T18:49:48.467

为防止双重编码，最好在编码之前对 url 进行解码（例如，如果您正在处理用户输入的 url，它可能已经编码）。

假设我们有`abc%20xyz 123`输入（一个空格已经编码）：

```
encodeURI("abc%20xyz 123")            //   wrong: "abc%2520xyz%20123"
encodeURI(decodeURI("abc%20xyz 123")) // correct: "abc%20xyz%20123" 
```

* * *

## 回答 #11

> 赞同：6
> 
>             
> 
> 时间：2018-09-23T08:35:26.780

## 什么是 URL 编码：

当 URL 中存在特殊字符时，应该对 URL 进行编码。例如：

```
console.log(encodeURIComponent('?notEncoded=&+'));
```

我们可以在这个例子中观察到，除了字符串之外的所有字符`notEncoded`都用 % 符号编码。URL 编码也称为**百分比编码**，因为它使用 % 转义所有特殊字符。然后在这个 % 符号之后，每个特殊字符都有一个唯一的代码

## 为什么我们需要 URL 编码：

某些字符在 URL 字符串中具有特殊值。例如，? 字符表示查询字符串的开始。为了在网络上成功定位资源，必须区分字符是作为字符串的一部分还是作为 url 结构的一部分。

## 我们如何在 JS 中实现 URL 编码：

JS 提供了一系列内置实用程序函数，我们可以使用它们轻松地对 URL 进行编码。这是两个方便的选项：

1.  `encodeURIComponent()`: 将 URI 的一个组成部分作为参数并返回编码后的 URI 字符串。

2.  `encodeURI()`：将 URI 作为参数并返回编码后的 URI 字符串。

## 示例和注意事项：

请注意不要将整个 URL（包括方案，例如 https://）传递到`encodeURIComponent()`. 这实际上可以将其转换为无效的 URL。例如：

```
// for a whole URI don't use encodeURIComponent it will transform
// the / characters and the URL won't fucntion properly
console.log(encodeURIComponent("http://www.random.com/specials&char.html"));

// instead use encodeURI for whole URL's
console.log(encodeURI("http://www.random.com/specials&char.html"));
```

我们可以观察到，我们将整个 URL 放入`encodeURIComponent`其中，正斜杠 (/) 也被转换为特殊字符。这将导致 URL 不再正常工作。

因此（顾名思义）使用：

1.  `encodeURIComponent`在您要编码的 URL 的某个部分上。

2.  `encodeURI`在要编码的整个 URL 上。

* * *

## 回答 #12

> 赞同：5
> 
>             
> 
> 时间：2020-05-16T20:49:32.173

*你不应该`encodeURIComponent()`直接使用。*

[查看 RFC3986：统一资源标识符 (URI)：通用语法](https://www.rfc-editor.org/rfc/rfc3986)

> 子分隔符=“！” /“$”/“&”/“'”/“（”/“）”/“*”/“+”/“”/“;” /“=”
> 
> 保留字符的目的是提供一组可与 URI 中的其他数据区分开来的定界字符。

***RFC3986 中 URI 定义中的这些保留字符不会被`encodeURIComponent()`.***

[MDN 网络文档：encodeURIComponent()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)

> 为了更加严格地遵守 RFC 3986（保留 !、'、(、) 和 *），即使这些字符没有正式的 URI 分隔用途，也可以安全地使用以下内容：

使用 MDN Web Docs 功能...

```
function fixedEncodeURIComponent(str) {
  return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
    return '%' + c.charCodeAt(0).toString(16);
  });
} 
```

* * *

## 回答 #13

> 赞同：4
> 
>             
> 
> 时间：2021-07-01T13:11:12.947

我认为现在在 2021 年非常安全，您应该始终考虑使用[`URL()`interface](https://developer.mozilla.org/en-US/docs/Web/API/URL)构建您的 URL 。它会为你完成大部分工作。所以来到你的代码，

```
const baseURL = 'http://example.com/index.html';

const myUrl = new URL(baseURL);
myUrl.searchParams.append('param', '1');
myUrl.searchParams.append('anotherParam', '2');

const myOtherUrl = new URL(baseURL);
myOtherUrl.searchParams.append('url', myUrl.href);

console.log(myUrl.href);
// Outputs: http://example.com/index.html?param=1&anotherParam=2
console.log(myOtherUrl.href);
// Outputs: http://example.com/index.html?url=http%3A%2F%2Fexample.com%2Findex.html%3Fparam%3D1%26anotherParam%3D2
console.log(myOtherUrl.searchParams.get('url'));
// Outputs: http://example.com/index.html?param=1&anotherParam=2 
```

或者..

```
const params = new URLSearchParams(myOtherUrl.search);

console.log(params.get('url'));
// Outputs: http://example.com/index.html?param=1&anotherParam=2 
```

这样的事情保证不会失败。

* * *

## 回答 #14

> 赞同：3
> 
>             
> 
> 时间：2012-06-22T03:28:01.250

没有什么对我有用。我所看到的只是登录页面的 HTML，返回到客户端的代码为 200。（起初是 302，但相同的 Ajax 请求在另一个 Ajax 请求中加载登录页面，这应该是重定向而不是加载普通登录页面的文本）。

在登录控制器中，我添加了这一行：

```
Response.Headers["land"] = "login"; 
```

在全局 Ajax 处理程序中，我这样做了：

```
$(function () {
    var $document = $(document);
    $document.ajaxSuccess(function (e, response, request) {
        var land = response.getResponseHeader('land');
        var redrUrl = '/login?ReturnUrl=' + encodeURIComponent(window.location);
        if(land) {
            if (land.toString() === 'login') {
                window.location = redrUrl;
            }
        }
    });
}); 
```

现在我没有任何问题，它就像一个魅力。

* * *

## 回答 #15

> 赞同：3
> 
>             
> 
> 时间：2015-09-10T06:41:37.530

**编码 URL 字符串**

```
    var url = $(location).attr('href'); //获取当前网址
    //或者
    var url = '文件夹/index.html?param=#23dd&noob=yes'; //或指定一个

`var encodedUrl = encodeURIComponent(url);
console.log(encodedUrl);
//outputs folder%2Findex.html%3Fparam%3D%2323dd%26noob%3Dyes

for more info go http://www.sitepoint.com/jquery-decode-url-string` 

            回答 #16

赞同：3

时间：2019-02-09T10:26:42.870

这是一个和JS 内置函数的[LIVE DEMO ：](https://codverter.com/src/webeditor?query=64199300-c557-4048-b924-c2561dcfbf17)`encodeURIComponent()``decodeURIComponent()`

```
<!DOCTYPE html>
<html>
  <head>
    <style>
      textarea{
        width:30%;
        height:100px;
      }
    </style>
    <script>
      // encode string to base64
      function encode()
      {
        var txt = document.getElementById("txt1").value;
        var result = btoa(txt);
        document.getElementById("txt2").value = result;
      }
      // decode base64 back to original string
      function decode()
      {
        var txt = document.getElementById("txt3").value;
        var result = atob(txt);
        document.getElementById("txt4").value = result;
      }
    </script>
  </head>
  <body>
    <div>
      <textarea id="txt1">Some text to decode
      </textarea>
    </div>
    <div>
      <input type="button" id="btnencode" value="Encode" onClick="encode()"/>
    </div>
    <div>
      <textarea id="txt2">
      </textarea>
    </div>
    <br/>
    <div>
      <textarea id="txt3">U29tZSB0ZXh0IHRvIGRlY29kZQ==
      </textarea>
    </div>
    <div>
      <input type="button" id="btndecode" value="Decode" onClick="decode()"/>
    </div>
    <div>
      <textarea id="txt4">
      </textarea>
    </div>
  </body>
</html> 
```

            回答 #17

赞同：3

时间：2020-06-12T08:40:32.597

表现

今天（2020.06.12）我在浏览器 Chrome 83.0、Safari 13.1、Firefox 77.0 上对 MacOs HighSierra 10.13.6 上的所选解决方案进行速度测试。此结果可用于大量 url 编码。

结论

*   `encodeURI`(B) 似乎最快但不[推荐用于 url-s](https://stackoverflow.com/a/332897/860099)  
*   `escape`(A) 快速跨浏览器解决方案
*   [MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent)推荐的解决方案F是中快
*   解决方案 D 最慢

[![在此处输入图像描述](https://i.stack.imgur.com/Z9Xjl.png)](https://i.stack.imgur.com/Z9Xjl.png)

细节

对于解决方案 
[A](https://stackoverflow.com/a/332897/860099) 
[B](https://stackoverflow.com/a/332897/860099) 
[C](https://stackoverflow.com/a/332888/860099) 
[D](https://stackoverflow.com/a/58879100/860099) 
[E](https://stackoverflow.com/a/16536783/860099) 
[F](https://stackoverflow.com/a/61843371/860099)
我执行两个测试

*   对于短 url - 50 char - 你可以在[这里运行它](https://jsbench.me/9hkbbw4580/1)
*   对于长 url - 1M char - 你可以在[这里运行它](https://jsbench.me/ffkbbw662s/1)

```
function A(url) {
	return escape(url);
}

function B(url) {
	return encodeURI(url);
}

function C(url) {
	return encodeURIComponent(url);
}

function D(url) {
	return new URLSearchParams({url}).toString();
}

function E(url){
     return encodeURIComponent(url).replace(/[!'()]/g, escape).replace(/\*/g, "%2A");
}

function F(url) {
  return encodeURIComponent(url).replace(/[!'()*]/g, function(c) {
    return '%' + c.charCodeAt(0).toString(16);
  });
}

// ----------
// TEST
// ----------

var myUrl = "http://example.com/index.html?param=1&anotherParam=2";

[A,B,C,D,E,F]
  .forEach(f=> console.log(`${f.name} ?url=${f(myUrl).replace(/^url=/,'')}`));
```

```
This snippet only presents code of choosen solutions
```

Chrome 的示例结果

[![在此处输入图像描述](https://i.stack.imgur.com/HBWv9.png)](https://i.stack.imgur.com/HBWv9.png)

            回答 #18

赞同：2

时间：2016-09-27T15:59:49.347

您可以使用 esapi 库并使用以下函数对您的 url 进行编码。该函数确保在编码其余文本内容时不会丢失“/”：

```
function encodeUrl(url)
{
    String arr[] = url.split("/");
    String encodedUrl = "";
    for(int i = 0; i<arr.length; i++)
    {
        encodedUrl = encodedUrl + ESAPI.encoder().encodeForHTML(ESAPI.encoder().encodeForURL(arr[i]));
        if(i<arr.length-1) encodedUrl = encodedUrl + "/";
    }
    return url;
} 
```

[https://www.owasp.org/index.php/ESAPI_JavaScript_Readme](https://www.owasp.org/index.php/ESAPI_JavaScript_Readme)

            回答 #19

赞同：2

时间：2019-10-05T20:48:17.267

使用`fixedEncodeURIComponent`函数严格遵守[RFC 3986](https://www.rfc-editor.org/rfc/rfc3986)：

```
function fixedEncodeURIComponent(str) {
  return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
    return '%' + c.charCodeAt(0).toString(16);
  });
} 
```

            回答 #20

赞同：1

时间：2020-08-18T22:57:12.750

```
var myOtherUrl = 
   "http://example.com/index.html?url=" + encodeURIComponent(myUrl).replace(/%20/g,'+'); 
```

不要忘记 /g 标志来替换所有编码的 ' '

            回答 #21

赞同：-1

时间：2020-12-11T03:24:55.120

我总是用它来为 URL 编码东西。这是完全安全的，因为即使不需要编码，它也会对每个字符进行编码。

```
function urlEncode(text) {
    let encoded = '';
    for (let char of text) {
        encoded += '%' + char.charCodeAt(0).toString(16);
    }
    return encoded;
} 
```

        .net - .Net 数组的 LongLength 的目的是什么？

ID：332874

赞同：5

时间：2008-12-02T02:38:14.570

标签：.net, arrays, memory

.Net 中数组的 LongLength 属性的目的是什么。使用标准整数作为长度，您可以容纳多达 20 亿个索引。真的有人使用 .Net 来维护一个包含超过 20 亿个元素的数组。即使每个元素都是一个字节，那仍然是 2 GB 的数据。在.Net中使用这么大的数组是否可行？

            回答 #1

赞同：5

时间：2008-12-02T02:44:59.487

例如，如果您有一个大于 2 GB 的文件并且需要一次将其全部读入内存，则需要这样的数组。并不是说这在大多数情况下一定是推荐的方法，但很可能在某些情况下（在一个足够强大的 64 位系统上，无论如何都有大量内存）这可能是必需的（可能是出于性能原因？）。

编辑：当然，应该注意的是，从 CLR 2.0 开始，实际上不支持大于 2 GB 的数组（LongLength 的所有实现都是将 Length 转换为 long，尝试创建更大的数组将失败） ...但也许微软计划稍后添加支持...？

            回答 #2

赞同：5

时间：2008-12-02T04:57:18.703

有一个学派被称为“0、1 或 N”学派，它认为你应该一无所有；某事之一；或*任何*数量的东西，只要资源允许。

换句话说，如果没有必要，不要设置任意限制。任意限制给了我们这样的怪物：

*   早期 PC 的 640K 限制。
*   缓冲区溢出漏洞。
*   可怕的 CHS 磁盘寻址方案。

请记住，即使是 20 亿个 64 位整数也只占用

```
 17,179,869,184 bytes of the
18,446,744,073,709,551,616 bytes of 64-bit address space available. 
```

这不到百万分之一，即 10 ^(-9) ，或者在地址空间用完之前，您可能拥有*数百万个这样的大型阵列。*

            回答 #3

赞同：3

时间：2008-12-02T02:48:26.063

另外，它返回数组**所有**维度中的元素**总数**，因此它可以是一个具有“仅”十亿个元素和 4 个维度的数组，使其需要为 64 位 int。 * * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T02:41:19.493

在 64 位场景中，很有可能拥有一个包含超过 20 亿个条目的数组。LongLength 确实是为了支持这种情况。

至于是否实际使用。我可以肯定地说，在某个地方，有一些客户认为这是一项至关重要的业务需求。客户发现您从未想过的功能的用途。

# sharepoint - Microsoft.Sharepoint.dll 的位置在哪里

> ID：332906
> 
>         
> 
> 赞同：43
> 
>         
> 
> 时间：2008-12-02T02:56:02.537
> 
>         
> 
> 标签：sharepoint

我刚刚在我的机器上安装了 SharePoint SDK，但我似乎找不到 Microsoft.Sharepoint.dll 的位置，因此我可以添加对它的引用。

它不在 GAC 或 C:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\12\ISAPI\ 中，搜索结果一无所获。

有什么建议么？

* * *

## 回答 #1

> 赞同：47
> 
>             
> 
> 时间：2008-12-02T05:19:33.357

仅供参考，我在安装 SharePoint 的服务器上找到它：

E:\Program Files\Common Files\Microsoft Shared\web 服务器扩展\12\ISAPI

* * *

## 回答 #2

> 赞同：21
> 
>             
> 
> 时间：2008-12-02T03:39:27.083

dll 位于安装 SharePoint 的服务器上。您不应该在台式机上开发，创建安装了 SharePointserver 的虚拟机并在那里工作。
[请参阅：http://weblogs.asp.net/erobillard/archive/2007/02/23/build-a-sharepoint-development-machine.aspx](http://weblogs.asp.net/erobillard/archive/2007/02/23/build-a-sharepoint-development-machine.aspx)

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-12-02T03:35:14.360

无论如何，它可能会显示在“添加参考”对话框中 - 99% 的时间你不需要知道物理位置。查看按字母顺序排列的“.Net”列表。

我假设 SDK 安装程序会断言这一点，但 Sharepoint 开发还需要服务器操作系统。

# svn - 合并多个 SVN 项目

> ID：332908
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-12-02T02:58:34.607
> 
>         
> 
> 标签：svn, version-control, svn-administraton

我正在为一个未使用单个顶级目录导入源的项目管理 svn 存储库。结果，大约有 15 个独立的“项目”，而不是一个。如何在保留更改历史记录的同时将它们合并到一个文件夹中？

*提示：svn move 在这种情况下不起作用。

[编辑] 哎呀，愚蠢的[将多个 SVN 存储库合并为一个](https://stackoverflow.com/questions/267256/combining-multiple-svn-repositories-into-one)

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-12-02T03:09:41.667

如果您不关心保留其中一个存储库的所有历史记录，您可以在一个项目的存储库下创建一个新目录，然后导入另一个。

如果您关心保留两者的历史记录，那么您可以使用 'svnadmin dump' 转储一个存储库，并使用 'svnadmin load' 将其加载到另一个存储库。修订号将关闭，但您仍将拥有历史记录。

从这里复制：[http ://subversion.tigris.org/faq.html#multi-merge](http://subversion.tigris.org/faq.html#multi-merge)

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-12-02T03:10:28.827

也许我在分布式版本控制锤上工作太多了，我现在看到的只是分布式钉子。但我再次不得不说，这可能是 DVCS 的工作。

我会尝试弄乱 git-svn 或类似的东西。将每个“项目”导入其自己的 git 存储库，然后将它们相互 git pull。解决任何冲突，一切完成后，将历史记录导入 Subversion。

但是，在您完成合并所有存储库之后，您的团队可能最好只使用分布式控制......

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T03:29:03.517

您可以创建一个新的顶级项目，使用 svn:externals 指向所有其他项目并将它们放在适当的子目录中。

*   开发人员只需要检查您的新顶级项目（svn 将自动跟随 svn:externals 并拉入其他项目）

*   完整的版本历史将被保留，新的更改将自动提交到相关子项目

*   实施大约需要 5 分钟（创建新的顶级项目并运行`svn propedit svn:externals top_dir`）。

# java - Java 保护访问不起作用

> ID：332920
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-12-02T03:08:05.743
> 
>         
> 
> 标签：java, inheritance, visibility, protected, access-levels

在java中，访问权限分为三个级别：

*   公开 - 向世界开放

*   私人 - 只对班级开放

*   受保护 - 仅对类及其子类（继承）开放。

那么为什么 java 编译器允许这种情况发生呢？

TestBlah.java：

```
public class TestBlah {

    public static void main(String[] args) {
        Blah a = new Blah("Blah");
        Bloo b = new Bloo("Bloo");
        System.out.println(a.getMessage());
        System.out.println(b.getMessage()); //Works
        System.out.println(a.testing);
        System.out.println(b.testing); //Works
    }
} 
```

废话.java：

```
public class Blah {
    protected String message;

    public Blah(String msg) {
        this.message = msg;
    }

    protected String getMessage(){
        return(this.message);
    }   
} 
```

布卢.java：

```
public class Bloo extends Blah {
    public Bloo(String testing) {
        super(testing);
    }
} 
```

* * *

## 回答 #1

> 赞同：14
> 
>             
> 
> 时间：2008-12-02T03:20:08.200

其实应该是：

> 仅对类及其子类（继承）[**同一个包上的类开放**](http://java.sun.com/docs/books/tutorial/java/javaOO/accesscontrol.html)

这就是为什么

* * *

## 回答 #2

> 赞同：11
> 
>             
> 
> 时间：2008-12-02T03:18:18.467

因为受保护的意思是同一个包中的子类*或*其他类。

当修饰符被省略时，实际上还有第四个“默认”访问级别，它提供对同一包中其他类的访问。

`protected`在默认和`public`访问之间也是如此。

* * *

## 回答 #3

> 赞同：5
> 
>             
> 
> 时间：2008-12-02T03:44:13.267

更具体地说，您期望`protected`像在 C++ 中那样工作。  

但是，在 Java 中，它具有不同的含义。在 Java 中，类（显然）、同一包中的所有其他类以及该类的任何子类都可以使用受保护的方法。其他包中的类将无权访问，除非它们是这个原始类的子类。

[有关继承标记的更多具体信息，请参阅此类似问题](https://stackoverflow.com/questions/215497/in-java-whats-the-difference-between-public-default-protected-and-private)。

就个人而言，我几乎从不使用`protected`. 我开发应用程序而不是框架，因此我更有可能定义`public`方法、`private`数据，并且经常将我的整个类标记为`final`.

* * *

## 回答 #4

> 赞同：5
> 
>             
> 
> 时间：2008-12-02T04:15:21.923

实际上有四个访问级别：“公共”、“受保护”、“私有”和默认也称为包私有或包保护。默认限制对包的可访问性。默认非常有用，我经常使用它。

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2008-12-02T03:23:24.150

您可以调用`b.getMessage()`，因为`b`它的类型`Bloo`是扩展`Blah`，并且`getMessage()`受到保护。正如您所提到的，受保护的允许子类访问该方法。

但是，您有以下错误：

*   `super()`在构造函数中不带参数调用`Bloo`是错误的。编译器找不到无参数`Blah`构造函数，因为您定义了一个带有字符串参数的构造函数。

*   `new Blah()`由于与上述相同的原因，调用`TestBlah` `main`方法是错误的。

*   引用`a.testing`and`b.testing`是一个错误，因为您没有`testing`为任何类定义变量。

# .net - .NET 开发环境的最佳 Windows Server 2008 配置是什么？

> ID：332925
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-12-02T03:10:26.097
> 
>         
> 
> 标签：.net, windows-server-2008

作为 .NET 开发人员和数据库环境，我想尝试一下 Windows Server 2008。

我想知道哪种配置最适合服务器：

*   **服务：**哪些是不必要的，可以关闭以提高性能？

*   **软件：**什么软件最适合服务器，有利于扩大开发范围（Sharepoint、SQL Server、VS2008、Azure）？

*   **调整：**我知道有一种[工具](http://www.win2008workstation.com/wordpress/)可以让服务器更像工作站。还有什么类似的吗？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-12-02T03:49:33.380

实际上，Windows Server 2008 的默认安装并没有开始运行许多服务。只需添加测试项目所需的角色。

如果您想最小化运行服务的数量，那么您不想将服务器调整为工作站。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-12-18T04:34:41.160

不要忘记。64位！用尽可能多的 RAM 塞满东西！

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-03-23T10:33:43.893

不要激活 Superfetch。每次系统启动时，它都会为您的磁盘加载很长时间的工作。

不要添加“寡妇资源管理器”功能，从它的描述中听起来很有吸引力。它将带来 8-12% 范围内的永久 CPU 负载。

# svn - 有没有一种优雅的方法来停止 svnserve -d

> ID：332930
> 
>         
> 
> 赞同：27
> 
>         
> 
> 时间：2008-12-02T03:13:52.190
> 
>         
> 
> 标签：svn, svnserve

我正在寻找类似的东西：

```
svnserve stop 
```

* * *

## 回答 #1

> 赞同：27
> 
>             
> 
> 时间：2008-12-02T03:22:26.337

推荐的方法是使用`kill`允许 subversion 正确关闭的命令。我认为没有更好的方法可以做到这一点。

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2014-07-21T10:01:48.627

您可以使用该`start-stop-daemon`程序来做到这一点：

```
/sbin/start-stop-daemon --stop --exec /usr/bin/svnserve 
```

要启动它：

```
 /sbin/start-stop-daemon --start --chuid svn:svn --exec /usr/bin/svnserve -- -d -r /var/svn 
```

当然你可以调整用户和组（`svn:svn`），以及SVN根路径（`/var/svn`）

`/etc/init.d/svnserve`这些脚本是我在所有 SVN 服务器上用来管理守护程序的另一个脚本的一部分。有关更多说明，请参阅[此 Ubuntu 文档](http://doc.ubuntu-fr.org/subversion)。

* * *

## 回答 #3

> 赞同：5
> 
>             
> 
> 时间：2015-03-25T16:12:16.457

你可以使用命令：   ***ps aux | grep svnserve***获取 svnserve 进程 ID  

然后：kill -9 [ID_of_svnserve_process]

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2020-06-24T21:20:02.150

还有ps辅助| grep -e PID -e svnserve 可能对显示标题很有用。

# php - XML/Parser.php 安装

> ID：332936
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-12-02T03:21:03.423
> 
>         
> 
> 标签：php, xml, linux, installation, pear

我最近使用 Linux 和 PHP 5 与 godaddy 注册了共享网络托管。我想使用多个 RSS 提要。我以前在 Apache 下运行这一切，但是，主机提供了 PEAR 安装。现在我必须自己做这件事，而且我在陌生的领域。我安装了 PEAR PHP 并设法在 pear 目录中获取 rss.php。它现在要求 XML/Parser.php，我不想再花一周时间寻找在哪里以及做什么。你能告诉我在哪里可以找到这个例程，用 ftp 将它复制到 PEAR 目录中是否有任何问题？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T07:17:33.837

你总是可以在你的项目中创建一些子文件夹并直接在那里提取任何 PEAR 库，它只是普通的 php 脚本。您必须将该文件夹（和子文件夹）添加到您的包含路径中，以便可以访问所有内容。这被认为是一种不好的做法，因为您将不得不手动更新 PEAR 库和东西，但它使您独立于您的主机。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T14:26:15.983

您的 PEAR（或其他库）类可以在任何地方。您只需要设置正确的包含路径，脚本将在其中搜索所需的代码。如果您无法访问 php.ini，您可以使用`get_include_path()`函数获取包含路径并使用设置它们`set_include_path();`

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T14:54:42.820

我强烈推荐 SimplePie 提要解析器而不是 PEAR::XML_Feed_Parser。通常 PEAR 库很棒，但它们不支持几种常见类型的提要（我相信 Atom 0.3 以及其他几种）。此外，关于如何使用它以及（清楚地）如何安装它的文档也很少。

只需包含 SimplePie 库并将其指向您的提要，剩下的就交给它了。无论架构差异如何，都可以轻松查询所需的任何数据。它也非常快，我们正在使用它在[http://www.feedscrub.com](http://www.feedscrub.com)上聚合数百个提要。

希望有帮助！

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T18:36:49.627

```
echo ini_get('include_path'); 
```

这应该在原始主机环境中显示 PEAR 的包含路径，如果它不是很大的话，只需用 tar -cjzf devPear.tar.bz path2pear/ 将整个混乱包裹起来。   

将此 tar 文件复制到 GoDaddy，解压缩到安全位置...然后在 .htaccess 中或在应用程序脚本的起点，将此 pear 包添加到您的 include_path 中。

或者：如果您有管理权限，我相信有一个名为“已安装”的 pear.php 命令会显示所有已安装的 pear 包。如果您在新环境中也有 pear 管理权限，您可以继续复制和粘贴您需要的包名称到 pear --install "package" name。

第二个更干净一些，但第一个会更快......只要接受这些包将有效地从梨系统中搁浅并且无法更新。

# c++ - 为什么我的 Visual Studio .obj 文件比输出的 .exe 文件大？

> ID：332946
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2008-12-02T03:25:27.563
> 
>         
> 
> 标签：c++, visual-studio, visual-studio-2008

作为背景，我是一个开源项目的开发人员，一个名为[openframeworks](http://www.openframeworks.cc "开放框架")的 c++ 库，它是不同库的包装器，如 opengl、quicktime、freeImage 等。在下一个版本中，我们添加了一个名为 POCO 的 c++ 库，这在某些方面类似于 boost，因为它是 java 基础库类型功能的替代方案。

我刚刚注意到，在这个最新版本中，我将 POCO 库添加为静态链接库，在编译过程中生成的 .obj 文件非常庞大 - 例如，几个 .obj 文件真的小 .cpp 文件每个为 2mb。整体编译的 .obj 文件大约 12mb 左右。另一方面，生成的 exe 文件很小 - 300k 到 1mb。  

相比之下，在 code::blocks 中编译的同一个库生成的 .obj 文件在 exe 中的大小大致相同——它们都相当小。

链接和视觉工作室中的 .obj 进程是否发生了我不理解的事情？例如，它是否在做某种智能预链接或其他增加 .obj 大小的事情？我已经尝试了一些设置，例如增量链接等，但没有看到任何变化。

提前感谢您提供任何尝试或见解的想法！

-扎克

* * *

*注：非常感谢！我刚刚尝试过，dumpbin，它说“匿名对象”并且不返回有关该对象的信息。  [这](http://social.msdn.microsoft.com/Forums/en-US/vcgeneral/thread/3c472c55-25f5-461a-b3be-97d6239e7b49/)可能是为什么......*

* * *

*注意 2，在检查了上面的链接之后，删除 LTCG（链接时间代码生成 - /GL）后，.obj 文件要小得多，dumpbin 可以理解它们。再次感谢 ！！*

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T03:29:29.507

无论如何，我都不是 Visual Studio 专家，几乎没有使用过它，但我相信 Visual Studio 采用了链接时优化，这可以使生成的代码运行得更快，但会占用库中的大量空间。此外，可能是（我不知道内部情况）调试信息直到实际链接阶段才被剥离。

无论如何，我相信有人会提供更好/更详细的答案。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T05:22:44.723

可能区别在于调试信息。

编译器将调试信息输出到 .obj 中，但链接器不会将该数据放入 .exe 或 .dll 中。它要么被丢弃，要么被放入 .pdb。

在任何情况下，使用 .obj 文件上的 Visual Studio DUMPBIN 实用程序来查看其中的内容。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T12:50:44.723

目标文件需要包含足够的链接信息。在 C++ 中，这是基于名称的。如果两个对象文件使用相同的名称，则它们引用相同的对象（数据/函数/类）。这意味着所有对象文件必须包含可能被其他对象文件引用的所有对象的名称。然而，可执行文件需要从库外部可见的名称。在 DLL 的情况下，这意味着仅导出的名称。节省是双重的：名称较少，并且这些名称在 DLL 中只出现一次。

现代 C++ 库将使用命名空间。这些命名空间意味着对象名称变得更长，因为它们也包括封装命名空间的名称。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T03:31:55.320

编译后的库 obj 文件会很大，因为它们必须包含最终用户可能最终使用的所有函数、类和模板。

链接到你的库的可执行文件会更小，因为它们只包含它们运行所需的编译代码。这通常是库的一小部分。

# delphi - 为什么 CharInSet 比 Case 语句快？

> ID：332948
> 
>         
> 
> 赞同：18
> 
>         
> 
> 时间：2008-12-02T03:26:32.320
> 
>         
> 
> 标签：delphi, delphi-2009, case-statement

我很困惑。今天在 CodeRage，Marco Cantu 说 CharInSet 很慢，我应该尝试使用 Case 语句。我在我的解析器中这样做了，然后用 AQTime 检查了加速是什么。我发现 Case 语句要慢得多。

4,894,539 次处决：

> 而不是 CharInSet (P^, [' ', #10,#13, #0]) 做 inc(P);

时间为 0.25 秒。

但相同数量的执行：

> 而 True do 
> 
>     case P^ of 
> 
>       ' ', #10, #13, #0: break; 
> 
>       其他公司（P）；
> 
>     结尾;

“while True”需要 0.16 秒，第一种情况需要 0.80 秒，else 情况需要 0.13 秒，总共需要 1.09 秒，或超过 4 倍。

CharInSet 语句的汇编代码是：

> add edi,$02 
> 
>   mov edx,$0064b290 
> 
>   movzx eax,[edi] 
> 
>   call CharInSet 
> 
>   test a1,a1 
> 
>   jz $00649f18（回到add语句）

而案例逻辑就是这样：

> movzx eax,[edi] 
> 
>   sub ax,$01 
> 
>   jb $00649ef0 
> 
>   sub ax,$09 
> 
>   jz $00649ef0 
> 
>   sub ax,$03 
> 
>   jz $00649ef0 
> 
>   add edi,$02 
> 
>   jmp $00649ed6（回到 movzx 语句）

在我看来，案例逻辑使用了非常高效的汇编程序，而 CharInSet 语句实际上必须调用 CharInSet 函数，该函数位于 SysUtils 中，也很简单，即：

> 函数 CharInSet(C: AnsiChar; const CharSet: TSysCharSet): 布尔值; 
> 
>   开始
> 
>     Result := C in CharSet; 
> 
>   结尾;

我认为这样做的唯一原因是因为 [' ', #10, #13, #0] 中的 P^ 在 Delphi 2009 中不再允许，因此调用会转换类型以允许它。

尽管如此，我对此感到非常惊讶，但仍然不相信我的结果。

AQTime 测量是否有问题，我是否在比较中遗漏了什么，或者 CharInSet 真的是一个值得使用的高效函数？

* * *

结论：

我想你明白了，巴里。感谢您抽出宝贵时间做详细的示例。我在我的机器上测试了你的代码，得到了 0.171、0.066 和 0.052 秒（我猜我的台式机比你的笔记本电脑快一点）。

在 AQTime 中测试该代码，它给出了：三个测试的 0.79、1.57 和 1.46 秒。在那里，您可以看到仪器的大量开销。但真正让我吃惊的是，这种开销将明显的“最佳”结果更改为实际上是最差的 CharInSet 函数。

所以 Marcu 是正确的，而 CharInSet 更慢。但是您无意中（或者可能是故意）通过提取 CharInSet 对 Set 方法中的 AnsiChar(P^) 所做的事情，给了我一个更好的方法。除了与 case 方法相比速度稍有优势之外，它还比使用 case 方法更少的代码和更易于理解。

您还让我意识到使用 AQTime（和其他检测分析器）进行错误优化的可能性。知道这一点将有助于我[对 Delphi 的 Profiler 和内存分析工具](https://stackoverflow.com/questions/291631/profiler-and-memory-analysis-tools-for-delphi)做出决定，这也是对我的问题[AQTime 如何做到这一点的另一个答案？](https://stackoverflow.com/questions/322315/how-does-aqtime-do-it). 当然，AQTime 在检测时不会更改代码，因此它必须使用其他魔法来完成。

所以答案是 AQTime 显示的结果会导致错误的结论。

* * *

跟进：我留下了这个问题，“指责”AQTime 结果可能具有误导性。但公平地说，我应该指导您阅读这个问题：[Delphi 是否有快速 GetToken 例程？](https://stackoverflow.com/questions/1694001/is-there-a-fast-gettoken-routine-for-delphi)它开始认为 AQTime 给出了误导性的结果，并得出结论认为它没有。

* * *

## 回答 #1

> 赞同：26
> 
>             
> 
> 时间：2008-12-02T03:42:35.237

AQTime 是一个检测分析器。检测分析器通常不适合测量代码时间，尤其是在像您这样的微基准测试中，因为检测的成本通常超过被测量的成本。另一方面，检测分析器擅长分析内存和其他资源使用情况。

定期检查 CPU 位置的采样分析器通常更适合测量代码时间。

无论如何，这是另一个微基准，它确实表明`case`语句比`CharInSet`. 但是，请注意集合检查仍然可以与类型转换一起使用以消除截断警告（实际上这是 CharInSet 存在的唯一原因）：

```
{$apptype console}

uses Windows, SysUtils;

const
  SampleString = 'foo bar baz blah de;blah de blah.';

procedure P1;
var
  cp: PChar;
begin
  cp := PChar(SampleString);
  while not CharInSet(cp^, [#0, ';', '.']) do
    Inc(cp);
end;

procedure P2;
var
  cp: PChar;
begin
  cp := PChar(SampleString);
  while True do
    case cp^ of
      '.', #0, ';':
        Break;
    else
      Inc(cp);
    end;
end;

procedure P3;
var
  cp: PChar;
begin
  cp := PChar(SampleString);
  while not (AnsiChar(cp^) in [#0, ';', '.']) do
    Inc(cp);
end;

procedure Time(const Title: string; Proc: TProc);
var
  i: Integer;
  start, finish, freq: Int64;
begin
  QueryPerformanceCounter(start);
  for i := 1 to 1000000 do
    Proc;
  QueryPerformanceCounter(finish);
  QueryPerformanceFrequency(freq);
  Writeln(Format('%20s: %.3f seconds', [Title, (finish - start) / freq]));
end;

begin
  Time('CharInSet', P1);
  Time('case stmt', P2);
  Time('set test', P3);
end. 
```

它在我的笔记本电脑上的输出是：

```
CharInSet: 0.261 seconds
case stmt: 0.077 seconds
 set test: 0.060 seconds 
```

* * *

## 回答 #2

> 赞同：8
> 
>             
> 
> 时间：2008-12-02T09:55:53.877

Barry，我想指出，您的基准测试并不能反映各种方法的实际性能，因为实现的结构不同。相反，所有方法都应使用“while True do”构造，以更好地反映执行 char-in-set 检查的不同方法的影响。

这里替换了测试方法（P2 未更改，P1 和 P3 现在使用“while True do”构造）：

```
procedure P1;
var
  cp: PChar;
begin
  cp := PChar(SampleString);
  while True do
    if CharInSet(cp^, [#0, ';', '.']) then
      Break
    else
      Inc(cp);
end;

procedure P2;
var
  cp: PChar;
begin
  cp := PChar(SampleString);
  while True do
    case cp^ of
      '.', #0, ';':
        Break;
    else
      Inc(cp);
    end;
end;

procedure P3;
var
  cp: PChar;
begin
  cp := PChar(SampleString);
  while True do
    if AnsiChar(cp^) in [#0, ';', '.'] then
      Break
    else
      Inc(cp);
end; 
```

我的工作站提供：

```
CharInSet: 0.099 seconds
case stmt: 0.043 seconds
 set test: 0.043 seconds 
```

哪个更符合预期结果。对我来说，似乎使用“case in”构造并没有真正帮助。对不起马可！

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2008-12-11T13:54:05.387

Delphi 的免费采样分析器可以在这里找到：

[https://forums.codegear.com/thread.jspa?messageID=18506](https://forums.codegear.com/thread.jspa?messageID=18506)

除了仪器分析器的时间测量不正确的问题之外，应该注意的是，哪个更快还取决于“案例”分支的可预测性。如果“case”中的测试都遇到相似的概率，“case”的性能最终可能低于 CharInSet。

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-01-05T11:50:45.077

函数“CharInSet”中的代码比“case”快，时间花在“call”上，使用while not（cp^ in [..]）然后

你会看到这是禁食。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T03:46:43.107

据我所知，如果调用都使用短指针，则调用与跳转所需的处理器操作数量相同。与长指针可能不同。默认情况下，汇编程序中的调用不使用堆栈。如果有足够的空闲寄存器使用寄存器。所以堆栈操作也需要零时间。它只是非常快的寄存器。

相比之下，我看到的情况变体使用 add 和 sub 操作，这些操作非常慢，可能会增加大部分额外时间。

# search - O(1) 怎么了？

> ID：332952
> 
>         
> 
> 赞同：48
> 
>         
> 
> 时间：2008-12-02T03:29:44.123
> 
>         
> 
> 标签：search, collections, complexity-theory, data-access

在讨论涉及散列和搜索类型的算法时，我注意到 O(1) 的一些非常奇怪的用法，通常是在使用语言系统提供的字典类型或使用数组使用的字典或散列数组类型的上下文中-索引符号。

基本上，O(1) 意味着以恒定时间和（通常）固定空间为界。一些非常基本的操作是 O(1)，尽管使用中间语言和特殊 VM 往往会扭曲这里的想法（例如，如何将垃圾收集器和其他动态过程摊销到 O(1) 活动中）。

但是忽略延迟、垃圾收集等的摊销，我仍然不明白如何假设某些涉及某种搜索的技术可以是 O(1)，除非在非常特殊的条件下。

[尽管我之前已经注意到这一点，但Pandincus 问题](https://stackoverflow.com/questions/330978/proper-collection-to-use-to-obtain-items-in-o1-time-in-c-net)中刚刚出现了一个示例，“'Proper' collection to use to get items in O(1) time in C# .NET?” .

正如我在那里所说，我所知道的唯一提供 O(1) 访问作为保证边界的集合是具有整数索引值的固定边界数组。假设是该数组是通过一些映射到随机存取存储器来实现的，该映射使用 O(1) 操作来定位具有该索引的单元格。

对于涉及某种搜索以确定不同类型索引（或具有整数索引的稀疏数组）的匹配单元格位置的集合，生活并不容易。特别是，如果存在冲突并且可能出现拥塞，则访问不完全是 O(1)。而且，如果集合是灵活的，则必须认识到并摊销扩展底层结构（例如树或哈希表）的成本，以~~缓解~~拥塞（例如，高碰撞发生率或树不平衡）。

我从来没有想过将这些灵活和动态的结构称为 O(1)。然而，我看到它们作为 O(1) 解决方案提供，而没有任何确定必须保持的条件才能确保实际具有 O(1) 访问（并且该常数小到可以忽略不计）。

问题：所有这些准备都是为了一个问题。O(1) 周围的随意性是什么？为什么如此盲目地接受它？是否认识到即使 O(1) 也可能非常大，即使接近恒定？还是 O(1) 只是将计算复杂性概念用于非正式使用？我很困惑。

更新：答案和评论指出了我自己定义 O(1) 的随意之处，我已经修复了它。我仍在寻找好的答案，在某些情况下，一些评论线程比他们的答案更有趣。

* * *

## 回答 #1

> 赞同：61
> 
>             
> 
> 时间：2008-12-02T05:09:53.750

问题是人们对术语真的很草率。这里有 3 个重要但不同的类：

### O(1) 最坏情况

这很简单 - 在最坏的情况下，所有操作都不会超过恒定的时间，因此在所有情况下都是如此。访问数组的元素是`O(1)`最坏的情况。

### O(1) 摊销最坏情况

*摊销*意味着不是每个操作都`O(1)`处于最坏情况，但是对于任何 N 个操作的序列，序列的总成本`O(N)`在最坏情况下是 no。这意味着即使我们不能将任何单个操作的成本限制为常数，但总会有足够的“快速”操作来弥补“慢”操作，使得操作序列的运行时间是线性的在操作次数上。

例如，标准的[动态数组](http://en.wikipedia.org/wiki/Dynamic_array)在填满时会增加一倍的容量，需要`O(1)`分摊的时间才能在最后插入一个元素，即使某些插入需要`O(N)`时间 - 总是有足够的`O(1)`插入，插入 N 项总是需要`O(N)`时间。

### O(1) 平均情况

这个是最棘手的。平均情况有两种可能的定义：一种用于具有固定输入的随机算法，另一种用于具有随机输入的确定性算法。

对于具有固定输入的随机算法，我们可以通过分析算法并确定所有可能运行时间的概率分布并取该分布的平均值来计算任何给定输入的平均情况运行时间（取决于算法，这可能或由于停机问题，可能无法实现）。

在另一种情况下，我们需要输入的概率分布。例如，如果我们要测量一种排序算法，一个这样的概率分布将是所有 N! 输入的可能排列同样可能。然后，平均案例运行时间是所有可能输入的平均运行时间，由每个输入的概率加权。

由于这个问题的主题是确定性的哈希表，因此我将重点关注平均情况的第二个定义。现在，我们不能总是确定输入的概率分布，因为，我们可以对任何东西进行散列，而这些项目可能来自用户在文件系统中输入或来自文件系统。因此，在谈论哈希表时，大多数人只是假设输入行为良好并且哈希函数行为良好，使得任何输入的哈希值基本上随机均匀分布在可能的哈希值范围内。

花点时间，让最后一点深入人心 -`O(1)`哈希表的平均情况性能来自假设所有哈希值是均匀分布的。如果违反了这个假设（通常不会，但它肯定可以而且确实发生了），则运行时间不再`O(1)`是平均水平。

另请参见[算法复杂性拒绝服务](http://www.cs.rice.edu/~scrosby/hash/CrosbyWallach_UsenixSec2003.pdf)。在本文中，作者讨论了他们如何利用两个版本的 Perl 使用的默认散列函数中的一些弱点来生成大量具有散列冲突的字符串。有了这个字符串列表，他们向一些网络服务器提供了这些字符串，从而在`O(N)`网络服务器使用的哈希表中产生了最坏情况的行为，从而对一些网络服务器产生了拒绝服务攻击。

* * *

## 回答 #2

> 赞同：40
> 
>             
> 
> 时间：2008-12-02T03:38:51.017

我的理解是 O(1) 不一定是恒定的；相反，它不依赖于所考虑的变量。因此，相对于散列中的元素数量，可以说散列查找是 O(1)，但相对于被散列的数据的长度或散列中元素与桶的比率而言，它不是 O(1)。

另一个令人困惑的因素是大 O 符号描述了限制行为。因此，对于小 N 值的函数 f(N) 可能确实显示出很大的变化，但是如果 N 接近无穷大时的极限相对于 N 是恒定的，那么说它是 O(1) 仍然是正确的。

* * *

## 回答 #3

> 赞同：19
> 
>             
> 
> 时间：2008-12-02T04:03:51.183

> O(1) 表示恒定时间和（通常）固定空间

只是为了澄清这是两个单独的陈述。您可以在时间上拥有 O(1)，但在空间上可以拥有 O(n) 或其他任何东西。

> 是否认识到即使 O(1) 也可能非常大，即使接近恒定？

O(1) 可能是不切实际的巨大，它仍然是 O(1)。经常被忽略的是，如果您知道您将拥有一个非常小的数据集，则常数比复杂性更重要，对于相当小的数据集，它是两者的平衡。如果数据集的常数和大小具有适当的规模，则 O(n!) 算法可以胜过 O(1)。

O() 表示法是对复杂性的度量——而不是算法将花费的时间，或者是对给定算法对于给定目的有多“好”的纯粹度量。

* * *

## 回答 #4

> 赞同：11
> 
>             
> 
> 时间：2008-12-02T03:39:56.537

我明白你在说什么，但我认为哈希表中的查找具有 O(1) 的复杂性的说法有几个基本假设。

*   哈希函数设计合理，避免大量冲突。

*   这组键几乎是随机分布的，或者至少不是故意设计为使散列函数性能不佳。

哈希表查找的最坏情况复杂度是 O(n)，但鉴于上述 2 个假设，这极不可能。

* * *

## 回答 #5

> 赞同：8
> 
>             
> 
> 时间：2008-12-02T04:01:10.580

[Hashtables](http://en.wikipedia.org/wiki/Hash_table)是一种支持 O(1) 搜索和插入的数据结构。

哈希表通常有一个键值对，其中**键被用作函数（[哈希函数](http://en.wikipedia.org/wiki/Hash_function)）的参数，该函数将确定值在其内部数据结构**（通常是数组）中的位置。

**由于插入和搜索仅取决于哈希函数的结果，而不取决于哈希表的大小或存储的元素数量，因此哈希表具有 O(1) 的插入和搜索。**

但是，有一个**警告**。也就是说，随着哈希表变得越来越满，将会出现[哈希冲突](http://en.wikipedia.org/wiki/Hash_table#Collision_resolution)，哈希函数将返回一个已经被占用的数组元素。这将需要解决**[冲突](http://en.wikipedia.org/wiki/Hash_table#Collision_resolution)**才能找到另一个空元素。

当发生哈希冲突时，无法在 O(1) 时间内执行搜索或插入。但是，**良好的冲突解决算法**可以减少尝试寻找另一个合适的空白点的次数，或者**增加哈希表的大小**可以首先减少冲突的数量。

因此，理论上，**只有由具有无限数量元素的数组和完美哈希函数支持的哈希表才能实现 O(1) 性能**，因为这是避免哈希冲突导致数量增加的唯一方法所需的操作。因此，对于任何有限大小的数组，由于哈希冲突，有时会小于 O(1)。

* * *

让我们看一个例子。让我们使用哈希表来存储以下`(key, value)`对：

*   `(Name, Bob)`

*   `(Occupation, Student)`

*   `(Location, Earth)`

我们将使用一个包含 100 个元素的数组来实现哈希表后端。

将用于确定要存储 ( , ) 对`key`的数组元素。为了确定元素，将使用：`key``value``hash_function`

*   `hash_function("Name")`返回**18**

*   `hash_function("Occupation")`返回**32**

*   `hash_function("Location")`返回**74**。

根据上面的结果，我们将这些`(key, value)`对分配给数组的元素。

```
array[18] = ("Name", "Bob")
array[32] = ("Occupation", "Student")
array[74] = ("Location", "Earth") 
```

**插入只需要使用哈希函数，不依赖于哈希表的大小，也不依赖于其元素，因此可以在 O(1) 时间内完成。**

类似地，搜索元素使用散列函数。

如果我们想查找 key `"Name"`，我们将执行 a`hash_function("Name")`以找出所需值所在的数组中的哪个元素。

**此外，搜索不依赖于哈希表的大小或存储的元素数量，因此是 O(1) 操作。**

一切都很好。让我们尝试添加一个额外的条目`("Pet", "Dog")`。但是，有一个问题，因为`hash_function("Pet")`返回**18**，它与`"Name"`键的哈希值相同。

因此，我们需要解决这个哈希冲突。假设我们使用的哈希冲突解决函数发现新的空元素是**29**：

```
array[29] = ("Pet", "Dog") 
```

**由于在此插入中存在哈希冲突，因此我们的性能并不是 O(1)。**

当我们尝试搜索 key 时也会出现这个问题，因为尝试通过 perform 查找包含key`"Pet"`的元素最初总是返回 18。`"Pet"``hash_function("Pet")`

一旦我们查找元素 18，我们将找到键`"Name"`而不是`"Pet"`. 当我们发现这种不一致时，我们需要解决冲突以检索包含实际`"Pet"`键的正确元素。解决哈希冲突是一个额外的操作，它使哈希表在 O(1) 时间不执行。

* * *

## 回答 #6

> 赞同：4
> 
>             
> 
> 时间：2008-12-02T04:49:03.293

我无法谈论您看到的其他讨论，但至少有一种哈希算法*可以*保证为 O(1)。

[Cuckoo 散列](http://en.wikipedia.org/wiki/Cuckoo_hashing)保持不变，因此散列表中没有链接。插入摊销 O(1)，检索总是 O(1)。我从未见过它的实现，这是我在大学时新发现的东西。对于相对静态的数据集，应该是一个非常好的O(1)，因为它计算了两个hash函数，执行了两次查找，马上就知道了答案。

请注意，这是假设哈希计算也是 O(1)。您可能会争辩说，对于长度为 K 的字符串，任何散列至少为 O(K)。实际上，您可以很容易地绑定 K，例如 K < 1000。对于 K < 1000，O(K) ~= O(1)。

* * *

## 回答 #7

> 赞同：4
> 
>             
> 
> 时间：2008-12-02T05:00:08.090

关于您如何理解 Big-Oh 表示法可能存在概念错误。这意味着，给定一个算法和一个输入数据集，当数据集的大小趋于无穷大时，算法运行时间的上限取决于 O 函数的值。

当有人说算法需要 O(n) 时间时，这意味着算法最坏情况的运行时间线性地取决于输入集的大小。

当一个算法花费 O(1) 时间时，唯一的意思是，给定一个计算函数 f(n) 运行时间的函数 T(f)，存在一个自然正数 k，使得 T(f) < k 对于任何输入 n。本质上，这意味着算法运行时间的上限不依赖于其大小，并且具有固定的有限限制。

现在，这并不意味着限制很小，只是它与输入集的大小无关。因此，如果我人为地为数据集的大小定义一个边界 k，那么它的复杂度将是 O(k) == O(1)。

例如，在链表上搜索一个值的实例是一个 O(n) 操作。但是如果我说一个列表最多有 8 个元素，那么 O(n) 变为 O(8) 变为 O(1)。

在这种情况下，我们使用 trie 数据结构作为字典（字符树，其中叶节点包含用作键的字符串的值），如果键是有界的，那么它的查找时间可以认为是 O( 1) （如果我将一个字符字段定义为长度最多为 k 个字符，这在许多情况下可能是一个合理的假设）。

对于哈希表，只要假设哈希函数良好（随机分布）且足够稀疏以最大限度地减少冲突，并且在数据结构足够密集时执行重新哈希，您确实可以将其视为 O(1 ) 访问时间结构。

总之，O(1) 时间对于很多事情可能被高估了。对于大型数据结构，足够的散列函数的复杂性可能不是微不足道的，并且存在足够的极端情况，其中冲突的数量导致其表现得像 O(n) 数据结构，并且重新散列可能变得非常昂贵。在这种情况下，像 AVL 或 B-tree 这样的 O(log(n)) 结构可能是更好的选择。

* * *

## 回答 #8

> 赞同：2
> 
>             
> 
> 时间：2008-12-02T03:32:56.770

相对于表中的项目数，HashTable 查找是 O(1)，因为无论您将多少项目添加到列表中，散列单个项目的成本几乎相同，并且创建散列会告诉你是物品的地址。

* * *

要回答为什么这是相关的：OP 询问为什么 O(1) 似乎如此随意地被扔掉，而在他看来，它显然不适用于许多情况。这个答案解释了在这种情况下 O(1) 时间确实是可能的。

* * *

## 回答 #9

> 赞同：2
> 
>             
> 
> 时间：2008-12-02T03:46:11.890

总的来说，我认为人们比较使用它们而不考虑准确性。例如，基于散列的数据结构是 O(1)（平均）查找，如果设计得当并且你有一个好的散列。如果所有内容都散列到一个桶中，则为 O(n)。一般来说，虽然一个人使用了一种很好的算法并且密钥分布合理，所以在没有所有条件的情况下将其称为 O(1) 是很方便的。列表、树等也是如此。我们想到了某些实现，并且在讨论一般性时谈论它们更方便，没有限定。另一方面，如果我们正在讨论具体的实现，那么更精确可能是值得的。

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T03:52:11.067

哈希表实现在实践中并不是“完全”使用 O(1)，如果您测试一个，您会发现它们平均大约 1.5 次查找以在大型数据集中找到给定键

（由于确实会发生碰撞*，*并且在发生碰撞时，必须分配不同的位置）

此外，在实践中，HashMap 由具有初始大小的数组支持，即当它平均达到 70% 的填充度时“增长”到两倍大小，这提供了相对良好的寻址空间。70% 充满后，碰撞率增长得更快。

大 O 理论指出，如果你有一个 O(1) 算法，甚至是一个 O(2) 算法，关键因素是输入集大小与插入/获取其中一个的步骤之间的关系程度。O(2) 仍然是常数时间，所以我们只是将其近似为 O(1)，因为它或多或少意味着相同的事情。

实际上，只有一种方法可以使用 O(1) 获得“完美哈希表”，这需要：

1.  一个全局完美哈希密钥生成器

2.  无界寻址空间。

（**例外情况**：如果您可以预先计算系统允许的键的所有排列，并且您的目标后备存储地址空间被定义为它可以容纳所有允许的键的大小，那么您可以拥有一个完美的散列，但它是“域受限”的完美）

给定一个固定的内存分配，至少有这个是不合理的，因为它会假设你有一些神奇的方法可以将无限量的数据打包到一个固定的空间而不丢失数据，这在逻辑上是不可能的.

所以回想起来，在有限的内存中得到仍然是常数时间的 O(1.5)，即使是相对幼稚的哈希密钥生成器，我认为非常棒。

**后缀注释**注意我在这里使用 O(1.5) 和 O(2)。这些实际上在 big-o 中不存在。这些只是那些不知道大人物的人认为的基本原理。

如果某物需要 1.5 步才能找到一个密钥，或者 2 步才能找到那个密钥，或者 1 步才能找到那个密钥，但步数永远不会超过 2，并且是 1 步还是 2 步是完全随机的，那么它仍然是O(1) 的大 O。这是因为无论您将*多少*项目添加到数据集大小，它仍然保持 <2 步骤。如果对于所有表 > 500 个键，它需要 2 个步骤，那么您可以假设这 2 个步骤实际上是一个包含 2 个部分的步骤，......这仍然是 O(1)。

如果你不能做出这个假设，那么你根本就不是 Big-O 思维，因为你必须使用代表完成所有事情所需的有限计算步骤数的数字，而“一步”对你来说毫无意义。只要进入你的脑海， Big-O 和所涉及的执行周期数之间*没有*直接关联。

* * *

## 回答 #11

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T06:12:55.620

O(1) 确切地说，算法的时间复杂度受一个固定值的限制。这并不意味着它是恒定的，只是它是有界的，无论输入值如何。严格来说，许多据称为 O(1) 的时间算法实际上并不是 O(1)，而且运行速度非常慢，以至于它们受限于所有实际输入值。

* * *

## 回答 #12

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T14:44:23.763

是的，垃圾收集确实会影响在垃圾收集领域中运行的算法的渐近复杂度。它并非没有成本，但如果没有经验方法，很难分析，因为交互成本不是组合成本。

垃圾收集所花费的时间取决于所使用的算法。通常，现代垃圾收集器会在内存填满时切换模式以控制这些成本。例如，一种常见的方法是在内存压力较低时使用 Cheney 样式的复制收集器，因为它付出与活动集大小成正比的成本以换取使用更多空间，并在内存压力时切换到标记和清除收集器变得更大，因为即使它支付的成本与标记的活动集和清除的整个堆或死集成正比。当您添加卡片标记和其他优化等时，实际垃圾收集器的最坏情况成本实际上可能会更糟，为某些使用模式拾取额外的对数因子。

因此，如果您分配一个大哈希表，即使您在其生命周期内使用 O(1) 搜索来访问它，如果您在垃圾收集环境中这样做，垃圾收集器偶尔也会遍历整个数组，因为它大小为 O(n)，您将在收集期间定期支付该费用。

我们通常将其排​​除在算法复杂性分析之外的原因是垃圾收集以非平凡的方式与您的算法交互。成本有多糟糕在很大程度上取决于您在同一过程中还做了什么，因此分析不是组合的。

此外，除了复制 vs. 紧凑 vs. 标记和扫描问题之外，实现细节会极大地影响由此产生的复杂性：

1.  跟踪脏位等的增量垃圾收集器几乎可以使那些较大的重新遍历消失。

2.  这取决于您的 GC 是根据挂钟时间定期工作还是与分配数量成比例地运行。

3.  标记和扫描风格的算法是并发的还是停止世界的

4.  是否将新分配标记为黑色，如果它让它们保持白色，直到将它们放入黑色容器中。

5.  你的语言是否允许修改指针可以让一些垃圾收集器一次性工作。

最后，在讨论算法时，我们正在讨论稻草人。渐近线永远不会完全包含您环境的所有变量。您很少按照设计实现数据结构的每个细节。您在这里和那里借用一个功能，因为您需要快速无序键访问，所以您删除了一个哈希表，您使用联合查找对不相交集进行路径压缩和按等级联合来合并那里的内存区域，因为您不能当您合并区域或您拥有的区域时，您可以支付与区域大小成正比的成本。这些结构被认为是原语，并且在规划“大型”结构的整体性能特征时，渐近线可以帮助您，但了解常量的含义也很重要。

您可以实现具有完美 O(1) 渐近特征的哈希表，只是不要使用垃圾收集；将其从文件映射到内存并自行管理。不过，您可能不喜欢所涉及的常量。

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T03:38:13.373

我认为当许多人抛出“O(1)”这个词时，他们隐含地想到了一个“小”常数，无论“小”在他们的上下文中意味着什么。

您必须根据上下文和常识来进行所有这些大 O 分析。它可能是一个非常有用的工具，也可能是荒谬的，这取决于你如何使用它。

# .net - 检测数据库连接错误

> ID：332955
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-12-02T03:32:56.113
> 
>         
> 
> 标签：.net, ado.net

作为我们单元测试的一部分，我们会在测试开始时恢复一个空白数据库。然后，单元测试通过调用 Web 服务（托管在 Visual Studio ASP.NET 主机中）来执行它们的测试。

第一次运行单元测试时，这对我们来说很好，但是如果在不重新启动 Web 服务的情况下重新运行它们，则会引发异常，因为所有连接都已作为还原的一部分被重置。

下面的代码模拟了发生的情况：

```
static void Main(string[] args)
{
    DoDBStuff();
    new Server("localhost").KillAllProcesses("Test");
    DoDBStuff();
}

private static void DoDBStuff()
{
    string constr = "Data Source=localhost;Initial Catalog=Test;Trusted_Connection=Yes";
    using (SqlConnection con = new SqlConnection(constr))
    {
        con.Open();
        using (SqlCommand cmd = new SqlCommand("SELECT TOP 1 id FROM sysobjects", con))
        {
            int? i = cmd.ExecuteScalar() as int?;
        }
    }
} 
```

所有代码，除了 KillAllProcesses 运行在 Web 服务的进程中，而 KillAllProcess 运行在 Unit Test 进程中。同样可以通过重新启动 SQL 服务器来实现。

我们面临的问题是 web 服务不知道连接何时被终止，而只是从连接池中选择一个“坏”连接。此外，连接的创建和命令的执行在应用程序中是分开的几个层。

我们如何在执行命令之前检测到连接是“坏的”，而不会严重影响应用程序的性能？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-12-02T08:01:16.133

终止 SQL Server 后，您的连接池将包含与旧 SQL Server 实例的陈旧连接。

您可以在重新启动 SQL Server 后调用 SqlConnection.ClearAllPools() 从池中清除过时的连接，例如：

```
static void Main(string[] args)
{    
    DoDBStuff();    
    new Server("localhost").KillAllProcesses("Test");
    SqlConnection.ClearAllPools();
    DoDBStuff();
} 
```

注意 ClearAllPools 方法是在 .NET 2.0 中引入的

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-01-21T18:35:20.287

出于单元测试的目的，您可以调整连接池超时吗？这样，连接会更快地失效，并且它们会在您的检出/编译过程中过期，并且会在您的实际单元测试运行时全部清除？

或者，作为另一种选择，您是否可以编写一个首先执行并调用刷新现有连接池的 Web 服务的单元测试？它会强制任何新的数据请求生成一个新的数据库连接，这不会导致异常。根据 MSDN：

> ADO.NET 2.0 引入了两种清除池的新方法：ClearAllPools 和 ClearPool。ClearAllPools 清除给定提供程序的连接池，ClearPool 清除与特定连接关联的连接池。如果在呼叫时有正在使用的连接，它们会被适当地标记。当它们关闭时，它们被丢弃而不是返回到池中。

# visual-studio-2008 - Visual Studio 2008 崩溃日志在哪里？

> ID：332972
> 
>         
> 
> 赞同：15
> 
>         
> 
> 时间：2008-12-02T03:42:07.857
> 
>         
> 
> 标签：visual-studio-2008, logging, plugins, crash, resharper

我安装了带有 SP1 的 Visual Studio 2008，当我在 Moq 框架中使用 lambda 表达式时它崩溃了。

起初我以为问题是 Resharper ......但现在我已经卸载了它，VS 2008 仍然崩溃。我每次都能复制这个问题。

我在想可能是其他一些插件导致了这个问题，而不是 VS 2008 ......但我不能确定。

那么我想要找到的是 Visual Studio 在哪里记录发生的崩溃？

不幸的是，我无法找到它...有没有人知道它是否存在，如果存在，在哪里看？

提前致谢！

* * *

## 回答 #1

> 赞同：25
> 
>             
> 
> 时间：2008-12-02T10:01:49.340

就在几天前，我了解了[`devenv.exe`'s `/log`switch](http://blogs.msdn.com/saraford/archive/2008/11/27/did-you-know-there-s-a-way-to-have-visual-studio-log-its-activity-for-troubleshooting-366.aspx)。我建议你试一试。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T10:11:06.713

Power Commands 插件导致了我遇到的与桌面问题类似的崩溃问题。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T05:31:13.097

我建议使用 WinDbg 来运行 VS 的实例，当它崩溃时查看托管和非托管调用堆栈。

# c# - 检查一个数组是否是另一个数组的子集

> ID：332973
> 
>         
> 
> 赞同：159
> 
>         
> 
> 时间：2008-12-02T03:42:30.837
> 
>         
> 
> 标签：c#, list, linq, subset

关于如何检查该列表是否是另一个列表的子集的任何想法？

具体来说，我有

```
List<double> t1 = new List<double> { 1, 3, 5 };
List<double> t2 = new List<double> { 1, 5 }; 
```

如何使用 LINQ 检查 t2 是否是 t1 的子集？

* * *

## 回答 #1

> 赞同：273
> 
>             
> 
> 时间：2008-12-02T04:12:33.647

```
bool isSubset = !t2.Except(t1).Any(); 
```

* * *

## 回答 #2

> 赞同：65
> 
>             
> 
> 时间：2008-12-02T03:57:54.377

如果使用集合，请使用 HashSet 而不是 List。然后你可以简单地使用[IsSubsetOf()](http://msdn.microsoft.com/en-us/library/bb358446.aspx)

```
HashSet<double> t1 = new HashSet<double>{1,3,5};
HashSet<double> t2 = new HashSet<double>{1,5};

bool isSubset = t2.IsSubsetOf(t1); 
```

抱歉，它不使用 LINQ。:-(

如果您需要使用列表，那么@Jared 的解决方案适用于您需要删除任何存在的重复元素的警告。

* * *

## 回答 #3

> 赞同：14
> 
>             
> 
> 时间：2014-11-02T07:44:43.380

这是一个比此处发布的其他解决方案更有效的解决方案，尤其是顶级解决方案：

```
bool isSubset = t2.All(elem => t1.Contains(elem)); 
```

如果您可以在 t2 中找到一个不在 t1 中的元素，那么您就知道 t2 不是 t1 的子集。与使用 .Except 或 .Intersect 的解决方案不同，这种方法的优点是它全部就地完成，无需分配额外的空间。此外，该解决方案能够在找到违反子集条件的单个元素时立即中断，而其他元素继续搜索。以下是解决方案的最佳长形式，在我的测试中，它仅比上述速记解决方案快一点。

```
bool isSubset = true;
foreach (var element in t2) {
    if (!t1.Contains(element)) {
        isSubset = false;
        break;
    }
} 
```

我对所有解决方案进行了一些基本的性能分析，结果非常好。这两个解决方案比 .Except() 和 .Intersect() 解决方案快大约 100 倍，并且不使用额外的内存。

* * *

## 回答 #4

> 赞同：13
> 
>             
> 
> 时间：2014-08-27T11:40:02.533

如果您正在进行**单元测试**，您还可以使用[CollectionAssert.IsSubsetOf](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.testtools.unittesting.collectionassert.issubsetof.aspx)方法：

```
CollectionAssert.IsSubsetOf(subset, superset); 
```

在上述情况下，这意味着：

```
CollectionAssert.IsSubsetOf(t2, t1); 
```

* * *

## 回答 #5

> 赞同：6
> 
>             
> 
> 时间：2012-02-24T18:02:10.170

@Cameron 作为扩展方法的解决方案：

```
public static bool IsSubsetOf<T>(this IEnumerable<T> a, IEnumerable<T> b)
{
    return !a.Except(b).Any();
} 
```

用法：

```
bool isSubset = t2.IsSubsetOf(t1); 
```

（这与@Michael 博客上发布的类似，但不完全相同）

* * *

## 回答 #6

> 赞同：4
> 
>             
> 
> 时间：2020-10-17T10:07:39.327

我花了一些时间使用 BenchmarkDotNet 对这个答案中的 3 个工作解决方案进行基准测试。

*   `!t2.Except(t1).Any()`称为 except().Any()

*   `t2.IsSubsetOf(t1)`称为哈希集

*   `t2.All(elem => t1.Contains(elem))`称为全部（=>包含）

我改变了 3 个参数：

*   超集数

*   子集长度

*   项目的可变性

所有超集都是随机长度并包含 range 中的项目`[0; Variability)`。子集具有固定长度并包含范围内的项目`[0; Variability)`。

赢家是 All(=>Contains) 方法 - 它有时比使用 HashSets 快 30 倍，比 except().Any() 快 50 倍。

代码可以在[github上找到](https://github.com/zetroot/SubsetAlgorithmsBenchmark)

**更新**
正如@Gert Arnold 在评论中提到的，我的基准测试中有一个错误。`ToHashSet()`我在每次迭代中调用。因此，我还构建了一组预构建的哈希集，并添加了一个名为`prebuilt HashSet`. 它不是绝对的赢家，有时它会失去`All(=>Contains)`算法。在我看来，重点在于超集的可变性（和重复）。当值的可变性很低时 - 哈希集获胜，因为它将它从数据中删除。

决赛桌在这里：

```
|             Method | SupersetsInIteration | SubsetLength | Variability |          Mean |        Error |       StdDev |        Median |
|------------------- |--------------------- |------------- |------------ |--------------:|-------------:|-------------:|--------------:|
|     Except().Any() |                 1000 |           10 |         100 |   1,485.89 μs |     7.363 μs |     6.887 μs |   1,488.36 μs |
|        ToHashSet() |                 1000 |           10 |         100 |   1,015.59 μs |     5.099 μs |     4.770 μs |   1,015.43 μs |
| prebuilt HashSet   |                 1000 |           10 |         100 |      38.76 μs |     0.065 μs |     0.054 μs |      38.78 μs |
|    All(=>Contains) |                 1000 |           10 |         100 |     105.46 μs |     0.320 μs |     0.267 μs |     105.38 μs |
|     Except().Any() |                 1000 |           10 |       10000 |   1,912.17 μs |    38.180 μs |    87.725 μs |   1,890.72 μs |
|        ToHashSet() |                 1000 |           10 |       10000 |   1,038.70 μs |    20.028 μs |    40.459 μs |   1,019.35 μs |
| prebuilt HashSet   |                 1000 |           10 |       10000 |      28.22 μs |     0.165 μs |     0.155 μs |      28.24 μs |
|    All(=>Contains) |                 1000 |           10 |       10000 |      81.47 μs |     0.117 μs |     0.109 μs |      81.45 μs |
|     Except().Any() |                 1000 |           50 |         100 |   4,888.22 μs |    81.268 μs |    76.019 μs |   4,854.42 μs |
|        ToHashSet() |                 1000 |           50 |         100 |   4,323.23 μs |    21.424 μs |    18.992 μs |   4,315.16 μs |
| prebuilt HashSet   |                 1000 |           50 |         100 |     186.53 μs |     1.257 μs |     1.176 μs |     186.35 μs |
|    All(=>Contains) |                 1000 |           50 |         100 |   1,173.37 μs |     2.667 μs |     2.227 μs |   1,173.08 μs |
|     Except().Any() |                 1000 |           50 |       10000 |   7,148.22 μs |    20.545 μs |    19.218 μs |   7,138.22 μs |
|        ToHashSet() |                 1000 |           50 |       10000 |   4,576.69 μs |    20.955 μs |    17.499 μs |   4,574.34 μs |
| prebuilt HashSet   |                 1000 |           50 |       10000 |      33.87 μs |     0.160 μs |     0.142 μs |      33.85 μs |
|    All(=>Contains) |                 1000 |           50 |       10000 |     131.34 μs |     0.569 μs |     0.475 μs |     131.24 μs |
|     Except().Any() |                10000 |           10 |         100 |  14,798.42 μs |   120.423 μs |   112.643 μs |  14,775.43 μs |
|        ToHashSet() |                10000 |           10 |         100 |  10,263.52 μs |    64.082 μs |    59.942 μs |  10,265.58 μs |
| prebuilt HashSet   |                10000 |           10 |         100 |   1,241.19 μs |     4.248 μs |     3.973 μs |   1,241.75 μs |
|    All(=>Contains) |                10000 |           10 |         100 |   1,058.41 μs |     6.766 μs |     6.329 μs |   1,059.22 μs |
|     Except().Any() |                10000 |           10 |       10000 |  16,318.65 μs |    97.878 μs |    91.555 μs |  16,310.02 μs |
|        ToHashSet() |                10000 |           10 |       10000 |  10,393.23 μs |    68.236 μs |    63.828 μs |  10,386.27 μs |
| prebuilt HashSet   |                10000 |           10 |       10000 |   1,087.21 μs |     2.812 μs |     2.631 μs |   1,085.89 μs |
|    All(=>Contains) |                10000 |           10 |       10000 |     847.88 μs |     1.536 μs |     1.436 μs |     847.34 μs |
|     Except().Any() |                10000 |           50 |         100 |  48,257.76 μs |   232.573 μs |   181.578 μs |  48,236.31 μs |
|        ToHashSet() |                10000 |           50 |         100 |  43,938.46 μs |   994.200 μs | 2,687.877 μs |  42,877.97 μs |
| prebuilt HashSet   |                10000 |           50 |         100 |   4,634.98 μs |    16.757 μs |    15.675 μs |   4,643.17 μs |
|    All(=>Contains) |                10000 |           50 |         100 |  10,256.62 μs |    26.440 μs |    24.732 μs |  10,243.34 μs |
|     Except().Any() |                10000 |           50 |       10000 |  73,192.15 μs |   479.584 μs |   425.139 μs |  73,077.26 μs |
|        ToHashSet() |                10000 |           50 |       10000 |  45,880.72 μs |   141.497 μs |   125.433 μs |  45,860.50 μs |
| prebuilt HashSet   |                10000 |           50 |       10000 |   1,620.61 μs |     3.507 μs |     3.280 μs |   1,620.52 μs |
|    All(=>Contains) |                10000 |           50 |       10000 |   1,460.01 μs |     1.819 μs |     1.702 μs |   1,459.49 μs |
|     Except().Any() |               100000 |           10 |         100 | 149,047.91 μs | 1,696.388 μs | 1,586.803 μs | 149,063.20 μs |
|        ToHashSet() |               100000 |           10 |         100 | 100,657.74 μs |   150.890 μs |   117.805 μs | 100,654.39 μs |
| prebuilt HashSet   |               100000 |           10 |         100 |  12,753.33 μs |    17.257 μs |    15.298 μs |  12,749.85 μs |
|    All(=>Contains) |               100000 |           10 |         100 |  11,238.79 μs |    54.228 μs |    50.725 μs |  11,247.03 μs |
|     Except().Any() |               100000 |           10 |       10000 | 163,277.55 μs | 1,096.107 μs | 1,025.299 μs | 163,556.98 μs |
|        ToHashSet() |               100000 |           10 |       10000 |  99,927.78 μs |   403.811 μs |   337.201 μs |  99,812.12 μs |
| prebuilt HashSet   |               100000 |           10 |       10000 |  11,671.99 μs |     6.753 μs |     5.986 μs |  11,672.28 μs |
|    All(=>Contains) |               100000 |           10 |       10000 |   8,217.51 μs |    67.959 μs |    56.749 μs |   8,225.85 μs |
|     Except().Any() |               100000 |           50 |         100 | 493,925.76 μs | 2,169.048 μs | 1,922.805 μs | 493,386.70 μs |
|        ToHashSet() |               100000 |           50 |         100 | 432,214.15 μs | 1,261.673 μs | 1,180.169 μs | 431,624.50 μs |
| prebuilt HashSet   |               100000 |           50 |         100 |  49,593.29 μs |    75.300 μs |    66.751 μs |  49,598.45 μs |
|    All(=>Contains) |               100000 |           50 |         100 |  98,662.71 μs |   119.057 μs |   111.366 μs |  98,656.00 μs |
|     Except().Any() |               100000 |           50 |       10000 | 733,526.81 μs | 8,728.516 μs | 8,164.659 μs | 733,455.20 μs |
|        ToHashSet() |               100000 |           50 |       10000 | 460,166.27 μs | 7,227.011 μs | 6,760.150 μs | 457,359.70 μs |
| prebuilt HashSet   |               100000 |           50 |       10000 |  17,443.96 μs |    10.839 μs |     9.608 μs |  17,443.40 μs |
|    All(=>Contains) |               100000 |           50 |       10000 |  14,222.31 μs |    47.090 μs |    44.048 μs |  14,217.94 μs | 
```

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2017-10-23T08:41:20.357

基于@Cameron 和@Neil 的答案，我编写了一个扩展方法，该方法使用与 Enumerable 类相同的术语。

```
/// <summary>
/// Determines whether a sequence contains the specified elements by using the default equality comparer.
/// </summary>
/// <typeparam name="TSource">The type of the elements of source.</typeparam>
/// <param name="source">A sequence in which to locate the values.</param>
/// <param name="values">The values to locate in the sequence.</param>
/// <returns>true if the source sequence contains elements that have the specified values; otherwise, false.</returns>
public static bool ContainsAll<TSource>(this IEnumerable<TSource> source, IEnumerable<TSource> values)
{
    return !values.Except(source).Any();
} 
```

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2020-11-04T14:16:33.677

那么我们有 2 个数组，`array1`并且`array2`我们想要检查所有`array1`值是否存在于`array2`：

```
array1.All(ar1 => array2.Any(ar2 => ar2.Equals(ar1))); 
```

注意：`ar2.Equals(ar1)`如果以其他方式描述相等，则可以替换。

* * *

## 回答 #9

> 赞同：-1
> 
>             
> 
> 时间：2008-12-02T03:44:56.090

试试这个

```
static bool IsSubSet<A>(A[] set, A[] toCheck) {
  return set.Length == (toCheck.Intersect(set)).Count();
} 
```

这里的想法是 Intersect 只会返回两个数组中的值。此时如果结果集的长度与原始集相同，则“set”中的所有元素也都在“check”中，因此“set”是“toCheck”的子集

注意：如果“set”有重复项，我的解决方案将不起作用。我不会改变它，因为我不想窃取别人的选票。

提示：我投票支持卡梅伦的回答。  

* * *

## 回答 #10

> 赞同：-1
> 
>             
> 
> 时间：2018-06-07T04:11:54.040

> 在这里，我们检查子列表（即`t2`）中是否存在任何不包含在父列表（即`t1`）中的元素。如果不存在，则该列表是另一个列表的子集

例如：

```
bool isSubset = !(t2.Any(x => !t1.Contains(x))); 
```

# c# - 从我的 WCF 服务访问 Response 对象

> ID：332974
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-12-02T03:42:34.423
> 
>         
> 
> 标签：c#, asp.net, wcf

在与我的网站在同一个项目中的 WCF 服务类中，我从 System.Web.UI.Page 继承，以便我可以访问 Page.Response 对象但是当我使用它时出现错误：“响应不可用在这种情况下。”

我想将结果传递给我的 WCF 服务的文件保存到文件中，如下所示：

```
 public void SendList(List<ListType> listTypes)
            {        
                Response.Clear(); 
                Response.ContentType = "text/plain";
                Response.AddHeader("content-disposition", "attachment; filename=filew.csv");
  //etc
            } 
```

如果我无法访问 Response 对象，我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-12-02T04:55:58.520

WCF 不应被视为简单的 http - 即按照您上面的建议做通常没有意义。您可以通过编写添加 WCF 标头的“消息检查器”来做类似的事情。WCF 服务不是一个`Page`，也不能被视为一个。

对于*请求*，可以启用[ASP.NET 兼容性](http://blogs.msdn.com/wenlong/archive/2006/01/23/516041.aspx)[`HttpContext.Current`](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.current.aspx)标志（提供对 的访问），但一般建议是：不要。

那么：您实际上想要做什么？你在这里的目标是什么？

# c# - sharepoint 中的调查结果

> ID：332984
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-12-02T03:47:28.410
> 
>         
> 
> 标签：c#, sharepoint, survey, pseudocode

我如何获得已完成或未完成或未回复调查的用户列表。

所以我有一个调查，让我们说“调查 A”。在本次调查中，我列出了必须填写调查表的人员或团体。sharepoint 已经为我们提供了一份受访者名单，但我想列出一份未回复或未完成调查的人员名单。

我正在使用c#，谢谢..

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-12-28T08:43:08.183

假设您的调查被标记为非匿名，并且人们不能多次回答调查，您可以执行以下操作：

1.  列出必须填写调查表的人员名单。

2.  遍历调查中的项目（每个项目都是一个人的回答）。

3.  从第 1 部分的人员列表中删除创建该项目的人员。（SharePoint 调查将回答调查的人员保留为项目的“创建者”/“作者”属性）

结果将是必须回答调查但尚未回答的人员列表。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2011-02-18T13:42:48.393

```
private DataTable GetUser()
{
    //SPGroup User = null;

    DataTable dt = new DataTable();
    dt.Columns.Add("Survey Remeaning User");

    DataTable dtuser = new DataTable();
    dtuser.Columns.Add("Survey Completed User");

    try
    {
        SPSecurity.RunWithElevatedPrivileges(delegate()
        {
            using (SPSite objSubSite = new SPSite(SPContext.Current.Site.Url))
            {
                SPUserCollection userCollection = SPContext.Current.Web.Groups["Survey Members"].Users;
                foreach (SPUser user in userCollection)
                {
                    StringBuilder sb = new StringBuilder();
                    sb.Append("<Where>");
                    sb.Append("<Eq>");
                    sb.Append("<FieldRef Name='Author' />");
                    sb.Append("<Value Type='User'>" + user + "</Value>");
                    sb.Append("</Eq>");
                    sb.Append("</Where>");

                    // query.ViewFields = "<FieldRef Name='Author'/>";
                    SPQuery query = new SPQuery();
                    query.Query = sb.ToString();

                    using (SPWeb objWeb = objSubSite.OpenWeb())
                    {
                        int i = objWeb.Lists["SurveyList"].GetItems(query).Count;
                        if (i == 0)
                        {
                            dt.Rows.Add(user);
                            GvUser.DataSource = dt;
                            GvUser.DataBind();
                        }
                        //if (i == 1)
                        else
                        {
                            //DataTable dtuser = new DataTable();
                            //dt.Columns.Add("SurveyCompleted");
                            dtuser.Rows.Add(user);
                            GvComUser.DataSource = dtuser;
                            GvComUser.DataBind();
                        }
                    }
                }
            }
        });
    }
    catch (Exception)
    {

    }
    return dt;
} 
```

您必须在用户和组中创建一个组并在其中添加用户。然后你可以使用上面的函数并在页面加载中添加函数....我通过在其中添加coloums在网格视图中显示结果

# sql - 使用 Oracle Brio 访问多个数据源

> ID：332985
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-12-02T03:47:37.020
> 
>         
> 
> 标签：sql, oracle, brio

尝试使用 Oracle 的 Brio 构建仪表板。我必须访问 6 个不同的数据库来获取相同类型的数据，聚合并显示它。除了当我这样做时，Brio 从第一个来源获取数据就好了。当我从第二个数据源抓取数据时，Brio 用第二组数据替换原始数据。所以我无法汇总数据。谁能帮我弄清楚如何在 Brio 中做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2009-02-03T18:37:06.317

您需要使用[UNION](http://www.oracle-dba-online.com/sql/oracle_union_sorting.htm)语句，而不是运行 6 次查询。

例如：

不要这样做

```
SELECT * FROM DATABASE_1..TABLE_1
GO
SELECT * FROM DATABASE_2..TABLE_1
GO
SELECT * FROM DATABASE_3..TABLE_1
GO 
```

改为这样做

```
SELECT * FROM DATABASE_1..TABLE_1
UNION
SELECT * FROM DATABASE_2..TABLE_1
UNION
SELECT * FROM DATABASE_3..TABLE_1
GO 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2010-11-09T16:32:07.047

如果您对每个源使用不同的 OCE 文件（您可能是这样），那么就没有简单的方法可以做到这一点。您需要为每个 OCE 文件单独查询

如果可以在一个 OCE 文件下找到所有数据库，则可以使用 UNION 技巧；更要指出的是，在 Brio 中，它被发现为“附加查询”。只需确保您构建的查询与第一个查询的返回内容相同即可；所有的列标题都来自它。

如果您需要将不同的查询合并到一个结果部分中，我发现仅使用标准 Brio 函数的最简单（嗯，唯一）方法是通过每个字段上的完全外部连接来连接每个集合然后将每个字段合并在一起......但这非常低效，并且无法完成更大的文件。您可能最好对文件进行排序并编写一个 javascript 例程来将它们一起解析，或者首先在 Brio 之外完成整个事情。

# json - 获取 IIS6 以提供 JSON 文件（包括 POST、GET）？

> ID：332988
> 
>         
> 
> 赞同：54
> 
>         
> 
> 时间：2008-12-02T03:48:39.607
> 
>         
> 
> 标签：json, iis, iis-6

默认情况下，IIS6 不提供 .json（无通配符`MIME`类型）。

因此会抛出 404 not found 。然后我添加了一个工作正常的新 MIME 类型`(.json, text/plain or application/x-javascript or application/json)`。

但是，当您添加一个新的映射`(Home Directory -> Configuration -> Add) with .json, C:\WINDOWS\system32\inetsrv\asp.dll`" `GET,POST`" 并尝试浏览到该文件时，您会得到 404。

如果您删除映射并尝试`POST or GET`使用它，您会得到一个`405`.

...

建议？

* * *

## 回答 #1

> 赞同：108
> 
>             
> 
> 时间：2009-07-13T18:04:44.937

默认情况下，W2K3 及更高版本中的 IIS 不会提供不是它知道的 MIME 类型的文件（而是返回 404 错误）。

您需要将 MIME 类型添加到 IIS 以允许它为该类型的文件提供服务。您可以在站点级别或服务器级别进行设置。

为整个服务器设置这个：

*   在 IIS 管理器中打开服务器的属性，然后单击 MIME 类型

*   点击“新建”。为扩展名输入“JSON”，为 MIME 类型输入“application/json”。

* * *

## 更新

鉴于这篇文章是在 Sencha“入门指南”中找到的，我认为值得*升级*这些步骤。

在 64 位 Win 7 Enterprise SP 1 上 IIS 具有不同的外观。所以步骤：

*。打开 IIS 管理器。然后你得到以下窗口。

![在此处输入图像描述](https://i.stack.imgur.com/tTsKd.png)

*。右键单击 MIME 并选择`open feature`

*。从右上角的“操作”菜单中单击“添加”

![在此处输入图像描述](https://i.stack.imgur.com/UBcZT.png)

*。休息是根据埃文的。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2009-07-13T15:07:11.783

确保在 IIS 配置的 Web 服务扩展部分中允许使用 Active Server Pages。

IIS 管理器 ->（本地计算机）-> Web 服务扩展 -> 活动服务器页面

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2013-06-30T12:00:26.480

如果您没有安装 IIS，显然，您需要在启动 IIS 管理器之前安装它。我需要（在 Windows 7 上）转到：“控制面板/程序和功能”，然后单击“打开或关闭 Windows 功能”

参考： http: [//www.howtogeek.com/howto/windows-vista/how-to-install-iis-on-windows-vista/](http://www.howtogeek.com/howto/windows-vista/how-to-install-iis-on-windows-vista/)

似乎对于不同的系统启动 IIS 管理器是不同的。我做了'开始/运行/inetmgr。

参考： http: [//msdn.microsoft.com/en-us/library/bb763170 (v=vs.100).aspx](http://msdn.microsoft.com/en-us/library/bb763170(v=vs.100).aspx)

参考：[http ://technet.microsoft.com/en-us/library/cc770472(v=ws.10).aspx](http://technet.microsoft.com/en-us/library/cc770472(v=ws.10).aspx)

特洛伊弗瑞克斯。#

# php - 优化提要获取

> ID：332992
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-12-02T03:51:33.797
> 
>         
> 
> 标签：php, mysql, cron, feed, fetch

我现在正在一个必须获取用户提要的网站上工作。但是，如果我有一个包含 300 个提要的数据库，我如何才能最好地优化获取。我将设置一个 cron-job 来获取提要，但我应该像每秒钟 5 次那样做吗？

关于如何在 PHP 中以最佳方式做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-12-02T04:48:06.773

如果我理解您的问题，您基本上是在提要聚合器网站上工作？

您可以执行以下操作；首先每 1 小时刷新一次（例如）。当您从某个提要中获得足够的条目时 - 计算条目之间的平均间隔。然后将该间隔用作获取该提要的间隔。

例如，如果该网站在过去 7 天内发布了 7 篇文章 - 您可以每 24 小时（1 天）从该网站获取提要。

我使用这个算法进行了一些更改，当我计算这个平均间隔时，我将它除以 2（以确保不会太少地获取）。如果结果小于 60 分钟 - 我将间隔设置为 1 小时或大于 24 分钟，我将其设置为 24 小时。

例如，像这样：

```
 public function updateRefreshInterval() {
            $sql = 'select count(*) _count ' .
                    'from article ' .
                    'where created>adddate(now(), interval -7 day) and feed_id = ' . (int) $this->getId();
            $array = Db::loadArray( $sql );

            $count = $array[ '_count' ];

            $interval = 7 * 24 * 60 * 60 / ( $count + 1 );
            $interval = $interval / 2;
            if( $interval < self::MIN_REFRESH_INTERVAL ) {
                    $interval = self::MIN_REFRESH_INTERVAL;
            }
            if( $interval > self::MAX_REFRESH_INTERVAL ) {
                    $interval = self::MAX_REFRESH_INTERVAL;
            }

            Db::execute( 'update feed set refresh_interval = ' . $interval . ' where id = ' . (int) $this->getId() );
    } 
```

该表是“feed”，“refreshed”是上次刷新提要时的时间戳，“refresh_interval”是两次获取同一提要之间的所需时间间隔。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-12-02T04:19:40.903

根据新信息，我想我会做这样的事情：

让“第一个”客户端启动更新工作并用它存储时间戳。其他要求提供信息的客户都会获得兑现的信息，直到该信息过时为止。然后，来自客户端的下一次命中将刷新所有客户端将使用的现金，直到下一次它变旧。

实际启动更新工作的客户端不必等待它完成，只需提供旧的兑现版本并继续执行直到工作完成。

这样，如果没有客户请求，您就不必更新**任何内容。**

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T04:32:19.113

最好的办法是保持“友善”，不要因为大量不必要的请求而使提要过载。我为我的一个 Web 应用程序确定了 1 小时的更新时间，该应用程序监视大约 150 个博客的更新。我将上次检查它们的时间存储在数据库中，并使用它来决定何时更新它们。提要是随机添加的，因此它们不会同时更新。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-12-02T04:36:57.280

我写了[pfetch](http://github.com/dustin/pfetch)来为我做这件事。它很小，但有几个非常重要的方面：

1.  它是用twisted编写的，即使在网络速度很慢的情况下也可以处理大量并发。

2.  它不需要任何 cron jockeying 或任何东西。

实际上，我之所以写它是因为我的基于 cron 的 fetcher 正在成为一个问题。现在我将它配置为在互联网上获取一些我想要的随机内容，然后在事情发生变化时运行脚本来更新我自己网站的某些部分。

# c - Starting process in new Terminal window on Mac

> ID：332995
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-12-02T03:52:08.523
> 
>         
> 
> 标签：c, macos, terminal, console

On Windows I can do `CreateProcess(..., CREATE_NEW_CONSOLE, ...)` and my child process (which is console app, not GUI) will be launched in a new window. What is the easiest way to emulate this on Mac OS?

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2008-12-02T05:57:41.720

**`open -a Terminal.app $(which program)`** gets a new terminal running the specified program (assuming you're using bash).

You can use **`execve()`** (possible after a **`fork()`**) to acheive the same thing in compiled code without knowing any Apple APIs (I imagine there is a proper way to do this...).

Read **`man open`**.

Edit: you don't need to specify the path to Terminal.app (the finder can figure that out).

* * *

If you have X running, it is even easier: just spawn a new xterm with **`xterm -e program &`**.

Read **`man xterm`** (which will take longer...).

* * *

I'll second Chris about the correct use (or lack thereof) of CLI for ordinary mac programs. In my buisness this is expected but the typical user will be {confused|angry|unhappy}.

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2008-12-02T06:11:55.667

The Terminal (Terminal.app, what you're referring to as "the console") is just another user-level application on Mac OS X, not a capability of the operating system.  There is no direct way in the various APIs available on Mac OS X to just start an executable within a new Terminal window.

However, I believe you can open an executable with Terminal as if it was a document — whether in code or as a user — and it will run in a new session.  However, this is **not** a normal Mac OS X user experience and **should not** generally be used in Mac software you're going to deliver to end users.

Mac OS X applications are applications.  It's fine to provide tools that advanced users can interact with via Terminal, but Terminal is in no way, shape or form a substitute for a real application when delivering software to end users.

I'll add to this that if you're using Cocoa, you can use the [NSTask](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSTask_Class/Reference/Reference.html "NSTask Reference") class to start and interact with another process very easily.

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2009-02-03T15:02:24.703

Marc Liyanage does this neatly with "term", osascript tell application "Terminal":

[http://www.entropy.ch/blog/Mac+OS+X/2005/02/28/Terminal_tricks_8220_term_8221_and_8220_clone_8221.html](http://www.entropy.ch/blog/Mac+OS+X/2005/02/28/Terminal_tricks_8220_term_8221_and_8220_clone_8221.html)

(On "typical users": there are different universes, each finding the others strange.

Coming from Unix, I'm used to a process or "| pipe args" anywhere a file can be used;

this helps software componentry immensely.

But open -a does files only -- different universe). 
```` 
```********